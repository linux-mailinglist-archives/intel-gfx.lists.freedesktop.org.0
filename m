Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7486F684E2
	for <lists+intel-gfx@lfdr.de>; Mon, 15 Jul 2019 10:10:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9393989826;
	Mon, 15 Jul 2019 08:10:20 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D88DA8981D
 for <intel-gfx@lists.freedesktop.org>; Mon, 15 Jul 2019 08:10:17 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17303252-1500050 
 for multiple; Mon, 15 Jul 2019 09:09:53 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 15 Jul 2019 09:09:37 +0100
Message-Id: <20190715080946.15593-15-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190715080946.15593-1-chris@chris-wilson.co.uk>
References: <20190715080946.15593-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 15/24] drm/i915: Replace struct_mutex for batch
 pool serialisation
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Matthew Auld <matthew.auld@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U3dpdGNoIHRvIHRyYWNraW5nIGFjdGl2aXR5IHZpYSBpOTE1X2FjdGl2ZSBvbiBpbmRpdmlkdWFs
IG5vZGVzLCBvbmx5CmtlZXBpbmcgYSBsaXN0IG9mIHJldGlyZWQgb2JqZWN0cyBpbiB0aGUgY2Fj
aGUsIGFuZCByZWFwaW5nIHRoZSBjYWNoZQp3aGVuIHRoZSBlbmdpbmUgaXRzZWxmIGlkbGVzLgoK
U2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+ClJl
dmlld2VkLWJ5OiBNYXR0aGV3IEF1bGQgPG1hdHRoZXcuYXVsZEBpbnRlbC5jb20+Ci0tLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgICAgICAgICAgICAgICAgIHwgICAyICstCiAuLi4v
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMgICAgfCAgNTggKysrLS0tCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMgICAgfCAgIDEgLQogLi4u
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmggIHwgICAxIC0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jICAgICAgICB8ICAgNCArLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lLmggICAgICAgIHwgICAxIC0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jICAgICB8ICAxMSArLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMgICAgIHwgICAyICsKIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sLmMgICB8IDE3NyArKysrKysrKysrKysrKysr
KysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sLmggICB8ICAzNCAr
KysrCiAuLi4vZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sX3R5cGVzLmggfCAgMjkg
KysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMuaCAgfCAgIDYg
Ky0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L21vY2tfZW5naW5lLmMgICAgICAgICB8ICAgMyAr
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyAgICAgICAgICAgfCAgNjggLS0t
LS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fYmF0Y2hfcG9vbC5jICAgIHwgMTMy
IC0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2JhdGNoX3Bvb2wu
aCAgICB8ICAyNiAtLS0KIDE2IGZpbGVzIGNoYW5nZWQsIDI5MCBpbnNlcnRpb25zKCspLCAyNjUg
ZGVsZXRpb25zKC0pCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfZW5naW5lX3Bvb2wuYwogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2VuZ2luZV9wb29sLmgKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG9vbF90eXBlcy5oCiBkZWxldGUgbW9kZSAxMDA2
NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fYmF0Y2hfcG9vbC5jCiBkZWxldGUgbW9k
ZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fYmF0Y2hfcG9vbC5oCgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9NYWtlZmlsZQppbmRleCBmYWZjMzc2M2RjMmQuLmNkYzJkNDYyZGI4YiAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvTWFrZWZpbGUKQEAgLTcyLDYgKzcyLDcgQEAgb2JqLXkgKz0gZ3QvCiBndC15ICs9IFwKIAln
dC9pbnRlbF9icmVhZGNydW1icy5vIFwKIAlndC9pbnRlbF9jb250ZXh0Lm8gXAorCWd0L2ludGVs
X2VuZ2luZV9wb29sLm8gXAogCWd0L2ludGVsX2VuZ2luZV9jcy5vIFwKIAlndC9pbnRlbF9lbmdp
bmVfcG0ubyBcCiAJZ3QvaW50ZWxfZW5naW5lX3VzZXIubyBcCkBAIC0xMjYsNyArMTI3LDYgQEAg
aTkxNS15ICs9IFwKIAkgICQoZ2VtLXkpIFwKIAkgIGk5MTVfYWN0aXZlLm8gXAogCSAgaTkxNV9j
bWRfcGFyc2VyLm8gXAotCSAgaTkxNV9nZW1fYmF0Y2hfcG9vbC5vIFwKIAkgIGk5MTVfZ2VtX2V2
aWN0Lm8gXAogCSAgaTkxNV9nZW1fZmVuY2VfcmVnLm8gXAogCSAgaTkxNV9nZW1fZ3R0Lm8gXApk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKaW5kZXgg
ZGQ1ZGYxODAxMDliLi4zNTA2YWFmYWRhNmMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYwpAQCAtMTYsNiArMTYsNyBAQAogCiAjaW5jbHVkZSAi
Z2VtL2k5MTVfZ2VtX2lvY3Rscy5oIgogI2luY2x1ZGUgImd0L2ludGVsX2NvbnRleHQuaCIKKyNp
bmNsdWRlICJndC9pbnRlbF9lbmdpbmVfcG9vbC5oIgogI2luY2x1ZGUgImd0L2ludGVsX2d0Lmgi
CiAjaW5jbHVkZSAiZ3QvaW50ZWxfZ3RfcG0uaCIKIApAQCAtMTE0NSwyNSArMTE0NiwyNiBAQCBz
dGF0aWMgaW50IF9fcmVsb2NfZ3B1X2FsbG9jKHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViLAog
CQkJICAgICB1bnNpZ25lZCBpbnQgbGVuKQogewogCXN0cnVjdCByZWxvY19jYWNoZSAqY2FjaGUg
PSAmZWItPnJlbG9jX2NhY2hlOwotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CisJ
c3RydWN0IGludGVsX2VuZ2luZV9wb29sX25vZGUgKnBvb2w7CiAJc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnE7CiAJc3RydWN0IGk5MTVfdm1hICpiYXRjaDsKIAl1MzIgKmNtZDsKIAlpbnQgZXJyOwog
Ci0Jb2JqID0gaTkxNV9nZW1fYmF0Y2hfcG9vbF9nZXQoJmViLT5lbmdpbmUtPmJhdGNoX3Bvb2ws
IFBBR0VfU0laRSk7Ci0JaWYgKElTX0VSUihvYmopKQotCQlyZXR1cm4gUFRSX0VSUihvYmopOwor
CXBvb2wgPSBpbnRlbF9lbmdpbmVfcG9vbF9nZXQoJmViLT5lbmdpbmUtPnBvb2wsIFBBR0VfU0la
RSk7CisJaWYgKElTX0VSUihwb29sKSkKKwkJcmV0dXJuIFBUUl9FUlIocG9vbCk7CiAKLQljbWQg
PSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChvYmosCisJY21kID0gaTkxNV9nZW1fb2JqZWN0X3Bp
bl9tYXAocG9vbC0+b2JqLAogCQkJCSAgICAgIGNhY2hlLT5oYXNfbGxjID8KIAkJCQkgICAgICBJ
OTE1X01BUF9GT1JDRV9XQiA6CiAJCQkJICAgICAgSTkxNV9NQVBfRk9SQ0VfV0MpOwotCWk5MTVf
Z2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmopOwotCWlmIChJU19FUlIoY21kKSkKLQkJcmV0dXJu
IFBUUl9FUlIoY21kKTsKKwlpZiAoSVNfRVJSKGNtZCkpIHsKKwkJZXJyID0gUFRSX0VSUihjbWQp
OworCQlnb3RvIG91dF9wb29sOworCX0KIAotCWJhdGNoID0gaTkxNV92bWFfaW5zdGFuY2Uob2Jq
LCB2bWEtPnZtLCBOVUxMKTsKKwliYXRjaCA9IGk5MTVfdm1hX2luc3RhbmNlKHBvb2wtPm9iaiwg
dm1hLT52bSwgTlVMTCk7CiAJaWYgKElTX0VSUihiYXRjaCkpIHsKIAkJZXJyID0gUFRSX0VSUihi
YXRjaCk7CiAJCWdvdG8gZXJyX3VubWFwOwpAQCAtMTE3OSw2ICsxMTgxLDEwIEBAIHN0YXRpYyBp
bnQgX19yZWxvY19ncHVfYWxsb2Moc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsCiAJCWdvdG8g
ZXJyX3VucGluOwogCX0KIAorCWVyciA9IGludGVsX2VuZ2luZV9wb29sX21hcmtfYWN0aXZlKHBv
b2wsIHJxKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl9yZXF1ZXN0OworCiAJZXJyID0gcmVsb2Nf
bW92ZV90b19ncHUocnEsIHZtYSk7CiAJaWYgKGVycikKIAkJZ290byBlcnJfcmVxdWVzdDsKQEAg
LTEyMDQsNyArMTIxMCw3IEBAIHN0YXRpYyBpbnQgX19yZWxvY19ncHVfYWxsb2Moc3RydWN0IGk5
MTVfZXhlY2J1ZmZlciAqZWIsCiAJY2FjaGUtPnJxX3NpemUgPSAwOwogCiAJLyogUmV0dXJuIHdp
dGggYmF0Y2ggbWFwcGluZyAoY21kKSBzdGlsbCBwaW5uZWQgKi8KLQlyZXR1cm4gMDsKKwlnb3Rv
IG91dF9wb29sOwogCiBza2lwX3JlcXVlc3Q6CiAJaTkxNV9yZXF1ZXN0X3NraXAocnEsIGVycik7
CkBAIC0xMjEzLDcgKzEyMTksOSBAQCBzdGF0aWMgaW50IF9fcmVsb2NfZ3B1X2FsbG9jKHN0cnVj
dCBpOTE1X2V4ZWNidWZmZXIgKmViLAogZXJyX3VucGluOgogCWk5MTVfdm1hX3VucGluKGJhdGNo
KTsKIGVycl91bm1hcDoKLQlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKG9iaik7CisJaTkxNV9n
ZW1fb2JqZWN0X3VucGluX21hcChwb29sLT5vYmopOworb3V0X3Bvb2w6CisJaW50ZWxfZW5naW5l
X3Bvb2xfcHV0KHBvb2wpOwogCXJldHVybiBlcnI7CiB9CiAKQEAgLTE5NTcsMTggKzE5NjUsMTcg
QEAgc3RhdGljIGludCBpOTE1X3Jlc2V0X2dlbjdfc29sX29mZnNldHMoc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnEpCiAKIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKmViX3BhcnNlKHN0cnVjdCBpOTE1
X2V4ZWNidWZmZXIgKmViLCBib29sIGlzX21hc3RlcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqc2hhZG93X2JhdGNoX29iajsKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX3Bvb2xfbm9k
ZSAqcG9vbDsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAlpbnQgZXJyOwogCi0Jc2hhZG93X2Jh
dGNoX29iaiA9IGk5MTVfZ2VtX2JhdGNoX3Bvb2xfZ2V0KCZlYi0+ZW5naW5lLT5iYXRjaF9wb29s
LAotCQkJCQkJICAgUEFHRV9BTElHTihlYi0+YmF0Y2hfbGVuKSk7Ci0JaWYgKElTX0VSUihzaGFk
b3dfYmF0Y2hfb2JqKSkKLQkJcmV0dXJuIEVSUl9DQVNUKHNoYWRvd19iYXRjaF9vYmopOworCXBv
b2wgPSBpbnRlbF9lbmdpbmVfcG9vbF9nZXQoJmViLT5lbmdpbmUtPnBvb2wsIGViLT5iYXRjaF9s
ZW4pOworCWlmIChJU19FUlIocG9vbCkpCisJCXJldHVybiBFUlJfQ0FTVChwb29sKTsKIAogCWVy
ciA9IGludGVsX2VuZ2luZV9jbWRfcGFyc2VyKGViLT5lbmdpbmUsCiAJCQkJICAgICAgZWItPmJh
dGNoLT5vYmosCi0JCQkJICAgICAgc2hhZG93X2JhdGNoX29iaiwKKwkJCQkgICAgICBwb29sLT5v
YmosCiAJCQkJICAgICAgZWItPmJhdGNoX3N0YXJ0X29mZnNldCwKIAkJCQkgICAgICBlYi0+YmF0
Y2hfbGVuLAogCQkJCSAgICAgIGlzX21hc3Rlcik7CkBAIC0xOTc3LDEyICsxOTg0LDEyIEBAIHN0
YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKmViX3BhcnNlKHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmVi
LCBib29sIGlzX21hc3RlcikKIAkJCXZtYSA9IE5VTEw7CiAJCWVsc2UKIAkJCXZtYSA9IEVSUl9Q
VFIoZXJyKTsKLQkJZ290byBvdXQ7CisJCWdvdG8gZXJyOwogCX0KIAotCXZtYSA9IGk5MTVfZ2Vt
X29iamVjdF9nZ3R0X3BpbihzaGFkb3dfYmF0Y2hfb2JqLCBOVUxMLCAwLCAwLCAwKTsKKwl2bWEg
PSBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4ocG9vbC0+b2JqLCBOVUxMLCAwLCAwLCAwKTsKIAlp
ZiAoSVNfRVJSKHZtYSkpCi0JCWdvdG8gb3V0OworCQlnb3RvIGVycjsKIAogCWViLT52bWFbZWIt
PmJ1ZmZlcl9jb3VudF0gPSBpOTE1X3ZtYV9nZXQodm1hKTsKIAllYi0+ZmxhZ3NbZWItPmJ1ZmZl
cl9jb3VudF0gPQpAQCAtMTk5MCw4ICsxOTk3LDExIEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEg
KmViX3BhcnNlKHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViLCBib29sIGlzX21hc3RlcikKIAl2
bWEtPmV4ZWNfZmxhZ3MgPSAmZWItPmZsYWdzW2ViLT5idWZmZXJfY291bnRdOwogCWViLT5idWZm
ZXJfY291bnQrKzsKIAotb3V0OgotCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhzaGFkb3df
YmF0Y2hfb2JqKTsKKwl2bWEtPnByaXZhdGUgPSBwb29sOworCXJldHVybiB2bWE7CisKK2VycjoK
KwlpbnRlbF9lbmdpbmVfcG9vbF9wdXQocG9vbCk7CiAJcmV0dXJuIHZtYTsKIH0KIApAQCAtMjYx
NSw2ICsyNjI1LDggQEAgaTkxNV9nZW1fZG9fZXhlY2J1ZmZlcihzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2LAogCSAqIHRvIGV4cGxpY2l0bHkgaG9sZCBhbm90aGVyIHJlZmVyZW5jZSBoZXJlLgogCSAq
LwogCWViLnJlcXVlc3QtPmJhdGNoID0gZWIuYmF0Y2g7CisJaWYgKGViLmJhdGNoLT5wcml2YXRl
KQorCQlpbnRlbF9lbmdpbmVfcG9vbF9tYXJrX2FjdGl2ZShlYi5iYXRjaC0+cHJpdmF0ZSwgZWIu
cmVxdWVzdCk7CiAKIAl0cmFjZV9pOTE1X3JlcXVlc3RfcXVldWUoZWIucmVxdWVzdCwgZWIuYmF0
Y2hfZmxhZ3MpOwogCWVyciA9IGViX3N1Ym1pdCgmZWIpOwpAQCAtMjYzOSw2ICsyNjUxLDggQEAg
aTkxNV9nZW1fZG9fZXhlY2J1ZmZlcihzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogZXJyX2JhdGNo
X3VucGluOgogCWlmIChlYi5iYXRjaF9mbGFncyAmIEk5MTVfRElTUEFUQ0hfU0VDVVJFKQogCQlp
OTE1X3ZtYV91bnBpbihlYi5iYXRjaCk7CisJaWYgKGViLmJhdGNoLT5wcml2YXRlKQorCQlpbnRl
bF9lbmdpbmVfcG9vbF9wdXQoZWIuYmF0Y2gtPnByaXZhdGUpOwogZXJyX3ZtYToKIAlpZiAoZWIu
ZXhlYykKIAkJZWJfcmVsZWFzZV92bWFzKCZlYik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fb2JqZWN0LmMKaW5kZXggNGVhOTdmY2E5YzM1Li5lY2NkN2Y0NzY4ZjggMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMKQEAgLTY2LDcgKzY2LDYg
QEAgdm9pZCBpOTE1X2dlbV9vYmplY3RfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqLAogCUlOSVRfTElTVF9IRUFEKCZvYmotPm1tLmxpbmspOwogCiAJSU5JVF9MSVNUX0hFQUQo
Jm9iai0+bHV0X2xpc3QpOwotCUlOSVRfTElTVF9IRUFEKCZvYmotPmJhdGNoX3Bvb2xfbGluayk7
CiAKIAlpbml0X3JjdV9oZWFkKCZvYmotPnJjdSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaAppbmRleCAzNGI1MWZhZDAyZGUuLmQ0NzRj
NmFjNDEwMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29i
amVjdF90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmpl
Y3RfdHlwZXMuaApAQCAtMTE0LDcgKzExNCw2IEBAIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
IHsKIAl1bnNpZ25lZCBpbnQgdXNlcmZhdWx0X2NvdW50OwogCXN0cnVjdCBsaXN0X2hlYWQgdXNl
cmZhdWx0X2xpbms7CiAKLQlzdHJ1Y3QgbGlzdF9oZWFkIGJhdGNoX3Bvb2xfbGluazsKIAlJOTE1
X1NFTEZURVNUX0RFQ0xBUkUoc3RydWN0IGxpc3RfaGVhZCBzdF9saW5rKTsKIAogCS8qCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCmluZGV4IDE5NWVlNmVlZGFjMC4uY2I3YTg1
YWM2OWQwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0u
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYwpAQCAtMzQsMTAg
KzM0LDggQEAgc3RhdGljIHZvaWQgaTkxNV9nZW1fcGFyayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKIAogCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwogCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKKwlmb3JfZWFjaF9lbmdp
bmUoZW5naW5lLCBpOTE1LCBpZCkKIAkJY2FsbF9pZGxlX2JhcnJpZXJzKGVuZ2luZSk7IC8qIGNs
ZWFudXAgYWZ0ZXIgd2VkZ2luZyAqLwotCQlpOTE1X2dlbV9iYXRjaF9wb29sX2ZpbmkoJmVuZ2lu
ZS0+YmF0Y2hfcG9vbCk7Ci0JfQogCiAJaTkxNV92bWFfcGFya2VkKGk5MTUpOwogCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmUuaCBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZS5oCmluZGV4IDMwODU2MzgzZTRjNS4uNTJmMjllNjE4
Njk2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmUuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmUuaApAQCAtOSw3ICs5LDYg
QEAKICNpbmNsdWRlIDxsaW51eC9yYW5kb20uaD4KICNpbmNsdWRlIDxsaW51eC9zZXFsb2NrLmg+
CiAKLSNpbmNsdWRlICJpOTE1X2dlbV9iYXRjaF9wb29sLmgiCiAjaW5jbHVkZSAiaTkxNV9wbXUu
aCIKICNpbmNsdWRlICJpOTE1X3JlZy5oIgogI2luY2x1ZGUgImk5MTVfcmVxdWVzdC5oIgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYwppbmRleCAxZjVhYzA0NWE4ZDgu
LjgwMDcxNDZhNmNmMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
ZW5naW5lX2NzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2Nz
LmMKQEAgLTMyLDYgKzMyLDcgQEAKIAogI2luY2x1ZGUgImludGVsX2VuZ2luZS5oIgogI2luY2x1
ZGUgImludGVsX2VuZ2luZV9wbS5oIgorI2luY2x1ZGUgImludGVsX2VuZ2luZV9wb29sLmgiCiAj
aW5jbHVkZSAiaW50ZWxfZW5naW5lX3VzZXIuaCIKICNpbmNsdWRlICJpbnRlbF9jb250ZXh0Lmgi
CiAjaW5jbHVkZSAiaW50ZWxfbHJjLmgiCkBAIC00OTMsMTEgKzQ5NCw2IEBAIGludCBpbnRlbF9l
bmdpbmVzX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJcmV0dXJuIGVycjsK
IH0KIAotc3RhdGljIHZvaWQgaW50ZWxfZW5naW5lX2luaXRfYmF0Y2hfcG9vbChzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUpCi17Ci0JaTkxNV9nZW1fYmF0Y2hfcG9vbF9pbml0KCZlbmdp
bmUtPmJhdGNoX3Bvb2wsIGVuZ2luZSk7Ci19Ci0KIHZvaWQgaW50ZWxfZW5naW5lX2luaXRfZXhl
Y2xpc3RzKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKIAlzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2V4ZWNsaXN0cyAqIGNvbnN0IGV4ZWNsaXN0cyA9ICZlbmdpbmUtPmV4ZWNsaXN0czsK
QEAgLTYyMywxMCArNjE5LDExIEBAIHN0YXRpYyBpbnQgaW50ZWxfZW5naW5lX3NldHVwX2NvbW1v
bihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJaW50ZWxfZW5naW5lX2luaXRfYnJl
YWRjcnVtYnMoZW5naW5lKTsKIAlpbnRlbF9lbmdpbmVfaW5pdF9leGVjbGlzdHMoZW5naW5lKTsK
IAlpbnRlbF9lbmdpbmVfaW5pdF9oYW5nY2hlY2soZW5naW5lKTsKLQlpbnRlbF9lbmdpbmVfaW5p
dF9iYXRjaF9wb29sKGVuZ2luZSk7CiAJaW50ZWxfZW5naW5lX2luaXRfY21kX3BhcnNlcihlbmdp
bmUpOwogCWludGVsX2VuZ2luZV9pbml0X19wbShlbmdpbmUpOwogCisJaW50ZWxfZW5naW5lX3Bv
b2xfaW5pdCgmZW5naW5lLT5wb29sKTsKKwogCS8qIFVzZSB0aGUgd2hvbGUgZGV2aWNlIGJ5IGRl
ZmF1bHQgKi8KIAllbmdpbmUtPnNzZXUgPQogCQlpbnRlbF9zc2V1X2Zyb21fZGV2aWNlX2luZm8o
JlJVTlRJTUVfSU5GTyhlbmdpbmUtPmk5MTUpLT5zc2V1KTsKQEAgLTg2OSw5ICs4NjYsOSBAQCB2
b2lkIGludGVsX2VuZ2luZV9jbGVhbnVwX2NvbW1vbihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpl
bmdpbmUpCiAKIAljbGVhbnVwX3N0YXR1c19wYWdlKGVuZ2luZSk7CiAKKwlpbnRlbF9lbmdpbmVf
cG9vbF9maW5pKCZlbmdpbmUtPnBvb2wpOwogCWludGVsX2VuZ2luZV9maW5pX2JyZWFkY3J1bWJz
KGVuZ2luZSk7CiAJaW50ZWxfZW5naW5lX2NsZWFudXBfY21kX3BhcnNlcihlbmdpbmUpOwotCWk5
MTVfZ2VtX2JhdGNoX3Bvb2xfZmluaSgmZW5naW5lLT5iYXRjaF9wb29sKTsKIAogCWlmIChlbmdp
bmUtPmRlZmF1bHRfc3RhdGUpCiAJCWk5MTVfZ2VtX29iamVjdF9wdXQoZW5naW5lLT5kZWZhdWx0
X3N0YXRlKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2lu
ZV9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMKaW5kZXgg
MDcyZjY1ZTZhMDllLi43NmM4MjhkMTFiMDUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2VuZ2luZV9wbS5jCkBAIC03LDYgKzcsNyBAQAogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAK
ICNpbmNsdWRlICJpbnRlbF9lbmdpbmUuaCIKKyNpbmNsdWRlICJpbnRlbF9lbmdpbmVfcG9vbC5o
IgogI2luY2x1ZGUgImludGVsX2VuZ2luZV9wbS5oIgogI2luY2x1ZGUgImludGVsX2d0LmgiCiAj
aW5jbHVkZSAiaW50ZWxfZ3RfcG0uaCIKQEAgLTExNyw2ICsxMTgsNyBAQCBzdGF0aWMgaW50IF9f
ZW5naW5lX3Bhcmsoc3RydWN0IGludGVsX3dha2VyZWYgKndmKQogCUdFTV9UUkFDRSgiJXNcbiIs
IGVuZ2luZS0+bmFtZSk7CiAKIAlpbnRlbF9lbmdpbmVfZGlzYXJtX2JyZWFkY3J1bWJzKGVuZ2lu
ZSk7CisJaW50ZWxfZW5naW5lX3Bvb2xfcGFyaygmZW5naW5lLT5wb29sKTsKIAogCS8qIE11c3Qg
YmUgcmVzZXQgdXBvbiBpZGxpbmcsIG9yIHdlIG1heSBtaXNzIHRoZSBidXN5IHdha2V1cC4gKi8K
IAlHRU1fQlVHX09OKGVuZ2luZS0+ZXhlY2xpc3RzLnF1ZXVlX3ByaW9yaXR5X2hpbnQgIT0gSU5U
X01JTik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVf
cG9vbC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3Bvb2wuYwpuZXcg
ZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjAzZDkwYjQ5NTg0YQotLS0gL2Rl
di9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sLmMK
QEAgLTAsMCArMSwxNzcgQEAKKy8qCisgKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUCisg
KgorICogQ29weXJpZ2h0IMKpIDIwMTQtMjAxOCBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNp
bmNsdWRlICJnZW0vaTkxNV9nZW1fb2JqZWN0LmgiCisKKyNpbmNsdWRlICJpOTE1X2Rydi5oIgor
I2luY2x1ZGUgImludGVsX2VuZ2luZV9wbS5oIgorI2luY2x1ZGUgImludGVsX2VuZ2luZV9wb29s
LmgiCisKK3N0YXRpYyBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICp0b19lbmdpbmUoc3RydWN0IGlu
dGVsX2VuZ2luZV9wb29sICpwb29sKQoreworCXJldHVybiBjb250YWluZXJfb2YocG9vbCwgc3Ry
dWN0IGludGVsX2VuZ2luZV9jcywgcG9vbCk7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgbGlzdF9oZWFk
ICoKK2J1Y2tldF9mb3Jfc2l6ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX3Bvb2wgKnBvb2wsIHNpemVf
dCBzeikKK3sKKwlpbnQgbjsKKworCS8qCisJICogQ29tcHV0ZSBhIHBvd2VyLW9mLXR3byBidWNr
ZXQsIGJ1dCB0aHJvdyBldmVyeXRoaW5nIGdyZWF0ZXIgdGhhbgorCSAqIDE2S2lCIGludG8gdGhl
IHNhbWUgYnVja2V0OiBpLmUuIHRoZSBidWNrZXRzIGhvbGQgb2JqZWN0cyBvZgorCSAqICgxIHBh
Z2UsIDIgcGFnZXMsIDQgcGFnZXMsIDgrIHBhZ2VzKS4KKwkgKi8KKwluID0gZmxzKHN6ID4+IFBB
R0VfU0hJRlQpIC0gMTsKKwlpZiAobiA+PSBBUlJBWV9TSVpFKHBvb2wtPmNhY2hlX2xpc3QpKQor
CQluID0gQVJSQVlfU0laRShwb29sLT5jYWNoZV9saXN0KSAtIDE7CisKKwlyZXR1cm4gJnBvb2wt
PmNhY2hlX2xpc3Rbbl07Cit9CisKK3N0YXRpYyB2b2lkIG5vZGVfZnJlZShzdHJ1Y3QgaW50ZWxf
ZW5naW5lX3Bvb2xfbm9kZSAqbm9kZSkKK3sKKwlpOTE1X2dlbV9vYmplY3RfcHV0KG5vZGUtPm9i
aik7CisJaTkxNV9hY3RpdmVfZmluaSgmbm9kZS0+YWN0aXZlKTsKKwlrZnJlZShub2RlKTsKK30K
Kworc3RhdGljIGludCBwb29sX2FjdGl2ZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKK3sKKwlz
dHJ1Y3QgaW50ZWxfZW5naW5lX3Bvb2xfbm9kZSAqbm9kZSA9CisJCWNvbnRhaW5lcl9vZihyZWYs
IHR5cGVvZigqbm9kZSksIGFjdGl2ZSk7CisJc3RydWN0IHJlc2VydmF0aW9uX29iamVjdCAqcmVz
diA9IG5vZGUtPm9iai0+YmFzZS5yZXN2OworCWludCBlcnI7CisKKwlpZiAocmVzZXJ2YXRpb25f
b2JqZWN0X3RyeWxvY2socmVzdikpIHsKKwkJcmVzZXJ2YXRpb25fb2JqZWN0X2FkZF9leGNsX2Zl
bmNlKHJlc3YsIE5VTEwpOworCQlyZXNlcnZhdGlvbl9vYmplY3RfdW5sb2NrKHJlc3YpOworCX0K
KworCWVyciA9IGk5MTVfZ2VtX29iamVjdF9waW5fcGFnZXMobm9kZS0+b2JqKTsKKwlpZiAoZXJy
KQorCQlyZXR1cm4gZXJyOworCisJLyogSGlkZSB0aGlzIHBpbm5lZCBvYmplY3QgZnJvbSB0aGUg
c2hyaW5rZXIgdW50aWwgcmV0aXJlZCAqLworCWk5MTVfZ2VtX29iamVjdF9tYWtlX3Vuc2hyaW5r
YWJsZShub2RlLT5vYmopOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIHBvb2xfcmV0
aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQoreworCXN0cnVjdCBpbnRlbF9lbmdpbmVfcG9v
bF9ub2RlICpub2RlID0KKwkJY29udGFpbmVyX29mKHJlZiwgdHlwZW9mKCpub2RlKSwgYWN0aXZl
KTsKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX3Bvb2wgKnBvb2wgPSBub2RlLT5wb29sOworCXN0cnVj
dCBsaXN0X2hlYWQgKmxpc3QgPSBidWNrZXRfZm9yX3NpemUocG9vbCwgbm9kZS0+b2JqLT5iYXNl
LnNpemUpOworCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKKwlHRU1fQlVHX09OKCFpbnRlbF9lbmdp
bmVfcG1faXNfYXdha2UodG9fZW5naW5lKHBvb2wpKSk7CisKKwlpOTE1X2dlbV9vYmplY3RfdW5w
aW5fcGFnZXMobm9kZS0+b2JqKTsKKworCS8qIFJldHVybiB0aGlzIG9iamVjdCB0byB0aGUgc2hy
aW5rZXIgcG9vbCAqLworCWk5MTVfZ2VtX29iamVjdF9tYWtlX3B1cmdlYWJsZShub2RlLT5vYmop
OworCisJc3Bpbl9sb2NrX2lycXNhdmUoJnBvb2wtPmxvY2ssIGZsYWdzKTsKKwlsaXN0X2FkZCgm
bm9kZS0+bGluaywgbGlzdCk7CisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmcG9vbC0+bG9jaywg
ZmxhZ3MpOworfQorCitzdGF0aWMgc3RydWN0IGludGVsX2VuZ2luZV9wb29sX25vZGUgKgorbm9k
ZV9jcmVhdGUoc3RydWN0IGludGVsX2VuZ2luZV9wb29sICpwb29sLCBzaXplX3Qgc3opCit7CisJ
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lID0gdG9fZW5naW5lKHBvb2wpOworCXN0cnVj
dCBpbnRlbF9lbmdpbmVfcG9vbF9ub2RlICpub2RlOworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmo7CisKKwlub2RlID0ga21hbGxvYyhzaXplb2YoKm5vZGUpLAorCQkgICAgICAgR0ZQ
X0tFUk5FTCB8IF9fR0ZQX1JFVFJZX01BWUZBSUwgfCBfX0dGUF9OT1dBUk4pOworCWlmICghbm9k
ZSkKKwkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisKKwlub2RlLT5wb29sID0gcG9vbDsKKwlp
OTE1X2FjdGl2ZV9pbml0KGVuZ2luZS0+aTkxNSwgJm5vZGUtPmFjdGl2ZSwgcG9vbF9hY3RpdmUs
IHBvb2xfcmV0aXJlKTsKKworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwo
ZW5naW5lLT5pOTE1LCBzeik7CisJaWYgKElTX0VSUihvYmopKSB7CisJCWk5MTVfYWN0aXZlX2Zp
bmkoJm5vZGUtPmFjdGl2ZSk7CisJCWtmcmVlKG5vZGUpOworCQlyZXR1cm4gRVJSX0NBU1Qob2Jq
KTsKKwl9CisKKwlub2RlLT5vYmogPSBvYmo7CisJcmV0dXJuIG5vZGU7Cit9CisKK3N0cnVjdCBp
bnRlbF9lbmdpbmVfcG9vbF9ub2RlICoKK2ludGVsX2VuZ2luZV9wb29sX2dldChzdHJ1Y3QgaW50
ZWxfZW5naW5lX3Bvb2wgKnBvb2wsIHNpemVfdCBzaXplKQoreworCXN0cnVjdCBpbnRlbF9lbmdp
bmVfcG9vbF9ub2RlICpub2RlOworCXN0cnVjdCBsaXN0X2hlYWQgKmxpc3Q7CisJdW5zaWduZWQg
bG9uZyBmbGFnczsKKwlpbnQgcmV0OworCisJR0VNX0JVR19PTighaW50ZWxfZW5naW5lX3BtX2lz
X2F3YWtlKHRvX2VuZ2luZShwb29sKSkpOworCisJc2l6ZSA9IFBBR0VfQUxJR04oc2l6ZSk7CisJ
bGlzdCA9IGJ1Y2tldF9mb3Jfc2l6ZShwb29sLCBzaXplKTsKKworCXNwaW5fbG9ja19pcnFzYXZl
KCZwb29sLT5sb2NrLCBmbGFncyk7CisJbGlzdF9mb3JfZWFjaF9lbnRyeShub2RlLCBsaXN0LCBs
aW5rKSB7CisJCWlmIChub2RlLT5vYmotPmJhc2Uuc2l6ZSA8IHNpemUpCisJCQljb250aW51ZTsK
KwkJbGlzdF9kZWwoJm5vZGUtPmxpbmspOworCQlicmVhazsKKwl9CisJc3Bpbl91bmxvY2tfaXJx
cmVzdG9yZSgmcG9vbC0+bG9jaywgZmxhZ3MpOworCisJaWYgKCZub2RlLT5saW5rID09IGxpc3Qp
IHsKKwkJbm9kZSA9IG5vZGVfY3JlYXRlKHBvb2wsIHNpemUpOworCQlpZiAoSVNfRVJSKG5vZGUp
KQorCQkJcmV0dXJuIG5vZGU7CisJfQorCisJcmV0ID0gaTkxNV9hY3RpdmVfYWNxdWlyZSgmbm9k
ZS0+YWN0aXZlKTsKKwlpZiAocmV0KSB7CisJCW5vZGVfZnJlZShub2RlKTsKKwkJcmV0dXJuIEVS
Ul9QVFIocmV0KTsKKwl9CisKKwlyZXR1cm4gbm9kZTsKK30KKwordm9pZCBpbnRlbF9lbmdpbmVf
cG9vbF9pbml0KHN0cnVjdCBpbnRlbF9lbmdpbmVfcG9vbCAqcG9vbCkKK3sKKwlpbnQgbjsKKwor
CXNwaW5fbG9ja19pbml0KCZwb29sLT5sb2NrKTsKKwlmb3IgKG4gPSAwOyBuIDwgQVJSQVlfU0la
RShwb29sLT5jYWNoZV9saXN0KTsgbisrKQorCQlJTklUX0xJU1RfSEVBRCgmcG9vbC0+Y2FjaGVf
bGlzdFtuXSk7Cit9CisKK3ZvaWQgaW50ZWxfZW5naW5lX3Bvb2xfcGFyayhzdHJ1Y3QgaW50ZWxf
ZW5naW5lX3Bvb2wgKnBvb2wpCit7CisJaW50IG47CisKKwlmb3IgKG4gPSAwOyBuIDwgQVJSQVlf
U0laRShwb29sLT5jYWNoZV9saXN0KTsgbisrKSB7CisJCXN0cnVjdCBsaXN0X2hlYWQgKmxpc3Qg
PSAmcG9vbC0+Y2FjaGVfbGlzdFtuXTsKKwkJc3RydWN0IGludGVsX2VuZ2luZV9wb29sX25vZGUg
Km5vZGUsICpubjsKKworCQlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUobm9kZSwgbm4sIGxpc3Qs
IGxpbmspCisJCQlub2RlX2ZyZWUobm9kZSk7CisKKwkJSU5JVF9MSVNUX0hFQUQobGlzdCk7CisJ
fQorfQorCit2b2lkIGludGVsX2VuZ2luZV9wb29sX2Zpbmkoc3RydWN0IGludGVsX2VuZ2luZV9w
b29sICpwb29sKQoreworCWludCBuOworCisJZm9yIChuID0gMDsgbiA8IEFSUkFZX1NJWkUocG9v
bC0+Y2FjaGVfbGlzdCk7IG4rKykKKwkJR0VNX0JVR19PTighbGlzdF9lbXB0eSgmcG9vbC0+Y2Fj
aGVfbGlzdFtuXSkpOworfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfZW5naW5lX3Bvb2wuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9w
b29sLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5mN2EwYTY2MGMx
YzkKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdp
bmVfcG9vbC5oCkBAIC0wLDAgKzEsMzQgQEAKKy8qCisgKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmll
cjogTUlUCisgKgorICogQ29weXJpZ2h0IMKpIDIwMTQtMjAxOCBJbnRlbCBDb3Jwb3JhdGlvbgor
ICovCisKKyNpZm5kZWYgSU5URUxfRU5HSU5FX1BPT0xfSAorI2RlZmluZSBJTlRFTF9FTkdJTkVf
UE9PTF9ICisKKyNpbmNsdWRlICJpbnRlbF9lbmdpbmVfcG9vbF90eXBlcy5oIgorI2luY2x1ZGUg
Imk5MTVfYWN0aXZlLmgiCisjaW5jbHVkZSAiaTkxNV9yZXF1ZXN0LmgiCisKK3N0cnVjdCBpbnRl
bF9lbmdpbmVfcG9vbF9ub2RlICoKK2ludGVsX2VuZ2luZV9wb29sX2dldChzdHJ1Y3QgaW50ZWxf
ZW5naW5lX3Bvb2wgKnBvb2wsIHNpemVfdCBzaXplKTsKKworc3RhdGljIGlubGluZSBpbnQKK2lu
dGVsX2VuZ2luZV9wb29sX21hcmtfYWN0aXZlKHN0cnVjdCBpbnRlbF9lbmdpbmVfcG9vbF9ub2Rl
ICpub2RlLAorCQkJICAgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCit7CisJcmV0dXJuIGk5
MTVfYWN0aXZlX3JlZigmbm9kZS0+YWN0aXZlLCBycS0+ZmVuY2UuY29udGV4dCwgcnEpOworfQor
CitzdGF0aWMgaW5saW5lIHZvaWQKK2ludGVsX2VuZ2luZV9wb29sX3B1dChzdHJ1Y3QgaW50ZWxf
ZW5naW5lX3Bvb2xfbm9kZSAqbm9kZSkKK3sKKwlpOTE1X2FjdGl2ZV9yZWxlYXNlKCZub2RlLT5h
Y3RpdmUpOworfQorCit2b2lkIGludGVsX2VuZ2luZV9wb29sX2luaXQoc3RydWN0IGludGVsX2Vu
Z2luZV9wb29sICpwb29sKTsKK3ZvaWQgaW50ZWxfZW5naW5lX3Bvb2xfcGFyayhzdHJ1Y3QgaW50
ZWxfZW5naW5lX3Bvb2wgKnBvb2wpOwordm9pZCBpbnRlbF9lbmdpbmVfcG9vbF9maW5pKHN0cnVj
dCBpbnRlbF9lbmdpbmVfcG9vbCAqcG9vbCk7CisKKyNlbmRpZiAvKiBJTlRFTF9FTkdJTkVfUE9P
TF9IICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVf
cG9vbF90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3Bvb2xf
dHlwZXMuaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmUzMWVlMzYx
Yjc2ZgotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Vu
Z2luZV9wb29sX3R5cGVzLmgKQEAgLTAsMCArMSwyOSBAQAorLyoKKyAqIFNQRFgtTGljZW5zZS1J
ZGVudGlmaWVyOiBNSVQKKyAqCisgKiBDb3B5cmlnaHQgwqkgMjAxNC0yMDE4IEludGVsIENvcnBv
cmF0aW9uCisgKi8KKworI2lmbmRlZiBJTlRFTF9FTkdJTkVfUE9PTF9UWVBFU19ICisjZGVmaW5l
IElOVEVMX0VOR0lORV9QT09MX1RZUEVTX0gKKworI2luY2x1ZGUgPGxpbnV4L2xpc3QuaD4KKyNp
bmNsdWRlIDxsaW51eC9zcGlubG9jay5oPgorCisjaW5jbHVkZSAiaTkxNV9hY3RpdmVfdHlwZXMu
aCIKKworc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Q7CisKK3N0cnVjdCBpbnRlbF9lbmdpbmVf
cG9vbCB7CisJc3BpbmxvY2tfdCBsb2NrOworCXN0cnVjdCBsaXN0X2hlYWQgY2FjaGVfbGlzdFs0
XTsKK307CisKK3N0cnVjdCBpbnRlbF9lbmdpbmVfcG9vbF9ub2RlIHsKKwlzdHJ1Y3QgaTkxNV9h
Y3RpdmUgYWN0aXZlOworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CisJc3RydWN0
IGxpc3RfaGVhZCBsaW5rOworCXN0cnVjdCBpbnRlbF9lbmdpbmVfcG9vbCAqcG9vbDsKK307CisK
KyNlbmRpZiAvKiBJTlRFTF9FTkdJTkVfUE9PTF9UWVBFU19IICovCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5oCmluZGV4IDg3ZWFiN2QxM2M4Yy4uMWRhOGQy
ZjM0YzU2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVf
dHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMu
aApAQCAtMTcsMTIgKzE3LDEyIEBACiAjaW5jbHVkZSA8bGludXgvdHlwZXMuaD4KIAogI2luY2x1
ZGUgImk5MTVfZ2VtLmgiCi0jaW5jbHVkZSAiaTkxNV9nZW1fYmF0Y2hfcG9vbC5oIgogI2luY2x1
ZGUgImk5MTVfcG11LmgiCiAjaW5jbHVkZSAiaTkxNV9wcmlvbGlzdF90eXBlcy5oIgogI2luY2x1
ZGUgImk5MTVfc2VsZnRlc3QuaCIKLSNpbmNsdWRlICJndC9pbnRlbF90aW1lbGluZV90eXBlcy5o
IgorI2luY2x1ZGUgImludGVsX2VuZ2luZV9wb29sX3R5cGVzLmgiCiAjaW5jbHVkZSAiaW50ZWxf
c3NldS5oIgorI2luY2x1ZGUgImludGVsX3RpbWVsaW5lX3R5cGVzLmgiCiAjaW5jbHVkZSAiaW50
ZWxfd2FrZXJlZi5oIgogI2luY2x1ZGUgImludGVsX3dvcmthcm91bmRzX3R5cGVzLmgiCiAKQEAg
LTM1NSw3ICszNTUsNyBAQCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzIHsKIAkgKiB3aGVuIHRoZSBj
b21tYW5kIHBhcnNlciBpcyBlbmFibGVkLiBQcmV2ZW50cyB0aGUgY2xpZW50IGZyb20KIAkgKiBt
b2RpZnlpbmcgdGhlIGJhdGNoIGNvbnRlbnRzIGFmdGVyIHNvZnR3YXJlIHBhcnNpbmcuCiAJICov
Ci0Jc3RydWN0IGk5MTVfZ2VtX2JhdGNoX3Bvb2wgYmF0Y2hfcG9vbDsKKwlzdHJ1Y3QgaW50ZWxf
ZW5naW5lX3Bvb2wgcG9vbDsKIAogCXN0cnVjdCBpbnRlbF9od19zdGF0dXNfcGFnZSBzdGF0dXNf
cGFnZTsKIAlzdHJ1Y3QgaTkxNV9jdHhfd29ya2Fyb3VuZHMgd2FfY3R4OwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvbW9ja19lbmdpbmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L21vY2tfZW5naW5lLmMKaW5kZXggNWJjYjQ2MWI4MzcyLi5iOTRkNTdiZjJjNDggMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L21vY2tfZW5naW5lLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvbW9ja19lbmdpbmUuYwpAQCAtMjcsNiArMjcsNyBAQAogI2lu
Y2x1ZGUgImk5MTVfZHJ2LmgiCiAjaW5jbHVkZSAiaW50ZWxfY29udGV4dC5oIgogI2luY2x1ZGUg
ImludGVsX2VuZ2luZV9wbS5oIgorI2luY2x1ZGUgImludGVsX2VuZ2luZV9wb29sLmgiCiAKICNp
bmNsdWRlICJtb2NrX2VuZ2luZS5oIgogI2luY2x1ZGUgInNlbGZ0ZXN0cy9tb2NrX3JlcXVlc3Qu
aCIKQEAgLTI5MSw2ICsyOTIsOCBAQCBpbnQgbW9ja19lbmdpbmVfaW5pdChzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmUpCiAJaW50ZWxfZW5naW5lX2luaXRfZXhlY2xpc3RzKGVuZ2luZSk7
CiAJaW50ZWxfZW5naW5lX2luaXRfX3BtKGVuZ2luZSk7CiAKKwlpbnRlbF9lbmdpbmVfcG9vbF9p
bml0KCZlbmdpbmUtPnBvb2wpOworCiAJZW5naW5lLT5rZXJuZWxfY29udGV4dCA9CiAJCWk5MTVf
Z2VtX2NvbnRleHRfZ2V0X2VuZ2luZShpOTE1LT5rZXJuZWxfY29udGV4dCwgZW5naW5lLT5pZCk7
CiAJaWYgKElTX0VSUihlbmdpbmUtPmtlcm5lbF9jb250ZXh0KSkKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kZWJ1Z2ZzLmMKaW5kZXggOGJkZjFkMTAwNjI3Li40ZmEyMjdmMDFhNjAgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZGVidWdmcy5jCkBAIC0yOTUsMjcgKzI5NSw2IEBAIHN0YXRpYyBpbnQgcGVy
X2ZpbGVfc3RhdHMoaW50IGlkLCB2b2lkICpwdHIsIHZvaWQgKmRhdGEpCiAJCQkgICBzdGF0cy5j
bG9zZWQpOyBcCiB9IHdoaWxlICgwKQogCi1zdGF0aWMgdm9pZCBwcmludF9iYXRjaF9wb29sX3N0
YXRzKHN0cnVjdCBzZXFfZmlsZSAqbSwKLQkJCQkgICBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCi17Ci0Jc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKLQlzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmU7Ci0Jc3RydWN0IGZpbGVfc3RhdHMgc3RhdHMgPSB7fTsK
LQllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKLQlpbnQgajsKLQotCWZvcl9lYWNoX2VuZ2luZShl
bmdpbmUsIGRldl9wcml2LCBpZCkgewotCQlmb3IgKGogPSAwOyBqIDwgQVJSQVlfU0laRShlbmdp
bmUtPmJhdGNoX3Bvb2wuY2FjaGVfbGlzdCk7IGorKykgewotCQkJbGlzdF9mb3JfZWFjaF9lbnRy
eShvYmosCi0JCQkJCSAgICAmZW5naW5lLT5iYXRjaF9wb29sLmNhY2hlX2xpc3Rbal0sCi0JCQkJ
CSAgICBiYXRjaF9wb29sX2xpbmspCi0JCQkJcGVyX2ZpbGVfc3RhdHMoMCwgb2JqLCAmc3RhdHMp
OwotCQl9Ci0JfQotCi0JcHJpbnRfZmlsZV9zdGF0cyhtLCAiW2tdYmF0Y2ggcG9vbCIsIHN0YXRz
KTsKLX0KLQogc3RhdGljIHZvaWQgcHJpbnRfY29udGV4dF9zdGF0cyhzdHJ1Y3Qgc2VxX2ZpbGUg
Km0sCiAJCQkJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CkBAIC0zNzQsNTggKzM1
MywxMiBAQCBzdGF0aWMgaW50IGk5MTVfZ2VtX29iamVjdF9pbmZvKHN0cnVjdCBzZXFfZmlsZSAq
bSwgdm9pZCAqZGF0YSkKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0JcHJpbnRfYmF0Y2hf
cG9vbF9zdGF0cyhtLCBpOTE1KTsKIAlwcmludF9jb250ZXh0X3N0YXRzKG0sIGk5MTUpOwogCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlyZXR1cm4gMDsKIH0KIAot
c3RhdGljIGludCBpOTE1X2dlbV9iYXRjaF9wb29sX2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2
b2lkICpkYXRhKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVf
dG9faTkxNShtLT5wcml2YXRlKTsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmRldl9wcml2
LT5kcm07Ci0Jc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKLQlzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmU7Ci0JZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7Ci0JaW50IHRvdGFs
ID0gMDsKLQlpbnQgcmV0LCBqOwotCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZk
ZXYtPnN0cnVjdF9tdXRleCk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQotCWZvcl9lYWNo
X2VuZ2luZShlbmdpbmUsIGRldl9wcml2LCBpZCkgewotCQlmb3IgKGogPSAwOyBqIDwgQVJSQVlf
U0laRShlbmdpbmUtPmJhdGNoX3Bvb2wuY2FjaGVfbGlzdCk7IGorKykgewotCQkJaW50IGNvdW50
OwotCi0JCQljb3VudCA9IDA7Ci0JCQlsaXN0X2Zvcl9lYWNoX2VudHJ5KG9iaiwKLQkJCQkJICAg
ICZlbmdpbmUtPmJhdGNoX3Bvb2wuY2FjaGVfbGlzdFtqXSwKLQkJCQkJICAgIGJhdGNoX3Bvb2xf
bGluaykKLQkJCQljb3VudCsrOwotCQkJc2VxX3ByaW50ZihtLCAiJXMgY2FjaGVbJWRdOiAlZCBv
YmplY3RzXG4iLAotCQkJCSAgIGVuZ2luZS0+bmFtZSwgaiwgY291bnQpOwotCi0JCQlsaXN0X2Zv
cl9lYWNoX2VudHJ5KG9iaiwKLQkJCQkJICAgICZlbmdpbmUtPmJhdGNoX3Bvb2wuY2FjaGVfbGlz
dFtqXSwKLQkJCQkJICAgIGJhdGNoX3Bvb2xfbGluaykgewotCQkJCXNlcV9wdXRzKG0sICIgICAi
KTsKLQkJCQlkZXNjcmliZV9vYmoobSwgb2JqKTsKLQkJCQlzZXFfcHV0YyhtLCAnXG4nKTsKLQkJ
CX0KLQotCQkJdG90YWwgKz0gY291bnQ7Ci0JCX0KLQl9Ci0KLQlzZXFfcHJpbnRmKG0sICJ0b3Rh
bDogJWRcbiIsIHRvdGFsKTsKLQotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwot
Ci0JcmV0dXJuIDA7Ci19Ci0KIHN0YXRpYyB2b2lkIGdlbjhfZGlzcGxheV9pbnRlcnJ1cHRfaW5m
byhzdHJ1Y3Qgc2VxX2ZpbGUgKm0pCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOwpAQCAtNDM1Myw3ICs0Mjg2LDYgQEAgc3Rh
dGljIGNvbnN0IHN0cnVjdCBkcm1faW5mb19saXN0IGk5MTVfZGVidWdmc19saXN0W10gPSB7CiAJ
eyJpOTE1X2dlbV9vYmplY3RzIiwgaTkxNV9nZW1fb2JqZWN0X2luZm8sIDB9LAogCXsiaTkxNV9n
ZW1fZmVuY2VfcmVncyIsIGk5MTVfZ2VtX2ZlbmNlX3JlZ3NfaW5mbywgMH0sCiAJeyJpOTE1X2dl
bV9pbnRlcnJ1cHQiLCBpOTE1X2ludGVycnVwdF9pbmZvLCAwfSwKLQl7Imk5MTVfZ2VtX2JhdGNo
X3Bvb2wiLCBpOTE1X2dlbV9iYXRjaF9wb29sX2luZm8sIDB9LAogCXsiaTkxNV9ndWNfaW5mbyIs
IGk5MTVfZ3VjX2luZm8sIDB9LAogCXsiaTkxNV9ndWNfbG9hZF9zdGF0dXMiLCBpOTE1X2d1Y19s
b2FkX3N0YXR1c19pbmZvLCAwfSwKIAl7Imk5MTVfZ3VjX2xvZ19kdW1wIiwgaTkxNV9ndWNfbG9n
X2R1bXAsIDB9LApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fYmF0
Y2hfcG9vbC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fYmF0Y2hfcG9vbC5jCmRl
bGV0ZWQgZmlsZSBtb2RlIDEwMDY0NAppbmRleCBiMTdmMjM5OTEyNTMuLjAwMDAwMDAwMDAwMAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9iYXRjaF9wb29sLmMKKysrIC9kZXYv
bnVsbApAQCAtMSwxMzIgKzAsMCBAQAotLyoKLSAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBN
SVQKLSAqCi0gKiBDb3B5cmlnaHQgwqkgMjAxNC0yMDE4IEludGVsIENvcnBvcmF0aW9uCi0gKi8K
LQotI2luY2x1ZGUgImk5MTVfZ2VtX2JhdGNoX3Bvb2wuaCIKLSNpbmNsdWRlICJpOTE1X2Rydi5o
IgotCi0vKioKLSAqIERPQzogYmF0Y2ggcG9vbAotICoKLSAqIEluIG9yZGVyIHRvIHN1Ym1pdCBi
YXRjaCBidWZmZXJzIGFzICdzZWN1cmUnLCB0aGUgc29mdHdhcmUgY29tbWFuZCBwYXJzZXIKLSAq
IG11c3QgZW5zdXJlIHRoYXQgYSBiYXRjaCBidWZmZXIgY2Fubm90IGJlIG1vZGlmaWVkIGFmdGVy
IHBhcnNpbmcuIEl0IGRvZXMKLSAqIHRoaXMgYnkgY29weWluZyB0aGUgdXNlciBwcm92aWRlZCBi
YXRjaCBidWZmZXIgY29udGVudHMgdG8gYSBrZXJuZWwgb3duZWQKLSAqIGJ1ZmZlciBmcm9tIHdo
aWNoIHRoZSBoYXJkd2FyZSB3aWxsIGFjdHVhbGx5IGV4ZWN1dGUsIGFuZCBieSBjYXJlZnVsbHkK
LSAqIG1hbmFnaW5nIHRoZSBhZGRyZXNzIHNwYWNlIGJpbmRpbmdzIGZvciBzdWNoIGJ1ZmZlcnMu
Ci0gKgotICogVGhlIGJhdGNoIHBvb2wgZnJhbWV3b3JrIHByb3ZpZGVzIGEgbWVjaGFuaXNtIGZv
ciB0aGUgZHJpdmVyIHRvIG1hbmFnZSBhCi0gKiBzZXQgb2Ygc2NyYXRjaCBidWZmZXJzIHRvIHVz
ZSBmb3IgdGhpcyBwdXJwb3NlLiBUaGUgZnJhbWV3b3JrIGNhbiBiZQotICogZXh0ZW5kZWQgdG8g
c3VwcG9ydCBvdGhlciB1c2VzIGNhc2VzIHNob3VsZCB0aGV5IGFyaXNlLgotICovCi0KLS8qKgot
ICogaTkxNV9nZW1fYmF0Y2hfcG9vbF9pbml0KCkgLSBpbml0aWFsaXplIGEgYmF0Y2ggYnVmZmVy
IHBvb2wKLSAqIEBwb29sOiB0aGUgYmF0Y2ggYnVmZmVyIHBvb2wKLSAqIEBlbmdpbmU6IHRoZSBh
c3NvY2lhdGVkIHJlcXVlc3Qgc3VibWlzc2lvbiBlbmdpbmUKLSAqLwotdm9pZCBpOTE1X2dlbV9i
YXRjaF9wb29sX2luaXQoc3RydWN0IGk5MTVfZ2VtX2JhdGNoX3Bvb2wgKnBvb2wsCi0JCQkgICAg
ICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCi17Ci0JaW50IG47Ci0KLQlwb29sLT5l
bmdpbmUgPSBlbmdpbmU7Ci0KLQlmb3IgKG4gPSAwOyBuIDwgQVJSQVlfU0laRShwb29sLT5jYWNo
ZV9saXN0KTsgbisrKQotCQlJTklUX0xJU1RfSEVBRCgmcG9vbC0+Y2FjaGVfbGlzdFtuXSk7Ci19
Ci0KLS8qKgotICogaTkxNV9nZW1fYmF0Y2hfcG9vbF9maW5pKCkgLSBjbGVhbiB1cCBhIGJhdGNo
IGJ1ZmZlciBwb29sCi0gKiBAcG9vbDogdGhlIHBvb2wgdG8gY2xlYW4gdXAKLSAqCi0gKiBOb3Rl
OiBDYWxsZXJzIG11c3QgaG9sZCB0aGUgc3RydWN0X211dGV4LgotICovCi12b2lkIGk5MTVfZ2Vt
X2JhdGNoX3Bvb2xfZmluaShzdHJ1Y3QgaTkxNV9nZW1fYmF0Y2hfcG9vbCAqcG9vbCkKLXsKLQlp
bnQgbjsKLQotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnBvb2wtPmVuZ2luZS0+aTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7Ci0KLQlmb3IgKG4gPSAwOyBuIDwgQVJSQVlfU0laRShwb29sLT5jYWNoZV9s
aXN0KTsgbisrKSB7Ci0JCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosICpuZXh0Owot
Ci0JCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShvYmosIG5leHQsCi0JCQkJCSAmcG9vbC0+Y2Fj
aGVfbGlzdFtuXSwKLQkJCQkJIGJhdGNoX3Bvb2xfbGluaykKLQkJCWk5MTVfZ2VtX29iamVjdF9w
dXQob2JqKTsKLQotCQlJTklUX0xJU1RfSEVBRCgmcG9vbC0+Y2FjaGVfbGlzdFtuXSk7Ci0JfQot
fQotCi0vKioKLSAqIGk5MTVfZ2VtX2JhdGNoX3Bvb2xfZ2V0KCkgLSBhbGxvY2F0ZSBhIGJ1ZmZl
ciBmcm9tIHRoZSBwb29sCi0gKiBAcG9vbDogdGhlIGJhdGNoIGJ1ZmZlciBwb29sCi0gKiBAc2l6
ZTogdGhlIG1pbmltdW0gZGVzaXJlZCBzaXplIG9mIHRoZSByZXR1cm5lZCBidWZmZXIKLSAqCi0g
KiBSZXR1cm5zIGFuIGluYWN0aXZlIGJ1ZmZlciBmcm9tIEBwb29sIHdpdGggYXQgbGVhc3QgQHNp
emUgYnl0ZXMsCi0gKiB3aXRoIHRoZSBwYWdlcyBwaW5uZWQuIFRoZSBjYWxsZXIgbXVzdCBpOTE1
X2dlbV9vYmplY3RfdW5waW5fcGFnZXMoKQotICogb24gdGhlIHJldHVybmVkIG9iamVjdC4KLSAq
Ci0gKiBOb3RlOiBDYWxsZXJzIG11c3QgaG9sZCB0aGUgc3RydWN0X211dGV4Ci0gKgotICogUmV0
dXJuOiB0aGUgYnVmZmVyIG9iamVjdCBvciBhbiBlcnJvciBwb2ludGVyCi0gKi8KLXN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICoKLWk5MTVfZ2VtX2JhdGNoX3Bvb2xfZ2V0KHN0cnVjdCBpOTE1
X2dlbV9iYXRjaF9wb29sICpwb29sLAotCQkJc2l6ZV90IHNpemUpCi17Ci0Jc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iajsKLQlzdHJ1Y3QgbGlzdF9oZWFkICpsaXN0OwotCWludCBuLCBy
ZXQ7Ci0KLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZwb29sLT5lbmdpbmUtPmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwotCi0JLyogQ29tcHV0ZSBhIHBvd2VyLW9mLXR3byBidWNrZXQsIGJ1dCB0aHJv
dyBldmVyeXRoaW5nIGdyZWF0ZXIgdGhhbgotCSAqIDE2S2lCIGludG8gdGhlIHNhbWUgYnVja2V0
OiBpLmUuIHRoZSB0aGUgYnVja2V0cyBob2xkIG9iamVjdHMgb2YKLQkgKiAoMSBwYWdlLCAyIHBh
Z2VzLCA0IHBhZ2VzLCA4KyBwYWdlcykuCi0JICovCi0JbiA9IGZscyhzaXplID4+IFBBR0VfU0hJ
RlQpIC0gMTsKLQlpZiAobiA+PSBBUlJBWV9TSVpFKHBvb2wtPmNhY2hlX2xpc3QpKQotCQluID0g
QVJSQVlfU0laRShwb29sLT5jYWNoZV9saXN0KSAtIDE7Ci0JbGlzdCA9ICZwb29sLT5jYWNoZV9s
aXN0W25dOwotCi0JbGlzdF9mb3JfZWFjaF9lbnRyeShvYmosIGxpc3QsIGJhdGNoX3Bvb2xfbGlu
aykgewotCQlzdHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0ICpyZXN2ID0gb2JqLT5iYXNlLnJlc3Y7
Ci0KLQkJLyogVGhlIGJhdGNoZXMgYXJlIHN0cmljdGx5IExSVSBvcmRlcmVkICovCi0JCWlmICgh
cmVzZXJ2YXRpb25fb2JqZWN0X3Rlc3Rfc2lnbmFsZWRfcmN1KHJlc3YsIHRydWUpKQotCQkJYnJl
YWs7Ci0KLQkJLyoKLQkJICogVGhlIG9iamVjdCBpcyBub3cgaWRsZSwgY2xlYXIgdGhlIGFycmF5
IG9mIHNoYXJlZAotCQkgKiBmZW5jZXMgYmVmb3JlIHdlIGFkZCBhIG5ldyByZXF1ZXN0LiBBbHRo
b3VnaCwgd2UKLQkJICogcmVtYWluIG9uIHRoZSBzYW1lIGVuZ2luZSwgd2UgbWF5IGJlIG9uIGEg
ZGlmZmVyZW50Ci0JCSAqIHRpbWVsaW5lIGFuZCBzbyBtYXkgY29udGludWFsbHkgZ3JvdyB0aGUg
YXJyYXksCi0JCSAqIHRyYXBwaW5nIGEgcmVmZXJlbmNlIHRvIGFsbCB0aGUgb2xkIGZlbmNlcywg
cmF0aGVyCi0JCSAqIHRoYW4gcmVwbGFjZSB0aGUgZXhpc3RpbmcgZmVuY2UuCi0JCSAqLwotCQlp
ZiAocmN1X2FjY2Vzc19wb2ludGVyKHJlc3YtPmZlbmNlKSkgewotCQkJcmVzZXJ2YXRpb25fb2Jq
ZWN0X2xvY2socmVzdiwgTlVMTCk7Ci0JCQlyZXNlcnZhdGlvbl9vYmplY3RfYWRkX2V4Y2xfZmVu
Y2UocmVzdiwgTlVMTCk7Ci0JCQlyZXNlcnZhdGlvbl9vYmplY3RfdW5sb2NrKHJlc3YpOwotCQl9
Ci0KLQkJaWYgKG9iai0+YmFzZS5zaXplID49IHNpemUpCi0JCQlnb3RvIGZvdW5kOwotCX0KLQot
CW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwocG9vbC0+ZW5naW5lLT5pOTE1
LCBzaXplKTsKLQlpZiAoSVNfRVJSKG9iaikpCi0JCXJldHVybiBvYmo7Ci0KLWZvdW5kOgotCXJl
dCA9IGk5MTVfZ2VtX29iamVjdF9waW5fcGFnZXMob2JqKTsKLQlpZiAocmV0KQotCQlyZXR1cm4g
RVJSX1BUUihyZXQpOwotCi0JbGlzdF9tb3ZlX3RhaWwoJm9iai0+YmF0Y2hfcG9vbF9saW5rLCBs
aXN0KTsKLQlyZXR1cm4gb2JqOwotfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9nZW1fYmF0Y2hfcG9vbC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fYmF0
Y2hfcG9vbC5oCmRlbGV0ZWQgZmlsZSBtb2RlIDEwMDY0NAppbmRleCBmZWVlZWVhYTU0ZDguLjAw
MDAwMDAwMDAwMAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9iYXRjaF9wb29s
LmgKKysrIC9kZXYvbnVsbApAQCAtMSwyNiArMCwwIEBACi0vKgotICogU1BEWC1MaWNlbnNlLUlk
ZW50aWZpZXI6IE1JVAotICoKLSAqIENvcHlyaWdodCDCqSAyMDE0LTIwMTggSW50ZWwgQ29ycG9y
YXRpb24KLSAqLwotCi0jaWZuZGVmIEk5MTVfR0VNX0JBVENIX1BPT0xfSAotI2RlZmluZSBJOTE1
X0dFTV9CQVRDSF9QT09MX0gKLQotI2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+Ci0KLXN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0Owotc3RydWN0IGludGVsX2VuZ2luZV9jczsKLQotc3RydWN0IGk5
MTVfZ2VtX2JhdGNoX3Bvb2wgewotCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQlz
dHJ1Y3QgbGlzdF9oZWFkIGNhY2hlX2xpc3RbNF07Ci19OwotCi12b2lkIGk5MTVfZ2VtX2JhdGNo
X3Bvb2xfaW5pdChzdHJ1Y3QgaTkxNV9nZW1fYmF0Y2hfcG9vbCAqcG9vbCwKLQkJCSAgICAgIHN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSk7Ci12b2lkIGk5MTVfZ2VtX2JhdGNoX3Bvb2xf
ZmluaShzdHJ1Y3QgaTkxNV9nZW1fYmF0Y2hfcG9vbCAqcG9vbCk7Ci1zdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqCi1pOTE1X2dlbV9iYXRjaF9wb29sX2dldChzdHJ1Y3QgaTkxNV9nZW1fYmF0
Y2hfcG9vbCAqcG9vbCwgc2l6ZV90IHNpemUpOwotCi0jZW5kaWYgLyogSTkxNV9HRU1fQkFUQ0hf
UE9PTF9IICovCi0tIAoyLjIyLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVk
ZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZv
L2ludGVsLWdmeA==

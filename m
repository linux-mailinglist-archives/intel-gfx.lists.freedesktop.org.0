Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 35830349BE2
	for <lists+intel-gfx@lfdr.de>; Thu, 25 Mar 2021 22:48:42 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 1129B6EE63;
	Thu, 25 Mar 2021 21:48:39 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga17.intel.com (mga17.intel.com [192.55.52.151])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 106FA6EE5B
 for <intel-gfx@lists.freedesktop.org>; Thu, 25 Mar 2021 21:48:33 +0000 (UTC)
IronPort-SDR: LI+lm3o2sGWrtmrOu1DqV7JbjW/w+BzfGoRZ8qp54UliB/kPtpufiPsRtay4olXmUPePcgPHsw
 ZEZrWlNU82iQ==
X-IronPort-AV: E=McAfee;i="6000,8403,9934"; a="171005078"
X-IronPort-AV: E=Sophos;i="5.81,278,1610438400"; d="scan'208";a="171005078"
Received: from orsmga003.jf.intel.com ([10.7.209.27])
 by fmsmga107.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 25 Mar 2021 14:48:32 -0700
IronPort-SDR: qp1t/UMl2dXV5FIPuodMzLSNx90iAyHGGwbiQNVGZNosQL2KdJVpfRw0FooPnwuoIXNfH3lK8Y
 +yi6oBzCyHDA==
X-IronPort-AV: E=Sophos;i="5.81,278,1610438400"; d="scan'208";a="375235681"
Received: from ideak-desk.fi.intel.com ([10.237.68.141])
 by orsmga003-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 25 Mar 2021 14:48:31 -0700
From: Imre Deak <imre.deak@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 25 Mar 2021 23:47:59 +0200
Message-Id: <20210325214808.2071517-17-imre.deak@intel.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20210325214808.2071517-1-imre.deak@intel.com>
References: <20210325214808.2071517-1-imre.deak@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 16/25] drm/i915: Unify the FB and plane state
 view information into one struct
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VG8gYWxsb3cgdGhlIHNpbXBsaWZpY2F0aW9uIG9mIEZCL3BsYW5lIHZpZXcgY29tcHV0YXRpb24g
aW4gdGhlCmZvbGxvdy11cCBwYXRjaGVzLCB1bmlmeSB0aGUgY29ycmVzcG9uZGluZyBzdGF0ZSBp
biB0aGUKaW50ZWxfZnJhbWVidWZmZXIgYW5kIGludGVsX3BsYW5lX3N0YXRlIHN0cnVjdHMgaW50
byBhIG5ldyBpbnRlbF9mYl92aWV3CnN0cnVjdC4KClRoaXMgYWRkcyBzb21lIG92ZXJoZWFkIHRv
IGludGVsX2ZyYW1lYnVmZmVyIGFzIHRoZSByb3RhdGVkIHZpZXcgd2lsbApoYXZlIG5vdyBzcGFj
ZSBmb3IgNCBjb2xvciBwbGFuZXMgaW5zdGVhZCBvZiB0aGUgcmVxdWlyZWQgMiBhbmQgaXQnbGwK
YWxzbyBjb250YWluIHRoZSB1bnVzZWQgb2Zmc2V0IGZvciBlYWNoIGNvbG9yX3BsYW5lIGluZm8u
IEltbyB0aGlzIGlzIGFuCmFjY2VwdGFibGUgdHJhZGUtb2ZmIHRvIGdldCBhIHNpbXBsaWZpZWQg
d2F5IG9mIHRoZSByZW1hcCBjb21wdXRhdGlvbi4KClVzZSB0aGUgbmV3IGludGVsX2ZiX3ZpZXcg
c3RydWN0IGZvciB0aGUgRkIgbm9ybWFsIHZpZXcgYXMgd2VsbCwgc28gKGluCnRoZSBmb2xsb3ct
dXAgcGF0Y2hlcykgd2UgY2FuIHJlbW92ZSB0aGUgc3BlY2lhbCBjYXNpbmcgZm9yIG5vcm1hbCB2
aWV3CmNhbGN1bGF0aW9uIHdydC4gdGhlIGNhbGN1bGF0aW9uIG9mIHJlbWFwcGVkL3JvdGF0ZWQg
dmlld3MuIFRoaXMgYWxzbwphZGRzIGFuIG92ZXJoZWFkIHRvIHRoZSBpbnRlbF9mcmFtZWJ1ZmZl
ciBzdHJ1Y3QsIGFzIHRoZSBndHQgcmVtYXAgaW5mbwphbmQgcGVyLWNvbG9yIHBsYW5lIG9mZnNl
dC9waXRjaCBpcyBub3QgcmVxdWlyZWQgZm9yIHRoZSBub3JtYWwgdmlldywKYnV0IGltbyB0aGlz
IGlzIGFuIGFjY2VwdGFibGUgdHJhZGUtb2ZmIGFzIGFib3ZlLiBUaGUgcGVyLWNvbG9yIHBsYW5l
CnBpdGNoIGZpbGVkIHdpbGwgYmUgdXNlZCBieSBhIGZvbGxvdy11cCBwYXRjaCwgc28gd2UgY2Fu
IHJldHJpZXZlIHRoZQpwaXRjaCBmb3IgZWFjaCB2aWV3IGluIHRoZSBzYW1lIHdheS4KCk5vIGZ1
bmN0aW9uYWwgY2hhbmdlcyBpbiB0aGlzIHBhdGNoLgoKU3VnZ2VzdGVkLWJ5OiBWaWxsZSBTeXJq
w6Rsw6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29tPgpDYzogVmlsbGUgU3lyasOkbMOk
IDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogSW1yZSBEZWFr
IDxpbXJlLmRlYWtAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aTl4eF9wbGFuZS5jICAgICB8IDIwICsrKy0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9jdXJzb3IuYyAgIHwgMTQgKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5LmMgIHwgMjIgKysrLS0tCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kaXNwbGF5X3R5cGVzLmggICAgfCA2MSArKysrKysrKysrLS0tLS0tCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiLmMgICAgICAgfCA2NiArKysrKysrKy0tLS0tLS0tLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYi5oICAgICAgIHwgIDMgKwogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmMuYyAgICAgIHwgIDYgKy0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMgICB8IDI2ICsrKy0tLS0KIC4u
Li9kcm0vaTkxNS9kaXNwbGF5L3NrbF91bml2ZXJzYWxfcGxhbmUuYyAgICB8IDcxICsrKysrKysr
Ky0tLS0tLS0tLS0KIDkgZmlsZXMgY2hhbmdlZCwgMTUzIGluc2VydGlvbnMoKyksIDEzNiBkZWxl
dGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2k5eHhf
cGxhbmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaTl4eF9wbGFuZS5jCmluZGV4
IDQwMjY2Yjc4MjQ3YjIuLjhlZTU5NDkwYzAyN2EgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaTl4eF9wbGFuZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaTl4eF9wbGFuZS5jCkBAIC0yNzEsNyArMjcxLDcgQEAgaW50IGk5eHhfY2hlY2tfcGxh
bmVfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCQl1MzIg
YWxpZ25tZW50ID0gaW50ZWxfc3VyZl9hbGlnbm1lbnQoZmIsIDApOwogCQlpbnQgY3BwID0gZmIt
PmZvcm1hdC0+Y3BwWzBdOwogCi0JCXdoaWxlICgoc3JjX3ggKyBzcmNfdykgKiBjcHAgPiBwbGFu
ZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0uc3RyaWRlKSB7CisJCXdoaWxlICgoc3JjX3ggKyBzcmNf
dykgKiBjcHAgPiBwbGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFuZVswXS5waXRjaCkgewogCQkJ
aWYgKG9mZnNldCA9PSAwKSB7CiAJCQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCiAJCQkJ
CSAgICAiVW5hYmxlIHRvIGZpbmQgc3VpdGFibGUgZGlzcGxheSBzdXJmYWNlIG9mZnNldCBkdWUg
dG8gWC10aWxpbmdcbiIpOwpAQCAtMzExLDkgKzMxMSw5IEBAIGludCBpOXh4X2NoZWNrX3BsYW5l
X3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAkJZHJtX1dB
Uk5fT04oJmRldl9wcml2LT5kcm0sIHNyY194ID4gNDA5NSB8fCBzcmNfeSA+IDQwOTUpOwogCX0K
IAotCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS5vZmZzZXQgPSBvZmZzZXQ7Ci0JcGxhbmVf
c3RhdGUtPmNvbG9yX3BsYW5lWzBdLnggPSBzcmNfeDsKLQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxh
bmVbMF0ueSA9IHNyY195OworCXBsYW5lX3N0YXRlLT52aWV3LmNvbG9yX3BsYW5lWzBdLm9mZnNl
dCA9IG9mZnNldDsKKwlwbGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFuZVswXS54ID0gc3JjX3g7
CisJcGxhbmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbMF0ueSA9IHNyY195OwogCiAJcmV0dXJu
IDA7CiB9CkBAIC00MjQsOCArNDI0LDggQEAgc3RhdGljIHZvaWQgaTl4eF91cGRhdGVfcGxhbmUo
c3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CiAJZW51bSBpOXh4X3BsYW5lX2lkIGk5
eHhfcGxhbmUgPSBwbGFuZS0+aTl4eF9wbGFuZTsKIAl1MzIgbGluZWFyX29mZnNldDsKLQlpbnQg
eCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS54OwotCWludCB5ID0gcGxhbmVfc3RhdGUt
PmNvbG9yX3BsYW5lWzBdLnk7CisJaW50IHggPSBwbGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFu
ZVswXS54OworCWludCB5ID0gcGxhbmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbMF0ueTsKIAlp
bnQgY3J0Y194ID0gcGxhbmVfc3RhdGUtPnVhcGkuZHN0LngxOwogCWludCBjcnRjX3kgPSBwbGFu
ZV9zdGF0ZS0+dWFwaS5kc3QueTE7CiAJaW50IGNydGNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFu
ZV9zdGF0ZS0+dWFwaS5kc3QpOwpAQCAtNDM5LDE0ICs0MzksMTQgQEAgc3RhdGljIHZvaWQgaTl4
eF91cGRhdGVfcGxhbmUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAlsaW5lYXJfb2Zmc2V0
ID0gaW50ZWxfZmJfeHlfdG9fbGluZWFyKHgsIHksIHBsYW5lX3N0YXRlLCAwKTsKIAogCWlmIChE
SVNQTEFZX1ZFUihkZXZfcHJpdikgPj0gNCkKLQkJZHNwYWRkcl9vZmZzZXQgPSBwbGFuZV9zdGF0
ZS0+Y29sb3JfcGxhbmVbMF0ub2Zmc2V0OworCQlkc3BhZGRyX29mZnNldCA9IHBsYW5lX3N0YXRl
LT52aWV3LmNvbG9yX3BsYW5lWzBdLm9mZnNldDsKIAllbHNlCiAJCWRzcGFkZHJfb2Zmc2V0ID0g
bGluZWFyX29mZnNldDsKIAogCXNwaW5fbG9ja19pcnFzYXZlKCZkZXZfcHJpdi0+dW5jb3JlLmxv
Y2ssIGlycWZsYWdzKTsKIAogCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBEU1BTVFJJREUo
aTl4eF9wbGFuZSksCi0JCQkgIHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS5zdHJpZGUpOwor
CQkJICBwbGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFuZVswXS5waXRjaCk7CiAKIAlpZiAoRElT
UExBWV9WRVIoZGV2X3ByaXYpIDwgNCkgewogCQkvKgpAQCAtNTMxLDcgKzUzMSw3IEBAIGc0eF9w
cmltYXJ5X2FzeW5jX2ZsaXAoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIHsKIAlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CiAJ
dTMyIGRzcGNudHIgPSBwbGFuZV9zdGF0ZS0+Y3RsIHwgaTl4eF9wbGFuZV9jdGxfY3J0YyhjcnRj
X3N0YXRlKTsKLQl1MzIgZHNwYWRkcl9vZmZzZXQgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVb
MF0ub2Zmc2V0OworCXUzMiBkc3BhZGRyX29mZnNldCA9IHBsYW5lX3N0YXRlLT52aWV3LmNvbG9y
X3BsYW5lWzBdLm9mZnNldDsKIAllbnVtIGk5eHhfcGxhbmVfaWQgaTl4eF9wbGFuZSA9IHBsYW5l
LT5pOXh4X3BsYW5lOwogCXVuc2lnbmVkIGxvbmcgaXJxZmxhZ3M7CiAKQEAgLTU1Miw3ICs1NTIs
NyBAQCB2bHZfcHJpbWFyeV9hc3luY19mbGlwKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAJ
CSAgICAgICBib29sIGFzeW5jX2ZsaXApCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwotCXUzMiBkc3BhZGRyX29mZnNldCA9
IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS5vZmZzZXQ7CisJdTMyIGRzcGFkZHJfb2Zmc2V0
ID0gcGxhbmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbMF0ub2Zmc2V0OwogCWVudW0gaTl4eF9w
bGFuZV9pZCBpOXh4X3BsYW5lID0gcGxhbmUtPmk5eHhfcGxhbmU7CiAJdW5zaWduZWQgbG9uZyBp
cnFmbGFnczsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9jdXJzb3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY3Vyc29yLmMK
aW5kZXggODQwOTliN2Y1YzM1OC4uMDNkYWQxMmNmNzhmYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jdXJzb3IuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2N1cnNvci5jCkBAIC00NSw3ICs0NSw3IEBAIHN0YXRpYyB1MzIg
aW50ZWxfY3Vyc29yX2Jhc2UoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9z
dGF0ZSkKIAllbHNlCiAJCWJhc2UgPSBpbnRlbF9wbGFuZV9nZ3R0X29mZnNldChwbGFuZV9zdGF0
ZSk7CiAKLQlyZXR1cm4gYmFzZSArIHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS5vZmZzZXQ7
CisJcmV0dXJuIGJhc2UgKyBwbGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFuZVswXS5vZmZzZXQ7
CiB9CiAKIHN0YXRpYyB1MzIgaW50ZWxfY3Vyc29yX3Bvc2l0aW9uKGNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCkBAIC0xMjUsOSArMTI1LDkgQEAgc3RhdGljIGlu
dCBpbnRlbF9jdXJzb3JfY2hlY2tfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlKQogCQlvZmZzZXQgKz0gKHNyY19oICogc3JjX3cgLSAxKSAqIGZiLT5mb3JtYXQt
PmNwcFswXTsKIAl9CiAKLQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ub2Zmc2V0ID0gb2Zm
c2V0OwotCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS54ID0gc3JjX3g7Ci0JcGxhbmVfc3Rh
dGUtPmNvbG9yX3BsYW5lWzBdLnkgPSBzcmNfeTsKKwlwbGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9w
bGFuZVswXS5vZmZzZXQgPSBvZmZzZXQ7CisJcGxhbmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVb
MF0ueCA9IHNyY194OworCXBsYW5lX3N0YXRlLT52aWV3LmNvbG9yX3BsYW5lWzBdLnkgPSBzcmNf
eTsKIAogCXJldHVybiAwOwogfQpAQCAtMTk0LDcgKzE5NCw3IEBAIHN0YXRpYyB1MzIgaTg0NV9j
dXJzb3JfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogewog
CXJldHVybiBDVVJTT1JfRU5BQkxFIHwKIAkJQ1VSU09SX0ZPUk1BVF9BUkdCIHwKLQkJQ1VSU09S
X1NUUklERShwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0uc3RyaWRlKTsKKwkJQ1VSU09SX1NU
UklERShwbGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFuZVswXS5waXRjaCk7CiB9CiAKIHN0YXRp
YyBib29sIGk4NDVfY3Vyc29yX3NpemVfb2soY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICpwbGFuZV9zdGF0ZSkKQEAgLTIzMyw3ICsyMzMsNyBAQCBzdGF0aWMgaW50IGk4NDVfY2hlY2tf
Y3Vyc29yKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCX0KIAogCWRybV9X
QVJOX09OKCZpOTE1LT5kcm0sIHBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUgJiYKLQkJICAgIHBs
YW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS5zdHJpZGUgIT0gZmItPnBpdGNoZXNbMF0pOworCQkg
ICAgcGxhbmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbMF0ucGl0Y2ggIT0gZmItPnBpdGNoZXNb
MF0pOwogCiAJc3dpdGNoIChmYi0+cGl0Y2hlc1swXSkgewogCWNhc2UgMjU2OgpAQCAtNDUwLDcg
KzQ1MCw3IEBAIHN0YXRpYyBpbnQgaTl4eF9jaGVja19jdXJzb3Ioc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUsCiAJfQogCiAJZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIHBs
YW5lX3N0YXRlLT51YXBpLnZpc2libGUgJiYKLQkJICAgIHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFu
ZVswXS5zdHJpZGUgIT0gZmItPnBpdGNoZXNbMF0pOworCQkgICAgcGxhbmVfc3RhdGUtPnZpZXcu
Y29sb3JfcGxhbmVbMF0ucGl0Y2ggIT0gZmItPnBpdGNoZXNbMF0pOwogCiAJaWYgKGZiLT5waXRj
aGVzWzBdICE9CiAJICAgIGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpICog
ZmItPmZvcm1hdC0+Y3BwWzBdKSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheS5jCmluZGV4IDI1ZWFhOGE0NGJhYTguLjRlZTdlNzIxNDJhNWYgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBAIC0xMDEzLDcgKzEw
MTMsNyBAQCBzdGF0aWMgYm9vbCBpbnRlbF9wbGFuZV91c2VzX2ZlbmNlKGNvbnN0IHN0cnVjdCBp
bnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAKIAlyZXR1cm4gRElTUExBWV9WRVIoZGV2
X3ByaXYpIDwgNCB8fAogCQkocGxhbmUtPmhhc19mYmMgJiYKLQkJIHBsYW5lX3N0YXRlLT52aWV3
LnR5cGUgPT0gSTkxNV9HR1RUX1ZJRVdfTk9STUFMKTsKKwkJIHBsYW5lX3N0YXRlLT52aWV3Lmd0
dC50eXBlID09IEk5MTVfR0dUVF9WSUVXX05PUk1BTCk7CiB9CiAKIHN0cnVjdCBpOTE1X3ZtYSAq
CkBAIC0xMTYxLDcgKzExNjEsNyBAQCB1MzIgaW50ZWxfZmJfeHlfdG9fbGluZWFyKGludCB4LCBp
bnQgeSwKIHsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHN0YXRlLT5ody5m
YjsKIAl1bnNpZ25lZCBpbnQgY3BwID0gZmItPmZvcm1hdC0+Y3BwW2NvbG9yX3BsYW5lXTsKLQl1
bnNpZ25lZCBpbnQgcGl0Y2ggPSBzdGF0ZS0+Y29sb3JfcGxhbmVbY29sb3JfcGxhbmVdLnN0cmlk
ZTsKKwl1bnNpZ25lZCBpbnQgcGl0Y2ggPSBzdGF0ZS0+dmlldy5jb2xvcl9wbGFuZVtjb2xvcl9w
bGFuZV0ucGl0Y2g7CiAKIAlyZXR1cm4geSAqIHBpdGNoICsgeCAqIGNwcDsKIH0KQEAgLTExNzYs
OCArMTE3Niw4IEBAIHZvaWQgaW50ZWxfYWRkX2ZiX29mZnNldHMoaW50ICp4LCBpbnQgKnksCiAJ
CQkgIGludCBjb2xvcl9wbGFuZSkKIAogewotCSp4ICs9IHN0YXRlLT5jb2xvcl9wbGFuZVtjb2xv
cl9wbGFuZV0ueDsKLQkqeSArPSBzdGF0ZS0+Y29sb3JfcGxhbmVbY29sb3JfcGxhbmVdLnk7CisJ
KnggKz0gc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbY29sb3JfcGxhbmVdLng7CisJKnkgKz0gc3Rh
dGUtPnZpZXcuY29sb3JfcGxhbmVbY29sb3JfcGxhbmVdLnk7CiB9CiAKIHN0YXRpYyB1bnNpZ25l
ZCBpbnQgaW50ZWxfZmJfbW9kaWZpZXJfdG9fdGlsaW5nKHU2NCBmYl9tb2RpZmllcikKQEAgLTE2
ODAsOSArMTY4MCw5IEBAIGludGVsX2ZpbmRfaW5pdGlhbF9wbGFuZV9vYmooc3RydWN0IGludGVs
X2NydGMgKmludGVsX2NydGMsCiAKIHZhbGlkX2ZiOgogCXBsYW5lX3N0YXRlLT5yb3RhdGlvbiA9
IHBsYW5lX2NvbmZpZy0+cm90YXRpb247Ci0JaW50ZWxfZmlsbF9mYl9nZ3R0X3ZpZXcoJmludGVs
X3N0YXRlLT52aWV3LCBmYiwKKwlpbnRlbF9maWxsX2ZiX2dndHRfdmlldygmaW50ZWxfc3RhdGUt
PnZpZXcuZ3R0LCBmYiwKIAkJCQlwbGFuZV9zdGF0ZS0+cm90YXRpb24pOwotCWludGVsX3N0YXRl
LT5jb2xvcl9wbGFuZVswXS5zdHJpZGUgPQorCWludGVsX3N0YXRlLT52aWV3LmNvbG9yX3BsYW5l
WzBdLnBpdGNoID0KIAkJaW50ZWxfZmJfcGl0Y2goZmIsIDAsIHBsYW5lX3N0YXRlLT5yb3RhdGlv
bik7CiAKIAlfX2k5MTVfdm1hX3Bpbih2bWEpOwpAQCAtMTcyMyw3ICsxNzIzLDcgQEAgaW50ZWxf
cGxhbmVfZmVuY2VfeV9vZmZzZXQoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFu
ZV9zdGF0ZSkKIAlpbnQgeCA9IDAsIHkgPSAwOwogCiAJaW50ZWxfcGxhbmVfYWRqdXN0X2FsaWdu
ZWRfb2Zmc2V0KCZ4LCAmeSwgcGxhbmVfc3RhdGUsIDAsCi0JCQkJCSAgcGxhbmVfc3RhdGUtPmNv
bG9yX3BsYW5lWzBdLm9mZnNldCwgMCk7CisJCQkJCSAgcGxhbmVfc3RhdGUtPnZpZXcuY29sb3Jf
cGxhbmVbMF0ub2Zmc2V0LCAwKTsKIAogCXJldHVybiB5OwogfQpAQCAtNjc4Nyw4ICs2Nzg3LDYg
QEAgc3RhdGljIGludCBpY2xfY2hlY2tfbnYxMl9wbGFuZXMoc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUpCiAJCWxpbmtlZF9zdGF0ZS0+Y3RsID0gcGxhbmVfc3RhdGUtPmN0bCB8
IFBMQU5FX0NUTF9ZVVY0MjBfWV9QTEFORTsKIAkJbGlua2VkX3N0YXRlLT5jb2xvcl9jdGwgPSBw
bGFuZV9zdGF0ZS0+Y29sb3JfY3RsOwogCQlsaW5rZWRfc3RhdGUtPnZpZXcgPSBwbGFuZV9zdGF0
ZS0+dmlldzsKLQkJbWVtY3B5KGxpbmtlZF9zdGF0ZS0+Y29sb3JfcGxhbmUsIHBsYW5lX3N0YXRl
LT5jb2xvcl9wbGFuZSwKLQkJICAgICAgIHNpemVvZihsaW5rZWRfc3RhdGUtPmNvbG9yX3BsYW5l
KSk7CiAKIAkJaW50ZWxfcGxhbmVfY29weV9od19zdGF0ZShsaW5rZWRfc3RhdGUsIHBsYW5lX3N0
YXRlKTsKIAkJbGlua2VkX3N0YXRlLT51YXBpLnNyYyA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYzsK
QEAgLTkzMjAsOCArOTMxOCw4IEBAIHN0YXRpYyBpbnQgaW50ZWxfYXRvbWljX2NoZWNrX2FzeW5j
KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQkJcmV0dXJuIC1FSU5WQUw7CiAJ
CX0KIAotCQlpZiAob2xkX3BsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS5zdHJpZGUgIT0KLQkJ
ICAgIG5ld19wbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0uc3RyaWRlKSB7CisJCWlmIChvbGRf
cGxhbmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbMF0ucGl0Y2ggIT0KKwkJICAgIG5ld19wbGFu
ZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFuZVswXS5waXRjaCkgewogCQkJZHJtX2RiZ19rbXMoJmk5
MTUtPmRybSwgIlN0cmlkZSBjYW5ub3QgYmUgY2hhbmdlZCBpbiBhc3luYyBmbGlwXG4iKTsKIAkJ
CXJldHVybiAtRUlOVkFMOwogCQl9CkBAIC0xMDU0Niw3ICsxMDU0NCw3IEBAIGludCBpbnRlbF9w
bGFuZV9waW5fZmIoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAkJSU5U
RUxfSU5GTyhkZXZfcHJpdiktPmRpc3BsYXkuY3Vyc29yX25lZWRzX3BoeXNpY2FsOwogCiAJdm1h
ID0gaW50ZWxfcGluX2FuZF9mZW5jZV9mYl9vYmooZmIsIHBoeXNfY3Vyc29yLAotCQkJCQkgJnBs
YW5lX3N0YXRlLT52aWV3LAorCQkJCQkgJnBsYW5lX3N0YXRlLT52aWV3Lmd0dCwKIAkJCQkJIGlu
dGVsX3BsYW5lX3VzZXNfZmVuY2UocGxhbmVfc3RhdGUpLAogCQkJCQkgJnBsYW5lX3N0YXRlLT5m
bGFncyk7CiAJaWYgKElTX0VSUih2bWEpKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaAppbmRleCA4MDk4M2NmZTlkM2IwLi5iNzI4NjFm
NmY2OGE3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rp
c3BsYXlfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rp
c3BsYXlfdHlwZXMuaApAQCAtODUsMjAgKzg1LDQ5IEBAIGVudW0gaW50ZWxfYnJvYWRjYXN0X3Jn
YiB7CiAJSU5URUxfQlJPQURDQVNUX1JHQl9MSU1JVEVELAogfTsKIAorc3RydWN0IGludGVsX2Zi
X3ZpZXcgeworCS8qCisJICogVGhlIHJlbWFwIGluZm9ybWF0aW9uIHVzZWQgaW4gdGhlIHJlbWFw
cGVkIGFuZCByb3RhdGVkIHZpZXdzIHRvCisJICogY3JlYXRlIHRoZSBETUEgc2NhdHRlci1nYXRo
ZXIgbGlzdCBmb3IgZWFjaCBGQiBjb2xvciBwbGFuZS4gVGhpcyBzZworCSAqIGxpc3QgaXMgY3Jl
YXRlZCBhbG9uZyB3aXRoIHRoZSB2aWV3IHR5cGUgKGd0dC50eXBlKSBzcGVjaWZpYworCSAqIGk5
MTVfdm1hIG9iamVjdCBhbmQgY29udGFpbnMgdGhlIGxpc3Qgb2YgRkIgb2JqZWN0IHBhZ2VzIChy
ZW9yZGVyZWQKKwkgKiBpbiB0aGUgcm90YXRlZCB2aWV3KSB0aGF0IGFyZSB2aXNpYmxlIGluIHRo
ZSB2aWV3LgorCSAqIEluIHRoZSBub3JtYWwgdmlldyB0aGUgRkIgb2JqZWN0J3MgYmFja2luZyBz
dG9yZSBzZyBsaXN0IGlzIHVzZWQKKwkgKiBkaXJlY3RseSBhbmQgaGVuY2UgdGhlIHJlbWFwIGlu
Zm9ybWF0aW9uIGhlcmUgaXMgbm90IHVzZWQuCisJICovCisJc3RydWN0IGk5MTVfZ2d0dF92aWV3
IGd0dDsKKworCS8qCisJICogVGhlIEdUVCB2aWV3IChndHQudHlwZSkgc3BlY2lmaWMgaW5mb3Jt
YXRpb24gZm9yIGVhY2ggRkIgY29sb3IKKwkgKiBwbGFuZS4gSW4gdGhlIG5vcm1hbCBHVFQgdmll
dyBhbGwgZm9ybWF0cyAodXAgdG8gNCBjb2xvciBwbGFuZXMpLAorCSAqIGluIHRoZSByb3RhdGVk
IGFuZCByZW1hcHBlZCBHVFQgdmlldyBhbGwgbm8tQ0NTIGZvcm1hdHMgKHVwIHRvIDIKKwkgKiBj
b2xvciBwbGFuZXMpIGFyZSBzdXBwb3J0ZWQuCisJICoKKwkgKiBUT0RPOiBhZGQgc3VwcG9ydCBm
b3IgQ0NTIGZvcm1hdHMgaW4gdGhlIHJlbWFwcGVkIEdUVCB2aWV3LgorCSAqCisJICogVGhlIHZp
ZXcgaW5mb3JtYXRpb24gc2hhcmVkIGJ5IGFsbCBGQiBjb2xvciBwbGFuZXMgaW4gdGhlIEZCLAor
CSAqIGxpa2UgZHN0IHgveSBhbmQgc3JjL2RzdCB3aWR0aCwgaXMgc3RvcmVkIHNlcGFyYXRlbHkg
aW4KKwkgKiBpbnRlbF9wbGFuZV9zdGF0ZS4KKwkgKi8KKwlzdHJ1Y3QgaTkxNV9jb2xvcl9wbGFu
ZV92aWV3IHsKKwkJdTMyIG9mZnNldDsKKwkJdW5zaWduZWQgaW50IHgsIHk7CisJCS8qCisJCSAq
IFBsYW5lIHBpdGNoIChzdHJpZGUpIGluOgorCQkgKiAgIGJ5dGVzIGZvciAwLzE4MCBkZWdyZWUg
cm90YXRpb24KKwkJICogICBwaXhlbHMgZm9yIDkwLzI3MCBkZWdyZWUgcm90YXRpb24KKwkJICov
CisJCXVuc2lnbmVkIGludCBwaXRjaDsKKwl9IGNvbG9yX3BsYW5lWzRdOworfTsKKwogc3RydWN0
IGludGVsX2ZyYW1lYnVmZmVyIHsKIAlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyIGJhc2U7CiAJc3Ry
dWN0IGludGVsX2Zyb250YnVmZmVyICpmcm9udGJ1ZmZlcjsKLQlzdHJ1Y3QgaW50ZWxfcm90YXRp
b25faW5mbyByb3RfaW5mbzsKIAotCS8qIGZvciBlYWNoIHBsYW5lIGluIHRoZSBub3JtYWwgR1RU
IHZpZXcgKi8KLQlzdHJ1Y3QgewotCQl1bnNpZ25lZCBpbnQgeCwgeTsKLQl9IG5vcm1hbFs0XTsK
LQkvKiBmb3IgZWFjaCBwbGFuZSBpbiB0aGUgcm90YXRlZCBHVFQgdmlldyBmb3Igbm8tQ0NTIGZv
cm1hdHMgKi8KLQlzdHJ1Y3QgewotCQl1bnNpZ25lZCBpbnQgeCwgeTsKLQkJdW5zaWduZWQgaW50
IHBpdGNoOyAvKiBwaXhlbHMgKi8KLQl9IHJvdGF0ZWRbMl07CisJLyogUGFyYW1zIHRvIHJlbWFw
IHRoZSBGQiBwYWdlcyBhbmQgcHJvZ3JhbSB0aGUgcGxhbmUgcmVnaXN0ZXJzIGluIGVhY2ggdmll
dy4gKi8KKwlzdHJ1Y3QgaW50ZWxfZmJfdmlldyBub3JtYWxfdmlldzsKKwlzdHJ1Y3QgaW50ZWxf
ZmJfdmlldyByb3RhdGVkX3ZpZXc7CiB9OwogCiBzdHJ1Y3QgaW50ZWxfZmJkZXYgewpAQCAtNTgx
LDIxICs2MTAsMTEgQEAgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlIHsKIAkJZW51bSBkcm1fc2Nh
bGluZ19maWx0ZXIgc2NhbGluZ19maWx0ZXI7CiAJfSBodzsKIAotCXN0cnVjdCBpOTE1X2dndHRf
dmlldyB2aWV3OwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCXVuc2lnbmVkIGxvbmcgZmxhZ3M7
CiAjZGVmaW5lIFBMQU5FX0hBU19GRU5DRSBCSVQoMCkKIAotCXN0cnVjdCB7Ci0JCXUzMiBvZmZz
ZXQ7Ci0JCS8qCi0JCSAqIFBsYW5lIHN0cmlkZSBpbjoKLQkJICogYnl0ZXMgZm9yIDAvMTgwIGRl
Z3JlZSByb3RhdGlvbgotCQkgKiBwaXhlbHMgZm9yIDkwLzI3MCBkZWdyZWUgcm90YXRpb24KLQkJ
ICovCi0JCXUzMiBzdHJpZGU7Ci0JCWludCB4LCB5OwotCX0gY29sb3JfcGxhbmVbNF07CisJc3Ry
dWN0IGludGVsX2ZiX3ZpZXcgdmlldzsKIAogCS8qIHBsYW5lIGNvbnRyb2wgcmVnaXN0ZXIgKi8K
IAl1MzIgY3RsOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9mYi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYi5jCmluZGV4IDZm
ODIwNjc2OWMzZGYuLmIyMjNlMTZlYjZhMjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZmIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2ZiLmMKQEAgLTI1OSw3ICsyNTksNyBAQCB1MzIgaW50ZWxfcGxhbmVfYWRqdXN0X2Fs
aWduZWRfb2Zmc2V0KGludCAqeCwgaW50ICp5LAogewogCXJldHVybiBpbnRlbF9hZGp1c3RfYWxp
Z25lZF9vZmZzZXQoeCwgeSwgc3RhdGUtPmh3LmZiLCBjb2xvcl9wbGFuZSwKIAkJCQkJICAgc3Rh
dGUtPmh3LnJvdGF0aW9uLAotCQkJCQkgICBzdGF0ZS0+Y29sb3JfcGxhbmVbY29sb3JfcGxhbmVd
LnN0cmlkZSwKKwkJCQkJICAgc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbY29sb3JfcGxhbmVdLnBp
dGNoLAogCQkJCQkgICBvbGRfb2Zmc2V0LCBuZXdfb2Zmc2V0KTsKIH0KIApAQCAtMzQwLDcgKzM0
MCw3IEBAIHUzMiBpbnRlbF9wbGFuZV9jb21wdXRlX2FsaWduZWRfb2Zmc2V0KGludCAqeCwgaW50
ICp5LAogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShpbnRlbF9wbGFu
ZS0+YmFzZS5kZXYpOwogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gc3RhdGUt
Pmh3LmZiOwogCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHN0YXRlLT5ody5yb3RhdGlvbjsKLQlp
bnQgcGl0Y2ggPSBzdGF0ZS0+Y29sb3JfcGxhbmVbY29sb3JfcGxhbmVdLnN0cmlkZTsKKwlpbnQg
cGl0Y2ggPSBzdGF0ZS0+dmlldy5jb2xvcl9wbGFuZVtjb2xvcl9wbGFuZV0ucGl0Y2g7CiAJdTMy
IGFsaWdubWVudDsKIAogCWlmIChpbnRlbF9wbGFuZS0+aWQgPT0gUExBTkVfQ1VSU09SKQpAQCAt
NDIzLDggKzQyMyw4IEBAIHN0YXRpYyBpbnQgaW50ZWxfZmJfY2hlY2tfY2NzX3h5KGNvbnN0IHN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgY2NzX3BsYW5lCiAJY2NzX3kgPSAoeSAqIHZz
dWIpICUgdGlsZV9oZWlnaHQ7CiAKIAltYWluX3BsYW5lID0gc2tsX2Njc190b19tYWluX3BsYW5l
KGZiLCBjY3NfcGxhbmUpOwotCW1haW5feCA9IGludGVsX2ZiLT5ub3JtYWxbbWFpbl9wbGFuZV0u
eCAlIHRpbGVfd2lkdGg7Ci0JbWFpbl95ID0gaW50ZWxfZmItPm5vcm1hbFttYWluX3BsYW5lXS55
ICUgdGlsZV9oZWlnaHQ7CisJbWFpbl94ID0gaW50ZWxfZmItPm5vcm1hbF92aWV3LmNvbG9yX3Bs
YW5lW21haW5fcGxhbmVdLnggJSB0aWxlX3dpZHRoOworCW1haW5feSA9IGludGVsX2ZiLT5ub3Jt
YWxfdmlldy5jb2xvcl9wbGFuZVttYWluX3BsYW5lXS55ICUgdGlsZV9oZWlnaHQ7CiAKIAkvKgog
CSAqIENDUyBkb2Vzbid0IGhhdmUgaXRzIG93biB4L3kgb2Zmc2V0IHJlZ2lzdGVyLCBzbyB0aGUg
aW50cmEgQ0NTIHRpbGUKQEAgLTQzNSw4ICs0MzUsOCBAQCBzdGF0aWMgaW50IGludGVsX2ZiX2No
ZWNrX2Njc194eShjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNjc19wbGFu
ZQogCQkJICAgICAgIkJhZCBDQ1MgeC95IChtYWluICVkLCVkIGNjcyAlZCwlZCkgZnVsbCAobWFp
biAlZCwlZCBjY3MgJWQsJWQpXG4iLAogCQkJICAgICAgbWFpbl94LCBtYWluX3ksCiAJCQkgICAg
ICBjY3NfeCwgY2NzX3ksCi0JCQkgICAgICBpbnRlbF9mYi0+bm9ybWFsW21haW5fcGxhbmVdLngs
Ci0JCQkgICAgICBpbnRlbF9mYi0+bm9ybWFsW21haW5fcGxhbmVdLnksCisJCQkgICAgICBpbnRl
bF9mYi0+bm9ybWFsX3ZpZXcuY29sb3JfcGxhbmVbbWFpbl9wbGFuZV0ueCwKKwkJCSAgICAgIGlu
dGVsX2ZiLT5ub3JtYWxfdmlldy5jb2xvcl9wbGFuZVttYWluX3BsYW5lXS55LAogCQkJICAgICAg
eCwgeSk7CiAJCXJldHVybiAtRUlOVkFMOwogCX0KQEAgLTQ4Nyw3ICs0ODcsNyBAQCBzdGF0aWMg
Ym9vbCBpbnRlbF9wbGFuZV9jYW5fcmVtYXAoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICpwbGFuZV9zdGF0ZSkKIGludCBpbnRlbF9mYl9waXRjaChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYiwgaW50IGNvbG9yX3BsYW5lLCB1bnNpZ25lZCBpbnQgcm90YXRpb24pCiB7CiAJ
aWYgKGRybV9yb3RhdGlvbl85MF9vcl8yNzAocm90YXRpb24pKQotCQlyZXR1cm4gdG9faW50ZWxf
ZnJhbWVidWZmZXIoZmIpLT5yb3RhdGVkW2NvbG9yX3BsYW5lXS5waXRjaDsKKwkJcmV0dXJuIHRv
X2ludGVsX2ZyYW1lYnVmZmVyKGZiKS0+cm90YXRlZF92aWV3LmNvbG9yX3BsYW5lW2NvbG9yX3Bs
YW5lXS5waXRjaDsKIAllbHNlCiAJCXJldHVybiBmYi0+cGl0Y2hlc1tjb2xvcl9wbGFuZV07CiB9
CkBAIC01ODQsNyArNTg0LDcgQEAgc3RhdGljIHUzMiBzZXR1cF9mYl9yb3RhdGlvbihpbnQgcGxh
bmUsIGNvbnN0IHN0cnVjdCBpbnRlbF9yZW1hcHBlZF9wbGFuZV9pbmZvICoKIAkJCSAgICAgc3Ry
dWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIpCiB7CiAJc3RydWN0IGludGVsX2ZyYW1lYnVmZmVyICpp
bnRlbF9mYiA9IHRvX2ludGVsX2ZyYW1lYnVmZmVyKGZiKTsKLQlzdHJ1Y3QgaW50ZWxfcm90YXRp
b25faW5mbyAqcm90X2luZm8gPSAmaW50ZWxfZmItPnJvdF9pbmZvOworCXN0cnVjdCBpbnRlbF9y
b3RhdGlvbl9pbmZvICpyb3RfaW5mbyA9ICZpbnRlbF9mYi0+cm90YXRlZF92aWV3Lmd0dC5yb3Rh
dGVkOwogCXVuc2lnbmVkIGludCBwaXRjaF90aWxlczsKIAlzdHJ1Y3QgZHJtX3JlY3QgcjsKIApA
QCAtNTk4LDcgKzU5OCw3IEBAIHN0YXRpYyB1MzIgc2V0dXBfZmJfcm90YXRpb24oaW50IHBsYW5l
LCBjb25zdCBzdHJ1Y3QgaW50ZWxfcmVtYXBwZWRfcGxhbmVfaW5mbyAqCiAKIAlyb3RfaW5mby0+
cGxhbmVbcGxhbmVdID0gKnBsYW5lX2luZm87CiAKLQlpbnRlbF9mYi0+cm90YXRlZFtwbGFuZV0u
cGl0Y2ggPSBwbGFuZV9pbmZvLT5oZWlnaHQgKiB0aWxlX2hlaWdodDsKKwlpbnRlbF9mYi0+cm90
YXRlZF92aWV3LmNvbG9yX3BsYW5lW3BsYW5lXS5waXRjaCA9IHBsYW5lX2luZm8tPmhlaWdodCAq
IHRpbGVfaGVpZ2h0OwogCiAJLyogcm90YXRlIHRoZSB4L3kgb2Zmc2V0cyB0byBtYXRjaCB0aGUg
R1RUIHZpZXcgKi8KIAlkcm1fcmVjdF9pbml0KCZyLCB4LCB5LCB3aWR0aCwgaGVpZ2h0KTsKQEAg
LTYxMCw3ICs2MTAsNyBAQCBzdGF0aWMgdTMyIHNldHVwX2ZiX3JvdGF0aW9uKGludCBwbGFuZSwg
Y29uc3Qgc3RydWN0IGludGVsX3JlbWFwcGVkX3BsYW5lX2luZm8gKgogCXkgPSByLnkxOwogCiAJ
Lyogcm90YXRlIHRoZSB0aWxlIGRpbWVuc2lvbnMgdG8gbWF0Y2ggdGhlIEdUVCB2aWV3ICovCi0J
cGl0Y2hfdGlsZXMgPSBpbnRlbF9mYi0+cm90YXRlZFtwbGFuZV0ucGl0Y2ggLyB0aWxlX2hlaWdo
dDsKKwlwaXRjaF90aWxlcyA9IGludGVsX2ZiLT5yb3RhdGVkX3ZpZXcuY29sb3JfcGxhbmVbcGxh
bmVdLnBpdGNoIC8gdGlsZV9oZWlnaHQ7CiAJc3dhcCh0aWxlX3dpZHRoLCB0aWxlX2hlaWdodCk7
CiAKIAkvKgpAQCAtNjI2LDggKzYyNiw4IEBAIHN0YXRpYyB1MzIgc2V0dXBfZmJfcm90YXRpb24o
aW50IHBsYW5lLCBjb25zdCBzdHJ1Y3QgaW50ZWxfcmVtYXBwZWRfcGxhbmVfaW5mbyAqCiAJICog
Rmlyc3QgcGl4ZWwgb2YgdGhlIGZyYW1lYnVmZmVyIGZyb20KIAkgKiB0aGUgc3RhcnQgb2YgdGhl
IHJvdGF0ZWQgZ3R0IG1hcHBpbmcuCiAJICovCi0JaW50ZWxfZmItPnJvdGF0ZWRbcGxhbmVdLngg
PSB4OwotCWludGVsX2ZiLT5yb3RhdGVkW3BsYW5lXS55ID0geTsKKwlpbnRlbF9mYi0+cm90YXRl
ZF92aWV3LmNvbG9yX3BsYW5lW3BsYW5lXS54ID0geDsKKwlpbnRlbF9mYi0+cm90YXRlZF92aWV3
LmNvbG9yX3BsYW5lW3BsYW5lXS55ID0geTsKIAogCXJldHVybiBwbGFuZV9pbmZvLT53aWR0aCAq
IHBsYW5lX2luZm8tPmhlaWdodDsKIH0KQEAgLTc0Miw4ICs3NDIsOCBAQCBpbnQgaW50ZWxfZmls
bF9mYl9pbmZvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYgogCQkgKiBGaXJzdCBwaXhlbCBvZiB0aGUgZnJhbWVidWZmZXIgZnJvbQogCQkg
KiB0aGUgc3RhcnQgb2YgdGhlIG5vcm1hbCBndHQgbWFwcGluZy4KIAkJICovCi0JCWludGVsX2Zi
LT5ub3JtYWxbaV0ueCA9IHg7Ci0JCWludGVsX2ZiLT5ub3JtYWxbaV0ueSA9IHk7CisJCWludGVs
X2ZiLT5ub3JtYWxfdmlldy5jb2xvcl9wbGFuZVtpXS54ID0geDsKKwkJaW50ZWxfZmItPm5vcm1h
bF92aWV3LmNvbG9yX3BsYW5lW2ldLnkgPSB5OwogCiAJCW9mZnNldCA9IGNhbGNfcGxhbmVfYWxp
Z25lZF9vZmZzZXQoaW50ZWxfZmIsIGksICZ4LCAmeSk7CiAKQEAgLTc4NSw3ICs3ODUsNyBAQCBz
dGF0aWMgdm9pZCBpbnRlbF9wbGFuZV9yZW1hcF9ndHQoc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICpwbGFuZV9zdGF0ZSkKIAkJdG9faTkxNShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZS0+ZGV2KTsK
IAlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAlzdHJ1
Y3QgaW50ZWxfZnJhbWVidWZmZXIgKmludGVsX2ZiID0gdG9faW50ZWxfZnJhbWVidWZmZXIoZmIp
OwotCXN0cnVjdCBpbnRlbF9yb3RhdGlvbl9pbmZvICppbmZvID0gJnBsYW5lX3N0YXRlLT52aWV3
LnJvdGF0ZWQ7CisJc3RydWN0IGludGVsX3JvdGF0aW9uX2luZm8gKmluZm8gPSAmcGxhbmVfc3Rh
dGUtPnZpZXcuZ3R0LnJvdGF0ZWQ7CiAJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3Rh
dGUtPmh3LnJvdGF0aW9uOwogCWludCBpLCBudW1fcGxhbmVzID0gZmItPmZvcm1hdC0+bnVtX3Bs
YW5lczsKIAl1bnNpZ25lZCBpbnQgdGlsZV9zaXplID0gaW50ZWxfdGlsZV9zaXplKGk5MTUpOwpA
QCAtNzkzLDggKzc5Myw4IEBAIHN0YXRpYyB2b2lkIGludGVsX3BsYW5lX3JlbWFwX2d0dChzdHJ1
Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCXVuc2lnbmVkIGludCBzcmNfdywg
c3JjX2g7CiAJdTMyIGd0dF9vZmZzZXQgPSAwOwogCi0JbWVtc2V0KCZwbGFuZV9zdGF0ZS0+dmll
dywgMCwgc2l6ZW9mKHBsYW5lX3N0YXRlLT52aWV3KSk7Ci0JcGxhbmVfc3RhdGUtPnZpZXcudHlw
ZSA9IGRybV9yb3RhdGlvbl85MF9vcl8yNzAocm90YXRpb24pID8KKwltZW1zZXQoJnBsYW5lX3N0
YXRlLT52aWV3Lmd0dCwgMCwgc2l6ZW9mKHBsYW5lX3N0YXRlLT52aWV3Lmd0dCkpOworCXBsYW5l
X3N0YXRlLT52aWV3Lmd0dC50eXBlID0gZHJtX3JvdGF0aW9uXzkwX29yXzI3MChyb3RhdGlvbikg
PwogCQlJOTE1X0dHVFRfVklFV19ST1RBVEVEIDogSTkxNV9HR1RUX1ZJRVdfUkVNQVBQRUQ7CiAK
IAlzcmNfeCA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy54MSA+PiAxNjsKQEAgLTgzNSw4ICs4MzUs
OCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wbGFuZV9yZW1hcF9ndHQoc3RydWN0IGludGVsX3BsYW5l
X3N0YXRlICpwbGFuZV9zdGF0ZSkKIAkJICogRmlyc3QgcGl4ZWwgb2YgdGhlIHNyYyB2aWV3cG9y
dCBmcm9tIHRoZQogCQkgKiBzdGFydCBvZiB0aGUgbm9ybWFsIGd0dCBtYXBwaW5nLgogCQkgKi8K
LQkJeCArPSBpbnRlbF9mYi0+bm9ybWFsW2ldLng7Ci0JCXkgKz0gaW50ZWxfZmItPm5vcm1hbFtp
XS55OworCQl4ICs9IGludGVsX2ZiLT5ub3JtYWxfdmlldy5jb2xvcl9wbGFuZVtpXS54OworCQl5
ICs9IGludGVsX2ZiLT5ub3JtYWxfdmlldy5jb2xvcl9wbGFuZVtpXS55OwogCiAJCW9mZnNldCA9
IGNhbGNfcGxhbmVfYWxpZ25lZF9vZmZzZXQoaW50ZWxfZmIsIGksICZ4LCAmeSk7CiAKQEAgLTg2
MCwxMyArODYwLDEzIEBAIHN0YXRpYyB2b2lkIGludGVsX3BsYW5lX3JlbWFwX2d0dChzdHJ1Y3Qg
aW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCQkJeSA9IHIueTE7CiAKIAkJCXBpdGNo
X3RpbGVzID0gaW5mby0+cGxhbmVbaV0uaGVpZ2h0OwotCQkJcGxhbmVfc3RhdGUtPmNvbG9yX3Bs
YW5lW2ldLnN0cmlkZSA9IHBpdGNoX3RpbGVzICogdGlsZV9oZWlnaHQ7CisJCQlwbGFuZV9zdGF0
ZS0+dmlldy5jb2xvcl9wbGFuZVtpXS5waXRjaCA9IHBpdGNoX3RpbGVzICogdGlsZV9oZWlnaHQ7
CiAKIAkJCS8qIHJvdGF0ZSB0aGUgdGlsZSBkaW1lbnNpb25zIHRvIG1hdGNoIHRoZSBHVFQgdmll
dyAqLwogCQkJc3dhcCh0aWxlX3dpZHRoLCB0aWxlX2hlaWdodCk7CiAJCX0gZWxzZSB7CiAJCQlw
aXRjaF90aWxlcyA9IGluZm8tPnBsYW5lW2ldLndpZHRoOwotCQkJcGxhbmVfc3RhdGUtPmNvbG9y
X3BsYW5lW2ldLnN0cmlkZSA9IHBpdGNoX3RpbGVzICogdGlsZV93aWR0aCAqIGNwcDsKKwkJCXBs
YW5lX3N0YXRlLT52aWV3LmNvbG9yX3BsYW5lW2ldLnBpdGNoID0gcGl0Y2hfdGlsZXMgKiB0aWxl
X3dpZHRoICogY3BwOwogCQl9CiAKIAkJLyoKQEAgLTg4MCw5ICs4ODAsOSBAQCBzdGF0aWMgdm9p
ZCBpbnRlbF9wbGFuZV9yZW1hcF9ndHQoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9z
dGF0ZSkKIAogCQlndHRfb2Zmc2V0ICs9IGluZm8tPnBsYW5lW2ldLndpZHRoICogaW5mby0+cGxh
bmVbaV0uaGVpZ2h0OwogCi0JCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtpXS5vZmZzZXQgPSAw
OwotCQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbaV0ueCA9IHg7Ci0JCXBsYW5lX3N0YXRlLT5j
b2xvcl9wbGFuZVtpXS55ID0geTsKKwkJcGxhbmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbaV0u
b2Zmc2V0ID0gMDsKKwkJcGxhbmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbaV0ueCA9IHg7CisJ
CXBsYW5lX3N0YXRlLT52aWV3LmNvbG9yX3BsYW5lW2ldLnkgPSB5OwogCX0KIH0KIApAQCAtODk1
LDcgKzg5NSw3IEBAIHZvaWQgaW50ZWxfZmlsbF9mYl9nZ3R0X3ZpZXcoc3RydWN0IGk5MTVfZ2d0
dF92aWV3ICp2aWV3LAogCXZpZXctPnR5cGUgPSBJOTE1X0dHVFRfVklFV19OT1JNQUw7CiAJaWYg
KGRybV9yb3RhdGlvbl85MF9vcl8yNzAocm90YXRpb24pKSB7CiAJCXZpZXctPnR5cGUgPSBJOTE1
X0dHVFRfVklFV19ST1RBVEVEOwotCQl2aWV3LT5yb3RhdGVkID0gdG9faW50ZWxfZnJhbWVidWZm
ZXIoZmIpLT5yb3RfaW5mbzsKKwkJdmlldy0+cm90YXRlZCA9IHRvX2ludGVsX2ZyYW1lYnVmZmVy
KGZiKS0+cm90YXRlZF92aWV3Lmd0dC5yb3RhdGVkOwogCX0KIH0KIApAQCAtOTE3LDcgKzkxNyw3
IEBAIHN0YXRpYyBpbnQgaW50ZWxfcGxhbmVfY2hlY2tfc3RyaWRlKGNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJCXJldHVybiAwOwogCiAJLyogRklYTUUgb3Ro
ZXIgY29sb3IgcGxhbmVzPyAqLwotCXN0cmlkZSA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVsw
XS5zdHJpZGU7CisJc3RyaWRlID0gcGxhbmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbMF0ucGl0
Y2g7CiAJbWF4X3N0cmlkZSA9IHBsYW5lLT5tYXhfc3RyaWRlKHBsYW5lLCBmYi0+Zm9ybWF0LT5m
b3JtYXQsCiAJCQkJICAgICAgIGZiLT5tb2RpZmllciwgcm90YXRpb24pOwogCkBAIC05NTUsMTgg
Kzk1NSwxOCBAQCBpbnQgaW50ZWxfcGxhbmVfY29tcHV0ZV9ndHQoc3RydWN0IGludGVsX3BsYW5l
X3N0YXRlICpwbGFuZV9zdGF0ZSkKIAkJcmV0dXJuIGludGVsX3BsYW5lX2NoZWNrX3N0cmlkZShw
bGFuZV9zdGF0ZSk7CiAJfQogCi0JaW50ZWxfZmlsbF9mYl9nZ3R0X3ZpZXcoJnBsYW5lX3N0YXRl
LT52aWV3LCAmZmItPmJhc2UsIHJvdGF0aW9uKTsKKwlpbnRlbF9maWxsX2ZiX2dndHRfdmlldygm
cGxhbmVfc3RhdGUtPnZpZXcuZ3R0LCAmZmItPmJhc2UsIHJvdGF0aW9uKTsKIAogCWZvciAoaSA9
IDA7IGkgPCBudW1fcGxhbmVzOyBpKyspIHsKLQkJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2ld
LnN0cmlkZSA9IGludGVsX2ZiX3BpdGNoKCZmYi0+YmFzZSwgaSwgcm90YXRpb24pOwotCQlwbGFu
ZV9zdGF0ZS0+Y29sb3JfcGxhbmVbaV0ub2Zmc2V0ID0gMDsKKwkJcGxhbmVfc3RhdGUtPnZpZXcu
Y29sb3JfcGxhbmVbaV0ucGl0Y2ggPSBpbnRlbF9mYl9waXRjaCgmZmItPmJhc2UsIGksIHJvdGF0
aW9uKTsKKwkJcGxhbmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbaV0ub2Zmc2V0ID0gMDsKIAog
CQlpZiAoZHJtX3JvdGF0aW9uXzkwX29yXzI3MChyb3RhdGlvbikpIHsKLQkJCXBsYW5lX3N0YXRl
LT5jb2xvcl9wbGFuZVtpXS54ID0gZmItPnJvdGF0ZWRbaV0ueDsKLQkJCXBsYW5lX3N0YXRlLT5j
b2xvcl9wbGFuZVtpXS55ID0gZmItPnJvdGF0ZWRbaV0ueTsKKwkJCXBsYW5lX3N0YXRlLT52aWV3
LmNvbG9yX3BsYW5lW2ldLnggPSBmYi0+cm90YXRlZF92aWV3LmNvbG9yX3BsYW5lW2ldLng7CisJ
CQlwbGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFuZVtpXS55ID0gZmItPnJvdGF0ZWRfdmlldy5j
b2xvcl9wbGFuZVtpXS55OwogCQl9IGVsc2UgewotCQkJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5l
W2ldLnggPSBmYi0+bm9ybWFsW2ldLng7Ci0JCQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbaV0u
eSA9IGZiLT5ub3JtYWxbaV0ueTsKKwkJCXBsYW5lX3N0YXRlLT52aWV3LmNvbG9yX3BsYW5lW2ld
LnggPSBmYi0+bm9ybWFsX3ZpZXcuY29sb3JfcGxhbmVbaV0ueDsKKwkJCXBsYW5lX3N0YXRlLT52
aWV3LmNvbG9yX3BsYW5lW2ldLnkgPSBmYi0+bm9ybWFsX3ZpZXcuY29sb3JfcGxhbmVbaV0ueTsK
IAkJfQogCX0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9mYi5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYi5oCmluZGV4IGJk
MTU1MWM2OTRlYjMuLjhmZmM4ODNhODNjMzQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZmIuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2ZiLmgKQEAgLTE0LDggKzE0LDExIEBAIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlOwog
CiBzdHJ1Y3QgaTkxNV9nZ3R0X3ZpZXc7CiAKK3N0cnVjdCBpbnRlbF9mYl92aWV3Owogc3RydWN0
IGludGVsX3BsYW5lX3N0YXRlOwogCitlbnVtIGk5MTVfZ2d0dF92aWV3X3R5cGU7CisKIGJvb2wg
aXNfY2NzX3BsYW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgcGxhbmUp
OwogYm9vbCBpc19nZW4xMl9jY3NfcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAq
ZmIsIGludCBwbGFuZSk7CiBib29sIGlzX2dlbjEyX2Njc19jY19wbGFuZShjb25zdCBzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IHBsYW5lKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2ZiYy5jCmluZGV4IDg4ZTAyZWUzYTYzMTIuLmY5NTc5NGJkYTUyZWQgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJjLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmMuYwpAQCAtNzE2LDggKzcxNiw4IEBA
IHN0YXRpYyB2b2lkIGludGVsX2ZiY191cGRhdGVfc3RhdGVfY2FjaGUoc3RydWN0IGludGVsX2Ny
dGMgKmNydGMsCiAJICovCiAJY2FjaGUtPnBsYW5lLnNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBs
YW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7CiAJY2FjaGUtPnBsYW5lLnNyY19oID0gZHJtX3Jl
Y3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OwotCWNhY2hlLT5wbGFuZS5h
ZGp1c3RlZF94ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLng7Ci0JY2FjaGUtPnBsYW5l
LmFkanVzdGVkX3kgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ueTsKKwljYWNoZS0+cGxh
bmUuYWRqdXN0ZWRfeCA9IHBsYW5lX3N0YXRlLT52aWV3LmNvbG9yX3BsYW5lWzBdLng7CisJY2Fj
aGUtPnBsYW5lLmFkanVzdGVkX3kgPSBwbGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFuZVswXS55
OwogCiAJY2FjaGUtPnBsYW5lLnBpeGVsX2JsZW5kX21vZGUgPSBwbGFuZV9zdGF0ZS0+aHcucGl4
ZWxfYmxlbmRfbW9kZTsKIApAQCAtNzI1LDcgKzcyNSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2Zi
Y191cGRhdGVfc3RhdGVfY2FjaGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJY2FjaGUtPmZi
Lm1vZGlmaWVyID0gZmItPm1vZGlmaWVyOwogCiAJLyogRklYTUUgaXMgdGhpcyBjb3JyZWN0PyAq
LwotCWNhY2hlLT5mYi5zdHJpZGUgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0uc3RyaWRl
OworCWNhY2hlLT5mYi5zdHJpZGUgPSBwbGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFuZVswXS5w
aXRjaDsKIAlpZiAoZHJtX3JvdGF0aW9uXzkwX29yXzI3MChwbGFuZV9zdGF0ZS0+aHcucm90YXRp
b24pKQogCQljYWNoZS0+ZmIuc3RyaWRlICo9IGZiLT5mb3JtYXQtPmNwcFswXTsKIApkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMKaW5kZXggYWYyZDYxN2Q5ZWIy
Yi4uMmFjZTM2M2Y1YWFjMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9zcHJpdGUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X3Nwcml0ZS5jCkBAIC00MjMsMTUgKzQyMywxNSBAQCB2bHZfdXBkYXRlX3BsYW5lKHN0cnVjdCBp
bnRlbF9wbGFuZSAqcGxhbmUsCiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0gcGxhbmUtPnBpcGU7
CiAJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKLQl1MzIgc3Byc3VyZl9vZmZz
ZXQgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ub2Zmc2V0OworCXUzMiBzcHJzdXJmX29m
ZnNldCA9IHBsYW5lX3N0YXRlLT52aWV3LmNvbG9yX3BsYW5lWzBdLm9mZnNldDsKIAl1MzIgbGlu
ZWFyX29mZnNldDsKIAljb25zdCBzdHJ1Y3QgZHJtX2ludGVsX3Nwcml0ZV9jb2xvcmtleSAqa2V5
ID0gJnBsYW5lX3N0YXRlLT5ja2V5OwogCWludCBjcnRjX3ggPSBwbGFuZV9zdGF0ZS0+dWFwaS5k
c3QueDE7CiAJaW50IGNydGNfeSA9IHBsYW5lX3N0YXRlLT51YXBpLmRzdC55MTsKIAl1MzIgY3J0
Y193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCk7CiAJdTMyIGNydGNf
aCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKLQl1MzIgeCA9IHBs
YW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS54OwotCXUzMiB5ID0gcGxhbmVfc3RhdGUtPmNvbG9y
X3BsYW5lWzBdLnk7CisJdTMyIHggPSBwbGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFuZVswXS54
OworCXUzMiB5ID0gcGxhbmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbMF0ueTsKIAl1bnNpZ25l
ZCBsb25nIGlycWZsYWdzOwogCXUzMiBzcHJjdGw7CiAKQEAgLTQ0Niw3ICs0NDYsNyBAQCB2bHZf
dXBkYXRlX3BsYW5lKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAJc3Bpbl9sb2NrX2lycXNh
dmUoJmRldl9wcml2LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOwogCiAJaW50ZWxfZGVfd3JpdGVf
ZncoZGV2X3ByaXYsIFNQU1RSSURFKHBpcGUsIHBsYW5lX2lkKSwKLQkJCSAgcGxhbmVfc3RhdGUt
PmNvbG9yX3BsYW5lWzBdLnN0cmlkZSk7CisJCQkgIHBsYW5lX3N0YXRlLT52aWV3LmNvbG9yX3Bs
YW5lWzBdLnBpdGNoKTsKIAlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgU1BQT1MocGlwZSwg
cGxhbmVfaWQpLAogCQkJICAoY3J0Y195IDw8IDE2KSB8IGNydGNfeCk7CiAJaW50ZWxfZGVfd3Jp
dGVfZncoZGV2X3ByaXYsIFNQU0laRShwaXBlLCBwbGFuZV9pZCksCkBAIC04NDAsMTUgKzg0MCwx
NSBAQCBpdmJfdXBkYXRlX3BsYW5lKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiB7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYp
OwogCWVudW0gcGlwZSBwaXBlID0gcGxhbmUtPnBpcGU7Ci0JdTMyIHNwcnN1cmZfb2Zmc2V0ID0g
cGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLm9mZnNldDsKKwl1MzIgc3Byc3VyZl9vZmZzZXQg
PSBwbGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFuZVswXS5vZmZzZXQ7CiAJdTMyIGxpbmVhcl9v
ZmZzZXQ7CiAJY29uc3Qgc3RydWN0IGRybV9pbnRlbF9zcHJpdGVfY29sb3JrZXkgKmtleSA9ICZw
bGFuZV9zdGF0ZS0+Y2tleTsKIAlpbnQgY3J0Y194ID0gcGxhbmVfc3RhdGUtPnVhcGkuZHN0Lngx
OwogCWludCBjcnRjX3kgPSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3QueTE7CiAJdTMyIGNydGNfdyA9
IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpOwogCXUzMiBjcnRjX2ggPSBk
cm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCk7Ci0JdTMyIHggPSBwbGFuZV9z
dGF0ZS0+Y29sb3JfcGxhbmVbMF0ueDsKLQl1MzIgeSA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFu
ZVswXS55OworCXUzMiB4ID0gcGxhbmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbMF0ueDsKKwl1
MzIgeSA9IHBsYW5lX3N0YXRlLT52aWV3LmNvbG9yX3BsYW5lWzBdLnk7CiAJdTMyIHNyY193ID0g
ZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7CiAJdTMyIHNyY19o
ID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OwogCXUzMiBz
cHJjdGwsIHNwcnNjYWxlID0gMDsKQEAgLTg3MCw3ICs4NzAsNyBAQCBpdmJfdXBkYXRlX3BsYW5l
KHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAJc3Bpbl9sb2NrX2lycXNhdmUoJmRldl9wcml2
LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOwogCiAJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYs
IFNQUlNUUklERShwaXBlKSwKLQkJCSAgcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLnN0cmlk
ZSk7CisJCQkgIHBsYW5lX3N0YXRlLT52aWV3LmNvbG9yX3BsYW5lWzBdLnBpdGNoKTsKIAlpbnRl
bF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgU1BSUE9TKHBpcGUpLCAoY3J0Y195IDw8IDE2KSB8IGNy
dGNfeCk7CiAJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFNQUlNJWkUocGlwZSksIChjcnRj
X2ggPDwgMTYpIHwgY3J0Y193KTsKIAlpZiAoSVNfSVZZQlJJREdFKGRldl9wcml2KSkKQEAgLTEx
NjgsMTUgKzExNjgsMTUgQEAgZzR4X3VwZGF0ZV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBs
YW5lLAogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxh
bmUtPmJhc2UuZGV2KTsKIAllbnVtIHBpcGUgcGlwZSA9IHBsYW5lLT5waXBlOwotCXUzMiBkdnNz
dXJmX29mZnNldCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS5vZmZzZXQ7CisJdTMyIGR2
c3N1cmZfb2Zmc2V0ID0gcGxhbmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbMF0ub2Zmc2V0Owog
CXUzMiBsaW5lYXJfb2Zmc2V0OwogCWNvbnN0IHN0cnVjdCBkcm1faW50ZWxfc3ByaXRlX2NvbG9y
a2V5ICprZXkgPSAmcGxhbmVfc3RhdGUtPmNrZXk7CiAJaW50IGNydGNfeCA9IHBsYW5lX3N0YXRl
LT51YXBpLmRzdC54MTsKIAlpbnQgY3J0Y195ID0gcGxhbmVfc3RhdGUtPnVhcGkuZHN0LnkxOwog
CXUzMiBjcnRjX3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKIAl1
MzIgY3J0Y19oID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpOwotCXUz
MiB4ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLng7Ci0JdTMyIHkgPSBwbGFuZV9zdGF0
ZS0+Y29sb3JfcGxhbmVbMF0ueTsKKwl1MzIgeCA9IHBsYW5lX3N0YXRlLT52aWV3LmNvbG9yX3Bs
YW5lWzBdLng7CisJdTMyIHkgPSBwbGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFuZVswXS55Owog
CXUzMiBzcmNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2
OwogCXUzMiBzcmNfaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+
PiAxNjsKIAl1MzIgZHZzY250ciwgZHZzc2NhbGUgPSAwOwpAQCAtMTE5OCw3ICsxMTk4LDcgQEAg
ZzR4X3VwZGF0ZV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCXNwaW5fbG9ja19p
cnFzYXZlKCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsKIAogCWludGVsX2RlX3dy
aXRlX2Z3KGRldl9wcml2LCBEVlNTVFJJREUocGlwZSksCi0JCQkgIHBsYW5lX3N0YXRlLT5jb2xv
cl9wbGFuZVswXS5zdHJpZGUpOworCQkJICBwbGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFuZVsw
XS5waXRjaCk7CiAJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIERWU1BPUyhwaXBlKSwgKGNy
dGNfeSA8PCAxNikgfCBjcnRjX3gpOwogCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBEVlNT
SVpFKHBpcGUpLCAoY3J0Y19oIDw8IDE2KSB8IGNydGNfdyk7CiAJaW50ZWxfZGVfd3JpdGVfZnco
ZGV2X3ByaXYsIERWU1NDQUxFKHBpcGUpLCBkdnNzY2FsZSk7CkBAIC0xMjk4LDcgKzEyOTgsNyBA
QCBnNHhfc3ByaXRlX2NoZWNrX3NjYWxpbmcoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCiAJaW50IHNyY194LCBzcmNfdywgc3JjX2gsIGNydGNfdywgY3J0Y19oOwogCWNvbnN0
IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KIAkJJmNydGNfc3RhdGUt
Pmh3LmFkanVzdGVkX21vZGU7Ci0JdW5zaWduZWQgaW50IHN0cmlkZSA9IHBsYW5lX3N0YXRlLT5j
b2xvcl9wbGFuZVswXS5zdHJpZGU7CisJdW5zaWduZWQgaW50IHN0cmlkZSA9IHBsYW5lX3N0YXRl
LT52aWV3LmNvbG9yX3BsYW5lWzBdLnBpdGNoOwogCXVuc2lnbmVkIGludCBjcHAgPSBmYi0+Zm9y
bWF0LT5jcHBbMF07CiAJdW5zaWduZWQgaW50IHdpZHRoX2J5dGVzOwogCWludCBtaW5fd2lkdGgs
IG1pbl9oZWlnaHQ7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L3Nr
bF91bml2ZXJzYWxfcGxhbmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvc2tsX3Vu
aXZlcnNhbF9wbGFuZS5jCmluZGV4IDIyZjdhMTMwMjAxODkuLjAwYTExZmI1MTZlNTIgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvc2tsX3VuaXZlcnNhbF9wbGFuZS5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvc2tsX3VuaXZlcnNhbF9wbGFuZS5j
CkBAIC01ODIsNyArNTgyLDcgQEAgc3RhdGljIHUzMiBza2xfcGxhbmVfc3RyaWRlKGNvbnN0IHN0
cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCiB7CiAJY29uc3Qgc3RydWN0IGRy
bV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJdW5zaWduZWQgaW50IHJv
dGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwotCXUzMiBzdHJpZGUgPSBwbGFuZV9z
dGF0ZS0+Y29sb3JfcGxhbmVbY29sb3JfcGxhbmVdLnN0cmlkZTsKKwl1MzIgc3RyaWRlID0gcGxh
bmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbY29sb3JfcGxhbmVdLnBpdGNoOwogCiAJaWYgKGNv
bG9yX3BsYW5lID49IGZiLT5mb3JtYXQtPm51bV9wbGFuZXMpCiAJCXJldHVybiAwOwpAQCAtOTE5
LDE0ICs5MTksMTQgQEAgc2tsX3Byb2dyYW1fcGxhbmUoc3RydWN0IGludGVsX3BsYW5lICpwbGFu
ZSwKIAllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gcGxhbmUtPmlkOwogCWVudW0gcGlwZSBwaXBl
ID0gcGxhbmUtPnBpcGU7CiAJY29uc3Qgc3RydWN0IGRybV9pbnRlbF9zcHJpdGVfY29sb3JrZXkg
KmtleSA9ICZwbGFuZV9zdGF0ZS0+Y2tleTsKLQl1MzIgc3VyZl9hZGRyID0gcGxhbmVfc3RhdGUt
PmNvbG9yX3BsYW5lW2NvbG9yX3BsYW5lXS5vZmZzZXQ7CisJdTMyIHN1cmZfYWRkciA9IHBsYW5l
X3N0YXRlLT52aWV3LmNvbG9yX3BsYW5lW2NvbG9yX3BsYW5lXS5vZmZzZXQ7CiAJdTMyIHN0cmlk
ZSA9IHNrbF9wbGFuZV9zdHJpZGUocGxhbmVfc3RhdGUsIGNvbG9yX3BsYW5lKTsKIAljb25zdCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAlpbnQgYXV4
X3BsYW5lID0gc2tsX21haW5fdG9fYXV4X3BsYW5lKGZiLCBjb2xvcl9wbGFuZSk7CiAJaW50IGNy
dGNfeCA9IHBsYW5lX3N0YXRlLT51YXBpLmRzdC54MTsKIAlpbnQgY3J0Y195ID0gcGxhbmVfc3Rh
dGUtPnVhcGkuZHN0LnkxOwotCXUzMiB4ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2NvbG9y
X3BsYW5lXS54OwotCXUzMiB5ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2NvbG9yX3BsYW5l
XS55OworCXUzMiB4ID0gcGxhbmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbY29sb3JfcGxhbmVd
Lng7CisJdTMyIHkgPSBwbGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFuZVtjb2xvcl9wbGFuZV0u
eTsKIAl1MzIgc3JjX3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+
PiAxNjsKIAl1MzIgc3JjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLnNy
YykgPj4gMTY7CiAJdTggYWxwaGEgPSBwbGFuZV9zdGF0ZS0+aHcuYWxwaGEgPj4gODsKQEAgLTk1
OCw3ICs5NTgsNyBAQCBza2xfcHJvZ3JhbV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5l
LAogCX0KIAogCWlmIChhdXhfcGxhbmUpIHsKLQkJYXV4X2Rpc3QgPSBwbGFuZV9zdGF0ZS0+Y29s
b3JfcGxhbmVbYXV4X3BsYW5lXS5vZmZzZXQgLSBzdXJmX2FkZHI7CisJCWF1eF9kaXN0ID0gcGxh
bmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbYXV4X3BsYW5lXS5vZmZzZXQgLSBzdXJmX2FkZHI7
CiAKIAkJaWYgKERJU1BMQVlfVkVSKGRldl9wcml2KSA8IDEyKQogCQkJYXV4X2Rpc3QgfD0gc2ts
X3BsYW5lX3N0cmlkZShwbGFuZV9zdGF0ZSwgYXV4X3BsYW5lKTsKQEAgLTEwMDEsNyArMTAwMSw4
IEBAIHNrbF9wcm9ncmFtX3BsYW5lKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAKIAlpZiAo
RElTUExBWV9WRVIoZGV2X3ByaXYpIDwgMTEpCiAJCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2
LCBQTEFORV9BVVhfT0ZGU0VUKHBpcGUsIHBsYW5lX2lkKSwKLQkJCQkgIChwbGFuZV9zdGF0ZS0+
Y29sb3JfcGxhbmVbMV0ueSA8PCAxNikgfCBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMV0ueCk7
CisJCQkJICAocGxhbmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbMV0ueSA8PCAxNikgfAorCQkJ
CSAgIHBsYW5lX3N0YXRlLT52aWV3LmNvbG9yX3BsYW5lWzFdLngpOwogCiAJaWYgKCFkcm1fYXRv
bWljX2NydGNfbmVlZHNfbW9kZXNldCgmY3J0Y19zdGF0ZS0+dWFwaSkpCiAJCWludGVsX3BzcjJf
cHJvZ3JhbV9wbGFuZV9zZWxfZmV0Y2gocGxhbmUsIGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlLCBj
b2xvcl9wbGFuZSk7CkBAIC0xMDMxLDcgKzEwMzIsNyBAQCBza2xfcGxhbmVfYXN5bmNfZmxpcChz
dHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCXVuc2lnbmVkIGxvbmcgaXJxZmxhZ3M7CiAJZW51
bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKIAllbnVtIHBpcGUgcGlwZSA9IHBsYW5l
LT5waXBlOwotCXUzMiBzdXJmX2FkZHIgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ub2Zm
c2V0OworCXUzMiBzdXJmX2FkZHIgPSBwbGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFuZVswXS5v
ZmZzZXQ7CiAJdTMyIHBsYW5lX2N0bCA9IHBsYW5lX3N0YXRlLT5jdGw7CiAKIAlwbGFuZV9jdGwg
fD0gc2tsX3BsYW5lX2N0bF9jcnRjKGNydGNfc3RhdGUpOwpAQCAtMTI2OSw5ICsxMjcwLDkgQEAg
c2tsX2NoZWNrX21haW5fY2NzX2Nvb3JkaW5hdGVzKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUsCiAJCQkgICAgICAgaW50IGNjc19wbGFuZSkKIHsKIAljb25zdCBzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKLQlpbnQgYXV4X3ggPSBw
bGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS54OwotCWludCBhdXhfeSA9IHBsYW5l
X3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLnk7Ci0JdTMyIGF1eF9vZmZzZXQgPSBwbGFu
ZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS5vZmZzZXQ7CisJaW50IGF1eF94ID0gcGxh
bmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbY2NzX3BsYW5lXS54OworCWludCBhdXhfeSA9IHBs
YW5lX3N0YXRlLT52aWV3LmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueTsKKwl1MzIgYXV4X29mZnNl
dCA9IHBsYW5lX3N0YXRlLT52aWV3LmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ub2Zmc2V0OwogCXUz
MiBhbGlnbm1lbnQgPSBpbnRlbF9zdXJmX2FsaWdubWVudChmYiwgY2NzX3BsYW5lKTsKIAlpbnQg
aHN1YjsKIAlpbnQgdnN1YjsKQEAgLTEzMDEsOSArMTMwMiw5IEBAIHNrbF9jaGVja19tYWluX2Nj
c19jb29yZGluYXRlcyhzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAogCWlm
IChhdXhfeCAhPSBtYWluX3ggfHwgYXV4X3kgIT0gbWFpbl95KQogCQlyZXR1cm4gZmFsc2U7CiAK
LQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS5vZmZzZXQgPSBhdXhfb2Zmc2V0
OwotCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLnggPSBhdXhfeDsKLQlwbGFu
ZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS55ID0gYXV4X3k7CisJcGxhbmVfc3RhdGUt
PnZpZXcuY29sb3JfcGxhbmVbY2NzX3BsYW5lXS5vZmZzZXQgPSBhdXhfb2Zmc2V0OworCXBsYW5l
X3N0YXRlLT52aWV3LmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueCA9IGF1eF94OworCXBsYW5lX3N0
YXRlLT52aWV3LmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueSA9IGF1eF95OwogCiAJcmV0dXJuIHRy
dWU7CiB9CkBAIC0xMzE2LDcgKzEzMTcsNyBAQCBpbnQgc2tsX2NhbGNfbWFpbl9zdXJmYWNlX29m
ZnNldChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAogCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsK
IAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsK
IAljb25zdCBpbnQgYXV4X3BsYW5lID0gc2tsX21haW5fdG9fYXV4X3BsYW5lKGZiLCAwKTsKLQlj
b25zdCB1MzIgYXV4X29mZnNldCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVthdXhfcGxhbmVd
Lm9mZnNldDsKKwljb25zdCB1MzIgYXV4X29mZnNldCA9IHBsYW5lX3N0YXRlLT52aWV3LmNvbG9y
X3BsYW5lW2F1eF9wbGFuZV0ub2Zmc2V0OwogCWNvbnN0IHUzMiBhbGlnbm1lbnQgPSBpbnRlbF9z
dXJmX2FsaWdubWVudChmYiwgMCk7CiAJY29uc3QgaW50IHcgPSBkcm1fcmVjdF93aWR0aCgmcGxh
bmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAxNjsKIApAQCAtMTM0NCw3ICsxMzQ1LDcgQEAgaW50IHNr
bF9jYWxjX21haW5fc3VyZmFjZV9vZmZzZXQoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICpwbGFuZV9zdGF0ZSwKIAlpZiAoZmItPm1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9YX1RJ
TEVEKSB7CiAJCWludCBjcHAgPSBmYi0+Zm9ybWF0LT5jcHBbMF07CiAKLQkJd2hpbGUgKCgqeCAr
IHcpICogY3BwID4gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLnN0cmlkZSkgeworCQl3aGls
ZSAoKCp4ICsgdykgKiBjcHAgPiBwbGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFuZVswXS5waXRj
aCkgewogCQkJaWYgKCpvZmZzZXQgPT0gMCkgewogCQkJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+
ZHJtLAogCQkJCQkgICAgIlVuYWJsZSB0byBmaW5kIHN1aXRhYmxlIGRpc3BsYXkgc3VyZmFjZSBv
ZmZzZXQgZHVlIHRvIFgtdGlsaW5nXG4iKTsKQEAgLTE0MDMsOCArMTQwNCw4IEBAIHN0YXRpYyBp
bnQgc2tsX2NoZWNrX21haW5fc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5l
X3N0YXRlKQogCQkJCQkJCQkgICBvZmZzZXQsIG9mZnNldCAtIGFsaWdubWVudCk7CiAJCX0KIAot
CQlpZiAoeCAhPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbYXV4X3BsYW5lXS54IHx8Ci0JCSAg
ICB5ICE9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVthdXhfcGxhbmVdLnkpIHsKKwkJaWYgKHgg
IT0gcGxhbmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbYXV4X3BsYW5lXS54IHx8CisJCSAgICB5
ICE9IHBsYW5lX3N0YXRlLT52aWV3LmNvbG9yX3BsYW5lW2F1eF9wbGFuZV0ueSkgewogCQkJZHJt
X2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCiAJCQkJICAgICJVbmFibGUgdG8gZmluZCBzdWl0YWJs
ZSBkaXNwbGF5IHN1cmZhY2Ugb2Zmc2V0IGR1ZSB0byBDQ1NcbiIpOwogCQkJcmV0dXJuIC1FSU5W
QUw7CkBAIC0xNDEzLDkgKzE0MTQsOSBAQCBzdGF0aWMgaW50IHNrbF9jaGVja19tYWluX3N1cmZh
Y2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAogCWRybV9XQVJOX09O
KCZkZXZfcHJpdi0+ZHJtLCB4ID4gODE5MSB8fCB5ID4gODE5MSk7CiAKLQlwbGFuZV9zdGF0ZS0+
Y29sb3JfcGxhbmVbMF0ub2Zmc2V0ID0gb2Zmc2V0OwotCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFu
ZVswXS54ID0geDsKLQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ueSA9IHk7CisJcGxhbmVf
c3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbMF0ub2Zmc2V0ID0gMDsKKwlwbGFuZV9zdGF0ZS0+dmll
dy5jb2xvcl9wbGFuZVswXS54ID0geDsKKwlwbGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFuZVsw
XS55ID0geTsKIAogCS8qCiAJICogUHV0IHRoZSBmaW5hbCBjb29yZGluYXRlcyBiYWNrIHNvIHRo
YXQgdGhlIHNyYwpAQCAtMTQ1Niw3ICsxNDU3LDcgQEAgc3RhdGljIGludCBza2xfY2hlY2tfbnYx
Ml9hdXhfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCiAJ
aWYgKGlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpKSB7CiAJCWludCBjY3NfcGxhbmUgPSBt
YWluX3RvX2Njc19wbGFuZShmYiwgdXZfcGxhbmUpOwotCQl1MzIgYXV4X29mZnNldCA9IHBsYW5l
X3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLm9mZnNldDsKKwkJdTMyIGF1eF9vZmZzZXQg
PSBwbGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLm9mZnNldDsKIAkJdTMy
IGFsaWdubWVudCA9IGludGVsX3N1cmZfYWxpZ25tZW50KGZiLCB1dl9wbGFuZSk7CiAKIAkJaWYg
KG9mZnNldCA+IGF1eF9vZmZzZXQpCkBAIC0xNDc3LDggKzE0NzgsOCBAQCBzdGF0aWMgaW50IHNr
bF9jaGVja19udjEyX2F1eF9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVf
c3RhdGUpCiAJCQkJCQkJCSAgIG9mZnNldCwgb2Zmc2V0IC0gYWxpZ25tZW50KTsKIAkJfQogCi0J
CWlmICh4ICE9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLnggfHwKLQkJICAg
IHkgIT0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueSkgeworCQlpZiAoeCAh
PSBwbGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLnggfHwKKwkJICAgIHkg
IT0gcGxhbmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbY2NzX3BsYW5lXS55KSB7CiAJCQlkcm1f
ZGJnX2ttcygmaTkxNS0+ZHJtLAogCQkJCSAgICAiVW5hYmxlIHRvIGZpbmQgc3VpdGFibGUgZGlz
cGxheSBzdXJmYWNlIG9mZnNldCBkdWUgdG8gQ0NTXG4iKTsKIAkJCXJldHVybiAtRUlOVkFMOwpA
QCAtMTQ4Nyw5ICsxNDg4LDkgQEAgc3RhdGljIGludCBza2xfY2hlY2tfbnYxMl9hdXhfc3VyZmFj
ZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCiAJZHJtX1dBUk5fT04o
Jmk5MTUtPmRybSwgeCA+IDgxOTEgfHwgeSA+IDgxOTEpOwogCi0JcGxhbmVfc3RhdGUtPmNvbG9y
X3BsYW5lW3V2X3BsYW5lXS5vZmZzZXQgPSBvZmZzZXQ7Ci0JcGxhbmVfc3RhdGUtPmNvbG9yX3Bs
YW5lW3V2X3BsYW5lXS54ID0geDsKLQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbdXZfcGxhbmVd
LnkgPSB5OworCXBsYW5lX3N0YXRlLT52aWV3LmNvbG9yX3BsYW5lW3V2X3BsYW5lXS5vZmZzZXQg
PSAwOworCXBsYW5lX3N0YXRlLT52aWV3LmNvbG9yX3BsYW5lW3V2X3BsYW5lXS54ID0geDsKKwlw
bGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFuZVt1dl9wbGFuZV0ueSA9IHk7CiAKIAlyZXR1cm4g
MDsKIH0KQEAgLTE1MjYsMTMgKzE1MjcsOSBAQCBzdGF0aWMgaW50IHNrbF9jaGVja19jY3NfYXV4
X3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAkJCQkJCQkg
ICAgcGxhbmVfc3RhdGUsCiAJCQkJCQkJICAgIGNjc19wbGFuZSk7CiAKLQkJcGxhbmVfc3RhdGUt
PmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ub2Zmc2V0ID0gb2Zmc2V0OwotCQlwbGFuZV9zdGF0ZS0+
Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS54ID0gKHggKiBoc3ViICsKLQkJCQkJCQkgc3JjX3ggJSBo
c3ViKSAvCi0JCQkJCQkJbWFpbl9oc3ViOwotCQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2Nz
X3BsYW5lXS55ID0gKHkgKiB2c3ViICsKLQkJCQkJCQkgc3JjX3kgJSB2c3ViKSAvCi0JCQkJCQkJ
bWFpbl92c3ViOworCQlwbGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLm9m
ZnNldCA9IG9mZnNldDsKKwkJcGxhbmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbY2NzX3BsYW5l
XS54ID0gKHggKiBoc3ViICsgc3JjX3ggJSBoc3ViKSAvIG1haW5faHN1YjsKKwkJcGxhbmVfc3Rh
dGUtPnZpZXcuY29sb3JfcGxhbmVbY2NzX3BsYW5lXS55ID0gKHkgKiB2c3ViICsgc3JjX3kgJSB2
c3ViKSAvIG1haW5fdnN1YjsKIAl9CiAKIAlyZXR1cm4gMDsKQEAgLTE1NjcsMTAgKzE1NjQsMTAg
QEAgc3RhdGljIGludCBza2xfY2hlY2tfcGxhbmVfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVf
c3RhdGUgKnBsYW5lX3N0YXRlKQogCQkJcmV0dXJuIHJldDsKIAl9CiAKLQlmb3IgKGkgPSBmYi0+
Zm9ybWF0LT5udW1fcGxhbmVzOyBpIDwgQVJSQVlfU0laRShwbGFuZV9zdGF0ZS0+Y29sb3JfcGxh
bmUpOyBpKyspIHsKLQkJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2ldLm9mZnNldCA9IDA7Ci0J
CXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtpXS54ID0gMDsKLQkJcGxhbmVfc3RhdGUtPmNvbG9y
X3BsYW5lW2ldLnkgPSAwOworCWZvciAoaSA9IGZiLT5mb3JtYXQtPm51bV9wbGFuZXM7IGkgPCBB
UlJBWV9TSVpFKHBsYW5lX3N0YXRlLT52aWV3LmNvbG9yX3BsYW5lKTsgaSsrKSB7CisJCXBsYW5l
X3N0YXRlLT52aWV3LmNvbG9yX3BsYW5lW2ldLm9mZnNldCA9IDA7CisJCXBsYW5lX3N0YXRlLT52
aWV3LmNvbG9yX3BsYW5lW2ldLnggPSAwOworCQlwbGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFu
ZVtpXS55ID0gMDsKIAl9CiAKIAlyZXQgPSBza2xfY2hlY2tfbWFpbl9zdXJmYWNlKHBsYW5lX3N0
YXRlKTsKLS0gCjIuMjUuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50
ZWwtZ2Z4Cg==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id E64AB150823
	for <lists+intel-gfx@lfdr.de>; Mon,  3 Feb 2020 15:11:28 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4249B6EC02;
	Mon,  3 Feb 2020 14:11:27 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0048F6EC02
 for <intel-gfx@lists.freedesktop.org>; Mon,  3 Feb 2020 14:11:25 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga005.fm.intel.com ([10.253.24.32])
 by orsmga105.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 03 Feb 2020 06:11:25 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.70,398,1574150400"; d="scan'208";a="429455618"
Received: from slisovsk-lenovo-ideapad-720s-13ikb.fi.intel.com ([10.237.72.89])
 by fmsmga005.fm.intel.com with ESMTP; 03 Feb 2020 06:11:23 -0800
From: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  3 Feb 2020 16:07:46 +0200
Message-Id: <20200203140747.22771-7-stanislav.lisovskiy@intel.com>
X-Mailer: git-send-email 2.24.1.485.gad05a3d8e5
In-Reply-To: <20200203140747.22771-1-stanislav.lisovskiy@intel.com>
References: <20200203140747.22771-1-stanislav.lisovskiy@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v14 6/7] drm/i915: Restrict qgv points which
 don't have enough bandwidth.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWNjb3JkaW5nIHRvIEJTcGVjIDUzOTk4LCB3ZSBzaG91bGQgdHJ5IHRvCnJlc3RyaWN0IHFndiBw
b2ludHMsIHdoaWNoIGNhbid0IHByb3ZpZGUKZW5vdWdoIGJhbmR3aWR0aCBmb3IgZGVzaXJlZCBk
aXNwbGF5IGNvbmZpZ3VyYXRpb24uCgpDdXJyZW50bHkgd2UgYXJlIGp1c3QgY29tcGFyaW5nIGFn
YWluc3QgYWxsIG9mCnRob3NlIGFuZCB0YWtlIG1pbmltdW0od29yc3QgY2FzZSkuCgp2MjogRml4
ZWQgd3JvbmcgUENvZGUgcmVwbHkgbWFzaywgcmVtb3ZlZCBoYXJkY29kZWQKICAgIHZhbHVlcy4K
CnYzOiBGb3JiaWQgc2ltdWx0YW5lb3VzIGxlZ2FjeSBTQUdWIFBDb2RlIHJlcXVlc3RzIGFuZAog
ICAgcmVzdHJpY3RpbmcgcWd2IHBvaW50cy4gUHV0IHRoZSBhY3R1YWwgcmVzdHJpY3Rpb24KICAg
IHRvIGNvbW1pdCBmdW5jdGlvbiwgYWRkZWQgc2VyaWFsaXphdGlvbih0aGFua3MgdG8gVmlsbGUp
CiAgICB0byBwcmV2ZW50IGNvbW1pdCBiZWluZyBhcHBsaWVkIG91dCBvZiBvcmRlciBpbiBjYXNl
IG9mCiAgICBub25ibG9ja2luZyBhbmQvb3Igbm9tb2Rlc2V0IGNvbW1pdHMuCgp2NDoKICAgIC0g
TWlub3IgY29kZSByZWZhY3RvcmluZywgZml4ZWQgZmV3IHR5cG9zKHRoYW5rcyB0byBKYW1lcyBB
dXNtdXMpCiAgICAtIENoYW5nZSB0aGUgbmFtaW5nIG9mIHFndiBwb2ludAogICAgICBtYXNraW5n
L3VubWFza2luZyBmdW5jdGlvbnMoSmFtZXMgQXVzbXVzKS4KICAgIC0gU2ltcGxpZnkgdGhlIG1h
c2tpbmcvdW5tYXNraW5nIG9wZXJhdGlvbiBpdHNlbGYsCiAgICAgIGFzIHdlIGRvbid0IG5lZWQg
dG8gbWFzayBvbmx5IHNpbmdsZSBwb2ludCBwZXIgcmVxdWVzdChKYW1lcyBBdXNtdXMpCiAgICAt
IFJlamVjdCBhbmQgc3RpY2sgdG8gaGlnaGVzdCBiYW5kd2lkdGggcG9pbnQgaWYgU0FHVgogICAg
ICBjYW4ndCBiZSBlbmFibGVkKEJTcGVjKQoKdjU6CiAgICAtIEFkZCBuZXcgbWFpbGJveCByZXBs
eSBjb2Rlcywgd2hpY2ggc2VlbXMgdG8gaGFwcGVuIGR1cmluZyBib290CiAgICAgIHRpbWUgZm9y
IFRHTCBhbmQgaW5kaWNhdGUgdGhhdCBRR1Ygc2V0dGluZyBpcyBub3QgeWV0IGF2YWlsYWJsZS4K
CnY2OgogICAgLSBJbmNyZWFzZSBudW1iZXIgb2Ygc3VwcG9ydGVkIFFHViBwb2ludHMgdG8gYmUg
aW4gc3luYyB3aXRoIEJTcGVjLgoKdjc6IC0gUmViYXNlZCBhbmQgcmVzb2x2ZWQgY29uZmxpY3Qg
dG8gZml4IGJ1aWxkIGZhaWx1cmUuCiAgICAtIEZpeCBOVU1fUUdWX1BPSU5UUyB0byA4IGFuZCBt
b3ZlZCB0aGF0IHRvIGhlYWRlciBmaWxlKEphbWVzIEF1c211cykKCnY4OiAtIERvbid0IHJlcG9y
dCBhbiBlcnJvciBpZiB3ZSBjYW4ndCByZXN0cmljdCBxZ3YgcG9pbnRzLCBhcyBTQUdWCiAgICAg
IGNhbiBiZSBkaXNhYmxlZCBieSBCSU9TLCB3aGljaCBpcyBjb21wbGV0ZWx5IGxlZ2FsLiBTbyBk
b24ndAogICAgICBtYWtlIENJIHBhbmljLiBJbnN0ZWFkIGlmIHdlIGRldGVjdCB0aGF0IHRoZXJl
IGlzIG9ubHkgMSBRR1YKICAgICAgcG9pbnQgYWNjZXNzaWJsZSBqdXN0IGFuYWx5emUgaWYgd2Ug
Y2FuIGZpdCB0aGUgcmVxdWlyZWQgYmFuZHdpZHRoCiAgICAgIHJlcXVpcmVtZW50cywgYnV0IG5v
IG5lZWQgaW4gcmVzdHJpY3RpbmcuCgp2OTogLSBGaXggd3JvbmcgUUdWIHRyYW5zaXRpb24gaWYg
d2UgaGF2ZSAwIHBsYW5lcyBhbmQgbm8gU0FHVgogICAgICBzaW11bHRhbmVvdXNseS4KCnYxMDog
LSBGaXggQ0RDTEsgY29ycnVwdGlvbiwgYmVjYXVzZSBvZiBnbG9iYWwgc3RhdGUgZ2V0dGluZyBz
ZXJpYWxpemVkCiAgICAgICB3aXRob3V0IG1vZGVzZXQsIHdoaWNoIGNhdXNlZCBjb3B5aW5nIG9m
IG5vbi1jYWxjdWxhdGVkIGNkY2xrCiAgICAgICB0byBiZSBjb3BpZWQgdG8gZGV2X3ByaXYodGhh
bmtzIHRvIFZpbGxlIGZvciB0aGUgaGludCkuCgp2MTE6IC0gUmVtb3ZlIHVubmVlZGVkIGhlYWRl
cnMgYW5kIHNwYWNlcyhNYXR0aGV3IFJvcGVyKQogICAgIC0gUmVtb3ZlIHVubmVlZGVkIGludGVs
X3Fndl9pbmZvIHFpIHN0cnVjdCBmcm9tIGJ3IGNoZWNrIGFuZCB6ZXJvCiAgICAgICBvdXQgdGhl
IG5lZWRlZCBvbmUoTWF0dGhldyBSb3BlcikKICAgICAtIENoYW5nZWQgUUdWIGVycm9yIG1lc3Nh
Z2UgdG8gaGF2ZSBtb3JlIGNsZWFyIG1lYW5pbmcoTWF0dGhldyBSb3BlcikKICAgICAtIFVzZSBz
dGF0ZS0+bW9kZXNldF9zZXQgaW5zdGVhZCBvZiBhbnlfbXMoTWF0dGhldyBSb3BlcikKICAgICAt
IE1vdmVkIE5VTV9TQUdWX1BPSU5UUyBmcm9tIGk5MTVfcmVnLmggdG8gaTkxNV9kcnYuaCB3aGVy
ZSBpdCdzIHVzZWQKICAgICAtIEtlZXAgdXNpbmcgY3J0Y19zdGF0ZS0+aHcuYWN0aXZlIGluc3Rl
YWQgb2YgLmVuYWJsZShNYXR0aGV3IFJvcGVyKQogICAgIC0gTW92ZWQgdW5yZWxhdGVkIGNoYW5n
ZXMgdG8gb3RoZXIgcGF0Y2godXNpbmcgbGF0ZW5jeSBhcyBwYXJhbWV0ZXIKICAgICAgIGZvciBw
bGFuZSB3bSBjYWxjdWxhdGlvbiwgbW92ZWQgdG8gU0FHViByZWZhY3RvcmluZyBwYXRjaCkKCnYx
MjogLSBGaXggcmViYXNlIGNvbmZsaWN0IHdpdGggb3duIHRlbXBvcmFyeSBTQUdWL1FHViBmaXgu
CiAgICAgLSBSZW1vdmUgdW5uZWNlc3NhcnkgbWFzayBiZWluZyB6ZXJvIGNoZWNrIHdoZW4gdW5t
YXNraW5nCiAgICAgICBxZ3YgcG9pbnRzIGFzIHRoaXMgaXMgY29tcGxldGVseSBsZWdhbChNYXR0
IFJvcGVyKQogICAgIC0gQ2hlY2sgaWYgd2UgYXJlIHNldHRpbmcgdGhlIHNhbWUgbWFzayBhcyBh
bHJlYWR5IGJlaW5nIHNldAogICAgICAgaW4gaGFyZHdhcmUgdG8gcHJldmVudCBlcnJvciBmcm9t
IFBDb2RlLgogICAgIC0gRml4IGVycm9yIG1lc3NhZ2Ugd2hlbiByZXN0cmljdGluZy91bnJlc3Ry
aWN0aW5nIHFndiBwb2ludHMKICAgICAgIHRvICJtYXNrL3VubWFzayIgd2hpY2ggc291bmRzIG1v
cmUgYWNjdXJhdGUoTWF0dCBSb3BlcikKICAgICAtIE1vdmUgc2FndiBzdGF0dXMgc2V0dGluZyB0
byBpY2xfZ2V0X2J3X2luZm8gZnJvbSBhdG9taWMgY2hlY2sKICAgICAgIGFzIHRoaXMgc2hvdWxk
IGJlIGNhbGN1bGF0ZWQgb25seSBvbmNlLihNYXR0IFJvcGVyKQogICAgIC0gRWRpdGVkIGNvbW1l
bnRzIGZvciB0aGUgY2FzZSB3aGVuIHdlIGNhbid0IGVuYWJsZSBTQUdWIGFuZAogICAgICAgdXNl
IG9ubHkgMSBRR1YgcG9pbnQgd2l0aCBoaWdoZXN0IGJhbmR3aWR0aCB0byBiZSBtb3JlCiAgICAg
ICB1bmRlcnN0YW5kYWJsZS4oTWF0dCBSb3BlcikKCnYxMzogLSBNb3ZlZCBtYXhfZGF0YV9yYXRl
IGluIGJ3IGNoZWNrIHRvIGNsb3NlciBzY29wZShWaWxsZSBTeXJqw6Rsw6QpCiAgICAgLSBDaGFu
Z2VkIGNvbW1lbnQgZm9yIHplcm8gbmV3X21hc2sgaW4gcWd2IHBvaW50cyBtYXNraW5nIGZ1bmN0
aW9uCiAgICAgICB0byBiZXR0ZXIgcmVmbGVjdCByZWFsaXR5KFZpbGxlIFN5cmrDpGzDpCkKICAg
ICAtIFNpbXBsaWZpZWQgYml0IG1hc2sgb3BlcmF0aW9uIGluIHFndiBwb2ludHMgbWFza2luZyBm
dW5jdGlvbgogICAgICAgKFZpbGxlIFN5cmrDpGzDpCkKICAgICAtIE1vdmVkIGludGVsX3Fndl9w
b2ludHNfbWFzayBjbG9zZXIgdG8gZ2VuMTEgU0FHViBkaXNhYmxpbmcsCiAgICAgICBob3dldmVy
IHRoaXMgc3RpbGwgY2FuJ3QgYmUgdW5kZXIgbW9kZXNldCBjb25kaXRpb24oVmlsbGUgU3lyasOk
bMOkKQogICAgIC0gUGFja2VkIHFndl9wb2ludHNfbWFzayBhcyB1OCBhbmQgbW92ZWQgY2xvc2Vy
IHRvIHBpcGVfc2Fndl9tYXNrCiAgICAgICAoVmlsbGUgU3lyasOkbMOkKQogICAgIC0gRXh0cmFj
dGVkIFBDb2RlIGNoYW5nZXMgdG8gc2VwYXJhdGUgcGF0Y2guKFZpbGxlIFN5cmrDpGzDpCkKICAg
ICAtIE5vdyB0cmVhdCBudW1fcGxhbmVzIDAgc2FtZSBhcyAxIHRvIGF2b2lkIGNvbmZ1c2lvbiBh
bmQKICAgICAgIHJldHVybmluZyBtYXhfYncgYXMgMCwgd2hpY2ggd291bGQgcHJldmVudCBjaG9v
c2luZyBRR1YKICAgICAgIHBvaW50IGhhdmluZyBtYXggYmFuZHdpZHRoIGluIGNhc2UgaWYgU0FH
ViBpcyBub3QgYWxsb3dlZCwKICAgICAgIGFzIHBlciBCU3BlYyhWaWxsZSBTeXJqw6Rsw6QpCiAg
ICAgLSBEbyB0aGUgYWN0dWFsIHFndl9wb2ludHNfbWFzayBzd2FwIGluIHRoZSBzYW1lIHBsYWNl
IGFzCiAgICAgICBhbGwgb3RoZXIgZ2xvYmFsIHN0YXRlIHBhcnRzIGxpa2UgY2RjbGsgYXJlIHN3
YXBwZWQuCiAgICAgICBJbiB0aGUgbmV4dCBwYXRjaCwgdGhpcyBhbGwgd2lsbCBiZSBtb3ZlZCB0
byBidyBzdGF0ZSBhcwogICAgICAgZ2xvYmFsIHN0YXRlLCBvbmNlIG5ldyBnbG9iYWwgc3RhdGUg
cGF0Y2ggc2VyaWVzIGZyb20gVmlsbGUKICAgICAgIGxhbmRzCgp2MTQ6IC0gTm93IHVzaW5nIGds
b2JhbCBzdGF0ZSB0byBzZXJpYWxpemUgYWNjZXNzIHRvIHFndiBwb2ludHMKClNpZ25lZC1vZmYt
Ynk6IFN0YW5pc2xhdiBMaXNvdnNraXkgPHN0YW5pc2xhdi5saXNvdnNraXlAaW50ZWwuY29tPgpD
YzogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGludGVsLmNvbT4KQ2M6IEphbWVzIEF1
c211cyA8amFtZXMuYXVzbXVzQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2J3LmMgICAgICB8IDE2NSArKysrKysrKysrKysrLS0tLS0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2J3LmggICAgICB8ICAgOSArCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyB8IDEwOSArKysrKysrKysrKysKIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggICAgICAgICAgICAgIHwgICAzICsKIDQgZmls
ZXMgY2hhbmdlZCwgMjM2IGluc2VydGlvbnMoKyksIDUwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYncuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYncuYwppbmRleCBjMDE2OGRmZTg4ODQuLjk4MTg5MWQy
NzVkOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9idy5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYncuYwpAQCAtOCw2ICs4
LDkgQEAKICNpbmNsdWRlICJpbnRlbF9idy5oIgogI2luY2x1ZGUgImludGVsX2Rpc3BsYXlfdHlw
ZXMuaCIKICNpbmNsdWRlICJpbnRlbF9zaWRlYmFuZC5oIgorI2luY2x1ZGUgImludGVsX2F0b21p
Yy5oIgorI2luY2x1ZGUgImludGVsX3BtLmgiCisKIAogLyogUGFyYW1ldGVycyBmb3IgUWNsayBH
ZXlzZXJ2aWxsZSAoUUdWKSAqLwogc3RydWN0IGludGVsX3Fndl9wb2ludCB7CkBAIC0xMTMsNiAr
MTE2LDI2IEBAIHN0YXRpYyBpbnQgaWNsX3Bjb2RlX3JlYWRfcWd2X3BvaW50X2luZm8oc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCXJldHVybiAwOwogfQogCitpbnQgaWNsX3Bj
b2RlX3Jlc3RyaWN0X3Fndl9wb2ludHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAorCQkJCSAgdTMyIHBvaW50c19tYXNrKQoreworCWludCByZXQ7CisKKwkvKiBic3BlYyBzYXlz
IHRvIGtlZXAgcmV0cnlpbmcgZm9yIGF0IGxlYXN0IDEgbXMgKi8KKwlyZXQgPSBza2xfcGNvZGVf
cmVxdWVzdChkZXZfcHJpdiwgSUNMX1BDT0RFX1NBR1ZfREVfTUVNX1NTX0NPTkZJRywKKwkJCQlw
b2ludHNfbWFzaywKKwkJCQlHRU4xMV9QQ09ERV9QT0lOVFNfUkVTVFJJQ1RFRF9NQVNLLAorCQkJ
CUdFTjExX1BDT0RFX1BPSU5UU19SRVNUUklDVEVELAorCQkJCTEpOworCisJaWYgKHJldCA8IDAp
IHsKKwkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gZGlzYWJsZSBxZ3YgcG9pbnRzICglZClcbiIsIHJl
dCk7CisJCXJldHVybiByZXQ7CisJfQorCisJcmV0dXJuIDA7Cit9CisKIHN0YXRpYyBpbnQgaWNs
X2dldF9xZ3ZfcG9pbnRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCSAg
ICAgIHN0cnVjdCBpbnRlbF9xZ3ZfaW5mbyAqcWkpCiB7CkBAIC0yMzksNiArMjYyLDE2IEBAIHN0
YXRpYyBpbnQgaWNsX2dldF9id19pbmZvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwgY29uc3Qgc3RydWN0IGludGVsCiAJCQlicmVhazsKIAl9CiAKKwkvKgorCSAqIEluIGNhc2Ug
aWYgU0FHViBpcyBkaXNhYmxlZCBpbiBCSU9TLCB3ZSBhbHdheXMgZ2V0IDEKKwkgKiBTQUdWIHBv
aW50LCBidXQgd2UgY2FuJ3Qgc2VuZCBQQ29kZSBjb21tYW5kcyB0byByZXN0cmljdCBpdAorCSAq
IGFzIGl0IHdpbGwgZmFpbCBhbmQgcG9pbnRsZXNzIGFueXdheS4KKwkgKi8KKwlpZiAocWkubnVt
X3BvaW50cyA9PSAxKQorCQlkZXZfcHJpdi0+c2Fndl9zdGF0dXMgPSBJOTE1X1NBR1ZfTk9UX0NP
TlRST0xMRUQ7CisJZWxzZQorCQlkZXZfcHJpdi0+c2Fndl9zdGF0dXMgPSBJOTE1X1NBR1ZfRU5B
QkxFRDsKKwogCXJldHVybiAwOwogfQogCkBAIC0yNTgsNyArMjkxLDcgQEAgc3RhdGljIHVuc2ln
bmVkIGludCBpY2xfbWF4X2J3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJ
aWYgKHFndl9wb2ludCA+PSBiaS0+bnVtX3Fndl9wb2ludHMpCiAJCQlyZXR1cm4gVUlOVF9NQVg7
CiAKLQkJaWYgKG51bV9wbGFuZXMgPj0gYmktPm51bV9wbGFuZXMpCisJCWlmIChudW1fcGxhbmVz
ID49IGJpLT5udW1fcGxhbmVzIHx8ICFudW1fcGxhbmVzKQogCQkJcmV0dXJuIGJpLT5kZXJhdGVk
YndbcWd2X3BvaW50XTsKIAl9CiAKQEAgLTI3NiwzNCArMzA5LDYgQEAgdm9pZCBpbnRlbF9id19p
bml0X2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJaWNsX2dldF9id19p
bmZvKGRldl9wcml2LCAmaWNsX3NhX2luZm8pOwogfQogCi1zdGF0aWMgdW5zaWduZWQgaW50IGlu
dGVsX21heF9kYXRhX3JhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAotCQkJ
CQlpbnQgbnVtX3BsYW5lcykKLXsKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkgewot
CQkvKgotCQkgKiBBbnkgYncgZ3JvdXAgaGFzIHNhbWUgYW1vdW50IG9mIFFHViBwb2ludHMKLQkJ
ICovCi0JCWNvbnN0IHN0cnVjdCBpbnRlbF9id19pbmZvICpiaSA9Ci0JCQkmZGV2X3ByaXYtPm1h
eF9id1swXTsKLQkJdW5zaWduZWQgaW50IG1pbl9idyA9IFVJTlRfTUFYOwotCQlpbnQgaTsKLQot
CQkvKgotCQkgKiBGSVhNRSB3aXRoIFNBR1YgZGlzYWJsZWQgbWF5YmUgd2UgY2FuIGFzc3VtZQot
CQkgKiBwb2ludCAxIHdpbGwgYWx3YXlzIGJlIHVzZWQ/IFNlZW1zIHRvIG1hdGNoCi0JCSAqIHRo
ZSBiZWhhdmlvdXIgb2JzZXJ2ZWQgaW4gdGhlIHdpbGQuCi0JCSAqLwotCQlmb3IgKGkgPSAwOyBp
IDwgYmktPm51bV9xZ3ZfcG9pbnRzOyBpKyspIHsKLQkJCXVuc2lnbmVkIGludCBidyA9IGljbF9t
YXhfYncoZGV2X3ByaXYsIG51bV9wbGFuZXMsIGkpOwotCi0JCQltaW5fYncgPSBtaW4oYncsIG1p
bl9idyk7Ci0JCX0KLQkJcmV0dXJuIG1pbl9idzsKLQl9IGVsc2UgewotCQlyZXR1cm4gVUlOVF9N
QVg7Ci0JfQotfQotCiBzdGF0aWMgdW5zaWduZWQgaW50IGludGVsX2J3X2NydGNfbnVtX2FjdGl2
ZV9wbGFuZXMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJ
LyoKQEAgLTQxNiwxMSArNDIxLDE2IEBAIGludCBpbnRlbF9id19hdG9taWNfY2hlY2soc3RydWN0
IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpuZXdfY3J0Y19zdGF0ZSwgKm9sZF9jcnRjX3N0YXRlOwotCXN0cnVjdCBpbnRlbF9i
d19zdGF0ZSAqYndfc3RhdGUgPSBOVUxMOwotCXVuc2lnbmVkIGludCBkYXRhX3JhdGUsIG1heF9k
YXRhX3JhdGU7CisJc3RydWN0IGludGVsX2J3X3N0YXRlICpuZXdfYndfc3RhdGUgPSBOVUxMOwor
CXN0cnVjdCBpbnRlbF9id19zdGF0ZSAqb2xkX2J3X3N0YXRlID0gTlVMTDsKKwl1bnNpZ25lZCBp
bnQgZGF0YV9yYXRlOwogCXVuc2lnbmVkIGludCBudW1fYWN0aXZlX3BsYW5lczsKIAlzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YzsKIAlpbnQgaSwgcmV0OworCXUzMiBhbGxvd2VkX3BvaW50cyA9IDA7
CisJdW5zaWduZWQgaW50IG1heF9id19wb2ludCA9IDAsIG1heF9idyA9IDA7CisJdW5zaWduZWQg
aW50IG51bV9xZ3ZfcG9pbnRzID0gZGV2X3ByaXYtPm1heF9id1swXS5udW1fcWd2X3BvaW50czsK
Kwl1MzIgbWFzayA9ICgxIDw8IG51bV9xZ3ZfcG9pbnRzKSAtIDE7CiAKIAkvKiBGSVhNRSBlYXJs
aWVyIGdlbnMgbmVlZCBzb21lIGNoZWNrcyB0b28gKi8KIAlpZiAoSU5URUxfR0VOKGRldl9wcml2
KSA8IDExKQpAQCAtNDQ1LDQxICs0NTUsOTYgQEAgaW50IGludGVsX2J3X2F0b21pY19jaGVjayhz
dHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJICAgIG9sZF9hY3RpdmVfcGxhbmVz
ID09IG5ld19hY3RpdmVfcGxhbmVzKQogCQkJY29udGludWU7CiAKLQkJYndfc3RhdGUgID0gaW50
ZWxfYXRvbWljX2dldF9id19zdGF0ZShzdGF0ZSk7Ci0JCWlmIChJU19FUlIoYndfc3RhdGUpKQot
CQkJcmV0dXJuIFBUUl9FUlIoYndfc3RhdGUpOworCQluZXdfYndfc3RhdGUgPSBpbnRlbF9hdG9t
aWNfZ2V0X25ld19id19zdGF0ZShzdGF0ZSk7CisJCWlmIChJU19FUlIobmV3X2J3X3N0YXRlKSkK
KwkJCXJldHVybiBQVFJfRVJSKG5ld19id19zdGF0ZSk7CiAKLQkJYndfc3RhdGUtPmRhdGFfcmF0
ZVtjcnRjLT5waXBlXSA9IG5ld19kYXRhX3JhdGU7Ci0JCWJ3X3N0YXRlLT5udW1fYWN0aXZlX3Bs
YW5lc1tjcnRjLT5waXBlXSA9IG5ld19hY3RpdmVfcGxhbmVzOworCQluZXdfYndfc3RhdGUtPmRh
dGFfcmF0ZVtjcnRjLT5waXBlXSA9IG5ld19kYXRhX3JhdGU7CisJCW5ld19id19zdGF0ZS0+bnVt
X2FjdGl2ZV9wbGFuZXNbY3J0Yy0+cGlwZV0gPSBuZXdfYWN0aXZlX3BsYW5lczsKIAogCQlkcm1f
ZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKIAkJCSAgICAicGlwZSAlYyBkYXRhIHJhdGUgJXUgbnVt
IGFjdGl2ZSBwbGFuZXMgJXVcbiIsCiAJCQkgICAgcGlwZV9uYW1lKGNydGMtPnBpcGUpLAotCQkJ
ICAgIGJ3X3N0YXRlLT5kYXRhX3JhdGVbY3J0Yy0+cGlwZV0sCi0JCQkgICAgYndfc3RhdGUtPm51
bV9hY3RpdmVfcGxhbmVzW2NydGMtPnBpcGVdKTsKKwkJCSAgICBuZXdfYndfc3RhdGUtPmRhdGFf
cmF0ZVtjcnRjLT5waXBlXSwKKwkJCSAgICBuZXdfYndfc3RhdGUtPm51bV9hY3RpdmVfcGxhbmVz
W2NydGMtPnBpcGVdKTsKIAl9CiAKLQlpZiAoIWJ3X3N0YXRlKQorCWlmICghbmV3X2J3X3N0YXRl
KQogCQlyZXR1cm4gMDsKIAotCXJldCA9IGludGVsX2F0b21pY19sb2NrX2dsb2JhbF9zdGF0ZSgm
Yndfc3RhdGUtPmJhc2UpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7CisJZGF0YV9yYXRlID0g
aW50ZWxfYndfZGF0YV9yYXRlKGRldl9wcml2LCBuZXdfYndfc3RhdGUpOworCW51bV9hY3RpdmVf
cGxhbmVzID0gaW50ZWxfYndfbnVtX2FjdGl2ZV9wbGFuZXMoZGV2X3ByaXYsIG5ld19id19zdGF0
ZSk7CiAKLQlkYXRhX3JhdGUgPSBpbnRlbF9id19kYXRhX3JhdGUoZGV2X3ByaXYsIGJ3X3N0YXRl
KTsKLQludW1fYWN0aXZlX3BsYW5lcyA9IGludGVsX2J3X251bV9hY3RpdmVfcGxhbmVzKGRldl9w
cml2LCBid19zdGF0ZSk7CisJZGF0YV9yYXRlID0gRElWX1JPVU5EX1VQKGRhdGFfcmF0ZSwgMTAw
MCk7CiAKLQltYXhfZGF0YV9yYXRlID0gaW50ZWxfbWF4X2RhdGFfcmF0ZShkZXZfcHJpdiwgbnVt
X2FjdGl2ZV9wbGFuZXMpOworCWZvciAoaSA9IDA7IGkgPCBudW1fcWd2X3BvaW50czsgaSsrKSB7
CisJCXVuc2lnbmVkIGludCBtYXhfZGF0YV9yYXRlOwogCi0JZGF0YV9yYXRlID0gRElWX1JPVU5E
X1VQKGRhdGFfcmF0ZSwgMTAwMCk7CisJCW1heF9kYXRhX3JhdGUgPSBpY2xfbWF4X2J3KGRldl9w
cml2LCBudW1fYWN0aXZlX3BsYW5lcywgaSk7CisJCS8qCisJCSAqIFdlIG5lZWQgdG8ga25vdyB3
aGljaCBxZ3YgcG9pbnQgZ2l2ZXMgdXMKKwkJICogbWF4aW11bSBiYW5kd2lkdGggaW4gb3JkZXIg
dG8gZGlzYWJsZSBTQUdWCisJCSAqIGlmIHdlIGZpbmQgdGhhdCB3ZSBleGNlZWQgU0FHViBibG9j
ayB0aW1lCisJCSAqIHdpdGggd2F0ZXJtYXJrcy4gQnkgdGhhdCBtb21lbnQgd2UgYWxyZWFkeQor
CQkgKiBoYXZlIHRob3NlLCBhcyBpdCBpcyBjYWxjdWxhdGVkIGVhcmxpZXIgaW4KKwkJICogaW50
ZWxfYXRvbWljX2NoZWNrLAorCQkgKi8KKwkJaWYgKG1heF9kYXRhX3JhdGUgPiBtYXhfYncpIHsK
KwkJCW1heF9id19wb2ludCA9IGk7CisJCQltYXhfYncgPSBtYXhfZGF0YV9yYXRlOworCQl9CisJ
CWlmIChtYXhfZGF0YV9yYXRlID49IGRhdGFfcmF0ZSkKKwkJCWFsbG93ZWRfcG9pbnRzIHw9IEJJ
VChpKTsKKwkJRFJNX0RFQlVHX0tNUygiUUdWIHBvaW50ICVkOiBtYXggYncgJWQgcmVxdWlyZWQg
JWRcbiIsCisJCQkgICAgICBpLCBtYXhfZGF0YV9yYXRlLCBkYXRhX3JhdGUpOworCX0KIAotCWlm
IChkYXRhX3JhdGUgPiBtYXhfZGF0YV9yYXRlKSB7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+
ZHJtLAotCQkJICAgICJCYW5kd2lkdGggJXUgTUIvcyBleGNlZWRzIG1heCBhdmFpbGFibGUgJWQg
TUIvcyAoJWQgYWN0aXZlIHBsYW5lcylcbiIsCi0JCQkgICAgZGF0YV9yYXRlLCBtYXhfZGF0YV9y
YXRlLCBudW1fYWN0aXZlX3BsYW5lcyk7CisJLyoKKwkgKiBCU3BlYyBzdGF0ZXMgdGhhdCB3ZSBh
bHdheXMgc2hvdWxkIGhhdmUgYXQgbGVhc3Qgb25lIGFsbG93ZWQgcG9pbnQKKwkgKiBsZWZ0LCBz
byBpZiB3ZSBjb3VsZG4ndCAtIHNpbXBseSByZWplY3QgdGhlIGNvbmZpZ3VyYXRpb24gZm9yIG9i
dmlvdXMKKwkgKiByZWFzb25zLgorCSAqLworCWlmIChhbGxvd2VkX3BvaW50cyA9PSAwKSB7CisJ
CURSTV9ERUJVR19LTVMoIk5vIFFHViBwb2ludHMgcHJvdmlkZSBzdWZmaWNpZW50IG1lbW9yeSIK
KwkJCSAgICAgICIgYmFuZHdpZHRoIGZvciBkaXNwbGF5IGNvbmZpZ3VyYXRpb24uXG4iKTsKIAkJ
cmV0dXJuIC1FSU5WQUw7CiAJfQogCisJLyoKKwkgKiBMZWF2ZSBvbmx5IHNpbmdsZSBwb2ludCB3
aXRoIGhpZ2hlc3QgYmFuZHdpZHRoLCBpZgorCSAqIHdlIGNhbid0IGVuYWJsZSBTQUdWIGR1ZSB0
byB0aGUgaW5jcmVhc2VkIG1lbW9yeSBsYXRlbmN5IGl0IG1heQorCSAqIGNhdXNlLgorCSAqLwor
CWlmICghaW50ZWxfY2FuX2VuYWJsZV9zYWd2X2Zvcl9zdGF0ZShzdGF0ZSkpIHsKKwkJYWxsb3dl
ZF9wb2ludHMgPSAxIDw8IG1heF9id19wb2ludDsKKwkJRFJNX0RFQlVHX0tNUygiTm8gU0FHViwg
dXNpbmcgc2luZ2xlIFFHViBwb2ludCAlZFxuIiwKKwkJCSAgICAgIG1heF9id19wb2ludCk7CisJ
fQorCS8qCisJICogV2Ugc3RvcmUgdGhlIG9uZXMgd2hpY2ggbmVlZCB0byBiZSBtYXNrZWQgYXMg
dGhhdCBpcyB3aGF0IFBDb2RlCisJICogYWN0dWFsbHkgYWNjZXB0cyBhcyBhIHBhcmFtZXRlci4K
KwkgKi8KKwluZXdfYndfc3RhdGUtPnFndl9wb2ludHNfbWFzayA9ICh+YWxsb3dlZF9wb2ludHMp
ICYgbWFzazsKKworCURSTV9ERUJVR19LTVMoIk5ldyBzdGF0ZSAlcCBxZ3YgbWFzayAleFxuIiwK
KwkJICAgICAgc3RhdGUsIG5ld19id19zdGF0ZS0+cWd2X3BvaW50c19tYXNrKTsKKworCW9sZF9i
d19zdGF0ZSA9IGludGVsX2F0b21pY19nZXRfb2xkX2J3X3N0YXRlKHN0YXRlKTsKKwlpZiAoSVNf
RVJSKG9sZF9id19zdGF0ZSkpCisJCXJldHVybiBQVFJfRVJSKG9sZF9id19zdGF0ZSk7CisKKwkv
KgorCSAqIElmIHRoZSBhY3R1YWwgbWFzayBoYWQgY2hhbmdlZCB3ZSBuZWVkIHRvIG1ha2Ugc3Vy
ZSB0aGF0CisJICogdGhlIGNvbW1pdHMgYXJlIHNlcmlhbGl6ZWQoaW4gY2FzZSB0aGlzIGlzIGEg
bm9tb2Rlc2V0LCBub25ibG9ja2luZykKKwkgKi8KKwlpZiAobmV3X2J3X3N0YXRlLT5xZ3ZfcG9p
bnRzX21hc2sgIT0gb2xkX2J3X3N0YXRlLT5xZ3ZfcG9pbnRzX21hc2spIHsKKwkJcmV0ID0gaW50
ZWxfYXRvbWljX3NlcmlhbGl6ZV9nbG9iYWxfc3RhdGUoJm5ld19id19zdGF0ZS0+YmFzZSk7CisJ
CWlmIChyZXQpIHsKKwkJCURSTV9ERUJVR19LTVMoIkNvdWxkIG5vdCBzZXJpYWxpemUgZ2xvYmFs
IHN0YXRlXG4iKTsKKwkJCXJldHVybiByZXQ7CisJCX0KKwl9CisKIAlyZXR1cm4gMDsKIH0KIApk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9idy5oIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9idy5oCmluZGV4IDZjMzNkM2FmNTBhOS4u
NjRlOGMxNjkzNGE2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2J3LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9idy5oCkBA
IC0yNCw2ICsyNCwxMyBAQCBzdHJ1Y3QgaW50ZWxfYndfc3RhdGUgewogCSAqLwogCXU4IHBpcGVf
c2Fndl9tYXNrOwogCisJLyoKKwkgKiBDdXJyZW50IFFHViBwb2ludHMgbWFzaywgd2hpY2ggcmVz
dHJpY3RzCisJICogc29tZSBwYXJ0aWN1bGFyIFNBR1Ygc3RhdGVzLCBub3QgdG8gY29uZnVzZQor
CSAqIHdpdGggcGlwZV9zYWd2X21hc2suCisJICovCisJdTggcWd2X3BvaW50c19tYXNrOworCiAJ
dW5zaWduZWQgaW50IGRhdGFfcmF0ZVtJOTE1X01BWF9QSVBFU107CiAJdTggbnVtX2FjdGl2ZV9w
bGFuZXNbSTkxNV9NQVhfUElQRVNdOwogfTsKQEAgLTQ0LDUgKzUxLDcgQEAgaW50IGludGVsX2J3
X2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIGludCBpbnRlbF9id19h
dG9taWNfY2hlY2soc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpOwogdm9pZCBpbnRl
bF9id19jcnRjX3VwZGF0ZShzdHJ1Y3QgaW50ZWxfYndfc3RhdGUgKmJ3X3N0YXRlLAogCQkJICBj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7CitpbnQgaWNsX3Bjb2Rl
X3Jlc3RyaWN0X3Fndl9wb2ludHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAor
CQkJCSAgdTMyIHBvaW50c19tYXNrKTsKIAogI2VuZGlmIC8qIF9fSU5URUxfQldfSF9fICovCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4IGRlYmUz
ZTkzZDJlNy4uMzhhNmEyMDJkMGE1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXkuYwpAQCAtMTU2MjMsNiArMTU2MjMsMTA1IEBAIHN0YXRpYyB2b2lkIGlu
dGVsX2F0b21pY19jbGVhbnVwX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCWludGVs
X2F0b21pY19oZWxwZXJfZnJlZV9zdGF0ZShpOTE1KTsKIH0KIAorc3RhdGljIHZvaWQgaW50ZWxf
cWd2X3BvaW50c19tYXNrKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQoreworCXN0
cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBzdGF0ZS0+YmFzZS5kZXY7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCWludCByZXQ7CisJc3RydWN0IGlu
dGVsX2J3X3N0YXRlICpuZXdfYndfc3RhdGUgPSBOVUxMOworCXN0cnVjdCBpbnRlbF9id19zdGF0
ZSAqb2xkX2J3X3N0YXRlID0gTlVMTDsKKwl1MzIgbmV3X21hc2sgPSAwOworCXVuc2lnbmVkIGlu
dCBudW1fcWd2X3BvaW50cyA9IGRldl9wcml2LT5tYXhfYndbMF0ubnVtX3Fndl9wb2ludHM7CisJ
dW5zaWduZWQgaW50IG1hc2sgPSAoMSA8PCBudW1fcWd2X3BvaW50cykgLSAxOworCisJbmV3X2J3
X3N0YXRlID0gaW50ZWxfYXRvbWljX2dldF9uZXdfYndfc3RhdGUoc3RhdGUpOworCWlmIChJU19F
UlIobmV3X2J3X3N0YXRlKSkgeworCQlXQVJOKDEsICJDb3VsZCBub3QgZ2V0IG5ldyBid19zdGF0
ZSFcbiIpOworCQlyZXR1cm47CisJfQorCisJb2xkX2J3X3N0YXRlID0gaW50ZWxfYXRvbWljX2dl
dF9vbGRfYndfc3RhdGUoc3RhdGUpOworCWlmIChJU19FUlIob2xkX2J3X3N0YXRlKSkgeworCQlX
QVJOKDEsICJDb3VsZCBub3QgZ2V0IG9sZCBid19zdGF0ZSFcbiIpOworCQlyZXR1cm47CisJfQor
CisJbmV3X21hc2sgPSBvbGRfYndfc3RhdGUtPnFndl9wb2ludHNfbWFzayB8IG5ld19id19zdGF0
ZS0+cWd2X3BvaW50c19tYXNrOworCisJLyoKKwkgKiBJZiBuZXcgbWFzayBpcyB6ZXJvIC0gbWVh
bnMgdGhlcmUgaXMgbm90aGluZyB0byBtYXNrLAorCSAqIHdlIGNhbiBvbmx5IHVubWFzaywgd2hp
Y2ggc2hvdWxkIGJlIGRvbmUgaW4gdW5tYXNrLgorCSAqLworCWlmICghbmV3X21hc2spCisJCXJl
dHVybjsKKworCVdBUk5fT04obmV3X21hc2sgPT0gbWFzayk7CisKKwkvKgorCSAqIEp1c3QgcmV0
dXJuIGlmIHdlIGNhbid0IGNvbnRyb2wgU0FHViBvciBkb24ndCBoYXZlIGl0LgorCSAqLworCWlm
ICghaW50ZWxfaGFzX3NhZ3YoZGV2X3ByaXYpKQorCQlyZXR1cm47CisKKwkvKgorCSAqIFJlc3Ry
aWN0IHJlcXVpcmVkIHFndiBwb2ludHMgYmVmb3JlIHVwZGF0aW5nIHRoZSBjb25maWd1cmF0aW9u
LgorCSAqIEFjY29yZGluZyB0byBCU3BlYyB3ZSBjYW4ndCBtYXNrIGFuZCB1bm1hc2sgcWd2IHBv
aW50cyBhdCB0aGUgc2FtZQorCSAqIHRpbWUuIEFsc28gbWFza2luZyBzaG91bGQgYmUgZG9uZSBi
ZWZvcmUgdXBkYXRpbmcgdGhlIGNvbmZpZ3VyYXRpb24KKwkgKiBhbmQgdW5tYXNraW5nIGFmdGVy
d2FyZHMuCisJICovCisJcmV0ID0gaWNsX3Bjb2RlX3Jlc3RyaWN0X3Fndl9wb2ludHMoZGV2X3By
aXYsIG5ld19tYXNrKTsKKwlpZiAocmV0IDwgMCkKKwkJRFJNX0RFQlVHX0tNUygiQ291bGQgbm90
IG1hc2sgcmVxdWlyZWQgcWd2IHBvaW50cyglZClcbiIsCisJCQkgICAgICByZXQpOworfQorCitz
dGF0aWMgdm9pZCBpbnRlbF9xZ3ZfcG9pbnRzX3VubWFzayhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0
YXRlICpzdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gc3RhdGUtPmJhc2UuZGV2
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlp
bnQgcmV0OworCXN0cnVjdCBpbnRlbF9id19zdGF0ZSAqbmV3X2J3X3N0YXRlID0gTlVMTDsKKwlz
dHJ1Y3QgaW50ZWxfYndfc3RhdGUgKm9sZF9id19zdGF0ZSA9IE5VTEw7CisJdTMyIG5ld19tYXNr
ID0gMDsKKworCW5ld19id19zdGF0ZSA9IGludGVsX2F0b21pY19nZXRfbmV3X2J3X3N0YXRlKHN0
YXRlKTsKKwlpZiAoSVNfRVJSKG5ld19id19zdGF0ZSkpIHsKKwkJV0FSTigxLCAiQ291bGQgbm90
IGdldCBuZXcgYndfc3RhdGUhXG4iKTsKKwkJcmV0dXJuOworCX0KKworCW9sZF9id19zdGF0ZSA9
IGludGVsX2F0b21pY19nZXRfb2xkX2J3X3N0YXRlKHN0YXRlKTsKKwlpZiAoSVNfRVJSKG9sZF9i
d19zdGF0ZSkpIHsKKwkJV0FSTigxLCAiQ291bGQgbm90IGdldCBuZXcgYndfc3RhdGUhXG4iKTsK
KwkJcmV0dXJuOworCX0KKworCW5ld19tYXNrID0gbmV3X2J3X3N0YXRlLT5xZ3ZfcG9pbnRzX21h
c2s7CisKKwkvKgorCSAqIEp1c3QgcmV0dXJuIGlmIHdlIGNhbid0IGNvbnRyb2wgU0FHViBvciBk
b24ndCBoYXZlIGl0LgorCSAqLworCWlmICghaW50ZWxfaGFzX3NhZ3YoZGV2X3ByaXYpKQorCQly
ZXR1cm47CisKKwkvKgorCSAqIE5vdGhpbmcgdG8gdW5tYXNrCisJICovCisJaWYgKG5ld19tYXNr
ID09IG9sZF9id19zdGF0ZS0+cWd2X3BvaW50c19tYXNrKQorCQlyZXR1cm47CisKKwkvKgorCSAq
IEFsbG93IHJlcXVpcmVkIHFndiBwb2ludHMgYWZ0ZXIgdXBkYXRpbmcgdGhlIGNvbmZpZ3VyYXRp
b24uCisJICogQWNjb3JkaW5nIHRvIEJTcGVjIHdlIGNhbid0IG1hc2sgYW5kIHVubWFzayBxZ3Yg
cG9pbnRzIGF0IHRoZSBzYW1lCisJICogdGltZS4gQWxzbyBtYXNraW5nIHNob3VsZCBiZSBkb25l
IGJlZm9yZSB1cGRhdGluZyB0aGUgY29uZmlndXJhdGlvbgorCSAqIGFuZCB1bm1hc2tpbmcgYWZ0
ZXJ3YXJkcy4KKwkgKi8KKwlyZXQgPSBpY2xfcGNvZGVfcmVzdHJpY3RfcWd2X3BvaW50cyhkZXZf
cHJpdiwgbmV3X21hc2spOworCWlmIChyZXQgPCAwKQorCQlEUk1fREVCVUdfS01TKCJDb3VsZCBu
b3QgdW5tYXNrIHJlcXVpcmVkIHFndiBwb2ludHMoJWQpXG4iLAorCQkJICAgICAgcmV0KTsKK30K
Kwogc3RhdGljIHZvaWQgaW50ZWxfYXRvbWljX2NvbW1pdF90YWlsKHN0cnVjdCBpbnRlbF9hdG9t
aWNfc3RhdGUgKnN0YXRlKQogewogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBzdGF0ZS0+YmFz
ZS5kZXY7CkBAIC0xNTY1Niw2ICsxNTc1NSwxNCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9hdG9taWNf
Y29tbWl0X3RhaWwoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJZm9yX2VhY2hf
bmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsIG5ld19jcnRjX3N0YXRlLCBpKQog
CQljcnRjLT5jb25maWcgPSBuZXdfY3J0Y19zdGF0ZTsKIAorCS8qCisJICogTm93IHdlIG5lZWQg
dG8gY2hlY2sgaWYgU0FHViBuZWVkcyB0byBiZSBkaXNhYmxlZChpLmUgUUdWIHBvaW50cworCSAq
IG1vZGlmaWVkIGV2ZW4sIHdoZW4gbm8gbW9kZXNldCBpcyBkb25lKGZvciBleGFtcGxlIHBsYW5l
IHVwZGF0ZXMKKwkgKiBjYW4gbm93IHRyaWdnZXIgdGhhdCkuCisJICovCisJaWYgKChJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDExKSkKKwkJaW50ZWxfcWd2X3BvaW50c19tYXNrKHN0YXRlKTsKKwog
CWlmIChzdGF0ZS0+bW9kZXNldCkgewogCQlkcm1fYXRvbWljX2hlbHBlcl91cGRhdGVfbGVnYWN5
X21vZGVzZXRfc3RhdGUoZGV2LCAmc3RhdGUtPmJhc2UpOwogCkBAIC0xNTc2Miw2ICsxNTg2OSw4
IEBAIHN0YXRpYyB2b2lkIGludGVsX2F0b21pY19jb21taXRfdGFpbChzdHJ1Y3QgaW50ZWxfYXRv
bWljX3N0YXRlICpzdGF0ZSkKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDExKSB7CiAJCWlm
IChzdGF0ZS0+bW9kZXNldCAmJiBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YoZGV2X3ByaXYpKQogCQkJ
aW50ZWxfZW5hYmxlX3NhZ3YoZGV2X3ByaXYpOworCX0gZWxzZSB7CisJCWludGVsX3Fndl9wb2lu
dHNfdW5tYXNrKHN0YXRlKTsKIAl9CiAKIAlkcm1fYXRvbWljX2hlbHBlcl9jb21taXRfaHdfZG9u
ZSgmc3RhdGUtPmJhc2UpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9k
cnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKaW5kZXggYTcxZmYyMzNjYzU1
Li5hN2Y0ZjQ3ODIyMTkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2
LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaApAQCAtODQ5LDYgKzg0OSw5
IEBAIGVudW0gaW50ZWxfcGlwZV9jcmNfc291cmNlIHsKIAlJTlRFTF9QSVBFX0NSQ19TT1VSQ0Vf
TUFYLAogfTsKIAorLyogQlNwZWMgcHJlY2lzZWx5IGRlZmluZXMgdGhpcyAqLworI2RlZmluZSBO
VU1fU0FHVl9QT0lOVFMgOAorCiAjZGVmaW5lIElOVEVMX1BJUEVfQ1JDX0VOVFJJRVNfTlIJMTI4
CiBzdHJ1Y3QgaW50ZWxfcGlwZV9jcmMgewogCXNwaW5sb2NrX3QgbG9jazsKLS0gCjIuMjQuMS40
ODUuZ2FkMDVhM2Q4ZTUKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVs
LWdmeAo=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7BC00464D4
	for <lists+intel-gfx@lfdr.de>; Fri, 14 Jun 2019 18:46:15 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B716889B78;
	Fri, 14 Jun 2019 16:46:13 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3DEF489B67
 for <intel-gfx@lists.freedesktop.org>; Fri, 14 Jun 2019 16:46:11 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16905375-1500050 
 for <intel-gfx@lists.freedesktop.org>; Fri, 14 Jun 2019 17:46:07 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 14 Jun 2019 17:46:05 +0100
Message-Id: <20190614164606.15633-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190614164606.15633-1-chris@chris-wilson.co.uk>
References: <20190614164606.15633-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 2/3] drm/i915: Stop retiring along engine
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2Ugbm8gbG9uZ2VyIHRyYWNrIHRoZSBleGVjdXRpb24gb3JkZXIgYWxvbmcgdGhlIGVuZ2luZSBh
bmQgc28gbm8gbG9uZ2VyCm5lZWQgdG8gZW5mb3JjZSBvcmRlcmluZyBvZiByZXRpcmUgYWxvbmcg
dGhlIGVuZ2luZS4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2ls
c29uLmNvLnVrPgpSZXZpZXdlZC1ieTogTWlrYSBLdW9wcGFsYSA8bWlrYS5rdW9wcGFsYUBsaW51
eC5pbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMgfCAx
MzEgKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDUzIGluc2Vy
dGlvbnMoKyksIDc4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfcmVxdWVzdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMK
aW5kZXggMzhkMTEyZDhhYmE3Li5jOTkxMzZmNzhhZjkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
cmVxdWVzdC5jCkBAIC0xODMsNzIgKzE4MywyMyBAQCBzdGF0aWMgdm9pZCBmcmVlX2NhcHR1cmVf
bGlzdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0KQogCX0KIH0KIAotc3RhdGljIHZvaWQg
X19yZXRpcmVfZW5naW5lX3JlcXVlc3Qoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAot
CQkJCSAgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKLXsKLQlHRU1fVFJBQ0UoIiVzKCVzKSBm
ZW5jZSAlbGx4OiVsbGQsIGN1cnJlbnQgJWRcbiIsCi0JCSAgX19mdW5jX18sIGVuZ2luZS0+bmFt
ZSwKLQkJICBycS0+ZmVuY2UuY29udGV4dCwgcnEtPmZlbmNlLnNlcW5vLAotCQkgIGh3c3Bfc2Vx
bm8ocnEpKTsKLQotCUdFTV9CVUdfT04oIWk5MTVfcmVxdWVzdF9jb21wbGV0ZWQocnEpKTsKLQot
CWxvY2FsX2lycV9kaXNhYmxlKCk7Ci0KLQlzcGluX2xvY2soJmVuZ2luZS0+dGltZWxpbmUubG9j
ayk7Ci0JR0VNX0JVR19PTighbGlzdF9pc19maXJzdCgmcnEtPmxpbmssICZlbmdpbmUtPnRpbWVs
aW5lLnJlcXVlc3RzKSk7Ci0JbGlzdF9kZWxfaW5pdCgmcnEtPmxpbmspOwotCXNwaW5fdW5sb2Nr
KCZlbmdpbmUtPnRpbWVsaW5lLmxvY2spOwotCi0Jc3Bpbl9sb2NrKCZycS0+bG9jayk7Ci0JaTkx
NV9yZXF1ZXN0X21hcmtfY29tcGxldGUocnEpOwotCWlmICghaTkxNV9yZXF1ZXN0X3NpZ25hbGVk
KHJxKSkKLQkJZG1hX2ZlbmNlX3NpZ25hbF9sb2NrZWQoJnJxLT5mZW5jZSk7Ci0JaWYgKHRlc3Rf
Yml0KERNQV9GRU5DRV9GTEFHX0VOQUJMRV9TSUdOQUxfQklULCAmcnEtPmZlbmNlLmZsYWdzKSkK
LQkJaTkxNV9yZXF1ZXN0X2NhbmNlbF9icmVhZGNydW1iKHJxKTsKLQlpZiAocnEtPndhaXRib29z
dCkgewotCQlHRU1fQlVHX09OKCFhdG9taWNfcmVhZCgmcnEtPmk5MTUtPmd0X3BtLnJwcy5udW1f
d2FpdGVycykpOwotCQlhdG9taWNfZGVjKCZycS0+aTkxNS0+Z3RfcG0ucnBzLm51bV93YWl0ZXJz
KTsKLQl9Ci0Jc3Bpbl91bmxvY2soJnJxLT5sb2NrKTsKLQotCWxvY2FsX2lycV9lbmFibGUoKTsK
LX0KLQotc3RhdGljIHZvaWQgX19yZXRpcmVfZW5naW5lX3VwdG8oc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lLAotCQkJCSBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKLXsKLQlzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICp0bXA7Ci0KLQlpZiAobGlzdF9lbXB0eSgmcnEtPmxpbmspKQotCQlyZXR1
cm47Ci0KLQlkbyB7Ci0JCXRtcCA9IGxpc3RfZmlyc3RfZW50cnkoJmVuZ2luZS0+dGltZWxpbmUu
cmVxdWVzdHMsCi0JCQkJICAgICAgIHR5cGVvZigqdG1wKSwgbGluayk7Ci0KLQkJR0VNX0JVR19P
Tih0bXAtPmVuZ2luZSAhPSBlbmdpbmUpOwotCQlfX3JldGlyZV9lbmdpbmVfcmVxdWVzdChlbmdp
bmUsIHRtcCk7Ci0JfSB3aGlsZSAodG1wICE9IHJxKTsKLX0KLQotc3RhdGljIHZvaWQgaTkxNV9y
ZXF1ZXN0X3JldGlyZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0KQorc3RhdGljIGJvb2wg
aTkxNV9yZXF1ZXN0X3JldGlyZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKIAlzdHJ1Y3Qg
aTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLCAqbmV4dDsKIAotCUdFTV9UUkFDRSgiJXMgZmVu
Y2UgJWxseDolbGxkLCBjdXJyZW50ICVkXG4iLAotCQkgIHJlcXVlc3QtPmVuZ2luZS0+bmFtZSwK
LQkJICByZXF1ZXN0LT5mZW5jZS5jb250ZXh0LCByZXF1ZXN0LT5mZW5jZS5zZXFubywKLQkJICBo
d3NwX3NlcW5vKHJlcXVlc3QpKTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZycS0+aTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CisJaWYgKCFpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJxKSkKKwkJcmV0
dXJuIGZhbHNlOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmcmVxdWVzdC0+aTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7Ci0JR0VNX0JVR19PTighaTkxNV9zd19mZW5jZV9zaWduYWxlZCgmcmVxdWVz
dC0+c3VibWl0KSk7Ci0JR0VNX0JVR19PTighaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChyZXF1ZXN0
KSk7CisJR0VNX1RSQUNFKCIlcyBmZW5jZSAlbGx4OiVsbGQsIGN1cnJlbnQgJWRcbiIsCisJCSAg
cnEtPmVuZ2luZS0+bmFtZSwKKwkJICBycS0+ZmVuY2UuY29udGV4dCwgcnEtPmZlbmNlLnNlcW5v
LAorCQkgIGh3c3Bfc2Vxbm8ocnEpKTsKIAotCXRyYWNlX2k5MTVfcmVxdWVzdF9yZXRpcmUocmVx
dWVzdCk7CisJR0VNX0JVR19PTighaTkxNV9zd19mZW5jZV9zaWduYWxlZCgmcnEtPnN1Ym1pdCkp
OworCXRyYWNlX2k5MTVfcmVxdWVzdF9yZXRpcmUocnEpOwogCi0JYWR2YW5jZV9yaW5nKHJlcXVl
c3QpOwotCWZyZWVfY2FwdHVyZV9saXN0KHJlcXVlc3QpOworCWFkdmFuY2VfcmluZyhycSk7CiAK
IAkvKgogCSAqIFdhbGsgdGhyb3VnaCB0aGUgYWN0aXZlIGxpc3QsIGNhbGxpbmcgcmV0aXJlIG9u
IGVhY2guIFRoaXMgYWxsb3dzCkBAIC0yNjAsNyArMjExLDcgQEAgc3RhdGljIHZvaWQgaTkxNV9y
ZXF1ZXN0X3JldGlyZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0KQogCSAqIHBhc3MgYWxv
bmcgdGhlIGF1eGlsaWFyeSBpbmZvcm1hdGlvbiAodG8gYXZvaWQgZGVyZWZlcmVuY2luZwogCSAq
IHRoZSBub2RlIGFmdGVyIHRoZSBjYWxsYmFjaykuCiAJICovCi0JbGlzdF9mb3JfZWFjaF9lbnRy
eV9zYWZlKGFjdGl2ZSwgbmV4dCwgJnJlcXVlc3QtPmFjdGl2ZV9saXN0LCBsaW5rKSB7CisJbGlz
dF9mb3JfZWFjaF9lbnRyeV9zYWZlKGFjdGl2ZSwgbmV4dCwgJnJxLT5hY3RpdmVfbGlzdCwgbGlu
aykgewogCQkvKgogCQkgKiBJbiBtaWNyb2JlbmNobWFya3Mgb3IgZm9jdXNpbmcgdXBvbiB0aW1l
IGluc2lkZSB0aGUga2VybmVsLAogCQkgKiB3ZSBtYXkgc3BlbmQgYW4gaW5vcmRpbmF0ZSBhbW91
bnQgb2YgdGltZSBzaW1wbHkgaGFuZGxpbmcKQEAgLTI3NiwxOCArMjI3LDM5IEBAIHN0YXRpYyB2
b2lkIGk5MTVfcmVxdWVzdF9yZXRpcmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdCkKIAkJ
SU5JVF9MSVNUX0hFQUQoJmFjdGl2ZS0+bGluayk7CiAJCVJDVV9JTklUX1BPSU5URVIoYWN0aXZl
LT5yZXF1ZXN0LCBOVUxMKTsKIAotCQlhY3RpdmUtPnJldGlyZShhY3RpdmUsIHJlcXVlc3QpOwor
CQlhY3RpdmUtPnJldGlyZShhY3RpdmUsIHJxKTsKKwl9CisKKwlsb2NhbF9pcnFfZGlzYWJsZSgp
OworCisJc3Bpbl9sb2NrKCZycS0+ZW5naW5lLT50aW1lbGluZS5sb2NrKTsKKwlsaXN0X2RlbCgm
cnEtPmxpbmspOworCXNwaW5fdW5sb2NrKCZycS0+ZW5naW5lLT50aW1lbGluZS5sb2NrKTsKKwor
CXNwaW5fbG9jaygmcnEtPmxvY2spOworCWk5MTVfcmVxdWVzdF9tYXJrX2NvbXBsZXRlKHJxKTsK
KwlpZiAoIWk5MTVfcmVxdWVzdF9zaWduYWxlZChycSkpCisJCWRtYV9mZW5jZV9zaWduYWxfbG9j
a2VkKCZycS0+ZmVuY2UpOworCWlmICh0ZXN0X2JpdChETUFfRkVOQ0VfRkxBR19FTkFCTEVfU0lH
TkFMX0JJVCwgJnJxLT5mZW5jZS5mbGFncykpCisJCWk5MTVfcmVxdWVzdF9jYW5jZWxfYnJlYWRj
cnVtYihycSk7CisJaWYgKHJxLT53YWl0Ym9vc3QpIHsKKwkJR0VNX0JVR19PTighYXRvbWljX3Jl
YWQoJnJxLT5pOTE1LT5ndF9wbS5ycHMubnVtX3dhaXRlcnMpKTsKKwkJYXRvbWljX2RlYygmcnEt
Pmk5MTUtPmd0X3BtLnJwcy5udW1fd2FpdGVycyk7CiAJfQorCXNwaW5fdW5sb2NrKCZycS0+bG9j
ayk7CisKKwlsb2NhbF9pcnFfZW5hYmxlKCk7CiAKLQlpOTE1X3JlcXVlc3RfcmVtb3ZlX2Zyb21f
Y2xpZW50KHJlcXVlc3QpOworCWludGVsX2NvbnRleHRfZXhpdChycS0+aHdfY29udGV4dCk7CisJ
aW50ZWxfY29udGV4dF91bnBpbihycS0+aHdfY29udGV4dCk7CiAKLQlfX3JldGlyZV9lbmdpbmVf
dXB0byhyZXF1ZXN0LT5lbmdpbmUsIHJlcXVlc3QpOworCWk5MTVfcmVxdWVzdF9yZW1vdmVfZnJv
bV9jbGllbnQocnEpOwogCi0JaW50ZWxfY29udGV4dF9leGl0KHJlcXVlc3QtPmh3X2NvbnRleHQp
OwotCWludGVsX2NvbnRleHRfdW5waW4ocmVxdWVzdC0+aHdfY29udGV4dCk7CisJZnJlZV9jYXB0
dXJlX2xpc3QocnEpOworCWk5MTVfc2NoZWRfbm9kZV9maW5pKCZycS0+c2NoZWQpOworCWk5MTVf
cmVxdWVzdF9wdXQocnEpOwogCi0JaTkxNV9zY2hlZF9ub2RlX2ZpbmkoJnJlcXVlc3QtPnNjaGVk
KTsKLQlpOTE1X3JlcXVlc3RfcHV0KHJlcXVlc3QpOworCXJldHVybiB0cnVlOwogfQogCiB2b2lk
IGk5MTVfcmVxdWVzdF9yZXRpcmVfdXB0byhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKQEAgLTMw
OSw5ICsyODEsNyBAQCB2b2lkIGk5MTVfcmVxdWVzdF9yZXRpcmVfdXB0byhzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpycSkKIAlkbyB7CiAJCXRtcCA9IGxpc3RfZmlyc3RfZW50cnkoJnJpbmctPnJlcXVl
c3RfbGlzdCwKIAkJCQkgICAgICAgdHlwZW9mKCp0bXApLCByaW5nX2xpbmspOwotCi0JCWk5MTVf
cmVxdWVzdF9yZXRpcmUodG1wKTsKLQl9IHdoaWxlICh0bXAgIT0gcnEpOworCX0gd2hpbGUgKGk5
MTVfcmVxdWVzdF9yZXRpcmUodG1wKSAmJiB0bXAgIT0gcnEpOwogfQogCiBzdGF0aWMgdm9pZCBp
cnFfZXhlY3V0ZV9jYihzdHJ1Y3QgaXJxX3dvcmsgKndyaykKQEAgLTYwMCwxMiArNTcwLDkgQEAg
c3RhdGljIHZvaWQgcmluZ19yZXRpcmVfcmVxdWVzdHMoc3RydWN0IGludGVsX3JpbmcgKnJpbmcp
CiB7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsICpybjsKIAotCWxpc3RfZm9yX2VhY2hfZW50
cnlfc2FmZShycSwgcm4sICZyaW5nLT5yZXF1ZXN0X2xpc3QsIHJpbmdfbGluaykgewotCQlpZiAo
IWk5MTVfcmVxdWVzdF9jb21wbGV0ZWQocnEpKQorCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShy
cSwgcm4sICZyaW5nLT5yZXF1ZXN0X2xpc3QsIHJpbmdfbGluaykKKwkJaWYgKCFpOTE1X3JlcXVl
c3RfcmV0aXJlKHJxKSkKIAkJCWJyZWFrOwotCi0JCWk5MTVfcmVxdWVzdF9yZXRpcmUocnEpOwot
CX0KIH0KIAogc3RhdGljIG5vaW5saW5lIHN0cnVjdCBpOTE1X3JlcXVlc3QgKgpAQCAtNjIwLDYg
KzU4NywxNSBAQCByZXF1ZXN0X2FsbG9jX3Nsb3coc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCBn
ZnBfdCBnZnApCiAJaWYgKCFnZnBmbGFnc19hbGxvd19ibG9ja2luZyhnZnApKQogCQlnb3RvIG91
dDsKIAorCS8qIE1vdmUgb3VyIG9sZGVzdCByZXF1ZXN0IHRvIHRoZSBzbGFiLWNhY2hlIChpZiBu
b3QgaW4gdXNlISkgKi8KKwlycSA9IGxpc3RfZmlyc3RfZW50cnkoJnJpbmctPnJlcXVlc3RfbGlz
dCwgdHlwZW9mKCpycSksIHJpbmdfbGluayk7CisJaTkxNV9yZXF1ZXN0X3JldGlyZShycSk7CisK
KwlycSA9IGttZW1fY2FjaGVfYWxsb2MoZ2xvYmFsLnNsYWJfcmVxdWVzdHMsCisJCQkgICAgICBn
ZnAgfCBfX0dGUF9SRVRSWV9NQVlGQUlMIHwgX19HRlBfTk9XQVJOKTsKKwlpZiAocnEpCisJCXJl
dHVybiBycTsKKwogCS8qIFJhdGVsaW1pdCBvdXJzZWx2ZXMgdG8gcHJldmVudCBvb20gZnJvbSBt
YWxpY2lvdXMgY2xpZW50cyAqLwogCXJxID0gbGlzdF9sYXN0X2VudHJ5KCZyaW5nLT5yZXF1ZXN0
X2xpc3QsIHR5cGVvZigqcnEpLCByaW5nX2xpbmspOwogCWNvbmRfc3luY2hyb25pemVfcmN1KHJx
LT5yY3VzdGF0ZSk7CkBAIC03NzcsOCArNzUzLDcgQEAgaTkxNV9yZXF1ZXN0X2NyZWF0ZShzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAKIAkvKiBNb3ZlIG91ciBvbGRlc3QgcmVxdWVzdCB0byB0
aGUgc2xhYi1jYWNoZSAoaWYgbm90IGluIHVzZSEpICovCiAJcnEgPSBsaXN0X2ZpcnN0X2VudHJ5
KCZjZS0+cmluZy0+cmVxdWVzdF9saXN0LCB0eXBlb2YoKnJxKSwgcmluZ19saW5rKTsKLQlpZiAo
IWxpc3RfaXNfbGFzdCgmcnEtPnJpbmdfbGluaywgJmNlLT5yaW5nLT5yZXF1ZXN0X2xpc3QpICYm
Ci0JICAgIGk5MTVfcmVxdWVzdF9jb21wbGV0ZWQocnEpKQorCWlmICghbGlzdF9pc19sYXN0KCZy
cS0+cmluZ19saW5rLCAmY2UtPnJpbmctPnJlcXVlc3RfbGlzdCkpCiAJCWk5MTVfcmVxdWVzdF9y
ZXRpcmUocnEpOwogCiAJaW50ZWxfY29udGV4dF9lbnRlcihjZSk7Ci0tIAoyLjIwLjEKCl9fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWls
aW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZy
ZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 9721D2640D
	for <lists+intel-gfx@lfdr.de>; Wed, 22 May 2019 14:52:52 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6608189904;
	Wed, 22 May 2019 12:52:50 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1A5E4898FD;
 Wed, 22 May 2019 12:52:47 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16640778-1500050 
 for multiple; Wed, 22 May 2019 13:52:42 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 22 May 2019 13:52:41 +0100
Message-Id: <20190522125241.7419-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190522113712.23512-10-chris@chris-wilson.co.uk>
References: <20190522113712.23512-10-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t] i915/gem_exec_balancer: Exercise bonded
 pairs
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIHN1Ym1pdC1mZW5jZSArIGxvYWRfYmFsYW5jaW5nIGFwaXMgYWxsb3cgZm9yIHVzIHRvIGV4
ZWN1dGUgYSBuYW1lZApwYWlyIG9mIGVuZ2luZXMgaW4gcGFyYWxsZWw7IHRoYXQgdGhpcyBieSBz
dWJtaXR0aW5nIGEgcmVxdWVzdCB0byBvbmUKZW5naW5lLCB3ZSBjYW4gdGhlbiB1c2UgdGhlIGdl
bmVyYXRlZCBzdWJtaXQtZmVuY2UgdG8gc3VibWl0IGEgc2Vjb25kCnJlcXVlc3QgdG8gYW5vdGhl
ciBlbmdpbmUgYW5kIGhhdmUgaXQgZXhlY3V0ZSBhdCB0aGUgc2FtZSB0aW1lLgpGdXJ0aGVybW9y
ZSwgYnkgc3BlY2lmeWluZyBib25kZWQgcGFpcnMsIHdlIGNhbiBkaXJlY3QgdGhlIHZpcnR1YWwK
ZW5naW5lIHRvIHVzZSBhIHBhcnRpY3VsYXIgZW5naW5lIGluIHBhcmFsbGVsIHRvIHRoZSBmaXJz
dCByZXF1ZXN0LgoKdjI6IE1lYXN1cmUgbG9hZCBhY3Jvc3MgYWxsIGJvbmRlZCBzaWJsaW5ncyB0
byBjaGVjayB3ZSBkb24ndAptaXNzIGFuIGFjY2lkZW50YWwgZXhlY3V0aW9uIG9uIGFub3RoZXIu
CnYzOiBUaHJvdyBpbiBhIGNoZWNrIGZvciBtYXN0ZXIgYXMgd2VsbC4KClNpZ25lZC1vZmYtYnk6
IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgotLS0KIHRlc3RzL2k5MTUv
Z2VtX2V4ZWNfYmFsYW5jZXIuYyB8IDI4NSArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysr
Ky0KIDEgZmlsZSBjaGFuZ2VkLCAyNzcgaW5zZXJ0aW9ucygrKSwgOCBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS90ZXN0cy9pOTE1L2dlbV9leGVjX2JhbGFuY2VyLmMgYi90ZXN0cy9pOTE1L2dl
bV9leGVjX2JhbGFuY2VyLmMKaW5kZXggMTQ3OGZlZGYxLi4zM2IxN2ZjNTEgMTAwNjQ0Ci0tLSBh
L3Rlc3RzL2k5MTUvZ2VtX2V4ZWNfYmFsYW5jZXIuYworKysgYi90ZXN0cy9pOTE1L2dlbV9leGVj
X2JhbGFuY2VyLmMKQEAgLTg5LDkgKzg5LDM1IEBAIGxpc3RfZW5naW5lcyhpbnQgaTkxNSwgdWlu
dDMyX3QgY2xhc3NfbWFzaywgdW5zaWduZWQgaW50ICpvdXQpCiAJcmV0dXJuIGVuZ2luZXM7CiB9
CiAKK3N0YXRpYyBpbnQgX19zZXRfZW5naW5lcyhpbnQgaTkxNSwgdWludDMyX3QgY3R4LAorCQkJ
IGNvbnN0IHN0cnVjdCBpOTE1X2VuZ2luZV9jbGFzc19pbnN0YW5jZSAqY2ksCisJCQkgdW5zaWdu
ZWQgaW50IGNvdW50KQoreworCUk5MTVfREVGSU5FX0NPTlRFWFRfUEFSQU1fRU5HSU5FUyhlbmdp
bmVzLCBjb3VudCk7CisJc3RydWN0IGRybV9pOTE1X2dlbV9jb250ZXh0X3BhcmFtIHAgPSB7CisJ
CS5jdHhfaWQgPSBjdHgsCisJCS5wYXJhbSA9IEk5MTVfQ09OVEVYVF9QQVJBTV9FTkdJTkVTLAor
CQkuc2l6ZSA9IHNpemVvZihlbmdpbmVzKSwKKwkJLnZhbHVlID0gdG9fdXNlcl9wb2ludGVyKCZl
bmdpbmVzKQorCX07CisKKwllbmdpbmVzLmV4dGVuc2lvbnMgPSAwOworCW1lbWNweShlbmdpbmVz
LmVuZ2luZXMsIGNpLCBzaXplb2YoZW5naW5lcy5lbmdpbmVzKSk7CisKKwlyZXR1cm4gX19nZW1f
Y29udGV4dF9zZXRfcGFyYW0oaTkxNSwgJnApOworfQorCitzdGF0aWMgdm9pZCBzZXRfZW5naW5l
cyhpbnQgaTkxNSwgdWludDMyX3QgY3R4LAorCQkJY29uc3Qgc3RydWN0IGk5MTVfZW5naW5lX2Ns
YXNzX2luc3RhbmNlICpjaSwKKwkJCXVuc2lnbmVkIGludCBjb3VudCkKK3sKKwlpZ3RfYXNzZXJ0
X2VxKF9fc2V0X2VuZ2luZXMoaTkxNSwgY3R4LCBjaSwgY291bnQpLCAwKTsKK30KKwogc3RhdGlj
IGludCBfX3NldF9sb2FkX2JhbGFuY2VyKGludCBpOTE1LCB1aW50MzJfdCBjdHgsCiAJCQkgICAg
ICAgY29uc3Qgc3RydWN0IGk5MTVfZW5naW5lX2NsYXNzX2luc3RhbmNlICpjaSwKLQkJCSAgICAg
ICB1bnNpZ25lZCBpbnQgY291bnQpCisJCQkgICAgICAgdW5zaWduZWQgaW50IGNvdW50LAorCQkJ
ICAgICAgIHZvaWQgKmV4dCkKIHsKIAlJOTE1X0RFRklORV9DT05URVhUX0VOR0lORVNfTE9BRF9C
QUxBTkNFKGJhbGFuY2VyLCBjb3VudCk7CiAJSTkxNV9ERUZJTkVfQ09OVEVYVF9QQVJBTV9FTkdJ
TkVTKGVuZ2luZXMsIDEgKyBjb3VudCk7CkBAIC0xMDQsNiArMTMwLDcgQEAgc3RhdGljIGludCBf
X3NldF9sb2FkX2JhbGFuY2VyKGludCBpOTE1LCB1aW50MzJfdCBjdHgsCiAKIAltZW1zZXQoJmJh
bGFuY2VyLCAwLCBzaXplb2YoYmFsYW5jZXIpKTsKIAliYWxhbmNlci5iYXNlLm5hbWUgPSBJOTE1
X0NPTlRFWFRfRU5HSU5FU19FWFRfTE9BRF9CQUxBTkNFOworCWJhbGFuY2VyLmJhc2UubmV4dF9l
eHRlbnNpb24gPSB0b191c2VyX3BvaW50ZXIoZXh0KTsKIAogCWlndF9hc3NlcnQoY291bnQpOwog
CWJhbGFuY2VyLm51bV9zaWJsaW5ncyA9IGNvdW50OwpAQCAtMTIyLDkgKzE0OSwxMCBAQCBzdGF0
aWMgaW50IF9fc2V0X2xvYWRfYmFsYW5jZXIoaW50IGk5MTUsIHVpbnQzMl90IGN0eCwKIAogc3Rh
dGljIHZvaWQgc2V0X2xvYWRfYmFsYW5jZXIoaW50IGk5MTUsIHVpbnQzMl90IGN0eCwKIAkJCSAg
ICAgIGNvbnN0IHN0cnVjdCBpOTE1X2VuZ2luZV9jbGFzc19pbnN0YW5jZSAqY2ksCi0JCQkgICAg
ICB1bnNpZ25lZCBpbnQgY291bnQpCisJCQkgICAgICB1bnNpZ25lZCBpbnQgY291bnQsCisJCQkg
ICAgICB2b2lkICpleHQpCiB7Ci0JaWd0X2Fzc2VydF9lcShfX3NldF9sb2FkX2JhbGFuY2VyKGk5
MTUsIGN0eCwgY2ksIGNvdW50KSwgMCk7CisJaWd0X2Fzc2VydF9lcShfX3NldF9sb2FkX2JhbGFu
Y2VyKGk5MTUsIGN0eCwgY2ksIGNvdW50LCBleHQpLCAwKTsKIH0KIAogc3RhdGljIHVpbnQzMl90
IGxvYWRfYmFsYW5jZXJfY3JlYXRlKGludCBpOTE1LApAQCAtMTM0LDcgKzE2Miw3IEBAIHN0YXRp
YyB1aW50MzJfdCBsb2FkX2JhbGFuY2VyX2NyZWF0ZShpbnQgaTkxNSwKIAl1aW50MzJfdCBjdHg7
CiAKIAljdHggPSBnZW1fY29udGV4dF9jcmVhdGUoaTkxNSk7Ci0Jc2V0X2xvYWRfYmFsYW5jZXIo
aTkxNSwgY3R4LCBjaSwgY291bnQpOworCXNldF9sb2FkX2JhbGFuY2VyKGk5MTUsIGN0eCwgY2ks
IGNvdW50LCBOVUxMKTsKIAogCXJldHVybiBjdHg7CiB9CkBAIC0yNzgsNiArMzA2LDc0IEBAIHN0
YXRpYyB2b2lkIGludmFsaWRfYmFsYW5jZXIoaW50IGk5MTUpCiAJfQogfQogCitzdGF0aWMgdm9p
ZCBpbnZhbGlkX2JvbmRzKGludCBpOTE1KQoreworCUk5MTVfREVGSU5FX0NPTlRFWFRfRU5HSU5F
U19CT05EKGJvbmRzWzE2XSwgMSk7CisJSTkxNV9ERUZJTkVfQ09OVEVYVF9QQVJBTV9FTkdJTkVT
KGVuZ2luZXMsIDEpOworCXN0cnVjdCBkcm1faTkxNV9nZW1fY29udGV4dF9wYXJhbSBwID0gewor
CQkuY3R4X2lkID0gZ2VtX2NvbnRleHRfY3JlYXRlKGk5MTUpLAorCQkucGFyYW0gPSBJOTE1X0NP
TlRFWFRfUEFSQU1fRU5HSU5FUywKKwkJLnZhbHVlID0gdG9fdXNlcl9wb2ludGVyKCZlbmdpbmVz
KSwKKwkJLnNpemUgPSBzaXplb2YoZW5naW5lcyksCisJfTsKKwl1aW50MzJfdCBoYW5kbGU7CisJ
dm9pZCAqcHRyOworCisJbWVtc2V0KCZlbmdpbmVzLCAwLCBzaXplb2YoZW5naW5lcykpOworCWdl
bV9jb250ZXh0X3NldF9wYXJhbShpOTE1LCAmcCk7CisKKwltZW1zZXQoYm9uZHMsIDAsIHNpemVv
Zihib25kcykpOworCWZvciAoaW50IG4gPSAwOyBuIDwgQVJSQVlfU0laRShib25kcyk7IG4rKykg
eworCQlib25kc1tuXS5iYXNlLm5hbWUgPSBJOTE1X0NPTlRFWFRfRU5HSU5FU19FWFRfQk9ORDsK
KwkJYm9uZHNbbl0uYmFzZS5uZXh0X2V4dGVuc2lvbiA9CisJCQluID8gdG9fdXNlcl9wb2ludGVy
KCZib25kc1tuIC0gMV0pIDogMDsKKwkJYm9uZHNbbl0ubnVtX2JvbmRzID0gMTsKKwl9CisJZW5n
aW5lcy5leHRlbnNpb25zID0gdG9fdXNlcl9wb2ludGVyKCZib25kcyk7CisJZ2VtX2NvbnRleHRf
c2V0X3BhcmFtKGk5MTUsICZwKTsKKworCWJvbmRzWzBdLmJhc2UubmV4dF9leHRlbnNpb24gPSAt
MXVsbDsKKwlpZ3RfYXNzZXJ0X2VxKF9fZ2VtX2NvbnRleHRfc2V0X3BhcmFtKGk5MTUsICZwKSwg
LUVGQVVMVCk7CisKKwlib25kc1swXS5iYXNlLm5leHRfZXh0ZW5zaW9uID0gdG9fdXNlcl9wb2lu
dGVyKCZib25kc1swXSk7CisJaWd0X2Fzc2VydF9lcShfX2dlbV9jb250ZXh0X3NldF9wYXJhbShp
OTE1LCAmcCksIC1FMkJJRyk7CisKKwllbmdpbmVzLmV4dGVuc2lvbnMgPSB0b191c2VyX3BvaW50
ZXIoJmJvbmRzWzFdKTsKKwlpZ3RfYXNzZXJ0X2VxKF9fZ2VtX2NvbnRleHRfc2V0X3BhcmFtKGk5
MTUsICZwKSwgLUUyQklHKTsKKwlib25kc1swXS5iYXNlLm5leHRfZXh0ZW5zaW9uID0gMDsKKwln
ZW1fY29udGV4dF9zZXRfcGFyYW0oaTkxNSwgJnApOworCisJaGFuZGxlID0gZ2VtX2NyZWF0ZShp
OTE1LCA0MDk2ICogMyk7CisJcHRyID0gZ2VtX21tYXBfX2d0dChpOTE1LCBoYW5kbGUsIDQwOTYg
KiAzLCBQUk9UX1dSSVRFKTsKKwlnZW1fY2xvc2UoaTkxNSwgaGFuZGxlKTsKKworCW1lbWNweShw
dHIgKyA0MDk2LCAmYm9uZHNbMF0sIHNpemVvZihib25kc1swXSkpOworCWVuZ2luZXMuZXh0ZW5z
aW9ucyA9IHRvX3VzZXJfcG9pbnRlcihwdHIpICsgNDA5NjsKKwlnZW1fY29udGV4dF9zZXRfcGFy
YW0oaTkxNSwgJnApOworCisJbWVtY3B5KHB0ciwgJmJvbmRzWzBdLCBzaXplb2YoYm9uZHNbMF0p
KTsKKwlib25kc1swXS5iYXNlLm5leHRfZXh0ZW5zaW9uID0gdG9fdXNlcl9wb2ludGVyKHB0cik7
CisJbWVtY3B5KHB0ciArIDQwOTYsICZib25kc1swXSwgc2l6ZW9mKGJvbmRzWzBdKSk7CisJZ2Vt
X2NvbnRleHRfc2V0X3BhcmFtKGk5MTUsICZwKTsKKworCW11bm1hcChwdHIsIDQwOTYpOworCWln
dF9hc3NlcnRfZXEoX19nZW1fY29udGV4dF9zZXRfcGFyYW0oaTkxNSwgJnApLCAtRUZBVUxUKTsK
KworCWJvbmRzWzBdLmJhc2UubmV4dF9leHRlbnNpb24gPSAwOworCW1lbWNweShwdHIgKyA4MTky
LCAmYm9uZHNbMF0sIHNpemVvZihib25kc1swXSkpOworCWJvbmRzWzBdLmJhc2UubmV4dF9leHRl
bnNpb24gPSB0b191c2VyX3BvaW50ZXIocHRyKSArIDgxOTI7CisJbWVtY3B5KHB0ciArIDQwOTYs
ICZib25kc1swXSwgc2l6ZW9mKGJvbmRzWzBdKSk7CisJZ2VtX2NvbnRleHRfc2V0X3BhcmFtKGk5
MTUsICZwKTsKKworCW11bm1hcChwdHIgKyA4MTkyLCA0MDk2KTsKKwlpZ3RfYXNzZXJ0X2VxKF9f
Z2VtX2NvbnRleHRfc2V0X3BhcmFtKGk5MTUsICZwKSwgLUVGQVVMVCk7CisKKwltdW5tYXAocHRy
ICsgNDA5NiwgNDA5Nik7CisJaWd0X2Fzc2VydF9lcShfX2dlbV9jb250ZXh0X3NldF9wYXJhbShp
OTE1LCAmcCksIC1FRkFVTFQpOworCisJZ2VtX2NvbnRleHRfZGVzdHJveShpOTE1LCBwLmN0eF9p
ZCk7Cit9CisKIHN0YXRpYyB2b2lkIGtpY2tfa3RocmVhZHModm9pZCkKIHsKIAl1c2xlZXAoMjAg
KiAxMDAwKTsgLyogMjBtcyBzaG91bGQgYmUgZW5vdWdoIGZvciBrc29mdGlycWQhICovCkBAIC0z
MzcsNiArNDMzLDMxIEBAIHN0YXRpYyBkb3VibGUgbWVhc3VyZV9taW5fbG9hZChpbnQgcG11LCB1
bnNpZ25lZCBpbnQgbnVtLCBpbnQgcGVyaW9kX3VzKQogCXJldHVybiBtaW4gLyAoZG91YmxlKWRf
dDsKIH0KIAorc3RhdGljIHZvaWQgbWVhc3VyZV9hbGxfbG9hZChpbnQgcG11LCBkb3VibGUgKnYs
IHVuc2lnbmVkIGludCBudW0sIGludCBwZXJpb2RfdXMpCit7CisJdWludDY0X3QgZGF0YVsyICsg
bnVtXTsKKwl1aW50NjRfdCBkX3QsIGRfdltudW1dOworCisJa2lja19rdGhyZWFkcygpOworCisJ
aWd0X2Fzc2VydF9lcShyZWFkKHBtdSwgZGF0YSwgc2l6ZW9mKGRhdGEpKSwgc2l6ZW9mKGRhdGEp
KTsKKwlmb3IgKHVuc2lnbmVkIGludCBuID0gMDsgbiA8IG51bTsgbisrKQorCQlkX3Zbbl0gPSAt
ZGF0YVsyICsgbl07CisJZF90ID0gLWRhdGFbMV07CisKKwl1c2xlZXAocGVyaW9kX3VzKTsKKwor
CWlndF9hc3NlcnRfZXEocmVhZChwbXUsIGRhdGEsIHNpemVvZihkYXRhKSksIHNpemVvZihkYXRh
KSk7CisKKwlkX3QgKz0gZGF0YVsxXTsKKwlmb3IgKHVuc2lnbmVkIGludCBuID0gMDsgbiA8IG51
bTsgbisrKSB7CisJCWRfdltuXSArPSBkYXRhWzIgKyBuXTsKKwkJaWd0X2RlYnVnKCJlbmdpbmVb
JWRdOiAlLjFmJSVcbiIsCisJCQkgIG4sIGRfdltuXSAvIChkb3VibGUpZF90ICogMTAwKTsKKwkJ
dltuXSA9IGRfdltuXSAvIChkb3VibGUpZF90OworCX0KK30KKwogc3RhdGljIGludCBhZGRfcG11
KGludCBwbXUsIGNvbnN0IHN0cnVjdCBpOTE1X2VuZ2luZV9jbGFzc19pbnN0YW5jZSAqY2kpCiB7
CiAJcmV0dXJuIHBlcmZfaTkxNV9vcGVuX2dyb3VwKEk5MTVfUE1VX0VOR0lORV9CVVNZKGNpLT5l
bmdpbmVfY2xhc3MsCkBAIC00MDcsNyArNTI4LDcgQEAgc3RhdGljIHZvaWQgaW5kaXZpZHVhbChp
bnQgaTkxNSkKIAkJZm9yIChpbnQgcGFzcyA9IDA7IHBhc3MgPCBjb3VudDsgcGFzcysrKSB7IC8q
IGFwcHJveC4gY291bnQhICovCiAJCQlpZ3RfYXNzZXJ0KHNpemVvZigqY2kpID09IHNpemVvZihp
bnQpKTsKIAkJCWlndF9wZXJtdXRlX2FycmF5KGNpLCBjb3VudCwgaWd0X2V4Y2hhbmdlX2ludCk7
Ci0JCQlzZXRfbG9hZF9iYWxhbmNlcihpOTE1LCBjdHgsIGNpLCBjb3VudCk7CisJCQlzZXRfbG9h
ZF9iYWxhbmNlcihpOTE1LCBjdHgsIGNpLCBjb3VudCwgTlVMTCk7CiAJCQlmb3IgKHVuc2lnbmVk
IGludCBuID0gMDsgbiA8IGNvdW50OyBuKyspCiAJCQkJY2hlY2tfaW5kaXZpZHVhbF9lbmdpbmUo
aTkxNSwgY3R4LCBjaSwgbik7CiAJCX0KQEAgLTQxOSw2ICs1NDAsMTQ1IEBAIHN0YXRpYyB2b2lk
IGluZGl2aWR1YWwoaW50IGk5MTUpCiAJZ2VtX3F1aWVzY2VudF9ncHUoaTkxNSk7CiB9CiAKK3N0
YXRpYyB2b2lkIGJvbmRlZChpbnQgaTkxNSwgdW5zaWduZWQgaW50IGZsYWdzKQorI2RlZmluZSBD
T1JLIDB4MQoreworCUk5MTVfREVGSU5FX0NPTlRFWFRfRU5HSU5FU19CT05EKGJvbmRzWzE2XSwg
MSk7CisJc3RydWN0IGk5MTVfZW5naW5lX2NsYXNzX2luc3RhbmNlICptYXN0ZXJfZW5naW5lczsK
Kwl1aW50MzJfdCBtYXN0ZXI7CisKKwkvKgorCSAqIEk5MTVfQ09OVEVYVF9QQVJBTV9FTkdJTkUg
cHJvdmlkZXMgYW4gZXh0ZW5zaW9uIHRoYXQgYWxsb3dzIHVzCisJICogdG8gc3BlY2lmeSB3aGlj
aCBlbmdpbmUocykgdG8gcGFpciB3aXRoIGEgcGFyYWxsZWwgKEVYRUNfU1VCTUlUKQorCSAqIHJl
cXVlc3Qgc3VibWl0dGVkIHRvIGFub3RoZXIgZW5naW5lLgorCSAqLworCisJbWFzdGVyID0gZ2Vt
X3F1ZXVlX2NyZWF0ZShpOTE1KTsKKworCW1lbXNldChib25kcywgMCwgc2l6ZW9mKGJvbmRzKSk7
CisJZm9yIChpbnQgbiA9IDA7IG4gPCBBUlJBWV9TSVpFKGJvbmRzKTsgbisrKSB7CisJCWJvbmRz
W25dLmJhc2UubmFtZSA9IEk5MTVfQ09OVEVYVF9FTkdJTkVTX0VYVF9CT05EOworCQlib25kc1tu
XS5iYXNlLm5leHRfZXh0ZW5zaW9uID0KKwkJCW4gPyB0b191c2VyX3BvaW50ZXIoJmJvbmRzW24g
LSAxXSkgOiAwOworCQlib25kc1tuXS5udW1fYm9uZHMgPSAxOworCX0KKworCWZvciAoaW50IGNs
YXNzID0gMDsgY2xhc3MgPCAzMjsgY2xhc3MrKykgeworCQlzdHJ1Y3QgaTkxNV9lbmdpbmVfY2xh
c3NfaW5zdGFuY2UgKnNpYmxpbmdzOworCQl1bnNpZ25lZCBpbnQgY291bnQsIGxpbWl0LCAqb3Jk
ZXI7CisJCXVpbnQzMl90IGN0eDsKKwkJaW50IG47CisKKwkJc2libGluZ3MgPSBsaXN0X2VuZ2lu
ZXMoaTkxNSwgMXUgPDwgY2xhc3MsICZjb3VudCk7CisJCWlmICghc2libGluZ3MpCisJCQljb250
aW51ZTsKKworCQlpZiAoY291bnQgPCAyKSB7CisJCQlmcmVlKHNpYmxpbmdzKTsKKwkJCWNvbnRp
bnVlOworCQl9CisKKwkJbWFzdGVyX2VuZ2luZXMgPSBsaXN0X2VuZ2luZXMoaTkxNSwgfigxdSA8
PCBjbGFzcyksICZsaW1pdCk7CisJCXNldF9lbmdpbmVzKGk5MTUsIG1hc3RlciwgbWFzdGVyX2Vu
Z2luZXMsIGxpbWl0KTsKKworCQlsaW1pdCA9IG1pbihjb3VudCwgbGltaXQpOworCQlpZ3RfYXNz
ZXJ0KGxpbWl0IDw9IEFSUkFZX1NJWkUoYm9uZHMpKTsKKwkJZm9yIChuID0gMDsgbiA8IGxpbWl0
OyBuKyspIHsKKwkJCWJvbmRzW25dLm1hc3RlciA9IG1hc3Rlcl9lbmdpbmVzW25dOworCQkJYm9u
ZHNbbl0uZW5naW5lc1swXSA9IHNpYmxpbmdzW25dOworCQl9CisKKwkJY3R4ID0gZ2VtX2NvbnRl
eHRfY2xvbmUoaTkxNSwKKwkJCQkJbWFzdGVyLCBJOTE1X0NPTlRFWFRfQ0xPTkVfVk0sCisJCQkJ
CUk5MTVfQ09OVEVYVF9DUkVBVEVfRkxBR1NfU0lOR0xFX1RJTUVMSU5FKTsKKwkJc2V0X2xvYWRf
YmFsYW5jZXIoaTkxNSwgY3R4LCBzaWJsaW5ncywgY291bnQsICZib25kc1tsaW1pdCAtIDFdKTsK
KworCQlvcmRlciA9IG1hbGxvYyhzaXplb2YoKm9yZGVyKSAqIDggKiBsaW1pdCk7CisJCWlndF9h
c3NlcnQob3JkZXIpOworCQlmb3IgKG4gPSAwOyBuIDwgbGltaXQ7IG4rKykKKwkJCW9yZGVyWzIg
KiBsaW1pdCAtIG4gLSAxXSA9IG9yZGVyW25dID0gbiAlIGxpbWl0OworCQltZW1jcHkob3JkZXIg
KyAyICogbGltaXQsIG9yZGVyLCAyICogbGltaXQgKiBzaXplb2YoKm9yZGVyKSk7CisJCW1lbWNw
eShvcmRlciArIDQgKiBsaW1pdCwgb3JkZXIsIDQgKiBsaW1pdCAqIHNpemVvZigqb3JkZXIpKTsK
KwkJaWd0X3Blcm11dGVfYXJyYXkob3JkZXIgKyAyICogbGltaXQsIDYgKiBsaW1pdCwgaWd0X2V4
Y2hhbmdlX2ludCk7CisKKwkJZm9yIChuID0gMDsgbiA8IDggKiBsaW1pdDsgbisrKSB7CisJCQlz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyIGViOworCQkJaWd0X3NwaW5fdCAqc3Bpbiwg
KnBsdWc7CisJCQlJR1RfQ09SS19IQU5ETEUoY29yayk7CisJCQlkb3VibGUgdltsaW1pdF07CisJ
CQlpbnQgcG11W2xpbWl0ICsgMV07CisJCQlpbnQgYm9uZCA9IG9yZGVyW25dOworCisJCQlwbXVb
MF0gPSAtMTsKKwkJCWZvciAoaW50IGkgPSAwOyBpIDwgbGltaXQ7IGkrKykKKwkJCQlwbXVbaV0g
PSBhZGRfcG11KHBtdVswXSwgJnNpYmxpbmdzW2ldKTsKKwkJCXBtdVtsaW1pdF0gPSBhZGRfcG11
KHBtdVswXSwgJm1hc3Rlcl9lbmdpbmVzW2JvbmRdKTsKKworCQkJaWd0X2Fzc2VydChzaWJsaW5n
c1tib25kXS5lbmdpbmVfY2xhc3MgIT0KKwkJCQkgICBtYXN0ZXJfZW5naW5lc1tib25kXS5lbmdp
bmVfY2xhc3MpOworCisJCQlwbHVnID0gTlVMTDsKKwkJCWlmIChmbGFncyAmIENPUkspIHsKKwkJ
CQlwbHVnID0gX19pZ3Rfc3Bpbl9uZXcoaTkxNSwKKwkJCQkJCSAgICAgIC5jdHggPSBtYXN0ZXIs
CisJCQkJCQkgICAgICAuZW5naW5lID0gYm9uZCwKKwkJCQkJCSAgICAgIC5kZXBlbmRlbmN5ID0g
aWd0X2NvcmtfcGx1ZygmY29yaywgaTkxNSkpOworCQkJfQorCisJCQlzcGluID0gX19pZ3Rfc3Bp
bl9uZXcoaTkxNSwKKwkJCQkJICAgICAgLmN0eCA9IG1hc3RlciwKKwkJCQkJICAgICAgLmVuZ2lu
ZSA9IGJvbmQsCisJCQkJCSAgICAgIC5mbGFncyA9IElHVF9TUElOX0ZFTkNFX09VVCk7CisKKwkJ
CWViID0gc3Bpbi0+ZXhlY2J1ZjsKKwkJCWViLnJzdmQxID0gY3R4OworCQkJZWIucnN2ZDIgPSBz
cGluLT5vdXRfZmVuY2U7CisJCQllYi5mbGFncyA9IEk5MTVfRVhFQ19GRU5DRV9TVUJNSVQ7CisJ
CQlnZW1fZXhlY2J1ZihpOTE1LCAmZWIpOworCisJCQlpZiAocGx1ZykgeworCQkJCWlndF9jb3Jr
X3VucGx1ZygmY29yayk7CisJCQkJaWd0X3NwaW5fZnJlZShpOTE1LCBwbHVnKTsKKwkJCX0KKwor
CQkJbWVhc3VyZV9hbGxfbG9hZChwbXVbMF0sIHYsIGxpbWl0ICsgMSwgMTAwMDApOworCQkJaWd0
X3NwaW5fZnJlZShpOTE1LCBzcGluKTsKKworCQkJaWd0X2Fzc2VydF9mKHZbYm9uZF0gPiAwLjkw
LAorCQkJCSAgICAgImVuZ2luZSAlZCAoY2xhc3M6aW5zdGFuY2UgJXM6JWQpIHdhcyBmb3VuZCB0
byBiZSBvbmx5ICUuMWYlJSBidXN5XG4iLAorCQkJCSAgICAgYm9uZCwKKwkJCQkgICAgIGNsYXNz
X3RvX3N0cihzaWJsaW5nc1tib25kXS5lbmdpbmVfY2xhc3MpLAorCQkJCSAgICAgc2libGluZ3Nb
Ym9uZF0uZW5naW5lX2luc3RhbmNlLAorCQkJCSAgICAgMTAwICogdltib25kXSk7CisJCQlmb3Ig
KGludCBvdGhlciA9IDA7IG90aGVyIDwgbGltaXQ7IG90aGVyKyspIHsKKwkJCQlpZiAob3RoZXIg
PT0gYm9uZCkKKwkJCQkJY29udGludWU7CisKKwkJCQlpZ3RfYXNzZXJ0X2YodltvdGhlcl0gPT0g
MCwKKwkJCQkJICAgICAiZW5naW5lICVkIChjbGFzczppbnN0YW5jZSAlczolZCkgd2FzIG5vdCBp
ZGxlLCBhbmQgYWN0dWFsbHkgJS4xZiUlIGJ1c3lcbiIsCisJCQkJCSAgICAgb3RoZXIsCisJCQkJ
CSAgICAgY2xhc3NfdG9fc3RyKHNpYmxpbmdzW290aGVyXS5lbmdpbmVfY2xhc3MpLAorCQkJCQkg
ICAgIHNpYmxpbmdzW290aGVyXS5lbmdpbmVfaW5zdGFuY2UsCisJCQkJCSAgICAgMTAwICogdltv
dGhlcl0pOworCQkJfQorCQkJaWd0X2Fzc2VydF9mKHZbbGltaXRdID4gMC45MCwKKwkJCQkgICAg
ICJtYXN0ZXIgKGNsYXNzOmluc3RhbmNlICVzOiVkKSB3YXMgZm91bmQgdG8gYmUgb25seSAlLjFm
JSUgYnVzeVxuIiwKKwkJCQkgICAgIGNsYXNzX3RvX3N0cihtYXN0ZXJfZW5naW5lc1tib25kXS5l
bmdpbmVfY2xhc3MpLAorCQkJCSAgICAgbWFzdGVyX2VuZ2luZXNbYm9uZF0uZW5naW5lX2luc3Rh
bmNlLAorCQkJCSAgICAgMTAwICogdltsaW1pdF0pOworCisJCQljbG9zZShwbXVbMF0pOworCQl9
CisKKwkJZnJlZShvcmRlcik7CisJCWdlbV9jb250ZXh0X2Rlc3Ryb3koaTkxNSwgY3R4KTsKKwkJ
ZnJlZShtYXN0ZXJfZW5naW5lcyk7CisJCWZyZWUoc2libGluZ3MpOworCX0KKworCWdlbV9jb250
ZXh0X2Rlc3Ryb3koaTkxNSwgbWFzdGVyKTsKK30KKwogc3RhdGljIHZvaWQgaW5kaWNlcyhpbnQg
aTkxNSkKIHsKIAlJOTE1X0RFRklORV9DT05URVhUX1BBUkFNX0VOR0lORVMoZW5naW5lcywgSTkx
NV9FWEVDX1JJTkdfTUFTSyArIDEpOwpAQCAtODUxLDcgKzExMTEsNyBAQCBzdGF0aWMgdm9pZCBz
ZW1hcGhvcmUoaW50IGk5MTUpCiAJCWNvdW50ID0gQVJSQVlfU0laRShibG9jayk7CiAKIAkJZm9y
IChpbnQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7Ci0JCQlzZXRfbG9hZF9iYWxhbmNlcihpOTE1
LCBibG9ja1tpXSwgY2ksIGNvdW50KTsKKwkJCXNldF9sb2FkX2JhbGFuY2VyKGk5MTUsIGJsb2Nr
W2ldLCBjaSwgY291bnQsIE5VTEwpOwogCQkJc3BpbltpXSA9IF9faWd0X3NwaW5fbmV3KGk5MTUs
CiAJCQkJCQkgLmN0eCA9IGJsb2NrW2ldLAogCQkJCQkJIC5kZXBlbmRlbmN5ID0gc2NyYXRjaCk7
CkBAIC04NjIsNyArMTEyMiw3IEBAIHN0YXRpYyB2b2lkIHNlbWFwaG9yZShpbnQgaTkxNSkKIAkJ
ICogb3Igd2UgbGV0IHRoZSB2aXAgdGhyb3VnaC4gSWYgbm90LCB3ZSBoYW5nLgogCQkgKi8KIAkJ
dmlwID0gZ2VtX2NvbnRleHRfY3JlYXRlKGk5MTUpOwotCQlzZXRfbG9hZF9iYWxhbmNlcihpOTE1
LCB2aXAsIGNpLCBjb3VudCk7CisJCXNldF9sb2FkX2JhbGFuY2VyKGk5MTUsIHZpcCwgY2ksIGNv
dW50LCBOVUxMKTsKIAkJcGluZyhpOTE1LCB2aXAsIDApOwogCQlnZW1fY29udGV4dF9kZXN0cm95
KGk5MTUsIHZpcCk7CiAKQEAgLTk3Nyw3ICsxMjM3LDcgQEAgc3RhdGljIGJvb2wgaGFzX2xvYWRf
YmFsYW5jZXIoaW50IGk5MTUpCiAJaW50IGVycjsKIAogCWN0eCA9IGdlbV9jb250ZXh0X2NyZWF0
ZShpOTE1KTsKLQllcnIgPSBfX3NldF9sb2FkX2JhbGFuY2VyKGk5MTUsIGN0eCwgJmNpLCAxKTsK
KwllcnIgPSBfX3NldF9sb2FkX2JhbGFuY2VyKGk5MTUsIGN0eCwgJmNpLCAxLCBOVUxMKTsKIAln
ZW1fY29udGV4dF9kZXN0cm95KGk5MTUsIGN0eCk7CiAKIAlyZXR1cm4gZXJyID09IDA7CkBAIC0x
MDAzLDYgKzEyNjMsOSBAQCBpZ3RfbWFpbgogCWlndF9zdWJ0ZXN0KCJpbnZhbGlkLWJhbGFuY2Vy
IikKIAkJaW52YWxpZF9iYWxhbmNlcihpOTE1KTsKIAorCWlndF9zdWJ0ZXN0KCJpbnZhbGlkLWJv
bmRzIikKKwkJaW52YWxpZF9ib25kcyhpOTE1KTsKKwogCWlndF9zdWJ0ZXN0KCJpbmRpdmlkdWFs
IikKIAkJaW5kaXZpZHVhbChpOTE1KTsKIApAQCAtMTAzNyw2ICsxMzAwLDEyIEBAIGlndF9tYWlu
CiAJaWd0X3N1YnRlc3QoInNtb2tlIikKIAkJc21va2V0ZXN0KGk5MTUsIDIwKTsKIAorCWlndF9z
dWJ0ZXN0KCJib25kZWQtaW1tIikKKwkJYm9uZGVkKGk5MTUsIDApOworCisJaWd0X3N1YnRlc3Qo
ImJvbmRlZC1jb3JrIikKKwkJYm9uZGVkKGk5MTUsIENPUkspOworCiAJaWd0X2ZpeHR1cmUgewog
CQlpZ3Rfc3RvcF9oYW5nX2RldGVjdG9yKCk7CiAJfQotLSAKMi4yMC4xCgpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0
CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

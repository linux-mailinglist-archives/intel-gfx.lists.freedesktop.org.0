Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id BBF531FCE1B
	for <lists+intel-gfx@lfdr.de>; Wed, 17 Jun 2020 15:10:13 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 037496E945;
	Wed, 17 Jun 2020 13:10:12 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1A6386E945
 for <intel-gfx@lists.freedesktop.org>; Wed, 17 Jun 2020 13:10:09 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from build.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 21525094-1500050 
 for multiple; Wed, 17 Jun 2020 14:09:17 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 17 Jun 2020 14:09:15 +0100
Message-Id: <20200617130916.15261-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 1/2] drm/i915/selftests: Enable selftesting of
 busy-stats
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Chris Wilson <chris@chris-wilson.co.uk>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QSBjb3VwbGUgb2YgdmVyeSBzaW1wbGUgdGVzdHMgdG8gZW5zdXJlIHRoYXQgdGhlIGJhc2ljIHBy
b3BlcnRpZXMgb2YKcGVyLWVuZ2luZSBidXN5bmVzcyBhY2NvdW50aW5nIFswJSBhbmQgMTAwJSBi
dXN5XSBhcmUgZmFpdGhmdWwuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNo
cmlzLXdpbHNvbi5jby51az4KUmV2aWV3ZWQtYnk6IE1pa2EgS3VvcHBhbGEgPG1pa2Eua3VvcHBh
bGFAbGludXguaW50ZWwuY29tPgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGlu
dGVsLmNvbT4KLS0tCiAuLi4vZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5lX2hlYXJ0YmVhdC5j
ICAgfCAgNDcgKysrKy0tLS0KIC4uLi9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVfaGVhcnRi
ZWF0LmggICB8ICAxNCArKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2lu
ZV9wbS5jICB8IDEwMyArKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3NlbGZ0ZXN0X2hhbmdjaGVjay5jICB8ICAyOSArKy0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Qvc2VsZnRlc3RfbHJjLmMgICAgICAgIHwgIDc5ICsrKysrKy0tLS0tLS0tCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9ycHMuYyAgICAgICAgfCAgNjggKysrKystLS0tLS0tCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF90aW1lbGluZS5jICAgfCAgMjEgKy0tLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcmVxdWVzdC5jIHwgIDIxICstLS0K
IDggZmlsZXMgY2hhbmdlZCwgMjEyIGluc2VydGlvbnMoKyksIDE3MCBkZWxldGlvbnMoLSkKIGNy
ZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVf
aGVhcnRiZWF0LmgKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVz
dF9lbmdpbmVfaGVhcnRiZWF0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9l
bmdpbmVfaGVhcnRiZWF0LmMKaW5kZXggNjk3MTE0ZGQxZjQ3Li5mMzAzNGM2MTNiYzAgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9oZWFydGJlYXQu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVfaGVhcnRiZWF0
LmMKQEAgLTEwLDYgKzEwLDcgQEAKIAogI2luY2x1ZGUgImludGVsX2d0X3JlcXVlc3RzLmgiCiAj
aW5jbHVkZSAiaTkxNV9zZWxmdGVzdC5oIgorI2luY2x1ZGUgInNlbGZ0ZXN0X2VuZ2luZV9oZWFy
dGJlYXQuaCIKIAogc3RhdGljIGludCB0aW1lbGluZV9zeW5jKHN0cnVjdCBpbnRlbF90aW1lbGlu
ZSAqdGwpCiB7CkBAIC0xNDIsMjQgKzE0Myw2IEBAIHN0YXRpYyBpbnQgX19saXZlX2lkbGVfcHVs
c2Uoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCXJldHVybiBlcnI7CiB9CiAKLXN0
YXRpYyB2b2lkIGVuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmUsCi0JCQkJICAgICB1bnNpZ25lZCBsb25nICpzYXZlZCkKLXsKLQkqc2F2ZWQgPSBl
bmdpbmUtPnByb3BzLmhlYXJ0YmVhdF9pbnRlcnZhbF9tczsKLQllbmdpbmUtPnByb3BzLmhlYXJ0
YmVhdF9pbnRlcnZhbF9tcyA9IDA7Ci0KLQlpbnRlbF9lbmdpbmVfcG1fZ2V0KGVuZ2luZSk7Ci0J
aW50ZWxfZW5naW5lX3BhcmtfaGVhcnRiZWF0KGVuZ2luZSk7Ci19Ci0KLXN0YXRpYyB2b2lkIGVu
Z2luZV9oZWFydGJlYXRfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKLQkJ
CQkgICAgdW5zaWduZWQgbG9uZyBzYXZlZCkKLXsKLQlpbnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2lu
ZSk7Ci0KLQllbmdpbmUtPnByb3BzLmhlYXJ0YmVhdF9pbnRlcnZhbF9tcyA9IHNhdmVkOwotfQot
CiBzdGF0aWMgaW50IGxpdmVfaWRsZV9mbHVzaCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGludGVs
X2d0ICpndCA9IGFyZzsKQEAgLTE3MCwxMSArMTUzLDkgQEAgc3RhdGljIGludCBsaXZlX2lkbGVf
Zmx1c2godm9pZCAqYXJnKQogCS8qIENoZWNrIHRoYXQgd2UgY2FuIGZsdXNoIHRoZSBpZGxlIGJh
cnJpZXJzICovCiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwgaWQpIHsKLQkJdW5zaWdu
ZWQgbG9uZyBoZWFydGJlYXQ7Ci0KLQkJZW5naW5lX2hlYXJ0YmVhdF9kaXNhYmxlKGVuZ2luZSwg
JmhlYXJ0YmVhdCk7CisJCXN0X2VuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUpOwogCQll
cnIgPSBfX2xpdmVfaWRsZV9wdWxzZShlbmdpbmUsIGludGVsX2VuZ2luZV9mbHVzaF9iYXJyaWVy
cyk7Ci0JCWVuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSwgaGVhcnRiZWF0KTsKKwkJc3Rf
ZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwog
CX0KQEAgLTE5MiwxMSArMTczLDkgQEAgc3RhdGljIGludCBsaXZlX2lkbGVfcHVsc2Uodm9pZCAq
YXJnKQogCS8qIENoZWNrIHRoYXQgaGVhcnRiZWF0IHB1bHNlcyBmbHVzaCB0aGUgaWRsZSBiYXJy
aWVycyAqLwogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7Ci0JCXVuc2lnbmVk
IGxvbmcgaGVhcnRiZWF0OwotCi0JCWVuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUsICZo
ZWFydGJlYXQpOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoZW5naW5lKTsKIAkJZXJy
ID0gX19saXZlX2lkbGVfcHVsc2UoZW5naW5lLCBpbnRlbF9lbmdpbmVfcHVsc2UpOwotCQllbmdp
bmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUsIGhlYXJ0YmVhdCk7CisJCXN0X2VuZ2luZV9oZWFy
dGJlYXRfZW5hYmxlKGVuZ2luZSk7CiAJCWlmIChlcnIgJiYgZXJyICE9IC1FTk9ERVYpCiAJCQli
cmVhazsKIApAQCAtMzk0LDMgKzM3MywxOSBAQCBpbnQgaW50ZWxfaGVhcnRiZWF0X2xpdmVfc2Vs
ZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCWk5MTVfbW9kcGFyYW1zLmVu
YWJsZV9oYW5nY2hlY2sgPSBzYXZlZF9oYW5nY2hlY2s7CiAJcmV0dXJuIGVycjsKIH0KKwordm9p
ZCBzdF9lbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lKQoreworCWVuZ2luZS0+cHJvcHMuaGVhcnRiZWF0X2ludGVydmFsX21zID0gMDsKKworCWlu
dGVsX2VuZ2luZV9wbV9nZXQoZW5naW5lKTsKKwlpbnRlbF9lbmdpbmVfcGFya19oZWFydGJlYXQo
ZW5naW5lKTsKK30KKwordm9pZCBzdF9lbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUpCit7CisJaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOwor
CisJZW5naW5lLT5wcm9wcy5oZWFydGJlYXRfaW50ZXJ2YWxfbXMgPQorCQllbmdpbmUtPmRlZmF1
bHRzLmhlYXJ0YmVhdF9pbnRlcnZhbF9tczsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9oZWFydGJlYXQuaCBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9oZWFydGJlYXQuaApuZXcgZmlsZSBtb2RlIDEwMDY0NApp
bmRleCAwMDAwMDAwMDAwMDAuLmNkMjcxMTNkNTQwMAotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9oZWFydGJlYXQuaApAQCAtMCwwICsx
LDE0IEBACisvKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUICovCisvKgorICogQ29weXJp
Z2h0IMKpIDIwMjAgSW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaWZuZGVmIFNFTEZURVNUX0VO
R0lORV9IRUFSVEJFQVRfSAorI2RlZmluZSBTRUxGVEVTVF9FTkdJTkVfSEVBUlRCRUFUX0gKKwor
c3RydWN0IGludGVsX2VuZ2luZV9jczsKKwordm9pZCBzdF9lbmdpbmVfaGVhcnRiZWF0X2Rpc2Fi
bGUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKK3ZvaWQgc3RfZW5naW5lX2hlYXJ0
YmVhdF9lbmFibGUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKKworI2VuZGlmIC8q
IFNFTEZURVNUX0VOR0lORV9IRUFSVEJFQVRfSCAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5lX3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9zZWxmdGVzdF9lbmdpbmVfcG0uYwppbmRleCBjYmY2YjA3MzUyNzIuLmRkNTRkY2I1Y2NhMiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5lX3BtLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5lX3BtLmMKQEAgLTYs
NyArNiwxMDkgQEAKIAogI2luY2x1ZGUgImk5MTVfc2VsZnRlc3QuaCIKICNpbmNsdWRlICJzZWxm
dGVzdF9lbmdpbmUuaCIKKyNpbmNsdWRlICJzZWxmdGVzdF9lbmdpbmVfaGVhcnRiZWF0LmgiCiAj
aW5jbHVkZSAic2VsZnRlc3RzL2lndF9hdG9taWMuaCIKKyNpbmNsdWRlICJzZWxmdGVzdHMvaWd0
X2ZsdXNoX3Rlc3QuaCIKKyNpbmNsdWRlICJzZWxmdGVzdHMvaWd0X3NwaW5uZXIuaCIKKworc3Rh
dGljIGludCBsaXZlX2VuZ2luZV9idXN5X3N0YXRzKHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50
ZWxfZ3QgKmd0ID0gYXJnOworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKKwllbnVt
IGludGVsX2VuZ2luZV9pZCBpZDsKKwlzdHJ1Y3QgaWd0X3NwaW5uZXIgc3BpbjsKKwlpbnQgZXJy
ID0gMDsKKworCS8qCisJICogQ2hlY2sgdGhhdCBpZiBhbiBlbmdpbmUgc3VwcG9ydHMgYnVzeS1z
dGF0cywgdGhleSB0ZWxsIHRoZSB0cnV0aC4KKwkgKi8KKworCWlmIChpZ3Rfc3Bpbm5lcl9pbml0
KCZzcGluLCBndCkpCisJCXJldHVybiAtRU5PTUVNOworCisJR0VNX0JVR19PTihpbnRlbF9ndF9w
bV9pc19hd2FrZShndCkpOworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgeworCQlz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKKwkJa3RpbWVfdCBkZTsKKwkJdTY0IGR0OworCisJCWlm
ICghaW50ZWxfZW5naW5lX3N1cHBvcnRzX3N0YXRzKGVuZ2luZSkpCisJCQljb250aW51ZTsKKwor
CQlpZiAoIWludGVsX2VuZ2luZV9jYW5fc3RvcmVfZHdvcmQoZW5naW5lKSkKKwkJCWNvbnRpbnVl
OworCisJCWlmIChpbnRlbF9ndF9wbV93YWl0X2Zvcl9pZGxlKGd0KSkgeworCQkJZXJyID0gLUVC
VVNZOworCQkJYnJlYWs7CisJCX0KKworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoZW5n
aW5lKTsKKworCQlFTkdJTkVfVFJBQ0UoZW5naW5lLCAibWVhc3VyaW5nIGlkbGUgdGltZVxuIik7
CisJCXByZWVtcHRfZGlzYWJsZSgpOworCQlkdCA9IGt0aW1lX3RvX25zKGt0aW1lX2dldCgpKTsK
KwkJZGUgPSBpbnRlbF9lbmdpbmVfZ2V0X2J1c3lfdGltZShlbmdpbmUpOworCQl1ZGVsYXkoMTAw
KTsKKwkJZGUgPSBrdGltZV9zdWIoaW50ZWxfZW5naW5lX2dldF9idXN5X3RpbWUoZW5naW5lKSwg
ZGUpOworCQlkdCA9IGt0aW1lX3RvX25zKGt0aW1lX2dldCgpKSAtIGR0OworCQlwcmVlbXB0X2Vu
YWJsZSgpOworCQlpZiAoZGUgPCAwIHx8IGRlID4gMTApIHsKKwkJCXByX2VycigiJXM6IHJlcG9y
dGVkICVsbGRucyBbJWQlJV0gYnVzeW5lc3Mgd2hpbGUgc2xlZXBpbmcgW2ZvciAlbGxkbnNdXG4i
LAorCQkJICAgICAgIGVuZ2luZS0+bmFtZSwKKwkJCSAgICAgICBkZSwgKGludClkaXY2NF91NjQo
MTAwICogZGUsIGR0KSwgZHQpOworCQkJR0VNX1RSQUNFX0RVTVAoKTsKKwkJCWVyciA9IC1FSU5W
QUw7CisJCQlnb3RvIGVuZDsKKwkJfQorCisJCS8qIDEwMCUgYnVzeSAqLworCQlycSA9IGlndF9z
cGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZzcGluLAorCQkJCQkJZW5naW5lLT5rZXJuZWxfY29udGV4
dCwKKwkJCQkJCU1JX05PT1ApOworCQlpZiAoSVNfRVJSKHJxKSkgeworCQkJZXJyID0gUFRSX0VS
UihycSk7CisJCQlnb3RvIGVuZDsKKwkJfQorCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKworCQlp
ZiAoIWlndF93YWl0X2Zvcl9zcGlubmVyKCZzcGluLCBycSkpIHsKKwkJCWludGVsX2d0X3NldF93
ZWRnZWQoZW5naW5lLT5ndCk7CisJCQllcnIgPSAtRVRJTUU7CisJCQlnb3RvIGVuZDsKKwkJfQor
CisJCUVOR0lORV9UUkFDRShlbmdpbmUsICJtZWFzdXJpbmcgYnVzeSB0aW1lXG4iKTsKKwkJcHJl
ZW1wdF9kaXNhYmxlKCk7CisJCWR0ID0ga3RpbWVfdG9fbnMoa3RpbWVfZ2V0KCkpOworCQlkZSA9
IGludGVsX2VuZ2luZV9nZXRfYnVzeV90aW1lKGVuZ2luZSk7CisJCXVkZWxheSgxMDApOworCQlk
ZSA9IGt0aW1lX3N1YihpbnRlbF9lbmdpbmVfZ2V0X2J1c3lfdGltZShlbmdpbmUpLCBkZSk7CisJ
CWR0ID0ga3RpbWVfdG9fbnMoa3RpbWVfZ2V0KCkpIC0gZHQ7CisJCXByZWVtcHRfZW5hYmxlKCk7
CisJCWlmICgxMDAgKiBkZSA8IDk1ICogZHQgfHwgOTUgKiBkZSA+IDEwMCAqIGR0KSB7CisJCQlw
cl9lcnIoIiVzOiByZXBvcnRlZCAlbGxkbnMgWyVkJSVdIGJ1c3luZXNzIHdoaWxlIHNwaW5uaW5n
IFtmb3IgJWxsZG5zXVxuIiwKKwkJCSAgICAgICBlbmdpbmUtPm5hbWUsCisJCQkgICAgICAgZGUs
IChpbnQpZGl2NjRfdTY0KDEwMCAqIGRlLCBkdCksIGR0KTsKKwkJCUdFTV9UUkFDRV9EVU1QKCk7
CisJCQllcnIgPSAtRUlOVkFMOworCQkJZ290byBlbmQ7CisJCX0KKworZW5kOgorCQlzdF9lbmdp
bmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOworCQlpZ3Rfc3Bpbm5lcl9lbmQoJnNwaW4pOwor
CQlpZiAoaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpKQorCQkJZXJyID0gLUVJTzsKKwkJaWYgKGVy
cikKKwkJCWJyZWFrOworCX0KKworCWlndF9zcGlubmVyX2ZpbmkoJnNwaW4pOworCWlmIChpZ3Rf
Zmx1c2hfdGVzdChndC0+aTkxNSkpCisJCWVyciA9IC1FSU87CisJcmV0dXJuIGVycjsKK30KIAog
c3RhdGljIGludCBsaXZlX2VuZ2luZV9wbSh2b2lkICphcmcpCiB7CkBAIC03Nyw2ICsxNzksNyBA
QCBzdGF0aWMgaW50IGxpdmVfZW5naW5lX3BtKHZvaWQgKmFyZykKIGludCBsaXZlX2VuZ2luZV9w
bV9zZWxmdGVzdHMoc3RydWN0IGludGVsX2d0ICpndCkKIHsKIAlzdGF0aWMgY29uc3Qgc3RydWN0
IGk5MTVfc3VidGVzdCB0ZXN0c1tdID0geworCQlTVUJURVNUKGxpdmVfZW5naW5lX2J1c3lfc3Rh
dHMpLAogCQlTVUJURVNUKGxpdmVfZW5naW5lX3BtKSwKIAl9OwogCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jCmluZGV4IDc0NjE5MzZkNTQ5ZC4uZmI1ZWJm
OTMwYWIyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5n
Y2hlY2suYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2su
YwpAQCAtMjksNiArMjksNyBAQAogI2luY2x1ZGUgImludGVsX2d0LmgiCiAjaW5jbHVkZSAiaW50
ZWxfZW5naW5lX2hlYXJ0YmVhdC5oIgogI2luY2x1ZGUgImludGVsX2VuZ2luZV9wbS5oIgorI2lu
Y2x1ZGUgInNlbGZ0ZXN0X2VuZ2luZV9oZWFydGJlYXQuaCIKIAogI2luY2x1ZGUgImk5MTVfc2Vs
ZnRlc3QuaCIKICNpbmNsdWRlICJzZWxmdGVzdHMvaTkxNV9yYW5kb20uaCIKQEAgLTMxMCwyMiAr
MzExLDYgQEAgc3RhdGljIGJvb2wgd2FpdF91bnRpbF9ydW5uaW5nKHN0cnVjdCBoYW5nICpoLCBz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAkJCSAgMTAwMCkpOwogfQogCi1zdGF0aWMgdm9pZCBl
bmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQot
ewotCWVuZ2luZS0+cHJvcHMuaGVhcnRiZWF0X2ludGVydmFsX21zID0gMDsKLQotCWludGVsX2Vu
Z2luZV9wbV9nZXQoZW5naW5lKTsKLQlpbnRlbF9lbmdpbmVfcGFya19oZWFydGJlYXQoZW5naW5l
KTsKLX0KLQotc3RhdGljIHZvaWQgZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lKQotewotCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKLQot
CWVuZ2luZS0+cHJvcHMuaGVhcnRiZWF0X2ludGVydmFsX21zID0KLQkJZW5naW5lLT5kZWZhdWx0
cy5oZWFydGJlYXRfaW50ZXJ2YWxfbXM7Ci19Ci0KIHN0YXRpYyBpbnQgaWd0X2hhbmdfc2FuaXR5
Y2hlY2sodm9pZCAqYXJnKQogewogCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CkBAIC00ODIs
NyArNDY3LDcgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfbm9wX2VuZ2luZSh2b2lkICphcmcpCiAJ
CXJlc2V0X2VuZ2luZV9jb3VudCA9IGk5MTVfcmVzZXRfZW5naW5lX2NvdW50KGdsb2JhbCwgZW5n
aW5lKTsKIAkJY291bnQgPSAwOwogCi0JCWVuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUp
OworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoZW5naW5lKTsKIAkJc2V0X2JpdChJOTE1
X1JFU0VUX0VOR0lORSArIGlkLCAmZ3QtPnJlc2V0LmZsYWdzKTsKIAkJZG8gewogCQkJaW50IGk7
CkBAIC01NDAsNyArNTI1LDcgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfbm9wX2VuZ2luZSh2b2lk
ICphcmcpCiAJCQl9CiAJCX0gd2hpbGUgKHRpbWVfYmVmb3JlKGppZmZpZXMsIGVuZF90aW1lKSk7
CiAJCWNsZWFyX2JpdChJOTE1X1JFU0VUX0VOR0lORSArIGlkLCAmZ3QtPnJlc2V0LmZsYWdzKTsK
LQkJZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKKwkJc3RfZW5naW5lX2hlYXJ0YmVh
dF9lbmFibGUoZW5naW5lKTsKIAogCQlwcl9pbmZvKCIlcyglcyk6ICVkIHJlc2V0c1xuIiwgX19m
dW5jX18sIGVuZ2luZS0+bmFtZSwgY291bnQpOwogCkBAIC01OTAsNyArNTc1LDcgQEAgc3RhdGlj
IGludCBfX2lndF9yZXNldF9lbmdpbmUoc3RydWN0IGludGVsX2d0ICpndCwgYm9vbCBhY3RpdmUp
CiAJCXJlc2V0X2NvdW50ID0gaTkxNV9yZXNldF9jb3VudChnbG9iYWwpOwogCQlyZXNldF9lbmdp
bmVfY291bnQgPSBpOTE1X3Jlc2V0X2VuZ2luZV9jb3VudChnbG9iYWwsIGVuZ2luZSk7CiAKLQkJ
ZW5naW5lX2hlYXJ0YmVhdF9kaXNhYmxlKGVuZ2luZSk7CisJCXN0X2VuZ2luZV9oZWFydGJlYXRf
ZGlzYWJsZShlbmdpbmUpOwogCQlzZXRfYml0KEk5MTVfUkVTRVRfRU5HSU5FICsgaWQsICZndC0+
cmVzZXQuZmxhZ3MpOwogCQlkbyB7CiAJCQlpZiAoYWN0aXZlKSB7CkBAIC02NDIsNyArNjI3LDcg
QEAgc3RhdGljIGludCBfX2lndF9yZXNldF9lbmdpbmUoc3RydWN0IGludGVsX2d0ICpndCwgYm9v
bCBhY3RpdmUpCiAJCQl9CiAJCX0gd2hpbGUgKHRpbWVfYmVmb3JlKGppZmZpZXMsIGVuZF90aW1l
KSk7CiAJCWNsZWFyX2JpdChJOTE1X1JFU0VUX0VOR0lORSArIGlkLCAmZ3QtPnJlc2V0LmZsYWdz
KTsKLQkJZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKKwkJc3RfZW5naW5lX2hlYXJ0
YmVhdF9lbmFibGUoZW5naW5lKTsKIAogCQlpZiAoZXJyKQogCQkJYnJlYWs7CkBAIC04NDEsNyAr
ODI2LDcgQEAgc3RhdGljIGludCBfX2lndF9yZXNldF9lbmdpbmVzKHN0cnVjdCBpbnRlbF9ndCAq
Z3QsCiAKIAkJeWllbGQoKTsgLyogc3RhcnQgYWxsIHRocmVhZHMgYmVmb3JlIHdlIGJlZ2luICov
CiAKLQkJZW5naW5lX2hlYXJ0YmVhdF9kaXNhYmxlKGVuZ2luZSk7CisJCXN0X2VuZ2luZV9oZWFy
dGJlYXRfZGlzYWJsZShlbmdpbmUpOwogCQlzZXRfYml0KEk5MTVfUkVTRVRfRU5HSU5FICsgaWQs
ICZndC0+cmVzZXQuZmxhZ3MpOwogCQlkbyB7CiAJCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSA9
IE5VTEw7CkBAIC05MzEsNyArOTE2LDcgQEAgc3RhdGljIGludCBfX2lndF9yZXNldF9lbmdpbmVz
KHN0cnVjdCBpbnRlbF9ndCAqZ3QsCiAJCQl9CiAJCX0gd2hpbGUgKHRpbWVfYmVmb3JlKGppZmZp
ZXMsIGVuZF90aW1lKSk7CiAJCWNsZWFyX2JpdChJOTE1X1JFU0VUX0VOR0lORSArIGlkLCAmZ3Qt
PnJlc2V0LmZsYWdzKTsKLQkJZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKKwkJc3Rf
ZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKIAogCQlwcl9pbmZvKCJpOTE1X3Jlc2V0
X2VuZ2luZSglczolcyk6ICVsdSByZXNldHNcbiIsCiAJCQllbmdpbmUtPm5hbWUsIHRlc3RfbmFt
ZSwgY291bnQpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
bHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwppbmRleCA0ZjM3
NThhMWNiY2YuLjdmMjcwODhkZWQ1NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Qvc2VsZnRlc3RfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
bHJjLmMKQEAgLTksNiArOSw3IEBACiAjaW5jbHVkZSAiZ2VtL2k5MTVfZ2VtX3BtLmgiCiAjaW5j
bHVkZSAiZ3QvaW50ZWxfZW5naW5lX2hlYXJ0YmVhdC5oIgogI2luY2x1ZGUgImd0L2ludGVsX3Jl
c2V0LmgiCisjaW5jbHVkZSAiZ3Qvc2VsZnRlc3RfZW5naW5lX2hlYXJ0YmVhdC5oIgogCiAjaW5j
bHVkZSAiaTkxNV9zZWxmdGVzdC5oIgogI2luY2x1ZGUgInNlbGZ0ZXN0cy9pOTE1X3JhbmRvbS5o
IgpAQCAtNTEsMjIgKzUyLDYgQEAgc3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqY3JlYXRlX3NjcmF0
Y2goc3RydWN0IGludGVsX2d0ICpndCkKIAlyZXR1cm4gdm1hOwogfQogCi1zdGF0aWMgdm9pZCBl
bmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQot
ewotCWVuZ2luZS0+cHJvcHMuaGVhcnRiZWF0X2ludGVydmFsX21zID0gMDsKLQotCWludGVsX2Vu
Z2luZV9wbV9nZXQoZW5naW5lKTsKLQlpbnRlbF9lbmdpbmVfcGFya19oZWFydGJlYXQoZW5naW5l
KTsKLX0KLQotc3RhdGljIHZvaWQgZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lKQotewotCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKLQot
CWVuZ2luZS0+cHJvcHMuaGVhcnRiZWF0X2ludGVydmFsX21zID0KLQkJZW5naW5lLT5kZWZhdWx0
cy5oZWFydGJlYXRfaW50ZXJ2YWxfbXM7Ci19Ci0KIHN0YXRpYyBib29sIGlzX2FjdGl2ZShzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKIAlpZiAoaTkxNV9yZXF1ZXN0X2lzX2FjdGl2ZShycSkp
CkBAIC0yMzQsNyArMjE5LDcgQEAgc3RhdGljIGludCBsaXZlX3VubGl0ZV9yZXN0b3JlKHN0cnVj
dCBpbnRlbF9ndCAqZ3QsIGludCBwcmlvKQogCQkJZXJyID0gLUVJTzsKIAkJCWJyZWFrOwogCQl9
Ci0JCWVuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUpOworCQlzdF9lbmdpbmVfaGVhcnRi
ZWF0X2Rpc2FibGUoZW5naW5lKTsKIAogCQlmb3IgKG4gPSAwOyBuIDwgQVJSQVlfU0laRShjZSk7
IG4rKykgewogCQkJc3RydWN0IGludGVsX2NvbnRleHQgKnRtcDsKQEAgLTM0Miw3ICszMjcsNyBA
QCBzdGF0aWMgaW50IGxpdmVfdW5saXRlX3Jlc3RvcmUoc3RydWN0IGludGVsX2d0ICpndCwgaW50
IHByaW8pCiAJCQlpbnRlbF9jb250ZXh0X3B1dChjZVtuXSk7CiAJCX0KIAotCQllbmdpbmVfaGVh
cnRiZWF0X2VuYWJsZShlbmdpbmUpOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdp
bmUpOwogCQlpZiAoaWd0X2xpdmVfdGVzdF9lbmQoJnQpKQogCQkJZXJyID0gLUVJTzsKIAkJaWYg
KGVycikKQEAgLTM5Niw3ICszODEsNyBAQCBzdGF0aWMgaW50IGxpdmVfdW5saXRlX3Jpbmcodm9p
ZCAqYXJnKQogCQkJZXJyID0gLUVJTzsKIAkJCWJyZWFrOwogCQl9Ci0JCWVuZ2luZV9oZWFydGJl
YXRfZGlzYWJsZShlbmdpbmUpOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoZW5naW5l
KTsKIAogCQlmb3IgKG4gPSAwOyBuIDwgQVJSQVlfU0laRShjZSk7IG4rKykgewogCQkJc3RydWN0
IGludGVsX2NvbnRleHQgKnRtcDsKQEAgLTUwMiw3ICs0ODcsNyBAQCBzdGF0aWMgaW50IGxpdmVf
dW5saXRlX3Jpbmcodm9pZCAqYXJnKQogCQkJaW50ZWxfY29udGV4dF91bnBpbihjZVtuXSk7CiAJ
CQlpbnRlbF9jb250ZXh0X3B1dChjZVtuXSk7CiAJCX0KLQkJZW5naW5lX2hlYXJ0YmVhdF9lbmFi
bGUoZW5naW5lKTsKKwkJc3RfZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKIAkJaWYg
KGlndF9saXZlX3Rlc3RfZW5kKCZ0KSkKIAkJCWVyciA9IC1FSU87CiAJCWlmIChlcnIpCkBAIC02
MjEsNyArNjA2LDcgQEAgc3RhdGljIGludCBsaXZlX2hvbGRfcmVzZXQodm9pZCAqYXJnKQogCQkJ
YnJlYWs7CiAJCX0KIAotCQllbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoZW5naW5lKTsKKwkJc3Rf
ZW5naW5lX2hlYXJ0YmVhdF9kaXNhYmxlKGVuZ2luZSk7CiAKIAkJcnEgPSBpZ3Rfc3Bpbm5lcl9j
cmVhdGVfcmVxdWVzdCgmc3BpbiwgY2UsIE1JX0FSQl9DSEVDSyk7CiAJCWlmIChJU19FUlIocnEp
KSB7CkBAIC02ODEsNyArNjY2LDcgQEAgc3RhdGljIGludCBsaXZlX2hvbGRfcmVzZXQodm9pZCAq
YXJnKQogCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKIAogb3V0OgotCQllbmdpbmVfaGVhcnRiZWF0
X2VuYWJsZShlbmdpbmUpOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOwog
CQlpbnRlbF9jb250ZXh0X3B1dChjZSk7CiAJCWlmIChlcnIpCiAJCQlicmVhazsKQEAgLTcyOCw3
ICs3MTMsNyBAQCBzdGF0aWMgaW50IGxpdmVfZXJyb3JfaW50ZXJydXB0KHZvaWQgKmFyZykKIAkJ
Y29uc3Qgc3RydWN0IGVycm9yX3BoYXNlICpwOwogCQlpbnQgZXJyID0gMDsKIAotCQllbmdpbmVf
aGVhcnRiZWF0X2Rpc2FibGUoZW5naW5lKTsKKwkJc3RfZW5naW5lX2hlYXJ0YmVhdF9kaXNhYmxl
KGVuZ2luZSk7CiAKIAkJZm9yIChwID0gcGhhc2VzOyBwLT5lcnJvclswXSAhPSBHT09EOyBwKysp
IHsKIAkJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKmNsaWVudFtBUlJBWV9TSVpFKHBoYXNlcy0+ZXJy
b3IpXTsKQEAgLTgyNyw3ICs4MTIsNyBAQCBzdGF0aWMgaW50IGxpdmVfZXJyb3JfaW50ZXJydXB0
KHZvaWQgKmFyZykKIAkJCX0KIAkJfQogCi0JCWVuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2lu
ZSk7CisJCXN0X2VuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CiAJCWlmIChlcnIpIHsK
IAkJCWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOwogCQkJcmV0dXJuIGVycjsKQEAgLTEwNDIsOSAr
MTAyNyw5IEBAIHN0YXRpYyBpbnQgbGl2ZV90aW1lc2xpY2VfcHJlZW1wdCh2b2lkICphcmcpCiAK
IAkJbWVtc2V0KHZhZGRyLCAwLCBQQUdFX1NJWkUpOwogCi0JCWVuZ2luZV9oZWFydGJlYXRfZGlz
YWJsZShlbmdpbmUpOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoZW5naW5lKTsKIAkJ
ZXJyID0gc2xpY2Vfc2VtYXBob3JlX3F1ZXVlKGVuZ2luZSwgdm1hLCA1KTsKLQkJZW5naW5lX2hl
YXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKKwkJc3RfZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5n
aW5lKTsKIAkJaWYgKGVycikKIAkJCWdvdG8gZXJyX3BpbjsKIApAQCAtMTE2Niw3ICsxMTUxLDcg
QEAgc3RhdGljIGludCBsaXZlX3RpbWVzbGljZV9yZXdpbmQodm9pZCAqYXJnKQogCQkgKiBFeHBl
Y3QgZXhlY3V0aW9uL2V2YWx1YXRpb24gb3JkZXIgWFpZCiAJCSAqLwogCi0JCWVuZ2luZV9oZWFy
dGJlYXRfZGlzYWJsZShlbmdpbmUpOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoZW5n
aW5lKTsKIAkJdGltZXNsaWNlID0geGNoZygmZW5naW5lLT5wcm9wcy50aW1lc2xpY2VfZHVyYXRp
b25fbXMsIDEpOwogCiAJCXNsb3QgPSBtZW1zZXQzMihlbmdpbmUtPnN0YXR1c19wYWdlLmFkZHIg
KyAxMDAwLCAwLCA0KTsKQEAgLTEyNjEsNyArMTI0Niw3IEBAIHN0YXRpYyBpbnQgbGl2ZV90aW1l
c2xpY2VfcmV3aW5kKHZvaWQgKmFyZykKIAkJd21iKCk7CiAKIAkJZW5naW5lLT5wcm9wcy50aW1l
c2xpY2VfZHVyYXRpb25fbXMgPSB0aW1lc2xpY2U7Ci0JCWVuZ2luZV9oZWFydGJlYXRfZW5hYmxl
KGVuZ2luZSk7CisJCXN0X2VuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CiAJCWZvciAo
aSA9IDA7IGkgPCAzOyBpKyspCiAJCQlpOTE1X3JlcXVlc3RfcHV0KHJxW2ldKTsKIAkJaWYgKGln
dF9mbHVzaF90ZXN0KGd0LT5pOTE1KSkKQEAgLTEzNTMsNyArMTMzOCw3IEBAIHN0YXRpYyBpbnQg
bGl2ZV90aW1lc2xpY2VfcXVldWUodm9pZCAqYXJnKQogCQlpZiAoIWludGVsX2VuZ2luZV9oYXNf
cHJlZW1wdGlvbihlbmdpbmUpKQogCQkJY29udGludWU7CiAKLQkJZW5naW5lX2hlYXJ0YmVhdF9k
aXNhYmxlKGVuZ2luZSk7CisJCXN0X2VuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUpOwog
CQltZW1zZXQodmFkZHIsIDAsIFBBR0VfU0laRSk7CiAKIAkJLyogRUxTUFswXTogc2VtYXBob3Jl
IHdhaXQgKi8KQEAgLTE0MTQsNyArMTM5OSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV90aW1lc2xpY2Vf
cXVldWUodm9pZCAqYXJnKQogZXJyX3JxOgogCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKIGVycl9o
ZWFydGJlYXQ6Ci0JCWVuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CisJCXN0X2VuZ2lu
ZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CiAJCWlmIChlcnIpCiAJCQlicmVhazsKIAl9CkBA
IC0xNDYwLDcgKzE0NDUsNyBAQCBzdGF0aWMgaW50IGxpdmVfdGltZXNsaWNlX25vcHJlZW1wdCh2
b2lkICphcmcpCiAJCQlicmVhazsKIAkJfQogCi0JCWVuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShl
bmdpbmUpOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoZW5naW5lKTsKIAkJdGltZXNs
aWNlID0geGNoZygmZW5naW5lLT5wcm9wcy50aW1lc2xpY2VfZHVyYXRpb25fbXMsIDEpOwogCiAJ
CS8qIENyZWF0ZSBhbiB1bnByZWVtcHRpYmxlIHNwaW5uZXIgKi8KQEAgLTE1MjksNyArMTUxNCw3
IEBAIHN0YXRpYyBpbnQgbGl2ZV90aW1lc2xpY2Vfbm9wcmVlbXB0KHZvaWQgKmFyZykKIAkJaWd0
X3NwaW5uZXJfZW5kKCZzcGluKTsKIG91dF9oZWFydGJlYXQ6CiAJCXhjaGcoJmVuZ2luZS0+cHJv
cHMudGltZXNsaWNlX2R1cmF0aW9uX21zLCB0aW1lc2xpY2UpOwotCQllbmdpbmVfaGVhcnRiZWF0
X2VuYWJsZShlbmdpbmUpOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOwog
CQlpZiAoZXJyKQogCQkJYnJlYWs7CiAKQEAgLTI0MzMsNyArMjQxOCw3IEBAIHN0YXRpYyBpbnQg
bGl2ZV9zdXBwcmVzc19zZWxmX3ByZWVtcHQodm9pZCAqYXJnKQogCQlpZiAoaWd0X2ZsdXNoX3Rl
c3QoZ3QtPmk5MTUpKQogCQkJZ290byBlcnJfd2VkZ2VkOwogCi0JCWVuZ2luZV9oZWFydGJlYXRf
ZGlzYWJsZShlbmdpbmUpOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoZW5naW5lKTsK
IAkJZW5naW5lLT5leGVjbGlzdHMucHJlZW1wdF9oYW5nLmNvdW50ID0gMDsKIAogCQlycV9hID0g
c3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmYS5zcGluLApAQCAtMjQ0MSwxNCArMjQyNiwxNCBAQCBz
dGF0aWMgaW50IGxpdmVfc3VwcHJlc3Nfc2VsZl9wcmVlbXB0KHZvaWQgKmFyZykKIAkJCQkJICAg
ICAgTUlfTk9PUCk7CiAJCWlmIChJU19FUlIocnFfYSkpIHsKIAkJCWVyciA9IFBUUl9FUlIocnFf
YSk7Ci0JCQllbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOworCQkJc3RfZW5naW5lX2hl
YXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKIAkJCWdvdG8gZXJyX2NsaWVudF9iOwogCQl9CiAKIAkJ
aTkxNV9yZXF1ZXN0X2FkZChycV9hKTsKIAkJaWYgKCFpZ3Rfd2FpdF9mb3Jfc3Bpbm5lcigmYS5z
cGluLCBycV9hKSkgewogCQkJcHJfZXJyKCJGaXJzdCBjbGllbnQgZmFpbGVkIHRvIHN0YXJ0XG4i
KTsKLQkJCWVuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CisJCQlzdF9lbmdpbmVfaGVh
cnRiZWF0X2VuYWJsZShlbmdpbmUpOwogCQkJZ290byBlcnJfd2VkZ2VkOwogCQl9CiAKQEAgLTI0
NjAsNyArMjQ0NSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9zdXBwcmVzc19zZWxmX3ByZWVtcHQodm9p
ZCAqYXJnKQogCQkJCQkJICAgICAgTUlfTk9PUCk7CiAJCQlpZiAoSVNfRVJSKHJxX2IpKSB7CiAJ
CQkJZXJyID0gUFRSX0VSUihycV9iKTsKLQkJCQllbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdp
bmUpOworCQkJCXN0X2VuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CiAJCQkJZ290byBl
cnJfY2xpZW50X2I7CiAJCQl9CiAJCQlpOTE1X3JlcXVlc3RfYWRkKHJxX2IpOwpAQCAtMjQ3MSw3
ICsyNDU2LDcgQEAgc3RhdGljIGludCBsaXZlX3N1cHByZXNzX3NlbGZfcHJlZW1wdCh2b2lkICph
cmcpCiAKIAkJCWlmICghaWd0X3dhaXRfZm9yX3NwaW5uZXIoJmIuc3BpbiwgcnFfYikpIHsKIAkJ
CQlwcl9lcnIoIlNlY29uZCBjbGllbnQgZmFpbGVkIHRvIHN0YXJ0XG4iKTsKLQkJCQllbmdpbmVf
aGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOworCQkJCXN0X2VuZ2luZV9oZWFydGJlYXRfZW5hYmxl
KGVuZ2luZSk7CiAJCQkJZ290byBlcnJfd2VkZ2VkOwogCQkJfQogCkBAIC0yNDg1LDEyICsyNDcw
LDEyIEBAIHN0YXRpYyBpbnQgbGl2ZV9zdXBwcmVzc19zZWxmX3ByZWVtcHQodm9pZCAqYXJnKQog
CQkJICAgICAgIGVuZ2luZS0+bmFtZSwKIAkJCSAgICAgICBlbmdpbmUtPmV4ZWNsaXN0cy5wcmVl
bXB0X2hhbmcuY291bnQsCiAJCQkgICAgICAgZGVwdGgpOwotCQkJZW5naW5lX2hlYXJ0YmVhdF9l
bmFibGUoZW5naW5lKTsKKwkJCXN0X2VuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CiAJ
CQllcnIgPSAtRUlOVkFMOwogCQkJZ290byBlcnJfY2xpZW50X2I7CiAJCX0KIAotCQllbmdpbmVf
aGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShl
bmdpbmUpOwogCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpKQogCQkJZ290byBlcnJfd2Vk
Z2VkOwogCX0KQEAgLTI5MDIsNyArMjg4Nyw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9wcmVlbXB0X3Jp
bmcodm9pZCAqYXJnKQogCQlpZiAoIWludGVsX2VuZ2luZV9jYW5fc3RvcmVfZHdvcmQoZW5naW5l
KSkKIAkJCWNvbnRpbnVlOwogCi0JCWVuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUpOwor
CQlzdF9lbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoZW5naW5lKTsKIAogCQlmb3IgKG4gPSAwOyBu
IDw9IDM7IG4rKykgewogCQkJZXJyID0gX19saXZlX3ByZWVtcHRfcmluZyhlbmdpbmUsICZzcGlu
LApAQCAtMjkxMSw3ICsyODk2LDcgQEAgc3RhdGljIGludCBsaXZlX3ByZWVtcHRfcmluZyh2b2lk
ICphcmcpCiAJCQkJYnJlYWs7CiAJCX0KIAotCQllbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdp
bmUpOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOwogCQlpZiAoZXJyKQog
CQkJYnJlYWs7CiAJfQpAQCAtNDU2OCw3ICs0NTUzLDcgQEAgc3RhdGljIGludCByZXNldF92aXJ0
dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCX0KIAogCWZvciAobiA9IDA7IG4gPCBu
c2libGluZzsgbisrKQotCQllbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoc2libGluZ3Nbbl0pOwor
CQlzdF9lbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoc2libGluZ3Nbbl0pOwogCiAJcnEgPSBpZ3Rf
c3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmc3BpbiwgdmUsIE1JX0FSQl9DSEVDSyk7CiAJaWYgKElT
X0VSUihycSkpIHsKQEAgLTQ2MzksNyArNDYyNCw3IEBAIHN0YXRpYyBpbnQgcmVzZXRfdmlydHVh
bF9lbmdpbmUoc3RydWN0IGludGVsX2d0ICpndCwKIAlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKIG91
dF9oZWFydGJlYXQ6CiAJZm9yIChuID0gMDsgbiA8IG5zaWJsaW5nOyBuKyspCi0JCWVuZ2luZV9o
ZWFydGJlYXRfZW5hYmxlKHNpYmxpbmdzW25dKTsKKwkJc3RfZW5naW5lX2hlYXJ0YmVhdF9lbmFi
bGUoc2libGluZ3Nbbl0pOwogCiAJaW50ZWxfY29udGV4dF9wdXQodmUpOwogb3V0X3NwaW46CkBA
IC01MzE0LDcgKzUyOTksNyBAQCBzdGF0aWMgaW50IGxpdmVfbHJjX2dwcih2b2lkICphcmcpCiAJ
CXJldHVybiBQVFJfRVJSKHNjcmF0Y2gpOwogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3Qs
IGlkKSB7Ci0JCWVuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUpOworCQlzdF9lbmdpbmVf
aGVhcnRiZWF0X2Rpc2FibGUoZW5naW5lKTsKIAogCQllcnIgPSBfX2xpdmVfbHJjX2dwcihlbmdp
bmUsIHNjcmF0Y2gsIGZhbHNlKTsKIAkJaWYgKGVycikKQEAgLTUzMjUsNyArNTMxMCw3IEBAIHN0
YXRpYyBpbnQgbGl2ZV9scmNfZ3ByKHZvaWQgKmFyZykKIAkJCWdvdG8gZXJyOwogCiBlcnI6Ci0J
CWVuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CisJCXN0X2VuZ2luZV9oZWFydGJlYXRf
ZW5hYmxlKGVuZ2luZSk7CiAJCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpCiAJCQllcnIg
PSAtRUlPOwogCQlpZiAoZXJyKQpAQCAtNTQ3NCw3ICs1NDU5LDcgQEAgc3RhdGljIGludCBsaXZl
X2xyY190aW1lc3RhbXAodm9pZCAqYXJnKQogCWZvcl9lYWNoX2VuZ2luZShkYXRhLmVuZ2luZSwg
Z3QsIGlkKSB7CiAJCWludCBpLCBlcnIgPSAwOwogCi0JCWVuZ2luZV9oZWFydGJlYXRfZGlzYWJs
ZShkYXRhLmVuZ2luZSk7CisJCXN0X2VuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShkYXRhLmVuZ2lu
ZSk7CiAKIAkJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUoZGF0YS5jZSk7IGkrKykgewogCQkJ
c3RydWN0IGludGVsX2NvbnRleHQgKnRtcDsKQEAgLTU1MDcsNyArNTQ5Miw3IEBAIHN0YXRpYyBp
bnQgbGl2ZV9scmNfdGltZXN0YW1wKHZvaWQgKmFyZykKIAkJfQogCiBlcnI6Ci0JCWVuZ2luZV9o
ZWFydGJlYXRfZW5hYmxlKGRhdGEuZW5naW5lKTsKKwkJc3RfZW5naW5lX2hlYXJ0YmVhdF9lbmFi
bGUoZGF0YS5lbmdpbmUpOwogCQlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShkYXRhLmNlKTsg
aSsrKSB7CiAJCQlpZiAoIWRhdGEuY2VbaV0pCiAJCQkJYnJlYWs7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9ycHMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3NlbGZ0ZXN0X3Jwcy5jCmluZGV4IDUwNDljM2RkMDhhNi4uYmI3NTNmMGMxMmViIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9ycHMuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9ycHMuYwpAQCAtMTIsNiArMTIsNyBAQAogI2lu
Y2x1ZGUgImludGVsX2d0X2Nsb2NrX3V0aWxzLmgiCiAjaW5jbHVkZSAiaW50ZWxfZ3RfcG0uaCIK
ICNpbmNsdWRlICJpbnRlbF9yYzYuaCIKKyNpbmNsdWRlICJzZWxmdGVzdF9lbmdpbmVfaGVhcnRi
ZWF0LmgiCiAjaW5jbHVkZSAic2VsZnRlc3RfcnBzLmgiCiAjaW5jbHVkZSAic2VsZnRlc3RzL2ln
dF9mbHVzaF90ZXN0LmgiCiAjaW5jbHVkZSAic2VsZnRlc3RzL2lndF9zcGlubmVyLmgiCkBAIC0y
MCwyMiArMjEsNiBAQAogLyogVHJ5IHRvIGlzb2xhdGUgdGhlIGltcGFjdCBvZiBjc3RhdGVzIGZy
b20gZGV0ZXJtaW5nIGZyZXF1ZW5jeSByZXNwb25zZSAqLwogI2RlZmluZSBDUFVfTEFURU5DWSAw
IC8qIC0xIHRvIGRpc2FibGUgcG1fcW9zLCAwIHRvIGRpc2FibGUgY3N0YXRlcyAqLwogCi1zdGF0
aWMgdm9pZCBlbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lKQotewotCWVuZ2luZS0+cHJvcHMuaGVhcnRiZWF0X2ludGVydmFsX21zID0gMDsKLQot
CWludGVsX2VuZ2luZV9wbV9nZXQoZW5naW5lKTsKLQlpbnRlbF9lbmdpbmVfcGFya19oZWFydGJl
YXQoZW5naW5lKTsKLX0KLQotc3RhdGljIHZvaWQgZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQotewotCWludGVsX2VuZ2luZV9wbV9wdXQoZW5n
aW5lKTsKLQotCWVuZ2luZS0+cHJvcHMuaGVhcnRiZWF0X2ludGVydmFsX21zID0KLQkJZW5naW5l
LT5kZWZhdWx0cy5oZWFydGJlYXRfaW50ZXJ2YWxfbXM7Ci19Ci0KIHN0YXRpYyB2b2lkIGR1bW15
X3Jwc193b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd3JrKQogewogfQpAQCAtMjQ5LDEzICsyMzQs
MTMgQEAgaW50IGxpdmVfcnBzX2Nsb2NrX2ludGVydmFsKHZvaWQgKmFyZykKIAkJaWYgKCFpbnRl
bF9lbmdpbmVfY2FuX3N0b3JlX2R3b3JkKGVuZ2luZSkpCiAJCQljb250aW51ZTsKIAotCQllbmdp
bmVfaGVhcnRiZWF0X2Rpc2FibGUoZW5naW5lKTsKKwkJc3RfZW5naW5lX2hlYXJ0YmVhdF9kaXNh
YmxlKGVuZ2luZSk7CiAKIAkJcnEgPSBpZ3Rfc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmc3BpbiwK
IAkJCQkJCWVuZ2luZS0+a2VybmVsX2NvbnRleHQsCiAJCQkJCQlNSV9OT09QKTsKIAkJaWYgKElT
X0VSUihycSkpIHsKLQkJCWVuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CisJCQlzdF9l
bmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOwogCQkJZXJyID0gUFRSX0VSUihycSk7CiAJ
CQlicmVhazsKIAkJfQpAQCAtMjY2LDcgKzI1MSw3IEBAIGludCBsaXZlX3Jwc19jbG9ja19pbnRl
cnZhbCh2b2lkICphcmcpCiAJCQlwcl9lcnIoIiVzOiBSUFMgc3Bpbm5lciBkaWQgbm90IHN0YXJ0
XG4iLAogCQkJICAgICAgIGVuZ2luZS0+bmFtZSk7CiAJCQlpZ3Rfc3Bpbm5lcl9lbmQoJnNwaW4p
OwotCQkJZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKKwkJCXN0X2VuZ2luZV9oZWFy
dGJlYXRfZW5hYmxlKGVuZ2luZSk7CiAJCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKGVuZ2luZS0+Z3Qp
OwogCQkJZXJyID0gLUVJTzsKIAkJCWJyZWFrOwpAQCAtMzIyLDcgKzMwNyw3IEBAIGludCBsaXZl
X3Jwc19jbG9ja19pbnRlcnZhbCh2b2lkICphcmcpCiAJCWludGVsX3VuY29yZV9mb3JjZXdha2Vf
cHV0KGd0LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOwogCiAJCWlndF9zcGlubmVyX2VuZCgmc3Bp
bik7Ci0JCWVuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CisJCXN0X2VuZ2luZV9oZWFy
dGJlYXRfZW5hYmxlKGVuZ2luZSk7CiAKIAkJaWYgKGVyciA9PSAwKSB7CiAJCQl1NjQgdGltZSA9
IGludGVsX2d0X3BtX2ludGVydmFsX3RvX25zKGd0LCBjeWNsZXMpOwpAQCAtNDA4LDcgKzM5Myw3
IEBAIGludCBsaXZlX3Jwc19jb250cm9sKHZvaWQgKmFyZykKIAkJaWYgKCFpbnRlbF9lbmdpbmVf
Y2FuX3N0b3JlX2R3b3JkKGVuZ2luZSkpCiAJCQljb250aW51ZTsKIAotCQllbmdpbmVfaGVhcnRi
ZWF0X2Rpc2FibGUoZW5naW5lKTsKKwkJc3RfZW5naW5lX2hlYXJ0YmVhdF9kaXNhYmxlKGVuZ2lu
ZSk7CiAKIAkJcnEgPSBpZ3Rfc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmc3BpbiwKIAkJCQkJCWVu
Z2luZS0+a2VybmVsX2NvbnRleHQsCkBAIC00MjQsNyArNDA5LDcgQEAgaW50IGxpdmVfcnBzX2Nv
bnRyb2wodm9pZCAqYXJnKQogCQkJcHJfZXJyKCIlczogUlBTIHNwaW5uZXIgZGlkIG5vdCBzdGFy
dFxuIiwKIAkJCSAgICAgICBlbmdpbmUtPm5hbWUpOwogCQkJaWd0X3NwaW5uZXJfZW5kKCZzcGlu
KTsKLQkJCWVuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CisJCQlzdF9lbmdpbmVfaGVh
cnRiZWF0X2VuYWJsZShlbmdpbmUpOwogCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChlbmdpbmUtPmd0
KTsKIAkJCWVyciA9IC1FSU87CiAJCQlicmVhazsKQEAgLTQzNCw3ICs0MTksNyBAQCBpbnQgbGl2
ZV9ycHNfY29udHJvbCh2b2lkICphcmcpCiAJCQlwcl9lcnIoIiVzOiBjb3VsZCBub3Qgc2V0IG1p
bmltdW0gZnJlcXVlbmN5IFsleF0sIG9ubHkgJXghXG4iLAogCQkJICAgICAgIGVuZ2luZS0+bmFt
ZSwgcnBzLT5taW5fZnJlcSwgcmVhZF9jYWdmKHJwcykpOwogCQkJaWd0X3NwaW5uZXJfZW5kKCZz
cGluKTsKLQkJCWVuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CisJCQlzdF9lbmdpbmVf
aGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOwogCQkJc2hvd19wc3RhdGVfbGltaXRzKHJwcyk7CiAJ
CQllcnIgPSAtRUlOVkFMOwogCQkJYnJlYWs7CkBAIC00NTEsNyArNDM2LDcgQEAgaW50IGxpdmVf
cnBzX2NvbnRyb2wodm9pZCAqYXJnKQogCQkJcHJfZXJyKCIlczogY291bGQgbm90IHJlc3RvcmUg
bWluaW11bSBmcmVxdWVuY3kgWyV4XSwgb25seSAleCFcbiIsCiAJCQkgICAgICAgZW5naW5lLT5u
YW1lLCBycHMtPm1pbl9mcmVxLCByZWFkX2NhZ2YocnBzKSk7CiAJCQlpZ3Rfc3Bpbm5lcl9lbmQo
JnNwaW4pOwotCQkJZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKKwkJCXN0X2VuZ2lu
ZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CiAJCQlzaG93X3BzdGF0ZV9saW1pdHMocnBzKTsK
IAkJCWVyciA9IC1FSU5WQUw7CiAJCQlicmVhazsKQEAgLTQ2Niw3ICs0NTEsNyBAQCBpbnQgbGl2
ZV9ycHNfY29udHJvbCh2b2lkICphcmcpCiAJCW1pbl9kdCA9IGt0aW1lX3N1YihrdGltZV9nZXQo
KSwgbWluX2R0KTsKIAogCQlpZ3Rfc3Bpbm5lcl9lbmQoJnNwaW4pOwotCQllbmdpbmVfaGVhcnRi
ZWF0X2VuYWJsZShlbmdpbmUpOworCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUp
OwogCiAJCXByX2luZm8oIiVzOiByYW5nZTpbJXg6JXVNSHosICV4OiV1TUh6XSBsaW1pdDpbJXg6
JXVNSHpdLCAleDoleCByZXNwb25zZSAlbGx1bnM6JWxsdW5zXG4iLAogCQkJZW5naW5lLT5uYW1l
LApAQCAtNjM3LDE0ICs2MjIsMTQgQEAgaW50IGxpdmVfcnBzX2ZyZXF1ZW5jeV9jcyh2b2lkICph
cmcpCiAJCQlpbnQgZnJlcTsKIAkJfSBtaW4sIG1heDsKIAotCQllbmdpbmVfaGVhcnRiZWF0X2Rp
c2FibGUoZW5naW5lKTsKKwkJc3RfZW5naW5lX2hlYXJ0YmVhdF9kaXNhYmxlKGVuZ2luZSk7CiAK
IAkJdm1hID0gY3JlYXRlX3NwaW5fY291bnRlcihlbmdpbmUsCiAJCQkJCSAgZW5naW5lLT5rZXJu
ZWxfY29udGV4dC0+dm0sIGZhbHNlLAogCQkJCQkgICZjYW5jZWwsICZjbnRyKTsKIAkJaWYgKElT
X0VSUih2bWEpKSB7CiAJCQllcnIgPSBQVFJfRVJSKHZtYSk7Ci0JCQllbmdpbmVfaGVhcnRiZWF0
X2VuYWJsZShlbmdpbmUpOworCQkJc3RfZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsK
IAkJCWJyZWFrOwogCQl9CiAKQEAgLTcyNSw3ICs3MTAsNyBAQCBpbnQgbGl2ZV9ycHNfZnJlcXVl
bmN5X2NzKHZvaWQgKmFyZykKIAkJaTkxNV92bWFfdW5waW4odm1hKTsKIAkJaTkxNV92bWFfcHV0
KHZtYSk7CiAKLQkJZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKKwkJc3RfZW5naW5l
X2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKIAkJaWYgKGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1
KSkKIAkJCWVyciA9IC1FSU87CiAJCWlmIChlcnIpCkBAIC03NzksMTQgKzc2NCwxNCBAQCBpbnQg
bGl2ZV9ycHNfZnJlcXVlbmN5X3NybSh2b2lkICphcmcpCiAJCQlpbnQgZnJlcTsKIAkJfSBtaW4s
IG1heDsKIAotCQllbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoZW5naW5lKTsKKwkJc3RfZW5naW5l
X2hlYXJ0YmVhdF9kaXNhYmxlKGVuZ2luZSk7CiAKIAkJdm1hID0gY3JlYXRlX3NwaW5fY291bnRl
cihlbmdpbmUsCiAJCQkJCSAgZW5naW5lLT5rZXJuZWxfY29udGV4dC0+dm0sIHRydWUsCiAJCQkJ
CSAgJmNhbmNlbCwgJmNudHIpOwogCQlpZiAoSVNfRVJSKHZtYSkpIHsKIAkJCWVyciA9IFBUUl9F
UlIodm1hKTsKLQkJCWVuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CisJCQlzdF9lbmdp
bmVfaGVhcnRiZWF0X2VuYWJsZShlbmdpbmUpOwogCQkJYnJlYWs7CiAJCX0KIApAQCAtODY2LDcg
Kzg1MSw3IEBAIGludCBsaXZlX3Jwc19mcmVxdWVuY3lfc3JtKHZvaWQgKmFyZykKIAkJaTkxNV92
bWFfdW5waW4odm1hKTsKIAkJaTkxNV92bWFfcHV0KHZtYSk7CiAKLQkJZW5naW5lX2hlYXJ0YmVh
dF9lbmFibGUoZW5naW5lKTsKKwkJc3RfZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsK
IAkJaWYgKGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KSkKIAkJCWVyciA9IC1FSU87CiAJCWlmIChl
cnIpCkBAIC0xMDYxLDExICsxMDQ2LDExIEBAIGludCBsaXZlX3Jwc19pbnRlcnJ1cHQodm9pZCAq
YXJnKQogCQkJaW50ZWxfZ3RfcG1fd2FpdF9mb3JfaWRsZShlbmdpbmUtPmd0KTsKIAkJCUdFTV9C
VUdfT04oaW50ZWxfcnBzX2lzX2FjdGl2ZShycHMpKTsKIAotCQkJZW5naW5lX2hlYXJ0YmVhdF9k
aXNhYmxlKGVuZ2luZSk7CisJCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoZW5naW5lKTsK
IAogCQkJZXJyID0gX19ycHNfdXBfaW50ZXJydXB0KHJwcywgZW5naW5lLCAmc3Bpbik7CiAKLQkJ
CWVuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CisJCQlzdF9lbmdpbmVfaGVhcnRiZWF0
X2VuYWJsZShlbmdpbmUpOwogCQkJaWYgKGVycikKIAkJCQlnb3RvIG91dDsKIApAQCAtMTA3NCwx
MyArMTA1OSwxMyBAQCBpbnQgbGl2ZV9ycHNfaW50ZXJydXB0KHZvaWQgKmFyZykKIAogCQkvKiBL
ZWVwIHRoZSBlbmdpbmUgYXdha2UgYnV0IGlkbGUgYW5kIGNoZWNrIGZvciBET1dOICovCiAJCWlm
IChwbV9ldmVudHMgJiBHRU42X1BNX1JQX0RPV05fVEhSRVNIT0xEKSB7Ci0JCQllbmdpbmVfaGVh
cnRiZWF0X2Rpc2FibGUoZW5naW5lKTsKKwkJCXN0X2VuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShl
bmdpbmUpOwogCQkJaW50ZWxfcmM2X2Rpc2FibGUoJmd0LT5yYzYpOwogCiAJCQllcnIgPSBfX3Jw
c19kb3duX2ludGVycnVwdChycHMsIGVuZ2luZSk7CiAKIAkJCWludGVsX3JjNl9lbmFibGUoJmd0
LT5yYzYpOwotCQkJZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKKwkJCXN0X2VuZ2lu
ZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CiAJCQlpZiAoZXJyKQogCQkJCWdvdG8gb3V0Owog
CQl9CkBAIC0xMTY1LDEzICsxMTUwLDEzIEBAIGludCBsaXZlX3Jwc19wb3dlcih2b2lkICphcmcp
CiAJCWlmICghaW50ZWxfZW5naW5lX2Nhbl9zdG9yZV9kd29yZChlbmdpbmUpKQogCQkJY29udGlu
dWU7CiAKLQkJZW5naW5lX2hlYXJ0YmVhdF9kaXNhYmxlKGVuZ2luZSk7CisJCXN0X2VuZ2luZV9o
ZWFydGJlYXRfZGlzYWJsZShlbmdpbmUpOwogCiAJCXJxID0gaWd0X3NwaW5uZXJfY3JlYXRlX3Jl
cXVlc3QoJnNwaW4sCiAJCQkJCQllbmdpbmUtPmtlcm5lbF9jb250ZXh0LAogCQkJCQkJTUlfTk9P
UCk7CiAJCWlmIChJU19FUlIocnEpKSB7Ci0JCQllbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShlbmdp
bmUpOworCQkJc3RfZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKIAkJCWVyciA9IFBU
Ul9FUlIocnEpOwogCQkJYnJlYWs7CiAJCX0KQEAgLTExODIsNyArMTE2Nyw3IEBAIGludCBsaXZl
X3Jwc19wb3dlcih2b2lkICphcmcpCiAJCQlwcl9lcnIoIiVzOiBSUFMgc3Bpbm5lciBkaWQgbm90
IHN0YXJ0XG4iLAogCQkJICAgICAgIGVuZ2luZS0+bmFtZSk7CiAJCQlpZ3Rfc3Bpbm5lcl9lbmQo
JnNwaW4pOwotCQkJZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKKwkJCXN0X2VuZ2lu
ZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CiAJCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKGVuZ2lu
ZS0+Z3QpOwogCQkJZXJyID0gLUVJTzsKIAkJCWJyZWFrOwpAQCAtMTE5NSw3ICsxMTgwLDcgQEAg
aW50IGxpdmVfcnBzX3Bvd2VyKHZvaWQgKmFyZykKIAkJbWluLnBvd2VyID0gbWVhc3VyZV9wb3dl
cl9hdChycHMsICZtaW4uZnJlcSk7CiAKIAkJaWd0X3NwaW5uZXJfZW5kKCZzcGluKTsKLQkJZW5n
aW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKKwkJc3RfZW5naW5lX2hlYXJ0YmVhdF9lbmFi
bGUoZW5naW5lKTsKIAogCQlwcl9pbmZvKCIlczogbWluOiVsbHVtVyBAICV1TUh6LCBtYXg6JWxs
dW1XIEAgJXVNSHpcbiIsCiAJCQllbmdpbmUtPm5hbWUsCkBAIC0xMjUyLDYgKzEyMzcsMTEgQEAg
aW50IGxpdmVfcnBzX2R5bmFtaWModm9pZCAqYXJnKQogCWlmIChpZ3Rfc3Bpbm5lcl9pbml0KCZz
cGluLCBndCkpCiAJCXJldHVybiAtRU5PTUVNOwogCisJaWYgKGludGVsX3Jwc19oYXNfaW50ZXJy
dXB0cyhycHMpKQorCQlwcl9pbmZvKCJSUFMgaGFzIGludGVycnVwdCBzdXBwb3J0XG4iKTsKKwlp
ZiAoaW50ZWxfcnBzX3VzZXNfdGltZXIocnBzKSkKKwkJcHJfaW5mbygiUlBTIGhhcyB0aW1lciBz
dXBwb3J0XG4iKTsKKwogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgewogCQlzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAkJc3RydWN0IHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3RpbWVsaW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9zZWxmdGVzdF90aW1lbGluZS5jCmluZGV4IGIyYWFkN2VmMDQ2YS4uZmNkZWU5NTE1NzliIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF90aW1lbGluZS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3RpbWVsaW5lLmMKQEAgLTEyLDYg
KzEyLDcgQEAKICNpbmNsdWRlICJpbnRlbF9ndC5oIgogI2luY2x1ZGUgImludGVsX2d0X3JlcXVl
c3RzLmgiCiAjaW5jbHVkZSAiaW50ZWxfcmluZy5oIgorI2luY2x1ZGUgInNlbGZ0ZXN0X2VuZ2lu
ZV9oZWFydGJlYXQuaCIKIAogI2luY2x1ZGUgIi4uL3NlbGZ0ZXN0cy9pOTE1X3JhbmRvbS5oIgog
I2luY2x1ZGUgIi4uL2k5MTVfc2VsZnRlc3QuaCIKQEAgLTc1MSwyMiArNzUyLDYgQEAgc3RhdGlj
IGludCBsaXZlX2h3c3Bfd3JhcCh2b2lkICphcmcpCiAJcmV0dXJuIGVycjsKIH0KIAotc3RhdGlj
IHZvaWQgZW5naW5lX2hlYXJ0YmVhdF9kaXNhYmxlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSkKLXsKLQllbmdpbmUtPnByb3BzLmhlYXJ0YmVhdF9pbnRlcnZhbF9tcyA9IDA7Ci0KLQlp
bnRlbF9lbmdpbmVfcG1fZ2V0KGVuZ2luZSk7Ci0JaW50ZWxfZW5naW5lX3BhcmtfaGVhcnRiZWF0
KGVuZ2luZSk7Ci19Ci0KLXN0YXRpYyB2b2lkIGVuZ2luZV9oZWFydGJlYXRfZW5hYmxlKHN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKLXsKLQlpbnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2lu
ZSk7Ci0KLQllbmdpbmUtPnByb3BzLmhlYXJ0YmVhdF9pbnRlcnZhbF9tcyA9Ci0JCWVuZ2luZS0+
ZGVmYXVsdHMuaGVhcnRiZWF0X2ludGVydmFsX21zOwotfQotCiBzdGF0aWMgaW50IGxpdmVfaHdz
cF9yb2xsb3Zlcl9rZXJuZWwodm9pZCAqYXJnKQogewogCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBh
cmc7CkBAIC03ODUsNyArNzcwLDcgQEAgc3RhdGljIGludCBsaXZlX2h3c3Bfcm9sbG92ZXJfa2Vy
bmVsKHZvaWQgKmFyZykKIAkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnFbM10gPSB7fTsKIAkJaW50
IGk7CiAKLQkJZW5naW5lX2hlYXJ0YmVhdF9kaXNhYmxlKGVuZ2luZSk7CisJCXN0X2VuZ2luZV9o
ZWFydGJlYXRfZGlzYWJsZShlbmdpbmUpOwogCQlpZiAoaW50ZWxfZ3Rfd2FpdF9mb3JfaWRsZShn
dCwgSFogLyAyKSkgewogCQkJZXJyID0gLUVJTzsKIAkJCWdvdG8gb3V0OwpAQCAtODM2LDcgKzgy
MSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX3JvbGxvdmVyX2tlcm5lbCh2b2lkICphcmcpCiBv
dXQ6CiAJCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKHJxKTsgaSsrKQogCQkJaTkxNV9yZXF1
ZXN0X3B1dChycVtpXSk7Ci0JCWVuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CisJCXN0
X2VuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSk7CiAJCWlmIChlcnIpCiAJCQlicmVhazsK
IAl9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1
ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMKaW5k
ZXggOTJjNjI4ZjE4YzYwLi4wNmQxOGFhZTA3MGIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMKQEAgLTM0LDYgKzM0LDcgQEAKICNpbmNsdWRlICJn
dC9pbnRlbF9lbmdpbmVfdXNlci5oIgogI2luY2x1ZGUgImd0L2ludGVsX2d0LmgiCiAjaW5jbHVk
ZSAiZ3QvaW50ZWxfZ3RfcmVxdWVzdHMuaCIKKyNpbmNsdWRlICJndC9zZWxmdGVzdF9lbmdpbmVf
aGVhcnRiZWF0LmgiCiAKICNpbmNsdWRlICJpOTE1X3JhbmRvbS5oIgogI2luY2x1ZGUgImk5MTVf
c2VsZnRlc3QuaCIKQEAgLTIyNzAsMjIgKzIyNzEsNiBAQCBzdGF0aWMgdm9pZCBycHNfdW5waW4o
c3RydWN0IGludGVsX2d0ICpndCkKIAlhdG9taWNfZGVjKCZndC0+cnBzLm51bV93YWl0ZXJzKTsK
IH0KIAotc3RhdGljIHZvaWQgZW5naW5lX2hlYXJ0YmVhdF9kaXNhYmxlKHN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZSkKLXsKLQllbmdpbmUtPnByb3BzLmhlYXJ0YmVhdF9pbnRlcnZhbF9t
cyA9IDA7Ci0KLQlpbnRlbF9lbmdpbmVfcG1fZ2V0KGVuZ2luZSk7Ci0JaW50ZWxfZW5naW5lX3Bh
cmtfaGVhcnRiZWF0KGVuZ2luZSk7Ci19Ci0KLXN0YXRpYyB2b2lkIGVuZ2luZV9oZWFydGJlYXRf
ZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKLXsKLQlpbnRlbF9lbmdpbmVf
cG1fcHV0KGVuZ2luZSk7Ci0KLQllbmdpbmUtPnByb3BzLmhlYXJ0YmVhdF9pbnRlcnZhbF9tcyA9
Ci0JCWVuZ2luZS0+ZGVmYXVsdHMuaGVhcnRiZWF0X2ludGVydmFsX21zOwotfQotCiBzdGF0aWMg
aW50IHBlcmZfcmVxdWVzdF9sYXRlbmN5KHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IGFyZzsKQEAgLTIzMTEsNyArMjI5Niw3IEBAIHN0YXRpYyBpbnQgcGVy
Zl9yZXF1ZXN0X2xhdGVuY3kodm9pZCAqYXJnKQogCQkJZ290byBvdXQ7CiAJCX0KIAotCQllbmdp
bmVfaGVhcnRiZWF0X2Rpc2FibGUoZW5naW5lKTsKKwkJc3RfZW5naW5lX2hlYXJ0YmVhdF9kaXNh
YmxlKGVuZ2luZSk7CiAJCXJwc19waW4oZW5naW5lLT5ndCk7CiAKIAkJaWYgKGVyciA9PSAwKQpA
QCAtMjMzMCw3ICsyMzE1LDcgQEAgc3RhdGljIGludCBwZXJmX3JlcXVlc3RfbGF0ZW5jeSh2b2lk
ICphcmcpCiAJCQllcnIgPSBtZWFzdXJlX2NvbXBsZXRpb24oY2UpOwogCiAJCXJwc191bnBpbihl
bmdpbmUtPmd0KTsKLQkJZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKKwkJc3RfZW5n
aW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lKTsKIAogCQlpbnRlbF9jb250ZXh0X3VucGluKGNl
KTsKIAkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0Cklu
dGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZngK

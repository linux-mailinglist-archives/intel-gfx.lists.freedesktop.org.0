Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 55E3AA050D
	for <lists+intel-gfx@lfdr.de>; Wed, 28 Aug 2019 16:34:01 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6D90C89CF2;
	Wed, 28 Aug 2019 14:33:55 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga01.intel.com (mga01.intel.com [192.55.52.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6D2C589CBA
 for <intel-gfx@lists.freedesktop.org>; Wed, 28 Aug 2019 14:33:48 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga005.fm.intel.com ([10.253.24.32])
 by fmsmga101.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 28 Aug 2019 07:33:44 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,441,1559545200"; d="scan'208";a="380419448"
Received: from cmartin2-mobl3.ger.corp.intel.com (HELO
 delly.ger.corp.intel.com) ([10.252.38.61])
 by fmsmga005.fm.intel.com with ESMTP; 28 Aug 2019 07:33:43 -0700
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 28 Aug 2019 17:33:26 +0300
Message-Id: <20190828143327.7965-10-lionel.g.landwerlin@intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190828143327.7965-1-lionel.g.landwerlin@intel.com>
References: <20190828143327.7965-1-lionel.g.landwerlin@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v11 09/10] drm/i915/perf: execute OA
 configuration from command stream
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgaGF2ZW4ndCBydW4gaW50byBpc3N1ZXMgd2l0aCBwcm9ncmFtbWluZyB0aGUgZ2xvYmFsIE9B
L05PQQpyZWdpc3RlcnMgY29uZmlndXJhdGlvbiBmcm9tIENQVSBzbyBmYXIsIGJ1dCBIVyBlbmdp
bmVlcnMgYWN0dWFsbHkKcmVjb21tZW5kIGRvaW5nIHRoaXMgZnJvbSB0aGUgY29tbWFuZCBzdHJl
YW1lci4gT24gVEdMIGluIHBhcnRpY3VsYXIKb25lIG9mIHRoZSBjbG9jayBkb21haW4gaW4gd2hp
Y2ggc29tZSBvZiB0aGF0IHByb2dyYW1taW5nIGdvZXMgbWlnaHQKbm90IGJlIHBvd2VyZWQgd2hl
biB3ZSBwb2tlIHRoaW5ncyBmcm9tIHRoZSBDUFUuCgpTaW5jZSB3ZSBoYXZlIGEgY29tbWFuZCBi
dWZmZXIgcHJlcGFyZWQgZm9yIHRoZSBleGVjYnVmZmVyIHNpZGUgb2YKdGhpbmdzLCB3ZSBjYW4g
cmV1c2UgdGhhdCBhcHByb2FjaCBoZXJlIHRvby4KClRoaXMgYWxzbyBhbGxvd3MgdXMgdG8gc2ln
bmlmaWNhbnRseSByZWR1Y2UgdGhlIGFtb3VudCBvZiB0aW1lIHdlIGhvbGQKdGhlIG1haW4gbG9j
ay4KCnYyOiBEcm9wIHRoZSBnbG9iYWwgbG9jayBhcyBtdWNoIGFzIHBvc3NpYmxlCgp2MzogVGFr
ZSBnbG9iYWwgbG9jayB0byBwaW4gZ2xvYmFsCgp2NDogQ3JlYXRlIGk5MTUgcmVxdWVzdCBpbiBl
bWl0X29hX2NvbmZpZygpIHRvIGF2b2lkIGRlYWRsb2NrcyAoTGlvbmVsKQoKU2lnbmVkLW9mZi1i
eTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwuY29tPgotLS0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggIHwgIDEyICsrKwogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9wZXJmLmMgfCAxNDYgKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0t
LQogMiBmaWxlcyBjaGFuZ2VkLCAxMDQgaW5zZXJ0aW9ucygrKSwgNTQgZGVsZXRpb25zKC0pCgpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZHJ2LmgKaW5kZXggZWM2MDljMDIyZTVlLi5mOTRkZTAwMTIwMWQgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9kcnYuaApAQCAtMTA5NCw2ICsxMDk0LDE4IEBAIHN0cnVjdCBpOTE1
X3BlcmZfc3RyZWFtIHsKIAkgKi8KIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAorCS8qKgor
CSAqIEBpbml0aWFsX2NvbmZpZ19ycTogRmlyc3QgcmVxdWVzdCBydW4gYXQgdGhlIG9wZW5pbmcg
b2YgdGhlIGk5MTUKKwkgKiBwZXJmIHN0cmVhbSB0byBjb25maWd1cmUgdGhlIEhXLiBTaG91bGQg
YmUgTlVMTCBhZnRlciB0aGUgcGVyZgorCSAqIHN0cmVhbSBoYXMgYmVlbiBvcGVuZWQgc3VjY2Vz
c2Z1bGx5LgorCSAqLworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKmluaXRpYWxfY29uZmlnX3JxOwor
CisJLyoqCisJICogQGluaXRpYWxfb2FfY29uZmlnX2JvOiBGaXJzdCBPQSBjb25maWd1cmF0aW9u
IEJPIHRvIGJlIHJ1bi4KKwkgKi8KKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqaW5pdGlh
bF9vYV9jb25maWdfYm87CisKIAkvKioKIAkgKiBAc2FtcGxlX2ZsYWdzOiBGbGFncyByZXByZXNl
bnRpbmcgdGhlIGBEUk1fSTkxNV9QRVJGX1BST1BfU0FNUExFXypgCiAJICogcHJvcGVydGllcyBn
aXZlbiB3aGVuIG9wZW5pbmcgYSBzdHJlYW0sIHJlcHJlc2VudGluZyB0aGUgY29udGVudHMKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9wZXJmLmMKaW5kZXggMWVlYWJmMGJiYWZjLi4yOWViYThjM2M3OTIgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCkBAIC0xNzgzLDYgKzE3ODMsMTAgQEAgc3RhdGljIGlu
dCBhbGxvY19ub2Ffd2FpdChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogCQlyZXR1
cm4gUFRSX0VSUihibyk7CiAJfQogCisJcmV0ID0gaTkxNV9tdXRleF9sb2NrX2ludGVycnVwdGli
bGUoJmk5MTUtPmRybSk7CisJaWYgKHJldCkKKwkJZ290byBlcnJfdW5yZWY7CisKIAkvKgogCSAq
IFdlIHBpbiBpbiBHR1RUIGJlY2F1c2Ugd2UganVtcCBpbnRvIHRoaXMgYnVmZmVyIG5vdyBiZWNh
dXNlCiAJICogbXVsdGlwbGUgT0EgY29uZmlnIEJPcyB3aWxsIGhhdmUgYSBqdW1wIHRvIHRoaXMg
YWRkcmVzcyBhbmQgaXQKQEAgLTE3OTAsMTAgKzE3OTQsMTMgQEAgc3RhdGljIGludCBhbGxvY19u
b2Ffd2FpdChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogCSAqLwogCXZtYSA9IGk5
MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihibywgTlVMTCwgMCwgNDA5NiwgMCk7CiAJaWYgKElTX0VS
Uih2bWEpKSB7CisJCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCXJl
dCA9IFBUUl9FUlIodm1hKTsKIAkJZ290byBlcnJfdW5yZWY7CiAJfQogCisJbXV0ZXhfdW5sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwogCWJhdGNoID0gY3MgPSBpOTE1X2dlbV9vYmpl
Y3RfcGluX21hcChibywgSTkxNV9NQVBfV0IpOwogCWlmIChJU19FUlIoYmF0Y2gpKSB7CiAJCXJl
dCA9IFBUUl9FUlIoYmF0Y2gpOwpAQCAtMTkyNyw3ICsxOTM0LDkgQEAgc3RhdGljIGludCBhbGxv
Y19ub2Ffd2FpdChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogCXJldHVybiAwOwog
CiBlcnJfdW5waW46Ci0JX19pOTE1X3ZtYV91bnBpbih2bWEpOworCW11dGV4X2xvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOworCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZ2bWEsIDAp
OworCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIGVycl91bnJlZjoK
IAlpOTE1X2dlbV9vYmplY3RfcHV0KGJvKTsKQEAgLTE5MzUsNTAgKzE5NDQsNzEgQEAgc3RhdGlj
IGludCBhbGxvY19ub2Ffd2FpdChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogCXJl
dHVybiByZXQ7CiB9CiAKLXN0YXRpYyB2b2lkIGNvbmZpZ19vYV9yZWdzKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCSAgIGNvbnN0IHN0cnVjdCBpOTE1X29hX3JlZyAqcmVn
cywKLQkJCSAgIHUzMiBuX3JlZ3MpCitzdGF0aWMgaW50IGVtaXRfb2FfY29uZmlnKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAorCQkJICBzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3Ry
ZWFtKQogewotCXUzMiBpOworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCXN0cnVjdCBpOTE1
X3ZtYSAqdm1hOworCXUzMiAqY3M7CisJaW50IGVycjsKIAotCWZvciAoaSA9IDA7IGkgPCBuX3Jl
Z3M7IGkrKykgewotCQljb25zdCBzdHJ1Y3QgaTkxNV9vYV9yZWcgKnJlZyA9IHJlZ3MgKyBpOwor
CWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCi0JCUk5MTVf
V1JJVEUocmVnLT5hZGRyLCByZWctPnZhbHVlKTsKKwlycSA9IGk5MTVfcmVxdWVzdF9jcmVhdGUo
aTkxNS0+ZW5naW5lW1JDUzBdLT5rZXJuZWxfY29udGV4dCk7CisJaWYgKElTX0VSUihycSkpCisJ
CXJldHVybiBQVFJfRVJSKHJxKTsKKworCWVyciA9IGk5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KCZp
OTE1LT5lbmdpbmVbUkNTMF0tPmxhc3Rfb2FfY29uZmlnLAorCQkJCSAgICAgIHJxKTsKKwlpZiAo
ZXJyKQorCQlnb3RvIGVycl9hZGRfcmVxdWVzdDsKKworCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNl
KHN0cmVhbS0+aW5pdGlhbF9vYV9jb25maWdfYm8sCisJCQkJJmk5MTUtPmdndHQudm0sIE5VTEwp
OworCWlmICh1bmxpa2VseShJU19FUlIodm1hKSkpIHsKKwkJZXJyID0gUFRSX0VSUih2bWEpOwor
CQlnb3RvIGVycl9hZGRfcmVxdWVzdDsKIAl9Ci19CiAKLXN0YXRpYyB2b2lkIGRlbGF5X2FmdGVy
X211eCh2b2lkKQotewotCS8qCi0JICogSXQgYXBwYXJlbnRseSB0YWtlcyBhIGZhaXJseSBsb25n
IHRpbWUgZm9yIGEgbmV3IE1VWAotCSAqIGNvbmZpZ3VyYXRpb24gdG8gYmUgYmUgYXBwbGllZCBh
ZnRlciB0aGVzZSByZWdpc3RlciB3cml0ZXMuCi0JICogVGhpcyBkZWxheSBkdXJhdGlvbiB3YXMg
ZGVyaXZlZCBlbXBpcmljYWxseSBiYXNlZCBvbiB0aGUKLQkgKiByZW5kZXJfYmFzaWMgY29uZmln
IGJ1dCBob3BlZnVsbHkgaXQgY292ZXJzIHRoZSBtYXhpbXVtCi0JICogY29uZmlndXJhdGlvbiBs
YXRlbmN5LgotCSAqCi0JICogQXMgYSBmYWxsYmFjaywgdGhlIGNoZWNrcyBpbiBfYXBwZW5kX29h
X3JlcG9ydHMoKSB0byBza2lwCi0JICogaW52YWxpZCBPQSByZXBvcnRzIGRvIGFsc28gc2VlbSB0
byB3b3JrIHRvIGRpc2NhcmQgcmVwb3J0cwotCSAqIGdlbmVyYXRlZCBiZWZvcmUgdGhpcyBjb25m
aWcgaGFzIGNvbXBsZXRlZCAtIGFsYmVpdCBub3QKLQkgKiBzaWxlbnRseS4KLQkgKgotCSAqIFVu
Zm9ydHVuYXRlbHkgdGhpcyBpcyBlc3NlbnRpYWxseSBhIG1hZ2ljIG51bWJlciwgc2luY2Ugd2UK
LQkgKiBkb24ndCBjdXJyZW50bHkga25vdyBvZiBhIHJlbGlhYmxlIG1lY2hhbmlzbSBmb3IgcHJl
ZGljdGluZwotCSAqIGhvdyBsb25nIHRoZSBNVVggY29uZmlnIHdpbGwgdGFrZSB0byBhcHBseSBh
bmQgYmVzaWRlcwotCSAqIHNlZWluZyBpbnZhbGlkIHJlcG9ydHMgd2UgZG9uJ3Qga25vdyBvZiBh
IHJlbGlhYmxlIHdheSB0bwotCSAqIGV4cGxpY2l0bHkgY2hlY2sgdGhhdCB0aGUgTVVYIGNvbmZp
ZyBoYXMgbGFuZGVkLgotCSAqCi0JICogSXQncyBldmVuIHBvc3NpYmxlIHdlJ3ZlIG1pc3MgY2hh
cmFjdGVyaXplZCB0aGUgdW5kZXJseWluZwotCSAqIHByb2JsZW0gLSBpdCBqdXN0IHNlZW1zIGxp
a2UgdGhlIHNpbXBsZXN0IGV4cGxhbmF0aW9uIHdoeQotCSAqIGEgZGVsYXkgYXQgdGhpcyBsb2Nh
dGlvbiB3b3VsZCBtaXRpZ2F0ZSBhbnkgaW52YWxpZCByZXBvcnRzLgotCSAqLwotCXVzbGVlcF9y
YW5nZSgxNTAwMCwgMjAwMDApOworCWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIFBJTl9H
TE9CQUwpOworCWlmIChlcnIpCisJCWdvdG8gZXJyX2FkZF9yZXF1ZXN0OworCisJZXJyID0gaTkx
NV92bWFfbW92ZV90b19hY3RpdmUodm1hLCBycSwgMCk7CisJaWYgKGVycikKKwkJZ290byBlcnJf
dm1hX3VucGluOworCisJY3MgPSBpbnRlbF9yaW5nX2JlZ2luKHJxLCBJTlRFTF9HRU4oaTkxNSkg
Pj0gOCA/IDQgOiAyKTsKKwlpZiAoSVNfRVJSKGNzKSkgeworCQllcnIgPSBQVFJfRVJSKGNzKTsK
KwkJZ290byBlcnJfdm1hX3VucGluOworCX0KKworCWlmIChJTlRFTF9HRU4oaTkxNSkgPiA4KSB7
CisJCSpjcysrID0gTUlfQkFUQ0hfQlVGRkVSX1NUQVJUX0dFTjg7CisJCSpjcysrID0gbG93ZXJf
MzJfYml0cyh2bWEtPm5vZGUuc3RhcnQpOworCQkqY3MrKyA9IHVwcGVyXzMyX2JpdHModm1hLT5u
b2RlLnN0YXJ0KTsKKwkJKmNzKysgPSBNSV9OT09QOworCX0gZWxzZSB7CisJCSpjcysrID0gTUlf
QkFUQ0hfQlVGRkVSX1NUQVJUOworCQkqY3MrKyA9IHZtYS0+bm9kZS5zdGFydDsKKwl9CisKKwlp
bnRlbF9yaW5nX2FkdmFuY2UocnEsIGNzKTsKKworCXN0cmVhbS0+aW5pdGlhbF9jb25maWdfcnEg
PSBpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKKworZXJyX3ZtYV91bnBpbjoKKwlpOTE1X3ZtYV91bnBp
bih2bWEpOworZXJyX2FkZF9yZXF1ZXN0OgorCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCisJcmV0
dXJuIGVycjsKIH0KIAogc3RhdGljIGludCBoc3dfZW5hYmxlX21ldHJpY19zZXQoc3RydWN0IGk5
MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSBzdHJlYW0tPmRldl9wcml2OwotCWNvbnN0IHN0cnVjdCBpOTE1X29hX2NvbmZpZyAq
b2FfY29uZmlnID0gc3RyZWFtLT5vYV9jb25maWc7CiAKIAkvKgogCSAqIFBSTToKQEAgLTE5OTUs
MTMgKzIwMjUsNyBAQCBzdGF0aWMgaW50IGhzd19lbmFibGVfbWV0cmljX3NldChzdHJ1Y3QgaTkx
NV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogCUk5MTVfV1JJVEUoR0VONl9VQ0dDVEwxLCAoSTkxNV9S
RUFEKEdFTjZfVUNHQ1RMMSkgfAogCQkJCSAgR0VONl9DU1VOSVRfQ0xPQ0tfR0FURV9ESVNBQkxF
KSk7CiAKLQljb25maWdfb2FfcmVncyhkZXZfcHJpdiwgb2FfY29uZmlnLT5tdXhfcmVncywgb2Ff
Y29uZmlnLT5tdXhfcmVnc19sZW4pOwotCWRlbGF5X2FmdGVyX211eCgpOwotCi0JY29uZmlnX29h
X3JlZ3MoZGV2X3ByaXYsIG9hX2NvbmZpZy0+Yl9jb3VudGVyX3JlZ3MsCi0JCSAgICAgICBvYV9j
b25maWctPmJfY291bnRlcl9yZWdzX2xlbik7Ci0KLQlyZXR1cm4gMDsKKwlyZXR1cm4gZW1pdF9v
YV9jb25maWcoZGV2X3ByaXYsIHN0cmVhbSk7CiB9CiAKIHN0YXRpYyB2b2lkIGhzd19kaXNhYmxl
X21ldHJpY19zZXQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKQEAgLTIzNjAsMTMg
KzIzODQsNyBAQCBzdGF0aWMgaW50IGdlbjhfZW5hYmxlX21ldHJpY19zZXQoc3RydWN0IGk5MTVf
cGVyZl9zdHJlYW0gKnN0cmVhbSkKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0JY29uZmln
X29hX3JlZ3MoZGV2X3ByaXYsIG9hX2NvbmZpZy0+bXV4X3JlZ3MsIG9hX2NvbmZpZy0+bXV4X3Jl
Z3NfbGVuKTsKLQlkZWxheV9hZnRlcl9tdXgoKTsKLQotCWNvbmZpZ19vYV9yZWdzKGRldl9wcml2
LCBvYV9jb25maWctPmJfY291bnRlcl9yZWdzLAotCQkgICAgICAgb2FfY29uZmlnLT5iX2NvdW50
ZXJfcmVnc19sZW4pOwotCi0JcmV0dXJuIDA7CisJcmV0dXJuIGVtaXRfb2FfY29uZmlnKGRldl9w
cml2LCBzdHJlYW0pOwogfQogCiBzdGF0aWMgdm9pZCBnZW44X2Rpc2FibGVfbWV0cmljX3NldChz
dHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQpAQCAtMjU0Miw2ICsyNTYwLDcgQEAgc3Rh
dGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJl
YW0sCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gc3RyZWFtLT5kZXZf
cHJpdjsKIAlpbnQgZm9ybWF0X3NpemU7CisJbG9uZyB0aW1lb3V0OwogCWludCByZXQ7CiAKIAkv
KiBJZiB0aGUgc3lzZnMgbWV0cmljcy8gZGlyZWN0b3J5IHdhc24ndCByZWdpc3RlcmVkIGZvciBz
b21lCkBAIC0yNjExLDggKzI2MzAsOSBAQCBzdGF0aWMgaW50IGk5MTVfb2Ffc3RyZWFtX2luaXQo
c3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwKIAkJZ290byBlcnJfbm9hX3dhaXRfYWxs
b2M7CiAJfQogCi0JcmV0ID0gaTkxNV9wZXJmX2dldF9vYV9jb25maWcoZGV2X3ByaXYsIHByb3Bz
LT5tZXRyaWNzX3NldCwKLQkJCQkgICAgICAmc3RyZWFtLT5vYV9jb25maWcpOworCXJldCA9IGk5
MTVfcGVyZl9nZXRfb2FfY29uZmlnX2FuZF9ibyhzdHJlYW0sIHByb3BzLT5tZXRyaWNzX3NldCwK
KwkJCQkJICAgICAmc3RyZWFtLT5vYV9jb25maWcsCisJCQkJCSAgICAgJnN0cmVhbS0+aW5pdGlh
bF9vYV9jb25maWdfYm8pOwogCWlmIChyZXQpIHsKIAkJRFJNX0RFQlVHKCJJbnZhbGlkIE9BIGNv
bmZpZyBpZD0laVxuIiwgcHJvcHMtPm1ldHJpY3Nfc2V0KTsKIAkJZ290byBlcnJfY29uZmlnOwpA
QCAtMjYzNywyMiArMjY1NywzNCBAQCBzdGF0aWMgaW50IGk5MTVfb2Ffc3RyZWFtX2luaXQoc3Ry
dWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwKIAlpZiAocmV0KQogCQlnb3RvIGVycl9vYV9i
dWZfYWxsb2M7CiAKKwlzdHJlYW0tPm9wcyA9ICZpOTE1X29hX3N0cmVhbV9vcHM7CisKIAlyZXQg
PSBpOTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmZGV2X3ByaXYtPmRybSk7CiAJaWYgKHJl
dCkKIAkJZ290byBlcnJfbG9jazsKIAotCXN0cmVhbS0+b3BzID0gJmk5MTVfb2Ffc3RyZWFtX29w
czsKIAlkZXZfcHJpdi0+cGVyZi5leGNsdXNpdmVfc3RyZWFtID0gc3RyZWFtOwogCiAJcmV0ID0g
ZGV2X3ByaXYtPnBlcmYub3BzLmVuYWJsZV9tZXRyaWNfc2V0KHN0cmVhbSk7CisJbXV0ZXhfdW5s
b2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKHJldCkgewogCQlEUk1fREVC
VUcoIlVuYWJsZSB0byBlbmFibGUgbWV0cmljIHNldFxuIik7CiAJCWdvdG8gZXJyX2VuYWJsZTsK
IAl9CiAKLQlEUk1fREVCVUcoIm9wZW5pbmcgc3RyZWFtIG9hIGNvbmZpZyB1dWlkPSVzXG4iLCBz
dHJlYW0tPm9hX2NvbmZpZy0+dXVpZCk7CisJdGltZW91dCA9IGk5MTVfcmVxdWVzdF93YWl0KHN0
cmVhbS0+aW5pdGlhbF9jb25maWdfcnEsCisJCQkJICAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxF
LAorCQkJCSAgICBNQVhfU0NIRURVTEVfVElNRU9VVCk7CisJaTkxNV9yZXF1ZXN0X3B1dChzdHJl
YW0tPmluaXRpYWxfY29uZmlnX3JxKTsKKwlpOTE1X2dlbV9vYmplY3RfcHV0KHN0cmVhbS0+aW5p
dGlhbF9vYV9jb25maWdfYm8pOworCXN0cmVhbS0+aW5pdGlhbF9jb25maWdfcnEgPSBOVUxMOwor
CXN0cmVhbS0+aW5pdGlhbF9vYV9jb25maWdfYm8gPSBOVUxMOwogCi0JbXV0ZXhfdW5sb2NrKCZk
ZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CisJcmV0ID0gdGltZW91dCA8IDAgPyB0aW1lb3V0
IDogMDsKKwlpZiAocmV0KQorCQlnb3RvIGVycl9lbmFibGU7CisKKwlEUk1fREVCVUcoIm9wZW5p
bmcgc3RyZWFtIG9hIGNvbmZpZyB1dWlkPSVzXG4iLCBzdHJlYW0tPm9hX2NvbmZpZy0+dXVpZCk7
CiAKIAlocnRpbWVyX2luaXQoJnN0cmVhbS0+cG9sbF9jaGVja190aW1lciwKIAkJICAgICBDTE9D
S19NT05PVE9OSUMsIEhSVElNRVJfTU9ERV9SRUwpOwpAQCAtMjY2Myw2ICsyNjk1LDcgQEAgc3Rh
dGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJl
YW0sCiAJcmV0dXJuIDA7CiAKIGVycl9lbmFibGU6CisJbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwogCWRldl9wcml2LT5wZXJmLmV4Y2x1c2l2ZV9zdHJlYW0gPSBOVUxM
OwogCWRldl9wcml2LT5wZXJmLm9wcy5kaXNhYmxlX21ldHJpY19zZXQoc3RyZWFtKTsKIAltdXRl
eF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKQEAgLTI2NzQsNiArMjcwNywx
MSBAQCBzdGF0aWMgaW50IGk5MTVfb2Ffc3RyZWFtX2luaXQoc3RydWN0IGk5MTVfcGVyZl9zdHJl
YW0gKnN0cmVhbSwKIAlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX3B1dCgmZGV2X3ByaXYtPnVuY29y
ZSwgRk9SQ0VXQUtFX0FMTCk7CiAJaW50ZWxfcnVudGltZV9wbV9wdXQoJmRldl9wcml2LT5ydW50
aW1lX3BtLCBzdHJlYW0tPndha2VyZWYpOwogCisJZnJlZV9vYV9jb25maWdzKHN0cmVhbSk7CisK
KwlpOTE1X2dlbV9vYmplY3RfcHV0KHN0cmVhbS0+aW5pdGlhbF9vYV9jb25maWdfYm8pOworCWk5
MTVfcmVxdWVzdF9wdXQoc3RyZWFtLT5pbml0aWFsX2NvbmZpZ19ycSk7CisKIGVycl9jb25maWc6
CiAJZnJlZV9ub2Ffd2FpdChzdHJlYW0pOwogCi0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50
ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9y
Zy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

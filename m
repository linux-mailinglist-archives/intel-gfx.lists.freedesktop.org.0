Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id CEDE324A157
	for <lists+intel-gfx@lfdr.de>; Wed, 19 Aug 2020 16:09:33 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9EAAF6E3FC;
	Wed, 19 Aug 2020 14:09:17 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6A4616E3FC
 for <intel-gfx@lists.freedesktop.org>; Wed, 19 Aug 2020 14:09:13 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 19 Aug 2020 16:08:57 +0200
Message-Id: <20200819140904.1708856-18-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.28.0
In-Reply-To: <20200819140904.1708856-1-maarten.lankhorst@linux.intel.com>
References: <20200819140904.1708856-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 17/24] drm/i915: Convert i915_perf to ww
 locking as well
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: =?UTF-8?q?Thomas=20Hellstr=C3=B6m?= <thomas.hellstrom@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgaGF2ZSB0aGUgb3JkZXJpbmcgb2YgdGltZWxpbmUtPm11dGV4IHZzIHJlc3ZfbG9jayB3cm9u
ZywKY29udmVydCB0aGUgaTkxNV9waW5fdm1hIGFuZCBpbnRlbF9jb250ZXh0X3BpbiBhcyB3ZWxs
IHRvCmZ1dHVyZS1wcm9vZiB0aGlzLgoKV2UgbWF5IG5lZWQgdG8gZG8gZnV0dXJlIGNoYW5nZXMg
dG8gZG8gdGhpcyBtb3JlIHRyYW5zYWN0aW9uLWxpa2UsCmFuZCBvbmx5IGdldCBkb3duIHRvIGEg
c2luZ2xlIGk5MTVfZ2VtX3d3X2N0eCwgYnV0IGZvciBub3cgdGhpcwpzaG91bGQgd29yay4KClNp
Z25lZC1vZmYtYnk6IE1hYXJ0ZW4gTGFua2hvcnN0IDxtYWFydGVuLmxhbmtob3JzdEBsaW51eC5p
bnRlbC5jb20+ClJldmlld2VkLWJ5OiBUaG9tYXMgSGVsbHN0csO2bSA8dGhvbWFzLmhlbGxzdHJv
bUBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgfCA1NyAr
KysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDQyIGluc2Vy
dGlvbnMoKyksIDE1IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfcGVyZi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKaW5kZXgg
YzZmNjM3MDI4M2NmLi5lOTQ5NzY5NzY1NzEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfcGVyZi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCkBA
IC0xMTk1LDI0ICsxMTk1LDM5IEBAIHN0YXRpYyBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqb2FfcGlu
X2NvbnRleHQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIAlzdHJ1Y3QgaTkxNV9n
ZW1fZW5naW5lc19pdGVyIGl0OwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHggPSBzdHJl
YW0tPmN0eDsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7Ci0JaW50IGVycjsKKwlzdHJ1Y3Qg
aTkxNV9nZW1fd3dfY3R4IHd3OworCWludCBlcnIgPSAtRU5PREVWOwogCiAJZm9yX2VhY2hfZ2Vt
X2VuZ2luZShjZSwgaTkxNV9nZW1fY29udGV4dF9sb2NrX2VuZ2luZXMoY3R4KSwgaXQpIHsKIAkJ
aWYgKGNlLT5lbmdpbmUgIT0gc3RyZWFtLT5lbmdpbmUpIC8qIGZpcnN0IG1hdGNoISAqLwogCQkJ
Y29udGludWU7CiAKLQkJLyoKLQkJICogQXMgdGhlIElEIGlzIHRoZSBndHQgb2Zmc2V0IG9mIHRo
ZSBjb250ZXh0J3Mgdm1hIHdlCi0JCSAqIHBpbiB0aGUgdm1hIHRvIGVuc3VyZSB0aGUgSUQgcmVt
YWlucyBmaXhlZC4KLQkJICovCi0JCWVyciA9IGludGVsX2NvbnRleHRfcGluKGNlKTsKLQkJaWYg
KGVyciA9PSAwKSB7Ci0JCQlzdHJlYW0tPnBpbm5lZF9jdHggPSBjZTsKLQkJCWJyZWFrOwotCQl9
CisJCWVyciA9IDA7CisJCWJyZWFrOwogCX0KIAlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19lbmdp
bmVzKGN0eCk7CiAKKwlpZiAoZXJyKQorCQlyZXR1cm4gRVJSX1BUUihlcnIpOworCisJaTkxNV9n
ZW1fd3dfY3R4X2luaXQoJnd3LCB0cnVlKTsKK3JldHJ5OgorCS8qCisJICogQXMgdGhlIElEIGlz
IHRoZSBndHQgb2Zmc2V0IG9mIHRoZSBjb250ZXh0J3Mgdm1hIHdlCisJICogcGluIHRoZSB2bWEg
dG8gZW5zdXJlIHRoZSBJRCByZW1haW5zIGZpeGVkLgorCSAqLworCWVyciA9IGludGVsX2NvbnRl
eHRfcGluX3d3KGNlLCAmd3cpOworCWlmIChlcnIgPT0gLUVERUFETEspIHsKKwkJZXJyID0gaTkx
NV9nZW1fd3dfY3R4X2JhY2tvZmYoJnd3KTsKKwkJaWYgKCFlcnIpCisJCQlnb3RvIHJldHJ5Owor
CX0KKwlpOTE1X2dlbV93d19jdHhfZmluaSgmd3cpOworCisJaWYgKGVycikKKwkJcmV0dXJuIEVS
Ul9QVFIoZXJyKTsKKworCXN0cmVhbS0+cGlubmVkX2N0eCA9IGNlOwogCXJldHVybiBzdHJlYW0t
PnBpbm5lZF9jdHg7CiB9CiAKQEAgLTE5MjMsMTUgKzE5MzgsMjIgQEAgZW1pdF9vYV9jb25maWco
c3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwKIHsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycTsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKKwlzdHJ1Y3QgaTkxNV9nZW1fd3dfY3R4IHd3
OwogCWludCBlcnI7CiAKIAl2bWEgPSBnZXRfb2Ffdm1hKHN0cmVhbSwgb2FfY29uZmlnKTsKIAlp
ZiAoSVNfRVJSKHZtYSkpCiAJCXJldHVybiBQVFJfRVJSKHZtYSk7CiAKLQllcnIgPSBpOTE1X3Zt
YV9waW4odm1hLCAwLCAwLCBQSU5fR0xPQkFMIHwgUElOX0hJR0gpOworCWk5MTVfZ2VtX3d3X2N0
eF9pbml0KCZ3dywgdHJ1ZSk7CityZXRyeToKKwllcnIgPSBpOTE1X2dlbV9vYmplY3RfbG9jayh2
bWEtPm9iaiwgJnd3KTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycjsKKworCWVyciA9IGk5MTVfdm1h
X3Bpbl93dyh2bWEsICZ3dywgMCwgMCwgUElOX0dMT0JBTCB8IFBJTl9ISUdIKTsKIAlpZiAoZXJy
KQotCQlnb3RvIGVycl92bWFfcHV0OworCQlnb3RvIGVycjsKIAogCWludGVsX2VuZ2luZV9wbV9n
ZXQoY2UtPmVuZ2luZSk7CiAJcnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKGNlKTsKQEAgLTE5NTMs
MTEgKzE5NzUsOSBAQCBlbWl0X29hX2NvbmZpZyhzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3Ry
ZWFtLAogCQkJZ290byBlcnJfYWRkX3JlcXVlc3Q7CiAJfQogCi0JaTkxNV92bWFfbG9jayh2bWEp
OwogCWVyciA9IGk5MTVfcmVxdWVzdF9hd2FpdF9vYmplY3QocnEsIHZtYS0+b2JqLCAwKTsKIAlp
ZiAoIWVycikKIAkJZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3RpdmUodm1hLCBycSwgMCk7Ci0J
aTkxNV92bWFfdW5sb2NrKHZtYSk7CiAJaWYgKGVycikKIAkJZ290byBlcnJfYWRkX3JlcXVlc3Q7
CiAKQEAgLTE5NzEsNyArMTk5MSwxNCBAQCBlbWl0X29hX2NvbmZpZyhzdHJ1Y3QgaTkxNV9wZXJm
X3N0cmVhbSAqc3RyZWFtLAogCWk5MTVfcmVxdWVzdF9hZGQocnEpOwogZXJyX3ZtYV91bnBpbjoK
IAlpOTE1X3ZtYV91bnBpbih2bWEpOwotZXJyX3ZtYV9wdXQ6CitlcnI6CisJaWYgKGVyciA9PSAt
RURFQURMSykgeworCQllcnIgPSBpOTE1X2dlbV93d19jdHhfYmFja29mZigmd3cpOworCQlpZiAo
IWVycikKKwkJCWdvdG8gcmV0cnk7CisJfQorCisJaTkxNV9nZW1fd3dfY3R4X2ZpbmkoJnd3KTsK
IAlpOTE1X3ZtYV9wdXQodm1hKTsKIAlyZXR1cm4gZXJyOwogfQotLSAKMi4yOC4wCgpfX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGlu
ZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVl
ZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZngK

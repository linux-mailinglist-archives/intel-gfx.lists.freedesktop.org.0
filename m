Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id BC8DFA1355
	for <lists+intel-gfx@lfdr.de>; Thu, 29 Aug 2019 10:12:26 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 650D26E044;
	Thu, 29 Aug 2019 08:12:19 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6D7C56E03F
 for <intel-gfx@lists.freedesktop.org>; Thu, 29 Aug 2019 08:12:05 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18299887-1500050 
 for multiple; Thu, 29 Aug 2019 09:11:58 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 29 Aug 2019 09:11:42 +0100
Message-Id: <20190829081150.10271-29-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190829081150.10271-1-chris@chris-wilson.co.uk>
References: <20190829081150.10271-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 28/36] drm/i915: Cancel non-persistent contexts
 on close
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Tm9ybWFsbHksIHdlIHJlbHkgb24gb3VyIGhhbmdjaGVjayB0byBwcmV2ZW50IHBlcnNpc3RlbnQg
YmF0Y2hlcyBmcm9tCmhvZ2dpbmcgdGhlIEdQVS4gSG93ZXZlciwgaWYgdGhlIHVzZXIgZGlzYWJs
ZXMgaGFuZ2NoZWNrLCB0aGlzIG1lY2hhbmlzbQpicmVha3MgZG93bi4gRGVzcGl0ZSBvdXIgaW5z
aXN0ZW5jZSB0aGF0IHRoaXMgaXMgdW5zYWZlLCB0aGUgdXNlcnMgYXJlCmVxdWFsbHkgaW5zaXN0
ZW50IHRoYXQgdGhleSB3YW50IHRvIHVzZSBlbmRsZXNzIGJhdGNoZXMgYW5kIHdpbGwgZGlzYWJs
ZQp0aGUgaGFuZ2NoZWNrIG1lY2hhbmlzbS4gV2UgYXJlIGxvb2tpbmcgYXQgcGVyaGFwcyByZXBs
YWNpbmcgaGFuZ2NoZWNrCndpdGggYSBzb2Z0ZXIgbWVjaGFuaXNtLCB0aGF0IHNlbmRzIGEgcHVs
c2UgZG93biB0aGUgZW5naW5lIHRvIGNoZWNrIGlmCml0IGlzIHdlbGwuIFdlIGNhbiB1c2UgdGhl
IHNhbWUgcHJlZW1wdGl2ZSBwdWxzZSB0byBmbHVzaCBhbiBhY3RpdmUKcGVyc2lzdGVudCBjb250
ZXh0IG9mZiB0aGUgR1BVIHVwb24gY29udGV4dCBjbG9zZSwgcHJldmVudGluZyByZXNvdXJjZXMK
YmVpbmcgbG9zdCBhbmQgdW5raWxsYWJsZSByZXF1ZXN0cyByZW1haW5pbmcgb24gdGhlIEdQVSBh
ZnRlciBwcm9jZXNzCnRlcm1pbmF0aW9uLiBUbyBhdm9pZCBjaGFuZ2luZyB0aGUgQUJJIGFuZCBh
Y2NpZGVudGFsbHkgYnJlYWtpbmcKZXhpc3RpbmcgdXNlcnNwYWNlLCB3ZSBtYWtlIHRoZSBwZXJz
aXN0ZW5jZSBvZiBhIGNvbnRleHQgZXhwbGljaXQgYW5kCmVuYWJsZSBpdCBieSBkZWZhdWx0ICht
YXRjaGluZyBjdXJyZW50IEFCSSkuIFVzZXJzcGFjZSBjYW4gb3B0IG91dCBvZgpwZXJzaXN0ZW50
IG1vZGUgKGZvcmNpbmcgcmVxdWVzdHMgdG8gYmUgY2FuY2VsbGVkIHdoZW4gdGhlIGNvbnRleHQg
aXMKY2xvc2VkIGJ5IHByb2Nlc3MgdGVybWluYXRpb24gb3IgZXhwbGljaXRseSkgYnkgYSBjb250
ZXh0IHBhcmFtZXRlci4gVG8KZmFjaWxpdGF0ZSBleGlzdGluZyB1c2UtY2FzZXMgb2YgZGlzYWJs
aW5nIGhhbmdjaGVjaywgaWYgdGhlIG1vZHBhcmFtIGlzCmRpc2FibGVkIChpOTE1LmVuYWJsZV9o
YW5nY2hlY2s9MCksIHdlIGRpc2FibGUgcGVyc2lzdGVuY2UgbW9kZSBieQpkZWZhdWx0LiAgKE5v
dGUsIG9uZSBvZiB0aGUgb3V0Y29tZXMgZm9yIHN1cHBvcnRpbmcgZW5kbGVzcyBtb2RlIHdpbGwg
YmUKdGhlIHJlbW92YWwgb2YgaGFuZ2NoZWNraW5nLCBhdCB3aGljaCBwb2ludCBvcHRpbmcgaW50
byBwZXJzaXN0ZW50IG1vZGUKd2lsbCBiZSBtYW5kYXRvcnksIG9yIG1heWJlIHRoZSBkZWZhdWx0
IHBlcmhhcHMgY29udHJvbGxlZCBieSBjZ3JvdXBzLikKClRlc3RjYXNlOiBpZ3QvZ2VtX2N0eF9w
ZXJzaXN0ZW5jZQpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNv
bi5jby51az4KQ2M6IEpvb25hcyBMYWh0aW5lbiA8am9vbmFzLmxhaHRpbmVuQGxpbnV4LmludGVs
LmNvbT4KQ2M6IE1pY2hhxYIgV2luaWFyc2tpIDxtaWNoYWwud2luaWFyc2tpQGludGVsLmNvbT4K
Q2M6IEpvbiBCbG9vbWZpZWxkIDxqb24uYmxvb21maWVsZEBpbnRlbC5jb20+Ci0tLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgICAgICAgICAgICAgICAgIHwgICAzICstCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jICAgfCAxMjIgKysrKysrKysrKysr
KysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5oICAgfCAg
MTUgKysrCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0X3R5cGVzLmggfCAg
IDEgKwogLi4uL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL21vY2tfY29udGV4dC5jIHwgICAy
ICsKIC4uLi9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2hlYXJ0YmVhdC5jICB8ICA1NiAr
KysrKysrKwogLi4uL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfaGVhcnRiZWF0LmggIHwg
IDE0ICsrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYyAgICAgfCAg
IDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcHJpb2xpc3RfdHlwZXMuaCAgICB8ICAg
MSArCiBpbmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJtLmggICAgICAgICAgICAgICAgICAgfCAgMTUg
KysrCiAxMCBmaWxlcyBjaGFuZ2VkLCAyMjkgaW5zZXJ0aW9ucygrKSwgMiBkZWxldGlvbnMoLSkK
IGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVf
aGVhcnRiZWF0LmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9lbmdpbmVfaGVhcnRiZWF0LmgKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCmluZGV4IGFiNWZhNThk
MjRmNy4uNzU5YzA2ZDA4N2I0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtl
ZmlsZQorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQpAQCAtNzYsOCArNzYsOSBA
QCBndC15ICs9IFwKIAlndC9pbnRlbF9icmVhZGNydW1icy5vIFwKIAlndC9pbnRlbF9jb250ZXh0
Lm8gXAogCWd0L2ludGVsX2VuZ2luZV9jcy5vIFwKLQlndC9pbnRlbF9lbmdpbmVfcG9vbC5vIFwK
KwlndC9pbnRlbF9lbmdpbmVfaGVhcnRiZWF0Lm8gXAogCWd0L2ludGVsX2VuZ2luZV9wbS5vIFwK
KwlndC9pbnRlbF9lbmdpbmVfcG9vbC5vIFwKIAlndC9pbnRlbF9lbmdpbmVfdXNlci5vIFwKIAln
dC9pbnRlbF9ndC5vIFwKIAlndC9pbnRlbF9ndF9pcnEubyBcCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwppbmRleCBiZGJlZDA3NWMyMWMuLjA2MjFhZThhMWU4
YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCkBAIC03
MCw2ICs3MCw3IEBACiAjaW5jbHVkZSA8ZHJtL2k5MTVfZHJtLmg+CiAKICNpbmNsdWRlICJndC9p
bnRlbF9scmNfcmVnLmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfZW5naW5lX2hlYXJ0YmVhdC5oIgog
I2luY2x1ZGUgImd0L2ludGVsX2VuZ2luZV91c2VyLmgiCiAKICNpbmNsdWRlICJpOTE1X2dlbV9j
b250ZXh0LmgiCkBAIC0zNzUsNiArMzc2LDc4IEBAIHZvaWQgaTkxNV9nZW1fY29udGV4dF9yZWxl
YXNlKHN0cnVjdCBrcmVmICpyZWYpCiAJCXF1ZXVlX3dvcmsoaTkxNS0+d3EsICZpOTE1LT5jb250
ZXh0cy5mcmVlX3dvcmspOwogfQogCitzdGF0aWMgaW5saW5lIHN0cnVjdCBpOTE1X2dlbV9lbmdp
bmVzICoKK19fY29udGV4dF9lbmdpbmVzX3N0YXRpYyhzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAq
Y3R4KQoreworCXJldHVybiByY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKGN0eC0+ZW5naW5lcywg
dHJ1ZSk7Cit9CisKK3N0YXRpYyB2b2lkIGtpbGxfY29udGV4dChzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqY3R4KQoreworCWludGVsX2VuZ2luZV9tYXNrX3QgdG1wLCBhY3RpdmUsIHJlc2V0Owor
CXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSAmY3R4LT5pOTE1LT5ndDsKKwlzdHJ1Y3QgaTkxNV9nZW1f
ZW5naW5lc19pdGVyIGl0OworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKKwlzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2U7CisKKwkvKgorCSAqIElmIHdlIGFyZSBhbHJlYWR5IGJhbm5l
ZCwgaXQgd2FzIGR1ZSB0byBhIGd1aWx0eSByZXF1ZXN0IGNhdXNpbmcKKwkgKiBhIHJlc2V0IGFu
ZCB0aGUgZW50aXJlIGNvbnRleHQgYmVpbmcgZXZpY3RlZCBmcm9tIHRoZSBHUFUuCisJICovCisJ
aWYgKGk5MTVfZ2VtX2NvbnRleHRfaXNfYmFubmVkKGN0eCkpCisJCXJldHVybjsKKworCWk5MTVf
Z2VtX2NvbnRleHRfc2V0X2Jhbm5lZChjdHgpOworCisJLyoKKwkgKiBNYXAgdGhlIHVzZXIncyBl
bmdpbmUgYmFjayB0byB0aGUgYWN0dWFsIGVuZ2luZXM7IG9uZSB2aXJ0dWFsCisJICogZW5naW5l
IHdpbGwgYmUgbWFwcGVkIHRvIG11bHRpcGxlIGVuZ2luZXMsIGFuZCB1c2luZyBjdHgtPmVuZ2lu
ZVtdCisJICogdGhlIHNhbWUgZW5naW5lIG1heSBiZSBoYXZlIG11bHRpcGxlIGluc3RhbmNlcyBp
biB0aGUgdXNlcidzIG1hcC4KKwkgKiBIb3dldmVyLCB3ZSBvbmx5IGNhcmUgYWJvdXQgcGVuZGlu
ZyByZXF1ZXN0cywgc28gb25seSBpbmNsdWRlCisJICogZW5naW5lcyBvbiB3aGljaCB0aGVyZSBh
cmUgaW5jb21wbGV0ZSByZXF1ZXN0cy4KKwkgKi8KKwlhY3RpdmUgPSAwOworCWZvcl9lYWNoX2dl
bV9lbmdpbmUoY2UsIF9fY29udGV4dF9lbmdpbmVzX3N0YXRpYyhjdHgpLCBpdCkgeworCQlzdHJ1
Y3QgZG1hX2ZlbmNlICpmZW5jZTsKKworCQlpZiAoIWNlLT50aW1lbGluZSkKKwkJCWNvbnRpbnVl
OworCisJCWZlbmNlID0gaTkxNV9hY3RpdmVfZmVuY2VfZ2V0KCZjZS0+dGltZWxpbmUtPmxhc3Rf
cmVxdWVzdCk7CisJCWlmICghZmVuY2UpCisJCQljb250aW51ZTsKKworCQllbmdpbmUgPSB0b19y
ZXF1ZXN0KGZlbmNlKS0+ZW5naW5lOworCQlpZiAoSEFTX0VYRUNMSVNUUyhndC0+aTkxNSkpCisJ
CQllbmdpbmUgPSBpbnRlbF9jb250ZXh0X2luZmxpZ2h0KGNlKTsKKwkJaWYgKGVuZ2luZSkKKwkJ
CWFjdGl2ZSB8PSBlbmdpbmUtPm1hc2s7CisKKwkJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CisJfQor
CisJLyoKKwkgKiBTZW5kIGEgImhpZ2ggcHJpb3JpdHkgcHVsc2UiIGRvd24gdGhlIGVuZ2luZSB0
byBjYXVzZSB0aGUKKwkgKiBjdXJyZW50IHJlcXVlc3QgdG8gYmUgbW9tZW50YXJpbHkgcHJlZW1w
dGVkLiAoSWYgaXQgZmFpbHMgdG8KKwkgKiBiZSBwcmVlbXB0ZWQsIGl0IHdpbGwgYmUgcmVzZXQp
LiBBcyB3ZSBoYXZlIG1hcmtlZCBvdXIgY29udGV4dAorCSAqIGFzIGJhbm5lZCwgYW55IGluY29t
cGxldGUgcmVxdWVzdCwgaW5jbHVkaW5nIGFueSBydW5uaW5nLCB3aWxsCisJICogYmUgc2tpcHBl
ZCBmb2xsb3dpbmcgdGhlIHByZWVtcHRpb24uCisJICovCisJcmVzZXQgPSAwOworCWZvcl9lYWNo
X2VuZ2luZV9tYXNrZWQoZW5naW5lLCBndC0+aTkxNSwgYWN0aXZlLCB0bXApCisJCWlmIChpbnRl
bF9lbmdpbmVfcHVsc2UoZW5naW5lKSkKKwkJCXJlc2V0IHw9IGVuZ2luZS0+bWFzazsKKworCS8q
CisJICogSWYgd2UgYXJlIHVuYWJsZSB0byBzZW5kIGEgcHJlZW1wdGl2ZSBwdWxzZSB0byBidW1w
CisJICogdGhlIGNvbnRleHQgZnJvbSB0aGUgR1BVLCB3ZSBoYXZlIHRvIHJlc29ydCB0byBhIGZ1
bGwKKwkgKiByZXNldC4gV2UgaG9wZSB0aGUgY29sbGF0ZXJhbCBkYW1hZ2UgaXMgd29ydGggaXQu
CisJICovCisJaWYgKHJlc2V0KQorCQlpbnRlbF9ndF9oYW5kbGVfZXJyb3IoZ3QsIHJlc2V0LCAw
LAorCQkJCSAgICAgICJjb250ZXh0IGNsb3N1cmUgaW4gJXMiLCBjdHgtPm5hbWUpOworfQorCiBz
dGF0aWMgdm9pZCBjb250ZXh0X2Nsb3NlKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCiB7
CiAJaTkxNV9nZW1fY29udGV4dF9zZXRfY2xvc2VkKGN0eCk7CkBAIC00MDAsNiArNDczLDEwIEBA
IHN0YXRpYyB2b2lkIGNvbnRleHRfY2xvc2Uoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkK
IAlsdXRfY2xvc2UoY3R4KTsKIAogCW11dGV4X3VubG9jaygmY3R4LT5tdXRleCk7CisKKwlpZiAo
IWk5MTVfZ2VtX2NvbnRleHRfaXNfcGVyc2lzdGVudChjdHgpKQorCQlraWxsX2NvbnRleHQoY3R4
KTsKKwogCWk5MTVfZ2VtX2NvbnRleHRfcHV0KGN0eCk7CiB9CiAKQEAgLTQ0MCw2ICs1MTcsMjEg
QEAgX19jcmVhdGVfY29udGV4dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAlpOTE1
X2dlbV9jb250ZXh0X3NldF9iYW5uYWJsZShjdHgpOwogCWk5MTVfZ2VtX2NvbnRleHRfc2V0X3Jl
Y292ZXJhYmxlKGN0eCk7CiAKKwkvKgorCSAqIElmIHRoZSB1c2VyIGhhcyBkaXNhYmxlZCBoYW5n
Y2hlY2tpbmcsIHdlIGNhbiBub3QgYmUgc3VyZSB0aGF0CisJICogdGhlIGJhdGNoZXMgd2lsbCBl
dmVyIGNvbXBsZXRlIGFmdGVyIHRoZSBjb250ZXh0IGlzIGNsb3NlZCwKKwkgKiBrZWVwIHRoZSBj
b250ZXh0IGFuZCBhbGwgcmVzb3VyY2VzIHBpbm5lZCBmb3JldmVyLiBTbyBpbiB0aGlzCisJICog
Y2FzZSB3ZSBvcHQgdG8gZm9yY2libHkga2lsbCBvZmYgYWxsIHJlbWFpbmluZyByZXF1ZXN0cyBv
bgorCSAqIGNvbnRleHQgY2xvc2UuCisJICoKKwkgKiBOb3RlIHRoYXQgdGhlIHVzZXIgbWF5IGNo
YW5jZSB0aGUgdmFsdWUgb2YgdGhlIG1vZHBhcmFtIGJldHdlZW4KKwkgKiBjb250ZXh0IGNyZWF0
aW9uIGFuZCBjbG9zZSwgd2UgY2hvb3NlIHRvIGlnbm9yZSB0aGlzIGZvciB0aGUKKwkgKiBzYWtl
IG9mIGRldGVybWluaXNtIGFuZCBleHBlY3QgdGhlIHVzZXIgdG8gc2V0IHRoZSBwYXJhbWV0ZXIK
KwkgKiBvbiBtb2R1bGUgbG9hZCBhbmQgbmV2ZXIgdG91Y2ggaXQgYWdhaW4uCisJICovCisJaWYg
KGk5MTVfbW9kcGFyYW1zLmVuYWJsZV9oYW5nY2hlY2spIC8qIGNncm91cCBob29rPyAqLworCQlp
OTE1X2dlbV9jb250ZXh0X3NldF9wZXJzaXN0ZW5jZShjdHgpOworCiAJZm9yIChpID0gMDsgaSA8
IEFSUkFZX1NJWkUoY3R4LT5oYW5nX3RpbWVzdGFtcCk7IGkrKykKIAkJY3R4LT5oYW5nX3RpbWVz
dGFtcFtpXSA9IGppZmZpZXMgLSBDT05URVhUX0ZBU1RfSEFOR19KSUZGSUVTOwogCkBAIC01OTcs
NiArNjg5LDcgQEAgaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1LCBpbnQgcHJpbykKIAl9CiAKIAlpOTE1X2dlbV9jb250ZXh0X2NsZWFy
X2Jhbm5hYmxlKGN0eCk7CisJaTkxNV9nZW1fY29udGV4dF9zZXRfcGVyc2lzdGVuY2UoY3R4KTsK
IAljdHgtPnNjaGVkLnByaW9yaXR5ID0gSTkxNV9VU0VSX1BSSU9SSVRZKHByaW8pOwogCiAJR0VN
X0JVR19PTighaTkxNV9nZW1fY29udGV4dF9pc19rZXJuZWwoY3R4KSk7CkBAIC0xNzI2LDYgKzE4
MTksMjYgQEAgZ2V0X2VuZ2luZXMoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAlyZXR1
cm4gZXJyOwogfQogCitzdGF0aWMgaW50CitzZXRfcGVyc2lzdGVuY2Uoc3RydWN0IGk5MTVfZ2Vt
X2NvbnRleHQgKmN0eCwKKwkJY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9jb250ZXh0X3BhcmFt
ICphcmdzKQoreworCWlmIChhcmdzLT5zaXplKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWlmIChh
cmdzLT52YWx1ZSkgeworCQlpOTE1X2dlbV9jb250ZXh0X3NldF9wZXJzaXN0ZW5jZShjdHgpOwor
CQlyZXR1cm4gMDsKKwl9CisKKwkvKiBUbyBjYW5jZWwgYSBjb250ZXh0IHdlIHVzZSAicHJlZW1w
dC10by1pZGxlIiAqLworCWlmICghKGN0eC0+aTkxNS0+Y2Fwcy5zY2hlZHVsZXIgJiBJOTE1X1ND
SEVEVUxFUl9DQVBfUFJFRU1QVElPTikpCisJCXJldHVybiAtRU5PREVWOworCisJaTkxNV9nZW1f
Y29udGV4dF9jbGVhcl9wZXJzaXN0ZW5jZShjdHgpOworCXJldHVybiAwOworfQorCiBzdGF0aWMg
aW50IGN0eF9zZXRwYXJhbShzdHJ1Y3QgZHJtX2k5MTVfZmlsZV9wcml2YXRlICpmcHJpdiwKIAkJ
CXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2Nv
bnRleHRfcGFyYW0gKmFyZ3MpCkBAIC0xODAzLDYgKzE5MTYsMTAgQEAgc3RhdGljIGludCBjdHhf
c2V0cGFyYW0oc3RydWN0IGRybV9pOTE1X2ZpbGVfcHJpdmF0ZSAqZnByaXYsCiAJCXJldCA9IHNl
dF9lbmdpbmVzKGN0eCwgYXJncyk7CiAJCWJyZWFrOwogCisJY2FzZSBJOTE1X0NPTlRFWFRfUEFS
QU1fUEVSU0lTVEVOQ0U6CisJCXJldCA9IHNldF9wZXJzaXN0ZW5jZShjdHgsIGFyZ3MpOworCQli
cmVhazsKKwogCWNhc2UgSTkxNV9DT05URVhUX1BBUkFNX0JBTl9QRVJJT0Q6CiAJZGVmYXVsdDoK
IAkJcmV0ID0gLUVJTlZBTDsKQEAgLTIyNTQsNiArMjM3MSwxMSBAQCBpbnQgaTkxNV9nZW1fY29u
dGV4dF9nZXRwYXJhbV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAog
CQlyZXQgPSBnZXRfZW5naW5lcyhjdHgsIGFyZ3MpOwogCQlicmVhazsKIAorCWNhc2UgSTkxNV9D
T05URVhUX1BBUkFNX1BFUlNJU1RFTkNFOgorCQlhcmdzLT5zaXplID0gMDsKKwkJYXJncy0+dmFs
dWUgPSBpOTE1X2dlbV9jb250ZXh0X2lzX3BlcnNpc3RlbnQoY3R4KTsKKwkJYnJlYWs7CisKIAlj
YXNlIEk5MTVfQ09OVEVYVF9QQVJBTV9CQU5fUEVSSU9EOgogCWRlZmF1bHQ6CiAJCXJldCA9IC1F
SU5WQUw7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29u
dGV4dC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaAppbmRl
eCAxNzY5Nzg2MDhiNmYuLmUwZjViNmM2YTMzMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fY29udGV4dC5oCkBAIC03NCw2ICs3NCwyMSBAQCBzdGF0aWMgaW5saW5lIHZv
aWQgaTkxNV9nZW1fY29udGV4dF9jbGVhcl9yZWNvdmVyYWJsZShzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqYwogCWNsZWFyX2JpdChVQ09OVEVYVF9SRUNPVkVSQUJMRSwgJmN0eC0+dXNlcl9mbGFn
cyk7CiB9CiAKK3N0YXRpYyBpbmxpbmUgYm9vbCBpOTE1X2dlbV9jb250ZXh0X2lzX3BlcnNpc3Rl
bnQoY29uc3Qgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKK3sKKwlyZXR1cm4gdGVzdF9i
aXQoVUNPTlRFWFRfUEVSU0lTVEVOQ0UsICZjdHgtPnVzZXJfZmxhZ3MpOworfQorCitzdGF0aWMg
aW5saW5lIHZvaWQgaTkxNV9nZW1fY29udGV4dF9zZXRfcGVyc2lzdGVuY2Uoc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHQgKmN0eCkKK3sKKwlzZXRfYml0KFVDT05URVhUX1BFUlNJU1RFTkNFLCAmY3R4
LT51c2VyX2ZsYWdzKTsKK30KKworc3RhdGljIGlubGluZSB2b2lkIGk5MTVfZ2VtX2NvbnRleHRf
Y2xlYXJfcGVyc2lzdGVuY2Uoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKK3sKKwljbGVh
cl9iaXQoVUNPTlRFWFRfUEVSU0lTVEVOQ0UsICZjdHgtPnVzZXJfZmxhZ3MpOworfQorCiBzdGF0
aWMgaW5saW5lIGJvb2wgaTkxNV9nZW1fY29udGV4dF9pc19iYW5uZWQoY29uc3Qgc3RydWN0IGk5
MTVfZ2VtX2NvbnRleHQgKmN0eCkKIHsKIAlyZXR1cm4gdGVzdF9iaXQoQ09OVEVYVF9CQU5ORUQs
ICZjdHgtPmZsYWdzKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9jb250ZXh0X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
Y29udGV4dF90eXBlcy5oCmluZGV4IDI2MGQ1OWNjM2RlOC4uZGFmMWVhNTA3NWE2IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dF90eXBlcy5oCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0X3R5cGVzLmgKQEAg
LTEzNyw2ICsxMzcsNyBAQCBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCB7CiAjZGVmaW5lIFVDT05U
RVhUX05PX0VSUk9SX0NBUFRVUkUJMQogI2RlZmluZSBVQ09OVEVYVF9CQU5OQUJMRQkJMgogI2Rl
ZmluZSBVQ09OVEVYVF9SRUNPVkVSQUJMRQkJMworI2RlZmluZSBVQ09OVEVYVF9QRVJTSVNURU5D
RQkJNAogCiAJLyoqCiAJICogQGZsYWdzOiBzbWFsbCBzZXQgb2YgYm9vbGVhbnMKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvbW9ja19jb250ZXh0LmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL21vY2tfY29udGV4dC5jCmluZGV4IGJl
ODk3NGNjZmYyNC4uMGQxYTI3NWVjMzE2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vc2VsZnRlc3RzL21vY2tfY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9zZWxmdGVzdHMvbW9ja19jb250ZXh0LmMKQEAgLTIzLDYgKzIzLDggQEAgbW9ja19jb250
ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCUlOSVRfTElTVF9IRUFEKCZjdHgt
PmxpbmspOwogCWN0eC0+aTkxNSA9IGk5MTU7CiAKKwlpOTE1X2dlbV9jb250ZXh0X3NldF9wZXJz
aXN0ZW5jZShjdHgpOworCiAJbXV0ZXhfaW5pdCgmY3R4LT5lbmdpbmVzX211dGV4KTsKIAllID0g
ZGVmYXVsdF9lbmdpbmVzKGN0eCk7CiAJaWYgKElTX0VSUihlKSkKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9oZWFydGJlYXQuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9oZWFydGJlYXQuYwpuZXcgZmlsZSBtb2RlIDEwMDY0
NAppbmRleCAwMDAwMDAwMDAwMDAuLjJmYzQxM2Y5ZDUwNgotLS0gL2Rldi9udWxsCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9oZWFydGJlYXQuYwpAQCAtMCwwICsx
LDU2IEBACisvKgorICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAorICoKKyAqIENvcHly
aWdodCDCqSAyMDE5IEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2luY2x1ZGUgImk5MTVfcmVx
dWVzdC5oIgorCisjaW5jbHVkZSAiaW50ZWxfY29udGV4dC5oIgorI2luY2x1ZGUgImludGVsX2Vu
Z2luZV9oZWFydGJlYXQuaCIKKyNpbmNsdWRlICJpbnRlbF9lbmdpbmVfcG0uaCIKKyNpbmNsdWRl
ICJpbnRlbF9lbmdpbmUuaCIKKyNpbmNsdWRlICJpbnRlbF9ndC5oIgorCitzdGF0aWMgdm9pZCBp
ZGxlX3B1bHNlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnEpCit7CisJZW5naW5lLT53YWtlcmVmX3NlcmlhbCA9IFJFQURfT05DRShlbmdpbmUt
PnNlcmlhbCkgKyAxOworCWk5MTVfcmVxdWVzdF9hZGRfYWN0aXZlX2JhcnJpZXJzKHJxKTsKK30K
KworaW50IGludGVsX2VuZ2luZV9wdWxzZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUp
Cit7CisJc3RydWN0IGk5MTVfc2NoZWRfYXR0ciBhdHRyID0geyAucHJpb3JpdHkgPSBJOTE1X1BS
SU9SSVRZX0JBUlJJRVIgfTsKKwlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UgPSBlbmdpbmUtPmtl
cm5lbF9jb250ZXh0OworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCWludCBlcnIgPSAwOwor
CisJaWYgKCFpbnRlbF9lbmdpbmVfaGFzX3ByZWVtcHRpb24oZW5naW5lKSkKKwkJcmV0dXJuIC1F
Tk9ERVY7CisKKwlpZiAoIWludGVsX2VuZ2luZV9wbV9nZXRfaWZfYXdha2UoZW5naW5lKSkKKwkJ
cmV0dXJuIDA7CisKKwlpZiAobXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZjZS0+dGltZWxpbmUt
Pm11dGV4KSkKKwkJZ290byBvdXRfcnBtOworCisJaW50ZWxfY29udGV4dF9lbnRlcihjZSk7CisJ
cnEgPSBfX2k5MTVfcmVxdWVzdF9jcmVhdGUoY2UsIEdGUF9OT1dBSVQgfCBfX0dGUF9OT1dBUk4p
OworCWludGVsX2NvbnRleHRfZXhpdChjZSk7CisJaWYgKElTX0VSUihycSkpIHsKKwkJZXJyID0g
UFRSX0VSUihycSk7CisJCWdvdG8gb3V0X3VubG9jazsKKwl9CisKKwlycS0+ZmxhZ3MgfD0gSTkx
NV9SRVFVRVNUX1NFTlRJTkVMOworCWlkbGVfcHVsc2UoZW5naW5lLCBycSk7CisKKwlfX2k5MTVf
cmVxdWVzdF9jb21taXQocnEpOworCV9faTkxNV9yZXF1ZXN0X3F1ZXVlKHJxLCAmYXR0cik7CisK
K291dF91bmxvY2s6CisJbXV0ZXhfdW5sb2NrKCZjZS0+dGltZWxpbmUtPm11dGV4KTsKK291dF9y
cG06CisJaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOworCXJldHVybiBlcnI7Cit9CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfaGVhcnRiZWF0Lmgg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfaGVhcnRiZWF0LmgKbmV3IGZp
bGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5iOTUwNDUxYjU5OTgKLS0tIC9kZXYv
bnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfaGVhcnRiZWF0
LmgKQEAgLTAsMCArMSwxNCBAQAorLyoKKyAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQK
KyAqCisgKiBDb3B5cmlnaHQgwqkgMjAxOSBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpZm5k
ZWYgSU5URUxfRU5HSU5FX0hFQVJUQkVBVF9ICisjZGVmaW5lIElOVEVMX0VOR0lORV9IRUFSVEJF
QVRfSAorCitzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzOworCitpbnQgaW50ZWxfZW5naW5lX3B1bHNl
KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSk7CisKKyNlbmRpZiAvKiBJTlRFTF9FTkdJ
TkVfSEVBUlRCRUFUX0ggKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2VuZ2luZV9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3Bt
LmMKaW5kZXggNDcyYjIyNTlmNjI5Li4xMmEyNjA4YTg4ODkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jCkBAIC0xMTAsNyArMTEwLDcgQEAgc3RhdGljIGJvb2wg
c3dpdGNoX3RvX2tlcm5lbF9jb250ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkK
IAlpOTE1X3JlcXVlc3RfYWRkX2FjdGl2ZV9iYXJyaWVycyhycSk7CiAKIAkvKiBJbnN0YWxsIG91
cnNlbHZlcyBhcyBhIHByZWVtcHRpb24gYmFycmllciAqLwotCXJxLT5zY2hlZC5hdHRyLnByaW9y
aXR5ID0gSTkxNV9QUklPUklUWV9VTlBSRUVNUFRBQkxFOworCXJxLT5zY2hlZC5hdHRyLnByaW9y
aXR5ID0gSTkxNV9QUklPUklUWV9CQVJSSUVSOwogCV9faTkxNV9yZXF1ZXN0X2NvbW1pdChycSk7
CiAKIAkvKiBSZWxlYXNlIG91ciBleGNsdXNpdmUgaG9sZCBvbiB0aGUgZW5naW5lICovCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ByaW9saXN0X3R5cGVzLmggYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ByaW9saXN0X3R5cGVzLmgKaW5kZXggMjEwMzdhMmUyMDM4
Li5hZThiYjNjYjYyN2UgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcHJp
b2xpc3RfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ByaW9saXN0X3R5
cGVzLmgKQEAgLTM5LDYgKzM5LDcgQEAgZW51bSB7CiAgKiBhY3RpdmUgcmVxdWVzdC4KICAqLwog
I2RlZmluZSBJOTE1X1BSSU9SSVRZX1VOUFJFRU1QVEFCTEUgSU5UX01BWAorI2RlZmluZSBJOTE1
X1BSSU9SSVRZX0JBUlJJRVIgSU5UX01BWAogCiAjZGVmaW5lIF9fTk9fUFJFRU1QVElPTiAoSTkx
NV9QUklPUklUWV9XQUlUKQogCmRpZmYgLS1naXQgYS9pbmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJt
LmggYi9pbmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJtLmgKaW5kZXggNDY5ZGM1MTJjY2EzLi5kYmM4
NjkxZDc1ZDAgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaAorKysgYi9p
bmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJtLmgKQEAgLTE1NjUsNiArMTU2NSwyMSBAQCBzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX2NvbnRleHRfcGFyYW0gewogICogICBpOTE1X2NvbnRleHRfZW5naW5lc19i
b25kIChJOTE1X0NPTlRFWFRfRU5HSU5FU19FWFRfQk9ORCkKICAqLwogI2RlZmluZSBJOTE1X0NP
TlRFWFRfUEFSQU1fRU5HSU5FUwkweGEKKworLyoKKyAqIEk5MTVfQ09OVEVYVF9QQVJBTV9QRVJT
SVNURU5DRToKKyAqCisgKiBBbGxvdyB0aGUgY29udGV4dCBhbmQgYWN0aXZlIHJlbmRlcmluZyB0
byBzdXJ2aXZlIHRoZSBwcm9jZXNzIHVudGlsCisgKiBjb21wbGV0aW9uLiBQZXJzaXN0ZW5jZSBh
bGxvd3MgZmlyZS1hbmQtZm9yZ2V0IGNsaWVudHMgdG8gcXVldWUgdXAgYQorICogYnVuY2ggb2Yg
d29yaywgaGFuZCB0aGUgb3V0cHV0IG92ZXIgdG8gYSBkaXNwbGF5IHNlcnZlciBhbmQgdGhlIHF1
aXQuCisgKiBJZiB0aGUgY29udGV4dCBpcyBub3QgbWFya2VkIGFzIHBlcnNpc3RlbnQsIHVwb24g
Y2xvc2luZyAoZWl0aGVyIHZpYQorICogYW4gZXhwbGljaXQgRFJNX0k5MTVfR0VNX0NPTlRFWFRf
REVTVFJPWSBvciBpbXBsaWNpdGx5IGZyb20gZmlsZSBjbG9zdXJlCisgKiBvciBwcm9jZXNzIHRl
cm1pbmF0aW9uKSwgdGhlIGNvbnRleHQgYW5kIGFueSBvdXRzdGFuZGluZyByZXF1ZXN0cyB3aWxs
IGJlCisgKiBjYW5jZWxsZWQgKGFuZCBleHBvcnRlZCBmZW5jZXMgZm9yIGNhbmNlbGxlZCByZXF1
ZXN0cyBtYXJrZWQgYXMgLUVJTykuCisgKgorICogQnkgZGVmYXVsdCwgbmV3IGNvbnRleHRzIGFs
bG93IHBlcnNpc3RlbmNlLgorICovCisjZGVmaW5lIEk5MTVfQ09OVEVYVF9QQVJBTV9QRVJTSVNU
RU5DRQkweGIKIC8qIE11c3QgYmUga2VwdCBjb21wYWN0IC0tIG5vIGhvbGVzIGFuZCB3ZWxsIGRv
Y3VtZW50ZWQgKi8KIAogCV9fdTY0IHZhbHVlOwotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0Cklu
dGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

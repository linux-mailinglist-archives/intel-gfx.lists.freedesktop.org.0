Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id A4F1A2C33B
	for <lists+intel-gfx@lfdr.de>; Tue, 28 May 2019 11:30:08 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 36012898C7;
	Tue, 28 May 2019 09:30:06 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 256CB89D44
 for <intel-gfx@lists.freedesktop.org>; Tue, 28 May 2019 09:30:02 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16703195-1500050 
 for <intel-gfx@lists.freedesktop.org>; Tue, 28 May 2019 10:30:00 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 28 May 2019 10:29:54 +0100
Message-Id: <20190528092956.14910-13-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190528092956.14910-1-chris@chris-wilson.co.uk>
References: <20190528092956.14910-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 13/15] drm/i915: Move GEM client throttling to its
 own file
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q29udGludWluZyB0aGUgZGVjbHV0dGVyaW5nIG9mIGk5MTVfZ2VtLmMgYnkgbW92aW5nIHRoZSBj
bGllbnQgc2VsZgp0aHJvdHRsaW5nIGludG8gaXRzIG93biBmaWxlLgoKU2lnbmVkLW9mZi1ieTog
Q2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+ClJldmlld2VkLWJ5OiBNaWth
IEt1b3BwYWxhIDxtaWthLmt1b3BwYWxhQGxpbnV4LmludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9NYWtlZmlsZSAgICAgICAgICAgICAgICB8ICAxICsKIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV90aHJvdHRsZS5jIHwgNzMgKysrKysrKysrKysrKysrKysrKysK
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggICAgICAgICAgICAgIHwgIDYgLS0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgICAgICAgICAgICAgIHwgNTggLS0tLS0tLS0t
LS0tLS0tLQogNCBmaWxlcyBjaGFuZ2VkLCA3NCBpbnNlcnRpb25zKCspLCA2NCBkZWxldGlvbnMo
LSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
dGhyb3R0bGUuYwoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKaW5kZXggZTFlZDUyNmI5NmJmLi44MzU4OGU5
ODQwZjggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCkBAIC0xMDQsNiArMTA0LDcgQEAgZ2VtLXkgKz0g
XAogCWdlbS9pOTE1X2dlbV9zaG1lbS5vIFwKIAlnZW0vaTkxNV9nZW1fc2hyaW5rZXIubyBcCiAJ
Z2VtL2k5MTVfZ2VtX3N0b2xlbi5vIFwKKwlnZW0vaTkxNV9nZW1fdGhyb3R0bGUubyBcCiAJZ2Vt
L2k5MTVfZ2VtX3RpbGluZy5vIFwKIAlnZW0vaTkxNV9nZW1fdXNlcnB0ci5vIFwKIAlnZW0vaTkx
NV9nZW1fd2FpdC5vIFwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV90aHJvdHRsZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Rocm90
dGxlLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5hZGIzMDc0ZDlj
ZTIKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
dGhyb3R0bGUuYwpAQCAtMCwwICsxLDczIEBACisvKgorICogU1BEWC1MaWNlbnNlLUlkZW50aWZp
ZXI6IE1JVAorICoKKyAqIENvcHlyaWdodCDCqSAyMDE0LTIwMTYgSW50ZWwgQ29ycG9yYXRpb24K
KyAqLworCisjaW5jbHVkZSA8bGludXgvamlmZmllcy5oPgorCisjaW5jbHVkZSA8ZHJtL2RybV9m
aWxlLmg+CisKKyNpbmNsdWRlICJpOTE1X2Rydi5oIgorI2luY2x1ZGUgImk5MTVfZ2VtX2lvY3Rs
cy5oIgorI2luY2x1ZGUgImk5MTVfZ2VtX29iamVjdC5oIgorCisvKgorICogMjBtcyBpcyBhIGZh
aXJseSBhcmJpdHJhcnkgbGltaXQgKGdyZWF0ZXIgdGhhbiB0aGUgYXZlcmFnZSBmcmFtZSB0aW1l
KQorICogY2hvc2VuIHRvIHByZXZlbnQgdGhlIENQVSBnZXR0aW5nIG1vcmUgdGhhbiBhIGZyYW1l
IGFoZWFkIG9mIHRoZSBHUFUKKyAqICh3aGVuIHVzaW5nIGxheCB0aHJvdHRsaW5nIGZvciB0aGUg
ZnJvbnRidWZmZXIpLiBXZSBhbHNvIHVzZSBpdCB0bworICogb2ZmZXIgZnJlZSBHUFUgd2FpdGJv
b3N0cyBmb3Igc2V2ZXJlbHkgY29uZ2VzdGVkIHdvcmtsb2Fkcy4KKyAqLworI2RlZmluZSBEUk1f
STkxNV9USFJPVFRMRV9KSUZGSUVTIG1zZWNzX3RvX2ppZmZpZXMoMjApCisKKy8qCisgKiBUaHJv
dHRsZSBvdXIgcmVuZGVyaW5nIGJ5IHdhaXRpbmcgdW50aWwgdGhlIHJpbmcgaGFzIGNvbXBsZXRl
ZCBvdXIgcmVxdWVzdHMKKyAqIGVtaXR0ZWQgb3ZlciAyMCBtc2VjIGFnby4KKyAqCisgKiBOb3Rl
IHRoYXQgaWYgd2Ugd2VyZSB0byB1c2UgdGhlIGN1cnJlbnQgamlmZmllcyBlYWNoIHRpbWUgYXJv
dW5kIHRoZSBsb29wLAorICogd2Ugd291bGRuJ3QgZXNjYXBlIHRoZSBmdW5jdGlvbiB3aXRoIGFu
eSBmcmFtZXMgb3V0c3RhbmRpbmcgaWYgdGhlIHRpbWUgdG8KKyAqIHJlbmRlciBhIGZyYW1lIHdh
cyBvdmVyIDIwbXMuCisgKgorICogVGhpcyBzaG91bGQgZ2V0IHVzIHJlYXNvbmFibGUgcGFyYWxs
ZWxpc20gYmV0d2VlbiBDUFUgYW5kIEdQVSBidXQgYWxzbworICogcmVsYXRpdmVseSBsb3cgbGF0
ZW5jeSB3aGVuIGJsb2NraW5nIG9uIGEgcGFydGljdWxhciByZXF1ZXN0IHRvIGZpbmlzaC4KKyAq
LworaW50CitpOTE1X2dlbV90aHJvdHRsZV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2
b2lkICpkYXRhLAorCQkJc3RydWN0IGRybV9maWxlICpmaWxlKQoreworCXN0cnVjdCBkcm1faTkx
NV9maWxlX3ByaXZhdGUgKmZpbGVfcHJpdiA9IGZpbGUtPmRyaXZlcl9wcml2OworCXVuc2lnbmVk
IGxvbmcgcmVjZW50X2Vub3VnaCA9IGppZmZpZXMgLSBEUk1fSTkxNV9USFJPVFRMRV9KSUZGSUVT
OworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QsICp0YXJnZXQgPSBOVUxMOworCWxvbmcg
cmV0OworCisJLyogQUJJOiByZXR1cm4gLUVJTyBpZiBhbHJlYWR5IHdlZGdlZCAqLworCXJldCA9
IGk5MTVfdGVybWluYWxseV93ZWRnZWQodG9faTkxNShkZXYpKTsKKwlpZiAocmV0KQorCQlyZXR1
cm4gcmV0OworCisJc3Bpbl9sb2NrKCZmaWxlX3ByaXYtPm1tLmxvY2spOworCWxpc3RfZm9yX2Vh
Y2hfZW50cnkocmVxdWVzdCwgJmZpbGVfcHJpdi0+bW0ucmVxdWVzdF9saXN0LCBjbGllbnRfbGlu
aykgeworCQlpZiAodGltZV9hZnRlcl9lcShyZXF1ZXN0LT5lbWl0dGVkX2ppZmZpZXMsIHJlY2Vu
dF9lbm91Z2gpKQorCQkJYnJlYWs7CisKKwkJaWYgKHRhcmdldCkgeworCQkJbGlzdF9kZWwoJnRh
cmdldC0+Y2xpZW50X2xpbmspOworCQkJdGFyZ2V0LT5maWxlX3ByaXYgPSBOVUxMOworCQl9CisK
KwkJdGFyZ2V0ID0gcmVxdWVzdDsKKwl9CisJaWYgKHRhcmdldCkKKwkJaTkxNV9yZXF1ZXN0X2dl
dCh0YXJnZXQpOworCXNwaW5fdW5sb2NrKCZmaWxlX3ByaXYtPm1tLmxvY2spOworCisJaWYgKCF0
YXJnZXQpCisJCXJldHVybiAwOworCisJcmV0ID0gaTkxNV9yZXF1ZXN0X3dhaXQodGFyZ2V0LAor
CQkJCUk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFLAorCQkJCU1BWF9TQ0hFRFVMRV9USU1FT1VUKTsK
KwlpOTE1X3JlcXVlc3RfcHV0KHRhcmdldCk7CisKKwlyZXR1cm4gcmV0IDwgMCA/IHJldCA6IDA7
Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAppbmRleCA2NTJiNWVkZWZhYWUuLjRlYjhmNmExODFj
MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAorKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCkBAIC0yMTMsMTIgKzIxMyw2IEBAIHN0cnVjdCBk
cm1faTkxNV9maWxlX3ByaXZhdGUgewogCXN0cnVjdCB7CiAJCXNwaW5sb2NrX3QgbG9jazsKIAkJ
c3RydWN0IGxpc3RfaGVhZCByZXF1ZXN0X2xpc3Q7Ci0vKiAyMG1zIGlzIGEgZmFpcmx5IGFyYml0
cmFyeSBsaW1pdCAoZ3JlYXRlciB0aGFuIHRoZSBhdmVyYWdlIGZyYW1lIHRpbWUpCi0gKiBjaG9z
ZW4gdG8gcHJldmVudCB0aGUgQ1BVIGdldHRpbmcgbW9yZSB0aGFuIGEgZnJhbWUgYWhlYWQgb2Yg
dGhlIEdQVQotICogKHdoZW4gdXNpbmcgbGF4IHRocm90dGxpbmcgZm9yIHRoZSBmcm9udGJ1ZmZl
cikuIFdlIGFsc28gdXNlIGl0IHRvCi0gKiBvZmZlciBmcmVlIEdQVSB3YWl0Ym9vc3RzIGZvciBz
ZXZlcmVseSBjb25nZXN0ZWQgd29ya2xvYWRzLgotICovCi0jZGVmaW5lIERSTV9JOTE1X1RIUk9U
VExFX0pJRkZJRVMgbXNlY3NfdG9famlmZmllcygyMCkKIAl9IG1tOwogCiAJc3RydWN0IGlkciBj
b250ZXh0X2lkcjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IDZhZjQ0ODczNjAzMC4uZTVh
YWZiZWIxZDE5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTEwMTIsNTcgKzEwMTIsNiBA
QCBpbnQgaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKIAlyZXR1cm4gMDsKIH0KIAotLyogVGhyb3R0bGUgb3VyIHJlbmRlcmluZyBieSB3YWl0aW5n
IHVudGlsIHRoZSByaW5nIGhhcyBjb21wbGV0ZWQgb3VyIHJlcXVlc3RzCi0gKiBlbWl0dGVkIG92
ZXIgMjAgbXNlYyBhZ28uCi0gKgotICogTm90ZSB0aGF0IGlmIHdlIHdlcmUgdG8gdXNlIHRoZSBj
dXJyZW50IGppZmZpZXMgZWFjaCB0aW1lIGFyb3VuZCB0aGUgbG9vcCwKLSAqIHdlIHdvdWxkbid0
IGVzY2FwZSB0aGUgZnVuY3Rpb24gd2l0aCBhbnkgZnJhbWVzIG91dHN0YW5kaW5nIGlmIHRoZSB0
aW1lIHRvCi0gKiByZW5kZXIgYSBmcmFtZSB3YXMgb3ZlciAyMG1zLgotICoKLSAqIFRoaXMgc2hv
dWxkIGdldCB1cyByZWFzb25hYmxlIHBhcmFsbGVsaXNtIGJldHdlZW4gQ1BVIGFuZCBHUFUgYnV0
IGFsc28KLSAqIHJlbGF0aXZlbHkgbG93IGxhdGVuY3kgd2hlbiBibG9ja2luZyBvbiBhIHBhcnRp
Y3VsYXIgcmVxdWVzdCB0byBmaW5pc2guCi0gKi8KLXN0YXRpYyBpbnQKLWk5MTVfZ2VtX3Jpbmdf
dGhyb3R0bGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgc3RydWN0IGRybV9maWxlICpmaWxlKQot
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKLQlz
dHJ1Y3QgZHJtX2k5MTVfZmlsZV9wcml2YXRlICpmaWxlX3ByaXYgPSBmaWxlLT5kcml2ZXJfcHJp
djsKLQl1bnNpZ25lZCBsb25nIHJlY2VudF9lbm91Z2ggPSBqaWZmaWVzIC0gRFJNX0k5MTVfVEhS
T1RUTEVfSklGRklFUzsKLQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0LCAqdGFyZ2V0ID0g
TlVMTDsKLQlsb25nIHJldDsKLQotCS8qIEFCSTogcmV0dXJuIC1FSU8gaWYgYWxyZWFkeSB3ZWRn
ZWQgKi8KLQlyZXQgPSBpOTE1X3Rlcm1pbmFsbHlfd2VkZ2VkKGRldl9wcml2KTsKLQlpZiAocmV0
KQotCQlyZXR1cm4gcmV0OwotCi0Jc3Bpbl9sb2NrKCZmaWxlX3ByaXYtPm1tLmxvY2spOwotCWxp
c3RfZm9yX2VhY2hfZW50cnkocmVxdWVzdCwgJmZpbGVfcHJpdi0+bW0ucmVxdWVzdF9saXN0LCBj
bGllbnRfbGluaykgewotCQlpZiAodGltZV9hZnRlcl9lcShyZXF1ZXN0LT5lbWl0dGVkX2ppZmZp
ZXMsIHJlY2VudF9lbm91Z2gpKQotCQkJYnJlYWs7Ci0KLQkJaWYgKHRhcmdldCkgewotCQkJbGlz
dF9kZWwoJnRhcmdldC0+Y2xpZW50X2xpbmspOwotCQkJdGFyZ2V0LT5maWxlX3ByaXYgPSBOVUxM
OwotCQl9Ci0KLQkJdGFyZ2V0ID0gcmVxdWVzdDsKLQl9Ci0JaWYgKHRhcmdldCkKLQkJaTkxNV9y
ZXF1ZXN0X2dldCh0YXJnZXQpOwotCXNwaW5fdW5sb2NrKCZmaWxlX3ByaXYtPm1tLmxvY2spOwot
Ci0JaWYgKHRhcmdldCA9PSBOVUxMKQotCQlyZXR1cm4gMDsKLQotCXJldCA9IGk5MTVfcmVxdWVz
dF93YWl0KHRhcmdldCwKLQkJCQlJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSwKLQkJCQlNQVhfU0NI
RURVTEVfVElNRU9VVCk7Ci0JaTkxNV9yZXF1ZXN0X3B1dCh0YXJnZXQpOwotCi0JcmV0dXJuIHJl
dCA8IDAgPyByZXQgOiAwOwotfQotCiBzdHJ1Y3QgaTkxNV92bWEgKgogaTkxNV9nZW1fb2JqZWN0
X2dndHRfcGluKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCQkgY29uc3Qgc3Ry
dWN0IGk5MTVfZ2d0dF92aWV3ICp2aWV3LApAQCAtMTE0MiwxMyArMTA5MSw2IEBAIGk5MTVfZ2Vt
X29iamVjdF9nZ3R0X3BpbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCXJldHVy
biB2bWE7CiB9CiAKLWludAotaTkxNV9nZW1fdGhyb3R0bGVfaW9jdGwoc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwgdm9pZCAqZGF0YSwKLQkJCXN0cnVjdCBkcm1fZmlsZSAqZmlsZV9wcml2KQotewot
CXJldHVybiBpOTE1X2dlbV9yaW5nX3Rocm90dGxlKGRldiwgZmlsZV9wcml2KTsKLX0KLQogaW50
CiBpOTE1X2dlbV9tYWR2aXNlX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRh
dGEsCiAJCSAgICAgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdikKLS0gCjIuMjAuMQoKX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1h
aWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

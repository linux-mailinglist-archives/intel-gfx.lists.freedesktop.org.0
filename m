Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7D0301120E9
	for <lists+intel-gfx@lfdr.de>; Wed,  4 Dec 2019 02:10:34 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 852DA6E87F;
	Wed,  4 Dec 2019 01:10:32 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9B8BD6E87F
 for <intel-gfx@lists.freedesktop.org>; Wed,  4 Dec 2019 01:10:31 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by fmsmga104.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 03 Dec 2019 17:10:31 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,275,1571727600"; d="scan'208";a="208685331"
Received: from josouza-mobl.jf.intel.com (HELO josouza-MOBL.intel.com)
 ([10.98.40.67])
 by fmsmga007.fm.intel.com with ESMTP; 03 Dec 2019 17:10:31 -0800
From: =?UTF-8?q?Jos=C3=A9=20Roberto=20de=20Souza?= <jose.souza@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue,  3 Dec 2019 17:10:27 -0800
Message-Id: <20191204011028.227377-1-jose.souza@intel.com>
X-Mailer: git-send-email 2.24.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v4 1/2] drm/i915/display/icl+: Do not program
 clockgating
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Jani Nikula <jani.nikula@intel.com>,
 Lucas De Marchi <lucas.demarchi@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGFsa2VkIHdpdGggSFcgdGVhbSBhbmQgdGhpcyBpcyBhIGxlZnQgb3ZlciwgZHJpdmVyIHNob3Vs
ZCBub3QKcHJvZ3JhbSBjbG9ja2dhdGluZywgbWcgb3IgZGVrZWwgZmlybXdhcmUgaXMgcmVwb25z
aWJsZSBmb3IgYW55CmNsb2NrZ2F0aW5nIHByb2dyYW1pbmcuCgpBbHNvIHJlbW92aW5nIHRoZSBy
ZWdpc3RlciBhbmQgYml0cyBkZWZpbml0aW9uIHJlbGF0ZWQgdG8gY2xvY2tnYXRpbmcuCgp2MjoK
QWRkZWQgV0FSTl9PTgoKdjM6Ck9ubHkgY2FsbGluZyBpY2xfcGh5X3NldF9jbG9ja19nYXRpbmco
KSBvbiBpbnRlbF9kZGlfcHJlX2VuYWJsZV9oZG1pCmZvciBHRU4xMQoKdjQ6CklDTCBzaG91bGQg
YWxzbyBub3QgcHJvZ3JhbSBjbG9ja2dhdGluZyAodGhhbmtzIE1hdHQgZm9yIGNhdGNoaW5nCnRo
aXMpCgpCU3BlYyBpc3N1ZTogMjA4ODUKQlNwZWM6IDQ5MjkyCkJTcGVjOiAyMTczNQpDYzogTHVj
YXMgRGUgTWFyY2hpIDxsdWNhcy5kZW1hcmNoaUBpbnRlbC5jb20+CkNjOiBNYXR0IFJvcGVyIDxt
YXR0aGV3LmQucm9wZXJAaW50ZWwuY29tPgpDYzogSmFuaSBOaWt1bGEgPGphbmkubmlrdWxhQGlu
dGVsLmNvbT4KUmV2aWV3ZWQtYnk6IE1hdHQgUm9wZXIgPG1hdHRoZXcuZC5yb3BlckBpbnRlbC5j
b20+ClNpZ25lZC1vZmYtYnk6IEpvc8OpIFJvYmVydG8gZGUgU291emEgPGpvc2Uuc291emFAaW50
ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMgfCA3
MiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVn
LmggICAgICAgICAgfCAyMCAtLS0tLS0tCiAyIGZpbGVzIGNoYW5nZWQsIDkyIGRlbGV0aW9ucygt
KQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCmluZGV4IGViY2M3MzAy
NzA2Yi4uMDE5YjEwNWRkMDk0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2RkaS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGRpLmMKQEAgLTMxNTksNTcgKzMxNTksNiBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kZGlfY2xrX2Rp
c2FibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiAJfQogfQogCi1zdGF0aWMgdm9p
ZAotaWNsX3BoeV9zZXRfY2xvY2tfZ2F0aW5nKHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRp
Z19wb3J0LCBib29sIGVuYWJsZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGRpZ19wb3J0LT5iYXNlLmJhc2UuZGV2KTsKLQllbnVtIHRjX3BvcnQgdGNf
cG9ydCA9IGludGVsX3BvcnRfdG9fdGMoZGV2X3ByaXYsIGRpZ19wb3J0LT5iYXNlLnBvcnQpOwot
CXUzMiB2YWwsIGJpdHM7Ci0JaW50IGxuOwotCi0JaWYgKHRjX3BvcnQgPT0gUE9SVF9UQ19OT05F
KQotCQlyZXR1cm47Ci0KLQliaXRzID0gTUdfRFBfTU9ERV9DRkdfVFIyUFdSX0dBVElORyB8IE1H
X0RQX01PREVfQ0ZHX1RSUFdSX0dBVElORyB8Ci0JICAgICAgIE1HX0RQX01PREVfQ0ZHX0NMTlBX
Ul9HQVRJTkcgfCBNR19EUF9NT0RFX0NGR19ESUdQV1JfR0FUSU5HIHwKLQkgICAgICAgTUdfRFBf
TU9ERV9DRkdfR0FPTlBXUl9HQVRJTkc7Ci0KLQlmb3IgKGxuID0gMDsgbG4gPCAyOyBsbisrKSB7
Ci0JCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKSB7Ci0JCQlJOTE1X1dSSVRFKEhJUF9J
TkRFWF9SRUcodGNfcG9ydCksIEhJUF9JTkRFWF9WQUwodGNfcG9ydCwgbG4pKTsKLQkJCXZhbCA9
IEk5MTVfUkVBRChES0xfRFBfTU9ERSh0Y19wb3J0KSk7Ci0JCX0gZWxzZSB7Ci0JCQl2YWwgPSBJ
OTE1X1JFQUQoTUdfRFBfTU9ERShsbiwgdGNfcG9ydCkpOwotCQl9Ci0KLQkJaWYgKGVuYWJsZSkK
LQkJCXZhbCB8PSBiaXRzOwotCQllbHNlCi0JCQl2YWwgJj0gfmJpdHM7Ci0KLQkJaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPj0gMTIpCi0JCQlJOTE1X1dSSVRFKERLTF9EUF9NT0RFKHRjX3BvcnQp
LCB2YWwpOwotCQllbHNlCi0JCQlJOTE1X1dSSVRFKE1HX0RQX01PREUobG4sIHRjX3BvcnQpLCB2
YWwpOwotCX0KLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID09IDExKSB7Ci0JCWJpdHMgPSBN
R19NSVNDX1NVUzBfQ0ZHX1RSMlBXUl9HQVRJTkcgfAotCQkgICAgICAgTUdfTUlTQ19TVVMwX0NG
R19DTDJQV1JfR0FUSU5HIHwKLQkJICAgICAgIE1HX01JU0NfU1VTMF9DRkdfR0FPTlBXUl9HQVRJ
TkcgfAotCQkgICAgICAgTUdfTUlTQ19TVVMwX0NGR19UUlBXUl9HQVRJTkcgfAotCQkgICAgICAg
TUdfTUlTQ19TVVMwX0NGR19DTDFQV1JfR0FUSU5HIHwKLQkJICAgICAgIE1HX01JU0NfU1VTMF9D
RkdfREdQV1JfR0FUSU5HOwotCi0JCXZhbCA9IEk5MTVfUkVBRChNR19NSVNDX1NVUzAodGNfcG9y
dCkpOwotCQlpZiAoZW5hYmxlKQotCQkJdmFsIHw9IChiaXRzIHwgTUdfTUlTQ19TVVMwX1NVU0NM
S19EWU5DTEtHQVRFX01PREUoMykpOwotCQllbHNlCi0JCQl2YWwgJj0gfihiaXRzIHwgTUdfTUlT
Q19TVVMwX1NVU0NMS19EWU5DTEtHQVRFX01PREVfTUFTSyk7Ci0JCUk5MTVfV1JJVEUoTUdfTUlT
Q19TVVMwKHRjX3BvcnQpLCB2YWwpOwotCX0KLX0KLQogc3RhdGljIHZvaWQKIGljbF9wcm9ncmFt
X21nX2RwX21vZGUoc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQsCiAJ
CSAgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKQEAgLTM1
MDgsMTIgKzM0NTcsNiBAQCBzdGF0aWMgdm9pZCB0Z2xfZGRpX3ByZV9lbmFibGVfZHAoc3RydWN0
IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJICogZG93biB0aGlzIGZ1bmN0aW9uLgogCSAqLwog
Ci0JLyoKLQkgKiA3LmQgVHlwZSBDIHdpdGggRFAgYWx0ZXJuYXRlIG9yIGZpeGVkL2xlZ2FjeS9z
dGF0aWMgY29ubmVjdGlvbiAtCi0JICogRGlzYWJsZSBQSFkgY2xvY2sgZ2F0aW5nIHBlciBUeXBl
LUMgRERJIEJ1ZmZlciBwYWdlCi0JICovCi0JaWNsX3BoeV9zZXRfY2xvY2tfZ2F0aW5nKGRpZ19w
b3J0LCBmYWxzZSk7Ci0KIAkvKiA3LmUgQ29uZmlndXJlIHZvbHRhZ2Ugc3dpbmcgYW5kIHJlbGF0
ZWQgSU8gc2V0dGluZ3MgKi8KIAl0Z2xfZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBjcnRj
X3N0YXRlLT5wb3J0X2Nsb2NrLCBsZXZlbCwKIAkJCQllbmNvZGVyLT50eXBlKTsKQEAgLTM1NjUs
MTUgKzM1MDgsNiBAQCBzdGF0aWMgdm9pZCB0Z2xfZGRpX3ByZV9lbmFibGVfZHAoc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXIsCiAJaWYgKCFpc190cmFuc19wb3J0X3N5bmNfbW9kZShjcnRj
X3N0YXRlKSkKIAkJaW50ZWxfZHBfc3RvcF9saW5rX3RyYWluKGludGVsX2RwKTsKIAotCS8qCi0J
ICogVE9ETzogZW5hYmxlIGNsb2NrIGdhdGluZwotCSAqCi0JICogSXQgaXMgbm90IHdyaXR0ZW4g
aW4gRFAgZW5hYmxpbmcgc2VxdWVuY2UgYnV0ICJQSFkgQ2xvY2tnYXRpbmcKLQkgKiBwcm9ncmFt
bWluZyIgc3RhdGVzIHRoYXQgY2xvY2sgZ2F0aW5nIHNob3VsZCBiZSBlbmFibGVkIGFmdGVyIHRo
ZQotCSAqIGxpbmsgdHJhaW5pbmcgYnV0IGRvaW5nIHNvIGNhdXNlcyBhbGwgdGhlIGZvbGxvd2lu
ZyB0cmFpbmluZ3MgdG8gZmFpbAotCSAqIHNvIG5vdCBlbmFibGluZyBpdCBmb3Igbm93LgotCSAq
LwotCiAJLyogNy5sIENvbmZpZ3VyZSBhbmQgZW5hYmxlIEZFQyBpZiBuZWVkZWQgKi8KIAlpbnRl
bF9kZGlfZW5hYmxlX2ZlYyhlbmNvZGVyLCBjcnRjX3N0YXRlKTsKIAlpbnRlbF9kc2NfZW5hYmxl
KGVuY29kZXIsIGNydGNfc3RhdGUpOwpAQCAtMzYwOSw3ICszNTQzLDYgQEAgc3RhdGljIHZvaWQg
aHN3X2RkaV9wcmVfZW5hYmxlX2RwKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkJ
CQlkaWdfcG9ydC0+ZGRpX2lvX3Bvd2VyX2RvbWFpbik7CiAKIAlpY2xfcHJvZ3JhbV9tZ19kcF9t
b2RlKGRpZ19wb3J0LCBjcnRjX3N0YXRlKTsKLQlpY2xfcGh5X3NldF9jbG9ja19nYXRpbmcoZGln
X3BvcnQsIGZhbHNlKTsKIAogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQogCQlpY2xf
ZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBjcnRjX3N0YXRlLT5wb3J0X2Nsb2NrLApAQCAt
MzY0Myw4ICszNTc2LDYgQEAgc3RhdGljIHZvaWQgaHN3X2RkaV9wcmVfZW5hYmxlX2RwKHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCiAJaW50ZWxfZGRpX2VuYWJsZV9mZWMoZW5jb2Rl
ciwgY3J0Y19zdGF0ZSk7CiAKLQlpY2xfcGh5X3NldF9jbG9ja19nYXRpbmcoZGlnX3BvcnQsIHRy
dWUpOwotCiAJaWYgKCFpc19tc3QpCiAJCWludGVsX2RkaV9lbmFibGVfcGlwZV9jbG9jayhjcnRj
X3N0YXRlKTsKIApAQCAtMzY4Niw3ICszNjE3LDYgQEAgc3RhdGljIHZvaWQgaW50ZWxfZGRpX3By
ZV9lbmFibGVfaGRtaShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlpbnRlbF9kaXNw
bGF5X3Bvd2VyX2dldChkZXZfcHJpdiwgZGlnX3BvcnQtPmRkaV9pb19wb3dlcl9kb21haW4pOwog
CiAJaWNsX3Byb2dyYW1fbWdfZHBfbW9kZShkaWdfcG9ydCwgY3J0Y19zdGF0ZSk7Ci0JaWNsX3Bo
eV9zZXRfY2xvY2tfZ2F0aW5nKGRpZ19wb3J0LCBmYWxzZSk7CiAKIAlpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA+PSAxMikKIAkJdGdsX2RkaV92c3dpbmdfc2VxdWVuY2UoZW5jb2RlciwgY3J0Y19z
dGF0ZS0+cG9ydF9jbG9jaywKQEAgLTM3MDEsOCArMzYzMSw2IEBAIHN0YXRpYyB2b2lkIGludGVs
X2RkaV9wcmVfZW5hYmxlX2hkbWkoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJZWxz
ZQogCQlpbnRlbF9wcmVwYXJlX2hkbWlfZGRpX2J1ZmZlcnMoZW5jb2RlciwgbGV2ZWwpOwogCi0J
aWNsX3BoeV9zZXRfY2xvY2tfZ2F0aW5nKGRpZ19wb3J0LCB0cnVlKTsKLQogCWlmIChJU19HRU45
X0JDKGRldl9wcml2KSkKIAkJc2tsX2RkaV9zZXRfaWJvb3N0KGVuY29kZXIsIGxldmVsLCBJTlRF
TF9PVVRQVVRfSERNSSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
cmVnLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oCmluZGV4IDFhNjM3NmE5N2Q0
OC4uMDMwNWU3NmVlYmY2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Jl
Zy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmgKQEAgLTIyNDQsMjYgKzIy
NDQsNiBAQCBzdGF0aWMgaW5saW5lIGJvb2wgaTkxNV9tbWlvX3JlZ192YWxpZChpOTE1X3JlZ190
IHJlZykKIAkJCQkgICAgTUdfRFBfTU9ERV9MTjFfQUNVX1BPUlQxKQogI2RlZmluZSAgIE1HX0RQ
X01PREVfQ0ZHX0RQX1gyX01PREUJCQkoMSA8PCA3KQogI2RlZmluZSAgIE1HX0RQX01PREVfQ0ZH
X0RQX1gxX01PREUJCQkoMSA8PCA2KQotI2RlZmluZSAgIE1HX0RQX01PREVfQ0ZHX1RSMlBXUl9H
QVRJTkcJCQkoMSA8PCA1KQotI2RlZmluZSAgIE1HX0RQX01PREVfQ0ZHX1RSUFdSX0dBVElORwkJ
CSgxIDw8IDQpCi0jZGVmaW5lICAgTUdfRFBfTU9ERV9DRkdfQ0xOUFdSX0dBVElORwkJCSgxIDw8
IDMpCi0jZGVmaW5lICAgTUdfRFBfTU9ERV9DRkdfRElHUFdSX0dBVElORwkJCSgxIDw8IDIpCi0j
ZGVmaW5lICAgTUdfRFBfTU9ERV9DRkdfR0FPTlBXUl9HQVRJTkcJCQkoMSA8PCAxKQotCi0jZGVm
aW5lIE1HX01JU0NfU1VTMF9QT1JUMQkJCQkweDE2ODgxNAotI2RlZmluZSBNR19NSVNDX1NVUzBf
UE9SVDIJCQkJMHgxNjk4MTQKLSNkZWZpbmUgTUdfTUlTQ19TVVMwX1BPUlQzCQkJCTB4MTZBODE0
Ci0jZGVmaW5lIE1HX01JU0NfU1VTMF9QT1JUNAkJCQkweDE2QjgxNAotI2RlZmluZSBNR19NSVND
X1NVUzAodGNfcG9ydCkgXAotCV9NTUlPKF9QT1JUKHRjX3BvcnQsIE1HX01JU0NfU1VTMF9QT1JU
MSwgTUdfTUlTQ19TVVMwX1BPUlQyKSkKLSNkZWZpbmUgICBNR19NSVNDX1NVUzBfU1VTQ0xLX0RZ
TkNMS0dBVEVfTU9ERV9NQVNLCSgzIDw8IDE0KQotI2RlZmluZSAgIE1HX01JU0NfU1VTMF9TVVND
TEtfRFlOQ0xLR0FURV9NT0RFKHgpCSgoeCkgPDwgMTQpCi0jZGVmaW5lICAgTUdfTUlTQ19TVVMw
X0NGR19UUjJQV1JfR0FUSU5HCQkoMSA8PCAxMikKLSNkZWZpbmUgICBNR19NSVNDX1NVUzBfQ0ZH
X0NMMlBXUl9HQVRJTkcJCSgxIDw8IDExKQotI2RlZmluZSAgIE1HX01JU0NfU1VTMF9DRkdfR0FP
TlBXUl9HQVRJTkcJCSgxIDw8IDEwKQotI2RlZmluZSAgIE1HX01JU0NfU1VTMF9DRkdfVFJQV1Jf
R0FUSU5HCQkJKDEgPDwgNykKLSNkZWZpbmUgICBNR19NSVNDX1NVUzBfQ0ZHX0NMMVBXUl9HQVRJ
TkcJCSgxIDw8IDYpCi0jZGVmaW5lICAgTUdfTUlTQ19TVVMwX0NGR19ER1BXUl9HQVRJTkcJCQko
MSA8PCA1KQogCiAvKiBUaGUgc3BlYyBkZWZpbmVzIHRoaXMgb25seSBmb3IgQlhUIFBIWTAsIGJ1
dCBsZXRzIGFzc3VtZSB0aGF0IHRoaXMKICAqIHdvdWxkIGV4aXN0IGZvciBQSFkxIHRvbyBpZiBp
dCBoYWQgYSBzZWNvbmQgY2hhbm5lbC4KLS0gCjIuMjQuMAoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1n
ZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21h
aWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

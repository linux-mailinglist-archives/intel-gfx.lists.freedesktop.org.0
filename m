Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 010D4CBC61
	for <lists+intel-gfx@lfdr.de>; Fri,  4 Oct 2019 15:58:19 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7DFCB6EB97;
	Fri,  4 Oct 2019 13:58:16 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 011F76EB97
 for <intel-gfx@lists.freedesktop.org>; Fri,  4 Oct 2019 13:58:14 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18723969-1500050 
 for multiple; Fri, 04 Oct 2019 14:40:21 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  4 Oct 2019 14:40:14 +0100
Message-Id: <20191004134015.13204-20-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191004134015.13204-1-chris@chris-wilson.co.uk>
References: <20191004134015.13204-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 19/20] drm/i915/selftests: Drop vestigal
 struct_mutex guards
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2Ugbm8gbG9uZ2VyIG5lZWQgc3RydWN0X211dGV4IHRvIHNlcmlhbGlzZSByZXF1ZXN0IGVtaXNz
aW9uLCBzbyByZW1vdmUKaXQgZnJvbSB0aGUgZ3Qgc2VsZnRlc3RzLgoKU2lnbmVkLW9mZi1ieTog
Q2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+ClJldmlld2VkLWJ5OiBUdnJ0
a28gVXJzdWxpbiA8dHZydGtvLnVyc3VsaW5AaW50ZWwuY29tPgotLS0KIC4uLi9ncHUvZHJtL2k5
MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMgICB8ICAxNSArLQogLi4uL2RybS9pOTE1L2dl
bS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jIHwgICA0IC0KIC4uLi9kcm0vaTkxNS9nZW0v
c2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYyAgICB8ICAgMiAtCiAuLi4vZHJtL2k5MTUvZ2VtL3Nl
bGZ0ZXN0cy9pOTE1X2dlbV9waHlzLmMgICAgfCAgIDIgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Qvc2VsZnRlc3RfbHJjLmMgICAgICAgIHwgMTQ4ICsrKy0tLS0tLS0tLS0tLS0tLQogLi4uL2dw
dS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jICAgIHwgIDExICstCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC91Yy9zZWxmdGVzdF9ndWMuYyAgICAgfCAgIDQgLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2d0dC5jIHwgICAyIC0KIDggZmlsZXMgY2hh
bmdlZCwgMjcgaW5zZXJ0aW9ucygrKSwgMTYxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMKaW5kZXggMzMxNDg1OGYzMDQ2
Li5lNDJhYmRkZDRhMzYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxm
dGVzdHMvaHVnZV9wYWdlcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVz
dHMvaHVnZV9wYWdlcy5jCkBAIC0xNjM5LDcgKzE2MzksNiBAQCBpbnQgaTkxNV9nZW1faHVnZV9w
YWdlX21vY2tfc2VsZnRlc3RzKHZvaWQpCiAJbWt3cml0ZV9kZXZpY2VfaW5mbyhkZXZfcHJpdikt
PnBwZ3R0X3R5cGUgPSBJTlRFTF9QUEdUVF9GVUxMOwogCW1rd3JpdGVfZGV2aWNlX2luZm8oZGV2
X3ByaXYpLT5wcGd0dF9zaXplID0gNDg7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0
cnVjdF9tdXRleCk7CiAJcHBndHQgPSBpOTE1X3BwZ3R0X2NyZWF0ZShkZXZfcHJpdik7CiAJaWYg
KElTX0VSUihwcGd0dCkpIHsKIAkJZXJyID0gUFRSX0VSUihwcGd0dCk7CkBAIC0xNjY1LDkgKzE2
NjQsNyBAQCBpbnQgaTkxNV9nZW1faHVnZV9wYWdlX21vY2tfc2VsZnRlc3RzKHZvaWQpCiAJaTkx
NV92bV9wdXQoJnBwZ3R0LT52bSk7CiAKIG91dF91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZkZXZf
cHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJZHJtX2Rldl9wdXQoJmRldl9wcml2LT5kcm0pOwot
CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMTY4NCw3ICsxNjgxLDYgQEAgaW50IGk5MTVfZ2VtX2h1
Z2VfcGFnZV9saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAlz
dHJ1Y3QgZHJtX2ZpbGUgKmZpbGU7CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKIAlz
dHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsK
IAlpbnQgZXJyOwogCiAJaWYgKCFIQVNfUFBHVFQoaTkxNSkpIHsKQEAgLTE2OTksMTMgKzE2OTUs
MTAgQEAgaW50IGk5MTVfZ2VtX2h1Z2VfcGFnZV9saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIAlpZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRSX0VSUihm
aWxlKTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCXdha2VyZWYg
PSBpbnRlbF9ydW50aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7Ci0KIAljdHggPSBsaXZl
X2NvbnRleHQoaTkxNSwgZmlsZSk7CiAJaWYgKElTX0VSUihjdHgpKSB7CiAJCWVyciA9IFBUUl9F
UlIoY3R4KTsKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3RvIG91dF9maWxlOwogCX0KIAogCW11
dGV4X2xvY2soJmN0eC0+bXV0ZXgpOwpAQCAtMTcxNiwxMSArMTcwOSw3IEBAIGludCBpOTE1X2dl
bV9odWdlX3BhZ2VfbGl2ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
CiAKIAllcnIgPSBpOTE1X3N1YnRlc3RzKHRlc3RzLCBjdHgpOwogCi1vdXRfdW5sb2NrOgotCWlu
dGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91
bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCitvdXRfZmlsZToKIAltb2NrX2ZpbGVf
ZnJlZShpOTE1LCBmaWxlKTsKLQogCXJldHVybiBlcnI7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCmluZGV4IGQ0NGZh
OWQzNTZmMS4uZmI1OGMwOTE5ZWExIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYwpAQCAtMzA3LDkgKzMwNyw3IEBAIHN0
YXRpYyBpbnQgbGl2ZV9wYXJhbGxlbF9zd2l0Y2godm9pZCAqYXJnKQogCQlzdHJ1Y3QgaWd0X2xp
dmVfdGVzdCB0OwogCQlpbnQgbjsKIAotCQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKIAkJZXJyID0gaWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgaTkxNSwgX19mdW5jX18sICIi
KTsKLQkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJaWYgKGVycikK
IAkJCWJyZWFrOwogCkBAIC0zNDEsMTAgKzMzOSw4IEBAIHN0YXRpYyBpbnQgbGl2ZV9wYXJhbGxl
bF9zd2l0Y2godm9pZCAqYXJnKQogCQkJZGF0YVtuXS50c2sgPSBOVUxMOwogCQl9CiAKLQkJbXV0
ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWlmIChpZ3RfbGl2ZV90ZXN0X2Vu
ZCgmdCkpCiAJCQllcnIgPSAtRUlPOwotCQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCX0KIAogb3V0OgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL2k5MTVfZ2VtX21tYW4uYwppbmRleCAxY2QyNWNmZDAyNDYuLmNmYTUyYzUyNTY5MSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9t
bWFuLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9t
bWFuLmMKQEAgLTY2OSw5ICs2NjksNyBAQCBzdGF0aWMgaW50IGlndF9tbWFwX29mZnNldF9leGhh
dXN0aW9uKHZvaWQgKmFyZykKIAkJCWdvdG8gb3V0OwogCQl9CiAKLQkJbXV0ZXhfbG9jaygmaTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWVyciA9IG1ha2Vfb2JqX2J1c3kob2JqKTsKLQkJbXV0
ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJaWYgKGVycikgewogCQkJcHJf
ZXJyKCJbbG9vcCAlZF0gRmFpbGVkIHRvIGJ1c3kgdGhlIG9iamVjdFxuIiwgbG9vcCk7CiAJCQln
b3RvIGVycl9vYmo7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRl
c3RzL2k5MTVfZ2VtX3BoeXMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMv
aTkxNV9nZW1fcGh5cy5jCmluZGV4IDk0YTE1ZTNmNmRiOC4uMzQ5MzI4NzFiM2E1IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX3BoeXMuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX3BoeXMuYwpA
QCAtMjUsOSArMjUsNyBAQCBzdGF0aWMgaW50IG1vY2tfcGh5c19vYmplY3Qodm9pZCAqYXJnKQog
CQlnb3RvIG91dDsKIAl9CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
IAllcnIgPSBpOTE1X2dlbV9vYmplY3RfYXR0YWNoX3BoeXMob2JqLCBQQUdFX1NJWkUpOwotCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKGVycikgewogCQlwcl9l
cnIoImk5MTVfZ2VtX29iamVjdF9hdHRhY2hfcGh5cyBmYWlsZWQsIGVycj0lZFxuIiwgZXJyKTsK
IAkJZ290byBvdXRfb2JqOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwppbmRl
eCA4ZGM0MmM1Yzc1NjkuLjM5M2FlNTMyMWUxZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfbHJjLmMKQEAgLTI2LDE3ICsyNiwxMyBAQCBzdGF0aWMgaW50IGxpdmVfc2FuaXR5Y2hl
Y2sodm9pZCAqYXJnKQogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CiAJc3RydWN0IGlu
dGVsX2NvbnRleHQgKmNlOwogCXN0cnVjdCBpZ3Rfc3Bpbm5lciBzcGluOwotCWludGVsX3dha2Vy
ZWZfdCB3YWtlcmVmOwogCWludCBlcnIgPSAtRU5PTUVNOwogCiAJaWYgKCFIQVNfTE9HSUNBTF9S
SU5HX0NPTlRFWFRTKGk5MTUpKQogCQlyZXR1cm4gMDsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwotCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldCgmaTkxNS0+
cnVudGltZV9wbSk7Ci0KIAlpZiAoaWd0X3NwaW5uZXJfaW5pdCgmc3BpbiwgJmk5MTUtPmd0KSkK
LQkJZ290byBlcnJfdW5sb2NrOworCQlyZXR1cm4gLUVOT01FTTsKIAogCWN0eCA9IGtlcm5lbF9j
b250ZXh0KGk5MTUpOwogCWlmICghY3R4KQpAQCAtNzMsOSArNjksNiBAQCBzdGF0aWMgaW50IGxp
dmVfc2FuaXR5Y2hlY2sodm9pZCAqYXJnKQogCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7CiBl
cnJfc3BpbjoKIAlpZ3Rfc3Bpbm5lcl9maW5pKCZzcGluKTsKLWVycl91bmxvY2s6Ci0JaW50ZWxf
cnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4X3VubG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtNDAyLDcg
KzM5NSw2IEBAIHN0YXRpYyBpbnQgbGl2ZV90aW1lc2xpY2VfcHJlZW1wdCh2b2lkICphcmcpCiB7
CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CiAJc3RydWN0IGRybV9pOTE1
X2dlbV9vYmplY3QgKm9iajsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAlzdHJ1Y3QgaTkx
NV92bWEgKnZtYTsKIAl2b2lkICp2YWRkcjsKIAlpbnQgZXJyID0gMDsKQEAgLTQxNywxNCArNDA5
LDkgQEAgc3RhdGljIGludCBsaXZlX3RpbWVzbGljZV9wcmVlbXB0KHZvaWQgKmFyZykKIAkgKiBy
ZWFkeSB0YXNrLgogCSAqLwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKLQog
CW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoaTkxNSwgUEFHRV9TSVpFKTsK
LQlpZiAoSVNfRVJSKG9iaikpIHsKLQkJZXJyID0gUFRSX0VSUihvYmopOwotCQlnb3RvIGVycl91
bmxvY2s7Ci0JfQorCWlmIChJU19FUlIob2JqKSkKKwkJcmV0dXJuIFBUUl9FUlIob2JqKTsKIAog
CXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgJmk5MTUtPmdndHQudm0sIE5VTEwpOwogCWlm
IChJU19FUlIodm1hKSkgewpAQCAtNDY5LDEwICs0NTYsNiBAQCBzdGF0aWMgaW50IGxpdmVfdGlt
ZXNsaWNlX3ByZWVtcHQodm9pZCAqYXJnKQogCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAob2Jq
KTsKIGVycl9vYmo6CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwotZXJyX3VubG9jazoKLQlp
bnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhf
dW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCXJldHVybiBlcnI7CiB9CiAKQEAg
LTQ4NCw3ICs0NjcsNiBAQCBzdGF0aWMgaW50IGxpdmVfYnVzeXdhaXRfcHJlZW1wdCh2b2lkICph
cmcpCiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKIAlzdHJ1Y3QgaTkxNV92bWEg
KnZtYTsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJl
ZjsKIAlpbnQgZXJyID0gLUVOT01FTTsKIAl1MzIgKm1hcDsKIApAQCAtNDkzLDEyICs0NzUsOSBA
QCBzdGF0aWMgaW50IGxpdmVfYnVzeXdhaXRfcHJlZW1wdCh2b2lkICphcmcpCiAJICogcHJlZW1w
dCB0aGUgYnVzeXdhaXRzIHVzZWQgdG8gc3luY2hyb25pc2UgYmV0d2VlbiByaW5ncy4KIAkgKi8K
IAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCXdha2VyZWYgPSBpbnRl
bF9ydW50aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7Ci0KIAljdHhfaGkgPSBrZXJuZWxf
Y29udGV4dChpOTE1KTsKIAlpZiAoIWN0eF9oaSkKLQkJZ290byBlcnJfdW5sb2NrOworCQlyZXR1
cm4gLUVOT01FTTsKIAljdHhfaGktPnNjaGVkLnByaW9yaXR5ID0KIAkJSTkxNV9VU0VSX1BSSU9S
SVRZKEk5MTVfQ09OVEVYVF9NQVhfVVNFUl9QUklPUklUWSk7CiAKQEAgLTY1Miw5ICs2MzEsNiBA
QCBzdGF0aWMgaW50IGxpdmVfYnVzeXdhaXRfcHJlZW1wdCh2b2lkICphcmcpCiAJa2VybmVsX2Nv
bnRleHRfY2xvc2UoY3R4X2xvKTsKIGVycl9jdHhfaGk6CiAJa2VybmVsX2NvbnRleHRfY2xvc2Uo
Y3R4X2hpKTsKLWVycl91bmxvY2s6Ci0JaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRp
bWVfcG0sIHdha2VyZWYpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtNjgzLDcgKzY1OSw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9w
cmVlbXB0KHZvaWQgKmFyZykKIAlzdHJ1Y3QgaWd0X3NwaW5uZXIgc3Bpbl9oaSwgc3Bpbl9sbzsK
IAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQg
aWQ7Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJaW50IGVyciA9IC1FTk9NRU07CiAKIAlp
ZiAoIUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1QVElPTihpOTE1KSkKQEAgLTY5MiwxMSArNjY3LDgg
QEAgc3RhdGljIGludCBsaXZlX3ByZWVtcHQodm9pZCAqYXJnKQogCWlmICghKGk5MTUtPmNhcHMu
c2NoZWR1bGVyICYgSTkxNV9TQ0hFRFVMRVJfQ0FQX1BSRUVNUFRJT04pKQogCQlwcl9lcnIoIkxv
Z2ljYWwgcHJlZW1wdGlvbiBzdXBwb3J0ZWQsIGJ1dCBub3QgZXhwb3NlZFxuIik7CiAKLQltdXRl
eF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVudGlt
ZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCiAJaWYgKGlndF9zcGlubmVyX2luaXQoJnNw
aW5faGksICZpOTE1LT5ndCkpCi0JCWdvdG8gZXJyX3VubG9jazsKKwkJcmV0dXJuIC1FTk9NRU07
CiAKIAlpZiAoaWd0X3NwaW5uZXJfaW5pdCgmc3Bpbl9sbywgJmk5MTUtPmd0KSkKIAkJZ290byBl
cnJfc3Bpbl9oaTsKQEAgLTc3Niw5ICs3NDgsNiBAQCBzdGF0aWMgaW50IGxpdmVfcHJlZW1wdCh2
b2lkICphcmcpCiAJaWd0X3NwaW5uZXJfZmluaSgmc3Bpbl9sbyk7CiBlcnJfc3Bpbl9oaToKIAlp
Z3Rfc3Bpbm5lcl9maW5pKCZzcGluX2hpKTsKLWVycl91bmxvY2s6Ci0JaW50ZWxfcnVudGltZV9w
bV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4X3VubG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtNzkwLDE3ICs3NTksMTMg
QEAgc3RhdGljIGludCBsaXZlX2xhdGVfcHJlZW1wdCh2b2lkICphcmcpCiAJc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lOwogCXN0cnVjdCBpOTE1X3NjaGVkX2F0dHIgYXR0ciA9IHt9Owog
CWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwotCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCWlu
dCBlcnIgPSAtRU5PTUVNOwogCiAJaWYgKCFIQVNfTE9HSUNBTF9SSU5HX1BSRUVNUFRJT04oaTkx
NSkpCiAJCXJldHVybiAwOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKLQog
CWlmIChpZ3Rfc3Bpbm5lcl9pbml0KCZzcGluX2hpLCAmaTkxNS0+Z3QpKQotCQlnb3RvIGVycl91
bmxvY2s7CisJCXJldHVybiAtRU5PTUVNOwogCiAJaWYgKGlndF9zcGlubmVyX2luaXQoJnNwaW5f
bG8sICZpOTE1LT5ndCkpCiAJCWdvdG8gZXJyX3NwaW5faGk7CkBAIC04ODIsOSArODQ3LDYgQEAg
c3RhdGljIGludCBsaXZlX2xhdGVfcHJlZW1wdCh2b2lkICphcmcpCiAJaWd0X3NwaW5uZXJfZmlu
aSgmc3Bpbl9sbyk7CiBlcnJfc3Bpbl9oaToKIAlpZ3Rfc3Bpbm5lcl9maW5pKCZzcGluX2hpKTsK
LWVycl91bmxvY2s6Ci0JaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdh
a2VyZWYpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJu
IGVycjsKIAogZXJyX3dlZGdlZDoKQEAgLTkyOSw3ICs4OTEsNiBAQCBzdGF0aWMgaW50IGxpdmVf
bm9wcmVlbXB0KHZvaWQgKmFyZykKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJ
c3RydWN0IHByZWVtcHRfY2xpZW50IGEsIGI7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7Ci0J
aW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJaW50IGVyciA9IC1FTk9NRU07CiAKIAkvKgpAQCAt
OTQwLDExICs5MDEsOCBAQCBzdGF0aWMgaW50IGxpdmVfbm9wcmVlbXB0KHZvaWQgKmFyZykKIAlp
ZiAoIUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1QVElPTihpOTE1KSkKIAkJcmV0dXJuIDA7CiAKLQlt
dXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVu
dGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCiAJaWYgKHByZWVtcHRfY2xpZW50X2lu
aXQoaTkxNSwgJmEpKQotCQlnb3RvIGVycl91bmxvY2s7CisJCXJldHVybiAtRU5PTUVNOwogCWlm
IChwcmVlbXB0X2NsaWVudF9pbml0KGk5MTUsICZiKSkKIAkJZ290byBlcnJfY2xpZW50X2E7CiAJ
Yi5jdHgtPnNjaGVkLnByaW9yaXR5ID0gSTkxNV9VU0VSX1BSSU9SSVRZKEk5MTVfUFJJT1JJVFlf
TUFYKTsKQEAgLTEwMTgsOSArOTc2LDYgQEAgc3RhdGljIGludCBsaXZlX25vcHJlZW1wdCh2b2lk
ICphcmcpCiAJcHJlZW1wdF9jbGllbnRfZmluaSgmYik7CiBlcnJfY2xpZW50X2E6CiAJcHJlZW1w
dF9jbGllbnRfZmluaSgmYSk7Ci1lcnJfdW5sb2NrOgotCWludGVsX3J1bnRpbWVfcG1fcHV0KCZp
OTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CiAKIGVycl93ZWRnZWQ6CkBAIC0xMDQwLDcgKzk5NSw2
IEBAIHN0YXRpYyBpbnQgbGl2ZV9zdXBwcmVzc19zZWxmX3ByZWVtcHQodm9pZCAqYXJnKQogCX07
CiAJc3RydWN0IHByZWVtcHRfY2xpZW50IGEsIGI7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7
Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJaW50IGVyciA9IC1FTk9NRU07CiAKIAkvKgpA
QCAtMTA1OSwxMSArMTAxMyw4IEBAIHN0YXRpYyBpbnQgbGl2ZV9zdXBwcmVzc19zZWxmX3ByZWVt
cHQodm9pZCAqYXJnKQogCWlmIChpbnRlbF92Z3B1X2FjdGl2ZShpOTE1KSkKIAkJcmV0dXJuIDA7
IC8qIEdWVCBmb3JjZXMgc2luZ2xlIHBvcnQgJiByZXF1ZXN0IHN1Ym1pc3Npb24gKi8KIAotCW11
dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCXdha2VyZWYgPSBpbnRlbF9ydW50
aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7Ci0KIAlpZiAocHJlZW1wdF9jbGllbnRfaW5p
dChpOTE1LCAmYSkpCi0JCWdvdG8gZXJyX3VubG9jazsKKwkJcmV0dXJuIC1FTk9NRU07CiAJaWYg
KHByZWVtcHRfY2xpZW50X2luaXQoaTkxNSwgJmIpKQogCQlnb3RvIGVycl9jbGllbnRfYTsKIApA
QCAtMTE0NCw5ICsxMDk1LDYgQEAgc3RhdGljIGludCBsaXZlX3N1cHByZXNzX3NlbGZfcHJlZW1w
dCh2b2lkICphcmcpCiAJcHJlZW1wdF9jbGllbnRfZmluaSgmYik7CiBlcnJfY2xpZW50X2E6CiAJ
cHJlZW1wdF9jbGllbnRfZmluaSgmYSk7Ci1lcnJfdW5sb2NrOgotCWludGVsX3J1bnRpbWVfcG1f
cHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CiAKIGVycl93ZWRnZWQ6CkBAIC0xMjE2LDcg
KzExNjQsNiBAQCBzdGF0aWMgaW50IGxpdmVfc3VwcHJlc3Nfd2FpdF9wcmVlbXB0KHZvaWQgKmFy
ZykKIAlzdHJ1Y3QgcHJlZW1wdF9jbGllbnQgY2xpZW50WzRdOwogCXN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZTsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKLQlpbnRlbF93YWtlcmVm
X3Qgd2FrZXJlZjsKIAlpbnQgZXJyID0gLUVOT01FTTsKIAlpbnQgaTsKIApAQCAtMTIyOSwxMSAr
MTE3Niw4IEBAIHN0YXRpYyBpbnQgbGl2ZV9zdXBwcmVzc193YWl0X3ByZWVtcHQodm9pZCAqYXJn
KQogCWlmICghSEFTX0xPR0lDQUxfUklOR19QUkVFTVBUSU9OKGk5MTUpKQogCQlyZXR1cm4gMDsK
IAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCXdha2VyZWYgPSBpbnRl
bF9ydW50aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7Ci0KIAlpZiAocHJlZW1wdF9jbGll
bnRfaW5pdChpOTE1LCAmY2xpZW50WzBdKSkgLyogRUxTUFswXSAqLwotCQlnb3RvIGVycl91bmxv
Y2s7CisJCXJldHVybiAtRU5PTUVNOwogCWlmIChwcmVlbXB0X2NsaWVudF9pbml0KGk5MTUsICZj
bGllbnRbMV0pKSAvKiBFTFNQWzFdICovCiAJCWdvdG8gZXJyX2NsaWVudF8wOwogCWlmIChwcmVl
bXB0X2NsaWVudF9pbml0KGk5MTUsICZjbGllbnRbMl0pKSAvKiBoZWFkIG9mIHF1ZXVlICovCkBA
IC0xMzE5LDkgKzEyNjMsNiBAQCBzdGF0aWMgaW50IGxpdmVfc3VwcHJlc3Nfd2FpdF9wcmVlbXB0
KHZvaWQgKmFyZykKIAlwcmVlbXB0X2NsaWVudF9maW5pKCZjbGllbnRbMV0pOwogZXJyX2NsaWVu
dF8wOgogCXByZWVtcHRfY2xpZW50X2ZpbmkoJmNsaWVudFswXSk7Ci1lcnJfdW5sb2NrOgotCWlu
dGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91
bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CiAKIGVycl93ZWRn
ZWQ6CkBAIC0xMzM4LDcgKzEyNzksNiBAQCBzdGF0aWMgaW50IGxpdmVfY2hhaW5fcHJlZW1wdCh2
b2lkICphcmcpCiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCXN0cnVjdCBwcmVl
bXB0X2NsaWVudCBoaSwgbG87CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7Ci0JaW50ZWxfd2Fr
ZXJlZl90IHdha2VyZWY7CiAJaW50IGVyciA9IC1FTk9NRU07CiAKIAkvKgpAQCAtMTM1MCwxMSAr
MTI5MCw4IEBAIHN0YXRpYyBpbnQgbGl2ZV9jaGFpbl9wcmVlbXB0KHZvaWQgKmFyZykKIAlpZiAo
IUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1QVElPTihpOTE1KSkKIAkJcmV0dXJuIDA7CiAKLQltdXRl
eF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVudGlt
ZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCiAJaWYgKHByZWVtcHRfY2xpZW50X2luaXQo
aTkxNSwgJmhpKSkKLQkJZ290byBlcnJfdW5sb2NrOworCQlyZXR1cm4gLUVOT01FTTsKIAogCWlm
IChwcmVlbXB0X2NsaWVudF9pbml0KGk5MTUsICZsbykpCiAJCWdvdG8gZXJyX2NsaWVudF9oaTsK
QEAgLTE0NjUsOSArMTQwMiw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9jaGFpbl9wcmVlbXB0KHZvaWQg
KmFyZykKIAlwcmVlbXB0X2NsaWVudF9maW5pKCZsbyk7CiBlcnJfY2xpZW50X2hpOgogCXByZWVt
cHRfY2xpZW50X2ZpbmkoJmhpKTsKLWVycl91bmxvY2s6Ci0JaW50ZWxfcnVudGltZV9wbV9wdXQo
Jmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKIAogZXJyX3dlZGdlZDoKQEAgLTE0ODUsNyArMTQx
OSw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9wcmVlbXB0X2hhbmcodm9pZCAqYXJnKQogCXN0cnVjdCBp
Z3Rfc3Bpbm5lciBzcGluX2hpLCBzcGluX2xvOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZTsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJl
ZjsKIAlpbnQgZXJyID0gLUVOT01FTTsKIAogCWlmICghSEFTX0xPR0lDQUxfUklOR19QUkVFTVBU
SU9OKGk5MTUpKQpAQCAtMTQ5NCwxMSArMTQyNyw4IEBAIHN0YXRpYyBpbnQgbGl2ZV9wcmVlbXB0
X2hhbmcodm9pZCAqYXJnKQogCWlmICghaW50ZWxfaGFzX3Jlc2V0X2VuZ2luZSgmaTkxNS0+Z3Qp
KQogCQlyZXR1cm4gMDsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwot
CXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7Ci0KIAlp
ZiAoaWd0X3NwaW5uZXJfaW5pdCgmc3Bpbl9oaSwgJmk5MTUtPmd0KSkKLQkJZ290byBlcnJfdW5s
b2NrOworCQlyZXR1cm4gLUVOT01FTTsKIAogCWlmIChpZ3Rfc3Bpbm5lcl9pbml0KCZzcGluX2xv
LCAmaTkxNS0+Z3QpKQogCQlnb3RvIGVycl9zcGluX2hpOwpAQCAtMTU5MCw5ICsxNTIwLDYgQEAg
c3RhdGljIGludCBsaXZlX3ByZWVtcHRfaGFuZyh2b2lkICphcmcpCiAJaWd0X3NwaW5uZXJfZmlu
aSgmc3Bpbl9sbyk7CiBlcnJfc3Bpbl9oaToKIAlpZ3Rfc3Bpbm5lcl9maW5pKCZzcGluX2hpKTsK
LWVycl91bmxvY2s6Ci0JaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdh
a2VyZWYpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJu
IGVycjsKIH0KIApAQCAtMTY4NCwxMSArMTYxMSw5IEBAIHN0YXRpYyBpbnQgc21va2VfY3Jlc2Nl
bmRvX3RocmVhZCh2b2lkICphcmcpCiAJCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHggPSBz
bW9rZV9jb250ZXh0KHNtb2tlKTsKIAkJaW50IGVycjsKIAotCQltdXRleF9sb2NrKCZzbW9rZS0+
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWVyciA9IHNtb2tlX3N1Ym1pdChzbW9rZSwKIAkJ
CQkgICBjdHgsIGNvdW50ICUgSTkxNV9QUklPUklUWV9NQVgsCiAJCQkJICAgc21va2UtPmJhdGNo
KTsKLQkJbXV0ZXhfdW5sb2NrKCZzbW9rZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWlm
IChlcnIpCiAJCQlyZXR1cm4gZXJyOwogCkBAIC0xNzA5LDggKzE2MzQsNiBAQCBzdGF0aWMgaW50
IHNtb2tlX2NyZXNjZW5kbyhzdHJ1Y3QgcHJlZW1wdF9zbW9rZSAqc21va2UsIHVuc2lnbmVkIGlu
dCBmbGFncykKIAl1bnNpZ25lZCBsb25nIGNvdW50OwogCWludCBlcnIgPSAwOwogCi0JbXV0ZXhf
dW5sb2NrKCZzbW9rZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlmb3JfZWFjaF9lbmdp
bmUoZW5naW5lLCBzbW9rZS0+aTkxNSwgaWQpIHsKIAkJYXJnW2lkXSA9ICpzbW9rZTsKIAkJYXJn
W2lkXS5lbmdpbmUgPSBlbmdpbmU7CkBAIC0xNzQzLDggKzE2NjYsNiBAQCBzdGF0aWMgaW50IHNt
b2tlX2NyZXNjZW5kbyhzdHJ1Y3QgcHJlZW1wdF9zbW9rZSAqc21va2UsIHVuc2lnbmVkIGludCBm
bGFncykKIAkJcHV0X3Rhc2tfc3RydWN0KHRza1tpZF0pOwogCX0KIAotCW11dGV4X2xvY2soJnNt
b2tlLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCXByX2luZm8oIlN1Ym1pdHRlZCAlbHUg
Y3Jlc2NlbmRvOiV4IHJlcXVlc3RzIGFjcm9zcyAlZCBlbmdpbmVzIGFuZCAlZCBjb250ZXh0c1xu
IiwKIAkJY291bnQsIGZsYWdzLAogCQlSVU5USU1FX0lORk8oc21va2UtPmk5MTUpLT5udW1fZW5n
aW5lcywgc21va2UtPm5jb250ZXh0KTsKQEAgLTE3ODcsNyArMTcwOCw2IEBAIHN0YXRpYyBpbnQg
bGl2ZV9wcmVlbXB0X3Ntb2tlKHZvaWQgKmFyZykKIAkJLm5jb250ZXh0ID0gMTAyNCwKIAl9Owog
CWNvbnN0IHVuc2lnbmVkIGludCBwaGFzZVtdID0geyAwLCBCQVRDSCB9OwotCWludGVsX3dha2Vy
ZWZfdCB3YWtlcmVmOwogCXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7CiAJaW50IGVyciA9IC1FTk9N
RU07CiAJdTMyICpjczsKQEAgLTE4MDIsMTMgKzE3MjIsMTAgQEAgc3RhdGljIGludCBsaXZlX3By
ZWVtcHRfc21va2Uodm9pZCAqYXJnKQogCWlmICghc21va2UuY29udGV4dHMpCiAJCXJldHVybiAt
RU5PTUVNOwogCi0JbXV0ZXhfbG9jaygmc21va2UuaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0J
d2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZzbW9rZS5pOTE1LT5ydW50aW1lX3BtKTsK
LQogCXNtb2tlLmJhdGNoID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChzbW9rZS5p
OTE1LCBQQUdFX1NJWkUpOwogCWlmIChJU19FUlIoc21va2UuYmF0Y2gpKSB7CiAJCWVyciA9IFBU
Ul9FUlIoc21va2UuYmF0Y2gpOwotCQlnb3RvIGVycl91bmxvY2s7CisJCWdvdG8gZXJyX2ZyZWU7
CiAJfQogCiAJY3MgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChzbW9rZS5iYXRjaCwgSTkxNV9N
QVBfV0IpOwpAQCAtMTg1NSw5ICsxNzcyLDcgQEAgc3RhdGljIGludCBsaXZlX3ByZWVtcHRfc21v
a2Uodm9pZCAqYXJnKQogCiBlcnJfYmF0Y2g6CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChzbW9rZS5i
YXRjaCk7Ci1lcnJfdW5sb2NrOgotCWludGVsX3J1bnRpbWVfcG1fcHV0KCZzbW9rZS5pOTE1LT5y
dW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJnNtb2tlLmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOworZXJyX2ZyZWU6CiAJa2ZyZWUoc21va2UuY29udGV4dHMpOwogCiAJcmV0dXJu
IGVycjsKQEAgLTE5OTUsMTkgKzE5MTAsMTcgQEAgc3RhdGljIGludCBsaXZlX3ZpcnR1YWxfZW5n
aW5lKHZvaWQgKmFyZykKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gJmk5MTUtPmd0OwogCWVudW0g
aW50ZWxfZW5naW5lX2lkIGlkOwogCXVuc2lnbmVkIGludCBjbGFzcywgaW5zdDsKLQlpbnQgZXJy
ID0gLUVOT0RFVjsKKwlpbnQgZXJyOwogCiAJaWYgKFVTRVNfR1VDX1NVQk1JU1NJT04oaTkxNSkp
CiAJCXJldHVybiAwOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0K
IAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgewogCQllcnIgPSBub3BfdmlydHVh
bF9lbmdpbmUoaTkxNSwgJmVuZ2luZSwgMSwgMSwgMCk7CiAJCWlmIChlcnIpIHsKIAkJCXByX2Vy
cigiRmFpbGVkIHRvIHdyYXAgZW5naW5lICVzOiBlcnI9JWRcbiIsCiAJCQkgICAgICAgZW5naW5l
LT5uYW1lLCBlcnIpOwotCQkJZ290byBvdXRfdW5sb2NrOworCQkJcmV0dXJuIGVycjsKIAkJfQog
CX0KIApAQCAtMjAyOCwxNyArMTk0MSwxNSBAQCBzdGF0aWMgaW50IGxpdmVfdmlydHVhbF9lbmdp
bmUodm9pZCAqYXJnKQogCQkJZXJyID0gbm9wX3ZpcnR1YWxfZW5naW5lKGk5MTUsIHNpYmxpbmdz
LCBuc2libGluZywKIAkJCQkJCSBuLCAwKTsKIAkJCWlmIChlcnIpCi0JCQkJZ290byBvdXRfdW5s
b2NrOworCQkJCXJldHVybiBlcnI7CiAJCX0KIAogCQllcnIgPSBub3BfdmlydHVhbF9lbmdpbmUo
aTkxNSwgc2libGluZ3MsIG5zaWJsaW5nLCBuLCBDSEFJTik7CiAJCWlmIChlcnIpCi0JCQlnb3Rv
IG91dF91bmxvY2s7CisJCQlyZXR1cm4gZXJyOwogCX0KIAotb3V0X3VubG9jazoKLQltdXRleF91
bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCXJldHVybiBlcnI7CisJcmV0dXJuIDA7
CiB9CiAKIHN0YXRpYyBpbnQgbWFza192aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwKQEAgLTIxMTcsOSArMjAyOCw2IEBAIHN0YXRpYyBpbnQgbWFza192aXJ0dWFs
X2VuZ2luZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAl9CiAKIAllcnIgPSBpZ3Rf
bGl2ZV90ZXN0X2VuZCgmdCk7Ci0JaWYgKGVycikKLQkJZ290byBvdXQ7Ci0KIG91dDoKIAlpZiAo
aWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJCWVyciA9IC1FSU87CkBAIC0yMTQyLDEzICsyMDUwLDEx
IEBAIHN0YXRpYyBpbnQgbGl2ZV92aXJ0dWFsX21hc2sodm9pZCAqYXJnKQogCXN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKnNpYmxpbmdzW01BWF9FTkdJTkVfSU5TVEFOQ0UgKyAxXTsKIAlzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0ID0gJmk5MTUtPmd0OwogCXVuc2lnbmVkIGludCBjbGFzcywgaW5zdDsKLQlp
bnQgZXJyID0gMDsKKwlpbnQgZXJyOwogCiAJaWYgKFVTRVNfR1VDX1NVQk1JU1NJT04oaTkxNSkp
CiAJCXJldHVybiAwOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0K
IAlmb3IgKGNsYXNzID0gMDsgY2xhc3MgPD0gTUFYX0VOR0lORV9DTEFTUzsgY2xhc3MrKykgewog
CQl1bnNpZ25lZCBpbnQgbnNpYmxpbmc7CiAKQEAgLTIxNjQsMTIgKzIwNzAsMTAgQEAgc3RhdGlj
IGludCBsaXZlX3ZpcnR1YWxfbWFzayh2b2lkICphcmcpCiAKIAkJZXJyID0gbWFza192aXJ0dWFs
X2VuZ2luZShpOTE1LCBzaWJsaW5ncywgbnNpYmxpbmcpOwogCQlpZiAoZXJyKQotCQkJZ290byBv
dXRfdW5sb2NrOworCQkJcmV0dXJuIGVycjsKIAl9CiAKLW91dF91bmxvY2s6Ci0JbXV0ZXhfdW5s
b2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlyZXR1cm4gZXJyOworCXJldHVybiAwOwog
fQogCiBzdGF0aWMgaW50IGJvbmRfdmlydHVhbF9lbmdpbmUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCkBAIC0yMzIwLDEzICsyMjI0LDExIEBAIHN0YXRpYyBpbnQgbGl2ZV92aXJ0dWFs
X2JvbmQodm9pZCAqYXJnKQogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKnNpYmxpbmdzW01BWF9F
TkdJTkVfSU5TVEFOQ0UgKyAxXTsKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gJmk5MTUtPmd0Owog
CXVuc2lnbmVkIGludCBjbGFzcywgaW5zdDsKLQlpbnQgZXJyID0gMDsKKwlpbnQgZXJyOwogCiAJ
aWYgKFVTRVNfR1VDX1NVQk1JU1NJT04oaTkxNSkpCiAJCXJldHVybiAwOwogCi0JbXV0ZXhfbG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlmb3IgKGNsYXNzID0gMDsgY2xhc3MgPD0g
TUFYX0VOR0lORV9DTEFTUzsgY2xhc3MrKykgewogCQljb25zdCBzdHJ1Y3QgcGhhc2UgKnA7CiAJ
CWludCBuc2libGluZzsKQEAgLTIzNDksMTQgKzIyNTEsMTIgQEAgc3RhdGljIGludCBsaXZlX3Zp
cnR1YWxfYm9uZCh2b2lkICphcmcpCiAJCQlpZiAoZXJyKSB7CiAJCQkJcHJfZXJyKCIlcyglcyk6
IGZhaWxlZCBjbGFzcz0lZCwgbnNpYmxpbmc9JWQsIGVycj0lZFxuIiwKIAkJCQkgICAgICAgX19m
dW5jX18sIHAtPm5hbWUsIGNsYXNzLCBuc2libGluZywgZXJyKTsKLQkJCQlnb3RvIG91dF91bmxv
Y2s7CisJCQkJcmV0dXJuIGVycjsKIAkJCX0KIAkJfQogCX0KIAotb3V0X3VubG9jazoKLQltdXRl
eF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCXJldHVybiBlcnI7CisJcmV0dXJu
IDA7CiB9CiAKIGludCBpbnRlbF9leGVjbGlzdHNfbGl2ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9z
ZWxmdGVzdF93b3JrYXJvdW5kcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
d29ya2Fyb3VuZHMuYwppbmRleCA3YzdhY2ViODVhNzQuLjk1NjI3ZTgwZjI0NiAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29ya2Fyb3VuZHMuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jCkBAIC03MDgsOSAr
NzA4LDcgQEAgc3RhdGljIGludCBsaXZlX2RpcnR5X3doaXRlbGlzdCh2b2lkICphcmcpCiAKIAl3
YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwogCi0JbXV0
ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlmaWxlID0gbW9ja19maWxlKGk5
MTUpOwotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChJU19FUlIo
ZmlsZSkpIHsKIAkJZXJyID0gUFRSX0VSUihmaWxlKTsKIAkJZ290byBvdXRfcnBtOwpAQCAtNzMy
LDkgKzczMCw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9kaXJ0eV93aGl0ZWxpc3Qodm9pZCAqYXJnKQog
CX0KIAogb3V0X2ZpbGU6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
IAltb2NrX2ZpbGVfZnJlZShpOTE1LCBmaWxlKTsKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKIG91dF9ycG06CiAJaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRp
bWVfcG0sIHdha2VyZWYpOwogCXJldHVybiBlcnI7CkBAIC0xMjc0LDE0ICsxMjcwLDkgQEAgaW50
IGludGVsX3dvcmthcm91bmRzX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQogCQlTVUJURVNUKGxpdmVfZ3B1X3Jlc2V0X3dvcmthcm91bmRzKSwKIAkJU1VCVEVT
VChsaXZlX2VuZ2luZV9yZXNldF93b3JrYXJvdW5kcyksCiAJfTsKLQlpbnQgZXJyOwogCiAJaWYg
KGludGVsX2d0X2lzX3dlZGdlZCgmaTkxNS0+Z3QpKQogCQlyZXR1cm4gMDsKIAotCW11dGV4X2xv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWVyciA9IGk5MTVfc3VidGVzdHModGVzdHMs
IGk5MTUpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQlyZXR1
cm4gZXJyOworCXJldHVybiBpOTE1X3N1YnRlc3RzKHRlc3RzLCBpOTE1KTsKIH0KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL3NlbGZ0ZXN0X2d1Yy5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvdWMvc2VsZnRlc3RfZ3VjLmMKaW5kZXggYmJhMGVhZmUxY2RiLi5mOTI3
Zjg1MWFhZGYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL3NlbGZ0ZXN0
X2d1Yy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL3NlbGZ0ZXN0X2d1Yy5jCkBA
IC0xMTYsNyArMTE2LDYgQEAgc3RhdGljIGludCBpZ3RfZ3VjX2NsaWVudHModm9pZCAqYXJncykK
IAlpbnQgZXJyID0gMDsKIAogCUdFTV9CVUdfT04oIUhBU19HVF9VQyhkZXZfcHJpdikpOwotCW11
dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIAl3YWtlcmVmID0gaW50ZWxf
cnVudGltZV9wbV9nZXQoJmRldl9wcml2LT5ydW50aW1lX3BtKTsKIAogCWd1YyA9ICZkZXZfcHJp
di0+Z3QudWMuZ3VjOwpAQCAtMTkwLDcgKzE4OSw2IEBAIHN0YXRpYyBpbnQgaWd0X2d1Y19jbGll
bnRzKHZvaWQgKmFyZ3MpCiAJZ3VjX2NsaWVudHNfZW5hYmxlKGd1Yyk7CiB1bmxvY2s6CiAJaW50
ZWxfcnVudGltZV9wbV9wdXQoJmRldl9wcml2LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRl
eF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4gZXJyOwogfQog
CkBAIC0yMDgsNyArMjA2LDYgQEAgc3RhdGljIGludCBpZ3RfZ3VjX2Rvb3JiZWxscyh2b2lkICph
cmcpCiAJdTE2IGRiX2lkOwogCiAJR0VNX0JVR19PTighSEFTX0dUX1VDKGRldl9wcml2KSk7Ci0J
bXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXdha2VyZWYgPSBpbnRl
bF9ydW50aW1lX3BtX2dldCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0pOwogCiAJZ3VjID0gJmRldl9w
cml2LT5ndC51Yy5ndWM7CkBAIC0yOTksNyArMjk2LDYgQEAgc3RhdGljIGludCBpZ3RfZ3VjX2Rv
b3JiZWxscyh2b2lkICphcmcpCiAJCX0KIHVubG9jazoKIAlpbnRlbF9ydW50aW1lX3BtX3B1dCgm
ZGV2X3ByaXYtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ndHQuYwppbmRleCA4ZDgxMjFjMDIxNjEuLjE2NWIz
YTdmOTc0NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVf
Z2VtX2d0dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9n
dHQuYwpAQCAtMTc5Nyw3ICsxNzk3LDYgQEAgc3RhdGljIGludCBpZ3RfY3NfdGxiKHZvaWQgKmFy
ZykKIAlpZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKIAotCW11dGV4
X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWN0eCA9IGxpdmVfY29udGV4dChpOTE1
LCBmaWxlKTsKIAlpZiAoSVNfRVJSKGN0eCkpIHsKIAkJZXJyID0gUFRSX0VSUihjdHgpOwpAQCAt
MjAyMCw3ICsyMDE5LDYgQEAgc3RhdGljIGludCBpZ3RfY3NfdGxiKHZvaWQgKmFyZykKIG91dF92
bToKIAlpOTE1X3ZtX3B1dCh2bSk7CiBvdXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAJbW9ja19maWxlX2ZyZWUoaTkxNSwgZmlsZSk7CiAJcmV0dXJu
IGVycjsKIH0KLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
aW50ZWwtZ2Z4

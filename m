Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 8FB1E8BC0E
	for <lists+intel-gfx@lfdr.de>; Tue, 13 Aug 2019 16:52:10 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DAFF56E16B;
	Tue, 13 Aug 2019 14:52:08 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B2B646E16B
 for <intel-gfx@lists.freedesktop.org>; Tue, 13 Aug 2019 14:52:07 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18006066-1500050 
 for multiple; Tue, 13 Aug 2019 15:51:39 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 13 Aug 2019 15:51:38 +0100
Message-Id: <20190813145138.22057-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190813132916.20382-1-chris@chris-wilson.co.uk>
References: <20190813132916.20382-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2] drm/i915: Push the wakeref->count deferral
 to the backend
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SWYgdGhlIGJhY2tlbmQgd2lzaGVzIHRvIGRlZmVyIHRoZSB3YWtlcmVmIHBhcmtpbmcsIG1ha2Ug
aXQgcmVzcG9uc2libGUKZm9yIHVubG9ja2luZyB0aGUgd2FrZXJlZiAoaS5lLiBidW1waW5nIHRo
ZSBjb3VudGVyKS4gVGhpcyBhbGxvd3MgaXQgdG8KdGltZSB0aGUgdW5sb2NrIG11Y2ggbW9yZSBj
YXJlZnVsbHkgaW4gY2FzZSBpdCBoYXBwZW5zIHRvIG5lZWRzIHRoZQp3YWtlcmVmIHRvIGJlIGFj
dGl2ZSBkdXJpbmcgaXRzIGRlZmVycmFsLgoKRm9yIGluc3RhbmNlLCBkdXJpbmcgZW5naW5lIHBh
cmtpbmcgd2UgbWF5IGNob29zZSB0byBlbWl0IGFuIGlkbGUKYmFycmllciAoYSByZXF1ZXN0KS4g
VG8gZG8gc28sIHdlIGJvcnJvdyB0aGUgZW5naW5lLT5rZXJuZWxfY29udGV4dAp0aW1lbGluZSBh
bmQgdG8gZW5zdXJlIGV4Y2x1c2l2ZSBhY2Nlc3Mgd2Uga2VlcCB0aGUKZW5naW5lLT53YWtlcmVm
LmNvdW50IGFzIDAuIEhvd2V2ZXIsIHRvIHN1Ym1pdCB0aGF0IHJlcXVlc3QgdG8gSFcgbWF5CnJl
cXVpcmUgYSBpbnRlbF9lbmdpbmVfcG1fZ2V0KCkgKGUuZy4gdG8ga2VlcCB0aGUgc3VibWlzc2lv
biB0YXNrbGV0CmFsaXZlKSBhbmQgYmVmb3JlIHdlIGFsbG93IHRoYXQgd2UgaGF2ZSB0byByZXdh
a2Ugb3VyIHdha2VyZWYgdG8gYXZvaWQgYQpyZWN1cnNpdmUgZGVhZGxvY2suCgo8ND4gWzI1Ny43
NDI5MTZdIElSUXMgbm90IGVuYWJsZWQgYXMgZXhwZWN0ZWQKPDQ+IFsyNTcuNzQyOTMwXSBXQVJO
SU5HOiBDUFU6IDAgUElEOiAwIGF0IGtlcm5lbC9zb2Z0aXJxLmM6MTY5IF9fbG9jYWxfYmhfZW5h
YmxlX2lwKzB4YTkvMHgxMDAKPDQ+IFsyNTcuNzQyOTM2XSBNb2R1bGVzIGxpbmtlZCBpbjogdmdl
bSBzbmRfaGRhX2NvZGVjX2hkbWkgc25kX2hkYV9jb2RlY19yZWFsdGVrIHNuZF9oZGFfY29kZWNf
Z2VuZXJpYyBpOTE1IGJ0dXNiIGJ0cnRsIGJ0YmNtIGJ0aW50ZWwgc25kX2hkYV9pbnRlbCBzbmRf
aW50ZWxfbmhsdCBibHVldG9vdGggc25kX2hkYV9jb2RlYyBjb3JldGVtcCBzbmRfaHdkZXAgY3Jj
dDEwZGlmX3BjbG11bCBzbmRfaGRhX2NvcmUgY3JjMzJfcGNsbXVsIGVjZGhfZ2VuZXJpYyBlY2Mg
Z2hhc2hfY2xtdWxuaV9pbnRlbCBzbmRfcGNtIHI4MTY5IHJlYWx0ZWsgbHBjX2ljaCBwcmltZV9u
dW1iZXJzIGkyY19oaWQKPDQ+IFsyNTcuNzQyOTkxXSBDUFU6IDAgUElEOiAwIENvbW06IHN3YXBw
ZXIvMCBUYWludGVkOiBHICAgICBVICBXICAgICAgICAgNS4zLjAtcmMzLWc1ZDBhMDZjZDUzMmMt
ZHJtdGlwXzM0MCsgIzEKPDQ+IFsyNTcuNzQyOTk4XSBIYXJkd2FyZSBuYW1lOiBHSUdBQllURSBH
Qi1CWEJULTE5MDAvTVpCQVlBQi0wMCwgQklPUyBGNiAwMi8xNy8yMDE1Cjw0PiBbMjU3Ljc0MzAw
OF0gUklQOiAwMDEwOl9fbG9jYWxfYmhfZW5hYmxlX2lwKzB4YTkvMHgxMDAKPDQ+IFsyNTcuNzQz
MDE3XSBDb2RlOiAzNyA1YiA1ZCBjMyA4YiA4MCA1MCAwOCAwMCAwMCA4NSBjMCA3NSBhOSA4MCAz
ZCAwYiBiZSAyNSAwMSAwMCA3NSBhMCA0OCBjNyBjNyBmMyAwYyAwNiBhYyBjNiAwNSBmYiBiZCAy
NSAwMSAwMSBlOCA3NyA4NCBmZiBmZiA8MGY+IDBiIGViIDg5IDQ4IDg5IGVmIGU4IDNiIDQxIDA2
IDAwIGViIDk4IGU4IGU0IDVjIGY0IGZmIDViIDVkIGMzCjw0PiBbMjU3Ljc0MzAyNV0gUlNQOiAw
MDE4OmZmZmZhNzg2MDAwMDNjYjggRUZMQUdTOiAwMDAxMDA4Ngo8ND4gWzI1Ny43NDMwMzVdIFJB
WDogMDAwMDAwMDAwMDAwMDAwMCBSQlg6IDAwMDAwMDAwMDAwMDAyMDAgUkNYOiAwMDAwMDAwMDAw
MDEwMzAyCjw0PiBbMjU3Ljc0MzA0Ml0gUkRYOiAwMDAwMDAwMDgwMDEwMzAyIFJTSTogMDAwMDAw
MDAwMDAwMDAwMCBSREk6IDAwMDAwMDAwZmZmZmZmZmYKPDQ+IFsyNTcuNzQzMDUwXSBSQlA6IGZm
ZmZmZmZmYzA0OTRiYjMgUjA4OiAwMDAwMDAwMDAwMDAwMDAwIFIwOTogMDAwMDAwMDAwMDAwMDAw
MQo8ND4gWzI1Ny43NDMwNThdIFIxMDogMDAwMDAwMDAxNGM4ZjBlOSBSMTE6IDAwMDAwMDAwZmVl
MmZmOGUgUjEyOiBmZmZmYTIzYmE4YzM4MDA4Cjw0PiBbMjU3Ljc0MzA2NV0gUjEzOiBmZmZmYTIz
YmFjYzU3OWMwIFIxNDogZmZmZmEyM2JiN2RiMGY2MCBSMTU6IGZmZmZhMjNiOWNjOGM0MzAKPDQ+
IFsyNTcuNzQzMDc0XSBGUzogIDAwMDAwMDAwMDAwMDAwMDAoMDAwMCkgR1M6ZmZmZmEyM2JiYmEw
MDAwMCgwMDAwKSBrbmxHUzowMDAwMDAwMDAwMDAwMDAwCjw0PiBbMjU3Ljc0MzA4Ml0gQ1M6ICAw
MDEwIERTOiAwMDAwIEVTOiAwMDAwIENSMDogMDAwMDAwMDA4MDA1MDAzMwo8ND4gWzI1Ny43NDMw
ODldIENSMjogMDAwMDdmZTQ3N2IyMDc3OCBDUjM6IDAwMDAwMDAxMWY3MmEwMDAgQ1I0OiAwMDAw
MDAwMDAwMTAwNmYwCjw0PiBbMjU3Ljc0MzA5Nl0gQ2FsbCBUcmFjZToKPDQ+IFsyNTcuNzQzMTA0
XSAgPElSUT4KPDQ+IFsyNTcuNzQzMjY1XSAgX19pOTE1X3JlcXVlc3RfY29tbWl0KzB4MjQwLzB4
NWQwIFtpOTE1XQo8ND4gWzI1Ny43NDM0MjddICA/IF9faTkxNV9yZXF1ZXN0X2NyZWF0ZSsweDIy
OC8weDRjMCBbaTkxNV0KPDQ+IFsyNTcuNzQzNTg0XSAgX19lbmdpbmVfcGFyaysweDY0LzB4MjUw
IFtpOTE1XQo8ND4gWzI1Ny43NDM3MzBdICBfX19faW50ZWxfd2FrZXJlZl9wdXRfbGFzdCsweDFj
LzB4NzAgW2k5MTVdCjw0PiBbMjU3Ljc0Mzg3OF0gIGk5MTVfc2FtcGxlKzB4MmVlLzB4MzEwIFtp
OTE1XQo8ND4gWzI1Ny43NDQwMzBdICA/IGk5MTVfcG11X2NwdV9vZmZsaW5lKzB4YjAvMHhiMCBb
aTkxNV0KPDQ+IFsyNTcuNzQ0MDQwXSAgX19ocnRpbWVyX3J1bl9xdWV1ZXMrMHgxMWUvMHg0YjAK
PDQ+IFsyNTcuNzQ0MDY4XSAgaHJ0aW1lcl9pbnRlcnJ1cHQrMHhlYS8weDI1MAo8ND4gWzI1Ny43
NDQwNzldICA/IGxvY2tkZXBfaGFyZGlycXNfb2ZmKzB4NzkvMHhkMAo8ND4gWzI1Ny43NDQxMDFd
ICBzbXBfYXBpY190aW1lcl9pbnRlcnJ1cHQrMHg5Ni8weDI4MAo8ND4gWzI1Ny43NDQxMTRdICBh
cGljX3RpbWVyX2ludGVycnVwdCsweGYvMHgyMAo8ND4gWzI1Ny43NDQxMjVdIFJJUDogMDAxMDpf
X2RvX3NvZnRpcnErMHhiMy8weDRhZQoKdjI6IEtlZXAgdGhlIHByaW9yaXR5X2hpbnQgYXNzZXJ0
CgpCdWd6aWxsYTogaHR0cHM6Ly9idWdzLmZyZWVkZXNrdG9wLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9
MTExMzc4ClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNv
LnVrPgpDYzogRGFuaWVsZSBDZXJhb2xvIFNwdXJpbyA8ZGFuaWVsZS5jZXJhb2xvc3B1cmlvQGlu
dGVsLmNvbT4KQ2M6IE1pa2EgS3VvcHBhbGEgPG1pa2Eua3VvcHBhbGFAbGludXguaW50ZWwuY29t
PgpSZXZpZXdlZC1ieTogTWlrYSBLdW9wcGFsYSA8bWlrYS5rdW9wcGFsYUBsaW51eC5pbnRlbC5j
b20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMgfCAgNyAr
Ky0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jICAgICAgIHwgNjYgKysrKysr
KysrKysrLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5oICAg
ICAgIHwgIDIgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIuYyAgICAgfCAg
MyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd2FrZXJlZi5jICAgICAgfCAgNCArLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd2FrZXJlZi5oICAgICAgfCAxMSArKysrCiA2IGZp
bGVzIGNoYW5nZWQsIDU2IGluc2VydGlvbnMoKyksIDM3IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMKaW5kZXggNmIxNWUzMzM1ZGQ2Li4zZGE0
ZWI5YmU3Y2EgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2lu
ZV9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jCkBA
IC02OCwxMCArNjgsMTUgQEAgc3RhdGljIGJvb2wgc3dpdGNoX3RvX2tlcm5lbF9jb250ZXh0KHN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAogCS8qIENoZWNrIGFnYWluIG9uIHRoZSBu
ZXh0IHJldGlyZW1lbnQuICovCiAJZW5naW5lLT53YWtlcmVmX3NlcmlhbCA9IGVuZ2luZS0+c2Vy
aWFsICsgMTsKLQogCWk5MTVfcmVxdWVzdF9hZGRfYWN0aXZlX2JhcnJpZXJzKHJxKTsKKworCXJx
LT5zY2hlZC5hdHRyLnByaW9yaXR5ID0gSU5UX01BWDsgLyogUHJlZW1wdGlvbiBiYXJyaWVyICov
CiAJX19pOTE1X3JlcXVlc3RfY29tbWl0KHJxKTsKIAorCS8qIFJlbGVhc2Ugb3VyIGV4Y2x1c2l2
ZSBob2xkIG9uIHRoZSBlbmdpbmUgKi8KKwlfX2ludGVsX3dha2VyZWZfZGVmZXJfcGFyaygmZW5n
aW5lLT53YWtlcmVmKTsKKwlfX2k5MTVfcmVxdWVzdF9xdWV1ZShycSwgTlVMTCk7CisKIAlyZXR1
cm4gZmFsc2U7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVx
dWVzdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKaW5kZXggMGVhMTEz
NmQ0NTNlLi40MDIxMzM0ZGQyYzUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfcmVxdWVzdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCkBA
IC0xMTg2LDYgKzExODYsMTIgQEAgc3RydWN0IGk5MTVfcmVxdWVzdCAqX19pOTE1X3JlcXVlc3Rf
Y29tbWl0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCQlsaXN0X2FkZCgmcmluZy0+YWN0aXZl
X2xpbmssICZycS0+aTkxNS0+Z3QuYWN0aXZlX3JpbmdzKTsKIAlycS0+ZW1pdHRlZF9qaWZmaWVz
ID0gamlmZmllczsKIAorCXJldHVybiBwcmV2OworfQorCit2b2lkIF9faTkxNV9yZXF1ZXN0X3F1
ZXVlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAorCQkJICBjb25zdCBzdHJ1Y3QgaTkxNV9zY2hl
ZF9hdHRyICphdHRyKQorewogCS8qCiAJICogTGV0IHRoZSBiYWNrZW5kIGtub3cgYSBuZXcgcmVx
dWVzdCBoYXMgYXJyaXZlZCB0aGF0IG1heSBuZWVkCiAJICogdG8gYWRqdXN0IHRoZSBleGlzdGlu
ZyBleGVjdXRpb24gc2NoZWR1bGUgZHVlIHRvIGEgaGlnaCBwcmlvcml0eQpAQCAtMTE5OSw0MyAr
MTIwNSwxNSBAQCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpfX2k5MTVfcmVxdWVzdF9jb21taXQoc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJICovCiAJbG9jYWxfYmhfZGlzYWJsZSgpOwogCWk5MTVf
c3dfZmVuY2VfY29tbWl0KCZycS0+c2VtYXBob3JlKTsKLQlpZiAoZW5naW5lLT5zY2hlZHVsZSkg
ewotCQlzdHJ1Y3QgaTkxNV9zY2hlZF9hdHRyIGF0dHIgPSBycS0+Z2VtX2NvbnRleHQtPnNjaGVk
OwotCi0JCS8qCi0JCSAqIEJvb3N0IGFjdHVhbCB3b3JrbG9hZHMgcGFzdCBzZW1hcGhvcmVzIQot
CQkgKgotCQkgKiBXaXRoIHNlbWFwaG9yZXMgd2Ugc3BpbiBvbiBvbmUgZW5naW5lIHdhaXRpbmcg
Zm9yIGFub3RoZXIsCi0JCSAqIHNpbXBseSB0byByZWR1Y2UgdGhlIGxhdGVuY3kgb2Ygc3RhcnRp
bmcgb3VyIHdvcmsgd2hlbgotCQkgKiB0aGUgc2lnbmFsZXIgY29tcGxldGVzLiBIb3dldmVyLCBp
ZiB0aGVyZSBpcyBhbnkgb3RoZXIKLQkJICogd29yayB0aGF0IHdlIGNvdWxkIGJlIGRvaW5nIG9u
IHRoaXMgZW5naW5lIGluc3RlYWQsIHRoYXQKLQkJICogaXMgYmV0dGVyIHV0aWxpc2F0aW9uIGFu
ZCB3aWxsIHJlZHVjZSB0aGUgb3ZlcmFsbCBkdXJhdGlvbgotCQkgKiBvZiB0aGUgY3VycmVudCB3
b3JrLiBUbyBhdm9pZCBQSSBib29zdGluZyBhIHNlbWFwaG9yZQotCQkgKiBmYXIgaW4gdGhlIGRp
c3RhbmNlIHBhc3Qgb3ZlciB1c2VmdWwgd29yaywgd2Uga2VlcCBhIGhpc3RvcnkKLQkJICogb2Yg
YW55IHNlbWFwaG9yZSB1c2UgYWxvbmcgb3VyIGRlcGVuZGVuY3kgY2hhaW4uCi0JCSAqLwotCQlp
ZiAoIShycS0+c2NoZWQuZmxhZ3MgJiBJOTE1X1NDSEVEX0hBU19TRU1BUEhPUkVfQ0hBSU4pKQot
CQkJYXR0ci5wcmlvcml0eSB8PSBJOTE1X1BSSU9SSVRZX05PU0VNQVBIT1JFOwotCi0JCS8qCi0J
CSAqIEJvb3N0IHByaW9yaXRpZXMgdG8gbmV3IGNsaWVudHMgKG5ldyByZXF1ZXN0IGZsb3dzKS4K
LQkJICoKLQkJICogQWxsb3cgaW50ZXJhY3RpdmUvc3luY2hyb25vdXMgY2xpZW50cyB0byBqdW1w
IGFoZWFkIG9mCi0JCSAqIHRoZSBidWxrIGNsaWVudHMuIChGUV9DT0RFTCkKLQkJICovCi0JCWlm
IChsaXN0X2VtcHR5KCZycS0+c2NoZWQuc2lnbmFsZXJzX2xpc3QpKQotCQkJYXR0ci5wcmlvcml0
eSB8PSBJOTE1X1BSSU9SSVRZX1dBSVQ7Ci0KLQkJZW5naW5lLT5zY2hlZHVsZShycSwgJmF0dHIp
OwotCX0KKwlpZiAoYXR0ciAmJiBycS0+ZW5naW5lLT5zY2hlZHVsZSkKKwkJcnEtPmVuZ2luZS0+
c2NoZWR1bGUocnEsIGF0dHIpOwogCWk5MTVfc3dfZmVuY2VfY29tbWl0KCZycS0+c3VibWl0KTsK
IAlsb2NhbF9iaF9lbmFibGUoKTsgLyogS2ljayB0aGUgZXhlY2xpc3RzIHRhc2tsZXQgaWYganVz
dCBzY2hlZHVsZWQgKi8KLQotCXJldHVybiBwcmV2OwogfQogCiB2b2lkIGk5MTVfcmVxdWVzdF9h
ZGQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7CisJc3RydWN0IGk5MTVfc2NoZWRfYXR0ciBh
dHRyID0gcnEtPmdlbV9jb250ZXh0LT5zY2hlZDsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpwcmV2
OwogCiAJbG9ja2RlcF9hc3NlcnRfaGVsZCgmcnEtPnRpbWVsaW5lLT5tdXRleCk7CkBAIC0xMjQ1
LDYgKzEyMjMsMzIgQEAgdm9pZCBpOTE1X3JlcXVlc3RfYWRkKHN0cnVjdCBpOTE1X3JlcXVlc3Qg
KnJxKQogCiAJcHJldiA9IF9faTkxNV9yZXF1ZXN0X2NvbW1pdChycSk7CiAKKwkvKgorCSAqIEJv
b3N0IGFjdHVhbCB3b3JrbG9hZHMgcGFzdCBzZW1hcGhvcmVzIQorCSAqCisJICogV2l0aCBzZW1h
cGhvcmVzIHdlIHNwaW4gb24gb25lIGVuZ2luZSB3YWl0aW5nIGZvciBhbm90aGVyLAorCSAqIHNp
bXBseSB0byByZWR1Y2UgdGhlIGxhdGVuY3kgb2Ygc3RhcnRpbmcgb3VyIHdvcmsgd2hlbgorCSAq
IHRoZSBzaWduYWxlciBjb21wbGV0ZXMuIEhvd2V2ZXIsIGlmIHRoZXJlIGlzIGFueSBvdGhlcgor
CSAqIHdvcmsgdGhhdCB3ZSBjb3VsZCBiZSBkb2luZyBvbiB0aGlzIGVuZ2luZSBpbnN0ZWFkLCB0
aGF0CisJICogaXMgYmV0dGVyIHV0aWxpc2F0aW9uIGFuZCB3aWxsIHJlZHVjZSB0aGUgb3ZlcmFs
bCBkdXJhdGlvbgorCSAqIG9mIHRoZSBjdXJyZW50IHdvcmsuIFRvIGF2b2lkIFBJIGJvb3N0aW5n
IGEgc2VtYXBob3JlCisJICogZmFyIGluIHRoZSBkaXN0YW5jZSBwYXN0IG92ZXIgdXNlZnVsIHdv
cmssIHdlIGtlZXAgYSBoaXN0b3J5CisJICogb2YgYW55IHNlbWFwaG9yZSB1c2UgYWxvbmcgb3Vy
IGRlcGVuZGVuY3kgY2hhaW4uCisJICovCisJaWYgKCEocnEtPnNjaGVkLmZsYWdzICYgSTkxNV9T
Q0hFRF9IQVNfU0VNQVBIT1JFX0NIQUlOKSkKKwkJYXR0ci5wcmlvcml0eSB8PSBJOTE1X1BSSU9S
SVRZX05PU0VNQVBIT1JFOworCisJLyoKKwkgKiBCb29zdCBwcmlvcml0aWVzIHRvIG5ldyBjbGll
bnRzIChuZXcgcmVxdWVzdCBmbG93cykuCisJICoKKwkgKiBBbGxvdyBpbnRlcmFjdGl2ZS9zeW5j
aHJvbm91cyBjbGllbnRzIHRvIGp1bXAgYWhlYWQgb2YKKwkgKiB0aGUgYnVsayBjbGllbnRzLiAo
RlFfQ09ERUwpCisJICovCisJaWYgKGxpc3RfZW1wdHkoJnJxLT5zY2hlZC5zaWduYWxlcnNfbGlz
dCkpCisJCWF0dHIucHJpb3JpdHkgfD0gSTkxNV9QUklPUklUWV9XQUlUOworCisJX19pOTE1X3Jl
cXVlc3RfcXVldWUocnEsICZhdHRyKTsKKwogCS8qCiAJICogSW4gdHlwaWNhbCBzY2VuYXJpb3Ms
IHdlIGRvIG5vdCBleHBlY3QgdGhlIHByZXZpb3VzIHJlcXVlc3Qgb24KIAkgKiB0aGUgdGltZWxp
bmUgdG8gYmUgc3RpbGwgdHJhY2tlZCBieSB0aW1lbGluZS0+bGFzdF9yZXF1ZXN0IGlmIGl0CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaCBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5oCmluZGV4IDMxM2RmM2MzNzE1OC4uZmVjMWQ1ZjE3
Yzk0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaApAQCAtMjUxLDYgKzI1MSw4IEBA
IHN0cnVjdCBpOTE1X3JlcXVlc3QgKiBfX211c3RfY2hlY2sKIGk5MTVfcmVxdWVzdF9jcmVhdGUo
c3RydWN0IGludGVsX2NvbnRleHQgKmNlKTsKIAogc3RydWN0IGk5MTVfcmVxdWVzdCAqX19pOTE1
X3JlcXVlc3RfY29tbWl0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QpOwordm9pZCBfX2k5
MTVfcmVxdWVzdF9xdWV1ZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKKwkJCSAgY29uc3Qgc3Ry
dWN0IGk5MTVfc2NoZWRfYXR0ciAqYXR0cik7CiAKIHZvaWQgaTkxNV9yZXF1ZXN0X3JldGlyZV91
cHRvKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2No
ZWR1bGVyLmMKaW5kZXggMGJkNDUyZTg1MWQ4Li43Yjg0ZWJjYTI5MDEgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9zY2hlZHVsZXIuYwpAQCAtMzQ5LDggKzM0OSw3IEBAIHZvaWQgaTkxNV9zY2hl
ZHVsZV9idW1wX3ByaW9yaXR5KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCB1bnNpZ25lZCBpbnQg
YnVtcCkKIAl1bnNpZ25lZCBsb25nIGZsYWdzOwogCiAJR0VNX0JVR19PTihidW1wICYgfkk5MTVf
UFJJT1JJVFlfTUFTSyk7Ci0KLQlpZiAoUkVBRF9PTkNFKHJxLT5zY2hlZC5hdHRyLnByaW9yaXR5
KSA9PSBJOTE1X1BSSU9SSVRZX0lOVkFMSUQpCisJaWYgKFJFQURfT05DRShycS0+c2NoZWQuYXR0
ci5wcmlvcml0eSkgJiBidW1wKQogCQlyZXR1cm47CiAKIAlzcGluX2xvY2tfaXJxc2F2ZSgmc2No
ZWR1bGVfbG9jaywgZmxhZ3MpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfd2FrZXJlZi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd2FrZXJlZi5jCmluZGV4
IGQ0NDQzZTgxYzFjOC4uODY4Y2M3ODA0OGQwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF93YWtlcmVmLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd2Fr
ZXJlZi5jCkBAIC01NywxMiArNTcsMTAgQEAgc3RhdGljIHZvaWQgX19fX2ludGVsX3dha2VyZWZf
cHV0X2xhc3Qoc3RydWN0IGludGVsX3dha2VyZWYgKndmKQogCWlmICghYXRvbWljX2RlY19hbmRf
dGVzdCgmd2YtPmNvdW50KSkKIAkJZ290byB1bmxvY2s7CiAKKwkvKiBvcHMtPnB1dCgpIG11c3Qg
cmVzY2hlZHVsZSBpdHMgb3duIHJlbGVhc2Ugb24gZXJyb3IvZGVmZXJyYWwgKi8KIAlpZiAobGlr
ZWx5KCF3Zi0+b3BzLT5wdXQod2YpKSkgewogCQlycG1fcHV0KHdmKTsKIAkJd2FrZV91cF92YXIo
JndmLT53YWtlcmVmKTsKLQl9IGVsc2UgewotCQkvKiBvcHMtPnB1dCgpIG11c3Qgc2NoZWR1bGUg
aXRzIG93biByZWxlYXNlIG9uIGRlZmVycmFsICovCi0JCWF0b21pY19zZXRfcmVsZWFzZSgmd2Yt
PmNvdW50LCAxKTsKIAl9CiAKIHVubG9jazoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2ludGVsX3dha2VyZWYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYu
aAppbmRleCA1MzVhM2ExMjg2NGIuLjVmMGM5NzJhODBmYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaW50ZWxfd2FrZXJlZi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2lu
dGVsX3dha2VyZWYuaApAQCAtMTYzLDYgKzE2MywxNyBAQCBpbnRlbF93YWtlcmVmX2lzX2FjdGl2
ZShjb25zdCBzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiAJcmV0dXJuIFJFQURfT05DRSh3Zi0+
d2FrZXJlZik7CiB9CiAKKy8qKgorICogX19pbnRlbF93YWtlcmVmX2RlZmVyX3Bhcms6IERlZmVy
IHRoZSBjdXJyZW50IHBhcmsgY2FsbGJhY2sKKyAqIEB3ZjogdGhlIHdha2VyZWYKKyAqLworc3Rh
dGljIGlubGluZSB2b2lkCitfX2ludGVsX3dha2VyZWZfZGVmZXJfcGFyayhzdHJ1Y3QgaW50ZWxf
d2FrZXJlZiAqd2YpCit7CisJSU5URUxfV0FLRVJFRl9CVUdfT04oYXRvbWljX3JlYWQoJndmLT5j
b3VudCkpOworCWF0b21pY19zZXRfcmVsZWFzZSgmd2YtPmNvdW50LCAxKTsKK30KKwogLyoqCiAg
KiBpbnRlbF93YWtlcmVmX3dhaXRfZm9yX2lkbGU6IFdhaXQgdW50aWwgdGhlIHdha2VyZWYgaXMg
aWRsZQogICogQHdmOiB0aGUgd2FrZXJlZgotLSAKMi4yMy4wLnJjMQoKX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJ
bnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Au
b3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

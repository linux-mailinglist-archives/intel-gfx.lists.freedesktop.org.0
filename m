Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id DAEA0BDBA9
	for <lists+intel-gfx@lfdr.de>; Wed, 25 Sep 2019 12:01:58 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7E1436EB74;
	Wed, 25 Sep 2019 10:01:52 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E7AA86EB6C
 for <intel-gfx@lists.freedesktop.org>; Wed, 25 Sep 2019 10:01:50 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18609382-1500050 
 for multiple; Wed, 25 Sep 2019 11:01:47 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 25 Sep 2019 11:01:31 +0100
Message-Id: <20190925100137.17956-22-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190925100137.17956-1-chris@chris-wilson.co.uk>
References: <20190925100137.17956-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 21/27] drm/i915: Move context management under
 GEM
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

S2VlcCB0cmFjayBvZiB0aGUgR0VNIGNvbnRleHRzIHVuZGVybmVhdGggaTkxNS0+Z2VtLmNvbnRl
eHRzIGFuZCBhc3NpZ24KdGhlbSB0aGVpciBvd24gbG9jayBmb3IgdGhlIHB1cnBvc2VzIG9mIGxp
c3QgbWFuYWdlbWVudC4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMt
d2lsc29uLmNvLnVrPgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNv
bT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jICAgfCAx
NTUgKysrKysrKy0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
Y29udGV4dC5oICAgfCAgIDQgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRl
eHRfdHlwZXMuaCB8ICAgMiArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1
ZmZlci5jICAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdXNl
cnB0ci5jICAgfCAgIDIgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3Bh
Z2VzLmMgICB8ICAxMiArLQogLi4uL2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29u
dGV4dC5jIHwgMTIyICsrKysrKy0tLS0tLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVz
dHMvbW9ja19jb250ZXh0LmMgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2NvbnRleHQuYyAgICAgICB8ICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfY29udGV4dC5jICAgIHwgIDI0ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfaGFuZ2NoZWNrLmMgIHwgIDE5ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfbHJjLmMgICAgICAgIHwgICA0ICstCiAuLi4vZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dv
cmthcm91bmRzLmMgICAgfCAgMTAgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVs
ZXIuYyAgICAgICAgICB8ICAyMCArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdm
cy5jICAgICAgICAgICB8ICA1MCArKystLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2
LmMgICAgICAgICAgICAgICB8ICAgMiAtCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5o
ICAgICAgICAgICAgICAgfCAgMjcgKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5j
ICAgICAgICAgICAgICAgfCAgMTAgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0
dC5jICAgICAgICAgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMg
ICAgICAgICAgICAgIHwgIDI0ICsrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zeXNmcy5j
ICAgICAgICAgICAgIHwgIDc3ICsrKystLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV90
cmFjZS5oICAgICAgICAgICAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaTkxNV9nZW0uYyAgICAgfCAgIDggLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV9nZW1fZXZpY3QuYyAgIHwgICAzIC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
OTE1X2dlbV9ndHQuYyB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5
MTVfcmVxdWVzdC5jIHwgIDExICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV92bWEuYyAgICAgfCAgIDUgKy0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2Vt
X2RldmljZS5jICB8ICAgNiArLQogMjggZmlsZXMgY2hhbmdlZCwgMjcyIGluc2VydGlvbnMoKyks
IDM0OSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2Nv
bnRleHQuYwppbmRleCA0ZTU5YjgwOWQ5MDEuLmE3N2Y0MzkzNThkNyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCkBAIC0yMTksOSArMjE5LDEyIEBAIHN0
YXRpYyBzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lcyAqZGVmYXVsdF9lbmdpbmVzKHN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICpjdHgpCiAKIHN0YXRpYyB2b2lkIGk5MTVfZ2VtX2NvbnRleHRfZnJlZShz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQogewotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmN0
eC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJR0VNX0JVR19PTighaTkxNV9nZW1fY29udGV4
dF9pc19jbG9zZWQoY3R4KSk7CiAKKwlzcGluX2xvY2soJmN0eC0+aTkxNS0+Z2VtLmNvbnRleHRz
LmxvY2spOworCWxpc3RfZGVsKCZjdHgtPmxpbmspOworCXNwaW5fdW5sb2NrKCZjdHgtPmk5MTUt
PmdlbS5jb250ZXh0cy5sb2NrKTsKKwogCWZyZWVfZW5naW5lcyhyY3VfYWNjZXNzX3BvaW50ZXIo
Y3R4LT5lbmdpbmVzKSk7CiAJbXV0ZXhfZGVzdHJveSgmY3R4LT5lbmdpbmVzX211dGV4KTsKIApA
QCAtMjMxLDU2ICsyMzQsNDAgQEAgc3RhdGljIHZvaWQgaTkxNV9nZW1fY29udGV4dF9mcmVlKHN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCiAJa2ZyZWUoY3R4LT5uYW1lKTsKIAlwdXRfcGlk
KGN0eC0+cGlkKTsKIAotCWxpc3RfZGVsKCZjdHgtPmxpbmspOwogCW11dGV4X2Rlc3Ryb3koJmN0
eC0+bXV0ZXgpOwogCiAJa2ZyZWVfcmN1KGN0eCwgcmN1KTsKIH0KIAotc3RhdGljIHZvaWQgY29u
dGV4dHNfZnJlZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3N0YXRpYyB2b2lkIGNv
bnRleHRzX2ZyZWVfYWxsKHN0cnVjdCBsbGlzdF9ub2RlICpsaXN0KQogewotCXN0cnVjdCBsbGlz
dF9ub2RlICpmcmVlZCA9IGxsaXN0X2RlbF9hbGwoJmk5MTUtPmNvbnRleHRzLmZyZWVfbGlzdCk7
CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwgKmNuOwogCi0JbG9ja2RlcF9hc3NlcnRf
aGVsZCgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQlsbGlzdF9mb3JfZWFjaF9lbnRyeV9z
YWZlKGN0eCwgY24sIGZyZWVkLCBmcmVlX2xpbmspCisJbGxpc3RfZm9yX2VhY2hfZW50cnlfc2Fm
ZShjdHgsIGNuLCBsaXN0LCBmcmVlX2xpbmspCiAJCWk5MTVfZ2VtX2NvbnRleHRfZnJlZShjdHgp
OwogfQogCi1zdGF0aWMgdm9pZCBjb250ZXh0c19mcmVlX2ZpcnN0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQorc3RhdGljIHZvaWQgY29udGV4dHNfZmx1c2hfZnJlZShzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dHMgKmdjKQogewotCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7Ci0J
c3RydWN0IGxsaXN0X25vZGUgKmZyZWVkOwotCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQlmcmVlZCA9IGxsaXN0X2RlbF9maXJzdCgmaTkxNS0+Y29u
dGV4dHMuZnJlZV9saXN0KTsKLQlpZiAoIWZyZWVkKQotCQlyZXR1cm47Ci0KLQljdHggPSBjb250
YWluZXJfb2YoZnJlZWQsIHR5cGVvZigqY3R4KSwgZnJlZV9saW5rKTsKLQlpOTE1X2dlbV9jb250
ZXh0X2ZyZWUoY3R4KTsKKwljb250ZXh0c19mcmVlX2FsbChsbGlzdF9kZWxfYWxsKCZnYy0+ZnJl
ZV9saXN0KSk7CiB9CiAKIHN0YXRpYyB2b2lkIGNvbnRleHRzX2ZyZWVfd29ya2VyKHN0cnVjdCB3
b3JrX3N0cnVjdCAqd29yaykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9Ci0J
CWNvbnRhaW5lcl9vZih3b3JrLCB0eXBlb2YoKmk5MTUpLCBjb250ZXh0cy5mcmVlX3dvcmspOwor
CXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0cyAqZ2MgPQorCQljb250YWluZXJfb2Yod29yaywgdHlw
ZW9mKCpnYyksIGZyZWVfd29yayk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKLQljb250ZXh0c19mcmVlKGk5MTUpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CisJY29udGV4dHNfZmx1c2hfZnJlZShnYyk7CiB9CiAKIHZvaWQgaTkxNV9n
ZW1fY29udGV4dF9yZWxlYXNlKHN0cnVjdCBrcmVmICpyZWYpCiB7CiAJc3RydWN0IGk5MTVfZ2Vt
X2NvbnRleHQgKmN0eCA9IGNvbnRhaW5lcl9vZihyZWYsIHR5cGVvZigqY3R4KSwgcmVmKTsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGN0eC0+aTkxNTsKKwlzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dHMgKmdjID0gJmN0eC0+aTkxNS0+Z2VtLmNvbnRleHRzOwogCiAJdHJhY2VfaTkx
NV9jb250ZXh0X2ZyZWUoY3R4KTsKLQlpZiAobGxpc3RfYWRkKCZjdHgtPmZyZWVfbGluaywgJmk5
MTUtPmNvbnRleHRzLmZyZWVfbGlzdCkpCi0JCXF1ZXVlX3dvcmsoaTkxNS0+d3EsICZpOTE1LT5j
b250ZXh0cy5mcmVlX3dvcmspOworCWlmIChsbGlzdF9hZGQoJmN0eC0+ZnJlZV9saW5rLCAmZ2Mt
PmZyZWVfbGlzdCkpCisJCXF1ZXVlX3dvcmsoY3R4LT5pOTE1LT53cSwgJmdjLT5mcmVlX3dvcmsp
OwogfQogCiBzdGF0aWMgaW5saW5lIHN0cnVjdCBpOTE1X2dlbV9lbmdpbmVzICoKQEAgLTM1OSw4
ICszNDYsOCBAQCBzdGF0aWMgdm9pZCBjb250ZXh0X2Nsb3NlKHN0cnVjdCBpOTE1X2dlbV9jb250
ZXh0ICpjdHgpCiB7CiAJaTkxNV9nZW1fY29udGV4dF9zZXRfY2xvc2VkKGN0eCk7CiAKLQlpZiAo
Y3R4LT52bSkKLQkJaTkxNV92bV9jbG9zZShjdHgtPnZtKTsKKwlpZiAocmN1X2FjY2Vzc19wb2lu
dGVyKGN0eC0+dm0pKQorCQlpOTE1X3ZtX2Nsb3NlKHJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQo
Y3R4LT52bSwgdHJ1ZSkpOwogCiAJbXV0ZXhfbG9jaygmY3R4LT5tdXRleCk7CiAKQEAgLTM5NCw3
ICszODEsNiBAQCBfX2NyZWF0ZV9jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQogCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKIAogCWtyZWZfaW5pdCgmY3R4LT5yZWYpOwot
CWxpc3RfYWRkX3RhaWwoJmN0eC0+bGluaywgJmk5MTUtPmNvbnRleHRzLmxpc3QpOwogCWN0eC0+
aTkxNSA9IGk5MTU7CiAJY3R4LT5zY2hlZC5wcmlvcml0eSA9IEk5MTVfVVNFUl9QUklPUklUWShJ
OTE1X1BSSU9SSVRZX05PUk1BTCk7CiAJbXV0ZXhfaW5pdCgmY3R4LT5tdXRleCk7CkBAIC00MzUs
NiArNDIxLDEwIEBAIF9fY3JlYXRlX2NvbnRleHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCiAJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUoY3R4LT5oYW5nX3RpbWVzdGFtcCk7IGkr
KykKIAkJY3R4LT5oYW5nX3RpbWVzdGFtcFtpXSA9IGppZmZpZXMgLSBDT05URVhUX0ZBU1RfSEFO
R19KSUZGSUVTOwogCisJc3Bpbl9sb2NrKCZpOTE1LT5nZW0uY29udGV4dHMubG9jayk7CisJbGlz
dF9hZGRfdGFpbCgmY3R4LT5saW5rLCAmaTkxNS0+Z2VtLmNvbnRleHRzLmxpc3QpOworCXNwaW5f
dW5sb2NrKCZpOTE1LT5nZW0uY29udGV4dHMubG9jayk7CisKIAlyZXR1cm4gY3R4OwogCiBlcnJf
ZnJlZToKQEAgLTQ2NCwxMSArNDU0LDExIEBAIHN0YXRpYyB2b2lkIF9fYXBwbHlfcHBndHQoc3Ry
dWN0IGludGVsX2NvbnRleHQgKmNlLCB2b2lkICp2bSkKIHN0YXRpYyBzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlICoKIF9fc2V0X3BwZ3R0KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsIHN0
cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogewotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3Bh
Y2UgKm9sZCA9IGN0eC0+dm07CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqb2xkID0gcmN1
X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChjdHgtPnZtLCAxKTsKIAogCUdFTV9CVUdfT04ob2xkICYm
IGk5MTVfdm1faXNfNGx2bCh2bSkgIT0gaTkxNV92bV9pc180bHZsKG9sZCkpOwogCi0JY3R4LT52
bSA9IGk5MTVfdm1fb3Blbih2bSk7CisJcmN1X2Fzc2lnbl9wb2ludGVyKGN0eC0+dm0sIGk5MTVf
dm1fb3Blbih2bSkpOwogCWNvbnRleHRfYXBwbHlfYWxsKGN0eCwgX19hcHBseV9wcGd0dCwgdm0p
OwogCiAJcmV0dXJuIG9sZDsKQEAgLTQ3Nyw3ICs0NjcsNyBAQCBfX3NldF9wcGd0dChzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqY3R4LCBzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIHN0
YXRpYyB2b2lkIF9fYXNzaWduX3BwZ3R0KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJ
CQkgICBzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIHsKLQlpZiAodm0gPT0gY3R4LT52
bSkKKwlpZiAodm0gPT0gcmN1X2FjY2Vzc19wb2ludGVyKGN0eC0+dm0pKQogCQlyZXR1cm47CiAK
IAl2bSA9IF9fc2V0X3BwZ3R0KGN0eCwgdm0pOwpAQCAtNTA5LDI3ICs0OTksMjUgQEAgc3RhdGlj
IHZvaWQgX19hc3NpZ25fdGltZWxpbmUoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIH0K
IAogc3RhdGljIHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICoKLWk5MTVfZ2VtX2NyZWF0ZV9jb250
ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdW5zaWduZWQgaW50IGZsYWdz
KQoraTkxNV9nZW1fY3JlYXRlX2NvbnRleHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
IHVuc2lnbmVkIGludCBmbGFncykKIHsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4Owog
Ci0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJ
aWYgKGZsYWdzICYgSTkxNV9DT05URVhUX0NSRUFURV9GTEFHU19TSU5HTEVfVElNRUxJTkUgJiYK
LQkgICAgIUhBU19FWEVDTElTVFMoZGV2X3ByaXYpKQorCSAgICAhSEFTX0VYRUNMSVNUUyhpOTE1
KSkKIAkJcmV0dXJuIEVSUl9QVFIoLUVJTlZBTCk7CiAKLQkvKiBSZWFwIHRoZSBtb3N0IHN0YWxl
IGNvbnRleHQgKi8KLQljb250ZXh0c19mcmVlX2ZpcnN0KGRldl9wcml2KTsKKwkvKiBSZWFwIHRo
ZSBzdGFsZSBjb250ZXh0cyAqLworCWNvbnRleHRzX2ZsdXNoX2ZyZWUoJmk5MTUtPmdlbS5jb250
ZXh0cyk7CiAKLQljdHggPSBfX2NyZWF0ZV9jb250ZXh0KGRldl9wcml2KTsKKwljdHggPSBfX2Ny
ZWF0ZV9jb250ZXh0KGk5MTUpOwogCWlmIChJU19FUlIoY3R4KSkKIAkJcmV0dXJuIGN0eDsKIAot
CWlmIChIQVNfRlVMTF9QUEdUVChkZXZfcHJpdikpIHsKKwlpZiAoSEFTX0ZVTExfUFBHVFQoaTkx
NSkpIHsKIAkJc3RydWN0IGk5MTVfcHBndHQgKnBwZ3R0OwogCi0JCXBwZ3R0ID0gaTkxNV9wcGd0
dF9jcmVhdGUoZGV2X3ByaXYpOworCQlwcGd0dCA9IGk5MTVfcHBndHRfY3JlYXRlKGk5MTUpOwog
CQlpZiAoSVNfRVJSKHBwZ3R0KSkgewogCQkJRFJNX0RFQlVHX0RSSVZFUigiUFBHVFQgc2V0dXAg
ZmFpbGVkICglbGQpXG4iLAogCQkJCQkgUFRSX0VSUihwcGd0dCkpOwpAQCAtNTQ0LDcgKzUzMiw3
IEBAIGk5MTVfZ2VtX2NyZWF0ZV9jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwgdW5zaWduZWQgaW50IGZsYWdzKQogCWlmIChmbGFncyAmIEk5MTVfQ09OVEVYVF9DUkVB
VEVfRkxBR1NfU0lOR0xFX1RJTUVMSU5FKSB7CiAJCXN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGlt
ZWxpbmU7CiAKLQkJdGltZWxpbmUgPSBpbnRlbF90aW1lbGluZV9jcmVhdGUoJmRldl9wcml2LT5n
dCwgTlVMTCk7CisJCXRpbWVsaW5lID0gaW50ZWxfdGltZWxpbmVfY3JlYXRlKCZpOTE1LT5ndCwg
TlVMTCk7CiAJCWlmIChJU19FUlIodGltZWxpbmUpKSB7CiAJCQljb250ZXh0X2Nsb3NlKGN0eCk7
CiAJCQlyZXR1cm4gRVJSX0NBU1QodGltZWxpbmUpOwpAQCAtNTkwLDQ4ICs1NzgsNDAgQEAgaTkx
NV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LCBpbnQgcHJpbykKIAlyZXR1cm4gY3R4OwogfQogCi1zdGF0aWMgdm9pZCBpbml0X2NvbnRleHRz
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQorc3RhdGljIHZvaWQgaW5pdF9jb250ZXh0
cyhzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dHMgKmdjKQogewotCW11dGV4X2luaXQoJmk5MTUtPmNv
bnRleHRzLm11dGV4KTsKLQlJTklUX0xJU1RfSEVBRCgmaTkxNS0+Y29udGV4dHMubGlzdCk7Ci0K
LQkvKiBVc2luZyB0aGUgc2ltcGxlIGlkYSBpbnRlcmZhY2UsIHRoZSBtYXggaXMgbGltaXRlZCBi
eSBzaXplb2YoaW50KSAqLwotCUJVSUxEX0JVR19PTihNQVhfQ09OVEVYVF9IV19JRCA+IElOVF9N
QVgpOwotCUJVSUxEX0JVR19PTihHRU4xMV9NQVhfQ09OVEVYVF9IV19JRCA+IElOVF9NQVgpOwot
CWlkYV9pbml0KCZpOTE1LT5jb250ZXh0cy5od19pZGEpOwotCUlOSVRfTElTVF9IRUFEKCZpOTE1
LT5jb250ZXh0cy5od19pZF9saXN0KTsKKwlzcGluX2xvY2tfaW5pdCgmZ2MtPmxvY2spOworCUlO
SVRfTElTVF9IRUFEKCZnYy0+bGlzdCk7CiAKLQlJTklUX1dPUksoJmk5MTUtPmNvbnRleHRzLmZy
ZWVfd29yaywgY29udGV4dHNfZnJlZV93b3JrZXIpOwotCWluaXRfbGxpc3RfaGVhZCgmaTkxNS0+
Y29udGV4dHMuZnJlZV9saXN0KTsKKwlJTklUX1dPUksoJmdjLT5mcmVlX3dvcmssIGNvbnRleHRz
X2ZyZWVfd29ya2VyKTsKKwlpbml0X2xsaXN0X2hlYWQoJmdjLT5mcmVlX2xpc3QpOwogfQogCi1p
bnQgaTkxNV9nZW1fY29udGV4dHNfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCitpbnQgaTkxNV9nZW1faW5pdF9jb250ZXh0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIHsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwogCiAJLyogUmVhc3N1cmUg
b3Vyc2VsdmVzIHdlIGFyZSBvbmx5IGNhbGxlZCBvbmNlICovCi0JR0VNX0JVR19PTihkZXZfcHJp
di0+a2VybmVsX2NvbnRleHQpOworCUdFTV9CVUdfT04oaTkxNS0+a2VybmVsX2NvbnRleHQpOwog
Ci0JaW5pdF9jb250ZXh0cyhkZXZfcHJpdik7CisJaW5pdF9jb250ZXh0cygmaTkxNS0+Z2VtLmNv
bnRleHRzKTsKIAogCS8qIGxvd2VzdCBwcmlvcml0eTsgaWRsZSB0YXNrICovCi0JY3R4ID0gaTkx
NV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKGRldl9wcml2LCBJOTE1X1BSSU9SSVRZX01JTik7
CisJY3R4ID0gaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKGk5MTUsIEk5MTVfUFJJT1JJ
VFlfTUlOKTsKIAlpZiAoSVNfRVJSKGN0eCkpIHsKIAkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gY3Jl
YXRlIGRlZmF1bHQgZ2xvYmFsIGNvbnRleHRcbiIpOwogCQlyZXR1cm4gUFRSX0VSUihjdHgpOwog
CX0KLQlkZXZfcHJpdi0+a2VybmVsX2NvbnRleHQgPSBjdHg7CisJaTkxNS0+a2VybmVsX2NvbnRl
eHQgPSBjdHg7CiAKIAlEUk1fREVCVUdfRFJJVkVSKCIlcyBjb250ZXh0IHN1cHBvcnQgaW5pdGlh
bGl6ZWRcbiIsCi0JCQkgRFJJVkVSX0NBUFMoZGV2X3ByaXYpLT5oYXNfbG9naWNhbF9jb250ZXh0
cyA/CisJCQkgRFJJVkVSX0NBUFMoaTkxNSktPmhhc19sb2dpY2FsX2NvbnRleHRzID8KIAkJCSAi
bG9naWNhbCIgOiAiZmFrZSIpOwogCXJldHVybiAwOwogfQogCi12b2lkIGk5MTVfZ2VtX2NvbnRl
eHRzX2Zpbmkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCit2b2lkIGk5MTVfZ2VtX2Ry
aXZlcl9yZWxlYXNlX19jb250ZXh0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsK
LQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWRlc3Ry
b3lfa2VybmVsX2NvbnRleHQoJmk5MTUtPmtlcm5lbF9jb250ZXh0KTsKIH0KIApAQCAtNjUzLDgg
KzYzMyw4IEBAIHN0YXRpYyBpbnQgZ2VtX2NvbnRleHRfcmVnaXN0ZXIoc3RydWN0IGk5MTVfZ2Vt
X2NvbnRleHQgKmN0eCwKIAlpbnQgcmV0OwogCiAJY3R4LT5maWxlX3ByaXYgPSBmcHJpdjsKLQlp
ZiAoY3R4LT52bSkKLQkJY3R4LT52bS0+ZmlsZSA9IGZwcml2OworCWlmIChyY3VfYWNjZXNzX3Bv
aW50ZXIoY3R4LT52bSkpCisJCXJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQoY3R4LT52bSwgdHJ1
ZSktPmZpbGUgPSBmcHJpdjsKIAogCWN0eC0+cGlkID0gZ2V0X3Rhc2tfcGlkKGN1cnJlbnQsIFBJ
RFRZUEVfUElEKTsKIAljdHgtPm5hbWUgPSBrYXNwcmludGYoR0ZQX0tFUk5FTCwgIiVzWyVkXSIs
CkBAIC02OTEsOSArNjcxLDcgQEAgaW50IGk5MTVfZ2VtX2NvbnRleHRfb3BlbihzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlpZHJfaW5pdCgmZmlsZV9wcml2LT5jb250ZXh0X2lkcik7
CiAJaWRyX2luaXRfYmFzZSgmZmlsZV9wcml2LT52bV9pZHIsIDEpOwogCi0JbXV0ZXhfbG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJY3R4ID0gaTkxNV9nZW1fY3JlYXRlX2NvbnRleHQo
aTkxNSwgMCk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpZiAo
SVNfRVJSKGN0eCkpIHsKIAkJZXJyID0gUFRSX0VSUihjdHgpOwogCQlnb3RvIGVycjsKQEAgLTcy
MSw2ICs2OTksNyBAQCBpbnQgaTkxNV9nZW1fY29udGV4dF9vcGVuKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogdm9pZCBpOTE1X2dlbV9jb250ZXh0X2Nsb3NlKHN0cnVjdCBkcm1fZmls
ZSAqZmlsZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfZmlsZV9wcml2YXRlICpmaWxlX3ByaXYgPSBm
aWxlLT5kcml2ZXJfcHJpdjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGZpbGVf
cHJpdi0+ZGV2X3ByaXY7CiAKIAlpZHJfZm9yX2VhY2goJmZpbGVfcHJpdi0+Y29udGV4dF9pZHIs
IGNvbnRleHRfaWRyX2NsZWFudXAsIE5VTEwpOwogCWlkcl9kZXN0cm95KCZmaWxlX3ByaXYtPmNv
bnRleHRfaWRyKTsKQEAgLTcyOSw2ICs3MDgsOCBAQCB2b2lkIGk5MTVfZ2VtX2NvbnRleHRfY2xv
c2Uoc3RydWN0IGRybV9maWxlICpmaWxlKQogCWlkcl9mb3JfZWFjaCgmZmlsZV9wcml2LT52bV9p
ZHIsIHZtX2lkcl9jbGVhbnVwLCBOVUxMKTsKIAlpZHJfZGVzdHJveSgmZmlsZV9wcml2LT52bV9p
ZHIpOwogCW11dGV4X2Rlc3Ryb3koJmZpbGVfcHJpdi0+dm1faWRyX2xvY2spOworCisJY29udGV4
dHNfZmx1c2hfZnJlZSgmaTkxNS0+Z2VtLmNvbnRleHRzKTsKIH0KIAogaW50IGk5MTVfZ2VtX3Zt
X2NyZWF0ZV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLApAQCAtOTA3
LDE2ICs4ODgsMTIgQEAgc3RhdGljIGludCBnZXRfcHBndHQoc3RydWN0IGRybV9pOTE1X2ZpbGVf
cHJpdmF0ZSAqZmlsZV9wcml2LAogCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwogCWlu
dCByZXQ7CiAKLQlpZiAoIWN0eC0+dm0pCisJaWYgKCFyY3VfYWNjZXNzX3BvaW50ZXIoY3R4LT52
bSkpCiAJCXJldHVybiAtRU5PREVWOwogCi0JLyogWFhYIHJjdSBhY3F1aXJlPyAqLwotCXJldCA9
IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmY3R4LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
LQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCisJcmN1X3JlYWRfbG9jaygpOwogCXZtID0gaTkx
NV92bV9nZXQoY3R4LT52bSk7Ci0JbXV0ZXhfdW5sb2NrKCZjdHgtPmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOworCXJjdV9yZWFkX3VubG9jaygpOwogCiAJcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1
cHRpYmxlKCZmaWxlX3ByaXYtPnZtX2lkcl9sb2NrKTsKIAlpZiAocmV0KQpAQCAtMTAyNSw3ICsx
MDAyLDcgQEAgc3RhdGljIGludCBzZXRfcHBndHQoc3RydWN0IGRybV9pOTE1X2ZpbGVfcHJpdmF0
ZSAqZmlsZV9wcml2LAogCWlmIChhcmdzLT5zaXplKQogCQlyZXR1cm4gLUVJTlZBTDsKIAotCWlm
ICghY3R4LT52bSkKKwlpZiAoIXJjdV9hY2Nlc3NfcG9pbnRlcihjdHgtPnZtKSkKIAkJcmV0dXJu
IC1FTk9ERVY7CiAKIAlpZiAodXBwZXJfMzJfYml0cyhhcmdzLT52YWx1ZSkpCkBAIC0xMDM5LDE3
ICsxMDE2LDE1IEBAIHN0YXRpYyBpbnQgc2V0X3BwZ3R0KHN0cnVjdCBkcm1faTkxNV9maWxlX3By
aXZhdGUgKmZpbGVfcHJpdiwKIAlpZiAoIXZtKQogCQlyZXR1cm4gLUVOT0VOVDsKIAotCWVyciA9
IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmY3R4LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
KwllcnIgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmN0eC0+bXV0ZXgpOwogCWlmIChlcnIp
CiAJCWdvdG8gb3V0OwogCi0JaWYgKHZtID09IGN0eC0+dm0pCisJaWYgKHZtID09IHJjdV9hY2Nl
c3NfcG9pbnRlcihjdHgtPnZtKSkKIAkJZ290byB1bmxvY2s7CiAKIAkvKiBUZWFyZG93biB0aGUg
ZXhpc3Rpbmcgb2JqOnZtYSBjYWNoZSwgaXQgd2lsbCBoYXZlIHRvIGJlIHJlYnVpbHQuICovCi0J
bXV0ZXhfbG9jaygmY3R4LT5tdXRleCk7CiAJbHV0X2Nsb3NlKGN0eCk7Ci0JbXV0ZXhfdW5sb2Nr
KCZjdHgtPm11dGV4KTsKIAogCW9sZCA9IF9fc2V0X3BwZ3R0KGN0eCwgdm0pOwogCkBAIC0xMDY5
LDggKzEwNDQsNyBAQCBzdGF0aWMgaW50IHNldF9wcGd0dChzdHJ1Y3QgZHJtX2k5MTVfZmlsZV9w
cml2YXRlICpmaWxlX3ByaXYsCiAJfQogCiB1bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZjdHgtPmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCisJbXV0ZXhfdW5sb2NrKCZjdHgtPm11dGV4KTsKIG91
dDoKIAlpOTE1X3ZtX3B1dCh2bSk7CiAJcmV0dXJuIGVycjsKQEAgLTE5NTMsNyArMTkyNyw3IEBA
IHN0YXRpYyBpbnQgY2xvbmVfdm0oc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmRzdCwKIAogCXJj
dV9yZWFkX2xvY2soKTsKIAlkbyB7Ci0JCXZtID0gUkVBRF9PTkNFKHNyYy0+dm0pOworCQl2bSA9
IHJjdV9kZXJlZmVyZW5jZShzcmMtPnZtKTsKIAkJaWYgKCF2bSkKIAkJCWJyZWFrOwogCkBAIC0x
OTc1LDcgKzE5NDksNyBAQCBzdGF0aWMgaW50IGNsb25lX3ZtKHN0cnVjdCBpOTE1X2dlbV9jb250
ZXh0ICpkc3QsCiAJCSAqIGl0IGNhbm5vdCBiZSByZWFsbG9jYXRlZCBlbHNld2hlcmUuCiAJCSAq
LwogCi0JCWlmICh2bSA9PSBSRUFEX09OQ0Uoc3JjLT52bSkpCisJCWlmICh2bSA9PSByY3VfYWNj
ZXNzX3BvaW50ZXIoc3JjLT52bSkpCiAJCQlicmVhazsKIAogCQlpOTE1X3ZtX3B1dCh2bSk7CkBA
IC0yMDc3LDEyICsyMDUxLDcgQEAgaW50IGk5MTVfZ2VtX2NvbnRleHRfY3JlYXRlX2lvY3RsKHN0
cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCXJldHVybiAtRUlPOwogCX0KIAot
CXJldCA9IGk5MTVfbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKGRldik7Ci0JaWYgKHJldCkKLQkJ
cmV0dXJuIHJldDsKLQogCWV4dF9kYXRhLmN0eCA9IGk5MTVfZ2VtX2NyZWF0ZV9jb250ZXh0KGk5
MTUsIGFyZ3MtPmZsYWdzKTsKLQltdXRleF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKIAlp
ZiAoSVNfRVJSKGV4dF9kYXRhLmN0eCkpCiAJCXJldHVybiBQVFJfRVJSKGV4dF9kYXRhLmN0eCk7
CiAKQEAgLTIyMDksMTAgKzIxNzgsMTIgQEAgaW50IGk5MTVfZ2VtX2NvbnRleHRfZ2V0cGFyYW1f
aW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAogCWNhc2UgSTkxNV9D
T05URVhUX1BBUkFNX0dUVF9TSVpFOgogCQlhcmdzLT5zaXplID0gMDsKLQkJaWYgKGN0eC0+dm0p
Ci0JCQlhcmdzLT52YWx1ZSA9IGN0eC0+dm0tPnRvdGFsOworCQlyY3VfcmVhZF9sb2NrKCk7CisJ
CWlmIChyY3VfYWNjZXNzX3BvaW50ZXIoY3R4LT52bSkpCisJCQlhcmdzLT52YWx1ZSA9IHJjdV9k
ZXJlZmVyZW5jZShjdHgtPnZtKS0+dG90YWw7CiAJCWVsc2UKIAkJCWFyZ3MtPnZhbHVlID0gdG9f
aTkxNShkZXYpLT5nZ3R0LnZtLnRvdGFsOworCQlyY3VfcmVhZF91bmxvY2soKTsKIAkJYnJlYWs7
CiAKIAljYXNlIEk5MTVfQ09OVEVYVF9QQVJBTV9OT19FUlJPUl9DQVBUVVJFOgpAQCAtMjI4Myw3
ICsyMjU0LDcgQEAgaW50IGk5MTVfZ2VtX2NvbnRleHRfc2V0cGFyYW1faW9jdGwoc3RydWN0IGRy
bV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIGludCBpOTE1X2dlbV9jb250ZXh0X3Jlc2V0X3N0
YXRzX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCQkJICAgICAgIHZvaWQgKmRhdGEs
IHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0
b19pOTE1KGRldik7CiAJc3RydWN0IGRybV9pOTE1X3Jlc2V0X3N0YXRzICphcmdzID0gZGF0YTsK
IAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwogCWludCByZXQ7CkBAIC0yMzA1LDcgKzIy
NzYsNyBAQCBpbnQgaTkxNV9nZW1fY29udGV4dF9yZXNldF9zdGF0c19pb2N0bChzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2LAogCSAqLwogCiAJaWYgKGNhcGFibGUoQ0FQX1NZU19BRE1JTikpCi0JCWFy
Z3MtPnJlc2V0X2NvdW50ID0gaTkxNV9yZXNldF9jb3VudCgmZGV2X3ByaXYtPmdwdV9lcnJvcik7
CisJCWFyZ3MtPnJlc2V0X2NvdW50ID0gaTkxNV9yZXNldF9jb3VudCgmaTkxNS0+Z3B1X2Vycm9y
KTsKIAllbHNlCiAJCWFyZ3MtPnJlc2V0X2NvdW50ID0gMDsKIApkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaCBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmgKaW5kZXggMWIwZGY1MzQzNmNmLi40ZWU1ZGZjNTc5
NGUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0
LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaApAQCAt
MTMzLDggKzEzMyw4IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBpOTE1X2dlbV9jb250ZXh0X2lzX2tl
cm5lbChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQogfQogCiAvKiBpOTE1X2dlbV9jb250
ZXh0LmMgKi8KLWludCBfX211c3RfY2hlY2sgaTkxNV9nZW1fY29udGV4dHNfaW5pdChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBpOTE1X2dlbV9jb250ZXh0c19maW5p
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CitpbnQgX19tdXN0X2NoZWNrIGk5
MTVfZ2VtX2luaXRfY29udGV4dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9p
ZCBpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZV9fY29udGV4dHMoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpOwogCiBpbnQgaTkxNV9nZW1fY29udGV4dF9vcGVuKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAogCQkJICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpOwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHRfdHlwZXMuaCBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0X3R5cGVzLmgKaW5kZXggNjQxOWRh
N2M5ZjkwLi5hM2VjZDE5ZjIzMDMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9jb250ZXh0X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX2NvbnRleHRfdHlwZXMuaApAQCAtODgsNyArODgsNyBAQCBzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCB7CiAJICogSW4gb3RoZXIgbW9kZXMsIHRoaXMgaXMgYSBOVUxMIHBvaW50ZXIg
d2l0aCB0aGUgZXhwZWN0YXRpb24gdGhhdAogCSAqIHRoZSBjYWxsZXIgdXNlcyB0aGUgc2hhcmVk
IGdsb2JhbCBHVFQuCiAJICovCi0Jc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CisJc3Ry
dWN0IGk5MTVfYWRkcmVzc19zcGFjZSBfX3JjdSAqdm07CiAKIAkvKioKIAkgKiBAcGlkOiBwcm9j
ZXNzIGlkIG9mIGNyZWF0b3IKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9leGVjYnVmZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
ZXhlY2J1ZmZlci5jCmluZGV4IDg4YTg4MWJlMTJlYy4uOTg4MTZjMzVmZmMzIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKQEAgLTcyOCw3ICs3
MjgsNyBAQCBzdGF0aWMgaW50IGViX3NlbGVjdF9jb250ZXh0KHN0cnVjdCBpOTE1X2V4ZWNidWZm
ZXIgKmViKQogCQlyZXR1cm4gLUVOT0VOVDsKIAogCWViLT5nZW1fY29udGV4dCA9IGN0eDsKLQlp
ZiAoY3R4LT52bSkKKwlpZiAocmN1X2FjY2Vzc19wb2ludGVyKGN0eC0+dm0pKQogCQllYi0+aW52
YWxpZF9mbGFncyB8PSBFWEVDX09CSkVDVF9ORUVEU19HVFQ7CiAKIAllYi0+Y29udGV4dF9mbGFn
cyA9IDA7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdXNl
cnB0ci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYwppbmRl
eCAyNzU3M2VmOTAzYjQuLjdjMjI1ZTFkMmExMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fdXNlcnB0ci5jCkBAIC03NTcsNyArNzU3LDcgQEAgaTkxNV9nZW1fdXNlcnB0
cl9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQkgKiBPbiBhbG1vc3QgYWxsIG9mIHRo
ZSBvbGRlciBodywgd2UgY2Fubm90IHRlbGwgdGhlIEdQVSB0aGF0CiAJCSAqIGEgcGFnZSBpcyBy
ZWFkb25seS4KIAkJICovCi0JCXZtID0gZGV2X3ByaXYtPmtlcm5lbF9jb250ZXh0LT52bTsKKwkJ
dm0gPSByY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKGRldl9wcml2LT5rZXJuZWxfY29udGV4dC0+
dm0sIHRydWUpOwogCQlpZiAoIXZtIHx8ICF2bS0+aGFzX3JlYWRfb25seSkKIAkJCXJldHVybiAt
RU5PREVWOwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVz
dHMvaHVnZV9wYWdlcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdl
X3BhZ2VzLmMKaW5kZXggOThiMmE2Y2NmY2MxLi5lMjA0ZTY1M2I0NTkgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jCkBAIC0xMzIyLDcgKzEz
MjIsNyBAQCBzdGF0aWMgaW50IGlndF9wcGd0dF9waW5fdXBkYXRlKHZvaWQgKmFyZykKIAlzdHJ1
Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4ID0gYXJnOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IGN0eC0+aTkxNTsKIAl1bnNpZ25lZCBsb25nIHN1cHBvcnRlZCA9IElOVEVM
X0lORk8oZGV2X3ByaXYpLT5wYWdlX3NpemVzOwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ug
KnZtID0gY3R4LT52bTsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IHJjdV9kZXJl
ZmVyZW5jZV9wcm90ZWN0ZWQoY3R4LT52bSwgMSk7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iajsKIAlzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lc19pdGVyIGl0OwogCXN0cnVjdCBpbnRl
bF9jb250ZXh0ICpjZTsKQEAgLTE0NjAsNyArMTQ2MCw4IEBAIHN0YXRpYyBpbnQgaWd0X3RtcGZz
X2ZhbGxiYWNrKHZvaWQgKmFyZykKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4ID0gYXJn
OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gY3R4LT5pOTE1OwogCXN0cnVjdCB2
ZnNtb3VudCAqZ2VtZnMgPSBpOTE1LT5tbS5nZW1mczsKLQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3Nw
YWNlICp2bSA9IGN0eC0+dm0gPzogJmk5MTUtPmdndHQudm07CisJc3RydWN0IGk5MTVfYWRkcmVz
c19zcGFjZSAqdm0gPQorCQlyY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKGN0eC0+dm0sIHRydWUp
ID86ICZpOTE1LT5nZ3R0LnZtOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJ
c3RydWN0IGk5MTVfdm1hICp2bWE7CiAJdTMyICp2YWRkcjsKQEAgLTE1MTcsNyArMTUxOCw4IEBA
IHN0YXRpYyBpbnQgaWd0X3Nocmlua190aHAodm9pZCAqYXJnKQogewogCXN0cnVjdCBpOTE1X2dl
bV9jb250ZXh0ICpjdHggPSBhcmc7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBj
dHgtPmk5MTU7Ci0Jc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSBjdHgtPnZtID86ICZp
OTE1LT5nZ3R0LnZtOworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0KKwkJcmN1X2Rl
cmVmZXJlbmNlX3Byb3RlY3RlZChjdHgtPnZtLCB0cnVlKSA/OiAmaTkxNS0+Z2d0dC52bTsKIAlz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwogCXN0cnVjdCBpOTE1X2dlbV9lbmdpbmVz
X2l0ZXIgaXQ7CiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwpAQCAtMTY5OSw4ICsxNzAxLDgg
QEAgaW50IGk5MTVfZ2VtX2h1Z2VfcGFnZV9saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIAkJZ290byBvdXRfdW5sb2NrOwogCX0KIAotCWlmIChjdHgtPnZtKQot
CQljdHgtPnZtLT5zY3J1Yl82NEsgPSB0cnVlOworCWlmIChyY3VfYWNjZXNzX3BvaW50ZXIoY3R4
LT52bSkpCisJCXJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQoY3R4LT52bSwgdHJ1ZSktPnNjcnVi
XzY0SyA9IHRydWU7CiAKIAllcnIgPSBpOTE1X3N1YnRlc3RzKHRlc3RzLCBjdHgpOwogCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRl
eHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4
dC5jCmluZGV4IGE4YTkyOTNmNGFjNi4uN2RlMWMwMDc4ZDZmIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYwpAQCAtNTMs
MTkgKzUzLDE3IEBAIHN0YXRpYyBpbnQgbGl2ZV9ub3Bfc3dpdGNoKHZvaWQgKmFyZykKIAlpZiAo
SVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKIAotCW11dGV4X2xvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJY3R4ID0ga2NhbGxvYyhuY3R4LCBzaXplb2YoKmN0
eCksIEdGUF9LRVJORUwpOwogCWlmICghY3R4KSB7CiAJCWVyciA9IC1FTk9NRU07Ci0JCWdvdG8g
b3V0X3VubG9jazsKKwkJZ290byBvdXRfZmlsZTsKIAl9CiAKIAlmb3IgKG4gPSAwOyBuIDwgbmN0
eDsgbisrKSB7CiAJCWN0eFtuXSA9IGxpdmVfY29udGV4dChpOTE1LCBmaWxlKTsKIAkJaWYgKElT
X0VSUihjdHhbbl0pKSB7CiAJCQllcnIgPSBQVFJfRVJSKGN0eFtuXSk7Ci0JCQlnb3RvIG91dF91
bmxvY2s7CisJCQlnb3RvIG91dF9maWxlOwogCQl9CiAJfQogCkBAIC03OSw3ICs3Nyw3IEBAIHN0
YXRpYyBpbnQgbGl2ZV9ub3Bfc3dpdGNoKHZvaWQgKmFyZykKIAkJCXJxID0gaWd0X3JlcXVlc3Rf
YWxsb2MoY3R4W25dLCBlbmdpbmUpOwogCQkJaWYgKElTX0VSUihycSkpIHsKIAkJCQllcnIgPSBQ
VFJfRVJSKHJxKTsKLQkJCQlnb3RvIG91dF91bmxvY2s7CisJCQkJZ290byBvdXRfZmlsZTsKIAkJ
CX0KIAkJCWk5MTVfcmVxdWVzdF9hZGQocnEpOwogCQl9CkBAIC04Nyw3ICs4NSw3IEBAIHN0YXRp
YyBpbnQgbGl2ZV9ub3Bfc3dpdGNoKHZvaWQgKmFyZykKIAkJCXByX2VycigiRmFpbGVkIHRvIHBv
cHVsYXRlZCAlZCBjb250ZXh0c1xuIiwgbmN0eCk7CiAJCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZp
OTE1LT5ndCk7CiAJCQllcnIgPSAtRUlPOwotCQkJZ290byBvdXRfdW5sb2NrOworCQkJZ290byBv
dXRfZmlsZTsKIAkJfQogCiAJCXRpbWVzWzFdID0ga3RpbWVfZ2V0X3JhdygpOwpAQCAtOTcsNyAr
OTUsNyBAQCBzdGF0aWMgaW50IGxpdmVfbm9wX3N3aXRjaCh2b2lkICphcmcpCiAKIAkJZXJyID0g
aWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgaTkxNSwgX19mdW5jX18sIGVuZ2luZS0+bmFtZSk7CiAJ
CWlmIChlcnIpCi0JCQlnb3RvIG91dF91bmxvY2s7CisJCQlnb3RvIG91dF9maWxlOwogCiAJCWVu
ZF90aW1lID0gamlmZmllcyArIGk5MTVfc2VsZnRlc3QudGltZW91dF9qaWZmaWVzOwogCQlmb3Jf
ZWFjaF9wcmltZV9udW1iZXJfZnJvbShwcmltZSwgMiwgODE5MikgewpAQCAtMTA3LDcgKzEwNSw3
IEBAIHN0YXRpYyBpbnQgbGl2ZV9ub3Bfc3dpdGNoKHZvaWQgKmFyZykKIAkJCQlycSA9IGlndF9y
ZXF1ZXN0X2FsbG9jKGN0eFtuICUgbmN0eF0sIGVuZ2luZSk7CiAJCQkJaWYgKElTX0VSUihycSkp
IHsKIAkJCQkJZXJyID0gUFRSX0VSUihycSk7Ci0JCQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCQkJ
Z290byBvdXRfZmlsZTsKIAkJCQl9CiAKIAkJCQkvKgpAQCAtMTQzLDcgKzE0MSw3IEBAIHN0YXRp
YyBpbnQgbGl2ZV9ub3Bfc3dpdGNoKHZvaWQgKmFyZykKIAogCQllcnIgPSBpZ3RfbGl2ZV90ZXN0
X2VuZCgmdCk7CiAJCWlmIChlcnIpCi0JCQlnb3RvIG91dF91bmxvY2s7CisJCQlnb3RvIG91dF9m
aWxlOwogCiAJCXByX2luZm8oIlN3aXRjaCBsYXRlbmNpZXMgb24gJXM6IDEgPSAlbGx1bnMsICVs
dSA9ICVsbHVuc1xuIiwKIAkJCWVuZ2luZS0+bmFtZSwKQEAgLTE1MSw4ICsxNDksNyBAQCBzdGF0
aWMgaW50IGxpdmVfbm9wX3N3aXRjaCh2b2lkICphcmcpCiAJCQlwcmltZSAtIDEsIGRpdjY0X3U2
NChrdGltZV90b19ucyh0aW1lc1sxXSksIHByaW1lIC0gMSkpOwogCX0KIAotb3V0X3VubG9jazoK
LQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworb3V0X2ZpbGU6CiAJbW9j
a19maWxlX2ZyZWUoaTkxNSwgZmlsZSk7CiAJcmV0dXJuIGVycjsKIH0KQEAgLTQxMiwxMSArNDA5
LDkgQEAgc3RhdGljIGludCBpZ3RfY3R4X2V4ZWModm9pZCAqYXJnKQogCQlpZiAoSVNfRVJSKGZp
bGUpKQogCQkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAKLQkJbXV0ZXhfbG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7Ci0KIAkJZXJyID0gaWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgaTkxNSwg
X19mdW5jX18sIGVuZ2luZS0+bmFtZSk7CiAJCWlmIChlcnIpCi0JCQlnb3RvIG91dF91bmxvY2s7
CisJCQlnb3RvIG91dF9maWxlOwogCiAJCW5jb250ZXh0cyA9IDA7CiAJCW5kd29yZHMgPSAwOwpA
QCAtNDI4LDcgKzQyMyw3IEBAIHN0YXRpYyBpbnQgaWd0X2N0eF9leGVjKHZvaWQgKmFyZykKIAkJ
CWN0eCA9IGtlcm5lbF9jb250ZXh0KGk5MTUpOwogCQkJaWYgKElTX0VSUihjdHgpKSB7CiAJCQkJ
ZXJyID0gUFRSX0VSUihjdHgpOwotCQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCQlnb3RvIG91dF9m
aWxlOwogCQkJfQogCiAJCQljZSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X2VuZ2luZShjdHgsIGVu
Z2luZS0+bGVnYWN5X2lkeCk7CkBAIC00NDAsNyArNDM1LDcgQEAgc3RhdGljIGludCBpZ3RfY3R4
X2V4ZWModm9pZCAqYXJnKQogCQkJCQllcnIgPSBQVFJfRVJSKG9iaik7CiAJCQkJCWludGVsX2Nv
bnRleHRfcHV0KGNlKTsKIAkJCQkJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKLQkJCQkJZ290
byBvdXRfdW5sb2NrOworCQkJCQlnb3RvIG91dF9maWxlOwogCQkJCX0KIAkJCX0KIApAQCAtNDQ5
LDE3ICs0NDQsMTggQEAgc3RhdGljIGludCBpZ3RfY3R4X2V4ZWModm9pZCAqYXJnKQogCQkJCXBy
X2VycigiRmFpbGVkIHRvIGZpbGwgZHdvcmQgJWx1IFslbHUvJWx1XSB3aXRoIGdwdSAoJXMpIFtm
dWxsLXBwZ3R0PyAlc10sIGVycj0lZFxuIiwKIAkJCQkgICAgICAgbmR3b3JkcywgZHcsIG1heF9k
d29yZHMob2JqKSwKIAkJCQkgICAgICAgZW5naW5lLT5uYW1lLAotCQkJCSAgICAgICB5ZXNubygh
IWN0eC0+dm0pLCBlcnIpOworCQkJCSAgICAgICB5ZXNubyghIXJjdV9hY2Nlc3NfcG9pbnRlcihj
dHgtPnZtKSksCisJCQkJICAgICAgIGVycik7CiAJCQkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwog
CQkJCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7Ci0JCQkJZ290byBvdXRfdW5sb2NrOworCQkJ
CWdvdG8gb3V0X2ZpbGU7CiAJCQl9CiAKIAkJCWVyciA9IHRocm90dGxlKGNlLCB0cSwgQVJSQVlf
U0laRSh0cSkpOwogCQkJaWYgKGVycikgewogCQkJCWludGVsX2NvbnRleHRfcHV0KGNlKTsKIAkJ
CQlrZXJuZWxfY29udGV4dF9jbG9zZShjdHgpOwotCQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCQln
b3RvIG91dF9maWxlOwogCQkJfQogCiAJCQlpZiAoKytkdyA9PSBtYXhfZHdvcmRzKG9iaikpIHsK
QEAgLTQ4OSwxMSArNDg1LDEwIEBAIHN0YXRpYyBpbnQgaWd0X2N0eF9leGVjKHZvaWQgKmFyZykK
IAkJCWR3ICs9IHJlbTsKIAkJfQogCi1vdXRfdW5sb2NrOgorb3V0X2ZpbGU6CiAJCXRocm90dGxl
X3JlbGVhc2UodHEsIEFSUkFZX1NJWkUodHEpKTsKIAkJaWYgKGlndF9saXZlX3Rlc3RfZW5kKCZ0
KSkKIAkJCWVyciA9IC1FSU87Ci0JCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAKIAkJbW9ja19maWxlX2ZyZWUoaTkxNSwgZmlsZSk7CiAJCWlmIChlcnIpCkBAIC01Mjgs
MjIgKzUyMywyMCBAQCBzdGF0aWMgaW50IGlndF9zaGFyZWRfY3R4X2V4ZWModm9pZCAqYXJnKQog
CWlmIChJU19FUlIoZmlsZSkpCiAJCXJldHVybiBQVFJfRVJSKGZpbGUpOwogCi0JbXV0ZXhfbG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlwYXJlbnQgPSBsaXZlX2NvbnRleHQoaTkx
NSwgZmlsZSk7CiAJaWYgKElTX0VSUihwYXJlbnQpKSB7CiAJCWVyciA9IFBUUl9FUlIocGFyZW50
KTsKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3RvIG91dF9maWxlOwogCX0KIAogCWlmICghcGFy
ZW50LT52bSkgeyAvKiBub3QgZnVsbC1wcGd0dDsgbm90aGluZyB0byBzaGFyZSAqLwogCQllcnIg
PSAwOwotCQlnb3RvIG91dF91bmxvY2s7CisJCWdvdG8gb3V0X2ZpbGU7CiAJfQogCiAJZXJyID0g
aWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgaTkxNSwgX19mdW5jX18sICIiKTsKIAlpZiAoZXJyKQot
CQlnb3RvIG91dF91bmxvY2s7CisJCWdvdG8gb3V0X2ZpbGU7CiAKIAlmb3JfZWFjaF9lbmdpbmUo
ZW5naW5lLCBpOTE1LCBpZCkgewogCQl1bnNpZ25lZCBsb25nIG5jb250ZXh0cywgbmR3b3Jkcywg
ZHc7CkBAIC01ODcsNyArNTgwLDggQEAgc3RhdGljIGludCBpZ3Rfc2hhcmVkX2N0eF9leGVjKHZv
aWQgKmFyZykKIAkJCQlwcl9lcnIoIkZhaWxlZCB0byBmaWxsIGR3b3JkICVsdSBbJWx1LyVsdV0g
d2l0aCBncHUgKCVzKSBbZnVsbC1wcGd0dD8gJXNdLCBlcnI9JWRcbiIsCiAJCQkJICAgICAgIG5k
d29yZHMsIGR3LCBtYXhfZHdvcmRzKG9iaiksCiAJCQkJICAgICAgIGVuZ2luZS0+bmFtZSwKLQkJ
CQkgICAgICAgeWVzbm8oISFjdHgtPnZtKSwgZXJyKTsKKwkJCQkgICAgICAgeWVzbm8oISFyY3Vf
YWNjZXNzX3BvaW50ZXIoY3R4LT52bSkpLAorCQkJCSAgICAgICBlcnIpOwogCQkJCWludGVsX2Nv
bnRleHRfcHV0KGNlKTsKIAkJCQlrZXJuZWxfY29udGV4dF9jbG9zZShjdHgpOwogCQkJCWdvdG8g
b3V0X3Rlc3Q7CkBAIC02MjYsMTcgKzYyMCwxMyBAQCBzdGF0aWMgaW50IGlndF9zaGFyZWRfY3R4
X2V4ZWModm9pZCAqYXJnKQogCQkJZHcgKz0gcmVtOwogCQl9CiAKLQkJbXV0ZXhfdW5sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhp
OTE1KTsKLQkJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJfQogb3V0X3Rl
c3Q6CiAJdGhyb3R0bGVfcmVsZWFzZSh0cSwgQVJSQVlfU0laRSh0cSkpOwogCWlmIChpZ3RfbGl2
ZV90ZXN0X2VuZCgmdCkpCiAJCWVyciA9IC1FSU87Ci1vdXRfdW5sb2NrOgotCW11dGV4X3VubG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KK291dF9maWxlOgogCW1vY2tfZmlsZV9mcmVl
KGk5MTUsIGZpbGUpOwogCXJldHVybiBlcnI7CiB9CkBAIC0xMDA4LDggKzk5OCw2IEBAIF9faWd0
X2N0eF9zc2V1KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCWlmIChmbGFncyAmIFRF
U1RfUkVTRVQpCiAJCWlndF9nbG9iYWxfcmVzZXRfbG9jaygmaTkxNS0+Z3QpOwogCi0JbXV0ZXhf
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAljdHggPSBsaXZlX2NvbnRleHQoaTkx
NSwgZmlsZSk7CiAJaWYgKElTX0VSUihjdHgpKSB7CiAJCXJldCA9IFBUUl9FUlIoY3R4KTsKQEAg
LTEwNjQsOCArMTA1Miw2IEBAIF9faWd0X2N0eF9zc2V1KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAogCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKIAogb3V0X3VubG9jazoKLQltdXRl
eF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJaWYgKGZsYWdzICYgVEVTVF9S
RVNFVCkKIAkJaWd0X2dsb2JhbF9yZXNldF91bmxvY2soJmk5MTUtPmd0KTsKIApAQCAtMTEyNSwy
MyArMTExMSwyNCBAQCBzdGF0aWMgaW50IGlndF9jdHhfcmVhZG9ubHkodm9pZCAqYXJnKQogCWlm
IChJU19FUlIoZmlsZSkpCiAJCXJldHVybiBQVFJfRVJSKGZpbGUpOwogCi0JbXV0ZXhfbG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAllcnIgPSBpZ3RfbGl2ZV90ZXN0X2JlZ2luKCZ0
LCBpOTE1LCBfX2Z1bmNfXywgIiIpOwogCWlmIChlcnIpCi0JCWdvdG8gb3V0X3VubG9jazsKKwkJ
Z290byBvdXRfZmlsZTsKIAogCWN0eCA9IGxpdmVfY29udGV4dChpOTE1LCBmaWxlKTsKIAlpZiAo
SVNfRVJSKGN0eCkpIHsKIAkJZXJyID0gUFRSX0VSUihjdHgpOwotCQlnb3RvIG91dF91bmxvY2s7
CisJCWdvdG8gb3V0X2ZpbGU7CiAJfQogCi0Jdm0gPSBjdHgtPnZtID86ICZpOTE1LT5nZ3R0LmFs
aWFzLT52bTsKKwlyY3VfcmVhZF9sb2NrKCk7CisJdm0gPSByY3VfZGVyZWZlcmVuY2UoY3R4LT52
bSkgPzogJmk5MTUtPmdndHQuYWxpYXMtPnZtOwogCWlmICghdm0gfHwgIXZtLT5oYXNfcmVhZF9v
bmx5KSB7CisJCXJjdV9yZWFkX3VubG9jaygpOwogCQllcnIgPSAwOwotCQlnb3RvIG91dF91bmxv
Y2s7CisJCWdvdG8gb3V0X2ZpbGU7CiAJfQorCXJjdV9yZWFkX3VubG9jaygpOwogCiAJbmR3b3Jk
cyA9IDA7CiAJZHcgPSAwOwpAQCAtMTE1OSw3ICsxMTQ2LDcgQEAgc3RhdGljIGludCBpZ3RfY3R4
X3JlYWRvbmx5KHZvaWQgKmFyZykKIAkJCQlpZiAoSVNfRVJSKG9iaikpIHsKIAkJCQkJZXJyID0g
UFRSX0VSUihvYmopOwogCQkJCQlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19lbmdpbmVzKGN0eCk7
Ci0JCQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCQkJZ290byBvdXRfZmlsZTsKIAkJCQl9CiAKIAkJ
CQlpZiAocHJhbmRvbV91MzJfc3RhdGUoJnBybmcpICYgMSkKQEAgLTExNzAsMTUgKzExNTcsMTcg
QEAgc3RhdGljIGludCBpZ3RfY3R4X3JlYWRvbmx5KHZvaWQgKmFyZykKIAkJCWlmIChlcnIpIHsK
IAkJCQlwcl9lcnIoIkZhaWxlZCB0byBmaWxsIGR3b3JkICVsdSBbJWx1LyVsdV0gd2l0aCBncHUg
KCVzKSBbZnVsbC1wcGd0dD8gJXNdLCBlcnI9JWRcbiIsCiAJCQkJICAgICAgIG5kd29yZHMsIGR3
LCBtYXhfZHdvcmRzKG9iaiksCi0JCQkJICAgICAgIGNlLT5lbmdpbmUtPm5hbWUsIHllc25vKCEh
Y3R4LT52bSksIGVycik7CisJCQkJICAgICAgIGNlLT5lbmdpbmUtPm5hbWUsCisJCQkJICAgICAg
IHllc25vKCEhcmN1X2FjY2Vzc19wb2ludGVyKGN0eC0+dm0pKSwKKwkJCQkgICAgICAgZXJyKTsK
IAkJCQlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19lbmdpbmVzKGN0eCk7Ci0JCQkJZ290byBvdXRf
dW5sb2NrOworCQkJCWdvdG8gb3V0X2ZpbGU7CiAJCQl9CiAKIAkJCWVyciA9IHRocm90dGxlKGNl
LCB0cSwgQVJSQVlfU0laRSh0cSkpOwogCQkJaWYgKGVycikgewogCQkJCWk5MTVfZ2VtX2NvbnRl
eHRfdW5sb2NrX2VuZ2luZXMoY3R4KTsKLQkJCQlnb3RvIG91dF91bmxvY2s7CisJCQkJZ290byBv
dXRfZmlsZTsKIAkJCX0KIAogCQkJaWYgKCsrZHcgPT0gbWF4X2R3b3JkcyhvYmopKSB7CkBAIC0x
MjEwLDExICsxMTk5LDEwIEBAIHN0YXRpYyBpbnQgaWd0X2N0eF9yZWFkb25seSh2b2lkICphcmcp
CiAJCWR3ICs9IHJlbTsKIAl9CiAKLW91dF91bmxvY2s6CitvdXRfZmlsZToKIAl0aHJvdHRsZV9y
ZWxlYXNlKHRxLCBBUlJBWV9TSVpFKHRxKSk7CiAJaWYgKGlndF9saXZlX3Rlc3RfZW5kKCZ0KSkK
IAkJZXJyID0gLUVJTzsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
CiAJbW9ja19maWxlX2ZyZWUoaTkxNSwgZmlsZSk7CiAJcmV0dXJuIGVycjsKQEAgLTEyMjMsNyAr
MTIxMSw3IEBAIHN0YXRpYyBpbnQgaWd0X2N0eF9yZWFkb25seSh2b2lkICphcmcpCiBzdGF0aWMg
aW50IGNoZWNrX3NjcmF0Y2goc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwgdTY0IG9mZnNl
dCkKIHsKIAlzdHJ1Y3QgZHJtX21tX25vZGUgKm5vZGUgPQotCQlfX2RybV9tbV9pbnRlcnZhbF9m
aXJzdCgmY3R4LT52bS0+bW0sCisJCV9fZHJtX21tX2ludGVydmFsX2ZpcnN0KCZyY3VfZGVyZWZl
cmVuY2VfcHJvdGVjdGVkKGN0eC0+dm0sIHRydWUpLT5tbSwKIAkJCQkJb2Zmc2V0LCBvZmZzZXQg
KyBzaXplb2YodTMyKSAtIDEpOwogCWlmICghbm9kZSB8fCBub2RlLT5zdGFydCA+IG9mZnNldCkK
IAkJcmV0dXJuIDA7CkBAIC0xMjczLDcgKzEyNjEsOSBAQCBzdGF0aWMgaW50IHdyaXRlX3RvX3Nj
cmF0Y2goc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAogCWludGVsX2d0X2NoaXBzZXRf
Zmx1c2goZW5naW5lLT5ndCk7CiAKLQl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosIGN0eC0+
dm0sIE5VTEwpOworCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwKKwkJCQlyY3VfZGVyZWZl
cmVuY2VfcHJvdGVjdGVkKGN0eC0+dm0sIHRydWUpLAorCQkJCU5VTEwpOwogCWlmIChJU19FUlIo
dm1hKSkgewogCQllcnIgPSBQVFJfRVJSKHZtYSk7CiAJCWdvdG8gZXJyOwpAQCAtMTM3Miw3ICsx
MzYyLDkgQEAgc3RhdGljIGludCByZWFkX2Zyb21fc2NyYXRjaChzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqY3R4LAogCiAJaW50ZWxfZ3RfY2hpcHNldF9mbHVzaChlbmdpbmUtPmd0KTsKIAotCXZt
YSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgY3R4LT52bSwgTlVMTCk7CisJdm1hID0gaTkxNV92
bWFfaW5zdGFuY2Uob2JqLAorCQkJCXJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQoY3R4LT52bSwg
dHJ1ZSksCisJCQkJTlVMTCk7CiAJaWYgKElTX0VSUih2bWEpKSB7CiAJCWVyciA9IFBUUl9FUlIo
dm1hKTsKIAkJZ290byBlcnI7CkBAIC0xNDYzLDI3ICsxNDU1LDI1IEBAIHN0YXRpYyBpbnQgaWd0
X3ZtX2lzb2xhdGlvbih2b2lkICphcmcpCiAJaWYgKElTX0VSUihmaWxlKSkKIAkJcmV0dXJuIFBU
Ul9FUlIoZmlsZSk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQog
CWVyciA9IGlndF9saXZlX3Rlc3RfYmVnaW4oJnQsIGk5MTUsIF9fZnVuY19fLCAiIik7CiAJaWYg
KGVycikKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3RvIG91dF9maWxlOwogCiAJY3R4X2EgPSBs
aXZlX2NvbnRleHQoaTkxNSwgZmlsZSk7CiAJaWYgKElTX0VSUihjdHhfYSkpIHsKIAkJZXJyID0g
UFRSX0VSUihjdHhfYSk7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290byBvdXRfZmlsZTsKIAl9
CiAKIAljdHhfYiA9IGxpdmVfY29udGV4dChpOTE1LCBmaWxlKTsKIAlpZiAoSVNfRVJSKGN0eF9i
KSkgewogCQllcnIgPSBQVFJfRVJSKGN0eF9iKTsKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3Rv
IG91dF9maWxlOwogCX0KIAogCS8qIFdlIGNhbiBvbmx5IHRlc3Qgdm0gaXNvbGF0aW9uLCBpZiB0
aGUgdm0gYXJlIGRpc3RpbmN0ICovCiAJaWYgKGN0eF9hLT52bSA9PSBjdHhfYi0+dm0pCi0JCWdv
dG8gb3V0X3VubG9jazsKKwkJZ290byBvdXRfZmlsZTsKIAogCXZtX3RvdGFsID0gY3R4X2EtPnZt
LT50b3RhbDsKIAlHRU1fQlVHX09OKGN0eF9iLT52bS0+dG90YWwgIT0gdm1fdG90YWwpOwpAQCAt
MTUxMiw3ICsxNTAyLDcgQEAgc3RhdGljIGludCBpZ3Rfdm1faXNvbGF0aW9uKHZvaWQgKmFyZykK
IAkJCQllcnIgPSByZWFkX2Zyb21fc2NyYXRjaChjdHhfYiwgZW5naW5lLAogCQkJCQkJCW9mZnNl
dCwgJnZhbHVlKTsKIAkJCWlmIChlcnIpCi0JCQkJZ290byBvdXRfdW5sb2NrOworCQkJCWdvdG8g
b3V0X2ZpbGU7CiAKIAkJCWlmICh2YWx1ZSkgewogCQkJCXByX2VycigiJXM6IFJlYWQgJTA4eCBm
cm9tIHNjcmF0Y2ggKG9mZnNldCAweCUwOHhfJTA4eCksIGFmdGVyICVsdSByZWFkcyFcbiIsCkBA
IC0xNTIxLDcgKzE1MTEsNyBAQCBzdGF0aWMgaW50IGlndF92bV9pc29sYXRpb24odm9pZCAqYXJn
KQogCQkJCSAgICAgICBsb3dlcl8zMl9iaXRzKG9mZnNldCksCiAJCQkJICAgICAgIHRoaXMpOwog
CQkJCWVyciA9IC1FSU5WQUw7Ci0JCQkJZ290byBvdXRfdW5sb2NrOworCQkJCWdvdG8gb3V0X2Zp
bGU7CiAJCQl9CiAKIAkJCXRoaXMrKzsKQEAgLTE1MzEsMTEgKzE1MjEsOSBAQCBzdGF0aWMgaW50
IGlndF92bV9pc29sYXRpb24odm9pZCAqYXJnKQogCXByX2luZm8oIkNoZWNrZWQgJWx1IHNjcmF0
Y2ggb2Zmc2V0cyBhY3Jvc3MgJWQgZW5naW5lc1xuIiwKIAkJY291bnQsIFJVTlRJTUVfSU5GTyhp
OTE1KS0+bnVtX2VuZ2luZXMpOwogCi1vdXRfdW5sb2NrOgorb3V0X2ZpbGU6CiAJaWYgKGlndF9s
aXZlX3Rlc3RfZW5kKCZ0KSkKIAkJZXJyID0gLUVJTzsKLQltdXRleF91bmxvY2soJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwotCiAJbW9ja19maWxlX2ZyZWUoaTkxNSwgZmlsZSk7CiAJcmV0dXJu
IGVycjsKIH0KQEAgLTE1NjcsMTMgKzE1NTUsOSBAQCBzdGF0aWMgaW50IG1vY2tfY29udGV4dF9i
YXJyaWVyKHZvaWQgKmFyZykKIAkgKiBhIHJlcXVlc3Q7IHVzZWZ1bCBmb3IgcmV0aXJpbmcgb2xk
IHN0YXRlIGFmdGVyIGxvYWRpbmcgbmV3LgogCSAqLwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7Ci0KIAljdHggPSBtb2NrX2NvbnRleHQoaTkxNSwgIm1vY2siKTsKLQlp
ZiAoIWN0eCkgewotCQllcnIgPSAtRU5PTUVNOwotCQlnb3RvIHVubG9jazsKLQl9CisJaWYgKCFj
dHgpCisJCXJldHVybiAtRU5PTUVNOwogCiAJY291bnRlciA9IDA7CiAJZXJyID0gY29udGV4dF9i
YXJyaWVyX3Rhc2soY3R4LCAwLApAQCAtMTY0Niw4ICsxNjMwLDYgQEAgc3RhdGljIGludCBtb2Nr
X2NvbnRleHRfYmFycmllcih2b2lkICphcmcpCiAKIG91dDoKIAltb2NrX2NvbnRleHRfY2xvc2Uo
Y3R4KTsKLXVubG9jazoKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
CXJldHVybiBlcnI7CiAjdW5kZWYgcHJfZm10CiAjZGVmaW5lIHByX2ZtdCh4KSB4CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL21vY2tfY29udGV4dC5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQuYwppbmRleCBl
YmM0NmYwOTg1NjEuLjZlZjg2ZTc5MjNhNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vc2VsZnRlc3RzL21vY2tfY29udGV4dC5jCkBAIC02Nyw3ICs2Nyw3IEBAIHZvaWQgbW9j
a19jb250ZXh0X2Nsb3NlKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCiAKIHZvaWQgbW9j
a19pbml0X2NvbnRleHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCWluaXRf
Y29udGV4dHMoaTkxNSk7CisJaW5pdF9jb250ZXh0cygmaTkxNS0+Z2VtLmNvbnRleHRzKTsKIH0K
IAogc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKgpAQCAtNzYsOCArNzYsNiBAQCBsaXZlX2NvbnRl
eHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkK
IAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwogCWludCBlcnI7CiAKLQlsb2NrZGVwX2Fz
c2VydF9oZWxkKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWN0eCA9IGk5MTVfZ2VtX2Ny
ZWF0ZV9jb250ZXh0KGk5MTUsIDApOwogCWlmIChJU19FUlIoY3R4KSkKIAkJcmV0dXJuIGN0eDsK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYwppbmRleCAzNWE0MGMyODIwYTIu
LjEwN2ViMDNkNmRkNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
Y29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYwpA
QCAtMjI2LDcgKzIyNiwxMyBAQCBpbnRlbF9jb250ZXh0X2luaXQoc3RydWN0IGludGVsX2NvbnRl
eHQgKmNlLAogCWtyZWZfaW5pdCgmY2UtPnJlZik7CiAKIAljZS0+Z2VtX2NvbnRleHQgPSBjdHg7
Ci0JY2UtPnZtID0gaTkxNV92bV9nZXQoY3R4LT52bSA/OiAmZW5naW5lLT5ndC0+Z2d0dC0+dm0p
OworCXJjdV9yZWFkX2xvY2soKTsKKwljZS0+dm0gPSByY3VfZGVyZWZlcmVuY2UoY3R4LT52bSk7
CisJaWYgKGNlLT52bSAmJiAha3JlZl9nZXRfdW5sZXNzX3plcm8oJmNlLT52bS0+cmVmKSkKKwkJ
Y2UtPnZtID0gTlVMTDsKKwlpZiAoIWNlLT52bSkKKwkJY2UtPnZtID0gaTkxNV92bV9nZXQoJmVu
Z2luZS0+Z3QtPmdndHQtPnZtKTsKKwlyY3VfcmVhZF91bmxvY2soKTsKIAlpZiAoY3R4LT50aW1l
bGluZSkKIAkJY2UtPnRpbWVsaW5lID0gaW50ZWxfdGltZWxpbmVfZ2V0KGN0eC0+dGltZWxpbmUp
OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKaW5kZXggODZj
ZmZiYjBhOWNiLi43YzgzOGE1N2UxNzQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF9jb250ZXh0LmMKQEAgLTE1NSwxMyArMTU1LDkgQEAgc3RhdGljIGludCBsaXZlX2NvbnRl
eHRfc2l6ZSh2b2lkICphcmcpCiAJICogSFcgdHJpZXMgdG8gd3JpdGUgcGFzdCB0aGUgZW5kIG9m
IG9uZS4KIAkgKi8KIAotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
LQogCWZpeG1lID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOwotCWlmIChJU19FUlIoZml4bWUp
KSB7Ci0JCWVyciA9IFBUUl9FUlIoZml4bWUpOwotCQlnb3RvIHVubG9jazsKLQl9CisJaWYgKElT
X0VSUihmaXhtZSkpCisJCXJldHVybiBQVFJfRVJSKGZpeG1lKTsKIAogCWZvcl9lYWNoX2VuZ2lu
ZShlbmdpbmUsIGd0LT5pOTE1LCBpZCkgewogCQlzdHJ1Y3QgewpAQCAtMjAxLDggKzE5Nyw2IEBA
IHN0YXRpYyBpbnQgbGl2ZV9jb250ZXh0X3NpemUodm9pZCAqYXJnKQogCX0KIAogCWtlcm5lbF9j
b250ZXh0X2Nsb3NlKGZpeG1lKTsKLXVubG9jazoKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4gZXJyOwogfQogCkBAIC0zMDUsMTIgKzI5OSwxMCBA
QCBzdGF0aWMgaW50IGxpdmVfYWN0aXZlX2NvbnRleHQodm9pZCAqYXJnKQogCWlmIChJU19FUlIo
ZmlsZSkpCiAJCXJldHVybiBQVFJfRVJSKGZpbGUpOwogCi0JbXV0ZXhfbG9jaygmZ3QtPmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJZml4bWUgPSBsaXZlX2NvbnRleHQoZ3QtPmk5MTUsIGZp
bGUpOwogCWlmIChJU19FUlIoZml4bWUpKSB7CiAJCWVyciA9IFBUUl9FUlIoZml4bWUpOwotCQln
b3RvIHVubG9jazsKKwkJZ290byBvdXRfZmlsZTsKIAl9CiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5n
aW5lLCBndC0+aTkxNSwgaWQpIHsKQEAgLTMyMyw4ICszMTUsNyBAQCBzdGF0aWMgaW50IGxpdmVf
YWN0aXZlX2NvbnRleHQodm9pZCAqYXJnKQogCQkJYnJlYWs7CiAJfQogCi11bmxvY2s6Ci0JbXV0
ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CitvdXRfZmlsZToKIAltb2Nr
X2ZpbGVfZnJlZShndC0+aTkxNSwgZmlsZSk7CiAJcmV0dXJuIGVycjsKIH0KQEAgLTQxOCwxMiAr
NDA5LDEwIEBAIHN0YXRpYyBpbnQgbGl2ZV9yZW1vdGVfY29udGV4dCh2b2lkICphcmcpCiAJaWYg
KElTX0VSUihmaWxlKSkKIAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAKLQltdXRleF9sb2NrKCZn
dC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlmaXhtZSA9IGxpdmVfY29udGV4dChndC0+
aTkxNSwgZmlsZSk7CiAJaWYgKElTX0VSUihmaXhtZSkpIHsKIAkJZXJyID0gUFRSX0VSUihmaXht
ZSk7Ci0JCWdvdG8gdW5sb2NrOworCQlnb3RvIG91dF9maWxlOwogCX0KIAogCWZvcl9lYWNoX2Vu
Z2luZShlbmdpbmUsIGd0LT5pOTE1LCBpZCkgewpAQCAtNDM2LDggKzQyNSw3IEBAIHN0YXRpYyBp
bnQgbGl2ZV9yZW1vdGVfY29udGV4dCh2b2lkICphcmcpCiAJCQlicmVhazsKIAl9CiAKLXVubG9j
azoKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKK291dF9maWxl
OgogCW1vY2tfZmlsZV9mcmVlKGd0LT5pOTE1LCBmaWxlKTsKIAlyZXR1cm4gZXJyOwogfQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYwppbmRleCBmMmI1YWIx
ZTVhMmUuLjFiODM2ZmYwYTc1NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfaGFuZ2NoZWNrLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfaGFuZ2NoZWNrLmMKQEAgLTU4LDkgKzU4LDcgQEAgc3RhdGljIGludCBoYW5nX2luaXQoc3Ry
dWN0IGhhbmcgKmgsIHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAJbWVtc2V0KGgsIDAsIHNpemVvZigq
aCkpOwogCWgtPmd0ID0gZ3Q7CiAKLQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAJaC0+Y3R4ID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOwotCW11dGV4X3VubG9j
aygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChJU19FUlIoaC0+Y3R4KSkKIAkJ
cmV0dXJuIFBUUl9FUlIoaC0+Y3R4KTsKIApAQCAtMTMzLDcgKzEzMSw4IEBAIHN0YXRpYyBzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICoKIGhhbmdfY3JlYXRlX3JlcXVlc3Qoc3RydWN0IGhhbmcgKmgsIHN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0g
aC0+Z3Q7Ci0Jc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSBoLT5jdHgtPnZtID86ICZl
bmdpbmUtPmd0LT5nZ3R0LT52bTsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9CisJ
CXJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQoaC0+Y3R4LT52bSwgdHJ1ZSkgPzogJmVuZ2luZS0+
Z3QtPmdndHQtPnZtOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJc3RydWN0
IGk5MTVfcmVxdWVzdCAqcnEgPSBOVUxMOwogCXN0cnVjdCBpOTE1X3ZtYSAqaHdzLCAqdm1hOwpA
QCAtMzgyLDkgKzM4MSw3IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X25vcCh2b2lkICphcmcpCiAJ
aWYgKElTX0VSUihmaWxlKSkKIAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAKLQltdXRleF9sb2Nr
KCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJY3R4ID0gbGl2ZV9jb250ZXh0KGd0LT5p
OTE1LCBmaWxlKTsKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
IAlpZiAoSVNfRVJSKGN0eCkpIHsKIAkJZXJyID0gUFRSX0VSUihjdHgpOwogCQlnb3RvIG91dDsK
QEAgLTQ1OCw5ICs0NTUsNyBAQCBzdGF0aWMgaW50IGlndF9yZXNldF9ub3BfZW5naW5lKHZvaWQg
KmFyZykKIAlpZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKIAotCW11
dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAljdHggPSBsaXZlX2NvbnRl
eHQoZ3QtPmk5MTUsIGZpbGUpOwotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCWlmIChJU19FUlIoY3R4KSkgewogCQllcnIgPSBQVFJfRVJSKGN0eCk7CiAJCWdv
dG8gb3V0OwpAQCAtNzA1LDkgKzcwMCw3IEBAIHN0YXRpYyBpbnQgYWN0aXZlX2VuZ2luZSh2b2lk
ICpkYXRhKQogCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKIAogCWZvciAoY291bnQgPSAwOyBjb3Vu
dCA8IEFSUkFZX1NJWkUoY3R4KTsgY291bnQrKykgewotCQltdXRleF9sb2NrKCZlbmdpbmUtPmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQljdHhbY291bnRdID0gbGl2ZV9jb250ZXh0KGVuZ2lu
ZS0+aTkxNSwgZmlsZSk7Ci0JCW11dGV4X3VubG9jaygmZW5naW5lLT5pOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKIAkJaWYgKElTX0VSUihjdHhbY291bnRdKSkgewogCQkJZXJyID0gUFRSX0VSUihj
dHhbY291bnRdKTsKIAkJCXdoaWxlICgtLWNvdW50KQpAQCAtMTI5OCwxOCArMTI5MSwxOCBAQCBz
dGF0aWMgaW50IGlndF9yZXNldF9ldmljdF9wcGd0dCh2b2lkICphcmcpCiAJaWYgKElTX0VSUihm
aWxlKSkKIAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAKLQltdXRleF9sb2NrKCZndC0+aTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAJY3R4ID0gbGl2ZV9jb250ZXh0KGd0LT5pOTE1LCBmaWxlKTsK
LQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpZiAoSVNfRVJS
KGN0eCkpIHsKIAkJZXJyID0gUFRSX0VSUihjdHgpOwogCQlnb3RvIG91dDsKIAl9CiAKIAllcnIg
PSAwOwotCWlmIChjdHgtPnZtKSAvKiBhbGlhc2luZyA9PSBnbG9iYWwgZ3R0IGxvY2tpbmcsIGNv
dmVyZWQgYWJvdmUgKi8KLQkJZXJyID0gX19pZ3RfcmVzZXRfZXZpY3Rfdm1hKGd0LCBjdHgtPnZt
LAorCWlmIChyY3VfYWNjZXNzX3BvaW50ZXIoY3R4LT52bSkpIHsKKwkJLyogYWxpYXNpbmcgPT0g
Z2xvYmFsIGd0dCBsb2NraW5nLCBjb3ZlcmVkIGFib3ZlICovCisJCWVyciA9IF9faWd0X3Jlc2V0
X2V2aWN0X3ZtYShndCwgcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChjdHgtPnZtLCB0cnVlKSwK
IAkJCQkJICAgIGV2aWN0X3ZtYSwgRVhFQ19PQkpFQ1RfV1JJVEUpOworCX0KIAogb3V0OgogCW1v
Y2tfZmlsZV9mcmVlKGd0LT5pOTE1LCBmaWxlKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfbHJjLmMKaW5kZXggMzMwMGFjZDkxOTlkLi5lMzNjMmY2NmM2ODMgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCkBAIC0xNDUzLDcgKzE0NTMsOSBAQCBzdGF0aWMgaW50
IHNtb2tlX3N1Ym1pdChzdHJ1Y3QgcHJlZW1wdF9zbW9rZSAqc21va2UsCiAJaW50IGVyciA9IDA7
CiAKIAlpZiAoYmF0Y2gpIHsKLQkJdm1hID0gaTkxNV92bWFfaW5zdGFuY2UoYmF0Y2gsIGN0eC0+
dm0sIE5VTEwpOworCQl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShiYXRjaCwKKwkJCQkJcmN1X2Rl
cmVmZXJlbmNlX3Byb3RlY3RlZChjdHgtPnZtLCB0cnVlKSwKKwkJCQkJTlVMTCk7CiAJCWlmIChJ
U19FUlIodm1hKSkKIAkJCXJldHVybiBQVFJfRVJSKHZtYSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jCmluZGV4IDA2MzUxZmVmYmJmMy4uZWQ0
NDMzM2Q5ZTIwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93
b3JrYXJvdW5kcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmth
cm91bmRzLmMKQEAgLTMzLDYgKzMzLDggQEAgc3RydWN0IHdhX2xpc3RzIHsKIAl9IGVuZ2luZVtJ
OTE1X05VTV9FTkdJTkVTXTsKIH07CiAKKyNkZWZpbmUgY3R4X3ZtKGN0eCkgcmN1X2RlcmVmZXJl
bmNlX3Byb3RlY3RlZCgoY3R4KS0+dm0sIHRydWUpCisKIHN0YXRpYyB2b2lkCiByZWZlcmVuY2Vf
bGlzdHNfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgc3RydWN0IHdhX2xpc3Rz
ICpsaXN0cykKIHsKQEAgLTM2Miw3ICszNjQsNyBAQCBzdGF0aWMgc3RydWN0IGk5MTVfdm1hICpj
cmVhdGVfYmF0Y2goc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIAlpZiAoSVNfRVJSKG9i
aikpCiAJCXJldHVybiBFUlJfQ0FTVChvYmopOwogCi0Jdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uo
b2JqLCBjdHgtPnZtLCBOVUxMKTsKKwl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosIGN0eF92
bShjdHgpLCBOVUxMKTsKIAlpZiAoSVNfRVJSKHZtYSkpIHsKIAkJZXJyID0gUFRSX0VSUih2bWEp
OwogCQlnb3RvIGVycl9vYmo7CkBAIC00NjgsNyArNDcwLDcgQEAgc3RhdGljIGludCBjaGVja19k
aXJ0eV93aGl0ZWxpc3Qoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAlpbnQgZXJyID0g
MCwgaSwgdjsKIAl1MzIgKmNzLCAqcmVzdWx0czsKIAotCXNjcmF0Y2ggPSBjcmVhdGVfc2NyYXRj
aChjdHgtPnZtLCAyICogQVJSQVlfU0laRSh2YWx1ZXMpICsgMSk7CisJc2NyYXRjaCA9IGNyZWF0
ZV9zY3JhdGNoKGN0eF92bShjdHgpLCAyICogQVJSQVlfU0laRSh2YWx1ZXMpICsgMSk7CiAJaWYg
KElTX0VSUihzY3JhdGNoKSkKIAkJcmV0dXJuIFBUUl9FUlIoc2NyYXRjaCk7CiAKQEAgLTEwMTgs
MTQgKzEwMjAsMTQgQEAgc3RhdGljIGludCBsaXZlX2lzb2xhdGVkX3doaXRlbGlzdCh2b2lkICph
cmcpCiAJCQlnb3RvIGVycjsKIAkJfQogCi0JCWNsaWVudFtpXS5zY3JhdGNoWzBdID0gY3JlYXRl
X3NjcmF0Y2goYy0+dm0sIDEwMjQpOworCQljbGllbnRbaV0uc2NyYXRjaFswXSA9IGNyZWF0ZV9z
Y3JhdGNoKGN0eF92bShjKSwgMTAyNCk7CiAJCWlmIChJU19FUlIoY2xpZW50W2ldLnNjcmF0Y2hb
MF0pKSB7CiAJCQllcnIgPSBQVFJfRVJSKGNsaWVudFtpXS5zY3JhdGNoWzBdKTsKIAkJCWtlcm5l
bF9jb250ZXh0X2Nsb3NlKGMpOwogCQkJZ290byBlcnI7CiAJCX0KIAotCQljbGllbnRbaV0uc2Ny
YXRjaFsxXSA9IGNyZWF0ZV9zY3JhdGNoKGMtPnZtLCAxMDI0KTsKKwkJY2xpZW50W2ldLnNjcmF0
Y2hbMV0gPSBjcmVhdGVfc2NyYXRjaChjdHhfdm0oYyksIDEwMjQpOwogCQlpZiAoSVNfRVJSKGNs
aWVudFtpXS5zY3JhdGNoWzFdKSkgewogCQkJZXJyID0gUFRSX0VSUihjbGllbnRbaV0uc2NyYXRj
aFsxXSk7CiAJCQlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmY2xpZW50W2ldLnNjcmF0Y2hb
MF0sIDApOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jCmluZGV4IDAzZjU2NzA4NDU0
OC4uY2U1Y2ZmMDFmNDRjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2No
ZWR1bGVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jCkBAIC0z
NjUsNyArMzY1LDggQEAgc3RhdGljIHZvaWQgc2V0X2NvbnRleHRfcHBndHRfZnJvbV9zaGFkb3co
c3RydWN0IGludGVsX3ZncHVfd29ya2xvYWQgKndvcmtsb2FkLAogCQkJCQkgIHN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICpjdHgpCiB7CiAJc3RydWN0IGludGVsX3ZncHVfbW0gKm1tID0gd29ya2xv
YWQtPnNoYWRvd19tbTsKLQlzdHJ1Y3QgaTkxNV9wcGd0dCAqcHBndHQgPSBpOTE1X3ZtX3RvX3Bw
Z3R0KGN0eC0+dm0pOworCXN0cnVjdCBpOTE1X3BwZ3R0ICpwcGd0dCA9CisJCWk5MTVfdm1fdG9f
cHBndHQocmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChjdHgtPnZtLCB0cnVlKSk7CiAJaW50IGkg
PSAwOwogCiAJaWYgKG1tLT5wcGd0dF9tbS5yb290X2VudHJ5X3R5cGUgPT0gR1RUX1RZUEVfUFBH
VFRfUk9PVF9MNF9FTlRSWSkgewpAQCAtMTIzMCwyMCArMTIzMSwxOCBAQCBpbnQgaW50ZWxfdmdw
dV9zZXR1cF9zdWJtaXNzaW9uKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQogCXN0cnVjdCBpbnRl
bF92Z3B1X3N1Ym1pc3Npb24gKnMgPSAmdmdwdS0+c3VibWlzc2lvbjsKIAlzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmU7CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKKwlzdHJ1
Y3QgaTkxNV9wcGd0dCAqcHBndHQ7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaTsKIAlpbnQgcmV0
OwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAljdHggPSBpOTE1
X2dlbV9jb250ZXh0X2NyZWF0ZV9rZXJuZWwoaTkxNSwgSTkxNV9QUklPUklUWV9NQVgpOwotCWlm
IChJU19FUlIoY3R4KSkgewotCQlyZXQgPSBQVFJfRVJSKGN0eCk7Ci0JCWdvdG8gb3V0X3VubG9j
azsKLQl9CisJaWYgKElTX0VSUihjdHgpKQorCQlyZXR1cm4gUFRSX0VSUihjdHgpOwogCiAJaTkx
NV9nZW1fY29udGV4dF9zZXRfZm9yY2Vfc2luZ2xlX3N1Ym1pc3Npb24oY3R4KTsKIAotCWk5MTVf
Y29udGV4dF9wcGd0dF9yb290X3NhdmUocywgaTkxNV92bV90b19wcGd0dChjdHgtPnZtKSk7CisJ
cHBndHQgPSBpOTE1X3ZtX3RvX3BwZ3R0KHJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQoY3R4LT52
bSwgdHJ1ZSkpOworCWk5MTVfY29udGV4dF9wcGd0dF9yb290X3NhdmUocywgcHBndHQpOwogCiAJ
Zm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaSkgewogCQlzdHJ1Y3QgaW50ZWxfY29udGV4
dCAqY2U7CkBAIC0xMjg5LDExICsxMjg4LDEwIEBAIGludCBpbnRlbF92Z3B1X3NldHVwX3N1Ym1p
c3Npb24oc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAJYml0bWFwX3plcm8ocy0+dGxiX2hhbmRs
ZV9wZW5kaW5nLCBJOTE1X05VTV9FTkdJTkVTKTsKIAogCWk5MTVfZ2VtX2NvbnRleHRfcHV0KGN0
eCk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4gMDsK
IAogb3V0X3NoYWRvd19jdHg6Ci0JaTkxNV9jb250ZXh0X3BwZ3R0X3Jvb3RfcmVzdG9yZShzLCBp
OTE1X3ZtX3RvX3BwZ3R0KGN0eC0+dm0pKTsKKwlpOTE1X2NvbnRleHRfcHBndHRfcm9vdF9yZXN0
b3JlKHMsIHBwZ3R0KTsKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpKSB7CiAJCWlm
IChJU19FUlIocy0+c2hhZG93W2ldKSkKIAkJCWJyZWFrOwpAQCAtMTMwMiw4ICsxMzAwLDYgQEAg
aW50IGludGVsX3ZncHVfc2V0dXBfc3VibWlzc2lvbihzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkK
IAkJaW50ZWxfY29udGV4dF9wdXQocy0+c2hhZG93W2ldKTsKIAl9CiAJaTkxNV9nZW1fY29udGV4
dF9wdXQoY3R4KTsKLW91dF91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKIAlyZXR1cm4gcmV0OwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2RlYnVnZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5j
CmluZGV4IDhjYWFhNDQ2NDkwZi4uZDRhN2NkYTYwNjc5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2RlYnVnZnMuYwpAQCAtMzE1LDEyICszMTUsMTggQEAgc3RhdGljIHZvaWQgcHJpbnRfY29udGV4
dF9zdGF0cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sCiAJCQkJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCiB7CiAJc3RydWN0IGZpbGVfc3RhdHMga3N0YXRzID0ge307Ci0Jc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHQgKmN0eDsKKwlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LCAqY247CiAK
LQlsaXN0X2Zvcl9lYWNoX2VudHJ5KGN0eCwgJmk5MTUtPmNvbnRleHRzLmxpc3QsIGxpbmspIHsK
KwlzcGluX2xvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKKwlsaXN0X2Zvcl9lYWNoX2Vu
dHJ5X3NhZmUoY3R4LCBjbiwgJmk5MTUtPmdlbS5jb250ZXh0cy5saXN0LCBsaW5rKSB7CiAJCXN0
cnVjdCBpOTE1X2dlbV9lbmdpbmVzX2l0ZXIgaXQ7CiAJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpj
ZTsKIAorCQlpZiAoIWtyZWZfZ2V0X3VubGVzc196ZXJvKCZjdHgtPnJlZikpCisJCQljb250aW51
ZTsKKworCQlzcGluX3VubG9jaygmaTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOworCiAJCWZvcl9l
YWNoX2dlbV9lbmdpbmUoY2UsCiAJCQkJICAgIGk5MTVfZ2VtX2NvbnRleHRfbG9ja19lbmdpbmVz
KGN0eCksIGl0KSB7CiAJCQlpbnRlbF9jb250ZXh0X2xvY2tfcGlubmVkKGNlKTsKQEAgLTMzNyw3
ICszNDMsOSBAQCBzdGF0aWMgdm9pZCBwcmludF9jb250ZXh0X3N0YXRzKHN0cnVjdCBzZXFfZmls
ZSAqbSwKIAkJaTkxNV9nZW1fY29udGV4dF91bmxvY2tfZW5naW5lcyhjdHgpOwogCiAJCWlmICgh
SVNfRVJSX09SX05VTEwoY3R4LT5maWxlX3ByaXYpKSB7Ci0JCQlzdHJ1Y3QgZmlsZV9zdGF0cyBz
dGF0cyA9IHsgLnZtID0gY3R4LT52bSwgfTsKKwkJCXN0cnVjdCBmaWxlX3N0YXRzIHN0YXRzID0g
eworCQkJCS52bSA9IHJjdV9hY2Nlc3NfcG9pbnRlcihjdHgtPnZtKSwKKwkJCX07CiAJCQlzdHJ1
Y3QgZHJtX2ZpbGUgKmZpbGUgPSBjdHgtPmZpbGVfcHJpdi0+ZmlsZTsKIAkJCXN0cnVjdCB0YXNr
X3N0cnVjdCAqdGFzazsKIAkJCWNoYXIgbmFtZVs4MF07CkBAIC0zNTQsNyArMzYyLDEyIEBAIHN0
YXRpYyB2b2lkIHByaW50X2NvbnRleHRfc3RhdHMoc3RydWN0IHNlcV9maWxlICptLAogCiAJCQlw
cmludF9maWxlX3N0YXRzKG0sIG5hbWUsIHN0YXRzKTsKIAkJfQorCisJCXNwaW5fbG9jaygmaTkx
NS0+Z2VtLmNvbnRleHRzLmxvY2spOworCQlsaXN0X3NhZmVfcmVzZXRfbmV4dChjdHgsIGNuLCBs
aW5rKTsKKwkJaTkxNV9nZW1fY29udGV4dF9wdXQoY3R4KTsKIAl9CisJc3Bpbl91bmxvY2soJmk5
MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKIAogCXByaW50X2ZpbGVfc3RhdHMobSwgIltrXWNvbnRl
eHRzIiwga3N0YXRzKTsKIH0KQEAgLTM2Miw3ICszNzUsNiBAQCBzdGF0aWMgdm9pZCBwcmludF9j
b250ZXh0X3N0YXRzKHN0cnVjdCBzZXFfZmlsZSAqbSwKIHN0YXRpYyBpbnQgaTkxNV9nZW1fb2Jq
ZWN0X2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogewogCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOwotCWludCByZXQ7
CiAKIAlzZXFfcHJpbnRmKG0sICIldSBzaHJpbmthYmxlIFsldSBmcmVlXSBvYmplY3RzLCAlbGx1
IGJ5dGVzXG4iLAogCQkgICBpOTE1LT5tbS5zaHJpbmtfY291bnQsCkBAIC0zNzEsMTIgKzM4Myw3
IEBAIHN0YXRpYyBpbnQgaTkxNV9nZW1fb2JqZWN0X2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2
b2lkICpkYXRhKQogCiAJc2VxX3B1dGMobSwgJ1xuJyk7CiAKLQlyZXQgPSBtdXRleF9sb2NrX2lu
dGVycnVwdGlibGUoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChyZXQpCi0JCXJldHVy
biByZXQ7Ci0KIAlwcmludF9jb250ZXh0X3N0YXRzKG0sIGk5MTUpOwotCW11dGV4X3VubG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTE0OTAsMTkgKzE0
OTcsMTkgQEAgc3RhdGljIHZvaWQgZGVzY3JpYmVfY3R4X3Jpbmcoc3RydWN0IHNlcV9maWxlICpt
LCBzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZykKIAogc3RhdGljIGludCBpOTE1X2NvbnRleHRfc3Rh
dHVzKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqdW51c2VkKQogewotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKLQlzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2ID0gJmRldl9wcml2LT5kcm07Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRl
eHQgKmN0eDsKLQlpbnQgcmV0OwotCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZk
ZXYtPnN0cnVjdF9tdXRleCk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKKwlzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqY3R4LCAqY247CiAKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KGN0eCwg
JmRldl9wcml2LT5jb250ZXh0cy5saXN0LCBsaW5rKSB7CisJc3Bpbl9sb2NrKCZpOTE1LT5nZW0u
Y29udGV4dHMubG9jayk7CisJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKGN0eCwgY24sICZpOTE1
LT5nZW0uY29udGV4dHMubGlzdCwgbGluaykgewogCQlzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lc19p
dGVyIGl0OwogCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAKKwkJaWYgKCFrcmVmX2dldF91
bmxlc3NfemVybygmY3R4LT5yZWYpKQorCQkJY29udGludWU7CisKKwkJc3Bpbl91bmxvY2soJmk5
MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKKwogCQlzZXFfcHV0cyhtLCAiSFcgY29udGV4dCAiKTsK
IAkJaWYgKGN0eC0+cGlkKSB7CiAJCQlzdHJ1Y3QgdGFza19zdHJ1Y3QgKnRhc2s7CkBAIC0xNTM3
LDkgKzE1NDQsMTIgQEAgc3RhdGljIGludCBpOTE1X2NvbnRleHRfc3RhdHVzKHN0cnVjdCBzZXFf
ZmlsZSAqbSwgdm9pZCAqdW51c2VkKQogCQlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19lbmdpbmVz
KGN0eCk7CiAKIAkJc2VxX3B1dGMobSwgJ1xuJyk7Ci0JfQogCi0JbXV0ZXhfdW5sb2NrKCZkZXYt
PnN0cnVjdF9tdXRleCk7CisJCXNwaW5fbG9jaygmaTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOwor
CQlsaXN0X3NhZmVfcmVzZXRfbmV4dChjdHgsIGNuLCBsaW5rKTsKKwkJaTkxNV9nZW1fY29udGV4
dF9wdXQoY3R4KTsKKwl9CisJc3Bpbl91bmxvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsK
IAogCXJldHVybiAwOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9k
cnYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMKaW5kZXggOGNhYzYxMjRkMTZh
Li5hOGRkYWMyMmQ2MzMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYwpAQCAtMTY4NSwxMCArMTY4
NSw4IEBAIHN0YXRpYyB2b2lkIGk5MTVfZHJpdmVyX3Bvc3RjbG9zZShzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2LCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X2ZpbGVf
cHJpdmF0ZSAqZmlsZV9wcml2ID0gZmlsZS0+ZHJpdmVyX3ByaXY7CiAKLQltdXRleF9sb2NrKCZk
ZXYtPnN0cnVjdF9tdXRleCk7CiAJaTkxNV9nZW1fY29udGV4dF9jbG9zZShmaWxlKTsKIAlpOTE1
X2dlbV9yZWxlYXNlKGRldiwgZmlsZSk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRl
eCk7CiAKIAlrZnJlZV9yY3UoZmlsZV9wcml2LCByY3UpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYu
aAppbmRleCBhZDdlZDdmNzJkYTguLjIzZjMxMTE3MmU3NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Ry
di5oCkBAIC0xNTQzLDI1ICsxNTQzLDYgQEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgewogCWlu
dCBhdWRpb19wb3dlcl9yZWZjb3VudDsKIAl1MzIgYXVkaW9fZnJlcV9jbnRybDsKIAotCXN0cnVj
dCB7Ci0JCXN0cnVjdCBtdXRleCBtdXRleDsKLQkJc3RydWN0IGxpc3RfaGVhZCBsaXN0OwotCQlz
dHJ1Y3QgbGxpc3RfaGVhZCBmcmVlX2xpc3Q7Ci0JCXN0cnVjdCB3b3JrX3N0cnVjdCBmcmVlX3dv
cms7Ci0KLQkJLyogVGhlIGh3IHdhbnRzIHRvIGhhdmUgYSBzdGFibGUgY29udGV4dCBpZGVudGlm
aWVyIGZvciB0aGUKLQkJICogbGlmZXRpbWUgb2YgdGhlIGNvbnRleHQgKGZvciBPQSwgUEFTSUQs
IGZhdWx0cywgZXRjKS4KLQkJICogVGhpcyBpcyBsaW1pdGVkIGluIGV4ZWNsaXN0cyB0byAyMSBi
aXRzLgotCQkgKi8KLQkJc3RydWN0IGlkYSBod19pZGE7Ci0jZGVmaW5lIE1BWF9DT05URVhUX0hX
X0lEICgxPDwyMSkgLyogZXhjbHVzaXZlICovCi0jZGVmaW5lIE1BWF9HVUNfQ09OVEVYVF9IV19J
RCAoMSA8PCAyMCkgLyogZXhjbHVzaXZlICovCi0jZGVmaW5lIEdFTjExX01BWF9DT05URVhUX0hX
X0lEICgxPDwxMSkgLyogZXhjbHVzaXZlICovCi0vKiBpbiBHZW4xMiBJRCAweDdGRiBpcyByZXNl
cnZlZCB0byBpbmRpY2F0ZSBpZGxlICovCi0jZGVmaW5lIEdFTjEyX01BWF9DT05URVhUX0hXX0lE
CShHRU4xMV9NQVhfQ09OVEVYVF9IV19JRCAtIDEpCi0JCXN0cnVjdCBsaXN0X2hlYWQgaHdfaWRf
bGlzdDsKLQl9IGNvbnRleHRzOwotCiAJdTMyIGZkaV9yeF9jb25maWc7CiAKIAkvKiBTaGFkb3cg
Zm9yIERJU1BMQVlfUEhZX0NPTlRST0wgd2hpY2ggY2FuJ3QgYmUgc2FmZWx5IHJlYWQgKi8KQEAg
LTE3MTcsNiArMTY5OCwxNCBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSB7CiAKIAlzdHJ1Y3Qg
ewogCQlzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sgcG1fbm90aWZpZXI7CisKKwkJc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHRzIHsKKwkJCXNwaW5sb2NrX3QgbG9jazsgLyogbG9ja3MgbGlzdCAqLworCQkJ
c3RydWN0IGxpc3RfaGVhZCBsaXN0OworCisJCQlzdHJ1Y3QgbGxpc3RfaGVhZCBmcmVlX2xpc3Q7
CisJCQlzdHJ1Y3Qgd29ya19zdHJ1Y3QgZnJlZV93b3JrOworCQl9IGNvbnRleHRzOwogCX0gZ2Vt
OwogCiAJLyogRm9yIGk5NDVnbSB2YmxhbmsgaXJxIHZzLiBDMyB3b3JrYXJvdW5kICovCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW0uYwppbmRleCA5YzI4Nzc0NDE1NDAuLjg4MTRkYjcwMjNkYiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbS5jCkBAIC0xMjYzLDcgKzEyNjMsNyBAQCBpbnQgaTkxNV9nZW1faW5p
dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCWdvdG8gZXJyX3VubG9jazsK
IAl9CiAKLQlyZXQgPSBpOTE1X2dlbV9jb250ZXh0c19pbml0KGRldl9wcml2KTsKKwlyZXQgPSBp
OTE1X2dlbV9pbml0X2NvbnRleHRzKGRldl9wcml2KTsKIAlpZiAocmV0KSB7CiAJCUdFTV9CVUdf
T04ocmV0ID09IC1FSU8pOwogCQlnb3RvIGVycl9zY3JhdGNoOwpAQCAtMTM0NSw3ICsxMzQ1LDcg
QEAgaW50IGk5MTVfZ2VtX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQog
CX0KIGVycl9jb250ZXh0OgogCWlmIChyZXQgIT0gLUVJTykKLQkJaTkxNV9nZW1fY29udGV4dHNf
ZmluaShkZXZfcHJpdik7CisJCWk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNlX19jb250ZXh0cyhkZXZf
cHJpdik7CiBlcnJfc2NyYXRjaDoKIAlpbnRlbF9ndF9kcml2ZXJfcmVsZWFzZSgmZGV2X3ByaXYt
Pmd0KTsKIGVycl91bmxvY2s6CkBAIC0xNDEzLDExICsxNDEzLDkgQEAgdm9pZCBpOTE1X2dlbV9k
cml2ZXJfcmVtb3ZlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogdm9pZCBp
OTE1X2dlbV9kcml2ZXJfcmVsZWFzZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiB7Ci0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWludGVsX2Vu
Z2luZXNfY2xlYW51cChkZXZfcHJpdik7Ci0JaTkxNV9nZW1fY29udGV4dHNfZmluaShkZXZfcHJp
dik7CisJaTkxNV9nZW1fZHJpdmVyX3JlbGVhc2VfX2NvbnRleHRzKGRldl9wcml2KTsKIAlpbnRl
bF9ndF9kcml2ZXJfcmVsZWFzZSgmZGV2X3ByaXYtPmd0KTsKLQltdXRleF91bmxvY2soJmRldl9w
cml2LT5kcm0uc3RydWN0X211dGV4KTsKIAogCWludGVsX3dhX2xpc3RfZnJlZSgmZGV2X3ByaXYt
Pmd0X3dhX2xpc3QpOwogCkBAIC0xNDI3LDcgKzE0MjUsNyBAQCB2b2lkIGk5MTVfZ2VtX2RyaXZl
cl9yZWxlYXNlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogCWk5MTVfZ2Vt
X2RyYWluX2ZyZWVkX29iamVjdHMoZGV2X3ByaXYpOwogCi0JV0FSTl9PTighbGlzdF9lbXB0eSgm
ZGV2X3ByaXYtPmNvbnRleHRzLmxpc3QpKTsKKwlXQVJOX09OKCFsaXN0X2VtcHR5KCZkZXZfcHJp
di0+Z2VtLmNvbnRleHRzLmxpc3QpKTsKIH0KIAogdm9pZCBpOTE1X2dlbV9pbml0X21taW8oc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5j
CmluZGV4IDBkMDQwNTE3Nzg3Yi4uZGIzMmUwZmU3OGIxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2dlbV9ndHQuYwpAQCAtMTM2Niw3ICsxMzY2LDkgQEAgc3RhdGljIGludCBnZW44X2luaXRfc2Ny
YXRjaChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIAlpZiAodm0tPmhhc19yZWFkX29u
bHkgJiYKIAkgICAgdm0tPmk5MTUtPmtlcm5lbF9jb250ZXh0ICYmCiAJICAgIHZtLT5pOTE1LT5r
ZXJuZWxfY29udGV4dC0+dm0pIHsKLQkJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqY2xvbmUg
PSB2bS0+aTkxNS0+a2VybmVsX2NvbnRleHQtPnZtOworCQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3Nw
YWNlICpjbG9uZSA9CisJCQlyY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKHZtLT5pOTE1LT5rZXJu
ZWxfY29udGV4dC0+dm0sCisJCQkJCQkgIHRydWUpOwogCiAJCUdFTV9CVUdfT04oIWNsb25lLT5o
YXNfcmVhZF9vbmx5KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9w
ZXJmLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYwppbmRleCBkMzZiYTI0OGQ0
MzguLmJmZTZlOWI2ZDcxZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9w
ZXJmLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKQEAgLTE4NTMsOCAr
MTg1Myw4IEBAIHN0YXRpYyBpbnQgZ2VuOF9jb25maWd1cmVfYWxsX2NvbnRleHRzKHN0cnVjdCBp
OTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJfTsKICN1bmRlZiBjdHhfZmxleGV1TgogCXN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4
OwotCWludCBpOworCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsICpjbjsKKwlpbnQgaSwg
ZXJyOwogCiAJZm9yIChpID0gMjsgaSA8IEFSUkFZX1NJWkUocmVncyk7IGkrKykKIAkJcmVnc1tp
XS52YWx1ZSA9IG9hX2NvbmZpZ19mbGV4X3JlZyhvYV9jb25maWcsIHJlZ3NbaV0ucmVnKTsKQEAg
LTE4NzcsMTYgKzE4NzcsMjcgQEAgc3RhdGljIGludCBnZW44X2NvbmZpZ3VyZV9hbGxfY29udGV4
dHMoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwKIAkgKiBjb250ZXh0LiBDb250ZXh0
cyBpZGxlIGF0IHRoZSB0aW1lIG9mIHJlY29uZmlndXJhdGlvbiBhcmUgbm90CiAJICogdHJhcHBl
ZCBiZWhpbmQgdGhlIGJhcnJpZXIuCiAJICovCi0JbGlzdF9mb3JfZWFjaF9lbnRyeShjdHgsICZp
OTE1LT5jb250ZXh0cy5saXN0LCBsaW5rKSB7Ci0JCWludCBlcnI7Ci0KKwlzcGluX2xvY2soJmk5
MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUoY3R4LCBj
biwgJmk5MTUtPmdlbS5jb250ZXh0cy5saXN0LCBsaW5rKSB7CiAJCWlmIChjdHggPT0gaTkxNS0+
a2VybmVsX2NvbnRleHQpCiAJCQljb250aW51ZTsKIAorCQlpZiAoIWtyZWZfZ2V0X3VubGVzc196
ZXJvKCZjdHgtPnJlZikpCisJCQljb250aW51ZTsKKworCQlzcGluX3VubG9jaygmaTkxNS0+Z2Vt
LmNvbnRleHRzLmxvY2spOworCiAJCWVyciA9IGdlbjhfY29uZmlndXJlX2NvbnRleHQoY3R4LCBy
ZWdzLCBBUlJBWV9TSVpFKHJlZ3MpKTsKLQkJaWYgKGVycikKKwkJaWYgKGVycikgeworCQkJaTkx
NV9nZW1fY29udGV4dF9wdXQoY3R4KTsKIAkJCXJldHVybiBlcnI7CisJCX0KKworCQlzcGluX2xv
Y2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKKwkJbGlzdF9zYWZlX3Jlc2V0X25leHQoY3R4
LCBjbiwgbGluayk7CisJCWk5MTVfZ2VtX2NvbnRleHRfcHV0KGN0eCk7CiAJfQorCXNwaW5fdW5s
b2NrKCZpOTE1LT5nZW0uY29udGV4dHMubG9jayk7CiAKIAkvKgogCSAqIEFmdGVyIHVwZGF0aW5n
IGFsbCBvdGhlciBjb250ZXh0cywgd2UgbmVlZCB0byBtb2RpZnkgb3Vyc2VsdmVzLgpAQCAtMTg5
NSw3ICsxOTA2LDYgQEAgc3RhdGljIGludCBnZW44X2NvbmZpZ3VyZV9hbGxfY29udGV4dHMoc3Ry
dWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwKIAkgKi8KIAlmb3JfZWFjaF91YWJpX2VuZ2lu
ZShlbmdpbmUsIGk5MTUpIHsKIAkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlID0gZW5naW5lLT5r
ZXJuZWxfY29udGV4dDsKLQkJaW50IGVycjsKIAogCQlpZiAoZW5naW5lLT5jbGFzcyAhPSBSRU5E
RVJfQ0xBU1MpCiAJCQljb250aW51ZTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfc3lzZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3lzZnMuYwppbmRleCA2
Yjg4ZDkzNDkyN2EuLjU4NTgwOGMyZWU4NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9zeXNmcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3lzZnMuYwpA
QCAtMTQ0LDkgKzE0NCw5IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgYXR0cmlidXRlX2dyb3VwIG1l
ZGlhX3JjNl9hdHRyX2dyb3VwID0gewogfTsKICNlbmRpZgogCi1zdGF0aWMgaW50IGwzX2FjY2Vz
c192YWxpZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGxvZmZfdCBvZmZzZXQp
CitzdGF0aWMgaW50IGwzX2FjY2Vzc192YWxpZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwgbG9mZl90IG9mZnNldCkKIHsKLQlpZiAoIUhBU19MM19EUEYoZGV2X3ByaXYpKQorCWlmICgh
SEFTX0wzX0RQRihpOTE1KSkKIAkJcmV0dXJuIC1FUEVSTTsKIAogCWlmIChvZmZzZXQgJSA0ICE9
IDApCkBAIC0xNjQsMzEgKzE2NCwyNCBAQCBpOTE1X2wzX3JlYWQoc3RydWN0IGZpbGUgKmZpbHAs
IHN0cnVjdCBrb2JqZWN0ICprb2JqLAogCSAgICAgbG9mZl90IG9mZnNldCwgc2l6ZV90IGNvdW50
KQogewogCXN0cnVjdCBkZXZpY2UgKmtkZXYgPSBrb2JqX3RvX2Rldihrb2JqKTsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBrZGV2X21pbm9yX3RvX2k5MTUoa2Rldik7Ci0J
c3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZkZXZfcHJpdi0+ZHJtOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0ga2Rldl9taW5vcl90b19pOTE1KGtkZXYpOwogCWludCBzbGljZSA9
IChpbnQpKHVpbnRwdHJfdClhdHRyLT5wcml2YXRlOwogCWludCByZXQ7CiAKLQljb3VudCA9IHJv
dW5kX2Rvd24oY291bnQsIDQpOwotCi0JcmV0ID0gbDNfYWNjZXNzX3ZhbGlkKGRldl9wcml2LCBv
ZmZzZXQpOworCXJldCA9IGwzX2FjY2Vzc192YWxpZChpOTE1LCBvZmZzZXQpOwogCWlmIChyZXQp
CiAJCXJldHVybiByZXQ7CiAKKwljb3VudCA9IHJvdW5kX2Rvd24oY291bnQsIDQpOwogCWNvdW50
ID0gbWluX3Qoc2l6ZV90LCBHRU43X0wzTE9HX1NJWkUgLSBvZmZzZXQsIGNvdW50KTsKKwltZW1z
ZXQoYnVmLCAwLCBjb3VudCk7CiAKLQlyZXQgPSBpOTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJs
ZShkZXYpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQlpZiAoZGV2X3ByaXYtPmwzX3Bh
cml0eS5yZW1hcF9pbmZvW3NsaWNlXSkKKwlzcGluX2xvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5s
b2NrKTsKKwlpZiAoaTkxNS0+bDNfcGFyaXR5LnJlbWFwX2luZm9bc2xpY2VdKQogCQltZW1jcHko
YnVmLAotCQkgICAgICAgZGV2X3ByaXYtPmwzX3Bhcml0eS5yZW1hcF9pbmZvW3NsaWNlXSArIChv
ZmZzZXQvNCksCisJCSAgICAgICBpOTE1LT5sM19wYXJpdHkucmVtYXBfaW5mb1tzbGljZV0gKyBv
ZmZzZXQgLyA0LAogCQkgICAgICAgY291bnQpOwotCWVsc2UKLQkJbWVtc2V0KGJ1ZiwgMCwgY291
bnQpOwotCi0JbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CisJc3Bpbl91bmxvY2so
Jmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKIAogCXJldHVybiBjb3VudDsKIH0KQEAgLTE5OSw0
NiArMTkyLDQ2IEBAIGk5MTVfbDNfd3JpdGUoc3RydWN0IGZpbGUgKmZpbHAsIHN0cnVjdCBrb2Jq
ZWN0ICprb2JqLAogCSAgICAgIGxvZmZfdCBvZmZzZXQsIHNpemVfdCBjb3VudCkKIHsKIAlzdHJ1
Y3QgZGV2aWNlICprZGV2ID0ga29ial90b19kZXYoa29iaik7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0ga2Rldl9taW5vcl90b19pOTE1KGtkZXYpOwotCXN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYgPSAmZGV2X3ByaXYtPmRybTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IGtkZXZfbWlub3JfdG9faTkxNShrZGV2KTsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqY3R4OwogCWludCBzbGljZSA9IChpbnQpKHVpbnRwdHJfdClhdHRyLT5wcml2YXRlOwotCXUz
MiAqKnJlbWFwX2luZm87CisJdTMyICpyZW1hcF9pbmZvLCAqZnJlZW1lID0gTlVMTDsKIAlpbnQg
cmV0OwogCi0JcmV0ID0gbDNfYWNjZXNzX3ZhbGlkKGRldl9wcml2LCBvZmZzZXQpOworCXJldCA9
IGwzX2FjY2Vzc192YWxpZChpOTE1LCBvZmZzZXQpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7
CiAKLQlyZXQgPSBpOTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZShkZXYpOwotCWlmIChyZXQp
Ci0JCXJldHVybiByZXQ7CisJcmVtYXBfaW5mbyA9IGt6YWxsb2MoR0VON19MM0xPR19TSVpFLCBH
RlBfS0VSTkVMKTsKKwlpZiAoIXJlbWFwX2luZm8pCisJCXJldHVybiAtRU5PTUVNOwogCi0JcmVt
YXBfaW5mbyA9ICZkZXZfcHJpdi0+bDNfcGFyaXR5LnJlbWFwX2luZm9bc2xpY2VdOwotCWlmICgh
KnJlbWFwX2luZm8pIHsKLQkJKnJlbWFwX2luZm8gPSBremFsbG9jKEdFTjdfTDNMT0dfU0laRSwg
R0ZQX0tFUk5FTCk7Ci0JCWlmICghKnJlbWFwX2luZm8pIHsKLQkJCXJldCA9IC1FTk9NRU07Ci0J
CQlnb3RvIG91dDsKLQkJfQorCXNwaW5fbG9jaygmaTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOwor
CisJaWYgKGk5MTUtPmwzX3Bhcml0eS5yZW1hcF9pbmZvW3NsaWNlXSkgeworCQlmcmVlbWUgPSBy
ZW1hcF9pbmZvOworCQlyZW1hcF9pbmZvID0gaTkxNS0+bDNfcGFyaXR5LnJlbWFwX2luZm9bc2xp
Y2VdOworCX0gZWxzZSB7CisJCWk5MTUtPmwzX3Bhcml0eS5yZW1hcF9pbmZvW3NsaWNlXSA9IHJl
bWFwX2luZm87CiAJfQogCi0JLyogVE9ETzogSWRlYWxseSB3ZSByZWFsbHkgd2FudCBhIEdQVSBy
ZXNldCBoZXJlIHRvIG1ha2Ugc3VyZSBlcnJvcnMKLQkgKiBhcmVuJ3QgcHJvcGFnYXRlZC4gU2lu
Y2UgSSBjYW5ub3QgZmluZCBhIHN0YWJsZSB3YXkgdG8gcmVzZXQgdGhlIEdQVQotCSAqIGF0IHRo
aXMgcG9pbnQgaXQgaXMgbGVmdCBhcyBhIFRPRE8uCi0JKi8KLQltZW1jcHkoKnJlbWFwX2luZm8g
KyAob2Zmc2V0LzQpLCBidWYsIGNvdW50KTsKKwljb3VudCA9IHJvdW5kX2Rvd24oY291bnQsIDQp
OworCW1lbWNweShyZW1hcF9pbmZvICsgb2Zmc2V0IC8gNCwgYnVmLCBjb3VudCk7CiAKIAkvKiBO
QjogV2UgZGVmZXIgdGhlIHJlbWFwcGluZyB1bnRpbCB3ZSBzd2l0Y2ggdG8gdGhlIGNvbnRleHQg
Ki8KLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KGN0eCwgJmRldl9wcml2LT5jb250ZXh0cy5saXN0LCBs
aW5rKQotCQljdHgtPnJlbWFwX3NsaWNlIHw9ICgxPDxzbGljZSk7CisJbGlzdF9mb3JfZWFjaF9l
bnRyeShjdHgsICZpOTE1LT5nZW0uY29udGV4dHMubGlzdCwgbGluaykKKwkJY3R4LT5yZW1hcF9z
bGljZSB8PSBCSVQoc2xpY2UpOwogCi0JcmV0ID0gY291bnQ7CisJc3Bpbl91bmxvY2soJmk5MTUt
PmdlbS5jb250ZXh0cy5sb2NrKTsKKwlrZnJlZShmcmVlbWUpOwogCi1vdXQ6Ci0JbXV0ZXhfdW5s
b2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CisJLyoKKwkgKiBUT0RPOiBJZGVhbGx5IHdlIHJlYWxs
eSB3YW50IGEgR1BVIHJlc2V0IGhlcmUgdG8gbWFrZSBzdXJlIGVycm9ycworCSAqIGFyZW4ndCBw
cm9wYWdhdGVkLiBTaW5jZSBJIGNhbm5vdCBmaW5kIGEgc3RhYmxlIHdheSB0byByZXNldCB0aGUg
R1BVCisJICogYXQgdGhpcyBwb2ludCBpdCBpcyBsZWZ0IGFzIGEgVE9ETy4KKwkgKi8KIAotCXJl
dHVybiByZXQ7CisJcmV0dXJuIGNvdW50OwogfQogCiBzdGF0aWMgY29uc3Qgc3RydWN0IGJpbl9h
dHRyaWJ1dGUgZHBmX2F0dHJzID0gewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV90cmFjZS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV90cmFjZS5oCmluZGV4IDFm
MmNmNmNmYWZiNS4uN2VmN2ExZTE2NjRjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3RyYWNlLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV90cmFjZS5oCkBA
IC05NTIsNyArOTUyLDcgQEAgREVDTEFSRV9FVkVOVF9DTEFTUyhpOTE1X2NvbnRleHQsCiAJVFBf
ZmFzdF9hc3NpZ24oCiAJCQlfX2VudHJ5LT5kZXYgPSBjdHgtPmk5MTUtPmRybS5wcmltYXJ5LT5p
bmRleDsKIAkJCV9fZW50cnktPmN0eCA9IGN0eDsKLQkJCV9fZW50cnktPnZtID0gY3R4LT52bTsK
KwkJCV9fZW50cnktPnZtID0gcmN1X2FjY2Vzc19wb2ludGVyKGN0eC0+dm0pOwogCSksCiAKIAlU
UF9wcmludGsoImRldj0ldSwgY3R4PSVwLCBjdHhfdm09JXAiLApkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvaTkxNV9nZW0uYwppbmRleCAwMzQ2YzNlNWI2YjYuLmJmYTQwYTViNmQ5OCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtLmMKQEAgLTEzOCwxMSAr
MTM4LDkgQEAgc3RhdGljIGludCBpZ3RfZ2VtX3N1c3BlbmQodm9pZCAqYXJnKQogCQlyZXR1cm4g
UFRSX0VSUihmaWxlKTsKIAogCWVyciA9IC1FTk9NRU07Ci0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CiAJY3R4ID0gbGl2ZV9jb250ZXh0KGk5MTUsIGZpbGUpOwogCWlmICgh
SVNfRVJSKGN0eCkpCiAJCWVyciA9IHN3aXRjaF90b19jb250ZXh0KGk5MTUsIGN0eCk7Ci0JbXV0
ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpZiAoZXJyKQogCQlnb3RvIG91
dDsKIApAQCAtMTU3LDkgKzE1NSw3IEBAIHN0YXRpYyBpbnQgaWd0X2dlbV9zdXNwZW5kKHZvaWQg
KmFyZykKIAogCXBtX3Jlc3VtZShpOTE1KTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCWVyciA9IHN3aXRjaF90b19jb250ZXh0KGk5MTUsIGN0eCk7Ci0JbXV0ZXhf
dW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIG91dDoKIAltb2NrX2ZpbGVfZnJlZShp
OTE1LCBmaWxlKTsKIAlyZXR1cm4gZXJyOwpAQCAtMTc3LDExICsxNzMsOSBAQCBzdGF0aWMgaW50
IGlndF9nZW1faGliZXJuYXRlKHZvaWQgKmFyZykKIAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAK
IAllcnIgPSAtRU5PTUVNOwotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
CWN0eCA9IGxpdmVfY29udGV4dChpOTE1LCBmaWxlKTsKIAlpZiAoIUlTX0VSUihjdHgpKQogCQll
cnIgPSBzd2l0Y2hfdG9fY29udGV4dChpOTE1LCBjdHgpOwotCW11dGV4X3VubG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKGVycikKIAkJZ290byBvdXQ7CiAKQEAgLTE5Niw5ICsx
OTAsNyBAQCBzdGF0aWMgaW50IGlndF9nZW1faGliZXJuYXRlKHZvaWQgKmFyZykKIAogCXBtX3Jl
c3VtZShpOTE1KTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWVy
ciA9IHN3aXRjaF90b19jb250ZXh0KGk5MTUsIGN0eCk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKIG91dDoKIAltb2NrX2ZpbGVfZnJlZShpOTE1LCBmaWxlKTsKIAly
ZXR1cm4gZXJyOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5
MTVfZ2VtX2V2aWN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1f
ZXZpY3QuYwppbmRleCBmMzlmMDI4MmU3OGMuLjBhZjlhNThkMDExZCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMKQEAgLTQ3Myw3ICs0NzMs
NiBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9jb250ZXh0cyh2b2lkICphcmcpCiAJCX0KIAogCQlj
b3VudCA9IDA7Ci0JCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQlvbnN0
YWNrX2ZlbmNlX2luaXQoJmZlbmNlKTsKIAkJZG8gewogCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnE7CkBAIC01MTAsOCArNTA5LDYgQEAgc3RhdGljIGludCBpZ3RfZXZpY3RfY29udGV4dHModm9p
ZCAqYXJnKQogCQkJY291bnQrKzsKIAkJCWVyciA9IDA7CiAJCX0gd2hpbGUoMSk7Ci0JCW11dGV4
X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAkJb25zdGFja19mZW5jZV9maW5p
KCZmZW5jZSk7CiAJCXByX2luZm8oIlN1Ym1pdHRlZCAlbHUgY29udGV4dHMvcmVxdWVzdHMgb24g
JXNcbiIsCiAJCQljb3VudCwgZW5naW5lLT5uYW1lKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ndHQuYwppbmRleCA5OTM5ZGQ0MGM2YTguLjY3NzdhMzM1YmQ0
NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2d0
dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ndHQuYwpA
QCAtMTI0Niw2ICsxMjQ2LDcgQEAgc3RhdGljIGludCBleGVyY2lzZV9tb2NrKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgICAgdW5zaWduZWQgbG9uZyBlbmRfdGltZSkpCiB7
CiAJY29uc3QgdTY0IGxpbWl0ID0gdG90YWxyYW1fcGFnZXMoKSA8PCBQQUdFX1NISUZUOworCXN0
cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpj
dHg7CiAJSUdUX1RJTUVPVVQoZW5kX3RpbWUpOwogCWludCBlcnI7CkBAIC0xMjU0LDcgKzEyNTUs
OCBAQCBzdGF0aWMgaW50IGV4ZXJjaXNlX21vY2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJaWYgKCFjdHgpCiAJCXJldHVybiAtRU5PTUVNOwogCi0JZXJyID0gZnVuYyhpOTE1LCBj
dHgtPnZtLCAwLCBtaW4oY3R4LT52bS0+dG90YWwsIGxpbWl0KSwgZW5kX3RpbWUpOworCXZtID0g
cmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChjdHgtPnZtLCB0cnVlKTsKKwllcnIgPSBmdW5jKGk5
MTUsIHZtLCAwLCBtaW4odm0tPnRvdGFsLCBsaW1pdCksIGVuZF90aW1lKTsKIAogCW1vY2tfY29u
dGV4dF9jbG9zZShjdHgpOwogCXJldHVybiBlcnI7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMKaW5kZXggZDFlZTM4NGEzMjYwLi40YWJmNTI3MzM1MjAg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3Qu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMKQEAg
LTE4MSw5ICsxODEsNyBAQCBzdGF0aWMgaW50IGlndF9yZXF1ZXN0X3Jld2luZCh2b2lkICphcmcp
CiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCWludCBlcnIgPSAtRUlOVkFMOwogCi0JbXV0
ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJY3R4WzBdID0gbW9ja19jb250ZXh0
KGk5MTUsICJBIik7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAog
CWNlID0gaTkxNV9nZW1fY29udGV4dF9nZXRfZW5naW5lKGN0eFswXSwgUkNTMCk7CiAJR0VNX0JV
R19PTihJU19FUlIoY2UpKTsKQEAgLTE5Nyw5ICsxOTUsNyBAQCBzdGF0aWMgaW50IGlndF9yZXF1
ZXN0X3Jld2luZCh2b2lkICphcmcpCiAJaTkxNV9yZXF1ZXN0X2dldChyZXF1ZXN0KTsKIAlpOTE1
X3JlcXVlc3RfYWRkKHJlcXVlc3QpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAJY3R4WzFdID0gbW9ja19jb250ZXh0KGk5MTUsICJCIik7Ci0JbXV0ZXhfdW5sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCWNlID0gaTkxNV9nZW1fY29udGV4dF9nZXRf
ZW5naW5lKGN0eFsxXSwgUkNTMCk7CiAJR0VNX0JVR19PTihJU19FUlIoY2UpKTsKQEAgLTQzOCw5
ICs0MzQsNyBAQCBzdGF0aWMgaW50IG1vY2tfYnJlYWRjcnVtYnNfc21va2V0ZXN0KHZvaWQgKmFy
ZykKIAl9CiAKIAlmb3IgKG4gPSAwOyBuIDwgdC5uY29udGV4dHM7IG4rKykgewotCQltdXRleF9s
b2NrKCZ0LmVuZ2luZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCXQuY29udGV4dHNbbl0g
PSBtb2NrX2NvbnRleHQodC5lbmdpbmUtPmk5MTUsICJtb2NrIik7Ci0JCW11dGV4X3VubG9jaygm
dC5lbmdpbmUtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQlpZiAoIXQuY29udGV4dHNbbl0p
IHsKIAkJCXJldCA9IC1FTk9NRU07CiAJCQlnb3RvIG91dF9jb250ZXh0czsKQEAgLTczNCw3ICs3
MjgsOCBAQCBzdGF0aWMgaW50IGxpdmVfZW1wdHlfcmVxdWVzdCh2b2lkICphcmcpCiBzdGF0aWMg
c3RydWN0IGk5MTVfdm1hICpyZWN1cnNpdmVfYmF0Y2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCiB7CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IGk5MTUtPmtlcm5lbF9j
b250ZXh0OwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gY3R4LT52bSA/OiAmaTkx
NS0+Z2d0dC52bTsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9CisJCXJjdV9kZXJl
ZmVyZW5jZV9wcm90ZWN0ZWQoY3R4LT52bSwgdHJ1ZSkgPzogJmk5MTUtPmdndHQudm07CiAJc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKIAljb25zdCBpbnQgZ2VuID0gSU5URUxfR0VO
KGk5MTUpOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwpAQCAtMTEwOSw5ICsxMTA0LDcgQEAgc3Rh
dGljIGludCBsaXZlX2JyZWFkY3J1bWJzX3Ntb2tldGVzdCh2b2lkICphcmcpCiAJfQogCiAJZm9y
IChuID0gMDsgbiA8IHRbMF0ubmNvbnRleHRzOyBuKyspIHsKLQkJbXV0ZXhfbG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAJCXRbMF0uY29udGV4dHNbbl0gPSBsaXZlX2NvbnRleHQoaTkx
NSwgZmlsZSk7Ci0JCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWlm
ICghdFswXS5jb250ZXh0c1tuXSkgewogCQkJcmV0ID0gLUVOT01FTTsKIAkJCWdvdG8gb3V0X2Nv
bnRleHRzOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVf
dm1hLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYwppbmRleCBh
YzFmZjU1OGViOTAuLmY2ZTZiMGFhZTM4YyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvc2VsZnRlc3RzL2k5MTVfdm1hLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2k5MTVfdm1hLmMKQEAgLTM4LDcgKzM4LDcgQEAgc3RhdGljIGJvb2wgYXNzZXJ0X3ZtYShz
dHJ1Y3QgaTkxNV92bWEgKnZtYSwKIHsKIAlib29sIG9rID0gdHJ1ZTsKIAotCWlmICh2bWEtPnZt
ICE9IGN0eC0+dm0pIHsKKwlpZiAodm1hLT52bSAhPSByY3VfYWNjZXNzX3BvaW50ZXIoY3R4LT52
bSkpIHsKIAkJcHJfZXJyKCJWTUEgY3JlYXRlZCB3aXRoIHdyb25nIFZNXG4iKTsKIAkJb2sgPSBm
YWxzZTsKIAl9CkBAIC0xMTMsNyArMTEzLDggQEAgc3RhdGljIGludCBjcmVhdGVfdm1hcyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KG9iaiwgb2Jq
ZWN0cywgc3RfbGluaykgewogCQlmb3IgKHBpbm5lZCA9IDA7IHBpbm5lZCA8PSAxOyBwaW5uZWQr
KykgewogCQkJbGlzdF9mb3JfZWFjaF9lbnRyeShjdHgsIGNvbnRleHRzLCBsaW5rKSB7Ci0JCQkJ
c3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSBjdHgtPnZtOworCQkJCXN0cnVjdCBpOTE1
X2FkZHJlc3Nfc3BhY2UgKnZtID0KKwkJCQkJcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChjdHgt
PnZtLCB0cnVlKTsKIAkJCQlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAkJCQlpbnQgZXJyOwogCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNl
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKaW5k
ZXggZWZlNDBjMjlmY2YyLi4wZWQyMWE3Yjg2ODIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKQEAgLTU5LDExICs1OSw5IEBAIHN0YXRp
YyB2b2lkIG1vY2tfZGV2aWNlX3JlbGVhc2Uoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAogCWk5
MTVfZ2VtX2RyYWluX3dvcmtxdWV1ZShpOTE1KTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKQogCQltb2Nr
X2VuZ2luZV9mcmVlKGVuZ2luZSk7Ci0JaTkxNV9nZW1fY29udGV4dHNfZmluaShpOTE1KTsKLQlt
dXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWk5MTVfZ2VtX2RyaXZlcl9y
ZWxlYXNlX19jb250ZXh0cyhpOTE1KTsKIAogCWludGVsX3RpbWVsaW5lc19maW5pKGk5MTUpOwog
CkBAIC0yMDcsNyArMjA1LDcgQEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKm1vY2tfZ2VtX2Rl
dmljZSh2b2lkKQogCXJldHVybiBpOTE1OwogCiBlcnJfY29udGV4dDoKLQlpOTE1X2dlbV9jb250
ZXh0c19maW5pKGk5MTUpOworCWk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNlX19jb250ZXh0cyhpOTE1
KTsKIGVycl9lbmdpbmU6CiAJbW9ja19lbmdpbmVfZnJlZShpOTE1LT5lbmdpbmVbUkNTMF0pOwog
ZXJyX3VubG9jazoKLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGlu
Zm8vaW50ZWwtZ2Z4

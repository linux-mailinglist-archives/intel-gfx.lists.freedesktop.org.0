Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3E3FE6ABBE
	for <lists+intel-gfx@lfdr.de>; Tue, 16 Jul 2019 17:28:51 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B47C26E13C;
	Tue, 16 Jul 2019 15:28:49 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga14.intel.com (mga14.intel.com [192.55.52.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1EA526E13C
 for <intel-gfx@lists.freedesktop.org>; Tue, 16 Jul 2019 15:28:49 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga002.fm.intel.com ([10.253.24.26])
 by fmsmga103.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 16 Jul 2019 08:28:48 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,498,1557212400"; d="scan'208";a="194921287"
Received: from unknown (HELO abj-mbp2.local) ([10.249.254.172])
 by fmsmga002.fm.intel.com with ESMTP; 16 Jul 2019 08:28:46 -0700
To: Chris Wilson <chris@chris-wilson.co.uk>, intel-gfx@lists.freedesktop.org
References: <20190712112725.2892-1-chris@chris-wilson.co.uk>
 <20190712112725.2892-4-chris@chris-wilson.co.uk>
From: Abdiel Janulgue <abdiel.janulgue@linux.intel.com>
Message-ID: <efe3e263-13e5-36e4-156b-60b01999090e@linux.intel.com>
Date: Tue, 16 Jul 2019 18:28:44 +0300
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:60.0)
 Gecko/20100101 Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <20190712112725.2892-4-chris@chris-wilson.co.uk>
Content-Language: en-US
Subject: Re: [Intel-gfx] [PATCH 3/4] drm/i915/gtt: Recursive ppgtt alloc for
 gen8
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

CgpPbiAxMi8wNy8yMDE5IDE0LjI3LCBDaHJpcyBXaWxzb24gd3JvdGU6Cj4gUmVmYWN0b3IgdGhl
IHNlcGFyYXRlIGFsbG9jYXRpb24gcm91dGluZXMgaW50byBhIHNpbmdsZSByZWN1cnNpdmUKPiBm
dW5jdGlvbi4KPiAKUmV2aWV3ZWQtYnk6IEFiZGllbCBKYW51bGd1ZSA8YWJkaWVsLmphbnVsZ3Vl
QGxpbnV4LmludGVsLmNvbT4KCj4gU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0Bj
aHJpcy13aWxzb24uY28udWs+Cj4gLS0tCj4gIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2Vt
X2d0dC5jIHwgMjcyICsrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0KPiAgMSBmaWxlIGNoYW5n
ZWQsIDk3IGluc2VydGlvbnMoKyksIDE3NSBkZWxldGlvbnMoLSkKPiAKPiBkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbV9ndHQuYwo+IGluZGV4IDdiMmYzMTg4ZDQzNS4uNzJlMGY5Nzk5YTQ2IDEwMDY0
NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCj4gKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKPiBAQCAtMTAwNywxOTkgKzEwMDcsMTE5
IEBAIHN0YXRpYyB2b2lkIGdlbjhfcHBndHRfY2xlYXIoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZSAqdm0sCj4gIAkJCSAgIHN0YXJ0LCBzdGFydCArIGxlbmd0aCwgdm0tPnRvcCk7Cj4gIH0KPiAg
Cj4gLXN0YXRpYyB2b2lkIGdlbjhfcHBndHRfY2xlYXJfcGQoc3RydWN0IGk5MTVfYWRkcmVzc19z
cGFjZSAqdm0sCj4gLQkJCQlzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVjdG9yeSAqcGQsCj4gLQkJCQl1
NjQgc3RhcnQsIHU2NCBsZW5ndGgpCj4gLXsKPiAtCUdFTV9CVUdfT04oIUlTX0FMSUdORUQoc3Rh
cnQsIEJJVF9VTEwoR0VOOF9QVEVfU0hJRlQpKSk7Cj4gLQlHRU1fQlVHX09OKCFJU19BTElHTkVE
KGxlbmd0aCwgQklUX1VMTChHRU44X1BURV9TSElGVCkpKTsKPiAtCj4gLQlzdGFydCA+Pj0gR0VO
OF9QVEVfU0hJRlQ7Cj4gLQlsZW5ndGggPj49IEdFTjhfUFRFX1NISUZUOwo+IC0KPiAtCV9fZ2Vu
OF9wcGd0dF9jbGVhcih2bSwgcGQsIHN0YXJ0LCBzdGFydCArIGxlbmd0aCwgMSk7Cj4gLX0KPiAt
Cj4gLXN0YXRpYyB2b2lkIGdlbjhfcHBndHRfY2xlYXJfcGRwKHN0cnVjdCBpOTE1X2FkZHJlc3Nf
c3BhY2UgKnZtLAo+IC0JCQkJIHN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICogY29uc3QgcGRw
LAo+IC0JCQkJIHU2NCBzdGFydCwgdTY0IGxlbmd0aCkKPiAtewo+IC0JR0VNX0JVR19PTighSVNf
QUxJR05FRChzdGFydCwgQklUX1VMTChHRU44X1BURV9TSElGVCkpKTsKPiAtCUdFTV9CVUdfT04o
IUlTX0FMSUdORUQobGVuZ3RoLCBCSVRfVUxMKEdFTjhfUFRFX1NISUZUKSkpOwo+IC0KPiAtCXN0
YXJ0ID4+PSBHRU44X1BURV9TSElGVDsKPiAtCWxlbmd0aCA+Pj0gR0VOOF9QVEVfU0hJRlQ7Cj4g
LQo+IC0JX19nZW44X3BwZ3R0X2NsZWFyKHZtLCBwZHAsIHN0YXJ0LCBzdGFydCArIGxlbmd0aCwg
Mik7Cj4gLX0KPiAtCj4gLXN0YXRpYyBpbnQgZ2VuOF9wcGd0dF9hbGxvY19wZChzdHJ1Y3QgaTkx
NV9hZGRyZXNzX3NwYWNlICp2bSwKPiAtCQkJICAgICAgIHN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0
b3J5ICpwZCwKPiAtCQkJICAgICAgIHU2NCBzdGFydCwgdTY0IGxlbmd0aCkKPiArc3RhdGljIGlu
dCBfX2dlbjhfcHBndHRfYWxsb2Moc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqIGNvbnN0IHZt
LAo+ICsJCQkgICAgICBzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVjdG9yeSAqIGNvbnN0IHBkLAo+ICsJ
CQkgICAgICB1NjQgKiBjb25zdCBzdGFydCwgdTY0IGVuZCwgaW50IGx2bCkKPiAgewo+IC0Jc3Ry
dWN0IGk5MTVfcGFnZV90YWJsZSAqcHQsICphbGxvYyA9IE5VTEw7Cj4gLQl1NjQgZnJvbSA9IHN0
YXJ0Owo+IC0JdW5zaWduZWQgaW50IHBkZTsKPiArCWNvbnN0IHN0cnVjdCBpOTE1X3BhZ2Vfc2Ny
YXRjaCAqIGNvbnN0IHNjcmF0Y2ggPSAmdm0tPnNjcmF0Y2hbbHZsXTsKPiArCXN0cnVjdCBpOTE1
X3BhZ2VfdGFibGUgKmFsbG9jID0gTlVMTDsKPiArCXVuc2lnbmVkIGludCBpZHgsIGxlbjsKPiAg
CWludCByZXQgPSAwOwo+ICAKPiArCWxlbiA9IGdlbjhfcGRfcmFuZ2UoKnN0YXJ0LCBlbmQsIGx2
bC0tLCAmaWR4KTsKPiArCURCRygiJXMoJXApOntsdmw6JWQsIHN0YXJ0OiVsbHgsIGVuZDolbGx4
LCBpZHg6JWQsIGxlbjolZCwgdXNlZDolZH1cbiIsCj4gKwkgICAgX19mdW5jX18sIHZtLCBsdmwg
KyAxLCAqc3RhcnQsIGVuZCwKPiArCSAgICBpZHgsIGxlbiwgYXRvbWljX3JlYWQocHhfdXNlZChw
ZCkpKTsKPiArCUdFTV9CVUdfT04oIWxlbiB8fCAoaWR4ICsgbGVuIC0gMSkgPj4gZ2VuOF9wZF9z
aGlmdCgxKSk7Cj4gKwo+ICAJc3Bpbl9sb2NrKCZwZC0+bG9jayk7Cj4gLQlnZW44X2Zvcl9lYWNo
X3BkZShwdCwgcGQsIHN0YXJ0LCBsZW5ndGgsIHBkZSkgewo+IC0JCWNvbnN0IGludCBjb3VudCA9
IGdlbjhfcHRlX2NvdW50KHN0YXJ0LCBsZW5ndGgpOwo+ICsJR0VNX0JVR19PTighYXRvbWljX3Jl
YWQocHhfdXNlZChwZCkpKTsgLyogTXVzdCBiZSBwaW5uZWQhICovCj4gKwlkbyB7Cj4gKwkJc3Ry
dWN0IGk5MTVfcGFnZV90YWJsZSAqcHQgPSBwZC0+ZW50cnlbaWR4XTsKPiAgCj4gIAkJaWYgKCFw
dCkgewo+ICAJCQlzcGluX3VubG9jaygmcGQtPmxvY2spOwo+ICAKPiAtCQkJcHQgPSBmZXRjaF9h
bmRfemVybygmYWxsb2MpOwo+IC0JCQlpZiAoIXB0KQo+IC0JCQkJcHQgPSBhbGxvY19wdCh2bSk7
Cj4gLQkJCWlmIChJU19FUlIocHQpKSB7Cj4gLQkJCQlyZXQgPSBQVFJfRVJSKHB0KTsKPiAtCQkJ
CWdvdG8gdW53aW5kOwo+IC0JCQl9Cj4gKwkJCURCRygiJXMoJXApOnsgbHZsOiVkLCBpZHg6JWQg
fSBhbGxvY2F0aW5nIG5ldyB0cmVlXG4iLAo+ICsJCQkgICAgX19mdW5jX18sIHZtLCBsdmwgKyAx
LCBpZHgpOwo+ICAKPiAtCQkJaWYgKGNvdW50IDwgR0VOOF9QVEVTIHx8IGludGVsX3ZncHVfYWN0
aXZlKHZtLT5pOTE1KSkKPiAtCQkJCWZpbGxfcHgocHQsIHZtLT5zY3JhdGNoWzBdLmVuY29kZSk7
Cj4gKwkJCXB0ID0gZmV0Y2hfYW5kX3plcm8oJmFsbG9jKTsKPiArCQkJaWYgKGx2bCkgewo+ICsJ
CQkJaWYgKCFwdCkgewo+ICsJCQkJCXB0ID0gJmFsbG9jX3BkKHZtKS0+cHQ7Cj4gKwkJCQkJaWYg
KElTX0VSUihwdCkpIHsKPiArCQkJCQkJcmV0ID0gUFRSX0VSUihwdCk7Cj4gKwkJCQkJCWdvdG8g
b3V0Owo+ICsJCQkJCX0KPiArCQkJCX0KPiAgCj4gLQkJCXNwaW5fbG9jaygmcGQtPmxvY2spOwo+
IC0JCQlpZiAoIXBkLT5lbnRyeVtwZGVdKSB7Cj4gLQkJCQlzZXRfcGRfZW50cnkocGQsIHBkZSwg
cHQpOwo+ICsJCQkJZmlsbF9weChwdCwgdm0tPnNjcmF0Y2hbbHZsXS5lbmNvZGUpOwo+ICAJCQl9
IGVsc2Ugewo+IC0JCQkJYWxsb2MgPSBwdDsKPiAtCQkJCXB0ID0gcGQtPmVudHJ5W3BkZV07Cj4g
LQkJCX0KPiAtCQl9Cj4gLQo+IC0JCWF0b21pY19hZGQoY291bnQsICZwdC0+dXNlZCk7Cj4gLQl9
Cj4gLQlzcGluX3VubG9jaygmcGQtPmxvY2spOwo+IC0JZ290byBvdXQ7Cj4gLQo+IC11bndpbmQ6
Cj4gLQlnZW44X3BwZ3R0X2NsZWFyX3BkKHZtLCBwZCwgZnJvbSwgc3RhcnQgLSBmcm9tKTsKPiAt
b3V0Ogo+IC0JaWYgKGFsbG9jKQo+IC0JCWZyZWVfcHgodm0sIGFsbG9jKTsKPiAtCXJldHVybiBy
ZXQ7Cj4gLX0KPiAtCj4gLXN0YXRpYyBpbnQgZ2VuOF9wcGd0dF9hbGxvY19wZHAoc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqdm0sCj4gLQkJCQlzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVjdG9yeSAq
cGRwLAo+IC0JCQkJdTY0IHN0YXJ0LCB1NjQgbGVuZ3RoKQo+IC17Cj4gLQlzdHJ1Y3QgaTkxNV9w
YWdlX2RpcmVjdG9yeSAqcGQsICphbGxvYyA9IE5VTEw7Cj4gLQl1NjQgZnJvbSA9IHN0YXJ0Owo+
IC0JdW5zaWduZWQgaW50IHBkcGU7Cj4gLQlpbnQgcmV0ID0gMDsKPiArCQkJCWlmICghcHQpIHsK
PiArCQkJCQlwdCA9IGFsbG9jX3B0KHZtKTsKPiArCQkJCQlpZiAoSVNfRVJSKHB0KSkgewo+ICsJ
CQkJCQlyZXQgPSBQVFJfRVJSKHB0KTsKPiArCQkJCQkJZ290byBvdXQ7Cj4gKwkJCQkJfQo+ICsJ
CQkJfQo+ICAKPiAtCXNwaW5fbG9jaygmcGRwLT5sb2NrKTsKPiAtCWdlbjhfZm9yX2VhY2hfcGRw
ZShwZCwgcGRwLCBzdGFydCwgbGVuZ3RoLCBwZHBlKSB7Cj4gLQkJaWYgKCFwZCkgewo+IC0JCQlz
cGluX3VubG9jaygmcGRwLT5sb2NrKTsKPiAtCj4gLQkJCXBkID0gZmV0Y2hfYW5kX3plcm8oJmFs
bG9jKTsKPiAtCQkJaWYgKCFwZCkKPiAtCQkJCXBkID0gYWxsb2NfcGQodm0pOwo+IC0JCQlpZiAo
SVNfRVJSKHBkKSkgewo+IC0JCQkJcmV0ID0gUFRSX0VSUihwZCk7Cj4gLQkJCQlnb3RvIHVud2lu
ZDsKPiArCQkJCWlmIChpbnRlbF92Z3B1X2FjdGl2ZSh2bS0+aTkxNSkgfHwKPiArCQkJCSAgICBn
ZW44X3B0X2NvdW50KCpzdGFydCwgZW5kKSA8IEk5MTVfUERFUykKPiArCQkJCQlmaWxsX3B4KHB0
LCB2bS0+c2NyYXRjaFtsdmxdLmVuY29kZSk7Cj4gIAkJCX0KPiAgCj4gLQkJCWZpbGxfcHgocGQs
IHZtLT5zY3JhdGNoWzFdLmVuY29kZSk7Cj4gKwkJCXNwaW5fbG9jaygmcGQtPmxvY2spOwo+ICsJ
CQlpZiAobGlrZWx5KCFwZC0+ZW50cnlbaWR4XSkpCj4gKwkJCQlzZXRfcGRfZW50cnkocGQsIGlk
eCwgcHQpOwo+ICsJCQllbHNlCj4gKwkJCQlhbGxvYyA9IHB0LCBwdCA9IHBkLT5lbnRyeVtpZHhd
Owo+ICsJCX0KPiAgCj4gLQkJCXNwaW5fbG9jaygmcGRwLT5sb2NrKTsKPiAtCQkJaWYgKCFwZHAt
PmVudHJ5W3BkcGVdKSB7Cj4gLQkJCQlzZXRfcGRfZW50cnkocGRwLCBwZHBlLCBwZCk7Cj4gLQkJ
CX0gZWxzZSB7Cj4gLQkJCQlhbGxvYyA9IHBkOwo+IC0JCQkJcGQgPSBwZHAtPmVudHJ5W3BkcGVd
Owo+ICsJCWlmIChsdmwpIHsKPiArCQkJYXRvbWljX2luYygmcHQtPnVzZWQpOwo+ICsJCQlzcGlu
X3VubG9jaygmcGQtPmxvY2spOwo+ICsKPiArCQkJcmV0ID0gX19nZW44X3BwZ3R0X2FsbG9jKHZt
LCBhc19wZChwdCksCj4gKwkJCQkJCSBzdGFydCwgZW5kLCBsdmwpOwo+ICsJCQlpZiAodW5saWtl
bHkocmV0KSkgewo+ICsJCQkJaWYgKHJlbGVhc2VfcGRfZW50cnkocGQsIGlkeCwgcHQsIHNjcmF0
Y2gpKQo+ICsJCQkJCWZyZWVfcHgodm0sIHB0KTsKPiArCQkJCWdvdG8gb3V0Owo+ICAJCQl9Cj4g
LQkJfQo+IC0JCWF0b21pY19pbmMocHhfdXNlZChwZCkpOwo+IC0JCXNwaW5fdW5sb2NrKCZwZHAt
PmxvY2spOwo+ICAKPiAtCQlyZXQgPSBnZW44X3BwZ3R0X2FsbG9jX3BkKHZtLCBwZCwgc3RhcnQs
IGxlbmd0aCk7Cj4gLQkJaWYgKHVubGlrZWx5KHJldCkpCj4gLQkJCWdvdG8gdW53aW5kX3BkOwo+
ICsJCQlzcGluX2xvY2soJnBkLT5sb2NrKTsKPiArCQkJYXRvbWljX2RlYygmcHQtPnVzZWQpOwo+
ICsJCQlHRU1fQlVHX09OKCFhdG9taWNfcmVhZCgmcHQtPnVzZWQpKTsKPiArCQl9IGVsc2Ugewo+
ICsJCQl1bnNpZ25lZCBpbnQgY291bnQgPSBnZW44X3B0X2NvdW50KCpzdGFydCwgZW5kKTsKPiAg
Cj4gLQkJc3Bpbl9sb2NrKCZwZHAtPmxvY2spOwo+IC0JCWF0b21pY19kZWMocHhfdXNlZChwZCkp
Owo+IC0JfQo+IC0Jc3Bpbl91bmxvY2soJnBkcC0+bG9jayk7Cj4gLQlnb3RvIG91dDsKPiArCQkJ
REJHKCIlcyglcCk6e2x2bDolZCwgc3RhcnQ6JWxseCwgZW5kOiVsbHgsIGlkeDolZCwgbGVuOiVk
LCB1c2VkOiVkfSBpbnNlcnRpbmcgcHRlXG4iLAo+ICsJCQkgICAgX19mdW5jX18sIHZtLCBsdmws
ICpzdGFydCwgZW5kLAo+ICsJCQkgICAgZ2VuOF9wZF9pbmRleCgqc3RhcnQsIDApLCBjb3VudCwK
PiArCQkJICAgIGF0b21pY19yZWFkKCZwdC0+dXNlZCkpOwo+ICAKPiAtdW53aW5kX3BkOgo+IC0J
aWYgKHJlbGVhc2VfcGRfZW50cnkocGRwLCBwZHBlLCAmcGQtPnB0LCAmdm0tPnNjcmF0Y2hbMl0p
KQo+IC0JCWZyZWVfcHgodm0sIHBkKTsKPiAtdW53aW5kOgo+IC0JZ2VuOF9wcGd0dF9jbGVhcl9w
ZHAodm0sIHBkcCwgZnJvbSwgc3RhcnQgLSBmcm9tKTsKPiArCQkJYXRvbWljX2FkZChjb3VudCwg
JnB0LT51c2VkKTsKPiArCQkJR0VNX0JVR19PTihhdG9taWNfcmVhZCgmcHQtPnVzZWQpID4gSTkx
NV9QREVTKTsKPiArCQkJKnN0YXJ0ICs9IGNvdW50Owo+ICsJCX0KPiArCX0gd2hpbGUgKGlkeCsr
LCAtLWxlbik7Cj4gKwlzcGluX3VubG9jaygmcGQtPmxvY2spOwo+ICBvdXQ6Cj4gIAlpZiAoYWxs
b2MpCj4gIAkJZnJlZV9weCh2bSwgYWxsb2MpOwo+ICAJcmV0dXJuIHJldDsKPiAgfQo+ICAKPiAt
c3RhdGljIGludCBnZW44X3BwZ3R0X2FsbG9jXzNsdmwoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZSAqdm0sCj4gLQkJCQkgdTY0IHN0YXJ0LCB1NjQgbGVuZ3RoKQo+IC17Cj4gLQlyZXR1cm4gZ2Vu
OF9wcGd0dF9hbGxvY19wZHAodm0sCj4gLQkJCQkgICAgaTkxNV92bV90b19wcGd0dCh2bSktPnBk
LCBzdGFydCwgbGVuZ3RoKTsKPiAtfQo+IC0KPiAtc3RhdGljIGludCBnZW44X3BwZ3R0X2FsbG9j
XzRsdmwoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCj4gLQkJCQkgdTY0IHN0YXJ0LCB1
NjQgbGVuZ3RoKQo+ICtzdGF0aWMgaW50IGdlbjhfcHBndHRfYWxsb2Moc3RydWN0IGk5MTVfYWRk
cmVzc19zcGFjZSAqdm0sCj4gKwkJCSAgICB1NjQgc3RhcnQsIHU2NCBsZW5ndGgpCj4gIHsKPiAt
CXN0cnVjdCBpOTE1X3BwZ3R0ICpwcGd0dCA9IGk5MTVfdm1fdG9fcHBndHQodm0pOwo+IC0Jc3Ry
dWN0IGk5MTVfcGFnZV9kaXJlY3RvcnkgKiBjb25zdCBwbWw0ID0gcHBndHQtPnBkOwo+IC0Jc3Ry
dWN0IGk5MTVfcGFnZV9kaXJlY3RvcnkgKnBkcCwgKmFsbG9jID0gTlVMTDsKPiAgCXU2NCBmcm9t
ID0gc3RhcnQ7Cj4gLQlpbnQgcmV0ID0gMDsKPiAtCXUzMiBwbWw0ZTsKPiAtCj4gLQlzcGluX2xv
Y2soJnBtbDQtPmxvY2spOwo+IC0JZ2VuOF9mb3JfZWFjaF9wbWw0ZShwZHAsIHBtbDQsIHN0YXJ0
LCBsZW5ndGgsIHBtbDRlKSB7Cj4gLQkJaWYgKCFwZHApIHsKPiAtCQkJc3Bpbl91bmxvY2soJnBt
bDQtPmxvY2spOwo+IC0KPiAtCQkJcGRwID0gZmV0Y2hfYW5kX3plcm8oJmFsbG9jKTsKPiAtCQkJ
aWYgKCFwZHApCj4gLQkJCQlwZHAgPSBhbGxvY19wZCh2bSk7Cj4gLQkJCWlmIChJU19FUlIocGRw
KSkgewo+IC0JCQkJcmV0ID0gUFRSX0VSUihwZHApOwo+IC0JCQkJZ290byB1bndpbmQ7Cj4gLQkJ
CX0KPiAtCj4gLQkJCWZpbGxfcHgocGRwLCB2bS0+c2NyYXRjaFsyXS5lbmNvZGUpOwo+ICsJaW50
IGVycjsKPiAgCj4gLQkJCXNwaW5fbG9jaygmcG1sNC0+bG9jayk7Cj4gLQkJCWlmICghcG1sNC0+
ZW50cnlbcG1sNGVdKSB7Cj4gLQkJCQlzZXRfcGRfZW50cnkocG1sNCwgcG1sNGUsIHBkcCk7Cj4g
LQkJCX0gZWxzZSB7Cj4gLQkJCQlhbGxvYyA9IHBkcDsKPiAtCQkJCXBkcCA9IHBtbDQtPmVudHJ5
W3BtbDRlXTsKPiAtCQkJfQo+IC0JCX0KPiAtCQlhdG9taWNfaW5jKHB4X3VzZWQocGRwKSk7Cj4g
LQkJc3Bpbl91bmxvY2soJnBtbDQtPmxvY2spOwo+ICsJR0VNX0JVR19PTighSVNfQUxJR05FRChz
dGFydCwgQklUX1VMTChHRU44X1BURV9TSElGVCkpKTsKPiArCUdFTV9CVUdfT04oIUlTX0FMSUdO
RUQobGVuZ3RoLCBCSVRfVUxMKEdFTjhfUFRFX1NISUZUKSkpOwo+ICAKPiAtCQlyZXQgPSBnZW44
X3BwZ3R0X2FsbG9jX3BkcCh2bSwgcGRwLCBzdGFydCwgbGVuZ3RoKTsKPiAtCQlpZiAodW5saWtl
bHkocmV0KSkKPiAtCQkJZ290byB1bndpbmRfcGRwOwo+ICsJc3RhcnQgPj49IEdFTjhfUFRFX1NI
SUZUOwo+ICsJbGVuZ3RoID4+PSBHRU44X1BURV9TSElGVDsKPiArCUdFTV9CVUdfT04obGVuZ3Ro
ID09IDApOwo+ICAKPiAtCQlzcGluX2xvY2soJnBtbDQtPmxvY2spOwo+IC0JCWF0b21pY19kZWMo
cHhfdXNlZChwZHApKTsKPiAtCX0KPiAtCXNwaW5fdW5sb2NrKCZwbWw0LT5sb2NrKTsKPiAtCWdv
dG8gb3V0Owo+ICsJZXJyID0gX19nZW44X3BwZ3R0X2FsbG9jKHZtLCBpOTE1X3ZtX3RvX3BwZ3R0
KHZtKS0+cGQsCj4gKwkJCQkgJnN0YXJ0LCBzdGFydCArIGxlbmd0aCwgdm0tPnRvcCk7Cj4gKwlp
ZiAodW5saWtlbHkoZXJyKSkKPiArCQlfX2dlbjhfcHBndHRfY2xlYXIodm0sIGk5MTVfdm1fdG9f
cHBndHQodm0pLT5wZCwKPiArCQkJCSAgIGZyb20sIHN0YXJ0LCB2bS0+dG9wKTsKPiAgCj4gLXVu
d2luZF9wZHA6Cj4gLQlpZiAocmVsZWFzZV9wZF9lbnRyeShwbWw0LCBwbWw0ZSwgJnBkcC0+cHQs
ICZ2bS0+c2NyYXRjaFszXSkpCj4gLQkJZnJlZV9weCh2bSwgcGRwKTsKPiAtdW53aW5kOgo+IC0J
Z2VuOF9wcGd0dF9jbGVhcih2bSwgZnJvbSwgc3RhcnQgLSBmcm9tKTsKPiAtb3V0Ogo+IC0JaWYg
KGFsbG9jKQo+IC0JCWZyZWVfcHgodm0sIGFsbG9jKTsKPiAtCXJldHVybiByZXQ7Cj4gKwlyZXR1
cm4gZXJyOwo+ICB9Cj4gIAo+ICBzdGF0aWMgaW5saW5lIHN0cnVjdCBzZ3RfZG1hIHsKPiBAQCAt
MTQ5NiwxOSArMTQxNiwyMiBAQCBzdGF0aWMgaW50IGdlbjhfaW5pdF9zY3JhdGNoKHN0cnVjdCBp
OTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQo+ICBzdGF0aWMgaW50IGdlbjhfcHJlYWxsb2NhdGVfdG9w
X2xldmVsX3BkcChzdHJ1Y3QgaTkxNV9wcGd0dCAqcHBndHQpCj4gIHsKPiAgCXN0cnVjdCBpOTE1
X2FkZHJlc3Nfc3BhY2UgKnZtID0gJnBwZ3R0LT52bTsKPiAtCXN0cnVjdCBpOTE1X3BhZ2VfZGly
ZWN0b3J5ICpwZHAgPSBwcGd0dC0+cGQ7Cj4gLQlzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVjdG9yeSAq
cGQ7Cj4gLQl1NjQgc3RhcnQgPSAwLCBsZW5ndGggPSBwcGd0dC0+dm0udG90YWw7Cj4gLQl1bnNp
Z25lZCBpbnQgcGRwZTsKPiArCXN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICpwZCA9IHBwZ3R0
LT5wZDsKPiArCXVuc2lnbmVkIGludCBpZHg7Cj4gKwo+ICsJR0VNX0JVR19PTih2bS0+dG9wICE9
IDIpOwo+ICsJR0VNX0JVR19PTigodm0tPnRvdGFsID4+IF9fZ2VuOF9wdGVfc2hpZnQoMikpICE9
IEdFTjhfM0xWTF9QRFBFUyk7Cj4gKwo+ICsJZm9yIChpZHggPSAwOyBpZHggPCBHRU44XzNMVkxf
UERQRVM7IGlkeCsrKSB7Cj4gKwkJc3RydWN0IGk5MTVfcGFnZV9kaXJlY3RvcnkgKnBkZTsKPiAg
Cj4gLQlnZW44X2Zvcl9lYWNoX3BkcGUocGQsIHBkcCwgc3RhcnQsIGxlbmd0aCwgcGRwZSkgewo+
IC0JCXBkID0gYWxsb2NfcGQodm0pOwo+IC0JCWlmIChJU19FUlIocGQpKQo+IC0JCQlyZXR1cm4g
UFRSX0VSUihwZCk7Cj4gKwkJcGRlID0gYWxsb2NfcGQodm0pOwo+ICsJCWlmIChJU19FUlIocGRl
KSkKPiArCQkJcmV0dXJuIFBUUl9FUlIocGRlKTsKPiAgCj4gLQkJZmlsbF9weChwZCwgdm0tPnNj
cmF0Y2hbMV0uZW5jb2RlKTsKPiAtCQlzZXRfcGRfZW50cnkocGRwLCBwZHBlLCBwZCk7Cj4gLQkJ
YXRvbWljX2luYyhweF91c2VkKHBkKSk7IC8qIGtlZXAgcGlubmVkICovCj4gKwkJZmlsbF9weChw
ZGUsIHZtLT5zY3JhdGNoWzFdLmVuY29kZSk7Cj4gKwkJc2V0X3BkX2VudHJ5KHBkLCBpZHgsIHBk
ZSk7Cj4gKwkJYXRvbWljX2luYyhweF91c2VkKHBkZSkpOyAvKiBrZWVwIHBpbm5lZCAqLwo+ICAJ
fQo+ICAKPiAgCXJldHVybiAwOwo+IEBAIC0xNTk3LDcgKzE1MjAsNiBAQCBzdGF0aWMgc3RydWN0
IGk5MTVfcHBndHQgKmdlbjhfcHBndHRfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQo+ICAJfQo+ICAKPiAgCWlmIChpOTE1X3ZtX2lzXzRsdmwoJnBwZ3R0LT52bSkpIHsKPiAt
CQlwcGd0dC0+dm0uYWxsb2NhdGVfdmFfcmFuZ2UgPSBnZW44X3BwZ3R0X2FsbG9jXzRsdmw7Cj4g
IAkJcHBndHQtPnZtLmluc2VydF9lbnRyaWVzID0gZ2VuOF9wcGd0dF9pbnNlcnRfNGx2bDsKPiAg
CX0gZWxzZSB7Cj4gIAkJaWYgKGludGVsX3ZncHVfYWN0aXZlKGk5MTUpKSB7Cj4gQEAgLTE2MDYs
MTAgKzE1MjgsMTAgQEAgc3RhdGljIHN0cnVjdCBpOTE1X3BwZ3R0ICpnZW44X3BwZ3R0X2NyZWF0
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKPiAgCQkJCWdvdG8gZXJyX2ZyZWVfcGQ7
Cj4gIAkJfQo+ICAKPiAtCQlwcGd0dC0+dm0uYWxsb2NhdGVfdmFfcmFuZ2UgPSBnZW44X3BwZ3R0
X2FsbG9jXzNsdmw7Cj4gIAkJcHBndHQtPnZtLmluc2VydF9lbnRyaWVzID0gZ2VuOF9wcGd0dF9p
bnNlcnRfM2x2bDsKPiAgCX0KPiAgCj4gKwlwcGd0dC0+dm0uYWxsb2NhdGVfdmFfcmFuZ2UgPSBn
ZW44X3BwZ3R0X2FsbG9jOwo+ICAJcHBndHQtPnZtLmNsZWFyX3JhbmdlID0gZ2VuOF9wcGd0dF9j
bGVhcjsKPiAgCj4gIAlpZiAoaW50ZWxfdmdwdV9hY3RpdmUoaTkxNSkpCj4gCl9fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxp
c3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNr
dG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

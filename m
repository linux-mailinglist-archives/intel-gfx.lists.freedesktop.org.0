Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 2A86ECB946
	for <lists+intel-gfx@lfdr.de>; Fri,  4 Oct 2019 13:35:47 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2B8B46EB54;
	Fri,  4 Oct 2019 11:35:39 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl
 [IPv6:2a02:2308::216:3eff:fe92:dfa3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6A0336EB38
 for <intel-gfx@lists.freedesktop.org>; Fri,  4 Oct 2019 11:35:24 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  4 Oct 2019 13:35:12 +0200
Message-Id: <20191004113514.17064-23-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191004113514.17064-1-maarten.lankhorst@linux.intel.com>
References: <20191004113514.17064-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 22/24] drm/i915: Add intel_update_bigjoiner
 handling.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RW5hYmxpbmcgaXMgZG9uZSBpbiBhIHNwZWNpYWwgc2VxdWVuY2UgYW5kIHRvIGJlIGZhaXIsIHNv
IHNob3VsZApwbGFuZSB1cGRhdGVzIGJlLiBJZGVhbGx5IHRoZSBlbmQgdXNlciBuZXZlciBub3Rp
Y2VzIHRoZSBzZWNvbmQKcGlwZSBpcyB1c2VkLCBzbyB1c2UgdGhlIHZibGFuayBldmFzaW9uIHRv
IGNvdmVyIGJvdGggcGlwZXMuCgpUaGlzIHdheSBpZGVhbGx5IGV2ZXJ5dGhpbmcgd2lsbCBiZSB0
ZWFyIGZyZWUsIGFuZCB1cGRhdGVzIGFyZQpyZWFsbHkgYXRvbWljIGFzIHVzZXJzcGFjZSBleHBl
Y3RzIGl0LgoKVGhlIGRpc2FibGUgc2VxdWVuY2Ugc3RpbGwgbmVlZHMgc29tZSBsb3ZlLCBidXQg
b3RoZXJ3aXNlIGJpZ2pvaW5lcgppcyBjbG9zZSB0byByZWFkeSBub3cuCgpTaWduZWQtb2ZmLWJ5
OiBNYWFydGVuIExhbmtob3JzdCA8bWFhcnRlbi5sYW5raG9yc3RAbGludXguaW50ZWwuY29tPgot
LS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIHwgMTE4ICsr
KysrKysrKysrKysrKystLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3By
aXRlLmMgIHwgIDIyICsrKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3By
aXRlLmggIHwgICAzICstCiAzIGZpbGVzIGNoYW5nZWQsIDEyMyBpbnNlcnRpb25zKCspLCAyMCBk
ZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxh
eS5jCmluZGV4IDBkOWQ0ZTJkNjFjNi4uNDZlM2U4Mjk2MjUxIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAtMTQzNDksNyArMTQzNDksNyBAQCBz
dGF0aWMgdm9pZCBpbnRlbF91cGRhdGVfY3J0YyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAll
bHNlCiAJCWk5eHhfdXBkYXRlX3BsYW5lc19vbl9jcnRjKHN0YXRlLCBjcnRjKTsKIAotCWludGVs
X3BpcGVfdXBkYXRlX2VuZChuZXdfY3J0Y19zdGF0ZSk7CisJaW50ZWxfcGlwZV91cGRhdGVfZW5k
KG5ld19jcnRjX3N0YXRlLCBOVUxMKTsKIAogICAgICAgICAvKgogICAgICAgICAgKiBXZSB1c3Vh
bGx5IGVuYWJsZSBGSUZPIHVuZGVycnVuIGludGVycnVwdHMgYXMgcGFydCBvZiB0aGUKQEAgLTE0
NDM3LDYgKzE0NDM3LDU2IEBAIHN0YXRpYyB2b2lkIGludGVsX2NvbW1pdF9tb2Rlc2V0X2Rpc2Fi
bGVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCX0KIH0KIAorc3RhdGljIHZv
aWQgaW50ZWxfdXBkYXRlX2JpZ2pvaW5lcihzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKKwkJCQkg
ICBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKKwkJCQkgICBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUsCisJCQkJICAgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKm5ld19jcnRjX3N0YXRlKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoc3RhdGUtPmJhc2UuZGV2KTsKKwlib29sIG1vZGVzZXQgPSBuZWVkc19tb2Rl
c2V0KG5ld19jcnRjX3N0YXRlKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqc2xhdmUgPSBuZXdfY3J0
Y19zdGF0ZS0+Ymlnam9pbmVyX2xpbmtlZF9jcnRjOworCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpuZXdfc2xhdmVfY3J0Y19zdGF0ZSA9CisJCWludGVsX2F0b21pY19nZXRfbmV3X2NydGNfc3Rh
dGUoc3RhdGUsIHNsYXZlKTsKKwlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX3NsYXZlX2Ny
dGNfc3RhdGUgPQorCQlpbnRlbF9hdG9taWNfZ2V0X29sZF9jcnRjX3N0YXRlKHN0YXRlLCBzbGF2
ZSk7CisKKwlpZiAobW9kZXNldCkgeworCQkvKiBFbmFibGUgc2xhdmUgZmlyc3QgKi8KKwkJdXBk
YXRlX3NjYW5saW5lX29mZnNldChuZXdfc2xhdmVfY3J0Y19zdGF0ZSk7CisJCWRybV9jYWxjX3Rp
bWVzdGFtcGluZ19jb25zdGFudHMoJnNsYXZlLT5iYXNlLCAmbmV3X3NsYXZlX2NydGNfc3RhdGUt
Pmh3LnRyYW5zY29kZXJfbW9kZSk7CisJCWRldl9wcml2LT5kaXNwbGF5LmNydGNfZW5hYmxlKG5l
d19zbGF2ZV9jcnRjX3N0YXRlLCBzdGF0ZSk7CisKKwkJLyogVGhlbiBtYXN0ZXIgKi8KKwkJdXBk
YXRlX3NjYW5saW5lX29mZnNldChuZXdfY3J0Y19zdGF0ZSk7CisJCWRybV9jYWxjX3RpbWVzdGFt
cGluZ19jb25zdGFudHMoJmNydGMtPmJhc2UsICZuZXdfY3J0Y19zdGF0ZS0+aHcudHJhbnNjb2Rl
cl9tb2RlKTsKKwkJZGV2X3ByaXYtPmRpc3BsYXkuY3J0Y19lbmFibGUobmV3X2NydGNfc3RhdGUs
IHN0YXRlKTsKKworCQkvKiB2YmxhbmtzIHdvcmsgYWdhaW4sIHJlLWVuYWJsZSBwaXBlIENSQy4g
Ki8KKwkJaW50ZWxfY3J0Y19lbmFibGVfcGlwZV9jcmMoY3J0Yyk7CisKKwl9IGVsc2UgeworCQlp
bnRlbF9wcmVfcGxhbmVfdXBkYXRlKG9sZF9jcnRjX3N0YXRlLCBuZXdfY3J0Y19zdGF0ZSk7CisJ
CWludGVsX3ByZV9wbGFuZV91cGRhdGUob2xkX3NsYXZlX2NydGNfc3RhdGUsIG5ld19zbGF2ZV9j
cnRjX3N0YXRlKTsKKworCQlpZiAobmV3X2NydGNfc3RhdGUtPnVwZGF0ZV9waXBlKQorCQkJaW50
ZWxfZW5jb2RlcnNfdXBkYXRlX3BpcGUoY3J0YywgbmV3X2NydGNfc3RhdGUsIHN0YXRlKTsKKwl9
CisKKwkvKgorCSAqIFBlcmZvcm0gdmJsYW5rIGV2YXNpb24gYXJvdW5kIGNvbW1pdCBvcGVyYXRp
b24sIGFuZCBtYWtlIHN1cmUgdG8KKwkgKiBjb21taXQgYm90aCBwbGFuZXMgc2ltdWx0YW5lb3Vz
bHkgZm9yIGJlc3QgcmVzdWx0cy4KKwkgKi8KKwlpbnRlbF9waXBlX3VwZGF0ZV9zdGFydChuZXdf
Y3J0Y19zdGF0ZSk7CisKKwljb21taXRfcGlwZV9jb25maWcoc3RhdGUsIG9sZF9jcnRjX3N0YXRl
LCBuZXdfY3J0Y19zdGF0ZSk7CisJY29tbWl0X3BpcGVfY29uZmlnKHN0YXRlLCBvbGRfc2xhdmVf
Y3J0Y19zdGF0ZSwgbmV3X3NsYXZlX2NydGNfc3RhdGUpOworCisJc2tsX3VwZGF0ZV9wbGFuZXNf
b25fY3J0YyhzdGF0ZSwgY3J0Yyk7CisJc2tsX3VwZGF0ZV9wbGFuZXNfb25fY3J0YyhzdGF0ZSwg
c2xhdmUpOworCisJaW50ZWxfcGlwZV91cGRhdGVfZW5kKG5ld19jcnRjX3N0YXRlLCBuZXdfc2xh
dmVfY3J0Y19zdGF0ZSk7Cit9CisKIHN0YXRpYyB2b2lkIGludGVsX2NvbW1pdF9tb2Rlc2V0X2Vu
YWJsZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7CiAJc3RydWN0IGludGVs
X2NydGMgKmNydGM7CkBAIC0xNDQ1NSw3ICsxNDUwNSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2Nv
bW1pdF9tb2Rlc2V0X2VuYWJsZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiBz
dGF0aWMgdm9pZCBza2xfY29tbWl0X21vZGVzZXRfZW5hYmxlcyhzdHJ1Y3QgaW50ZWxfYXRvbWlj
X3N0YXRlICpzdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KHN0YXRlLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGM7CisJc3Ry
dWN0IGludGVsX2NydGMgKmNydGMsICpzbGF2ZTsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
b2xkX2NydGNfc3RhdGUsICpuZXdfY3J0Y19zdGF0ZTsKIAl1bnNpZ25lZCBpbnQgdXBkYXRlZCA9
IDA7CiAJYm9vbCBwcm9ncmVzczsKQEAgLTE0NDY0LDExICsxNDUxNCw0NyBAQCBzdGF0aWMgdm9p
ZCBza2xfY29tbWl0X21vZGVzZXRfZW5hYmxlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpz
dGF0ZSkKIAl1OCBod19lbmFibGVkX3NsaWNlcyA9IGRldl9wcml2LT53bS5za2xfaHcuZGRiLmVu
YWJsZWRfc2xpY2VzOwogCXU4IHJlcXVpcmVkX3NsaWNlcyA9IHN0YXRlLT53bV9yZXN1bHRzLmRk
Yi5lbmFibGVkX3NsaWNlczsKIAlzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSBlbnRyaWVzW0k5MTVfTUFY
X1BJUEVTXSA9IHt9OworCXN0cnVjdCBza2xfZGRiX2VudHJ5IG5ld19lbnRyaWVzW0k5MTVfTUFY
X1BJUEVTXSA9IHt9OworCWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpzbGF2ZV9jcnRj
X3N0YXRlOworCXUzMiBkaXJ0eV9waXBlcyA9IHN0YXRlLT53bV9yZXN1bHRzLmRpcnR5X3BpcGVz
OworCisJZm9yX2VhY2hfb2xkbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsIG9s
ZF9jcnRjX3N0YXRlLCBuZXdfY3J0Y19zdGF0ZSwgaSkgeworCQlpZiAobmV3X2NydGNfc3RhdGUt
PmJpZ2pvaW5lcl9zbGF2ZSkgeworCQkJLyogY2xlYXIgZGlydHkgYml0LCB3ZSdyZSB1cGRhdGVk
IGluIG1hc3RlciAqLworCQkJZGlydHlfcGlwZXMgJj0gfmRybV9jcnRjX21hc2soJmNydGMtPmJh
c2UpOworCQkJY29udGludWU7CisJCX0KKworCQlpZiAobmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2
ZSkgeworCQkJaWYgKG5ld19jcnRjX3N0YXRlLT5iaWdqb2luZXIpIHsKKwkJCQlzbGF2ZSA9IG5l
d19jcnRjX3N0YXRlLT5iaWdqb2luZXJfbGlua2VkX2NydGM7CisJCQkJc2xhdmVfY3J0Y19zdGF0
ZSA9CisJCQkJCWludGVsX2F0b21pY19nZXRfbmV3X2NydGNfc3RhdGUoc3RhdGUsCisJCQkJCQkJ
CQlzbGF2ZSk7CisKKwkJCQkvKiBwdXQgYm90aCBlbnRyaWVzIGluICovCisJCQkJbmV3X2VudHJp
ZXNbaV0uc3RhcnQgPSBuZXdfY3J0Y19zdGF0ZS0+d20uc2tsLmRkYi5zdGFydDsKKwkJCQluZXdf
ZW50cmllc1tpXS5lbmQgPSBzbGF2ZV9jcnRjX3N0YXRlLT53bS5za2wuZGRiLmVuZDsKKwkJCX0g
ZWxzZSB7CisJCQkJbmV3X2VudHJpZXNbaV0gPSBuZXdfY3J0Y19zdGF0ZS0+d20uc2tsLmRkYjsK
KwkJCX0KKwkJfQogCi0JZm9yX2VhY2hfb2xkbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3RhdGUs
IGNydGMsIG9sZF9jcnRjX3N0YXRlLCBuZXdfY3J0Y19zdGF0ZSwgaSkKIAkJLyogaWdub3JlIGFs
bG9jYXRpb25zIGZvciBjcnRjJ3MgdGhhdCBoYXZlIGJlZW4gdHVybmVkIG9mZi4gKi8KLQkJaWYg
KG5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUpCisJCWlmICghbmV3X2NydGNfc3RhdGUtPmh3LmFj
dGl2ZSB8fCBuZWVkc19tb2Rlc2V0KG5ld19jcnRjX3N0YXRlKSkKKwkJCWNvbnRpbnVlOworCisJ
CWlmIChvbGRfY3J0Y19zdGF0ZS0+Ymlnam9pbmVyKSB7CisJCQlzbGF2ZSA9IG9sZF9jcnRjX3N0
YXRlLT5iaWdqb2luZXJfbGlua2VkX2NydGM7CisJCQlzbGF2ZV9jcnRjX3N0YXRlID0KKwkJCQlp
bnRlbF9hdG9taWNfZ2V0X29sZF9jcnRjX3N0YXRlKHN0YXRlLCBzbGF2ZSk7CisKKwkJCWVudHJp
ZXNbaV0uc3RhcnQgPSBvbGRfY3J0Y19zdGF0ZS0+d20uc2tsLmRkYi5zdGFydDsKKwkJCWVudHJp
ZXNbaV0uZW5kID0gc2xhdmVfY3J0Y19zdGF0ZS0+d20uc2tsLmRkYi5lbmQ7CisJCX0gZWxzZSB7
CiAJCQllbnRyaWVzW2ldID0gb2xkX2NydGNfc3RhdGUtPndtLnNrbC5kZGI7CisJCX0KKwl9CiAK
IAkvKiBJZiAybmQgREJ1ZiBzbGljZSByZXF1aXJlZCwgZW5hYmxlIGl0IGhlcmUgKi8KIAlpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSAmJiByZXF1aXJlZF9zbGljZXMgPiBod19lbmFibGVk
X3NsaWNlcykKQEAgLTE0NDg5LDE2ICsxNDU3NSwxNSBAQCBzdGF0aWMgdm9pZCBza2xfY29tbWl0
X21vZGVzZXRfZW5hYmxlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAogCQkJ
cGlwZSA9IGNydGMtPnBpcGU7CiAKLQkJCWlmICh1cGRhdGVkICYgY21hc2sgfHwgIW5ld19jcnRj
X3N0YXRlLT5ody5hY3RpdmUpCisJCQlpZiAodXBkYXRlZCAmIGNtYXNrIHx8ICFuZXdfY3J0Y19z
dGF0ZS0+aHcuYWN0aXZlIHx8CisJCQkgICAgbmV3X2NydGNfc3RhdGUtPmJpZ2pvaW5lcl9zbGF2
ZSkKIAkJCQljb250aW51ZTsKIAotCQkJaWYgKHNrbF9kZGJfYWxsb2NhdGlvbl9vdmVybGFwcygm
bmV3X2NydGNfc3RhdGUtPndtLnNrbC5kZGIsCi0JCQkJCQkJZW50cmllcywKKwkJCWlmIChza2xf
ZGRiX2FsbG9jYXRpb25fb3ZlcmxhcHMoJm5ld19lbnRyaWVzW2ldLCBlbnRyaWVzLAogCQkJCQkJ
CUlOVEVMX05VTV9QSVBFUyhkZXZfcHJpdiksIGkpKQogCQkJCWNvbnRpbnVlOwogCiAJCQl1cGRh
dGVkIHw9IGNtYXNrOwotCQkJZW50cmllc1tpXSA9IG5ld19jcnRjX3N0YXRlLT53bS5za2wuZGRi
OwogCiAJCQkvKgogCQkJICogSWYgdGhpcyBpcyBhbiBhbHJlYWR5IGFjdGl2ZSBwaXBlLCBpdCdz
IEREQiBjaGFuZ2VkLApAQCAtMTQ1MDYsMTggKzE0NTkxLDIzIEBAIHN0YXRpYyB2b2lkIHNrbF9j
b21taXRfbW9kZXNldF9lbmFibGVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQog
CQkJICogdGhlbiB3ZSBuZWVkIHRvIHdhaXQgZm9yIGEgdmJsYW5rIHRvIHBhc3MgZm9yIHRoZQog
CQkJICogbmV3IGRkYiBhbGxvY2F0aW9uIHRvIHRha2UgZWZmZWN0LgogCQkJICovCi0JCQlpZiAo
IXNrbF9kZGJfZW50cnlfZXF1YWwoJm5ld19jcnRjX3N0YXRlLT53bS5za2wuZGRiLAotCQkJCQkJ
ICZvbGRfY3J0Y19zdGF0ZS0+d20uc2tsLmRkYikgJiYKLQkJCSAgICAhbmV3X2NydGNfc3RhdGUt
PnVhcGkuYWN0aXZlX2NoYW5nZWQgJiYKLQkJCSAgICBzdGF0ZS0+d21fcmVzdWx0cy5kaXJ0eV9w
aXBlcyAhPSB1cGRhdGVkKQorCQkJaWYgKCFza2xfZGRiX2VudHJ5X2VxdWFsKCZlbnRyaWVzW2ld
LCAmbmV3X2VudHJpZXNbaV0pICYmCisJCQkgICAgIW5lZWRzX21vZGVzZXQobmV3X2NydGNfc3Rh
dGUpICYmCisJCQkgICAgZGlydHlfcGlwZXMgIT0gdXBkYXRlZCkKIAkJCQl2Ymxfd2FpdCA9IHRy
dWU7CiAKLQkJCWludGVsX3VwZGF0ZV9jcnRjKGNydGMsIHN0YXRlLCBvbGRfY3J0Y19zdGF0ZSwK
LQkJCQkJICBuZXdfY3J0Y19zdGF0ZSk7CisJCQlpZiAobmV3X2NydGNfc3RhdGUtPmJpZ2pvaW5l
cikKKwkJCQlpbnRlbF91cGRhdGVfYmlnam9pbmVyKGNydGMsIHN0YXRlLAorCQkJCQkJICAgICAg
IG9sZF9jcnRjX3N0YXRlLAorCQkJCQkJICAgICAgIG5ld19jcnRjX3N0YXRlKTsKKwkJCWVsc2UK
KwkJCQlpbnRlbF91cGRhdGVfY3J0YyhjcnRjLCBzdGF0ZSwgb2xkX2NydGNfc3RhdGUsCisJCQkJ
CQkgIG5ld19jcnRjX3N0YXRlKTsKIAogCQkJaWYgKHZibF93YWl0KQogCQkJCWludGVsX3dhaXRf
Zm9yX3ZibGFuayhkZXZfcHJpdiwgcGlwZSk7CiAKKwkJCWVudHJpZXNbaV0gPSBuZXdfZW50cmll
c1tpXTsKIAkJCXByb2dyZXNzID0gdHJ1ZTsKIAkJfQogCX0gd2hpbGUgKHByb2dyZXNzKTsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCmluZGV4IDMyMTNlYTBi
ZDgzOC4uMjcyYzA4ZmE1ZDFiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX3Nwcml0ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfc3ByaXRlLmMKQEAgLTk4LDYgKzk4LDggQEAgdm9pZCBpbnRlbF9waXBlX3VwZGF0ZV9zdGFy
dChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpCiAKIAkvKiBG
SVhNRSBuZWVkcyB0byBiZSBjYWxpYnJhdGVkIHNlbnNpYmx5ICovCiAJbWluID0gdmJsYW5rX3N0
YXJ0IC0gaW50ZWxfdXNlY3NfdG9fc2NhbmxpbmVzKGFkanVzdGVkX21vZGUsCisJCQkJCQkgICAg
ICBuZXdfY3J0Y19zdGF0ZS0+Ymlnam9pbmVyID8KKwkJCQkJCSAgICAgIDIgKiBWQkxBTktfRVZB
U0lPTl9USU1FX1VTIDoKIAkJCQkJCSAgICAgIFZCTEFOS19FVkFTSU9OX1RJTUVfVVMpOwogCW1h
eCA9IHZibGFua19zdGFydCAtIDE7CiAKQEAgLTE4OCw3ICsxOTAsOCBAQCB2b2lkIGludGVsX3Bp
cGVfdXBkYXRlX3N0YXJ0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19z
dGF0ZSkKICAqIHJlLWVuYWJsZXMgaW50ZXJydXB0cyBhbmQgdmVyaWZpZXMgdGhlIHVwZGF0ZSB3
YXMgYWN0dWFsbHkgY29tcGxldGVkCiAgKiBiZWZvcmUgYSB2YmxhbmsuCiAgKi8KLXZvaWQgaW50
ZWxfcGlwZV91cGRhdGVfZW5kKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0
ZSkKK3ZvaWQgaW50ZWxfcGlwZV91cGRhdGVfZW5kKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpu
ZXdfY3J0Y19zdGF0ZSwKKwkJCSAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpzbGF2ZV9jcnRj
X3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhuZXdf
Y3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CkBA
IC0yMDMsMTUgKzIwNiwyNCBAQCB2b2lkIGludGVsX3BpcGVfdXBkYXRlX2VuZChzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpCiAJICogV291bGQgYmUgc2xpZ2h0bHkgbmlj
ZSB0byBqdXN0IGdyYWIgdGhlIHZibGFuayBjb3VudCBhbmQgYXJtIHRoZQogCSAqIGV2ZW50IG91
dHNpZGUgb2YgdGhlIGNyaXRpY2FsIHNlY3Rpb24gLSB0aGUgc3BpbmxvY2sgbWlnaHQgc3BpbiBm
b3IgYQogCSAqIHdoaWxlIC4uLiAqLwotCWlmIChuZXdfY3J0Y19zdGF0ZS0+dWFwaS5ldmVudCkg
ewotCQlXQVJOX09OKGRybV9jcnRjX3ZibGFua19nZXQoJmNydGMtPmJhc2UpICE9IDApOworCWlm
IChuZXdfY3J0Y19zdGF0ZS0+dWFwaS5ldmVudCB8fCAoc2xhdmVfY3J0Y19zdGF0ZSAmJiBzbGF2
ZV9jcnRjX3N0YXRlLT51YXBpLmV2ZW50KSkgeworCQlpZiAobmV3X2NydGNfc3RhdGUtPnVhcGku
ZXZlbnQpCisJCQlXQVJOX09OKGRybV9jcnRjX3ZibGFua19nZXQoJmNydGMtPmJhc2UpICE9IDAp
OworCQlpZiAoc2xhdmVfY3J0Y19zdGF0ZSAmJiBzbGF2ZV9jcnRjX3N0YXRlLT51YXBpLmV2ZW50
KQorCQkJV0FSTl9PTihkcm1fY3J0Y192YmxhbmtfZ2V0KCZjcnRjLT5iYXNlKSAhPSAwKTsKIAog
CQlzcGluX2xvY2soJmNydGMtPmJhc2UuZGV2LT5ldmVudF9sb2NrKTsKLQkJZHJtX2NydGNfYXJt
X3ZibGFua19ldmVudCgmY3J0Yy0+YmFzZSwKLQkJCQkgICAgICAgICAgbmV3X2NydGNfc3RhdGUt
PnVhcGkuZXZlbnQpOworCQlpZiAobmV3X2NydGNfc3RhdGUtPnVhcGkuZXZlbnQpCisJCQlkcm1f
Y3J0Y19hcm1fdmJsYW5rX2V2ZW50KCZjcnRjLT5iYXNlLAorCQkJCQkJICBuZXdfY3J0Y19zdGF0
ZS0+dWFwaS5ldmVudCk7CisJCWlmIChzbGF2ZV9jcnRjX3N0YXRlICYmIHNsYXZlX2NydGNfc3Rh
dGUtPnVhcGkuZXZlbnQpCisJCQlkcm1fY3J0Y19hcm1fdmJsYW5rX2V2ZW50KCZjcnRjLT5iYXNl
LAorCQkJCQkJICBzbGF2ZV9jcnRjX3N0YXRlLT51YXBpLmV2ZW50KTsKIAkJc3Bpbl91bmxvY2so
JmNydGMtPmJhc2UuZGV2LT5ldmVudF9sb2NrKTsKIAogCQluZXdfY3J0Y19zdGF0ZS0+dWFwaS5l
dmVudCA9IE5VTEw7CisJCWlmIChzbGF2ZV9jcnRjX3N0YXRlKQorCQkJc2xhdmVfY3J0Y19zdGF0
ZS0+dWFwaS5ldmVudCA9IE5VTEw7CiAJfQogCiAJbG9jYWxfaXJxX2VuYWJsZSgpOwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuaCBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmgKaW5kZXggMjI5MzM2MjE0ZjY4
Li42ZGY2MmZhZTkzNjggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfc3ByaXRlLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9z
cHJpdGUuaApAQCAtMjQsNyArMjQsOCBAQCBzdHJ1Y3QgaW50ZWxfcGxhbmUgKmludGVsX3Nwcml0
ZV9wbGFuZV9jcmVhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogaW50IGlu
dGVsX3Nwcml0ZV9zZXRfY29sb3JrZXlfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9p
ZCAqZGF0YSwKIAkJCQkgICAgc3RydWN0IGRybV9maWxlICpmaWxlX3ByaXYpOwogdm9pZCBpbnRl
bF9waXBlX3VwZGF0ZV9zdGFydChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2Ny
dGNfc3RhdGUpOwotdm9pZCBpbnRlbF9waXBlX3VwZGF0ZV9lbmQoc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKm5ld19jcnRjX3N0YXRlKTsKK3ZvaWQgaW50ZWxfcGlwZV91cGRhdGVfZW5kKHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSwKKwkJCSAgIHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpzbGF2ZV9jcnRjX3N0YXRlKTsKIGludCBpbnRlbF9wbGFuZV9jaGVja19zdHJp
ZGUoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSk7CiBpbnQgaW50
ZWxfcGxhbmVfY2hlY2tfc3JjX2Nvb3JkaW5hdGVzKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUpOwogaW50IGNodl9wbGFuZV9jaGVja19yb3RhdGlvbihjb25zdCBzdHJ1Y3Qg
aW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKTsKLS0gCjIuMjMuMAoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlz
dApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

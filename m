Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C3CDF1C3C5C
	for <lists+intel-gfx@lfdr.de>; Mon,  4 May 2020 16:06:36 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3550589C2A;
	Mon,  4 May 2020 14:06:34 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6099689C3B
 for <intel-gfx@lists.freedesktop.org>; Mon,  4 May 2020 14:06:32 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from build.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 21107090-1500050 
 for <intel-gfx@lists.freedesktop.org>; Mon, 04 May 2020 15:06:31 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  4 May 2020 15:06:29 +0100
Message-Id: <20200504140629.28240-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [CI] drm/i915/gem: Implement legacy MI_STORE_DATA_IMM
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIG9sZGVyIGFyY2hlcyBkaWQgbm90IGNvbnZlcnQgTUlfU1RPUkVfREFUQV9JTU0gdG8gdXNp
bmcgdGhlIEdUVCwgYnV0CmxlZnQgdGhlbSB3cml0aW5nIHRvIGEgcGh5c2ljYWwgYWRkcmVzcy4g
VGhlIG5vdGVzIHN1Z2dlc3QgdGhhdCB0aGUKcHJpbWFyeSByZWFzb24gd291bGQgYmUgc28gdGhh
dCB0aGUgd3JpdGVzIHdlcmUgY2FjaGUgY29oZXJlbnQsIGFzIHRoZQpDUFUgY2FjaGUgdXNlcyBw
aHlzaWNhbCB0YWdnaW5nLiBBcyBzdWNoIHdlIGRpZCBub3QgaW1wbGVtZW50IHRoZQpsZWdhY3kg
dmFyaWFudCBvZiBNSV9TVE9SRV9EQVRBX0lNTSBhbmQgc28gbGVmdCBhbGwgdGhlIHJlbG9jYXRp
b25zCnN5bmNocm9ub3VzIC0tIGJ1dCB3aXRoIGEgc21hbGwgZnVuY3Rpb24gdG8gY29udmVydCBm
cm9tIHRoZSB2bWEgYWRkcmVzcwppbnRvIHRoZSBwaHlzaWNhbCBhZGRyZXNzLCB3ZSBjYW4gaW1w
bGVtZW50IGFzeW5jaHJvbm91cyByZWxvY3Mgb24gdGhlc2UKb2xkZXIgYXJjaGVzLCBmaXhpbmcg
dXAgYSBmZXcgdGVzdHMgdGhhdCByZXF1aXJlIHRoZW0uCgpJbiBvcmRlciB0byBiZSBhYmxlIHRv
IHRlc3QgdGhlIGxlZ2FjeSBwYXRocywgcmVmYWN0b3IgdGhlIGdwdQpyZWxvY2F0aW9ucyBzbyB0
aGF0IHdlIGNhbiBob29rIHRoZW0gdXAgdG8gYSBzZWxmdGVzdC4KCnYyOiBVc2UgYW4gYXJyYXkg
b2Ygb2Zmc2V0cyBub3QgZW51bSBsYWJlbHMgZm9yIHRoZSBzZWxmdGVzdAp2MzogUmVmYWN0b3Ig
dGhlIGNvbW1vbiBpZ3RfaGV4ZHVtcCgpCgpDbG9zZXM6IGh0dHBzOi8vZ2l0bGFiLmZyZWVkZXNr
dG9wLm9yZy9kcm0vaW50ZWwvLS9pc3N1ZXMvNzU3ClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNv
biA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51
cnN1bGluQGludGVsLmNvbT4KUmV2aWV3ZWQtYnk6IFR2cnRrbyBVcnN1bGluIDx0dnJ0a28udXJz
dWxpbkBpbnRlbC5jb20+Ci0tLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1
ZmZlci5jICAgIHwgMjA0ICsrKysrKysrKysrLS0tLS0tLQogLi4uL2k5MTUvZ2VtL3NlbGZ0ZXN0
cy9pOTE1X2dlbV9jbGllbnRfYmx0LmMgIHwgIDMxICstLQogLi4uL2k5MTUvZ2VtL3NlbGZ0ZXN0
cy9pOTE1X2dlbV9leGVjYnVmZmVyLmMgIHwgMTcxICsrKysrKysrKysrKysrKwogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgICAgICAgIHwgIDMzICstLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9zZWxmdGVzdC5oICAgICAgICAgIHwgICAyICsKIC4uLi9kcm0vaTkx
NS9zZWxmdGVzdHMvaTkxNV9saXZlX3NlbGZ0ZXN0cy5oICB8ICAgMSArCiAuLi4vZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X3NlbGZ0ZXN0LmMgICAgfCAgMjkgKysrCiA3IGZpbGVzIGNoYW5n
ZWQsIDMzNiBpbnNlcnRpb25zKCspLCAxMzUgZGVsZXRpb25zKC0pCiBjcmVhdGUgbW9kZSAxMDA2
NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9leGVjYnVmZmVy
LmMKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1
ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYwpp
bmRleCAxYzI0N2FkMDk3MWEuLjk2NjUyM2E4NTAzZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCkBAIC05NTUsNyArOTU1LDcgQEAgc3RhdGlj
IHZvaWQgcmVsb2NfY2FjaGVfaW5pdChzdHJ1Y3QgcmVsb2NfY2FjaGUgKmNhY2hlLAogCWNhY2hl
LT5uZWVkc191bmZlbmNlZCA9IElOVEVMX0lORk8oaTkxNSktPnVuZmVuY2VkX25lZWRzX2FsaWdu
bWVudDsKIAljYWNoZS0+bm9kZS5mbGFncyA9IDA7CiAJY2FjaGUtPnJxID0gTlVMTDsKLQljYWNo
ZS0+cnFfc2l6ZSA9IDA7CisJY2FjaGUtPnRhcmdldCA9IE5VTEw7CiB9CiAKIHN0YXRpYyBpbmxp
bmUgdm9pZCAqdW5tYXNrX3BhZ2UodW5zaWduZWQgbG9uZyBwKQpAQCAtMTMyNSw3ICsxMzI1LDcg
QEAgc3RhdGljIGludCBfX3JlbG9jX2dwdV9hbGxvYyhzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICpl
YiwKIAogCQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CiAJCWlmIChJU19FUlIo
Y2UpKSB7Ci0JCQllcnIgPSBQVFJfRVJSKHJxKTsKKwkJCWVyciA9IFBUUl9FUlIoY2UpOwogCQkJ
Z290byBlcnJfdW5waW47CiAJCX0KIApAQCAtMTM3Niw2ICsxMzc2LDExIEBAIHN0YXRpYyBpbnQg
X19yZWxvY19ncHVfYWxsb2Moc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsCiAJcmV0dXJuIGVy
cjsKIH0KIAorc3RhdGljIGJvb2wgcmVsb2NfY2FuX3VzZV9lbmdpbmUoY29uc3Qgc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqZW5naW5lKQoreworCXJldHVybiBlbmdpbmUtPmNsYXNzICE9IFZJREVP
X0RFQ09ERV9DTEFTUyB8fCAhSVNfR0VOKGVuZ2luZS0+aTkxNSwgNik7Cit9CisKIHN0YXRpYyB1
MzIgKnJlbG9jX2dwdShzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYiwKIAkJICAgICAgc3RydWN0
IGk5MTVfdm1hICp2bWEsCiAJCSAgICAgIHVuc2lnbmVkIGludCBsZW4pCkBAIC0xMzg3LDkgKzEz
OTIsOSBAQCBzdGF0aWMgdTMyICpyZWxvY19ncHUoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIs
CiAJaWYgKHVubGlrZWx5KCFjYWNoZS0+cnEpKSB7CiAJCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZSA9IGViLT5lbmdpbmU7CiAKLQkJaWYgKCFpbnRlbF9lbmdpbmVfY2FuX3N0b3JlX2R3
b3JkKGVuZ2luZSkpIHsKKwkJaWYgKCFyZWxvY19jYW5fdXNlX2VuZ2luZShlbmdpbmUpKSB7CiAJ
CQllbmdpbmUgPSBlbmdpbmUtPmd0LT5lbmdpbmVfY2xhc3NbQ09QWV9FTkdJTkVfQ0xBU1NdWzBd
OwotCQkJaWYgKCFlbmdpbmUgfHwgIWludGVsX2VuZ2luZV9jYW5fc3RvcmVfZHdvcmQoZW5naW5l
KSkKKwkJCWlmICghZW5naW5lKQogCQkJCXJldHVybiBFUlJfUFRSKC1FTk9ERVYpOwogCQl9CiAK
QEAgLTE0MzUsOTEgKzE0NDAsMTM4IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCB1c2VfcmVsb2NfZ3B1
KHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCXJldHVybiAhZG1hX3Jlc3ZfdGVzdF9zaWduYWxlZF9y
Y3Uodm1hLT5yZXN2LCB0cnVlKTsKIH0KIAotc3RhdGljIHU2NAotcmVsb2NhdGVfZW50cnkoc3Ry
dWN0IGk5MTVfdm1hICp2bWEsCi0JICAgICAgIGNvbnN0IHN0cnVjdCBkcm1faTkxNV9nZW1fcmVs
b2NhdGlvbl9lbnRyeSAqcmVsb2MsCi0JICAgICAgIHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmVi
LAotCSAgICAgICBjb25zdCBzdHJ1Y3QgaTkxNV92bWEgKnRhcmdldCkKK3N0YXRpYyB1bnNpZ25l
ZCBsb25nIHZtYV9waHlzX2FkZHIoc3RydWN0IGk5MTVfdm1hICp2bWEsIHUzMiBvZmZzZXQpCiB7
Ci0JdTY0IG9mZnNldCA9IHJlbG9jLT5vZmZzZXQ7Ci0JdTY0IHRhcmdldF9vZmZzZXQgPSByZWxv
Y2F0aW9uX3RhcmdldChyZWxvYywgdGFyZ2V0KTsKLQlib29sIHdpZGUgPSBlYi0+cmVsb2NfY2Fj
aGUudXNlXzY0Yml0X3JlbG9jOwotCXZvaWQgKnZhZGRyOworCXN0cnVjdCBwYWdlICpwYWdlOwor
CXVuc2lnbmVkIGxvbmcgYWRkcjsKIAotCWlmICghZWItPnJlbG9jX2NhY2hlLnZhZGRyICYmIHVz
ZV9yZWxvY19ncHUodm1hKSkgewotCQljb25zdCB1bnNpZ25lZCBpbnQgZ2VuID0gZWItPnJlbG9j
X2NhY2hlLmdlbjsKLQkJdW5zaWduZWQgaW50IGxlbjsKLQkJdTMyICpiYXRjaDsKLQkJdTY0IGFk
ZHI7CisJR0VNX0JVR19PTih2bWEtPnBhZ2VzICE9IHZtYS0+b2JqLT5tbS5wYWdlcyk7CiAKLQkJ
aWYgKHdpZGUpCi0JCQlsZW4gPSBvZmZzZXQgJiA3ID8gOCA6IDU7Ci0JCWVsc2UgaWYgKGdlbiA+
PSA0KQotCQkJbGVuID0gNDsKLQkJZWxzZQotCQkJbGVuID0gMzsKKwlwYWdlID0gaTkxNV9nZW1f
b2JqZWN0X2dldF9wYWdlKHZtYS0+b2JqLCBvZmZzZXQgPj4gUEFHRV9TSElGVCk7CisJYWRkciA9
IFBGTl9QSFlTKHBhZ2VfdG9fcGZuKHBhZ2UpKTsKKwlHRU1fQlVHX09OKG92ZXJmbG93c190eXBl
KGFkZHIsIHUzMikpOyAvKiBleHBlY3RlZCBkbWEzMiAqLwogCi0JCWJhdGNoID0gcmVsb2NfZ3B1
KGViLCB2bWEsIGxlbik7Ci0JCWlmIChJU19FUlIoYmF0Y2gpKQotCQkJZ290byByZXBlYXQ7CisJ
cmV0dXJuIGFkZHIgKyBvZmZzZXRfaW5fcGFnZShvZmZzZXQpOworfQorCitzdGF0aWMgYm9vbCBf
X3JlbG9jX2VudHJ5X2dwdShzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYiwKKwkJCSAgICAgIHN0
cnVjdCBpOTE1X3ZtYSAqdm1hLAorCQkJICAgICAgdTY0IG9mZnNldCwKKwkJCSAgICAgIHU2NCB0
YXJnZXRfYWRkcikKK3sKKwljb25zdCB1bnNpZ25lZCBpbnQgZ2VuID0gZWItPnJlbG9jX2NhY2hl
LmdlbjsKKwl1bnNpZ25lZCBpbnQgbGVuOworCXUzMiAqYmF0Y2g7CisJdTY0IGFkZHI7CisKKwlp
ZiAoZ2VuID49IDgpCisJCWxlbiA9IG9mZnNldCAmIDcgPyA4IDogNTsKKwllbHNlIGlmIChnZW4g
Pj0gNCkKKwkJbGVuID0gNDsKKwllbHNlCisJCWxlbiA9IDM7CisKKwliYXRjaCA9IHJlbG9jX2dw
dShlYiwgdm1hLCBsZW4pOworCWlmIChJU19FUlIoYmF0Y2gpKQorCQlyZXR1cm4gZmFsc2U7CisK
KwlhZGRyID0gZ2VuOF9jYW5vbmljYWxfYWRkcih2bWEtPm5vZGUuc3RhcnQgKyBvZmZzZXQpOwor
CWlmIChnZW4gPj0gOCkgeworCQlpZiAob2Zmc2V0ICYgNykgeworCQkJKmJhdGNoKysgPSBNSV9T
VE9SRV9EV09SRF9JTU1fR0VONDsKKwkJCSpiYXRjaCsrID0gbG93ZXJfMzJfYml0cyhhZGRyKTsK
KwkJCSpiYXRjaCsrID0gdXBwZXJfMzJfYml0cyhhZGRyKTsKKwkJCSpiYXRjaCsrID0gbG93ZXJf
MzJfYml0cyh0YXJnZXRfYWRkcik7CisKKwkJCWFkZHIgPSBnZW44X2Nhbm9uaWNhbF9hZGRyKGFk
ZHIgKyA0KTsKIAotCQlhZGRyID0gZ2VuOF9jYW5vbmljYWxfYWRkcih2bWEtPm5vZGUuc3RhcnQg
KyBvZmZzZXQpOwotCQlpZiAod2lkZSkgewotCQkJaWYgKG9mZnNldCAmIDcpIHsKLQkJCQkqYmF0
Y2grKyA9IE1JX1NUT1JFX0RXT1JEX0lNTV9HRU40OwotCQkJCSpiYXRjaCsrID0gbG93ZXJfMzJf
Yml0cyhhZGRyKTsKLQkJCQkqYmF0Y2grKyA9IHVwcGVyXzMyX2JpdHMoYWRkcik7Ci0JCQkJKmJh
dGNoKysgPSBsb3dlcl8zMl9iaXRzKHRhcmdldF9vZmZzZXQpOwotCi0JCQkJYWRkciA9IGdlbjhf
Y2Fub25pY2FsX2FkZHIoYWRkciArIDQpOwotCi0JCQkJKmJhdGNoKysgPSBNSV9TVE9SRV9EV09S
RF9JTU1fR0VONDsKLQkJCQkqYmF0Y2grKyA9IGxvd2VyXzMyX2JpdHMoYWRkcik7Ci0JCQkJKmJh
dGNoKysgPSB1cHBlcl8zMl9iaXRzKGFkZHIpOwotCQkJCSpiYXRjaCsrID0gdXBwZXJfMzJfYml0
cyh0YXJnZXRfb2Zmc2V0KTsKLQkJCX0gZWxzZSB7Ci0JCQkJKmJhdGNoKysgPSAoTUlfU1RPUkVf
RFdPUkRfSU1NX0dFTjQgfCAoMSA8PCAyMSkpICsgMTsKLQkJCQkqYmF0Y2grKyA9IGxvd2VyXzMy
X2JpdHMoYWRkcik7Ci0JCQkJKmJhdGNoKysgPSB1cHBlcl8zMl9iaXRzKGFkZHIpOwotCQkJCSpi
YXRjaCsrID0gbG93ZXJfMzJfYml0cyh0YXJnZXRfb2Zmc2V0KTsKLQkJCQkqYmF0Y2grKyA9IHVw
cGVyXzMyX2JpdHModGFyZ2V0X29mZnNldCk7Ci0JCQl9Ci0JCX0gZWxzZSBpZiAoZ2VuID49IDYp
IHsKIAkJCSpiYXRjaCsrID0gTUlfU1RPUkVfRFdPUkRfSU1NX0dFTjQ7Ci0JCQkqYmF0Y2grKyA9
IDA7Ci0JCQkqYmF0Y2grKyA9IGFkZHI7Ci0JCQkqYmF0Y2grKyA9IHRhcmdldF9vZmZzZXQ7Ci0J
CX0gZWxzZSBpZiAoZ2VuID49IDQpIHsKLQkJCSpiYXRjaCsrID0gTUlfU1RPUkVfRFdPUkRfSU1N
X0dFTjQgfCBNSV9VU0VfR0dUVDsKLQkJCSpiYXRjaCsrID0gMDsKLQkJCSpiYXRjaCsrID0gYWRk
cjsKLQkJCSpiYXRjaCsrID0gdGFyZ2V0X29mZnNldDsKKwkJCSpiYXRjaCsrID0gbG93ZXJfMzJf
Yml0cyhhZGRyKTsKKwkJCSpiYXRjaCsrID0gdXBwZXJfMzJfYml0cyhhZGRyKTsKKwkJCSpiYXRj
aCsrID0gdXBwZXJfMzJfYml0cyh0YXJnZXRfYWRkcik7CiAJCX0gZWxzZSB7Ci0JCQkqYmF0Y2gr
KyA9IE1JX1NUT1JFX0RXT1JEX0lNTSB8IE1JX01FTV9WSVJUVUFMOwotCQkJKmJhdGNoKysgPSBh
ZGRyOwotCQkJKmJhdGNoKysgPSB0YXJnZXRfb2Zmc2V0OworCQkJKmJhdGNoKysgPSAoTUlfU1RP
UkVfRFdPUkRfSU1NX0dFTjQgfCAoMSA8PCAyMSkpICsgMTsKKwkJCSpiYXRjaCsrID0gbG93ZXJf
MzJfYml0cyhhZGRyKTsKKwkJCSpiYXRjaCsrID0gdXBwZXJfMzJfYml0cyhhZGRyKTsKKwkJCSpi
YXRjaCsrID0gbG93ZXJfMzJfYml0cyh0YXJnZXRfYWRkcik7CisJCQkqYmF0Y2grKyA9IHVwcGVy
XzMyX2JpdHModGFyZ2V0X2FkZHIpOwogCQl9Ci0KLQkJZ290byBvdXQ7CisJfSBlbHNlIGlmIChn
ZW4gPj0gNikgeworCQkqYmF0Y2grKyA9IE1JX1NUT1JFX0RXT1JEX0lNTV9HRU40OworCQkqYmF0
Y2grKyA9IDA7CisJCSpiYXRjaCsrID0gYWRkcjsKKwkJKmJhdGNoKysgPSB0YXJnZXRfYWRkcjsK
Kwl9IGVsc2UgaWYgKElTX0k5NjVHKGViLT5pOTE1KSkgeworCQkqYmF0Y2grKyA9IE1JX1NUT1JF
X0RXT1JEX0lNTV9HRU40OworCQkqYmF0Y2grKyA9IDA7CisJCSpiYXRjaCsrID0gdm1hX3BoeXNf
YWRkcih2bWEsIG9mZnNldCk7CisJCSpiYXRjaCsrID0gdGFyZ2V0X2FkZHI7CisJfSBlbHNlIGlm
IChnZW4gPj0gNCkgeworCQkqYmF0Y2grKyA9IE1JX1NUT1JFX0RXT1JEX0lNTV9HRU40IHwgTUlf
VVNFX0dHVFQ7CisJCSpiYXRjaCsrID0gMDsKKwkJKmJhdGNoKysgPSBhZGRyOworCQkqYmF0Y2gr
KyA9IHRhcmdldF9hZGRyOworCX0gZWxzZSBpZiAoZ2VuID49IDMgJiYKKwkJICAgIShJU19JOTE1
RyhlYi0+aTkxNSkgfHwgSVNfSTkxNUdNKGViLT5pOTE1KSkpIHsKKwkJKmJhdGNoKysgPSBNSV9T
VE9SRV9EV09SRF9JTU0gfCBNSV9NRU1fVklSVFVBTDsKKwkJKmJhdGNoKysgPSBhZGRyOworCQkq
YmF0Y2grKyA9IHRhcmdldF9hZGRyOworCX0gZWxzZSB7CisJCSpiYXRjaCsrID0gTUlfU1RPUkVf
RFdPUkRfSU1NOworCQkqYmF0Y2grKyA9IHZtYV9waHlzX2FkZHIodm1hLCBvZmZzZXQpOworCQkq
YmF0Y2grKyA9IHRhcmdldF9hZGRyOwogCX0KIAorCXJldHVybiB0cnVlOworfQorCitzdGF0aWMg
Ym9vbCByZWxvY19lbnRyeV9ncHUoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsCisJCQkgICAg
c3RydWN0IGk5MTVfdm1hICp2bWEsCisJCQkgICAgdTY0IG9mZnNldCwKKwkJCSAgICB1NjQgdGFy
Z2V0X2FkZHIpCit7CisJaWYgKGViLT5yZWxvY19jYWNoZS52YWRkcikKKwkJcmV0dXJuIGZhbHNl
OworCisJaWYgKCF1c2VfcmVsb2NfZ3B1KHZtYSkpCisJCXJldHVybiBmYWxzZTsKKworCXJldHVy
biBfX3JlbG9jX2VudHJ5X2dwdShlYiwgdm1hLCBvZmZzZXQsIHRhcmdldF9hZGRyKTsKK30KKwor
c3RhdGljIHU2NAorcmVsb2NhdGVfZW50cnkoc3RydWN0IGk5MTVfdm1hICp2bWEsCisJICAgICAg
IGNvbnN0IHN0cnVjdCBkcm1faTkxNV9nZW1fcmVsb2NhdGlvbl9lbnRyeSAqcmVsb2MsCisJICAg
ICAgIHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViLAorCSAgICAgICBjb25zdCBzdHJ1Y3QgaTkx
NV92bWEgKnRhcmdldCkKK3sKKwl1NjQgdGFyZ2V0X2FkZHIgPSByZWxvY2F0aW9uX3RhcmdldChy
ZWxvYywgdGFyZ2V0KTsKKwl1NjQgb2Zmc2V0ID0gcmVsb2MtPm9mZnNldDsKKworCWlmICghcmVs
b2NfZW50cnlfZ3B1KGViLCB2bWEsIG9mZnNldCwgdGFyZ2V0X2FkZHIpKSB7CisJCWJvb2wgd2lk
ZSA9IGViLT5yZWxvY19jYWNoZS51c2VfNjRiaXRfcmVsb2M7CisJCXZvaWQgKnZhZGRyOworCiBy
ZXBlYXQ6Ci0JdmFkZHIgPSByZWxvY192YWRkcih2bWEtPm9iaiwgJmViLT5yZWxvY19jYWNoZSwg
b2Zmc2V0ID4+IFBBR0VfU0hJRlQpOwotCWlmIChJU19FUlIodmFkZHIpKQotCQlyZXR1cm4gUFRS
X0VSUih2YWRkcik7CisJCXZhZGRyID0gcmVsb2NfdmFkZHIodm1hLT5vYmosCisJCQkJICAgICZl
Yi0+cmVsb2NfY2FjaGUsCisJCQkJICAgIG9mZnNldCA+PiBQQUdFX1NISUZUKTsKKwkJaWYgKElT
X0VSUih2YWRkcikpCisJCQlyZXR1cm4gUFRSX0VSUih2YWRkcik7CiAKLQljbGZsdXNoX3dyaXRl
MzIodmFkZHIgKyBvZmZzZXRfaW5fcGFnZShvZmZzZXQpLAotCQkJbG93ZXJfMzJfYml0cyh0YXJn
ZXRfb2Zmc2V0KSwKLQkJCWViLT5yZWxvY19jYWNoZS52YWRkcik7CisJCUdFTV9CVUdfT04oIUlT
X0FMSUdORUQob2Zmc2V0LCBzaXplb2YodTMyKSkpOworCQljbGZsdXNoX3dyaXRlMzIodmFkZHIg
KyBvZmZzZXRfaW5fcGFnZShvZmZzZXQpLAorCQkJCWxvd2VyXzMyX2JpdHModGFyZ2V0X2FkZHIp
LAorCQkJCWViLT5yZWxvY19jYWNoZS52YWRkcik7CiAKLQlpZiAod2lkZSkgewotCQlvZmZzZXQg
Kz0gc2l6ZW9mKHUzMik7Ci0JCXRhcmdldF9vZmZzZXQgPj49IDMyOwotCQl3aWRlID0gZmFsc2U7
Ci0JCWdvdG8gcmVwZWF0OworCQlpZiAod2lkZSkgeworCQkJb2Zmc2V0ICs9IHNpemVvZih1MzIp
OworCQkJdGFyZ2V0X2FkZHIgPj49IDMyOworCQkJd2lkZSA9IGZhbHNlOworCQkJZ290byByZXBl
YXQ7CisJCX0KIAl9CiAKLW91dDoKIAlyZXR1cm4gdGFyZ2V0LT5ub2RlLnN0YXJ0IHwgVVBEQVRF
OwogfQogCkBAIC0zMDIyLDMgKzMwNzQsNyBAQCBlbmQ6OwogCWt2ZnJlZShleGVjMl9saXN0KTsK
IAlyZXR1cm4gZXJyOwogfQorCisjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfU0VMRlRF
U1QpCisjaW5jbHVkZSAic2VsZnRlc3RzL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyIKKyNlbmRpZgpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9j
bGllbnRfYmx0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2Vt
X2NsaWVudF9ibHQuYwppbmRleCBiZTI2ODUxMWNiNmQuLjhmZTNhZDJlZTM0ZSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jbGllbnRfYmx0
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jbGll
bnRfYmx0LmMKQEAgLTMwMiwzNSArMzAyLDYgQEAgc3RhdGljIHZvaWQgZmlsbF9zY3JhdGNoKHN0
cnVjdCB0aWxlZF9ibGl0cyAqdCwgdTMyICp2YWRkciwgdTMyIHZhbCkKIAlpOTE1X2dlbV9vYmpl
Y3RfZmx1c2hfbWFwKHQtPnNjcmF0Y2gudm1hLT5vYmopOwogfQogCi1zdGF0aWMgdm9pZCBoZXhk
dW1wKGNvbnN0IHZvaWQgKmJ1Ziwgc2l6ZV90IGxlbikKLXsKLQljb25zdCBzaXplX3Qgcm93c2l6
ZSA9IDggKiBzaXplb2YodTMyKTsKLQljb25zdCB2b2lkICpwcmV2ID0gTlVMTDsKLQlib29sIHNr
aXAgPSBmYWxzZTsKLQlzaXplX3QgcG9zOwotCi0JZm9yIChwb3MgPSAwOyBwb3MgPCBsZW47IHBv
cyArPSByb3dzaXplKSB7Ci0JCWNoYXIgbGluZVsxMjhdOwotCi0JCWlmIChwcmV2ICYmICFtZW1j
bXAocHJldiwgYnVmICsgcG9zLCByb3dzaXplKSkgewotCQkJaWYgKCFza2lwKSB7Ci0JCQkJcHJf
aW5mbygiKlxuIik7Ci0JCQkJc2tpcCA9IHRydWU7Ci0JCQl9Ci0JCQljb250aW51ZTsKLQkJfQot
Ci0JCVdBUk5fT05fT05DRShoZXhfZHVtcF90b19idWZmZXIoYnVmICsgcG9zLCBsZW4gLSBwb3Ms
Ci0JCQkJCQlyb3dzaXplLCBzaXplb2YodTMyKSwKLQkJCQkJCWxpbmUsIHNpemVvZihsaW5lKSwK
LQkJCQkJCWZhbHNlKSA+PSBzaXplb2YobGluZSkpOwotCQlwcl9pbmZvKCJbJTA0enhdICVzXG4i
LCBwb3MsIGxpbmUpOwotCi0JCXByZXYgPSBidWYgKyBwb3M7Ci0JCXNraXAgPSBmYWxzZTsKLQl9
Ci19Ci0KIHN0YXRpYyB1NjQgc3dpenpsZV9iaXQodW5zaWduZWQgaW50IGJpdCwgdTY0IG9mZnNl
dCkKIHsKIAlyZXR1cm4gKG9mZnNldCAmIEJJVF9VTEwoYml0KSkgPj4gKGJpdCAtIDYpOwpAQCAt
NDI2LDcgKzM5Nyw3IEBAIHN0YXRpYyBpbnQgdmVyaWZ5X2J1ZmZlcihjb25zdCBzdHJ1Y3QgdGls
ZWRfYmxpdHMgKnQsCiAJCXByX2VycigiSW52YWxpZCAlcyB0aWxpbmcgZGV0ZWN0ZWQgYXQgKCVk
LCAlZCksIHN0YXJ0X3ZhbCAleFxuIiwKIAkJICAgICAgIHJlcHJfdGlsaW5nKGJ1Zi0+dGlsaW5n
KSwKIAkJICAgICAgIHgsIHksIGJ1Zi0+c3RhcnRfdmFsKTsKLQkJaGV4ZHVtcCh2YWRkciwgNDA5
Nik7CisJCWlndF9oZXhkdW1wKHZhZGRyLCA0MDk2KTsKIAl9CiAKIAlpOTE1X2dlbV9vYmplY3Rf
dW5waW5fbWFwKGJ1Zi0+dm1hLT5vYmopOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9leGVjYnVmZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYwpuZXcgZmlsZSBtb2RlIDEw
MDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmE0OTAxNmY4ZWUwZAotLS0gL2Rldi9udWxsCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fZXhlY2J1ZmZlci5j
CkBAIC0wLDAgKzEsMTcxIEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUCisvKgor
ICogQ29weXJpZ2h0IMKpIDIwMjAgSW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaW5jbHVkZSAi
aTkxNV9zZWxmdGVzdC5oIgorCisjaW5jbHVkZSAiZ3QvaW50ZWxfZW5naW5lX3BtLmgiCisjaW5j
bHVkZSAic2VsZnRlc3RzL2lndF9mbHVzaF90ZXN0LmgiCisKK3N0YXRpYyB1NjQgcmVhZF9yZWxv
Yyhjb25zdCB1MzIgKm1hcCwgaW50IHgsIGNvbnN0IHU2NCBtYXNrKQoreworCXU2NCByZWxvYzsK
KworCW1lbWNweSgmcmVsb2MsICZtYXBbeF0sIHNpemVvZihyZWxvYykpOworCXJldHVybiByZWxv
YyAmIG1hc2s7Cit9CisKK3N0YXRpYyBpbnQgX19pZ3RfZ3B1X3JlbG9jKHN0cnVjdCBpOTE1X2V4
ZWNidWZmZXIgKmViLAorCQkJICAgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKK3sK
Kwljb25zdCB1bnNpZ25lZCBpbnQgb2Zmc2V0c1tdID0geyA4LCAzLCAwIH07CisJY29uc3QgdTY0
IG1hc2sgPQorCQlHRU5NQVNLX1VMTChlYi0+cmVsb2NfY2FjaGUudXNlXzY0Yml0X3JlbG9jID8g
NjMgOiAzMSwgMCk7CisJY29uc3QgdTMyICptYXAgPSBwYWdlX21hc2tfYml0cyhvYmotPm1tLm1h
cHBpbmcpOworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCXN0cnVjdCBpOTE1X3ZtYSAqdm1h
OworCWludCBlcnI7CisJaW50IGk7CisKKwl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosIGVi
LT5jb250ZXh0LT52bSwgTlVMTCk7CisJaWYgKElTX0VSUih2bWEpKQorCQlyZXR1cm4gUFRSX0VS
Uih2bWEpOworCisJZXJyID0gaTkxNV92bWFfcGluKHZtYSwgMCwgMCwgUElOX1VTRVIgfCBQSU5f
SElHSCk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCS8qIDgtQnl0ZSBhbGlnbmVkICov
CisJaWYgKCFfX3JlbG9jX2VudHJ5X2dwdShlYiwgdm1hLAorCQkJICAgICAgIG9mZnNldHNbMF0g
KiBzaXplb2YodTMyKSwKKwkJCSAgICAgICAwKSkgeworCQllcnIgPSAtRUlPOworCQlnb3RvIHVu
cGluX3ZtYTsKKwl9CisKKwkvKiAhOC1CeXRlIGFsaWduZWQgKi8KKwlpZiAoIV9fcmVsb2NfZW50
cnlfZ3B1KGViLCB2bWEsCisJCQkgICAgICAgb2Zmc2V0c1sxXSAqIHNpemVvZih1MzIpLAorCQkJ
ICAgICAgIDEpKSB7CisJCWVyciA9IC1FSU87CisJCWdvdG8gdW5waW5fdm1hOworCX0KKworCS8q
IFNraXAgdG8gdGhlIGVuZCBvZiB0aGUgY21kIHBhZ2UgKi8KKwlpID0gUEFHRV9TSVpFIC8gc2l6
ZW9mKHUzMikgLSBSRUxPQ19UQUlMIC0gMTsKKwlpIC09IGViLT5yZWxvY19jYWNoZS5ycV9zaXpl
OworCW1lbXNldDMyKGViLT5yZWxvY19jYWNoZS5ycV9jbWQgKyBlYi0+cmVsb2NfY2FjaGUucnFf
c2l6ZSwKKwkJIE1JX05PT1AsIGkpOworCWViLT5yZWxvY19jYWNoZS5ycV9zaXplICs9IGk7CisK
KwkvKiBGb3JjZSBiYXRjaCBjaGFpbmluZyAqLworCWlmICghX19yZWxvY19lbnRyeV9ncHUoZWIs
IHZtYSwKKwkJCSAgICAgICBvZmZzZXRzWzJdICogc2l6ZW9mKHUzMiksCisJCQkgICAgICAgMikp
IHsKKwkJZXJyID0gLUVJTzsKKwkJZ290byB1bnBpbl92bWE7CisJfQorCisJR0VNX0JVR19PTigh
ZWItPnJlbG9jX2NhY2hlLnJxKTsKKwlycSA9IGk5MTVfcmVxdWVzdF9nZXQoZWItPnJlbG9jX2Nh
Y2hlLnJxKTsKKwllcnIgPSByZWxvY19ncHVfZmx1c2goJmViLT5yZWxvY19jYWNoZSk7CisJaWYg
KGVycikKKwkJZ290byBwdXRfcnE7CisJR0VNX0JVR19PTihlYi0+cmVsb2NfY2FjaGUucnEpOwor
CisJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3dhaXQob2JqLCBJOTE1X1dBSVRfSU5URVJSVVBUSUJM
RSwgSFogLyAyKTsKKwlpZiAoZXJyKSB7CisJCWludGVsX2d0X3NldF93ZWRnZWQoZWItPmVuZ2lu
ZS0+Z3QpOworCQlnb3RvIHB1dF9ycTsKKwl9CisKKwlpZiAoIWk5MTVfcmVxdWVzdF9jb21wbGV0
ZWQocnEpKSB7CisJCXByX2VycigiJXM6IGRpZCBub3Qgd2FpdCBmb3IgcmVsb2NhdGlvbnMhXG4i
LCBlYi0+ZW5naW5lLT5uYW1lKTsKKwkJZXJyID0gLUVJTlZBTDsKKwkJZ290byBwdXRfcnE7CisJ
fQorCisJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUob2Zmc2V0cyk7IGkrKykgeworCQl1NjQg
cmVsb2MgPSByZWFkX3JlbG9jKG1hcCwgb2Zmc2V0c1tpXSwgbWFzayk7CisKKwkJaWYgKHJlbG9j
ICE9IGkpIHsKKwkJCXByX2VycigiJXNbJWRdOiBtYXBbJWRdICVsbHggIT0gJXhcbiIsCisJCQkg
ICAgICAgZWItPmVuZ2luZS0+bmFtZSwgaSwgb2Zmc2V0c1tpXSwgcmVsb2MsIGkpOworCQkJZXJy
ID0gLUVJTlZBTDsKKwkJfQorCX0KKwlpZiAoZXJyKQorCQlpZ3RfaGV4ZHVtcChtYXAsIDQwOTYp
OworCitwdXRfcnE6CisJaTkxNV9yZXF1ZXN0X3B1dChycSk7Cit1bnBpbl92bWE6CisJaTkxNV92
bWFfdW5waW4odm1hKTsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgaW50IGlndF9ncHVfcmVs
b2Modm9pZCAqYXJnKQoreworCXN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgZWI7CisJc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKnNjcmF0Y2g7CisJaW50IGVyciA9IDA7CisJdTMyICptYXA7CisK
KwllYi5pOTE1ID0gYXJnOworCisJc2NyYXRjaCA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50
ZXJuYWwoZWIuaTkxNSwgNDA5Nik7CisJaWYgKElTX0VSUihzY3JhdGNoKSkKKwkJcmV0dXJuIFBU
Ul9FUlIoc2NyYXRjaCk7CisKKwltYXAgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChzY3JhdGNo
LCBJOTE1X01BUF9XQyk7CisJaWYgKElTX0VSUihtYXApKSB7CisJCWVyciA9IFBUUl9FUlIobWFw
KTsKKwkJZ290byBlcnJfc2NyYXRjaDsKKwl9CisKKwlmb3JfZWFjaF91YWJpX2VuZ2luZShlYi5l
bmdpbmUsIGViLmk5MTUpIHsKKwkJcmVsb2NfY2FjaGVfaW5pdCgmZWIucmVsb2NfY2FjaGUsIGVi
Lmk5MTUpOworCQltZW1zZXQobWFwLCBQT0lTT05fSU5VU0UsIDQwOTYpOworCisJCWludGVsX2Vu
Z2luZV9wbV9nZXQoZWIuZW5naW5lKTsKKwkJZWIuY29udGV4dCA9IGludGVsX2NvbnRleHRfY3Jl
YXRlKGViLmVuZ2luZSk7CisJCWlmIChJU19FUlIoZWIuY29udGV4dCkpIHsKKwkJCWVyciA9IFBU
Ul9FUlIoZWIuY29udGV4dCk7CisJCQlnb3RvIGVycl9wbTsKKwkJfQorCisJCWVyciA9IGludGVs
X2NvbnRleHRfcGluKGViLmNvbnRleHQpOworCQlpZiAoZXJyKQorCQkJZ290byBlcnJfcHV0Owor
CisJCWVyciA9IF9faWd0X2dwdV9yZWxvYygmZWIsIHNjcmF0Y2gpOworCisJCWludGVsX2NvbnRl
eHRfdW5waW4oZWIuY29udGV4dCk7CitlcnJfcHV0OgorCQlpbnRlbF9jb250ZXh0X3B1dChlYi5j
b250ZXh0KTsKK2Vycl9wbToKKwkJaW50ZWxfZW5naW5lX3BtX3B1dChlYi5lbmdpbmUpOworCQlp
ZiAoZXJyKQorCQkJYnJlYWs7CisJfQorCisJaWYgKGlndF9mbHVzaF90ZXN0KGViLmk5MTUpKQor
CQllcnIgPSAtRUlPOworCitlcnJfc2NyYXRjaDoKKwlpOTE1X2dlbV9vYmplY3RfcHV0KHNjcmF0
Y2gpOworCXJldHVybiBlcnI7Cit9CisKK2ludCBpOTE1X2dlbV9leGVjYnVmZmVyX2xpdmVfc2Vs
ZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQoreworCXN0YXRpYyBjb25zdCBz
dHJ1Y3QgaTkxNV9zdWJ0ZXN0IHRlc3RzW10gPSB7CisJCVNVQlRFU1QoaWd0X2dwdV9yZWxvYyks
CisJfTsKKworCWlmIChpbnRlbF9ndF9pc193ZWRnZWQoJmk5MTUtPmd0KSkKKwkJcmV0dXJuIDA7
CisKKwlyZXR1cm4gaTkxNV9saXZlX3N1YnRlc3RzKHRlc3RzLCBpOTE1KTsKK30KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKaW5kZXggNzUyOWRmOTJmNmEyLi4zY2VkNzM1MzNm
NmIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCkBAIC00MzQyLDM1ICs0
MzQyLDYgQEAgaW50IGludGVsX2V4ZWNsaXN0c19saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIAlyZXR1cm4gaW50ZWxfZ3RfbGl2ZV9zdWJ0ZXN0cyh0ZXN0cywg
Jmk5MTUtPmd0KTsKIH0KIAotc3RhdGljIHZvaWQgaGV4ZHVtcChjb25zdCB2b2lkICpidWYsIHNp
emVfdCBsZW4pCi17Ci0JY29uc3Qgc2l6ZV90IHJvd3NpemUgPSA4ICogc2l6ZW9mKHUzMik7Ci0J
Y29uc3Qgdm9pZCAqcHJldiA9IE5VTEw7Ci0JYm9vbCBza2lwID0gZmFsc2U7Ci0Jc2l6ZV90IHBv
czsKLQotCWZvciAocG9zID0gMDsgcG9zIDwgbGVuOyBwb3MgKz0gcm93c2l6ZSkgewotCQljaGFy
IGxpbmVbMTI4XTsKLQotCQlpZiAocHJldiAmJiAhbWVtY21wKHByZXYsIGJ1ZiArIHBvcywgcm93
c2l6ZSkpIHsKLQkJCWlmICghc2tpcCkgewotCQkJCXByX2luZm8oIipcbiIpOwotCQkJCXNraXAg
PSB0cnVlOwotCQkJfQotCQkJY29udGludWU7Ci0JCX0KLQotCQlXQVJOX09OX09OQ0UoaGV4X2R1
bXBfdG9fYnVmZmVyKGJ1ZiArIHBvcywgbGVuIC0gcG9zLAotCQkJCQkJcm93c2l6ZSwgc2l6ZW9m
KHUzMiksCi0JCQkJCQlsaW5lLCBzaXplb2YobGluZSksCi0JCQkJCQlmYWxzZSkgPj0gc2l6ZW9m
KGxpbmUpKTsKLQkJcHJfaW5mbygiWyUwNHp4XSAlc1xuIiwgcG9zLCBsaW5lKTsKLQotCQlwcmV2
ID0gYnVmICsgcG9zOwotCQlza2lwID0gZmFsc2U7Ci0JfQotfQotCiBzdGF0aWMgaW50IGVtaXRf
c2VtYXBob3JlX3NpZ25hbChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIHZvaWQgKnNsb3QpCiB7
CiAJY29uc3QgdTMyIG9mZnNldCA9CkBAIC00NTE4LDEwICs0NDg5LDEwIEBAIHN0YXRpYyBpbnQg
bGl2ZV9scmNfbGF5b3V0KHZvaWQgKmFyZykKIAogCQlpZiAoZXJyKSB7CiAJCQlwcl9pbmZvKCIl
czogSFcgcmVnaXN0ZXIgaW1hZ2U6XG4iLCBlbmdpbmUtPm5hbWUpOwotCQkJaGV4ZHVtcChodywg
UEFHRV9TSVpFKTsKKwkJCWlndF9oZXhkdW1wKGh3LCBQQUdFX1NJWkUpOwogCiAJCQlwcl9pbmZv
KCIlczogU1cgcmVnaXN0ZXIgaW1hZ2U6XG4iLCBlbmdpbmUtPm5hbWUpOwotCQkJaGV4ZHVtcChs
cmMsIFBBR0VfU0laRSk7CisJCQlpZ3RfaGV4ZHVtcChscmMsIFBBR0VfU0laRSk7CiAJCX0KIAog
CQlzaG1lbV91bnBpbl9tYXAoZW5naW5lLT5kZWZhdWx0X3N0YXRlLCBodyk7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NlbGZ0ZXN0LmggYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3NlbGZ0ZXN0LmgKaW5kZXggOThiY2I2ZmEwYWI0Li5kNTNkMjA3YWI2ZWIgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2VsZnRlc3QuaAorKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NlbGZ0ZXN0LmgKQEAgLTEzMyw0ICsxMzMsNiBAQCBib29s
IF9faWd0X3RpbWVvdXQodW5zaWduZWQgbG9uZyB0aW1lb3V0LCBjb25zdCBjaGFyICpmbXQsIC4u
Lik7CiAjZGVmaW5lIGlndF90aW1lb3V0KHQsIGZtdCwgLi4uKSBcCiAJX19pZ3RfdGltZW91dCgo
dCksIEtFUk5fREVCVUcgcHJfZm10KGZtdCksICMjX19WQV9BUkdTX18pCiAKK3ZvaWQgaWd0X2hl
eGR1bXAoY29uc3Qgdm9pZCAqYnVmLCBzaXplX3QgbGVuKTsKKwogI2VuZGlmIC8qICFfX0k5MTVf
U0VMRlRFU1RfSF9fICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaTkxNV9saXZlX3NlbGZ0ZXN0cy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3Rz
L2k5MTVfbGl2ZV9zZWxmdGVzdHMuaAppbmRleCAwYTk1M2JmYzA1ODUuLjVkZDVkODE2NDZjNCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxm
dGVzdHMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9saXZlX3Nl
bGZ0ZXN0cy5oCkBAIC0zNyw2ICszNyw3IEBAIHNlbGZ0ZXN0KGdlbSwgaTkxNV9nZW1fbGl2ZV9z
ZWxmdGVzdHMpCiBzZWxmdGVzdChldmljdCwgaTkxNV9nZW1fZXZpY3RfbGl2ZV9zZWxmdGVzdHMp
CiBzZWxmdGVzdChodWdlcGFnZXMsIGk5MTVfZ2VtX2h1Z2VfcGFnZV9saXZlX3NlbGZ0ZXN0cykK
IHNlbGZ0ZXN0KGdlbV9jb250ZXh0cywgaTkxNV9nZW1fY29udGV4dF9saXZlX3NlbGZ0ZXN0cykK
K3NlbGZ0ZXN0KGdlbV9leGVjYnVmLCBpOTE1X2dlbV9leGVjYnVmZmVyX2xpdmVfc2VsZnRlc3Rz
KQogc2VsZnRlc3QoYmx0LCBpOTE1X2dlbV9vYmplY3RfYmx0X2xpdmVfc2VsZnRlc3RzKQogc2Vs
ZnRlc3QoY2xpZW50LCBpOTE1X2dlbV9jbGllbnRfYmx0X2xpdmVfc2VsZnRlc3RzKQogc2VsZnRl
c3QocmVzZXQsIGludGVsX3Jlc2V0X2xpdmVfc2VsZnRlc3RzKQpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfc2VsZnRlc3QuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3NlbGZ0ZXN0LmMKaW5kZXggZDNiZjllZWZiNjgyLi4xYmMx
MWMwOWZhZWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1
X3NlbGZ0ZXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfc2Vs
ZnRlc3QuYwpAQCAtMzk2LDYgKzM5NiwzNSBAQCBib29sIF9faWd0X3RpbWVvdXQodW5zaWduZWQg
bG9uZyB0aW1lb3V0LCBjb25zdCBjaGFyICpmbXQsIC4uLikKIAlyZXR1cm4gdHJ1ZTsKIH0KIAor
dm9pZCBpZ3RfaGV4ZHVtcChjb25zdCB2b2lkICpidWYsIHNpemVfdCBsZW4pCit7CisJY29uc3Qg
c2l6ZV90IHJvd3NpemUgPSA4ICogc2l6ZW9mKHUzMik7CisJY29uc3Qgdm9pZCAqcHJldiA9IE5V
TEw7CisJYm9vbCBza2lwID0gZmFsc2U7CisJc2l6ZV90IHBvczsKKworCWZvciAocG9zID0gMDsg
cG9zIDwgbGVuOyBwb3MgKz0gcm93c2l6ZSkgeworCQljaGFyIGxpbmVbMTI4XTsKKworCQlpZiAo
cHJldiAmJiAhbWVtY21wKHByZXYsIGJ1ZiArIHBvcywgcm93c2l6ZSkpIHsKKwkJCWlmICghc2tp
cCkgeworCQkJCXByX2luZm8oIipcbiIpOworCQkJCXNraXAgPSB0cnVlOworCQkJfQorCQkJY29u
dGludWU7CisJCX0KKworCQlXQVJOX09OX09OQ0UoaGV4X2R1bXBfdG9fYnVmZmVyKGJ1ZiArIHBv
cywgbGVuIC0gcG9zLAorCQkJCQkJcm93c2l6ZSwgc2l6ZW9mKHUzMiksCisJCQkJCQlsaW5lLCBz
aXplb2YobGluZSksCisJCQkJCQlmYWxzZSkgPj0gc2l6ZW9mKGxpbmUpKTsKKwkJcHJfaW5mbygi
WyUwNHp4XSAlc1xuIiwgcG9zLCBsaW5lKTsKKworCQlwcmV2ID0gYnVmICsgcG9zOworCQlza2lw
ID0gZmFsc2U7CisJfQorfQorCiBtb2R1bGVfcGFyYW1fbmFtZWQoc3RfcmFuZG9tX3NlZWQsIGk5
MTVfc2VsZnRlc3QucmFuZG9tX3NlZWQsIHVpbnQsIDA0MDApOwogbW9kdWxlX3BhcmFtX25hbWVk
KHN0X3RpbWVvdXQsIGk5MTVfc2VsZnRlc3QudGltZW91dF9tcywgdWludCwgMDQwMCk7CiBtb2R1
bGVfcGFyYW1fbmFtZWQoc3RfZmlsdGVyLCBpOTE1X3NlbGZ0ZXN0LmZpbHRlciwgY2hhcnAsIDA0
MDApOwotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRl
bC1nZngK

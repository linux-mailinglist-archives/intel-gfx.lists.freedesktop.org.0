Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3A8AA2D9E18
	for <lists+intel-gfx@lfdr.de>; Mon, 14 Dec 2020 18:49:05 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E76316E0AF;
	Mon, 14 Dec 2020 17:48:59 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga14.intel.com (mga14.intel.com [192.55.52.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1547B6E0AF
 for <intel-gfx@lists.freedesktop.org>; Mon, 14 Dec 2020 17:48:59 +0000 (UTC)
IronPort-SDR: ihos3QD6/EjsoQF9/ODkmFSDkfSCjk+6J7LbT3mCaMvVhS+8pcrruNroVoXi8eskztefHZ9z8F
 PqQ6mF5Dypxw==
X-IronPort-AV: E=McAfee;i="6000,8403,9834"; a="173977248"
X-IronPort-AV: E=Sophos;i="5.78,420,1599548400"; d="scan'208";a="173977248"
Received: from fmsmga003.fm.intel.com ([10.253.24.29])
 by fmsmga103.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 14 Dec 2020 09:48:58 -0800
IronPort-SDR: 1iCMpRoIV9GpV/+MSy9ovPzVyewoltHc8fuf3kucwPaceuTtW78ypi6AFlFUelk1xhwMvq5Rpq
 45boMgl56ACg==
X-IronPort-AV: E=Sophos;i="5.78,420,1599548400"; d="scan'208";a="389088035"
Received: from mbenes1-mobl.amr.corp.intel.com (HELO josouza-mobl2.intel.com)
 ([10.254.42.53])
 by fmsmga003-auth.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 14 Dec 2020 09:48:57 -0800
From: =?UTF-8?q?Jos=C3=A9=20Roberto=20de=20Souza?= <jose.souza@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 14 Dec 2020 09:49:09 -0800
Message-Id: <20201214174912.174065-2-jose.souza@intel.com>
X-Mailer: git-send-email 2.29.2
In-Reply-To: <20201214174912.174065-1-jose.souza@intel.com>
References: <20201214174912.174065-1-jose.souza@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v6 2/5] drm/i915/display/psr: Use plane damage
 clips to calculate damaged area
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Tm93IHVzaW5nIHBsYW5lIGRhbWFnZSBjbGlwcyBwcm9wZXJ0eSB0byBjYWxjdWFsdGUgdGhlIGRh
bWFnZWQgYXJlYS4KU2VsZWN0aXZlIGZldGNoIG9ubHkgc3VwcG9ydHMgb25lIHJlZ2lvbiB0byBi
ZSBmZXRjaGVkIHNvIHNvZnR3YXJlCm5lZWRzIHRvIGNhbGN1bGF0ZSBhIGJvdW5kaW5nIGJveCBh
cm91bmQgYWxsIGRhbWFnZSBjbGlwcy4KCk5vdyB0aGF0IHdlIGFyZSBub3QgY29tcGxldGUgZmV0
Y2hpbmcgZWFjaCBwbGFuZSwgdGhlcmUgaXMgYW5vdGhlcgpsb29wIG5lZWRlZCBhcyBhbGwgdGhl
IHBsYW5lIGFyZWFzIHRoYXQgaW50ZXJzZWN0IHdpdGggdGhlIHBpcGUKZGFtYWdlZCBhcmVhIG5l
ZWRzIHRvIGJlIGZldGNoZWQgZnJvbSBtZW1vcnkgc28gdGhlIGNvbXBsZXRlIGJsZW5kaW5nCm9m
IGFsbCBwbGFuZXMgY2FuIGhhcHBlbi4KCnYyOgotIGRvIG5vdCBzaGlmdGhpbmcgbmV3X3BsYW5l
X3N0YXRlLT51YXBpLmRzdCBvbmx5IHNyYyBpcyBpbiAxNi4xNiBmb3JtYXQKCnY0OgotIHNldHRp
bmcgcGxhbmUgc2VsZWN0aXZlIGZldGNoIGFyZWEgdXNpbmcgdGhlIHdob2xlIHBpcGUgZGFtYWdl
IGFyZWEKLSBtYXJrIHRoZSB3aG9sZSBwbGFuZSBhcmVhIGRhbWFnZWQgaWYgcGxhbmUgdmlzaWJp
bGl0eSBvciBhbHBoYQpjaGFuZ2VkCgp2NToKLSB0YWtpbmcgaW4gY29uc2lkZXJhdGlvbiBzcmMu
eTEgaW4gdGhlIGRhbWFnZSBjb29yZGluYXRlcwotIGFkZGluZyB0byB0aGUgcGlwZSBkYW1hZ2Vk
IGFyZWEgcGxhbmVzIHRoYXQgd2VyZSB2aXNpYmxlIGJ1dCBhcmUKaW52aXNpYmxlIGluIHRoZSBu
ZXcgc3RhdGUKCnY2OgotIGNvbnNpZGVyIG9sZCBzdGF0ZSBwbGFuZSBjb29yZGluYXRlcyB3aGVu
IHZpc2liaWxpdHkgY2hhbmdlcyBvciBpdAptb3ZlZCB0byBjYWxjdWxhdGUgZGFtYWdlZCBhcmVh
Ci0gcmVtb3ZlIGZyb20gZGFtYWdlZCBhcmVhIHRoZSBwb3J0aW9uIG5vdCBpbiBzcmMgY2xpcAoK
Q2M6IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBsaW51eC5pbnRlbC5jb20+CkNjOiBH
d2FuLWd5ZW9uZyBNdW4gPGd3YW4tZ3llb25nLm11bkBpbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6
IEpvc8OpIFJvYmVydG8gZGUgU291emEgPGpvc2Uuc291emFAaW50ZWwuY29tPgotLS0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmMgfCA5OCArKysrKysrKysrKysrKysr
KysrKystLS0KIDEgZmlsZSBjaGFuZ2VkLCA4NiBpbnNlcnRpb25zKCspLCAxMiBkZWxldGlvbnMo
LSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYwppbmRleCBkOWEzOTVj
NDg2ZDMuLjdkYWVkMDk4ZmE3NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9wc3IuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X3Bzci5jCkBAIC0xMjY5LDggKzEyNjksOCBAQCBpbnQgaW50ZWxfcHNyMl9zZWxfZmV0Y2hfdXBk
YXRlKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQkJCXN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjKQogewogCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlID0gaW50
ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0ZSwgY3J0Yyk7CisJc3RydWN0IGRybV9y
ZWN0IHBpcGVfY2xpcCA9IHsgLngxID0gMCwgLnkxID0gLTEsIC54MiA9IElOVF9NQVgsIC55MiA9
IC0xIH07CiAJc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpuZXdfcGxhbmVfc3RhdGUsICpvbGRf
cGxhbmVfc3RhdGU7Ci0Jc3RydWN0IGRybV9yZWN0IHBpcGVfY2xpcCA9IHsgLnkxID0gLTEgfTsK
IAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOwogCWJvb2wgZnVsbF91cGRhdGUgPSBmYWxzZTsK
IAlpbnQgaSwgcmV0OwpAQCAtMTI4Miw5ICsxMjgyLDE3IEBAIGludCBpbnRlbF9wc3IyX3NlbF9m
ZXRjaF91cGRhdGUoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJaWYgKHJldCkK
IAkJcmV0dXJuIHJldDsKIAorCS8qCisJICogQ2FsY3VsYXRlIG1pbmltYWwgc2VsZWN0aXZlIGZl
dGNoIGFyZWEgb2YgZWFjaCBwbGFuZSBhbmQgY2FsY3VsYXRlCisJICogdGhlIHBpcGUgZGFtYWdl
ZCBhcmVhLgorCSAqIEluIHRoZSBuZXh0IGxvb3AgdGhlIHBsYW5lIHNlbGVjdGl2ZSBmZXRjaCBh
cmVhIHdpbGwgYWN0dWFsbHkgYmUgc2V0CisJICogdXNpbmcgd2hvbGUgcGlwZSBkYW1hZ2VkIGFy
ZWEuCisJICovCiAJZm9yX2VhY2hfb2xkbmV3X2ludGVsX3BsYW5lX2luX3N0YXRlKHN0YXRlLCBw
bGFuZSwgb2xkX3BsYW5lX3N0YXRlLAogCQkJCQkgICAgIG5ld19wbGFuZV9zdGF0ZSwgaSkgewot
CQlzdHJ1Y3QgZHJtX3JlY3QgKnNlbF9mZXRjaF9hcmVhLCB0ZW1wOworCQlzdHJ1Y3QgZHJtX3Jl
Y3Qgc3JjLCBkYW1hZ2VkX2FyZWEgPSB7IC54MSA9IDAsIC55MSA9IC0xLCAueDIgPSBJTlRfTUFY
LCAueTIgPSAtMSB9OworCQlzdHJ1Y3QgZHJtX21vZGVfcmVjdCAqZGFtYWdlZF9jbGlwczsKKwkJ
dTMyIG51bV9jbGlwcywgajsKIAogCQlpZiAobmV3X3BsYW5lX3N0YXRlLT51YXBpLmNydGMgIT0g
Y3J0Y19zdGF0ZS0+dWFwaS5jcnRjKQogCQkJY29udGludWU7CkBAIC0xMzAwLDIzICsxMzA4LDg5
IEBAIGludCBpbnRlbF9wc3IyX3NlbF9mZXRjaF91cGRhdGUoc3RydWN0IGludGVsX2F0b21pY19z
dGF0ZSAqc3RhdGUsCiAJCQlicmVhazsKIAkJfQogCi0JCWlmICghbmV3X3BsYW5lX3N0YXRlLT51
YXBpLnZpc2libGUpCi0JCQljb250aW51ZTsKKwkJZHJtX3JlY3RfY29udmVydF8xNl8xNl90b19y
ZWd1bGFyKCZuZXdfcGxhbmVfc3RhdGUtPnVhcGkuc3JjLCAmc3JjKTsKKwkJZGFtYWdlZF9jbGlw
cyA9IGRybV9wbGFuZV9nZXRfZGFtYWdlX2NsaXBzKCZuZXdfcGxhbmVfc3RhdGUtPnVhcGkpOwor
CQludW1fY2xpcHMgPSBkcm1fcGxhbmVfZ2V0X2RhbWFnZV9jbGlwc19jb3VudCgmbmV3X3BsYW5l
X3N0YXRlLT51YXBpKTsKIAogCQkvKgotCQkgKiBGb3Igbm93IGRvaW5nIGEgc2VsZWN0aXZlIGZl
dGNoIGluIHRoZSB3aG9sZSBwbGFuZSBhcmVhLAotCQkgKiBvcHRpbWl6YXRpb25zIHdpbGwgY29t
ZSBpbiB0aGUgZnV0dXJlLgorCQkgKiBJZiB2aXNpYmlsaXR5IG9yIHBsYW5lIG1vdmVkLCBtYXJr
IHRoZSB3aG9sZSBwbGFuZSBhcmVhIGFzCisJCSAqIGRhbWFnZWQgYXMgaXQgbmVlZHMgdG8gYmUg
Y29tcGxldGUgcmVkcmF3IGluIHRoZSBuZXcgYW5kIG9sZAorCQkgKiBwb3NpdGlvbi4KIAkJICov
CisJCWlmIChuZXdfcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSAhPSBvbGRfcGxhbmVfc3RhdGUt
PnVhcGkudmlzaWJsZSB8fAorCQkgICAgIWRybV9yZWN0X2VxdWFscygmbmV3X3BsYW5lX3N0YXRl
LT51YXBpLmRzdCwKKwkJCQkgICAgICZvbGRfcGxhbmVfc3RhdGUtPnVhcGkuZHN0KSkgeworCQkJ
ZGFtYWdlZF9hcmVhLnkxID0gb2xkX3BsYW5lX3N0YXRlLT51YXBpLnNyYy55MSA+PiAxNjsKKwkJ
CWRhbWFnZWRfYXJlYS55MSA9IG9sZF9wbGFuZV9zdGF0ZS0+dWFwaS5zcmMueTIgPj4gMTY7CisJ
CQlkYW1hZ2VkX2FyZWEueTEgKz0gb2xkX3BsYW5lX3N0YXRlLT51YXBpLmRzdC55MTsKKwkJCWRh
bWFnZWRfYXJlYS55MiArPSBvbGRfcGxhbmVfc3RhdGUtPnVhcGkuZHN0LnkxOworCQkJY2xpcF9h
cmVhX3VwZGF0ZSgmcGlwZV9jbGlwLCAmZGFtYWdlZF9hcmVhKTsKKworCQkJbnVtX2NsaXBzID0g
MDsKKwkJCWRhbWFnZWRfYXJlYS55MSA9IHNyYy55MTsKKwkJCWRhbWFnZWRfYXJlYS55MiA9IHNy
Yy55MjsKKwkJfSBlbHNlIGlmIChuZXdfcGxhbmVfc3RhdGUtPnVhcGkuYWxwaGEgIT0gb2xkX3Bs
YW5lX3N0YXRlLT51YXBpLmFscGhhKSB7CisJCQludW1fY2xpcHMgPSAwOworCQkJZGFtYWdlZF9h
cmVhLnkxID0gc3JjLnkxOworCQkJZGFtYWdlZF9hcmVhLnkyID0gc3JjLnkyOworCQl9IGVsc2Ug
aWYgKCFudW1fY2xpcHMgJiYKKwkJCSAgIG5ld19wbGFuZV9zdGF0ZS0+dWFwaS5mYiAhPSBvbGRf
cGxhbmVfc3RhdGUtPnVhcGkuZmIpIHsKKwkJCS8qCisJCQkgKiBJZiB0aGUgcGxhbmUgZG9uJ3Qg
aGF2ZSBkYW1hZ2UgYXJlYXMgYnV0IHRoZQorCQkJICogZnJhbWVidWZmZXIgY2hhbmdlZCwgbWFy
ayB0aGUgd2hvbGUgcGxhbmUgYXJlYSBhcworCQkJICogZGFtYWdlZC4KKwkJCSAqLworCQkJZGFt
YWdlZF9hcmVhLnkxID0gc3JjLnkxOworCQkJZGFtYWdlZF9hcmVhLnkyID0gc3JjLnkyOworCQl9
CisKKwkJZm9yIChqID0gMDsgaiA8IG51bV9jbGlwczsgaisrKSB7CisJCQlzdHJ1Y3QgZHJtX3Jl
Y3QgY2xpcDsKKworCQkJY2xpcC55MSA9IGRhbWFnZWRfY2xpcHNbal0ueTE7CisJCQljbGlwLnky
ID0gZGFtYWdlZF9jbGlwc1tqXS55MjsKKwkJCWNsaXBfYXJlYV91cGRhdGUoJmRhbWFnZWRfYXJl
YSwgJmNsaXApOworCQl9CisKKwkJaWYgKCFkcm1fcmVjdF9pbnRlcnNlY3QoJmRhbWFnZWRfYXJl
YSwgJnNyYykpCisJCQljb250aW51ZTsKKworCQlkYW1hZ2VkX2FyZWEueTEgKz0gbmV3X3BsYW5l
X3N0YXRlLT51YXBpLmRzdC55MTsKKwkJZGFtYWdlZF9hcmVhLnkyICs9IG5ld19wbGFuZV9zdGF0
ZS0+dWFwaS5kc3QueTE7CisJCWNsaXBfYXJlYV91cGRhdGUoJnBpcGVfY2xpcCwgJmRhbWFnZWRf
YXJlYSk7CisJfQorCisJaWYgKGZ1bGxfdXBkYXRlKQorCQlnb3RvIHNraXBfc2VsX2ZldGNoX3Nl
dF9sb29wOworCisJLyoKKwkgKiBOb3cgdGhhdCB3ZSBoYXZlIHRoZSBwaXBlIGRhbWFnZWQgYXJl
YSBjaGVjayBpZiBpdCBpbnRlcnNlY3Qgd2l0aAorCSAqIGV2ZXJ5IHBsYW5lLCBpZiBpdCBkb2Vz
IHNldCB0aGUgcGxhbmUgc2VsZWN0aXZlIGZldGNoIGFyZWEuCisJICovCisJZm9yX2VhY2hfb2xk
bmV3X2ludGVsX3BsYW5lX2luX3N0YXRlKHN0YXRlLCBwbGFuZSwgb2xkX3BsYW5lX3N0YXRlLAor
CQkJCQkgICAgIG5ld19wbGFuZV9zdGF0ZSwgaSkgeworCQlzdHJ1Y3QgZHJtX3JlY3QgKnNlbF9m
ZXRjaF9hcmVhLCBpbnRlciwgc3JjOworCisJCWlmIChuZXdfcGxhbmVfc3RhdGUtPnVhcGkuY3J0
YyAhPSBjcnRjX3N0YXRlLT51YXBpLmNydGMgfHwKKwkJICAgICFuZXdfcGxhbmVfc3RhdGUtPnVh
cGkudmlzaWJsZSkKKwkJCWNvbnRpbnVlOworCisJCWludGVyID0gcGlwZV9jbGlwOworCQlpZiAo
IWRybV9yZWN0X2ludGVyc2VjdCgmaW50ZXIsICZuZXdfcGxhbmVfc3RhdGUtPnVhcGkuZHN0KSkK
KwkJCWNvbnRpbnVlOworCisJCWRybV9yZWN0X2NvbnZlcnRfMTZfMTZfdG9fcmVndWxhcigmbmV3
X3BsYW5lX3N0YXRlLT51YXBpLnNyYywgJnNyYyk7CisKIAkJc2VsX2ZldGNoX2FyZWEgPSAmbmV3
X3BsYW5lX3N0YXRlLT5wc3IyX3NlbF9mZXRjaF9hcmVhOwotCQlzZWxfZmV0Y2hfYXJlYS0+eTEg
PSBuZXdfcGxhbmVfc3RhdGUtPnVhcGkuc3JjLnkxID4+IDE2OwotCQlzZWxfZmV0Y2hfYXJlYS0+
eTIgPSBuZXdfcGxhbmVfc3RhdGUtPnVhcGkuc3JjLnkyID4+IDE2OworCQlzZWxfZmV0Y2hfYXJl
YS0+eTEgPSBpbnRlci55MSAtIG5ld19wbGFuZV9zdGF0ZS0+dWFwaS5kc3QueTE7CisJCXNlbF9m
ZXRjaF9hcmVhLT55MiA9IGludGVyLnkyIC0gbmV3X3BsYW5lX3N0YXRlLT51YXBpLmRzdC55MTsK
KwkJc2VsX2ZldGNoX2FyZWEtPngxID0gc3JjLngxOworCQlzZWxfZmV0Y2hfYXJlYS0+eDIgPSBz
cmMueDI7CiAKLQkJdGVtcCA9ICpzZWxfZmV0Y2hfYXJlYTsKLQkJdGVtcC55MSArPSBuZXdfcGxh
bmVfc3RhdGUtPnVhcGkuZHN0LnkxOwotCQl0ZW1wLnkyICs9IG5ld19wbGFuZV9zdGF0ZS0+dWFw
aS5kc3QueTI7Ci0JCWNsaXBfYXJlYV91cGRhdGUoJnBpcGVfY2xpcCwgJnRlbXApOworCQlkcm1f
cmVjdF9pbnRlcnNlY3Qoc2VsX2ZldGNoX2FyZWEsICZzcmMpOwogCX0KIAorc2tpcF9zZWxfZmV0
Y2hfc2V0X2xvb3A6CiAJcHNyMl9tYW5fdHJrX2N0bF9jYWxjKGNydGNfc3RhdGUsICZwaXBlX2Ns
aXAsIGZ1bGxfdXBkYXRlKTsKIAlyZXR1cm4gMDsKIH0KLS0gCjIuMjkuMgoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlz
dApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 4C379F8BB1
	for <lists+intel-gfx@lfdr.de>; Tue, 12 Nov 2019 10:29:26 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 441106EA9F;
	Tue, 12 Nov 2019 09:29:17 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0D0316EA98
 for <intel-gfx@lists.freedesktop.org>; Tue, 12 Nov 2019 09:29:13 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19170032-1500050 
 for multiple; Tue, 12 Nov 2019 09:29:00 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 12 Nov 2019 09:28:53 +0000
Message-Id: <20191112092854.869-26-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191112092854.869-1-chris@chris-wilson.co.uk>
References: <20191112092854.869-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 26/27] drm/i915/gt: Refactor mocs loops into
 single control macro
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgcmVwZWF0ZWRseSAoYW5kIG1vcmUgc28gaW4gZnV0dXJlKSB1c2UgdGhlIHNhbWUgbG9vcGlu
ZyBjb25zdHJ1Y3QKb3ZlciB0aGUgbW9jcyBkZWZpbml0aW9uIHRhYmxlIHRvIHNldHVwIHRoZSBy
ZWdpc3RlciBzdGF0ZS4gUmVmYWN0b3IgdGhlCmxvb3AgY29uc3RydWN0IGludG8gYSByZXVzYWJs
ZSBtYWNyby4KCmFkZC9yZW1vdmU6IDIvMSBncm93L3NocmluazogMS8yIHVwL2Rvd246IDExMy8t
MzMwICgtMjE3KQpGdW5jdGlvbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBv
bGQgICAgIG5ldyAgIGRlbHRhCmludGVsX21vY3NfaW5pdF9lbmdpbmUuY29sZCAgICAgICAgICAg
ICAgICAgICAgLSAgICAgIDcxICAgICArNzEKb2Zmc2V0ICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAtICAgICAgMjggICAgICsyOApfX2Z1bmNfXyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgMTcyNzMgICAxNzI4NyAgICAgKzE0CmludGVsX21vY3NfaW5p
dCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDE0MyAgICAgMTEzICAgICAtMzAKbW9jc19y
ZWdpc3Rlci5pc3JhICAgICAgICAgICAgICAgICAgICAgICAgICAgIDkxICAgICAgIC0gICAgIC05
MQppbnRlbF9tb2NzX2luaXRfZW5naW5lICAgICAgICAgICAgICAgICAgICAgICA1MDMgICAgIDI5
NCAgICAtMjA5CgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNv
bi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9tb2NzLmMgfCAxMjgg
KysrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgNDcgaW5zZXJ0aW9u
cygrKSwgODEgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfbW9jcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbW9jcy5jCmlu
ZGV4IGU2ZjNmMzZhMzk4OC4uNjNkMGZkZjY3MjE1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9tb2NzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfbW9jcy5jCkBAIC0zMjksMjcgKzMyOSw2IEBAIHN0YXRpYyBib29sIGdldF9tb2NzX3NldHRp
bmdzKGNvbnN0IHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCXJldHVybiB0cnVlOwog
fQogCi1zdGF0aWMgaTkxNV9yZWdfdCBtb2NzX3JlZ2lzdGVyKGNvbnN0IHN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZSwgaW50IGluZGV4KQotewotCXN3aXRjaCAoZW5naW5lLT5pZCkgewot
CWNhc2UgUkNTMDoKLQkJcmV0dXJuIEdFTjlfR0ZYX01PQ1MoaW5kZXgpOwotCWNhc2UgVkNTMDoK
LQkJcmV0dXJuIEdFTjlfTUZYMF9NT0NTKGluZGV4KTsKLQljYXNlIEJDUzA6Ci0JCXJldHVybiBH
RU45X0JMVF9NT0NTKGluZGV4KTsKLQljYXNlIFZFQ1MwOgotCQlyZXR1cm4gR0VOOV9WRUJPWF9N
T0NTKGluZGV4KTsKLQljYXNlIFZDUzE6Ci0JCXJldHVybiBHRU45X01GWDFfTU9DUyhpbmRleCk7
Ci0JY2FzZSBWQ1MyOgotCQlyZXR1cm4gR0VOMTFfTUZYMl9NT0NTKGluZGV4KTsKLQlkZWZhdWx0
OgotCQlNSVNTSU5HX0NBU0UoZW5naW5lLT5pZCk7Ci0JCXJldHVybiBJTlZBTElEX01NSU9fUkVH
OwotCX0KLX0KLQogLyoKICAqIEdldCBjb250cm9sX3ZhbHVlIGZyb20gTU9DUyBlbnRyeSB0YWtp
bmcgaW50byBhY2NvdW50IHdoZW4gaXQncyBub3QgdXNlZDoKICAqIEk5MTVfTU9DU19QVEUncyB2
YWx1ZSBpcyByZXR1cm5lZCBpbiB0aGlzIGNhc2UuCkBAIC0zNTcsMjkgKzMzNiw0NyBAQCBzdGF0
aWMgaTkxNV9yZWdfdCBtb2NzX3JlZ2lzdGVyKGNvbnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZSwgaW50IGluZGV4KQogc3RhdGljIHUzMiBnZXRfZW50cnlfY29udHJvbChjb25zdCBz
dHJ1Y3QgZHJtX2k5MTVfbW9jc190YWJsZSAqdGFibGUsCiAJCQkgICAgIHVuc2lnbmVkIGludCBp
bmRleCkKIHsKLQlpZiAodGFibGUtPnRhYmxlW2luZGV4XS51c2VkKQorCWlmIChpbmRleCA8IHRh
YmxlLT5zaXplICYmIHRhYmxlLT50YWJsZVtpbmRleF0udXNlZCkKIAkJcmV0dXJuIHRhYmxlLT50
YWJsZVtpbmRleF0uY29udHJvbF92YWx1ZTsKIAogCXJldHVybiB0YWJsZS0+dGFibGVbSTkxNV9N
T0NTX1BURV0uY29udHJvbF92YWx1ZTsKIH0KIAotc3RhdGljIHZvaWQgaW5pdF9tb2NzX3RhYmxl
KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKLQkJCSAgICBjb25zdCBzdHJ1Y3QgZHJt
X2k5MTVfbW9jc190YWJsZSAqdGFibGUpCisjZGVmaW5lIGZvcl9lYWNoX21vY3MobW9jcywgdCwg
aSkgXAorCWZvciAoaSA9IDA7IFwKKwkgICAgIGkgPCB0LT5uX2VudHJpZXMgPyAobW9jcyA9IGdl
dF9lbnRyeV9jb250cm9sKHQsIGkpKSwgMSA6IDA7XAorCSAgICAgaSsrKQorCitzdGF0aWMgdm9p
ZCBfX2luaXRfbW9jc190YWJsZShzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUsCisJCQkgICAg
ICBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfbW9jc190YWJsZSAqdGFibGUsCisJCQkgICAgICB1MzIg
YWRkcikKIHsKLQlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSBlbmdpbmUtPnVuY29yZTsK
LQl1MzIgdW51c2VkX3ZhbHVlID0gdGFibGUtPnRhYmxlW0k5MTVfTU9DU19QVEVdLmNvbnRyb2xf
dmFsdWU7CiAJdW5zaWduZWQgaW50IGk7CisJdTMyIG1vY3M7CisKKwlmb3JfZWFjaF9tb2NzKG1v
Y3MsIHRhYmxlLCBpKQorCQlpbnRlbF91bmNvcmVfd3JpdGVfZncodW5jb3JlLCBfTU1JTyhhZGRy
ICsgaSAqIDQpLCBtb2NzKTsKK30KIAotCWZvciAoaSA9IDA7IGkgPCB0YWJsZS0+c2l6ZTsgaSsr
KQotCQlpbnRlbF91bmNvcmVfd3JpdGVfZncodW5jb3JlLAotCQkJCSAgICAgIG1vY3NfcmVnaXN0
ZXIoZW5naW5lLCBpKSwKLQkJCQkgICAgICBnZXRfZW50cnlfY29udHJvbCh0YWJsZSwgaSkpOwor
c3RhdGljIHUzMiBtb2NzX3JlZ2lzdGVyKGNvbnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSkKK3sKKwlzdGF0aWMgY29uc3QgdTMyIG9mZnNldFtdID0geworCQlbUkNTMF0gID0gMHgw
YzgwMCwKKwkJW1ZDUzBdICA9IDB4MGM5MDAsCisJCVtWQ1MxXSAgPSAweDBjYTAwLAorCQlbVkVD
UzBdID0gMHgwY2IwMCwKKwkJW0JDUzBdICA9IDB4MGNjMDAsCisJCVtWQ1MyXSAgPSAweDEwMDAw
LAorCX07CisKKwlHRU1fQlVHX09OKGVuZ2luZS0+aWQgPiBBUlJBWV9TSVpFKG9mZnNldCkpOwor
CXJldHVybiBvZmZzZXRbZW5naW5lLT5pZF07Cit9CiAKLQkvKiBBbGwgcmVtYWluaW5nIGVudHJp
ZXMgYXJlIHVudXNlZCAqLwotCWZvciAoOyBpIDwgdGFibGUtPm5fZW50cmllczsgaSsrKQotCQlp
bnRlbF91bmNvcmVfd3JpdGVfZncodW5jb3JlLAotCQkJCSAgICAgIG1vY3NfcmVnaXN0ZXIoZW5n
aW5lLCBpKSwKLQkJCQkgICAgICB1bnVzZWRfdmFsdWUpOworc3RhdGljIHZvaWQgaW5pdF9tb2Nz
X3RhYmxlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKKwkJCSAgICBjb25zdCBzdHJ1
Y3QgZHJtX2k5MTVfbW9jc190YWJsZSAqdGFibGUpCit7CisJX19pbml0X21vY3NfdGFibGUoZW5n
aW5lLT51bmNvcmUsIHRhYmxlLCBtb2NzX3JlZ2lzdGVyKGVuZ2luZSkpOwogfQogCiAvKgpAQCAt
Mzg5LDcgKzM4Niw3IEBAIHN0YXRpYyB2b2lkIGluaXRfbW9jc190YWJsZShzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmUsCiBzdGF0aWMgdTE2IGdldF9lbnRyeV9sM2NjKGNvbnN0IHN0cnVj
dCBkcm1faTkxNV9tb2NzX3RhYmxlICp0YWJsZSwKIAkJCSAgdW5zaWduZWQgaW50IGluZGV4KQog
ewotCWlmICh0YWJsZS0+dGFibGVbaW5kZXhdLnVzZWQpCisJaWYgKGluZGV4IDwgdGFibGUtPnNp
emUgJiYgdGFibGUtPnRhYmxlW2luZGV4XS51c2VkKQogCQlyZXR1cm4gdGFibGUtPnRhYmxlW2lu
ZGV4XS5sM2NjX3ZhbHVlOwogCiAJcmV0dXJuIHRhYmxlLT50YWJsZVtJOTE1X01PQ1NfUFRFXS5s
M2NjX3ZhbHVlOwpAQCAtNDAwLDM3ICszOTcsMjMgQEAgc3RhdGljIGlubGluZSB1MzIgbDNjY19j
b21iaW5lKHUxNiBsb3csIHUxNiBoaWdoKQogCXJldHVybiBsb3cgfCAodTMyKWhpZ2ggPDwgMTY7
CiB9CiAKKyNkZWZpbmUgZm9yX2VhY2hfbDNjYyhsM2NjLCB0LCBpKSBcCisJZm9yIChpID0gMDsg
XAorCSAgICAgaSA8ICh0LT5uX2VudHJpZXMgKyAxKSAvIDIgPyBcCisJICAgICAobDNjYyA9IGwz
Y2NfY29tYmluZShnZXRfZW50cnlfbDNjYyh0LCAyICogaSksIFwKKwkJCQkgIGdldF9lbnRyeV9s
M2NjKHQsIDIgKiBpICsgMSkpKSwgMSA6IFwKKwkgICAgIDA7IFwKKwkgICAgIGkrKykKKwogc3Rh
dGljIHZvaWQgaW5pdF9sM2NjX3RhYmxlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwK
IAkJCSAgICBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfbW9jc190YWJsZSAqdGFibGUpCiB7CiAJc3Ry
dWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gZW5naW5lLT51bmNvcmU7Ci0JdTE2IHVudXNlZF92
YWx1ZSA9IHRhYmxlLT50YWJsZVtJOTE1X01PQ1NfUFRFXS5sM2NjX3ZhbHVlOwogCXVuc2lnbmVk
IGludCBpOworCXUzMiBsM2NjOwogCi0JZm9yIChpID0gMDsgaSA8IHRhYmxlLT5zaXplIC8gMjsg
aSsrKSB7Ci0JCXUxNiBsb3cgPSBnZXRfZW50cnlfbDNjYyh0YWJsZSwgMiAqIGkpOwotCQl1MTYg
aGlnaCA9IGdldF9lbnRyeV9sM2NjKHRhYmxlLCAyICogaSArIDEpOwotCi0JCWludGVsX3VuY29y
ZV93cml0ZSh1bmNvcmUsCi0JCQkJICAgR0VOOV9MTkNGQ01PQ1MoaSksCi0JCQkJICAgbDNjY19j
b21iaW5lKGxvdywgaGlnaCkpOwotCX0KLQotCS8qIE9kZCB0YWJsZSBzaXplIC0gMSBsZWZ0IG92
ZXIgKi8KLQlpZiAodGFibGUtPnNpemUgJiAxKSB7Ci0JCXUxNiBsb3cgPSBnZXRfZW50cnlfbDNj
Yyh0YWJsZSwgMiAqIGkpOwotCi0JCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsCi0JCQkJICAg
R0VOOV9MTkNGQ01PQ1MoaSksCi0JCQkJICAgbDNjY19jb21iaW5lKGxvdywgdW51c2VkX3ZhbHVl
KSk7Ci0JCWkrKzsKLQl9Ci0KLQkvKiBBbGwgcmVtYWluaW5nIGVudHJpZXMgYXJlIGFsc28gdW51
c2VkICovCi0JZm9yICg7IGkgPCB0YWJsZS0+bl9lbnRyaWVzIC8gMjsgaSsrKQotCQlpbnRlbF91
bmNvcmVfd3JpdGUodW5jb3JlLAotCQkJCSAgIEdFTjlfTE5DRkNNT0NTKGkpLAotCQkJCSAgIGwz
Y2NfY29tYmluZSh1bnVzZWRfdmFsdWUsIHVudXNlZF92YWx1ZSkpOworCWZvcl9lYWNoX2wzY2Mo
bDNjYywgdGFibGUsIGkpCisJCWludGVsX3VuY29yZV93cml0ZV9mdyh1bmNvcmUsIEdFTjlfTE5D
RkNNT0NTKGkpLCBsM2NjKTsKIH0KIAogdm9pZCBpbnRlbF9tb2NzX2luaXRfZW5naW5lKHN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKQEAgLTQ1MSwxMSArNDM0LDkgQEAgdm9pZCBpbnRl
bF9tb2NzX2luaXRfZW5naW5lKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAkJaW5p
dF9sM2NjX3RhYmxlKGVuZ2luZSwgJnRhYmxlKTsKIH0KIAotc3RhdGljIHZvaWQgaW50ZWxfbW9j
c19pbml0X2dsb2JhbChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQorc3RhdGljIHZvaWQgaW5pdF9nbG9i
YWxfbW9jcyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogewotCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVu
Y29yZSA9IGd0LT51bmNvcmU7CiAJc3RydWN0IGRybV9pOTE1X21vY3NfdGFibGUgdGFibGU7Ci0J
dW5zaWduZWQgaW50IGluZGV4OwogCiAJLyoKIAkgKiBMTEMgYW5kIGVEUkFNIGNvbnRyb2wgdmFs
dWVzIGFyZSBub3QgYXBwbGljYWJsZSB0byBkZ2Z4CkBAIC00NjMsMjkgKzQ0NCwxNCBAQCBzdGF0
aWMgdm9pZCBpbnRlbF9tb2NzX2luaXRfZ2xvYmFsKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAJaWYg
KElTX0RHRlgoZ3QtPmk5MTUpKQogCQlyZXR1cm47CiAKLQlHRU1fQlVHX09OKCFIQVNfR0xPQkFM
X01PQ1NfUkVHSVNURVJTKGd0LT5pOTE1KSk7Ci0KIAlpZiAoIWdldF9tb2NzX3NldHRpbmdzKGd0
LT5pOTE1LCAmdGFibGUpKQogCQlyZXR1cm47CiAKLQlmb3IgKGluZGV4ID0gMDsgaW5kZXggPCB0
YWJsZS5zaXplOyBpbmRleCsrKQotCQlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLAotCQkJCSAg
IEdFTjEyX0dMT0JBTF9NT0NTKGluZGV4KSwKLQkJCQkgICB0YWJsZS50YWJsZVtpbmRleF0uY29u
dHJvbF92YWx1ZSk7Ci0KLQkvKgotCSAqIE9rLCBub3cgc2V0IHRoZSB1bnVzZWQgZW50cmllcyB0
byB0aGUgaW52YWxpZCBlbnRyeSAoaW5kZXggMCkuIFRoZXNlCi0JICogZW50cmllcyBhcmUgb2Zm
aWNpYWxseSB1bmRlZmluZWQgYW5kIG5vIGNvbnRyYWN0IGZvciB0aGUgY29udGVudHMgYW5kCi0J
ICogc2V0dGluZ3MgaXMgZ2l2ZW4gZm9yIHRoZXNlIGVudHJpZXMuCi0JICovCi0JZm9yICg7IGlu
ZGV4IDwgdGFibGUubl9lbnRyaWVzOyBpbmRleCsrKQotCQlpbnRlbF91bmNvcmVfd3JpdGUodW5j
b3JlLAotCQkJCSAgIEdFTjEyX0dMT0JBTF9NT0NTKGluZGV4KSwKLQkJCQkgICB0YWJsZS50YWJs
ZVtJOTE1X01PQ1NfUFRFXS5jb250cm9sX3ZhbHVlKTsKKwlfX2luaXRfbW9jc190YWJsZShndC0+
dW5jb3JlLCAmdGFibGUsIDB4NDAwMCk7CiB9CiAKIHZvaWQgaW50ZWxfbW9jc19pbml0KHN0cnVj
dCBpbnRlbF9ndCAqZ3QpCiB7CiAJaWYgKEhBU19HTE9CQUxfTU9DU19SRUdJU1RFUlMoZ3QtPmk5
MTUpKQotCQlpbnRlbF9tb2NzX2luaXRfZ2xvYmFsKGd0KTsKKwkJaW5pdF9nbG9iYWxfbW9jcyhn
dCk7CiB9Ci0tIAoyLjI0LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2lu
dGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 28420AC8A9
	for <lists+intel-gfx@lfdr.de>; Sat,  7 Sep 2019 20:13:11 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 77B8689E1D;
	Sat,  7 Sep 2019 18:13:09 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A52EF89E0C;
 Sat,  7 Sep 2019 18:13:07 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18410752-1500050 
 for multiple; Sat, 07 Sep 2019 19:12:59 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sat,  7 Sep 2019 19:12:56 +0100
Message-Id: <20190907181257.23556-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t 1/2] tools/l3_parity: Unnest exit handlers
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIGN1cnNlIG9mIHVzaW5nIGxpYmlndCB3aGVyZSBpdCBpcyBub3Qgd2FudGVkOyBpbiB0aGlz
IGNhc2UgY2FsbGluZwpkcm9wLWNhY2hlcyB3aGlsZSB3ZSBob2xkIHRoZSBmb3JjZXdha2UgaXMg
YSByZWNpcGUgZm9yIGEgbG9uZyB3YWl0LgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxj
aHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0tLQogdG9vbHMvaW50ZWxfbDNfcGFyaXR5LmMgfCA1
MCArKysrKysrKysrKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5n
ZWQsIDI5IGluc2VydGlvbnMoKyksIDIxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL3Rvb2xz
L2ludGVsX2wzX3Bhcml0eS5jIGIvdG9vbHMvaW50ZWxfbDNfcGFyaXR5LmMKaW5kZXggMDZhMTg1
YzkxLi4zNDBmOTRiMWEgMTAwNjQ0Ci0tLSBhL3Rvb2xzL2ludGVsX2wzX3Bhcml0eS5jCisrKyBi
L3Rvb2xzL2ludGVsX2wzX3Bhcml0eS5jCkBAIC0xODAsNiArMTgwLDcgQEAgaW50IG1haW4oaW50
IGFyZ2MsIGNoYXIgKmFyZ3ZbXSkKIAljb25zdCBjaGFyICpwYXRoW1JFQUxfTUFYX1NMSUNFU10g
PSB7ImwzX3Bhcml0eSIsICJsM19wYXJpdHlfc2xpY2VfMSJ9OwogCWludCByb3cgPSAwLCBiYW5r
ID0gMCwgc2JhbmsgPSAwOwogCWludCBmZFtSRUFMX01BWF9TTElDRVNdID0gezB9LCByZXQsIGk7
CisJaW50IGV4aXRjb2RlID0gRVhJVF9GQUlMVVJFOwogCWludCBhY3Rpb24gPSAnMCc7CiAJaW50
IGRhZW1vbml6ZSA9IDA7CiAJaW50IGRldmljZSwgZGlyOwpAQCAtMTk4LDEzICsxOTksMTMgQEAg
aW50IG1haW4oaW50IGFyZ2MsIGNoYXIgKmFyZ3ZbXSkKIAkJZmRbaV0gPSBvcGVuYXQoZGlyLCBw
YXRoW2ldLCBPX1JEV1IpOwogCQlpZiAoZmRbaV0gPCAwKSB7CiAJCQlpZiAoaSA9PSAwKSAvKiBh
dCBsZWFzdCBvbmUgc2xpY2UgbXVzdCBiZSBzdXBwb3J0ZWQgKi8KLQkJCQlleGl0KDc3KTsKKwkJ
CQlnb3RvIHNraXA7CiAJCQljb250aW51ZTsKIAkJfQogCiAJCWlmIChyZWFkKGZkW2ldLCBsM2xv
Z3NbaV0sIE5VTV9SRUdTICogc2l6ZW9mKHVpbnQzMl90KSkgPCAwKSB7CiAJCQlwZXJyb3IocGF0
aFtpXSk7Ci0JCQlleGl0KDc3KTsKKwkJCWdvdG8gc2tpcDsKIAkJfQogCQlhc3NlcnQobHNlZWso
ZmRbaV0sIDAsIFNFRUtfU0VUKSA9PSAwKTsKIAl9CkBAIC0yNTIsNDUgKzI1Myw0NSBAQCBpbnQg
bWFpbihpbnQgYXJnYywgY2hhciAqYXJndltdKQogCQkJY2FzZSAnPyc6CiAJCQljYXNlICdoJzoK
IAkJCQl1c2FnZShhcmd2WzBdKTsKLQkJCQlleGl0KEVYSVRfU1VDQ0VTUyk7CisJCQkJZ290byBz
dWNjZXNzOwogCQkJY2FzZSAnSCc6CiAJCQkJcHJpbnRmKCJOdW1iZXIgb2Ygc2xpY2VzOiAlZFxu
IiwgTUFYX1NMSUNFUyk7CiAJCQkJcHJpbnRmKCJOdW1iZXIgb2YgYmFua3M6ICVkXG4iLCBudW1f
YmFua3MoKSk7CiAJCQkJcHJpbnRmKCJTdWJiYW5rcyBwZXIgYmFuazogJWRcbiIsIE5VTV9TVUJC
QU5LUyk7CiAJCQkJcHJpbnRmKCJNYXggTDMgc2l6ZTogJWRLXG4iLCBMM19TSVpFID4+IDEwKTsK
IAkJCQlwcmludGYoIkhhcyBlcnJvciBpbmplY3Rpb246ICVzXG4iLCBJU19IQVNXRUxMKGRldmlk
KSA/ICJ5ZXMiIDogIm5vIik7Ci0JCQkJZXhpdChFWElUX1NVQ0NFU1MpOworCQkJCWdvdG8gc3Vj
Y2VzczsKIAkJCWNhc2UgJ3InOgogCQkJCXJvdyA9IGF0b2kob3B0YXJnKTsKIAkJCQlpZiAocm93
ID49IE1BWF9ST1cpCi0JCQkJCWV4aXQoRVhJVF9GQUlMVVJFKTsKKwkJCQkJZ290byBmYWlsdXJl
OwogCQkJCWJyZWFrOwogCQkJY2FzZSAnYic6CiAJCQkJYmFuayA9IGF0b2kob3B0YXJnKTsKIAkJ
CQlpZiAoYmFuayA+PSBudW1fYmFua3MoKSB8fCBiYW5rID49IE1BWF9CQU5LU19QRVJfU0xJQ0Up
Ci0JCQkJCWV4aXQoRVhJVF9GQUlMVVJFKTsKKwkJCQkJZ290byBmYWlsdXJlOwogCQkJCWJyZWFr
OwogCQkJY2FzZSAncyc6CiAJCQkJc2JhbmsgPSBhdG9pKG9wdGFyZyk7CiAJCQkJaWYgKHNiYW5r
ID49IE5VTV9TVUJCQU5LUykKLQkJCQkJZXhpdChFWElUX0ZBSUxVUkUpOworCQkJCQlnb3RvIGZh
aWx1cmU7CiAJCQkJYnJlYWs7CiAJCQljYXNlICd3JzoKIAkJCQl3aGljaF9zbGljZSA9IGF0b2ko
b3B0YXJnKTsKIAkJCQlpZiAod2hpY2hfc2xpY2UgPj0gTUFYX1NMSUNFUykKLQkJCQkJZXhpdChF
WElUX0ZBSUxVUkUpOworCQkJCQlnb3RvIGZhaWx1cmU7CiAJCQkJYnJlYWs7CiAJCQljYXNlICdp
JzoKIAkJCWNhc2UgJ3UnOgogCQkJCWlmICghSVNfSEFTV0VMTChkZXZpZCkpIHsKIAkJCQkJZnBy
aW50ZihzdGRlcnIsICJFcnJvciBpbmplY3Rpb24gc3VwcG9ydGVkIG9uIEhTVysgb25seVxuIik7
Ci0JCQkJCWV4aXQoRVhJVF9GQUlMVVJFKTsKKwkJCQkJZ290byBmYWlsdXJlOwogCQkJCX0KIAkJ
CWNhc2UgJ2QnOgogCQkJCWlmIChvcHRhcmcpIHsKIAkJCQkJcmV0ID0gc3NjYW5mKG9wdGFyZywg
IiVkLCVkLCVkIiwgJnJvdywgJmJhbmssICZzYmFuayk7CiAJCQkJCWlmIChyZXQgIT0gMykKLQkJ
CQkJCWV4aXQoRVhJVF9GQUlMVVJFKTsKKwkJCQkJCWdvdG8gZmFpbHVyZTsKIAkJCQl9CiAJCQlj
YXNlICdhJzoKIAkJCWNhc2UgJ2wnOgpAQCAtMjk4LDI0ICsyOTksMjQgQEAgaW50IG1haW4oaW50
IGFyZ2MsIGNoYXIgKmFyZ3ZbXSkKIAkJCWNhc2UgJ0wnOgogCQkJCWlmIChhY3Rpb24gIT0gJzAn
KSB7CiAJCQkJCWZwcmludGYoc3RkZXJyLCAiT25seSBvbmUgYWN0aW9uIG1heSBiZSBzcGVjaWZp
ZWRcbiIpOwotCQkJCQlleGl0KEVYSVRfRkFJTFVSRSk7CisJCQkJCWdvdG8gZmFpbHVyZTsKIAkJ
CQl9CiAJCQkJYWN0aW9uID0gYzsKIAkJCQlicmVhazsKIAkJCWRlZmF1bHQ6Ci0JCQkJYWJvcnQo
KTsKKwkJCQlnb3RvIGZhaWx1cmU7CiAJCX0KIAl9CiAKIAlpZiAoYWN0aW9uID09ICdpJykgewog
CQlpZiAoKChkZnQgPj4gMSkgJiAxKSAhPSB3aGljaF9zbGljZSkgewogCQkJZnByaW50ZihzdGRl
cnIsICJERlQgcmVnaXN0ZXIgYWxyZWFkeSBoYXMgc2xpY2UgJWQgZW5hYmxlZCwgYW5kIHdlIGRv
bid0IHN1cHBvcnQgbXVsdGlwbGUgc2xpY2VzLiBUcnkgbW9kaWZ5aW5nIC13OyBidXQgc29tZXRp
bWVzIHRoZSByZWdpc3RlciBzdGlja3MgaW4gdGhlIHdyb25nIHdheVxuIiwgKGRmdCA+PiAxKSAm
IDEpOwotCQkJZXhpdChFWElUX0ZBSUxVUkUpOworCQkJZ290byBmYWlsdXJlOwogCQl9CiAKIAkJ
aWYgKHdoaWNoX3NsaWNlID09IC0xKSB7CiAJCQlmcHJpbnRmKHN0ZGVyciwgIkNhbm5vdCBpbmpl
Y3QgZXJyb3JzIHRvIG11bHRpcGxlIHNsaWNlcyAobW9kaWZ5IC13KVxuIik7Ci0JCQlleGl0KEVY
SVRfRkFJTFVSRSk7CisJCQlnb3RvIGZhaWx1cmU7CiAJCX0KIAkJaWYgKGRmdCAmIDEgJiYgKChk
ZnQgPj4gMSkgJiYgMSkgPT0gd2hpY2hfc2xpY2UpCiAJCQlwcmludGYoIndhcm5pbmc6IG92ZXJ3
cml0aW5nIGV4aXN0aW5nIGluamVjdGlvbnMuIFRoaXMgaXMgdmVyeSBkYW5nZXJvdXMuXG4iKTsK
QEAgLTMzMiw3ICszMzMsNyBAQCBpbnQgbWFpbihpbnQgYXJnYywgY2hhciAqYXJndltdKQogCQlt
ZW1zZXQoJnBhciwgMCwgc2l6ZW9mKHBhcikpOwogCQlhc3NlcnQobDNfdWV2ZW50X3NldHVwKCZw
YXIpID09IDApOwogCQlhc3NlcnQobDNfbGlzdGVuKCZwYXIsIGRhZW1vbml6ZSA9PSAxLCAmbG9j
KSA9PSAwKTsKLQkJZXhpdChFWElUX1NVQ0NFU1MpOworCQlnb3RvIHN1Y2Nlc3M7CiAJfQogCiAJ
aWYgKGFjdGlvbiA9PSAnbCcpCkBAIC0zNTksNyArMzYwLDcgQEAgaW50IG1haW4oaW50IGFyZ2Ms
IGNoYXIgKmFyZ3ZbXSkKIAkJCWNhc2UgJ2knOgogCQkJCWlmIChiYW5rID09IDMpIHsKIAkJCQkJ
ZnByaW50ZihzdGRlcnIsICJUaGUgaGFyZHdhcmUgZG9lcyBub3Qgc3VwcG9ydCBlcnJvciBpbmpl
Y3Qgb24gYmFuayAzLlxuIik7Ci0JCQkJCWV4aXQoRVhJVF9GQUlMVVJFKTsKKwkJCQkJZ290byBm
YWlsdXJlOwogCQkJCX0KIAkJCQlkZnQgfD0gcm93IDw8IDc7CiAJCQkJZGZ0IHw9IHNiYW5rIDw8
IDQ7CkBAIC0zNzUsMTMgKzM3NiwxMiBAQCBpbnQgbWFpbihpbnQgYXJnYywgY2hhciAqYXJndltd
KQogCQkJY2FzZSAnTCc6CiAJCQkJYnJlYWs7CiAJCQlkZWZhdWx0OgotCQkJCWFib3J0KCk7CisJ
CQkJZ290byBmYWlsdXJlOwogCQl9CiAJfQogCi0JaW50ZWxfcmVnaXN0ZXJfYWNjZXNzX2Zpbmko
Jm1taW9fZGF0YSk7CiAJaWYgKGFjdGlvbiA9PSAnbCcpCi0JCWV4aXQoRVhJVF9TVUNDRVNTKTsK
KwkJZ290byBzdWNjZXNzOwogCiAJZm9yX2VhY2hfc2xpY2UoaSkgewogCQlpZiAoZmRbaV0gPCAw
KQpAQCAtMzkwLDExICszOTAsMTkgQEAgaW50IG1haW4oaW50IGFyZ2MsIGNoYXIgKmFyZ3ZbXSkK
IAkJcmV0ID0gd3JpdGUoZmRbaV0sIGwzbG9nc1tpXSwgTlVNX1JFR1MgKiBzaXplb2YodWludDMy
X3QpKTsKIAkJaWYgKHJldCA9PSAtMSkgewogCQkJcGVycm9yKCJXcml0aW5nIHN5c2ZzIik7Ci0J
CQlleGl0KEVYSVRfRkFJTFVSRSk7CisJCQlnb3RvIGZhaWx1cmU7CiAJCX0KIAkJY2xvc2UoZmRb
aV0pOwogCX0KIAogCi0JZXhpdChFWElUX1NVQ0NFU1MpOworc3VjY2VzczoKKwlleGl0Y29kZSA9
IEVYSVRfU1VDQ0VTUzsKK2ZhaWx1cmU6CisJaW50ZWxfcmVnaXN0ZXJfYWNjZXNzX2ZpbmkoJm1t
aW9fZGF0YSk7CisJcmV0dXJuIGV4aXRjb2RlOworCitza2lwOgorCWV4aXRjb2RlID0gNzc7CisJ
Z290byBmYWlsdXJlOwogfQotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0
cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9s
aXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id B92741D2E87
	for <lists+intel-gfx@lfdr.de>; Thu, 14 May 2020 13:40:45 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 137886E32A;
	Thu, 14 May 2020 11:40:44 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga06.intel.com (mga06.intel.com [134.134.136.31])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1F7206E32A
 for <intel-gfx@lists.freedesktop.org>; Thu, 14 May 2020 11:40:42 +0000 (UTC)
IronPort-SDR: ZS3FR5YKA7+EHiWrm+e+TngBj8zpsdeINRi5+Ywx86eS4hWD7peCQDga7M8r1pkNOEebUAl96q
 ATAKo/7pkBHg==
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga005.fm.intel.com ([10.253.24.32])
 by orsmga104.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 14 May 2020 04:40:41 -0700
IronPort-SDR: ZQrhoIU41v4oAVszUTjtBLfHuv/qKIEUq4iCd8EKF5FUNo5jz6Q7cCs5jUp2lT72ZLt8Kjb+dc
 X+zAnto193XA==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.73,391,1583222400"; d="scan'208";a="464302313"
Received: from unknown (HELO amanna.iind.intel.com) ([10.223.74.53])
 by fmsmga005.fm.intel.com with ESMTP; 14 May 2020 04:40:38 -0700
From: Animesh Manna <animesh.manna@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 14 May 2020 16:57:52 +0530
Message-Id: <20200514112752.12049-1-animesh.manna@intel.com>
X-Mailer: git-send-email 2.26.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v7] drm/i915/dsb: Pre allocate and late cleanup
 of cmd buffer
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Jani Nikula <jani.nikula@intel.com>, Daniel Vetter <daniel.vetter@ffwll.ch>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UHJlLWFsbG9jYXRlIGNvbW1hbmQgYnVmZmVyIGluIGF0b21pY19jb21taXQgdXNpbmcgaW50ZWxf
ZHNiX3ByZXBhcmUKZnVuY3Rpb24gd2hpY2ggYWxzbyBpbmNsdWRlcyBwaW5uaW5nIGFuZCBtYXAg
aW4gY3B1IGRvbWFpbi4KCk5vIGZ1bmN0aW9uYWwgY2hhbmdlIGlzIGRzYiB3cml0ZS9jb21taXQg
ZnVuY3Rpb25zLgoKTm93IGRzYiBnZXQvcHV0IGZ1bmN0aW9uIGlzIHJlbW92ZWQgYW5kIHJlZi1j
b3VudCBtZWNoYW5pc20gaXMKbm90IG5lZWRlZC4gQmVsb3cgZHNiIGFwaSBhZGRlZCB0byBkbyBy
ZXNwZWN0aXZlIGpvYiBtZW50aW9uZWQKYmVsb3cuCgppbnRlbF9kc2JfcHJlcGFyZSAtIEFsbG9j
YXRlLCBwaW4gYW5kIG1hcCB0aGUgYnVmZmVyLgppbnRlbF9kc2JfY2xlYW51cCAtIFVucGluIGFu
ZCByZWxlYXNlIHRoZSBnZW0gb2JqZWN0LgoKUkZDOiBJbml0aWFsIHBhdGNoIGZvciBkZXNpZ24g
cmV2aWV3Lgp2MjogaW5jbHVkZWQgX2luaXQoKSBwYXJ0IGluIF9wcmVwYXJlKCkuIFtEYW5pZWws
IFZpbGxlXQp2MzogZHNiX2NsZWFudXAgY2FsbGVkIGFmdGVyIGNsZWFudXBfcGxhbmVzLiBbRGFu
aWVsXQp2NDogZHNiIHN0cnVjdHVyZSBpcyBtb3ZlZCB0byBpbnRlbF9jcnRjX3N0YXRlIGZyb20g
aW50ZWxfY3J0Yy4gW01hYXJ0ZW5dCnY1OiBkc2IgZ2V0L3B1dC9yZWYtY291bnQgbWVjaGFuaXNt
IHJlbW92ZWQuIFtNYWFydGVuXQp2NjogQmFzZWQgb24gcmV2aWV3IGZlZWRiYWNrIGZvbGxvd2lu
ZyBjaGFuZ2VzIGFyZSBhZGRlZCwKLSByZXBsYWNlZCBpbnRlbF9kc2Igc3RydWN0dXJlIGJ5IHBv
aW50ZXIgaW4gaW50ZWxfY3J0Y19zdGF0ZS4gW01hYXJ0ZW5dCi0gcGFzc2luZyBpbnRlbF9jcnRj
X3N0YXRlIHRvIGRzcC1hcGkgdG8gc2ltcGxpZnkgdGhlIGNvZGUuIFtNYWFydGVuXQotIGZldyBk
c2IgZnVuY3Rpb25zIHByb3RvdHlwZSBtb2RpZmllZCB0byBzaW1wbGlmeSBjb2RlLgp2NzogYWRk
ZWQgZmV3IGNvc21ldGljIGNoYW5nZXMgc3VnZ2VzdGVkIGJ5IEphbmkgYW5kIG51bGwgY2hlY2sg
Zm9yCmNydGNfc3RhdGUgaW4gZHNiX2NsZWFudXAoKSByZW1vdmVkIGFzIHN1Z2dlc3RlZCBieSBN
YWFydGVuLgoKQ2M6IE1hYXJ0ZW4gTGFua2hvcnN0IDxtYWFydGVuLmxhbmtob3JzdEBsaW51eC5p
bnRlbC5jb20+CkNjOiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwu
Y29tPgpDYzogSmFuaSBOaWt1bGEgPGphbmkubmlrdWxhQGludGVsLmNvbT4KQ2M6IERhbmllbCBW
ZXR0ZXIgPGRhbmllbC52ZXR0ZXJAZmZ3bGwuY2g+CkFja2VkLWJ5OiBEYW5pZWwgVmV0dGVyIDxk
YW5pZWwudmV0dGVyQGZmd2xsLmNoPgpTaWduZWQtb2ZmLWJ5OiBBbmltZXNoIE1hbm5hIDxhbmlt
ZXNoLm1hbm5hQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2F0b21pYy5jICAgfCAgIDMgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9jb2xvci5jICAgIHwgIDUxICsrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheS5jICB8ICA1OCArKysrLQogLi4uL2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlz
cGxheV90eXBlcy5oICAgIHwgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2RzYi5jICAgICAgfCAyNDYgKysrKysrKystLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2RzYi5oICAgICAgfCAgMTcgKy0KIDYgZmlsZXMgY2hhbmdlZCwg
MTk1IGluc2VydGlvbnMoKyksIDE4NiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYwppbmRleCBkMDQzMDU3ZDJmYTAuLjNjYjg2NmYyMmU3
NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5jCkBAIC0y
NTIsNiArMjUyLDcgQEAgaW50ZWxfY3J0Y19kdXBsaWNhdGVfc3RhdGUoc3RydWN0IGRybV9jcnRj
ICpjcnRjKQogCWNydGNfc3RhdGUtPndtLm5lZWRfcG9zdHZibF91cGRhdGUgPSBmYWxzZTsKIAlj
cnRjX3N0YXRlLT5mYl9iaXRzID0gMDsKIAljcnRjX3N0YXRlLT51cGRhdGVfcGxhbmVzID0gMDsK
KwljcnRjX3N0YXRlLT5kc2IgPSBOVUxMOwogCiAJcmV0dXJuICZjcnRjX3N0YXRlLT51YXBpOwog
fQpAQCAtMjkyLDYgKzI5Myw4IEBAIGludGVsX2NydGNfZGVzdHJveV9zdGF0ZShzdHJ1Y3QgZHJt
X2NydGMgKmNydGMsCiB7CiAJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUgPSB0
b19pbnRlbF9jcnRjX3N0YXRlKHN0YXRlKTsKIAorCWRybV9XQVJOX09OKGNydGMtPmRldiwgY3J0
Y19zdGF0ZS0+ZHNiKTsKKwogCV9fZHJtX2F0b21pY19oZWxwZXJfY3J0Y19kZXN0cm95X3N0YXRl
KCZjcnRjX3N0YXRlLT51YXBpKTsKIAlpbnRlbF9jcnRjX2ZyZWVfaHdfc3RhdGUoY3J0Y19zdGF0
ZSk7CiAJa2ZyZWUoY3J0Y19zdGF0ZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2NvbG9yLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2NvbG9yLmMKaW5kZXggOThlY2U5Y2Q3Y2RkLi5iYzA5MzQ2ODk1MDUgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY29sb3IuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NvbG9yLmMKQEAgLTcxNywxMyArNzE3LDE0IEBA
IHN0YXRpYyB2b2lkIGJkd19sb2FkX2x1dF8xMChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIHN0
YXRpYyB2b2lkIGl2Yl9sb2FkX2x1dF9leHRfbWF4KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQog
ewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFz
ZS5kZXYpOwotCXN0cnVjdCBpbnRlbF9kc2IgKmRzYiA9IGludGVsX2RzYl9nZXQoY3J0Yyk7CisJ
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUgPQorCQl0b19pbnRlbF9jcnRjX3N0
YXRlKGNydGMtPmJhc2Uuc3RhdGUpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAog
CS8qIFByb2dyYW0gdGhlIG1heCByZWdpc3RlciB0byBjbGFtcCB2YWx1ZXMgPiAxLjAuICovCi0J
aW50ZWxfZHNiX3JlZ193cml0ZShkc2IsIFBSRUNfUEFMX0VYVF9HQ19NQVgocGlwZSwgMCksIDEg
PDwgMTYpOwotCWludGVsX2RzYl9yZWdfd3JpdGUoZHNiLCBQUkVDX1BBTF9FWFRfR0NfTUFYKHBp
cGUsIDEpLCAxIDw8IDE2KTsKLQlpbnRlbF9kc2JfcmVnX3dyaXRlKGRzYiwgUFJFQ19QQUxfRVhU
X0dDX01BWChwaXBlLCAyKSwgMSA8PCAxNik7CisJaW50ZWxfZHNiX3JlZ193cml0ZShjcnRjX3N0
YXRlLCBQUkVDX1BBTF9FWFRfR0NfTUFYKHBpcGUsIDApLCAxIDw8IDE2KTsKKwlpbnRlbF9kc2Jf
cmVnX3dyaXRlKGNydGNfc3RhdGUsIFBSRUNfUEFMX0VYVF9HQ19NQVgocGlwZSwgMSksIDEgPDwg
MTYpOworCWludGVsX2RzYl9yZWdfd3JpdGUoY3J0Y19zdGF0ZSwgUFJFQ19QQUxfRVhUX0dDX01B
WChwaXBlLCAyKSwgMSA8PCAxNik7CiAKIAkvKgogCSAqIFByb2dyYW0gdGhlIGdjIG1heCAyIHJl
Z2lzdGVyIHRvIGNsYW1wIHZhbHVlcyA+IDEuMC4KQEAgLTczMSwxNSArNzMyLDEzIEBAIHN0YXRp
YyB2b2lkIGl2Yl9sb2FkX2x1dF9leHRfbWF4KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQogCSAq
IGZyb20gMy4wIHRvIDcuMAogCSAqLwogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8
IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKSB7Ci0JCWludGVsX2RzYl9yZWdfd3JpdGUoZHNiLCBQ
UkVDX1BBTF9FWFQyX0dDX01BWChwaXBlLCAwKSwKKwkJaW50ZWxfZHNiX3JlZ193cml0ZShjcnRj
X3N0YXRlLCBQUkVDX1BBTF9FWFQyX0dDX01BWChwaXBlLCAwKSwKIAkJCQkgICAgMSA8PCAxNik7
Ci0JCWludGVsX2RzYl9yZWdfd3JpdGUoZHNiLCBQUkVDX1BBTF9FWFQyX0dDX01BWChwaXBlLCAx
KSwKKwkJaW50ZWxfZHNiX3JlZ193cml0ZShjcnRjX3N0YXRlLCBQUkVDX1BBTF9FWFQyX0dDX01B
WChwaXBlLCAxKSwKIAkJCQkgICAgMSA8PCAxNik7Ci0JCWludGVsX2RzYl9yZWdfd3JpdGUoZHNi
LCBQUkVDX1BBTF9FWFQyX0dDX01BWChwaXBlLCAyKSwKKwkJaW50ZWxfZHNiX3JlZ193cml0ZShj
cnRjX3N0YXRlLCBQUkVDX1BBTF9FWFQyX0dDX01BWChwaXBlLCAyKSwKIAkJCQkgICAgMSA8PCAx
Nik7CiAJfQotCi0JaW50ZWxfZHNiX3B1dChkc2IpOwogfQogCiBzdGF0aWMgdm9pZCBpdmJfbG9h
ZF9sdXRzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQpAQCAtOTAw
LDE0ICs4OTksMTIgQEAgaWNsX2xvYWRfZ2NtYXgoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUsCiAJICAgICAgIGNvbnN0IHN0cnVjdCBkcm1fY29sb3JfbHV0ICpjb2xv
cikKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0
ZS0+dWFwaS5jcnRjKTsKLQlzdHJ1Y3QgaW50ZWxfZHNiICpkc2IgPSBpbnRlbF9kc2JfZ2V0KGNy
dGMpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAogCS8qIEZJWE1FIExVVCBlbnRy
aWVzIGFyZSAxNiBiaXQgb25seSwgc28gd2UgY2FuIHByb2cgMHhGRkZGIG1heCAqLwotCWludGVs
X2RzYl9yZWdfd3JpdGUoZHNiLCBQUkVDX1BBTF9HQ19NQVgocGlwZSwgMCksIGNvbG9yLT5yZWQp
OwotCWludGVsX2RzYl9yZWdfd3JpdGUoZHNiLCBQUkVDX1BBTF9HQ19NQVgocGlwZSwgMSksIGNv
bG9yLT5ncmVlbik7Ci0JaW50ZWxfZHNiX3JlZ193cml0ZShkc2IsIFBSRUNfUEFMX0dDX01BWChw
aXBlLCAyKSwgY29sb3ItPmJsdWUpOwotCWludGVsX2RzYl9wdXQoZHNiKTsKKwlpbnRlbF9kc2Jf
cmVnX3dyaXRlKGNydGNfc3RhdGUsIFBSRUNfUEFMX0dDX01BWChwaXBlLCAwKSwgY29sb3ItPnJl
ZCk7CisJaW50ZWxfZHNiX3JlZ193cml0ZShjcnRjX3N0YXRlLCBQUkVDX1BBTF9HQ19NQVgocGlw
ZSwgMSksIGNvbG9yLT5ncmVlbik7CisJaW50ZWxfZHNiX3JlZ193cml0ZShjcnRjX3N0YXRlLCBQ
UkVDX1BBTF9HQ19NQVgocGlwZSwgMiksIGNvbG9yLT5ibHVlKTsKIH0KIAogc3RhdGljIHZvaWQK
QEAgLTkxNiw3ICs5MTMsNiBAQCBpY2xfcHJvZ3JhbV9nYW1tYV9zdXBlcmZpbmVfc2VnbWVudChj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAljb25z
dCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmJsb2IgPSBjcnRjX3N0YXRlLT5ody5nYW1tYV9s
dXQ7CiAJY29uc3Qgc3RydWN0IGRybV9jb2xvcl9sdXQgKmx1dCA9IGJsb2ItPmRhdGE7Ci0Jc3Ry
dWN0IGludGVsX2RzYiAqZHNiID0gaW50ZWxfZHNiX2dldChjcnRjKTsKIAllbnVtIHBpcGUgcGlw
ZSA9IGNydGMtPnBpcGU7CiAJaW50IGk7CiAKQEAgLTkyNywxOSArOTIzLDE3IEBAIGljbF9wcm9n
cmFtX2dhbW1hX3N1cGVyZmluZV9zZWdtZW50KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlKQogCSAqIDkgZW50cmllcywgY29ycmVzcG9uZGluZyB0byB2YWx1ZXMgMCwg
MS8oOCAqIDEyOCAqIDI1NiksCiAJICogMi8oOCAqIDEyOCAqIDI1NikgLi4uIDgvKDggKiAxMjgg
KiAyNTYpLgogCSAqLwotCWludGVsX2RzYl9yZWdfd3JpdGUoZHNiLCBQUkVDX1BBTF9NVUxUSV9T
RUdfSU5ERVgocGlwZSksCisJaW50ZWxfZHNiX3JlZ193cml0ZShjcnRjX3N0YXRlLCBQUkVDX1BB
TF9NVUxUSV9TRUdfSU5ERVgocGlwZSksCiAJCQkgICAgUEFMX1BSRUNfQVVUT19JTkNSRU1FTlQp
OwogCiAJZm9yIChpID0gMDsgaSA8IDk7IGkrKykgewogCQljb25zdCBzdHJ1Y3QgZHJtX2NvbG9y
X2x1dCAqZW50cnkgPSAmbHV0W2ldOwogCi0JCWludGVsX2RzYl9pbmRleGVkX3JlZ193cml0ZShk
c2IsIFBSRUNfUEFMX01VTFRJX1NFR19EQVRBKHBpcGUpLAorCQlpbnRlbF9kc2JfaW5kZXhlZF9y
ZWdfd3JpdGUoY3J0Y19zdGF0ZSwgUFJFQ19QQUxfTVVMVElfU0VHX0RBVEEocGlwZSksCiAJCQkJ
CSAgICBpbGtfbHV0XzEycDRfbGR3KGVudHJ5KSk7Ci0JCWludGVsX2RzYl9pbmRleGVkX3JlZ193
cml0ZShkc2IsIFBSRUNfUEFMX01VTFRJX1NFR19EQVRBKHBpcGUpLAorCQlpbnRlbF9kc2JfaW5k
ZXhlZF9yZWdfd3JpdGUoY3J0Y19zdGF0ZSwgUFJFQ19QQUxfTVVMVElfU0VHX0RBVEEocGlwZSks
CiAJCQkJCSAgICBpbGtfbHV0XzEycDRfdWR3KGVudHJ5KSk7CiAJfQotCi0JaW50ZWxfZHNiX3B1
dChkc2IpOwogfQogCiBzdGF0aWMgdm9pZApAQCAtOTQ5LDcgKzk0Myw2IEBAIGljbF9wcm9ncmFt
X2dhbW1hX211bHRpX3NlZ21lbnQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCiAJY29uc3Qgc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpibG9iID0gY3J0Y19zdGF0
ZS0+aHcuZ2FtbWFfbHV0OwogCWNvbnN0IHN0cnVjdCBkcm1fY29sb3JfbHV0ICpsdXQgPSBibG9i
LT5kYXRhOwogCWNvbnN0IHN0cnVjdCBkcm1fY29sb3JfbHV0ICplbnRyeTsKLQlzdHJ1Y3QgaW50
ZWxfZHNiICpkc2IgPSBpbnRlbF9kc2JfZ2V0KGNydGMpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0
Yy0+cGlwZTsKIAlpbnQgaTsKIApAQCAtOTYzLDEyICs5NTYsMTMgQEAgaWNsX3Byb2dyYW1fZ2Ft
bWFfbXVsdGlfc2VnbWVudChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSkKIAkgKiBQQUxfUFJFQ19JTkRFWFswXSBhbmQgUEFMX1BSRUNfSU5ERVhbMV0gbWFwIHRvIHNl
ZzJbMV0sCiAJICogc2VnMlswXSBiZWluZyB1bnVzZWQgYnkgdGhlIGhhcmR3YXJlLgogCSAqLwot
CWludGVsX2RzYl9yZWdfd3JpdGUoZHNiLCBQUkVDX1BBTF9JTkRFWChwaXBlKSwgUEFMX1BSRUNf
QVVUT19JTkNSRU1FTlQpOworCWludGVsX2RzYl9yZWdfd3JpdGUoY3J0Y19zdGF0ZSwgUFJFQ19Q
QUxfSU5ERVgocGlwZSksCisJCQkgICAgUEFMX1BSRUNfQVVUT19JTkNSRU1FTlQpOwogCWZvciAo
aSA9IDE7IGkgPCAyNTc7IGkrKykgewogCQllbnRyeSA9ICZsdXRbaSAqIDhdOwotCQlpbnRlbF9k
c2JfaW5kZXhlZF9yZWdfd3JpdGUoZHNiLCBQUkVDX1BBTF9EQVRBKHBpcGUpLAorCQlpbnRlbF9k
c2JfaW5kZXhlZF9yZWdfd3JpdGUoY3J0Y19zdGF0ZSwgUFJFQ19QQUxfREFUQShwaXBlKSwKIAkJ
CQkJICAgIGlsa19sdXRfMTJwNF9sZHcoZW50cnkpKTsKLQkJaW50ZWxfZHNiX2luZGV4ZWRfcmVn
X3dyaXRlKGRzYiwgUFJFQ19QQUxfREFUQShwaXBlKSwKKwkJaW50ZWxfZHNiX2luZGV4ZWRfcmVn
X3dyaXRlKGNydGNfc3RhdGUsIFBSRUNfUEFMX0RBVEEocGlwZSksCiAJCQkJCSAgICBpbGtfbHV0
XzEycDRfdWR3KGVudHJ5KSk7CiAJfQogCkBAIC05ODYsOSArOTgwLDkgQEAgaWNsX3Byb2dyYW1f
Z2FtbWFfbXVsdGlfc2VnbWVudChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKIAkgKi8KIAlmb3IgKGkgPSAwOyBpIDwgMjU2OyBpKyspIHsKIAkJZW50cnkgPSAmbHV0
W2kgKiA4ICogMTI4XTsKLQkJaW50ZWxfZHNiX2luZGV4ZWRfcmVnX3dyaXRlKGRzYiwgUFJFQ19Q
QUxfREFUQShwaXBlKSwKKwkJaW50ZWxfZHNiX2luZGV4ZWRfcmVnX3dyaXRlKGNydGNfc3RhdGUs
IFBSRUNfUEFMX0RBVEEocGlwZSksCiAJCQkJCSAgICBpbGtfbHV0XzEycDRfbGR3KGVudHJ5KSk7
Ci0JCWludGVsX2RzYl9pbmRleGVkX3JlZ193cml0ZShkc2IsIFBSRUNfUEFMX0RBVEEocGlwZSks
CisJCWludGVsX2RzYl9pbmRleGVkX3JlZ193cml0ZShjcnRjX3N0YXRlLCBQUkVDX1BBTF9EQVRB
KHBpcGUpLAogCQkJCQkgICAgaWxrX2x1dF8xMnA0X3VkdyhlbnRyeSkpOwogCX0KIApAQCAtOTk2
LDE0ICs5OTAsMTIgQEAgaWNsX3Byb2dyYW1fZ2FtbWFfbXVsdGlfc2VnbWVudChjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAllbnRyeSA9ICZsdXRbMjU2ICogOCAq
IDEyOF07CiAJaWNsX2xvYWRfZ2NtYXgoY3J0Y19zdGF0ZSwgZW50cnkpOwogCWl2Yl9sb2FkX2x1
dF9leHRfbWF4KGNydGMpOwotCWludGVsX2RzYl9wdXQoZHNiKTsKIH0KIAogc3RhdGljIHZvaWQg
aWNsX2xvYWRfbHV0cyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkK
IHsKIAljb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKmdhbW1hX2x1dCA9IGNydGNfc3Rh
dGUtPmh3LmdhbW1hX2x1dDsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKLQlzdHJ1Y3QgaW50ZWxfZHNiICpkc2IgPSBpbnRl
bF9kc2JfZ2V0KGNydGMpOwogCiAJaWYgKGNydGNfc3RhdGUtPmh3LmRlZ2FtbWFfbHV0KQogCQln
bGtfbG9hZF9kZWdhbW1hX2x1dChjcnRjX3N0YXRlKTsKQEAgLTEwMjEsOCArMTAxMyw3IEBAIHN0
YXRpYyB2b2lkIGljbF9sb2FkX2x1dHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCiAJCWl2Yl9sb2FkX2x1dF9leHRfbWF4KGNydGMpOwogCX0KIAotCWludGVsX2Rz
Yl9jb21taXQoZHNiKTsKLQlpbnRlbF9kc2JfcHV0KGRzYik7CisJaW50ZWxfZHNiX2NvbW1pdChj
cnRjX3N0YXRlKTsKIH0KIAogc3RhdGljIHUzMiBjaHZfY2dtX2RlZ2FtbWFfbGR3KGNvbnN0IHN0
cnVjdCBkcm1fY29sb3JfbHV0ICpjb2xvcikKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggNDMyYjRlZWFmOWY2Li41MTQ0ODNmZmQyNDcgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBAIC0xNDg3Myw4
ICsxNDg3MywyNCBAQCBzdGF0aWMgaW50IGludGVsX2F0b21pY19jaGVjayhzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2LAogCiBzdGF0aWMgaW50IGludGVsX2F0b21pY19wcmVwYXJlX2NvbW1pdChzdHJ1
Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIHsKLQlyZXR1cm4gZHJtX2F0b21pY19oZWxw
ZXJfcHJlcGFyZV9wbGFuZXMoc3RhdGUtPmJhc2UuZGV2LAotCQkJCQkJJnN0YXRlLT5iYXNlKTsK
KwlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKKwlzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YzsKKwlpbnQgaSwgcmV0OworCisJcmV0ID0gZHJtX2F0b21pY19oZWxwZXJfcHJlcGFy
ZV9wbGFuZXMoc3RhdGUtPmJhc2UuZGV2LCAmc3RhdGUtPmJhc2UpOworCWlmIChyZXQgPCAwKQor
CQlyZXR1cm4gcmV0OworCisJZm9yX2VhY2hfbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3RhdGUs
IGNydGMsIGNydGNfc3RhdGUsIGkpIHsKKwkJYm9vbCBtb2RlX2NoYW5nZWQgPSBuZWVkc19tb2Rl
c2V0KGNydGNfc3RhdGUpOworCisJCWlmIChtb2RlX2NoYW5nZWQgfHwgY3J0Y19zdGF0ZS0+dXBk
YXRlX3BpcGUgfHwKKwkJICAgIGNydGNfc3RhdGUtPnVhcGkuY29sb3JfbWdtdF9jaGFuZ2VkKSB7
CisJCQlpbnRlbF9kc2JfcHJlcGFyZShjcnRjX3N0YXRlKTsKKwkJfQorCX0KKworCXJldHVybiAw
OwogfQogCiB1MzIgaW50ZWxfY3J0Y19nZXRfdmJsYW5rX2NvdW50ZXIoc3RydWN0IGludGVsX2Ny
dGMgKmNydGMpCkBAIC0xNTMyNywxNSArMTUzNDMsMjcgQEAgc3RhdGljIHZvaWQgaW50ZWxfYXRv
bWljX2NvbW1pdF9mZW5jZV93YWl0KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKmludGVsX3N0
YXQKIAkJICAgICZ3YWl0X3Jlc2V0KTsKIH0KIAorc3RhdGljIHZvaWQgaW50ZWxfY2xlYW51cF9k
c2JzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQoreworCXN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwgKm5ld19jcnRjX3N0YXRlOworCXN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjOworCWludCBpOworCisJZm9yX2VhY2hfb2xkbmV3X2ludGVsX2NydGNfaW5f
c3RhdGUoc3RhdGUsIGNydGMsIG9sZF9jcnRjX3N0YXRlLAorCQkJCQkgICAgbmV3X2NydGNfc3Rh
dGUsIGkpCisJCWludGVsX2RzYl9jbGVhbnVwKG9sZF9jcnRjX3N0YXRlKTsKK30KKwogc3RhdGlj
IHZvaWQgaW50ZWxfYXRvbWljX2NsZWFudXBfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmsp
CiB7Ci0Jc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlID0KLQkJY29udGFpbmVyX29mKHdv
cmssIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlLCBjb21taXRfd29yayk7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHN0YXRlLT5kZXYpOworCXN0cnVjdCBpbnRlbF9h
dG9taWNfc3RhdGUgKnN0YXRlID0KKwkJY29udGFpbmVyX29mKHdvcmssIHN0cnVjdCBpbnRlbF9h
dG9taWNfc3RhdGUsIGJhc2UuY29tbWl0X3dvcmspOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5kZXYpOwogCi0JZHJtX2F0b21pY19oZWxwZXJf
Y2xlYW51cF9wbGFuZXMoJmk5MTUtPmRybSwgc3RhdGUpOwotCWRybV9hdG9taWNfaGVscGVyX2Nv
bW1pdF9jbGVhbnVwX2RvbmUoc3RhdGUpOwotCWRybV9hdG9taWNfc3RhdGVfcHV0KHN0YXRlKTsK
KwlpbnRlbF9jbGVhbnVwX2RzYnMoc3RhdGUpOworCWRybV9hdG9taWNfaGVscGVyX2NsZWFudXBf
cGxhbmVzKCZpOTE1LT5kcm0sICZzdGF0ZS0+YmFzZSk7CisJZHJtX2F0b21pY19oZWxwZXJfY29t
bWl0X2NsZWFudXBfZG9uZSgmc3RhdGUtPmJhc2UpOworCWRybV9hdG9taWNfc3RhdGVfcHV0KCZz
dGF0ZS0+YmFzZSk7CiAKIAlpbnRlbF9hdG9taWNfaGVscGVyX2ZyZWVfc3RhdGUoaTkxNSk7CiB9
CkBAIC0xNTQ2OSw2ICsxNTQ5NywxMyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9hdG9taWNfY29tbWl0
X3RhaWwoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCQltb2Rlc2V0X3B1dF9w
b3dlcl9kb21haW5zKGRldl9wcml2LCBwdXRfZG9tYWluc1tpXSk7CiAKIAkJaW50ZWxfbW9kZXNl
dF92ZXJpZnlfY3J0YyhjcnRjLCBzdGF0ZSwgb2xkX2NydGNfc3RhdGUsIG5ld19jcnRjX3N0YXRl
KTsKKworCQkvKgorCQkgKiBEU0IgY2xlYW51cCBpcyBkb25lIGluIGNsZWFudXBfd29yayBhbGln
bmluZyB3aXRoIGZyYW1lYnVmZmVyCisJCSAqIGNsZWFudXAuIFNvIGNvcHkgYW5kIHJlc2V0IHRo
ZSBkc2Igc3RydWN0dXJlIHRvIHN5bmMgd2l0aAorCQkgKiBjb21taXRfZG9uZSBhbmQgbGF0ZXIg
ZG8gZHNiIGNsZWFudXAgaW4gY2xlYW51cF93b3JrLgorCQkgKi8KKwkJb2xkX2NydGNfc3RhdGUt
PmRzYiA9IGZldGNoX2FuZF96ZXJvKCZuZXdfY3J0Y19zdGF0ZS0+ZHNiKTsKIAl9CiAKIAkvKiBV
bmRlcnJ1bnMgZG9uJ3QgYWx3YXlzIHJhaXNlIGludGVycnVwdHMsIHNvIGNoZWNrIG1hbnVhbGx5
ICovCkBAIC0xNTYxOCw4ICsxNTY1MywxNSBAQCBzdGF0aWMgaW50IGludGVsX2F0b21pY19jb21t
aXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJaW50ZWxfYXRvbWljX3N3YXBfZ2xvYmFsX3N0
YXRlKHN0YXRlKTsKIAogCWlmIChyZXQpIHsKKwkJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5l
d19jcnRjX3N0YXRlOworCQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKKwkJaW50IGk7CisKIAkJ
aTkxNV9zd19mZW5jZV9jb21taXQoJnN0YXRlLT5jb21taXRfcmVhZHkpOwogCisJCWZvcl9lYWNo
X25ld19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBuZXdfY3J0Y19zdGF0ZSwgaSkK
KwkJCWludGVsX2RzYl9jbGVhbnVwKG5ld19jcnRjX3N0YXRlKTsKKwogCQlkcm1fYXRvbWljX2hl
bHBlcl9jbGVhbnVwX3BsYW5lcyhkZXYsICZzdGF0ZS0+YmFzZSk7CiAJCWludGVsX3J1bnRpbWVf
cG1fcHV0KCZkZXZfcHJpdi0+cnVudGltZV9wbSwgc3RhdGUtPndha2VyZWYpOwogCQlyZXR1cm4g
cmV0OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlf
dHlwZXMuaAppbmRleCA4Nzg3NmZjZTkxYTUuLmNhNTc5MDA1ZDgxOCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKQEAgLTEwNzgs
NiArMTA3OCw5IEBAIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlIHsKIAogCS8qIE9ubHkgdmFsaWQg
b24gVEdMKyAqLwogCWVudW0gdHJhbnNjb2RlciBtc3RfbWFzdGVyX3RyYW5zY29kZXI7CisKKwkv
KiBGb3IgRFNCIHJlbGF0ZWQgaW5mbyAqLworCXN0cnVjdCBpbnRlbF9kc2IgKmRzYjsKIH07CiAK
IGVudW0gaW50ZWxfcGlwZV9jcmNfc291cmNlIHsKQEAgLTExNDcsOSArMTE1MCw2IEBAIHN0cnVj
dCBpbnRlbF9jcnRjIHsKIAkvKiBzY2FsZXJzIGF2YWlsYWJsZSBvbiB0aGlzIGNydGMgKi8KIAlp
bnQgbnVtX3NjYWxlcnM7CiAKLQkvKiBwZXIgcGlwZSBEU0IgcmVsYXRlZCBpbmZvICovCi0Jc3Ry
dWN0IGludGVsX2RzYiBkc2I7Ci0KICNpZmRlZiBDT05GSUdfREVCVUdfRlMKIAlzdHJ1Y3QgaW50
ZWxfcGlwZV9jcmMgcGlwZV9jcmM7CiAjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHNiLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2RzYi5jCmluZGV4IDI5ZmVjNmE5MmQxNy4uMDY0MjQyODE3NmJiIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RzYi5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHNiLmMKQEAgLTM0LDE1MiArMzQsNTIgQEAKICNk
ZWZpbmUgRFNCX0JZVEVfRU5fU0hJRlQJCTIwCiAjZGVmaW5lIERTQl9SRUdfVkFMVUVfTUFTSwkJ
MHhmZmZmZgogCi1zdGF0aWMgYm9vbCBpc19kc2JfYnVzeShzdHJ1Y3QgaW50ZWxfZHNiICpkc2Ip
CitzdGF0aWMgYm9vbCBpc19kc2JfYnVzeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwg
ZW51bSBwaXBlIHBpcGUsCisJCQllbnVtIGRzYl9pZCBpZCkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YyA9IGNvbnRhaW5lcl9vZihkc2IsIHR5cGVvZigqY3J0YyksIGRzYik7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7Ci0J
ZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwotCi0JcmV0dXJuIERTQl9TVEFUVVMgJiBpbnRl
bF9kZV9yZWFkKGRldl9wcml2LCBEU0JfQ1RSTChwaXBlLCBkc2ItPmlkKSk7CisJcmV0dXJuIERT
Ql9TVEFUVVMgJiBpbnRlbF9kZV9yZWFkKGk5MTUsIERTQl9DVFJMKHBpcGUsIGlkKSk7CiB9CiAK
LXN0YXRpYyBib29sIGludGVsX2RzYl9lbmFibGVfZW5naW5lKHN0cnVjdCBpbnRlbF9kc2IgKmRz
YikKK3N0YXRpYyBib29sIGludGVsX2RzYl9lbmFibGVfZW5naW5lKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAorCQkJCSAgICBlbnVtIHBpcGUgcGlwZSwgZW51bSBkc2JfaWQgaWQpCiB7
Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSBjb250YWluZXJfb2YoZHNiLCB0eXBlb2YoKmNy
dGMpLCBkc2IpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
Y3J0Yy0+YmFzZS5kZXYpOwotCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAl1MzIgZHNi
X2N0cmw7CiAKLQlkc2JfY3RybCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIERTQl9DVFJMKHBp
cGUsIGRzYi0+aWQpKTsKKwlkc2JfY3RybCA9IGludGVsX2RlX3JlYWQoaTkxNSwgRFNCX0NUUkwo
cGlwZSwgaWQpKTsKIAlpZiAoRFNCX1NUQVRVUyAmIGRzYl9jdHJsKSB7Ci0JCWRybV9kYmdfa21z
KCZkZXZfcHJpdi0+ZHJtLCAiRFNCIGVuZ2luZSBpcyBidXN5LlxuIik7CisJCWRybV9kYmdfa21z
KCZpOTE1LT5kcm0sICJEU0IgZW5naW5lIGlzIGJ1c3kuXG4iKTsKIAkJcmV0dXJuIGZhbHNlOwog
CX0KIAogCWRzYl9jdHJsIHw9IERTQl9FTkFCTEU7Ci0JaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYs
IERTQl9DVFJMKHBpcGUsIGRzYi0+aWQpLCBkc2JfY3RybCk7CisJaW50ZWxfZGVfd3JpdGUoaTkx
NSwgRFNCX0NUUkwocGlwZSwgaWQpLCBkc2JfY3RybCk7CiAKLQlpbnRlbF9kZV9wb3N0aW5nX3Jl
YWQoZGV2X3ByaXYsIERTQl9DVFJMKHBpcGUsIGRzYi0+aWQpKTsKKwlpbnRlbF9kZV9wb3N0aW5n
X3JlYWQoaTkxNSwgRFNCX0NUUkwocGlwZSwgaWQpKTsKIAlyZXR1cm4gdHJ1ZTsKIH0KIAotc3Rh
dGljIGJvb2wgaW50ZWxfZHNiX2Rpc2FibGVfZW5naW5lKHN0cnVjdCBpbnRlbF9kc2IgKmRzYikK
K3N0YXRpYyBib29sIGludGVsX2RzYl9kaXNhYmxlX2VuZ2luZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwKKwkJCQkgICAgIGVudW0gcGlwZSBwaXBlLCBlbnVtIGRzYl9pZCBpZCkKIHsK
LQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IGNvbnRhaW5lcl9vZihkc2IsIHR5cGVvZigqY3J0
YyksIGRzYik7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShj
cnRjLT5iYXNlLmRldik7Ci0JZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCXUzMiBkc2Jf
Y3RybDsKIAotCWRzYl9jdHJsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgRFNCX0NUUkwocGlw
ZSwgZHNiLT5pZCkpOworCWRzYl9jdHJsID0gaW50ZWxfZGVfcmVhZChpOTE1LCBEU0JfQ1RSTChw
aXBlLCBpZCkpOwogCWlmIChEU0JfU1RBVFVTICYgZHNiX2N0cmwpIHsKLQkJZHJtX2RiZ19rbXMo
JmRldl9wcml2LT5kcm0sICJEU0IgZW5naW5lIGlzIGJ1c3kuXG4iKTsKKwkJZHJtX2RiZ19rbXMo
Jmk5MTUtPmRybSwgIkRTQiBlbmdpbmUgaXMgYnVzeS5cbiIpOwogCQlyZXR1cm4gZmFsc2U7CiAJ
fQogCiAJZHNiX2N0cmwgJj0gfkRTQl9FTkFCTEU7Ci0JaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYs
IERTQl9DVFJMKHBpcGUsIGRzYi0+aWQpLCBkc2JfY3RybCk7CisJaW50ZWxfZGVfd3JpdGUoaTkx
NSwgRFNCX0NUUkwocGlwZSwgaWQpLCBkc2JfY3RybCk7CiAKLQlpbnRlbF9kZV9wb3N0aW5nX3Jl
YWQoZGV2X3ByaXYsIERTQl9DVFJMKHBpcGUsIGRzYi0+aWQpKTsKKwlpbnRlbF9kZV9wb3N0aW5n
X3JlYWQoaTkxNSwgRFNCX0NUUkwocGlwZSwgaWQpKTsKIAlyZXR1cm4gdHJ1ZTsKIH0KIAotLyoq
Ci0gKiBpbnRlbF9kc2JfZ2V0KCkgLSBBbGxvY2F0ZSBEU0IgY29udGV4dCBhbmQgcmV0dXJuIGEg
RFNCIGluc3RhbmNlLgotICogQGNydGM6IGludGVsX2NydGMgc3RydWN0dXJlIHRvIGdldCBwaXBl
IGluZm8uCi0gKgotICogVGhpcyBmdW5jdGlvbiBwcm92aWRlcyBoYW5kbGUgb2YgYSBEU0IgaW5z
dGFuY2UsIGZvciB0aGUgZnVydGhlciBEU0IKLSAqIG9wZXJhdGlvbnMuCi0gKgotICogUmV0dXJu
czogYWRkcmVzcyBvZiBJbnRlbF9kc2IgaW5zdGFuY2UgcmVxdWVzdGVkIGZvci4KLSAqIEZhaWx1
cmU6IFJldHVybnMgdGhlIHNhbWUgRFNCIGluc3RhbmNlLCBidXQgd2l0aG91dCBhIGNvbW1hbmQg
YnVmZmVyLgotICovCi0KLXN0cnVjdCBpbnRlbF9kc2IgKgotaW50ZWxfZHNiX2dldChzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YykKLXsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+YmFz
ZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7Ci0J
c3RydWN0IGludGVsX2RzYiAqZHNiID0gJmNydGMtPmRzYjsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqOwotCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwotCXUzMiAqYnVmOwotCWludGVs
X3dha2VyZWZfdCB3YWtlcmVmOwotCi0JaWYgKCFIQVNfRFNCKGk5MTUpKQotCQlyZXR1cm4gZHNi
OwotCi0JaWYgKGRzYi0+cmVmY291bnQrKyAhPSAwKQotCQlyZXR1cm4gZHNiOwotCi0Jd2FrZXJl
ZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKLQotCW9iaiA9IGk5
MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoaTkxNSwgRFNCX0JVRl9TSVpFKTsKLQlpZiAo
SVNfRVJSKG9iaikpIHsKLQkJZHJtX2VycigmaTkxNS0+ZHJtLCAiR2VtIG9iamVjdCBjcmVhdGlv
biBmYWlsZWRcbiIpOwotCQlnb3RvIG91dDsKLQl9Ci0KLQl2bWEgPSBpOTE1X2dlbV9vYmplY3Rf
Z2d0dF9waW4ob2JqLCBOVUxMLCAwLCAwLCAwKTsKLQlpZiAoSVNfRVJSKHZtYSkpIHsKLQkJZHJt
X2VycigmaTkxNS0+ZHJtLCAiVm1hIGNyZWF0aW9uIGZhaWxlZFxuIik7Ci0JCWk5MTVfZ2VtX29i
amVjdF9wdXQob2JqKTsKLQkJZ290byBvdXQ7Ci0JfQotCi0JYnVmID0gaTkxNV9nZW1fb2JqZWN0
X3Bpbl9tYXAodm1hLT5vYmosIEk5MTVfTUFQX1dDKTsKLQlpZiAoSVNfRVJSKGJ1ZikpIHsKLQkJ
ZHJtX2VycigmaTkxNS0+ZHJtLCAiQ29tbWFuZCBidWZmZXIgY3JlYXRpb24gZmFpbGVkXG4iKTsK
LQkJZ290byBvdXQ7Ci0JfQotCi0JZHNiLT5pZCA9IERTQjE7Ci0JZHNiLT52bWEgPSB2bWE7Ci0J
ZHNiLT5jbWRfYnVmID0gYnVmOwotCi1vdXQ6Ci0JLyoKLQkgKiBPbiBlcnJvciBkc2ItPmNtZF9i
dWYgd2lsbCBjb250aW51ZSB0byBiZSBOVUxMLCBtYWtpbmcgdGhlIHdyaXRlcwotCSAqIHBhc3Mt
dGhyb3VnaC4gTGVhdmUgdGhlIGRhbmdsaW5nIHJlZiB0byBiZSByZW1vdmVkIGxhdGVyIGJ5IHRo
ZQotCSAqIGNvcnJlc3BvbmRpbmcgaW50ZWxfZHNiX3B1dCgpOiB0aGUgaW1wb3J0YW50IGVycm9y
IG1lc3NhZ2Ugd2lsbAotCSAqIGFscmVhZHkgYmUgbG9nZ2VkIGFib3ZlLgotCSAqLwotCi0JaW50
ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCi0JcmV0dXJu
IGRzYjsKLX0KLQotLyoqCi0gKiBpbnRlbF9kc2JfcHV0KCkgLSBUbyBkZXN0cm95IERTQiBjb250
ZXh0LgotICogQGRzYjogaW50ZWxfZHNiIHN0cnVjdHVyZS4KLSAqCi0gKiBUaGlzIGZ1bmN0aW9u
IGRlc3Ryb3lzIHRoZSBEU0IgY29udGV4dCBhbGxvY2F0ZWQgYnkgYSBkc2JfZ2V0KCksIGJ5Ci0g
KiB1bnBpbm5pbmcgYW5kIHJlbGVhc2luZyB0aGUgVk1BIG9iamVjdCBhc3NvY2lhdGVkIHdpdGgg
aXQuCi0gKi8KLQotdm9pZCBpbnRlbF9kc2JfcHV0KHN0cnVjdCBpbnRlbF9kc2IgKmRzYikKLXsK
LQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IGNvbnRhaW5lcl9vZihkc2IsIHR5cGVvZigqY3J0
YyksIGRzYik7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMt
PmJhc2UuZGV2KTsKLQotCWlmICghSEFTX0RTQihpOTE1KSkKLQkJcmV0dXJuOwotCi0JaWYgKGRy
bV9XQVJOX09OKCZpOTE1LT5kcm0sIGRzYi0+cmVmY291bnQgPT0gMCkpCi0JCXJldHVybjsKLQot
CWlmICgtLWRzYi0+cmVmY291bnQgPT0gMCkgewotCQlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFz
ZSgmZHNiLT52bWEsIEk5MTVfVk1BX1JFTEVBU0VfTUFQKTsKLQkJZHNiLT5jbWRfYnVmID0gTlVM
TDsKLQkJZHNiLT5mcmVlX3BvcyA9IDA7Ci0JCWRzYi0+aW5zX3N0YXJ0X29mZnNldCA9IDA7Ci0J
fQotfQotCiAvKioKICAqIGludGVsX2RzYl9pbmRleGVkX3JlZ193cml0ZSgpIC1Xcml0ZSB0byB0
aGUgRFNCIGNvbnRleHQgZm9yIGF1dG8KICAqIGluY3JlbWVudCByZWdpc3Rlci4KLSAqIEBkc2I6
IGludGVsX2RzYiBzdHJ1Y3R1cmUuCisgKiBAY3J0Y19zdGF0ZTogaW50ZWxfY3J0Y19zdGF0ZSBz
dHJ1Y3R1cmUKICAqIEByZWc6IHJlZ2lzdGVyIGFkZHJlc3MuCiAgKiBAdmFsOiB2YWx1ZS4KICAq
CkBAIC0xODksMTkgKzg5LDIwIEBAIHZvaWQgaW50ZWxfZHNiX3B1dChzdHJ1Y3QgaW50ZWxfZHNi
ICpkc2IpCiAgKiBpcyBkb25lIHRocm91Z2ggbW1pbyB3cml0ZS4KICAqLwogCi12b2lkIGludGVs
X2RzYl9pbmRleGVkX3JlZ193cml0ZShzdHJ1Y3QgaW50ZWxfZHNiICpkc2IsIGk5MTVfcmVnX3Qg
cmVnLAotCQkJCSB1MzIgdmFsKQordm9pZCBpbnRlbF9kc2JfaW5kZXhlZF9yZWdfd3JpdGUoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkJIGk5MTVfcmVnX3Qg
cmVnLCB1MzIgdmFsKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gY29udGFpbmVyX29m
KGRzYiwgdHlwZW9mKCpjcnRjKSwgZHNiKTsKKwlzdHJ1Y3QgaW50ZWxfZHNiICpkc2IgPSBjcnRj
X3N0YXRlLT5kc2I7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNy
dGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7Ci0JdTMyICpidWYgPSBkc2ItPmNtZF9idWY7CisJ
dTMyICpidWY7CiAJdTMyIHJlZ192YWw7CiAKLQlpZiAoIWJ1ZikgeworCWlmICghKGRzYiAmJiBk
c2ItPmNtZF9idWYpKSB7CiAJCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCByZWcsIHZhbCk7CiAJ
CXJldHVybjsKIAl9Ci0KKwlidWYgPSBkc2ItPmNtZF9idWY7CiAJaWYgKGRybV9XQVJOX09OKCZk
ZXZfcHJpdi0+ZHJtLCBkc2ItPmZyZWVfcG9zID49IERTQl9CVUZfU0laRSkpIHsKIAkJZHJtX2Ri
Z19rbXMoJmRldl9wcml2LT5kcm0sICJEU0IgYnVmZmVyIG92ZXJmbG93XG4iKTsKIAkJcmV0dXJu
OwpAQCAtMjU2LDcgKzE1Nyw3IEBAIHZvaWQgaW50ZWxfZHNiX2luZGV4ZWRfcmVnX3dyaXRlKHN0
cnVjdCBpbnRlbF9kc2IgKmRzYiwgaTkxNV9yZWdfdCByZWcsCiAvKioKICAqIGludGVsX2RzYl9y
ZWdfd3JpdGUoKSAtV3JpdGUgdG8gdGhlIERTQiBjb250ZXh0IGZvciBub3JtYWwKICAqIHJlZ2lz
dGVyLgotICogQGRzYjogaW50ZWxfZHNiIHN0cnVjdHVyZS4KKyAqIEBjcnRjX3N0YXRlOiBpbnRl
bF9jcnRjX3N0YXRlIHN0cnVjdHVyZQogICogQHJlZzogcmVnaXN0ZXIgYWRkcmVzcy4KICAqIEB2
YWw6IHZhbHVlLgogICoKQEAgLTI2NSwxNyArMTY2LDE5IEBAIHZvaWQgaW50ZWxfZHNiX2luZGV4
ZWRfcmVnX3dyaXRlKHN0cnVjdCBpbnRlbF9kc2IgKmRzYiwgaTkxNV9yZWdfdCByZWcsCiAgKiBh
bmQgcmVzdCBhbGwgZXJyb25lb3VzIGNvbmRpdGlvbiByZWdpc3RlciBwcm9ncmFtbWluZyBpcyBk
b25lCiAgKiB0aHJvdWdoIG1taW8gd3JpdGUuCiAgKi8KLXZvaWQgaW50ZWxfZHNiX3JlZ193cml0
ZShzdHJ1Y3QgaW50ZWxfZHNiICpkc2IsIGk5MTVfcmVnX3QgcmVnLCB1MzIgdmFsKQordm9pZCBp
bnRlbF9kc2JfcmVnX3dyaXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAorCQkJIGk5MTVfcmVnX3QgcmVnLCB1MzIgdmFsKQogewotCXN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjID0gY29udGFpbmVyX29mKGRzYiwgdHlwZW9mKCpjcnRjKSwgZHNiKTsKKwlzdHJ1Y3Qg
aW50ZWxfZHNiICpkc2IgPSBjcnRjX3N0YXRlLT5kc2I7CisJc3RydWN0IGludGVsX2NydGMgKmNy
dGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJdTMyICpi
dWYgPSBkc2ItPmNtZF9idWY7CiAKLQlpZiAoIWJ1ZikgeworCWlmICghKGRzYiAmJiBkc2ItPmNt
ZF9idWYpKSB7CiAJCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCByZWcsIHZhbCk7CiAJCXJldHVy
bjsKIAl9Ci0KKwlidWYgPSBkc2ItPmNtZF9idWY7CiAJaWYgKGRybV9XQVJOX09OKCZkZXZfcHJp
di0+ZHJtLCBkc2ItPmZyZWVfcG9zID49IERTQl9CVUZfU0laRSkpIHsKIAkJZHJtX2RiZ19rbXMo
JmRldl9wcml2LT5kcm0sICJEU0IgYnVmZmVyIG92ZXJmbG93XG4iKTsKIAkJcmV0dXJuOwpAQCAt
MjkwLDI2ICsxOTMsMjcgQEAgdm9pZCBpbnRlbF9kc2JfcmVnX3dyaXRlKHN0cnVjdCBpbnRlbF9k
c2IgKmRzYiwgaTkxNV9yZWdfdCByZWcsIHUzMiB2YWwpCiAKIC8qKgogICogaW50ZWxfZHNiX2Nv
bW1pdCgpIC0gVHJpZ2dlciB3b3JrbG9hZCBleGVjdXRpb24gb2YgRFNCLgotICogQGRzYjogaW50
ZWxfZHNiIHN0cnVjdHVyZS4KKyAqIEBjcnRjX3N0YXRlOiBpbnRlbF9jcnRjX3N0YXRlIHN0cnVj
dHVyZQogICoKICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byBkbyBhY3R1YWwgd3JpdGUgdG8g
aGFyZHdhcmUgdXNpbmcgRFNCLgogICogT24gZXJyb3JzLCBmYWxsIGJhY2sgdG8gTU1JTy4gQWxz
byB0aGlzIGZ1bmN0aW9uIGhlbHAgdG8gcmVzZXQgdGhlIGNvbnRleHQuCiAgKi8KLXZvaWQgaW50
ZWxfZHNiX2NvbW1pdChzdHJ1Y3QgaW50ZWxfZHNiICpkc2IpCit2b2lkIGludGVsX2RzYl9jb21t
aXQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0
IGludGVsX2NydGMgKmNydGMgPSBjb250YWluZXJfb2YoZHNiLCB0eXBlb2YoKmNydGMpLCBkc2Ip
OworCXN0cnVjdCBpbnRlbF9kc2IgKmRzYiA9IGNydGNfc3RhdGUtPmRzYjsKKwlzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7CiAJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0
Yy0+cGlwZTsKIAl1MzIgdGFpbDsKIAotCWlmICghZHNiLT5mcmVlX3BvcykKKwlpZiAoIShkc2Ig
JiYgZHNiLT5mcmVlX3BvcykpCiAJCXJldHVybjsKIAotCWlmICghaW50ZWxfZHNiX2VuYWJsZV9l
bmdpbmUoZHNiKSkKKwlpZiAoIWludGVsX2RzYl9lbmFibGVfZW5naW5lKGRldl9wcml2LCBwaXBl
LCBkc2ItPmlkKSkKIAkJZ290byByZXNldDsKIAotCWlmIChpc19kc2JfYnVzeShkc2IpKSB7CisJ
aWYgKGlzX2RzYl9idXN5KGRldl9wcml2LCBwaXBlLCBkc2ItPmlkKSkgewogCQlkcm1fZXJyKCZk
ZXZfcHJpdi0+ZHJtLAogCQkJIkhFQURfUFRSIHdyaXRlIGZhaWxlZCAtIGRzYiBlbmdpbmUgaXMg
YnVzeS5cbiIpOwogCQlnb3RvIHJlc2V0OwpAQCAtMzIyLDcgKzIyNiw3IEBAIHZvaWQgaW50ZWxf
ZHNiX2NvbW1pdChzdHJ1Y3QgaW50ZWxfZHNiICpkc2IpCiAJCW1lbXNldCgmZHNiLT5jbWRfYnVm
W2RzYi0+ZnJlZV9wb3NdLCAwLAogCQkgICAgICAgKHRhaWwgLSBkc2ItPmZyZWVfcG9zICogNCkp
OwogCi0JaWYgKGlzX2RzYl9idXN5KGRzYikpIHsKKwlpZiAoaXNfZHNiX2J1c3koZGV2X3ByaXYs
IHBpcGUsIGRzYi0+aWQpKSB7CiAJCWRybV9lcnIoJmRldl9wcml2LT5kcm0sCiAJCQkiVEFJTF9Q
VFIgd3JpdGUgZmFpbGVkIC0gZHNiIGVuZ2luZSBpcyBidXN5LlxuIik7CiAJCWdvdG8gcmVzZXQ7
CkBAIC0zMzIsNyArMjM2LDcgQEAgdm9pZCBpbnRlbF9kc2JfY29tbWl0KHN0cnVjdCBpbnRlbF9k
c2IgKmRzYikKIAkJICAgIGk5MTVfZ2d0dF9vZmZzZXQoZHNiLT52bWEpLCB0YWlsKTsKIAlpbnRl
bF9kZV93cml0ZShkZXZfcHJpdiwgRFNCX1RBSUwocGlwZSwgZHNiLT5pZCksCiAJCSAgICAgICBp
OTE1X2dndHRfb2Zmc2V0KGRzYi0+dm1hKSArIHRhaWwpOwotCWlmICh3YWl0X2ZvcighaXNfZHNi
X2J1c3koZHNiKSwgMSkpIHsKKwlpZiAod2FpdF9mb3IoIWlzX2RzYl9idXN5KGRldl9wcml2LCBw
aXBlLCBkc2ItPmlkKSwgMSkpIHsKIAkJZHJtX2VycigmZGV2X3ByaXYtPmRybSwKIAkJCSJUaW1l
ZCBvdXQgd2FpdGluZyBmb3IgRFNCIHdvcmtsb2FkIGNvbXBsZXRpb24uXG4iKTsKIAkJZ290byBy
ZXNldDsKQEAgLTM0MSw1ICsyNDUsNzUgQEAgdm9pZCBpbnRlbF9kc2JfY29tbWl0KHN0cnVjdCBp
bnRlbF9kc2IgKmRzYikKIHJlc2V0OgogCWRzYi0+ZnJlZV9wb3MgPSAwOwogCWRzYi0+aW5zX3N0
YXJ0X29mZnNldCA9IDA7Ci0JaW50ZWxfZHNiX2Rpc2FibGVfZW5naW5lKGRzYik7CisJaW50ZWxf
ZHNiX2Rpc2FibGVfZW5naW5lKGRldl9wcml2LCBwaXBlLCBkc2ItPmlkKTsKK30KKworLyoqCisg
KiBpbnRlbF9kc2JfcHJlcGFyZSgpIC0gQWxsb2NhdGUsIHBpbiBhbmQgbWFwIHRoZSBEU0IgY29t
bWFuZCBidWZmZXIuCisgKiBAY3J0Y19zdGF0ZTogaW50ZWxfY3J0Y19zdGF0ZSBzdHJ1Y3R1cmUg
dG8gcHJlcGFyZSBhc3NvY2lhdGVkIGRzYiBpbnN0YW5jZS4KKyAqCisgKiBUaGlzIGZ1bmN0aW9u
IHByZXBhcmUgdGhlIGNvbW1hbmQgYnVmZmVyIHdoaWNoIGlzIHVzZWQgdG8gc3RvcmUgZHNiCisg
KiBpbnN0cnVjdGlvbnMgd2l0aCBkYXRhLgorICovCit2b2lkIGludGVsX2RzYl9wcmVwYXJlKHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQoreworCXN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJc3RydWN0
IGludGVsX2RzYiAqZHNiOworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CisJc3Ry
dWN0IGk5MTVfdm1hICp2bWE7CisJdTMyICpidWY7CisJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7
CisKKwlpZiAoIUhBU19EU0IoaTkxNSkpCisJCXJldHVybjsKKworCWRzYiA9IGttYWxsb2Moc2l6
ZW9mKCpkc2IpLCBHRlBfS0VSTkVMKTsKKworCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dl
dCgmaTkxNS0+cnVudGltZV9wbSk7CisKKwlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2lu
dGVybmFsKGk5MTUsIERTQl9CVUZfU0laRSk7CisJaWYgKElTX0VSUihvYmopKSB7CisJCWRybV9l
cnIoJmk5MTUtPmRybSwgIkdlbSBvYmplY3QgY3JlYXRpb24gZmFpbGVkXG4iKTsKKwkJZ290byBv
dXQ7CisJfQorCisJdm1hID0gaTkxNV9nZW1fb2JqZWN0X2dndHRfcGluKG9iaiwgTlVMTCwgMCwg
MCwgMCk7CisJaWYgKElTX0VSUih2bWEpKSB7CisJCWRybV9lcnIoJmk5MTUtPmRybSwgIlZtYSBj
cmVhdGlvbiBmYWlsZWRcbiIpOworCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CisJCWdvdG8g
b3V0OworCX0KKworCWJ1ZiA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKHZtYS0+b2JqLCBJOTE1
X01BUF9XQyk7CisJaWYgKElTX0VSUihidWYpKSB7CisJCWRybV9lcnIoJmk5MTUtPmRybSwgIkNv
bW1hbmQgYnVmZmVyIGNyZWF0aW9uIGZhaWxlZFxuIik7CisJCWdvdG8gb3V0OworCX0KKworCWRz
Yi0+aWQgPSBEU0IxOworCWRzYi0+dm1hID0gdm1hOworCWRzYi0+Y21kX2J1ZiA9IGJ1ZjsKKwlk
c2ItPmZyZWVfcG9zID0gMDsKKwlkc2ItPmluc19zdGFydF9vZmZzZXQgPSAwOworCWNydGNfc3Rh
dGUtPmRzYiA9IGRzYjsKK291dDoKKwlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGlt
ZV9wbSwgd2FrZXJlZik7Cit9CisKKy8qKgorICogaW50ZWxfZHNiX2NsZWFudXAoKSAtIFRvIGNs
ZWFudXAgRFNCIGNvbnRleHQuCisgKiBAY3J0Y19zdGF0ZTogaW50ZWxfY3J0Y19zdGF0ZSBzdHJ1
Y3R1cmUgdG8gY2xlYW51cCBhc3NvY2lhdGVkIGRzYiBpbnN0YW5jZS4KKyAqCisgKiBUaGlzIGZ1
bmN0aW9uIGNsZWFudXAgdGhlIERTQiBjb250ZXh0IGJ5IHVucGlubmluZyBhbmQgcmVsZWFzaW5n
CisgKiB0aGUgVk1BIG9iamVjdCBhc3NvY2lhdGVkIHdpdGggaXQuCisgKi8KK3ZvaWQgaW50ZWxf
ZHNiX2NsZWFudXAoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7CisJaWYg
KCFjcnRjX3N0YXRlLT5kc2IpCisJCXJldHVybjsKKworCWk5MTVfdm1hX3VucGluX2FuZF9yZWxl
YXNlKCZjcnRjX3N0YXRlLT5kc2ItPnZtYSwgSTkxNV9WTUFfUkVMRUFTRV9NQVApOworCWtmcmVl
KGNydGNfc3RhdGUtPmRzYik7CisJY3J0Y19zdGF0ZS0+ZHNiID0gTlVMTDsKIH0KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHNiLmggYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RzYi5oCmluZGV4IDM5NWVmOWNlNTU4ZS4uNjU0YTEx
ZjI0YjgwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rz
Yi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHNiLmgKQEAgLTEw
LDcgKzEwLDcgQEAKIAogI2luY2x1ZGUgImk5MTVfcmVnLmgiCiAKLXN0cnVjdCBpbnRlbF9jcnRj
Oworc3RydWN0IGludGVsX2NydGNfc3RhdGU7CiBzdHJ1Y3QgaTkxNV92bWE7CiAKIGVudW0gZHNi
X2lkIHsKQEAgLTIyLDcgKzIyLDYgQEAgZW51bSBkc2JfaWQgewogfTsKIAogc3RydWN0IGludGVs
X2RzYiB7Ci0JbG9uZyByZWZjb3VudDsKIAllbnVtIGRzYl9pZCBpZDsKIAl1MzIgKmNtZF9idWY7
CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CkBAIC00MSwxMiArNDAsMTIgQEAgc3RydWN0IGludGVs
X2RzYiB7CiAJdTMyIGluc19zdGFydF9vZmZzZXQ7CiB9OwogCi1zdHJ1Y3QgaW50ZWxfZHNiICoK
LWludGVsX2RzYl9nZXQoc3RydWN0IGludGVsX2NydGMgKmNydGMpOwotdm9pZCBpbnRlbF9kc2Jf
cHV0KHN0cnVjdCBpbnRlbF9kc2IgKmRzYik7Ci12b2lkIGludGVsX2RzYl9yZWdfd3JpdGUoc3Ry
dWN0IGludGVsX2RzYiAqZHNiLCBpOTE1X3JlZ190IHJlZywgdTMyIHZhbCk7Ci12b2lkIGludGVs
X2RzYl9pbmRleGVkX3JlZ193cml0ZShzdHJ1Y3QgaW50ZWxfZHNiICpkc2IsIGk5MTVfcmVnX3Qg
cmVnLAotCQkJCSB1MzIgdmFsKTsKLXZvaWQgaW50ZWxfZHNiX2NvbW1pdChzdHJ1Y3QgaW50ZWxf
ZHNiICpkc2IpOwordm9pZCBpbnRlbF9kc2JfcHJlcGFyZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSk7Cit2b2lkIGludGVsX2RzYl9jbGVhbnVwKHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKTsKK3ZvaWQgaW50ZWxfZHNiX3JlZ193cml0ZShjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCSBpOTE1X3JlZ190IHJlZywgdTMy
IHZhbCk7Cit2b2lkIGludGVsX2RzYl9pbmRleGVkX3JlZ193cml0ZShjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCQkgaTkxNV9yZWdfdCByZWcsIHUzMiB2YWwp
Owordm9pZCBpbnRlbF9kc2JfY29tbWl0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKTsKIAogI2VuZGlmCi0tIAoyLjI2LjAKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

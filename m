Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 6198E115FF8
	for <lists+intel-gfx@lfdr.de>; Sun,  8 Dec 2019 01:12:22 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 06A436E29D;
	Sun,  8 Dec 2019 00:12:20 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 923886E29D
 for <intel-gfx@lists.freedesktop.org>; Sun,  8 Dec 2019 00:12:17 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19498916-1500050 
 for multiple; Sun, 08 Dec 2019 00:12:10 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sun,  8 Dec 2019 00:12:09 +0000
Message-Id: <20191208001209.2914430-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/gem: Avoid rcu_barrier() from shrinker
 paths
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QXMgaTkxNV9nZW1fb2JqZWN0X3VuYmluZCgpIHdhaXRzIG9uIGFuIHJjdV9iYXJyaWVyKCkgdG8g
Zmx1c2ggdm0KcmVsZWFzZXMgKGFuZCBkZXN0cnVjdGlvbiBvZiB0aGVpciBib3VuZCB2bWEpLCB3
ZSBoYXZlIHRvIGJlIGNhcmVmdWwgbm90CnRvIGludm9rZSB0aGF0IGJhcnJpZXIgZnJvbSBiZW5l
YXRoIHRoZSBzaHJpbmtlcjoKCjw0PiBbNDMwLjIyMjY3MV0gV0FSTklORzogcG9zc2libGUgY2ly
Y3VsYXIgbG9ja2luZyBkZXBlbmRlbmN5IGRldGVjdGVkCjw0PiBbNDMwLjIyMjY3M10gNS40LjAt
cmM4LUNJLUNJX0RSTV83NTA4KyAjMSBUYWludGVkOiBHICAgICBVCjw0PiBbNDMwLjIyMjY3NV0g
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCjw0
PiBbNDMwLjIyMjY3N10gZ2VtX3B3cml0ZS8yMzE3IGlzIHRyeWluZyB0byBhY3F1aXJlIGxvY2s6
Cjw0PiBbNDMwLjIyMjY3OF0gZmZmZmZmZmY4MjI0ODIxOCAocmN1X3N0YXRlLmJhcnJpZXJfbXV0
ZXgpeysuKy59LCBhdDogcmN1X2JhcnJpZXIrMHgyMy8weDE5MAo8ND4gWzQzMC4yMjI2ODVdCmJ1
dCB0YXNrIGlzIGFscmVhZHkgaG9sZGluZyBsb2NrOgo8ND4gWzQzMC4yMjI2ODddIGZmZmZmZmZm
ODIyNjNhNDAgKGZzX3JlY2xhaW0peysuKy59LCBhdDogZnNfcmVjbGFpbV9hY3F1aXJlLnBhcnQu
MTE3KzB4MC8weDMwCjw0PiBbNDMwLjIyMjY5MV0Kd2hpY2ggbG9jayBhbHJlYWR5IGRlcGVuZHMg
b24gdGhlIG5ldyBsb2NrLgoKPDQ+IFs0MzAuMjIyNjkzXQp0aGUgZXhpc3RpbmcgZGVwZW5kZW5j
eSBjaGFpbiAoaW4gcmV2ZXJzZSBvcmRlcikgaXM6Cjw0PiBbNDMwLjIyMjY5NV0KLT4gIzIgKGZz
X3JlY2xhaW0peysuKy59Ogo8ND4gWzQzMC4yMjI2OThdICAgICAgICBmc19yZWNsYWltX2FjcXVp
cmUucGFydC4xMTcrMHgyNC8weDMwCjw0PiBbNDMwLjIyMjcwMl0gICAgICAgIGttZW1fY2FjaGVf
YWxsb2NfdHJhY2UrMHgyYS8weDJjMAo8ND4gWzQzMC4yMjI3MDVdICAgICAgICBpbnRlbF9jcHVj
X3ByZXBhcmUrMHgzNy8weDFhMAo8ND4gWzQzMC4yMjI3MDldICAgICAgICBjcHVocF9pbnZva2Vf
Y2FsbGJhY2srMHg5Yi8weDlkMAo8ND4gWzQzMC4yMjI3MTJdICAgICAgICBfY3B1X3VwKzB4YTIv
MHgxNDAKPDQ+IFs0MzAuMjIyNzE0XSAgICAgICAgZG9fY3B1X3VwKzB4NjEvMHhhMAo8ND4gWzQz
MC4yMjI3MThdICAgICAgICBzbXBfaW5pdCsweDU3LzB4OTYKPDQ+IFs0MzAuMjIyNzIyXSAgICAg
ICAga2VybmVsX2luaXRfZnJlZWFibGUrMHhhYy8weDFjNwo8ND4gWzQzMC4yMjI3MjVdICAgICAg
ICBrZXJuZWxfaW5pdCsweDUvMHgxMDAKPDQ+IFs0MzAuMjIyNzI4XSAgICAgICAgcmV0X2Zyb21f
Zm9yaysweDI0LzB4NTAKPDQ+IFs0MzAuMjIyNzI5XQotPiAjMSAoY3B1X2hvdHBsdWdfbG9jay5y
d19zZW0peysrKyt9Ogo8ND4gWzQzMC4yMjI3MzNdICAgICAgICBjcHVzX3JlYWRfbG9jaysweDM0
LzB4ZDAKPDQ+IFs0MzAuMjIyNzM0XSAgICAgICAgcmN1X2JhcnJpZXIrMHhhYS8weDE5MAo8ND4g
WzQzMC4yMjI3MzZdICAgICAgICBrZXJuZWxfaW5pdCsweDIxLzB4MTAwCjw0PiBbNDMwLjIyMjcz
N10gICAgICAgIHJldF9mcm9tX2ZvcmsrMHgyNC8weDUwCjw0PiBbNDMwLjIyMjczOV0KLT4gIzAg
KHJjdV9zdGF0ZS5iYXJyaWVyX211dGV4KXsrLisufToKPDQ+IFs0MzAuMjIyNzQyXSAgICAgICAg
X19sb2NrX2FjcXVpcmUrMHgxMzI4LzB4MTVkMAo8ND4gWzQzMC4yMjI3NDNdICAgICAgICBsb2Nr
X2FjcXVpcmUrMHhhNy8weDFjMAo8ND4gWzQzMC4yMjI3NDZdICAgICAgICBfX211dGV4X2xvY2sr
MHg5YS8weDlkMAo8ND4gWzQzMC4yMjI3NDddICAgICAgICByY3VfYmFycmllcisweDIzLzB4MTkw
Cjw0PiBbNDMwLjIyMjg1MF0gICAgICAgIGk5MTVfZ2VtX29iamVjdF91bmJpbmQrMHgyNjQvMHgz
ZDAgW2k5MTVdCjw0PiBbNDMwLjIyMjg4Ml0gICAgICAgIGk5MTVfZ2VtX3NocmluaysweDI5Ny8w
eDVmMCBbaTkxNV0KPDQ+IFs0MzAuMjIyOTEyXSAgICAgICAgaTkxNV9nZW1fc2hyaW5rX2FsbCsw
eDM4LzB4NjAgW2k5MTVdCjw0PiBbNDMwLjIyMjkzNF0gICAgICAgIGk5MTVfZHJvcF9jYWNoZXNf
c2V0KzB4MWYwLzB4MjQwIFtpOTE1XQo8ND4gWzQzMC4yMjI5MzhdICAgICAgICBzaW1wbGVfYXR0
cl93cml0ZSsweGIwLzB4ZDAKPDQ+IFs0MzAuMjIyOTQxXSAgICAgICAgZnVsbF9wcm94eV93cml0
ZSsweDUxLzB4ODAKPDQ+IFs0MzAuMjIyOTQzXSAgICAgICAgdmZzX3dyaXRlKzB4YjkvMHgxZDAK
PDQ+IFs0MzAuMjIyOTQ0XSAgICAgICAga3N5c193cml0ZSsweDlmLzB4ZTAKPDQ+IFs0MzAuMjIy
OTQ2XSAgICAgICAgZG9fc3lzY2FsbF82NCsweDRmLzB4MjEwCjw0PiBbNDMwLjIyMjk0OF0gICAg
ICAgIGVudHJ5X1NZU0NBTExfNjRfYWZ0ZXJfaHdmcmFtZSsweDQ5LzB4YmUKPDQ+IFs0MzAuMjIy
OTUwXQpvdGhlciBpbmZvIHRoYXQgbWlnaHQgaGVscCB1cyBkZWJ1ZyB0aGlzOgoKPDQ+IFs0MzAu
MjIyOTUyXSBDaGFpbiBleGlzdHMgb2Y6CiAgcmN1X3N0YXRlLmJhcnJpZXJfbXV0ZXggLS0+IGNw
dV9ob3RwbHVnX2xvY2sucndfc2VtIC0tPiBmc19yZWNsYWltCgo8ND4gWzQzMC4yMjI5NTVdICBQ
b3NzaWJsZSB1bnNhZmUgbG9ja2luZyBzY2VuYXJpbzoKCjw0PiBbNDMwLjIyMjk1N10gICAgICAg
IENQVTAgICAgICAgICAgICAgICAgICAgIENQVTEKPDQ+IFs0MzAuMjIyOTU4XSAgICAgICAgLS0t
LSAgICAgICAgICAgICAgICAgICAgLS0tLQo8ND4gWzQzMC4yMjI5NjBdICAgbG9jayhmc19yZWNs
YWltKTsKPDQ+IFs0MzAuMjIyOTYxXSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9j
ayhjcHVfaG90cGx1Z19sb2NrLnJ3X3NlbSk7Cjw0PiBbNDMwLjIyMjk2M10gICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIGxvY2soZnNfcmVjbGFpbSk7Cjw0PiBbNDMwLjIyMjk2NF0gICBs
b2NrKHJjdV9zdGF0ZS5iYXJyaWVyX211dGV4KTsKPDQ+IFs0MzAuMjIyOTY2XQogKioqIERFQURM
T0NLICoqKgoKPDQ+IFs0MzAuMjIyOTY4XSAzIGxvY2tzIGhlbGQgYnkgZ2VtX3B3cml0ZS8yMzE3
Ogo8ND4gWzQzMC4yMjI5NjldICAjMDogZmZmZjg4ODQ5ZTJkOTQwOCAoc2Jfd3JpdGVycyMxNCl7
LisuK30sIGF0OiB2ZnNfd3JpdGUrMHgxYTQvMHgxZDAKPDQ+IFs0MzAuMjIyOTczXSAgIzE6IGZm
ZmY4ODg0OTY5NzZkYjAgKCZhdHRyLT5tdXRleCl7Ky4rLn0sIGF0OiBzaW1wbGVfYXR0cl93cml0
ZSsweDM2LzB4ZDAKPDQ+IFs0MzAuMjIyOTc2XSAgIzI6IGZmZmZmZmZmODIyNjNhNDAgKGZzX3Jl
Y2xhaW0peysuKy59LCBhdDogZnNfcmVjbGFpbV9hY3F1aXJlLnBhcnQuMTE3KzB4MC8weDMwCjw0
PiBbNDMwLjIyMjk4MF0Kc3RhY2sgYmFja3RyYWNlOgo8ND4gWzQzMC4yMjI5ODJdIENQVTogMSBQ
SUQ6IDIzMTcgQ29tbTogZ2VtX3B3cml0ZSBUYWludGVkOiBHICAgICBVICAgICAgICAgICAgNS40
LjAtcmM4LUNJLUNJX0RSTV83NTA4KyAjMQo8ND4gWzQzMC4yMjI5ODVdIEhhcmR3YXJlIG5hbWU6
IEludGVsIENvcnBvcmF0aW9uIFRpZ2VyIExha2UgQ2xpZW50IFBsYXRmb3JtL1RpZ2VyTGFrZSBV
IEREUjQgU09ESU1NIFJWUCwgQklPUyBUR0xTRldJMS5SMDAuMjMyMS5BMDguMTkwOTE2MjA1MSAw
OS8xNi8yMDE5Cjw0PiBbNDMwLjIyMjk4OV0gQ2FsbCBUcmFjZToKPDQ+IFs0MzAuMjIyOTkyXSAg
ZHVtcF9zdGFjaysweDcxLzB4OWIKPDQ+IFs0MzAuMjIyOTk1XSAgY2hlY2tfbm9uY2lyY3VsYXIr
MHgxOWIvMHgxYzAKPDQ+IFs0MzAuMjIyOTk4XSAgPyBfX2xvY2tfYWNxdWlyZSsweDEzMjgvMHgx
NWQwCjw0PiBbNDMwLjIyMjk5OV0gIF9fbG9ja19hY3F1aXJlKzB4MTMyOC8weDE1ZDAKPDQ+IFs0
MzAuMjIzMDAxXSAgPyBtYXJrX2hlbGRfbG9ja3MrMHg0OS8weDcwCjw0PiBbNDMwLjIyMzAwM10g
IGxvY2tfYWNxdWlyZSsweGE3LzB4MWMwCjw0PiBbNDMwLjIyMzAwNV0gID8gcmN1X2JhcnJpZXIr
MHgyMy8weDE5MAo8ND4gWzQzMC4yMjMwMDhdICBfX211dGV4X2xvY2srMHg5YS8weDlkMAo8ND4g
WzQzMC4yMjMwMDldICA/IHJjdV9iYXJyaWVyKzB4MjMvMHgxOTAKPDQ+IFs0MzAuMjIzMDExXSAg
PyByY3VfYmFycmllcisweDIzLzB4MTkwCjw0PiBbNDMwLjIyMzAxM10gID8gZmluZF9oZWxkX2xv
Y2srMHgyZC8weDkwCjw0PiBbNDMwLjIyMzA0NV0gID8gaTkxNV9nZW1fb2JqZWN0X3VuYmluZCsw
eDI0YS8weDNkMCBbaTkxNV0KPDQ+IFs0MzAuMjIzMDQ4XSAgPyByY3VfYmFycmllcisweDIzLzB4
MTkwCjw0PiBbNDMwLjIyMzA0OV0gIHJjdV9iYXJyaWVyKzB4MjMvMHgxOTAKPDQ+IFs0MzAuMjIz
MDgxXSAgaTkxNV9nZW1fb2JqZWN0X3VuYmluZCsweDI2NC8weDNkMCBbaTkxNV0KPDQ+IFs0MzAu
MjIzMTE5XSAgaTkxNV9nZW1fc2hyaW5rKzB4Mjk3LzB4NWYwIFtpOTE1XQoKU2lnbmVkLW9mZi1i
eTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0tLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jIHwgNCArKystCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2Rydi5oICAgICAgICAgICAgfCAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ2VtLmMgICAgICAgICAgICB8IDIgKy0KIDMgZmlsZXMgY2hhbmdlZCwgNSBpbnNlcnRp
b25zKCspLCAyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9kb21haW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9kb21haW4uYwppbmRleCA1M2UyOGU0MTdjYzkuLjg4YWI3ZTcxZjM2YyAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYwpAQCAtMjAzLDcgKzIwMyw5IEBAIGlu
dCBpOTE1X2dlbV9vYmplY3Rfc2V0X2NhY2hlX2xldmVsKHN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmosCiAJaTkxNV9nZW1fb2JqZWN0X3VubG9jayhvYmopOwogCiAJLyogVGhlIGNhY2hl
LWxldmVsIHdpbGwgYmUgYXBwbGllZCB3aGVuIGVhY2ggdm1hIGlzIHJlYm91bmQuICovCi0JcmV0
dXJuIGk5MTVfZ2VtX29iamVjdF91bmJpbmQob2JqLCBJOTE1X0dFTV9PQkpFQ1RfVU5CSU5EX0FD
VElWRSk7CisJcmV0dXJuIGk5MTVfZ2VtX29iamVjdF91bmJpbmQob2JqLAorCQkJCSAgICAgIEk5
MTVfR0VNX09CSkVDVF9VTkJJTkRfQUNUSVZFIHwKKwkJCQkgICAgICBJOTE1X0dFTV9PQkpFQ1Rf
VU5CSU5EX0JBUlJJRVIpOwogfQogCiBpbnQgaTkxNV9nZW1fZ2V0X2NhY2hpbmdfaW9jdGwoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCmlu
ZGV4IGMzZDhhZjI4YmZjMS4uYmFlOTdjZDYyY2I5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgK
QEAgLTE4NDUsNiArMTg0NSw3IEBAIGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqLAogaW50IGk5MTVfZ2VtX29iamVjdF91bmJpbmQoc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJCSAgIHVuc2lnbmVkIGxvbmcgZmxhZ3MpOwog
I2RlZmluZSBJOTE1X0dFTV9PQkpFQ1RfVU5CSU5EX0FDVElWRSBCSVQoMCkKKyNkZWZpbmUgSTkx
NV9HRU1fT0JKRUNUX1VOQklORF9CQVJSSUVSIEJJVCgxKQogCiB2b2lkIGk5MTVfZ2VtX3J1bnRp
bWVfc3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW0uYwppbmRleCA5MTlkM2E3MjNjNTAuLjVlZWVmMWVmNzQ0OCAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbS5jCkBAIC0xNzgsNyArMTc4LDcgQEAgaW50IGk5MTVfZ2VtX29iamVjdF91
bmJpbmQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlsaXN0X3NwbGljZV9pbml0
KCZzdGlsbF9pbl9saXN0LCAmb2JqLT52bWEubGlzdCk7CiAJc3Bpbl91bmxvY2soJm9iai0+dm1h
LmxvY2spOwogCi0JaWYgKHJldCA9PSAtRUFHQUlOICYmIGZsYWdzICYgSTkxNV9HRU1fT0JKRUNU
X1VOQklORF9BQ1RJVkUpIHsKKwlpZiAocmV0ID09IC1FQUdBSU4gJiYgZmxhZ3MgJiBJOTE1X0dF
TV9PQkpFQ1RfVU5CSU5EX0JBUlJJRVIpIHsKIAkJcmN1X2JhcnJpZXIoKTsgLyogZmx1c2ggdGhl
IGk5MTVfdm1fcmVsZWFzZSgpICovCiAJCWdvdG8gdHJ5X2FnYWluOwogCX0KLS0gCjIuMjQuMAoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4
IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

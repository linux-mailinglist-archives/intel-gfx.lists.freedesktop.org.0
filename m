Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id C309C3034E
	for <lists+intel-gfx@lfdr.de>; Thu, 30 May 2019 22:35:20 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B11246E169;
	Thu, 30 May 2019 20:35:18 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BF3196E169
 for <intel-gfx@lists.freedesktop.org>; Thu, 30 May 2019 20:35:16 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16740151-1500050 
 for multiple; Thu, 30 May 2019 21:35:03 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 30 May 2019 21:34:59 +0100
Message-Id: <20190530203500.26272-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 1/2] drm/i915: Track the purgeable objects on a
 separate eviction list
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q3VycmVudGx5IHRoZSBwdXJnZWFibGUgb2JqZWN0cywgSTkxNV9NQURWX0RPTlRORUVELCBhcmUg
bWl4ZWQgaW4gdGhlCm5vcm1hbCBib3VuZC91bmJvdW5kIGxpc3RzLiBFdmVyeSBzaHJpbmtlciBw
YXNzIHN0YXJ0cyB3aXRoIGFuIGF0dGVtcHQKdG8gcHVyZ2UgZnJvbSB0aGlzIHNldCBvZiB1bm5l
ZWRlZCBvYmplY3RzLCB3aGljaCBlbnRhaWxzIHVzIGRvaW5nIGEKd2FsayBvdmVyIGJvdGggbGlz
dHMgbG9va2luZyBmb3IgYW55IGNhbmRpZGF0ZXMuIElmIHRoZXJlIGFyZSBub25lLCBhbmQKc2lu
Y2Ugd2UgYXJlIHNocmlua2luZyB3ZSBjYW4gcmVhc29uYWJseSBhc3N1bWUgdGhhdCB0aGUgbGlz
dHMgYXJlCmZ1bGwhLCB0aGlzIGJlY29tZXMgYSB2ZXJ5IHNsb3cgZnV0aWxlIHdhbGsuCgpJZiB3
ZSBzZXBhcmF0ZSBvdXQgdGhlIHB1cmdlYWJsZSBvYmplY3RzIGludG8gb3duIGxpc3QsIHRoaXMg
c2VhcmNoIHRoZW4KYmVjb21lcyBpdHMgb3duIHBoYXNlIHRoYXQgaXMgcHJlZmVyZW50aWFsbHkg
aGFuZGxlZCBkdXJpbmcgc2hyaW5raW5nLgpJbnN0ZWFkIHRoZSBjb3N0IGJlY29tZXMgdGhhdCB3
ZSB0aGVuIG5lZWQgdG8gZmlsdGVyIHRoZSBwdXJnZWFibGUgbGlzdAppZiB3ZSB3YW50IHRvIGRp
c3Rpbmd1aXNoIGJldHdlZW4gYm91bmQgYW5kIHVuYm91bmQgb2JqZWN0cy4KClNpZ25lZC1vZmYt
Ynk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogSm9vbmFzIExh
aHRpbmVuIDxqb29uYXMubGFodGluZW5AbGludXguaW50ZWwuY29tPgpDYzogTWF0dGhldyBBdWxk
IDxtYXR0aGV3LndpbGxpYW0uYXVsZEBnbWFpbC5jb20+ClJldmlld2VkLWJ5OiBNYXR0aGV3IEF1
bGQgPG1hdHRoZXcud2lsbGlhbS5hdWxkQGdtYWlsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMgICB8IDE0ICsrKysrKysrLS0tLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYyAgIHwgMTEgKysrKysrKysrLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMgICAgICAgfCAgMSArCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2htZW0uYyAgICB8ICA0ICstLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jIHwgMjIgKysrKysrKysrLS0tLS0t
LS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggICAgICAgICAgICAgIHwgMTYg
KysrKysrKystLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgICAgICAgICAg
ICAgIHwgMjAgKysrKysrKysrKysrKysrKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Zt
YS5jICAgICAgICAgICAgICB8ICAzICsrLQogOCBmaWxlcyBjaGFuZ2VkLCA2MSBpbnNlcnRpb25z
KCspLCAzMCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fZG9tYWluLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
ZG9tYWluLmMKaW5kZXggY2NlOTZlNmM2ZTUyLi41MmI3M2U5MGM5ZjQgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMKQEAgLTQ2Miw3ICs0NjIsNiBAQCBpOTE1
X2dlbV9vYmplY3RfcGluX3RvX2Rpc3BsYXlfcGxhbmUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iaiwKIHN0YXRpYyB2b2lkIGk5MTVfZ2VtX29iamVjdF9idW1wX2luYWN0aXZlX2dndHQo
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7Ci0Jc3RydWN0IGxpc3RfaGVhZCAq
bGlzdDsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAogCUdFTV9CVUdfT04oIWk5MTVfZ2VtX29i
amVjdF9oYXNfcGlubmVkX3BhZ2VzKG9iaikpOwpAQCAtNDc2LDEwICs0NzUsMTUgQEAgc3RhdGlj
IHZvaWQgaTkxNV9nZW1fb2JqZWN0X2J1bXBfaW5hY3RpdmVfZ2d0dChzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqKQogCX0KIAltdXRleF91bmxvY2soJmk5MTUtPmdndHQudm0ubXV0ZXgp
OwogCi0Jc3Bpbl9sb2NrKCZpOTE1LT5tbS5vYmpfbG9jayk7Ci0JbGlzdCA9IG9iai0+YmluZF9j
b3VudCA/ICZpOTE1LT5tbS5ib3VuZF9saXN0IDogJmk5MTUtPm1tLnVuYm91bmRfbGlzdDsKLQls
aXN0X21vdmVfdGFpbCgmb2JqLT5tbS5saW5rLCBsaXN0KTsKLQlzcGluX3VubG9jaygmaTkxNS0+
bW0ub2JqX2xvY2spOworCWlmIChvYmotPm1tLm1hZHYgPT0gSTkxNV9NQURWX1dJTExORUVEKSB7
CisJCXN0cnVjdCBsaXN0X2hlYWQgKmxpc3Q7CisKKwkJc3Bpbl9sb2NrKCZpOTE1LT5tbS5vYmpf
bG9jayk7CisJCWxpc3QgPSBvYmotPmJpbmRfY291bnQgPworCQkJJmk5MTUtPm1tLmJvdW5kX2xp
c3QgOiAmaTkxNS0+bW0udW5ib3VuZF9saXN0OworCQlsaXN0X21vdmVfdGFpbCgmb2JqLT5tbS5s
aW5rLCBsaXN0KTsKKwkJc3Bpbl91bmxvY2soJmk5MTUtPm1tLm9ial9sb2NrKTsKKwl9CiB9CiAK
IHZvaWQKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmpl
Y3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYwppbmRleCBm
MDY0ODc2ZjEyMTQuLmE0Mjc2M2U0ZGQ1ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9vYmplY3QuYwpAQCAtMzM0LDkgKzMzNCwxOCBAQCB2b2lkIGk5MTVfZ2VtX2ZyZWVf
b2JqZWN0KHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqZ2VtX29iaikKIAlpZiAob2JqLT5tbS5xdWly
a2VkKQogCQlfX2k5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmopOwogCi0JaWYgKGRpc2Nh
cmRfYmFja2luZ19zdG9yYWdlKG9iaikpCisJaWYgKGRpc2NhcmRfYmFja2luZ19zdG9yYWdlKG9i
aikpIHsKKwkJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFz
ZS5kZXYpOworCiAJCW9iai0+bW0ubWFkdiA9IEk5MTVfTUFEVl9ET05UTkVFRDsKIAorCQlpZiAo
aTkxNV9nZW1fb2JqZWN0X2hhc19wYWdlcyhvYmopKSB7CisJCQlzcGluX2xvY2soJmk5MTUtPm1t
Lm9ial9sb2NrKTsKKwkJCWxpc3RfbW92ZV90YWlsKCZvYmotPm1tLmxpbmssICZpOTE1LT5tbS5w
dXJnZV9saXN0KTsKKwkJCXNwaW5fdW5sb2NrKCZpOTE1LT5tbS5vYmpfbG9jayk7CisJCX0KKwl9
CisKIAkvKgogCSAqIEJlZm9yZSB3ZSBmcmVlIHRoZSBvYmplY3QsIG1ha2Ugc3VyZSBhbnkgcHVy
ZSBSQ1Utb25seQogCSAqIHJlYWQtc2lkZSBjcml0aWNhbCBzZWN0aW9ucyBhcmUgY29tcGxldGUs
IGUuZy4KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKaW5kZXggMTE4OTBlOTZl
ZDY1Li44OWJiNmQ4MjJmNmUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5j
CkBAIC0xNjQsNiArMTY0LDcgQEAgdm9pZCBpOTE1X2dlbV9zdXNwZW5kX2xhdGUoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJc3RydWN0IGxpc3RfaGVhZCAqcGhhc2VzW10gPSB7CiAJ
CSZpOTE1LT5tbS51bmJvdW5kX2xpc3QsCiAJCSZpOTE1LT5tbS5ib3VuZF9saXN0LAorCQkmaTkx
NS0+bW0ucHVyZ2VfbGlzdCwKIAkJTlVMTAogCX0sICoqcGhhc2U7CiAKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaG1lbS5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX3NobWVtLmMKaW5kZXggNjY1ZjIyZWJmOGU4Li4xOWQ5ZWNkYjI4
OTQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaG1lbS5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaG1lbS5jCkBAIC04MCw5
ICs4MCw3IEBAIHN0YXRpYyBpbnQgc2htZW1fZ2V0X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmopCiAJc2dfcGFnZV9zaXplcyA9IDA7CiAJZm9yIChpID0gMDsgaSA8IHBhZ2Vf
Y291bnQ7IGkrKykgewogCQljb25zdCB1bnNpZ25lZCBpbnQgc2hyaW5rW10gPSB7Ci0JCQkoSTkx
NV9TSFJJTktfQk9VTkQgfAotCQkJIEk5MTVfU0hSSU5LX1VOQk9VTkQgfAotCQkJIEk5MTVfU0hS
SU5LX1BVUkdFQUJMRSksCisJCQlJOTE1X1NIUklOS19CT1VORCB8IEk5MTVfU0hSSU5LX1VOQk9V
TkQsCiAJCQkwLAogCQl9LCAqcyA9IHNocmluazsKIAkJZ2ZwX3QgZ2ZwID0gbm9yZWNsYWltOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYwppbmRleCBjZDQy
Mjk5ZjAxOWEuLjZhOTNlMzI2YWJmMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX3Nocmlua2VyLmMKQEAgLTE0NCw2ICsxNDQsNyBAQCBpOTE1X2dlbV9zaHJpbmsoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCXN0cnVjdCBsaXN0X2hlYWQgKmxpc3Q7CiAJ
CXVuc2lnbmVkIGludCBiaXQ7CiAJfSBwaGFzZXNbXSA9IHsKKwkJeyAmaTkxNS0+bW0ucHVyZ2Vf
bGlzdCwgfjB1IH0sCiAJCXsgJmk5MTUtPm1tLnVuYm91bmRfbGlzdCwgSTkxNV9TSFJJTktfVU5C
T1VORCB9LAogCQl7ICZpOTE1LT5tbS5ib3VuZF9saXN0LCBJOTE1X1NIUklOS19CT1VORCB9LAog
CQl7IE5VTEwsIDAgfSwKQEAgLTIyNiwxMCArMjI3LDYgQEAgaTkxNV9nZW1fc2hyaW5rKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCQkJICAgICAgIG1tLmxpbmspKSkgewogCQkJ
bGlzdF9tb3ZlX3RhaWwoJm9iai0+bW0ubGluaywgJnN0aWxsX2luX2xpc3QpOwogCi0JCQlpZiAo
ZmxhZ3MgJiBJOTE1X1NIUklOS19QVVJHRUFCTEUgJiYKLQkJCSAgICBvYmotPm1tLm1hZHYgIT0g
STkxNV9NQURWX0RPTlRORUVEKQotCQkJCWNvbnRpbnVlOwotCiAJCQlpZiAoZmxhZ3MgJiBJOTE1
X1NIUklOS19WTUFQUyAmJgogCQkJICAgICFpc192bWFsbG9jX2FkZHIob2JqLT5tbS5tYXBwaW5n
KSkKIAkJCQljb250aW51ZTsKQEAgLTIzOSw2ICsyMzYsMTAgQEAgaTkxNV9nZW1fc2hyaW5rKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgICBpOTE1X2dlbV9vYmplY3RfaXNf
ZnJhbWVidWZmZXIob2JqKSkpCiAJCQkJY29udGludWU7CiAKKwkJCWlmICghKGZsYWdzICYgSTkx
NV9TSFJJTktfQk9VTkQpICYmCisJCQkgICAgUkVBRF9PTkNFKG9iai0+YmluZF9jb3VudCkpCisJ
CQkJY29udGludWU7CisKIAkJCWlmICghY2FuX3JlbGVhc2VfcGFnZXMob2JqKSkKIAkJCQljb250
aW51ZTsKIApAQCAtMzI0LDYgKzMyNSwxMSBAQCBpOTE1X2dlbV9zaHJpbmtlcl9jb3VudChzdHJ1
Y3Qgc2hyaW5rZXIgKnNocmlua2VyLCBzdHJ1Y3Qgc2hyaW5rX2NvbnRyb2wgKnNjKQogCQkJY291
bnQgKz0gb2JqLT5iYXNlLnNpemUgPj4gUEFHRV9TSElGVDsKIAkJCW51bV9vYmplY3RzKys7CiAJ
CX0KKwlsaXN0X2Zvcl9lYWNoX2VudHJ5KG9iaiwgJmk5MTUtPm1tLnB1cmdlX2xpc3QsIG1tLmxp
bmspCisJCWlmICghaTkxNV9nZW1fb2JqZWN0X2lzX2FjdGl2ZShvYmopICYmIGNhbl9yZWxlYXNl
X3BhZ2VzKG9iaikpIHsKKwkJCWNvdW50ICs9IG9iai0+YmFzZS5zaXplID4+IFBBR0VfU0hJRlQ7
CisJCQludW1fb2JqZWN0cysrOworCQl9CiAJc3Bpbl91bmxvY2soJmk5MTUtPm1tLm9ial9sb2Nr
KTsKIAogCS8qIFVwZGF0ZSBvdXIgcHJlZmVycmVkIHZtc2NhbiBiYXRjaCBzaXplIGZvciB0aGUg
bmV4dCBwYXNzLgpAQCAtMzYxLDE1ICszNjcsNyBAQCBpOTE1X2dlbV9zaHJpbmtlcl9zY2FuKHN0
cnVjdCBzaHJpbmtlciAqc2hyaW5rZXIsIHN0cnVjdCBzaHJpbmtfY29udHJvbCAqc2MpCiAJCQkJ
JnNjLT5ucl9zY2FubmVkLAogCQkJCUk5MTVfU0hSSU5LX0JPVU5EIHwKIAkJCQlJOTE1X1NIUklO
S19VTkJPVU5EIHwKLQkJCQlJOTE1X1NIUklOS19QVVJHRUFCTEUgfAogCQkJCUk5MTVfU0hSSU5L
X1dSSVRFQkFDSyk7Ci0JaWYgKHNjLT5ucl9zY2FubmVkIDwgc2MtPm5yX3RvX3NjYW4pCi0JCWZy
ZWVkICs9IGk5MTVfZ2VtX3NocmluayhpOTE1LAotCQkJCQkgc2MtPm5yX3RvX3NjYW4gLSBzYy0+
bnJfc2Nhbm5lZCwKLQkJCQkJICZzYy0+bnJfc2Nhbm5lZCwKLQkJCQkJIEk5MTVfU0hSSU5LX0JP
VU5EIHwKLQkJCQkJIEk5MTVfU0hSSU5LX1VOQk9VTkQgfAotCQkJCQkgSTkxNV9TSFJJTktfV1JJ
VEVCQUNLKTsKIAlpZiAoc2MtPm5yX3NjYW5uZWQgPCBzYy0+bnJfdG9fc2NhbiAmJiBjdXJyZW50
X2lzX2tzd2FwZCgpKSB7CiAJCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9kcnYuaAppbmRleCA0ZWI4ZjZhMTgxYzEuLmZiMmU4OTEzM2U3OCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2Rydi5oCkBAIC04NjQsNiArODY0LDEwIEBAIHN0cnVjdCBpOTE1X2dlbV9tbSB7CiAJ
ICogbm90IGFjdHVhbGx5IGhhdmUgYW55IHBhZ2VzIGF0dGFjaGVkLgogCSAqLwogCXN0cnVjdCBs
aXN0X2hlYWQgdW5ib3VuZF9saXN0OworCS8qKgorCSAqIExpc3Qgb2Ygb2JqZWN0cyB3aGljaCBh
cmUgcHVyZ2VhYmxlLiBNYXkgYmUgYWN0aXZlLgorCSAqLworCXN0cnVjdCBsaXN0X2hlYWQgcHVy
Z2VfbGlzdDsKIAogCS8qKiBMaXN0IG9mIGFsbCBvYmplY3RzIGluIGd0dF9zcGFjZSwgY3VycmVu
dGx5IG1tYXBlZCBieSB1c2Vyc3BhY2UuCiAJICogQWxsIG9iamVjdHMgd2l0aGluIHRoaXMgbGlz
dCBtdXN0IGFsc28gYmUgb24gYm91bmRfbGlzdC4KQEAgLTI4NjYsMTIgKzI4NzAsMTIgQEAgdW5z
aWduZWQgbG9uZyBpOTE1X2dlbV9zaHJpbmsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CiAJCQkgICAgICB1bnNpZ25lZCBsb25nIHRhcmdldCwKIAkJCSAgICAgIHVuc2lnbmVkIGxvbmcg
Km5yX3NjYW5uZWQsCiAJCQkgICAgICB1bnNpZ25lZCBmbGFncyk7Ci0jZGVmaW5lIEk5MTVfU0hS
SU5LX1BVUkdFQUJMRQlCSVQoMCkKLSNkZWZpbmUgSTkxNV9TSFJJTktfVU5CT1VORAlCSVQoMSkK
LSNkZWZpbmUgSTkxNV9TSFJJTktfQk9VTkQJQklUKDIpCi0jZGVmaW5lIEk5MTVfU0hSSU5LX0FD
VElWRQlCSVQoMykKLSNkZWZpbmUgSTkxNV9TSFJJTktfVk1BUFMJQklUKDQpCi0jZGVmaW5lIEk5
MTVfU0hSSU5LX1dSSVRFQkFDSwlCSVQoNSkKKyNkZWZpbmUgSTkxNV9TSFJJTktfVU5CT1VORAlC
SVQoMCkKKyNkZWZpbmUgSTkxNV9TSFJJTktfQk9VTkQJQklUKDEpCisjZGVmaW5lIEk5MTVfU0hS
SU5LX0FDVElWRQlCSVQoMikKKyNkZWZpbmUgSTkxNV9TSFJJTktfVk1BUFMJQklUKDMpCisjZGVm
aW5lIEk5MTVfU0hSSU5LX1dSSVRFQkFDSwlCSVQoNCkKKwogdW5zaWduZWQgbG9uZyBpOTE1X2dl
bV9zaHJpbmtfYWxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIHZvaWQgaTkxNV9n
ZW1fc2hyaW5rZXJfcmVnaXN0ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogdm9p
ZCBpOTE1X2dlbV9zaHJpbmtlcl91bnJlZ2lzdGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IGU1YWFmYmViMWQxOS4uZDk4Y2NiYmRl
NTNjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTEwOTUsNyArMTA5NSw3IEBAIGludAog
aTkxNV9nZW1fbWFkdmlzZV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRh
LAogCQkgICAgICAgc3RydWN0IGRybV9maWxlICpmaWxlX3ByaXYpCiB7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fbWFkdmlz
ZSAqYXJncyA9IGRhdGE7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKIAlpbnQg
ZXJyOwpAQCAtMTExOCw3ICsxMTE4LDcgQEAgaTkxNV9nZW1fbWFkdmlzZV9pb2N0bChzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCiAJaWYgKGk5MTVfZ2VtX29iamVjdF9oYXNf
cGFnZXMob2JqKSAmJgogCSAgICBpOTE1X2dlbV9vYmplY3RfaXNfdGlsZWQob2JqKSAmJgotCSAg
ICBkZXZfcHJpdi0+cXVpcmtzICYgUVVJUktfUElOX1NXSVpaTEVEX1BBR0VTKSB7CisJICAgIGk5
MTUtPnF1aXJrcyAmIFFVSVJLX1BJTl9TV0laWkxFRF9QQUdFUykgewogCQlpZiAob2JqLT5tbS5t
YWR2ID09IEk5MTVfTUFEVl9XSUxMTkVFRCkgewogCQkJR0VNX0JVR19PTighb2JqLT5tbS5xdWly
a2VkKTsKIAkJCV9faTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKG9iaik7CkBAIC0xMTM0LDYg
KzExMzQsMjAgQEAgaTkxNV9nZW1fbWFkdmlzZV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
LCB2b2lkICpkYXRhLAogCWlmIChvYmotPm1tLm1hZHYgIT0gX19JOTE1X01BRFZfUFVSR0VEKQog
CQlvYmotPm1tLm1hZHYgPSBhcmdzLT5tYWR2OwogCisJaWYgKGk5MTVfZ2VtX29iamVjdF9oYXNf
cGFnZXMob2JqKSkgeworCQlzdHJ1Y3QgbGlzdF9oZWFkICpsaXN0OworCisJCXNwaW5fbG9jaygm
aTkxNS0+bW0ub2JqX2xvY2spOworCQlpZiAob2JqLT5tbS5tYWR2ICE9IEk5MTVfTUFEVl9XSUxM
TkVFRCkKKwkJCWxpc3QgPSAmaTkxNS0+bW0ucHVyZ2VfbGlzdDsKKwkJZWxzZSBpZiAob2JqLT5i
aW5kX2NvdW50KQorCQkJbGlzdCA9ICZpOTE1LT5tbS5ib3VuZF9saXN0OworCQllbHNlCisJCQls
aXN0ID0gJmk5MTUtPm1tLnVuYm91bmRfbGlzdDsKKwkJbGlzdF9tb3ZlX3RhaWwoJm9iai0+bW0u
bGluaywgbGlzdCk7CisJCXNwaW5fdW5sb2NrKCZpOTE1LT5tbS5vYmpfbG9jayk7CisJfQorCiAJ
LyogaWYgdGhlIG9iamVjdCBpcyBubyBsb25nZXIgYXR0YWNoZWQsIGRpc2NhcmQgaXRzIGJhY2tp
bmcgc3RvcmFnZSAqLwogCWlmIChvYmotPm1tLm1hZHYgPT0gSTkxNV9NQURWX0RPTlRORUVEICYm
CiAJICAgICFpOTE1X2dlbV9vYmplY3RfaGFzX3BhZ2VzKG9iaikpCkBAIC0xNzQyLDYgKzE3NTYs
NyBAQCBzdGF0aWMgdm9pZCBpOTE1X2dlbV9pbml0X19tbShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKIAogCWluaXRfbGxpc3RfaGVhZCgmaTkxNS0+bW0uZnJlZV9saXN0KTsKIAorCUlO
SVRfTElTVF9IRUFEKCZpOTE1LT5tbS5wdXJnZV9saXN0KTsKIAlJTklUX0xJU1RfSEVBRCgmaTkx
NS0+bW0udW5ib3VuZF9saXN0KTsKIAlJTklUX0xJU1RfSEVBRCgmaTkxNS0+bW0uYm91bmRfbGlz
dCk7CiAJSU5JVF9MSVNUX0hFQUQoJmk5MTUtPm1tLmZlbmNlX2xpc3QpOwpAQCAtMTgzNiw2ICsx
ODUxLDcgQEAgaW50IGk5MTVfZ2VtX2ZyZWV6ZV9sYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQogCQkJaTkxNV9nZW1fb2JqZWN0X3VubG9jayhvYmopOwogCQl9CiAJfQorCUdFTV9C
VUdfT04oIWxpc3RfZW1wdHkoJmk5MTUtPm1tLnB1cmdlX2xpc3QpKTsKIAogCXJldHVybiAwOwog
fQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKaW5kZXggNTlhMmY2YWY2MTAzLi5mNjQwY2FlYzRiYWUg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwpAQCAtNzE3LDcgKzcxNyw4IEBAIGk5MTVfdm1hX3Jl
bW92ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAkJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iaiA9IHZtYS0+b2JqOwogCiAJCXNwaW5fbG9jaygmaTkxNS0+bW0ub2JqX2xvY2spOwotCQlp
ZiAoLS1vYmotPmJpbmRfY291bnQgPT0gMCkKKwkJaWYgKC0tb2JqLT5iaW5kX2NvdW50ID09IDAg
JiYKKwkJICAgIG9iai0+bW0ubWFkdiA9PSBJOTE1X01BRFZfV0lMTE5FRUQpCiAJCQlsaXN0X21v
dmVfdGFpbCgmb2JqLT5tbS5saW5rLCAmaTkxNS0+bW0udW5ib3VuZF9saXN0KTsKIAkJc3Bpbl91
bmxvY2soJmk5MTUtPm1tLm9ial9sb2NrKTsKIAotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0Cklu
dGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

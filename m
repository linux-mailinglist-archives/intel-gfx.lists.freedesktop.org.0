Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id AF8B745542
	for <lists+intel-gfx@lfdr.de>; Fri, 14 Jun 2019 09:10:36 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7D2F388EFF;
	Fri, 14 Jun 2019 07:10:34 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D633E89333
 for <intel-gfx@lists.freedesktop.org>; Fri, 14 Jun 2019 07:10:32 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16897528-1500050 
 for multiple; Fri, 14 Jun 2019 08:10:30 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 14 Jun 2019 08:10:07 +0100
Message-Id: <20190614071023.17929-24-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190614071023.17929-1-chris@chris-wilson.co.uk>
References: <20190614071023.17929-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 23/39] drm/i915: Extract intel_frontbuffer
 active tracking
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TW92ZSB0aGUgYWN0aXZlIHRyYWNraW5nIGZvciB0aGUgZnJvbnRidWZmZXIgb3BlcmF0aW9ucyBv
dXQgb2YgdGhlCmk5MTVfZ2VtX29iamVjdCBhbmQgaW50byBpdHMgb3duIGZpcnN0IGNsYXNzIChy
ZWZjb3VudGVkKSBvYmplY3QuIEluIHRoZQpwcm9jZXNzIG9mIGRldGFuZ2xpbmcsIHdlIHN3aXRj
aCBmcm9tIGxvdyBsZXZlbCByZXF1ZXN0IHRyYWNraW5nIHRvIHRoZQplYXNpZXIgaTkxNV9hY3Rp
dmUgLS0gd2l0aCB0aGUgcGxhbiB0aGF0IHRoaXMgYXZvaWRzIGFueSBwb3RlbnRpYWwKYXRvbWlj
IGNhbGxiYWNrcyBhcyB0aGUgZnJvbnRidWZmZXIgdHJhY2tpbmcgd2lzaGVzIHRvIHNsZWVwIGFz
IGl0CmZsdXNoZXMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdp
bHNvbi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xmbHVz
aC5jICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4u
YyAgICB8ICAxNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYyAg
ICAgIHwgICA0IC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYyAg
ICB8ICAyOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oICAg
IHwgICAyICstCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaCAg
fCAgIDggKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jICAgICAgICAgICB8
ICAgNSAtCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oICAgICAgICAgICAgICAgfCAg
IDQgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyAgICAgICAgICAgICAgIHwgIDQ3
ICstLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMgICAgICAgICAgICAgICB8ICAg
NiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZGlzcGxheS5jICAgICAgICAgIHwgIDY3
ICsrKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcnYuaCAgICAgICAgICAgICAgfCAg
IDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZmJkZXYuYyAgICAgICAgICAgIHwgIDIy
ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9mcm9udGJ1ZmZlci5jICAgICAgfCAyNDQg
KysrKysrKysrKysrKy0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9mcm9udGJ1ZmZl
ci5oICAgICAgfCAgNzAgKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX292ZXJsYXku
YyAgICAgICAgICB8ICAgOCArLQogMTYgZmlsZXMgY2hhbmdlZCwgMjk0IGluc2VydGlvbnMoKyks
IDIzOCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fY2xmbHVzaC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2Ns
Zmx1c2guYwppbmRleCA1MzdhYTIzMzdjYzguLjU0YjQ0NzUzOTQzMCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsZmx1c2guYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xmbHVzaC5jCkBAIC00Nyw3ICs0Nyw3IEBAIHN0YXRp
YyB2b2lkIF9faTkxNV9kb19jbGZsdXNoKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmop
CiB7CiAJR0VNX0JVR19PTighaTkxNV9nZW1fb2JqZWN0X2hhc19wYWdlcyhvYmopKTsKIAlkcm1f
Y2xmbHVzaF9zZyhvYmotPm1tLnBhZ2VzKTsKLQlpbnRlbF9mYl9vYmpfZmx1c2gob2JqLCBPUklH
SU5fQ1BVKTsKKwlpbnRlbF9mcm9udGJ1ZmZlcl9mbHVzaChvYmotPmZyb250YnVmZmVyLCBPUklH
SU5fQ1BVKTsKIH0KIAogc3RhdGljIHZvaWQgaTkxNV9jbGZsdXNoX3dvcmsoc3RydWN0IHdvcmtf
c3RydWN0ICp3b3JrKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX2RvbWFpbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5j
CmluZGV4IGJkMTgwZWY0NmFlYi4uN2U2ZWQ3NjczNDhjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jCkBAIC01NTAsMTMgKzU1MCw2IEBAIGk5MTVfZ2VtX29i
amVjdF9zZXRfdG9fY3B1X2RvbWFpbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCBi
b29sIHdyaXRlKQogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW5saW5lIGVudW0gZmJfb3Bfb3Jp
Z2luCi1mYl93cml0ZV9vcmlnaW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgdW5z
aWduZWQgaW50IGRvbWFpbikKLXsKLQlyZXR1cm4gKGRvbWFpbiA9PSBJOTE1X0dFTV9ET01BSU5f
R1RUID8KLQkJb2JqLT5mcm9udGJ1ZmZlcl9nZ3R0X29yaWdpbiA6IE9SSUdJTl9DUFUpOwotfQot
CiAvKioKICAqIENhbGxlZCB3aGVuIHVzZXIgc3BhY2UgcHJlcGFyZXMgdG8gdXNlIGFuIG9iamVj
dCB3aXRoIHRoZSBDUFUsIGVpdGhlcgogICogdGhyb3VnaCB0aGUgbW1hcCBpb2N0bCdzIG1hcHBp
bmcgb3IgYSBHVFQgbWFwcGluZy4KQEAgLTY2MCw5ICs2NTMsOCBAQCBpOTE1X2dlbV9zZXRfZG9t
YWluX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAKIAlpOTE1X2dl
bV9vYmplY3RfdW5sb2NrKG9iaik7CiAKLQlpZiAod3JpdGVfZG9tYWluICE9IDApCi0JCWludGVs
X2ZiX29ial9pbnZhbGlkYXRlKG9iaiwKLQkJCQkJZmJfd3JpdGVfb3JpZ2luKG9iaiwgd3JpdGVf
ZG9tYWluKSk7CisJaWYgKHdyaXRlX2RvbWFpbikKKwkJaW50ZWxfZnJvbnRidWZmZXJfaW52YWxp
ZGF0ZShvYmotPmZyb250YnVmZmVyLCBPUklHSU5fQ1BVKTsKIAogb3V0X3VucGluOgogCWk5MTVf
Z2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmopOwpAQCAtNzgyLDcgKzc3NCw3IEBAIGludCBpOTE1
X2dlbV9vYmplY3RfcHJlcGFyZV93cml0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
LAogCX0KIAogb3V0OgotCWludGVsX2ZiX29ial9pbnZhbGlkYXRlKG9iaiwgT1JJR0lOX0NQVSk7
CisJaW50ZWxfZnJvbnRidWZmZXJfaW52YWxpZGF0ZShvYmotPmZyb250YnVmZmVyLCBPUklHSU5f
Q1BVKTsKIAlvYmotPm1tLmRpcnR5ID0gdHJ1ZTsKIAkvKiByZXR1cm4gd2l0aCB0aGUgcGFnZXMg
cGlubmVkICovCiAJcmV0dXJuIDA7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fbW1hbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21t
YW4uYwppbmRleCBhOGI4YjljMjgxZjEuLjQ5Y2Y5YWQ5N2JmYyAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fbW1hbi5jCkBAIC05OSw5ICs5OSw2IEBAIGk5MTVfZ2VtX21tYXBf
aW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJdXBfd3JpdGUoJm1t
LT5tbWFwX3NlbSk7CiAJCWlmIChJU19FUlJfVkFMVUUoYWRkcikpCiAJCQlnb3RvIGVycjsKLQot
CQkvKiBUaGlzIG1heSByYWNlLCBidXQgdGhhdCdzIG9rLCBpdCBvbmx5IGdldHMgc2V0ICovCi0J
CVdSSVRFX09OQ0Uob2JqLT5mcm9udGJ1ZmZlcl9nZ3R0X29yaWdpbiwgT1JJR0lOX0NQVSk7CiAJ
fQogCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKIApAQCAtMjgwLDcgKzI3Nyw2IEBAIHZtX2Zh
dWx0X3QgaTkxNV9nZW1fZmF1bHQoc3RydWN0IHZtX2ZhdWx0ICp2bWYpCiAJCSAqIFVzZXJzcGFj
ZSBpcyBub3cgd3JpdGluZyB0aHJvdWdoIGFuIHVudHJhY2tlZCBWTUEsIGFiYW5kb24KIAkJICog
YWxsIGhvcGUgdGhhdCB0aGUgaGFyZHdhcmUgaXMgYWJsZSB0byB0cmFjayBmdXR1cmUgd3JpdGVz
LgogCQkgKi8KLQkJb2JqLT5mcm9udGJ1ZmZlcl9nZ3R0X29yaWdpbiA9IE9SSUdJTl9DUFU7CiAK
IAkJdm1hID0gaTkxNV9nZW1fb2JqZWN0X2dndHRfcGluKG9iaiwgJnZpZXcsIDAsIDAsIGZsYWdz
KTsKIAkJaWYgKElTX0VSUih2bWEpICYmICF2aWV3LnR5cGUpIHsKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYwppbmRleCAwMTUyODU1M2Q0Y2MuLmVlODFhY2IwNGQ4
NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYwpAQCAtNDQs
MTYgKzQ0LDYgQEAgdm9pZCBpOTE1X2dlbV9vYmplY3RfZnJlZShzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqKQogCXJldHVybiBrbWVtX2NhY2hlX2ZyZWUoZ2xvYmFsLnNsYWJfb2JqZWN0
cywgb2JqKTsKIH0KIAotc3RhdGljIHZvaWQKLWZyb250YnVmZmVyX3JldGlyZShzdHJ1Y3QgaTkx
NV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLAotCQkgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1
ZXN0KQotewotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPQotCQljb250YWluZXJf
b2YoYWN0aXZlLCB0eXBlb2YoKm9iaiksIGZyb250YnVmZmVyX3dyaXRlKTsKLQotCWludGVsX2Zi
X29ial9mbHVzaChvYmosIE9SSUdJTl9DUyk7Ci19Ci0KIHZvaWQgaTkxNV9nZW1fb2JqZWN0X2lu
aXQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJCSAgY29uc3Qgc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3Rfb3BzICpvcHMpCiB7CkBAIC03MiwxMCArNjIsNiBAQCB2b2lkIGk5
MTVfZ2VtX29iamVjdF9pbml0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJcmVz
ZXJ2YXRpb25fb2JqZWN0X2luaXQoJm9iai0+X19idWlsdGluX3Jlc3YpOwogCW9iai0+cmVzdiA9
ICZvYmotPl9fYnVpbHRpbl9yZXN2OwogCi0Jb2JqLT5mcm9udGJ1ZmZlcl9nZ3R0X29yaWdpbiA9
IE9SSUdJTl9HVFQ7Ci0JaTkxNV9hY3RpdmVfcmVxdWVzdF9pbml0KCZvYmotPmZyb250YnVmZmVy
X3dyaXRlLAotCQkJCSBOVUxMLCBmcm9udGJ1ZmZlcl9yZXRpcmUpOwotCiAJb2JqLT5tbS5tYWR2
ID0gSTkxNV9NQURWX1dJTExORUVEOwogCUlOSVRfUkFESVhfVFJFRSgmb2JqLT5tbS5nZXRfcGFn
ZS5yYWRpeCwgR0ZQX0tFUk5FTCB8IF9fR0ZQX05PV0FSTik7CiAJbXV0ZXhfaW5pdCgmb2JqLT5t
bS5nZXRfcGFnZS5sb2NrKTsKQEAgLTIxNyw3ICsyMDMsNiBAQCBzdGF0aWMgdm9pZCBfX2k5MTVf
Z2VtX2ZyZWVfb2JqZWN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAogCQlHRU1f
QlVHX09OKGF0b21pY19yZWFkKCZvYmotPmJpbmRfY291bnQpKTsKIAkJR0VNX0JVR19PTihvYmot
PnVzZXJmYXVsdF9jb3VudCk7Ci0JCUdFTV9CVUdfT04oYXRvbWljX3JlYWQoJm9iai0+ZnJvbnRi
dWZmZXJfYml0cykpOwogCQlHRU1fQlVHX09OKCFsaXN0X2VtcHR5KCZvYmotPmx1dF9saXN0KSk7
CiAKIAkJaWYgKG9iai0+b3BzLT5yZWxlYXNlKQpAQCAtMzIyLDYgKzMwNyw4IEBAIHZvaWQgaTkx
NV9nZW1fZnJlZV9vYmplY3Qoc3RydWN0IGRybV9nZW1fb2JqZWN0ICpnZW1fb2JqKQogewogCXN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB0b19pbnRlbF9ibyhnZW1fb2JqKTsKIAor
CUdFTV9CVUdfT04oaTkxNV9nZW1fb2JqZWN0X2lzX2ZyYW1lYnVmZmVyKG9iaikpOworCiAJaWYg
KG9iai0+bW0ucXVpcmtlZCkKIAkJX19pOTE1X2dlbV9vYmplY3RfdW5waW5fcGFnZXMob2JqKTsK
IApAQCAtMzQ5LDEzICszMzYsNiBAQCB2b2lkIGk5MTVfZ2VtX2ZyZWVfb2JqZWN0KHN0cnVjdCBk
cm1fZ2VtX29iamVjdCAqZ2VtX29iaikKIAljYWxsX3JjdSgmb2JqLT5yY3UsIF9faTkxNV9nZW1f
ZnJlZV9vYmplY3RfcmN1KTsKIH0KIAotc3RhdGljIGlubGluZSBlbnVtIGZiX29wX29yaWdpbgot
ZmJfd3JpdGVfb3JpZ2luKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosIHVuc2lnbmVk
IGludCBkb21haW4pCi17Ci0JcmV0dXJuIChkb21haW4gPT0gSTkxNV9HRU1fRE9NQUlOX0dUVCA/
Ci0JCW9iai0+ZnJvbnRidWZmZXJfZ2d0dF9vcmlnaW4gOiBPUklHSU5fQ1BVKTsKLX0KLQogc3Rh
dGljIGJvb2wgZ3B1X3dyaXRlX25lZWRzX2NsZmx1c2goc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iaikKIHsKIAlyZXR1cm4gIShvYmotPmNhY2hlX2xldmVsID09IEk5MTVfQ0FDSEVfTk9O
RSB8fApAQCAtMzc3LDkgKzM1Nyw3IEBAIGk5MTVfZ2VtX29iamVjdF9mbHVzaF93cml0ZV9kb21h
aW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlzd2l0Y2ggKG9iai0+d3JpdGVf
ZG9tYWluKSB7CiAJY2FzZSBJOTE1X0dFTV9ET01BSU5fR1RUOgogCQlpOTE1X2dlbV9mbHVzaF9n
Z3R0X3dyaXRlcyhkZXZfcHJpdik7Ci0KLQkJaW50ZWxfZmJfb2JqX2ZsdXNoKG9iaiwKLQkJCQkg
ICBmYl93cml0ZV9vcmlnaW4ob2JqLCBJOTE1X0dFTV9ET01BSU5fR1RUKSk7CisJCWludGVsX2Zy
b250YnVmZmVyX2ZsdXNoKG9iai0+ZnJvbnRidWZmZXIsIE9SSUdJTl9DUFUpOwogCiAJCWZvcl9l
YWNoX2dndHRfdm1hKHZtYSwgb2JqKSB7CiAJCQlpZiAodm1hLT5pb21hcCkKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaCBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaAppbmRleCA0NTRiZmI0OTgwMDEuLjY3ZDcw
ZDE0NGJkOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29i
amVjdC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaApA
QCAtMTYxLDcgKzE2MSw3IEBAIGk5MTVfZ2VtX29iamVjdF9uZWVkc19hc3luY19jYW5jZWwoY29u
c3Qgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHN0YXRpYyBpbmxpbmUgYm9vbAog
aTkxNV9nZW1fb2JqZWN0X2lzX2ZyYW1lYnVmZmVyKGNvbnN0IHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmopCiB7Ci0JcmV0dXJuIFJFQURfT05DRShvYmotPmZyYW1lYnVmZmVyX3JlZmVy
ZW5jZXMpOworCXJldHVybiBSRUFEX09OQ0Uob2JqLT5mcm9udGJ1ZmZlcik7CiB9CiAKIHN0YXRp
YyBpbmxpbmUgdW5zaWduZWQgaW50CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fb2JqZWN0X3R5cGVzLmgKaW5kZXggYzI5OWZlZDJjNmIxLi4yMWJmYjdiZDBmNTcgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMu
aAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmgK
QEAgLTE1LDYgKzE1LDcgQEAKICNpbmNsdWRlICJpOTE1X3NlbGZ0ZXN0LmgiCiAKIHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0Oworc3RydWN0IGludGVsX2Zyb25idWZmZXI7CiAKIC8qCiAgKiBz
dHJ1Y3QgaTkxNV9sdXRfaGFuZGxlIHRyYWNrcyB0aGUgZmFzdCBsb29rdXBzIGZyb20gaGFuZGxl
IHRvIHZtYSB1c2VkCkBAIC0xNDQsOSArMTQ1LDcgQEAgc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgewogCSAqLwogCXUxNiB3cml0ZV9kb21haW47CiAKLQlhdG9taWNfdCBmcm9udGJ1ZmZlcl9i
aXRzOwotCXVuc2lnbmVkIGludCBmcm9udGJ1ZmZlcl9nZ3R0X29yaWdpbjsgLyogd3JpdGUgb25j
ZSAqLwotCXN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0IGZyb250YnVmZmVyX3dyaXRlOworCXN0
cnVjdCBpbnRlbF9mcm9udGJ1ZmZlciAqZnJvbnRidWZmZXI7CiAKIAkvKiogQ3VycmVudCB0aWxp
bmcgc3RyaWRlIGZvciB0aGUgb2JqZWN0LCBpZiBpdCdzIHRpbGVkLiAqLwogCXVuc2lnbmVkIGlu
dCB0aWxpbmdfYW5kX3N0cmlkZTsKQEAgLTIzOSw5ICsyMzgsNiBAQCBzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCB7CiAJICovCiAJc3RydWN0IHJlc2VydmF0aW9uX29iamVjdCAqcmVzdjsKIAot
CS8qKiBSZWZlcmVuY2VzIGZyb20gZnJhbWVidWZmZXJzLCBsb2NrcyBvdXQgdGlsaW5nIGNoYW5n
ZXMuICovCi0JdW5zaWduZWQgaW50IGZyYW1lYnVmZmVyX3JlZmVyZW5jZXM7Ci0KIAkvKiogUmVj
b3JkIG9mIGFkZHJlc3MgYml0IDE3IG9mIGVhY2ggcGFnZSBhdCBsYXN0IHVuYmluZC4gKi8KIAl1
bnNpZ25lZCBsb25nICpiaXRfMTc7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZGVidWdmcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKaW5k
ZXggODVkZDI0NDhlZjgxLi5hM2YxYWZmM2M1YzIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZGVidWdmcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVi
dWdmcy5jCkBAIC0xMzUsNyArMTM1LDYgQEAgZGVzY3JpYmVfb2JqKHN0cnVjdCBzZXFfZmlsZSAq
bSwgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZTsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKLQl1bnNpZ25lZCBpbnQg
ZnJvbnRidWZmZXJfYml0czsKIAlpbnQgcGluX2NvdW50ID0gMDsKIAogCXNlcV9wcmludGYobSwg
IiVwSzogJWMlYyVjJWMgJTh6ZEtpQiAlMDJ4ICUwMnggJXMlcyVzIiwKQEAgLTIyNSwxMCArMjI0
LDYgQEAgZGVzY3JpYmVfb2JqKHN0cnVjdCBzZXFfZmlsZSAqbSwgc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaikKIAllbmdpbmUgPSBpOTE1X2dlbV9vYmplY3RfbGFzdF93cml0ZV9lbmdp
bmUob2JqKTsKIAlpZiAoZW5naW5lKQogCQlzZXFfcHJpbnRmKG0sICIgKCVzKSIsIGVuZ2luZS0+
bmFtZSk7Ci0KLQlmcm9udGJ1ZmZlcl9iaXRzID0gYXRvbWljX3JlYWQoJm9iai0+ZnJvbnRidWZm
ZXJfYml0cyk7Ci0JaWYgKGZyb250YnVmZmVyX2JpdHMpCi0JCXNlcV9wcmludGYobSwgIiAoZnJv
bnRidWZmZXI6IDB4JTAzeCkiLCBmcm9udGJ1ZmZlcl9iaXRzKTsKIH0KIAogc3RydWN0IGZpbGVf
c3RhdHMgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKaW5kZXggMzY4M2VmNmQ0YzI4Li4zYzkzMTc1
OTI3MjkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaApAQCAtMjU4MywxMCArMjU4Myw2IEBAIGlu
dCBpOTE1X2dlbV9tbWFwX2d0dChzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdiwgc3RydWN0IGRy
bV9kZXZpY2UgKmRldiwKIAkJICAgICAgdTMyIGhhbmRsZSwgdTY0ICpvZmZzZXQpOwogaW50IGk5
MTVfZ2VtX21tYXBfZ3R0X3ZlcnNpb24odm9pZCk7CiAKLXZvaWQgaTkxNV9nZW1fdHJhY2tfZmIo
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9sZCwKLQkJICAgICAgIHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpuZXcsCi0JCSAgICAgICB1bnNpZ25lZCBmcm9udGJ1ZmZlcl9iaXRzKTsK
LQogaW50IF9fbXVzdF9jaGVjayBpOTE1X2dlbV9zZXRfZ2xvYmFsX3NlcW5vKHN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYsIHUzMiBzZXFubyk7CiAKIHN0YXRpYyBpbmxpbmUgYm9vbCBfX2k5MTVfd2Vk
Z2VkKHN0cnVjdCBpOTE1X2dwdV9lcnJvciAqZXJyb3IpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwpp
bmRleCAzMTRjNTMyNDkwZGYuLjk0MjI4MjFjOWQ1OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5j
CkBAIC0xMzMsMTcgKzEzMywxOSBAQCBpOTE1X2dlbV9waHlzX3B3cml0ZShzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqLAogCXZvaWQgKnZhZGRyID0gb2JqLT5waHlzX2hhbmRsZS0+dmFk
ZHIgKyBhcmdzLT5vZmZzZXQ7CiAJY2hhciBfX3VzZXIgKnVzZXJfZGF0YSA9IHU2NF90b191c2Vy
X3B0cihhcmdzLT5kYXRhX3B0cik7CiAKLQkvKiBXZSBtYW51YWxseSBjb250cm9sIHRoZSBkb21h
aW4gaGVyZSBhbmQgcHJldGVuZCB0aGF0IGl0CisJLyoKKwkgKiBXZSBtYW51YWxseSBjb250cm9s
IHRoZSBkb21haW4gaGVyZSBhbmQgcHJldGVuZCB0aGF0IGl0CiAJICogcmVtYWlucyBjb2hlcmVu
dCBpLmUuIGluIHRoZSBHVFQgZG9tYWluLCBsaWtlIHNobWVtX3B3cml0ZS4KIAkgKi8KLQlpbnRl
bF9mYl9vYmpfaW52YWxpZGF0ZShvYmosIE9SSUdJTl9DUFUpOworCWludGVsX2Zyb250YnVmZmVy
X2ludmFsaWRhdGUob2JqLT5mcm9udGJ1ZmZlciwgT1JJR0lOX0NQVSk7CisKIAlpZiAoY29weV9m
cm9tX3VzZXIodmFkZHIsIHVzZXJfZGF0YSwgYXJncy0+c2l6ZSkpCiAJCXJldHVybiAtRUZBVUxU
OwogCiAJZHJtX2NsZmx1c2hfdmlydF9yYW5nZSh2YWRkciwgYXJncy0+c2l6ZSk7CiAJaTkxNV9n
ZW1fY2hpcHNldF9mbHVzaCh0b19pOTE1KG9iai0+YmFzZS5kZXYpKTsKIAotCWludGVsX2ZiX29i
al9mbHVzaChvYmosIE9SSUdJTl9DUFUpOworCWludGVsX2Zyb250YnVmZmVyX2ZsdXNoKG9iai0+
ZnJvbnRidWZmZXIsIE9SSUdJTl9DUFUpOwogCXJldHVybiAwOwogfQogCkBAIC02MzAsNyArNjMy
LDcgQEAgaTkxNV9nZW1fZ3R0X3B3cml0ZV9mYXN0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmosCiAJCWdvdG8gb3V0X3VucGluOwogCX0KIAotCWludGVsX2ZiX29ial9pbnZhbGlkYXRl
KG9iaiwgT1JJR0lOX0NQVSk7CisJaW50ZWxfZnJvbnRidWZmZXJfaW52YWxpZGF0ZShvYmotPmZy
b250YnVmZmVyLCBPUklHSU5fQ1BVKTsKIAogCXVzZXJfZGF0YSA9IHU2NF90b191c2VyX3B0cihh
cmdzLT5kYXRhX3B0cik7CiAJb2Zmc2V0ID0gYXJncy0+b2Zmc2V0OwpAQCAtNjcxLDcgKzY3Myw3
IEBAIGk5MTVfZ2VtX2d0dF9wd3JpdGVfZmFzdChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqLAogCQl1c2VyX2RhdGEgKz0gcGFnZV9sZW5ndGg7CiAJCW9mZnNldCArPSBwYWdlX2xlbmd0
aDsKIAl9Ci0JaW50ZWxfZmJfb2JqX2ZsdXNoKG9iaiwgT1JJR0lOX0NQVSk7CisJaW50ZWxfZnJv
bnRidWZmZXJfZmx1c2gob2JqLT5mcm9udGJ1ZmZlciwgT1JJR0lOX0NQVSk7CiAKIAlpOTE1X2dl
bV9vYmplY3RfdW5sb2NrX2ZlbmNlKG9iaiwgZmVuY2UpOwogb3V0X3VucGluOgpAQCAtNzY0LDcg
Kzc2Niw3IEBAIGk5MTVfZ2VtX3NobWVtX3B3cml0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqLAogCQlvZmZzZXQgPSAwOwogCX0KIAotCWludGVsX2ZiX29ial9mbHVzaChvYmosIE9S
SUdJTl9DUFUpOworCWludGVsX2Zyb250YnVmZmVyX2ZsdXNoKG9iai0+ZnJvbnRidWZmZXIsIE9S
SUdJTl9DUFUpOwogCWk5MTVfZ2VtX29iamVjdF91bmxvY2tfZmVuY2Uob2JqLCBmZW5jZSk7CiAK
IAlyZXR1cm4gcmV0OwpAQCAtMTg3MCwzOSArMTg3Miw2IEBAIGludCBpOTE1X2dlbV9vcGVuKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCiAJcmV0
dXJuIHJldDsKIH0KIAotLyoqCi0gKiBpOTE1X2dlbV90cmFja19mYiAtIHVwZGF0ZSBmcm9udGJ1
ZmZlciB0cmFja2luZwotICogQG9sZDogY3VycmVudCBHRU0gYnVmZmVyIGZvciB0aGUgZnJvbnRi
dWZmZXIgc2xvdHMKLSAqIEBuZXc6IG5ldyBHRU0gYnVmZmVyIGZvciB0aGUgZnJvbnRidWZmZXIg
c2xvdHMKLSAqIEBmcm9udGJ1ZmZlcl9iaXRzOiBiaXRtYXNrIG9mIGZyb250YnVmZmVyIHNsb3Rz
Ci0gKgotICogVGhpcyB1cGRhdGVzIHRoZSBmcm9udGJ1ZmZlciB0cmFja2luZyBiaXRzIEBmcm9u
dGJ1ZmZlcl9iaXRzIGJ5IGNsZWFyaW5nIHRoZW0KLSAqIGZyb20gQG9sZCBhbmQgc2V0dGluZyB0
aGVtIGluIEBuZXcuIEJvdGggQG9sZCBhbmQgQG5ldyBjYW4gYmUgTlVMTC4KLSAqLwotdm9pZCBp
OTE1X2dlbV90cmFja19mYihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2xkLAotCQkgICAg
ICAgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm5ldywKLQkJICAgICAgIHVuc2lnbmVkIGZy
b250YnVmZmVyX2JpdHMpCi17Ci0JLyogQ29udHJvbCBvZiBpbmRpdmlkdWFsIGJpdHMgd2l0aGlu
IHRoZSBtYXNrIGFyZSBndWFyZGVkIGJ5Ci0JICogdGhlIG93bmluZyBwbGFuZS0+bXV0ZXgsIGku
ZS4gd2UgY2FuIG5ldmVyIHNlZSBjb25jdXJyZW50Ci0JICogbWFuaXB1bGF0aW9uIG9mIGluZGl2
aWR1YWwgYml0cy4gQnV0IHNpbmNlIHRoZSBiaXRmaWVsZCBhcyBhIHdob2xlCi0JICogaXMgdXBk
YXRlZCB1c2luZyBSTVcsIHdlIG5lZWQgdG8gdXNlIGF0b21pY3MgaW4gb3JkZXIgdG8gdXBkYXRl
Ci0JICogdGhlIGJpdHMuCi0JICovCi0JQlVJTERfQlVHX09OKElOVEVMX0ZST05UQlVGRkVSX0JJ
VFNfUEVSX1BJUEUgKiBJOTE1X01BWF9QSVBFUyA+Ci0JCSAgICAgQklUU19QRVJfVFlQRShhdG9t
aWNfdCkpOwotCi0JaWYgKG9sZCkgewotCQlXQVJOX09OKCEoYXRvbWljX3JlYWQoJm9sZC0+ZnJv
bnRidWZmZXJfYml0cykgJiBmcm9udGJ1ZmZlcl9iaXRzKSk7Ci0JCWF0b21pY19hbmRub3QoZnJv
bnRidWZmZXJfYml0cywgJm9sZC0+ZnJvbnRidWZmZXJfYml0cyk7Ci0JfQotCi0JaWYgKG5ldykg
ewotCQlXQVJOX09OKGF0b21pY19yZWFkKCZuZXctPmZyb250YnVmZmVyX2JpdHMpICYgZnJvbnRi
dWZmZXJfYml0cyk7Ci0JCWF0b21pY19vcihmcm9udGJ1ZmZlcl9iaXRzLCAmbmV3LT5mcm9udGJ1
ZmZlcl9iaXRzKTsKLQl9Ci19Ci0KICNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9TRUxG
VEVTVCkKICNpbmNsdWRlICJzZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMiCiAjaW5jbHVkZSAi
c2VsZnRlc3RzL2k5MTVfZ2VtLmMiCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3ZtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwppbmRleCA5MjIxNzk0
NTFjYWEuLjA0MTYzOGE1MDAwNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV92bWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCkBAIC05MTgsOCAr
OTE4LDEwIEBAIGludCBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShzdHJ1Y3QgaTkxNV92bWEgKnZt
YSwKIAlpZiAoZmxhZ3MgJiBFWEVDX09CSkVDVF9XUklURSkgewogCQlvYmotPndyaXRlX2RvbWFp
biA9IEk5MTVfR0VNX0RPTUFJTl9SRU5ERVI7CiAKLQkJaWYgKGludGVsX2ZiX29ial9pbnZhbGlk
YXRlKG9iaiwgT1JJR0lOX0NTKSkKLQkJCV9faTkxNV9hY3RpdmVfcmVxdWVzdF9zZXQoJm9iai0+
ZnJvbnRidWZmZXJfd3JpdGUsIHJxKTsKKwkJaWYgKGludGVsX2Zyb250YnVmZmVyX2ludmFsaWRh
dGUob2JqLT5mcm9udGJ1ZmZlciwgT1JJR0lOX0NTKSkKKwkJCWk5MTVfYWN0aXZlX3JlZigmb2Jq
LT5mcm9udGJ1ZmZlci0+d3JpdGUsCisJCQkJCXJxLT5mZW5jZS5jb250ZXh0LAorCQkJCQlycSk7
CiAKIAkJb2JqLT5yZWFkX2RvbWFpbnMgPSAwOwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Rp
c3BsYXkuYwppbmRleCBlNjgxZWQ5OWNkZjIuLjcyZTJjMDRiNmUxMSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2ludGVsX2Rpc3BsYXkuYwpAQCAtMzA0NywxMiArMzA0NywxMyBAQCBpbnRlbF9hbGxvY19p
bml0aWFsX3BsYW5lX29iaihzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIHsKIAlzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShkZXYpOwotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
YmogPSBOVUxMOwogCXN0cnVjdCBkcm1fbW9kZV9mYl9jbWQyIG1vZGVfY21kID0geyAwIH07CiAJ
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSAmcGxhbmVfY29uZmlnLT5mYi0+YmFzZTsKIAl1
MzIgYmFzZV9hbGlnbmVkID0gcm91bmRfZG93bihwbGFuZV9jb25maWctPmJhc2UsIFBBR0VfU0la
RSk7CiAJdTMyIHNpemVfYWxpZ25lZCA9IHJvdW5kX3VwKHBsYW5lX2NvbmZpZy0+YmFzZSArIHBs
YW5lX2NvbmZpZy0+c2l6ZSwKIAkJCQkgICAgUEFHRV9TSVpFKTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqOworCWJvb2wgcmV0ID0gZmFsc2U7CiAKIAlzaXplX2FsaWduZWQgLT0g
YmFzZV9hbGlnbmVkOwogCkBAIC0zMDk0LDcgKzMwOTUsNyBAQCBpbnRlbF9hbGxvY19pbml0aWFs
X3BsYW5lX29iaihzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJYnJlYWs7CiAJZGVmYXVsdDoK
IAkJTUlTU0lOR19DQVNFKHBsYW5lX2NvbmZpZy0+dGlsaW5nKTsKLQkJcmV0dXJuIGZhbHNlOwor
CQlnb3RvIG91dDsKIAl9CiAKIAltb2RlX2NtZC5waXhlbF9mb3JtYXQgPSBmYi0+Zm9ybWF0LT5m
b3JtYXQ7CkBAIC0zMTA2LDE2ICszMTA3LDE1IEBAIGludGVsX2FsbG9jX2luaXRpYWxfcGxhbmVf
b2JqKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCiAJaWYgKGludGVsX2ZyYW1lYnVmZmVyX2lu
aXQodG9faW50ZWxfZnJhbWVidWZmZXIoZmIpLCBvYmosICZtb2RlX2NtZCkpIHsKIAkJRFJNX0RF
QlVHX0tNUygiaW50ZWwgZmIgaW5pdCBmYWlsZWRcbiIpOwotCQlnb3RvIG91dF91bnJlZl9vYmo7
CisJCWdvdG8gb3V0OwogCX0KIAogCiAJRFJNX0RFQlVHX0tNUygiaW5pdGlhbCBwbGFuZSBmYiBv
YmogJXBcbiIsIG9iaik7Ci0JcmV0dXJuIHRydWU7Ci0KLW91dF91bnJlZl9vYmo6CisJcmV0ID0g
dHJ1ZTsKK291dDoKIAlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7Ci0JcmV0dXJuIGZhbHNlOwor
CXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyB2b2lkCkBAIC0zMTcyLDYgKzMxNzIsMTIgQEAgc3Rh
dGljIHZvaWQgaW50ZWxfcGxhbmVfZGlzYWJsZV9ub2F0b21pYyhzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YywKIAlpbnRlbF9kaXNhYmxlX3BsYW5lKHBsYW5lLCBjcnRjX3N0YXRlKTsKIH0KIAorc3Rh
dGljIHN0cnVjdCBpbnRlbF9mcm9udGJ1ZmZlciAqCit0b19pbnRlbF9mcm9udGJ1ZmZlcihzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYikKK3sKKwlyZXR1cm4gZmIgPyB0b19pbnRlbF9mcmFtZWJ1
ZmZlcihmYiktPmZyb250YnVmZmVyIDogTlVMTDsKK30KKwogc3RhdGljIHZvaWQKIGludGVsX2Zp
bmRfaW5pdGlhbF9wbGFuZV9vYmooc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMsCiAJCQkg
ICAgIHN0cnVjdCBpbnRlbF9pbml0aWFsX3BsYW5lX2NvbmZpZyAqcGxhbmVfY29uZmlnKQpAQCAt
MzE3OSw3ICszMTg1LDYgQEAgaW50ZWxfZmluZF9pbml0aWFsX3BsYW5lX29iaihzdHJ1Y3QgaW50
ZWxfY3J0YyAqaW50ZWxfY3J0YywKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gaW50ZWxfY3J0
Yy0+YmFzZS5kZXY7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShkZXYpOwogCXN0cnVjdCBkcm1fY3J0YyAqYzsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqOwogCXN0cnVjdCBkcm1fcGxhbmUgKnByaW1hcnkgPSBpbnRlbF9jcnRjLT5iYXNlLnBy
aW1hcnk7CiAJc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUgPSBwcmltYXJ5LT5z
dGF0ZTsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKmludGVsX3BsYW5lID0gdG9faW50ZWxfcGxhbmUo
cHJpbWFyeSk7CkBAIC0zMjU1LDggKzMyNjAsNyBAQCBpbnRlbF9maW5kX2luaXRpYWxfcGxhbmVf
b2JqKHN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjLAogCQlyZXR1cm47CiAJfQogCi0Jb2Jq
ID0gaW50ZWxfZmJfb2JqKGZiKTsKLQlpbnRlbF9mYl9vYmpfZmx1c2gob2JqLCBPUklHSU5fRElS
VFlGQik7CisJaW50ZWxfZnJvbnRidWZmZXJfZmx1c2godG9faW50ZWxfZnJvbnRidWZmZXIoZmIp
LCBPUklHSU5fRElSVFlGQik7CiAKIAlwbGFuZV9zdGF0ZS0+c3JjX3ggPSAwOwogCXBsYW5lX3N0
YXRlLT5zcmNfeSA9IDA7CkBAIC0zMjcxLDE0ICszMjc1LDE0IEBAIGludGVsX2ZpbmRfaW5pdGlh
bF9wbGFuZV9vYmooc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMsCiAJaW50ZWxfc3RhdGUt
PmJhc2Uuc3JjID0gZHJtX3BsYW5lX3N0YXRlX3NyYyhwbGFuZV9zdGF0ZSk7CiAJaW50ZWxfc3Rh
dGUtPmJhc2UuZHN0ID0gZHJtX3BsYW5lX3N0YXRlX2Rlc3QocGxhbmVfc3RhdGUpOwogCi0JaWYg
KGk5MTVfZ2VtX29iamVjdF9pc190aWxlZChvYmopKQorCWlmIChwbGFuZV9jb25maWctPnRpbGlu
ZykKIAkJZGV2X3ByaXYtPnByZXNlcnZlX2Jpb3Nfc3dpenpsZSA9IHRydWU7CiAKIAlwbGFuZV9z
dGF0ZS0+ZmIgPSBmYjsKIAlwbGFuZV9zdGF0ZS0+Y3J0YyA9ICZpbnRlbF9jcnRjLT5iYXNlOwog
CiAJYXRvbWljX29yKHRvX2ludGVsX3BsYW5lKHByaW1hcnkpLT5mcm9udGJ1ZmZlcl9iaXQsCi0J
CSAgJm9iai0+ZnJvbnRidWZmZXJfYml0cyk7CisJCSAgJnRvX2ludGVsX2Zyb250YnVmZmVyKGZi
KS0+Yml0cyk7CiB9CiAKIHN0YXRpYyBpbnQgc2tsX21heF9wbGFuZV93aWR0aChjb25zdCBzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKQEAgLTEzOTgxLDkgKzEzOTg1LDkgQEAgc3RhdGljIHZv
aWQgaW50ZWxfYXRvbWljX3RyYWNrX2ZicyhzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUp
CiAJaW50IGk7CiAKIAlmb3JfZWFjaF9vbGRuZXdfcGxhbmVfaW5fc3RhdGUoc3RhdGUsIHBsYW5l
LCBvbGRfcGxhbmVfc3RhdGUsIG5ld19wbGFuZV9zdGF0ZSwgaSkKLQkJaTkxNV9nZW1fdHJhY2tf
ZmIoaW50ZWxfZmJfb2JqKG9sZF9wbGFuZV9zdGF0ZS0+ZmIpLAotCQkJCSAgaW50ZWxfZmJfb2Jq
KG5ld19wbGFuZV9zdGF0ZS0+ZmIpLAotCQkJCSAgdG9faW50ZWxfcGxhbmUocGxhbmUpLT5mcm9u
dGJ1ZmZlcl9iaXQpOworCQlpbnRlbF9mcm9udGJ1ZmZlcl90cmFjayh0b19pbnRlbF9mcm9udGJ1
ZmZlcihvbGRfcGxhbmVfc3RhdGUtPmZiKSwKKwkJCQkJdG9faW50ZWxfZnJvbnRidWZmZXIobmV3
X3BsYW5lX3N0YXRlLT5mYiksCisJCQkJCXRvX2ludGVsX3BsYW5lKHBsYW5lKS0+ZnJvbnRidWZm
ZXJfYml0KTsKIH0KIAogLyoqCkBAIC0xNDI5Myw3ICsxNDI5Nyw3IEBAIGludGVsX3ByZXBhcmVf
cGxhbmVfZmIoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJCXJldHVybiByZXQ7CiAKIAlmYl9v
YmpfYnVtcF9yZW5kZXJfcHJpb3JpdHkob2JqKTsKLQlpbnRlbF9mYl9vYmpfZmx1c2gob2JqLCBP
UklHSU5fRElSVFlGQik7CisJaW50ZWxfZnJvbnRidWZmZXJfZmx1c2gob2JqLT5mcm9udGJ1ZmZl
ciwgT1JJR0lOX0RJUlRZRkIpOwogCiAJaWYgKCFuZXdfc3RhdGUtPmZlbmNlKSB7IC8qIGltcGxp
Y2l0IGZlbmNpbmcgKi8KIAkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CkBAIC0xNDU2MCwxMyAr
MTQ1NjQsMTIgQEAgaW50ZWxfbGVnYWN5X2N1cnNvcl91cGRhdGUoc3RydWN0IGRybV9wbGFuZSAq
cGxhbmUsCiAJCQkgICBzdHJ1Y3QgZHJtX21vZGVzZXRfYWNxdWlyZV9jdHggKmN0eCkKIHsKIAlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmRldik7Ci0J
aW50IHJldDsKIAlzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpvbGRfcGxhbmVfc3RhdGUsICpuZXdf
cGxhbmVfc3RhdGU7CiAJc3RydWN0IGludGVsX3BsYW5lICppbnRlbF9wbGFuZSA9IHRvX2ludGVs
X3BsYW5lKHBsYW5lKTsKLQlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpvbGRfZmI7CiAJc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUgPQogCQl0b19pbnRlbF9jcnRjX3N0YXRlKGNy
dGMtPnN0YXRlKTsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGU7CisJ
aW50IHJldDsKIAogCS8qCiAJICogV2hlbiBjcnRjIGlzIGluYWN0aXZlIG9yIHRoZXJlIGlzIGEg
bW9kZXNldCBwZW5kaW5nLApAQCAtMTQ2MzQsMTEgKzE0NjM3LDEwIEBAIGludGVsX2xlZ2FjeV9j
dXJzb3JfdXBkYXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCWlmIChyZXQpCiAJCWdvdG8g
b3V0X3VubG9jazsKIAotCWludGVsX2ZiX29ial9mbHVzaChpbnRlbF9mYl9vYmooZmIpLCBPUklH
SU5fRkxJUCk7Ci0KLQlvbGRfZmIgPSBvbGRfcGxhbmVfc3RhdGUtPmZiOwotCWk5MTVfZ2VtX3Ry
YWNrX2ZiKGludGVsX2ZiX29iaihvbGRfZmIpLCBpbnRlbF9mYl9vYmooZmIpLAotCQkJICBpbnRl
bF9wbGFuZS0+ZnJvbnRidWZmZXJfYml0KTsKKwlpbnRlbF9mcm9udGJ1ZmZlcl9mbHVzaCh0b19p
bnRlbF9mcm9udGJ1ZmZlcihmYiksIE9SSUdJTl9GTElQKTsKKwlpbnRlbF9mcm9udGJ1ZmZlcl90
cmFjayh0b19pbnRlbF9mcm9udGJ1ZmZlcihvbGRfcGxhbmVfc3RhdGUtPmZiKSwKKwkJCQl0b19p
bnRlbF9mcm9udGJ1ZmZlcihmYiksCisJCQkJaW50ZWxfcGxhbmUtPmZyb250YnVmZmVyX2JpdCk7
CiAKIAkvKiBTd2FwIHBsYW5lIHN0YXRlICovCiAJcGxhbmUtPnN0YXRlID0gbmV3X3BsYW5lX3N0
YXRlOwpAQCAtMTUzMjgsMTUgKzE1MzMwLDkgQEAgc3RhdGljIHZvaWQgaW50ZWxfc2V0dXBfb3V0
cHV0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiBzdGF0aWMgdm9pZCBpbnRl
bF91c2VyX2ZyYW1lYnVmZmVyX2Rlc3Ryb3koc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIpCiB7
CiAJc3RydWN0IGludGVsX2ZyYW1lYnVmZmVyICppbnRlbF9mYiA9IHRvX2ludGVsX2ZyYW1lYnVm
ZmVyKGZiKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gaW50ZWxfZmJfb2Jq
KGZiKTsKIAogCWRybV9mcmFtZWJ1ZmZlcl9jbGVhbnVwKGZiKTsKLQotCWk5MTVfZ2VtX29iamVj
dF9sb2NrKG9iaik7Ci0JV0FSTl9PTighb2JqLT5mcmFtZWJ1ZmZlcl9yZWZlcmVuY2VzLS0pOwot
CWk5MTVfZ2VtX29iamVjdF91bmxvY2sob2JqKTsKLQotCWk5MTVfZ2VtX29iamVjdF9wdXQob2Jq
KTsKKwlpbnRlbF9mcm9udGJ1ZmZlcl9wdXQoaW50ZWxfZmItPmZyb250YnVmZmVyKTsKIAogCWtm
cmVlKGludGVsX2ZiKTsKIH0KQEAgLTE1MzY0LDcgKzE1MzYwLDcgQEAgc3RhdGljIGludCBpbnRl
bF91c2VyX2ZyYW1lYnVmZmVyX2RpcnR5KHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAogCXN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSBpbnRlbF9mYl9vYmooZmIpOwogCiAJaTkx
NV9nZW1fb2JqZWN0X2ZsdXNoX2lmX2Rpc3BsYXkob2JqKTsKLQlpbnRlbF9mYl9vYmpfZmx1c2go
b2JqLCBPUklHSU5fRElSVFlGQik7CisJaW50ZWxfZnJvbnRidWZmZXJfZmx1c2godG9faW50ZWxf
ZnJvbnRidWZmZXIoZmIpLCBPUklHSU5fRElSVFlGQik7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTE1
Mzg2LDggKzE1MzgyLDExIEBAIHN0YXRpYyBpbnQgaW50ZWxfZnJhbWVidWZmZXJfaW5pdChzdHJ1
Y3QgaW50ZWxfZnJhbWVidWZmZXIgKmludGVsX2ZiLAogCWludCByZXQgPSAtRUlOVkFMOwogCWlu
dCBpOwogCisJaW50ZWxfZmItPmZyb250YnVmZmVyID0gaW50ZWxfZnJvbnRidWZmZXJfZ2V0KG9i
aik7CisJaWYgKCFpbnRlbF9mYi0+ZnJvbnRidWZmZXIpCisJCXJldHVybiAtRU5PTUVNOworCiAJ
aTkxNV9nZW1fb2JqZWN0X2xvY2sob2JqKTsKLQlvYmotPmZyYW1lYnVmZmVyX3JlZmVyZW5jZXMr
KzsKIAl0aWxpbmcgPSBpOTE1X2dlbV9vYmplY3RfZ2V0X3RpbGluZyhvYmopOwogCXN0cmlkZSA9
IGk5MTVfZ2VtX29iamVjdF9nZXRfc3RyaWRlKG9iaik7CiAJaTkxNV9nZW1fb2JqZWN0X3VubG9j
ayhvYmopOwpAQCAtMTU1MDQsOSArMTU1MDMsNyBAQCBzdGF0aWMgaW50IGludGVsX2ZyYW1lYnVm
ZmVyX2luaXQoc3RydWN0IGludGVsX2ZyYW1lYnVmZmVyICppbnRlbF9mYiwKIAlyZXR1cm4gMDsK
IAogZXJyOgotCWk5MTVfZ2VtX29iamVjdF9sb2NrKG9iaik7Ci0Jb2JqLT5mcmFtZWJ1ZmZlcl9y
ZWZlcmVuY2VzLS07Ci0JaTkxNV9nZW1fb2JqZWN0X3VubG9jayhvYmopOworCWludGVsX2Zyb250
YnVmZmVyX3B1dChpbnRlbF9mYi0+ZnJvbnRidWZmZXIpOwogCXJldHVybiByZXQ7CiB9CiAKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Rydi5oIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaW50ZWxfZHJ2LmgKaW5kZXggM2UzMzczMTdmNzdlLi5hNTI1M2ZkODM4YmMgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Rydi5oCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX2Rydi5oCkBAIC02OSw2ICs2OSw3IEBAIGVudW0gaW50ZWxfb3V0
cHV0X3R5cGUgewogCiBzdHJ1Y3QgaW50ZWxfZnJhbWVidWZmZXIgewogCXN0cnVjdCBkcm1fZnJh
bWVidWZmZXIgYmFzZTsKKwlzdHJ1Y3QgaW50ZWxfZnJvbnRidWZmZXIgKmZyb250YnVmZmVyOwog
CXN0cnVjdCBpbnRlbF9yb3RhdGlvbl9pbmZvIHJvdF9pbmZvOwogCiAJLyogZm9yIGVhY2ggcGxh
bmUgaW4gdGhlIG5vcm1hbCBHVFQgdmlldyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaW50ZWxfZmJkZXYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2ZiZGV2LmMK
aW5kZXggMGQzYTZmYTY3NGU2Li5jN2MxMWQxODQyYWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2ludGVsX2ZiZGV2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
ZmJkZXYuYwpAQCAtNDcsMTMgKzQ3LDE0IEBACiAjaW5jbHVkZSAiaW50ZWxfZmJkZXYuaCIKICNp
bmNsdWRlICJpbnRlbF9mcm9udGJ1ZmZlci5oIgogCi1zdGF0aWMgdm9pZCBpbnRlbF9mYmRldl9p
bnZhbGlkYXRlKHN0cnVjdCBpbnRlbF9mYmRldiAqaWZiZGV2KQorc3RhdGljIHN0cnVjdCBpbnRl
bF9mcm9udGJ1ZmZlciAqdG9fZnJvbnRidWZmZXIoc3RydWN0IGludGVsX2ZiZGV2ICppZmJkZXYp
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IGludGVsX2ZiX29iaigmaWZi
ZGV2LT5mYi0+YmFzZSk7Ci0JdW5zaWduZWQgaW50IG9yaWdpbiA9Ci0JCWlmYmRldi0+dm1hX2Zs
YWdzICYgUExBTkVfSEFTX0ZFTkNFID8gT1JJR0lOX0dUVCA6IE9SSUdJTl9DUFU7CisJcmV0dXJu
IGlmYmRldi0+ZmItPmZyb250YnVmZmVyOworfQogCi0JaW50ZWxfZmJfb2JqX2ludmFsaWRhdGUo
b2JqLCBvcmlnaW4pOworc3RhdGljIHZvaWQgaW50ZWxfZmJkZXZfaW52YWxpZGF0ZShzdHJ1Y3Qg
aW50ZWxfZmJkZXYgKmlmYmRldikKK3sKKwlpbnRlbF9mcm9udGJ1ZmZlcl9pbnZhbGlkYXRlKHRv
X2Zyb250YnVmZmVyKGlmYmRldiksIE9SSUdJTl9DUFUpOwogfQogCiBzdGF0aWMgaW50IGludGVs
X2ZiZGV2X3NldF9wYXIoc3RydWN0IGZiX2luZm8gKmluZm8pCkBAIC0xODAsNyArMTgxLDYgQEAg
c3RhdGljIGludCBpbnRlbGZiX2NyZWF0ZShzdHJ1Y3QgZHJtX2ZiX2hlbHBlciAqaGVscGVyLAog
CWNvbnN0IHN0cnVjdCBpOTE1X2dndHRfdmlldyB2aWV3ID0gewogCQkudHlwZSA9IEk5MTVfR0dU
VF9WSUVXX05PUk1BTCwKIAl9OwotCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiOwogCWludGVs
X3dha2VyZWZfdCB3YWtlcmVmOwogCXN0cnVjdCBmYl9pbmZvICppbmZvOwogCXN0cnVjdCBpOTE1
X3ZtYSAqdm1hOwpAQCAtMjI2LDggKzIyNiw3IEBAIHN0YXRpYyBpbnQgaW50ZWxmYl9jcmVhdGUo
c3RydWN0IGRybV9mYl9oZWxwZXIgKmhlbHBlciwKIAkJZ290byBvdXRfdW5sb2NrOwogCX0KIAot
CWZiID0gJmlmYmRldi0+ZmItPmJhc2U7Ci0JaW50ZWxfZmJfb2JqX2ZsdXNoKGludGVsX2ZiX29i
aihmYiksIE9SSUdJTl9ESVJUWUZCKTsKKwlpbnRlbF9mcm9udGJ1ZmZlcl9mbHVzaCh0b19mcm9u
dGJ1ZmZlcihpZmJkZXYpLCBPUklHSU5fRElSVFlGQik7CiAKIAlpbmZvID0gZHJtX2ZiX2hlbHBl
cl9hbGxvY19mYmkoaGVscGVyKTsKIAlpZiAoSVNfRVJSKGluZm8pKSB7CkBAIC0yMzYsNyArMjM1
LDcgQEAgc3RhdGljIGludCBpbnRlbGZiX2NyZWF0ZShzdHJ1Y3QgZHJtX2ZiX2hlbHBlciAqaGVs
cGVyLAogCQlnb3RvIG91dF91bnBpbjsKIAl9CiAKLQlpZmJkZXYtPmhlbHBlci5mYiA9IGZiOwor
CWlmYmRldi0+aGVscGVyLmZiID0gJmlmYmRldi0+ZmItPmJhc2U7CiAKIAlpbmZvLT5mYm9wcyA9
ICZpbnRlbGZiX29wczsKIApAQCAtMjYyLDEzICsyNjEsMTQgQEAgc3RhdGljIGludCBpbnRlbGZi
X2NyZWF0ZShzdHJ1Y3QgZHJtX2ZiX2hlbHBlciAqaGVscGVyLAogCSAqIElmIHRoZSBvYmplY3Qg
aXMgc3RvbGVuIGhvd2V2ZXIsIGl0IHdpbGwgYmUgZnVsbCBvZiB3aGF0ZXZlcgogCSAqIGdhcmJh
Z2Ugd2FzIGxlZnQgaW4gdGhlcmUuCiAJICovCi0JaWYgKGludGVsX2ZiX29iaihmYiktPnN0b2xl
biAmJiAhcHJlYWxsb2MpCisJaWYgKHZtYS0+b2JqLT5zdG9sZW4gJiYgIXByZWFsbG9jKQogCQlt
ZW1zZXRfaW8oaW5mby0+c2NyZWVuX2Jhc2UsIDAsIGluZm8tPnNjcmVlbl9zaXplKTsKIAogCS8q
IFVzZSBkZWZhdWx0IHNjcmF0Y2ggcGl4bWFwIChpbmZvLT5waXhtYXAuZmxhZ3MgPSBGQl9QSVhN
QVBfU1lTVEVNKSAqLwogCiAJRFJNX0RFQlVHX0tNUygiYWxsb2NhdGVkICVkeCVkIGZiOiAweCUw
OHhcbiIsCi0JCSAgICAgIGZiLT53aWR0aCwgZmItPmhlaWdodCwgaTkxNV9nZ3R0X29mZnNldCh2
bWEpKTsKKwkJICAgICAgaWZiZGV2LT5mYi0+YmFzZS53aWR0aCwgaWZiZGV2LT5mYi0+YmFzZS5o
ZWlnaHQsCisJCSAgICAgIGk5MTVfZ2d0dF9vZmZzZXQodm1hKSk7CiAJaWZiZGV2LT52bWEgPSB2
bWE7CiAJaWZiZGV2LT52bWFfZmxhZ3MgPSBmbGFnczsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaW50ZWxfZnJvbnRidWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2lu
dGVsX2Zyb250YnVmZmVyLmMKaW5kZXggZDYwMzZiOWFkMTZhLi5lY2JlZDExMGFlYzkgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Zyb250YnVmZmVyLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZnJvbnRidWZmZXIuYwpAQCAtNjIsMjggKzYyLDkgQEAK
ICNpbmNsdWRlICJpbnRlbF9mcm9udGJ1ZmZlci5oIgogI2luY2x1ZGUgImludGVsX3Bzci5oIgog
Ci12b2lkIF9faW50ZWxfZmJfb2JqX2ludmFsaWRhdGUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iaiwKLQkJCSAgICAgICBlbnVtIGZiX29wX29yaWdpbiBvcmlnaW4sCi0JCQkgICAgICAg
dW5zaWduZWQgaW50IGZyb250YnVmZmVyX2JpdHMpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShvYmotPmJhc2UuZGV2KTsKLQotCWlmIChvcmlnaW4gPT0g
T1JJR0lOX0NTKSB7Ci0JCXNwaW5fbG9jaygmZGV2X3ByaXYtPmZiX3RyYWNraW5nLmxvY2spOwot
CQlkZXZfcHJpdi0+ZmJfdHJhY2tpbmcuYnVzeV9iaXRzIHw9IGZyb250YnVmZmVyX2JpdHM7Ci0J
CWRldl9wcml2LT5mYl90cmFja2luZy5mbGlwX2JpdHMgJj0gfmZyb250YnVmZmVyX2JpdHM7Ci0J
CXNwaW5fdW5sb2NrKCZkZXZfcHJpdi0+ZmJfdHJhY2tpbmcubG9jayk7Ci0JfQotCi0JbWlnaHRf
c2xlZXAoKTsKLQlpbnRlbF9wc3JfaW52YWxpZGF0ZShkZXZfcHJpdiwgZnJvbnRidWZmZXJfYml0
cywgb3JpZ2luKTsKLQlpbnRlbF9lZHBfZHJyc19pbnZhbGlkYXRlKGRldl9wcml2LCBmcm9udGJ1
ZmZlcl9iaXRzKTsKLQlpbnRlbF9mYmNfaW52YWxpZGF0ZShkZXZfcHJpdiwgZnJvbnRidWZmZXJf
Yml0cywgb3JpZ2luKTsKLX0KLQogLyoqCi0gKiBpbnRlbF9mcm9udGJ1ZmZlcl9mbHVzaCAtIGZs
dXNoIGZyb250YnVmZmVyCi0gKiBAZGV2X3ByaXY6IGk5MTUgZGV2aWNlCisgKiBmcm9udGJ1ZmZl
cl9mbHVzaCAtIGZsdXNoIGZyb250YnVmZmVyCisgKiBAaTkxNTogaTkxNSBkZXZpY2UKICAqIEBm
cm9udGJ1ZmZlcl9iaXRzOiBmcm9udGJ1ZmZlciBwbGFuZSB0cmFja2luZyBiaXRzCiAgKiBAb3Jp
Z2luOiB3aGljaCBvcGVyYXRpb24gY2F1c2VkIHRoZSBmbHVzaAogICoKQEAgLTkzLDQ1ICs3NCwy
NyBAQCB2b2lkIF9faW50ZWxfZmJfb2JqX2ludmFsaWRhdGUoc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaiwKICAqCiAgKiBDYW4gYmUgY2FsbGVkIHdpdGhvdXQgYW55IGxvY2tzIGhlbGQu
CiAgKi8KLXN0YXRpYyB2b2lkIGludGVsX2Zyb250YnVmZmVyX2ZsdXNoKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCQkgICAgdW5zaWduZWQgZnJvbnRidWZmZXJfYml0cywK
LQkJCQkgICAgZW51bSBmYl9vcF9vcmlnaW4gb3JpZ2luKQorc3RhdGljIHZvaWQgZnJvbnRidWZm
ZXJfZmx1c2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCisJCQkgICAgICB1bnNpZ25l
ZCBpbnQgZnJvbnRidWZmZXJfYml0cywKKwkJCSAgICAgIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdp
bikKIHsKIAkvKiBEZWxheSBmbHVzaGluZyB3aGVuIHJpbmdzIGFyZSBzdGlsbCBidXN5LiovCi0J
c3Bpbl9sb2NrKCZkZXZfcHJpdi0+ZmJfdHJhY2tpbmcubG9jayk7Ci0JZnJvbnRidWZmZXJfYml0
cyAmPSB+ZGV2X3ByaXYtPmZiX3RyYWNraW5nLmJ1c3lfYml0czsKLQlzcGluX3VubG9jaygmZGV2
X3ByaXYtPmZiX3RyYWNraW5nLmxvY2spOworCXNwaW5fbG9jaygmaTkxNS0+ZmJfdHJhY2tpbmcu
bG9jayk7CisJZnJvbnRidWZmZXJfYml0cyAmPSB+aTkxNS0+ZmJfdHJhY2tpbmcuYnVzeV9iaXRz
OworCXNwaW5fdW5sb2NrKCZpOTE1LT5mYl90cmFja2luZy5sb2NrKTsKIAogCWlmICghZnJvbnRi
dWZmZXJfYml0cykKIAkJcmV0dXJuOwogCiAJbWlnaHRfc2xlZXAoKTsKLQlpbnRlbF9lZHBfZHJy
c19mbHVzaChkZXZfcHJpdiwgZnJvbnRidWZmZXJfYml0cyk7Ci0JaW50ZWxfcHNyX2ZsdXNoKGRl
dl9wcml2LCBmcm9udGJ1ZmZlcl9iaXRzLCBvcmlnaW4pOwotCWludGVsX2ZiY19mbHVzaChkZXZf
cHJpdiwgZnJvbnRidWZmZXJfYml0cywgb3JpZ2luKTsKLX0KLQotdm9pZCBfX2ludGVsX2ZiX29i
al9mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAotCQkJICBlbnVtIGZiX29w
X29yaWdpbiBvcmlnaW4sCi0JCQkgIHVuc2lnbmVkIGludCBmcm9udGJ1ZmZlcl9iaXRzKQotewot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUob2JqLT5iYXNlLmRl
dik7Ci0KLQlpZiAob3JpZ2luID09IE9SSUdJTl9DUykgewotCQlzcGluX2xvY2soJmRldl9wcml2
LT5mYl90cmFja2luZy5sb2NrKTsKLQkJLyogRmlsdGVyIG91dCBuZXcgYml0cyBzaW5jZSByZW5k
ZXJpbmcgc3RhcnRlZC4gKi8KLQkJZnJvbnRidWZmZXJfYml0cyAmPSBkZXZfcHJpdi0+ZmJfdHJh
Y2tpbmcuYnVzeV9iaXRzOwotCQlkZXZfcHJpdi0+ZmJfdHJhY2tpbmcuYnVzeV9iaXRzICY9IH5m
cm9udGJ1ZmZlcl9iaXRzOwotCQlzcGluX3VubG9jaygmZGV2X3ByaXYtPmZiX3RyYWNraW5nLmxv
Y2spOwotCX0KLQotCWlmIChmcm9udGJ1ZmZlcl9iaXRzKQotCQlpbnRlbF9mcm9udGJ1ZmZlcl9m
bHVzaChkZXZfcHJpdiwgZnJvbnRidWZmZXJfYml0cywgb3JpZ2luKTsKKwlpbnRlbF9lZHBfZHJy
c19mbHVzaChpOTE1LCBmcm9udGJ1ZmZlcl9iaXRzKTsKKwlpbnRlbF9wc3JfZmx1c2goaTkxNSwg
ZnJvbnRidWZmZXJfYml0cywgb3JpZ2luKTsKKwlpbnRlbF9mYmNfZmx1c2goaTkxNSwgZnJvbnRi
dWZmZXJfYml0cywgb3JpZ2luKTsKIH0KIAogLyoqCiAgKiBpbnRlbF9mcm9udGJ1ZmZlcl9mbGlw
X3ByZXBhcmUgLSBwcmVwYXJlIGFzeW5jaHJvbm91cyBmcm9udGJ1ZmZlciBmbGlwCi0gKiBAZGV2
X3ByaXY6IGk5MTUgZGV2aWNlCisgKiBAaTkxNTogaTkxNSBkZXZpY2UKICAqIEBmcm9udGJ1ZmZl
cl9iaXRzOiBmcm9udGJ1ZmZlciBwbGFuZSB0cmFja2luZyBiaXRzCiAgKgogICogVGhpcyBmdW5j
dGlvbiBnZXRzIGNhbGxlZCBhZnRlciBzY2hlZHVsaW5nIGEgZmxpcCBvbiBAb2JqLiBUaGUgYWN0
dWFsCkBAIC0xNDEsMTkgKzEwNCwxOSBAQCB2b2lkIF9faW50ZWxfZmJfb2JqX2ZsdXNoKHN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAgKgogICogQ2FuIGJlIGNhbGxlZCB3aXRob3V0
IGFueSBsb2NrcyBoZWxkLgogICovCi12b2lkIGludGVsX2Zyb250YnVmZmVyX2ZsaXBfcHJlcGFy
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2b2lkIGludGVsX2Zyb250YnVm
ZmVyX2ZsaXBfcHJlcGFyZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAg
dW5zaWduZWQgZnJvbnRidWZmZXJfYml0cykKIHsKLQlzcGluX2xvY2soJmRldl9wcml2LT5mYl90
cmFja2luZy5sb2NrKTsKLQlkZXZfcHJpdi0+ZmJfdHJhY2tpbmcuZmxpcF9iaXRzIHw9IGZyb250
YnVmZmVyX2JpdHM7CisJc3Bpbl9sb2NrKCZpOTE1LT5mYl90cmFja2luZy5sb2NrKTsKKwlpOTE1
LT5mYl90cmFja2luZy5mbGlwX2JpdHMgfD0gZnJvbnRidWZmZXJfYml0czsKIAkvKiBSZW1vdmUg
c3RhbGUgYnVzeSBiaXRzIGR1ZSB0byB0aGUgb2xkIGJ1ZmZlci4gKi8KLQlkZXZfcHJpdi0+ZmJf
dHJhY2tpbmcuYnVzeV9iaXRzICY9IH5mcm9udGJ1ZmZlcl9iaXRzOwotCXNwaW5fdW5sb2NrKCZk
ZXZfcHJpdi0+ZmJfdHJhY2tpbmcubG9jayk7CisJaTkxNS0+ZmJfdHJhY2tpbmcuYnVzeV9iaXRz
ICY9IH5mcm9udGJ1ZmZlcl9iaXRzOworCXNwaW5fdW5sb2NrKCZpOTE1LT5mYl90cmFja2luZy5s
b2NrKTsKIH0KIAogLyoqCiAgKiBpbnRlbF9mcm9udGJ1ZmZlcl9mbGlwX2NvbXBsZXRlIC0gY29t
cGxldGUgYXN5bmNocm9ub3VzIGZyb250YnVmZmVyIGZsaXAKLSAqIEBkZXZfcHJpdjogaTkxNSBk
ZXZpY2UKKyAqIEBpOTE1OiBpOTE1IGRldmljZQogICogQGZyb250YnVmZmVyX2JpdHM6IGZyb250
YnVmZmVyIHBsYW5lIHRyYWNraW5nIGJpdHMKICAqCiAgKiBUaGlzIGZ1bmN0aW9uIGdldHMgY2Fs
bGVkIGFmdGVyIHRoZSBmbGlwIGhhcyBiZWVuIGxhdGNoZWQgYW5kIHdpbGwgY29tcGxldGUKQEAg
LTE2MSwyMyArMTI0LDIyIEBAIHZvaWQgaW50ZWxfZnJvbnRidWZmZXJfZmxpcF9wcmVwYXJlKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKICAqCiAgKiBDYW4gYmUgY2FsbGVkIHdp
dGhvdXQgYW55IGxvY2tzIGhlbGQuCiAgKi8KLXZvaWQgaW50ZWxfZnJvbnRidWZmZXJfZmxpcF9j
b21wbGV0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2b2lkIGludGVsX2Zy
b250YnVmZmVyX2ZsaXBfY29tcGxldGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJ
CQkJICAgICB1bnNpZ25lZCBmcm9udGJ1ZmZlcl9iaXRzKQogewotCXNwaW5fbG9jaygmZGV2X3By
aXYtPmZiX3RyYWNraW5nLmxvY2spOworCXNwaW5fbG9jaygmaTkxNS0+ZmJfdHJhY2tpbmcubG9j
ayk7CiAJLyogTWFzayBhbnkgY2FuY2VsbGVkIGZsaXBzLiAqLwotCWZyb250YnVmZmVyX2JpdHMg
Jj0gZGV2X3ByaXYtPmZiX3RyYWNraW5nLmZsaXBfYml0czsKLQlkZXZfcHJpdi0+ZmJfdHJhY2tp
bmcuZmxpcF9iaXRzICY9IH5mcm9udGJ1ZmZlcl9iaXRzOwotCXNwaW5fdW5sb2NrKCZkZXZfcHJp
di0+ZmJfdHJhY2tpbmcubG9jayk7CisJZnJvbnRidWZmZXJfYml0cyAmPSBpOTE1LT5mYl90cmFj
a2luZy5mbGlwX2JpdHM7CisJaTkxNS0+ZmJfdHJhY2tpbmcuZmxpcF9iaXRzICY9IH5mcm9udGJ1
ZmZlcl9iaXRzOworCXNwaW5fdW5sb2NrKCZpOTE1LT5mYl90cmFja2luZy5sb2NrKTsKIAogCWlm
IChmcm9udGJ1ZmZlcl9iaXRzKQotCQlpbnRlbF9mcm9udGJ1ZmZlcl9mbHVzaChkZXZfcHJpdiwK
LQkJCQkJZnJvbnRidWZmZXJfYml0cywgT1JJR0lOX0ZMSVApOworCQlmcm9udGJ1ZmZlcl9mbHVz
aChpOTE1LCBmcm9udGJ1ZmZlcl9iaXRzLCBPUklHSU5fRkxJUCk7CiB9CiAKIC8qKgogICogaW50
ZWxfZnJvbnRidWZmZXJfZmxpcCAtIHN5bmNocm9ub3VzIGZyb250YnVmZmVyIGZsaXAKLSAqIEBk
ZXZfcHJpdjogaTkxNSBkZXZpY2UKKyAqIEBpOTE1OiBpOTE1IGRldmljZQogICogQGZyb250YnVm
ZmVyX2JpdHM6IGZyb250YnVmZmVyIHBsYW5lIHRyYWNraW5nIGJpdHMKICAqCiAgKiBUaGlzIGZ1
bmN0aW9uIGdldHMgY2FsbGVkIGFmdGVyIHNjaGVkdWxpbmcgYSBmbGlwIG9uIEBvYmouIFRoaXMg
aXMgZm9yCkBAIC0xODYsMTMgKzE0OCwxNTkgQEAgdm9pZCBpbnRlbF9mcm9udGJ1ZmZlcl9mbGlw
X2NvbXBsZXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKICAqCiAgKiBDYW4g
YmUgY2FsbGVkIHdpdGhvdXQgYW55IGxvY2tzIGhlbGQuCiAgKi8KLXZvaWQgaW50ZWxfZnJvbnRi
dWZmZXJfZmxpcChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2b2lkIGludGVs
X2Zyb250YnVmZmVyX2ZsaXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAg
dW5zaWduZWQgZnJvbnRidWZmZXJfYml0cykKIHsKLQlzcGluX2xvY2soJmRldl9wcml2LT5mYl90
cmFja2luZy5sb2NrKTsKKwlzcGluX2xvY2soJmk5MTUtPmZiX3RyYWNraW5nLmxvY2spOwogCS8q
IFJlbW92ZSBzdGFsZSBidXN5IGJpdHMgZHVlIHRvIHRoZSBvbGQgYnVmZmVyLiAqLwotCWRldl9w
cml2LT5mYl90cmFja2luZy5idXN5X2JpdHMgJj0gfmZyb250YnVmZmVyX2JpdHM7Ci0Jc3Bpbl91
bmxvY2soJmRldl9wcml2LT5mYl90cmFja2luZy5sb2NrKTsKKwlpOTE1LT5mYl90cmFja2luZy5i
dXN5X2JpdHMgJj0gfmZyb250YnVmZmVyX2JpdHM7CisJc3Bpbl91bmxvY2soJmk5MTUtPmZiX3Ry
YWNraW5nLmxvY2spOwogCi0JaW50ZWxfZnJvbnRidWZmZXJfZmx1c2goZGV2X3ByaXYsIGZyb250
YnVmZmVyX2JpdHMsIE9SSUdJTl9GTElQKTsKKwlmcm9udGJ1ZmZlcl9mbHVzaChpOTE1LCBmcm9u
dGJ1ZmZlcl9iaXRzLCBPUklHSU5fRkxJUCk7Cit9CisKK3ZvaWQgX19pbnRlbF9mYl9pbnZhbGlk
YXRlKHN0cnVjdCBpbnRlbF9mcm9udGJ1ZmZlciAqZnJvbnQsCisJCQkgICBlbnVtIGZiX29wX29y
aWdpbiBvcmlnaW4sCisJCQkgICB1bnNpZ25lZCBpbnQgZnJvbnRidWZmZXJfYml0cykKK3sKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZnJvbnQtPm9iai0+YmFzZS5k
ZXYpOworCisJaWYgKG9yaWdpbiA9PSBPUklHSU5fQ1MpIHsKKwkJc3Bpbl9sb2NrKCZpOTE1LT5m
Yl90cmFja2luZy5sb2NrKTsKKwkJaTkxNS0+ZmJfdHJhY2tpbmcuYnVzeV9iaXRzIHw9IGZyb250
YnVmZmVyX2JpdHM7CisJCWk5MTUtPmZiX3RyYWNraW5nLmZsaXBfYml0cyAmPSB+ZnJvbnRidWZm
ZXJfYml0czsKKwkJc3Bpbl91bmxvY2soJmk5MTUtPmZiX3RyYWNraW5nLmxvY2spOworCX0KKwor
CW1pZ2h0X3NsZWVwKCk7CisJaW50ZWxfcHNyX2ludmFsaWRhdGUoaTkxNSwgZnJvbnRidWZmZXJf
Yml0cywgb3JpZ2luKTsKKwlpbnRlbF9lZHBfZHJyc19pbnZhbGlkYXRlKGk5MTUsIGZyb250YnVm
ZmVyX2JpdHMpOworCWludGVsX2ZiY19pbnZhbGlkYXRlKGk5MTUsIGZyb250YnVmZmVyX2JpdHMs
IG9yaWdpbik7Cit9CisKK3ZvaWQgX19pbnRlbF9mYl9mbHVzaChzdHJ1Y3QgaW50ZWxfZnJvbnRi
dWZmZXIgKmZyb250LAorCQkgICAgICBlbnVtIGZiX29wX29yaWdpbiBvcmlnaW4sCisJCSAgICAg
IHVuc2lnbmVkIGludCBmcm9udGJ1ZmZlcl9iaXRzKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gdG9faTkxNShmcm9udC0+b2JqLT5iYXNlLmRldik7CisKKwlpZiAob3JpZ2lu
ID09IE9SSUdJTl9DUykgeworCQlzcGluX2xvY2soJmk5MTUtPmZiX3RyYWNraW5nLmxvY2spOwor
CQkvKiBGaWx0ZXIgb3V0IG5ldyBiaXRzIHNpbmNlIHJlbmRlcmluZyBzdGFydGVkLiAqLworCQlm
cm9udGJ1ZmZlcl9iaXRzICY9IGk5MTUtPmZiX3RyYWNraW5nLmJ1c3lfYml0czsKKwkJaTkxNS0+
ZmJfdHJhY2tpbmcuYnVzeV9iaXRzICY9IH5mcm9udGJ1ZmZlcl9iaXRzOworCQlzcGluX3VubG9j
aygmaTkxNS0+ZmJfdHJhY2tpbmcubG9jayk7CisJfQorCisJaWYgKGZyb250YnVmZmVyX2JpdHMp
CisJCWZyb250YnVmZmVyX2ZsdXNoKGk5MTUsIGZyb250YnVmZmVyX2JpdHMsIG9yaWdpbik7Cit9
CisKK3N0YXRpYyBpbnQgZnJvbnRidWZmZXJfYWN0aXZlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVm
KQoreworCXN0cnVjdCBpbnRlbF9mcm9udGJ1ZmZlciAqZnJvbnQgPQorCQljb250YWluZXJfb2Yo
cmVmLCB0eXBlb2YoKmZyb250KSwgd3JpdGUpOworCisJa3JlZl9nZXQoJmZyb250LT5yZWYpOwor
CXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBmcm9udGJ1ZmZlcl9yZXRpcmUoc3RydWN0IGk5
MTVfYWN0aXZlICpyZWYpCit7CisJc3RydWN0IGludGVsX2Zyb250YnVmZmVyICpmcm9udCA9CisJ
CWNvbnRhaW5lcl9vZihyZWYsIHR5cGVvZigqZnJvbnQpLCB3cml0ZSk7CisKKwlpbnRlbF9mcm9u
dGJ1ZmZlcl9mbHVzaChmcm9udCwgT1JJR0lOX0NTKTsKKwlpbnRlbF9mcm9udGJ1ZmZlcl9wdXQo
ZnJvbnQpOworfQorCitzdGF0aWMgdm9pZCBmcm9udGJ1ZmZlcl9yZWxlYXNlKHN0cnVjdCBrcmVm
ICpyZWYpCit7CisJc3RydWN0IGludGVsX2Zyb250YnVmZmVyICpmcm9udCA9CisJCWNvbnRhaW5l
cl9vZihyZWYsIHR5cGVvZigqZnJvbnQpLCByZWYpOworCisJZnJvbnQtPm9iai0+ZnJvbnRidWZm
ZXIgPSBOVUxMOworCXNwaW5fdW5sb2NrKCZ0b19pOTE1KGZyb250LT5vYmotPmJhc2UuZGV2KS0+
ZmJfdHJhY2tpbmcubG9jayk7CisKKwlpOTE1X2dlbV9vYmplY3RfcHV0KGZyb250LT5vYmopOwor
CWtmcmVlKGZyb250KTsKK30KKworc3RydWN0IGludGVsX2Zyb250YnVmZmVyICoKK2ludGVsX2Zy
b250YnVmZmVyX2dldChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQoreworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShvYmotPmJhc2UuZGV2KTsKKwlzdHJ1
Y3QgaW50ZWxfZnJvbnRidWZmZXIgKmZyb250OworCisJc3Bpbl9sb2NrKCZpOTE1LT5mYl90cmFj
a2luZy5sb2NrKTsKKwlmcm9udCA9IG9iai0+ZnJvbnRidWZmZXI7CisJaWYgKGZyb250KQorCQlr
cmVmX2dldCgmZnJvbnQtPnJlZik7CisJc3Bpbl91bmxvY2soJmk5MTUtPmZiX3RyYWNraW5nLmxv
Y2spOworCWlmIChmcm9udCkKKwkJcmV0dXJuIGZyb250OworCisJZnJvbnQgPSBrbWFsbG9jKHNp
emVvZigqZnJvbnQpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWZyb250KQorCQlyZXR1cm4gTlVMTDsK
KworCWZyb250LT5vYmogPSBvYmo7CisJa3JlZl9pbml0KCZmcm9udC0+cmVmKTsKKwlhdG9taWNf
c2V0KCZmcm9udC0+Yml0cywgMCk7CisJaTkxNV9hY3RpdmVfaW5pdChpOTE1LCAmZnJvbnQtPndy
aXRlLAorCQkJIGZyb250YnVmZmVyX2FjdGl2ZSwgZnJvbnRidWZmZXJfcmV0aXJlKTsKKworCXNw
aW5fbG9jaygmaTkxNS0+ZmJfdHJhY2tpbmcubG9jayk7CisJaWYgKG9iai0+ZnJvbnRidWZmZXIp
IHsKKwkJa2ZyZWUoZnJvbnQpOworCQlmcm9udCA9IG9iai0+ZnJvbnRidWZmZXI7CisJCWtyZWZf
Z2V0KCZmcm9udC0+cmVmKTsKKwl9IGVsc2UgeworCQlpOTE1X2dlbV9vYmplY3RfZ2V0KG9iaik7
CisJCW9iai0+ZnJvbnRidWZmZXIgPSBmcm9udDsKKwl9CisJc3Bpbl91bmxvY2soJmk5MTUtPmZi
X3RyYWNraW5nLmxvY2spOworCisJcmV0dXJuIGZyb250OworfQorCit2b2lkIGludGVsX2Zyb250
YnVmZmVyX3B1dChzdHJ1Y3QgaW50ZWxfZnJvbnRidWZmZXIgKmZyb250KQoreworCWtyZWZfcHV0
X2xvY2soJmZyb250LT5yZWYsCisJCSAgICAgIGZyb250YnVmZmVyX3JlbGVhc2UsCisJCSAgICAg
ICZ0b19pOTE1KGZyb250LT5vYmotPmJhc2UuZGV2KS0+ZmJfdHJhY2tpbmcubG9jayk7Cit9CisK
Ky8qKgorICogaW50ZWxfZnJvbnRidWZmZXJfdHJhY2sgLSB1cGRhdGUgZnJvbnRidWZmZXIgdHJh
Y2tpbmcKKyAqIEBvbGQ6IGN1cnJlbnQgR0VNIGJ1ZmZlciBmb3IgdGhlIGZyb250YnVmZmVyIHNs
b3RzCisgKiBAbmV3OiBuZXcgR0VNIGJ1ZmZlciBmb3IgdGhlIGZyb250YnVmZmVyIHNsb3RzCisg
KiBAZnJvbnRidWZmZXJfYml0czogYml0bWFzayBvZiBmcm9udGJ1ZmZlciBzbG90cworICoKKyAq
IFRoaXMgdXBkYXRlcyB0aGUgZnJvbnRidWZmZXIgdHJhY2tpbmcgYml0cyBAZnJvbnRidWZmZXJf
Yml0cyBieSBjbGVhcmluZyB0aGVtCisgKiBmcm9tIEBvbGQgYW5kIHNldHRpbmcgdGhlbSBpbiBA
bmV3LiBCb3RoIEBvbGQgYW5kIEBuZXcgY2FuIGJlIE5VTEwuCisgKi8KK3ZvaWQgaW50ZWxfZnJv
bnRidWZmZXJfdHJhY2soc3RydWN0IGludGVsX2Zyb250YnVmZmVyICpvbGQsCisJCQkgICAgIHN0
cnVjdCBpbnRlbF9mcm9udGJ1ZmZlciAqbmV3LAorCQkJICAgICB1bnNpZ25lZCBpbnQgZnJvbnRi
dWZmZXJfYml0cykKK3sKKwkvKgorCSAqIENvbnRyb2wgb2YgaW5kaXZpZHVhbCBiaXRzIHdpdGhp
biB0aGUgbWFzayBhcmUgZ3VhcmRlZCBieQorCSAqIHRoZSBvd25pbmcgcGxhbmUtPm11dGV4LCBp
LmUuIHdlIGNhbiBuZXZlciBzZWUgY29uY3VycmVudAorCSAqIG1hbmlwdWxhdGlvbiBvZiBpbmRp
dmlkdWFsIGJpdHMuIEJ1dCBzaW5jZSB0aGUgYml0ZmllbGQgYXMgYSB3aG9sZQorCSAqIGlzIHVw
ZGF0ZWQgdXNpbmcgUk1XLCB3ZSBuZWVkIHRvIHVzZSBhdG9taWNzIGluIG9yZGVyIHRvIHVwZGF0
ZQorCSAqIHRoZSBiaXRzLgorCSAqLworCUJVSUxEX0JVR19PTihJTlRFTF9GUk9OVEJVRkZFUl9C
SVRTX1BFUl9QSVBFICogSTkxNV9NQVhfUElQRVMgPgorCQkgICAgIEJJVFNfUEVSX1RZUEUoYXRv
bWljX3QpKTsKKworCWlmIChvbGQpIHsKKwkJV0FSTl9PTighKGF0b21pY19yZWFkKCZvbGQtPmJp
dHMpICYgZnJvbnRidWZmZXJfYml0cykpOworCQlhdG9taWNfYW5kbm90KGZyb250YnVmZmVyX2Jp
dHMsICZvbGQtPmJpdHMpOworCX0KKworCWlmIChuZXcpIHsKKwkJV0FSTl9PTihhdG9taWNfcmVh
ZCgmbmV3LT5iaXRzKSAmIGZyb250YnVmZmVyX2JpdHMpOworCQlhdG9taWNfb3IoZnJvbnRidWZm
ZXJfYml0cywgJm5ldy0+Yml0cyk7CisJfQogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaW50ZWxfZnJvbnRidWZmZXIuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Zy
b250YnVmZmVyLmgKaW5kZXggNTcyNzMyMGM4MDg0Li5hZGM2NGQ2MWE0YTUgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Zyb250YnVmZmVyLmgKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaW50ZWxfZnJvbnRidWZmZXIuaApAQCAtMjQsNyArMjQsMTAgQEAKICNpZm5k
ZWYgX19JTlRFTF9GUk9OVEJVRkZFUl9IX18KICNkZWZpbmUgX19JTlRFTF9GUk9OVEJVRkZFUl9I
X18KIAotI2luY2x1ZGUgImdlbS9pOTE1X2dlbV9vYmplY3QuaCIKKyNpbmNsdWRlIDxsaW51eC9h
dG9taWMuaD4KKyNpbmNsdWRlIDxsaW51eC9rcmVmLmg+CisKKyNpbmNsdWRlICJpOTE1X2FjdGl2
ZS5oIgogCiBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZTsKIHN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0OwpAQCAtMzcsMjMgKzQwLDMwIEBAIGVudW0gZmJfb3Bfb3JpZ2luIHsKIAlPUklHSU5fRElS
VFlGQiwKIH07CiAKLXZvaWQgaW50ZWxfZnJvbnRidWZmZXJfZmxpcF9wcmVwYXJlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0cnVjdCBpbnRlbF9mcm9udGJ1ZmZlciB7CisJ
c3RydWN0IGtyZWYgcmVmOworCWF0b21pY190IGJpdHM7CisJc3RydWN0IGk5MTVfYWN0aXZlIHdy
aXRlOworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7Cit9OworCit2b2lkIGludGVs
X2Zyb250YnVmZmVyX2ZsaXBfcHJlcGFyZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAkJCQkgICAgdW5zaWduZWQgZnJvbnRidWZmZXJfYml0cyk7Ci12b2lkIGludGVsX2Zyb250YnVm
ZmVyX2ZsaXBfY29tcGxldGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAordm9p
ZCBpbnRlbF9mcm9udGJ1ZmZlcl9mbGlwX2NvbXBsZXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAogCQkJCSAgICAgdW5zaWduZWQgZnJvbnRidWZmZXJfYml0cyk7Ci12b2lkIGludGVs
X2Zyb250YnVmZmVyX2ZsaXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAordm9p
ZCBpbnRlbF9mcm9udGJ1ZmZlcl9mbGlwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAog
CQkJICAgIHVuc2lnbmVkIGZyb250YnVmZmVyX2JpdHMpOwogCi12b2lkIF9faW50ZWxfZmJfb2Jq
X2ludmFsaWRhdGUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKLQkJCSAgICAgICBl
bnVtIGZiX29wX29yaWdpbiBvcmlnaW4sCi0JCQkgICAgICAgdW5zaWduZWQgaW50IGZyb250YnVm
ZmVyX2JpdHMpOwotdm9pZCBfX2ludGVsX2ZiX29ial9mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqLAotCQkJICBlbnVtIGZiX29wX29yaWdpbiBvcmlnaW4sCi0JCQkgIHVuc2ln
bmVkIGludCBmcm9udGJ1ZmZlcl9iaXRzKTsKK3N0cnVjdCBpbnRlbF9mcm9udGJ1ZmZlciAqCitp
bnRlbF9mcm9udGJ1ZmZlcl9nZXQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaik7CisK
K3ZvaWQgX19pbnRlbF9mYl9pbnZhbGlkYXRlKHN0cnVjdCBpbnRlbF9mcm9udGJ1ZmZlciAqZnJv
bnQsCisJCQkgICBlbnVtIGZiX29wX29yaWdpbiBvcmlnaW4sCisJCQkgICB1bnNpZ25lZCBpbnQg
ZnJvbnRidWZmZXJfYml0cyk7CiAKIC8qKgotICogaW50ZWxfZmJfb2JqX2ludmFsaWRhdGUgLSBp
bnZhbGlkYXRlIGZyb250YnVmZmVyIG9iamVjdAotICogQG9iajogR0VNIG9iamVjdCB0byBpbnZh
bGlkYXRlCisgKiBpbnRlbF9mcm9udGJ1ZmZlcl9pbnZhbGlkYXRlIC0gaW52YWxpZGF0ZSBmcm9u
dGJ1ZmZlciBvYmplY3QKKyAqIEBmcm9udDogR0VNIG9iamVjdCB0byBpbnZhbGlkYXRlCiAgKiBA
b3JpZ2luOiB3aGljaCBvcGVyYXRpb24gY2F1c2VkIHRoZSBpbnZhbGlkYXRpb24KICAqCiAgKiBU
aGlzIGZ1bmN0aW9uIGdldHMgY2FsbGVkIGV2ZXJ5IHRpbWUgcmVuZGVyaW5nIG9uIHRoZSBnaXZl
biBvYmplY3Qgc3RhcnRzIGFuZApAQCAtNjIsMzcgKzcyLDUzIEBAIHZvaWQgX19pbnRlbF9mYl9v
YmpfZmx1c2goc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKICAqIHVudGlsIHRoZSBy
ZW5kZXJpbmcgY29tcGxldGVzIG9yIGEgZmxpcCBvbiB0aGlzIGZyb250YnVmZmVyIHBsYW5lIGlz
CiAgKiBzY2hlZHVsZWQuCiAgKi8KLXN0YXRpYyBpbmxpbmUgYm9vbCBpbnRlbF9mYl9vYmpfaW52
YWxpZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAotCQkJCQkgICBlbnVtIGZi
X29wX29yaWdpbiBvcmlnaW4pCitzdGF0aWMgaW5saW5lIGJvb2wgaW50ZWxfZnJvbnRidWZmZXJf
aW52YWxpZGF0ZShzdHJ1Y3QgaW50ZWxfZnJvbnRidWZmZXIgKmZyb250LAorCQkJCQkJZW51bSBm
Yl9vcF9vcmlnaW4gb3JpZ2luKQogewogCXVuc2lnbmVkIGludCBmcm9udGJ1ZmZlcl9iaXRzOwog
Ci0JZnJvbnRidWZmZXJfYml0cyA9IGF0b21pY19yZWFkKCZvYmotPmZyb250YnVmZmVyX2JpdHMp
OworCWlmICghZnJvbnQpCisJCXJldHVybiBmYWxzZTsKKworCWZyb250YnVmZmVyX2JpdHMgPSBh
dG9taWNfcmVhZCgmZnJvbnQtPmJpdHMpOwogCWlmICghZnJvbnRidWZmZXJfYml0cykKIAkJcmV0
dXJuIGZhbHNlOwogCi0JX19pbnRlbF9mYl9vYmpfaW52YWxpZGF0ZShvYmosIG9yaWdpbiwgZnJv
bnRidWZmZXJfYml0cyk7CisJX19pbnRlbF9mYl9pbnZhbGlkYXRlKGZyb250LCBvcmlnaW4sIGZy
b250YnVmZmVyX2JpdHMpOwogCXJldHVybiB0cnVlOwogfQogCit2b2lkIF9faW50ZWxfZmJfZmx1
c2goc3RydWN0IGludGVsX2Zyb250YnVmZmVyICpmcm9udCwKKwkJICAgICAgZW51bSBmYl9vcF9v
cmlnaW4gb3JpZ2luLAorCQkgICAgICB1bnNpZ25lZCBpbnQgZnJvbnRidWZmZXJfYml0cyk7CisK
IC8qKgotICogaW50ZWxfZmJfb2JqX2ZsdXNoIC0gZmx1c2ggZnJvbnRidWZmZXIgb2JqZWN0Ci0g
KiBAb2JqOiBHRU0gb2JqZWN0IHRvIGZsdXNoCisgKiBpbnRlbF9mcm9udGJ1ZmZlcl9mbHVzaCAt
IGZsdXNoIGZyb250YnVmZmVyIG9iamVjdAorICogQGZyb250OiBHRU0gb2JqZWN0IHRvIGZsdXNo
CiAgKiBAb3JpZ2luOiB3aGljaCBvcGVyYXRpb24gY2F1c2VkIHRoZSBmbHVzaAogICoKICAqIFRo
aXMgZnVuY3Rpb24gZ2V0cyBjYWxsZWQgZXZlcnkgdGltZSByZW5kZXJpbmcgb24gdGhlIGdpdmVu
IG9iamVjdCBoYXMKICAqIGNvbXBsZXRlZCBhbmQgZnJvbnRidWZmZXIgY2FjaGluZyBjYW4gYmUg
c3RhcnRlZCBhZ2Fpbi4KICAqLwotc3RhdGljIGlubGluZSB2b2lkIGludGVsX2ZiX29ial9mbHVz
aChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAotCQkJCSAgICAgIGVudW0gZmJfb3Bf
b3JpZ2luIG9yaWdpbikKK3N0YXRpYyBpbmxpbmUgdm9pZCBpbnRlbF9mcm9udGJ1ZmZlcl9mbHVz
aChzdHJ1Y3QgaW50ZWxfZnJvbnRidWZmZXIgKmZyb250LAorCQkJCQkgICBlbnVtIGZiX29wX29y
aWdpbiBvcmlnaW4pCiB7CiAJdW5zaWduZWQgaW50IGZyb250YnVmZmVyX2JpdHM7CiAKLQlmcm9u
dGJ1ZmZlcl9iaXRzID0gYXRvbWljX3JlYWQoJm9iai0+ZnJvbnRidWZmZXJfYml0cyk7CisJaWYg
KCFmcm9udCkKKwkJcmV0dXJuOworCisJZnJvbnRidWZmZXJfYml0cyA9IGF0b21pY19yZWFkKCZm
cm9udC0+Yml0cyk7CiAJaWYgKCFmcm9udGJ1ZmZlcl9iaXRzKQogCQlyZXR1cm47CiAKLQlfX2lu
dGVsX2ZiX29ial9mbHVzaChvYmosIG9yaWdpbiwgZnJvbnRidWZmZXJfYml0cyk7CisJX19pbnRl
bF9mYl9mbHVzaChmcm9udCwgb3JpZ2luLCBmcm9udGJ1ZmZlcl9iaXRzKTsKIH0KIAordm9pZCBp
bnRlbF9mcm9udGJ1ZmZlcl90cmFjayhzdHJ1Y3QgaW50ZWxfZnJvbnRidWZmZXIgKm9sZCwKKwkJ
CSAgICAgc3RydWN0IGludGVsX2Zyb250YnVmZmVyICpuZXcsCisJCQkgICAgIHVuc2lnbmVkIGlu
dCBmcm9udGJ1ZmZlcl9iaXRzKTsKKwordm9pZCBpbnRlbF9mcm9udGJ1ZmZlcl9wdXQoc3RydWN0
IGludGVsX2Zyb250YnVmZmVyICpmcm9udCk7CisKICNlbmRpZiAvKiBfX0lOVEVMX0ZST05UQlVG
RkVSX0hfXyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfb3Zlcmxh
eS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfb3ZlcmxheS5jCmluZGV4IGM3ZDJkOTgw
ZGY4Yy4uZjA3NDNhZjc5ZmNiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF9vdmVybGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfb3ZlcmxheS5jCkBA
IC0yODEsOSArMjgxLDkgQEAgc3RhdGljIHZvaWQgaW50ZWxfb3ZlcmxheV9mbGlwX3ByZXBhcmUo
c3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJsYXksCiAKIAlXQVJOX09OKG92ZXJsYXktPm9sZF92
bWEpOwogCi0JaTkxNV9nZW1fdHJhY2tfZmIob3ZlcmxheS0+dm1hID8gb3ZlcmxheS0+dm1hLT5v
YmogOiBOVUxMLAotCQkJICB2bWEgPyB2bWEtPm9iaiA6IE5VTEwsCi0JCQkgIElOVEVMX0ZST05U
QlVGRkVSX09WRVJMQVkocGlwZSkpOworCWludGVsX2Zyb250YnVmZmVyX3RyYWNrKG92ZXJsYXkt
PnZtYSA/IG92ZXJsYXktPnZtYS0+b2JqLT5mcm9udGJ1ZmZlciA6IE5VTEwsCisJCQkJdm1hID8g
dm1hLT5vYmotPmZyb250YnVmZmVyIDogTlVMTCwKKwkJCQlJTlRFTF9GUk9OVEJVRkZFUl9PVkVS
TEFZKHBpcGUpKTsKIAogCWludGVsX2Zyb250YnVmZmVyX2ZsaXBfcHJlcGFyZShvdmVybGF5LT5p
OTE1LAogCQkJCSAgICAgICBJTlRFTF9GUk9OVEJVRkZFUl9PVkVSTEFZKHBpcGUpKTsKQEAgLTc2
OCw3ICs3NjgsNyBAQCBzdGF0aWMgaW50IGludGVsX292ZXJsYXlfZG9fcHV0X2ltYWdlKHN0cnVj
dCBpbnRlbF9vdmVybGF5ICpvdmVybGF5LAogCQlyZXQgPSBQVFJfRVJSKHZtYSk7CiAJCWdvdG8g
b3V0X3Bpbl9zZWN0aW9uOwogCX0KLQlpbnRlbF9mYl9vYmpfZmx1c2gobmV3X2JvLCBPUklHSU5f
RElSVFlGQik7CisJaW50ZWxfZnJvbnRidWZmZXJfZmx1c2gobmV3X2JvLT5mcm9udGJ1ZmZlciwg
T1JJR0lOX0RJUlRZRkIpOwogCiAJcmV0ID0gaTkxNV92bWFfcHV0X2ZlbmNlKHZtYSk7CiAJaWYg
KHJldCkKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50
ZWwtZ2Z4

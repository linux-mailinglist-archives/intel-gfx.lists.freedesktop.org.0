Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id BCFC28621B
	for <lists+intel-gfx@lfdr.de>; Thu,  8 Aug 2019 14:44:05 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 1FC736E4A7;
	Thu,  8 Aug 2019 12:44:04 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga17.intel.com (mga17.intel.com [192.55.52.151])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2081C6E4A7
 for <intel-gfx@lists.freedesktop.org>; Thu,  8 Aug 2019 12:44:03 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga007.jf.intel.com ([10.7.209.58])
 by fmsmga107.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 08 Aug 2019 05:44:02 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,361,1559545200"; d="scan'208";a="165682545"
Received: from gaia.fi.intel.com ([10.237.72.192])
 by orsmga007.jf.intel.com with ESMTP; 08 Aug 2019 05:44:01 -0700
Received: by gaia.fi.intel.com (Postfix, from userid 1000)
 id 7154A5C0569; Thu,  8 Aug 2019 15:43:25 +0300 (EEST)
From: Mika Kuoppala <mika.kuoppala@linux.intel.com>
To: Chris Wilson <chris@chris-wilson.co.uk>, intel-gfx@lists.freedesktop.org
In-Reply-To: <20190808110612.23539-1-chris@chris-wilson.co.uk>
References: <20190808110612.23539-1-chris@chris-wilson.co.uk>
Date: Thu, 08 Aug 2019 15:43:25 +0300
Message-ID: <87sgqbhloy.fsf@gaia.fi.intel.com>
MIME-Version: 1.0
Subject: Re: [Intel-gfx] [PATCH 1/2] drm/i915: Allocate kernel_contexts
 directly
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+IHdyaXRlczoKCj4gSWdub3Jl
IHRoZSBjZW50cmFsIGk5MTUtPmtlcm5lbF9jb250ZXh0IGZvciBhbGxvY2F0aW5nIGFuIGVuZ2lu
ZSwgYXMKPiB0aGF0IEdFTSBjb250ZXh0IGlzIGJlaW5nIHBoYXNlZCBvdXQuIEZvciBpbnRlcm5h
bCBjbGllbnRzLCB3ZSBqdXN0IG5lZWQKPiB0aGUgcGVyLWVuZ2luZSBsb2dpY2FsIHN0YXRlLCBz
byBhbGxvY2F0ZSBpdCBhdCB0aGUgcG9pbnQgb2YgdXNlLgo+Cj4gU2lnbmVkLW9mZi1ieTogQ2hy
aXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Cj4gLS0tCj4gIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L01ha2VmaWxlICAgICAgICAgICAgIHwgIDIgLQo+ICBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYyB8IDU4ICsrKysrKysrLS0tLS0tLQo+ICBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9tb2NrX2VuZ2luZS5jICAgICB8IDE1ICsrLS0KPiAgZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jICAgICAgfCAgMyArLQo+ICBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbS5jICAgICAgICAgICB8IDg3ICsrKysrKysrKysrKysrLS0tLS0tLS0t
Cj4gIDUgZmlsZXMgY2hhbmdlZCwgOTAgaW5zZXJ0aW9ucygrKSwgNzUgZGVsZXRpb25zKC0pCj4K
PiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9NYWtlZmlsZQo+IGluZGV4IGFiN2ZhZWVlODhkNy4uMzI5Yzk0NTQ0MTQ3IDEw
MDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCj4gKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKPiBAQCAtOTQsOCArOTQsNiBAQCBndC15ICs9IFwKPiAg
CWd0L2dlbjdfcmVuZGVyc3RhdGUubyBcCj4gIAlndC9nZW44X3JlbmRlcnN0YXRlLm8gXAo+ICAJ
Z3QvZ2VuOV9yZW5kZXJzdGF0ZS5vCj4gLWd0LSQoQ09ORklHX0RSTV9JOTE1X1NFTEZURVNUKSAr
PSBcCj4gLQlndC9tb2NrX2VuZ2luZS5vCj4gIGk5MTUteSArPSAkKGd0LXkpCj4gIAo+ICAjIEdF
TSAoR3JhcGhpY3MgRXhlY3V0aW9uIE1hbmFnZW1lbnQpIGNvZGUKPiBkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYwo+IGluZGV4IDg2MjQ3ZWViNmYyYi4uOGQ0NGQwZDhh
NzU4IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9j
cy5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKPiBA
QCAtNzA3LDI2ICs3MDcsNiBAQCBzdGF0aWMgaW50IG1lYXN1cmVfYnJlYWRjcnVtYl9kdyhzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCj4gIAlyZXR1cm4gZHc7Cj4gIH0KPiAgCj4gLXN0
YXRpYyBpbnQgcGluX2NvbnRleHQoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKPiAtCQkg
ICAgICAgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAo+IC0JCSAgICAgICBzdHJ1Y3Qg
aW50ZWxfY29udGV4dCAqKm91dCkKPiAtewo+IC0Jc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwo+
IC0JaW50IGVycjsKPiAtCj4gLQljZSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X2VuZ2luZShjdHgs
IGVuZ2luZS0+aWQpOwo+IC0JaWYgKElTX0VSUihjZSkpCj4gLQkJcmV0dXJuIFBUUl9FUlIoY2Up
Owo+IC0KPiAtCWVyciA9IGludGVsX2NvbnRleHRfcGluKGNlKTsKPiAtCWludGVsX2NvbnRleHRf
cHV0KGNlKTsKPiAtCWlmIChlcnIpCj4gLQkJcmV0dXJuIGVycjsKPiAtCj4gLQkqb3V0ID0gY2U7
Cj4gLQlyZXR1cm4gMDsKPiAtfQo+IC0KPiAgdm9pZAo+ICBpbnRlbF9lbmdpbmVfaW5pdF9hY3Rp
dmUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCB1bnNpZ25lZCBpbnQgc3ViY2xhc3Mp
Cj4gIHsKPiBAQCAtNzQ4LDYgKzcyOCwyNSBAQCBpbnRlbF9lbmdpbmVfaW5pdF9hY3RpdmUoc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCB1bnNpZ25lZCBpbnQgc3ViY2xhc3MpCj4gICNl
bmRpZgo+ICB9Cj4gIAo+ICtzdGF0aWMgc3RydWN0IGludGVsX2NvbnRleHQgKgo+ICtjcmVhdGVf
a2VybmVsX2NvbnRleHQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQo+ICt7Cj4gKwlz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7Cj4gKwlpbnQgZXJyOwo+ICsKPiArCWNlID0gaW50ZWxf
Y29udGV4dF9jcmVhdGUoZW5naW5lLT5pOTE1LT5rZXJuZWxfY29udGV4dCwgZW5naW5lKTsKPiAr
CWlmIChJU19FUlIoY2UpKQo+ICsJCXJldHVybiBjZTsKPiArCj4gKwllcnIgPSBpbnRlbF9jb250
ZXh0X3BpbihjZSk7Cj4gKwlpZiAoZXJyKSB7Cj4gKwkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwo+
ICsJCXJldHVybiBFUlJfUFRSKGVycik7Cj4gKwl9Cj4gKwo+ICsJcmV0dXJuIGNlOwo+ICt9Cj4g
Kwo+ICAvKioKPiAgICogaW50ZWxfZW5naW5lc19pbml0X2NvbW1vbiAtIGluaXRpYWxpemUgY2Vu
Z2luZSBzdGF0ZSB3aGljaCBtaWdodCByZXF1aXJlIGh3IGFjY2Vzcwo+ICAgKiBAZW5naW5lOiBF
bmdpbmUgdG8gaW5pdGlhbGl6ZS4KPiBAQCAtNzYxLDIyICs3NjAsMjQgQEAgaW50ZWxfZW5naW5l
X2luaXRfYWN0aXZlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgdW5zaWduZWQgaW50
IHN1YmNsYXNzKQo+ICAgKi8KPiAgaW50IGludGVsX2VuZ2luZV9pbml0X2NvbW1vbihzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUpCj4gIHsKPiAtCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gZW5naW5lLT5pOTE1Owo+ICsJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwo+ICAJ
aW50IHJldDsKPiAgCj4gIAllbmdpbmUtPnNldF9kZWZhdWx0X3N1Ym1pc3Npb24oZW5naW5lKTsK
PiAgCj4gLQkvKiBXZSBtYXkgbmVlZCB0byBkbyB0aGluZ3Mgd2l0aCB0aGUgc2hyaW5rZXIgd2hp
Y2gKPiArCS8qCj4gKwkgKiBXZSBtYXkgbmVlZCB0byBkbyB0aGluZ3Mgd2l0aCB0aGUgc2hyaW5r
ZXIgd2hpY2gKPiAgCSAqIHJlcXVpcmUgdXMgdG8gaW1tZWRpYXRlbHkgc3dpdGNoIGJhY2sgdG8g
dGhlIGRlZmF1bHQKPiAgCSAqIGNvbnRleHQuIFRoaXMgY2FuIGNhdXNlIGEgcHJvYmxlbSBhcyBw
aW5uaW5nIHRoZQo+ICAJICogZGVmYXVsdCBjb250ZXh0IGFsc28gcmVxdWlyZXMgR1RUIHNwYWNl
IHdoaWNoIG1heSBub3QKPiAgCSAqIGJlIGF2YWlsYWJsZS4gVG8gYXZvaWQgdGhpcyB3ZSBhbHdh
eXMgcGluIHRoZSBkZWZhdWx0Cj4gIAkgKiBjb250ZXh0Lgo+ICAJICovCj4gLQlyZXQgPSBwaW5f
Y29udGV4dChpOTE1LT5rZXJuZWxfY29udGV4dCwgZW5naW5lLAo+IC0JCQkgICZlbmdpbmUtPmtl
cm5lbF9jb250ZXh0KTsKPiAtCWlmIChyZXQpCj4gLQkJcmV0dXJuIHJldDsKPiArCWNlID0gY3Jl
YXRlX2tlcm5lbF9jb250ZXh0KGVuZ2luZSk7Cj4gKwlpZiAoSVNfRVJSKGNlKSkKPiArCQlyZXR1
cm4gUFRSX0VSUihjZSk7Cj4gKwo+ICsJZW5naW5lLT5rZXJuZWxfY29udGV4dCA9IGNlOwo+ICAK
PiAgCXJldCA9IG1lYXN1cmVfYnJlYWRjcnVtYl9kdyhlbmdpbmUpOwo+ICAJaWYgKHJldCA8IDAp
Cj4gQEAgLTc4Nyw3ICs3ODgsOCBAQCBpbnQgaW50ZWxfZW5naW5lX2luaXRfY29tbW9uKHN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKPiAgCXJldHVybiAwOwo+ICAKPiAgZXJyX3VucGlu
Ogo+IC0JaW50ZWxfY29udGV4dF91bnBpbihlbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKPiArCWlu
dGVsX2NvbnRleHRfdW5waW4oY2UpOwo+ICsJaW50ZWxfY29udGV4dF9wdXQoY2UpOwo+ICAJcmV0
dXJuIHJldDsKPiAgfQo+ICAKPiBAQCAtODEyLDYgKzgxNCw3IEBAIHZvaWQgaW50ZWxfZW5naW5l
X2NsZWFudXBfY29tbW9uKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKPiAgCQlpOTE1
X2dlbV9vYmplY3RfcHV0KGVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSk7Cj4gIAo+ICAJaW50ZWxfY29u
dGV4dF91bnBpbihlbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKPiArCWludGVsX2NvbnRleHRfcHV0
KGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOwo+ICAJR0VNX0JVR19PTighbGxpc3RfZW1wdHkoJmVu
Z2luZS0+YmFycmllcl90YXNrcykpOwo+ICAKPiAgCWludGVsX3dhX2xpc3RfZnJlZSgmZW5naW5l
LT5jdHhfd2FfbGlzdCk7Cj4gQEAgLTE1NzMsNSArMTU3Niw2IEBAIGludGVsX2VuZ2luZV9maW5k
X2FjdGl2ZV9yZXF1ZXN0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKPiAgfQo+ICAK
PiAgI2lmIElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X1NFTEZURVNUKQo+ICsjaW5jbHVkZSAi
bW9ja19lbmdpbmUuYyIKPiAgI2luY2x1ZGUgInNlbGZ0ZXN0X2VuZ2luZV9jcy5jIgo+ICAjZW5k
aWYKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvbW9ja19lbmdpbmUuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L21vY2tfZW5naW5lLmMKPiBpbmRleCA4YTVmMDc5MzVi
ODQuLmM2NDc5MDg2NDc5NSAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9t
b2NrX2VuZ2luZS5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvbW9ja19lbmdpbmUu
Ywo+IEBAIC0yODYsOCArMjg2LDcgQEAgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqbW9ja19lbmdp
bmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCj4gIAo+ICBpbnQgbW9ja19lbmdpbmVf
aW5pdChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCj4gIHsKPiAtCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gZW5naW5lLT5pOTE1Owo+IC0JaW50IGVycjsKPiArCXN0cnVj
dCBpbnRlbF9jb250ZXh0ICpjZTsKPiAgCj4gIAlpbnRlbF9lbmdpbmVfaW5pdF9hY3RpdmUoZW5n
aW5lLCBFTkdJTkVfTU9DSyk7Cj4gIAlpbnRlbF9lbmdpbmVfaW5pdF9icmVhZGNydW1icyhlbmdp
bmUpOwo+IEBAIC0yOTUsMTYgKzI5NCwxMSBAQCBpbnQgbW9ja19lbmdpbmVfaW5pdChzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUpCj4gIAlpbnRlbF9lbmdpbmVfaW5pdF9fcG0oZW5naW5l
KTsKPiAgCWludGVsX2VuZ2luZV9wb29sX2luaXQoJmVuZ2luZS0+cG9vbCk7Cj4gIAo+IC0JZW5n
aW5lLT5rZXJuZWxfY29udGV4dCA9Cj4gLQkJaTkxNV9nZW1fY29udGV4dF9nZXRfZW5naW5lKGk5
MTUtPmtlcm5lbF9jb250ZXh0LCBlbmdpbmUtPmlkKTsKPiAtCWlmIChJU19FUlIoZW5naW5lLT5r
ZXJuZWxfY29udGV4dCkpCj4gLQkJZ290byBlcnJfYnJlYWRjcnVtYnM7Cj4gLQo+IC0JZXJyID0g
aW50ZWxfY29udGV4dF9waW4oZW5naW5lLT5rZXJuZWxfY29udGV4dCk7Cj4gLQlpbnRlbF9jb250
ZXh0X3B1dChlbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKPiAtCWlmIChlcnIpCj4gKwljZSA9IGNy
ZWF0ZV9rZXJuZWxfY29udGV4dChlbmdpbmUpOwo+ICsJaWYgKElTX0VSUihjZSkpCj4gIAkJZ290
byBlcnJfYnJlYWRjcnVtYnM7Cj4gIAo+ICsJZW5naW5lLT5rZXJuZWxfY29udGV4dCA9IGNlOwo+
ICAJcmV0dXJuIDA7Cj4gIAo+ICBlcnJfYnJlYWRjcnVtYnM6Cj4gQEAgLTMzOCw2ICszMzIsNyBA
QCB2b2lkIG1vY2tfZW5naW5lX2ZyZWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQo+
ICAJR0VNX0JVR19PTih0aW1lcl9wZW5kaW5nKCZtb2NrLT5od19kZWxheSkpOwo+ICAKPiAgCWlu
dGVsX2NvbnRleHRfdW5waW4oZW5naW5lLT5rZXJuZWxfY29udGV4dCk7Cj4gKwlpbnRlbF9jb250
ZXh0X3B1dChlbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKPiAgCj4gIAlpbnRlbF9lbmdpbmVfZmlu
aV9icmVhZGNydW1icyhlbmdpbmUpOwo+ICAKPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Z0L3NjaGVkdWxlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxl
ci5jCj4gaW5kZXggM2VmOGJlZmE4OTBhLi41YjI5ZjIyZGM3NWEgMTAwNjQ0Cj4gLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Z0L3NjaGVkdWxlci5jCj4gQEAgLTEyMzAsNyArMTIzMCw3IEBAIGludCBpbnRlbF92
Z3B1X3NldHVwX3N1Ym1pc3Npb24oc3RydWN0IGludGVsX3ZncHUgKnZncHUpCj4gIAkJSU5JVF9M
SVNUX0hFQUQoJnMtPndvcmtsb2FkX3FfaGVhZFtpXSk7Cj4gIAkJcy0+c2hhZG93W2ldID0gRVJS
X1BUUigtRUlOVkFMKTsKPiAgCj4gLQkJY2UgPSBpOTE1X2dlbV9jb250ZXh0X2dldF9lbmdpbmUo
Y3R4LCBpKTsKPiArCQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGN0eCwgZW5naW5lKTsKPiAg
CQlpZiAoSVNfRVJSKGNlKSkgewo+ICAJCQlyZXQgPSBQVFJfRVJSKGNlKTsKPiAgCQkJZ290byBv
dXRfc2hhZG93X2N0eDsKPiBAQCAtMTI3MSw2ICsxMjcxLDcgQEAgaW50IGludGVsX3ZncHVfc2V0
dXBfc3VibWlzc2lvbihzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKPiAgCQkJYnJlYWs7Cj4gIAo+
ICAJCWludGVsX2NvbnRleHRfdW5waW4ocy0+c2hhZG93W2ldKTsKPiArCQlpbnRlbF9jb250ZXh0
X3B1dChzLT5zaGFkb3dbaV0pOwo+ICAJfQo+ICAJaTkxNV9nZW1fY29udGV4dF9wdXQoY3R4KTsK
PiAgCXJldHVybiByZXQ7Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
Z2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCj4gaW5kZXggM2Y4ODhkNmQ2
YTc3Li42YmFlMDczZmI1NzAgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9nZW0uYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKPiBAQCAtMTI1
Niw5ICsxMjU2LDggQEAgaW50IGk5MTVfZ2VtX2luaXRfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpCj4gIAo+ICBzdGF0aWMgaW50IF9faW50ZWxfZW5naW5lc19yZWNvcmRfZGVmYXVs
dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCj4gIHsKPiArCXN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJlcXVlc3RzW0k5MTVfTlVNX0VOR0lORVNdID0ge307Cj4gIAlzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmU7Cj4gLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4Owo+IC0J
c3RydWN0IGk5MTVfZ2VtX2VuZ2luZXMgKmU7Cj4gIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsK
PiAgCWludCBlcnIgPSAwOwo+ICAKPiBAQCAtMTI3MSwyMCArMTI3MCwyNSBAQCBzdGF0aWMgaW50
IF9faW50ZWxfZW5naW5lc19yZWNvcmRfZGVmYXVsdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCj4gIAkgKiBmcm9tIHRoZSBzYW1lIGRlZmF1bHQgSFcgdmFsdWVzLgo+ICAJICovCj4g
IAo+IC0JY3R4ID0gaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKGk5MTUsIDApOwo+IC0J
aWYgKElTX0VSUihjdHgpKQo+IC0JCXJldHVybiBQVFJfRVJSKGN0eCk7Cj4gLQo+IC0JZSA9IGk5
MTVfZ2VtX2NvbnRleHRfbG9ja19lbmdpbmVzKGN0eCk7Cj4gLQo+ICAJZm9yX2VhY2hfZW5naW5l
KGVuZ2luZSwgaTkxNSwgaWQpIHsKPiAtCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UgPSBlLT5l
bmdpbmVzW2lkXTsKPiArCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7Cj4gIAkJc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnE7Cj4gIAo+ICsJCS8qIFdlIG11c3QgYmUgYWJsZSB0byBzd2l0Y2ggdG8g
c29tZXRoaW5nISAqLwo+ICsJCUdFTV9CVUdfT04oIWVuZ2luZS0+a2VybmVsX2NvbnRleHQpOwo+
ICsJCWVuZ2luZS0+c2VyaWFsKys7IC8qIGZvcmNlIHRoZSBrZXJuZWwgY29udGV4dCBzd2l0Y2gg
Ki8KPiArCj4gKwkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShpOTE1LT5rZXJuZWxfY29udGV4
dCwgZW5naW5lKTsKPiArCQlpZiAoSVNfRVJSKGNlKSkgewo+ICsJCQllcnIgPSBQVFJfRVJSKGNl
KTsKPiArCQkJZ290byBvdXQ7Cj4gKwkJfQo+ICsKPiAgCQlycSA9IGludGVsX2NvbnRleHRfY3Jl
YXRlX3JlcXVlc3QoY2UpOwo+ICAJCWlmIChJU19FUlIocnEpKSB7Cj4gIAkJCWVyciA9IFBUUl9F
UlIocnEpOwo+IC0JCQlnb3RvIGVycl9hY3RpdmU7Cj4gKwkJCWludGVsX2NvbnRleHRfcHV0KGNl
KTsKPiArCQkJZ290byBvdXQ7Cj4gIAkJfQo+ICAKPiAgCQllcnIgPSBpbnRlbF9lbmdpbmVfZW1p
dF9jdHhfd2EocnEpOwo+IEBAIC0xMzA1LDI2ICsxMzA5LDMzIEBAIHN0YXRpYyBpbnQgX19pbnRl
bF9lbmdpbmVzX3JlY29yZF9kZWZhdWx0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
PiAgCQkJZ290byBlcnJfcnE7Cj4gIAo+ICBlcnJfcnE6Cj4gKwkJcmVxdWVzdHNbaWRdID0gaTkx
NV9yZXF1ZXN0X2dldChycSk7Cj4gIAkJaTkxNV9yZXF1ZXN0X2FkZChycSk7Cj4gIAkJaWYgKGVy
cikKPiAtCQkJZ290byBlcnJfYWN0aXZlOwo+ICsJCQlnb3RvIG91dDsKPiAgCX0KPiAgCj4gIAkv
KiBGbHVzaCB0aGUgZGVmYXVsdCBjb250ZXh0IGltYWdlIHRvIG1lbW9yeSwgYW5kIGVuYWJsZSBw
b3dlcnNhdmluZy4gKi8KPiAgCWlmICghaTkxNV9nZW1fbG9hZF9wb3dlcl9jb250ZXh0KGk5MTUp
KSB7Cj4gIAkJZXJyID0gLUVJTzsKPiAtCQlnb3RvIGVycl9hY3RpdmU7Cj4gKwkJZ290byBvdXQ7
Cj4gIAl9Cj4gIAo+IC0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKPiAtCQlz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UgPSBlLT5lbmdpbmVzW2lkXTsKPiAtCQlzdHJ1Y3QgaTkx
NV92bWEgKnN0YXRlID0gY2UtPnN0YXRlOwo+ICsJZm9yIChpZCA9IDA7IGlkIDwgQVJSQVlfU0la
RShyZXF1ZXN0cyk7IGlkKyspIHsKPiArCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKPiArCQlz
dHJ1Y3QgaTkxNV92bWEgKnN0YXRlOwo+ICAJCXZvaWQgKnZhZGRyOwo+ICAKPiAtCQlpZiAoIXN0
YXRlKQo+ICsJCXJxID0gcmVxdWVzdHNbaWRdOwo+ICsJCWlmICghcnEpCj4gIAkJCWNvbnRpbnVl
Owo+ICAKPiAtCQlHRU1fQlVHX09OKGludGVsX2NvbnRleHRfaXNfcGlubmVkKGNlKSk7Cj4gKwkJ
LyogV2Ugd2FudCB0byBiZSBhYmxlIHRvIHVuYmluZCB0aGUgc3RhdGUgZnJvbSB0aGUgR0dUVCAq
Lwo+ICsJCUdFTV9CVUdfT04oaW50ZWxfY29udGV4dF9pc19waW5uZWQocnEtPmh3X2NvbnRleHQp
KTsKPiArCj4gKwkJc3RhdGUgPSBycS0+aHdfY29udGV4dC0+c3RhdGU7Cj4gKwkJaWYgKCFzdGF0
ZSkKPiArCQkJY29udGludWU7Cj4gIAo+ICAJCS8qCj4gIAkJICogQXMgd2Ugd2lsbCBob2xkIGEg
cmVmZXJlbmNlIHRvIHRoZSBsb2dpY2FsIHN0YXRlLCBpdCB3aWxsCj4gQEAgLTEzMzYsNDMgKzEz
NDcsNDkgQEAgc3RhdGljIGludCBfX2ludGVsX2VuZ2luZXNfcmVjb3JkX2RlZmF1bHRzKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KQo+ICAJCSAqLwo+ICAJCWVyciA9IGk5MTVfdm1hX3Vu
YmluZChzdGF0ZSk7Cj4gIAkJaWYgKGVycikKPiAtCQkJZ290byBlcnJfYWN0aXZlOwo+ICsJCQln
b3RvIG91dDsKPiAgCj4gIAkJaTkxNV9nZW1fb2JqZWN0X2xvY2soc3RhdGUtPm9iaik7Cj4gIAkJ
ZXJyID0gaTkxNV9nZW1fb2JqZWN0X3NldF90b19jcHVfZG9tYWluKHN0YXRlLT5vYmosIGZhbHNl
KTsKCk9rIHRoaXMgaGFzIHRoZSBpbXBsaWNpdCB3YWl0IG9uIGl0LiBXYXMgY29uZnVzZWQgZm9y
IGEgbW9tZW50CnRoYXQgaG93IGNhbiB3ZSBmZXRjaCB0aGUgc3RhdGUgYXN5bmMuCgpUaGUgcGF0
aCBhaGVhZCB0aGF0IG5vIG5lZWQgZm9yIGdsb2JhbCBrZXJuZWwgY29udGV4dCBidXQKZW5naW5l
cyBzZXR1cCB0aGVpciBkZWZhdWx0IGZvciBjbG9uaW5nIG5ldyBvbmVzPwoKQ2FuJ3QgcG9rZSBo
b2xlcyBvbiB0aGlzLiBEaWRuJ3QgZ2V0IGludG8gYm90dG9tIG9mIGhvdyB0aGUKYWN0aXZlIHRy
YWNraW5nIGdyYWJzIHRoZSBjZSByZWZlcmVuY2Ugb24gcGlubmluZyBidXQKZXZlcnl0aGluZyBz
dGF5cyB0aGUgc2FtZSBvbiB0aGF0IGZyb250IHNvIHdhcyBqdXN0IHdhbmRlcmluZwphcm91bmQg
aW4gb3RoZXIgdW5rbm93biBwYXRocy4KClJldmlld2VkLWJ5OiBNaWthIEt1b3BwYWxhIDxtaWth
Lmt1b3BwYWxhQGxpbnV4LmludGVsLmNvbT4KCj4gIAkJaTkxNV9nZW1fb2JqZWN0X3VubG9jayhz
dGF0ZS0+b2JqKTsKPiAgCQlpZiAoZXJyKQo+IC0JCQlnb3RvIGVycl9hY3RpdmU7Cj4gKwkJCWdv
dG8gb3V0Owo+ICAKPiAtCQllbmdpbmUtPmRlZmF1bHRfc3RhdGUgPSBpOTE1X2dlbV9vYmplY3Rf
Z2V0KHN0YXRlLT5vYmopOwo+IC0JCWk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVfY29oZXJlbmN5
KGVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSwKPiAtCQkJCQkJICAgIEk5MTVfQ0FDSEVfTExDKTsKPiAr
CQlpOTE1X2dlbV9vYmplY3Rfc2V0X2NhY2hlX2NvaGVyZW5jeShzdGF0ZS0+b2JqLCBJOTE1X0NB
Q0hFX0xMQyk7Cj4gIAo+ICAJCS8qIENoZWNrIHdlIGNhbiBhY3F1aXJlIHRoZSBpbWFnZSBvZiB0
aGUgY29udGV4dCBzdGF0ZSAqLwo+IC0JCXZhZGRyID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAo
ZW5naW5lLT5kZWZhdWx0X3N0YXRlLAo+IC0JCQkJCQlJOTE1X01BUF9GT1JDRV9XQik7Cj4gKwkJ
dmFkZHIgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChzdGF0ZS0+b2JqLCBJOTE1X01BUF9GT1JD
RV9XQik7Cj4gIAkJaWYgKElTX0VSUih2YWRkcikpIHsKPiAgCQkJZXJyID0gUFRSX0VSUih2YWRk
cik7Cj4gLQkJCWdvdG8gZXJyX2FjdGl2ZTsKPiArCQkJZ290byBvdXQ7Cj4gIAkJfQo+ICAKPiAt
CQlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKGVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSk7Cj4gKwkJ
cnEtPmVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSA9IGk5MTVfZ2VtX29iamVjdF9nZXQoc3RhdGUtPm9i
aik7Cj4gKwkJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChzdGF0ZS0+b2JqKTsKPiAgCX0KPiAg
Cj4gLW91dF9jdHg6Cj4gLQlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19lbmdpbmVzKGN0eCk7Cj4g
LQlpOTE1X2dlbV9jb250ZXh0X3NldF9jbG9zZWQoY3R4KTsKPiAtCWk5MTVfZ2VtX2NvbnRleHRf
cHV0KGN0eCk7Cj4gLQlyZXR1cm4gZXJyOwo+IC0KPiAtZXJyX2FjdGl2ZToKPiArb3V0Ogo+ICAJ
LyoKPiAgCSAqIElmIHdlIGhhdmUgdG8gYWJhbmRvbiBub3csIHdlIGV4cGVjdCB0aGUgZW5naW5l
cyB0byBiZSBpZGxlCj4gIAkgKiBhbmQgcmVhZHkgdG8gYmUgdG9ybi1kb3duLiBUaGUgcXVpY2tl
c3Qgd2F5IHdlIGNhbiBhY2NvbXBsaXNoCj4gIAkgKiB0aGlzIGlzIGJ5IGRlY2xhcmluZyBvdXJz
ZWx2ZXMgd2VkZ2VkLgo+ICAJICovCj4gLQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZpOTE1LT5ndCk7
Cj4gLQlnb3RvIG91dF9jdHg7Cj4gKwlpZiAoZXJyKQo+ICsJCWludGVsX2d0X3NldF93ZWRnZWQo
Jmk5MTUtPmd0KTsKPiArCj4gKwlmb3IgKGlkID0gMDsgaWQgPCBBUlJBWV9TSVpFKHJlcXVlc3Rz
KTsgaWQrKykgewo+ICsJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKPiArCQlzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpycTsKPiArCj4gKwkJcnEgPSByZXF1ZXN0c1tpZF07Cj4gKwkJaWYgKCFycSkK
PiArCQkJY29udGludWU7Cj4gKwo+ICsJCWNlID0gcnEtPmh3X2NvbnRleHQ7Cj4gKwkJaTkxNV9y
ZXF1ZXN0X3B1dChycSk7Cj4gKwkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwo+ICsJfQo+ICsJcmV0
dXJuIGVycjsKPiAgfQo+ICAKPiAgc3RhdGljIGludAo+IC0tIAo+IDIuMjMuMC5yYzEKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxp
bmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

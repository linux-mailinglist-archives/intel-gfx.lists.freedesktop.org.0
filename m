Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3B3792B9AFC
	for <lists+intel-gfx@lfdr.de>; Thu, 19 Nov 2020 19:54:42 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7D4FF6E7D0;
	Thu, 19 Nov 2020 18:54:40 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga05.intel.com (mga05.intel.com [192.55.52.43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 35EB26E7D0
 for <intel-gfx@lists.freedesktop.org>; Thu, 19 Nov 2020 18:54:38 +0000 (UTC)
IronPort-SDR: mYSbIo7/W5ACEbMykQ20MyydW6x909xfwW14nF5uxRA+WASYsvtdAJfROc3i8yji9e69egZtAw
 YwMMsuoYs1UQ==
X-IronPort-AV: E=McAfee;i="6000,8403,9810"; a="256052188"
X-IronPort-AV: E=Sophos;i="5.78,354,1599548400"; d="scan'208";a="256052188"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga008.fm.intel.com ([10.253.24.58])
 by fmsmga105.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 19 Nov 2020 10:54:37 -0800
IronPort-SDR: uXwAfWDRgIl2cV8Nu0XiPdR14TZW0hnu6lhjopy1k/v14nQDrRWi4grsqQapH7P5RqG0tmbbAQ
 5i4ng/3bd7IQ==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.78,354,1599548400"; d="scan'208";a="311174174"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by fmsmga008.fm.intel.com with SMTP; 19 Nov 2020 10:54:36 -0800
Received: by stinkbox (sSMTP sendmail emulation);
 Thu, 19 Nov 2020 20:54:35 +0200
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 19 Nov 2020 20:54:00 +0200
Message-Id: <20201119185401.31883-13-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.26.2
In-Reply-To: <20201119185401.31883-1-ville.syrjala@linux.intel.com>
References: <20201119185401.31883-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 12/13] drm/i915: Remove total[] and uv_total[]
 from ddb allocation
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KClRo
ZXJlJ3MgcmVhbGx5IG5vIG5lZWQgdG8gbWFpbnRhaW4gdGhlc2UgdG90YWxbXSBhcnJheXMgdG8K
dHJhY2sgdGhlIHNpemUgb2YgZWFjaCBwbGFuZSdzIGRkYiBhbGxvY2F0aW9uLiBXZSBqdXN0IHN0
aWNrCnRoZSByZXN1bHRzIHN0cmFpZ2h0IGludG8gdGhlIGNydGNfc3RhdGUgZGRiIHRyYWNraW5n
IHN0cnVjdHVyZXMuCgpUaGUgbWFpbiBhbm5veWFuY2Ugd2l0aCBhbGwgdGhpcyBpcyB0aGUgbWlz
bWF0Y2ggYmV0d2Vlbgp3bV91diB2cy4gZGRiX3kgb24gcHJlLWljbC4gSWYgb25seSB0aGUgaHcg
d2FzIGNvbnNpc3RlbnQgaW4Kd2hhdCBpdCBjb25zaWRlcnMgdGhlIHByaW1hcnkgc291cmNlIG9m
IGluZm9ybWF0aW9uIHdlIGNvdWxkCmF2b2lkIHNvbWUgb2YgdGhlIHVnbHluZXNzLiBCdXQgc2lu
Y2UgdGhhdCBpcyBub3QgdGhlIGNhc2UKd2UgbmVlZCBhIGJpdCBvZiBzcGVjaWFsIGNhc2luZyBm
b3IgcGxhbmFyIGZvcm1hdHMuCgpTaWduZWQtb2ZmLWJ5OiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxl
LnN5cmphbGFAbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVs
X3BtLmMgfCAxMDUgKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFu
Z2VkLCA1MSBpbnNlcnRpb25zKCspLCA1NCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
cG0uYwppbmRleCBhMGVjN2ExMDIyNzAuLjMwZjJkZTcxNTM5OCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF9wbS5jCkBAIC00NjI3LDEzICs0NjI3LDEyIEBAIHNrbF9wbGFuZV93bV9sZXZlbChjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAogc3RydWN0IHNrbF9wbGFuZV9k
ZGJfaXRlciB7CiAJdTY0IGRhdGFfcmF0ZTsKLQl1MTYgdG90YWxbSTkxNV9NQVhfUExBTkVTXTsK
LQl1MTYgdXZfdG90YWxbSTkxNV9NQVhfUExBTkVTXTsKIAl1MTYgc3RhcnQsIHNpemU7CiB9Owog
Ci1zdGF0aWMgdTE2CitzdGF0aWMgdm9pZAogc2tsX2FsbG9jYXRlX3BsYW5lX2RkYihzdHJ1Y3Qg
c2tsX3BsYW5lX2RkYl9pdGVyICppdGVyLAorCQkgICAgICAgc3RydWN0IHNrbF9kZGJfZW50cnkg
KmRkYiwKIAkJICAgICAgIGNvbnN0IHN0cnVjdCBza2xfd21fbGV2ZWwgKndtLAogCQkgICAgICAg
dTY0IGRhdGFfcmF0ZSkKIHsKQEAgLTQ2NDQsNyArNDY0Myw4IEBAIHNrbF9hbGxvY2F0ZV9wbGFu
ZV9kZGIoc3RydWN0IHNrbF9wbGFuZV9kZGJfaXRlciAqaXRlciwKIAlpdGVyLT5zaXplIC09IGV4
dHJhOwogCWl0ZXItPmRhdGFfcmF0ZSAtPSBkYXRhX3JhdGU7CiAKLQlyZXR1cm4gd20tPm1pbl9k
ZGJfYWxsb2MgKyBleHRyYTsKKwlpdGVyLT5zdGFydCA9IHNrbF9kZGJfZW50cnlfaW5pdChkZGIs
IGl0ZXItPnN0YXJ0LAorCQkJCQkgaXRlci0+c3RhcnQgKyB3bS0+bWluX2RkYl9hbGxvYyArIGV4
dHJhKTsKIH0KIAogc3RhdGljIGludApAQCAtNDY1NSw4ICs0NjU1LDkgQEAgc2tsX2FsbG9jYXRl
X3BpcGVfZGRiKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQlpbnRlbF9hdG9t
aWNfZ2V0X25ld19jcnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAlzdHJ1Y3Qgc2tsX2Rk
Yl9lbnRyeSAqYWxsb2MgPSAmY3J0Y19zdGF0ZS0+d20uc2tsLmRkYjsKLQlzdHJ1Y3Qgc2tsX3Bs
YW5lX2RkYl9pdGVyIGl0ZXIgPSB7fTsKKwlzdHJ1Y3Qgc2tsX3BsYW5lX2RkYl9pdGVyIGl0ZXI7
CiAJZW51bSBwbGFuZV9pZCBwbGFuZV9pZDsKKwl1MTYgY3Vyc29yX3NpemU7CiAJaW50IG51bV9h
Y3RpdmU7CiAJdTMyIGJsb2NrczsKIAlpbnQgbGV2ZWw7CkBAIC00NzAxLDE1ICs0NzAyLDE2IEBA
IHNrbF9hbGxvY2F0ZV9waXBlX2RkYihzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwK
IAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCisJaXRlci5zdGFydCA9IGFsbG9jLT5zdGFydDsK
IAlpdGVyLnNpemUgPSBza2xfZGRiX2VudHJ5X3NpemUoYWxsb2MpOwogCWlmIChpdGVyLnNpemUg
PT0gMCkKIAkJcmV0dXJuIDA7CiAKIAkvKiBBbGxvY2F0ZSBmaXhlZCBudW1iZXIgb2YgYmxvY2tz
IGZvciBjdXJzb3IuICovCi0JaXRlci50b3RhbFtQTEFORV9DVVJTT1JdID0gc2tsX2N1cnNvcl9h
bGxvY2F0aW9uKGNydGNfc3RhdGUsIG51bV9hY3RpdmUpOwotCWl0ZXIuc2l6ZSAtPSBpdGVyLnRv
dGFsW1BMQU5FX0NVUlNPUl07CisJY3Vyc29yX3NpemUgPSBza2xfY3Vyc29yX2FsbG9jYXRpb24o
Y3J0Y19zdGF0ZSwgbnVtX2FjdGl2ZSk7CisJaXRlci5zaXplIC09IGN1cnNvcl9zaXplOwogCXNr
bF9kZGJfZW50cnlfaW5pdCgmY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYltQTEFORV9DVVJT
T1JdLAotCQkJICAgYWxsb2MtPmVuZCAtIGl0ZXIudG90YWxbUExBTkVfQ1VSU09SXSwgYWxsb2Mt
PmVuZCk7CisJCQkgICBhbGxvYy0+ZW5kIC0gY3Vyc29yX3NpemUsIGFsbG9jLT5lbmQpOwogCiAJ
aXRlci5kYXRhX3JhdGUgPSBza2xfdG90YWxfcmVsYXRpdmVfZGF0YV9yYXRlKGNydGNfc3RhdGUp
OwogCWlmIChpdGVyLmRhdGFfcmF0ZSA9PSAwKQpAQCAtNDcyMiwxMSArNDcyNCwxMyBAQCBza2xf
YWxsb2NhdGVfcGlwZV9kZGIoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJZm9y
IChsZXZlbCA9IGlsa193bV9tYXhfbGV2ZWwoZGV2X3ByaXYpOyBsZXZlbCA+PSAwOyBsZXZlbC0t
KSB7CiAJCWJsb2NrcyA9IDA7CiAJCWZvcl9lYWNoX3BsYW5lX2lkX29uX2NydGMoY3J0YywgcGxh
bmVfaWQpIHsKKwkJCWNvbnN0IHN0cnVjdCBza2xfZGRiX2VudHJ5ICpkZGIgPQorCQkJCSZjcnRj
X3N0YXRlLT53bS5za2wucGxhbmVfZGRiW3BsYW5lX2lkXTsKIAkJCWNvbnN0IHN0cnVjdCBza2xf
cGxhbmVfd20gKndtID0KIAkJCQkmY3J0Y19zdGF0ZS0+d20uc2tsLm9wdGltYWwucGxhbmVzW3Bs
YW5lX2lkXTsKIAogCQkJaWYgKHBsYW5lX2lkID09IFBMQU5FX0NVUlNPUikgewotCQkJCWlmICh3
bS0+d21bbGV2ZWxdLm1pbl9kZGJfYWxsb2MgPiBpdGVyLnRvdGFsW1BMQU5FX0NVUlNPUl0pIHsK
KwkJCQlpZiAod20tPndtW2xldmVsXS5taW5fZGRiX2FsbG9jID4gc2tsX2RkYl9lbnRyeV9zaXpl
KGRkYikpIHsKIAkJCQkJZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sCiAJCQkJCQkgICAgd20t
PndtW2xldmVsXS5taW5fZGRiX2FsbG9jICE9IFUxNl9NQVgpOwogCQkJCQlibG9ja3MgPSBVMzJf
TUFYOwpAQCAtNDc1OSw2ICs0NzYzLDEwIEBAIHNrbF9hbGxvY2F0ZV9waXBlX2RkYihzdHJ1Y3Qg
aW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAkgKiBwcm9wb3J0aW9uYWwgdG8gaXRzIHJlbGF0
aXZlIGRhdGEgcmF0ZS4KIAkgKi8KIAlmb3JfZWFjaF9wbGFuZV9pZF9vbl9jcnRjKGNydGMsIHBs
YW5lX2lkKSB7CisJCXN0cnVjdCBza2xfZGRiX2VudHJ5ICpkZGIgPQorCQkJJmNydGNfc3RhdGUt
PndtLnNrbC5wbGFuZV9kZGJbcGxhbmVfaWRdOworCQlzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSAqZGRi
X3kgPQorCQkJJmNydGNfc3RhdGUtPndtLnNrbC5wbGFuZV9kZGJfeVtwbGFuZV9pZF07CiAJCWNv
bnN0IHN0cnVjdCBza2xfcGxhbmVfd20gKndtID0KIAkJCSZjcnRjX3N0YXRlLT53bS5za2wub3B0
aW1hbC5wbGFuZXNbcGxhbmVfaWRdOwogCkBAIC00Nzc0LDUxICs0NzgyLDE3IEBAIHNrbF9hbGxv
Y2F0ZV9waXBlX2RkYihzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAogCQlpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA8IDExICYmCiAJCSAgICBjcnRjX3N0YXRlLT5udjEyX3BsYW5l
cyAmIEJJVChwbGFuZV9pZCkpIHsKLQkJCWl0ZXIudG90YWxbcGxhbmVfaWRdID0KLQkJCQlza2xf
YWxsb2NhdGVfcGxhbmVfZGRiKCZpdGVyLCAmd20tPndtW2xldmVsXSwKLQkJCQkJCSAgICAgICBj
cnRjX3N0YXRlLT5yZWxfZGF0YV9yYXRlX3lbcGxhbmVfaWRdKTsKLQkJCWl0ZXIudXZfdG90YWxb
cGxhbmVfaWRdID0KLQkJCQlza2xfYWxsb2NhdGVfcGxhbmVfZGRiKCZpdGVyLCAmd20tPnV2X3dt
W2xldmVsXSwKLQkJCQkJCSAgICAgICBjcnRjX3N0YXRlLT5yZWxfZGF0YV9yYXRlW3BsYW5lX2lk
XSk7CisJCQlza2xfYWxsb2NhdGVfcGxhbmVfZGRiKCZpdGVyLCBkZGJfeSwgJndtLT53bVtsZXZl
bF0sCisJCQkJCSAgICAgICBjcnRjX3N0YXRlLT5yZWxfZGF0YV9yYXRlX3lbcGxhbmVfaWRdKTsK
KwkJCXNrbF9hbGxvY2F0ZV9wbGFuZV9kZGIoJml0ZXIsIGRkYiwgJndtLT51dl93bVtsZXZlbF0s
CisJCQkJCSAgICAgICBjcnRjX3N0YXRlLT5yZWxfZGF0YV9yYXRlW3BsYW5lX2lkXSk7CiAJCX0g
ZWxzZSB7Ci0JCQlpdGVyLnRvdGFsW3BsYW5lX2lkXSA9Ci0JCQkJc2tsX2FsbG9jYXRlX3BsYW5l
X2RkYigmaXRlciwgJndtLT53bVtsZXZlbF0sCi0JCQkJCQkgICAgICAgY3J0Y19zdGF0ZS0+cmVs
X2RhdGFfcmF0ZVtwbGFuZV9pZF0pOworCQkJc2tsX2FsbG9jYXRlX3BsYW5lX2RkYigmaXRlciwg
ZGRiLCAmd20tPndtW2xldmVsXSwKKwkJCQkJICAgICAgIGNydGNfc3RhdGUtPnJlbF9kYXRhX3Jh
dGVbcGxhbmVfaWRdKTsKIAkJfQogCX0KIAlkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwgaXRl
ci5zaXplICE9IDAgfHwgaXRlci5kYXRhX3JhdGUgIT0gMCk7CiAKLQkvKiBTZXQgdGhlIGFjdHVh
bCBEREIgc3RhcnQvZW5kIHBvaW50cyBmb3IgZWFjaCBwbGFuZSAqLwotCWl0ZXIuc3RhcnQgPSBh
bGxvYy0+c3RhcnQ7Ci0JZm9yX2VhY2hfcGxhbmVfaWRfb25fY3J0YyhjcnRjLCBwbGFuZV9pZCkg
ewotCQlzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSAqZGRiID0KLQkJCSZjcnRjX3N0YXRlLT53bS5za2wu
cGxhbmVfZGRiW3BsYW5lX2lkXTsKLQkJc3RydWN0IHNrbF9kZGJfZW50cnkgKmRkYl95ID0KLQkJ
CSZjcnRjX3N0YXRlLT53bS5za2wucGxhbmVfZGRiX3lbcGxhbmVfaWRdOwotCi0JCWlmIChwbGFu
ZV9pZCA9PSBQTEFORV9DVVJTT1IpCi0JCQljb250aW51ZTsKLQotCQkvKiBHZW4xMSsgdXNlcyBh
IHNlcGFyYXRlIHBsYW5lIGZvciBVViB3YXRlcm1hcmtzICovCi0JCWRybV9XQVJOX09OKCZkZXZf
cHJpdi0+ZHJtLAotCQkJICAgIElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEgJiYgaXRlci51dl90
b3RhbFtwbGFuZV9pZF0pOwotCi0JCS8qIExlYXZlIGRpc2FibGVkIHBsYW5lcyBhdCAoMCwwKSAq
LwotCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDExICYmCi0JCSAgICBjcnRjX3N0YXRlLT5u
djEyX3BsYW5lcyAmIEJJVChwbGFuZV9pZCkpIHsKLQkJCWlmIChpdGVyLnRvdGFsW3BsYW5lX2lk
XSkKLQkJCQlpdGVyLnN0YXJ0ID0gc2tsX2RkYl9lbnRyeV9pbml0KGRkYl95LCBpdGVyLnN0YXJ0
LAotCQkJCQkJCQlpdGVyLnN0YXJ0ICsgaXRlci50b3RhbFtwbGFuZV9pZF0pOwotCQkJaWYgKGl0
ZXIudXZfdG90YWxbcGxhbmVfaWRdKQotCQkJCWl0ZXIuc3RhcnQgPSBza2xfZGRiX2VudHJ5X2lu
aXQoZGRiLCBpdGVyLnN0YXJ0LAotCQkJCQkJCQlpdGVyLnN0YXJ0ICsgaXRlci51dl90b3RhbFtw
bGFuZV9pZF0pOwotCQl9IGVsc2UgewotCQkJaWYgKGl0ZXIudG90YWxbcGxhbmVfaWRdKQotCQkJ
CWl0ZXIuc3RhcnQgPSBza2xfZGRiX2VudHJ5X2luaXQoZGRiLCBpdGVyLnN0YXJ0LAotCQkJCQkJ
CQlpdGVyLnN0YXJ0ICsgaXRlci50b3RhbFtwbGFuZV9pZF0pOwotCQl9Ci0JfQotCiAJLyoKIAkg
KiBXaGVuIHdlIGNhbGN1bGF0ZWQgd2F0ZXJtYXJrIHZhbHVlcyB3ZSBkaWRuJ3Qga25vdyBob3cg
aGlnaAogCSAqIG9mIGEgbGV2ZWwgd2UnZCBhY3R1YWxseSBiZSBhYmxlIHRvIGhpdCwgc28gd2Ug
anVzdCBtYXJrZWQKQEAgLTQ4MjcsNiArNDgwMSwxMCBAQCBza2xfYWxsb2NhdGVfcGlwZV9kZGIo
c3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJICovCiAJZm9yIChsZXZlbCsrOyBs
ZXZlbCA8PSBpbGtfd21fbWF4X2xldmVsKGRldl9wcml2KTsgbGV2ZWwrKykgewogCQlmb3JfZWFj
aF9wbGFuZV9pZF9vbl9jcnRjKGNydGMsIHBsYW5lX2lkKSB7CisJCQljb25zdCBzdHJ1Y3Qgc2ts
X2RkYl9lbnRyeSAqZGRiID0KKwkJCQkmY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYltwbGFu
ZV9pZF07CisJCQljb25zdCBzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSAqZGRiX3kgPQorCQkJCSZjcnRj
X3N0YXRlLT53bS5za2wucGxhbmVfZGRiX3lbcGxhbmVfaWRdOwogCQkJc3RydWN0IHNrbF9wbGFu
ZV93bSAqd20gPQogCQkJCSZjcnRjX3N0YXRlLT53bS5za2wub3B0aW1hbC5wbGFuZXNbcGxhbmVf
aWRdOwogCkBAIC00ODQyLDkgKzQ4MjAsMTUgQEAgc2tsX2FsbG9jYXRlX3BpcGVfZGRiKHN0cnVj
dCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQkJICogIHBsYW5lcyBtdXN0IGJlIGVuYWJs
ZWQgYmVmb3JlIHRoZSBsZXZlbCB3aWxsIGJlIHVzZWQuIgogCQkJICogU28gdGhpcyBpcyBhY3R1
YWxseSBzYWZlIHRvIGRvLgogCQkJICovCi0JCQlpZiAod20tPndtW2xldmVsXS5taW5fZGRiX2Fs
bG9jID4gaXRlci50b3RhbFtwbGFuZV9pZF0gfHwKLQkJCSAgICB3bS0+dXZfd21bbGV2ZWxdLm1p
bl9kZGJfYWxsb2MgPiBpdGVyLnV2X3RvdGFsW3BsYW5lX2lkXSkKLQkJCQltZW1zZXQoJndtLT53
bVtsZXZlbF0sIDAsIHNpemVvZih3bS0+d21bbGV2ZWxdKSk7CisJCQlpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA8IDExICYmCisJCQkgICAgY3J0Y19zdGF0ZS0+bnYxMl9wbGFuZXMgJiBCSVQocGxh
bmVfaWQpKSB7CisJCQkJaWYgKHdtLT53bVtsZXZlbF0ubWluX2RkYl9hbGxvYyA+IHNrbF9kZGJf
ZW50cnlfc2l6ZShkZGJfeSkgfHwKKwkJCQkgICAgd20tPnV2X3dtW2xldmVsXS5taW5fZGRiX2Fs
bG9jID4gc2tsX2RkYl9lbnRyeV9zaXplKGRkYikpCisJCQkJCW1lbXNldCgmd20tPndtW2xldmVs
XSwgMCwgc2l6ZW9mKHdtLT53bVtsZXZlbF0pKTsKKwkJCX0gZWxzZSB7CisJCQkJaWYgKHdtLT53
bVtsZXZlbF0ubWluX2RkYl9hbGxvYyA+IHNrbF9kZGJfZW50cnlfc2l6ZShkZGIpKQorCQkJCQlt
ZW1zZXQoJndtLT53bVtsZXZlbF0sIDAsIHNpemVvZih3bS0+d21bbGV2ZWxdKSk7CisJCQl9CiAK
IAkJCS8qCiAJCQkgKiBXYV8xNDA4OTYxMDA4OmljbCwgZWhsCkBAIC00ODY0LDExICs0ODQ4LDI0
IEBAIHNrbF9hbGxvY2F0ZV9waXBlX2RkYihzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0
ZSwKIAkgKiBkb24ndCBoYXZlIGVub3VnaCBEREIgYmxvY2tzIGZvciBpdC4KIAkgKi8KIAlmb3Jf
ZWFjaF9wbGFuZV9pZF9vbl9jcnRjKGNydGMsIHBsYW5lX2lkKSB7CisJCWNvbnN0IHN0cnVjdCBz
a2xfZGRiX2VudHJ5ICpkZGIgPQorCQkJJmNydGNfc3RhdGUtPndtLnNrbC5wbGFuZV9kZGJbcGxh
bmVfaWRdOworCQljb25zdCBzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSAqZGRiX3kgPQorCQkJJmNydGNf
c3RhdGUtPndtLnNrbC5wbGFuZV9kZGJfeVtwbGFuZV9pZF07CiAJCXN0cnVjdCBza2xfcGxhbmVf
d20gKndtID0KIAkJCSZjcnRjX3N0YXRlLT53bS5za2wub3B0aW1hbC5wbGFuZXNbcGxhbmVfaWRd
OwogCi0JCWlmICh3bS0+dHJhbnNfd20ucGxhbmVfcmVzX2IgPj0gaXRlci50b3RhbFtwbGFuZV9p
ZF0pCi0JCQltZW1zZXQoJndtLT50cmFuc193bSwgMCwgc2l6ZW9mKHdtLT50cmFuc193bSkpOwor
CQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDExICYmCisJCSAgICBjcnRjX3N0YXRlLT5udjEy
X3BsYW5lcyAmIEJJVChwbGFuZV9pZCkpIHsKKwkJCWlmICh3bS0+dHJhbnNfd20ucGxhbmVfcmVz
X2IgPj0gc2tsX2RkYl9lbnRyeV9zaXplKGRkYl95KSkKKwkJCQltZW1zZXQoJndtLT50cmFuc193
bSwgMCwgc2l6ZW9mKHdtLT50cmFuc193bSkpOworCQl9IGVsc2UgeworCQkJV0FSTl9PTihza2xf
ZGRiX2VudHJ5X3NpemUoZGRiX3kpKTsKKwkJCVdBUk5fT04od20tPnV2X3dtW2xldmVsXS5taW5f
ZGRiX2FsbG9jKTsKKworCQkJaWYgKHdtLT50cmFuc193bS5wbGFuZV9yZXNfYiA+PSBza2xfZGRi
X2VudHJ5X3NpemUoZGRiKSkKKwkJCQltZW1zZXQoJndtLT50cmFuc193bSwgMCwgc2l6ZW9mKHdt
LT50cmFuc193bSkpOworCQl9CiAJfQogCiAJcmV0dXJuIDA7Ci0tIAoyLjI2LjIKCl9fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5n
IGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVk
ZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

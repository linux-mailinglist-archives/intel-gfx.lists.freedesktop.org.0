Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id A0472E948C
	for <lists+intel-gfx@lfdr.de>; Wed, 30 Oct 2019 02:25:17 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0249F6EC6D;
	Wed, 30 Oct 2019 01:25:12 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga06.intel.com (mga06.intel.com [134.134.136.31])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5CC486E868
 for <intel-gfx@lists.freedesktop.org>; Wed, 30 Oct 2019 01:25:12 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga002.jf.intel.com ([10.7.209.21])
 by orsmga104.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 29 Oct 2019 18:25:11 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.68,245,1569308400"; d="scan'208";a="211945566"
Received: from ldmartin-desk1.jf.intel.com ([10.7.200.70])
 by orsmga002.jf.intel.com with ESMTP; 29 Oct 2019 18:25:10 -0700
From: Lucas De Marchi <lucas.demarchi@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 29 Oct 2019 18:24:48 -0700
Message-Id: <20191030012448.14937-6-lucas.demarchi@intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191030012448.14937-1-lucas.demarchi@intel.com>
References: <20191030012448.14937-1-lucas.demarchi@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 5/5] drm/i915/tgl: Select master transcoder in
 DP MST
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogSm9zw6kgUm9iZXJ0byBkZSBTb3V6YSA8am9zZS5zb3V6YUBpbnRlbC5jb20+CgpPbiBU
R0wgdGhlIGJsZW5kaW5nIG9mIGFsbCB0aGUgc3RyZWFtcyBoYXZlIG1vdmVkIGZyb20gRERJIHRv
CnRyYW5zY29kZXIsIHNvIG5vdyBldmVyeSB0cmFuc2NvZGVyIHdvcmtpbmcgb3ZlciB0aGUgc2Ft
ZSBNU1QgcG9ydCBtdXN0CnNlbmQgaXRzIHN0cmVhbSB0byBhIG1hc3RlciB0cmFuc2NvZGVyIGFu
ZCBtYXN0ZXIgd2lsbCBzZW5kIHRvIERESQpyZXNwZWN0aW5nIHRoZSB0aW1lIHNsb3RzLgoKU28g
aGVyZSBpdCBpcyBwaWNraW5nIHRoZSBsb3dlc3QgcGlwZS90cmFuc2NvZGVyIGFzIGl0IHdpbGwg
YmUKZW5hYmxlZCBmaXJzdCBhbmQgZGlzYWJsZWQgbGFzdC4KQlNwZWM6IDUwNDkzCkJTcGVjOiA0
OTE5MAoKdjI6IE1pc3NlZCBzZXQgbXN0X21hc3Rlcl90cmFucyB0byBUUkFOU0NPREVSX0lOVkFM
SUQgd2hlbiBjb21wdXRpbmcgSFNXCiAgICBlbmNvZGVyIGNvbmZpZy4gSFNXIENSVCBodyBzdGF0
ZSByZWFkb3V0IGNhbGxzCiAgICBoc3dfY3J0X2dldF9jb25maWcoKS0+aW50ZWxfZGRpX2dldF9j
b25maWcoKSB0aGF0IHdpbGwgc2V0CiAgICBtc3RfbWFzdGVyX3RyYW5zIHRvIFRSQU5TQ09ERVJf
SU5WQUxJRCBjYXVzaW5nIHRoZSBtaXNtYXRjaCB3aGVuCiAgICB2ZXJpZnlpbmcgQ1JUQyBzdGF0
ZSBhZnRlciBhIG1vZGVzZXQuIChKb3PDqSkKCnYzOiBBZGQgV0FSTl9PTigpIHJlcXVlc3RlZCBi
eSBKYW5pLgogICAgQWRkIEZJWE1FLiBGcm9tIEphbmk6IGRvdWJsZSBjaGVjawogICAgUElQRV9D
T05GX0NIRUNLX0kobXN0X21hc3Rlcl90cmFucykgLSBpdCdzIG5vdyBjaGVja2luZyBmb3IgYWxs
CiAgICBwbGF0Zm9ybXMgYW5kIE1TVCBhbmQgbm9uLU1TVCBhbGlrZS4gIFBlcmhhcHMgaW4gZ2Vu
ZXJhbCBJJ2QgbGlrZQogICAgdGhlIGFwcHJvYWNoIG9mIG9ubHkgZG9pbmcgdGhlIHJlYWRvdXQg
d2hlbiBpdCdzIHJlbGV2YW50LCBhbmQgb25seQogICAgY2hlY2tpbmcgdGhlIHZhbHVlIHdoZW4g
aXQncyByZWxldmFudC4KCnY0IChMdWNhcyk6IFJldmFtcCBwcmV2aW91cyBpbXBsZW1lbnRhdGlv
bjoKICAgIC0gTWFrZSBzdXJlIHdlIG9ubHkgY29tcHV0ZSBtYXN0ZXIgb25jZTsgdGhlIGNvbXB1
dGUgZnVuY3Rpb24gd2lsbAogICAgICBiZSBjYWxsZWQgZm9yIGVhY2ggY3J0Yywgc28gd2UgZG9u
J3QgbmVlZCB0byByZWNvbXB1dGUgZHVyaW5nIGNoZWNrLgogICAgICBOb3cgdGhlIGNoZWNrIHNp
bXBseSBjb21wYXJlcyB0aGUgbWFzdGVyIGZyb20gYmVmb3JlIGFuZCBhZnRlci4KICAgIC0gRG9u
J3QgbG9vcCBvbiBhbGwgY3J0Y3MgYW5kIGNvbm5lY3RvcnMsIHdlIGNhbiBqdXN0IGxvb3Agb3Zl
ciB0aGUKICAgICAgY29ubmVjdG9ycyBhbmQgZmluZCB0aGUgbG93ZXN0IGNydGMKICAgIC0gTW92
ZSB0aGUgc2V0dGluZyBvZiBJTlZBTElEX1RSQU5TQ09ERVIgYXJvdW5kIHRvIG1ha2UgaXQgc2lt
aWxhcgogICAgICB0byB0aGUgcGxhY2VzIHdoZXJlIHdlIGdvdCBpdCBhZGRlZCBmb3IgbWFzdGVy
IHRyYW5zcG9ydCBzeW5jLgogICAgLSBNb3ZlIGFsbCBhZGRlZCBjb2RlIHRvIHVzZSBpbnRlbCB0
eXBlcwogICAgLSBVc2UgUkVHX0ZJRUxEX0dFVCgpCgpDYzogVmlsbGUgU3lyasOkbMOkIDx2aWxs
ZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KQ2M6IE1hbmFzaSBOYXZhcmUgPG1hbmFzaS5kLm5h
dmFyZUBpbnRlbC5jb20+CkNjOiBSb2RyaWdvIFZpdmkgPHJvZHJpZ28udml2aUBpbnRlbC5jb20+
ClNpZ25lZC1vZmYtYnk6IEpvc8OpIFJvYmVydG8gZGUgU291emEgPGpvc2Uuc291emFAaW50ZWwu
Y29tPgpTaWduZWQtb2ZmLWJ5OiBMdWNhcyBEZSBNYXJjaGkgPGx1Y2FzLmRlbWFyY2hpQGludGVs
LmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jICAgICAg
fCAgMTQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jICB8
ICAxNiArKwogLi4uL2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oICAgIHwg
ICAzICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbXN0LmMgICB8IDE0
MyArKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZHBfbXN0LmggICB8ICAgMiArCiA1IGZpbGVzIGNoYW5nZWQsIDE3NiBpbnNlcnRpb25zKCspLCAy
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGRpLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCmlu
ZGV4IDQxYjliOWE2NzcyYS4uMmMwZGE0NmFjOGUyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZGRpLmMKQEAgLTE5MDYsOCArMTkwNiwxMyBAQCBpbnRlbF9kZGlfdHJhbnNj
b2Rlcl9mdW5jX3JlZ192YWxfZ2V0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogCQl0ZW1wIHw9IFRSQU5TX0RESV9NT0RFX1NFTEVDVF9EUF9NU1Q7CiAJCXRlbXAg
fD0gRERJX1BPUlRfV0lEVEgoY3J0Y19zdGF0ZS0+bGFuZV9jb3VudCk7CiAKLQkJaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPj0gMTIpCi0JCQl0ZW1wIHw9IFRSQU5TX0RESV9NU1RfVFJBTlNQT1JU
X1NFTEVDVChjcnRjX3N0YXRlLT5jcHVfdHJhbnNjb2Rlcik7CisJCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDEyKSB7CisJCQllbnVtIHRyYW5zY29kZXIgbWFzdGVyID0KKwkJCQljcnRjX3N0
YXRlLT5tc3RfbWFzdGVyX3RyYW5zY29kZXI7CisKKwkJCVdBUk5fT04obWFzdGVyID09IElOVkFM
SURfVFJBTlNDT0RFUik7CisJCQl0ZW1wIHw9IFRSQU5TX0RESV9NU1RfVFJBTlNQT1JUX1NFTEVD
VChtYXN0ZXIpOworCQl9CiAJfSBlbHNlIHsKIAkJdGVtcCB8PSBUUkFOU19ERElfTU9ERV9TRUxF
Q1RfRFBfU1NUOwogCQl0ZW1wIHw9IERESV9QT1JUX1dJRFRIKGNydGNfc3RhdGUtPmxhbmVfY291
bnQpOwpAQCAtNDMwNCw2ICs0MzA5LDExIEBAIHZvaWQgaW50ZWxfZGRpX2dldF9jb25maWcoc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCXBpcGVfY29uZmlnLT5vdXRwdXRfdHlwZXMg
fD0gQklUKElOVEVMX09VVFBVVF9EUF9NU1QpOwogCQlwaXBlX2NvbmZpZy0+bGFuZV9jb3VudCA9
CiAJCQkoKHRlbXAgJiBERElfUE9SVF9XSURUSF9NQVNLKSA+PiBERElfUE9SVF9XSURUSF9TSElG
VCkgKyAxOworCisJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKQorCQkJcGlwZV9jb25m
aWctPm1zdF9tYXN0ZXJfdHJhbnNjb2RlciA9CisJCQkJUkVHX0ZJRUxEX0dFVChUUkFOU19ERElf
TVNUX1RSQU5TUE9SVF9TRUxFQ1RfTUFTSywgdGVtcCk7CisKIAkJaW50ZWxfZHBfZ2V0X21fbihp
bnRlbF9jcnRjLCBwaXBlX2NvbmZpZyk7CiAJCWJyZWFrOwogCWRlZmF1bHQ6CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4IGU1NmE3NWMwNzA0My4u
NGRkMWVjMTMwMGYxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rp
c3BsYXkuYwpAQCAtNDYsNiArNDYsNyBAQAogI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfY3J0Lmgi
CiAjaW5jbHVkZSAiZGlzcGxheS9pbnRlbF9kZGkuaCIKICNpbmNsdWRlICJkaXNwbGF5L2ludGVs
X2RwLmgiCisjaW5jbHVkZSAiZGlzcGxheS9pbnRlbF9kcF9tc3QuaCIKICNpbmNsdWRlICJkaXNw
bGF5L2ludGVsX2RzaS5oIgogI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfZHZvLmgiCiAjaW5jbHVk
ZSAiZGlzcGxheS9pbnRlbF9nbWJ1cy5oIgpAQCAtODg5Niw2ICs4ODk3LDcgQEAgc3RhdGljIGJv
b2wgaTl4eF9nZXRfcGlwZV9jb25maWcoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJcGlwZV9j
b25maWctPmNwdV90cmFuc2NvZGVyID0gKGVudW0gdHJhbnNjb2RlcikgY3J0Yy0+cGlwZTsKIAlw
aXBlX2NvbmZpZy0+c2hhcmVkX2RwbGwgPSBOVUxMOwogCXBpcGVfY29uZmlnLT5tYXN0ZXJfdHJh
bnNjb2RlciA9IElOVkFMSURfVFJBTlNDT0RFUjsKKwlwaXBlX2NvbmZpZy0+bXN0X21hc3Rlcl90
cmFuc2NvZGVyID0gSU5WQUxJRF9UUkFOU0NPREVSOwogCiAJcmV0ID0gZmFsc2U7CiAKQEAgLTEw
MDg3LDYgKzEwMDg5LDcgQEAgc3RhdGljIGJvb2wgaXJvbmxha2VfZ2V0X3BpcGVfY29uZmlnKHN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCXBpcGVfY29uZmlnLT5jcHVfdHJhbnNjb2RlciA9IChl
bnVtIHRyYW5zY29kZXIpIGNydGMtPnBpcGU7CiAJcGlwZV9jb25maWctPnNoYXJlZF9kcGxsID0g
TlVMTDsKIAlwaXBlX2NvbmZpZy0+bWFzdGVyX3RyYW5zY29kZXIgPSBJTlZBTElEX1RSQU5TQ09E
RVI7CisJcGlwZV9jb25maWctPm1zdF9tYXN0ZXJfdHJhbnNjb2RlciA9IElOVkFMSURfVFJBTlND
T0RFUjsKIAogCXJldCA9IGZhbHNlOwogCXRtcCA9IEk5MTVfUkVBRChQSVBFQ09ORihjcnRjLT5w
aXBlKSk7CkBAIC0xMDYwMiw2ICsxMDYwNSw3IEBAIHN0YXRpYyBib29sIGhhc3dlbGxfZ2V0X3Bp
cGVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCWludGVsX2NydGNfaW5pdF9zY2Fs
ZXJzKGNydGMsIHBpcGVfY29uZmlnKTsKIAogCXBpcGVfY29uZmlnLT5tYXN0ZXJfdHJhbnNjb2Rl
ciA9IElOVkFMSURfVFJBTlNDT0RFUjsKKwlwaXBlX2NvbmZpZy0+bXN0X21hc3Rlcl90cmFuc2Nv
ZGVyID0gSU5WQUxJRF9UUkFOU0NPREVSOwogCiAJcG93ZXJfZG9tYWluID0gUE9XRVJfRE9NQUlO
X1BJUEUoY3J0Yy0+cGlwZSk7CiAJd2YgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFi
bGVkKGRldl9wcml2LCBwb3dlcl9kb21haW4pOwpAQCAtMTI0NzgsNiArMTI0ODIsMTEgQEAgc3Rh
dGljIHZvaWQgaW50ZWxfZHVtcF9waXBlX2NvbmZpZyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqcGlwZV9jb25maWcsCiAJCQkgICAgICBwaXBlX2NvbmZpZy0+Y3NjX21vZGUsIHBpcGVf
Y29uZmlnLT5nYW1tYV9tb2RlLAogCQkJICAgICAgcGlwZV9jb25maWctPmdhbW1hX2VuYWJsZSwg
cGlwZV9jb25maWctPmNzY19lbmFibGUpOwogCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
MTIgJiYKKwkgICAgaW50ZWxfY3J0Y19oYXNfdHlwZShwaXBlX2NvbmZpZywgSU5URUxfT1VUUFVU
X0RQX01TVCkpCisJCURSTV9ERUJVR19LTVMoIk1TVCBtYXN0ZXIgdHJhbnNjb2RlcjogJXNcbiIs
CisJCQkgICAgICB0cmFuc2NvZGVyX25hbWUocGlwZV9jb25maWctPm1zdF9tYXN0ZXJfdHJhbnNj
b2RlcikpOworCiBkdW1wX3BsYW5lczoKIAlpZiAoIXN0YXRlKQogCQlyZXR1cm47CkBAIC0xMjY5
NCw2ICsxMjcwMyw4IEBAIGludGVsX21vZGVzZXRfcGlwZV9jb25maWcoc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKnBpcGVfY29uZmlnKQogCQlyZXR1cm4gcmV0OwogCX0KIAorCXBpcGVfY29uZmln
LT5tc3RfbWFzdGVyX3RyYW5zY29kZXIgPSBJTlZBTElEX1RSQU5TQ09ERVI7CisKIAkvKiBQYXNz
IG91ciBtb2RlIHRvIHRoZSBjb25uZWN0b3JzIGFuZCB0aGUgQ1JUQyB0byBnaXZlIHRoZW0gYSBj
aGFuY2UgdG8KIAkgKiBhZGp1c3QgaXQgYWNjb3JkaW5nIHRvIGxpbWl0YXRpb25zIG9yIGNvbm5l
Y3RvciBwcm9wZXJ0aWVzLCBhbmQgYWxzbwogCSAqIGEgY2hhbmNlIHRvIHJlamVjdCB0aGUgbW9k
ZSBlbnRpcmVseS4KQEAgLTEzMjE1LDYgKzEzMjI2LDcgQEAgaW50ZWxfcGlwZV9jb25maWdfY29t
cGFyZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3VycmVudF9jb25maWcsCiAKIAlQ
SVBFX0NPTkZfQ0hFQ0tfSShzeW5jX21vZGVfc2xhdmVzX21hc2spOwogCVBJUEVfQ09ORl9DSEVD
S19JKG1hc3Rlcl90cmFuc2NvZGVyKTsKKwlQSVBFX0NPTkZfQ0hFQ0tfSShtc3RfbWFzdGVyX3Ry
YW5zY29kZXIpOwogCiAjdW5kZWYgUElQRV9DT05GX0NIRUNLX1gKICN1bmRlZiBQSVBFX0NPTkZf
Q0hFQ0tfSQpAQCAtMTQwMDMsNiArMTQwMTUsMTAgQEAgc3RhdGljIGludCBpbnRlbF9hdG9taWNf
Y2hlY2soc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAlpZiAocmV0KQogCQlnb3RvIGZhaWw7CiAK
KwlyZXQgPSBpbnRlbF9kcF9tc3RfYXRvbWljX2FkZF9hZmZlY3RlZF9jcnRjcyhzdGF0ZSk7CisJ
aWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKwogCWZvcl9lYWNoX29sZG5ld19pbnRlbF9jcnRjX2lu
X3N0YXRlKHN0YXRlLCBjcnRjLCBvbGRfY3J0Y19zdGF0ZSwKIAkJCQkJICAgIG5ld19jcnRjX3N0
YXRlLCBpKSB7CiAJCWlmICghbmVlZHNfbW9kZXNldChuZXdfY3J0Y19zdGF0ZSkpCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaCBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCmluZGV4
IGE1NTBhYmI0OGIzYy4uNDA3NTNkMWEyOWU1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaApAQCAtMTAwMiw2ICsxMDAyLDkgQEAg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgewogCS8qIEZvcndhcmQgRXJyb3IgY29ycmVjdGlvbiBT
dGF0ZSAqLwogCWJvb2wgZmVjX2VuYWJsZTsKIAorCS8qIE1TVCBtYXN0ZXIgdHJhbnNjb2RlciBm
b3IgYWxsIHN0cmVhbXMsIG9ubHkgdXNlZCBvbiBUR0wrICovCisJZW51bSB0cmFuc2NvZGVyIG1z
dF9tYXN0ZXJfdHJhbnNjb2RlcjsKKwogCS8qIFBvaW50ZXIgdG8gbWFzdGVyIHRyYW5zY29kZXIg
aW4gY2FzZSBvZiB0aWxlZCBkaXNwbGF5cyAqLwogCWVudW0gdHJhbnNjb2RlciBtYXN0ZXJfdHJh
bnNjb2RlcjsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kcF9tc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbXN0LmMK
aW5kZXggYWQ1NDYxOGY2MTQyLi4xYzA0MGRlM2EzOTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kcF9tc3QuYwpAQCAtODcsNiArODcsNTAgQEAgc3RhdGljIGludCBp
bnRlbF9kcF9tc3RfY29tcHV0ZV9saW5rX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciwKIAlyZXR1cm4gMDsKIH0KIAorLyoKKyAqIEl0ZXJhdGUgb3ZlciBhbGwgdGhlIENSVENz
IGFuZCByZXR1cm4gdGhlIHRyYW5zY29kZXIgb2YgdGhlIGxvd2VzdCBDUlRDIHRoYXQKKyAqIHNo
YXJlcyB0aGUgc2FtZSBNU1QgY29ubmVjdG9yLgorICovCit2b2lkCitpbnRlbF9kcF9tc3RfY29t
cHV0ZV9tYXN0ZXJfdHJhbnNjb2RlcihzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICptc3RfY29ubmVj
dG9yLAorCQkJCSAgICAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3sK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+YmFz
ZS5jcnRjLT5kZXYpOworCXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlID0KKwkJdG9f
aW50ZWxfYXRvbWljX3N0YXRlKGNydGNfc3RhdGUtPmJhc2Uuc3RhdGUpOworCWVudW0gdHJhbnNj
b2RlciBtc3RfbWFzdGVyX3RyYW5zY29kZXIgPSBjcnRjX3N0YXRlLT5jcHVfdHJhbnNjb2RlcjsK
KwlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb3RoZXJfY3J0Y19zdGF0ZTsKKwlzdHJ1Y3QgaW50
ZWxfZGlnaXRhbF9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGU7CisJc3RydWN0IGludGVsX2Nv
bm5lY3RvciAqY29ubjsKKwlpbnQgaTsKKworCWlmIChJTlRFTF9HRU4oaTkxNSkgPCAxMikKKwkJ
cmV0dXJuOworCisJZm9yX2VhY2hfbmV3X2ludGVsX2Nvbm5lY3Rvcl9pbl9zdGF0ZShzdGF0ZSwg
Y29ubiwgY29ubl9zdGF0ZSwgaSkgeworCQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2lu
dGVsX2NydGMoY29ubl9zdGF0ZS0+YmFzZS5jcnRjKTsKKworCQlpZiAoY29ubiA9PSBtc3RfY29u
bmVjdG9yIHx8CisJCSAgICBjb25uLT5tc3RfcG9ydCAhPSBtc3RfY29ubmVjdG9yLT5tc3RfcG9y
dCB8fAorCQkgICAgIWNydGMpCisJCQljb250aW51ZTsKKworCQlvdGhlcl9jcnRjX3N0YXRlID0g
aW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0ZSwgY3J0Yyk7CisJCWlmICghb3Ro
ZXJfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpCisJCQljb250aW51ZTsKKworCQlpZiAob3RoZXJf
Y3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXIgPCBtc3RfbWFzdGVyX3RyYW5zY29kZXIpCisJCQlt
c3RfbWFzdGVyX3RyYW5zY29kZXIgPSBvdGhlcl9jcnRjX3N0YXRlLT5jcHVfdHJhbnNjb2RlcjsK
Kwl9CisKKwljcnRjX3N0YXRlLT5tc3RfbWFzdGVyX3RyYW5zY29kZXIgPSBtc3RfbWFzdGVyX3Ry
YW5zY29kZXI7CisKKwlEUk1fREVCVUdfS01TKCJbQ1JUQzolZDolc10gTVNUIG1hc3RlciB0cmFu
c2NvZGVyOiAlc1xuIiwKKwkJICAgICAgY3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5iYXNlLmlkLAor
CQkgICAgICBjcnRjX3N0YXRlLT5iYXNlLmNydGMtPm5hbWUsCisJCSAgICAgIHRyYW5zY29kZXJf
bmFtZShtc3RfbWFzdGVyX3RyYW5zY29kZXIpKTsKK30KKwogc3RhdGljIGludCBpbnRlbF9kcF9t
c3RfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkJICAg
ICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZywKIAkJCQkgICAgICAgc3Ry
dWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCkBAIC0xNTQsNiArMTk4LDQyIEBA
IHN0YXRpYyBpbnQgaW50ZWxfZHBfbXN0X2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyLAogCiAJaW50ZWxfZGRpX2NvbXB1dGVfbWluX3ZvbHRhZ2VfbGV2ZWwoZGV2
X3ByaXYsIHBpcGVfY29uZmlnKTsKIAorCWludGVsX2RwX21zdF9jb21wdXRlX21hc3Rlcl90cmFu
c2NvZGVyKGNvbm5lY3RvciwgcGlwZV9jb25maWcpOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRp
YyBpbnQKK2ludGVsX2RwX21zdF9tYXN0ZXJfdHJhbnNjb2Rlcl9jaGVjayhzdHJ1Y3QgaW50ZWxf
Y29ubmVjdG9yICpjb25uZWN0b3IsCisJCQkJICAgICBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
ICpzdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY29u
bmVjdG9yLT5iYXNlLmRldik7CisJc3RydWN0IGludGVsX2RpZ2l0YWxfY29ubmVjdG9yX3N0YXRl
ICpuZXdfY29ubl9zdGF0ZSA9CisJCWludGVsX2F0b21pY19nZXRfbmV3X2Nvbm5lY3Rvcl9zdGF0
ZShzdGF0ZSwgY29ubmVjdG9yKTsKKwlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9jb25uZWN0b3Jfc3Rh
dGUgKm9sZF9jb25uX3N0YXRlID0KKwkJaW50ZWxfYXRvbWljX2dldF9vbGRfY29ubmVjdG9yX3N0
YXRlKHN0YXRlLCBjb25uZWN0b3IpOworCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0
Y19zdGF0ZSwgKm9sZF9jcnRjX3N0YXRlOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOworCisJ
aWYgKElOVEVMX0dFTihpOTE1KSA8IDEyKQorCQlyZXR1cm4gMDsKKworCS8qCisJICogQSBtb2Rl
c2V0IHdpbGwgYmUgdHJpZ2dlcmVkIHdoZW4gY2hlY2tpbmcgb3RoZXIgYWZmZWN0ZWQgY3J0Y3Mg
aWYKKwkgKiB0aGlzIHdhcyBjb25uZWN0ZWQgdG8gYSBtYXN0ZXIgdHJhbnNjb2RlcgorCSAqLwor
CWlmICghbmV3X2Nvbm5fc3RhdGUtPmJhc2UuY3J0YykKKwkJcmV0dXJuIDA7CisKKwljcnRjID0g
dG9faW50ZWxfY3J0YyhuZXdfY29ubl9zdGF0ZS0+YmFzZS5jcnRjKTsKKwluZXdfY3J0Y19zdGF0
ZSA9IGludGVsX2F0b21pY19nZXRfbmV3X2NydGNfc3RhdGUoc3RhdGUsIGNydGMpOworCW9sZF9j
cnRjX3N0YXRlID0gaW50ZWxfYXRvbWljX2dldF9vbGRfY3J0Y19zdGF0ZShzdGF0ZSwgY3J0Yyk7
CisKKwlpZiAoIW9sZF9jb25uX3N0YXRlIHx8CisJICAgIG5ld19jcnRjX3N0YXRlLT5tc3RfbWFz
dGVyX3RyYW5zY29kZXIgIT0KKwkgICAgb2xkX2NydGNfc3RhdGUtPm1zdF9tYXN0ZXJfdHJhbnNj
b2RlcikKKwkJbmV3X2NydGNfc3RhdGUtPmJhc2UubW9kZV9jaGFuZ2VkID0gdHJ1ZTsKKwogCXJl
dHVybiAwOwogfQogCkBAIC0xNzYsNiArMjU2LDExIEBAIGludGVsX2RwX21zdF9hdG9taWNfY2hl
Y2soc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKIAlpZiAocmV0KQogCQlyZXR1cm4g
cmV0OwogCisJcmV0ID0gaW50ZWxfZHBfbXN0X21hc3Rlcl90cmFuc2NvZGVyX2NoZWNrKGludGVs
X2Nvbm5lY3RvciwKKwkJCQkJCSAgIHRvX2ludGVsX2F0b21pY19zdGF0ZShzdGF0ZSkpOworCWlm
IChyZXQpCisJCXJldHVybiByZXQ7CisKIAlpZiAoIW9sZF9jb25uX3N0YXRlLT5jcnRjKQogCQly
ZXR1cm4gMDsKIApAQCAtNzA2LDMgKzc5MSw2MSBAQCBpbnRlbF9kcF9tc3RfZW5jb2Rlcl9jbGVh
bnVwKHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0KQogCWRybV9kcF9t
c3RfdG9wb2xvZ3lfbWdyX2Rlc3Ryb3koJmludGVsX2RwLT5tc3RfbWdyKTsKIAkvKiBlbmNvZGVy
cyB3aWxsIGdldCBraWxsZWQgYnkgbm9ybWFsIGNsZWFudXAgKi8KIH0KKworLyoqCisgKiBpbnRl
bF9kcF9tc3RfYXRvbWljX2FkZF9hZmZlY3RlZF9jcnRjcyAtIEFkZCBhbGwgQ1JUQ3MgdGhhdCBz
aGFyZSB0aGUgTVNUCisgKiBwb3J0IHdpdGggdGhlIENSVENzIGluIHRoZSBjdXJyZW50IGF0b21p
YyBzdGF0ZS4KKyAqIEBzdGF0ZTogc3RhdGUgdG8gYWRkIENSVENzCisgKgorICogV2UgbmVlZCB0
byBtYWtlIHRoZSBDUlRDcyB0cmlnZ2VyIGEgY2FsbCB0byBhdG9taWNfY2hlY2soKSB0byBldmVy
eSBjb25uZWN0b3IKKyAqIGF0dGFjaGVkIHRvIHRoZSBDUlRDIGluIGNhc2UgYSBuZXcgbWFzdGVy
IHRyYW5zY29kZXIgaXMgbmVlZGVkLgorICovCitpbnQgaW50ZWxfZHBfbXN0X2F0b21pY19hZGRf
YWZmZWN0ZWRfY3J0Y3Moc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCit7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5kZXYp
OworCXN0cnVjdCBpbnRlbF9kaWdpdGFsX2Nvbm5lY3Rvcl9zdGF0ZSAqaW50ZWxfY29ubl9zdGF0
ZTsKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gc3RhdGUtPmJhc2UuZGV2OworCXN0cnVjdCBp
bnRlbF9jb25uZWN0b3IgKmludGVsX2Nvbm47CisJaW50IGk7CisKKwlpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA8IDEyKQorCQlyZXR1cm4gMDsKKworCWZvcl9lYWNoX25ld19pbnRlbF9jb25uZWN0
b3JfaW5fc3RhdGUoc3RhdGUsIGludGVsX2Nvbm4sIGludGVsX2Nvbm5fc3RhdGUsIGkpIHsKKwkJ
c3RydWN0IGRybV9jb25uZWN0b3JfbGlzdF9pdGVyIGNvbm5fbGlzdF9pdGVyOworCQlzdHJ1Y3Qg
ZHJtX2Nvbm5lY3RvciAqY29ubl9pdGVyOworCisJCWlmICghaW50ZWxfY29ubi0+bXN0X3BvcnQp
CisJCQljb250aW51ZTsKKworCQlkcm1fY29ubmVjdG9yX2xpc3RfaXRlcl9iZWdpbihkZXYsICZj
b25uX2xpc3RfaXRlcik7CisJCWRybV9mb3JfZWFjaF9jb25uZWN0b3JfaXRlcihjb25uX2l0ZXIs
ICZjb25uX2xpc3RfaXRlcikgeworCQkJc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5f
aXRlcl9zdGF0ZTsKKwkJCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmludGVsX2Nvbm5faXRlcjsK
KwkJCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKKworCQkJaW50ZWxfY29ubl9p
dGVyID0gdG9faW50ZWxfY29ubmVjdG9yKGNvbm5faXRlcik7CisKKwkJCWlmIChpbnRlbF9jb25u
X2l0ZXItPm1zdF9wb3J0ICE9IGludGVsX2Nvbm4tPm1zdF9wb3J0KQorCQkJCWNvbnRpbnVlOwor
CisJCQljb25uX2l0ZXJfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9jb25uZWN0b3Jfc3RhdGUoJnN0
YXRlLT5iYXNlLCBjb25uX2l0ZXIpOworCQkJaWYgKElTX0VSUihjb25uX2l0ZXJfc3RhdGUpKSB7
CisJCQkJZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXJfZW5kKCZjb25uX2xpc3RfaXRlcik7CisJCQkJ
cmV0dXJuIFBUUl9FUlIoY29ubl9pdGVyX3N0YXRlKTsKKwkJCX0KKwkJCWlmICghY29ubl9pdGVy
X3N0YXRlLT5jcnRjKQorCQkJCWNvbnRpbnVlOworCisJCQljcnRjX3N0YXRlID0gZHJtX2F0b21p
Y19nZXRfY3J0Y19zdGF0ZSgmc3RhdGUtPmJhc2UsCisJCQkJCQkJICAgICAgIGNvbm5faXRlcl9z
dGF0ZS0+Y3J0Yyk7CisJCQlpZiAoSVNfRVJSKGNydGNfc3RhdGUpKSB7CisJCQkJZHJtX2Nvbm5l
Y3Rvcl9saXN0X2l0ZXJfZW5kKCZjb25uX2xpc3RfaXRlcik7CisJCQkJcmV0dXJuIFBUUl9FUlIo
Y3J0Y19zdGF0ZSk7CisJCQl9CisJCX0KKwkJZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXJfZW5kKCZj
b25uX2xpc3RfaXRlcik7CisJfQorCisJcmV0dXJuIDA7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX21zdC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kcF9tc3QuaAppbmRleCBmNjYwYWQ4MGRiMDQuLjllNjU0Zjc3YTJk
MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9tc3Qu
aAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX21zdC5oCkBAIC03
LDkgKzcsMTEgQEAKICNkZWZpbmUgX19JTlRFTF9EUF9NU1RfSF9fCiAKIHN0cnVjdCBpbnRlbF9k
aWdpdGFsX3BvcnQ7CitzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlOwogCiBpbnQgaW50ZWxfZHBf
bXN0X2VuY29kZXJfaW5pdChzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9y
dCwgaW50IGNvbm5faWQpOwogdm9pZCBpbnRlbF9kcF9tc3RfZW5jb2Rlcl9jbGVhbnVwKHN0cnVj
dCBpbnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0KTsKIGludCBpbnRlbF9kcF9tc3Rf
ZW5jb2Rlcl9hY3RpdmVfbGlua3Moc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGln
X3BvcnQpOworaW50IGludGVsX2RwX21zdF9hdG9taWNfYWRkX2FmZmVjdGVkX2NydGNzKHN0cnVj
dCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKTsKIAogI2VuZGlmIC8qIF9fSU5URUxfRFBfTVNU
X0hfXyAqLwotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVz
a3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9p
bnRlbC1nZng=

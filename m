Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3AB332DBF6D
	for <lists+intel-gfx@lfdr.de>; Wed, 16 Dec 2020 12:30:46 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A7D606E165;
	Wed, 16 Dec 2020 11:30:44 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga02.intel.com (mga02.intel.com [134.134.136.20])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A4BCD6E165
 for <intel-gfx@lists.freedesktop.org>; Wed, 16 Dec 2020 11:30:43 +0000 (UTC)
IronPort-SDR: fw724HUzzxSSAeJjs94k58l7sxkNWu/MuwY9pqTFGprvPquSl1urfojP+gYQYiWBlkKUJaUTlo
 Ur0lcFIXip0A==
X-IronPort-AV: E=McAfee;i="6000,8403,9836"; a="162099288"
X-IronPort-AV: E=Sophos;i="5.78,424,1599548400"; d="scan'208";a="162099288"
Received: from orsmga003.jf.intel.com ([10.7.209.27])
 by orsmga101.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 16 Dec 2020 03:30:43 -0800
IronPort-SDR: ODpisqRxBt7cEA9FtFioR1qQUeVDtYYmtKX3kdVHQaBtLDRon1XrAZfkj24eqimG42Q7hKvV7b
 7ck5/rL6/fdQ==
X-IronPort-AV: E=Sophos;i="5.78,424,1599548400"; d="scan'208";a="337487829"
Received: from slevy-mobl.ger.corp.intel.com (HELO localhost)
 ([10.214.192.176])
 by orsmga003-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 16 Dec 2020 03:30:36 -0800
From: Jani Nikula <jani.nikula@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 16 Dec 2020 13:29:16 +0200
Message-Id: <bd552745b685888a9137d171b5b6acaab8ac7a99.1608117676.git.jani.nikula@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <cover.1608117676.git.jani.nikula@intel.com>
References: <cover.1608117676.git.jani.nikula@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v4 09/11] drm/i915: migrate skl planes code new
 file
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com, Dave Airlie <airlied@redhat.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogRGF2ZSBBaXJsaWUgPGFpcmxpZWRAcmVkaGF0LmNvbT4KClJld29yayB0aGUgcGxhbmUg
aW5pdCBjYWxscyB0byBkbyB0aGUgZ2VuIHRlc3Qgb25lIGxldmVsIGhpZ2hlci4KClNpZ25lZC1v
ZmYtYnk6IERhdmUgQWlybGllIDxhaXJsaWVkQHJlZGhhdC5jb20+CltKYW5pOiBmaXhlZCB1cCBz
cGFyc2Ugd2FybmluZ3MuXQpTaWduZWQtb2ZmLWJ5OiBKYW5pIE5pa3VsYSA8amFuaS5uaWt1bGFA
aW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlICAgICAgICAgICAg
ICAgICB8ICAgIDEgKwogLi4uL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19wbGFu
ZS5jIHwgICA3NiAtCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NydGMuYyAg
ICAgfCAgIDE2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXku
YyAgfCAxNDEwICstLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rp
c3BsYXkuaCAgfCAgIDM2ICstCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5
cGVzLmggICAgfCAgIDIxICsKIC4uLi9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9nZW45X3Bs
YW5lLmMgICB8IDI4MzIgKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfc3ByaXRlLmMgICB8IDE0MTcgKy0tLS0tLS0tCiA4IGZpbGVzIGNoYW5nZWQs
IDI5MzEgaW5zZXJ0aW9ucygrKSwgMjg3OCBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0
NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2dlbjlfcGxhbmUuYwoKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvTWFrZWZpbGUKaW5kZXggNDJmOWMxY2EzYzA4Li5hNGY2N2M3OTUyNDAgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L01ha2VmaWxlCkBAIC0yMTEsNiArMjExLDcgQEAgaTkxNS15ICs9IFwKIAlkaXNwbGF5L2ludGVs
X2ZpZm9fdW5kZXJydW4ubyBcCiAJZGlzcGxheS9pbnRlbF9mcm9udGJ1ZmZlci5vIFwKIAlkaXNw
bGF5L2ludGVsX2dsb2JhbF9zdGF0ZS5vIFwKKwlkaXNwbGF5L2ludGVsX2dlbjlfcGxhbmUubyBc
CiAJZGlzcGxheS9pbnRlbF9oZGNwLm8gXAogCWRpc3BsYXkvaW50ZWxfaG90cGx1Zy5vIFwKIAlk
aXNwbGF5L2ludGVsX2xwZV9hdWRpby5vIFwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljX3BsYW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2F0b21pY19wbGFuZS5jCmluZGV4IGI1ZTFlZTk5NTM1Yy4uMTAxOTdjYzE1
OGMxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21p
Y19wbGFuZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWlj
X3BsYW5lLmMKQEAgLTM5OSw1MCArMzk5LDYgQEAgaW50IGludGVsX3BsYW5lX2F0b21pY19jaGVj
ayhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAkJCQkJCSAgIG5ld19wbGFuZV9z
dGF0ZSk7CiB9CiAKLXN0YXRpYyBzdHJ1Y3QgaW50ZWxfcGxhbmUgKgotc2tsX25leHRfcGxhbmVf
dG9fY29tbWl0KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAotCQkJIHN0cnVjdCBp
bnRlbF9jcnRjICpjcnRjLAotCQkJIHN0cnVjdCBza2xfZGRiX2VudHJ5IGVudHJpZXNfeVtJOTE1
X01BWF9QTEFORVNdLAotCQkJIHN0cnVjdCBza2xfZGRiX2VudHJ5IGVudHJpZXNfdXZbSTkxNV9N
QVhfUExBTkVTXSwKLQkJCSB1bnNpZ25lZCBpbnQgKnVwZGF0ZV9tYXNrKQotewotCXN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlID0KLQkJaW50ZWxfYXRvbWljX2dldF9uZXdfY3J0
Y19zdGF0ZShzdGF0ZSwgY3J0Yyk7Ci0Jc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9z
dGF0ZTsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOwotCWludCBpOwotCi0JaWYgKCp1cGRh
dGVfbWFzayA9PSAwKQotCQlyZXR1cm4gTlVMTDsKLQotCWZvcl9lYWNoX25ld19pbnRlbF9wbGFu
ZV9pbl9zdGF0ZShzdGF0ZSwgcGxhbmUsIHBsYW5lX3N0YXRlLCBpKSB7Ci0JCWVudW0gcGxhbmVf
aWQgcGxhbmVfaWQgPSBwbGFuZS0+aWQ7Ci0KLQkJaWYgKGNydGMtPnBpcGUgIT0gcGxhbmUtPnBp
cGUgfHwKLQkJICAgICEoKnVwZGF0ZV9tYXNrICYgQklUKHBsYW5lX2lkKSkpCi0JCQljb250aW51
ZTsKLQotCQlpZiAoc2tsX2RkYl9hbGxvY2F0aW9uX292ZXJsYXBzKCZjcnRjX3N0YXRlLT53bS5z
a2wucGxhbmVfZGRiX3lbcGxhbmVfaWRdLAotCQkJCQkJZW50cmllc195LAotCQkJCQkJSTkxNV9N
QVhfUExBTkVTLCBwbGFuZV9pZCkgfHwKLQkJICAgIHNrbF9kZGJfYWxsb2NhdGlvbl9vdmVybGFw
cygmY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYl91dltwbGFuZV9pZF0sCi0JCQkJCQllbnRy
aWVzX3V2LAotCQkJCQkJSTkxNV9NQVhfUExBTkVTLCBwbGFuZV9pZCkpCi0JCQljb250aW51ZTsK
LQotCQkqdXBkYXRlX21hc2sgJj0gfkJJVChwbGFuZV9pZCk7Ci0JCWVudHJpZXNfeVtwbGFuZV9p
ZF0gPSBjcnRjX3N0YXRlLT53bS5za2wucGxhbmVfZGRiX3lbcGxhbmVfaWRdOwotCQllbnRyaWVz
X3V2W3BsYW5lX2lkXSA9IGNydGNfc3RhdGUtPndtLnNrbC5wbGFuZV9kZGJfdXZbcGxhbmVfaWRd
OwotCi0JCXJldHVybiBwbGFuZTsKLQl9Ci0KLQkvKiBzaG91bGQgbmV2ZXIgaGFwcGVuICovCi0J
ZHJtX1dBUk5fT04oc3RhdGUtPmJhc2UuZGV2LCAxKTsKLQotCXJldHVybiBOVUxMOwotfQotCiB2
b2lkIGludGVsX3VwZGF0ZV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCQkJY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQljb25zdCBzdHJ1Y3Qg
aW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQpAQCAtNDY2LDM4ICs0MjIsNiBAQCB2b2lk
IGludGVsX2Rpc2FibGVfcGxhbmUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAlwbGFuZS0+
ZGlzYWJsZV9wbGFuZShwbGFuZSwgY3J0Y19zdGF0ZSk7CiB9CiAKLXZvaWQgc2tsX3VwZGF0ZV9w
bGFuZXNfb25fY3J0YyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKLQkJCSAgICAg
ICBzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKLXsKLQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
b2xkX2NydGNfc3RhdGUgPQotCQlpbnRlbF9hdG9taWNfZ2V0X29sZF9jcnRjX3N0YXRlKHN0YXRl
LCBjcnRjKTsKLQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUgPQotCQlp
bnRlbF9hdG9taWNfZ2V0X25ld19jcnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsKLQlzdHJ1Y3Qgc2ts
X2RkYl9lbnRyeSBlbnRyaWVzX3lbSTkxNV9NQVhfUExBTkVTXTsKLQlzdHJ1Y3Qgc2tsX2RkYl9l
bnRyeSBlbnRyaWVzX3V2W0k5MTVfTUFYX1BMQU5FU107Ci0JdTMyIHVwZGF0ZV9tYXNrID0gbmV3
X2NydGNfc3RhdGUtPnVwZGF0ZV9wbGFuZXM7Ci0Jc3RydWN0IGludGVsX3BsYW5lICpwbGFuZTsK
LQotCW1lbWNweShlbnRyaWVzX3ksIG9sZF9jcnRjX3N0YXRlLT53bS5za2wucGxhbmVfZGRiX3ks
Ci0JICAgICAgIHNpemVvZihvbGRfY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYl95KSk7Ci0J
bWVtY3B5KGVudHJpZXNfdXYsIG9sZF9jcnRjX3N0YXRlLT53bS5za2wucGxhbmVfZGRiX3V2LAot
CSAgICAgICBzaXplb2Yob2xkX2NydGNfc3RhdGUtPndtLnNrbC5wbGFuZV9kZGJfdXYpKTsKLQot
CXdoaWxlICgocGxhbmUgPSBza2xfbmV4dF9wbGFuZV90b19jb21taXQoc3RhdGUsIGNydGMsCi0J
CQkJCQkgZW50cmllc195LCBlbnRyaWVzX3V2LAotCQkJCQkJICZ1cGRhdGVfbWFzaykpKSB7Ci0J
CXN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqbmV3X3BsYW5lX3N0YXRlID0KLQkJCWludGVsX2F0
b21pY19nZXRfbmV3X3BsYW5lX3N0YXRlKHN0YXRlLCBwbGFuZSk7Ci0KLQkJaWYgKG5ld19wbGFu
ZV9zdGF0ZS0+dWFwaS52aXNpYmxlIHx8Ci0JCSAgICBuZXdfcGxhbmVfc3RhdGUtPnBsYW5hcl9z
bGF2ZSkgewotCQkJaW50ZWxfdXBkYXRlX3BsYW5lKHBsYW5lLCBuZXdfY3J0Y19zdGF0ZSwgbmV3
X3BsYW5lX3N0YXRlKTsKLQkJfSBlbHNlIHsKLQkJCWludGVsX2Rpc2FibGVfcGxhbmUocGxhbmUs
IG5ld19jcnRjX3N0YXRlKTsKLQkJfQotCX0KLX0KLQogdm9pZCBpOXh4X3VwZGF0ZV9wbGFuZXNf
b25fY3J0YyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAkJCQlzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YykKIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfY3J0Yy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jcnRj
LmMKaW5kZXggZDI2YmViOGFkOWVkLi4wMTYxZTE4ZjFhNTAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY3J0Yy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfY3J0Yy5jCkBAIC02MTcsMTAgKzYxNyw2IEBAIGludGVsX3ByaW1h
cnlfcGxhbmVfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBw
aXBlIHBpcGUpCiAJaW50IG51bV9mb3JtYXRzOwogCWludCByZXQsIHpwb3M7CiAKLQlpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA+PSA5KQotCQlyZXR1cm4gc2tsX3VuaXZlcnNhbF9wbGFuZV9jcmVh
dGUoZGV2X3ByaXYsIHBpcGUsCi0JCQkJCQkgIFBMQU5FX1BSSU1BUlkpOwotCiAJcGxhbmUgPSBp
bnRlbF9wbGFuZV9hbGxvYygpOwogCWlmIChJU19FUlIocGxhbmUpKQogCQlyZXR1cm4gcGxhbmU7
CkBAIC04NzEsNyArODY3LDExIEBAIGludCBpbnRlbF9jcnRjX2luaXQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBpcGUgcGlwZSkKIAljcnRjLT5waXBlID0gcGlwZTsK
IAljcnRjLT5udW1fc2NhbGVycyA9IFJVTlRJTUVfSU5GTyhkZXZfcHJpdiktPm51bV9zY2FsZXJz
W3BpcGVdOwogCi0JcHJpbWFyeSA9IGludGVsX3ByaW1hcnlfcGxhbmVfY3JlYXRlKGRldl9wcml2
LCBwaXBlKTsKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5KQorCQlwcmltYXJ5ID0gc2ts
X3VuaXZlcnNhbF9wbGFuZV9jcmVhdGUoZGV2X3ByaXYsIHBpcGUsCisJCQkJCQkgICAgIFBMQU5F
X1BSSU1BUlkpOworCWVsc2UKKwkJcHJpbWFyeSA9IGludGVsX3ByaW1hcnlfcGxhbmVfY3JlYXRl
KGRldl9wcml2LCBwaXBlKTsKIAlpZiAoSVNfRVJSKHByaW1hcnkpKSB7CiAJCXJldCA9IFBUUl9F
UlIocHJpbWFyeSk7CiAJCWdvdG8gZmFpbDsKQEAgLTg4MSw3ICs4ODEsMTEgQEAgaW50IGludGVs
X2NydGNfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcGlwZSBw
aXBlKQogCWZvcl9lYWNoX3Nwcml0ZShkZXZfcHJpdiwgcGlwZSwgc3ByaXRlKSB7CiAJCXN0cnVj
dCBpbnRlbF9wbGFuZSAqcGxhbmU7CiAKLQkJcGxhbmUgPSBpbnRlbF9zcHJpdGVfcGxhbmVfY3Jl
YXRlKGRldl9wcml2LCBwaXBlLCBzcHJpdGUpOworCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSA5KQorCQkJcGxhbmUgPSBza2xfdW5pdmVyc2FsX3BsYW5lX2NyZWF0ZShkZXZfcHJpdiwgcGlw
ZSwKKwkJCQkJCQkgICBQTEFORV9TUFJJVEUwICsgc3ByaXRlKTsKKwkJZWxzZQorCQkJcGxhbmUg
PSBpbnRlbF9zcHJpdGVfcGxhbmVfY3JlYXRlKGRldl9wcml2LCBwaXBlLCBzcHJpdGUpOwogCQlp
ZiAoSVNfRVJSKHBsYW5lKSkgewogCQkJcmV0ID0gUFRSX0VSUihwbGFuZSk7CiAJCQlnb3RvIGZh
aWw7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3Bs
YXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4
IDhjOTlkZjQwNDI1OS4uYTNjNmExYjNlZDc1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAtMTExLDcgKzExMSw2IEBAIHN0YXRpYyB2b2lkIHZs
dl9wcmVwYXJlX3BsbChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCSAgICBjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpOwogc3RhdGljIHZvaWQgY2h2X3ByZXBh
cmVfcGxsKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJICAgIGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZyk7Ci1zdGF0aWMgdm9pZCBza2xfcGZpdF9lbmFibGUo
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOwogc3RhdGljIHZvaWQg
aWxrX3BmaXRfZW5hYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
KTsKIHN0YXRpYyB2b2lkIGludGVsX21vZGVzZXRfc2V0dXBfaHdfc3RhdGUoc3RydWN0IGRybV9k
ZXZpY2UgKmRldiwKIAkJCQkJIHN0cnVjdCBkcm1fbW9kZXNldF9hY3F1aXJlX2N0eCAqY3R4KTsK
QEAgLTEwNzcsMjYgKzEwNzYsNiBAQCBzdGF0aWMgdW5zaWduZWQgaW50IGludGVsX3RpbGVfc2l6
ZShjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJcmV0dXJuIElTX0dF
TihkZXZfcHJpdiwgMikgPyAyMDQ4IDogNDA5NjsKIH0KIAotc3RhdGljIGJvb2wgaXNfY2NzX3Bs
YW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgcGxhbmUpCi17Ci0JaWYg
KCFpc19jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSkKLQkJcmV0dXJuIGZhbHNlOwotCi0JcmV0
dXJuIHBsYW5lID49IGZiLT5mb3JtYXQtPm51bV9wbGFuZXMgLyAyOwotfQotCi1zdGF0aWMgYm9v
bCBpc19nZW4xMl9jY3NfbW9kaWZpZXIodTY0IG1vZGlmaWVyKQotewotCXJldHVybiBtb2RpZmll
ciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1MgfHwKLQkgICAgICAgbW9k
aWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfTUNfQ0NTOwotCi19Ci0KLXN0
YXRpYyBib29sIGlzX2dlbjEyX2Njc19wbGFuZShjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVy
ICpmYiwgaW50IHBsYW5lKQotewotCXJldHVybiBpc19nZW4xMl9jY3NfbW9kaWZpZXIoZmItPm1v
ZGlmaWVyKSAmJiBpc19jY3NfcGxhbmUoZmIsIHBsYW5lKTsKLX0KLQogc3RhdGljIGJvb2wgaXNf
YXV4X3BsYW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgcGxhbmUpCiB7
CiAJaWYgKGlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpKQpAQCAtMTEwNSw3ICsxMDg0LDcg
QEAgc3RhdGljIGJvb2wgaXNfYXV4X3BsYW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIg
KmZiLCBpbnQgcGxhbmUpCiAJcmV0dXJuIHBsYW5lID09IDE7CiB9CiAKLXN0YXRpYyBpbnQgbWFp
bl90b19jY3NfcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBtYWlu
X3BsYW5lKQoraW50IG1haW5fdG9fY2NzX3BsYW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiLCBpbnQgbWFpbl9wbGFuZSkKIHsKIAlkcm1fV0FSTl9PTihmYi0+ZGV2LCAhaXNfY2Nz
X21vZGlmaWVyKGZiLT5tb2RpZmllcikgfHwKIAkJICAgIChtYWluX3BsYW5lICYmIG1haW5fcGxh
bmUgPj0gZmItPmZvcm1hdC0+bnVtX3BsYW5lcyAvIDIpKTsKQEAgLTExMTMsNyArMTA5Miw3IEBA
IHN0YXRpYyBpbnQgbWFpbl90b19jY3NfcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZl
ciAqZmIsIGludCBtYWluX3BsYW5lKQogCXJldHVybiBmYi0+Zm9ybWF0LT5udW1fcGxhbmVzIC8g
MiArIG1haW5fcGxhbmU7CiB9CiAKLXN0YXRpYyBpbnQgY2NzX3RvX21haW5fcGxhbmUoY29uc3Qg
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjY3NfcGxhbmUpCitpbnQgY2NzX3RvX21h
aW5fcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjY3NfcGxhbmUp
CiB7CiAJZHJtX1dBUk5fT04oZmItPmRldiwgIWlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIp
IHx8CiAJCSAgICBjY3NfcGxhbmUgPCBmYi0+Zm9ybWF0LT5udW1fcGxhbmVzIC8gMik7CkBAIC0x
MTQ5LDcgKzExMjgsNyBAQCBzdGF0aWMgYm9vbCBpc19zZW1pcGxhbmFyX3V2X3BsYW5lKGNvbnN0
IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAogCSAgICAgICBjb2xvcl9wbGFuZSA9PSAxOwog
fQogCi1zdGF0aWMgdW5zaWduZWQgaW50Cit1bnNpZ25lZCBpbnQKIGludGVsX3RpbGVfd2lkdGhf
Ynl0ZXMoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFuZSkK
IHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGZiLT5kZXYp
OwpAQCAtMTIwMiw3ICsxMTgxLDcgQEAgaW50ZWxfdGlsZV93aWR0aF9ieXRlcyhjb25zdCBzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNvbG9yX3BsYW5lKQogCX0KIH0KIAotc3RhdGlj
IHVuc2lnbmVkIGludAordW5zaWduZWQgaW50CiBpbnRlbF90aWxlX2hlaWdodChjb25zdCBzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNvbG9yX3BsYW5lKQogewogCWlmIChpc19nZW4x
Ml9jY3NfcGxhbmUoZmIsIGNvbG9yX3BsYW5lKSkKQEAgLTEzMDIsOCArMTI4MSw4IEBAIHN0YXRp
YyB1bnNpZ25lZCBpbnQgaW50ZWxfbGluZWFyX2FsaWdubWVudChjb25zdCBzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByCiAJCXJldHVybiAwOwogfQogCi1zdGF0aWMgdW5zaWduZWQgaW50
IGludGVsX3N1cmZfYWxpZ25tZW50KGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAot
CQkJCQkgaW50IGNvbG9yX3BsYW5lKQordW5zaWduZWQgaW50IGludGVsX3N1cmZfYWxpZ25tZW50
KGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAorCQkJCSAgaW50IGNvbG9yX3BsYW5l
KQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZmItPmRl
dik7CiAKQEAgLTE1NzIsMTAgKzE1NTEsMTAgQEAgc3RhdGljIHUzMiBpbnRlbF9hZGp1c3RfYWxp
Z25lZF9vZmZzZXQoaW50ICp4LCBpbnQgKnksCiAgKiBBZGp1c3QgdGhlIHRpbGUgb2Zmc2V0IGJ5
IG1vdmluZyB0aGUgZGlmZmVyZW5jZSBpbnRvCiAgKiB0aGUgeC95IG9mZnNldHMuCiAgKi8KLXN0
YXRpYyB1MzIgaW50ZWxfcGxhbmVfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KGludCAqeCwgaW50ICp5
LAotCQkJCQkgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqc3RhdGUsCi0JCQkJ
CSAgICAgaW50IGNvbG9yX3BsYW5lLAotCQkJCQkgICAgIHUzMiBvbGRfb2Zmc2V0LCB1MzIgbmV3
X29mZnNldCkKK3UzMiBpbnRlbF9wbGFuZV9hZGp1c3RfYWxpZ25lZF9vZmZzZXQoaW50ICp4LCBp
bnQgKnksCisJCQkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpzdGF0ZSwK
KwkJCQkgICAgICBpbnQgY29sb3JfcGxhbmUsCisJCQkJICAgICAgdTMyIG9sZF9vZmZzZXQsIHUz
MiBuZXdfb2Zmc2V0KQogewogCXJldHVybiBpbnRlbF9hZGp1c3RfYWxpZ25lZF9vZmZzZXQoeCwg
eSwgc3RhdGUtPmh3LmZiLCBjb2xvcl9wbGFuZSwKIAkJCQkJICAgc3RhdGUtPmh3LnJvdGF0aW9u
LApAQCAtMjAwNyw3ICsxOTg2LDcgQEAgc3RhdGljIGJvb2wgaW50ZWxfcGxhbmVfbmVlZHNfcmVt
YXAoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAlyZXR1cm4g
c3RyaWRlID4gbWF4X3N0cmlkZTsKIH0KIAotc3RhdGljIHZvaWQKK3ZvaWQKIGludGVsX2ZiX3Bs
YW5lX2dldF9zdWJzYW1wbGluZyhpbnQgKmhzdWIsIGludCAqdnN1YiwKIAkJCSAgICAgICBjb25z
dCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKIAkJCSAgICAgICBpbnQgY29sb3JfcGxhbmUp
CkBAIC0yNDczLDczICsyNDUyLDYgQEAgc3RhdGljIGludCBpOXh4X2Zvcm1hdF90b19mb3VyY2Mo
aW50IGZvcm1hdCkKIAl9CiB9CiAKLWludCBza2xfZm9ybWF0X3RvX2ZvdXJjYyhpbnQgZm9ybWF0
LCBib29sIHJnYl9vcmRlciwgYm9vbCBhbHBoYSkKLXsKLQlzd2l0Y2ggKGZvcm1hdCkgewotCWNh
c2UgUExBTkVfQ1RMX0ZPUk1BVF9SR0JfNTY1OgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9SR0I1NjU7
Ci0JY2FzZSBQTEFORV9DVExfRk9STUFUX05WMTI6Ci0JCXJldHVybiBEUk1fRk9STUFUX05WMTI7
Ci0JY2FzZSBQTEFORV9DVExfRk9STUFUX1hZVVY6Ci0JCXJldHVybiBEUk1fRk9STUFUX1hZVVY4
ODg4OwotCWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9QMDEwOgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9Q
MDEwOwotCWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9QMDEyOgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9Q
MDEyOwotCWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9QMDE2OgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9Q
MDE2OwotCWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9ZMjEwOgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9Z
MjEwOwotCWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9ZMjEyOgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9Z
MjEyOwotCWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9ZMjE2OgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9Z
MjE2OwotCWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9ZNDEwOgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9Y
VllVMjEwMTAxMDsKLQljYXNlIFBMQU5FX0NUTF9GT1JNQVRfWTQxMjoKLQkJcmV0dXJuIERSTV9G
T1JNQVRfWFZZVTEyXzE2MTYxNjE2OwotCWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9ZNDE2OgotCQly
ZXR1cm4gRFJNX0ZPUk1BVF9YVllVMTYxNjE2MTY7Ci0JZGVmYXVsdDoKLQljYXNlIFBMQU5FX0NU
TF9GT1JNQVRfWFJHQl84ODg4OgotCQlpZiAocmdiX29yZGVyKSB7Ci0JCQlpZiAoYWxwaGEpCi0J
CQkJcmV0dXJuIERSTV9GT1JNQVRfQUJHUjg4ODg7Ci0JCQllbHNlCi0JCQkJcmV0dXJuIERSTV9G
T1JNQVRfWEJHUjg4ODg7Ci0JCX0gZWxzZSB7Ci0JCQlpZiAoYWxwaGEpCi0JCQkJcmV0dXJuIERS
TV9GT1JNQVRfQVJHQjg4ODg7Ci0JCQllbHNlCi0JCQkJcmV0dXJuIERSTV9GT1JNQVRfWFJHQjg4
ODg7Ci0JCX0KLQljYXNlIFBMQU5FX0NUTF9GT1JNQVRfWFJHQl8yMTAxMDEwOgotCQlpZiAocmdi
X29yZGVyKSB7Ci0JCQlpZiAoYWxwaGEpCi0JCQkJcmV0dXJuIERSTV9GT1JNQVRfQUJHUjIxMDEw
MTA7Ci0JCQllbHNlCi0JCQkJcmV0dXJuIERSTV9GT1JNQVRfWEJHUjIxMDEwMTA7Ci0JCX0gZWxz
ZSB7Ci0JCQlpZiAoYWxwaGEpCi0JCQkJcmV0dXJuIERSTV9GT1JNQVRfQVJHQjIxMDEwMTA7Ci0J
CQllbHNlCi0JCQkJcmV0dXJuIERSTV9GT1JNQVRfWFJHQjIxMDEwMTA7Ci0JCX0KLQljYXNlIFBM
QU5FX0NUTF9GT1JNQVRfWFJHQl8xNjE2MTYxNkY6Ci0JCWlmIChyZ2Jfb3JkZXIpIHsKLQkJCWlm
IChhbHBoYSkKLQkJCQlyZXR1cm4gRFJNX0ZPUk1BVF9BQkdSMTYxNjE2MTZGOwotCQkJZWxzZQot
CQkJCXJldHVybiBEUk1fRk9STUFUX1hCR1IxNjE2MTYxNkY7Ci0JCX0gZWxzZSB7Ci0JCQlpZiAo
YWxwaGEpCi0JCQkJcmV0dXJuIERSTV9GT1JNQVRfQVJHQjE2MTYxNjE2RjsKLQkJCWVsc2UKLQkJ
CQlyZXR1cm4gRFJNX0ZPUk1BVF9YUkdCMTYxNjE2MTZGOwotCQl9Ci0JfQotfQotCiBzdGF0aWMg
c3RydWN0IGk5MTVfdm1hICoKIGluaXRpYWxfcGxhbmVfdm1hKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAogCQkgIHN0cnVjdCBpbnRlbF9pbml0aWFsX3BsYW5lX2NvbmZpZyAqcGxhbmVf
Y29uZmlnKQpAQCAtMjg0NSw1MSArMjc1Nyw2IEBAIGludGVsX2ZpbmRfaW5pdGlhbF9wbGFuZV9v
Ymooc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMsCiB9CiAKIAotc3RhdGljIGJvb2wKLXNr
bF9jaGVja19tYWluX2Njc19jb29yZGluYXRlcyhzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlLAotCQkJICAgICAgIGludCBtYWluX3gsIGludCBtYWluX3ksIHUzMiBtYWluX29m
ZnNldCwKLQkJCSAgICAgICBpbnQgY2NzX3BsYW5lKQotewotCWNvbnN0IHN0cnVjdCBkcm1fZnJh
bWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwotCWludCBhdXhfeCA9IHBsYW5lX3N0
YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLng7Ci0JaW50IGF1eF95ID0gcGxhbmVfc3RhdGUt
PmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueTsKLQl1MzIgYXV4X29mZnNldCA9IHBsYW5lX3N0YXRl
LT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLm9mZnNldDsKLQl1MzIgYWxpZ25tZW50ID0gaW50ZWxf
c3VyZl9hbGlnbm1lbnQoZmIsIGNjc19wbGFuZSk7Ci0JaW50IGhzdWI7Ci0JaW50IHZzdWI7Ci0K
LQlpbnRlbF9mYl9wbGFuZV9nZXRfc3Vic2FtcGxpbmcoJmhzdWIsICZ2c3ViLCBmYiwgY2NzX3Bs
YW5lKTsKLQl3aGlsZSAoYXV4X29mZnNldCA+PSBtYWluX29mZnNldCAmJiBhdXhfeSA8PSBtYWlu
X3kpIHsKLQkJaW50IHgsIHk7Ci0KLQkJaWYgKGF1eF94ID09IG1haW5feCAmJiBhdXhfeSA9PSBt
YWluX3kpCi0JCQlicmVhazsKLQotCQlpZiAoYXV4X29mZnNldCA9PSAwKQotCQkJYnJlYWs7Ci0K
LQkJeCA9IGF1eF94IC8gaHN1YjsKLQkJeSA9IGF1eF95IC8gdnN1YjsKLQkJYXV4X29mZnNldCA9
IGludGVsX3BsYW5lX2FkanVzdF9hbGlnbmVkX29mZnNldCgmeCwgJnksCi0JCQkJCQkJICAgICAg
IHBsYW5lX3N0YXRlLAotCQkJCQkJCSAgICAgICBjY3NfcGxhbmUsCi0JCQkJCQkJICAgICAgIGF1
eF9vZmZzZXQsCi0JCQkJCQkJICAgICAgIGF1eF9vZmZzZXQgLQotCQkJCQkJCQlhbGlnbm1lbnQp
OwotCQlhdXhfeCA9IHggKiBoc3ViICsgYXV4X3ggJSBoc3ViOwotCQlhdXhfeSA9IHkgKiB2c3Vi
ICsgYXV4X3kgJSB2c3ViOwotCX0KLQotCWlmIChhdXhfeCAhPSBtYWluX3ggfHwgYXV4X3kgIT0g
bWFpbl95KQotCQlyZXR1cm4gZmFsc2U7Ci0KLQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2Nz
X3BsYW5lXS5vZmZzZXQgPSBhdXhfb2Zmc2V0OwotCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtj
Y3NfcGxhbmVdLnggPSBhdXhfeDsKLQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5l
XS55ID0gYXV4X3k7Ci0KLQlyZXR1cm4gdHJ1ZTsKLX0KLQogdW5zaWduZWQgaW50CiBpbnRlbF9w
bGFuZV9mZW5jZV95X29mZnNldChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5l
X3N0YXRlKQogewpAQCAtMjkwMSwyODUgKzI3NjgsNiBAQCBpbnRlbF9wbGFuZV9mZW5jZV95X29m
ZnNldChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCXJldHVy
biB5OwogfQogCi1zdGF0aWMgaW50IGludGVsX3BsYW5lX21pbl93aWR0aChzdHJ1Y3QgaW50ZWxf
cGxhbmUgKnBsYW5lLAotCQkJCSBjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKLQkJ
CQkgaW50IGNvbG9yX3BsYW5lLAotCQkJCSB1bnNpZ25lZCBpbnQgcm90YXRpb24pCi17Ci0JaWYg
KHBsYW5lLT5taW5fd2lkdGgpCi0JCXJldHVybiBwbGFuZS0+bWluX3dpZHRoKGZiLCBjb2xvcl9w
bGFuZSwgcm90YXRpb24pOwotCWVsc2UKLQkJcmV0dXJuIDE7Ci19Ci0KLXN0YXRpYyBpbnQgaW50
ZWxfcGxhbmVfbWF4X3dpZHRoKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCi0JCQkJIGNvbnN0
IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAotCQkJCSBpbnQgY29sb3JfcGxhbmUsCi0JCQkJ
IHVuc2lnbmVkIGludCByb3RhdGlvbikKLXsKLQlpZiAocGxhbmUtPm1heF93aWR0aCkKLQkJcmV0
dXJuIHBsYW5lLT5tYXhfd2lkdGgoZmIsIGNvbG9yX3BsYW5lLCByb3RhdGlvbik7Ci0JZWxzZQot
CQlyZXR1cm4gSU5UX01BWDsKLX0KLQotc3RhdGljIGludCBpbnRlbF9wbGFuZV9tYXhfaGVpZ2h0
KHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCi0JCQkJICBjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYiwKLQkJCQkgIGludCBjb2xvcl9wbGFuZSwKLQkJCQkgIHVuc2lnbmVkIGludCBy
b3RhdGlvbikKLXsKLQlpZiAocGxhbmUtPm1heF9oZWlnaHQpCi0JCXJldHVybiBwbGFuZS0+bWF4
X2hlaWdodChmYiwgY29sb3JfcGxhbmUsIHJvdGF0aW9uKTsKLQllbHNlCi0JCXJldHVybiBJTlRf
TUFYOwotfQotCi1zdGF0aWMgaW50IHNrbF9jaGVja19tYWluX3N1cmZhY2Uoc3RydWN0IGludGVs
X3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKLXsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5l
ID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOwotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQljb25z
dCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKLQl1bnNp
Z25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247Ci0JaW50IHggPSBw
bGFuZV9zdGF0ZS0+dWFwaS5zcmMueDEgPj4gMTY7Ci0JaW50IHkgPSBwbGFuZV9zdGF0ZS0+dWFw
aS5zcmMueTEgPj4gMTY7Ci0JaW50IHcgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVh
cGkuc3JjKSA+PiAxNjsKLQlpbnQgaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPnVh
cGkuc3JjKSA+PiAxNjsKLQlpbnQgbWluX3dpZHRoID0gaW50ZWxfcGxhbmVfbWluX3dpZHRoKHBs
YW5lLCBmYiwgMCwgcm90YXRpb24pOwotCWludCBtYXhfd2lkdGggPSBpbnRlbF9wbGFuZV9tYXhf
d2lkdGgocGxhbmUsIGZiLCAwLCByb3RhdGlvbik7Ci0JaW50IG1heF9oZWlnaHQgPSBpbnRlbF9w
bGFuZV9tYXhfaGVpZ2h0KHBsYW5lLCBmYiwgMCwgcm90YXRpb24pOwotCWludCBhdXhfcGxhbmUg
PSBpbnRlbF9tYWluX3RvX2F1eF9wbGFuZShmYiwgMCk7Ci0JdTMyIGF1eF9vZmZzZXQgPSBwbGFu
ZV9zdGF0ZS0+Y29sb3JfcGxhbmVbYXV4X3BsYW5lXS5vZmZzZXQ7Ci0JdTMyIGFsaWdubWVudCwg
b2Zmc2V0OwotCi0JaWYgKHcgPiBtYXhfd2lkdGggfHwgdyA8IG1pbl93aWR0aCB8fCBoID4gbWF4
X2hlaWdodCkgewotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKLQkJCSAgICAicmVxdWVz
dGVkIFkvUkdCIHNvdXJjZSBzaXplICVkeCVkIG91dHNpZGUgbGltaXRzIChtaW46ICVkeDEgbWF4
OiAlZHglZClcbiIsCi0JCQkgICAgdywgaCwgbWluX3dpZHRoLCBtYXhfd2lkdGgsIG1heF9oZWln
aHQpOwotCQlyZXR1cm4gLUVJTlZBTDsKLQl9Ci0KLQlpbnRlbF9hZGRfZmJfb2Zmc2V0cygmeCwg
JnksIHBsYW5lX3N0YXRlLCAwKTsKLQlvZmZzZXQgPSBpbnRlbF9wbGFuZV9jb21wdXRlX2FsaWdu
ZWRfb2Zmc2V0KCZ4LCAmeSwgcGxhbmVfc3RhdGUsIDApOwotCWFsaWdubWVudCA9IGludGVsX3N1
cmZfYWxpZ25tZW50KGZiLCAwKTsKLQlpZiAoZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIGFs
aWdubWVudCAmJiAhaXNfcG93ZXJfb2ZfMihhbGlnbm1lbnQpKSkKLQkJcmV0dXJuIC1FSU5WQUw7
Ci0KLQkvKgotCSAqIEFVWCBzdXJmYWNlIG9mZnNldCBpcyBzcGVjaWZpZWQgYXMgdGhlIGRpc3Rh
bmNlIGZyb20gdGhlCi0JICogbWFpbiBzdXJmYWNlIG9mZnNldCwgYW5kIGl0IG11c3QgYmUgbm9u
LW5lZ2F0aXZlLiBNYWtlCi0JICogc3VyZSB0aGF0IGlzIHdoYXQgd2Ugd2lsbCBnZXQuCi0JICov
Ci0JaWYgKGF1eF9wbGFuZSAmJiBvZmZzZXQgPiBhdXhfb2Zmc2V0KQotCQlvZmZzZXQgPSBpbnRl
bF9wbGFuZV9hZGp1c3RfYWxpZ25lZF9vZmZzZXQoJngsICZ5LCBwbGFuZV9zdGF0ZSwgMCwKLQkJ
CQkJCQkgICBvZmZzZXQsIGF1eF9vZmZzZXQgJiB+KGFsaWdubWVudCAtIDEpKTsKLQotCS8qCi0J
ICogV2hlbiB1c2luZyBhbiBYLXRpbGVkIHN1cmZhY2UsIHRoZSBwbGFuZSBibG93cyB1cAotCSAq
IGlmIHRoZSB4IG9mZnNldCArIHdpZHRoIGV4Y2VlZCB0aGUgc3RyaWRlLgotCSAqCi0JICogVE9E
TzogbGluZWFyIGFuZCBZLXRpbGVkIHNlZW0gZmluZSwgWWYgdW50ZXN0ZWQsCi0JICovCi0JaWYg
KGZiLT5tb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRCkgewotCQlpbnQgY3BwID0g
ZmItPmZvcm1hdC0+Y3BwWzBdOwotCi0JCXdoaWxlICgoeCArIHcpICogY3BwID4gcGxhbmVfc3Rh
dGUtPmNvbG9yX3BsYW5lWzBdLnN0cmlkZSkgewotCQkJaWYgKG9mZnNldCA9PSAwKSB7Ci0JCQkJ
ZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCi0JCQkJCSAgICAiVW5hYmxlIHRvIGZpbmQgc3Vp
dGFibGUgZGlzcGxheSBzdXJmYWNlIG9mZnNldCBkdWUgdG8gWC10aWxpbmdcbiIpOwotCQkJCXJl
dHVybiAtRUlOVkFMOwotCQkJfQotCi0JCQlvZmZzZXQgPSBpbnRlbF9wbGFuZV9hZGp1c3RfYWxp
Z25lZF9vZmZzZXQoJngsICZ5LCBwbGFuZV9zdGF0ZSwgMCwKLQkJCQkJCQkJICAgb2Zmc2V0LCBv
ZmZzZXQgLSBhbGlnbm1lbnQpOwotCQl9Ci0JfQotCi0JLyoKLQkgKiBDQ1MgQVVYIHN1cmZhY2Ug
ZG9lc24ndCBoYXZlIGl0cyBvd24geC95IG9mZnNldHMsIHdlIG11c3QgbWFrZSBzdXJlCi0JICog
dGhleSBtYXRjaCB3aXRoIHRoZSBtYWluIHN1cmZhY2UgeC95IG9mZnNldHMuCi0JICovCi0JaWYg
KGlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpKSB7Ci0JCXdoaWxlICghc2tsX2NoZWNrX21h
aW5fY2NzX2Nvb3JkaW5hdGVzKHBsYW5lX3N0YXRlLCB4LCB5LAotCQkJCQkJICAgICAgIG9mZnNl
dCwgYXV4X3BsYW5lKSkgewotCQkJaWYgKG9mZnNldCA9PSAwKQotCQkJCWJyZWFrOwotCi0JCQlv
ZmZzZXQgPSBpbnRlbF9wbGFuZV9hZGp1c3RfYWxpZ25lZF9vZmZzZXQoJngsICZ5LCBwbGFuZV9z
dGF0ZSwgMCwKLQkJCQkJCQkJICAgb2Zmc2V0LCBvZmZzZXQgLSBhbGlnbm1lbnQpOwotCQl9Ci0K
LQkJaWYgKHggIT0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2F1eF9wbGFuZV0ueCB8fAotCQkg
ICAgeSAhPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbYXV4X3BsYW5lXS55KSB7Ci0JCQlkcm1f
ZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKLQkJCQkgICAgIlVuYWJsZSB0byBmaW5kIHN1aXRhYmxl
IGRpc3BsYXkgc3VyZmFjZSBvZmZzZXQgZHVlIHRvIENDU1xuIik7Ci0JCQlyZXR1cm4gLUVJTlZB
TDsKLQkJfQotCX0KLQotCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS5vZmZzZXQgPSBvZmZz
ZXQ7Ci0JcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLnggPSB4OwotCXBsYW5lX3N0YXRlLT5j
b2xvcl9wbGFuZVswXS55ID0geTsKLQotCS8qCi0JICogUHV0IHRoZSBmaW5hbCBjb29yZGluYXRl
cyBiYWNrIHNvIHRoYXQgdGhlIHNyYwotCSAqIGNvb3JkaW5hdGUgY2hlY2tzIHdpbGwgc2VlIHRo
ZSByaWdodCB2YWx1ZXMuCi0JICovCi0JZHJtX3JlY3RfdHJhbnNsYXRlX3RvKCZwbGFuZV9zdGF0
ZS0+dWFwaS5zcmMsCi0JCQkgICAgICB4IDw8IDE2LCB5IDw8IDE2KTsKLQotCXJldHVybiAwOwot
fQotCi1zdGF0aWMgaW50IHNrbF9jaGVja19udjEyX2F1eF9zdXJmYWNlKHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCi17Ci0Jc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9
IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQljb25zdCBzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKLQl1bnNpZ25lZCBp
bnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247Ci0JaW50IHV2X3BsYW5lID0g
MTsKLQlpbnQgbWF4X3dpZHRoID0gaW50ZWxfcGxhbmVfbWF4X3dpZHRoKHBsYW5lLCBmYiwgdXZf
cGxhbmUsIHJvdGF0aW9uKTsKLQlpbnQgbWF4X2hlaWdodCA9IGludGVsX3BsYW5lX21heF9oZWln
aHQocGxhbmUsIGZiLCB1dl9wbGFuZSwgcm90YXRpb24pOwotCWludCB4ID0gcGxhbmVfc3RhdGUt
PnVhcGkuc3JjLngxID4+IDE3OwotCWludCB5ID0gcGxhbmVfc3RhdGUtPnVhcGkuc3JjLnkxID4+
IDE3OwotCWludCB3ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4g
MTc7Ci0JaW50IGggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4g
MTc7Ci0JdTMyIG9mZnNldDsKLQotCS8qIEZJWE1FIG5vdCBxdWl0ZSBzdXJlIGhvdy9pZiB0aGVz
ZSBhcHBseSB0byB0aGUgY2hyb21hIHBsYW5lICovCi0JaWYgKHcgPiBtYXhfd2lkdGggfHwgaCA+
IG1heF9oZWlnaHQpIHsKLQkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKLQkJCSAgICAiQ2JDciBz
b3VyY2Ugc2l6ZSAlZHglZCB0b28gYmlnIChsaW1pdCAlZHglZClcbiIsCi0JCQkgICAgdywgaCwg
bWF4X3dpZHRoLCBtYXhfaGVpZ2h0KTsKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQotCi0JaW50ZWxf
YWRkX2ZiX29mZnNldHMoJngsICZ5LCBwbGFuZV9zdGF0ZSwgdXZfcGxhbmUpOwotCW9mZnNldCA9
IGludGVsX3BsYW5lX2NvbXB1dGVfYWxpZ25lZF9vZmZzZXQoJngsICZ5LAotCQkJCQkJICAgIHBs
YW5lX3N0YXRlLCB1dl9wbGFuZSk7Ci0KLQlpZiAoaXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmll
cikpIHsKLQkJaW50IGNjc19wbGFuZSA9IG1haW5fdG9fY2NzX3BsYW5lKGZiLCB1dl9wbGFuZSk7
Ci0JCXUzMiBhdXhfb2Zmc2V0ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0u
b2Zmc2V0OwotCQl1MzIgYWxpZ25tZW50ID0gaW50ZWxfc3VyZl9hbGlnbm1lbnQoZmIsIHV2X3Bs
YW5lKTsKLQotCQlpZiAob2Zmc2V0ID4gYXV4X29mZnNldCkKLQkJCW9mZnNldCA9IGludGVsX3Bs
YW5lX2FkanVzdF9hbGlnbmVkX29mZnNldCgmeCwgJnksCi0JCQkJCQkJCSAgIHBsYW5lX3N0YXRl
LAotCQkJCQkJCQkgICB1dl9wbGFuZSwKLQkJCQkJCQkJICAgb2Zmc2V0LAotCQkJCQkJCQkgICBh
dXhfb2Zmc2V0ICYgfihhbGlnbm1lbnQgLSAxKSk7Ci0KLQkJd2hpbGUgKCFza2xfY2hlY2tfbWFp
bl9jY3NfY29vcmRpbmF0ZXMocGxhbmVfc3RhdGUsIHgsIHksCi0JCQkJCQkgICAgICAgb2Zmc2V0
LCBjY3NfcGxhbmUpKSB7Ci0JCQlpZiAob2Zmc2V0ID09IDApCi0JCQkJYnJlYWs7Ci0KLQkJCW9m
ZnNldCA9IGludGVsX3BsYW5lX2FkanVzdF9hbGlnbmVkX29mZnNldCgmeCwgJnksCi0JCQkJCQkJ
CSAgIHBsYW5lX3N0YXRlLAotCQkJCQkJCQkgICB1dl9wbGFuZSwKLQkJCQkJCQkJICAgb2Zmc2V0
LCBvZmZzZXQgLSBhbGlnbm1lbnQpOwotCQl9Ci0KLQkJaWYgKHggIT0gcGxhbmVfc3RhdGUtPmNv
bG9yX3BsYW5lW2Njc19wbGFuZV0ueCB8fAotCQkgICAgeSAhPSBwbGFuZV9zdGF0ZS0+Y29sb3Jf
cGxhbmVbY2NzX3BsYW5lXS55KSB7Ci0JCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAotCQkJCSAg
ICAiVW5hYmxlIHRvIGZpbmQgc3VpdGFibGUgZGlzcGxheSBzdXJmYWNlIG9mZnNldCBkdWUgdG8g
Q0NTXG4iKTsKLQkJCXJldHVybiAtRUlOVkFMOwotCQl9Ci0JfQotCi0JcGxhbmVfc3RhdGUtPmNv
bG9yX3BsYW5lW3V2X3BsYW5lXS5vZmZzZXQgPSBvZmZzZXQ7Ci0JcGxhbmVfc3RhdGUtPmNvbG9y
X3BsYW5lW3V2X3BsYW5lXS54ID0geDsKLQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbdXZfcGxh
bmVdLnkgPSB5OwotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQgc2tsX2NoZWNrX2Njc19h
dXhfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQotewotCWNv
bnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwotCWlu
dCBzcmNfeCA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy54MSA+PiAxNjsKLQlpbnQgc3JjX3kgPSBw
bGFuZV9zdGF0ZS0+dWFwaS5zcmMueTEgPj4gMTY7Ci0JdTMyIG9mZnNldDsKLQlpbnQgY2NzX3Bs
YW5lOwotCi0JZm9yIChjY3NfcGxhbmUgPSAwOyBjY3NfcGxhbmUgPCBmYi0+Zm9ybWF0LT5udW1f
cGxhbmVzOyBjY3NfcGxhbmUrKykgewotCQlpbnQgbWFpbl9oc3ViLCBtYWluX3ZzdWI7Ci0JCWlu
dCBoc3ViLCB2c3ViOwotCQlpbnQgeCwgeTsKLQotCQlpZiAoIWlzX2Njc19wbGFuZShmYiwgY2Nz
X3BsYW5lKSkKLQkJCWNvbnRpbnVlOwotCi0JCWludGVsX2ZiX3BsYW5lX2dldF9zdWJzYW1wbGlu
ZygmbWFpbl9oc3ViLCAmbWFpbl92c3ViLCBmYiwKLQkJCQkJICAgICAgIGNjc190b19tYWluX3Bs
YW5lKGZiLCBjY3NfcGxhbmUpKTsKLQkJaW50ZWxfZmJfcGxhbmVfZ2V0X3N1YnNhbXBsaW5nKCZo
c3ViLCAmdnN1YiwgZmIsIGNjc19wbGFuZSk7Ci0KLQkJaHN1YiAqPSBtYWluX2hzdWI7Ci0JCXZz
dWIgKj0gbWFpbl92c3ViOwotCQl4ID0gc3JjX3ggLyBoc3ViOwotCQl5ID0gc3JjX3kgLyB2c3Vi
OwotCi0JCWludGVsX2FkZF9mYl9vZmZzZXRzKCZ4LCAmeSwgcGxhbmVfc3RhdGUsIGNjc19wbGFu
ZSk7Ci0KLQkJb2Zmc2V0ID0gaW50ZWxfcGxhbmVfY29tcHV0ZV9hbGlnbmVkX29mZnNldCgmeCwg
JnksCi0JCQkJCQkJICAgIHBsYW5lX3N0YXRlLAotCQkJCQkJCSAgICBjY3NfcGxhbmUpOwotCi0J
CXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLm9mZnNldCA9IG9mZnNldDsKLQkJ
cGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueCA9ICh4ICogaHN1YiArCi0JCQkJ
CQkJIHNyY194ICUgaHN1YikgLwotCQkJCQkJCW1haW5faHN1YjsKLQkJcGxhbmVfc3RhdGUtPmNv
bG9yX3BsYW5lW2Njc19wbGFuZV0ueSA9ICh5ICogdnN1YiArCi0JCQkJCQkJIHNyY195ICUgdnN1
YikgLwotCQkJCQkJCW1haW5fdnN1YjsKLQl9Ci0KLQlyZXR1cm4gMDsKLX0KLQotaW50IHNrbF9j
aGVja19wbGFuZV9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUp
Ci17Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcu
ZmI7Ci0JaW50IHJldCwgaTsKLQotCXJldCA9IGludGVsX3BsYW5lX2NvbXB1dGVfZ3R0KHBsYW5l
X3N0YXRlKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCi0JaWYgKCFwbGFuZV9zdGF0ZS0+
dWFwaS52aXNpYmxlKQotCQlyZXR1cm4gMDsKLQotCS8qCi0JICogSGFuZGxlIHRoZSBBVVggc3Vy
ZmFjZSBmaXJzdCBzaW5jZSB0aGUgbWFpbiBzdXJmYWNlIHNldHVwIGRlcGVuZHMgb24KLQkgKiBp
dC4KLQkgKi8KLQlpZiAoaXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikpIHsKLQkJcmV0ID0g
c2tsX2NoZWNrX2Njc19hdXhfc3VyZmFjZShwbGFuZV9zdGF0ZSk7Ci0JCWlmIChyZXQpCi0JCQly
ZXR1cm4gcmV0OwotCX0KLQotCWlmIChpbnRlbF9mb3JtYXRfaW5mb19pc195dXZfc2VtaXBsYW5h
cihmYi0+Zm9ybWF0LAotCQkJCQkJZmItPm1vZGlmaWVyKSkgewotCQlyZXQgPSBza2xfY2hlY2tf
bnYxMl9hdXhfc3VyZmFjZShwbGFuZV9zdGF0ZSk7Ci0JCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0
OwotCX0KLQotCWZvciAoaSA9IGZiLT5mb3JtYXQtPm51bV9wbGFuZXM7IGkgPCBBUlJBWV9TSVpF
KHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZSk7IGkrKykgewotCQlwbGFuZV9zdGF0ZS0+Y29sb3Jf
cGxhbmVbaV0ub2Zmc2V0ID0gMDsKLQkJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2ldLnggPSAw
OwotCQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbaV0ueSA9IDA7Ci0JfQotCi0JcmV0ID0gc2ts
X2NoZWNrX21haW5fc3VyZmFjZShwbGFuZV9zdGF0ZSk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJl
dDsKLQotCXJldHVybiAwOwotfQotCiBpbnQgaTl4eF9jaGVja19wbGFuZV9zdXJmYWNlKHN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0KQEAgLTMyMTIsMzY1ICsyODAwLDMyIEBAIGludCBpOXh4X2NoZWNr
X3BsYW5lX3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAll
bHNlCiAJCW9mZnNldCA9IDA7CiAKLQkvKgotCSAqIFB1dCB0aGUgZmluYWwgY29vcmRpbmF0ZXMg
YmFjayBzbyB0aGF0IHRoZSBzcmMKLQkgKiBjb29yZGluYXRlIGNoZWNrcyB3aWxsIHNlZSB0aGUg
cmlnaHQgdmFsdWVzLgotCSAqLwotCWRybV9yZWN0X3RyYW5zbGF0ZV90bygmcGxhbmVfc3RhdGUt
PnVhcGkuc3JjLAotCQkJICAgICAgc3JjX3ggPDwgMTYsIHNyY195IDw8IDE2KTsKLQotCS8qIEhT
Vy9CRFcgZG8gdGhpcyBhdXRvbWFnaWNhbGx5IGluIGhhcmR3YXJlICovCi0JaWYgKCFJU19IQVNX
RUxMKGRldl9wcml2KSAmJiAhSVNfQlJPQURXRUxMKGRldl9wcml2KSkgewotCQl1bnNpZ25lZCBp
bnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247Ci0JCWludCBzcmNfdyA9IGRy
bV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OwotCQlpbnQgc3JjX2gg
PSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7Ci0KLQkJaWYg
KHJvdGF0aW9uICYgRFJNX01PREVfUk9UQVRFXzE4MCkgewotCQkJc3JjX3ggKz0gc3JjX3cgLSAx
OwotCQkJc3JjX3kgKz0gc3JjX2ggLSAxOwotCQl9IGVsc2UgaWYgKHJvdGF0aW9uICYgRFJNX01P
REVfUkVGTEVDVF9YKSB7Ci0JCQlzcmNfeCArPSBzcmNfdyAtIDE7Ci0JCX0KLQl9Ci0KLQlwbGFu
ZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ub2Zmc2V0ID0gb2Zmc2V0OwotCXBsYW5lX3N0YXRlLT5j
b2xvcl9wbGFuZVswXS54ID0gc3JjX3g7Ci0JcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLnkg
PSBzcmNfeTsKLQotCXJldHVybiAwOwotfQotCi1zdGF0aWMgdm9pZCBza2xfZGV0YWNoX3NjYWxl
cihzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YywgaW50IGlkKQotewotCXN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYgPSBpbnRlbF9jcnRjLT5iYXNlLmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7Ci0JdW5zaWduZWQgbG9uZyBpcnFmbGFnczsK
LQotCXNwaW5fbG9ja19pcnFzYXZlKCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsK
LQotCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBTS0xfUFNfQ1RSTChpbnRlbF9jcnRjLT5w
aXBlLCBpZCksIDApOwotCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBTS0xfUFNfV0lOX1BP
UyhpbnRlbF9jcnRjLT5waXBlLCBpZCksIDApOwotCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2
LCBTS0xfUFNfV0lOX1NaKGludGVsX2NydGMtPnBpcGUsIGlkKSwgMCk7Ci0KLQlzcGluX3VubG9j
a19pcnFyZXN0b3JlKCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsKLX0KLQotLyoK
LSAqIFRoaXMgZnVuY3Rpb24gZGV0YWNoZXMgKGFrYS4gdW5iaW5kcykgdW51c2VkIHNjYWxlcnMg
aW4gaGFyZHdhcmUKLSAqLwotc3RhdGljIHZvaWQgc2tsX2RldGFjaF9zY2FsZXJzKGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQotewotCXN0cnVjdCBpbnRlbF9jcnRj
ICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwotCWNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3NjYWxlcl9zdGF0ZSAqc2NhbGVyX3N0YXRlID0KLQkJJmNy
dGNfc3RhdGUtPnNjYWxlcl9zdGF0ZTsKLQlpbnQgaTsKLQotCS8qIGxvb3AgdGhyb3VnaCBhbmQg
ZGlzYWJsZSBzY2FsZXJzIHRoYXQgYXJlbid0IGluIHVzZSAqLwotCWZvciAoaSA9IDA7IGkgPCBp
bnRlbF9jcnRjLT5udW1fc2NhbGVyczsgaSsrKSB7Ci0JCWlmICghc2NhbGVyX3N0YXRlLT5zY2Fs
ZXJzW2ldLmluX3VzZSkKLQkJCXNrbF9kZXRhY2hfc2NhbGVyKGludGVsX2NydGMsIGkpOwotCX0K
LX0KLQotc3RhdGljIHVuc2lnbmVkIGludCBza2xfcGxhbmVfc3RyaWRlX211bHQoY29uc3Qgc3Ry
dWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCi0JCQkJCSAgaW50IGNvbG9yX3BsYW5lLCB1bnNpZ25l
ZCBpbnQgcm90YXRpb24pCi17Ci0JLyoKLQkgKiBUaGUgc3RyaWRlIGlzIGVpdGhlciBleHByZXNz
ZWQgYXMgYSBtdWx0aXBsZSBvZiA2NCBieXRlcyBjaHVua3MgZm9yCi0JICogbGluZWFyIGJ1ZmZl
cnMgb3IgaW4gbnVtYmVyIG9mIHRpbGVzIGZvciB0aWxlZCBidWZmZXJzLgotCSAqLwotCWlmIChp
c19zdXJmYWNlX2xpbmVhcihmYiwgY29sb3JfcGxhbmUpKQotCQlyZXR1cm4gNjQ7Ci0JZWxzZSBp
ZiAoZHJtX3JvdGF0aW9uXzkwX29yXzI3MChyb3RhdGlvbikpCi0JCXJldHVybiBpbnRlbF90aWxl
X2hlaWdodChmYiwgY29sb3JfcGxhbmUpOwotCWVsc2UKLQkJcmV0dXJuIGludGVsX3RpbGVfd2lk
dGhfYnl0ZXMoZmIsIGNvbG9yX3BsYW5lKTsKLX0KLQotdTMyIHNrbF9wbGFuZV9zdHJpZGUoY29u
c3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKLQkJICAgICBpbnQgY29s
b3JfcGxhbmUpCi17Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9z
dGF0ZS0+aHcuZmI7Ci0JdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJv
dGF0aW9uOwotCXUzMiBzdHJpZGUgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY29sb3JfcGxh
bmVdLnN0cmlkZTsKLQotCWlmIChjb2xvcl9wbGFuZSA+PSBmYi0+Zm9ybWF0LT5udW1fcGxhbmVz
KQotCQlyZXR1cm4gMDsKLQotCXJldHVybiBzdHJpZGUgLyBza2xfcGxhbmVfc3RyaWRlX211bHQo
ZmIsIGNvbG9yX3BsYW5lLCByb3RhdGlvbik7Ci19Ci0KLXN0YXRpYyB1MzIgc2tsX3BsYW5lX2N0
bF9mb3JtYXQodTMyIHBpeGVsX2Zvcm1hdCkKLXsKLQlzd2l0Y2ggKHBpeGVsX2Zvcm1hdCkgewot
CWNhc2UgRFJNX0ZPUk1BVF9DODoKLQkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfSU5ERVhFRDsK
LQljYXNlIERSTV9GT1JNQVRfUkdCNTY1OgotCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9SR0Jf
NTY1OwotCWNhc2UgRFJNX0ZPUk1BVF9YQkdSODg4ODoKLQljYXNlIERSTV9GT1JNQVRfQUJHUjg4
ODg6Ci0JCXJldHVybiBQTEFORV9DVExfRk9STUFUX1hSR0JfODg4OCB8IFBMQU5FX0NUTF9PUkRF
Ul9SR0JYOwotCWNhc2UgRFJNX0ZPUk1BVF9YUkdCODg4ODoKLQljYXNlIERSTV9GT1JNQVRfQVJH
Qjg4ODg6Ci0JCXJldHVybiBQTEFORV9DVExfRk9STUFUX1hSR0JfODg4ODsKLQljYXNlIERSTV9G
T1JNQVRfWEJHUjIxMDEwMTA6Ci0JY2FzZSBEUk1fRk9STUFUX0FCR1IyMTAxMDEwOgotCQlyZXR1
cm4gUExBTkVfQ1RMX0ZPUk1BVF9YUkdCXzIxMDEwMTAgfCBQTEFORV9DVExfT1JERVJfUkdCWDsK
LQljYXNlIERSTV9GT1JNQVRfWFJHQjIxMDEwMTA6Ci0JY2FzZSBEUk1fRk9STUFUX0FSR0IyMTAx
MDEwOgotCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9YUkdCXzIxMDEwMTA7Ci0JY2FzZSBEUk1f
Rk9STUFUX1hCR1IxNjE2MTYxNkY6Ci0JY2FzZSBEUk1fRk9STUFUX0FCR1IxNjE2MTYxNkY6Ci0J
CXJldHVybiBQTEFORV9DVExfRk9STUFUX1hSR0JfMTYxNjE2MTZGIHwgUExBTkVfQ1RMX09SREVS
X1JHQlg7Ci0JY2FzZSBEUk1fRk9STUFUX1hSR0IxNjE2MTYxNkY6Ci0JY2FzZSBEUk1fRk9STUFU
X0FSR0IxNjE2MTYxNkY6Ci0JCXJldHVybiBQTEFORV9DVExfRk9STUFUX1hSR0JfMTYxNjE2MTZG
OwotCWNhc2UgRFJNX0ZPUk1BVF9YWVVWODg4ODoKLQkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRf
WFlVVjsKLQljYXNlIERSTV9GT1JNQVRfWVVZVjoKLQkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRf
WVVWNDIyIHwgUExBTkVfQ1RMX1lVVjQyMl9ZVVlWOwotCWNhc2UgRFJNX0ZPUk1BVF9ZVllVOgot
CQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9ZVVY0MjIgfCBQTEFORV9DVExfWVVWNDIyX1lWWVU7
Ci0JY2FzZSBEUk1fRk9STUFUX1VZVlk6Ci0JCXJldHVybiBQTEFORV9DVExfRk9STUFUX1lVVjQy
MiB8IFBMQU5FX0NUTF9ZVVY0MjJfVVlWWTsKLQljYXNlIERSTV9GT1JNQVRfVllVWToKLQkJcmV0
dXJuIFBMQU5FX0NUTF9GT1JNQVRfWVVWNDIyIHwgUExBTkVfQ1RMX1lVVjQyMl9WWVVZOwotCWNh
c2UgRFJNX0ZPUk1BVF9OVjEyOgotCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9OVjEyOwotCWNh
c2UgRFJNX0ZPUk1BVF9QMDEwOgotCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9QMDEwOwotCWNh
c2UgRFJNX0ZPUk1BVF9QMDEyOgotCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9QMDEyOwotCWNh
c2UgRFJNX0ZPUk1BVF9QMDE2OgotCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9QMDE2OwotCWNh
c2UgRFJNX0ZPUk1BVF9ZMjEwOgotCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9ZMjEwOwotCWNh
c2UgRFJNX0ZPUk1BVF9ZMjEyOgotCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9ZMjEyOwotCWNh
c2UgRFJNX0ZPUk1BVF9ZMjE2OgotCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9ZMjE2OwotCWNh
c2UgRFJNX0ZPUk1BVF9YVllVMjEwMTAxMDoKLQkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWTQx
MDsKLQljYXNlIERSTV9GT1JNQVRfWFZZVTEyXzE2MTYxNjE2OgotCQlyZXR1cm4gUExBTkVfQ1RM
X0ZPUk1BVF9ZNDEyOwotCWNhc2UgRFJNX0ZPUk1BVF9YVllVMTYxNjE2MTY6Ci0JCXJldHVybiBQ
TEFORV9DVExfRk9STUFUX1k0MTY7Ci0JZGVmYXVsdDoKLQkJTUlTU0lOR19DQVNFKHBpeGVsX2Zv
cm1hdCk7Ci0JfQotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyB1MzIgc2tsX3BsYW5lX2N0bF9h
bHBoYShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQotewotCWlm
ICghcGxhbmVfc3RhdGUtPmh3LmZiLT5mb3JtYXQtPmhhc19hbHBoYSkKLQkJcmV0dXJuIFBMQU5F
X0NUTF9BTFBIQV9ESVNBQkxFOwotCi0Jc3dpdGNoIChwbGFuZV9zdGF0ZS0+aHcucGl4ZWxfYmxl
bmRfbW9kZSkgewotCWNhc2UgRFJNX01PREVfQkxFTkRfUElYRUxfTk9ORToKLQkJcmV0dXJuIFBM
QU5FX0NUTF9BTFBIQV9ESVNBQkxFOwotCWNhc2UgRFJNX01PREVfQkxFTkRfUFJFTVVMVEk6Ci0J
CXJldHVybiBQTEFORV9DVExfQUxQSEFfU1dfUFJFTVVMVElQTFk7Ci0JY2FzZSBEUk1fTU9ERV9C
TEVORF9DT1ZFUkFHRToKLQkJcmV0dXJuIFBMQU5FX0NUTF9BTFBIQV9IV19QUkVNVUxUSVBMWTsK
LQlkZWZhdWx0OgotCQlNSVNTSU5HX0NBU0UocGxhbmVfc3RhdGUtPmh3LnBpeGVsX2JsZW5kX21v
ZGUpOwotCQlyZXR1cm4gUExBTkVfQ1RMX0FMUEhBX0RJU0FCTEU7Ci0JfQotfQotCi1zdGF0aWMg
dTMyIGdsa19wbGFuZV9jb2xvcl9jdGxfYWxwaGEoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0
YXRlICpwbGFuZV9zdGF0ZSkKLXsKLQlpZiAoIXBsYW5lX3N0YXRlLT5ody5mYi0+Zm9ybWF0LT5o
YXNfYWxwaGEpCi0JCXJldHVybiBQTEFORV9DT0xPUl9BTFBIQV9ESVNBQkxFOwotCi0Jc3dpdGNo
IChwbGFuZV9zdGF0ZS0+aHcucGl4ZWxfYmxlbmRfbW9kZSkgewotCWNhc2UgRFJNX01PREVfQkxF
TkRfUElYRUxfTk9ORToKLQkJcmV0dXJuIFBMQU5FX0NPTE9SX0FMUEhBX0RJU0FCTEU7Ci0JY2Fz
ZSBEUk1fTU9ERV9CTEVORF9QUkVNVUxUSToKLQkJcmV0dXJuIFBMQU5FX0NPTE9SX0FMUEhBX1NX
X1BSRU1VTFRJUExZOwotCWNhc2UgRFJNX01PREVfQkxFTkRfQ09WRVJBR0U6Ci0JCXJldHVybiBQ
TEFORV9DT0xPUl9BTFBIQV9IV19QUkVNVUxUSVBMWTsKLQlkZWZhdWx0OgotCQlNSVNTSU5HX0NB
U0UocGxhbmVfc3RhdGUtPmh3LnBpeGVsX2JsZW5kX21vZGUpOwotCQlyZXR1cm4gUExBTkVfQ09M
T1JfQUxQSEFfRElTQUJMRTsKLQl9Ci19Ci0KLXN0YXRpYyB1MzIgc2tsX3BsYW5lX2N0bF90aWxp
bmcodTY0IGZiX21vZGlmaWVyKQotewotCXN3aXRjaCAoZmJfbW9kaWZpZXIpIHsKLQljYXNlIERS
TV9GT1JNQVRfTU9EX0xJTkVBUjoKLQkJYnJlYWs7Ci0JY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWF9U
SUxFRDoKLQkJcmV0dXJuIFBMQU5FX0NUTF9USUxFRF9YOwotCWNhc2UgSTkxNV9GT1JNQVRfTU9E
X1lfVElMRUQ6Ci0JCXJldHVybiBQTEFORV9DVExfVElMRURfWTsKLQljYXNlIEk5MTVfRk9STUFU
X01PRF9ZX1RJTEVEX0NDUzoKLQkJcmV0dXJuIFBMQU5FX0NUTF9USUxFRF9ZIHwgUExBTkVfQ1RM
X1JFTkRFUl9ERUNPTVBSRVNTSU9OX0VOQUJMRTsKLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJ
TEVEX0dFTjEyX1JDX0NDUzoKLQkJcmV0dXJuIFBMQU5FX0NUTF9USUxFRF9ZIHwKLQkJICAgICAg
IFBMQU5FX0NUTF9SRU5ERVJfREVDT01QUkVTU0lPTl9FTkFCTEUgfAotCQkgICAgICAgUExBTkVf
Q1RMX0NMRUFSX0NPTE9SX0RJU0FCTEU7Ci0JY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9H
RU4xMl9NQ19DQ1M6Ci0JCXJldHVybiBQTEFORV9DVExfVElMRURfWSB8IFBMQU5FX0NUTF9NRURJ
QV9ERUNPTVBSRVNTSU9OX0VOQUJMRTsKLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRDoK
LQkJcmV0dXJuIFBMQU5FX0NUTF9USUxFRF9ZRjsKLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZZl9U
SUxFRF9DQ1M6Ci0JCXJldHVybiBQTEFORV9DVExfVElMRURfWUYgfCBQTEFORV9DVExfUkVOREVS
X0RFQ09NUFJFU1NJT05fRU5BQkxFOwotCWRlZmF1bHQ6Ci0JCU1JU1NJTkdfQ0FTRShmYl9tb2Rp
Zmllcik7Ci0JfQotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyB1MzIgc2tsX3BsYW5lX2N0bF9y
b3RhdGUodW5zaWduZWQgaW50IHJvdGF0ZSkKLXsKLQlzd2l0Y2ggKHJvdGF0ZSkgewotCWNhc2Ug
RFJNX01PREVfUk9UQVRFXzA6Ci0JCWJyZWFrOwotCS8qCi0JICogRFJNX01PREVfUk9UQVRFXyBp
cyBjb3VudGVyIGNsb2Nrd2lzZSB0byBzdGF5IGNvbXBhdGlibGUgd2l0aCBYcmFuZHIKLQkgKiB3
aGlsZSBpOTE1IEhXIHJvdGF0aW9uIGlzIGNsb2Nrd2lzZSwgdGhhdHMgd2h5IHRoaXMgc3dhcHBp
bmcuCi0JICovCi0JY2FzZSBEUk1fTU9ERV9ST1RBVEVfOTA6Ci0JCXJldHVybiBQTEFORV9DVExf
Uk9UQVRFXzI3MDsKLQljYXNlIERSTV9NT0RFX1JPVEFURV8xODA6Ci0JCXJldHVybiBQTEFORV9D
VExfUk9UQVRFXzE4MDsKLQljYXNlIERSTV9NT0RFX1JPVEFURV8yNzA6Ci0JCXJldHVybiBQTEFO
RV9DVExfUk9UQVRFXzkwOwotCWRlZmF1bHQ6Ci0JCU1JU1NJTkdfQ0FTRShyb3RhdGUpOwotCX0K
LQotCXJldHVybiAwOwotfQotCi1zdGF0aWMgdTMyIGNubF9wbGFuZV9jdGxfZmxpcCh1bnNpZ25l
ZCBpbnQgcmVmbGVjdCkKLXsKLQlzd2l0Y2ggKHJlZmxlY3QpIHsKLQljYXNlIDA6Ci0JCWJyZWFr
OwotCWNhc2UgRFJNX01PREVfUkVGTEVDVF9YOgotCQlyZXR1cm4gUExBTkVfQ1RMX0ZMSVBfSE9S
SVpPTlRBTDsKLQljYXNlIERSTV9NT0RFX1JFRkxFQ1RfWToKLQlkZWZhdWx0OgotCQlNSVNTSU5H
X0NBU0UocmVmbGVjdCk7Ci0JfQotCi0JcmV0dXJuIDA7Ci19Ci0KLXUzMiBza2xfcGxhbmVfY3Rs
X2NydGMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCi17Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBp
LmNydGMtPmRldik7Ci0JdTMyIHBsYW5lX2N0bCA9IDA7Ci0KLQlpZiAoY3J0Y19zdGF0ZS0+dWFw
aS5hc3luY19mbGlwKQotCQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RMX0FTWU5DX0ZMSVA7Ci0KLQlp
ZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkK
LQkJcmV0dXJuIHBsYW5lX2N0bDsKLQotCWlmIChjcnRjX3N0YXRlLT5nYW1tYV9lbmFibGUpCi0J
CXBsYW5lX2N0bCB8PSBQTEFORV9DVExfUElQRV9HQU1NQV9FTkFCTEU7Ci0KLQlpZiAoY3J0Y19z
dGF0ZS0+Y3NjX2VuYWJsZSkKLQkJcGxhbmVfY3RsIHw9IFBMQU5FX0NUTF9QSVBFX0NTQ19FTkFC
TEU7Ci0KLQlyZXR1cm4gcGxhbmVfY3RsOwotfQotCi11MzIgc2tsX3BsYW5lX2N0bChjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJICBjb25zdCBzdHJ1Y3QgaW50
ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9Ci0JCXRvX2k5MTUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUtPmRldik7Ci0J
Y29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7Ci0J
dW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwotCWNvbnN0
IHN0cnVjdCBkcm1faW50ZWxfc3ByaXRlX2NvbG9ya2V5ICprZXkgPSAmcGxhbmVfc3RhdGUtPmNr
ZXk7Ci0JdTMyIHBsYW5lX2N0bDsKLQotCXBsYW5lX2N0bCA9IFBMQU5FX0NUTF9FTkFCTEU7Ci0K
LQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDEwICYmICFJU19HRU1JTklMQUtFKGRldl9wcml2
KSkgewotCQlwbGFuZV9jdGwgfD0gc2tsX3BsYW5lX2N0bF9hbHBoYShwbGFuZV9zdGF0ZSk7Ci0J
CXBsYW5lX2N0bCB8PSBQTEFORV9DVExfUExBTkVfR0FNTUFfRElTQUJMRTsKLQotCQlpZiAocGxh
bmVfc3RhdGUtPmh3LmNvbG9yX2VuY29kaW5nID09IERSTV9DT0xPUl9ZQ0JDUl9CVDcwOSkKLQkJ
CXBsYW5lX2N0bCB8PSBQTEFORV9DVExfWVVWX1RPX1JHQl9DU0NfRk9STUFUX0JUNzA5OwotCi0J
CWlmIChwbGFuZV9zdGF0ZS0+aHcuY29sb3JfcmFuZ2UgPT0gRFJNX0NPTE9SX1lDQkNSX0ZVTExf
UkFOR0UpCi0JCQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RMX1lVVl9SQU5HRV9DT1JSRUNUSU9OX0RJ
U0FCTEU7Ci0JfQotCi0JcGxhbmVfY3RsIHw9IHNrbF9wbGFuZV9jdGxfZm9ybWF0KGZiLT5mb3Jt
YXQtPmZvcm1hdCk7Ci0JcGxhbmVfY3RsIHw9IHNrbF9wbGFuZV9jdGxfdGlsaW5nKGZiLT5tb2Rp
Zmllcik7Ci0JcGxhbmVfY3RsIHw9IHNrbF9wbGFuZV9jdGxfcm90YXRlKHJvdGF0aW9uICYgRFJN
X01PREVfUk9UQVRFX01BU0spOwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTApCi0J
CXBsYW5lX2N0bCB8PSBjbmxfcGxhbmVfY3RsX2ZsaXAocm90YXRpb24gJgotCQkJCQkJRFJNX01P
REVfUkVGTEVDVF9NQVNLKTsKLQotCWlmIChrZXktPmZsYWdzICYgSTkxNV9TRVRfQ09MT1JLRVlf
REVTVElOQVRJT04pCi0JCXBsYW5lX2N0bCB8PSBQTEFORV9DVExfS0VZX0VOQUJMRV9ERVNUSU5B
VElPTjsKLQllbHNlIGlmIChrZXktPmZsYWdzICYgSTkxNV9TRVRfQ09MT1JLRVlfU09VUkNFKQot
CQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RMX0tFWV9FTkFCTEVfU09VUkNFOwotCi0JcmV0dXJuIHBs
YW5lX2N0bDsKLX0KLQotdTMyIGdsa19wbGFuZV9jb2xvcl9jdGxfY3J0Yyhjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKLQl1MzIg
cGxhbmVfY29sb3JfY3RsID0gMDsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQot
CQlyZXR1cm4gcGxhbmVfY29sb3JfY3RsOwotCi0JaWYgKGNydGNfc3RhdGUtPmdhbW1hX2VuYWJs
ZSkKLQkJcGxhbmVfY29sb3JfY3RsIHw9IFBMQU5FX0NPTE9SX1BJUEVfR0FNTUFfRU5BQkxFOwot
Ci0JaWYgKGNydGNfc3RhdGUtPmNzY19lbmFibGUpCi0JCXBsYW5lX2NvbG9yX2N0bCB8PSBQTEFO
RV9DT0xPUl9QSVBFX0NTQ19FTkFCTEU7Ci0KLQlyZXR1cm4gcGxhbmVfY29sb3JfY3RsOwotfQot
Ci11MzIgZ2xrX3BsYW5lX2NvbG9yX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSwKLQkJCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3Rh
dGUpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KLQkJdG9faTkxNShw
bGFuZV9zdGF0ZS0+dWFwaS5wbGFuZS0+ZGV2KTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5l
ID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOwotCXUzMiBwbGFuZV9j
b2xvcl9jdGwgPSAwOwotCi0JcGxhbmVfY29sb3JfY3RsIHw9IFBMQU5FX0NPTE9SX1BMQU5FX0dB
TU1BX0RJU0FCTEU7Ci0JcGxhbmVfY29sb3JfY3RsIHw9IGdsa19wbGFuZV9jb2xvcl9jdGxfYWxw
aGEocGxhbmVfc3RhdGUpOworCS8qCisJICogUHV0IHRoZSBmaW5hbCBjb29yZGluYXRlcyBiYWNr
IHNvIHRoYXQgdGhlIHNyYworCSAqIGNvb3JkaW5hdGUgY2hlY2tzIHdpbGwgc2VlIHRoZSByaWdo
dCB2YWx1ZXMuCisJICovCisJZHJtX3JlY3RfdHJhbnNsYXRlX3RvKCZwbGFuZV9zdGF0ZS0+dWFw
aS5zcmMsCisJCQkgICAgICBzcmNfeCA8PCAxNiwgc3JjX3kgPDwgMTYpOwogCi0JaWYgKGZiLT5m
b3JtYXQtPmlzX3l1diAmJiAhaWNsX2lzX2hkcl9wbGFuZShkZXZfcHJpdiwgcGxhbmUtPmlkKSkg
ewotCQlzd2l0Y2ggKHBsYW5lX3N0YXRlLT5ody5jb2xvcl9lbmNvZGluZykgewotCQljYXNlIERS
TV9DT0xPUl9ZQ0JDUl9CVDcwOToKLQkJCXBsYW5lX2NvbG9yX2N0bCB8PSBQTEFORV9DT0xPUl9D
U0NfTU9ERV9ZVVY3MDlfVE9fUkdCNzA5OwotCQkJYnJlYWs7Ci0JCWNhc2UgRFJNX0NPTE9SX1lD
QkNSX0JUMjAyMDoKLQkJCXBsYW5lX2NvbG9yX2N0bCB8PQotCQkJCVBMQU5FX0NPTE9SX0NTQ19N
T0RFX1lVVjIwMjBfVE9fUkdCMjAyMDsKLQkJCWJyZWFrOwotCQlkZWZhdWx0OgotCQkJcGxhbmVf
Y29sb3JfY3RsIHw9Ci0JCQkJUExBTkVfQ09MT1JfQ1NDX01PREVfWVVWNjAxX1RPX1JHQjYwMTsK
KwkvKiBIU1cvQkRXIGRvIHRoaXMgYXV0b21hZ2ljYWxseSBpbiBoYXJkd2FyZSAqLworCWlmICgh
SVNfSEFTV0VMTChkZXZfcHJpdikgJiYgIUlTX0JST0FEV0VMTChkZXZfcHJpdikpIHsKKwkJdW5z
aWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOworCQlpbnQgc3Jj
X3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAxNjsKKwkJaW50
IHNyY19oID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2Owor
CisJCWlmIChyb3RhdGlvbiAmIERSTV9NT0RFX1JPVEFURV8xODApIHsKKwkJCXNyY194ICs9IHNy
Y193IC0gMTsKKwkJCXNyY195ICs9IHNyY19oIC0gMTsKKwkJfSBlbHNlIGlmIChyb3RhdGlvbiAm
IERSTV9NT0RFX1JFRkxFQ1RfWCkgeworCQkJc3JjX3ggKz0gc3JjX3cgLSAxOwogCQl9Ci0JCWlm
IChwbGFuZV9zdGF0ZS0+aHcuY29sb3JfcmFuZ2UgPT0gRFJNX0NPTE9SX1lDQkNSX0ZVTExfUkFO
R0UpCi0JCQlwbGFuZV9jb2xvcl9jdGwgfD0gUExBTkVfQ09MT1JfWVVWX1JBTkdFX0NPUlJFQ1RJ
T05fRElTQUJMRTsKLQl9IGVsc2UgaWYgKGZiLT5mb3JtYXQtPmlzX3l1dikgewotCQlwbGFuZV9j
b2xvcl9jdGwgfD0gUExBTkVfQ09MT1JfSU5QVVRfQ1NDX0VOQUJMRTsKIAl9CiAKLQlyZXR1cm4g
cGxhbmVfY29sb3JfY3RsOworCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS5vZmZzZXQgPSBv
ZmZzZXQ7CisJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLnggPSBzcmNfeDsKKwlwbGFuZV9z
dGF0ZS0+Y29sb3JfcGxhbmVbMF0ueSA9IHNyY195OworCisJcmV0dXJuIDA7CiB9CiAKIHN0YXRp
YyBpbnQKQEAgLTQxMzcsNDYxICszMzkyLDYgQEAgc3RhdGljIHZvaWQgY3B0X3ZlcmlmeV9tb2Rl
c2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAl9CiB9CiAKLS8qCi0gKiBU
aGUgaGFyZHdhcmUgcGhhc2UgMC4wIHJlZmVycyB0byB0aGUgY2VudGVyIG9mIHRoZSBwaXhlbC4K
LSAqIFdlIHdhbnQgdG8gc3RhcnQgZnJvbSB0aGUgdG9wL2xlZnQgZWRnZSB3aGljaCBpcyBwaGFz
ZQotICogLTAuNS4gVGhhdCBtYXRjaGVzIGhvdyB0aGUgaGFyZHdhcmUgY2FsY3VsYXRlcyB0aGUg
c2NhbGluZwotICogZmFjdG9ycyAoZnJvbSB0b3AtbGVmdCBvZiB0aGUgZmlyc3QgcGl4ZWwgdG8g
Ym90dG9tLXJpZ2h0Ci0gKiBvZiB0aGUgbGFzdCBwaXhlbCwgYXMgb3Bwb3NlZCB0byB0aGUgcGl4
ZWwgY2VudGVycykuCi0gKgotICogRm9yIDQ6MjowIHN1YnNhbXBsZWQgY2hyb21hIHBsYW5lcyB3
ZSBvYnZpb3VzbHkgaGF2ZSB0bwotICogYWRqdXN0IHRoYXQgc28gdGhhdCB0aGUgY2hyb21hIHNh
bXBsZSBwb3NpdGlvbiBsYW5kcyBpbgotICogdGhlIHJpZ2h0IHNwb3QuCi0gKgotICogTm90ZSB0
aGF0IGZvciBwYWNrZWQgWUNiQ3IgNDoyOjIgZm9ybWF0cyB0aGVyZSBpcyBubyB3YXkgdG8KLSAq
IGNvbnRyb2wgY2hyb21hIHNpdGluZy4gVGhlIGhhcmR3YXJlIHNpbXBseSByZXBsaWNhdGVzIHRo
ZQotICogY2hyb21hIHNhbXBsZXMgZm9yIGJvdGggb2YgdGhlIGx1bWEgc2FtcGxlcywgYW5kIHRo
dXMgd2UgZG9uJ3QKLSAqIGFjdHVhbGx5IGdldCB0aGUgZXhwZWN0ZWQgTVBFRzIgY2hyb21hIHNp
dGluZyBjb252ZW50aW9uIDooCi0gKiBUaGUgc2FtZSBiZWhhdmlvdXIgaXMgb2JzZXJ2ZWQgb24g
cHJlLVNLTCBwbGF0Zm9ybXMgYXMgd2VsbC4KLSAqCi0gKiBUaGVvcnkgYmVoaW5kIHRoZSBmb3Jt
dWxhIChub3RlIHRoYXQgd2UgaWdub3JlIHN1Yi1waXhlbAotICogc291cmNlIGNvb3JkaW5hdGVz
KToKLSAqIHMgPSBzb3VyY2Ugc2FtcGxlIHBvc2l0aW9uCi0gKiBkID0gZGVzdGluYXRpb24gc2Ft
cGxlIHBvc2l0aW9uCi0gKgotICogRG93bnNjYWxpbmcgNDoxOgotICogLTAuNQotICogfCAwLjAK
LSAqIHwgfCAgICAgMS41IChpbml0aWFsIHBoYXNlKQotICogfCB8ICAgICB8Ci0gKiB2IHYgICAg
IHYKLSAqIHwgcyB8IHMgfCBzIHwgcyB8Ci0gKiB8ICAgICAgIGQgICAgICAgfAotICoKLSAqIFVw
c2NhbGluZyAxOjQ6Ci0gKiAtMC41Ci0gKiB8IC0wLjM3NSAoaW5pdGlhbCBwaGFzZSkKLSAqIHwg
fCAgICAgMC4wCi0gKiB8IHwgICAgIHwKLSAqIHYgdiAgICAgdgotICogfCAgICAgICBzICAgICAg
IHwKLSAqIHwgZCB8IGQgfCBkIHwgZCB8Ci0gKi8KLXUxNiBza2xfc2NhbGVyX2NhbGNfcGhhc2Uo
aW50IHN1YiwgaW50IHNjYWxlLCBib29sIGNocm9tYV9jb3NpdGVkKQotewotCWludCBwaGFzZSA9
IC0weDgwMDA7Ci0JdTE2IHRyaXAgPSAwOwotCi0JaWYgKGNocm9tYV9jb3NpdGVkKQotCQlwaGFz
ZSArPSAoc3ViIC0gMSkgKiAweDgwMDAgLyBzdWI7Ci0KLQlwaGFzZSArPSBzY2FsZSAvICgyICog
c3ViKTsKLQotCS8qCi0JICogSGFyZHdhcmUgaW5pdGlhbCBwaGFzZSBsaW1pdGVkIHRvIFstMC41
OjEuNV0uCi0JICogU2luY2UgdGhlIG1heCBoYXJkd2FyZSBzY2FsZSBmYWN0b3IgaXMgMy4wLCB3
ZQotCSAqIHNob3VsZCBuZXZlciBhY3R1YWxseSBleGNkZWVkIDEuMCBoZXJlLgotCSAqLwotCVdB
Uk5fT04ocGhhc2UgPCAtMHg4MDAwIHx8IHBoYXNlID4gMHgxODAwMCk7Ci0KLQlpZiAocGhhc2Ug
PCAwKQotCQlwaGFzZSA9IDB4MTAwMDAgKyBwaGFzZTsKLQllbHNlCi0JCXRyaXAgPSBQU19QSEFT
RV9UUklQOwotCi0JcmV0dXJuICgocGhhc2UgPj4gMikgJiBQU19QSEFTRV9NQVNLKSB8IHRyaXA7
Ci19Ci0KLSNkZWZpbmUgU0tMX01JTl9TUkNfVyA4Ci0jZGVmaW5lIFNLTF9NQVhfU1JDX1cgNDA5
NgotI2RlZmluZSBTS0xfTUlOX1NSQ19IIDgKLSNkZWZpbmUgU0tMX01BWF9TUkNfSCA0MDk2Ci0j
ZGVmaW5lIFNLTF9NSU5fRFNUX1cgOAotI2RlZmluZSBTS0xfTUFYX0RTVF9XIDQwOTYKLSNkZWZp
bmUgU0tMX01JTl9EU1RfSCA4Ci0jZGVmaW5lIFNLTF9NQVhfRFNUX0ggNDA5NgotI2RlZmluZSBJ
Q0xfTUFYX1NSQ19XIDUxMjAKLSNkZWZpbmUgSUNMX01BWF9TUkNfSCA0MDk2Ci0jZGVmaW5lIElD
TF9NQVhfRFNUX1cgNTEyMAotI2RlZmluZSBJQ0xfTUFYX0RTVF9IIDQwOTYKLSNkZWZpbmUgU0tM
X01JTl9ZVVZfNDIwX1NSQ19XIDE2Ci0jZGVmaW5lIFNLTF9NSU5fWVVWXzQyMF9TUkNfSCAxNgot
Ci1zdGF0aWMgaW50Ci1za2xfdXBkYXRlX3NjYWxlcihzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSwgYm9vbCBmb3JjZV9kZXRhY2gsCi0JCSAgdW5zaWduZWQgaW50IHNjYWxlcl91
c2VyLCBpbnQgKnNjYWxlcl9pZCwKLQkJICBpbnQgc3JjX3csIGludCBzcmNfaCwgaW50IGRzdF93
LCBpbnQgZHN0X2gsCi0JCSAgY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyAqZm9ybWF0LAot
CQkgIHU2NCBtb2RpZmllciwgYm9vbCBuZWVkX3NjYWxlcikKLXsKLQlzdHJ1Y3QgaW50ZWxfY3J0
Y19zY2FsZXJfc3RhdGUgKnNjYWxlcl9zdGF0ZSA9Ci0JCSZjcnRjX3N0YXRlLT5zY2FsZXJfc3Rh
dGU7Ci0Jc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPQotCQl0b19pbnRlbF9jcnRjKGNy
dGNfc3RhdGUtPnVhcGkuY3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShpbnRlbF9jcnRjLT5iYXNlLmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9kaXNw
bGF5X21vZGUgKmFkanVzdGVkX21vZGUgPQotCQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9k
ZTsKLQotCS8qCi0JICogU3JjIGNvb3JkaW5hdGVzIGFyZSBhbHJlYWR5IHJvdGF0ZWQgYnkgMjcw
IGRlZ3JlZXMgZm9yCi0JICogdGhlIDkwLzI3MCBkZWdyZWUgcGxhbmUgcm90YXRpb24gY2FzZXMg
KHRvIG1hdGNoIHRoZQotCSAqIEdUVCBtYXBwaW5nKSwgaGVuY2Ugbm8gbmVlZCB0byBhY2NvdW50
IGZvciByb3RhdGlvbiBoZXJlLgotCSAqLwotCWlmIChzcmNfdyAhPSBkc3RfdyB8fCBzcmNfaCAh
PSBkc3RfaCkKLQkJbmVlZF9zY2FsZXIgPSB0cnVlOwotCi0JLyoKLQkgKiBTY2FsaW5nL2ZpdHRp
bmcgbm90IHN1cHBvcnRlZCBpbiBJRi1JRCBtb2RlIGluIEdFTjkrCi0JICogVE9ETzogSW50ZXJs
YWNlIGZldGNoIG1vZGUgZG9lc24ndCBzdXBwb3J0IFlVVjQyMCBwbGFuYXIgZm9ybWF0cy4KLQkg
KiBPbmNlIE5WMTIgaXMgZW5hYmxlZCwgaGFuZGxlIGl0IGhlcmUgd2hpbGUgYWxsb2NhdGluZyBz
Y2FsZXIKLQkgKiBmb3IgTlYxMi4KLQkgKi8KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5
ICYmIGNydGNfc3RhdGUtPmh3LmVuYWJsZSAmJgotCSAgICBuZWVkX3NjYWxlciAmJiBhZGp1c3Rl
ZF9tb2RlLT5mbGFncyAmIERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFKSB7Ci0JCWRybV9kYmdfa21z
KCZkZXZfcHJpdi0+ZHJtLAotCQkJICAgICJQaXBlL1BsYW5lIHNjYWxpbmcgbm90IHN1cHBvcnRl
ZCB3aXRoIElGLUlEIG1vZGVcbiIpOwotCQlyZXR1cm4gLUVJTlZBTDsKLQl9Ci0KLQkvKgotCSAq
IGlmIHBsYW5lIGlzIGJlaW5nIGRpc2FibGVkIG9yIHNjYWxlciBpcyBubyBtb3JlIHJlcXVpcmVk
IG9yIGZvcmNlIGRldGFjaAotCSAqICAtIGZyZWUgc2NhbGVyIGJpbmRlZCB0byB0aGlzIHBsYW5l
L2NydGMKLQkgKiAgLSBpbiBvcmRlciB0byBkbyB0aGlzLCB1cGRhdGUgY3J0Yy0+c2NhbGVyX3Vz
YWdlCi0JICoKLQkgKiBIZXJlIHNjYWxlciBzdGF0ZSBpbiBjcnRjX3N0YXRlIGlzIHNldCBmcmVl
IHNvIHRoYXQKLQkgKiBzY2FsZXIgY2FuIGJlIGFzc2lnbmVkIHRvIG90aGVyIHVzZXIuIEFjdHVh
bCByZWdpc3RlcgotCSAqIHVwZGF0ZSB0byBmcmVlIHRoZSBzY2FsZXIgaXMgZG9uZSBpbiBwbGFu
ZS9wYW5lbC1maXQgcHJvZ3JhbW1pbmcuCi0JICogRm9yIHRoaXMgcHVycG9zZSBjcnRjL3BsYW5l
X3N0YXRlLT5zY2FsZXJfaWQgaXNuJ3QgcmVzZXQgaGVyZS4KLQkgKi8KLQlpZiAoZm9yY2VfZGV0
YWNoIHx8ICFuZWVkX3NjYWxlcikgewotCQlpZiAoKnNjYWxlcl9pZCA+PSAwKSB7Ci0JCQlzY2Fs
ZXJfc3RhdGUtPnNjYWxlcl91c2VycyAmPSB+KDEgPDwgc2NhbGVyX3VzZXIpOwotCQkJc2NhbGVy
X3N0YXRlLT5zY2FsZXJzWypzY2FsZXJfaWRdLmluX3VzZSA9IDA7Ci0KLQkJCWRybV9kYmdfa21z
KCZkZXZfcHJpdi0+ZHJtLAotCQkJCSAgICAic2NhbGVyX3VzZXIgaW5kZXggJXUuJXU6ICIKLQkJ
CQkgICAgIlN0YWdlZCBmcmVlaW5nIHNjYWxlciBpZCAlZCBzY2FsZXJfdXNlcnMgPSAweCV4XG4i
LAotCQkJCSAgICBpbnRlbF9jcnRjLT5waXBlLCBzY2FsZXJfdXNlciwgKnNjYWxlcl9pZCwKLQkJ
CQkgICAgc2NhbGVyX3N0YXRlLT5zY2FsZXJfdXNlcnMpOwotCQkJKnNjYWxlcl9pZCA9IC0xOwot
CQl9Ci0JCXJldHVybiAwOwotCX0KLQotCWlmIChmb3JtYXQgJiYgaW50ZWxfZm9ybWF0X2luZm9f
aXNfeXV2X3NlbWlwbGFuYXIoZm9ybWF0LCBtb2RpZmllcikgJiYKLQkgICAgKHNyY19oIDwgU0tM
X01JTl9ZVVZfNDIwX1NSQ19IIHx8IHNyY193IDwgU0tMX01JTl9ZVVZfNDIwX1NSQ19XKSkgewot
CQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKLQkJCSAgICAiUGxhbmFyIFlVVjogc3JjIGRp
bWVuc2lvbnMgbm90IG1ldFxuIik7Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQotCS8qIHJhbmdl
IGNoZWNrcyAqLwotCWlmIChzcmNfdyA8IFNLTF9NSU5fU1JDX1cgfHwgc3JjX2ggPCBTS0xfTUlO
X1NSQ19IIHx8Ci0JICAgIGRzdF93IDwgU0tMX01JTl9EU1RfVyB8fCBkc3RfaCA8IFNLTF9NSU5f
RFNUX0ggfHwKLQkgICAgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEgJiYKLQkgICAgIChzcmNf
dyA+IElDTF9NQVhfU1JDX1cgfHwgc3JjX2ggPiBJQ0xfTUFYX1NSQ19IIHx8Ci0JICAgICAgZHN0
X3cgPiBJQ0xfTUFYX0RTVF9XIHx8IGRzdF9oID4gSUNMX01BWF9EU1RfSCkpIHx8Ci0JICAgIChJ
TlRFTF9HRU4oZGV2X3ByaXYpIDwgMTEgJiYKLQkgICAgIChzcmNfdyA+IFNLTF9NQVhfU1JDX1cg
fHwgc3JjX2ggPiBTS0xfTUFYX1NSQ19IIHx8Ci0JICAgICAgZHN0X3cgPiBTS0xfTUFYX0RTVF9X
IHx8IGRzdF9oID4gU0tMX01BWF9EU1RfSCkpKQl7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+
ZHJtLAotCQkJICAgICJzY2FsZXJfdXNlciBpbmRleCAldS4ldTogc3JjICV1eCV1IGRzdCAldXgl
dSAiCi0JCQkgICAgInNpemUgaXMgb3V0IG9mIHNjYWxlciByYW5nZVxuIiwKLQkJCSAgICBpbnRl
bF9jcnRjLT5waXBlLCBzY2FsZXJfdXNlciwgc3JjX3csIHNyY19oLAotCQkJICAgIGRzdF93LCBk
c3RfaCk7Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQotCS8qIG1hcmsgdGhpcyBwbGFuZSBhcyBh
IHNjYWxlciB1c2VyIGluIGNydGNfc3RhdGUgKi8KLQlzY2FsZXJfc3RhdGUtPnNjYWxlcl91c2Vy
cyB8PSAoMSA8PCBzY2FsZXJfdXNlcik7Ci0JZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJz
Y2FsZXJfdXNlciBpbmRleCAldS4ldTogIgotCQkgICAgInN0YWdlZCBzY2FsaW5nIHJlcXVlc3Qg
Zm9yICV1eCV1LT4ldXgldSBzY2FsZXJfdXNlcnMgPSAweCV4XG4iLAotCQkgICAgaW50ZWxfY3J0
Yy0+cGlwZSwgc2NhbGVyX3VzZXIsIHNyY193LCBzcmNfaCwgZHN0X3csIGRzdF9oLAotCQkgICAg
c2NhbGVyX3N0YXRlLT5zY2FsZXJfdXNlcnMpOwotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBp
bnQgc2tsX3VwZGF0ZV9zY2FsZXJfY3J0YyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKLXsKLQljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqcGlwZV9tb2RlID0gJmNy
dGNfc3RhdGUtPmh3LnBpcGVfbW9kZTsKLQlpbnQgd2lkdGgsIGhlaWdodDsKLQotCWlmIChjcnRj
X3N0YXRlLT5wY2hfcGZpdC5lbmFibGVkKSB7Ci0JCXdpZHRoID0gZHJtX3JlY3Rfd2lkdGgoJmNy
dGNfc3RhdGUtPnBjaF9wZml0LmRzdCk7Ci0JCWhlaWdodCA9IGRybV9yZWN0X2hlaWdodCgmY3J0
Y19zdGF0ZS0+cGNoX3BmaXQuZHN0KTsKLQl9IGVsc2UgewotCQl3aWR0aCA9IHBpcGVfbW9kZS0+
Y3J0Y19oZGlzcGxheTsKLQkJaGVpZ2h0ID0gcGlwZV9tb2RlLT5jcnRjX3ZkaXNwbGF5OwotCX0K
LQlyZXR1cm4gc2tsX3VwZGF0ZV9zY2FsZXIoY3J0Y19zdGF0ZSwgIWNydGNfc3RhdGUtPmh3LmFj
dGl2ZSwKLQkJCQkgU0tMX0NSVENfSU5ERVgsCi0JCQkJICZjcnRjX3N0YXRlLT5zY2FsZXJfc3Rh
dGUuc2NhbGVyX2lkLAotCQkJCSBjcnRjX3N0YXRlLT5waXBlX3NyY193LCBjcnRjX3N0YXRlLT5w
aXBlX3NyY19oLAotCQkJCSB3aWR0aCwgaGVpZ2h0LCBOVUxMLCAwLAotCQkJCSBjcnRjX3N0YXRl
LT5wY2hfcGZpdC5lbmFibGVkKTsKLX0KLQotLyoqCi0gKiBza2xfdXBkYXRlX3NjYWxlcl9wbGFu
ZSAtIFN0YWdlcyB1cGRhdGUgdG8gc2NhbGVyIHN0YXRlIGZvciBhIGdpdmVuIHBsYW5lLgotICog
QGNydGNfc3RhdGU6IGNydGMncyBzY2FsZXIgc3RhdGUKLSAqIEBwbGFuZV9zdGF0ZTogYXRvbWlj
IHBsYW5lIHN0YXRlIHRvIHVwZGF0ZQotICoKLSAqIFJldHVybgotICogICAgIDAgLSBzY2FsZXJf
dXNhZ2UgdXBkYXRlZCBzdWNjZXNzZnVsbHkKLSAqICAgIGVycm9yIC0gcmVxdWVzdGVkIHNjYWxp
bmcgY2Fubm90IGJlIHN1cHBvcnRlZCBvciBvdGhlciBlcnJvciBjb25kaXRpb24KLSAqLwotc3Rh
dGljIGludCBza2xfdXBkYXRlX3NjYWxlcl9wbGFuZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSwKLQkJCQkgICBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRl
KQotewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqaW50ZWxfcGxhbmUgPQotCQl0b19pbnRlbF9wbGFu
ZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShpbnRlbF9wbGFuZS0+YmFzZS5kZXYpOwotCXN0cnVjdCBkcm1fZnJh
bWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwotCWludCByZXQ7Ci0JYm9vbCBmb3Jj
ZV9kZXRhY2ggPSAhZmIgfHwgIXBsYW5lX3N0YXRlLT51YXBpLnZpc2libGU7Ci0JYm9vbCBuZWVk
X3NjYWxlciA9IGZhbHNlOwotCi0JLyogUHJlLWdlbjExIGFuZCBTRFIgcGxhbmVzIGFsd2F5cyBu
ZWVkIGEgc2NhbGVyIGZvciBwbGFuYXIgZm9ybWF0cy4gKi8KLQlpZiAoIWljbF9pc19oZHJfcGxh
bmUoZGV2X3ByaXYsIGludGVsX3BsYW5lLT5pZCkgJiYKLQkgICAgZmIgJiYgaW50ZWxfZm9ybWF0
X2luZm9faXNfeXV2X3NlbWlwbGFuYXIoZmItPmZvcm1hdCwgZmItPm1vZGlmaWVyKSkKLQkJbmVl
ZF9zY2FsZXIgPSB0cnVlOwotCi0JcmV0ID0gc2tsX3VwZGF0ZV9zY2FsZXIoY3J0Y19zdGF0ZSwg
Zm9yY2VfZGV0YWNoLAotCQkJCWRybV9wbGFuZV9pbmRleCgmaW50ZWxfcGxhbmUtPmJhc2UpLAot
CQkJCSZwbGFuZV9zdGF0ZS0+c2NhbGVyX2lkLAotCQkJCWRybV9yZWN0X3dpZHRoKCZwbGFuZV9z
dGF0ZS0+dWFwaS5zcmMpID4+IDE2LAotCQkJCWRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUt
PnVhcGkuc3JjKSA+PiAxNiwKLQkJCQlkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGku
ZHN0KSwKLQkJCQlkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCksCi0JCQkJ
ZmIgPyBmYi0+Zm9ybWF0IDogTlVMTCwKLQkJCQlmYiA/IGZiLT5tb2RpZmllciA6IDAsCi0JCQkJ
bmVlZF9zY2FsZXIpOwotCi0JaWYgKHJldCB8fCBwbGFuZV9zdGF0ZS0+c2NhbGVyX2lkIDwgMCkK
LQkJcmV0dXJuIHJldDsKLQotCS8qIGNoZWNrIGNvbG9ya2V5ICovCi0JaWYgKHBsYW5lX3N0YXRl
LT5ja2V5LmZsYWdzKSB7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAotCQkJICAgICJb
UExBTkU6JWQ6JXNdIHNjYWxpbmcgd2l0aCBjb2xvciBrZXkgbm90IGFsbG93ZWQiLAotCQkJICAg
IGludGVsX3BsYW5lLT5iYXNlLmJhc2UuaWQsCi0JCQkgICAgaW50ZWxfcGxhbmUtPmJhc2UubmFt
ZSk7Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQotCS8qIENoZWNrIHNyYyBmb3JtYXQgKi8KLQlz
d2l0Y2ggKGZiLT5mb3JtYXQtPmZvcm1hdCkgewotCWNhc2UgRFJNX0ZPUk1BVF9SR0I1NjU6Ci0J
Y2FzZSBEUk1fRk9STUFUX1hCR1I4ODg4OgotCWNhc2UgRFJNX0ZPUk1BVF9YUkdCODg4ODoKLQlj
YXNlIERSTV9GT1JNQVRfQUJHUjg4ODg6Ci0JY2FzZSBEUk1fRk9STUFUX0FSR0I4ODg4OgotCWNh
c2UgRFJNX0ZPUk1BVF9YUkdCMjEwMTAxMDoKLQljYXNlIERSTV9GT1JNQVRfWEJHUjIxMDEwMTA6
Ci0JY2FzZSBEUk1fRk9STUFUX0FSR0IyMTAxMDEwOgotCWNhc2UgRFJNX0ZPUk1BVF9BQkdSMjEw
MTAxMDoKLQljYXNlIERSTV9GT1JNQVRfWVVZVjoKLQljYXNlIERSTV9GT1JNQVRfWVZZVToKLQlj
YXNlIERSTV9GT1JNQVRfVVlWWToKLQljYXNlIERSTV9GT1JNQVRfVllVWToKLQljYXNlIERSTV9G
T1JNQVRfTlYxMjoKLQljYXNlIERSTV9GT1JNQVRfWFlVVjg4ODg6Ci0JY2FzZSBEUk1fRk9STUFU
X1AwMTA6Ci0JY2FzZSBEUk1fRk9STUFUX1AwMTI6Ci0JY2FzZSBEUk1fRk9STUFUX1AwMTY6Ci0J
Y2FzZSBEUk1fRk9STUFUX1kyMTA6Ci0JY2FzZSBEUk1fRk9STUFUX1kyMTI6Ci0JY2FzZSBEUk1f
Rk9STUFUX1kyMTY6Ci0JY2FzZSBEUk1fRk9STUFUX1hWWVUyMTAxMDEwOgotCWNhc2UgRFJNX0ZP
Uk1BVF9YVllVMTJfMTYxNjE2MTY6Ci0JY2FzZSBEUk1fRk9STUFUX1hWWVUxNjE2MTYxNjoKLQkJ
YnJlYWs7Ci0JY2FzZSBEUk1fRk9STUFUX1hCR1IxNjE2MTYxNkY6Ci0JY2FzZSBEUk1fRk9STUFU
X0FCR1IxNjE2MTYxNkY6Ci0JY2FzZSBEUk1fRk9STUFUX1hSR0IxNjE2MTYxNkY6Ci0JY2FzZSBE
Uk1fRk9STUFUX0FSR0IxNjE2MTYxNkY6Ci0JCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEx
KQotCQkJYnJlYWs7Ci0JCWZhbGx0aHJvdWdoOwotCWRlZmF1bHQ6Ci0JCWRybV9kYmdfa21zKCZk
ZXZfcHJpdi0+ZHJtLAotCQkJICAgICJbUExBTkU6JWQ6JXNdIEZCOiVkIHVuc3VwcG9ydGVkIHNj
YWxpbmcgZm9ybWF0IDB4JXhcbiIsCi0JCQkgICAgaW50ZWxfcGxhbmUtPmJhc2UuYmFzZS5pZCwg
aW50ZWxfcGxhbmUtPmJhc2UubmFtZSwKLQkJCSAgICBmYi0+YmFzZS5pZCwgZmItPmZvcm1hdC0+
Zm9ybWF0KTsKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQotCi0JcmV0dXJuIDA7Ci19Ci0KLXZvaWQg
c2tsX3NjYWxlcl9kaXNhYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0
Y19zdGF0ZSkKLXsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMob2xk
X2NydGNfc3RhdGUtPnVhcGkuY3J0Yyk7Ci0JaW50IGk7Ci0KLQlmb3IgKGkgPSAwOyBpIDwgY3J0
Yy0+bnVtX3NjYWxlcnM7IGkrKykKLQkJc2tsX2RldGFjaF9zY2FsZXIoY3J0YywgaSk7Ci19Ci0K
LXN0YXRpYyBpbnQgY25sX2NvZWZfdGFwKGludCBpKQotewotCXJldHVybiBpICUgNzsKLX0KLQot
c3RhdGljIHUxNiBjbmxfbmVhcmVzdF9maWx0ZXJfY29lZihpbnQgdCkKLXsKLQlyZXR1cm4gdCA9
PSAzID8gMHgwODAwIDogMHgzMDAwOwotfQotCi0vKgotICogIFRoZW9yeSBiZWhpbmQgc2V0dGlu
ZyBuZWFyZXN0LW5laWdoYm9yIGludGVnZXIgc2NhbGluZzoKLSAqCi0gKiAgMTcgcGhhc2Ugb2Yg
NyB0YXBzIHJlcXVpcmVzIDExOSBjb2VmZmljaWVudHMgaW4gNjAgZHdvcmRzIHBlciBzZXQuCi0g
KiAgVGhlIGxldHRlciByZXByZXNlbnRzIHRoZSBmaWx0ZXIgdGFwIChEIGlzIHRoZSBjZW50ZXIg
dGFwKSBhbmQgdGhlIG51bWJlcgotICogIHJlcHJlc2VudHMgdGhlIGNvZWZmaWNpZW50IHNldCBm
b3IgYSBwaGFzZSAoMC0xNikuCi0gKgotICogICAgICAgICArLS0tLS0tLS0tLS0tKy0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rCi0gKiAgICAgICAgIHxJ
bmRleCB2YWx1ZSB8IERhdGEgdmFsdWUgY29lZmZpZW50IDEgfCBEYXRhIHZhbHVlIGNvZWZmaWVu
dCAyIHwKLSAqICAgICAgICAgKy0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0r
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKwotICogICAgICAgICB8ICAgMDBoICAgICAgfCAgICAg
ICAgICBCMCAgICAgICAgICAgIHwgICAgICAgICAgQTAgICAgICAgICAgICB8Ci0gKiAgICAgICAg
ICstLS0tLS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLSsKLSAqICAgICAgICAgfCAgIDAxaCAgICAgIHwgICAgICAgICAgRDAgICAgICAgICAg
ICB8ICAgICAgICAgIEMwICAgICAgICAgICAgfAotICogICAgICAgICArLS0tLS0tLS0tLS0tKy0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rCi0gKiAgICAg
ICAgIHwgICAwMmggICAgICB8ICAgICAgICAgIEYwICAgICAgICAgICAgfCAgICAgICAgICBFMCAg
ICAgICAgICAgIHwKLSAqICAgICAgICAgKy0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKwotICogICAgICAgICB8ICAgMDNoICAgICAg
fCAgICAgICAgICBBMSAgICAgICAgICAgIHwgICAgICAgICAgRzAgICAgICAgICAgICB8Ci0gKiAg
ICAgICAgICstLS0tLS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLSsKLSAqICAgICAgICAgfCAgIDA0aCAgICAgIHwgICAgICAgICAgQzEgICAg
ICAgICAgICB8ICAgICAgICAgIEIxICAgICAgICAgICAgfAotICogICAgICAgICArLS0tLS0tLS0t
LS0tKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rCi0g
KiAgICAgICAgIHwgICAuLi4gICAgICB8ICAgICAgICAgIC4uLiAgICAgICAgICAgfCAgICAgICAg
ICAuLi4gICAgICAgICAgIHwKLSAqICAgICAgICAgKy0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKwotICogICAgICAgICB8ICAgMzho
ICAgICAgfCAgICAgICAgICBCMTYgICAgICAgICAgIHwgICAgICAgICAgQTE2ICAgICAgICAgICB8
Ci0gKiAgICAgICAgICstLS0tLS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKy0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLSsKLSAqICAgICAgICAgfCAgIDM5aCAgICAgIHwgICAgICAgICAg
RDE2ICAgICAgICAgICB8ICAgICAgICAgIEMxNiAgICAgICAgICAgfAotICogICAgICAgICArLS0t
LS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0rCi0gKiAgICAgICAgIHwgICAzQWggICAgICB8ICAgICAgICAgIEYxNiAgICAgICAgICAgfCAg
ICAgICAgICBDMTYgICAgICAgICAgIHwKLSAqICAgICAgICAgKy0tLS0tLS0tLS0tLSstLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKwotICogICAgICAgICB8
ICAgM0JoICAgICAgfCAgICAgICAgUmVzZXJ2ZWQgICAgICAgIHwgICAgICAgICAgRzE2ICAgICAg
ICAgICB8Ci0gKiAgICAgICAgICstLS0tLS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
Ky0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSsKLSAqCi0gKiAgVG8gZW5hYmxlIG5lYXJlc3QtbmVp
Z2hib3Igc2NhbGluZzogIHByb2dyYW0gc2NhbGVyIGNvZWZmaWNlbnRzIHdpdGgKLSAqICB0aGUg
Y2VudGVyIHRhcCAoRHh4KSB2YWx1ZXMgc2V0IHRvIDEgYW5kIGFsbCBvdGhlciB2YWx1ZXMgc2V0
IHRvIDAgYXMgcGVyCi0gKiAgU0NBTEVSX0NPRUZGSUNJRU5UX0ZPUk1BVAotICoKLSAqLwotCi1z
dGF0aWMgdm9pZCBjbmxfcHJvZ3JhbV9uZWFyZXN0X2ZpbHRlcl9jb2VmcyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCi0JCQkJCSAgICAgZW51bSBwaXBlIHBpcGUsIGludCBpZCwg
aW50IHNldCkKLXsKLQlpbnQgaTsKLQotCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBDTkxf
UFNfQ09FRl9JTkRFWF9TRVQocGlwZSwgaWQsIHNldCksCi0JCQkgIFBTX0NPRUVfSU5ERVhfQVVU
T19JTkMpOwotCi0JZm9yIChpID0gMDsgaSA8IDE3ICogNzsgaSArPSAyKSB7Ci0JCXUzMiB0bXA7
Ci0JCWludCB0OwotCi0JCXQgPSBjbmxfY29lZl90YXAoaSk7Ci0JCXRtcCA9IGNubF9uZWFyZXN0
X2ZpbHRlcl9jb2VmKHQpOwotCi0JCXQgPSBjbmxfY29lZl90YXAoaSArIDEpOwotCQl0bXAgfD0g
Y25sX25lYXJlc3RfZmlsdGVyX2NvZWYodCkgPDwgMTY7Ci0KLQkJaW50ZWxfZGVfd3JpdGVfZnco
ZGV2X3ByaXYsIENOTF9QU19DT0VGX0RBVEFfU0VUKHBpcGUsIGlkLCBzZXQpLAotCQkJCSAgdG1w
KTsKLQl9Ci0KLQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgQ05MX1BTX0NPRUZfSU5ERVhf
U0VUKHBpcGUsIGlkLCBzZXQpLCAwKTsKLX0KLQotaW5saW5lIHUzMiBza2xfc2NhbGVyX2dldF9m
aWx0ZXJfc2VsZWN0KGVudW0gZHJtX3NjYWxpbmdfZmlsdGVyIGZpbHRlciwgaW50IHNldCkKLXsK
LQlpZiAoZmlsdGVyID09IERSTV9TQ0FMSU5HX0ZJTFRFUl9ORUFSRVNUX05FSUdIQk9SKSB7Ci0J
CXJldHVybiAoUFNfRklMVEVSX1BST0dSQU1NRUQgfAotCQkJUFNfWV9WRVJUX0ZJTFRFUl9TRUxF
Q1Qoc2V0KSB8Ci0JCQlQU19ZX0hPUlpfRklMVEVSX1NFTEVDVChzZXQpIHwKLQkJCVBTX1VWX1ZF
UlRfRklMVEVSX1NFTEVDVChzZXQpIHwKLQkJCVBTX1VWX0hPUlpfRklMVEVSX1NFTEVDVChzZXQp
KTsKLQl9Ci0KLQlyZXR1cm4gUFNfRklMVEVSX01FRElVTTsKLX0KLQotdm9pZCBza2xfc2NhbGVy
X3NldHVwX2ZpbHRlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcGlw
ZSBwaXBlLAotCQkJICAgICBpbnQgaWQsIGludCBzZXQsIGVudW0gZHJtX3NjYWxpbmdfZmlsdGVy
IGZpbHRlcikKLXsKLQlzd2l0Y2ggKGZpbHRlcikgewotCWNhc2UgRFJNX1NDQUxJTkdfRklMVEVS
X0RFRkFVTFQ6Ci0JCWJyZWFrOwotCWNhc2UgRFJNX1NDQUxJTkdfRklMVEVSX05FQVJFU1RfTkVJ
R0hCT1I6Ci0JCWNubF9wcm9ncmFtX25lYXJlc3RfZmlsdGVyX2NvZWZzKGRldl9wcml2LCBwaXBl
LCBpZCwgc2V0KTsKLQkJYnJlYWs7Ci0JZGVmYXVsdDoKLQkJTUlTU0lOR19DQVNFKGZpbHRlcik7
Ci0JfQotfQotCi1zdGF0aWMgdm9pZCBza2xfcGZpdF9lbmFibGUoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCi17Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0
b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7Ci0JY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc2NhbGVyX3N0YXRlICpzY2FsZXJfc3RhdGUgPQotCQkmY3J0Y19zdGF0ZS0+
c2NhbGVyX3N0YXRlOwotCXN0cnVjdCBkcm1fcmVjdCBzcmMgPSB7Ci0JCS54MiA9IGNydGNfc3Rh
dGUtPnBpcGVfc3JjX3cgPDwgMTYsCi0JCS55MiA9IGNydGNfc3RhdGUtPnBpcGVfc3JjX2ggPDwg
MTYsCi0JfTsKLQljb25zdCBzdHJ1Y3QgZHJtX3JlY3QgKmRzdCA9ICZjcnRjX3N0YXRlLT5wY2hf
cGZpdC5kc3Q7Ci0JdTE2IHV2X3JnYl9ocGhhc2UsIHV2X3JnYl92cGhhc2U7Ci0JZW51bSBwaXBl
IHBpcGUgPSBjcnRjLT5waXBlOwotCWludCB3aWR0aCA9IGRybV9yZWN0X3dpZHRoKGRzdCk7Ci0J
aW50IGhlaWdodCA9IGRybV9yZWN0X2hlaWdodChkc3QpOwotCWludCB4ID0gZHN0LT54MTsKLQlp
bnQgeSA9IGRzdC0+eTE7Ci0JaW50IGhzY2FsZSwgdnNjYWxlOwotCXVuc2lnbmVkIGxvbmcgaXJx
ZmxhZ3M7Ci0JaW50IGlkOwotCXUzMiBwc19jdHJsOwotCi0JaWYgKCFjcnRjX3N0YXRlLT5wY2hf
cGZpdC5lbmFibGVkKQotCQlyZXR1cm47Ci0KLQlpZiAoZHJtX1dBUk5fT04oJmRldl9wcml2LT5k
cm0sCi0JCQljcnRjX3N0YXRlLT5zY2FsZXJfc3RhdGUuc2NhbGVyX2lkIDwgMCkpCi0JCXJldHVy
bjsKLQotCWhzY2FsZSA9IGRybV9yZWN0X2NhbGNfaHNjYWxlKCZzcmMsIGRzdCwgMCwgSU5UX01B
WCk7Ci0JdnNjYWxlID0gZHJtX3JlY3RfY2FsY192c2NhbGUoJnNyYywgZHN0LCAwLCBJTlRfTUFY
KTsKLQotCXV2X3JnYl9ocGhhc2UgPSBza2xfc2NhbGVyX2NhbGNfcGhhc2UoMSwgaHNjYWxlLCBm
YWxzZSk7Ci0JdXZfcmdiX3ZwaGFzZSA9IHNrbF9zY2FsZXJfY2FsY19waGFzZSgxLCB2c2NhbGUs
IGZhbHNlKTsKLQotCWlkID0gc2NhbGVyX3N0YXRlLT5zY2FsZXJfaWQ7Ci0KLQlwc19jdHJsID0g
c2tsX3NjYWxlcl9nZXRfZmlsdGVyX3NlbGVjdChjcnRjX3N0YXRlLT5ody5zY2FsaW5nX2ZpbHRl
ciwgMCk7Ci0JcHNfY3RybCB8PSAgUFNfU0NBTEVSX0VOIHwgc2NhbGVyX3N0YXRlLT5zY2FsZXJz
W2lkXS5tb2RlOwotCi0Jc3Bpbl9sb2NrX2lycXNhdmUoJmRldl9wcml2LT51bmNvcmUubG9jaywg
aXJxZmxhZ3MpOwotCi0Jc2tsX3NjYWxlcl9zZXR1cF9maWx0ZXIoZGV2X3ByaXYsIHBpcGUsIGlk
LCAwLAotCQkJCWNydGNfc3RhdGUtPmh3LnNjYWxpbmdfZmlsdGVyKTsKLQotCWludGVsX2RlX3dy
aXRlX2Z3KGRldl9wcml2LCBTS0xfUFNfQ1RSTChwaXBlLCBpZCksIHBzX2N0cmwpOwotCi0JaW50
ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFNLTF9QU19WUEhBU0UocGlwZSwgaWQpLAotCQkJICBQ
U19ZX1BIQVNFKDApIHwgUFNfVVZfUkdCX1BIQVNFKHV2X3JnYl92cGhhc2UpKTsKLQlpbnRlbF9k
ZV93cml0ZV9mdyhkZXZfcHJpdiwgU0tMX1BTX0hQSEFTRShwaXBlLCBpZCksCi0JCQkgIFBTX1lf
UEhBU0UoMCkgfCBQU19VVl9SR0JfUEhBU0UodXZfcmdiX2hwaGFzZSkpOwotCWludGVsX2RlX3dy
aXRlX2Z3KGRldl9wcml2LCBTS0xfUFNfV0lOX1BPUyhwaXBlLCBpZCksCi0JCQkgIHggPDwgMTYg
fCB5KTsKLQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgU0tMX1BTX1dJTl9TWihwaXBlLCBp
ZCksCi0JCQkgIHdpZHRoIDw8IDE2IHwgaGVpZ2h0KTsKLQotCXNwaW5fdW5sb2NrX2lycXJlc3Rv
cmUoJmRldl9wcml2LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOwotfQotCiBzdGF0aWMgdm9pZCBp
bGtfcGZpdF9lbmFibGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
CiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUt
PnVhcGkuY3J0Yyk7CkBAIC04MjM5LDE1MCArNzAzOSw2IEBAIHN0YXRpYyB2b2lkIHNrbF9nZXRf
cGZpdF9jb25maWcoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJCXNjYWxl
cl9zdGF0ZS0+c2NhbGVyX3VzZXJzICY9IH4oMSA8PCBTS0xfQ1JUQ19JTkRFWCk7CiB9CiAKLXN0
YXRpYyB2b2lkCi1za2xfZ2V0X2luaXRpYWxfcGxhbmVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjLAotCQkJICAgICBzdHJ1Y3QgaW50ZWxfaW5pdGlhbF9wbGFuZV9jb25maWcgKnBsYW5l
X2NvbmZpZykKLXsKLQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSA9IHRvX2lu
dGVsX2NydGNfc3RhdGUoY3J0Yy0+YmFzZS5zdGF0ZSk7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRl
diA9IGNydGMtPmJhc2UuZGV2OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxh
bmUoY3J0Yy0+YmFzZS5wcmltYXJ5KTsKLQllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gcGxhbmUt
PmlkOwotCWVudW0gcGlwZSBwaXBlOwotCXUzMiB2YWwsIGJhc2UsIG9mZnNldCwgc3RyaWRlX211
bHQsIHRpbGluZywgYWxwaGE7Ci0JaW50IGZvdXJjYywgcGl4ZWxfZm9ybWF0OwotCXVuc2lnbmVk
IGludCBhbGlnbmVkX2hlaWdodDsKLQlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYjsKLQlzdHJ1
Y3QgaW50ZWxfZnJhbWVidWZmZXIgKmludGVsX2ZiOwotCi0JaWYgKCFwbGFuZS0+Z2V0X2h3X3N0
YXRlKHBsYW5lLCAmcGlwZSkpCi0JCXJldHVybjsKLQotCWRybV9XQVJOX09OKGRldiwgcGlwZSAh
PSBjcnRjLT5waXBlKTsKLQotCWlmIChjcnRjX3N0YXRlLT5iaWdqb2luZXIpIHsKLQkJZHJtX2Ri
Z19rbXMoJmRldl9wcml2LT5kcm0sCi0JCQkgICAgIlVuc3VwcG9ydGVkIGJpZ2pvaW5lciBjb25m
aWd1cmF0aW9uIGZvciBpbml0aWFsIEZCXG4iKTsKLQkJcmV0dXJuOwotCX0KLQotCWludGVsX2Zi
ID0ga3phbGxvYyhzaXplb2YoKmludGVsX2ZiKSwgR0ZQX0tFUk5FTCk7Ci0JaWYgKCFpbnRlbF9m
YikgewotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgImZhaWxlZCB0byBhbGxvYyBmYlxu
Iik7Ci0JCXJldHVybjsKLQl9Ci0KLQlmYiA9ICZpbnRlbF9mYi0+YmFzZTsKLQotCWZiLT5kZXYg
PSBkZXY7Ci0KLQl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBQTEFORV9DVEwocGlwZSwg
cGxhbmVfaWQpKTsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQotCQlwaXhlbF9m
b3JtYXQgPSB2YWwgJiBJQ0xfUExBTkVfQ1RMX0ZPUk1BVF9NQVNLOwotCWVsc2UKLQkJcGl4ZWxf
Zm9ybWF0ID0gdmFsICYgUExBTkVfQ1RMX0ZPUk1BVF9NQVNLOwotCi0JaWYgKElOVEVMX0dFTihk
ZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpIHsKLQkJYWxwaGEgPSBp
bnRlbF9kZV9yZWFkKGRldl9wcml2LAotCQkJCSAgICAgIFBMQU5FX0NPTE9SX0NUTChwaXBlLCBw
bGFuZV9pZCkpOwotCQlhbHBoYSAmPSBQTEFORV9DT0xPUl9BTFBIQV9NQVNLOwotCX0gZWxzZSB7
Ci0JCWFscGhhID0gdmFsICYgUExBTkVfQ1RMX0FMUEhBX01BU0s7Ci0JfQotCi0JZm91cmNjID0g
c2tsX2Zvcm1hdF90b19mb3VyY2MocGl4ZWxfZm9ybWF0LAotCQkJCSAgICAgIHZhbCAmIFBMQU5F
X0NUTF9PUkRFUl9SR0JYLCBhbHBoYSk7Ci0JZmItPmZvcm1hdCA9IGRybV9mb3JtYXRfaW5mbyhm
b3VyY2MpOwotCi0JdGlsaW5nID0gdmFsICYgUExBTkVfQ1RMX1RJTEVEX01BU0s7Ci0Jc3dpdGNo
ICh0aWxpbmcpIHsKLQljYXNlIFBMQU5FX0NUTF9USUxFRF9MSU5FQVI6Ci0JCWZiLT5tb2RpZmll
ciA9IERSTV9GT1JNQVRfTU9EX0xJTkVBUjsKLQkJYnJlYWs7Ci0JY2FzZSBQTEFORV9DVExfVElM
RURfWDoKLQkJcGxhbmVfY29uZmlnLT50aWxpbmcgPSBJOTE1X1RJTElOR19YOwotCQlmYi0+bW9k
aWZpZXIgPSBJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRDsKLQkJYnJlYWs7Ci0JY2FzZSBQTEFORV9D
VExfVElMRURfWToKLQkJcGxhbmVfY29uZmlnLT50aWxpbmcgPSBJOTE1X1RJTElOR19ZOwotCQlp
ZiAodmFsICYgUExBTkVfQ1RMX1JFTkRFUl9ERUNPTVBSRVNTSU9OX0VOQUJMRSkKLQkJCWZiLT5t
b2RpZmllciA9IElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIgPwotCQkJCUk5MTVfRk9STUFUX01P
RF9ZX1RJTEVEX0dFTjEyX1JDX0NDUyA6Ci0JCQkJSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfQ0NT
OwotCQllbHNlIGlmICh2YWwgJiBQTEFORV9DVExfTUVESUFfREVDT01QUkVTU0lPTl9FTkFCTEUp
Ci0JCQlmYi0+bW9kaWZpZXIgPSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9NQ19DQ1M7
Ci0JCWVsc2UKLQkJCWZiLT5tb2RpZmllciA9IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEOwotCQli
cmVhazsKLQljYXNlIFBMQU5FX0NUTF9USUxFRF9ZRjoKLQkJaWYgKHZhbCAmIFBMQU5FX0NUTF9S
RU5ERVJfREVDT01QUkVTU0lPTl9FTkFCTEUpCi0JCQlmYi0+bW9kaWZpZXIgPSBJOTE1X0ZPUk1B
VF9NT0RfWWZfVElMRURfQ0NTOwotCQllbHNlCi0JCQlmYi0+bW9kaWZpZXIgPSBJOTE1X0ZPUk1B
VF9NT0RfWWZfVElMRUQ7Ci0JCWJyZWFrOwotCWRlZmF1bHQ6Ci0JCU1JU1NJTkdfQ0FTRSh0aWxp
bmcpOwotCQlnb3RvIGVycm9yOwotCX0KLQotCS8qCi0JICogRFJNX01PREVfUk9UQVRFXyBpcyBj
b3VudGVyIGNsb2Nrd2lzZSB0byBzdGF5IGNvbXBhdGlibGUgd2l0aCBYcmFuZHIKLQkgKiB3aGls
ZSBpOTE1IEhXIHJvdGF0aW9uIGlzIGNsb2Nrd2lzZSwgdGhhdHMgd2h5IHRoaXMgc3dhcHBpbmcu
Ci0JICovCi0Jc3dpdGNoICh2YWwgJiBQTEFORV9DVExfUk9UQVRFX01BU0spIHsKLQljYXNlIFBM
QU5FX0NUTF9ST1RBVEVfMDoKLQkJcGxhbmVfY29uZmlnLT5yb3RhdGlvbiA9IERSTV9NT0RFX1JP
VEFURV8wOwotCQlicmVhazsKLQljYXNlIFBMQU5FX0NUTF9ST1RBVEVfOTA6Ci0JCXBsYW5lX2Nv
bmZpZy0+cm90YXRpb24gPSBEUk1fTU9ERV9ST1RBVEVfMjcwOwotCQlicmVhazsKLQljYXNlIFBM
QU5FX0NUTF9ST1RBVEVfMTgwOgotCQlwbGFuZV9jb25maWctPnJvdGF0aW9uID0gRFJNX01PREVf
Uk9UQVRFXzE4MDsKLQkJYnJlYWs7Ci0JY2FzZSBQTEFORV9DVExfUk9UQVRFXzI3MDoKLQkJcGxh
bmVfY29uZmlnLT5yb3RhdGlvbiA9IERSTV9NT0RFX1JPVEFURV85MDsKLQkJYnJlYWs7Ci0JfQot
Ci0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgJiYKLQkgICAgdmFsICYgUExBTkVfQ1RM
X0ZMSVBfSE9SSVpPTlRBTCkKLQkJcGxhbmVfY29uZmlnLT5yb3RhdGlvbiB8PSBEUk1fTU9ERV9S
RUZMRUNUX1g7Ci0KLQkvKiA5MC8yNzAgZGVncmVlIHJvdGF0aW9uIHdvdWxkIHJlcXVpcmUgZXh0
cmEgd29yayAqLwotCWlmIChkcm1fcm90YXRpb25fOTBfb3JfMjcwKHBsYW5lX2NvbmZpZy0+cm90
YXRpb24pKQotCQlnb3RvIGVycm9yOwotCi0JYmFzZSA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYs
IFBMQU5FX1NVUkYocGlwZSwgcGxhbmVfaWQpKSAmIDB4ZmZmZmYwMDA7Ci0JcGxhbmVfY29uZmln
LT5iYXNlID0gYmFzZTsKLQotCW9mZnNldCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIFBMQU5F
X09GRlNFVChwaXBlLCBwbGFuZV9pZCkpOwotCi0JdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJp
diwgUExBTkVfU0laRShwaXBlLCBwbGFuZV9pZCkpOwotCWZiLT5oZWlnaHQgPSAoKHZhbCA+PiAx
NikgJiAweGZmZmYpICsgMTsKLQlmYi0+d2lkdGggPSAoKHZhbCA+PiAwKSAmIDB4ZmZmZikgKyAx
OwotCi0JdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgUExBTkVfU1RSSURFKHBpcGUsIHBs
YW5lX2lkKSk7Ci0Jc3RyaWRlX211bHQgPSBza2xfcGxhbmVfc3RyaWRlX211bHQoZmIsIDAsIERS
TV9NT0RFX1JPVEFURV8wKTsKLQlmYi0+cGl0Y2hlc1swXSA9ICh2YWwgJiAweDNmZikgKiBzdHJp
ZGVfbXVsdDsKLQotCWFsaWduZWRfaGVpZ2h0ID0gaW50ZWxfZmJfYWxpZ25faGVpZ2h0KGZiLCAw
LCBmYi0+aGVpZ2h0KTsKLQotCXBsYW5lX2NvbmZpZy0+c2l6ZSA9IGZiLT5waXRjaGVzWzBdICog
YWxpZ25lZF9oZWlnaHQ7Ci0KLQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKLQkJICAgICIl
cy8lcyB3aXRoIGZiOiBzaXplPSVkeCVkQCVkLCBvZmZzZXQ9JXgsIHBpdGNoICVkLCBzaXplIDB4
JXhcbiIsCi0JCSAgICBjcnRjLT5iYXNlLm5hbWUsIHBsYW5lLT5iYXNlLm5hbWUsIGZiLT53aWR0
aCwgZmItPmhlaWdodCwKLQkJICAgIGZiLT5mb3JtYXQtPmNwcFswXSAqIDgsIGJhc2UsIGZiLT5w
aXRjaGVzWzBdLAotCQkgICAgcGxhbmVfY29uZmlnLT5zaXplKTsKLQotCXBsYW5lX2NvbmZpZy0+
ZmIgPSBpbnRlbF9mYjsKLQlyZXR1cm47Ci0KLWVycm9yOgotCWtmcmVlKGludGVsX2ZiKTsKLX0K
LQogc3RhdGljIHZvaWQgaWxrX2dldF9wZml0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2Ny
dGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5LmgKaW5kZXggMzc2Y2VjNzFiNDc3Li5jMWRkZWY2MGUzNmUgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5oCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5oCkBAIC01Miw2ICs1
Miw3IEBAIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlOwogc3RydWN0IGludGVsX2RpZ2l0YWxfcG9y
dDsKIHN0cnVjdCBpbnRlbF9kcDsKIHN0cnVjdCBpbnRlbF9lbmNvZGVyOworc3RydWN0IGludGVs
X2luaXRpYWxfcGxhbmVfY29uZmlnOwogc3RydWN0IGludGVsX2xvYWRfZGV0ZWN0X3BpcGU7CiBz
dHJ1Y3QgaW50ZWxfcGxhbmU7CiBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGU7CkBAIC02MTUsMjMg
KzYxNiwxMiBAQCBpbnRlbF9sZWdhY3lfYXV4X3RvX3Bvd2VyX2RvbWFpbihlbnVtIGF1eF9jaCBh
dXhfY2gpOwogdm9pZCBpbnRlbF9jcnRjX2FybV9maWZvX3VuZGVycnVuKHN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjLAogCQkJCSAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOwog
Ci11MTYgc2tsX3NjYWxlcl9jYWxjX3BoYXNlKGludCBzdWIsIGludCBzY2FsZSwgYm9vbCBjaHJv
bWFfY2VudGVyKTsKIHZvaWQgc2tsX3NjYWxlcl9kaXNhYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSk7Ci11MzIgc2tsX3NjYWxlcl9nZXRfZmlsdGVyX3Nl
bGVjdChlbnVtIGRybV9zY2FsaW5nX2ZpbHRlciBmaWx0ZXIsIGludCBzZXQpOwotdm9pZCBza2xf
c2NhbGVyX3NldHVwX2ZpbHRlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVu
dW0gcGlwZSBwaXBlLAotCQkJICAgICBpbnQgaWQsIGludCBzZXQsIGVudW0gZHJtX3NjYWxpbmdf
ZmlsdGVyIGZpbHRlcik7CiB2b2lkIGlsa19wZml0X2Rpc2FibGUoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlKTsKLXUzMiBnbGtfcGxhbmVfY29sb3JfY3RsKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAotCQkJY29uc3Qgc3RydWN0
IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSk7Ci11MzIgZ2xrX3BsYW5lX2NvbG9yX2N0
bF9jcnRjKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKLXUzMiBz
a2xfcGxhbmVfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAot
CQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpOwotdTMyIHNr
bF9wbGFuZV9jdGxfY3J0Yyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSk7Ci11MzIgc2tsX3BsYW5lX3N0cmlkZShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUg
KnBsYW5lX3N0YXRlLAotCQkgICAgIGludCBwbGFuZSk7Ci1pbnQgc2tsX2NoZWNrX3BsYW5lX3N1
cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSk7Cit2b2lkIHNrbF9k
ZXRhY2hfc2NhbGVycyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7
CiBpbnQgaTl4eF9jaGVja19wbGFuZV9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUpOwogaW50IHNrbF9mb3JtYXRfdG9fZm91cmNjKGludCBmb3JtYXQsIGJvb2wg
cmdiX29yZGVyLCBib29sIGFscGhhKTsKK3ZvaWQgc2tsX3BmaXRfZW5hYmxlKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKIHVuc2lnbmVkIGludCBpOXh4X3BsYW5l
X21heF9zdHJpZGUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAkJCQkgICB1MzIgcGl4ZWxf
Zm9ybWF0LCB1NjQgbW9kaWZpZXIsCiAJCQkJICAgdW5zaWduZWQgaW50IHJvdGF0aW9uKTsKQEAg
LTY1Nyw2ICs2NDcsMjYgQEAgc3RydWN0IGludGVsX2VuY29kZXIgKgogaW50ZWxfZ2V0X2NydGNf
bmV3X2VuY29kZXIoY29uc3Qgc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJCQkg
ICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7CiAKK3Vuc2lnbmVk
IGludCBpbnRlbF9zdXJmX2FsaWdubWVudChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpm
YiwKKwkJCQkgIGludCBjb2xvcl9wbGFuZSk7Cit2b2lkIGludGVsX2ZiX3BsYW5lX2dldF9zdWJz
YW1wbGluZyhpbnQgKmhzdWIsIGludCAqdnN1YiwKKwkJCQkgICAgY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIsCisJCQkJICAgIGludCBjb2xvcl9wbGFuZSk7Cit1MzIgaW50ZWxfcGxh
bmVfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KGludCAqeCwgaW50ICp5LAorCQkJCSAgICAgIGNvbnN0
IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqc3RhdGUsCisJCQkJICAgICAgaW50IGNvbG9yX3Bs
YW5lLAorCQkJCSAgICAgIHUzMiBvbGRfb2Zmc2V0LCB1MzIgbmV3X29mZnNldCk7CitpbnQgbWFp
bl90b19jY3NfcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBtYWlu
X3BsYW5lKTsKK2ludCBjY3NfdG9fbWFpbl9wbGFuZShjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYiwgaW50IGNjc19wbGFuZSk7Cit1bnNpZ25lZCBpbnQgaW50ZWxfdGlsZV93aWR0aF9i
eXRlcyhjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNvbG9yX3BsYW5lKTsK
K3Vuc2lnbmVkIGludCBpbnRlbF90aWxlX2hlaWdodChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYiwgaW50IGNvbG9yX3BsYW5lKTsKK2ludCBza2xfdXBkYXRlX3NjYWxlcl9jcnRjKHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKK2ludCBza2xfdXBkYXRlX3NjYWxl
cl9wbGFuZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCSAgICBzdHJ1
Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKTsKK3ZvaWQKK3NrbF9nZXRfaW5pdGlh
bF9wbGFuZV9jb25maWcoc3RydWN0IGludGVsX2NydGMgKmNydGMsCisJCQkgICAgIHN0cnVjdCBp
bnRlbF9pbml0aWFsX3BsYW5lX2NvbmZpZyAqcGxhbmVfY29uZmlnKTsKKwogLyogbW9kZXNldHRp
bmcgKi8KIHZvaWQgaW50ZWxfbW9kZXNldF9pbml0X2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KTsKIGludCBpbnRlbF9tb2Rlc2V0X2luaXRfbm9pcnEoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kaXNwbGF5X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2Rpc3BsYXlfdHlwZXMuaAppbmRleCA0NGEyODM2M2YzMjkuLjI2MmMzNzJjZWM3OSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgK
QEAgLTM3LDYgKzM3LDcgQEAKICNpbmNsdWRlIDxkcm0vZHJtX2RwX21zdF9oZWxwZXIuaD4KICNp
bmNsdWRlIDxkcm0vZHJtX2VuY29kZXIuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2ZiX2hlbHBlci5o
PgorI2luY2x1ZGUgPGRybS9kcm1fZm91cmNjLmg+CiAjaW5jbHVkZSA8ZHJtL2RybV9wcm9iZV9o
ZWxwZXIuaD4KICNpbmNsdWRlIDxkcm0vZHJtX3JlY3QuaD4KICNpbmNsdWRlIDxkcm0vZHJtX3Zi
bGFuay5oPgpAQCAtMTgzMyw0ICsxODM0LDI0IEBAIHN0YXRpYyBpbmxpbmUgdTMyIGludGVsX2Zk
aV9saW5rX2ZyZXEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQlyZXR1cm4g
ZGV2X3ByaXYtPmZkaV9wbGxfZnJlcTsKIH0KIAorc3RhdGljIGlubGluZSBib29sIGlzX2Njc19w
bGFuZShjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IHBsYW5lKQoreworCWlm
ICghaXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikpCisJCXJldHVybiBmYWxzZTsKKworCXJl
dHVybiBwbGFuZSA+PSBmYi0+Zm9ybWF0LT5udW1fcGxhbmVzIC8gMjsKK30KKworc3RhdGljIGlu
bGluZSBib29sIGlzX2dlbjEyX2Njc19tb2RpZmllcih1NjQgbW9kaWZpZXIpCit7CisJcmV0dXJu
IG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUyB8fAorCSAg
ICAgICBtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9NQ19DQ1M7CisK
K30KKworc3RhdGljIGlubGluZSBib29sIGlzX2dlbjEyX2Njc19wbGFuZShjb25zdCBzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IHBsYW5lKQoreworCXJldHVybiBpc19nZW4xMl9jY3Nf
bW9kaWZpZXIoZmItPm1vZGlmaWVyKSAmJiBpc19jY3NfcGxhbmUoZmIsIHBsYW5lKTsKK30KKwog
I2VuZGlmIC8qICBfX0lOVEVMX0RJU1BMQVlfVFlQRVNfSF9fICovCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2dlbjlfcGxhbmUuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZ2VuOV9wbGFuZS5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0
CmluZGV4IDAwMDAwMDAwMDAwMC4uODU0OWIyNjJmMDk1Ci0tLSAvZGV2L251bGwKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9nZW45X3BsYW5lLmMKQEAgLTAsMCArMSwy
ODMyIEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUCisvKgorICogQ29weXJpZ2h0
IMKpIDIwMjAgSW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaW5jbHVkZSA8ZHJtL2RybV9hdG9t
aWNfaGVscGVyLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9kYW1hZ2VfaGVscGVyLmg+CisjaW5jbHVk
ZSA8ZHJtL2RybV9mb3VyY2MuaD4KKyNpbmNsdWRlIDxkcm0vZHJtX3BsYW5lX2hlbHBlci5oPgor
CisjaW5jbHVkZSAiaTkxNV9kcnYuaCIKKyNpbmNsdWRlICJpbnRlbF9hdG9taWNfcGxhbmUuaCIK
KyNpbmNsdWRlICJpbnRlbF9kaXNwbGF5X3R5cGVzLmgiCisjaW5jbHVkZSAiaW50ZWxfcG0uaCIK
KyNpbmNsdWRlICJpbnRlbF9wc3IuaCIKKyNpbmNsdWRlICJpbnRlbF9zcHJpdGUuaCIKKworc3Rh
dGljIGNvbnN0IHUzMiBza2xfcGxhbmVfZm9ybWF0c1tdID0geworCURSTV9GT1JNQVRfQzgsCisJ
RFJNX0ZPUk1BVF9SR0I1NjUsCisJRFJNX0ZPUk1BVF9YUkdCODg4OCwKKwlEUk1fRk9STUFUX1hC
R1I4ODg4LAorCURSTV9GT1JNQVRfQVJHQjg4ODgsCisJRFJNX0ZPUk1BVF9BQkdSODg4OCwKKwlE
Uk1fRk9STUFUX1hSR0IyMTAxMDEwLAorCURSTV9GT1JNQVRfWEJHUjIxMDEwMTAsCisJRFJNX0ZP
Uk1BVF9YUkdCMTYxNjE2MTZGLAorCURSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RiwKKwlEUk1fRk9S
TUFUX1lVWVYsCisJRFJNX0ZPUk1BVF9ZVllVLAorCURSTV9GT1JNQVRfVVlWWSwKKwlEUk1fRk9S
TUFUX1ZZVVksCisJRFJNX0ZPUk1BVF9YWVVWODg4OCwKK307CisKK3N0YXRpYyBjb25zdCB1MzIg
c2tsX3BsYW5hcl9mb3JtYXRzW10gPSB7CisJRFJNX0ZPUk1BVF9DOCwKKwlEUk1fRk9STUFUX1JH
QjU2NSwKKwlEUk1fRk9STUFUX1hSR0I4ODg4LAorCURSTV9GT1JNQVRfWEJHUjg4ODgsCisJRFJN
X0ZPUk1BVF9BUkdCODg4OCwKKwlEUk1fRk9STUFUX0FCR1I4ODg4LAorCURSTV9GT1JNQVRfWFJH
QjIxMDEwMTAsCisJRFJNX0ZPUk1BVF9YQkdSMjEwMTAxMCwKKwlEUk1fRk9STUFUX1hSR0IxNjE2
MTYxNkYsCisJRFJNX0ZPUk1BVF9YQkdSMTYxNjE2MTZGLAorCURSTV9GT1JNQVRfWVVZViwKKwlE
Uk1fRk9STUFUX1lWWVUsCisJRFJNX0ZPUk1BVF9VWVZZLAorCURSTV9GT1JNQVRfVllVWSwKKwlE
Uk1fRk9STUFUX05WMTIsCisJRFJNX0ZPUk1BVF9YWVVWODg4OCwKK307CisKK3N0YXRpYyBjb25z
dCB1MzIgZ2xrX3BsYW5hcl9mb3JtYXRzW10gPSB7CisJRFJNX0ZPUk1BVF9DOCwKKwlEUk1fRk9S
TUFUX1JHQjU2NSwKKwlEUk1fRk9STUFUX1hSR0I4ODg4LAorCURSTV9GT1JNQVRfWEJHUjg4ODgs
CisJRFJNX0ZPUk1BVF9BUkdCODg4OCwKKwlEUk1fRk9STUFUX0FCR1I4ODg4LAorCURSTV9GT1JN
QVRfWFJHQjIxMDEwMTAsCisJRFJNX0ZPUk1BVF9YQkdSMjEwMTAxMCwKKwlEUk1fRk9STUFUX1hS
R0IxNjE2MTYxNkYsCisJRFJNX0ZPUk1BVF9YQkdSMTYxNjE2MTZGLAorCURSTV9GT1JNQVRfWVVZ
ViwKKwlEUk1fRk9STUFUX1lWWVUsCisJRFJNX0ZPUk1BVF9VWVZZLAorCURSTV9GT1JNQVRfVllV
WSwKKwlEUk1fRk9STUFUX05WMTIsCisJRFJNX0ZPUk1BVF9YWVVWODg4OCwKKwlEUk1fRk9STUFU
X1AwMTAsCisJRFJNX0ZPUk1BVF9QMDEyLAorCURSTV9GT1JNQVRfUDAxNiwKK307CisKK3N0YXRp
YyBjb25zdCB1MzIgaWNsX3Nkcl95X3BsYW5lX2Zvcm1hdHNbXSA9IHsKKwlEUk1fRk9STUFUX0M4
LAorCURSTV9GT1JNQVRfUkdCNTY1LAorCURSTV9GT1JNQVRfWFJHQjg4ODgsCisJRFJNX0ZPUk1B
VF9YQkdSODg4OCwKKwlEUk1fRk9STUFUX0FSR0I4ODg4LAorCURSTV9GT1JNQVRfQUJHUjg4ODgs
CisJRFJNX0ZPUk1BVF9YUkdCMjEwMTAxMCwKKwlEUk1fRk9STUFUX1hCR1IyMTAxMDEwLAorCURS
TV9GT1JNQVRfQVJHQjIxMDEwMTAsCisJRFJNX0ZPUk1BVF9BQkdSMjEwMTAxMCwKKwlEUk1fRk9S
TUFUX1lVWVYsCisJRFJNX0ZPUk1BVF9ZVllVLAorCURSTV9GT1JNQVRfVVlWWSwKKwlEUk1fRk9S
TUFUX1ZZVVksCisJRFJNX0ZPUk1BVF9ZMjEwLAorCURSTV9GT1JNQVRfWTIxMiwKKwlEUk1fRk9S
TUFUX1kyMTYsCisJRFJNX0ZPUk1BVF9YWVVWODg4OCwKKwlEUk1fRk9STUFUX1hWWVUyMTAxMDEw
LAorCURSTV9GT1JNQVRfWFZZVTEyXzE2MTYxNjE2LAorCURSTV9GT1JNQVRfWFZZVTE2MTYxNjE2
LAorfTsKKworc3RhdGljIGNvbnN0IHUzMiBpY2xfc2RyX3V2X3BsYW5lX2Zvcm1hdHNbXSA9IHsK
KwlEUk1fRk9STUFUX0M4LAorCURSTV9GT1JNQVRfUkdCNTY1LAorCURSTV9GT1JNQVRfWFJHQjg4
ODgsCisJRFJNX0ZPUk1BVF9YQkdSODg4OCwKKwlEUk1fRk9STUFUX0FSR0I4ODg4LAorCURSTV9G
T1JNQVRfQUJHUjg4ODgsCisJRFJNX0ZPUk1BVF9YUkdCMjEwMTAxMCwKKwlEUk1fRk9STUFUX1hC
R1IyMTAxMDEwLAorCURSTV9GT1JNQVRfQVJHQjIxMDEwMTAsCisJRFJNX0ZPUk1BVF9BQkdSMjEw
MTAxMCwKKwlEUk1fRk9STUFUX1lVWVYsCisJRFJNX0ZPUk1BVF9ZVllVLAorCURSTV9GT1JNQVRf
VVlWWSwKKwlEUk1fRk9STUFUX1ZZVVksCisJRFJNX0ZPUk1BVF9OVjEyLAorCURSTV9GT1JNQVRf
UDAxMCwKKwlEUk1fRk9STUFUX1AwMTIsCisJRFJNX0ZPUk1BVF9QMDE2LAorCURSTV9GT1JNQVRf
WTIxMCwKKwlEUk1fRk9STUFUX1kyMTIsCisJRFJNX0ZPUk1BVF9ZMjE2LAorCURSTV9GT1JNQVRf
WFlVVjg4ODgsCisJRFJNX0ZPUk1BVF9YVllVMjEwMTAxMCwKKwlEUk1fRk9STUFUX1hWWVUxMl8x
NjE2MTYxNiwKKwlEUk1fRk9STUFUX1hWWVUxNjE2MTYxNiwKK307CisKK3N0YXRpYyBjb25zdCB1
MzIgaWNsX2hkcl9wbGFuZV9mb3JtYXRzW10gPSB7CisJRFJNX0ZPUk1BVF9DOCwKKwlEUk1fRk9S
TUFUX1JHQjU2NSwKKwlEUk1fRk9STUFUX1hSR0I4ODg4LAorCURSTV9GT1JNQVRfWEJHUjg4ODgs
CisJRFJNX0ZPUk1BVF9BUkdCODg4OCwKKwlEUk1fRk9STUFUX0FCR1I4ODg4LAorCURSTV9GT1JN
QVRfWFJHQjIxMDEwMTAsCisJRFJNX0ZPUk1BVF9YQkdSMjEwMTAxMCwKKwlEUk1fRk9STUFUX0FS
R0IyMTAxMDEwLAorCURSTV9GT1JNQVRfQUJHUjIxMDEwMTAsCisJRFJNX0ZPUk1BVF9YUkdCMTYx
NjE2MTZGLAorCURSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RiwKKwlEUk1fRk9STUFUX0FSR0IxNjE2
MTYxNkYsCisJRFJNX0ZPUk1BVF9BQkdSMTYxNjE2MTZGLAorCURSTV9GT1JNQVRfWVVZViwKKwlE
Uk1fRk9STUFUX1lWWVUsCisJRFJNX0ZPUk1BVF9VWVZZLAorCURSTV9GT1JNQVRfVllVWSwKKwlE
Uk1fRk9STUFUX05WMTIsCisJRFJNX0ZPUk1BVF9QMDEwLAorCURSTV9GT1JNQVRfUDAxMiwKKwlE
Uk1fRk9STUFUX1AwMTYsCisJRFJNX0ZPUk1BVF9ZMjEwLAorCURSTV9GT1JNQVRfWTIxMiwKKwlE
Uk1fRk9STUFUX1kyMTYsCisJRFJNX0ZPUk1BVF9YWVVWODg4OCwKKwlEUk1fRk9STUFUX1hWWVUy
MTAxMDEwLAorCURSTV9GT1JNQVRfWFZZVTEyXzE2MTYxNjE2LAorCURSTV9GT1JNQVRfWFZZVTE2
MTYxNjE2LAorfTsKKworc3RhdGljIGNvbnN0IHU2NCBza2xfcGxhbmVfZm9ybWF0X21vZGlmaWVy
c19ub2Njc1tdID0geworCUk5MTVfRk9STUFUX01PRF9ZZl9USUxFRCwKKwlJOTE1X0ZPUk1BVF9N
T0RfWV9USUxFRCwKKwlJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRCwKKwlEUk1fRk9STUFUX01PRF9M
SU5FQVIsCisJRFJNX0ZPUk1BVF9NT0RfSU5WQUxJRAorfTsKKworc3RhdGljIGNvbnN0IHU2NCBz
a2xfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19jY3NbXSA9IHsKKwlJOTE1X0ZPUk1BVF9NT0RfWWZf
VElMRURfQ0NTLAorCUk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUywKKwlJOTE1X0ZPUk1BVF9N
T0RfWWZfVElMRUQsCisJSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQsCisJSTkxNV9GT1JNQVRfTU9E
X1hfVElMRUQsCisJRFJNX0ZPUk1BVF9NT0RfTElORUFSLAorCURSTV9GT1JNQVRfTU9EX0lOVkFM
SUQKK307CisKK3N0YXRpYyBjb25zdCB1NjQgZ2VuMTJfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19t
Y19jY3NbXSA9IHsKKwlJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9NQ19DQ1MsCisJSTkx
NV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTLAorCUk5MTVfRk9STUFUX01PRF9ZX1RJ
TEVELAorCUk5MTVfRk9STUFUX01PRF9YX1RJTEVELAorCURSTV9GT1JNQVRfTU9EX0xJTkVBUiwK
KwlEUk1fRk9STUFUX01PRF9JTlZBTElECit9OworCitzdGF0aWMgY29uc3QgdTY0IGdlbjEyX3Bs
YW5lX2Zvcm1hdF9tb2RpZmllcnNfcmNfY2NzW10gPSB7CisJSTkxNV9GT1JNQVRfTU9EX1lfVElM
RURfR0VOMTJfUkNfQ0NTLAorCUk5MTVfRk9STUFUX01PRF9ZX1RJTEVELAorCUk5MTVfRk9STUFU
X01PRF9YX1RJTEVELAorCURSTV9GT1JNQVRfTU9EX0xJTkVBUiwKKwlEUk1fRk9STUFUX01PRF9J
TlZBTElECit9OworCitpbnQgc2tsX2Zvcm1hdF90b19mb3VyY2MoaW50IGZvcm1hdCwgYm9vbCBy
Z2Jfb3JkZXIsIGJvb2wgYWxwaGEpCit7CisJc3dpdGNoIChmb3JtYXQpIHsKKwljYXNlIFBMQU5F
X0NUTF9GT1JNQVRfUkdCXzU2NToKKwkJcmV0dXJuIERSTV9GT1JNQVRfUkdCNTY1OworCWNhc2Ug
UExBTkVfQ1RMX0ZPUk1BVF9OVjEyOgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9OVjEyOworCWNhc2Ug
UExBTkVfQ1RMX0ZPUk1BVF9YWVVWOgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9YWVVWODg4ODsKKwlj
YXNlIFBMQU5FX0NUTF9GT1JNQVRfUDAxMDoKKwkJcmV0dXJuIERSTV9GT1JNQVRfUDAxMDsKKwlj
YXNlIFBMQU5FX0NUTF9GT1JNQVRfUDAxMjoKKwkJcmV0dXJuIERSTV9GT1JNQVRfUDAxMjsKKwlj
YXNlIFBMQU5FX0NUTF9GT1JNQVRfUDAxNjoKKwkJcmV0dXJuIERSTV9GT1JNQVRfUDAxNjsKKwlj
YXNlIFBMQU5FX0NUTF9GT1JNQVRfWTIxMDoKKwkJcmV0dXJuIERSTV9GT1JNQVRfWTIxMDsKKwlj
YXNlIFBMQU5FX0NUTF9GT1JNQVRfWTIxMjoKKwkJcmV0dXJuIERSTV9GT1JNQVRfWTIxMjsKKwlj
YXNlIFBMQU5FX0NUTF9GT1JNQVRfWTIxNjoKKwkJcmV0dXJuIERSTV9GT1JNQVRfWTIxNjsKKwlj
YXNlIFBMQU5FX0NUTF9GT1JNQVRfWTQxMDoKKwkJcmV0dXJuIERSTV9GT1JNQVRfWFZZVTIxMDEw
MTA7CisJY2FzZSBQTEFORV9DVExfRk9STUFUX1k0MTI6CisJCXJldHVybiBEUk1fRk9STUFUX1hW
WVUxMl8xNjE2MTYxNjsKKwljYXNlIFBMQU5FX0NUTF9GT1JNQVRfWTQxNjoKKwkJcmV0dXJuIERS
TV9GT1JNQVRfWFZZVTE2MTYxNjE2OworCWRlZmF1bHQ6CisJY2FzZSBQTEFORV9DVExfRk9STUFU
X1hSR0JfODg4ODoKKwkJaWYgKHJnYl9vcmRlcikgeworCQkJaWYgKGFscGhhKQorCQkJCXJldHVy
biBEUk1fRk9STUFUX0FCR1I4ODg4OworCQkJZWxzZQorCQkJCXJldHVybiBEUk1fRk9STUFUX1hC
R1I4ODg4OworCQl9IGVsc2UgeworCQkJaWYgKGFscGhhKQorCQkJCXJldHVybiBEUk1fRk9STUFU
X0FSR0I4ODg4OworCQkJZWxzZQorCQkJCXJldHVybiBEUk1fRk9STUFUX1hSR0I4ODg4OworCQl9
CisJY2FzZSBQTEFORV9DVExfRk9STUFUX1hSR0JfMjEwMTAxMDoKKwkJaWYgKHJnYl9vcmRlcikg
eworCQkJaWYgKGFscGhhKQorCQkJCXJldHVybiBEUk1fRk9STUFUX0FCR1IyMTAxMDEwOworCQkJ
ZWxzZQorCQkJCXJldHVybiBEUk1fRk9STUFUX1hCR1IyMTAxMDEwOworCQl9IGVsc2UgeworCQkJ
aWYgKGFscGhhKQorCQkJCXJldHVybiBEUk1fRk9STUFUX0FSR0IyMTAxMDEwOworCQkJZWxzZQor
CQkJCXJldHVybiBEUk1fRk9STUFUX1hSR0IyMTAxMDEwOworCQl9CisJY2FzZSBQTEFORV9DVExf
Rk9STUFUX1hSR0JfMTYxNjE2MTZGOgorCQlpZiAocmdiX29yZGVyKSB7CisJCQlpZiAoYWxwaGEp
CisJCQkJcmV0dXJuIERSTV9GT1JNQVRfQUJHUjE2MTYxNjE2RjsKKwkJCWVsc2UKKwkJCQlyZXR1
cm4gRFJNX0ZPUk1BVF9YQkdSMTYxNjE2MTZGOworCQl9IGVsc2UgeworCQkJaWYgKGFscGhhKQor
CQkJCXJldHVybiBEUk1fRk9STUFUX0FSR0IxNjE2MTYxNkY7CisJCQllbHNlCisJCQkJcmV0dXJu
IERSTV9GT1JNQVRfWFJHQjE2MTYxNjE2RjsKKwkJfQorCX0KK30KKworc3RhdGljIHU4IGljbF9u
djEyX3lfcGxhbmVfbWFzayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3sKKwlpZiAo
SVNfUk9DS0VUTEFLRShpOTE1KSkKKwkJcmV0dXJuIEJJVChQTEFORV9TUFJJVEUyKSB8IEJJVChQ
TEFORV9TUFJJVEUzKTsKKwllbHNlCisJCXJldHVybiBCSVQoUExBTkVfU1BSSVRFNCkgfCBCSVQo
UExBTkVfU1BSSVRFNSk7Cit9CisKK2Jvb2wgaWNsX2lzX252MTJfeV9wbGFuZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJCQkgZW51bSBwbGFuZV9pZCBwbGFuZV9pZCkKK3sK
KwlyZXR1cm4gSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSAmJgorCQlpY2xfbnYxMl95X3BsYW5l
X21hc2soZGV2X3ByaXYpICYgQklUKHBsYW5lX2lkKTsKK30KKworYm9vbCBpY2xfaXNfaGRyX3Bs
YW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwbGFuZV9pZCBwbGFu
ZV9pZCkKK3sKKwlyZXR1cm4gSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSAmJgorCQlpY2xfaGRy
X3BsYW5lX21hc2soKSAmIEJJVChwbGFuZV9pZCk7Cit9CisKK3N0YXRpYyB2b2lkCitza2xfcGxh
bmVfcmF0aW8oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCWNv
bnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCisJCXVuc2lnbmVkIGlu
dCAqbnVtLCB1bnNpZ25lZCBpbnQgKmRlbikKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lLT5kZXYpOworCWNvbnN0
IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOworCisJaWYg
KGZiLT5mb3JtYXQtPmNwcFswXSA9PSA4KSB7CisJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49
IDEwIHx8IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKSB7CisJCQkqbnVtID0gMTA7CisJCQkqZGVu
ID0gODsKKwkJfSBlbHNlIHsKKwkJCSpudW0gPSA5OworCQkJKmRlbiA9IDg7CisJCX0KKwl9IGVs
c2UgeworCQkqbnVtID0gMTsKKwkJKmRlbiA9IDE7CisJfQorfQorCitzdGF0aWMgaW50IHNrbF9w
bGFuZV9taW5fY2RjbGsoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUs
CisJCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkK
K3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lX3N0
YXRlLT51YXBpLnBsYW5lLT5kZXYpOworCXVuc2lnbmVkIGludCBudW0sIGRlbjsKKwl1bnNpZ25l
ZCBpbnQgcGl4ZWxfcmF0ZSA9IGludGVsX3BsYW5lX3BpeGVsX3JhdGUoY3J0Y19zdGF0ZSwgcGxh
bmVfc3RhdGUpOworCisJc2tsX3BsYW5lX3JhdGlvKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlLCAm
bnVtLCAmZGVuKTsKKworCS8qIHR3byBwaXhlbHMgcGVyIGNsb2NrIG9uIGdsaysgKi8KKwlpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkKKwkJ
ZGVuICo9IDI7CisKKwlyZXR1cm4gRElWX1JPVU5EX1VQKHBpeGVsX3JhdGUgKiBudW0sIGRlbik7
Cit9CisKK3N0YXRpYyBpbnQgc2tsX3BsYW5lX21heF93aWR0aChjb25zdCBzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiwKKwkJCSAgICAgICBpbnQgY29sb3JfcGxhbmUsCisJCQkgICAgICAgdW5z
aWduZWQgaW50IHJvdGF0aW9uKQoreworCWludCBjcHAgPSBmYi0+Zm9ybWF0LT5jcHBbY29sb3Jf
cGxhbmVdOworCisJc3dpdGNoIChmYi0+bW9kaWZpZXIpIHsKKwljYXNlIERSTV9GT1JNQVRfTU9E
X0xJTkVBUjoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9YX1RJTEVEOgorCQkvKgorCQkgKiBWYWxp
ZGF0ZWQgbGltaXQgaXMgNGssIGJ1dCBoYXMgNWsgc2hvdWxkCisJCSAqIHdvcmsgYXBhcnQgZnJv
bSB0aGUgZm9sbG93aW5nIGZlYXR1cmVzOgorCQkgKiAtIFl0aWxlIChhbHJlYWR5IGxpbWl0ZWQg
dG8gNGspCisJCSAqIC0gRlAxNiAoYWxyZWFkeSBsaW1pdGVkIHRvIDRrKQorCQkgKiAtIHJlbmRl
ciBjb21wcmVzc2lvbiAoYWxyZWFkeSBsaW1pdGVkIHRvIDRrKQorCQkgKiAtIEtWTVIgc3ByaXRl
IGFuZCBjdXJzb3IgKGRvbid0IGNhcmUpCisJCSAqIC0gaG9yaXpvbnRhbCBwYW5uaW5nIChUT0RP
IHZlcmlmeSB0aGlzKQorCQkgKiAtIHBpcGUgYW5kIHBsYW5lIHNjYWxpbmcgKFRPRE8gdmVyaWZ5
IHRoaXMpCisJCSAqLworCQlpZiAoY3BwID09IDgpCisJCQlyZXR1cm4gNDA5NjsKKwkJZWxzZQor
CQkJcmV0dXJuIDUxMjA7CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1M6CisJY2Fz
ZSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRURfQ0NTOgorCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lf
VElMRURfR0VOMTJfTUNfQ0NTOgorCQkvKiBGSVhNRSBBVVggcGxhbmU/ICovCisJY2FzZSBJOTE1
X0ZPUk1BVF9NT0RfWV9USUxFRDoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRDoKKwkJ
aWYgKGNwcCA9PSA4KQorCQkJcmV0dXJuIDIwNDg7CisJCWVsc2UKKwkJCXJldHVybiA0MDk2Owor
CWRlZmF1bHQ6CisJCU1JU1NJTkdfQ0FTRShmYi0+bW9kaWZpZXIpOworCQlyZXR1cm4gMjA0ODsK
Kwl9Cit9CisKK3N0YXRpYyBpbnQgZ2xrX3BsYW5lX21heF93aWR0aChjb25zdCBzdHJ1Y3QgZHJt
X2ZyYW1lYnVmZmVyICpmYiwKKwkJCSAgICAgICBpbnQgY29sb3JfcGxhbmUsCisJCQkgICAgICAg
dW5zaWduZWQgaW50IHJvdGF0aW9uKQoreworCWludCBjcHAgPSBmYi0+Zm9ybWF0LT5jcHBbY29s
b3JfcGxhbmVdOworCisJc3dpdGNoIChmYi0+bW9kaWZpZXIpIHsKKwljYXNlIERSTV9GT1JNQVRf
TU9EX0xJTkVBUjoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9YX1RJTEVEOgorCQlpZiAoY3BwID09
IDgpCisJCQlyZXR1cm4gNDA5NjsKKwkJZWxzZQorCQkJcmV0dXJuIDUxMjA7CisJY2FzZSBJOTE1
X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1M6CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRURf
Q0NTOgorCQkvKiBGSVhNRSBBVVggcGxhbmU/ICovCisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9U
SUxFRDoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRDoKKwkJaWYgKGNwcCA9PSA4KQor
CQkJcmV0dXJuIDIwNDg7CisJCWVsc2UKKwkJCXJldHVybiA1MTIwOworCWRlZmF1bHQ6CisJCU1J
U1NJTkdfQ0FTRShmYi0+bW9kaWZpZXIpOworCQlyZXR1cm4gMjA0ODsKKwl9Cit9CisKK3N0YXRp
YyBpbnQgaWNsX3BsYW5lX21pbl93aWR0aChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpm
YiwKKwkJCSAgICAgICBpbnQgY29sb3JfcGxhbmUsCisJCQkgICAgICAgdW5zaWduZWQgaW50IHJv
dGF0aW9uKQoreworCS8qIFdhXzE0MDExMjY0NjU3LCBXYV8xNDAxMTA1MDU2MzogZ2VuMTErICov
CisJc3dpdGNoIChmYi0+Zm9ybWF0LT5mb3JtYXQpIHsKKwljYXNlIERSTV9GT1JNQVRfQzg6CisJ
CXJldHVybiAxODsKKwljYXNlIERSTV9GT1JNQVRfUkdCNTY1OgorCQlyZXR1cm4gMTA7CisJY2Fz
ZSBEUk1fRk9STUFUX1hSR0I4ODg4OgorCWNhc2UgRFJNX0ZPUk1BVF9YQkdSODg4ODoKKwljYXNl
IERSTV9GT1JNQVRfQVJHQjg4ODg6CisJY2FzZSBEUk1fRk9STUFUX0FCR1I4ODg4OgorCWNhc2Ug
RFJNX0ZPUk1BVF9YUkdCMjEwMTAxMDoKKwljYXNlIERSTV9GT1JNQVRfWEJHUjIxMDEwMTA6CisJ
Y2FzZSBEUk1fRk9STUFUX0FSR0IyMTAxMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9BQkdSMjEwMTAx
MDoKKwljYXNlIERSTV9GT1JNQVRfWFZZVTIxMDEwMTA6CisJY2FzZSBEUk1fRk9STUFUX1kyMTI6
CisJY2FzZSBEUk1fRk9STUFUX1kyMTY6CisJCXJldHVybiA2OworCWNhc2UgRFJNX0ZPUk1BVF9O
VjEyOgorCQlyZXR1cm4gMjA7CisJY2FzZSBEUk1fRk9STUFUX1AwMTA6CisJY2FzZSBEUk1fRk9S
TUFUX1AwMTI6CisJY2FzZSBEUk1fRk9STUFUX1AwMTY6CisJCXJldHVybiAxMjsKKwljYXNlIERS
TV9GT1JNQVRfWFJHQjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RjoK
KwljYXNlIERSTV9GT1JNQVRfQVJHQjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfQUJHUjE2
MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfWFZZVTEyXzE2MTYxNjE2OgorCWNhc2UgRFJNX0ZP
Uk1BVF9YVllVMTYxNjE2MTY6CisJCXJldHVybiA0OworCWRlZmF1bHQ6CisJCXJldHVybiAxOwor
CX0KK30KKworc3RhdGljIGludCBpY2xfcGxhbmVfbWF4X3dpZHRoKGNvbnN0IHN0cnVjdCBkcm1f
ZnJhbWVidWZmZXIgKmZiLAorCQkJICAgICAgIGludCBjb2xvcl9wbGFuZSwKKwkJCSAgICAgICB1
bnNpZ25lZCBpbnQgcm90YXRpb24pCit7CisJcmV0dXJuIDUxMjA7Cit9CisKK3N0YXRpYyBpbnQg
c2tsX3BsYW5lX21heF9oZWlnaHQoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCisJ
CQkJaW50IGNvbG9yX3BsYW5lLAorCQkJCXVuc2lnbmVkIGludCByb3RhdGlvbikKK3sKKwlyZXR1
cm4gNDA5NjsKK30KKworc3RhdGljIGludCBpY2xfcGxhbmVfbWF4X2hlaWdodChjb25zdCBzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKKwkJCQlpbnQgY29sb3JfcGxhbmUsCisJCQkJdW5zaWdu
ZWQgaW50IHJvdGF0aW9uKQoreworCXJldHVybiA0MzIwOworfQorCitzdGF0aWMgdW5zaWduZWQg
aW50Citza2xfcGxhbmVfbWF4X3N0cmlkZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAorCQkg
ICAgIHUzMiBwaXhlbF9mb3JtYXQsIHU2NCBtb2RpZmllciwKKwkJICAgICB1bnNpZ25lZCBpbnQg
cm90YXRpb24pCit7CisJY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyAqaW5mbyA9IGRybV9m
b3JtYXRfaW5mbyhwaXhlbF9mb3JtYXQpOworCWludCBjcHAgPSBpbmZvLT5jcHBbMF07CisKKwkv
KgorCSAqICJUaGUgc3RyaWRlIGluIGJ5dGVzIG11c3Qgbm90IGV4Y2VlZCB0aGUKKwkgKiBvZiB0
aGUgc2l6ZSBvZiA4SyBwaXhlbHMgYW5kIDMySyBieXRlcy4iCisJICovCisJaWYgKGRybV9yb3Rh
dGlvbl85MF9vcl8yNzAocm90YXRpb24pKQorCQlyZXR1cm4gbWluKDgxOTIsIDMyNzY4IC8gY3Bw
KTsKKwllbHNlCisJCXJldHVybiBtaW4oODE5MiAqIGNwcCwgMzI3NjgpOworfQorCisvKgorICog
VGhlIGhhcmR3YXJlIHBoYXNlIDAuMCByZWZlcnMgdG8gdGhlIGNlbnRlciBvZiB0aGUgcGl4ZWwu
CisgKiBXZSB3YW50IHRvIHN0YXJ0IGZyb20gdGhlIHRvcC9sZWZ0IGVkZ2Ugd2hpY2ggaXMgcGhh
c2UKKyAqIC0wLjUuIFRoYXQgbWF0Y2hlcyBob3cgdGhlIGhhcmR3YXJlIGNhbGN1bGF0ZXMgdGhl
IHNjYWxpbmcKKyAqIGZhY3RvcnMgKGZyb20gdG9wLWxlZnQgb2YgdGhlIGZpcnN0IHBpeGVsIHRv
IGJvdHRvbS1yaWdodAorICogb2YgdGhlIGxhc3QgcGl4ZWwsIGFzIG9wcG9zZWQgdG8gdGhlIHBp
eGVsIGNlbnRlcnMpLgorICoKKyAqIEZvciA0OjI6MCBzdWJzYW1wbGVkIGNocm9tYSBwbGFuZXMg
d2Ugb2J2aW91c2x5IGhhdmUgdG8KKyAqIGFkanVzdCB0aGF0IHNvIHRoYXQgdGhlIGNocm9tYSBz
YW1wbGUgcG9zaXRpb24gbGFuZHMgaW4KKyAqIHRoZSByaWdodCBzcG90LgorICoKKyAqIE5vdGUg
dGhhdCBmb3IgcGFja2VkIFlDYkNyIDQ6MjoyIGZvcm1hdHMgdGhlcmUgaXMgbm8gd2F5IHRvCisg
KiBjb250cm9sIGNocm9tYSBzaXRpbmcuIFRoZSBoYXJkd2FyZSBzaW1wbHkgcmVwbGljYXRlcyB0
aGUKKyAqIGNocm9tYSBzYW1wbGVzIGZvciBib3RoIG9mIHRoZSBsdW1hIHNhbXBsZXMsIGFuZCB0
aHVzIHdlIGRvbid0CisgKiBhY3R1YWxseSBnZXQgdGhlIGV4cGVjdGVkIE1QRUcyIGNocm9tYSBz
aXRpbmcgY29udmVudGlvbiA6KAorICogVGhlIHNhbWUgYmVoYXZpb3VyIGlzIG9ic2VydmVkIG9u
IHByZS1TS0wgcGxhdGZvcm1zIGFzIHdlbGwuCisgKgorICogVGhlb3J5IGJlaGluZCB0aGUgZm9y
bXVsYSAobm90ZSB0aGF0IHdlIGlnbm9yZSBzdWItcGl4ZWwKKyAqIHNvdXJjZSBjb29yZGluYXRl
cyk6CisgKiBzID0gc291cmNlIHNhbXBsZSBwb3NpdGlvbgorICogZCA9IGRlc3RpbmF0aW9uIHNh
bXBsZSBwb3NpdGlvbgorICoKKyAqIERvd25zY2FsaW5nIDQ6MToKKyAqIC0wLjUKKyAqIHwgMC4w
CisgKiB8IHwgICAgIDEuNSAoaW5pdGlhbCBwaGFzZSkKKyAqIHwgfCAgICAgfAorICogdiB2ICAg
ICB2CisgKiB8IHMgfCBzIHwgcyB8IHMgfAorICogfCAgICAgICBkICAgICAgIHwKKyAqCisgKiBV
cHNjYWxpbmcgMTo0OgorICogLTAuNQorICogfCAtMC4zNzUgKGluaXRpYWwgcGhhc2UpCisgKiB8
IHwgICAgIDAuMAorICogfCB8ICAgICB8CisgKiB2IHYgICAgIHYKKyAqIHwgICAgICAgcyAgICAg
ICB8CisgKiB8IGQgfCBkIHwgZCB8IGQgfAorICovCitzdGF0aWMgdTE2IHNrbF9zY2FsZXJfY2Fs
Y19waGFzZShpbnQgc3ViLCBpbnQgc2NhbGUsIGJvb2wgY2hyb21hX2Nvc2l0ZWQpCit7CisJaW50
IHBoYXNlID0gLTB4ODAwMDsKKwl1MTYgdHJpcCA9IDA7CisKKwlpZiAoY2hyb21hX2Nvc2l0ZWQp
CisJCXBoYXNlICs9IChzdWIgLSAxKSAqIDB4ODAwMCAvIHN1YjsKKworCXBoYXNlICs9IHNjYWxl
IC8gKDIgKiBzdWIpOworCisJLyoKKwkgKiBIYXJkd2FyZSBpbml0aWFsIHBoYXNlIGxpbWl0ZWQg
dG8gWy0wLjU6MS41XS4KKwkgKiBTaW5jZSB0aGUgbWF4IGhhcmR3YXJlIHNjYWxlIGZhY3RvciBp
cyAzLjAsIHdlCisJICogc2hvdWxkIG5ldmVyIGFjdHVhbGx5IGV4Y2RlZWQgMS4wIGhlcmUuCisJ
ICovCisJV0FSTl9PTihwaGFzZSA8IC0weDgwMDAgfHwgcGhhc2UgPiAweDE4MDAwKTsKKworCWlm
IChwaGFzZSA8IDApCisJCXBoYXNlID0gMHgxMDAwMCArIHBoYXNlOworCWVsc2UKKwkJdHJpcCA9
IFBTX1BIQVNFX1RSSVA7CisKKwlyZXR1cm4gKChwaGFzZSA+PiAyKSAmIFBTX1BIQVNFX01BU0sp
IHwgdHJpcDsKK30KKworI2RlZmluZSBTS0xfTUlOX1NSQ19XIDgKKyNkZWZpbmUgU0tMX01BWF9T
UkNfVyA0MDk2CisjZGVmaW5lIFNLTF9NSU5fU1JDX0ggOAorI2RlZmluZSBTS0xfTUFYX1NSQ19I
IDQwOTYKKyNkZWZpbmUgU0tMX01JTl9EU1RfVyA4CisjZGVmaW5lIFNLTF9NQVhfRFNUX1cgNDA5
NgorI2RlZmluZSBTS0xfTUlOX0RTVF9IIDgKKyNkZWZpbmUgU0tMX01BWF9EU1RfSCA0MDk2Cisj
ZGVmaW5lIElDTF9NQVhfU1JDX1cgNTEyMAorI2RlZmluZSBJQ0xfTUFYX1NSQ19IIDQwOTYKKyNk
ZWZpbmUgSUNMX01BWF9EU1RfVyA1MTIwCisjZGVmaW5lIElDTF9NQVhfRFNUX0ggNDA5NgorI2Rl
ZmluZSBTS0xfTUlOX1lVVl80MjBfU1JDX1cgMTYKKyNkZWZpbmUgU0tMX01JTl9ZVVZfNDIwX1NS
Q19IIDE2CisKK3N0YXRpYyBpbnQKK3NrbF91cGRhdGVfc2NhbGVyKHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlLCBib29sIGZvcmNlX2RldGFjaCwKKwkJICB1bnNpZ25lZCBpbnQg
c2NhbGVyX3VzZXIsIGludCAqc2NhbGVyX2lkLAorCQkgIGludCBzcmNfdywgaW50IHNyY19oLCBp
bnQgZHN0X3csIGludCBkc3RfaCwKKwkJICBjb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICpm
b3JtYXQsCisJCSAgdTY0IG1vZGlmaWVyLCBib29sIG5lZWRfc2NhbGVyKQoreworCXN0cnVjdCBp
bnRlbF9jcnRjX3NjYWxlcl9zdGF0ZSAqc2NhbGVyX3N0YXRlID0KKwkJJmNydGNfc3RhdGUtPnNj
YWxlcl9zdGF0ZTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9CisJCXRvX2ludGVs
X2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGludGVsX2NydGMtPmJhc2UuZGV2KTsKKwljb25zdCBzdHJ1Y3Qg
ZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0ZWRfbW9kZSA9CisJCSZjcnRjX3N0YXRlLT5ody5hZGp1
c3RlZF9tb2RlOworCisJLyoKKwkgKiBTcmMgY29vcmRpbmF0ZXMgYXJlIGFscmVhZHkgcm90YXRl
ZCBieSAyNzAgZGVncmVlcyBmb3IKKwkgKiB0aGUgOTAvMjcwIGRlZ3JlZSBwbGFuZSByb3RhdGlv
biBjYXNlcyAodG8gbWF0Y2ggdGhlCisJICogR1RUIG1hcHBpbmcpLCBoZW5jZSBubyBuZWVkIHRv
IGFjY291bnQgZm9yIHJvdGF0aW9uIGhlcmUuCisJICovCisJaWYgKHNyY193ICE9IGRzdF93IHx8
IHNyY19oICE9IGRzdF9oKQorCQluZWVkX3NjYWxlciA9IHRydWU7CisKKwkvKgorCSAqIFNjYWxp
bmcvZml0dGluZyBub3Qgc3VwcG9ydGVkIGluIElGLUlEIG1vZGUgaW4gR0VOOSsKKwkgKiBUT0RP
OiBJbnRlcmxhY2UgZmV0Y2ggbW9kZSBkb2Vzbid0IHN1cHBvcnQgWVVWNDIwIHBsYW5hciBmb3Jt
YXRzLgorCSAqIE9uY2UgTlYxMiBpcyBlbmFibGVkLCBoYW5kbGUgaXQgaGVyZSB3aGlsZSBhbGxv
Y2F0aW5nIHNjYWxlcgorCSAqIGZvciBOVjEyLgorCSAqLworCWlmIChJTlRFTF9HRU4oZGV2X3By
aXYpID49IDkgJiYgY3J0Y19zdGF0ZS0+aHcuZW5hYmxlICYmCisJICAgIG5lZWRfc2NhbGVyICYm
IGFkanVzdGVkX21vZGUtPmZsYWdzICYgRFJNX01PREVfRkxBR19JTlRFUkxBQ0UpIHsKKwkJZHJt
X2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCQkgICAgIlBpcGUvUGxhbmUgc2NhbGluZyBub3Qg
c3VwcG9ydGVkIHdpdGggSUYtSUQgbW9kZVxuIik7CisJCXJldHVybiAtRUlOVkFMOworCX0KKwor
CS8qCisJICogaWYgcGxhbmUgaXMgYmVpbmcgZGlzYWJsZWQgb3Igc2NhbGVyIGlzIG5vIG1vcmUg
cmVxdWlyZWQgb3IgZm9yY2UgZGV0YWNoCisJICogIC0gZnJlZSBzY2FsZXIgYmluZGVkIHRvIHRo
aXMgcGxhbmUvY3J0YworCSAqICAtIGluIG9yZGVyIHRvIGRvIHRoaXMsIHVwZGF0ZSBjcnRjLT5z
Y2FsZXJfdXNhZ2UKKwkgKgorCSAqIEhlcmUgc2NhbGVyIHN0YXRlIGluIGNydGNfc3RhdGUgaXMg
c2V0IGZyZWUgc28gdGhhdAorCSAqIHNjYWxlciBjYW4gYmUgYXNzaWduZWQgdG8gb3RoZXIgdXNl
ci4gQWN0dWFsIHJlZ2lzdGVyCisJICogdXBkYXRlIHRvIGZyZWUgdGhlIHNjYWxlciBpcyBkb25l
IGluIHBsYW5lL3BhbmVsLWZpdCBwcm9ncmFtbWluZy4KKwkgKiBGb3IgdGhpcyBwdXJwb3NlIGNy
dGMvcGxhbmVfc3RhdGUtPnNjYWxlcl9pZCBpc24ndCByZXNldCBoZXJlLgorCSAqLworCWlmIChm
b3JjZV9kZXRhY2ggfHwgIW5lZWRfc2NhbGVyKSB7CisJCWlmICgqc2NhbGVyX2lkID49IDApIHsK
KwkJCXNjYWxlcl9zdGF0ZS0+c2NhbGVyX3VzZXJzICY9IH4oMSA8PCBzY2FsZXJfdXNlcik7CisJ
CQlzY2FsZXJfc3RhdGUtPnNjYWxlcnNbKnNjYWxlcl9pZF0uaW5fdXNlID0gMDsKKworCQkJZHJt
X2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCQkJICAgICJzY2FsZXJfdXNlciBpbmRleCAldS4l
dTogIgorCQkJCSAgICAiU3RhZ2VkIGZyZWVpbmcgc2NhbGVyIGlkICVkIHNjYWxlcl91c2VycyA9
IDB4JXhcbiIsCisJCQkJICAgIGludGVsX2NydGMtPnBpcGUsIHNjYWxlcl91c2VyLCAqc2NhbGVy
X2lkLAorCQkJCSAgICBzY2FsZXJfc3RhdGUtPnNjYWxlcl91c2Vycyk7CisJCQkqc2NhbGVyX2lk
ID0gLTE7CisJCX0KKwkJcmV0dXJuIDA7CisJfQorCisJaWYgKGZvcm1hdCAmJiBpbnRlbF9mb3Jt
YXRfaW5mb19pc195dXZfc2VtaXBsYW5hcihmb3JtYXQsIG1vZGlmaWVyKSAmJgorCSAgICAoc3Jj
X2ggPCBTS0xfTUlOX1lVVl80MjBfU1JDX0ggfHwgc3JjX3cgPCBTS0xfTUlOX1lVVl80MjBfU1JD
X1cpKSB7CisJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJICAgICJQbGFuYXIgWVVW
OiBzcmMgZGltZW5zaW9ucyBub3QgbWV0XG4iKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJ
LyogcmFuZ2UgY2hlY2tzICovCisJaWYgKHNyY193IDwgU0tMX01JTl9TUkNfVyB8fCBzcmNfaCA8
IFNLTF9NSU5fU1JDX0ggfHwKKwkgICAgZHN0X3cgPCBTS0xfTUlOX0RTVF9XIHx8IGRzdF9oIDwg
U0tMX01JTl9EU1RfSCB8fAorCSAgICAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSAmJgorCSAg
ICAgKHNyY193ID4gSUNMX01BWF9TUkNfVyB8fCBzcmNfaCA+IElDTF9NQVhfU1JDX0ggfHwKKwkg
ICAgICBkc3RfdyA+IElDTF9NQVhfRFNUX1cgfHwgZHN0X2ggPiBJQ0xfTUFYX0RTVF9IKSkgfHwK
KwkgICAgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMSAmJgorCSAgICAgKHNyY193ID4gU0tMX01B
WF9TUkNfVyB8fCBzcmNfaCA+IFNLTF9NQVhfU1JDX0ggfHwKKwkgICAgICBkc3RfdyA+IFNLTF9N
QVhfRFNUX1cgfHwgZHN0X2ggPiBTS0xfTUFYX0RTVF9IKSkpCXsKKwkJZHJtX2RiZ19rbXMoJmRl
dl9wcml2LT5kcm0sCisJCQkgICAgInNjYWxlcl91c2VyIGluZGV4ICV1LiV1OiBzcmMgJXV4JXUg
ZHN0ICV1eCV1ICIKKwkJCSAgICAic2l6ZSBpcyBvdXQgb2Ygc2NhbGVyIHJhbmdlXG4iLAorCQkJ
ICAgIGludGVsX2NydGMtPnBpcGUsIHNjYWxlcl91c2VyLCBzcmNfdywgc3JjX2gsCisJCQkgICAg
ZHN0X3csIGRzdF9oKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJLyogbWFyayB0aGlzIHBs
YW5lIGFzIGEgc2NhbGVyIHVzZXIgaW4gY3J0Y19zdGF0ZSAqLworCXNjYWxlcl9zdGF0ZS0+c2Nh
bGVyX3VzZXJzIHw9ICgxIDw8IHNjYWxlcl91c2VyKTsKKwlkcm1fZGJnX2ttcygmZGV2X3ByaXYt
PmRybSwgInNjYWxlcl91c2VyIGluZGV4ICV1LiV1OiAiCisJCSAgICAic3RhZ2VkIHNjYWxpbmcg
cmVxdWVzdCBmb3IgJXV4JXUtPiV1eCV1IHNjYWxlcl91c2VycyA9IDB4JXhcbiIsCisJCSAgICBp
bnRlbF9jcnRjLT5waXBlLCBzY2FsZXJfdXNlciwgc3JjX3csIHNyY19oLCBkc3RfdywgZHN0X2gs
CisJCSAgICBzY2FsZXJfc3RhdGUtPnNjYWxlcl91c2Vycyk7CisKKwlyZXR1cm4gMDsKK30KKwor
aW50IHNrbF91cGRhdGVfc2NhbGVyX2NydGMoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCit7CisJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21vZGUgKnBpcGVfbW9kZSA9ICZj
cnRjX3N0YXRlLT5ody5waXBlX21vZGU7CisJaW50IHdpZHRoLCBoZWlnaHQ7CisKKwlpZiAoY3J0
Y19zdGF0ZS0+cGNoX3BmaXQuZW5hYmxlZCkgeworCQl3aWR0aCA9IGRybV9yZWN0X3dpZHRoKCZj
cnRjX3N0YXRlLT5wY2hfcGZpdC5kc3QpOworCQloZWlnaHQgPSBkcm1fcmVjdF9oZWlnaHQoJmNy
dGNfc3RhdGUtPnBjaF9wZml0LmRzdCk7CisJfSBlbHNlIHsKKwkJd2lkdGggPSBwaXBlX21vZGUt
PmNydGNfaGRpc3BsYXk7CisJCWhlaWdodCA9IHBpcGVfbW9kZS0+Y3J0Y192ZGlzcGxheTsKKwl9
CisJcmV0dXJuIHNrbF91cGRhdGVfc2NhbGVyKGNydGNfc3RhdGUsICFjcnRjX3N0YXRlLT5ody5h
Y3RpdmUsCisJCQkJIFNLTF9DUlRDX0lOREVYLAorCQkJCSAmY3J0Y19zdGF0ZS0+c2NhbGVyX3N0
YXRlLnNjYWxlcl9pZCwKKwkJCQkgY3J0Y19zdGF0ZS0+cGlwZV9zcmNfdywgY3J0Y19zdGF0ZS0+
cGlwZV9zcmNfaCwKKwkJCQkgd2lkdGgsIGhlaWdodCwgTlVMTCwgMCwKKwkJCQkgY3J0Y19zdGF0
ZS0+cGNoX3BmaXQuZW5hYmxlZCk7Cit9CisKKy8qKgorICogc2tsX3VwZGF0ZV9zY2FsZXJfcGxh
bmUgLSBTdGFnZXMgdXBkYXRlIHRvIHNjYWxlciBzdGF0ZSBmb3IgYSBnaXZlbiBwbGFuZS4KKyAq
IEBjcnRjX3N0YXRlOiBjcnRjJ3Mgc2NhbGVyIHN0YXRlCisgKiBAcGxhbmVfc3RhdGU6IGF0b21p
YyBwbGFuZSBzdGF0ZSB0byB1cGRhdGUKKyAqCisgKiBSZXR1cm4KKyAqICAgICAwIC0gc2NhbGVy
X3VzYWdlIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5CisgKiAgICBlcnJvciAtIHJlcXVlc3RlZCBzY2Fs
aW5nIGNhbm5vdCBiZSBzdXBwb3J0ZWQgb3Igb3RoZXIgZXJyb3IgY29uZGl0aW9uCisgKi8KK2lu
dCBza2xfdXBkYXRlX3NjYWxlcl9wbGFuZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSwKKwkJCSAgICBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQorewor
CXN0cnVjdCBpbnRlbF9wbGFuZSAqaW50ZWxfcGxhbmUgPQorCQl0b19pbnRlbF9wbGFuZShwbGFu
ZV9zdGF0ZS0+dWFwaS5wbGFuZSk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdG9faTkxNShpbnRlbF9wbGFuZS0+YmFzZS5kZXYpOworCXN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOworCWludCByZXQ7CisJYm9vbCBmb3JjZV9kZXRh
Y2ggPSAhZmIgfHwgIXBsYW5lX3N0YXRlLT51YXBpLnZpc2libGU7CisJYm9vbCBuZWVkX3NjYWxl
ciA9IGZhbHNlOworCisJLyogUHJlLWdlbjExIGFuZCBTRFIgcGxhbmVzIGFsd2F5cyBuZWVkIGEg
c2NhbGVyIGZvciBwbGFuYXIgZm9ybWF0cy4gKi8KKwlpZiAoIWljbF9pc19oZHJfcGxhbmUoZGV2
X3ByaXYsIGludGVsX3BsYW5lLT5pZCkgJiYKKwkgICAgZmIgJiYgaW50ZWxfZm9ybWF0X2luZm9f
aXNfeXV2X3NlbWlwbGFuYXIoZmItPmZvcm1hdCwgZmItPm1vZGlmaWVyKSkKKwkJbmVlZF9zY2Fs
ZXIgPSB0cnVlOworCisJcmV0ID0gc2tsX3VwZGF0ZV9zY2FsZXIoY3J0Y19zdGF0ZSwgZm9yY2Vf
ZGV0YWNoLAorCQkJCWRybV9wbGFuZV9pbmRleCgmaW50ZWxfcGxhbmUtPmJhc2UpLAorCQkJCSZw
bGFuZV9zdGF0ZS0+c2NhbGVyX2lkLAorCQkJCWRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+
dWFwaS5zcmMpID4+IDE2LAorCQkJCWRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPnVhcGku
c3JjKSA+PiAxNiwKKwkJCQlkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KSwK
KwkJCQlkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCksCisJCQkJZmIgPyBm
Yi0+Zm9ybWF0IDogTlVMTCwKKwkJCQlmYiA/IGZiLT5tb2RpZmllciA6IDAsCisJCQkJbmVlZF9z
Y2FsZXIpOworCisJaWYgKHJldCB8fCBwbGFuZV9zdGF0ZS0+c2NhbGVyX2lkIDwgMCkKKwkJcmV0
dXJuIHJldDsKKworCS8qIGNoZWNrIGNvbG9ya2V5ICovCisJaWYgKHBsYW5lX3N0YXRlLT5ja2V5
LmZsYWdzKSB7CisJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJICAgICJbUExBTkU6
JWQ6JXNdIHNjYWxpbmcgd2l0aCBjb2xvciBrZXkgbm90IGFsbG93ZWQiLAorCQkJICAgIGludGVs
X3BsYW5lLT5iYXNlLmJhc2UuaWQsCisJCQkgICAgaW50ZWxfcGxhbmUtPmJhc2UubmFtZSk7CisJ
CXJldHVybiAtRUlOVkFMOworCX0KKworCS8qIENoZWNrIHNyYyBmb3JtYXQgKi8KKwlzd2l0Y2gg
KGZiLT5mb3JtYXQtPmZvcm1hdCkgeworCWNhc2UgRFJNX0ZPUk1BVF9SR0I1NjU6CisJY2FzZSBE
Uk1fRk9STUFUX1hCR1I4ODg4OgorCWNhc2UgRFJNX0ZPUk1BVF9YUkdCODg4ODoKKwljYXNlIERS
TV9GT1JNQVRfQUJHUjg4ODg6CisJY2FzZSBEUk1fRk9STUFUX0FSR0I4ODg4OgorCWNhc2UgRFJN
X0ZPUk1BVF9YUkdCMjEwMTAxMDoKKwljYXNlIERSTV9GT1JNQVRfWEJHUjIxMDEwMTA6CisJY2Fz
ZSBEUk1fRk9STUFUX0FSR0IyMTAxMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9BQkdSMjEwMTAxMDoK
KwljYXNlIERSTV9GT1JNQVRfWVVZVjoKKwljYXNlIERSTV9GT1JNQVRfWVZZVToKKwljYXNlIERS
TV9GT1JNQVRfVVlWWToKKwljYXNlIERSTV9GT1JNQVRfVllVWToKKwljYXNlIERSTV9GT1JNQVRf
TlYxMjoKKwljYXNlIERSTV9GT1JNQVRfWFlVVjg4ODg6CisJY2FzZSBEUk1fRk9STUFUX1AwMTA6
CisJY2FzZSBEUk1fRk9STUFUX1AwMTI6CisJY2FzZSBEUk1fRk9STUFUX1AwMTY6CisJY2FzZSBE
Uk1fRk9STUFUX1kyMTA6CisJY2FzZSBEUk1fRk9STUFUX1kyMTI6CisJY2FzZSBEUk1fRk9STUFU
X1kyMTY6CisJY2FzZSBEUk1fRk9STUFUX1hWWVUyMTAxMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9Y
VllVMTJfMTYxNjE2MTY6CisJY2FzZSBEUk1fRk9STUFUX1hWWVUxNjE2MTYxNjoKKwkJYnJlYWs7
CisJY2FzZSBEUk1fRk9STUFUX1hCR1IxNjE2MTYxNkY6CisJY2FzZSBEUk1fRk9STUFUX0FCR1Ix
NjE2MTYxNkY6CisJY2FzZSBEUk1fRk9STUFUX1hSR0IxNjE2MTYxNkY6CisJY2FzZSBEUk1fRk9S
TUFUX0FSR0IxNjE2MTYxNkY6CisJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQorCQkJ
YnJlYWs7CisJCWZhbGx0aHJvdWdoOworCWRlZmF1bHQ6CisJCWRybV9kYmdfa21zKCZkZXZfcHJp
di0+ZHJtLAorCQkJICAgICJbUExBTkU6JWQ6JXNdIEZCOiVkIHVuc3VwcG9ydGVkIHNjYWxpbmcg
Zm9ybWF0IDB4JXhcbiIsCisJCQkgICAgaW50ZWxfcGxhbmUtPmJhc2UuYmFzZS5pZCwgaW50ZWxf
cGxhbmUtPmJhc2UubmFtZSwKKwkJCSAgICBmYi0+YmFzZS5pZCwgZmItPmZvcm1hdC0+Zm9ybWF0
KTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQg
Y25sX2NvZWZfdGFwKGludCBpKQoreworCXJldHVybiBpICUgNzsKK30KKworc3RhdGljIHUxNiBj
bmxfbmVhcmVzdF9maWx0ZXJfY29lZihpbnQgdCkKK3sKKwlyZXR1cm4gdCA9PSAzID8gMHgwODAw
IDogMHgzMDAwOworfQorCisvKgorICogIFRoZW9yeSBiZWhpbmQgc2V0dGluZyBuZWFyZXN0LW5l
aWdoYm9yIGludGVnZXIgc2NhbGluZzoKKyAqCisgKiAgMTcgcGhhc2Ugb2YgNyB0YXBzIHJlcXVp
cmVzIDExOSBjb2VmZmljaWVudHMgaW4gNjAgZHdvcmRzIHBlciBzZXQuCisgKiAgVGhlIGxldHRl
ciByZXByZXNlbnRzIHRoZSBmaWx0ZXIgdGFwIChEIGlzIHRoZSBjZW50ZXIgdGFwKSBhbmQgdGhl
IG51bWJlcgorICogIHJlcHJlc2VudHMgdGhlIGNvZWZmaWNpZW50IHNldCBmb3IgYSBwaGFzZSAo
MC0xNikuCisgKgorICogICAgICAgICArLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLSstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rCisgKiAgICAgICAgIHxJbmRleCB2YWx1ZSB8
IERhdGEgdmFsdWUgY29lZmZpZW50IDEgfCBEYXRhIHZhbHVlIGNvZWZmaWVudCAyIHwKKyAqICAg
ICAgICAgKy0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tKworICogICAgICAgICB8ICAgMDBoICAgICAgfCAgICAgICAgICBCMCAgICAg
ICAgICAgIHwgICAgICAgICAgQTAgICAgICAgICAgICB8CisgKiAgICAgICAgICstLS0tLS0tLS0t
LS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSsKKyAq
ICAgICAgICAgfCAgIDAxaCAgICAgIHwgICAgICAgICAgRDAgICAgICAgICAgICB8ICAgICAgICAg
IEMwICAgICAgICAgICAgfAorICogICAgICAgICArLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rCisgKiAgICAgICAgIHwgICAwMmgg
ICAgICB8ICAgICAgICAgIEYwICAgICAgICAgICAgfCAgICAgICAgICBFMCAgICAgICAgICAgIHwK
KyAqICAgICAgICAgKy0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tKworICogICAgICAgICB8ICAgMDNoICAgICAgfCAgICAgICAgICBB
MSAgICAgICAgICAgIHwgICAgICAgICAgRzAgICAgICAgICAgICB8CisgKiAgICAgICAgICstLS0t
LS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LSsKKyAqICAgICAgICAgfCAgIDA0aCAgICAgIHwgICAgICAgICAgQzEgICAgICAgICAgICB8ICAg
ICAgICAgIEIxICAgICAgICAgICAgfAorICogICAgICAgICArLS0tLS0tLS0tLS0tKy0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rCisgKiAgICAgICAgIHwg
ICAuLi4gICAgICB8ICAgICAgICAgIC4uLiAgICAgICAgICAgfCAgICAgICAgICAuLi4gICAgICAg
ICAgIHwKKyAqICAgICAgICAgKy0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0r
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKworICogICAgICAgICB8ICAgMzhoICAgICAgfCAgICAg
ICAgICBCMTYgICAgICAgICAgIHwgICAgICAgICAgQTE2ICAgICAgICAgICB8CisgKiAgICAgICAg
ICstLS0tLS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLSsKKyAqICAgICAgICAgfCAgIDM5aCAgICAgIHwgICAgICAgICAgRDE2ICAgICAgICAg
ICB8ICAgICAgICAgIEMxNiAgICAgICAgICAgfAorICogICAgICAgICArLS0tLS0tLS0tLS0tKy0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rCisgKiAgICAg
ICAgIHwgICAzQWggICAgICB8ICAgICAgICAgIEYxNiAgICAgICAgICAgfCAgICAgICAgICBDMTYg
ICAgICAgICAgIHwKKyAqICAgICAgICAgKy0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKworICogICAgICAgICB8ICAgM0JoICAgICAg
fCAgICAgICAgUmVzZXJ2ZWQgICAgICAgIHwgICAgICAgICAgRzE2ICAgICAgICAgICB8CisgKiAg
ICAgICAgICstLS0tLS0tLS0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKy0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLSsKKyAqCisgKiAgVG8gZW5hYmxlIG5lYXJlc3QtbmVpZ2hib3Igc2NhbGlu
ZzogIHByb2dyYW0gc2NhbGVyIGNvZWZmaWNlbnRzIHdpdGgKKyAqICB0aGUgY2VudGVyIHRhcCAo
RHh4KSB2YWx1ZXMgc2V0IHRvIDEgYW5kIGFsbCBvdGhlciB2YWx1ZXMgc2V0IHRvIDAgYXMgcGVy
CisgKiAgU0NBTEVSX0NPRUZGSUNJRU5UX0ZPUk1BVAorICoKKyAqLworCitzdGF0aWMgdm9pZCBj
bmxfcHJvZ3JhbV9uZWFyZXN0X2ZpbHRlcl9jb2VmcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCisJCQkJCSAgICAgZW51bSBwaXBlIHBpcGUsIGludCBpZCwgaW50IHNldCkKK3sK
KwlpbnQgaTsKKworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBDTkxfUFNfQ09FRl9JTkRF
WF9TRVQocGlwZSwgaWQsIHNldCksCisJCQkgIFBTX0NPRUVfSU5ERVhfQVVUT19JTkMpOworCisJ
Zm9yIChpID0gMDsgaSA8IDE3ICogNzsgaSArPSAyKSB7CisJCXUzMiB0bXA7CisJCWludCB0Owor
CisJCXQgPSBjbmxfY29lZl90YXAoaSk7CisJCXRtcCA9IGNubF9uZWFyZXN0X2ZpbHRlcl9jb2Vm
KHQpOworCisJCXQgPSBjbmxfY29lZl90YXAoaSArIDEpOworCQl0bXAgfD0gY25sX25lYXJlc3Rf
ZmlsdGVyX2NvZWYodCkgPDwgMTY7CisKKwkJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIENO
TF9QU19DT0VGX0RBVEFfU0VUKHBpcGUsIGlkLCBzZXQpLAorCQkJCSAgdG1wKTsKKwl9CisKKwlp
bnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgQ05MX1BTX0NPRUZfSU5ERVhfU0VUKHBpcGUsIGlk
LCBzZXQpLCAwKTsKK30KKworc3RhdGljIGlubGluZSB1MzIgc2tsX3NjYWxlcl9nZXRfZmlsdGVy
X3NlbGVjdChlbnVtIGRybV9zY2FsaW5nX2ZpbHRlciBmaWx0ZXIsIGludCBzZXQpCit7CisJaWYg
KGZpbHRlciA9PSBEUk1fU0NBTElOR19GSUxURVJfTkVBUkVTVF9ORUlHSEJPUikgeworCQlyZXR1
cm4gKFBTX0ZJTFRFUl9QUk9HUkFNTUVEIHwKKwkJCVBTX1lfVkVSVF9GSUxURVJfU0VMRUNUKHNl
dCkgfAorCQkJUFNfWV9IT1JaX0ZJTFRFUl9TRUxFQ1Qoc2V0KSB8CisJCQlQU19VVl9WRVJUX0ZJ
TFRFUl9TRUxFQ1Qoc2V0KSB8CisJCQlQU19VVl9IT1JaX0ZJTFRFUl9TRUxFQ1Qoc2V0KSk7CisJ
fQorCisJcmV0dXJuIFBTX0ZJTFRFUl9NRURJVU07Cit9CisKK3N0YXRpYyB2b2lkIHNrbF9zY2Fs
ZXJfc2V0dXBfZmlsdGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBw
aXBlIHBpcGUsCisJCQkJICAgIGludCBpZCwgaW50IHNldCwgZW51bSBkcm1fc2NhbGluZ19maWx0
ZXIgZmlsdGVyKQoreworCXN3aXRjaCAoZmlsdGVyKSB7CisJY2FzZSBEUk1fU0NBTElOR19GSUxU
RVJfREVGQVVMVDoKKwkJYnJlYWs7CisJY2FzZSBEUk1fU0NBTElOR19GSUxURVJfTkVBUkVTVF9O
RUlHSEJPUjoKKwkJY25sX3Byb2dyYW1fbmVhcmVzdF9maWx0ZXJfY29lZnMoZGV2X3ByaXYsIHBp
cGUsIGlkLCBzZXQpOworCQlicmVhazsKKwlkZWZhdWx0OgorCQlNSVNTSU5HX0NBU0UoZmlsdGVy
KTsKKwl9Cit9CisKK3ZvaWQgc2tsX3BmaXRfZW5hYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKQoreworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50
ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCWNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3NjYWxlcl9zdGF0ZSAqc2NhbGVyX3N0YXRlID0KKwkJJmNydGNfc3RhdGUtPnNjYWxl
cl9zdGF0ZTsKKwlzdHJ1Y3QgZHJtX3JlY3Qgc3JjID0geworCQkueDIgPSBjcnRjX3N0YXRlLT5w
aXBlX3NyY193IDw8IDE2LAorCQkueTIgPSBjcnRjX3N0YXRlLT5waXBlX3NyY19oIDw8IDE2LAor
CX07CisJY29uc3Qgc3RydWN0IGRybV9yZWN0ICpkc3QgPSAmY3J0Y19zdGF0ZS0+cGNoX3BmaXQu
ZHN0OworCXUxNiB1dl9yZ2JfaHBoYXNlLCB1dl9yZ2JfdnBoYXNlOworCWVudW0gcGlwZSBwaXBl
ID0gY3J0Yy0+cGlwZTsKKwlpbnQgd2lkdGggPSBkcm1fcmVjdF93aWR0aChkc3QpOworCWludCBo
ZWlnaHQgPSBkcm1fcmVjdF9oZWlnaHQoZHN0KTsKKwlpbnQgeCA9IGRzdC0+eDE7CisJaW50IHkg
PSBkc3QtPnkxOworCWludCBoc2NhbGUsIHZzY2FsZTsKKwl1bnNpZ25lZCBsb25nIGlycWZsYWdz
OworCWludCBpZDsKKwl1MzIgcHNfY3RybDsKKworCWlmICghY3J0Y19zdGF0ZS0+cGNoX3BmaXQu
ZW5hYmxlZCkKKwkJcmV0dXJuOworCisJaWYgKGRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLAor
CQkJY3J0Y19zdGF0ZS0+c2NhbGVyX3N0YXRlLnNjYWxlcl9pZCA8IDApKQorCQlyZXR1cm47CisK
Kwloc2NhbGUgPSBkcm1fcmVjdF9jYWxjX2hzY2FsZSgmc3JjLCBkc3QsIDAsIElOVF9NQVgpOwor
CXZzY2FsZSA9IGRybV9yZWN0X2NhbGNfdnNjYWxlKCZzcmMsIGRzdCwgMCwgSU5UX01BWCk7CisK
Kwl1dl9yZ2JfaHBoYXNlID0gc2tsX3NjYWxlcl9jYWxjX3BoYXNlKDEsIGhzY2FsZSwgZmFsc2Up
OworCXV2X3JnYl92cGhhc2UgPSBza2xfc2NhbGVyX2NhbGNfcGhhc2UoMSwgdnNjYWxlLCBmYWxz
ZSk7CisKKwlpZCA9IHNjYWxlcl9zdGF0ZS0+c2NhbGVyX2lkOworCisJcHNfY3RybCA9IHNrbF9z
Y2FsZXJfZ2V0X2ZpbHRlcl9zZWxlY3QoY3J0Y19zdGF0ZS0+aHcuc2NhbGluZ19maWx0ZXIsIDAp
OworCXBzX2N0cmwgfD0gIFBTX1NDQUxFUl9FTiB8IHNjYWxlcl9zdGF0ZS0+c2NhbGVyc1tpZF0u
bW9kZTsKKworCXNwaW5fbG9ja19pcnFzYXZlKCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZs
YWdzKTsKKworCXNrbF9zY2FsZXJfc2V0dXBfZmlsdGVyKGRldl9wcml2LCBwaXBlLCBpZCwgMCwK
KwkJCQljcnRjX3N0YXRlLT5ody5zY2FsaW5nX2ZpbHRlcik7CisKKwlpbnRlbF9kZV93cml0ZV9m
dyhkZXZfcHJpdiwgU0tMX1BTX0NUUkwocGlwZSwgaWQpLCBwc19jdHJsKTsKKworCWludGVsX2Rl
X3dyaXRlX2Z3KGRldl9wcml2LCBTS0xfUFNfVlBIQVNFKHBpcGUsIGlkKSwKKwkJCSAgUFNfWV9Q
SEFTRSgwKSB8IFBTX1VWX1JHQl9QSEFTRSh1dl9yZ2JfdnBoYXNlKSk7CisJaW50ZWxfZGVfd3Jp
dGVfZncoZGV2X3ByaXYsIFNLTF9QU19IUEhBU0UocGlwZSwgaWQpLAorCQkJICBQU19ZX1BIQVNF
KDApIHwgUFNfVVZfUkdCX1BIQVNFKHV2X3JnYl9ocGhhc2UpKTsKKwlpbnRlbF9kZV93cml0ZV9m
dyhkZXZfcHJpdiwgU0tMX1BTX1dJTl9QT1MocGlwZSwgaWQpLAorCQkJICB4IDw8IDE2IHwgeSk7
CisJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFNLTF9QU19XSU5fU1oocGlwZSwgaWQpLAor
CQkJICB3aWR0aCA8PCAxNiB8IGhlaWdodCk7CisKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZk
ZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsKK30KKworc3RhdGljIHZvaWQKK3NrbF9w
cm9ncmFtX3NjYWxlcihzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAorCQkgICBjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJICAgY29uc3Qgc3RydWN0IGludGVs
X3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CisJY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CisJZW51bSBwaXBlIHBpcGUgPSBw
bGFuZS0+cGlwZTsKKwlpbnQgc2NhbGVyX2lkID0gcGxhbmVfc3RhdGUtPnNjYWxlcl9pZDsKKwlj
b25zdCBzdHJ1Y3QgaW50ZWxfc2NhbGVyICpzY2FsZXIgPQorCQkmY3J0Y19zdGF0ZS0+c2NhbGVy
X3N0YXRlLnNjYWxlcnNbc2NhbGVyX2lkXTsKKwlpbnQgY3J0Y194ID0gcGxhbmVfc3RhdGUtPnVh
cGkuZHN0LngxOworCWludCBjcnRjX3kgPSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3QueTE7CisJdTMy
IGNydGNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QpOworCXUzMiBj
cnRjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLmRzdCk7CisJdTE2IHlf
aHBoYXNlLCB1dl9yZ2JfaHBoYXNlOworCXUxNiB5X3ZwaGFzZSwgdXZfcmdiX3ZwaGFzZTsKKwlp
bnQgaHNjYWxlLCB2c2NhbGU7CisJdTMyIHBzX2N0cmw7CisKKwloc2NhbGUgPSBkcm1fcmVjdF9j
YWxjX2hzY2FsZSgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjLAorCQkJCSAgICAgICZwbGFuZV9zdGF0
ZS0+dWFwaS5kc3QsCisJCQkJICAgICAgMCwgSU5UX01BWCk7CisJdnNjYWxlID0gZHJtX3JlY3Rf
Y2FsY192c2NhbGUoJnBsYW5lX3N0YXRlLT51YXBpLnNyYywKKwkJCQkgICAgICAmcGxhbmVfc3Rh
dGUtPnVhcGkuZHN0LAorCQkJCSAgICAgIDAsIElOVF9NQVgpOworCisJLyogVE9ETzogaGFuZGxl
IHN1Yi1waXhlbCBjb29yZGluYXRlcyAqLworCWlmIChpbnRlbF9mb3JtYXRfaW5mb19pc195dXZf
c2VtaXBsYW5hcihmYi0+Zm9ybWF0LCBmYi0+bW9kaWZpZXIpICYmCisJICAgICFpY2xfaXNfaGRy
X3BsYW5lKGRldl9wcml2LCBwbGFuZS0+aWQpKSB7CisJCXlfaHBoYXNlID0gc2tsX3NjYWxlcl9j
YWxjX3BoYXNlKDEsIGhzY2FsZSwgZmFsc2UpOworCQl5X3ZwaGFzZSA9IHNrbF9zY2FsZXJfY2Fs
Y19waGFzZSgxLCB2c2NhbGUsIGZhbHNlKTsKKworCQkvKiBNUEVHMiBjaHJvbWEgc2l0aW5nIGNv
bnZlbnRpb24gKi8KKwkJdXZfcmdiX2hwaGFzZSA9IHNrbF9zY2FsZXJfY2FsY19waGFzZSgyLCBo
c2NhbGUsIHRydWUpOworCQl1dl9yZ2JfdnBoYXNlID0gc2tsX3NjYWxlcl9jYWxjX3BoYXNlKDIs
IHZzY2FsZSwgZmFsc2UpOworCX0gZWxzZSB7CisJCS8qIG5vdCB1c2VkICovCisJCXlfaHBoYXNl
ID0gMDsKKwkJeV92cGhhc2UgPSAwOworCisJCXV2X3JnYl9ocGhhc2UgPSBza2xfc2NhbGVyX2Nh
bGNfcGhhc2UoMSwgaHNjYWxlLCBmYWxzZSk7CisJCXV2X3JnYl92cGhhc2UgPSBza2xfc2NhbGVy
X2NhbGNfcGhhc2UoMSwgdnNjYWxlLCBmYWxzZSk7CisJfQorCisJcHNfY3RybCA9IHNrbF9zY2Fs
ZXJfZ2V0X2ZpbHRlcl9zZWxlY3QocGxhbmVfc3RhdGUtPmh3LnNjYWxpbmdfZmlsdGVyLCAwKTsK
Kwlwc19jdHJsIHw9IFBTX1NDQUxFUl9FTiB8IFBTX1BMQU5FX1NFTChwbGFuZS0+aWQpIHwgc2Nh
bGVyLT5tb2RlOworCisJc2tsX3NjYWxlcl9zZXR1cF9maWx0ZXIoZGV2X3ByaXYsIHBpcGUsIHNj
YWxlcl9pZCwgMCwKKwkJCQlwbGFuZV9zdGF0ZS0+aHcuc2NhbGluZ19maWx0ZXIpOworCisJaW50
ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFNLTF9QU19DVFJMKHBpcGUsIHNjYWxlcl9pZCksIHBz
X2N0cmwpOworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBTS0xfUFNfVlBIQVNFKHBpcGUs
IHNjYWxlcl9pZCksCisJCQkgIFBTX1lfUEhBU0UoeV92cGhhc2UpIHwgUFNfVVZfUkdCX1BIQVNF
KHV2X3JnYl92cGhhc2UpKTsKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgU0tMX1BTX0hQ
SEFTRShwaXBlLCBzY2FsZXJfaWQpLAorCQkJICBQU19ZX1BIQVNFKHlfaHBoYXNlKSB8IFBTX1VW
X1JHQl9QSEFTRSh1dl9yZ2JfaHBoYXNlKSk7CisJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYs
IFNLTF9QU19XSU5fUE9TKHBpcGUsIHNjYWxlcl9pZCksCisJCQkgIChjcnRjX3ggPDwgMTYpIHwg
Y3J0Y195KTsKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgU0tMX1BTX1dJTl9TWihwaXBl
LCBzY2FsZXJfaWQpLAorCQkJICAoY3J0Y193IDw8IDE2KSB8IGNydGNfaCk7Cit9CisKKy8qIFBy
ZW9mZnNldCB2YWx1ZXMgZm9yIFlVViB0byBSR0IgQ29udmVyc2lvbiAqLworI2RlZmluZSBQUkVP
RkZfWVVWX1RPX1JHQl9ISQkJMHgxODAwCisjZGVmaW5lIFBSRU9GRl9ZVVZfVE9fUkdCX01FCQkw
eDFGMDAKKyNkZWZpbmUgUFJFT0ZGX1lVVl9UT19SR0JfTE8JCTB4MTgwMAorCisjZGVmaW5lICBS
T0ZGKHgpICAgICAgICAgICgoKHgpICYgMHhmZmZmKSA8PCAxNikKKyNkZWZpbmUgIEdPRkYoeCkg
ICAgICAgICAgKCgoeCkgJiAweGZmZmYpIDw8IDApCisjZGVmaW5lICBCT0ZGKHgpICAgICAgICAg
ICgoKHgpICYgMHhmZmZmKSA8PCAxNikKKworc3RhdGljIHZvaWQKK2ljbF9wcm9ncmFtX2lucHV0
X2NzYyhzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAorCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX3Bs
YW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CisJZW51bSBwaXBlIHBpcGUgPSBwbGFu
ZS0+cGlwZTsKKwllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gcGxhbmUtPmlkOworCisJc3RhdGlj
IGNvbnN0IHUxNiBpbnB1dF9jc2NfbWF0cml4W11bOV0gPSB7CisJCS8qCisJCSAqIEJULjYwMSBm
dWxsIHJhbmdlIFlDYkNyIC0+IGZ1bGwgcmFuZ2UgUkdCCisJCSAqIFRoZSBtYXRyaXggcmVxdWly
ZWQgaXMgOgorCQkgKiBbMS4wMDAsIDAuMDAwLCAxLjM3MSwKKwkJICogIDEuMDAwLCAtMC4zMzYs
IC0wLjY5OCwKKwkJICogIDEuMDAwLCAxLjczMiwgMC4wMDAwXQorCQkgKi8KKwkJW0RSTV9DT0xP
Ul9ZQ0JDUl9CVDYwMV0gPSB7CisJCQkweDdBRjgsIDB4NzgwMCwgMHgwLAorCQkJMHg4QjI4LCAw
eDc4MDAsIDB4OUFDMCwKKwkJCTB4MCwgMHg3ODAwLCAweDdERDgsCisJCX0sCisJCS8qCisJCSAq
IEJULjcwOSBmdWxsIHJhbmdlIFlDYkNyIC0+IGZ1bGwgcmFuZ2UgUkdCCisJCSAqIFRoZSBtYXRy
aXggcmVxdWlyZWQgaXMgOgorCQkgKiBbMS4wMDAsIDAuMDAwLCAxLjU3NCwKKwkJICogIDEuMDAw
LCAtMC4xODcsIC0wLjQ2OCwKKwkJICogIDEuMDAwLCAxLjg1NSwgMC4wMDAwXQorCQkgKi8KKwkJ
W0RSTV9DT0xPUl9ZQ0JDUl9CVDcwOV0gPSB7CisJCQkweDdDOTgsIDB4NzgwMCwgMHgwLAorCQkJ
MHg5RUY4LCAweDc4MDAsIDB4QUMwMCwKKwkJCTB4MCwgMHg3ODAwLCAgMHg3RUQ4LAorCQl9LAor
CQkvKgorCQkgKiBCVC4yMDIwIGZ1bGwgcmFuZ2UgWUNiQ3IgLT4gZnVsbCByYW5nZSBSR0IKKwkJ
ICogVGhlIG1hdHJpeCByZXF1aXJlZCBpcyA6CisJCSAqIFsxLjAwMCwgMC4wMDAsIDEuNDc0LAor
CQkgKiAgMS4wMDAsIC0wLjE2NDUsIC0wLjU3MTMsCisJCSAqICAxLjAwMCwgMS44ODE0LCAwLjAw
MDBdCisJCSAqLworCQlbRFJNX0NPTE9SX1lDQkNSX0JUMjAyMF0gPSB7CisJCQkweDdCQzgsIDB4
NzgwMCwgMHgwLAorCQkJMHg4OTI4LCAweDc4MDAsIDB4QUE4OCwKKwkJCTB4MCwgMHg3ODAwLCAw
eDdGMTAsCisJCX0sCisJfTsKKworCS8qIE1hdHJpeCBmb3IgTGltaXRlZCBSYW5nZSB0byBGdWxs
IFJhbmdlIENvbnZlcnNpb24gKi8KKwlzdGF0aWMgY29uc3QgdTE2IGlucHV0X2NzY19tYXRyaXhf
bHJbXVs5XSA9IHsKKwkJLyoKKwkJICogQlQuNjAxIExpbXRlZCByYW5nZSBZQ2JDciAtPiBmdWxs
IHJhbmdlIFJHQgorCQkgKiBUaGUgbWF0cml4IHJlcXVpcmVkIGlzIDoKKwkJICogWzEuMTY0Mzg0
LCAwLjAwMCwgMS41OTYwMjcsCisJCSAqICAxLjE2NDM4NCwgLTAuMzkxNzUsIC0wLjgxMjgxMywK
KwkJICogIDEuMTY0Mzg0LCAyLjAxNzIzMiwgMC4wMDAwXQorCQkgKi8KKwkJW0RSTV9DT0xPUl9Z
Q0JDUl9CVDYwMV0gPSB7CisJCQkweDdDQzgsIDB4Nzk1MCwgMHgwLAorCQkJMHg4RDAwLCAweDc5
NTAsIDB4OUM4OCwKKwkJCTB4MCwgMHg3OTUwLCAweDY4MTAsCisJCX0sCisJCS8qCisJCSAqIEJU
LjcwOSBMaW1pdGVkIHJhbmdlIFlDYkNyIC0+IGZ1bGwgcmFuZ2UgUkdCCisJCSAqIFRoZSBtYXRy
aXggcmVxdWlyZWQgaXMgOgorCQkgKiBbMS4xNjQzODQsIDAuMDAwLCAxLjc5Mjc0MSwKKwkJICog
IDEuMTY0Mzg0LCAtMC4yMTMyNDksIC0wLjUzMjkwOSwKKwkJICogIDEuMTY0Mzg0LCAyLjExMjQw
MiwgMC4wMDAwXQorCQkgKi8KKwkJW0RSTV9DT0xPUl9ZQ0JDUl9CVDcwOV0gPSB7CisJCQkweDdF
NTgsIDB4Nzk1MCwgMHgwLAorCQkJMHg4ODg4LCAweDc5NTAsIDB4QURBOCwKKwkJCTB4MCwgMHg3
OTUwLCAgMHg2ODcwLAorCQl9LAorCQkvKgorCQkgKiBCVC4yMDIwIExpbWl0ZWQgcmFuZ2UgWUNi
Q3IgLT4gZnVsbCByYW5nZSBSR0IKKwkJICogVGhlIG1hdHJpeCByZXF1aXJlZCBpcyA6CisJCSAq
IFsxLjE2NCwgMC4wMDAsIDEuNjc4LAorCQkgKiAgMS4xNjQsIC0wLjE4NzMsIC0wLjY1MDQsCisJ
CSAqICAxLjE2NCwgMi4xNDE3LCAwLjAwMDBdCisJCSAqLworCQlbRFJNX0NPTE9SX1lDQkNSX0JU
MjAyMF0gPSB7CisJCQkweDdENzAsIDB4Nzk1MCwgMHgwLAorCQkJMHg4QTY4LCAweDc5NTAsIDB4
QUMwMCwKKwkJCTB4MCwgMHg3OTUwLCAweDY4OTAsCisJCX0sCisJfTsKKwljb25zdCB1MTYgKmNz
YzsKKworCWlmIChwbGFuZV9zdGF0ZS0+aHcuY29sb3JfcmFuZ2UgPT0gRFJNX0NPTE9SX1lDQkNS
X0ZVTExfUkFOR0UpCisJCWNzYyA9IGlucHV0X2NzY19tYXRyaXhbcGxhbmVfc3RhdGUtPmh3LmNv
bG9yX2VuY29kaW5nXTsKKwllbHNlCisJCWNzYyA9IGlucHV0X2NzY19tYXRyaXhfbHJbcGxhbmVf
c3RhdGUtPmh3LmNvbG9yX2VuY29kaW5nXTsKKworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2
LCBQTEFORV9JTlBVVF9DU0NfQ09FRkYocGlwZSwgcGxhbmVfaWQsIDApLAorCQkJICBST0ZGKGNz
Y1swXSkgfCBHT0ZGKGNzY1sxXSkpOworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFO
RV9JTlBVVF9DU0NfQ09FRkYocGlwZSwgcGxhbmVfaWQsIDEpLAorCQkJICBCT0ZGKGNzY1syXSkp
OworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9JTlBVVF9DU0NfQ09FRkYocGlw
ZSwgcGxhbmVfaWQsIDIpLAorCQkJICBST0ZGKGNzY1szXSkgfCBHT0ZGKGNzY1s0XSkpOworCWlu
dGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9JTlBVVF9DU0NfQ09FRkYocGlwZSwgcGxh
bmVfaWQsIDMpLAorCQkJICBCT0ZGKGNzY1s1XSkpOworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9w
cml2LCBQTEFORV9JTlBVVF9DU0NfQ09FRkYocGlwZSwgcGxhbmVfaWQsIDQpLAorCQkJICBST0ZG
KGNzY1s2XSkgfCBHT0ZGKGNzY1s3XSkpOworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQ
TEFORV9JTlBVVF9DU0NfQ09FRkYocGlwZSwgcGxhbmVfaWQsIDUpLAorCQkJICBCT0ZGKGNzY1s4
XSkpOworCisJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0lOUFVUX0NTQ19QUkVP
RkYocGlwZSwgcGxhbmVfaWQsIDApLAorCQkJICBQUkVPRkZfWVVWX1RPX1JHQl9ISSk7CisJaWYg
KHBsYW5lX3N0YXRlLT5ody5jb2xvcl9yYW5nZSA9PSBEUk1fQ09MT1JfWUNCQ1JfRlVMTF9SQU5H
RSkKKwkJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsCisJCQkJICBQTEFORV9JTlBVVF9DU0Nf
UFJFT0ZGKHBpcGUsIHBsYW5lX2lkLCAxKSwKKwkJCQkgIDApOworCWVsc2UKKwkJaW50ZWxfZGVf
d3JpdGVfZncoZGV2X3ByaXYsCisJCQkJICBQTEFORV9JTlBVVF9DU0NfUFJFT0ZGKHBpcGUsIHBs
YW5lX2lkLCAxKSwKKwkJCQkgIFBSRU9GRl9ZVVZfVE9fUkdCX01FKTsKKwlpbnRlbF9kZV93cml0
ZV9mdyhkZXZfcHJpdiwgUExBTkVfSU5QVVRfQ1NDX1BSRU9GRihwaXBlLCBwbGFuZV9pZCwgMiks
CisJCQkgIFBSRU9GRl9ZVVZfVE9fUkdCX0xPKTsKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJp
diwKKwkJCSAgUExBTkVfSU5QVVRfQ1NDX1BPU1RPRkYocGlwZSwgcGxhbmVfaWQsIDApLCAweDAp
OworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LAorCQkJICBQTEFORV9JTlBVVF9DU0NfUE9T
VE9GRihwaXBlLCBwbGFuZV9pZCwgMSksIDB4MCk7CisJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3By
aXYsCisJCQkgIFBMQU5FX0lOUFVUX0NTQ19QT1NUT0ZGKHBpcGUsIHBsYW5lX2lkLCAyKSwgMHgw
KTsKK30KKworc3RhdGljIGJvb2wgaXNfc3VyZmFjZV9saW5lYXIoY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFuZSkKK3sKKwlyZXR1cm4gZmItPm1vZGlmaWVy
ID09IERSTV9GT1JNQVRfTU9EX0xJTkVBUiB8fAorCSAgICAgICBpc19nZW4xMl9jY3NfcGxhbmUo
ZmIsIGNvbG9yX3BsYW5lKTsKK30KKworc3RhdGljIHVuc2lnbmVkIGludCBza2xfcGxhbmVfc3Ry
aWRlX211bHQoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCisJCQkJCSAgaW50IGNv
bG9yX3BsYW5lLCB1bnNpZ25lZCBpbnQgcm90YXRpb24pCit7CisJLyoKKwkgKiBUaGUgc3RyaWRl
IGlzIGVpdGhlciBleHByZXNzZWQgYXMgYSBtdWx0aXBsZSBvZiA2NCBieXRlcyBjaHVua3MgZm9y
CisJICogbGluZWFyIGJ1ZmZlcnMgb3IgaW4gbnVtYmVyIG9mIHRpbGVzIGZvciB0aWxlZCBidWZm
ZXJzLgorCSAqLworCWlmIChpc19zdXJmYWNlX2xpbmVhcihmYiwgY29sb3JfcGxhbmUpKQorCQly
ZXR1cm4gNjQ7CisJZWxzZSBpZiAoZHJtX3JvdGF0aW9uXzkwX29yXzI3MChyb3RhdGlvbikpCisJ
CXJldHVybiBpbnRlbF90aWxlX2hlaWdodChmYiwgY29sb3JfcGxhbmUpOworCWVsc2UKKwkJcmV0
dXJuIGludGVsX3RpbGVfd2lkdGhfYnl0ZXMoZmIsIGNvbG9yX3BsYW5lKTsKK30KKworc3RhdGlj
IHUzMiBza2xfcGxhbmVfc3RyaWRlKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxh
bmVfc3RhdGUsCisJCQkgICAgaW50IGNvbG9yX3BsYW5lKQoreworCWNvbnN0IHN0cnVjdCBkcm1f
ZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOworCXVuc2lnbmVkIGludCByb3Rh
dGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKKwl1MzIgc3RyaWRlID0gcGxhbmVfc3Rh
dGUtPmNvbG9yX3BsYW5lW2NvbG9yX3BsYW5lXS5zdHJpZGU7CisKKwlpZiAoY29sb3JfcGxhbmUg
Pj0gZmItPmZvcm1hdC0+bnVtX3BsYW5lcykKKwkJcmV0dXJuIDA7CisKKwlyZXR1cm4gc3RyaWRl
IC8gc2tsX3BsYW5lX3N0cmlkZV9tdWx0KGZiLCBjb2xvcl9wbGFuZSwgcm90YXRpb24pOworfQor
CitzdGF0aWMgdm9pZAorc2tsX2Rpc2FibGVfcGxhbmUoc3RydWN0IGludGVsX3BsYW5lICpwbGFu
ZSwKKwkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3sKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRl
dik7CisJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKKwllbnVtIHBpcGUgcGlw
ZSA9IHBsYW5lLT5waXBlOworCXVuc2lnbmVkIGxvbmcgaXJxZmxhZ3M7CisKKwlzcGluX2xvY2tf
aXJxc2F2ZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7CisKKwlpZiAoaWNsX2lz
X2hkcl9wbGFuZShkZXZfcHJpdiwgcGxhbmVfaWQpKQorCQlpbnRlbF9kZV93cml0ZV9mdyhkZXZf
cHJpdiwgUExBTkVfQ1VTX0NUTChwaXBlLCBwbGFuZV9pZCksIDApOworCisJc2tsX3dyaXRlX3Bs
YW5lX3dtKHBsYW5lLCBjcnRjX3N0YXRlKTsKKworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2
LCBQTEFORV9DVEwocGlwZSwgcGxhbmVfaWQpLCAwKTsKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZf
cHJpdiwgUExBTkVfU1VSRihwaXBlLCBwbGFuZV9pZCksIDApOworCisJc3Bpbl91bmxvY2tfaXJx
cmVzdG9yZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7Cit9CisKK3N0YXRpYyBi
b29sCitza2xfcGxhbmVfZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCisJ
CSAgICAgICBlbnVtIHBpcGUgKnBpcGUpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOworCWVudW0gaW50ZWxfZGlzcGxheV9w
b3dlcl9kb21haW4gcG93ZXJfZG9tYWluOworCWVudW0gcGxhbmVfaWQgcGxhbmVfaWQgPSBwbGFu
ZS0+aWQ7CisJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CisJYm9vbCByZXQ7CisKKwlwb3dlcl9k
b21haW4gPSBQT1dFUl9ET01BSU5fUElQRShwbGFuZS0+cGlwZSk7CisJd2FrZXJlZiA9IGludGVs
X2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoZGV2X3ByaXYsIHBvd2VyX2RvbWFpbik7CisJ
aWYgKCF3YWtlcmVmKQorCQlyZXR1cm4gZmFsc2U7CisKKwlyZXQgPSBpbnRlbF9kZV9yZWFkKGRl
dl9wcml2LCBQTEFORV9DVEwocGxhbmUtPnBpcGUsIHBsYW5lX2lkKSkgJiBQTEFORV9DVExfRU5B
QkxFOworCisJKnBpcGUgPSBwbGFuZS0+cGlwZTsKKworCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0
KGRldl9wcml2LCBwb3dlcl9kb21haW4sIHdha2VyZWYpOworCisJcmV0dXJuIHJldDsKK30KKwor
c3RhdGljIHZvaWQgc2tsX2RldGFjaF9zY2FsZXIoc3RydWN0IGludGVsX2NydGMgKmludGVsX2Ny
dGMsIGludCBpZCkKK3sKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gaW50ZWxfY3J0Yy0+YmFz
ZS5kZXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYp
OworCXVuc2lnbmVkIGxvbmcgaXJxZmxhZ3M7CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgmZGV2X3By
aXYtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7CisKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJp
diwgU0tMX1BTX0NUUkwoaW50ZWxfY3J0Yy0+cGlwZSwgaWQpLCAwKTsKKwlpbnRlbF9kZV93cml0
ZV9mdyhkZXZfcHJpdiwgU0tMX1BTX1dJTl9QT1MoaW50ZWxfY3J0Yy0+cGlwZSwgaWQpLCAwKTsK
KwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgU0tMX1BTX1dJTl9TWihpbnRlbF9jcnRjLT5w
aXBlLCBpZCksIDApOworCisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGV2X3ByaXYtPnVuY29y
ZS5sb2NrLCBpcnFmbGFncyk7Cit9CisKKy8qCisgKiBUaGlzIGZ1bmN0aW9uIGRldGFjaGVzIChh
a2EuIHVuYmluZHMpIHVudXNlZCBzY2FsZXJzIGluIGhhcmR3YXJlCisgKi8KK3ZvaWQgc2tsX2Rl
dGFjaF9zY2FsZXJzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQor
eworCXN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0
YXRlLT51YXBpLmNydGMpOworCWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3NjYWxlcl9zdGF0ZSAq
c2NhbGVyX3N0YXRlID0KKwkJJmNydGNfc3RhdGUtPnNjYWxlcl9zdGF0ZTsKKwlpbnQgaTsKKwor
CS8qIGxvb3AgdGhyb3VnaCBhbmQgZGlzYWJsZSBzY2FsZXJzIHRoYXQgYXJlbid0IGluIHVzZSAq
LworCWZvciAoaSA9IDA7IGkgPCBpbnRlbF9jcnRjLT5udW1fc2NhbGVyczsgaSsrKSB7CisJCWlm
ICghc2NhbGVyX3N0YXRlLT5zY2FsZXJzW2ldLmluX3VzZSkKKwkJCXNrbF9kZXRhY2hfc2NhbGVy
KGludGVsX2NydGMsIGkpOworCX0KK30KKwordm9pZCBza2xfc2NhbGVyX2Rpc2FibGUoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlKQoreworCXN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhvbGRfY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsK
KwlpbnQgaTsKKworCWZvciAoaSA9IDA7IGkgPCBjcnRjLT5udW1fc2NhbGVyczsgaSsrKQorCQlz
a2xfZGV0YWNoX3NjYWxlcihjcnRjLCBpKTsKK30KKworc3RhdGljIHUzMiBza2xfcGxhbmVfY3Rs
X2Zvcm1hdCh1MzIgcGl4ZWxfZm9ybWF0KQoreworCXN3aXRjaCAocGl4ZWxfZm9ybWF0KSB7CisJ
Y2FzZSBEUk1fRk9STUFUX0M4OgorCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9JTkRFWEVEOwor
CWNhc2UgRFJNX0ZPUk1BVF9SR0I1NjU6CisJCXJldHVybiBQTEFORV9DVExfRk9STUFUX1JHQl81
NjU7CisJY2FzZSBEUk1fRk9STUFUX1hCR1I4ODg4OgorCWNhc2UgRFJNX0ZPUk1BVF9BQkdSODg4
ODoKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWFJHQl84ODg4IHwgUExBTkVfQ1RMX09SREVS
X1JHQlg7CisJY2FzZSBEUk1fRk9STUFUX1hSR0I4ODg4OgorCWNhc2UgRFJNX0ZPUk1BVF9BUkdC
ODg4ODoKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWFJHQl84ODg4OworCWNhc2UgRFJNX0ZP
Uk1BVF9YQkdSMjEwMTAxMDoKKwljYXNlIERSTV9GT1JNQVRfQUJHUjIxMDEwMTA6CisJCXJldHVy
biBQTEFORV9DVExfRk9STUFUX1hSR0JfMjEwMTAxMCB8IFBMQU5FX0NUTF9PUkRFUl9SR0JYOwor
CWNhc2UgRFJNX0ZPUk1BVF9YUkdCMjEwMTAxMDoKKwljYXNlIERSTV9GT1JNQVRfQVJHQjIxMDEw
MTA6CisJCXJldHVybiBQTEFORV9DVExfRk9STUFUX1hSR0JfMjEwMTAxMDsKKwljYXNlIERSTV9G
T1JNQVRfWEJHUjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfQUJHUjE2MTYxNjE2RjoKKwkJ
cmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWFJHQl8xNjE2MTYxNkYgfCBQTEFORV9DVExfT1JERVJf
UkdCWDsKKwljYXNlIERSTV9GT1JNQVRfWFJHQjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRf
QVJHQjE2MTYxNjE2RjoKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWFJHQl8xNjE2MTYxNkY7
CisJY2FzZSBEUk1fRk9STUFUX1hZVVY4ODg4OgorCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9Y
WVVWOworCWNhc2UgRFJNX0ZPUk1BVF9ZVVlWOgorCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9Z
VVY0MjIgfCBQTEFORV9DVExfWVVWNDIyX1lVWVY7CisJY2FzZSBEUk1fRk9STUFUX1lWWVU6CisJ
CXJldHVybiBQTEFORV9DVExfRk9STUFUX1lVVjQyMiB8IFBMQU5FX0NUTF9ZVVY0MjJfWVZZVTsK
KwljYXNlIERSTV9GT1JNQVRfVVlWWToKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWVVWNDIy
IHwgUExBTkVfQ1RMX1lVVjQyMl9VWVZZOworCWNhc2UgRFJNX0ZPUk1BVF9WWVVZOgorCQlyZXR1
cm4gUExBTkVfQ1RMX0ZPUk1BVF9ZVVY0MjIgfCBQTEFORV9DVExfWVVWNDIyX1ZZVVk7CisJY2Fz
ZSBEUk1fRk9STUFUX05WMTI6CisJCXJldHVybiBQTEFORV9DVExfRk9STUFUX05WMTI7CisJY2Fz
ZSBEUk1fRk9STUFUX1AwMTA6CisJCXJldHVybiBQTEFORV9DVExfRk9STUFUX1AwMTA7CisJY2Fz
ZSBEUk1fRk9STUFUX1AwMTI6CisJCXJldHVybiBQTEFORV9DVExfRk9STUFUX1AwMTI7CisJY2Fz
ZSBEUk1fRk9STUFUX1AwMTY6CisJCXJldHVybiBQTEFORV9DVExfRk9STUFUX1AwMTY7CisJY2Fz
ZSBEUk1fRk9STUFUX1kyMTA6CisJCXJldHVybiBQTEFORV9DVExfRk9STUFUX1kyMTA7CisJY2Fz
ZSBEUk1fRk9STUFUX1kyMTI6CisJCXJldHVybiBQTEFORV9DVExfRk9STUFUX1kyMTI7CisJY2Fz
ZSBEUk1fRk9STUFUX1kyMTY6CisJCXJldHVybiBQTEFORV9DVExfRk9STUFUX1kyMTY7CisJY2Fz
ZSBEUk1fRk9STUFUX1hWWVUyMTAxMDEwOgorCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9ZNDEw
OworCWNhc2UgRFJNX0ZPUk1BVF9YVllVMTJfMTYxNjE2MTY6CisJCXJldHVybiBQTEFORV9DVExf
Rk9STUFUX1k0MTI7CisJY2FzZSBEUk1fRk9STUFUX1hWWVUxNjE2MTYxNjoKKwkJcmV0dXJuIFBM
QU5FX0NUTF9GT1JNQVRfWTQxNjsKKwlkZWZhdWx0OgorCQlNSVNTSU5HX0NBU0UocGl4ZWxfZm9y
bWF0KTsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHUzMiBza2xfcGxhbmVfY3RsX2Fs
cGhhKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCit7CisJaWYg
KCFwbGFuZV9zdGF0ZS0+aHcuZmItPmZvcm1hdC0+aGFzX2FscGhhKQorCQlyZXR1cm4gUExBTkVf
Q1RMX0FMUEhBX0RJU0FCTEU7CisKKwlzd2l0Y2ggKHBsYW5lX3N0YXRlLT5ody5waXhlbF9ibGVu
ZF9tb2RlKSB7CisJY2FzZSBEUk1fTU9ERV9CTEVORF9QSVhFTF9OT05FOgorCQlyZXR1cm4gUExB
TkVfQ1RMX0FMUEhBX0RJU0FCTEU7CisJY2FzZSBEUk1fTU9ERV9CTEVORF9QUkVNVUxUSToKKwkJ
cmV0dXJuIFBMQU5FX0NUTF9BTFBIQV9TV19QUkVNVUxUSVBMWTsKKwljYXNlIERSTV9NT0RFX0JM
RU5EX0NPVkVSQUdFOgorCQlyZXR1cm4gUExBTkVfQ1RMX0FMUEhBX0hXX1BSRU1VTFRJUExZOwor
CWRlZmF1bHQ6CisJCU1JU1NJTkdfQ0FTRShwbGFuZV9zdGF0ZS0+aHcucGl4ZWxfYmxlbmRfbW9k
ZSk7CisJCXJldHVybiBQTEFORV9DVExfQUxQSEFfRElTQUJMRTsKKwl9Cit9CisKK3N0YXRpYyB1
MzIgZ2xrX3BsYW5lX2NvbG9yX2N0bF9hbHBoYShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3Rh
dGUgKnBsYW5lX3N0YXRlKQoreworCWlmICghcGxhbmVfc3RhdGUtPmh3LmZiLT5mb3JtYXQtPmhh
c19hbHBoYSkKKwkJcmV0dXJuIFBMQU5FX0NPTE9SX0FMUEhBX0RJU0FCTEU7CisKKwlzd2l0Y2gg
KHBsYW5lX3N0YXRlLT5ody5waXhlbF9ibGVuZF9tb2RlKSB7CisJY2FzZSBEUk1fTU9ERV9CTEVO
RF9QSVhFTF9OT05FOgorCQlyZXR1cm4gUExBTkVfQ09MT1JfQUxQSEFfRElTQUJMRTsKKwljYXNl
IERSTV9NT0RFX0JMRU5EX1BSRU1VTFRJOgorCQlyZXR1cm4gUExBTkVfQ09MT1JfQUxQSEFfU1df
UFJFTVVMVElQTFk7CisJY2FzZSBEUk1fTU9ERV9CTEVORF9DT1ZFUkFHRToKKwkJcmV0dXJuIFBM
QU5FX0NPTE9SX0FMUEhBX0hXX1BSRU1VTFRJUExZOworCWRlZmF1bHQ6CisJCU1JU1NJTkdfQ0FT
RShwbGFuZV9zdGF0ZS0+aHcucGl4ZWxfYmxlbmRfbW9kZSk7CisJCXJldHVybiBQTEFORV9DT0xP
Ul9BTFBIQV9ESVNBQkxFOworCX0KK30KKworc3RhdGljIHUzMiBza2xfcGxhbmVfY3RsX3RpbGlu
Zyh1NjQgZmJfbW9kaWZpZXIpCit7CisJc3dpdGNoIChmYl9tb2RpZmllcikgeworCWNhc2UgRFJN
X0ZPUk1BVF9NT0RfTElORUFSOgorCQlicmVhazsKKwljYXNlIEk5MTVfRk9STUFUX01PRF9YX1RJ
TEVEOgorCQlyZXR1cm4gUExBTkVfQ1RMX1RJTEVEX1g7CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0Rf
WV9USUxFRDoKKwkJcmV0dXJuIFBMQU5FX0NUTF9USUxFRF9ZOworCWNhc2UgSTkxNV9GT1JNQVRf
TU9EX1lfVElMRURfQ0NTOgorCQlyZXR1cm4gUExBTkVfQ1RMX1RJTEVEX1kgfCBQTEFORV9DVExf
UkVOREVSX0RFQ09NUFJFU1NJT05fRU5BQkxFOworCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElM
RURfR0VOMTJfUkNfQ0NTOgorCQlyZXR1cm4gUExBTkVfQ1RMX1RJTEVEX1kgfAorCQkgICAgICAg
UExBTkVfQ1RMX1JFTkRFUl9ERUNPTVBSRVNTSU9OX0VOQUJMRSB8CisJCSAgICAgICBQTEFORV9D
VExfQ0xFQVJfQ09MT1JfRElTQUJMRTsKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dF
TjEyX01DX0NDUzoKKwkJcmV0dXJuIFBMQU5FX0NUTF9USUxFRF9ZIHwgUExBTkVfQ1RMX01FRElB
X0RFQ09NUFJFU1NJT05fRU5BQkxFOworCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEOgor
CQlyZXR1cm4gUExBTkVfQ1RMX1RJTEVEX1lGOworCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lmX1RJ
TEVEX0NDUzoKKwkJcmV0dXJuIFBMQU5FX0NUTF9USUxFRF9ZRiB8IFBMQU5FX0NUTF9SRU5ERVJf
REVDT01QUkVTU0lPTl9FTkFCTEU7CisJZGVmYXVsdDoKKwkJTUlTU0lOR19DQVNFKGZiX21vZGlm
aWVyKTsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHUzMiBza2xfcGxhbmVfY3RsX3Jv
dGF0ZSh1bnNpZ25lZCBpbnQgcm90YXRlKQoreworCXN3aXRjaCAocm90YXRlKSB7CisJY2FzZSBE
Uk1fTU9ERV9ST1RBVEVfMDoKKwkJYnJlYWs7CisJLyoKKwkgKiBEUk1fTU9ERV9ST1RBVEVfIGlz
IGNvdW50ZXIgY2xvY2t3aXNlIHRvIHN0YXkgY29tcGF0aWJsZSB3aXRoIFhyYW5kcgorCSAqIHdo
aWxlIGk5MTUgSFcgcm90YXRpb24gaXMgY2xvY2t3aXNlLCB0aGF0cyB3aHkgdGhpcyBzd2FwcGlu
Zy4KKwkgKi8KKwljYXNlIERSTV9NT0RFX1JPVEFURV85MDoKKwkJcmV0dXJuIFBMQU5FX0NUTF9S
T1RBVEVfMjcwOworCWNhc2UgRFJNX01PREVfUk9UQVRFXzE4MDoKKwkJcmV0dXJuIFBMQU5FX0NU
TF9ST1RBVEVfMTgwOworCWNhc2UgRFJNX01PREVfUk9UQVRFXzI3MDoKKwkJcmV0dXJuIFBMQU5F
X0NUTF9ST1RBVEVfOTA7CisJZGVmYXVsdDoKKwkJTUlTU0lOR19DQVNFKHJvdGF0ZSk7CisJfQor
CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyB1MzIgY25sX3BsYW5lX2N0bF9mbGlwKHVuc2lnbmVk
IGludCByZWZsZWN0KQoreworCXN3aXRjaCAocmVmbGVjdCkgeworCWNhc2UgMDoKKwkJYnJlYWs7
CisJY2FzZSBEUk1fTU9ERV9SRUZMRUNUX1g6CisJCXJldHVybiBQTEFORV9DVExfRkxJUF9IT1JJ
Wk9OVEFMOworCWNhc2UgRFJNX01PREVfUkVGTEVDVF9ZOgorCWRlZmF1bHQ6CisJCU1JU1NJTkdf
Q0FTRShyZWZsZWN0KTsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHUzMiBza2xfcGxh
bmVfY3RsX2NydGMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRl
LT51YXBpLmNydGMtPmRldik7CisJdTMyIHBsYW5lX2N0bCA9IDA7CisKKwlpZiAoY3J0Y19zdGF0
ZS0+dWFwaS5hc3luY19mbGlwKQorCQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RMX0FTWU5DX0ZMSVA7
CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9w
cml2KSkKKwkJcmV0dXJuIHBsYW5lX2N0bDsKKworCWlmIChjcnRjX3N0YXRlLT5nYW1tYV9lbmFi
bGUpCisJCXBsYW5lX2N0bCB8PSBQTEFORV9DVExfUElQRV9HQU1NQV9FTkFCTEU7CisKKwlpZiAo
Y3J0Y19zdGF0ZS0+Y3NjX2VuYWJsZSkKKwkJcGxhbmVfY3RsIHw9IFBMQU5FX0NUTF9QSVBFX0NT
Q19FTkFCTEU7CisKKwlyZXR1cm4gcGxhbmVfY3RsOworfQorCitzdGF0aWMgdTMyIHNrbF9wbGFu
ZV9jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkgY29u
c3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQorCQl0b19pOTE1KHBsYW5lX3N0YXRlLT51YXBpLnBs
YW5lLT5kZXYpOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3Rh
dGUtPmh3LmZiOworCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3Rh
dGlvbjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ludGVsX3Nwcml0ZV9jb2xvcmtleSAqa2V5ID0gJnBs
YW5lX3N0YXRlLT5ja2V5OworCXUzMiBwbGFuZV9jdGw7CisKKwlwbGFuZV9jdGwgPSBQTEFORV9D
VExfRU5BQkxFOworCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMCAmJiAhSVNfR0VNSU5J
TEFLRShkZXZfcHJpdikpIHsKKwkJcGxhbmVfY3RsIHw9IHNrbF9wbGFuZV9jdGxfYWxwaGEocGxh
bmVfc3RhdGUpOworCQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RMX1BMQU5FX0dBTU1BX0RJU0FCTEU7
CisKKwkJaWYgKHBsYW5lX3N0YXRlLT5ody5jb2xvcl9lbmNvZGluZyA9PSBEUk1fQ09MT1JfWUNC
Q1JfQlQ3MDkpCisJCQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RMX1lVVl9UT19SR0JfQ1NDX0ZPUk1B
VF9CVDcwOTsKKworCQlpZiAocGxhbmVfc3RhdGUtPmh3LmNvbG9yX3JhbmdlID09IERSTV9DT0xP
Ul9ZQ0JDUl9GVUxMX1JBTkdFKQorCQkJcGxhbmVfY3RsIHw9IFBMQU5FX0NUTF9ZVVZfUkFOR0Vf
Q09SUkVDVElPTl9ESVNBQkxFOworCX0KKworCXBsYW5lX2N0bCB8PSBza2xfcGxhbmVfY3RsX2Zv
cm1hdChmYi0+Zm9ybWF0LT5mb3JtYXQpOworCXBsYW5lX2N0bCB8PSBza2xfcGxhbmVfY3RsX3Rp
bGluZyhmYi0+bW9kaWZpZXIpOworCXBsYW5lX2N0bCB8PSBza2xfcGxhbmVfY3RsX3JvdGF0ZShy
b3RhdGlvbiAmIERSTV9NT0RFX1JPVEFURV9NQVNLKTsKKworCWlmIChJTlRFTF9HRU4oZGV2X3By
aXYpID49IDEwKQorCQlwbGFuZV9jdGwgfD0gY25sX3BsYW5lX2N0bF9mbGlwKHJvdGF0aW9uICYK
KwkJCQkJCURSTV9NT0RFX1JFRkxFQ1RfTUFTSyk7CisKKwlpZiAoa2V5LT5mbGFncyAmIEk5MTVf
U0VUX0NPTE9SS0VZX0RFU1RJTkFUSU9OKQorCQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RMX0tFWV9F
TkFCTEVfREVTVElOQVRJT047CisJZWxzZSBpZiAoa2V5LT5mbGFncyAmIEk5MTVfU0VUX0NPTE9S
S0VZX1NPVVJDRSkKKwkJcGxhbmVfY3RsIHw9IFBMQU5FX0NUTF9LRVlfRU5BQkxFX1NPVVJDRTsK
KworCXJldHVybiBwbGFuZV9jdGw7Cit9CisKK3N0YXRpYyB1MzIgZ2xrX3BsYW5lX2NvbG9yX2N0
bF9jcnRjKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQoreworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+dWFw
aS5jcnRjLT5kZXYpOworCXUzMiBwbGFuZV9jb2xvcl9jdGwgPSAwOworCisJaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPj0gMTEpCisJCXJldHVybiBwbGFuZV9jb2xvcl9jdGw7CisKKwlpZiAoY3J0
Y19zdGF0ZS0+Z2FtbWFfZW5hYmxlKQorCQlwbGFuZV9jb2xvcl9jdGwgfD0gUExBTkVfQ09MT1Jf
UElQRV9HQU1NQV9FTkFCTEU7CisKKwlpZiAoY3J0Y19zdGF0ZS0+Y3NjX2VuYWJsZSkKKwkJcGxh
bmVfY29sb3JfY3RsIHw9IFBMQU5FX0NPTE9SX1BJUEVfQ1NDX0VOQUJMRTsKKworCXJldHVybiBw
bGFuZV9jb2xvcl9jdGw7Cit9CisKK3N0YXRpYyB1MzIgZ2xrX3BsYW5lX2NvbG9yX2N0bChjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCSAgICAgICBjb25zdCBz
dHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQoreworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9CisJCXRvX2k5MTUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUt
PmRldik7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+
aHcuZmI7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5l
X3N0YXRlLT51YXBpLnBsYW5lKTsKKwl1MzIgcGxhbmVfY29sb3JfY3RsID0gMDsKKworCXBsYW5l
X2NvbG9yX2N0bCB8PSBQTEFORV9DT0xPUl9QTEFORV9HQU1NQV9ESVNBQkxFOworCXBsYW5lX2Nv
bG9yX2N0bCB8PSBnbGtfcGxhbmVfY29sb3JfY3RsX2FscGhhKHBsYW5lX3N0YXRlKTsKKworCWlm
IChmYi0+Zm9ybWF0LT5pc195dXYgJiYgIWljbF9pc19oZHJfcGxhbmUoZGV2X3ByaXYsIHBsYW5l
LT5pZCkpIHsKKwkJc3dpdGNoIChwbGFuZV9zdGF0ZS0+aHcuY29sb3JfZW5jb2RpbmcpIHsKKwkJ
Y2FzZSBEUk1fQ09MT1JfWUNCQ1JfQlQ3MDk6CisJCQlwbGFuZV9jb2xvcl9jdGwgfD0gUExBTkVf
Q09MT1JfQ1NDX01PREVfWVVWNzA5X1RPX1JHQjcwOTsKKwkJCWJyZWFrOworCQljYXNlIERSTV9D
T0xPUl9ZQ0JDUl9CVDIwMjA6CisJCQlwbGFuZV9jb2xvcl9jdGwgfD0KKwkJCQlQTEFORV9DT0xP
Ul9DU0NfTU9ERV9ZVVYyMDIwX1RPX1JHQjIwMjA7CisJCQlicmVhazsKKwkJZGVmYXVsdDoKKwkJ
CXBsYW5lX2NvbG9yX2N0bCB8PQorCQkJCVBMQU5FX0NPTE9SX0NTQ19NT0RFX1lVVjYwMV9UT19S
R0I2MDE7CisJCX0KKwkJaWYgKHBsYW5lX3N0YXRlLT5ody5jb2xvcl9yYW5nZSA9PSBEUk1fQ09M
T1JfWUNCQ1JfRlVMTF9SQU5HRSkKKwkJCXBsYW5lX2NvbG9yX2N0bCB8PSBQTEFORV9DT0xPUl9Z
VVZfUkFOR0VfQ09SUkVDVElPTl9ESVNBQkxFOworCX0gZWxzZSBpZiAoZmItPmZvcm1hdC0+aXNf
eXV2KSB7CisJCXBsYW5lX2NvbG9yX2N0bCB8PSBQTEFORV9DT0xPUl9JTlBVVF9DU0NfRU5BQkxF
OworCX0KKworCXJldHVybiBwbGFuZV9jb2xvcl9jdGw7Cit9CisKK3N0YXRpYyB2b2lkCitza2xf
cHJvZ3JhbV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAorCQkgIGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCisJCSAgaW50IGNvbG9yX3BsYW5lKQoreworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsK
KwllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gcGxhbmUtPmlkOworCWVudW0gcGlwZSBwaXBlID0g
cGxhbmUtPnBpcGU7CisJY29uc3Qgc3RydWN0IGRybV9pbnRlbF9zcHJpdGVfY29sb3JrZXkgKmtl
eSA9ICZwbGFuZV9zdGF0ZS0+Y2tleTsKKwl1MzIgc3VyZl9hZGRyID0gcGxhbmVfc3RhdGUtPmNv
bG9yX3BsYW5lW2NvbG9yX3BsYW5lXS5vZmZzZXQ7CisJdTMyIHN0cmlkZSA9IHNrbF9wbGFuZV9z
dHJpZGUocGxhbmVfc3RhdGUsIGNvbG9yX3BsYW5lKTsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKKwlpbnQgYXV4X3BsYW5lID0gaW50ZWxf
bWFpbl90b19hdXhfcGxhbmUoZmIsIGNvbG9yX3BsYW5lKTsKKwlpbnQgY3J0Y194ID0gcGxhbmVf
c3RhdGUtPnVhcGkuZHN0LngxOworCWludCBjcnRjX3kgPSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3Qu
eTE7CisJdTMyIHggPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY29sb3JfcGxhbmVdLng7CisJ
dTMyIHkgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY29sb3JfcGxhbmVdLnk7CisJdTMyIHNy
Y193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7CisJdTMy
IHNyY19oID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2Owor
CXU4IGFscGhhID0gcGxhbmVfc3RhdGUtPmh3LmFscGhhID4+IDg7CisJdTMyIHBsYW5lX2NvbG9y
X2N0bCA9IDAsIGF1eF9kaXN0ID0gMDsKKwl1bnNpZ25lZCBsb25nIGlycWZsYWdzOworCXUzMiBr
ZXltc2ssIGtleW1heDsKKwl1MzIgcGxhbmVfY3RsID0gcGxhbmVfc3RhdGUtPmN0bDsKKworCXBs
YW5lX2N0bCB8PSBza2xfcGxhbmVfY3RsX2NydGMoY3J0Y19zdGF0ZSk7CisKKwlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkKKwkJcGxhbmVf
Y29sb3JfY3RsID0gcGxhbmVfc3RhdGUtPmNvbG9yX2N0bCB8CisJCQlnbGtfcGxhbmVfY29sb3Jf
Y3RsX2NydGMoY3J0Y19zdGF0ZSk7CisKKwkvKiBTaXplcyBhcmUgMCBiYXNlZCAqLworCXNyY193
LS07CisJc3JjX2gtLTsKKworCWtleW1heCA9IChrZXktPm1heF92YWx1ZSAmIDB4ZmZmZmZmKSB8
IFBMQU5FX0tFWU1BWF9BTFBIQShhbHBoYSk7CisKKwlrZXltc2sgPSBrZXktPmNoYW5uZWxfbWFz
ayAmIDB4N2ZmZmZmZjsKKwlpZiAoYWxwaGEgPCAweGZmKQorCQlrZXltc2sgfD0gUExBTkVfS0VZ
TVNLX0FMUEhBX0VOQUJMRTsKKworCS8qIFRoZSBzY2FsZXIgd2lsbCBoYW5kbGUgdGhlIG91dHB1
dCBwb3NpdGlvbiAqLworCWlmIChwbGFuZV9zdGF0ZS0+c2NhbGVyX2lkID49IDApIHsKKwkJY3J0
Y194ID0gMDsKKwkJY3J0Y195ID0gMDsKKwl9CisKKwlpZiAoYXV4X3BsYW5lKSB7CisJCWF1eF9k
aXN0ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2F1eF9wbGFuZV0ub2Zmc2V0IC0gc3VyZl9h
ZGRyOworCisJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTIpCisJCQlhdXhfZGlzdCB8PSBz
a2xfcGxhbmVfc3RyaWRlKHBsYW5lX3N0YXRlLCBhdXhfcGxhbmUpOworCX0KKworCXNwaW5fbG9j
a19pcnFzYXZlKCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsKKworCWludGVsX2Rl
X3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9TVFJJREUocGlwZSwgcGxhbmVfaWQpLCBzdHJpZGUp
OworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9QT1MocGlwZSwgcGxhbmVfaWQp
LAorCQkJICAoY3J0Y195IDw8IDE2KSB8IGNydGNfeCk7CisJaW50ZWxfZGVfd3JpdGVfZncoZGV2
X3ByaXYsIFBMQU5FX1NJWkUocGlwZSwgcGxhbmVfaWQpLAorCQkJICAoc3JjX2ggPDwgMTYpIHwg
c3JjX3cpOworCisJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0FVWF9ESVNUKHBp
cGUsIHBsYW5lX2lkKSwgYXV4X2Rpc3QpOworCisJaWYgKGljbF9pc19oZHJfcGxhbmUoZGV2X3By
aXYsIHBsYW5lX2lkKSkKKwkJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0NVU19D
VEwocGlwZSwgcGxhbmVfaWQpLAorCQkJCSAgcGxhbmVfc3RhdGUtPmN1c19jdGwpOworCisJaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCisJ
CWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9DT0xPUl9DVEwocGlwZSwgcGxhbmVf
aWQpLAorCQkJCSAgcGxhbmVfY29sb3JfY3RsKTsKKworCWlmIChmYi0+Zm9ybWF0LT5pc195dXYg
JiYgaWNsX2lzX2hkcl9wbGFuZShkZXZfcHJpdiwgcGxhbmVfaWQpKQorCQlpY2xfcHJvZ3JhbV9p
bnB1dF9jc2MocGxhbmUsIGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKTsKKworCXNrbF93cml0ZV9w
bGFuZV93bShwbGFuZSwgY3J0Y19zdGF0ZSk7CisKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJp
diwgUExBTkVfS0VZVkFMKHBpcGUsIHBsYW5lX2lkKSwKKwkJCSAga2V5LT5taW5fdmFsdWUpOwor
CWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9LRVlNU0socGlwZSwgcGxhbmVfaWQp
LCBrZXltc2spOworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9LRVlNQVgocGlw
ZSwgcGxhbmVfaWQpLCBrZXltYXgpOworCisJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBM
QU5FX09GRlNFVChwaXBlLCBwbGFuZV9pZCksCisJCQkgICh5IDw8IDE2KSB8IHgpOworCisJaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPCAxMSkKKwkJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYs
IFBMQU5FX0FVWF9PRkZTRVQocGlwZSwgcGxhbmVfaWQpLAorCQkJCSAgKHBsYW5lX3N0YXRlLT5j
b2xvcl9wbGFuZVsxXS55IDw8IDE2KSB8IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVsxXS54KTsK
KworCWlmICghZHJtX2F0b21pY19jcnRjX25lZWRzX21vZGVzZXQoJmNydGNfc3RhdGUtPnVhcGkp
KQorCQlpbnRlbF9wc3IyX3Byb2dyYW1fcGxhbmVfc2VsX2ZldGNoKHBsYW5lLCBjcnRjX3N0YXRl
LCBwbGFuZV9zdGF0ZSwgY29sb3JfcGxhbmUpOworCisJLyoKKwkgKiBUaGUgY29udHJvbCByZWdp
c3RlciBzZWxmLWFybXMgaWYgdGhlIHBsYW5lIHdhcyBwcmV2aW91c2x5CisJICogZGlzYWJsZWQu
IFRyeSB0byBtYWtlIHRoZSBwbGFuZSBlbmFibGUgYXRvbWljIGJ5IHdyaXRpbmcKKwkgKiB0aGUg
Y29udHJvbCByZWdpc3RlciBqdXN0IGJlZm9yZSB0aGUgc3VyZmFjZSByZWdpc3Rlci4KKwkgKi8K
KwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfQ1RMKHBpcGUsIHBsYW5lX2lkKSwg
cGxhbmVfY3RsKTsKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfU1VSRihwaXBl
LCBwbGFuZV9pZCksCisJCQkgIGludGVsX3BsYW5lX2dndHRfb2Zmc2V0KHBsYW5lX3N0YXRlKSAr
IHN1cmZfYWRkcik7CisKKwlpZiAocGxhbmVfc3RhdGUtPnNjYWxlcl9pZCA+PSAwKQorCQlza2xf
cHJvZ3JhbV9zY2FsZXIocGxhbmUsIGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKTsKKworCXNwaW5f
dW5sb2NrX2lycXJlc3RvcmUoJmRldl9wcml2LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOworfQor
CitzdGF0aWMgdm9pZAorc2tsX3BsYW5lX2FzeW5jX2ZsaXAoc3RydWN0IGludGVsX3BsYW5lICpw
bGFuZSwKKwkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwK
KwkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQorewor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2Uu
ZGV2KTsKKwl1bnNpZ25lZCBsb25nIGlycWZsYWdzOworCWVudW0gcGxhbmVfaWQgcGxhbmVfaWQg
PSBwbGFuZS0+aWQ7CisJZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlwZTsKKwl1MzIgc3VyZl9h
ZGRyID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLm9mZnNldDsKKwl1MzIgcGxhbmVfY3Rs
ID0gcGxhbmVfc3RhdGUtPmN0bDsKKworCXBsYW5lX2N0bCB8PSBza2xfcGxhbmVfY3RsX2NydGMo
Y3J0Y19zdGF0ZSk7CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgmZGV2X3ByaXYtPnVuY29yZS5sb2Nr
LCBpcnFmbGFncyk7CisKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfQ1RMKHBp
cGUsIHBsYW5lX2lkKSwgcGxhbmVfY3RsKTsKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwg
UExBTkVfU1VSRihwaXBlLCBwbGFuZV9pZCksCisJCQkgIGludGVsX3BsYW5lX2dndHRfb2Zmc2V0
KHBsYW5lX3N0YXRlKSArIHN1cmZfYWRkcik7CisKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZk
ZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsKK30KKworc3RhdGljIHZvaWQKK3NrbF91
cGRhdGVfcGxhbmUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKKwkJIGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkgY29uc3Qgc3RydWN0IGludGVsX3BsYW5l
X3N0YXRlICpwbGFuZV9zdGF0ZSkKK3sKKwlpbnQgY29sb3JfcGxhbmUgPSAwOworCisJaWYgKHBs
YW5lX3N0YXRlLT5wbGFuYXJfbGlua2VkX3BsYW5lICYmICFwbGFuZV9zdGF0ZS0+cGxhbmFyX3Ns
YXZlKQorCQkvKiBQcm9ncmFtIHRoZSBVViBwbGFuZSBvbiBwbGFuYXIgbWFzdGVyICovCisJCWNv
bG9yX3BsYW5lID0gMTsKKworCXNrbF9wcm9ncmFtX3BsYW5lKHBsYW5lLCBjcnRjX3N0YXRlLCBw
bGFuZV9zdGF0ZSwgY29sb3JfcGxhbmUpOworfQorCitzdGF0aWMgYm9vbCBpbnRlbF9mb3JtYXRf
aXNfcDAxeCh1MzIgZm9ybWF0KQoreworCXN3aXRjaCAoZm9ybWF0KSB7CisJY2FzZSBEUk1fRk9S
TUFUX1AwMTA6CisJY2FzZSBEUk1fRk9STUFUX1AwMTI6CisJY2FzZSBEUk1fRk9STUFUX1AwMTY6
CisJCXJldHVybiB0cnVlOworCWRlZmF1bHQ6CisJCXJldHVybiBmYWxzZTsKKwl9Cit9CisKK3N0
YXRpYyBpbnQgc2tsX3BsYW5lX2NoZWNrX2ZiKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlLAorCQkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpw
bGFuZV9zdGF0ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxh
bmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKKwljb25zdCBzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKKwl1bnNpZ25lZCBpbnQgcm90YXRp
b24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247CisJc3RydWN0IGRybV9mb3JtYXRfbmFtZV9i
dWYgZm9ybWF0X25hbWU7CisKKwlpZiAoIWZiKQorCQlyZXR1cm4gMDsKKworCWlmIChyb3RhdGlv
biAmIH4oRFJNX01PREVfUk9UQVRFXzAgfCBEUk1fTU9ERV9ST1RBVEVfMTgwKSAmJgorCSAgICBp
c19jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSkgeworCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYt
PmRybSwKKwkJCSAgICAiUkMgc3VwcG9ydCBvbmx5IHdpdGggMC8xODAgZGVncmVlIHJvdGF0aW9u
ICgleClcbiIsCisJCQkgICAgcm90YXRpb24pOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlp
ZiAocm90YXRpb24gJiBEUk1fTU9ERV9SRUZMRUNUX1ggJiYKKwkgICAgZmItPm1vZGlmaWVyID09
IERSTV9GT1JNQVRfTU9EX0xJTkVBUikgeworCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwK
KwkJCSAgICAiaG9yaXpvbnRhbCBmbGlwIGlzIG5vdCBzdXBwb3J0ZWQgd2l0aCBsaW5lYXIgc3Vy
ZmFjZSBmb3JtYXRzXG4iKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJaWYgKGRybV9yb3Rh
dGlvbl85MF9vcl8yNzAocm90YXRpb24pKSB7CisJCWlmIChmYi0+bW9kaWZpZXIgIT0gSTkxNV9G
T1JNQVRfTU9EX1lfVElMRUQgJiYKKwkJICAgIGZiLT5tb2RpZmllciAhPSBJOTE1X0ZPUk1BVF9N
T0RfWWZfVElMRUQpIHsKKwkJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJCSAgICAi
WS9ZZiB0aWxpbmcgcmVxdWlyZWQgZm9yIDkwLzI3MCFcbiIpOworCQkJcmV0dXJuIC1FSU5WQUw7
CisJCX0KKworCQkvKgorCQkgKiA5MC8yNzAgaXMgbm90IGFsbG93ZWQgd2l0aCBSR0I2NCAxNjox
NjoxNjoxNiBhbmQKKwkJICogSW5kZXhlZCA4LWJpdC4gUkdCIDE2LWJpdCA1OjY6NSBpcyBhbGxv
d2VkIGdlbjExIG9ud2FyZHMuCisJCSAqLworCQlzd2l0Y2ggKGZiLT5mb3JtYXQtPmZvcm1hdCkg
eworCQljYXNlIERSTV9GT1JNQVRfUkdCNTY1OgorCQkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikg
Pj0gMTEpCisJCQkJYnJlYWs7CisJCQlmYWxsdGhyb3VnaDsKKwkJY2FzZSBEUk1fRk9STUFUX0M4
OgorCQljYXNlIERSTV9GT1JNQVRfWFJHQjE2MTYxNjE2RjoKKwkJY2FzZSBEUk1fRk9STUFUX1hC
R1IxNjE2MTYxNkY6CisJCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMTYxNjE2MTZGOgorCQljYXNlIERS
TV9GT1JNQVRfQUJHUjE2MTYxNjE2RjoKKwkJY2FzZSBEUk1fRk9STUFUX1kyMTA6CisJCWNhc2Ug
RFJNX0ZPUk1BVF9ZMjEyOgorCQljYXNlIERSTV9GT1JNQVRfWTIxNjoKKwkJY2FzZSBEUk1fRk9S
TUFUX1hWWVUxMl8xNjE2MTYxNjoKKwkJY2FzZSBEUk1fRk9STUFUX1hWWVUxNjE2MTYxNjoKKwkJ
CWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJCSAgICAiVW5zdXBwb3J0ZWQgcGl4ZWwg
Zm9ybWF0ICVzIGZvciA5MC8yNzAhXG4iLAorCQkJCSAgICBkcm1fZ2V0X2Zvcm1hdF9uYW1lKGZi
LT5mb3JtYXQtPmZvcm1hdCwKKwkJCQkJCQkmZm9ybWF0X25hbWUpKTsKKwkJCXJldHVybiAtRUlO
VkFMOworCQlkZWZhdWx0OgorCQkJYnJlYWs7CisJCX0KKwl9CisKKwkvKiBZLXRpbGluZyBpcyBu
b3Qgc3VwcG9ydGVkIGluIElGLUlEIEludGVybGFjZSBtb2RlICovCisJaWYgKGNydGNfc3RhdGUt
Pmh3LmVuYWJsZSAmJgorCSAgICBjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlLmZsYWdzICYg
RFJNX01PREVfRkxBR19JTlRFUkxBQ0UgJiYKKwkgICAgKGZiLT5tb2RpZmllciA9PSBJOTE1X0ZP
Uk1BVF9NT0RfWV9USUxFRCB8fAorCSAgICAgZmItPm1vZGlmaWVyID09IEk5MTVfRk9STUFUX01P
RF9ZZl9USUxFRCB8fAorCSAgICAgZmItPm1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJ
TEVEX0NDUyB8fAorCSAgICAgZmItPm1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZZl9USUxF
RF9DQ1MgfHwKKwkgICAgIGZiLT5tb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9H
RU4xMl9SQ19DQ1MgfHwKKwkgICAgIGZiLT5tb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9U
SUxFRF9HRU4xMl9NQ19DQ1MpKSB7CisJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJ
ICAgICJZL1lmIHRpbGluZyBub3Qgc3VwcG9ydGVkIGluIElGLUlEIG1vZGVcbiIpOworCQlyZXR1
cm4gLUVJTlZBTDsKKwl9CisKKwkvKiBXYV8xNjA2MDU0MTg4OnRnbCAqLworCWlmIChJU19USUdF
UkxBS0UoZGV2X3ByaXYpICYmCisJICAgIHBsYW5lX3N0YXRlLT5ja2V5LmZsYWdzICYgSTkxNV9T
RVRfQ09MT1JLRVlfU09VUkNFICYmCisJICAgIGludGVsX2Zvcm1hdF9pc19wMDF4KGZiLT5mb3Jt
YXQtPmZvcm1hdCkpIHsKKwkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCQkgICAgIlNv
dXJjZSBjb2xvciBrZXlpbmcgbm90IHN1cHBvcnRlZCB3aXRoIFAwMXggZm9ybWF0c1xuIik7CisJ
CXJldHVybiAtRUlOVkFMOworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IHNrbF9w
bGFuZV9jaGVja19kc3RfY29vcmRpbmF0ZXMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUsCisJCQkJCSAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxh
bmVfc3RhdGUpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KKwkJdG9f
aTkxNShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZS0+ZGV2KTsKKwlpbnQgY3J0Y194ID0gcGxhbmVf
c3RhdGUtPnVhcGkuZHN0LngxOworCWludCBjcnRjX3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVf
c3RhdGUtPnVhcGkuZHN0KTsKKwlpbnQgcGlwZV9zcmNfdyA9IGNydGNfc3RhdGUtPnBpcGVfc3Jj
X3c7CisKKwkvKgorCSAqIERpc3BsYXkgV0EgIzExNzU6IGNubCxnbGsKKwkgKiBQbGFuZXMgb3Ro
ZXIgdGhhbiB0aGUgY3Vyc29yIG1heSBjYXVzZSBGSUZPIHVuZGVyZmxvdyBhbmQgZGlzcGxheQor
CSAqIGNvcnJ1cHRpb24gaWYgc3RhcnRpbmcgbGVzcyB0aGFuIDQgcGl4ZWxzIGZyb20gdGhlIHJp
Z2h0IGVkZ2Ugb2YKKwkgKiB0aGUgc2NyZWVuLgorCSAqIEJlc2lkZXMgdGhlIGFib3ZlIFdBIGZp
eCB0aGUgc2ltaWxhciBwcm9ibGVtLCB3aGVyZSBwbGFuZXMgb3RoZXIKKwkgKiB0aGFuIHRoZSBj
dXJzb3IgZW5kaW5nIGxlc3MgdGhhbiA0IHBpeGVscyBmcm9tIHRoZSBsZWZ0IGVkZ2Ugb2YgdGhl
CisJICogc2NyZWVuIG1heSBjYXVzZSBGSUZPIHVuZGVyZmxvdyBhbmQgZGlzcGxheSBjb3JydXB0
aW9uLgorCSAqLworCWlmICgoSVNfR0VNSU5JTEFLRShkZXZfcHJpdikgfHwgSVNfQ0FOTk9OTEFL
RShkZXZfcHJpdikpICYmCisJICAgIChjcnRjX3ggKyBjcnRjX3cgPCA0IHx8IGNydGNfeCA+IHBp
cGVfc3JjX3cgLSA0KSkgeworCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwkJCSAgICAi
cmVxdWVzdGVkIHBsYW5lIFggJXMgcG9zaXRpb24gJWQgaW52YWxpZCAodmFsaWQgcmFuZ2UgJWQt
JWQpXG4iLAorCQkJICAgIGNydGNfeCArIGNydGNfdyA8IDQgPyAiZW5kIiA6ICJzdGFydCIsCisJ
CQkgICAgY3J0Y194ICsgY3J0Y193IDwgNCA/IGNydGNfeCArIGNydGNfdyA6IGNydGNfeCwKKwkJ
CSAgICA0LCBwaXBlX3NyY193IC0gNCk7CisJCXJldHVybiAtRVJBTkdFOworCX0KKworCXJldHVy
biAwOworfQorCitzdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVja19udjEyX3JvdGF0aW9uKGNvbnN0
IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCit7CisJY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CisJdW5zaWduZWQgaW50
IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOworCWludCBzcmNfdyA9IGRybV9y
ZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OworCisJLyogRGlzcGxheSBX
QSAjMTEwNiAqLworCWlmIChpbnRlbF9mb3JtYXRfaW5mb19pc195dXZfc2VtaXBsYW5hcihmYi0+
Zm9ybWF0LCBmYi0+bW9kaWZpZXIpICYmCisJICAgIHNyY193ICYgMyAmJgorCSAgICAocm90YXRp
b24gPT0gRFJNX01PREVfUk9UQVRFXzI3MCB8fAorCSAgICAgcm90YXRpb24gPT0gKERSTV9NT0RF
X1JFRkxFQ1RfWCB8IERSTV9NT0RFX1JPVEFURV85MCkpKSB7CisJCURSTV9ERUJVR19LTVMoInNy
YyB3aWR0aCBtdXN0IGJlIG11bHRpcGxlIG9mIDQgZm9yIHJvdGF0ZWQgcGxhbmFyIFlVVlxuIik7
CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IHNr
bF9wbGFuZV9tYXhfc2NhbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorCQkJ
ICAgICAgIGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiKQoreworCS8qCisJICogV2Ug
ZG9uJ3QgeWV0IGtub3cgdGhlIGZpbmFsIHNvdXJjZSB3aWR0aCBub3IKKwkgKiB3aGV0aGVyIHdl
IGNhbiB1c2UgdGhlIEhRIHNjYWxlciBtb2RlLiBBc3N1bWUKKwkgKiB0aGUgYmVzdCBjYXNlLgor
CSAqIEZJWE1FIG5lZWQgdG8gcHJvcGVybHkgY2hlY2sgdGhpcyBsYXRlci4KKwkgKi8KKwlpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSB8fAor
CSAgICAhaW50ZWxfZm9ybWF0X2luZm9faXNfeXV2X3NlbWlwbGFuYXIoZmItPmZvcm1hdCwgZmIt
Pm1vZGlmaWVyKSkKKwkJcmV0dXJuIDB4MzAwMDAgLSAxOworCWVsc2UKKwkJcmV0dXJuIDB4MjAw
MDAgLSAxOworfQorCitzdGF0aWMgaW50IGludGVsX3BsYW5lX21pbl93aWR0aChzdHJ1Y3QgaW50
ZWxfcGxhbmUgKnBsYW5lLAorCQkJCSBjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwK
KwkJCQkgaW50IGNvbG9yX3BsYW5lLAorCQkJCSB1bnNpZ25lZCBpbnQgcm90YXRpb24pCit7CisJ
aWYgKHBsYW5lLT5taW5fd2lkdGgpCisJCXJldHVybiBwbGFuZS0+bWluX3dpZHRoKGZiLCBjb2xv
cl9wbGFuZSwgcm90YXRpb24pOworCWVsc2UKKwkJcmV0dXJuIDE7Cit9CisKK3N0YXRpYyBpbnQg
aW50ZWxfcGxhbmVfbWF4X3dpZHRoKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCisJCQkJIGNv
bnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAorCQkJCSBpbnQgY29sb3JfcGxhbmUsCisJ
CQkJIHVuc2lnbmVkIGludCByb3RhdGlvbikKK3sKKwlpZiAocGxhbmUtPm1heF93aWR0aCkKKwkJ
cmV0dXJuIHBsYW5lLT5tYXhfd2lkdGgoZmIsIGNvbG9yX3BsYW5lLCByb3RhdGlvbik7CisJZWxz
ZQorCQlyZXR1cm4gSU5UX01BWDsKK30KKworc3RhdGljIGludCBpbnRlbF9wbGFuZV9tYXhfaGVp
Z2h0KHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCisJCQkJICBjb25zdCBzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiwKKwkJCQkgIGludCBjb2xvcl9wbGFuZSwKKwkJCQkgIHVuc2lnbmVkIGlu
dCByb3RhdGlvbikKK3sKKwlpZiAocGxhbmUtPm1heF9oZWlnaHQpCisJCXJldHVybiBwbGFuZS0+
bWF4X2hlaWdodChmYiwgY29sb3JfcGxhbmUsIHJvdGF0aW9uKTsKKwllbHNlCisJCXJldHVybiBJ
TlRfTUFYOworfQorCitzdGF0aWMgYm9vbAorc2tsX2NoZWNrX21haW5fY2NzX2Nvb3JkaW5hdGVz
KHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCisJCQkgICAgICAgaW50IG1h
aW5feCwgaW50IG1haW5feSwgdTMyIG1haW5fb2Zmc2V0LAorCQkJICAgICAgIGludCBjY3NfcGxh
bmUpCit7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+
aHcuZmI7CisJaW50IGF1eF94ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0u
eDsKKwlpbnQgYXV4X3kgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS55Owor
CXUzMiBhdXhfb2Zmc2V0ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ub2Zm
c2V0OworCXUzMiBhbGlnbm1lbnQgPSBpbnRlbF9zdXJmX2FsaWdubWVudChmYiwgY2NzX3BsYW5l
KTsKKwlpbnQgaHN1YjsKKwlpbnQgdnN1YjsKKworCWludGVsX2ZiX3BsYW5lX2dldF9zdWJzYW1w
bGluZygmaHN1YiwgJnZzdWIsIGZiLCBjY3NfcGxhbmUpOworCXdoaWxlIChhdXhfb2Zmc2V0ID49
IG1haW5fb2Zmc2V0ICYmIGF1eF95IDw9IG1haW5feSkgeworCQlpbnQgeCwgeTsKKworCQlpZiAo
YXV4X3ggPT0gbWFpbl94ICYmIGF1eF95ID09IG1haW5feSkKKwkJCWJyZWFrOworCisJCWlmIChh
dXhfb2Zmc2V0ID09IDApCisJCQlicmVhazsKKworCQl4ID0gYXV4X3ggLyBoc3ViOworCQl5ID0g
YXV4X3kgLyB2c3ViOworCQlhdXhfb2Zmc2V0ID0gaW50ZWxfcGxhbmVfYWRqdXN0X2FsaWduZWRf
b2Zmc2V0KCZ4LCAmeSwKKwkJCQkJCQkgICAgICAgcGxhbmVfc3RhdGUsCisJCQkJCQkJICAgICAg
IGNjc19wbGFuZSwKKwkJCQkJCQkgICAgICAgYXV4X29mZnNldCwKKwkJCQkJCQkgICAgICAgYXV4
X29mZnNldCAtCisJCQkJCQkJCWFsaWdubWVudCk7CisJCWF1eF94ID0geCAqIGhzdWIgKyBhdXhf
eCAlIGhzdWI7CisJCWF1eF95ID0geSAqIHZzdWIgKyBhdXhfeSAlIHZzdWI7CisJfQorCisJaWYg
KGF1eF94ICE9IG1haW5feCB8fCBhdXhfeSAhPSBtYWluX3kpCisJCXJldHVybiBmYWxzZTsKKwor
CXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLm9mZnNldCA9IGF1eF9vZmZzZXQ7
CisJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueCA9IGF1eF94OworCXBsYW5l
X3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLnkgPSBhdXhfeTsKKworCXJldHVybiB0cnVl
OworfQorCitzdGF0aWMgaW50IHNrbF9jaGVja19tYWluX3N1cmZhY2Uoc3RydWN0IGludGVsX3Bs
YW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0g
dG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKKwljb25zdCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKKwl1bnNpZ25l
ZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247CisJaW50IHggPSBwbGFu
ZV9zdGF0ZS0+dWFwaS5zcmMueDEgPj4gMTY7CisJaW50IHkgPSBwbGFuZV9zdGF0ZS0+dWFwaS5z
cmMueTEgPj4gMTY7CisJaW50IHcgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGku
c3JjKSA+PiAxNjsKKwlpbnQgaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVfc3RhdGUtPnVhcGku
c3JjKSA+PiAxNjsKKwlpbnQgbWluX3dpZHRoID0gaW50ZWxfcGxhbmVfbWluX3dpZHRoKHBsYW5l
LCBmYiwgMCwgcm90YXRpb24pOworCWludCBtYXhfd2lkdGggPSBpbnRlbF9wbGFuZV9tYXhfd2lk
dGgocGxhbmUsIGZiLCAwLCByb3RhdGlvbik7CisJaW50IG1heF9oZWlnaHQgPSBpbnRlbF9wbGFu
ZV9tYXhfaGVpZ2h0KHBsYW5lLCBmYiwgMCwgcm90YXRpb24pOworCWludCBhdXhfcGxhbmUgPSBp
bnRlbF9tYWluX3RvX2F1eF9wbGFuZShmYiwgMCk7CisJdTMyIGF1eF9vZmZzZXQgPSBwbGFuZV9z
dGF0ZS0+Y29sb3JfcGxhbmVbYXV4X3BsYW5lXS5vZmZzZXQ7CisJdTMyIGFsaWdubWVudCwgb2Zm
c2V0OworCisJaWYgKHcgPiBtYXhfd2lkdGggfHwgdyA8IG1pbl93aWR0aCB8fCBoID4gbWF4X2hl
aWdodCkgeworCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwkJCSAgICAicmVxdWVzdGVk
IFkvUkdCIHNvdXJjZSBzaXplICVkeCVkIG91dHNpZGUgbGltaXRzIChtaW46ICVkeDEgbWF4OiAl
ZHglZClcbiIsCisJCQkgICAgdywgaCwgbWluX3dpZHRoLCBtYXhfd2lkdGgsIG1heF9oZWlnaHQp
OworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlpbnRlbF9hZGRfZmJfb2Zmc2V0cygmeCwgJnks
IHBsYW5lX3N0YXRlLCAwKTsKKwlvZmZzZXQgPSBpbnRlbF9wbGFuZV9jb21wdXRlX2FsaWduZWRf
b2Zmc2V0KCZ4LCAmeSwgcGxhbmVfc3RhdGUsIDApOworCWFsaWdubWVudCA9IGludGVsX3N1cmZf
YWxpZ25tZW50KGZiLCAwKTsKKwlpZiAoZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIGFsaWdu
bWVudCAmJiAhaXNfcG93ZXJfb2ZfMihhbGlnbm1lbnQpKSkKKwkJcmV0dXJuIC1FSU5WQUw7CisK
KwkvKgorCSAqIEFVWCBzdXJmYWNlIG9mZnNldCBpcyBzcGVjaWZpZWQgYXMgdGhlIGRpc3RhbmNl
IGZyb20gdGhlCisJICogbWFpbiBzdXJmYWNlIG9mZnNldCwgYW5kIGl0IG11c3QgYmUgbm9uLW5l
Z2F0aXZlLiBNYWtlCisJICogc3VyZSB0aGF0IGlzIHdoYXQgd2Ugd2lsbCBnZXQuCisJICovCisJ
aWYgKGF1eF9wbGFuZSAmJiBvZmZzZXQgPiBhdXhfb2Zmc2V0KQorCQlvZmZzZXQgPSBpbnRlbF9w
bGFuZV9hZGp1c3RfYWxpZ25lZF9vZmZzZXQoJngsICZ5LCBwbGFuZV9zdGF0ZSwgMCwKKwkJCQkJ
CQkgICBvZmZzZXQsIGF1eF9vZmZzZXQgJiB+KGFsaWdubWVudCAtIDEpKTsKKworCS8qCisJICog
V2hlbiB1c2luZyBhbiBYLXRpbGVkIHN1cmZhY2UsIHRoZSBwbGFuZSBibG93cyB1cAorCSAqIGlm
IHRoZSB4IG9mZnNldCArIHdpZHRoIGV4Y2VlZCB0aGUgc3RyaWRlLgorCSAqCisJICogVE9ETzog
bGluZWFyIGFuZCBZLXRpbGVkIHNlZW0gZmluZSwgWWYgdW50ZXN0ZWQsCisJICovCisJaWYgKGZi
LT5tb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRCkgeworCQlpbnQgY3BwID0gZmIt
PmZvcm1hdC0+Y3BwWzBdOworCisJCXdoaWxlICgoeCArIHcpICogY3BwID4gcGxhbmVfc3RhdGUt
PmNvbG9yX3BsYW5lWzBdLnN0cmlkZSkgeworCQkJaWYgKG9mZnNldCA9PSAwKSB7CisJCQkJZHJt
X2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCQkJCSAgICAiVW5hYmxlIHRvIGZpbmQgc3VpdGFi
bGUgZGlzcGxheSBzdXJmYWNlIG9mZnNldCBkdWUgdG8gWC10aWxpbmdcbiIpOworCQkJCXJldHVy
biAtRUlOVkFMOworCQkJfQorCisJCQlvZmZzZXQgPSBpbnRlbF9wbGFuZV9hZGp1c3RfYWxpZ25l
ZF9vZmZzZXQoJngsICZ5LCBwbGFuZV9zdGF0ZSwgMCwKKwkJCQkJCQkJICAgb2Zmc2V0LCBvZmZz
ZXQgLSBhbGlnbm1lbnQpOworCQl9CisJfQorCisJLyoKKwkgKiBDQ1MgQVVYIHN1cmZhY2UgZG9l
c24ndCBoYXZlIGl0cyBvd24geC95IG9mZnNldHMsIHdlIG11c3QgbWFrZSBzdXJlCisJICogdGhl
eSBtYXRjaCB3aXRoIHRoZSBtYWluIHN1cmZhY2UgeC95IG9mZnNldHMuCisJICovCisJaWYgKGlz
X2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpKSB7CisJCXdoaWxlICghc2tsX2NoZWNrX21haW5f
Y2NzX2Nvb3JkaW5hdGVzKHBsYW5lX3N0YXRlLCB4LCB5LAorCQkJCQkJICAgICAgIG9mZnNldCwg
YXV4X3BsYW5lKSkgeworCQkJaWYgKG9mZnNldCA9PSAwKQorCQkJCWJyZWFrOworCisJCQlvZmZz
ZXQgPSBpbnRlbF9wbGFuZV9hZGp1c3RfYWxpZ25lZF9vZmZzZXQoJngsICZ5LCBwbGFuZV9zdGF0
ZSwgMCwKKwkJCQkJCQkJICAgb2Zmc2V0LCBvZmZzZXQgLSBhbGlnbm1lbnQpOworCQl9CisKKwkJ
aWYgKHggIT0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2F1eF9wbGFuZV0ueCB8fAorCQkgICAg
eSAhPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbYXV4X3BsYW5lXS55KSB7CisJCQlkcm1fZGJn
X2ttcygmZGV2X3ByaXYtPmRybSwKKwkJCQkgICAgIlVuYWJsZSB0byBmaW5kIHN1aXRhYmxlIGRp
c3BsYXkgc3VyZmFjZSBvZmZzZXQgZHVlIHRvIENDU1xuIik7CisJCQlyZXR1cm4gLUVJTlZBTDsK
KwkJfQorCX0KKworCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS5vZmZzZXQgPSBvZmZzZXQ7
CisJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLnggPSB4OworCXBsYW5lX3N0YXRlLT5jb2xv
cl9wbGFuZVswXS55ID0geTsKKworCS8qCisJICogUHV0IHRoZSBmaW5hbCBjb29yZGluYXRlcyBi
YWNrIHNvIHRoYXQgdGhlIHNyYworCSAqIGNvb3JkaW5hdGUgY2hlY2tzIHdpbGwgc2VlIHRoZSBy
aWdodCB2YWx1ZXMuCisJICovCisJZHJtX3JlY3RfdHJhbnNsYXRlX3RvKCZwbGFuZV9zdGF0ZS0+
dWFwaS5zcmMsCisJCQkgICAgICB4IDw8IDE2LCB5IDw8IDE2KTsKKworCXJldHVybiAwOworfQor
CitzdGF0aWMgaW50IHNrbF9jaGVja19udjEyX2F1eF9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFu
ZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCit7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRv
X2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKKwljb25zdCBzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKKwl1bnNpZ25lZCBpbnQg
cm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247CisJaW50IHV2X3BsYW5lID0gMTsK
KwlpbnQgbWF4X3dpZHRoID0gaW50ZWxfcGxhbmVfbWF4X3dpZHRoKHBsYW5lLCBmYiwgdXZfcGxh
bmUsIHJvdGF0aW9uKTsKKwlpbnQgbWF4X2hlaWdodCA9IGludGVsX3BsYW5lX21heF9oZWlnaHQo
cGxhbmUsIGZiLCB1dl9wbGFuZSwgcm90YXRpb24pOworCWludCB4ID0gcGxhbmVfc3RhdGUtPnVh
cGkuc3JjLngxID4+IDE3OworCWludCB5ID0gcGxhbmVfc3RhdGUtPnVhcGkuc3JjLnkxID4+IDE3
OworCWludCB3ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTc7
CisJaW50IGggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTc7
CisJdTMyIG9mZnNldDsKKworCS8qIEZJWE1FIG5vdCBxdWl0ZSBzdXJlIGhvdy9pZiB0aGVzZSBh
cHBseSB0byB0aGUgY2hyb21hIHBsYW5lICovCisJaWYgKHcgPiBtYXhfd2lkdGggfHwgaCA+IG1h
eF9oZWlnaHQpIHsKKwkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKKwkJCSAgICAiQ2JDciBzb3Vy
Y2Ugc2l6ZSAlZHglZCB0b28gYmlnIChsaW1pdCAlZHglZClcbiIsCisJCQkgICAgdywgaCwgbWF4
X3dpZHRoLCBtYXhfaGVpZ2h0KTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJaW50ZWxfYWRk
X2ZiX29mZnNldHMoJngsICZ5LCBwbGFuZV9zdGF0ZSwgdXZfcGxhbmUpOworCW9mZnNldCA9IGlu
dGVsX3BsYW5lX2NvbXB1dGVfYWxpZ25lZF9vZmZzZXQoJngsICZ5LAorCQkJCQkJICAgIHBsYW5l
X3N0YXRlLCB1dl9wbGFuZSk7CisKKwlpZiAoaXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikp
IHsKKwkJaW50IGNjc19wbGFuZSA9IG1haW5fdG9fY2NzX3BsYW5lKGZiLCB1dl9wbGFuZSk7CisJ
CXUzMiBhdXhfb2Zmc2V0ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ub2Zm
c2V0OworCQl1MzIgYWxpZ25tZW50ID0gaW50ZWxfc3VyZl9hbGlnbm1lbnQoZmIsIHV2X3BsYW5l
KTsKKworCQlpZiAob2Zmc2V0ID4gYXV4X29mZnNldCkKKwkJCW9mZnNldCA9IGludGVsX3BsYW5l
X2FkanVzdF9hbGlnbmVkX29mZnNldCgmeCwgJnksCisJCQkJCQkJCSAgIHBsYW5lX3N0YXRlLAor
CQkJCQkJCQkgICB1dl9wbGFuZSwKKwkJCQkJCQkJICAgb2Zmc2V0LAorCQkJCQkJCQkgICBhdXhf
b2Zmc2V0ICYgfihhbGlnbm1lbnQgLSAxKSk7CisKKwkJd2hpbGUgKCFza2xfY2hlY2tfbWFpbl9j
Y3NfY29vcmRpbmF0ZXMocGxhbmVfc3RhdGUsIHgsIHksCisJCQkJCQkgICAgICAgb2Zmc2V0LCBj
Y3NfcGxhbmUpKSB7CisJCQlpZiAob2Zmc2V0ID09IDApCisJCQkJYnJlYWs7CisKKwkJCW9mZnNl
dCA9IGludGVsX3BsYW5lX2FkanVzdF9hbGlnbmVkX29mZnNldCgmeCwgJnksCisJCQkJCQkJCSAg
IHBsYW5lX3N0YXRlLAorCQkJCQkJCQkgICB1dl9wbGFuZSwKKwkJCQkJCQkJICAgb2Zmc2V0LCBv
ZmZzZXQgLSBhbGlnbm1lbnQpOworCQl9CisKKwkJaWYgKHggIT0gcGxhbmVfc3RhdGUtPmNvbG9y
X3BsYW5lW2Njc19wbGFuZV0ueCB8fAorCQkgICAgeSAhPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxh
bmVbY2NzX3BsYW5lXS55KSB7CisJCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAorCQkJCSAgICAi
VW5hYmxlIHRvIGZpbmQgc3VpdGFibGUgZGlzcGxheSBzdXJmYWNlIG9mZnNldCBkdWUgdG8gQ0NT
XG4iKTsKKwkJCXJldHVybiAtRUlOVkFMOworCQl9CisJfQorCisJcGxhbmVfc3RhdGUtPmNvbG9y
X3BsYW5lW3V2X3BsYW5lXS5vZmZzZXQgPSBvZmZzZXQ7CisJcGxhbmVfc3RhdGUtPmNvbG9yX3Bs
YW5lW3V2X3BsYW5lXS54ID0geDsKKwlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbdXZfcGxhbmVd
LnkgPSB5OworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgc2tsX2NoZWNrX2Njc19hdXhf
c3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQoreworCWNvbnN0
IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOworCWludCBz
cmNfeCA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy54MSA+PiAxNjsKKwlpbnQgc3JjX3kgPSBwbGFu
ZV9zdGF0ZS0+dWFwaS5zcmMueTEgPj4gMTY7CisJdTMyIG9mZnNldDsKKwlpbnQgY2NzX3BsYW5l
OworCisJZm9yIChjY3NfcGxhbmUgPSAwOyBjY3NfcGxhbmUgPCBmYi0+Zm9ybWF0LT5udW1fcGxh
bmVzOyBjY3NfcGxhbmUrKykgeworCQlpbnQgbWFpbl9oc3ViLCBtYWluX3ZzdWI7CisJCWludCBo
c3ViLCB2c3ViOworCQlpbnQgeCwgeTsKKworCQlpZiAoIWlzX2Njc19wbGFuZShmYiwgY2NzX3Bs
YW5lKSkKKwkJCWNvbnRpbnVlOworCisJCWludGVsX2ZiX3BsYW5lX2dldF9zdWJzYW1wbGluZygm
bWFpbl9oc3ViLCAmbWFpbl92c3ViLCBmYiwKKwkJCQkJICAgICAgIGNjc190b19tYWluX3BsYW5l
KGZiLCBjY3NfcGxhbmUpKTsKKwkJaW50ZWxfZmJfcGxhbmVfZ2V0X3N1YnNhbXBsaW5nKCZoc3Vi
LCAmdnN1YiwgZmIsIGNjc19wbGFuZSk7CisKKwkJaHN1YiAqPSBtYWluX2hzdWI7CisJCXZzdWIg
Kj0gbWFpbl92c3ViOworCQl4ID0gc3JjX3ggLyBoc3ViOworCQl5ID0gc3JjX3kgLyB2c3ViOwor
CisJCWludGVsX2FkZF9mYl9vZmZzZXRzKCZ4LCAmeSwgcGxhbmVfc3RhdGUsIGNjc19wbGFuZSk7
CisKKwkJb2Zmc2V0ID0gaW50ZWxfcGxhbmVfY29tcHV0ZV9hbGlnbmVkX29mZnNldCgmeCwgJnks
CisJCQkJCQkJICAgIHBsYW5lX3N0YXRlLAorCQkJCQkJCSAgICBjY3NfcGxhbmUpOworCisJCXBs
YW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLm9mZnNldCA9IG9mZnNldDsKKwkJcGxh
bmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueCA9ICh4ICogaHN1YiArCisJCQkJCQkJ
IHNyY194ICUgaHN1YikgLworCQkJCQkJCW1haW5faHN1YjsKKwkJcGxhbmVfc3RhdGUtPmNvbG9y
X3BsYW5lW2Njc19wbGFuZV0ueSA9ICh5ICogdnN1YiArCisJCQkJCQkJIHNyY195ICUgdnN1Yikg
LworCQkJCQkJCW1haW5fdnN1YjsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBz
a2xfY2hlY2tfcGxhbmVfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0
YXRlKQoreworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUt
Pmh3LmZiOworCWludCByZXQsIGk7CisKKwlyZXQgPSBpbnRlbF9wbGFuZV9jb21wdXRlX2d0dChw
bGFuZV9zdGF0ZSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCWlmICghcGxhbmVfc3Rh
dGUtPnVhcGkudmlzaWJsZSkKKwkJcmV0dXJuIDA7CisKKwkvKgorCSAqIEhhbmRsZSB0aGUgQVVY
IHN1cmZhY2UgZmlyc3Qgc2luY2UgdGhlIG1haW4gc3VyZmFjZSBzZXR1cCBkZXBlbmRzIG9uCisJ
ICogaXQuCisJICovCisJaWYgKGlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpKSB7CisJCXJl
dCA9IHNrbF9jaGVja19jY3NfYXV4X3N1cmZhY2UocGxhbmVfc3RhdGUpOworCQlpZiAocmV0KQor
CQkJcmV0dXJuIHJldDsKKwl9CisKKwlpZiAoaW50ZWxfZm9ybWF0X2luZm9faXNfeXV2X3NlbWlw
bGFuYXIoZmItPmZvcm1hdCwKKwkJCQkJCWZiLT5tb2RpZmllcikpIHsKKwkJcmV0ID0gc2tsX2No
ZWNrX252MTJfYXV4X3N1cmZhY2UocGxhbmVfc3RhdGUpOworCQlpZiAocmV0KQorCQkJcmV0dXJu
IHJldDsKKwl9CisKKwlmb3IgKGkgPSBmYi0+Zm9ybWF0LT5udW1fcGxhbmVzOyBpIDwgQVJSQVlf
U0laRShwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmUpOyBpKyspIHsKKwkJcGxhbmVfc3RhdGUtPmNv
bG9yX3BsYW5lW2ldLm9mZnNldCA9IDA7CisJCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtpXS54
ID0gMDsKKwkJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2ldLnkgPSAwOworCX0KKworCXJldCA9
IHNrbF9jaGVja19tYWluX3N1cmZhY2UocGxhbmVfc3RhdGUpOworCWlmIChyZXQpCisJCXJldHVy
biByZXQ7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGJvb2wgaW50ZWxfZmJfc2NhbGFibGUo
Y29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIpCit7CisJaWYgKCFmYikKKwkJcmV0dXJu
IGZhbHNlOworCisJc3dpdGNoIChmYi0+Zm9ybWF0LT5mb3JtYXQpIHsKKwljYXNlIERSTV9GT1JN
QVRfQzg6CisJCXJldHVybiBmYWxzZTsKKwljYXNlIERSTV9GT1JNQVRfWFJHQjE2MTYxNjE2RjoK
KwljYXNlIERSTV9GT1JNQVRfQVJHQjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfWEJHUjE2
MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfQUJHUjE2MTYxNjE2RjoKKwkJcmV0dXJuIElOVEVM
X0dFTih0b19pOTE1KGZiLT5kZXYpKSA+PSAxMTsKKwlkZWZhdWx0OgorCQlyZXR1cm4gdHJ1ZTsK
Kwl9Cit9CisKK3N0YXRpYyBpbnQgc2tsX3BsYW5lX2NoZWNrKHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlLAorCQkJICAgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9z
dGF0ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxh
bmVfc3RhdGUtPnVhcGkucGxhbmUpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKKwlpbnQgbWluX3NjYWxlID0gRFJNX1BMQU5F
X0hFTFBFUl9OT19TQ0FMSU5HOworCWludCBtYXhfc2NhbGUgPSBEUk1fUExBTkVfSEVMUEVSX05P
X1NDQUxJTkc7CisJaW50IHJldDsKKworCXJldCA9IHNrbF9wbGFuZV9jaGVja19mYihjcnRjX3N0
YXRlLCBwbGFuZV9zdGF0ZSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCS8qIHVzZSBz
Y2FsZXIgd2hlbiBjb2xvcmtleSBpcyBub3QgcmVxdWlyZWQgKi8KKwlpZiAoIXBsYW5lX3N0YXRl
LT5ja2V5LmZsYWdzICYmIGludGVsX2ZiX3NjYWxhYmxlKGZiKSkgeworCQltaW5fc2NhbGUgPSAx
OworCQltYXhfc2NhbGUgPSBza2xfcGxhbmVfbWF4X3NjYWxlKGRldl9wcml2LCBmYik7CisJfQor
CisJcmV0ID0gaW50ZWxfYXRvbWljX3BsYW5lX2NoZWNrX2NsaXBwaW5nKHBsYW5lX3N0YXRlLCBj
cnRjX3N0YXRlLAorCQkJCQkJbWluX3NjYWxlLCBtYXhfc2NhbGUsIHRydWUpOworCWlmIChyZXQp
CisJCXJldHVybiByZXQ7CisKKwlyZXQgPSBza2xfY2hlY2tfcGxhbmVfc3VyZmFjZShwbGFuZV9z
dGF0ZSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCWlmICghcGxhbmVfc3RhdGUtPnVh
cGkudmlzaWJsZSkKKwkJcmV0dXJuIDA7CisKKwlyZXQgPSBza2xfcGxhbmVfY2hlY2tfZHN0X2Nv
b3JkaW5hdGVzKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKTsKKwlpZiAocmV0KQorCQlyZXR1cm4g
cmV0OworCisJcmV0ID0gaW50ZWxfcGxhbmVfY2hlY2tfc3JjX2Nvb3JkaW5hdGVzKHBsYW5lX3N0
YXRlKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJcmV0ID0gc2tsX3BsYW5lX2NoZWNr
X252MTJfcm90YXRpb24ocGxhbmVfc3RhdGUpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisK
KwkvKiBIVyBvbmx5IGhhcyA4IGJpdHMgcGl4ZWwgcHJlY2lzaW9uLCBkaXNhYmxlIHBsYW5lIGlm
IGludmlzaWJsZSAqLworCWlmICghKHBsYW5lX3N0YXRlLT5ody5hbHBoYSA+PiA4KSkKKwkJcGxh
bmVfc3RhdGUtPnVhcGkudmlzaWJsZSA9IGZhbHNlOworCisJcGxhbmVfc3RhdGUtPmN0bCA9IHNr
bF9wbGFuZV9jdGwoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOworCisJaWYgKElOVEVMX0dFTihk
ZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCisJCXBsYW5lX3N0YXRl
LT5jb2xvcl9jdGwgPSBnbGtfcGxhbmVfY29sb3JfY3RsKGNydGNfc3RhdGUsCisJCQkJCQkJICAg
ICBwbGFuZV9zdGF0ZSk7CisKKwlpZiAoaW50ZWxfZm9ybWF0X2luZm9faXNfeXV2X3NlbWlwbGFu
YXIoZmItPmZvcm1hdCwgZmItPm1vZGlmaWVyKSAmJgorCSAgICBpY2xfaXNfaGRyX3BsYW5lKGRl
dl9wcml2LCBwbGFuZS0+aWQpKQorCQkvKiBFbmFibGUgYW5kIHVzZSBNUEVHLTIgY2hyb21hIHNp
dGluZyAqLworCQlwbGFuZV9zdGF0ZS0+Y3VzX2N0bCA9IFBMQU5FX0NVU19FTkFCTEUgfAorCQkJ
UExBTkVfQ1VTX0hQSEFTRV8wIHwKKwkJCVBMQU5FX0NVU19WUEhBU0VfU0lHTl9ORUdBVElWRSB8
IFBMQU5FX0NVU19WUEhBU0VfMF8yNTsKKwllbHNlCisJCXBsYW5lX3N0YXRlLT5jdXNfY3RsID0g
MDsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgYm9vbCBza2xfcGxhbmVfaGFzX2ZiYyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJCQkgICAgICBlbnVtIHBpcGUgcGlwZSwg
ZW51bSBwbGFuZV9pZCBwbGFuZV9pZCkKK3sKKwlpZiAoIUhBU19GQkMoZGV2X3ByaXYpKQorCQly
ZXR1cm4gZmFsc2U7CisKKwlyZXR1cm4gcGlwZSA9PSBQSVBFX0EgJiYgcGxhbmVfaWQgPT0gUExB
TkVfUFJJTUFSWTsKK30KKworc3RhdGljIGJvb2wgc2tsX3BsYW5lX2hhc19wbGFuYXIoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorCQkJCSBlbnVtIHBpcGUgcGlwZSwgZW51bSBw
bGFuZV9pZCBwbGFuZV9pZCkKK3sKKwkvKiBEaXNwbGF5IFdBICMwODcwOiBza2wsIGJ4dCAqLwor
CWlmIChJU19TS1lMQUtFKGRldl9wcml2KSB8fCBJU19CUk9YVE9OKGRldl9wcml2KSkKKwkJcmV0
dXJuIGZhbHNlOworCisJaWYgKElTX0dFTihkZXZfcHJpdiwgOSkgJiYgIUlTX0dFTUlOSUxBS0Uo
ZGV2X3ByaXYpICYmIHBpcGUgPT0gUElQRV9DKQorCQlyZXR1cm4gZmFsc2U7CisKKwlpZiAocGxh
bmVfaWQgIT0gUExBTkVfUFJJTUFSWSAmJiBwbGFuZV9pZCAhPSBQTEFORV9TUFJJVEUwKQorCQly
ZXR1cm4gZmFsc2U7CisKKwlyZXR1cm4gdHJ1ZTsKK30KKworc3RhdGljIGNvbnN0IHUzMiAqc2ts
X2dldF9wbGFuZV9mb3JtYXRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJ
CQkJZW51bSBwaXBlIHBpcGUsIGVudW0gcGxhbmVfaWQgcGxhbmVfaWQsCisJCQkJCWludCAqbnVt
X2Zvcm1hdHMpCit7CisJaWYgKHNrbF9wbGFuZV9oYXNfcGxhbmFyKGRldl9wcml2LCBwaXBlLCBw
bGFuZV9pZCkpIHsKKwkJKm51bV9mb3JtYXRzID0gQVJSQVlfU0laRShza2xfcGxhbmFyX2Zvcm1h
dHMpOworCQlyZXR1cm4gc2tsX3BsYW5hcl9mb3JtYXRzOworCX0gZWxzZSB7CisJCSpudW1fZm9y
bWF0cyA9IEFSUkFZX1NJWkUoc2tsX3BsYW5lX2Zvcm1hdHMpOworCQlyZXR1cm4gc2tsX3BsYW5l
X2Zvcm1hdHM7CisJfQorfQorCitzdGF0aWMgY29uc3QgdTMyICpnbGtfZ2V0X3BsYW5lX2Zvcm1h
dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorCQkJCQllbnVtIHBpcGUgcGlw
ZSwgZW51bSBwbGFuZV9pZCBwbGFuZV9pZCwKKwkJCQkJaW50ICpudW1fZm9ybWF0cykKK3sKKwlp
ZiAoc2tsX3BsYW5lX2hhc19wbGFuYXIoZGV2X3ByaXYsIHBpcGUsIHBsYW5lX2lkKSkgeworCQkq
bnVtX2Zvcm1hdHMgPSBBUlJBWV9TSVpFKGdsa19wbGFuYXJfZm9ybWF0cyk7CisJCXJldHVybiBn
bGtfcGxhbmFyX2Zvcm1hdHM7CisJfSBlbHNlIHsKKwkJKm51bV9mb3JtYXRzID0gQVJSQVlfU0la
RShza2xfcGxhbmVfZm9ybWF0cyk7CisJCXJldHVybiBza2xfcGxhbmVfZm9ybWF0czsKKwl9Cit9
CisKK3N0YXRpYyBjb25zdCB1MzIgKmljbF9nZXRfcGxhbmVfZm9ybWF0cyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJCQkJCWVudW0gcGlwZSBwaXBlLCBlbnVtIHBsYW5lX2lk
IHBsYW5lX2lkLAorCQkJCQlpbnQgKm51bV9mb3JtYXRzKQoreworCWlmIChpY2xfaXNfaGRyX3Bs
YW5lKGRldl9wcml2LCBwbGFuZV9pZCkpIHsKKwkJKm51bV9mb3JtYXRzID0gQVJSQVlfU0laRShp
Y2xfaGRyX3BsYW5lX2Zvcm1hdHMpOworCQlyZXR1cm4gaWNsX2hkcl9wbGFuZV9mb3JtYXRzOwor
CX0gZWxzZSBpZiAoaWNsX2lzX252MTJfeV9wbGFuZShkZXZfcHJpdiwgcGxhbmVfaWQpKSB7CisJ
CSpudW1fZm9ybWF0cyA9IEFSUkFZX1NJWkUoaWNsX3Nkcl95X3BsYW5lX2Zvcm1hdHMpOworCQly
ZXR1cm4gaWNsX3Nkcl95X3BsYW5lX2Zvcm1hdHM7CisJfSBlbHNlIHsKKwkJKm51bV9mb3JtYXRz
ID0gQVJSQVlfU0laRShpY2xfc2RyX3V2X3BsYW5lX2Zvcm1hdHMpOworCQlyZXR1cm4gaWNsX3Nk
cl91dl9wbGFuZV9mb3JtYXRzOworCX0KK30KKworc3RhdGljIGJvb2wgc2tsX3BsYW5lX2hhc19j
Y3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorCQkJICAgICAgZW51bSBwaXBl
IHBpcGUsIGVudW0gcGxhbmVfaWQgcGxhbmVfaWQpCit7CisJaWYgKHBsYW5lX2lkID09IFBMQU5F
X0NVUlNPUikKKwkJcmV0dXJuIGZhbHNlOworCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
MTApCisJCXJldHVybiB0cnVlOworCisJaWYgKElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKQorCQly
ZXR1cm4gcGlwZSAhPSBQSVBFX0M7CisKKwlyZXR1cm4gcGlwZSAhPSBQSVBFX0MgJiYKKwkJKHBs
YW5lX2lkID09IFBMQU5FX1BSSU1BUlkgfHwKKwkJIHBsYW5lX2lkID09IFBMQU5FX1NQUklURTAp
OworfQorCitzdGF0aWMgYm9vbCBza2xfcGxhbmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQoc3RydWN0
IGRybV9wbGFuZSAqX3BsYW5lLAorCQkJCQkgICB1MzIgZm9ybWF0LCB1NjQgbW9kaWZpZXIpCit7
CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKF9wbGFuZSk7CisK
Kwlzd2l0Y2ggKG1vZGlmaWVyKSB7CisJY2FzZSBEUk1fRk9STUFUX01PRF9MSU5FQVI6CisJY2Fz
ZSBJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRDoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVE
OgorCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEOgorCQlicmVhazsKKwljYXNlIEk5MTVf
Rk9STUFUX01PRF9ZX1RJTEVEX0NDUzoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRF9D
Q1M6CisJCWlmICghcGxhbmUtPmhhc19jY3MpCisJCQlyZXR1cm4gZmFsc2U7CisJCWJyZWFrOwor
CWRlZmF1bHQ6CisJCXJldHVybiBmYWxzZTsKKwl9CisKKwlzd2l0Y2ggKGZvcm1hdCkgeworCWNh
c2UgRFJNX0ZPUk1BVF9YUkdCODg4ODoKKwljYXNlIERSTV9GT1JNQVRfWEJHUjg4ODg6CisJY2Fz
ZSBEUk1fRk9STUFUX0FSR0I4ODg4OgorCWNhc2UgRFJNX0ZPUk1BVF9BQkdSODg4ODoKKwkJaWYg
KGlzX2Njc19tb2RpZmllcihtb2RpZmllcikpCisJCQlyZXR1cm4gdHJ1ZTsKKwkJZmFsbHRocm91
Z2g7CisJY2FzZSBEUk1fRk9STUFUX1JHQjU2NToKKwljYXNlIERSTV9GT1JNQVRfWFJHQjIxMDEw
MTA6CisJY2FzZSBEUk1fRk9STUFUX1hCR1IyMTAxMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9BUkdC
MjEwMTAxMDoKKwljYXNlIERSTV9GT1JNQVRfQUJHUjIxMDEwMTA6CisJY2FzZSBEUk1fRk9STUFU
X1lVWVY6CisJY2FzZSBEUk1fRk9STUFUX1lWWVU6CisJY2FzZSBEUk1fRk9STUFUX1VZVlk6CisJ
Y2FzZSBEUk1fRk9STUFUX1ZZVVk6CisJY2FzZSBEUk1fRk9STUFUX05WMTI6CisJY2FzZSBEUk1f
Rk9STUFUX1hZVVY4ODg4OgorCWNhc2UgRFJNX0ZPUk1BVF9QMDEwOgorCWNhc2UgRFJNX0ZPUk1B
VF9QMDEyOgorCWNhc2UgRFJNX0ZPUk1BVF9QMDE2OgorCWNhc2UgRFJNX0ZPUk1BVF9YVllVMjEw
MTAxMDoKKwkJaWYgKG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRCkKKwkJCXJl
dHVybiB0cnVlOworCQlmYWxsdGhyb3VnaDsKKwljYXNlIERSTV9GT1JNQVRfQzg6CisJY2FzZSBE
Uk1fRk9STUFUX1hCR1IxNjE2MTYxNkY6CisJY2FzZSBEUk1fRk9STUFUX0FCR1IxNjE2MTYxNkY6
CisJY2FzZSBEUk1fRk9STUFUX1hSR0IxNjE2MTYxNkY6CisJY2FzZSBEUk1fRk9STUFUX0FSR0Ix
NjE2MTYxNkY6CisJY2FzZSBEUk1fRk9STUFUX1kyMTA6CisJY2FzZSBEUk1fRk9STUFUX1kyMTI6
CisJY2FzZSBEUk1fRk9STUFUX1kyMTY6CisJY2FzZSBEUk1fRk9STUFUX1hWWVUxMl8xNjE2MTYx
NjoKKwljYXNlIERSTV9GT1JNQVRfWFZZVTE2MTYxNjE2OgorCQlpZiAobW9kaWZpZXIgPT0gRFJN
X0ZPUk1BVF9NT0RfTElORUFSIHx8CisJCSAgICBtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0Rf
WF9USUxFRCB8fAorCQkgICAgbW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQpCisJ
CQlyZXR1cm4gdHJ1ZTsKKwkJZmFsbHRocm91Z2g7CisJZGVmYXVsdDoKKwkJcmV0dXJuIGZhbHNl
OworCX0KK30KKworc3RhdGljIGJvb2wgZ2VuMTJfcGxhbmVfc3VwcG9ydHNfbWNfY2NzKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCQkJZW51bSBwbGFuZV9pZCBwbGFuZV9p
ZCkKK3sKKwkvKiBXYV8xNDAxMDQ3NzAwODp0Z2xbYTAuLmMwXSxya2xbYWxsXSxkZzFbYWxsXSAq
LworCWlmIChJU19ERzEoZGV2X3ByaXYpIHx8IElTX1JPQ0tFVExBS0UoZGV2X3ByaXYpIHx8CisJ
ICAgIElTX1RHTF9ESVNQX1JFVklEKGRldl9wcml2LCBUR0xfUkVWSURfQTAsIFRHTF9SRVZJRF9D
MCkpCisJCXJldHVybiBmYWxzZTsKKworCXJldHVybiBwbGFuZV9pZCA8IFBMQU5FX1NQUklURTQ7
Cit9CisKK3N0YXRpYyBib29sIGdlbjEyX3BsYW5lX2Zvcm1hdF9tb2Rfc3VwcG9ydGVkKHN0cnVj
dCBkcm1fcGxhbmUgKl9wbGFuZSwKKwkJCQkJICAgICB1MzIgZm9ybWF0LCB1NjQgbW9kaWZpZXIp
Cit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShfcGxhbmUt
PmRldik7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKF9wbGFu
ZSk7CisKKwlzd2l0Y2ggKG1vZGlmaWVyKSB7CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxF
RF9HRU4xMl9NQ19DQ1M6CisJCWlmICghZ2VuMTJfcGxhbmVfc3VwcG9ydHNfbWNfY2NzKGRldl9w
cml2LCBwbGFuZS0+aWQpKQorCQkJcmV0dXJuIGZhbHNlOworCQlmYWxsdGhyb3VnaDsKKwljYXNl
IERSTV9GT1JNQVRfTU9EX0xJTkVBUjoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9YX1RJTEVEOgor
CWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQ6CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9U
SUxFRF9HRU4xMl9SQ19DQ1M6CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCXJldHVybiBmYWxzZTsK
Kwl9CisKKwlzd2l0Y2ggKGZvcm1hdCkgeworCWNhc2UgRFJNX0ZPUk1BVF9YUkdCODg4ODoKKwlj
YXNlIERSTV9GT1JNQVRfWEJHUjg4ODg6CisJY2FzZSBEUk1fRk9STUFUX0FSR0I4ODg4OgorCWNh
c2UgRFJNX0ZPUk1BVF9BQkdSODg4ODoKKwkJaWYgKGlzX2Njc19tb2RpZmllcihtb2RpZmllcikp
CisJCQlyZXR1cm4gdHJ1ZTsKKwkJZmFsbHRocm91Z2g7CisJY2FzZSBEUk1fRk9STUFUX1lVWVY6
CisJY2FzZSBEUk1fRk9STUFUX1lWWVU6CisJY2FzZSBEUk1fRk9STUFUX1VZVlk6CisJY2FzZSBE
Uk1fRk9STUFUX1ZZVVk6CisJY2FzZSBEUk1fRk9STUFUX05WMTI6CisJY2FzZSBEUk1fRk9STUFU
X1hZVVY4ODg4OgorCWNhc2UgRFJNX0ZPUk1BVF9QMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9QMDEy
OgorCWNhc2UgRFJNX0ZPUk1BVF9QMDE2OgorCQlpZiAobW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRf
TU9EX1lfVElMRURfR0VOMTJfTUNfQ0NTKQorCQkJcmV0dXJuIHRydWU7CisJCWZhbGx0aHJvdWdo
OworCWNhc2UgRFJNX0ZPUk1BVF9SR0I1NjU6CisJY2FzZSBEUk1fRk9STUFUX1hSR0IyMTAxMDEw
OgorCWNhc2UgRFJNX0ZPUk1BVF9YQkdSMjEwMTAxMDoKKwljYXNlIERSTV9GT1JNQVRfQVJHQjIx
MDEwMTA6CisJY2FzZSBEUk1fRk9STUFUX0FCR1IyMTAxMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9Y
VllVMjEwMTAxMDoKKwljYXNlIERSTV9GT1JNQVRfQzg6CisJY2FzZSBEUk1fRk9STUFUX1hCR1Ix
NjE2MTYxNkY6CisJY2FzZSBEUk1fRk9STUFUX0FCR1IxNjE2MTYxNkY6CisJY2FzZSBEUk1fRk9S
TUFUX1hSR0IxNjE2MTYxNkY6CisJY2FzZSBEUk1fRk9STUFUX0FSR0IxNjE2MTYxNkY6CisJY2Fz
ZSBEUk1fRk9STUFUX1kyMTA6CisJY2FzZSBEUk1fRk9STUFUX1kyMTI6CisJY2FzZSBEUk1fRk9S
TUFUX1kyMTY6CisJY2FzZSBEUk1fRk9STUFUX1hWWVUxMl8xNjE2MTYxNjoKKwljYXNlIERSTV9G
T1JNQVRfWFZZVTE2MTYxNjE2OgorCQlpZiAobW9kaWZpZXIgPT0gRFJNX0ZPUk1BVF9NT0RfTElO
RUFSIHx8CisJCSAgICBtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRCB8fAorCQkg
ICAgbW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQpCisJCQlyZXR1cm4gdHJ1ZTsK
KwkJZmFsbHRocm91Z2g7CisJZGVmYXVsdDoKKwkJcmV0dXJuIGZhbHNlOworCX0KK30KKworc3Rh
dGljIGNvbnN0IHU2NCAqZ2VuMTJfZ2V0X3BsYW5lX21vZGlmaWVycyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCisJCQkJCSAgICBlbnVtIHBsYW5lX2lkIHBsYW5lX2lkKQorewor
CWlmIChnZW4xMl9wbGFuZV9zdXBwb3J0c19tY19jY3MoZGV2X3ByaXYsIHBsYW5lX2lkKSkKKwkJ
cmV0dXJuIGdlbjEyX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfbWNfY2NzOworCWVsc2UKKwkJcmV0
dXJuIGdlbjEyX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfcmNfY2NzOworfQorCitzdGF0aWMgY29u
c3Qgc3RydWN0IGRybV9wbGFuZV9mdW5jcyBza2xfcGxhbmVfZnVuY3MgPSB7CisJLnVwZGF0ZV9w
bGFuZSA9IGRybV9hdG9taWNfaGVscGVyX3VwZGF0ZV9wbGFuZSwKKwkuZGlzYWJsZV9wbGFuZSA9
IGRybV9hdG9taWNfaGVscGVyX2Rpc2FibGVfcGxhbmUsCisJLmRlc3Ryb3kgPSBpbnRlbF9wbGFu
ZV9kZXN0cm95LAorCS5hdG9taWNfZHVwbGljYXRlX3N0YXRlID0gaW50ZWxfcGxhbmVfZHVwbGlj
YXRlX3N0YXRlLAorCS5hdG9taWNfZGVzdHJveV9zdGF0ZSA9IGludGVsX3BsYW5lX2Rlc3Ryb3lf
c3RhdGUsCisJLmZvcm1hdF9tb2Rfc3VwcG9ydGVkID0gc2tsX3BsYW5lX2Zvcm1hdF9tb2Rfc3Vw
cG9ydGVkLAorfTsKKworc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fcGxhbmVfZnVuY3MgZ2VuMTJf
cGxhbmVfZnVuY3MgPSB7CisJLnVwZGF0ZV9wbGFuZSA9IGRybV9hdG9taWNfaGVscGVyX3VwZGF0
ZV9wbGFuZSwKKwkuZGlzYWJsZV9wbGFuZSA9IGRybV9hdG9taWNfaGVscGVyX2Rpc2FibGVfcGxh
bmUsCisJLmRlc3Ryb3kgPSBpbnRlbF9wbGFuZV9kZXN0cm95LAorCS5hdG9taWNfZHVwbGljYXRl
X3N0YXRlID0gaW50ZWxfcGxhbmVfZHVwbGljYXRlX3N0YXRlLAorCS5hdG9taWNfZGVzdHJveV9z
dGF0ZSA9IGludGVsX3BsYW5lX2Rlc3Ryb3lfc3RhdGUsCisJLmZvcm1hdF9tb2Rfc3VwcG9ydGVk
ID0gZ2VuMTJfcGxhbmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQsCit9OworCitzdHJ1Y3QgaW50ZWxf
cGxhbmUgKgorc2tsX3VuaXZlcnNhbF9wbGFuZV9jcmVhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAorCQkJICAgZW51bSBwaXBlIHBpcGUsIGVudW0gcGxhbmVfaWQgcGxhbmVf
aWQpCit7CisJY29uc3Qgc3RydWN0IGRybV9wbGFuZV9mdW5jcyAqcGxhbmVfZnVuY3M7CisJc3Ry
dWN0IGludGVsX3BsYW5lICpwbGFuZTsKKwllbnVtIGRybV9wbGFuZV90eXBlIHBsYW5lX3R5cGU7
CisJdW5zaWduZWQgaW50IHN1cHBvcnRlZF9yb3RhdGlvbnM7CisJdW5zaWduZWQgaW50IHN1cHBv
cnRlZF9jc2M7CisJY29uc3QgdTY0ICptb2RpZmllcnM7CisJY29uc3QgdTMyICpmb3JtYXRzOwor
CWludCBudW1fZm9ybWF0czsKKwlpbnQgcmV0OworCisJcGxhbmUgPSBpbnRlbF9wbGFuZV9hbGxv
YygpOworCWlmIChJU19FUlIocGxhbmUpKQorCQlyZXR1cm4gcGxhbmU7CisKKwlwbGFuZS0+cGlw
ZSA9IHBpcGU7CisJcGxhbmUtPmlkID0gcGxhbmVfaWQ7CisJcGxhbmUtPmZyb250YnVmZmVyX2Jp
dCA9IElOVEVMX0ZST05UQlVGRkVSKHBpcGUsIHBsYW5lX2lkKTsKKworCXBsYW5lLT5oYXNfZmJj
ID0gc2tsX3BsYW5lX2hhc19mYmMoZGV2X3ByaXYsIHBpcGUsIHBsYW5lX2lkKTsKKwlpZiAocGxh
bmUtPmhhc19mYmMpIHsKKwkJc3RydWN0IGludGVsX2ZiYyAqZmJjID0gJmRldl9wcml2LT5mYmM7
CisKKwkJZmJjLT5wb3NzaWJsZV9mcmFtZWJ1ZmZlcl9iaXRzIHw9IHBsYW5lLT5mcm9udGJ1ZmZl
cl9iaXQ7CisJfQorCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpIHsKKwkJcGxhbmUt
Pm1pbl93aWR0aCA9IGljbF9wbGFuZV9taW5fd2lkdGg7CisJCXBsYW5lLT5tYXhfd2lkdGggPSBp
Y2xfcGxhbmVfbWF4X3dpZHRoOworCQlwbGFuZS0+bWF4X2hlaWdodCA9IGljbF9wbGFuZV9tYXhf
aGVpZ2h0OworCX0gZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1J
TklMQUtFKGRldl9wcml2KSkgeworCQlwbGFuZS0+bWF4X3dpZHRoID0gZ2xrX3BsYW5lX21heF93
aWR0aDsKKwkJcGxhbmUtPm1heF9oZWlnaHQgPSBza2xfcGxhbmVfbWF4X2hlaWdodDsKKwl9IGVs
c2UgeworCQlwbGFuZS0+bWF4X3dpZHRoID0gc2tsX3BsYW5lX21heF93aWR0aDsKKwkJcGxhbmUt
Pm1heF9oZWlnaHQgPSBza2xfcGxhbmVfbWF4X2hlaWdodDsKKwl9CisKKwlwbGFuZS0+bWF4X3N0
cmlkZSA9IHNrbF9wbGFuZV9tYXhfc3RyaWRlOworCXBsYW5lLT51cGRhdGVfcGxhbmUgPSBza2xf
dXBkYXRlX3BsYW5lOworCXBsYW5lLT5kaXNhYmxlX3BsYW5lID0gc2tsX2Rpc2FibGVfcGxhbmU7
CisJcGxhbmUtPmdldF9od19zdGF0ZSA9IHNrbF9wbGFuZV9nZXRfaHdfc3RhdGU7CisJcGxhbmUt
PmNoZWNrX3BsYW5lID0gc2tsX3BsYW5lX2NoZWNrOworCXBsYW5lLT5taW5fY2RjbGsgPSBza2xf
cGxhbmVfbWluX2NkY2xrOworCXBsYW5lLT5hc3luY19mbGlwID0gc2tsX3BsYW5lX2FzeW5jX2Zs
aXA7CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKKwkJZm9ybWF0cyA9IGljbF9n
ZXRfcGxhbmVfZm9ybWF0cyhkZXZfcHJpdiwgcGlwZSwKKwkJCQkJCXBsYW5lX2lkLCAmbnVtX2Zv
cm1hdHMpOworCWVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5J
TEFLRShkZXZfcHJpdikpCisJCWZvcm1hdHMgPSBnbGtfZ2V0X3BsYW5lX2Zvcm1hdHMoZGV2X3By
aXYsIHBpcGUsCisJCQkJCQlwbGFuZV9pZCwgJm51bV9mb3JtYXRzKTsKKwllbHNlCisJCWZvcm1h
dHMgPSBza2xfZ2V0X3BsYW5lX2Zvcm1hdHMoZGV2X3ByaXYsIHBpcGUsCisJCQkJCQlwbGFuZV9p
ZCwgJm51bV9mb3JtYXRzKTsKKworCXBsYW5lLT5oYXNfY2NzID0gc2tsX3BsYW5lX2hhc19jY3Mo
ZGV2X3ByaXYsIHBpcGUsIHBsYW5lX2lkKTsKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAx
MikgeworCQltb2RpZmllcnMgPSBnZW4xMl9nZXRfcGxhbmVfbW9kaWZpZXJzKGRldl9wcml2LCBw
bGFuZV9pZCk7CisJCXBsYW5lX2Z1bmNzID0gJmdlbjEyX3BsYW5lX2Z1bmNzOworCX0gZWxzZSB7
CisJCWlmIChwbGFuZS0+aGFzX2NjcykKKwkJCW1vZGlmaWVycyA9IHNrbF9wbGFuZV9mb3JtYXRf
bW9kaWZpZXJzX2NjczsKKwkJZWxzZQorCQkJbW9kaWZpZXJzID0gc2tsX3BsYW5lX2Zvcm1hdF9t
b2RpZmllcnNfbm9jY3M7CisJCXBsYW5lX2Z1bmNzID0gJnNrbF9wbGFuZV9mdW5jczsKKwl9CisK
KwlpZiAocGxhbmVfaWQgPT0gUExBTkVfUFJJTUFSWSkKKwkJcGxhbmVfdHlwZSA9IERSTV9QTEFO
RV9UWVBFX1BSSU1BUlk7CisJZWxzZQorCQlwbGFuZV90eXBlID0gRFJNX1BMQU5FX1RZUEVfT1ZF
UkxBWTsKKworCXJldCA9IGRybV91bml2ZXJzYWxfcGxhbmVfaW5pdCgmZGV2X3ByaXYtPmRybSwg
JnBsYW5lLT5iYXNlLAorCQkJCSAgICAgICAwLCBwbGFuZV9mdW5jcywKKwkJCQkgICAgICAgZm9y
bWF0cywgbnVtX2Zvcm1hdHMsIG1vZGlmaWVycywKKwkJCQkgICAgICAgcGxhbmVfdHlwZSwKKwkJ
CQkgICAgICAgInBsYW5lICVkJWMiLCBwbGFuZV9pZCArIDEsCisJCQkJICAgICAgIHBpcGVfbmFt
ZShwaXBlKSk7CisJaWYgKHJldCkKKwkJZ290byBmYWlsOworCisJc3VwcG9ydGVkX3JvdGF0aW9u
cyA9CisJCURSTV9NT0RFX1JPVEFURV8wIHwgRFJNX01PREVfUk9UQVRFXzkwIHwKKwkJRFJNX01P
REVfUk9UQVRFXzE4MCB8IERSTV9NT0RFX1JPVEFURV8yNzA7CisKKwlpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA+PSAxMCkKKwkJc3VwcG9ydGVkX3JvdGF0aW9ucyB8PSBEUk1fTU9ERV9SRUZMRUNU
X1g7CisKKwlkcm1fcGxhbmVfY3JlYXRlX3JvdGF0aW9uX3Byb3BlcnR5KCZwbGFuZS0+YmFzZSwK
KwkJCQkJICAgRFJNX01PREVfUk9UQVRFXzAsCisJCQkJCSAgIHN1cHBvcnRlZF9yb3RhdGlvbnMp
OworCisJc3VwcG9ydGVkX2NzYyA9IEJJVChEUk1fQ09MT1JfWUNCQ1JfQlQ2MDEpIHwgQklUKERS
TV9DT0xPUl9ZQ0JDUl9CVDcwOSk7CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8
fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkKKwkJc3VwcG9ydGVkX2NzYyB8PSBCSVQoRFJNX0NP
TE9SX1lDQkNSX0JUMjAyMCk7CisKKwlkcm1fcGxhbmVfY3JlYXRlX2NvbG9yX3Byb3BlcnRpZXMo
JnBsYW5lLT5iYXNlLAorCQkJCQkgIHN1cHBvcnRlZF9jc2MsCisJCQkJCSAgQklUKERSTV9DT0xP
Ul9ZQ0JDUl9MSU1JVEVEX1JBTkdFKSB8CisJCQkJCSAgQklUKERSTV9DT0xPUl9ZQ0JDUl9GVUxM
X1JBTkdFKSwKKwkJCQkJICBEUk1fQ09MT1JfWUNCQ1JfQlQ3MDksCisJCQkJCSAgRFJNX0NPTE9S
X1lDQkNSX0xJTUlURURfUkFOR0UpOworCisJZHJtX3BsYW5lX2NyZWF0ZV9hbHBoYV9wcm9wZXJ0
eSgmcGxhbmUtPmJhc2UpOworCWRybV9wbGFuZV9jcmVhdGVfYmxlbmRfbW9kZV9wcm9wZXJ0eSgm
cGxhbmUtPmJhc2UsCisJCQkJCSAgICAgQklUKERSTV9NT0RFX0JMRU5EX1BJWEVMX05PTkUpIHwK
KwkJCQkJICAgICBCSVQoRFJNX01PREVfQkxFTkRfUFJFTVVMVEkpIHwKKwkJCQkJICAgICBCSVQo
RFJNX01PREVfQkxFTkRfQ09WRVJBR0UpKTsKKworCWRybV9wbGFuZV9jcmVhdGVfenBvc19pbW11
dGFibGVfcHJvcGVydHkoJnBsYW5lLT5iYXNlLCBwbGFuZV9pZCk7CisKKwlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSAxMikKKwkJZHJtX3BsYW5lX2VuYWJsZV9mYl9kYW1hZ2VfY2xpcHMoJnBs
YW5lLT5iYXNlKTsKKworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwKQorCQlkcm1fcGxh
bmVfY3JlYXRlX3NjYWxpbmdfZmlsdGVyX3Byb3BlcnR5KCZwbGFuZS0+YmFzZSwKKwkJCQkJCUJJ
VChEUk1fU0NBTElOR19GSUxURVJfREVGQVVMVCkgfAorCQkJCQkJQklUKERSTV9TQ0FMSU5HX0ZJ
TFRFUl9ORUFSRVNUX05FSUdIQk9SKSk7CisKKwlkcm1fcGxhbmVfaGVscGVyX2FkZCgmcGxhbmUt
PmJhc2UsICZpbnRlbF9wbGFuZV9oZWxwZXJfZnVuY3MpOworCisJcmV0dXJuIHBsYW5lOworCitm
YWlsOgorCWludGVsX3BsYW5lX2ZyZWUocGxhbmUpOworCisJcmV0dXJuIEVSUl9QVFIocmV0KTsK
K30KKwordm9pZAorc2tsX2dldF9pbml0aWFsX3BsYW5lX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YywKKwkJCSAgICAgc3RydWN0IGludGVsX2luaXRpYWxfcGxhbmVfY29uZmlnICpwbGFu
ZV9jb25maWcpCit7CisJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUgPSB0b19p
bnRlbF9jcnRjX3N0YXRlKGNydGMtPmJhc2Uuc3RhdGUpOworCXN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYgPSBjcnRjLT5iYXNlLmRldjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGRldik7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3Bs
YW5lKGNydGMtPmJhc2UucHJpbWFyeSk7CisJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5l
LT5pZDsKKwllbnVtIHBpcGUgcGlwZTsKKwl1MzIgdmFsLCBiYXNlLCBvZmZzZXQsIHN0cmlkZV9t
dWx0LCB0aWxpbmcsIGFscGhhOworCWludCBmb3VyY2MsIHBpeGVsX2Zvcm1hdDsKKwl1bnNpZ25l
ZCBpbnQgYWxpZ25lZF9oZWlnaHQ7CisJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmI7CisJc3Ry
dWN0IGludGVsX2ZyYW1lYnVmZmVyICppbnRlbF9mYjsKKworCWlmICghcGxhbmUtPmdldF9od19z
dGF0ZShwbGFuZSwgJnBpcGUpKQorCQlyZXR1cm47CisKKwlkcm1fV0FSTl9PTihkZXYsIHBpcGUg
IT0gY3J0Yy0+cGlwZSk7CisKKwlpZiAoY3J0Y19zdGF0ZS0+Ymlnam9pbmVyKSB7CisJCWRybV9k
Ymdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJICAgICJVbnN1cHBvcnRlZCBiaWdqb2luZXIgY29u
ZmlndXJhdGlvbiBmb3IgaW5pdGlhbCBGQlxuIik7CisJCXJldHVybjsKKwl9CisKKwlpbnRlbF9m
YiA9IGt6YWxsb2Moc2l6ZW9mKCppbnRlbF9mYiksIEdGUF9LRVJORUwpOworCWlmICghaW50ZWxf
ZmIpIHsKKwkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJmYWlsZWQgdG8gYWxsb2MgZmJc
biIpOworCQlyZXR1cm47CisJfQorCisJZmIgPSAmaW50ZWxfZmItPmJhc2U7CisKKwlmYi0+ZGV2
ID0gZGV2OworCisJdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgUExBTkVfQ1RMKHBpcGUs
IHBsYW5lX2lkKSk7CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKKwkJcGl4ZWxf
Zm9ybWF0ID0gdmFsICYgSUNMX1BMQU5FX0NUTF9GT1JNQVRfTUFTSzsKKwllbHNlCisJCXBpeGVs
X2Zvcm1hdCA9IHZhbCAmIFBMQU5FX0NUTF9GT1JNQVRfTUFTSzsKKworCWlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDEwIHx8IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKSB7CisJCWFscGhhID0g
aW50ZWxfZGVfcmVhZChkZXZfcHJpdiwKKwkJCQkgICAgICBQTEFORV9DT0xPUl9DVEwocGlwZSwg
cGxhbmVfaWQpKTsKKwkJYWxwaGEgJj0gUExBTkVfQ09MT1JfQUxQSEFfTUFTSzsKKwl9IGVsc2Ug
eworCQlhbHBoYSA9IHZhbCAmIFBMQU5FX0NUTF9BTFBIQV9NQVNLOworCX0KKworCWZvdXJjYyA9
IHNrbF9mb3JtYXRfdG9fZm91cmNjKHBpeGVsX2Zvcm1hdCwKKwkJCQkgICAgICB2YWwgJiBQTEFO
RV9DVExfT1JERVJfUkdCWCwgYWxwaGEpOworCWZiLT5mb3JtYXQgPSBkcm1fZm9ybWF0X2luZm8o
Zm91cmNjKTsKKworCXRpbGluZyA9IHZhbCAmIFBMQU5FX0NUTF9USUxFRF9NQVNLOworCXN3aXRj
aCAodGlsaW5nKSB7CisJY2FzZSBQTEFORV9DVExfVElMRURfTElORUFSOgorCQlmYi0+bW9kaWZp
ZXIgPSBEUk1fRk9STUFUX01PRF9MSU5FQVI7CisJCWJyZWFrOworCWNhc2UgUExBTkVfQ1RMX1RJ
TEVEX1g6CisJCXBsYW5lX2NvbmZpZy0+dGlsaW5nID0gSTkxNV9USUxJTkdfWDsKKwkJZmItPm1v
ZGlmaWVyID0gSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQ7CisJCWJyZWFrOworCWNhc2UgUExBTkVf
Q1RMX1RJTEVEX1k6CisJCXBsYW5lX2NvbmZpZy0+dGlsaW5nID0gSTkxNV9USUxJTkdfWTsKKwkJ
aWYgKHZhbCAmIFBMQU5FX0NUTF9SRU5ERVJfREVDT01QUkVTU0lPTl9FTkFCTEUpCisJCQlmYi0+
bW9kaWZpZXIgPSBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyID8KKwkJCQlJOTE1X0ZPUk1BVF9N
T0RfWV9USUxFRF9HRU4xMl9SQ19DQ1MgOgorCQkJCUk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0ND
UzsKKwkJZWxzZSBpZiAodmFsICYgUExBTkVfQ1RMX01FRElBX0RFQ09NUFJFU1NJT05fRU5BQkxF
KQorCQkJZmItPm1vZGlmaWVyID0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfTUNfQ0NT
OworCQllbHNlCisJCQlmYi0+bW9kaWZpZXIgPSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRDsKKwkJ
YnJlYWs7CisJY2FzZSBQTEFORV9DVExfVElMRURfWUY6CisJCWlmICh2YWwgJiBQTEFORV9DVExf
UkVOREVSX0RFQ09NUFJFU1NJT05fRU5BQkxFKQorCQkJZmItPm1vZGlmaWVyID0gSTkxNV9GT1JN
QVRfTU9EX1lmX1RJTEVEX0NDUzsKKwkJZWxzZQorCQkJZmItPm1vZGlmaWVyID0gSTkxNV9GT1JN
QVRfTU9EX1lmX1RJTEVEOworCQlicmVhazsKKwlkZWZhdWx0OgorCQlNSVNTSU5HX0NBU0UodGls
aW5nKTsKKwkJZ290byBlcnJvcjsKKwl9CisKKwkvKgorCSAqIERSTV9NT0RFX1JPVEFURV8gaXMg
Y291bnRlciBjbG9ja3dpc2UgdG8gc3RheSBjb21wYXRpYmxlIHdpdGggWHJhbmRyCisJICogd2hp
bGUgaTkxNSBIVyByb3RhdGlvbiBpcyBjbG9ja3dpc2UsIHRoYXRzIHdoeSB0aGlzIHN3YXBwaW5n
LgorCSAqLworCXN3aXRjaCAodmFsICYgUExBTkVfQ1RMX1JPVEFURV9NQVNLKSB7CisJY2FzZSBQ
TEFORV9DVExfUk9UQVRFXzA6CisJCXBsYW5lX2NvbmZpZy0+cm90YXRpb24gPSBEUk1fTU9ERV9S
T1RBVEVfMDsKKwkJYnJlYWs7CisJY2FzZSBQTEFORV9DVExfUk9UQVRFXzkwOgorCQlwbGFuZV9j
b25maWctPnJvdGF0aW9uID0gRFJNX01PREVfUk9UQVRFXzI3MDsKKwkJYnJlYWs7CisJY2FzZSBQ
TEFORV9DVExfUk9UQVRFXzE4MDoKKwkJcGxhbmVfY29uZmlnLT5yb3RhdGlvbiA9IERSTV9NT0RF
X1JPVEFURV8xODA7CisJCWJyZWFrOworCWNhc2UgUExBTkVfQ1RMX1JPVEFURV8yNzA6CisJCXBs
YW5lX2NvbmZpZy0+cm90YXRpb24gPSBEUk1fTU9ERV9ST1RBVEVfOTA7CisJCWJyZWFrOworCX0K
KworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwICYmCisJICAgIHZhbCAmIFBMQU5FX0NU
TF9GTElQX0hPUklaT05UQUwpCisJCXBsYW5lX2NvbmZpZy0+cm90YXRpb24gfD0gRFJNX01PREVf
UkVGTEVDVF9YOworCisJLyogOTAvMjcwIGRlZ3JlZSByb3RhdGlvbiB3b3VsZCByZXF1aXJlIGV4
dHJhIHdvcmsgKi8KKwlpZiAoZHJtX3JvdGF0aW9uXzkwX29yXzI3MChwbGFuZV9jb25maWctPnJv
dGF0aW9uKSkKKwkJZ290byBlcnJvcjsKKworCWJhc2UgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2
LCBQTEFORV9TVVJGKHBpcGUsIHBsYW5lX2lkKSkgJiAweGZmZmZmMDAwOworCXBsYW5lX2NvbmZp
Zy0+YmFzZSA9IGJhc2U7CisKKwlvZmZzZXQgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBQTEFO
RV9PRkZTRVQocGlwZSwgcGxhbmVfaWQpKTsKKworCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3By
aXYsIFBMQU5FX1NJWkUocGlwZSwgcGxhbmVfaWQpKTsKKwlmYi0+aGVpZ2h0ID0gKCh2YWwgPj4g
MTYpICYgMHhmZmZmKSArIDE7CisJZmItPndpZHRoID0gKCh2YWwgPj4gMCkgJiAweGZmZmYpICsg
MTsKKworCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIFBMQU5FX1NUUklERShwaXBlLCBw
bGFuZV9pZCkpOworCXN0cmlkZV9tdWx0ID0gc2tsX3BsYW5lX3N0cmlkZV9tdWx0KGZiLCAwLCBE
Uk1fTU9ERV9ST1RBVEVfMCk7CisJZmItPnBpdGNoZXNbMF0gPSAodmFsICYgMHgzZmYpICogc3Ry
aWRlX211bHQ7CisKKwlhbGlnbmVkX2hlaWdodCA9IGludGVsX2ZiX2FsaWduX2hlaWdodChmYiwg
MCwgZmItPmhlaWdodCk7CisKKwlwbGFuZV9jb25maWctPnNpemUgPSBmYi0+cGl0Y2hlc1swXSAq
IGFsaWduZWRfaGVpZ2h0OworCisJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCSAgICAi
JXMvJXMgd2l0aCBmYjogc2l6ZT0lZHglZEAlZCwgb2Zmc2V0PSV4LCBwaXRjaCAlZCwgc2l6ZSAw
eCV4XG4iLAorCQkgICAgY3J0Yy0+YmFzZS5uYW1lLCBwbGFuZS0+YmFzZS5uYW1lLCBmYi0+d2lk
dGgsIGZiLT5oZWlnaHQsCisJCSAgICBmYi0+Zm9ybWF0LT5jcHBbMF0gKiA4LCBiYXNlLCBmYi0+
cGl0Y2hlc1swXSwKKwkJICAgIHBsYW5lX2NvbmZpZy0+c2l6ZSk7CisKKwlwbGFuZV9jb25maWct
PmZiID0gaW50ZWxfZmI7CisJcmV0dXJuOworCitlcnJvcjoKKwlrZnJlZShpbnRlbF9mYik7Cit9
CisKK3N0YXRpYyBzdHJ1Y3QgaW50ZWxfcGxhbmUgKgorc2tsX25leHRfcGxhbmVfdG9fY29tbWl0
KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAorCQkJIHN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjLAorCQkJIHN0cnVjdCBza2xfZGRiX2VudHJ5IGVudHJpZXNfeVtJOTE1X01BWF9QTEFO
RVNdLAorCQkJIHN0cnVjdCBza2xfZGRiX2VudHJ5IGVudHJpZXNfdXZbSTkxNV9NQVhfUExBTkVT
XSwKKwkJCSB1bnNpZ25lZCBpbnQgKnVwZGF0ZV9tYXNrKQoreworCXN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlID0KKwkJaW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShz
dGF0ZSwgY3J0Yyk7CisJc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZTsKKwlz
dHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOworCWludCBpOworCisJaWYgKCp1cGRhdGVfbWFzayA9
PSAwKQorCQlyZXR1cm4gTlVMTDsKKworCWZvcl9lYWNoX25ld19pbnRlbF9wbGFuZV9pbl9zdGF0
ZShzdGF0ZSwgcGxhbmUsIHBsYW5lX3N0YXRlLCBpKSB7CisJCWVudW0gcGxhbmVfaWQgcGxhbmVf
aWQgPSBwbGFuZS0+aWQ7CisKKwkJaWYgKGNydGMtPnBpcGUgIT0gcGxhbmUtPnBpcGUgfHwKKwkJ
ICAgICEoKnVwZGF0ZV9tYXNrICYgQklUKHBsYW5lX2lkKSkpCisJCQljb250aW51ZTsKKworCQlp
ZiAoc2tsX2RkYl9hbGxvY2F0aW9uX292ZXJsYXBzKCZjcnRjX3N0YXRlLT53bS5za2wucGxhbmVf
ZGRiX3lbcGxhbmVfaWRdLAorCQkJCQkJZW50cmllc195LAorCQkJCQkJSTkxNV9NQVhfUExBTkVT
LCBwbGFuZV9pZCkgfHwKKwkJICAgIHNrbF9kZGJfYWxsb2NhdGlvbl9vdmVybGFwcygmY3J0Y19z
dGF0ZS0+d20uc2tsLnBsYW5lX2RkYl91dltwbGFuZV9pZF0sCisJCQkJCQllbnRyaWVzX3V2LAor
CQkJCQkJSTkxNV9NQVhfUExBTkVTLCBwbGFuZV9pZCkpCisJCQljb250aW51ZTsKKworCQkqdXBk
YXRlX21hc2sgJj0gfkJJVChwbGFuZV9pZCk7CisJCWVudHJpZXNfeVtwbGFuZV9pZF0gPSBjcnRj
X3N0YXRlLT53bS5za2wucGxhbmVfZGRiX3lbcGxhbmVfaWRdOworCQllbnRyaWVzX3V2W3BsYW5l
X2lkXSA9IGNydGNfc3RhdGUtPndtLnNrbC5wbGFuZV9kZGJfdXZbcGxhbmVfaWRdOworCisJCXJl
dHVybiBwbGFuZTsKKwl9CisKKwkvKiBzaG91bGQgbmV2ZXIgaGFwcGVuICovCisJZHJtX1dBUk5f
T04oc3RhdGUtPmJhc2UuZGV2LCAxKTsKKworCXJldHVybiBOVUxMOworfQorCit2b2lkIHNrbF91
cGRhdGVfcGxhbmVzX29uX2NydGMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCisJ
CQkgICAgICAgc3RydWN0IGludGVsX2NydGMgKmNydGMpCit7CisJc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKm9sZF9jcnRjX3N0YXRlID0KKwkJaW50ZWxfYXRvbWljX2dldF9vbGRfY3J0Y19zdGF0
ZShzdGF0ZSwgY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRl
ID0KKwkJaW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0ZSwgY3J0Yyk7CisJc3Ry
dWN0IHNrbF9kZGJfZW50cnkgZW50cmllc195W0k5MTVfTUFYX1BMQU5FU107CisJc3RydWN0IHNr
bF9kZGJfZW50cnkgZW50cmllc191dltJOTE1X01BWF9QTEFORVNdOworCXUzMiB1cGRhdGVfbWFz
ayA9IG5ld19jcnRjX3N0YXRlLT51cGRhdGVfcGxhbmVzOworCXN0cnVjdCBpbnRlbF9wbGFuZSAq
cGxhbmU7CisKKwltZW1jcHkoZW50cmllc195LCBvbGRfY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5l
X2RkYl95LAorCSAgICAgICBzaXplb2Yob2xkX2NydGNfc3RhdGUtPndtLnNrbC5wbGFuZV9kZGJf
eSkpOworCW1lbWNweShlbnRyaWVzX3V2LCBvbGRfY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2Rk
Yl91diwKKwkgICAgICAgc2l6ZW9mKG9sZF9jcnRjX3N0YXRlLT53bS5za2wucGxhbmVfZGRiX3V2
KSk7CisKKwl3aGlsZSAoKHBsYW5lID0gc2tsX25leHRfcGxhbmVfdG9fY29tbWl0KHN0YXRlLCBj
cnRjLAorCQkJCQkJIGVudHJpZXNfeSwgZW50cmllc191diwKKwkJCQkJCSAmdXBkYXRlX21hc2sp
KSkgeworCQlzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm5ld19wbGFuZV9zdGF0ZSA9CisJCQlp
bnRlbF9hdG9taWNfZ2V0X25ld19wbGFuZV9zdGF0ZShzdGF0ZSwgcGxhbmUpOworCisJCWlmIChu
ZXdfcGxhbmVfc3RhdGUtPnVhcGkudmlzaWJsZSB8fAorCQkgICAgbmV3X3BsYW5lX3N0YXRlLT5w
bGFuYXJfc2xhdmUpIHsKKwkJCWludGVsX3VwZGF0ZV9wbGFuZShwbGFuZSwgbmV3X2NydGNfc3Rh
dGUsIG5ld19wbGFuZV9zdGF0ZSk7CisJCX0gZWxzZSB7CisJCQlpbnRlbF9kaXNhYmxlX3BsYW5l
KHBsYW5lLCBuZXdfY3J0Y19zdGF0ZSk7CisJCX0KKwl9Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYwppbmRleCBiN2UyMDg4MTYwNzQuLmFiMmNkNDgyNWUy
ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCkBAIC0z
NjQsNTk5ICszNjQsNiBAQCBpbnQgaW50ZWxfcGxhbmVfY2hlY2tfc3JjX2Nvb3JkaW5hdGVzKHN0
cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJcmV0dXJuIDA7CiB9CiAKLXN0
YXRpYyB1OCBpY2xfbnYxMl95X3BsYW5lX21hc2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCi17Ci0JaWYgKElTX1JPQ0tFVExBS0UoaTkxNSkpCi0JCXJldHVybiBCSVQoUExBTkVfU1BS
SVRFMikgfCBCSVQoUExBTkVfU1BSSVRFMyk7Ci0JZWxzZQotCQlyZXR1cm4gQklUKFBMQU5FX1NQ
UklURTQpIHwgQklUKFBMQU5FX1NQUklURTUpOwotfQotCi1ib29sIGljbF9pc19udjEyX3lfcGxh
bmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAotCQkJIGVudW0gcGxhbmVfaWQg
cGxhbmVfaWQpCi17Ci0JcmV0dXJuIElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEgJiYKLQkJaWNs
X252MTJfeV9wbGFuZV9tYXNrKGRldl9wcml2KSAmIEJJVChwbGFuZV9pZCk7Ci19Ci0KLWJvb2wg
aWNsX2lzX2hkcl9wbGFuZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0g
cGxhbmVfaWQgcGxhbmVfaWQpCi17Ci0JcmV0dXJuIElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEg
JiYKLQkJaWNsX2hkcl9wbGFuZV9tYXNrKCkgJiBCSVQocGxhbmVfaWQpOwotfQotCi1zdGF0aWMg
dm9pZAotc2tsX3BsYW5lX3JhdGlvKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlLAotCQljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAot
CQl1bnNpZ25lZCBpbnQgKm51bSwgdW5zaWduZWQgaW50ICpkZW4pCi17Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZS0+
ZGV2KTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5o
dy5mYjsKLQotCWlmIChmYi0+Zm9ybWF0LT5jcHBbMF0gPT0gOCkgewotCQlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkgewotCQkJKm51bSA9
IDEwOwotCQkJKmRlbiA9IDg7Ci0JCX0gZWxzZSB7Ci0JCQkqbnVtID0gOTsKLQkJCSpkZW4gPSA4
OwotCQl9Ci0JfSBlbHNlIHsKLQkJKm51bSA9IDE7Ci0JCSpkZW4gPSAxOwotCX0KLX0KLQotc3Rh
dGljIGludCBza2xfcGxhbmVfbWluX2NkY2xrKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlLAotCQkJICAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZS0+ZGV2KTsKLQl1bnNpZ25lZCBpbnQgbnVtLCBk
ZW47Ci0JdW5zaWduZWQgaW50IHBpeGVsX3JhdGUgPSBpbnRlbF9wbGFuZV9waXhlbF9yYXRlKGNy
dGNfc3RhdGUsIHBsYW5lX3N0YXRlKTsKLQotCXNrbF9wbGFuZV9yYXRpbyhjcnRjX3N0YXRlLCBw
bGFuZV9zdGF0ZSwgJm51bSwgJmRlbik7Ci0KLQkvKiB0d28gcGl4ZWxzIHBlciBjbG9jayBvbiBn
bGsrICovCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShk
ZXZfcHJpdikpCi0JCWRlbiAqPSAyOwotCi0JcmV0dXJuIERJVl9ST1VORF9VUChwaXhlbF9yYXRl
ICogbnVtLCBkZW4pOwotfQotCi1zdGF0aWMgaW50IHNrbF9wbGFuZV9tYXhfd2lkdGgoY29uc3Qg
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCi0JCQkgICAgICAgaW50IGNvbG9yX3BsYW5lLAot
CQkJICAgICAgIHVuc2lnbmVkIGludCByb3RhdGlvbikKLXsKLQlpbnQgY3BwID0gZmItPmZvcm1h
dC0+Y3BwW2NvbG9yX3BsYW5lXTsKLQotCXN3aXRjaCAoZmItPm1vZGlmaWVyKSB7Ci0JY2FzZSBE
Uk1fRk9STUFUX01PRF9MSU5FQVI6Ci0JY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRDoKLQkJ
LyoKLQkJICogVmFsaWRhdGVkIGxpbWl0IGlzIDRrLCBidXQgaGFzIDVrIHNob3VsZAotCQkgKiB3
b3JrIGFwYXJ0IGZyb20gdGhlIGZvbGxvd2luZyBmZWF0dXJlczoKLQkJICogLSBZdGlsZSAoYWxy
ZWFkeSBsaW1pdGVkIHRvIDRrKQotCQkgKiAtIEZQMTYgKGFscmVhZHkgbGltaXRlZCB0byA0aykK
LQkJICogLSByZW5kZXIgY29tcHJlc3Npb24gKGFscmVhZHkgbGltaXRlZCB0byA0aykKLQkJICog
LSBLVk1SIHNwcml0ZSBhbmQgY3Vyc29yIChkb24ndCBjYXJlKQotCQkgKiAtIGhvcml6b250YWwg
cGFubmluZyAoVE9ETyB2ZXJpZnkgdGhpcykKLQkJICogLSBwaXBlIGFuZCBwbGFuZSBzY2FsaW5n
IChUT0RPIHZlcmlmeSB0aGlzKQotCQkgKi8KLQkJaWYgKGNwcCA9PSA4KQotCQkJcmV0dXJuIDQw
OTY7Ci0JCWVsc2UKLQkJCXJldHVybiA1MTIwOwotCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElM
RURfQ0NTOgotCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEX0NDUzoKLQljYXNlIEk5MTVf
Rk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX01DX0NDUzoKLQkJLyogRklYTUUgQVVYIHBsYW5lPyAq
LwotCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQ6Ci0JY2FzZSBJOTE1X0ZPUk1BVF9NT0Rf
WWZfVElMRUQ6Ci0JCWlmIChjcHAgPT0gOCkKLQkJCXJldHVybiAyMDQ4OwotCQllbHNlCi0JCQly
ZXR1cm4gNDA5NjsKLQlkZWZhdWx0OgotCQlNSVNTSU5HX0NBU0UoZmItPm1vZGlmaWVyKTsKLQkJ
cmV0dXJuIDIwNDg7Ci0JfQotfQotCi1zdGF0aWMgaW50IGdsa19wbGFuZV9tYXhfd2lkdGgoY29u
c3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCi0JCQkgICAgICAgaW50IGNvbG9yX3BsYW5l
LAotCQkJICAgICAgIHVuc2lnbmVkIGludCByb3RhdGlvbikKLXsKLQlpbnQgY3BwID0gZmItPmZv
cm1hdC0+Y3BwW2NvbG9yX3BsYW5lXTsKLQotCXN3aXRjaCAoZmItPm1vZGlmaWVyKSB7Ci0JY2Fz
ZSBEUk1fRk9STUFUX01PRF9MSU5FQVI6Ci0JY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRDoK
LQkJaWYgKGNwcCA9PSA4KQotCQkJcmV0dXJuIDQwOTY7Ci0JCWVsc2UKLQkJCXJldHVybiA1MTIw
OwotCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfQ0NTOgotCWNhc2UgSTkxNV9GT1JNQVRf
TU9EX1lmX1RJTEVEX0NDUzoKLQkJLyogRklYTUUgQVVYIHBsYW5lPyAqLwotCWNhc2UgSTkxNV9G
T1JNQVRfTU9EX1lfVElMRUQ6Ci0JY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRUQ6Ci0JCWlm
IChjcHAgPT0gOCkKLQkJCXJldHVybiAyMDQ4OwotCQllbHNlCi0JCQlyZXR1cm4gNTEyMDsKLQlk
ZWZhdWx0OgotCQlNSVNTSU5HX0NBU0UoZmItPm1vZGlmaWVyKTsKLQkJcmV0dXJuIDIwNDg7Ci0J
fQotfQotCi1zdGF0aWMgaW50IGljbF9wbGFuZV9taW5fd2lkdGgoY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIsCi0JCQkgICAgICAgaW50IGNvbG9yX3BsYW5lLAotCQkJICAgICAgIHVu
c2lnbmVkIGludCByb3RhdGlvbikKLXsKLQkvKiBXYV8xNDAxMTI2NDY1NywgV2FfMTQwMTEwNTA1
NjM6IGdlbjExKyAqLwotCXN3aXRjaCAoZmItPmZvcm1hdC0+Zm9ybWF0KSB7Ci0JY2FzZSBEUk1f
Rk9STUFUX0M4OgotCQlyZXR1cm4gMTg7Ci0JY2FzZSBEUk1fRk9STUFUX1JHQjU2NToKLQkJcmV0
dXJuIDEwOwotCWNhc2UgRFJNX0ZPUk1BVF9YUkdCODg4ODoKLQljYXNlIERSTV9GT1JNQVRfWEJH
Ujg4ODg6Ci0JY2FzZSBEUk1fRk9STUFUX0FSR0I4ODg4OgotCWNhc2UgRFJNX0ZPUk1BVF9BQkdS
ODg4ODoKLQljYXNlIERSTV9GT1JNQVRfWFJHQjIxMDEwMTA6Ci0JY2FzZSBEUk1fRk9STUFUX1hC
R1IyMTAxMDEwOgotCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMjEwMTAxMDoKLQljYXNlIERSTV9GT1JN
QVRfQUJHUjIxMDEwMTA6Ci0JY2FzZSBEUk1fRk9STUFUX1hWWVUyMTAxMDEwOgotCWNhc2UgRFJN
X0ZPUk1BVF9ZMjEyOgotCWNhc2UgRFJNX0ZPUk1BVF9ZMjE2OgotCQlyZXR1cm4gNjsKLQljYXNl
IERSTV9GT1JNQVRfTlYxMjoKLQkJcmV0dXJuIDIwOwotCWNhc2UgRFJNX0ZPUk1BVF9QMDEwOgot
CWNhc2UgRFJNX0ZPUk1BVF9QMDEyOgotCWNhc2UgRFJNX0ZPUk1BVF9QMDE2OgotCQlyZXR1cm4g
MTI7Ci0JY2FzZSBEUk1fRk9STUFUX1hSR0IxNjE2MTYxNkY6Ci0JY2FzZSBEUk1fRk9STUFUX1hC
R1IxNjE2MTYxNkY6Ci0JY2FzZSBEUk1fRk9STUFUX0FSR0IxNjE2MTYxNkY6Ci0JY2FzZSBEUk1f
Rk9STUFUX0FCR1IxNjE2MTYxNkY6Ci0JY2FzZSBEUk1fRk9STUFUX1hWWVUxMl8xNjE2MTYxNjoK
LQljYXNlIERSTV9GT1JNQVRfWFZZVTE2MTYxNjE2OgotCQlyZXR1cm4gNDsKLQlkZWZhdWx0Ogot
CQlyZXR1cm4gMTsKLQl9Ci19Ci0KLXN0YXRpYyBpbnQgaWNsX3BsYW5lX21heF93aWR0aChjb25z
dCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKLQkJCSAgICAgICBpbnQgY29sb3JfcGxhbmUs
Ci0JCQkgICAgICAgdW5zaWduZWQgaW50IHJvdGF0aW9uKQotewotCXJldHVybiA1MTIwOwotfQot
Ci1zdGF0aWMgaW50IHNrbF9wbGFuZV9tYXhfaGVpZ2h0KGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVi
dWZmZXIgKmZiLAotCQkJCWludCBjb2xvcl9wbGFuZSwKLQkJCQl1bnNpZ25lZCBpbnQgcm90YXRp
b24pCi17Ci0JcmV0dXJuIDQwOTY7Ci19Ci0KLXN0YXRpYyBpbnQgaWNsX3BsYW5lX21heF9oZWln
aHQoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCi0JCQkJaW50IGNvbG9yX3BsYW5l
LAotCQkJCXVuc2lnbmVkIGludCByb3RhdGlvbikKLXsKLQlyZXR1cm4gNDMyMDsKLX0KLQotc3Rh
dGljIHVuc2lnbmVkIGludAotc2tsX3BsYW5lX21heF9zdHJpZGUoc3RydWN0IGludGVsX3BsYW5l
ICpwbGFuZSwKLQkJICAgICB1MzIgcGl4ZWxfZm9ybWF0LCB1NjQgbW9kaWZpZXIsCi0JCSAgICAg
dW5zaWduZWQgaW50IHJvdGF0aW9uKQotewotCWNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0X2luZm8g
KmluZm8gPSBkcm1fZm9ybWF0X2luZm8ocGl4ZWxfZm9ybWF0KTsKLQlpbnQgY3BwID0gaW5mby0+
Y3BwWzBdOwotCi0JLyoKLQkgKiAiVGhlIHN0cmlkZSBpbiBieXRlcyBtdXN0IG5vdCBleGNlZWQg
dGhlCi0JICogb2YgdGhlIHNpemUgb2YgOEsgcGl4ZWxzIGFuZCAzMksgYnl0ZXMuIgotCSAqLwot
CWlmIChkcm1fcm90YXRpb25fOTBfb3JfMjcwKHJvdGF0aW9uKSkKLQkJcmV0dXJuIG1pbig4MTky
LCAzMjc2OCAvIGNwcCk7Ci0JZWxzZQotCQlyZXR1cm4gbWluKDgxOTIgKiBjcHAsIDMyNzY4KTsK
LX0KLQotc3RhdGljIHZvaWQKLXNrbF9wcm9ncmFtX3NjYWxlcihzdHJ1Y3QgaW50ZWxfcGxhbmUg
KnBsYW5lLAotCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwK
LQkJICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKLXsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRl
dik7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcu
ZmI7Ci0JZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlwZTsKLQlpbnQgc2NhbGVyX2lkID0gcGxh
bmVfc3RhdGUtPnNjYWxlcl9pZDsKLQljb25zdCBzdHJ1Y3QgaW50ZWxfc2NhbGVyICpzY2FsZXIg
PQotCQkmY3J0Y19zdGF0ZS0+c2NhbGVyX3N0YXRlLnNjYWxlcnNbc2NhbGVyX2lkXTsKLQlpbnQg
Y3J0Y194ID0gcGxhbmVfc3RhdGUtPnVhcGkuZHN0LngxOwotCWludCBjcnRjX3kgPSBwbGFuZV9z
dGF0ZS0+dWFwaS5kc3QueTE7Ci0JdTMyIGNydGNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9z
dGF0ZS0+dWFwaS5kc3QpOwotCXUzMiBjcnRjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0
YXRlLT51YXBpLmRzdCk7Ci0JdTE2IHlfaHBoYXNlLCB1dl9yZ2JfaHBoYXNlOwotCXUxNiB5X3Zw
aGFzZSwgdXZfcmdiX3ZwaGFzZTsKLQlpbnQgaHNjYWxlLCB2c2NhbGU7Ci0JdTMyIHBzX2N0cmw7
Ci0KLQloc2NhbGUgPSBkcm1fcmVjdF9jYWxjX2hzY2FsZSgmcGxhbmVfc3RhdGUtPnVhcGkuc3Jj
LAotCQkJCSAgICAgICZwbGFuZV9zdGF0ZS0+dWFwaS5kc3QsCi0JCQkJICAgICAgMCwgSU5UX01B
WCk7Ci0JdnNjYWxlID0gZHJtX3JlY3RfY2FsY192c2NhbGUoJnBsYW5lX3N0YXRlLT51YXBpLnNy
YywKLQkJCQkgICAgICAmcGxhbmVfc3RhdGUtPnVhcGkuZHN0LAotCQkJCSAgICAgIDAsIElOVF9N
QVgpOwotCi0JLyogVE9ETzogaGFuZGxlIHN1Yi1waXhlbCBjb29yZGluYXRlcyAqLwotCWlmIChp
bnRlbF9mb3JtYXRfaW5mb19pc195dXZfc2VtaXBsYW5hcihmYi0+Zm9ybWF0LCBmYi0+bW9kaWZp
ZXIpICYmCi0JICAgICFpY2xfaXNfaGRyX3BsYW5lKGRldl9wcml2LCBwbGFuZS0+aWQpKSB7Ci0J
CXlfaHBoYXNlID0gc2tsX3NjYWxlcl9jYWxjX3BoYXNlKDEsIGhzY2FsZSwgZmFsc2UpOwotCQl5
X3ZwaGFzZSA9IHNrbF9zY2FsZXJfY2FsY19waGFzZSgxLCB2c2NhbGUsIGZhbHNlKTsKLQotCQkv
KiBNUEVHMiBjaHJvbWEgc2l0aW5nIGNvbnZlbnRpb24gKi8KLQkJdXZfcmdiX2hwaGFzZSA9IHNr
bF9zY2FsZXJfY2FsY19waGFzZSgyLCBoc2NhbGUsIHRydWUpOwotCQl1dl9yZ2JfdnBoYXNlID0g
c2tsX3NjYWxlcl9jYWxjX3BoYXNlKDIsIHZzY2FsZSwgZmFsc2UpOwotCX0gZWxzZSB7Ci0JCS8q
IG5vdCB1c2VkICovCi0JCXlfaHBoYXNlID0gMDsKLQkJeV92cGhhc2UgPSAwOwotCi0JCXV2X3Jn
Yl9ocGhhc2UgPSBza2xfc2NhbGVyX2NhbGNfcGhhc2UoMSwgaHNjYWxlLCBmYWxzZSk7Ci0JCXV2
X3JnYl92cGhhc2UgPSBza2xfc2NhbGVyX2NhbGNfcGhhc2UoMSwgdnNjYWxlLCBmYWxzZSk7Ci0J
fQotCi0JcHNfY3RybCA9IHNrbF9zY2FsZXJfZ2V0X2ZpbHRlcl9zZWxlY3QocGxhbmVfc3RhdGUt
Pmh3LnNjYWxpbmdfZmlsdGVyLCAwKTsKLQlwc19jdHJsIHw9IFBTX1NDQUxFUl9FTiB8IFBTX1BM
QU5FX1NFTChwbGFuZS0+aWQpIHwgc2NhbGVyLT5tb2RlOwotCi0Jc2tsX3NjYWxlcl9zZXR1cF9m
aWx0ZXIoZGV2X3ByaXYsIHBpcGUsIHNjYWxlcl9pZCwgMCwKLQkJCQlwbGFuZV9zdGF0ZS0+aHcu
c2NhbGluZ19maWx0ZXIpOwotCi0JaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFNLTF9QU19D
VFJMKHBpcGUsIHNjYWxlcl9pZCksIHBzX2N0cmwpOwotCWludGVsX2RlX3dyaXRlX2Z3KGRldl9w
cml2LCBTS0xfUFNfVlBIQVNFKHBpcGUsIHNjYWxlcl9pZCksCi0JCQkgIFBTX1lfUEhBU0UoeV92
cGhhc2UpIHwgUFNfVVZfUkdCX1BIQVNFKHV2X3JnYl92cGhhc2UpKTsKLQlpbnRlbF9kZV93cml0
ZV9mdyhkZXZfcHJpdiwgU0tMX1BTX0hQSEFTRShwaXBlLCBzY2FsZXJfaWQpLAotCQkJICBQU19Z
X1BIQVNFKHlfaHBoYXNlKSB8IFBTX1VWX1JHQl9QSEFTRSh1dl9yZ2JfaHBoYXNlKSk7Ci0JaW50
ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFNLTF9QU19XSU5fUE9TKHBpcGUsIHNjYWxlcl9pZCks
Ci0JCQkgIChjcnRjX3ggPDwgMTYpIHwgY3J0Y195KTsKLQlpbnRlbF9kZV93cml0ZV9mdyhkZXZf
cHJpdiwgU0tMX1BTX1dJTl9TWihwaXBlLCBzY2FsZXJfaWQpLAotCQkJICAoY3J0Y193IDw8IDE2
KSB8IGNydGNfaCk7Ci19Ci0KLS8qIFByZW9mZnNldCB2YWx1ZXMgZm9yIFlVViB0byBSR0IgQ29u
dmVyc2lvbiAqLwotI2RlZmluZSBQUkVPRkZfWVVWX1RPX1JHQl9ISQkJMHgxODAwCi0jZGVmaW5l
IFBSRU9GRl9ZVVZfVE9fUkdCX01FCQkweDFGMDAKLSNkZWZpbmUgUFJFT0ZGX1lVVl9UT19SR0Jf
TE8JCTB4MTgwMAotCi0jZGVmaW5lICBST0ZGKHgpICAgICAgICAgICgoKHgpICYgMHhmZmZmKSA8
PCAxNikKLSNkZWZpbmUgIEdPRkYoeCkgICAgICAgICAgKCgoeCkgJiAweGZmZmYpIDw8IDApCi0j
ZGVmaW5lICBCT0ZGKHgpICAgICAgICAgICgoKHgpICYgMHhmZmZmKSA8PCAxNikKLQotc3RhdGlj
IHZvaWQKLWljbF9wcm9ncmFtX2lucHV0X2NzYyhzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAot
CQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJICAg
ICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKLXsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7
Ci0JZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlwZTsKLQllbnVtIHBsYW5lX2lkIHBsYW5lX2lk
ID0gcGxhbmUtPmlkOwotCi0Jc3RhdGljIGNvbnN0IHUxNiBpbnB1dF9jc2NfbWF0cml4W11bOV0g
PSB7Ci0JCS8qCi0JCSAqIEJULjYwMSBmdWxsIHJhbmdlIFlDYkNyIC0+IGZ1bGwgcmFuZ2UgUkdC
Ci0JCSAqIFRoZSBtYXRyaXggcmVxdWlyZWQgaXMgOgotCQkgKiBbMS4wMDAsIDAuMDAwLCAxLjM3
MSwKLQkJICogIDEuMDAwLCAtMC4zMzYsIC0wLjY5OCwKLQkJICogIDEuMDAwLCAxLjczMiwgMC4w
MDAwXQotCQkgKi8KLQkJW0RSTV9DT0xPUl9ZQ0JDUl9CVDYwMV0gPSB7Ci0JCQkweDdBRjgsIDB4
NzgwMCwgMHgwLAotCQkJMHg4QjI4LCAweDc4MDAsIDB4OUFDMCwKLQkJCTB4MCwgMHg3ODAwLCAw
eDdERDgsCi0JCX0sCi0JCS8qCi0JCSAqIEJULjcwOSBmdWxsIHJhbmdlIFlDYkNyIC0+IGZ1bGwg
cmFuZ2UgUkdCCi0JCSAqIFRoZSBtYXRyaXggcmVxdWlyZWQgaXMgOgotCQkgKiBbMS4wMDAsIDAu
MDAwLCAxLjU3NCwKLQkJICogIDEuMDAwLCAtMC4xODcsIC0wLjQ2OCwKLQkJICogIDEuMDAwLCAx
Ljg1NSwgMC4wMDAwXQotCQkgKi8KLQkJW0RSTV9DT0xPUl9ZQ0JDUl9CVDcwOV0gPSB7Ci0JCQkw
eDdDOTgsIDB4NzgwMCwgMHgwLAotCQkJMHg5RUY4LCAweDc4MDAsIDB4QUMwMCwKLQkJCTB4MCwg
MHg3ODAwLCAgMHg3RUQ4LAotCQl9LAotCQkvKgotCQkgKiBCVC4yMDIwIGZ1bGwgcmFuZ2UgWUNi
Q3IgLT4gZnVsbCByYW5nZSBSR0IKLQkJICogVGhlIG1hdHJpeCByZXF1aXJlZCBpcyA6Ci0JCSAq
IFsxLjAwMCwgMC4wMDAsIDEuNDc0LAotCQkgKiAgMS4wMDAsIC0wLjE2NDUsIC0wLjU3MTMsCi0J
CSAqICAxLjAwMCwgMS44ODE0LCAwLjAwMDBdCi0JCSAqLwotCQlbRFJNX0NPTE9SX1lDQkNSX0JU
MjAyMF0gPSB7Ci0JCQkweDdCQzgsIDB4NzgwMCwgMHgwLAotCQkJMHg4OTI4LCAweDc4MDAsIDB4
QUE4OCwKLQkJCTB4MCwgMHg3ODAwLCAweDdGMTAsCi0JCX0sCi0JfTsKLQotCS8qIE1hdHJpeCBm
b3IgTGltaXRlZCBSYW5nZSB0byBGdWxsIFJhbmdlIENvbnZlcnNpb24gKi8KLQlzdGF0aWMgY29u
c3QgdTE2IGlucHV0X2NzY19tYXRyaXhfbHJbXVs5XSA9IHsKLQkJLyoKLQkJICogQlQuNjAxIExp
bXRlZCByYW5nZSBZQ2JDciAtPiBmdWxsIHJhbmdlIFJHQgotCQkgKiBUaGUgbWF0cml4IHJlcXVp
cmVkIGlzIDoKLQkJICogWzEuMTY0Mzg0LCAwLjAwMCwgMS41OTYwMjcsCi0JCSAqICAxLjE2NDM4
NCwgLTAuMzkxNzUsIC0wLjgxMjgxMywKLQkJICogIDEuMTY0Mzg0LCAyLjAxNzIzMiwgMC4wMDAw
XQotCQkgKi8KLQkJW0RSTV9DT0xPUl9ZQ0JDUl9CVDYwMV0gPSB7Ci0JCQkweDdDQzgsIDB4Nzk1
MCwgMHgwLAotCQkJMHg4RDAwLCAweDc5NTAsIDB4OUM4OCwKLQkJCTB4MCwgMHg3OTUwLCAweDY4
MTAsCi0JCX0sCi0JCS8qCi0JCSAqIEJULjcwOSBMaW1pdGVkIHJhbmdlIFlDYkNyIC0+IGZ1bGwg
cmFuZ2UgUkdCCi0JCSAqIFRoZSBtYXRyaXggcmVxdWlyZWQgaXMgOgotCQkgKiBbMS4xNjQzODQs
IDAuMDAwLCAxLjc5Mjc0MSwKLQkJICogIDEuMTY0Mzg0LCAtMC4yMTMyNDksIC0wLjUzMjkwOSwK
LQkJICogIDEuMTY0Mzg0LCAyLjExMjQwMiwgMC4wMDAwXQotCQkgKi8KLQkJW0RSTV9DT0xPUl9Z
Q0JDUl9CVDcwOV0gPSB7Ci0JCQkweDdFNTgsIDB4Nzk1MCwgMHgwLAotCQkJMHg4ODg4LCAweDc5
NTAsIDB4QURBOCwKLQkJCTB4MCwgMHg3OTUwLCAgMHg2ODcwLAotCQl9LAotCQkvKgotCQkgKiBC
VC4yMDIwIExpbWl0ZWQgcmFuZ2UgWUNiQ3IgLT4gZnVsbCByYW5nZSBSR0IKLQkJICogVGhlIG1h
dHJpeCByZXF1aXJlZCBpcyA6Ci0JCSAqIFsxLjE2NCwgMC4wMDAsIDEuNjc4LAotCQkgKiAgMS4x
NjQsIC0wLjE4NzMsIC0wLjY1MDQsCi0JCSAqICAxLjE2NCwgMi4xNDE3LCAwLjAwMDBdCi0JCSAq
LwotCQlbRFJNX0NPTE9SX1lDQkNSX0JUMjAyMF0gPSB7Ci0JCQkweDdENzAsIDB4Nzk1MCwgMHgw
LAotCQkJMHg4QTY4LCAweDc5NTAsIDB4QUMwMCwKLQkJCTB4MCwgMHg3OTUwLCAweDY4OTAsCi0J
CX0sCi0JfTsKLQljb25zdCB1MTYgKmNzYzsKLQotCWlmIChwbGFuZV9zdGF0ZS0+aHcuY29sb3Jf
cmFuZ2UgPT0gRFJNX0NPTE9SX1lDQkNSX0ZVTExfUkFOR0UpCi0JCWNzYyA9IGlucHV0X2NzY19t
YXRyaXhbcGxhbmVfc3RhdGUtPmh3LmNvbG9yX2VuY29kaW5nXTsKLQllbHNlCi0JCWNzYyA9IGlu
cHV0X2NzY19tYXRyaXhfbHJbcGxhbmVfc3RhdGUtPmh3LmNvbG9yX2VuY29kaW5nXTsKLQotCWlu
dGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9JTlBVVF9DU0NfQ09FRkYocGlwZSwgcGxh
bmVfaWQsIDApLAotCQkJICBST0ZGKGNzY1swXSkgfCBHT0ZGKGNzY1sxXSkpOwotCWludGVsX2Rl
X3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9JTlBVVF9DU0NfQ09FRkYocGlwZSwgcGxhbmVfaWQs
IDEpLAotCQkJICBCT0ZGKGNzY1syXSkpOwotCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQ
TEFORV9JTlBVVF9DU0NfQ09FRkYocGlwZSwgcGxhbmVfaWQsIDIpLAotCQkJICBST0ZGKGNzY1sz
XSkgfCBHT0ZGKGNzY1s0XSkpOwotCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9J
TlBVVF9DU0NfQ09FRkYocGlwZSwgcGxhbmVfaWQsIDMpLAotCQkJICBCT0ZGKGNzY1s1XSkpOwot
CWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9JTlBVVF9DU0NfQ09FRkYocGlwZSwg
cGxhbmVfaWQsIDQpLAotCQkJICBST0ZGKGNzY1s2XSkgfCBHT0ZGKGNzY1s3XSkpOwotCWludGVs
X2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9JTlBVVF9DU0NfQ09FRkYocGlwZSwgcGxhbmVf
aWQsIDUpLAotCQkJICBCT0ZGKGNzY1s4XSkpOwotCi0JaW50ZWxfZGVfd3JpdGVfZncoZGV2X3By
aXYsIFBMQU5FX0lOUFVUX0NTQ19QUkVPRkYocGlwZSwgcGxhbmVfaWQsIDApLAotCQkJICBQUkVP
RkZfWVVWX1RPX1JHQl9ISSk7Ci0JaWYgKHBsYW5lX3N0YXRlLT5ody5jb2xvcl9yYW5nZSA9PSBE
Uk1fQ09MT1JfWUNCQ1JfRlVMTF9SQU5HRSkKLQkJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYs
Ci0JCQkJICBQTEFORV9JTlBVVF9DU0NfUFJFT0ZGKHBpcGUsIHBsYW5lX2lkLCAxKSwKLQkJCQkg
IDApOwotCWVsc2UKLQkJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsCi0JCQkJICBQTEFORV9J
TlBVVF9DU0NfUFJFT0ZGKHBpcGUsIHBsYW5lX2lkLCAxKSwKLQkJCQkgIFBSRU9GRl9ZVVZfVE9f
UkdCX01FKTsKLQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfSU5QVVRfQ1NDX1BS
RU9GRihwaXBlLCBwbGFuZV9pZCwgMiksCi0JCQkgIFBSRU9GRl9ZVVZfVE9fUkdCX0xPKTsKLQlp
bnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwKLQkJCSAgUExBTkVfSU5QVVRfQ1NDX1BPU1RPRkYo
cGlwZSwgcGxhbmVfaWQsIDApLCAweDApOwotCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LAot
CQkJICBQTEFORV9JTlBVVF9DU0NfUE9TVE9GRihwaXBlLCBwbGFuZV9pZCwgMSksIDB4MCk7Ci0J
aW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsCi0JCQkgIFBMQU5FX0lOUFVUX0NTQ19QT1NUT0ZG
KHBpcGUsIHBsYW5lX2lkLCAyKSwgMHgwKTsKLX0KLQotc3RhdGljIHZvaWQKLXNrbF9wbGFuZV9h
c3luY19mbGlwKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCi0JCSAgICAgY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCSAgICAgY29uc3Qgc3RydWN0IGludGVs
X3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7Ci0JdW5zaWduZWQgbG9uZyBpcnFm
bGFnczsKLQllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gcGxhbmUtPmlkOwotCWVudW0gcGlwZSBw
aXBlID0gcGxhbmUtPnBpcGU7Ci0JdTMyIHN1cmZfYWRkciA9IHBsYW5lX3N0YXRlLT5jb2xvcl9w
bGFuZVswXS5vZmZzZXQ7Ci0JdTMyIHBsYW5lX2N0bCA9IHBsYW5lX3N0YXRlLT5jdGw7Ci0KLQlw
bGFuZV9jdGwgfD0gc2tsX3BsYW5lX2N0bF9jcnRjKGNydGNfc3RhdGUpOwotCi0Jc3Bpbl9sb2Nr
X2lycXNhdmUoJmRldl9wcml2LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOwotCi0JaW50ZWxfZGVf
d3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0NUTChwaXBlLCBwbGFuZV9pZCksIHBsYW5lX2N0bCk7
Ci0JaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX1NVUkYocGlwZSwgcGxhbmVfaWQp
LAotCQkJICBpbnRlbF9wbGFuZV9nZ3R0X29mZnNldChwbGFuZV9zdGF0ZSkgKyBzdXJmX2FkZHIp
OwotCi0Jc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFm
bGFncyk7Ci19Ci0KLXN0YXRpYyB2b2lkCi1za2xfcHJvZ3JhbV9wbGFuZShzdHJ1Y3QgaW50ZWxf
cGxhbmUgKnBsYW5lLAotCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAotCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCi0J
CSAgaW50IGNvbG9yX3BsYW5lKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0g
cGxhbmUtPmlkOwotCWVudW0gcGlwZSBwaXBlID0gcGxhbmUtPnBpcGU7Ci0JY29uc3Qgc3RydWN0
IGRybV9pbnRlbF9zcHJpdGVfY29sb3JrZXkgKmtleSA9ICZwbGFuZV9zdGF0ZS0+Y2tleTsKLQl1
MzIgc3VyZl9hZGRyID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2NvbG9yX3BsYW5lXS5vZmZz
ZXQ7Ci0JdTMyIHN0cmlkZSA9IHNrbF9wbGFuZV9zdHJpZGUocGxhbmVfc3RhdGUsIGNvbG9yX3Bs
YW5lKTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5o
dy5mYjsKLQlpbnQgYXV4X3BsYW5lID0gaW50ZWxfbWFpbl90b19hdXhfcGxhbmUoZmIsIGNvbG9y
X3BsYW5lKTsKLQlpbnQgY3J0Y194ID0gcGxhbmVfc3RhdGUtPnVhcGkuZHN0LngxOwotCWludCBj
cnRjX3kgPSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3QueTE7Ci0JdTMyIHggPSBwbGFuZV9zdGF0ZS0+
Y29sb3JfcGxhbmVbY29sb3JfcGxhbmVdLng7Ci0JdTMyIHkgPSBwbGFuZV9zdGF0ZS0+Y29sb3Jf
cGxhbmVbY29sb3JfcGxhbmVdLnk7Ci0JdTMyIHNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5l
X3N0YXRlLT51YXBpLnNyYykgPj4gMTY7Ci0JdTMyIHNyY19oID0gZHJtX3JlY3RfaGVpZ2h0KCZw
bGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OwotCXU4IGFscGhhID0gcGxhbmVfc3RhdGUtPmh3
LmFscGhhID4+IDg7Ci0JdTMyIHBsYW5lX2NvbG9yX2N0bCA9IDAsIGF1eF9kaXN0ID0gMDsKLQl1
bnNpZ25lZCBsb25nIGlycWZsYWdzOwotCXUzMiBrZXltc2ssIGtleW1heDsKLQl1MzIgcGxhbmVf
Y3RsID0gcGxhbmVfc3RhdGUtPmN0bDsKLQotCXBsYW5lX2N0bCB8PSBza2xfcGxhbmVfY3RsX2Ny
dGMoY3J0Y19zdGF0ZSk7Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19H
RU1JTklMQUtFKGRldl9wcml2KSkKLQkJcGxhbmVfY29sb3JfY3RsID0gcGxhbmVfc3RhdGUtPmNv
bG9yX2N0bCB8Ci0JCQlnbGtfcGxhbmVfY29sb3JfY3RsX2NydGMoY3J0Y19zdGF0ZSk7Ci0KLQkv
KiBTaXplcyBhcmUgMCBiYXNlZCAqLwotCXNyY193LS07Ci0Jc3JjX2gtLTsKLQotCWtleW1heCA9
IChrZXktPm1heF92YWx1ZSAmIDB4ZmZmZmZmKSB8IFBMQU5FX0tFWU1BWF9BTFBIQShhbHBoYSk7
Ci0KLQlrZXltc2sgPSBrZXktPmNoYW5uZWxfbWFzayAmIDB4N2ZmZmZmZjsKLQlpZiAoYWxwaGEg
PCAweGZmKQotCQlrZXltc2sgfD0gUExBTkVfS0VZTVNLX0FMUEhBX0VOQUJMRTsKLQotCS8qIFRo
ZSBzY2FsZXIgd2lsbCBoYW5kbGUgdGhlIG91dHB1dCBwb3NpdGlvbiAqLwotCWlmIChwbGFuZV9z
dGF0ZS0+c2NhbGVyX2lkID49IDApIHsKLQkJY3J0Y194ID0gMDsKLQkJY3J0Y195ID0gMDsKLQl9
Ci0KLQlpZiAoYXV4X3BsYW5lKSB7Ci0JCWF1eF9kaXN0ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3Bs
YW5lW2F1eF9wbGFuZV0ub2Zmc2V0IC0gc3VyZl9hZGRyOwotCi0JCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpIDwgMTIpCi0JCQlhdXhfZGlzdCB8PSBza2xfcGxhbmVfc3RyaWRlKHBsYW5lX3N0YXRl
LCBhdXhfcGxhbmUpOwotCX0KLQotCXNwaW5fbG9ja19pcnFzYXZlKCZkZXZfcHJpdi0+dW5jb3Jl
LmxvY2ssIGlycWZsYWdzKTsKLQotCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9T
VFJJREUocGlwZSwgcGxhbmVfaWQpLCBzdHJpZGUpOwotCWludGVsX2RlX3dyaXRlX2Z3KGRldl9w
cml2LCBQTEFORV9QT1MocGlwZSwgcGxhbmVfaWQpLAotCQkJICAoY3J0Y195IDw8IDE2KSB8IGNy
dGNfeCk7Ci0JaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX1NJWkUocGlwZSwgcGxh
bmVfaWQpLAotCQkJICAoc3JjX2ggPDwgMTYpIHwgc3JjX3cpOwotCi0JaW50ZWxfZGVfd3JpdGVf
ZncoZGV2X3ByaXYsIFBMQU5FX0FVWF9ESVNUKHBpcGUsIHBsYW5lX2lkKSwgYXV4X2Rpc3QpOwot
Ci0JaWYgKGljbF9pc19oZHJfcGxhbmUoZGV2X3ByaXYsIHBsYW5lX2lkKSkKLQkJaW50ZWxfZGVf
d3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0NVU19DVEwocGlwZSwgcGxhbmVfaWQpLAotCQkJCSAg
cGxhbmVfc3RhdGUtPmN1c19jdGwpOwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAg
fHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCi0JCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2
LCBQTEFORV9DT0xPUl9DVEwocGlwZSwgcGxhbmVfaWQpLAotCQkJCSAgcGxhbmVfY29sb3JfY3Rs
KTsKLQotCWlmIChmYi0+Zm9ybWF0LT5pc195dXYgJiYgaWNsX2lzX2hkcl9wbGFuZShkZXZfcHJp
diwgcGxhbmVfaWQpKQotCQlpY2xfcHJvZ3JhbV9pbnB1dF9jc2MocGxhbmUsIGNydGNfc3RhdGUs
IHBsYW5lX3N0YXRlKTsKLQotCXNrbF93cml0ZV9wbGFuZV93bShwbGFuZSwgY3J0Y19zdGF0ZSk7
Ci0KLQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfS0VZVkFMKHBpcGUsIHBsYW5l
X2lkKSwKLQkJCSAga2V5LT5taW5fdmFsdWUpOwotCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2
LCBQTEFORV9LRVlNU0socGlwZSwgcGxhbmVfaWQpLCBrZXltc2spOwotCWludGVsX2RlX3dyaXRl
X2Z3KGRldl9wcml2LCBQTEFORV9LRVlNQVgocGlwZSwgcGxhbmVfaWQpLCBrZXltYXgpOwotCi0J
aW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX09GRlNFVChwaXBlLCBwbGFuZV9pZCks
Ci0JCQkgICh5IDw8IDE2KSB8IHgpOwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMSkK
LQkJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0FVWF9PRkZTRVQocGlwZSwgcGxh
bmVfaWQpLAotCQkJCSAgKHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVsxXS55IDw8IDE2KSB8IHBs
YW5lX3N0YXRlLT5jb2xvcl9wbGFuZVsxXS54KTsKLQotCWlmICghZHJtX2F0b21pY19jcnRjX25l
ZWRzX21vZGVzZXQoJmNydGNfc3RhdGUtPnVhcGkpKQotCQlpbnRlbF9wc3IyX3Byb2dyYW1fcGxh
bmVfc2VsX2ZldGNoKHBsYW5lLCBjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSwgY29sb3JfcGxhbmUp
OwotCi0JLyoKLQkgKiBUaGUgY29udHJvbCByZWdpc3RlciBzZWxmLWFybXMgaWYgdGhlIHBsYW5l
IHdhcyBwcmV2aW91c2x5Ci0JICogZGlzYWJsZWQuIFRyeSB0byBtYWtlIHRoZSBwbGFuZSBlbmFi
bGUgYXRvbWljIGJ5IHdyaXRpbmcKLQkgKiB0aGUgY29udHJvbCByZWdpc3RlciBqdXN0IGJlZm9y
ZSB0aGUgc3VyZmFjZSByZWdpc3Rlci4KLQkgKi8KLQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJp
diwgUExBTkVfQ1RMKHBpcGUsIHBsYW5lX2lkKSwgcGxhbmVfY3RsKTsKLQlpbnRlbF9kZV93cml0
ZV9mdyhkZXZfcHJpdiwgUExBTkVfU1VSRihwaXBlLCBwbGFuZV9pZCksCi0JCQkgIGludGVsX3Bs
YW5lX2dndHRfb2Zmc2V0KHBsYW5lX3N0YXRlKSArIHN1cmZfYWRkcik7Ci0KLQlpZiAocGxhbmVf
c3RhdGUtPnNjYWxlcl9pZCA+PSAwKQotCQlza2xfcHJvZ3JhbV9zY2FsZXIocGxhbmUsIGNydGNf
c3RhdGUsIHBsYW5lX3N0YXRlKTsKLQotCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmRldl9wcml2
LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOwotfQotCi1zdGF0aWMgdm9pZAotc2tsX3VwZGF0ZV9w
bGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAotCQkgY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCSBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUg
KnBsYW5lX3N0YXRlKQotewotCWludCBjb2xvcl9wbGFuZSA9IDA7Ci0KLQlpZiAocGxhbmVfc3Rh
dGUtPnBsYW5hcl9saW5rZWRfcGxhbmUgJiYgIXBsYW5lX3N0YXRlLT5wbGFuYXJfc2xhdmUpCi0J
CS8qIFByb2dyYW0gdGhlIFVWIHBsYW5lIG9uIHBsYW5hciBtYXN0ZXIgKi8KLQkJY29sb3JfcGxh
bmUgPSAxOwotCi0Jc2tsX3Byb2dyYW1fcGxhbmUocGxhbmUsIGNydGNfc3RhdGUsIHBsYW5lX3N0
YXRlLCBjb2xvcl9wbGFuZSk7Ci19Ci1zdGF0aWMgdm9pZAotc2tsX2Rpc2FibGVfcGxhbmUoc3Ry
dWN0IGludGVsX3BsYW5lICpwbGFuZSwKLQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KHBsYW5lLT5iYXNlLmRldik7Ci0JZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5l
LT5pZDsKLQllbnVtIHBpcGUgcGlwZSA9IHBsYW5lLT5waXBlOwotCXVuc2lnbmVkIGxvbmcgaXJx
ZmxhZ3M7Ci0KLQlzcGluX2xvY2tfaXJxc2F2ZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFm
bGFncyk7Ci0KLQlpZiAoaWNsX2lzX2hkcl9wbGFuZShkZXZfcHJpdiwgcGxhbmVfaWQpKQotCQlp
bnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfQ1VTX0NUTChwaXBlLCBwbGFuZV9pZCks
IDApOwotCi0Jc2tsX3dyaXRlX3BsYW5lX3dtKHBsYW5lLCBjcnRjX3N0YXRlKTsKLQotCWludGVs
X2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9DVEwocGlwZSwgcGxhbmVfaWQpLCAwKTsKLQlp
bnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfU1VSRihwaXBlLCBwbGFuZV9pZCksIDAp
OwotCi0Jc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFm
bGFncyk7Ci19Ci0KLXN0YXRpYyBib29sCi1za2xfcGxhbmVfZ2V0X2h3X3N0YXRlKHN0cnVjdCBp
bnRlbF9wbGFuZSAqcGxhbmUsCi0JCSAgICAgICBlbnVtIHBpcGUgKnBpcGUpCi17Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwot
CWVudW0gaW50ZWxfZGlzcGxheV9wb3dlcl9kb21haW4gcG93ZXJfZG9tYWluOwotCWVudW0gcGxh
bmVfaWQgcGxhbmVfaWQgPSBwbGFuZS0+aWQ7Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7Ci0J
Ym9vbCByZXQ7Ci0KLQlwb3dlcl9kb21haW4gPSBQT1dFUl9ET01BSU5fUElQRShwbGFuZS0+cGlw
ZSk7Ci0Jd2FrZXJlZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoZGV2X3By
aXYsIHBvd2VyX2RvbWFpbik7Ci0JaWYgKCF3YWtlcmVmKQotCQlyZXR1cm4gZmFsc2U7Ci0KLQly
ZXQgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBQTEFORV9DVEwocGxhbmUtPnBpcGUsIHBsYW5l
X2lkKSkgJiBQTEFORV9DVExfRU5BQkxFOwotCi0JKnBpcGUgPSBwbGFuZS0+cGlwZTsKLQotCWlu
dGVsX2Rpc3BsYXlfcG93ZXJfcHV0KGRldl9wcml2LCBwb3dlcl9kb21haW4sIHdha2VyZWYpOwot
Ci0JcmV0dXJuIHJldDsKLX0KLQogc3RhdGljIHZvaWQgaTl4eF9wbGFuZV9saW5lYXJfZ2FtbWEo
dTE2IGdhbW1hWzhdKQogewogCS8qIFRoZSBwb2ludHMgYXJlIG5vdCBldmVubHkgc3BhY2VkLiAq
LwpAQCAtMjI4MSwyMzkgKzE2ODgsNiBAQCB2bHZfc3ByaXRlX2NoZWNrKHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgYm9vbCBpbnRl
bF9mb3JtYXRfaXNfcDAxeCh1MzIgZm9ybWF0KQotewotCXN3aXRjaCAoZm9ybWF0KSB7Ci0JY2Fz
ZSBEUk1fRk9STUFUX1AwMTA6Ci0JY2FzZSBEUk1fRk9STUFUX1AwMTI6Ci0JY2FzZSBEUk1fRk9S
TUFUX1AwMTY6Ci0JCXJldHVybiB0cnVlOwotCWRlZmF1bHQ6Ci0JCXJldHVybiBmYWxzZTsKLQl9
Ci19Ci0KLXN0YXRpYyBpbnQgc2tsX3BsYW5lX2NoZWNrX2ZiKGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlLAotCQkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5l
X3N0YXRlICpwbGFuZV9zdGF0ZSkKLXsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9f
aW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOwotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQljb25zdCBzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKLQl1bnNpZ25lZCBp
bnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247Ci0Jc3RydWN0IGRybV9mb3Jt
YXRfbmFtZV9idWYgZm9ybWF0X25hbWU7Ci0KLQlpZiAoIWZiKQotCQlyZXR1cm4gMDsKLQotCWlm
IChyb3RhdGlvbiAmIH4oRFJNX01PREVfUk9UQVRFXzAgfCBEUk1fTU9ERV9ST1RBVEVfMTgwKSAm
JgotCSAgICBpc19jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSkgewotCQlkcm1fZGJnX2ttcygm
ZGV2X3ByaXYtPmRybSwKLQkJCSAgICAiUkMgc3VwcG9ydCBvbmx5IHdpdGggMC8xODAgZGVncmVl
IHJvdGF0aW9uICgleClcbiIsCi0JCQkgICAgcm90YXRpb24pOwotCQlyZXR1cm4gLUVJTlZBTDsK
LQl9Ci0KLQlpZiAocm90YXRpb24gJiBEUk1fTU9ERV9SRUZMRUNUX1ggJiYKLQkgICAgZmItPm1v
ZGlmaWVyID09IERSTV9GT1JNQVRfTU9EX0xJTkVBUikgewotCQlkcm1fZGJnX2ttcygmZGV2X3By
aXYtPmRybSwKLQkJCSAgICAiaG9yaXpvbnRhbCBmbGlwIGlzIG5vdCBzdXBwb3J0ZWQgd2l0aCBs
aW5lYXIgc3VyZmFjZSBmb3JtYXRzXG4iKTsKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQotCi0JaWYg
KGRybV9yb3RhdGlvbl85MF9vcl8yNzAocm90YXRpb24pKSB7Ci0JCWlmIChmYi0+bW9kaWZpZXIg
IT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQgJiYKLQkJICAgIGZiLT5tb2RpZmllciAhPSBJOTE1
X0ZPUk1BVF9NT0RfWWZfVElMRUQpIHsKLQkJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAot
CQkJCSAgICAiWS9ZZiB0aWxpbmcgcmVxdWlyZWQgZm9yIDkwLzI3MCFcbiIpOwotCQkJcmV0dXJu
IC1FSU5WQUw7Ci0JCX0KLQotCQkvKgotCQkgKiA5MC8yNzAgaXMgbm90IGFsbG93ZWQgd2l0aCBS
R0I2NCAxNjoxNjoxNjoxNiBhbmQKLQkJICogSW5kZXhlZCA4LWJpdC4gUkdCIDE2LWJpdCA1OjY6
NSBpcyBhbGxvd2VkIGdlbjExIG9ud2FyZHMuCi0JCSAqLwotCQlzd2l0Y2ggKGZiLT5mb3JtYXQt
PmZvcm1hdCkgewotCQljYXNlIERSTV9GT1JNQVRfUkdCNTY1OgotCQkJaWYgKElOVEVMX0dFTihk
ZXZfcHJpdikgPj0gMTEpCi0JCQkJYnJlYWs7Ci0JCQlmYWxsdGhyb3VnaDsKLQkJY2FzZSBEUk1f
Rk9STUFUX0M4OgotCQljYXNlIERSTV9GT1JNQVRfWFJHQjE2MTYxNjE2RjoKLQkJY2FzZSBEUk1f
Rk9STUFUX1hCR1IxNjE2MTYxNkY6Ci0JCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMTYxNjE2MTZGOgot
CQljYXNlIERSTV9GT1JNQVRfQUJHUjE2MTYxNjE2RjoKLQkJY2FzZSBEUk1fRk9STUFUX1kyMTA6
Ci0JCWNhc2UgRFJNX0ZPUk1BVF9ZMjEyOgotCQljYXNlIERSTV9GT1JNQVRfWTIxNjoKLQkJY2Fz
ZSBEUk1fRk9STUFUX1hWWVUxMl8xNjE2MTYxNjoKLQkJY2FzZSBEUk1fRk9STUFUX1hWWVUxNjE2
MTYxNjoKLQkJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAotCQkJCSAgICAiVW5zdXBwb3J0
ZWQgcGl4ZWwgZm9ybWF0ICVzIGZvciA5MC8yNzAhXG4iLAotCQkJCSAgICBkcm1fZ2V0X2Zvcm1h
dF9uYW1lKGZiLT5mb3JtYXQtPmZvcm1hdCwKLQkJCQkJCQkmZm9ybWF0X25hbWUpKTsKLQkJCXJl
dHVybiAtRUlOVkFMOwotCQlkZWZhdWx0OgotCQkJYnJlYWs7Ci0JCX0KLQl9Ci0KLQkvKiBZLXRp
bGluZyBpcyBub3Qgc3VwcG9ydGVkIGluIElGLUlEIEludGVybGFjZSBtb2RlICovCi0JaWYgKGNy
dGNfc3RhdGUtPmh3LmVuYWJsZSAmJgotCSAgICBjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2Rl
LmZsYWdzICYgRFJNX01PREVfRkxBR19JTlRFUkxBQ0UgJiYKLQkgICAgKGZiLT5tb2RpZmllciA9
PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRCB8fAotCSAgICAgZmItPm1vZGlmaWVyID09IEk5MTVf
Rk9STUFUX01PRF9ZZl9USUxFRCB8fAotCSAgICAgZmItPm1vZGlmaWVyID09IEk5MTVfRk9STUFU
X01PRF9ZX1RJTEVEX0NDUyB8fAotCSAgICAgZmItPm1vZGlmaWVyID09IEk5MTVfRk9STUFUX01P
RF9ZZl9USUxFRF9DQ1MgfHwKLQkgICAgIGZiLT5tb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0Rf
WV9USUxFRF9HRU4xMl9SQ19DQ1MgfHwKLQkgICAgIGZiLT5tb2RpZmllciA9PSBJOTE1X0ZPUk1B
VF9NT0RfWV9USUxFRF9HRU4xMl9NQ19DQ1MpKSB7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+
ZHJtLAotCQkJICAgICJZL1lmIHRpbGluZyBub3Qgc3VwcG9ydGVkIGluIElGLUlEIG1vZGVcbiIp
OwotCQlyZXR1cm4gLUVJTlZBTDsKLQl9Ci0KLQkvKiBXYV8xNjA2MDU0MTg4OnRnbCAqLwotCWlm
IChJU19USUdFUkxBS0UoZGV2X3ByaXYpICYmCi0JICAgIHBsYW5lX3N0YXRlLT5ja2V5LmZsYWdz
ICYgSTkxNV9TRVRfQ09MT1JLRVlfU09VUkNFICYmCi0JICAgIGludGVsX2Zvcm1hdF9pc19wMDF4
KGZiLT5mb3JtYXQtPmZvcm1hdCkpIHsKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCi0J
CQkgICAgIlNvdXJjZSBjb2xvciBrZXlpbmcgbm90IHN1cHBvcnRlZCB3aXRoIFAwMXggZm9ybWF0
c1xuIik7Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQotCXJldHVybiAwOwotfQotCi1zdGF0aWMg
aW50IHNrbF9wbGFuZV9jaGVja19kc3RfY29vcmRpbmF0ZXMoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCQkJCSAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9z
dGF0ZSAqcGxhbmVfc3RhdGUpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0KLQkJdG9faTkxNShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZS0+ZGV2KTsKLQlpbnQgY3J0Y194
ID0gcGxhbmVfc3RhdGUtPnVhcGkuZHN0LngxOwotCWludCBjcnRjX3cgPSBkcm1fcmVjdF93aWR0
aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKLQlpbnQgcGlwZV9zcmNfdyA9IGNydGNfc3RhdGUt
PnBpcGVfc3JjX3c7Ci0KLQkvKgotCSAqIERpc3BsYXkgV0EgIzExNzU6IGNubCxnbGsKLQkgKiBQ
bGFuZXMgb3RoZXIgdGhhbiB0aGUgY3Vyc29yIG1heSBjYXVzZSBGSUZPIHVuZGVyZmxvdyBhbmQg
ZGlzcGxheQotCSAqIGNvcnJ1cHRpb24gaWYgc3RhcnRpbmcgbGVzcyB0aGFuIDQgcGl4ZWxzIGZy
b20gdGhlIHJpZ2h0IGVkZ2Ugb2YKLQkgKiB0aGUgc2NyZWVuLgotCSAqIEJlc2lkZXMgdGhlIGFi
b3ZlIFdBIGZpeCB0aGUgc2ltaWxhciBwcm9ibGVtLCB3aGVyZSBwbGFuZXMgb3RoZXIKLQkgKiB0
aGFuIHRoZSBjdXJzb3IgZW5kaW5nIGxlc3MgdGhhbiA0IHBpeGVscyBmcm9tIHRoZSBsZWZ0IGVk
Z2Ugb2YgdGhlCi0JICogc2NyZWVuIG1heSBjYXVzZSBGSUZPIHVuZGVyZmxvdyBhbmQgZGlzcGxh
eSBjb3JydXB0aW9uLgotCSAqLwotCWlmICgoSVNfR0VNSU5JTEFLRShkZXZfcHJpdikgfHwgSVNf
Q0FOTk9OTEFLRShkZXZfcHJpdikpICYmCi0JICAgIChjcnRjX3ggKyBjcnRjX3cgPCA0IHx8IGNy
dGNfeCA+IHBpcGVfc3JjX3cgLSA0KSkgewotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwK
LQkJCSAgICAicmVxdWVzdGVkIHBsYW5lIFggJXMgcG9zaXRpb24gJWQgaW52YWxpZCAodmFsaWQg
cmFuZ2UgJWQtJWQpXG4iLAotCQkJICAgIGNydGNfeCArIGNydGNfdyA8IDQgPyAiZW5kIiA6ICJz
dGFydCIsCi0JCQkgICAgY3J0Y194ICsgY3J0Y193IDwgNCA/IGNydGNfeCArIGNydGNfdyA6IGNy
dGNfeCwKLQkJCSAgICA0LCBwaXBlX3NyY193IC0gNCk7Ci0JCXJldHVybiAtRVJBTkdFOwotCX0K
LQotCXJldHVybiAwOwotfQotCi1zdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVja19udjEyX3JvdGF0
aW9uKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCi17Ci0JY29u
c3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7Ci0JdW5z
aWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwotCWludCBzcmNf
dyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OwotCi0JLyog
RGlzcGxheSBXQSAjMTEwNiAqLwotCWlmIChpbnRlbF9mb3JtYXRfaW5mb19pc195dXZfc2VtaXBs
YW5hcihmYi0+Zm9ybWF0LCBmYi0+bW9kaWZpZXIpICYmCi0JICAgIHNyY193ICYgMyAmJgotCSAg
ICAocm90YXRpb24gPT0gRFJNX01PREVfUk9UQVRFXzI3MCB8fAotCSAgICAgcm90YXRpb24gPT0g
KERSTV9NT0RFX1JFRkxFQ1RfWCB8IERSTV9NT0RFX1JPVEFURV85MCkpKSB7Ci0JCURSTV9ERUJV
R19LTVMoInNyYyB3aWR0aCBtdXN0IGJlIG11bHRpcGxlIG9mIDQgZm9yIHJvdGF0ZWQgcGxhbmFy
IFlVVlxuIik7Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQotCXJldHVybiAwOwotfQotCi1zdGF0
aWMgaW50IHNrbF9wbGFuZV9tYXhfc2NhbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAotCQkJICAgICAgIGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiKQotewotCS8q
Ci0JICogV2UgZG9uJ3QgeWV0IGtub3cgdGhlIGZpbmFsIHNvdXJjZSB3aWR0aCBub3IKLQkgKiB3
aGV0aGVyIHdlIGNhbiB1c2UgdGhlIEhRIHNjYWxlciBtb2RlLiBBc3N1bWUKLQkgKiB0aGUgYmVz
dCBjYXNlLgotCSAqIEZJWE1FIG5lZWQgdG8gcHJvcGVybHkgY2hlY2sgdGhpcyBsYXRlci4KLQkg
Ki8KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9w
cml2KSB8fAotCSAgICAhaW50ZWxfZm9ybWF0X2luZm9faXNfeXV2X3NlbWlwbGFuYXIoZmItPmZv
cm1hdCwgZmItPm1vZGlmaWVyKSkKLQkJcmV0dXJuIDB4MzAwMDAgLSAxOwotCWVsc2UKLQkJcmV0
dXJuIDB4MjAwMDAgLSAxOwotfQotCi1zdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVjayhzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJCSAgIHN0cnVjdCBpbnRlbF9wbGFuZV9z
dGF0ZSAqcGxhbmVfc3RhdGUpCi17Ci0Jc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2lu
dGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7Ci0JY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7Ci0JaW50IG1pbl9zY2Fs
ZSA9IERSTV9QTEFORV9IRUxQRVJfTk9fU0NBTElORzsKLQlpbnQgbWF4X3NjYWxlID0gRFJNX1BM
QU5FX0hFTFBFUl9OT19TQ0FMSU5HOwotCWludCByZXQ7Ci0KLQlyZXQgPSBza2xfcGxhbmVfY2hl
Y2tfZmIoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7
Ci0KLQkvKiB1c2Ugc2NhbGVyIHdoZW4gY29sb3JrZXkgaXMgbm90IHJlcXVpcmVkICovCi0JaWYg
KCFwbGFuZV9zdGF0ZS0+Y2tleS5mbGFncyAmJiBpbnRlbF9mYl9zY2FsYWJsZShmYikpIHsKLQkJ
bWluX3NjYWxlID0gMTsKLQkJbWF4X3NjYWxlID0gc2tsX3BsYW5lX21heF9zY2FsZShkZXZfcHJp
diwgZmIpOwotCX0KLQotCXJldCA9IGludGVsX2F0b21pY19wbGFuZV9jaGVja19jbGlwcGluZyhw
bGFuZV9zdGF0ZSwgY3J0Y19zdGF0ZSwKLQkJCQkJCW1pbl9zY2FsZSwgbWF4X3NjYWxlLCB0cnVl
KTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCi0JcmV0ID0gc2tsX2NoZWNrX3BsYW5lX3N1
cmZhY2UocGxhbmVfc3RhdGUpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQlpZiAoIXBs
YW5lX3N0YXRlLT51YXBpLnZpc2libGUpCi0JCXJldHVybiAwOwotCi0JcmV0ID0gc2tsX3BsYW5l
X2NoZWNrX2RzdF9jb29yZGluYXRlcyhjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7Ci0JaWYgKHJl
dCkKLQkJcmV0dXJuIHJldDsKLQotCXJldCA9IGludGVsX3BsYW5lX2NoZWNrX3NyY19jb29yZGlu
YXRlcyhwbGFuZV9zdGF0ZSk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQotCXJldCA9IHNr
bF9wbGFuZV9jaGVja19udjEyX3JvdGF0aW9uKHBsYW5lX3N0YXRlKTsKLQlpZiAocmV0KQotCQly
ZXR1cm4gcmV0OwotCi0JLyogSFcgb25seSBoYXMgOCBiaXRzIHBpeGVsIHByZWNpc2lvbiwgZGlz
YWJsZSBwbGFuZSBpZiBpbnZpc2libGUgKi8KLQlpZiAoIShwbGFuZV9zdGF0ZS0+aHcuYWxwaGEg
Pj4gOCkpCi0JCXBsYW5lX3N0YXRlLT51YXBpLnZpc2libGUgPSBmYWxzZTsKLQotCXBsYW5lX3N0
YXRlLT5jdGwgPSBza2xfcGxhbmVfY3RsKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKTsKLQotCWlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKQot
CQlwbGFuZV9zdGF0ZS0+Y29sb3JfY3RsID0gZ2xrX3BsYW5lX2NvbG9yX2N0bChjcnRjX3N0YXRl
LAotCQkJCQkJCSAgICAgcGxhbmVfc3RhdGUpOwotCi0JaWYgKGludGVsX2Zvcm1hdF9pbmZvX2lz
X3l1dl9zZW1pcGxhbmFyKGZiLT5mb3JtYXQsIGZiLT5tb2RpZmllcikgJiYKLQkgICAgaWNsX2lz
X2hkcl9wbGFuZShkZXZfcHJpdiwgcGxhbmUtPmlkKSkKLQkJLyogRW5hYmxlIGFuZCB1c2UgTVBF
Ry0yIGNocm9tYSBzaXRpbmcgKi8KLQkJcGxhbmVfc3RhdGUtPmN1c19jdGwgPSBQTEFORV9DVVNf
RU5BQkxFIHwKLQkJCVBMQU5FX0NVU19IUEhBU0VfMCB8Ci0JCQlQTEFORV9DVVNfVlBIQVNFX1NJ
R05fTkVHQVRJVkUgfCBQTEFORV9DVVNfVlBIQVNFXzBfMjU7Ci0JZWxzZQotCQlwbGFuZV9zdGF0
ZS0+Y3VzX2N0bCA9IDA7Ci0KLQlyZXR1cm4gMDsKLX0KLQogc3RhdGljIGJvb2wgaGFzX2RzdF9r
ZXlfaW5fcHJpbWFyeV9wbGFuZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7
CiAJcmV0dXJuIElOVEVMX0dFTihkZXZfcHJpdikgPj0gOTsKQEAgLTI2NDAsMTY5ICsxODE0LDQx
IEBAIHN0YXRpYyBjb25zdCB1MzIgZzR4X3BsYW5lX2Zvcm1hdHNbXSA9IHsKIAlEUk1fRk9STUFU
X1ZZVVksCiB9OwogCi1zdGF0aWMgY29uc3QgdTY0IGk5eHhfcGxhbmVfZm9ybWF0X21vZGlmaWVy
c1tdID0gewotCUk5MTVfRk9STUFUX01PRF9YX1RJTEVELAotCURSTV9GT1JNQVRfTU9EX0xJTkVB
UiwKLQlEUk1fRk9STUFUX01PRF9JTlZBTElECi19OwotCi1zdGF0aWMgY29uc3QgdTMyIHNuYl9w
bGFuZV9mb3JtYXRzW10gPSB7Ci0JRFJNX0ZPUk1BVF9YUkdCODg4OCwKLQlEUk1fRk9STUFUX1hC
R1I4ODg4LAotCURSTV9GT1JNQVRfWFJHQjIxMDEwMTAsCi0JRFJNX0ZPUk1BVF9YQkdSMjEwMTAx
MCwKLQlEUk1fRk9STUFUX1hSR0IxNjE2MTYxNkYsCi0JRFJNX0ZPUk1BVF9YQkdSMTYxNjE2MTZG
LAotCURSTV9GT1JNQVRfWVVZViwKLQlEUk1fRk9STUFUX1lWWVUsCi0JRFJNX0ZPUk1BVF9VWVZZ
LAotCURSTV9GT1JNQVRfVllVWSwKLX07Ci0KLXN0YXRpYyBjb25zdCB1MzIgdmx2X3BsYW5lX2Zv
cm1hdHNbXSA9IHsKLQlEUk1fRk9STUFUX0M4LAotCURSTV9GT1JNQVRfUkdCNTY1LAotCURSTV9G
T1JNQVRfWFJHQjg4ODgsCi0JRFJNX0ZPUk1BVF9YQkdSODg4OCwKLQlEUk1fRk9STUFUX0FSR0I4
ODg4LAotCURSTV9GT1JNQVRfQUJHUjg4ODgsCi0JRFJNX0ZPUk1BVF9YQkdSMjEwMTAxMCwKLQlE
Uk1fRk9STUFUX0FCR1IyMTAxMDEwLAotCURSTV9GT1JNQVRfWVVZViwKLQlEUk1fRk9STUFUX1lW
WVUsCi0JRFJNX0ZPUk1BVF9VWVZZLAotCURSTV9GT1JNQVRfVllVWSwKLX07Ci0KLXN0YXRpYyBj
b25zdCB1MzIgY2h2X3BpcGVfYl9zcHJpdGVfZm9ybWF0c1tdID0gewotCURSTV9GT1JNQVRfQzgs
Ci0JRFJNX0ZPUk1BVF9SR0I1NjUsCi0JRFJNX0ZPUk1BVF9YUkdCODg4OCwKLQlEUk1fRk9STUFU
X1hCR1I4ODg4LAotCURSTV9GT1JNQVRfQVJHQjg4ODgsCi0JRFJNX0ZPUk1BVF9BQkdSODg4OCwK
LQlEUk1fRk9STUFUX1hSR0IyMTAxMDEwLAotCURSTV9GT1JNQVRfWEJHUjIxMDEwMTAsCi0JRFJN
X0ZPUk1BVF9BUkdCMjEwMTAxMCwKLQlEUk1fRk9STUFUX0FCR1IyMTAxMDEwLAotCURSTV9GT1JN
QVRfWVVZViwKLQlEUk1fRk9STUFUX1lWWVUsCi0JRFJNX0ZPUk1BVF9VWVZZLAotCURSTV9GT1JN
QVRfVllVWSwKLX07Ci0KLXN0YXRpYyBjb25zdCB1MzIgc2tsX3BsYW5lX2Zvcm1hdHNbXSA9IHsK
LQlEUk1fRk9STUFUX0M4LAotCURSTV9GT1JNQVRfUkdCNTY1LAotCURSTV9GT1JNQVRfWFJHQjg4
ODgsCi0JRFJNX0ZPUk1BVF9YQkdSODg4OCwKLQlEUk1fRk9STUFUX0FSR0I4ODg4LAotCURSTV9G
T1JNQVRfQUJHUjg4ODgsCi0JRFJNX0ZPUk1BVF9YUkdCMjEwMTAxMCwKLQlEUk1fRk9STUFUX1hC
R1IyMTAxMDEwLAotCURSTV9GT1JNQVRfWFJHQjE2MTYxNjE2RiwKLQlEUk1fRk9STUFUX1hCR1Ix
NjE2MTYxNkYsCi0JRFJNX0ZPUk1BVF9ZVVlWLAotCURSTV9GT1JNQVRfWVZZVSwKLQlEUk1fRk9S
TUFUX1VZVlksCi0JRFJNX0ZPUk1BVF9WWVVZLAotCURSTV9GT1JNQVRfWFlVVjg4ODgsCi19Owot
Ci1zdGF0aWMgY29uc3QgdTMyIHNrbF9wbGFuYXJfZm9ybWF0c1tdID0gewotCURSTV9GT1JNQVRf
QzgsCi0JRFJNX0ZPUk1BVF9SR0I1NjUsCi0JRFJNX0ZPUk1BVF9YUkdCODg4OCwKLQlEUk1fRk9S
TUFUX1hCR1I4ODg4LAotCURSTV9GT1JNQVRfQVJHQjg4ODgsCi0JRFJNX0ZPUk1BVF9BQkdSODg4
OCwKLQlEUk1fRk9STUFUX1hSR0IyMTAxMDEwLAotCURSTV9GT1JNQVRfWEJHUjIxMDEwMTAsCi0J
RFJNX0ZPUk1BVF9YUkdCMTYxNjE2MTZGLAotCURSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RiwKLQlE
Uk1fRk9STUFUX1lVWVYsCi0JRFJNX0ZPUk1BVF9ZVllVLAotCURSTV9GT1JNQVRfVVlWWSwKLQlE
Uk1fRk9STUFUX1ZZVVksCi0JRFJNX0ZPUk1BVF9OVjEyLAotCURSTV9GT1JNQVRfWFlVVjg4ODgs
Ci19OwotCi1zdGF0aWMgY29uc3QgdTMyIGdsa19wbGFuYXJfZm9ybWF0c1tdID0gewotCURSTV9G
T1JNQVRfQzgsCi0JRFJNX0ZPUk1BVF9SR0I1NjUsCi0JRFJNX0ZPUk1BVF9YUkdCODg4OCwKLQlE
Uk1fRk9STUFUX1hCR1I4ODg4LAotCURSTV9GT1JNQVRfQVJHQjg4ODgsCi0JRFJNX0ZPUk1BVF9B
QkdSODg4OCwKLQlEUk1fRk9STUFUX1hSR0IyMTAxMDEwLAotCURSTV9GT1JNQVRfWEJHUjIxMDEw
MTAsCi0JRFJNX0ZPUk1BVF9YUkdCMTYxNjE2MTZGLAotCURSTV9GT1JNQVRfWEJHUjE2MTYxNjE2
RiwKLQlEUk1fRk9STUFUX1lVWVYsCi0JRFJNX0ZPUk1BVF9ZVllVLAotCURSTV9GT1JNQVRfVVlW
WSwKLQlEUk1fRk9STUFUX1ZZVVksCi0JRFJNX0ZPUk1BVF9OVjEyLAotCURSTV9GT1JNQVRfWFlV
Vjg4ODgsCi0JRFJNX0ZPUk1BVF9QMDEwLAotCURSTV9GT1JNQVRfUDAxMiwKLQlEUk1fRk9STUFU
X1AwMTYsCi19OwotCi1zdGF0aWMgY29uc3QgdTMyIGljbF9zZHJfeV9wbGFuZV9mb3JtYXRzW10g
PSB7Ci0JRFJNX0ZPUk1BVF9DOCwKLQlEUk1fRk9STUFUX1JHQjU2NSwKK3N0YXRpYyBjb25zdCB1
NjQgaTl4eF9wbGFuZV9mb3JtYXRfbW9kaWZpZXJzW10gPSB7CisJSTkxNV9GT1JNQVRfTU9EX1hf
VElMRUQsCisJRFJNX0ZPUk1BVF9NT0RfTElORUFSLAorCURSTV9GT1JNQVRfTU9EX0lOVkFMSUQK
K307CisKK3N0YXRpYyBjb25zdCB1MzIgc25iX3BsYW5lX2Zvcm1hdHNbXSA9IHsKIAlEUk1fRk9S
TUFUX1hSR0I4ODg4LAogCURSTV9GT1JNQVRfWEJHUjg4ODgsCi0JRFJNX0ZPUk1BVF9BUkdCODg4
OCwKLQlEUk1fRk9STUFUX0FCR1I4ODg4LAogCURSTV9GT1JNQVRfWFJHQjIxMDEwMTAsCiAJRFJN
X0ZPUk1BVF9YQkdSMjEwMTAxMCwKLQlEUk1fRk9STUFUX0FSR0IyMTAxMDEwLAotCURSTV9GT1JN
QVRfQUJHUjIxMDEwMTAsCisJRFJNX0ZPUk1BVF9YUkdCMTYxNjE2MTZGLAorCURSTV9GT1JNQVRf
WEJHUjE2MTYxNjE2RiwKIAlEUk1fRk9STUFUX1lVWVYsCiAJRFJNX0ZPUk1BVF9ZVllVLAogCURS
TV9GT1JNQVRfVVlWWSwKIAlEUk1fRk9STUFUX1ZZVVksCi0JRFJNX0ZPUk1BVF9ZMjEwLAotCURS
TV9GT1JNQVRfWTIxMiwKLQlEUk1fRk9STUFUX1kyMTYsCi0JRFJNX0ZPUk1BVF9YWVVWODg4OCwK
LQlEUk1fRk9STUFUX1hWWVUyMTAxMDEwLAotCURSTV9GT1JNQVRfWFZZVTEyXzE2MTYxNjE2LAot
CURSTV9GT1JNQVRfWFZZVTE2MTYxNjE2LAogfTsKIAotc3RhdGljIGNvbnN0IHUzMiBpY2xfc2Ry
X3V2X3BsYW5lX2Zvcm1hdHNbXSA9IHsKK3N0YXRpYyBjb25zdCB1MzIgdmx2X3BsYW5lX2Zvcm1h
dHNbXSA9IHsKIAlEUk1fRk9STUFUX0M4LAogCURSTV9GT1JNQVRfUkdCNTY1LAogCURSTV9GT1JN
QVRfWFJHQjg4ODgsCiAJRFJNX0ZPUk1BVF9YQkdSODg4OCwKIAlEUk1fRk9STUFUX0FSR0I4ODg4
LAogCURSTV9GT1JNQVRfQUJHUjg4ODgsCi0JRFJNX0ZPUk1BVF9YUkdCMjEwMTAxMCwKIAlEUk1f
Rk9STUFUX1hCR1IyMTAxMDEwLAotCURSTV9GT1JNQVRfQVJHQjIxMDEwMTAsCiAJRFJNX0ZPUk1B
VF9BQkdSMjEwMTAxMCwKIAlEUk1fRk9STUFUX1lVWVYsCiAJRFJNX0ZPUk1BVF9ZVllVLAogCURS
TV9GT1JNQVRfVVlWWSwKIAlEUk1fRk9STUFUX1ZZVVksCi0JRFJNX0ZPUk1BVF9OVjEyLAotCURS
TV9GT1JNQVRfUDAxMCwKLQlEUk1fRk9STUFUX1AwMTIsCi0JRFJNX0ZPUk1BVF9QMDE2LAotCURS
TV9GT1JNQVRfWTIxMCwKLQlEUk1fRk9STUFUX1kyMTIsCi0JRFJNX0ZPUk1BVF9ZMjE2LAotCURS
TV9GT1JNQVRfWFlVVjg4ODgsCi0JRFJNX0ZPUk1BVF9YVllVMjEwMTAxMCwKLQlEUk1fRk9STUFU
X1hWWVUxMl8xNjE2MTYxNiwKLQlEUk1fRk9STUFUX1hWWVUxNjE2MTYxNiwKIH07CiAKLXN0YXRp
YyBjb25zdCB1MzIgaWNsX2hkcl9wbGFuZV9mb3JtYXRzW10gPSB7CitzdGF0aWMgY29uc3QgdTMy
IGNodl9waXBlX2Jfc3ByaXRlX2Zvcm1hdHNbXSA9IHsKIAlEUk1fRk9STUFUX0M4LAogCURSTV9G
T1JNQVRfUkdCNTY1LAogCURSTV9GT1JNQVRfWFJHQjg4ODgsCkBAIC0yODEzLDYwICsxODU5LDEw
IEBAIHN0YXRpYyBjb25zdCB1MzIgaWNsX2hkcl9wbGFuZV9mb3JtYXRzW10gPSB7CiAJRFJNX0ZP
Uk1BVF9YQkdSMjEwMTAxMCwKIAlEUk1fRk9STUFUX0FSR0IyMTAxMDEwLAogCURSTV9GT1JNQVRf
QUJHUjIxMDEwMTAsCi0JRFJNX0ZPUk1BVF9YUkdCMTYxNjE2MTZGLAotCURSTV9GT1JNQVRfWEJH
UjE2MTYxNjE2RiwKLQlEUk1fRk9STUFUX0FSR0IxNjE2MTYxNkYsCi0JRFJNX0ZPUk1BVF9BQkdS
MTYxNjE2MTZGLAogCURSTV9GT1JNQVRfWVVZViwKIAlEUk1fRk9STUFUX1lWWVUsCiAJRFJNX0ZP
Uk1BVF9VWVZZLAogCURSTV9GT1JNQVRfVllVWSwKLQlEUk1fRk9STUFUX05WMTIsCi0JRFJNX0ZP
Uk1BVF9QMDEwLAotCURSTV9GT1JNQVRfUDAxMiwKLQlEUk1fRk9STUFUX1AwMTYsCi0JRFJNX0ZP
Uk1BVF9ZMjEwLAotCURSTV9GT1JNQVRfWTIxMiwKLQlEUk1fRk9STUFUX1kyMTYsCi0JRFJNX0ZP
Uk1BVF9YWVVWODg4OCwKLQlEUk1fRk9STUFUX1hWWVUyMTAxMDEwLAotCURSTV9GT1JNQVRfWFZZ
VTEyXzE2MTYxNjE2LAotCURSTV9GT1JNQVRfWFZZVTE2MTYxNjE2LAotfTsKLQotc3RhdGljIGNv
bnN0IHU2NCBza2xfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19ub2Njc1tdID0gewotCUk5MTVfRk9S
TUFUX01PRF9ZZl9USUxFRCwKLQlJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRCwKLQlJOTE1X0ZPUk1B
VF9NT0RfWF9USUxFRCwKLQlEUk1fRk9STUFUX01PRF9MSU5FQVIsCi0JRFJNX0ZPUk1BVF9NT0Rf
SU5WQUxJRAotfTsKLQotc3RhdGljIGNvbnN0IHU2NCBza2xfcGxhbmVfZm9ybWF0X21vZGlmaWVy
c19jY3NbXSA9IHsKLQlJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRURfQ0NTLAotCUk5MTVfRk9STUFU
X01PRF9ZX1RJTEVEX0NDUywKLQlJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRUQsCi0JSTkxNV9GT1JN
QVRfTU9EX1lfVElMRUQsCi0JSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQsCi0JRFJNX0ZPUk1BVF9N
T0RfTElORUFSLAotCURSTV9GT1JNQVRfTU9EX0lOVkFMSUQKLX07Ci0KLXN0YXRpYyBjb25zdCB1
NjQgZ2VuMTJfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19tY19jY3NbXSA9IHsKLQlJOTE1X0ZPUk1B
VF9NT0RfWV9USUxFRF9HRU4xMl9NQ19DQ1MsCi0JSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VO
MTJfUkNfQ0NTLAotCUk5MTVfRk9STUFUX01PRF9ZX1RJTEVELAotCUk5MTVfRk9STUFUX01PRF9Y
X1RJTEVELAotCURSTV9GT1JNQVRfTU9EX0xJTkVBUiwKLQlEUk1fRk9STUFUX01PRF9JTlZBTElE
Ci19OwotCi1zdGF0aWMgY29uc3QgdTY0IGdlbjEyX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfcmNf
Y2NzW10gPSB7Ci0JSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTLAotCUk5MTVf
Rk9STUFUX01PRF9ZX1RJTEVELAotCUk5MTVfRk9STUFUX01PRF9YX1RJTEVELAotCURSTV9GT1JN
QVRfTU9EX0xJTkVBUiwKLQlEUk1fRk9STUFUX01PRF9JTlZBTElECiB9OwogCiBzdGF0aWMgYm9v
bCBnNHhfc3ByaXRlX2Zvcm1hdF9tb2Rfc3VwcG9ydGVkKHN0cnVjdCBkcm1fcGxhbmUgKl9wbGFu
ZSwKQEAgLTI5NjEsMTQ4ICsxOTU3LDYgQEAgc3RhdGljIGJvb2wgdmx2X3Nwcml0ZV9mb3JtYXRf
bW9kX3N1cHBvcnRlZChzdHJ1Y3QgZHJtX3BsYW5lICpfcGxhbmUsCiAJfQogfQogCi1zdGF0aWMg
Ym9vbCBza2xfcGxhbmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQoc3RydWN0IGRybV9wbGFuZSAqX3Bs
YW5lLAotCQkJCQkgICB1MzIgZm9ybWF0LCB1NjQgbW9kaWZpZXIpCi17Ci0Jc3RydWN0IGludGVs
X3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKF9wbGFuZSk7Ci0KLQlzd2l0Y2ggKG1vZGlm
aWVyKSB7Ci0JY2FzZSBEUk1fRk9STUFUX01PRF9MSU5FQVI6Ci0JY2FzZSBJOTE1X0ZPUk1BVF9N
T0RfWF9USUxFRDoKLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEOgotCWNhc2UgSTkxNV9G
T1JNQVRfTU9EX1lmX1RJTEVEOgotCQlicmVhazsKLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJ
TEVEX0NDUzoKLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRF9DQ1M6Ci0JCWlmICghcGxh
bmUtPmhhc19jY3MpCi0JCQlyZXR1cm4gZmFsc2U7Ci0JCWJyZWFrOwotCWRlZmF1bHQ6Ci0JCXJl
dHVybiBmYWxzZTsKLQl9Ci0KLQlzd2l0Y2ggKGZvcm1hdCkgewotCWNhc2UgRFJNX0ZPUk1BVF9Y
UkdCODg4ODoKLQljYXNlIERSTV9GT1JNQVRfWEJHUjg4ODg6Ci0JY2FzZSBEUk1fRk9STUFUX0FS
R0I4ODg4OgotCWNhc2UgRFJNX0ZPUk1BVF9BQkdSODg4ODoKLQkJaWYgKGlzX2Njc19tb2RpZmll
cihtb2RpZmllcikpCi0JCQlyZXR1cm4gdHJ1ZTsKLQkJZmFsbHRocm91Z2g7Ci0JY2FzZSBEUk1f
Rk9STUFUX1JHQjU2NToKLQljYXNlIERSTV9GT1JNQVRfWFJHQjIxMDEwMTA6Ci0JY2FzZSBEUk1f
Rk9STUFUX1hCR1IyMTAxMDEwOgotCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMjEwMTAxMDoKLQljYXNl
IERSTV9GT1JNQVRfQUJHUjIxMDEwMTA6Ci0JY2FzZSBEUk1fRk9STUFUX1lVWVY6Ci0JY2FzZSBE
Uk1fRk9STUFUX1lWWVU6Ci0JY2FzZSBEUk1fRk9STUFUX1VZVlk6Ci0JY2FzZSBEUk1fRk9STUFU
X1ZZVVk6Ci0JY2FzZSBEUk1fRk9STUFUX05WMTI6Ci0JY2FzZSBEUk1fRk9STUFUX1hZVVY4ODg4
OgotCWNhc2UgRFJNX0ZPUk1BVF9QMDEwOgotCWNhc2UgRFJNX0ZPUk1BVF9QMDEyOgotCWNhc2Ug
RFJNX0ZPUk1BVF9QMDE2OgotCWNhc2UgRFJNX0ZPUk1BVF9YVllVMjEwMTAxMDoKLQkJaWYgKG1v
ZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRCkKLQkJCXJldHVybiB0cnVlOwotCQlm
YWxsdGhyb3VnaDsKLQljYXNlIERSTV9GT1JNQVRfQzg6Ci0JY2FzZSBEUk1fRk9STUFUX1hCR1Ix
NjE2MTYxNkY6Ci0JY2FzZSBEUk1fRk9STUFUX0FCR1IxNjE2MTYxNkY6Ci0JY2FzZSBEUk1fRk9S
TUFUX1hSR0IxNjE2MTYxNkY6Ci0JY2FzZSBEUk1fRk9STUFUX0FSR0IxNjE2MTYxNkY6Ci0JY2Fz
ZSBEUk1fRk9STUFUX1kyMTA6Ci0JY2FzZSBEUk1fRk9STUFUX1kyMTI6Ci0JY2FzZSBEUk1fRk9S
TUFUX1kyMTY6Ci0JY2FzZSBEUk1fRk9STUFUX1hWWVUxMl8xNjE2MTYxNjoKLQljYXNlIERSTV9G
T1JNQVRfWFZZVTE2MTYxNjE2OgotCQlpZiAobW9kaWZpZXIgPT0gRFJNX0ZPUk1BVF9NT0RfTElO
RUFSIHx8Ci0JCSAgICBtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRCB8fAotCQkg
ICAgbW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQpCi0JCQlyZXR1cm4gdHJ1ZTsK
LQkJZmFsbHRocm91Z2g7Ci0JZGVmYXVsdDoKLQkJcmV0dXJuIGZhbHNlOwotCX0KLX0KLQotc3Rh
dGljIGJvb2wgZ2VuMTJfcGxhbmVfc3VwcG9ydHNfbWNfY2NzKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKLQkJCQkJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCkKLXsKLQkvKiBXYV8x
NDAxMDQ3NzAwODp0Z2xbYTAuLmMwXSxya2xbYWxsXSxkZzFbYWxsXSAqLwotCWlmIChJU19ERzEo
ZGV2X3ByaXYpIHx8IElTX1JPQ0tFVExBS0UoZGV2X3ByaXYpIHx8Ci0JICAgIElTX1RHTF9ESVNQ
X1JFVklEKGRldl9wcml2LCBUR0xfUkVWSURfQTAsIFRHTF9SRVZJRF9DMCkpCi0JCXJldHVybiBm
YWxzZTsKLQotCXJldHVybiBwbGFuZV9pZCA8IFBMQU5FX1NQUklURTQ7Ci19Ci0KLXN0YXRpYyBi
b29sIGdlbjEyX3BsYW5lX2Zvcm1hdF9tb2Rfc3VwcG9ydGVkKHN0cnVjdCBkcm1fcGxhbmUgKl9w
bGFuZSwKLQkJCQkJICAgICB1MzIgZm9ybWF0LCB1NjQgbW9kaWZpZXIpCi17Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShfcGxhbmUtPmRldik7Ci0Jc3RydWN0
IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKF9wbGFuZSk7Ci0KLQlzd2l0Y2gg
KG1vZGlmaWVyKSB7Ci0JY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9NQ19DQ1M6
Ci0JCWlmICghZ2VuMTJfcGxhbmVfc3VwcG9ydHNfbWNfY2NzKGRldl9wcml2LCBwbGFuZS0+aWQp
KQotCQkJcmV0dXJuIGZhbHNlOwotCQlmYWxsdGhyb3VnaDsKLQljYXNlIERSTV9GT1JNQVRfTU9E
X0xJTkVBUjoKLQljYXNlIEk5MTVfRk9STUFUX01PRF9YX1RJTEVEOgotCWNhc2UgSTkxNV9GT1JN
QVRfTU9EX1lfVElMRUQ6Ci0JY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19D
Q1M6Ci0JCWJyZWFrOwotCWRlZmF1bHQ6Ci0JCXJldHVybiBmYWxzZTsKLQl9Ci0KLQlzd2l0Y2gg
KGZvcm1hdCkgewotCWNhc2UgRFJNX0ZPUk1BVF9YUkdCODg4ODoKLQljYXNlIERSTV9GT1JNQVRf
WEJHUjg4ODg6Ci0JY2FzZSBEUk1fRk9STUFUX0FSR0I4ODg4OgotCWNhc2UgRFJNX0ZPUk1BVF9B
QkdSODg4ODoKLQkJaWYgKGlzX2Njc19tb2RpZmllcihtb2RpZmllcikpCi0JCQlyZXR1cm4gdHJ1
ZTsKLQkJZmFsbHRocm91Z2g7Ci0JY2FzZSBEUk1fRk9STUFUX1lVWVY6Ci0JY2FzZSBEUk1fRk9S
TUFUX1lWWVU6Ci0JY2FzZSBEUk1fRk9STUFUX1VZVlk6Ci0JY2FzZSBEUk1fRk9STUFUX1ZZVVk6
Ci0JY2FzZSBEUk1fRk9STUFUX05WMTI6Ci0JY2FzZSBEUk1fRk9STUFUX1hZVVY4ODg4OgotCWNh
c2UgRFJNX0ZPUk1BVF9QMDEwOgotCWNhc2UgRFJNX0ZPUk1BVF9QMDEyOgotCWNhc2UgRFJNX0ZP
Uk1BVF9QMDE2OgotCQlpZiAobW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VO
MTJfTUNfQ0NTKQotCQkJcmV0dXJuIHRydWU7Ci0JCWZhbGx0aHJvdWdoOwotCWNhc2UgRFJNX0ZP
Uk1BVF9SR0I1NjU6Ci0JY2FzZSBEUk1fRk9STUFUX1hSR0IyMTAxMDEwOgotCWNhc2UgRFJNX0ZP
Uk1BVF9YQkdSMjEwMTAxMDoKLQljYXNlIERSTV9GT1JNQVRfQVJHQjIxMDEwMTA6Ci0JY2FzZSBE
Uk1fRk9STUFUX0FCR1IyMTAxMDEwOgotCWNhc2UgRFJNX0ZPUk1BVF9YVllVMjEwMTAxMDoKLQlj
YXNlIERSTV9GT1JNQVRfQzg6Ci0JY2FzZSBEUk1fRk9STUFUX1hCR1IxNjE2MTYxNkY6Ci0JY2Fz
ZSBEUk1fRk9STUFUX0FCR1IxNjE2MTYxNkY6Ci0JY2FzZSBEUk1fRk9STUFUX1hSR0IxNjE2MTYx
NkY6Ci0JY2FzZSBEUk1fRk9STUFUX0FSR0IxNjE2MTYxNkY6Ci0JY2FzZSBEUk1fRk9STUFUX1ky
MTA6Ci0JY2FzZSBEUk1fRk9STUFUX1kyMTI6Ci0JY2FzZSBEUk1fRk9STUFUX1kyMTY6Ci0JY2Fz
ZSBEUk1fRk9STUFUX1hWWVUxMl8xNjE2MTYxNjoKLQljYXNlIERSTV9GT1JNQVRfWFZZVTE2MTYx
NjE2OgotCQlpZiAobW9kaWZpZXIgPT0gRFJNX0ZPUk1BVF9NT0RfTElORUFSIHx8Ci0JCSAgICBt
b2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRCB8fAotCQkgICAgbW9kaWZpZXIgPT0g
STkxNV9GT1JNQVRfTU9EX1lfVElMRUQpCi0JCQlyZXR1cm4gdHJ1ZTsKLQkJZmFsbHRocm91Z2g7
Ci0JZGVmYXVsdDoKLQkJcmV0dXJuIGZhbHNlOwotCX0KLX0KIAogc3RhdGljIGNvbnN0IHN0cnVj
dCBkcm1fcGxhbmVfZnVuY3MgZzR4X3Nwcml0ZV9mdW5jcyA9IHsKIAkudXBkYXRlX3BsYW5lID0g
ZHJtX2F0b21pY19oZWxwZXJfdXBkYXRlX3BsYW5lLApAQCAtMzEzMSwyNTEgKzE5ODUsNiBAQCBz
dGF0aWMgY29uc3Qgc3RydWN0IGRybV9wbGFuZV9mdW5jcyB2bHZfc3ByaXRlX2Z1bmNzID0gewog
CS5mb3JtYXRfbW9kX3N1cHBvcnRlZCA9IHZsdl9zcHJpdGVfZm9ybWF0X21vZF9zdXBwb3J0ZWQs
CiB9OwogCi1zdGF0aWMgY29uc3Qgc3RydWN0IGRybV9wbGFuZV9mdW5jcyBza2xfcGxhbmVfZnVu
Y3MgPSB7Ci0JLnVwZGF0ZV9wbGFuZSA9IGRybV9hdG9taWNfaGVscGVyX3VwZGF0ZV9wbGFuZSwK
LQkuZGlzYWJsZV9wbGFuZSA9IGRybV9hdG9taWNfaGVscGVyX2Rpc2FibGVfcGxhbmUsCi0JLmRl
c3Ryb3kgPSBpbnRlbF9wbGFuZV9kZXN0cm95LAotCS5hdG9taWNfZHVwbGljYXRlX3N0YXRlID0g
aW50ZWxfcGxhbmVfZHVwbGljYXRlX3N0YXRlLAotCS5hdG9taWNfZGVzdHJveV9zdGF0ZSA9IGlu
dGVsX3BsYW5lX2Rlc3Ryb3lfc3RhdGUsCi0JLmZvcm1hdF9tb2Rfc3VwcG9ydGVkID0gc2tsX3Bs
YW5lX2Zvcm1hdF9tb2Rfc3VwcG9ydGVkLAotfTsKLQotc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1f
cGxhbmVfZnVuY3MgZ2VuMTJfcGxhbmVfZnVuY3MgPSB7Ci0JLnVwZGF0ZV9wbGFuZSA9IGRybV9h
dG9taWNfaGVscGVyX3VwZGF0ZV9wbGFuZSwKLQkuZGlzYWJsZV9wbGFuZSA9IGRybV9hdG9taWNf
aGVscGVyX2Rpc2FibGVfcGxhbmUsCi0JLmRlc3Ryb3kgPSBpbnRlbF9wbGFuZV9kZXN0cm95LAot
CS5hdG9taWNfZHVwbGljYXRlX3N0YXRlID0gaW50ZWxfcGxhbmVfZHVwbGljYXRlX3N0YXRlLAot
CS5hdG9taWNfZGVzdHJveV9zdGF0ZSA9IGludGVsX3BsYW5lX2Rlc3Ryb3lfc3RhdGUsCi0JLmZv
cm1hdF9tb2Rfc3VwcG9ydGVkID0gZ2VuMTJfcGxhbmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQsCi19
OwotCi1zdGF0aWMgYm9vbCBza2xfcGxhbmVfaGFzX2ZiYyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCi0JCQkgICAgICBlbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFuZV9pZCBwbGFu
ZV9pZCkKLXsKLQlpZiAoIUhBU19GQkMoZGV2X3ByaXYpKQotCQlyZXR1cm4gZmFsc2U7Ci0KLQly
ZXR1cm4gcGlwZSA9PSBQSVBFX0EgJiYgcGxhbmVfaWQgPT0gUExBTkVfUFJJTUFSWTsKLX0KLQot
c3RhdGljIGJvb2wgc2tsX3BsYW5lX2hhc19wbGFuYXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAotCQkJCSBlbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFuZV9pZCBwbGFuZV9pZCkK
LXsKLQkvKiBEaXNwbGF5IFdBICMwODcwOiBza2wsIGJ4dCAqLwotCWlmIChJU19TS1lMQUtFKGRl
dl9wcml2KSB8fCBJU19CUk9YVE9OKGRldl9wcml2KSkKLQkJcmV0dXJuIGZhbHNlOwotCi0JaWYg
KElTX0dFTihkZXZfcHJpdiwgOSkgJiYgIUlTX0dFTUlOSUxBS0UoZGV2X3ByaXYpICYmIHBpcGUg
PT0gUElQRV9DKQotCQlyZXR1cm4gZmFsc2U7Ci0KLQlpZiAocGxhbmVfaWQgIT0gUExBTkVfUFJJ
TUFSWSAmJiBwbGFuZV9pZCAhPSBQTEFORV9TUFJJVEUwKQotCQlyZXR1cm4gZmFsc2U7Ci0KLQly
ZXR1cm4gdHJ1ZTsKLX0KLQotc3RhdGljIGNvbnN0IHUzMiAqc2tsX2dldF9wbGFuZV9mb3JtYXRz
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCQkJZW51bSBwaXBlIHBpcGUs
IGVudW0gcGxhbmVfaWQgcGxhbmVfaWQsCi0JCQkJCWludCAqbnVtX2Zvcm1hdHMpCi17Ci0JaWYg
KHNrbF9wbGFuZV9oYXNfcGxhbmFyKGRldl9wcml2LCBwaXBlLCBwbGFuZV9pZCkpIHsKLQkJKm51
bV9mb3JtYXRzID0gQVJSQVlfU0laRShza2xfcGxhbmFyX2Zvcm1hdHMpOwotCQlyZXR1cm4gc2ts
X3BsYW5hcl9mb3JtYXRzOwotCX0gZWxzZSB7Ci0JCSpudW1fZm9ybWF0cyA9IEFSUkFZX1NJWkUo
c2tsX3BsYW5lX2Zvcm1hdHMpOwotCQlyZXR1cm4gc2tsX3BsYW5lX2Zvcm1hdHM7Ci0JfQotfQot
Ci1zdGF0aWMgY29uc3QgdTMyICpnbGtfZ2V0X3BsYW5lX2Zvcm1hdHMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAotCQkJCQllbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFuZV9pZCBw
bGFuZV9pZCwKLQkJCQkJaW50ICpudW1fZm9ybWF0cykKLXsKLQlpZiAoc2tsX3BsYW5lX2hhc19w
bGFuYXIoZGV2X3ByaXYsIHBpcGUsIHBsYW5lX2lkKSkgewotCQkqbnVtX2Zvcm1hdHMgPSBBUlJB
WV9TSVpFKGdsa19wbGFuYXJfZm9ybWF0cyk7Ci0JCXJldHVybiBnbGtfcGxhbmFyX2Zvcm1hdHM7
Ci0JfSBlbHNlIHsKLQkJKm51bV9mb3JtYXRzID0gQVJSQVlfU0laRShza2xfcGxhbmVfZm9ybWF0
cyk7Ci0JCXJldHVybiBza2xfcGxhbmVfZm9ybWF0czsKLQl9Ci19Ci0KLXN0YXRpYyBjb25zdCB1
MzIgKmljbF9nZXRfcGxhbmVfZm9ybWF0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCi0JCQkJCWVudW0gcGlwZSBwaXBlLCBlbnVtIHBsYW5lX2lkIHBsYW5lX2lkLAotCQkJCQlp
bnQgKm51bV9mb3JtYXRzKQotewotCWlmIChpY2xfaXNfaGRyX3BsYW5lKGRldl9wcml2LCBwbGFu
ZV9pZCkpIHsKLQkJKm51bV9mb3JtYXRzID0gQVJSQVlfU0laRShpY2xfaGRyX3BsYW5lX2Zvcm1h
dHMpOwotCQlyZXR1cm4gaWNsX2hkcl9wbGFuZV9mb3JtYXRzOwotCX0gZWxzZSBpZiAoaWNsX2lz
X252MTJfeV9wbGFuZShkZXZfcHJpdiwgcGxhbmVfaWQpKSB7Ci0JCSpudW1fZm9ybWF0cyA9IEFS
UkFZX1NJWkUoaWNsX3Nkcl95X3BsYW5lX2Zvcm1hdHMpOwotCQlyZXR1cm4gaWNsX3Nkcl95X3Bs
YW5lX2Zvcm1hdHM7Ci0JfSBlbHNlIHsKLQkJKm51bV9mb3JtYXRzID0gQVJSQVlfU0laRShpY2xf
c2RyX3V2X3BsYW5lX2Zvcm1hdHMpOwotCQlyZXR1cm4gaWNsX3Nkcl91dl9wbGFuZV9mb3JtYXRz
OwotCX0KLX0KLQotc3RhdGljIGNvbnN0IHU2NCAqZ2VuMTJfZ2V0X3BsYW5lX21vZGlmaWVycyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCi0JCQkJCSAgICBlbnVtIHBsYW5lX2lk
IHBsYW5lX2lkKQotewotCWlmIChnZW4xMl9wbGFuZV9zdXBwb3J0c19tY19jY3MoZGV2X3ByaXYs
IHBsYW5lX2lkKSkKLQkJcmV0dXJuIGdlbjEyX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfbWNfY2Nz
OwotCWVsc2UKLQkJcmV0dXJuIGdlbjEyX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfcmNfY2NzOwot
fQotCi1zdGF0aWMgYm9vbCBza2xfcGxhbmVfaGFzX2NjcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCi0JCQkgICAgICBlbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFuZV9pZCBwbGFu
ZV9pZCkKLXsKLQlpZiAocGxhbmVfaWQgPT0gUExBTkVfQ1VSU09SKQotCQlyZXR1cm4gZmFsc2U7
Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCkKLQkJcmV0dXJuIHRydWU7Ci0KLQlp
ZiAoSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCi0JCXJldHVybiBwaXBlICE9IFBJUEVfQzsKLQot
CXJldHVybiBwaXBlICE9IFBJUEVfQyAmJgotCQkocGxhbmVfaWQgPT0gUExBTkVfUFJJTUFSWSB8
fAotCQkgcGxhbmVfaWQgPT0gUExBTkVfU1BSSVRFMCk7Ci19Ci0KLXN0cnVjdCBpbnRlbF9wbGFu
ZSAqCi1za2xfdW5pdmVyc2FsX3BsYW5lX2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCi0JCQkgICBlbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFuZV9pZCBwbGFuZV9pZCkK
LXsKLQljb25zdCBzdHJ1Y3QgZHJtX3BsYW5lX2Z1bmNzICpwbGFuZV9mdW5jczsKLQlzdHJ1Y3Qg
aW50ZWxfcGxhbmUgKnBsYW5lOwotCWVudW0gZHJtX3BsYW5lX3R5cGUgcGxhbmVfdHlwZTsKLQl1
bnNpZ25lZCBpbnQgc3VwcG9ydGVkX3JvdGF0aW9uczsKLQl1bnNpZ25lZCBpbnQgc3VwcG9ydGVk
X2NzYzsKLQljb25zdCB1NjQgKm1vZGlmaWVyczsKLQljb25zdCB1MzIgKmZvcm1hdHM7Ci0JaW50
IG51bV9mb3JtYXRzOwotCWludCByZXQ7Ci0KLQlwbGFuZSA9IGludGVsX3BsYW5lX2FsbG9jKCk7
Ci0JaWYgKElTX0VSUihwbGFuZSkpCi0JCXJldHVybiBwbGFuZTsKLQotCXBsYW5lLT5waXBlID0g
cGlwZTsKLQlwbGFuZS0+aWQgPSBwbGFuZV9pZDsKLQlwbGFuZS0+ZnJvbnRidWZmZXJfYml0ID0g
SU5URUxfRlJPTlRCVUZGRVIocGlwZSwgcGxhbmVfaWQpOwotCi0JcGxhbmUtPmhhc19mYmMgPSBz
a2xfcGxhbmVfaGFzX2ZiYyhkZXZfcHJpdiwgcGlwZSwgcGxhbmVfaWQpOwotCWlmIChwbGFuZS0+
aGFzX2ZiYykgewotCQlzdHJ1Y3QgaW50ZWxfZmJjICpmYmMgPSAmZGV2X3ByaXYtPmZiYzsKLQot
CQlmYmMtPnBvc3NpYmxlX2ZyYW1lYnVmZmVyX2JpdHMgfD0gcGxhbmUtPmZyb250YnVmZmVyX2Jp
dDsKLQl9Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkgewotCQlwbGFuZS0+bWlu
X3dpZHRoID0gaWNsX3BsYW5lX21pbl93aWR0aDsKLQkJcGxhbmUtPm1heF93aWR0aCA9IGljbF9w
bGFuZV9tYXhfd2lkdGg7Ci0JCXBsYW5lLT5tYXhfaGVpZ2h0ID0gaWNsX3BsYW5lX21heF9oZWln
aHQ7Ci0JfSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8IElTX0dFTUlOSUxB
S0UoZGV2X3ByaXYpKSB7Ci0JCXBsYW5lLT5tYXhfd2lkdGggPSBnbGtfcGxhbmVfbWF4X3dpZHRo
OwotCQlwbGFuZS0+bWF4X2hlaWdodCA9IHNrbF9wbGFuZV9tYXhfaGVpZ2h0OwotCX0gZWxzZSB7
Ci0JCXBsYW5lLT5tYXhfd2lkdGggPSBza2xfcGxhbmVfbWF4X3dpZHRoOwotCQlwbGFuZS0+bWF4
X2hlaWdodCA9IHNrbF9wbGFuZV9tYXhfaGVpZ2h0OwotCX0KLQotCXBsYW5lLT5tYXhfc3RyaWRl
ID0gc2tsX3BsYW5lX21heF9zdHJpZGU7Ci0JcGxhbmUtPnVwZGF0ZV9wbGFuZSA9IHNrbF91cGRh
dGVfcGxhbmU7Ci0JcGxhbmUtPmRpc2FibGVfcGxhbmUgPSBza2xfZGlzYWJsZV9wbGFuZTsKLQlw
bGFuZS0+Z2V0X2h3X3N0YXRlID0gc2tsX3BsYW5lX2dldF9od19zdGF0ZTsKLQlwbGFuZS0+Y2hl
Y2tfcGxhbmUgPSBza2xfcGxhbmVfY2hlY2s7Ci0JcGxhbmUtPm1pbl9jZGNsayA9IHNrbF9wbGFu
ZV9taW5fY2RjbGs7Ci0JcGxhbmUtPmFzeW5jX2ZsaXAgPSBza2xfcGxhbmVfYXN5bmNfZmxpcDsK
LQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQotCQlmb3JtYXRzID0gaWNsX2dldF9w
bGFuZV9mb3JtYXRzKGRldl9wcml2LCBwaXBlLAotCQkJCQkJcGxhbmVfaWQsICZudW1fZm9ybWF0
cyk7Ci0JZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtF
KGRldl9wcml2KSkKLQkJZm9ybWF0cyA9IGdsa19nZXRfcGxhbmVfZm9ybWF0cyhkZXZfcHJpdiwg
cGlwZSwKLQkJCQkJCXBsYW5lX2lkLCAmbnVtX2Zvcm1hdHMpOwotCWVsc2UKLQkJZm9ybWF0cyA9
IHNrbF9nZXRfcGxhbmVfZm9ybWF0cyhkZXZfcHJpdiwgcGlwZSwKLQkJCQkJCXBsYW5lX2lkLCAm
bnVtX2Zvcm1hdHMpOwotCi0JcGxhbmUtPmhhc19jY3MgPSBza2xfcGxhbmVfaGFzX2NjcyhkZXZf
cHJpdiwgcGlwZSwgcGxhbmVfaWQpOwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKSB7
Ci0JCW1vZGlmaWVycyA9IGdlbjEyX2dldF9wbGFuZV9tb2RpZmllcnMoZGV2X3ByaXYsIHBsYW5l
X2lkKTsKLQkJcGxhbmVfZnVuY3MgPSAmZ2VuMTJfcGxhbmVfZnVuY3M7Ci0JfSBlbHNlIHsKLQkJ
aWYgKHBsYW5lLT5oYXNfY2NzKQotCQkJbW9kaWZpZXJzID0gc2tsX3BsYW5lX2Zvcm1hdF9tb2Rp
ZmllcnNfY2NzOwotCQllbHNlCi0JCQltb2RpZmllcnMgPSBza2xfcGxhbmVfZm9ybWF0X21vZGlm
aWVyc19ub2NjczsKLQkJcGxhbmVfZnVuY3MgPSAmc2tsX3BsYW5lX2Z1bmNzOwotCX0KLQotCWlm
IChwbGFuZV9pZCA9PSBQTEFORV9QUklNQVJZKQotCQlwbGFuZV90eXBlID0gRFJNX1BMQU5FX1RZ
UEVfUFJJTUFSWTsKLQllbHNlCi0JCXBsYW5lX3R5cGUgPSBEUk1fUExBTkVfVFlQRV9PVkVSTEFZ
OwotCi0JcmV0ID0gZHJtX3VuaXZlcnNhbF9wbGFuZV9pbml0KCZkZXZfcHJpdi0+ZHJtLCAmcGxh
bmUtPmJhc2UsCi0JCQkJICAgICAgIDAsIHBsYW5lX2Z1bmNzLAotCQkJCSAgICAgICBmb3JtYXRz
LCBudW1fZm9ybWF0cywgbW9kaWZpZXJzLAotCQkJCSAgICAgICBwbGFuZV90eXBlLAotCQkJCSAg
ICAgICAicGxhbmUgJWQlYyIsIHBsYW5lX2lkICsgMSwKLQkJCQkgICAgICAgcGlwZV9uYW1lKHBp
cGUpKTsKLQlpZiAocmV0KQotCQlnb3RvIGZhaWw7Ci0KLQlzdXBwb3J0ZWRfcm90YXRpb25zID0K
LQkJRFJNX01PREVfUk9UQVRFXzAgfCBEUk1fTU9ERV9ST1RBVEVfOTAgfAotCQlEUk1fTU9ERV9S
T1RBVEVfMTgwIHwgRFJNX01PREVfUk9UQVRFXzI3MDsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3By
aXYpID49IDEwKQotCQlzdXBwb3J0ZWRfcm90YXRpb25zIHw9IERSTV9NT0RFX1JFRkxFQ1RfWDsK
LQotCWRybV9wbGFuZV9jcmVhdGVfcm90YXRpb25fcHJvcGVydHkoJnBsYW5lLT5iYXNlLAotCQkJ
CQkgICBEUk1fTU9ERV9ST1RBVEVfMCwKLQkJCQkJICAgc3VwcG9ydGVkX3JvdGF0aW9ucyk7Ci0K
LQlzdXBwb3J0ZWRfY3NjID0gQklUKERSTV9DT0xPUl9ZQ0JDUl9CVDYwMSkgfCBCSVQoRFJNX0NP
TE9SX1lDQkNSX0JUNzA5KTsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8IElT
X0dFTUlOSUxBS0UoZGV2X3ByaXYpKQotCQlzdXBwb3J0ZWRfY3NjIHw9IEJJVChEUk1fQ09MT1Jf
WUNCQ1JfQlQyMDIwKTsKLQotCWRybV9wbGFuZV9jcmVhdGVfY29sb3JfcHJvcGVydGllcygmcGxh
bmUtPmJhc2UsCi0JCQkJCSAgc3VwcG9ydGVkX2NzYywKLQkJCQkJICBCSVQoRFJNX0NPTE9SX1lD
QkNSX0xJTUlURURfUkFOR0UpIHwKLQkJCQkJICBCSVQoRFJNX0NPTE9SX1lDQkNSX0ZVTExfUkFO
R0UpLAotCQkJCQkgIERSTV9DT0xPUl9ZQ0JDUl9CVDcwOSwKLQkJCQkJICBEUk1fQ09MT1JfWUNC
Q1JfTElNSVRFRF9SQU5HRSk7Ci0KLQlkcm1fcGxhbmVfY3JlYXRlX2FscGhhX3Byb3BlcnR5KCZw
bGFuZS0+YmFzZSk7Ci0JZHJtX3BsYW5lX2NyZWF0ZV9ibGVuZF9tb2RlX3Byb3BlcnR5KCZwbGFu
ZS0+YmFzZSwKLQkJCQkJICAgICBCSVQoRFJNX01PREVfQkxFTkRfUElYRUxfTk9ORSkgfAotCQkJ
CQkgICAgIEJJVChEUk1fTU9ERV9CTEVORF9QUkVNVUxUSSkgfAotCQkJCQkgICAgIEJJVChEUk1f
TU9ERV9CTEVORF9DT1ZFUkFHRSkpOwotCi0JZHJtX3BsYW5lX2NyZWF0ZV96cG9zX2ltbXV0YWJs
ZV9wcm9wZXJ0eSgmcGxhbmUtPmJhc2UsIHBsYW5lX2lkKTsKLQotCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDEyKQotCQlkcm1fcGxhbmVfZW5hYmxlX2ZiX2RhbWFnZV9jbGlwcygmcGxhbmUt
PmJhc2UpOwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTApCi0JCWRybV9wbGFuZV9j
cmVhdGVfc2NhbGluZ19maWx0ZXJfcHJvcGVydHkoJnBsYW5lLT5iYXNlLAotCQkJCQkJQklUKERS
TV9TQ0FMSU5HX0ZJTFRFUl9ERUZBVUxUKSB8Ci0JCQkJCQlCSVQoRFJNX1NDQUxJTkdfRklMVEVS
X05FQVJFU1RfTkVJR0hCT1IpKTsKLQotCWRybV9wbGFuZV9oZWxwZXJfYWRkKCZwbGFuZS0+YmFz
ZSwgJmludGVsX3BsYW5lX2hlbHBlcl9mdW5jcyk7Ci0KLQlyZXR1cm4gcGxhbmU7Ci0KLWZhaWw6
Ci0JaW50ZWxfcGxhbmVfZnJlZShwbGFuZSk7Ci0KLQlyZXR1cm4gRVJSX1BUUihyZXQpOwotfQot
CiBzdHJ1Y3QgaW50ZWxfcGxhbmUgKgogaW50ZWxfc3ByaXRlX3BsYW5lX2NyZWF0ZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkgIGVudW0gcGlwZSBwaXBlLCBpbnQgc3By
aXRlKQpAQCAtMzM4OCwxMCArMTk5Nyw2IEBAIGludGVsX3Nwcml0ZV9wbGFuZV9jcmVhdGUoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCWludCBudW1fZm9ybWF0czsKIAlpbnQg
cmV0LCB6cG9zOwogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkKLQkJcmV0dXJuIHNr
bF91bml2ZXJzYWxfcGxhbmVfY3JlYXRlKGRldl9wcml2LCBwaXBlLAotCQkJCQkJICBQTEFORV9T
UFJJVEUwICsgc3ByaXRlKTsKLQogCXBsYW5lID0gaW50ZWxfcGxhbmVfYWxsb2MoKTsKIAlpZiAo
SVNfRVJSKHBsYW5lKSkKIAkJcmV0dXJuIHBsYW5lOwotLSAKMi4yMC4xCgpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0
CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZngK

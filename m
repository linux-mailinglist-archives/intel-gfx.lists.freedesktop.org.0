Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E3E0945559
	for <lists+intel-gfx@lfdr.de>; Fri, 14 Jun 2019 09:10:58 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DBE8C89356;
	Fri, 14 Jun 2019 07:10:47 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AE0AB88A27
 for <intel-gfx@lists.freedesktop.org>; Fri, 14 Jun 2019 07:10:33 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16897531-1500050 
 for multiple; Fri, 14 Jun 2019 08:10:30 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 14 Jun 2019 08:10:10 +0100
Message-Id: <20190614071023.17929-27-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190614071023.17929-1-chris@chris-wilson.co.uk>
References: <20190614071023.17929-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 26/39] drm/i915: Only track bound elements of
 the GTT
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIHByZW1pc2UgaGVyZSBpcyB0byBzaW1wbHkgYXZvaWRpbmcgaGF2aW5nIHRvIGFjcXVpcmUg
dGhlIHZtLT5tdXRleAppbnNpZGUgdm1hIGNyZWF0ZS9kZXN0cm95IHRvIHVwZGF0ZSB0aGUgdm0t
PnVuYm91bmRfbGlzdHMsIHRvIGF2b2lkIHNvbWUKbmFzdHkgbG9jayByZWN1cnNpb25zIGxhdGVy
LgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+
Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3N0b2xlbi5jICAgIHwgIDIg
Ky0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jICAgICAgICAgICB8IDIzICsr
KystLS0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oICAg
ICAgICAgICB8ICA1IC0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMgICAgICAg
ICAgICAgICB8IDEyICsrLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
OTE1X2dlbV9ndHQuYyB8ICAyICstCiA1IGZpbGVzIGNoYW5nZWQsIDggaW5zZXJ0aW9ucygrKSwg
MzYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX3N0b2xlbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3N0b2xl
bi5jCmluZGV4IGRlMWZhYjIwNThlYy4uZThiYzliNDZkNGU4IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc3RvbGVuLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX3N0b2xlbi5jCkBAIC02ODYsNyArNjg2LDcgQEAgaTkxNV9nZW1f
b2JqZWN0X2NyZWF0ZV9zdG9sZW5fZm9yX3ByZWFsbG9jYXRlZChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYKIAlfX2k5MTVfdm1hX3NldF9tYXBfYW5kX2ZlbmNlYWJsZSh2bWEpOwog
CiAJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwotCWxpc3RfbW92ZV90YWlsKCZ2bWEtPnZt
X2xpbmssICZnZ3R0LT52bS5ib3VuZF9saXN0KTsKKwlsaXN0X2FkZF90YWlsKCZ2bWEtPnZtX2xp
bmssICZnZ3R0LT52bS5ib3VuZF9saXN0KTsKIAltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4
KTsKIAogCUdFTV9CVUdfT04oaTkxNV9nZW1fb2JqZWN0X2lzX3Nocmlua2FibGUob2JqKSk7CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCmluZGV4IDdjNTk3MGY1MTUyMy4uNDU3MTI2OTcz
Y2RkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwpAQCAtNTAwLDcgKzUwMCw2IEBA
IHN0YXRpYyB2b2lkIGk5MTVfYWRkcmVzc19zcGFjZV9pbml0KHN0cnVjdCBpOTE1X2FkZHJlc3Nf
c3BhY2UgKnZtLCBpbnQgc3ViY2xhc3MpCiAKIAlzdGFzaF9pbml0KCZ2bS0+ZnJlZV9wYWdlcyk7
CiAKLQlJTklUX0xJU1RfSEVBRCgmdm0tPnVuYm91bmRfbGlzdCk7CiAJSU5JVF9MSVNUX0hFQUQo
JnZtLT5ib3VuZF9saXN0KTsKIH0KIApAQCAtMjA3NSwxMCArMjA3NCw2IEBAIHN0YXRpYyBzdHJ1
Y3QgaTkxNV92bWEgKnBkX3ZtYV9jcmVhdGUoc3RydWN0IGdlbjZfcHBndHQgKnBwZ3R0LCBpbnQg
c2l6ZSkKIAlJTklUX0xJU1RfSEVBRCgmdm1hLT5vYmpfbGluayk7CiAJSU5JVF9MSVNUX0hFQUQo
JnZtYS0+Y2xvc2VkX2xpbmspOwogCi0JbXV0ZXhfbG9jaygmdm1hLT52bS0+bXV0ZXgpOwotCWxp
c3RfYWRkKCZ2bWEtPnZtX2xpbmssICZ2bWEtPnZtLT51bmJvdW5kX2xpc3QpOwotCW11dGV4X3Vu
bG9jaygmdm1hLT52bS0+bXV0ZXgpOwotCiAJcmV0dXJuIHZtYTsKIH0KIApAQCAtMjI1NSwxOSAr
MjI1MCwxMiBAQCBpOTE1X3BwZ3R0X2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKIAogc3RhdGljIHZvaWQgcHBndHRfZGVzdHJveV92bWEoc3RydWN0IGk5MTVfYWRkcmVzc19z
cGFjZSAqdm0pCiB7Ci0Jc3RydWN0IGxpc3RfaGVhZCAqcGhhc2VzW10gPSB7Ci0JCSZ2bS0+Ym91
bmRfbGlzdCwKLQkJJnZtLT51bmJvdW5kX2xpc3QsCi0JCU5VTEwsCi0JfSwgKipwaGFzZTsKKwlz
dHJ1Y3QgaTkxNV92bWEgKnZtYSwgKnZuOwogCiAJdm0tPmNsb3NlZCA9IHRydWU7Ci0JZm9yIChw
aGFzZSA9IHBoYXNlczsgKnBoYXNlOyBwaGFzZSsrKSB7Ci0JCXN0cnVjdCBpOTE1X3ZtYSAqdm1h
LCAqdm47Ci0KLQkJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHZtYSwgdm4sICpwaGFzZSwgdm1f
bGluaykKLQkJCWk5MTVfdm1hX2Rlc3Ryb3kodm1hKTsKLQl9CisJbGlzdF9mb3JfZWFjaF9lbnRy
eV9zYWZlKHZtYSwgdm4sICZ2bS0+Ym91bmRfbGlzdCwgdm1fbGluaykKKwkJaTkxNV92bWFfZGVz
dHJveSh2bWEpOworCUdFTV9CVUdfT04oIWxpc3RfZW1wdHkoJnZtLT5ib3VuZF9saXN0KSk7CiB9
CiAKIHZvaWQgaTkxNV92bV9yZWxlYXNlKHN0cnVjdCBrcmVmICprcmVmKQpAQCAtMjI4MCw5ICsy
MjY4LDYgQEAgdm9pZCBpOTE1X3ZtX3JlbGVhc2Uoc3RydWN0IGtyZWYgKmtyZWYpCiAKIAlwcGd0
dF9kZXN0cm95X3ZtYSh2bSk7CiAKLQlHRU1fQlVHX09OKCFsaXN0X2VtcHR5KCZ2bS0+Ym91bmRf
bGlzdCkpOwotCUdFTV9CVUdfT04oIWxpc3RfZW1wdHkoJnZtLT51bmJvdW5kX2xpc3QpKTsKLQog
CXZtLT5jbGVhbnVwKHZtKTsKIAlpOTE1X2FkZHJlc3Nfc3BhY2VfZmluaSh2bSk7CiAKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmgKaW5kZXggNjNmYTM1N2M2OWRlLi44ODljNGU4OGM1OTgg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oCkBAIC0zMjgsMTEgKzMyOCw2IEBAIHN0
cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgewogCSAqLwogCXN0cnVjdCBsaXN0X2hlYWQgYm91bmRf
bGlzdDsKIAotCS8qKgotCSAqIExpc3Qgb2Ygdm1hIHRoYXQgYXJlIG5vdCB1bmJvdW5kLgotCSAq
LwotCXN0cnVjdCBsaXN0X2hlYWQgdW5ib3VuZF9saXN0OwotCiAJc3RydWN0IHBhZ2VzdGFzaCBm
cmVlX3BhZ2VzOwogCiAJLyogR2xvYmFsIEdUVCAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV92bWEuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKaW5k
ZXggMzExZWI5ODM3Njk5Li4xNGM2ZDEwNDMzMmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfdm1hLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwpA
QCAtMjA4LDEwICsyMDgsNiBAQCB2bWFfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmosCiAKIAlzcGluX3VubG9jaygmb2JqLT52bWEubG9jayk7CiAKLQltdXRleF9sb2NrKCZ2
bS0+bXV0ZXgpOwotCWxpc3RfYWRkKCZ2bWEtPnZtX2xpbmssICZ2bS0+dW5ib3VuZF9saXN0KTsK
LQltdXRleF91bmxvY2soJnZtLT5tdXRleCk7Ci0KIAlyZXR1cm4gdm1hOwogCiBlcnJfdm1hOgpA
QCAtNjQ5LDcgKzY0NSw3IEBAIGk5MTVfdm1hX2luc2VydChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwg
dTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncykKIAlHRU1fQlVHX09OKCFpOTE1X2dl
bV92YWxpZF9ndHRfc3BhY2Uodm1hLCBjYWNoZV9sZXZlbCkpOwogCiAJbXV0ZXhfbG9jaygmdm1h
LT52bS0+bXV0ZXgpOwotCWxpc3RfbW92ZV90YWlsKCZ2bWEtPnZtX2xpbmssICZ2bWEtPnZtLT5i
b3VuZF9saXN0KTsKKwlsaXN0X2FkZF90YWlsKCZ2bWEtPnZtX2xpbmssICZ2bWEtPnZtLT5ib3Vu
ZF9saXN0KTsKIAltdXRleF91bmxvY2soJnZtYS0+dm0tPm11dGV4KTsKIAogCWlmICh2bWEtPm9i
aikgewpAQCAtNjc3LDcgKzY3Myw3IEBAIGk5MTVfdm1hX3JlbW92ZShzdHJ1Y3QgaTkxNV92bWEg
KnZtYSkKIAogCW11dGV4X2xvY2soJnZtYS0+dm0tPm11dGV4KTsKIAlkcm1fbW1fcmVtb3ZlX25v
ZGUoJnZtYS0+bm9kZSk7Ci0JbGlzdF9tb3ZlX3RhaWwoJnZtYS0+dm1fbGluaywgJnZtYS0+dm0t
PnVuYm91bmRfbGlzdCk7CisJbGlzdF9kZWwoJnZtYS0+dm1fbGluayk7CiAJbXV0ZXhfdW5sb2Nr
KCZ2bWEtPnZtLT5tdXRleCk7CiAKIAkvKgpAQCAtNzkwLDEwICs3ODYsNiBAQCBzdGF0aWMgdm9p
ZCBfX2k5MTVfdm1hX2Rlc3Ryb3koc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJR0VNX0JVR19PTih2
bWEtPm5vZGUuYWxsb2NhdGVkKTsKIAlHRU1fQlVHX09OKHZtYS0+ZmVuY2UpOwogCi0JbXV0ZXhf
bG9jaygmdm1hLT52bS0+bXV0ZXgpOwotCWxpc3RfZGVsKCZ2bWEtPnZtX2xpbmspOwotCW11dGV4
X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOwotCiAJaWYgKHZtYS0+b2JqKSB7CiAJCXN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB2bWEtPm9iajsKIApkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2d0dC5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2d0dC5jCmluZGV4IDIwOTNkMDhhNzU2OS4uNzBjOGJj
NjI2MzAwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9n
ZW1fZ3R0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2d0
dC5jCkBAIC0xMjM5LDcgKzEyMzksNyBAQCBzdGF0aWMgdm9pZCB0cmFja192bWFfYmluZChzdHJ1
Y3QgaTkxNV92bWEgKnZtYSkKIAl2bWEtPnBhZ2VzID0gb2JqLT5tbS5wYWdlczsKIAogCW11dGV4
X2xvY2soJnZtYS0+dm0tPm11dGV4KTsKLQlsaXN0X21vdmVfdGFpbCgmdm1hLT52bV9saW5rLCAm
dm1hLT52bS0+Ym91bmRfbGlzdCk7CisJbGlzdF9hZGRfdGFpbCgmdm1hLT52bV9saW5rLCAmdm1h
LT52bS0+Ym91bmRfbGlzdCk7CiAJbXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CiB9CiAK
LS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
Cmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

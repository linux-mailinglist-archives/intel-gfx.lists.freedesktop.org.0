Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7FE9416AA3B
	for <lists+intel-gfx@lfdr.de>; Mon, 24 Feb 2020 16:36:04 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C4BB06E560;
	Mon, 24 Feb 2020 15:36:00 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga12.intel.com (mga12.intel.com [192.55.52.136])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 622F889895
 for <intel-gfx@lists.freedesktop.org>; Mon, 24 Feb 2020 15:35:55 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga001.jf.intel.com ([10.7.209.18])
 by fmsmga106.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 24 Feb 2020 07:35:54 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.70,480,1574150400"; d="scan'208";a="316779373"
Received: from slisovsk-lenovo-ideapad-720s-13ikb.fi.intel.com ([10.237.72.89])
 by orsmga001.jf.intel.com with ESMTP; 24 Feb 2020 07:35:52 -0800
From: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 24 Feb 2020 17:32:37 +0200
Message-Id: <20200224153240.9047-6-stanislav.lisovskiy@intel.com>
X-Mailer: git-send-email 2.24.1.485.gad05a3d8e5
In-Reply-To: <20200224153240.9047-1-stanislav.lisovskiy@intel.com>
References: <20200224153240.9047-1-stanislav.lisovskiy@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v18 5/8] drm/i915: Refactor intel_can_enable_sagv
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q3VycmVudGx5IGludGVsX2Nhbl9lbmFibGVfc2FndiBmdW5jdGlvbiBjb250YWlucwphIG1peCBv
ZiB3b3JrYXJvdW5kcyBmb3IgZGlmZmVyZW50IHBsYXRmb3Jtcwpzb21lIG9mIHRoZW0gYXJlIG5v
dCB2YWxpZCBmb3IgZ2VucyA+PSAxMSBhbHJlYWR5LApzbyBsZXRzIHNwbGl0IGl0IGludG8gc2Vw
YXJhdGUgZnVuY3Rpb25zLgoKdjI6CiAgICAtIFJld29yayB3YXRlcm1hcmsgY2FsY3VsYXRpb24g
YWxnb3JpdGhtIHRvCiAgICAgIGF0dGVtcHQgdG8gY2FsY3VsYXRlIExldmVsIDAgd2F0ZXJtYXJr
CiAgICAgIHdpdGggYWRkZWQgc2FndiBibG9jayB0aW1lIGxhdGVuY3kgYW5kCiAgICAgIGNoZWNr
IGlmIGl0IGZpdHMgaW4gREJ1ZiBpbiBvcmRlciB0bwogICAgICBkZXRlcm1pbmUgaWYgU0FHViBj
YW4gYmUgZW5hYmxlZCBhbHJlYWR5CiAgICAgIGF0IHRoaXMgc3RhZ2UsIGp1c3QgYXMgQlNwZWMg
NDkzMjUgc3RhdGVzLgogICAgICBpZiB0aGF0IGZhaWxzIHJvbGxiYWNrIHRvIHVzdWFsIExldmVs
IDAKICAgICAgbGF0ZW5jeSBhbmQgZGlzYWJsZSBTQUdWLgogICAgLSBSZW1vdmUgdW5uZWVkZWQg
dGFicyhKYW1lcyBBdXNtdXMpCgp2MzogUmViYXNlZCB0aGUgcGF0Y2gKCnY0OiAtIEFkZGVkIGJh
Y2sgaW50ZXJsYWNlZCBjaGVjayBmb3IgR2VuMTIgYW5kCiAgICAgIGFkZGVkIHNlcGFyYXRlIGZ1
bmN0aW9uIGZvciBUR0wgU0FHViBjaGVjawogICAgICAodGhhbmtzIHRvIEphbWVzIEF1c211cyBm
b3Igc3BvdHRpbmcpCiAgICAtIFJlbW92ZWQgdW5uZWVkZWQgZ2VuIGNoZWNrCiAgICAtIEV4dHJh
Y3RlZCBHZW4xMiBTQUdWIGRlY2lzaW9uIG1ha2luZyBjb2RlCiAgICAgIHRvIGEgc2VwYXJhdGUg
ZnVuY3Rpb24gZnJvbSBza2xfY29tcHV0ZV93bQoKdjU6IC0gQWRkZWQgU0FHViBnbG9iYWwgc3Rh
dGUgdG8gZGV2X3ByaXYsIGJlY2F1c2UKICAgICAgd2UgbmVlZCB0byB0cmFjayBhbGwgcGlwZXMs
IG5vdCBvbmx5IHRob3NlCiAgICAgIGluIGF0b21pYyBzdGF0ZS4gRWFjaCBwaXBlIGhhcyBub3cg
Y29ycmVzcG9uZGVudAogICAgICBiaXQgbWFzayByZWZsZWN0aW5nLCB3aGV0aGVyIGl0IGNhbiB0
b2xlcmF0ZQogICAgICBTQUdWIG9yIG5vdCh0aGFua3MgdG8gVmlsbGUgU3lyamFsYSBmb3Igc3Vn
Z2VzdGlvbnMpLgogICAgLSBOb3cgdXNpbmcgYWN0aXZlIGZsYWcgaW5zdGVhZCBvZiBlbmFibGUg
aW4gY3JjCiAgICAgIHVzYWdlIGNoZWNrLgoKdjY6IC0gRml4ZWQgcmViYXNlIGNvbmZsaWN0cwoK
djc6IC0ga21zX2N1cnNvcl9sZWdhY3kgc2VlbXMgdG8gZ2V0IGJyb2tlbiBiZWNhdXNlIG9mIG11
bHRpcGxlIG1lbWNweQogICAgICBjYWxscyB3aGVuIGNvcHlpbmcgbGV2ZWwgMCB3YXRlciBtYXJr
cyBmb3IgZW5hYmxlZCBTQUdWLCB0bwogICAgICBmaXggdGhpcyBub3cgc2ltcGx5IHVzaW5nIHRo
YXQgZmllbGQgcmlnaHQgYXdheSwgd2l0aG91dCBjb3B5aW5nLAogICAgICBmb3IgdGhhdCBpbnRy
b2R1Y2VkIGEgbmV3IHdtX2xldmVsIGFjY2Vzc29yIHdoaWNoIGRlY2lkZXMgd2hpY2gKICAgICAg
d21fbGV2ZWwgdG8gcmV0dXJuIGJhc2VkIG9uIFNBR1Ygc3RhdGUuCgp2ODogLSBQcm90ZWN0IGNy
dGNfc2Fndl9tYXNrIHNhbWUgd2F5IGFzIHdlIGRvIGZvciBvdGhlciBnbG9iYWwgc3RhdGUKICAg
ICAgY2hhbmdlczogaS5lIGNoZWNrIGlmIGNoYW5nZXMgYXJlIG5lZWRlZCwgdGhlbiBncmFiIGFs
bCBjcnRjIGxvY2tzCiAgICAgIHRvIHNlcmlhbGl6ZSB0aGUgY2hhbmdlcyhWaWxsZSBTeXJqw6Rs
w6QpCiAgICAtIEFkZCBjcnRjX3NhZ3ZfbWFzayBjYWNoaW5nIGluIG9yZGVyIHRvIGF2b2lkIG5l
ZWRsZXNzIHJlY2FsY3VsYXRpb25zCiAgICAgIChNYXR0aGV3IFJvcGVyKQogICAgLSBQdXQgYmFj
ayBHZW4xMiBTQUdWIHN3aXRjaCBpbiBvcmRlciB0byBnZXQgaXQgZW5hYmxlZCBpbiBzZXBhcmF0
ZQogICAgICBwYXRjaChNYXR0aGV3IFJvcGVyKQogICAgLSBSZW5hbWUgKl9zZXRfc2Fndl9tYXNr
IHRvICpfY29tcHV0ZV9zYWd2X21hc2soTWF0dGhldyBSb3BlcikKICAgIC0gQ2hlY2sgaWYgdGhl
cmUgYXJlIG5vIGFjdGl2ZSBwaXBlcyBpbiBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YKICAgICAgaW5z
dGVhZCBvZiBwbGF0Zm9ybSBzcGVjaWZpYyBmdW5jdGlvbnMoTWF0dGhldyBSb3BlciksIHNhbWUK
ICAgICAgZm9yIGludGVsX2hhc19zYWd2IGNoZWNrLgoKdjkgIC0gU3dpdGNoZWQgdG8gdTggZm9y
IGNydGNfc2Fndl9tYXNrKFZpbGxlIFN5cmrDpGzDpCkKICAgIC0gY3J0Y19zYWd2X21hc2sgbm93
IGlzIHBpcGVfc2Fndl9tYXNrKFZpbGxlIFN5cmrDpGzDpCkKICAgIC0gRXh0cmFjdGVkIHNhZ3Yg
Y2hlY2tpbmcgbG9naWMgZnJvbSBza2wvaWNsL3RnbF9jb21wdXRlX3NhZ3ZfbWFzawogICAgLSBF
eHRyYWN0ZWQgc2tsX3BsYW5lX3dtX2xldmVsIGZ1bmN0aW9uIGFuZCBwYXNzaW5nIGxhdGVuY3kg
dG8KICAgICAgc2VwYXJhdGUgcGF0Y2hlcyhWaWxsZSBTeXJqw6Rsw6QpCiAgICAtIFJlbW92ZWQg
cGFydCBvZiB1bm5lZWRlZCBjb3B5LXBhc3RlIGZyb20gdGdsX2NoZWNrX3BpcGVfZml0c19zYWd2
X3dtCiAgICAgIChWaWxsZSBTeXJqw6Rsw6QpCiAgICAtIE5vdyB1c2luZyBzaW1wbGUgYXNzaWdu
bWVudCBmb3Igc2Fndl93bTAgYXMgaXQgY29udGFpbnMgb25seQogICAgICBwb2QgdHlwZXMgYW5k
IG5vIHBvaW50ZXJzKFZpbGxlIFN5cmrDpGzDpCkKICAgIC0gRml4ZWQgaW50ZWxfY2FuX2VuYWJs
ZV9zYWd2IG5vdCB0byBkbyBkb3VibGUgZHV0eSwgbm93IGl0IG9ubHkKICAgICAgY2hlY2sgU0FH
ViBiaXRzIGJ5IEFORGluZyB0aG9zZSBiZXR3ZWVuIGxvY2FsIGFuZCBnbG9iYWwgc3RhdGUuCiAg
ICAgIFRoZSBTQUdWIG1hc2tzIGFyZSBub3cgY29tcHV0ZWQgYWZ0ZXIgd2F0ZXJtYXJrcyBhcmUg
YXZhaWxhYmxlLAogICAgICBpbiBvcmRlciB0byBiZSBhYmxlIHRvIGZpZ3VyZSBvdXQgaWYgZGRi
IHJhbmdlcyBhcmUgZml0dGluZyBuaWNlbHkuCiAgICAgIChWaWxsZSBTeXJqw6Rsw6QpCiAgICAt
IE5vdyBoYXZpbmcgdXZfc2Fndl93bTAgYW5kIHNhZ3Zfd20wLCBvdGhlcndpc2Ugd2UgaGF2ZSB3
cm9uZyBsb2dpYwogICAgICB3aGVuIHVzaW5nIHNrbF9wbGFuZV93bV9sZXZlbCBhY2Nlc3Nvciwg
YXMgd2UgaGFkIHByZXZpb3VzbHkgZm9yCiAgICAgIEdlbjExKyBjb2xvciBwbGFuZSBhbmQgcmVn
dWxhciB3bSBsZXZlbHMsIHNvIHByb2JhYmx5IGJvdGgKICAgICAgaGFzIHRvIGJlIHJlY2FsY3Vs
YXRlZCB3aXRoIGFkZGl0aW9uYWwgU0FHViBibG9jayB0aW1lIGZvciBMZXZlbCAwLgoKdjEwOiAt
IFN0YXJ0aW5nIHRvIHVzZSBuZXcgZ2xvYmFsIHN0YXRlIGZvciBzdG9yaW5nIHBpcGVfc2Fndl9t
YXNrCgp2MTE6IC0gRml4ZWQgcmViYXNlIGNvbmZsaWN0IHdpdGggcmVjZW50IGRybS10aXAKICAg
ICAtIENoZWNrIGlmIHdlIHJlYWxseSBuZWVkIHRvIHJlY2FsY3VsYXRlIFNBR1YgbWFzaywgb3Ro
ZXJ3aXNlCiAgICAgICBiYWlsIG91dCB3aXRob3V0IG1ha2luZyBhbnkgY2hhbmdlcy4KICAgICAt
IFVzZSBjYWNoZWQgU0FHViByZXN1bHQsIGluc3RlYWQgb2YgcmVjYWxjdWxhdGluZyBpdCBldmVy
eXRpbWUsCiAgICAgICBpZiBid19zdGF0ZSBoYXNuJ3QgY2hhbmdlZC4KCnYxMjogLSBSZW1vdmVk
IFdBUk4gZnJvbSBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YsIGluIHNvbWUgb2YgdGhlIGNvbW1pdHMK
ICAgICAgIGlmIHdlIGRvbid0IHJlY2FsY3VsYXRlZCB3YXRlcm1hcmtzLCBid19zdGF0ZSBpcyBu
b3QgcmVjYWxjdWxhdGVkLAogICAgICAgdGh1cyBsZWFkaW5nIHRvIFNBR1Ygc3RhdGUgbm90IHJl
Y2FsY3VsYXRlZCBieSB0aGUgY29tbWl0IHN0YXRlLAogICAgICAgd2hpY2ggaXMgc3RpbGwgY2Fs
bGluZyBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YgZnVuY3Rpb24uIEZpeCB0aGF0CiAgICAgICBieSBq
dXN0IGFuYWx5emluZyB0aGUgY3VycmVudCBnbG9iYWwgYndfc3RhdGUgb2JqZWN0IC0gYmVjYXVz
ZQogICAgICAgd2Ugc2ltcGx5IGhhdmUgbm8gb3RoZXIgb2JqZWN0cyByZWxhdGVkIHRvIHRoYXQu
Cgp2MTM6IC0gUmViYXNlZCwgZml4ZWQgd2FybmluZ3MgcmVnYXJkaW5nIGxvbmcgbGluZXMKICAg
ICAtIENoYW5nZWQgZnVuY3Rpb24gY2FsbCBzaXRlcyBmcm9tIGludGVsX2F0b21pY19idyogdG8K
ICAgICAgIGludGVsX3diXyogYXMgd2FzIHN1Z2dlc3RlZC4oSmFuaSBOaWt1bGEpCiAgICAgLSBU
YWtlbiBkZGJfc3RhdGVfY2hhbmdlZCBhbmQgYndfc3RhdGVfY2hhbmdlZCBpbnRvIHVzZS4KClNp
Z25lZC1vZmYtYnk6IFN0YW5pc2xhdiBMaXNvdnNraXkgPHN0YW5pc2xhdi5saXNvdnNraXlAaW50
ZWwuY29tPgpDYzogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGludGVsLmNvbT4KQ2M6
IEphbWVzIEF1c211cyA8amFtZXMuYXVzbXVzQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2J3LmggICAgICAgfCAgMTggKwogZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgIHwgIDI3ICstCiAuLi4vZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggICAgfCAgIDIgKwogZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfcG0uYyAgICAgICAgICAgICAgIHwgNDQxICsrKysrKysrKysrKysrKystLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uaCAgICAgICAgICAgICAgIHwgICA0ICstCiA1IGZp
bGVzIGNoYW5nZWQsIDQ0OCBpbnNlcnRpb25zKCspLCA0NCBkZWxldGlvbnMoLSkKCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2J3LmggYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2J3LmgKaW5kZXggYjVmNjE0NjM5MjJmLi5jMzJiNTI4
NWMxMmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYncu
aAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2J3LmgKQEAgLTE4LDYg
KzE4LDI0IEBAIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlOwogc3RydWN0IGludGVsX2J3X3N0YXRl
IHsKIAlzdHJ1Y3QgaW50ZWxfZ2xvYmFsX3N0YXRlIGJhc2U7CiAKKwkvKgorCSAqIENvbnRhaW5z
IGEgYml0IG1hc2ssIHVzZWQgdG8gZGV0ZXJtaW5lLCB3aGV0aGVyIGNvcnJlc3BvbmRlbnQKKwkg
KiBwaXBlIGFsbG93cyBTQUdWIG9yIG5vdC4KKwkgKi8KKwl1OCBwaXBlX3NhZ3ZfbWFzazsKKwor
CS8qCisJICogVXNlZCB0byBkZXRlcm1pbmUgaWYgd2UgYWxyZWFkeSBoYWQgY2FsY3VsYXRlZAor
CSAqIFNBR1YgbWFzayBmb3IgdGhpcyBzdGF0ZSBvbmNlLgorCSAqLworCWJvb2wgc2Fndl9jYWxj
dWxhdGVkOworCisJLyoKKwkgKiBDb250YWlucyBmaW5hbCBTQUdWIGRlY2lzaW9uIGJhc2VkIG9u
IGN1cnJlbnQgbWFzaywKKwkgKiB0byBwcmV2ZW50IGRvaW5nIHRoZSBzYW1lIGpvYiBvdmVyIGFu
ZCBvdmVyIGFnYWluLgorCSAqLworCWJvb2wgY2FuX3NhZ3Y7CisKIAl1bnNpZ25lZCBpbnQgZGF0
YV9yYXRlW0k5MTVfTUFYX1BJUEVTXTsKIAl1OCBudW1fYWN0aXZlX3BsYW5lc1tJOTE1X01BWF9Q
SVBFU107CiB9OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXku
YwppbmRleCA1MzBhMjVlMWFkMWMuLmIzNTViZTMyZWQyZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTEzOTc3LDcgKzEzOTc3LDEwIEBAIHN0
YXRpYyB2b2lkIHZlcmlmeV93bV9zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJLyog
V2F0ZXJtYXJrcyAqLwogCQlmb3IgKGxldmVsID0gMDsgbGV2ZWwgPD0gbWF4X2xldmVsOyBsZXZl
bCsrKSB7CiAJCQlpZiAoc2tsX3dtX2xldmVsX2VxdWFscygmaHdfcGxhbmVfd20tPndtW2xldmVs
XSwKLQkJCQkJCSZzd19wbGFuZV93bS0+d21bbGV2ZWxdKSkKKwkJCQkJCSZzd19wbGFuZV93bS0+
d21bbGV2ZWxdKSB8fAorCQkJICAgKHNrbF93bV9sZXZlbF9lcXVhbHMoJmh3X3BsYW5lX3dtLT53
bVtsZXZlbF0sCisJCQkJCQkmc3dfcGxhbmVfd20tPnNhZ3Zfd20wKSAmJgorCQkJICAgKGxldmVs
ID09IDApKSkKIAkJCQljb250aW51ZTsKIAogCQkJZHJtX2VycigmZGV2X3ByaXYtPmRybSwKQEAg
LTE0MDMyLDcgKzE0MDM1LDEwIEBAIHN0YXRpYyB2b2lkIHZlcmlmeV93bV9zdGF0ZShzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YywKIAkJLyogV2F0ZXJtYXJrcyAqLwogCQlmb3IgKGxldmVsID0gMDsg
bGV2ZWwgPD0gbWF4X2xldmVsOyBsZXZlbCsrKSB7CiAJCQlpZiAoc2tsX3dtX2xldmVsX2VxdWFs
cygmaHdfcGxhbmVfd20tPndtW2xldmVsXSwKLQkJCQkJCSZzd19wbGFuZV93bS0+d21bbGV2ZWxd
KSkKKwkJCQkJCSZzd19wbGFuZV93bS0+d21bbGV2ZWxdKSB8fAorCQkJICAgKHNrbF93bV9sZXZl
bF9lcXVhbHMoJmh3X3BsYW5lX3dtLT53bVtsZXZlbF0sCisJCQkJCQkmc3dfcGxhbmVfd20tPnNh
Z3Zfd20wKSAmJgorCQkJICAgKGxldmVsID09IDApKSkKIAkJCQljb250aW51ZTsKIAogCQkJZHJt
X2VycigmZGV2X3ByaXYtPmRybSwKQEAgLTE1NTA5LDkgKzE1NTE1LDExIEBAIHN0YXRpYyB2b2lk
IGludGVsX2F0b21pY19jb21taXRfdGFpbChzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0
ZSkKIAkJICogU0tMIHdvcmthcm91bmQ6IGJzcGVjIHJlY29tbWVuZHMgd2UgZGlzYWJsZSB0aGUg
U0FHViB3aGVuIHdlCiAJCSAqIGhhdmUgbW9yZSB0aGVuIG9uZSBwaXBlIGVuYWJsZWQKIAkJICov
Ci0JCWlmIChzdGF0ZS0+Yndfc3RhdGVfY2hhbmdlZCkgewotCQkJaWYgKCFpbnRlbF9jYW5fZW5h
YmxlX3NhZ3Yoc3RhdGUpKQotCQkJCWludGVsX2Rpc2FibGVfc2FndihkZXZfcHJpdik7CisJCWlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTEpIHsKKwkJCWlmIChzdGF0ZS0+Yndfc3RhdGVfY2hh
bmdlZCkgeworCQkJCWlmICghaW50ZWxfY2FuX2VuYWJsZV9zYWd2KGRldl9wcml2KSkKKwkJCQkJ
aW50ZWxfZGlzYWJsZV9zYWd2KGRldl9wcml2KTsKKwkJCX0KIAkJfQogCiAJCWludGVsX21vZGVz
ZXRfdmVyaWZ5X2Rpc2FibGVkKGRldl9wcml2LCBzdGF0ZSk7CkBAIC0xNTYxMiw5ICsxNTYyMCwx
MSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9hdG9taWNfY29tbWl0X3RhaWwoc3RydWN0IGludGVsX2F0
b21pY19zdGF0ZSAqc3RhdGUpCiAJaWYgKHN0YXRlLT5tb2Rlc2V0KQogCQlpbnRlbF92ZXJpZnlf
cGxhbmVzKHN0YXRlKTsKIAotCWlmIChzdGF0ZS0+Yndfc3RhdGVfY2hhbmdlZCkgewotCQlpZiAo
aW50ZWxfY2FuX2VuYWJsZV9zYWd2KHN0YXRlKQotCQkJaW50ZWxfZW5hYmxlX3NhZ3YoZGV2X3By
aXYpOworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTEpIHsKKwkJaWYgKHN0YXRlLT5id19z
dGF0ZV9jaGFuZ2VkKSB7CisJCQlpZiAoaW50ZWxfY2FuX2VuYWJsZV9zYWd2KGRldl9wcml2KSkK
KwkJCQlpbnRlbF9lbmFibGVfc2FndihkZXZfcHJpdik7CisJCX0KIAl9CiAKIAlkcm1fYXRvbWlj
X2hlbHBlcl9jb21taXRfaHdfZG9uZSgmc3RhdGUtPmJhc2UpOwpAQCAtMTU3NjcsNyArMTU3Nzcs
NiBAQCBzdGF0aWMgaW50IGludGVsX2F0b21pY19jb21taXQoc3RydWN0IGRybV9kZXZpY2UgKmRl
diwKIAogCWlmIChzdGF0ZS0+Z2xvYmFsX3N0YXRlX2NoYW5nZWQpIHsKIAkJYXNzZXJ0X2dsb2Jh
bF9zdGF0ZV9sb2NrZWQoZGV2X3ByaXYpOwotCiAJCWRldl9wcml2LT5hY3RpdmVfcGlwZXMgPSBz
dGF0ZS0+YWN0aXZlX3BpcGVzOwogCX0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaAppbmRleCAxMmI0N2JhM2M2OGQuLjI4OTQ2MTU3
MWEwZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5X3R5cGVzLmgKQEAgLTY2NCw2ICs2NjQsOCBAQCBzdHJ1Y3Qgc2tsX3BsYW5lX3dtIHsKIAlz
dHJ1Y3Qgc2tsX3dtX2xldmVsIHdtWzhdOwogCXN0cnVjdCBza2xfd21fbGV2ZWwgdXZfd21bOF07
CiAJc3RydWN0IHNrbF93bV9sZXZlbCB0cmFuc193bTsKKwlzdHJ1Y3Qgc2tsX3dtX2xldmVsIHNh
Z3Zfd20wOworCXN0cnVjdCBza2xfd21fbGV2ZWwgdXZfc2Fndl93bTA7CiAJYm9vbCBpc19wbGFu
YXI7CiB9OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwppbmRleCA3YTc2YjJlZDdhODcuLjg1M2Zj
OWU5MDg0ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCkBAIC00Miw2ICs0Miw3IEBACiAjaW5j
bHVkZSAiaTkxNV9kcnYuaCIKICNpbmNsdWRlICJpOTE1X2lycS5oIgogI2luY2x1ZGUgImk5MTVf
dHJhY2UuaCIKKyNpbmNsdWRlICJkaXNwbGF5L2ludGVsX2J3LmgiCiAjaW5jbHVkZSAiaW50ZWxf
cG0uaCIKICNpbmNsdWRlICJpbnRlbF9zaWRlYmFuZC5oIgogI2luY2x1ZGUgIi4uLy4uLy4uL3Bs
YXRmb3JtL3g4Ni9pbnRlbF9pcHMuaCIKQEAgLTM2MjAsNyArMzYyMSw3IEBAIHN0YXRpYyBib29s
IHNrbF9uZWVkc19tZW1vcnlfYndfd2Eoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQogCXJldHVybiBJU19HRU45X0JDKGRldl9wcml2KSB8fCBJU19CUk9YVE9OKGRldl9wcml2KTsK
IH0KIAotc3RhdGljIGJvb2wKK2Jvb2wKIGludGVsX2hhc19zYWd2KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKIHsKIAkvKiBIQUNLISAqLwpAQCAtMzc0MywzOSArMzc0NCwyNCBA
QCBpbnRlbF9kaXNhYmxlX3NhZ3Yoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQog
CXJldHVybiAwOwogfQogCi1ib29sIGludGVsX2Nhbl9lbmFibGVfc2FndihzdHJ1Y3QgaW50ZWxf
YXRvbWljX3N0YXRlICpzdGF0ZSkKK3N0YXRpYyBib29sIHNrbF9jYW5fZW5hYmxlX3NhZ3Zfb25f
cGlwZShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKKwkJCQkJZW51bSBwaXBlIHBp
cGUpCiB7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IHN0YXRlLT5iYXNlLmRldjsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CiAJc3RydWN0IGlu
dGVsX2NydGMgKmNydGM7CiAJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZTsKIAlzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKLQllbnVtIHBpcGUgcGlwZTsKIAlpbnQgbGV2ZWws
IGxhdGVuY3k7CiAKLQlpZiAoIWludGVsX2hhc19zYWd2KGRldl9wcml2KSkKLQkJcmV0dXJuIGZh
bHNlOwotCi0JLyoKLQkgKiBJZiB0aGVyZSBhcmUgbm8gYWN0aXZlIENSVENzLCBubyBhZGRpdGlv
bmFsIGNoZWNrcyBuZWVkIGJlIHBlcmZvcm1lZAotCSAqLwotCWlmIChod2VpZ2h0OChzdGF0ZS0+
YWN0aXZlX3BpcGVzKSA9PSAwKQotCQlyZXR1cm4gdHJ1ZTsKLQotCS8qCi0JICogU0tMKyB3b3Jr
YXJvdW5kOiBic3BlYyByZWNvbW1lbmRzIHdlIGRpc2FibGUgU0FHViB3aGVuIHdlIGhhdmUKLQkg
KiBtb3JlIHRoZW4gb25lIHBpcGUgZW5hYmxlZAotCSAqLwotCWlmIChod2VpZ2h0OChzdGF0ZS0+
YWN0aXZlX3BpcGVzKSA+IDEpCi0JCXJldHVybiBmYWxzZTsKLQotCS8qIFNpbmNlIHdlJ3JlIG5v
dyBndWFyYW50ZWVkIHRvIG9ubHkgaGF2ZSBvbmUgYWN0aXZlIENSVEMuLi4gKi8KLQlwaXBlID0g
ZmZzKHN0YXRlLT5hY3RpdmVfcGlwZXMpIC0gMTsKIAljcnRjID0gaW50ZWxfZ2V0X2NydGNfZm9y
X3BpcGUoZGV2X3ByaXYsIHBpcGUpOwogCWNydGNfc3RhdGUgPSB0b19pbnRlbF9jcnRjX3N0YXRl
KGNydGMtPmJhc2Uuc3RhdGUpOwogCi0JaWYgKGNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUu
ZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX0lOVEVSTEFDRSkKKwlpZiAoY3J0Y19zdGF0ZS0+aHcuYWRq
dXN0ZWRfbW9kZS5mbGFncyAmIERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFKSB7CisJCURSTV9ERUJV
R19LTVMoIk5vIFNBR1YgZm9yIGludGVybGFjZWQgbW9kZSBvbiBwaXBlICVjXG4iLAorCQkJICAg
ICAgcGlwZV9uYW1lKHBpcGUpKTsKIAkJcmV0dXJuIGZhbHNlOworCX0KIAogCWZvcl9lYWNoX2lu
dGVsX3BsYW5lX29uX2NydGMoZGV2LCBjcnRjLCBwbGFuZSkgewogCQlzdHJ1Y3Qgc2tsX3BsYW5l
X3dtICp3bSA9CkBAIC0zODAyLDEzICszNzg4LDE4MSBAQCBib29sIGludGVsX2Nhbl9lbmFibGVf
c2FndihzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJICogaW5jdXIgbWVtb3J5
IGxhdGVuY2llcyBoaWdoZXIgdGhhbiBzYWd2X2Jsb2NrX3RpbWVfdXMgd2UKIAkJICogY2FuJ3Qg
ZW5hYmxlIFNBR1YuCiAJCSAqLwotCQlpZiAobGF0ZW5jeSA8IGRldl9wcml2LT5zYWd2X2Jsb2Nr
X3RpbWVfdXMpCisJCWlmIChsYXRlbmN5IDwgZGV2X3ByaXYtPnNhZ3ZfYmxvY2tfdGltZV91cykg
eworCQkJRFJNX0RFQlVHX0tNUygiTGF0ZW5jeSAlZCA8IHNhZ3YgYmxvY2sgdGltZSAlZCwgbm8g
U0FHViBmb3IgcGlwZSAlY1xuIiwKKwkJCQkgICAgICBsYXRlbmN5LCBkZXZfcHJpdi0+c2Fndl9i
bG9ja190aW1lX3VzLCBwaXBlX25hbWUocGlwZSkpOwogCQkJcmV0dXJuIGZhbHNlOworCQl9CiAJ
fQogCiAJcmV0dXJuIHRydWU7CiB9CiAKK3N0YXRpYyB2b2lkIHNrbF9jb21wdXRlX3NhZ3ZfbWFz
ayhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YzsKKwllbnVtIHBpcGUgcGlwZTsKKwlzdHJ1Y3QgaW50ZWxfYndfc3RhdGUgKm5ld19i
d19zdGF0ZSA9IGludGVsX2J3X2dldF9zdGF0ZShzdGF0ZSk7CisKKwlpZiAoSVNfRVJSKG5ld19i
d19zdGF0ZSkpIHsKKwkJV0FSTigxLCAiQ291bGQgbm90IGdldCBid19zdGF0ZVxuIik7CisJCXJl
dHVybjsKKwl9CisKKwlpZiAoc3RhdGUtPmFjdGl2ZV9waXBlcyAhPSAxKSB7CisJCW5ld19id19z
dGF0ZS0+cGlwZV9zYWd2X21hc2sgPSAwOworCQlEUk1fREVCVUdfS01TKCJObyBTQUdWIGZvciBt
dWx0aXBsZSBwaXBlcyBvbiBHZW4gOVxuIik7CisJCXJldHVybjsKKwl9CisKKwkvKiBTaW5jZSB3
ZSdyZSBub3cgZ3VhcmFudGVlZCB0byBvbmx5IGhhdmUgb25lIGFjdGl2ZSBDUlRDLi4uICovCisJ
cGlwZSA9IGZmcyhzdGF0ZS0+YWN0aXZlX3BpcGVzKSAtIDE7CisKKwlpZiAoc2tsX2Nhbl9lbmFi
bGVfc2Fndl9vbl9waXBlKHN0YXRlLCBwaXBlKSkKKwkJbmV3X2J3X3N0YXRlLT5waXBlX3NhZ3Zf
bWFzayB8PSBCSVQoY3J0Yy0+cGlwZSk7CisJZWxzZQorCQluZXdfYndfc3RhdGUtPnBpcGVfc2Fn
dl9tYXNrICY9IH5CSVQoY3J0Yy0+cGlwZSk7Cit9CisKK3N0YXRpYyB2b2lkIHRnbF9jb21wdXRl
X3NhZ3ZfbWFzayhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSk7CisKK3N0YXRpYyB2
b2lkIGljbF9jb21wdXRlX3NhZ3ZfbWFzayhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0
ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKKwlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqbmV3X2NydGNfc3RhdGU7CisJaW50IGk7CisJc3RydWN0IGludGVsX2J3X3N0YXRlICpuZXdf
Yndfc3RhdGUgPSBpbnRlbF9id19nZXRfc3RhdGUoc3RhdGUpOworCisJaWYgKElTX0VSUihuZXdf
Yndfc3RhdGUpKSB7CisJCVdBUk4oMSwgIkNvdWxkIG5vdCBnZXQgYndfc3RhdGVcbiIpOworCQly
ZXR1cm47CisJfQorCisJZm9yX2VhY2hfbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3RhdGUsIGNy
dGMsCisJCQkJCSBuZXdfY3J0Y19zdGF0ZSwgaSkgeworCQlpZiAoc2tsX2Nhbl9lbmFibGVfc2Fn
dl9vbl9waXBlKHN0YXRlLCBjcnRjLT5waXBlKSkKKwkJCW5ld19id19zdGF0ZS0+cGlwZV9zYWd2
X21hc2sgfD0gQklUKGNydGMtPnBpcGUpOworCQllbHNlCisJCQluZXdfYndfc3RhdGUtPnBpcGVf
c2Fndl9tYXNrICY9IH5CSVQoY3J0Yy0+cGlwZSk7CisJfQorfQorCitzdGF0aWMgdm9pZCBpbnRl
bF9jb21wdXRlX3NhZ3ZfbWFzayhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKKwkJ
CQkgICAgaW50IHRvdGFsX2FmZmVjdGVkX3BsYW5lcykKK3sKKwlpbnQgcmV0OworCXN0cnVjdCBk
cm1fZGV2aWNlICpkZXYgPSBzdGF0ZS0+YmFzZS5kZXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBpbnRlbF9id19zdGF0ZSAqbmV3
X2J3X3N0YXRlOworCXN0cnVjdCBpbnRlbF9id19zdGF0ZSAqb2xkX2J3X3N0YXRlOworCisJLyoK
KwkgKiBObyBhY3RpdmVfcGlwZV9jaGFuZ2VzIGFuZCBubyB3bS9kZGIgY2hhbmdlcyBtZWFucwor
CSAqIHdlIGNhbiBqdXN0IGJhaWwgb3V0LgorCSAqLworCWlmIChzdGF0ZS0+YWN0aXZlX3BpcGVf
Y2hhbmdlcyA9PSAwICYmIHN0YXRlLT5kZGJfc3RhdGVfY2hhbmdlZCA9PSBmYWxzZSkKKwkJcmV0
dXJuOworCisJLyoKKwkgKiBJZiB3ZSBhcmUgaGVyZSAtIG1lYW5zIGVpdGhlciBhY3RpdmVfcGlw
ZXMgY29uZmlnIGhhZCBjaGFuZ2VkLAorCSAqIG9yIHdhdGVybWFya3MvZGRiIGhhcyBiZWVuIGNo
YW5nZWQsIHdoaWNoIG1lYW5zIG1vc3QgbGlrZWx5CisJICogd2UgaGFkIGNydGNzIGFkZGVkIHRv
IHRoZSBzdGF0ZShhdCBsZWFzdCBzdGF0ZSBpcyByZWFkIGxvY2tlZCkKKwkgKiBhbmQgd2UgZGVm
aW5pdGVseSBuZWVkIHRvIHJlY2FsY3VsYXRlIFNBR1Ygc3RhdGUgbm93LgorCSAqLworCW5ld19i
d19zdGF0ZSA9IGludGVsX2J3X2dldF9zdGF0ZShzdGF0ZSk7CisJb2xkX2J3X3N0YXRlID0gaW50
ZWxfYndfZ2V0X29sZF9zdGF0ZShzdGF0ZSk7CisKKwlpZiAoSVNfRVJSKG5ld19id19zdGF0ZSkg
fHwgSVNfRVJSKG9sZF9id19zdGF0ZSkpIHsKKwkJV0FSTigxLCAiQ291bGQgbm90IGdldCBid19z
dGF0ZVxuIik7CisJCXJldHVybjsKKwl9CisKKwluZXdfYndfc3RhdGUtPnNhZ3ZfY2FsY3VsYXRl
ZCA9IGZhbHNlOworCisJLyoKKwkgKiBOb3cgb25jZSB3ZSBnb3Qgd20gbGV2ZWxzIGNhbGN1bGF0
ZWQsCisJICogY2hlY2sgaWYgd2UgY2FuIGhhdmUgU0FHVi4KKwkgKi8KKwlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSAxMikKKwkJdGdsX2NvbXB1dGVfc2Fndl9tYXNrKHN0YXRlKTsKKwllbHNl
IGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID09IDExKQorCQlpY2xfY29tcHV0ZV9zYWd2X21hc2so
c3RhdGUpOworCWVsc2UKKwkJc2tsX2NvbXB1dGVfc2Fndl9tYXNrKHN0YXRlKTsKKworCS8qCisJ
ICogRm9yIFNBR1Ygd2UgbmVlZCB0byBhY2NvdW50IGFsbCB0aGUgcGlwZXMsCisJICogbm90IG9u
bHkgdGhlIG9uZXMgd2hpY2ggYXJlIGluIHN0YXRlIGN1cnJlbnRseS4KKwkgKiBHcmFiIGFsbCBs
b2NrcyBpZiB3ZSBkZXRlY3QgdGhhdCB3ZSBhcmUgYWN0dWFsbHkKKwkgKiBnb2luZyB0byBkbyBz
b21ldGhpbmcuCisJICovCisJaWYgKG5ld19id19zdGF0ZS0+cGlwZV9zYWd2X21hc2sgIT0gb2xk
X2J3X3N0YXRlLT5waXBlX3NhZ3ZfbWFzaykgeworCisJCXN0YXRlLT5id19zdGF0ZV9jaGFuZ2Vk
ID0gdHJ1ZTsKKworCQlyZXQgPSBpbnRlbF9hdG9taWNfc2VyaWFsaXplX2dsb2JhbF9zdGF0ZSgm
bmV3X2J3X3N0YXRlLT5iYXNlKTsKKwkJaWYgKHJldCkgeworCQkJRFJNX0RFQlVHX0tNUygiQ291
bGQgbm90IHNlcmlhbGl6ZSBnbG9iYWwgc3RhdGVcbiIpOworCQkJcmV0dXJuOworCQl9CisJfQor
fQorCitzdGF0aWMgYm9vbCBpbnRlbF9jYWxjdWxhdGVfc2Fndl9yZXN1bHQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAorCQkJCQlzdHJ1Y3QgaW50ZWxfYndfc3RhdGUgKmJ3X3N0
YXRlKQoreworCWJvb2wgc2Fndl9yZXN1bHQgPSB0cnVlOworCWVudW0gcGlwZSBwaXBlOworCisJ
Zm9yX2VhY2hfcGlwZShkZXZfcHJpdiwgcGlwZSkgeworCQkvKgorCQkgKiBUT0RPOiBXZSBhcmUg
ZGVwZW5kaW5nIG9uIGFjdGl2ZV9waXBlcyBoZXJlLAorCQkgKiBwcm9iYWJseSBpdCBzaG91bGQg
YmUgcGFydCBvZiBzb21lIG90aGVyIGdsb2JhbCBzdGF0ZQorCQkgKiBvYmosIGxpa2UgbW9kZXNl
dF9zdGF0ZSBvciBzbXRoLCB3aGljaCB3ZSBzaG91bGQgZGVwZW5kIG9uLgorCQkgKiBEb24ndCB3
YW50IHRvIGNsb25lIGl0IGhlcmUsIHJlYWxseS4KKwkJICovCisJCWludCBhY3RpdmVfcGlwZV9i
aXQgPSBkZXZfcHJpdi0+YWN0aXZlX3BpcGVzICYgQklUKHBpcGUpOworCisJCWlmIChhY3RpdmVf
cGlwZV9iaXQpIHsKKwkJCWlmICgoYndfc3RhdGUtPnBpcGVfc2Fndl9tYXNrICYgQklUKHBpcGUp
KSA9PSAwKSB7CisJCQkJc2Fndl9yZXN1bHQgPSBmYWxzZTsKKwkJCQlicmVhazsKKwkJCX0KKwkJ
fQorCX0KKworCXJldHVybiBzYWd2X3Jlc3VsdDsKK30KKworLyoKKyAqIFRoaXMgZnVuY3Rpb24g
dG8gYmUgdXNlZCBiZWZvcmUgc3dhcCBzdGF0ZQorICovCitib29sIGludGVsX2Nhbl9lbmFibGVf
c2Fndl9mb3Jfc3RhdGUoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCit7CisJc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiA9IHN0YXRlLT5iYXNlLmRldjsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGludGVsX2J3X3N0YXRl
ICpid19zdGF0ZSAgPSBpbnRlbF9id19nZXRfc3RhdGUoc3RhdGUpOworCisJaWYgKElTX0VSUihi
d19zdGF0ZSkpIHsKKwkJV0FSTigxLCAiQ291bGQgbm90IGdldCBid19zdGF0ZVxuIik7CisJCXJl
dHVybiBmYWxzZTsKKwl9CisKKwlpZiAoIWludGVsX2hhc19zYWd2KGRldl9wcml2KSkgeworCQlE
Uk1fREVCVUdfS01TKCJObyBTQUdWIHN1cHBvcnQgZGV0ZWN0ZWRcbiIpOworCQlyZXR1cm4gZmFs
c2U7CisJfQorCisJaWYgKGJ3X3N0YXRlLT5zYWd2X2NhbGN1bGF0ZWQpCisJCWdvdG8gb3V0Owor
CisJYndfc3RhdGUtPmNhbl9zYWd2ID0gaW50ZWxfY2FsY3VsYXRlX3NhZ3ZfcmVzdWx0KGRldl9w
cml2LCBid19zdGF0ZSk7CisJYndfc3RhdGUtPnNhZ3ZfY2FsY3VsYXRlZCA9IHRydWU7CisKK291
dDoKKwlyZXR1cm4gYndfc3RhdGUtPmNhbl9zYWd2OworfQorCiAvKgogICogQ2FsY3VsYXRlIGlu
aXRpYWwgREJ1ZiBzbGljZSBvZmZzZXQsIGJhc2VkIG9uIHNsaWNlIHNpemUKICAqIGFuZCBtYXNr
KGkuZSBpZiBzbGljZSBzaXplIGlzIDEwMjQgYW5kIHNlY29uZCBzbGljZSBpcyBlbmFibGVkCkBA
IC0zODQyLDYgKzM5OTYsMzUgQEAgc3RhdGljIHUxNiBpbnRlbF9nZXRfZGRiX3NpemUoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXJldHVybiBkZGJfc2l6ZTsKIH0KIAorLyoK
KyAqIFRvIGJlIHVzZWQgYWZ0ZXIgd2Ugc3dhcCBzdGF0ZQorICovCitib29sIGludGVsX2Nhbl9l
bmFibGVfc2FndihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit7CisJc3RydWN0
IGludGVsX2dsb2JhbF9zdGF0ZSAqZ2xvYmFsX3N0YXRlOworCXN0cnVjdCBpbnRlbF9id19zdGF0
ZSAqYndfc3RhdGU7CisKKwlnbG9iYWxfc3RhdGUgPSBkZXZfcHJpdi0+Yndfb2JqLnN0YXRlOwor
CWlmIChJU19FUlIoZ2xvYmFsX3N0YXRlKSkgeworCQlXQVJOKDEsICJDb3VsZCBub3QgZ2V0IGds
b2JhbCBzdGF0ZVxuIik7CisJCXJldHVybiBmYWxzZTsKKwl9CisKKwkvKgorCSAqIFRPRE86IFNo
b3VsZCB3ZSBzdGlsbCBtYXkgYmUgbG9jayBnbG9iYWwgc3RhdGUgaGVyZT8KKwkgKi8KKwlid19z
dGF0ZSA9IHRvX2ludGVsX2J3X3N0YXRlKGdsb2JhbF9zdGF0ZSk7CisKKwlpZiAoYndfc3RhdGUt
PnNhZ3ZfY2FsY3VsYXRlZCkKKwkJZ290byBvdXQ7CisKKwlid19zdGF0ZS0+Y2FuX3NhZ3YgPSBp
bnRlbF9jYWxjdWxhdGVfc2Fndl9yZXN1bHQoZGV2X3ByaXYsIGJ3X3N0YXRlKTsKKwlid19zdGF0
ZS0+c2Fndl9jYWxjdWxhdGVkID0gdHJ1ZTsKKworb3V0OgorCXJldHVybiBid19zdGF0ZS0+Y2Fu
X3NhZ3Y7Cit9CisKIHN0YXRpYyB1OCBza2xfY29tcHV0ZV9kYnVmX3NsaWNlcyhjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkgIHUzMiBhY3RpdmVfcGlwZXMp
OwogCkBAIC00MDI4LDYgKzQyMTEsNyBAQCBza2xfY3Vyc29yX2FsbG9jYXRpb24oY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCXUzMiBsYXRlbmN5ID0gZGV2X3By
aXYtPndtLnNrbF9sYXRlbmN5W2xldmVsXTsKIAogCQlza2xfY29tcHV0ZV9wbGFuZV93bShjcnRj
X3N0YXRlLCBsZXZlbCwgbGF0ZW5jeSwgJndwLCAmd20sICZ3bSk7CisKIAkJaWYgKHdtLm1pbl9k
ZGJfYWxsb2MgPT0gVTE2X01BWCkKIAkJCWJyZWFrOwogCkBAIC00NTU0LDEyICs0NzM4LDkyIEBA
IHNrbF9wbGFuZV93bV9sZXZlbChzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCQkgICBpbnQg
bGV2ZWwsCiAJCSAgIGludCBjb2xvcl9wbGFuZSkKIHsKKwlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0
ZSAqc3RhdGUgPSBjcnRjX3N0YXRlLT51YXBpLnN0YXRlOworCXN0cnVjdCBkcm1fY3J0YyAqY3J0
YyA9IGNydGNfc3RhdGUtPnVhcGkuY3J0YzsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGNydGMtPmRldik7CiAJY29uc3Qgc3RydWN0IHNrbF9wbGFuZV93bSAq
d20gPQogCQkmY3J0Y19zdGF0ZS0+d20uc2tsLm9wdGltYWwucGxhbmVzW3BsYW5lLT5pZF07CiAK
KwlpZiAoIWxldmVsKSB7CisJCWJvb2wgY2FuX3NhZ3YgPSBmYWxzZTsKKworCQkvKgorCQkgKiBJ
ZiB3ZSBoYXZlbid0IHlldCBzd2FwcGVkIG91ciBzdGF0ZSwgd2Ugc2hvdWxkIHVzZQorCQkgKiB0
aGUgc3RhdGUgdG8gZGV0ZXJtaW5lIFNBR1YsIG90aGVyd2lzZSB1c2UgZ2xvYmFsCisJCSAqIHN0
YXRlIGFzIGF0b21pYyBzdGF0ZSBwb2ludGVyIG1pZ2h0IGJlY29tZSBzdGFsZQorCQkgKiBhbmQg
emVyb2VkIG91dC4KKwkJICovCisJCWlmIChzdGF0ZSkgeworCQkJc3RydWN0IGludGVsX2F0b21p
Y19zdGF0ZSAqaW50ZWxfc3RhdGUgPQorCQkJCXRvX2ludGVsX2F0b21pY19zdGF0ZShzdGF0ZSk7
CisJCQljYW5fc2FndiA9IGludGVsX2Nhbl9lbmFibGVfc2Fndl9mb3Jfc3RhdGUoaW50ZWxfc3Rh
dGUpOworCQl9IGVsc2UgeworCQkJY2FuX3NhZ3YgPSBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YoZGV2
X3ByaXYpOworCQl9CisKKwkJaWYgKGNhbl9zYWd2KQorCQkJcmV0dXJuIGNvbG9yX3BsYW5lID8g
JndtLT51dl9zYWd2X3dtMCA6ICZ3bS0+c2Fndl93bTA7CisJfQorCiAJcmV0dXJuIGNvbG9yX3Bs
YW5lID8gJndtLT51dl93bVtsZXZlbF0gOiAmd20tPndtW2xldmVsXTsKIH0KIAorc3RhdGljIGlu
dAordGdsX2NoZWNrX3BpcGVfZml0c19zYWd2X3dtKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKQoreworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IGNydGNfc3RhdGUtPnVhcGku
Y3J0YzsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMt
PmRldik7CisJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNy
dGMpOworCXN0cnVjdCBza2xfZGRiX2VudHJ5ICphbGxvYyA9ICZjcnRjX3N0YXRlLT53bS5za2wu
ZGRiOworCXUxNiBhbGxvY19zaXplOworCXU2NCB0b3RhbF9kYXRhX3JhdGU7CisJZW51bSBwbGFu
ZV9pZCBwbGFuZV9pZDsKKwlpbnQgbnVtX2FjdGl2ZTsKKwl1NjQgcGxhbmVfZGF0YV9yYXRlW0k5
MTVfTUFYX1BMQU5FU10gPSB7fTsKKwl1MzIgYmxvY2tzOworCisJLyoKKwkgKiBObyBuZWVkIHRv
IGNoZWNrIGdlbiBoZXJlLCB3ZSBjYWxsIHRoaXMgb25seSBmb3IgZ2VuMTIKKwkgKi8KKwl0b3Rh
bF9kYXRhX3JhdGUgPQorCQlpY2xfZ2V0X3RvdGFsX3JlbGF0aXZlX2RhdGFfcmF0ZShjcnRjX3N0
YXRlLAorCQkJCQkJIHBsYW5lX2RhdGFfcmF0ZSk7CisKKwlza2xfZGRiX2dldF9waXBlX2FsbG9j
YXRpb25fbGltaXRzKGRldl9wcml2LCBjcnRjX3N0YXRlLAorCQkJCQkgICB0b3RhbF9kYXRhX3Jh
dGUsCisJCQkJCSAgIGFsbG9jLCAmbnVtX2FjdGl2ZSk7CisJYWxsb2Nfc2l6ZSA9IHNrbF9kZGJf
ZW50cnlfc2l6ZShhbGxvYyk7CisJaWYgKGFsbG9jX3NpemUgPT0gMCkKKwkJcmV0dXJuIC1FTk9T
UEM7CisKKwkvKgorCSAqIERvIGNoZWNrIGlmIHdlIGNhbiBmaXQgTDAgKyBzYWd2X2Jsb2NrX3Rp
bWUgYW5kCisJICogZGlzYWJsZSBTQUdWIGlmIHdlIGNhbid0LgorCSAqLworCWJsb2NrcyA9IDA7
CisJZm9yX2VhY2hfcGxhbmVfaWRfb25fY3J0YyhpbnRlbF9jcnRjLCBwbGFuZV9pZCkgeworCQkv
KgorCQkgKiBUaGUgb25seSBwbGFjZSwgd2hlcmUgd2UgY2FuJ3QgdXNlIHNrbF9wbGFuZV93bV9s
ZXZlbAorCQkgKiBhY2Nlc3NvciwgYmVjYXVzZSBpZiBhY3R1YWxseSBjYWxscyBpbnRlbF9jYW5f
ZW5hYmxlX3NhZ3YKKwkJICogd2hpY2ggZGVwZW5kcyBvbiB0aGF0IGZ1bmN0aW9uLgorCQkgKi8K
KwkJY29uc3Qgc3RydWN0IHNrbF9wbGFuZV93bSAqd20gPQorCQkJJmNydGNfc3RhdGUtPndtLnNr
bC5vcHRpbWFsLnBsYW5lc1twbGFuZV9pZF07CisKKwkJYmxvY2tzICs9IHdtLT5zYWd2X3dtMC5t
aW5fZGRiX2FsbG9jOworCQlibG9ja3MgKz0gd20tPnV2X3NhZ3Zfd20wLm1pbl9kZGJfYWxsb2M7
CisKKwkJaWYgKGJsb2NrcyA+IGFsbG9jX3NpemUpIHsKKwkJCURSTV9ERUJVR19LTVMoIk5vdCBl
bm91Z2ggZGRiIGJsb2NrcyglZDwlZCkgZm9yIFNBR1Ygb24gcGlwZSAlY1xuIiwKKwkJCQkgICAg
ICBhbGxvY19zaXplLCBibG9ja3MsIHBpcGVfbmFtZShpbnRlbF9jcnRjLT5waXBlKSk7CisJCQly
ZXR1cm4gLUVOT1NQQzsKKwkJfQorCX0KKwlEUk1fREVCVUdfS01TKCIlZCB0b3RhbCBibG9ja3Mg
cmVxdWlyZWQgZm9yIFNBR1YsIGRkYiBlbnRyeSBzaXplICVkXG4iLAorCQkgICAgICBibG9ja3Ms
IGFsbG9jX3NpemUpOworCXJldHVybiAwOworfQorCiBzdGF0aWMgaW50CiBza2xfYWxsb2NhdGVf
cGlwZV9kZGIoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CkBAIC01MTQz
LDExICs1NDA3LDE5IEBAIHN0YXRpYyB2b2lkIHNrbF9jb21wdXRlX3BsYW5lX3dtKGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogc3RhdGljIHZvaWQKIHNrbF9jb21w
dXRlX3dtX2xldmVscyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwK
IAkJICAgICAgY29uc3Qgc3RydWN0IHNrbF93bV9wYXJhbXMgKndtX3BhcmFtcywKLQkJICAgICAg
c3RydWN0IHNrbF93bV9sZXZlbCAqbGV2ZWxzKQorCQkgICAgICBzdHJ1Y3Qgc2tsX3BsYW5lX3dt
ICpwbGFuZV93bSwKKwkJICAgICAgYm9vbCB5dXYpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7CiAJaW50
IGxldmVsLCBtYXhfbGV2ZWwgPSBpbGtfd21fbWF4X2xldmVsKGRldl9wcml2KTsKKwkvKgorCSAq
IENoZWNrIHdoaWNoIGtpbmQgb2YgcGxhbmUgaXMgaXQgYW5kIGJhc2VkIG9uIHRoYXQgY2FsY3Vs
YXRlCisJICogY29ycmVzcG9uZGVudCBXTSBsZXZlbHMuCisJICovCisJc3RydWN0IHNrbF93bV9s
ZXZlbCAqbGV2ZWxzID0geXV2ID8gcGxhbmVfd20tPnV2X3dtIDogcGxhbmVfd20tPndtOwogCXN0
cnVjdCBza2xfd21fbGV2ZWwgKnJlc3VsdF9wcmV2ID0gJmxldmVsc1swXTsKKwlzdHJ1Y3Qgc2ts
X3dtX2xldmVsICpzYWd2X3dtID0geXV2ID8KKwkJCQkmcGxhbmVfd20tPnV2X3NhZ3Zfd20wIDog
JnBsYW5lX3dtLT5zYWd2X3dtMDsKIAogCWZvciAobGV2ZWwgPSAwOyBsZXZlbCA8PSBtYXhfbGV2
ZWw7IGxldmVsKyspIHsKIAkJc3RydWN0IHNrbF93bV9sZXZlbCAqcmVzdWx0ID0gJmxldmVsc1ts
ZXZlbF07CkBAIC01MTU4LDYgKzU0MzAsMjcgQEAgc2tsX2NvbXB1dGVfd21fbGV2ZWxzKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCiAJCXJlc3VsdF9wcmV2ID0g
cmVzdWx0OwogCX0KKwkvKgorCSAqIEZvciBHZW4xMiBpZiBpdCBpcyBhbiBMMCB3ZSBuZWVkIHRv
IGFsc28KKwkgKiBjb25zaWRlciBzYWd2X2Jsb2NrX3RpbWUgd2hlbiBjYWxjdWxhdGluZworCSAq
IEwwIHdhdGVybWFyayAtIHdlIHdpbGwgbmVlZCB0aGF0IHdoZW4gbWFraW5nCisJICogYSBkZWNp
c2lvbiB3aGV0aGVyIGVuYWJsZSBTQUdWIG9yIG5vdC4KKwkgKiBGb3Igb2xkZXIgZ2VucyB3ZSBh
Z3JlZWQgdG8gY29weSBMMCB2YWx1ZSBmb3IKKwkgKiBjb21wYXRpYmlsaXR5LgorCSAqLworCWlm
ICgoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikpIHsKKwkJdTMyIGxhdGVuY3kgPSBkZXZfcHJp
di0+d20uc2tsX2xhdGVuY3lbMF07CisKKwkJbGF0ZW5jeSArPSBkZXZfcHJpdi0+c2Fndl9ibG9j
a190aW1lX3VzOworCQlza2xfY29tcHV0ZV9wbGFuZV93bShjcnRjX3N0YXRlLCAwLCBsYXRlbmN5
LAorCQkJCSAgICAgd21fcGFyYW1zLCAmbGV2ZWxzWzBdLAorCQkJCSAgICAgc2Fndl93bSk7CisJ
CURSTV9ERUJVR19LTVMoIiVkIEwwIGJsb2NrcyByZXF1aXJlZCBmb3IgU0FHViB2cyAlZCBmb3Ig
bm9uLVNBR1ZcbiIsCisJCQkgICAgICBzYWd2X3dtLT5taW5fZGRiX2FsbG9jLCBsZXZlbHNbMF0u
bWluX2RkYl9hbGxvYyk7CisJfSBlbHNlIHsKKwkJLyogU2luY2UgYWxsIG1lbWJlcnMgYXJlIFBP
RCAqLworCQkqc2Fndl93bSA9IGxldmVsc1swXTsKKwl9CiB9CiAKIHN0YXRpYyB2b2lkIHNrbF9j
b21wdXRlX3RyYW5zaXRpb25fd20oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCkBAIC01MjMyLDcgKzU1MjUsNyBAQCBzdGF0aWMgaW50IHNrbF9idWlsZF9wbGFuZV93
bV9zaW5nbGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJaWYgKHJldCkK
IAkJcmV0dXJuIHJldDsKIAotCXNrbF9jb21wdXRlX3dtX2xldmVscyhjcnRjX3N0YXRlLCAmd21f
cGFyYW1zLCB3bS0+d20pOworCXNrbF9jb21wdXRlX3dtX2xldmVscyhjcnRjX3N0YXRlLCAmd21f
cGFyYW1zLCB3bSwgZmFsc2UpOwogCXNrbF9jb21wdXRlX3RyYW5zaXRpb25fd20oY3J0Y19zdGF0
ZSwgJndtX3BhcmFtcywgd20pOwogCiAJcmV0dXJuIDA7CkBAIC01MjU0LDcgKzU1NDcsNyBAQCBz
dGF0aWMgaW50IHNrbF9idWlsZF9wbGFuZV93bV91dihzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSwKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0Jc2tsX2NvbXB1dGVfd21f
bGV2ZWxzKGNydGNfc3RhdGUsICZ3bV9wYXJhbXMsIHdtLT51dl93bSk7CisJc2tsX2NvbXB1dGVf
d21fbGV2ZWxzKGNydGNfc3RhdGUsICZ3bV9wYXJhbXMsIHdtLCB0cnVlKTsKIAogCXJldHVybiAw
OwogfQpAQCAtNTU4NSw5ICs1ODc4LDI0IEBAIHNrbF9wcmludF93bV9jaGFuZ2VzKHN0cnVjdCBp
bnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQlmb3JfZWFjaF9pbnRlbF9wbGFuZV9vbl9jcnRj
KCZkZXZfcHJpdi0+ZHJtLCBjcnRjLCBwbGFuZSkgewogCQkJZW51bSBwbGFuZV9pZCBwbGFuZV9p
ZCA9IHBsYW5lLT5pZDsKIAkJCWNvbnN0IHN0cnVjdCBza2xfcGxhbmVfd20gKm9sZF93bSwgKm5l
d193bTsKKwkJCWNvbnN0IHN0cnVjdCBza2xfd21fbGV2ZWwgKm9sZF93bV9sZXZlbCwgKm5ld193
bV9sZXZlbDsKKwkJCXUxNiBvbGRfcGxhbmVfcmVzX2wsIG5ld19wbGFuZV9yZXNfbDsKKwkJCXU4
ICBvbGRfcGxhbmVfcmVzX2IsIG5ld19wbGFuZV9yZXNfYjsKKwkJCXUxNiBvbGRfbWluX2RkYl9h
bGxvYywgbmV3X21pbl9kZGJfYWxsb2M7CiAKIAkJCW9sZF93bSA9ICZvbGRfcGlwZV93bS0+cGxh
bmVzW3BsYW5lX2lkXTsKIAkJCW5ld193bSA9ICZuZXdfcGlwZV93bS0+cGxhbmVzW3BsYW5lX2lk
XTsKKwkJCW9sZF93bV9sZXZlbCA9IHNrbF9wbGFuZV93bV9sZXZlbChwbGFuZSwgb2xkX2NydGNf
c3RhdGUsIDAsIGZhbHNlKTsKKwkJCW5ld193bV9sZXZlbCA9IHNrbF9wbGFuZV93bV9sZXZlbChw
bGFuZSwgbmV3X2NydGNfc3RhdGUsIDAsIGZhbHNlKTsKKworCQkJb2xkX3BsYW5lX3Jlc19sID0g
b2xkX3dtX2xldmVsLT5wbGFuZV9yZXNfbDsKKwkJCW9sZF9wbGFuZV9yZXNfYiA9IG9sZF93bV9s
ZXZlbC0+cGxhbmVfcmVzX2I7CisKKwkJCW5ld19wbGFuZV9yZXNfbCA9IG5ld193bV9sZXZlbC0+
cGxhbmVfcmVzX2w7CisJCQluZXdfcGxhbmVfcmVzX2IgPSBuZXdfd21fbGV2ZWwtPnBsYW5lX3Jl
c19iOworCisJCQlvbGRfbWluX2RkYl9hbGxvYyA9IG9sZF93bV9sZXZlbC0+bWluX2RkYl9hbGxv
YzsKKwkJCW5ld19taW5fZGRiX2FsbG9jID0gbmV3X3dtX2xldmVsLT5taW5fZGRiX2FsbG9jOwog
CiAJCQlpZiAoc2tsX3BsYW5lX3dtX2VxdWFscyhkZXZfcHJpdiwgb2xkX3dtLCBuZXdfd20pKQog
CQkJCWNvbnRpbnVlOwpAQCAtNTYxMSw3ICs1OTE5LDcgQEAgc2tsX3ByaW50X3dtX2NoYW5nZXMo
c3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCQkJICAgICJbUExBTkU6JWQ6JXNd
ICAgbGluZXMgJWMlM2QsJWMlM2QsJWMlM2QsJWMlM2QsJWMlM2QsJWMlM2QsJWMlM2QsJWMlM2Qs
JWMlM2QiCiAJCQkJICAgICAgIiAtPiAlYyUzZCwlYyUzZCwlYyUzZCwlYyUzZCwlYyUzZCwlYyUz
ZCwlYyUzZCwlYyUzZCwlYyUzZFxuIiwKIAkJCQkgICAgcGxhbmUtPmJhc2UuYmFzZS5pZCwgcGxh
bmUtPmJhc2UubmFtZSwKLQkJCQkgICAgZW5hc3Qob2xkX3dtLT53bVswXS5pZ25vcmVfbGluZXMp
LCBvbGRfd20tPndtWzBdLnBsYW5lX3Jlc19sLAorCQkJCSAgICBlbmFzdChvbGRfd20tPndtWzBd
Lmlnbm9yZV9saW5lcyksIG9sZF9wbGFuZV9yZXNfbCwKIAkJCQkgICAgZW5hc3Qob2xkX3dtLT53
bVsxXS5pZ25vcmVfbGluZXMpLCBvbGRfd20tPndtWzFdLnBsYW5lX3Jlc19sLAogCQkJCSAgICBl
bmFzdChvbGRfd20tPndtWzJdLmlnbm9yZV9saW5lcyksIG9sZF93bS0+d21bMl0ucGxhbmVfcmVz
X2wsCiAJCQkJICAgIGVuYXN0KG9sZF93bS0+d21bM10uaWdub3JlX2xpbmVzKSwgb2xkX3dtLT53
bVszXS5wbGFuZV9yZXNfbCwKQEAgLTU2MjEsNyArNTkyOSw3IEBAIHNrbF9wcmludF93bV9jaGFu
Z2VzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQkJCSAgICBlbmFzdChvbGRf
d20tPndtWzddLmlnbm9yZV9saW5lcyksIG9sZF93bS0+d21bN10ucGxhbmVfcmVzX2wsCiAJCQkJ
ICAgIGVuYXN0KG9sZF93bS0+dHJhbnNfd20uaWdub3JlX2xpbmVzKSwgb2xkX3dtLT50cmFuc193
bS5wbGFuZV9yZXNfbCwKIAotCQkJCSAgICBlbmFzdChuZXdfd20tPndtWzBdLmlnbm9yZV9saW5l
cyksIG5ld193bS0+d21bMF0ucGxhbmVfcmVzX2wsCisJCQkJICAgIGVuYXN0KG5ld193bS0+d21b
MF0uaWdub3JlX2xpbmVzKSwgbmV3X3BsYW5lX3Jlc19sLAogCQkJCSAgICBlbmFzdChuZXdfd20t
PndtWzFdLmlnbm9yZV9saW5lcyksIG5ld193bS0+d21bMV0ucGxhbmVfcmVzX2wsCiAJCQkJICAg
IGVuYXN0KG5ld193bS0+d21bMl0uaWdub3JlX2xpbmVzKSwgbmV3X3dtLT53bVsyXS5wbGFuZV9y
ZXNfbCwKIAkJCQkgICAgZW5hc3QobmV3X3dtLT53bVszXS5pZ25vcmVfbGluZXMpLCBuZXdfd20t
PndtWzNdLnBsYW5lX3Jlc19sLApAQCAtNTYzNSwxMiArNTk0MywxMiBAQCBza2xfcHJpbnRfd21f
Y2hhbmdlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJCQkgICAgIltQTEFO
RTolZDolc10gIGJsb2NrcyAlNGQsJTRkLCU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkLCU0ZCIKIAkJ
CQkgICAgIiAtPiAlNGQsJTRkLCU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkLCU0ZFxuIiwKIAkJCQkg
ICAgcGxhbmUtPmJhc2UuYmFzZS5pZCwgcGxhbmUtPmJhc2UubmFtZSwKLQkJCQkgICAgb2xkX3dt
LT53bVswXS5wbGFuZV9yZXNfYiwgb2xkX3dtLT53bVsxXS5wbGFuZV9yZXNfYiwKKwkJCQkgICAg
b2xkX3BsYW5lX3Jlc19iLCBvbGRfd20tPndtWzFdLnBsYW5lX3Jlc19iLAogCQkJCSAgICBvbGRf
d20tPndtWzJdLnBsYW5lX3Jlc19iLCBvbGRfd20tPndtWzNdLnBsYW5lX3Jlc19iLAogCQkJCSAg
ICBvbGRfd20tPndtWzRdLnBsYW5lX3Jlc19iLCBvbGRfd20tPndtWzVdLnBsYW5lX3Jlc19iLAog
CQkJCSAgICBvbGRfd20tPndtWzZdLnBsYW5lX3Jlc19iLCBvbGRfd20tPndtWzddLnBsYW5lX3Jl
c19iLAogCQkJCSAgICBvbGRfd20tPnRyYW5zX3dtLnBsYW5lX3Jlc19iLAotCQkJCSAgICBuZXdf
d20tPndtWzBdLnBsYW5lX3Jlc19iLCBuZXdfd20tPndtWzFdLnBsYW5lX3Jlc19iLAorCQkJCSAg
ICBuZXdfcGxhbmVfcmVzX2IsIG5ld193bS0+d21bMV0ucGxhbmVfcmVzX2IsCiAJCQkJICAgIG5l
d193bS0+d21bMl0ucGxhbmVfcmVzX2IsIG5ld193bS0+d21bM10ucGxhbmVfcmVzX2IsCiAJCQkJ
ICAgIG5ld193bS0+d21bNF0ucGxhbmVfcmVzX2IsIG5ld193bS0+d21bNV0ucGxhbmVfcmVzX2Is
CiAJCQkJICAgIG5ld193bS0+d21bNl0ucGxhbmVfcmVzX2IsIG5ld193bS0+d21bN10ucGxhbmVf
cmVzX2IsCkBAIC01NjUwLDEyICs1OTU4LDEyIEBAIHNrbF9wcmludF93bV9jaGFuZ2VzKHN0cnVj
dCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQkJCSAgICAiW1BMQU5FOiVkOiVzXSBtaW5f
ZGRiICU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkIgogCQkJCSAgICAiIC0+ICU0
ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkXG4iLAogCQkJCSAgICBwbGFuZS0+YmFz
ZS5iYXNlLmlkLCBwbGFuZS0+YmFzZS5uYW1lLAotCQkJCSAgICBvbGRfd20tPndtWzBdLm1pbl9k
ZGJfYWxsb2MsIG9sZF93bS0+d21bMV0ubWluX2RkYl9hbGxvYywKKwkJCQkgICAgb2xkX21pbl9k
ZGJfYWxsb2MsIG9sZF93bS0+d21bMV0ubWluX2RkYl9hbGxvYywKIAkJCQkgICAgb2xkX3dtLT53
bVsyXS5taW5fZGRiX2FsbG9jLCBvbGRfd20tPndtWzNdLm1pbl9kZGJfYWxsb2MsCiAJCQkJICAg
IG9sZF93bS0+d21bNF0ubWluX2RkYl9hbGxvYywgb2xkX3dtLT53bVs1XS5taW5fZGRiX2FsbG9j
LAogCQkJCSAgICBvbGRfd20tPndtWzZdLm1pbl9kZGJfYWxsb2MsIG9sZF93bS0+d21bN10ubWlu
X2RkYl9hbGxvYywKIAkJCQkgICAgb2xkX3dtLT50cmFuc193bS5taW5fZGRiX2FsbG9jLAotCQkJ
CSAgICBuZXdfd20tPndtWzBdLm1pbl9kZGJfYWxsb2MsIG5ld193bS0+d21bMV0ubWluX2RkYl9h
bGxvYywKKwkJCQkgICAgbmV3X21pbl9kZGJfYWxsb2MsIG5ld193bS0+d21bMV0ubWluX2RkYl9h
bGxvYywKIAkJCQkgICAgbmV3X3dtLT53bVsyXS5taW5fZGRiX2FsbG9jLCBuZXdfd20tPndtWzNd
Lm1pbl9kZGJfYWxsb2MsCiAJCQkJICAgIG5ld193bS0+d21bNF0ubWluX2RkYl9hbGxvYywgbmV3
X3dtLT53bVs1XS5taW5fZGRiX2FsbG9jLAogCQkJCSAgICBuZXdfd20tPndtWzZdLm1pbl9kZGJf
YWxsb2MsIG5ld193bS0+d21bN10ubWluX2RkYl9hbGxvYywKQEAgLTU3NTUsNyArNjA2Myw4IEBA
IHNrbF9kZGJfYWRkX2FmZmVjdGVkX3BpcGVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0
YXRlKQogICogZGVmYXVsdCB2YWx1ZSBvZiB0aGUgd2F0ZXJtYXJrcyByZWdpc3RlcnMgaXMgbm90
IHplcm8uCiAgKi8KIHN0YXRpYyBpbnQgc2tsX3dtX2FkZF9hZmZlY3RlZF9wbGFuZXMoc3RydWN0
IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCi0JCQkJICAgICAgc3RydWN0IGludGVsX2NydGMg
KmNydGMpCisJCQkJICAgICAgc3RydWN0IGludGVsX2NydGMgKmNydGMsCisJCQkJICAgICAgaW50
ICpudW1fYWZmZWN0ZWRfcGxhbmVzKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpvbGRfY3J0Y19zdGF0ZSA9CkBAIC01NzY0LDYgKzYwNzMsOCBAQCBzdGF0aWMgaW50
IHNrbF93bV9hZGRfYWZmZWN0ZWRfcGxhbmVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0
YXRlLAogCQlpbnRlbF9hdG9taWNfZ2V0X25ld19jcnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsKIAlz
dHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOwogCisJKm51bV9hZmZlY3RlZF9wbGFuZXMgPSAwOwor
CiAJZm9yX2VhY2hfaW50ZWxfcGxhbmVfb25fY3J0YygmZGV2X3ByaXYtPmRybSwgY3J0YywgcGxh
bmUpIHsKIAkJc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZTsKIAkJZW51bSBw
bGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKQEAgLTU3ODksMTEgKzYxMDAsNjUgQEAgc3Rh
dGljIGludCBza2xfd21fYWRkX2FmZmVjdGVkX3BsYW5lcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0
YXRlICpzdGF0ZSwKIAkJbmV3X2NydGNfc3RhdGUtPnVwZGF0ZV9wbGFuZXMgfD0gQklUKHBsYW5l
X2lkKTsKIAogCQlzdGF0ZS0+ZGRiX3N0YXRlX2NoYW5nZWQgPSB0cnVlOworCQkqbnVtX2FmZmVj
dGVkX3BsYW5lcyArPSAxOwogCX0KIAogCXJldHVybiAwOwogfQogCitzdGF0aWMgdm9pZCB0Z2xf
Y29tcHV0ZV9zYWd2X21hc2soc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCit7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5k
ZXYpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOworCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpuZXdfY3J0Y19zdGF0ZTsKKwlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3Rh
dGU7CisJaW50IHJldDsKKwlpbnQgaTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOworCXN0
cnVjdCBpbnRlbF9id19zdGF0ZSAqbmV3X2J3X3N0YXRlICA9IGludGVsX2J3X2dldF9zdGF0ZShz
dGF0ZSk7CisKKwlpZiAoSVNfRVJSKG5ld19id19zdGF0ZSkpIHsKKwkJV0FSTigxLCAiQ291bGQg
bm90IGdldCBid19zdGF0ZVxuIik7CisJCXJldHVybjsKKwl9CisKKwlmb3JfZWFjaF9vbGRuZXdf
aW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0Yywgb2xkX2NydGNfc3RhdGUsCisJCQkJCSAg
ICBuZXdfY3J0Y19zdGF0ZSwgaSkgeworCQlpbnQgcGlwZV9iaXQgPSBCSVQoY3J0Yy0+cGlwZSk7
CisJCWJvb2wgc2tpcCA9IHRydWU7CisKKwkJZm9yX2VhY2hfaW50ZWxfcGxhbmVfb25fY3J0Yygm
ZGV2X3ByaXYtPmRybSwgY3J0YywgcGxhbmUpIHsKKwkJCWVudW0gcGxhbmVfaWQgcGxhbmVfaWQg
PSBwbGFuZS0+aWQ7CisJCQljb25zdCBzdHJ1Y3Qgc2tsX3BsYW5lX3dtICpvbGRfd20sICpuZXdf
d207CisJCQlib29sIGVxdWFsX3dtOworCisJCQlvbGRfd20gPSAmb2xkX2NydGNfc3RhdGUtPndt
LnNrbC5vcHRpbWFsLnBsYW5lc1twbGFuZV9pZF07CisJCQluZXdfd20gPSAmbmV3X2NydGNfc3Rh
dGUtPndtLnNrbC5vcHRpbWFsLnBsYW5lc1twbGFuZV9pZF07CisKKwkJCWVxdWFsX3dtID0gc2ts
X3BsYW5lX3dtX2VxdWFscyhkZXZfcHJpdiwgb2xkX3dtLCBuZXdfd20pOworCisJCQlpZiAoIWVx
dWFsX3dtKSB7CisJCQkJc2tpcCA9IGZhbHNlOworCQkJCWJyZWFrOworCQkJfQorCQl9CisKKwkJ
LyoKKwkJICogQ2hlY2sgaWYgd20gbGV2ZWxzIGFyZSBhY3R1YWxseSB0aGUgc2FtZSBhcyBmb3Ig
cHJldmlvdXMKKwkJICogc3RhdGUsIHdoaWNoIG1lYW5zIHdlIGNhbiBqdXN0IHNraXAgZG9pbmcg
dGhpcyBsb25nIGNoZWNrCisJCSAqIGFuZCBqdXN0ICBjb3B5IGNvcnJlc3BvbmRlbnQgYml0IGZy
b20gcHJldmlvdXMgc3RhdGUuCisJCSAqLworCQlpZiAoc2tpcCkKKwkJCWNvbnRpbnVlOworCisJ
CXJldCA9IHRnbF9jaGVja19waXBlX2ZpdHNfc2Fndl93bShuZXdfY3J0Y19zdGF0ZSk7CisJCWlm
ICghcmV0KQorCQkJbmV3X2J3X3N0YXRlLT5waXBlX3NhZ3ZfbWFzayB8PSBwaXBlX2JpdDsKKwkJ
ZWxzZQorCQkJbmV3X2J3X3N0YXRlLT5waXBlX3NhZ3ZfbWFzayAmPSB+cGlwZV9iaXQ7CisJfQor
fQorCiBzdGF0aWMgaW50CiBza2xfY29tcHV0ZV93bShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
ICpzdGF0ZSkKIHsKQEAgLTU4MDEsNiArNjE2Niw3IEBAIHNrbF9jb21wdXRlX3dtKHN0cnVjdCBp
bnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdf
Y3J0Y19zdGF0ZTsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGU7CiAJ
aW50IHJldCwgaTsKKwlpbnQgYWZmZWN0ZWRfcGxhbmVzOyBpbnQgdG90YWxfYWZmZWN0ZWRfcGxh
bmVzID0gMDsKIAogCXJldCA9IHNrbF9kZGJfYWRkX2FmZmVjdGVkX3BpcGVzKHN0YXRlKTsKIAlp
ZiAocmV0KQpAQCAtNTgxNywxMSArNjE4MywxNSBAQCBza2xfY29tcHV0ZV93bShzdHJ1Y3QgaW50
ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJaWYgKHJldCkKIAkJCXJldHVybiByZXQ7CiAKLQkJ
cmV0ID0gc2tsX3dtX2FkZF9hZmZlY3RlZF9wbGFuZXMoc3RhdGUsIGNydGMpOworCQlyZXQgPSBz
a2xfd21fYWRkX2FmZmVjdGVkX3BsYW5lcyhzdGF0ZSwgY3J0YywgJmFmZmVjdGVkX3BsYW5lcyk7
CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0OworCisJCXRvdGFsX2FmZmVjdGVkX3BsYW5lcyAr
PSBhZmZlY3RlZF9wbGFuZXM7CiAJfQogCisJaW50ZWxfY29tcHV0ZV9zYWd2X21hc2soc3RhdGUs
IHRvdGFsX2FmZmVjdGVkX3BsYW5lcyk7CisKIAlyZXQgPSBza2xfY29tcHV0ZV9kZGIoc3RhdGUp
OwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CkBAIC01OTQxLDYgKzYzMTEsOSBAQCB2b2lkIHNr
bF9waXBlX3dtX2dldF9od19zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCQl2YWwg
PSBJOTE1X1JFQUQoQ1VSX1dNKHBpcGUsIGxldmVsKSk7CiAKIAkJCXNrbF93bV9sZXZlbF9mcm9t
X3JlZ192YWwodmFsLCAmd20tPndtW2xldmVsXSk7CisJCQlpZiAobGV2ZWwgPT0gMCkKKwkJCQlt
ZW1jcHkoJndtLT5zYWd2X3dtMCwgJndtLT53bVtsZXZlbF0sCisJCQkJICAgICAgIHNpemVvZihz
dHJ1Y3Qgc2tsX3dtX2xldmVsKSk7CiAJCX0KIAogCQlpZiAocGxhbmVfaWQgIT0gUExBTkVfQ1VS
U09SKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uaCBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmgKaW5kZXggZDYwYTg1NDIxYzVhLi41NjFhMTdhNWQ0
ZTAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmgKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uaApAQCAtNDEsNyArNDEsOSBAQCB2b2lkIHNrbF9w
aXBlX3dtX2dldF9od19zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCSAgICAgIHN0
cnVjdCBza2xfcGlwZV93bSAqb3V0KTsKIHZvaWQgZzR4X3dtX3Nhbml0aXplKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiB2b2lkIHZsdl93bV9zYW5pdGl6ZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotYm9vbCBpbnRlbF9jYW5fZW5hYmxlX3NhZ3Yoc3Ry
dWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpOworYm9vbCBpbnRlbF9jYW5fZW5hYmxlX3Nh
Z3Yoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK2Jvb2wgaW50ZWxfY2FuX2Vu
YWJsZV9zYWd2X2Zvcl9zdGF0ZShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSk7Citi
b29sIGludGVsX2hhc19zYWd2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiBp
bnQgaW50ZWxfZW5hYmxlX3NhZ3Yoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsK
IGludCBpbnRlbF9kaXNhYmxlX3NhZ3Yoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KTsKIGJvb2wgc2tsX3dtX2xldmVsX2VxdWFscyhjb25zdCBzdHJ1Y3Qgc2tsX3dtX2xldmVsICps
MSwKLS0gCjIuMjQuMS40ODUuZ2FkMDVhM2Q4ZTUKCl9fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxp
c3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFu
L2xpc3RpbmZvL2ludGVsLWdmeAo=

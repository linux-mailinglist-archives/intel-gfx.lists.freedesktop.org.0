Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 578B23AF73
	for <lists+intel-gfx@lfdr.de>; Mon, 10 Jun 2019 09:21:36 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5497089100;
	Mon, 10 Jun 2019 07:21:34 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5B0A188FA4
 for <intel-gfx@lists.freedesktop.org>; Mon, 10 Jun 2019 07:21:32 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16848376-1500050 
 for multiple; Mon, 10 Jun 2019 08:21:31 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 10 Jun 2019 08:21:21 +0100
Message-Id: <20190610072126.6355-24-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190610072126.6355-1-chris@chris-wilson.co.uk>
References: <20190610072126.6355-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 23/28] drm/i915: Propagate fence errors
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Matthew Auld <matthew.auld@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RXJyb3JzIHNwcmVhZCBsaWtlIHdpbGRmaXJlLCBhbmQgbXVzdCBldmVudHVhbGx5IGJlIHJldHVy
bmVkIHRvIHRoZQp1c2VyLiBUaGV5IG5lZWQgdG8gYmUgY2FwdHVyZWQgYW5kIHBhc3NlZCBhbG9u
ZyB0aGUgZmxvdyBvZiBmZW5jZXMsCmluZmVjdGluZyBlYWNoIGluIHR1cm4gd2l0aCB0aGUgZXhp
c3RpbmcgZXJyb3IsIHVudGlsIGZpbmFsbHkgdGhleSBmYWxsCm91dCBvZiBhIHVzZXIgdmlzaWJs
ZSByZXN1bHQuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNv
bi5jby51az4KUmV2aWV3ZWQtYnk6IE1hdHRoZXcgQXVsZCA8bWF0dGhldy5hdWxkQGludGVsLmNv
bT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYyAgICAgICAgICAgfCAg
OCArKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N3X2ZlbmNlLmMgICAgICAgICAg
fCAyMyArKysrKysrKysrKysrKystLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N3X2Zl
bmNlLmggICAgICAgICAgfCAgNyArKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9saWJfc3dfZmVuY2UuYyB8ICAxICsKIDQgZmlsZXMgY2hhbmdlZCwgMzQgaW5zZXJ0aW9ucygr
KSwgNSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3JlcXVlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCmluZGV4IGNi
ZGY3MWU4MDYxNi4uNTk1YzI5ZWM1NmI3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3JlcXVlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3Qu
YwpAQCAtNDkwLDYgKzQ5MCwxMCBAQCBzdWJtaXRfbm90aWZ5KHN0cnVjdCBpOTE1X3N3X2ZlbmNl
ICpmZW5jZSwgZW51bSBpOTE1X3N3X2ZlbmNlX25vdGlmeSBzdGF0ZSkKIAlzd2l0Y2ggKHN0YXRl
KSB7CiAJY2FzZSBGRU5DRV9DT01QTEVURToKIAkJdHJhY2VfaTkxNV9yZXF1ZXN0X3N1Ym1pdChy
ZXF1ZXN0KTsKKworCQlpZiAodW5saWtlbHkoZmVuY2UtPmVycm9yKSkKKwkJCWk5MTVfcmVxdWVz
dF9za2lwKHJlcXVlc3QsIGZlbmNlLT5lcnJvcik7CisKIAkJLyoKIAkJICogV2UgbmVlZCB0byBz
ZXJpYWxpemUgdXNlIG9mIHRoZSBzdWJtaXRfcmVxdWVzdCgpIGNhbGxiYWNrCiAJCSAqIHdpdGgg
aXRzIGhvdHBsdWdnaW5nIHBlcmZvcm1lZCBkdXJpbmcgYW4gZW1lcmdlbmN5CkBAIC0xMDQwLDYg
KzEwNDQsOSBAQCB2b2lkIGk5MTVfcmVxdWVzdF9za2lwKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
LCBpbnQgZXJyb3IpCiAJR0VNX0JVR19PTighSVNfRVJSX1ZBTFVFKChsb25nKWVycm9yKSk7CiAJ
ZG1hX2ZlbmNlX3NldF9lcnJvcigmcnEtPmZlbmNlLCBlcnJvcik7CiAKKwlpZiAocnEtPmluZml4
ID09IHJxLT5wb3N0Zml4KQorCQlyZXR1cm47CisKIAkvKgogCSAqIEFzIHRoaXMgcmVxdWVzdCBs
aWtlbHkgZGVwZW5kcyBvbiBzdGF0ZSBmcm9tIHRoZSBsb3N0CiAJICogY29udGV4dCwgY2xlYXIg
b3V0IGFsbCB0aGUgdXNlciBvcGVyYXRpb25zIGxlYXZpbmcgdGhlCkBAIC0xMDUxLDYgKzEwNTgs
NyBAQCB2b2lkIGk5MTVfcmVxdWVzdF9za2lwKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBpbnQg
ZXJyb3IpCiAJCWhlYWQgPSAwOwogCX0KIAltZW1zZXQodmFkZHIgKyBoZWFkLCAwLCBycS0+cG9z
dGZpeCAtIGhlYWQpOworCXJxLT5pbmZpeCA9IHJxLT5wb3N0Zml4OwogfQogCiBzdGF0aWMgc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3N3X2ZlbmNlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N3X2ZlbmNlLmMKaW5kZXgg
NTM4N2FhZmQzNDI0Li5kZWRhY2FmYzk0NDIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfc3dfZmVuY2UuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N3X2Zl
bmNlLmMKQEAgLTE1Nyw4ICsxNTcsMTEgQEAgc3RhdGljIHZvaWQgX19pOTE1X3N3X2ZlbmNlX3dh
a2VfdXBfYWxsKHN0cnVjdCBpOTE1X3N3X2ZlbmNlICpmZW5jZSwKIAkJTElTVF9IRUFEKGV4dHJh
KTsKIAogCQlkbyB7Ci0JCQlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUocG9zLCBuZXh0LCAmeC0+
aGVhZCwgZW50cnkpCi0JCQkJcG9zLT5mdW5jKHBvcywgVEFTS19OT1JNQUwsIDAsICZleHRyYSk7
CisJCQlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUocG9zLCBuZXh0LCAmeC0+aGVhZCwgZW50cnkp
IHsKKwkJCQlwb3MtPmZ1bmMocG9zLAorCQkJCQkgIFRBU0tfTk9STUFMLCBmZW5jZS0+ZXJyb3Is
CisJCQkJCSAgJmV4dHJhKTsKKwkJCX0KIAogCQkJaWYgKGxpc3RfZW1wdHkoJmV4dHJhKSkKIAkJ
CQlicmVhazsKQEAgLTIxOSw2ICsyMjIsOCBAQCB2b2lkIF9faTkxNV9zd19mZW5jZV9pbml0KHN0
cnVjdCBpOTE1X3N3X2ZlbmNlICpmZW5jZSwKIAogCV9faW5pdF93YWl0cXVldWVfaGVhZCgmZmVu
Y2UtPndhaXQsIG5hbWUsIGtleSk7CiAJYXRvbWljX3NldCgmZmVuY2UtPnBlbmRpbmcsIDEpOwor
CWZlbmNlLT5lcnJvciA9IDA7CisKIAlmZW5jZS0+ZmxhZ3MgPSAodW5zaWduZWQgbG9uZylmbjsK
IH0KIApAQCAtMjMwLDYgKzIzNSw4IEBAIHZvaWQgaTkxNV9zd19mZW5jZV9jb21taXQoc3RydWN0
IGk5MTVfc3dfZmVuY2UgKmZlbmNlKQogCiBzdGF0aWMgaW50IGk5MTVfc3dfZmVuY2Vfd2FrZSh3
YWl0X3F1ZXVlX2VudHJ5X3QgKndxLCB1bnNpZ25lZCBtb2RlLCBpbnQgZmxhZ3MsIHZvaWQgKmtl
eSkKIHsKKwlpOTE1X3N3X2ZlbmNlX3NldF9lcnJvcl9vbmNlKHdxLT5wcml2YXRlLCBmbGFncyk7
CisKIAlsaXN0X2RlbCgmd3EtPmVudHJ5KTsKIAlfX2k5MTVfc3dfZmVuY2VfY29tcGxldGUod3Et
PnByaXZhdGUsIGtleSk7CiAKQEAgLTMwMiw4ICszMDksMTAgQEAgc3RhdGljIGludCBfX2k5MTVf
c3dfZmVuY2VfYXdhaXRfc3dfZmVuY2Uoc3RydWN0IGk5MTVfc3dfZmVuY2UgKmZlbmNlLAogCWRl
YnVnX2ZlbmNlX2Fzc2VydChmZW5jZSk7CiAJbWlnaHRfc2xlZXBfaWYoZ2ZwZmxhZ3NfYWxsb3df
YmxvY2tpbmcoZ2ZwKSk7CiAKLQlpZiAoaTkxNV9zd19mZW5jZV9kb25lKHNpZ25hbGVyKSkKKwlp
ZiAoaTkxNV9zd19mZW5jZV9kb25lKHNpZ25hbGVyKSkgeworCQlpOTE1X3N3X2ZlbmNlX3NldF9l
cnJvcl9vbmNlKGZlbmNlLCBzaWduYWxlci0+ZXJyb3IpOwogCQlyZXR1cm4gMDsKKwl9CiAKIAlk
ZWJ1Z19mZW5jZV9hc3NlcnQoc2lnbmFsZXIpOwogCkBAIC0zMTksNiArMzI4LDcgQEAgc3RhdGlj
IGludCBfX2k5MTVfc3dfZmVuY2VfYXdhaXRfc3dfZmVuY2Uoc3RydWN0IGk5MTVfc3dfZmVuY2Ug
KmZlbmNlLAogCQkJCXJldHVybiAtRU5PTUVNOwogCiAJCQlpOTE1X3N3X2ZlbmNlX3dhaXQoc2ln
bmFsZXIpOworCQkJaTkxNV9zd19mZW5jZV9zZXRfZXJyb3Jfb25jZShmZW5jZSwgc2lnbmFsZXIt
PmVycm9yKTsKIAkJCXJldHVybiAwOwogCQl9CiAKQEAgLTMzNyw3ICszNDcsNyBAQCBzdGF0aWMg
aW50IF9faTkxNV9zd19mZW5jZV9hd2FpdF9zd19mZW5jZShzdHJ1Y3QgaTkxNV9zd19mZW5jZSAq
ZmVuY2UsCiAJCV9fYWRkX3dhaXRfcXVldWVfZW50cnlfdGFpbCgmc2lnbmFsZXItPndhaXQsIHdx
KTsKIAkJcGVuZGluZyA9IDE7CiAJfSBlbHNlIHsKLQkJaTkxNV9zd19mZW5jZV93YWtlKHdxLCAw
LCAwLCBOVUxMKTsKKwkJaTkxNV9zd19mZW5jZV93YWtlKHdxLCAwLCBzaWduYWxlci0+ZXJyb3Is
IE5VTEwpOwogCQlwZW5kaW5nID0gMDsKIAl9CiAJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmc2ln
bmFsZXItPndhaXQubG9jaywgZmxhZ3MpOwpAQCAtMzcyLDYgKzM4Miw3IEBAIHN0YXRpYyB2b2lk
IGRtYV9pOTE1X3N3X2ZlbmNlX3dha2Uoc3RydWN0IGRtYV9mZW5jZSAqZG1hLAogewogCXN0cnVj
dCBpOTE1X3N3X2RtYV9mZW5jZV9jYiAqY2IgPSBjb250YWluZXJfb2YoZGF0YSwgdHlwZW9mKCpj
YiksIGJhc2UpOwogCisJaTkxNV9zd19mZW5jZV9zZXRfZXJyb3Jfb25jZShjYi0+ZmVuY2UsIGRt
YS0+ZXJyb3IpOwogCWk5MTVfc3dfZmVuY2VfY29tcGxldGUoY2ItPmZlbmNlKTsKIAlrZnJlZShj
Yik7CiB9CkBAIC0zOTEsNiArNDAyLDcgQEAgc3RhdGljIHZvaWQgdGltZXJfaTkxNV9zd19mZW5j
ZV93YWtlKHN0cnVjdCB0aW1lcl9saXN0ICp0KQogCQkgIGNiLT5kbWEtPnNlcW5vLAogCQkgIGk5
MTVfc3dfZmVuY2VfZGVidWdfaGludChmZW5jZSkpOwogCisJaTkxNV9zd19mZW5jZV9zZXRfZXJy
b3Jfb25jZShmZW5jZSwgLUVUSU1FRE9VVCk7CiAJaTkxNV9zd19mZW5jZV9jb21wbGV0ZShmZW5j
ZSk7CiB9CiAKQEAgLTQ4MCw2ICs0OTIsNyBAQCBzdGF0aWMgdm9pZCBfX2RtYV9pOTE1X3N3X2Zl
bmNlX3dha2Uoc3RydWN0IGRtYV9mZW5jZSAqZG1hLAogewogCXN0cnVjdCBpOTE1X3N3X2RtYV9m
ZW5jZV9jYiAqY2IgPSBjb250YWluZXJfb2YoZGF0YSwgdHlwZW9mKCpjYiksIGJhc2UpOwogCisJ
aTkxNV9zd19mZW5jZV9zZXRfZXJyb3Jfb25jZShjYi0+ZmVuY2UsIGRtYS0+ZXJyb3IpOwogCWk5
MTVfc3dfZmVuY2VfY29tcGxldGUoY2ItPmZlbmNlKTsKIH0KIApAQCAtNTAxLDcgKzUxNCw3IEBA
IGludCBfX2k5MTVfc3dfZmVuY2VfYXdhaXRfZG1hX2ZlbmNlKHN0cnVjdCBpOTE1X3N3X2ZlbmNl
ICpmZW5jZSwKIAlpZiAocmV0ID09IDApIHsKIAkJcmV0ID0gMTsKIAl9IGVsc2UgewotCQlpOTE1
X3N3X2ZlbmNlX2NvbXBsZXRlKGZlbmNlKTsKKwkJX19kbWFfaTkxNV9zd19mZW5jZV93YWtlKGRt
YSwgJmNiLT5iYXNlKTsKIAkJaWYgKHJldCA9PSAtRU5PRU5UKSAvKiBmZW5jZSBhbHJlYWR5IHNp
Z25hbGVkICovCiAJCQlyZXQgPSAwOwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfc3dfZmVuY2UuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3dfZmVuY2Uu
aAppbmRleCA5Y2I1YzNiMzA3YTYuLjUxOGNiYWFkOWJlYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9zd19mZW5jZS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfc3dfZmVuY2UuaApAQCAtMjIsNiArMjIsNyBAQCBzdHJ1Y3QgaTkxNV9zd19mZW5jZSB7CiAJ
d2FpdF9xdWV1ZV9oZWFkX3Qgd2FpdDsKIAl1bnNpZ25lZCBsb25nIGZsYWdzOwogCWF0b21pY190
IHBlbmRpbmc7CisJaW50IGVycm9yOwogfTsKIAogI2RlZmluZSBJOTE1X1NXX0ZFTkNFX0NIRUNL
RURfQklUCTAgLyogdXNlZCBpbnRlcm5hbGx5IGZvciBEQUcgY2hlY2tpbmcgKi8KQEAgLTEwNiw0
ICsxMDcsMTAgQEAgc3RhdGljIGlubGluZSB2b2lkIGk5MTVfc3dfZmVuY2Vfd2FpdChzdHJ1Y3Qg
aTkxNV9zd19mZW5jZSAqZmVuY2UpCiAJd2FpdF9ldmVudChmZW5jZS0+d2FpdCwgaTkxNV9zd19m
ZW5jZV9kb25lKGZlbmNlKSk7CiB9CiAKK3N0YXRpYyBpbmxpbmUgdm9pZAoraTkxNV9zd19mZW5j
ZV9zZXRfZXJyb3Jfb25jZShzdHJ1Y3QgaTkxNV9zd19mZW5jZSAqZmVuY2UsIGludCBlcnJvcikK
K3sKKwljbXB4Y2hnKCZmZW5jZS0+ZXJyb3IsIDAsIGVycm9yKTsKK30KKwogI2VuZGlmIC8qIF9J
OTE1X1NXX0ZFTkNFX0hfICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvbGliX3N3X2ZlbmNlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbGli
X3N3X2ZlbmNlLmMKaW5kZXggYjk3NmMxMjgxN2M1Li4wODBiOTBiNjNkMTYgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9saWJfc3dfZmVuY2UuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbGliX3N3X2ZlbmNlLmMKQEAgLTQwLDYgKzQwLDcg
QEAgdm9pZCBfX29uc3RhY2tfZmVuY2VfaW5pdChzdHJ1Y3QgaTkxNV9zd19mZW5jZSAqZmVuY2Us
CiAKIAlfX2luaXRfd2FpdHF1ZXVlX2hlYWQoJmZlbmNlLT53YWl0LCBuYW1lLCBrZXkpOwogCWF0
b21pY19zZXQoJmZlbmNlLT5wZW5kaW5nLCAxKTsKKwlmZW5jZS0+ZXJyb3IgPSAwOwogCWZlbmNl
LT5mbGFncyA9ICh1bnNpZ25lZCBsb25nKW5vcF9mZW5jZV9ub3RpZnk7CiB9CiAKLS0gCjIuMjAu
MQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwt
Z2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8v
bGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

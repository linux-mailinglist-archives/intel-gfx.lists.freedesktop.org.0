Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 84C60B8F1D
	for <lists+intel-gfx@lfdr.de>; Fri, 20 Sep 2019 13:42:50 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7C3ED6FC9A;
	Fri, 20 Sep 2019 11:42:48 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl
 [IPv6:2a02:2308::216:3eff:fe92:dfa3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4CDCE6FC9E
 for <intel-gfx@lists.freedesktop.org>; Fri, 20 Sep 2019 11:42:42 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 20 Sep 2019 13:42:23 +0200
Message-Id: <20190920114235.22411-11-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190920114235.22411-1-maarten.lankhorst@linux.intel.com>
References: <20190920114235.22411-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 11/23] drm/i915: Try to make bigjoiner work in
 atomic check.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2hlbiB0aGUgY2xvY2sgaXMgaGlnaGVyIHRoYW4gdGhlIGRvdGNsb2NrLCB0cnkgd2l0aCAyIHBp
cGVzIGVuYWJsZWQuCklmIHdlIGNhbiBlbmFibGUgMiwgdGhlbiB3ZSB3aWxsIGdvIGludG8gYmln
IGpvaW5lciBtb2RlLCBhbmQgc3RlYWwKdGhlIGFkamFjZW50IGNydGMuCgpUaGlzIG9ubHkgbGlu
a3MgdGhlIGNydGMncyBpbiBzb2Z0d2FyZSwgbm8gaGFyZHdhcmUgb3IgcGxhbmUKcHJvZ3JhbW1p
bmcgaXMgZG9uZSB5ZXQuIEJsb2JzIGFyZSBhbHNvIGNvcGllZCBmcm9tIHRoZSBtYXN0ZXIncwpj
cnRjX3N0YXRlLCBzbyBpdCBkb2Vzbid0IGRlcGVuZCBhdCBjb21taXQgdGltZSBvbiB0aGUgb3Ro
ZXIKY3J0Y19zdGF0ZS4KClNpZ25lZC1vZmYtYnk6IE1hYXJ0ZW4gTGFua2hvcnN0IDxtYWFydGVu
Lmxhbmtob3JzdEBsaW51eC5pbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9hdG9taWMuYyAgIHwgIDE1ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2F0b21pYy5oICAgfCAgIDMgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGlzcGxheS5jICB8IDE5NyArKysrKysrKysrKysrKysrKy0KIC4uLi9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaCAgICB8ICAxMSArLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jICAgICAgIHwgIDI1ICsrLQogNSBmaWxlcyBjaGFu
Z2VkLCAyMjggaW5zZXJ0aW9ucygrKSwgMjMgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljLmMKaW5kZXggYzUwZTBiMjE4YmQ2Li4wZGIwNDA2
NGM4NmUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRv
bWljLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYwpA
QCAtMjI4LDI1ICsyMjgsMjYgQEAgdm9pZCBpbnRlbF9jcnRjX2ZyZWVfaHdfc3RhdGUoc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJaW50ZWxfY3J0Y19wdXRfY29sb3JfYmxv
YnMoY3J0Y19zdGF0ZSk7CiB9CiAKLXZvaWQgaW50ZWxfY3J0Y19jb3B5X2NvbG9yX2Jsb2JzKHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQordm9pZCBpbnRlbF9jcnRjX2NvcHlf
Y29sb3JfYmxvYnMoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkJIGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpmcm9tX2NydGNfc3RhdGUpCiB7CiAJaW50ZWxf
Y3J0Y19wdXRfY29sb3JfYmxvYnMoY3J0Y19zdGF0ZSk7CiAKLQlpZiAoY3J0Y19zdGF0ZS0+dWFw
aS5kZWdhbW1hX2x1dCkKKwlpZiAoZnJvbV9jcnRjX3N0YXRlLT51YXBpLmRlZ2FtbWFfbHV0KQog
CQljcnRjX3N0YXRlLT5ody5kZWdhbW1hX2x1dCA9Ci0JCQlkcm1fcHJvcGVydHlfYmxvYl9nZXQo
Y3J0Y19zdGF0ZS0+dWFwaS5kZWdhbW1hX2x1dCk7CisJCQlkcm1fcHJvcGVydHlfYmxvYl9nZXQo
ZnJvbV9jcnRjX3N0YXRlLT51YXBpLmRlZ2FtbWFfbHV0KTsKIAllbHNlCiAJCWNydGNfc3RhdGUt
Pmh3LmRlZ2FtbWFfbHV0ID0gTlVMTDsKIAotCWlmIChjcnRjX3N0YXRlLT51YXBpLmdhbW1hX2x1
dCkKKwlpZiAoZnJvbV9jcnRjX3N0YXRlLT51YXBpLmdhbW1hX2x1dCkKIAkJY3J0Y19zdGF0ZS0+
aHcuZ2FtbWFfbHV0ID0KLQkJCWRybV9wcm9wZXJ0eV9ibG9iX2dldChjcnRjX3N0YXRlLT51YXBp
LmdhbW1hX2x1dCk7CisJCQlkcm1fcHJvcGVydHlfYmxvYl9nZXQoZnJvbV9jcnRjX3N0YXRlLT51
YXBpLmdhbW1hX2x1dCk7CiAJZWxzZQogCQljcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQgPSBOVUxM
OwogCi0JaWYgKGNydGNfc3RhdGUtPnVhcGkuY3RtKQorCWlmIChmcm9tX2NydGNfc3RhdGUtPnVh
cGkuY3RtKQogCQljcnRjX3N0YXRlLT5ody5jdG0gPQotCQkJZHJtX3Byb3BlcnR5X2Jsb2JfZ2V0
KGNydGNfc3RhdGUtPnVhcGkuY3RtKTsKKwkJCWRybV9wcm9wZXJ0eV9ibG9iX2dldChmcm9tX2Ny
dGNfc3RhdGUtPnVhcGkuY3RtKTsKIAllbHNlCiAJCWNydGNfc3RhdGUtPmh3LmN0bSA9IE5VTEw7
CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21p
Yy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuaAppbmRleCA0
MmJlOTFlMDc3MmEuLjhkYTg0ZDY0YWEwNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2F0b21pYy5oCkBAIC0zNiw3ICszNiw4IEBAIHN0cnVjdCBkcm1fY3J0Y19zdGF0
ZSAqaW50ZWxfY3J0Y19kdXBsaWNhdGVfc3RhdGUoc3RydWN0IGRybV9jcnRjICpjcnRjKTsKIHZv
aWQgaW50ZWxfY3J0Y19kZXN0cm95X3N0YXRlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAkJCSAg
ICAgICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKnN0YXRlKTsKIHZvaWQgaW50ZWxfY3J0Y19mcmVl
X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKLXZvaWQgaW50
ZWxfY3J0Y19jb3B5X2NvbG9yX2Jsb2JzKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlKTsKK3ZvaWQgaW50ZWxfY3J0Y19jb3B5X2NvbG9yX2Jsb2JzKHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlLAorCQkJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
ZnJvbV9jcnRjX3N0YXRlKTsKIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICppbnRlbF9hdG9taWNf
c3RhdGVfYWxsb2Moc3RydWN0IGRybV9kZXZpY2UgKmRldik7CiB2b2lkIGludGVsX2F0b21pY19z
dGF0ZV9jbGVhcihzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpOwogCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4IGJhNTJhNzA4NDBmZC4u
MTQzZDUzMWM0YzgxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rp
c3BsYXkuYwpAQCAtNzQzNCw3ICs3NDM0LDcgQEAgc3RhdGljIGludCBpbnRlbF9jcnRjX2NvbXB1
dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJCSAgICAgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fZGlz
cGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2Rl
OworCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmln
LT5ody5hZGp1c3RlZF9tb2RlOwogCWludCBjbG9ja19saW1pdCA9IGRldl9wcml2LT5tYXhfZG90
Y2xrX2ZyZXE7CiAKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDQpIHsKQEAgLTc0NTEsNiAr
NzQ1MSwyNSBAQCBzdGF0aWMgaW50IGludGVsX2NydGNfY29tcHV0ZV9jb25maWcoc3RydWN0IGlu
dGVsX2NydGMgKmNydGMsCiAJCX0KIAl9CiAKKwkvKgorCSAqIGNvcHkgaHcgbW9kZSB0byB0cmFu
c2NvZGVyIG1vZGUuCisJICogVGhpcyBtYXR0ZXJzIG1vc3RseSBmb3IgYmlnIGpvaW5lciwgd2hp
Y2ggc3BsaXRzIHRoZSBtb2RlIGluIGhhbGYuCisJICovCisJcGlwZV9jb25maWctPmh3LnRyYW5z
Y29kZXJfbW9kZSA9IHBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOworCWlmIChwaXBlX2Nv
bmZpZy0+Ymlnam9pbmVyKSB7CisJCS8qIE1ha2Ugc3VyZSB0aGUgY3J0YyBjb25maWcgaXMgaGFs
dmVkIGhvcml6b250YWxseSAqLworCQlhZGp1c3RlZF9tb2RlLT5jcnRjX2Nsb2NrIC89IDI7CisJ
CWFkanVzdGVkX21vZGUtPmNydGNfaGRpc3BsYXkgLz0gMjsKKwkJYWRqdXN0ZWRfbW9kZS0+Y3J0
Y19oYmxhbmtfc3RhcnQgLz0gMjsKKwkJYWRqdXN0ZWRfbW9kZS0+Y3J0Y19oYmxhbmtfZW5kIC89
IDI7CisJCWFkanVzdGVkX21vZGUtPmNydGNfaHN5bmNfc3RhcnQgLz0gMjsKKwkJYWRqdXN0ZWRf
bW9kZS0+Y3J0Y19oc3luY19lbmQgLz0gMjsKKwkJYWRqdXN0ZWRfbW9kZS0+Y3J0Y19odG90YWwg
Lz0gMjsKKwkJYWRqdXN0ZWRfbW9kZS0+Y3J0Y19oc2tldyAvPSAyOworCisJCXBpcGVfY29uZmln
LT5waXBlX3NyY193IC89IDI7CisJfQorCiAJaWYgKGFkanVzdGVkX21vZGUtPmNydGNfY2xvY2sg
PiBjbG9ja19saW1pdCkgewogCQlEUk1fREVCVUdfS01TKCJyZXF1ZXN0ZWQgcGl4ZWwgY2xvY2sg
KCVkIGtIeikgdG9vIGhpZ2ggKG1heDogJWQga0h6LCBkb3VibGUgd2lkZTogJXMpXG4iLAogCQkJ
ICAgICAgYWRqdXN0ZWRfbW9kZS0+Y3J0Y19jbG9jaywgY2xvY2tfbGltaXQsCkBAIC04MTMzLDcg
KzgxNTIsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9zZXRfcGlwZV90aW1pbmdzKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwogCWVudW0gcGlwZSBwaXBlID0g
Y3J0Yy0+cGlwZTsKIAllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIgPSBjcnRjX3N0YXRl
LT5jcHVfdHJhbnNjb2RlcjsKLQljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqYWRqdXN0
ZWRfbW9kZSA9ICZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOworCWNvbnN0IHN0cnVjdCBk
cm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJmNydGNfc3RhdGUtPmh3LnRyYW5zY29k
ZXJfbW9kZTsKIAl1MzIgY3J0Y192dG90YWwsIGNydGNfdmJsYW5rX2VuZDsKIAlpbnQgdnN5bmNz
aGlmdCA9IDA7CiAKQEAgLTExNzc0LDYgKzExNzkzLDggQEAgc3RhdGljIGludCBpbnRlbF9jcnRj
X2F0b21pY19jaGVjayhzdHJ1Y3QgZHJtX2NydGMgKl9jcnRjLAogCQl0b19pbnRlbF9jcnRjX3N0
YXRlKF9jcnRjX3N0YXRlKTsKIAlpbnQgcmV0OwogCWJvb2wgbW9kZV9jaGFuZ2VkID0gbmVlZHNf
bW9kZXNldChjcnRjX3N0YXRlKTsKKwlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSA9
CisJCXRvX2ludGVsX2F0b21pY19zdGF0ZShjcnRjX3N0YXRlLT51YXBpLnN0YXRlKTsKIAogCWlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgNSAmJiAhSVNfRzRYKGRldl9wcml2KSAmJgogCSAgICBt
b2RlX2NoYW5nZWQgJiYgIWNydGNfc3RhdGUtPmh3LmFjdGl2ZSkKQEAgLTExNzgxLDYgKzExODAy
LDcgQEAgc3RhdGljIGludCBpbnRlbF9jcnRjX2F0b21pY19jaGVjayhzdHJ1Y3QgZHJtX2NydGMg
Kl9jcnRjLAogCiAJaWYgKG1vZGVfY2hhbmdlZCAmJiBjcnRjX3N0YXRlLT5ody5lbmFibGUgJiYK
IAkgICAgZGV2X3ByaXYtPmRpc3BsYXkuY3J0Y19jb21wdXRlX2Nsb2NrICYmCisJICAgICFjcnRj
X3N0YXRlLT5iaWdqb2luZXJfc2xhdmUgJiYKIAkgICAgIVdBUk5fT04oY3J0Y19zdGF0ZS0+c2hh
cmVkX2RwbGwpKSB7CiAJCXJldCA9IGRldl9wcml2LT5kaXNwbGF5LmNydGNfY29tcHV0ZV9jbG9j
ayhjcnRjLCBjcnRjX3N0YXRlKTsKIAkJaWYgKHJldCkKQEAgLTExNzk2LDggKzExODE4LDE1IEBA
IHN0YXRpYyBpbnQgaW50ZWxfY3J0Y19hdG9taWNfY2hlY2soc3RydWN0IGRybV9jcnRjICpfY3J0
YywKIAogCWlmIChtb2RlX2NoYW5nZWQgfHwgY3J0Y19zdGF0ZS0+dXBkYXRlX3BpcGUgfHwKIAkg
ICAgY3J0Y19zdGF0ZS0+dWFwaS5jb2xvcl9tZ210X2NoYW5nZWQpIHsKKwkJY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKm1hc3Rlcl9jcnRjX3N0YXRlID0gY3J0Y19zdGF0ZTsKKworCQlp
ZiAoY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX3NsYXZlKQorCQkJbWFzdGVyX2NydGNfc3RhdGUgPQor
CQkJCWludGVsX2F0b21pY19nZXRfbmV3X2NydGNfc3RhdGUoc3RhdGUsCisJCQkJCWNydGNfc3Rh
dGUtPmJpZ2pvaW5lcl9saW5rZWRfY3J0Yyk7CisKIAkJLyogQ29weSBjb2xvciBibG9icyB0byBo
dyBzdGF0ZSAqLwotCQlpbnRlbF9jcnRjX2NvcHlfY29sb3JfYmxvYnMoY3J0Y19zdGF0ZSk7CisJ
CWludGVsX2NydGNfY29weV9jb2xvcl9ibG9icyhjcnRjX3N0YXRlLCBtYXN0ZXJfY3J0Y19zdGF0
ZSk7CiAKIAkJcmV0ID0gaW50ZWxfY29sb3JfY2hlY2soY3J0Y19zdGF0ZSk7CiAJCWlmIChyZXQp
CkBAIC0xMjI1OSw3ICsxMjI4OCw0OCBAQCBzdGF0aWMgdm9pZCBjb3B5X2h3X3RvX3VhcGlfc3Rh
dGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJY3J0Y19zdGF0ZS0+dWFw
aS5lbmFibGUgPSBjcnRjX3N0YXRlLT5ody5lbmFibGU7CiAJY3J0Y19zdGF0ZS0+dWFwaS5hY3Rp
dmUgPSBjcnRjX3N0YXRlLT5ody5hY3RpdmU7CiAJY3J0Y19zdGF0ZS0+dWFwaS5tb2RlID0gY3J0
Y19zdGF0ZS0+aHcubW9kZTsKLQljcnRjX3N0YXRlLT51YXBpLmFkanVzdGVkX21vZGUgPSBjcnRj
X3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOworCWNydGNfc3RhdGUtPnVhcGkuYWRqdXN0ZWRfbW9k
ZSA9IGNydGNfc3RhdGUtPmh3LnRyYW5zY29kZXJfbW9kZTsKK30KKworc3RhdGljIGludAorY29w
eV9iaWdqb2luZXJfY3J0Y19zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSwKKwkJCSAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmZyb21fY3J0Y19zdGF0ZSkK
K3sKKwlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqc2F2ZWRfc3RhdGU7CisJc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CisKKwlz
YXZlZF9zdGF0ZSA9IGttZW1kdXAoZnJvbV9jcnRjX3N0YXRlLCBzaXplb2YoKnNhdmVkX3N0YXRl
KSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFzYXZlZF9zdGF0ZSkKKwkJcmV0dXJuIC1FTk9NRU07CisK
KwlzYXZlZF9zdGF0ZS0+dWFwaSA9IGNydGNfc3RhdGUtPnVhcGk7CisJc2F2ZWRfc3RhdGUtPnNj
YWxlcl9zdGF0ZSA9IGNydGNfc3RhdGUtPnNjYWxlcl9zdGF0ZTsKKwlzYXZlZF9zdGF0ZS0+c2hh
cmVkX2RwbGwgPSBjcnRjX3N0YXRlLT5zaGFyZWRfZHBsbDsKKwlzYXZlZF9zdGF0ZS0+ZHBsbF9o
d19zdGF0ZSA9IGNydGNfc3RhdGUtPmRwbGxfaHdfc3RhdGU7CisJc2F2ZWRfc3RhdGUtPmNyY19l
bmFibGVkID0gY3J0Y19zdGF0ZS0+Y3JjX2VuYWJsZWQ7CisKKwlpbnRlbF9jcnRjX2ZyZWVfaHdf
c3RhdGUoY3J0Y19zdGF0ZSk7CisJbWVtY3B5KGNydGNfc3RhdGUsIHNhdmVkX3N0YXRlLCBzaXpl
b2YoKmNydGNfc3RhdGUpKTsKKwlrZnJlZShzYXZlZF9zdGF0ZSk7CisKKwkvKiBSZS1pbml0IGh3
IHN0YXRlICovCisJbWVtc2V0KCZjcnRjX3N0YXRlLT5odywgMCwgc2l6ZW9mKHNhdmVkX3N0YXRl
LT5odykpOworCWNydGNfc3RhdGUtPmh3LmVuYWJsZSA9IGZyb21fY3J0Y19zdGF0ZS0+aHcuZW5h
YmxlOworCWNydGNfc3RhdGUtPmh3LmFjdGl2ZSA9IGZyb21fY3J0Y19zdGF0ZS0+aHcuYWN0aXZl
OworCWNydGNfc3RhdGUtPmh3Lm1vZGUgPSBmcm9tX2NydGNfc3RhdGUtPmh3Lm1vZGU7CisJY3J0
Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZSA9IGZyb21fY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRf
bW9kZTsKKworCS8qIFNvbWUgZml4dXBzICovCisJY3J0Y19zdGF0ZS0+dWFwaS5tb2RlX2NoYW5n
ZWQgPSBmcm9tX2NydGNfc3RhdGUtPnVhcGkubW9kZV9jaGFuZ2VkOworCWNydGNfc3RhdGUtPnVh
cGkuY29ubmVjdG9yc19jaGFuZ2VkID0gZnJvbV9jcnRjX3N0YXRlLT51YXBpLmNvbm5lY3RvcnNf
Y2hhbmdlZDsKKwljcnRjX3N0YXRlLT51YXBpLmFjdGl2ZV9jaGFuZ2VkID0gZnJvbV9jcnRjX3N0
YXRlLT51YXBpLmFjdGl2ZV9jaGFuZ2VkOworCWNydGNfc3RhdGUtPm52MTJfcGxhbmVzID0gY3J0
Y19zdGF0ZS0+YzhfcGxhbmVzID0gY3J0Y19zdGF0ZS0+dXBkYXRlX3BsYW5lcyA9IDA7CisJY3J0
Y19zdGF0ZS0+Ymlnam9pbmVyX2xpbmtlZF9jcnRjID0gdG9faW50ZWxfY3J0Yyhmcm9tX2NydGNf
c3RhdGUtPnVhcGkuY3J0Yyk7CisJY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX3NsYXZlID0gdHJ1ZTsK
KwljcnRjX3N0YXRlLT5jcHVfdHJhbnNjb2RlciA9IChlbnVtIHRyYW5zY29kZXIpY3J0Yy0+cGlw
ZTsKKwljcnRjX3N0YXRlLT5oYXNfYXVkaW8gPSBmYWxzZTsKKworCXJldHVybiAwOwogfQogCiBz
dGF0aWMgaW50CkBAIC0xMjQzMiw3ICsxMjUwMiw3IEBAIGludGVsX21vZGVzZXRfcGlwZV9jb25m
aWcoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQogCQkgICAgICBiYXNlX2Jw
cCwgcGlwZV9jb25maWctPnBpcGVfYnBwLCBwaXBlX2NvbmZpZy0+ZGl0aGVyKTsKIAogCS8qIHVh
cGkgd2FudHMgYSBjb3B5IG9mIHRoZSBhZGp1c3RlZF9tb2RlIGZvciB2YmxhbmsgYm9va2tlZXBp
bmcgKi8KLQlwaXBlX2NvbmZpZy0+dWFwaS5hZGp1c3RlZF9tb2RlID0gcGlwZV9jb25maWctPmh3
LmFkanVzdGVkX21vZGU7CisJcGlwZV9jb25maWctPnVhcGkuYWRqdXN0ZWRfbW9kZSA9IHBpcGVf
Y29uZmlnLT5ody50cmFuc2NvZGVyX21vZGU7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTEzNTQ5LDYg
KzEzNjE5LDEwOSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9jcnRjX2NoZWNrX2Zhc3RzZXQoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YQogCW5ld19jcnRjX3N0YXRlLT5o
YXNfZHJycyA9IG9sZF9jcnRjX3N0YXRlLT5oYXNfZHJyczsKIH0KIAorc3RhdGljIGludCBpbnRl
bF9hdG9taWNfY2hlY2tfYmlnam9pbmVyKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRl
KQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoc3RhdGUt
PmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUsICpu
ZXdfY3J0Y19zdGF0ZSwgKnNsYXZlX2NydGNfc3RhdGUsICptYXN0ZXJfY3J0Y19zdGF0ZTsKKwlz
dHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywgKnNsYXZlLCAqbWFzdGVyOworCWludCBpLCByZXQgPSAw
OworCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMSkKKwkJcmV0dXJuIDA7CisKKwlmb3Jf
ZWFjaF9vbGRuZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0Yywgb2xkX2NydGNfc3Rh
dGUsCisJCQkJCSAgICBuZXdfY3J0Y19zdGF0ZSwgaSkgeworCQlpZiAoIW9sZF9jcnRjX3N0YXRl
LT5iaWdqb2luZXJfc2xhdmUpCisJCQljb250aW51ZTsKKworCQlpZiAoY3J0Yy0+cGlwZSA9PSBQ
SVBFX0EpIHsKKwkJCURSTV9FUlJPUigiQmlnam9pbmVyIHNsYXZlIG9uIHBpcGUgQT9cbiIpOwor
CQkJcmV0dXJuIC1FSU5WQUw7CisJCX0KKworCQkvKiBjcnRjIHN0YXlpbmcgaW4gc2xhdmUgbW9k
ZT8gKi8KKwkJaWYgKCFuZXdfY3J0Y19zdGF0ZS0+dWFwaS5lbmFibGUpCisJCQljb250aW51ZTsK
KworCQlpZiAobmVlZHNfbW9kZXNldChuZXdfY3J0Y19zdGF0ZSkgfHwgbmV3X2NydGNfc3RhdGUt
PnVwZGF0ZV9waXBlKSB7CisJCQltYXN0ZXIgPSBvbGRfY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX2xp
bmtlZF9jcnRjOworCQkJbWFzdGVyX2NydGNfc3RhdGUgPSBpbnRlbF9hdG9taWNfZ2V0X2NydGNf
c3RhdGUoJnN0YXRlLT5iYXNlLCBtYXN0ZXIpOworCQkJaWYgKElTX0VSUihtYXN0ZXJfY3J0Y19z
dGF0ZSkpCisJCQkJcmV0dXJuIFBUUl9FUlIobWFzdGVyX2NydGNfc3RhdGUpOworCisJCQkvKgor
CQkJICogRm9yY2UgbW9kZXNldCBvbiBtYXN0ZXIsIHRvIHJlY2FsY3VsYXRlIGJpZ2pvaW5lcgor
CQkJICogc3RhdGUuCisJCQkgKgorCQkJICogSWYgbWFzdGVyX2NydGNfc3RhdGUgd2FzIG5vdCBw
YXJ0IG9mIHRoZSBhdG9taWMgY29tbWl0LAorCQkJICogd2Ugd2lsbCBmYWlsIGJlY2F1c2UgdGhl
IG1hc3RlciB3YXMgbm90IGRlY29uZmlndXJlZCwKKwkJCSAqIGJ1dCBhdCBsZWFzdCBmYWlsIGJl
bG93IHRvIHVuaWZ5IHRoZSBjaGVja3MuCisJCQkgKi8KKwkJCW1hc3Rlcl9jcnRjX3N0YXRlLT51
YXBpLm1vZGVfY2hhbmdlZCA9IHRydWU7CisKKwkJCXJldCA9IGRybV9hdG9taWNfYWRkX2FmZmVj
dGVkX3BsYW5lcygmc3RhdGUtPmJhc2UsICZjcnRjLT5iYXNlKTsKKwkJCWlmIChyZXQpCisJCQkJ
cmV0dXJuIHJldDsKKworCQkJcmV0ID0gZHJtX2F0b21pY19hZGRfYWZmZWN0ZWRfY29ubmVjdG9y
cygmc3RhdGUtPmJhc2UsICZjcnRjLT5iYXNlKTsKKwkJCWlmIChyZXQpCisJCQkJcmV0dXJuIHJl
dDsKKwkJfQorCX0KKworCWZvcl9lYWNoX29sZG5ld19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRl
LCBjcnRjLCBvbGRfY3J0Y19zdGF0ZSwKKwkJCQkJICAgIG5ld19jcnRjX3N0YXRlLCBpKSB7CisJ
CWlmICghbmV3X2NydGNfc3RhdGUtPnVhcGkuZW5hYmxlIHx8ICFuZXdfY3J0Y19zdGF0ZS0+Ymln
am9pbmVyKSB7CisJCQlpZiAoIW9sZF9jcnRjX3N0YXRlLT5iaWdqb2luZXIpCisJCQkJY29udGlu
dWU7CisJCX0KKworCQlpZiAoIW5lZWRzX21vZGVzZXQobmV3X2NydGNfc3RhdGUpICYmICFuZXdf
Y3J0Y19zdGF0ZS0+dXBkYXRlX3BpcGUpCisJCQljb250aW51ZTsKKworCQlpZiAobmV3X2NydGNf
c3RhdGUtPmJpZ2pvaW5lciAmJiAhbmV3X2NydGNfc3RhdGUtPmJpZ2pvaW5lcl9zbGF2ZSkgewor
CQkJaWYgKDEgKyBjcnRjLT5waXBlID49IElOVEVMX05VTV9QSVBFUyhkZXZfcHJpdikpIHsKKwkJ
CQlEUk1fREVCVUdfS01TKCJCaWcgam9pbmVyIGNvbmZpZ3VyYXRpb24gcmVxdWlyZXMgQ1JUQyAr
IDEgdG8gYmUgdXNlZCwgZG9lc24ndCBleGlzdFxuIik7CisJCQkJcmV0dXJuIC1FSU5WQUw7CisJ
CQl9CisKKwkJCXNsYXZlID0gbmV3X2NydGNfc3RhdGUtPmJpZ2pvaW5lcl9saW5rZWRfY3J0YyA9
CisJCQkJaW50ZWxfZ2V0X2NydGNfZm9yX3BpcGUoZGV2X3ByaXYsIGNydGMtPnBpcGUgKyAxKTsK
KwkJCXNsYXZlX2NydGNfc3RhdGUgPSBpbnRlbF9hdG9taWNfZ2V0X2NydGNfc3RhdGUoJnN0YXRl
LT5iYXNlLCBzbGF2ZSk7CisJCQlpZiAoSVNfRVJSKHNsYXZlX2NydGNfc3RhdGUpKQorCQkJCXJl
dHVybiBQVFJfRVJSKHNsYXZlX2NydGNfc3RhdGUpOworCisJCQlpZiAoc2xhdmVfY3J0Y19zdGF0
ZS0+dWFwaS5lbmFibGUpIHsKKwkJCQlEUk1fREVCVUdfS01TKCJbQ1JUQzolZDolc10gQmlnIGpv
aW5lciBjb25maWd1cmF0aW9uIHJlcXVpcmVzIHRoaXMgQ1JUQyB0byBiZSB1bmNvbmZpZ3VyZWRc
biIsCisJCQkJCSAgICAgIHNsYXZlLT5iYXNlLmJhc2UuaWQsIHNsYXZlLT5iYXNlLm5hbWUpOwor
CQkJCXJldHVybiAtRUlOVkFMOworCQkJfSBlbHNlIHsKKwkJCQlEUk1fREVCVUdfS01TKCJbQ1JU
QzolZDolc10gVXNlZCBhcyBzbGF2ZSBmb3IgYmlnIGpvaW5lclxuIiwKKwkJCQkJICAgICAgc2xh
dmUtPmJhc2UuYmFzZS5pZCwgc2xhdmUtPmJhc2UubmFtZSk7CisJCQkJcmV0ID0gY29weV9iaWdq
b2luZXJfY3J0Y19zdGF0ZShzbGF2ZV9jcnRjX3N0YXRlLCBuZXdfY3J0Y19zdGF0ZSk7CisJCQl9
CisJCX0gZWxzZSB7CisJCQltYXN0ZXIgPSBuZXdfY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX2xpbmtl
ZF9jcnRjOworCQkJaWYgKCFtYXN0ZXIpCisJCQkJY29udGludWU7CisKKwkJCW1hc3Rlcl9jcnRj
X3N0YXRlID0gaW50ZWxfYXRvbWljX2dldF9jcnRjX3N0YXRlKCZzdGF0ZS0+YmFzZSwgbWFzdGVy
KTsKKwkJCWlmIChJU19FUlIobWFzdGVyX2NydGNfc3RhdGUpKQorCQkJCXJldHVybiBQVFJfRVJS
KG1hc3Rlcl9jcnRjX3N0YXRlKTsKKworCQkJaWYgKCFtYXN0ZXJfY3J0Y19zdGF0ZS0+dWFwaS5l
bmFibGUgJiYgIW5ld19jcnRjX3N0YXRlLT51YXBpLmVuYWJsZSkgeworCQkJCURSTV9ERUJVR19L
TVMoIltDUlRDOiVkOiVzXSBEaXNhYmxpbmcgc2xhdmUgZnJvbSBiaWcgam9pbmVyXG4iLAorCQkJ
CQkgICAgICBjcnRjLT5iYXNlLmJhc2UuaWQsIGNydGMtPmJhc2UubmFtZSk7CisJCQkJcmV0ID0g
Y2xlYXJfaW50ZWxfY3J0Y19zdGF0ZShuZXdfY3J0Y19zdGF0ZSk7CisJCQl9CisJCX0KKwkJaWYg
KHJldCkKKwkJCXJldHVybiByZXQ7CisJfQorCisJcmV0dXJuIDA7Cit9CisKIC8qKgogICogaW50
ZWxfYXRvbWljX2NoZWNrIC0gdmFsaWRhdGUgc3RhdGUgb2JqZWN0CiAgKiBAZGV2OiBkcm0gZGV2
aWNlCkBAIC0xMzU4Myw3ICsxMzc1NiwxMCBAQCBzdGF0aWMgaW50IGludGVsX2F0b21pY19jaGVj
ayhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCiAJCWlmICghbmV3X2NydGNfc3RhdGUtPnVhcGku
ZW5hYmxlKSB7CiAJCQlhbnlfbXMgPSB0cnVlOwotCQkJY2xlYXJfaW50ZWxfY3J0Y19zdGF0ZShu
ZXdfY3J0Y19zdGF0ZSk7CisKKwkJCS8qIGJpZyBqb2luZXIgc2xhdmUgaXMgY2xlYXJlZCBpbiBp
bnRlbF9hdG9taWNfY2hlY2tfYmlnam9pbmVyKCkgKi8KKwkJCWlmICghbmV3X2NydGNfc3RhdGUt
PmJpZ2pvaW5lcl9zbGF2ZSkKKwkJCQljbGVhcl9pbnRlbF9jcnRjX3N0YXRlKG5ld19jcnRjX3N0
YXRlKTsKIAkJCWNvbnRpbnVlOwogCQl9CiAKQEAgLTEzNTk3LDYgKzEzNzczLDEwIEBAIHN0YXRp
YyBpbnQgaW50ZWxfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCQlhbnlf
bXMgPSB0cnVlOwogCX0KIAorCXJldCA9IGludGVsX2F0b21pY19jaGVja19iaWdqb2luZXIoc3Rh
dGUpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKIAlyZXQgPSBkcm1fZHBfbXN0X2F0b21p
Y19jaGVjaygmc3RhdGUtPmJhc2UpOwogCWlmIChyZXQpCiAJCWdvdG8gZmFpbDsKQEAgLTEzNzQ3
LDcgKzEzOTI3LDkgQEAgc3RhdGljIHZvaWQgaW50ZWxfdXBkYXRlX2NydGMoc3RydWN0IGludGVs
X2NydGMgKmNydGMsCiAKIAljb21taXRfcGlwZV9jb25maWcoc3RhdGUsIG9sZF9jcnRjX3N0YXRl
LCBuZXdfY3J0Y19zdGF0ZSk7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5KQorCWlm
IChuZXdfY3J0Y19zdGF0ZS0+Ymlnam9pbmVyKQorCQl7LyogTm90IHN1cHBvcnRlZCB5ZXQgKi99
CisJZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5KQogCQlza2xfdXBkYXRlX3BsYW5l
c19vbl9jcnRjKHN0YXRlLCBjcnRjKTsKIAllbHNlCiAJCWk5eHhfdXBkYXRlX3BsYW5lc19vbl9j
cnRjKHN0YXRlLCBjcnRjKTsKQEAgLTE2ODQ2LDcgKzE3MDI4LDYgQEAgc3RhdGljIHZvaWQgaW50
ZWxfbW9kZXNldF9yZWFkb3V0X2h3X3N0YXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJCX0K
IAogCQlpbnRlbF9id19jcnRjX3VwZGF0ZShid19zdGF0ZSwgY3J0Y19zdGF0ZSk7Ci0KIAkJY29w
eV9od190b191YXBpX3N0YXRlKGNydGNfc3RhdGUpOwogCQlpbnRlbF9waXBlX2NvbmZpZ19zYW5p
dHlfY2hlY2soZGV2X3ByaXYsIGNydGNfc3RhdGUpOwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKaW5kZXggMzk0Zjg0ZTVkNTgz
Li5kZDAzMjlhNGI5ZmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGlzcGxheV90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGlzcGxheV90eXBlcy5oCkBAIC03NzQsNyArNzc0LDcgQEAgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgewogCXN0cnVjdCB7CiAJCWJvb2wgYWN0aXZlLCBlbmFibGU7CiAJCXN0cnVjdCBk
cm1fcHJvcGVydHlfYmxvYiAqZGVnYW1tYV9sdXQsICpnYW1tYV9sdXQsICpjdG07Ci0JCXN0cnVj
dCBkcm1fZGlzcGxheV9tb2RlIG1vZGUsIGFkanVzdGVkX21vZGU7CisJCXN0cnVjdCBkcm1fZGlz
cGxheV9tb2RlIG1vZGUsIGFkanVzdGVkX21vZGUsIHRyYW5zY29kZXJfbW9kZTsKIAl9IGh3Owog
CiAJLyoqCkBAIC0xMDA1LDYgKzEwMDUsMTUgQEAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgewog
CS8qIGVuYWJsZSBwaXBlIGNzYz8gKi8KIAlib29sIGNzY19lbmFibGU7CiAKKwkvKiBlbmFibGUg
cGlwZSBiaWcgam9pbmVyPyAqLworCWJvb2wgYmlnam9pbmVyOworCisJLyogYmlnIGpvaW5lciBz
bGF2ZSBjcnRjPyAqLworCWJvb2wgYmlnam9pbmVyX3NsYXZlOworCisJLyogbGlua2VkIGNydGMg
Zm9yIGJpZ2pvaW5lciwgZWl0aGVyIHNsYXZlIG9yIG1hc3RlciAqLworCXN0cnVjdCBpbnRlbF9j
cnRjICpiaWdqb2luZXJfbGlua2VkX2NydGM7CisKIAkvKiBEaXNwbGF5IFN0cmVhbSBjb21wcmVz
c2lvbiBzdGF0ZSAqLwogCXN0cnVjdCB7CiAJCWJvb2wgY29tcHJlc3Npb25fZW5hYmxlOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCmluZGV4IDA0NmUxNjYyZDFlMy4uM2Q0
ODdjZTE2MTUxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2RwLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCkBAIC0y
MTA1LDYgKzIxMDUsMTkgQEAgc3RhdGljIGludCBpbnRlbF9kcF9kc2NfY29tcHV0ZV9jb25maWco
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAlwaXBlX2NvbmZpZy0+cG9ydF9jbG9jayA9IGlu
dGVsX2RwLT5jb21tb25fcmF0ZXNbbGltaXRzLT5tYXhfY2xvY2tdOwogCXBpcGVfY29uZmlnLT5s
YW5lX2NvdW50ID0gbGltaXRzLT5tYXhfbGFuZV9jb3VudDsKIAorCWlmIChhZGp1c3RlZF9tb2Rl
LT5jcnRjX2Nsb2NrID4gaW50ZWxfZHBfZG93bnN0cmVhbV9tYXhfZG90Y2xvY2soaW50ZWxfZHAs
IGZhbHNlKSkgeworCQlpZiAoYWRqdXN0ZWRfbW9kZS0+Y3J0Y19jbG9jayA+IGludGVsX2RwX2Rv
d25zdHJlYW1fbWF4X2RvdGNsb2NrKGludGVsX2RwLCB0cnVlKSkgeworCQkJRFJNX0RFQlVHX0tN
UygiQ2xvY2sgcmF0ZSB0b28gaGlnaCBmb3IgYmlnIGpvaW5lclxuIik7CisJCQlyZXR1cm4gLUVJ
TlZBTDsKKwkJfQorCQlpZiAoaW50ZWxfZHBfaXNfZWRwKGludGVsX2RwKSkgeworCQkJRFJNX0RF
QlVHX0tNUygiQ2Fubm90IHNwbGl0IGVEUCBzdHJlYW0gaW4gYmlnam9pbmVyIGNvbmZpZ3VyYXRp
b24uXG4iKTsKKwkJCXJldHVybiAtRUlOVkFMOworCQl9CisJCXBpcGVfY29uZmlnLT5iaWdqb2lu
ZXIgPSB0cnVlOworCQlEUk1fREVCVUdfS01TKCJVc2luZyBiaWdqb2luZXIgY29uZmlndXJhdGlv
blxuIik7CisJfQorCiAJaWYgKGludGVsX2RwX2lzX2VkcChpbnRlbF9kcCkpIHsKIAkJcGlwZV9j
b25maWctPmRzY19wYXJhbXMuY29tcHJlc3NlZF9icHAgPQogCQkJbWluX3QodTE2LCBkcm1fZWRw
X2RzY19zaW5rX291dHB1dF9icHAoaW50ZWxfZHAtPmRzY19kcGNkKSA+PiA0LApAQCAtMjEyMiwx
MiArMjEzNSwxMiBAQCBzdGF0aWMgaW50IGludGVsX2RwX2RzY19jb21wdXRlX2NvbmZpZyhzdHJ1
Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCQkJCQkJICAgIHBpcGVfY29uZmlnLT5sYW5lX2NvdW50
LAogCQkJCQkJICAgIGFkanVzdGVkX21vZGUtPmNydGNfY2xvY2ssCiAJCQkJCQkgICAgYWRqdXN0
ZWRfbW9kZS0+Y3J0Y19oZGlzcGxheSwKLQkJCQkJCSAgICBmYWxzZSk7CisJCQkJCQkgICAgcGlw
ZV9jb25maWctPmJpZ2pvaW5lcik7CiAJCWRzY19kcF9zbGljZV9jb3VudCA9CiAJCQlpbnRlbF9k
cF9kc2NfZ2V0X3NsaWNlX2NvdW50KGludGVsX2RwLAogCQkJCQkJICAgICBhZGp1c3RlZF9tb2Rl
LT5jcnRjX2Nsb2NrLAogCQkJCQkJICAgICBhZGp1c3RlZF9tb2RlLT5jcnRjX2hkaXNwbGF5LAot
CQkJCQkJICAgICBmYWxzZSk7CisJCQkJCQkgICAgIHBpcGVfY29uZmlnLT5iaWdqb2luZXIpOwog
CQlpZiAoIWRzY19tYXhfb3V0cHV0X2JwcCB8fCAhZHNjX2RwX3NsaWNlX2NvdW50KSB7CiAJCQlE
Uk1fREVCVUdfS01TKCJDb21wcmVzc2VkIEJQUC9TbGljZSBDb3VudCBub3Qgc3VwcG9ydGVkXG4i
KTsKIAkJCXJldHVybiAtRUlOVkFMOwpAQCAtMjE0MiwxMyArMjE1NSwxMyBAQCBzdGF0aWMgaW50
IGludGVsX2RwX2RzY19jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAog
CSAqIGlzIGdyZWF0ZXIgdGhhbiB0aGUgbWF4aW11bSBDZGNsb2NrIGFuZCBpZiBzbGljZSBjb3Vu
dCBpcyBldmVuCiAJICogdGhlbiB3ZSBuZWVkIHRvIHVzZSAyIFZEU0MgaW5zdGFuY2VzLgogCSAq
LwotCWlmIChhZGp1c3RlZF9tb2RlLT5jcnRjX2Nsb2NrID4gZGV2X3ByaXYtPm1heF9jZGNsa19m
cmVxKSB7Ci0JCWlmIChwaXBlX2NvbmZpZy0+ZHNjX3BhcmFtcy5zbGljZV9jb3VudCA+IDEpIHsK
LQkJCXBpcGVfY29uZmlnLT5kc2NfcGFyYW1zLmRzY19zcGxpdCA9IHRydWU7Ci0JCX0gZWxzZSB7
CisJaWYgKGFkanVzdGVkX21vZGUtPmNydGNfY2xvY2sgPiBkZXZfcHJpdi0+bWF4X2NkY2xrX2Zy
ZXEgfHwgcGlwZV9jb25maWctPmJpZ2pvaW5lcikgeworCQlpZiAocGlwZV9jb25maWctPmRzY19w
YXJhbXMuc2xpY2VfY291bnQgPCAyKSB7CiAJCQlEUk1fREVCVUdfS01TKCJDYW5ub3Qgc3BsaXQg
c3RyZWFtIHRvIHVzZSAyIFZEU0MgaW5zdGFuY2VzXG4iKTsKIAkJCXJldHVybiAtRUlOVkFMOwog
CQl9CisKKwkJcGlwZV9jb25maWctPmRzY19wYXJhbXMuZHNjX3NwbGl0ID0gdHJ1ZTsKIAl9CiAK
IAlyZXQgPSBpbnRlbF9kcF9jb21wdXRlX2RzY19wYXJhbXMoaW50ZWxfZHAsIHBpcGVfY29uZmln
KTsKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Au
b3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwt
Z2Z4

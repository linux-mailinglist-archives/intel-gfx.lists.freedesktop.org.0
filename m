Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id B1BF3C9F8D
	for <lists+intel-gfx@lfdr.de>; Thu,  3 Oct 2019 15:36:08 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9E8F689A92;
	Thu,  3 Oct 2019 13:36:06 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5A3A589B30
 for <intel-gfx@lists.freedesktop.org>; Thu,  3 Oct 2019 13:36:03 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18707863-1500050 
 for multiple; Thu, 03 Oct 2019 14:35:51 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  3 Oct 2019 14:35:49 +0100
Message-Id: <20191003133549.10305-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191003093639.10186-17-chris@chris-wilson.co.uk>
References: <20191003093639.10186-17-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: Move context management under GEM
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

S2VlcCB0cmFjayBvZiB0aGUgR0VNIGNvbnRleHRzIHVuZGVybmVhdGggaTkxNS0+Z2VtLmNvbnRl
eHRzIGFuZCBhc3NpZ24KdGhlbSB0aGVpciBvd24gbG9jayBmb3IgdGhlIHB1cnBvc2VzIG9mIGxp
c3QgbWFuYWdlbWVudC4KCnYyOiBGb2N1cyBvbiBsb2NrIHRyYWNraW5nOyBjdHgtPnZtIGlzIHBy
b3RlY3RlZCBieSBjdHgtPm11dGV4CgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlz
QGNocmlzLXdpbHNvbi5jby51az4KQ2M6IFR2cnRrbyBVcnN1bGluIDx0dnJ0a28udXJzdWxpbkBp
bnRlbC5jb20+Ci0tLQpBbm90aGVyIG1pc3NlZCBjdHgtPm11dGV4IGFyb3VuZCBfX2Fzc2lnbl9w
cGd0dC4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jICAg
fCAxODMgKysrKysrKysrLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fY29udGV4dC5oICAgfCAgMjcgKystCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9j
b250ZXh0X3R5cGVzLmggfCAgIDIgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4
ZWNidWZmZXIuYyAgICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X3VzZXJwdHIuYyAgIHwgICAzICstCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVn
ZV9wYWdlcy5jICAgfCAgMzYgKystLQogLi4uL2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9n
ZW1fY29udGV4dC5jIHwgMTY4ICsrKysrKysrLS0tLS0tLS0KIC4uLi9ncHUvZHJtL2k5MTUvZ2Vt
L3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQuYyB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfY29udGV4dC5jICAgICAgIHwgIDEwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9scmMuYyAgICAgICAgICAgfCAgIDUgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfY29udGV4dC5jICAgIHwgIDI0ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfaGFuZ2NoZWNrLmMgIHwgIDM5ICsrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3NlbGZ0ZXN0X2xyYy5jICAgICAgICB8ICAgNiArLQogLi4uL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF93b3JrYXJvdW5kcy5jICAgIHwgIDIwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQv
c2NoZWR1bGVyLmMgICAgICAgICAgfCAgMjQgKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2RlYnVnZnMuYyAgICAgICAgICAgfCAgNTAgKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZHJ2LmMgICAgICAgICAgICAgICB8ICAgMiAtCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2Rydi5oICAgICAgICAgICAgICAgfCAgMjcgKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2dlbS5jICAgICAgICAgICAgICAgfCAgMTAgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
Z2VtX2d0dC5jICAgICAgICAgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9w
ZXJmLmMgICAgICAgICAgICAgIHwgIDI0ICsrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9z
eXNmcy5jICAgICAgICAgICAgIHwgIDc3ICsrKystLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3RyYWNlLmggICAgICAgICAgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9pOTE1X2dlbS5jICAgICB8ICAgOCAtCiAuLi4vZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pOTE1X2dlbV9ldmljdC5jICAgfCAgIDMgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2k5MTVfZ2VtX2d0dC5jIHwgIDE1ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaTkxNV9yZXF1ZXN0LmMgfCAgMTIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pOTE1X3ZtYS5jICAgICB8ICAgNyArLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9j
a19nZW1fZGV2aWNlLmMgIHwgICA2ICstCiAyOSBmaWxlcyBjaGFuZ2VkLCA0MTEgaW5zZXJ0aW9u
cygrKSwgMzg5IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fY29udGV4dC5jCmluZGV4IGFlNTg4NTQ0YmYzYS4uZGFkYjgyMGIwNTAyIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKQEAgLTIxOCw5ICsyMTgsMTIg
QEAgc3RhdGljIHN0cnVjdCBpOTE1X2dlbV9lbmdpbmVzICpkZWZhdWx0X2VuZ2luZXMoc3RydWN0
IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIAogc3RhdGljIHZvaWQgaTkxNV9nZW1fY29udGV4dF9m
cmVlKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCiB7Ci0JbG9ja2RlcF9hc3NlcnRfaGVs
ZCgmY3R4LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlHRU1fQlVHX09OKCFpOTE1X2dlbV9j
b250ZXh0X2lzX2Nsb3NlZChjdHgpKTsKIAorCXNwaW5fbG9jaygmY3R4LT5pOTE1LT5nZW0uY29u
dGV4dHMubG9jayk7CisJbGlzdF9kZWwoJmN0eC0+bGluayk7CisJc3Bpbl91bmxvY2soJmN0eC0+
aTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOworCiAJZnJlZV9lbmdpbmVzKHJjdV9hY2Nlc3NfcG9p
bnRlcihjdHgtPmVuZ2luZXMpKTsKIAltdXRleF9kZXN0cm95KCZjdHgtPmVuZ2luZXNfbXV0ZXgp
OwogCkBAIC0yMzAsNjcgKzIzMyw1NCBAQCBzdGF0aWMgdm9pZCBpOTE1X2dlbV9jb250ZXh0X2Zy
ZWUoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIAlrZnJlZShjdHgtPm5hbWUpOwogCXB1
dF9waWQoY3R4LT5waWQpOwogCi0JbGlzdF9kZWwoJmN0eC0+bGluayk7CiAJbXV0ZXhfZGVzdHJv
eSgmY3R4LT5tdXRleCk7CiAKIAlrZnJlZV9yY3UoY3R4LCByY3UpOwogfQogCi1zdGF0aWMgdm9p
ZCBjb250ZXh0c19mcmVlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQorc3RhdGljIHZv
aWQgY29udGV4dHNfZnJlZV9hbGwoc3RydWN0IGxsaXN0X25vZGUgKmxpc3QpCiB7Ci0Jc3RydWN0
IGxsaXN0X25vZGUgKmZyZWVkID0gbGxpc3RfZGVsX2FsbCgmaTkxNS0+Y29udGV4dHMuZnJlZV9s
aXN0KTsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LCAqY247CiAKLQlsb2NrZGVwX2Fz
c2VydF9oZWxkKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQotCWxsaXN0X2Zvcl9lYWNoX2Vu
dHJ5X3NhZmUoY3R4LCBjbiwgZnJlZWQsIGZyZWVfbGluaykKKwlsbGlzdF9mb3JfZWFjaF9lbnRy
eV9zYWZlKGN0eCwgY24sIGxpc3QsIGZyZWVfbGluaykKIAkJaTkxNV9nZW1fY29udGV4dF9mcmVl
KGN0eCk7CiB9CiAKLXN0YXRpYyB2b2lkIGNvbnRleHRzX2ZyZWVfZmlyc3Qoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCitzdGF0aWMgdm9pZCBjb250ZXh0c19mbHVzaF9mcmVlKHN0cnVj
dCBpOTE1X2dlbV9jb250ZXh0cyAqZ2MpCiB7Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0
eDsKLQlzdHJ1Y3QgbGxpc3Rfbm9kZSAqZnJlZWQ7Ci0KLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQotCWZyZWVkID0gbGxpc3RfZGVsX2ZpcnN0KCZpOTE1
LT5jb250ZXh0cy5mcmVlX2xpc3QpOwotCWlmICghZnJlZWQpCi0JCXJldHVybjsKLQotCWN0eCA9
IGNvbnRhaW5lcl9vZihmcmVlZCwgdHlwZW9mKCpjdHgpLCBmcmVlX2xpbmspOwotCWk5MTVfZ2Vt
X2NvbnRleHRfZnJlZShjdHgpOworCWNvbnRleHRzX2ZyZWVfYWxsKGxsaXN0X2RlbF9hbGwoJmdj
LT5mcmVlX2xpc3QpKTsKIH0KIAogc3RhdGljIHZvaWQgY29udGV4dHNfZnJlZV93b3JrZXIoc3Ry
dWN0IHdvcmtfc3RydWN0ICp3b3JrKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0KLQkJY29udGFpbmVyX29mKHdvcmssIHR5cGVvZigqaTkxNSksIGNvbnRleHRzLmZyZWVfd29y
ayk7CisJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHRzICpnYyA9CisJCWNvbnRhaW5lcl9vZih3b3Jr
LCB0eXBlb2YoKmdjKSwgZnJlZV93b3JrKTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwotCWNvbnRleHRzX2ZyZWUoaTkxNSk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKKwljb250ZXh0c19mbHVzaF9mcmVlKGdjKTsKIH0KIAogdm9pZCBp
OTE1X2dlbV9jb250ZXh0X3JlbGVhc2Uoc3RydWN0IGtyZWYgKnJlZikKIHsKIAlzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dCAqY3R4ID0gY29udGFpbmVyX29mKHJlZiwgdHlwZW9mKCpjdHgpLCByZWYp
OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gY3R4LT5pOTE1OworCXN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0cyAqZ2MgPSAmY3R4LT5pOTE1LT5nZW0uY29udGV4dHM7CiAKIAl0cmFj
ZV9pOTE1X2NvbnRleHRfZnJlZShjdHgpOwotCWlmIChsbGlzdF9hZGQoJmN0eC0+ZnJlZV9saW5r
LCAmaTkxNS0+Y29udGV4dHMuZnJlZV9saXN0KSkKLQkJcXVldWVfd29yayhpOTE1LT53cSwgJmk5
MTUtPmNvbnRleHRzLmZyZWVfd29yayk7CisJaWYgKGxsaXN0X2FkZCgmY3R4LT5mcmVlX2xpbmss
ICZnYy0+ZnJlZV9saXN0KSkKKwkJcXVldWVfd29yayhjdHgtPmk5MTUtPndxLCAmZ2MtPmZyZWVf
d29yayk7CiB9CiAKIHN0YXRpYyB2b2lkIGNvbnRleHRfY2xvc2Uoc3RydWN0IGk5MTVfZ2VtX2Nv
bnRleHQgKmN0eCkKIHsKLQlpOTE1X2dlbV9jb250ZXh0X3NldF9jbG9zZWQoY3R4KTsKKwlzdHJ1
Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKIAotCWlmIChjdHgtPnZtKQotCQlpOTE1X3ZtX2Ns
b3NlKGN0eC0+dm0pOworCWk5MTVfZ2VtX2NvbnRleHRfc2V0X2Nsb3NlZChjdHgpOwogCiAJbXV0
ZXhfbG9jaygmY3R4LT5tdXRleCk7CiAKKwl2bSA9IGk5MTVfZ2VtX2NvbnRleHRfdm0oY3R4KTsK
KwlpZiAodm0pCisJCWk5MTVfdm1fY2xvc2Uodm0pOworCiAJY3R4LT5maWxlX3ByaXYgPSBFUlJf
UFRSKC1FQkFERik7CiAKIAkvKgpAQCAtMzE3LDcgKzMwNyw2IEBAIF9fY3JlYXRlX2NvbnRleHQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0p
OwogCiAJa3JlZl9pbml0KCZjdHgtPnJlZik7Ci0JbGlzdF9hZGRfdGFpbCgmY3R4LT5saW5rLCAm
aTkxNS0+Y29udGV4dHMubGlzdCk7CiAJY3R4LT5pOTE1ID0gaTkxNTsKIAljdHgtPnNjaGVkLnBy
aW9yaXR5ID0gSTkxNV9VU0VSX1BSSU9SSVRZKEk5MTVfUFJJT1JJVFlfTk9STUFMKTsKIAltdXRl
eF9pbml0KCZjdHgtPm11dGV4KTsKQEAgLTM0Myw2ICszMzIsMTAgQEAgX19jcmVhdGVfY29udGV4
dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAlmb3IgKGkgPSAwOyBpIDwgQVJSQVlf
U0laRShjdHgtPmhhbmdfdGltZXN0YW1wKTsgaSsrKQogCQljdHgtPmhhbmdfdGltZXN0YW1wW2ld
ID0gamlmZmllcyAtIENPTlRFWFRfRkFTVF9IQU5HX0pJRkZJRVM7CiAKKwlzcGluX2xvY2soJmk5
MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKKwlsaXN0X2FkZF90YWlsKCZjdHgtPmxpbmssICZpOTE1
LT5nZW0uY29udGV4dHMubGlzdCk7CisJc3Bpbl91bmxvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5s
b2NrKTsKKwogCXJldHVybiBjdHg7CiAKIGVycl9mcmVlOgpAQCAtMzcyLDExICszNjUsMTEgQEAg
c3RhdGljIHZvaWQgX19hcHBseV9wcGd0dChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIHZvaWQg
KnZtKQogc3RhdGljIHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKgogX19zZXRfcHBndHQoc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0p
CiB7Ci0Jc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqb2xkID0gY3R4LT52bTsKKwlzdHJ1Y3Qg
aTkxNV9hZGRyZXNzX3NwYWNlICpvbGQgPSBpOTE1X2dlbV9jb250ZXh0X3ZtKGN0eCk7CiAKIAlH
RU1fQlVHX09OKG9sZCAmJiBpOTE1X3ZtX2lzXzRsdmwodm0pICE9IGk5MTVfdm1faXNfNGx2bChv
bGQpKTsKIAotCWN0eC0+dm0gPSBpOTE1X3ZtX29wZW4odm0pOworCXJjdV9hc3NpZ25fcG9pbnRl
cihjdHgtPnZtLCBpOTE1X3ZtX29wZW4odm0pKTsKIAljb250ZXh0X2FwcGx5X2FsbChjdHgsIF9f
YXBwbHlfcHBndHQsIHZtKTsKIAogCXJldHVybiBvbGQ7CkBAIC0zODUsNyArMzc4LDcgQEAgX19z
ZXRfcHBndHQoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwgc3RydWN0IGk5MTVfYWRkcmVz
c19zcGFjZSAqdm0pCiBzdGF0aWMgdm9pZCBfX2Fzc2lnbl9wcGd0dChzdHJ1Y3QgaTkxNV9nZW1f
Y29udGV4dCAqY3R4LAogCQkJICAgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiB7Ci0J
aWYgKHZtID09IGN0eC0+dm0pCisJaWYgKHZtID09IHJjdV9hY2Nlc3NfcG9pbnRlcihjdHgtPnZt
KSkKIAkJcmV0dXJuOwogCiAJdm0gPSBfX3NldF9wcGd0dChjdHgsIHZtKTsKQEAgLTQxNywyNyAr
NDEwLDI1IEBAIHN0YXRpYyB2b2lkIF9fYXNzaWduX3RpbWVsaW5lKHN0cnVjdCBpOTE1X2dlbV9j
b250ZXh0ICpjdHgsCiB9CiAKIHN0YXRpYyBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqCi1pOTE1
X2dlbV9jcmVhdGVfY29udGV4dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHVu
c2lnbmVkIGludCBmbGFncykKK2k5MTVfZ2VtX2NyZWF0ZV9jb250ZXh0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1LCB1bnNpZ25lZCBpbnQgZmxhZ3MpCiB7CiAJc3RydWN0IGk5MTVfZ2Vt
X2NvbnRleHQgKmN0eDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2LT5kcm0uc3Ry
dWN0X211dGV4KTsKLQogCWlmIChmbGFncyAmIEk5MTVfQ09OVEVYVF9DUkVBVEVfRkxBR1NfU0lO
R0xFX1RJTUVMSU5FICYmCi0JICAgICFIQVNfRVhFQ0xJU1RTKGRldl9wcml2KSkKKwkgICAgIUhB
U19FWEVDTElTVFMoaTkxNSkpCiAJCXJldHVybiBFUlJfUFRSKC1FSU5WQUwpOwogCi0JLyogUmVh
cCB0aGUgbW9zdCBzdGFsZSBjb250ZXh0ICovCi0JY29udGV4dHNfZnJlZV9maXJzdChkZXZfcHJp
dik7CisJLyogUmVhcCB0aGUgc3RhbGUgY29udGV4dHMgKi8KKwljb250ZXh0c19mbHVzaF9mcmVl
KCZpOTE1LT5nZW0uY29udGV4dHMpOwogCi0JY3R4ID0gX19jcmVhdGVfY29udGV4dChkZXZfcHJp
dik7CisJY3R4ID0gX19jcmVhdGVfY29udGV4dChpOTE1KTsKIAlpZiAoSVNfRVJSKGN0eCkpCiAJ
CXJldHVybiBjdHg7CiAKLQlpZiAoSEFTX0ZVTExfUFBHVFQoZGV2X3ByaXYpKSB7CisJaWYgKEhB
U19GVUxMX1BQR1RUKGk5MTUpKSB7CiAJCXN0cnVjdCBpOTE1X3BwZ3R0ICpwcGd0dDsKIAotCQlw
cGd0dCA9IGk5MTVfcHBndHRfY3JlYXRlKGRldl9wcml2KTsKKwkJcHBndHQgPSBpOTE1X3BwZ3R0
X2NyZWF0ZShpOTE1KTsKIAkJaWYgKElTX0VSUihwcGd0dCkpIHsKIAkJCURSTV9ERUJVR19EUklW
RVIoIlBQR1RUIHNldHVwIGZhaWxlZCAoJWxkKVxuIiwKIAkJCQkJIFBUUl9FUlIocHBndHQpKTsK
QEAgLTQ0NSwxNCArNDM2LDE3IEBAIGk5MTVfZ2VtX2NyZWF0ZV9jb250ZXh0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdW5zaWduZWQgaW50IGZsYWdzKQogCQkJcmV0dXJuIEVS
Ul9DQVNUKHBwZ3R0KTsKIAkJfQogCisJCW11dGV4X2xvY2soJmN0eC0+bXV0ZXgpOwogCQlfX2Fz
c2lnbl9wcGd0dChjdHgsICZwcGd0dC0+dm0pOworCQltdXRleF91bmxvY2soJmN0eC0+bXV0ZXgp
OworCiAJCWk5MTVfdm1fcHV0KCZwcGd0dC0+dm0pOwogCX0KIAogCWlmIChmbGFncyAmIEk5MTVf
Q09OVEVYVF9DUkVBVEVfRkxBR1NfU0lOR0xFX1RJTUVMSU5FKSB7CiAJCXN0cnVjdCBpbnRlbF90
aW1lbGluZSAqdGltZWxpbmU7CiAKLQkJdGltZWxpbmUgPSBpbnRlbF90aW1lbGluZV9jcmVhdGUo
JmRldl9wcml2LT5ndCwgTlVMTCk7CisJCXRpbWVsaW5lID0gaW50ZWxfdGltZWxpbmVfY3JlYXRl
KCZpOTE1LT5ndCwgTlVMTCk7CiAJCWlmIChJU19FUlIodGltZWxpbmUpKSB7CiAJCQljb250ZXh0
X2Nsb3NlKGN0eCk7CiAJCQlyZXR1cm4gRVJSX0NBU1QodGltZWxpbmUpOwpAQCAtNDk3LDQ4ICs0
OTEsNDAgQEAgaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LCBpbnQgcHJpbykKIAlyZXR1cm4gY3R4OwogfQogCi1zdGF0aWMgdm9pZCBp
bml0X2NvbnRleHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQorc3RhdGljIHZvaWQg
aW5pdF9jb250ZXh0cyhzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dHMgKmdjKQogewotCW11dGV4X2lu
aXQoJmk5MTUtPmNvbnRleHRzLm11dGV4KTsKLQlJTklUX0xJU1RfSEVBRCgmaTkxNS0+Y29udGV4
dHMubGlzdCk7Ci0KLQkvKiBVc2luZyB0aGUgc2ltcGxlIGlkYSBpbnRlcmZhY2UsIHRoZSBtYXgg
aXMgbGltaXRlZCBieSBzaXplb2YoaW50KSAqLwotCUJVSUxEX0JVR19PTihNQVhfQ09OVEVYVF9I
V19JRCA+IElOVF9NQVgpOwotCUJVSUxEX0JVR19PTihHRU4xMV9NQVhfQ09OVEVYVF9IV19JRCA+
IElOVF9NQVgpOwotCWlkYV9pbml0KCZpOTE1LT5jb250ZXh0cy5od19pZGEpOwotCUlOSVRfTElT
VF9IRUFEKCZpOTE1LT5jb250ZXh0cy5od19pZF9saXN0KTsKKwlzcGluX2xvY2tfaW5pdCgmZ2Mt
PmxvY2spOworCUlOSVRfTElTVF9IRUFEKCZnYy0+bGlzdCk7CiAKLQlJTklUX1dPUksoJmk5MTUt
PmNvbnRleHRzLmZyZWVfd29yaywgY29udGV4dHNfZnJlZV93b3JrZXIpOwotCWluaXRfbGxpc3Rf
aGVhZCgmaTkxNS0+Y29udGV4dHMuZnJlZV9saXN0KTsKKwlJTklUX1dPUksoJmdjLT5mcmVlX3dv
cmssIGNvbnRleHRzX2ZyZWVfd29ya2VyKTsKKwlpbml0X2xsaXN0X2hlYWQoJmdjLT5mcmVlX2xp
c3QpOwogfQogCi1pbnQgaTkxNV9nZW1fY29udGV4dHNfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCitpbnQgaTkxNV9nZW1faW5pdF9jb250ZXh0cyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwogCiAJ
LyogUmVhc3N1cmUgb3Vyc2VsdmVzIHdlIGFyZSBvbmx5IGNhbGxlZCBvbmNlICovCi0JR0VNX0JV
R19PTihkZXZfcHJpdi0+a2VybmVsX2NvbnRleHQpOworCUdFTV9CVUdfT04oaTkxNS0+a2VybmVs
X2NvbnRleHQpOwogCi0JaW5pdF9jb250ZXh0cyhkZXZfcHJpdik7CisJaW5pdF9jb250ZXh0cygm
aTkxNS0+Z2VtLmNvbnRleHRzKTsKIAogCS8qIGxvd2VzdCBwcmlvcml0eTsgaWRsZSB0YXNrICov
Ci0JY3R4ID0gaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKGRldl9wcml2LCBJOTE1X1BS
SU9SSVRZX01JTik7CisJY3R4ID0gaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKGk5MTUs
IEk5MTVfUFJJT1JJVFlfTUlOKTsKIAlpZiAoSVNfRVJSKGN0eCkpIHsKIAkJRFJNX0VSUk9SKCJG
YWlsZWQgdG8gY3JlYXRlIGRlZmF1bHQgZ2xvYmFsIGNvbnRleHRcbiIpOwogCQlyZXR1cm4gUFRS
X0VSUihjdHgpOwogCX0KLQlkZXZfcHJpdi0+a2VybmVsX2NvbnRleHQgPSBjdHg7CisJaTkxNS0+
a2VybmVsX2NvbnRleHQgPSBjdHg7CiAKIAlEUk1fREVCVUdfRFJJVkVSKCIlcyBjb250ZXh0IHN1
cHBvcnQgaW5pdGlhbGl6ZWRcbiIsCi0JCQkgRFJJVkVSX0NBUFMoZGV2X3ByaXYpLT5oYXNfbG9n
aWNhbF9jb250ZXh0cyA/CisJCQkgRFJJVkVSX0NBUFMoaTkxNSktPmhhc19sb2dpY2FsX2NvbnRl
eHRzID8KIAkJCSAibG9naWNhbCIgOiAiZmFrZSIpOwogCXJldHVybiAwOwogfQogCi12b2lkIGk5
MTVfZ2VtX2NvbnRleHRzX2Zpbmkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCit2b2lk
IGk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNlX19jb250ZXh0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKIHsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKLQogCWRlc3Ryb3lfa2VybmVsX2NvbnRleHQoJmk5MTUtPmtlcm5lbF9jb250ZXh0KTsKIH0K
IApAQCAtNTU3LDExICs1NDMsMTYgQEAgc3RhdGljIGludCB2bV9pZHJfY2xlYW51cChpbnQgaWQs
IHZvaWQgKnAsIHZvaWQgKmRhdGEpCiBzdGF0aWMgaW50IGdlbV9jb250ZXh0X3JlZ2lzdGVyKHN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCQkJc3RydWN0IGRybV9pOTE1X2ZpbGVfcHJp
dmF0ZSAqZnByaXYpCiB7CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CiAJaW50IHJl
dDsKIAogCWN0eC0+ZmlsZV9wcml2ID0gZnByaXY7Ci0JaWYgKGN0eC0+dm0pCi0JCWN0eC0+dm0t
PmZpbGUgPSBmcHJpdjsKKworCW11dGV4X2xvY2soJmN0eC0+bXV0ZXgpOworCXZtID0gaTkxNV9n
ZW1fY29udGV4dF92bShjdHgpOworCWlmICh2bSkKKwkJV1JJVEVfT05DRSh2bS0+ZmlsZSwgZnBy
aXYpOyAvKiBYWFggKi8KKwltdXRleF91bmxvY2soJmN0eC0+bXV0ZXgpOwogCiAJY3R4LT5waWQg
PSBnZXRfdGFza19waWQoY3VycmVudCwgUElEVFlQRV9QSUQpOwogCWN0eC0+bmFtZSA9IGthc3By
aW50ZihHRlBfS0VSTkVMLCAiJXNbJWRdIiwKQEAgLTU5OCw5ICs1ODksNyBAQCBpbnQgaTkxNV9n
ZW1fY29udGV4dF9vcGVuKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCWlkcl9pbml0
KCZmaWxlX3ByaXYtPmNvbnRleHRfaWRyKTsKIAlpZHJfaW5pdF9iYXNlKCZmaWxlX3ByaXYtPnZt
X2lkciwgMSk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAljdHgg
PSBpOTE1X2dlbV9jcmVhdGVfY29udGV4dChpOTE1LCAwKTsKLQltdXRleF91bmxvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChJU19FUlIoY3R4KSkgewogCQllcnIgPSBQVFJfRVJS
KGN0eCk7CiAJCWdvdG8gZXJyOwpAQCAtNjI4LDYgKzYxNyw3IEBAIGludCBpOTE1X2dlbV9jb250
ZXh0X29wZW4oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiB2b2lkIGk5MTVfZ2VtX2Nv
bnRleHRfY2xvc2Uoc3RydWN0IGRybV9maWxlICpmaWxlKQogewogCXN0cnVjdCBkcm1faTkxNV9m
aWxlX3ByaXZhdGUgKmZpbGVfcHJpdiA9IGZpbGUtPmRyaXZlcl9wcml2OworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gZmlsZV9wcml2LT5kZXZfcHJpdjsKIAogCWlkcl9mb3JfZWFj
aCgmZmlsZV9wcml2LT5jb250ZXh0X2lkciwgY29udGV4dF9pZHJfY2xlYW51cCwgTlVMTCk7CiAJ
aWRyX2Rlc3Ryb3koJmZpbGVfcHJpdi0+Y29udGV4dF9pZHIpOwpAQCAtNjM2LDYgKzYyNiw4IEBA
IHZvaWQgaTkxNV9nZW1fY29udGV4dF9jbG9zZShzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCiAJaWRy
X2Zvcl9lYWNoKCZmaWxlX3ByaXYtPnZtX2lkciwgdm1faWRyX2NsZWFudXAsIE5VTEwpOwogCWlk
cl9kZXN0cm95KCZmaWxlX3ByaXYtPnZtX2lkcik7CiAJbXV0ZXhfZGVzdHJveSgmZmlsZV9wcml2
LT52bV9pZHJfbG9jayk7CisKKwljb250ZXh0c19mbHVzaF9mcmVlKCZpOTE1LT5nZW0uY29udGV4
dHMpOwogfQogCiBpbnQgaTkxNV9nZW1fdm1fY3JlYXRlX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYsIHZvaWQgKmRhdGEsCkBAIC04MTQsMTYgKzgwNiwxMiBAQCBzdGF0aWMgaW50IGdldF9w
cGd0dChzdHJ1Y3QgZHJtX2k5MTVfZmlsZV9wcml2YXRlICpmaWxlX3ByaXYsCiAJc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqdm07CiAJaW50IHJldDsKIAotCWlmICghY3R4LT52bSkKKwlpZiAo
IXJjdV9hY2Nlc3NfcG9pbnRlcihjdHgtPnZtKSkKIAkJcmV0dXJuIC1FTk9ERVY7CiAKLQkvKiBY
WFggcmN1IGFjcXVpcmU/ICovCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZjdHgt
Pmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KKwly
Y3VfcmVhZF9sb2NrKCk7CiAJdm0gPSBpOTE1X3ZtX2dldChjdHgtPnZtKTsKLQltdXRleF91bmxv
Y2soJmN0eC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJcmN1X3JlYWRfdW5sb2NrKCk7CiAK
IAlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmZpbGVfcHJpdi0+dm1faWRyX2xvY2sp
OwogCWlmIChyZXQpCkBAIC05MzIsNyArOTIwLDcgQEAgc3RhdGljIGludCBzZXRfcHBndHQoc3Ry
dWN0IGRybV9pOTE1X2ZpbGVfcHJpdmF0ZSAqZmlsZV9wcml2LAogCWlmIChhcmdzLT5zaXplKQog
CQlyZXR1cm4gLUVJTlZBTDsKIAotCWlmICghY3R4LT52bSkKKwlpZiAoIXJjdV9hY2Nlc3NfcG9p
bnRlcihjdHgtPnZtKSkKIAkJcmV0dXJuIC1FTk9ERVY7CiAKIAlpZiAodXBwZXJfMzJfYml0cyhh
cmdzLT52YWx1ZSkpCkBAIC05NDYsMTcgKzkzNCwyMCBAQCBzdGF0aWMgaW50IHNldF9wcGd0dChz
dHJ1Y3QgZHJtX2k5MTVfZmlsZV9wcml2YXRlICpmaWxlX3ByaXYsCiAJaWYgKCF2bSkKIAkJcmV0
dXJuIC1FTk9FTlQ7CiAKLQllcnIgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmN0eC0+aTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJZXJyID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZj
dHgtPm11dGV4KTsKIAlpZiAoZXJyKQogCQlnb3RvIG91dDsKIAotCWlmICh2bSA9PSBjdHgtPnZt
KQorCWlmIChpOTE1X2dlbV9jb250ZXh0X2lzX2Nsb3NlZChjdHgpKSB7CisJCWVyciA9IC1FTk9F
TlQ7CisJCWdvdG8gb3V0OworCX0KKworCWlmICh2bSA9PSByY3VfYWNjZXNzX3BvaW50ZXIoY3R4
LT52bSkpCiAJCWdvdG8gdW5sb2NrOwogCiAJLyogVGVhcmRvd24gdGhlIGV4aXN0aW5nIG9iajp2
bWEgY2FjaGUsIGl0IHdpbGwgaGF2ZSB0byBiZSByZWJ1aWx0LiAqLwotCW11dGV4X2xvY2soJmN0
eC0+bXV0ZXgpOwogCWx1dF9jbG9zZShjdHgpOwotCW11dGV4X3VubG9jaygmY3R4LT5tdXRleCk7
CiAKIAlvbGQgPSBfX3NldF9wcGd0dChjdHgsIHZtKTsKIApAQCAtOTc2LDggKzk2Nyw3IEBAIHN0
YXRpYyBpbnQgc2V0X3BwZ3R0KHN0cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGUgKmZpbGVfcHJp
diwKIAl9CiAKIHVubG9jazoKLQltdXRleF91bmxvY2soJmN0eC0+aTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7Ci0KKwltdXRleF91bmxvY2soJmN0eC0+bXV0ZXgpOwogb3V0OgogCWk5MTVfdm1fcHV0
KHZtKTsKIAlyZXR1cm4gZXJyOwpAQCAtMTgzMywxMCArMTgyMywxMSBAQCBzdGF0aWMgaW50IGNs
b25lX3ZtKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpkc3QsCiAJCSAgICBzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqc3JjKQogewogCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOworCWlu
dCBlcnIgPSAwOwogCiAJcmN1X3JlYWRfbG9jaygpOwogCWRvIHsKLQkJdm0gPSBSRUFEX09OQ0Uo
c3JjLT52bSk7CisJCXZtID0gcmN1X2RlcmVmZXJlbmNlKHNyYy0+dm0pOwogCQlpZiAoIXZtKQog
CQkJYnJlYWs7CiAKQEAgLTE4NTgsNyArMTg0OSw3IEBAIHN0YXRpYyBpbnQgY2xvbmVfdm0oc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKmRzdCwKIAkJICogaXQgY2Fubm90IGJlIHJlYWxsb2NhdGVk
IGVsc2V3aGVyZS4KIAkJICovCiAKLQkJaWYgKHZtID09IFJFQURfT05DRShzcmMtPnZtKSkKKwkJ
aWYgKHZtID09IHJjdV9hY2Nlc3NfcG9pbnRlcihzcmMtPnZtKSkKIAkJCWJyZWFrOwogCiAJCWk5
MTVfdm1fcHV0KHZtKTsKQEAgLTE4NjYsMTEgKzE4NTcsMTYgQEAgc3RhdGljIGludCBjbG9uZV92
bShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqZHN0LAogCXJjdV9yZWFkX3VubG9jaygpOwogCiAJ
aWYgKHZtKSB7Ci0JCV9fYXNzaWduX3BwZ3R0KGRzdCwgdm0pOworCQlpZiAoIW11dGV4X2xvY2tf
aW50ZXJydXB0aWJsZSgmZHN0LT5tdXRleCkpIHsKKwkJCV9fYXNzaWduX3BwZ3R0KGRzdCwgdm0p
OworCQkJbXV0ZXhfdW5sb2NrKCZkc3QtPm11dGV4KTsKKwkJfSBlbHNlIHsKKwkJCWVyciA9IC1F
SU5UUjsKKwkJfQogCQlpOTE1X3ZtX3B1dCh2bSk7CiAJfQogCi0JcmV0dXJuIDA7CisJcmV0dXJu
IGVycjsKIH0KIAogc3RhdGljIGludCBjcmVhdGVfY2xvbmUoc3RydWN0IGk5MTVfdXNlcl9leHRl
bnNpb24gX191c2VyICpleHQsIHZvaWQgKmRhdGEpCkBAIC0xOTYwLDEyICsxOTU2LDcgQEAgaW50
IGk5MTVfZ2VtX2NvbnRleHRfY3JlYXRlX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZv
aWQgKmRhdGEsCiAJCXJldHVybiAtRUlPOwogCX0KIAotCXJldCA9IGk5MTVfbXV0ZXhfbG9ja19p
bnRlcnJ1cHRpYmxlKGRldik7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQogCWV4dF9kYXRh
LmN0eCA9IGk5MTVfZ2VtX2NyZWF0ZV9jb250ZXh0KGk5MTUsIGFyZ3MtPmZsYWdzKTsKLQltdXRl
eF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKIAlpZiAoSVNfRVJSKGV4dF9kYXRhLmN0eCkp
CiAJCXJldHVybiBQVFJfRVJSKGV4dF9kYXRhLmN0eCk7CiAKQEAgLTIwOTIsMTAgKzIwODMsMTIg
QEAgaW50IGk5MTVfZ2VtX2NvbnRleHRfZ2V0cGFyYW1faW9jdGwoc3RydWN0IGRybV9kZXZpY2Ug
KmRldiwgdm9pZCAqZGF0YSwKIAogCWNhc2UgSTkxNV9DT05URVhUX1BBUkFNX0dUVF9TSVpFOgog
CQlhcmdzLT5zaXplID0gMDsKLQkJaWYgKGN0eC0+dm0pCi0JCQlhcmdzLT52YWx1ZSA9IGN0eC0+
dm0tPnRvdGFsOworCQlyY3VfcmVhZF9sb2NrKCk7CisJCWlmIChyY3VfYWNjZXNzX3BvaW50ZXIo
Y3R4LT52bSkpCisJCQlhcmdzLT52YWx1ZSA9IHJjdV9kZXJlZmVyZW5jZShjdHgtPnZtKS0+dG90
YWw7CiAJCWVsc2UKIAkJCWFyZ3MtPnZhbHVlID0gdG9faTkxNShkZXYpLT5nZ3R0LnZtLnRvdGFs
OworCQlyY3VfcmVhZF91bmxvY2soKTsKIAkJYnJlYWs7CiAKIAljYXNlIEk5MTVfQ09OVEVYVF9Q
QVJBTV9OT19FUlJPUl9DQVBUVVJFOgpAQCAtMjE2MSw3ICsyMTU0LDcgQEAgaW50IGk5MTVfZ2Vt
X2NvbnRleHRfc2V0cGFyYW1faW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0
YSwKIGludCBpOTE1X2dlbV9jb250ZXh0X3Jlc2V0X3N0YXRzX2lvY3RsKHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYsCiAJCQkJICAgICAgIHZvaWQgKmRhdGEsIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkK
IHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJc3RydWN0IGRy
bV9pOTE1X3Jlc2V0X3N0YXRzICphcmdzID0gZGF0YTsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqY3R4OwogCWludCByZXQ7CkBAIC0yMTgzLDcgKzIxNzYsNyBAQCBpbnQgaTkxNV9nZW1fY29u
dGV4dF9yZXNldF9zdGF0c19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCSAqLwogCiAJ
aWYgKGNhcGFibGUoQ0FQX1NZU19BRE1JTikpCi0JCWFyZ3MtPnJlc2V0X2NvdW50ID0gaTkxNV9y
ZXNldF9jb3VudCgmZGV2X3ByaXYtPmdwdV9lcnJvcik7CisJCWFyZ3MtPnJlc2V0X2NvdW50ID0g
aTkxNV9yZXNldF9jb3VudCgmaTkxNS0+Z3B1X2Vycm9yKTsKIAllbHNlCiAJCWFyZ3MtPnJlc2V0
X2NvdW50ID0gMDsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX2NvbnRleHQuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0
LmgKaW5kZXggNTBiYzI3ZDMwYzAzLi45MjM0NTg2ODMwZDEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaApAQCAtMTEsNyArMTEsOSBAQAogCiAjaW5jbHVk
ZSAiZ3QvaW50ZWxfY29udGV4dC5oIgogCisjaW5jbHVkZSAiaTkxNV9kcnYuaCIKICNpbmNsdWRl
ICJpOTE1X2dlbS5oIgorI2luY2x1ZGUgImk5MTVfZ2VtX2d0dC5oIgogI2luY2x1ZGUgImk5MTVf
c2NoZWR1bGVyLmgiCiAjaW5jbHVkZSAiaW50ZWxfZGV2aWNlX2luZm8uaCIKIApAQCAtMTE4LDgg
KzEyMCw4IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBpOTE1X2dlbV9jb250ZXh0X2lzX2tlcm5lbChz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQogfQogCiAvKiBpOTE1X2dlbV9jb250ZXh0LmMg
Ki8KLWludCBfX211c3RfY2hlY2sgaTkxNV9nZW1fY29udGV4dHNfaW5pdChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBpOTE1X2dlbV9jb250ZXh0c19maW5pKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CitpbnQgX19tdXN0X2NoZWNrIGk5MTVfZ2Vt
X2luaXRfY29udGV4dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9pZCBpOTE1
X2dlbV9kcml2ZXJfcmVsZWFzZV9fY29udGV4dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpOwogCiBpbnQgaTkxNV9nZW1fY29udGV4dF9vcGVuKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAogCQkJICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpOwpAQCAtMTU4LDYgKzE2MCwyNyBA
QCBzdGF0aWMgaW5saW5lIHZvaWQgaTkxNV9nZW1fY29udGV4dF9wdXQoc3RydWN0IGk5MTVfZ2Vt
X2NvbnRleHQgKmN0eCkKIAlrcmVmX3B1dCgmY3R4LT5yZWYsIGk5MTVfZ2VtX2NvbnRleHRfcmVs
ZWFzZSk7CiB9CiAKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqCitp
OTE1X2dlbV9jb250ZXh0X3ZtKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCit7CisJcmV0
dXJuIHJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQoY3R4LT52bSwgbG9ja2RlcF9pc19oZWxkKCZj
dHgtPm11dGV4KSk7Cit9CisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZSAqCitpOTE1X2dlbV9jb250ZXh0X2dldF92bV9yY3Uoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQg
KmN0eCkKK3sKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKKworCXJjdV9yZWFkX2xv
Y2soKTsKKwl2bSA9IHJjdV9kZXJlZmVyZW5jZShjdHgtPnZtKTsKKwlpZiAoIXZtKQorCQl2bSA9
ICZjdHgtPmk5MTUtPmdndHQudm07CisJdm0gPSBpOTE1X3ZtX2dldCh2bSk7CisJcmN1X3JlYWRf
dW5sb2NrKCk7CisKKwlyZXR1cm4gdm07Cit9CisKIHN0YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVf
Z2VtX2VuZ2luZXMgKgogaTkxNV9nZW1fY29udGV4dF9lbmdpbmVzKHN0cnVjdCBpOTE1X2dlbV9j
b250ZXh0ICpjdHgpCiB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fY29udGV4dF90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X2NvbnRleHRfdHlwZXMuaAppbmRleCA4N2JlMjc4NzdlMjIuLmFiOGUxMzY3ZGZjOCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHRfdHlwZXMuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dF90eXBlcy5oCkBA
IC04OCw3ICs4OCw3IEBAIHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0IHsKIAkgKiBJbiBvdGhlciBt
b2RlcywgdGhpcyBpcyBhIE5VTEwgcG9pbnRlciB3aXRoIHRoZSBleHBlY3RhdGlvbiB0aGF0CiAJ
ICogdGhlIGNhbGxlciB1c2VzIHRoZSBzaGFyZWQgZ2xvYmFsIEdUVC4KIAkgKi8KLQlzdHJ1Y3Qg
aTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlIF9fcmN1
ICp2bTsKIAogCS8qKgogCSAqIEBwaWQ6IHByb2Nlc3MgaWQgb2YgY3JlYXRvcgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKaW5kZXggODhhODgxYmUx
MmVjLi45ODgxNmMzNWZmYzMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9leGVjYnVmZmVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX2V4ZWNidWZmZXIuYwpAQCAtNzI4LDcgKzcyOCw3IEBAIHN0YXRpYyBpbnQgZWJfc2VsZWN0
X2NvbnRleHQoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIpCiAJCXJldHVybiAtRU5PRU5UOwog
CiAJZWItPmdlbV9jb250ZXh0ID0gY3R4OwotCWlmIChjdHgtPnZtKQorCWlmIChyY3VfYWNjZXNz
X3BvaW50ZXIoY3R4LT52bSkpCiAJCWViLT5pbnZhbGlkX2ZsYWdzIHw9IEVYRUNfT0JKRUNUX05F
RURTX0dUVDsKIAogCWViLT5jb250ZXh0X2ZsYWdzID0gMDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jCmluZGV4IDE3MzhhMTVlYjkxMS4uNGY5NzA0NzQwMTNm
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMKQEAgLTc1
OCw3ICs3NTgsOCBAQCBpOTE1X2dlbV91c2VycHRyX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsCiAJCSAqIE9uIGFsbW9zdCBhbGwgb2YgdGhlIG9sZGVyIGh3LCB3ZSBjYW5ub3QgdGVsbCB0
aGUgR1BVIHRoYXQKIAkJICogYSBwYWdlIGlzIHJlYWRvbmx5LgogCQkgKi8KLQkJdm0gPSBkZXZf
cHJpdi0+a2VybmVsX2NvbnRleHQtPnZtOworCQl2bSA9IHJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0
ZWQoZGV2X3ByaXYtPmtlcm5lbF9jb250ZXh0LT52bSwKKwkJCQkJICAgICAgIHRydWUpOyAvKiBz
dGF0aWMgdm0gKi8KIAkJaWYgKCF2bSB8fCAhdm0tPmhhc19yZWFkX29ubHkpCiAJCQlyZXR1cm4g
LUVOT0RFVjsKIAl9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRl
c3RzL2h1Z2VfcGFnZXMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVn
ZV9wYWdlcy5jCmluZGV4IDk4YjJhNmNjZmNjMS4uMzMxNDg1OGYzMDQ2IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYwpAQCAtMTMyMiwxNSAr
MTMyMiwxNSBAQCBzdGF0aWMgaW50IGlndF9wcGd0dF9waW5fdXBkYXRlKHZvaWQgKmFyZykKIAlz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4ID0gYXJnOwogCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IGN0eC0+aTkxNTsKIAl1bnNpZ25lZCBsb25nIHN1cHBvcnRlZCA9IElO
VEVMX0lORk8oZGV2X3ByaXYpLT5wYWdlX3NpemVzOwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3Bh
Y2UgKnZtID0gY3R4LT52bTsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwogCXN0
cnVjdCBpOTE1X2dlbV9lbmdpbmVzX2l0ZXIgaXQ7CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZSAqdm07CiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1h
OwogCXVuc2lnbmVkIGludCBmbGFncyA9IFBJTl9VU0VSIHwgUElOX09GRlNFVF9GSVhFRDsKIAl1
bnNpZ25lZCBpbnQgbjsKIAlpbnQgZmlyc3QsIGxhc3Q7Ci0JaW50IGVycjsKKwlpbnQgZXJyID0g
MDsKIAogCS8qCiAJICogTWFrZSBzdXJlIHRoZXJlJ3Mgbm8gZnVubnkgYnVzaW5lc3Mgd2hlbiBk
b2luZyBhIFBJTl9VUERBVEUgLS0gaW4gdGhlCkBAIC0xMzQwLDkgKzEzNDAsMTAgQEAgc3RhdGlj
IGludCBpZ3RfcHBndHRfcGluX3VwZGF0ZSh2b2lkICphcmcpCiAJICogaHVnZS1ndHQtcGFnZXMu
CiAJICovCiAKLQlpZiAoIXZtIHx8ICFpOTE1X3ZtX2lzXzRsdmwodm0pKSB7CisJdm0gPSBpOTE1
X2dlbV9jb250ZXh0X2dldF92bV9yY3UoY3R4KTsKKwlpZiAoIWk5MTVfdm1faXNfNGx2bCh2bSkp
IHsKIAkJcHJfaW5mbygiNDhiIFBQR1RUIG5vdCBzdXBwb3J0ZWQsIHNraXBwaW5nXG4iKTsKLQkJ
cmV0dXJuIDA7CisJCWdvdG8gb3V0X3ZtOwogCX0KIAogCWZpcnN0ID0gaWxvZzIoSTkxNV9HVFRf
UEFHRV9TSVpFXzY0Syk7CkBAIC0xNDUxLDYgKzE0NTIsOCBAQCBzdGF0aWMgaW50IGlndF9wcGd0
dF9waW5fdXBkYXRlKHZvaWQgKmFyZykKIAlpOTE1X3ZtYV9jbG9zZSh2bWEpOwogb3V0X3B1dDoK
IAlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CitvdXRfdm06CisJaTkxNV92bV9wdXQodm0pOwog
CiAJcmV0dXJuIGVycjsKIH0KQEAgLTE0NjAsNyArMTQ2Myw3IEBAIHN0YXRpYyBpbnQgaWd0X3Rt
cGZzX2ZhbGxiYWNrKHZvaWQgKmFyZykKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4ID0g
YXJnOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gY3R4LT5pOTE1OwogCXN0cnVj
dCB2ZnNtb3VudCAqZ2VtZnMgPSBpOTE1LT5tbS5nZW1mczsKLQlzdHJ1Y3QgaTkxNV9hZGRyZXNz
X3NwYWNlICp2bSA9IGN0eC0+dm0gPzogJmk5MTUtPmdndHQudm07CisJc3RydWN0IGk5MTVfYWRk
cmVzc19zcGFjZSAqdm0gPSBpOTE1X2dlbV9jb250ZXh0X2dldF92bV9yY3UoY3R4KTsKIAlzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCXUz
MiAqdmFkZHI7CkBAIC0xNTEwLDYgKzE1MTMsNyBAQCBzdGF0aWMgaW50IGlndF90bXBmc19mYWxs
YmFjayh2b2lkICphcmcpCiBvdXRfcmVzdG9yZToKIAlpOTE1LT5tbS5nZW1mcyA9IGdlbWZzOwog
CisJaTkxNV92bV9wdXQodm0pOwogCXJldHVybiBlcnI7CiB9CiAKQEAgLTE1MTcsMTQgKzE1MjEs
MTQgQEAgc3RhdGljIGludCBpZ3Rfc2hyaW5rX3RocCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGk5
MTVfZ2VtX2NvbnRleHQgKmN0eCA9IGFyZzsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9IGN0eC0+aTkxNTsKLQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IGN0eC0+dm0g
PzogJmk5MTUtPmdndHQudm07CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSBpOTE1
X2dlbV9jb250ZXh0X2dldF92bV9yY3UoY3R4KTsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqOwogCXN0cnVjdCBpOTE1X2dlbV9lbmdpbmVzX2l0ZXIgaXQ7CiAJc3RydWN0IGludGVs
X2NvbnRleHQgKmNlOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCXVuc2lnbmVkIGludCBmbGFn
cyA9IFBJTl9VU0VSOwogCXVuc2lnbmVkIGludCBuOwotCWludCBlcnI7CisJaW50IGVyciA9IDA7
CiAKIAkvKgogCSAqIFNhbml0eSBjaGVjayBzaHJpbmtpbmcgaHVnZS1wYWdlZCBvYmplY3QgLS0g
bWFrZSBzdXJlIG5vdGhpbmcgYmxvd3MKQEAgLTE1MzMsMTIgKzE1MzcsMTQgQEAgc3RhdGljIGlu
dCBpZ3Rfc2hyaW5rX3RocCh2b2lkICphcmcpCiAKIAlpZiAoIWlndF9jYW5fYWxsb2NhdGVfdGhw
KGk5MTUpKSB7CiAJCXByX2luZm8oIm1pc3NpbmcgVEhQIHN1cHBvcnQsIHNraXBwaW5nXG4iKTsK
LQkJcmV0dXJuIDA7CisJCWdvdG8gb3V0X3ZtOwogCX0KIAogCW9iaiA9IGk5MTVfZ2VtX29iamVj
dF9jcmVhdGVfc2htZW0oaTkxNSwgU1pfMk0pOwotCWlmIChJU19FUlIob2JqKSkKLQkJcmV0dXJu
IFBUUl9FUlIob2JqKTsKKwlpZiAoSVNfRVJSKG9iaikpIHsKKwkJZXJyID0gUFRSX0VSUihvYmop
OworCQlnb3RvIG91dF92bTsKKwl9CiAKIAl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosIHZt
LCBOVUxMKTsKIAlpZiAoSVNfRVJSKHZtYSkpIHsKQEAgLTE2MDcsNiArMTYxMyw4IEBAIHN0YXRp
YyBpbnQgaWd0X3Nocmlua190aHAodm9pZCAqYXJnKQogCWk5MTVfdm1hX2Nsb3NlKHZtYSk7CiBv
dXRfcHV0OgogCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKK291dF92bToKKwlpOTE1X3ZtX3B1
dCh2bSk7CiAKIAlyZXR1cm4gZXJyOwogfQpAQCAtMTY3NSw2ICsxNjgzLDcgQEAgaW50IGk5MTVf
Z2VtX2h1Z2VfcGFnZV9saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKIAl9OwogCXN0cnVjdCBkcm1fZmlsZSAqZmlsZTsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqY3R4OworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwogCWludGVsX3dha2VyZWZf
dCB3YWtlcmVmOwogCWludCBlcnI7CiAKQEAgLTE2OTksOCArMTcwOCwxMSBAQCBpbnQgaTkxNV9n
ZW1faHVnZV9wYWdlX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQogCQlnb3RvIG91dF91bmxvY2s7CiAJfQogCi0JaWYgKGN0eC0+dm0pCi0JCWN0eC0+dm0tPnNj
cnViXzY0SyA9IHRydWU7CisJbXV0ZXhfbG9jaygmY3R4LT5tdXRleCk7CisJdm0gPSBpOTE1X2dl
bV9jb250ZXh0X3ZtKGN0eCk7CisJaWYgKHZtKQorCQlXUklURV9PTkNFKHZtLT5zY3J1Yl82NEss
IHRydWUpOworCW11dGV4X3VubG9jaygmY3R4LT5tdXRleCk7CiAKIAllcnIgPSBpOTE1X3N1YnRl
c3RzKHRlc3RzLCBjdHgpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
c2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9z
ZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCmluZGV4IDJmYjMxYWRhMmZhNy4uZDQ0ZmE5ZDM1
NmYxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVf
Z2VtX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5
MTVfZ2VtX2NvbnRleHQuYwpAQCAtNTMsMTkgKzUzLDE3IEBAIHN0YXRpYyBpbnQgbGl2ZV9ub3Bf
c3dpdGNoKHZvaWQgKmFyZykKIAlpZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRSX0VSUihm
aWxlKTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJY3R4ID0g
a2NhbGxvYyhuY3R4LCBzaXplb2YoKmN0eCksIEdGUF9LRVJORUwpOwogCWlmICghY3R4KSB7CiAJ
CWVyciA9IC1FTk9NRU07Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290byBvdXRfZmlsZTsKIAl9
CiAKIAlmb3IgKG4gPSAwOyBuIDwgbmN0eDsgbisrKSB7CiAJCWN0eFtuXSA9IGxpdmVfY29udGV4
dChpOTE1LCBmaWxlKTsKIAkJaWYgKElTX0VSUihjdHhbbl0pKSB7CiAJCQllcnIgPSBQVFJfRVJS
KGN0eFtuXSk7Ci0JCQlnb3RvIG91dF91bmxvY2s7CisJCQlnb3RvIG91dF9maWxlOwogCQl9CiAJ
fQogCkBAIC03OSw3ICs3Nyw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9ub3Bfc3dpdGNoKHZvaWQgKmFy
ZykKIAkJCXJxID0gaWd0X3JlcXVlc3RfYWxsb2MoY3R4W25dLCBlbmdpbmUpOwogCQkJaWYgKElT
X0VSUihycSkpIHsKIAkJCQllcnIgPSBQVFJfRVJSKHJxKTsKLQkJCQlnb3RvIG91dF91bmxvY2s7
CisJCQkJZ290byBvdXRfZmlsZTsKIAkJCX0KIAkJCWk5MTVfcmVxdWVzdF9hZGQocnEpOwogCQl9
CkBAIC04Nyw3ICs4NSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9ub3Bfc3dpdGNoKHZvaWQgKmFyZykK
IAkJCXByX2VycigiRmFpbGVkIHRvIHBvcHVsYXRlZCAlZCBjb250ZXh0c1xuIiwgbmN0eCk7CiAJ
CQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZpOTE1LT5ndCk7CiAJCQllcnIgPSAtRUlPOwotCQkJZ290
byBvdXRfdW5sb2NrOworCQkJZ290byBvdXRfZmlsZTsKIAkJfQogCiAJCXRpbWVzWzFdID0ga3Rp
bWVfZ2V0X3JhdygpOwpAQCAtOTcsNyArOTUsNyBAQCBzdGF0aWMgaW50IGxpdmVfbm9wX3N3aXRj
aCh2b2lkICphcmcpCiAKIAkJZXJyID0gaWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgaTkxNSwgX19m
dW5jX18sIGVuZ2luZS0+bmFtZSk7CiAJCWlmIChlcnIpCi0JCQlnb3RvIG91dF91bmxvY2s7CisJ
CQlnb3RvIG91dF9maWxlOwogCiAJCWVuZF90aW1lID0gamlmZmllcyArIGk5MTVfc2VsZnRlc3Qu
dGltZW91dF9qaWZmaWVzOwogCQlmb3JfZWFjaF9wcmltZV9udW1iZXJfZnJvbShwcmltZSwgMiwg
ODE5MikgewpAQCAtMTA3LDcgKzEwNSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9ub3Bfc3dpdGNoKHZv
aWQgKmFyZykKIAkJCQlycSA9IGlndF9yZXF1ZXN0X2FsbG9jKGN0eFtuICUgbmN0eF0sIGVuZ2lu
ZSk7CiAJCQkJaWYgKElTX0VSUihycSkpIHsKIAkJCQkJZXJyID0gUFRSX0VSUihycSk7Ci0JCQkJ
CWdvdG8gb3V0X3VubG9jazsKKwkJCQkJZ290byBvdXRfZmlsZTsKIAkJCQl9CiAKIAkJCQkvKgpA
QCAtMTQzLDcgKzE0MSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9ub3Bfc3dpdGNoKHZvaWQgKmFyZykK
IAogCQllcnIgPSBpZ3RfbGl2ZV90ZXN0X2VuZCgmdCk7CiAJCWlmIChlcnIpCi0JCQlnb3RvIG91
dF91bmxvY2s7CisJCQlnb3RvIG91dF9maWxlOwogCiAJCXByX2luZm8oIlN3aXRjaCBsYXRlbmNp
ZXMgb24gJXM6IDEgPSAlbGx1bnMsICVsdSA9ICVsbHVuc1xuIiwKIAkJCWVuZ2luZS0+bmFtZSwK
QEAgLTE1MSw4ICsxNDksNyBAQCBzdGF0aWMgaW50IGxpdmVfbm9wX3N3aXRjaCh2b2lkICphcmcp
CiAJCQlwcmltZSAtIDEsIGRpdjY0X3U2NChrdGltZV90b19ucyh0aW1lc1sxXSksIHByaW1lIC0g
MSkpOwogCX0KIAotb3V0X3VubG9jazoKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOworb3V0X2ZpbGU6CiAJbW9ja19maWxlX2ZyZWUoaTkxNSwgZmlsZSk7CiAJcmV0dXJu
IGVycjsKIH0KQEAgLTI1MywxMiArMjUwLDEwIEBAIHN0YXRpYyBpbnQgbGl2ZV9wYXJhbGxlbF9z
d2l0Y2godm9pZCAqYXJnKQogCWlmIChJU19FUlIoZmlsZSkpCiAJCXJldHVybiBQVFJfRVJSKGZp
bGUpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAljdHggPSBs
aXZlX2NvbnRleHQoaTkxNSwgZmlsZSk7CiAJaWYgKElTX0VSUihjdHgpKSB7CiAJCWVyciA9IFBU
Ul9FUlIoY3R4KTsKLQkJZ290byBvdXRfbG9ja2VkOworCQlnb3RvIG91dF9maWxlOwogCX0KIAog
CWVuZ2luZXMgPSBpOTE1X2dlbV9jb250ZXh0X2xvY2tfZW5naW5lcyhjdHgpOwpAQCAtMjY4LDcg
KzI2Myw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9wYXJhbGxlbF9zd2l0Y2godm9pZCAqYXJnKQogCWlm
ICghZGF0YSkgewogCQlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19lbmdpbmVzKGN0eCk7CiAJCWVy
ciA9IC1FTk9NRU07Ci0JCWdvdG8gb3V0X2xvY2tlZDsKKwkJZ290byBvdXQ7CiAJfQogCiAJbSA9
IDA7IC8qIFVzZSB0aGUgZmlyc3QgY29udGV4dCBhcyBvdXIgdGVtcGxhdGUgZm9yIHRoZSBlbmdp
bmVzICovCkBAIC0yNzYsNyArMjcxLDcgQEAgc3RhdGljIGludCBsaXZlX3BhcmFsbGVsX3N3aXRj
aCh2b2lkICphcmcpCiAJCWVyciA9IGludGVsX2NvbnRleHRfcGluKGNlKTsKIAkJaWYgKGVycikg
ewogCQkJaTkxNV9nZW1fY29udGV4dF91bmxvY2tfZW5naW5lcyhjdHgpOwotCQkJZ290byBvdXRf
bG9ja2VkOworCQkJZ290byBvdXQ7CiAJCX0KIAkJZGF0YVttKytdLmNlWzBdID0gaW50ZWxfY29u
dGV4dF9nZXQoY2UpOwogCX0KQEAgLTI4Nyw3ICsyODIsNyBAQCBzdGF0aWMgaW50IGxpdmVfcGFy
YWxsZWxfc3dpdGNoKHZvaWQgKmFyZykKIAkJY3R4ID0gbGl2ZV9jb250ZXh0KGk5MTUsIGZpbGUp
OwogCQlpZiAoSVNfRVJSKGN0eCkpIHsKIAkJCWVyciA9IFBUUl9FUlIoY3R4KTsKLQkJCWdvdG8g
b3V0X2xvY2tlZDsKKwkJCWdvdG8gb3V0OwogCQl9CiAKIAkJZm9yIChtID0gMDsgbSA8IGNvdW50
OyBtKyspIHsKQEAgLTI5NiwyMCArMjkxLDE4IEBAIHN0YXRpYyBpbnQgbGl2ZV9wYXJhbGxlbF9z
d2l0Y2godm9pZCAqYXJnKQogCiAJCQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGN0eCwgZGF0
YVttXS5jZVswXS0+ZW5naW5lKTsKIAkJCWlmIChJU19FUlIoY2UpKQotCQkJCWdvdG8gb3V0X2xv
Y2tlZDsKKwkJCQlnb3RvIG91dDsKIAogCQkJZXJyID0gaW50ZWxfY29udGV4dF9waW4oY2UpOwog
CQkJaWYgKGVycikgewogCQkJCWludGVsX2NvbnRleHRfcHV0KGNlKTsKLQkJCQlnb3RvIG91dF9s
b2NrZWQ7CisJCQkJZ290byBvdXQ7CiAJCQl9CiAKIAkJCWRhdGFbbV0uY2Vbbl0gPSBjZTsKIAkJ
fQogCX0KIAotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlmb3Ig
KGZuID0gZnVuYzsgIWVyciAmJiAqZm47IGZuKyspIHsKIAkJc3RydWN0IGlndF9saXZlX3Rlc3Qg
dDsKIAkJaW50IG47CkBAIC0zNTQsOCArMzQ3LDcgQEAgc3RhdGljIGludCBsaXZlX3BhcmFsbGVs
X3N3aXRjaCh2b2lkICphcmcpCiAJCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAJfQogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci1vdXRfbG9j
a2VkOgorb3V0OgogCWZvciAobiA9IDA7IG4gPCBjb3VudDsgbisrKSB7CiAJCWZvciAobSA9IDA7
IG0gPCBBUlJBWV9TSVpFKGRhdGEtPmNlKTsgbSsrKSB7CiAJCQlpZiAoIWRhdGFbbl0uY2VbbV0p
CkBAIC0zNjUsOCArMzU3LDggQEAgc3RhdGljIGludCBsaXZlX3BhcmFsbGVsX3N3aXRjaCh2b2lk
ICphcmcpCiAJCQlpbnRlbF9jb250ZXh0X3B1dChkYXRhW25dLmNlW21dKTsKIAkJfQogCX0KLQlt
dXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWtmcmVlKGRhdGEpOworb3V0
X2ZpbGU6CiAJbW9ja19maWxlX2ZyZWUoaTkxNSwgZmlsZSk7CiAJcmV0dXJuIGVycjsKIH0KQEAg
LTYyNiwxMSArNjE4LDkgQEAgc3RhdGljIGludCBpZ3RfY3R4X2V4ZWModm9pZCAqYXJnKQogCQlp
ZiAoSVNfRVJSKGZpbGUpKQogCQkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAKLQkJbXV0ZXhfbG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAkJZXJyID0gaWd0X2xpdmVfdGVzdF9iZWdp
bigmdCwgaTkxNSwgX19mdW5jX18sIGVuZ2luZS0+bmFtZSk7CiAJCWlmIChlcnIpCi0JCQlnb3Rv
IG91dF91bmxvY2s7CisJCQlnb3RvIG91dF9maWxlOwogCiAJCW5jb250ZXh0cyA9IDA7CiAJCW5k
d29yZHMgPSAwOwpAQCAtNjQyLDcgKzYzMiw3IEBAIHN0YXRpYyBpbnQgaWd0X2N0eF9leGVjKHZv
aWQgKmFyZykKIAkJCWN0eCA9IGtlcm5lbF9jb250ZXh0KGk5MTUpOwogCQkJaWYgKElTX0VSUihj
dHgpKSB7CiAJCQkJZXJyID0gUFRSX0VSUihjdHgpOwotCQkJCWdvdG8gb3V0X3VubG9jazsKKwkJ
CQlnb3RvIG91dF9maWxlOwogCQkJfQogCiAJCQljZSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X2Vu
Z2luZShjdHgsIGVuZ2luZS0+bGVnYWN5X2lkeCk7CkBAIC02NTQsNyArNjQ0LDcgQEAgc3RhdGlj
IGludCBpZ3RfY3R4X2V4ZWModm9pZCAqYXJnKQogCQkJCQllcnIgPSBQVFJfRVJSKG9iaik7CiAJ
CQkJCWludGVsX2NvbnRleHRfcHV0KGNlKTsKIAkJCQkJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4
KTsKLQkJCQkJZ290byBvdXRfdW5sb2NrOworCQkJCQlnb3RvIG91dF9maWxlOwogCQkJCX0KIAkJ
CX0KIApAQCAtNjYzLDE3ICs2NTMsMTggQEAgc3RhdGljIGludCBpZ3RfY3R4X2V4ZWModm9pZCAq
YXJnKQogCQkJCXByX2VycigiRmFpbGVkIHRvIGZpbGwgZHdvcmQgJWx1IFslbHUvJWx1XSB3aXRo
IGdwdSAoJXMpIFtmdWxsLXBwZ3R0PyAlc10sIGVycj0lZFxuIiwKIAkJCQkgICAgICAgbmR3b3Jk
cywgZHcsIG1heF9kd29yZHMob2JqKSwKIAkJCQkgICAgICAgZW5naW5lLT5uYW1lLAotCQkJCSAg
ICAgICB5ZXNubyghIWN0eC0+dm0pLCBlcnIpOworCQkJCSAgICAgICB5ZXNubyghIXJjdV9hY2Nl
c3NfcG9pbnRlcihjdHgtPnZtKSksCisJCQkJICAgICAgIGVycik7CiAJCQkJaW50ZWxfY29udGV4
dF9wdXQoY2UpOwogCQkJCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7Ci0JCQkJZ290byBvdXRf
dW5sb2NrOworCQkJCWdvdG8gb3V0X2ZpbGU7CiAJCQl9CiAKIAkJCWVyciA9IHRocm90dGxlKGNl
LCB0cSwgQVJSQVlfU0laRSh0cSkpOwogCQkJaWYgKGVycikgewogCQkJCWludGVsX2NvbnRleHRf
cHV0KGNlKTsKIAkJCQlrZXJuZWxfY29udGV4dF9jbG9zZShjdHgpOwotCQkJCWdvdG8gb3V0X3Vu
bG9jazsKKwkJCQlnb3RvIG91dF9maWxlOwogCQkJfQogCiAJCQlpZiAoKytkdyA9PSBtYXhfZHdv
cmRzKG9iaikpIHsKQEAgLTcwMywxMSArNjk0LDEwIEBAIHN0YXRpYyBpbnQgaWd0X2N0eF9leGVj
KHZvaWQgKmFyZykKIAkJCWR3ICs9IHJlbTsKIAkJfQogCi1vdXRfdW5sb2NrOgorb3V0X2ZpbGU6
CiAJCXRocm90dGxlX3JlbGVhc2UodHEsIEFSUkFZX1NJWkUodHEpKTsKIAkJaWYgKGlndF9saXZl
X3Rlc3RfZW5kKCZ0KSkKIAkJCWVyciA9IC1FSU87Ci0JCW11dGV4X3VubG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CiAKIAkJbW9ja19maWxlX2ZyZWUoaTkxNSwgZmlsZSk7CiAJCWlmIChl
cnIpCkBAIC03NDIsMjIgKzczMiwyMCBAQCBzdGF0aWMgaW50IGlndF9zaGFyZWRfY3R4X2V4ZWMo
dm9pZCAqYXJnKQogCWlmIChJU19FUlIoZmlsZSkpCiAJCXJldHVybiBQVFJfRVJSKGZpbGUpOwog
Ci0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlwYXJlbnQgPSBsaXZl
X2NvbnRleHQoaTkxNSwgZmlsZSk7CiAJaWYgKElTX0VSUihwYXJlbnQpKSB7CiAJCWVyciA9IFBU
Ul9FUlIocGFyZW50KTsKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3RvIG91dF9maWxlOwogCX0K
IAogCWlmICghcGFyZW50LT52bSkgeyAvKiBub3QgZnVsbC1wcGd0dDsgbm90aGluZyB0byBzaGFy
ZSAqLwogCQllcnIgPSAwOwotCQlnb3RvIG91dF91bmxvY2s7CisJCWdvdG8gb3V0X2ZpbGU7CiAJ
fQogCiAJZXJyID0gaWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgaTkxNSwgX19mdW5jX18sICIiKTsK
IAlpZiAoZXJyKQotCQlnb3RvIG91dF91bmxvY2s7CisJCWdvdG8gb3V0X2ZpbGU7CiAKIAlmb3Jf
ZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgewogCQl1bnNpZ25lZCBsb25nIG5jb250ZXh0
cywgbmR3b3JkcywgZHc7CkBAIC03ODEsNyArNzY5LDkgQEAgc3RhdGljIGludCBpZ3Rfc2hhcmVk
X2N0eF9leGVjKHZvaWQgKmFyZykKIAkJCQlnb3RvIG91dF90ZXN0OwogCQkJfQogCisJCQltdXRl
eF9sb2NrKCZjdHgtPm11dGV4KTsKIAkJCV9fYXNzaWduX3BwZ3R0KGN0eCwgcGFyZW50LT52bSk7
CisJCQltdXRleF91bmxvY2soJmN0eC0+bXV0ZXgpOwogCiAJCQljZSA9IGk5MTVfZ2VtX2NvbnRl
eHRfZ2V0X2VuZ2luZShjdHgsIGVuZ2luZS0+bGVnYWN5X2lkeCk7CiAJCQlHRU1fQlVHX09OKElT
X0VSUihjZSkpOwpAQCAtODAxLDcgKzc5MSw4IEBAIHN0YXRpYyBpbnQgaWd0X3NoYXJlZF9jdHhf
ZXhlYyh2b2lkICphcmcpCiAJCQkJcHJfZXJyKCJGYWlsZWQgdG8gZmlsbCBkd29yZCAlbHUgWyVs
dS8lbHVdIHdpdGggZ3B1ICglcykgW2Z1bGwtcHBndHQ/ICVzXSwgZXJyPSVkXG4iLAogCQkJCSAg
ICAgICBuZHdvcmRzLCBkdywgbWF4X2R3b3JkcyhvYmopLAogCQkJCSAgICAgICBlbmdpbmUtPm5h
bWUsCi0JCQkJICAgICAgIHllc25vKCEhY3R4LT52bSksIGVycik7CisJCQkJICAgICAgIHllc25v
KCEhcmN1X2FjY2Vzc19wb2ludGVyKGN0eC0+dm0pKSwKKwkJCQkgICAgICAgZXJyKTsKIAkJCQlp
bnRlbF9jb250ZXh0X3B1dChjZSk7CiAJCQkJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKIAkJ
CQlnb3RvIG91dF90ZXN0OwpAQCAtODQwLDE3ICs4MzEsMTMgQEAgc3RhdGljIGludCBpZ3Rfc2hh
cmVkX2N0eF9leGVjKHZvaWQgKmFyZykKIAkJCWR3ICs9IHJlbTsKIAkJfQogCi0JCW11dGV4X3Vu
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWk5MTVfZ2VtX2RyYWluX2ZyZWVkX29i
amVjdHMoaTkxNSk7Ci0JCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCX0K
IG91dF90ZXN0OgogCXRocm90dGxlX3JlbGVhc2UodHEsIEFSUkFZX1NJWkUodHEpKTsKIAlpZiAo
aWd0X2xpdmVfdGVzdF9lbmQoJnQpKQogCQllcnIgPSAtRUlPOwotb3V0X3VubG9jazoKLQltdXRl
eF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCitvdXRfZmlsZToKIAltb2NrX2Zp
bGVfZnJlZShpOTE1LCBmaWxlKTsKIAlyZXR1cm4gZXJyOwogfQpAQCAtMTIyMiw4ICsxMjA5LDYg
QEAgX19pZ3RfY3R4X3NzZXUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJaWYgKGZs
YWdzICYgVEVTVF9SRVNFVCkKIAkJaWd0X2dsb2JhbF9yZXNldF9sb2NrKCZpOTE1LT5ndCk7CiAK
LQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWN0eCA9IGxpdmVfY29u
dGV4dChpOTE1LCBmaWxlKTsKIAlpZiAoSVNfRVJSKGN0eCkpIHsKIAkJcmV0ID0gUFRSX0VSUihj
dHgpOwpAQCAtMTI3OCw4ICsxMjYzLDYgQEAgX19pZ3RfY3R4X3NzZXUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwogCiBvdXRfdW5sb2Nr
OgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlpZiAoZmxhZ3Mg
JiBURVNUX1JFU0VUKQogCQlpZ3RfZ2xvYmFsX3Jlc2V0X3VubG9jaygmaTkxNS0+Z3QpOwogCkBA
IC0xMzM5LDIzICsxMzIyLDI0IEBAIHN0YXRpYyBpbnQgaWd0X2N0eF9yZWFkb25seSh2b2lkICph
cmcpCiAJaWYgKElTX0VSUihmaWxlKSkKIAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAKLQltdXRl
eF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWVyciA9IGlndF9saXZlX3Rlc3Rf
YmVnaW4oJnQsIGk5MTUsIF9fZnVuY19fLCAiIik7CiAJaWYgKGVycikKLQkJZ290byBvdXRfdW5s
b2NrOworCQlnb3RvIG91dF9maWxlOwogCiAJY3R4ID0gbGl2ZV9jb250ZXh0KGk5MTUsIGZpbGUp
OwogCWlmIChJU19FUlIoY3R4KSkgewogCQllcnIgPSBQVFJfRVJSKGN0eCk7Ci0JCWdvdG8gb3V0
X3VubG9jazsKKwkJZ290byBvdXRfZmlsZTsKIAl9CiAKLQl2bSA9IGN0eC0+dm0gPzogJmk5MTUt
PmdndHQuYWxpYXMtPnZtOworCXJjdV9yZWFkX2xvY2soKTsKKwl2bSA9IHJjdV9kZXJlZmVyZW5j
ZShjdHgtPnZtKSA/OiAmaTkxNS0+Z2d0dC5hbGlhcy0+dm07CiAJaWYgKCF2bSB8fCAhdm0tPmhh
c19yZWFkX29ubHkpIHsKKwkJcmN1X3JlYWRfdW5sb2NrKCk7CiAJCWVyciA9IDA7Ci0JCWdvdG8g
b3V0X3VubG9jazsKKwkJZ290byBvdXRfZmlsZTsKIAl9CisJcmN1X3JlYWRfdW5sb2NrKCk7CiAK
IAluZHdvcmRzID0gMDsKIAlkdyA9IDA7CkBAIC0xMzczLDcgKzEzNTcsNyBAQCBzdGF0aWMgaW50
IGlndF9jdHhfcmVhZG9ubHkodm9pZCAqYXJnKQogCQkJCWlmIChJU19FUlIob2JqKSkgewogCQkJ
CQllcnIgPSBQVFJfRVJSKG9iaik7CiAJCQkJCWk5MTVfZ2VtX2NvbnRleHRfdW5sb2NrX2VuZ2lu
ZXMoY3R4KTsKLQkJCQkJZ290byBvdXRfdW5sb2NrOworCQkJCQlnb3RvIG91dF9maWxlOwogCQkJ
CX0KIAogCQkJCWlmIChwcmFuZG9tX3UzMl9zdGF0ZSgmcHJuZykgJiAxKQpAQCAtMTM4NCwxNSAr
MTM2OCwxNyBAQCBzdGF0aWMgaW50IGlndF9jdHhfcmVhZG9ubHkodm9pZCAqYXJnKQogCQkJaWYg
KGVycikgewogCQkJCXByX2VycigiRmFpbGVkIHRvIGZpbGwgZHdvcmQgJWx1IFslbHUvJWx1XSB3
aXRoIGdwdSAoJXMpIFtmdWxsLXBwZ3R0PyAlc10sIGVycj0lZFxuIiwKIAkJCQkgICAgICAgbmR3
b3JkcywgZHcsIG1heF9kd29yZHMob2JqKSwKLQkJCQkgICAgICAgY2UtPmVuZ2luZS0+bmFtZSwg
eWVzbm8oISFjdHgtPnZtKSwgZXJyKTsKKwkJCQkgICAgICAgY2UtPmVuZ2luZS0+bmFtZSwKKwkJ
CQkgICAgICAgeWVzbm8oISFyY3VfYWNjZXNzX3BvaW50ZXIoY3R4LT52bSkpLAorCQkJCSAgICAg
ICBlcnIpOwogCQkJCWk5MTVfZ2VtX2NvbnRleHRfdW5sb2NrX2VuZ2luZXMoY3R4KTsKLQkJCQln
b3RvIG91dF91bmxvY2s7CisJCQkJZ290byBvdXRfZmlsZTsKIAkJCX0KIAogCQkJZXJyID0gdGhy
b3R0bGUoY2UsIHRxLCBBUlJBWV9TSVpFKHRxKSk7CiAJCQlpZiAoZXJyKSB7CiAJCQkJaTkxNV9n
ZW1fY29udGV4dF91bmxvY2tfZW5naW5lcyhjdHgpOwotCQkJCWdvdG8gb3V0X3VubG9jazsKKwkJ
CQlnb3RvIG91dF9maWxlOwogCQkJfQogCiAJCQlpZiAoKytkdyA9PSBtYXhfZHdvcmRzKG9iaikp
IHsKQEAgLTE0MjQsMjAgKzE0MTAsMTkgQEAgc3RhdGljIGludCBpZ3RfY3R4X3JlYWRvbmx5KHZv
aWQgKmFyZykKIAkJZHcgKz0gcmVtOwogCX0KIAotb3V0X3VubG9jazoKK291dF9maWxlOgogCXRo
cm90dGxlX3JlbGVhc2UodHEsIEFSUkFZX1NJWkUodHEpKTsKIAlpZiAoaWd0X2xpdmVfdGVzdF9l
bmQoJnQpKQogCQllcnIgPSAtRUlPOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAKIAltb2NrX2ZpbGVfZnJlZShpOTE1LCBmaWxlKTsKIAlyZXR1cm4gZXJyOwogfQog
Ci1zdGF0aWMgaW50IGNoZWNrX3NjcmF0Y2goc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwg
dTY0IG9mZnNldCkKK3N0YXRpYyBpbnQgY2hlY2tfc2NyYXRjaChzdHJ1Y3QgaTkxNV9hZGRyZXNz
X3NwYWNlICp2bSwgdTY0IG9mZnNldCkKIHsKIAlzdHJ1Y3QgZHJtX21tX25vZGUgKm5vZGUgPQot
CQlfX2RybV9tbV9pbnRlcnZhbF9maXJzdCgmY3R4LT52bS0+bW0sCisJCV9fZHJtX21tX2ludGVy
dmFsX2ZpcnN0KCZ2bS0+bW0sCiAJCQkJCW9mZnNldCwgb2Zmc2V0ICsgc2l6ZW9mKHUzMikgLSAx
KTsKIAlpZiAoIW5vZGUgfHwgbm9kZS0+c3RhcnQgPiBvZmZzZXQpCiAJCXJldHVybiAwOwpAQCAt
MTQ1NSw2ICsxNDQwLDcgQEAgc3RhdGljIGludCB3cml0ZV90b19zY3JhdGNoKHN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICpjdHgsCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBj
dHgtPmk5MTU7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKKwlzdHJ1Y3QgaTkx
NV9hZGRyZXNzX3NwYWNlICp2bTsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAlzdHJ1Y3Qg
aTkxNV92bWEgKnZtYTsKIAl1MzIgKmNtZDsKQEAgLTE0ODcsMTcgKzE0NzMsMTggQEAgc3RhdGlj
IGludCB3cml0ZV90b19zY3JhdGNoKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAKIAlp
bnRlbF9ndF9jaGlwc2V0X2ZsdXNoKGVuZ2luZS0+Z3QpOwogCi0Jdm1hID0gaTkxNV92bWFfaW5z
dGFuY2Uob2JqLCBjdHgtPnZtLCBOVUxMKTsKKwl2bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3Zt
X3JjdShjdHgpOworCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgdm0sIE5VTEwpOwogCWlm
IChJU19FUlIodm1hKSkgewogCQllcnIgPSBQVFJfRVJSKHZtYSk7Ci0JCWdvdG8gZXJyOworCQln
b3RvIGVycl92bTsKIAl9CiAKIAllcnIgPSBpOTE1X3ZtYV9waW4odm1hLCAwLCAwLCBQSU5fVVNF
UiB8IFBJTl9PRkZTRVRfRklYRUQpOwogCWlmIChlcnIpCi0JCWdvdG8gZXJyOworCQlnb3RvIGVy
cl92bTsKIAotCWVyciA9IGNoZWNrX3NjcmF0Y2goY3R4LCBvZmZzZXQpOworCWVyciA9IGNoZWNr
X3NjcmF0Y2godm0sIG9mZnNldCk7CiAJaWYgKGVycikKIAkJZ290byBlcnJfdW5waW47CiAKQEAg
LTE1MjMsNiArMTUxMCw3IEBAIHN0YXRpYyBpbnQgd3JpdGVfdG9fc2NyYXRjaChzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dCAqY3R4LAogCiAJaTkxNV9yZXF1ZXN0X2FkZChycSk7CiAKKwlpOTE1X3Zt
X3B1dCh2bSk7CiAJcmV0dXJuIDA7CiAKIHNraXBfcmVxdWVzdDoKQEAgLTE1MzEsNiArMTUxOSw4
IEBAIHN0YXRpYyBpbnQgd3JpdGVfdG9fc2NyYXRjaChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAq
Y3R4LAogCWk5MTVfcmVxdWVzdF9hZGQocnEpOwogZXJyX3VucGluOgogCWk5MTVfdm1hX3VucGlu
KHZtYSk7CitlcnJfdm06CisJaTkxNV92bV9wdXQodm0pOwogZXJyOgogCWk5MTVfZ2VtX29iamVj
dF9wdXQob2JqKTsKIAlyZXR1cm4gZXJyOwpAQCAtMTU0Miw2ICsxNTMyLDcgQEAgc3RhdGljIGlu
dCByZWFkX2Zyb21fc2NyYXRjaChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogewogCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gY3R4LT5pOTE1OwogCXN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmo7CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CiAJY29u
c3QgdTMyIFJDU19HUFIwID0gMHgyNjAwOyAvKiBub3QgYWxsIGVuZ2luZXMgaGF2ZSB0aGVpciBv
d24gR1BSISAqLwogCWNvbnN0IHUzMiByZXN1bHQgPSAweDEwMDsKIAlzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycTsKQEAgLTE1ODYsMTcgKzE1NzcsMTggQEAgc3RhdGljIGludCByZWFkX2Zyb21fc2Ny
YXRjaChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogCiAJaW50ZWxfZ3RfY2hpcHNldF9m
bHVzaChlbmdpbmUtPmd0KTsKIAotCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgY3R4LT52
bSwgTlVMTCk7CisJdm0gPSBpOTE1X2dlbV9jb250ZXh0X2dldF92bV9yY3UoY3R4KTsKKwl2bWEg
PSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosIHZtLCBOVUxMKTsKIAlpZiAoSVNfRVJSKHZtYSkpIHsK
IAkJZXJyID0gUFRSX0VSUih2bWEpOwotCQlnb3RvIGVycjsKKwkJZ290byBlcnJfdm07CiAJfQog
CiAJZXJyID0gaTkxNV92bWFfcGluKHZtYSwgMCwgMCwgUElOX1VTRVIgfCBQSU5fT0ZGU0VUX0ZJ
WEVEKTsKIAlpZiAoZXJyKQotCQlnb3RvIGVycjsKKwkJZ290byBlcnJfdm07CiAKLQllcnIgPSBj
aGVja19zY3JhdGNoKGN0eCwgb2Zmc2V0KTsKKwllcnIgPSBjaGVja19zY3JhdGNoKHZtLCBvZmZz
ZXQpOwogCWlmIChlcnIpCiAJCWdvdG8gZXJyX3VucGluOwogCkBAIC0xNjI3LDEyICsxNjE5LDEy
IEBAIHN0YXRpYyBpbnQgcmVhZF9mcm9tX3NjcmF0Y2goc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQg
KmN0eCwKIAllcnIgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2NwdV9kb21haW4ob2JqLCBmYWxz
ZSk7CiAJaTkxNV9nZW1fb2JqZWN0X3VubG9jayhvYmopOwogCWlmIChlcnIpCi0JCWdvdG8gZXJy
OworCQlnb3RvIGVycl92bTsKIAogCWNtZCA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKG9iaiwg
STkxNV9NQVBfV0IpOwogCWlmIChJU19FUlIoY21kKSkgewogCQllcnIgPSBQVFJfRVJSKGNtZCk7
Ci0JCWdvdG8gZXJyOworCQlnb3RvIGVycl92bTsKIAl9CiAKIAkqdmFsdWUgPSBjbWRbcmVzdWx0
IC8gc2l6ZW9mKCpjbWQpXTsKQEAgLTE2NDcsNiArMTYzOSw4IEBAIHN0YXRpYyBpbnQgcmVhZF9m
cm9tX3NjcmF0Y2goc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAlpOTE1X3JlcXVlc3Rf
YWRkKHJxKTsKIGVycl91bnBpbjoKIAlpOTE1X3ZtYV91bnBpbih2bWEpOworZXJyX3ZtOgorCWk5
MTVfdm1fcHV0KHZtKTsKIGVycjoKIAlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CiAJcmV0dXJu
IGVycjsKQEAgLTE2NzcsMjcgKzE2NzEsMjUgQEAgc3RhdGljIGludCBpZ3Rfdm1faXNvbGF0aW9u
KHZvaWQgKmFyZykKIAlpZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsK
IAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJZXJyID0gaWd0X2xp
dmVfdGVzdF9iZWdpbigmdCwgaTkxNSwgX19mdW5jX18sICIiKTsKIAlpZiAoZXJyKQotCQlnb3Rv
IG91dF91bmxvY2s7CisJCWdvdG8gb3V0X2ZpbGU7CiAKIAljdHhfYSA9IGxpdmVfY29udGV4dChp
OTE1LCBmaWxlKTsKIAlpZiAoSVNfRVJSKGN0eF9hKSkgewogCQllcnIgPSBQVFJfRVJSKGN0eF9h
KTsKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3RvIG91dF9maWxlOwogCX0KIAogCWN0eF9iID0g
bGl2ZV9jb250ZXh0KGk5MTUsIGZpbGUpOwogCWlmIChJU19FUlIoY3R4X2IpKSB7CiAJCWVyciA9
IFBUUl9FUlIoY3R4X2IpOwotCQlnb3RvIG91dF91bmxvY2s7CisJCWdvdG8gb3V0X2ZpbGU7CiAJ
fQogCiAJLyogV2UgY2FuIG9ubHkgdGVzdCB2bSBpc29sYXRpb24sIGlmIHRoZSB2bSBhcmUgZGlz
dGluY3QgKi8KIAlpZiAoY3R4X2EtPnZtID09IGN0eF9iLT52bSkKLQkJZ290byBvdXRfdW5sb2Nr
OworCQlnb3RvIG91dF9maWxlOwogCiAJdm1fdG90YWwgPSBjdHhfYS0+dm0tPnRvdGFsOwogCUdF
TV9CVUdfT04oY3R4X2ItPnZtLT50b3RhbCAhPSB2bV90b3RhbCk7CkBAIC0xNzI2LDcgKzE3MTgs
NyBAQCBzdGF0aWMgaW50IGlndF92bV9pc29sYXRpb24odm9pZCAqYXJnKQogCQkJCWVyciA9IHJl
YWRfZnJvbV9zY3JhdGNoKGN0eF9iLCBlbmdpbmUsCiAJCQkJCQkJb2Zmc2V0LCAmdmFsdWUpOwog
CQkJaWYgKGVycikKLQkJCQlnb3RvIG91dF91bmxvY2s7CisJCQkJZ290byBvdXRfZmlsZTsKIAog
CQkJaWYgKHZhbHVlKSB7CiAJCQkJcHJfZXJyKCIlczogUmVhZCAlMDh4IGZyb20gc2NyYXRjaCAo
b2Zmc2V0IDB4JTA4eF8lMDh4KSwgYWZ0ZXIgJWx1IHJlYWRzIVxuIiwKQEAgLTE3MzUsNyArMTcy
Nyw3IEBAIHN0YXRpYyBpbnQgaWd0X3ZtX2lzb2xhdGlvbih2b2lkICphcmcpCiAJCQkJICAgICAg
IGxvd2VyXzMyX2JpdHMob2Zmc2V0KSwKIAkJCQkgICAgICAgdGhpcyk7CiAJCQkJZXJyID0gLUVJ
TlZBTDsKLQkJCQlnb3RvIG91dF91bmxvY2s7CisJCQkJZ290byBvdXRfZmlsZTsKIAkJCX0KIAog
CQkJdGhpcysrOwpAQCAtMTc0NSwxMSArMTczNyw5IEBAIHN0YXRpYyBpbnQgaWd0X3ZtX2lzb2xh
dGlvbih2b2lkICphcmcpCiAJcHJfaW5mbygiQ2hlY2tlZCAlbHUgc2NyYXRjaCBvZmZzZXRzIGFj
cm9zcyAlZCBlbmdpbmVzXG4iLAogCQljb3VudCwgUlVOVElNRV9JTkZPKGk5MTUpLT5udW1fZW5n
aW5lcyk7CiAKLW91dF91bmxvY2s6CitvdXRfZmlsZToKIAlpZiAoaWd0X2xpdmVfdGVzdF9lbmQo
JnQpKQogCQllcnIgPSAtRUlPOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7Ci0KIAltb2NrX2ZpbGVfZnJlZShpOTE1LCBmaWxlKTsKIAlyZXR1cm4gZXJyOwogfQpAQCAt
MTc4MSwxMyArMTc3MSw5IEBAIHN0YXRpYyBpbnQgbW9ja19jb250ZXh0X2JhcnJpZXIodm9pZCAq
YXJnKQogCSAqIGEgcmVxdWVzdDsgdXNlZnVsIGZvciByZXRpcmluZyBvbGQgc3RhdGUgYWZ0ZXIg
bG9hZGluZyBuZXcuCiAJICovCiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKLQogCWN0eCA9IG1vY2tfY29udGV4dChpOTE1LCAibW9jayIpOwotCWlmICghY3R4KSB7Ci0J
CWVyciA9IC1FTk9NRU07Ci0JCWdvdG8gdW5sb2NrOwotCX0KKwlpZiAoIWN0eCkKKwkJcmV0dXJu
IC1FTk9NRU07CiAKIAljb3VudGVyID0gMDsKIAllcnIgPSBjb250ZXh0X2JhcnJpZXJfdGFzayhj
dHgsIDAsCkBAIC0xODYwLDggKzE4NDYsNiBAQCBzdGF0aWMgaW50IG1vY2tfY29udGV4dF9iYXJy
aWVyKHZvaWQgKmFyZykKIAogb3V0OgogCW1vY2tfY29udGV4dF9jbG9zZShjdHgpOwotdW5sb2Nr
OgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsK
ICN1bmRlZiBwcl9mbXQKICNkZWZpbmUgcHJfZm10KHgpIHgKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvbW9ja19jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vc2VsZnRlc3RzL21vY2tfY29udGV4dC5jCmluZGV4IDAxMDRmMTZiMTMyNy4u
ZmQ3OTlkZWZkOGJlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRl
c3RzL21vY2tfY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVz
dHMvbW9ja19jb250ZXh0LmMKQEAgLTY1LDcgKzY1LDcgQEAgdm9pZCBtb2NrX2NvbnRleHRfY2xv
c2Uoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIAogdm9pZCBtb2NrX2luaXRfY29udGV4
dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JaW5pdF9jb250ZXh0cyhpOTE1
KTsKKwlpbml0X2NvbnRleHRzKCZpOTE1LT5nZW0uY29udGV4dHMpOwogfQogCiBzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dCAqCkBAIC03NCw4ICs3NCw2IEBAIGxpdmVfY29udGV4dChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwgc3RydWN0IGRybV9maWxlICpmaWxlKQogCXN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICpjdHg7CiAJaW50IGVycjsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJY3R4ID0gaTkxNV9nZW1fY3JlYXRlX2NvbnRleHQo
aTkxNSwgMCk7CiAJaWYgKElTX0VSUihjdHgpKQogCQlyZXR1cm4gY3R4OwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCmluZGV4IDM1YTQwYzI4MjBhMi4uYmUzNGQ5N2FjMThm
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCkBAIC0yMjEsMTIgKzIy
MSwyMCBAQCBpbnRlbF9jb250ZXh0X2luaXQoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCQkg
ICBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogCQkgICBzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmUpCiB7CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CisKIAlHRU1f
QlVHX09OKCFlbmdpbmUtPmNvcHMpOwogCiAJa3JlZl9pbml0KCZjZS0+cmVmKTsKIAogCWNlLT5n
ZW1fY29udGV4dCA9IGN0eDsKLQljZS0+dm0gPSBpOTE1X3ZtX2dldChjdHgtPnZtID86ICZlbmdp
bmUtPmd0LT5nZ3R0LT52bSk7CisJcmN1X3JlYWRfbG9jaygpOworCXZtID0gcmN1X2RlcmVmZXJl
bmNlKGN0eC0+dm0pOworCWlmICh2bSkKKwkJY2UtPnZtID0gaTkxNV92bV9nZXQodm0pOworCWVs
c2UKKwkJY2UtPnZtID0gaTkxNV92bV9nZXQoJmVuZ2luZS0+Z3QtPmdndHQtPnZtKTsKKwlyY3Vf
cmVhZF91bmxvY2soKTsKIAlpZiAoY3R4LT50aW1lbGluZSkKIAkJY2UtPnRpbWVsaW5lID0gaW50
ZWxfdGltZWxpbmVfZ2V0KGN0eC0+dGltZWxpbmUpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2xyYy5jCmluZGV4IDQ2ODQzOGZiNDdhZi4uNDcxYzIzZDBjZmZiIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9scmMuYwpAQCAtOTgxLDYgKzk4MSwxMSBAQCBfX2V4ZWNsaXN0c19zY2hlZHVs
ZV9pbihzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAkJY2UtPmxyY19kZXNjIHw9CiAJCQkodTY0
KShlbmdpbmUtPmNvbnRleHRfdGFnKysgJSBOVU1fQ09OVEVYVF9UQUcpIDw8CiAJCQlHRU4xMV9T
V19DVFhfSURfU0hJRlQ7CisKKyNkZWZpbmUgR0VOMTFfTUFYX0NPTlRFWFRfSFdfSUQgKDE8PDEx
KSAvKiBleGNsdXNpdmUgKi8KKy8qIGluIEdlbjEyIElEIDB4N0ZGIGlzIHJlc2VydmVkIHRvIGlu
ZGljYXRlIGlkbGUgKi8KKyNkZWZpbmUgR0VOMTJfTUFYX0NPTlRFWFRfSFdfSUQgICAgICAgIChH
RU4xMV9NQVhfQ09OVEVYVF9IV19JRCAtIDEpCisKIAkJQlVJTERfQlVHX09OKE5VTV9DT05URVhU
X1RBRyA+IEdFTjEyX01BWF9DT05URVhUX0hXX0lEKTsKIAl9CiAKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYwppbmRleCA4NmNmZmJiMGE5Y2IuLjdjODM4YTU3ZTE3
NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYwpAQCAtMTU1
LDEzICsxNTUsOSBAQCBzdGF0aWMgaW50IGxpdmVfY29udGV4dF9zaXplKHZvaWQgKmFyZykKIAkg
KiBIVyB0cmllcyB0byB3cml0ZSBwYXN0IHRoZSBlbmQgb2Ygb25lLgogCSAqLwogCi0JbXV0ZXhf
bG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJZml4bWUgPSBrZXJuZWxfY29u
dGV4dChndC0+aTkxNSk7Ci0JaWYgKElTX0VSUihmaXhtZSkpIHsKLQkJZXJyID0gUFRSX0VSUihm
aXhtZSk7Ci0JCWdvdG8gdW5sb2NrOwotCX0KKwlpZiAoSVNfRVJSKGZpeG1lKSkKKwkJcmV0dXJu
IFBUUl9FUlIoZml4bWUpOwogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5MTUsIGlk
KSB7CiAJCXN0cnVjdCB7CkBAIC0yMDEsOCArMTk3LDYgQEAgc3RhdGljIGludCBsaXZlX2NvbnRl
eHRfc2l6ZSh2b2lkICphcmcpCiAJfQogCiAJa2VybmVsX2NvbnRleHRfY2xvc2UoZml4bWUpOwot
dW5sb2NrOgotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJl
dHVybiBlcnI7CiB9CiAKQEAgLTMwNSwxMiArMjk5LDEwIEBAIHN0YXRpYyBpbnQgbGl2ZV9hY3Rp
dmVfY29udGV4dCh2b2lkICphcmcpCiAJaWYgKElTX0VSUihmaWxlKSkKIAkJcmV0dXJuIFBUUl9F
UlIoZmlsZSk7CiAKLQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0K
IAlmaXhtZSA9IGxpdmVfY29udGV4dChndC0+aTkxNSwgZmlsZSk7CiAJaWYgKElTX0VSUihmaXht
ZSkpIHsKIAkJZXJyID0gUFRSX0VSUihmaXhtZSk7Ci0JCWdvdG8gdW5sb2NrOworCQlnb3RvIG91
dF9maWxlOwogCX0KIAogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LT5pOTE1LCBpZCkgewpA
QCAtMzIzLDggKzMxNSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9hY3RpdmVfY29udGV4dCh2b2lkICph
cmcpCiAJCQlicmVhazsKIAl9CiAKLXVubG9jazoKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKK291dF9maWxlOgogCW1vY2tfZmlsZV9mcmVlKGd0LT5pOTE1LCBm
aWxlKTsKIAlyZXR1cm4gZXJyOwogfQpAQCAtNDE4LDEyICs0MDksMTAgQEAgc3RhdGljIGludCBs
aXZlX3JlbW90ZV9jb250ZXh0KHZvaWQgKmFyZykKIAlpZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1
cm4gUFRSX0VSUihmaWxlKTsKIAotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKLQogCWZpeG1lID0gbGl2ZV9jb250ZXh0KGd0LT5pOTE1LCBmaWxlKTsKIAlpZiAoSVNf
RVJSKGZpeG1lKSkgewogCQllcnIgPSBQVFJfRVJSKGZpeG1lKTsKLQkJZ290byB1bmxvY2s7CisJ
CWdvdG8gb3V0X2ZpbGU7CiAJfQogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5MTUs
IGlkKSB7CkBAIC00MzYsOCArNDI1LDcgQEAgc3RhdGljIGludCBsaXZlX3JlbW90ZV9jb250ZXh0
KHZvaWQgKmFyZykKIAkJCWJyZWFrOwogCX0KIAotdW5sb2NrOgotCW11dGV4X3VubG9jaygmZ3Qt
Pmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworb3V0X2ZpbGU6CiAJbW9ja19maWxlX2ZyZWUoZ3Qt
Pmk5MTUsIGZpbGUpOwogCXJldHVybiBlcnI7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3NlbGZ0ZXN0X2hhbmdjaGVjay5jCmluZGV4IGZmYmIzZDIzYjg4Ny4uZThhNDBkZjc5YmQwIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYwpAQCAtNTgs
OSArNTgsNyBAQCBzdGF0aWMgaW50IGhhbmdfaW5pdChzdHJ1Y3QgaGFuZyAqaCwgc3RydWN0IGlu
dGVsX2d0ICpndCkKIAltZW1zZXQoaCwgMCwgc2l6ZW9mKCpoKSk7CiAJaC0+Z3QgPSBndDsKIAot
CW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAloLT5jdHggPSBrZXJu
ZWxfY29udGV4dChndC0+aTkxNSk7Ci0JbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7CiAJaWYgKElTX0VSUihoLT5jdHgpKQogCQlyZXR1cm4gUFRSX0VSUihoLT5jdHgp
OwogCkBAIC0xMzMsNyArMTMxLDcgQEAgc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3QgKgogaGFu
Z19jcmVhdGVfcmVxdWVzdChzdHJ1Y3QgaGFuZyAqaCwgc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lKQogewogCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBoLT5ndDsKLQlzdHJ1Y3QgaTkxNV9h
ZGRyZXNzX3NwYWNlICp2bSA9IGgtPmN0eC0+dm0gPzogJmVuZ2luZS0+Z3QtPmdndHQtPnZtOwor
CXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gaTkxNV9nZW1fY29udGV4dF9nZXRfdm1f
cmN1KGgtPmN0eCk7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKIAlzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycSA9IE5VTEw7CiAJc3RydWN0IGk5MTVfdm1hICpod3MsICp2bWE7CkBA
IC0xNDMsMTIgKzE0MSwxNSBAQCBoYW5nX2NyZWF0ZV9yZXF1ZXN0KHN0cnVjdCBoYW5nICpoLCBz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJaW50IGVycjsKIAogCW9iaiA9IGk5MTVf
Z2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoZ3QtPmk5MTUsIFBBR0VfU0laRSk7Ci0JaWYgKElT
X0VSUihvYmopKQorCWlmIChJU19FUlIob2JqKSkgeworCQlpOTE1X3ZtX3B1dCh2bSk7CiAJCXJl
dHVybiBFUlJfQ0FTVChvYmopOworCX0KIAogCXZhZGRyID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9t
YXAob2JqLCBpOTE1X2NvaGVyZW50X21hcF90eXBlKGd0LT5pOTE1KSk7CiAJaWYgKElTX0VSUih2
YWRkcikpIHsKIAkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCQlpOTE1X3ZtX3B1dCh2bSk7
CiAJCXJldHVybiBFUlJfQ0FTVCh2YWRkcik7CiAJfQogCkBAIC0xNTksMTYgKzE2MCwyMiBAQCBo
YW5nX2NyZWF0ZV9yZXF1ZXN0KHN0cnVjdCBoYW5nICpoLCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmUpCiAJaC0+YmF0Y2ggPSB2YWRkcjsKIAogCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNl
KGgtPm9iaiwgdm0sIE5VTEwpOwotCWlmIChJU19FUlIodm1hKSkKKwlpZiAoSVNfRVJSKHZtYSkp
IHsKKwkJaTkxNV92bV9wdXQodm0pOwogCQlyZXR1cm4gRVJSX0NBU1Qodm1hKTsKKwl9CiAKIAlo
d3MgPSBpOTE1X3ZtYV9pbnN0YW5jZShoLT5od3MsIHZtLCBOVUxMKTsKLQlpZiAoSVNfRVJSKGh3
cykpCisJaWYgKElTX0VSUihod3MpKSB7CisJCWk5MTVfdm1fcHV0KHZtKTsKIAkJcmV0dXJuIEVS
Ul9DQVNUKGh3cyk7CisJfQogCiAJZXJyID0gaTkxNV92bWFfcGluKHZtYSwgMCwgMCwgUElOX1VT
RVIpOwotCWlmIChlcnIpCisJaWYgKGVycikgeworCQlpOTE1X3ZtX3B1dCh2bSk7CiAJCXJldHVy
biBFUlJfUFRSKGVycik7CisJfQogCiAJZXJyID0gaTkxNV92bWFfcGluKGh3cywgMCwgMCwgUElO
X1VTRVIpOwogCWlmIChlcnIpCkBAIC0yNjYsNiArMjczLDcgQEAgaGFuZ19jcmVhdGVfcmVxdWVz
dChzdHJ1Y3QgaGFuZyAqaCwgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCWk5MTVf
dm1hX3VucGluKGh3cyk7CiB1bnBpbl92bWE6CiAJaTkxNV92bWFfdW5waW4odm1hKTsKKwlpOTE1
X3ZtX3B1dCh2bSk7CiAJcmV0dXJuIGVyciA/IEVSUl9QVFIoZXJyKSA6IHJxOwogfQogCkBAIC0z
ODIsOSArMzkwLDcgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfbm9wKHZvaWQgKmFyZykKIAlpZiAo
SVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKIAotCW11dGV4X2xvY2soJmd0
LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAljdHggPSBsaXZlX2NvbnRleHQoZ3QtPmk5MTUs
IGZpbGUpOwotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWlm
IChJU19FUlIoY3R4KSkgewogCQllcnIgPSBQVFJfRVJSKGN0eCk7CiAJCWdvdG8gb3V0OwpAQCAt
NDU4LDkgKzQ2NCw3IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X25vcF9lbmdpbmUodm9pZCAqYXJn
KQogCWlmIChJU19FUlIoZmlsZSkpCiAJCXJldHVybiBQVFJfRVJSKGZpbGUpOwogCi0JbXV0ZXhf
bG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWN0eCA9IGxpdmVfY29udGV4dChn
dC0+aTkxNSwgZmlsZSk7Ci0JbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAJaWYgKElTX0VSUihjdHgpKSB7CiAJCWVyciA9IFBUUl9FUlIoY3R4KTsKIAkJZ290byBv
dXQ7CkBAIC03MDUsOSArNzA5LDcgQEAgc3RhdGljIGludCBhY3RpdmVfZW5naW5lKHZvaWQgKmRh
dGEpCiAJCXJldHVybiBQVFJfRVJSKGZpbGUpOwogCiAJZm9yIChjb3VudCA9IDA7IGNvdW50IDwg
QVJSQVlfU0laRShjdHgpOyBjb3VudCsrKSB7Ci0JCW11dGV4X2xvY2soJmVuZ2luZS0+aTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWN0eFtjb3VudF0gPSBsaXZlX2NvbnRleHQoZW5naW5lLT5p
OTE1LCBmaWxlKTsKLQkJbXV0ZXhfdW5sb2NrKCZlbmdpbmUtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwogCQlpZiAoSVNfRVJSKGN0eFtjb3VudF0pKSB7CiAJCQllcnIgPSBQVFJfRVJSKGN0eFtj
b3VudF0pOwogCQkJd2hpbGUgKC0tY291bnQpCkBAIC0xMjkxLDYgKzEyOTMsNyBAQCBzdGF0aWMg
aW50IGlndF9yZXNldF9ldmljdF9wcGd0dCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGludGVsX2d0
ICpndCA9IGFyZzsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OworCXN0cnVjdCBpOTE1
X2FkZHJlc3Nfc3BhY2UgKnZtOwogCXN0cnVjdCBkcm1fZmlsZSAqZmlsZTsKIAlpbnQgZXJyOwog
CkBAIC0xMjk4LDE4ICsxMzAxLDIwIEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X2V2aWN0X3BwZ3R0
KHZvaWQgKmFyZykKIAlpZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsK
IAotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAljdHggPSBsaXZl
X2NvbnRleHQoZ3QtPmk5MTUsIGZpbGUpOwotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCWlmIChJU19FUlIoY3R4KSkgewogCQllcnIgPSBQVFJfRVJSKGN0eCk7
CiAJCWdvdG8gb3V0OwogCX0KIAogCWVyciA9IDA7Ci0JaWYgKGN0eC0+dm0pIC8qIGFsaWFzaW5n
ID09IGdsb2JhbCBndHQgbG9ja2luZywgY292ZXJlZCBhYm92ZSAqLwotCQllcnIgPSBfX2lndF9y
ZXNldF9ldmljdF92bWEoZ3QsIGN0eC0+dm0sCisJdm0gPSBpOTE1X2dlbV9jb250ZXh0X2dldF92
bV9yY3UoY3R4KTsKKwlpZiAoIWk5MTVfaXNfZ2d0dCh2bSkpIHsKKwkJLyogYWxpYXNpbmcgPT0g
Z2xvYmFsIGd0dCBsb2NraW5nLCBjb3ZlcmVkIGFib3ZlICovCisJCWVyciA9IF9faWd0X3Jlc2V0
X2V2aWN0X3ZtYShndCwgdm0sCiAJCQkJCSAgICBldmljdF92bWEsIEVYRUNfT0JKRUNUX1dSSVRF
KTsKKwl9CisJaTkxNV92bV9wdXQodm0pOwogCiBvdXQ6CiAJbW9ja19maWxlX2ZyZWUoZ3QtPmk5
MTUsIGZpbGUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
bHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwppbmRleCAwNGMx
Y2Y1NzM2NDIuLjhkYzQyYzVjNzU2OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Qvc2VsZnRlc3RfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
bHJjLmMKQEAgLTE2MzEsNyArMTYzMSwxMSBAQCBzdGF0aWMgaW50IHNtb2tlX3N1Ym1pdChzdHJ1
Y3QgcHJlZW1wdF9zbW9rZSAqc21va2UsCiAJaW50IGVyciA9IDA7CiAKIAlpZiAoYmF0Y2gpIHsK
LQkJdm1hID0gaTkxNV92bWFfaW5zdGFuY2UoYmF0Y2gsIGN0eC0+dm0sIE5VTEwpOworCQlzdHJ1
Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKKworCQl2bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0
X3ZtX3JjdShjdHgpOworCQl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShiYXRjaCwgdm0sIE5VTEwp
OworCQlpOTE1X3ZtX3B1dCh2bSk7CiAJCWlmIChJU19FUlIodm1hKSkKIAkJCXJldHVybiBQVFJf
RVJSKHZtYSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0
X3dvcmthcm91bmRzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJv
dW5kcy5jCmluZGV4IDRlZTJlMmJhYmQwZC4uOTQzYjAwM2JlYmE2IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMKQEAgLTM1NSw2ICszNTUsNyBA
QCBzdGF0aWMgaW50IGNoZWNrX3doaXRlbGlzdF9hY3Jvc3NfcmVzZXQoc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lLAogc3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqY3JlYXRlX2JhdGNoKHN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCiB7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iajsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKIAlzdHJ1Y3QgaTkxNV92
bWEgKnZtYTsKIAlpbnQgZXJyOwogCkBAIC0zNjIsNyArMzYzLDkgQEAgc3RhdGljIHN0cnVjdCBp
OTE1X3ZtYSAqY3JlYXRlX2JhdGNoKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCiAJaWYg
KElTX0VSUihvYmopKQogCQlyZXR1cm4gRVJSX0NBU1Qob2JqKTsKIAotCXZtYSA9IGk5MTVfdm1h
X2luc3RhbmNlKG9iaiwgY3R4LT52bSwgTlVMTCk7CisJdm0gPSBpOTE1X2dlbV9jb250ZXh0X2dl
dF92bV9yY3UoY3R4KTsKKwl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosIHZtLCBOVUxMKTsK
KwlpOTE1X3ZtX3B1dCh2bSk7CiAJaWYgKElTX0VSUih2bWEpKSB7CiAJCWVyciA9IFBUUl9FUlIo
dm1hKTsKIAkJZ290byBlcnJfb2JqOwpAQCAtNDYzLDEyICs0NjYsMTUgQEAgc3RhdGljIGludCBj
aGVja19kaXJ0eV93aGl0ZWxpc3Qoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJMHhm
ZmZmMDBmZiwKIAkJMHhmZmZmZmZmZiwKIAl9OworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ug
KnZtOwogCXN0cnVjdCBpOTE1X3ZtYSAqc2NyYXRjaDsKIAlzdHJ1Y3QgaTkxNV92bWEgKmJhdGNo
OwogCWludCBlcnIgPSAwLCBpLCB2OwogCXUzMiAqY3MsICpyZXN1bHRzOwogCi0Jc2NyYXRjaCA9
IGNyZWF0ZV9zY3JhdGNoKGN0eC0+dm0sIDIgKiBBUlJBWV9TSVpFKHZhbHVlcykgKyAxKTsKKwl2
bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOworCXNjcmF0Y2ggPSBjcmVhdGVf
c2NyYXRjaCh2bSwgMiAqIEFSUkFZX1NJWkUodmFsdWVzKSArIDEpOworCWk5MTVfdm1fcHV0KHZt
KTsKIAlpZiAoSVNfRVJSKHNjcmF0Y2gpKQogCQlyZXR1cm4gUFRSX0VSUihzY3JhdGNoKTsKIApA
QCAtMTAxMCw2ICsxMDE2LDcgQEAgc3RhdGljIGludCBsaXZlX2lzb2xhdGVkX3doaXRlbGlzdCh2
b2lkICphcmcpCiAJCXJldHVybiAwOwogCiAJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUoY2xp
ZW50KTsgaSsrKSB7CisJCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwogCQlzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqYzsKIAogCQljID0ga2VybmVsX2NvbnRleHQoaTkxNSk7CkBAIC0x
MDE4LDIyICsxMDI1LDI3IEBAIHN0YXRpYyBpbnQgbGl2ZV9pc29sYXRlZF93aGl0ZWxpc3Qodm9p
ZCAqYXJnKQogCQkJZ290byBlcnI7CiAJCX0KIAotCQljbGllbnRbaV0uc2NyYXRjaFswXSA9IGNy
ZWF0ZV9zY3JhdGNoKGMtPnZtLCAxMDI0KTsKKwkJdm0gPSBpOTE1X2dlbV9jb250ZXh0X2dldF92
bV9yY3UoYyk7CisKKwkJY2xpZW50W2ldLnNjcmF0Y2hbMF0gPSBjcmVhdGVfc2NyYXRjaCh2bSwg
MTAyNCk7CiAJCWlmIChJU19FUlIoY2xpZW50W2ldLnNjcmF0Y2hbMF0pKSB7CiAJCQllcnIgPSBQ
VFJfRVJSKGNsaWVudFtpXS5zY3JhdGNoWzBdKTsKKwkJCWk5MTVfdm1fcHV0KHZtKTsKIAkJCWtl
cm5lbF9jb250ZXh0X2Nsb3NlKGMpOwogCQkJZ290byBlcnI7CiAJCX0KIAotCQljbGllbnRbaV0u
c2NyYXRjaFsxXSA9IGNyZWF0ZV9zY3JhdGNoKGMtPnZtLCAxMDI0KTsKKwkJY2xpZW50W2ldLnNj
cmF0Y2hbMV0gPSBjcmVhdGVfc2NyYXRjaCh2bSwgMTAyNCk7CiAJCWlmIChJU19FUlIoY2xpZW50
W2ldLnNjcmF0Y2hbMV0pKSB7CiAJCQllcnIgPSBQVFJfRVJSKGNsaWVudFtpXS5zY3JhdGNoWzFd
KTsKIAkJCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZjbGllbnRbaV0uc2NyYXRjaFswXSwg
MCk7CisJCQlpOTE1X3ZtX3B1dCh2bSk7CiAJCQlrZXJuZWxfY29udGV4dF9jbG9zZShjKTsKIAkJ
CWdvdG8gZXJyOwogCQl9CiAKIAkJY2xpZW50W2ldLmN0eCA9IGM7CisJCWk5MTVfdm1fcHV0KHZt
KTsKIAl9CiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgewpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Z0L3NjaGVkdWxlci5jCmluZGV4IDAzZjU2NzA4NDU0OC4uNjg1MGYxZjQwMjQxIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVyLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jCkBAIC0zNjUsNyArMzY1LDggQEAgc3Rh
dGljIHZvaWQgc2V0X2NvbnRleHRfcHBndHRfZnJvbV9zaGFkb3coc3RydWN0IGludGVsX3ZncHVf
d29ya2xvYWQgKndvcmtsb2FkLAogCQkJCQkgIHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgp
CiB7CiAJc3RydWN0IGludGVsX3ZncHVfbW0gKm1tID0gd29ya2xvYWQtPnNoYWRvd19tbTsKLQlz
dHJ1Y3QgaTkxNV9wcGd0dCAqcHBndHQgPSBpOTE1X3ZtX3RvX3BwZ3R0KGN0eC0+dm0pOworCXN0
cnVjdCBpOTE1X3BwZ3R0ICpwcGd0dCA9CisJCWk5MTVfdm1fdG9fcHBndHQoaTkxNV9nZW1fY29u
dGV4dF9nZXRfdm1fcmN1KGN0eCkpOwogCWludCBpID0gMDsKIAogCWlmIChtbS0+cHBndHRfbW0u
cm9vdF9lbnRyeV90eXBlID09IEdUVF9UWVBFX1BQR1RUX1JPT1RfTDRfRU5UUlkpIHsKQEAgLTM3
OCw2ICszNzksOCBAQCBzdGF0aWMgdm9pZCBzZXRfY29udGV4dF9wcGd0dF9mcm9tX3NoYWRvdyhz
dHJ1Y3QgaW50ZWxfdmdwdV93b3JrbG9hZCAqd29ya2xvYWQsCiAJCQlweF9kbWEocGQpID0gbW0t
PnBwZ3R0X21tLnNoYWRvd19wZHBzW2ldOwogCQl9CiAJfQorCisJaTkxNV92bV9wdXQoJnBwZ3R0
LT52bSk7CiB9CiAKIHN0YXRpYyBpbnQKQEAgLTEyMzAsMjAgKzEyMzMsMTggQEAgaW50IGludGVs
X3ZncHVfc2V0dXBfc3VibWlzc2lvbihzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAlzdHJ1Y3Qg
aW50ZWxfdmdwdV9zdWJtaXNzaW9uICpzID0gJnZncHUtPnN1Ym1pc3Npb247CiAJc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CisJ
c3RydWN0IGk5MTVfcHBndHQgKnBwZ3R0OwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGk7CiAJaW50
IHJldDsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJY3R4ID0g
aTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKGk5MTUsIEk5MTVfUFJJT1JJVFlfTUFYKTsK
LQlpZiAoSVNfRVJSKGN0eCkpIHsKLQkJcmV0ID0gUFRSX0VSUihjdHgpOwotCQlnb3RvIG91dF91
bmxvY2s7Ci0JfQorCWlmIChJU19FUlIoY3R4KSkKKwkJcmV0dXJuIFBUUl9FUlIoY3R4KTsKIAog
CWk5MTVfZ2VtX2NvbnRleHRfc2V0X2ZvcmNlX3NpbmdsZV9zdWJtaXNzaW9uKGN0eCk7CiAKLQlp
OTE1X2NvbnRleHRfcHBndHRfcm9vdF9zYXZlKHMsIGk5MTVfdm1fdG9fcHBndHQoY3R4LT52bSkp
OworCXBwZ3R0ID0gaTkxNV92bV90b19wcGd0dChpOTE1X2dlbV9jb250ZXh0X2dldF92bV9yY3Uo
Y3R4KSk7CisJaTkxNV9jb250ZXh0X3BwZ3R0X3Jvb3Rfc2F2ZShzLCBwcGd0dCk7CiAKIAlmb3Jf
ZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpKSB7CiAJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpj
ZTsKQEAgLTEyODgsMTIgKzEyODksMTIgQEAgaW50IGludGVsX3ZncHVfc2V0dXBfc3VibWlzc2lv
bihzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAlhdG9taWNfc2V0KCZzLT5ydW5uaW5nX3dvcmts
b2FkX251bSwgMCk7CiAJYml0bWFwX3plcm8ocy0+dGxiX2hhbmRsZV9wZW5kaW5nLCBJOTE1X05V
TV9FTkdJTkVTKTsKIAorCWk5MTVfdm1fcHV0KCZwcGd0dC0+dm0pOwogCWk5MTVfZ2VtX2NvbnRl
eHRfcHV0KGN0eCk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAly
ZXR1cm4gMDsKIAogb3V0X3NoYWRvd19jdHg6Ci0JaTkxNV9jb250ZXh0X3BwZ3R0X3Jvb3RfcmVz
dG9yZShzLCBpOTE1X3ZtX3RvX3BwZ3R0KGN0eC0+dm0pKTsKKwlpOTE1X2NvbnRleHRfcHBndHRf
cm9vdF9yZXN0b3JlKHMsIHBwZ3R0KTsKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBp
KSB7CiAJCWlmIChJU19FUlIocy0+c2hhZG93W2ldKSkKIAkJCWJyZWFrOwpAQCAtMTMwMSw5ICsx
MzAyLDggQEAgaW50IGludGVsX3ZncHVfc2V0dXBfc3VibWlzc2lvbihzdHJ1Y3QgaW50ZWxfdmdw
dSAqdmdwdSkKIAkJaW50ZWxfY29udGV4dF91bnBpbihzLT5zaGFkb3dbaV0pOwogCQlpbnRlbF9j
b250ZXh0X3B1dChzLT5zaGFkb3dbaV0pOwogCX0KKwlpOTE1X3ZtX3B1dCgmcHBndHQtPnZtKTsK
IAlpOTE1X2dlbV9jb250ZXh0X3B1dChjdHgpOwotb3V0X3VubG9jazoKLQltdXRleF91bmxvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiByZXQ7CiB9CiAKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9kZWJ1Z2ZzLmMKaW5kZXggMGU5MGFjNjA4ZTA3Li5iMDRjZWJjMjZlY2EgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCkBAIC0zMTYsMTIgKzMxNiwxOCBAQCBzdGF0aWMg
dm9pZCBwcmludF9jb250ZXh0X3N0YXRzKHN0cnVjdCBzZXFfZmlsZSAqbSwKIAkJCQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgZmlsZV9zdGF0cyBrc3RhdHMgPSB7
fTsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OworCXN0cnVjdCBpOTE1X2dlbV9jb250
ZXh0ICpjdHgsICpjbjsKIAotCWxpc3RfZm9yX2VhY2hfZW50cnkoY3R4LCAmaTkxNS0+Y29udGV4
dHMubGlzdCwgbGluaykgeworCXNwaW5fbG9jaygmaTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOwor
CWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShjdHgsIGNuLCAmaTkxNS0+Z2VtLmNvbnRleHRzLmxp
c3QsIGxpbmspIHsKIAkJc3RydWN0IGk5MTVfZ2VtX2VuZ2luZXNfaXRlciBpdDsKIAkJc3RydWN0
IGludGVsX2NvbnRleHQgKmNlOwogCisJCWlmICgha3JlZl9nZXRfdW5sZXNzX3plcm8oJmN0eC0+
cmVmKSkKKwkJCWNvbnRpbnVlOworCisJCXNwaW5fdW5sb2NrKCZpOTE1LT5nZW0uY29udGV4dHMu
bG9jayk7CisKIAkJZm9yX2VhY2hfZ2VtX2VuZ2luZShjZSwKIAkJCQkgICAgaTkxNV9nZW1fY29u
dGV4dF9sb2NrX2VuZ2luZXMoY3R4KSwgaXQpIHsKIAkJCWludGVsX2NvbnRleHRfbG9ja19waW5u
ZWQoY2UpOwpAQCAtMzM4LDcgKzM0NCw5IEBAIHN0YXRpYyB2b2lkIHByaW50X2NvbnRleHRfc3Rh
dHMoc3RydWN0IHNlcV9maWxlICptLAogCQlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19lbmdpbmVz
KGN0eCk7CiAKIAkJaWYgKCFJU19FUlJfT1JfTlVMTChjdHgtPmZpbGVfcHJpdikpIHsKLQkJCXN0
cnVjdCBmaWxlX3N0YXRzIHN0YXRzID0geyAudm0gPSBjdHgtPnZtLCB9OworCQkJc3RydWN0IGZp
bGVfc3RhdHMgc3RhdHMgPSB7CisJCQkJLnZtID0gcmN1X2FjY2Vzc19wb2ludGVyKGN0eC0+dm0p
LAorCQkJfTsKIAkJCXN0cnVjdCBkcm1fZmlsZSAqZmlsZSA9IGN0eC0+ZmlsZV9wcml2LT5maWxl
OwogCQkJc3RydWN0IHRhc2tfc3RydWN0ICp0YXNrOwogCQkJY2hhciBuYW1lWzgwXTsKQEAgLTM1
NSw3ICszNjMsMTIgQEAgc3RhdGljIHZvaWQgcHJpbnRfY29udGV4dF9zdGF0cyhzdHJ1Y3Qgc2Vx
X2ZpbGUgKm0sCiAKIAkJCXByaW50X2ZpbGVfc3RhdHMobSwgbmFtZSwgc3RhdHMpOwogCQl9CisK
KwkJc3Bpbl9sb2NrKCZpOTE1LT5nZW0uY29udGV4dHMubG9jayk7CisJCWxpc3Rfc2FmZV9yZXNl
dF9uZXh0KGN0eCwgY24sIGxpbmspOworCQlpOTE1X2dlbV9jb250ZXh0X3B1dChjdHgpOwogCX0K
KwlzcGluX3VubG9jaygmaTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOwogCiAJcHJpbnRfZmlsZV9z
dGF0cyhtLCAiW2tdY29udGV4dHMiLCBrc3RhdHMpOwogfQpAQCAtMzYzLDcgKzM3Niw2IEBAIHN0
YXRpYyB2b2lkIHByaW50X2NvbnRleHRfc3RhdHMoc3RydWN0IHNlcV9maWxlICptLAogc3RhdGlj
IGludCBpOTE1X2dlbV9vYmplY3RfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEp
CiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBub2RlX3RvX2k5MTUobS0+cHJp
dmF0ZSk7Ci0JaW50IHJldDsKIAogCXNlcV9wcmludGYobSwgIiV1IHNocmlua2FibGUgWyV1IGZy
ZWVdIG9iamVjdHMsICVsbHUgYnl0ZXNcbiIsCiAJCSAgIGk5MTUtPm1tLnNocmlua19jb3VudCwK
QEAgLTM3MiwxMiArMzg0LDcgQEAgc3RhdGljIGludCBpOTE1X2dlbV9vYmplY3RfaW5mbyhzdHJ1
Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAKIAlzZXFfcHV0YyhtLCAnXG4nKTsKIAotCXJl
dCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0J
aWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQogCXByaW50X2NvbnRleHRfc3RhdHMobSwgaTkxNSk7
Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCXJldHVybiAwOwog
fQpAQCAtMTU3OSwxOSArMTU4NiwxOSBAQCBzdGF0aWMgdm9pZCBkZXNjcmliZV9jdHhfcmluZyhz
dHJ1Y3Qgc2VxX2ZpbGUgKm0sIHN0cnVjdCBpbnRlbF9yaW5nICpyaW5nKQogCiBzdGF0aWMgaW50
IGk5MTVfY29udGV4dF9zdGF0dXMoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19pOTE1KG0tPnBy
aXZhdGUpOwotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmZGV2X3ByaXYtPmRybTsKLQlzdHJ1
Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwotCWludCByZXQ7Ci0KLQlyZXQgPSBtdXRleF9sb2Nr
X2ludGVycnVwdGlibGUoJmRldi0+c3RydWN0X211dGV4KTsKLQlpZiAocmV0KQotCQlyZXR1cm4g
cmV0OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gbm9kZV90b19pOTE1KG0tPnBy
aXZhdGUpOworCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsICpjbjsKIAotCWxpc3RfZm9y
X2VhY2hfZW50cnkoY3R4LCAmZGV2X3ByaXYtPmNvbnRleHRzLmxpc3QsIGxpbmspIHsKKwlzcGlu
X2xvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5X3Nh
ZmUoY3R4LCBjbiwgJmk5MTUtPmdlbS5jb250ZXh0cy5saXN0LCBsaW5rKSB7CiAJCXN0cnVjdCBp
OTE1X2dlbV9lbmdpbmVzX2l0ZXIgaXQ7CiAJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAor
CQlpZiAoIWtyZWZfZ2V0X3VubGVzc196ZXJvKCZjdHgtPnJlZikpCisJCQljb250aW51ZTsKKwor
CQlzcGluX3VubG9jaygmaTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOworCiAJCXNlcV9wdXRzKG0s
ICJIVyBjb250ZXh0ICIpOwogCQlpZiAoY3R4LT5waWQpIHsKIAkJCXN0cnVjdCB0YXNrX3N0cnVj
dCAqdGFzazsKQEAgLTE2MjYsOSArMTYzMywxMiBAQCBzdGF0aWMgaW50IGk5MTVfY29udGV4dF9z
dGF0dXMoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCiAJCWk5MTVfZ2VtX2NvbnRl
eHRfdW5sb2NrX2VuZ2luZXMoY3R4KTsKIAogCQlzZXFfcHV0YyhtLCAnXG4nKTsKLQl9CiAKLQlt
dXRleF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKKwkJc3Bpbl9sb2NrKCZpOTE1LT5nZW0u
Y29udGV4dHMubG9jayk7CisJCWxpc3Rfc2FmZV9yZXNldF9uZXh0KGN0eCwgY24sIGxpbmspOwor
CQlpOTE1X2dlbV9jb250ZXh0X3B1dChjdHgpOworCX0KKwlzcGluX3VubG9jaygmaTkxNS0+Z2Vt
LmNvbnRleHRzLmxvY2spOwogCiAJcmV0dXJuIDA7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2Rydi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYwpp
bmRleCA1MzIzZTRmYTU1ZDkuLjAyNGRhNTgyYmEwZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9kcnYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5j
CkBAIC0xNjY1LDEwICsxNjY1LDggQEAgc3RhdGljIHZvaWQgaTkxNV9kcml2ZXJfcG9zdGNsb3Nl
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKIHsKIAlzdHJ1
Y3QgZHJtX2k5MTVfZmlsZV9wcml2YXRlICpmaWxlX3ByaXYgPSBmaWxlLT5kcml2ZXJfcHJpdjsK
IAotCW11dGV4X2xvY2soJmRldi0+c3RydWN0X211dGV4KTsKIAlpOTE1X2dlbV9jb250ZXh0X2Ns
b3NlKGZpbGUpOwogCWk5MTVfZ2VtX3JlbGVhc2UoZGV2LCBmaWxlKTsKLQltdXRleF91bmxvY2so
JmRldi0+c3RydWN0X211dGV4KTsKIAogCWtmcmVlX3JjdShmaWxlX3ByaXYsIHJjdSk7CiAKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2Rydi5oCmluZGV4IGNiNjNiMmJkMGNlOC4uMzViNjEwZDUyMzc5IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZHJ2LmgKQEAgLTE1MzYsMjUgKzE1MzYsNiBAQCBzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSB7CiAJaW50IGF1ZGlvX3Bvd2VyX3JlZmNvdW50OwogCXUzMiBhdWRpb19mcmVx
X2NudHJsOwogCi0Jc3RydWN0IHsKLQkJc3RydWN0IG11dGV4IG11dGV4OwotCQlzdHJ1Y3QgbGlz
dF9oZWFkIGxpc3Q7Ci0JCXN0cnVjdCBsbGlzdF9oZWFkIGZyZWVfbGlzdDsKLQkJc3RydWN0IHdv
cmtfc3RydWN0IGZyZWVfd29yazsKLQotCQkvKiBUaGUgaHcgd2FudHMgdG8gaGF2ZSBhIHN0YWJs
ZSBjb250ZXh0IGlkZW50aWZpZXIgZm9yIHRoZQotCQkgKiBsaWZldGltZSBvZiB0aGUgY29udGV4
dCAoZm9yIE9BLCBQQVNJRCwgZmF1bHRzLCBldGMpLgotCQkgKiBUaGlzIGlzIGxpbWl0ZWQgaW4g
ZXhlY2xpc3RzIHRvIDIxIGJpdHMuCi0JCSAqLwotCQlzdHJ1Y3QgaWRhIGh3X2lkYTsKLSNkZWZp
bmUgTUFYX0NPTlRFWFRfSFdfSUQgKDE8PDIxKSAvKiBleGNsdXNpdmUgKi8KLSNkZWZpbmUgTUFY
X0dVQ19DT05URVhUX0hXX0lEICgxIDw8IDIwKSAvKiBleGNsdXNpdmUgKi8KLSNkZWZpbmUgR0VO
MTFfTUFYX0NPTlRFWFRfSFdfSUQgKDE8PDExKSAvKiBleGNsdXNpdmUgKi8KLS8qIGluIEdlbjEy
IElEIDB4N0ZGIGlzIHJlc2VydmVkIHRvIGluZGljYXRlIGlkbGUgKi8KLSNkZWZpbmUgR0VOMTJf
TUFYX0NPTlRFWFRfSFdfSUQJKEdFTjExX01BWF9DT05URVhUX0hXX0lEIC0gMSkKLQkJc3RydWN0
IGxpc3RfaGVhZCBod19pZF9saXN0OwotCX0gY29udGV4dHM7Ci0KIAl1MzIgZmRpX3J4X2NvbmZp
ZzsKIAogCS8qIFNoYWRvdyBmb3IgRElTUExBWV9QSFlfQ09OVFJPTCB3aGljaCBjYW4ndCBiZSBz
YWZlbHkgcmVhZCAqLwpAQCAtMTcxMCw2ICsxNjkxLDE0IEBAIHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlIHsKIAogCXN0cnVjdCB7CiAJCXN0cnVjdCBub3RpZmllcl9ibG9jayBwbV9ub3RpZmllcjsK
KworCQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dHMgeworCQkJc3BpbmxvY2tfdCBsb2NrOyAvKiBs
b2NrcyBsaXN0ICovCisJCQlzdHJ1Y3QgbGlzdF9oZWFkIGxpc3Q7CisKKwkJCXN0cnVjdCBsbGlz
dF9oZWFkIGZyZWVfbGlzdDsKKwkJCXN0cnVjdCB3b3JrX3N0cnVjdCBmcmVlX3dvcms7CisJCX0g
Y29udGV4dHM7CiAJfSBnZW07CiAKIAkvKiBGb3IgaTk0NWdtIHZibGFuayBpcnEgdnMuIEMzIHdv
cmthcm91bmQgKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IDVhNjY0YmRlYWQ4Yy4uZjZk
YjQxNTk4NWQ1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTEyNjYsNyArMTI2Niw3IEBA
IGludCBpOTE1X2dlbV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJ
Z290byBlcnJfdW5sb2NrOwogCX0KIAotCXJldCA9IGk5MTVfZ2VtX2NvbnRleHRzX2luaXQoZGV2
X3ByaXYpOworCXJldCA9IGk5MTVfZ2VtX2luaXRfY29udGV4dHMoZGV2X3ByaXYpOwogCWlmIChy
ZXQpIHsKIAkJR0VNX0JVR19PTihyZXQgPT0gLUVJTyk7CiAJCWdvdG8gZXJyX3NjcmF0Y2g7CkBA
IC0xMzQ4LDcgKzEzNDgsNyBAQCBpbnQgaTkxNV9nZW1faW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCiAJfQogZXJyX2NvbnRleHQ6CiAJaWYgKHJldCAhPSAtRUlPKQotCQlp
OTE1X2dlbV9jb250ZXh0c19maW5pKGRldl9wcml2KTsKKwkJaTkxNV9nZW1fZHJpdmVyX3JlbGVh
c2VfX2NvbnRleHRzKGRldl9wcml2KTsKIGVycl9zY3JhdGNoOgogCWludGVsX2d0X2RyaXZlcl9y
ZWxlYXNlKCZkZXZfcHJpdi0+Z3QpOwogZXJyX3VubG9jazoKQEAgLTE0MTYsMTEgKzE0MTYsOSBA
QCB2b2lkIGk5MTVfZ2VtX2RyaXZlcl9yZW1vdmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQogCiB2b2lkIGk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKIHsKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAJaW50ZWxfZW5naW5lc19jbGVhbnVwKGRldl9wcml2KTsKLQlpOTE1X2dlbV9jb250
ZXh0c19maW5pKGRldl9wcml2KTsKKwlpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZV9fY29udGV4dHMo
ZGV2X3ByaXYpOwogCWludGVsX2d0X2RyaXZlcl9yZWxlYXNlKCZkZXZfcHJpdi0+Z3QpOwotCW11
dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJaW50ZWxfd2FfbGlz
dF9mcmVlKCZkZXZfcHJpdi0+Z3Rfd2FfbGlzdCk7CiAKQEAgLTE0MzAsNyArMTQyOCw3IEBAIHZv
aWQgaTkxNV9nZW1fZHJpdmVyX3JlbGVhc2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQogCiAJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhkZXZfcHJpdik7CiAKLQlXQVJO
X09OKCFsaXN0X2VtcHR5KCZkZXZfcHJpdi0+Y29udGV4dHMubGlzdCkpOworCVdBUk5fT04oIWxp
c3RfZW1wdHkoJmRldl9wcml2LT5nZW0uY29udGV4dHMubGlzdCkpOwogfQogCiB2b2lkIGk5MTVf
Z2VtX2luaXRfbW1pbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW1fZ3R0LmMKaW5kZXggMWQyNjYzNGNhNTk3Li43YjE1YmI4OTE5NzAgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCkBAIC0xMzY2LDcgKzEzNjYsOSBAQCBzdGF0aWMg
aW50IGdlbjhfaW5pdF9zY3JhdGNoKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogCWlm
ICh2bS0+aGFzX3JlYWRfb25seSAmJgogCSAgICB2bS0+aTkxNS0+a2VybmVsX2NvbnRleHQgJiYK
IAkgICAgdm0tPmk5MTUtPmtlcm5lbF9jb250ZXh0LT52bSkgewotCQlzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlICpjbG9uZSA9IHZtLT5pOTE1LT5rZXJuZWxfY29udGV4dC0+dm07CisJCXN0cnVj
dCBpOTE1X2FkZHJlc3Nfc3BhY2UgKmNsb25lID0KKwkJCXJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0
ZWQodm0tPmk5MTUtPmtlcm5lbF9jb250ZXh0LT52bSwKKwkJCQkJCSAgdHJ1ZSk7IC8qIHN0YXRp
YyAqLwogCiAJCUdFTV9CVUdfT04oIWNsb25lLT5oYXNfcmVhZF9vbmx5KTsKIApkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3BlcmYuYwppbmRleCBlY2ZiYzM3YjczOGIuLjIzMTM4OGQwNmM4MiAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9wZXJmLmMKQEAgLTE4NTMsOCArMTg1Myw4IEBAIHN0YXRpYyBpbnQgZ2VuOF9j
b25maWd1cmVfYWxsX2NvbnRleHRzKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJ
fTsKICN1bmRlZiBjdHhfZmxleGV1TgogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsK
LQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwotCWludCBpOworCXN0cnVjdCBpOTE1X2dl
bV9jb250ZXh0ICpjdHgsICpjbjsKKwlpbnQgaSwgZXJyOwogCiAJZm9yIChpID0gMjsgaSA8IEFS
UkFZX1NJWkUocmVncyk7IGkrKykKIAkJcmVnc1tpXS52YWx1ZSA9IG9hX2NvbmZpZ19mbGV4X3Jl
ZyhvYV9jb25maWcsIHJlZ3NbaV0ucmVnKTsKQEAgLTE4NzcsMTYgKzE4NzcsMjcgQEAgc3RhdGlj
IGludCBnZW44X2NvbmZpZ3VyZV9hbGxfY29udGV4dHMoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0g
KnN0cmVhbSwKIAkgKiBjb250ZXh0LiBDb250ZXh0cyBpZGxlIGF0IHRoZSB0aW1lIG9mIHJlY29u
ZmlndXJhdGlvbiBhcmUgbm90CiAJICogdHJhcHBlZCBiZWhpbmQgdGhlIGJhcnJpZXIuCiAJICov
Ci0JbGlzdF9mb3JfZWFjaF9lbnRyeShjdHgsICZpOTE1LT5jb250ZXh0cy5saXN0LCBsaW5rKSB7
Ci0JCWludCBlcnI7Ci0KKwlzcGluX2xvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKKwls
aXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUoY3R4LCBjbiwgJmk5MTUtPmdlbS5jb250ZXh0cy5saXN0
LCBsaW5rKSB7CiAJCWlmIChjdHggPT0gaTkxNS0+a2VybmVsX2NvbnRleHQpCiAJCQljb250aW51
ZTsKIAorCQlpZiAoIWtyZWZfZ2V0X3VubGVzc196ZXJvKCZjdHgtPnJlZikpCisJCQljb250aW51
ZTsKKworCQlzcGluX3VubG9jaygmaTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOworCiAJCWVyciA9
IGdlbjhfY29uZmlndXJlX2NvbnRleHQoY3R4LCByZWdzLCBBUlJBWV9TSVpFKHJlZ3MpKTsKLQkJ
aWYgKGVycikKKwkJaWYgKGVycikgeworCQkJaTkxNV9nZW1fY29udGV4dF9wdXQoY3R4KTsKIAkJ
CXJldHVybiBlcnI7CisJCX0KKworCQlzcGluX2xvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2Nr
KTsKKwkJbGlzdF9zYWZlX3Jlc2V0X25leHQoY3R4LCBjbiwgbGluayk7CisJCWk5MTVfZ2VtX2Nv
bnRleHRfcHV0KGN0eCk7CiAJfQorCXNwaW5fdW5sb2NrKCZpOTE1LT5nZW0uY29udGV4dHMubG9j
ayk7CiAKIAkvKgogCSAqIEFmdGVyIHVwZGF0aW5nIGFsbCBvdGhlciBjb250ZXh0cywgd2UgbmVl
ZCB0byBtb2RpZnkgb3Vyc2VsdmVzLgpAQCAtMTg5NSw3ICsxOTA2LDYgQEAgc3RhdGljIGludCBn
ZW44X2NvbmZpZ3VyZV9hbGxfY29udGV4dHMoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVh
bSwKIAkgKi8KIAlmb3JfZWFjaF91YWJpX2VuZ2luZShlbmdpbmUsIGk5MTUpIHsKIAkJc3RydWN0
IGludGVsX2NvbnRleHQgKmNlID0gZW5naW5lLT5rZXJuZWxfY29udGV4dDsKLQkJaW50IGVycjsK
IAogCQlpZiAoZW5naW5lLT5jbGFzcyAhPSBSRU5ERVJfQ0xBU1MpCiAJCQljb250aW51ZTsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3lzZnMuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfc3lzZnMuYwppbmRleCAwMzRiOGFiYzUwNjIuLjJhNzI0MDdhNjM4MCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zeXNmcy5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfc3lzZnMuYwpAQCAtMTQ0LDkgKzE0NCw5IEBAIHN0YXRpYyBj
b25zdCBzdHJ1Y3QgYXR0cmlidXRlX2dyb3VwIG1lZGlhX3JjNl9hdHRyX2dyb3VwID0gewogfTsK
ICNlbmRpZgogCi1zdGF0aWMgaW50IGwzX2FjY2Vzc192YWxpZChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsIGxvZmZfdCBvZmZzZXQpCitzdGF0aWMgaW50IGwzX2FjY2Vzc192YWxp
ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgbG9mZl90IG9mZnNldCkKIHsKLQlpZiAo
IUhBU19MM19EUEYoZGV2X3ByaXYpKQorCWlmICghSEFTX0wzX0RQRihpOTE1KSkKIAkJcmV0dXJu
IC1FUEVSTTsKIAogCWlmIChvZmZzZXQgJSA0ICE9IDApCkBAIC0xNjQsMzEgKzE2NCwyNCBAQCBp
OTE1X2wzX3JlYWQoc3RydWN0IGZpbGUgKmZpbHAsIHN0cnVjdCBrb2JqZWN0ICprb2JqLAogCSAg
ICAgbG9mZl90IG9mZnNldCwgc2l6ZV90IGNvdW50KQogewogCXN0cnVjdCBkZXZpY2UgKmtkZXYg
PSBrb2JqX3RvX2Rldihrb2JqKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSBrZGV2X21pbm9yX3RvX2k5MTUoa2Rldik7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZk
ZXZfcHJpdi0+ZHJtOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0ga2Rldl9taW5v
cl90b19pOTE1KGtkZXYpOwogCWludCBzbGljZSA9IChpbnQpKHVpbnRwdHJfdClhdHRyLT5wcml2
YXRlOwogCWludCByZXQ7CiAKLQljb3VudCA9IHJvdW5kX2Rvd24oY291bnQsIDQpOwotCi0JcmV0
ID0gbDNfYWNjZXNzX3ZhbGlkKGRldl9wcml2LCBvZmZzZXQpOworCXJldCA9IGwzX2FjY2Vzc192
YWxpZChpOTE1LCBvZmZzZXQpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKKwljb3VudCA9
IHJvdW5kX2Rvd24oY291bnQsIDQpOwogCWNvdW50ID0gbWluX3Qoc2l6ZV90LCBHRU43X0wzTE9H
X1NJWkUgLSBvZmZzZXQsIGNvdW50KTsKKwltZW1zZXQoYnVmLCAwLCBjb3VudCk7CiAKLQlyZXQg
PSBpOTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZShkZXYpOwotCWlmIChyZXQpCi0JCXJldHVy
biByZXQ7Ci0KLQlpZiAoZGV2X3ByaXYtPmwzX3Bhcml0eS5yZW1hcF9pbmZvW3NsaWNlXSkKKwlz
cGluX2xvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKKwlpZiAoaTkxNS0+bDNfcGFyaXR5
LnJlbWFwX2luZm9bc2xpY2VdKQogCQltZW1jcHkoYnVmLAotCQkgICAgICAgZGV2X3ByaXYtPmwz
X3Bhcml0eS5yZW1hcF9pbmZvW3NsaWNlXSArIChvZmZzZXQvNCksCisJCSAgICAgICBpOTE1LT5s
M19wYXJpdHkucmVtYXBfaW5mb1tzbGljZV0gKyBvZmZzZXQgLyA0LAogCQkgICAgICAgY291bnQp
OwotCWVsc2UKLQkJbWVtc2V0KGJ1ZiwgMCwgY291bnQpOwotCi0JbXV0ZXhfdW5sb2NrKCZkZXYt
PnN0cnVjdF9tdXRleCk7CisJc3Bpbl91bmxvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsK
IAogCXJldHVybiBjb3VudDsKIH0KQEAgLTE5OSw0NiArMTkyLDQ2IEBAIGk5MTVfbDNfd3JpdGUo
c3RydWN0IGZpbGUgKmZpbHAsIHN0cnVjdCBrb2JqZWN0ICprb2JqLAogCSAgICAgIGxvZmZfdCBv
ZmZzZXQsIHNpemVfdCBjb3VudCkKIHsKIAlzdHJ1Y3QgZGV2aWNlICprZGV2ID0ga29ial90b19k
ZXYoa29iaik7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0ga2Rldl9taW5v
cl90b19pOTE1KGtkZXYpOwotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmZGV2X3ByaXYtPmRy
bTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGtkZXZfbWlub3JfdG9faTkxNShr
ZGV2KTsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwogCWludCBzbGljZSA9IChpbnQp
KHVpbnRwdHJfdClhdHRyLT5wcml2YXRlOwotCXUzMiAqKnJlbWFwX2luZm87CisJdTMyICpyZW1h
cF9pbmZvLCAqZnJlZW1lID0gTlVMTDsKIAlpbnQgcmV0OwogCi0JcmV0ID0gbDNfYWNjZXNzX3Zh
bGlkKGRldl9wcml2LCBvZmZzZXQpOworCXJldCA9IGwzX2FjY2Vzc192YWxpZChpOTE1LCBvZmZz
ZXQpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlyZXQgPSBpOTE1X211dGV4X2xvY2tf
aW50ZXJydXB0aWJsZShkZXYpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7CisJcmVtYXBfaW5m
byA9IGt6YWxsb2MoR0VON19MM0xPR19TSVpFLCBHRlBfS0VSTkVMKTsKKwlpZiAoIXJlbWFwX2lu
Zm8pCisJCXJldHVybiAtRU5PTUVNOwogCi0JcmVtYXBfaW5mbyA9ICZkZXZfcHJpdi0+bDNfcGFy
aXR5LnJlbWFwX2luZm9bc2xpY2VdOwotCWlmICghKnJlbWFwX2luZm8pIHsKLQkJKnJlbWFwX2lu
Zm8gPSBremFsbG9jKEdFTjdfTDNMT0dfU0laRSwgR0ZQX0tFUk5FTCk7Ci0JCWlmICghKnJlbWFw
X2luZm8pIHsKLQkJCXJldCA9IC1FTk9NRU07Ci0JCQlnb3RvIG91dDsKLQkJfQorCXNwaW5fbG9j
aygmaTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOworCisJaWYgKGk5MTUtPmwzX3Bhcml0eS5yZW1h
cF9pbmZvW3NsaWNlXSkgeworCQlmcmVlbWUgPSByZW1hcF9pbmZvOworCQlyZW1hcF9pbmZvID0g
aTkxNS0+bDNfcGFyaXR5LnJlbWFwX2luZm9bc2xpY2VdOworCX0gZWxzZSB7CisJCWk5MTUtPmwz
X3Bhcml0eS5yZW1hcF9pbmZvW3NsaWNlXSA9IHJlbWFwX2luZm87CiAJfQogCi0JLyogVE9ETzog
SWRlYWxseSB3ZSByZWFsbHkgd2FudCBhIEdQVSByZXNldCBoZXJlIHRvIG1ha2Ugc3VyZSBlcnJv
cnMKLQkgKiBhcmVuJ3QgcHJvcGFnYXRlZC4gU2luY2UgSSBjYW5ub3QgZmluZCBhIHN0YWJsZSB3
YXkgdG8gcmVzZXQgdGhlIEdQVQotCSAqIGF0IHRoaXMgcG9pbnQgaXQgaXMgbGVmdCBhcyBhIFRP
RE8uCi0JKi8KLQltZW1jcHkoKnJlbWFwX2luZm8gKyAob2Zmc2V0LzQpLCBidWYsIGNvdW50KTsK
Kwljb3VudCA9IHJvdW5kX2Rvd24oY291bnQsIDQpOworCW1lbWNweShyZW1hcF9pbmZvICsgb2Zm
c2V0IC8gNCwgYnVmLCBjb3VudCk7CiAKIAkvKiBOQjogV2UgZGVmZXIgdGhlIHJlbWFwcGluZyB1
bnRpbCB3ZSBzd2l0Y2ggdG8gdGhlIGNvbnRleHQgKi8KLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KGN0
eCwgJmRldl9wcml2LT5jb250ZXh0cy5saXN0LCBsaW5rKQotCQljdHgtPnJlbWFwX3NsaWNlIHw9
ICgxPDxzbGljZSk7CisJbGlzdF9mb3JfZWFjaF9lbnRyeShjdHgsICZpOTE1LT5nZW0uY29udGV4
dHMubGlzdCwgbGluaykKKwkJY3R4LT5yZW1hcF9zbGljZSB8PSBCSVQoc2xpY2UpOwogCi0JcmV0
ID0gY291bnQ7CisJc3Bpbl91bmxvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKKwlrZnJl
ZShmcmVlbWUpOwogCi1vdXQ6Ci0JbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CisJ
LyoKKwkgKiBUT0RPOiBJZGVhbGx5IHdlIHJlYWxseSB3YW50IGEgR1BVIHJlc2V0IGhlcmUgdG8g
bWFrZSBzdXJlIGVycm9ycworCSAqIGFyZW4ndCBwcm9wYWdhdGVkLiBTaW5jZSBJIGNhbm5vdCBm
aW5kIGEgc3RhYmxlIHdheSB0byByZXNldCB0aGUgR1BVCisJICogYXQgdGhpcyBwb2ludCBpdCBp
cyBsZWZ0IGFzIGEgVE9ETy4KKwkgKi8KIAotCXJldHVybiByZXQ7CisJcmV0dXJuIGNvdW50Owog
fQogCiBzdGF0aWMgY29uc3Qgc3RydWN0IGJpbl9hdHRyaWJ1dGUgZHBmX2F0dHJzID0gewpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV90cmFjZS5oIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV90cmFjZS5oCmluZGV4IDFmMmNmNmNmYWZiNS4uN2VmN2ExZTE2NjRjIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3RyYWNlLmgKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV90cmFjZS5oCkBAIC05NTIsNyArOTUyLDcgQEAgREVDTEFSRV9F
VkVOVF9DTEFTUyhpOTE1X2NvbnRleHQsCiAJVFBfZmFzdF9hc3NpZ24oCiAJCQlfX2VudHJ5LT5k
ZXYgPSBjdHgtPmk5MTUtPmRybS5wcmltYXJ5LT5pbmRleDsKIAkJCV9fZW50cnktPmN0eCA9IGN0
eDsKLQkJCV9fZW50cnktPnZtID0gY3R4LT52bTsKKwkJCV9fZW50cnktPnZtID0gcmN1X2FjY2Vz
c19wb2ludGVyKGN0eC0+dm0pOwogCSksCiAKIAlUUF9wcmludGsoImRldj0ldSwgY3R4PSVwLCBj
dHhfdm09JXAiLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5
MTVfZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW0uYwppbmRl
eCAwMzQ2YzNlNWI2YjYuLmJmYTQwYTViNmQ5OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2Vs
ZnRlc3RzL2k5MTVfZ2VtLmMKQEAgLTEzOCwxMSArMTM4LDkgQEAgc3RhdGljIGludCBpZ3RfZ2Vt
X3N1c3BlbmQodm9pZCAqYXJnKQogCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKIAogCWVyciA9IC1F
Tk9NRU07Ci0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJY3R4ID0gbGl2
ZV9jb250ZXh0KGk5MTUsIGZpbGUpOwogCWlmICghSVNfRVJSKGN0eCkpCiAJCWVyciA9IHN3aXRj
aF90b19jb250ZXh0KGk5MTUsIGN0eCk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKIAlpZiAoZXJyKQogCQlnb3RvIG91dDsKIApAQCAtMTU3LDkgKzE1NSw3IEBAIHN0
YXRpYyBpbnQgaWd0X2dlbV9zdXNwZW5kKHZvaWQgKmFyZykKIAogCXBtX3Jlc3VtZShpOTE1KTsK
IAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWVyciA9IHN3aXRjaF90
b19jb250ZXh0KGk5MTUsIGN0eCk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKIG91dDoKIAltb2NrX2ZpbGVfZnJlZShpOTE1LCBmaWxlKTsKIAlyZXR1cm4gZXJyOwpA
QCAtMTc3LDExICsxNzMsOSBAQCBzdGF0aWMgaW50IGlndF9nZW1faGliZXJuYXRlKHZvaWQgKmFy
ZykKIAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAKIAllcnIgPSAtRU5PTUVNOwotCW11dGV4X2xv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWN0eCA9IGxpdmVfY29udGV4dChpOTE1LCBm
aWxlKTsKIAlpZiAoIUlTX0VSUihjdHgpKQogCQllcnIgPSBzd2l0Y2hfdG9fY29udGV4dChpOTE1
LCBjdHgpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKGVy
cikKIAkJZ290byBvdXQ7CiAKQEAgLTE5Niw5ICsxOTAsNyBAQCBzdGF0aWMgaW50IGlndF9nZW1f
aGliZXJuYXRlKHZvaWQgKmFyZykKIAogCXBtX3Jlc3VtZShpOTE1KTsKIAotCW11dGV4X2xvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWVyciA9IHN3aXRjaF90b19jb250ZXh0KGk5MTUs
IGN0eCk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIG91dDoKIAlt
b2NrX2ZpbGVfZnJlZShpOTE1LCBmaWxlKTsKIAlyZXR1cm4gZXJyOwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYwppbmRleCBmMzlmMDI4MmU3OGMu
LjBhZjlhNThkMDExZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3Rz
L2k5MTVfZ2VtX2V2aWN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5
MTVfZ2VtX2V2aWN0LmMKQEAgLTQ3Myw3ICs0NzMsNiBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9j
b250ZXh0cyh2b2lkICphcmcpCiAJCX0KIAogCQljb3VudCA9IDA7Ci0JCW11dGV4X2xvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQlvbnN0YWNrX2ZlbmNlX2luaXQoJmZlbmNlKTsKIAkJ
ZG8gewogCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CkBAIC01MTAsOCArNTA5LDYgQEAgc3Rh
dGljIGludCBpZ3RfZXZpY3RfY29udGV4dHModm9pZCAqYXJnKQogCQkJY291bnQrKzsKIAkJCWVy
ciA9IDA7CiAJCX0gd2hpbGUoMSk7Ci0JCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7Ci0KIAkJb25zdGFja19mZW5jZV9maW5pKCZmZW5jZSk7CiAJCXByX2luZm8oIlN1Ym1p
dHRlZCAlbHUgY29udGV4dHMvcmVxdWVzdHMgb24gJXNcbiIsCiAJCQljb3VudCwgZW5naW5lLT5u
YW1lKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dl
bV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ndHQuYwpp
bmRleCBlNDBlNmNmYTUxZjEuLjhkODEyMWMwMjE2MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2d0dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ndHQuYwpAQCAtMTI0Niw2ICsxMjQ2LDcgQEAgc3RhdGlj
IGludCBleGVyY2lzZV9tb2NrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAg
ICAgdW5zaWduZWQgbG9uZyBlbmRfdGltZSkpCiB7CiAJY29uc3QgdTY0IGxpbWl0ID0gdG90YWxy
YW1fcGFnZXMoKSA8PCBQQUdFX1NISUZUOworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZt
OwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CiAJSUdUX1RJTUVPVVQoZW5kX3RpbWUp
OwogCWludCBlcnI7CkBAIC0xMjU0LDcgKzEyNTUsOSBAQCBzdGF0aWMgaW50IGV4ZXJjaXNlX21v
Y2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJaWYgKCFjdHgpCiAJCXJldHVybiAt
RU5PTUVNOwogCi0JZXJyID0gZnVuYyhpOTE1LCBjdHgtPnZtLCAwLCBtaW4oY3R4LT52bS0+dG90
YWwsIGxpbWl0KSwgZW5kX3RpbWUpOworCXZtID0gaTkxNV9nZW1fY29udGV4dF9nZXRfdm1fcmN1
KGN0eCk7CisJZXJyID0gZnVuYyhpOTE1LCB2bSwgMCwgbWluKHZtLT50b3RhbCwgbGltaXQpLCBl
bmRfdGltZSk7CisJaTkxNV92bV9wdXQodm0pOwogCiAJbW9ja19jb250ZXh0X2Nsb3NlKGN0eCk7
CiAJcmV0dXJuIGVycjsKQEAgLTE4MDEsMTUgKzE4MDQsMTUgQEAgc3RhdGljIGludCBpZ3RfY3Nf
dGxiKHZvaWQgKmFyZykKIAkJZ290byBvdXRfdW5sb2NrOwogCX0KIAotCXZtID0gY3R4LT52bTsK
LQlpZiAoIXZtKQotCQlnb3RvIG91dF91bmxvY2s7CisJdm0gPSBpOTE1X2dlbV9jb250ZXh0X2dl
dF92bV9yY3UoY3R4KTsKKwlpZiAoaTkxNV9pc19nZ3R0KHZtKSkKKwkJZ290byBvdXRfdm07CiAK
IAkvKiBDcmVhdGUgdHdvIHBhZ2VzOyBkdW1teSB3ZSBwcmVmaWxsIHRoZSBUTEIsIGFuZCBpbnRl
bmRlZCAqLwogCWJiZSA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoaTkxNSwgUEFH
RV9TSVpFKTsKIAlpZiAoSVNfRVJSKGJiZSkpIHsKIAkJZXJyID0gUFRSX0VSUihiYmUpOwotCQln
b3RvIG91dF91bmxvY2s7CisJCWdvdG8gb3V0X3ZtOwogCX0KIAogCWJhdGNoID0gaTkxNV9nZW1f
b2JqZWN0X3Bpbl9tYXAoYmJlLCBJOTE1X01BUF9XQyk7CkBAIC0yMDE0LDYgKzIwMTcsOCBAQCBz
dGF0aWMgaW50IGlndF9jc190bGIodm9pZCAqYXJnKQogCWk5MTVfZ2VtX29iamVjdF9wdXQoYWN0
KTsKIG91dF9wdXRfYmJlOgogCWk5MTVfZ2VtX29iamVjdF9wdXQoYmJlKTsKK291dF92bToKKwlp
OTE1X3ZtX3B1dCh2bSk7CiBvdXRfdW5sb2NrOgogCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CiAJbW9ja19maWxlX2ZyZWUoaTkxNSwgZmlsZSk7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMKaW5kZXggZDdkNjhjNmE2YmQ1Li4w
ODk3YTdiMDQ5NDQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
OTE1X3JlcXVlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9y
ZXF1ZXN0LmMKQEAgLTE4MSw5ICsxODEsNyBAQCBzdGF0aWMgaW50IGlndF9yZXF1ZXN0X3Jld2lu
ZCh2b2lkICphcmcpCiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCWludCBlcnIgPSAtRUlO
VkFMOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJY3R4WzBdID0g
bW9ja19jb250ZXh0KGk5MTUsICJBIik7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKIAogCWNlID0gaTkxNV9nZW1fY29udGV4dF9nZXRfZW5naW5lKGN0eFswXSwgUkNT
MCk7CiAJR0VNX0JVR19PTihJU19FUlIoY2UpKTsKQEAgLTE5Nyw5ICsxOTUsNyBAQCBzdGF0aWMg
aW50IGlndF9yZXF1ZXN0X3Jld2luZCh2b2lkICphcmcpCiAJaTkxNV9yZXF1ZXN0X2dldChyZXF1
ZXN0KTsKIAlpOTE1X3JlcXVlc3RfYWRkKHJlcXVlc3QpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAJY3R4WzFdID0gbW9ja19jb250ZXh0KGk5MTUsICJCIik7Ci0J
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCWNlID0gaTkxNV9nZW1f
Y29udGV4dF9nZXRfZW5naW5lKGN0eFsxXSwgUkNTMCk7CiAJR0VNX0JVR19PTihJU19FUlIoY2Up
KTsKQEAgLTQzOCw5ICs0MzQsNyBAQCBzdGF0aWMgaW50IG1vY2tfYnJlYWRjcnVtYnNfc21va2V0
ZXN0KHZvaWQgKmFyZykKIAl9CiAKIAlmb3IgKG4gPSAwOyBuIDwgdC5uY29udGV4dHM7IG4rKykg
ewotCQltdXRleF9sb2NrKCZ0LmVuZ2luZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCXQu
Y29udGV4dHNbbl0gPSBtb2NrX2NvbnRleHQodC5lbmdpbmUtPmk5MTUsICJtb2NrIik7Ci0JCW11
dGV4X3VubG9jaygmdC5lbmdpbmUtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQlpZiAoIXQu
Y29udGV4dHNbbl0pIHsKIAkJCXJldCA9IC1FTk9NRU07CiAJCQlnb3RvIG91dF9jb250ZXh0czsK
QEAgLTczNCw5ICs3MjgsOSBAQCBzdGF0aWMgaW50IGxpdmVfZW1wdHlfcmVxdWVzdCh2b2lkICph
cmcpCiBzdGF0aWMgc3RydWN0IGk5MTVfdm1hICpyZWN1cnNpdmVfYmF0Y2goc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IGk5
MTUtPmtlcm5lbF9jb250ZXh0OwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gY3R4
LT52bSA/OiAmaTkxNS0+Z2d0dC52bTsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
OwogCWNvbnN0IGludCBnZW4gPSBJTlRFTF9HRU4oaTkxNSk7CisJc3RydWN0IGk5MTVfYWRkcmVz
c19zcGFjZSAqdm07CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJdTMyICpjbWQ7CiAJaW50IGVy
cjsKQEAgLTc0NSw3ICs3MzksOSBAQCBzdGF0aWMgc3RydWN0IGk5MTVfdm1hICpyZWN1cnNpdmVf
YmF0Y2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJaWYgKElTX0VSUihvYmopKQog
CQlyZXR1cm4gRVJSX0NBU1Qob2JqKTsKIAorCXZtID0gaTkxNV9nZW1fY29udGV4dF9nZXRfdm1f
cmN1KGN0eCk7CiAJdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCB2bSwgTlVMTCk7CisJaTkx
NV92bV9wdXQodm0pOwogCWlmIChJU19FUlIodm1hKSkgewogCQllcnIgPSBQVFJfRVJSKHZtYSk7
CiAJCWdvdG8gZXJyOwpAQCAtMTIyMCw5ICsxMjE2LDcgQEAgc3RhdGljIGludCBsaXZlX2JyZWFk
Y3J1bWJzX3Ntb2tldGVzdCh2b2lkICphcmcpCiAJfQogCiAJZm9yIChuID0gMDsgbiA8IHRbMF0u
bmNvbnRleHRzOyBuKyspIHsKLQkJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiAJCXRbMF0uY29udGV4dHNbbl0gPSBsaXZlX2NvbnRleHQoaTkxNSwgZmlsZSk7Ci0JCW11dGV4
X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWlmICghdFswXS5jb250ZXh0c1tu
XSkgewogCQkJcmV0ID0gLUVOT01FTTsKIAkJCWdvdG8gb3V0X2NvbnRleHRzOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfdm1hLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYwppbmRleCBhYzFmZjU1OGViOTAuLjU4YjVm
NDBhMDdkZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVf
dm1hLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfdm1hLmMKQEAg
LTI0LDYgKzI0LDcgQEAKIAogI2luY2x1ZGUgPGxpbnV4L3ByaW1lX251bWJlcnMuaD4KIAorI2lu
Y2x1ZGUgImdlbS9pOTE1X2dlbV9jb250ZXh0LmgiCiAjaW5jbHVkZSAiZ2VtL3NlbGZ0ZXN0cy9t
b2NrX2NvbnRleHQuaCIKIAogI2luY2x1ZGUgImk5MTVfc2NhdHRlcmxpc3QuaCIKQEAgLTM4LDcg
KzM5LDcgQEAgc3RhdGljIGJvb2wgYXNzZXJ0X3ZtYShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIHsK
IAlib29sIG9rID0gdHJ1ZTsKIAotCWlmICh2bWEtPnZtICE9IGN0eC0+dm0pIHsKKwlpZiAodm1h
LT52bSAhPSByY3VfYWNjZXNzX3BvaW50ZXIoY3R4LT52bSkpIHsKIAkJcHJfZXJyKCJWTUEgY3Jl
YXRlZCB3aXRoIHdyb25nIFZNXG4iKTsKIAkJb2sgPSBmYWxzZTsKIAl9CkBAIC0xMTMsMTEgKzEx
NCwxMyBAQCBzdGF0aWMgaW50IGNyZWF0ZV92bWFzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LAogCWxpc3RfZm9yX2VhY2hfZW50cnkob2JqLCBvYmplY3RzLCBzdF9saW5rKSB7CiAJCWZv
ciAocGlubmVkID0gMDsgcGlubmVkIDw9IDE7IHBpbm5lZCsrKSB7CiAJCQlsaXN0X2Zvcl9lYWNo
X2VudHJ5KGN0eCwgY29udGV4dHMsIGxpbmspIHsKLQkJCQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3Nw
YWNlICp2bSA9IGN0eC0+dm07CisJCQkJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CiAJ
CQkJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJCQkJaW50IGVycjsKIAorCQkJCXZtID0gaTkxNV9n
ZW1fY29udGV4dF9nZXRfdm1fcmN1KGN0eCk7CiAJCQkJdm1hID0gY2hlY2tlZF92bWFfaW5zdGFu
Y2Uob2JqLCB2bSwgTlVMTCk7CisJCQkJaTkxNV92bV9wdXQodm0pOwogCQkJCWlmIChJU19FUlIo
dm1hKSkKIAkJCQkJcmV0dXJuIFBUUl9FUlIodm1hKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jCmluZGV4IDRlNmNkZTBkNDg1OS4uMzM1
ZjM3YmE5OGRlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9j
a19nZW1fZGV2aWNlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tf
Z2VtX2RldmljZS5jCkBAIC01OSwxMSArNTksOSBAQCBzdGF0aWMgdm9pZCBtb2NrX2RldmljZV9y
ZWxlYXNlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAKIAlpOTE1X2dlbV9kcmFpbl93b3JrcXVl
dWUoaTkxNSk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlmb3Jf
ZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkKIAkJbW9ja19lbmdpbmVfZnJlZShlbmdpbmUp
OwotCWk5MTVfZ2VtX2NvbnRleHRzX2ZpbmkoaTkxNSk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKKwlpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZV9fY29udGV4dHMoaTkx
NSk7CiAKIAlpbnRlbF90aW1lbGluZXNfZmluaShpOTE1KTsKIApAQCAtMjA2LDcgKzIwNCw3IEBA
IHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICptb2NrX2dlbV9kZXZpY2Uodm9pZCkKIAlyZXR1cm4g
aTkxNTsKIAogZXJyX2NvbnRleHQ6Ci0JaTkxNV9nZW1fY29udGV4dHNfZmluaShpOTE1KTsKKwlp
OTE1X2dlbV9kcml2ZXJfcmVsZWFzZV9fY29udGV4dHMoaTkxNSk7CiBlcnJfZW5naW5lOgogCW1v
Y2tfZW5naW5lX2ZyZWUoaTkxNS0+ZW5naW5lW1JDUzBdKTsKIGVycl91bmxvY2s6Ci0tIAoyLjIz
LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVs
LWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

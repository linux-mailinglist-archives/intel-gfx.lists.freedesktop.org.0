Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 5569583180
	for <lists+intel-gfx@lfdr.de>; Tue,  6 Aug 2019 14:37:50 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CB2806E366;
	Tue,  6 Aug 2019 12:37:47 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 24C706E366;
 Tue,  6 Aug 2019 12:37:45 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17905084-1500050 
 for multiple; Tue, 06 Aug 2019 13:36:45 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue,  6 Aug 2019 13:36:44 +0100
Message-Id: <20190806123644.29194-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t] Add i915/gem_ctx_persistence
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U2FuaXR5IHRlc3QgZXhpc3RpbmcgcGVyc2lzdGVuY2UgYW5kIG5ldyBleGNpdGluZyBub24tcGVy
c2lzdGVudCBjb250ZXh0CmJlaGF2aW91ci4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8
Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogSm9vbmFzIExhaHRpbmVuIDxqb29uYXMubGFo
dGluZW5AbGludXguaW50ZWwuY29tPgpDYzogTWljaGHFgiBXaW5pYXJza2kgPG1pY2hhbC53aW5p
YXJza2lAaW50ZWwuY29tPgpDYzogSm9uIEJsb29tZmllbGQgPGpvbi5ibG9vbWZpZWxkQGludGVs
LmNvbT4KLS0tCiBsaWIvaTkxNS9nZW1fY29udGV4dC5jICAgICAgICAgICB8ICAzNyArKysrKwog
bGliL2k5MTUvZ2VtX2NvbnRleHQuaCAgICAgICAgICAgfCAgIDkgKysKIGxpYi9pb2N0bF93cmFw
cGVycy5jICAgICAgICAgICAgIHwgICAxICsKIHRlc3RzL01ha2VmaWxlLnNvdXJjZXMgICAgICAg
ICAgIHwgICAzICsKIHRlc3RzL2k5MTUvZ2VtX2N0eF9wZXJzaXN0ZW5jZS5jIHwgMjQxICsrKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysKIHRlc3RzL21lc29uLmJ1aWxkICAgICAgICAgICAg
ICAgIHwgICAxICsKIDYgZmlsZXMgY2hhbmdlZCwgMjkyIGluc2VydGlvbnMoKykKIGNyZWF0ZSBt
b2RlIDEwMDY0NCB0ZXN0cy9pOTE1L2dlbV9jdHhfcGVyc2lzdGVuY2UuYwoKZGlmZiAtLWdpdCBh
L2xpYi9pOTE1L2dlbV9jb250ZXh0LmMgYi9saWIvaTkxNS9nZW1fY29udGV4dC5jCmluZGV4IDgz
YzVkZjk2MS4uMWZhZTUxOTFmIDEwMDY0NAotLS0gYS9saWIvaTkxNS9nZW1fY29udGV4dC5jCisr
KyBiL2xpYi9pOTE1L2dlbV9jb250ZXh0LmMKQEAgLTI3Miw2ICsyNzIsNDMgQEAgdm9pZCBnZW1f
Y29udGV4dF9zZXRfcHJpb3JpdHkoaW50IGZkLCB1aW50MzJfdCBjdHhfaWQsIGludCBwcmlvKQog
CWlndF9hc3NlcnRfZXEoX19nZW1fY29udGV4dF9zZXRfcHJpb3JpdHkoZmQsIGN0eF9pZCwgcHJp
byksIDApOwogfQogCisvKioKKyAqIF9fZ2VtX2NvbnRleHRfc2V0X3BlcnNpc3RlbmNlOgorICog
QGk5MTU6IG9wZW4gaTkxNSBkcm0gZmlsZSBkZXNjcmlwdG9yCisgKiBAY3R4OiBpOTE1IGNvbnRl
eHQgaWQKKyAqIEBzdGF0ZTogZGVzaXJlZCBwZXJzaXN0ZW5jZQorICoKKyAqIERlY2xhcmUgd2hl
dGhlciB0aGlzIGNvbnRleHQgaXMgYWxsb3dlZCB0byBwZXJzaXN0IGFmdGVyIGNsb3NpbmcgdW50
aWwKKyAqIGl0cyByZXF1ZXN0cyBhcmUgY29tcGxldGUgKHBlcnNpc3RlbnQ9dHJ1ZSkgb3IgaWYg
aXQgc2hvdWxkIGJlCisgKiBpbW1lZGlhdGVseSByZWFwZWQgb24gY2xvc2luZyBhbmQgaXRzIHJl
cXVlc3RzIGNhbmNlbGxlZAorICogKHBlcnNpc3RlbnQ9ZmFsc2UpLgorICoKKyAqIFJldHVybnM6
IEFuIGludGVnZXIgZXF1YWwgdG8gemVybyBmb3Igc3VjY2VzcyBhbmQgbmVnYXRpdmUgZm9yIGZh
aWx1cmUKKyAqLworaW50IF9fZ2VtX2NvbnRleHRfc2V0X3BlcnNpc3RlbmNlKGludCBpOTE1LCB1
aW50MzJfdCBjdHgsIGJvb2wgc3RhdGUpCit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9jb250ZXh0
X3BhcmFtIHAgPSB7CisJCS5jdHhfaWQgPSBjdHgsCisJCS5wYXJhbSA9IEk5MTVfQ09OVEVYVF9Q
QVJBTV9QRVJTSVNURU5DRSwKKwkJLnZhbHVlID0gc3RhdGUsCisJfTsKKworCXJldHVybiBfX2dl
bV9jb250ZXh0X3NldF9wYXJhbShpOTE1LCAmcCk7Cit9CisKKy8qKgorICogX19nZW1fY29udGV4
dF9zZXRfcGVyc2lzdGVuY2U6CisgKiBAaTkxNTogb3BlbiBpOTE1IGRybSBmaWxlIGRlc2NyaXB0
b3IKKyAqIEBjdHg6IGk5MTUgY29udGV4dCBpZAorICogQHN0YXRlOiBkZXNpcmVkIHBlcnNpc3Rl
bmNlCisgKgorICogTGlrZSBfX2dlbV9jb250ZXh0X3NldF9wZXJzaXN0ZW5jZSgpLCBleGNlcHQg
d2UgYXNzZXJ0IG9uIGZhaWx1cmUuCisgKi8KK3ZvaWQgZ2VtX2NvbnRleHRfc2V0X3BlcnNpc3Rl
bmNlKGludCBpOTE1LCB1aW50MzJfdCBjdHgsIGJvb2wgc3RhdGUpCit7CisJaWd0X2Fzc2VydF9l
cShfX2dlbV9jb250ZXh0X3NldF9wZXJzaXN0ZW5jZShpOTE1LCBjdHgsIHN0YXRlKSwgMCk7Cit9
CisKIGludAogX19nZW1fY29udGV4dF9jbG9uZShpbnQgaTkxNSwKIAkJICAgIHVpbnQzMl90IHNy
YywgdW5zaWduZWQgaW50IHNoYXJlLApkaWZmIC0tZ2l0IGEvbGliL2k5MTUvZ2VtX2NvbnRleHQu
aCBiL2xpYi9pOTE1L2dlbV9jb250ZXh0LmgKaW5kZXggODA0M2MzNDAxLi42NzQ1YzkwYzMgMTAw
NjQ0Ci0tLSBhL2xpYi9pOTE1L2dlbV9jb250ZXh0LmgKKysrIGIvbGliL2k5MTUvZ2VtX2NvbnRl
eHQuaApAQCAtMjQsNiArMjQsMTEgQEAKICNpZm5kZWYgR0VNX0NPTlRFWFRfSAogI2RlZmluZSBH
RU1fQ09OVEVYVF9ICiAKKyNpbmNsdWRlIDxzdGRib29sLmg+CisjaW5jbHVkZSA8c3RkaW50Lmg+
CisKK3N0cnVjdCBkcm1faTkxNV9nZW1fY29udGV4dF9wYXJhbTsKKwogdWludDMyX3QgZ2VtX2Nv
bnRleHRfY3JlYXRlKGludCBmZCk7CiBpbnQgX19nZW1fY29udGV4dF9jcmVhdGUoaW50IGZkLCB1
aW50MzJfdCAqY3R4X2lkKTsKIHZvaWQgZ2VtX2NvbnRleHRfZGVzdHJveShpbnQgZmQsIHVpbnQz
Ml90IGN0eF9pZCk7CkBAIC01OCw2ICs2MywxMCBAQCBpbnQgX19nZW1fY29udGV4dF9nZXRfcGFy
YW0oaW50IGZkLCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2NvbnRleHRfcGFyYW0gKnApOwogaW50IF9f
Z2VtX2NvbnRleHRfc2V0X3ByaW9yaXR5KGludCBmZCwgdWludDMyX3QgY3R4LCBpbnQgcHJpbyk7
CiB2b2lkIGdlbV9jb250ZXh0X3NldF9wcmlvcml0eShpbnQgZmQsIHVpbnQzMl90IGN0eCwgaW50
IHByaW8pOwogCisjZGVmaW5lIEk5MTVfQ09OVEVYVF9QQVJBTV9QRVJTSVNURU5DRSAweGIKK2lu
dCBfX2dlbV9jb250ZXh0X3NldF9wZXJzaXN0ZW5jZShpbnQgaTkxNSwgdWludDMyX3QgY3R4LCBi
b29sIHN0YXRlKTsKK3ZvaWQgZ2VtX2NvbnRleHRfc2V0X3BlcnNpc3RlbmNlKGludCBpOTE1LCB1
aW50MzJfdCBjdHgsIGJvb2wgc3RhdGUpOworCiBib29sIGdlbV9jb250ZXh0X2hhc19lbmdpbmUo
aW50IGZkLCB1aW50MzJfdCBjdHgsIHVpbnQ2NF90IGVuZ2luZSk7CiAKICNlbmRpZiAvKiBHRU1f
Q09OVEVYVF9IICovCmRpZmYgLS1naXQgYS9saWIvaW9jdGxfd3JhcHBlcnMuYyBiL2xpYi9pb2N0
bF93cmFwcGVycy5jCmluZGV4IDI4MGZkZDYyNC4uNjI4ZjhiODMwIDEwMDY0NAotLS0gYS9saWIv
aW9jdGxfd3JhcHBlcnMuYworKysgYi9saWIvaW9jdGxfd3JhcHBlcnMuYwpAQCAtNDQ1LDYgKzQ0
NSw3IEBAIGludCBnZW1fd2FpdChpbnQgZmQsIHVpbnQzMl90IGhhbmRsZSwgaW50NjRfdCAqdGlt
ZW91dF9ucykKIAlyZXQgPSAwOwogCWlmIChpZ3RfaW9jdGwoZmQsIERSTV9JT0NUTF9JOTE1X0dF
TV9XQUlULCAmd2FpdCkpCiAJCXJldCA9IC1lcnJubzsKKwllcnJubyA9IDA7CiAKIAlpZiAodGlt
ZW91dF9ucykKIAkJKnRpbWVvdXRfbnMgPSB3YWl0LnRpbWVvdXRfbnM7CmRpZmYgLS1naXQgYS90
ZXN0cy9NYWtlZmlsZS5zb3VyY2VzIGIvdGVzdHMvTWFrZWZpbGUuc291cmNlcwppbmRleCA0MWEx
MGM2NTMuLmYzNjFkYzAzMCAxMDA2NDQKLS0tIGEvdGVzdHMvTWFrZWZpbGUuc291cmNlcworKysg
Yi90ZXN0cy9NYWtlZmlsZS5zb3VyY2VzCkBAIC0xNTIsNiArMTUyLDkgQEAgZ2VtX2N0eF9pc29s
YXRpb25fU09VUkNFUyA9IGk5MTUvZ2VtX2N0eF9pc29sYXRpb24uYwogVEVTVFNfcHJvZ3MgKz0g
Z2VtX2N0eF9wYXJhbQogZ2VtX2N0eF9wYXJhbV9TT1VSQ0VTID0gaTkxNS9nZW1fY3R4X3BhcmFt
LmMKIAorVEVTVFNfcHJvZ3MgKz0gZ2VtX2N0eF9wZXJzaXN0ZW5jZQorZ2VtX2N0eF9wZXJzaXN0
ZW5jZV9TT1VSQ0VTID0gaTkxNS9nZW1fY3R4X2Vyc2lzdGVuY2UuYworCiBURVNUU19wcm9ncyAr
PSBnZW1fY3R4X3NoYXJlZAogZ2VtX2N0eF9zaGFyZWRfU09VUkNFUyA9IGk5MTUvZ2VtX2N0eF9z
aGFyZWQuYwogCmRpZmYgLS1naXQgYS90ZXN0cy9pOTE1L2dlbV9jdHhfcGVyc2lzdGVuY2UuYyBi
L3Rlc3RzL2k5MTUvZ2VtX2N0eF9wZXJzaXN0ZW5jZS5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0Cmlu
ZGV4IDAwMDAwMDAwMC4uZWM2YWRkMTM1Ci0tLSAvZGV2L251bGwKKysrIGIvdGVzdHMvaTkxNS9n
ZW1fY3R4X3BlcnNpc3RlbmNlLmMKQEAgLTAsMCArMSwyNDEgQEAKKy8qCisgKiBDb3B5cmlnaHQg
wqkgMjAxOSBJbnRlbCBDb3Jwb3JhdGlvbgorICoKKyAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdy
YW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhCisgKiBjb3B5
IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhl
ICJTb2Z0d2FyZSIpLAorICogdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmlj
dGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbgorICogdGhlIHJpZ2h0cyB0byB1c2Us
IGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsCisg
KiBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNv
bnMgdG8gd2hvbSB0aGUKKyAqIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVj
dCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CisgKgorICogVGhlIGFib3ZlIGNvcHlyaWdo
dCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2UgKGluY2x1ZGluZyB0aGUgbmV4dAor
ICogcGFyYWdyYXBoKSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50
aWFsIHBvcnRpb25zIG9mIHRoZQorICogU29mdHdhcmUuCisgKgorICogVEhFIFNPRlRXQVJFIElT
IFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1Mg
T1IKKyAqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJ
RVMgT0YgTUVSQ0hBTlRBQklMSVRZLAorICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBP
U0UgQU5EIE5PTklORlJJTkdFTUVOVC4gIElOIE5PIEVWRU5UIFNIQUxMCisgKiBUSEUgQVVUSE9S
UyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBP
UiBPVEhFUgorICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwg
VE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcKKyAqIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNU
SU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MKKyAqIElO
IFRIRSBTT0ZUV0FSRS4KKyAqLworCisjaW5jbHVkZSA8ZXJybm8uaD4KKyNpbmNsdWRlIDxzeXMv
c29ja2V0Lmg+CisjaW5jbHVkZSA8c3lzL3R5cGVzLmg+CisjaW5jbHVkZSA8dW5pc3RkLmg+CisK
KyNpbmNsdWRlICJkcm10ZXN0LmgiIC8qIGdlbV9xdWllc2NlbnRfZ3B1KCkhICovCisjaW5jbHVk
ZSAiaTkxNS9nZW1fY29udGV4dC5oIgorI2luY2x1ZGUgImk5MTUvZ2VtX3N1Ym1pc3Npb24uaCIK
KyNpbmNsdWRlICJpZ3RfZHVtbXlsb2FkLmgiCisjaW5jbHVkZSAiaW9jdGxfd3JhcHBlcnMuaCIg
LyogZ2VtX3dhaXQoKSEgKi8KKyNpbmNsdWRlICJzd19zeW5jLmgiCisKK3N0YXRpYyBib29sIGhh
c19wZXJzaXN0ZW5jZShpbnQgaTkxNSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2NvbnRleHRf
cGFyYW0gcCA9IHsKKwkJLnBhcmFtID0gSTkxNV9DT05URVhUX1BBUkFNX1BFUlNJU1RFTkNFLAor
CX07CisJdWludDY0X3Qgc2F2ZWQ7CisKKwlpZiAoX19nZW1fY29udGV4dF9nZXRfcGFyYW0oaTkx
NSwgJnApKQorCQlyZXR1cm4gZmFsc2U7CisKKwlzYXZlZCA9IHAudmFsdWU7CisJcC52YWx1ZSA9
IDA7CisJaWYgKF9fZ2VtX2NvbnRleHRfc2V0X3BhcmFtKGk5MTUsICZwKSkKKwkJcmV0dXJuIGZh
bHNlOworCisJcC52YWx1ZSA9IHNhdmVkOworCXJldHVybiBfX2dlbV9jb250ZXh0X3NldF9wYXJh
bShpOTE1LCAmcCkgPT0gMDsKK30KKworc3RhdGljIHZvaWQgdGVzdF9pZGVtcG90ZW50KGludCBp
OTE1KQoreworCXN0cnVjdCBkcm1faTkxNV9nZW1fY29udGV4dF9wYXJhbSBwID0geworCQkucGFy
YW0gPSBJOTE1X0NPTlRFWFRfUEFSQU1fUEVSU0lTVEVOQ0UsCisJfTsKKwlpbnQgZXhwZWN0ZWQ7
CisKKwlnZW1fY29udGV4dF9nZXRfcGFyYW0oaTkxNSwgJnApOworCWV4cGVjdGVkID0gISFwLnZh
bHVlOworCisJZXhwZWN0ZWQgPSAhZXhwZWN0ZWQ7CisJcC52YWx1ZSA9IGV4cGVjdGVkOworCWdl
bV9jb250ZXh0X3NldF9wYXJhbShpOTE1LCAmcCk7CisJZ2VtX2NvbnRleHRfZ2V0X3BhcmFtKGk5
MTUsICZwKTsKKwlpZ3RfYXNzZXJ0X2VxKHAudmFsdWUsIGV4cGVjdGVkKTsKKworCWV4cGVjdGVk
ID0gIWV4cGVjdGVkOyAvKiBhbmQgcmVzdG9yZXMgKi8KKwlwLnZhbHVlID0gZXhwZWN0ZWQ7CisJ
Z2VtX2NvbnRleHRfc2V0X3BhcmFtKGk5MTUsICZwKTsKKwlnZW1fY29udGV4dF9nZXRfcGFyYW0o
aTkxNSwgJnApOworCWlndF9hc3NlcnRfZXEocC52YWx1ZSwgZXhwZWN0ZWQpOworfQorCitzdGF0
aWMgdm9pZCB0ZXN0X3BlcnNpc3RlbmNlKGludCBpOTE1KQoreworCWlndF9zcGluX3QgKnNwaW47
CisJaW50NjRfdCB0aW1lb3V0OworCXVpbnQzMl90IGN0eDsKKworCWN0eCA9IGdlbV9jb250ZXh0
X2NyZWF0ZShpOTE1KTsKKwlnZW1fY29udGV4dF9zZXRfcGVyc2lzdGVuY2UoaTkxNSwgY3R4LCB0
cnVlKTsKKworCXNwaW4gPSBpZ3Rfc3Bpbl9uZXcoaTkxNSwgY3R4LCAuZmxhZ3MgPSBJR1RfU1BJ
Tl9GRU5DRV9PVVQpOworCWdlbV9jb250ZXh0X2Rlc3Ryb3koaTkxNSwgY3R4KTsKKworCXRpbWVv
dXQgPSBOU0VDX1BFUl9TRUMgLyA1OworCWlndF9hc3NlcnRfZXEoZ2VtX3dhaXQoaTkxNSwgc3Bp
bi0+aGFuZGxlLCAmdGltZW91dCksIC1FVElNRSk7CisKKwlpZ3Rfc3Bpbl9lbmQoc3Bpbik7CisK
Kwl0aW1lb3V0ID0gTlNFQ19QRVJfU0VDIC8gNTsKKwlpZ3RfYXNzZXJ0X2VxKGdlbV93YWl0KGk5
MTUsIHNwaW4tPmhhbmRsZSwgJnRpbWVvdXQpLCAwKTsKKwlpZ3RfYXNzZXJ0X2VxKHN5bmNfZmVu
Y2Vfc3RhdHVzKHNwaW4tPm91dF9mZW5jZSksIDEpOworCisJaWd0X3NwaW5fZnJlZShpOTE1LCBz
cGluKTsKKwlnZW1fcXVpZXNjZW50X2dwdShpOTE1KTsKK30KKworc3RhdGljIHZvaWQgdGVzdF9u
b25wZXJzaXN0ZW50X2NsZWFudXAoaW50IGk5MTUpCit7CisJaW50NjRfdCB0aW1lb3V0ID0gTlNF
Q19QRVJfU0VDIC8gNTsKKwlpZ3Rfc3Bpbl90ICpzcGluOworCXVpbnQzMl90IGN0eDsKKworCWN0
eCA9IGdlbV9jb250ZXh0X2NyZWF0ZShpOTE1KTsKKwlnZW1fY29udGV4dF9zZXRfcGVyc2lzdGVu
Y2UoaTkxNSwgY3R4LCBmYWxzZSk7CisKKwlzcGluID0gaWd0X3NwaW5fbmV3KGk5MTUsIGN0eCwg
LmZsYWdzID0gSUdUX1NQSU5fRkVOQ0VfT1VUKTsKKwlnZW1fY29udGV4dF9kZXN0cm95KGk5MTUs
IGN0eCk7CisKKwlpZ3RfYXNzZXJ0X2VxKGdlbV93YWl0KGk5MTUsIHNwaW4tPmhhbmRsZSwgJnRp
bWVvdXQpLCAwKTsKKwlpZ3RfYXNzZXJ0X2VxKHN5bmNfZmVuY2Vfc3RhdHVzKHNwaW4tPm91dF9m
ZW5jZSksIC1FSU8pOworCisJaWd0X3NwaW5fZnJlZShpOTE1LCBzcGluKTsKKwlnZW1fcXVpZXNj
ZW50X2dwdShpOTE1KTsKK30KKworc3RhdGljIHZvaWQgdGVzdF9ub25wZXJzaXN0ZW50X2hvc3Rp
bGUoaW50IGk5MTUpCit7CisJaW50NjRfdCB0aW1lb3V0ID0gTlNFQ19QRVJfU0VDIC8gMjsKKwlp
Z3Rfc3Bpbl90ICpzcGluOworCXVpbnQzMl90IGN0eDsKKworCWN0eCA9IGdlbV9jb250ZXh0X2Ny
ZWF0ZShpOTE1KTsKKwlnZW1fY29udGV4dF9zZXRfcGVyc2lzdGVuY2UoaTkxNSwgY3R4LCBmYWxz
ZSk7CisKKwlzcGluID0gaWd0X3NwaW5fbmV3KGk5MTUsIGN0eCwgLmZsYWdzID0gSUdUX1NQSU5f
Tk9fUFJFRU1QVElPTik7CisJZ2VtX2NvbnRleHRfZGVzdHJveShpOTE1LCBjdHgpOworCisJaWd0
X2Fzc2VydF9lcShnZW1fd2FpdChpOTE1LCBzcGluLT5oYW5kbGUsICZ0aW1lb3V0KSwgMCk7CisJ
aWd0X2Fzc2VydF9lcShzeW5jX2ZlbmNlX3N0YXR1cyhzcGluLT5vdXRfZmVuY2UpLCAtRUlPKTsK
KworCWlndF9zcGluX2ZyZWUoaTkxNSwgc3Bpbik7CisJZ2VtX3F1aWVzY2VudF9ncHUoaTkxNSk7
Cit9CisKK3N0YXRpYyB2b2lkIHNlbmRmZChpbnQgc29ja2V0LCBpbnQgZmQpCit7CisJc3RydWN0
IGlvdmVjIGlvID0geyAuaW92X2Jhc2UgPSAoY2hhciAqKSJBQkMiLCAuaW92X2xlbiA9IDMgfTsK
KwlzdHJ1Y3QgbXNnaGRyIG1zZyA9IHt9OworCWNoYXIgYnVmW0NNU0dfU1BBQ0Uoc2l6ZW9mKGZk
KSldOworCXN0cnVjdCBjbXNnaGRyICpjbXNnOworCisJbXNnLm1zZ19pb3YgPSAmaW87CisJbXNn
Lm1zZ19pb3ZsZW4gPSAxOworCW1zZy5tc2dfY29udHJvbCA9IGJ1ZjsKKwltc2cubXNnX2NvbnRy
b2xsZW4gPSBzaXplb2YoYnVmKTsKKworCWNtc2cgPSBDTVNHX0ZJUlNUSERSKCZtc2cpOworCWNt
c2ctPmNtc2dfbGV2ZWwgPSBTT0xfU09DS0VUOworCWNtc2ctPmNtc2dfdHlwZSA9IFNDTV9SSUdI
VFM7CisJY21zZy0+Y21zZ19sZW4gPSBDTVNHX0xFTihzaXplb2YoZmQpKTsKKworCSooaW50ICop
Q01TR19EQVRBKGNtc2cpID0gZmQ7CisJbXNnLm1zZ19jb250cm9sbGVuID0gY21zZy0+Y21zZ19s
ZW47CisKKwlpZ3RfYXNzZXJ0KHNlbmRtc2coc29ja2V0LCAmbXNnLCAwKSAhPSAtMSk7Cit9CisK
K3N0YXRpYyBpbnQgcmVjdmZkKGludCBzb2NrZXQpCit7CisJY2hhciBtX2J1ZmZlclsyNTZdLCBj
X2J1ZmZlclsyNTZdOworCXN0cnVjdCBpb3ZlYyBpbyA9IHsKKwkJLmlvdl9iYXNlID0gbV9idWZm
ZXIsCisJCS5pb3ZfbGVuID0gc2l6ZW9mKG1fYnVmZmVyKSwKKwl9OworCXN0cnVjdCBtc2doZHIg
bXNnID0geworCQkubXNnX2lvdiA9ICZpbywKKwkJLm1zZ19pb3ZsZW4gPSAxLAorCQkubXNnX2Nv
bnRyb2wgPSBjX2J1ZmZlciwKKwkJLm1zZ19jb250cm9sbGVuID0gc2l6ZW9mKGNfYnVmZmVyKSwK
Kwl9OworCisJaWd0X2Fzc2VydChyZWN2bXNnKHNvY2tldCwgJm1zZywgMCkgIT0gLTEpOworCXJl
dHVybiAqKGludCAqKUNNU0dfREFUQShDTVNHX0ZJUlNUSERSKCZtc2cpKTsKK30KKworc3RhdGlj
IHZvaWQgdGVzdF9ub25wZXJzaXN0ZW50X3Byb2Nlc3MoaW50IGk5MTUpCit7CisJaW50IGZlbmNl
LCBzdlsyXTsKKworCWlndF9yZXF1aXJlKHNvY2tldHBhaXIoQUZfVU5JWCwgU09DS19ER1JBTSwg
MCwgc3YpID09IDApOworCisJaWd0X2ZvcmsoY2hpbGQsIDEpIHsKKwkJaWd0X3NwaW5fdCAqc3Bp
bjsKKworCQlpOTE1ID0gZ2VtX3Jlb3Blbl9kcml2ZXIoaTkxNSk7CisJCWdlbV9jb250ZXh0X3Nl
dF9wZXJzaXN0ZW5jZShpOTE1LCAwLCBmYWxzZSk7CisJCXNwaW4gPSBpZ3Rfc3Bpbl9uZXcoaTkx
NSwgLmZsYWdzID0gSUdUX1NQSU5fRkVOQ0VfT1VUKTsKKworCQlzZW5kZmQoc3ZbMF0sIHNwaW4t
Pm91dF9mZW5jZSk7CisJfQorCWlndF93YWl0Y2hpbGRyZW4oKTsKKworCWZlbmNlID0gcmVjdmZk
KHN2WzFdKTsKKwljbG9zZShzdlswXSk7CisJY2xvc2Uoc3ZbMV0pOworCisJaWd0X2Fzc2VydF9l
cShzeW5jX2ZlbmNlX3dhaXQoZmVuY2UsIE1TRUNfUEVSX1NFQyAvIDUpLCAwKTsKKwlpZ3RfYXNz
ZXJ0X2VxKHN5bmNfZmVuY2Vfc3RhdHVzKGZlbmNlKSwgLUVJTyk7CisJY2xvc2UoZmVuY2UpOwor
CisJZ2VtX3F1aWVzY2VudF9ncHUoaTkxNSk7Cit9CisKK2lndF9tYWluCit7CisJaW50IGk5MTU7
CisKKwlpZ3RfZml4dHVyZSB7CisJCWk5MTUgPSBkcm1fb3Blbl9kcml2ZXIoRFJJVkVSX0lOVEVM
KTsKKwkJaWd0X3JlcXVpcmVfZ2VtKGk5MTUpOworCisJCWlndF9yZXF1aXJlKGhhc19wZXJzaXN0
ZW5jZShpOTE1KSk7CisJfQorCisJaWd0X3N1YnRlc3RfZ3JvdXAgeworCQlpZ3Rfc3VidGVzdCgi
aWRlbXBvdGVudCIpCisJCQl0ZXN0X2lkZW1wb3RlbnQoaTkxNSk7CisKKwkJaWd0X3N1YnRlc3Qo
InBlcnNpc3RlbmNlIikKKwkJCXRlc3RfcGVyc2lzdGVuY2UoaTkxNSk7CisKKwkJaWd0X3N1YnRl
c3QoImNsZWFudXAiKQorCQkJdGVzdF9ub25wZXJzaXN0ZW50X2NsZWFudXAoaTkxNSk7CisKKwkJ
aWd0X3N1YnRlc3QoImhvc3RpbGUiKQorCQkJdGVzdF9ub25wZXJzaXN0ZW50X2hvc3RpbGUoaTkx
NSk7CisKKwkJaWd0X3N1YnRlc3QoInByb2Nlc3MiKQorCQkJdGVzdF9ub25wZXJzaXN0ZW50X3By
b2Nlc3MoaTkxNSk7CisJfQorCisJaWd0X2ZpeHR1cmUgeworCQljbG9zZShpOTE1KTsKKwl9Cit9
CmRpZmYgLS1naXQgYS90ZXN0cy9tZXNvbi5idWlsZCBiL3Rlc3RzL21lc29uLmJ1aWxkCmluZGV4
IGZmM2JhNmQ3OC4uZTYwYWNkODM2IDEwMDY0NAotLS0gYS90ZXN0cy9tZXNvbi5idWlsZAorKysg
Yi90ZXN0cy9tZXNvbi5idWlsZApAQCAtMTE4LDYgKzExOCw3IEBAIGk5MTVfcHJvZ3MgPSBbCiAJ
J2dlbV9jdHhfZXhlYycsCiAJJ2dlbV9jdHhfaXNvbGF0aW9uJywKIAknZ2VtX2N0eF9wYXJhbScs
CisJJ2dlbV9jdHhfcGVyc2lzdGVuY2UnLAogCSdnZW1fY3R4X3NoYXJlZCcsCiAJJ2dlbV9jdHhf
c3dpdGNoJywKIAknZ2VtX2N0eF90aHJhc2gnLAotLSAKMi4yMy4wLnJjMQoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlz
dApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

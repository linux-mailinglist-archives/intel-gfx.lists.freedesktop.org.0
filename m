Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 203D51D615D
	for <lists+intel-gfx@lfdr.de>; Sat, 16 May 2020 15:31:17 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 87A706E21C;
	Sat, 16 May 2020 13:31:14 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A8D0E6E21C
 for <intel-gfx@lists.freedesktop.org>; Sat, 16 May 2020 13:31:12 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from build.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 21214593-1500050 
 for multiple; Sat, 16 May 2020 14:31:03 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sat, 16 May 2020 14:31:02 +0100
Message-Id: <20200516133102.32167-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20200516132444.24007-1-chris@chris-wilson.co.uk>
References: <20200516132444.24007-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/selftests: Measure CS_TIMESTAMP
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Chris Wilson <chris@chris-wilson.co.uk>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q291bnQgdGhlIG51bWJlciBvZiBDU19USU1FU1RBTVAgdGlja3MgYW5kIGNoZWNrIHRoYXQgaXQg
bWF0Y2hlcyBvdXIKZXhwZWN0YXRpb25zLgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxj
aHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmph
bGFAbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0
X2d0X3BtLmMgfCAxMTMgKysrKysrKysrKysrKysrKysrKysrKysKIDEgZmlsZSBjaGFuZ2VkLCAx
MTMgaW5zZXJ0aW9ucygrKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Nl
bGZ0ZXN0X2d0X3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9ndF9wbS5j
CmluZGV4IDI0MjE4MWE1MjE0Yy4uY2FjNGNmMmE1ZTFkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9ndF9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3NlbGZ0ZXN0X2d0X3BtLmMKQEAgLTUsMTAgKzUsMTIyIEBACiAgKiBDb3B5cmlnaHQgwqkg
MjAxOSBJbnRlbCBDb3Jwb3JhdGlvbgogICovCiAKKyNpbmNsdWRlIDxsaW51eC9zb3J0Lmg+CisK
KyNpbmNsdWRlICJpbnRlbF9ndF9jbG9ja191dGlscy5oIgorCiAjaW5jbHVkZSAic2VsZnRlc3Rf
bGxjLmgiCiAjaW5jbHVkZSAic2VsZnRlc3RfcmM2LmgiCiAjaW5jbHVkZSAic2VsZnRlc3RfcnBz
LmgiCiAKK3N0YXRpYyBpbnQgY21wX3U2NChjb25zdCB2b2lkICpBLCBjb25zdCB2b2lkICpCKQor
eworCWNvbnN0IHU2NCAqYSA9IEEsICpiID0gQjsKKworCWlmIChhIDwgYikKKwkJcmV0dXJuIC0x
OworCWVsc2UgaWYgKGEgPiBiKQorCQlyZXR1cm4gMTsKKwllbHNlCisJCXJldHVybiAwOworfQor
CitzdGF0aWMgaW50IGNtcF91MzIoY29uc3Qgdm9pZCAqQSwgY29uc3Qgdm9pZCAqQikKK3sKKwlj
b25zdCB1MzIgKmEgPSBBLCAqYiA9IEI7CisKKwlpZiAoYSA8IGIpCisJCXJldHVybiAtMTsKKwll
bHNlIGlmIChhID4gYikKKwkJcmV0dXJuIDE7CisJZWxzZQorCQlyZXR1cm4gMDsKK30KKworc3Rh
dGljIHZvaWQgbWVhc3VyZV9jbG9ja3Moc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAor
CQkJICAgdTMyICpvdXRfY3ljbGVzLCBrdGltZV90ICpvdXRfZHQpCit7CisJa3RpbWVfdCBkdFs1
XTsKKwl1MzIgY3ljbGVzWzVdOworCWludCBpOworCisJZm9yIChpID0gMDsgaSA8IDU7IGkrKykg
eworCQlwcmVlbXB0X2Rpc2FibGUoKTsKKwkJZHRbaV0gPSBrdGltZV9nZXQoKTsKKwkJY3ljbGVz
W2ldID0gLUVOR0lORV9SRUFEX0ZXKGVuZ2luZSwgUklOR19USU1FU1RBTVApOworCisJCXVkZWxh
eSgxMDAwKTsKKworCQlkdFtpXSA9IGt0aW1lX3N1YihrdGltZV9nZXQoKSwgZHRbaV0pOworCQlj
eWNsZXNbaV0gKz0gRU5HSU5FX1JFQURfRlcoZW5naW5lLCBSSU5HX1RJTUVTVEFNUCk7CisJCXBy
ZWVtcHRfZW5hYmxlKCk7CisJfQorCisJLyogVXNlIHRoZSBtZWRpYW4gb2YgYm90aCBjeWNsZS9k
dDsgY2xvc2UgZW5vdWdoICovCisJc29ydChjeWNsZXMsIDUsIHNpemVvZigqY3ljbGVzKSwgY21w
X3UzMiwgTlVMTCk7CisJKm91dF9jeWNsZXMgPSAoY3ljbGVzWzFdICsgMiAqIGN5Y2xlc1syXSAr
IGN5Y2xlc1szXSkgLyA0OworCisJc29ydChkdCwgNSwgc2l6ZW9mKCpkdCksIGNtcF91NjQsIE5V
TEwpOworCSpvdXRfZHQgPSBkaXZfdTY0KGR0WzFdICsgMiAqIGR0WzJdICsgZHRbM10sIDQpOwor
fQorCitzdGF0aWMgaW50IGxpdmVfZ3RfY2xvY2tzKHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50
ZWxfZ3QgKmd0ID0gYXJnOworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKKwllbnVt
IGludGVsX2VuZ2luZV9pZCBpZDsKKwlpbnQgZXJyID0gMDsKKworCWlmICghUlVOVElNRV9JTkZP
KGd0LT5pOTE1KS0+Y3NfdGltZXN0YW1wX2ZyZXF1ZW5jeV9oeikgeyAvKiB1bmtub3duICovCisJ
CXByX2luZm8oIkNTX1RJTUVTVEFNUCBmcmVxdWVuY3kgdW5rbm93blxuIik7CisJCXJldHVybiAw
OworCX0KKworCWlmIChJTlRFTF9HRU4oZ3QtPmk5MTUpIDwgNCkgLyogQW55IENTX1RJTUVTVEFN
UD8gKi8KKwkJcmV0dXJuIDA7CisKKwlpbnRlbF9ndF9wbV9nZXQoZ3QpOworCWludGVsX3VuY29y
ZV9mb3JjZXdha2VfZ2V0KGd0LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOworCisJZm9yX2VhY2hf
ZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7CisJCXUzMiBjeWNsZXM7CisJCXUzMiBleHBlY3RlZDsK
KwkJdTY0IHRpbWU7CisJCXU2NCBkdDsKKworCQlpZiAoSU5URUxfR0VOKGVuZ2luZS0+aTkxNSkg
PCA3ICYmIGVuZ2luZS0+aWQgIT0gUkNTMCkKKwkJCWNvbnRpbnVlOworCisJCW1lYXN1cmVfY2xv
Y2tzKGVuZ2luZSwgJmN5Y2xlcywgJmR0KTsKKworCQl0aW1lID0gaTkxNV9jc190aW1lc3RhbXBf
dGlja3NfdG9fbnMoZW5naW5lLT5pOTE1LCBjeWNsZXMpOworCQlleHBlY3RlZCA9IGk5MTVfY3Nf
dGltZXN0YW1wX25zX3RvX3RpY2tzKGVuZ2luZS0+aTkxNSwgZHQpOworCisJCXByX2luZm8oIiVz
OiBUSU1FU1RBTVAgJWQgY3ljbGVzIFslbGxkbnNdIGluICVsbGRucyBbJWQgY3ljbGVzXSwgdXNp
bmcgQ1MgY2xvY2sgZnJlcXVlbmN5IG9mICV1S0h6XG4iLAorCQkJZW5naW5lLT5uYW1lLCBjeWNs
ZXMsIHRpbWUsIGR0LCBleHBlY3RlZCwKKwkJCVJVTlRJTUVfSU5GTyhlbmdpbmUtPmk5MTUpLT5j
c190aW1lc3RhbXBfZnJlcXVlbmN5X2h6IC8gMTAwMCk7CisKKwkJaWYgKDkgKiB0aW1lIDwgOCAq
IGR0IHx8IDggKiB0aW1lID4gOSAqIGR0KSB7CisJCQlwcl9lcnIoIiVzOiBDUyB0aWNrcyBkaWQg
bm90IG1hdGNoIHdhbGx0aW1lIVxuIiwKKwkJCSAgICAgICBlbmdpbmUtPm5hbWUpOworCQkJZXJy
ID0gLUVJTlZBTDsKKwkJCWJyZWFrOworCQl9CisKKwkJaWYgKDkgKiBleHBlY3RlZCA8IDggKiBj
eWNsZXMgfHwgOCAqIGV4cGVjdGVkID4gOSAqIGN5Y2xlcykgeworCQkJcHJfZXJyKCIlczogd2Fs
bHRpbWUgZGlkIG5vdCBtYXRjaCBDUyB0aWNrcyFcbiIsCisJCQkgICAgICAgZW5naW5lLT5uYW1l
KTsKKwkJCWVyciA9IC1FSU5WQUw7CisJCQlicmVhazsKKwkJfQorCX0KKworCWludGVsX3VuY29y
ZV9mb3JjZXdha2VfcHV0KGd0LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOworCWludGVsX2d0X3Bt
X3B1dChndCk7CisKKwlyZXR1cm4gZXJyOworfQorCiBzdGF0aWMgaW50IGxpdmVfZ3RfcmVzdW1l
KHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwpAQCAtNTIsNiArMTY0
LDcgQEAgc3RhdGljIGludCBsaXZlX2d0X3Jlc3VtZSh2b2lkICphcmcpCiBpbnQgaW50ZWxfZ3Rf
cG1fbGl2ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3Rh
dGljIGNvbnN0IHN0cnVjdCBpOTE1X3N1YnRlc3QgdGVzdHNbXSA9IHsKKwkJU1VCVEVTVChsaXZl
X2d0X2Nsb2NrcyksCiAJCVNVQlRFU1QobGl2ZV9yYzZfbWFudWFsKSwKIAkJU1VCVEVTVChsaXZl
X3Jwc19jbG9ja19pbnRlcnZhbCksCiAJCVNVQlRFU1QobGl2ZV9ycHNfY29udHJvbCksCi0tIAoy
LjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCklu
dGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

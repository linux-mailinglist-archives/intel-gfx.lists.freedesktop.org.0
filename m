Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 293FE5BACA
	for <lists+intel-gfx@lfdr.de>; Mon,  1 Jul 2019 13:34:58 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 87D8689CBE;
	Mon,  1 Jul 2019 11:34:56 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga11.intel.com (mga11.intel.com [192.55.52.93])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AE84E89CAF
 for <intel-gfx@lists.freedesktop.org>; Mon,  1 Jul 2019 11:34:54 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga004.fm.intel.com ([10.253.24.48])
 by fmsmga102.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 01 Jul 2019 04:34:54 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,439,1557212400"; d="scan'208";a="186455083"
Received: from unknown (HELO delly.ger.corp.intel.com) ([10.249.141.63])
 by fmsmga004.fm.intel.com with ESMTP; 01 Jul 2019 04:34:53 -0700
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  1 Jul 2019 14:34:33 +0300
Message-Id: <20190701113437.4043-8-lionel.g.landwerlin@intel.com>
X-Mailer: git-send-email 2.21.0.392.gf8f6787159e
In-Reply-To: <20190701113437.4043-1-lionel.g.landwerlin@intel.com>
References: <20190701113437.4043-1-lionel.g.landwerlin@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v6 07/11] drm/i915: add syncobj timeline support
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SW50cm9kdWNlcyBhIG5ldyBwYXJhbWV0ZXJzIHRvIGV4ZWNidWYgc28gdGhhdCB3ZSBjYW4gc3Bl
Y2lmeSBzeW5jb2JqCmhhbmRsZXMgYXMgd2VsbCBhcyB0aW1lbGluZSBwb2ludHMuCgp2MjogUmV1
c2UgaTkxNV91c2VyX2V4dGVuc2lvbl9mbgoKdjM6IENoZWNrIHRoYXQgdGhlIGNoYWluZWQgZXh0
ZW5zaW9uIGlzIG9ubHkgcHJlc2VudCBvbmNlIChDaHJpcykKCnY0OiBDaGVjayB0aGF0IGRtYV9m
ZW5jZV9jaGFpbl9maW5kX3NlcW5vIHJldHVybnMgYSBub24gTlVMTCBmZW5jZSAoTGlvbmVsKQoK
U2lnbmVkLW9mZi1ieTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50
ZWwuY29tPgotLS0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyAg
ICB8IDI4OCArKysrKysrKysrKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2
LmMgICAgICAgICAgICAgICB8ICAgNCArLQogaW5jbHVkZS91YXBpL2RybS9pOTE1X2RybS5oICAg
ICAgICAgICAgICAgICAgIHwgIDM4ICsrKwogMyBmaWxlcyBjaGFuZ2VkLCAyNzMgaW5zZXJ0aW9u
cygrKSwgNTcgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9leGVjYnVmZmVyLmMKaW5kZXggOTg4N2ZhOWUzYWM4Li5kMzAwNGZjMWY5OTUgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYwpAQCAtMjEz
LDYgKzIxMywxMyBAQCBlbnVtIHsKICAqIHRoZSBiYXRjaGJ1ZmZlciBpbiB0cnVzdGVkIG1vZGUs
IG90aGVyd2lzZSB0aGUgaW9jdGwgaXMgcmVqZWN0ZWQuCiAgKi8KIAorc3RydWN0IGk5MTVfZWJf
ZmVuY2VzIHsKKwlzdHJ1Y3QgZHJtX3N5bmNvYmogKnN5bmNvYmo7IC8qIFVzZSB3aXRoIHB0cl9t
YXNrX2JpdHMoKSAqLworCXN0cnVjdCBkbWFfZmVuY2UgKmRtYV9mZW5jZTsKKwl1NjQgdmFsdWU7
CisJc3RydWN0IGRtYV9mZW5jZV9jaGFpbiAqY2hhaW5fZmVuY2U7Cit9OworCiBzdHJ1Y3QgaTkx
NV9leGVjYnVmZmVyIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNTsgLyoqIGk5MTUg
YmFja3BvaW50ZXIgKi8KIAlzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGU7IC8qKiBwZXItZmlsZSBsb29r
dXAgdGFibGVzIGFuZCBsaW1pdHMgKi8KQEAgLTI3NSw2ICsyODIsNyBAQCBzdHJ1Y3QgaTkxNV9l
eGVjYnVmZmVyIHsKIAogCXN0cnVjdCB7CiAJCXU2NCBmbGFnczsgLyoqIEF2YWlsYWJsZSBleHRl
bnNpb25zIHBhcmFtZXRlcnMgKi8KKwkJc3RydWN0IGRybV9pOTE1X2dlbV9leGVjYnVmZmVyX2V4
dF90aW1lbGluZV9mZW5jZXMgdGltZWxpbmVfZmVuY2VzOwogCX0gZXh0ZW5zaW9uczsKIH07CiAK
QEAgLTIyMjQsNjcgKzIyMzIsMTk4IEBAIGViX3NlbGVjdF9lbmdpbmUoc3RydWN0IGk5MTVfZXhl
Y2J1ZmZlciAqZWIsCiB9CiAKIHN0YXRpYyB2b2lkCi1fX2ZyZWVfZmVuY2VfYXJyYXkoc3RydWN0
IGRybV9zeW5jb2JqICoqZmVuY2VzLCB1bnNpZ25lZCBpbnQgbikKK19fZnJlZV9mZW5jZV9hcnJh
eShzdHJ1Y3QgaTkxNV9lYl9mZW5jZXMgKmZlbmNlcywgdW5zaWduZWQgaW50IG4pCiB7Ci0Jd2hp
bGUgKG4tLSkKLQkJZHJtX3N5bmNvYmpfcHV0KHB0cl9tYXNrX2JpdHMoZmVuY2VzW25dLCAyKSk7
CisJd2hpbGUgKG4tLSkgeworCQlkcm1fc3luY29ial9wdXQocHRyX21hc2tfYml0cyhmZW5jZXNb
bl0uc3luY29iaiwgMikpOworCQlkbWFfZmVuY2VfcHV0KGZlbmNlc1tuXS5kbWFfZmVuY2UpOwor
CQlrZnJlZShmZW5jZXNbbl0uY2hhaW5fZmVuY2UpOworCX0KIAlrdmZyZWUoZmVuY2VzKTsKIH0K
IAotc3RhdGljIHN0cnVjdCBkcm1fc3luY29iaiAqKgotZ2V0X2ZlbmNlX2FycmF5KHN0cnVjdCBk
cm1faTkxNV9nZW1fZXhlY2J1ZmZlcjIgKmFyZ3MsCi0JCXN0cnVjdCBkcm1fZmlsZSAqZmlsZSkK
K3N0YXRpYyBzdHJ1Y3QgaTkxNV9lYl9mZW5jZXMgKgorZ2V0X3RpbWVsaW5lX2ZlbmNlX2FycmF5
KHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViLCBpbnQgKm91dF9uX2ZlbmNlcykKK3sKKwlzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXJfZXh0X3RpbWVsaW5lX2ZlbmNlcyAqdGltZWxpbmVf
ZmVuY2VzID0KKwkJJmViLT5leHRlbnNpb25zLnRpbWVsaW5lX2ZlbmNlczsKKwlzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX2V4ZWNfZmVuY2UgX191c2VyICp1c2VyX2ZlbmNlczsKKwlzdHJ1Y3QgaTkxNV9l
Yl9mZW5jZXMgKmZlbmNlczsKKwl1NjQgX191c2VyICp1c2VyX3ZhbHVlczsKKwljb25zdCB1NjQg
bnVtX2ZlbmNlcyA9IHRpbWVsaW5lX2ZlbmNlcy0+ZmVuY2VfY291bnQ7CisJdW5zaWduZWQgbG9u
ZyBuOworCWludCBlcnI7CisKKwkqb3V0X25fZmVuY2VzID0gbnVtX2ZlbmNlczsKKworCS8qIENo
ZWNrIG11bHRpcGxpY2F0aW9uIG92ZXJmbG93IGZvciBhY2Nlc3Nfb2soKSBhbmQga3ZtYWxsb2Nf
YXJyYXkoKSAqLworCUJVSUxEX0JVR19PTihzaXplb2Yoc2l6ZV90KSA+IHNpemVvZih1bnNpZ25l
ZCBsb25nKSk7CisJaWYgKG51bV9mZW5jZXMgPiBtaW5fdCh1bnNpZ25lZCBsb25nLAorCQkJICAg
ICAgIFVMT05HX01BWCAvIHNpemVvZigqdXNlcl9mZW5jZXMpLAorCQkJICAgICAgIFNJWkVfTUFY
IC8gc2l6ZW9mKCpmZW5jZXMpKSkKKwkJcmV0dXJuIEVSUl9QVFIoLUVJTlZBTCk7CisKKwl1c2Vy
X2ZlbmNlcyA9IHU2NF90b191c2VyX3B0cih0aW1lbGluZV9mZW5jZXMtPmhhbmRsZXNfcHRyKTsK
KwlpZiAoIWFjY2Vzc19vayh1c2VyX2ZlbmNlcywgbnVtX2ZlbmNlcyAqIHNpemVvZigqdXNlcl9m
ZW5jZXMpKSkKKwkJcmV0dXJuIEVSUl9QVFIoLUVGQVVMVCk7CisKKwl1c2VyX3ZhbHVlcyA9IHU2
NF90b191c2VyX3B0cih0aW1lbGluZV9mZW5jZXMtPnZhbHVlc19wdHIpOworCWlmICghYWNjZXNz
X29rKHVzZXJfdmFsdWVzLCBudW1fZmVuY2VzICogc2l6ZW9mKCp1c2VyX3ZhbHVlcykpKQorCQly
ZXR1cm4gRVJSX1BUUigtRUZBVUxUKTsKKworCWZlbmNlcyA9IGt2bWFsbG9jX2FycmF5KG51bV9m
ZW5jZXMsIHNpemVvZigqZmVuY2VzKSwKKwkJCQlfX0dGUF9OT1dBUk4gfCBHRlBfS0VSTkVMKTsK
KwlpZiAoIWZlbmNlcykKKwkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisKKwlCVUlMRF9CVUdf
T04ofihBUkNIX0tNQUxMT0NfTUlOQUxJR04gLSAxKSAmCisJCSAgICAgfl9fSTkxNV9FWEVDX0ZF
TkNFX1VOS05PV05fRkxBR1MpOworCisJZm9yIChuID0gMDsgbiA8IG51bV9mZW5jZXM7IG4rKykg
eworCQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNfZmVuY2UgdXNlcl9mZW5jZTsKKwkJc3RydWN0
IGRybV9zeW5jb2JqICpzeW5jb2JqOworCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSA9IE5VTEw7
CisJCXU2NCBwb2ludDsKKworCQlpZiAoX19jb3B5X2Zyb21fdXNlcigmdXNlcl9mZW5jZSwgdXNl
cl9mZW5jZXMrKywgc2l6ZW9mKHVzZXJfZmVuY2UpKSkgeworCQkJZXJyID0gLUVGQVVMVDsKKwkJ
CWdvdG8gZXJyOworCQl9CisKKwkJaWYgKHVzZXJfZmVuY2UuZmxhZ3MgJiBfX0k5MTVfRVhFQ19G
RU5DRV9VTktOT1dOX0ZMQUdTKSB7CisJCQllcnIgPSAtRUlOVkFMOworCQkJZ290byBlcnI7CisJ
CX0KKworCQlpZiAoX19nZXRfdXNlcihwb2ludCwgdXNlcl92YWx1ZXMrKykpIHsKKwkJCWVyciA9
IC1FRkFVTFQ7CisJCQlnb3RvIGVycjsKKwkJfQorCisJCXN5bmNvYmogPSBkcm1fc3luY29ial9m
aW5kKGViLT5maWxlLCB1c2VyX2ZlbmNlLmhhbmRsZSk7CisJCWlmICghc3luY29iaikgeworCQkJ
RFJNX0RFQlVHKCJJbnZhbGlkIHN5bmNvYmogaGFuZGxlIHByb3ZpZGVkXG4iKTsKKwkJCWVyciA9
IC1FSU5WQUw7CisJCQlnb3RvIGVycjsKKwkJfQorCisJCWlmICh1c2VyX2ZlbmNlLmZsYWdzICYg
STkxNV9FWEVDX0ZFTkNFX1dBSVQpIHsKKwkJCWZlbmNlID0gZHJtX3N5bmNvYmpfZmVuY2VfZ2V0
KHN5bmNvYmopOworCQkJaWYgKCFmZW5jZSkgeworCQkJCURSTV9ERUJVRygiU3luY29iaiBoYW5k
bGUgaGFzIG5vIGZlbmNlXG4iKTsKKwkJCQlkcm1fc3luY29ial9wdXQoc3luY29iaik7CisJCQkJ
ZXJyID0gLUVJTlZBTDsKKwkJCQlnb3RvIGVycjsKKwkJCX0KKworCQkJZXJyID0gZG1hX2ZlbmNl
X2NoYWluX2ZpbmRfc2Vxbm8oJmZlbmNlLCBwb2ludCk7CisJCQlpZiAoZXJyIHx8ICFmZW5jZSkg
eworCQkJCURSTV9ERUJVRygiU3luY29iaiBoYW5kbGUgbWlzc2luZyByZXF1ZXN0ZWQgcG9pbnRc
biIpOworCQkJCWRybV9zeW5jb2JqX3B1dChzeW5jb2JqKTsKKwkJCQllcnIgPSBlcnIgIT0gMCA/
IGVyciA6IC1FSU5WQUw7CisJCQkJZ290byBlcnI7CisJCQl9CisJCX0KKworCQkvKgorCQkgKiBG
b3IgdGltZWxpbmUgc3luY29ianMgd2UgbmVlZCB0byBwcmVhbGxvY2F0ZSBjaGFpbnMgZm9yCisJ
CSAqIGxhdGVyIHNpZ25hbGluZy4KKwkJICovCisJCWlmIChwb2ludCAhPSAwICYmIHVzZXJfZmVu
Y2UuZmxhZ3MgJiBJOTE1X0VYRUNfRkVOQ0VfU0lHTkFMKSB7CisJCQlmZW5jZXNbbl0uY2hhaW5f
ZmVuY2UgPQorCQkJCWttYWxsb2Moc2l6ZW9mKCpmZW5jZXNbbl0uY2hhaW5fZmVuY2UpLAorCQkJ
CQlHRlBfS0VSTkVMKTsKKwkJCWlmICghZmVuY2VzW25dLmNoYWluX2ZlbmNlKSB7CisJCQkJZG1h
X2ZlbmNlX3B1dChmZW5jZSk7CisJCQkJZHJtX3N5bmNvYmpfcHV0KHN5bmNvYmopOworCQkJCWVy
ciA9IC1FTk9NRU07CisJCQkJRFJNX0RFQlVHKCJVbmFibGUgdG8gYWxsb2MgY2hhaW5fZmVuY2Vc
biIpOworCQkJCWdvdG8gZXJyOworCQkJfQorCQl9IGVsc2UgeworCQkJZmVuY2VzW25dLmNoYWlu
X2ZlbmNlID0gTlVMTDsKKwkJfQorCisJCWZlbmNlc1tuXS5zeW5jb2JqID0gcHRyX3BhY2tfYml0
cyhzeW5jb2JqLCB1c2VyX2ZlbmNlLmZsYWdzLCAyKTsKKwkJZmVuY2VzW25dLmRtYV9mZW5jZSA9
IGZlbmNlOworCQlmZW5jZXNbbl0udmFsdWUgPSBwb2ludDsKKwl9CisKKwlyZXR1cm4gZmVuY2Vz
OworCitlcnI6CisJX19mcmVlX2ZlbmNlX2FycmF5KGZlbmNlcywgbik7CisJcmV0dXJuIEVSUl9Q
VFIoZXJyKTsKK30KKworc3RhdGljIHN0cnVjdCBpOTE1X2ViX2ZlbmNlcyAqCitnZXRfbGVnYWN5
X2ZlbmNlX2FycmF5KHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViLAorCQkgICAgICAgaW50ICpv
dXRfbl9mZW5jZXMpCiB7Ci0JY29uc3QgdW5zaWduZWQgbG9uZyBuZmVuY2VzID0gYXJncy0+bnVt
X2NsaXByZWN0czsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyICphcmdzID0gZWIt
PmFyZ3M7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9leGVjX2ZlbmNlIF9fdXNlciAqdXNlcjsKLQlz
dHJ1Y3QgZHJtX3N5bmNvYmogKipmZW5jZXM7CisJc3RydWN0IGk5MTVfZWJfZmVuY2VzICpmZW5j
ZXM7CisJY29uc3QgdTMyIG51bV9mZW5jZXMgPSBhcmdzLT5udW1fY2xpcHJlY3RzOwogCXVuc2ln
bmVkIGxvbmcgbjsKIAlpbnQgZXJyOwogCi0JaWYgKCEoYXJncy0+ZmxhZ3MgJiBJOTE1X0VYRUNf
RkVOQ0VfQVJSQVkpKQotCQlyZXR1cm4gTlVMTDsKKwkqb3V0X25fZmVuY2VzID0gbnVtX2ZlbmNl
czsKIAogCS8qIENoZWNrIG11bHRpcGxpY2F0aW9uIG92ZXJmbG93IGZvciBhY2Nlc3Nfb2soKSBh
bmQga3ZtYWxsb2NfYXJyYXkoKSAqLwogCUJVSUxEX0JVR19PTihzaXplb2Yoc2l6ZV90KSA+IHNp
emVvZih1bnNpZ25lZCBsb25nKSk7Ci0JaWYgKG5mZW5jZXMgPiBtaW5fdCh1bnNpZ25lZCBsb25n
LAotCQkJICAgIFVMT05HX01BWCAvIHNpemVvZigqdXNlciksCi0JCQkgICAgU0laRV9NQVggLyBz
aXplb2YoKmZlbmNlcykpKQorCWlmICgqb3V0X25fZmVuY2VzID4gbWluX3QodW5zaWduZWQgbG9u
ZywKKwkJCQkgIFVMT05HX01BWCAvIHNpemVvZigqdXNlciksCisJCQkJICBTSVpFX01BWCAvIHNp
emVvZigqZmVuY2VzKSkpCiAJCXJldHVybiBFUlJfUFRSKC1FSU5WQUwpOwogCiAJdXNlciA9IHU2
NF90b191c2VyX3B0cihhcmdzLT5jbGlwcmVjdHNfcHRyKTsKLQlpZiAoIWFjY2Vzc19vayh1c2Vy
LCBuZmVuY2VzICogc2l6ZW9mKCp1c2VyKSkpCisJaWYgKCFhY2Nlc3Nfb2sodXNlciwgKm91dF9u
X2ZlbmNlcyAqIHNpemVvZigqdXNlcikpKQogCQlyZXR1cm4gRVJSX1BUUigtRUZBVUxUKTsKIAot
CWZlbmNlcyA9IGt2bWFsbG9jX2FycmF5KG5mZW5jZXMsIHNpemVvZigqZmVuY2VzKSwKKwlmZW5j
ZXMgPSBrdm1hbGxvY19hcnJheSgqb3V0X25fZmVuY2VzLCBzaXplb2YoKmZlbmNlcyksCiAJCQkJ
X19HRlBfTk9XQVJOIHwgR0ZQX0tFUk5FTCk7CiAJaWYgKCFmZW5jZXMpCiAJCXJldHVybiBFUlJf
UFRSKC1FTk9NRU0pOwogCi0JZm9yIChuID0gMDsgbiA8IG5mZW5jZXM7IG4rKykgewotCQlzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNfZmVuY2UgZmVuY2U7CisJZm9yIChuID0gMDsgbiA8ICpvdXRf
bl9mZW5jZXM7IG4rKykgeworCQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNfZmVuY2UgdXNlcl9m
ZW5jZTsKIAkJc3RydWN0IGRybV9zeW5jb2JqICpzeW5jb2JqOworCQlzdHJ1Y3QgZG1hX2ZlbmNl
ICpmZW5jZSA9IE5VTEw7CiAKLQkJaWYgKF9fY29weV9mcm9tX3VzZXIoJmZlbmNlLCB1c2VyKyss
IHNpemVvZihmZW5jZSkpKSB7CisJCWlmIChfX2NvcHlfZnJvbV91c2VyKCZ1c2VyX2ZlbmNlLCB1
c2VyKyssIHNpemVvZih1c2VyX2ZlbmNlKSkpIHsKIAkJCWVyciA9IC1FRkFVTFQ7CiAJCQlnb3Rv
IGVycjsKIAkJfQogCi0JCWlmIChmZW5jZS5mbGFncyAmIF9fSTkxNV9FWEVDX0ZFTkNFX1VOS05P
V05fRkxBR1MpIHsKKwkJaWYgKHVzZXJfZmVuY2UuZmxhZ3MgJiBfX0k5MTVfRVhFQ19GRU5DRV9V
TktOT1dOX0ZMQUdTKSB7CiAJCQllcnIgPSAtRUlOVkFMOwogCQkJZ290byBlcnI7CiAJCX0KIAot
CQlzeW5jb2JqID0gZHJtX3N5bmNvYmpfZmluZChmaWxlLCBmZW5jZS5oYW5kbGUpOworCQlzeW5j
b2JqID0gZHJtX3N5bmNvYmpfZmluZChlYi0+ZmlsZSwgdXNlcl9mZW5jZS5oYW5kbGUpOwogCQlp
ZiAoIXN5bmNvYmopIHsKIAkJCURSTV9ERUJVRygiSW52YWxpZCBzeW5jb2JqIGhhbmRsZSBwcm92
aWRlZFxuIik7CiAJCQllcnIgPSAtRU5PRU5UOwogCQkJZ290byBlcnI7CiAJCX0KIAorCQlpZiAo
dXNlcl9mZW5jZS5mbGFncyAmIEk5MTVfRVhFQ19GRU5DRV9XQUlUKSB7CisJCQlmZW5jZSA9IGRy
bV9zeW5jb2JqX2ZlbmNlX2dldChzeW5jb2JqKTsKKwkJCWlmICghZmVuY2UpIHsKKwkJCQlEUk1f
REVCVUcoIlN5bmNvYmogaGFuZGxlIGhhcyBubyBmZW5jZVxuIik7CisJCQkJZHJtX3N5bmNvYmpf
cHV0KHN5bmNvYmopOworCQkJCWVyciA9IC1FSU5WQUw7CisJCQkJZ290byBlcnI7CisJCQl9CisJ
CX0KKwogCQlCVUlMRF9CVUdfT04ofihBUkNIX0tNQUxMT0NfTUlOQUxJR04gLSAxKSAmCiAJCQkg
ICAgIH5fX0k5MTVfRVhFQ19GRU5DRV9VTktOT1dOX0ZMQUdTKTsKIAotCQlmZW5jZXNbbl0gPSBw
dHJfcGFja19iaXRzKHN5bmNvYmosIGZlbmNlLmZsYWdzLCAyKTsKKwkJZmVuY2VzW25dLnN5bmNv
YmogPSBwdHJfcGFja19iaXRzKHN5bmNvYmosIHVzZXJfZmVuY2UuZmxhZ3MsIDIpOworCQlmZW5j
ZXNbbl0uZG1hX2ZlbmNlID0gZmVuY2U7CisJCWZlbmNlc1tuXS52YWx1ZSA9IDA7CisJCWZlbmNl
c1tuXS5jaGFpbl9mZW5jZSA9IE5VTEw7CiAJfQogCiAJcmV0dXJuIGZlbmNlczsKQEAgLTIyOTQs
MzcgKzI0MzMsNDQgQEAgZ2V0X2ZlbmNlX2FycmF5KHN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY2J1
ZmZlcjIgKmFyZ3MsCiAJcmV0dXJuIEVSUl9QVFIoZXJyKTsKIH0KIAorc3RhdGljIHN0cnVjdCBp
OTE1X2ViX2ZlbmNlcyAqCitnZXRfZmVuY2VfYXJyYXkoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAq
ZWIsIGludCAqb3V0X25fZmVuY2VzKQoreworCWlmIChlYi0+YXJncy0+ZmxhZ3MgJiBJOTE1X0VY
RUNfRkVOQ0VfQVJSQVkpCisJCXJldHVybiBnZXRfbGVnYWN5X2ZlbmNlX2FycmF5KGViLCBvdXRf
bl9mZW5jZXMpOworCisJaWYgKGViLT5leHRlbnNpb25zLmZsYWdzICYgQklUKERSTV9JOTE1X0dF
TV9FWEVDQlVGRkVSX0VYVF9USU1FTElORV9GRU5DRVMpKQorCQlyZXR1cm4gZ2V0X3RpbWVsaW5l
X2ZlbmNlX2FycmF5KGViLCBvdXRfbl9mZW5jZXMpOworCisJKm91dF9uX2ZlbmNlcyA9IDA7CisJ
cmV0dXJuIE5VTEw7Cit9CisKIHN0YXRpYyB2b2lkCi1wdXRfZmVuY2VfYXJyYXkoc3RydWN0IGRy
bV9pOTE1X2dlbV9leGVjYnVmZmVyMiAqYXJncywKLQkJc3RydWN0IGRybV9zeW5jb2JqICoqZmVu
Y2VzKQorcHV0X2ZlbmNlX2FycmF5KHN0cnVjdCBpOTE1X2ViX2ZlbmNlcyAqZmVuY2VzLCBpbnQg
bmZlbmNlcykKIHsKIAlpZiAoZmVuY2VzKQotCQlfX2ZyZWVfZmVuY2VfYXJyYXkoZmVuY2VzLCBh
cmdzLT5udW1fY2xpcHJlY3RzKTsKKwkJX19mcmVlX2ZlbmNlX2FycmF5KGZlbmNlcywgbmZlbmNl
cyk7CiB9CiAKIHN0YXRpYyBpbnQKIGF3YWl0X2ZlbmNlX2FycmF5KHN0cnVjdCBpOTE1X2V4ZWNi
dWZmZXIgKmViLAotCQkgIHN0cnVjdCBkcm1fc3luY29iaiAqKmZlbmNlcykKKwkJICBzdHJ1Y3Qg
aTkxNV9lYl9mZW5jZXMgKmZlbmNlcywKKwkJICBpbnQgbmZlbmNlcykKIHsKLQljb25zdCB1bnNp
Z25lZCBpbnQgbmZlbmNlcyA9IGViLT5hcmdzLT5udW1fY2xpcHJlY3RzOwogCXVuc2lnbmVkIGlu
dCBuOwogCWludCBlcnI7CiAKIAlmb3IgKG4gPSAwOyBuIDwgbmZlbmNlczsgbisrKSB7CiAJCXN0
cnVjdCBkcm1fc3luY29iaiAqc3luY29iajsKLQkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CiAJ
CXVuc2lnbmVkIGludCBmbGFnczsKIAotCQlzeW5jb2JqID0gcHRyX3VucGFja19iaXRzKGZlbmNl
c1tuXSwgJmZsYWdzLCAyKTsKKwkJc3luY29iaiA9IHB0cl91bnBhY2tfYml0cyhmZW5jZXNbbl0u
c3luY29iaiwgJmZsYWdzLCAyKTsKIAkJaWYgKCEoZmxhZ3MgJiBJOTE1X0VYRUNfRkVOQ0VfV0FJ
VCkpCiAJCQljb250aW51ZTsKIAotCQlmZW5jZSA9IGRybV9zeW5jb2JqX2ZlbmNlX2dldChzeW5j
b2JqKTsKLQkJaWYgKCFmZW5jZSkKLQkJCXJldHVybiAtRUlOVkFMOwotCi0JCWVyciA9IGk5MTVf
cmVxdWVzdF9hd2FpdF9kbWFfZmVuY2UoZWItPnJlcXVlc3QsIGZlbmNlKTsKLQkJZG1hX2ZlbmNl
X3B1dChmZW5jZSk7CisJCWVyciA9IGk5MTVfcmVxdWVzdF9hd2FpdF9kbWFfZmVuY2UoZWItPnJl
cXVlc3QsCisJCQkJCQkgICBmZW5jZXNbbl0uZG1hX2ZlbmNlKTsKIAkJaWYgKGVyciA8IDApCiAJ
CQlyZXR1cm4gZXJyOwogCX0KQEAgLTIzMzQsOSArMjQ4MCw5IEBAIGF3YWl0X2ZlbmNlX2FycmF5
KHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViLAogCiBzdGF0aWMgdm9pZAogc2lnbmFsX2ZlbmNl
X2FycmF5KHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViLAotCQkgICBzdHJ1Y3QgZHJtX3N5bmNv
YmogKipmZW5jZXMpCisJCSAgIHN0cnVjdCBpOTE1X2ViX2ZlbmNlcyAqZmVuY2VzLAorCQkgICBp
bnQgbmZlbmNlcykKIHsKLQljb25zdCB1bnNpZ25lZCBpbnQgbmZlbmNlcyA9IGViLT5hcmdzLT5u
dW1fY2xpcHJlY3RzOwogCXN0cnVjdCBkbWFfZmVuY2UgKiBjb25zdCBmZW5jZSA9ICZlYi0+cmVx
dWVzdC0+ZmVuY2U7CiAJdW5zaWduZWQgaW50IG47CiAKQEAgLTIzNDQsMTUgKzI0OTAsNDYgQEAg
c2lnbmFsX2ZlbmNlX2FycmF5KHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViLAogCQlzdHJ1Y3Qg
ZHJtX3N5bmNvYmogKnN5bmNvYmo7CiAJCXVuc2lnbmVkIGludCBmbGFnczsKIAotCQlzeW5jb2Jq
ID0gcHRyX3VucGFja19iaXRzKGZlbmNlc1tuXSwgJmZsYWdzLCAyKTsKKwkJc3luY29iaiA9IHB0
cl91bnBhY2tfYml0cyhmZW5jZXNbbl0uc3luY29iaiwgJmZsYWdzLCAyKTsKIAkJaWYgKCEoZmxh
Z3MgJiBJOTE1X0VYRUNfRkVOQ0VfU0lHTkFMKSkKIAkJCWNvbnRpbnVlOwogCi0JCWRybV9zeW5j
b2JqX3JlcGxhY2VfZmVuY2Uoc3luY29iaiwgZmVuY2UpOworCQlpZiAoZmVuY2VzW25dLmNoYWlu
X2ZlbmNlKSB7CisJCQlkcm1fc3luY29ial9hZGRfcG9pbnQoc3luY29iaiwgZmVuY2VzW25dLmNo
YWluX2ZlbmNlLAorCQkJCQkgICAgICBmZW5jZSwgZmVuY2VzW25dLnZhbHVlKTsKKwkJCS8qCisJ
CQkgKiBUaGUgY2hhaW4ncyBvd25lcnNoaXAgaXMgdHJhbnNmZXJlZCB0byB0aGUKKwkJCSAqIHRp
bWVsaW5lLgorCQkJICovCisJCQlmZW5jZXNbbl0uY2hhaW5fZmVuY2UgPSBOVUxMOworCQl9IGVs
c2UgeworCQkJZHJtX3N5bmNvYmpfcmVwbGFjZV9mZW5jZShzeW5jb2JqLCBmZW5jZSk7CisJCX0K
IAl9CiB9CiAKK3N0YXRpYyBpbnQgcGFyc2VfdGltZWxpbmVfZmVuY2VzKHN0cnVjdCBpOTE1X3Vz
ZXJfZXh0ZW5zaW9uIF9fdXNlciAqZXh0LCB2b2lkICpkYXRhKQoreworCXN0cnVjdCBpOTE1X2V4
ZWNidWZmZXIgKmViID0gZGF0YTsKKworCS8qIFRpbWVsaW5lIGZlbmNlcyBhcmUgaW5jb21wYXRp
YmxlIHdpdGggdGhlIGZlbmNlIGFycmF5IGZsYWcuICovCisJaWYgKGViLT5hcmdzLT5mbGFncyAm
IEk5MTVfRVhFQ19GRU5DRV9BUlJBWSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlpZiAoZWItPmV4
dGVuc2lvbnMuZmxhZ3MgJiBCSVQoRFJNX0k5MTVfR0VNX0VYRUNCVUZGRVJfRVhUX1RJTUVMSU5F
X0ZFTkNFUykpCisJCXJldHVybiAtRUlOVkFMOworCisJaWYgKGNvcHlfZnJvbV91c2VyKCZlYi0+
ZXh0ZW5zaW9ucy50aW1lbGluZV9mZW5jZXMsIGV4dCwKKwkJCSAgIHNpemVvZihlYi0+ZXh0ZW5z
aW9ucy50aW1lbGluZV9mZW5jZXMpKSkKKwkJcmV0dXJuIC1FRkFVTFQ7CisKKwllYi0+ZXh0ZW5z
aW9ucy5mbGFncyB8PSBCSVQoRFJNX0k5MTVfR0VNX0VYRUNCVUZGRVJfRVhUX1RJTUVMSU5FX0ZF
TkNFUyk7CisKKwlyZXR1cm4gMDsKK30KKwogc3RhdGljIGNvbnN0IGk5MTVfdXNlcl9leHRlbnNp
b25fZm4gZXhlY2J1Zl9leHRlbnNpb25zW10gPSB7CisgICAgICAgIFtEUk1fSTkxNV9HRU1fRVhF
Q0JVRkZFUl9FWFRfVElNRUxJTkVfRkVOQ0VTXSA9IHBhcnNlX3RpbWVsaW5lX2ZlbmNlcywKIH07
CiAKIHN0YXRpYyBpbnQKQEAgLTIzNzcsMTQgKzI1NTQsMTUgQEAgc3RhdGljIGludAogaTkxNV9n
ZW1fZG9fZXhlY2J1ZmZlcihzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQkgICAgICAgc3RydWN0
IGRybV9maWxlICpmaWxlLAogCQkgICAgICAgc3RydWN0IGRybV9pOTE1X2dlbV9leGVjYnVmZmVy
MiAqYXJncywKLQkJICAgICAgIHN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY19vYmplY3QyICpleGVj
LAotCQkgICAgICAgc3RydWN0IGRybV9zeW5jb2JqICoqZmVuY2VzKQorCQkgICAgICAgc3RydWN0
IGRybV9pOTE1X2dlbV9leGVjX29iamVjdDIgKmV4ZWMpCiB7CiAJc3RydWN0IGk5MTVfZXhlY2J1
ZmZlciBlYjsKIAlzdHJ1Y3QgZG1hX2ZlbmNlICppbl9mZW5jZSA9IE5VTEw7CiAJc3RydWN0IGRt
YV9mZW5jZSAqZXhlY19mZW5jZSA9IE5VTEw7CiAJc3RydWN0IHN5bmNfZmlsZSAqb3V0X2ZlbmNl
ID0gTlVMTDsKKwlzdHJ1Y3QgaTkxNV9lYl9mZW5jZXMgKmZlbmNlcyA9IE5VTEw7CiAJaW50IG91
dF9mZW5jZV9mZCA9IC0xOworCWludCBuZmVuY2VzID0gMDsKIAlpbnQgZXJyOwogCiAJQlVJTERf
QlVHX09OKF9fRVhFQ19JTlRFUk5BTF9GTEFHUyAmIH5fX0k5MTVfRVhFQ19JTExFR0FMX0ZMQUdT
KTsKQEAgLTI0MjMsMTAgKzI2MDEsMTYgQEAgaTkxNV9nZW1fZG9fZXhlY2J1ZmZlcihzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2LAogCWlmIChlcnIpCiAJCXJldHVybiBlcnI7CiAKKwlmZW5jZXMgPSBn
ZXRfZmVuY2VfYXJyYXkoJmViLCAmbmZlbmNlcyk7CisJaWYgKElTX0VSUihmZW5jZXMpKQorCQly
ZXR1cm4gUFRSX0VSUihmZW5jZXMpOworCiAJaWYgKGFyZ3MtPmZsYWdzICYgSTkxNV9FWEVDX0ZF
TkNFX0lOKSB7CiAJCWluX2ZlbmNlID0gc3luY19maWxlX2dldF9mZW5jZShsb3dlcl8zMl9iaXRz
KGFyZ3MtPnJzdmQyKSk7Ci0JCWlmICghaW5fZmVuY2UpCi0JCQlyZXR1cm4gLUVJTlZBTDsKKwkJ
aWYgKCFpbl9mZW5jZSkgeworCQkJZXJyID0gLUVJTlZBTDsKKwkJCWdvdG8gZXJyX2ZlbmNlczsK
KwkJfQogCX0KIAogCWlmIChhcmdzLT5mbGFncyAmIEk5MTVfRVhFQ19GRU5DRV9TVUJNSVQpIHsK
QEAgLTI1ODQsNyArMjc2OCw3IEBAIGk5MTVfZ2VtX2RvX2V4ZWNidWZmZXIoc3RydWN0IGRybV9k
ZXZpY2UgKmRldiwKIAl9CiAKIAlpZiAoZmVuY2VzKSB7Ci0JCWVyciA9IGF3YWl0X2ZlbmNlX2Fy
cmF5KCZlYiwgZmVuY2VzKTsKKwkJZXJyID0gYXdhaXRfZmVuY2VfYXJyYXkoJmViLCBmZW5jZXMs
IG5mZW5jZXMpOwogCQlpZiAoZXJyKQogCQkJZ290byBlcnJfcmVxdWVzdDsKIAl9CkBAIC0yNjEz
LDcgKzI3OTcsNyBAQCBpOTE1X2dlbV9kb19leGVjYnVmZmVyKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsCiAJaTkxNV9yZXF1ZXN0X2FkZChlYi5yZXF1ZXN0KTsKIAogCWlmIChmZW5jZXMpCi0JCXNp
Z25hbF9mZW5jZV9hcnJheSgmZWIsIGZlbmNlcyk7CisJCXNpZ25hbF9mZW5jZV9hcnJheSgmZWIs
IGZlbmNlcywgbmZlbmNlcyk7CiAKIAlpZiAob3V0X2ZlbmNlKSB7CiAJCWlmIChlcnIgPT0gMCkg
ewpAQCAtMjY0OCw2ICsyODMyLDggQEAgaTkxNV9nZW1fZG9fZXhlY2J1ZmZlcihzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2LAogCWRtYV9mZW5jZV9wdXQoZXhlY19mZW5jZSk7CiBlcnJfaW5fZmVuY2U6
CiAJZG1hX2ZlbmNlX3B1dChpbl9mZW5jZSk7CitlcnJfZmVuY2VzOgorCXB1dF9mZW5jZV9hcnJh
eShmZW5jZXMsIG5mZW5jZXMpOwogCXJldHVybiBlcnI7CiB9CiAKQEAgLTI3NDEsNyArMjkyNyw3
IEBAIGk5MTVfZ2VtX2V4ZWNidWZmZXJfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9p
ZCAqZGF0YSwKIAkJCWV4ZWMyX2xpc3RbaV0uZmxhZ3MgPSAwOwogCX0KIAotCWVyciA9IGk5MTVf
Z2VtX2RvX2V4ZWNidWZmZXIoZGV2LCBmaWxlLCAmZXhlYzIsIGV4ZWMyX2xpc3QsIE5VTEwpOwor
CWVyciA9IGk5MTVfZ2VtX2RvX2V4ZWNidWZmZXIoZGV2LCBmaWxlLCAmZXhlYzIsIGV4ZWMyX2xp
c3QpOwogCWlmIChleGVjMi5mbGFncyAmIF9fRVhFQ19IQVNfUkVMT0MpIHsKIAkJc3RydWN0IGRy
bV9pOTE1X2dlbV9leGVjX29iamVjdCBfX3VzZXIgKnVzZXJfZXhlY19saXN0ID0KIAkJCXU2NF90
b191c2VyX3B0cihhcmdzLT5idWZmZXJzX3B0cik7CkBAIC0yNzcyLDcgKzI5NTgsNiBAQCBpOTE1
X2dlbV9leGVjYnVmZmVyMl9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRh
LAogewogCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY2J1ZmZlcjIgKmFyZ3MgPSBkYXRhOwogCXN0
cnVjdCBkcm1faTkxNV9nZW1fZXhlY19vYmplY3QyICpleGVjMl9saXN0OwotCXN0cnVjdCBkcm1f
c3luY29iaiAqKmZlbmNlcyA9IE5VTEw7CiAJY29uc3Qgc2l6ZV90IGNvdW50ID0gYXJncy0+YnVm
ZmVyX2NvdW50OwogCWludCBlcnI7CiAKQEAgLTI4MDAsMTUgKzI5ODUsNyBAQCBpOTE1X2dlbV9l
eGVjYnVmZmVyMl9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCQly
ZXR1cm4gLUVGQVVMVDsKIAl9CiAKLQlpZiAoYXJncy0+ZmxhZ3MgJiBJOTE1X0VYRUNfRkVOQ0Vf
QVJSQVkpIHsKLQkJZmVuY2VzID0gZ2V0X2ZlbmNlX2FycmF5KGFyZ3MsIGZpbGUpOwotCQlpZiAo
SVNfRVJSKGZlbmNlcykpIHsKLQkJCWt2ZnJlZShleGVjMl9saXN0KTsKLQkJCXJldHVybiBQVFJf
RVJSKGZlbmNlcyk7Ci0JCX0KLQl9Ci0KLQllcnIgPSBpOTE1X2dlbV9kb19leGVjYnVmZmVyKGRl
diwgZmlsZSwgYXJncywgZXhlYzJfbGlzdCwgZmVuY2VzKTsKKwllcnIgPSBpOTE1X2dlbV9kb19l
eGVjYnVmZmVyKGRldiwgZmlsZSwgYXJncywgZXhlYzJfbGlzdCk7CiAKIAkvKgogCSAqIE5vdyB0
aGF0IHdlIGhhdmUgYmVndW4gZXhlY3V0aW9uIG9mIHRoZSBiYXRjaGJ1ZmZlciwgd2UgaWdub3Jl
CkBAIC0yODQ4LDcgKzMwMjUsNiBAQCBlbmQ6OwogCX0KIAogCWFyZ3MtPmZsYWdzICY9IH5fX0k5
MTVfRVhFQ19VTktOT1dOX0ZMQUdTOwotCXB1dF9mZW5jZV9hcnJheShhcmdzLCBmZW5jZXMpOwog
CWt2ZnJlZShleGVjMl9saXN0KTsKIAlyZXR1cm4gZXJyOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2
LmMKaW5kZXggZmEwMmU4ZjAzM2Q3Li4wODhmOWQyYWYzZmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9k
cnYuYwpAQCAtNDU3LDYgKzQ1Nyw3IEBAIHN0YXRpYyBpbnQgaTkxNV9nZXRwYXJhbV9pb2N0bChz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCWNhc2UgSTkxNV9QQVJBTV9IQVNf
RVhFQ19CQVRDSF9GSVJTVDoKIAljYXNlIEk5MTVfUEFSQU1fSEFTX0VYRUNfRkVOQ0VfQVJSQVk6
CiAJY2FzZSBJOTE1X1BBUkFNX0hBU19FWEVDX1NVQk1JVF9GRU5DRToKKwljYXNlIEk5MTVfUEFS
QU1fSEFTX0VYRUNfVElNRUxJTkVfRkVOQ0VTOgogCQkvKiBGb3IgdGhlIHRpbWUgYmVpbmcgYWxs
IG9mIHRoZXNlIGFyZSBhbHdheXMgdHJ1ZTsKIAkJICogaWYgc29tZSBzdXBwb3J0ZWQgaGFyZHdh
cmUgZG9lcyBub3QgaGF2ZSBvbmUgb2YgdGhlc2UKIAkJICogZmVhdHVyZXMgdGhpcyB2YWx1ZSBu
ZWVkcyB0byBiZSBwcm92aWRlZCBmcm9tCkBAIC0zMjIwLDcgKzMyMjEsOCBAQCBzdGF0aWMgc3Ry
dWN0IGRybV9kcml2ZXIgZHJpdmVyID0gewogCSAqLwogCS5kcml2ZXJfZmVhdHVyZXMgPQogCSAg
ICBEUklWRVJfR0VNIHwKLQkgICAgRFJJVkVSX1JFTkRFUiB8IERSSVZFUl9NT0RFU0VUIHwgRFJJ
VkVSX0FUT01JQyB8IERSSVZFUl9TWU5DT0JKLAorCSAgICBEUklWRVJfUkVOREVSIHwgRFJJVkVS
X01PREVTRVQgfCBEUklWRVJfQVRPTUlDIHwgRFJJVkVSX1NZTkNPQkogfAorCSAgICBEUklWRVJf
U1lOQ09CSl9USU1FTElORSwKIAkucmVsZWFzZSA9IGk5MTVfZHJpdmVyX3JlbGVhc2UsCiAJLm9w
ZW4gPSBpOTE1X2RyaXZlcl9vcGVuLAogCS5sYXN0Y2xvc2UgPSBpOTE1X2RyaXZlcl9sYXN0Y2xv
c2UsCmRpZmYgLS1naXQgYS9pbmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJtLmggYi9pbmNsdWRlL3Vh
cGkvZHJtL2k5MTVfZHJtLmgKaW5kZXggZWZhMTk1ZDY5OTRlLi42YmQ3NmEwZDI5ZTUgMTAwNjQ0
Ci0tLSBhL2luY2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaAorKysgYi9pbmNsdWRlL3VhcGkvZHJt
L2k5MTVfZHJtLmgKQEAgLTYxNyw2ICs2MTcsMTIgQEAgdHlwZWRlZiBzdHJ1Y3QgZHJtX2k5MTVf
aXJxX3dhaXQgewogICovCiAjZGVmaW5lIEk5MTVfUEFSQU1fUEVSRl9SRVZJU0lPTgk1NAogCisv
KiBRdWVyeSB3aGV0aGVyIERSTV9JOTE1X0dFTV9FWEVDQlVGRkVSMiBzdXBwb3J0cyBzdXBwbHlp
bmcgYW4gYXJyYXkgb2YKKyAqIHRpbWVsaW5lIHN5bmNvYmogdGhyb3VnaCBkcm1faTkxNV9nZW1f
ZXhlY2J1Zl9leHRfdGltZWxpbmVfZmVuY2VzLiBTZWUKKyAqIEk5MTVfRVhFQ19FWFQuCisgKi8K
KyNkZWZpbmUgSTkxNV9QQVJBTV9IQVNfRVhFQ19USU1FTElORV9GRU5DRVMgNTUKKwogLyogTXVz
dCBiZSBrZXB0IGNvbXBhY3QgLS0gbm8gaG9sZXMgYW5kIHdlbGwgZG9jdW1lbnRlZCAqLwogCiB0
eXBlZGVmIHN0cnVjdCBkcm1faTkxNV9nZXRwYXJhbSB7CkBAIC0xMDE0LDkgKzEwMjAsNDEgQEAg
c3RydWN0IGRybV9pOTE1X2dlbV9leGVjX2ZlbmNlIHsKIH07CiAKIGVudW0gZHJtX2k5MTVfZ2Vt
X2V4ZWNidWZmZXJfZXh0IHsKKwkvKioKKwkgKiBTZWUgZHJtX2k5MTVfZ2VtX2V4ZWNidWZfZXh0
X3RpbWVsaW5lX2ZlbmNlcy4KKwkgKi8KKwlEUk1fSTkxNV9HRU1fRVhFQ0JVRkZFUl9FWFRfVElN
RUxJTkVfRkVOQ0VTID0gMCwKKwogCURSTV9JOTE1X0dFTV9FWEVDQlVGRkVSX0VYVF9NQVggLyog
bm9uLUFCSSAqLwogfTsKIAorLyoqCisgKiBUaGlzIHN0cnVjdHVyZSBkZXNjcmliZXMgYW4gYXJy
YXkgb2YgZHJtX3N5bmNvYmogYW5kIGFzc29jaWF0ZWQgcG9pbnRzIGZvcgorICogdGltZWxpbmUg
dmFyaWFudHMgb2YgZHJtX3N5bmNvYmouIEl0IGlzIGludmFsaWQgdG8gYXBwZW5kIHRoaXMgc3Ry
dWN0dXJlIHRvCisgKiB0aGUgZXhlY2J1ZiBpZiBJOTE1X0VYRUNfRkVOQ0VfQVJSQVkgaXMgc2V0
LgorICovCitzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXJfZXh0X3RpbWVsaW5lX2ZlbmNl
cyB7CisJc3RydWN0IGk5MTVfdXNlcl9leHRlbnNpb24gYmFzZTsKKworCS8qKgorCSAqIE51bWJl
ciBvZiBlbGVtZW50IGluIHRoZSBoYW5kbGVzX3B0ciAmIHZhbHVlX3B0ciBhcnJheXMuCisJICov
CisJX191NjQgZmVuY2VfY291bnQ7CisKKwkvKioKKwkgKiBQb2ludGVyIHRvIGFuIGFycmF5IG9m
IHN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY19mZW5jZSBvZiBsZW5ndGgKKwkgKiBmZW5jZV9jb3Vu
dC4KKwkgKi8KKwlfX3U2NCBoYW5kbGVzX3B0cjsKKworCS8qKgorCSAqIFBvaW50ZXIgdG8gYW4g
YXJyYXkgb2YgdTY0IHZhbHVlcyBvZiBsZW5ndGggZmVuY2VfY291bnQuIFZhbHVlcworCSAqIG11
c3QgYmUgMCBmb3IgYSBiaW5hcnkgZHJtX3N5bmNvYmouIEEgVmFsdWUgb2YgMCBmb3IgYSB0aW1l
bGluZQorCSAqIGRybV9zeW5jb2JqIGlzIGludmFsaWQgYXMgaXQgdHVybnMgYSBkcm1fc3luY29i
aiBpbnRvIGEgYmluYXJ5IG9uZS4KKwkgKi8KKwlfX3U2NCB2YWx1ZXNfcHRyOworfTsKKwogc3Ry
dWN0IGRybV9pOTE1X2dlbV9leGVjYnVmZmVyMiB7CiAJLyoqCiAJICogTGlzdCBvZiBnZW1fZXhl
Y19vYmplY3QyIHN0cnVjdHMKLS0gCjIuMjEuMC4zOTIuZ2Y4ZjY3ODcxNTllCgpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBs
aXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

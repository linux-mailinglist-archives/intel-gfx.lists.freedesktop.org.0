Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C68EFDF51C
	for <lists+intel-gfx@lfdr.de>; Mon, 21 Oct 2019 20:33:02 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E32056E1E2;
	Mon, 21 Oct 2019 18:33:00 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 978A96E1EC
 for <intel-gfx@lists.freedesktop.org>; Mon, 21 Oct 2019 18:32:59 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18916715-1500050 
 for multiple; Mon, 21 Oct 2019 19:32:38 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 21 Oct 2019 19:32:35 +0100
Message-Id: <20191021183236.21790-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0.rc0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 1/2] drm/i915: Lift i915_vma_parked() onto the gt
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q3VycmVudGx5IGV2ZW4gdGhvdWdoIGk5MTVfdm1hX3BhcmtlZCgpIG9wZXJhdGVzIG9uIGEgcGVy
LWd0IHN0cnVjdCwgaXQKaXMgY2FsbGVkIGZyb20gYSBnbG9iYWwgcG0gbm90aWZ5LiBUaGlzIG9k
ZGl0eSB3YXMgb25seSBiZWNhdXNlIHRoZSBsb25nCnRlcm0gcGxhbiBpcyB0byBkZWNvdXBsZSB0
aGUgdm1hIGNhY2hlIGZyb20gdGhlIHBtIG5vdGlmaWNhdGlvbiwgYnV0CnJpZ2h0IG5vdyB0aGUg
b2RkaXR5IHN0YW5kcyBvdXQgbGlrZSBhIHNvcmUgdGh1bWIhCgpTdWdnZXN0ZWQtYnk6IFR2cnRr
byBVcnN1bGluIDx0dnJ0a28udXJzdWxpbkBpbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6IENocmlz
IFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogVHZydGtvIFVyc3VsaW4gPHR2
cnRrby51cnN1bGluQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fcG0uYyB8ICAxIC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmMg
IHwgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYyAgICAgICAgfCAzMiArKysr
KysrKysrKysrLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaCAg
ICAgICAgfCAgMiArLQogNCBmaWxlcyBjaGFuZ2VkLCAxOCBpbnNlcnRpb25zKCspLCAxOCBkZWxl
dGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
cG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCmluZGV4IDc5ODdi
NTRmYjFmNS4uMmFhN2U5YmUwODhmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
cG0uYwpAQCAtMjMsNyArMjMsNiBAQCBzdGF0aWMgaW50IHBtX25vdGlmaWVyKHN0cnVjdCBub3Rp
Zmllcl9ibG9jayAqbmIsCiAJCWJyZWFrOwogCiAJY2FzZSBJTlRFTF9HVF9QQVJLOgotCQlpOTE1
X3ZtYV9wYXJrZWQoaTkxNSk7CiAJCWJyZWFrOwogCX0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2d0X3BtLmMKaW5kZXggYjg2NmQ1YjFlZWUwLi5mZGU1MTEyYjY2NTAgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uYwpAQCAtNzEsNiArNzEsNyBAQCBzdGF0aWMgaW50IF9f
Z3RfcGFyayhzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiAJcG1fbm90aWZ5KGd0LCBJTlRFTF9H
VF9QQVJLKTsKIAlpbnRlbF9ndF9wYXJrX3JlcXVlc3RzKGd0KTsKIAorCWk5MTVfdm1hX3Bhcmtl
ZChndCk7CiAJaTkxNV9wbXVfZ3RfcGFya2VkKGk5MTUpOwogCWlmIChJTlRFTF9HRU4oaTkxNSkg
Pj0gNikKIAkJZ2VuNl9ycHNfaWRsZShpOTE1KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfdm1hLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCmluZGV4
IGU5MGM0ZDBhZjhmZC4uZDczM2JjZjI2MmYwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3ZtYS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKQEAg
LTEwNiw3ICsxMDYsNyBAQCB2bWFfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
YmosCiAJc3RydWN0IHJiX25vZGUgKnJiLCAqKnA7CiAKIAkvKiBUaGUgYWxpYXNpbmdfcHBndHQg
c2hvdWxkIG5ldmVyIGJlIHVzZWQgZGlyZWN0bHkhICovCi0JR0VNX0JVR19PTih2bSA9PSAmdm0t
Pmk5MTUtPmdndHQuYWxpYXMtPnZtKTsKKwlHRU1fQlVHX09OKHZtID09ICZ2bS0+Z3QtPmdndHQt
PmFsaWFzLT52bSk7CiAKIAl2bWEgPSBpOTE1X3ZtYV9hbGxvYygpOwogCWlmICh2bWEgPT0gTlVM
TCkKQEAgLTQxMiw3ICs0MTIsNyBAQCB2b2lkIF9faW9tZW0gKmk5MTVfdm1hX3Bpbl9pb21hcChz
dHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAlpbnQgZXJyOwogCiAJLyogQWNjZXNzIHRocm91Z2ggdGhl
IEdUVCByZXF1aXJlcyB0aGUgZGV2aWNlIHRvIGJlIGF3YWtlLiAqLwotCWFzc2VydF9ycG1fd2Fr
ZWxvY2tfaGVsZCgmdm1hLT52bS0+aTkxNS0+cnVudGltZV9wbSk7CisJYXNzZXJ0X3JwbV93YWtl
bG9ja19oZWxkKHZtYS0+dm0tPmd0LT51bmNvcmUtPnJwbSk7CiAJaWYgKEdFTV9XQVJOX09OKCFp
OTE1X3ZtYV9pc19tYXBfYW5kX2ZlbmNlYWJsZSh2bWEpKSkgewogCQllcnIgPSAtRU5PREVWOwog
CQlnb3RvIGVycjsKQEAgLTk0NSw3ICs5NDUsNyBAQCBpbnQgaTkxNV92bWFfcGluKHN0cnVjdCBp
OTE1X3ZtYSAqdm1hLCB1NjQgc2l6ZSwgdTY0IGFsaWdubWVudCwgdTY0IGZsYWdzKQogCiB2b2lk
IGk5MTVfdm1hX2Nsb3NlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gdm1hLT52bS0+aTkxNTsKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0g
dm1hLT52bS0+Z3Q7CiAJdW5zaWduZWQgbG9uZyBmbGFnczsKIAogCUdFTV9CVUdfT04oaTkxNV92
bWFfaXNfY2xvc2VkKHZtYSkpOwpAQCAtOTYyLDE4ICs5NjIsMTggQEAgdm9pZCBpOTE1X3ZtYV9j
bG9zZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAkgKiBjYXVzaW5nIHVzIHRvIHJlYmluZCB0aGUg
Vk1BIG9uY2UgbW9yZS4gVGhpcyBlbmRzIHVwIGJlaW5nIGEgbG90CiAJICogb2Ygd2FzdGVkIHdv
cmsgZm9yIHRoZSBzdGVhZHkgc3RhdGUuCiAJICovCi0Jc3Bpbl9sb2NrX2lycXNhdmUoJmk5MTUt
Pmd0LmNsb3NlZF9sb2NrLCBmbGFncyk7Ci0JbGlzdF9hZGQoJnZtYS0+Y2xvc2VkX2xpbmssICZp
OTE1LT5ndC5jbG9zZWRfdm1hKTsKLQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZpOTE1LT5ndC5j
bG9zZWRfbG9jaywgZmxhZ3MpOworCXNwaW5fbG9ja19pcnFzYXZlKCZndC0+Y2xvc2VkX2xvY2ss
IGZsYWdzKTsKKwlsaXN0X2FkZCgmdm1hLT5jbG9zZWRfbGluaywgJmd0LT5jbG9zZWRfdm1hKTsK
KwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZndC0+Y2xvc2VkX2xvY2ssIGZsYWdzKTsKIH0KIAog
c3RhdGljIHZvaWQgX19pOTE1X3ZtYV9yZW1vdmVfY2xvc2VkKHN0cnVjdCBpOTE1X3ZtYSAqdm1h
KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdm1hLT52bS0+aTkxNTsKKwlz
dHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gdm1hLT52bS0+Z3Q7CiAKLQlzcGluX2xvY2tfaXJxKCZpOTE1
LT5ndC5jbG9zZWRfbG9jayk7CisJc3Bpbl9sb2NrX2lycSgmZ3QtPmNsb3NlZF9sb2NrKTsKIAls
aXN0X2RlbF9pbml0KCZ2bWEtPmNsb3NlZF9saW5rKTsKLQlzcGluX3VubG9ja19pcnEoJmk5MTUt
Pmd0LmNsb3NlZF9sb2NrKTsKKwlzcGluX3VubG9ja19pcnEoJmd0LT5jbG9zZWRfbG9jayk7CiB9
CiAKIHZvaWQgaTkxNV92bWFfcmVvcGVuKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQpAQCAtMTAwOSwx
MiArMTAwOSwxMiBAQCB2b2lkIGk5MTVfdm1hX2Rlc3Ryb3koc3RydWN0IGk5MTVfdm1hICp2bWEp
CiAJaTkxNV92bWFfZnJlZSh2bWEpOwogfQogCi12b2lkIGk5MTVfdm1hX3BhcmtlZChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3ZvaWQgaTkxNV92bWFfcGFya2VkKHN0cnVjdCBpbnRl
bF9ndCAqZ3QpCiB7CiAJc3RydWN0IGk5MTVfdm1hICp2bWEsICpuZXh0OwogCi0Jc3Bpbl9sb2Nr
X2lycSgmaTkxNS0+Z3QuY2xvc2VkX2xvY2spOwotCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZSh2
bWEsIG5leHQsICZpOTE1LT5ndC5jbG9zZWRfdm1hLCBjbG9zZWRfbGluaykgeworCXNwaW5fbG9j
a19pcnEoJmd0LT5jbG9zZWRfbG9jayk7CisJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHZtYSwg
bmV4dCwgJmd0LT5jbG9zZWRfdm1hLCBjbG9zZWRfbGluaykgewogCQlzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqID0gdm1hLT5vYmo7CiAJCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ug
KnZtID0gdm1hLT52bTsKIApAQCAtMTAyOCw3ICsxMDI4LDcgQEAgdm9pZCBpOTE1X3ZtYV9wYXJr
ZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJCQlvYmogPSBOVUxMOwogCQl9CiAK
LQkJc3Bpbl91bmxvY2tfaXJxKCZpOTE1LT5ndC5jbG9zZWRfbG9jayk7CisJCXNwaW5fdW5sb2Nr
X2lycSgmZ3QtPmNsb3NlZF9sb2NrKTsKIAogCQlpZiAob2JqKSB7CiAJCQlpOTE1X3ZtYV9kZXN0
cm95KHZtYSk7CkBAIC0xMDM4LDExICsxMDM4LDExIEBAIHZvaWQgaTkxNV92bWFfcGFya2VkKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCQlpOTE1X3ZtX2Nsb3NlKHZtKTsKIAogCQkv
KiBSZXN0YXJ0IGFmdGVyIGRyb3BwaW5nIGxvY2sgKi8KLQkJc3Bpbl9sb2NrX2lycSgmaTkxNS0+
Z3QuY2xvc2VkX2xvY2spOwotCQluZXh0ID0gbGlzdF9maXJzdF9lbnRyeSgmaTkxNS0+Z3QuY2xv
c2VkX3ZtYSwKKwkJc3Bpbl9sb2NrX2lycSgmZ3QtPmNsb3NlZF9sb2NrKTsKKwkJbmV4dCA9IGxp
c3RfZmlyc3RfZW50cnkoJmd0LT5jbG9zZWRfdm1hLAogCQkJCQl0eXBlb2YoKm5leHQpLCBjbG9z
ZWRfbGluayk7CiAJfQotCXNwaW5fdW5sb2NrX2lycSgmaTkxNS0+Z3QuY2xvc2VkX2xvY2spOwor
CXNwaW5fdW5sb2NrX2lycSgmZ3QtPmNsb3NlZF9sb2NrKTsKIH0KIAogc3RhdGljIHZvaWQgX19p
OTE1X3ZtYV9pb3VubWFwKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1h
LmgKaW5kZXggODU4OTA4ZTNkMWNjLi40NjU5MzI4MTNiYzUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfdm1hLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92
bWEuaApAQCAtNDYyLDcgKzQ2Miw3IEBAIGk5MTVfdm1hX3VucGluX2ZlbmNlKHN0cnVjdCBpOTE1
X3ZtYSAqdm1hKQogCQlfX2k5MTVfdm1hX3VucGluX2ZlbmNlKHZtYSk7CiB9CiAKLXZvaWQgaTkx
NV92bWFfcGFya2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgaTkxNV92
bWFfcGFya2VkKHN0cnVjdCBpbnRlbF9ndCAqZ3QpOwogCiAjZGVmaW5lIGZvcl9lYWNoX3VudGls
KGNvbmQpIGlmIChjb25kKSBicmVhazsgZWxzZQogCi0tIAoyLjI0LjAucmMwCgpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBs
aXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

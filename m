Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id B3005EFC30
	for <lists+intel-gfx@lfdr.de>; Tue,  5 Nov 2019 12:15:30 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6ABE16E9DB;
	Tue,  5 Nov 2019 11:15:28 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 335BB6E9D8;
 Tue,  5 Nov 2019 11:15:26 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19086744-1500050 
 for multiple; Tue, 05 Nov 2019 11:15:14 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue,  5 Nov 2019 11:15:13 +0000
Message-Id: <20191105111513.14278-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t] igt: Another combinatorial exercise for
 blits
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIGFpbSBvZiB0aGlzIHRlc3QgaXMgdG8gY29tYmluZSBnZW1fbGluZWFyX2JsaXRzLCBnZW1f
dGlsZWRfYmxpdHMgZXRjCmludG8gb25lIHRlc3QgcnVubmVyIHRoYXQgY292ZXJzIGludmVzdGln
YXRpb24gaW50byBIVyBhbGlnbm1lbnQgaXNzdWVzCmFzIHdlbGwgYXMgZHJpdmVyIGJvdW5kYXJp
ZXMgKHJlbG9jcywgYWNjZXNzLCB0aHJhc2hpbmcpLgoKU2VlIGFsc28gZ2VtX2NvbmN1cnJlbnRf
YmxpdHMgd2hpY2ggbG9va3MgZm9yIGNvaGVyZW5jeSBpc3N1ZXMgYmV0d2VlbgpwYXJhbGxlbCBl
eGVjdXRpb24uCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNv
bi5jby51az4KQ2M6IEthdGFyenluYSBEZWMgPGthdGFyenluYS5kZWNAaW50ZWwuY29tPgpDYzog
VmFuc2hpZGhhciBLb25kYSA8dmFuc2hpZGhhci5yLmtvbmRhQGludGVsLmNvbT4KLS0tCiB0ZXN0
cy9NYWtlZmlsZS5zb3VyY2VzIHwgICAxICsKIHRlc3RzL2k5MTUvZ2VtX2JsaXRzLmMgfCA3OTYg
KysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKIHRlc3RzL21lc29uLmJ1
aWxkICAgICAgfCAgIDEgKwogMyBmaWxlcyBjaGFuZ2VkLCA3OTggaW5zZXJ0aW9ucygrKQogY3Jl
YXRlIG1vZGUgMTAwNjQ0IHRlc3RzL2k5MTUvZ2VtX2JsaXRzLmMKCmRpZmYgLS1naXQgYS90ZXN0
cy9NYWtlZmlsZS5zb3VyY2VzIGIvdGVzdHMvTWFrZWZpbGUuc291cmNlcwppbmRleCAwOTNlYjU3
ZjMuLmY2MzYwMmVmMCAxMDA2NDQKLS0tIGEvdGVzdHMvTWFrZWZpbGUuc291cmNlcworKysgYi90
ZXN0cy9NYWtlZmlsZS5zb3VyY2VzCkBAIC0yNCw2ICsyNCw3IEBAIFRFU1RTX3Byb2dzID0gXAog
CWRybV9pbXBvcnRfZXhwb3J0IFwKIAlkcm1fbW0gXAogCWRybV9yZWFkIFwKKwlpOTE1L2dlbV9i
bGl0cyBcCiAJa21zXzNkIFwKIAlrbXNfYWRkZmJfYmFzaWMgXAogCWttc19hdG9taWMgXApkaWZm
IC0tZ2l0IGEvdGVzdHMvaTkxNS9nZW1fYmxpdHMuYyBiL3Rlc3RzL2k5MTUvZ2VtX2JsaXRzLmMK
bmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwLi5lNmE4NDBmZmIKLS0tIC9kZXYv
bnVsbAorKysgYi90ZXN0cy9pOTE1L2dlbV9ibGl0cy5jCkBAIC0wLDAgKzEsNzk2IEBACisvKgor
ICogQ29weXJpZ2h0IMKpIDIwMTggSW50ZWwgQ29ycG9yYXRpb24KKyAqCisgKiBQZXJtaXNzaW9u
IGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5p
bmcgYQorICogY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRp
b24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwKKyAqIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdp
dGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24KKyAqIHRoZSBy
aWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBz
dWJsaWNlbnNlLAorICogYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRv
IHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlCisgKiBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8g
ZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgorICoKKyAqIFRoZSBh
Ym92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIChpbmNsdWRp
bmcgdGhlIG5leHQKKyAqIHBhcmFncmFwaCkgc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsIGNvcGll
cyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUKKyAqIFNvZnR3YXJlLgorICoKKyAqIFRI
RSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBL
SU5ELCBFWFBSRVNTIE9SCisgKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRP
IFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKKyAqIEZJVE5FU1MgRk9SIEEgUEFS
VElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuICBJTiBOTyBFVkVOVCBTSEFMTAor
ICogVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xB
SU0sIERBTUFHRVMgT1IgT1RIRVIKKyAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04g
T0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HCisgKiBGUk9NLCBPVVQgT0Yg
T1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERF
QUxJTkdTCisgKiBJTiBUSEUgU09GVFdBUkUuCisgKgorICovCisKKyNpbmNsdWRlICJpZ3QuaCIK
KyNpbmNsdWRlICJpZ3RfeDg2LmgiCisKKyNkZWZpbmUgTUlfRkxVU0hfRFcgKDB4MjYgPDwgMjMp
CisKKyNkZWZpbmUgQkNTX1NXQ1RSTCAweDIyMjAwCisjZGVmaW5lIEJDU19TUkNfWSAoMSA8PCAw
KQorI2RlZmluZSBCQ1NfRFNUX1kgKDEgPDwgMSkKKworc3RydWN0IGRldmljZSB7CisJaW50IGZk
OworCWludCBnZW47CisJaW50IHBjaWlkOworCWludCBsbGM7Cit9OworCitzdHJ1Y3QgYnVmZmVy
IHsKKwl1aW50MzJfdCBoYW5kbGU7CisJdWludDE2X3Qgd2lkdGg7CisJdWludDE2X3QgaGVpZ2h0
OworCXVpbnQxNl90IHN0cmlkZTsKKwl1aW50MzJfdCBzaXplOworCXVuc2lnbmVkIGludCB0aWxp
bmc7CisJdW5zaWduZWQgaW50IGNhY2hpbmc7CisJdWludDY0X3QgZ3R0X29mZnNldDsKKwl1aW50
MzJfdCBtb2RlbFtdIF9fYXR0cmlidXRlX18oKGFsaWduZWQoMTYpKSk7Cit9OworCitlbnVtIG1v
ZGUgeworCUNQVSwKKwlQUlcsCisJR1RULAorCVdDLAorfTsKKworc3RhdGljIGludCBmbHModWlu
dDY0X3QgeCkKK3sKKwlpbnQgdDsKKworCWZvciAodCA9IDA7IHggPj4gdDsgdCsrKQorCQk7CisK
KwlyZXR1cm4gdDsKK30KKworc3RhdGljIHVuc2lnbmVkIGludAorZ2V0X3RpbGluZ19zdHJpZGUo
Y29uc3Qgc3RydWN0IGRldmljZSAqZGV2aWNlLAorCQkgIHVuc2lnbmVkIGludCB3aWR0aCwgdW5z
aWduZWQgaW50IHRpbGluZykKK3sKKwl1bnNpZ25lZCBpbnQgc3RyaWRlID0gNHUgKiB3aWR0aDsK
KworCWlmICh0aWxpbmcpIHsKKwkJaWYgKGRldmljZS0+Z2VuIDwgMykKKwkJCXN0cmlkZSA9IEFM
SUdOKHN0cmlkZSwgMTI4KTsKKwkJZWxzZSBpZiAoZGV2aWNlLT5nZW4gPCA0IHx8IHRpbGluZyA9
PSBJOTE1X1RJTElOR19YKQorCQkJc3RyaWRlID0gQUxJR04oc3RyaWRlLCA1MTIpOworCQllbHNl
CisJCQlzdHJpZGUgPSBBTElHTihzdHJpZGUsIDEyOCk7CisJCWlmIChkZXZpY2UtPmdlbiA8IDQp
CisJCQlzdHJpZGUgPSAxIDw8IGZscyhzdHJpZGUgLSAxKTsKKwl9IGVsc2UgeworCQlpZiAoZGV2
aWNlLT5nZW4gPj0gOCkKKwkJCXN0cmlkZSA9IEFMSUdOKHN0cmlkZSwgNjQpOworCX0KKworCWln
dF9hc3NlcnQoc3RyaWRlIDwgVUlOVDE2X01BWCAmJiBzdHJpZGUgPj0gNCp3aWR0aCk7CisJcmV0
dXJuIHN0cmlkZTsKK30KKworc3RhdGljIHVuc2lnbmVkIGludAorZ2V0X3RpbGluZ19oZWlnaHQo
Y29uc3Qgc3RydWN0IGRldmljZSAqZGV2aWNlLAorCQkgIHVuc2lnbmVkIGludCBoZWlnaHQsIHVu
c2lnbmVkIGludCB0aWxpbmcpCit7CisJaWYgKCF0aWxpbmcpCisJCXJldHVybiBoZWlnaHQ7CisK
KwlpZiAoZGV2aWNlLT5nZW4gPCAzKQorCQlyZXR1cm4gQUxJR04oaGVpZ2h0LCAxNik7CisJZWxz
ZSBpZiAoZGV2aWNlLT5nZW4gPCA0IHx8IHRpbGluZyA9PSBJOTE1X1RJTElOR19YKQorCQlyZXR1
cm4gQUxJR04oaGVpZ2h0LCA4KTsKKwllbHNlCisJCXJldHVybiBBTElHTihoZWlnaHQsIDMyKTsK
K30KKworc3RhdGljIHN0cnVjdCBidWZmZXIgKmJ1ZmZlcl9jcmVhdGUoY29uc3Qgc3RydWN0IGRl
dmljZSAqZGV2aWNlLAorCQkJCSAgICB1bnNpZ25lZCBpbnQgd2lkdGgsCisJCQkJICAgIHVuc2ln
bmVkIGludCBoZWlnaHQpCit7CisJc3RydWN0IGJ1ZmZlciAqYnVmZmVyOworCisJaWd0X2Fzc2Vy
dCh3aWR0aCAmJiBoZWlnaHQpOworCisJYnVmZmVyID0gbWFsbG9jKHNpemVvZigqYnVmZmVyKSAr
IDR1ICogd2lkdGggKiBoZWlnaHQpOworCWlmICghYnVmZmVyKQorCQlyZXR1cm4gTlVMTDsKKwor
CWJ1ZmZlci0+d2lkdGggPSB3aWR0aDsKKwlidWZmZXItPmhlaWdodCA9IGhlaWdodDsKKworCWJ1
ZmZlci0+dGlsaW5nID0gSTkxNV9USUxJTkdfTk9ORTsKKwlidWZmZXItPnN0cmlkZSA9IGdldF90
aWxpbmdfc3RyaWRlKGRldmljZSwgd2lkdGgsIEk5MTVfVElMSU5HX05PTkUpOworCWJ1ZmZlci0+
c2l6ZSA9IEFMSUdOKGJ1ZmZlci0+c3RyaWRlICogaGVpZ2h0LCA0MDk2KTsKKwlidWZmZXItPmhh
bmRsZSA9IGdlbV9jcmVhdGUoZGV2aWNlLT5mZCwgYnVmZmVyLT5zaXplKTsKKwlidWZmZXItPmNh
Y2hpbmcgPSBkZXZpY2UtPmxsYzsKKworCWJ1ZmZlci0+Z3R0X29mZnNldCA9IGJ1ZmZlci0+aGFu
ZGxlICogYnVmZmVyLT5zaXplOworCisJZm9yIChpbnQgeSA9IDA7IHkgPCBoZWlnaHQ7IHkrKykg
eworCQl1aW50MzJfdCAqcm93ID0gYnVmZmVyLT5tb2RlbCArIHkgKiB3aWR0aDsKKworCQlmb3Ig
KGludCB4ID0gMDsgeCA8IHdpZHRoOyB4KyspCisJCQlyb3dbeF0gPSAoeSA8PCAxNiB8IHgpIF4g
YnVmZmVyLT5oYW5kbGU7CisKKwkJZ2VtX3dyaXRlKGRldmljZS0+ZmQsCisJCQkgIGJ1ZmZlci0+
aGFuZGxlLCA0dSAqIHkgKiB3aWR0aCwKKwkJCSAgcm93LCA0dSAqIHdpZHRoKTsKKwl9CisKKwly
ZXR1cm4gYnVmZmVyOworfQorCitzdGF0aWMgdm9pZCBidWZmZXJfc2V0X3RpbGluZyhjb25zdCBz
dHJ1Y3QgZGV2aWNlICpkZXZpY2UsCisJCQkgICAgICBzdHJ1Y3QgYnVmZmVyICpidWZmZXIsCisJ
CQkgICAgICB1bnNpZ25lZCBpbnQgdGlsaW5nKQoreworCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhl
Y19vYmplY3QyIG9ialszXTsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX3JlbG9jYXRpb25fZW50cnkg
cmVsb2NbMl07CisJc3RydWN0IGRybV9pOTE1X2dlbV9leGVjYnVmZmVyMiBleGVjYnVmOworCWNv
bnN0IGJvb2wgaGFzXzY0Yl9yZWxvYyA9IGRldmljZS0+Z2VuID49IDg7CisJdWludDMyX3Qgc3Ry
aWRlLCBzaXplLCBwaXRjaDsKKwl1aW50MzJfdCAqYmF0Y2g7CisJaW50IGk7CisKKwlpZiAoYnVm
ZmVyLT50aWxpbmcgPT0gdGlsaW5nKQorCQlyZXR1cm47CisKKwlzdHJpZGUgPSBnZXRfdGlsaW5n
X3N0cmlkZShkZXZpY2UsIGJ1ZmZlci0+d2lkdGgsIHRpbGluZyk7CisJc2l6ZSA9IHN0cmlkZSAq
IGdldF90aWxpbmdfaGVpZ2h0KGRldmljZSwgYnVmZmVyLT5oZWlnaHQsIHRpbGluZyk7CisJc2l6
ZSA9IEFMSUdOKHNpemUsIDQwOTYpOworCisJbWVtc2V0KCZleGVjYnVmLCAwLCBzaXplb2YoZXhl
Y2J1ZikpOworCWV4ZWNidWYuYnVmZmVyc19wdHIgPSB0b191c2VyX3BvaW50ZXIob2JqKTsKKwll
eGVjYnVmLmJ1ZmZlcl9jb3VudCA9IEFSUkFZX1NJWkUob2JqKTsKKwlpZiAoZGV2aWNlLT5nZW4g
Pj0gNikKKwkJZXhlY2J1Zi5mbGFncyA9IEk5MTVfRVhFQ19CTFQ7CisKKwltZW1zZXQob2JqLCAw
LCBzaXplb2Yob2JqKSk7CisJb2JqWzBdLmhhbmRsZSA9IGdlbV9jcmVhdGUoZGV2aWNlLT5mZCwg
c2l6ZSk7CisJaWYgKHRpbGluZykgeworCQlvYmpbMF0uZmxhZ3MgPSBFWEVDX09CSkVDVF9ORUVE
U19GRU5DRTsKKwkJZ2VtX3NldF90aWxpbmcoZGV2aWNlLT5mZCwgb2JqWzBdLmhhbmRsZSwgdGls
aW5nLCBzdHJpZGUpOworCX0KKworCW9ialsxXS5oYW5kbGUgPSBidWZmZXItPmhhbmRsZTsKKwlv
YmpbMV0ub2Zmc2V0ID0gYnVmZmVyLT5ndHRfb2Zmc2V0OworCWlmIChidWZmZXItPnRpbGluZykK
KwkJb2JqWzFdLmZsYWdzID0gRVhFQ19PQkpFQ1RfTkVFRFNfRkVOQ0U7CisKKwlvYmpbMl0uaGFu
ZGxlID0gZ2VtX2NyZWF0ZShkZXZpY2UtPmZkLCA0MDk2KTsKKwlvYmpbMl0ucmVsb2NzX3B0ciA9
IHRvX3VzZXJfcG9pbnRlcihtZW1zZXQocmVsb2MsIDAsIHNpemVvZihyZWxvYykpKTsKKwlvYmpb
Ml0ucmVsb2NhdGlvbl9jb3VudCA9IDI7CisJYmF0Y2ggPSBnZW1fbW1hcF9fY3B1KGRldmljZS0+
ZmQsIG9ialsyXS5oYW5kbGUsIDAsIDQwOTYsIFBST1RfV1JJVEUpOworCisJaSA9IDA7CisKKwlp
ZiAoKHRpbGluZyB8IGJ1ZmZlci0+dGlsaW5nKSA+PSBJOTE1X1RJTElOR19ZKSB7CisJCXVuc2ln
bmVkIGludCBtYXNrOworCisJCWJhdGNoW2krK10gPSBNSV9MT0FEX1JFR0lTVEVSX0lNTTsKKwkJ
YmF0Y2hbaSsrXSA9IEJDU19TV0NUUkw7CisKKwkJbWFzayA9IChCQ1NfU1JDX1kgfCBCQ1NfRFNU
X1kpIDw8IDE2OworCQlpZiAoYnVmZmVyLT50aWxpbmcgPT0gSTkxNV9USUxJTkdfWSkKKwkJCW1h
c2sgfD0gQkNTX1NSQ19ZOworCQlpZiAodGlsaW5nID09IEk5MTVfVElMSU5HX1kpCisJCQltYXNr
IHw9IEJDU19EU1RfWTsKKwkJYmF0Y2hbaSsrXSA9IG1hc2s7CisJfQorCisJYmF0Y2hbaV0gPSAo
WFlfU1JDX0NPUFlfQkxUX0NNRCB8CisJCSAgICBYWV9TUkNfQ09QWV9CTFRfV1JJVEVfQUxQSEEg
fAorCQkgICAgWFlfU1JDX0NPUFlfQkxUX1dSSVRFX1JHQik7CisJaWYgKGRldmljZS0+Z2VuID49
IDQgJiYgYnVmZmVyLT50aWxpbmcpCisJCWJhdGNoW2ldIHw9IFhZX1NSQ19DT1BZX0JMVF9TUkNf
VElMRUQ7CisJaWYgKGRldmljZS0+Z2VuID49IDQgJiYgdGlsaW5nKQorCQliYXRjaFtpXSB8PSBY
WV9TUkNfQ09QWV9CTFRfRFNUX1RJTEVEOworCWJhdGNoW2krK10gfD0gNiArIDIgKiBoYXNfNjRi
X3JlbG9jOworCisJcGl0Y2ggPSBzdHJpZGU7CisJaWYgKGRldmljZS0+Z2VuID49IDQgJiYgdGls
aW5nKQorCQlwaXRjaCAvPSA0OworCWJhdGNoW2krK10gPSAzIDw8IDI0IHwgMHhjYyA8PCAxNiB8
IHBpdGNoOworCWJhdGNoW2krK10gPSAwOworCWJhdGNoW2krK10gPSBidWZmZXItPmhlaWdodCA8
PCAxNiB8IGJ1ZmZlci0+d2lkdGg7CisJcmVsb2NbMF0udGFyZ2V0X2hhbmRsZSA9IG9ialswXS5o
YW5kbGU7CisJcmVsb2NbMF0ucHJlc3VtZWRfb2Zmc2V0ID0gb2JqWzBdLm9mZnNldDsKKwlyZWxv
Y1swXS5vZmZzZXQgPSBzaXplb2YoKmJhdGNoKSAqIGk7CisJcmVsb2NbMF0ucmVhZF9kb21haW5z
ID0gSTkxNV9HRU1fRE9NQUlOX1JFTkRFUjsKKwlyZWxvY1swXS53cml0ZV9kb21haW4gPSBJOTE1
X0dFTV9ET01BSU5fUkVOREVSOworCWJhdGNoW2krK10gPSBvYmpbMF0ub2Zmc2V0OworCWlmICho
YXNfNjRiX3JlbG9jKQorCQliYXRjaFtpKytdID0gb2JqWzBdLm9mZnNldCA+PiAzMjsKKworCWJh
dGNoW2krK10gPSAwOworCXBpdGNoID0gYnVmZmVyLT5zdHJpZGU7CisJaWYgKGRldmljZS0+Z2Vu
ID49IDQgJiYgYnVmZmVyLT50aWxpbmcpCisJCXBpdGNoIC89IDQ7CisJYmF0Y2hbaSsrXSA9IHBp
dGNoOworCXJlbG9jWzFdLnRhcmdldF9oYW5kbGUgPSBvYmpbMV0uaGFuZGxlOworCXJlbG9jWzFd
LnByZXN1bWVkX29mZnNldCA9IG9ialsxXS5vZmZzZXQ7CisJcmVsb2NbMV0ub2Zmc2V0ID0gc2l6
ZW9mKCpiYXRjaCkgKiBpOworCXJlbG9jWzFdLnJlYWRfZG9tYWlucyA9IEk5MTVfR0VNX0RPTUFJ
Tl9SRU5ERVI7CisJYmF0Y2hbaSsrXSA9IG9ialsxXS5vZmZzZXQ7CisJaWYgKGhhc182NGJfcmVs
b2MpCisJCWJhdGNoW2krK10gPSBvYmpbMV0ub2Zmc2V0ID4+IDMyOworCisJaWYgKCh0aWxpbmcg
fCBidWZmZXItPnRpbGluZykgPj0gSTkxNV9USUxJTkdfWSkgeworCQlpZ3RfYXNzZXJ0KGRldmlj
ZS0+Z2VuID49IDYpOworCQliYXRjaFtpKytdID0gTUlfRkxVU0hfRFcgfCAyOworCQliYXRjaFtp
KytdID0gMDsKKwkJYmF0Y2hbaSsrXSA9IDA7CisJCWJhdGNoW2krK10gPSAwOworCisJCWJhdGNo
W2krK10gPSBNSV9MT0FEX1JFR0lTVEVSX0lNTTsKKwkJYmF0Y2hbaSsrXSA9IEJDU19TV0NUUkw7
CisJCWJhdGNoW2krK10gPSAoQkNTX1NSQ19ZIHwgQkNTX0RTVF9ZKSA8PCAxNjsKKwl9CisKKwli
YXRjaFtpKytdID0gTUlfQkFUQ0hfQlVGRkVSX0VORDsKKwltdW5tYXAoYmF0Y2gsIDQwOTYpOwor
CisJZ2VtX2V4ZWNidWYoZGV2aWNlLT5mZCwgJmV4ZWNidWYpOworCisJZ2VtX2Nsb3NlKGRldmlj
ZS0+ZmQsIG9ialsyXS5oYW5kbGUpOworCWdlbV9jbG9zZShkZXZpY2UtPmZkLCBvYmpbMV0uaGFu
ZGxlKTsKKworCWJ1ZmZlci0+Z3R0X29mZnNldCA9IG9ialswXS5vZmZzZXQ7CisJYnVmZmVyLT5o
YW5kbGUgPSBvYmpbMF0uaGFuZGxlOworCisJYnVmZmVyLT50aWxpbmcgPSB0aWxpbmc7CisJYnVm
ZmVyLT5zdHJpZGUgPSBzdHJpZGU7CisJYnVmZmVyLT5zaXplID0gc2l6ZTsKK30KKworc3RhdGlj
IGJvb2wgY2FuX2JsaXRfdG9fbGluZWFyKGNvbnN0IHN0cnVjdCBkZXZpY2UgKmRldmljZSwKKwkJ
CSAgICAgICBjb25zdCBzdHJ1Y3QgYnVmZmVyICpidWZmZXIpCit7CisJaWYgKGJ1ZmZlci0+Y2Fj
aGluZyAmJiAhZGV2aWNlLT5sbGMpCisJCXJldHVybiBmYWxzZTsKKworCWlmIChkZXZpY2UtPmdl
biA8IDMpCisJCXJldHVybiBmYWxzZTsKKworCXJldHVybiB0cnVlOworfQorCitzdGF0aWMgYm9v
bCBibGl0X3RvX2xpbmVhcihjb25zdCBzdHJ1Y3QgZGV2aWNlICpkZXZpY2UsCisJCQkgICBjb25z
dCBzdHJ1Y3QgYnVmZmVyICpidWZmZXIsCisJCQkgICB2b2lkICpsaW5lYXIpCit7CisJc3RydWN0
IGRybV9pOTE1X2dlbV9leGVjX29iamVjdDIgb2JqWzNdOworCXN0cnVjdCBkcm1faTkxNV9nZW1f
cmVsb2NhdGlvbl9lbnRyeSByZWxvY1syXTsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZm
ZXIyIGV4ZWNidWY7CisJY29uc3QgYm9vbCBoYXNfNjRiX3JlbG9jID0gZGV2aWNlLT5nZW4gPj0g
ODsKKwl1aW50MzJfdCAqYmF0Y2g7CisJdWludDMyX3QgcGl0Y2g7CisJaW50IGkgPSAwOworCisJ
aWd0X2Fzc2VydChidWZmZXItPnRpbGluZyk7CisKKwlpZiAoIWNhbl9ibGl0X3RvX2xpbmVhcihk
ZXZpY2UsIGJ1ZmZlcikpCisJCXJldHVybiBmYWxzZTsKKworCW1lbXNldCgmZXhlY2J1ZiwgMCwg
c2l6ZW9mKGV4ZWNidWYpKTsKKwlleGVjYnVmLmJ1ZmZlcnNfcHRyID0gdG9fdXNlcl9wb2ludGVy
KG9iaik7CisJZXhlY2J1Zi5idWZmZXJfY291bnQgPSBBUlJBWV9TSVpFKG9iaik7CisJaWYgKGRl
dmljZS0+Z2VuID49IDYpCisJCWV4ZWNidWYuZmxhZ3MgPSBJOTE1X0VYRUNfQkxUOworCisJbWVt
c2V0KG9iaiwgMCwgc2l6ZW9mKG9iaikpOworCWlmIChfX2dlbV91c2VycHRyKGRldmljZS0+ZmQs
IGxpbmVhciwgYnVmZmVyLT5zaXplLCAwLCAwLCAmb2JqWzBdLmhhbmRsZSkpCisJCXJldHVybiBm
YWxzZTsKKworCW9ialsxXS5oYW5kbGUgPSBidWZmZXItPmhhbmRsZTsKKwlvYmpbMV0ub2Zmc2V0
ID0gYnVmZmVyLT5ndHRfb2Zmc2V0OworCW9ialsxXS5mbGFncyA9IEVYRUNfT0JKRUNUX05FRURT
X0ZFTkNFOworCisJbWVtc2V0KHJlbG9jLCAwLCBzaXplb2YocmVsb2MpKTsKKwlvYmpbMl0uaGFu
ZGxlID0gZ2VtX2NyZWF0ZShkZXZpY2UtPmZkLCA0MDk2KTsKKwlvYmpbMl0ucmVsb2NzX3B0ciA9
IHRvX3VzZXJfcG9pbnRlcihyZWxvYyk7CisJb2JqWzJdLnJlbG9jYXRpb25fY291bnQgPSBBUlJB
WV9TSVpFKHJlbG9jKTsKKwliYXRjaCA9IGdlbV9tbWFwX19jcHUoZGV2aWNlLT5mZCwgb2JqWzJd
LmhhbmRsZSwgMCwgNDA5NiwgUFJPVF9XUklURSk7CisKKwlpZiAoYnVmZmVyLT50aWxpbmcgPj0g
STkxNV9USUxJTkdfWSkgeworCQl1bnNpZ25lZCBpbnQgbWFzazsKKworCQliYXRjaFtpKytdID0g
TUlfTE9BRF9SRUdJU1RFUl9JTU07CisJCWJhdGNoW2krK10gPSBCQ1NfU1dDVFJMOworCisJCW1h
c2sgPSAoQkNTX1NSQ19ZIHwgQkNTX0RTVF9ZKSA8PCAxNjsKKwkJaWYgKGJ1ZmZlci0+dGlsaW5n
ID09IEk5MTVfVElMSU5HX1kpCisJCQltYXNrIHw9IEJDU19TUkNfWTsKKwkJYmF0Y2hbaSsrXSA9
IG1hc2s7CisJfQorCisJYmF0Y2hbaV0gPSAoWFlfU1JDX0NPUFlfQkxUX0NNRCB8CisJCSAgICBY
WV9TUkNfQ09QWV9CTFRfV1JJVEVfQUxQSEEgfAorCQkgICAgWFlfU1JDX0NPUFlfQkxUX1dSSVRF
X1JHQik7CisJaWYgKGRldmljZS0+Z2VuID49IDQgJiYgYnVmZmVyLT50aWxpbmcpCisJCWJhdGNo
W2ldIHw9IFhZX1NSQ19DT1BZX0JMVF9TUkNfVElMRUQ7CisJYmF0Y2hbaSsrXSB8PSA2ICsgMiAq
IGhhc182NGJfcmVsb2M7CisKKwliYXRjaFtpKytdID0gMyA8PCAyNCB8IDB4Y2MgPDwgMTYgfCBi
dWZmZXItPnN0cmlkZTsKKwliYXRjaFtpKytdID0gMDsKKwliYXRjaFtpKytdID0gYnVmZmVyLT5o
ZWlnaHQgPDwgMTYgfCBidWZmZXItPndpZHRoOworCXJlbG9jWzBdLnRhcmdldF9oYW5kbGUgPSBv
YmpbMF0uaGFuZGxlOworCXJlbG9jWzBdLnByZXN1bWVkX29mZnNldCA9IG9ialswXS5vZmZzZXQ7
CisJcmVsb2NbMF0ub2Zmc2V0ID0gc2l6ZW9mKCpiYXRjaCkgKiBpOworCXJlbG9jWzBdLnJlYWRf
ZG9tYWlucyA9IEk5MTVfR0VNX0RPTUFJTl9SRU5ERVI7CisJcmVsb2NbMF0ud3JpdGVfZG9tYWlu
ID0gSTkxNV9HRU1fRE9NQUlOX1JFTkRFUjsKKwliYXRjaFtpKytdID0gb2JqWzBdLm9mZnNldDsK
KwlpZiAoaGFzXzY0Yl9yZWxvYykKKwkJYmF0Y2hbaSsrXSA9IG9ialswXS5vZmZzZXQgPj4gMzI7
CisKKwliYXRjaFtpKytdID0gMDsKKwlwaXRjaCA9IGJ1ZmZlci0+c3RyaWRlOworCWlmIChkZXZp
Y2UtPmdlbiA+PSA0ICYmIGJ1ZmZlci0+dGlsaW5nKQorCQlwaXRjaCAvPSA0OworCWJhdGNoW2kr
K10gPSBwaXRjaDsKKwlyZWxvY1sxXS50YXJnZXRfaGFuZGxlID0gb2JqWzFdLmhhbmRsZTsKKwly
ZWxvY1sxXS5wcmVzdW1lZF9vZmZzZXQgPSBvYmpbMV0ub2Zmc2V0OworCXJlbG9jWzFdLm9mZnNl
dCA9IHNpemVvZigqYmF0Y2gpICogaTsKKwlyZWxvY1sxXS5yZWFkX2RvbWFpbnMgPSBJOTE1X0dF
TV9ET01BSU5fUkVOREVSOworCWJhdGNoW2krK10gPSBvYmpbMV0ub2Zmc2V0OworCWlmIChoYXNf
NjRiX3JlbG9jKQorCQliYXRjaFtpKytdID0gb2JqWzFdLm9mZnNldCA+PiAzMjsKKworCWlmIChi
dWZmZXItPnRpbGluZyA+PSBJOTE1X1RJTElOR19ZKSB7CisJCWlndF9hc3NlcnQoZGV2aWNlLT5n
ZW4gPj0gNik7CisJCWJhdGNoW2krK10gPSBNSV9GTFVTSF9EVyB8IDI7CisJCWJhdGNoW2krK10g
PSAwOworCQliYXRjaFtpKytdID0gMDsKKwkJYmF0Y2hbaSsrXSA9IDA7CisKKwkJYmF0Y2hbaSsr
XSA9IE1JX0xPQURfUkVHSVNURVJfSU1NOworCQliYXRjaFtpKytdID0gQkNTX1NXQ1RSTDsKKwkJ
YmF0Y2hbaSsrXSA9IChCQ1NfU1JDX1kgfCBCQ1NfRFNUX1kpIDw8IDE2OworCX0KKworCWJhdGNo
W2krK10gPSBNSV9CQVRDSF9CVUZGRVJfRU5EOworCW11bm1hcChiYXRjaCwgNDA5Nik7CisKKwln
ZW1fZXhlY2J1ZihkZXZpY2UtPmZkLCAmZXhlY2J1Zik7CisJZ2VtX2Nsb3NlKGRldmljZS0+ZmQs
IG9ialsyXS5oYW5kbGUpOworCisJZ2VtX3N5bmMoZGV2aWNlLT5mZCwgb2JqWzBdLmhhbmRsZSk7
CisJZ2VtX2Nsb3NlKGRldmljZS0+ZmQsIG9ialswXS5oYW5kbGUpOworCisJcmV0dXJuIHRydWU7
Cit9CisKK3N0YXRpYyB2b2lkICpkb3dubG9hZChjb25zdCBzdHJ1Y3QgZGV2aWNlICpkZXZpY2Us
CisJCSAgICAgIGNvbnN0IHN0cnVjdCBidWZmZXIgKmJ1ZmZlciwKKwkJICAgICAgZW51bSBtb2Rl
IG1vZGUpCit7CisJdm9pZCAqbGluZWFyLCAqc3JjOworCisJaWd0X2Fzc2VydChwb3NpeF9tZW1h
bGlnbigmbGluZWFyLCA0MDk2LCBidWZmZXItPnNpemUpID09IDApOworCisJc3dpdGNoIChtb2Rl
KSB7CisJY2FzZSBDUFU6CisJCWlmIChidWZmZXItPnRpbGluZykgeworCQkJaWYgKGJsaXRfdG9f
bGluZWFyKGRldmljZSwgYnVmZmVyLCBsaW5lYXIpKQorCQkJCXJldHVybiBsaW5lYXI7CisKKwkJ
CW1vZGUgPSBHVFQ7CisJCX0KKwkJYnJlYWs7CisKKwljYXNlIFdDOgorCQlpZiAoIWdlbV9tbWFw
X19oYXNfd2MoZGV2aWNlLT5mZCkgfHwgYnVmZmVyLT50aWxpbmcpCisJCQltb2RlID0gR1RUOwor
CQlicmVhazsKKworCWNhc2UgUFJXOgorCQlpZiAoYnVmZmVyLT50aWxpbmcpCisJCQltb2RlID0g
R1RUOworCQlicmVhazsKKworCWNhc2UgR1RUOgorCQlicmVhazsKKwl9CisKKwlzd2l0Y2ggKG1v
ZGUpIHsKKwljYXNlIENQVToKKwkJc3JjID0gZ2VtX21tYXBfX2NwdShkZXZpY2UtPmZkLCBidWZm
ZXItPmhhbmRsZSwKKwkJCQkgICAgMCwgYnVmZmVyLT5zaXplLAorCQkJCSAgICBQUk9UX1JFQUQp
OworCisJCWdlbV9zZXRfZG9tYWluKGRldmljZS0+ZmQsIGJ1ZmZlci0+aGFuZGxlLAorCQkJICAg
ICAgIEk5MTVfR0VNX0RPTUFJTl9DUFUsIDApOworCQlpZ3RfbWVtY3B5X2Zyb21fd2MobGluZWFy
LCBzcmMsIGJ1ZmZlci0+c2l6ZSk7CisJCW11bm1hcChzcmMsIGJ1ZmZlci0+c2l6ZSk7CisJCWJy
ZWFrOworCisJY2FzZSBXQzoKKwkJc3JjID0gZ2VtX21tYXBfX3djKGRldmljZS0+ZmQsIGJ1ZmZl
ci0+aGFuZGxlLAorCQkJCSAgIDAsIGJ1ZmZlci0+c2l6ZSwKKwkJCQkgICBQUk9UX1JFQUQpOwor
CisJCWdlbV9zZXRfZG9tYWluKGRldmljZS0+ZmQsIGJ1ZmZlci0+aGFuZGxlLAorCQkJICAgICAg
IEk5MTVfR0VNX0RPTUFJTl9XQywgMCk7CisJCWlndF9tZW1jcHlfZnJvbV93YyhsaW5lYXIsIHNy
YywgYnVmZmVyLT5zaXplKTsKKwkJbXVubWFwKHNyYywgYnVmZmVyLT5zaXplKTsKKwkJYnJlYWs7
CisKKwljYXNlIEdUVDoKKwkJc3JjID0gZ2VtX21tYXBfX2d0dChkZXZpY2UtPmZkLCBidWZmZXIt
PmhhbmRsZSwKKwkJCQkgICBidWZmZXItPnNpemUsCisJCQkJICAgUFJPVF9SRUFEKTsKKworCQln
ZW1fc2V0X2RvbWFpbihkZXZpY2UtPmZkLCBidWZmZXItPmhhbmRsZSwKKwkJCSAgICAgICBJOTE1
X0dFTV9ET01BSU5fR1RULCAwKTsKKwkJaWd0X21lbWNweV9mcm9tX3djKGxpbmVhciwgc3JjLCBi
dWZmZXItPnNpemUpOworCQltdW5tYXAoc3JjLCBidWZmZXItPnNpemUpOworCQlicmVhazsKKwor
CWNhc2UgUFJXOgorCQlnZW1fcmVhZChkZXZpY2UtPmZkLCBidWZmZXItPmhhbmRsZSwgMCwgbGlu
ZWFyLCBidWZmZXItPnNpemUpOworCQlicmVhazsKKwl9CisKKwlyZXR1cm4gbGluZWFyOworfQor
CitzdGF0aWMgYm9vbCBidWZmZXJfY2hlY2soY29uc3Qgc3RydWN0IGRldmljZSAqZGV2aWNlLAor
CQkJIGNvbnN0IHN0cnVjdCBidWZmZXIgKmJ1ZmZlciwKKwkJCSBlbnVtIG1vZGUgbW9kZSkKK3sK
Kwl1bnNpZ25lZCBpbnQgbnVtX2Vycm9ycyA9IDA7CisJdWludDMyX3QgKmxpbmVhcjsKKworCWxp
bmVhciA9IGRvd25sb2FkKGRldmljZSwgYnVmZmVyLCBtb2RlKTsKKwlpZ3RfYXNzZXJ0KGxpbmVh
cik7CisKKwlmb3IgKGludCB5ID0gMDsgeSA8IGJ1ZmZlci0+aGVpZ2h0OyB5KyspIHsKKwkJY29u
c3QgdWludDMyX3QgKm1vZGVsID0gYnVmZmVyLT5tb2RlbCArIHkgKiBidWZmZXItPndpZHRoOwor
CQljb25zdCB1aW50MzJfdCAqcm93ID0KKwkJCWxpbmVhciArIHkgKiBidWZmZXItPnN0cmlkZSAv
IHNpemVvZih1aW50MzJfdCk7CisKKwkJaWYgKCFtZW1jbXAobW9kZWwsIHJvdywgYnVmZmVyLT53
aWR0aCAqIHNpemVvZih1aW50MzJfdCkpKQorCQkJY29udGludWU7CisKKwkJZm9yIChpbnQgeCA9
IDA7IHggPCBidWZmZXItPndpZHRoOyB4KyspIHsKKwkJCWlmIChyb3dbeF0gIT0gbW9kZWxbeF0g
JiYgbnVtX2Vycm9ycysrIDwgNSkgeworCQkJCWlndF93YXJuKCJidWZmZXIgaGFuZGxlPSVkIG1p
c21hdGNoIGF0ICglZCwgJWQpOiBleHBlY3RlZCAlMDh4LCBmb3VuZCAlMDh4XG4iLAorCQkJCQkg
YnVmZmVyLT5oYW5kbGUsCisJCQkJCSB4LCB5LCBtb2RlbFt4XSwgcm93W3hdKTsKKwkJCX0KKwkJ
fQorCX0KKworCWZyZWUobGluZWFyKTsKKworCXJldHVybiBudW1fZXJyb3JzID09IDA7Cit9CisK
K3N0YXRpYyB2b2lkIGJ1ZmZlcl9mcmVlKGNvbnN0IHN0cnVjdCBkZXZpY2UgKmRldmljZSwgc3Ry
dWN0IGJ1ZmZlciAqYnVmZmVyKQoreworCWlndF9hc3NlcnQoYnVmZmVyX2NoZWNrKGRldmljZSwg
YnVmZmVyLCBHVFQpKTsKKwlnZW1fY2xvc2UoZGV2aWNlLT5mZCwgYnVmZmVyLT5oYW5kbGUpOwor
CWZyZWUoYnVmZmVyKTsKK30KKworc3RhdGljIHZvaWQgbWVtY3B5X2JsdChjb25zdCB2b2lkICpz
cmMsIHZvaWQgKmRzdCwKKwkJICAgICAgIHVpbnQzMl90IHNyY19zdHJpZGUsIHVpbnQzMl90IGRz
dF9zdHJpZGUsCisJCSAgICAgICB1aW50MTZfdCBzcmNfeCwgdWludDE2X3Qgc3JjX3ksCisJCSAg
ICAgICB1aW50MTZfdCBkc3RfeCwgdWludDE2X3QgZHN0X3ksCisJCSAgICAgICB1aW50MTZfdCB3
aWR0aCwgdWludDE2X3QgaGVpZ2h0KQoreworCWNvbnN0IHVpbnQ4X3QgKnNyY19ieXRlczsKKwl1
aW50OF90ICpkc3RfYnl0ZXM7CisJaW50IGJ5dGVfd2lkdGg7CisKKwlzcmNfYnl0ZXMgPSAoY29u
c3QgdWludDhfdCAqKXNyYyArIHNyY19zdHJpZGUgKiBzcmNfeSArIHNyY194ICogNDsKKwlkc3Rf
Ynl0ZXMgPSAodWludDhfdCAqKWRzdCArIGRzdF9zdHJpZGUgKiBkc3RfeSArIGRzdF94ICogNDsK
KworCWJ5dGVfd2lkdGggPSB3aWR0aCAqIDQ7CisJaWYgKGJ5dGVfd2lkdGggPT0gc3JjX3N0cmlk
ZSAmJiBieXRlX3dpZHRoID09IGRzdF9zdHJpZGUpIHsKKwkJYnl0ZV93aWR0aCAqPSBoZWlnaHQ7
CisJCWhlaWdodCA9IDE7CisJfQorCisJc3dpdGNoIChieXRlX3dpZHRoKSB7CisJY2FzZSA0Ogor
CQlkbyB7CisJCQkqKHVpbnQzMl90ICopZHN0X2J5dGVzID0gKihjb25zdCB1aW50MzJfdCAqKXNy
Y19ieXRlczsKKwkJCXNyY19ieXRlcyArPSBzcmNfc3RyaWRlOworCQkJZHN0X2J5dGVzICs9IGRz
dF9zdHJpZGU7CisJCX0gd2hpbGUgKC0taGVpZ2h0KTsKKwkJYnJlYWs7CisKKwljYXNlIDg6CisJ
CWRvIHsKKwkJCSoodWludDY0X3QgKilkc3RfYnl0ZXMgPSAqKGNvbnN0IHVpbnQ2NF90ICopc3Jj
X2J5dGVzOworCQkJc3JjX2J5dGVzICs9IHNyY19zdHJpZGU7CisJCQlkc3RfYnl0ZXMgKz0gZHN0
X3N0cmlkZTsKKwkJfSB3aGlsZSAoLS1oZWlnaHQpOworCQlicmVhazsKKwljYXNlIDE2OgorCQlk
byB7CisJCQkoKHVpbnQ2NF90ICopZHN0X2J5dGVzKVswXSA9ICgoY29uc3QgdWludDY0X3QgKilz
cmNfYnl0ZXMpWzBdOworCQkJKCh1aW50NjRfdCAqKWRzdF9ieXRlcylbMV0gPSAoKGNvbnN0IHVp
bnQ2NF90ICopc3JjX2J5dGVzKVsxXTsKKwkJCXNyY19ieXRlcyArPSBzcmNfc3RyaWRlOworCQkJ
ZHN0X2J5dGVzICs9IGRzdF9zdHJpZGU7CisJCX0gd2hpbGUgKC0taGVpZ2h0KTsKKwkJYnJlYWs7
CisKKwlkZWZhdWx0OgorCQlkbyB7CisJCQltZW1jcHkoZHN0X2J5dGVzLCBzcmNfYnl0ZXMsIGJ5
dGVfd2lkdGgpOworCQkJc3JjX2J5dGVzICs9IHNyY19zdHJpZGU7CisJCQlkc3RfYnl0ZXMgKz0g
ZHN0X3N0cmlkZTsKKwkJfSB3aGlsZSAoLS1oZWlnaHQpOworCQlicmVhazsKKwl9Cit9CisKK3N0
YXRpYyB2b2lkCitibGl0KGNvbnN0IHN0cnVjdCBkZXZpY2UgKmRldmljZSwKKyAgICAgc3RydWN0
IGJ1ZmZlciAqc3JjLCB1aW50MTZfdCBzcmNfeCwgdWludDE2X3Qgc3JjX3ksCisgICAgIHN0cnVj
dCBidWZmZXIgKmRzdCwgdWludDE2X3QgZHN0X3gsIHVpbnQxNl90IGRzdF95LAorICAgICB1aW50
MTZfdCB3aWR0aCwgdWludDE2X3QgaGVpZ2h0KQorCit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9l
eGVjX29iamVjdDIgb2JqWzNdOworCXN0cnVjdCBkcm1faTkxNV9nZW1fcmVsb2NhdGlvbl9lbnRy
eSByZWxvY1syXTsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyIGV4ZWNidWY7CisJ
Y29uc3QgYm9vbCBoYXNfNjRiX3JlbG9jID0gZGV2aWNlLT5nZW4gPj0gODsKKwl1aW50MzJfdCAq
YmF0Y2g7CisJdWludDMyX3QgcGl0Y2g7CisJaW50IGkgPSAwOworCisJaWYgKHNyY194IDwgMCkg
eworCQl3aWR0aCArPSBzcmNfeDsKKwkJZHN0X3ggLT0gc3JjX3g7CisJCXNyY194ICA9IDA7CisJ
fQorCWlmIChzcmNfeSA8IDApIHsKKwkJaGVpZ2h0ICs9IHNyY195OworCQlkc3RfeSAgLT0gc3Jj
X3k7CisJCXNyY195ICAgPSAwOworCX0KKworCWlmIChkc3RfeCA8IDApIHsKKwkJd2lkdGggKz0g
ZHN0X3g7CisJCXNyY194IC09IGRzdF94OworCQlkc3RfeCAgPSAwOworCX0KKwlpZiAoZHN0X3kg
PCAwKSB7CisJCWhlaWdodCArPSBkc3RfeTsKKwkJc3JjX3kgIC09IGRzdF95OworCQlkc3RfeSAg
ID0gMDsKKwl9CisKKwlpZiAoc3JjX3ggKyB3aWR0aCA+IHNyYy0+d2lkdGgpCisJCXdpZHRoID0g
c3JjLT53aWR0aCAtIHNyY194OworCWlmIChkc3RfeCArIHdpZHRoID4gZHN0LT53aWR0aCkKKwkJ
d2lkdGggPSBkc3QtPndpZHRoIC0gZHN0X3g7CisKKwlpZiAoc3JjX3kgKyBoZWlnaHQgPiBzcmMt
PmhlaWdodCkKKwkJaGVpZ2h0ID0gc3JjLT5oZWlnaHQgLSBzcmNfeTsKKwlpZiAoZHN0X3kgKyBo
ZWlnaHQgPiBkc3QtPmhlaWdodCkKKwkJaGVpZ2h0ID0gZHN0LT5oZWlnaHQgLSBkc3RfeTsKKwor
CWlmIChkc3QtPmNhY2hpbmcpIHsKKwkJaWd0X2Fzc2VydChkZXZpY2UtPmdlbiA+PSAzKTsKKwkJ
aWd0X2Fzc2VydChkZXZpY2UtPmxsYyB8fCAhc3JjLT5jYWNoaW5nKTsKKwl9CisKKwltZW1zZXQo
JmV4ZWNidWYsIDAsIHNpemVvZihleGVjYnVmKSk7CisJZXhlY2J1Zi5idWZmZXJzX3B0ciA9IHRv
X3VzZXJfcG9pbnRlcihvYmopOworCWV4ZWNidWYuYnVmZmVyX2NvdW50ID0gQVJSQVlfU0laRShv
YmopOworCWlmIChkZXZpY2UtPmdlbiA+PSA2KQorCQlleGVjYnVmLmZsYWdzID0gSTkxNV9FWEVD
X0JMVDsKKworCW1lbXNldChvYmosIDAsIHNpemVvZihvYmopKTsKKwlvYmpbMF0uaGFuZGxlID0g
ZHN0LT5oYW5kbGU7CisJb2JqWzBdLm9mZnNldCA9IGRzdC0+Z3R0X29mZnNldDsKKwlpZiAoZHN0
LT50aWxpbmcpCisJCW9ialswXS5mbGFncyA9IEVYRUNfT0JKRUNUX05FRURTX0ZFTkNFOworCisJ
b2JqWzFdLmhhbmRsZSA9IHNyYy0+aGFuZGxlOworCW9ialsxXS5vZmZzZXQgPSBzcmMtPmd0dF9v
ZmZzZXQ7CisJaWYgKHNyYy0+dGlsaW5nKQorCQlvYmpbMV0uZmxhZ3MgPSBFWEVDX09CSkVDVF9O
RUVEU19GRU5DRTsKKworCW1lbXNldChyZWxvYywgMCwgc2l6ZW9mKHJlbG9jKSk7CisJb2JqWzJd
LmhhbmRsZSA9IGdlbV9jcmVhdGUoZGV2aWNlLT5mZCwgNDA5Nik7CisJb2JqWzJdLnJlbG9jc19w
dHIgPSB0b191c2VyX3BvaW50ZXIocmVsb2MpOworCW9ialsyXS5yZWxvY2F0aW9uX2NvdW50ID0g
QVJSQVlfU0laRShyZWxvYyk7CisJYmF0Y2ggPSBnZW1fbW1hcF9fY3B1KGRldmljZS0+ZmQsIG9i
alsyXS5oYW5kbGUsIDAsIDQwOTYsIFBST1RfV1JJVEUpOworCisJaWYgKChzcmMtPnRpbGluZyB8
IGRzdC0+dGlsaW5nKSA+PSBJOTE1X1RJTElOR19ZKSB7CisJCXVuc2lnbmVkIGludCBtYXNrOwor
CisJCWJhdGNoW2krK10gPSBNSV9MT0FEX1JFR0lTVEVSX0lNTTsKKwkJYmF0Y2hbaSsrXSA9IEJD
U19TV0NUUkw7CisKKwkJbWFzayA9IChCQ1NfU1JDX1kgfCBCQ1NfRFNUX1kpIDw8IDE2OworCQlp
ZiAoc3JjLT50aWxpbmcgPT0gSTkxNV9USUxJTkdfWSkKKwkJCW1hc2sgfD0gQkNTX1NSQ19ZOwor
CQlpZiAoZHN0LT50aWxpbmcgPT0gSTkxNV9USUxJTkdfWSkKKwkJCW1hc2sgfD0gQkNTX0RTVF9Z
OworCQliYXRjaFtpKytdID0gbWFzazsKKwl9CisKKwliYXRjaFtpXSA9IChYWV9TUkNfQ09QWV9C
TFRfQ01EIHwKKwkJICAgIFhZX1NSQ19DT1BZX0JMVF9XUklURV9BTFBIQSB8CisJCSAgICBYWV9T
UkNfQ09QWV9CTFRfV1JJVEVfUkdCKTsKKwlpZiAoZGV2aWNlLT5nZW4gPj0gNCAmJiBzcmMtPnRp
bGluZykKKwkJYmF0Y2hbaV0gfD0gWFlfU1JDX0NPUFlfQkxUX1NSQ19USUxFRDsKKwlpZiAoZGV2
aWNlLT5nZW4gPj0gNCAmJiBkc3QtPnRpbGluZykKKwkJYmF0Y2hbaV0gfD0gWFlfU1JDX0NPUFlf
QkxUX0RTVF9USUxFRDsKKwliYXRjaFtpKytdIHw9IDYgKyAyICogaGFzXzY0Yl9yZWxvYzsKKwor
CXBpdGNoID0gZHN0LT5zdHJpZGU7CisJaWYgKGRldmljZS0+Z2VuID49IDQgJiYgZHN0LT50aWxp
bmcpCisJCXBpdGNoIC89IDQ7CisJYmF0Y2hbaSsrXSA9IDMgPDwgMjQgfCAweGNjIDw8IDE2IHwg
cGl0Y2g7CisKKwliYXRjaFtpKytdID0gZHN0X3kgPDwgMTYgfCBkc3RfeDsKKwliYXRjaFtpKytd
ID0gKGhlaWdodCArIGRzdF95KSA8PCAxNiB8ICh3aWR0aCArIGRzdF94KTsKKwlyZWxvY1swXS50
YXJnZXRfaGFuZGxlID0gb2JqWzBdLmhhbmRsZTsKKwlyZWxvY1swXS5wcmVzdW1lZF9vZmZzZXQg
PSBvYmpbMF0ub2Zmc2V0OworCXJlbG9jWzBdLm9mZnNldCA9IHNpemVvZigqYmF0Y2gpICogaTsK
KwlyZWxvY1swXS5yZWFkX2RvbWFpbnMgPSBJOTE1X0dFTV9ET01BSU5fUkVOREVSOworCXJlbG9j
WzBdLndyaXRlX2RvbWFpbiA9IEk5MTVfR0VNX0RPTUFJTl9SRU5ERVI7CisJYmF0Y2hbaSsrXSA9
IG9ialswXS5vZmZzZXQ7CisJaWYgKGhhc182NGJfcmVsb2MpCisJCWJhdGNoW2krK10gPSBvYmpb
MF0ub2Zmc2V0ID4+IDMyOworCisJYmF0Y2hbaSsrXSA9IHNyY195IDw8IDE2IHwgc3JjX3g7CisJ
cGl0Y2ggPSBzcmMtPnN0cmlkZTsKKwlpZiAoZGV2aWNlLT5nZW4gPj0gNCAmJiBzcmMtPnRpbGlu
ZykKKwkJcGl0Y2ggLz0gNDsKKwliYXRjaFtpKytdID0gcGl0Y2g7CisJcmVsb2NbMV0udGFyZ2V0
X2hhbmRsZSA9IG9ialsxXS5oYW5kbGU7CisJcmVsb2NbMV0ucHJlc3VtZWRfb2Zmc2V0ID0gb2Jq
WzFdLm9mZnNldDsKKwlyZWxvY1sxXS5vZmZzZXQgPSBzaXplb2YoKmJhdGNoKSAqIGk7CisJcmVs
b2NbMV0ucmVhZF9kb21haW5zID0gSTkxNV9HRU1fRE9NQUlOX1JFTkRFUjsKKwliYXRjaFtpKytd
ID0gb2JqWzFdLm9mZnNldDsKKwlpZiAoaGFzXzY0Yl9yZWxvYykKKwkJYmF0Y2hbaSsrXSA9IG9i
alsxXS5vZmZzZXQgPj4gMzI7CisKKwlpZiAoKHNyYy0+dGlsaW5nIHwgZHN0LT50aWxpbmcpID49
IEk5MTVfVElMSU5HX1kpIHsKKwkJaWd0X2Fzc2VydChkZXZpY2UtPmdlbiA+PSA2KTsKKwkJYmF0
Y2hbaSsrXSA9IE1JX0ZMVVNIX0RXIHwgMjsKKwkJYmF0Y2hbaSsrXSA9IDA7CisJCWJhdGNoW2kr
K10gPSAwOworCQliYXRjaFtpKytdID0gMDsKKworCQliYXRjaFtpKytdID0gTUlfTE9BRF9SRUdJ
U1RFUl9JTU07CisJCWJhdGNoW2krK10gPSBCQ1NfU1dDVFJMOworCQliYXRjaFtpKytdID0gKEJD
U19TUkNfWSB8IEJDU19EU1RfWSkgPDwgMTY7CisJfQorCisJYmF0Y2hbaSsrXSA9IE1JX0JBVENI
X0JVRkZFUl9FTkQ7CisJbXVubWFwKGJhdGNoLCA0MDk2KTsKKworCWdlbV9leGVjYnVmKGRldmlj
ZS0+ZmQsICZleGVjYnVmKTsKKwlnZW1fY2xvc2UoZGV2aWNlLT5mZCwgb2JqWzJdLmhhbmRsZSk7
CisKKwlkc3QtPmd0dF9vZmZzZXQgPSBvYmpbMF0ub2Zmc2V0OworCXNyYy0+Z3R0X29mZnNldCA9
IG9ialsxXS5vZmZzZXQ7CisKKwltZW1jcHlfYmx0KHNyYy0+bW9kZWwsIGRzdC0+bW9kZWwsCisJ
CSAgIDR1ICogc3JjLT53aWR0aCwgNHUgKiBkc3QtPndpZHRoLAorCQkgICBzcmNfeCwgc3JjX3ks
CisJCSAgIGRzdF94LCBkc3RfeSwKKwkJICAgd2lkdGgsIGhlaWdodCk7Cit9CisKK2VudW0gc3Rh
cnQgeworCVpFUk8sCisJQUJPVkUsCisJQkVMT1cKK307CisKK3N0YXRpYyBpbnQgc3RhcnRfYXQo
aW50IHgsIGVudW0gc3RhcnQgcykKK3sKKwlzd2l0Y2ggKHMpIHsKKwlkZWZhdWx0OgorCWNhc2Ug
WkVSTzoKKwkJcmV0dXJuIDA7CisJY2FzZSBBQk9WRToKKwkJcmV0dXJuIDE7CisJY2FzZSBCRUxP
VzoKKwkJcmV0dXJuIHggLSAxOworCX0KK30KKworaWd0X21haW4KK3sKKwlzdHJ1Y3QgZGV2aWNl
IGRldmljZTsKKworCWlndF9maXh0dXJlIHsKKwkJZGV2aWNlLmZkID0gZHJtX29wZW5fZHJpdmVy
X3JlbmRlcihEUklWRVJfSU5URUwpOworCQlpZ3RfcmVxdWlyZV9nZW0oZGV2aWNlLmZkKTsKKwor
CQlkZXZpY2UucGNpaWQgPSBpbnRlbF9nZXRfZHJtX2RldmlkKGRldmljZS5mZCk7CisJCWRldmlj
ZS5nZW4gPSBpbnRlbF9nZW4oZGV2aWNlLnBjaWlkKTsKKwkJZGV2aWNlLmxsYyA9IGdlbV9oYXNf
bGxjKGRldmljZS5mZCk7CisJfQorCisJaWd0X3N1YnRlc3QoImJhc2ljIikgeworCQlzdHJ1Y3Qg
YnVmZmVyICpzcmMsICpkc3Q7CisJCXVuc2lnbmVkIGludCB4LCB5OworCisJCWZvciAodW5zaWdu
ZWQgaW50IGhlaWdodCA9IDE7IGhlaWdodCA8PSAxNjsgaGVpZ2h0IDw8PSAxKSB7CisJCQlmb3Ig
KHVuc2lnbmVkIGludCB5MCA9IFpFUk87IHkwIDw9IChoZWlnaHQgPiAyID8gQkVMT1cgOiBaRVJP
KTsgeTArKykgeworCQkJCWZvciAodW5zaWduZWQgaW50IHdpZHRoID0gMTsgd2lkdGggPD0gNjQ7
IHdpZHRoIDw8PSAxKSB7CisJCQkJCWZvciAodW5zaWduZWQgaW50IHgwID0gWkVSTzsgeDAgPD0g
KHdpZHRoID4gMiA/IEJFTE9XIDogWkVSTyk7IHgwKyspIHsKKworCQkJCQkJc3JjID0gYnVmZmVy
X2NyZWF0ZSgmZGV2aWNlLAorCQkJCQkJCQkgICAgd2lkdGggKiAxNiwgaGVpZ2h0ICogNCk7CisJ
CQkJCQlkc3QgPSBidWZmZXJfY3JlYXRlKCZkZXZpY2UsCisJCQkJCQkJCSAgICB3aWR0aCAqIDE2
LCBoZWlnaHQgKiA0KTsKKworCQkJCQkJeSA9IHN0YXJ0X2F0KGhlaWdodCwgeTApOworCQkJCQkJ
Zm9yICh1bnNpZ25lZCBpbnQgc3JjX3RpbGluZyA9IEk5MTVfVElMSU5HX05PTkU7CisJCQkJCQkg
ICAgIHNyY190aWxpbmcgPD0gKGRldmljZS5nZW4gPj0gNiA/IEk5MTVfVElMSU5HX1kgOiBJOTE1
X1RJTElOR19YKTsKKwkJCQkJCSAgICAgc3JjX3RpbGluZysrKSB7CisJCQkJCQkJYnVmZmVyX3Nl
dF90aWxpbmcoJmRldmljZSwgc3JjLCBzcmNfdGlsaW5nKTsKKworCQkJCQkJCXggPSBzdGFydF9h
dCh3aWR0aCwgeDApOworCQkJCQkJCWZvciAodW5zaWduZWQgaW50IGRzdF90aWxpbmcgPSBJOTE1
X1RJTElOR19OT05FOworCQkJCQkJCSAgICAgZHN0X3RpbGluZyA8PSAoZGV2aWNlLmdlbiA+PSA2
ID8gSTkxNV9USUxJTkdfWSA6IEk5MTVfVElMSU5HX1gpOworCQkJCQkJCSAgICAgZHN0X3RpbGlu
ZysrKSB7CisJCQkJCQkJCWJ1ZmZlcl9zZXRfdGlsaW5nKCZkZXZpY2UsIGRzdCwgZHN0X3RpbGlu
Zyk7CisKKwkJCQkJCQkJZm9yIChlbnVtIG1vZGUgZG93biA9IENQVTsgZG93biA8PSBXQzsgZG93
bisrKSB7CisJCQkJCQkJCQlpZ3RfZGVidWcoIlRlc3Rpbmcgc3JjX3RpbGluZz0lZCwgZHN0X3Rp
bGluZz0lZCwgZG93bj0lZCBhdCAoJWQsICVkKSB4ICglZCwgJWQpXG4iLAorCQkJCQkJCQkJCSAg
c3JjX3RpbGluZywKKwkJCQkJCQkJCQkgIGRzdF90aWxpbmcsCisJCQkJCQkJCQkJICBkb3duLCB4
LCB5LAorCQkJCQkJCQkJCSAgd2lkdGgsIGhlaWdodCk7CisKKwkJCQkJCQkJCWlndF9hc3NlcnQo
eCArIHdpZHRoIDw9IGRzdC0+d2lkdGgpOworCQkJCQkJCQkJaWd0X2Fzc2VydCh5ICsgaGVpZ2h0
IDw9IGRzdC0+aGVpZ2h0KTsKKworCQkJCQkJCQkJYmxpdCgmZGV2aWNlLAorCQkJCQkJCQkJICAg
ICBzcmMsIHgsIHksCisJCQkJCQkJCQkgICAgIGRzdCwgeCwgeSwKKwkJCQkJCQkJCSAgICAgd2lk
dGgsIGhlaWdodCk7CisJCQkJCQkJCQlpZ3RfYXNzZXJ0KGJ1ZmZlcl9jaGVjaygmZGV2aWNlLCBk
c3QsIGRvd24pKTsKKworCQkJCQkJCQkJeCArPSB3aWR0aDsKKwkJCQkJCQkJfQorCQkJCQkJCX0K
KworCQkJCQkJCXkgKz0gaGVpZ2h0OworCQkJCQkJfQorCisJCQkJCQlidWZmZXJfZnJlZSgmZGV2
aWNlLCBkc3QpOworCQkJCQkJYnVmZmVyX2ZyZWUoJmRldmljZSwgc3JjKTsKKwkJCQkJfQorCQkJ
CX0KKwkJCX0KKwkJfQorCX0KK30KZGlmZiAtLWdpdCBhL3Rlc3RzL21lc29uLmJ1aWxkIGIvdGVz
dHMvbWVzb24uYnVpbGQKaW5kZXggM2YzZWVlMjc3Li45OGYyZGI1NTUgMTAwNjQ0Ci0tLSBhL3Rl
c3RzL21lc29uLmJ1aWxkCisrKyBiL3Rlc3RzL21lc29uLmJ1aWxkCkBAIC0xMDYsNiArMTA2LDcg
QEAgaTkxNV9wcm9ncyA9IFsKIAknZ2VuM19yZW5kZXJfdGlsZWR5X2JsaXRzJywKIAknZ2VtX2Jh
ZF9yZWxvYycsCiAJJ2dlbV9iYXNpYycsCisJJ2dlbV9ibGl0cycsCiAJJ2dlbV9idXN5JywKIAkn
Z2VtX2NhY2hpbmcnLAogCSdnZW1fY2xvc2UnLAotLSAKMi4yNC4wCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0Cklu
dGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

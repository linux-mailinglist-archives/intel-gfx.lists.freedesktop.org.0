Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 849B144B315
	for <lists+intel-gfx@lfdr.de>; Tue,  9 Nov 2021 20:13:41 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B4DD36E0A0;
	Tue,  9 Nov 2021 19:13:39 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga17.intel.com (mga17.intel.com [192.55.52.151])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D44476E0A0
 for <intel-gfx@lists.freedesktop.org>; Tue,  9 Nov 2021 19:13:37 +0000 (UTC)
X-IronPort-AV: E=McAfee;i="6200,9189,10163"; a="213254727"
X-IronPort-AV: E=Sophos;i="5.87,221,1631602800"; d="scan'208";a="213254727"
Received: from orsmga007.jf.intel.com ([10.7.209.58])
 by fmsmga107.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 09 Nov 2021 11:13:37 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.87,221,1631602800"; d="scan'208";a="491781765"
Received: from orsmsx602.amr.corp.intel.com ([10.22.229.15])
 by orsmga007.jf.intel.com with ESMTP; 09 Nov 2021 11:13:36 -0800
Received: from orsmsx612.amr.corp.intel.com (10.22.229.25) by
 ORSMSX602.amr.corp.intel.com (10.22.229.15) with Microsoft SMTP Server
 (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id
 15.1.2242.12; Tue, 9 Nov 2021 11:13:35 -0800
Received: from orsmsx610.amr.corp.intel.com (10.22.229.23) by
 ORSMSX612.amr.corp.intel.com (10.22.229.25) with Microsoft SMTP Server
 (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256) id
 15.1.2242.12; Tue, 9 Nov 2021 11:13:34 -0800
Received: from orsmsx610.amr.corp.intel.com ([10.22.229.23]) by
 ORSMSX610.amr.corp.intel.com ([10.22.229.23]) with mapi id 15.01.2242.012;
 Tue, 9 Nov 2021 11:13:34 -0800
From: "Souza, Jose" <jose.souza@intel.com>
To: "ville.syrjala@linux.intel.com" <ville.syrjala@linux.intel.com>
Thread-Topic: [PATCH v3] drm/i915/display: Exit PSR when doing async flips
Thread-Index: AQHX0B92nRX8l2W6FEaCArnarxX/56vz4H4AgABBIACAAUqUgIAAREKAgAABPgCABnATgA==
Date: Tue, 9 Nov 2021 19:13:34 +0000
Message-ID: <8cd6252fca125547e6d7bd926106e13569b33521.camel@intel.com>
References: <20211102193214.99448-1-jose.souza@intel.com>
 <YYPpysij7Oovwzhx@intel.com>
 <50dd687c006667f95dab06cfbcfbef8a6e193496.camel@intel.com>
 <YYU1u4fu75vdK1PT@intel.com>
 <38902e7a71287702db079f0c0ca5c35eabafa4b4.camel@intel.com>
 <YYVwCOe/xyeOlTSZ@intel.com>
In-Reply-To: <YYVwCOe/xyeOlTSZ@intel.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-originating-ip: [10.1.200.100]
Content-Type: text/plain; charset="utf-8"
Content-ID: <48436A82D572AE47A58CA008300E339D@intel.com>
Content-Transfer-Encoding: base64
MIME-Version: 1.0
Subject: Re: [Intel-gfx] [PATCH v3] drm/i915/display: Exit PSR when doing
 async flips
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: "intel-gfx@lists.freedesktop.org" <intel-gfx@lists.freedesktop.org>
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

T24gRnJpLCAyMDIxLTExLTA1IGF0IDE5OjU1ICswMjAwLCBWaWxsZSBTeXJqw6Rsw6Qgd3JvdGU6
DQo+IE9uIEZyaSwgTm92IDA1LCAyMDIxIGF0IDA1OjQ0OjIxUE0gKzAwMDAsIFNvdXphLCBKb3Nl
IHdyb3RlOg0KPiA+IE9uIEZyaSwgMjAyMS0xMS0wNSBhdCAxNTo0NiArMDIwMCwgVmlsbGUgU3ly
asOkbMOkIHdyb3RlOg0KPiA+ID4gT24gVGh1LCBOb3YgMDQsIDIwMjEgYXQgMDU6NTY6NTJQTSAr
MDAwMCwgU291emEsIEpvc2Ugd3JvdGU6DQo+ID4gPiA+IE9uIFRodSwgMjAyMS0xMS0wNCBhdCAx
NjoxMCArMDIwMCwgVmlsbGUgU3lyasOkbMOkIHdyb3RlOg0KPiA+ID4gPiA+IE9uIFR1ZSwgTm92
IDAyLCAyMDIxIGF0IDEyOjMyOjE0UE0gLTA3MDAsIEpvc8OpIFJvYmVydG8gZGUgU291emEgd3Jv
dGU6DQo+ID4gPiA+ID4gPiBDaGFuZ2luZyB0aGUgYnVmZmVyIGluIHRoZSBtaWRkbGUgb2YgdGhl
IHNjYW5vdXQgdGhlbiBlbnRlcmluZyBhbg0KPiA+ID4gPiA+ID4gcGVyaW9kIG9mIGZsaXAgaWRs
ZW5lc3Mgd2lsbCBjYXVzZSBwYXJ0IG9mIHRoZSBwcmV2aW91cyBidWZmZXIgYmVpbmcNCj4gPiA+
ID4gPiA+IGRpcGxheWVkIHRvIHVzZXIgd2hlbiBQU1IgaXMgZW5hYmxlZC4NCj4gPiA+ID4gPiA+
IA0KPiA+ID4gPiA+ID4gU28gaGVyZSBkaXNhYmxpbmcgUFNSIGFuZCBzY2hlZHVsaW5nIGFjdGl2
YXRpb24gZHVyaW5nIHRoZSBuZXh0DQo+ID4gPiA+ID4gPiBzeW5jIGZsaXAuDQo+ID4gPiA+ID4g
PiANCj4gPiA+ID4gPiA+IFRoZSBhc3luYyBmbGlwIGNoZWNrIHRoYXQgd2UgaGFkIGluIFBTUiBj
b21wdXRlIGlzIG5vdCBleGVjdXRlZCBhdA0KPiA+ID4gPiA+ID4gZXZlcnkgZmxpcCBzbyBpdCB3
YXMgbm90IGRvaW5nIGFueXRoaW5nIHVzZWZ1bCBhbmQgaXMgYWxzbyBiZWluZw0KPiA+ID4gPiA+
ID4gZHJvcHBlZCBoZXJlLg0KPiA+ID4gPiA+ID4gDQo+ID4gPiA+ID4gPiB2MjoNCj4gPiA+ID4g
PiA+IC0gc2NoZWR1bGluZyB0aGUgUFNSIHdvcmsgaW4gX2ludGVsX3Bzcl9wb3N0X3BsYW5lX3Vw
ZGF0ZSgpDQo+ID4gPiA+ID4gPiANCj4gPiA+ID4gPiA+IHYzOg0KPiA+ID4gPiA+ID4gLSBvbmx5
IHJlIGVuYWJsaW5nIFBTUiB3aGVuIGRvaW5nIGEgc3luYyBmbGlwDQo+ID4gPiA+ID4gPiANCj4g
PiA+ID4gPiA+IENjOiBLYXJ0aGlrIEIgUyA8a2FydGhpay5iLnNAaW50ZWwuY29tPg0KPiA+ID4g
PiA+ID4gQ2M6IFZhbmRpdGEgS3Vsa2FybmkgPHZhbmRpdGEua3Vsa2FybmlAaW50ZWwuY29tPg0K
PiA+ID4gPiA+ID4gQ2M6IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBsaW51eC5pbnRl
bC5jb20+DQo+ID4gPiA+ID4gPiBDYzogUm9kcmlnbyBWaXZpIDxyb2RyaWdvLnZpdmlAaW50ZWwu
Y29tPg0KPiA+ID4gPiA+ID4gU2lnbmVkLW9mZi1ieTogSm9zw6kgUm9iZXJ0byBkZSBTb3V6YSA8
am9zZS5zb3V6YUBpbnRlbC5jb20+DQo+ID4gPiA+ID4gPiAtLS0NCj4gPiA+ID4gPiA+ICBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5jIHwgMzcgKysrKysrKysrKysrKyst
LS0tLS0tLS0tDQo+ID4gPiA+ID4gPiAgMSBmaWxlIGNoYW5nZWQsIDIxIGluc2VydGlvbnMoKyks
IDE2IGRlbGV0aW9ucygtKQ0KPiA+ID4gPiA+ID4gDQo+ID4gPiA+ID4gPiBkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmMNCj4gPiA+ID4gPiA+IGluZGV4IDlkNTg5ZDQ3MWUz
MzUuLmI4ZmFjNTNkNTdkZjEgMTAwNjQ0DQo+ID4gPiA+ID4gPiAtLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5jDQo+ID4gPiA+ID4gPiArKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5jDQo+ID4gPiA+ID4gPiBAQCAtNzMxLDEyICs3
MzEsNiBAQCBzdGF0aWMgYm9vbCBpbnRlbF9wc3IyX3NlbF9mZXRjaF9jb25maWdfdmFsaWQoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCwNCj4gPiA+ID4gPiA+ICAJCXJldHVybiBmYWxzZTsNCj4g
PiA+ID4gPiA+ICAJfQ0KPiA+ID4gPiA+ID4gIA0KPiA+ID4gPiA+ID4gLQlpZiAoY3J0Y19zdGF0
ZS0+dWFwaS5hc3luY19mbGlwKSB7DQo+ID4gPiA+ID4gPiAtCQlkcm1fZGJnX2ttcygmZGV2X3By
aXYtPmRybSwNCj4gPiA+ID4gPiA+IC0JCQkgICAgIlBTUjIgc2VsIGZldGNoIG5vdCBlbmFibGVk
LCBhc3luYyBmbGlwIGVuYWJsZWRcbiIpOw0KPiA+ID4gPiA+ID4gLQkJcmV0dXJuIGZhbHNlOw0K
PiA+ID4gPiA+ID4gLQl9DQo+ID4gPiA+ID4gPiAtDQo+ID4gPiA+ID4gPiAgCS8qIFdhXzE0MDEw
MjU0MTg1IFdhXzE0MDEwMTAzNzkyICovDQo+ID4gPiA+ID4gPiAgCWlmIChJU19UR0xfRElTUExB
WV9TVEVQKGRldl9wcml2LCBTVEVQX0EwLCBTVEVQX0MwKSkgew0KPiA+ID4gPiA+ID4gIAkJZHJt
X2RiZ19rbXMoJmRldl9wcml2LT5kcm0sDQo+ID4gPiA+ID4gPiBAQCAtMTc4MCwzNiArMTc3NCw0
NyBAQCB2b2lkIGludGVsX3Bzcl9wcmVfcGxhbmVfdXBkYXRlKHN0cnVjdCBpbnRlbF9hdG9taWNf
c3RhdGUgKnN0YXRlLA0KPiA+ID4gPiA+ID4gIAkJaWYgKHBzci0+ZW5hYmxlZCAmJiBuZWVkc190
b19kaXNhYmxlKQ0KPiA+ID4gPiA+ID4gIAkJCWludGVsX3Bzcl9kaXNhYmxlX2xvY2tlZChpbnRl
bF9kcCk7DQo+ID4gPiA+ID4gPiAgDQo+ID4gPiA+ID4gPiArCQlpZiAocHNyLT5lbmFibGVkICYm
IGNydGNfc3RhdGUtPnVhcGkuYXN5bmNfZmxpcCkNCj4gPiA+ID4gPiA+ICsJCQlpbnRlbF9wc3Jf
ZXhpdChpbnRlbF9kcCk7DQo+ID4gPiA+ID4gPiArDQo+ID4gPiA+ID4gPiAgCQltdXRleF91bmxv
Y2soJnBzci0+bG9jayk7DQo+ID4gPiA+ID4gPiAgCX0NCj4gPiA+ID4gPiA+ICB9DQo+ID4gPiA+
ID4gPiAgDQo+ID4gPiA+ID4gPiAgc3RhdGljIHZvaWQgX2ludGVsX3Bzcl9wb3N0X3BsYW5lX3Vw
ZGF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwNCj4gPiA+ID4gPiA+
IC0JCQkJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkNCj4gPiA+
ID4gPiA+ICsJCQkJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3Rh
dGUsDQo+ID4gPiA+ID4gPiArCQkJCQkgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5l
d19jcnRjX3N0YXRlKQ0KPiA+ID4gPiA+IA0KPiA+ID4gPiA+IE1pZ2h0IG1ha2Ugc2Vuc2UgdG8g
Y2hhbmdlIHRoaXMgdG8gbWF0Y2ggaG93IHBzcl9wcmVfcGxhbmVfdXBkYXRlKCkNCj4gPiA+ID4g
PiB3b3JrcyB0aGVzZSBkYXlzLg0KPiA+ID4gPiANCj4gPiA+ID4gV2lsbCBkbyBhcyBmb2xsb3cg
dXAuDQo+ID4gPiA+IA0KPiA+ID4gPiA+IA0KPiA+ID4gPiA+ID4gIHsNCj4gPiA+ID4gPiA+ICAJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5k
ZXYpOw0KPiA+ID4gPiA+ID4gIAlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsNCj4gPiA+
ID4gPiA+ICANCj4gPiA+ID4gPiA+IC0JaWYgKCFjcnRjX3N0YXRlLT5oYXNfcHNyKQ0KPiA+ID4g
PiA+ID4gKwlpZiAoIW5ld19jcnRjX3N0YXRlLT5oYXNfcHNyKQ0KPiA+ID4gPiA+ID4gIAkJcmV0
dXJuOw0KPiA+ID4gPiA+ID4gIA0KPiA+ID4gPiA+ID4gIAlmb3JfZWFjaF9pbnRlbF9lbmNvZGVy
X21hc2tfd2l0aF9wc3Ioc3RhdGUtPmJhc2UuZGV2LCBlbmNvZGVyLA0KPiA+ID4gPiA+ID4gLQkJ
CQkJICAgICBjcnRjX3N0YXRlLT51YXBpLmVuY29kZXJfbWFzaykgew0KPiA+ID4gPiA+ID4gKwkJ
CQkJICAgICBuZXdfY3J0Y19zdGF0ZS0+dWFwaS5lbmNvZGVyX21hc2spIHsNCj4gPiA+ID4gPiA+
ICAJCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5jb2Rlcik7
DQo+ID4gPiA+ID4gPiAgCQlzdHJ1Y3QgaW50ZWxfcHNyICpwc3IgPSAmaW50ZWxfZHAtPnBzcjsN
Cj4gPiA+ID4gPiA+ICANCj4gPiA+ID4gPiA+ICAJCW11dGV4X2xvY2soJnBzci0+bG9jayk7DQo+
ID4gPiA+ID4gPiAgDQo+ID4gPiA+ID4gPiAtCQlkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwg
cHNyLT5lbmFibGVkICYmICFjcnRjX3N0YXRlLT5hY3RpdmVfcGxhbmVzKTsNCj4gPiA+ID4gPiA+
ICsJCWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCBwc3ItPmVuYWJsZWQgJiYNCj4gPiA+ID4g
PiA+ICsJCQkgICAgIW5ld19jcnRjX3N0YXRlLT5hY3RpdmVfcGxhbmVzKTsNCj4gPiA+ID4gPiA+
ICANCj4gPiA+ID4gPiA+ICAJCS8qIE9ubHkgZW5hYmxlIGlmIHRoZXJlIGlzIGFjdGl2ZSBwbGFu
ZXMgKi8NCj4gPiA+ID4gPiA+IC0JCWlmICghcHNyLT5lbmFibGVkICYmIGNydGNfc3RhdGUtPmFj
dGl2ZV9wbGFuZXMpDQo+ID4gPiA+ID4gPiAtCQkJaW50ZWxfcHNyX2VuYWJsZV9sb2NrZWQoaW50
ZWxfZHAsIGNydGNfc3RhdGUpOw0KPiA+ID4gPiA+ID4gKwkJaWYgKCFwc3ItPmVuYWJsZWQgJiYg
bmV3X2NydGNfc3RhdGUtPmFjdGl2ZV9wbGFuZXMpDQo+ID4gPiA+ID4gPiArCQkJaW50ZWxfcHNy
X2VuYWJsZV9sb2NrZWQoaW50ZWxfZHAsIG5ld19jcnRjX3N0YXRlKTsNCj4gPiA+ID4gPiANCj4g
PiA+ID4gPiBXaGF0IHByZXZlbnRzIHRoaXMgZ3V5IGZyb20gYWN0aXZhdGluZyBQU1Igd2hpbGUg
d2UncmUgZG9pbmcNCj4gPiA+ID4gPiBhbiBhc3luYyBmbGlwPw0KPiA+ID4gPiANCj4gPiA+ID4g
ZW5hYmxlZCAhPSBhY3RpdmUsIHdoZW4gZG9pbmcgYSBhc3luYyBmbGlwIGl0IHdpbGwgc2V0IGFj
dGl2ZSA9IGZhbHNlIGJ1dCBlbmFibGVkIHdpbGwgYmUga2VwdCBvbi4NCj4gPiA+IA0KPiA+ID4g
aW50ZWxfcHNyX2VuYWJsZV9sb2NrZWQoKSBjYWxscyBpbnRlbF9wc3JfYWN0aXZhdGUoKSB1bmNv
ZGl0aW9uYWxseS4NCj4gPiA+IFRoZXJlIGlzIG5vIGFjdGl2ZT1mYWxzZSB0aGluZyBhbnl3aGVy
ZSB0aGF0IEkgY2FuIHNlZS4NCj4gPiA+IA0KPiA+ID4gPiANCj4gPiA+ID4gQW5kIHRvIGNoYW5n
ZSB0aGUgbnVtYmVyIG9mIGFjdGl2ZV9wbGFuZXMgaXQgd2lsbCBuZWVkIHRvIGRvIGEgc3luYyBm
bGlwLCBzbyB3ZSBhcmUgc2FmZS4NCj4gPiA+IA0KPiA+ID4gV2h5IHdvdWxkIHRoZSBudW1iZXIg
b2YgYWN0aXZlIHBsYW5lcyBuZWVkIHRvIGNoYW5nZSBmb3IgdGhpcw0KPiA+ID4gdG8gZ2V0IGNh
bGxlZD8NCj4gPiANCj4gPiBJZiBDUlRDIGlzIGxlZnQgb24gYnV0IHRoZSBudW1iZXIgb2YgcGxh
bmVzIGdvZXMgdG8gMCwgUFNSIGlzIGRpc2FibGVkLg0KPiA+IFRoZW4gaXQgaXMgZW5hYmxlZCBh
Z2FpbiBpZiB0aGUgbnVtYmVyIG9mIHBsYW5lcyBnb2VzIHRvIDEgb3IgbW9yZS4NCj4gPiANCj4g
PiA+IA0KPiA+ID4gSSBndWVzcyBtYXliZSB0aGVyZSdzIHNvbWUgcmVhc29uIHdoeSB0aGlzIGNh
bid0IGhhcHBlbiBidXQgaXQgaXMNCj4gPiA+IGVudGlyZWx5IG5vbi1vYnZpb3VzIHdoZW4gcmVh
ZGluZyB0aGlzIGNvZGUuIEFsc28gc2VlbXMgcHJldHR5DQo+ID4gPiBmcmFnaWxlIGlmIHNvbWUg
b3RoZXIgY29kZSBub3cgY2hhbmdlcyBhbmQgc3VkZGVubHkgY2F1c2VzIHRoaXMNCj4gPiA+IHRv
IGdldCBjYWxsZWQuIEluIGZhY3QgZnJvbSB0aGUgbG9va3Mgb2YgdGhpbmdzIHRoZSBvbmx5IHRo
aW5nDQo+ID4gPiBuZWVkZWQgd291bGQgYmUgZm9yIHNvbWVvbmUgdG8gY2FsbCBpbnRlbF9wc3Jf
ZGlzYWJsZV9sb2NrZWQoKQ0KPiA+ID4gc28gdGhhdCBwc3ItPmVuYWJsZWQgZ2V0cyBjbGVhcmVk
Lg0KPiA+IA0KPiA+IElmIHNvbWVvbmUgY2FsbHMgaW50ZWxfcHNyX2Rpc2FibGVfbG9ja2VkKCkg
dGhlbiBpbiB0aGUgbmV4dCBmbGlwIHRoZSBjb2RlIGFib3ZlIHdpbGwgaW5kZWVkIGVuYWJsZSBp
dCBhZ2FpbiBidXQgYXMgUFNSIHRha2VzIGF0IGxlYXN0IDIgZnJhbWVzIHRvDQo+ID4gYWN0dWFs
bHkgYWN0aXZhdGUgYWZ0ZXIgcmVnaXN0ZXJzIGFyZSBwcm9ncmFtbWVkLCB3ZSBhcmUgc2FmZS4g
KHNlZSBQU1IyIEVEUF9QU1IyX0ZSQU1FX0JFRk9SRV9TVSBhbmQgUFNSMSBwc3JfY29tcHV0ZV9p
ZGxlX2ZyYW1lcygpKQ0KPiA+IA0KPiA+IFRoZW4gb24gdGhlIG5leHQgYXN5bmMgZmxpcCwgaXQg
d2lsbCBleGl0ZWQgYWdhaW4gYW5kIGFjdGl2ZSBzZXQgdG8gZmFsc2UuDQo+ID4gDQo+ID4gPiAN
Cj4gPiA+IEkgbWlnaHQgc3VnZ2VzdCBhZGRpbmcgY3J0Y19zdGF0ZS0+cHNyX2FjdGl2ZSBvciBz
b2VtdGhpbmcgYWxvbmcNCj4gPiA+IHRob3NlIGxpbmVzIHRvIG1ha2UgaXQgb2J2aW91cyB3aGVu
IHdlIHdhbnQgdG8gaGF2ZSBwc3IgbG9naWNhbGx5DQo+ID4gPiBlbmFibGVkLCBidXQgYWN0dWFs
bHkgaW5hY3RpdmUuDQo+ID4gDQo+ID4gQmVjYXVzZSBvZiB0aGUgaW52YWxpZGF0ZSBmcm9udGJ1
ZmZlciByZW5kZXJpbmcgY2FzZXMsIHdlIGNhbid0IGtlZXAgUFNSIHN0YXR1cyBpbiBhdG9taWMg
c3RhdGUuDQo+IA0KPiBOb3QgZnVsbHkuIEJ1dCBpdCBzaG91bGRuJ3QgcHJldmVudCB1cyBmcm9t
IGhhdmluZyBzb21ldGhpbmcgdGhlcmUgYXMNCj4gd2VsbC4gU28gaWYgY3J0Y19zdGF0ZSBzYXlz
IHRvIG5vdCBhY3RpdmF0ZSBQU1IgdGhlbiBkb24ndCwgb3RoZXJ3aXNlDQo+IGxldCBpdCBhY3Rp
dmF0ZS9kZWFjdGl2ZSBhcyBuZWVkZWQgYmFzZWQgb24gZnJvbnRidWZmZXIgYWN0aXZpdHkuDQo+
IA0KPiBBVE0gaXQgc2VlbXMgdG8gYmUga2luZCBvZiBhZC1ob2Mgd2hlbiB3ZSBmdWxseSBkaXNh
YmxlIHZzLiBqdXN0DQo+IGRlYWN0aXZhdGUgUFNSLiBEdW5ubyBob3cgZmVhc2libGUgaXQgd291
bGQgYmUgdG8gbWFrZSB0aGF0IGVpdGhlcjoNCj4gYSkgbG9naWNhbGx5IGVuYWJsZS9kaXNhYmxl
IFBTUiBvbmx5IGR1cmluZyBmdWxsIG1vZGVzZXRzLCBhbmQNCj4gICAgb3RoZXJ3aXNlIGp1c3Qg
YWN0aXZhdGUvZGVhY3RpdmF0ZSBhcyBuZWVkZWQgd2hldGhlciBpdCBiZSBkdWUgdG8NCj4gICAg
c3R1ZmYgd2UgY2FuIGNhbGN1bGF0ZSBiYXNlZCBvbiBjcnRjX3N0YXRlIChlZy4gYWN0aXZlX3Bs
YW5lcyBvcg0KPiAgICBhc3luY19mbGlwKSBvciBmcm9udGJ1ZmZlciBhY3Rpdml0eQ0KPiBvcg0K
PiBiKSBhbHdheXMgbG9naWNhbGx5IGVuYWJsZS9kaXNhYmxlIFBTUiBiYXNlZCBvbiBzdHVmZiB3
ZSBjYW4gY2FsY3VsYXRlDQo+ICAgIGZyb20gdGhlIGNydGMgc3RhdGUsIGFuZCBsZWF2ZSB0aGUg
YWN0aXZhdGUvZGVhY3RpdmF0ZSBzdHVmZiB0byBvbmx5DQo+ICAgIGZyb250YnVmZmVyIHJlbmRl
cmluZyBhY3Rpdml0eQ0KPiANCg0KU29tZXRoaW5nIGxpa2UgdGhpcyBmb3IgYSk/DQoNCg0Kdm9p
ZCBpbnRlbF9wc3JfcHJlX3BsYW5lX3VwZGF0ZShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpz
dGF0ZSwNCgkJCQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykNCnsNCglzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoc3RhdGUtPmJhc2UuZGV2KTsNCgljb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSA9DQoJCWludGVsX2F0b21pY19nZXRfbmV3X2Ny
dGNfc3RhdGUoc3RhdGUsIGNydGMpOw0KCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyOw0K
DQoJaWYgKCFIQVNfUFNSKGk5MTUpKQ0KCQlyZXR1cm47DQoNCglmb3JfZWFjaF9pbnRlbF9lbmNv
ZGVyX21hc2tfd2l0aF9wc3Ioc3RhdGUtPmJhc2UuZGV2LCBlbmNvZGVyLA0KCQkJCQkgICAgIGNy
dGNfc3RhdGUtPnVhcGkuZW5jb2Rlcl9tYXNrKSB7DQoJCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5jb2Rlcik7DQoJCXN0cnVjdCBpbnRlbF9wc3IgKnBzciA9
ICZpbnRlbF9kcC0+cHNyOw0KCQlib29sIG5lZWRzX3RvX2Rpc2FibGUgPSBmYWxzZTsNCgkJYm9v
bCBuZWVkc190b19leGl0ID0gZmFsc2U7DQoNCgkJbXV0ZXhfbG9jaygmcHNyLT5sb2NrKTsNCg0K
CQkvKg0KCQkgKiBSZWFzb25zIHRvIGRpc2FibGU6DQoJCSAqIC0gUFNSIGRpc2FibGVkIGluIG5l
dyBzdGF0ZQ0KCQkgKiAtIENoYW5naW5nIGJldHdlZW4gUFNSIHZlcnNpb25zDQoJCSAqLw0KCQlu
ZWVkc190b19kaXNhYmxlIHw9IGludGVsX2NydGNfbmVlZHNfbW9kZXNldChjcnRjX3N0YXRlKTsN
CgkJbmVlZHNfdG9fZGlzYWJsZSB8PSAhY3J0Y19zdGF0ZS0+aGFzX3BzcjsNCgkJbmVlZHNfdG9f
ZGlzYWJsZSB8PSBjcnRjX3N0YXRlLT5oYXNfcHNyMiAhPSBwc3ItPnBzcjJfZW5hYmxlZDsNCgkJ
aWYgKHBzci0+ZW5hYmxlZCAmJiBuZWVkc190b19kaXNhYmxlKQ0KCQkJaW50ZWxfcHNyX2Rpc2Fi
bGVfbG9ja2VkKGludGVsX2RwKTsNCg0KCQluZWVkc190b19leGl0IHw9IGNydGNfc3RhdGUtPnVh
cGkuYXN5bmNfZmxpcDsNCgkJbmVlZHNfdG9fZXhpdCB8PSBjcnRjX3N0YXRlLT5hY3RpdmVfcGxh
bmVzID09IDA7DQoJCWlmIChwc3ItPmVuYWJsZWQgJiYgbmVlZHNfdG9fZXhpdCkNCgkJCWludGVs
X3Bzcl9leGl0KGludGVsX2RwKTsNCg0KCQltdXRleF91bmxvY2soJnBzci0+bG9jayk7DQoJfQ0K
fQ0KDQpzdGF0aWMgdm9pZCBfaW50ZWxfcHNyX3Bvc3RfcGxhbmVfdXBkYXRlKGNvbnN0IHN0cnVj
dCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLA0KCQkJCQkgY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlLA0KCQkJCQkgY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKm5ld19jcnRjX3N0YXRlKQ0Kew0KCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
Ow0KDQoJaWYgKCFuZXdfY3J0Y19zdGF0ZS0+aGFzX3BzcikNCgkJcmV0dXJuOw0KDQoJZm9yX2Vh
Y2hfaW50ZWxfZW5jb2Rlcl9tYXNrX3dpdGhfcHNyKHN0YXRlLT5iYXNlLmRldiwgZW5jb2RlciwN
CgkJCQkJICAgICBuZXdfY3J0Y19zdGF0ZS0+dWFwaS5lbmNvZGVyX21hc2spIHsNCgkJc3RydWN0
IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcChlbmNvZGVyKTsNCgkJc3RydWN0
IGludGVsX3BzciAqcHNyID0gJmludGVsX2RwLT5wc3I7DQoJCWJvb2wgY2FuX2FjdGl2YXRlID0g
dHJ1ZTsNCg0KCQltdXRleF9sb2NrKCZwc3ItPmxvY2spOw0KDQoJCS8qIE9ubHkgZW5hYmxlIGlm
IHRoZXJlIGlzIGFjdGl2ZSBwbGFuZXMgKi8NCgkJaWYgKG5ld19jcnRjX3N0YXRlLT51YXBpLmFz
eW5jX2ZsaXAgfHwNCgkJICAgIG5ld19jcnRjX3N0YXRlLT5hY3RpdmVfcGxhbmVzID09IDAgfHwN
CgkJICAgIHBzci0+c2lua19ub3RfcmVsaWFibGUpDQoJCQljYW5fYWN0aXZhdGUgPSBmYWxzZTsN
Cg0KCQlpZiAoIXBzci0+ZW5hYmxlZCAmJiBjYW5fYWN0aXZhdGUpDQoJCQlpbnRlbF9wc3JfZW5h
YmxlX2xvY2tlZChpbnRlbF9kcCwgbmV3X2NydGNfc3RhdGUpOw0KDQoJCWlmIChwc3ItPmVuYWJs
ZWQgJiYgIXBzci0+YWN0aXZlICYmIGNhbl9hY3RpdmF0ZSkNCgkJCWludGVsX3Bzcl9hY3RpdmF0
ZShpbnRlbF9kcCk7DQoNCgkJLyogRm9yY2UgYSBQU1IgZXhpdCB3aGVuIGVuYWJsaW5nIENSQyB0
byBhdm9pZCBDUkMgdGltZW91dHMgKi8NCgkJaWYgKG5ld19jcnRjX3N0YXRlLT5jcmNfZW5hYmxl
ZCAmJiBwc3ItPmVuYWJsZWQpDQoJCQlwc3JfZm9yY2VfaHdfdHJhY2tpbmdfZXhpdChpbnRlbF9k
cCk7DQoNCgkJbXV0ZXhfdW5sb2NrKCZwc3ItPmxvY2spOw0KCX0NCn0NCg0KPiBBbHRob3VnaCB0
aGVyZSBpcyBhbHNvIHRoZSBBVVggdnMuIFBTUiBjYXNlIHRvIGNvbnNpZGVyLCBidXQgbG9va3Mg
bGlrZQ0KPiB0aGF0IGlzIHN0aWxsIG5vdCBmaXhlZC4NCj4gDQoNCg==

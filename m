Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0AF5F6ABBD
	for <lists+intel-gfx@lfdr.de>; Tue, 16 Jul 2019 17:28:45 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0200B6E13B;
	Tue, 16 Jul 2019 15:28:43 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga09.intel.com (mga09.intel.com [134.134.136.24])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7EF836E13B
 for <intel-gfx@lists.freedesktop.org>; Tue, 16 Jul 2019 15:28:42 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga002.fm.intel.com ([10.253.24.26])
 by orsmga102.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 16 Jul 2019 08:28:41 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,498,1557212400"; d="scan'208";a="194921235"
Received: from unknown (HELO abj-mbp2.local) ([10.249.254.172])
 by fmsmga002.fm.intel.com with ESMTP; 16 Jul 2019 08:28:34 -0700
To: Chris Wilson <chris@chris-wilson.co.uk>, intel-gfx@lists.freedesktop.org
References: <20190712112725.2892-1-chris@chris-wilson.co.uk>
 <20190712112725.2892-4-chris@chris-wilson.co.uk>
From: Abdiel Janulgue <abdiel.janulgue@linux.intel.com>
Message-ID: <a1442834-9ebc-c1b7-2b02-89f4d121ad5f@linux.intel.com>
Date: Tue, 16 Jul 2019 18:28:32 +0300
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:60.0)
 Gecko/20100101 Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <20190712112725.2892-4-chris@chris-wilson.co.uk>
Content-Language: en-US
Subject: Re: [Intel-gfx] [PATCH 3/4] drm/i915/gtt: Recursive ppgtt alloc for
 gen8
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

CgpPbiAxMi8wNy8yMDE5IDE0LjI3LCBDaHJpcyBXaWxzb24gd3JvdGU6Cj4gUmVmYWN0b3IgdGhl
IHNlcGFyYXRlIGFsbG9jYXRpb24gcm91dGluZXMgaW50byBhIHNpbmdsZSByZWN1cnNpdmUKPiBm
dW5jdGlvbi4KPiAKClJldmlld2VkLWJ5OiBBYmRpZWwgSmFudWxndWUgPGFiZGllbC5qYW51bGd1
ZUBsaW51eC5pbnRlbC5jb20+Cgo+IFNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNA
Y2hyaXMtd2lsc29uLmNvLnVrPgo+IC0tLQo+ICBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dl
bV9ndHQuYyB8IDI3MiArKysrKysrKysrLS0tLS0tLS0tLS0tLS0tLS0tCj4gIDEgZmlsZSBjaGFu
Z2VkLCA5NyBpbnNlcnRpb25zKCspLCAxNzUgZGVsZXRpb25zKC0pCj4gCj4gZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW1fZ3R0LmMKPiBpbmRleCA3YjJmMzE4OGQ0MzUuLjcyZTBmOTc5OWE0NiAxMDA2
NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwo+ICsrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCj4gQEAgLTEwMDcsMTk5ICsxMDA3LDEx
OSBAQCBzdGF0aWMgdm9pZCBnZW44X3BwZ3R0X2NsZWFyKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3Bh
Y2UgKnZtLAo+ICAJCQkgICBzdGFydCwgc3RhcnQgKyBsZW5ndGgsIHZtLT50b3ApOwo+ICB9Cj4g
IAo+IC1zdGF0aWMgdm9pZCBnZW44X3BwZ3R0X2NsZWFyX3BkKHN0cnVjdCBpOTE1X2FkZHJlc3Nf
c3BhY2UgKnZtLAo+IC0JCQkJc3RydWN0IGk5MTVfcGFnZV9kaXJlY3RvcnkgKnBkLAo+IC0JCQkJ
dTY0IHN0YXJ0LCB1NjQgbGVuZ3RoKQo+IC17Cj4gLQlHRU1fQlVHX09OKCFJU19BTElHTkVEKHN0
YXJ0LCBCSVRfVUxMKEdFTjhfUFRFX1NISUZUKSkpOwo+IC0JR0VNX0JVR19PTighSVNfQUxJR05F
RChsZW5ndGgsIEJJVF9VTEwoR0VOOF9QVEVfU0hJRlQpKSk7Cj4gLQo+IC0Jc3RhcnQgPj49IEdF
TjhfUFRFX1NISUZUOwo+IC0JbGVuZ3RoID4+PSBHRU44X1BURV9TSElGVDsKPiAtCj4gLQlfX2dl
bjhfcHBndHRfY2xlYXIodm0sIHBkLCBzdGFydCwgc3RhcnQgKyBsZW5ndGgsIDEpOwo+IC19Cj4g
LQo+IC1zdGF0aWMgdm9pZCBnZW44X3BwZ3R0X2NsZWFyX3BkcChzdHJ1Y3QgaTkxNV9hZGRyZXNz
X3NwYWNlICp2bSwKPiAtCQkJCSBzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVjdG9yeSAqIGNvbnN0IHBk
cCwKPiAtCQkJCSB1NjQgc3RhcnQsIHU2NCBsZW5ndGgpCj4gLXsKPiAtCUdFTV9CVUdfT04oIUlT
X0FMSUdORUQoc3RhcnQsIEJJVF9VTEwoR0VOOF9QVEVfU0hJRlQpKSk7Cj4gLQlHRU1fQlVHX09O
KCFJU19BTElHTkVEKGxlbmd0aCwgQklUX1VMTChHRU44X1BURV9TSElGVCkpKTsKPiAtCj4gLQlz
dGFydCA+Pj0gR0VOOF9QVEVfU0hJRlQ7Cj4gLQlsZW5ndGggPj49IEdFTjhfUFRFX1NISUZUOwo+
IC0KPiAtCV9fZ2VuOF9wcGd0dF9jbGVhcih2bSwgcGRwLCBzdGFydCwgc3RhcnQgKyBsZW5ndGgs
IDIpOwo+IC19Cj4gLQo+IC1zdGF0aWMgaW50IGdlbjhfcHBndHRfYWxsb2NfcGQoc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqdm0sCj4gLQkJCSAgICAgICBzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVj
dG9yeSAqcGQsCj4gLQkJCSAgICAgICB1NjQgc3RhcnQsIHU2NCBsZW5ndGgpCj4gK3N0YXRpYyBp
bnQgX19nZW44X3BwZ3R0X2FsbG9jKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKiBjb25zdCB2
bSwKPiArCQkJICAgICAgc3RydWN0IGk5MTVfcGFnZV9kaXJlY3RvcnkgKiBjb25zdCBwZCwKPiAr
CQkJICAgICAgdTY0ICogY29uc3Qgc3RhcnQsIHU2NCBlbmQsIGludCBsdmwpCj4gIHsKPiAtCXN0
cnVjdCBpOTE1X3BhZ2VfdGFibGUgKnB0LCAqYWxsb2MgPSBOVUxMOwo+IC0JdTY0IGZyb20gPSBz
dGFydDsKPiAtCXVuc2lnbmVkIGludCBwZGU7Cj4gKwljb25zdCBzdHJ1Y3QgaTkxNV9wYWdlX3Nj
cmF0Y2ggKiBjb25zdCBzY3JhdGNoID0gJnZtLT5zY3JhdGNoW2x2bF07Cj4gKwlzdHJ1Y3QgaTkx
NV9wYWdlX3RhYmxlICphbGxvYyA9IE5VTEw7Cj4gKwl1bnNpZ25lZCBpbnQgaWR4LCBsZW47Cj4g
IAlpbnQgcmV0ID0gMDsKPiAgCj4gKwlsZW4gPSBnZW44X3BkX3JhbmdlKCpzdGFydCwgZW5kLCBs
dmwtLSwgJmlkeCk7Cj4gKwlEQkcoIiVzKCVwKTp7bHZsOiVkLCBzdGFydDolbGx4LCBlbmQ6JWxs
eCwgaWR4OiVkLCBsZW46JWQsIHVzZWQ6JWR9XG4iLAo+ICsJICAgIF9fZnVuY19fLCB2bSwgbHZs
ICsgMSwgKnN0YXJ0LCBlbmQsCj4gKwkgICAgaWR4LCBsZW4sIGF0b21pY19yZWFkKHB4X3VzZWQo
cGQpKSk7Cj4gKwlHRU1fQlVHX09OKCFsZW4gfHwgKGlkeCArIGxlbiAtIDEpID4+IGdlbjhfcGRf
c2hpZnQoMSkpOwo+ICsKPiAgCXNwaW5fbG9jaygmcGQtPmxvY2spOwo+IC0JZ2VuOF9mb3JfZWFj
aF9wZGUocHQsIHBkLCBzdGFydCwgbGVuZ3RoLCBwZGUpIHsKPiAtCQljb25zdCBpbnQgY291bnQg
PSBnZW44X3B0ZV9jb3VudChzdGFydCwgbGVuZ3RoKTsKPiArCUdFTV9CVUdfT04oIWF0b21pY19y
ZWFkKHB4X3VzZWQocGQpKSk7IC8qIE11c3QgYmUgcGlubmVkISAqLwo+ICsJZG8gewo+ICsJCXN0
cnVjdCBpOTE1X3BhZ2VfdGFibGUgKnB0ID0gcGQtPmVudHJ5W2lkeF07Cj4gIAo+ICAJCWlmICgh
cHQpIHsKPiAgCQkJc3Bpbl91bmxvY2soJnBkLT5sb2NrKTsKPiAgCj4gLQkJCXB0ID0gZmV0Y2hf
YW5kX3plcm8oJmFsbG9jKTsKPiAtCQkJaWYgKCFwdCkKPiAtCQkJCXB0ID0gYWxsb2NfcHQodm0p
Owo+IC0JCQlpZiAoSVNfRVJSKHB0KSkgewo+IC0JCQkJcmV0ID0gUFRSX0VSUihwdCk7Cj4gLQkJ
CQlnb3RvIHVud2luZDsKPiAtCQkJfQo+ICsJCQlEQkcoIiVzKCVwKTp7IGx2bDolZCwgaWR4OiVk
IH0gYWxsb2NhdGluZyBuZXcgdHJlZVxuIiwKPiArCQkJICAgIF9fZnVuY19fLCB2bSwgbHZsICsg
MSwgaWR4KTsKPiAgCj4gLQkJCWlmIChjb3VudCA8IEdFTjhfUFRFUyB8fCBpbnRlbF92Z3B1X2Fj
dGl2ZSh2bS0+aTkxNSkpCj4gLQkJCQlmaWxsX3B4KHB0LCB2bS0+c2NyYXRjaFswXS5lbmNvZGUp
Owo+ICsJCQlwdCA9IGZldGNoX2FuZF96ZXJvKCZhbGxvYyk7Cj4gKwkJCWlmIChsdmwpIHsKPiAr
CQkJCWlmICghcHQpIHsKPiArCQkJCQlwdCA9ICZhbGxvY19wZCh2bSktPnB0Owo+ICsJCQkJCWlm
IChJU19FUlIocHQpKSB7Cj4gKwkJCQkJCXJldCA9IFBUUl9FUlIocHQpOwo+ICsJCQkJCQlnb3Rv
IG91dDsKPiArCQkJCQl9Cj4gKwkJCQl9Cj4gIAo+IC0JCQlzcGluX2xvY2soJnBkLT5sb2NrKTsK
PiAtCQkJaWYgKCFwZC0+ZW50cnlbcGRlXSkgewo+IC0JCQkJc2V0X3BkX2VudHJ5KHBkLCBwZGUs
IHB0KTsKPiArCQkJCWZpbGxfcHgocHQsIHZtLT5zY3JhdGNoW2x2bF0uZW5jb2RlKTsKPiAgCQkJ
fSBlbHNlIHsKPiAtCQkJCWFsbG9jID0gcHQ7Cj4gLQkJCQlwdCA9IHBkLT5lbnRyeVtwZGVdOwo+
IC0JCQl9Cj4gLQkJfQo+IC0KPiAtCQlhdG9taWNfYWRkKGNvdW50LCAmcHQtPnVzZWQpOwo+IC0J
fQo+IC0Jc3Bpbl91bmxvY2soJnBkLT5sb2NrKTsKPiAtCWdvdG8gb3V0Owo+IC0KPiAtdW53aW5k
Ogo+IC0JZ2VuOF9wcGd0dF9jbGVhcl9wZCh2bSwgcGQsIGZyb20sIHN0YXJ0IC0gZnJvbSk7Cj4g
LW91dDoKPiAtCWlmIChhbGxvYykKPiAtCQlmcmVlX3B4KHZtLCBhbGxvYyk7Cj4gLQlyZXR1cm4g
cmV0Owo+IC19Cj4gLQo+IC1zdGF0aWMgaW50IGdlbjhfcHBndHRfYWxsb2NfcGRwKHN0cnVjdCBp
OTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAo+IC0JCQkJc3RydWN0IGk5MTVfcGFnZV9kaXJlY3Rvcnkg
KnBkcCwKPiAtCQkJCXU2NCBzdGFydCwgdTY0IGxlbmd0aCkKPiAtewo+IC0Jc3RydWN0IGk5MTVf
cGFnZV9kaXJlY3RvcnkgKnBkLCAqYWxsb2MgPSBOVUxMOwo+IC0JdTY0IGZyb20gPSBzdGFydDsK
PiAtCXVuc2lnbmVkIGludCBwZHBlOwo+IC0JaW50IHJldCA9IDA7Cj4gKwkJCQlpZiAoIXB0KSB7
Cj4gKwkJCQkJcHQgPSBhbGxvY19wdCh2bSk7Cj4gKwkJCQkJaWYgKElTX0VSUihwdCkpIHsKPiAr
CQkJCQkJcmV0ID0gUFRSX0VSUihwdCk7Cj4gKwkJCQkJCWdvdG8gb3V0Owo+ICsJCQkJCX0KPiAr
CQkJCX0KPiAgCj4gLQlzcGluX2xvY2soJnBkcC0+bG9jayk7Cj4gLQlnZW44X2Zvcl9lYWNoX3Bk
cGUocGQsIHBkcCwgc3RhcnQsIGxlbmd0aCwgcGRwZSkgewo+IC0JCWlmICghcGQpIHsKPiAtCQkJ
c3Bpbl91bmxvY2soJnBkcC0+bG9jayk7Cj4gLQo+IC0JCQlwZCA9IGZldGNoX2FuZF96ZXJvKCZh
bGxvYyk7Cj4gLQkJCWlmICghcGQpCj4gLQkJCQlwZCA9IGFsbG9jX3BkKHZtKTsKPiAtCQkJaWYg
KElTX0VSUihwZCkpIHsKPiAtCQkJCXJldCA9IFBUUl9FUlIocGQpOwo+IC0JCQkJZ290byB1bndp
bmQ7Cj4gKwkJCQlpZiAoaW50ZWxfdmdwdV9hY3RpdmUodm0tPmk5MTUpIHx8Cj4gKwkJCQkgICAg
Z2VuOF9wdF9jb3VudCgqc3RhcnQsIGVuZCkgPCBJOTE1X1BERVMpCj4gKwkJCQkJZmlsbF9weChw
dCwgdm0tPnNjcmF0Y2hbbHZsXS5lbmNvZGUpOwo+ICAJCQl9Cj4gIAo+IC0JCQlmaWxsX3B4KHBk
LCB2bS0+c2NyYXRjaFsxXS5lbmNvZGUpOwo+ICsJCQlzcGluX2xvY2soJnBkLT5sb2NrKTsKPiAr
CQkJaWYgKGxpa2VseSghcGQtPmVudHJ5W2lkeF0pKQo+ICsJCQkJc2V0X3BkX2VudHJ5KHBkLCBp
ZHgsIHB0KTsKPiArCQkJZWxzZQo+ICsJCQkJYWxsb2MgPSBwdCwgcHQgPSBwZC0+ZW50cnlbaWR4
XTsKPiArCQl9Cj4gIAo+IC0JCQlzcGluX2xvY2soJnBkcC0+bG9jayk7Cj4gLQkJCWlmICghcGRw
LT5lbnRyeVtwZHBlXSkgewo+IC0JCQkJc2V0X3BkX2VudHJ5KHBkcCwgcGRwZSwgcGQpOwo+IC0J
CQl9IGVsc2Ugewo+IC0JCQkJYWxsb2MgPSBwZDsKPiAtCQkJCXBkID0gcGRwLT5lbnRyeVtwZHBl
XTsKPiArCQlpZiAobHZsKSB7Cj4gKwkJCWF0b21pY19pbmMoJnB0LT51c2VkKTsKPiArCQkJc3Bp
bl91bmxvY2soJnBkLT5sb2NrKTsKPiArCj4gKwkJCXJldCA9IF9fZ2VuOF9wcGd0dF9hbGxvYyh2
bSwgYXNfcGQocHQpLAo+ICsJCQkJCQkgc3RhcnQsIGVuZCwgbHZsKTsKPiArCQkJaWYgKHVubGlr
ZWx5KHJldCkpIHsKPiArCQkJCWlmIChyZWxlYXNlX3BkX2VudHJ5KHBkLCBpZHgsIHB0LCBzY3Jh
dGNoKSkKPiArCQkJCQlmcmVlX3B4KHZtLCBwdCk7Cj4gKwkJCQlnb3RvIG91dDsKPiAgCQkJfQo+
IC0JCX0KPiAtCQlhdG9taWNfaW5jKHB4X3VzZWQocGQpKTsKPiAtCQlzcGluX3VubG9jaygmcGRw
LT5sb2NrKTsKPiAgCj4gLQkJcmV0ID0gZ2VuOF9wcGd0dF9hbGxvY19wZCh2bSwgcGQsIHN0YXJ0
LCBsZW5ndGgpOwo+IC0JCWlmICh1bmxpa2VseShyZXQpKQo+IC0JCQlnb3RvIHVud2luZF9wZDsK
PiArCQkJc3Bpbl9sb2NrKCZwZC0+bG9jayk7Cj4gKwkJCWF0b21pY19kZWMoJnB0LT51c2VkKTsK
PiArCQkJR0VNX0JVR19PTighYXRvbWljX3JlYWQoJnB0LT51c2VkKSk7Cj4gKwkJfSBlbHNlIHsK
PiArCQkJdW5zaWduZWQgaW50IGNvdW50ID0gZ2VuOF9wdF9jb3VudCgqc3RhcnQsIGVuZCk7Cj4g
IAo+IC0JCXNwaW5fbG9jaygmcGRwLT5sb2NrKTsKPiAtCQlhdG9taWNfZGVjKHB4X3VzZWQocGQp
KTsKPiAtCX0KPiAtCXNwaW5fdW5sb2NrKCZwZHAtPmxvY2spOwo+IC0JZ290byBvdXQ7Cj4gKwkJ
CURCRygiJXMoJXApOntsdmw6JWQsIHN0YXJ0OiVsbHgsIGVuZDolbGx4LCBpZHg6JWQsIGxlbjol
ZCwgdXNlZDolZH0gaW5zZXJ0aW5nIHB0ZVxuIiwKPiArCQkJICAgIF9fZnVuY19fLCB2bSwgbHZs
LCAqc3RhcnQsIGVuZCwKPiArCQkJICAgIGdlbjhfcGRfaW5kZXgoKnN0YXJ0LCAwKSwgY291bnQs
Cj4gKwkJCSAgICBhdG9taWNfcmVhZCgmcHQtPnVzZWQpKTsKPiAgCj4gLXVud2luZF9wZDoKPiAt
CWlmIChyZWxlYXNlX3BkX2VudHJ5KHBkcCwgcGRwZSwgJnBkLT5wdCwgJnZtLT5zY3JhdGNoWzJd
KSkKPiAtCQlmcmVlX3B4KHZtLCBwZCk7Cj4gLXVud2luZDoKPiAtCWdlbjhfcHBndHRfY2xlYXJf
cGRwKHZtLCBwZHAsIGZyb20sIHN0YXJ0IC0gZnJvbSk7Cj4gKwkJCWF0b21pY19hZGQoY291bnQs
ICZwdC0+dXNlZCk7Cj4gKwkJCUdFTV9CVUdfT04oYXRvbWljX3JlYWQoJnB0LT51c2VkKSA+IEk5
MTVfUERFUyk7Cj4gKwkJCSpzdGFydCArPSBjb3VudDsKPiArCQl9Cj4gKwl9IHdoaWxlIChpZHgr
KywgLS1sZW4pOwo+ICsJc3Bpbl91bmxvY2soJnBkLT5sb2NrKTsKPiAgb3V0Ogo+ICAJaWYgKGFs
bG9jKQo+ICAJCWZyZWVfcHgodm0sIGFsbG9jKTsKPiAgCXJldHVybiByZXQ7Cj4gIH0KPiAgCj4g
LXN0YXRpYyBpbnQgZ2VuOF9wcGd0dF9hbGxvY18zbHZsKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3Bh
Y2UgKnZtLAo+IC0JCQkJIHU2NCBzdGFydCwgdTY0IGxlbmd0aCkKPiAtewo+IC0JcmV0dXJuIGdl
bjhfcHBndHRfYWxsb2NfcGRwKHZtLAo+IC0JCQkJICAgIGk5MTVfdm1fdG9fcHBndHQodm0pLT5w
ZCwgc3RhcnQsIGxlbmd0aCk7Cj4gLX0KPiAtCj4gLXN0YXRpYyBpbnQgZ2VuOF9wcGd0dF9hbGxv
Y180bHZsKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAo+IC0JCQkJIHU2NCBzdGFydCwg
dTY0IGxlbmd0aCkKPiArc3RhdGljIGludCBnZW44X3BwZ3R0X2FsbG9jKHN0cnVjdCBpOTE1X2Fk
ZHJlc3Nfc3BhY2UgKnZtLAo+ICsJCQkgICAgdTY0IHN0YXJ0LCB1NjQgbGVuZ3RoKQo+ICB7Cj4g
LQlzdHJ1Y3QgaTkxNV9wcGd0dCAqcHBndHQgPSBpOTE1X3ZtX3RvX3BwZ3R0KHZtKTsKPiAtCXN0
cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICogY29uc3QgcG1sNCA9IHBwZ3R0LT5wZDsKPiAtCXN0
cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICpwZHAsICphbGxvYyA9IE5VTEw7Cj4gIAl1NjQgZnJv
bSA9IHN0YXJ0Owo+IC0JaW50IHJldCA9IDA7Cj4gLQl1MzIgcG1sNGU7Cj4gLQo+IC0Jc3Bpbl9s
b2NrKCZwbWw0LT5sb2NrKTsKPiAtCWdlbjhfZm9yX2VhY2hfcG1sNGUocGRwLCBwbWw0LCBzdGFy
dCwgbGVuZ3RoLCBwbWw0ZSkgewo+IC0JCWlmICghcGRwKSB7Cj4gLQkJCXNwaW5fdW5sb2NrKCZw
bWw0LT5sb2NrKTsKPiAtCj4gLQkJCXBkcCA9IGZldGNoX2FuZF96ZXJvKCZhbGxvYyk7Cj4gLQkJ
CWlmICghcGRwKQo+IC0JCQkJcGRwID0gYWxsb2NfcGQodm0pOwo+IC0JCQlpZiAoSVNfRVJSKHBk
cCkpIHsKPiAtCQkJCXJldCA9IFBUUl9FUlIocGRwKTsKPiAtCQkJCWdvdG8gdW53aW5kOwo+IC0J
CQl9Cj4gLQo+IC0JCQlmaWxsX3B4KHBkcCwgdm0tPnNjcmF0Y2hbMl0uZW5jb2RlKTsKPiArCWlu
dCBlcnI7Cj4gIAo+IC0JCQlzcGluX2xvY2soJnBtbDQtPmxvY2spOwo+IC0JCQlpZiAoIXBtbDQt
PmVudHJ5W3BtbDRlXSkgewo+IC0JCQkJc2V0X3BkX2VudHJ5KHBtbDQsIHBtbDRlLCBwZHApOwo+
IC0JCQl9IGVsc2Ugewo+IC0JCQkJYWxsb2MgPSBwZHA7Cj4gLQkJCQlwZHAgPSBwbWw0LT5lbnRy
eVtwbWw0ZV07Cj4gLQkJCX0KPiAtCQl9Cj4gLQkJYXRvbWljX2luYyhweF91c2VkKHBkcCkpOwo+
IC0JCXNwaW5fdW5sb2NrKCZwbWw0LT5sb2NrKTsKPiArCUdFTV9CVUdfT04oIUlTX0FMSUdORUQo
c3RhcnQsIEJJVF9VTEwoR0VOOF9QVEVfU0hJRlQpKSk7Cj4gKwlHRU1fQlVHX09OKCFJU19BTElH
TkVEKGxlbmd0aCwgQklUX1VMTChHRU44X1BURV9TSElGVCkpKTsKPiAgCj4gLQkJcmV0ID0gZ2Vu
OF9wcGd0dF9hbGxvY19wZHAodm0sIHBkcCwgc3RhcnQsIGxlbmd0aCk7Cj4gLQkJaWYgKHVubGlr
ZWx5KHJldCkpCj4gLQkJCWdvdG8gdW53aW5kX3BkcDsKPiArCXN0YXJ0ID4+PSBHRU44X1BURV9T
SElGVDsKPiArCWxlbmd0aCA+Pj0gR0VOOF9QVEVfU0hJRlQ7Cj4gKwlHRU1fQlVHX09OKGxlbmd0
aCA9PSAwKTsKPiAgCj4gLQkJc3Bpbl9sb2NrKCZwbWw0LT5sb2NrKTsKPiAtCQlhdG9taWNfZGVj
KHB4X3VzZWQocGRwKSk7Cj4gLQl9Cj4gLQlzcGluX3VubG9jaygmcG1sNC0+bG9jayk7Cj4gLQln
b3RvIG91dDsKPiArCWVyciA9IF9fZ2VuOF9wcGd0dF9hbGxvYyh2bSwgaTkxNV92bV90b19wcGd0
dCh2bSktPnBkLAo+ICsJCQkJICZzdGFydCwgc3RhcnQgKyBsZW5ndGgsIHZtLT50b3ApOwo+ICsJ
aWYgKHVubGlrZWx5KGVycikpCj4gKwkJX19nZW44X3BwZ3R0X2NsZWFyKHZtLCBpOTE1X3ZtX3Rv
X3BwZ3R0KHZtKS0+cGQsCj4gKwkJCQkgICBmcm9tLCBzdGFydCwgdm0tPnRvcCk7Cj4gIAo+IC11
bndpbmRfcGRwOgo+IC0JaWYgKHJlbGVhc2VfcGRfZW50cnkocG1sNCwgcG1sNGUsICZwZHAtPnB0
LCAmdm0tPnNjcmF0Y2hbM10pKQo+IC0JCWZyZWVfcHgodm0sIHBkcCk7Cj4gLXVud2luZDoKPiAt
CWdlbjhfcHBndHRfY2xlYXIodm0sIGZyb20sIHN0YXJ0IC0gZnJvbSk7Cj4gLW91dDoKPiAtCWlm
IChhbGxvYykKPiAtCQlmcmVlX3B4KHZtLCBhbGxvYyk7Cj4gLQlyZXR1cm4gcmV0Owo+ICsJcmV0
dXJuIGVycjsKPiAgfQo+ICAKPiAgc3RhdGljIGlubGluZSBzdHJ1Y3Qgc2d0X2RtYSB7Cj4gQEAg
LTE0OTYsMTkgKzE0MTYsMjIgQEAgc3RhdGljIGludCBnZW44X2luaXRfc2NyYXRjaChzdHJ1Y3Qg
aTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKPiAgc3RhdGljIGludCBnZW44X3ByZWFsbG9jYXRlX3Rv
cF9sZXZlbF9wZHAoc3RydWN0IGk5MTVfcHBndHQgKnBwZ3R0KQo+ICB7Cj4gIAlzdHJ1Y3QgaTkx
NV9hZGRyZXNzX3NwYWNlICp2bSA9ICZwcGd0dC0+dm07Cj4gLQlzdHJ1Y3QgaTkxNV9wYWdlX2Rp
cmVjdG9yeSAqcGRwID0gcHBndHQtPnBkOwo+IC0Jc3RydWN0IGk5MTVfcGFnZV9kaXJlY3Rvcnkg
KnBkOwo+IC0JdTY0IHN0YXJ0ID0gMCwgbGVuZ3RoID0gcHBndHQtPnZtLnRvdGFsOwo+IC0JdW5z
aWduZWQgaW50IHBkcGU7Cj4gKwlzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVjdG9yeSAqcGQgPSBwcGd0
dC0+cGQ7Cj4gKwl1bnNpZ25lZCBpbnQgaWR4Owo+ICsKPiArCUdFTV9CVUdfT04odm0tPnRvcCAh
PSAyKTsKPiArCUdFTV9CVUdfT04oKHZtLT50b3RhbCA+PiBfX2dlbjhfcHRlX3NoaWZ0KDIpKSAh
PSBHRU44XzNMVkxfUERQRVMpOwo+ICsKPiArCWZvciAoaWR4ID0gMDsgaWR4IDwgR0VOOF8zTFZM
X1BEUEVTOyBpZHgrKykgewo+ICsJCXN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICpwZGU7Cj4g
IAo+IC0JZ2VuOF9mb3JfZWFjaF9wZHBlKHBkLCBwZHAsIHN0YXJ0LCBsZW5ndGgsIHBkcGUpIHsK
PiAtCQlwZCA9IGFsbG9jX3BkKHZtKTsKPiAtCQlpZiAoSVNfRVJSKHBkKSkKPiAtCQkJcmV0dXJu
IFBUUl9FUlIocGQpOwo+ICsJCXBkZSA9IGFsbG9jX3BkKHZtKTsKPiArCQlpZiAoSVNfRVJSKHBk
ZSkpCj4gKwkJCXJldHVybiBQVFJfRVJSKHBkZSk7Cj4gIAo+IC0JCWZpbGxfcHgocGQsIHZtLT5z
Y3JhdGNoWzFdLmVuY29kZSk7Cj4gLQkJc2V0X3BkX2VudHJ5KHBkcCwgcGRwZSwgcGQpOwo+IC0J
CWF0b21pY19pbmMocHhfdXNlZChwZCkpOyAvKiBrZWVwIHBpbm5lZCAqLwo+ICsJCWZpbGxfcHgo
cGRlLCB2bS0+c2NyYXRjaFsxXS5lbmNvZGUpOwo+ICsJCXNldF9wZF9lbnRyeShwZCwgaWR4LCBw
ZGUpOwo+ICsJCWF0b21pY19pbmMocHhfdXNlZChwZGUpKTsgLyoga2VlcCBwaW5uZWQgKi8KPiAg
CX0KPiAgCj4gIAlyZXR1cm4gMDsKPiBAQCAtMTU5Nyw3ICsxNTIwLDYgQEAgc3RhdGljIHN0cnVj
dCBpOTE1X3BwZ3R0ICpnZW44X3BwZ3R0X2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKPiAgCX0KPiAgCj4gIAlpZiAoaTkxNV92bV9pc180bHZsKCZwcGd0dC0+dm0pKSB7Cj4g
LQkJcHBndHQtPnZtLmFsbG9jYXRlX3ZhX3JhbmdlID0gZ2VuOF9wcGd0dF9hbGxvY180bHZsOwo+
ICAJCXBwZ3R0LT52bS5pbnNlcnRfZW50cmllcyA9IGdlbjhfcHBndHRfaW5zZXJ0XzRsdmw7Cj4g
IAl9IGVsc2Ugewo+ICAJCWlmIChpbnRlbF92Z3B1X2FjdGl2ZShpOTE1KSkgewo+IEBAIC0xNjA2
LDEwICsxNTI4LDEwIEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV9wcGd0dCAqZ2VuOF9wcGd0dF9jcmVh
dGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCj4gIAkJCQlnb3RvIGVycl9mcmVlX3Bk
Owo+ICAJCX0KPiAgCj4gLQkJcHBndHQtPnZtLmFsbG9jYXRlX3ZhX3JhbmdlID0gZ2VuOF9wcGd0
dF9hbGxvY18zbHZsOwo+ICAJCXBwZ3R0LT52bS5pbnNlcnRfZW50cmllcyA9IGdlbjhfcHBndHRf
aW5zZXJ0XzNsdmw7Cj4gIAl9Cj4gIAo+ICsJcHBndHQtPnZtLmFsbG9jYXRlX3ZhX3JhbmdlID0g
Z2VuOF9wcGd0dF9hbGxvYzsKPiAgCXBwZ3R0LT52bS5jbGVhcl9yYW5nZSA9IGdlbjhfcHBndHRf
Y2xlYXI7Cj4gIAo+ICAJaWYgKGludGVsX3ZncHVfYWN0aXZlKGk5MTUpKQo+IApfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBs
aXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

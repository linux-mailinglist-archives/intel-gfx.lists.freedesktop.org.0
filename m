Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id E70308F86E
	for <lists+intel-gfx@lfdr.de>; Fri, 16 Aug 2019 03:24:10 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5A3206EAA2;
	Fri, 16 Aug 2019 01:24:09 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6BDCA6EAA7
 for <intel-gfx@lists.freedesktop.org>; Fri, 16 Aug 2019 01:24:05 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga004.fm.intel.com ([10.253.24.48])
 by fmsmga104.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 15 Aug 2019 18:24:05 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,391,1559545200"; d="scan'208";a="201397191"
Received: from dceraolo-linux.fm.intel.com ([10.1.27.145])
 by fmsmga004.fm.intel.com with ESMTP; 15 Aug 2019 18:24:05 -0700
From: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 15 Aug 2019 18:23:43 -0700
Message-Id: <20190816012343.36433-7-daniele.ceraolospurio@intel.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190816012343.36433-1-daniele.ceraolospurio@intel.com>
References: <20190816012343.36433-1-daniele.ceraolospurio@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 6/6] drm/i915: Wrappers for display register
 waits
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Jani Nikula <jani.nikula@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VG8gcmVkdWNlIHRoZSBudW1iZXIgb2YgZXhwbGljaXQgZGV2X3ByaXYtPnVuY29yZSBjYWxscyBp
biB0aGUgZGlzcGxheQpjb2RlIGFoZWFkIG9mIHRoZSBpbnRyb2R1Y3Rpb24gb2YgZGV2X3ByaXYt
PmRlX3VuY29yZSwgdGhpcyBwYXRjaAppbnRyb2R1Y2VzIGEgd3JhcHBlciBmb3Igb25lIG9mIHRo
ZSBtYWluIHVzYWdlcyBvZiBpdCwgdGhlIHJlZ2lzdGVyCndhaXRzLiBXaGVuIHdlIHRyYW5zaXRp
b24gdG8gdGhlIG5ldyB1bmNvcmUsIHdlIGNhbiBqdXN0IHVwZGF0ZSB0aGUKd3JhcHBlciB0byBw
b2ludCB0byB0aGUgYXBwcm9wcmlhdGUgc3RydWN0dXJlLgoKU2luY2UgdGhlIHZhc3QgbWFqb3Jp
dHkgb2Ygd2FpdHMgYXJlIG9uIGEgc2V0IG9yIGNsZWFyIG9mIGEgYml0IG9yIG1hc2ssCmFkZCBz
ZXQgJiBjbGVhciBmbGF2b3VycyBvZiB0aGUgd3JhcHBlciB0byBzaW1wbGlmeSB0aGUgY29kZS4K
ClNpZ25lZC1vZmYtYnk6IERhbmllbGUgQ2VyYW9sbyBTcHVyaW8gPGRhbmllbGUuY2VyYW9sb3Nw
dXJpb0BpbnRlbC5jb20+CkNjOiBKYW5pIE5pa3VsYSA8amFuaS5uaWt1bGFAaW50ZWwuY29tPgpD
YzogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KLS0tCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ljbF9kc2kuYyAgICAgICAgfCAxMSArLS0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY2RjbGsuYyAgICB8IDE4ICstLS0tCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NydC5jICAgICAgfCAxNyArKy0tCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jICAgICAgfCAgNiArLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgIHwgNDUgKysrLS0tLS0t
LS0KIC4uLi9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfcG93ZXIuYyAgICB8IDMyICsr
Ky0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMgICAgICAgfCAx
MCArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbXN0LmMgICB8ICA3
ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwaW9fcGh5LmMgfCAgNSAr
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcGxsX21nci5jIHwgNDQgKysr
LS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmMuYyAgICAgIHwg
IDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfaGRjcC5jICAgICB8IDMy
ICsrKy0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2x2ZHMuYyAgICAg
fCAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYyAgICAgIHwg
IDUgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvdmx2X2RzaS5jICAgICAgICB8IDgw
ICsrKysrKy0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvdmx2X2Rz
aV9wbGwuYyAgICB8IDE0ICstLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggICAg
ICAgICAgICAgICB8IDExICsrKwogMTcgZmlsZXMgY2hhbmdlZCwgMTEyIGluc2VydGlvbnMoKyks
IDIzNSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ljbF9kc2kuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaWNsX2RzaS5jCmlu
ZGV4IDI3YjAzMWExNzc0Zi4uOGU4ODdjMmE1NzJiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ljbF9kc2kuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ljbF9kc2kuYwpAQCAtODk5LDEwICs4OTksOCBAQCBzdGF0aWMgdm9pZCBnZW4xMV9kc2lf
ZW5hYmxlX3RyYW5zY29kZXIoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCiAJCUk5MTVf
V1JJVEUoUElQRUNPTkYoZHNpX3RyYW5zKSwgdG1wKTsKIAogCQkvKiB3YWl0IGZvciB0cmFuc2Nv
ZGVyIHRvIGJlIGVuYWJsZWQgKi8KLQkJaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZf
cHJpdi0+dW5jb3JlLAotCQkJCQkgICAgUElQRUNPTkYoZHNpX3RyYW5zKSwKLQkJCQkJICAgIEk5
NjVfUElQRUNPTkZfQUNUSVZFLAotCQkJCQkgICAgSTk2NV9QSVBFQ09ORl9BQ1RJVkUsIDEwKSkK
KwkJaWYgKGludGVsX2RlX3dhaXRfZm9yX3NldChkZXZfcHJpdiwgUElQRUNPTkYoZHNpX3RyYW5z
KSwKKwkJCQkJICBJOTY1X1BJUEVDT05GX0FDVElWRSwgMTApKQogCQkJRFJNX0VSUk9SKCJEU0kg
dHJhbnNjb2RlciBub3QgZW5hYmxlZFxuIik7CiAJfQogfQpAQCAtMTA4MSw5ICsxMDc5LDggQEAg
c3RhdGljIHZvaWQgZ2VuMTFfZHNpX2Rpc2FibGVfdHJhbnNjb2RlcihzdHJ1Y3QgaW50ZWxfZW5j
b2RlciAqZW5jb2RlcikKIAkJSTkxNV9XUklURShQSVBFQ09ORihkc2lfdHJhbnMpLCB0bXApOwog
CiAJCS8qIHdhaXQgZm9yIHRyYW5zY29kZXIgdG8gYmUgZGlzYWJsZWQgKi8KLQkJaWYgKGludGVs
X3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLAotCQkJCQkgICAgUElQRUNPTkYo
ZHNpX3RyYW5zKSwKLQkJCQkJICAgIEk5NjVfUElQRUNPTkZfQUNUSVZFLCAwLCA1MCkpCisJCWlm
IChpbnRlbF9kZV93YWl0X2Zvcl9jbGVhcihkZXZfcHJpdiwgUElQRUNPTkYoZHNpX3RyYW5zKSwK
KwkJCQkJICAgIEk5NjVfUElQRUNPTkZfQUNUSVZFLCA1MCkpCiAJCQlEUk1fRVJST1IoIkRTSSB0
cmFuY29kZXIgbm90IGRpc2FibGVkXG4iKTsKIAl9CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NkY2xrLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2NkY2xrLmMKaW5kZXggYTAyZTg0MDRkNmVjLi4yYzM4YTU4ZGI0YmIgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY2RjbGsuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NkY2xrLmMKQEAgLTk3MCw5ICs5
NzAsNyBAQCBzdGF0aWMgdm9pZCBza2xfZHBsbDBfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwgaW50IHZjbykKIAogCUk5MTVfV1JJVEUoTENQTEwxX0NUTCwgSTkxNV9S
RUFEKExDUExMMV9DVEwpIHwgTENQTExfUExMX0VOQUJMRSk7CiAKLQlpZiAoaW50ZWxfd2FpdF9m
b3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCi0JCQkJICAgIExDUExMMV9DVEwsIExDUExM
X1BMTF9MT0NLLCBMQ1BMTF9QTExfTE9DSywKLQkJCQkgICAgNSkpCisJaWYgKGludGVsX2RlX3dh
aXRfZm9yX3NldChkZXZfcHJpdiwgTENQTEwxX0NUTCwgTENQTExfUExMX0xPQ0ssIDUpKQogCQlE
Uk1fRVJST1IoIkRQTEwwIG5vdCBsb2NrZWRcbiIpOwogCiAJZGV2X3ByaXYtPmNkY2xrLmh3LnZj
byA9IHZjbzsKQEAgLTk4NCw5ICs5ODIsNyBAQCBzdGF0aWMgdm9pZCBza2xfZHBsbDBfZW5hYmxl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgaW50IHZjbykKIHN0YXRpYyB2b2lk
IHNrbF9kcGxsMF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsK
IAlJOTE1X1dSSVRFKExDUExMMV9DVEwsIEk5MTVfUkVBRChMQ1BMTDFfQ1RMKSAmIH5MQ1BMTF9Q
TExfRU5BQkxFKTsKLQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNv
cmUsCi0JCQkJICAgIExDUExMMV9DVEwsIExDUExMX1BMTF9MT0NLLCAwLAotCQkJCSAgICAxKSkK
KwlpZiAoaW50ZWxfZGVfd2FpdF9mb3JfY2xlYXIoZGV2X3ByaXYsIExDUExMMV9DVEwsIExDUExM
X1BMTF9MT0NLLCAxKSkKIAkJRFJNX0VSUk9SKCJDb3VsZG4ndCBkaXNhYmxlIERQTEwwXG4iKTsK
IAogCWRldl9wcml2LT5jZGNsay5ody52Y28gPSAwOwpAQCAtMTMxMCw5ICsxMzA2LDcgQEAgc3Rh
dGljIHZvaWQgYnh0X2RlX3BsbF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIAlJOTE1X1dSSVRFKEJYVF9ERV9QTExfRU5BQkxFLCAwKTsKIAogCS8qIFRpbWVvdXQg
MjAwdXMgKi8KLQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUs
Ci0JCQkJICAgIEJYVF9ERV9QTExfRU5BQkxFLCBCWFRfREVfUExMX0xPQ0ssIDAsCi0JCQkJICAg
IDEpKQorCWlmIChpbnRlbF9kZV93YWl0X2Zvcl9jbGVhcihkZXZfcHJpdiwgQlhUX0RFX1BMTF9F
TkFCTEUsIEJYVF9ERV9QTExfTE9DSywgMSkpCiAJCURSTV9FUlJPUigidGltZW91dCB3YWl0aW5n
IGZvciBERSBQTEwgdW5sb2NrXG4iKTsKIAogCWRldl9wcml2LT5jZGNsay5ody52Y28gPSAwOwpA
QCAtMTMzMSwxMSArMTMyNSw3IEBAIHN0YXRpYyB2b2lkIGJ4dF9kZV9wbGxfZW5hYmxlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgaW50IHZjbykKIAlJOTE1X1dSSVRFKEJYVF9E
RV9QTExfRU5BQkxFLCBCWFRfREVfUExMX1BMTF9FTkFCTEUpOwogCiAJLyogVGltZW91dCAyMDB1
cyAqLwotCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwKLQkJ
CQkgICAgQlhUX0RFX1BMTF9FTkFCTEUsCi0JCQkJICAgIEJYVF9ERV9QTExfTE9DSywKLQkJCQkg
ICAgQlhUX0RFX1BMTF9MT0NLLAotCQkJCSAgICAxKSkKKwlpZiAoaW50ZWxfZGVfd2FpdF9mb3Jf
c2V0KGRldl9wcml2LCBCWFRfREVfUExMX0VOQUJMRSwgQlhUX0RFX1BMTF9MT0NLLCAxKSkKIAkJ
RFJNX0VSUk9SKCJ0aW1lb3V0IHdhaXRpbmcgZm9yIERFIFBMTCBsb2NrXG4iKTsKIAogCWRldl9w
cml2LT5jZGNsay5ody52Y28gPSB2Y287CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2NydC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9jcnQuYwppbmRleCA3MDQ1ZDkzOTA5NmYuLjRiYTVlOGRhOTcyZiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jcnQuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2NydC5jCkBAIC00NDQsMTAgKzQ0NCw4IEBAIHN0YXRpYyBi
b29sIGludGVsX2lyb25sYWtlX2NydF9kZXRlY3RfaG90cGx1ZyhzdHJ1Y3QgZHJtX2Nvbm5lY3Rv
ciAqY29ubmVjdG9yKQogCiAJCUk5MTVfV1JJVEUoY3J0LT5hZHBhX3JlZywgYWRwYSk7CiAKLQkJ
aWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLAotCQkJCQkgICAg
Y3J0LT5hZHBhX3JlZywKLQkJCQkJICAgIEFEUEFfQ1JUX0hPVFBMVUdfRk9SQ0VfVFJJR0dFUiwg
MCwKLQkJCQkJICAgIDEwMDApKQorCQlpZiAoaW50ZWxfZGVfd2FpdF9mb3JfY2xlYXIoZGV2X3By
aXYsIGNydC0+YWRwYV9yZWcsCisJCQkJCSAgICBBRFBBX0NSVF9IT1RQTFVHX0ZPUkNFX1RSSUdH
RVIsIDEwMDApKQogCQkJRFJNX0RFQlVHX0tNUygidGltZWQgb3V0IHdhaXRpbmcgZm9yIEZPUkNF
X1RSSUdHRVIiKTsKIAogCQlpZiAodHVybl9vZmZfZGFjKSB7CkBAIC00OTgsMTAgKzQ5Niw4IEBA
IHN0YXRpYyBib29sIHZhbGxleXZpZXdfY3J0X2RldGVjdF9ob3RwbHVnKHN0cnVjdCBkcm1fY29u
bmVjdG9yICpjb25uZWN0b3IpCiAKIAlJOTE1X1dSSVRFKGNydC0+YWRwYV9yZWcsIGFkcGEpOwog
Ci0JaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLAotCQkJCSAg
ICBjcnQtPmFkcGFfcmVnLAotCQkJCSAgICBBRFBBX0NSVF9IT1RQTFVHX0ZPUkNFX1RSSUdHRVIs
IDAsCi0JCQkJICAgIDEwMDApKSB7CisJaWYgKGludGVsX2RlX3dhaXRfZm9yX2NsZWFyKGRldl9w
cml2LCBjcnQtPmFkcGFfcmVnLAorCQkJCSAgICBBRFBBX0NSVF9IT1RQTFVHX0ZPUkNFX1RSSUdH
RVIsIDEwMDApKSB7CiAJCURSTV9ERUJVR19LTVMoInRpbWVkIG91dCB3YWl0aW5nIGZvciBGT1JD
RV9UUklHR0VSIik7CiAJCUk5MTVfV1JJVEUoY3J0LT5hZHBhX3JlZywgc2F2ZV9hZHBhKTsKIAl9
CkBAIC01NTEsOSArNTQ3LDggQEAgc3RhdGljIGJvb2wgaW50ZWxfY3J0X2RldGVjdF9ob3RwbHVn
KHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IpCiAJCQkJCSAgICAgIENSVF9IT1RQTFVH
X0ZPUkNFX0RFVEVDVCwKIAkJCQkJICAgICAgQ1JUX0hPVFBMVUdfRk9SQ0VfREVURUNUKTsKIAkJ
Lyogd2FpdCBmb3IgRk9SQ0VfREVURUNUIHRvIGdvIG9mZiAqLwotCQlpZiAoaW50ZWxfd2FpdF9m
b3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsIFBPUlRfSE9UUExVR19FTiwKLQkJCQkJICAg
IENSVF9IT1RQTFVHX0ZPUkNFX0RFVEVDVCwgMCwKLQkJCQkJICAgIDEwMDApKQorCQlpZiAoaW50
ZWxfZGVfd2FpdF9mb3JfY2xlYXIoZGV2X3ByaXYsIFBPUlRfSE9UUExVR19FTiwKKwkJCQkJICAg
IENSVF9IT1RQTFVHX0ZPUkNFX0RFVEVDVCwgMTAwMCkpCiAJCQlEUk1fREVCVUdfS01TKCJ0aW1l
ZCBvdXQgd2FpdGluZyBmb3IgRk9SQ0VfREVURUNUIHRvIGdvIG9mZiIpOwogCX0KIApkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMKaW5kZXggOTY0NzQyNWIyMzAxLi43NWZh
NGUyODdkN2UgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGRpLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYwpAQCAt
MzE0MCwxMCArMzE0MCw4IEBAIHN0YXRpYyB2b2lkIGludGVsX2RkaV9lbmFibGVfZmVjKHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCXZhbCB8PSBEUF9UUF9DVExfRkVDX0VOQUJMRTsK
IAlJOTE1X1dSSVRFKERQX1RQX0NUTChwb3J0KSwgdmFsKTsKIAotCWlmIChpbnRlbF93YWl0X2Zv
cl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwgRFBfVFBfU1RBVFVTKHBvcnQpLAotCQkJCSAg
ICBEUF9UUF9TVEFUVVNfRkVDX0VOQUJMRV9MSVZFLAotCQkJCSAgICBEUF9UUF9TVEFUVVNfRkVD
X0VOQUJMRV9MSVZFLAotCQkJCSAgICAxKSkKKwlpZiAoaW50ZWxfZGVfd2FpdF9mb3Jfc2V0KGRl
dl9wcml2LCBEUF9UUF9TVEFUVVMocG9ydCksCisJCQkJICBEUF9UUF9TVEFUVVNfRkVDX0VOQUJM
RV9MSVZFLCAxKSkKIAkJRFJNX0VSUk9SKCJUaW1lZCBvdXQgd2FpdGluZyBmb3IgRkVDIEVuYWJs
ZSBTdGF0dXNcbiIpOwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGlzcGxheS5jCmluZGV4IDFjNDU0OGVjZjZlMS4uYWI2M2FmMDhiZTZlIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAtMTA3OCw5ICsxMDc4LDcg
QEAgaW50ZWxfd2FpdF9mb3JfcGlwZV9vZmYoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
Km9sZF9jcnRjX3N0YXRlKQogCQlpOTE1X3JlZ190IHJlZyA9IFBJUEVDT05GKGNwdV90cmFuc2Nv
ZGVyKTsKIAogCQkvKiBXYWl0IGZvciB0aGUgUGlwZSBTdGF0ZSB0byBnbyBvZmYgKi8KLQkJaWYg
KGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLAotCQkJCQkgICAgcmVn
LCBJOTY1X1BJUEVDT05GX0FDVElWRSwgMCwKLQkJCQkJICAgIDEwMCkpCisJCWlmIChpbnRlbF9k
ZV93YWl0X2Zvcl9jbGVhcihkZXZfcHJpdiwgcmVnLCBJOTY1X1BJUEVDT05GX0FDVElWRSwgMTAw
KSkKIAkJCVdBUk4oMSwgInBpcGVfb2ZmIHdhaXQgdGltZWQgb3V0XG4iKTsKIAl9IGVsc2Ugewog
CQlpbnRlbF93YWl0X2Zvcl9waXBlX3NjYW5saW5lX3N0b3BwZWQoY3J0Yyk7CkBAIC0xMzg0LDEx
ICsxMzgyLDcgQEAgc3RhdGljIHZvaWQgX3Zsdl9lbmFibGVfcGxsKHN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjLAogCVBPU1RJTkdfUkVBRChEUExMKHBpcGUpKTsKIAl1ZGVsYXkoMTUwKTsKIAotCWlm
IChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwKLQkJCQkgICAgRFBM
TChwaXBlKSwKLQkJCQkgICAgRFBMTF9MT0NLX1ZMViwKLQkJCQkgICAgRFBMTF9MT0NLX1ZMViwK
LQkJCQkgICAgMSkpCisJaWYgKGludGVsX2RlX3dhaXRfZm9yX3NldChkZXZfcHJpdiwgRFBMTChw
aXBlKSwgRFBMTF9MT0NLX1ZMViwgMSkpCiAJCURSTV9FUlJPUigiRFBMTCAlZCBmYWlsZWQgdG8g
bG9ja1xuIiwgcGlwZSk7CiB9CiAKQEAgLTE0MzcsOSArMTQzMSw3IEBAIHN0YXRpYyB2b2lkIF9j
aHZfZW5hYmxlX3BsbChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAlJOTE1X1dSSVRFKERQTEwo
cGlwZSksIHBpcGVfY29uZmlnLT5kcGxsX2h3X3N0YXRlLmRwbGwpOwogCiAJLyogQ2hlY2sgUExM
IGlzIGxvY2tlZCAqLwotCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVu
Y29yZSwKLQkJCQkgICAgRFBMTChwaXBlKSwgRFBMTF9MT0NLX1ZMViwgRFBMTF9MT0NLX1ZMViwK
LQkJCQkgICAgMSkpCisJaWYgKGludGVsX2RlX3dhaXRfZm9yX3NldChkZXZfcHJpdiwgRFBMTChw
aXBlKSwgRFBMTF9MT0NLX1ZMViwgMSkpCiAJCURSTV9FUlJPUigiUExMICVkIGZhaWxlZCB0byBs
b2NrXG4iLCBwaXBlKTsKIH0KIApAQCAtMTYxOCw5ICsxNjEwLDggQEAgdm9pZCB2bHZfd2FpdF9w
b3J0X3JlYWR5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJQlVHKCk7CiAJ
fQogCi0JaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLAotCQkJ
CSAgICBkcGxsX3JlZywgcG9ydF9tYXNrLCBleHBlY3RlZF9tYXNrLAotCQkJCSAgICAxMDAwKSkK
KwlpZiAoaW50ZWxfZGVfd2FpdF9mb3JfcmVnaXN0ZXIoZGV2X3ByaXYsIGRwbGxfcmVnLAorCQkJ
CSAgICAgICBwb3J0X21hc2ssIGV4cGVjdGVkX21hc2ssIDEwMDApKQogCQlXQVJOKDEsICJ0aW1l
ZCBvdXQgd2FpdGluZyBmb3IgcG9ydCAlYyByZWFkeTogZ290IDB4JXgsIGV4cGVjdGVkIDB4JXhc
biIsCiAJCSAgICAgcG9ydF9uYW1lKGRwb3J0LT5iYXNlLnBvcnQpLAogCQkgICAgIEk5MTVfUkVB
RChkcGxsX3JlZykgJiBwb3J0X21hc2ssIGV4cGVjdGVkX21hc2spOwpAQCAtMTY3OSw5ICsxNjcw
LDcgQEAgc3RhdGljIHZvaWQgaXJvbmxha2VfZW5hYmxlX3BjaF90cmFuc2NvZGVyKGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3MKIAl9CiAKIAlJOTE1X1dSSVRFKHJlZywgdmFs
IHwgVFJBTlNfRU5BQkxFKTsKLQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2
LT51bmNvcmUsCi0JCQkJICAgIHJlZywgVFJBTlNfU1RBVEVfRU5BQkxFLCBUUkFOU19TVEFURV9F
TkFCTEUsCi0JCQkJICAgIDEwMCkpCisJaWYgKGludGVsX2RlX3dhaXRfZm9yX3NldChkZXZfcHJp
diwgcmVnLCBUUkFOU19TVEFURV9FTkFCTEUsIDEwMCkpCiAJCURSTV9FUlJPUigiZmFpbGVkIHRv
IGVuYWJsZSB0cmFuc2NvZGVyICVjXG4iLCBwaXBlX25hbWUocGlwZSkpOwogfQogCkBAIC0xNzA5
LDExICsxNjk4LDcgQEAgc3RhdGljIHZvaWQgbHB0X2VuYWJsZV9wY2hfdHJhbnNjb2RlcihzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCXZhbCB8PSBUUkFOU19QUk9HUkVTU0lW
RTsKIAogCUk5MTVfV1JJVEUoTFBUX1RSQU5TQ09ORiwgdmFsKTsKLQlpZiAoaW50ZWxfd2FpdF9m
b3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCi0JCQkJICAgIExQVF9UUkFOU0NPTkYsCi0J
CQkJICAgIFRSQU5TX1NUQVRFX0VOQUJMRSwKLQkJCQkgICAgVFJBTlNfU1RBVEVfRU5BQkxFLAot
CQkJCSAgICAxMDApKQorCWlmIChpbnRlbF9kZV93YWl0X2Zvcl9zZXQoZGV2X3ByaXYsIExQVF9U
UkFOU0NPTkYsIFRSQU5TX1NUQVRFX0VOQUJMRSwgMTAwKSkKIAkJRFJNX0VSUk9SKCJGYWlsZWQg
dG8gZW5hYmxlIFBDSCB0cmFuc2NvZGVyXG4iKTsKIH0KIApAQCAtMTczNSw5ICsxNzIwLDcgQEAg
c3RhdGljIHZvaWQgaXJvbmxha2VfZGlzYWJsZV9wY2hfdHJhbnNjb2RlcihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJdmFsICY9IH5UUkFOU19FTkFCTEU7CiAJSTkxNV9XUklU
RShyZWcsIHZhbCk7CiAJLyogd2FpdCBmb3IgUENIIHRyYW5zY29kZXIgb2ZmLCB0cmFuc2NvZGVy
IHN0YXRlICovCi0JaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3Jl
LAotCQkJCSAgICByZWcsIFRSQU5TX1NUQVRFX0VOQUJMRSwgMCwKLQkJCQkgICAgNTApKQorCWlm
IChpbnRlbF9kZV93YWl0X2Zvcl9jbGVhcihkZXZfcHJpdiwgcmVnLCBUUkFOU19TVEFURV9FTkFC
TEUsIDUwKSkKIAkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gZGlzYWJsZSB0cmFuc2NvZGVyICVjXG4i
LCBwaXBlX25hbWUocGlwZSkpOwogCiAJaWYgKEhBU19QQ0hfQ1BUKGRldl9wcml2KSkgewpAQCAt
MTc1Nyw5ICsxNzQwLDcgQEAgdm9pZCBscHRfZGlzYWJsZV9wY2hfdHJhbnNjb2RlcihzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJdmFsICY9IH5UUkFOU19FTkFCTEU7CiAJSTkx
NV9XUklURShMUFRfVFJBTlNDT05GLCB2YWwpOwogCS8qIHdhaXQgZm9yIFBDSCB0cmFuc2NvZGVy
IG9mZiwgdHJhbnNjb2RlciBzdGF0ZSAqLwotCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3Rlcigm
ZGV2X3ByaXYtPnVuY29yZSwKLQkJCQkgICAgTFBUX1RSQU5TQ09ORiwgVFJBTlNfU1RBVEVfRU5B
QkxFLCAwLAotCQkJCSAgICA1MCkpCisJaWYgKGludGVsX2RlX3dhaXRfZm9yX2NsZWFyKGRldl9w
cml2LCBMUFRfVFJBTlNDT05GLCBUUkFOU19TVEFURV9FTkFCTEUsIDUwKSkKIAkJRFJNX0VSUk9S
KCJGYWlsZWQgdG8gZGlzYWJsZSBQQ0ggdHJhbnNjb2RlclxuIik7CiAKIAkvKiBXb3JrYXJvdW5k
OiBjbGVhciB0aW1pbmcgb3ZlcnJpZGUgYml0LiAqLwpAQCAtNTY5NCw5ICs1Njc1LDcgQEAgdm9p
ZCBoc3dfZW5hYmxlX2lwcyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSkKIAkJICogYW5kIGRvbid0IHdhaXQgZm9yIHZibGFua3MgdW50aWwgdGhlIGVuZCBvZiBjcnRj
X2VuYWJsZSwgdGhlbgogCQkgKiB0aGUgSFcgc3RhdGUgcmVhZG91dCBjb2RlIHdpbGwgY29tcGxh
aW4gdGhhdCB0aGUgZXhwZWN0ZWQKIAkJICogSVBTX0NUTCB2YWx1ZSBpcyBub3QgdGhlIG9uZSB3
ZSByZWFkLiAqLwotCQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNv
cmUsCi0JCQkJCSAgICBJUFNfQ1RMLCBJUFNfRU5BQkxFLCBJUFNfRU5BQkxFLAotCQkJCQkgICAg
NTApKQorCQlpZiAoaW50ZWxfZGVfd2FpdF9mb3Jfc2V0KGRldl9wcml2LCBJUFNfQ1RMLCBJUFNf
RU5BQkxFLCA1MCkpCiAJCQlEUk1fRVJST1IoIlRpbWVkIG91dCB3YWl0aW5nIGZvciBJUFMgZW5h
YmxlXG4iKTsKIAl9CiB9CkBAIC01NzE3LDkgKzU2OTYsNyBAQCB2b2lkIGhzd19kaXNhYmxlX2lw
cyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkJICogNDJtcyB0
aW1lb3V0IHZhbHVlIGxlYWRzIHRvIG9jY2FzaW9uYWwgdGltZW91dHMgc28gdXNlIDEwMG1zCiAJ
CSAqIGluc3RlYWQuCiAJCSAqLwotCQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9w
cml2LT51bmNvcmUsCi0JCQkJCSAgICBJUFNfQ1RMLCBJUFNfRU5BQkxFLCAwLAotCQkJCQkgICAg
MTAwKSkKKwkJaWYgKGludGVsX2RlX3dhaXRfZm9yX2NsZWFyKGRldl9wcml2LCBJUFNfQ1RMLCBJ
UFNfRU5BQkxFLCAxMDApKQogCQkJRFJNX0VSUk9SKCJUaW1lZCBvdXQgd2FpdGluZyBmb3IgSVBT
IGRpc2FibGVcbiIpOwogCX0gZWxzZSB7CiAJCUk5MTVfV1JJVEUoSVBTX0NUTCwgMCk7CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfcG93ZXIu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5jCmlu
ZGV4IGRiOTY4NTg4OGIxYy4uZDFmMmZmMzczNDczIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfcG93ZXIuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfcG93ZXIuYwpAQCAtMzIwLDExICszMjAsOCBA
QCBzdGF0aWMgdm9pZCBoc3dfd2FpdF9mb3JfcG93ZXJfd2VsbF9lbmFibGUoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAogCWludCBwd19pZHggPSBwb3dlcl93ZWxsLT5kZXNjLT5o
c3cuaWR4OwogCiAJLyogVGltZW91dCBmb3IgUFcxOjEwIHVzLCBBVVg6bm90IHNwZWNpZmllZCwg
b3RoZXIgUFdzOjIwIHVzLiAqLwotCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3By
aXYtPnVuY29yZSwKLQkJCQkgICAgcmVncy0+ZHJpdmVyLAotCQkJCSAgICBIU1dfUFdSX1dFTExf
Q1RMX1NUQVRFKHB3X2lkeCksCi0JCQkJICAgIEhTV19QV1JfV0VMTF9DVExfU1RBVEUocHdfaWR4
KSwKLQkJCQkgICAgMSkpIHsKKwlpZiAoaW50ZWxfZGVfd2FpdF9mb3Jfc2V0KGRldl9wcml2LCBy
ZWdzLT5kcml2ZXIsCisJCQkJICBIU1dfUFdSX1dFTExfQ1RMX1NUQVRFKHB3X2lkeCksIDEpKSB7
CiAJCURSTV9ERUJVR19LTVMoIiVzIHBvd2VyIHdlbGwgZW5hYmxlIHRpbWVvdXRcbiIsCiAJCQkg
ICAgICBwb3dlcl93ZWxsLT5kZXNjLT5uYW1lKTsKIApAQCAtMzgxLDkgKzM3OCw4IEBAIHN0YXRp
YyB2b2lkIGdlbjlfd2FpdF9mb3JfcG93ZXJfd2VsbF9mdXNlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCiAJCQkJCSAgIGVudW0gc2tsX3Bvd2VyX2dhdGUgcGcpCiB7CiAJLyog
VGltZW91dCA1dXMgZm9yIFBHIzAsIGZvciBvdGhlciBQR3MgMXVzICovCi0JV0FSTl9PTihpbnRl
bF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwgU0tMX0ZVU0VfU1RBVFVTLAot
CQkJCQlTS0xfRlVTRV9QR19ESVNUX1NUQVRVUyhwZyksCi0JCQkJCVNLTF9GVVNFX1BHX0RJU1Rf
U1RBVFVTKHBnKSwgMSkpOworCVdBUk5fT04oaW50ZWxfZGVfd2FpdF9mb3Jfc2V0KGRldl9wcml2
LCBTS0xfRlVTRV9TVEFUVVMsCisJCQkJICAgICAgU0tMX0ZVU0VfUEdfRElTVF9TVEFUVVMocGcp
LCAxKSk7CiB9CiAKIHN0YXRpYyB2b2lkIGhzd19wb3dlcl93ZWxsX2VuYWJsZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCkBAIC0xMzgxLDExICsxMzc3LDggQEAgc3RhdGljIHZv
aWQgYXNzZXJ0X2Nodl9waHlfc3RhdHVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dikKIAkgKiBUaGUgUEhZIG1heSBiZSBidXN5IHdpdGggc29tZSBpbml0aWFsIGNhbGlicmF0aW9u
IGFuZCB3aGF0bm90LAogCSAqIHNvIHRoZSBwb3dlciBzdGF0ZSBjYW4gdGFrZSBhIHdoaWxlIHRv
IGFjdHVhbGx5IGNoYW5nZS4KIAkgKi8KLQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRl
dl9wcml2LT51bmNvcmUsCi0JCQkJICAgIERJU1BMQVlfUEhZX1NUQVRVUywKLQkJCQkgICAgcGh5
X3N0YXR1c19tYXNrLAotCQkJCSAgICBwaHlfc3RhdHVzLAotCQkJCSAgICAxMCkpCisJaWYgKGlu
dGVsX2RlX3dhaXRfZm9yX3JlZ2lzdGVyKGRldl9wcml2LCBESVNQTEFZX1BIWV9TVEFUVVMsCisJ
CQkJICAgICAgIHBoeV9zdGF0dXNfbWFzaywgcGh5X3N0YXR1cywgMTApKQogCQlEUk1fRVJST1Io
IlVuZXhwZWN0ZWQgUEhZX1NUQVRVUyAweCUwOHgsIGV4cGVjdGVkIDB4JTA4eCAoUEhZX0NPTlRS
T0w9MHglMDh4KVxuIiwKIAkJCSAgSTkxNV9SRUFEKERJU1BMQVlfUEhZX1NUQVRVUykgJiBwaHlf
c3RhdHVzX21hc2ssCiAJCQkgICBwaHlfc3RhdHVzLCBkZXZfcHJpdi0+Y2h2X3BoeV9jb250cm9s
KTsKQEAgLTE0MTYsMTEgKzE0MDksOCBAQCBzdGF0aWMgdm9pZCBjaHZfZHBpb19jbW5fcG93ZXJf
d2VsbF9lbmFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCXZsdl9zZXRf
cG93ZXJfd2VsbChkZXZfcHJpdiwgcG93ZXJfd2VsbCwgdHJ1ZSk7CiAKIAkvKiBQb2xsIGZvciBw
aHlwd3Jnb29kIHNpZ25hbCAqLwotCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3By
aXYtPnVuY29yZSwKLQkJCQkgICAgRElTUExBWV9QSFlfU1RBVFVTLAotCQkJCSAgICBQSFlfUE9X
RVJHT09EKHBoeSksCi0JCQkJICAgIFBIWV9QT1dFUkdPT0QocGh5KSwKLQkJCQkgICAgMSkpCisJ
aWYgKGludGVsX2RlX3dhaXRfZm9yX3NldChkZXZfcHJpdiwgRElTUExBWV9QSFlfU1RBVFVTLAor
CQkJCSAgUEhZX1BPV0VSR09PRChwaHkpLCAxKSkKIAkJRFJNX0VSUk9SKCJEaXNwbGF5IFBIWSAl
ZCBpcyBub3QgcG93ZXIgdXBcbiIsIHBoeSk7CiAKIAl2bHZfZHBpb19nZXQoZGV2X3ByaXYpOwpA
QCAtNDMzMyw4ICs0MzIzLDcgQEAgc3RhdGljIHZvaWQgaHN3X2Rpc2FibGVfbGNwbGwoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCUk5MTVfV1JJVEUoTENQTExfQ1RMLCB2YWwp
OwogCVBPU1RJTkdfUkVBRChMQ1BMTF9DVEwpOwogCi0JaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lz
dGVyKCZkZXZfcHJpdi0+dW5jb3JlLCBMQ1BMTF9DVEwsCi0JCQkJICAgIExDUExMX1BMTF9MT0NL
LCAwLCAxKSkKKwlpZiAoaW50ZWxfZGVfd2FpdF9mb3JfY2xlYXIoZGV2X3ByaXYsIExDUExMX0NU
TCwgTENQTExfUExMX0xPQ0ssIDEpKQogCQlEUk1fRVJST1IoIkxDUExMIHN0aWxsIGxvY2tlZFxu
Iik7CiAKIAl2YWwgPSBoc3dfcmVhZF9kY29tcChkZXZfcHJpdik7CkBAIC00Mzg5LDggKzQzNzgs
NyBAQCBzdGF0aWMgdm9pZCBoc3dfcmVzdG9yZV9sY3BsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCiAJdmFsICY9IH5MQ1BMTF9QTExfRElTQUJMRTsKIAlJOTE1X1dSSVRFKExD
UExMX0NUTCwgdmFsKTsKIAotCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYt
PnVuY29yZSwgTENQTExfQ1RMLAotCQkJCSAgICBMQ1BMTF9QTExfTE9DSywgTENQTExfUExMX0xP
Q0ssIDUpKQorCWlmIChpbnRlbF9kZV93YWl0X2Zvcl9zZXQoZGV2X3ByaXYsIExDUExMX0NUTCwg
TENQTExfUExMX0xPQ0ssIDUpKQogCQlEUk1fRVJST1IoIkxDUExMIG5vdCBsb2NrZWQgeWV0XG4i
KTsKIAogCWlmICh2YWwgJiBMQ1BMTF9DRF9TT1VSQ0VfRkNMSykgewpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kcC5jCmluZGV4IGZhZjg3ZWNkYzIxMy4uZmJlYThlZDgzNzk1IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCkBAIC0yMzcyLDkgKzIzNzIs
NyBAQCBzdGF0aWMgdm9pZCB3YWl0X3BhbmVsX3N0YXR1cyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwLAogCQkJSTkxNV9SRUFEKHBwX3N0YXRfcmVnKSwKIAkJCUk5MTVfUkVBRChwcF9jdHJsX3Jl
ZykpOwogCi0JaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLAot
CQkJCSAgICBwcF9zdGF0X3JlZywgbWFzaywgdmFsdWUsCi0JCQkJICAgIDUwMDApKQorCWlmIChp
bnRlbF9kZV93YWl0X2Zvcl9yZWdpc3RlcihkZXZfcHJpdiwgcHBfc3RhdF9yZWcsIG1hc2ssIHZh
bHVlLCA1MDAwKSkKIAkJRFJNX0VSUk9SKCJQYW5lbCBzdGF0dXMgdGltZW91dDogc3RhdHVzICUw
OHggY29udHJvbCAlMDh4XG4iLAogCQkJCUk5MTVfUkVBRChwcF9zdGF0X3JlZyksCiAJCQkJSTkx
NV9SRUFEKHBwX2N0cmxfcmVnKSk7CkBAIC0zOTYxLDEwICszOTU5LDggQEAgdm9pZCBpbnRlbF9k
cF9zZXRfaWRsZV9saW5rX3RyYWluKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJaWYgKHBv
cnQgPT0gUE9SVF9BKQogCQlyZXR1cm47CiAKLQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIo
JmRldl9wcml2LT51bmNvcmUsIERQX1RQX1NUQVRVUyhwb3J0KSwKLQkJCQkgICAgRFBfVFBfU1RB
VFVTX0lETEVfRE9ORSwKLQkJCQkgICAgRFBfVFBfU1RBVFVTX0lETEVfRE9ORSwKLQkJCQkgICAg
MSkpCisJaWYgKGludGVsX2RlX3dhaXRfZm9yX3NldChkZXZfcHJpdiwgRFBfVFBfU1RBVFVTKHBv
cnQpLAorCQkJCSAgRFBfVFBfU1RBVFVTX0lETEVfRE9ORSwgMSkpCiAJCURSTV9FUlJPUigiVGlt
ZWQgb3V0IHdhaXRpbmcgZm9yIERQIGlkbGUgcGF0dGVybnNcbiIpOwogfQogCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX21zdC5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9tc3QuYwppbmRleCAwNzFhOTc2YzEyMTkuLjVj
MTgyOWE5N2NmMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kcF9tc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX21z
dC5jCkBAIC0zMzksMTEgKzMzOSw4IEBAIHN0YXRpYyB2b2lkIGludGVsX21zdF9lbmFibGVfZHAo
c3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAKIAlEUk1fREVCVUdfS01TKCJhY3RpdmUg
bGlua3MgJWRcbiIsIGludGVsX2RwLT5hY3RpdmVfbXN0X2xpbmtzKTsKIAotCWlmIChpbnRlbF93
YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwKLQkJCQkgICAgRFBfVFBfU1RBVFVT
KHBvcnQpLAotCQkJCSAgICBEUF9UUF9TVEFUVVNfQUNUX1NFTlQsCi0JCQkJICAgIERQX1RQX1NU
QVRVU19BQ1RfU0VOVCwKLQkJCQkgICAgMSkpCisJaWYgKGludGVsX2RlX3dhaXRfZm9yX3NldChk
ZXZfcHJpdiwgRFBfVFBfU1RBVFVTKHBvcnQpLAorCQkJCSAgRFBfVFBfU1RBVFVTX0FDVF9TRU5U
LCAxKSkKIAkJRFJNX0VSUk9SKCJUaW1lZCBvdXQgd2FpdGluZyBmb3IgQUNUIHNlbnRcbiIpOwog
CiAJZHJtX2RwX2NoZWNrX2FjdF9zdGF0dXMoJmludGVsX2RwLT5tc3RfbWdyKTsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBpb19waHkuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBpb19waHkuYwppbmRleCA4ODc0NTQ3OTM0
OTAuLjE4Zjg0YzRhZDYxMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kcGlvX3BoeS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZHBpb19waHkuYwpAQCAtMzQ2LDEwICszNDYsNyBAQCBzdGF0aWMgdTMyIGJ4dF9nZXRfZ3Jj
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBkcGlvX3BoeSBwaHkpCiBz
dGF0aWMgdm9pZCBieHRfcGh5X3dhaXRfZ3JjX2RvbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogCQkJCSAgZW51bSBkcGlvX3BoeSBwaHkpCiB7Ci0JaWYgKGludGVsX3dhaXRf
Zm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLAotCQkJCSAgICBCWFRfUE9SVF9SRUZfRFcz
KHBoeSksCi0JCQkJICAgIEdSQ19ET05FLCBHUkNfRE9ORSwKLQkJCQkgICAgMTApKQorCWlmIChp
bnRlbF9kZV93YWl0X2Zvcl9zZXQoZGV2X3ByaXYsIEJYVF9QT1JUX1JFRl9EVzMocGh5KSwgR1JD
X0RPTkUsIDEwKSkKIAkJRFJNX0VSUk9SKCJ0aW1lb3V0IHdhaXRpbmcgZm9yIFBIWSVkIEdSQ1xu
IiwgcGh5KTsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kcGxsX21nci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcGxs
X21nci5jCmluZGV4IDRiM2M1YWFlYmE4My4uNzliMzMzYmFmYzZhIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwbGxfbWdyLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcGxsX21nci5jCkBAIC0xMDAxLDExICsxMDAxLDcg
QEAgc3RhdGljIHZvaWQgc2tsX2RkaV9wbGxfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIAlJOTE1X1dSSVRFKHJlZ3NbaWRdLmN0bCwKIAkJICAgSTkxNV9SRUFEKHJl
Z3NbaWRdLmN0bCkgfCBMQ1BMTF9QTExfRU5BQkxFKTsKIAotCWlmIChpbnRlbF93YWl0X2Zvcl9y
ZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwKLQkJCQkgICAgRFBMTF9TVEFUVVMsCi0JCQkJICAg
IERQTExfTE9DSyhpZCksCi0JCQkJICAgIERQTExfTE9DSyhpZCksCi0JCQkJICAgIDUpKQorCWlm
IChpbnRlbF9kZV93YWl0X2Zvcl9zZXQoZGV2X3ByaXYsIERQTExfU1RBVFVTLCBEUExMX0xPQ0so
aWQpLCA1KSkKIAkJRFJNX0VSUk9SKCJEUExMICVkIG5vdCBsb2NrZWRcbiIsIGlkKTsKIH0KIApA
QCAtMjAxNywxMSArMjAxMyw4IEBAIHN0YXRpYyB2b2lkIGNubF9kZGlfcGxsX2VuYWJsZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJSTkxNV9XUklURShDTkxfRFBMTF9FTkFC
TEUoaWQpLCB2YWwpOwogCiAJLyogMi4gV2FpdCBmb3IgRFBMTCBwb3dlciBzdGF0ZSBlbmFibGVk
IGluIERQTExfRU5BQkxFLiAqLwotCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3By
aXYtPnVuY29yZSwKLQkJCQkgICAgQ05MX0RQTExfRU5BQkxFKGlkKSwKLQkJCQkgICAgUExMX1BP
V0VSX1NUQVRFLAotCQkJCSAgICBQTExfUE9XRVJfU1RBVEUsCi0JCQkJICAgIDUpKQorCWlmIChp
bnRlbF9kZV93YWl0X2Zvcl9zZXQoZGV2X3ByaXYsIENOTF9EUExMX0VOQUJMRShpZCksCisJCQkJ
ICBQTExfUE9XRVJfU1RBVEUsIDUpKQogCQlEUk1fRVJST1IoIlBMTCAlZCBQb3dlciBub3QgZW5h
YmxlZFxuIiwgaWQpOwogCiAJLyoKQEAgLTIwNTgsMTEgKzIwNTEsNyBAQCBzdGF0aWMgdm9pZCBj
bmxfZGRpX3BsbF9lbmFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCUk5
MTVfV1JJVEUoQ05MX0RQTExfRU5BQkxFKGlkKSwgdmFsKTsKIAogCS8qIDcuIFdhaXQgZm9yIFBM
TCBsb2NrIHN0YXR1cyBpbiBEUExMX0VOQUJMRS4gKi8KLQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVn
aXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCi0JCQkJICAgIENOTF9EUExMX0VOQUJMRShpZCksCi0J
CQkJICAgIFBMTF9MT0NLLAotCQkJCSAgICBQTExfTE9DSywKLQkJCQkgICAgNSkpCisJaWYgKGlu
dGVsX2RlX3dhaXRfZm9yX3NldChkZXZfcHJpdiwgQ05MX0RQTExfRU5BQkxFKGlkKSwgUExMX0xP
Q0ssIDUpKQogCQlEUk1fRVJST1IoIlBMTCAlZCBub3QgbG9ja2VkXG4iLCBpZCk7CiAKIAkvKgpA
QCAtMjEwNiwxMSArMjA5NSw3IEBAIHN0YXRpYyB2b2lkIGNubF9kZGlfcGxsX2Rpc2FibGUoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCUk5MTVfV1JJVEUoQ05MX0RQTExfRU5B
QkxFKGlkKSwgdmFsKTsKIAogCS8qIDQuIFdhaXQgZm9yIFBMTCBub3QgbG9ja2VkIHN0YXR1cyBp
biBEUExMX0VOQUJMRS4gKi8KLQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2
LT51bmNvcmUsCi0JCQkJICAgIENOTF9EUExMX0VOQUJMRShpZCksCi0JCQkJICAgIFBMTF9MT0NL
LAotCQkJCSAgICAwLAotCQkJCSAgICA1KSkKKwlpZiAoaW50ZWxfZGVfd2FpdF9mb3JfY2xlYXIo
ZGV2X3ByaXYsIENOTF9EUExMX0VOQUJMRShpZCksIFBMTF9MT0NLLCA1KSkKIAkJRFJNX0VSUk9S
KCJQTEwgJWQgbG9ja2VkXG4iLCBpZCk7CiAKIAkvKgpAQCAtMjEyOCwxMSArMjExMyw4IEBAIHN0
YXRpYyB2b2lkIGNubF9kZGlfcGxsX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAogCUk5MTVfV1JJVEUoQ05MX0RQTExfRU5BQkxFKGlkKSwgdmFsKTsKIAogCS8qIDcu
IFdhaXQgZm9yIERQTEwgcG93ZXIgc3RhdGUgZGlzYWJsZWQgaW4gRFBMTF9FTkFCTEUuICovCi0J
aWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLAotCQkJCSAgICBD
TkxfRFBMTF9FTkFCTEUoaWQpLAotCQkJCSAgICBQTExfUE9XRVJfU1RBVEUsCi0JCQkJICAgIDAs
Ci0JCQkJICAgIDUpKQorCWlmIChpbnRlbF9kZV93YWl0X2Zvcl9jbGVhcihkZXZfcHJpdiwgQ05M
X0RQTExfRU5BQkxFKGlkKSwKKwkJCQkgICAgUExMX1BPV0VSX1NUQVRFLCA1KSkKIAkJRFJNX0VS
Uk9SKCJQTEwgJWQgUG93ZXIgbm90IGRpc2FibGVkXG4iLCBpZCk7CiB9CiAKQEAgLTMyNTMsOCAr
MzIzNSw3IEBAIHN0YXRpYyB2b2lkIGljbF9wbGxfcG93ZXJfZW5hYmxlKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKIAkgKiBUaGUgc3BlYyBzYXlzIHdlIG5lZWQgdG8gIndhaXQi
IGJ1dCBpdCBhbHNvIHNheXMgaXQgc2hvdWxkIGJlCiAJICogaW1tZWRpYXRlLgogCSAqLwotCWlm
IChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwgZW5hYmxlX3JlZywK
LQkJCQkgICAgUExMX1BPV0VSX1NUQVRFLCBQTExfUE9XRVJfU1RBVEUsIDEpKQorCWlmIChpbnRl
bF9kZV93YWl0X2Zvcl9zZXQoZGV2X3ByaXYsIGVuYWJsZV9yZWcsIFBMTF9QT1dFUl9TVEFURSwg
MSkpCiAJCURSTV9FUlJPUigiUExMICVkIFBvd2VyIG5vdCBlbmFibGVkXG4iLCBwbGwtPmluZm8t
PmlkKTsKIH0KIApAQCAtMzI2OSw4ICszMjUwLDcgQEAgc3RhdGljIHZvaWQgaWNsX3BsbF9lbmFi
bGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCUk5MTVfV1JJVEUoZW5hYmxl
X3JlZywgdmFsKTsKIAogCS8qIFRpbWVvdXQgaXMgYWN0dWFsbHkgNjAwdXMuICovCi0JaWYgKGlu
dGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLCBlbmFibGVfcmVnLAotCQkJ
CSAgICBQTExfTE9DSywgUExMX0xPQ0ssIDEpKQorCWlmIChpbnRlbF9kZV93YWl0X2Zvcl9zZXQo
ZGV2X3ByaXYsIGVuYWJsZV9yZWcsIFBMTF9MT0NLLCAxKSkKIAkJRFJNX0VSUk9SKCJQTEwgJWQg
bm90IGxvY2tlZFxuIiwgcGxsLT5pbmZvLT5pZCk7CiB9CiAKQEAgLTMzNjUsOCArMzM0NSw3IEBA
IHN0YXRpYyB2b2lkIGljbF9wbGxfZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCiAJSTkxNV9XUklURShlbmFibGVfcmVnLCB2YWwpOwogCiAJLyogVGltZW91dCBpcyBh
Y3R1YWxseSAxdXMuICovCi0JaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+
dW5jb3JlLAotCQkJCSAgICBlbmFibGVfcmVnLCBQTExfTE9DSywgMCwgMSkpCisJaWYgKGludGVs
X2RlX3dhaXRfZm9yX2NsZWFyKGRldl9wcml2LCBlbmFibGVfcmVnLCBQTExfTE9DSywgMSkpCiAJ
CURSTV9FUlJPUigiUExMICVkIGxvY2tlZFxuIiwgcGxsLT5pbmZvLT5pZCk7CiAKIAkvKiBEVkZT
IHBvc3Qgc2VxdWVuY2Ugd291bGQgYmUgaGVyZS4gU2VlIHRoZSBjb21tZW50IGFib3ZlLiAqLwpA
QCAtMzM3OSw4ICszMzU4LDcgQEAgc3RhdGljIHZvaWQgaWNsX3BsbF9kaXNhYmxlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkgKiBUaGUgc3BlYyBzYXlzIHdlIG5lZWQgdG8g
IndhaXQiIGJ1dCBpdCBhbHNvIHNheXMgaXQgc2hvdWxkIGJlCiAJICogaW1tZWRpYXRlLgogCSAq
LwotCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwKLQkJCQkg
ICAgZW5hYmxlX3JlZywgUExMX1BPV0VSX1NUQVRFLCAwLCAxKSkKKwlpZiAoaW50ZWxfZGVfd2Fp
dF9mb3JfY2xlYXIoZGV2X3ByaXYsIGVuYWJsZV9yZWcsIFBMTF9QT1dFUl9TVEFURSwgMSkpCiAJ
CURSTV9FUlJPUigiUExMICVkIFBvd2VyIG5vdCBkaXNhYmxlZFxuIiwgcGxsLT5pbmZvLT5pZCk7
CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJj
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiYy5jCmluZGV4IDU1Nzli
NGViNDU2My4uOWMyOWI4MmQzNTAwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2ZiYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZmJjLmMKQEAgLTExMSw5ICsxMTEsNyBAQCBzdGF0aWMgdm9pZCBpOHh4X2ZiY19kZWFjdGl2
YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlJOTE1X1dSSVRFKEZCQ19D
T05UUk9MLCBmYmNfY3RsKTsKIAogCS8qIFdhaXQgZm9yIGNvbXByZXNzaW5nIGJpdCB0byBjbGVh
ciAqLwotCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwKLQkJ
CQkgICAgRkJDX1NUQVRVUywgRkJDX1NUQVRfQ09NUFJFU1NJTkcsIDAsCi0JCQkJICAgIDEwKSkg
eworCWlmIChpbnRlbF9kZV93YWl0X2Zvcl9jbGVhcihkZXZfcHJpdiwgRkJDX1NUQVRVUywgRkJD
X1NUQVRfQ09NUFJFU1NJTkcsIDEwKSkgewogCQlEUk1fREVCVUdfS01TKCJGQkMgaWRsZSB0aW1l
ZCBvdXRcbiIpOwogCQlyZXR1cm47CiAJfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9oZGNwLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2hkY3AuYwppbmRleCAwYmViOTU0YjUzMTguLjgzZTQ4NWIyZTZkNSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9oZGNwLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9oZGNwLmMKQEAgLTI0NSw4ICsyNDUsNyBAQCBzdGF0
aWMgaW50IGludGVsX2hkY3BfbG9hZF9rZXlzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIHN0YXRpYyBpbnQgaW50ZWxfd3JpdGVfc2hhX3RleHQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LCB1MzIgc2hhX3RleHQpCiB7CiAJSTkxNV9XUklURShIRENQX1NIQV9U
RVhULCBzaGFfdGV4dCk7Ci0JaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+
dW5jb3JlLCBIRENQX1JFUF9DVEwsCi0JCQkJICAgIEhEQ1BfU0hBMV9SRUFEWSwgSERDUF9TSEEx
X1JFQURZLCAxKSkgeworCWlmIChpbnRlbF9kZV93YWl0X2Zvcl9zZXQoZGV2X3ByaXYsIEhEQ1Bf
UkVQX0NUTCwgSERDUF9TSEExX1JFQURZLCAxKSkgewogCQlEUk1fRVJST1IoIlRpbWVkIG91dCB3
YWl0aW5nIGZvciBTSEExIHJlYWR5XG4iKTsKIAkJcmV0dXJuIC1FVElNRURPVVQ7CiAJfQpAQCAt
NDc2LDkgKzQ3NSw3IEBAIGludCBpbnRlbF9oZGNwX3ZhbGlkYXRlX3ZfcHJpbWUoc3RydWN0IGlu
dGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3BvcnQsCiAKIAkvKiBUZWxsIHRoZSBIVyB3ZSdy
ZSBkb25lIHdpdGggdGhlIGhhc2ggYW5kIHdhaXQgZm9yIGl0IHRvIEFDSyAqLwogCUk5MTVfV1JJ
VEUoSERDUF9SRVBfQ1RMLCByZXBfY3RsIHwgSERDUF9TSEExX0NPTVBMRVRFX0hBU0gpOwotCWlm
IChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwgSERDUF9SRVBfQ1RM
LAotCQkJCSAgICBIRENQX1NIQTFfQ09NUExFVEUsCi0JCQkJICAgIEhEQ1BfU0hBMV9DT01QTEVU
RSwgMSkpIHsKKwlpZiAoaW50ZWxfZGVfd2FpdF9mb3Jfc2V0KGRldl9wcml2LCBIRENQX1JFUF9D
VEwsIEhEQ1BfU0hBMV9DT01QTEVURSwgMSkpIHsKIAkJRFJNX0VSUk9SKCJUaW1lZCBvdXQgd2Fp
dGluZyBmb3IgU0hBMSBjb21wbGV0ZVxuIik7CiAJCXJldHVybiAtRVRJTUVET1VUOwogCX0KQEAg
LTYyMSw5ICs2MTgsOCBAQCBzdGF0aWMgaW50IGludGVsX2hkY3BfYXV0aChzdHJ1Y3QgaW50ZWxf
Y29ubmVjdG9yICpjb25uZWN0b3IpCiAJSTkxNV9XUklURShQT1JUX0hEQ1BfQ09ORihwb3J0KSwg
SERDUF9DT05GX0NBUFRVUkVfQU4pOwogCiAJLyogV2FpdCBmb3IgQW4gdG8gYmUgYWNxdWlyZWQg
Ki8KLQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsIFBPUlRf
SERDUF9TVEFUVVMocG9ydCksCi0JCQkJICAgIEhEQ1BfU1RBVFVTX0FOX1JFQURZLAotCQkJCSAg
ICBIRENQX1NUQVRVU19BTl9SRUFEWSwgMSkpIHsKKwlpZiAoaW50ZWxfZGVfd2FpdF9mb3Jfc2V0
KGRldl9wcml2LCBQT1JUX0hEQ1BfU1RBVFVTKHBvcnQpLAorCQkJCSAgSERDUF9TVEFUVVNfQU5f
UkVBRFksIDEpKSB7CiAJCURSTV9FUlJPUigiVGltZWQgb3V0IHdhaXRpbmcgZm9yIEFuXG4iKTsK
IAkJcmV0dXJuIC1FVElNRURPVVQ7CiAJfQpAQCAtNzA3LDkgKzcwMyw5IEBAIHN0YXRpYyBpbnQg
aW50ZWxfaGRjcF9hdXRoKHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikKIAl9CiAK
IAkvKiBXYWl0IGZvciBlbmNyeXB0aW9uIGNvbmZpcm1hdGlvbiAqLwotCWlmIChpbnRlbF93YWl0
X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwgUE9SVF9IRENQX1NUQVRVUyhwb3J0KSwK
LQkJCQkgICAgSERDUF9TVEFUVVNfRU5DLCBIRENQX1NUQVRVU19FTkMsCi0JCQkJICAgIEVOQ1JZ
UFRfU1RBVFVTX0NIQU5HRV9USU1FT1VUX01TKSkgeworCWlmIChpbnRlbF9kZV93YWl0X2Zvcl9z
ZXQoZGV2X3ByaXYsIFBPUlRfSERDUF9TVEFUVVMocG9ydCksCisJCQkJICBIRENQX1NUQVRVU19F
TkMsCisJCQkJICBFTkNSWVBUX1NUQVRVU19DSEFOR0VfVElNRU9VVF9NUykpIHsKIAkJRFJNX0VS
Uk9SKCJUaW1lZCBvdXQgd2FpdGluZyBmb3IgZW5jcnlwdGlvblxuIik7CiAJCXJldHVybiAtRVRJ
TUVET1VUOwogCX0KQEAgLTczOSw4ICs3MzUsNyBAQCBzdGF0aWMgaW50IF9pbnRlbF9oZGNwX2Rp
c2FibGUoc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yKQogCiAJaGRjcC0+aGRjcF9l
bmNyeXB0ZWQgPSBmYWxzZTsKIAlJOTE1X1dSSVRFKFBPUlRfSERDUF9DT05GKHBvcnQpLCAwKTsK
LQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCi0JCQkJICAg
IFBPUlRfSERDUF9TVEFUVVMocG9ydCksIH4wLCAwLAorCWlmIChpbnRlbF9kZV93YWl0X2Zvcl9j
bGVhcihkZXZfcHJpdiwgUE9SVF9IRENQX1NUQVRVUyhwb3J0KSwgfjAsCiAJCQkJICAgIEVOQ1JZ
UFRfU1RBVFVTX0NIQU5HRV9USU1FT1VUX01TKSkgewogCQlEUk1fRVJST1IoIkZhaWxlZCB0byBk
aXNhYmxlIEhEQ1AsIHRpbWVvdXQgY2xlYXJpbmcgc3RhdHVzXG4iKTsKIAkJcmV0dXJuIC1FVElN
RURPVVQ7CkBAIC0xNTE3LDEwICsxNTEyLDkgQEAgc3RhdGljIGludCBoZGNwMl9lbmFibGVfZW5j
cnlwdGlvbihzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IpCiAJCQkgICBDVExfTElO
S19FTkNSWVBUSU9OX1JFUSk7CiAJfQogCi0JcmV0ID0gaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIo
JmRldl9wcml2LT51bmNvcmUsIEhEQ1AyX1NUQVRVU19EREkocG9ydCksCi0JCQkJICAgICAgTElO
S19FTkNSWVBUSU9OX1NUQVRVUywKLQkJCQkgICAgICBMSU5LX0VOQ1JZUFRJT05fU1RBVFVTLAot
CQkJCSAgICAgIEVOQ1JZUFRfU1RBVFVTX0NIQU5HRV9USU1FT1VUX01TKTsKKwlyZXQgPSBpbnRl
bF9kZV93YWl0X2Zvcl9zZXQoZGV2X3ByaXYsIEhEQ1AyX1NUQVRVU19EREkocG9ydCksCisJCQkJ
ICAgIExJTktfRU5DUllQVElPTl9TVEFUVVMsCisJCQkJICAgIEVOQ1JZUFRfU1RBVFVTX0NIQU5H
RV9USU1FT1VUX01TKTsKIAogCXJldHVybiByZXQ7CiB9CkBAIC0xNTM4LDggKzE1MzIsOCBAQCBz
dGF0aWMgaW50IGhkY3AyX2Rpc2FibGVfZW5jcnlwdGlvbihzdHJ1Y3QgaW50ZWxfY29ubmVjdG9y
ICpjb25uZWN0b3IpCiAJSTkxNV9XUklURShIRENQMl9DVExfRERJKHBvcnQpLAogCQkgICBJOTE1
X1JFQUQoSERDUDJfQ1RMX0RESShwb3J0KSkgJiB+Q1RMX0xJTktfRU5DUllQVElPTl9SRVEpOwog
Ci0JcmV0ID0gaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsIEhEQ1Ay
X1NUQVRVU19EREkocG9ydCksCi0JCQkJICAgICAgTElOS19FTkNSWVBUSU9OX1NUQVRVUywgMHgw
LAorCXJldCA9IGludGVsX2RlX3dhaXRfZm9yX2NsZWFyKGRldl9wcml2LCBIRENQMl9TVEFUVVNf
RERJKHBvcnQpLAorCQkJCSAgICAgIExJTktfRU5DUllQVElPTl9TVEFUVVMsCiAJCQkJICAgICAg
RU5DUllQVF9TVEFUVVNfQ0hBTkdFX1RJTUVPVVRfTVMpOwogCWlmIChyZXQgPT0gLUVUSU1FRE9V
VCkKIAkJRFJNX0RFQlVHX0tNUygiRGlzYWJsZSBFbmNyeXB0aW9uIFRpbWVkb3V0Iik7CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2x2ZHMuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfbHZkcy5jCmluZGV4IDkxNWU5NDcxOGEyMy4u
ZmU2NGZiNDk4N2IwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2x2ZHMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2x2ZHMu
YwpAQCAtMzE5LDggKzMxOSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2VuYWJsZV9sdmRzKHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCUk5MTVfV1JJVEUoUFBfQ09OVFJPTCgwKSwgSTkx
NV9SRUFEKFBQX0NPTlRST0woMCkpIHwgUEFORUxfUE9XRVJfT04pOwogCVBPU1RJTkdfUkVBRChs
dmRzX2VuY29kZXItPnJlZyk7CiAKLQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9w
cml2LT51bmNvcmUsCi0JCQkJICAgIFBQX1NUQVRVUygwKSwgUFBfT04sIFBQX09OLCA1MDAwKSkK
KwlpZiAoaW50ZWxfZGVfd2FpdF9mb3Jfc2V0KGRldl9wcml2LCBQUF9TVEFUVVMoMCksIFBQX09O
LCA1MDAwKSkKIAkJRFJNX0VSUk9SKCJ0aW1lZCBvdXQgd2FpdGluZyBmb3IgcGFuZWwgdG8gcG93
ZXIgb25cbiIpOwogCiAJaW50ZWxfcGFuZWxfZW5hYmxlX2JhY2tsaWdodChwaXBlX2NvbmZpZywg
Y29ubl9zdGF0ZSk7CkBAIC0zMzQsOCArMzMzLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZGlzYWJs
ZV9sdmRzKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCiAJSTkxNV9X
UklURShQUF9DT05UUk9MKDApLCBJOTE1X1JFQUQoUFBfQ09OVFJPTCgwKSkgJiB+UEFORUxfUE9X
RVJfT04pOwotCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwK
LQkJCQkgICAgUFBfU1RBVFVTKDApLCBQUF9PTiwgMCwgMTAwMCkpCisJaWYgKGludGVsX2RlX3dh
aXRfZm9yX2NsZWFyKGRldl9wcml2LCBQUF9TVEFUVVMoMCksIFBQX09OLCAxMDAwKSkKIAkJRFJN
X0VSUk9SKCJ0aW1lZCBvdXQgd2FpdGluZyBmb3IgcGFuZWwgdG8gcG93ZXIgb2ZmXG4iKTsKIAog
CUk5MTVfV1JJVEUobHZkc19lbmNvZGVyLT5yZWcsIEk5MTVfUkVBRChsdmRzX2VuY29kZXItPnJl
ZykgJiB+TFZEU19QT1JUX0VOKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfcHNyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bz
ci5jCmluZGV4IDExOWEyZmI4ZDc4MS4uNGIzNDBkNzY1N2UwIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmMKQEAgLTgyNiw4ICs4MjYsNyBAQCBzdGF0aWMgdm9pZCBp
bnRlbF9wc3JfZGlzYWJsZV9sb2NrZWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAl9CiAK
IAkvKiBXYWl0IHRpbGwgUFNSIGlzIGlkbGUgKi8KLQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0
ZXIoJmRldl9wcml2LT51bmNvcmUsCi0JCQkJICAgIHBzcl9zdGF0dXMsIHBzcl9zdGF0dXNfbWFz
aywgMCwgMjAwMCkpCisJaWYgKGludGVsX2RlX3dhaXRfZm9yX2NsZWFyKGRldl9wcml2LCBwc3Jf
c3RhdHVzLCBwc3Jfc3RhdHVzX21hc2ssIDIwMDApKQogCQlEUk1fRVJST1IoIlRpbWVkIG91dCB3
YWl0aW5nIFBTUiBpZGxlIHN0YXRlXG4iKTsKIAogCS8qIERpc2FibGUgUFNSIG9uIFNpbmsgKi8K
QEAgLTk4OSw3ICs5ODgsNyBAQCBzdGF0aWMgYm9vbCBfX3Bzcl93YWl0X2Zvcl9pZGxlX2xvY2tl
ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAKIAltdXRleF91bmxvY2soJmRl
dl9wcml2LT5wc3IubG9jayk7CiAKLQllcnIgPSBpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2
X3ByaXYtPnVuY29yZSwgcmVnLCBtYXNrLCAwLCA1MCk7CisJZXJyID0gaW50ZWxfZGVfd2FpdF9m
b3JfY2xlYXIoZGV2X3ByaXYsIHJlZywgbWFzaywgNTApOwogCWlmIChlcnIpCiAJCURSTV9FUlJP
UigiVGltZWQgb3V0IHdhaXRpbmcgZm9yIFBTUiBJZGxlIGZvciByZS1lbmFibGVcbiIpOwogCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L3Zsdl9kc2kuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvdmx2X2RzaS5jCmluZGV4IGRiOWI1YWI2YzgwZi4uODdi
ZGFiZDc0M2IwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L3Zsdl9k
c2kuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L3Zsdl9kc2kuYwpAQCAtODUs
OSArODUsNyBAQCB2b2lkIHZsdl9kc2lfd2FpdF9mb3JfZmlmb19lbXB0eShzdHJ1Y3QgaW50ZWxf
ZHNpICppbnRlbF9kc2ksIGVudW0gcG9ydCBwb3J0KQogCW1hc2sgPSBMUF9DVFJMX0ZJRk9fRU1Q
VFkgfCBIU19DVFJMX0ZJRk9fRU1QVFkgfAogCQlMUF9EQVRBX0ZJRk9fRU1QVFkgfCBIU19EQVRB
X0ZJRk9fRU1QVFk7CiAKLQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51
bmNvcmUsCi0JCQkJICAgIE1JUElfR0VOX0ZJRk9fU1RBVChwb3J0KSwgbWFzaywgbWFzaywKLQkJ
CQkgICAgMTAwKSkKKwlpZiAoaW50ZWxfZGVfd2FpdF9mb3Jfc2V0KGRldl9wcml2LCBNSVBJX0dF
Tl9GSUZPX1NUQVQocG9ydCksIG1hc2ssIDEwMCkpCiAJCURSTV9FUlJPUigiRFBJIEZJRk9zIGFy
ZSBub3QgZW1wdHlcbiIpOwogfQogCkBAIC0xNTUsMTAgKzE1Myw4IEBAIHN0YXRpYyBzc2l6ZV90
IGludGVsX2RzaV9ob3N0X3RyYW5zZmVyKHN0cnVjdCBtaXBpX2RzaV9ob3N0ICpob3N0LAogCiAJ
Lyogbm90ZTogdGhpcyBpcyBuZXZlciB0cnVlIGZvciByZWFkcyAqLwogCWlmIChwYWNrZXQucGF5
bG9hZF9sZW5ndGgpIHsKLQkJaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+
dW5jb3JlLAotCQkJCQkgICAgTUlQSV9HRU5fRklGT19TVEFUKHBvcnQpLAotCQkJCQkgICAgZGF0
YV9tYXNrLCAwLAotCQkJCQkgICAgNTApKQorCQlpZiAoaW50ZWxfZGVfd2FpdF9mb3JfY2xlYXIo
ZGV2X3ByaXYsIE1JUElfR0VOX0ZJRk9fU1RBVChwb3J0KSwKKwkJCQkJICAgIGRhdGFfbWFzaywg
NTApKQogCQkJRFJNX0VSUk9SKCJUaW1lb3V0IHdhaXRpbmcgZm9yIEhTL0xQIERBVEEgRklGTyAh
ZnVsbFxuIik7CiAKIAkJd3JpdGVfZGF0YShkZXZfcHJpdiwgZGF0YV9yZWcsIHBhY2tldC5wYXls
b2FkLApAQCAtMTY5LDEwICsxNjUsOCBAQCBzdGF0aWMgc3NpemVfdCBpbnRlbF9kc2lfaG9zdF90
cmFuc2ZlcihzdHJ1Y3QgbWlwaV9kc2lfaG9zdCAqaG9zdCwKIAkJSTkxNV9XUklURShNSVBJX0lO
VFJfU1RBVChwb3J0KSwgR0VOX1JFQURfREFUQV9BVkFJTCk7CiAJfQogCi0JaWYgKGludGVsX3dh
aXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLAotCQkJCSAgICBNSVBJX0dFTl9GSUZP
X1NUQVQocG9ydCksCi0JCQkJICAgIGN0cmxfbWFzaywgMCwKLQkJCQkgICAgNTApKSB7CisJaWYg
KGludGVsX2RlX3dhaXRfZm9yX2NsZWFyKGRldl9wcml2LCBNSVBJX0dFTl9GSUZPX1NUQVQocG9y
dCksCisJCQkJICAgIGN0cmxfbWFzaywgNTApKSB7CiAJCURSTV9FUlJPUigiVGltZW91dCB3YWl0
aW5nIGZvciBIUy9MUCBDVFJMIEZJRk8gIWZ1bGxcbiIpOwogCX0KIApAQCAtMTgxLDEwICsxNzUs
OCBAQCBzdGF0aWMgc3NpemVfdCBpbnRlbF9kc2lfaG9zdF90cmFuc2ZlcihzdHJ1Y3QgbWlwaV9k
c2lfaG9zdCAqaG9zdCwKIAkvKiAtPnJ4X2xlbiBpcyBzZXQgb25seSBmb3IgcmVhZHMgKi8KIAlp
ZiAobXNnLT5yeF9sZW4pIHsKIAkJZGF0YV9tYXNrID0gR0VOX1JFQURfREFUQV9BVkFJTDsKLQkJ
aWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLAotCQkJCQkgICAg
TUlQSV9JTlRSX1NUQVQocG9ydCksCi0JCQkJCSAgICBkYXRhX21hc2ssIGRhdGFfbWFzaywKLQkJ
CQkJICAgIDUwKSkKKwkJaWYgKGludGVsX2RlX3dhaXRfZm9yX3NldChkZXZfcHJpdiwgTUlQSV9J
TlRSX1NUQVQocG9ydCksCisJCQkJCSAgZGF0YV9tYXNrLCA1MCkpCiAJCQlEUk1fRVJST1IoIlRp
bWVvdXQgd2FpdGluZyBmb3IgcmVhZCBkYXRhLlxuIik7CiAKIAkJcmVhZF9kYXRhKGRldl9wcml2
LCBkYXRhX3JlZywgbXNnLT5yeF9idWYsIG1zZy0+cnhfbGVuKTsKQEAgLTI0MSw5ICsyMzMsNyBA
QCBzdGF0aWMgaW50IGRwaV9zZW5kX2NtZChzdHJ1Y3QgaW50ZWxfZHNpICppbnRlbF9kc2ksIHUz
MiBjbWQsIGJvb2wgaHMsCiAJSTkxNV9XUklURShNSVBJX0RQSV9DT05UUk9MKHBvcnQpLCBjbWQp
OwogCiAJbWFzayA9IFNQTF9QS1RfU0VOVF9JTlRFUlJVUFQ7Ci0JaWYgKGludGVsX3dhaXRfZm9y
X3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLAotCQkJCSAgICBNSVBJX0lOVFJfU1RBVChwb3J0
KSwgbWFzaywgbWFzaywKLQkJCQkgICAgMTAwKSkKKwlpZiAoaW50ZWxfZGVfd2FpdF9mb3Jfc2V0
KGRldl9wcml2LCBNSVBJX0lOVFJfU1RBVChwb3J0KSwgbWFzaywgMTAwKSkKIAkJRFJNX0VSUk9S
KCJWaWRlbyBtb2RlIGNvbW1hbmQgMHglMDh4IHNlbmQgZmFpbGVkLlxuIiwgY21kKTsKIAogCXJl
dHVybiAwOwpAQCAtMzYwLDExICszNTAsOCBAQCBzdGF0aWMgYm9vbCBnbGtfZHNpX2VuYWJsZV9p
byhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIAogCS8qIFdhaXQgZm9yIFB3ciBBQ0sg
Ki8KIAlmb3JfZWFjaF9kc2lfcG9ydChwb3J0LCBpbnRlbF9kc2ktPnBvcnRzKSB7Ci0JCWlmIChp
bnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwKLQkJCQkJICAgIE1JUElf
Q1RSTChwb3J0KSwKLQkJCQkJICAgIEdMS19NSVBJSU9fUE9SVF9QT1dFUkVELAotCQkJCQkgICAg
R0xLX01JUElJT19QT1JUX1BPV0VSRUQsCi0JCQkJCSAgICAyMCkpCisJCWlmIChpbnRlbF9kZV93
YWl0X2Zvcl9zZXQoZGV2X3ByaXYsIE1JUElfQ1RSTChwb3J0KSwKKwkJCQkJICBHTEtfTUlQSUlP
X1BPUlRfUE9XRVJFRCwgMjApKQogCQkJRFJNX0VSUk9SKCJNSVBJTyBwb3J0IGlzIHBvd2VyZ2F0
ZWRcbiIpOwogCX0KIApAQCAtMzg2LDExICszNzMsOCBAQCBzdGF0aWMgdm9pZCBnbGtfZHNpX2Rl
dmljZV9yZWFkeShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIAogCS8qIFdhaXQgZm9y
IE1JUEkgUEhZIHN0YXR1cyBiaXQgdG8gc2V0ICovCiAJZm9yX2VhY2hfZHNpX3BvcnQocG9ydCwg
aW50ZWxfZHNpLT5wb3J0cykgewotCQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9w
cml2LT51bmNvcmUsCi0JCQkJCSAgICBNSVBJX0NUUkwocG9ydCksCi0JCQkJCSAgICBHTEtfUEhZ
X1NUQVRVU19QT1JUX1JFQURZLAotCQkJCQkgICAgR0xLX1BIWV9TVEFUVVNfUE9SVF9SRUFEWSwK
LQkJCQkJICAgIDIwKSkKKwkJaWYgKGludGVsX2RlX3dhaXRfZm9yX3NldChkZXZfcHJpdiwgTUlQ
SV9DVFJMKHBvcnQpLAorCQkJCQkgIEdMS19QSFlfU1RBVFVTX1BPUlRfUkVBRFksIDIwKSkKIAkJ
CURSTV9FUlJPUigiUEhZIGlzIG5vdCBPTlxuIik7CiAJfQogCkBAIC00MTQsMTEgKzM5OCw4IEBA
IHN0YXRpYyB2b2lkIGdsa19kc2lfZGV2aWNlX3JlYWR5KHN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyKQogCQkJSTkxNV9XUklURShNSVBJX0RFVklDRV9SRUFEWShwb3J0KSwgdmFsKTsKIAog
CQkJLyogV2FpdCBmb3IgVUxQUyBhY3RpdmUgKi8KLQkJCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdp
c3RlcigmZGV2X3ByaXYtPnVuY29yZSwKLQkJCQkJCSAgICBNSVBJX0NUUkwocG9ydCksCi0JCQkJ
CQkgICAgR0xLX1VMUFNfTk9UX0FDVElWRSwKLQkJCQkJCSAgICAwLAotCQkJCQkJICAgIDIwKSkK
KwkJCWlmIChpbnRlbF9kZV93YWl0X2Zvcl9jbGVhcihkZXZfcHJpdiwgTUlQSV9DVFJMKHBvcnQp
LAorCQkJCQkJICAgIEdMS19VTFBTX05PVF9BQ1RJVkUsIDIwKSkKIAkJCQlEUk1fRVJST1IoIlVM
UFMgbm90IGFjdGl2ZVxuIik7CiAKIAkJCS8qIEV4aXQgVUxQUyAqLwpAQCAtNDQxLDIxICs0MjIs
MTUgQEAgc3RhdGljIHZvaWQgZ2xrX2RzaV9kZXZpY2VfcmVhZHkoc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIpCiAKIAkvKiBXYWl0IGZvciBTdG9wIHN0YXRlICovCiAJZm9yX2VhY2hfZHNp
X3BvcnQocG9ydCwgaW50ZWxfZHNpLT5wb3J0cykgewotCQlpZiAoaW50ZWxfd2FpdF9mb3JfcmVn
aXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCi0JCQkJCSAgICBNSVBJX0NUUkwocG9ydCksCi0JCQkJ
CSAgICBHTEtfREFUQV9MQU5FX1NUT1BfU1RBVEUsCi0JCQkJCSAgICBHTEtfREFUQV9MQU5FX1NU
T1BfU1RBVEUsCi0JCQkJCSAgICAyMCkpCisJCWlmIChpbnRlbF9kZV93YWl0X2Zvcl9zZXQoZGV2
X3ByaXYsIE1JUElfQ1RSTChwb3J0KSwKKwkJCQkJICBHTEtfREFUQV9MQU5FX1NUT1BfU1RBVEUs
IDIwKSkKIAkJCURSTV9FUlJPUigiRGF0ZSBsYW5lIG5vdCBpbiBTVE9QIHN0YXRlXG4iKTsKIAl9
CiAKIAkvKiBXYWl0IGZvciBBRkUgTEFUQ0ggKi8KIAlmb3JfZWFjaF9kc2lfcG9ydChwb3J0LCBp
bnRlbF9kc2ktPnBvcnRzKSB7Ci0JCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3By
aXYtPnVuY29yZSwKLQkJCQkJICAgIEJYVF9NSVBJX1BPUlRfQ1RSTChwb3J0KSwKLQkJCQkJICAg
IEFGRV9MQVRDSE9VVCwKLQkJCQkJICAgIEFGRV9MQVRDSE9VVCwKLQkJCQkJICAgIDIwKSkKKwkJ
aWYgKGludGVsX2RlX3dhaXRfZm9yX3NldChkZXZfcHJpdiwgQlhUX01JUElfUE9SVF9DVFJMKHBv
cnQpLAorCQkJCQkgIEFGRV9MQVRDSE9VVCwgMjApKQogCQkJRFJNX0VSUk9SKCJELVBIWSBub3Qg
ZW50ZXJpbmcgTFAtMTEgc3RhdGVcbiIpOwogCX0KIH0KQEAgLTU1NSwxNyArNTMwLDE1IEBAIHN0
YXRpYyB2b2lkIGdsa19kc2lfZW50ZXJfbG93X3Bvd2VyX21vZGUoc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIpCiAKIAkvKiBXYWl0IGZvciBNSVBJIFBIWSBzdGF0dXMgYml0IHRvIHVuc2V0
ICovCiAJZm9yX2VhY2hfZHNpX3BvcnQocG9ydCwgaW50ZWxfZHNpLT5wb3J0cykgewotCQlpZiAo
aW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCi0JCQkJCSAgICBNSVBJ
X0NUUkwocG9ydCksCi0JCQkJCSAgICBHTEtfUEhZX1NUQVRVU19QT1JUX1JFQURZLCAwLCAyMCkp
CisJCWlmIChpbnRlbF9kZV93YWl0X2Zvcl9jbGVhcihkZXZfcHJpdiwgTUlQSV9DVFJMKHBvcnQp
LAorCQkJCQkgICAgR0xLX1BIWV9TVEFUVVNfUE9SVF9SRUFEWSwgMjApKQogCQkJRFJNX0VSUk9S
KCJQSFkgaXMgbm90IHR1cm5pbmcgT0ZGXG4iKTsKIAl9CiAKIAkvKiBXYWl0IGZvciBQd3IgQUNL
IGJpdCB0byB1bnNldCAqLwogCWZvcl9lYWNoX2RzaV9wb3J0KHBvcnQsIGludGVsX2RzaS0+cG9y
dHMpIHsKLQkJaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLAot
CQkJCQkgICAgTUlQSV9DVFJMKHBvcnQpLAotCQkJCQkgICAgR0xLX01JUElJT19QT1JUX1BPV0VS
RUQsIDAsIDIwKSkKKwkJaWYgKGludGVsX2RlX3dhaXRfZm9yX2NsZWFyKGRldl9wcml2LCBNSVBJ
X0NUUkwocG9ydCksCisJCQkJCSAgICBHTEtfTUlQSUlPX1BPUlRfUE9XRVJFRCwgMjApKQogCQkJ
RFJNX0VSUk9SKCJNSVBJIElPIFBvcnQgaXMgbm90IHBvd2VyZ2F0ZWRcbiIpOwogCX0KIH0KQEAg
LTU4NCw5ICs1NTcsOCBAQCBzdGF0aWMgdm9pZCBnbGtfZHNpX2Rpc2FibGVfbWlwaV9pbyhzdHJ1
Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIAogCS8qIFdhaXQgZm9yIE1JUEkgUEhZIHN0YXR1
cyBiaXQgdG8gdW5zZXQgKi8KIAlmb3JfZWFjaF9kc2lfcG9ydChwb3J0LCBpbnRlbF9kc2ktPnBv
cnRzKSB7Ci0JCWlmIChpbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwK
LQkJCQkJICAgIE1JUElfQ1RSTChwb3J0KSwKLQkJCQkJICAgIEdMS19QSFlfU1RBVFVTX1BPUlRf
UkVBRFksIDAsIDIwKSkKKwkJaWYgKGludGVsX2RlX3dhaXRfZm9yX2NsZWFyKGRldl9wcml2LCBN
SVBJX0NUUkwocG9ydCksCisJCQkJCSAgICBHTEtfUEhZX1NUQVRVU19QT1JUX1JFQURZLCAyMCkp
CiAJCQlEUk1fRVJST1IoIlBIWSBpcyBub3QgdHVybmluZyBPRkZcbiIpOwogCX0KIApAQCAtNjM0
LDkgKzYwNiw3IEBAIHN0YXRpYyB2b2lkIHZsdl9kc2lfY2xlYXJfZGV2aWNlX3JlYWR5KHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogCQkgKiBQb3J0IEEgb25seS4gTUlQSSBQb3J0IEMg
aGFzIG5vIHNpbWlsYXIgYml0IGZvciBjaGVja2luZy4KIAkJICovCiAJCWlmICgoSVNfR0VOOV9M
UChkZXZfcHJpdikgfHwgcG9ydCA9PSBQT1JUX0EpICYmCi0JCSAgICBpbnRlbF93YWl0X2Zvcl9y
ZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwKLQkJCQkJICAgIHBvcnRfY3RybCwgQUZFX0xBVENI
T1VULCAwLAotCQkJCQkgICAgMzApKQorCQkgICAgaW50ZWxfZGVfd2FpdF9mb3JfY2xlYXIoZGV2
X3ByaXYsIHBvcnRfY3RybCwgQUZFX0xBVENIT1VULCAzMCkpCiAJCQlEUk1fRVJST1IoIkRTSSBM
UCBub3QgZ29pbmcgTG93XG4iKTsKIAogCQkvKiBEaXNhYmxlIE1JUEkgUEhZIHRyYW5zcGFyZW50
IGxhdGNoICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L3Zsdl9k
c2lfcGxsLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L3Zsdl9kc2lfcGxsLmMKaW5k
ZXggYWE2NGU2NTAxZjNiLi44ZDc3ZDJmODIzNmQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvdmx2X2RzaV9wbGwuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L3Zsdl9kc2lfcGxsLmMKQEAgLTI0NywxMSArMjQ3LDggQEAgdm9pZCBieHRfZHNpX3Bs
bF9kaXNhYmxlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogCSAqIFBMTCBsb2NrIHNo
b3VsZCBkZWFzc2VydCB3aXRoaW4gMjAwdXMuCiAJICogV2FpdCB1cCB0byAxbXMgYmVmb3JlIHRp
bWluZyBvdXQuCiAJICovCi0JaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+
dW5jb3JlLAotCQkJCSAgICBCWFRfRFNJX1BMTF9FTkFCTEUsCi0JCQkJICAgIEJYVF9EU0lfUExM
X0xPQ0tFRCwKLQkJCQkgICAgMCwKLQkJCQkgICAgMSkpCisJaWYgKGludGVsX2RlX3dhaXRfZm9y
X2NsZWFyKGRldl9wcml2LCBCWFRfRFNJX1BMTF9FTkFCTEUsCisJCQkJICAgIEJYVF9EU0lfUExM
X0xPQ0tFRCwgMSkpCiAJCURSTV9FUlJPUigiVGltZW91dCB3YWl0aW5nIGZvciBQTEwgbG9jayBk
ZWFzc2VydGlvblxuIik7CiB9CiAKQEAgLTUzMSwxMSArNTI4LDggQEAgdm9pZCBieHRfZHNpX3Bs
bF9lbmFibGUoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJSTkxNV9XUklURShCWFRf
RFNJX1BMTF9FTkFCTEUsIHZhbCk7CiAKIAkvKiBUaW1lb3V0IGFuZCBmYWlsIGlmIFBMTCBub3Qg
bG9ja2VkICovCi0JaWYgKGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3Jl
LAotCQkJCSAgICBCWFRfRFNJX1BMTF9FTkFCTEUsCi0JCQkJICAgIEJYVF9EU0lfUExMX0xPQ0tF
RCwKLQkJCQkgICAgQlhUX0RTSV9QTExfTE9DS0VELAotCQkJCSAgICAxKSkgeworCWlmIChpbnRl
bF9kZV93YWl0X2Zvcl9zZXQoZGV2X3ByaXYsIEJYVF9EU0lfUExMX0VOQUJMRSwKKwkJCQkgIEJY
VF9EU0lfUExMX0xPQ0tFRCwgMSkpIHsKIAkJRFJNX0VSUk9SKCJUaW1lZCBvdXQgd2FpdGluZyBm
b3IgRFNJIFBMTCB0byBsb2NrXG4iKTsKIAkJcmV0dXJuOwogCX0KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Ry
di5oCmluZGV4IDM1ZGI4MWQ2Njc4NS4uOTU3OGYxYzFmMDk5IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZHJ2LmgKQEAgLTI0NDYsNiArMjQ0NiwxNyBAQCBpbnQgaTkxNV9yZWdfcmVhZF9pb2N0bChzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogI2RlZmluZSBJOTE1X1JFQURfRlcocmVn
X18pIF9fSTkxNV9SRUdfT1AocmVhZF9mdywgZGV2X3ByaXYsIChyZWdfXykpCiAjZGVmaW5lIEk5
MTVfV1JJVEVfRlcocmVnX18sIHZhbF9fKSBfX0k5MTVfUkVHX09QKHdyaXRlX2Z3LCBkZXZfcHJp
diwgKHJlZ19fKSwgKHZhbF9fKSkKIAorLyogcmVnaXN0ZXIgd2FpdCB3cmFwcGVycyBmb3IgZGlz
cGxheSByZWdzICovCisjZGVmaW5lIGludGVsX2RlX3dhaXRfZm9yX3JlZ2lzdGVyKGRldl9wcml2
XywgcmVnXywgbWFza18sIHZhbHVlXywgdGltZW91dF8pIFwKKwlpbnRlbF93YWl0X2Zvcl9yZWdp
c3RlcigmKGRldl9wcml2XyktPnVuY29yZSwgXAorCQkJCShyZWdfKSwgKG1hc2tfKSwgKHZhbHVl
XyksICh0aW1lb3V0XykpCisKKyNkZWZpbmUgaW50ZWxfZGVfd2FpdF9mb3Jfc2V0KGRldl9wcml2
XywgcmVnXywgbWFza18sIHRpbWVvdXRfKSBcCisJaW50ZWxfZGVfd2FpdF9mb3JfcmVnaXN0ZXIo
ZGV2X3ByaXZfLCByZWdfLCBtYXNrXywgbWFza18sIHRpbWVvdXRfKQorCisjZGVmaW5lIGludGVs
X2RlX3dhaXRfZm9yX2NsZWFyKGRldl9wcml2XywgcmVnXywgbWFza18sIHRpbWVvdXRfKSBcCisJ
aW50ZWxfZGVfd2FpdF9mb3JfcmVnaXN0ZXIoZGV2X3ByaXZfLCByZWdfLCBtYXNrXywgMCwgdGlt
ZW91dF8pCisKIC8qIGk5MTVfbW0uYyAqLwogaW50IHJlbWFwX2lvX21hcHBpbmcoc3RydWN0IHZt
X2FyZWFfc3RydWN0ICp2bWEsCiAJCSAgICAgdW5zaWduZWQgbG9uZyBhZGRyLCB1bnNpZ25lZCBs
b25nIHBmbiwgdW5zaWduZWQgbG9uZyBzaXplLAotLSAKMi4yMi4wCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0Cklu
dGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

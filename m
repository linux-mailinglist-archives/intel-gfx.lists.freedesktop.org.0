Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9CE00A134A
	for <lists+intel-gfx@lfdr.de>; Thu, 29 Aug 2019 10:12:06 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EB3FE89FD3;
	Thu, 29 Aug 2019 08:12:03 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 90DEA89FA0
 for <intel-gfx@lists.freedesktop.org>; Thu, 29 Aug 2019 08:12:01 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18299892-1500050 
 for multiple; Thu, 29 Aug 2019 09:11:59 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 29 Aug 2019 09:11:46 +0100
Message-Id: <20190829081150.10271-33-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190829081150.10271-1-chris@chris-wilson.co.uk>
References: <20190829081150.10271-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 32/36] drm/i915: Move context management under
 GEM
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

S2VlcCB0cmFjayBvZiB0aGUgR0VNIGNvbnRleHRzIHVuZGVybmVhdGggaTkxNS0+Z2VtLmNvbnRl
eHRzIGFuZCBhc3NpZ24KdGhlbSB0aGVpciBvd24gbG9jayBmb3IgdGhlIHB1cnBvc2VzIG9mIGxp
c3QgbWFuYWdlbWVudC4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMt
d2lsc29uLmNvLnVrPgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNv
bT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jICAgfCAx
NTUgKysrKysrKy0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
Y29udGV4dC5oICAgfCAgIDQgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRl
eHRfdHlwZXMuaCB8ICAgMiArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1
ZmZlci5jICAgIHwgICAyICstCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9w
YWdlcy5jICAgfCAgMTIgKy0KIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2Nv
bnRleHQuYyB8IDEyMiArKysrKystLS0tLS0tLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRl
c3RzL21vY2tfY29udGV4dC5jIHwgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9jb250ZXh0LmMgICAgICAgfCAgIDggKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X2NvbnRleHQuYyAgICB8ICAyNCArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X2hhbmdjaGVjay5jICB8ICAxOSArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X2xyYy5jICAgICAgICB8ICAgNCArLQogLi4uL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93
b3JrYXJvdW5kcy5jICAgIHwgICA3ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1
bGVyLmMgICAgICAgICAgfCAgMjAgKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVn
ZnMuYyAgICAgICAgICAgfCAgMjAgKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5j
ICAgICAgICAgICAgICAgfCAgIDIgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAg
ICAgICAgICAgICAgIHwgIDI2ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyAg
ICAgICAgICAgICAgIHwgIDEwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyAg
ICAgICAgICAgICAgfCAgMTMgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3lzZnMuYyAg
ICAgICAgICAgICB8ICAzOCArKy0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV90cmFjZS5o
ICAgICAgICAgICAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV9nZW0uYyAgICAgfCAgIDggLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1f
ZXZpY3QuYyAgIHwgICAzIC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dl
bV9ndHQuYyB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcmVx
dWVzdC5jIHwgIDExICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEu
YyAgICAgfCAgIDUgKy0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2Rldmlj
ZS5jICB8ICAgNiArLQogMjYgZmlsZXMgY2hhbmdlZCwgMjIxIGluc2VydGlvbnMoKyksIDMxMCBk
ZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQu
YwppbmRleCBhMjc5ODU1NTQ2N2MuLmNjZDljMmE4MGNlMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCkBAIC0yMTksOSArMjE5LDEyIEBAIHN0YXRpYyBz
dHJ1Y3QgaTkxNV9nZW1fZW5naW5lcyAqZGVmYXVsdF9lbmdpbmVzKHN0cnVjdCBpOTE1X2dlbV9j
b250ZXh0ICpjdHgpCiAKIHN0YXRpYyB2b2lkIGk5MTVfZ2VtX2NvbnRleHRfZnJlZShzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqY3R4KQogewotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmN0eC0+aTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJR0VNX0JVR19PTighaTkxNV9nZW1fY29udGV4dF9pc19j
bG9zZWQoY3R4KSk7CiAKKwltdXRleF9sb2NrKCZjdHgtPmk5MTUtPmdlbS5jb250ZXh0cy5tdXRl
eCk7CisJbGlzdF9kZWwoJmN0eC0+bGluayk7CisJbXV0ZXhfdW5sb2NrKCZjdHgtPmk5MTUtPmdl
bS5jb250ZXh0cy5tdXRleCk7CisKIAlmcmVlX2VuZ2luZXMocmN1X2FjY2Vzc19wb2ludGVyKGN0
eC0+ZW5naW5lcykpOwogCW11dGV4X2Rlc3Ryb3koJmN0eC0+ZW5naW5lc19tdXRleCk7CiAKQEAg
LTIzMSw1NiArMjM0LDQwIEBAIHN0YXRpYyB2b2lkIGk5MTVfZ2VtX2NvbnRleHRfZnJlZShzdHJ1
Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQogCWtmcmVlKGN0eC0+bmFtZSk7CiAJcHV0X3BpZChj
dHgtPnBpZCk7CiAKLQlsaXN0X2RlbCgmY3R4LT5saW5rKTsKIAltdXRleF9kZXN0cm95KCZjdHgt
Pm11dGV4KTsKIAogCWtmcmVlX3JjdShjdHgsIHJjdSk7CiB9CiAKLXN0YXRpYyB2b2lkIGNvbnRl
eHRzX2ZyZWUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCitzdGF0aWMgdm9pZCBjb250
ZXh0c19mcmVlX2FsbChzdHJ1Y3QgbGxpc3Rfbm9kZSAqbGlzdCkKIHsKLQlzdHJ1Y3QgbGxpc3Rf
bm9kZSAqZnJlZWQgPSBsbGlzdF9kZWxfYWxsKCZpOTE1LT5jb250ZXh0cy5mcmVlX2xpc3QpOwog
CXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsICpjbjsKIAotCWxvY2tkZXBfYXNzZXJ0X2hl
bGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCi0JbGxpc3RfZm9yX2VhY2hfZW50cnlfc2Fm
ZShjdHgsIGNuLCBmcmVlZCwgZnJlZV9saW5rKQorCWxsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUo
Y3R4LCBjbiwgbGlzdCwgZnJlZV9saW5rKQogCQlpOTE1X2dlbV9jb250ZXh0X2ZyZWUoY3R4KTsK
IH0KIAotc3RhdGljIHZvaWQgY29udGV4dHNfZnJlZV9maXJzdChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSkKK3N0YXRpYyB2b2lkIGNvbnRleHRzX2ZsdXNoX2ZyZWUoc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHRzICpnYykKIHsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwotCXN0
cnVjdCBsbGlzdF9ub2RlICpmcmVlZDsKLQotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwotCi0JZnJlZWQgPSBsbGlzdF9kZWxfZmlyc3QoJmk5MTUtPmNvbnRl
eHRzLmZyZWVfbGlzdCk7Ci0JaWYgKCFmcmVlZCkKLQkJcmV0dXJuOwotCi0JY3R4ID0gY29udGFp
bmVyX29mKGZyZWVkLCB0eXBlb2YoKmN0eCksIGZyZWVfbGluayk7Ci0JaTkxNV9nZW1fY29udGV4
dF9mcmVlKGN0eCk7CisJY29udGV4dHNfZnJlZV9hbGwobGxpc3RfZGVsX2FsbCgmZ2MtPmZyZWVf
bGlzdCkpOwogfQogCiBzdGF0aWMgdm9pZCBjb250ZXh0c19mcmVlX3dvcmtlcihzdHJ1Y3Qgd29y
a19zdHJ1Y3QgKndvcmspCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPQotCQlj
b250YWluZXJfb2Yod29yaywgdHlwZW9mKCppOTE1KSwgY29udGV4dHMuZnJlZV93b3JrKTsKKwlz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dHMgKmdjID0KKwkJY29udGFpbmVyX29mKHdvcmssIHR5cGVv
ZigqZ2MpLCBmcmVlX3dvcmspOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7Ci0JY29udGV4dHNfZnJlZShpOTE1KTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOworCWNvbnRleHRzX2ZsdXNoX2ZyZWUoZ2MpOwogfQogCiB2b2lkIGk5MTVfZ2Vt
X2NvbnRleHRfcmVsZWFzZShzdHJ1Y3Qga3JlZiAqcmVmKQogewogCXN0cnVjdCBpOTE1X2dlbV9j
b250ZXh0ICpjdHggPSBjb250YWluZXJfb2YocmVmLCB0eXBlb2YoKmN0eCksIHJlZik7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBjdHgtPmk5MTU7CisJc3RydWN0IGk5MTVfZ2Vt
X2NvbnRleHRzICpnYyA9ICZjdHgtPmk5MTUtPmdlbS5jb250ZXh0czsKIAogCXRyYWNlX2k5MTVf
Y29udGV4dF9mcmVlKGN0eCk7Ci0JaWYgKGxsaXN0X2FkZCgmY3R4LT5mcmVlX2xpbmssICZpOTE1
LT5jb250ZXh0cy5mcmVlX2xpc3QpKQotCQlxdWV1ZV93b3JrKGk5MTUtPndxLCAmaTkxNS0+Y29u
dGV4dHMuZnJlZV93b3JrKTsKKwlpZiAobGxpc3RfYWRkKCZjdHgtPmZyZWVfbGluaywgJmdjLT5m
cmVlX2xpc3QpKQorCQlxdWV1ZV93b3JrKGN0eC0+aTkxNS0+d3EsICZnYy0+ZnJlZV93b3JrKTsK
IH0KIAogc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lcyAqCkBAIC0zNTksOCAr
MzQ2LDggQEAgc3RhdGljIHZvaWQgY29udGV4dF9jbG9zZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqY3R4KQogewogCWk5MTVfZ2VtX2NvbnRleHRfc2V0X2Nsb3NlZChjdHgpOwogCi0JaWYgKGN0
eC0+dm0pCi0JCWk5MTVfdm1fY2xvc2UoY3R4LT52bSk7CisJaWYgKHJjdV9hY2Nlc3NfcG9pbnRl
cihjdHgtPnZtKSkKKwkJaTkxNV92bV9jbG9zZShyY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKGN0
eC0+dm0sIHRydWUpKTsKIAogCW11dGV4X2xvY2soJmN0eC0+bXV0ZXgpOwogCkBAIC0zOTQsNyAr
MzgxLDYgQEAgX19jcmVhdGVfY29udGV4dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
IAkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CiAKIAlrcmVmX2luaXQoJmN0eC0+cmVmKTsKLQls
aXN0X2FkZF90YWlsKCZjdHgtPmxpbmssICZpOTE1LT5jb250ZXh0cy5saXN0KTsKIAljdHgtPmk5
MTUgPSBpOTE1OwogCWN0eC0+c2NoZWQucHJpb3JpdHkgPSBJOTE1X1VTRVJfUFJJT1JJVFkoSTkx
NV9QUklPUklUWV9OT1JNQUwpOwogCW11dGV4X2luaXQoJmN0eC0+bXV0ZXgpOwpAQCAtNDM1LDYg
KzQyMSwxMCBAQCBfX2NyZWF0ZV9jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQogCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGN0eC0+aGFuZ190aW1lc3RhbXApOyBpKysp
CiAJCWN0eC0+aGFuZ190aW1lc3RhbXBbaV0gPSBqaWZmaWVzIC0gQ09OVEVYVF9GQVNUX0hBTkdf
SklGRklFUzsKIAorCW11dGV4X2xvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5tdXRleCk7CisJbGlz
dF9hZGRfdGFpbCgmY3R4LT5saW5rLCAmaTkxNS0+Z2VtLmNvbnRleHRzLmxpc3QpOworCW11dGV4
X3VubG9jaygmaTkxNS0+Z2VtLmNvbnRleHRzLm11dGV4KTsKKwogCXJldHVybiBjdHg7CiAKIGVy
cl9mcmVlOgpAQCAtNDY0LDExICs0NTQsMTEgQEAgc3RhdGljIHZvaWQgX19hcHBseV9wcGd0dChz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIHZvaWQgKnZtKQogc3RhdGljIHN0cnVjdCBpOTE1X2Fk
ZHJlc3Nfc3BhY2UgKgogX19zZXRfcHBndHQoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwg
c3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiB7Ci0Jc3RydWN0IGk5MTVfYWRkcmVzc19z
cGFjZSAqb2xkID0gY3R4LT52bTsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICpvbGQgPSBy
Y3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKGN0eC0+dm0sIDEpOwogCiAJR0VNX0JVR19PTihvbGQg
JiYgaTkxNV92bV9pc180bHZsKHZtKSAhPSBpOTE1X3ZtX2lzXzRsdmwob2xkKSk7CiAKLQljdHgt
PnZtID0gaTkxNV92bV9vcGVuKHZtKTsKKwlyY3VfYXNzaWduX3BvaW50ZXIoY3R4LT52bSwgaTkx
NV92bV9vcGVuKHZtKSk7CiAJY29udGV4dF9hcHBseV9hbGwoY3R4LCBfX2FwcGx5X3BwZ3R0LCB2
bSk7CiAKIAlyZXR1cm4gb2xkOwpAQCAtNDc3LDcgKzQ2Nyw3IEBAIF9fc2V0X3BwZ3R0KHN0cnVj
dCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsIHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQog
c3RhdGljIHZvaWQgX19hc3NpZ25fcHBndHQoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwK
IAkJCSAgIHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogewotCWlmICh2bSA9PSBjdHgt
PnZtKQorCWlmICh2bSA9PSByY3VfYWNjZXNzX3BvaW50ZXIoY3R4LT52bSkpCiAJCXJldHVybjsK
IAogCXZtID0gX19zZXRfcHBndHQoY3R4LCB2bSk7CkBAIC01MDksMjcgKzQ5OSwyNSBAQCBzdGF0
aWMgdm9pZCBfX2Fzc2lnbl90aW1lbGluZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAog
fQogCiBzdGF0aWMgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKgotaTkxNV9nZW1fY3JlYXRlX2Nv
bnRleHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1bnNpZ25lZCBpbnQgZmxh
Z3MpCitpOTE1X2dlbV9jcmVhdGVfY29udGV4dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwgdW5zaWduZWQgaW50IGZsYWdzKQogewogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7
CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0K
IAlpZiAoZmxhZ3MgJiBJOTE1X0NPTlRFWFRfQ1JFQVRFX0ZMQUdTX1NJTkdMRV9USU1FTElORSAm
JgotCSAgICAhSEFTX0VYRUNMSVNUUyhkZXZfcHJpdikpCisJICAgICFIQVNfRVhFQ0xJU1RTKGk5
MTUpKQogCQlyZXR1cm4gRVJSX1BUUigtRUlOVkFMKTsKIAotCS8qIFJlYXAgdGhlIG1vc3Qgc3Rh
bGUgY29udGV4dCAqLwotCWNvbnRleHRzX2ZyZWVfZmlyc3QoZGV2X3ByaXYpOworCS8qIFJlYXAg
dGhlIHN0YWxlIGNvbnRleHRzICovCisJY29udGV4dHNfZmx1c2hfZnJlZSgmaTkxNS0+Z2VtLmNv
bnRleHRzKTsKIAotCWN0eCA9IF9fY3JlYXRlX2NvbnRleHQoZGV2X3ByaXYpOworCWN0eCA9IF9f
Y3JlYXRlX2NvbnRleHQoaTkxNSk7CiAJaWYgKElTX0VSUihjdHgpKQogCQlyZXR1cm4gY3R4Owog
Ci0JaWYgKEhBU19GVUxMX1BQR1RUKGRldl9wcml2KSkgeworCWlmIChIQVNfRlVMTF9QUEdUVChp
OTE1KSkgewogCQlzdHJ1Y3QgaTkxNV9wcGd0dCAqcHBndHQ7CiAKLQkJcHBndHQgPSBpOTE1X3Bw
Z3R0X2NyZWF0ZShkZXZfcHJpdik7CisJCXBwZ3R0ID0gaTkxNV9wcGd0dF9jcmVhdGUoaTkxNSk7
CiAJCWlmIChJU19FUlIocHBndHQpKSB7CiAJCQlEUk1fREVCVUdfRFJJVkVSKCJQUEdUVCBzZXR1
cCBmYWlsZWQgKCVsZClcbiIsCiAJCQkJCSBQVFJfRVJSKHBwZ3R0KSk7CkBAIC01NDQsNyArNTMy
LDcgQEAgaTkxNV9nZW1fY3JlYXRlX2NvbnRleHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LCB1bnNpZ25lZCBpbnQgZmxhZ3MpCiAJaWYgKGZsYWdzICYgSTkxNV9DT05URVhUX0NS
RUFURV9GTEFHU19TSU5HTEVfVElNRUxJTkUpIHsKIAkJc3RydWN0IGludGVsX3RpbWVsaW5lICp0
aW1lbGluZTsKIAotCQl0aW1lbGluZSA9IGludGVsX3RpbWVsaW5lX2NyZWF0ZSgmZGV2X3ByaXYt
Pmd0LCBOVUxMKTsKKwkJdGltZWxpbmUgPSBpbnRlbF90aW1lbGluZV9jcmVhdGUoJmk5MTUtPmd0
LCBOVUxMKTsKIAkJaWYgKElTX0VSUih0aW1lbGluZSkpIHsKIAkJCWNvbnRleHRfY2xvc2UoY3R4
KTsKIAkJCXJldHVybiBFUlJfQ0FTVCh0aW1lbGluZSk7CkBAIC01OTAsNDggKzU3OCw0MCBAQCBp
OTE1X2dlbV9jb250ZXh0X2NyZWF0ZV9rZXJuZWwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsIGludCBwcmlvKQogCXJldHVybiBjdHg7CiB9CiAKLXN0YXRpYyB2b2lkIGluaXRfY29udGV4
dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCitzdGF0aWMgdm9pZCBpbml0X2NvbnRl
eHRzKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0cyAqZ2MpCiB7Ci0JbXV0ZXhfaW5pdCgmaTkxNS0+
Y29udGV4dHMubXV0ZXgpOwotCUlOSVRfTElTVF9IRUFEKCZpOTE1LT5jb250ZXh0cy5saXN0KTsK
LQotCS8qIFVzaW5nIHRoZSBzaW1wbGUgaWRhIGludGVyZmFjZSwgdGhlIG1heCBpcyBsaW1pdGVk
IGJ5IHNpemVvZihpbnQpICovCi0JQlVJTERfQlVHX09OKE1BWF9DT05URVhUX0hXX0lEID4gSU5U
X01BWCk7Ci0JQlVJTERfQlVHX09OKEdFTjExX01BWF9DT05URVhUX0hXX0lEID4gSU5UX01BWCk7
Ci0JaWRhX2luaXQoJmk5MTUtPmNvbnRleHRzLmh3X2lkYSk7Ci0JSU5JVF9MSVNUX0hFQUQoJmk5
MTUtPmNvbnRleHRzLmh3X2lkX2xpc3QpOworCW11dGV4X2luaXQoJmdjLT5tdXRleCk7CisJSU5J
VF9MSVNUX0hFQUQoJmdjLT5saXN0KTsKIAotCUlOSVRfV09SSygmaTkxNS0+Y29udGV4dHMuZnJl
ZV93b3JrLCBjb250ZXh0c19mcmVlX3dvcmtlcik7Ci0JaW5pdF9sbGlzdF9oZWFkKCZpOTE1LT5j
b250ZXh0cy5mcmVlX2xpc3QpOworCUlOSVRfV09SSygmZ2MtPmZyZWVfd29yaywgY29udGV4dHNf
ZnJlZV93b3JrZXIpOworCWluaXRfbGxpc3RfaGVhZCgmZ2MtPmZyZWVfbGlzdCk7CiB9CiAKLWlu
dCBpOTE1X2dlbV9jb250ZXh0c19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dikKK2ludCBpOTE1X2dlbV9pbml0X2NvbnRleHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQogewogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CiAKIAkvKiBSZWFzc3VyZSBv
dXJzZWx2ZXMgd2UgYXJlIG9ubHkgY2FsbGVkIG9uY2UgKi8KLQlHRU1fQlVHX09OKGRldl9wcml2
LT5rZXJuZWxfY29udGV4dCk7CisJR0VNX0JVR19PTihpOTE1LT5rZXJuZWxfY29udGV4dCk7CiAK
LQlpbml0X2NvbnRleHRzKGRldl9wcml2KTsKKwlpbml0X2NvbnRleHRzKCZpOTE1LT5nZW0uY29u
dGV4dHMpOwogCiAJLyogbG93ZXN0IHByaW9yaXR5OyBpZGxlIHRhc2sgKi8KLQljdHggPSBpOTE1
X2dlbV9jb250ZXh0X2NyZWF0ZV9rZXJuZWwoZGV2X3ByaXYsIEk5MTVfUFJJT1JJVFlfTUlOKTsK
KwljdHggPSBpOTE1X2dlbV9jb250ZXh0X2NyZWF0ZV9rZXJuZWwoaTkxNSwgSTkxNV9QUklPUklU
WV9NSU4pOwogCWlmIChJU19FUlIoY3R4KSkgewogCQlEUk1fRVJST1IoIkZhaWxlZCB0byBjcmVh
dGUgZGVmYXVsdCBnbG9iYWwgY29udGV4dFxuIik7CiAJCXJldHVybiBQVFJfRVJSKGN0eCk7CiAJ
fQotCWRldl9wcml2LT5rZXJuZWxfY29udGV4dCA9IGN0eDsKKwlpOTE1LT5rZXJuZWxfY29udGV4
dCA9IGN0eDsKIAogCURSTV9ERUJVR19EUklWRVIoIiVzIGNvbnRleHQgc3VwcG9ydCBpbml0aWFs
aXplZFxuIiwKLQkJCSBEUklWRVJfQ0FQUyhkZXZfcHJpdiktPmhhc19sb2dpY2FsX2NvbnRleHRz
ID8KKwkJCSBEUklWRVJfQ0FQUyhpOTE1KS0+aGFzX2xvZ2ljYWxfY29udGV4dHMgPwogCQkJICJs
b2dpY2FsIiA6ICJmYWtlIik7CiAJcmV0dXJuIDA7CiB9CiAKLXZvaWQgaTkxNV9nZW1fY29udGV4
dHNfZmluaShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3ZvaWQgaTkxNV9nZW1fZHJp
dmVyX3JlbGVhc2VfX2NvbnRleHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewot
CWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJZGVzdHJv
eV9rZXJuZWxfY29udGV4dCgmaTkxNS0+a2VybmVsX2NvbnRleHQpOwogfQogCkBAIC02NTMsOCAr
NjMzLDggQEAgc3RhdGljIGludCBnZW1fY29udGV4dF9yZWdpc3RlcihzdHJ1Y3QgaTkxNV9nZW1f
Y29udGV4dCAqY3R4LAogCWludCByZXQ7CiAKIAljdHgtPmZpbGVfcHJpdiA9IGZwcml2OwotCWlm
IChjdHgtPnZtKQotCQljdHgtPnZtLT5maWxlID0gZnByaXY7CisJaWYgKHJjdV9hY2Nlc3NfcG9p
bnRlcihjdHgtPnZtKSkKKwkJcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChjdHgtPnZtLCB0cnVl
KS0+ZmlsZSA9IGZwcml2OwogCiAJY3R4LT5waWQgPSBnZXRfdGFza19waWQoY3VycmVudCwgUElE
VFlQRV9QSUQpOwogCWN0eC0+bmFtZSA9IGthc3ByaW50ZihHRlBfS0VSTkVMLCAiJXNbJWRdIiwK
QEAgLTY5MSw5ICs2NzEsNyBAQCBpbnQgaTkxNV9nZW1fY29udGV4dF9vcGVuKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCWlkcl9pbml0KCZmaWxlX3ByaXYtPmNvbnRleHRfaWRyKTsK
IAlpZHJfaW5pdF9iYXNlKCZmaWxlX3ByaXYtPnZtX2lkciwgMSk7CiAKLQltdXRleF9sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAljdHggPSBpOTE1X2dlbV9jcmVhdGVfY29udGV4dChp
OTE1LCAwKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChJ
U19FUlIoY3R4KSkgewogCQllcnIgPSBQVFJfRVJSKGN0eCk7CiAJCWdvdG8gZXJyOwpAQCAtNzIx
LDYgKzY5OSw3IEBAIGludCBpOTE1X2dlbV9jb250ZXh0X29wZW4oc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsCiB2b2lkIGk5MTVfZ2VtX2NvbnRleHRfY2xvc2Uoc3RydWN0IGRybV9maWxl
ICpmaWxlKQogewogCXN0cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGUgKmZpbGVfcHJpdiA9IGZp
bGUtPmRyaXZlcl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZmlsZV9w
cml2LT5kZXZfcHJpdjsKIAogCWlkcl9mb3JfZWFjaCgmZmlsZV9wcml2LT5jb250ZXh0X2lkciwg
Y29udGV4dF9pZHJfY2xlYW51cCwgTlVMTCk7CiAJaWRyX2Rlc3Ryb3koJmZpbGVfcHJpdi0+Y29u
dGV4dF9pZHIpOwpAQCAtNzI5LDYgKzcwOCw4IEBAIHZvaWQgaTkxNV9nZW1fY29udGV4dF9jbG9z
ZShzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCiAJaWRyX2Zvcl9lYWNoKCZmaWxlX3ByaXYtPnZtX2lk
ciwgdm1faWRyX2NsZWFudXAsIE5VTEwpOwogCWlkcl9kZXN0cm95KCZmaWxlX3ByaXYtPnZtX2lk
cik7CiAJbXV0ZXhfZGVzdHJveSgmZmlsZV9wcml2LT52bV9pZHJfbG9jayk7CisKKwljb250ZXh0
c19mbHVzaF9mcmVlKCZpOTE1LT5nZW0uY29udGV4dHMpOwogfQogCiBpbnQgaTkxNV9nZW1fdm1f
Y3JlYXRlX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCkBAIC05MDks
MTYgKzg5MCwxMiBAQCBzdGF0aWMgaW50IGdldF9wcGd0dChzdHJ1Y3QgZHJtX2k5MTVfZmlsZV9w
cml2YXRlICpmaWxlX3ByaXYsCiAJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CiAJaW50
IHJldDsKIAotCWlmICghY3R4LT52bSkKKwlpZiAoIXJjdV9hY2Nlc3NfcG9pbnRlcihjdHgtPnZt
KSkKIAkJcmV0dXJuIC1FTk9ERVY7CiAKLQkvKiBYWFggcmN1IGFjcXVpcmU/ICovCi0JcmV0ID0g
bXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZjdHgtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwot
CWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KKwlyY3VfcmVhZF9sb2NrKCk7CiAJdm0gPSBpOTE1
X3ZtX2dldChjdHgtPnZtKTsKLQltdXRleF91bmxvY2soJmN0eC0+aTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CisJcmN1X3JlYWRfdW5sb2NrKCk7CiAKIAlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVw
dGlibGUoJmZpbGVfcHJpdi0+dm1faWRyX2xvY2spOwogCWlmIChyZXQpCkBAIC0xMDI3LDcgKzEw
MDQsNyBAQCBzdGF0aWMgaW50IHNldF9wcGd0dChzdHJ1Y3QgZHJtX2k5MTVfZmlsZV9wcml2YXRl
ICpmaWxlX3ByaXYsCiAJaWYgKGFyZ3MtPnNpemUpCiAJCXJldHVybiAtRUlOVkFMOwogCi0JaWYg
KCFjdHgtPnZtKQorCWlmICghcmN1X2FjY2Vzc19wb2ludGVyKGN0eC0+dm0pKQogCQlyZXR1cm4g
LUVOT0RFVjsKIAogCWlmICh1cHBlcl8zMl9iaXRzKGFyZ3MtPnZhbHVlKSkKQEAgLTEwNDEsMTcg
KzEwMTgsMTUgQEAgc3RhdGljIGludCBzZXRfcHBndHQoc3RydWN0IGRybV9pOTE1X2ZpbGVfcHJp
dmF0ZSAqZmlsZV9wcml2LAogCWlmICghdm0pCiAJCXJldHVybiAtRU5PRU5UOwogCi0JZXJyID0g
bXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZjdHgtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwor
CWVyciA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmY3R4LT5tdXRleCk7CiAJaWYgKGVycikK
IAkJZ290byBvdXQ7CiAKLQlpZiAodm0gPT0gY3R4LT52bSkKKwlpZiAodm0gPT0gcmN1X2FjY2Vz
c19wb2ludGVyKGN0eC0+dm0pKQogCQlnb3RvIHVubG9jazsKIAogCS8qIFRlYXJkb3duIHRoZSBl
eGlzdGluZyBvYmo6dm1hIGNhY2hlLCBpdCB3aWxsIGhhdmUgdG8gYmUgcmVidWlsdC4gKi8KLQlt
dXRleF9sb2NrKCZjdHgtPm11dGV4KTsKIAlsdXRfY2xvc2UoY3R4KTsKLQltdXRleF91bmxvY2so
JmN0eC0+bXV0ZXgpOwogCiAJb2xkID0gX19zZXRfcHBndHQoY3R4LCB2bSk7CiAKQEAgLTEwNzEs
OCArMTA0Niw3IEBAIHN0YXRpYyBpbnQgc2V0X3BwZ3R0KHN0cnVjdCBkcm1faTkxNV9maWxlX3By
aXZhdGUgKmZpbGVfcHJpdiwKIAl9CiAKIHVubG9jazoKLQltdXRleF91bmxvY2soJmN0eC0+aTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KKwltdXRleF91bmxvY2soJmN0eC0+bXV0ZXgpOwogb3V0
OgogCWk5MTVfdm1fcHV0KHZtKTsKIAlyZXR1cm4gZXJyOwpAQCAtMTk1NSw3ICsxOTI5LDcgQEAg
c3RhdGljIGludCBjbG9uZV92bShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqZHN0LAogCiAJcmN1
X3JlYWRfbG9jaygpOwogCWRvIHsKLQkJdm0gPSBSRUFEX09OQ0Uoc3JjLT52bSk7CisJCXZtID0g
cmN1X2RlcmVmZXJlbmNlKHNyYy0+dm0pOwogCQlpZiAoIXZtKQogCQkJYnJlYWs7CiAKQEAgLTE5
NzcsNyArMTk1MSw3IEBAIHN0YXRpYyBpbnQgY2xvbmVfdm0oc3RydWN0IGk5MTVfZ2VtX2NvbnRl
eHQgKmRzdCwKIAkJICogaXQgY2Fubm90IGJlIHJlYWxsb2NhdGVkIGVsc2V3aGVyZS4KIAkJICov
CiAKLQkJaWYgKHZtID09IFJFQURfT05DRShzcmMtPnZtKSkKKwkJaWYgKHZtID09IHJjdV9hY2Nl
c3NfcG9pbnRlcihzcmMtPnZtKSkKIAkJCWJyZWFrOwogCiAJCWk5MTVfdm1fcHV0KHZtKTsKQEAg
LTIwNzksMTIgKzIwNTMsNyBAQCBpbnQgaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfaW9jdGwoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJcmV0dXJuIC1FSU87CiAJfQogCi0J
cmV0ID0gaTkxNV9tdXRleF9sb2NrX2ludGVycnVwdGlibGUoZGV2KTsKLQlpZiAocmV0KQotCQly
ZXR1cm4gcmV0OwotCiAJZXh0X2RhdGEuY3R4ID0gaTkxNV9nZW1fY3JlYXRlX2NvbnRleHQoaTkx
NSwgYXJncy0+ZmxhZ3MpOwotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogCWlm
IChJU19FUlIoZXh0X2RhdGEuY3R4KSkKIAkJcmV0dXJuIFBUUl9FUlIoZXh0X2RhdGEuY3R4KTsK
IApAQCAtMjIxMSwxMiArMjE4MCwxNCBAQCBpbnQgaTkxNV9nZW1fY29udGV4dF9nZXRwYXJhbV9p
b2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCiAJY2FzZSBJOTE1X0NP
TlRFWFRfUEFSQU1fR1RUX1NJWkU6CiAJCWFyZ3MtPnNpemUgPSAwOwotCQlpZiAoY3R4LT52bSkK
LQkJCWFyZ3MtPnZhbHVlID0gY3R4LT52bS0+dG90YWw7CisJCXJjdV9yZWFkX2xvY2soKTsKKwkJ
aWYgKHJjdV9hY2Nlc3NfcG9pbnRlcihjdHgtPnZtKSkKKwkJCWFyZ3MtPnZhbHVlID0gcmN1X2Rl
cmVmZXJlbmNlKGN0eC0+dm0pLT50b3RhbDsKIAkJZWxzZSBpZiAodG9faTkxNShkZXYpLT5nZ3R0
LmFsaWFzKQogCQkJYXJncy0+dmFsdWUgPSB0b19pOTE1KGRldiktPmdndHQuYWxpYXMtPnZtLnRv
dGFsOwogCQllbHNlCiAJCQlhcmdzLT52YWx1ZSA9IHRvX2k5MTUoZGV2KS0+Z2d0dC52bS50b3Rh
bDsKKwkJcmN1X3JlYWRfdW5sb2NrKCk7CiAJCWJyZWFrOwogCiAJY2FzZSBJOTE1X0NPTlRFWFRf
UEFSQU1fTk9fRVJST1JfQ0FQVFVSRToKQEAgLTIyODcsNyArMjI1OCw3IEBAIGludCBpOTE1X2dl
bV9jb250ZXh0X3NldHBhcmFtX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRh
dGEsCiBpbnQgaTkxNV9nZW1fY29udGV4dF9yZXNldF9zdGF0c19pb2N0bChzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2LAogCQkJCSAgICAgICB2b2lkICpkYXRhLCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUp
CiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShkZXYpOwogCXN0cnVjdCBk
cm1faTkxNV9yZXNldF9zdGF0cyAqYXJncyA9IGRhdGE7CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRl
eHQgKmN0eDsKIAlpbnQgcmV0OwpAQCAtMjMwOSw3ICsyMjgwLDcgQEAgaW50IGk5MTVfZ2VtX2Nv
bnRleHRfcmVzZXRfc3RhdHNfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkgKi8KIAog
CWlmIChjYXBhYmxlKENBUF9TWVNfQURNSU4pKQotCQlhcmdzLT5yZXNldF9jb3VudCA9IGk5MTVf
cmVzZXRfY291bnQoJmRldl9wcml2LT5ncHVfZXJyb3IpOworCQlhcmdzLT5yZXNldF9jb3VudCA9
IGk5MTVfcmVzZXRfY291bnQoJmk5MTUtPmdwdV9lcnJvcik7CiAJZWxzZQogCQlhcmdzLT5yZXNl
dF9jb3VudCA9IDA7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9jb250ZXh0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4
dC5oCmluZGV4IDFiMGRmNTM0MzZjZi4uNGVlNWRmYzU3OTRlIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5oCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmgKQEAgLTEzMyw4ICsxMzMsOCBAQCBzdGF0aWMg
aW5saW5lIGJvb2wgaTkxNV9nZW1fY29udGV4dF9pc19rZXJuZWwoc3RydWN0IGk5MTVfZ2VtX2Nv
bnRleHQgKmN0eCkKIH0KIAogLyogaTkxNV9nZW1fY29udGV4dC5jICovCi1pbnQgX19tdXN0X2No
ZWNrIGk5MTVfZ2VtX2NvbnRleHRzX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KTsKLXZvaWQgaTkxNV9nZW1fY29udGV4dHNfZmluaShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpOworaW50IF9fbXVzdF9jaGVjayBpOTE1X2dlbV9pbml0X2NvbnRleHRzKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgaTkxNV9nZW1fZHJpdmVyX3JlbGVh
c2VfX2NvbnRleHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIAogaW50IGk5MTVf
Z2VtX2NvbnRleHRfb3BlbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgc3Ry
dWN0IGRybV9maWxlICpmaWxlKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9jb250ZXh0X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fY29udGV4dF90eXBlcy5oCmluZGV4IDY0MTlkYTdjOWY5MC4uYTNlY2QxOWYyMzAzIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dF90eXBl
cy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0X3R5cGVz
LmgKQEAgLTg4LDcgKzg4LDcgQEAgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgewogCSAqIEluIG90
aGVyIG1vZGVzLCB0aGlzIGlzIGEgTlVMTCBwb2ludGVyIHdpdGggdGhlIGV4cGVjdGF0aW9uIHRo
YXQKIAkgKiB0aGUgY2FsbGVyIHVzZXMgdGhlIHNoYXJlZCBnbG9iYWwgR1RULgogCSAqLwotCXN0
cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ug
X19yY3UgKnZtOwogCiAJLyoqCiAJICogQHBpZDogcHJvY2VzcyBpZCBvZiBjcmVhdG9yCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYwppbmRleCAxNDY3
YzY2NmVhODQuLjA5YTQwYTBkYWFiZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fZXhlY2J1ZmZlci5jCkBAIC03MzEsNyArNzMxLDcgQEAgc3RhdGljIGludCBlYl9z
ZWxlY3RfY29udGV4dChzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYikKIAkJcmV0dXJuIC1FTk9F
TlQ7CiAKIAllYi0+Z2VtX2NvbnRleHQgPSBjdHg7Ci0JaWYgKGN0eC0+dm0pCisJaWYgKHJjdV9h
Y2Nlc3NfcG9pbnRlcihjdHgtPnZtKSkKIAkJZWItPmludmFsaWRfZmxhZ3MgfD0gRVhFQ19PQkpF
Q1RfTkVFRFNfR1RUOwogCiAJZWItPmNvbnRleHRfZmxhZ3MgPSAwOwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYwppbmRleCBjZDc3MTE0N2I0MWYu
LmUwNGU2N2I5YzUyNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0
ZXN0cy9odWdlX3BhZ2VzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0
cy9odWdlX3BhZ2VzLmMKQEAgLTEzMzIsNyArMTMzMiw3IEBAIHN0YXRpYyBpbnQgaWd0X3BwZ3R0
X3Bpbl91cGRhdGUodm9pZCAqYXJnKQogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHggPSBh
cmc7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gY3R4LT5pOTE1OwogCXVu
c2lnbmVkIGxvbmcgc3VwcG9ydGVkID0gSU5URUxfSU5GTyhkZXZfcHJpdiktPnBhZ2Vfc2l6ZXM7
Ci0Jc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSBjdHgtPnZtOworCXN0cnVjdCBpOTE1
X2FkZHJlc3Nfc3BhY2UgKnZtID0gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChjdHgtPnZtLCAx
KTsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwogCXN0cnVjdCBpOTE1X2dlbV9l
bmdpbmVzX2l0ZXIgaXQ7CiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwpAQCAtMTQ3MCw3ICsx
NDcwLDggQEAgc3RhdGljIGludCBpZ3RfdG1wZnNfZmFsbGJhY2sodm9pZCAqYXJnKQogCXN0cnVj
dCBpOTE1X2dlbV9jb250ZXh0ICpjdHggPSBhcmc7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSBjdHgtPmk5MTU7CiAJc3RydWN0IHZmc21vdW50ICpnZW1mcyA9IGk5MTUtPm1tLmdl
bWZzOwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gY3R4LT52bSA/OiAmaTkxNS0+
Z2d0dC52bTsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9CisJCXJjdV9kZXJlZmVy
ZW5jZV9wcm90ZWN0ZWQoY3R4LT52bSwgdHJ1ZSkgPzogJmk5MTUtPmdndHQudm07CiAJc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAl1MzIg
KnZhZGRyOwpAQCAtMTUyNyw3ICsxNTI4LDggQEAgc3RhdGljIGludCBpZ3Rfc2hyaW5rX3RocCh2
b2lkICphcmcpCiB7CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IGFyZzsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGN0eC0+aTkxNTsKLQlzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlICp2bSA9IGN0eC0+dm0gPzogJmk5MTUtPmdndHQudm07CisJc3RydWN0IGk5MTVf
YWRkcmVzc19zcGFjZSAqdm0gPQorCQlyY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKGN0eC0+dm0s
IHRydWUpID86ICZpOTE1LT5nZ3R0LnZtOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
Ymo7CiAJc3RydWN0IGk5MTVfZ2VtX2VuZ2luZXNfaXRlciBpdDsKIAlzdHJ1Y3QgaW50ZWxfY29u
dGV4dCAqY2U7CkBAIC0xNzA5LDggKzE3MTEsOCBAQCBpbnQgaTkxNV9nZW1faHVnZV9wYWdlX2xp
dmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCQlnb3RvIG91dF91
bmxvY2s7CiAJfQogCi0JaWYgKGN0eC0+dm0pCi0JCWN0eC0+dm0tPnNjcnViXzY0SyA9IHRydWU7
CisJaWYgKHJjdV9hY2Nlc3NfcG9pbnRlcihjdHgtPnZtKSkKKwkJcmN1X2RlcmVmZXJlbmNlX3By
b3RlY3RlZChjdHgtPnZtLCB0cnVlKS0+c2NydWJfNjRLID0gdHJ1ZTsKIAogCWVyciA9IGk5MTVf
c3VidGVzdHModGVzdHMsIGN0eCk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXggYWIxYWU1M2VkZTJjLi4wMGNk
NDBjZjU0YjQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMv
aTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVz
dHMvaTkxNV9nZW1fY29udGV4dC5jCkBAIC01MywxOSArNTMsMTcgQEAgc3RhdGljIGludCBsaXZl
X25vcF9zd2l0Y2godm9pZCAqYXJnKQogCWlmIChJU19FUlIoZmlsZSkpCiAJCXJldHVybiBQVFJf
RVJSKGZpbGUpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlj
dHggPSBrY2FsbG9jKG5jdHgsIHNpemVvZigqY3R4KSwgR0ZQX0tFUk5FTCk7CiAJaWYgKCFjdHgp
IHsKIAkJZXJyID0gLUVOT01FTTsKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3RvIG91dF9maWxl
OwogCX0KIAogCWZvciAobiA9IDA7IG4gPCBuY3R4OyBuKyspIHsKIAkJY3R4W25dID0gbGl2ZV9j
b250ZXh0KGk5MTUsIGZpbGUpOwogCQlpZiAoSVNfRVJSKGN0eFtuXSkpIHsKIAkJCWVyciA9IFBU
Ul9FUlIoY3R4W25dKTsKLQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCWdvdG8gb3V0X2ZpbGU7CiAJ
CX0KIAl9CiAKQEAgLTc5LDcgKzc3LDcgQEAgc3RhdGljIGludCBsaXZlX25vcF9zd2l0Y2godm9p
ZCAqYXJnKQogCQkJcnEgPSBpZ3RfcmVxdWVzdF9hbGxvYyhjdHhbbl0sIGVuZ2luZSk7CiAJCQlp
ZiAoSVNfRVJSKHJxKSkgewogCQkJCWVyciA9IFBUUl9FUlIocnEpOwotCQkJCWdvdG8gb3V0X3Vu
bG9jazsKKwkJCQlnb3RvIG91dF9maWxlOwogCQkJfQogCQkJaTkxNV9yZXF1ZXN0X2FkZChycSk7
CiAJCX0KQEAgLTg3LDcgKzg1LDcgQEAgc3RhdGljIGludCBsaXZlX25vcF9zd2l0Y2godm9pZCAq
YXJnKQogCQkJcHJfZXJyKCJGYWlsZWQgdG8gcG9wdWxhdGVkICVkIGNvbnRleHRzXG4iLCBuY3R4
KTsKIAkJCWludGVsX2d0X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKIAkJCWVyciA9IC1FSU87Ci0J
CQlnb3RvIG91dF91bmxvY2s7CisJCQlnb3RvIG91dF9maWxlOwogCQl9CiAKIAkJdGltZXNbMV0g
PSBrdGltZV9nZXRfcmF3KCk7CkBAIC05Nyw3ICs5NSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9ub3Bf
c3dpdGNoKHZvaWQgKmFyZykKIAogCQllcnIgPSBpZ3RfbGl2ZV90ZXN0X2JlZ2luKCZ0LCBpOTE1
LCBfX2Z1bmNfXywgZW5naW5lLT5uYW1lKTsKIAkJaWYgKGVycikKLQkJCWdvdG8gb3V0X3VubG9j
azsKKwkJCWdvdG8gb3V0X2ZpbGU7CiAKIAkJZW5kX3RpbWUgPSBqaWZmaWVzICsgaTkxNV9zZWxm
dGVzdC50aW1lb3V0X2ppZmZpZXM7CiAJCWZvcl9lYWNoX3ByaW1lX251bWJlcl9mcm9tKHByaW1l
LCAyLCA4MTkyKSB7CkBAIC0xMDcsNyArMTA1LDcgQEAgc3RhdGljIGludCBsaXZlX25vcF9zd2l0
Y2godm9pZCAqYXJnKQogCQkJCXJxID0gaWd0X3JlcXVlc3RfYWxsb2MoY3R4W24gJSBuY3R4XSwg
ZW5naW5lKTsKIAkJCQlpZiAoSVNfRVJSKHJxKSkgewogCQkJCQllcnIgPSBQVFJfRVJSKHJxKTsK
LQkJCQkJZ290byBvdXRfdW5sb2NrOworCQkJCQlnb3RvIG91dF9maWxlOwogCQkJCX0KIAogCQkJ
CS8qCkBAIC0xNDMsNyArMTQxLDcgQEAgc3RhdGljIGludCBsaXZlX25vcF9zd2l0Y2godm9pZCAq
YXJnKQogCiAJCWVyciA9IGlndF9saXZlX3Rlc3RfZW5kKCZ0KTsKIAkJaWYgKGVycikKLQkJCWdv
dG8gb3V0X3VubG9jazsKKwkJCWdvdG8gb3V0X2ZpbGU7CiAKIAkJcHJfaW5mbygiU3dpdGNoIGxh
dGVuY2llcyBvbiAlczogMSA9ICVsbHVucywgJWx1ID0gJWxsdW5zXG4iLAogCQkJZW5naW5lLT5u
YW1lLApAQCAtMTUxLDggKzE0OSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9ub3Bfc3dpdGNoKHZvaWQg
KmFyZykKIAkJCXByaW1lIC0gMSwgZGl2NjRfdTY0KGt0aW1lX3RvX25zKHRpbWVzWzFdKSwgcHJp
bWUgLSAxKSk7CiAJfQogCi1vdXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CitvdXRfZmlsZToKIAltb2NrX2ZpbGVfZnJlZShpOTE1LCBmaWxlKTsKIAly
ZXR1cm4gZXJyOwogfQpAQCAtNDEyLDExICs0MDksOSBAQCBzdGF0aWMgaW50IGlndF9jdHhfZXhl
Yyh2b2lkICphcmcpCiAJCWlmIChJU19FUlIoZmlsZSkpCiAJCQlyZXR1cm4gUFRSX0VSUihmaWxl
KTsKIAotCQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCQllcnIgPSBp
Z3RfbGl2ZV90ZXN0X2JlZ2luKCZ0LCBpOTE1LCBfX2Z1bmNfXywgZW5naW5lLT5uYW1lKTsKIAkJ
aWYgKGVycikKLQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCWdvdG8gb3V0X2ZpbGU7CiAKIAkJbmNv
bnRleHRzID0gMDsKIAkJbmR3b3JkcyA9IDA7CkBAIC00MjgsNyArNDIzLDcgQEAgc3RhdGljIGlu
dCBpZ3RfY3R4X2V4ZWModm9pZCAqYXJnKQogCQkJY3R4ID0ga2VybmVsX2NvbnRleHQoaTkxNSk7
CiAJCQlpZiAoSVNfRVJSKGN0eCkpIHsKIAkJCQllcnIgPSBQVFJfRVJSKGN0eCk7Ci0JCQkJZ290
byBvdXRfdW5sb2NrOworCQkJCWdvdG8gb3V0X2ZpbGU7CiAJCQl9CiAKIAkJCWNlID0gaTkxNV9n
ZW1fY29udGV4dF9nZXRfZW5naW5lKGN0eCwgZW5naW5lLT5sZWdhY3lfaWR4KTsKQEAgLTQ0MCw3
ICs0MzUsNyBAQCBzdGF0aWMgaW50IGlndF9jdHhfZXhlYyh2b2lkICphcmcpCiAJCQkJCWVyciA9
IFBUUl9FUlIob2JqKTsKIAkJCQkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwogCQkJCQlrZXJuZWxf
Y29udGV4dF9jbG9zZShjdHgpOwotCQkJCQlnb3RvIG91dF91bmxvY2s7CisJCQkJCWdvdG8gb3V0
X2ZpbGU7CiAJCQkJfQogCQkJfQogCkBAIC00NDksMTcgKzQ0NCwxOCBAQCBzdGF0aWMgaW50IGln
dF9jdHhfZXhlYyh2b2lkICphcmcpCiAJCQkJcHJfZXJyKCJGYWlsZWQgdG8gZmlsbCBkd29yZCAl
bHUgWyVsdS8lbHVdIHdpdGggZ3B1ICglcykgW2Z1bGwtcHBndHQ/ICVzXSwgZXJyPSVkXG4iLAog
CQkJCSAgICAgICBuZHdvcmRzLCBkdywgbWF4X2R3b3JkcyhvYmopLAogCQkJCSAgICAgICBlbmdp
bmUtPm5hbWUsCi0JCQkJICAgICAgIHllc25vKCEhY3R4LT52bSksIGVycik7CisJCQkJICAgICAg
IHllc25vKCEhcmN1X2FjY2Vzc19wb2ludGVyKGN0eC0+dm0pKSwKKwkJCQkgICAgICAgZXJyKTsK
IAkJCQlpbnRlbF9jb250ZXh0X3B1dChjZSk7CiAJCQkJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4
KTsKLQkJCQlnb3RvIG91dF91bmxvY2s7CisJCQkJZ290byBvdXRfZmlsZTsKIAkJCX0KIAogCQkJ
ZXJyID0gdGhyb3R0bGUoY2UsIHRxLCBBUlJBWV9TSVpFKHRxKSk7CiAJCQlpZiAoZXJyKSB7CiAJ
CQkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwogCQkJCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7
Ci0JCQkJZ290byBvdXRfdW5sb2NrOworCQkJCWdvdG8gb3V0X2ZpbGU7CiAJCQl9CiAKIAkJCWlm
ICgrK2R3ID09IG1heF9kd29yZHMob2JqKSkgewpAQCAtNDg5LDExICs0ODUsMTAgQEAgc3RhdGlj
IGludCBpZ3RfY3R4X2V4ZWModm9pZCAqYXJnKQogCQkJZHcgKz0gcmVtOwogCQl9CiAKLW91dF91
bmxvY2s6CitvdXRfZmlsZToKIAkJdGhyb3R0bGVfcmVsZWFzZSh0cSwgQVJSQVlfU0laRSh0cSkp
OwogCQlpZiAoaWd0X2xpdmVfdGVzdF9lbmQoJnQpKQogCQkJZXJyID0gLUVJTzsKLQkJbXV0ZXhf
dW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCQltb2NrX2ZpbGVfZnJlZShpOTE1
LCBmaWxlKTsKIAkJaWYgKGVycikKQEAgLTUyOCwyMiArNTIzLDIwIEBAIHN0YXRpYyBpbnQgaWd0
X3NoYXJlZF9jdHhfZXhlYyh2b2lkICphcmcpCiAJaWYgKElTX0VSUihmaWxlKSkKIAkJcmV0dXJu
IFBUUl9FUlIoZmlsZSk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
LQogCXBhcmVudCA9IGxpdmVfY29udGV4dChpOTE1LCBmaWxlKTsKIAlpZiAoSVNfRVJSKHBhcmVu
dCkpIHsKIAkJZXJyID0gUFRSX0VSUihwYXJlbnQpOwotCQlnb3RvIG91dF91bmxvY2s7CisJCWdv
dG8gb3V0X2ZpbGU7CiAJfQogCiAJaWYgKCFwYXJlbnQtPnZtKSB7IC8qIG5vdCBmdWxsLXBwZ3R0
OyBub3RoaW5nIHRvIHNoYXJlICovCiAJCWVyciA9IDA7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJ
Z290byBvdXRfZmlsZTsKIAl9CiAKIAllcnIgPSBpZ3RfbGl2ZV90ZXN0X2JlZ2luKCZ0LCBpOTE1
LCBfX2Z1bmNfXywgIiIpOwogCWlmIChlcnIpCi0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290byBv
dXRfZmlsZTsKIAogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7CiAJCXVuc2ln
bmVkIGxvbmcgbmNvbnRleHRzLCBuZHdvcmRzLCBkdzsKQEAgLTU4Nyw3ICs1ODAsOCBAQCBzdGF0
aWMgaW50IGlndF9zaGFyZWRfY3R4X2V4ZWModm9pZCAqYXJnKQogCQkJCXByX2VycigiRmFpbGVk
IHRvIGZpbGwgZHdvcmQgJWx1IFslbHUvJWx1XSB3aXRoIGdwdSAoJXMpIFtmdWxsLXBwZ3R0PyAl
c10sIGVycj0lZFxuIiwKIAkJCQkgICAgICAgbmR3b3JkcywgZHcsIG1heF9kd29yZHMob2JqKSwK
IAkJCQkgICAgICAgZW5naW5lLT5uYW1lLAotCQkJCSAgICAgICB5ZXNubyghIWN0eC0+dm0pLCBl
cnIpOworCQkJCSAgICAgICB5ZXNubyghIXJjdV9hY2Nlc3NfcG9pbnRlcihjdHgtPnZtKSksCisJ
CQkJICAgICAgIGVycik7CiAJCQkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwogCQkJCWtlcm5lbF9j
b250ZXh0X2Nsb3NlKGN0eCk7CiAJCQkJZ290byBvdXRfdGVzdDsKQEAgLTYyNiwxNyArNjIwLDEz
IEBAIHN0YXRpYyBpbnQgaWd0X3NoYXJlZF9jdHhfZXhlYyh2b2lkICphcmcpCiAJCQlkdyArPSBy
ZW07CiAJCX0KIAotCQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQlp
OTE1X2dlbV9kcmFpbl9mcmVlZF9vYmplY3RzKGk5MTUpOwotCQltdXRleF9sb2NrKCZpOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKIAl9CiBvdXRfdGVzdDoKIAl0aHJvdHRsZV9yZWxlYXNlKHRxLCBB
UlJBWV9TSVpFKHRxKSk7CiAJaWYgKGlndF9saXZlX3Rlc3RfZW5kKCZ0KSkKIAkJZXJyID0gLUVJ
TzsKLW91dF91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
LQorb3V0X2ZpbGU6CiAJbW9ja19maWxlX2ZyZWUoaTkxNSwgZmlsZSk7CiAJcmV0dXJuIGVycjsK
IH0KQEAgLTEwMDgsOCArOTk4LDYgQEAgX19pZ3RfY3R4X3NzZXUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsCiAJaWYgKGZsYWdzICYgVEVTVF9SRVNFVCkKIAkJaWd0X2dsb2JhbF9yZXNl
dF9sb2NrKCZpOTE1LT5ndCk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKLQogCWN0eCA9IGxpdmVfY29udGV4dChpOTE1LCBmaWxlKTsKIAlpZiAoSVNfRVJSKGN0eCkp
IHsKIAkJcmV0ID0gUFRSX0VSUihjdHgpOwpAQCAtMTA2NCw4ICsxMDUyLDYgQEAgX19pZ3RfY3R4
X3NzZXUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJaTkxNV9nZW1fb2JqZWN0X3B1
dChvYmopOwogCiBvdXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7Ci0KIAlpZiAoZmxhZ3MgJiBURVNUX1JFU0VUKQogCQlpZ3RfZ2xvYmFsX3Jlc2V0X3Vu
bG9jaygmaTkxNS0+Z3QpOwogCkBAIC0xMTI1LDIzICsxMTExLDI0IEBAIHN0YXRpYyBpbnQgaWd0
X2N0eF9yZWFkb25seSh2b2lkICphcmcpCiAJaWYgKElTX0VSUihmaWxlKSkKIAkJcmV0dXJuIFBU
Ul9FUlIoZmlsZSk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQog
CWVyciA9IGlndF9saXZlX3Rlc3RfYmVnaW4oJnQsIGk5MTUsIF9fZnVuY19fLCAiIik7CiAJaWYg
KGVycikKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3RvIG91dF9maWxlOwogCiAJY3R4ID0gbGl2
ZV9jb250ZXh0KGk5MTUsIGZpbGUpOwogCWlmIChJU19FUlIoY3R4KSkgewogCQllcnIgPSBQVFJf
RVJSKGN0eCk7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290byBvdXRfZmlsZTsKIAl9CiAKLQl2
bSA9IGN0eC0+dm0gPzogJmk5MTUtPmdndHQuYWxpYXMtPnZtOworCXJjdV9yZWFkX2xvY2soKTsK
Kwl2bSA9IHJjdV9kZXJlZmVyZW5jZShjdHgtPnZtKSA/OiAmaTkxNS0+Z2d0dC5hbGlhcy0+dm07
CiAJaWYgKCF2bSB8fCAhdm0tPmhhc19yZWFkX29ubHkpIHsKKwkJcmN1X3JlYWRfdW5sb2NrKCk7
CiAJCWVyciA9IDA7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290byBvdXRfZmlsZTsKIAl9CisJ
cmN1X3JlYWRfdW5sb2NrKCk7CiAKIAluZHdvcmRzID0gMDsKIAlkdyA9IDA7CkBAIC0xMTU5LDcg
KzExNDYsNyBAQCBzdGF0aWMgaW50IGlndF9jdHhfcmVhZG9ubHkodm9pZCAqYXJnKQogCQkJCWlm
IChJU19FUlIob2JqKSkgewogCQkJCQllcnIgPSBQVFJfRVJSKG9iaik7CiAJCQkJCWk5MTVfZ2Vt
X2NvbnRleHRfdW5sb2NrX2VuZ2luZXMoY3R4KTsKLQkJCQkJZ290byBvdXRfdW5sb2NrOworCQkJ
CQlnb3RvIG91dF9maWxlOwogCQkJCX0KIAogCQkJCWlmIChwcmFuZG9tX3UzMl9zdGF0ZSgmcHJu
ZykgJiAxKQpAQCAtMTE3MCwxNSArMTE1NywxNyBAQCBzdGF0aWMgaW50IGlndF9jdHhfcmVhZG9u
bHkodm9pZCAqYXJnKQogCQkJaWYgKGVycikgewogCQkJCXByX2VycigiRmFpbGVkIHRvIGZpbGwg
ZHdvcmQgJWx1IFslbHUvJWx1XSB3aXRoIGdwdSAoJXMpIFtmdWxsLXBwZ3R0PyAlc10sIGVycj0l
ZFxuIiwKIAkJCQkgICAgICAgbmR3b3JkcywgZHcsIG1heF9kd29yZHMob2JqKSwKLQkJCQkgICAg
ICAgY2UtPmVuZ2luZS0+bmFtZSwgeWVzbm8oISFjdHgtPnZtKSwgZXJyKTsKKwkJCQkgICAgICAg
Y2UtPmVuZ2luZS0+bmFtZSwKKwkJCQkgICAgICAgeWVzbm8oISFyY3VfYWNjZXNzX3BvaW50ZXIo
Y3R4LT52bSkpLAorCQkJCSAgICAgICBlcnIpOwogCQkJCWk5MTVfZ2VtX2NvbnRleHRfdW5sb2Nr
X2VuZ2luZXMoY3R4KTsKLQkJCQlnb3RvIG91dF91bmxvY2s7CisJCQkJZ290byBvdXRfZmlsZTsK
IAkJCX0KIAogCQkJZXJyID0gdGhyb3R0bGUoY2UsIHRxLCBBUlJBWV9TSVpFKHRxKSk7CiAJCQlp
ZiAoZXJyKSB7CiAJCQkJaTkxNV9nZW1fY29udGV4dF91bmxvY2tfZW5naW5lcyhjdHgpOwotCQkJ
CWdvdG8gb3V0X3VubG9jazsKKwkJCQlnb3RvIG91dF9maWxlOwogCQkJfQogCiAJCQlpZiAoKytk
dyA9PSBtYXhfZHdvcmRzKG9iaikpIHsKQEAgLTEyMTAsMTEgKzExOTksMTAgQEAgc3RhdGljIGlu
dCBpZ3RfY3R4X3JlYWRvbmx5KHZvaWQgKmFyZykKIAkJZHcgKz0gcmVtOwogCX0KIAotb3V0X3Vu
bG9jazoKK291dF9maWxlOgogCXRocm90dGxlX3JlbGVhc2UodHEsIEFSUkFZX1NJWkUodHEpKTsK
IAlpZiAoaWd0X2xpdmVfdGVzdF9lbmQoJnQpKQogCQllcnIgPSAtRUlPOwotCW11dGV4X3VubG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAltb2NrX2ZpbGVfZnJlZShpOTE1LCBmaWxl
KTsKIAlyZXR1cm4gZXJyOwpAQCAtMTIyMyw3ICsxMjExLDcgQEAgc3RhdGljIGludCBpZ3RfY3R4
X3JlYWRvbmx5KHZvaWQgKmFyZykKIHN0YXRpYyBpbnQgY2hlY2tfc2NyYXRjaChzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dCAqY3R4LCB1NjQgb2Zmc2V0KQogewogCXN0cnVjdCBkcm1fbW1fbm9kZSAq
bm9kZSA9Ci0JCV9fZHJtX21tX2ludGVydmFsX2ZpcnN0KCZjdHgtPnZtLT5tbSwKKwkJX19kcm1f
bW1faW50ZXJ2YWxfZmlyc3QoJnJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQoY3R4LT52bSwgdHJ1
ZSktPm1tLAogCQkJCQlvZmZzZXQsIG9mZnNldCArIHNpemVvZih1MzIpIC0gMSk7CiAJaWYgKCFu
b2RlIHx8IG5vZGUtPnN0YXJ0ID4gb2Zmc2V0KQogCQlyZXR1cm4gMDsKQEAgLTEyNzMsNyArMTI2
MSw5IEBAIHN0YXRpYyBpbnQgd3JpdGVfdG9fc2NyYXRjaChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqY3R4LAogCiAJaW50ZWxfZ3RfY2hpcHNldF9mbHVzaChlbmdpbmUtPmd0KTsKIAotCXZtYSA9
IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgY3R4LT52bSwgTlVMTCk7CisJdm1hID0gaTkxNV92bWFf
aW5zdGFuY2Uob2JqLAorCQkJCXJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQoY3R4LT52bSwgdHJ1
ZSksCisJCQkJTlVMTCk7CiAJaWYgKElTX0VSUih2bWEpKSB7CiAJCWVyciA9IFBUUl9FUlIodm1h
KTsKIAkJZ290byBlcnI7CkBAIC0xMzcyLDcgKzEzNjIsOSBAQCBzdGF0aWMgaW50IHJlYWRfZnJv
bV9zY3JhdGNoKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAKIAlpbnRlbF9ndF9jaGlw
c2V0X2ZsdXNoKGVuZ2luZS0+Z3QpOwogCi0Jdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCBj
dHgtPnZtLCBOVUxMKTsKKwl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosCisJCQkJcmN1X2Rl
cmVmZXJlbmNlX3Byb3RlY3RlZChjdHgtPnZtLCB0cnVlKSwKKwkJCQlOVUxMKTsKIAlpZiAoSVNf
RVJSKHZtYSkpIHsKIAkJZXJyID0gUFRSX0VSUih2bWEpOwogCQlnb3RvIGVycjsKQEAgLTE0NjMs
MjcgKzE0NTUsMjUgQEAgc3RhdGljIGludCBpZ3Rfdm1faXNvbGF0aW9uKHZvaWQgKmFyZykKIAlp
ZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKIAotCW11dGV4X2xvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJZXJyID0gaWd0X2xpdmVfdGVzdF9iZWdpbigm
dCwgaTkxNSwgX19mdW5jX18sICIiKTsKIAlpZiAoZXJyKQotCQlnb3RvIG91dF91bmxvY2s7CisJ
CWdvdG8gb3V0X2ZpbGU7CiAKIAljdHhfYSA9IGxpdmVfY29udGV4dChpOTE1LCBmaWxlKTsKIAlp
ZiAoSVNfRVJSKGN0eF9hKSkgewogCQllcnIgPSBQVFJfRVJSKGN0eF9hKTsKLQkJZ290byBvdXRf
dW5sb2NrOworCQlnb3RvIG91dF9maWxlOwogCX0KIAogCWN0eF9iID0gbGl2ZV9jb250ZXh0KGk5
MTUsIGZpbGUpOwogCWlmIChJU19FUlIoY3R4X2IpKSB7CiAJCWVyciA9IFBUUl9FUlIoY3R4X2Ip
OwotCQlnb3RvIG91dF91bmxvY2s7CisJCWdvdG8gb3V0X2ZpbGU7CiAJfQogCiAJLyogV2UgY2Fu
IG9ubHkgdGVzdCB2bSBpc29sYXRpb24sIGlmIHRoZSB2bSBhcmUgZGlzdGluY3QgKi8KIAlpZiAo
Y3R4X2EtPnZtID09IGN0eF9iLT52bSkKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3RvIG91dF9m
aWxlOwogCiAJdm1fdG90YWwgPSBjdHhfYS0+dm0tPnRvdGFsOwogCUdFTV9CVUdfT04oY3R4X2It
PnZtLT50b3RhbCAhPSB2bV90b3RhbCk7CkBAIC0xNTEyLDcgKzE1MDIsNyBAQCBzdGF0aWMgaW50
IGlndF92bV9pc29sYXRpb24odm9pZCAqYXJnKQogCQkJCWVyciA9IHJlYWRfZnJvbV9zY3JhdGNo
KGN0eF9iLCBlbmdpbmUsCiAJCQkJCQkJb2Zmc2V0LCAmdmFsdWUpOwogCQkJaWYgKGVycikKLQkJ
CQlnb3RvIG91dF91bmxvY2s7CisJCQkJZ290byBvdXRfZmlsZTsKIAogCQkJaWYgKHZhbHVlKSB7
CiAJCQkJcHJfZXJyKCIlczogUmVhZCAlMDh4IGZyb20gc2NyYXRjaCAob2Zmc2V0IDB4JTA4eF8l
MDh4KSwgYWZ0ZXIgJWx1IHJlYWRzIVxuIiwKQEAgLTE1MjEsNyArMTUxMSw3IEBAIHN0YXRpYyBp
bnQgaWd0X3ZtX2lzb2xhdGlvbih2b2lkICphcmcpCiAJCQkJICAgICAgIGxvd2VyXzMyX2JpdHMo
b2Zmc2V0KSwKIAkJCQkgICAgICAgdGhpcyk7CiAJCQkJZXJyID0gLUVJTlZBTDsKLQkJCQlnb3Rv
IG91dF91bmxvY2s7CisJCQkJZ290byBvdXRfZmlsZTsKIAkJCX0KIAogCQkJdGhpcysrOwpAQCAt
MTUzMSwxMSArMTUyMSw5IEBAIHN0YXRpYyBpbnQgaWd0X3ZtX2lzb2xhdGlvbih2b2lkICphcmcp
CiAJcHJfaW5mbygiQ2hlY2tlZCAlbHUgc2NyYXRjaCBvZmZzZXRzIGFjcm9zcyAlZCBlbmdpbmVz
XG4iLAogCQljb3VudCwgUlVOVElNRV9JTkZPKGk5MTUpLT5udW1fZW5naW5lcyk7CiAKLW91dF91
bmxvY2s6CitvdXRfZmlsZToKIAlpZiAoaWd0X2xpdmVfdGVzdF9lbmQoJnQpKQogCQllcnIgPSAt
RUlPOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAltb2NrX2Zp
bGVfZnJlZShpOTE1LCBmaWxlKTsKIAlyZXR1cm4gZXJyOwogfQpAQCAtMTU4MiwxMyArMTU3MCw5
IEBAIHN0YXRpYyBpbnQgbW9ja19jb250ZXh0X2JhcnJpZXIodm9pZCAqYXJnKQogCSAqIGEgcmVx
dWVzdDsgdXNlZnVsIGZvciByZXRpcmluZyBvbGQgc3RhdGUgYWZ0ZXIgbG9hZGluZyBuZXcuCiAJ
ICovCiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWN0eCA9IG1v
Y2tfY29udGV4dChpOTE1LCAibW9jayIpOwotCWlmICghY3R4KSB7Ci0JCWVyciA9IC1FTk9NRU07
Ci0JCWdvdG8gdW5sb2NrOwotCX0KKwlpZiAoIWN0eCkKKwkJcmV0dXJuIC1FTk9NRU07CiAKIAlj
b3VudGVyID0gMDsKIAllcnIgPSBjb250ZXh0X2JhcnJpZXJfdGFzayhjdHgsIDAsCkBAIC0xNjYx
LDggKzE2NDUsNiBAQCBzdGF0aWMgaW50IG1vY2tfY29udGV4dF9iYXJyaWVyKHZvaWQgKmFyZykK
IAogb3V0OgogCW1vY2tfY29udGV4dF9jbG9zZShjdHgpOwotdW5sb2NrOgotCW11dGV4X3VubG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKICN1bmRlZiBwcl9mbXQK
ICNkZWZpbmUgcHJfZm10KHgpIHgKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9zZWxmdGVzdHMvbW9ja19jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL21vY2tfY29udGV4dC5jCmluZGV4IGViYzQ2ZjA5ODU2MS4uNmVmODZlNzkyM2E3IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL21vY2tfY29udGV4
dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvbW9ja19jb250ZXh0
LmMKQEAgLTY3LDcgKzY3LDcgQEAgdm9pZCBtb2NrX2NvbnRleHRfY2xvc2Uoc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHQgKmN0eCkKIAogdm9pZCBtb2NrX2luaXRfY29udGV4dHMoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JaW5pdF9jb250ZXh0cyhpOTE1KTsKKwlpbml0X2NvbnRl
eHRzKCZpOTE1LT5nZW0uY29udGV4dHMpOwogfQogCiBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAq
CkBAIC03Niw4ICs3Niw2IEBAIGxpdmVfY29udGV4dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwgc3RydWN0IGRybV9maWxlICpmaWxlKQogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpj
dHg7CiAJaW50IGVycjsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwotCiAJY3R4ID0gaTkxNV9nZW1fY3JlYXRlX2NvbnRleHQoaTkxNSwgMCk7CiAJaWYg
KElTX0VSUihjdHgpKQogCQlyZXR1cm4gY3R4OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
Y29udGV4dC5jCmluZGV4IDU3ZTEzYzZmNTljNS4uNzY0ZDI2NTJiMDc3IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCkBAIC0yMjYsNyArMjI2LDEzIEBAIGludGVsX2Nv
bnRleHRfaW5pdChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJa3JlZl9pbml0KCZjZS0+cmVm
KTsKIAogCWNlLT5nZW1fY29udGV4dCA9IGN0eDsKLQljZS0+dm0gPSBpOTE1X3ZtX2dldChjdHgt
PnZtID86ICZlbmdpbmUtPmd0LT5nZ3R0LT52bSk7CisJcmN1X3JlYWRfbG9jaygpOworCWNlLT52
bSA9IHJjdV9kZXJlZmVyZW5jZShjdHgtPnZtKTsKKwlpZiAoY2UtPnZtICYmICFrcmVmX2dldF91
bmxlc3NfemVybygmY2UtPnZtLT5yZWYpKQorCQljZS0+dm0gPSBOVUxMOworCWlmICghY2UtPnZt
KQorCQljZS0+dm0gPSBpOTE1X3ZtX2dldCgmZW5naW5lLT5ndC0+Z2d0dC0+dm0pOworCXJjdV9y
ZWFkX3VubG9jaygpOwogCWlmIChjdHgtPnRpbWVsaW5lKQogCQljZS0+dGltZWxpbmUgPSBpbnRl
bF90aW1lbGluZV9nZXQoY3R4LT50aW1lbGluZSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3NlbGZ0ZXN0X2NvbnRleHQuYwppbmRleCA4ODM3MzkzNTRiMDcuLjQ1YjM3ODM3YTU3OSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYwpAQCAtMTQ5LDEzICsx
NDksOSBAQCBzdGF0aWMgaW50IGxpdmVfY29udGV4dF9zaXplKHZvaWQgKmFyZykKIAkgKiBIVyB0
cmllcyB0byB3cml0ZSBwYXN0IHRoZSBlbmQgb2Ygb25lLgogCSAqLwogCi0JbXV0ZXhfbG9jaygm
Z3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJZml4bWUgPSBrZXJuZWxfY29udGV4dChn
dC0+aTkxNSk7Ci0JaWYgKElTX0VSUihmaXhtZSkpIHsKLQkJZXJyID0gUFRSX0VSUihmaXhtZSk7
Ci0JCWdvdG8gdW5sb2NrOwotCX0KKwlpZiAoSVNfRVJSKGZpeG1lKSkKKwkJcmV0dXJuIFBUUl9F
UlIoZml4bWUpOwogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5MTUsIGlkKSB7CiAJ
CXN0cnVjdCB7CkBAIC0xOTUsOCArMTkxLDYgQEAgc3RhdGljIGludCBsaXZlX2NvbnRleHRfc2l6
ZSh2b2lkICphcmcpCiAJfQogCiAJa2VybmVsX2NvbnRleHRfY2xvc2UoZml4bWUpOwotdW5sb2Nr
OgotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBl
cnI7CiB9CiAKQEAgLTI5OSwxMiArMjkzLDEwIEBAIHN0YXRpYyBpbnQgbGl2ZV9hY3RpdmVfY29u
dGV4dCh2b2lkICphcmcpCiAJaWYgKElTX0VSUihmaWxlKSkKIAkJcmV0dXJuIFBUUl9FUlIoZmls
ZSk7CiAKLQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlmaXht
ZSA9IGxpdmVfY29udGV4dChndC0+aTkxNSwgZmlsZSk7CiAJaWYgKElTX0VSUihmaXhtZSkpIHsK
IAkJZXJyID0gUFRSX0VSUihmaXhtZSk7Ci0JCWdvdG8gdW5sb2NrOworCQlnb3RvIG91dF9maWxl
OwogCX0KIAogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LT5pOTE1LCBpZCkgewpAQCAtMzE3
LDggKzMwOSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9hY3RpdmVfY29udGV4dCh2b2lkICphcmcpCiAJ
CQlicmVhazsKIAl9CiAKLXVubG9jazoKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKK291dF9maWxlOgogCW1vY2tfZmlsZV9mcmVlKGd0LT5pOTE1LCBmaWxlKTsK
IAlyZXR1cm4gZXJyOwogfQpAQCAtNDEyLDEyICs0MDMsMTAgQEAgc3RhdGljIGludCBsaXZlX3Jl
bW90ZV9jb250ZXh0KHZvaWQgKmFyZykKIAlpZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRS
X0VSUihmaWxlKTsKIAotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
LQogCWZpeG1lID0gbGl2ZV9jb250ZXh0KGd0LT5pOTE1LCBmaWxlKTsKIAlpZiAoSVNfRVJSKGZp
eG1lKSkgewogCQllcnIgPSBQVFJfRVJSKGZpeG1lKTsKLQkJZ290byB1bmxvY2s7CisJCWdvdG8g
b3V0X2ZpbGU7CiAJfQogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5MTUsIGlkKSB7
CkBAIC00MzAsOCArNDE5LDcgQEAgc3RhdGljIGludCBsaXZlX3JlbW90ZV9jb250ZXh0KHZvaWQg
KmFyZykKIAkJCWJyZWFrOwogCX0KIAotdW5sb2NrOgotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOworb3V0X2ZpbGU6CiAJbW9ja19maWxlX2ZyZWUoZ3QtPmk5MTUs
IGZpbGUpOwogCXJldHVybiBlcnI7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X2hhbmdjaGVjay5jCmluZGV4IGYyYjVhYjFlNWEyZS4uMWI4MzZmZjBhNzU2IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYwpAQCAtNTgsOSArNTgs
NyBAQCBzdGF0aWMgaW50IGhhbmdfaW5pdChzdHJ1Y3QgaGFuZyAqaCwgc3RydWN0IGludGVsX2d0
ICpndCkKIAltZW1zZXQoaCwgMCwgc2l6ZW9mKCpoKSk7CiAJaC0+Z3QgPSBndDsKIAotCW11dGV4
X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAloLT5jdHggPSBrZXJuZWxfY29u
dGV4dChndC0+aTkxNSk7Ci0JbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAJaWYgKElTX0VSUihoLT5jdHgpKQogCQlyZXR1cm4gUFRSX0VSUihoLT5jdHgpOwogCkBA
IC0xMzMsNyArMTMxLDggQEAgc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3QgKgogaGFuZ19jcmVh
dGVfcmVxdWVzdChzdHJ1Y3QgaGFuZyAqaCwgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5l
KQogewogCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBoLT5ndDsKLQlzdHJ1Y3QgaTkxNV9hZGRyZXNz
X3NwYWNlICp2bSA9IGgtPmN0eC0+dm0gPzogJmVuZ2luZS0+Z3QtPmdndHQtPnZtOworCXN0cnVj
dCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0KKwkJcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZCho
LT5jdHgtPnZtLCB0cnVlKSA/OiAmZW5naW5lLT5ndC0+Z2d0dC0+dm07CiAJc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iajsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSA9IE5VTEw7CiAJ
c3RydWN0IGk5MTVfdm1hICpod3MsICp2bWE7CkBAIC0zODIsOSArMzgxLDcgQEAgc3RhdGljIGlu
dCBpZ3RfcmVzZXRfbm9wKHZvaWQgKmFyZykKIAlpZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1cm4g
UFRSX0VSUihmaWxlKTsKIAotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKIAljdHggPSBsaXZlX2NvbnRleHQoZ3QtPmk5MTUsIGZpbGUpOwotCW11dGV4X3VubG9jaygm
Z3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChJU19FUlIoY3R4KSkgewogCQllcnIg
PSBQVFJfRVJSKGN0eCk7CiAJCWdvdG8gb3V0OwpAQCAtNDU4LDkgKzQ1NSw3IEBAIHN0YXRpYyBp
bnQgaWd0X3Jlc2V0X25vcF9lbmdpbmUodm9pZCAqYXJnKQogCWlmIChJU19FUlIoZmlsZSkpCiAJ
CXJldHVybiBQVFJfRVJSKGZpbGUpOwogCi0JbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCWN0eCA9IGxpdmVfY29udGV4dChndC0+aTkxNSwgZmlsZSk7Ci0JbXV0ZXhf
dW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKElTX0VSUihjdHgpKSB7
CiAJCWVyciA9IFBUUl9FUlIoY3R4KTsKIAkJZ290byBvdXQ7CkBAIC03MDUsOSArNzAwLDcgQEAg
c3RhdGljIGludCBhY3RpdmVfZW5naW5lKHZvaWQgKmRhdGEpCiAJCXJldHVybiBQVFJfRVJSKGZp
bGUpOwogCiAJZm9yIChjb3VudCA9IDA7IGNvdW50IDwgQVJSQVlfU0laRShjdHgpOyBjb3VudCsr
KSB7Ci0JCW11dGV4X2xvY2soJmVuZ2luZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWN0
eFtjb3VudF0gPSBsaXZlX2NvbnRleHQoZW5naW5lLT5pOTE1LCBmaWxlKTsKLQkJbXV0ZXhfdW5s
b2NrKCZlbmdpbmUtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQlpZiAoSVNfRVJSKGN0eFtj
b3VudF0pKSB7CiAJCQllcnIgPSBQVFJfRVJSKGN0eFtjb3VudF0pOwogCQkJd2hpbGUgKC0tY291
bnQpCkBAIC0xMjk4LDE4ICsxMjkxLDE4IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X2V2aWN0X3Bw
Z3R0KHZvaWQgKmFyZykKIAlpZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRSX0VSUihmaWxl
KTsKIAotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAljdHggPSBs
aXZlX2NvbnRleHQoZ3QtPmk5MTUsIGZpbGUpOwotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChJU19FUlIoY3R4KSkgewogCQllcnIgPSBQVFJfRVJSKGN0
eCk7CiAJCWdvdG8gb3V0OwogCX0KIAogCWVyciA9IDA7Ci0JaWYgKGN0eC0+dm0pIC8qIGFsaWFz
aW5nID09IGdsb2JhbCBndHQgbG9ja2luZywgY292ZXJlZCBhYm92ZSAqLwotCQllcnIgPSBfX2ln
dF9yZXNldF9ldmljdF92bWEoZ3QsIGN0eC0+dm0sCisJaWYgKHJjdV9hY2Nlc3NfcG9pbnRlcihj
dHgtPnZtKSkgeworCQkvKiBhbGlhc2luZyA9PSBnbG9iYWwgZ3R0IGxvY2tpbmcsIGNvdmVyZWQg
YWJvdmUgKi8KKwkJZXJyID0gX19pZ3RfcmVzZXRfZXZpY3Rfdm1hKGd0LCByY3VfZGVyZWZlcmVu
Y2VfcHJvdGVjdGVkKGN0eC0+dm0sIHRydWUpLAogCQkJCQkgICAgZXZpY3Rfdm1hLCBFWEVDX09C
SkVDVF9XUklURSk7CisJfQogCiBvdXQ6CiAJbW9ja19maWxlX2ZyZWUoZ3QtPmk5MTUsIGZpbGUp
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwppbmRleCAyMjJhNzM3NWM3ODcu
LmFlMWVlZjYxZGZiZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKQEAg
LTE0NDMsNyArMTQ0Myw5IEBAIHN0YXRpYyBpbnQgc21va2Vfc3VibWl0KHN0cnVjdCBwcmVlbXB0
X3Ntb2tlICpzbW9rZSwKIAlpbnQgZXJyID0gMDsKIAogCWlmIChiYXRjaCkgewotCQl2bWEgPSBp
OTE1X3ZtYV9pbnN0YW5jZShiYXRjaCwgY3R4LT52bSwgTlVMTCk7CisJCXZtYSA9IGk5MTVfdm1h
X2luc3RhbmNlKGJhdGNoLAorCQkJCQlyY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKGN0eC0+dm0s
IHRydWUpLAorCQkJCQlOVUxMKTsKIAkJaWYgKElTX0VSUih2bWEpKQogCQkJcmV0dXJuIFBUUl9F
UlIodm1hKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
d29ya2Fyb3VuZHMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91
bmRzLmMKaW5kZXggMDYzNTFmZWZiYmYzLi45MzhjYTIwNDcyNWUgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29ya2Fyb3VuZHMuYwpAQCAtMzYyLDcgKzM2Miw5IEBA
IHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKmNyZWF0ZV9iYXRjaChzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqY3R4KQogCWlmIChJU19FUlIob2JqKSkKIAkJcmV0dXJuIEVSUl9DQVNUKG9iaik7CiAK
LQl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosIGN0eC0+dm0sIE5VTEwpOworCXZtYSA9IGk5
MTVfdm1hX2luc3RhbmNlKG9iaiwKKwkJCQlyY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKGN0eC0+
dm0sIHRydWUpLAorCQkJCU5VTEwpOwogCWlmIChJU19FUlIodm1hKSkgewogCQllcnIgPSBQVFJf
RVJSKHZtYSk7CiAJCWdvdG8gZXJyX29iajsKQEAgLTQ2OCw3ICs0NzAsOCBAQCBzdGF0aWMgaW50
IGNoZWNrX2RpcnR5X3doaXRlbGlzdChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogCWlu
dCBlcnIgPSAwLCBpLCB2OwogCXUzMiAqY3MsICpyZXN1bHRzOwogCi0Jc2NyYXRjaCA9IGNyZWF0
ZV9zY3JhdGNoKGN0eC0+dm0sIDIgKiBBUlJBWV9TSVpFKHZhbHVlcykgKyAxKTsKKwlzY3JhdGNo
ID0gY3JlYXRlX3NjcmF0Y2gocmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChjdHgtPnZtLCB0cnVl
KSwKKwkJCQkgMiAqIEFSUkFZX1NJWkUodmFsdWVzKSArIDEpOwogCWlmIChJU19FUlIoc2NyYXRj
aCkpCiAJCXJldHVybiBQVFJfRVJSKHNjcmF0Y2gpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2No
ZWR1bGVyLmMKaW5kZXggNmJlYjc1M2IxZWExLi5hMGY3YWUzOTVlYzcgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndnQvc2NoZWR1bGVyLmMKQEAgLTM2NSw3ICszNjUsOCBAQCBzdGF0aWMgdm9pZCBzZXRf
Y29udGV4dF9wcGd0dF9mcm9tX3NoYWRvdyhzdHJ1Y3QgaW50ZWxfdmdwdV93b3JrbG9hZCAqd29y
a2xvYWQsCiAJCQkJCSAgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIHsKIAlzdHJ1Y3Qg
aW50ZWxfdmdwdV9tbSAqbW0gPSB3b3JrbG9hZC0+c2hhZG93X21tOwotCXN0cnVjdCBpOTE1X3Bw
Z3R0ICpwcGd0dCA9IGk5MTVfdm1fdG9fcHBndHQoY3R4LT52bSk7CisJc3RydWN0IGk5MTVfcHBn
dHQgKnBwZ3R0ID0KKwkJaTkxNV92bV90b19wcGd0dChyY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVk
KGN0eC0+dm0sIHRydWUpKTsKIAlpbnQgaSA9IDA7CiAKIAlpZiAobW0tPnBwZ3R0X21tLnJvb3Rf
ZW50cnlfdHlwZSA9PSBHVFRfVFlQRV9QUEdUVF9ST09UX0w0X0VOVFJZKSB7CkBAIC0xMjEzLDIw
ICsxMjE0LDE4IEBAIGludCBpbnRlbF92Z3B1X3NldHVwX3N1Ym1pc3Npb24oc3RydWN0IGludGVs
X3ZncHUgKnZncHUpCiAJc3RydWN0IGludGVsX3ZncHVfc3VibWlzc2lvbiAqcyA9ICZ2Z3B1LT5z
dWJtaXNzaW9uOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAlzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dCAqY3R4OworCXN0cnVjdCBpOTE1X3BwZ3R0ICpwcGd0dDsKIAllbnVtIGlu
dGVsX2VuZ2luZV9pZCBpOwogCWludCByZXQ7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKLQogCWN0eCA9IGk5MTVfZ2VtX2NvbnRleHRfY3JlYXRlX2tlcm5lbChpOTE1
LCBJOTE1X1BSSU9SSVRZX01BWCk7Ci0JaWYgKElTX0VSUihjdHgpKSB7Ci0JCXJldCA9IFBUUl9F
UlIoY3R4KTsKLQkJZ290byBvdXRfdW5sb2NrOwotCX0KKwlpZiAoSVNfRVJSKGN0eCkpCisJCXJl
dHVybiBQVFJfRVJSKGN0eCk7CiAKIAlpOTE1X2dlbV9jb250ZXh0X3NldF9mb3JjZV9zaW5nbGVf
c3VibWlzc2lvbihjdHgpOwogCi0JaTkxNV9jb250ZXh0X3BwZ3R0X3Jvb3Rfc2F2ZShzLCBpOTE1
X3ZtX3RvX3BwZ3R0KGN0eC0+dm0pKTsKKwlwcGd0dCA9IGk5MTVfdm1fdG9fcHBndHQocmN1X2Rl
cmVmZXJlbmNlX3Byb3RlY3RlZChjdHgtPnZtLCB0cnVlKSk7CisJaTkxNV9jb250ZXh0X3BwZ3R0
X3Jvb3Rfc2F2ZShzLCBwcGd0dCk7CiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBp
KSB7CiAJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKQEAgLTEyNzIsMTEgKzEyNzEsMTAgQEAg
aW50IGludGVsX3ZncHVfc2V0dXBfc3VibWlzc2lvbihzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkK
IAliaXRtYXBfemVybyhzLT50bGJfaGFuZGxlX3BlbmRpbmcsIEk5MTVfTlVNX0VOR0lORVMpOwog
CiAJaTkxNV9nZW1fY29udGV4dF9wdXQoY3R4KTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCXJldHVybiAwOwogCiBvdXRfc2hhZG93X2N0eDoKLQlpOTE1X2NvbnRl
eHRfcHBndHRfcm9vdF9yZXN0b3JlKHMsIGk5MTVfdm1fdG9fcHBndHQoY3R4LT52bSkpOworCWk5
MTVfY29udGV4dF9wcGd0dF9yb290X3Jlc3RvcmUocywgcHBndHQpOwogCWZvcl9lYWNoX2VuZ2lu
ZShlbmdpbmUsIGk5MTUsIGkpIHsKIAkJaWYgKElTX0VSUihzLT5zaGFkb3dbaV0pKQogCQkJYnJl
YWs7CkBAIC0xMjg1LDggKzEyODMsNiBAQCBpbnQgaW50ZWxfdmdwdV9zZXR1cF9zdWJtaXNzaW9u
KHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQogCQlpbnRlbF9jb250ZXh0X3B1dChzLT5zaGFkb3db
aV0pOwogCX0KIAlpOTE1X2dlbV9jb250ZXh0X3B1dChjdHgpOwotb3V0X3VubG9jazoKLQltdXRl
eF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiByZXQ7CiB9CiAKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKaW5kZXggNzM3ZWE0ZDNkN2MyLi44OWNhNDhjODAy
YWQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCkBAIC0zMDYsNyArMzA2LDggQEAg
c3RhdGljIHZvaWQgcHJpbnRfY29udGV4dF9zdGF0cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sCiAJc3Ry
dWN0IGZpbGVfc3RhdHMga3N0YXRzID0ge307CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0
eDsKIAotCWxpc3RfZm9yX2VhY2hfZW50cnkoY3R4LCAmaTkxNS0+Y29udGV4dHMubGlzdCwgbGlu
aykgeworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmdlbS5jb250ZXh0cy5tdXRleCk7CisJ
bGlzdF9mb3JfZWFjaF9lbnRyeShjdHgsICZpOTE1LT5nZW0uY29udGV4dHMubGlzdCwgbGluaykg
ewogCQlzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lc19pdGVyIGl0OwogCQlzdHJ1Y3QgaW50ZWxfY29u
dGV4dCAqY2U7CiAKQEAgLTMyNCw3ICszMjUsOSBAQCBzdGF0aWMgdm9pZCBwcmludF9jb250ZXh0
X3N0YXRzKHN0cnVjdCBzZXFfZmlsZSAqbSwKIAkJaTkxNV9nZW1fY29udGV4dF91bmxvY2tfZW5n
aW5lcyhjdHgpOwogCiAJCWlmICghSVNfRVJSX09SX05VTEwoY3R4LT5maWxlX3ByaXYpKSB7Ci0J
CQlzdHJ1Y3QgZmlsZV9zdGF0cyBzdGF0cyA9IHsgLnZtID0gY3R4LT52bSwgfTsKKwkJCXN0cnVj
dCBmaWxlX3N0YXRzIHN0YXRzID0geworCQkJCS52bSA9IHJjdV9hY2Nlc3NfcG9pbnRlcihjdHgt
PnZtKSwKKwkJCX07CiAJCQlzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUgPSBjdHgtPmZpbGVfcHJpdi0+
ZmlsZTsKIAkJCXN0cnVjdCB0YXNrX3N0cnVjdCAqdGFzazsKIAkJCWNoYXIgbmFtZVs4MF07CkBA
IC0zNTgsMTIgKzM2MSwxMiBAQCBzdGF0aWMgaW50IGk5MTVfZ2VtX29iamVjdF9pbmZvKHN0cnVj
dCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKIAogCXNlcV9wdXRjKG0sICdcbicpOwogCi0JcmV0
ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwly
ZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmk5MTUtPmdlbS5jb250ZXh0cy5tdXRleCk7
CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAogCXByaW50X2NvbnRleHRfc3RhdHMobSwgaTkx
NSk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF91bmxv
Y2soJmk5MTUtPmdlbS5jb250ZXh0cy5tdXRleCk7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTE0NzQs
MTYgKzE0NzcsMTUgQEAgc3RhdGljIHZvaWQgZGVzY3JpYmVfY3R4X3Jpbmcoc3RydWN0IHNlcV9m
aWxlICptLCBzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZykKIAogc3RhdGljIGludCBpOTE1X2NvbnRl
eHRfc3RhdHVzKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqdW51c2VkKQogewotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKLQlz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmRldl9wcml2LT5kcm07CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7CiAJc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHQgKmN0eDsKIAlpbnQgcmV0OwogCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1
cHRpYmxlKCZkZXYtPnN0cnVjdF9tdXRleCk7CisJcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRp
YmxlKCZpOTE1LT5nZW0uY29udGV4dHMubXV0ZXgpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7
CiAKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KGN0eCwgJmRldl9wcml2LT5jb250ZXh0cy5saXN0LCBs
aW5rKSB7CisJbGlzdF9mb3JfZWFjaF9lbnRyeShjdHgsICZpOTE1LT5nZW0uY29udGV4dHMubGlz
dCwgbGluaykgewogCQlzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lc19pdGVyIGl0OwogCQlzdHJ1Y3Qg
aW50ZWxfY29udGV4dCAqY2U7CiAKQEAgLTE1MjMsNyArMTUyNSw3IEBAIHN0YXRpYyBpbnQgaTkx
NV9jb250ZXh0X3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKnVudXNlZCkKIAkJc2Vx
X3B1dGMobSwgJ1xuJyk7CiAJfQogCi0JbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7
CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5nZW0uY29udGV4dHMubXV0ZXgpOwogCiAJcmV0dXJuIDA7
CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYwppbmRleCA0NWRkNjVmZDIzMWIuLjVlZjNiM2FiODFl
MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jCkBAIC0xNjkxLDEwICsxNjkxLDggQEAgc3RhdGlj
IHZvaWQgaTkxNV9kcml2ZXJfcG9zdGNsb3NlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHN0cnVj
dCBkcm1fZmlsZSAqZmlsZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfZmlsZV9wcml2YXRlICpmaWxl
X3ByaXYgPSBmaWxlLT5kcml2ZXJfcHJpdjsKIAotCW11dGV4X2xvY2soJmRldi0+c3RydWN0X211
dGV4KTsKIAlpOTE1X2dlbV9jb250ZXh0X2Nsb3NlKGZpbGUpOwogCWk5MTVfZ2VtX3JlbGVhc2Uo
ZGV2LCBmaWxlKTsKLQltdXRleF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKIAogCWtmcmVl
X3JjdShmaWxlX3ByaXYsIHJjdSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCmluZGV4IGRlN2Fm
ZjcwYTkzYi4uNzFkOGExOWZkNDU1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKQEAgLTE1MzQs
MjUgKzE1MzQsNiBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSB7CiAJc3RydWN0IG11dGV4IGF2
X211dGV4OwogCWludCBhdWRpb19wb3dlcl9yZWZjb3VudDsKIAotCXN0cnVjdCB7Ci0JCXN0cnVj
dCBtdXRleCBtdXRleDsKLQkJc3RydWN0IGxpc3RfaGVhZCBsaXN0OwotCQlzdHJ1Y3QgbGxpc3Rf
aGVhZCBmcmVlX2xpc3Q7Ci0JCXN0cnVjdCB3b3JrX3N0cnVjdCBmcmVlX3dvcms7Ci0KLQkJLyog
VGhlIGh3IHdhbnRzIHRvIGhhdmUgYSBzdGFibGUgY29udGV4dCBpZGVudGlmaWVyIGZvciB0aGUK
LQkJICogbGlmZXRpbWUgb2YgdGhlIGNvbnRleHQgKGZvciBPQSwgUEFTSUQsIGZhdWx0cywgZXRj
KS4KLQkJICogVGhpcyBpcyBsaW1pdGVkIGluIGV4ZWNsaXN0cyB0byAyMSBiaXRzLgotCQkgKi8K
LQkJc3RydWN0IGlkYSBod19pZGE7Ci0jZGVmaW5lIE1BWF9DT05URVhUX0hXX0lEICgxPDwyMSkg
LyogZXhjbHVzaXZlICovCi0jZGVmaW5lIE1BWF9HVUNfQ09OVEVYVF9IV19JRCAoMSA8PCAyMCkg
LyogZXhjbHVzaXZlICovCi0jZGVmaW5lIEdFTjExX01BWF9DT05URVhUX0hXX0lEICgxPDwxMSkg
LyogZXhjbHVzaXZlICovCi0vKiBpbiBHZW4xMiBJRCAweDdGRiBpcyByZXNlcnZlZCB0byBpbmRp
Y2F0ZSBpZGxlICovCi0jZGVmaW5lIEdFTjEyX01BWF9DT05URVhUX0hXX0lECShHRU4xMV9NQVhf
Q09OVEVYVF9IV19JRCAtIDEpCi0JCXN0cnVjdCBsaXN0X2hlYWQgaHdfaWRfbGlzdDsKLQl9IGNv
bnRleHRzOwotCiAJdTMyIGZkaV9yeF9jb25maWc7CiAKIAkvKiBTaGFkb3cgZm9yIERJU1BMQVlf
UEhZX0NPTlRST0wgd2hpY2ggY2FuJ3QgYmUgc2FmZWx5IHJlYWQgKi8KQEAgLTE3MDgsNiArMTY4
OSwxMyBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSB7CiAKIAlzdHJ1Y3QgewogCQlzdHJ1Y3Qg
bm90aWZpZXJfYmxvY2sgcG1fbm90aWZpZXI7CisKKwkJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHRz
IHsKKwkJCXN0cnVjdCBtdXRleCBtdXRleDsKKwkJCXN0cnVjdCBsaXN0X2hlYWQgbGlzdDsKKwkJ
CXN0cnVjdCBsbGlzdF9oZWFkIGZyZWVfbGlzdDsKKwkJCXN0cnVjdCB3b3JrX3N0cnVjdCBmcmVl
X3dvcms7CisJCX0gY29udGV4dHM7CiAJfSBnZW07CiAKIAkvKiBGb3IgaTk0NWdtIHZibGFuayBp
cnEgdnMuIEMzIHdvcmthcm91bmQgKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IGJkYjAz
NmZmN2ZjNy4uMjI5MTlhODk3NTI0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTEzODYs
NyArMTM4Niw3IEBAIGludCBpOTE1X2dlbV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKIAkJZ290byBlcnJfdW5sb2NrOwogCX0KIAotCXJldCA9IGk5MTVfZ2VtX2NvbnRl
eHRzX2luaXQoZGV2X3ByaXYpOworCXJldCA9IGk5MTVfZ2VtX2luaXRfY29udGV4dHMoZGV2X3By
aXYpOwogCWlmIChyZXQpIHsKIAkJR0VNX0JVR19PTihyZXQgPT0gLUVJTyk7CiAJCWdvdG8gZXJy
X3NjcmF0Y2g7CkBAIC0xNDY5LDcgKzE0NjksNyBAQCBpbnQgaTkxNV9nZW1faW5pdChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJfQogZXJyX2NvbnRleHQ6CiAJaWYgKHJldCAh
PSAtRUlPKQotCQlpOTE1X2dlbV9jb250ZXh0c19maW5pKGRldl9wcml2KTsKKwkJaTkxNV9nZW1f
ZHJpdmVyX3JlbGVhc2VfX2NvbnRleHRzKGRldl9wcml2KTsKIGVycl9zY3JhdGNoOgogCWk5MTVf
Z2VtX2Zpbmlfc2NyYXRjaChkZXZfcHJpdik7CiBlcnJfZ2d0dDoKQEAgLTE1NDQsMTEgKzE1NDQs
OSBAQCB2b2lkIGk5MTVfZ2VtX2RyaXZlcl9yZW1vdmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQogCiB2b2lkIGk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNlKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKIHsKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVj
dF9tdXRleCk7CiAJaW50ZWxfZW5naW5lc19jbGVhbnVwKGRldl9wcml2KTsKLQlpOTE1X2dlbV9j
b250ZXh0c19maW5pKGRldl9wcml2KTsKKwlpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZV9fY29udGV4
dHMoZGV2X3ByaXYpOwogCWk5MTVfZ2VtX2Zpbmlfc2NyYXRjaChkZXZfcHJpdik7Ci0JbXV0ZXhf
dW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlpbnRlbF93YV9saXN0X2Zy
ZWUoJmRldl9wcml2LT5ndF93YV9saXN0KTsKIApAQCAtMTU2MCw3ICsxNTU4LDcgQEAgdm9pZCBp
OTE1X2dlbV9kcml2ZXJfcmVsZWFzZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiAKIAlpOTE1X2dlbV9kcmFpbl9mcmVlZF9vYmplY3RzKGRldl9wcml2KTsKIAotCVdBUk5fT04o
IWxpc3RfZW1wdHkoJmRldl9wcml2LT5jb250ZXh0cy5saXN0KSk7CisJV0FSTl9PTighbGlzdF9l
bXB0eSgmZGV2X3ByaXYtPmdlbS5jb250ZXh0cy5saXN0KSk7CiB9CiAKIHZvaWQgaTkxNV9nZW1f
aW5pdF9tbWlvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3BlcmYuYwppbmRleCAyMzY4ZDNiNjFlOTQuLmRhZWQ5NWIyNGRhYyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9wZXJmLmMKQEAgLTE4NjEsNyArMTg2MSw3IEBAIHN0YXRpYyBpbnQgZ2VuOF9jb25maWd1
cmVfYWxsX2NvbnRleHRzKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAjdW5kZWYg
Y3R4X2ZsZXhldU4KIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJc3RydWN0IGk5
MTVfZ2VtX2NvbnRleHQgKmN0eDsKLQlpbnQgaTsKKwlpbnQgaSwgZXJyOwogCiAJZm9yIChpID0g
MjsgaSA8IEFSUkFZX1NJWkUocmVncyk7IGkrKykKIAkJcmVnc1tpXS52YWx1ZSA9IG9hX2NvbmZp
Z19mbGV4X3JlZyhvYV9jb25maWcsIHJlZ3NbaV0ucmVnKTsKQEAgLTE4ODQsMTYgKzE4ODQsMTgg
QEAgc3RhdGljIGludCBnZW44X2NvbmZpZ3VyZV9hbGxfY29udGV4dHMoc3RydWN0IGk5MTVfcGVy
Zl9zdHJlYW0gKnN0cmVhbSwKIAkgKiBjb250ZXh0LiBDb250ZXh0cyBpZGxlIGF0IHRoZSB0aW1l
IG9mIHJlY29uZmlndXJhdGlvbiBhcmUgbm90CiAJICogdHJhcHBlZCBiZWhpbmQgdGhlIGJhcnJp
ZXIuCiAJICovCi0JbGlzdF9mb3JfZWFjaF9lbnRyeShjdHgsICZpOTE1LT5jb250ZXh0cy5saXN0
LCBsaW5rKSB7Ci0JCWludCBlcnI7Ci0KKwltdXRleF9sb2NrKCZpOTE1LT5nZW0uY29udGV4dHMu
bXV0ZXgpOworCWxpc3RfZm9yX2VhY2hfZW50cnkoY3R4LCAmaTkxNS0+Z2VtLmNvbnRleHRzLmxp
c3QsIGxpbmspIHsKIAkJaWYgKGN0eCA9PSBpOTE1LT5rZXJuZWxfY29udGV4dCkKIAkJCWNvbnRp
bnVlOwogCiAJCWVyciA9IGdlbjhfY29uZmlndXJlX2NvbnRleHQoY3R4LCByZWdzLCBBUlJBWV9T
SVpFKHJlZ3MpKTsKIAkJaWYgKGVycikKLQkJCXJldHVybiBlcnI7CisJCQlicmVhazsKIAl9CisJ
bXV0ZXhfdW5sb2NrKCZpOTE1LT5nZW0uY29udGV4dHMubXV0ZXgpOworCWlmIChlcnIpCisJCXJl
dHVybiBlcnI7CiAKIAkvKgogCSAqIEFmdGVyIHVwZGF0aW5nIGFsbCBvdGhlciBjb250ZXh0cywg
d2UgbmVlZCB0byBtb2RpZnkgb3Vyc2VsdmVzLgpAQCAtMTkwMiw3ICsxOTA0LDYgQEAgc3RhdGlj
IGludCBnZW44X2NvbmZpZ3VyZV9hbGxfY29udGV4dHMoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0g
KnN0cmVhbSwKIAkgKi8KIAlmb3JfZWFjaF91YWJpX2VuZ2luZShlbmdpbmUsIGk5MTUpIHsKIAkJ
c3RydWN0IGludGVsX2NvbnRleHQgKmNlID0gZW5naW5lLT5rZXJuZWxfY29udGV4dDsKLQkJaW50
IGVycjsKIAogCQlpZiAoZW5naW5lLT5jbGFzcyAhPSBSRU5ERVJfQ0xBU1MpCiAJCQljb250aW51
ZTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3lzZnMuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfc3lzZnMuYwppbmRleCBkOGEzYjE4MGMwODQuLmIyMGYwYjJi
NTM4YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zeXNmcy5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3lzZnMuYwpAQCAtMTQyLDkgKzE0Miw5IEBAIHN0
YXRpYyBjb25zdCBzdHJ1Y3QgYXR0cmlidXRlX2dyb3VwIG1lZGlhX3JjNl9hdHRyX2dyb3VwID0g
ewogfTsKICNlbmRpZgogCi1zdGF0aWMgaW50IGwzX2FjY2Vzc192YWxpZChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGxvZmZfdCBvZmZzZXQpCitzdGF0aWMgaW50IGwzX2FjY2Vz
c192YWxpZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgbG9mZl90IG9mZnNldCkKIHsK
LQlpZiAoIUhBU19MM19EUEYoZGV2X3ByaXYpKQorCWlmICghSEFTX0wzX0RQRihpOTE1KSkKIAkJ
cmV0dXJuIC1FUEVSTTsKIAogCWlmIChvZmZzZXQgJSA0ICE9IDApCkBAIC0xNjIsMzEgKzE2Miwz
MCBAQCBpOTE1X2wzX3JlYWQoc3RydWN0IGZpbGUgKmZpbHAsIHN0cnVjdCBrb2JqZWN0ICprb2Jq
LAogCSAgICAgbG9mZl90IG9mZnNldCwgc2l6ZV90IGNvdW50KQogewogCXN0cnVjdCBkZXZpY2Ug
KmtkZXYgPSBrb2JqX3RvX2Rldihrb2JqKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSBrZGV2X21pbm9yX3RvX2k5MTUoa2Rldik7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRl
diA9ICZkZXZfcHJpdi0+ZHJtOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0ga2Rl
dl9taW5vcl90b19pOTE1KGtkZXYpOwogCWludCBzbGljZSA9IChpbnQpKHVpbnRwdHJfdClhdHRy
LT5wcml2YXRlOwogCWludCByZXQ7CiAKIAljb3VudCA9IHJvdW5kX2Rvd24oY291bnQsIDQpOwog
Ci0JcmV0ID0gbDNfYWNjZXNzX3ZhbGlkKGRldl9wcml2LCBvZmZzZXQpOworCXJldCA9IGwzX2Fj
Y2Vzc192YWxpZChpOTE1LCBvZmZzZXQpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKIAlj
b3VudCA9IG1pbl90KHNpemVfdCwgR0VON19MM0xPR19TSVpFIC0gb2Zmc2V0LCBjb3VudCk7CiAK
LQlyZXQgPSBpOTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZShkZXYpOworCXJldCA9IG11dGV4
X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkxNS0+Z2VtLmNvbnRleHRzLm11dGV4KTsKIAlpZiAocmV0
KQogCQlyZXR1cm4gcmV0OwogCi0JaWYgKGRldl9wcml2LT5sM19wYXJpdHkucmVtYXBfaW5mb1tz
bGljZV0pCisJaWYgKGk5MTUtPmwzX3Bhcml0eS5yZW1hcF9pbmZvW3NsaWNlXSkKIAkJbWVtY3B5
KGJ1ZiwKLQkJICAgICAgIGRldl9wcml2LT5sM19wYXJpdHkucmVtYXBfaW5mb1tzbGljZV0gKyAo
b2Zmc2V0LzQpLAorCQkgICAgICAgaTkxNS0+bDNfcGFyaXR5LnJlbWFwX2luZm9bc2xpY2VdICsg
b2Zmc2V0IC8gNCwKIAkJICAgICAgIGNvdW50KTsKIAllbHNlCiAJCW1lbXNldChidWYsIDAsIGNv
dW50KTsKIAotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X3VubG9j
aygmaTkxNS0+Z2VtLmNvbnRleHRzLm11dGV4KTsKIAogCXJldHVybiBjb3VudDsKIH0KQEAgLTE5
NywyMiArMTk2LDIzIEBAIGk5MTVfbDNfd3JpdGUoc3RydWN0IGZpbGUgKmZpbHAsIHN0cnVjdCBr
b2JqZWN0ICprb2JqLAogCSAgICAgIGxvZmZfdCBvZmZzZXQsIHNpemVfdCBjb3VudCkKIHsKIAlz
dHJ1Y3QgZGV2aWNlICprZGV2ID0ga29ial90b19kZXYoa29iaik7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0ga2Rldl9taW5vcl90b19pOTE1KGtkZXYpOwotCXN0cnVjdCBk
cm1fZGV2aWNlICpkZXYgPSAmZGV2X3ByaXYtPmRybTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IGtkZXZfbWlub3JfdG9faTkxNShrZGV2KTsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqY3R4OwogCWludCBzbGljZSA9IChpbnQpKHVpbnRwdHJfdClhdHRyLT5wcml2YXRlOwog
CXUzMiAqKnJlbWFwX2luZm87CiAJaW50IHJldDsKIAotCXJldCA9IGwzX2FjY2Vzc192YWxpZChk
ZXZfcHJpdiwgb2Zmc2V0KTsKKwljb3VudCA9IHJvdW5kX2Rvd24oY291bnQsIDQpOworCisJcmV0
ID0gbDNfYWNjZXNzX3ZhbGlkKGk5MTUsIG9mZnNldCk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJl
dDsKIAotCXJldCA9IGk5MTVfbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKGRldik7CisJcmV0ID0g
bXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZpOTE1LT5nZW0uY29udGV4dHMubXV0ZXgpOwogCWlm
IChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlyZW1hcF9pbmZvID0gJmRldl9wcml2LT5sM19wYXJp
dHkucmVtYXBfaW5mb1tzbGljZV07CisJcmVtYXBfaW5mbyA9ICZpOTE1LT5sM19wYXJpdHkucmVt
YXBfaW5mb1tzbGljZV07CiAJaWYgKCEqcmVtYXBfaW5mbykgewogCQkqcmVtYXBfaW5mbyA9IGt6
YWxsb2MoR0VON19MM0xPR19TSVpFLCBHRlBfS0VSTkVMKTsKIAkJaWYgKCEqcmVtYXBfaW5mbykg
ewpAQCAtMjIxLDIwICsyMjEsMjAgQEAgaTkxNV9sM193cml0ZShzdHJ1Y3QgZmlsZSAqZmlscCwg
c3RydWN0IGtvYmplY3QgKmtvYmosCiAJCX0KIAl9CiAKLQkvKiBUT0RPOiBJZGVhbGx5IHdlIHJl
YWxseSB3YW50IGEgR1BVIHJlc2V0IGhlcmUgdG8gbWFrZSBzdXJlIGVycm9ycworCS8qCisJICog
VE9ETzogSWRlYWxseSB3ZSByZWFsbHkgd2FudCBhIEdQVSByZXNldCBoZXJlIHRvIG1ha2Ugc3Vy
ZSBlcnJvcnMKIAkgKiBhcmVuJ3QgcHJvcGFnYXRlZC4gU2luY2UgSSBjYW5ub3QgZmluZCBhIHN0
YWJsZSB3YXkgdG8gcmVzZXQgdGhlIEdQVQogCSAqIGF0IHRoaXMgcG9pbnQgaXQgaXMgbGVmdCBh
cyBhIFRPRE8uCiAJKi8KIAltZW1jcHkoKnJlbWFwX2luZm8gKyAob2Zmc2V0LzQpLCBidWYsIGNv
dW50KTsKIAogCS8qIE5COiBXZSBkZWZlciB0aGUgcmVtYXBwaW5nIHVudGlsIHdlIHN3aXRjaCB0
byB0aGUgY29udGV4dCAqLwotCWxpc3RfZm9yX2VhY2hfZW50cnkoY3R4LCAmZGV2X3ByaXYtPmNv
bnRleHRzLmxpc3QsIGxpbmspCi0JCWN0eC0+cmVtYXBfc2xpY2UgfD0gKDE8PHNsaWNlKTsKKwls
aXN0X2Zvcl9lYWNoX2VudHJ5KGN0eCwgJmk5MTUtPmdlbS5jb250ZXh0cy5saXN0LCBsaW5rKQor
CQljdHgtPnJlbWFwX3NsaWNlIHw9IEJJVChzbGljZSk7CiAKIAlyZXQgPSBjb3VudDsKLQogb3V0
OgotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X3VubG9jaygmaTkx
NS0+Z2VtLmNvbnRleHRzLm11dGV4KTsKIAogCXJldHVybiByZXQ7CiB9CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3RyYWNlLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3RyYWNlLmgKaW5kZXggMWYyY2Y2Y2ZhZmI1Li43ZWY3YTFlMTY2NGMgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdHJhY2UuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3RyYWNlLmgKQEAgLTk1Miw3ICs5NTIsNyBAQCBERUNMQVJFX0VWRU5UX0NMQVNT
KGk5MTVfY29udGV4dCwKIAlUUF9mYXN0X2Fzc2lnbigKIAkJCV9fZW50cnktPmRldiA9IGN0eC0+
aTkxNS0+ZHJtLnByaW1hcnktPmluZGV4OwogCQkJX19lbnRyeS0+Y3R4ID0gY3R4OwotCQkJX19l
bnRyeS0+dm0gPSBjdHgtPnZtOworCQkJX19lbnRyeS0+dm0gPSByY3VfYWNjZXNzX3BvaW50ZXIo
Y3R4LT52bSk7CiAJKSwKIAogCVRQX3ByaW50aygiZGV2PSV1LCBjdHg9JXAsIGN0eF92bT0lcCIs
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW0uYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbS5jCmluZGV4IGJiNmRkNTRh
NmZmMy4uZmI3NWM4ODdmZGQ4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV9nZW0uYwpAQCAtMTM0LDExICsxMzQsOSBAQCBzdGF0aWMgaW50IGlndF9nZW1fc3VzcGVuZCh2
b2lkICphcmcpCiAJCXJldHVybiBQVFJfRVJSKGZpbGUpOwogCiAJZXJyID0gLUVOT01FTTsKLQlt
dXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAljdHggPSBsaXZlX2NvbnRleHQo
aTkxNSwgZmlsZSk7CiAJaWYgKCFJU19FUlIoY3R4KSkKIAkJZXJyID0gc3dpdGNoX3RvX2NvbnRl
eHQoaTkxNSwgY3R4KTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
CWlmIChlcnIpCiAJCWdvdG8gb3V0OwogCkBAIC0xNTMsOSArMTUxLDcgQEAgc3RhdGljIGludCBp
Z3RfZ2VtX3N1c3BlbmQodm9pZCAqYXJnKQogCiAJcG1fcmVzdW1lKGk5MTUpOwogCi0JbXV0ZXhf
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJZXJyID0gc3dpdGNoX3RvX2NvbnRleHQo
aTkxNSwgY3R4KTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogb3V0
OgogCW1vY2tfZmlsZV9mcmVlKGk5MTUsIGZpbGUpOwogCXJldHVybiBlcnI7CkBAIC0xNzMsMTEg
KzE2OSw5IEBAIHN0YXRpYyBpbnQgaWd0X2dlbV9oaWJlcm5hdGUodm9pZCAqYXJnKQogCQlyZXR1
cm4gUFRSX0VSUihmaWxlKTsKIAogCWVyciA9IC1FTk9NRU07Ci0JbXV0ZXhfbG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAJY3R4ID0gbGl2ZV9jb250ZXh0KGk5MTUsIGZpbGUpOwogCWlm
ICghSVNfRVJSKGN0eCkpCiAJCWVyciA9IHN3aXRjaF90b19jb250ZXh0KGk5MTUsIGN0eCk7Ci0J
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpZiAoZXJyKQogCQlnb3Rv
IG91dDsKIApAQCAtMTkyLDkgKzE4Niw3IEBAIHN0YXRpYyBpbnQgaWd0X2dlbV9oaWJlcm5hdGUo
dm9pZCAqYXJnKQogCiAJcG1fcmVzdW1lKGk5MTUpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CiAJZXJyID0gc3dpdGNoX3RvX2NvbnRleHQoaTkxNSwgY3R4KTsKLQlt
dXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogb3V0OgogCW1vY2tfZmlsZV9m
cmVlKGk5MTUsIGZpbGUpOwogCXJldHVybiBlcnI7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5jCmluZGV4IGFiOGE5YTQ2ZjRlYS4uN2UxNmExNTE5
MzMyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1f
ZXZpY3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZp
Y3QuYwpAQCAtNDcxLDcgKzQ3MSw2IEBAIHN0YXRpYyBpbnQgaWd0X2V2aWN0X2NvbnRleHRzKHZv
aWQgKmFyZykKIAkJfQogCiAJCWNvdW50ID0gMDsKLQkJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CiAJCW9uc3RhY2tfZmVuY2VfaW5pdCgmZmVuY2UpOwogCQlkbyB7CiAJCQlz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKQEAgLTUwOCw4ICs1MDcsNiBAQCBzdGF0aWMgaW50IGln
dF9ldmljdF9jb250ZXh0cyh2b2lkICphcmcpCiAJCQljb3VudCsrOwogCQkJZXJyID0gMDsKIAkJ
fSB3aGlsZSgxKTsKLQkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQog
CQlvbnN0YWNrX2ZlbmNlX2ZpbmkoJmZlbmNlKTsKIAkJcHJfaW5mbygiU3VibWl0dGVkICVsdSBj
b250ZXh0cy9yZXF1ZXN0cyBvbiAlc1xuIiwKIAkJCWNvdW50LCBlbmdpbmUtPm5hbWUpOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2d0dC5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2d0dC5jCmluZGV4IGVkNmUy
NzIyNTJmMy4uN2UxYmUzYWNjOTdkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2k5MTVfZ2VtX2d0dC5jCkBAIC0xMjUyLDYgKzEyNTIsNyBAQCBzdGF0aWMgaW50IGV4ZXJj
aXNlX21vY2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgICB1bnNpZ25l
ZCBsb25nIGVuZF90aW1lKSkKIHsKIAljb25zdCB1NjQgbGltaXQgPSB0b3RhbHJhbV9wYWdlcygp
IDw8IFBBR0VfU0hJRlQ7CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CiAJc3RydWN0
IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKIAlJR1RfVElNRU9VVChlbmRfdGltZSk7CiAJaW50IGVy
cjsKQEAgLTEyNjAsNyArMTI2MSw4IEBAIHN0YXRpYyBpbnQgZXhlcmNpc2VfbW9jayhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlpZiAoIWN0eCkKIAkJcmV0dXJuIC1FTk9NRU07CiAK
LQllcnIgPSBmdW5jKGk5MTUsIGN0eC0+dm0sIDAsIG1pbihjdHgtPnZtLT50b3RhbCwgbGltaXQp
LCBlbmRfdGltZSk7CisJdm0gPSByY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKGN0eC0+dm0sIHRy
dWUpOworCWVyciA9IGZ1bmMoaTkxNSwgdm0sIDAsIG1pbih2bS0+dG90YWwsIGxpbWl0KSwgZW5k
X3RpbWUpOwogCiAJbW9ja19jb250ZXh0X2Nsb3NlKGN0eCk7CiAJcmV0dXJuIGVycjsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYwppbmRleCBkMDQ2Mzk1
ODQ1ZGEuLjU1N2UxY2I0MTg4ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2Vs
ZnRlc3RzL2k5MTVfcmVxdWVzdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pOTE1X3JlcXVlc3QuYwpAQCAtMTgxLDkgKzE4MSw3IEBAIHN0YXRpYyBpbnQgaWd0X3JlcXVl
c3RfcmV3aW5kKHZvaWQgKmFyZykKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAJaW50IGVy
ciA9IC1FSU5WQUw7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlj
dHhbMF0gPSBtb2NrX2NvbnRleHQoaTkxNSwgIkEiKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwogCiAJY2UgPSBpOTE1X2dlbV9jb250ZXh0X2dldF9lbmdpbmUoY3R4
WzBdLCBSQ1MwKTsKIAlHRU1fQlVHX09OKElTX0VSUihjZSkpOwpAQCAtMTk3LDkgKzE5NSw3IEBA
IHN0YXRpYyBpbnQgaWd0X3JlcXVlc3RfcmV3aW5kKHZvaWQgKmFyZykKIAlpOTE1X3JlcXVlc3Rf
Z2V0KHJlcXVlc3QpOwogCWk5MTVfcmVxdWVzdF9hZGQocmVxdWVzdCk7CiAKLQltdXRleF9sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAljdHhbMV0gPSBtb2NrX2NvbnRleHQoaTkxNSwg
IkIiKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJY2UgPSBp
OTE1X2dlbV9jb250ZXh0X2dldF9lbmdpbmUoY3R4WzFdLCBSQ1MwKTsKIAlHRU1fQlVHX09OKElT
X0VSUihjZSkpOwpAQCAtNDM4LDkgKzQzNCw3IEBAIHN0YXRpYyBpbnQgbW9ja19icmVhZGNydW1i
c19zbW9rZXRlc3Qodm9pZCAqYXJnKQogCX0KIAogCWZvciAobiA9IDA7IG4gPCB0Lm5jb250ZXh0
czsgbisrKSB7Ci0JCW11dGV4X2xvY2soJnQuZW5naW5lLT5pOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKIAkJdC5jb250ZXh0c1tuXSA9IG1vY2tfY29udGV4dCh0LmVuZ2luZS0+aTkxNSwgIm1vY2si
KTsKLQkJbXV0ZXhfdW5sb2NrKCZ0LmVuZ2luZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJ
CWlmICghdC5jb250ZXh0c1tuXSkgewogCQkJcmV0ID0gLUVOT01FTTsKIAkJCWdvdG8gb3V0X2Nv
bnRleHRzOwpAQCAtNzIwLDcgKzcxNCw4IEBAIHN0YXRpYyBpbnQgbGl2ZV9lbXB0eV9yZXF1ZXN0
KHZvaWQgKmFyZykKIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKnJlY3Vyc2l2ZV9iYXRjaChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAq
Y3R4ID0gaTkxNS0+a2VybmVsX2NvbnRleHQ7Ci0Jc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAq
dm0gPSBjdHgtPnZtID86ICZpOTE1LT5nZ3R0LnZtOworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3Bh
Y2UgKnZtID0KKwkJcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChjdHgtPnZtLCB0cnVlKSA/OiAm
aTkxNS0+Z2d0dC52bTsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwogCWNvbnN0
IGludCBnZW4gPSBJTlRFTF9HRU4oaTkxNSk7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CkBAIC0x
MDk1LDkgKzEwOTAsNyBAQCBzdGF0aWMgaW50IGxpdmVfYnJlYWRjcnVtYnNfc21va2V0ZXN0KHZv
aWQgKmFyZykKIAl9CiAKIAlmb3IgKG4gPSAwOyBuIDwgdFswXS5uY29udGV4dHM7IG4rKykgewot
CQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJdFswXS5jb250ZXh0c1tu
XSA9IGxpdmVfY29udGV4dChpOTE1LCBmaWxlKTsKLQkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIAkJaWYgKCF0WzBdLmNvbnRleHRzW25dKSB7CiAJCQlyZXQgPSAtRU5P
TUVNOwogCQkJZ290byBvdXRfY29udGV4dHM7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pOTE1X3ZtYS5jCmluZGV4IDEyNWZlZmVhNTE5YS4uM2RjMmY3MWJhZGY4IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYwpAQCAtMzgsNyArMzgsNyBAQCBzdGF0
aWMgYm9vbCBhc3NlcnRfdm1hKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogewogCWJvb2wgb2sgPSB0
cnVlOwogCi0JaWYgKHZtYS0+dm0gIT0gY3R4LT52bSkgeworCWlmICh2bWEtPnZtICE9IHJjdV9h
Y2Nlc3NfcG9pbnRlcihjdHgtPnZtKSkgewogCQlwcl9lcnIoIlZNQSBjcmVhdGVkIHdpdGggd3Jv
bmcgVk1cbiIpOwogCQlvayA9IGZhbHNlOwogCX0KQEAgLTExMyw3ICsxMTMsOCBAQCBzdGF0aWMg
aW50IGNyZWF0ZV92bWFzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCWxpc3RfZm9y
X2VhY2hfZW50cnkob2JqLCBvYmplY3RzLCBzdF9saW5rKSB7CiAJCWZvciAocGlubmVkID0gMDsg
cGlubmVkIDw9IDE7IHBpbm5lZCsrKSB7CiAJCQlsaXN0X2Zvcl9lYWNoX2VudHJ5KGN0eCwgY29u
dGV4dHMsIGxpbmspIHsKLQkJCQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IGN0eC0+
dm07CisJCQkJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPQorCQkJCQlyY3VfZGVyZWZl
cmVuY2VfcHJvdGVjdGVkKGN0eC0+dm0sIHRydWUpOwogCQkJCXN0cnVjdCBpOTE1X3ZtYSAqdm1h
OwogCQkJCWludCBlcnI7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9t
b2NrX2dlbV9kZXZpY2UuYwppbmRleCBhZjAzNTZlNjZhNDcuLjk3MjJkYmNhZjg2OCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYwpAQCAt
NTgsMTEgKzU4LDkgQEAgc3RhdGljIHZvaWQgbW9ja19kZXZpY2VfcmVsZWFzZShzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2KQogCiAJaTkxNV9nZW1fZHJhaW5fd29ya3F1ZXVlKGk5MTUpOwogCi0JbXV0
ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJZm9yX2VhY2hfZW5naW5lKGVuZ2lu
ZSwgaTkxNSwgaWQpCiAJCW1vY2tfZW5naW5lX2ZyZWUoZW5naW5lKTsKLQlpOTE1X2dlbV9jb250
ZXh0c19maW5pKGk5MTUpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CisJaTkxNV9nZW1fZHJpdmVyX3JlbGVhc2VfX2NvbnRleHRzKGk5MTUpOwogCiAJaW50ZWxfdGlt
ZWxpbmVzX2ZpbmkoaTkxNSk7CiAKQEAgLTIwNiw3ICsyMDQsNyBAQCBzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqbW9ja19nZW1fZGV2aWNlKHZvaWQpCiAJcmV0dXJuIGk5MTU7CiAKIGVycl9jb250
ZXh0OgotCWk5MTVfZ2VtX2NvbnRleHRzX2ZpbmkoaTkxNSk7CisJaTkxNV9nZW1fZHJpdmVyX3Jl
bGVhc2VfX2NvbnRleHRzKGk5MTUpOwogZXJyX2VuZ2luZToKIAltb2NrX2VuZ2luZV9mcmVlKGk5
MTUtPmVuZ2luZVtSQ1MwXSk7CiBlcnJfdW5sb2NrOgotLSAKMi4yMy4wCgpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0
CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

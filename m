Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 34628684E7
	for <lists+intel-gfx@lfdr.de>; Mon, 15 Jul 2019 10:10:31 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4DBA289856;
	Mon, 15 Jul 2019 08:10:28 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AF6CF8981D
 for <intel-gfx@lists.freedesktop.org>; Mon, 15 Jul 2019 08:10:18 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17303238-1500050 
 for multiple; Mon, 15 Jul 2019 09:09:51 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 15 Jul 2019 09:09:24 +0100
Message-Id: <20190715080946.15593-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190715080946.15593-1-chris@chris-wilson.co.uk>
References: <20190715080946.15593-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 02/24] drm/i915/gt: Move the [class][inst]
 lookup for engines onto the GT
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VG8gbWFpbnRhaW4gYSBmYXN0IGxvb2t1cCBmcm9tIGEgR1QgY2VudHJpYyBpcnEgaGFuZGxlciwg
d2Ugd2FudCB0aGUKZW5naW5lIGxvb2t1cCB0YWJsZXMgb24gdGhlIGludGVsX2d0LiBUbyBhdm9p
ZCBoYXZpbmcgbXVsdGlwbGUgY29waWVzIG9mCnRoZSBzYW1lIG11bHRpLWRpbWVuc2lvbiBsb29r
dXAgdGFibGUsIG1vdmUgdGhlIGdlbmVyaWMgdXNlciBlbmdpbmUKbG9va3VwIGludG8gYW4gcmJ0
cmVlIChmb3IgZmFzdCBhbmQgZmxleGlibGUgaW5kZXhpbmcpLgoKU2lnbmVkLW9mZi1ieTogQ2hy
aXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBUdnJ0a28gVXJzdWxpbiA8
dHZydGtvLnVyc3VsaW5AaW50ZWwuY29tPgpDYzogRGFuaWVsZSBDZXJhb2xvIFNwdXJpbyA8ZGFu
aWVsZS5jZXJhb2xvc3B1cmlvQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9N
YWtlZmlsZSAgICAgICAgICAgICAgICB8ICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9jb250ZXh0LmMgIHwgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
ZW5naW5lLmggICAgICAgfCAgMyAtCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdp
bmVfY3MuYyAgICB8IDUyICsrKysrLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2VuZ2luZV90eXBlcy5oIHwgIDMgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfZW5naW5lX3VzZXIuYyAgfCA2NSArKysrKysrKysrKysrKysrKysrKwogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3VzZXIuaCAgfCAyMCArKysrKysKIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmggICAgIHwgIDQgKysKIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jICAgICAgIHwgMTUgKysrLS0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZHJ2LmggICAgICAgICAgICAgIHwgIDcgKystCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2lycS5jICAgICAgICAgICAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3BtdS5jICAgICAgICAgICAgICB8ICAxICsKIDEyIGZpbGVzIGNoYW5nZWQsIDEyNCBp
bnNlcnRpb25zKCspLCA1MCBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdXNlci5jCiBjcmVhdGUgbW9kZSAxMDA2NDQg
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3VzZXIuaAoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFr
ZWZpbGUKaW5kZXggNTI0NTE2MjUxYTQwLi5mYWZjMzc2M2RjMmQgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2Vm
aWxlCkBAIC03NCw2ICs3NCw3IEBAIGd0LXkgKz0gXAogCWd0L2ludGVsX2NvbnRleHQubyBcCiAJ
Z3QvaW50ZWxfZW5naW5lX2NzLm8gXAogCWd0L2ludGVsX2VuZ2luZV9wbS5vIFwKKwlndC9pbnRl
bF9lbmdpbmVfdXNlci5vIFwKIAlndC9pbnRlbF9ndC5vIFwKIAlndC9pbnRlbF9ndF9wbS5vIFwK
IAlndC9pbnRlbF9oYW5nY2hlY2subyBcCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX2NvbnRleHQuYwppbmRleCBjNWY4YmZhM2Y3YjAuLjZiNTY0NGQ1YTk5YiAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCkBAIC03MCw2ICs3MCw3IEBA
CiAjaW5jbHVkZSA8ZHJtL2k5MTVfZHJtLmg+CiAKICNpbmNsdWRlICJndC9pbnRlbF9scmNfcmVn
LmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfZW5naW5lX3VzZXIuaCIKIAogI2luY2x1ZGUgImk5MTVf
Z2VtX2NvbnRleHQuaCIKICNpbmNsdWRlICJpOTE1X2dsb2JhbHMuaCIKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZW5naW5lLmgKaW5kZXggZGI1YzczY2U4NmVlLi4zMDg1NjM4M2U0YzUgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZS5oCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZS5oCkBAIC00MzIsOSArNDMyLDYgQEAg
dm9pZCBpbnRlbF9lbmdpbmVfZHVtcChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJ
CSAgICAgICBzdHJ1Y3QgZHJtX3ByaW50ZXIgKm0sCiAJCSAgICAgICBjb25zdCBjaGFyICpoZWFk
ZXIsIC4uLik7CiAKLXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKgotaW50ZWxfZW5naW5lX2xvb2t1
cF91c2VyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1OCBjbGFzcywgdTggaW5zdGFu
Y2UpOwotCiBzdGF0aWMgaW5saW5lIHZvaWQgaW50ZWxfZW5naW5lX2NvbnRleHRfaW4oc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewogCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jCmluZGV4IDAyMmUwMGViNzlhZC4u
NzUwOTk1MDBkMWVkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9l
bmdpbmVfY3MuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3Mu
YwpAQCAtMzIsNiArMzIsNyBAQAogCiAjaW5jbHVkZSAiaW50ZWxfZW5naW5lLmgiCiAjaW5jbHVk
ZSAiaW50ZWxfZW5naW5lX3BtLmgiCisjaW5jbHVkZSAiaW50ZWxfZW5naW5lX3VzZXIuaCIKICNp
bmNsdWRlICJpbnRlbF9jb250ZXh0LmgiCiAjaW5jbHVkZSAiaW50ZWxfbHJjLmgiCiAjaW5jbHVk
ZSAiaW50ZWxfcmVzZXQuaCIKQEAgLTI4NSw5ICsyODYsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9l
bmdpbmVfc2FuaXRpemVfbW1pbyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJaW50
ZWxfZW5naW5lX3NldF9od3NwX3dyaXRlbWFzayhlbmdpbmUsIH4wdSk7CiB9CiAKLXN0YXRpYyBp
bnQKLWludGVsX2VuZ2luZV9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
Ci0JCSAgIGVudW0gaW50ZWxfZW5naW5lX2lkIGlkKQorc3RhdGljIGludCBpbnRlbF9lbmdpbmVf
c2V0dXAoc3RydWN0IGludGVsX2d0ICpndCwgZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQpCiB7CiAJ
Y29uc3Qgc3RydWN0IGVuZ2luZV9pbmZvICppbmZvID0gJmludGVsX2VuZ2luZXNbaWRdOwogCXN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKQEAgLTMwMywxMCArMzAyLDkgQEAgaW50ZWxf
ZW5naW5lX3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlpZiAoR0VN
X0RFQlVHX1dBUk5fT04oaW5mby0+aW5zdGFuY2UgPiBNQVhfRU5HSU5FX0lOU1RBTkNFKSkKIAkJ
cmV0dXJuIC1FSU5WQUw7CiAKLQlpZiAoR0VNX0RFQlVHX1dBUk5fT04oZGV2X3ByaXYtPmVuZ2lu
ZV9jbGFzc1tpbmZvLT5jbGFzc11baW5mby0+aW5zdGFuY2VdKSkKKwlpZiAoR0VNX0RFQlVHX1dB
Uk5fT04oZ3QtPmVuZ2luZV9jbGFzc1tpbmZvLT5jbGFzc11baW5mby0+aW5zdGFuY2VdKSkKIAkJ
cmV0dXJuIC1FSU5WQUw7CiAKLQlHRU1fQlVHX09OKGRldl9wcml2LT5lbmdpbmVbaWRdKTsKIAll
bmdpbmUgPSBremFsbG9jKHNpemVvZigqZW5naW5lKSwgR0ZQX0tFUk5FTCk7CiAJaWYgKCFlbmdp
bmUpCiAJCXJldHVybiAtRU5PTUVNOwpAQCAtMzE1LDEyICszMTMsMTIgQEAgaW50ZWxfZW5naW5l
X3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAogCWVuZ2luZS0+aWQg
PSBpZDsKIAllbmdpbmUtPm1hc2sgPSBCSVQoaWQpOwotCWVuZ2luZS0+aTkxNSA9IGRldl9wcml2
OwotCWVuZ2luZS0+Z3QgPSAmZGV2X3ByaXYtPmd0OwotCWVuZ2luZS0+dW5jb3JlID0gJmRldl9w
cml2LT51bmNvcmU7CisJZW5naW5lLT5pOTE1ID0gZ3QtPmk5MTU7CisJZW5naW5lLT5ndCA9IGd0
OworCWVuZ2luZS0+dW5jb3JlID0gZ3QtPnVuY29yZTsKIAlfX3NwcmludF9lbmdpbmVfbmFtZShl
bmdpbmUtPm5hbWUsIGluZm8pOwogCWVuZ2luZS0+aHdfaWQgPSBlbmdpbmUtPmd1Y19pZCA9IGlu
Zm8tPmh3X2lkOwotCWVuZ2luZS0+bW1pb19iYXNlID0gX19lbmdpbmVfbW1pb19iYXNlKGRldl9w
cml2LCBpbmZvLT5tbWlvX2Jhc2VzKTsKKwllbmdpbmUtPm1taW9fYmFzZSA9IF9fZW5naW5lX21t
aW9fYmFzZShndC0+aTkxNSwgaW5mby0+bW1pb19iYXNlcyk7CiAJZW5naW5lLT5jbGFzcyA9IGlu
Zm8tPmNsYXNzOwogCWVuZ2luZS0+aW5zdGFuY2UgPSBpbmZvLT5pbnN0YW5jZTsKIApAQCAtMzMy
LDEyICszMzAsMTIgQEAgaW50ZWxfZW5naW5lX3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIAogCWVuZ2luZS0+dWFiaV9jbGFzcyA9IGludGVsX2VuZ2luZV9jbGFzc2Vz
W2luZm8tPmNsYXNzXS51YWJpX2NsYXNzOwogCi0JZW5naW5lLT5jb250ZXh0X3NpemUgPSBpbnRl
bF9lbmdpbmVfY29udGV4dF9zaXplKGRldl9wcml2LAorCWVuZ2luZS0+Y29udGV4dF9zaXplID0g
aW50ZWxfZW5naW5lX2NvbnRleHRfc2l6ZShndC0+aTkxNSwKIAkJCQkJCQkgZW5naW5lLT5jbGFz
cyk7CiAJaWYgKFdBUk5fT04oZW5naW5lLT5jb250ZXh0X3NpemUgPiBCSVQoMjApKSkKIAkJZW5n
aW5lLT5jb250ZXh0X3NpemUgPSAwOwogCWlmIChlbmdpbmUtPmNvbnRleHRfc2l6ZSkKLQkJRFJJ
VkVSX0NBUFMoZGV2X3ByaXYpLT5oYXNfbG9naWNhbF9jb250ZXh0cyA9IHRydWU7CisJCURSSVZF
Ul9DQVBTKGd0LT5pOTE1KS0+aGFzX2xvZ2ljYWxfY29udGV4dHMgPSB0cnVlOwogCiAJLyogTm90
aGluZyB0byBkbyBoZXJlLCBleGVjdXRlIGluIG9yZGVyIG9mIGRlcGVuZGVuY2llcyAqLwogCWVu
Z2luZS0+c2NoZWR1bGUgPSBOVUxMOwpAQCAtMzQ5LDggKzM0NywxMSBAQCBpbnRlbF9lbmdpbmVf
c2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCS8qIFNjcnViIG1taW8g
c3RhdGUgb24gdGFrZW92ZXIgKi8KIAlpbnRlbF9lbmdpbmVfc2FuaXRpemVfbW1pbyhlbmdpbmUp
OwogCi0JZGV2X3ByaXYtPmVuZ2luZV9jbGFzc1tpbmZvLT5jbGFzc11baW5mby0+aW5zdGFuY2Vd
ID0gZW5naW5lOwotCWRldl9wcml2LT5lbmdpbmVbaWRdID0gZW5naW5lOworCWVuZ2luZS0+Z3Qt
PmVuZ2luZV9jbGFzc1tpbmZvLT5jbGFzc11baW5mby0+aW5zdGFuY2VdID0gZW5naW5lOworCisJ
aW50ZWxfZW5naW5lX2FkZF91c2VyKGVuZ2luZSk7CisJZ3QtPmk5MTUtPmVuZ2luZVtpZF0gPSBl
bmdpbmU7CisKIAlyZXR1cm4gMDsKIH0KIApAQCAtNDMzLDcgKzQzNCw3IEBAIGludCBpbnRlbF9l
bmdpbmVzX2luaXRfbW1pbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkJaWYgKCFI
QVNfRU5HSU5FKGk5MTUsIGkpKQogCQkJY29udGludWU7CiAKLQkJZXJyID0gaW50ZWxfZW5naW5l
X3NldHVwKGk5MTUsIGkpOworCQllcnIgPSBpbnRlbF9lbmdpbmVfc2V0dXAoJmk5MTUtPmd0LCBp
KTsKIAkJaWYgKGVycikKIAkJCWdvdG8gY2xlYW51cDsKIApAQCAtMTUzNCwyOSArMTUzNSw2IEBA
IHZvaWQgaW50ZWxfZW5naW5lX2R1bXAoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAog
CWludGVsX2VuZ2luZV9wcmludF9icmVhZGNydW1icyhlbmdpbmUsIG0pOwogfQogCi1zdGF0aWMg
dTggdXNlcl9jbGFzc19tYXBbXSA9IHsKLQlbSTkxNV9FTkdJTkVfQ0xBU1NfUkVOREVSXSA9IFJF
TkRFUl9DTEFTUywKLQlbSTkxNV9FTkdJTkVfQ0xBU1NfQ09QWV0gPSBDT1BZX0VOR0lORV9DTEFT
UywKLQlbSTkxNV9FTkdJTkVfQ0xBU1NfVklERU9dID0gVklERU9fREVDT0RFX0NMQVNTLAotCVtJ
OTE1X0VOR0lORV9DTEFTU19WSURFT19FTkhBTkNFXSA9IFZJREVPX0VOSEFOQ0VNRU5UX0NMQVNT
LAotfTsKLQotc3RydWN0IGludGVsX2VuZ2luZV9jcyAqCi1pbnRlbF9lbmdpbmVfbG9va3VwX3Vz
ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHU4IGNsYXNzLCB1OCBpbnN0YW5jZSkK
LXsKLQlpZiAoY2xhc3MgPj0gQVJSQVlfU0laRSh1c2VyX2NsYXNzX21hcCkpCi0JCXJldHVybiBO
VUxMOwotCi0JY2xhc3MgPSB1c2VyX2NsYXNzX21hcFtjbGFzc107Ci0KLQlHRU1fQlVHX09OKGNs
YXNzID4gTUFYX0VOR0lORV9DTEFTUyk7Ci0KLQlpZiAoaW5zdGFuY2UgPiBNQVhfRU5HSU5FX0lO
U1RBTkNFKQotCQlyZXR1cm4gTlVMTDsKLQotCXJldHVybiBpOTE1LT5lbmdpbmVfY2xhc3NbY2xh
c3NdW2luc3RhbmNlXTsKLX0KLQogLyoqCiAgKiBpbnRlbF9lbmFibGVfZW5naW5lX3N0YXRzKCkg
LSBFbmFibGUgZW5naW5lIGJ1c3kgdHJhY2tpbmcgb24gZW5naW5lCiAgKiBAZW5naW5lOiBlbmdp
bmUgdG8gZW5hYmxlIHN0YXRzIGNvbGxlY3Rpb24KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfZW5naW5lX3R5cGVzLmgKaW5kZXggOGJlNjMwMTlkNzA3Li42ODIyZmJiNDRkMmQgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5oCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5oCkBAIC0xMiw2
ICsxMiw3IEBACiAjaW5jbHVkZSA8bGludXgva3JlZi5oPgogI2luY2x1ZGUgPGxpbnV4L2xpc3Qu
aD4KICNpbmNsdWRlIDxsaW51eC9sbGlzdC5oPgorI2luY2x1ZGUgPGxpbnV4L3JidHJlZS5oPgog
I2luY2x1ZGUgPGxpbnV4L3RpbWVyLmg+CiAjaW5jbHVkZSA8bGludXgvdHlwZXMuaD4KIApAQCAt
Mjc2LDYgKzI3Nyw4IEBAIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgewogCiAJdTMyIHVhYmlfY2Fw
YWJpbGl0aWVzOwogCisJc3RydWN0IHJiX25vZGUgdWFiaV9ub2RlOworCiAJc3RydWN0IGludGVs
X3NzZXUgc3NldTsKIAogCXN0cnVjdCBpbnRlbF9yaW5nICpidWZmZXI7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdXNlci5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3VzZXIuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRl
eCAwMDAwMDAwMDAwMDAuLjFiNjc5NjkzOGM2ZgotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV91c2VyLmMKQEAgLTAsMCArMSw2NSBAQAorLyoK
KyAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKKyAqCisgKiBDb3B5cmlnaHQgwqkgMjAx
OSBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpbmNsdWRlICJpOTE1X2Rydi5oIgorI2luY2x1
ZGUgImludGVsX2VuZ2luZS5oIgorI2luY2x1ZGUgImludGVsX2VuZ2luZV91c2VyLmgiCisKK3N0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKgoraW50ZWxfZW5naW5lX2xvb2t1cF91c2VyKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LCB1OCBjbGFzcywgdTggaW5zdGFuY2UpCit7CisJc3RydWN0
IHJiX25vZGUgKnAgPSBpOTE1LT51YWJpX2VuZ2luZXMucmJfbm9kZTsKKworCXdoaWxlIChwKSB7
CisJCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKml0ID0KKwkJCXJiX2VudHJ5KHAsIHR5cGVvZigq
aXQpLCB1YWJpX25vZGUpOworCisJCWlmIChjbGFzcyA8IGl0LT51YWJpX2NsYXNzKQorCQkJcCA9
IHAtPnJiX2xlZnQ7CisJCWVsc2UgaWYgKGNsYXNzID4gaXQtPnVhYmlfY2xhc3MgfHwgaW5zdGFu
Y2UgPiBpdC0+aW5zdGFuY2UpCisJCQlwID0gcC0+cmJfcmlnaHQ7CisJCWVsc2UgaWYgKGluc3Rh
bmNlIDwgaXQtPmluc3RhbmNlKQorCQkJcCA9IHAtPnJiX2xlZnQ7CisJCWVsc2UKKwkJCXJldHVy
biBpdDsKKwl9CisKKwlyZXR1cm4gTlVMTDsKK30KKwordm9pZCBpbnRlbF9lbmdpbmVfYWRkX3Vz
ZXIoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQoreworCXN0cnVjdCByYl9yb290ICpy
b290ID0gJmVuZ2luZS0+aTkxNS0+dWFiaV9lbmdpbmVzOworCXN0cnVjdCByYl9ub2RlICoqcCwg
KnBhcmVudDsKKworCXBhcmVudCA9IE5VTEw7CisJcCA9ICZyb290LT5yYl9ub2RlOworCXdoaWxl
ICgqcCkgeworCQlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICppdDsKKworCQlwYXJlbnQgPSAqcDsK
KwkJaXQgPSByYl9lbnRyeShwYXJlbnQsIHR5cGVvZigqaXQpLCB1YWJpX25vZGUpOworCisJCS8q
IEFsbCB1c2VyIGNsYXNzOmluc3RhbmNlIGlkZW50aWZpZXJzIG11c3QgYmUgdW5pcXVlICovCisJ
CUdFTV9CVUdfT04oaXQtPnVhYmlfY2xhc3MgPT0gZW5naW5lLT51YWJpX2NsYXNzICYmCisJCQkg
ICBpdC0+aW5zdGFuY2UgPT0gZW5naW5lLT5pbnN0YW5jZSk7CisKKwkJaWYgKGVuZ2luZS0+dWFi
aV9jbGFzcyA8IGl0LT51YWJpX2NsYXNzKQorCQkJcCA9ICZwYXJlbnQtPnJiX2xlZnQ7CisJCWVs
c2UgaWYgKGVuZ2luZS0+dWFiaV9jbGFzcyA+IGl0LT51YWJpX2NsYXNzIHx8CisJCQkgZW5naW5l
LT5pbnN0YW5jZSA+IGl0LT5pbnN0YW5jZSkKKwkJCXAgPSAmcGFyZW50LT5yYl9yaWdodDsKKwkJ
ZWxzZQorCQkJcCA9ICZwYXJlbnQtPnJiX2xlZnQ7CisJfQorCisJcmJfbGlua19ub2RlKCZlbmdp
bmUtPnVhYmlfbm9kZSwgcGFyZW50LCBwKTsKKwlyYl9pbnNlcnRfY29sb3IoJmVuZ2luZS0+dWFi
aV9ub2RlLCByb290KTsKKworCUdFTV9CVUdfT04oaW50ZWxfZW5naW5lX2xvb2t1cF91c2VyKGVu
Z2luZS0+aTkxNSwKKwkJCQkJICAgIGVuZ2luZS0+dWFiaV9jbGFzcywKKwkJCQkJICAgIGVuZ2lu
ZS0+aW5zdGFuY2UpICE9IGVuZ2luZSk7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9lbmdpbmVfdXNlci5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfZW5naW5lX3VzZXIuaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAu
LjA5MWRjOGE0YTM5ZgotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2VuZ2luZV91c2VyLmgKQEAgLTAsMCArMSwyMCBAQAorLyoKKyAqIFNQRFgtTGljZW5z
ZS1JZGVudGlmaWVyOiBNSVQKKyAqCisgKiBDb3B5cmlnaHQgwqkgMjAxOSBJbnRlbCBDb3Jwb3Jh
dGlvbgorICovCisKKyNpZm5kZWYgSU5URUxfRU5HSU5FX1VTRVJfSAorI2RlZmluZSBJTlRFTF9F
TkdJTkVfVVNFUl9ICisKKyNpbmNsdWRlIDxsaW51eC90eXBlcy5oPgorCitzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZTsKK3N0cnVjdCBpbnRlbF9lbmdpbmVfY3M7CisKK3N0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKgoraW50ZWxfZW5naW5lX2xvb2t1cF91c2VyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LCB1OCBjbGFzcywgdTggaW5zdGFuY2UpOworCit2b2lkIGludGVsX2VuZ2luZV9hZGRf
dXNlcihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOworCisjZW5kaWYgLyogSU5URUxf
RU5HSU5FX1VTRVJfSCAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfZ3RfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmgK
aW5kZXggMzRkNGE4NjhlNGYxLi41ZmQxMWUzNjFkMDMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZ3RfdHlwZXMuaApAQCAtMjEsNiArMjEsNyBAQAogCiBzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZTsKIHN0cnVjdCBpOTE1X2dndHQ7CitzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzOwogc3Ry
dWN0IGludGVsX3VuY29yZTsKIAogc3RydWN0IGludGVsX2hhbmdjaGVjayB7CkBAIC03Niw2ICs3
Nyw5IEBAIHN0cnVjdCBpbnRlbF9ndCB7CiAJdTMyIHBtX2llcjsKIAogCXUzMiBwbV9ndWNfZXZl
bnRzOworCisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lX2NsYXNzW01BWF9FTkdJTkVf
Q0xBU1MgKyAxXQorCQkJCQkgICAgW01BWF9FTkdJTkVfSU5TVEFOQ0UgKyAxXTsKIH07CiAKIGVu
dW0gaW50ZWxfZ3Rfc2NyYXRjaF9maWVsZCB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0
X2xyYy5jCmluZGV4IDY3OGU5YjJlZGY4ZC4uYmRlMDE2NDU1MWIxIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF9scmMuYwpAQCAtMTc2NCw2ICsxNzY0LDcgQEAgc3RhdGljIGludCBs
aXZlX3ZpcnR1YWxfZW5naW5lKHZvaWQgKmFyZykKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IGFyZzsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpzaWJsaW5nc1tNQVhfRU5HSU5F
X0lOU1RBTkNFICsgMV07CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOworCXN0cnVj
dCBpbnRlbF9ndCAqZ3QgPSAmaTkxNS0+Z3Q7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAJ
dW5zaWduZWQgaW50IGNsYXNzLCBpbnN0OwogCWludCBlcnIgPSAtRU5PREVWOwpAQCAtMTc4Nywx
MCArMTc4OCwxMCBAQCBzdGF0aWMgaW50IGxpdmVfdmlydHVhbF9lbmdpbmUodm9pZCAqYXJnKQog
CiAJCW5zaWJsaW5nID0gMDsKIAkJZm9yIChpbnN0ID0gMDsgaW5zdCA8PSBNQVhfRU5HSU5FX0lO
U1RBTkNFOyBpbnN0KyspIHsKLQkJCWlmICghaTkxNS0+ZW5naW5lX2NsYXNzW2NsYXNzXVtpbnN0
XSkKKwkJCWlmICghZ3QtPmVuZ2luZV9jbGFzc1tjbGFzc11baW5zdF0pCiAJCQkJY29udGludWU7
CiAKLQkJCXNpYmxpbmdzW25zaWJsaW5nKytdID0gaTkxNS0+ZW5naW5lX2NsYXNzW2NsYXNzXVtp
bnN0XTsKKwkJCXNpYmxpbmdzW25zaWJsaW5nKytdID0gZ3QtPmVuZ2luZV9jbGFzc1tjbGFzc11b
aW5zdF07CiAJCX0KIAkJaWYgKG5zaWJsaW5nIDwgMikKIAkJCWNvbnRpbnVlOwpAQCAtMTkxMSw2
ICsxOTEyLDcgQEAgc3RhdGljIGludCBsaXZlX3ZpcnR1YWxfbWFzayh2b2lkICphcmcpCiB7CiAJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CiAJc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqc2libGluZ3NbTUFYX0VOR0lORV9JTlNUQU5DRSArIDFdOworCXN0cnVjdCBpbnRlbF9n
dCAqZ3QgPSAmaTkxNS0+Z3Q7CiAJdW5zaWduZWQgaW50IGNsYXNzLCBpbnN0OwogCWludCBlcnIg
PSAwOwogCkBAIC0xOTI0LDEwICsxOTI2LDEwIEBAIHN0YXRpYyBpbnQgbGl2ZV92aXJ0dWFsX21h
c2sodm9pZCAqYXJnKQogCiAJCW5zaWJsaW5nID0gMDsKIAkJZm9yIChpbnN0ID0gMDsgaW5zdCA8
PSBNQVhfRU5HSU5FX0lOU1RBTkNFOyBpbnN0KyspIHsKLQkJCWlmICghaTkxNS0+ZW5naW5lX2Ns
YXNzW2NsYXNzXVtpbnN0XSkKKwkJCWlmICghZ3QtPmVuZ2luZV9jbGFzc1tjbGFzc11baW5zdF0p
CiAJCQkJYnJlYWs7CiAKLQkJCXNpYmxpbmdzW25zaWJsaW5nKytdID0gaTkxNS0+ZW5naW5lX2Ns
YXNzW2NsYXNzXVtpbnN0XTsKKwkJCXNpYmxpbmdzW25zaWJsaW5nKytdID0gZ3QtPmVuZ2luZV9j
bGFzc1tjbGFzc11baW5zdF07CiAJCX0KIAkJaWYgKG5zaWJsaW5nIDwgMikKIAkJCWNvbnRpbnVl
OwpAQCAtMjA4OCw2ICsyMDkwLDcgQEAgc3RhdGljIGludCBsaXZlX3ZpcnR1YWxfYm9uZCh2b2lk
ICphcmcpCiAJfTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKIAlzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICpzaWJsaW5nc1tNQVhfRU5HSU5FX0lOU1RBTkNFICsgMV07CisJ
c3RydWN0IGludGVsX2d0ICpndCA9ICZpOTE1LT5ndDsKIAl1bnNpZ25lZCBpbnQgY2xhc3MsIGlu
c3Q7CiAJaW50IGVyciA9IDA7CiAKQEAgLTIxMDIsMTEgKzIxMDUsMTEgQEAgc3RhdGljIGludCBs
aXZlX3ZpcnR1YWxfYm9uZCh2b2lkICphcmcpCiAKIAkJbnNpYmxpbmcgPSAwOwogCQlmb3IgKGlu
c3QgPSAwOyBpbnN0IDw9IE1BWF9FTkdJTkVfSU5TVEFOQ0U7IGluc3QrKykgewotCQkJaWYgKCFp
OTE1LT5lbmdpbmVfY2xhc3NbY2xhc3NdW2luc3RdKQorCQkJaWYgKCFndC0+ZW5naW5lX2NsYXNz
W2NsYXNzXVtpbnN0XSkKIAkJCQlicmVhazsKIAogCQkJR0VNX0JVR19PTihuc2libGluZyA9PSBB
UlJBWV9TSVpFKHNpYmxpbmdzKSk7Ci0JCQlzaWJsaW5nc1tuc2libGluZysrXSA9IGk5MTUtPmVu
Z2luZV9jbGFzc1tjbGFzc11baW5zdF07CisJCQlzaWJsaW5nc1tuc2libGluZysrXSA9IGd0LT5l
bmdpbmVfY2xhc3NbY2xhc3NdW2luc3RdOwogCQl9CiAJCWlmIChuc2libGluZyA8IDIpCiAJCQlj
b250aW51ZTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCmluZGV4IDIwM2NkYmE5ODU1MC4uODZiMGEx
NjYzMmJjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKQEAgLTEzNzMsMTEgKzEzNzMsMTIgQEAg
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgewogCXdhaXRfcXVldWVfaGVhZF90IGdtYnVzX3dhaXRf
cXVldWU7CiAKIAlzdHJ1Y3QgcGNpX2RldiAqYnJpZGdlX2RldjsKLQlzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmVbSTkxNV9OVU1fRU5HSU5FU107CisKIAkvKiBDb250ZXh0IHVzZWQgaW50
ZXJuYWxseSB0byBpZGxlIHRoZSBHUFUgYW5kIHNldHVwIGluaXRpYWwgc3RhdGUgKi8KIAlzdHJ1
Y3QgaTkxNV9nZW1fY29udGV4dCAqa2VybmVsX2NvbnRleHQ7Ci0Jc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lX2NsYXNzW01BWF9FTkdJTkVfQ0xBU1MgKyAxXQotCQkJCQkgICAgW01BWF9F
TkdJTkVfSU5TVEFOQ0UgKyAxXTsKKworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZVtJ
OTE1X05VTV9FTkdJTkVTXTsKKwlzdHJ1Y3QgcmJfcm9vdCB1YWJpX2VuZ2luZXM7CiAKIAlzdHJ1
Y3QgcmVzb3VyY2UgbWNoX3JlczsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9pcnEuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfaXJxLmMKaW5kZXggOTFmOGM4
MTAyOGMzLi5hZjFiYjY1MzU3OWEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfaXJxLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuYwpAQCAtMzEwNiw3
ICszMTA2LDcgQEAgZ2VuMTFfZW5naW5lX2lycV9oYW5kbGVyKHN0cnVjdCBpbnRlbF9ndCAqZ3Qs
IGNvbnN0IHU4IGNsYXNzLAogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAogCWlm
IChpbnN0YW5jZSA8PSBNQVhfRU5HSU5FX0lOU1RBTkNFKQotCQllbmdpbmUgPSBndC0+aTkxNS0+
ZW5naW5lX2NsYXNzW2NsYXNzXVtpbnN0YW5jZV07CisJCWVuZ2luZSA9IGd0LT5lbmdpbmVfY2xh
c3NbY2xhc3NdW2luc3RhbmNlXTsKIAllbHNlCiAJCWVuZ2luZSA9IE5VTEw7CiAKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcG11LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3BtdS5jCmluZGV4IGVmZjg2NDgzYmVjMC4uODFmYmIyNjI4MDdkIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BtdS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfcG11LmMKQEAgLTgsNiArOCw3IEBACiAjaW5jbHVkZSA8bGludXgvcG1fcnVudGlt
ZS5oPgogCiAjaW5jbHVkZSAiZ3QvaW50ZWxfZW5naW5lLmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxf
ZW5naW5lX3VzZXIuaCIKIAogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAjaW5jbHVkZSAiaTkxNV9w
bXUuaCIKLS0gCjIuMjIuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50
ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 5C2E665206
	for <lists+intel-gfx@lfdr.de>; Thu, 11 Jul 2019 08:52:35 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D476D89E26;
	Thu, 11 Jul 2019 06:52:30 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D070F89DFA
 for <intel-gfx@lists.freedesktop.org>; Thu, 11 Jul 2019 06:52:27 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17214633-1500050 
 for multiple; Thu, 11 Jul 2019 07:52:17 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 11 Jul 2019 07:52:01 +0100
Message-Id: <20190711065215.4004-4-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190711065215.4004-1-chris@chris-wilson.co.uk>
References: <20190711065215.4004-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 04/18] drm/i915: Rely on spinlock protection for
 GPU error capture
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VHJ1c3QgdGhhdCB3ZSBub3cgaGF2ZSBhZGVxdWF0ZSBwcm90ZWN0aW9uIG92ZXIgdGhlIGxvdyBs
ZXZlbCBzdHJ1Y3R1cmVzCnZpYSB0aGUgZW5naW5lLT5hY3RpdmUubG9jayB0byBhbGxvdyBvdXJz
ZWx2ZXMgdG8gY2FwdHVyZSB0aGUgR1BVIGVycm9yCnN0YXRlIHdpdGhvdXQgdGhlIGhlYXZ5IGhh
bW1lciBvZiBzdG9wX21hY2hpbmUoKS4gU2FkbHkgdGhpcyBkb2VzIG1lYW4KdGhhdCB3ZSBoYXZl
IHRvIGZvcmdvIHNvbWUgb2YgdGhlIGxlc3NlciB1c2VkIGluZm9ybWF0aW9uIChub3QgZGVyaXZl
ZApmcm9tIHRoZSBhY3RpdmUgc3RhdGUpIHRoYXQgaXMgbm90IGNvbnRyb2xsZWQgYnkgdGhlIGFj
dGl2ZSBsb2Nrcy4KCkEgdXNlZnVsIHNpZGUtZWZmZWN0IGlzIHRoYXQgdGhpcyBhbGxvd3MgdXMg
dG8gcmVzdG9yZSBlcnJvciBjYXB0dXJpbmcKZm9yIEJyYXN3ZWxsIGFuZCBCcm94dG9uLgoKU2ln
bmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0tLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMgICB8ICAgNSAtCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5jIHwgNDk5ICsrKysrKysrKysrLS0tLS0tLS0tLS0t
LS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5oIHwgIDE3IC0KIDMgZmls
ZXMgY2hhbmdlZCwgMjAzIGluc2VydGlvbnMoKyksIDMxOCBkZWxldGlvbnMoLSkKCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtX2d0dC5jCmluZGV4IDIzNmM5NjRkZDc2MS4uZTA2NDVjZTRmYjg0IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwpAQCAtMzEzNSwxMSArMzEzNSw2IEBAIHN0
YXRpYyBpbnQgZ2VuOF9nbWNoX3Byb2JlKHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiAJCWdndHQt
PnZtLmluc2VydF9wYWdlICAgID0gYnh0X3Z0ZF9nZ3R0X2luc2VydF9wYWdlX19CS0w7CiAJCWlm
IChnZ3R0LT52bS5jbGVhcl9yYW5nZSAhPSBub3BfY2xlYXJfcmFuZ2UpCiAJCQlnZ3R0LT52bS5j
bGVhcl9yYW5nZSA9IGJ4dF92dGRfZ2d0dF9jbGVhcl9yYW5nZV9fQktMOwotCi0JCS8qIFByZXZl
bnQgcmVjdXJzaXZlbHkgY2FsbGluZyBzdG9wX21hY2hpbmUoKSBhbmQgZGVhZGxvY2tzLiAqLwot
CQlkZXZfaW5mbyhkZXZfcHJpdi0+ZHJtLmRldiwKLQkJCSAiRGlzYWJsaW5nIGVycm9yIGNhcHR1
cmUgZm9yIFZULWQgd29ya2Fyb3VuZFxuIik7Ci0JCWk5MTVfZGlzYWJsZV9lcnJvcl9zdGF0ZShk
ZXZfcHJpdiwgLUVOT0RFVik7CiAJfQogCiAJZ2d0dC0+aW52YWxpZGF0ZSA9IGdlbjZfZ2d0dF9p
bnZhbGlkYXRlOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJy
b3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMKaW5kZXggZjI5N2E0
M2RmMWU5Li4yZDQ0YTE3OWM2MmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ3B1X2Vycm9yLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3Iu
YwpAQCAtMzAsNyArMzAsNiBAQAogI2luY2x1ZGUgPGxpbnV4L2FzY2lpODUuaD4KICNpbmNsdWRl
IDxsaW51eC9ubWkuaD4KICNpbmNsdWRlIDxsaW51eC9zY2F0dGVybGlzdC5oPgotI2luY2x1ZGUg
PGxpbnV4L3N0b3BfbWFjaGluZS5oPgogI2luY2x1ZGUgPGxpbnV4L3V0c25hbWUuaD4KICNpbmNs
dWRlIDxsaW51eC96bGliLmg+CiAKQEAgLTQ2LDYgKzQ1LDkgQEAKICNpbmNsdWRlICJpOTE1X3Nj
YXR0ZXJsaXN0LmgiCiAjaW5jbHVkZSAiaW50ZWxfY3NyLmgiCiAKKyNkZWZpbmUgQUxMT1dfRkFJ
TCAoR0ZQX0tFUk5FTCB8IF9fR0ZQX1JFVFJZX01BWUZBSUwgfCBfX0dGUF9OT1dBUk4pCisjZGVm
aW5lIEFUT01JQ19NQVlGQUlMIChHRlBfQVRPTUlDIHwgX19HRlBfTk9XQVJOKQorCiBzdGF0aWMg
aW5saW5lIGNvbnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKgogZW5naW5lX2xvb2t1cChjb25z
dCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdW5zaWduZWQgaW50IGlkKQogewpAQCAt
NjcsMjYgKzY5LDYgQEAgZW5naW5lX25hbWUoY29uc3Qgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsIHVuc2lnbmVkIGludCBpZCkKIAlyZXR1cm4gX19lbmdpbmVfbmFtZShlbmdpbmVfbG9v
a3VwKGk5MTUsIGlkKSk7CiB9CiAKLXN0YXRpYyBjb25zdCBjaGFyICp0aWxpbmdfZmxhZyhpbnQg
dGlsaW5nKQotewotCXN3aXRjaCAodGlsaW5nKSB7Ci0JZGVmYXVsdDoKLQljYXNlIEk5MTVfVElM
SU5HX05PTkU6IHJldHVybiAiIjsKLQljYXNlIEk5MTVfVElMSU5HX1g6IHJldHVybiAiIFgiOwot
CWNhc2UgSTkxNV9USUxJTkdfWTogcmV0dXJuICIgWSI7Ci0JfQotfQotCi1zdGF0aWMgY29uc3Qg
Y2hhciAqZGlydHlfZmxhZyhpbnQgZGlydHkpCi17Ci0JcmV0dXJuIGRpcnR5ID8gIiBkaXJ0eSIg
OiAiIjsKLX0KLQotc3RhdGljIGNvbnN0IGNoYXIgKnB1cmdlYWJsZV9mbGFnKGludCBwdXJnZWFi
bGUpCi17Ci0JcmV0dXJuIHB1cmdlYWJsZSA/ICIgcHVyZ2VhYmxlIiA6ICIiOwotfQotCiBzdGF0
aWMgdm9pZCBfX3NnX3NldF9idWYoc3RydWN0IHNjYXR0ZXJsaXN0ICpzZywKIAkJCSB2b2lkICph
ZGRyLCB1bnNpZ25lZCBpbnQgbGVuLCBsb2ZmX3QgaXQpCiB7CkBAIC0xMTQsNyArOTYsNyBAQCBz
dGF0aWMgYm9vbCBfX2k5MTVfZXJyb3JfZ3JvdyhzdHJ1Y3QgZHJtX2k5MTVfZXJyb3Jfc3RhdGVf
YnVmICplLCBzaXplX3QgbGVuKQogCWlmIChlLT5jdXIgPT0gZS0+ZW5kKSB7CiAJCXN0cnVjdCBz
Y2F0dGVybGlzdCAqc2dsOwogCi0JCXNnbCA9ICh0eXBlb2Yoc2dsKSlfX2dldF9mcmVlX3BhZ2Uo
R0ZQX0tFUk5FTCk7CisJCXNnbCA9ICh0eXBlb2Yoc2dsKSlfX2dldF9mcmVlX3BhZ2UoQUxMT1df
RkFJTCk7CiAJCWlmICghc2dsKSB7CiAJCQllLT5lcnIgPSAtRU5PTUVNOwogCQkJcmV0dXJuIGZh
bHNlOwpAQCAtMTM0LDcgKzExNiw3IEBAIHN0YXRpYyBib29sIF9faTkxNV9lcnJvcl9ncm93KHN0
cnVjdCBkcm1faTkxNV9lcnJvcl9zdGF0ZV9idWYgKmUsIHNpemVfdCBsZW4pCiAJfQogCiAJZS0+
c2l6ZSA9IEFMSUdOKGxlbiArIDEsIFNaXzY0Syk7Ci0JZS0+YnVmID0ga21hbGxvYyhlLT5zaXpl
LCBHRlBfS0VSTkVMIHwgX19HRlBfTk9XQVJOIHwgX19HRlBfTk9SRVRSWSk7CisJZS0+YnVmID0g
a21hbGxvYyhlLT5zaXplLCBBTExPV19GQUlMKTsKIAlpZiAoIWUtPmJ1ZikgewogCQllLT5zaXpl
ID0gUEFHRV9BTElHTihsZW4gKyAxKTsKIAkJZS0+YnVmID0ga21hbGxvYyhlLT5zaXplLCBHRlBf
S0VSTkVMKTsKQEAgLTIxMSw0NyArMTkzLDEyMyBAQCBpOTE1X2Vycm9yX3ByaW50ZXIoc3RydWN0
IGRybV9pOTE1X2Vycm9yX3N0YXRlX2J1ZiAqZSkKIAlyZXR1cm4gcDsKIH0KIAorLyogc2luZ2xl
IHRocmVhZGVkIHBhZ2UgYWxsb2NhdG9yIHdpdGggYSByZXNlcnZlZCBzdGFzaCBmb3IgZW1lcmdl
bmNpZXMgKi8KK3N0cnVjdCBwb29sIHsKKwl2b2lkICpzdGFzaFszMV07CisJdW5zaWduZWQgaW50
IGNvdW50OworfTsKKworc3RhdGljIHZvaWQgKl9fYWxsb2NfcGFnZShnZnBfdCBnZnApCit7CisJ
cmV0dXJuICh2b2lkICopX19nZXRfZnJlZV9wYWdlKGdmcCk7Cit9CisKK3N0YXRpYyB2b2lkIHBv
b2xfZmluaShzdHJ1Y3QgcG9vbCAqcCkKK3sKKwl3aGlsZSAocC0+Y291bnQtLSkKKwkJZnJlZV9w
YWdlKCh1bnNpZ25lZCBsb25nKXAtPnN0YXNoW3AtPmNvdW50XSk7Cit9CisKK3N0YXRpYyBpbnQg
cG9vbF9yZWZpbGwoc3RydWN0IHBvb2wgKnAsIGdmcF90IGdmcCkKK3sKKwl3aGlsZSAocC0+Y291
bnQgPCBBUlJBWV9TSVpFKHAtPnN0YXNoKSkgeworCQlwLT5zdGFzaFtwLT5jb3VudF0gPSBfX2Fs
bG9jX3BhZ2UoZ2ZwKTsKKwkJaWYgKCFwLT5zdGFzaFtwLT5jb3VudF0pCisJCQlnb3RvIHVud2lu
ZDsKKwkJcC0+Y291bnQrKzsKKwl9CisKKwlyZXR1cm4gMDsKKwordW53aW5kOgorCXBvb2xfZmlu
aShwKTsKKwlyZXR1cm4gLUVOT01FTTsKK30KKworc3RhdGljIGludCBwb29sX2luaXQoc3RydWN0
IHBvb2wgKnAsIGdmcF90IGdmcCkKK3sKKwlwLT5jb3VudCA9IDA7CisJcmV0dXJuIHBvb2xfcmVm
aWxsKHAsIGdmcCk7Cit9CisKK3N0YXRpYyB2b2lkICpwb29sX2FsbG9jKHN0cnVjdCBwb29sICpw
LCBnZnBfdCBnZnApCit7CisJdm9pZCAqcHRyOworCisJcHRyID0gX19hbGxvY19wYWdlKGdmcCk7
CisJaWYgKHB0cikKKwkJcmV0dXJuIHB0cjsKKworCWlmIChwLT5jb3VudCkKKwkJcmV0dXJuIHAt
PnN0YXNoWy0tcC0+Y291bnRdOworCisJcmV0dXJuIE5VTEw7Cit9CisKK3N0YXRpYyB2b2lkIHBv
b2xfZnJlZShzdHJ1Y3QgcG9vbCAqcCwgdm9pZCAqcGFnZSkKK3sKKwlpZiAocC0+Y291bnQgPCBB
UlJBWV9TSVpFKHAtPnN0YXNoKSkgeworCQlwLT5zdGFzaFtwLT5jb3VudCsrXSA9IHBhZ2U7CisJ
CXJldHVybjsKKwl9CisKKwlmcmVlX3BhZ2UoKHVuc2lnbmVkIGxvbmcpcGFnZSk7Cit9CisKICNp
ZmRlZiBDT05GSUdfRFJNX0k5MTVfQ09NUFJFU1NfRVJST1IKIAogc3RydWN0IGNvbXByZXNzIHsK
KwlzdHJ1Y3QgcG9vbCBwb29sOwogCXN0cnVjdCB6X3N0cmVhbV9zIHpzdHJlYW07CiAJdm9pZCAq
dG1wOwogfTsKIAogc3RhdGljIGJvb2wgY29tcHJlc3NfaW5pdChzdHJ1Y3QgY29tcHJlc3MgKmMp
CiB7Ci0Jc3RydWN0IHpfc3RyZWFtX3MgKnpzdHJlYW0gPSBtZW1zZXQoJmMtPnpzdHJlYW0sIDAs
IHNpemVvZihjLT56c3RyZWFtKSk7CisJc3RydWN0IHpfc3RyZWFtX3MgKnpzdHJlYW0gPSAmYy0+
enN0cmVhbTsKIAotCXpzdHJlYW0tPndvcmtzcGFjZSA9Ci0JCWttYWxsb2MoemxpYl9kZWZsYXRl
X3dvcmtzcGFjZXNpemUoTUFYX1dCSVRTLCBNQVhfTUVNX0xFVkVMKSwKLQkJCUdGUF9BVE9NSUMg
fCBfX0dGUF9OT1dBUk4pOwotCWlmICghenN0cmVhbS0+d29ya3NwYWNlKQorCWlmIChwb29sX2lu
aXQoJmMtPnBvb2wsIEFMTE9XX0ZBSUwpKQogCQlyZXR1cm4gZmFsc2U7CiAKLQlpZiAoemxpYl9k
ZWZsYXRlSW5pdCh6c3RyZWFtLCBaX0RFRkFVTFRfQ09NUFJFU1NJT04pICE9IFpfT0spIHsKLQkJ
a2ZyZWUoenN0cmVhbS0+d29ya3NwYWNlKTsKKwl6c3RyZWFtLT53b3Jrc3BhY2UgPQorCQlrbWFs
bG9jKHpsaWJfZGVmbGF0ZV93b3Jrc3BhY2VzaXplKE1BWF9XQklUUywgTUFYX01FTV9MRVZFTCks
CisJCQlBTExPV19GQUlMKTsKKwlpZiAoIXpzdHJlYW0tPndvcmtzcGFjZSkgeworCQlwb29sX2Zp
bmkoJmMtPnBvb2wpOwogCQlyZXR1cm4gZmFsc2U7CiAJfQogCiAJYy0+dG1wID0gTlVMTDsKIAlp
ZiAoaTkxNV9oYXNfbWVtY3B5X2Zyb21fd2MoKSkKLQkJYy0+dG1wID0gKHZvaWQgKilfX2dldF9m
cmVlX3BhZ2UoR0ZQX0FUT01JQyB8IF9fR0ZQX05PV0FSTik7CisJCWMtPnRtcCA9IHBvb2xfYWxs
b2MoJmMtPnBvb2wsIEFMTE9XX0ZBSUwpOwogCiAJcmV0dXJuIHRydWU7CiB9CiAKLXN0YXRpYyB2
b2lkICpjb21wcmVzc19uZXh0X3BhZ2Uoc3RydWN0IGRybV9pOTE1X2Vycm9yX29iamVjdCAqZHN0
KQorc3RhdGljIGJvb2wgY29tcHJlc3Nfc3RhcnQoc3RydWN0IGNvbXByZXNzICpjKQoreworCXN0
cnVjdCB6X3N0cmVhbV9zICp6c3RyZWFtID0gJmMtPnpzdHJlYW07CisJdm9pZCAqd29ya3NwYWNl
ID0genN0cmVhbS0+d29ya3NwYWNlOworCisJbWVtc2V0KHpzdHJlYW0sIDAsIHNpemVvZigqenN0
cmVhbSkpOworCXpzdHJlYW0tPndvcmtzcGFjZSA9IHdvcmtzcGFjZTsKKworCXJldHVybiB6bGli
X2RlZmxhdGVJbml0KHpzdHJlYW0sIFpfREVGQVVMVF9DT01QUkVTU0lPTikgPT0gWl9PSzsKK30K
Kworc3RhdGljIHZvaWQgKmNvbXByZXNzX25leHRfcGFnZShzdHJ1Y3QgY29tcHJlc3MgKmMsCisJ
CQkJc3RydWN0IGRybV9pOTE1X2Vycm9yX29iamVjdCAqZHN0KQogewotCXVuc2lnbmVkIGxvbmcg
cGFnZTsKKwl2b2lkICpwYWdlOwogCiAJaWYgKGRzdC0+cGFnZV9jb3VudCA+PSBkc3QtPm51bV9w
YWdlcykKIAkJcmV0dXJuIEVSUl9QVFIoLUVOT1NQQyk7CiAKLQlwYWdlID0gX19nZXRfZnJlZV9w
YWdlKEdGUF9BVE9NSUMgfCBfX0dGUF9OT1dBUk4pOworCXBhZ2UgPSBwb29sX2FsbG9jKCZjLT5w
b29sLCBBVE9NSUNfTUFZRkFJTCk7CiAJaWYgKCFwYWdlKQogCQlyZXR1cm4gRVJSX1BUUigtRU5P
TUVNKTsKIAotCXJldHVybiBkc3QtPnBhZ2VzW2RzdC0+cGFnZV9jb3VudCsrXSA9ICh2b2lkICop
cGFnZTsKKwlyZXR1cm4gZHN0LT5wYWdlc1tkc3QtPnBhZ2VfY291bnQrK10gPSBwYWdlOwogfQog
CiBzdGF0aWMgaW50IGNvbXByZXNzX3BhZ2Uoc3RydWN0IGNvbXByZXNzICpjLApAQCAtMjY3LDcg
KzMyNSw3IEBAIHN0YXRpYyBpbnQgY29tcHJlc3NfcGFnZShzdHJ1Y3QgY29tcHJlc3MgKmMsCiAK
IAlkbyB7CiAJCWlmICh6c3RyZWFtLT5hdmFpbF9vdXQgPT0gMCkgewotCQkJenN0cmVhbS0+bmV4
dF9vdXQgPSBjb21wcmVzc19uZXh0X3BhZ2UoZHN0KTsKKwkJCXpzdHJlYW0tPm5leHRfb3V0ID0g
Y29tcHJlc3NfbmV4dF9wYWdlKGMsIGRzdCk7CiAJCQlpZiAoSVNfRVJSKHpzdHJlYW0tPm5leHRf
b3V0KSkKIAkJCQlyZXR1cm4gUFRSX0VSUih6c3RyZWFtLT5uZXh0X291dCk7CiAKQEAgLTI5NSw3
ICszNTMsNyBAQCBzdGF0aWMgaW50IGNvbXByZXNzX2ZsdXNoKHN0cnVjdCBjb21wcmVzcyAqYywK
IAlkbyB7CiAJCXN3aXRjaCAoemxpYl9kZWZsYXRlKHpzdHJlYW0sIFpfRklOSVNIKSkgewogCQlj
YXNlIFpfT0s6IC8qIG1vcmUgc3BhY2UgcmVxdWVzdGVkICovCi0JCQl6c3RyZWFtLT5uZXh0X291
dCA9IGNvbXByZXNzX25leHRfcGFnZShkc3QpOworCQkJenN0cmVhbS0+bmV4dF9vdXQgPSBjb21w
cmVzc19uZXh0X3BhZ2UoYywgZHN0KTsKIAkJCWlmIChJU19FUlIoenN0cmVhbS0+bmV4dF9vdXQp
KQogCQkJCXJldHVybiBQVFJfRVJSKHpzdHJlYW0tPm5leHRfb3V0KTsKIApAQCAtMzE2LDE1ICsz
NzQsMTcgQEAgc3RhdGljIGludCBjb21wcmVzc19mbHVzaChzdHJ1Y3QgY29tcHJlc3MgKmMsCiAJ
cmV0dXJuIDA7CiB9CiAKLXN0YXRpYyB2b2lkIGNvbXByZXNzX2Zpbmkoc3RydWN0IGNvbXByZXNz
ICpjLAotCQkJICBzdHJ1Y3QgZHJtX2k5MTVfZXJyb3Jfb2JqZWN0ICpkc3QpCitzdGF0aWMgdm9p
ZCBjb21wcmVzc19maW5pc2goc3RydWN0IGNvbXByZXNzICpjKQogewotCXN0cnVjdCB6X3N0cmVh
bV9zICp6c3RyZWFtID0gJmMtPnpzdHJlYW07CisJemxpYl9kZWZsYXRlRW5kKCZjLT56c3RyZWFt
KTsKK30KIAotCXpsaWJfZGVmbGF0ZUVuZCh6c3RyZWFtKTsKLQlrZnJlZSh6c3RyZWFtLT53b3Jr
c3BhY2UpOworc3RhdGljIHZvaWQgY29tcHJlc3NfZmluaShzdHJ1Y3QgY29tcHJlc3MgKmMpCit7
CisJa2ZyZWUoYy0+enN0cmVhbS53b3Jrc3BhY2UpOwogCWlmIChjLT50bXApCi0JCWZyZWVfcGFn
ZSgodW5zaWduZWQgbG9uZyljLT50bXApOworCQlwb29sX2ZyZWUoJmMtPnBvb2wsIGMtPnRtcCk7
CisJcG9vbF9maW5pKCZjLT5wb29sKTsKIH0KIAogc3RhdGljIHZvaWQgZXJyX2NvbXByZXNzaW9u
X21hcmtlcihzdHJ1Y3QgZHJtX2k5MTVfZXJyb3Jfc3RhdGVfYnVmICptKQpAQCAtMzM1LDkgKzM5
NSwxOCBAQCBzdGF0aWMgdm9pZCBlcnJfY29tcHJlc3Npb25fbWFya2VyKHN0cnVjdCBkcm1faTkx
NV9lcnJvcl9zdGF0ZV9idWYgKm0pCiAjZWxzZQogCiBzdHJ1Y3QgY29tcHJlc3MgeworCXN0cnVj
dCBwb29sIHBvb2w7CiB9OwogCiBzdGF0aWMgYm9vbCBjb21wcmVzc19pbml0KHN0cnVjdCBjb21w
cmVzcyAqYykKK3sKKwlpZiAocG9vbF9pbml0KCZjLT5wb29sLCBBTExPV19GQUlMKSkKKwkJcmV0
dXJuIGZhbHNlOworCisJcmV0dXJuIHRydWU7Cit9CisKK3N0YXRpYyBib29sIGNvbXByZXNzX3N0
YXJ0KHN0cnVjdCBjb21wcmVzcyAqYykKIHsKIAlyZXR1cm4gdHJ1ZTsKIH0KQEAgLTM0NiwxNCAr
NDE1LDEyIEBAIHN0YXRpYyBpbnQgY29tcHJlc3NfcGFnZShzdHJ1Y3QgY29tcHJlc3MgKmMsCiAJ
CQkgdm9pZCAqc3JjLAogCQkJIHN0cnVjdCBkcm1faTkxNV9lcnJvcl9vYmplY3QgKmRzdCkKIHsK
LQl1bnNpZ25lZCBsb25nIHBhZ2U7CiAJdm9pZCAqcHRyOwogCi0JcGFnZSA9IF9fZ2V0X2ZyZWVf
cGFnZShHRlBfQVRPTUlDIHwgX19HRlBfTk9XQVJOKTsKLQlpZiAoIXBhZ2UpCisJcHRyID0gcG9v
bF9hbGxvYygmYy0+cG9vbCwgQVRPTUlDX01BWUZBSUwpOworCWlmICghcHRyKQogCQlyZXR1cm4g
LUVOT01FTTsKIAotCXB0ciA9ICh2b2lkICopcGFnZTsKIAlpZiAoIWk5MTVfbWVtY3B5X2Zyb21f
d2MocHRyLCBzcmMsIFBBR0VfU0laRSkpCiAJCW1lbWNweShwdHIsIHNyYywgUEFHRV9TSVpFKTsK
IAlkc3QtPnBhZ2VzW2RzdC0+cGFnZV9jb3VudCsrXSA9IHB0cjsKQEAgLTM2NywxMSArNDM0LDE1
IEBAIHN0YXRpYyBpbnQgY29tcHJlc3NfZmx1c2goc3RydWN0IGNvbXByZXNzICpjLAogCXJldHVy
biAwOwogfQogCi1zdGF0aWMgdm9pZCBjb21wcmVzc19maW5pKHN0cnVjdCBjb21wcmVzcyAqYywK
LQkJCSAgc3RydWN0IGRybV9pOTE1X2Vycm9yX29iamVjdCAqZHN0KQorc3RhdGljIHZvaWQgY29t
cHJlc3NfZmluaXNoKHN0cnVjdCBjb21wcmVzcyAqYykKIHsKIH0KIAorc3RhdGljIHZvaWQgY29t
cHJlc3NfZmluaShzdHJ1Y3QgY29tcHJlc3MgKmMpCit7CisJcG9vbF9maW5pKCZjLT5wb29sKTsK
K30KKwogc3RhdGljIHZvaWQgZXJyX2NvbXByZXNzaW9uX21hcmtlcihzdHJ1Y3QgZHJtX2k5MTVf
ZXJyb3Jfc3RhdGVfYnVmICptKQogewogCWVycl9wdXRzKG0sICJ+Iik7CkBAIC0zNzksMzYgKzQ1
MCw2IEBAIHN0YXRpYyB2b2lkIGVycl9jb21wcmVzc2lvbl9tYXJrZXIoc3RydWN0IGRybV9pOTE1
X2Vycm9yX3N0YXRlX2J1ZiAqbSkKIAogI2VuZGlmCiAKLXN0YXRpYyB2b2lkIHByaW50X2Vycm9y
X2J1ZmZlcnMoc3RydWN0IGRybV9pOTE1X2Vycm9yX3N0YXRlX2J1ZiAqbSwKLQkJCQljb25zdCBj
aGFyICpuYW1lLAotCQkJCXN0cnVjdCBkcm1faTkxNV9lcnJvcl9idWZmZXIgKmVyciwKLQkJCQlp
bnQgY291bnQpCi17Ci0JZXJyX3ByaW50ZihtLCAiJXMgWyVkXTpcbiIsIG5hbWUsIGNvdW50KTsK
LQotCXdoaWxlIChjb3VudC0tKSB7Ci0JCWVycl9wcmludGYobSwgIiAgICAlMDh4XyUwOHggJTh1
ICUwMnggJTAyeCIsCi0JCQkgICB1cHBlcl8zMl9iaXRzKGVyci0+Z3R0X29mZnNldCksCi0JCQkg
ICBsb3dlcl8zMl9iaXRzKGVyci0+Z3R0X29mZnNldCksCi0JCQkgICBlcnItPnNpemUsCi0JCQkg
ICBlcnItPnJlYWRfZG9tYWlucywKLQkJCSAgIGVyci0+d3JpdGVfZG9tYWluKTsKLQkJZXJyX3B1
dHMobSwgdGlsaW5nX2ZsYWcoZXJyLT50aWxpbmcpKTsKLQkJZXJyX3B1dHMobSwgZGlydHlfZmxh
ZyhlcnItPmRpcnR5KSk7Ci0JCWVycl9wdXRzKG0sIHB1cmdlYWJsZV9mbGFnKGVyci0+cHVyZ2Vh
YmxlKSk7Ci0JCWVycl9wdXRzKG0sIGVyci0+dXNlcnB0ciA/ICIgdXNlcnB0ciIgOiAiIik7Ci0J
CWVycl9wdXRzKG0sIGk5MTVfY2FjaGVfbGV2ZWxfc3RyKG0tPmk5MTUsIGVyci0+Y2FjaGVfbGV2
ZWwpKTsKLQotCQlpZiAoZXJyLT5uYW1lKQotCQkJZXJyX3ByaW50ZihtLCAiIChuYW1lOiAlZCki
LCBlcnItPm5hbWUpOwotCQlpZiAoZXJyLT5mZW5jZV9yZWcgIT0gSTkxNV9GRU5DRV9SRUdfTk9O
RSkKLQkJCWVycl9wcmludGYobSwgIiAoZmVuY2U6ICVkKSIsIGVyci0+ZmVuY2VfcmVnKTsKLQot
CQllcnJfcHV0cyhtLCAiXG4iKTsKLQkJZXJyKys7Ci0JfQotfQotCiBzdGF0aWMgdm9pZCBlcnJv
cl9wcmludF9pbnN0ZG9uZShzdHJ1Y3QgZHJtX2k5MTVfZXJyb3Jfc3RhdGVfYnVmICptLAogCQkJ
CSBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZXJyb3JfZW5naW5lICplZSkKIHsKQEAgLTczNCwzMyAr
Nzc1LDYgQEAgc3RhdGljIHZvaWQgX19lcnJfcHJpbnRfdG9fc2dsKHN0cnVjdCBkcm1faTkxNV9l
cnJvcl9zdGF0ZV9idWYgKm0sCiAJCQllcnJvcl9wcmludF9lbmdpbmUobSwgJmVycm9yLT5lbmdp
bmVbaV0sIGVycm9yLT5lcG9jaCk7CiAJfQogCi0JZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUo
ZXJyb3ItPmFjdGl2ZV92bSk7IGkrKykgewotCQljaGFyIGJ1ZlsxMjhdOwotCQlpbnQgbGVuLCBm
aXJzdCA9IDE7Ci0KLQkJaWYgKCFlcnJvci0+YWN0aXZlX3ZtW2ldKQotCQkJYnJlYWs7Ci0KLQkJ
bGVuID0gc2NucHJpbnRmKGJ1Ziwgc2l6ZW9mKGJ1ZiksICJBY3RpdmUgKCIpOwotCQlmb3IgKGog
PSAwOyBqIDwgQVJSQVlfU0laRShlcnJvci0+ZW5naW5lKTsgaisrKSB7Ci0JCQlpZiAoZXJyb3It
PmVuZ2luZVtqXS52bSAhPSBlcnJvci0+YWN0aXZlX3ZtW2ldKQotCQkJCWNvbnRpbnVlOwotCi0J
CQlsZW4gKz0gc2NucHJpbnRmKGJ1ZiArIGxlbiwgc2l6ZW9mKGJ1ZiksICIlcyVzIiwKLQkJCQkJ
IGZpcnN0ID8gIiIgOiAiLCAiLAotCQkJCQkgbS0+aTkxNS0+ZW5naW5lW2pdLT5uYW1lKTsKLQkJ
CWZpcnN0ID0gMDsKLQkJfQotCQlzY25wcmludGYoYnVmICsgbGVuLCBzaXplb2YoYnVmKSwgIiki
KTsKLQkJcHJpbnRfZXJyb3JfYnVmZmVycyhtLCBidWYsCi0JCQkJICAgIGVycm9yLT5hY3RpdmVf
Ym9baV0sCi0JCQkJICAgIGVycm9yLT5hY3RpdmVfYm9fY291bnRbaV0pOwotCX0KLQotCXByaW50
X2Vycm9yX2J1ZmZlcnMobSwgIlBpbm5lZCAoZ2xvYmFsKSIsCi0JCQkgICAgZXJyb3ItPnBpbm5l
ZF9ibywKLQkJCSAgICBlcnJvci0+cGlubmVkX2JvX2NvdW50KTsKLQogCWZvciAoaSA9IDA7IGkg
PCBBUlJBWV9TSVpFKGVycm9yLT5lbmdpbmUpOyBpKyspIHsKIAkJY29uc3Qgc3RydWN0IGRybV9p
OTE1X2Vycm9yX2VuZ2luZSAqZWUgPSAmZXJyb3ItPmVuZ2luZVtpXTsKIApAQCAtOTc0LDEwICs5
ODgsNiBAQCB2b2lkIF9faTkxNV9ncHVfc3RhdGVfZnJlZShzdHJ1Y3Qga3JlZiAqZXJyb3JfcmVm
KQogCQlrZnJlZShlZS0+cmVxdWVzdHMpOwogCX0KIAotCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9T
SVpFKGVycm9yLT5hY3RpdmVfYm8pOyBpKyspCi0JCWtmcmVlKGVycm9yLT5hY3RpdmVfYm9baV0p
OwotCWtmcmVlKGVycm9yLT5waW5uZWRfYm8pOwotCiAJa2ZyZWUoZXJyb3ItPm92ZXJsYXkpOwog
CWtmcmVlKGVycm9yLT5kaXNwbGF5KTsKIApAQCAtOTkwLDEyICsxMDAwLDEyIEBAIHZvaWQgX19p
OTE1X2dwdV9zdGF0ZV9mcmVlKHN0cnVjdCBrcmVmICplcnJvcl9yZWYpCiAKIHN0YXRpYyBzdHJ1
Y3QgZHJtX2k5MTVfZXJyb3Jfb2JqZWN0ICoKIGk5MTVfZXJyb3Jfb2JqZWN0X2NyZWF0ZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKLQkJCSBzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKKwkJ
CSBzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKKwkJCSBzdHJ1Y3QgY29tcHJlc3MgKmNvbXByZXNzKQog
ewogCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSAmaTkxNS0+Z2d0dDsKIAljb25zdCB1NjQgc2xv
dCA9IGdndHQtPmVycm9yX2NhcHR1cmUuc3RhcnQ7CiAJc3RydWN0IGRybV9pOTE1X2Vycm9yX29i
amVjdCAqZHN0OwotCXN0cnVjdCBjb21wcmVzcyBjb21wcmVzczsKIAl1bnNpZ25lZCBsb25nIG51
bV9wYWdlczsKIAlzdHJ1Y3Qgc2d0X2l0ZXIgaXRlcjsKIAlkbWFfYWRkcl90IGRtYTsKQEAgLTEw
MDYsMjIgKzEwMTYsMjEgQEAgaTkxNV9lcnJvcl9vYmplY3RfY3JlYXRlKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1LAogCiAJbnVtX3BhZ2VzID0gbWluX3QodTY0LCB2bWEtPnNpemUsIHZt
YS0+b2JqLT5iYXNlLnNpemUpID4+IFBBR0VfU0hJRlQ7CiAJbnVtX3BhZ2VzID0gRElWX1JPVU5E
X1VQKDEwICogbnVtX3BhZ2VzLCA4KTsgLyogd29yc3RjYXNlIHpsaWIgZ3Jvd3RoICovCi0JZHN0
ID0ga21hbGxvYyhzaXplb2YoKmRzdCkgKyBudW1fcGFnZXMgKiBzaXplb2YodTMyICopLAotCQkg
ICAgICBHRlBfQVRPTUlDIHwgX19HRlBfTk9XQVJOKTsKKwlkc3QgPSBrbWFsbG9jKHNpemVvZigq
ZHN0KSArIG51bV9wYWdlcyAqIHNpemVvZih1MzIgKiksIEFUT01JQ19NQVlGQUlMKTsKIAlpZiAo
IWRzdCkKIAkJcmV0dXJuIE5VTEw7CiAKKwlpZiAoIWNvbXByZXNzX3N0YXJ0KGNvbXByZXNzKSkg
eworCQlrZnJlZShkc3QpOworCQlyZXR1cm4gTlVMTDsKKwl9CisKIAlkc3QtPmd0dF9vZmZzZXQg
PSB2bWEtPm5vZGUuc3RhcnQ7CiAJZHN0LT5ndHRfc2l6ZSA9IHZtYS0+bm9kZS5zaXplOwogCWRz
dC0+bnVtX3BhZ2VzID0gbnVtX3BhZ2VzOwogCWRzdC0+cGFnZV9jb3VudCA9IDA7CiAJZHN0LT51
bnVzZWQgPSAwOwogCi0JaWYgKCFjb21wcmVzc19pbml0KCZjb21wcmVzcykpIHsKLQkJa2ZyZWUo
ZHN0KTsKLQkJcmV0dXJuIE5VTEw7Ci0JfQotCiAJcmV0ID0gLUVJTlZBTDsKIAlmb3JfZWFjaF9z
Z3RfZG1hKGRtYSwgaXRlciwgdm1hLT5wYWdlcykgewogCQl2b2lkIF9faW9tZW0gKnM7CkBAIC0x
MDI5LDY5ICsxMDM4LDIzIEBAIGk5MTVfZXJyb3Jfb2JqZWN0X2NyZWF0ZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKIAkJZ2d0dC0+dm0uaW5zZXJ0X3BhZ2UoJmdndHQtPnZtLCBkbWEs
IHNsb3QsIEk5MTVfQ0FDSEVfTk9ORSwgMCk7CiAKIAkJcyA9IGlvX21hcHBpbmdfbWFwX2F0b21p
Y193YygmZ2d0dC0+aW9tYXAsIHNsb3QpOwotCQlyZXQgPSBjb21wcmVzc19wYWdlKCZjb21wcmVz
cywgKHZvaWQgIF9fZm9yY2UgKilzLCBkc3QpOworCQlyZXQgPSBjb21wcmVzc19wYWdlKGNvbXBy
ZXNzLCAodm9pZCAgX19mb3JjZSAqKXMsIGRzdCk7CiAJCWlvX21hcHBpbmdfdW5tYXBfYXRvbWlj
KHMpOwogCQlpZiAocmV0KQogCQkJYnJlYWs7CiAJfQogCi0JaWYgKHJldCB8fCBjb21wcmVzc19m
bHVzaCgmY29tcHJlc3MsIGRzdCkpIHsKKwlpZiAocmV0IHx8IGNvbXByZXNzX2ZsdXNoKGNvbXBy
ZXNzLCBkc3QpKSB7CiAJCXdoaWxlIChkc3QtPnBhZ2VfY291bnQtLSkKLQkJCWZyZWVfcGFnZSgo
dW5zaWduZWQgbG9uZylkc3QtPnBhZ2VzW2RzdC0+cGFnZV9jb3VudF0pOworCQkJcG9vbF9mcmVl
KCZjb21wcmVzcy0+cG9vbCwgZHN0LT5wYWdlc1tkc3QtPnBhZ2VfY291bnRdKTsKIAkJa2ZyZWUo
ZHN0KTsKIAkJZHN0ID0gTlVMTDsKIAl9CisJY29tcHJlc3NfZmluaXNoKGNvbXByZXNzKTsKIAot
CWNvbXByZXNzX2ZpbmkoJmNvbXByZXNzLCBkc3QpOwogCXJldHVybiBkc3Q7CiB9CiAKLXN0YXRp
YyB2b2lkIGNhcHR1cmVfYm8oc3RydWN0IGRybV9pOTE1X2Vycm9yX2J1ZmZlciAqZXJyLAotCQkg
ICAgICAgc3RydWN0IGk5MTVfdm1hICp2bWEpCi17Ci0Jc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iaiA9IHZtYS0+b2JqOwotCi0JZXJyLT5zaXplID0gb2JqLT5iYXNlLnNpemU7Ci0JZXJy
LT5uYW1lID0gb2JqLT5iYXNlLm5hbWU7Ci0KLQllcnItPmd0dF9vZmZzZXQgPSB2bWEtPm5vZGUu
c3RhcnQ7Ci0JZXJyLT5yZWFkX2RvbWFpbnMgPSBvYmotPnJlYWRfZG9tYWluczsKLQllcnItPndy
aXRlX2RvbWFpbiA9IG9iai0+d3JpdGVfZG9tYWluOwotCWVyci0+ZmVuY2VfcmVnID0gdm1hLT5m
ZW5jZSA/IHZtYS0+ZmVuY2UtPmlkIDogLTE7Ci0JZXJyLT50aWxpbmcgPSBpOTE1X2dlbV9vYmpl
Y3RfZ2V0X3RpbGluZyhvYmopOwotCWVyci0+ZGlydHkgPSBvYmotPm1tLmRpcnR5OwotCWVyci0+
cHVyZ2VhYmxlID0gb2JqLT5tbS5tYWR2ICE9IEk5MTVfTUFEVl9XSUxMTkVFRDsKLQllcnItPnVz
ZXJwdHIgPSBvYmotPnVzZXJwdHIubW0gIT0gTlVMTDsKLQllcnItPmNhY2hlX2xldmVsID0gb2Jq
LT5jYWNoZV9sZXZlbDsKLX0KLQotc3RhdGljIHUzMiBjYXB0dXJlX2Vycm9yX2JvKHN0cnVjdCBk
cm1faTkxNV9lcnJvcl9idWZmZXIgKmVyciwKLQkJCSAgICBpbnQgY291bnQsIHN0cnVjdCBsaXN0
X2hlYWQgKmhlYWQsCi0JCQkgICAgdW5zaWduZWQgaW50IGZsYWdzKQotI2RlZmluZSBBQ1RJVkVf
T05MWSBCSVQoMCkKLSNkZWZpbmUgUElOTkVEX09OTFkgQklUKDEpCi17Ci0Jc3RydWN0IGk5MTVf
dm1hICp2bWE7Ci0JaW50IGkgPSAwOwotCi0JbGlzdF9mb3JfZWFjaF9lbnRyeSh2bWEsIGhlYWQs
IHZtX2xpbmspIHsKLQkJaWYgKCF2bWEtPm9iaikKLQkJCWNvbnRpbnVlOwotCi0JCWlmIChmbGFn
cyAmIEFDVElWRV9PTkxZICYmICFpOTE1X3ZtYV9pc19hY3RpdmUodm1hKSkKLQkJCWNvbnRpbnVl
OwotCi0JCWlmIChmbGFncyAmIFBJTk5FRF9PTkxZICYmICFpOTE1X3ZtYV9pc19waW5uZWQodm1h
KSkKLQkJCWNvbnRpbnVlOwotCi0JCWNhcHR1cmVfYm8oZXJyKyssIHZtYSk7Ci0JCWlmICgrK2kg
PT0gY291bnQpCi0JCQlicmVhazsKLQl9Ci0KLQlyZXR1cm4gaTsKLX0KLQogLyoKICAqIEdlbmVy
YXRlIGEgc2VtaS11bmlxdWUgZXJyb3IgY29kZS4gVGhlIGNvZGUgaXMgbm90IG1lYW50IHRvIGhh
dmUgbWVhbmluZywgVGhlCiAgKiBjb2RlJ3Mgb25seSBwdXJwb3NlIGlzIHRvIHRyeSB0byBwcmV2
ZW50IGZhbHNlIGR1cGxpY2F0ZWQgYnVnIHJlcG9ydHMgYnkKQEAgLTEyODEsNyArMTI0NCw3IEBA
IHN0YXRpYyB2b2lkIGVuZ2luZV9yZWNvcmRfcmVxdWVzdHMoc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lLAogCWlmICghY291bnQpCiAJCXJldHVybjsKIAotCWVlLT5yZXF1ZXN0cyA9IGtj
YWxsb2MoY291bnQsIHNpemVvZigqZWUtPnJlcXVlc3RzKSwgR0ZQX0FUT01JQyk7CisJZWUtPnJl
cXVlc3RzID0ga2NhbGxvYyhjb3VudCwgc2l6ZW9mKCplZS0+cmVxdWVzdHMpLCBBVE9NSUNfTUFZ
RkFJTCk7CiAJaWYgKCFlZS0+cmVxdWVzdHMpCiAJCXJldHVybjsKIApAQCAtMTM0OSw4ICsxMzEy
LDEwIEBAIHN0YXRpYyB2b2lkIHJlY29yZF9jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9lcnJvcl9j
b250ZXh0ICplLAogCWUtPmFjdGl2ZSA9IGF0b21pY19yZWFkKCZjdHgtPmFjdGl2ZV9jb3VudCk7
CiB9CiAKLXN0YXRpYyB2b2lkIHJlcXVlc3RfcmVjb3JkX3VzZXJfYm8oc3RydWN0IGk5MTVfcmVx
dWVzdCAqcmVxdWVzdCwKLQkJCQkgICBzdHJ1Y3QgZHJtX2k5MTVfZXJyb3JfZW5naW5lICplZSkK
K3N0YXRpYyB2b2lkCityZXF1ZXN0X3JlY29yZF91c2VyX2JvKHN0cnVjdCBpOTE1X3JlcXVlc3Qg
KnJlcXVlc3QsCisJCSAgICAgICBzdHJ1Y3QgZHJtX2k5MTVfZXJyb3JfZW5naW5lICplZSwKKwkJ
ICAgICAgIHN0cnVjdCBjb21wcmVzcyAqY29tcHJlc3MpCiB7CiAJc3RydWN0IGk5MTVfY2FwdHVy
ZV9saXN0ICpjOwogCXN0cnVjdCBkcm1faTkxNV9lcnJvcl9vYmplY3QgKipibzsKQEAgLTEzNjIs
MTggKzEzMjcsMjAgQEAgc3RhdGljIHZvaWQgcmVxdWVzdF9yZWNvcmRfdXNlcl9ibyhzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpyZXF1ZXN0LAogCWlmICghbWF4KQogCQlyZXR1cm47CiAKLQlibyA9IGtt
YWxsb2NfYXJyYXkobWF4LCBzaXplb2YoKmJvKSwgR0ZQX0FUT01JQyk7CisJYm8gPSBrbWFsbG9j
X2FycmF5KG1heCwgc2l6ZW9mKCpibyksIEFUT01JQ19NQVlGQUlMKTsKIAlpZiAoIWJvKSB7CiAJ
CS8qIElmIHdlIGNhbid0IGNhcHR1cmUgZXZlcnl0aGluZywgdHJ5IHRvIGNhcHR1cmUgc29tZXRo
aW5nLiAqLwogCQltYXggPSBtaW5fdChsb25nLCBtYXgsIFBBR0VfU0laRSAvIHNpemVvZigqYm8p
KTsKLQkJYm8gPSBrbWFsbG9jX2FycmF5KG1heCwgc2l6ZW9mKCpibyksIEdGUF9BVE9NSUMpOwor
CQlibyA9IGttYWxsb2NfYXJyYXkobWF4LCBzaXplb2YoKmJvKSwgQVRPTUlDX01BWUZBSUwpOwog
CX0KIAlpZiAoIWJvKQogCQlyZXR1cm47CiAKIAljb3VudCA9IDA7CiAJZm9yIChjID0gcmVxdWVz
dC0+Y2FwdHVyZV9saXN0OyBjOyBjID0gYy0+bmV4dCkgewotCQlib1tjb3VudF0gPSBpOTE1X2Vy
cm9yX29iamVjdF9jcmVhdGUocmVxdWVzdC0+aTkxNSwgYy0+dm1hKTsKKwkJYm9bY291bnRdID0g
aTkxNV9lcnJvcl9vYmplY3RfY3JlYXRlKHJlcXVlc3QtPmk5MTUsCisJCQkJCQkgICAgIGMtPnZt
YSwKKwkJCQkJCSAgICAgY29tcHJlc3MpOwogCQlpZiAoIWJvW2NvdW50XSkKIAkJCWJyZWFrOwog
CQlpZiAoKytjb3VudCA9PSBtYXgpCkBAIC0xMzg2LDcgKzEzNTMsOCBAQCBzdGF0aWMgdm9pZCBy
ZXF1ZXN0X3JlY29yZF91c2VyX2JvKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QsCiAKIHN0
YXRpYyBzdHJ1Y3QgZHJtX2k5MTVfZXJyb3Jfb2JqZWN0ICoKIGNhcHR1cmVfb2JqZWN0KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkgICAgICAgc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaikKKwkgICAgICAgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwK
KwkgICAgICAgc3RydWN0IGNvbXByZXNzICpjb21wcmVzcykKIHsKIAlpZiAob2JqICYmIGk5MTVf
Z2VtX29iamVjdF9oYXNfcGFnZXMob2JqKSkgewogCQlzdHJ1Y3QgaTkxNV92bWEgZmFrZSA9IHsK
QEAgLTEzOTYsMTMgKzEzNjQsMTQgQEAgY2FwdHVyZV9vYmplY3Qoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAogCQkJLm9iaiA9IG9iaiwKIAkJfTsKIAotCQlyZXR1cm4gaTkxNV9l
cnJvcl9vYmplY3RfY3JlYXRlKGRldl9wcml2LCAmZmFrZSk7CisJCXJldHVybiBpOTE1X2Vycm9y
X29iamVjdF9jcmVhdGUoZGV2X3ByaXYsICZmYWtlLCBjb21wcmVzcyk7CiAJfSBlbHNlIHsKIAkJ
cmV0dXJuIE5VTEw7CiAJfQogfQogCi1zdGF0aWMgdm9pZCBnZW1fcmVjb3JkX3JpbmdzKHN0cnVj
dCBpOTE1X2dwdV9zdGF0ZSAqZXJyb3IpCitzdGF0aWMgdm9pZAorZ2VtX3JlY29yZF9yaW5ncyhz
dHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKmVycm9yLCBzdHJ1Y3QgY29tcHJlc3MgKmNvbXByZXNzKQog
ewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZXJyb3ItPmk5MTU7CiAJaW50IGk7
CkBAIC0xNDIwLDYgKzEzODksOSBAQCBzdGF0aWMgdm9pZCBnZW1fcmVjb3JkX3JpbmdzKHN0cnVj
dCBpOTE1X2dwdV9zdGF0ZSAqZXJyb3IpCiAKIAkJZWUtPmVuZ2luZV9pZCA9IGk7CiAKKwkJLyog
UmVmaWxsIG91ciBwYWdlIHBvb2wgYmVmb3JlIGVudGVyaW5nIGF0b21pYyBzZWN0aW9uICovCisJ
CXBvb2xfcmVmaWxsKCZjb21wcmVzcy0+cG9vbCwgQUxMT1dfRkFJTCk7CisKIAkJZXJyb3JfcmVj
b3JkX2VuZ2luZV9yZWdpc3RlcnMoZXJyb3IsIGVuZ2luZSwgZWUpOwogCQllcnJvcl9yZWNvcmRf
ZW5naW5lX2V4ZWNsaXN0cyhlbmdpbmUsIGVlKTsKIApAQCAtMTQyOSw4ICsxNDAxLDYgQEAgc3Rh
dGljIHZvaWQgZ2VtX3JlY29yZF9yaW5ncyhzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKmVycm9yKQog
CQkJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IHJlcXVlc3QtPmdlbV9jb250ZXh0Owog
CQkJc3RydWN0IGludGVsX3JpbmcgKnJpbmcgPSByZXF1ZXN0LT5yaW5nOwogCi0JCQllZS0+dm0g
PSBjdHgtPnZtID86ICZlbmdpbmUtPmd0LT5nZ3R0LT52bTsKLQogCQkJcmVjb3JkX2NvbnRleHQo
JmVlLT5jb250ZXh0LCBjdHgpOwogCiAJCQkvKiBXZSBuZWVkIHRvIGNvcHkgdGhlc2UgdG8gYW4g
YW5vbnltb3VzIGJ1ZmZlcgpAQCAtMTQzOCwxNyArMTQwOCwyMSBAQCBzdGF0aWMgdm9pZCBnZW1f
cmVjb3JkX3JpbmdzKHN0cnVjdCBpOTE1X2dwdV9zdGF0ZSAqZXJyb3IpCiAJCQkgKiBieSB1c2Vy
c3BhY2UuCiAJCQkgKi8KIAkJCWVlLT5iYXRjaGJ1ZmZlciA9Ci0JCQkJaTkxNV9lcnJvcl9vYmpl
Y3RfY3JlYXRlKGk5MTUsIHJlcXVlc3QtPmJhdGNoKTsKKwkJCQlpOTE1X2Vycm9yX29iamVjdF9j
cmVhdGUoaTkxNSwKKwkJCQkJCQkgcmVxdWVzdC0+YmF0Y2gsCisJCQkJCQkJIGNvbXByZXNzKTsK
IAogCQkJaWYgKEhBU19CUk9LRU5fQ1NfVExCKGk5MTUpKQogCQkJCWVlLT53YV9iYXRjaGJ1ZmZl
ciA9CiAJCQkJICBpOTE1X2Vycm9yX29iamVjdF9jcmVhdGUoaTkxNSwKLQkJCQkJCQkgICBlbmdp
bmUtPmd0LT5zY3JhdGNoKTsKLQkJCXJlcXVlc3RfcmVjb3JkX3VzZXJfYm8ocmVxdWVzdCwgZWUp
OworCQkJCQkJCSAgIGVuZ2luZS0+Z3QtPnNjcmF0Y2gsCisJCQkJCQkJICAgY29tcHJlc3MpOwor
CQkJcmVxdWVzdF9yZWNvcmRfdXNlcl9ibyhyZXF1ZXN0LCBlZSwgY29tcHJlc3MpOwogCiAJCQll
ZS0+Y3R4ID0KIAkJCQlpOTE1X2Vycm9yX29iamVjdF9jcmVhdGUoaTkxNSwKLQkJCQkJCQkgcmVx
dWVzdC0+aHdfY29udGV4dC0+c3RhdGUpOworCQkJCQkJCSByZXF1ZXN0LT5od19jb250ZXh0LT5z
dGF0ZSwKKwkJCQkJCQkgY29tcHJlc3MpOwogCiAJCQllcnJvci0+c2ltdWxhdGVkIHw9CiAJCQkJ
aTkxNV9nZW1fY29udGV4dF9ub19lcnJvcl9jYXB0dXJlKGN0eCk7CkBAIC0xNDYwLDcgKzE0MzQs
OSBAQCBzdGF0aWMgdm9pZCBnZW1fcmVjb3JkX3JpbmdzKHN0cnVjdCBpOTE1X2dwdV9zdGF0ZSAq
ZXJyb3IpCiAJCQllZS0+Y3B1X3JpbmdfaGVhZCA9IHJpbmctPmhlYWQ7CiAJCQllZS0+Y3B1X3Jp
bmdfdGFpbCA9IHJpbmctPnRhaWw7CiAJCQllZS0+cmluZ2J1ZmZlciA9Ci0JCQkJaTkxNV9lcnJv
cl9vYmplY3RfY3JlYXRlKGk5MTUsIHJpbmctPnZtYSk7CisJCQkJaTkxNV9lcnJvcl9vYmplY3Rf
Y3JlYXRlKGk5MTUsCisJCQkJCQkJIHJpbmctPnZtYSwKKwkJCQkJCQkgY29tcHJlc3MpOwogCiAJ
CQllbmdpbmVfcmVjb3JkX3JlcXVlc3RzKGVuZ2luZSwgcmVxdWVzdCwgZWUpOwogCQl9CkBAIC0x
NDY4LDg5ICsxNDQ0LDIxIEBAIHN0YXRpYyB2b2lkIGdlbV9yZWNvcmRfcmluZ3Moc3RydWN0IGk5
MTVfZ3B1X3N0YXRlICplcnJvcikKIAogCQllZS0+aHdzX3BhZ2UgPQogCQkJaTkxNV9lcnJvcl9v
YmplY3RfY3JlYXRlKGk5MTUsCi0JCQkJCQkgZW5naW5lLT5zdGF0dXNfcGFnZS52bWEpOwotCi0J
CWVlLT53YV9jdHggPSBpOTE1X2Vycm9yX29iamVjdF9jcmVhdGUoaTkxNSwgZW5naW5lLT53YV9j
dHgudm1hKTsKKwkJCQkJCSBlbmdpbmUtPnN0YXR1c19wYWdlLnZtYSwKKwkJCQkJCSBjb21wcmVz
cyk7CiAKLQkJZWUtPmRlZmF1bHRfc3RhdGUgPSBjYXB0dXJlX29iamVjdChpOTE1LCBlbmdpbmUt
PmRlZmF1bHRfc3RhdGUpOwotCX0KLX0KLQotc3RhdGljIHZvaWQgZ2VtX2NhcHR1cmVfdm0oc3Ry
dWN0IGk5MTVfZ3B1X3N0YXRlICplcnJvciwKLQkJCSAgIHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3Bh
Y2UgKnZtLAotCQkJICAgaW50IGlkeCkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfZXJyb3JfYnVmZmVy
ICphY3RpdmVfYm87Ci0Jc3RydWN0IGk5MTVfdm1hICp2bWE7Ci0JaW50IGNvdW50OwotCi0JY291
bnQgPSAwOwotCWxpc3RfZm9yX2VhY2hfZW50cnkodm1hLCAmdm0tPmJvdW5kX2xpc3QsIHZtX2xp
bmspCi0JCWlmIChpOTE1X3ZtYV9pc19hY3RpdmUodm1hKSkKLQkJCWNvdW50Kys7Ci0KLQlhY3Rp
dmVfYm8gPSBOVUxMOwotCWlmIChjb3VudCkKLQkJYWN0aXZlX2JvID0ga2NhbGxvYyhjb3VudCwg
c2l6ZW9mKCphY3RpdmVfYm8pLCBHRlBfQVRPTUlDKTsKLQlpZiAoYWN0aXZlX2JvKQotCQljb3Vu
dCA9IGNhcHR1cmVfZXJyb3JfYm8oYWN0aXZlX2JvLAotCQkJCQkgY291bnQsICZ2bS0+Ym91bmRf
bGlzdCwKLQkJCQkJIEFDVElWRV9PTkxZKTsKLQllbHNlCi0JCWNvdW50ID0gMDsKLQotCWVycm9y
LT5hY3RpdmVfdm1baWR4XSA9IHZtOwotCWVycm9yLT5hY3RpdmVfYm9baWR4XSA9IGFjdGl2ZV9i
bzsKLQllcnJvci0+YWN0aXZlX2JvX2NvdW50W2lkeF0gPSBjb3VudDsKLX0KLQotc3RhdGljIHZv
aWQgY2FwdHVyZV9hY3RpdmVfYnVmZmVycyhzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKmVycm9yKQot
ewotCWludCBjbnQgPSAwLCBpLCBqOwotCi0JQlVJTERfQlVHX09OKEFSUkFZX1NJWkUoZXJyb3It
PmVuZ2luZSkgPiBBUlJBWV9TSVpFKGVycm9yLT5hY3RpdmVfYm8pKTsKLQlCVUlMRF9CVUdfT04o
QVJSQVlfU0laRShlcnJvci0+YWN0aXZlX2JvKSAhPSBBUlJBWV9TSVpFKGVycm9yLT5hY3RpdmVf
dm0pKTsKLQlCVUlMRF9CVUdfT04oQVJSQVlfU0laRShlcnJvci0+YWN0aXZlX2JvKSAhPSBBUlJB
WV9TSVpFKGVycm9yLT5hY3RpdmVfYm9fY291bnQpKTsKLQotCS8qIFNjYW4gZWFjaCBlbmdpbmUg
bG9va2luZyBmb3IgdW5pcXVlIGFjdGl2ZSBjb250ZXh0cy92bSAqLwotCWZvciAoaSA9IDA7IGkg
PCBBUlJBWV9TSVpFKGVycm9yLT5lbmdpbmUpOyBpKyspIHsKLQkJc3RydWN0IGRybV9pOTE1X2Vy
cm9yX2VuZ2luZSAqZWUgPSAmZXJyb3ItPmVuZ2luZVtpXTsKLQkJYm9vbCBmb3VuZDsKLQotCQlp
ZiAoIWVlLT52bSkKLQkJCWNvbnRpbnVlOworCQllZS0+d2FfY3R4ID0KKwkJCWk5MTVfZXJyb3Jf
b2JqZWN0X2NyZWF0ZShpOTE1LAorCQkJCQkJIGVuZ2luZS0+d2FfY3R4LnZtYSwKKwkJCQkJCSBj
b21wcmVzcyk7CiAKLQkJZm91bmQgPSBmYWxzZTsKLQkJZm9yIChqID0gMDsgaiA8IGkgJiYgIWZv
dW5kOyBqKyspCi0JCQlmb3VuZCA9IGVycm9yLT5lbmdpbmVbal0udm0gPT0gZWUtPnZtOwotCQlp
ZiAoIWZvdW5kKQotCQkJZ2VtX2NhcHR1cmVfdm0oZXJyb3IsIGVlLT52bSwgY250KyspOworCQll
ZS0+ZGVmYXVsdF9zdGF0ZSA9CisJCQljYXB0dXJlX29iamVjdChpOTE1LCBlbmdpbmUtPmRlZmF1
bHRfc3RhdGUsIGNvbXByZXNzKTsKIAl9CiB9CiAKLXN0YXRpYyB2b2lkIGNhcHR1cmVfcGlubmVk
X2J1ZmZlcnMoc3RydWN0IGk5MTVfZ3B1X3N0YXRlICplcnJvcikKLXsKLQlzdHJ1Y3QgaTkxNV9h
ZGRyZXNzX3NwYWNlICp2bSA9ICZlcnJvci0+aTkxNS0+Z2d0dC52bTsKLQlzdHJ1Y3QgZHJtX2k5
MTVfZXJyb3JfYnVmZmVyICpibzsKLQlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKLQlpbnQgY291bnQ7
Ci0KLQljb3VudCA9IDA7Ci0JbGlzdF9mb3JfZWFjaF9lbnRyeSh2bWEsICZ2bS0+Ym91bmRfbGlz
dCwgdm1fbGluaykKLQkJY291bnQrKzsKLQotCWJvID0gTlVMTDsKLQlpZiAoY291bnQpCi0JCWJv
ID0ga2NhbGxvYyhjb3VudCwgc2l6ZW9mKCpibyksIEdGUF9BVE9NSUMpOwotCWlmICghYm8pCi0J
CXJldHVybjsKLQotCWVycm9yLT5waW5uZWRfYm9fY291bnQgPQotCQljYXB0dXJlX2Vycm9yX2Jv
KGJvLCBjb3VudCwgJnZtLT5ib3VuZF9saXN0LCBQSU5ORURfT05MWSk7Ci0JZXJyb3ItPnBpbm5l
ZF9ibyA9IGJvOwotfQotCi1zdGF0aWMgdm9pZCBjYXB0dXJlX3VjX3N0YXRlKHN0cnVjdCBpOTE1
X2dwdV9zdGF0ZSAqZXJyb3IpCitzdGF0aWMgdm9pZAorY2FwdHVyZV91Y19zdGF0ZShzdHJ1Y3Qg
aTkxNV9ncHVfc3RhdGUgKmVycm9yLCBzdHJ1Y3QgY29tcHJlc3MgKmNvbXByZXNzKQogewogCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZXJyb3ItPmk5MTU7CiAJc3RydWN0IGk5MTVf
ZXJyb3JfdWMgKmVycm9yX3VjID0gJmVycm9yLT51YzsKQEAgLTE1NjYsOSArMTQ3NCwxMSBAQCBz
dGF0aWMgdm9pZCBjYXB0dXJlX3VjX3N0YXRlKHN0cnVjdCBpOTE1X2dwdV9zdGF0ZSAqZXJyb3Ip
CiAJICogQXMgbW9kcGFyYW1zIGFyZSBnZW5lcmFsbHkgYWNjZXNpYmxlIGZyb20gdGhlIHVzZXJz
cGFjZSBtYWtlCiAJICogZXhwbGljaXQgY29waWVzIG9mIHRoZSBmaXJtd2FyZSBwYXRocy4KIAkg
Ki8KLQllcnJvcl91Yy0+Z3VjX2Z3LnBhdGggPSBrc3RyZHVwKGk5MTUtPmd1Yy5mdy5wYXRoLCBH
RlBfQVRPTUlDKTsKLQllcnJvcl91Yy0+aHVjX2Z3LnBhdGggPSBrc3RyZHVwKGk5MTUtPmh1Yy5m
dy5wYXRoLCBHRlBfQVRPTUlDKTsKLQllcnJvcl91Yy0+Z3VjX2xvZyA9IGk5MTVfZXJyb3Jfb2Jq
ZWN0X2NyZWF0ZShpOTE1LCBpOTE1LT5ndWMubG9nLnZtYSk7CisJZXJyb3JfdWMtPmd1Y19mdy5w
YXRoID0ga3N0cmR1cChpOTE1LT5ndWMuZncucGF0aCwgQUxMT1dfRkFJTCk7CisJZXJyb3JfdWMt
Pmh1Y19mdy5wYXRoID0ga3N0cmR1cChpOTE1LT5odWMuZncucGF0aCwgQUxMT1dfRkFJTCk7CisJ
ZXJyb3JfdWMtPmd1Y19sb2cgPSBpOTE1X2Vycm9yX29iamVjdF9jcmVhdGUoaTkxNSwKKwkJCQkJ
CSAgICAgaTkxNS0+Z3VjLmxvZy52bWEsCisJCQkJCQkgICAgIGNvbXByZXNzKTsKIH0KIAogLyog
Q2FwdHVyZSBhbGwgcmVnaXN0ZXJzIHdoaWNoIGRvbid0IGZpdCBpbnRvIGFub3RoZXIgY2F0ZWdv
cnkuICovCkBAIC0xNzUyLDU2ICsxNjYyLDUzIEBAIHN0YXRpYyB2b2lkIGNhcHR1cmVfZmluaXNo
KHN0cnVjdCBpOTE1X2dwdV9zdGF0ZSAqZXJyb3IpCiAJZ2d0dC0+dm0uY2xlYXJfcmFuZ2UoJmdn
dHQtPnZtLCBzbG90LCBQQUdFX1NJWkUpOwogfQogCi1zdGF0aWMgaW50IGNhcHR1cmUodm9pZCAq
ZGF0YSkKLXsKLQlzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKmVycm9yID0gZGF0YTsKLQotCWVycm9y
LT50aW1lID0ga3RpbWVfZ2V0X3JlYWwoKTsKLQllcnJvci0+Ym9vdHRpbWUgPSBrdGltZV9nZXRf
Ym9vdHRpbWUoKTsKLQllcnJvci0+dXB0aW1lID0ga3RpbWVfc3ViKGt0aW1lX2dldCgpLAotCQkJ
CSAgZXJyb3ItPmk5MTUtPmd0Lmxhc3RfaW5pdF90aW1lKTsKLQllcnJvci0+Y2FwdHVyZSA9IGpp
ZmZpZXM7Ci0KLQljYXB0dXJlX3BhcmFtcyhlcnJvcik7Ci0JY2FwdHVyZV9nZW5fc3RhdGUoZXJy
b3IpOwotCWNhcHR1cmVfdWNfc3RhdGUoZXJyb3IpOwotCWNhcHR1cmVfcmVnX3N0YXRlKGVycm9y
KTsKLQlnZW1fcmVjb3JkX2ZlbmNlcyhlcnJvcik7Ci0JZ2VtX3JlY29yZF9yaW5ncyhlcnJvcik7
Ci0JY2FwdHVyZV9hY3RpdmVfYnVmZmVycyhlcnJvcik7Ci0JY2FwdHVyZV9waW5uZWRfYnVmZmVy
cyhlcnJvcik7Ci0KLQllcnJvci0+b3ZlcmxheSA9IGludGVsX292ZXJsYXlfY2FwdHVyZV9lcnJv
cl9zdGF0ZShlcnJvci0+aTkxNSk7Ci0JZXJyb3ItPmRpc3BsYXkgPSBpbnRlbF9kaXNwbGF5X2Nh
cHR1cmVfZXJyb3Jfc3RhdGUoZXJyb3ItPmk5MTUpOwotCi0JZXJyb3ItPmVwb2NoID0gY2FwdHVy
ZV9maW5kX2Vwb2NoKGVycm9yKTsKLQotCWNhcHR1cmVfZmluaXNoKGVycm9yKTsKLQlyZXR1cm4g
MDsKLX0KLQogI2RlZmluZSBEQVlfQVNfU0VDT05EUyh4KSAoMjQgKiA2MCAqIDYwICogKHgpKQog
CiBzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKgogaTkxNV9jYXB0dXJlX2dwdV9zdGF0ZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKmVycm9y
OworCXN0cnVjdCBjb21wcmVzcyBjb21wcmVzczsKIAogCS8qIENoZWNrIGlmIEdQVSBjYXB0dXJl
IGhhcyBiZWVuIGRpc2FibGVkICovCiAJZXJyb3IgPSBSRUFEX09OQ0UoaTkxNS0+Z3B1X2Vycm9y
LmZpcnN0X2Vycm9yKTsKIAlpZiAoSVNfRVJSKGVycm9yKSkKIAkJcmV0dXJuIGVycm9yOwogCi0J
ZXJyb3IgPSBremFsbG9jKHNpemVvZigqZXJyb3IpLCBHRlBfQVRPTUlDKTsKKwllcnJvciA9IGt6
YWxsb2Moc2l6ZW9mKCplcnJvciksIEFMTE9XX0ZBSUwpOwogCWlmICghZXJyb3IpIHsKIAkJaTkx
NV9kaXNhYmxlX2Vycm9yX3N0YXRlKGk5MTUsIC1FTk9NRU0pOwogCQlyZXR1cm4gRVJSX1BUUigt
RU5PTUVNKTsKIAl9CiAKKwlpZiAoIWNvbXByZXNzX2luaXQoJmNvbXByZXNzKSkgeworCQlrZnJl
ZShlcnJvcik7CisJCWk5MTVfZGlzYWJsZV9lcnJvcl9zdGF0ZShpOTE1LCAtRU5PTUVNKTsKKwkJ
cmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisJfQorCiAJa3JlZl9pbml0KCZlcnJvci0+cmVmKTsK
IAllcnJvci0+aTkxNSA9IGk5MTU7CiAKLQlzdG9wX21hY2hpbmUoY2FwdHVyZSwgZXJyb3IsIE5V
TEwpOworCWVycm9yLT50aW1lID0ga3RpbWVfZ2V0X3JlYWwoKTsKKwllcnJvci0+Ym9vdHRpbWUg
PSBrdGltZV9nZXRfYm9vdHRpbWUoKTsKKwllcnJvci0+dXB0aW1lID0ga3RpbWVfc3ViKGt0aW1l
X2dldCgpLCBpOTE1LT5ndC5sYXN0X2luaXRfdGltZSk7CisJZXJyb3ItPmNhcHR1cmUgPSBqaWZm
aWVzOworCisJY2FwdHVyZV9wYXJhbXMoZXJyb3IpOworCWNhcHR1cmVfZ2VuX3N0YXRlKGVycm9y
KTsKKwljYXB0dXJlX3VjX3N0YXRlKGVycm9yLCAmY29tcHJlc3MpOworCWNhcHR1cmVfcmVnX3N0
YXRlKGVycm9yKTsKKwlnZW1fcmVjb3JkX2ZlbmNlcyhlcnJvcik7CisJZ2VtX3JlY29yZF9yaW5n
cyhlcnJvciwgJmNvbXByZXNzKTsKKworCWVycm9yLT5vdmVybGF5ID0gaW50ZWxfb3ZlcmxheV9j
YXB0dXJlX2Vycm9yX3N0YXRlKGk5MTUpOworCWVycm9yLT5kaXNwbGF5ID0gaW50ZWxfZGlzcGxh
eV9jYXB0dXJlX2Vycm9yX3N0YXRlKGk5MTUpOworCisJZXJyb3ItPmVwb2NoID0gY2FwdHVyZV9m
aW5kX2Vwb2NoKGVycm9yKTsKKworCWNhcHR1cmVfZmluaXNoKGVycm9yKTsKKwljb21wcmVzc19m
aW5pKCZjb21wcmVzcyk7CiAKIAlyZXR1cm4gZXJyb3I7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9ncHVfZXJyb3IuaAppbmRleCAyZWNkMGM2YTFjOTQuLmVkNzE5YzhhNWJkNiAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3IuaAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5oCkBAIC04NCw3ICs4NCw2IEBAIHN0cnVjdCBpOTE1
X2dwdV9zdGF0ZSB7CiAJCS8qIFNvZnR3YXJlIHRyYWNrZWQgc3RhdGUgKi8KIAkJYm9vbCBpZGxl
OwogCQl1bnNpZ25lZCBsb25nIGhhbmdjaGVja190aW1lc3RhbXA7Ci0JCXN0cnVjdCBpOTE1X2Fk
ZHJlc3Nfc3BhY2UgKnZtOwogCQlpbnQgbnVtX3JlcXVlc3RzOwogCQl1MzIgcmVzZXRfY291bnQ7
CiAKQEAgLTE2MCwyMiArMTU5LDYgQEAgc3RydWN0IGk5MTVfZ3B1X3N0YXRlIHsKIAkJfSB2bV9p
bmZvOwogCX0gZW5naW5lW0k5MTVfTlVNX0VOR0lORVNdOwogCi0Jc3RydWN0IGRybV9pOTE1X2Vy
cm9yX2J1ZmZlciB7Ci0JCXUzMiBzaXplOwotCQl1MzIgbmFtZTsKLQkJdTY0IGd0dF9vZmZzZXQ7
Ci0JCXUzMiByZWFkX2RvbWFpbnM7Ci0JCXUzMiB3cml0ZV9kb21haW47Ci0JCXMzMiBmZW5jZV9y
ZWc6STkxNV9NQVhfTlVNX0ZFTkNFX0JJVFM7Ci0JCXUzMiB0aWxpbmc6MjsKLQkJdTMyIGRpcnR5
OjE7Ci0JCXUzMiBwdXJnZWFibGU6MTsKLQkJdTMyIHVzZXJwdHI6MTsKLQkJdTMyIGNhY2hlX2xl
dmVsOjM7Ci0JfSAqYWN0aXZlX2JvW0k5MTVfTlVNX0VOR0lORVNdLCAqcGlubmVkX2JvOwotCXUz
MiBhY3RpdmVfYm9fY291bnRbSTkxNV9OVU1fRU5HSU5FU10sIHBpbm5lZF9ib19jb3VudDsKLQlz
dHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICphY3RpdmVfdm1bSTkxNV9OVU1fRU5HSU5FU107Ci0K
IAlzdHJ1Y3Qgc2NhdHRlcmxpc3QgKnNnbCwgKmZpdDsKIH07CiAKLS0gCjIuMjIuMAoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxp
bmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

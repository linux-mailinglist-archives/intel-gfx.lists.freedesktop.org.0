Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 67724EA404
	for <lists+intel-gfx@lfdr.de>; Wed, 30 Oct 2019 20:22:48 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9A2976ED0B;
	Wed, 30 Oct 2019 19:22:46 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E39796EB50
 for <intel-gfx@lists.freedesktop.org>; Wed, 30 Oct 2019 19:22:14 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19024459-1500050 
 for multiple; Wed, 30 Oct 2019 19:22:01 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 30 Oct 2019 19:21:53 +0000
Message-Id: <20191030192159.18404-5-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0.rc1
In-Reply-To: <20191030192159.18404-1-chris@chris-wilson.co.uk>
References: <20191030192159.18404-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 05/11] drm/i915: Defer rc6 shutdown to
 suspend_late
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q3VycmVudGx5IHdlIHNodXRkb3duIHJjNiBkdXJpbmcgaTkxNV9nZW1fcmVzdW1lKCkgYnV0IHRo
aXMgaXMgY2FsbGVkCmR1cmluZyB0aGUgcHJlcGFyYXRpb24gcGhhc2UgKGk5MTVfZHJtX3ByZXBh
cmUpIGZvciBhbGwgc3VzcGVuZCBwYXRocywKYnV0IHdlIG9ubHkgd2FudCB0byBzaHV0ZG93biBy
YzYgZm9yIFMzKy4gTW92ZSB0aGUgYWN0dWFsIHNodXRkb3duIHRvCmk5MTVfZ2VtX3N1c3BlbmRf
bGF0ZSgpLgoKV2UgdGhlbiBuZWVkIHRvIGRpZmZlcmVudGlhdGUgYmV0d2VlbiBzdXNwZW5kIHRh
cmdldHMsIHRvIGRpc3Rpbmd1aXNoIFMwCihzMmlkbGUpIHdoZXJlIHRoZSBkZXZpY2UgaXMga2Vw
dCBhd2FrZSBidXQgbmVlZHMgdG8gYmUgaW4gYSBsb3cgcG93ZXIKbW9kZSAodGhlIHNhbWUgYXMg
cnVudGltZSBzdXNwZW5kKSBmcm9tIHRoZSBkZXZpY2Ugc3VzcGVuZCBsZXZlbHMgd2hlcmUKd2Ug
bG9zZSBjb250cm9sIG9mIEhXIGFuZCBzbyBtdXN0IGRpc2FibGUgYW55IEhXIGFjY2VzcyB0byBk
YW5nbGluZwptZW1vcnkuCgpCdWd6aWxsYTogaHR0cHM6Ly9idWdzLmZyZWVkZXNrdG9wLm9yZy9z
aG93X2J1Zy5jZ2k/aWQ9MTExOTA5CkZpeGVzOiBjMTEzMjM2NzE4ZTggKCJkcm0vaTkxNTogRXh0
cmFjdCBHVCByZW5kZXIgc2xlZXAgKHJjNikgbWFuYWdlbWVudCIpClRlc3RjYXNlOiBpZ3QvZ2Vt
X2V4ZWNfc3VzcGVuZC9wb3dlci1TMApTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlz
QGNocmlzLXdpbHNvbi5jby51az4KQ2M6IEFuZGkgU2h5dGkgPGFuZGkuc2h5dGlAaW50ZWwuY29t
PgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jICAgfCAgNCArKy0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmMgICAgfCAzOSArKysrKysrKysr
KysrKysrKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmggICAg
fCAgMyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmM2LmMgICAgICB8ICA1ICsr
KwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZ3RfcG0uYyB8ICAyICstCiA1IGZp
bGVzIGNoYW5nZWQsIDQ0IGluc2VydGlvbnMoKyksIDkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYwppbmRleCA2Nzc5YWIzNDEwMWIuLmY4OGVlMTMxN2Ji
NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKQEAgLTI3LDcgKzI3LDcg
QEAgdm9pZCBpOTE1X2dlbV9zdXNwZW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
CSAqIHN0YXRlLiBGb3J0dW5hdGVseSwgdGhlIGtlcm5lbF9jb250ZXh0IGlzIGRpc3Bvc2FibGUg
YW5kIHdlIGRvCiAJICogbm90IHJlbHkgb24gaXRzIHN0YXRlLgogCSAqLwotCWludGVsX2d0X3N1
c3BlbmQoJmk5MTUtPmd0KTsKKwlpbnRlbF9ndF9zdXNwZW5kX3ByZXBhcmUoJmk5MTUtPmd0KTsK
IAogCWk5MTVfZ2VtX2RyYWluX2ZyZWVkX29iamVjdHMoaTkxNSk7CiB9CkBAIC02OSw2ICs2OSw4
IEBAIHZvaWQgaTkxNV9nZW1fc3VzcGVuZF9sYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQogCSAqIG1hY2hpbmUgaW4gYW4gdW51c2FibGUgY29uZGl0aW9uLgogCSAqLwogCisJaW50
ZWxfZ3Rfc3VzcGVuZF9sYXRlKCZpOTE1LT5ndCk7CisKIAlzcGluX2xvY2tfaXJxc2F2ZSgmaTkx
NS0+bW0ub2JqX2xvY2ssIGZsYWdzKTsKIAlmb3IgKHBoYXNlID0gcGhhc2VzOyAqcGhhc2U7IHBo
YXNlKyspIHsKIAkJTElTVF9IRUFEKGtlZXApOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfZ3RfcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0
X3BtLmMKaW5kZXggMTE2NjFkZThjNDBiLi5iNjBiMmRmYjRmZWEgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZ3RfcG0uYwpAQCAtNCw2ICs0LDggQEAKICAqIENvcHlyaWdodCDCqSAyMDE5
IEludGVsIENvcnBvcmF0aW9uCiAgKi8KIAorI2luY2x1ZGUgPGxpbnV4L3N1c3BlbmQuaD4KKwog
I2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAjaW5jbHVkZSAiaTkxNV9nbG9iYWxzLmgiCiAjaW5jbHVk
ZSAiaTkxNV9wYXJhbXMuaCIKQEAgLTIzNiw4ICsyMzgsMTMgQEAgaW50IGludGVsX2d0X3Jlc3Vt
ZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogCXJldHVybiBlcnI7CiB9CiAKLXN0YXRpYyB2b2lkIHdh
aXRfZm9yX2lkbGUoc3RydWN0IGludGVsX2d0ICpndCkKK3ZvaWQgaW50ZWxfZ3Rfc3VzcGVuZF9w
cmVwYXJlKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiB7CisJaWYgKCFpbnRlbF9ndF9wbV9pc19hd2Fr
ZShndCkpCisJCXJldHVybjsKKworCXVzZXJfZm9yY2V3YWtlKGd0LCB0cnVlKTsKKwogCWlmIChp
bnRlbF9ndF93YWl0X2Zvcl9pZGxlKGd0LCBJOTE1X0dFTV9JRExFX1RJTUVPVVQpID09IC1FVElN
RSkgewogCQkvKgogCQkgKiBGb3JjaWJseSBjYW5jZWwgb3V0c3RhbmRpbmcgd29yayBhbmQgbGVh
dmUKQEAgLTI0NywxOCArMjU0LDM4IEBAIHN0YXRpYyB2b2lkIHdhaXRfZm9yX2lkbGUoc3RydWN0
IGludGVsX2d0ICpndCkKIAl9CiAKIAlpbnRlbF9ndF9wbV93YWl0X2Zvcl9pZGxlKGd0KTsKKwor
CWludGVsX3VjX3N1c3BlbmQoJmd0LT51Yyk7CiB9CiAKLXZvaWQgaW50ZWxfZ3Rfc3VzcGVuZChz
dHJ1Y3QgaW50ZWxfZ3QgKmd0KQorc3RhdGljIHN1c3BlbmRfc3RhdGVfdCBwbV9zdXNwZW5kX3Rh
cmdldCh2b2lkKQogewotCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOworI2lmIElTX0VOQUJMRUQo
Q09ORklHX1BNX1NMRUVQKQorCXJldHVybiBwbV9zdXNwZW5kX3RhcmdldF9zdGF0ZTsKKyNlbHNl
CisJcmV0dXJuIFBNX1NVU1BFTkRfVE9fSURMRTsKKyNlbmRpZgorfQogCi0JdXNlcl9mb3JjZXdh
a2UoZ3QsIHRydWUpOwordm9pZCBpbnRlbF9ndF9zdXNwZW5kX2xhdGUoc3RydWN0IGludGVsX2d0
ICpndCkKK3sKKwlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAogCS8qIFdlIGV4cGVjdCB0byBi
ZSBpZGxlIGFscmVhZHk7IGJ1dCBhbHNvIHdhbnQgdG8gYmUgaW5kZXBlbmRlbnQgKi8KLQl3YWl0
X2Zvcl9pZGxlKGd0KTsKKwlpbnRlbF9ndF9zdXNwZW5kX3ByZXBhcmUoZ3QpOwogCi0JaW50ZWxf
dWNfc3VzcGVuZCgmZ3QtPnVjKTsKKwkvKgorCSAqIE9uIGRpc2FibGluZyB0aGUgZGV2aWNlLCB3
ZSB3YW50IHRvIHR1cm4gb2ZmIEhXIGFjY2VzcyB0byBtZW1vcnkKKwkgKiB0aGF0IHdlIG5vIGxv
bmdlciBvd24uCisJICoKKwkgKiBIb3dldmVyLCBub3QgYWxsIHN1c3BlbmQtc3RhdGVzIGRpc2Fi
bGUgdGhlIGRldmljZS4gUzAgKHMyaWRsZSkKKwkgKiBpcyBlZmZlY3RpdmVseSBydW50aW1lLXN1
c3BlbmQsIHRoZSBkZXZpY2UgaXMgbGVmdCBwb3dlcmVkIG9uCisJICogYnV0IG5lZWRzIHRvIGJl
IHB1dCBpbnRvIGEgbG93IHBvd2VyIHN0YXRlLiBXZSBuZWVkIHRvIGtlZXAKKwkgKiBwb3dlcm1h
bmFnZW1lbnQgZW5hYmxlZCwgYnV0IHdlIGFsc28gcmV0YWluIHN5c3RlbSBzdGF0ZSBhbmQgc28K
KwkgKiBpdCByZW1haW5zIHNhZmUgdG8ga2VlcCBvbiB1c2luZyBvdXIgYWxsb2NhdGVkIG1lbW9y
eS4KKwkgKi8KKwlpZiAocG1fc3VzcGVuZF90YXJnZXQoKSA9PSBQTV9TVVNQRU5EX1RPX0lETEUp
CisJCXJldHVybjsKIAogCXdpdGhfaW50ZWxfcnVudGltZV9wbShndC0+dW5jb3JlLT5ycG0sIHdh
a2VyZWYpIHsKIAkJaW50ZWxfcnBzX2Rpc2FibGUoJmd0LT5ycHMpOwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2d0X3BtLmgKaW5kZXggZDkyNGM5ODRjNzRkLi5iM2UxNzM5OWJlOWIgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmgKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uaApAQCAtNDMsOCArNDMsOSBAQCB2b2lkIGlu
dGVsX2d0X3BtX2Zpbmkoc3RydWN0IGludGVsX2d0ICpndCk7CiAKIHZvaWQgaW50ZWxfZ3Rfc2Fu
aXRpemUoc3RydWN0IGludGVsX2d0ICpndCwgYm9vbCBmb3JjZSk7CiAKK3ZvaWQgaW50ZWxfZ3Rf
c3VzcGVuZF9wcmVwYXJlKHN0cnVjdCBpbnRlbF9ndCAqZ3QpOwordm9pZCBpbnRlbF9ndF9zdXNw
ZW5kX2xhdGUoc3RydWN0IGludGVsX2d0ICpndCk7CiBpbnQgaW50ZWxfZ3RfcmVzdW1lKHN0cnVj
dCBpbnRlbF9ndCAqZ3QpOwotdm9pZCBpbnRlbF9ndF9zdXNwZW5kKHN0cnVjdCBpbnRlbF9ndCAq
Z3QpOwogCiB2b2lkIGludGVsX2d0X3J1bnRpbWVfc3VzcGVuZChzdHJ1Y3QgaW50ZWxfZ3QgKmd0
KTsKIGludCBpbnRlbF9ndF9ydW50aW1lX3Jlc3VtZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0KTsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JjNi5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmM2LmMKaW5kZXggNzBmMGUwMWEzOGI5Li41YWQ0YTkyYTk1
ODIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JjNi5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JjNi5jCkBAIC01MjUsNiArNTI1LDExIEBA
IHZvaWQgaW50ZWxfcmM2X2luaXQoc3RydWN0IGludGVsX3JjNiAqcmM2KQogCiB2b2lkIGludGVs
X3JjNl9zYW5pdGl6ZShzdHJ1Y3QgaW50ZWxfcmM2ICpyYzYpCiB7CisJaWYgKHJjNi0+ZW5hYmxl
ZCkgeyAvKiB1bmJhbGFuY2VkIHN1c3BlbmQvcmVzdW1lICovCisJCXJwbV9nZXQocmM2KTsKKwkJ
cmM2LT5lbmFibGVkID0gZmFsc2U7CisJfQorCiAJaWYgKHJjNi0+c3VwcG9ydGVkKQogCQlfX2lu
dGVsX3JjNl9kaXNhYmxlKHJjNik7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF9ndF9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
Z3RfcG0uYwppbmRleCA1ZDQyOTAzN2NkYWQuLjNkNGU2YTAwOGFmOCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZ3RfcG0uYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF9ndF9wbS5jCkBAIC0xNSw3ICsxNSw3IEBAIHN0YXRpYyBpbnQg
bGl2ZV9ndF9yZXN1bWUodm9pZCAqYXJnKQogCiAJLyogRG8gc2V2ZXJhbCBzdXNwZW5kL3Jlc3Vt
ZSBjeWNsZXMgdG8gY2hlY2sgd2UgZG9uJ3QgZXhwbG9kZSEgKi8KIAlkbyB7Ci0JCWludGVsX2d0
X3N1c3BlbmQoZ3QpOworCQlpbnRlbF9ndF9zdXNwZW5kX2xhdGUoZ3QpOwogCiAJCWlmIChndC0+
cmM2LmVuYWJsZWQpIHsKIAkJCXByX2VycigicmM2IHN0aWxsIGVuYWJsZWQgYWZ0ZXIgc3VzcGVu
ZCFcbiIpOwotLSAKMi4yNC4wLnJjMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGlu
Zm8vaW50ZWwtZ2Z4

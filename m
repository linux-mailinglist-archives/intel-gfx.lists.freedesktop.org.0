Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 293F866F7A
	for <lists+intel-gfx@lfdr.de>; Fri, 12 Jul 2019 15:04:05 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 753986E02B;
	Fri, 12 Jul 2019 13:04:03 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga18.intel.com (mga18.intel.com [134.134.136.126])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2B3286E02B
 for <intel-gfx@lists.freedesktop.org>; Fri, 12 Jul 2019 13:04:02 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga006.fm.intel.com ([10.253.24.20])
 by orsmga106.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 12 Jul 2019 06:04:01 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,482,1557212400"; d="scan'208";a="365600209"
Received: from etotmeni-mobl.ccr.corp.intel.com ([10.249.254.211])
 by fmsmga006.fm.intel.com with ESMTP; 12 Jul 2019 06:03:57 -0700
To: Chris Wilson <chris@chris-wilson.co.uk>, intel-gfx@lists.freedesktop.org
References: <20190712112725.2892-1-chris@chris-wilson.co.uk>
 <20190712112725.2892-2-chris@chris-wilson.co.uk>
From: Abdiel Janulgue <abdiel.janulgue@linux.intel.com>
Message-ID: <e284a8ef-df37-ef54-e42f-40faada56a2e@linux.intel.com>
Date: Fri, 12 Jul 2019 16:03:56 +0300
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:60.0)
 Gecko/20100101 Thunderbird/60.7.2
MIME-Version: 1.0
In-Reply-To: <20190712112725.2892-2-chris@chris-wilson.co.uk>
Content-Language: en-US
Subject: Re: [Intel-gfx] [PATCH 1/4] drm/i915/gtt: Recursive cleanup for gen8
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

CgpPbiAxMi8wNy8yMDE5IDE0LjI3LCBDaHJpcyBXaWxzb24gd3JvdGU6Cj4gV2l0aCBhbiBleHBs
aWNpdCBsZXZlbCwgd2UgY2FuIHJlZmFjdG9yIHRoZSBzZXBhcmF0ZSBjbGVhbnVwIGZ1bmN0aW9u
cwo+IGFzIGEgc2ltcGxlIHJlY3Vyc2l2ZSBmdW5jdGlvbi4gV2UgdGFrZSB0aGUgb3Bwb3J0dW5p
dHkgdG8gcGFzcyBkb3duIHRoZQo+IHNpemUgb2YgZWFjaCBsZXZlbCBzbyB0aGF0IHdlIGNhbiBk
ZWFsIHdpdGggdGhlIGRpZmZlcmVudCBzaXplcyBvZgo+IHRvcC1sZXZlbCBhbmQgYXZvaWQgb3Zl
ciBhbGxvY2F0aW5nIGZvciAzMi8zNi1iaXQgdm0uCj4gCj4gU2lnbmVkLW9mZi1ieTogQ2hyaXMg
V2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Cj4gLS0tCgpSZXZpZXdlZC1ieTogQWJk
aWVsIEphbnVsZ3VlIDxhYmRpZWwuamFudWxndWVAbGludXguaW50ZWwuY29tPgoKUmVnYXJkcywK
QWJkaWVsCgoKPiAgZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMgfCA5MyArKysr
KysrKysrLS0tLS0tLS0tLS0tLS0tLS0tLQo+ICBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dl
bV9ndHQuaCB8ICAyICstCj4gIDIgZmlsZXMgY2hhbmdlZCwgMzMgaW5zZXJ0aW9ucygrKSwgNjIg
ZGVsZXRpb25zKC0pCj4gCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
Z2VtX2d0dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKPiBpbmRleCA3
NTMwOTBhNzcyOWUuLjMwNWM2NWMwOGE2YSAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbV9ndHQuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2Vt
X2d0dC5jCj4gQEAgLTcxMywxMSArNzEzLDExIEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV9wYWdlX3Rh
YmxlICphbGxvY19wdChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKPiAgCXJldHVybiBw
dDsKPiAgfQo+ICAKPiAtc3RhdGljIHN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICpfX2FsbG9j
X3BkKHZvaWQpCj4gK3N0YXRpYyBzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVjdG9yeSAqX19hbGxvY19w
ZChzaXplX3Qgc3opCj4gIHsKPiAgCXN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICpwZDsKPiAg
Cj4gLQlwZCA9IGt6YWxsb2Moc2l6ZW9mKCpwZCksIEk5MTVfR0ZQX0FMTE9XX0ZBSUwpOwo+ICsJ
cGQgPSBremFsbG9jKHN6LCBJOTE1X0dGUF9BTExPV19GQUlMKTsKPiAgCWlmICh1bmxpa2VseSgh
cGQpKQo+ICAJCXJldHVybiBOVUxMOwo+ICAKPiBAQCAtNzI5LDcgKzcyOSw3IEBAIHN0YXRpYyBz
dHJ1Y3QgaTkxNV9wYWdlX2RpcmVjdG9yeSAqYWxsb2NfcGQoc3RydWN0IGk5MTVfYWRkcmVzc19z
cGFjZSAqdm0pCj4gIHsKPiAgCXN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICpwZDsKPiAgCj4g
LQlwZCA9IF9fYWxsb2NfcGQoKTsKPiArCXBkID0gX19hbGxvY19wZChzaXplb2YoKnBkKSk7Cj4g
IAlpZiAodW5saWtlbHkoIXBkKSkKPiAgCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKPiAgCj4g
QEAgLTc2Niw3ICs3NjYsNyBAQCBfX3NldF9wZF9lbnRyeShzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVj
dG9yeSAqIGNvbnN0IHBkLAo+ICAJICAgICAgIHN0cnVjdCBpOTE1X3BhZ2VfZG1hICogY29uc3Qg
dG8sCj4gIAkgICAgICAgdTY0ICgqZW5jb2RlKShjb25zdCBkbWFfYWRkcl90LCBjb25zdCBlbnVt
IGk5MTVfY2FjaGVfbGV2ZWwpKQo+ICB7Cj4gLQlHRU1fQlVHX09OKGF0b21pY19yZWFkKHB4X3Vz
ZWQocGQpKSA+IDUxMik7Cj4gKwlHRU1fQlVHX09OKGF0b21pY19yZWFkKHB4X3VzZWQocGQpKSA+
IEFSUkFZX1NJWkUocGQtPmVudHJ5KSk7Cj4gIAo+ICAJYXRvbWljX2luYyhweF91c2VkKHBkKSk7
Cj4gIAlwZC0+ZW50cnlbaWR4XSA9IHRvOwo+IEBAIC04OTYsNjQgKzg5NiwzNCBAQCBzdGF0aWMg
aW5saW5lIHVuc2lnbmVkIGludCBnZW44X3B0X2NvdW50KHU2NCBzdGFydCwgdTY0IGVuZCkKPiAg
CQlyZXR1cm4gZW5kIC0gc3RhcnQ7Cj4gIH0KPiAgCj4gLXN0YXRpYyB2b2lkIGdlbjhfZnJlZV9w
YWdlX3RhYmxlcyhzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKPiAtCQkJCSAgc3RydWN0
IGk5MTVfcGFnZV9kaXJlY3RvcnkgKnBkKQo+ICtzdGF0aWMgdm9pZCBfX2dlbjhfcHBndHRfY2xl
YW51cChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKPiArCQkJCSBzdHJ1Y3QgaTkxNV9w
YWdlX2RpcmVjdG9yeSAqcGQsCj4gKwkJCQkgaW50IGNvdW50LCBpbnQgbHZsKQo+ICB7Cj4gLQlp
bnQgaTsKPiAtCj4gLQlmb3IgKGkgPSAwOyBpIDwgSTkxNV9QREVTOyBpKyspIHsKPiAtCQlpZiAo
cGQtPmVudHJ5W2ldKQo+IC0JCQlmcmVlX3BkKHZtLCBwZC0+ZW50cnlbaV0pOwo+IC0JfQo+IC19
Cj4gLQo+IC1zdGF0aWMgdm9pZCBnZW44X3BwZ3R0X2NsZWFudXBfM2x2bChzdHJ1Y3QgaTkxNV9h
ZGRyZXNzX3NwYWNlICp2bSwKPiAtCQkJCSAgICBzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVjdG9yeSAq
cGRwKQo+IC17Cj4gLQljb25zdCB1bnNpZ25lZCBpbnQgcGRwZXMgPSBpOTE1X3BkcGVzX3Blcl9w
ZHAodm0pOwo+IC0JaW50IGk7Cj4gLQo+IC0JZm9yIChpID0gMDsgaSA8IHBkcGVzOyBpKyspIHsK
PiAtCQlpZiAoIXBkcC0+ZW50cnlbaV0pCj4gLQkJCWNvbnRpbnVlOwo+IC0KPiAtCQlnZW44X2Zy
ZWVfcGFnZV90YWJsZXModm0sIHBkcC0+ZW50cnlbaV0pOwo+IC0JCWZyZWVfcGQodm0sIHBkcC0+
ZW50cnlbaV0pOwo+IC0JfQo+IC0KPiAtCWZyZWVfcHgodm0sIHBkcCk7Cj4gLX0KPiAtCj4gLXN0
YXRpYyB2b2lkIGdlbjhfcHBndHRfY2xlYW51cF80bHZsKHN0cnVjdCBpOTE1X3BwZ3R0ICpwcGd0
dCkKPiAtewo+IC0Jc3RydWN0IGk5MTVfcGFnZV9kaXJlY3RvcnkgKiBjb25zdCBwbWw0ID0gcHBn
dHQtPnBkOwo+IC0JaW50IGk7Cj4gLQo+IC0JZm9yIChpID0gMDsgaSA8IEdFTjhfUE1MNEVTX1BF
Ul9QTUw0OyBpKyspIHsKPiAtCQlzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVjdG9yeSAqcGRwID0gaTkx
NV9wZHBfZW50cnkocG1sNCwgaSk7Cj4gKwlpZiAobHZsKSB7Cj4gKwkJdm9pZCAqKnBkZSA9IHBk
LT5lbnRyeTsKPiAgCj4gLQkJaWYgKCFwZHApCj4gLQkJCWNvbnRpbnVlOwo+ICsJCWRvIHsKPiAr
CQkJaWYgKCEqcGRlKQo+ICsJCQkJY29udGludWU7Cj4gIAo+IC0JCWdlbjhfcHBndHRfY2xlYW51
cF8zbHZsKCZwcGd0dC0+dm0sIHBkcCk7Cj4gKwkJCV9fZ2VuOF9wcGd0dF9jbGVhbnVwKHZtLCAq
cGRlLCBJOTE1X1BERVMsIGx2bCAtIDEpOwo+ICsJCX0gd2hpbGUgKHBkZSsrLCAtLWNvdW50KTsK
PiAgCX0KPiAgCj4gLQlmcmVlX3B4KCZwcGd0dC0+dm0sIHBtbDQpOwo+ICsJZnJlZV9weCh2bSwg
cGQpOwo+ICB9Cj4gIAo+ICBzdGF0aWMgdm9pZCBnZW44X3BwZ3R0X2NsZWFudXAoc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqdm0pCj4gIHsKPiAtCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gdm0tPmk5MTU7Cj4gIAlzdHJ1Y3QgaTkxNV9wcGd0dCAqcHBndHQgPSBpOTE1X3ZtX3Rv
X3BwZ3R0KHZtKTsKPiAgCj4gLQlpZiAoaW50ZWxfdmdwdV9hY3RpdmUoaTkxNSkpCj4gKwlpZiAo
aW50ZWxfdmdwdV9hY3RpdmUodm0tPmk5MTUpKQo+ICAJCWdlbjhfcHBndHRfbm90aWZ5X3ZndChw
cGd0dCwgZmFsc2UpOwo+ICAKPiAtCWlmIChpOTE1X3ZtX2lzXzRsdmwodm0pKQo+IC0JCWdlbjhf
cHBndHRfY2xlYW51cF80bHZsKHBwZ3R0KTsKPiAtCWVsc2UKPiAtCQlnZW44X3BwZ3R0X2NsZWFu
dXBfM2x2bCgmcHBndHQtPnZtLCBwcGd0dC0+cGQpOwo+IC0KPiArCV9fZ2VuOF9wcGd0dF9jbGVh
bnVwKHZtLCBwcGd0dC0+cGQsCj4gKwkJCSAgICAgdm0tPnRvdGFsID4+IF9fZ2VuOF9wdGVfc2hp
ZnQodm0tPnRvcCksCj4gKwkJCSAgICAgdm0tPnRvcCk7Cj4gIAlmcmVlX3NjcmF0Y2godm0pOwo+
ICB9Cj4gIAo+IEBAIC0xNTA1LDI0ICsxNDc1LDE4IEBAIHN0YXRpYyBpbnQgZ2VuOF9wcmVhbGxv
Y2F0ZV90b3BfbGV2ZWxfcGRwKHN0cnVjdCBpOTE1X3BwZ3R0ICpwcGd0dCkKPiAgCXN0cnVjdCBp
OTE1X3BhZ2VfZGlyZWN0b3J5ICpwZHAgPSBwcGd0dC0+cGQ7Cj4gIAlzdHJ1Y3QgaTkxNV9wYWdl
X2RpcmVjdG9yeSAqcGQ7Cj4gIAl1NjQgc3RhcnQgPSAwLCBsZW5ndGggPSBwcGd0dC0+dm0udG90
YWw7Cj4gLQl1NjQgZnJvbSA9IHN0YXJ0Owo+ICAJdW5zaWduZWQgaW50IHBkcGU7Cj4gIAo+ICAJ
Z2VuOF9mb3JfZWFjaF9wZHBlKHBkLCBwZHAsIHN0YXJ0LCBsZW5ndGgsIHBkcGUpIHsKPiAgCQlw
ZCA9IGFsbG9jX3BkKHZtKTsKPiAgCQlpZiAoSVNfRVJSKHBkKSkKPiAtCQkJZ290byB1bndpbmQ7
Cj4gKwkJCXJldHVybiBQVFJfRVJSKHBkKTsKPiAgCj4gIAkJZmlsbF9weChwZCwgdm0tPnNjcmF0
Y2hbMV0uZW5jb2RlKTsKPiAgCQlzZXRfcGRfZW50cnkocGRwLCBwZHBlLCBwZCk7Cj4gIAl9Cj4g
IAo+ICAJcmV0dXJuIDA7Cj4gLQo+IC11bndpbmQ6Cj4gLQlnZW44X3BwZ3R0X2NsZWFyX3BkcCh2
bSwgcGRwLCBmcm9tLCBzdGFydCAtIGZyb20pOwo+IC0JYXRvbWljX3NldChweF91c2VkKHBkcCks
IDApOwo+IC0JcmV0dXJuIC1FTk9NRU07Cj4gIH0KPiAgCj4gIHN0YXRpYyB2b2lkIHBwZ3R0X2lu
aXQoc3RydWN0IGk5MTVfcHBndHQgKnBwZ3R0LCBzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQo+IEBAIC0x
NTUwLDkgKzE1MTQsMTQgQEAgZ2VuOF9hbGxvY190b3BfcGQoc3RydWN0IGk5MTVfYWRkcmVzc19z
cGFjZSAqdm0pCj4gIAo+ICAJR0VNX0JVR19PTihjb3VudCA+IEFSUkFZX1NJWkUocGQtPmVudHJ5
KSk7Cj4gIAo+IC0JcGQgPSBhbGxvY19wZCh2bSk7Cj4gLQlpZiAoSVNfRVJSKHBkKSkKPiAtCQly
ZXR1cm4gcGQ7Cj4gKwlwZCA9IF9fYWxsb2NfcGQob2Zmc2V0b2YodHlwZW9mKCpwZCksIGVudHJ5
W2NvdW50XSkpOwo+ICsJaWYgKHVubGlrZWx5KCFwZCkpCj4gKwkJcmV0dXJuIEVSUl9QVFIoLUVO
T01FTSk7Cj4gKwo+ICsJaWYgKHVubGlrZWx5KHNldHVwX3BhZ2VfZG1hKHZtLCBweF9iYXNlKHBk
KSkpKSB7Cj4gKwkJa2ZyZWUocGQpOwo+ICsJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwo+ICsJ
fQo+ICAKPiAgCWZpbGxfcGFnZV9kbWEocHhfYmFzZShwZCksIHZtLT5zY3JhdGNoW3ZtLT50b3Bd
LmVuY29kZSwgY291bnQpOwo+ICAJcmV0dXJuIHBkOwo+IEBAIC0xNjI1LDcgKzE1OTQsOSBAQCBz
dGF0aWMgc3RydWN0IGk5MTVfcHBndHQgKmdlbjhfcHBndHRfY3JlYXRlKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQo+ICAJcmV0dXJuIHBwZ3R0Owo+ICAKPiAgZXJyX2ZyZWVfcGQ6Cj4g
LQlmcmVlX3B4KCZwcGd0dC0+dm0sIHBwZ3R0LT5wZCk7Cj4gKwlfX2dlbjhfcHBndHRfY2xlYW51
cCgmcHBndHQtPnZtLCBwcGd0dC0+cGQsCj4gKwkJCSAgICAgcHBndHQtPnZtLnRvdGFsID4+IF9f
Z2VuOF9wdGVfc2hpZnQocHBndHQtPnZtLnRvcCksCj4gKwkJCSAgICAgcHBndHQtPnZtLnRvcCk7
Cj4gIGVycl9mcmVlX3NjcmF0Y2g6Cj4gIAlmcmVlX3NjcmF0Y2goJnBwZ3R0LT52bSk7Cj4gIGVy
cl9mcmVlOgo+IEBAIC0yMDcxLDcgKzIwNDIsNyBAQCBzdGF0aWMgc3RydWN0IGk5MTVfcHBndHQg
KmdlbjZfcHBndHRfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQo+ICAKPiAg
CXBwZ3R0LT5iYXNlLnZtLnB0ZV9lbmNvZGUgPSBnZ3R0LT52bS5wdGVfZW5jb2RlOwo+ICAKPiAt
CXBwZ3R0LT5iYXNlLnBkID0gX19hbGxvY19wZCgpOwo+ICsJcHBndHQtPmJhc2UucGQgPSBfX2Fs
bG9jX3BkKHNpemVvZigqcHBndHQtPmJhc2UucGQpKTsKPiAgCWlmICghcHBndHQtPmJhc2UucGQp
IHsKPiAgCQllcnIgPSAtRU5PTUVNOwo+ICAJCWdvdG8gZXJyX2ZyZWU7Cj4gZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW1fZ3R0LmgKPiBpbmRleCBiMzBmZmUzMzM4NTIuLmFlYTlhNzA4NDQxNCAxMDA2
NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaAo+ICsrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oCj4gQEAgLTI1Miw3ICsyNTIsNyBAQCBz
dHJ1Y3QgaTkxNV9wYWdlX3RhYmxlIHsKPiAgc3RydWN0IGk5MTVfcGFnZV9kaXJlY3Rvcnkgewo+
ICAJc3RydWN0IGk5MTVfcGFnZV90YWJsZSBwdDsKPiAgCXNwaW5sb2NrX3QgbG9jazsKPiAtCXZv
aWQgKmVudHJ5WzUxMl07Cj4gKwl2b2lkICplbnRyeVtJOTE1X1BERVNdOwo+ICB9Owo+ICAKPiAg
I2RlZmluZSBfX3B4X2Nob29zZV9leHByKHgsIHR5cGUsIGV4cHIsIG90aGVyKSBcCj4gCl9fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWls
aW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZy
ZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

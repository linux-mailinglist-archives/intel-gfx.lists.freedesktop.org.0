Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id F2DC2108299
	for <lists+intel-gfx@lfdr.de>; Sun, 24 Nov 2019 10:26:55 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4B65989AD2;
	Sun, 24 Nov 2019 09:26:53 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B30ED89ACD
 for <intel-gfx@lists.freedesktop.org>; Sun, 24 Nov 2019 09:26:51 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19317513-1500050 
 for multiple; Sun, 24 Nov 2019 09:26:47 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sun, 24 Nov 2019 09:26:41 +0000
Message-Id: <20191124092643.1297921-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191124092643.1297921-1-chris@chris-wilson.co.uk>
References: <20191124092643.1297921-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 2/4] drm/i915: Serialise with engine-pm around
 requests on the kernel_context
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QXMgdGhlIGVuZ2luZS0+a2VybmVsX2NvbnRleHQgaXMgdXNlZCB3aXRoaW4gdGhlIGVuZ2luZS1w
bSBiYXJyaWVyLCB3ZQpoYXZlIHRvIGJlIGNhcmVmdWwgd2hlbiBlbWl0dGluZyByZXF1ZXN0cyBv
dXRzaWRlIG9mIHRoZSBiYXJyaWVyLCBhcyB0aGUKc3RyaWN0IHRpbWVsaW5lIGxvY2tpbmcgcnVs
ZXMgZG8gbm90IGFwcGx5LiBJbnN0ZWFkLCB3ZSBtdXN0IGVuc3VyZSB0aGUKZW5naW5lX3Bhcmso
KSBjYW5ub3QgYmUgZW50ZXJlZCBhcyB3ZSBidWlsZCB0aGUgcmVxdWVzdCwgd2hpY2ggaXMKc2lt
cGxlc3QgYnkgdGFraW5nIGFuIGV4cGxpY2l0IGVuZ2luZS1wbSB3YWtlcmVmIGFyb3VuZCB0aGUg
cmVxdWVzdApjb25zdHJ1Y3Rpb24uCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlz
QGNocmlzLXdpbHNvbi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fY29udGV4dC5jICAgfCAgMyArLQogLi4uL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9j
bGllbnRfYmx0LmMgIHwgIDIgKwogLi4uL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb2hl
cmVuY3kuYyAgIHwgIDMgKy0KIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2Nv
bnRleHQuYyB8ICA3ICsrKy0KIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21t
YW4uYyAgICB8ICAzICstCiAuLi4vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVjdF9i
bHQuYyAgfCAxOCArKysrKystLS0KIC4uLi9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2hl
YXJ0YmVhdC5jICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVf
cG0uaCAgICAgfCAxMyArKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3dvcmth
cm91bmRzLmMgICB8ICAzICsrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250
ZXh0LmMgICAgfCAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5l
X2NzLmMgIHwgMTIgKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMu
YyAgICAgICAgfCAgNiArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X21vY3Mu
YyAgICAgICB8ICAyICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3RpbWVsaW5l
LmMgICB8ICA2ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgICAgICAgICAg
ICAgIHwgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5j
ICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9wZXJmLmMgICAg
fCAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcmVxdWVzdC5jIHwg
NDAgKysrKysrKysrKysrKystLS0tLQogLi4uL2RybS9pOTE1L3NlbGZ0ZXN0cy9pbnRlbF9tZW1v
cnlfcmVnaW9uLmMgIHwgIDIgKwogMTkgZmlsZXMgY2hhbmdlZCwgMTAxIGluc2VydGlvbnMoKyks
IDMxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29u
dGV4dC5jCmluZGV4IDZmMWU2MTgxZjY3YS4uYzk0YWM4Mzg0MDFhIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKQEAgLTcwLDYgKzcwLDcgQEAKICNpbmNs
dWRlIDxkcm0vaTkxNV9kcm0uaD4KIAogI2luY2x1ZGUgImd0L2ludGVsX2VuZ2luZV9oZWFydGJl
YXQuaCIKKyNpbmNsdWRlICJndC9pbnRlbF9lbmdpbmVfcG0uaCIKICNpbmNsdWRlICJndC9pbnRl
bF9lbmdpbmVfdXNlci5oIgogI2luY2x1ZGUgImd0L2ludGVsX2xyY19yZWcuaCIKICNpbmNsdWRl
ICJndC9pbnRlbF9yaW5nLmgiCkBAIC0xMjY1LDcgKzEyNjYsNyBAQCBnZW44X21vZGlmeV9ycGNz
KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgc3RydWN0IGludGVsX3NzZXUgc3NldSkKIAlpZiAo
IWludGVsX2NvbnRleHRfaXNfcGlubmVkKGNlKSkKIAkJcmV0dXJuIDA7CiAKLQlycSA9IGk5MTVf
cmVxdWVzdF9jcmVhdGUoY2UtPmVuZ2luZS0+a2VybmVsX2NvbnRleHQpOworCXJxID0gaW50ZWxf
ZW5naW5lX2NyZWF0ZV9rZXJuZWxfcmVxdWVzdChjZS0+ZW5naW5lKTsKIAlpZiAoSVNfRVJSKHJx
KSkKIAkJcmV0dXJuIFBUUl9FUlIocnEpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NsaWVudF9ibHQuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY2xpZW50X2JsdC5jCmluZGV4IGRhOGVkZWU0
ZmUwYS4uYjk3MmJlMTY1ZTg1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
c2VsZnRlc3RzL2k5MTVfZ2VtX2NsaWVudF9ibHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NsaWVudF9ibHQuYwpAQCAtMjQsNiArMjQsNyBAQCBz
dGF0aWMgaW50IF9faWd0X2NsaWVudF9maWxsKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZSkKIAogCXByYW5kb21fc2VlZF9zdGF0ZSgmcHJuZywgaTkxNV9zZWxmdGVzdC5yYW5kb21fc2Vl
ZCk7CiAKKwlpbnRlbF9lbmdpbmVfcG1fZ2V0KGVuZ2luZSk7CiAJZG8gewogCQljb25zdCB1MzIg
bWF4X2Jsb2NrX3NpemUgPSBTMTZfTUFYICogUEFHRV9TSVpFOwogCQl1MzIgc3ogPSBtaW5fdCh1
NjQsIGNlLT52bS0+dG90YWwgPj4gNCwgcHJhbmRvbV91MzJfc3RhdGUoJnBybmcpKTsKQEAgLTk5
LDYgKzEwMCw3IEBAIHN0YXRpYyBpbnQgX19pZ3RfY2xpZW50X2ZpbGwoc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lKQogZXJyX2ZsdXNoOgogCWlmIChlcnIgPT0gLUVOT01FTSkKIAkJZXJy
ID0gMDsKKwlpbnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2luZSk7CiAKIAlyZXR1cm4gZXJyOwogfQpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9j
b2hlcmVuY3kuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1f
Y29oZXJlbmN5LmMKaW5kZXggMmIyOWY2YjRlMWRkLi45ZDNjZDFhZjYxZjYgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29oZXJlbmN5LmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb2hlcmVu
Y3kuYwpAQCAtNiw2ICs2LDcgQEAKIAogI2luY2x1ZGUgPGxpbnV4L3ByaW1lX251bWJlcnMuaD4K
IAorI2luY2x1ZGUgImd0L2ludGVsX2VuZ2luZV9wbS5oIgogI2luY2x1ZGUgImd0L2ludGVsX2d0
LmgiCiAjaW5jbHVkZSAiZ3QvaW50ZWxfZ3RfcG0uaCIKICNpbmNsdWRlICJndC9pbnRlbF9yaW5n
LmgiCkBAIC0yMDAsNyArMjAxLDcgQEAgc3RhdGljIGludCBncHVfc2V0KHN0cnVjdCBjb250ZXh0
ICpjdHgsIHVuc2lnbmVkIGxvbmcgb2Zmc2V0LCB1MzIgdikKIAlpZiAoSVNfRVJSKHZtYSkpCiAJ
CXJldHVybiBQVFJfRVJSKHZtYSk7CiAKLQlycSA9IGk5MTVfcmVxdWVzdF9jcmVhdGUoY3R4LT5l
bmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKKwlycSA9IGludGVsX2VuZ2luZV9jcmVhdGVfa2VybmVs
X3JlcXVlc3QoY3R4LT5lbmdpbmUpOwogCWlmIChJU19FUlIocnEpKSB7CiAJCWk5MTVfdm1hX3Vu
cGluKHZtYSk7CiAJCXJldHVybiBQVFJfRVJSKHJxKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXggZTFkOGNjZDEx
NDA5Li4yZWE0NzkwZjM3MjEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9z
ZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCkBAIC03LDYgKzcsNyBAQAogI2luY2x1ZGUg
PGxpbnV4L3ByaW1lX251bWJlcnMuaD4KIAogI2luY2x1ZGUgImdlbS9pOTE1X2dlbV9wbS5oIgor
I2luY2x1ZGUgImd0L2ludGVsX2VuZ2luZV9wbS5oIgogI2luY2x1ZGUgImd0L2ludGVsX2d0Lmgi
CiAjaW5jbHVkZSAiZ3QvaW50ZWxfZ3RfcmVxdWVzdHMuaCIKICNpbmNsdWRlICJndC9pbnRlbF9y
ZXNldC5oIgpAQCAtMTE5MCw5ICsxMTkxLDExIEBAIF9fc3NldV90ZXN0KGNvbnN0IGNoYXIgKm5h
bWUsCiAJc3RydWN0IGlndF9zcGlubmVyICpzcGluID0gTlVMTDsKIAlpbnQgcmV0OwogCisJaW50
ZWxfZW5naW5lX3BtX2dldChjZS0+ZW5naW5lKTsKKwogCXJldCA9IF9fc3NldV9wcmVwYXJlKG5h
bWUsIGZsYWdzLCBjZSwgJnNwaW4pOwogCWlmIChyZXQpCi0JCXJldHVybiByZXQ7CisJCWdvdG8g
b3V0X3BtOwogCiAJcmV0ID0gaW50ZWxfY29udGV4dF9yZWNvbmZpZ3VyZV9zc2V1KGNlLCBzc2V1
KTsKIAlpZiAocmV0KQpAQCAtMTIwNyw2ICsxMjEwLDggQEAgX19zc2V1X3Rlc3QoY29uc3QgY2hh
ciAqbmFtZSwKIAkJaWd0X3NwaW5uZXJfZmluaShzcGluKTsKIAkJa2ZyZWUoc3Bpbik7CiAJfQor
b3V0X3BtOgorCWludGVsX2VuZ2luZV9wbV9wdXQoY2UtPmVuZ2luZSk7CiAJcmV0dXJuIHJldDsK
IH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1
X2dlbV9tbWFuLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2Vt
X21tYW4uYwppbmRleCA5ZjFhNjkwMjdhMDQuLjZjZTkxNjdmOGM5ZiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMKQEAgLTYsNiAr
Niw3IEBACiAKICNpbmNsdWRlIDxsaW51eC9wcmltZV9udW1iZXJzLmg+CiAKKyNpbmNsdWRlICJn
dC9pbnRlbF9lbmdpbmVfcG0uaCIKICNpbmNsdWRlICJndC9pbnRlbF9ndC5oIgogI2luY2x1ZGUg
Imd0L2ludGVsX2d0X3BtLmgiCiAjaW5jbHVkZSAiaHVnZV9nZW1fb2JqZWN0LmgiCkBAIC01MzYs
NyArNTM3LDcgQEAgc3RhdGljIGludCBtYWtlX29ial9idXN5KHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmopCiAJCWlmIChlcnIpCiAJCQlyZXR1cm4gZXJyOwogCi0JCXJxID0gaTkxNV9y
ZXF1ZXN0X2NyZWF0ZShlbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKKwkJcnEgPSBpbnRlbF9lbmdp
bmVfY3JlYXRlX2tlcm5lbF9yZXF1ZXN0KGVuZ2luZSk7CiAJCWlmIChJU19FUlIocnEpKSB7CiAJ
CQlpOTE1X3ZtYV91bnBpbih2bWEpOwogCQkJcmV0dXJuIFBUUl9FUlIocnEpOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmplY3RfYmx0
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVjdF9i
bHQuYwppbmRleCA2NzVjMWEyMGEyZjEuLjYyMDc3ZmU0NjcxNSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmplY3RfYmx0LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmplY3RfYmx0LmMK
QEAgLTQxLDYgKzQxLDcgQEAgc3RhdGljIGludCBfX3BlcmZfZmlsbF9ibHQoc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaikKIAkJaWYgKCFlbmdpbmUpCiAJCQlyZXR1cm4gMDsKIAorCQlp
bnRlbF9lbmdpbmVfcG1fZ2V0KGVuZ2luZSk7CiAJCWZvciAocGFzcyA9IDA7IHBhc3MgPCBBUlJB
WV9TSVpFKHQpOyBwYXNzKyspIHsKIAkJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSA9IGVuZ2lu
ZS0+a2VybmVsX2NvbnRleHQ7CiAJCQlrdGltZV90IHQwLCB0MTsKQEAgLTQ5LDE3ICs1MCwyMCBA
QCBzdGF0aWMgaW50IF9fcGVyZl9maWxsX2JsdChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqKQogCiAJCQllcnIgPSBpOTE1X2dlbV9vYmplY3RfZmlsbF9ibHQob2JqLCBjZSwgMCk7CiAJ
CQlpZiAoZXJyKQotCQkJCXJldHVybiBlcnI7CisJCQkJYnJlYWs7CiAKIAkJCWVyciA9IGk5MTVf
Z2VtX29iamVjdF93YWl0KG9iaiwKIAkJCQkJCSAgIEk5MTVfV0FJVF9BTEwsCiAJCQkJCQkgICBN
QVhfU0NIRURVTEVfVElNRU9VVCk7CiAJCQlpZiAoZXJyKQotCQkJCXJldHVybiBlcnI7CisJCQkJ
YnJlYWs7CiAKIAkJCXQxID0ga3RpbWVfZ2V0KCk7CiAJCQl0W3Bhc3NdID0ga3RpbWVfc3ViKHQx
LCB0MCk7CiAJCX0KKwkJaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOworCQlpZiAoZXJyKQor
CQkJcmV0dXJuIGVycjsKIAogCQlzb3J0KHQsIEFSUkFZX1NJWkUodCksIHNpemVvZigqdCksIHdy
YXBfa3RpbWVfY29tcGFyZSwgTlVMTCk7CiAJCXByX2luZm8oIiVzOiBibHQgJXpkIEtpQiBmaWxs
OiAlbGxkIE1pQi9zXG4iLApAQCAtMTA5LDYgKzExMyw3IEBAIHN0YXRpYyBpbnQgX19wZXJmX2Nv
cHlfYmx0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpzcmMsCiAJCXN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZTsKIAkJa3RpbWVfdCB0WzVdOwogCQlpbnQgcGFzczsKKwkJaW50IGVy
ciA9IDA7CiAKIAkJZW5naW5lID0gaW50ZWxfZW5naW5lX2xvb2t1cF91c2VyKGk5MTUsCiAJCQkJ
CQkgIEk5MTVfRU5HSU5FX0NMQVNTX0NPUFksCkBAIC0xMTYsMjYgKzEyMSwyOSBAQCBzdGF0aWMg
aW50IF9fcGVyZl9jb3B5X2JsdChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqc3JjLAogCQlp
ZiAoIWVuZ2luZSkKIAkJCXJldHVybiAwOwogCisJCWludGVsX2VuZ2luZV9wbV9nZXQoZW5naW5l
KTsKIAkJZm9yIChwYXNzID0gMDsgcGFzcyA8IEFSUkFZX1NJWkUodCk7IHBhc3MrKykgewogCQkJ
c3RydWN0IGludGVsX2NvbnRleHQgKmNlID0gZW5naW5lLT5rZXJuZWxfY29udGV4dDsKIAkJCWt0
aW1lX3QgdDAsIHQxOwotCQkJaW50IGVycjsKIAogCQkJdDAgPSBrdGltZV9nZXQoKTsKIAogCQkJ
ZXJyID0gaTkxNV9nZW1fb2JqZWN0X2NvcHlfYmx0KHNyYywgZHN0LCBjZSk7CiAJCQlpZiAoZXJy
KQotCQkJCXJldHVybiBlcnI7CisJCQkJYnJlYWs7CiAKIAkJCWVyciA9IGk5MTVfZ2VtX29iamVj
dF93YWl0KGRzdCwKIAkJCQkJCSAgIEk5MTVfV0FJVF9BTEwsCiAJCQkJCQkgICBNQVhfU0NIRURV
TEVfVElNRU9VVCk7CiAJCQlpZiAoZXJyKQotCQkJCXJldHVybiBlcnI7CisJCQkJYnJlYWs7CiAK
IAkJCXQxID0ga3RpbWVfZ2V0KCk7CiAJCQl0W3Bhc3NdID0ga3RpbWVfc3ViKHQxLCB0MCk7CiAJ
CX0KKwkJaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOworCQlpZiAoZXJyKQorCQkJcmV0dXJu
IGVycjsKIAogCQlzb3J0KHQsIEFSUkFZX1NJWkUodCksIHNpemVvZigqdCksIHdyYXBfa3RpbWVf
Y29tcGFyZSwgTlVMTCk7CiAJCXByX2luZm8oIiVzOiBibHQgJXpkIEtpQiBjb3B5OiAlbGxkIE1p
Qi9zXG4iLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5l
X2hlYXJ0YmVhdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2hlYXJ0
YmVhdC5jCmluZGV4IGM5MWZkNGU0YWYyOS4uYjIzY2U3ZDZjZTYyIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfaGVhcnRiZWF0LmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2hlYXJ0YmVhdC5jCkBAIC0yMTksNyArMjE5
LDcgQEAgaW50IGludGVsX2VuZ2luZV9mbHVzaF9iYXJyaWVycyhzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmUpCiAJaWYgKGxsaXN0X2VtcHR5KCZlbmdpbmUtPmJhcnJpZXJfdGFza3MpKQog
CQlyZXR1cm4gMDsKIAotCXJxID0gaTkxNV9yZXF1ZXN0X2NyZWF0ZShlbmdpbmUtPmtlcm5lbF9j
b250ZXh0KTsKKwlycSA9IGludGVsX2VuZ2luZV9jcmVhdGVfa2VybmVsX3JlcXVlc3QoZW5naW5l
KTsKIAlpZiAoSVNfRVJSKHJxKSkKIAkJcmV0dXJuIFBUUl9FUlIocnEpOwogCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uaCBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5oCmluZGV4IDI0ZTIwMzQ0ZGMyMi4uOTNhN2Zi
OTg1YmM2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVf
cG0uaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uaApAQCAt
Nyw2ICs3LDcgQEAKICNpZm5kZWYgSU5URUxfRU5HSU5FX1BNX0gKICNkZWZpbmUgSU5URUxfRU5H
SU5FX1BNX0gKIAorI2luY2x1ZGUgImk5MTVfcmVxdWVzdC5oIgogI2luY2x1ZGUgImludGVsX2Vu
Z2luZV90eXBlcy5oIgogI2luY2x1ZGUgImludGVsX3dha2VyZWYuaCIKIApAQCAtNDEsNiArNDIs
MTggQEAgc3RhdGljIGlubGluZSB2b2lkIGludGVsX2VuZ2luZV9wbV9mbHVzaChzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJaW50ZWxfd2FrZXJlZl91bmxvY2tfd2FpdCgmZW5naW5l
LT53YWtlcmVmKTsKIH0KIAorc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICoKK2lu
dGVsX2VuZ2luZV9jcmVhdGVfa2VybmVsX3JlcXVlc3Qoc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lKQoreworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCisJaW50ZWxfZW5naW5lX3Bt
X2dldChlbmdpbmUpOworCXJxID0gaTkxNV9yZXF1ZXN0X2NyZWF0ZShlbmdpbmUtPmtlcm5lbF9j
b250ZXh0KTsKKwlpbnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2luZSk7CisKKwlyZXR1cm4gcnE7Cit9
CisKIHZvaWQgaW50ZWxfZW5naW5lX2luaXRfX3BtKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSk7CiAKICNlbmRpZiAvKiBJTlRFTF9FTkdJTkVfUE1fSCAqLwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfd29ya2Fyb3VuZHMuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX3dvcmthcm91bmRzLmMKaW5kZXggMjI2YmQ0Y2NjYjQ4Li4wYzZkMzk4
OTgwYmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3dvcmthcm91
bmRzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfd29ya2Fyb3VuZHMuYwpA
QCAtNiw2ICs2LDcgQEAKIAogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAjaW5jbHVkZSAiaW50ZWxf
Y29udGV4dC5oIgorI2luY2x1ZGUgImludGVsX2VuZ2luZV9wbS5oIgogI2luY2x1ZGUgImludGVs
X2d0LmgiCiAjaW5jbHVkZSAiaW50ZWxfcmluZy5oIgogI2luY2x1ZGUgImludGVsX3dvcmthcm91
bmRzLmgiCkBAIC0xNTgyLDcgKzE1ODMsOSBAQCBzdGF0aWMgaW50IGVuZ2luZV93YV9saXN0X3Zl
cmlmeShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJaWYgKElTX0VSUih2bWEpKQogCQlyZXR1
cm4gUFRSX0VSUih2bWEpOwogCisJaW50ZWxfZW5naW5lX3BtX2dldChjZS0+ZW5naW5lKTsKIAly
cSA9IGludGVsX2NvbnRleHRfY3JlYXRlX3JlcXVlc3QoY2UpOworCWludGVsX2VuZ2luZV9wbV9w
dXQoY2UtPmVuZ2luZSk7CiAJaWYgKElTX0VSUihycSkpIHsKIAkJZXJyID0gUFRSX0VSUihycSk7
CiAJCWdvdG8gZXJyX3ZtYTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Nl
bGZ0ZXN0X2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRl
eHQuYwppbmRleCA1YmMxMjQ1NzQxNzAuLmFmMzU0Y2NkYmY0MCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYwpAQCAtMTIxLDcgKzEyMSw3IEBAIHN0YXRpYyBp
bnQgX19saXZlX2NvbnRleHRfc2l6ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJ
CWdvdG8gZXJyX3VucGluOwogCiAJLyogRm9yY2UgdGhlIGNvbnRleHQgc3dpdGNoICovCi0JcnEg
PSBpOTE1X3JlcXVlc3RfY3JlYXRlKGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOworCXJxID0gaW50
ZWxfZW5naW5lX2NyZWF0ZV9rZXJuZWxfcmVxdWVzdChlbmdpbmUpOwogCWlmIChJU19FUlIocnEp
KSB7CiAJCWVyciA9IFBUUl9FUlIocnEpOwogCQlnb3RvIGVycl91bnBpbjsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9jcy5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZW5naW5lX2NzLmMKaW5kZXggNTk4MWE3YjcxZWM5Li43
NjFkODFmNGJkNjggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0
X2VuZ2luZV9jcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2lu
ZV9jcy5jCkBAIC0xMzIsMTQgKzEzMiwxOCBAQCBzdGF0aWMgaW50IHBlcmZfbWlfYmJfc3RhcnQo
dm9pZCAqYXJnKQogCQl1MzIgY3ljbGVzW0NPVU5UXTsKIAkJaW50IGk7CiAKKwkJaW50ZWxfZW5n
aW5lX3BtX2dldChlbmdpbmUpOworCiAJCWJhdGNoID0gY3JlYXRlX2VtcHR5X2JhdGNoKGNlKTsK
IAkJaWYgKElTX0VSUihiYXRjaCkpIHsKIAkJCWVyciA9IFBUUl9FUlIoYmF0Y2gpOworCQkJaW50
ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOwogCQkJYnJlYWs7CiAJCX0KIAogCQllcnIgPSBpOTE1
X3ZtYV9zeW5jKGJhdGNoKTsKIAkJaWYgKGVycikgeworCQkJaW50ZWxfZW5naW5lX3BtX3B1dChl
bmdpbmUpOwogCQkJaTkxNV92bWFfcHV0KGJhdGNoKTsKIAkJCWJyZWFrOwogCQl9CkBAIC0xODAs
NiArMTg0LDcgQEAgc3RhdGljIGludCBwZXJmX21pX2JiX3N0YXJ0KHZvaWQgKmFyZykKIAkJCWN5
Y2xlc1tpXSA9IHJxLT5od3NwX3NlcW5vWzNdIC0gcnEtPmh3c3Bfc2Vxbm9bMl07CiAJCX0KIAkJ
aTkxNV92bWFfcHV0KGJhdGNoKTsKKwkJaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOwogCQlp
ZiAoZXJyKQogCQkJYnJlYWs7CiAKQEAgLTI1MSwxNSArMjU2LDE5IEBAIHN0YXRpYyBpbnQgcGVy
Zl9taV9ub29wKHZvaWQgKmFyZykKIAkJdTMyIGN5Y2xlc1tDT1VOVF07CiAJCWludCBpOwogCisJ
CWludGVsX2VuZ2luZV9wbV9nZXQoZW5naW5lKTsKKwogCQliYXNlID0gY3JlYXRlX2VtcHR5X2Jh
dGNoKGNlKTsKIAkJaWYgKElTX0VSUihiYXNlKSkgewogCQkJZXJyID0gUFRSX0VSUihiYXNlKTsK
KwkJCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKIAkJCWJyZWFrOwogCQl9CiAKIAkJZXJy
ID0gaTkxNV92bWFfc3luYyhiYXNlKTsKIAkJaWYgKGVycikgewogCQkJaTkxNV92bWFfcHV0KGJh
c2UpOworCQkJaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOwogCQkJYnJlYWs7CiAJCX0KIApA
QCAtMjY3LDYgKzI3Niw3IEBAIHN0YXRpYyBpbnQgcGVyZl9taV9ub29wKHZvaWQgKmFyZykKIAkJ
aWYgKElTX0VSUihub3ApKSB7CiAJCQllcnIgPSBQVFJfRVJSKG5vcCk7CiAJCQlpOTE1X3ZtYV9w
dXQoYmFzZSk7CisJCQlpbnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2luZSk7CiAJCQlicmVhazsKIAkJ
fQogCkBAIC0yNzQsNiArMjg0LDcgQEAgc3RhdGljIGludCBwZXJmX21pX25vb3Aodm9pZCAqYXJn
KQogCQlpZiAoZXJyKSB7CiAJCQlpOTE1X3ZtYV9wdXQobm9wKTsKIAkJCWk5MTVfdm1hX3B1dChi
YXNlKTsKKwkJCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKIAkJCWJyZWFrOwogCQl9CiAK
QEAgLTMyNyw2ICszMzgsNyBAQCBzdGF0aWMgaW50IHBlcmZfbWlfbm9vcCh2b2lkICphcmcpCiAJ
CX0KIAkJaTkxNV92bWFfcHV0KG5vcCk7CiAJCWk5MTVfdm1hX3B1dChiYXNlKTsKKwkJaW50ZWxf
ZW5naW5lX3BtX3B1dChlbmdpbmUpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKaW5kZXggZmMxNDJkZDYxZGQxLi5hYzhiOTExNmQz
MDcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCkBAIC0zNDgsNyArMzQ4
LDcgQEAgcmVsZWFzZV9xdWV1ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnE7CiAJdTMyICpjczsKIAotCXJxID0gaTkxNV9yZXF1ZXN0X2Ny
ZWF0ZShlbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKKwlycSA9IGludGVsX2VuZ2luZV9jcmVhdGVf
a2VybmVsX3JlcXVlc3QoZW5naW5lKTsKIAlpZiAoSVNfRVJSKHJxKSkKIAkJcmV0dXJuIFBUUl9F
UlIocnEpOwogCkBAIC00OTcsNyArNDk3LDcgQEAgc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3Qg
Km5vcF9yZXF1ZXN0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKIAlzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycTsKIAotCXJxID0gaTkxNV9yZXF1ZXN0X2NyZWF0ZShlbmdpbmUtPmtl
cm5lbF9jb250ZXh0KTsKKwlycSA9IGludGVsX2VuZ2luZV9jcmVhdGVfa2VybmVsX3JlcXVlc3Qo
ZW5naW5lKTsKIAlpZiAoSVNfRVJSKHJxKSkKIAkJcmV0dXJuIHJxOwogCkBAIC0zNjk4LDcgKzM2
OTgsNyBAQCBzdGF0aWMgaW50IGdwcl9tYWtlX2RpcnR5KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZSkKIAl1MzIgKmNzOwogCWludCBuOwogCi0JcnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRl
KGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOworCXJxID0gaW50ZWxfZW5naW5lX2NyZWF0ZV9rZXJu
ZWxfcmVxdWVzdChlbmdpbmUpOwogCWlmIChJU19FUlIocnEpKQogCQlyZXR1cm4gUFRSX0VSUihy
cSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X21vY3Mu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X21vY3MuYwppbmRleCBhMzRkNGZi
NTJmYTEuLmRlMDEwZjUyNzc1NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfbW9jcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X21v
Y3MuYwpAQCAtMjYxLDcgKzI2MSw5IEBAIHN0YXRpYyBpbnQgbGl2ZV9tb2NzX2tlcm5lbCh2b2lk
ICphcmcpCiAJCXJldHVybiBlcnI7CiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwgaWQp
IHsKKwkJaW50ZWxfZW5naW5lX3BtX2dldChlbmdpbmUpOwogCQllcnIgPSBjaGVja19tb2NzX2Vu
Z2luZSgmbW9jcywgZW5naW5lLT5rZXJuZWxfY29udGV4dCk7CisJCWludGVsX2VuZ2luZV9wbV9w
dXQoZW5naW5lKTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCX0KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3RpbWVsaW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF90aW1lbGluZS5jCmluZGV4IGYwNGE1OWZlNWQyYy4uZTJkNzhjYzIy
ZmI0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF90aW1lbGlu
ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3RpbWVsaW5lLmMKQEAg
LTQ1OCw3ICs0NTgsNyBAQCB0bF93cml0ZShzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsLCBzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIHUzMiB2YWx1ZSkKIAkJZ290byBvdXQ7CiAJfQog
Ci0JcnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOworCXJx
ID0gaW50ZWxfZW5naW5lX2NyZWF0ZV9rZXJuZWxfcmVxdWVzdChlbmdpbmUpOwogCWlmIChJU19F
UlIocnEpKQogCQlnb3RvIG91dF91bnBpbjsKIApAQCAtNjc1LDkgKzY3NSw3IEBAIHN0YXRpYyBp
bnQgbGl2ZV9od3NwX3dyYXAodm9pZCAqYXJnKQogCQlpZiAoIWludGVsX2VuZ2luZV9jYW5fc3Rv
cmVfZHdvcmQoZW5naW5lKSkKIAkJCWNvbnRpbnVlOwogCi0JCWludGVsX2VuZ2luZV9wbV9nZXQo
ZW5naW5lKTsKLQkJcnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKGVuZ2luZS0+a2VybmVsX2NvbnRl
eHQpOwotCQlpbnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2luZSk7CisJCXJxID0gaW50ZWxfZW5naW5l
X2NyZWF0ZV9rZXJuZWxfcmVxdWVzdChlbmdpbmUpOwogCQlpZiAoSVNfRVJSKHJxKSkgewogCQkJ
ZXJyID0gUFRSX0VSUihycSk7CiAJCQlnb3RvIG91dDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcGVyZi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMK
aW5kZXggNjA4ZTZjM2YzYzFhLi5iNDY3MTViNTc1NzYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcGVyZi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVy
Zi5jCkBAIC0xOTY4LDcgKzE5NjgsOSBAQCBzdGF0aWMgaW50IGVtaXRfb2FfY29uZmlnKHN0cnVj
dCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJaWYgKGVycikKIAkJZ290byBlcnJfdm1hX3B1
dDsKIAorCWludGVsX2VuZ2luZV9wbV9nZXQoY2UtPmVuZ2luZSk7CiAJcnEgPSBpOTE1X3JlcXVl
c3RfY3JlYXRlKGNlKTsKKwlpbnRlbF9lbmdpbmVfcG1fcHV0KGNlLT5lbmdpbmUpOwogCWlmIChJ
U19FUlIocnEpKSB7CiAJCWVyciA9IFBUUl9FUlIocnEpOwogCQlnb3RvIGVycl92bWFfdW5waW47
CkBAIC0yMTY1LDcgKzIxNjcsNyBAQCBzdGF0aWMgaW50IGdlbjhfbW9kaWZ5X2NvbnRleHQoc3Ry
dWN0IGludGVsX2NvbnRleHQgKmNlLAogCiAJbG9ja2RlcF9hc3NlcnRfaGVsZCgmY2UtPnBpbl9t
dXRleCk7CiAKLQlycSA9IGk5MTVfcmVxdWVzdF9jcmVhdGUoY2UtPmVuZ2luZS0+a2VybmVsX2Nv
bnRleHQpOworCXJxID0gaW50ZWxfZW5naW5lX2NyZWF0ZV9rZXJuZWxfcmVxdWVzdChjZS0+ZW5n
aW5lKTsKIAlpZiAoSVNfRVJSKHJxKSkKIAkJcmV0dXJuIFBUUl9FUlIocnEpOwogCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9hY3RpdmUuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jCmluZGV4IDYwMjkwZjc4NzUw
ZC4uNmMxZGIzZGVkNDQ2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaTkxNV9hY3RpdmUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV9hY3RpdmUuYwpAQCAtOTksNyArOTksNyBAQCBfX2xpdmVfYWN0aXZlX3NldHVwKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogCWZvcl9lYWNoX3VhYmlfZW5naW5lKGVuZ2luZSwgaTkx
NSkgewogCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAotCQlycSA9IGk5MTVfcmVxdWVzdF9j
cmVhdGUoZW5naW5lLT5rZXJuZWxfY29udGV4dCk7CisJCXJxID0gaW50ZWxfZW5naW5lX2NyZWF0
ZV9rZXJuZWxfcmVxdWVzdChlbmdpbmUpOwogCQlpZiAoSVNfRVJSKHJxKSkgewogCQkJZXJyID0g
UFRSX0VSUihycSk7CiAJCQlicmVhazsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pOTE1X3BlcmYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
OTE1X3BlcmYuYwppbmRleCBhYWJkMDdmNjdlNDkuLmQxYTE1NjhjNDdiYSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcGVyZi5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3BlcmYuYwpAQCAtMTMyLDcgKzEzMiw3IEBAIHN0
YXRpYyBpbnQgbGl2ZV9ub2FfZGVsYXkodm9pZCAqYXJnKQogCWZvciAoaSA9IDA7IGkgPCA0OyBp
KyspCiAJCWludGVsX3dyaXRlX3N0YXR1c19wYWdlKHN0cmVhbS0+ZW5naW5lLCAweDEwMCArIGks
IDApOwogCi0JcnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKHN0cmVhbS0+ZW5naW5lLT5rZXJuZWxf
Y29udGV4dCk7CisJcnEgPSBpbnRlbF9lbmdpbmVfY3JlYXRlX2tlcm5lbF9yZXF1ZXN0KHN0cmVh
bS0+ZW5naW5lKTsKIAlpZiAoSVNfRVJSKHJxKSkgewogCQllcnIgPSBQVFJfRVJSKHJxKTsKIAkJ
Z290byBvdXQ7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV9yZXF1ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0
LmMKaW5kZXggYzE2ZDFlZmQyYWQ0Li45OWM5NGI0ZjY5ZmIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMKQEAgLTI3LDYgKzI3LDcgQEAKICNpbmNs
dWRlICJnZW0vaTkxNV9nZW1fcG0uaCIKICNpbmNsdWRlICJnZW0vc2VsZnRlc3RzL21vY2tfY29u
dGV4dC5oIgogCisjaW5jbHVkZSAiZ3QvaW50ZWxfZW5naW5lX3BtLmgiCiAjaW5jbHVkZSAiZ3Qv
aW50ZWxfZ3QuaCIKIAogI2luY2x1ZGUgImk5MTVfcmFuZG9tLmgiCkBAIC01NDEsNiArNTQyLDcg
QEAgc3RhdGljIGludCBsaXZlX25vcF9yZXF1ZXN0KHZvaWQgKmFyZykKIAkJaWYgKGVycikKIAkJ
CXJldHVybiBlcnI7CiAKKwkJaW50ZWxfZW5naW5lX3BtX2dldChlbmdpbmUpOwogCQlmb3JfZWFj
aF9wcmltZV9udW1iZXJfZnJvbShwcmltZSwgMSwgODE5MikgewogCQkJc3RydWN0IGk5MTVfcmVx
dWVzdCAqcmVxdWVzdCA9IE5VTEw7CiAKQEAgLTU3OSw2ICs1ODEsNyBAQCBzdGF0aWMgaW50IGxp
dmVfbm9wX3JlcXVlc3Qodm9pZCAqYXJnKQogCQkJaWYgKF9faWd0X3RpbWVvdXQoZW5kX3RpbWUs
IE5VTEwpKQogCQkJCWJyZWFrOwogCQl9CisJCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsK
IAogCQllcnIgPSBpZ3RfbGl2ZV90ZXN0X2VuZCgmdCk7CiAJCWlmIChlcnIpCkBAIC02OTMsMTAg
KzY5NiwxMyBAQCBzdGF0aWMgaW50IGxpdmVfZW1wdHlfcmVxdWVzdCh2b2lkICphcmcpCiAJCWlm
IChlcnIpCiAJCQlnb3RvIG91dF9iYXRjaDsKIAorCQlpbnRlbF9lbmdpbmVfcG1fZ2V0KGVuZ2lu
ZSk7CisKIAkJLyogV2FybXVwIC8gcHJlbG9hZCAqLwogCQlyZXF1ZXN0ID0gZW1wdHlfcmVxdWVz
dChlbmdpbmUsIGJhdGNoKTsKIAkJaWYgKElTX0VSUihyZXF1ZXN0KSkgewogCQkJZXJyID0gUFRS
X0VSUihyZXF1ZXN0KTsKKwkJCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKIAkJCWdvdG8g
b3V0X2JhdGNoOwogCQl9CiAJCWk5MTVfcmVxdWVzdF93YWl0KHJlcXVlc3QsIDAsIE1BWF9TQ0hF
RFVMRV9USU1FT1VUKTsKQEAgLTcwOSw2ICs3MTUsNyBAQCBzdGF0aWMgaW50IGxpdmVfZW1wdHlf
cmVxdWVzdCh2b2lkICphcmcpCiAJCQkJcmVxdWVzdCA9IGVtcHR5X3JlcXVlc3QoZW5naW5lLCBi
YXRjaCk7CiAJCQkJaWYgKElTX0VSUihyZXF1ZXN0KSkgewogCQkJCQllcnIgPSBQVFJfRVJSKHJl
cXVlc3QpOworCQkJCQlpbnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2luZSk7CiAJCQkJCWdvdG8gb3V0
X2JhdGNoOwogCQkJCX0KIAkJCX0KQEAgLTcyMiw2ICs3MjksNyBAQCBzdGF0aWMgaW50IGxpdmVf
ZW1wdHlfcmVxdWVzdCh2b2lkICphcmcpCiAJCQkJYnJlYWs7CiAJCX0KIAkJaTkxNV9yZXF1ZXN0
X3B1dChyZXF1ZXN0KTsKKwkJaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOwogCiAJCWVyciA9
IGlndF9saXZlX3Rlc3RfZW5kKCZ0KTsKIAkJaWYgKGVycikKQEAgLTg0Niw3ICs4NTQsNyBAQCBz
dGF0aWMgaW50IGxpdmVfYWxsX2VuZ2luZXModm9pZCAqYXJnKQogCiAJaWR4ID0gMDsKIAlmb3Jf
ZWFjaF91YWJpX2VuZ2luZShlbmdpbmUsIGk5MTUpIHsKLQkJcmVxdWVzdFtpZHhdID0gaTkxNV9y
ZXF1ZXN0X2NyZWF0ZShlbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKKwkJcmVxdWVzdFtpZHhdID0g
aW50ZWxfZW5naW5lX2NyZWF0ZV9rZXJuZWxfcmVxdWVzdChlbmdpbmUpOwogCQlpZiAoSVNfRVJS
KHJlcXVlc3RbaWR4XSkpIHsKIAkJCWVyciA9IFBUUl9FUlIocmVxdWVzdFtpZHhdKTsKIAkJCXBy
X2VycigiJXM6IFJlcXVlc3QgYWxsb2NhdGlvbiBmYWlsZWQgd2l0aCBlcnI9JWRcbiIsCkBAIC05
NjMsNyArOTcxLDcgQEAgc3RhdGljIGludCBsaXZlX3NlcXVlbnRpYWxfZW5naW5lcyh2b2lkICph
cmcpCiAJCQlnb3RvIG91dF9mcmVlOwogCQl9CiAKLQkJcmVxdWVzdFtpZHhdID0gaTkxNV9yZXF1
ZXN0X2NyZWF0ZShlbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKKwkJcmVxdWVzdFtpZHhdID0gaW50
ZWxfZW5naW5lX2NyZWF0ZV9rZXJuZWxfcmVxdWVzdChlbmdpbmUpOwogCQlpZiAoSVNfRVJSKHJl
cXVlc3RbaWR4XSkpIHsKIAkJCWVyciA9IFBUUl9FUlIocmVxdWVzdFtpZHhdKTsKIAkJCXByX2Vy
cigiJXM6IFJlcXVlc3QgYWxsb2NhdGlvbiBmYWlsZWQgZm9yICVzIHdpdGggZXJyPSVkXG4iLApA
QCAtMTA2OCwxNSArMTA3NiwxOSBAQCBzdGF0aWMgaW50IF9fbGl2ZV9wYXJhbGxlbF9lbmdpbmUx
KHZvaWQgKmFyZykKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUgPSBhcmc7CiAJSUdU
X1RJTUVPVVQoZW5kX3RpbWUpOwogCXVuc2lnbmVkIGxvbmcgY291bnQ7CisJaW50IGVyciA9IDA7
CiAKIAljb3VudCA9IDA7CisJaW50ZWxfZW5naW5lX3BtX2dldChlbmdpbmUpOwogCWRvIHsKIAkJ
c3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7Ci0JCWludCBlcnI7CiAKIAkJcnEgPSBpOTE1X3JlcXVl
c3RfY3JlYXRlKGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOwotCQlpZiAoSVNfRVJSKHJxKSkKLQkJ
CXJldHVybiBQVFJfRVJSKHJxKTsKKwkJaWYgKElTX0VSUihycSkpIHsKKwkJCWVyciA9IFBUUl9F
UlIocnEpOworCQkJaWYgKGVycikKKwkJCQlicmVhazsKKwkJfQogCiAJCWk5MTVfcmVxdWVzdF9n
ZXQocnEpOwogCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKQEAgLTEwODYsMTMgKzEwOTgsMTQgQEAg
c3RhdGljIGludCBfX2xpdmVfcGFyYWxsZWxfZW5naW5lMSh2b2lkICphcmcpCiAJCQllcnIgPSAt
RVRJTUU7CiAJCWk5MTVfcmVxdWVzdF9wdXQocnEpOwogCQlpZiAoZXJyKQotCQkJcmV0dXJuIGVy
cjsKKwkJCWJyZWFrOwogCiAJCWNvdW50Kys7CiAJfSB3aGlsZSAoIV9faWd0X3RpbWVvdXQoZW5k
X3RpbWUsIE5VTEwpKTsKKwlpbnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2luZSk7CiAKIAlwcl9pbmZv
KCIlczogJWx1IHJlcXVlc3QgKyBzeW5jXG4iLCBlbmdpbmUtPm5hbWUsIGNvdW50KTsKLQlyZXR1
cm4gMDsKKwlyZXR1cm4gZXJyOwogfQogCiBzdGF0aWMgaW50IF9fbGl2ZV9wYXJhbGxlbF9lbmdp
bmVOKHZvaWQgKmFyZykKQEAgLTExMDAsMjEgKzExMTMsMjYgQEAgc3RhdGljIGludCBfX2xpdmVf
cGFyYWxsZWxfZW5naW5lTih2b2lkICphcmcpCiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lID0gYXJnOwogCUlHVF9USU1FT1VUKGVuZF90aW1lKTsKIAl1bnNpZ25lZCBsb25nIGNvdW50
OworCWludCBlcnIgPSAwOwogCiAJY291bnQgPSAwOworCWludGVsX2VuZ2luZV9wbV9nZXQoZW5n
aW5lKTsKIAlkbyB7CiAJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwogCiAJCXJxID0gaTkxNV9y
ZXF1ZXN0X2NyZWF0ZShlbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKLQkJaWYgKElTX0VSUihycSkp
Ci0JCQlyZXR1cm4gUFRSX0VSUihycSk7CisJCWlmIChJU19FUlIocnEpKSB7CisJCQllcnIgPSBQ
VFJfRVJSKHJxKTsKKwkJCWJyZWFrOworCQl9CiAKIAkJaTkxNV9yZXF1ZXN0X2FkZChycSk7CiAJ
CWNvdW50Kys7CiAJfSB3aGlsZSAoIV9faWd0X3RpbWVvdXQoZW5kX3RpbWUsIE5VTEwpKTsKKwlp
bnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2luZSk7CiAKIAlwcl9pbmZvKCIlczogJWx1IHJlcXVlc3Rz
XG4iLCBlbmdpbmUtPm5hbWUsIGNvdW50KTsKLQlyZXR1cm4gMDsKKwlyZXR1cm4gZXJyOwogfQog
CiBzdGF0aWMgYm9vbCB3YWtlX2FsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKQEAg
LTExNTgsOSArMTE3NiwxMSBAQCBzdGF0aWMgaW50IF9fbGl2ZV9wYXJhbGxlbF9zcGluKHZvaWQg
KmFyZykKIAkJcmV0dXJuIC1FTk9NRU07CiAJfQogCisJaW50ZWxfZW5naW5lX3BtX2dldChlbmdp
bmUpOwogCXJxID0gaWd0X3NwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJnNwaW4sCiAJCQkJCWVuZ2lu
ZS0+a2VybmVsX2NvbnRleHQsCiAJCQkJCU1JX05PT1ApOyAvKiBubyBwcmVlbXB0aW9uICovCisJ
aW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOwogCWlmIChJU19FUlIocnEpKSB7CiAJCWVyciA9
IFBUUl9FUlIocnEpOwogCQlpZiAoZXJyID09IC1FTk9ERVYpCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaW50ZWxfbWVtb3J5X3JlZ2lvbi5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvc2VsZnRlc3RzL2ludGVsX21lbW9yeV9yZWdpb24uYwppbmRleCBiNjA5MTY1
NjE0NjIuLjA0ZDBhYTdiMzQ5ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2Vs
ZnRlc3RzL2ludGVsX21lbW9yeV9yZWdpb24uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvaW50ZWxfbWVtb3J5X3JlZ2lvbi5jCkBAIC01MDYsNyArNTA2LDkgQEAgc3RhdGlj
IGludCBpZ3RfbG1lbV93cml0ZV9jcHUodm9pZCAqYXJnKQogCX0KIAogCS8qIFB1dCB0aGUgcGFn
ZXMgaW50byBhIGtub3duIHN0YXRlIC0tIGZyb20gdGhlIGdwdSBmb3IgYWRkZWQgZnVuICovCisJ
aW50ZWxfZW5naW5lX3BtX2dldChlbmdpbmUpOwogCWVyciA9IGk5MTVfZ2VtX29iamVjdF9maWxs
X2JsdChvYmosIGVuZ2luZS0+a2VybmVsX2NvbnRleHQsIDB4ZGVhZGJlYWYpOworCWludGVsX2Vu
Z2luZV9wbV9wdXQoZW5naW5lKTsKIAlpZiAoZXJyKQogCQlnb3RvIG91dF91bnBpbjsKIAotLSAK
Mi4yNC4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJ
bnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0
cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

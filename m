Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 34E362518E
	for <lists+intel-gfx@lfdr.de>; Tue, 21 May 2019 16:09:33 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4BA8D893B8;
	Tue, 21 May 2019 14:09:30 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3C3068935B
 for <intel-gfx@lists.freedesktop.org>; Tue, 21 May 2019 14:09:27 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga005.fm.intel.com ([10.253.24.32])
 by fmsmga104.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 21 May 2019 07:09:27 -0700
X-ExtLoop1: 1
Received: from ylukoyan-mobl.ccr.corp.intel.com (HELO
 delly.ger.corp.intel.com) ([10.251.94.80])
 by fmsmga005.fm.intel.com with ESMTP; 21 May 2019 07:09:25 -0700
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 21 May 2019 15:08:54 +0100
Message-Id: <20190521140855.3957-5-lionel.g.landwerlin@intel.com>
X-Mailer: git-send-email 2.21.0.392.gf8f6787159e
In-Reply-To: <20190521140855.3957-1-lionel.g.landwerlin@intel.com>
References: <20190521140855.3957-1-lionel.g.landwerlin@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 4/5] drm/i915: add a new perf configuration
 execbuf parameter
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2Ugd2FudCB0aGUgYWJpbGl0eSB0byBkaXNwYXRjaCBhIHNldCBvZiBjb21tYW5kIGJ1ZmZlciB0
byB0aGUKaGFyZHdhcmUsIGVhY2ggd2l0aCBhIGRpZmZlcmVudCBPQSBjb25maWd1cmF0aW9uLiBU
byBhY2hpZXZlIHRoaXMsIHdlCnJldXNlIGEgY291cGxlIG9mIGZpZWxkcyBmcm9tIHRoZSBleGVj
YnVmMiBzdHJ1Y3QgKEkgQ0FOIEhBWgpleGVjYnVmMz8pIHRvIG5vdGlmeSB3aGF0IE9BIGNvbmZp
Z3VyYXRpb24gc2hvdWxkIGJlIHVzZWQgZm9yIGEgYmF0Y2gKYnVmZmVyLiBUaGlzIHJlcXVpcmVz
IHRoZSBwcm9jZXNzIG1ha2luZyB0aGUgZXhlY2J1ZiB3aXRoIHRoaXMgZmxhZyB0bwphbHNvIG93
biB0aGUgcGVyZiBmZCBhdCB0aGUgdGltZSBvZiBleGVjYnVmLgoKdjI6IEFkZCBhIGVtaXRfb2Ff
Y29uZmlnKCkgdmZ1bmMgaW4gdGhlIGludGVsX2VuZ2luZV9jcyAoQ2hyaXMpCiAgICBNb3ZlIG9h
X2NvbmZpZyB2bWEgdG8gYWN0aXZlIChDaHJpcykKClNpZ25lZC1vZmYtYnk6IExpb25lbCBMYW5k
d2VybGluIDxsaW9uZWwuZy5sYW5kd2VybGluQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMuaCB8ICAgNyArKwogZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfbHJjLmMgICAgICAgICAgfCAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jICAgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZHJ2LmMgICAgICAgICAgICAgIHwgICA0ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZHJ2LmggICAgICAgICAgICAgIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
Z2VtX2V4ZWNidWZmZXIuYyAgIHwgMTEzICsrKysrKysrKysrKysrKystLS0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcGVyZi5jICAgICAgICAgICAgIHwgIDE0ICstLQogaW5jbHVkZS91YXBp
L2RybS9pOTE1X2RybS5oICAgICAgICAgICAgICAgICAgfCAgMjAgKysrLQogOCBmaWxlcyBjaGFu
Z2VkLCAxNDIgaW5zZXJ0aW9ucygrKSwgMjIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmggYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMuaAppbmRleCBlMzgxYzFjNzM5MDIuLjc2NmZi
YmVkZTQzMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5l
X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVz
LmgKQEAgLTQ0NSw2ICs0NDUsNyBAQCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzIHsKICNkZWZpbmUg
STkxNV9FTkdJTkVfSEFTX1BSRUVNUFRJT04gICBCSVQoMikKICNkZWZpbmUgSTkxNV9FTkdJTkVf
SEFTX1NFTUFQSE9SRVMgICBCSVQoMykKICNkZWZpbmUgSTkxNV9FTkdJTkVfTkVFRFNfQlJFQURD
UlVNQl9UQVNLTEVUIEJJVCg0KQorI2RlZmluZSBJOTE1X0VOR0lORV9IQVNfT0EgICAgICAgICAg
IEJJVCg1KQogCXVuc2lnbmVkIGludCBmbGFnczsKIAogCS8qCkBAIC01MzQsNiArNTM1LDEyIEBA
IGludGVsX2VuZ2luZV9uZWVkc19icmVhZGNydW1iX3Rhc2tsZXQoY29uc3Qgc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lKQogCXJldHVybiBlbmdpbmUtPmZsYWdzICYgSTkxNV9FTkdJTkVf
TkVFRFNfQlJFQURDUlVNQl9UQVNLTEVUOwogfQogCitzdGF0aWMgaW5saW5lIGJvb2wKK2ludGVs
X2VuZ2luZV9oYXNfb2EoY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQorewor
CXJldHVybiBlbmdpbmUtPmZsYWdzICYgSTkxNV9FTkdJTkVfSEFTX09BOworfQorCiAjZGVmaW5l
IGluc3Rkb25lX3NsaWNlX21hc2soZGV2X3ByaXZfXykgXAogCShJU19HRU4oZGV2X3ByaXZfXywg
NykgPyBcCiAJIDEgOiBSVU5USU1FX0lORk8oZGV2X3ByaXZfXyktPnNzZXUuc2xpY2VfbWFzaykK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKaW5kZXggMmFkOTU5NzdmN2E4Li5jYWQ2ZmNh
NGJhMGYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCkBAIC0yMzk1LDYgKzIzOTUs
NyBAQCBpbnQgaW50ZWxfZXhlY2xpc3RzX3N1Ym1pc3Npb25fc2V0dXAoc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lKQogCQllbmdpbmUtPmluaXRfY29udGV4dCA9IGdlbjhfaW5pdF9yY3Nf
Y29udGV4dDsKIAkJZW5naW5lLT5lbWl0X2ZsdXNoID0gZ2VuOF9lbWl0X2ZsdXNoX3JlbmRlcjsK
IAkJZW5naW5lLT5lbWl0X2ZpbmlfYnJlYWRjcnVtYiA9IGdlbjhfZW1pdF9maW5pX2JyZWFkY3J1
bWJfcmNzOworCQllbmdpbmUtPmZsYWdzIHw9IEk5MTVfRU5HSU5FX0hBU19PQTsKIAl9CiAKIAly
ZXR1cm4gMDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jpbmdi
dWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYwppbmRl
eCBmMGQ2MGFmZmRiYTMuLmRjODVhM2U0NzRiOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX3JpbmdidWZmZXIuYwpAQCAtMjIxMCw4ICsyMjEwLDEwIEBAIHN0YXRpYyB2b2lkIHNl
dHVwX3JjcyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJCWVuZ2luZS0+aXJxX2Vu
YWJsZV9tYXNrID0gSTkxNV9VU0VSX0lOVEVSUlVQVDsKIAl9CiAKLQlpZiAoSVNfSEFTV0VMTChp
OTE1KSkKKwlpZiAoSVNfSEFTV0VMTChpOTE1KSkgewogCQllbmdpbmUtPmVtaXRfYmJfc3RhcnQg
PSBoc3dfZW1pdF9iYl9zdGFydDsKKwkJZW5naW5lLT5mbGFncyB8PSBJOTE1X0VOR0lORV9IQVNf
T0E7CisJfQogCiAJZW5naW5lLT5yZXN1bWUgPSByY3NfcmVzdW1lOwogfQpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZHJ2LmMKaW5kZXggNTg3MWUwY2ZiYWIwLi42ZDlhMTU2NDIzNDIgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9kcnYuYwpAQCAtNDcyLDYgKzQ3MiwxMCBAQCBzdGF0aWMgaW50IGk5MTVfZ2V0cGFyYW1f
aW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAljYXNlIEk5MTVfUEFS
QU1fUEVSRl9SRVZJU0lPTjoKIAkJdmFsdWUgPSAyOwogCQlicmVhazsKKwljYXNlIEk5MTVfUEFS
QU1fSEFTX0VYRUNfUEVSRl9DT05GSUc6CisJCS8qIE9idmlvdXNseSByZXF1aXJlcyBwZXJmIHN1
cHBvcnQuICovCisJCXZhbHVlID0gZGV2X3ByaXYtPnBlcmYuaW5pdGlhbGl6ZWQ7CisJCWJyZWFr
OwogCWRlZmF1bHQ6CiAJCURSTV9ERUJVRygiVW5rbm93biBwYXJhbWV0ZXIgJWRcbiIsIHBhcmFt
LT5wYXJhbSk7CiAJCXJldHVybiAtRUlOVkFMOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKaW5kZXgg
YWJkNTY0YmZhMDNiLi4yNTg2MGQ5OWZmYzYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaApAQCAt
MzE1NCw2ICszMTU0LDcgQEAgaW50IGk5MTVfcGVyZl9nZXRfb2FfY29uZmlnKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgIGludCBtZXRyaWNzX3NldCwKIAkJCSAgICBzdHJ1
Y3QgaTkxNV9vYV9jb25maWcgKipvdXRfY29uZmlnLAogCQkJICAgIHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICoqb3V0X29iaik7Cit2b2lkIGk5MTVfb2FfY29uZmlnX3B1dChzdHJ1Y3QgaTkx
NV9vYV9jb25maWcgKm9hX2NvbmZpZyk7CiAKIC8qIGk5MTVfZ2VtX2V2aWN0LmMgKi8KIGludCBf
X211c3RfY2hlY2sgaTkxNV9nZW1fZXZpY3Rfc29tZXRoaW5nKHN0cnVjdCBpOTE1X2FkZHJlc3Nf
c3BhY2UgKnZtLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZXhl
Y2J1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZXhlY2J1ZmZlci5jCmlu
ZGV4IDM2MWMyMzJkZGU4My4uMzc5NGM2Y2U3MWUzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9nZW1fZXhlY2J1ZmZlci5jCkBAIC0yODgsNiArMjg4LDkgQEAgc3RydWN0IGk5MTVfZXhl
Y2J1ZmZlciB7CiAJICovCiAJaW50IGx1dF9zaXplOwogCXN0cnVjdCBobGlzdF9oZWFkICpidWNr
ZXRzOyAvKiogaHQgZm9yIHJlbG9jYXRpb24gaGFuZGxlcyAqLworCisJc3RydWN0IGk5MTVfb2Ff
Y29uZmlnICpvYV9jb25maWc7IC8qKiBIVyBjb25maWd1cmF0aW9uIGZvciBPQSwgTlVMTCBpcyBu
b3QgbmVlZGVkLiAqLworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYV9ibzsKIH07CiAK
ICNkZWZpbmUgZXhlY19lbnRyeShFQiwgVk1BKSAoJihFQiktPmV4ZWNbKFZNQSktPmV4ZWNfZmxh
Z3MgLSAoRUIpLT5mbGFnc10pCkBAIC0xMTgzLDYgKzExODYsMzMgQEAgc3RhdGljIHZvaWQgY2xm
bHVzaF93cml0ZTMyKHUzMiAqYWRkciwgdTMyIHZhbHVlLCB1bnNpZ25lZCBpbnQgZmx1c2hlcykK
IAkJKmFkZHIgPSB2YWx1ZTsKIH0KIAorc3RhdGljIGludAorZ2V0X2V4ZWNidWZfb2FfY29uZmln
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJICAgICAgaW50IHBlcmZfZmQs
IHUzMiBvYV9jb25maWdfaWQsCisJCSAgICAgIHN0cnVjdCBpOTE1X29hX2NvbmZpZyAqKm91dF9v
YV9jb25maWcsCisJCSAgICAgIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICoqb3V0X29hX29i
aikKK3sKKwlzdHJ1Y3QgZmlsZSAqcGVyZl9maWxlOworCWludCByZXQ7CisKKwlpZiAoIWRldl9w
cml2LT5wZXJmLm9hLmV4Y2x1c2l2ZV9zdHJlYW0pCisJCXJldHVybiAtRUlOVkFMOworCisJcGVy
Zl9maWxlID0gZmdldChwZXJmX2ZkKTsKKwlpZiAoIXBlcmZfZmlsZSkKKwkJcmV0dXJuIC1FSU5W
QUw7CisKKwlpZiAocGVyZl9maWxlLT5wcml2YXRlX2RhdGEgIT0gZGV2X3ByaXYtPnBlcmYub2Eu
ZXhjbHVzaXZlX3N0cmVhbSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlmcHV0KHBlcmZfZmlsZSk7
CisKKwlyZXQgPSBpOTE1X3BlcmZfZ2V0X29hX2NvbmZpZyhkZXZfcHJpdiwgb2FfY29uZmlnX2lk
LAorCQkJCSAgICAgIG91dF9vYV9jb25maWcsIG91dF9vYV9vYmopOworCisJcmV0dXJuIHJldDsK
K30KKwogc3RhdGljIGludCBfX3JlbG9jX2dwdV9hbGxvYyhzdHJ1Y3QgaTkxNV9leGVjYnVmZmVy
ICplYiwKIAkJCSAgICAgc3RydWN0IGk5MTVfdm1hICp2bWEsCiAJCQkgICAgIHVuc2lnbmVkIGlu
dCBsZW4pCkBAIC0xOTM3LDEyICsxOTY3LDE1IEBAIHN0YXRpYyBib29sIGk5MTVfZ2VtX2NoZWNr
X2V4ZWNidWZmZXIoc3RydWN0IGRybV9pOTE1X2dlbV9leGVjYnVmZmVyMiAqZXhlYykKIAkJCXJl
dHVybiBmYWxzZTsKIAl9CiAKLQlpZiAoZXhlYy0+RFI0ID09IDB4ZmZmZmZmZmYpIHsKLQkJRFJN
X0RFQlVHKCJVWEEgc3VibWl0dGluZyBnYXJiYWdlIERSNCwgZml4aW5nIHVwXG4iKTsKLQkJZXhl
Yy0+RFI0ID0gMDsKKwkvKiBXZSByZXVzZSBEUjEgJiBEUjQgZmllbGRzIGZvciBwYXNzaW5nIHRo
ZSBwZXJmIGNvbmZpZyBkZXRhaWwuICovCisJaWYgKCEoZXhlYy0+ZmxhZ3MgJiBJOTE1X0VYRUNf
UEVSRl9DT05GSUcpKSB7CisJCWlmIChleGVjLT5EUjQgPT0gMHhmZmZmZmZmZikgeworCQkJRFJN
X0RFQlVHKCJVWEEgc3VibWl0dGluZyBnYXJiYWdlIERSNCwgZml4aW5nIHVwXG4iKTsKKwkJCWV4
ZWMtPkRSNCA9IDA7CisJCX0KKwkJaWYgKGV4ZWMtPkRSMSB8fCBleGVjLT5EUjQpCisJCQlyZXR1
cm4gZmFsc2U7CiAJfQotCWlmIChleGVjLT5EUjEgfHwgZXhlYy0+RFI0KQotCQlyZXR1cm4gZmFs
c2U7CiAKIAlpZiAoKGV4ZWMtPmJhdGNoX3N0YXJ0X29mZnNldCB8IGV4ZWMtPmJhdGNoX2xlbikg
JiAweDcpCiAJCXJldHVybiBmYWxzZTsKQEAgLTIwNDgsNiArMjA4MSw0MiBAQCBzdGF0aWMgaW50
IGViX3N1Ym1pdChzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYikKIAkJCXJldHVybiBlcnI7CiAJ
fQogCisJaWYgKGViLT5vYV9jb25maWcgJiYKKwkgICAgZWItPm9hX2NvbmZpZyAhPSBlYi0+aTkx
NS0+cGVyZi5vYS5leGNsdXNpdmVfc3RyZWFtLT5vYV9jb25maWcpIHsKKwkJc3RydWN0IGk5MTVf
dm1hICpvYV92bWE7CisKKwkJb2Ffdm1hID0gaTkxNV92bWFfaW5zdGFuY2UoZWItPm9hX2JvLAor
CQkJCQkgICAgICAmZWItPmVuZ2luZS0+aTkxNS0+Z2d0dC52bSwgTlVMTCk7CisJCWlmICh1bmxp
a2VseShJU19FUlIob2Ffdm1hKSkpIHsKKwkJCWVyciA9IFBUUl9FUlIob2Ffdm1hKTsKKwkJCXJl
dHVybiBlcnI7CisJCX0KKworCQllcnIgPSBpOTE1X3ZtYV9waW4ob2Ffdm1hLCAwLCAwLCBQSU5f
R0xPQkFMKTsKKwkJaWYgKGVycikKKwkJCXJldHVybiBlcnI7CisKKwkJZXJyID0gZWItPmVuZ2lu
ZS0+ZW1pdF9iYl9zdGFydChlYi0+cmVxdWVzdCwKKwkJCQkJCW9hX3ZtYS0+bm9kZS5zdGFydCwK
KwkJCQkJCTAsIEk5MTVfRElTUEFUQ0hfU0VDVVJFKTsKKwkJaWYgKGVycikgeworCQkJaTkxNV92
bWFfdW5waW4ob2Ffdm1hKTsKKwkJCXJldHVybiBlcnI7CisJCX0KKworCQllcnIgPSBpOTE1X3Zt
YV9tb3ZlX3RvX2FjdGl2ZShvYV92bWEsIGViLT5yZXF1ZXN0LCAwKTsKKwkJaWYgKGVycikgewor
CQkJaTkxNV92bWFfdW5waW4ob2Ffdm1hKTsKKwkJCXJldHVybiBlcnI7CisJCX0KKworCisJCWk5
MTVfdm1hX3VucGluKG9hX3ZtYSk7CisKKworCQlzd2FwKGViLT5vYV9jb25maWcsIGViLT5pOTE1
LT5wZXJmLm9hLmV4Y2x1c2l2ZV9zdHJlYW0tPm9hX2NvbmZpZyk7CisJfQorCiAJZXJyID0gZWIt
PmVuZ2luZS0+ZW1pdF9iYl9zdGFydChlYi0+cmVxdWVzdCwKIAkJCQkJZWItPmJhdGNoLT5ub2Rl
LnN0YXJ0ICsKIAkJCQkJZWItPmJhdGNoX3N0YXJ0X29mZnNldCwKQEAgLTIzNDEsNiArMjQxMCw3
IEBAIGk5MTVfZ2VtX2RvX2V4ZWNidWZmZXIoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAllYi5i
dWZmZXJfY291bnQgPSBhcmdzLT5idWZmZXJfY291bnQ7CiAJZWIuYmF0Y2hfc3RhcnRfb2Zmc2V0
ID0gYXJncy0+YmF0Y2hfc3RhcnRfb2Zmc2V0OwogCWViLmJhdGNoX2xlbiA9IGFyZ3MtPmJhdGNo
X2xlbjsKKwllYi5vYV9jb25maWcgPSBOVUxMOwogCiAJZWIuYmF0Y2hfZmxhZ3MgPSAwOwogCWlm
IChhcmdzLT5mbGFncyAmIEk5MTVfRVhFQ19TRUNVUkUpIHsKQEAgLTIzODUsMTcgKzI0NTUsMjkg
QEAgaTkxNV9nZW1fZG9fZXhlY2J1ZmZlcihzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCSAqLwog
CWludGVsX2d0X3BtX2dldChlYi5pOTE1KTsKIAotCWVyciA9IGk5MTVfbXV0ZXhfbG9ja19pbnRl
cnJ1cHRpYmxlKGRldik7Ci0JaWYgKGVycikKLQkJZ290byBlcnJfcnBtOwotCiAJZXJyID0gZWJf
c2VsZWN0X2VuZ2luZSgmZWIsIGZpbGUsIGFyZ3MpOwogCWlmICh1bmxpa2VseShlcnIpKQotCQln
b3RvIGVycl91bmxvY2s7CisJCWdvdG8gZXJyX3JwbTsKKworCWlmIChhcmdzLT5mbGFncyAmIEk5
MTVfRVhFQ19QRVJGX0NPTkZJRykgeworCQlpZiAoIWludGVsX2VuZ2luZV9oYXNfb2EoZWIuZW5n
aW5lKSkgeworCQkJZXJyID0gLUVOT0RFVjsKKwkJCWdvdG8gZXJyX2VuZ2luZTsKKwkJfQorCisJ
CWVyciA9IGdldF9leGVjYnVmX29hX2NvbmZpZyhlYi5pOTE1LCBhcmdzLT5EUjEsIGFyZ3MtPkRS
NCwKKwkJCQkJICAgICZlYi5vYV9jb25maWcsICZlYi5vYV9ibyk7CisJCWlmIChlcnIpCisJCQln
b3RvIGVycl9lbmdpbmU7CisJfQorCisJZXJyID0gaTkxNV9tdXRleF9sb2NrX2ludGVycnVwdGli
bGUoZGV2KTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl9vYTsKIAogCWVyciA9IGViX3dhaXRfZm9y
X3JpbmcoJmViKTsgLyogbWF5IHRlbXBvcmFyaWx5IGRyb3Agc3RydWN0X211dGV4ICovCiAJaWYg
KHVubGlrZWx5KGVycikpCi0JCWdvdG8gZXJyX2VuZ2luZTsKKwkJZ290byBlcnJfdW5sb2NrOwog
CiAJZXJyID0gZWJfcmVsb2NhdGUoJmViKTsKIAlpZiAoZXJyKSB7CkBAIC0yNTQxLDEwICsyNjIz
LDE1IEBAIGk5MTVfZ2VtX2RvX2V4ZWNidWZmZXIoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIGVy
cl92bWE6CiAJaWYgKGViLmV4ZWMpCiAJCWViX3JlbGVhc2Vfdm1hcygmZWIpOwotZXJyX2VuZ2lu
ZToKLQllYl91bnBpbl9jb250ZXh0KCZlYik7CiBlcnJfdW5sb2NrOgogCW11dGV4X3VubG9jaygm
ZGV2LT5zdHJ1Y3RfbXV0ZXgpOworZXJyX29hOgorCWlmIChlYi5vYV9jb25maWcpIHsKKwkJaTkx
NV9nZW1fb2JqZWN0X3B1dChlYi5vYV9ibyk7CisJCWk5MTVfb2FfY29uZmlnX3B1dChlYi5vYV9j
b25maWcpOworCX0KK2Vycl9lbmdpbmU6CisJZWJfdW5waW5fY29udGV4dCgmZWIpOwogZXJyX3Jw
bToKIAlpbnRlbF9ndF9wbV9wdXQoZWIuaTkxNSk7CiAJaTkxNV9nZW1fY29udGV4dF9wdXQoZWIu
Z2VtX2NvbnRleHQpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJm
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYwppbmRleCA3ZTBlYmQ0YmM4ZjIu
LjdiODYxZjEyZjE2MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJm
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKQEAgLTM2NSw3ICszNjUs
NyBAQCBzdHJ1Y3QgcGVyZl9vcGVuX3Byb3BlcnRpZXMgewogCWludCBvYV9wZXJpb2RfZXhwb25l
bnQ7CiB9OwogCi1zdGF0aWMgdm9pZCBwdXRfb2FfY29uZmlnKHN0cnVjdCBpOTE1X29hX2NvbmZp
ZyAqb2FfY29uZmlnKQordm9pZCBpOTE1X29hX2NvbmZpZ19wdXQoc3RydWN0IGk5MTVfb2FfY29u
ZmlnICpvYV9jb25maWcpCiB7CiAJaWYgKCFhdG9taWNfZGVjX2FuZF90ZXN0KCZvYV9jb25maWct
PnJlZl9jb3VudCkpCiAJCXJldHVybjsKQEAgLTUxNSw3ICs1MTUsNyBAQCBpbnQgaTkxNV9wZXJm
X2dldF9vYV9jb25maWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAKIGVycl9idWZf
YWxsb2M6CiAJaWYgKG91dF9jb25maWcpIHsKLQkJcHV0X29hX2NvbmZpZyhvYV9jb25maWcpOwor
CQlpOTE1X29hX2NvbmZpZ19wdXQob2FfY29uZmlnKTsKIAkJKm91dF9jb25maWcgPSBOVUxMOwog
CX0KIHVubG9jazoKQEAgLTE0OTYsNyArMTQ5Niw3IEBAIHN0YXRpYyB2b2lkIGk5MTVfb2Ffc3Ry
ZWFtX2Rlc3Ryb3koc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIAlpZiAoc3RyZWFt
LT5jdHgpCiAJCW9hX3B1dF9yZW5kZXJfY3R4X2lkKHN0cmVhbSk7CiAKLQlwdXRfb2FfY29uZmln
KHN0cmVhbS0+b2FfY29uZmlnKTsKKwlpOTE1X29hX2NvbmZpZ19wdXQoc3RyZWFtLT5vYV9jb25m
aWcpOwogCiAJaWYgKGRldl9wcml2LT5wZXJmLm9hLnNwdXJpb3VzX3JlcG9ydF9ycy5taXNzZWQp
IHsKIAkJRFJNX05PVEUoIiVkIHNwdXJpb3VzIE9BIHJlcG9ydCBub3RpY2VzIHN1cHByZXNzZWQg
ZHVlIHRvIHJhdGVsaW1pdGluZ1xuIiwKQEAgLTIyNjQsNyArMjI2NCw3IEBAIHN0YXRpYyBpbnQg
aTkxNV9vYV9zdHJlYW1faW5pdChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtLAogCWZy
ZWVfb2FfYnVmZmVyKGRldl9wcml2KTsKIAogZXJyX29hX2J1Zl9hbGxvYzoKLQlwdXRfb2FfY29u
ZmlnKHN0cmVhbS0+b2FfY29uZmlnKTsKKwlpOTE1X29hX2NvbmZpZ19wdXQoc3RyZWFtLT5vYV9j
b25maWcpOwogCiAJaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQoJmRldl9wcml2LT51bmNvcmUs
IEZPUkNFV0FLRV9BTEwpOwogCWludGVsX3J1bnRpbWVfcG1fcHV0KGRldl9wcml2LCBzdHJlYW0t
Pndha2VyZWYpOwpAQCAtMzQ0MSw3ICszNDQxLDcgQEAgaW50IGk5MTVfcGVyZl9hZGRfY29uZmln
X2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiBzeXNmc19lcnI6CiAJ
bXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2xvY2spOwogcmVnX2VycjoKLQlw
dXRfb2FfY29uZmlnKG9hX2NvbmZpZyk7CisJaTkxNV9vYV9jb25maWdfcHV0KG9hX2NvbmZpZyk7
CiAJRFJNX0RFQlVHKCJGYWlsZWQgdG8gYWRkIG5ldyBPQSBjb25maWdcbiIpOwogCXJldHVybiBl
cnI7CiB9CkBAIC0zNDk1LDcgKzM0OTUsNyBAQCBpbnQgaTkxNV9wZXJmX3JlbW92ZV9jb25maWdf
aW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAogCURSTV9ERUJVRygi
UmVtb3ZlZCBjb25maWcgJXMgaWQ9JWlcbiIsIG9hX2NvbmZpZy0+dXVpZCwgb2FfY29uZmlnLT5p
ZCk7CiAKLQlwdXRfb2FfY29uZmlnKG9hX2NvbmZpZyk7CisJaTkxNV9vYV9jb25maWdfcHV0KG9h
X2NvbmZpZyk7CiAKIGNvbmZpZ19lcnI6CiAJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cGVyZi5t
ZXRyaWNzX2xvY2spOwpAQCAtMzY1Nyw3ICszNjU3LDcgQEAgc3RhdGljIGludCBkZXN0cm95X2Nv
bmZpZyhpbnQgaWQsIHZvaWQgKnAsIHZvaWQgKmRhdGEpCiB7CiAJc3RydWN0IGk5MTVfb2FfY29u
ZmlnICpvYV9jb25maWcgPSBwOwogCi0JcHV0X29hX2NvbmZpZyhvYV9jb25maWcpOworCWk5MTVf
b2FfY29uZmlnX3B1dChvYV9jb25maWcpOwogCiAJcmV0dXJuIDA7CiB9CmRpZmYgLS1naXQgYS9p
bmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJtLmggYi9pbmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJtLmgK
aW5kZXggNTYwMWRjNjg4Mjk1Li5lNTdmYjVmMjQ5ZGEgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvdWFw
aS9kcm0vaTkxNV9kcm0uaAorKysgYi9pbmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJtLmgKQEAgLTYw
NCw2ICs2MDQsMTYgQEAgdHlwZWRlZiBzdHJ1Y3QgZHJtX2k5MTVfaXJxX3dhaXQgewogICovCiAj
ZGVmaW5lIEk5MTVfUEFSQU1fUEVSRl9SRVZJU0lPTgk1MwogCisvKgorICogUmVxdWVzdCBhbiBP
QSBwZXJmb3JtYW5jZSBjb25maWd1cmF0aW9uIGNoYW5nZSBiZWZvcmUgcnVubmluZyB0aGUgY29t
bWFuZHMKKyAqIGdpdmVuIGluIGFuIGV4ZWNidWYuCisgKgorICogUGVyZm9ybWFuY2UgY29uZmln
dXJhdGlvbiBJRCBpcyBnaXZlbiBpbiB0aGUgRFI0IGZpZWxkIG9mCisgKiBkcm1faTkxNV9nZW1f
ZXhlY2J1ZmZlcjIgYW5kIHRoZSBmaWxlIGRlc2NyaXB0b3Igb2YgdGhlIGk5MTUgcGVyZiBzdHJl
YW0gaXMKKyAqIGdpdmVuIGluIERSMS4gRXhlY2J1ZmZlciB3aWxsIGZhaWwgaWYgYW55IG9mIHRo
ZXNlIHBhcmFtZXRlciBpcyBpbnZhbGlkLgorICovCisjZGVmaW5lIEk5MTVfUEFSQU1fSEFTX0VY
RUNfUEVSRl9DT05GSUcgNTQKKwogLyogTXVzdCBiZSBrZXB0IGNvbXBhY3QgLS0gbm8gaG9sZXMg
YW5kIHdlbGwgZG9jdW1lbnRlZCAqLwogCiB0eXBlZGVmIHN0cnVjdCBkcm1faTkxNV9nZXRwYXJh
bSB7CkBAIC0xMTI2LDcgKzExMzYsMTUgQEAgc3RydWN0IGRybV9pOTE1X2dlbV9leGVjYnVmZmVy
MiB7CiAgKi8KICNkZWZpbmUgSTkxNV9FWEVDX0ZFTkNFX0FSUkFZICAgKDE8PDE5KQogCi0jZGVm
aW5lIF9fSTkxNV9FWEVDX1VOS05PV05fRkxBR1MgKC0oSTkxNV9FWEVDX0ZFTkNFX0FSUkFZPDwx
KSkKKy8qIFJlcXVlc3QgdGhhdCBwZXJmIG1vbml0b3JpbmcgaGFyZHdhcmUgYmUgcmVwcm9ncmFt
bWVkIGJlZm9yZSBleGVjdXRpbmcgdGhlCisgKiBjb21tYW5kcyBmcm9tIHRoZSBiYXRjaCBpbiB0
aGUgZXhlY2J1Zi4gVGhlIERSMSAmIERSNCBmaWVsZHMgb2YgdGhlIGV4ZWNidWYKKyAqIG11c3Qg
cmVzcGVjdGl2ZWx5IGNvbnRhaW4gdGhlIGZpbGUgZGVzY3JpcHRvciBvZiB0aGUgcGVyZiBtb25p
dG9yaW5nIGRldmljZQorICogYW5kIHRoZSBjb25maWd1cmF0aW9uIHRvIHByb2dyYW0uCisgKi8K
KyNkZWZpbmUgSTkxNV9FWEVDX1BFUkZfQ09ORklHICAgKDE8PDIwKQorCisKKyNkZWZpbmUgX19J
OTE1X0VYRUNfVU5LTk9XTl9GTEFHUyAoLShJOTE1X0VYRUNfUEVSRl9DT05GSUc8PDEpKQogCiAj
ZGVmaW5lIEk5MTVfRVhFQ19DT05URVhUX0lEX01BU0sJKDB4ZmZmZmZmZmYpCiAjZGVmaW5lIGk5
MTVfZXhlY2J1ZmZlcjJfc2V0X2NvbnRleHRfaWQoZWIyLCBjb250ZXh0KSBcCi0tIAoyLjIxLjAu
MzkyLmdmOGY2Nzg3MTU5ZQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50
ZWwtZ2Z4

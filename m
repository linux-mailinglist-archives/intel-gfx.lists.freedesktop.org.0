Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 9C48388461
	for <lists+intel-gfx@lfdr.de>; Fri,  9 Aug 2019 23:01:58 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0F5726EE9D;
	Fri,  9 Aug 2019 21:01:57 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B9EF96EE9D
 for <intel-gfx@lists.freedesktop.org>; Fri,  9 Aug 2019 21:01:55 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17948009-1500050 
 for multiple; Fri, 09 Aug 2019 22:01:44 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  9 Aug 2019 22:01:41 +0100
Message-Id: <20190809210142.30619-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190809210142.30619-1-chris@chris-wilson.co.uk>
References: <20190809210142.30619-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 1/2] drm/i915: Push the wakeref->count deferral
 to the backend
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SWYgdGhlIGJhY2tlbmQgd2lzaGVzIHRvIGRlZmVyIHRoZSB3YWtlcmVmIHBhcmtpbmcsIG1ha2Ug
aXQgcmVzcG9uc2libGUKZm9yIHVubG9ja2luZyB0aGUgd2FrZXJlZiAoaS5lLiBidW1waW5nIHRo
ZSBjb3VudGVyKS4gVGhpcyBhbGxvd3MgaXQgdG8KdGltZSB0aGUgdW5sb2NrIG11Y2ggbW9yZSBj
YXJlZnVsbHkgaW4gY2FzZSBpdCBoYXBwZW5zIHRvIG5lZWRzIHRoZQp3YWtlcmVmIHRvIGJlIGFj
dGl2ZSBkdXJpbmcgaXRzIGRlZmVycmFsLgoKRm9yIGluc3RhbmNlLCBkdXJpbmcgZW5naW5lIHBh
cmtpbmcgd2UgbWF5IGNob29zZSB0byBlbWl0IGFuIGlkbGUKYmFycmllciAoYSByZXF1ZXN0KS4g
VG8gZG8gc28sIHdlIGJvcnJvdyB0aGUgZW5naW5lLT5rZXJuZWxfY29udGV4dAp0aW1lbGluZSBh
bmQgdG8gZW5zdXJlIGV4Y2x1c2l2ZSBhY2Nlc3Mgd2Uga2VlcCB0aGUKZW5naW5lLT53YWtlcmVm
LmNvdW50IGFzIDAuIEhvd2V2ZXIsIHRvIHN1Ym1pdCB0aGF0IHJlcXVlc3QgdG8gSFcgbWF5CnJl
cXVpcmUgYSBpbnRlbF9lbmdpbmVfcG1fZ2V0KCkgKGUuZy4gdG8ga2VlcCB0aGUgc3VibWlzc2lv
biB0YXNrbGV0CmFsaXZlKSBhbmQgYmVmb3JlIHdlIGFsbG93IHRoYXQgd2UgaGF2ZSB0byByZXdh
a2Ugb3VyIHdha2VyZWYgdG8gYXZvaWQgYQpyZWN1cnNpdmUgZGVhZGxvY2suCgpTaWduZWQtb2Zm
LWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IERhbmllbGUg
Q2VyYW9sbyBTcHVyaW8gPGRhbmllbGUuY2VyYW9sb3NwdXJpb0BpbnRlbC5jb20+Ci0tLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMgfCAgNCArKystCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYyAgICAgICB8IDEwICsrKysrKysrLS0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5oICAgICAgIHwgIDEgKwogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaW50ZWxfd2FrZXJlZi5jICAgICAgfCAgNCArLS0tCiA0IGZpbGVzIGNoYW5nZWQs
IDEzIGluc2VydGlvbnMoKyksIDYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9lbmdpbmVfcG0uYwppbmRleCA2YjE1ZTMzMzVkZDYuLmNhMTI5MzhkOWY4ZCAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMKQEAgLTY4LDkgKzY4LDEx
IEBAIHN0YXRpYyBib29sIHN3aXRjaF90b19rZXJuZWxfY29udGV4dChzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmUpCiAKIAkvKiBDaGVjayBhZ2FpbiBvbiB0aGUgbmV4dCByZXRpcmVtZW50
LiAqLwogCWVuZ2luZS0+d2FrZXJlZl9zZXJpYWwgPSBlbmdpbmUtPnNlcmlhbCArIDE7Ci0KIAlp
OTE1X3JlcXVlc3RfYWRkX2FjdGl2ZV9iYXJyaWVycyhycSk7CisKIAlfX2k5MTVfcmVxdWVzdF9j
b21taXQocnEpOworCWF0b21pY19pbmMoJmVuZ2luZS0+d2FrZXJlZi5jb3VudCk7CisJX19pOTE1
X3JlcXVlc3RfcXVldWUocnEpOwogCiAJcmV0dXJuIGZhbHNlOwogfQpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3JlcXVlc3QuYwppbmRleCA0MzE3NWJhZGEwOWUuLjNhMDc2MGFkNTZlYiAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKQEAgLTExODYsNiArMTE4NiwxMyBAQCBzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpfX2k5MTVfcmVxdWVzdF9jb21taXQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEp
CiAJCWxpc3RfYWRkKCZyaW5nLT5hY3RpdmVfbGluaywgJnJxLT5pOTE1LT5ndC5hY3RpdmVfcmlu
Z3MpOwogCXJxLT5lbWl0dGVkX2ppZmZpZXMgPSBqaWZmaWVzOwogCisJcmV0dXJuIHByZXY7Cit9
CisKK3ZvaWQgX19pOTE1X3JlcXVlc3RfcXVldWUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCit7
CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lID0gcnEtPmVuZ2luZTsKKwogCS8qCiAJ
ICogTGV0IHRoZSBiYWNrZW5kIGtub3cgYSBuZXcgcmVxdWVzdCBoYXMgYXJyaXZlZCB0aGF0IG1h
eSBuZWVkCiAJICogdG8gYWRqdXN0IHRoZSBleGlzdGluZyBleGVjdXRpb24gc2NoZWR1bGUgZHVl
IHRvIGEgaGlnaCBwcmlvcml0eQpAQCAtMTIzMCw4ICsxMjM3LDYgQEAgc3RydWN0IGk5MTVfcmVx
dWVzdCAqX19pOTE1X3JlcXVlc3RfY29tbWl0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCX0K
IAlpOTE1X3N3X2ZlbmNlX2NvbW1pdCgmcnEtPnN1Ym1pdCk7CiAJbG9jYWxfYmhfZW5hYmxlKCk7
IC8qIEtpY2sgdGhlIGV4ZWNsaXN0cyB0YXNrbGV0IGlmIGp1c3Qgc2NoZWR1bGVkICovCi0KLQly
ZXR1cm4gcHJldjsKIH0KIAogdm9pZCBpOTE1X3JlcXVlc3RfYWRkKHN0cnVjdCBpOTE1X3JlcXVl
c3QgKnJxKQpAQCAtMTI0NCw2ICsxMjQ5LDcgQEAgdm9pZCBpOTE1X3JlcXVlc3RfYWRkKHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxKQogCXRyYWNlX2k5MTVfcmVxdWVzdF9hZGQocnEpOwogCiAJcHJl
diA9IF9faTkxNV9yZXF1ZXN0X2NvbW1pdChycSk7CisJX19pOTE1X3JlcXVlc3RfcXVldWUocnEp
OwogCiAJLyoKIAkgKiBJbiB0eXBpY2FsIHNjZW5hcmlvcywgd2UgZG8gbm90IGV4cGVjdCB0aGUg
cHJldmlvdXMgcmVxdWVzdCBvbgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9yZXF1ZXN0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaAppbmRleCAz
MTNkZjNjMzcxNTguLjk4NGM4MjA1YTE4NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9yZXF1ZXN0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0
LmgKQEAgLTI1MSw2ICsyNTEsNyBAQCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICogX19tdXN0X2NoZWNr
CiBpOTE1X3JlcXVlc3RfY3JlYXRlKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSk7CiAKIHN0cnVj
dCBpOTE1X3JlcXVlc3QgKl9faTkxNV9yZXF1ZXN0X2NvbW1pdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpyZXF1ZXN0KTsKK3ZvaWQgX19pOTE1X3JlcXVlc3RfcXVldWUoc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnEpOwogCiB2b2lkIGk5MTVfcmVxdWVzdF9yZXRpcmVfdXB0byhzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2Vy
ZWYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYuYwppbmRleCBkNDQ0M2U4
MWMxYzguLjg2OGNjNzgwNDhkMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfd2FrZXJlZi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYuYwpA
QCAtNTcsMTIgKzU3LDEwIEBAIHN0YXRpYyB2b2lkIF9fX19pbnRlbF93YWtlcmVmX3B1dF9sYXN0
KHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZikKIAlpZiAoIWF0b21pY19kZWNfYW5kX3Rlc3QoJndm
LT5jb3VudCkpCiAJCWdvdG8gdW5sb2NrOwogCisJLyogb3BzLT5wdXQoKSBtdXN0IHJlc2NoZWR1
bGUgaXRzIG93biByZWxlYXNlIG9uIGVycm9yL2RlZmVycmFsICovCiAJaWYgKGxpa2VseSghd2Yt
Pm9wcy0+cHV0KHdmKSkpIHsKIAkJcnBtX3B1dCh3Zik7CiAJCXdha2VfdXBfdmFyKCZ3Zi0+d2Fr
ZXJlZik7Ci0JfSBlbHNlIHsKLQkJLyogb3BzLT5wdXQoKSBtdXN0IHNjaGVkdWxlIGl0cyBvd24g
cmVsZWFzZSBvbiBkZWZlcnJhbCAqLwotCQlhdG9taWNfc2V0X3JlbGVhc2UoJndmLT5jb3VudCwg
MSk7CiAJfQogCiB1bmxvY2s6Ci0tIAoyLjIzLjAucmMxCgpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdm
eEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFp
bG1hbi9saXN0aW5mby9pbnRlbC1nZng=

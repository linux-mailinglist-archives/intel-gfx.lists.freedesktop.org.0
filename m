Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id B4BA4294E6A
	for <lists+intel-gfx@lfdr.de>; Wed, 21 Oct 2020 16:22:09 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 203576EDAA;
	Wed, 21 Oct 2020 14:22:08 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga14.intel.com (mga14.intel.com [192.55.52.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 77B766EDAA
 for <intel-gfx@lists.freedesktop.org>; Wed, 21 Oct 2020 14:22:06 +0000 (UTC)
IronPort-SDR: WVWSIq0KSsWC6NaQ+c44Yt04eQj+48vzS9ShQkY486G1jn+41IN3HAWRd78yy8sbMQDfpX4ir6
 tbs4o5X6nWKg==
X-IronPort-AV: E=McAfee;i="6000,8403,9780"; a="166596940"
X-IronPort-AV: E=Sophos;i="5.77,401,1596524400"; d="scan'208";a="166596940"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga005.fm.intel.com ([10.253.24.32])
 by fmsmga103.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 21 Oct 2020 07:22:06 -0700
IronPort-SDR: aBeh6YHtdZFmUYNqmlK5m4X/Nq7HU3GTM6mHQykvsMRs92yvMrz4/ZQd4/3hrerNgEzma33dnF
 z/DMkJW+LUlQ==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.77,401,1596524400"; d="scan'208";a="523907977"
Received: from shawnle1-build-machine.itwn.intel.com ([10.5.253.9])
 by fmsmga005.fm.intel.com with ESMTP; 21 Oct 2020 07:22:04 -0700
From: Lee Shawn C <shawn.c.lee@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 21 Oct 2020 22:24:50 +0800
Message-Id: <20201021142450.7758-1-shawn.c.lee@intel.com>
X-Mailer: git-send-email 2.17.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: wait PSR state back to idle when turn
 PSR off
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Cooper Chiou <cooper.chiou@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RHJpdmVyIHNob3VsZCByZWZlciB0byBjb21taXQgJ2IyZmMyMjUyY2U0MSAoImRybS9pOTE1L3Bz
cjoKQWx3YXlzIHdhaXQgZm9yIGlkbGUgc3RhdGUgd2hlbiBkaXNhYmxpbmcgUFNSIiknIHRvIHdh
aXQgZm9yCmlkbGUgc3RhdGUgd2hlbiB0dXJuIFBTUiBvZmYuIEJ1dCBpdCBkaWQgbm90IGZvbGxv
dwpwcmV2aW91cyBtZXRob2QuIERyaXZlciBqdXN0IGNhbGwgaW50ZWxfcHNyX2V4aXQoKSBpbgpp
bnRlbF9wc3JfaW52YWxpZGF0ZSgpIGFuZCBwc3JfZm9yY2VfaHdfdHJhY2tpbmdfZXhpdCgpLgpU
aGVuIGxlYXZlIHRoZSBmdW5jdGlvbiByaWdodCBhd2F5LgoKQWZ0ZXIgUFNSIGRpc2FibGVkLCB3
ZSBmb3VuZCBzb21lIHVzZXIgc3BhY2UgYXBwbGljYXRpb25zCndvdWxkIGVuYWJsZWQgUFNSIGFn
YWluIGltbWVkaWF0ZWx5LiBUaGF0IGNhdXNlZCBwYXJ0aWN1bGFyClRDT04gdG8gZ2V0IGludG8g
aW5jb3JyZWN0IHN0YXRlIG1hY2hpbmUgYW5kIGNhbid0IHJlY29nbml6ZQp2aWRlbyBkYXRhIGZy
b20gc291cmNlIHByb3Blcmx5LgoKQWRkIHRoaXMgY2hhbmdlIHRvIHdhaXQgUFNSIGlkbGUgc3Rh
dGUgaW4gaW50ZWxfcHNyX2ludmFsaWRhdGUoKQphbmQgcHNyX2ZvcmNlX2h3X3RyYWNraW5nX2V4
aXQoKS4gVGhpcyBzeW1wdG9tIGlzIG5vdCBhYmxlCnRvIHJlcGxpY2F0ZSBhbnltb3JlLgoKRml4
ZXM6IGIyZmMyMjUyY2U0MSAoZHJtL2k5MTUvcHNyOiBBbHdheXMgd2FpdCBmb3IgaWRsZSBzdGF0
ZQp3aGVuIGRpc2FibGluZyBQU1IpLgoKQ2M6IE1hbmFzaSBOYXZhcmUgPG1hbmFzaS5kLm5hdmFy
ZUBpbnRlbC5jb20+CkNjOiBKYW5pIE5pa3VsYSA8amFuaS5uaWt1bGFAbGludXguaW50ZWwuY29t
PgpDYzogVmlsbGUgU3lyamFsYSA8dmlsbGUuc3lyamFsYUBsaW51eC5pbnRlbC5jb20+CkNjOiBK
b3PDqSBSb2JlcnRvIGRlIFNvdXphIDxqb3NlLnNvdXphQGludGVsLmNvbT4KQ2M6IENvb3BlciBD
aGlvdSA8Y29vcGVyLmNoaW91QGludGVsLmNvbT4KQ2M6IEtoYWxlZCBBbG1haGFsbGF3eSA8a2hh
bGVkLmFsbWFoYWxsYXd5QGludGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogTGVlIFNoYXduIEMgPHNo
YXduLmMubGVlQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX3Bzci5jIHwgNDMgKysrKysrKysrKysrKystLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwg
MjYgaW5zZXJ0aW9ucygrKSwgMTcgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfcHNyLmMKaW5kZXggYTU5MWE0NzVmMTQ4Li44M2I2NDJhNTU2N2UgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYwpAQCAtMTAzNiw2ICsxMDM2LDI1
IEBAIHZvaWQgaW50ZWxfcHNyX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCW11
dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKIH0KIAorc3RhdGljIHZvaWQgaW50ZWxf
cHNyX3dhaXRfaWRsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit7CisJaTkx
NV9yZWdfdCBwc3Jfc3RhdHVzOworCXUzMiBwc3Jfc3RhdHVzX21hc2s7CisKKwlpZiAoZGV2X3By
aXYtPnBzci5wc3IyX2VuYWJsZWQpIHsKKwkJcHNyX3N0YXR1cyA9IEVEUF9QU1IyX1NUQVRVUyhk
ZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpOworCQlwc3Jfc3RhdHVzX21hc2sgPSBFRFBfUFNSMl9T
VEFUVVNfU1RBVEVfTUFTSzsKKwl9IGVsc2UgeworCQlwc3Jfc3RhdHVzID0gRURQX1BTUl9TVEFU
VVMoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKTsKKwkJcHNyX3N0YXR1c19tYXNrID0gRURQX1BT
Ul9TVEFUVVNfU1RBVEVfTUFTSzsKKwl9CisKKwkvKiBXYWl0IHRpbGwgUFNSIGlzIGlkbGUgKi8K
KwlpZiAoaW50ZWxfZGVfd2FpdF9mb3JfY2xlYXIoZGV2X3ByaXYsIHBzcl9zdGF0dXMsCisJCQkJ
ICAgIHBzcl9zdGF0dXNfbWFzaywgMjAwMCkpCisJCWRybV9lcnIoJmRldl9wcml2LT5kcm0sICJU
aW1lZCBvdXQgd2FpdGluZyBQU1IgaWRsZSBzdGF0ZVxuIik7Cit9CisKIHN0YXRpYyB2b2lkIGlu
dGVsX3Bzcl9leGl0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKIAl1MzIg
dmFsOwpAQCAtMTA3Niw4ICsxMDk1LDYgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHNyX2V4aXQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogc3RhdGljIHZvaWQgaW50ZWxfcHNyX2Rp
c2FibGVfbG9ja2VkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CiAJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7Ci0JaTkxNV9yZWdf
dCBwc3Jfc3RhdHVzOwotCXUzMiBwc3Jfc3RhdHVzX21hc2s7CiAKIAlsb2NrZGVwX2Fzc2VydF9o
ZWxkKCZkZXZfcHJpdi0+cHNyLmxvY2spOwogCkBAIC0xMDg4LDE5ICsxMTA1LDcgQEAgc3RhdGlj
IHZvaWQgaW50ZWxfcHNyX2Rpc2FibGVfbG9ja2VkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAp
CiAJCSAgICBkZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxlZCA/ICIyIiA6ICIxIik7CiAKIAlpbnRl
bF9wc3JfZXhpdChkZXZfcHJpdik7Ci0KLQlpZiAoZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQp
IHsKLQkJcHNyX3N0YXR1cyA9IEVEUF9QU1IyX1NUQVRVUyhkZXZfcHJpdi0+cHNyLnRyYW5zY29k
ZXIpOwotCQlwc3Jfc3RhdHVzX21hc2sgPSBFRFBfUFNSMl9TVEFUVVNfU1RBVEVfTUFTSzsKLQl9
IGVsc2UgewotCQlwc3Jfc3RhdHVzID0gRURQX1BTUl9TVEFUVVMoZGV2X3ByaXYtPnBzci50cmFu
c2NvZGVyKTsKLQkJcHNyX3N0YXR1c19tYXNrID0gRURQX1BTUl9TVEFUVVNfU1RBVEVfTUFTSzsK
LQl9Ci0KLQkvKiBXYWl0IHRpbGwgUFNSIGlzIGlkbGUgKi8KLQlpZiAoaW50ZWxfZGVfd2FpdF9m
b3JfY2xlYXIoZGV2X3ByaXYsIHBzcl9zdGF0dXMsCi0JCQkJICAgIHBzcl9zdGF0dXNfbWFzaywg
MjAwMCkpCi0JCWRybV9lcnIoJmRldl9wcml2LT5kcm0sICJUaW1lZCBvdXQgd2FpdGluZyBQU1Ig
aWRsZSBzdGF0ZVxuIik7CisJaW50ZWxfcHNyX3dhaXRfaWRsZShkZXZfcHJpdik7CiAKIAkvKiBX
QSAxNDA4MzMwODQ3ICovCiAJaWYgKGRldl9wcml2LT5wc3IucHNyMl9zZWxfZmV0Y2hfZW5hYmxl
ZCAmJgpAQCAtMTE1OCwxMiArMTE2MywxNCBAQCBzdGF0aWMgdm9pZCBwc3JfZm9yY2VfaHdfdHJh
Y2tpbmdfZXhpdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCSAqIHBpcGUu
CiAJCSAqLwogCQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgQ1VSU1VSRkxJVkUoZGV2X3ByaXYt
PnBzci5waXBlKSwgMCk7Ci0JZWxzZQorCWVsc2UgewogCQkvKgogCQkgKiBBIHdyaXRlIHRvIENV
UlNVUkZMSVZFIGRvIG5vdCBjYXVzZSBIVyB0cmFja2luZyB0byBleGl0IFBTUgogCQkgKiBvbiBv
bGRlciBnZW5zIHNvIGRvaW5nIHRoZSBtYW51YWwgZXhpdCBpbnN0ZWFkLgogCQkgKi8KIAkJaW50
ZWxfcHNyX2V4aXQoZGV2X3ByaXYpOworCQlpbnRlbF9wc3Jfd2FpdF9pZGxlKGRldl9wcml2KTsK
Kwl9CiB9CiAKIHZvaWQgaW50ZWxfcHNyMl9wcm9ncmFtX3BsYW5lX3NlbF9mZXRjaChzdHJ1Y3Qg
aW50ZWxfcGxhbmUgKnBsYW5lLApAQCAtMTU5Myw4ICsxNjAwLDEwIEBAIHZvaWQgaW50ZWxfcHNy
X2ludmFsaWRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCWZyb250YnVm
ZmVyX2JpdHMgJj0gSU5URUxfRlJPTlRCVUZGRVJfQUxMX01BU0soZGV2X3ByaXYtPnBzci5waXBl
KTsKIAlkZXZfcHJpdi0+cHNyLmJ1c3lfZnJvbnRidWZmZXJfYml0cyB8PSBmcm9udGJ1ZmZlcl9i
aXRzOwogCi0JaWYgKGZyb250YnVmZmVyX2JpdHMpCisJaWYgKGZyb250YnVmZmVyX2JpdHMpIHsK
IAkJaW50ZWxfcHNyX2V4aXQoZGV2X3ByaXYpOworCQlpbnRlbF9wc3Jfd2FpdF9pZGxlKGRldl9w
cml2KTsKKwl9CiAKIAltdXRleF91bmxvY2soJmRldl9wcml2LT5wc3IubG9jayk7CiB9Ci0tIAoy
LjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCklu
dGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

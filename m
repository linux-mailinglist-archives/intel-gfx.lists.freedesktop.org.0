Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7638F1D781A
	for <lists+intel-gfx@lfdr.de>; Mon, 18 May 2020 14:05:59 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9E59C6E413;
	Mon, 18 May 2020 12:05:56 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga17.intel.com (mga17.intel.com [192.55.52.151])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 90F6C6E155
 for <intel-gfx@lists.freedesktop.org>; Mon, 18 May 2020 12:05:54 +0000 (UTC)
IronPort-SDR: /2qgNcyH4+CK0RelnuVUxxGAeaBvkJxNnMJZMs5JOkFKjPysrXjXWjIRGAyPYo0bdUG5xSC1oO
 aeTY2FAljSpA==
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga007.jf.intel.com ([10.7.209.58])
 by fmsmga107.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 18 May 2020 05:05:54 -0700
IronPort-SDR: A4HuvpOrGx+MOkphhHQT7+Ln0eNg/RzLscYm0QXi/VLRRGP1U7FtXx5tfYNT6aX8vlGG3wz3So
 qTxOxJV5paVA==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.73,407,1583222400"; d="scan'208";a="252871764"
Received: from unknown (HELO amanna.iind.intel.com) ([10.223.74.53])
 by orsmga007.jf.intel.com with ESMTP; 18 May 2020 05:05:51 -0700
From: Animesh Manna <animesh.manna@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 18 May 2020 17:22:59 +0530
Message-Id: <20200518115259.14025-1-animesh.manna@intel.com>
X-Mailer: git-send-email 2.26.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v9] drm/i915/dsb: Pre allocate and late cleanup
 of cmd buffer
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Jani Nikula <jani.nikula@intel.com>, Daniel Vetter <daniel.vetter@ffwll.ch>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UHJlLWFsbG9jYXRlIGNvbW1hbmQgYnVmZmVyIGluIGF0b21pY19jb21taXQgdXNpbmcgaW50ZWxf
ZHNiX3ByZXBhcmUKZnVuY3Rpb24gd2hpY2ggYWxzbyBpbmNsdWRlcyBwaW5uaW5nIGFuZCBtYXAg
aW4gY3B1IGRvbWFpbi4KCk5vIGZ1bmN0aW9uYWwgY2hhbmdlIGlzIGRzYiB3cml0ZS9jb21taXQg
ZnVuY3Rpb25zLgoKTm93IGRzYiBnZXQvcHV0IGZ1bmN0aW9uIGlzIHJlbW92ZWQgYW5kIHJlZi1j
b3VudCBtZWNoYW5pc20gaXMKbm90IG5lZWRlZC4gQmVsb3cgZHNiIGFwaSBhZGRlZCB0byBkbyBy
ZXNwZWN0aXZlIGpvYiBtZW50aW9uZWQKYmVsb3cuCgppbnRlbF9kc2JfcHJlcGFyZSAtIEFsbG9j
YXRlLCBwaW4gYW5kIG1hcCB0aGUgYnVmZmVyLgppbnRlbF9kc2JfY2xlYW51cCAtIFVucGluIGFu
ZCByZWxlYXNlIHRoZSBnZW0gb2JqZWN0LgoKUkZDOiBJbml0aWFsIHBhdGNoIGZvciBkZXNpZ24g
cmV2aWV3Lgp2MjogaW5jbHVkZWQgX2luaXQoKSBwYXJ0IGluIF9wcmVwYXJlKCkuIFtEYW5pZWws
IFZpbGxlXQp2MzogZHNiX2NsZWFudXAgY2FsbGVkIGFmdGVyIGNsZWFudXBfcGxhbmVzLiBbRGFu
aWVsXQp2NDogZHNiIHN0cnVjdHVyZSBpcyBtb3ZlZCB0byBpbnRlbF9jcnRjX3N0YXRlIGZyb20g
aW50ZWxfY3J0Yy4gW01hYXJ0ZW5dCnY1OiBkc2IgZ2V0L3B1dC9yZWYtY291bnQgbWVjaGFuaXNt
IHJlbW92ZWQuIFtNYWFydGVuXQp2NjogQmFzZWQgb24gcmV2aWV3IGZlZWRiYWNrIGZvbGxvd2lu
ZyBjaGFuZ2VzIGFyZSBhZGRlZCwKLSByZXBsYWNlZCBpbnRlbF9kc2Igc3RydWN0dXJlIGJ5IHBv
aW50ZXIgaW4gaW50ZWxfY3J0Y19zdGF0ZS4gW01hYXJ0ZW5dCi0gcGFzc2luZyBpbnRlbF9jcnRj
X3N0YXRlIHRvIGRzcC1hcGkgdG8gc2ltcGxpZnkgdGhlIGNvZGUuIFtNYWFydGVuXQotIGZldyBk
c2IgZnVuY3Rpb25zIHByb3RvdHlwZSBtb2RpZmllZCB0byBzaW1wbGlmeSBjb2RlLgp2NzogYWRk
ZWQgZmV3IGNvc21ldGljIGNoYW5nZXMgc3VnZ2VzdGVkIGJ5IEphbmkgYW5kIG51bGwgY2hlY2sg
Zm9yCmNydGNfc3RhdGUgaW4gZHNiX2NsZWFudXAgcmVtb3ZlZCBhcyBzdWdnZXN0ZWQgYnkgTWFh
cnRlbi4Kdjg6IGNoYW5nZWQgdGhlIGZ1bmN0aW9uIHBhcmFtZXRlciB0byBpbnRlbF9jcnRjX3N0
YXRlKiBvZgppdmJfbG9hZF9sdXRfZXh0X21heCgpIGZyb20gaW50ZWxfY3J0Yy4gW01hYXJ0ZW5d
CnY5OiBlcnJvciBoYW5kbGluZyBpbXByb3ZlZCBpbiBfd3JpdGUoKSBhbmQgcHJlcGFyZSgpLiBb
TWFhcnRlbl0KCkNjOiBNYWFydGVuIExhbmtob3JzdCA8bWFhcnRlbi5sYW5raG9yc3RAbGludXgu
aW50ZWwuY29tPgpDYzogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVs
LmNvbT4KQ2M6IEphbmkgTmlrdWxhIDxqYW5pLm5pa3VsYUBpbnRlbC5jb20+CkNjOiBEYW5pZWwg
VmV0dGVyIDxkYW5pZWwudmV0dGVyQGZmd2xsLmNoPgpBY2tlZC1ieTogRGFuaWVsIFZldHRlciA8
ZGFuaWVsLnZldHRlckBmZndsbC5jaD4KU2lnbmVkLW9mZi1ieTogQW5pbWVzaCBNYW5uYSA8YW5p
bWVzaC5tYW5uYUBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9hdG9taWMuYyAgIHwgICAzICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfY29sb3IuYyAgICB8ICA2NiArKy0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kaXNwbGF5LmMgIHwgIDU4ICsrKy0KIC4uLi9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rp
c3BsYXlfdHlwZXMuaCAgICB8ICAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kc2IuYyAgICAgIHwgMjQ4ICsrKysrKysrLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kc2IuaCAgICAgIHwgIDE3ICstCiA2IGZpbGVzIGNoYW5nZWQs
IDIwNCBpbnNlcnRpb25zKCspLCAxOTQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljLmMKaW5kZXggZDA0MzA1N2QyZmEwLi4zY2I4NjZmMjJl
NzQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWlj
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYwpAQCAt
MjUyLDYgKzI1Miw3IEBAIGludGVsX2NydGNfZHVwbGljYXRlX3N0YXRlKHN0cnVjdCBkcm1fY3J0
YyAqY3J0YykKIAljcnRjX3N0YXRlLT53bS5uZWVkX3Bvc3R2YmxfdXBkYXRlID0gZmFsc2U7CiAJ
Y3J0Y19zdGF0ZS0+ZmJfYml0cyA9IDA7CiAJY3J0Y19zdGF0ZS0+dXBkYXRlX3BsYW5lcyA9IDA7
CisJY3J0Y19zdGF0ZS0+ZHNiID0gTlVMTDsKIAogCXJldHVybiAmY3J0Y19zdGF0ZS0+dWFwaTsK
IH0KQEAgLTI5Miw2ICsyOTMsOCBAQCBpbnRlbF9jcnRjX2Rlc3Ryb3lfc3RhdGUoc3RydWN0IGRy
bV9jcnRjICpjcnRjLAogewogCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlID0g
dG9faW50ZWxfY3J0Y19zdGF0ZShzdGF0ZSk7CiAKKwlkcm1fV0FSTl9PTihjcnRjLT5kZXYsIGNy
dGNfc3RhdGUtPmRzYik7CisKIAlfX2RybV9hdG9taWNfaGVscGVyX2NydGNfZGVzdHJveV9zdGF0
ZSgmY3J0Y19zdGF0ZS0+dWFwaSk7CiAJaW50ZWxfY3J0Y19mcmVlX2h3X3N0YXRlKGNydGNfc3Rh
dGUpOwogCWtmcmVlKGNydGNfc3RhdGUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9jb2xvci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9jb2xvci5jCmluZGV4IDk4ZWNlOWNkN2NkZC4uOTQ1YmIwM2JkZDRkIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NvbG9yLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jb2xvci5jCkBAIC03MTQsMTYgKzcxNCwxNiBA
QCBzdGF0aWMgdm9pZCBiZHdfbG9hZF9sdXRfMTAoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJ
aW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIFBSRUNfUEFMX0lOREVYKHBpcGUpLCAwKTsKIH0KIAot
c3RhdGljIHZvaWQgaXZiX2xvYWRfbHV0X2V4dF9tYXgoc3RydWN0IGludGVsX2NydGMgKmNydGMp
CitzdGF0aWMgdm9pZCBpdmJfbG9hZF9sdXRfZXh0X21heChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2lu
dGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfZHNi
ICpkc2IgPSBpbnRlbF9kc2JfZ2V0KGNydGMpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlw
ZTsKIAogCS8qIFByb2dyYW0gdGhlIG1heCByZWdpc3RlciB0byBjbGFtcCB2YWx1ZXMgPiAxLjAu
ICovCi0JaW50ZWxfZHNiX3JlZ193cml0ZShkc2IsIFBSRUNfUEFMX0VYVF9HQ19NQVgocGlwZSwg
MCksIDEgPDwgMTYpOwotCWludGVsX2RzYl9yZWdfd3JpdGUoZHNiLCBQUkVDX1BBTF9FWFRfR0Nf
TUFYKHBpcGUsIDEpLCAxIDw8IDE2KTsKLQlpbnRlbF9kc2JfcmVnX3dyaXRlKGRzYiwgUFJFQ19Q
QUxfRVhUX0dDX01BWChwaXBlLCAyKSwgMSA8PCAxNik7CisJaW50ZWxfZHNiX3JlZ193cml0ZShj
cnRjX3N0YXRlLCBQUkVDX1BBTF9FWFRfR0NfTUFYKHBpcGUsIDApLCAxIDw8IDE2KTsKKwlpbnRl
bF9kc2JfcmVnX3dyaXRlKGNydGNfc3RhdGUsIFBSRUNfUEFMX0VYVF9HQ19NQVgocGlwZSwgMSks
IDEgPDwgMTYpOworCWludGVsX2RzYl9yZWdfd3JpdGUoY3J0Y19zdGF0ZSwgUFJFQ19QQUxfRVhU
X0dDX01BWChwaXBlLCAyKSwgMSA8PCAxNik7CiAKIAkvKgogCSAqIFByb2dyYW0gdGhlIGdjIG1h
eCAyIHJlZ2lzdGVyIHRvIGNsYW1wIHZhbHVlcyA+IDEuMC4KQEAgLTczMSwxNSArNzMxLDEzIEBA
IHN0YXRpYyB2b2lkIGl2Yl9sb2FkX2x1dF9leHRfbWF4KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
KQogCSAqIGZyb20gMy4wIHRvIDcuMAogCSAqLwogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49
IDEwIHx8IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKSB7Ci0JCWludGVsX2RzYl9yZWdfd3JpdGUo
ZHNiLCBQUkVDX1BBTF9FWFQyX0dDX01BWChwaXBlLCAwKSwKKwkJaW50ZWxfZHNiX3JlZ193cml0
ZShjcnRjX3N0YXRlLCBQUkVDX1BBTF9FWFQyX0dDX01BWChwaXBlLCAwKSwKIAkJCQkgICAgMSA8
PCAxNik7Ci0JCWludGVsX2RzYl9yZWdfd3JpdGUoZHNiLCBQUkVDX1BBTF9FWFQyX0dDX01BWChw
aXBlLCAxKSwKKwkJaW50ZWxfZHNiX3JlZ193cml0ZShjcnRjX3N0YXRlLCBQUkVDX1BBTF9FWFQy
X0dDX01BWChwaXBlLCAxKSwKIAkJCQkgICAgMSA8PCAxNik7Ci0JCWludGVsX2RzYl9yZWdfd3Jp
dGUoZHNiLCBQUkVDX1BBTF9FWFQyX0dDX01BWChwaXBlLCAyKSwKKwkJaW50ZWxfZHNiX3JlZ193
cml0ZShjcnRjX3N0YXRlLCBQUkVDX1BBTF9FWFQyX0dDX01BWChwaXBlLCAyKSwKIAkJCQkgICAg
MSA8PCAxNik7CiAJfQotCi0JaW50ZWxfZHNiX3B1dChkc2IpOwogfQogCiBzdGF0aWMgdm9pZCBp
dmJfbG9hZF9sdXRzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQpA
QCAtNzUzLDcgKzc1MSw3IEBAIHN0YXRpYyB2b2lkIGl2Yl9sb2FkX2x1dHMoY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJfSBlbHNlIGlmIChjcnRjX3N0YXRlLT5n
YW1tYV9tb2RlID09IEdBTU1BX01PREVfTU9ERV9TUExJVCkgewogCQlpdmJfbG9hZF9sdXRfMTAo
Y3J0YywgZGVnYW1tYV9sdXQsIFBBTF9QUkVDX1NQTElUX01PREUgfAogCQkJCVBBTF9QUkVDX0lO
REVYX1ZBTFVFKDApKTsKLQkJaXZiX2xvYWRfbHV0X2V4dF9tYXgoY3J0Yyk7CisJCWl2Yl9sb2Fk
X2x1dF9leHRfbWF4KGNydGNfc3RhdGUpOwogCQlpdmJfbG9hZF9sdXRfMTAoY3J0YywgZ2FtbWFf
bHV0LCBQQUxfUFJFQ19TUExJVF9NT0RFIHwKIAkJCQlQQUxfUFJFQ19JTkRFWF9WQUxVRSg1MTIp
KTsKIAl9IGVsc2UgewpAQCAtNzYxLDcgKzc1OSw3IEBAIHN0YXRpYyB2b2lkIGl2Yl9sb2FkX2x1
dHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAKIAkJaXZiX2xv
YWRfbHV0XzEwKGNydGMsIGJsb2IsCiAJCQkJUEFMX1BSRUNfSU5ERVhfVkFMVUUoMCkpOwotCQlp
dmJfbG9hZF9sdXRfZXh0X21heChjcnRjKTsKKwkJaXZiX2xvYWRfbHV0X2V4dF9tYXgoY3J0Y19z
dGF0ZSk7CiAJfQogfQogCkBAIC03NzYsNyArNzc0LDcgQEAgc3RhdGljIHZvaWQgYmR3X2xvYWRf
bHV0cyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAl9IGVsc2Ug
aWYgKGNydGNfc3RhdGUtPmdhbW1hX21vZGUgPT0gR0FNTUFfTU9ERV9NT0RFX1NQTElUKSB7CiAJ
CWJkd19sb2FkX2x1dF8xMChjcnRjLCBkZWdhbW1hX2x1dCwgUEFMX1BSRUNfU1BMSVRfTU9ERSB8
CiAJCQkJUEFMX1BSRUNfSU5ERVhfVkFMVUUoMCkpOwotCQlpdmJfbG9hZF9sdXRfZXh0X21heChj
cnRjKTsKKwkJaXZiX2xvYWRfbHV0X2V4dF9tYXgoY3J0Y19zdGF0ZSk7CiAJCWJkd19sb2FkX2x1
dF8xMChjcnRjLCBnYW1tYV9sdXQsIFBBTF9QUkVDX1NQTElUX01PREUgfAogCQkJCVBBTF9QUkVD
X0lOREVYX1ZBTFVFKDUxMikpOwogCX0gZWxzZSB7CkBAIC03ODQsNyArNzgyLDcgQEAgc3RhdGlj
IHZvaWQgYmR3X2xvYWRfbHV0cyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKIAogCQliZHdfbG9hZF9sdXRfMTAoY3J0YywgYmxvYiwKIAkJCQlQQUxfUFJFQ19JTkRF
WF9WQUxVRSgwKSk7Ci0JCWl2Yl9sb2FkX2x1dF9leHRfbWF4KGNydGMpOworCQlpdmJfbG9hZF9s
dXRfZXh0X21heChjcnRjX3N0YXRlKTsKIAl9CiB9CiAKQEAgLTg3Nyw3ICs4NzUsNyBAQCBzdGF0
aWMgdm9pZCBnbGtfbG9hZF9sdXRzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogCQlpbGtfbG9hZF9sdXRfOChjcnRjLCBnYW1tYV9sdXQpOwogCX0gZWxzZSB7CiAJ
CWJkd19sb2FkX2x1dF8xMChjcnRjLCBnYW1tYV9sdXQsIFBBTF9QUkVDX0lOREVYX1ZBTFVFKDAp
KTsKLQkJaXZiX2xvYWRfbHV0X2V4dF9tYXgoY3J0Yyk7CisJCWl2Yl9sb2FkX2x1dF9leHRfbWF4
KGNydGNfc3RhdGUpOwogCX0KIH0KIApAQCAtOTAwLDE0ICs4OTgsMTIgQEAgaWNsX2xvYWRfZ2Nt
YXgoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJICAgICAgIGNv
bnN0IHN0cnVjdCBkcm1fY29sb3JfbHV0ICpjb2xvcikKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKLQlzdHJ1Y3QgaW50
ZWxfZHNiICpkc2IgPSBpbnRlbF9kc2JfZ2V0KGNydGMpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0
Yy0+cGlwZTsKIAogCS8qIEZJWE1FIExVVCBlbnRyaWVzIGFyZSAxNiBiaXQgb25seSwgc28gd2Ug
Y2FuIHByb2cgMHhGRkZGIG1heCAqLwotCWludGVsX2RzYl9yZWdfd3JpdGUoZHNiLCBQUkVDX1BB
TF9HQ19NQVgocGlwZSwgMCksIGNvbG9yLT5yZWQpOwotCWludGVsX2RzYl9yZWdfd3JpdGUoZHNi
LCBQUkVDX1BBTF9HQ19NQVgocGlwZSwgMSksIGNvbG9yLT5ncmVlbik7Ci0JaW50ZWxfZHNiX3Jl
Z193cml0ZShkc2IsIFBSRUNfUEFMX0dDX01BWChwaXBlLCAyKSwgY29sb3ItPmJsdWUpOwotCWlu
dGVsX2RzYl9wdXQoZHNiKTsKKwlpbnRlbF9kc2JfcmVnX3dyaXRlKGNydGNfc3RhdGUsIFBSRUNf
UEFMX0dDX01BWChwaXBlLCAwKSwgY29sb3ItPnJlZCk7CisJaW50ZWxfZHNiX3JlZ193cml0ZShj
cnRjX3N0YXRlLCBQUkVDX1BBTF9HQ19NQVgocGlwZSwgMSksIGNvbG9yLT5ncmVlbik7CisJaW50
ZWxfZHNiX3JlZ193cml0ZShjcnRjX3N0YXRlLCBQUkVDX1BBTF9HQ19NQVgocGlwZSwgMiksIGNv
bG9yLT5ibHVlKTsKIH0KIAogc3RhdGljIHZvaWQKQEAgLTkxNiw3ICs5MTIsNiBAQCBpY2xfcHJv
Z3JhbV9nYW1tYV9zdXBlcmZpbmVfc2VnbWVudChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSkKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMo
Y3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAljb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2Ig
KmJsb2IgPSBjcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQ7CiAJY29uc3Qgc3RydWN0IGRybV9jb2xv
cl9sdXQgKmx1dCA9IGJsb2ItPmRhdGE7Ci0Jc3RydWN0IGludGVsX2RzYiAqZHNiID0gaW50ZWxf
ZHNiX2dldChjcnRjKTsKIAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJaW50IGk7CiAK
QEAgLTkyNywxOSArOTIyLDE3IEBAIGljbF9wcm9ncmFtX2dhbW1hX3N1cGVyZmluZV9zZWdtZW50
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCSAqIDkgZW50cmll
cywgY29ycmVzcG9uZGluZyB0byB2YWx1ZXMgMCwgMS8oOCAqIDEyOCAqIDI1NiksCiAJICogMi8o
OCAqIDEyOCAqIDI1NikgLi4uIDgvKDggKiAxMjggKiAyNTYpLgogCSAqLwotCWludGVsX2RzYl9y
ZWdfd3JpdGUoZHNiLCBQUkVDX1BBTF9NVUxUSV9TRUdfSU5ERVgocGlwZSksCisJaW50ZWxfZHNi
X3JlZ193cml0ZShjcnRjX3N0YXRlLCBQUkVDX1BBTF9NVUxUSV9TRUdfSU5ERVgocGlwZSksCiAJ
CQkgICAgUEFMX1BSRUNfQVVUT19JTkNSRU1FTlQpOwogCiAJZm9yIChpID0gMDsgaSA8IDk7IGkr
KykgewogCQljb25zdCBzdHJ1Y3QgZHJtX2NvbG9yX2x1dCAqZW50cnkgPSAmbHV0W2ldOwogCi0J
CWludGVsX2RzYl9pbmRleGVkX3JlZ193cml0ZShkc2IsIFBSRUNfUEFMX01VTFRJX1NFR19EQVRB
KHBpcGUpLAorCQlpbnRlbF9kc2JfaW5kZXhlZF9yZWdfd3JpdGUoY3J0Y19zdGF0ZSwgUFJFQ19Q
QUxfTVVMVElfU0VHX0RBVEEocGlwZSksCiAJCQkJCSAgICBpbGtfbHV0XzEycDRfbGR3KGVudHJ5
KSk7Ci0JCWludGVsX2RzYl9pbmRleGVkX3JlZ193cml0ZShkc2IsIFBSRUNfUEFMX01VTFRJX1NF
R19EQVRBKHBpcGUpLAorCQlpbnRlbF9kc2JfaW5kZXhlZF9yZWdfd3JpdGUoY3J0Y19zdGF0ZSwg
UFJFQ19QQUxfTVVMVElfU0VHX0RBVEEocGlwZSksCiAJCQkJCSAgICBpbGtfbHV0XzEycDRfdWR3
KGVudHJ5KSk7CiAJfQotCi0JaW50ZWxfZHNiX3B1dChkc2IpOwogfQogCiBzdGF0aWMgdm9pZApA
QCAtOTQ5LDcgKzk0Miw2IEBAIGljbF9wcm9ncmFtX2dhbW1hX211bHRpX3NlZ21lbnQoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJY29uc3Qgc3RydWN0IGRybV9w
cm9wZXJ0eV9ibG9iICpibG9iID0gY3J0Y19zdGF0ZS0+aHcuZ2FtbWFfbHV0OwogCWNvbnN0IHN0
cnVjdCBkcm1fY29sb3JfbHV0ICpsdXQgPSBibG9iLT5kYXRhOwogCWNvbnN0IHN0cnVjdCBkcm1f
Y29sb3JfbHV0ICplbnRyeTsKLQlzdHJ1Y3QgaW50ZWxfZHNiICpkc2IgPSBpbnRlbF9kc2JfZ2V0
KGNydGMpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAlpbnQgaTsKIApAQCAtOTYz
LDEyICs5NTUsMTMgQEAgaWNsX3Byb2dyYW1fZ2FtbWFfbXVsdGlfc2VnbWVudChjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkgKiBQQUxfUFJFQ19JTkRFWFswXSBh
bmQgUEFMX1BSRUNfSU5ERVhbMV0gbWFwIHRvIHNlZzJbMV0sCiAJICogc2VnMlswXSBiZWluZyB1
bnVzZWQgYnkgdGhlIGhhcmR3YXJlLgogCSAqLwotCWludGVsX2RzYl9yZWdfd3JpdGUoZHNiLCBQ
UkVDX1BBTF9JTkRFWChwaXBlKSwgUEFMX1BSRUNfQVVUT19JTkNSRU1FTlQpOworCWludGVsX2Rz
Yl9yZWdfd3JpdGUoY3J0Y19zdGF0ZSwgUFJFQ19QQUxfSU5ERVgocGlwZSksCisJCQkgICAgUEFM
X1BSRUNfQVVUT19JTkNSRU1FTlQpOwogCWZvciAoaSA9IDE7IGkgPCAyNTc7IGkrKykgewogCQll
bnRyeSA9ICZsdXRbaSAqIDhdOwotCQlpbnRlbF9kc2JfaW5kZXhlZF9yZWdfd3JpdGUoZHNiLCBQ
UkVDX1BBTF9EQVRBKHBpcGUpLAorCQlpbnRlbF9kc2JfaW5kZXhlZF9yZWdfd3JpdGUoY3J0Y19z
dGF0ZSwgUFJFQ19QQUxfREFUQShwaXBlKSwKIAkJCQkJICAgIGlsa19sdXRfMTJwNF9sZHcoZW50
cnkpKTsKLQkJaW50ZWxfZHNiX2luZGV4ZWRfcmVnX3dyaXRlKGRzYiwgUFJFQ19QQUxfREFUQShw
aXBlKSwKKwkJaW50ZWxfZHNiX2luZGV4ZWRfcmVnX3dyaXRlKGNydGNfc3RhdGUsIFBSRUNfUEFM
X0RBVEEocGlwZSksCiAJCQkJCSAgICBpbGtfbHV0XzEycDRfdWR3KGVudHJ5KSk7CiAJfQogCkBA
IC05ODYsMjQgKzk3OSwyMiBAQCBpY2xfcHJvZ3JhbV9nYW1tYV9tdWx0aV9zZWdtZW50KGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCSAqLwogCWZvciAoaSA9IDA7
IGkgPCAyNTY7IGkrKykgewogCQllbnRyeSA9ICZsdXRbaSAqIDggKiAxMjhdOwotCQlpbnRlbF9k
c2JfaW5kZXhlZF9yZWdfd3JpdGUoZHNiLCBQUkVDX1BBTF9EQVRBKHBpcGUpLAorCQlpbnRlbF9k
c2JfaW5kZXhlZF9yZWdfd3JpdGUoY3J0Y19zdGF0ZSwgUFJFQ19QQUxfREFUQShwaXBlKSwKIAkJ
CQkJICAgIGlsa19sdXRfMTJwNF9sZHcoZW50cnkpKTsKLQkJaW50ZWxfZHNiX2luZGV4ZWRfcmVn
X3dyaXRlKGRzYiwgUFJFQ19QQUxfREFUQShwaXBlKSwKKwkJaW50ZWxfZHNiX2luZGV4ZWRfcmVn
X3dyaXRlKGNydGNfc3RhdGUsIFBSRUNfUEFMX0RBVEEocGlwZSksCiAJCQkJCSAgICBpbGtfbHV0
XzEycDRfdWR3KGVudHJ5KSk7CiAJfQogCiAJLyogVGhlIGxhc3QgZW50cnkgaW4gdGhlIExVVCBp
cyB0byBiZSBwcm9ncmFtbWVkIGluIEdDTUFYICovCiAJZW50cnkgPSAmbHV0WzI1NiAqIDggKiAx
MjhdOwogCWljbF9sb2FkX2djbWF4KGNydGNfc3RhdGUsIGVudHJ5KTsKLQlpdmJfbG9hZF9sdXRf
ZXh0X21heChjcnRjKTsKLQlpbnRlbF9kc2JfcHV0KGRzYik7CisJaXZiX2xvYWRfbHV0X2V4dF9t
YXgoY3J0Y19zdGF0ZSk7CiB9CiAKIHN0YXRpYyB2b2lkIGljbF9sb2FkX2x1dHMoY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJY29uc3Qgc3RydWN0IGRybV9w
cm9wZXJ0eV9ibG9iICpnYW1tYV9sdXQgPSBjcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQ7CiAJc3Ry
dWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0
Yyk7Ci0Jc3RydWN0IGludGVsX2RzYiAqZHNiID0gaW50ZWxfZHNiX2dldChjcnRjKTsKIAogCWlm
IChjcnRjX3N0YXRlLT5ody5kZWdhbW1hX2x1dCkKIAkJZ2xrX2xvYWRfZGVnYW1tYV9sdXQoY3J0
Y19zdGF0ZSk7CkBAIC0xMDE4LDExICsxMDA5LDEwIEBAIHN0YXRpYyB2b2lkIGljbF9sb2FkX2x1
dHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJCWJyZWFrOwog
CWRlZmF1bHQ6CiAJCWJkd19sb2FkX2x1dF8xMChjcnRjLCBnYW1tYV9sdXQsIFBBTF9QUkVDX0lO
REVYX1ZBTFVFKDApKTsKLQkJaXZiX2xvYWRfbHV0X2V4dF9tYXgoY3J0Yyk7CisJCWl2Yl9sb2Fk
X2x1dF9leHRfbWF4KGNydGNfc3RhdGUpOwogCX0KIAotCWludGVsX2RzYl9jb21taXQoZHNiKTsK
LQlpbnRlbF9kc2JfcHV0KGRzYik7CisJaW50ZWxfZHNiX2NvbW1pdChjcnRjX3N0YXRlKTsKIH0K
IAogc3RhdGljIHUzMiBjaHZfY2dtX2RlZ2FtbWFfbGR3KGNvbnN0IHN0cnVjdCBkcm1fY29sb3Jf
bHV0ICpjb2xvcikKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5
LmMKaW5kZXggNDMyYjRlZWFmOWY2Li41MTQ0ODNmZmQyNDcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBAIC0xNDg3Myw4ICsxNDg3MywyNCBAQCBz
dGF0aWMgaW50IGludGVsX2F0b21pY19jaGVjayhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCiBz
dGF0aWMgaW50IGludGVsX2F0b21pY19wcmVwYXJlX2NvbW1pdChzdHJ1Y3QgaW50ZWxfYXRvbWlj
X3N0YXRlICpzdGF0ZSkKIHsKLQlyZXR1cm4gZHJtX2F0b21pY19oZWxwZXJfcHJlcGFyZV9wbGFu
ZXMoc3RhdGUtPmJhc2UuZGV2LAotCQkJCQkJJnN0YXRlLT5iYXNlKTsKKwlzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKKwlpbnQg
aSwgcmV0OworCisJcmV0ID0gZHJtX2F0b21pY19oZWxwZXJfcHJlcGFyZV9wbGFuZXMoc3RhdGUt
PmJhc2UuZGV2LCAmc3RhdGUtPmJhc2UpOworCWlmIChyZXQgPCAwKQorCQlyZXR1cm4gcmV0Owor
CisJZm9yX2VhY2hfbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsIGNydGNfc3Rh
dGUsIGkpIHsKKwkJYm9vbCBtb2RlX2NoYW5nZWQgPSBuZWVkc19tb2Rlc2V0KGNydGNfc3RhdGUp
OworCisJCWlmIChtb2RlX2NoYW5nZWQgfHwgY3J0Y19zdGF0ZS0+dXBkYXRlX3BpcGUgfHwKKwkJ
ICAgIGNydGNfc3RhdGUtPnVhcGkuY29sb3JfbWdtdF9jaGFuZ2VkKSB7CisJCQlpbnRlbF9kc2Jf
cHJlcGFyZShjcnRjX3N0YXRlKTsKKwkJfQorCX0KKworCXJldHVybiAwOwogfQogCiB1MzIgaW50
ZWxfY3J0Y19nZXRfdmJsYW5rX2NvdW50ZXIoc3RydWN0IGludGVsX2NydGMgKmNydGMpCkBAIC0x
NTMyNywxNSArMTUzNDMsMjcgQEAgc3RhdGljIHZvaWQgaW50ZWxfYXRvbWljX2NvbW1pdF9mZW5j
ZV93YWl0KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKmludGVsX3N0YXQKIAkJICAgICZ3YWl0
X3Jlc2V0KTsKIH0KIAorc3RhdGljIHZvaWQgaW50ZWxfY2xlYW51cF9kc2JzKHN0cnVjdCBpbnRl
bF9hdG9taWNfc3RhdGUgKnN0YXRlKQoreworCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRf
Y3J0Y19zdGF0ZSwgKm5ld19jcnRjX3N0YXRlOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOwor
CWludCBpOworCisJZm9yX2VhY2hfb2xkbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3RhdGUsIGNy
dGMsIG9sZF9jcnRjX3N0YXRlLAorCQkJCQkgICAgbmV3X2NydGNfc3RhdGUsIGkpCisJCWludGVs
X2RzYl9jbGVhbnVwKG9sZF9jcnRjX3N0YXRlKTsKK30KKwogc3RhdGljIHZvaWQgaW50ZWxfYXRv
bWljX2NsZWFudXBfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiB7Ci0Jc3RydWN0IGRy
bV9hdG9taWNfc3RhdGUgKnN0YXRlID0KLQkJY29udGFpbmVyX29mKHdvcmssIHN0cnVjdCBkcm1f
YXRvbWljX3N0YXRlLCBjb21taXRfd29yayk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSB0b19pOTE1KHN0YXRlLT5kZXYpOworCXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0
YXRlID0KKwkJY29udGFpbmVyX29mKHdvcmssIHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUsIGJh
c2UuY29tbWl0X3dvcmspOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkx
NShzdGF0ZS0+YmFzZS5kZXYpOwogCi0JZHJtX2F0b21pY19oZWxwZXJfY2xlYW51cF9wbGFuZXMo
Jmk5MTUtPmRybSwgc3RhdGUpOwotCWRybV9hdG9taWNfaGVscGVyX2NvbW1pdF9jbGVhbnVwX2Rv
bmUoc3RhdGUpOwotCWRybV9hdG9taWNfc3RhdGVfcHV0KHN0YXRlKTsKKwlpbnRlbF9jbGVhbnVw
X2RzYnMoc3RhdGUpOworCWRybV9hdG9taWNfaGVscGVyX2NsZWFudXBfcGxhbmVzKCZpOTE1LT5k
cm0sICZzdGF0ZS0+YmFzZSk7CisJZHJtX2F0b21pY19oZWxwZXJfY29tbWl0X2NsZWFudXBfZG9u
ZSgmc3RhdGUtPmJhc2UpOworCWRybV9hdG9taWNfc3RhdGVfcHV0KCZzdGF0ZS0+YmFzZSk7CiAK
IAlpbnRlbF9hdG9taWNfaGVscGVyX2ZyZWVfc3RhdGUoaTkxNSk7CiB9CkBAIC0xNTQ2OSw2ICsx
NTQ5NywxMyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9hdG9taWNfY29tbWl0X3RhaWwoc3RydWN0IGlu
dGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCQltb2Rlc2V0X3B1dF9wb3dlcl9kb21haW5zKGRl
dl9wcml2LCBwdXRfZG9tYWluc1tpXSk7CiAKIAkJaW50ZWxfbW9kZXNldF92ZXJpZnlfY3J0Yyhj
cnRjLCBzdGF0ZSwgb2xkX2NydGNfc3RhdGUsIG5ld19jcnRjX3N0YXRlKTsKKworCQkvKgorCQkg
KiBEU0IgY2xlYW51cCBpcyBkb25lIGluIGNsZWFudXBfd29yayBhbGlnbmluZyB3aXRoIGZyYW1l
YnVmZmVyCisJCSAqIGNsZWFudXAuIFNvIGNvcHkgYW5kIHJlc2V0IHRoZSBkc2Igc3RydWN0dXJl
IHRvIHN5bmMgd2l0aAorCQkgKiBjb21taXRfZG9uZSBhbmQgbGF0ZXIgZG8gZHNiIGNsZWFudXAg
aW4gY2xlYW51cF93b3JrLgorCQkgKi8KKwkJb2xkX2NydGNfc3RhdGUtPmRzYiA9IGZldGNoX2Fu
ZF96ZXJvKCZuZXdfY3J0Y19zdGF0ZS0+ZHNiKTsKIAl9CiAKIAkvKiBVbmRlcnJ1bnMgZG9uJ3Qg
YWx3YXlzIHJhaXNlIGludGVycnVwdHMsIHNvIGNoZWNrIG1hbnVhbGx5ICovCkBAIC0xNTYxOCw4
ICsxNTY1MywxNSBAQCBzdGF0aWMgaW50IGludGVsX2F0b21pY19jb21taXQoc3RydWN0IGRybV9k
ZXZpY2UgKmRldiwKIAkJaW50ZWxfYXRvbWljX3N3YXBfZ2xvYmFsX3N0YXRlKHN0YXRlKTsKIAog
CWlmIChyZXQpIHsKKwkJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlOwor
CQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKKwkJaW50IGk7CisKIAkJaTkxNV9zd19mZW5jZV9j
b21taXQoJnN0YXRlLT5jb21taXRfcmVhZHkpOwogCisJCWZvcl9lYWNoX25ld19pbnRlbF9jcnRj
X2luX3N0YXRlKHN0YXRlLCBjcnRjLCBuZXdfY3J0Y19zdGF0ZSwgaSkKKwkJCWludGVsX2RzYl9j
bGVhbnVwKG5ld19jcnRjX3N0YXRlKTsKKwogCQlkcm1fYXRvbWljX2hlbHBlcl9jbGVhbnVwX3Bs
YW5lcyhkZXYsICZzdGF0ZS0+YmFzZSk7CiAJCWludGVsX3J1bnRpbWVfcG1fcHV0KCZkZXZfcHJp
di0+cnVudGltZV9wbSwgc3RhdGUtPndha2VyZWYpOwogCQlyZXR1cm4gcmV0OwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaAppbmRleCA4
Nzg3NmZjZTkxYTUuLmNhNTc5MDA1ZDgxOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKQEAgLTEwNzgsNiArMTA3OCw5IEBAIHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlIHsKIAogCS8qIE9ubHkgdmFsaWQgb24gVEdMKyAqLwogCWVu
dW0gdHJhbnNjb2RlciBtc3RfbWFzdGVyX3RyYW5zY29kZXI7CisKKwkvKiBGb3IgRFNCIHJlbGF0
ZWQgaW5mbyAqLworCXN0cnVjdCBpbnRlbF9kc2IgKmRzYjsKIH07CiAKIGVudW0gaW50ZWxfcGlw
ZV9jcmNfc291cmNlIHsKQEAgLTExNDcsOSArMTE1MCw2IEBAIHN0cnVjdCBpbnRlbF9jcnRjIHsK
IAkvKiBzY2FsZXJzIGF2YWlsYWJsZSBvbiB0aGlzIGNydGMgKi8KIAlpbnQgbnVtX3NjYWxlcnM7
CiAKLQkvKiBwZXIgcGlwZSBEU0IgcmVsYXRlZCBpbmZvICovCi0Jc3RydWN0IGludGVsX2RzYiBk
c2I7Ci0KICNpZmRlZiBDT05GSUdfREVCVUdfRlMKIAlzdHJ1Y3QgaW50ZWxfcGlwZV9jcmMgcGlw
ZV9jcmM7CiAjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZHNiLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RzYi5jCmlu
ZGV4IDI5ZmVjNmE5MmQxNy4uNGY0MmVlMzNiOGI3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2RzYi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZHNiLmMKQEAgLTM0LDE1MiArMzQsNTIgQEAKICNkZWZpbmUgRFNCX0JZVEVf
RU5fU0hJRlQJCTIwCiAjZGVmaW5lIERTQl9SRUdfVkFMVUVfTUFTSwkJMHhmZmZmZgogCi1zdGF0
aWMgYm9vbCBpc19kc2JfYnVzeShzdHJ1Y3QgaW50ZWxfZHNiICpkc2IpCitzdGF0aWMgYm9vbCBp
c19kc2JfYnVzeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgZW51bSBwaXBlIHBpcGUs
CisJCQllbnVtIGRzYl9pZCBpZCkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IGNvbnRh
aW5lcl9vZihkc2IsIHR5cGVvZigqY3J0YyksIGRzYik7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7Ci0JZW51bSBwaXBlIHBpcGUg
PSBjcnRjLT5waXBlOwotCi0JcmV0dXJuIERTQl9TVEFUVVMgJiBpbnRlbF9kZV9yZWFkKGRldl9w
cml2LCBEU0JfQ1RSTChwaXBlLCBkc2ItPmlkKSk7CisJcmV0dXJuIERTQl9TVEFUVVMgJiBpbnRl
bF9kZV9yZWFkKGk5MTUsIERTQl9DVFJMKHBpcGUsIGlkKSk7CiB9CiAKLXN0YXRpYyBib29sIGlu
dGVsX2RzYl9lbmFibGVfZW5naW5lKHN0cnVjdCBpbnRlbF9kc2IgKmRzYikKK3N0YXRpYyBib29s
IGludGVsX2RzYl9lbmFibGVfZW5naW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAor
CQkJCSAgICBlbnVtIHBpcGUgcGlwZSwgZW51bSBkc2JfaWQgaWQpCiB7Ci0Jc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSBjb250YWluZXJfb2YoZHNiLCB0eXBlb2YoKmNydGMpLCBkc2IpOwotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYp
OwotCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAl1MzIgZHNiX2N0cmw7CiAKLQlkc2Jf
Y3RybCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIERTQl9DVFJMKHBpcGUsIGRzYi0+aWQpKTsK
Kwlkc2JfY3RybCA9IGludGVsX2RlX3JlYWQoaTkxNSwgRFNCX0NUUkwocGlwZSwgaWQpKTsKIAlp
ZiAoRFNCX1NUQVRVUyAmIGRzYl9jdHJsKSB7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJt
LCAiRFNCIGVuZ2luZSBpcyBidXN5LlxuIik7CisJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sICJE
U0IgZW5naW5lIGlzIGJ1c3kuXG4iKTsKIAkJcmV0dXJuIGZhbHNlOwogCX0KIAogCWRzYl9jdHJs
IHw9IERTQl9FTkFCTEU7Ci0JaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIERTQl9DVFJMKHBpcGUs
IGRzYi0+aWQpLCBkc2JfY3RybCk7CisJaW50ZWxfZGVfd3JpdGUoaTkxNSwgRFNCX0NUUkwocGlw
ZSwgaWQpLCBkc2JfY3RybCk7CiAKLQlpbnRlbF9kZV9wb3N0aW5nX3JlYWQoZGV2X3ByaXYsIERT
Ql9DVFJMKHBpcGUsIGRzYi0+aWQpKTsKKwlpbnRlbF9kZV9wb3N0aW5nX3JlYWQoaTkxNSwgRFNC
X0NUUkwocGlwZSwgaWQpKTsKIAlyZXR1cm4gdHJ1ZTsKIH0KIAotc3RhdGljIGJvb2wgaW50ZWxf
ZHNiX2Rpc2FibGVfZW5naW5lKHN0cnVjdCBpbnRlbF9kc2IgKmRzYikKK3N0YXRpYyBib29sIGlu
dGVsX2RzYl9kaXNhYmxlX2VuZ2luZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKKwkJ
CQkgICAgIGVudW0gcGlwZSBwaXBlLCBlbnVtIGRzYl9pZCBpZCkKIHsKLQlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YyA9IGNvbnRhaW5lcl9vZihkc2IsIHR5cGVvZigqY3J0YyksIGRzYik7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7
Ci0JZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCXUzMiBkc2JfY3RybDsKIAotCWRzYl9j
dHJsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgRFNCX0NUUkwocGlwZSwgZHNiLT5pZCkpOwor
CWRzYl9jdHJsID0gaW50ZWxfZGVfcmVhZChpOTE1LCBEU0JfQ1RSTChwaXBlLCBpZCkpOwogCWlm
IChEU0JfU1RBVFVTICYgZHNiX2N0cmwpIHsKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0s
ICJEU0IgZW5naW5lIGlzIGJ1c3kuXG4iKTsKKwkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwgIkRT
QiBlbmdpbmUgaXMgYnVzeS5cbiIpOwogCQlyZXR1cm4gZmFsc2U7CiAJfQogCiAJZHNiX2N0cmwg
Jj0gfkRTQl9FTkFCTEU7Ci0JaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIERTQl9DVFJMKHBpcGUs
IGRzYi0+aWQpLCBkc2JfY3RybCk7CisJaW50ZWxfZGVfd3JpdGUoaTkxNSwgRFNCX0NUUkwocGlw
ZSwgaWQpLCBkc2JfY3RybCk7CiAKLQlpbnRlbF9kZV9wb3N0aW5nX3JlYWQoZGV2X3ByaXYsIERT
Ql9DVFJMKHBpcGUsIGRzYi0+aWQpKTsKKwlpbnRlbF9kZV9wb3N0aW5nX3JlYWQoaTkxNSwgRFNC
X0NUUkwocGlwZSwgaWQpKTsKIAlyZXR1cm4gdHJ1ZTsKIH0KIAotLyoqCi0gKiBpbnRlbF9kc2Jf
Z2V0KCkgLSBBbGxvY2F0ZSBEU0IgY29udGV4dCBhbmQgcmV0dXJuIGEgRFNCIGluc3RhbmNlLgot
ICogQGNydGM6IGludGVsX2NydGMgc3RydWN0dXJlIHRvIGdldCBwaXBlIGluZm8uCi0gKgotICog
VGhpcyBmdW5jdGlvbiBwcm92aWRlcyBoYW5kbGUgb2YgYSBEU0IgaW5zdGFuY2UsIGZvciB0aGUg
ZnVydGhlciBEU0IKLSAqIG9wZXJhdGlvbnMuCi0gKgotICogUmV0dXJuczogYWRkcmVzcyBvZiBJ
bnRlbF9kc2IgaW5zdGFuY2UgcmVxdWVzdGVkIGZvci4KLSAqIEZhaWx1cmU6IFJldHVybnMgdGhl
IHNhbWUgRFNCIGluc3RhbmNlLCBidXQgd2l0aG91dCBhIGNvbW1hbmQgYnVmZmVyLgotICovCi0K
LXN0cnVjdCBpbnRlbF9kc2IgKgotaW50ZWxfZHNiX2dldChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YykKLXsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7Ci0Jc3RydWN0IGludGVsX2Rz
YiAqZHNiID0gJmNydGMtPmRzYjsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwot
CXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwotCXUzMiAqYnVmOwotCWludGVsX3dha2VyZWZfdCB3YWtl
cmVmOwotCi0JaWYgKCFIQVNfRFNCKGk5MTUpKQotCQlyZXR1cm4gZHNiOwotCi0JaWYgKGRzYi0+
cmVmY291bnQrKyAhPSAwKQotCQlyZXR1cm4gZHNiOwotCi0Jd2FrZXJlZiA9IGludGVsX3J1bnRp
bWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKLQotCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9j
cmVhdGVfaW50ZXJuYWwoaTkxNSwgRFNCX0JVRl9TSVpFKTsKLQlpZiAoSVNfRVJSKG9iaikpIHsK
LQkJZHJtX2VycigmaTkxNS0+ZHJtLCAiR2VtIG9iamVjdCBjcmVhdGlvbiBmYWlsZWRcbiIpOwot
CQlnb3RvIG91dDsKLQl9Ci0KLQl2bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4ob2JqLCBO
VUxMLCAwLCAwLCAwKTsKLQlpZiAoSVNfRVJSKHZtYSkpIHsKLQkJZHJtX2VycigmaTkxNS0+ZHJt
LCAiVm1hIGNyZWF0aW9uIGZhaWxlZFxuIik7Ci0JCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsK
LQkJZ290byBvdXQ7Ci0JfQotCi0JYnVmID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAodm1hLT5v
YmosIEk5MTVfTUFQX1dDKTsKLQlpZiAoSVNfRVJSKGJ1ZikpIHsKLQkJZHJtX2VycigmaTkxNS0+
ZHJtLCAiQ29tbWFuZCBidWZmZXIgY3JlYXRpb24gZmFpbGVkXG4iKTsKLQkJZ290byBvdXQ7Ci0J
fQotCi0JZHNiLT5pZCA9IERTQjE7Ci0JZHNiLT52bWEgPSB2bWE7Ci0JZHNiLT5jbWRfYnVmID0g
YnVmOwotCi1vdXQ6Ci0JLyoKLQkgKiBPbiBlcnJvciBkc2ItPmNtZF9idWYgd2lsbCBjb250aW51
ZSB0byBiZSBOVUxMLCBtYWtpbmcgdGhlIHdyaXRlcwotCSAqIHBhc3MtdGhyb3VnaC4gTGVhdmUg
dGhlIGRhbmdsaW5nIHJlZiB0byBiZSByZW1vdmVkIGxhdGVyIGJ5IHRoZQotCSAqIGNvcnJlc3Bv
bmRpbmcgaW50ZWxfZHNiX3B1dCgpOiB0aGUgaW1wb3J0YW50IGVycm9yIG1lc3NhZ2Ugd2lsbAot
CSAqIGFscmVhZHkgYmUgbG9nZ2VkIGFib3ZlLgotCSAqLwotCi0JaW50ZWxfcnVudGltZV9wbV9w
dXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCi0JcmV0dXJuIGRzYjsKLX0KLQotLyoq
Ci0gKiBpbnRlbF9kc2JfcHV0KCkgLSBUbyBkZXN0cm95IERTQiBjb250ZXh0LgotICogQGRzYjog
aW50ZWxfZHNiIHN0cnVjdHVyZS4KLSAqCi0gKiBUaGlzIGZ1bmN0aW9uIGRlc3Ryb3lzIHRoZSBE
U0IgY29udGV4dCBhbGxvY2F0ZWQgYnkgYSBkc2JfZ2V0KCksIGJ5Ci0gKiB1bnBpbm5pbmcgYW5k
IHJlbGVhc2luZyB0aGUgVk1BIG9iamVjdCBhc3NvY2lhdGVkIHdpdGggaXQuCi0gKi8KLQotdm9p
ZCBpbnRlbF9kc2JfcHV0KHN0cnVjdCBpbnRlbF9kc2IgKmRzYikKLXsKLQlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YyA9IGNvbnRhaW5lcl9vZihkc2IsIHR5cGVvZigqY3J0YyksIGRzYik7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKLQot
CWlmICghSEFTX0RTQihpOTE1KSkKLQkJcmV0dXJuOwotCi0JaWYgKGRybV9XQVJOX09OKCZpOTE1
LT5kcm0sIGRzYi0+cmVmY291bnQgPT0gMCkpCi0JCXJldHVybjsKLQotCWlmICgtLWRzYi0+cmVm
Y291bnQgPT0gMCkgewotCQlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmZHNiLT52bWEsIEk5
MTVfVk1BX1JFTEVBU0VfTUFQKTsKLQkJZHNiLT5jbWRfYnVmID0gTlVMTDsKLQkJZHNiLT5mcmVl
X3BvcyA9IDA7Ci0JCWRzYi0+aW5zX3N0YXJ0X29mZnNldCA9IDA7Ci0JfQotfQotCiAvKioKICAq
IGludGVsX2RzYl9pbmRleGVkX3JlZ193cml0ZSgpIC1Xcml0ZSB0byB0aGUgRFNCIGNvbnRleHQg
Zm9yIGF1dG8KICAqIGluY3JlbWVudCByZWdpc3Rlci4KLSAqIEBkc2I6IGludGVsX2RzYiBzdHJ1
Y3R1cmUuCisgKiBAY3J0Y19zdGF0ZTogaW50ZWxfY3J0Y19zdGF0ZSBzdHJ1Y3R1cmUKICAqIEBy
ZWc6IHJlZ2lzdGVyIGFkZHJlc3MuCiAgKiBAdmFsOiB2YWx1ZS4KICAqCkBAIC0xODksMTkgKzg5
LDIwIEBAIHZvaWQgaW50ZWxfZHNiX3B1dChzdHJ1Y3QgaW50ZWxfZHNiICpkc2IpCiAgKiBpcyBk
b25lIHRocm91Z2ggbW1pbyB3cml0ZS4KICAqLwogCi12b2lkIGludGVsX2RzYl9pbmRleGVkX3Jl
Z193cml0ZShzdHJ1Y3QgaW50ZWxfZHNiICpkc2IsIGk5MTVfcmVnX3QgcmVnLAotCQkJCSB1MzIg
dmFsKQordm9pZCBpbnRlbF9kc2JfaW5kZXhlZF9yZWdfd3JpdGUoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkJIGk5MTVfcmVnX3QgcmVnLCB1MzIgdmFsKQog
ewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gY29udGFpbmVyX29mKGRzYiwgdHlwZW9mKCpj
cnRjKSwgZHNiKTsKKwlzdHJ1Y3QgaW50ZWxfZHNiICpkc2IgPSBjcnRjX3N0YXRlLT5kc2I7CisJ
c3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGku
Y3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRj
LT5iYXNlLmRldik7Ci0JdTMyICpidWYgPSBkc2ItPmNtZF9idWY7CisJdTMyICpidWY7CiAJdTMy
IHJlZ192YWw7CiAKLQlpZiAoIWJ1ZikgeworCWlmICghZHNiKSB7CiAJCWludGVsX2RlX3dyaXRl
KGRldl9wcml2LCByZWcsIHZhbCk7CiAJCXJldHVybjsKIAl9Ci0KKwlidWYgPSBkc2ItPmNtZF9i
dWY7CiAJaWYgKGRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCBkc2ItPmZyZWVfcG9zID49IERT
Ql9CVUZfU0laRSkpIHsKIAkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJEU0IgYnVmZmVy
IG92ZXJmbG93XG4iKTsKIAkJcmV0dXJuOwpAQCAtMjU2LDcgKzE1Nyw3IEBAIHZvaWQgaW50ZWxf
ZHNiX2luZGV4ZWRfcmVnX3dyaXRlKHN0cnVjdCBpbnRlbF9kc2IgKmRzYiwgaTkxNV9yZWdfdCBy
ZWcsCiAvKioKICAqIGludGVsX2RzYl9yZWdfd3JpdGUoKSAtV3JpdGUgdG8gdGhlIERTQiBjb250
ZXh0IGZvciBub3JtYWwKICAqIHJlZ2lzdGVyLgotICogQGRzYjogaW50ZWxfZHNiIHN0cnVjdHVy
ZS4KKyAqIEBjcnRjX3N0YXRlOiBpbnRlbF9jcnRjX3N0YXRlIHN0cnVjdHVyZQogICogQHJlZzog
cmVnaXN0ZXIgYWRkcmVzcy4KICAqIEB2YWw6IHZhbHVlLgogICoKQEAgLTI2NSwxNyArMTY2LDE5
IEBAIHZvaWQgaW50ZWxfZHNiX2luZGV4ZWRfcmVnX3dyaXRlKHN0cnVjdCBpbnRlbF9kc2IgKmRz
YiwgaTkxNV9yZWdfdCByZWcsCiAgKiBhbmQgcmVzdCBhbGwgZXJyb25lb3VzIGNvbmRpdGlvbiBy
ZWdpc3RlciBwcm9ncmFtbWluZyBpcyBkb25lCiAgKiB0aHJvdWdoIG1taW8gd3JpdGUuCiAgKi8K
LXZvaWQgaW50ZWxfZHNiX3JlZ193cml0ZShzdHJ1Y3QgaW50ZWxfZHNiICpkc2IsIGk5MTVfcmVn
X3QgcmVnLCB1MzIgdmFsKQordm9pZCBpbnRlbF9kc2JfcmVnX3dyaXRlKGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJIGk5MTVfcmVnX3QgcmVnLCB1MzIgdmFs
KQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gY29udGFpbmVyX29mKGRzYiwgdHlwZW9m
KCpjcnRjKSwgZHNiKTsKKwlzdHJ1Y3QgaW50ZWxfZHNiICpkc2IgPSBjcnRjX3N0YXRlLT5kc2I7
CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVh
cGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShj
cnRjLT5iYXNlLmRldik7CiAJdTMyICpidWYgPSBkc2ItPmNtZF9idWY7CiAKLQlpZiAoIWJ1Zikg
eworCWlmICghZHNiKSB7CiAJCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCByZWcsIHZhbCk7CiAJ
CXJldHVybjsKIAl9Ci0KKwlidWYgPSBkc2ItPmNtZF9idWY7CiAJaWYgKGRybV9XQVJOX09OKCZk
ZXZfcHJpdi0+ZHJtLCBkc2ItPmZyZWVfcG9zID49IERTQl9CVUZfU0laRSkpIHsKIAkJZHJtX2Ri
Z19rbXMoJmRldl9wcml2LT5kcm0sICJEU0IgYnVmZmVyIG92ZXJmbG93XG4iKTsKIAkJcmV0dXJu
OwpAQCAtMjkwLDI2ICsxOTMsMjcgQEAgdm9pZCBpbnRlbF9kc2JfcmVnX3dyaXRlKHN0cnVjdCBp
bnRlbF9kc2IgKmRzYiwgaTkxNV9yZWdfdCByZWcsIHUzMiB2YWwpCiAKIC8qKgogICogaW50ZWxf
ZHNiX2NvbW1pdCgpIC0gVHJpZ2dlciB3b3JrbG9hZCBleGVjdXRpb24gb2YgRFNCLgotICogQGRz
YjogaW50ZWxfZHNiIHN0cnVjdHVyZS4KKyAqIEBjcnRjX3N0YXRlOiBpbnRlbF9jcnRjX3N0YXRl
IHN0cnVjdHVyZQogICoKICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byBkbyBhY3R1YWwgd3Jp
dGUgdG8gaGFyZHdhcmUgdXNpbmcgRFNCLgogICogT24gZXJyb3JzLCBmYWxsIGJhY2sgdG8gTU1J
Ty4gQWxzbyB0aGlzIGZ1bmN0aW9uIGhlbHAgdG8gcmVzZXQgdGhlIGNvbnRleHQuCiAgKi8KLXZv
aWQgaW50ZWxfZHNiX2NvbW1pdChzdHJ1Y3QgaW50ZWxfZHNiICpkc2IpCit2b2lkIGludGVsX2Rz
Yl9jb21taXQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0J
c3RydWN0IGludGVsX2NydGMgKmNydGMgPSBjb250YWluZXJfb2YoZHNiLCB0eXBlb2YoKmNydGMp
LCBkc2IpOworCXN0cnVjdCBpbnRlbF9kc2IgKmRzYiA9IGNydGNfc3RhdGUtPmRzYjsKKwlzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRj
KTsKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7CiAJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwogCWVudW0gcGlwZSBwaXBl
ID0gY3J0Yy0+cGlwZTsKIAl1MzIgdGFpbDsKIAotCWlmICghZHNiLT5mcmVlX3BvcykKKwlpZiAo
IShkc2IgfHwgZHNiLT5mcmVlX3BvcykpCiAJCXJldHVybjsKIAotCWlmICghaW50ZWxfZHNiX2Vu
YWJsZV9lbmdpbmUoZHNiKSkKKwlpZiAoIWludGVsX2RzYl9lbmFibGVfZW5naW5lKGRldl9wcml2
LCBwaXBlLCBkc2ItPmlkKSkKIAkJZ290byByZXNldDsKIAotCWlmIChpc19kc2JfYnVzeShkc2Ip
KSB7CisJaWYgKGlzX2RzYl9idXN5KGRldl9wcml2LCBwaXBlLCBkc2ItPmlkKSkgewogCQlkcm1f
ZXJyKCZkZXZfcHJpdi0+ZHJtLAogCQkJIkhFQURfUFRSIHdyaXRlIGZhaWxlZCAtIGRzYiBlbmdp
bmUgaXMgYnVzeS5cbiIpOwogCQlnb3RvIHJlc2V0OwpAQCAtMzIyLDcgKzIyNiw3IEBAIHZvaWQg
aW50ZWxfZHNiX2NvbW1pdChzdHJ1Y3QgaW50ZWxfZHNiICpkc2IpCiAJCW1lbXNldCgmZHNiLT5j
bWRfYnVmW2RzYi0+ZnJlZV9wb3NdLCAwLAogCQkgICAgICAgKHRhaWwgLSBkc2ItPmZyZWVfcG9z
ICogNCkpOwogCi0JaWYgKGlzX2RzYl9idXN5KGRzYikpIHsKKwlpZiAoaXNfZHNiX2J1c3koZGV2
X3ByaXYsIHBpcGUsIGRzYi0+aWQpKSB7CiAJCWRybV9lcnIoJmRldl9wcml2LT5kcm0sCiAJCQki
VEFJTF9QVFIgd3JpdGUgZmFpbGVkIC0gZHNiIGVuZ2luZSBpcyBidXN5LlxuIik7CiAJCWdvdG8g
cmVzZXQ7CkBAIC0zMzIsNyArMjM2LDcgQEAgdm9pZCBpbnRlbF9kc2JfY29tbWl0KHN0cnVjdCBp
bnRlbF9kc2IgKmRzYikKIAkJICAgIGk5MTVfZ2d0dF9vZmZzZXQoZHNiLT52bWEpLCB0YWlsKTsK
IAlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRFNCX1RBSUwocGlwZSwgZHNiLT5pZCksCiAJCSAg
ICAgICBpOTE1X2dndHRfb2Zmc2V0KGRzYi0+dm1hKSArIHRhaWwpOwotCWlmICh3YWl0X2Zvcigh
aXNfZHNiX2J1c3koZHNiKSwgMSkpIHsKKwlpZiAod2FpdF9mb3IoIWlzX2RzYl9idXN5KGRldl9w
cml2LCBwaXBlLCBkc2ItPmlkKSwgMSkpIHsKIAkJZHJtX2VycigmZGV2X3ByaXYtPmRybSwKIAkJ
CSJUaW1lZCBvdXQgd2FpdGluZyBmb3IgRFNCIHdvcmtsb2FkIGNvbXBsZXRpb24uXG4iKTsKIAkJ
Z290byByZXNldDsKQEAgLTM0MSw1ICsyNDUsNzcgQEAgdm9pZCBpbnRlbF9kc2JfY29tbWl0KHN0
cnVjdCBpbnRlbF9kc2IgKmRzYikKIHJlc2V0OgogCWRzYi0+ZnJlZV9wb3MgPSAwOwogCWRzYi0+
aW5zX3N0YXJ0X29mZnNldCA9IDA7Ci0JaW50ZWxfZHNiX2Rpc2FibGVfZW5naW5lKGRzYik7CisJ
aW50ZWxfZHNiX2Rpc2FibGVfZW5naW5lKGRldl9wcml2LCBwaXBlLCBkc2ItPmlkKTsKK30KKwor
LyoqCisgKiBpbnRlbF9kc2JfcHJlcGFyZSgpIC0gQWxsb2NhdGUsIHBpbiBhbmQgbWFwIHRoZSBE
U0IgY29tbWFuZCBidWZmZXIuCisgKiBAY3J0Y19zdGF0ZTogaW50ZWxfY3J0Y19zdGF0ZSBzdHJ1
Y3R1cmUgdG8gcHJlcGFyZSBhc3NvY2lhdGVkIGRzYiBpbnN0YW5jZS4KKyAqCisgKiBUaGlzIGZ1
bmN0aW9uIHByZXBhcmUgdGhlIGNvbW1hbmQgYnVmZmVyIHdoaWNoIGlzIHVzZWQgdG8gc3RvcmUg
ZHNiCisgKiBpbnN0cnVjdGlvbnMgd2l0aCBkYXRhLgorICovCit2b2lkIGludGVsX2RzYl9wcmVw
YXJlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQoreworCXN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CisJ
c3RydWN0IGludGVsX2RzYiAqZHNiOworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7
CisJc3RydWN0IGk5MTVfdm1hICp2bWE7CisJdTMyICpidWY7CisJaW50ZWxfd2FrZXJlZl90IHdh
a2VyZWY7CisKKwlpZiAoIUhBU19EU0IoaTkxNSkpCisJCXJldHVybjsKKworCWRzYiA9IGttYWxs
b2Moc2l6ZW9mKCpkc2IpLCBHRlBfS0VSTkVMKTsKKworCXdha2VyZWYgPSBpbnRlbF9ydW50aW1l
X3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7CisKKwlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3Jl
YXRlX2ludGVybmFsKGk5MTUsIERTQl9CVUZfU0laRSk7CisJaWYgKElTX0VSUihvYmopKSB7CisJ
CWRybV9lcnIoJmk5MTUtPmRybSwgIkdlbSBvYmplY3QgY3JlYXRpb24gZmFpbGVkXG4iKTsKKwkJ
Z290byBvdXQ7CisJfQorCisJdm1hID0gaTkxNV9nZW1fb2JqZWN0X2dndHRfcGluKG9iaiwgTlVM
TCwgMCwgMCwgMCk7CisJaWYgKElTX0VSUih2bWEpKSB7CisJCWRybV9lcnIoJmk5MTUtPmRybSwg
IlZtYSBjcmVhdGlvbiBmYWlsZWRcbiIpOworCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CisJ
CWdvdG8gb3V0OworCX0KKworCWJ1ZiA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKHZtYS0+b2Jq
LCBJOTE1X01BUF9XQyk7CisJaWYgKElTX0VSUihidWYpKSB7CisJCWRybV9lcnIoJmk5MTUtPmRy
bSwgIkNvbW1hbmQgYnVmZmVyIGNyZWF0aW9uIGZhaWxlZFxuIik7CisJCWk5MTVfdm1hX3VucGlu
X2FuZF9yZWxlYXNlKCZ2bWEsIEk5MTVfVk1BX1JFTEVBU0VfTUFQKTsKKwkJa2ZyZWUoZHNiKTsK
KwkJZ290byBvdXQ7CisJfQorCisJZHNiLT5pZCA9IERTQjE7CisJZHNiLT52bWEgPSB2bWE7CisJ
ZHNiLT5jbWRfYnVmID0gYnVmOworCWRzYi0+ZnJlZV9wb3MgPSAwOworCWRzYi0+aW5zX3N0YXJ0
X29mZnNldCA9IDA7CisJY3J0Y19zdGF0ZS0+ZHNiID0gZHNiOworb3V0OgorCWludGVsX3J1bnRp
bWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKK30KKworLyoqCisgKiBpbnRl
bF9kc2JfY2xlYW51cCgpIC0gVG8gY2xlYW51cCBEU0IgY29udGV4dC4KKyAqIEBjcnRjX3N0YXRl
OiBpbnRlbF9jcnRjX3N0YXRlIHN0cnVjdHVyZSB0byBjbGVhbnVwIGFzc29jaWF0ZWQgZHNiIGlu
c3RhbmNlLgorICoKKyAqIFRoaXMgZnVuY3Rpb24gY2xlYW51cCB0aGUgRFNCIGNvbnRleHQgYnkg
dW5waW5uaW5nIGFuZCByZWxlYXNpbmcKKyAqIHRoZSBWTUEgb2JqZWN0IGFzc29jaWF0ZWQgd2l0
aCBpdC4KKyAqLwordm9pZCBpbnRlbF9kc2JfY2xlYW51cChzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSkKK3sKKwlpZiAoIWNydGNfc3RhdGUtPmRzYikKKwkJcmV0dXJuOworCisJ
aTkxNV92bWFfdW5waW5fYW5kX3JlbGVhc2UoJmNydGNfc3RhdGUtPmRzYi0+dm1hLCBJOTE1X1ZN
QV9SRUxFQVNFX01BUCk7CisJa2ZyZWUoY3J0Y19zdGF0ZS0+ZHNiKTsKKwljcnRjX3N0YXRlLT5k
c2IgPSBOVUxMOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kc2IuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHNiLmgKaW5k
ZXggMzk1ZWY5Y2U1NThlLi42NTRhMTFmMjRiODAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHNiLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kc2IuaApAQCAtMTAsNyArMTAsNyBAQAogCiAjaW5jbHVkZSAiaTkxNV9yZWcu
aCIKIAotc3RydWN0IGludGVsX2NydGM7CitzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZTsKIHN0cnVj
dCBpOTE1X3ZtYTsKIAogZW51bSBkc2JfaWQgewpAQCAtMjIsNyArMjIsNiBAQCBlbnVtIGRzYl9p
ZCB7CiB9OwogCiBzdHJ1Y3QgaW50ZWxfZHNiIHsKLQlsb25nIHJlZmNvdW50OwogCWVudW0gZHNi
X2lkIGlkOwogCXUzMiAqY21kX2J1ZjsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKQEAgLTQxLDEy
ICs0MCwxMiBAQCBzdHJ1Y3QgaW50ZWxfZHNiIHsKIAl1MzIgaW5zX3N0YXJ0X29mZnNldDsKIH07
CiAKLXN0cnVjdCBpbnRlbF9kc2IgKgotaW50ZWxfZHNiX2dldChzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0Yyk7Ci12b2lkIGludGVsX2RzYl9wdXQoc3RydWN0IGludGVsX2RzYiAqZHNiKTsKLXZvaWQg
aW50ZWxfZHNiX3JlZ193cml0ZShzdHJ1Y3QgaW50ZWxfZHNiICpkc2IsIGk5MTVfcmVnX3QgcmVn
LCB1MzIgdmFsKTsKLXZvaWQgaW50ZWxfZHNiX2luZGV4ZWRfcmVnX3dyaXRlKHN0cnVjdCBpbnRl
bF9kc2IgKmRzYiwgaTkxNV9yZWdfdCByZWcsCi0JCQkJIHUzMiB2YWwpOwotdm9pZCBpbnRlbF9k
c2JfY29tbWl0KHN0cnVjdCBpbnRlbF9kc2IgKmRzYik7Cit2b2lkIGludGVsX2RzYl9wcmVwYXJl
KHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKK3ZvaWQgaW50ZWxfZHNiX2Ns
ZWFudXAoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOwordm9pZCBpbnRlbF9k
c2JfcmVnX3dyaXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAor
CQkJIGk5MTVfcmVnX3QgcmVnLCB1MzIgdmFsKTsKK3ZvaWQgaW50ZWxfZHNiX2luZGV4ZWRfcmVn
X3dyaXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJCSBp
OTE1X3JlZ190IHJlZywgdTMyIHZhbCk7Cit2b2lkIGludGVsX2RzYl9jb21taXQoY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOwogCiAjZW5kaWYKLS0gCjIuMjYuMAoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4
IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

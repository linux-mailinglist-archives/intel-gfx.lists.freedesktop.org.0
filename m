Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 4EA102C343
	for <lists+intel-gfx@lfdr.de>; Tue, 28 May 2019 11:30:20 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id AFF236E202;
	Tue, 28 May 2019 09:30:07 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C424889F06
 for <intel-gfx@lists.freedesktop.org>; Tue, 28 May 2019 09:30:03 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16703192-1500050 
 for <intel-gfx@lists.freedesktop.org>; Tue, 28 May 2019 10:29:59 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 28 May 2019 10:29:51 +0100
Message-Id: <20190528092956.14910-10-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190528092956.14910-1-chris@chris-wilson.co.uk>
References: <20190528092956.14910-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 10/15] drm/i915: Move GEM object domain management
 from struct_mutex to local
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VXNlIHRoZSBwZXItb2JqZWN0IGxvY2FsIGxvY2sgdG8gY29udHJvbCB0aGUgY2FjaGUgZG9tYWlu
IG9mIHRoZQppbmRpdmlkdWFsIEdFTSBvYmplY3RzLCBub3Qgc3RydWN0X211dGV4LiBUaGlzIGlz
IGEgaHVnZSBsZWFwIGZvcndhcmQKZm9yIHVzIGluIHRlcm1zIG9mIG9iamVjdC1sZXZlbCBzeW5j
aHJvbmlzYXRpb247IGV4ZWNidWZmZXJzIGFyZQpjb29yZGluYXRlZCB1c2luZyB0aGUgd3dfbXV0
ZXggYW5kIHByZWFkL3B3cml0ZSBpcyBmaW5hbGx5IGZ1bGx5CnNlcmlhbGlzZWQgYWdhaW4uCgpT
aWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KUmV2
aWV3ZWQtYnk6IE1hdHRoZXcgQXVsZCA8bWF0dGhldy5hdWxkQGludGVsLmNvbT4KLS0tCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZSAgICAgICAgICAgICAgICAgfCAgIDEgKwogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsZmx1c2guYyAgIHwgICA0ICstCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG1hYnVmLmMgICAgfCAgMTAgKy0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYyAgICB8ICA3MCArKysrKy0tLS0tCiAu
Li4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMgICAgfCAxMjMgKysrKysr
KysrKysrLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZmVuY2UuYyAg
ICAgfCAgOTYgKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9vYmplY3QuYyAgICB8ICAgMiArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
b2JqZWN0LmggICAgfCAgMTQgKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9w
bS5jICAgICAgICB8ICAgNyArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2Vf
cGFnZXMuYyAgIHwgIDEyICstCiAuLi4vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvaGVy
ZW5jeS5jICAgfCAgMTIgKysKIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2Nv
bnRleHQuYyB8ICAyMCArKysKIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21t
YW4uYyAgICB8ICAgNiArCiAuLi4vZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9waHlz
LmMgICAgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVj
ay5jICB8ICAgNCArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYyAgICAg
ICAgfCAgIDIgKwogLi4uL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jICAg
IHwgICA2ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9jbWRfcGFyc2VyLmMgICAgICAgICB8
ICAgMiArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVyLmMgICAgICAgICAgfCAg
IDggKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfY21kX3BhcnNlci5jICAgICAgICB8ICAy
MyArKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jICAgICAgICAgICAgICAgfCAx
MjIgKysrKysrKysrLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5j
ICAgICAgICAgICB8ICAgNSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fcmVuZGVy
X3N0YXRlLmMgIHwgICAyICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMgICAgICAg
ICAgICAgICB8ICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaCAgICAgICAg
ICAgICAgIHwgIDEyICsrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kaXNwbGF5LmMgICAg
ICAgICAgfCAgIDUgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjX2xvZy5jICAgICAg
ICAgIHwgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9vdmVybGF5LmMgICAgICAg
ICAgfCAgMjUgKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdWNfZncuYyAgICAgICAg
ICAgIHwgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0
LmMgfCAgIDQgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfdm1hLmMgICAg
IHwgICAyICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3Rfc3Bpbm5lci5jICB8
ICAgMiArCiAzMiBmaWxlcyBjaGFuZ2VkLCA0NDUgaW5zZXJ0aW9ucygrKSwgMTgwIGRlbGV0aW9u
cygtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9mZW5jZS5jCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQppbmRleCAyZDViZjY5ZGJjNGIuLjQ0ZDZlMGJj
ZjZhNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKQEAgLTkzLDYgKzkzLDcgQEAgZ2VtLXkgKz0gXAog
CWdlbS9pOTE1X2dlbV9kbWFidWYubyBcCiAJZ2VtL2k5MTVfZ2VtX2RvbWFpbi5vIFwKIAlnZW0v
aTkxNV9nZW1fZXhlY2J1ZmZlci5vIFwKKwlnZW0vaTkxNV9nZW1fZmVuY2UubyBcCiAJZ2VtL2k5
MTVfZ2VtX2ludGVybmFsLm8gXAogCWdlbS9pOTE1X2dlbV9vYmplY3QubyBcCiAJZ2VtL2k5MTVf
Z2VtX21tYW4ubyBcCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fY2xmbHVzaC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsZmx1c2gu
YwppbmRleCA0NWQyMzhkNzg0ZmMuLjUzN2FhMjMzN2NjOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsZmx1c2guYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fY2xmbHVzaC5jCkBAIC05NSw2ICs5NSw4IEBAIGJvb2wgaTkxNV9n
ZW1fY2xmbHVzaF9vYmplY3Qoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIHsKIAlz
dHJ1Y3QgY2xmbHVzaCAqY2xmbHVzaDsKIAorCWFzc2VydF9vYmplY3RfaGVsZChvYmopOworCiAJ
LyoKIAkgKiBTdG9sZW4gbWVtb3J5IGlzIGFsd2F5cyBjb2hlcmVudCB3aXRoIHRoZSBHUFUgYXMg
aXQgaXMgZXhwbGljaXRseQogCSAqIG1hcmtlZCBhcyB3YyBieSB0aGUgc3lzdGVtLCBvciB0aGUg
c3lzdGVtIGlzIGNhY2hlLWNvaGVyZW50LgpAQCAtMTQ0LDkgKzE0Niw3IEBAIGJvb2wgaTkxNV9n
ZW1fY2xmbHVzaF9vYmplY3Qoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJCQkJ
CXRydWUsIEk5MTVfRkVOQ0VfVElNRU9VVCwKIAkJCQkJCUk5MTVfRkVOQ0VfR0ZQKTsKIAotCQly
ZXNlcnZhdGlvbl9vYmplY3RfbG9jayhvYmotPnJlc3YsIE5VTEwpOwogCQlyZXNlcnZhdGlvbl9v
YmplY3RfYWRkX2V4Y2xfZmVuY2Uob2JqLT5yZXN2LCAmY2xmbHVzaC0+ZG1hKTsKLQkJcmVzZXJ2
YXRpb25fb2JqZWN0X3VubG9jayhvYmotPnJlc3YpOwogCiAJCWk5MTVfc3dfZmVuY2VfY29tbWl0
KCZjbGZsdXNoLT53YWl0KTsKIAl9IGVsc2UgaWYgKG9iai0+bW0ucGFnZXMpIHsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kbWFidWYuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kbWFidWYuYwppbmRleCA2MjUzOTdkZWI3MDEuLmE5
M2UyMzNjZmFhOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X2RtYWJ1Zi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kbWFidWYu
YwpAQCAtMTUxLDcgKzE1MSw2IEBAIHN0YXRpYyBpbnQgaTkxNV9nZW1fZG1hYnVmX21tYXAoc3Ry
dWN0IGRtYV9idWYgKmRtYV9idWYsIHN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqCiBzdGF0aWMgaW50
IGk5MTVfZ2VtX2JlZ2luX2NwdV9hY2Nlc3Moc3RydWN0IGRtYV9idWYgKmRtYV9idWYsIGVudW0g
ZG1hX2RhdGFfZGlyZWN0aW9uIGRpcmVjdGlvbikKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqID0gZG1hX2J1Zl90b19vYmooZG1hX2J1Zik7Ci0Jc3RydWN0IGRybV9kZXZpY2Ug
KmRldiA9IG9iai0+YmFzZS5kZXY7CiAJYm9vbCB3cml0ZSA9IChkaXJlY3Rpb24gPT0gRE1BX0JJ
RElSRUNUSU9OQUwgfHwgZGlyZWN0aW9uID09IERNQV9UT19ERVZJQ0UpOwogCWludCBlcnI7CiAK
QEAgLTE1OSwxMiArMTU4LDEyIEBAIHN0YXRpYyBpbnQgaTkxNV9nZW1fYmVnaW5fY3B1X2FjY2Vz
cyhzdHJ1Y3QgZG1hX2J1ZiAqZG1hX2J1ZiwgZW51bSBkbWFfZGF0YV9kaXJlCiAJaWYgKGVycikK
IAkJcmV0dXJuIGVycjsKIAotCWVyciA9IGk5MTVfbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKGRl
dik7CisJZXJyID0gaTkxNV9nZW1fb2JqZWN0X2xvY2tfaW50ZXJydXB0aWJsZShvYmopOwogCWlm
IChlcnIpCiAJCWdvdG8gb3V0OwogCiAJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3NldF90b19jcHVf
ZG9tYWluKG9iaiwgd3JpdGUpOwotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwor
CWk5MTVfZ2VtX29iamVjdF91bmxvY2sob2JqKTsKIAogb3V0OgogCWk5MTVfZ2VtX29iamVjdF91
bnBpbl9wYWdlcyhvYmopOwpAQCAtMTc0LDE5ICsxNzMsMTggQEAgc3RhdGljIGludCBpOTE1X2dl
bV9iZWdpbl9jcHVfYWNjZXNzKHN0cnVjdCBkbWFfYnVmICpkbWFfYnVmLCBlbnVtIGRtYV9kYXRh
X2RpcmUKIHN0YXRpYyBpbnQgaTkxNV9nZW1fZW5kX2NwdV9hY2Nlc3Moc3RydWN0IGRtYV9idWYg
KmRtYV9idWYsIGVudW0gZG1hX2RhdGFfZGlyZWN0aW9uIGRpcmVjdGlvbikKIHsKIAlzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gZG1hX2J1Zl90b19vYmooZG1hX2J1Zik7Ci0Jc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiA9IG9iai0+YmFzZS5kZXY7CiAJaW50IGVycjsKIAogCWVyciA9
IGk5MTVfZ2VtX29iamVjdF9waW5fcGFnZXMob2JqKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJy
OwogCi0JZXJyID0gaTkxNV9tdXRleF9sb2NrX2ludGVycnVwdGlibGUoZGV2KTsKKwllcnIgPSBp
OTE1X2dlbV9vYmplY3RfbG9ja19pbnRlcnJ1cHRpYmxlKG9iaik7CiAJaWYgKGVycikKIAkJZ290
byBvdXQ7CiAKIAllcnIgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2d0dF9kb21haW4ob2JqLCBm
YWxzZSk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CisJaTkxNV9nZW1fb2Jq
ZWN0X3VubG9jayhvYmopOwogCiBvdXQ6CiAJaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKG9i
aik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWlu
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMKaW5kZXggYmJj
N2ZiNzU4MTg2Li5jY2U5NmU2YzZlNTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9kb21haW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fZG9tYWluLmMKQEAgLTI5LDkgKzI5LDkgQEAgdm9pZCBpOTE1X2dlbV9vYmplY3RfZmx1
c2hfaWZfZGlzcGxheShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCWlmICghUkVB
RF9PTkNFKG9iai0+cGluX2dsb2JhbCkpCiAJCXJldHVybjsKIAotCW11dGV4X2xvY2soJm9iai0+
YmFzZS5kZXYtPnN0cnVjdF9tdXRleCk7CisJaTkxNV9nZW1fb2JqZWN0X2xvY2sob2JqKTsKIAlf
X2k5MTVfZ2VtX29iamVjdF9mbHVzaF9mb3JfZGlzcGxheShvYmopOwotCW11dGV4X3VubG9jaygm
b2JqLT5iYXNlLmRldi0+c3RydWN0X211dGV4KTsKKwlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKG9i
aik7CiB9CiAKIC8qKgpAQCAtNDcsMTEgKzQ3LDEwIEBAIGk5MTVfZ2VtX29iamVjdF9zZXRfdG9f
d2NfZG9tYWluKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosIGJvb2wgd3JpdGUpCiB7
CiAJaW50IHJldDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJm9iai0+YmFzZS5kZXYtPnN0cnVj
dF9tdXRleCk7CisJYXNzZXJ0X29iamVjdF9oZWxkKG9iaik7CiAKIAlyZXQgPSBpOTE1X2dlbV9v
YmplY3Rfd2FpdChvYmosCiAJCQkJICAgSTkxNV9XQUlUX0lOVEVSUlVQVElCTEUgfAotCQkJCSAg
IEk5MTVfV0FJVF9MT0NLRUQgfAogCQkJCSAgICh3cml0ZSA/IEk5MTVfV0FJVF9BTEwgOiAwKSwK
IAkJCQkgICBNQVhfU0NIRURVTEVfVElNRU9VVCk7CiAJaWYgKHJldCkKQEAgLTEwOSwxMSArMTA4
LDEwIEBAIGk5MTVfZ2VtX29iamVjdF9zZXRfdG9fZ3R0X2RvbWFpbihzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqLCBib29sIHdyaXRlKQogewogCWludCByZXQ7CiAKLQlsb2NrZGVwX2Fz
c2VydF9oZWxkKCZvYmotPmJhc2UuZGV2LT5zdHJ1Y3RfbXV0ZXgpOworCWFzc2VydF9vYmplY3Rf
aGVsZChvYmopOwogCiAJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3dhaXQob2JqLAogCQkJCSAgIEk5
MTVfV0FJVF9JTlRFUlJVUFRJQkxFIHwKLQkJCQkgICBJOTE1X1dBSVRfTE9DS0VEIHwKIAkJCQkg
ICAod3JpdGUgPyBJOTE1X1dBSVRfQUxMIDogMCksCiAJCQkJICAgTUFYX1NDSEVEVUxFX1RJTUVP
VVQpOwogCWlmIChyZXQpCkBAIC0xNzksNyArMTc3LDcgQEAgaW50IGk5MTVfZ2VtX29iamVjdF9z
ZXRfY2FjaGVfbGV2ZWwoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlzdHJ1Y3Qg
aTkxNV92bWEgKnZtYTsKIAlpbnQgcmV0OwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmb2JqLT5i
YXNlLmRldi0+c3RydWN0X211dGV4KTsKKwlhc3NlcnRfb2JqZWN0X2hlbGQob2JqKTsKIAogCWlm
IChvYmotPmNhY2hlX2xldmVsID09IGNhY2hlX2xldmVsKQogCQlyZXR1cm4gMDsKQEAgLTIyOCw3
ICsyMjYsNiBAQCBpbnQgaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNoZV9sZXZlbChzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkgKi8KIAkJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3dh
aXQob2JqLAogCQkJCQkgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSB8Ci0JCQkJCSAgIEk5MTVf
V0FJVF9MT0NLRUQgfAogCQkJCQkgICBJOTE1X1dBSVRfQUxMLAogCQkJCQkgICBNQVhfU0NIRURV
TEVfVElNRU9VVCk7CiAJCWlmIChyZXQpCkBAIC0zNzIsMTIgKzM2OSwxNiBAQCBpbnQgaTkxNV9n
ZW1fc2V0X2NhY2hpbmdfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwK
IAlpZiAocmV0KQogCQlnb3RvIG91dDsKIAotCXJldCA9IGk5MTVfbXV0ZXhfbG9ja19pbnRlcnJ1
cHRpYmxlKGRldik7CisJcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIAlpZiAocmV0KQogCQlnb3RvIG91dDsKIAotCXJldCA9IGk5MTVfZ2Vt
X29iamVjdF9zZXRfY2FjaGVfbGV2ZWwob2JqLCBsZXZlbCk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXYt
PnN0cnVjdF9tdXRleCk7CisJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X2xvY2tfaW50ZXJydXB0aWJs
ZShvYmopOworCWlmIChyZXQgPT0gMCkgeworCQlyZXQgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X2Nh
Y2hlX2xldmVsKG9iaiwgbGV2ZWwpOworCQlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKG9iaik7CisJ
fQorCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIG91dDoKIAlpOTE1
X2dlbV9vYmplY3RfcHV0KG9iaik7CkBAIC0zOTksNyArNDAwLDcgQEAgaTkxNV9nZW1fb2JqZWN0
X3Bpbl90b19kaXNwbGF5X3BsYW5lKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJ
c3RydWN0IGk5MTVfdm1hICp2bWE7CiAJaW50IHJldDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQo
Jm9iai0+YmFzZS5kZXYtPnN0cnVjdF9tdXRleCk7CisJYXNzZXJ0X29iamVjdF9oZWxkKG9iaik7
CiAKIAkvKiBNYXJrIHRoZSBnbG9iYWwgcGluIGVhcmx5IHNvIHRoYXQgd2UgYWNjb3VudCBmb3Ig
dGhlCiAJICogZGlzcGxheSBjb2hlcmVuY3kgd2hpbHN0IHNldHRpbmcgdXAgdGhlIGNhY2hlIGRv
bWFpbnMuCkBAIC00ODQsMTYgKzQ4NSwxOCBAQCBzdGF0aWMgdm9pZCBpOTE1X2dlbV9vYmplY3Rf
YnVtcF9pbmFjdGl2ZV9nZ3R0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiB2b2lk
CiBpOTE1X2dlbV9vYmplY3RfdW5waW5fZnJvbV9kaXNwbGF5X3BsYW5lKHN0cnVjdCBpOTE1X3Zt
YSAqdm1hKQogewotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0tPmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB2bWEtPm9iajsK
KworCWFzc2VydF9vYmplY3RfaGVsZChvYmopOwogCi0JaWYgKFdBUk5fT04odm1hLT5vYmotPnBp
bl9nbG9iYWwgPT0gMCkpCisJaWYgKFdBUk5fT04ob2JqLT5waW5fZ2xvYmFsID09IDApKQogCQly
ZXR1cm47CiAKLQlpZiAoLS12bWEtPm9iai0+cGluX2dsb2JhbCA9PSAwKQorCWlmICgtLW9iai0+
cGluX2dsb2JhbCA9PSAwKQogCQl2bWEtPmRpc3BsYXlfYWxpZ25tZW50ID0gSTkxNV9HVFRfTUlO
X0FMSUdOTUVOVDsKIAogCS8qIEJ1bXAgdGhlIExSVSB0byB0cnkgYW5kIGF2b2lkIHByZW1hdHVy
ZSBldmljdGlvbiB3aGlsc3QgZmxpcHBpbmcgICovCi0JaTkxNV9nZW1fb2JqZWN0X2J1bXBfaW5h
Y3RpdmVfZ2d0dCh2bWEtPm9iaik7CisJaTkxNV9nZW1fb2JqZWN0X2J1bXBfaW5hY3RpdmVfZ2d0
dChvYmopOwogCiAJaTkxNV92bWFfdW5waW4odm1hKTsKIH0KQEAgLTUxMSwxMSArNTE0LDEwIEBA
IGk5MTVfZ2VtX29iamVjdF9zZXRfdG9fY3B1X2RvbWFpbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqLCBib29sIHdyaXRlKQogewogCWludCByZXQ7CiAKLQlsb2NrZGVwX2Fzc2VydF9o
ZWxkKCZvYmotPmJhc2UuZGV2LT5zdHJ1Y3RfbXV0ZXgpOworCWFzc2VydF9vYmplY3RfaGVsZChv
YmopOwogCiAJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3dhaXQob2JqLAogCQkJCSAgIEk5MTVfV0FJ
VF9JTlRFUlJVUFRJQkxFIHwKLQkJCQkgICBJOTE1X1dBSVRfTE9DS0VEIHwKIAkJCQkgICAod3Jp
dGUgPyBJOTE1X1dBSVRfQUxMIDogMCksCiAJCQkJICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwog
CWlmIChyZXQpCkBAIC02MzcsNyArNjM5LDcgQEAgaTkxNV9nZW1fc2V0X2RvbWFpbl9pb2N0bChz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCWlmIChlcnIpCiAJCWdvdG8gb3V0
OwogCi0JZXJyID0gaTkxNV9tdXRleF9sb2NrX2ludGVycnVwdGlibGUoZGV2KTsKKwllcnIgPSBp
OTE1X2dlbV9vYmplY3RfbG9ja19pbnRlcnJ1cHRpYmxlKG9iaik7CiAJaWYgKGVycikKIAkJZ290
byBvdXRfdW5waW47CiAKQEAgLTY1MSw3ICs2NTMsNyBAQCBpOTE1X2dlbV9zZXRfZG9tYWluX2lv
Y3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJLyogQW5kIGJ1bXAgdGhl
IExSVSBmb3IgdGhpcyBhY2Nlc3MgKi8KIAlpOTE1X2dlbV9vYmplY3RfYnVtcF9pbmFjdGl2ZV9n
Z3R0KG9iaik7CiAKLQltdXRleF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKKwlpOTE1X2dl
bV9vYmplY3RfdW5sb2NrKG9iaik7CiAKIAlpZiAod3JpdGVfZG9tYWluICE9IDApCiAJCWludGVs
X2ZiX29ial9pbnZhbGlkYXRlKG9iaiwKQEAgLTY3NCwyMiArNjc2LDIzIEBAIGludCBpOTE1X2dl
bV9vYmplY3RfcHJlcGFyZV9yZWFkKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiB7
CiAJaW50IHJldDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJm9iai0+YmFzZS5kZXYtPnN0cnVj
dF9tdXRleCk7Ci0KIAkqbmVlZHNfY2xmbHVzaCA9IDA7CiAJaWYgKCFpOTE1X2dlbV9vYmplY3Rf
aGFzX3N0cnVjdF9wYWdlKG9iaikpCiAJCXJldHVybiAtRU5PREVWOwogCisJcmV0ID0gaTkxNV9n
ZW1fb2JqZWN0X2xvY2tfaW50ZXJydXB0aWJsZShvYmopOworCWlmIChyZXQpCisJCXJldHVybiBy
ZXQ7CisKIAlyZXQgPSBpOTE1X2dlbV9vYmplY3Rfd2FpdChvYmosCi0JCQkJICAgSTkxNV9XQUlU
X0lOVEVSUlVQVElCTEUgfAotCQkJCSAgIEk5MTVfV0FJVF9MT0NLRUQsCisJCQkJICAgSTkxNV9X
QUlUX0lOVEVSUlVQVElCTEUsCiAJCQkJICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwogCWlmIChy
ZXQpCi0JCXJldHVybiByZXQ7CisJCWdvdG8gZXJyX3VubG9jazsKIAogCXJldCA9IGk5MTVfZ2Vt
X29iamVjdF9waW5fcGFnZXMob2JqKTsKIAlpZiAocmV0KQotCQlyZXR1cm4gcmV0OworCQlnb3Rv
IGVycl91bmxvY2s7CiAKIAlpZiAob2JqLT5jYWNoZV9jb2hlcmVudCAmIEk5MTVfQk9fQ0FDSEVf
Q09IRVJFTlRfRk9SX1JFQUQgfHwKIAkgICAgIXN0YXRpY19jcHVfaGFzKFg4Nl9GRUFUVVJFX0NM
RkxVU0gpKSB7CkBAIC03MTcsNiArNzIwLDggQEAgaW50IGk5MTVfZ2VtX29iamVjdF9wcmVwYXJl
X3JlYWQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAogZXJyX3VucGluOgogCWk5
MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmopOworZXJyX3VubG9jazoKKwlpOTE1X2dlbV9v
YmplY3RfdW5sb2NrKG9iaik7CiAJcmV0dXJuIHJldDsKIH0KIApAQCAtNzI1LDIzICs3MzAsMjQg
QEAgaW50IGk5MTVfZ2VtX29iamVjdF9wcmVwYXJlX3dyaXRlKHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmosCiB7CiAJaW50IHJldDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJm9iai0+
YmFzZS5kZXYtPnN0cnVjdF9tdXRleCk7Ci0KIAkqbmVlZHNfY2xmbHVzaCA9IDA7CiAJaWYgKCFp
OTE1X2dlbV9vYmplY3RfaGFzX3N0cnVjdF9wYWdlKG9iaikpCiAJCXJldHVybiAtRU5PREVWOwog
CisJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X2xvY2tfaW50ZXJydXB0aWJsZShvYmopOworCWlmIChy
ZXQpCisJCXJldHVybiByZXQ7CisKIAlyZXQgPSBpOTE1X2dlbV9vYmplY3Rfd2FpdChvYmosCiAJ
CQkJICAgSTkxNV9XQUlUX0lOVEVSUlVQVElCTEUgfAotCQkJCSAgIEk5MTVfV0FJVF9MT0NLRUQg
fAogCQkJCSAgIEk5MTVfV0FJVF9BTEwsCiAJCQkJICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwog
CWlmIChyZXQpCi0JCXJldHVybiByZXQ7CisJCWdvdG8gZXJyX3VubG9jazsKIAogCXJldCA9IGk5
MTVfZ2VtX29iamVjdF9waW5fcGFnZXMob2JqKTsKIAlpZiAocmV0KQotCQlyZXR1cm4gcmV0Owor
CQlnb3RvIGVycl91bmxvY2s7CiAKIAlpZiAob2JqLT5jYWNoZV9jb2hlcmVudCAmIEk5MTVfQk9f
Q0FDSEVfQ09IRVJFTlRfRk9SX1dSSVRFIHx8CiAJICAgICFzdGF0aWNfY3B1X2hhcyhYODZfRkVB
VFVSRV9DTEZMVVNIKSkgewpAQCAtNzc4LDUgKzc4NCw3IEBAIGludCBpOTE1X2dlbV9vYmplY3Rf
cHJlcGFyZV93cml0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCiBlcnJfdW5w
aW46CiAJaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKG9iaik7CitlcnJfdW5sb2NrOgorCWk5
MTVfZ2VtX29iamVjdF91bmxvY2sob2JqKTsKIAlyZXR1cm4gcmV0OwogfQpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKaW5kZXggMDllNjRiZjMzODQy
Li5lZDUyMmZkZmJlN2YgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9leGVjYnVmZmVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X2V4ZWNidWZmZXIuYwpAQCAtMTA3NSw3ICsxMDc1LDkgQEAgc3RhdGljIHZvaWQgKnJlbG9jX2lv
bWFwKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCWlmICh1c2VfY3B1X3JlbG9j
KGNhY2hlLCBvYmopKQogCQkJcmV0dXJuIE5VTEw7CiAKKwkJaTkxNV9nZW1fb2JqZWN0X2xvY2so
b2JqKTsKIAkJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3NldF90b19ndHRfZG9tYWluKG9iaiwgdHJ1
ZSk7CisJCWk5MTVfZ2VtX29iamVjdF91bmxvY2sob2JqKTsKIAkJaWYgKGVycikKIAkJCXJldHVy
biBFUlJfUFRSKGVycik7CiAKQEAgLTExNjQsNiArMTE2NiwyNiBAQCBzdGF0aWMgdm9pZCBjbGZs
dXNoX3dyaXRlMzIodTMyICphZGRyLCB1MzIgdmFsdWUsIHVuc2lnbmVkIGludCBmbHVzaGVzKQog
CQkqYWRkciA9IHZhbHVlOwogfQogCitzdGF0aWMgaW50IHJlbG9jX21vdmVfdG9fZ3B1KHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxLCBzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKK3sKKwlzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqID0gdm1hLT5vYmo7CisJaW50IGVycjsKKworCWk5MTVfdm1h
X2xvY2sodm1hKTsKKworCWlmIChvYmotPmNhY2hlX2RpcnR5ICYgfm9iai0+Y2FjaGVfY29oZXJl
bnQpCisJCWk5MTVfZ2VtX2NsZmx1c2hfb2JqZWN0KG9iaiwgMCk7CisJb2JqLT53cml0ZV9kb21h
aW4gPSAwOworCisJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X29iamVjdChycSwgdm1hLT5vYmos
IHRydWUpOworCWlmIChlcnIgPT0gMCkKKwkJZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3RpdmUo
dm1hLCBycSwgRVhFQ19PQkpFQ1RfV1JJVEUpOworCisJaTkxNV92bWFfdW5sb2NrKHZtYSk7CisK
KwlyZXR1cm4gZXJyOworfQorCiBzdGF0aWMgaW50IF9fcmVsb2NfZ3B1X2FsbG9jKHN0cnVjdCBp
OTE1X2V4ZWNidWZmZXIgKmViLAogCQkJICAgICBzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAkJCSAg
ICAgdW5zaWduZWQgaW50IGxlbikKQEAgLTExNzUsMTUgKzExOTcsNiBAQCBzdGF0aWMgaW50IF9f
cmVsb2NfZ3B1X2FsbG9jKHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViLAogCXUzMiAqY21kOwog
CWludCBlcnI7CiAKLQlpZiAoREJHX0ZPUkNFX1JFTE9DID09IEZPUkNFX0dQVV9SRUxPQykgewot
CQlvYmogPSB2bWEtPm9iajsKLQkJaWYgKG9iai0+Y2FjaGVfZGlydHkgJiB+b2JqLT5jYWNoZV9j
b2hlcmVudCkKLQkJCWk5MTVfZ2VtX2NsZmx1c2hfb2JqZWN0KG9iaiwgMCk7Ci0JCW9iai0+d3Jp
dGVfZG9tYWluID0gMDsKLQl9Ci0KLQlHRU1fQlVHX09OKHZtYS0+b2JqLT53cml0ZV9kb21haW4g
JiBJOTE1X0dFTV9ET01BSU5fQ1BVKTsKLQogCW9iaiA9IGk5MTVfZ2VtX2JhdGNoX3Bvb2xfZ2V0
KCZlYi0+ZW5naW5lLT5iYXRjaF9wb29sLCBQQUdFX1NJWkUpOwogCWlmIChJU19FUlIob2JqKSkK
IAkJcmV0dXJuIFBUUl9FUlIob2JqKTsKQEAgLTEyMTIsNyArMTIyNSw3IEBAIHN0YXRpYyBpbnQg
X19yZWxvY19ncHVfYWxsb2Moc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsCiAJCWdvdG8gZXJy
X3VucGluOwogCX0KIAotCWVyciA9IGk5MTVfcmVxdWVzdF9hd2FpdF9vYmplY3QocnEsIHZtYS0+
b2JqLCB0cnVlKTsKKwllcnIgPSByZWxvY19tb3ZlX3RvX2dwdShycSwgdm1hKTsKIAlpZiAoZXJy
KQogCQlnb3RvIGVycl9yZXF1ZXN0OwogCkBAIC0xMjIwLDE0ICsxMjMzLDEyIEBAIHN0YXRpYyBp
bnQgX19yZWxvY19ncHVfYWxsb2Moc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsCiAJCQkJCWJh
dGNoLT5ub2RlLnN0YXJ0LCBQQUdFX1NJWkUsCiAJCQkJCWNhY2hlLT5nZW4gPiA1ID8gMCA6IEk5
MTVfRElTUEFUQ0hfU0VDVVJFKTsKIAlpZiAoZXJyKQotCQlnb3RvIGVycl9yZXF1ZXN0OworCQln
b3RvIHNraXBfcmVxdWVzdDsKIAorCWk5MTVfdm1hX2xvY2soYmF0Y2gpOwogCUdFTV9CVUdfT04o
IXJlc2VydmF0aW9uX29iamVjdF90ZXN0X3NpZ25hbGVkX3JjdShiYXRjaC0+cmVzdiwgdHJ1ZSkp
OwogCWVyciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKGJhdGNoLCBycSwgMCk7Ci0JaWYgKGVy
cikKLQkJZ290byBza2lwX3JlcXVlc3Q7Ci0KLQllcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2
ZSh2bWEsIHJxLCBFWEVDX09CSkVDVF9XUklURSk7CisJaTkxNV92bWFfdW5sb2NrKGJhdGNoKTsK
IAlpZiAoZXJyKQogCQlnb3RvIHNraXBfcmVxdWVzdDsKIApAQCAtMTgzNywyNCArMTg0OCw1OSBA
QCBzdGF0aWMgaW50IGViX3JlbG9jYXRlKHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViKQogc3Rh
dGljIGludCBlYl9tb3ZlX3RvX2dwdShzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYikKIHsKIAlj
b25zdCB1bnNpZ25lZCBpbnQgY291bnQgPSBlYi0+YnVmZmVyX2NvdW50OworCXN0cnVjdCB3d19h
Y3F1aXJlX2N0eCBhY3F1aXJlOwogCXVuc2lnbmVkIGludCBpOwotCWludCBlcnI7CisJaW50IGVy
ciA9IDA7CisKKwl3d19hY3F1aXJlX2luaXQoJmFjcXVpcmUsICZyZXNlcnZhdGlvbl93d19jbGFz
cyk7CiAKIAlmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykgeworCQlzdHJ1Y3QgaTkxNV92bWEg
KnZtYSA9IGViLT52bWFbaV07CisKKwkJZXJyID0gd3dfbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxl
KCZ2bWEtPnJlc3YtPmxvY2ssICZhY3F1aXJlKTsKKwkJaWYgKCFlcnIpCisJCQljb250aW51ZTsK
KworCQlHRU1fQlVHX09OKGVyciA9PSAtRUFMUkVBRFkpOyAvKiBObyBkdXBsaWNhdGUgdm1hICov
CisKKwkJaWYgKGVyciA9PSAtRURFQURMSykgeworCQkJR0VNX0JVR19PTihpID09IDApOworCQkJ
ZG8geworCQkJCWludCBqID0gaSAtIDE7CisKKwkJCQl3d19tdXRleF91bmxvY2soJmViLT52bWFb
al0tPnJlc3YtPmxvY2spOworCisJCQkJc3dhcChlYi0+ZmxhZ3NbaV0sIGViLT5mbGFnc1tqXSk7
CisJCQkJc3dhcChlYi0+dm1hW2ldLCAgZWItPnZtYVtqXSk7CisJCQkJZWItPnZtYVtpXS0+ZXhl
Y19mbGFncyA9ICZlYi0+ZmxhZ3NbaV07CisJCQl9IHdoaWxlICgtLWkpOworCQkJR0VNX0JVR19P
Tih2bWEgIT0gZWItPnZtYVswXSk7CisJCQl2bWEtPmV4ZWNfZmxhZ3MgPSAmZWItPmZsYWdzWzBd
OworCisJCQllcnIgPSB3d19tdXRleF9sb2NrX3Nsb3dfaW50ZXJydXB0aWJsZSgmdm1hLT5yZXN2
LT5sb2NrLAorCQkJCQkJCSAgICAgICAmYWNxdWlyZSk7CisJCX0KKwkJaWYgKGVycikKKwkJCWJy
ZWFrOworCX0KKwl3d19hY3F1aXJlX2RvbmUoJmFjcXVpcmUpOworCisJd2hpbGUgKGktLSkgewog
CQl1bnNpZ25lZCBpbnQgZmxhZ3MgPSBlYi0+ZmxhZ3NbaV07CiAJCXN0cnVjdCBpOTE1X3ZtYSAq
dm1hID0gZWItPnZtYVtpXTsKIAkJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IHZt
YS0+b2JqOwogCisJCWFzc2VydF92bWFfaGVsZCh2bWEpOworCiAJCWlmIChmbGFncyAmIEVYRUNf
T0JKRUNUX0NBUFRVUkUpIHsKIAkJCXN0cnVjdCBpOTE1X2NhcHR1cmVfbGlzdCAqY2FwdHVyZTsK
IAogCQkJY2FwdHVyZSA9IGttYWxsb2Moc2l6ZW9mKCpjYXB0dXJlKSwgR0ZQX0tFUk5FTCk7Ci0J
CQlpZiAodW5saWtlbHkoIWNhcHR1cmUpKQotCQkJCXJldHVybiAtRU5PTUVNOwotCi0JCQljYXB0
dXJlLT5uZXh0ID0gZWItPnJlcXVlc3QtPmNhcHR1cmVfbGlzdDsKLQkJCWNhcHR1cmUtPnZtYSA9
IGViLT52bWFbaV07Ci0JCQllYi0+cmVxdWVzdC0+Y2FwdHVyZV9saXN0ID0gY2FwdHVyZTsKKwkJ
CWlmIChjYXB0dXJlKSB7CisJCQkJY2FwdHVyZS0+bmV4dCA9IGViLT5yZXF1ZXN0LT5jYXB0dXJl
X2xpc3Q7CisJCQkJY2FwdHVyZS0+dm1hID0gdm1hOworCQkJCWViLT5yZXF1ZXN0LT5jYXB0dXJl
X2xpc3QgPSBjYXB0dXJlOworCQkJfQogCQl9CiAKIAkJLyoKQEAgLTE4NzQsMjQgKzE5MjAsMTUg
QEAgc3RhdGljIGludCBlYl9tb3ZlX3RvX2dwdShzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYikK
IAkJCQlmbGFncyAmPSB+RVhFQ19PQkpFQ1RfQVNZTkM7CiAJCX0KIAotCQlpZiAoZmxhZ3MgJiBF
WEVDX09CSkVDVF9BU1lOQykKLQkJCWNvbnRpbnVlOwotCi0JCWVyciA9IGk5MTVfcmVxdWVzdF9h
d2FpdF9vYmplY3QKLQkJCShlYi0+cmVxdWVzdCwgb2JqLCBmbGFncyAmIEVYRUNfT0JKRUNUX1dS
SVRFKTsKLQkJaWYgKGVycikKLQkJCXJldHVybiBlcnI7Ci0JfQorCQlpZiAoZXJyID09IDAgJiYg
IShmbGFncyAmIEVYRUNfT0JKRUNUX0FTWU5DKSkgeworCQkJZXJyID0gaTkxNV9yZXF1ZXN0X2F3
YWl0X29iamVjdAorCQkJCShlYi0+cmVxdWVzdCwgb2JqLCBmbGFncyAmIEVYRUNfT0JKRUNUX1dS
SVRFKTsKKwkJfQogCi0JZm9yIChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKLQkJdW5zaWduZWQg
aW50IGZsYWdzID0gZWItPmZsYWdzW2ldOwotCQlzdHJ1Y3QgaTkxNV92bWEgKnZtYSA9IGViLT52
bWFbaV07CisJCWlmIChlcnIgPT0gMCkKKwkJCWVyciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZl
KHZtYSwgZWItPnJlcXVlc3QsIGZsYWdzKTsKIAotCQllcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2Fj
dGl2ZSh2bWEsIGViLT5yZXF1ZXN0LCBmbGFncyk7Ci0JCWlmICh1bmxpa2VseShlcnIpKSB7Ci0J
CQlpOTE1X3JlcXVlc3Rfc2tpcChlYi0+cmVxdWVzdCwgZXJyKTsKLQkJCXJldHVybiBlcnI7Ci0J
CX0KKwkJaTkxNV92bWFfdW5sb2NrKHZtYSk7CiAKIAkJX19lYl91bnJlc2VydmVfdm1hKHZtYSwg
ZmxhZ3MpOwogCQl2bWEtPmV4ZWNfZmxhZ3MgPSBOVUxMOwpAQCAtMTg5OSwxMiArMTkzNiwyMCBA
QCBzdGF0aWMgaW50IGViX21vdmVfdG9fZ3B1KHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViKQog
CQlpZiAodW5saWtlbHkoZmxhZ3MgJiBfX0VYRUNfT0JKRUNUX0hBU19SRUYpKQogCQkJaTkxNV92
bWFfcHV0KHZtYSk7CiAJfQorCXd3X2FjcXVpcmVfZmluaSgmYWNxdWlyZSk7CisKKwlpZiAodW5s
aWtlbHkoZXJyKSkKKwkJZ290byBlcnJfc2tpcDsKKwogCWViLT5leGVjID0gTlVMTDsKIAogCS8q
IFVuY29uZGl0aW9uYWxseSBmbHVzaCBhbnkgY2hpcHNldCBjYWNoZXMgKGZvciBzdHJlYW1pbmcg
d3JpdGVzKS4gKi8KIAlpOTE1X2dlbV9jaGlwc2V0X2ZsdXNoKGViLT5pOTE1KTsKLQogCXJldHVy
biAwOworCitlcnJfc2tpcDoKKwlpOTE1X3JlcXVlc3Rfc2tpcChlYi0+cmVxdWVzdCwgZXJyKTsK
KwlyZXR1cm4gZXJyOwogfQogCiBzdGF0aWMgYm9vbCBpOTE1X2dlbV9jaGVja19leGVjYnVmZmVy
KHN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY2J1ZmZlcjIgKmV4ZWMpCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZmVuY2UuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9mZW5jZS5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAw
MDAwMDAwMC4uNTdkYmMwODYyNzEzCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX2ZlbmNlLmMKQEAgLTAsMCArMSw5NiBAQAorLyoKKyAqIFNQRFgt
TGljZW5zZS1JZGVudGlmaWVyOiBNSVQKKyAqCisgKiBDb3B5cmlnaHQgwqkgMjAxOSBJbnRlbCBD
b3Jwb3JhdGlvbgorICovCisKKyNpbmNsdWRlICJpOTE1X2Rydi5oIgorI2luY2x1ZGUgImk5MTVf
Z2VtX29iamVjdC5oIgorCitzdHJ1Y3Qgc3R1Yl9mZW5jZSB7CisJc3RydWN0IGRtYV9mZW5jZSBk
bWE7CisJc3RydWN0IGk5MTVfc3dfZmVuY2UgY2hhaW47Cit9OworCitzdGF0aWMgaW50IF9faTkx
NV9zd19mZW5jZV9jYWxsCitzdHViX25vdGlmeShzdHJ1Y3QgaTkxNV9zd19mZW5jZSAqZmVuY2Us
IGVudW0gaTkxNV9zd19mZW5jZV9ub3RpZnkgc3RhdGUpCit7CisJc3RydWN0IHN0dWJfZmVuY2Ug
KnN0dWIgPSBjb250YWluZXJfb2YoZmVuY2UsIHR5cGVvZigqc3R1YiksIGNoYWluKTsKKworCXN3
aXRjaCAoc3RhdGUpIHsKKwljYXNlIEZFTkNFX0NPTVBMRVRFOgorCQlkbWFfZmVuY2Vfc2lnbmFs
KCZzdHViLT5kbWEpOworCQlicmVhazsKKworCWNhc2UgRkVOQ0VfRlJFRToKKwkJZG1hX2ZlbmNl
X3B1dCgmc3R1Yi0+ZG1hKTsKKwkJYnJlYWs7CisJfQorCisJcmV0dXJuIE5PVElGWV9ET05FOwor
fQorCitzdGF0aWMgY29uc3QgY2hhciAqc3R1Yl9kcml2ZXJfbmFtZShzdHJ1Y3QgZG1hX2ZlbmNl
ICpmZW5jZSkKK3sKKwlyZXR1cm4gRFJJVkVSX05BTUU7Cit9CisKK3N0YXRpYyBjb25zdCBjaGFy
ICpzdHViX3RpbWVsaW5lX25hbWUoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCit7CisJcmV0dXJu
ICJvYmplY3QiOworfQorCitzdGF0aWMgdm9pZCBzdHViX3JlbGVhc2Uoc3RydWN0IGRtYV9mZW5j
ZSAqZmVuY2UpCit7CisJc3RydWN0IHN0dWJfZmVuY2UgKnN0dWIgPSBjb250YWluZXJfb2YoZmVu
Y2UsIHR5cGVvZigqc3R1YiksIGRtYSk7CisKKwlpOTE1X3N3X2ZlbmNlX2ZpbmkoJnN0dWItPmNo
YWluKTsKKworCUJVSUxEX0JVR19PTihvZmZzZXRvZih0eXBlb2YoKnN0dWIpLCBkbWEpKTsKKwlk
bWFfZmVuY2VfZnJlZSgmc3R1Yi0+ZG1hKTsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkbWFf
ZmVuY2Vfb3BzIHN0dWJfZmVuY2Vfb3BzID0geworCS5nZXRfZHJpdmVyX25hbWUgPSBzdHViX2Ry
aXZlcl9uYW1lLAorCS5nZXRfdGltZWxpbmVfbmFtZSA9IHN0dWJfdGltZWxpbmVfbmFtZSwKKwku
cmVsZWFzZSA9IHN0dWJfcmVsZWFzZSwKK307CisKK3N0cnVjdCBkbWFfZmVuY2UgKgoraTkxNV9n
ZW1fb2JqZWN0X2xvY2tfZmVuY2Uoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKK3sK
KwlzdHJ1Y3Qgc3R1Yl9mZW5jZSAqc3R1YjsKKworCWFzc2VydF9vYmplY3RfaGVsZChvYmopOwor
CisJc3R1YiA9IGttYWxsb2Moc2l6ZW9mKCpzdHViKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFzdHVi
KQorCQlyZXR1cm4gTlVMTDsKKworCWk5MTVfc3dfZmVuY2VfaW5pdCgmc3R1Yi0+Y2hhaW4sIHN0
dWJfbm90aWZ5KTsKKwlkbWFfZmVuY2VfaW5pdCgmc3R1Yi0+ZG1hLCAmc3R1Yl9mZW5jZV9vcHMs
ICZzdHViLT5jaGFpbi53YWl0LmxvY2ssCisJCSAgICAgICB0b19pOTE1KG9iai0+YmFzZS5kZXYp
LT5tbS51bm9yZGVyZWRfdGltZWxpbmUsCisJCSAgICAgICAwKTsKKworCWlmIChpOTE1X3N3X2Zl
bmNlX2F3YWl0X3Jlc2VydmF0aW9uKCZzdHViLT5jaGFpbiwKKwkJCQkJICAgIG9iai0+cmVzdiwg
TlVMTCwKKwkJCQkJICAgIHRydWUsIEk5MTVfRkVOQ0VfVElNRU9VVCwKKwkJCQkJICAgIEk5MTVf
RkVOQ0VfR0ZQKSA8IDApCisJCWdvdG8gZXJyOworCisJcmVzZXJ2YXRpb25fb2JqZWN0X2FkZF9l
eGNsX2ZlbmNlKG9iai0+cmVzdiwgJnN0dWItPmRtYSk7CisKKwlyZXR1cm4gJnN0dWItPmRtYTsK
KworZXJyOgorCXN0dWJfcmVsZWFzZSgmc3R1Yi0+ZG1hKTsKKwlyZXR1cm4gTlVMTDsKK30KKwor
dm9pZCBpOTE1X2dlbV9vYmplY3RfdW5sb2NrX2ZlbmNlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmosCisJCQkJICBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSkKK3sKKwlzdHJ1Y3Qgc3R1
Yl9mZW5jZSAqc3R1YiA9IGNvbnRhaW5lcl9vZihmZW5jZSwgdHlwZW9mKCpzdHViKSwgZG1hKTsK
KworCWk5MTVfc3dfZmVuY2VfY29tbWl0KCZzdHViLT5jaGFpbik7Cit9CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMKaW5kZXggNDU3ZTY5NGE1YzNmLi5hNmEzNDUy
ZDJiM2UgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmpl
Y3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMKQEAg
LTM3OCw2ICszNzgsOCBAQCBpOTE1X2dlbV9vYmplY3RfZmx1c2hfd3JpdGVfZG9tYWluKHN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShvYmotPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsK
IAorCWFzc2VydF9vYmplY3RfaGVsZChvYmopOworCiAJaWYgKCEob2JqLT53cml0ZV9kb21haW4g
JiBmbHVzaF9kb21haW5zKSkKIAkJcmV0dXJuOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fb2JqZWN0LmgKaW5kZXggOGNmMDgyYWJiMGFiLi5iMDQ4ODUxN2U5NDUgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaAorKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKQEAgLTk5LDE2ICs5OSwy
OSBAQCBpOTE1X2dlbV9vYmplY3RfcHV0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmop
CiAJX19kcm1fZ2VtX29iamVjdF9wdXQoJm9iai0+YmFzZSk7CiB9CiAKKyNkZWZpbmUgYXNzZXJ0
X29iamVjdF9oZWxkKG9iaikgcmVzZXJ2YXRpb25fb2JqZWN0X2Fzc2VydF9oZWxkKChvYmopLT5y
ZXN2KQorCiBzdGF0aWMgaW5saW5lIHZvaWQgaTkxNV9nZW1fb2JqZWN0X2xvY2soc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHsKIAlyZXNlcnZhdGlvbl9vYmplY3RfbG9jayhvYmot
PnJlc3YsIE5VTEwpOwogfQogCitzdGF0aWMgaW5saW5lIGludAoraTkxNV9nZW1fb2JqZWN0X2xv
Y2tfaW50ZXJydXB0aWJsZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQoreworCXJl
dHVybiByZXNlcnZhdGlvbl9vYmplY3RfbG9ja19pbnRlcnJ1cHRpYmxlKG9iai0+cmVzdiwgTlVM
TCk7Cit9CisKIHN0YXRpYyBpbmxpbmUgdm9pZCBpOTE1X2dlbV9vYmplY3RfdW5sb2NrKHN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiB7CiAJcmVzZXJ2YXRpb25fb2JqZWN0X3VubG9j
ayhvYmotPnJlc3YpOwogfQogCitzdHJ1Y3QgZG1hX2ZlbmNlICoKK2k5MTVfZ2VtX29iamVjdF9s
b2NrX2ZlbmNlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopOwordm9pZCBpOTE1X2dl
bV9vYmplY3RfdW5sb2NrX2ZlbmNlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCisJ
CQkJICBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSk7CisKIHN0YXRpYyBpbmxpbmUgdm9pZAogaTkx
NV9nZW1fb2JqZWN0X3NldF9yZWFkb25seShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
KQogewpAQCAtMzcyLDYgKzM4NSw3IEBAIHN0YXRpYyBpbmxpbmUgdm9pZAogaTkxNV9nZW1fb2Jq
ZWN0X2ZpbmlzaF9hY2Nlc3Moc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHsKIAlp
OTE1X2dlbV9vYmplY3RfdW5waW5fcGFnZXMob2JqKTsKKwlpOTE1X2dlbV9vYmplY3RfdW5sb2Nr
KG9iaik7CiB9CiAKIHN0YXRpYyBpbmxpbmUgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCmluZGV4IGFkNjYyZTU1OGRmYi4uMTE4OTBl
OTZlZDY1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0u
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYwpAQCAtMTg3LDEy
ICsxODcsMTMgQEAgdm9pZCBpOTE1X2dlbV9zdXNwZW5kX2xhdGUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCiAJICogbWFjaGluZSBpbiBhbiB1bnVzYWJsZSBjb25kaXRpb24uCiAJICov
CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlmb3IgKHBoYXNlID0g
cGhhc2VzOyAqcGhhc2U7IHBoYXNlKyspIHsKLQkJbGlzdF9mb3JfZWFjaF9lbnRyeShvYmosICpw
aGFzZSwgbW0ubGluaykKKwkJbGlzdF9mb3JfZWFjaF9lbnRyeShvYmosICpwaGFzZSwgbW0ubGlu
aykgeworCQkJaTkxNV9nZW1fb2JqZWN0X2xvY2sob2JqKTsKIAkJCVdBUk5fT04oaTkxNV9nZW1f
b2JqZWN0X3NldF90b19ndHRfZG9tYWluKG9iaiwgZmFsc2UpKTsKKwkJCWk5MTVfZ2VtX29iamVj
dF91bmxvY2sob2JqKTsKKwkJfQogCX0KLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCiAJaW50ZWxfdWNfc2FuaXRpemUoaTkxNSk7CiAJaTkxNV9nZW1fc2FuaXRpemUo
aTkxNSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2h1
Z2VfcGFnZXMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdl
cy5jCmluZGV4IDdiNDM3ZjA2YTliZS4uNDY1ZTBlMWQ0YWEzIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYwpAQCAtOTYwLDEwICs5NjAsNiBA
QCBzdGF0aWMgaW50IGdwdV93cml0ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAogCUdFTV9CVUdf
T04oIWludGVsX2VuZ2luZV9jYW5fc3RvcmVfZHdvcmQoZW5naW5lKSk7CiAKLQllcnIgPSBpOTE1
X2dlbV9vYmplY3Rfc2V0X3RvX2d0dF9kb21haW4odm1hLT5vYmosIHRydWUpOwotCWlmIChlcnIp
Ci0JCXJldHVybiBlcnI7Ci0KIAliYXRjaCA9IGdwdV93cml0ZV9kdyh2bWEsIGR3b3JkICogc2l6
ZW9mKHUzMiksIHZhbHVlKTsKIAlpZiAoSVNfRVJSKGJhdGNoKSkKIAkJcmV0dXJuIFBUUl9FUlIo
YmF0Y2gpOwpAQCAtOTc0LDEzICs5NzAsMTkgQEAgc3RhdGljIGludCBncHVfd3JpdGUoc3RydWN0
IGk5MTVfdm1hICp2bWEsCiAJCWdvdG8gZXJyX2JhdGNoOwogCX0KIAorCWk5MTVfdm1hX2xvY2so
YmF0Y2gpOwogCWVyciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKGJhdGNoLCBycSwgMCk7CisJ
aTkxNV92bWFfdW5sb2NrKGJhdGNoKTsKIAlpZiAoZXJyKQogCQlnb3RvIGVycl9yZXF1ZXN0Owog
CiAJaTkxNV9nZW1fb2JqZWN0X3NldF9hY3RpdmVfcmVmZXJlbmNlKGJhdGNoLT5vYmopOwogCi0J
ZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3RpdmUodm1hLCBycSwgRVhFQ19PQkpFQ1RfV1JJVEUp
OworCWk5MTVfdm1hX2xvY2sodm1hKTsKKwllcnIgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2d0
dF9kb21haW4odm1hLT5vYmosIGZhbHNlKTsKKwlpZiAoZXJyID09IDApCisJCWVyciA9IGk5MTVf
dm1hX21vdmVfdG9fYWN0aXZlKHZtYSwgcnEsIEVYRUNfT0JKRUNUX1dSSVRFKTsKKwlpOTE1X3Zt
YV91bmxvY2sodm1hKTsKIAlpZiAoZXJyKQogCQlnb3RvIGVycl9yZXF1ZXN0OwogCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvaGVyZW5j
eS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb2hlcmVu
Y3kuYwppbmRleCA1NDk1ODc1YjQ4YjMuLmI1YzVkZDAzNGQ1YyAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb2hlcmVuY3kuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvaGVyZW5jeS5jCkBA
IC03OCw3ICs3OCw5IEBAIHN0YXRpYyBpbnQgZ3R0X3NldChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqLAogCXUzMiBfX2lvbWVtICptYXA7CiAJaW50IGVycjsKIAorCWk5MTVfZ2VtX29i
amVjdF9sb2NrKG9iaik7CiAJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3NldF90b19ndHRfZG9tYWlu
KG9iaiwgdHJ1ZSk7CisJaTkxNV9nZW1fb2JqZWN0X3VubG9jayhvYmopOwogCWlmIChlcnIpCiAJ
CXJldHVybiBlcnI7CiAKQEAgLTEwNSw3ICsxMDcsOSBAQCBzdGF0aWMgaW50IGd0dF9nZXQoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAl1MzIgX19pb21lbSAqbWFwOwogCWludCBl
cnI7CiAKKwlpOTE1X2dlbV9vYmplY3RfbG9jayhvYmopOwogCWVyciA9IGk5MTVfZ2VtX29iamVj
dF9zZXRfdG9fZ3R0X2RvbWFpbihvYmosIGZhbHNlKTsKKwlpOTE1X2dlbV9vYmplY3RfdW5sb2Nr
KG9iaik7CiAJaWYgKGVycikKIAkJcmV0dXJuIGVycjsKIApAQCAtMTMxLDcgKzEzNSw5IEBAIHN0
YXRpYyBpbnQgd2Nfc2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJdTMyICpt
YXA7CiAJaW50IGVycjsKIAorCWk5MTVfZ2VtX29iamVjdF9sb2NrKG9iaik7CiAJZXJyID0gaTkx
NV9nZW1fb2JqZWN0X3NldF90b193Y19kb21haW4ob2JqLCB0cnVlKTsKKwlpOTE1X2dlbV9vYmpl
Y3RfdW5sb2NrKG9iaik7CiAJaWYgKGVycikKIAkJcmV0dXJuIGVycjsKIApAQCAtMTUyLDcgKzE1
OCw5IEBAIHN0YXRpYyBpbnQgd2NfZ2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmos
CiAJdTMyICptYXA7CiAJaW50IGVycjsKIAorCWk5MTVfZ2VtX29iamVjdF9sb2NrKG9iaik7CiAJ
ZXJyID0gaTkxNV9nZW1fb2JqZWN0X3NldF90b193Y19kb21haW4ob2JqLCBmYWxzZSk7CisJaTkx
NV9nZW1fb2JqZWN0X3VubG9jayhvYmopOwogCWlmIChlcnIpCiAJCXJldHVybiBlcnI7CiAKQEAg
LTE3Niw3ICsxODQsOSBAQCBzdGF0aWMgaW50IGdwdV9zZXQoc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaiwKIAl1MzIgKmNzOwogCWludCBlcnI7CiAKKwlpOTE1X2dlbV9vYmplY3RfbG9j
ayhvYmopOwogCWVyciA9IGk5MTVfZ2VtX29iamVjdF9zZXRfdG9fZ3R0X2RvbWFpbihvYmosIHRy
dWUpOworCWk5MTVfZ2VtX29iamVjdF91bmxvY2sob2JqKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4g
ZXJyOwogCkBAIC0yMTUsNyArMjI1LDkgQEAgc3RhdGljIGludCBncHVfc2V0KHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJfQogCWludGVsX3JpbmdfYWR2YW5jZShycSwgY3MpOwog
CisJaTkxNV92bWFfbG9jayh2bWEpOwogCWVyciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHZt
YSwgcnEsIEVYRUNfT0JKRUNUX1dSSVRFKTsKKwlpOTE1X3ZtYV91bmxvY2sodm1hKTsKIAlpOTE1
X3ZtYV91bnBpbih2bWEpOwogCiAJaTkxNV9yZXF1ZXN0X2FkZChycSk7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCmluZGV4
IDY1M2FlMDhhMjc3Zi4uNzJlZWRkNmMyYTBhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYwpAQCAtMjA5LDcgKzIwOSw5
IEBAIGdwdV9maWxsX2R3KHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1NjQgb2Zmc2V0LCB1bnNpZ25l
ZCBsb25nIGNvdW50LCB1MzIgdmFsdWUpCiAJaTkxNV9nZW1fb2JqZWN0X2ZsdXNoX21hcChvYmop
OwogCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAob2JqKTsKIAorCWk5MTVfZ2VtX29iamVjdF9s
b2NrKG9iaik7CiAJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3NldF90b19ndHRfZG9tYWluKG9iaiwg
ZmFsc2UpOworCWk5MTVfZ2VtX29iamVjdF91bmxvY2sob2JqKTsKIAlpZiAoZXJyKQogCQlnb3Rv
IGVycjsKIApAQCAtMjYxLDcgKzI2Myw5IEBAIHN0YXRpYyBpbnQgZ3B1X2ZpbGwoc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlpZiAoSVNfRVJSKHZtYSkpCiAJCXJldHVybiBQVFJf
RVJSKHZtYSk7CiAKKwlpOTE1X2dlbV9vYmplY3RfbG9jayhvYmopOwogCWVyciA9IGk5MTVfZ2Vt
X29iamVjdF9zZXRfdG9fZ3R0X2RvbWFpbihvYmosIGZhbHNlKTsKKwlpOTE1X2dlbV9vYmplY3Rf
dW5sb2NrKG9iaik7CiAJaWYgKGVycikKIAkJcmV0dXJuIGVycjsKIApAQCAtMzAyLDExICszMDYs
MTUgQEAgc3RhdGljIGludCBncHVfZmlsbChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
LAogCWlmIChlcnIpCiAJCWdvdG8gZXJyX3JlcXVlc3Q7CiAKKwlpOTE1X3ZtYV9sb2NrKGJhdGNo
KTsKIAllcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShiYXRjaCwgcnEsIDApOworCWk5MTVf
dm1hX3VubG9jayhiYXRjaCk7CiAJaWYgKGVycikKIAkJZ290byBza2lwX3JlcXVlc3Q7CiAKKwlp
OTE1X3ZtYV9sb2NrKHZtYSk7CiAJZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3RpdmUodm1hLCBy
cSwgRVhFQ19PQkpFQ1RfV1JJVEUpOworCWk5MTVfdm1hX3VubG9jayh2bWEpOwogCWlmIChlcnIp
CiAJCWdvdG8gc2tpcF9yZXF1ZXN0OwogCkBAIC03NTQsNyArNzYyLDkgQEAgZW1pdF9ycGNzX3F1
ZXJ5KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJaWYgKElTX0VSUih2bWEpKQog
CQlyZXR1cm4gUFRSX0VSUih2bWEpOwogCisJaTkxNV9nZW1fb2JqZWN0X2xvY2sob2JqKTsKIAll
cnIgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2d0dF9kb21haW4ob2JqLCBmYWxzZSk7CisJaTkx
NV9nZW1fb2JqZWN0X3VubG9jayhvYmopOwogCWlmIChlcnIpCiAJCXJldHVybiBlcnI7CiAKQEAg
LTc4MCwxMSArNzkwLDE1IEBAIGVtaXRfcnBjc19xdWVyeShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqLAogCWlmIChlcnIpCiAJCWdvdG8gZXJyX3JlcXVlc3Q7CiAKKwlpOTE1X3ZtYV9s
b2NrKGJhdGNoKTsKIAllcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShiYXRjaCwgcnEsIDAp
OworCWk5MTVfdm1hX3VubG9jayhiYXRjaCk7CiAJaWYgKGVycikKIAkJZ290byBza2lwX3JlcXVl
c3Q7CiAKKwlpOTE1X3ZtYV9sb2NrKHZtYSk7CiAJZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3Rp
dmUodm1hLCBycSwgRVhFQ19PQkpFQ1RfV1JJVEUpOworCWk5MTVfdm1hX3VubG9jayh2bWEpOwog
CWlmIChlcnIpCiAJCWdvdG8gc2tpcF9yZXF1ZXN0OwogCkBAIC0xMzQ1LDcgKzEzNTksOSBAQCBz
dGF0aWMgaW50IHdyaXRlX3RvX3NjcmF0Y2goc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwK
IAlpZiAoZXJyKQogCQlnb3RvIGVycl9yZXF1ZXN0OwogCisJaTkxNV92bWFfbG9jayh2bWEpOwog
CWVyciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHZtYSwgcnEsIDApOworCWk5MTVfdm1hX3Vu
bG9jayh2bWEpOwogCWlmIChlcnIpCiAJCWdvdG8gc2tpcF9yZXF1ZXN0OwogCkBAIC0xNDQwLDcg
KzE0NTYsOSBAQCBzdGF0aWMgaW50IHJlYWRfZnJvbV9zY3JhdGNoKHN0cnVjdCBpOTE1X2dlbV9j
b250ZXh0ICpjdHgsCiAJaWYgKGVycikKIAkJZ290byBlcnJfcmVxdWVzdDsKIAorCWk5MTVfdm1h
X2xvY2sodm1hKTsKIAllcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZSh2bWEsIHJxLCBFWEVD
X09CSkVDVF9XUklURSk7CisJaTkxNV92bWFfdW5sb2NrKHZtYSk7CiAJaWYgKGVycikKIAkJZ290
byBza2lwX3JlcXVlc3Q7CiAKQEAgLTE0NDksNyArMTQ2Nyw5IEBAIHN0YXRpYyBpbnQgcmVhZF9m
cm9tX3NjcmF0Y2goc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAogCWk5MTVfcmVxdWVz
dF9hZGQocnEpOwogCisJaTkxNV9nZW1fb2JqZWN0X2xvY2sob2JqKTsKIAllcnIgPSBpOTE1X2dl
bV9vYmplY3Rfc2V0X3RvX2NwdV9kb21haW4ob2JqLCBmYWxzZSk7CisJaTkxNV9nZW1fb2JqZWN0
X3VubG9jayhvYmopOwogCWlmIChlcnIpCiAJCWdvdG8gZXJyOwogCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jCmluZGV4IDEyYzkwZDhm
ZTBmYi4uMjk3Zjg4NjRkMzkyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
c2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
c2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYwpAQCAtMTEwLDcgKzExMCw5IEBAIHN0YXRpYyBpbnQg
Y2hlY2tfcGFydGlhbF9tYXBwaW5nKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJ
CUdFTV9CVUdfT04odmlldy5wYXJ0aWFsLnNpemUgPiBucmVhbCk7CiAJCWNvbmRfcmVzY2hlZCgp
OwogCisJCWk5MTVfZ2VtX29iamVjdF9sb2NrKG9iaik7CiAJCWVyciA9IGk5MTVfZ2VtX29iamVj
dF9zZXRfdG9fZ3R0X2RvbWFpbihvYmosIHRydWUpOworCQlpOTE1X2dlbV9vYmplY3RfdW5sb2Nr
KG9iaik7CiAJCWlmIChlcnIpIHsKIAkJCXByX2VycigiRmFpbGVkIHRvIGZsdXNoIHRvIEdUVCB3
cml0ZSBkb21haW47IGVycj0lZFxuIiwKIAkJCSAgICAgICBlcnIpOwpAQCAtMTQyLDcgKzE0NCw5
IEBAIHN0YXRpYyBpbnQgY2hlY2tfcGFydGlhbF9tYXBwaW5nKHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmosCiAJCWlmIChvZmZzZXQgPj0gb2JqLT5iYXNlLnNpemUpCiAJCQljb250aW51
ZTsKIAorCQlpOTE1X2dlbV9vYmplY3RfbG9jayhvYmopOwogCQlpOTE1X2dlbV9vYmplY3RfZmx1
c2hfd3JpdGVfZG9tYWluKG9iaiwgfkk5MTVfR0VNX0RPTUFJTl9DUFUpOworCQlpOTE1X2dlbV9v
YmplY3RfdW5sb2NrKG9iaik7CiAKIAkJcCA9IGk5MTVfZ2VtX29iamVjdF9nZXRfcGFnZShvYmos
IG9mZnNldCA+PiBQQUdFX1NISUZUKTsKIAkJY3B1ID0ga21hcChwKSArIG9mZnNldF9pbl9wYWdl
KG9mZnNldCk7CkBAIC0zNDQsNyArMzQ4LDkgQEAgc3RhdGljIGludCBtYWtlX29ial9idXN5KHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiAJCXJldHVybiBQVFJfRVJSKHJxKTsKIAl9
CiAKKwlpOTE1X3ZtYV9sb2NrKHZtYSk7CiAJZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3RpdmUo
dm1hLCBycSwgRVhFQ19PQkpFQ1RfV1JJVEUpOworCWk5MTVfdm1hX3VubG9jayh2bWEpOwogCiAJ
aTkxNV9yZXF1ZXN0X2FkZChycSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fcGh5cy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L3NlbGZ0ZXN0cy9pOTE1X2dlbV9waHlzLmMKaW5kZXggZWQ2NDAxMmU1ZDI0Li45NGExNWUzZjZk
YjggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9n
ZW1fcGh5cy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9n
ZW1fcGh5cy5jCkBAIC00Niw5ICs0Niw5IEBAIHN0YXRpYyBpbnQgbW9ja19waHlzX29iamVjdCh2
b2lkICphcmcpCiAJfQogCiAJLyogTWFrZSB0aGUgb2JqZWN0IGRpcnR5IHNvIHRoYXQgcHV0X3Bh
Z2VzIG11c3QgZG8gY29weSBiYWNrIHRoZSBkYXRhICovCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CisJaTkxNV9nZW1fb2JqZWN0X2xvY2sob2JqKTsKIAllcnIgPSBpOTE1
X2dlbV9vYmplY3Rfc2V0X3RvX2d0dF9kb21haW4ob2JqLCB0cnVlKTsKLQltdXRleF91bmxvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWk5MTVfZ2VtX29iamVjdF91bmxvY2sob2JqKTsK
IAlpZiAoZXJyKSB7CiAJCXByX2VycigiaTkxNV9nZW1fb2JqZWN0X3NldF90b19ndHRfZG9tYWlu
IGZhaWxlZCB3aXRoIGVycj0lZFxuIiwKIAkJICAgICAgIGVycik7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jCmluZGV4IDY5MGQ3N2Y1ZWNmNi4uYzNmYTEw
ZmQ5MzgzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5n
Y2hlY2suYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2su
YwpAQCAtMTE3LDcgKzExNyw5IEBAIHN0YXRpYyBpbnQgbW92ZV90b19hY3RpdmUoc3RydWN0IGk5
MTVfdm1hICp2bWEsCiB7CiAJaW50IGVycjsKIAorCWk5MTVfdm1hX2xvY2sodm1hKTsKIAllcnIg
PSBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZSh2bWEsIHJxLCBmbGFncyk7CisJaTkxNV92bWFfdW5s
b2NrKHZtYSk7CiAJaWYgKGVycikKIAkJcmV0dXJuIGVycjsKIApAQCAtMTI1Miw3ICsxMjU0LDkg
QEAgc3RhdGljIGludCBfX2lndF9yZXNldF9ldmljdF92bWEoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCiAJCX0KIAl9CiAKKwlpOTE1X3ZtYV9sb2NrKGFyZy52bWEpOwogCWVyciA9IGk5
MTVfdm1hX21vdmVfdG9fYWN0aXZlKGFyZy52bWEsIHJxLCBmbGFncyk7CisJaTkxNV92bWFfdW5s
b2NrKGFyZy52bWEpOwogCiAJaWYgKGZsYWdzICYgRVhFQ19PQkpFQ1RfTkVFRFNfRkVOQ0UpCiAJ
CWk5MTVfdm1hX3VucGluX2ZlbmNlKGFyZy52bWEpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF9scmMuYwppbmRleCBkZmFjYzQ2YWU3ZDMuLmQxNjJiMGQzZWM4ZSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKQEAgLTExMDgsMTEgKzExMDgsMTMgQEAgc3RhdGlj
IGludCBzbW9rZV9zdWJtaXQoc3RydWN0IHByZWVtcHRfc21va2UgKnNtb2tlLAogCX0KIAogCWlm
ICh2bWEpIHsKKwkJaTkxNV92bWFfbG9jayh2bWEpOwogCQllcnIgPSBycS0+ZW5naW5lLT5lbWl0
X2JiX3N0YXJ0KHJxLAogCQkJCQkJdm1hLT5ub2RlLnN0YXJ0LAogCQkJCQkJUEFHRV9TSVpFLCAw
KTsKIAkJaWYgKCFlcnIpCiAJCQllcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZSh2bWEsIHJx
LCAwKTsKKwkJaTkxNV92bWFfdW5sb2NrKHZtYSk7CiAJfQogCiAJaTkxNV9yZXF1ZXN0X2FkZChy
cSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJv
dW5kcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29ya2Fyb3VuZHMuYwpp
bmRleCA5MDQwY2FlMzhmYzUuLjM4YTY5YWNmNjBhZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29ya2Fyb3VuZHMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jCkBAIC0xMTgsNyArMTE4LDkgQEAgcmVhZF9u
b25wcml2cyhzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LCBzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmUpCiAJCWdvdG8gZXJyX3BpbjsKIAl9CiAKKwlpOTE1X3ZtYV9sb2NrKHZtYSk7
CiAJZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3RpdmUodm1hLCBycSwgRVhFQ19PQkpFQ1RfV1JJ
VEUpOworCWk5MTVfdm1hX3VubG9jayh2bWEpOwogCWlmIChlcnIpCiAJCWdvdG8gZXJyX3JlcTsK
IApAQCAtMTk1LDggKzE5NywxMCBAQCBzdGF0aWMgaW50IGNoZWNrX3doaXRlbGlzdChzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqY3R4LAogCQlyZXR1cm4gUFRSX0VSUihyZXN1bHRzKTsKIAogCWVy
ciA9IDA7CisJaTkxNV9nZW1fb2JqZWN0X2xvY2socmVzdWx0cyk7CiAJaWd0X3dlZGdlX29uX3Rp
bWVvdXQoJndlZGdlLCBjdHgtPmk5MTUsIEhaIC8gNSkgLyogYSBzYWZldHkgbmV0ISAqLwogCQll
cnIgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2NwdV9kb21haW4ocmVzdWx0cywgZmFsc2UpOwor
CWk5MTVfZ2VtX29iamVjdF91bmxvY2socmVzdWx0cyk7CiAJaWYgKGk5MTVfdGVybWluYWxseV93
ZWRnZWQoY3R4LT5pOTE1KSkKIAkJZXJyID0gLUVJTzsKIAlpZiAoZXJyKQpAQCAtMzY3LDcgKzM3
MSw5IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKmNyZWF0ZV9iYXRjaChzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqY3R4KQogCWlmIChlcnIpCiAJCWdvdG8gZXJyX29iajsKIAorCWk5MTVfZ2Vt
X29iamVjdF9sb2NrKG9iaik7CiAJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3NldF90b193Y19kb21h
aW4ob2JqLCB0cnVlKTsKKwlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKG9iaik7CiAJaWYgKGVycikK
IAkJZ290byBlcnJfb2JqOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQv
Y21kX3BhcnNlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2NtZF9wYXJzZXIuYwppbmRl
eCBlMzYwOGIxNzAxMDUuLjc1Y2I5OGRhNmNjOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Z0L2NtZF9wYXJzZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvY21k
X3BhcnNlci5jCkBAIC0yODQ0LDcgKzI4NDQsOSBAQCBzdGF0aWMgaW50IHNoYWRvd19pbmRpcmVj
dF9jdHgoc3RydWN0IGludGVsX3NoYWRvd193YV9jdHggKndhX2N0eCkKIAkJZ290byBwdXRfb2Jq
OwogCX0KIAorCWk5MTVfZ2VtX29iamVjdF9sb2NrKG9iaik7CiAJcmV0ID0gaTkxNV9nZW1fb2Jq
ZWN0X3NldF90b19jcHVfZG9tYWluKG9iaiwgZmFsc2UpOworCWk5MTVfZ2VtX29iamVjdF91bmxv
Y2sob2JqKTsKIAlpZiAocmV0KSB7CiAJCWd2dF92Z3B1X2VycigiZmFpbGVkIHRvIHNldCBzaGFk
b3cgaW5kaXJlY3QgY3R4IHRvIENQVVxuIik7CiAJCWdvdG8gdW5tYXBfc3JjOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Z0L3NjaGVkdWxlci5jCmluZGV4IGQ2NmJmNzdmNTVmZC4uOGEwMGUyZDBjODFjIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVyLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jCkBAIC01MDksMTggKzUwOSwxOCBAQCBz
dGF0aWMgaW50IHByZXBhcmVfc2hhZG93X2JhdGNoX2J1ZmZlcihzdHJ1Y3QgaW50ZWxfdmdwdV93
b3JrbG9hZCAqd29ya2xvYWQpCiAJCQl9CiAKIAkJCXJldCA9IGk5MTVfZ2VtX29iamVjdF9zZXRf
dG9fZ3R0X2RvbWFpbihiYi0+b2JqLAotCQkJCQlmYWxzZSk7CisJCQkJCQkJCWZhbHNlKTsKIAkJ
CWlmIChyZXQpCiAJCQkJZ290byBlcnI7CiAKLQkJCWk5MTVfZ2VtX29iamVjdF9maW5pc2hfYWNj
ZXNzKGJiLT5vYmopOwotCQkJYmItPmFjY2Vzc2luZyA9IGZhbHNlOwotCiAJCQlyZXQgPSBpOTE1
X3ZtYV9tb3ZlX3RvX2FjdGl2ZShiYi0+dm1hLAogCQkJCQkJICAgICAgd29ya2xvYWQtPnJlcSwK
IAkJCQkJCSAgICAgIDApOwogCQkJaWYgKHJldCkKIAkJCQlnb3RvIGVycjsKKworCQkJaTkxNV9n
ZW1fb2JqZWN0X2ZpbmlzaF9hY2Nlc3MoYmItPm9iaik7CisJCQliYi0+YWNjZXNzaW5nID0gZmFs
c2U7CiAJCX0KIAl9CiAJcmV0dXJuIDA7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2NtZF9wYXJzZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfY21kX3BhcnNl
ci5jCmluZGV4IGM4OTNiZDRlYjJjOC4uYTI4YmNkMmQ3YzA5IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2NtZF9wYXJzZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2NtZF9wYXJzZXIuYwpAQCAtMTA1OCwxOSArMTA1OCwyMCBAQCBzdGF0aWMgdTMyICpj
b3B5X2JhdGNoKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpkc3Rfb2JqLAogCXZvaWQgKmRz
dCwgKnNyYzsKIAlpbnQgcmV0OwogCi0JcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3ByZXBhcmVfcmVh
ZChzcmNfb2JqLCAmc3JjX25lZWRzX2NsZmx1c2gpOworCXJldCA9IGk5MTVfZ2VtX29iamVjdF9w
cmVwYXJlX3dyaXRlKGRzdF9vYmosICZkc3RfbmVlZHNfY2xmbHVzaCk7CiAJaWYgKHJldCkKIAkJ
cmV0dXJuIEVSUl9QVFIocmV0KTsKIAotCXJldCA9IGk5MTVfZ2VtX29iamVjdF9wcmVwYXJlX3dy
aXRlKGRzdF9vYmosICZkc3RfbmVlZHNfY2xmbHVzaCk7Ci0JaWYgKHJldCkgewotCQlkc3QgPSBF
UlJfUFRSKHJldCk7Ci0JCWdvdG8gdW5waW5fc3JjOwotCX0KLQogCWRzdCA9IGk5MTVfZ2VtX29i
amVjdF9waW5fbWFwKGRzdF9vYmosIEk5MTVfTUFQX0ZPUkNFX1dCKTsKKwlpOTE1X2dlbV9vYmpl
Y3RfZmluaXNoX2FjY2Vzcyhkc3Rfb2JqKTsKIAlpZiAoSVNfRVJSKGRzdCkpCi0JCWdvdG8gdW5w
aW5fZHN0OworCQlyZXR1cm4gZHN0OworCisJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3ByZXBhcmVf
cmVhZChzcmNfb2JqLCAmc3JjX25lZWRzX2NsZmx1c2gpOworCWlmIChyZXQpIHsKKwkJaTkxNV9n
ZW1fb2JqZWN0X3VucGluX21hcChkc3Rfb2JqKTsKKwkJcmV0dXJuIEVSUl9QVFIocmV0KTsKKwl9
CiAKIAlzcmMgPSBFUlJfUFRSKC1FTk9ERVYpOwogCWlmIChzcmNfbmVlZHNfY2xmbHVzaCAmJgpA
QCAtMTExNiwxMyArMTExNywxMSBAQCBzdGF0aWMgdTMyICpjb3B5X2JhdGNoKHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpkc3Rfb2JqLAogCQl9CiAJfQogCisJaTkxNV9nZW1fb2JqZWN0X2Zp
bmlzaF9hY2Nlc3Moc3JjX29iaik7CisKIAkvKiBkc3Rfb2JqIGlzIHJldHVybmVkIHdpdGggdm1h
cCBwaW5uZWQgKi8KIAkqbmVlZHNfY2xmbHVzaF9hZnRlciA9IGRzdF9uZWVkc19jbGZsdXNoICYg
Q0xGTFVTSF9BRlRFUjsKIAotdW5waW5fZHN0OgotCWk5MTVfZ2VtX29iamVjdF9maW5pc2hfYWNj
ZXNzKGRzdF9vYmopOwotdW5waW5fc3JjOgotCWk5MTVfZ2VtX29iamVjdF9maW5pc2hfYWNjZXNz
KHNyY19vYmopOwogCXJldHVybiBkc3Q7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4
IGNmZTBkOWZmNGU1ZC4uOTkzNDg5ZDBmYjJlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAg
LTEwNCwxOSArMTA0LDEwIEBAIGludCBpOTE1X2dlbV9vYmplY3RfdW5iaW5kKHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmopCiB7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJTElTVF9I
RUFEKHN0aWxsX2luX2xpc3QpOwotCWludCByZXQ7CisJaW50IHJldCA9IDA7CiAKIAlsb2NrZGVw
X2Fzc2VydF9oZWxkKCZvYmotPmJhc2UuZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogCi0JLyogQ2xvc2Vk
IHZtYSBhcmUgcmVtb3ZlZCBmcm9tIHRoZSBvYmotPnZtYV9saXN0IC0gYnV0IHRoZXkgbWF5Ci0J
ICogc3RpbGwgaGF2ZSBhbiBhY3RpdmUgYmluZGluZyBvbiB0aGUgb2JqZWN0LiBUbyByZW1vdmUg
dGhvc2Ugd2UKLQkgKiBtdXN0IHdhaXQgZm9yIGFsbCByZW5kZXJpbmcgdG8gY29tcGxldGUgdG8g
dGhlIG9iamVjdCAoYXMgdW5iaW5kaW5nCi0JICogbXVzdCBhbnl3YXkpLCBhbmQgcmV0aXJlIHRo
ZSByZXF1ZXN0cy4KLQkgKi8KLQlyZXQgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2NwdV9kb21h
aW4ob2JqLCBmYWxzZSk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQogCXNwaW5fbG9jaygm
b2JqLT52bWEubG9jayk7CiAJd2hpbGUgKCFyZXQgJiYgKHZtYSA9IGxpc3RfZmlyc3RfZW50cnlf
b3JfbnVsbCgmb2JqLT52bWEubGlzdCwKIAkJCQkJCSAgICAgICBzdHJ1Y3QgaTkxNV92bWEsCkBA
IC0xMzksMjkgKzEzMCwxNyBAQCBpOTE1X2dlbV9vYmplY3Rfd2FpdF9mZW5jZShzdHJ1Y3QgZG1h
X2ZlbmNlICpmZW5jZSwKIAkJCSAgIHVuc2lnbmVkIGludCBmbGFncywKIAkJCSAgIGxvbmcgdGlt
ZW91dCkKIHsKLQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKLQogCUJVSUxEX0JVR19PTihJOTE1
X1dBSVRfSU5URVJSVVBUSUJMRSAhPSAweDEpOwogCiAJaWYgKHRlc3RfYml0KERNQV9GRU5DRV9G
TEFHX1NJR05BTEVEX0JJVCwgJmZlbmNlLT5mbGFncykpCiAJCXJldHVybiB0aW1lb3V0OwogCi0J
aWYgKCFkbWFfZmVuY2VfaXNfaTkxNShmZW5jZSkpCi0JCXJldHVybiBkbWFfZmVuY2Vfd2FpdF90
aW1lb3V0KGZlbmNlLAotCQkJCQkgICAgICBmbGFncyAmIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxF
LAotCQkJCQkgICAgICB0aW1lb3V0KTsKKwlpZiAoZG1hX2ZlbmNlX2lzX2k5MTUoZmVuY2UpKQor
CQlyZXR1cm4gaTkxNV9yZXF1ZXN0X3dhaXQodG9fcmVxdWVzdChmZW5jZSksIGZsYWdzLCB0aW1l
b3V0KTsKIAotCXJxID0gdG9fcmVxdWVzdChmZW5jZSk7Ci0JaWYgKGk5MTVfcmVxdWVzdF9jb21w
bGV0ZWQocnEpKQotCQlnb3RvIG91dDsKLQotCXRpbWVvdXQgPSBpOTE1X3JlcXVlc3Rfd2FpdChy
cSwgZmxhZ3MsIHRpbWVvdXQpOwotCi1vdXQ6Ci0JaWYgKGZsYWdzICYgSTkxNV9XQUlUX0xPQ0tF
RCAmJiBpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJxKSkKLQkJaTkxNV9yZXF1ZXN0X3JldGlyZV91
cHRvKHJxKTsKLQotCXJldHVybiB0aW1lb3V0OworCXJldHVybiBkbWFfZmVuY2Vfd2FpdF90aW1l
b3V0KGZlbmNlLAorCQkJCSAgICAgIGZsYWdzICYgSTkxNV9XQUlUX0lOVEVSUlVQVElCTEUsCisJ
CQkJICAgICAgdGltZW91dCk7CiB9CiAKIHN0YXRpYyBsb25nCkBAIC00ODcsMjEgKzQ2NiwyMiBA
QCBzdGF0aWMgaW50CiBpOTE1X2dlbV9zaG1lbV9wcmVhZChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqLAogCQkgICAgIHN0cnVjdCBkcm1faTkxNV9nZW1fcHJlYWQgKmFyZ3MpCiB7Ci0J
Y2hhciBfX3VzZXIgKnVzZXJfZGF0YTsKLQl1NjQgcmVtYWluOwogCXVuc2lnbmVkIGludCBuZWVk
c19jbGZsdXNoOwogCXVuc2lnbmVkIGludCBpZHgsIG9mZnNldDsKKwlzdHJ1Y3QgZG1hX2ZlbmNl
ICpmZW5jZTsKKwljaGFyIF9fdXNlciAqdXNlcl9kYXRhOworCXU2NCByZW1haW47CiAJaW50IHJl
dDsKIAotCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmb2JqLT5iYXNlLmRldi0+c3Ry
dWN0X211dGV4KTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCiAJcmV0ID0gaTkxNV9nZW1f
b2JqZWN0X3ByZXBhcmVfcmVhZChvYmosICZuZWVkc19jbGZsdXNoKTsKLQltdXRleF91bmxvY2so
Jm9iai0+YmFzZS5kZXYtPnN0cnVjdF9tdXRleCk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsK
IAorCWZlbmNlID0gaTkxNV9nZW1fb2JqZWN0X2xvY2tfZmVuY2Uob2JqKTsKKwlpOTE1X2dlbV9v
YmplY3RfZmluaXNoX2FjY2VzcyhvYmopOworCWlmICghZmVuY2UpCisJCXJldHVybiAtRU5PTUVN
OworCiAJcmVtYWluID0gYXJncy0+c2l6ZTsKIAl1c2VyX2RhdGEgPSB1NjRfdG9fdXNlcl9wdHIo
YXJncy0+ZGF0YV9wdHIpOwogCW9mZnNldCA9IG9mZnNldF9pbl9wYWdlKGFyZ3MtPm9mZnNldCk7
CkBAIC01MTksNyArNDk5LDcgQEAgaTkxNV9nZW1fc2htZW1fcHJlYWQoc3RydWN0IGRybV9pOTE1
X2dlbV9vYmplY3QgKm9iaiwKIAkJb2Zmc2V0ID0gMDsKIAl9CiAKLQlpOTE1X2dlbV9vYmplY3Rf
ZmluaXNoX2FjY2VzcyhvYmopOworCWk5MTVfZ2VtX29iamVjdF91bmxvY2tfZmVuY2Uob2JqLCBm
ZW5jZSk7CiAJcmV0dXJuIHJldDsKIH0KIApAQCAtNTU1LDggKzUzNSw5IEBAIGk5MTVfZ2VtX2d0
dF9wcmVhZChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCXN0cnVjdCBpOTE1X2dn
dHQgKmdndHQgPSAmaTkxNS0+Z2d0dDsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAlzdHJ1
Y3QgZHJtX21tX25vZGUgbm9kZTsKLQlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKKwlzdHJ1Y3QgZG1h
X2ZlbmNlICpmZW5jZTsKIAl2b2lkIF9fdXNlciAqdXNlcl9kYXRhOworCXN0cnVjdCBpOTE1X3Zt
YSAqdm1hOwogCXU2NCByZW1haW4sIG9mZnNldDsKIAlpbnQgcmV0OwogCkBAIC01ODUsMTEgKzU2
NiwyNCBAQCBpOTE1X2dlbV9ndHRfcHJlYWQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9i
aiwKIAkJR0VNX0JVR19PTighbm9kZS5hbGxvY2F0ZWQpOwogCX0KIAotCXJldCA9IGk5MTVfZ2Vt
X29iamVjdF9zZXRfdG9fZ3R0X2RvbWFpbihvYmosIGZhbHNlKTsKKwltdXRleF91bmxvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCisJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X2xvY2tfaW50
ZXJydXB0aWJsZShvYmopOwogCWlmIChyZXQpCiAJCWdvdG8gb3V0X3VucGluOwogCi0JbXV0ZXhf
dW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlyZXQgPSBpOTE1X2dlbV9vYmplY3Rf
c2V0X3RvX2d0dF9kb21haW4ob2JqLCBmYWxzZSk7CisJaWYgKHJldCkgeworCQlpOTE1X2dlbV9v
YmplY3RfdW5sb2NrKG9iaik7CisJCWdvdG8gb3V0X3VucGluOworCX0KKworCWZlbmNlID0gaTkx
NV9nZW1fb2JqZWN0X2xvY2tfZmVuY2Uob2JqKTsKKwlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKG9i
aik7CisJaWYgKCFmZW5jZSkgeworCQlyZXQgPSAtRU5PTUVNOworCQlnb3RvIG91dF91bnBpbjsK
Kwl9CiAKIAl1c2VyX2RhdGEgPSB1NjRfdG9fdXNlcl9wdHIoYXJncy0+ZGF0YV9wdHIpOwogCXJl
bWFpbiA9IGFyZ3MtPnNpemU7CkBAIC02MjcsOCArNjIxLDkgQEAgaTkxNV9nZW1fZ3R0X3ByZWFk
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCW9mZnNldCArPSBwYWdlX2xlbmd0
aDsKIAl9CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlpOTE1X2dl
bV9vYmplY3RfdW5sb2NrX2ZlbmNlKG9iaiwgZmVuY2UpOwogb3V0X3VucGluOgorCW11dGV4X2xv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChub2RlLmFsbG9jYXRlZCkgewogCQl3
bWIoKTsKIAkJZ2d0dC0+dm0uY2xlYXJfcmFuZ2UoJmdndHQtPnZtLCBub2RlLnN0YXJ0LCBub2Rl
LnNpemUpOwpAQCAtNzM5LDYgKzczNCw3IEBAIGk5MTVfZ2VtX2d0dF9wd3JpdGVfZmFzdChzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSAm
aTkxNS0+Z2d0dDsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAlzdHJ1Y3QgZHJtX21tX25v
ZGUgbm9kZTsKKwlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZt
YTsKIAl1NjQgcmVtYWluLCBvZmZzZXQ7CiAJdm9pZCBfX3VzZXIgKnVzZXJfZGF0YTsKQEAgLTc4
NiwxMSArNzgyLDI0IEBAIGk5MTVfZ2VtX2d0dF9wd3JpdGVfZmFzdChzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqLAogCQlHRU1fQlVHX09OKCFub2RlLmFsbG9jYXRlZCk7CiAJfQogCi0J
cmV0ID0gaTkxNV9nZW1fb2JqZWN0X3NldF90b19ndHRfZG9tYWluKG9iaiwgdHJ1ZSk7CisJbXV0
ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKworCXJldCA9IGk5MTVfZ2VtX29i
amVjdF9sb2NrX2ludGVycnVwdGlibGUob2JqKTsKIAlpZiAocmV0KQogCQlnb3RvIG91dF91bnBp
bjsKIAotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJcmV0ID0gaTkx
NV9nZW1fb2JqZWN0X3NldF90b19ndHRfZG9tYWluKG9iaiwgdHJ1ZSk7CisJaWYgKHJldCkgewor
CQlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKG9iaik7CisJCWdvdG8gb3V0X3VucGluOworCX0KKwor
CWZlbmNlID0gaTkxNV9nZW1fb2JqZWN0X2xvY2tfZmVuY2Uob2JqKTsKKwlpOTE1X2dlbV9vYmpl
Y3RfdW5sb2NrKG9iaik7CisJaWYgKCFmZW5jZSkgeworCQlyZXQgPSAtRU5PTUVNOworCQlnb3Rv
IG91dF91bnBpbjsKKwl9CiAKIAlpbnRlbF9mYl9vYmpfaW52YWxpZGF0ZShvYmosIE9SSUdJTl9D
UFUpOwogCkBAIC04MzUsOCArODQ0LDkgQEAgaTkxNV9nZW1fZ3R0X3B3cml0ZV9mYXN0KHN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJfQogCWludGVsX2ZiX29ial9mbHVzaChvYmos
IE9SSUdJTl9DUFUpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJ
aTkxNV9nZW1fb2JqZWN0X3VubG9ja19mZW5jZShvYmosIGZlbmNlKTsKIG91dF91bnBpbjoKKwlt
dXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpZiAobm9kZS5hbGxvY2F0ZWQp
IHsKIAkJd21iKCk7CiAJCWdndHQtPnZtLmNsZWFyX3JhbmdlKCZnZ3R0LT52bSwgbm9kZS5zdGFy
dCwgbm9kZS5zaXplKTsKQEAgLTg4MiwyMyArODkyLDIzIEBAIHN0YXRpYyBpbnQKIGk5MTVfZ2Vt
X3NobWVtX3B3cml0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkgICAgICBj
b25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX3B3cml0ZSAqYXJncykKIHsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7Ci0Jdm9pZCBfX3VzZXIg
KnVzZXJfZGF0YTsKLQl1NjQgcmVtYWluOwogCXVuc2lnbmVkIGludCBwYXJ0aWFsX2NhY2hlbGlu
ZV93cml0ZTsKIAl1bnNpZ25lZCBpbnQgbmVlZHNfY2xmbHVzaDsKIAl1bnNpZ25lZCBpbnQgb2Zm
c2V0LCBpZHg7CisJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CisJdm9pZCBfX3VzZXIgKnVzZXJf
ZGF0YTsKKwl1NjQgcmVtYWluOwogCWludCByZXQ7CiAKLQlyZXQgPSBtdXRleF9sb2NrX2ludGVy
cnVwdGlibGUoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChyZXQpCi0JCXJldHVybiBy
ZXQ7Ci0KIAlyZXQgPSBpOTE1X2dlbV9vYmplY3RfcHJlcGFyZV93cml0ZShvYmosICZuZWVkc19j
bGZsdXNoKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChy
ZXQpCiAJCXJldHVybiByZXQ7CiAKKwlmZW5jZSA9IGk5MTVfZ2VtX29iamVjdF9sb2NrX2ZlbmNl
KG9iaik7CisJaTkxNV9nZW1fb2JqZWN0X2ZpbmlzaF9hY2Nlc3Mob2JqKTsKKwlpZiAoIWZlbmNl
KQorCQlyZXR1cm4gLUVOT01FTTsKKwogCS8qIElmIHdlIGRvbid0IG92ZXJ3cml0ZSBhIGNhY2hl
bGluZSBjb21wbGV0ZWx5IHdlIG5lZWQgdG8gYmUKIAkgKiBjYXJlZnVsIHRvIGhhdmUgdXAtdG8t
ZGF0ZSBkYXRhIGJ5IGZpcnN0IGNsZmx1c2hpbmcuIERvbid0CiAJICogb3ZlcmNvbXBsaWNhdGUg
dGhpbmdzIGFuZCBmbHVzaCB0aGUgZW50aXJlIHBhdGNoLgpAQCAtOTI2LDcgKzkzNiw4IEBAIGk5
MTVfZ2VtX3NobWVtX3B3cml0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCX0K
IAogCWludGVsX2ZiX29ial9mbHVzaChvYmosIE9SSUdJTl9DUFUpOwotCWk5MTVfZ2VtX29iamVj
dF9maW5pc2hfYWNjZXNzKG9iaik7CisJaTkxNV9nZW1fb2JqZWN0X3VubG9ja19mZW5jZShvYmos
IGZlbmNlKTsKKwogCXJldHVybiByZXQ7CiB9CiAKQEAgLTE4MDUsNyArMTgxNiw5IEBAIHN0YXRp
YyBpbnQgX19pbnRlbF9lbmdpbmVzX3JlY29yZF9kZWZhdWx0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSkKIAkJaWYgKGVycikKIAkJCWdvdG8gZXJyX2FjdGl2ZTsKIAorCQlpOTE1X2dl
bV9vYmplY3RfbG9jayhzdGF0ZS0+b2JqKTsKIAkJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3NldF90
b19jcHVfZG9tYWluKHN0YXRlLT5vYmosIGZhbHNlKTsKKwkJaTkxNV9nZW1fb2JqZWN0X3VubG9j
ayhzdGF0ZS0+b2JqKTsKIAkJaWYgKGVycikKIAkJCWdvdG8gZXJyX2FjdGl2ZTsKIApAQCAtMjI1
NiwxMiArMjI2OSwxMyBAQCBpbnQgaTkxNV9nZW1fZnJlZXplX2xhdGUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiAJaTkxNV9nZW1fc2hyaW5rKGk5MTUsIC0xVUwsIE5VTEwsIEk5MTVf
U0hSSU5LX1VOQk9VTkQpOwogCWk5MTVfZ2VtX2RyYWluX2ZyZWVkX29iamVjdHMoaTkxNSk7CiAK
LQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlmb3IgKHBoYXNlID0gcGhh
c2VzOyAqcGhhc2U7IHBoYXNlKyspIHsKLQkJbGlzdF9mb3JfZWFjaF9lbnRyeShvYmosICpwaGFz
ZSwgbW0ubGluaykKKwkJbGlzdF9mb3JfZWFjaF9lbnRyeShvYmosICpwaGFzZSwgbW0ubGluaykg
eworCQkJaTkxNV9nZW1fb2JqZWN0X2xvY2sob2JqKTsKIAkJCVdBUk5fT04oaTkxNV9nZW1fb2Jq
ZWN0X3NldF90b19jcHVfZG9tYWluKG9iaiwgdHJ1ZSkpOworCQkJaTkxNV9nZW1fb2JqZWN0X3Vu
bG9jayhvYmopOworCQl9CiAJfQotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAKIAlyZXR1cm4gMDsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ2VtX2d0dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKaW5kZXgg
Y2NjNGJkZjM1NmMxLi43NDk2Y2NlMGQ3OTggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtX2d0dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0
dC5jCkBAIC0zNTc4LDggKzM1NzgsMTEgQEAgdm9pZCBpOTE1X2dlbV9yZXN0b3JlX2d0dF9tYXBw
aW5ncyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCVdBUk5fT04oaTkxNV92
bWFfYmluZCh2bWEsCiAJCQkJICAgICAgb2JqID8gb2JqLT5jYWNoZV9sZXZlbCA6IDAsCiAJCQkJ
ICAgICAgUElOX1VQREFURSkpOwotCQlpZiAob2JqKQorCQlpZiAob2JqKSB7CisJCQlpOTE1X2dl
bV9vYmplY3RfbG9jayhvYmopOwogCQkJV0FSTl9PTihpOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2d0
dF9kb21haW4ob2JqLCBmYWxzZSkpOworCQkJaTkxNV9nZW1fb2JqZWN0X3VubG9jayhvYmopOwor
CQl9CiAKIGxvY2s6CiAJCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX3JlbmRlcl9zdGF0ZS5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9nZW1fcmVuZGVyX3N0YXRlLmMKaW5kZXggZjNiNDJiMDI2ZmZmLi43
MDZlZDcxNDY4ZTggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX3Jl
bmRlcl9zdGF0ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX3JlbmRlcl9z
dGF0ZS5jCkBAIC0yMjIsNyArMjIyLDkgQEAgaW50IGk5MTVfZ2VtX3JlbmRlcl9zdGF0ZV9lbWl0
KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCQkJZ290byBlcnJfdW5waW47CiAJfQogCisJaTkx
NV92bWFfbG9jayhzby52bWEpOwogCWVyciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHNvLnZt
YSwgcnEsIDApOworCWk5MTVfdm1hX3VubG9jayhzby52bWEpOwogZXJyX3VucGluOgogCWk5MTVf
dm1hX3VucGluKHNvLnZtYSk7CiBlcnJfdm1hOgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV92bWEuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKaW5kZXgg
Y2Y0MDVmZmRhMDQ1Li5kYjk0ZDdiNmM1YTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfdm1hLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwpAQCAt
ODQwLDEzICs4NDAsMTQgQEAgdm9pZCBpOTE1X3ZtYV9kZXN0cm95KHN0cnVjdCBpOTE1X3ZtYSAq
dm1hKQogewogCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0tPmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCi0JR0VNX0JVR19PTihpOTE1X3ZtYV9pc19hY3RpdmUodm1hKSk7CiAJR0VNX0JV
R19PTihpOTE1X3ZtYV9pc19waW5uZWQodm1hKSk7CiAKIAlpZiAoaTkxNV92bWFfaXNfY2xvc2Vk
KHZtYSkpCiAJCWxpc3RfZGVsKCZ2bWEtPmNsb3NlZF9saW5rKTsKIAogCVdBUk5fT04oaTkxNV92
bWFfdW5iaW5kKHZtYSkpOworCUdFTV9CVUdfT04oaTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpOwor
CiAJX19pOTE1X3ZtYV9kZXN0cm95KHZtYSk7CiB9CiAKQEAgLTkwOCwxMiArOTA5LDEwIEBAIHN0
YXRpYyB2b2lkIGV4cG9ydF9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAkgKiBoYW5kbGUg
YW4gZXJyb3IgcmlnaHQgbm93LiBXb3JzdCBjYXNlIHNob3VsZCBiZSBtaXNzZWQKIAkgKiBzeW5j
aHJvbmlzYXRpb24gbGVhZGluZyB0byByZW5kZXJpbmcgY29ycnVwdGlvbi4KIAkgKi8KLQlyZXNl
cnZhdGlvbl9vYmplY3RfbG9jayhyZXN2LCBOVUxMKTsKIAlpZiAoZmxhZ3MgJiBFWEVDX09CSkVD
VF9XUklURSkKIAkJcmVzZXJ2YXRpb25fb2JqZWN0X2FkZF9leGNsX2ZlbmNlKHJlc3YsICZycS0+
ZmVuY2UpOwogCWVsc2UgaWYgKHJlc2VydmF0aW9uX29iamVjdF9yZXNlcnZlX3NoYXJlZChyZXN2
LCAxKSA9PSAwKQogCQlyZXNlcnZhdGlvbl9vYmplY3RfYWRkX3NoYXJlZF9mZW5jZShyZXN2LCAm
cnEtPmZlbmNlKTsKLQlyZXNlcnZhdGlvbl9vYmplY3RfdW5sb2NrKHJlc3YpOwogfQogCiBpbnQg
aTkxNV92bWFfbW92ZV90b19hY3RpdmUoc3RydWN0IGk5MTVfdm1hICp2bWEsCkBAIC05MjIsNyAr
OTIxLDggQEAgaW50IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHN0cnVjdCBpOTE1X3ZtYSAqdm1h
LAogewogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB2bWEtPm9iajsKIAotCWxv
Y2tkZXBfYXNzZXJ0X2hlbGQoJnJxLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlhc3NlcnRf
dm1hX2hlbGQodm1hKTsKKwlhc3NlcnRfb2JqZWN0X2hlbGQob2JqKTsKIAlHRU1fQlVHX09OKCFk
cm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpOwogCiAJLyoKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3ZtYS5oCmluZGV4IDc1NGE3NjJkOTBiNC4uMjY1N2M5OWZlMTg3IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfdm1hLmgKQEAgLTI5OCw2ICsyOTgsMTggQEAgdm9pZCBpOTE1X3ZtYV9jbG9zZShzdHJ1Y3Qg
aTkxNV92bWEgKnZtYSk7CiB2b2lkIGk5MTVfdm1hX3Jlb3BlbihzdHJ1Y3QgaTkxNV92bWEgKnZt
YSk7CiB2b2lkIGk5MTVfdm1hX2Rlc3Ryb3koc3RydWN0IGk5MTVfdm1hICp2bWEpOwogCisjZGVm
aW5lIGFzc2VydF92bWFfaGVsZCh2bWEpIHJlc2VydmF0aW9uX29iamVjdF9hc3NlcnRfaGVsZCgo
dm1hKS0+cmVzdikKKworc3RhdGljIGlubGluZSB2b2lkIGk5MTVfdm1hX2xvY2soc3RydWN0IGk5
MTVfdm1hICp2bWEpCit7CisJcmVzZXJ2YXRpb25fb2JqZWN0X2xvY2sodm1hLT5yZXN2LCBOVUxM
KTsKK30KKworc3RhdGljIGlubGluZSB2b2lkIGk5MTVfdm1hX3VubG9jayhzdHJ1Y3QgaTkxNV92
bWEgKnZtYSkKK3sKKwlyZXNlcnZhdGlvbl9vYmplY3RfdW5sb2NrKHZtYS0+cmVzdik7Cit9CisK
IGludCBfX2k5MTVfdm1hX2RvX3BpbihzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAkJICAgICAgdTY0
IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncyk7CiBzdGF0aWMgaW5saW5lIGludCBfX211
c3RfY2hlY2sKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Rpc3BsYXku
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Rpc3BsYXkuYwppbmRleCBiODIzNmM3YzAz
M2QuLmY5Y2I4MDY3MWQyYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
ZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Rpc3BsYXkuYwpAQCAt
MjExMyw2ICsyMTEzLDcgQEAgaW50ZWxfcGluX2FuZF9mZW5jZV9mYl9vYmooc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIsCiAJICogcGluL3VucGluL2ZlbmNlIGFuZCBub3QgbW9yZS4KIAkgKi8K
IAl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoZGV2X3ByaXYpOworCWk5MTVfZ2VtX29i
amVjdF9sb2NrKG9iaik7CiAKIAlhdG9taWNfaW5jKCZkZXZfcHJpdi0+Z3B1X2Vycm9yLnBlbmRp
bmdfZmJfcGluKTsKIApAQCAtMjE2Nyw2ICsyMTY4LDcgQEAgaW50ZWxfcGluX2FuZF9mZW5jZV9m
Yl9vYmooc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCiBlcnI6CiAJYXRvbWljX2RlYygmZGV2
X3ByaXYtPmdwdV9lcnJvci5wZW5kaW5nX2ZiX3Bpbik7CiAKKwlpOTE1X2dlbV9vYmplY3RfdW5s
b2NrKG9iaik7CiAJaW50ZWxfcnVudGltZV9wbV9wdXQoZGV2X3ByaXYsIHdha2VyZWYpOwogCXJl
dHVybiB2bWE7CiB9CkBAIC0yMTc1LDkgKzIxNzcsMTIgQEAgdm9pZCBpbnRlbF91bnBpbl9mYl92
bWEoc3RydWN0IGk5MTVfdm1hICp2bWEsIHVuc2lnbmVkIGxvbmcgZmxhZ3MpCiB7CiAJbG9ja2Rl
cF9hc3NlcnRfaGVsZCgmdm1hLT52bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKKwlpOTE1
X2dlbV9vYmplY3RfbG9jayh2bWEtPm9iaik7CiAJaWYgKGZsYWdzICYgUExBTkVfSEFTX0ZFTkNF
KQogCQlpOTE1X3ZtYV91bnBpbl9mZW5jZSh2bWEpOwogCWk5MTVfZ2VtX29iamVjdF91bnBpbl9m
cm9tX2Rpc3BsYXlfcGxhbmUodm1hKTsKKwlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKHZtYS0+b2Jq
KTsKKwogCWk5MTVfdm1hX3B1dCh2bWEpOwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9ndWNfbG9nLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWNf
bG9nLmMKaW5kZXggNzE0NjUyNDI2NGRkLi42N2VhZGM4MmMzOTYgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Y19sb2cuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9ndWNfbG9nLmMKQEAgLTM0Myw4ICszNDMsNiBAQCBzdGF0aWMgdm9pZCBjYXB0dXJl
X2xvZ3Nfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAKIHN0YXRpYyBpbnQgZ3VjX2xv
Z19tYXAoc3RydWN0IGludGVsX2d1Y19sb2cgKmxvZykKIHsKLQlzdHJ1Y3QgaW50ZWxfZ3VjICpn
dWMgPSBsb2dfdG9fZ3VjKGxvZyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gZ3VjX3RvX2k5MTUoZ3VjKTsKIAl2b2lkICp2YWRkcjsKIAlpbnQgcmV0OwogCkBAIC0zNTMs
OSArMzUxLDkgQEAgc3RhdGljIGludCBndWNfbG9nX21hcChzdHJ1Y3QgaW50ZWxfZ3VjX2xvZyAq
bG9nKQogCWlmICghbG9nLT52bWEpCiAJCXJldHVybiAtRU5PREVWOwogCi0JbXV0ZXhfbG9jaygm
ZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWk5MTVfZ2VtX29iamVjdF9sb2NrKGxvZy0+
dm1hLT5vYmopOwogCXJldCA9IGk5MTVfZ2VtX29iamVjdF9zZXRfdG9fd2NfZG9tYWluKGxvZy0+
dm1hLT5vYmosIHRydWUpOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0
ZXgpOworCWk5MTVfZ2VtX29iamVjdF91bmxvY2sobG9nLT52bWEtPm9iaik7CiAJaWYgKHJldCkK
IAkJcmV0dXJuIHJldDsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
b3ZlcmxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfb3ZlcmxheS5jCmluZGV4IDgw
ZGNkODc5ZmM1OC4uYTJhYzA2YTA4NzE1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9vdmVybGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfb3Zlcmxh
eS5jCkBAIC03NjUsOCArNzY1LDEwIEBAIHN0YXRpYyBpbnQgaW50ZWxfb3ZlcmxheV9kb19wdXRf
aW1hZ2Uoc3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJsYXksCiAKIAlhdG9taWNfaW5jKCZkZXZf
cHJpdi0+Z3B1X2Vycm9yLnBlbmRpbmdfZmJfcGluKTsKIAorCWk5MTVfZ2VtX29iamVjdF9sb2Nr
KG5ld19ibyk7CiAJdm1hID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl90b19kaXNwbGF5X3BsYW5lKG5l
d19ibywKIAkJCQkJCSAgIDAsIE5VTEwsIFBJTl9NQVBQQUJMRSk7CisJaTkxNV9nZW1fb2JqZWN0
X3VubG9jayhuZXdfYm8pOwogCWlmIChJU19FUlIodm1hKSkgewogCQlyZXQgPSBQVFJfRVJSKHZt
YSk7CiAJCWdvdG8gb3V0X3Bpbl9zZWN0aW9uOwpAQCAtMTMwNSwxNSArMTMwNywyMCBAQCBpbnQg
aW50ZWxfb3ZlcmxheV9hdHRyc19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpk
YXRhLAogCiBzdGF0aWMgaW50IGdldF9yZWdpc3RlcnMoc3RydWN0IGludGVsX292ZXJsYXkgKm92
ZXJsYXksIGJvb2wgdXNlX3BoeXMpCiB7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSBvdmVybGF5LT5pOTE1OwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJc3Ry
dWN0IGk5MTVfdm1hICp2bWE7CiAJaW50IGVycjsKIAotCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9j
cmVhdGVfc3RvbGVuKG92ZXJsYXktPmk5MTUsIFBBR0VfU0laRSk7CisJbXV0ZXhfbG9jaygmaTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7CisKKwlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3N0
b2xlbihpOTE1LCBQQUdFX1NJWkUpOwogCWlmIChvYmogPT0gTlVMTCkKLQkJb2JqID0gaTkxNV9n
ZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChvdmVybGF5LT5pOTE1LCBQQUdFX1NJWkUpOwotCWlm
IChJU19FUlIob2JqKSkKLQkJcmV0dXJuIFBUUl9FUlIob2JqKTsKKwkJb2JqID0gaTkxNV9nZW1f
b2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChpOTE1LCBQQUdFX1NJWkUpOworCWlmIChJU19FUlIob2Jq
KSkgeworCQllcnIgPSBQVFJfRVJSKG9iaik7CisJCWdvdG8gZXJyX3VubG9jazsKKwl9CiAKIAl2
bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4ob2JqLCBOVUxMLCAwLCAwLCBQSU5fTUFQUEFC
TEUpOwogCWlmIChJU19FUlIodm1hKSkgewpAQCAtMTMzNCwxMCArMTM0MSwxMyBAQCBzdGF0aWMg
aW50IGdldF9yZWdpc3RlcnMoc3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJsYXksIGJvb2wgdXNl
X3BoeXMpCiAJfQogCiAJb3ZlcmxheS0+cmVnX2JvID0gb2JqOworCW11dGV4X3VubG9jaygmaTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIDA7CiAKIGVycl9wdXRfYm86CiAJaTkxNV9n
ZW1fb2JqZWN0X3B1dChvYmopOworZXJyX3VubG9jazoKKwltdXRleF91bmxvY2soJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CiB9CiAKQEAgLTEzNjMsMTggKzEzNzMsMTYg
QEAgdm9pZCBpbnRlbF9vdmVybGF5X3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIAogCUlOSVRfQUNUSVZFX1JFUVVFU1QoJm92ZXJsYXktPmxhc3RfZmxpcCk7CiAKLQlt
dXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlyZXQgPSBnZXRfcmVn
aXN0ZXJzKG92ZXJsYXksIE9WRVJMQVlfTkVFRFNfUEhZU0lDQUwoZGV2X3ByaXYpKTsKIAlpZiAo
cmV0KQogCQlnb3RvIG91dF9mcmVlOwogCisJaTkxNV9nZW1fb2JqZWN0X2xvY2sob3ZlcmxheS0+
cmVnX2JvKTsKIAlyZXQgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2d0dF9kb21haW4ob3Zlcmxh
eS0+cmVnX2JvLCB0cnVlKTsKKwlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKG92ZXJsYXktPnJlZ19i
byk7CiAJaWYgKHJldCkKIAkJZ290byBvdXRfcmVnX2JvOwogCi0JbXV0ZXhfdW5sb2NrKCZkZXZf
cHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAltZW1zZXRfaW8ob3ZlcmxheS0+cmVncywgMCwg
c2l6ZW9mKHN0cnVjdCBvdmVybGF5X3JlZ2lzdGVycykpOwogCXVwZGF0ZV9wb2x5cGhhc2VfZmls
dGVyKG92ZXJsYXktPnJlZ3MpOwogCXVwZGF0ZV9yZWdfYXR0cnMob3ZlcmxheSwgb3ZlcmxheS0+
cmVncyk7CkBAIC0xMzg2LDcgKzEzOTQsNiBAQCB2b2lkIGludGVsX292ZXJsYXlfc2V0dXAoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogb3V0X3JlZ19ibzoKIAlpOTE1X2dlbV9v
YmplY3RfcHV0KG92ZXJsYXktPnJlZ19ibyk7CiBvdXRfZnJlZToKLQltdXRleF91bmxvY2soJmRl
dl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIAlrZnJlZShvdmVybGF5KTsKIH0KIApkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdWNfZncuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX3VjX2Z3LmMKaW5kZXggZWMxZThjNGRlYjRkLi5mMzQyZGRkNDdkZjggMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3VjX2Z3LmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaW50ZWxfdWNfZncuYwpAQCAtMjQ2LDE1ICsyNDYsMTMgQEAgaW50IGlu
dGVsX3VjX2Z3X3VwbG9hZChzdHJ1Y3QgaW50ZWxfdWNfZncgKnVjX2Z3LAogCQkJIGludGVsX3Vj
X2Z3X3R5cGVfcmVwcih1Y19mdy0+dHlwZSksCiAJCQkgaW50ZWxfdWNfZndfc3RhdHVzX3JlcHIo
dWNfZnctPmxvYWRfc3RhdHVzKSk7CiAKLQlpbnRlbF91Y19md19nZ3R0X2JpbmQodWNfZncpOwot
CiAJLyogQ2FsbCBjdXN0b20gbG9hZGVyICovCisJaW50ZWxfdWNfZndfZ2d0dF9iaW5kKHVjX2Z3
KTsKIAllcnIgPSB4ZmVyKHVjX2Z3KTsKKwlpbnRlbF91Y19md19nZ3R0X3VuYmluZCh1Y19mdyk7
CiAJaWYgKGVycikKIAkJZ290byBmYWlsOwogCi0JaW50ZWxfdWNfZndfZ2d0dF91bmJpbmQodWNf
ZncpOwotCiAJdWNfZnctPmxvYWRfc3RhdHVzID0gSU5URUxfVUNfRklSTVdBUkVfU1VDQ0VTUzsK
IAlEUk1fREVCVUdfRFJJVkVSKCIlcyBmdyBsb2FkICVzXG4iLAogCQkJIGludGVsX3VjX2Z3X3R5
cGVfcmVwcih1Y19mdy0+dHlwZSksCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aTkxNV9yZXF1ZXN0LmMKaW5kZXggNGZkNTM1NmM2NTc3Li4yYzU0NzljYTFmNjkgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMKQEAgLTg3NCw3ICs4
NzQsOSBAQCBzdGF0aWMgaW50IGxpdmVfYWxsX2VuZ2luZXModm9pZCAqYXJnKQogCQkJaTkxNV9n
ZW1fb2JqZWN0X3NldF9hY3RpdmVfcmVmZXJlbmNlKGJhdGNoLT5vYmopOwogCQl9CiAKKwkJaTkx
NV92bWFfbG9jayhiYXRjaCk7CiAJCWVyciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKGJhdGNo
LCByZXF1ZXN0W2lkXSwgMCk7CisJCWk5MTVfdm1hX3VubG9jayhiYXRjaCk7CiAJCUdFTV9CVUdf
T04oZXJyKTsKIAogCQlpOTE1X3JlcXVlc3RfZ2V0KHJlcXVlc3RbaWRdKTsKQEAgLTk4OSw3ICs5
OTEsOSBAQCBzdGF0aWMgaW50IGxpdmVfc2VxdWVudGlhbF9lbmdpbmVzKHZvaWQgKmFyZykKIAkJ
R0VNX0JVR19PTihlcnIpOwogCQlyZXF1ZXN0W2lkXS0+YmF0Y2ggPSBiYXRjaDsKIAorCQlpOTE1
X3ZtYV9sb2NrKGJhdGNoKTsKIAkJZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3RpdmUoYmF0Y2gs
IHJlcXVlc3RbaWRdLCAwKTsKKwkJaTkxNV92bWFfdW5sb2NrKGJhdGNoKTsKIAkJR0VNX0JVR19P
TihlcnIpOwogCiAJCWk5MTVfZ2VtX29iamVjdF9zZXRfYWN0aXZlX3JlZmVyZW5jZShiYXRjaC0+
b2JqKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3Zt
YS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfdm1hLmMKaW5kZXggNjkx
OTIwNzg4M2Y2Li42ZjNlNDFjMGNiM2YgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pOTE1X3ZtYS5jCkBAIC04ODYsNyArODg2LDkgQEAgc3RhdGljIGludCBpZ3Rfdm1hX3JlbWFw
cGVkX2d0dCh2b2lkICphcmcpCiAJCQl1bnNpZ25lZCBpbnQgeCwgeTsKIAkJCWludCBlcnI7CiAK
KwkJCWk5MTVfZ2VtX29iamVjdF9sb2NrKG9iaik7CiAJCQllcnIgPSBpOTE1X2dlbV9vYmplY3Rf
c2V0X3RvX2d0dF9kb21haW4ob2JqLCB0cnVlKTsKKwkJCWk5MTVfZ2VtX29iamVjdF91bmxvY2so
b2JqKTsKIAkJCWlmIChlcnIpCiAJCQkJZ290byBvdXQ7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3Rfc3Bpbm5lci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvc2VsZnRlc3RzL2lndF9zcGlubmVyLmMKaW5kZXggMzhkNmYxYjEwYzU0Li4xNWMwZjBhZjk2
NTggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3Rfc3Bpbm5l
ci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3Rfc3Bpbm5lci5jCkBA
IC03Niw3ICs3Niw5IEBAIHN0YXRpYyBpbnQgbW92ZV90b19hY3RpdmUoc3RydWN0IGk5MTVfdm1h
ICp2bWEsCiB7CiAJaW50IGVycjsKIAorCWk5MTVfdm1hX2xvY2sodm1hKTsKIAllcnIgPSBpOTE1
X3ZtYV9tb3ZlX3RvX2FjdGl2ZSh2bWEsIHJxLCBmbGFncyk7CisJaTkxNV92bWFfdW5sb2NrKHZt
YSk7CiAJaWYgKGVycikKIAkJcmV0dXJuIGVycjsKIAotLSAKMi4yMC4xCgpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0
CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id DA39BD904B
	for <lists+intel-gfx@lfdr.de>; Wed, 16 Oct 2019 14:03:16 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 449796E956;
	Wed, 16 Oct 2019 12:03:14 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 389076E956
 for <intel-gfx@lists.freedesktop.org>; Wed, 16 Oct 2019 12:03:09 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18856340-1500050 
 for multiple; Wed, 16 Oct 2019 13:02:51 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 16 Oct 2019 13:02:49 +0100
Message-Id: <20191016120249.22714-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191016113240.6468-1-chris@chris-wilson.co.uk>
References: <20191016113240.6468-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2] drm/i915/selftests: Teach execlists to take
 intel_gt as its argument
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIGV4ZWNsaXN0cyBzZWxmdGVzdHMgYXJlIGhhcmR3YXJlIGNlbnRyaWMgYW5kIHNvIHdhbnQg
dG8gdXNlIHRoZSBndAphcyBpdHMgdGFyZ2V0LgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29u
IDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBUdnJ0a28gVXJzdWxpbiA8dHZydGtvLnVy
c3VsaW5AaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xy
Yy5jIHwgMjkwICsrKysrKysrKysrKy0tLS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAxNDMg
aW5zZXJ0aW9ucygrKSwgMTQ3IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfbHJjLmMKaW5kZXggOWMxZjM0ZmI1ODgyLi4yODY4MzcxYzYwOWUgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCkBAIC01MSwyMCArNTEsMjAgQEAgc3RhdGljIHN0
cnVjdCBpOTE1X3ZtYSAqY3JlYXRlX3NjcmF0Y2goc3RydWN0IGludGVsX2d0ICpndCkKIAogc3Rh
dGljIGludCBsaXZlX3Nhbml0eWNoZWNrKHZvaWQgKmFyZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IGFyZzsKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwogCXN0cnVj
dCBpOTE1X2dlbV9lbmdpbmVzX2l0ZXIgaXQ7CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0
eDsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAJc3RydWN0IGlndF9zcGlubmVyIHNwaW47
CiAJaW50IGVyciA9IC1FTk9NRU07CiAKLQlpZiAoIUhBU19MT0dJQ0FMX1JJTkdfQ09OVEVYVFMo
aTkxNSkpCisJaWYgKCFIQVNfTE9HSUNBTF9SSU5HX0NPTlRFWFRTKGd0LT5pOTE1KSkKIAkJcmV0
dXJuIDA7CiAKLQlpZiAoaWd0X3NwaW5uZXJfaW5pdCgmc3BpbiwgJmk5MTUtPmd0KSkKKwlpZiAo
aWd0X3NwaW5uZXJfaW5pdCgmc3BpbiwgZ3QpKQogCQlyZXR1cm4gLUVOT01FTTsKIAotCWN0eCA9
IGtlcm5lbF9jb250ZXh0KGk5MTUpOworCWN0eCA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsK
IAlpZiAoIWN0eCkKIAkJZ290byBlcnJfc3BpbjsKIApAQCAtODEsMTMgKzgxLDEzIEBAIHN0YXRp
YyBpbnQgbGl2ZV9zYW5pdHljaGVjayh2b2lkICphcmcpCiAJCWlmICghaWd0X3dhaXRfZm9yX3Nw
aW5uZXIoJnNwaW4sIHJxKSkgewogCQkJR0VNX1RSQUNFKCJzcGlubmVyIGZhaWxlZCB0byBzdGFy
dFxuIik7CiAJCQlHRU1fVFJBQ0VfRFVNUCgpOwotCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZCgmaTkx
NS0+Z3QpOworCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CiAJCQllcnIgPSAtRUlPOwogCQkJ
Z290byBlcnJfY3R4OwogCQl9CiAKIAkJaWd0X3NwaW5uZXJfZW5kKCZzcGluKTsKLQkJaWYgKGln
dF9mbHVzaF90ZXN0KGk5MTUpKSB7CisJCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpIHsK
IAkJCWVyciA9IC1FSU87CiAJCQlnb3RvIGVycl9jdHg7CiAJCX0KQEAgLTEwMiw3ICsxMDIsNyBA
QCBzdGF0aWMgaW50IGxpdmVfc2FuaXR5Y2hlY2sodm9pZCAqYXJnKQogCXJldHVybiBlcnI7CiB9
CiAKLXN0YXRpYyBpbnQgbGl2ZV91bmxpdGVfcmVzdG9yZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwgaW50IHByaW8pCitzdGF0aWMgaW50IGxpdmVfdW5saXRlX3Jlc3RvcmUoc3RydWN0
IGludGVsX2d0ICpndCwgaW50IHByaW8pCiB7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lOwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CkBAIC0xMTUsMTUgKzExNSwxNSBA
QCBzdGF0aWMgaW50IGxpdmVfdW5saXRlX3Jlc3RvcmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsIGludCBwcmlvKQogCSAqIG9uIHRoZSBzYW1lIGVuZ2luZSBmcm9tIHRoZSBzYW1lIHBh
cmVudCBjb250ZXh0LgogCSAqLwogCi0JaWYgKGlndF9zcGlubmVyX2luaXQoJnNwaW4sICZpOTE1
LT5ndCkpCisJaWYgKGlndF9zcGlubmVyX2luaXQoJnNwaW4sIGd0KSkKIAkJcmV0dXJuIGVycjsK
IAotCWN0eCA9IGtlcm5lbF9jb250ZXh0KGk5MTUpOworCWN0eCA9IGtlcm5lbF9jb250ZXh0KGd0
LT5pOTE1KTsKIAlpZiAoIWN0eCkKIAkJZ290byBlcnJfc3BpbjsKIAogCWVyciA9IDA7Ci0JZm9y
X2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5l
LCBndC0+aTkxNSwgaWQpIHsKIAkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlWzJdID0ge307CiAJ
CXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxWzJdOwogCQlzdHJ1Y3QgaWd0X2xpdmVfdGVzdCB0OwpA
QCAtMTM1LDcgKzEzNSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV91bmxpdGVfcmVzdG9yZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgaW50IHByaW8pCiAJCWlmICghaW50ZWxfZW5naW5lX2Nh
bl9zdG9yZV9kd29yZChlbmdpbmUpKQogCQkJY29udGludWU7CiAKLQkJaWYgKGlndF9saXZlX3Rl
c3RfYmVnaW4oJnQsIGk5MTUsIF9fZnVuY19fLCBlbmdpbmUtPm5hbWUpKSB7CisJCWlmIChpZ3Rf
bGl2ZV90ZXN0X2JlZ2luKCZ0LCBndC0+aTkxNSwgX19mdW5jX18sIGVuZ2luZS0+bmFtZSkpIHsK
IAkJCWVyciA9IC1FSU87CiAJCQlicmVhazsKIAkJfQpAQCAtNDE2LDcgKzQxNiw3IEBAIHNsaWNl
X3NlbWFwaG9yZV9xdWV1ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpvdXRlciwKIAogc3RhdGlj
IGludCBsaXZlX3RpbWVzbGljZV9wcmVlbXB0KHZvaWQgKmFyZykKIHsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwogCXN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJ
dm9pZCAqdmFkZHI7CkBAIC00MzIsMTEgKzQzMiwxMSBAQCBzdGF0aWMgaW50IGxpdmVfdGltZXNs
aWNlX3ByZWVtcHQodm9pZCAqYXJnKQogCSAqIHJlYWR5IHRhc2suCiAJICovCiAKLQlvYmogPSBp
OTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGk5MTUsIFBBR0VfU0laRSk7CisJb2JqID0g
aTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChndC0+aTkxNSwgUEFHRV9TSVpFKTsKIAlp
ZiAoSVNfRVJSKG9iaikpCiAJCXJldHVybiBQVFJfRVJSKG9iaik7CiAKLQl2bWEgPSBpOTE1X3Zt
YV9pbnN0YW5jZShvYmosICZpOTE1LT5nZ3R0LnZtLCBOVUxMKTsKKwl2bWEgPSBpOTE1X3ZtYV9p
bnN0YW5jZShvYmosICZndC0+Z2d0dC0+dm0sIE5VTEwpOwogCWlmIChJU19FUlIodm1hKSkgewog
CQllcnIgPSBQVFJfRVJSKHZtYSk7CiAJCWdvdG8gZXJyX29iajsKQEAgLTQ1Niw3ICs0NTYsNyBA
QCBzdGF0aWMgaW50IGxpdmVfdGltZXNsaWNlX3ByZWVtcHQodm9pZCAqYXJnKQogCQlzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwogCi0J
CWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7CisJCWZvcl9lYWNoX2VuZ2luZShl
bmdpbmUsIGd0LT5pOTE1LCBpZCkgewogCQkJaWYgKCFpbnRlbF9lbmdpbmVfaGFzX3ByZWVtcHRp
b24oZW5naW5lKSkKIAkJCQljb250aW51ZTsKIApAQCAtNDY2LDcgKzQ2Niw3IEBAIHN0YXRpYyBp
bnQgbGl2ZV90aW1lc2xpY2VfcHJlZW1wdCh2b2lkICphcmcpCiAJCQlpZiAoZXJyKQogCQkJCWdv
dG8gZXJyX3BpbjsKIAotCQkJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUpKSB7CisJCQlpZiAoaWd0
X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpKSB7CiAJCQkJZXJyID0gLUVJTzsKIAkJCQlnb3RvIGVycl9w
aW47CiAJCQl9CkBAIC00ODQsNyArNDg0LDcgQEAgc3RhdGljIGludCBsaXZlX3RpbWVzbGljZV9w
cmVlbXB0KHZvaWQgKmFyZykKIAogc3RhdGljIGludCBsaXZlX2J1c3l3YWl0X3ByZWVtcHQodm9p
ZCAqYXJnKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnOworCXN0cnVj
dCBpbnRlbF9ndCAqZ3QgPSBhcmc7CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eF9oaSwg
KmN0eF9sbzsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iajsKQEAgLTQ5OCwxOSArNDk4LDE5IEBAIHN0YXRpYyBpbnQgbGl2
ZV9idXN5d2FpdF9wcmVlbXB0KHZvaWQgKmFyZykKIAkgKiBwcmVlbXB0IHRoZSBidXN5d2FpdHMg
dXNlZCB0byBzeW5jaHJvbmlzZSBiZXR3ZWVuIHJpbmdzLgogCSAqLwogCi0JY3R4X2hpID0ga2Vy
bmVsX2NvbnRleHQoaTkxNSk7CisJY3R4X2hpID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOwog
CWlmICghY3R4X2hpKQogCQlyZXR1cm4gLUVOT01FTTsKIAljdHhfaGktPnNjaGVkLnByaW9yaXR5
ID0KIAkJSTkxNV9VU0VSX1BSSU9SSVRZKEk5MTVfQ09OVEVYVF9NQVhfVVNFUl9QUklPUklUWSk7
CiAKLQljdHhfbG8gPSBrZXJuZWxfY29udGV4dChpOTE1KTsKKwljdHhfbG8gPSBrZXJuZWxfY29u
dGV4dChndC0+aTkxNSk7CiAJaWYgKCFjdHhfbG8pCiAJCWdvdG8gZXJyX2N0eF9oaTsKIAljdHhf
bG8tPnNjaGVkLnByaW9yaXR5ID0KIAkJSTkxNV9VU0VSX1BSSU9SSVRZKEk5MTVfQ09OVEVYVF9N
SU5fVVNFUl9QUklPUklUWSk7CiAKLQlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVy
bmFsKGk5MTUsIFBBR0VfU0laRSk7CisJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRl
cm5hbChndC0+aTkxNSwgUEFHRV9TSVpFKTsKIAlpZiAoSVNfRVJSKG9iaikpIHsKIAkJZXJyID0g
UFRSX0VSUihvYmopOwogCQlnb3RvIGVycl9jdHhfbG87CkBAIC01MjIsNyArNTIyLDcgQEAgc3Rh
dGljIGludCBsaXZlX2J1c3l3YWl0X3ByZWVtcHQodm9pZCAqYXJnKQogCQlnb3RvIGVycl9vYmo7
CiAJfQogCi0Jdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCAmaTkxNS0+Z2d0dC52bSwgTlVM
TCk7CisJdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCAmZ3QtPmdndHQtPnZtLCBOVUxMKTsK
IAlpZiAoSVNfRVJSKHZtYSkpIHsKIAkJZXJyID0gUFRSX0VSUih2bWEpOwogCQlnb3RvIGVycl9t
YXA7CkBAIC01MzIsNyArNTMyLDcgQEAgc3RhdGljIGludCBsaXZlX2J1c3l3YWl0X3ByZWVtcHQo
dm9pZCAqYXJnKQogCWlmIChlcnIpCiAJCWdvdG8gZXJyX21hcDsKIAotCWZvcl9lYWNoX2VuZ2lu
ZShlbmdpbmUsIGk5MTUsIGlkKSB7CisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5MTUs
IGlkKSB7CiAJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKmxvLCAqaGk7CiAJCXN0cnVjdCBpZ3RfbGl2
ZV90ZXN0IHQ7CiAJCXUzMiAqY3M7CkBAIC01NDMsNyArNTQzLDcgQEAgc3RhdGljIGludCBsaXZl
X2J1c3l3YWl0X3ByZWVtcHQodm9pZCAqYXJnKQogCQlpZiAoIWludGVsX2VuZ2luZV9jYW5fc3Rv
cmVfZHdvcmQoZW5naW5lKSkKIAkJCWNvbnRpbnVlOwogCi0JCWlmIChpZ3RfbGl2ZV90ZXN0X2Jl
Z2luKCZ0LCBpOTE1LCBfX2Z1bmNfXywgZW5naW5lLT5uYW1lKSkgeworCQlpZiAoaWd0X2xpdmVf
dGVzdF9iZWdpbigmdCwgZ3QtPmk5MTUsIF9fZnVuY19fLCBlbmdpbmUtPm5hbWUpKSB7CiAJCQll
cnIgPSAtRUlPOwogCQkJZ290byBlcnJfdm1hOwogCQl9CkBAIC02MjMsNyArNjIzLDcgQEAgc3Rh
dGljIGludCBsaXZlX2J1c3l3YWl0X3ByZWVtcHQodm9pZCAqYXJnKQogCQlpOTE1X3JlcXVlc3Rf
YWRkKGhpKTsKIAogCQlpZiAoaTkxNV9yZXF1ZXN0X3dhaXQobG8sIDAsIEhaIC8gNSkgPCAwKSB7
Ci0JCQlzdHJ1Y3QgZHJtX3ByaW50ZXIgcCA9IGRybV9pbmZvX3ByaW50ZXIoaTkxNS0+ZHJtLmRl
dik7CisJCQlzdHJ1Y3QgZHJtX3ByaW50ZXIgcCA9IGRybV9pbmZvX3ByaW50ZXIoZ3QtPmk5MTUt
PmRybS5kZXYpOwogCiAJCQlwcl9lcnIoIiVzOiBGYWlsZWQgdG8gcHJlZW1wdCBzZW1hcGhvcmUg
YnVzeXdhaXQhXG4iLAogCQkJICAgICAgIGVuZ2luZS0+bmFtZSk7CkBAIC02MzEsNyArNjMxLDcg
QEAgc3RhdGljIGludCBsaXZlX2J1c3l3YWl0X3ByZWVtcHQodm9pZCAqYXJnKQogCQkJaW50ZWxf
ZW5naW5lX2R1bXAoZW5naW5lLCAmcCwgIiVzXG4iLCBlbmdpbmUtPm5hbWUpOwogCQkJR0VNX1RS
QUNFX0RVTVAoKTsKIAotCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZCgmaTkxNS0+Z3QpOworCQkJaW50
ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CiAJCQllcnIgPSAtRUlPOwogCQkJZ290byBlcnJfdm1hOwog
CQl9CkBAIC02NzcsNDUgKzY3Nyw0NSBAQCBzcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KHN0cnVjdCBp
Z3Rfc3Bpbm5lciAqc3BpbiwKIAogc3RhdGljIGludCBsaXZlX3ByZWVtcHQodm9pZCAqYXJnKQog
ewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnOworCXN0cnVjdCBpbnRlbF9n
dCAqZ3QgPSBhcmc7CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eF9oaSwgKmN0eF9sbzsK
IAlzdHJ1Y3QgaWd0X3NwaW5uZXIgc3Bpbl9oaSwgc3Bpbl9sbzsKIAlzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmU7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAJaW50IGVyciA9IC1F
Tk9NRU07CiAKLQlpZiAoIUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1QVElPTihpOTE1KSkKKwlpZiAo
IUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1QVElPTihndC0+aTkxNSkpCiAJCXJldHVybiAwOwogCi0J
aWYgKCEoaTkxNS0+Y2Fwcy5zY2hlZHVsZXIgJiBJOTE1X1NDSEVEVUxFUl9DQVBfUFJFRU1QVElP
TikpCisJaWYgKCEoZ3QtPmk5MTUtPmNhcHMuc2NoZWR1bGVyICYgSTkxNV9TQ0hFRFVMRVJfQ0FQ
X1BSRUVNUFRJT04pKQogCQlwcl9lcnIoIkxvZ2ljYWwgcHJlZW1wdGlvbiBzdXBwb3J0ZWQsIGJ1
dCBub3QgZXhwb3NlZFxuIik7CiAKLQlpZiAoaWd0X3NwaW5uZXJfaW5pdCgmc3Bpbl9oaSwgJmk5
MTUtPmd0KSkKKwlpZiAoaWd0X3NwaW5uZXJfaW5pdCgmc3Bpbl9oaSwgZ3QpKQogCQlyZXR1cm4g
LUVOT01FTTsKIAotCWlmIChpZ3Rfc3Bpbm5lcl9pbml0KCZzcGluX2xvLCAmaTkxNS0+Z3QpKQor
CWlmIChpZ3Rfc3Bpbm5lcl9pbml0KCZzcGluX2xvLCBndCkpCiAJCWdvdG8gZXJyX3NwaW5faGk7
CiAKLQljdHhfaGkgPSBrZXJuZWxfY29udGV4dChpOTE1KTsKKwljdHhfaGkgPSBrZXJuZWxfY29u
dGV4dChndC0+aTkxNSk7CiAJaWYgKCFjdHhfaGkpCiAJCWdvdG8gZXJyX3NwaW5fbG87CiAJY3R4
X2hpLT5zY2hlZC5wcmlvcml0eSA9CiAJCUk5MTVfVVNFUl9QUklPUklUWShJOTE1X0NPTlRFWFRf
TUFYX1VTRVJfUFJJT1JJVFkpOwogCi0JY3R4X2xvID0ga2VybmVsX2NvbnRleHQoaTkxNSk7CisJ
Y3R4X2xvID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOwogCWlmICghY3R4X2xvKQogCQlnb3Rv
IGVycl9jdHhfaGk7CiAJY3R4X2xvLT5zY2hlZC5wcmlvcml0eSA9CiAJCUk5MTVfVVNFUl9QUklP
UklUWShJOTE1X0NPTlRFWFRfTUlOX1VTRVJfUFJJT1JJVFkpOwogCi0JZm9yX2VhY2hfZW5naW5l
KGVuZ2luZSwgaTkxNSwgaWQpIHsKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndC0+aTkxNSwg
aWQpIHsKIAkJc3RydWN0IGlndF9saXZlX3Rlc3QgdDsKIAkJc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnE7CiAKIAkJaWYgKCFpbnRlbF9lbmdpbmVfaGFzX3ByZWVtcHRpb24oZW5naW5lKSkKIAkJCWNv
bnRpbnVlOwogCi0JCWlmIChpZ3RfbGl2ZV90ZXN0X2JlZ2luKCZ0LCBpOTE1LCBfX2Z1bmNfXywg
ZW5naW5lLT5uYW1lKSkgeworCQlpZiAoaWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgZ3QtPmk5MTUs
IF9fZnVuY19fLCBlbmdpbmUtPm5hbWUpKSB7CiAJCQllcnIgPSAtRUlPOwogCQkJZ290byBlcnJf
Y3R4X2xvOwogCQl9CkBAIC03MzEsNyArNzMxLDcgQEAgc3RhdGljIGludCBsaXZlX3ByZWVtcHQo
dm9pZCAqYXJnKQogCQlpZiAoIWlndF93YWl0X2Zvcl9zcGlubmVyKCZzcGluX2xvLCBycSkpIHsK
IAkJCUdFTV9UUkFDRSgibG8gc3Bpbm5lciBmYWlsZWQgdG8gc3RhcnRcbiIpOwogCQkJR0VNX1RS
QUNFX0RVTVAoKTsKLQkJCWludGVsX2d0X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKKwkJCWludGVs
X2d0X3NldF93ZWRnZWQoZ3QpOwogCQkJZXJyID0gLUVJTzsKIAkJCWdvdG8gZXJyX2N0eF9sbzsK
IAkJfQpAQCAtNzQ4LDcgKzc0OCw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9wcmVlbXB0KHZvaWQgKmFy
ZykKIAkJaWYgKCFpZ3Rfd2FpdF9mb3Jfc3Bpbm5lcigmc3Bpbl9oaSwgcnEpKSB7CiAJCQlHRU1f
VFJBQ0UoImhpIHNwaW5uZXIgZmFpbGVkIHRvIHN0YXJ0XG4iKTsKIAkJCUdFTV9UUkFDRV9EVU1Q
KCk7Ci0JCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZpOTE1LT5ndCk7CisJCQlpbnRlbF9ndF9zZXRf
d2VkZ2VkKGd0KTsKIAkJCWVyciA9IC1FSU87CiAJCQlnb3RvIGVycl9jdHhfbG87CiAJCX0KQEAg
LTc3Niw3ICs3NzYsNyBAQCBzdGF0aWMgaW50IGxpdmVfcHJlZW1wdCh2b2lkICphcmcpCiAKIHN0
YXRpYyBpbnQgbGl2ZV9sYXRlX3ByZWVtcHQodm9pZCAqYXJnKQogewotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gYXJnOworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CiAJc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eF9oaSwgKmN0eF9sbzsKIAlzdHJ1Y3QgaWd0X3NwaW5u
ZXIgc3Bpbl9oaSwgc3Bpbl9sbzsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CkBA
IC03ODQsMzQgKzc4NCwzNCBAQCBzdGF0aWMgaW50IGxpdmVfbGF0ZV9wcmVlbXB0KHZvaWQgKmFy
ZykKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKIAlpbnQgZXJyID0gLUVOT01FTTsKIAotCWlm
ICghSEFTX0xPR0lDQUxfUklOR19QUkVFTVBUSU9OKGk5MTUpKQorCWlmICghSEFTX0xPR0lDQUxf
UklOR19QUkVFTVBUSU9OKGd0LT5pOTE1KSkKIAkJcmV0dXJuIDA7CiAKLQlpZiAoaWd0X3NwaW5u
ZXJfaW5pdCgmc3Bpbl9oaSwgJmk5MTUtPmd0KSkKKwlpZiAoaWd0X3NwaW5uZXJfaW5pdCgmc3Bp
bl9oaSwgZ3QpKQogCQlyZXR1cm4gLUVOT01FTTsKIAotCWlmIChpZ3Rfc3Bpbm5lcl9pbml0KCZz
cGluX2xvLCAmaTkxNS0+Z3QpKQorCWlmIChpZ3Rfc3Bpbm5lcl9pbml0KCZzcGluX2xvLCBndCkp
CiAJCWdvdG8gZXJyX3NwaW5faGk7CiAKLQljdHhfaGkgPSBrZXJuZWxfY29udGV4dChpOTE1KTsK
KwljdHhfaGkgPSBrZXJuZWxfY29udGV4dChndC0+aTkxNSk7CiAJaWYgKCFjdHhfaGkpCiAJCWdv
dG8gZXJyX3NwaW5fbG87CiAKLQljdHhfbG8gPSBrZXJuZWxfY29udGV4dChpOTE1KTsKKwljdHhf
bG8gPSBrZXJuZWxfY29udGV4dChndC0+aTkxNSk7CiAJaWYgKCFjdHhfbG8pCiAJCWdvdG8gZXJy
X2N0eF9oaTsKIAogCS8qIE1ha2Ugc3VyZSBjdHhfbG8gc3RheXMgYmVmb3JlIGN0eF9oaSB1bnRp
bCB3ZSB0cmlnZ2VyIHByZWVtcHRpb24uICovCiAJY3R4X2xvLT5zY2hlZC5wcmlvcml0eSA9IEk5
MTVfVVNFUl9QUklPUklUWSgxKTsKIAotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlk
KSB7CisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5MTUsIGlkKSB7CiAJCXN0cnVjdCBp
Z3RfbGl2ZV90ZXN0IHQ7CiAJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwogCiAJCWlmICghaW50
ZWxfZW5naW5lX2hhc19wcmVlbXB0aW9uKGVuZ2luZSkpCiAJCQljb250aW51ZTsKIAotCQlpZiAo
aWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgaTkxNSwgX19mdW5jX18sIGVuZ2luZS0+bmFtZSkpIHsK
KwkJaWYgKGlndF9saXZlX3Rlc3RfYmVnaW4oJnQsIGd0LT5pOTE1LCBfX2Z1bmNfXywgZW5naW5l
LT5uYW1lKSkgewogCQkJZXJyID0gLUVJTzsKIAkJCWdvdG8gZXJyX2N0eF9sbzsKIAkJfQpAQCAt
ODc1LDcgKzg3NSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9sYXRlX3ByZWVtcHQodm9pZCAqYXJnKQog
ZXJyX3dlZGdlZDoKIAlpZ3Rfc3Bpbm5lcl9lbmQoJnNwaW5faGkpOwogCWlndF9zcGlubmVyX2Vu
ZCgmc3Bpbl9sbyk7Ci0JaW50ZWxfZ3Rfc2V0X3dlZGdlZCgmaTkxNS0+Z3QpOworCWludGVsX2d0
X3NldF93ZWRnZWQoZ3QpOwogCWVyciA9IC1FSU87CiAJZ290byBlcnJfY3R4X2xvOwogfQpAQCAt
ODg1LDE0ICs4ODUsMTMgQEAgc3RydWN0IHByZWVtcHRfY2xpZW50IHsKIAlzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqY3R4OwogfTsKIAotc3RhdGljIGludCBwcmVlbXB0X2NsaWVudF9pbml0KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAotCQkJICAgICAgIHN0cnVjdCBwcmVlbXB0X2Ns
aWVudCAqYykKK3N0YXRpYyBpbnQgcHJlZW1wdF9jbGllbnRfaW5pdChzdHJ1Y3QgaW50ZWxfZ3Qg
Kmd0LCBzdHJ1Y3QgcHJlZW1wdF9jbGllbnQgKmMpCiB7Ci0JYy0+Y3R4ID0ga2VybmVsX2NvbnRl
eHQoaTkxNSk7CisJYy0+Y3R4ID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOwogCWlmICghYy0+
Y3R4KQogCQlyZXR1cm4gLUVOT01FTTsKIAotCWlmIChpZ3Rfc3Bpbm5lcl9pbml0KCZjLT5zcGlu
LCAmaTkxNS0+Z3QpKQorCWlmIChpZ3Rfc3Bpbm5lcl9pbml0KCZjLT5zcGluLCBndCkpCiAJCWdv
dG8gZXJyX2N0eDsKIAogCXJldHVybiAwOwpAQCAtOTEwLDcgKzkwOSw3IEBAIHN0YXRpYyB2b2lk
IHByZWVtcHRfY2xpZW50X2Zpbmkoc3RydWN0IHByZWVtcHRfY2xpZW50ICpjKQogCiBzdGF0aWMg
aW50IGxpdmVfbm9wcmVlbXB0KHZvaWQgKmFyZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IGFyZzsKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwogCXN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKmVuZ2luZTsKIAlzdHJ1Y3QgcHJlZW1wdF9jbGllbnQgYSwgYjsKIAllbnVt
IGludGVsX2VuZ2luZV9pZCBpZDsKQEAgLTkyMSwxNiArOTIwLDE2IEBAIHN0YXRpYyBpbnQgbGl2
ZV9ub3ByZWVtcHQodm9pZCAqYXJnKQogCSAqIHRoYXQgbWF5IGJlIGJlaW5nIG9ic2VydmVkIGFu
ZCBub3Qgd2FudCB0byBiZSBpbnRlcnJ1cHRlZC4KIAkgKi8KIAotCWlmICghSEFTX0xPR0lDQUxf
UklOR19QUkVFTVBUSU9OKGk5MTUpKQorCWlmICghSEFTX0xPR0lDQUxfUklOR19QUkVFTVBUSU9O
KGd0LT5pOTE1KSkKIAkJcmV0dXJuIDA7CiAKLQlpZiAocHJlZW1wdF9jbGllbnRfaW5pdChpOTE1
LCAmYSkpCisJaWYgKHByZWVtcHRfY2xpZW50X2luaXQoZ3QsICZhKSkKIAkJcmV0dXJuIC1FTk9N
RU07Ci0JaWYgKHByZWVtcHRfY2xpZW50X2luaXQoaTkxNSwgJmIpKQorCWlmIChwcmVlbXB0X2Ns
aWVudF9pbml0KGd0LCAmYikpCiAJCWdvdG8gZXJyX2NsaWVudF9hOwogCWIuY3R4LT5zY2hlZC5w
cmlvcml0eSA9IEk5MTVfVVNFUl9QUklPUklUWShJOTE1X1BSSU9SSVRZX01BWCk7CiAKLQlmb3Jf
ZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgeworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUs
IGd0LT5pOTE1LCBpZCkgewogCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycV9hLCAqcnFfYjsKIAog
CQlpZiAoIWludGVsX2VuZ2luZV9oYXNfcHJlZW1wdGlvbihlbmdpbmUpKQpAQCAtOTkwLDcgKzk4
OSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9ub3ByZWVtcHQodm9pZCAqYXJnKQogCQkJZ290byBlcnJf
d2VkZ2VkOwogCQl9CiAKLQkJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUpKQorCQlpZiAoaWd0X2Zs
dXNoX3Rlc3QoZ3QtPmk5MTUpKQogCQkJZ290byBlcnJfd2VkZ2VkOwogCX0KIApAQCAtMTAwNCwx
NCArMTAwMywxNCBAQCBzdGF0aWMgaW50IGxpdmVfbm9wcmVlbXB0KHZvaWQgKmFyZykKIGVycl93
ZWRnZWQ6CiAJaWd0X3NwaW5uZXJfZW5kKCZiLnNwaW4pOwogCWlndF9zcGlubmVyX2VuZCgmYS5z
cGluKTsKLQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZpOTE1LT5ndCk7CisJaW50ZWxfZ3Rfc2V0X3dl
ZGdlZChndCk7CiAJZXJyID0gLUVJTzsKIAlnb3RvIGVycl9jbGllbnRfYjsKIH0KIAogc3RhdGlj
IGludCBsaXZlX3N1cHByZXNzX3NlbGZfcHJlZW1wdCh2b2lkICphcmcpCiB7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsK
IAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJc3RydWN0IGk5MTVfc2NoZWRfYXR0
ciBhdHRyID0gewogCQkucHJpb3JpdHkgPSBJOTE1X1VTRVJfUFJJT1JJVFkoSTkxNV9QUklPUklU
WV9NQVgpCkBAIC0xMDI3LDI4ICsxMDI2LDI4IEBAIHN0YXRpYyBpbnQgbGl2ZV9zdXBwcmVzc19z
ZWxmX3ByZWVtcHQodm9pZCAqYXJnKQogCSAqIGNvbXBsZXRpb24gZXZlbnQuCiAJICovCiAKLQlp
ZiAoIUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1QVElPTihpOTE1KSkKKwlpZiAoIUhBU19MT0dJQ0FM
X1JJTkdfUFJFRU1QVElPTihndC0+aTkxNSkpCiAJCXJldHVybiAwOwogCi0JaWYgKFVTRVNfR1VD
X1NVQk1JU1NJT04oaTkxNSkpCisJaWYgKFVTRVNfR1VDX1NVQk1JU1NJT04oZ3QtPmk5MTUpKQog
CQlyZXR1cm4gMDsgLyogcHJlc3VtZSBibGFjayBibG94ICovCiAKLQlpZiAoaW50ZWxfdmdwdV9h
Y3RpdmUoaTkxNSkpCisJaWYgKGludGVsX3ZncHVfYWN0aXZlKGd0LT5pOTE1KSkKIAkJcmV0dXJu
IDA7IC8qIEdWVCBmb3JjZXMgc2luZ2xlIHBvcnQgJiByZXF1ZXN0IHN1Ym1pc3Npb24gKi8KIAot
CWlmIChwcmVlbXB0X2NsaWVudF9pbml0KGk5MTUsICZhKSkKKwlpZiAocHJlZW1wdF9jbGllbnRf
aW5pdChndCwgJmEpKQogCQlyZXR1cm4gLUVOT01FTTsKLQlpZiAocHJlZW1wdF9jbGllbnRfaW5p
dChpOTE1LCAmYikpCisJaWYgKHByZWVtcHRfY2xpZW50X2luaXQoZ3QsICZiKSkKIAkJZ290byBl
cnJfY2xpZW50X2E7CiAKLQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgeworCWZv
cl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LT5pOTE1LCBpZCkgewogCQlzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycV9hLCAqcnFfYjsKIAkJaW50IGRlcHRoOwogCiAJCWlmICghaW50ZWxfZW5naW5lX2hh
c19wcmVlbXB0aW9uKGVuZ2luZSkpCiAJCQljb250aW51ZTsKIAotCQlpZiAoaWd0X2ZsdXNoX3Rl
c3QoaTkxNSkpCisJCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpCiAJCQlnb3RvIGVycl93
ZWRnZWQ7CiAKIAkJaW50ZWxfZW5naW5lX3BtX2dldChlbmdpbmUpOwpAQCAtMTEwOSw3ICsxMTA4
LDcgQEAgc3RhdGljIGludCBsaXZlX3N1cHByZXNzX3NlbGZfcHJlZW1wdCh2b2lkICphcmcpCiAJ
CX0KIAogCQlpbnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2luZSk7Ci0JCWlmIChpZ3RfZmx1c2hfdGVz
dChpOTE1KSkKKwkJaWYgKGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KSkKIAkJCWdvdG8gZXJyX3dl
ZGdlZDsKIAl9CiAKQEAgLTExMjMsNyArMTEyMiw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9zdXBwcmVz
c19zZWxmX3ByZWVtcHQodm9pZCAqYXJnKQogZXJyX3dlZGdlZDoKIAlpZ3Rfc3Bpbm5lcl9lbmQo
JmIuc3Bpbik7CiAJaWd0X3NwaW5uZXJfZW5kKCZhLnNwaW4pOwotCWludGVsX2d0X3NldF93ZWRn
ZWQoJmk5MTUtPmd0KTsKKwlpbnRlbF9ndF9zZXRfd2VkZ2VkKGd0KTsKIAllcnIgPSAtRUlPOwog
CWdvdG8gZXJyX2NsaWVudF9iOwogfQpAQCAtMTE4Myw3ICsxMTgyLDcgQEAgc3RhdGljIHZvaWQg
ZHVtbXlfcmVxdWVzdF9mcmVlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKmR1bW15KQogCiBzdGF0aWMg
aW50IGxpdmVfc3VwcHJlc3Nfd2FpdF9wcmVlbXB0KHZvaWQgKmFyZykKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwog
CXN0cnVjdCBwcmVlbXB0X2NsaWVudCBjbGllbnRbNF07CiAJc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwpAQCAtMTE5NiwxOSArMTE5NSwx
OSBAQCBzdGF0aWMgaW50IGxpdmVfc3VwcHJlc3Nfd2FpdF9wcmVlbXB0KHZvaWQgKmFyZykKIAkg
KiBub3QgbmVlZGxlc3NseSBnZW5lcmF0ZSBwcmVlbXB0LXRvLWlkbGUgY3ljbGVzLgogCSAqLwog
Ci0JaWYgKCFIQVNfTE9HSUNBTF9SSU5HX1BSRUVNUFRJT04oaTkxNSkpCisJaWYgKCFIQVNfTE9H
SUNBTF9SSU5HX1BSRUVNUFRJT04oZ3QtPmk5MTUpKQogCQlyZXR1cm4gMDsKIAotCWlmIChwcmVl
bXB0X2NsaWVudF9pbml0KGk5MTUsICZjbGllbnRbMF0pKSAvKiBFTFNQWzBdICovCisJaWYgKHBy
ZWVtcHRfY2xpZW50X2luaXQoZ3QsICZjbGllbnRbMF0pKSAvKiBFTFNQWzBdICovCiAJCXJldHVy
biAtRU5PTUVNOwotCWlmIChwcmVlbXB0X2NsaWVudF9pbml0KGk5MTUsICZjbGllbnRbMV0pKSAv
KiBFTFNQWzFdICovCisJaWYgKHByZWVtcHRfY2xpZW50X2luaXQoZ3QsICZjbGllbnRbMV0pKSAv
KiBFTFNQWzFdICovCiAJCWdvdG8gZXJyX2NsaWVudF8wOwotCWlmIChwcmVlbXB0X2NsaWVudF9p
bml0KGk5MTUsICZjbGllbnRbMl0pKSAvKiBoZWFkIG9mIHF1ZXVlICovCisJaWYgKHByZWVtcHRf
Y2xpZW50X2luaXQoZ3QsICZjbGllbnRbMl0pKSAvKiBoZWFkIG9mIHF1ZXVlICovCiAJCWdvdG8g
ZXJyX2NsaWVudF8xOwotCWlmIChwcmVlbXB0X2NsaWVudF9pbml0KGk5MTUsICZjbGllbnRbM10p
KSAvKiBieXN0YW5kZXIgKi8KKwlpZiAocHJlZW1wdF9jbGllbnRfaW5pdChndCwgJmNsaWVudFsz
XSkpIC8qIGJ5c3RhbmRlciAqLwogCQlnb3RvIGVycl9jbGllbnRfMjsKIAotCWZvcl9lYWNoX2Vu
Z2luZShlbmdpbmUsIGk5MTUsIGlkKSB7CisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5
MTUsIGlkKSB7CiAJCWludCBkZXB0aDsKIAogCQlpZiAoIWludGVsX2VuZ2luZV9oYXNfcHJlZW1w
dGlvbihlbmdpbmUpKQpAQCAtMTI2Myw3ICsxMjYyLDcgQEAgc3RhdGljIGludCBsaXZlX3N1cHBy
ZXNzX3dhaXRfcHJlZW1wdCh2b2lkICphcmcpCiAJCQlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0la
RShjbGllbnQpOyBpKyspCiAJCQkJaWd0X3NwaW5uZXJfZW5kKCZjbGllbnRbaV0uc3Bpbik7CiAK
LQkJCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKKwkJCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+
aTkxNSkpCiAJCQkJZ290byBlcnJfd2VkZ2VkOwogCiAJCQlpZiAoZW5naW5lLT5leGVjbGlzdHMu
cHJlZW1wdF9oYW5nLmNvdW50KSB7CkBAIC0xMjkxLDE0ICsxMjkwLDE0IEBAIHN0YXRpYyBpbnQg
bGl2ZV9zdXBwcmVzc193YWl0X3ByZWVtcHQodm9pZCAqYXJnKQogZXJyX3dlZGdlZDoKIAlmb3Ig
KGkgPSAwOyBpIDwgQVJSQVlfU0laRShjbGllbnQpOyBpKyspCiAJCWlndF9zcGlubmVyX2VuZCgm
Y2xpZW50W2ldLnNwaW4pOwotCWludGVsX2d0X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKKwlpbnRl
bF9ndF9zZXRfd2VkZ2VkKGd0KTsKIAllcnIgPSAtRUlPOwogCWdvdG8gZXJyX2NsaWVudF8zOwog
fQogCiBzdGF0aWMgaW50IGxpdmVfY2hhaW5fcHJlZW1wdCh2b2lkICphcmcpCiB7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGFy
ZzsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJc3RydWN0IHByZWVtcHRfY2xp
ZW50IGhpLCBsbzsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKQEAgLTEzMTAsMTYgKzEzMDks
MTYgQEAgc3RhdGljIGludCBsaXZlX2NoYWluX3ByZWVtcHQodm9pZCAqYXJnKQogCSAqIHRoZSBw
cmV2aW91c2x5IHN1Ym1pdHRlZCBzcGlubmVyIGluIEIuCiAJICovCiAKLQlpZiAoIUhBU19MT0dJ
Q0FMX1JJTkdfUFJFRU1QVElPTihpOTE1KSkKKwlpZiAoIUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1Q
VElPTihndC0+aTkxNSkpCiAJCXJldHVybiAwOwogCi0JaWYgKHByZWVtcHRfY2xpZW50X2luaXQo
aTkxNSwgJmhpKSkKKwlpZiAocHJlZW1wdF9jbGllbnRfaW5pdChndCwgJmhpKSkKIAkJcmV0dXJu
IC1FTk9NRU07CiAKLQlpZiAocHJlZW1wdF9jbGllbnRfaW5pdChpOTE1LCAmbG8pKQorCWlmIChw
cmVlbXB0X2NsaWVudF9pbml0KGd0LCAmbG8pKQogCQlnb3RvIGVycl9jbGllbnRfaGk7CiAKLQlm
b3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgeworCWZvcl9lYWNoX2VuZ2luZShlbmdp
bmUsIGd0LT5pOTE1LCBpZCkgewogCQlzdHJ1Y3QgaTkxNV9zY2hlZF9hdHRyIGF0dHIgPSB7CiAJ
CQkucHJpb3JpdHkgPSBJOTE1X1VTRVJfUFJJT1JJVFkoSTkxNV9QUklPUklUWV9NQVgpLAogCQl9
OwpAQCAtMTM1MCw3ICsxMzQ5LDcgQEAgc3RhdGljIGludCBsaXZlX2NoYWluX3ByZWVtcHQodm9p
ZCAqYXJnKQogCQkJZ290byBlcnJfd2VkZ2VkOwogCQl9CiAKLQkJaWYgKGlndF9saXZlX3Rlc3Rf
YmVnaW4oJnQsIGk5MTUsIF9fZnVuY19fLCBlbmdpbmUtPm5hbWUpKSB7CisJCWlmIChpZ3RfbGl2
ZV90ZXN0X2JlZ2luKCZ0LCBndC0+aTkxNSwgX19mdW5jX18sIGVuZ2luZS0+bmFtZSkpIHsKIAkJ
CWVyciA9IC1FSU87CiAJCQlnb3RvIGVycl93ZWRnZWQ7CiAJCX0KQEAgLTEzODgsNyArMTM4Nyw3
IEBAIHN0YXRpYyBpbnQgbGl2ZV9jaGFpbl9wcmVlbXB0KHZvaWQgKmFyZykKIAkJCWlndF9zcGlu
bmVyX2VuZCgmaGkuc3Bpbik7CiAJCQlpZiAoaTkxNV9yZXF1ZXN0X3dhaXQocnEsIDAsIEhaIC8g
NSkgPCAwKSB7CiAJCQkJc3RydWN0IGRybV9wcmludGVyIHAgPQotCQkJCQlkcm1faW5mb19wcmlu
dGVyKGk5MTUtPmRybS5kZXYpOworCQkJCQlkcm1faW5mb19wcmludGVyKGd0LT5pOTE1LT5kcm0u
ZGV2KTsKIAogCQkJCXByX2VycigiRmFpbGVkIHRvIHByZWVtcHQgb3ZlciBjaGFpbiBvZiAlZFxu
IiwKIAkJCQkgICAgICAgY291bnQpOwpAQCAtMTQwNCw3ICsxNDAzLDcgQEAgc3RhdGljIGludCBs
aXZlX2NoYWluX3ByZWVtcHQodm9pZCAqYXJnKQogCQkJaTkxNV9yZXF1ZXN0X2FkZChycSk7CiAJ
CQlpZiAoaTkxNV9yZXF1ZXN0X3dhaXQocnEsIDAsIEhaIC8gNSkgPCAwKSB7CiAJCQkJc3RydWN0
IGRybV9wcmludGVyIHAgPQotCQkJCQlkcm1faW5mb19wcmludGVyKGk5MTUtPmRybS5kZXYpOwor
CQkJCQlkcm1faW5mb19wcmludGVyKGd0LT5pOTE1LT5kcm0uZGV2KTsKIAogCQkJCXByX2Vycigi
RmFpbGVkIHRvIGZsdXNoIGxvdyBwcmlvcml0eSBjaGFpbiBvZiAlZCByZXF1ZXN0c1xuIiwKIAkJ
CQkgICAgICAgY291bnQpOwpAQCAtMTQzMCw0NSArMTQyOSw0NSBAQCBzdGF0aWMgaW50IGxpdmVf
Y2hhaW5fcHJlZW1wdCh2b2lkICphcmcpCiBlcnJfd2VkZ2VkOgogCWlndF9zcGlubmVyX2VuZCgm
aGkuc3Bpbik7CiAJaWd0X3NwaW5uZXJfZW5kKCZsby5zcGluKTsKLQlpbnRlbF9ndF9zZXRfd2Vk
Z2VkKCZpOTE1LT5ndCk7CisJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CiAJZXJyID0gLUVJTzsK
IAlnb3RvIGVycl9jbGllbnRfbG87CiB9CiAKIHN0YXRpYyBpbnQgbGl2ZV9wcmVlbXB0X2hhbmco
dm9pZCAqYXJnKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnOworCXN0
cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eF9o
aSwgKmN0eF9sbzsKIAlzdHJ1Y3QgaWd0X3NwaW5uZXIgc3Bpbl9oaSwgc3Bpbl9sbzsKIAlzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAJ
aW50IGVyciA9IC1FTk9NRU07CiAKLQlpZiAoIUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1QVElPTihp
OTE1KSkKKwlpZiAoIUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1QVElPTihndC0+aTkxNSkpCiAJCXJl
dHVybiAwOwogCi0JaWYgKCFpbnRlbF9oYXNfcmVzZXRfZW5naW5lKCZpOTE1LT5ndCkpCisJaWYg
KCFpbnRlbF9oYXNfcmVzZXRfZW5naW5lKGd0KSkKIAkJcmV0dXJuIDA7CiAKLQlpZiAoaWd0X3Nw
aW5uZXJfaW5pdCgmc3Bpbl9oaSwgJmk5MTUtPmd0KSkKKwlpZiAoaWd0X3NwaW5uZXJfaW5pdCgm
c3Bpbl9oaSwgZ3QpKQogCQlyZXR1cm4gLUVOT01FTTsKIAotCWlmIChpZ3Rfc3Bpbm5lcl9pbml0
KCZzcGluX2xvLCAmaTkxNS0+Z3QpKQorCWlmIChpZ3Rfc3Bpbm5lcl9pbml0KCZzcGluX2xvLCBn
dCkpCiAJCWdvdG8gZXJyX3NwaW5faGk7CiAKLQljdHhfaGkgPSBrZXJuZWxfY29udGV4dChpOTE1
KTsKKwljdHhfaGkgPSBrZXJuZWxfY29udGV4dChndC0+aTkxNSk7CiAJaWYgKCFjdHhfaGkpCiAJ
CWdvdG8gZXJyX3NwaW5fbG87CiAJY3R4X2hpLT5zY2hlZC5wcmlvcml0eSA9CiAJCUk5MTVfVVNF
Ul9QUklPUklUWShJOTE1X0NPTlRFWFRfTUFYX1VTRVJfUFJJT1JJVFkpOwogCi0JY3R4X2xvID0g
a2VybmVsX2NvbnRleHQoaTkxNSk7CisJY3R4X2xvID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUp
OwogCWlmICghY3R4X2xvKQogCQlnb3RvIGVycl9jdHhfaGk7CiAJY3R4X2xvLT5zY2hlZC5wcmlv
cml0eSA9CiAJCUk5MTVfVVNFUl9QUklPUklUWShJOTE1X0NPTlRFWFRfTUlOX1VTRVJfUFJJT1JJ
VFkpOwogCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKKwlmb3JfZWFjaF9l
bmdpbmUoZW5naW5lLCBndC0+aTkxNSwgaWQpIHsKIAkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7
CiAKIAkJaWYgKCFpbnRlbF9lbmdpbmVfaGFzX3ByZWVtcHRpb24oZW5naW5lKSkKQEAgLTE0ODUs
NyArMTQ4NCw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9wcmVlbXB0X2hhbmcodm9pZCAqYXJnKQogCQlp
ZiAoIWlndF93YWl0X2Zvcl9zcGlubmVyKCZzcGluX2xvLCBycSkpIHsKIAkJCUdFTV9UUkFDRSgi
bG8gc3Bpbm5lciBmYWlsZWQgdG8gc3RhcnRcbiIpOwogCQkJR0VNX1RSQUNFX0RVTVAoKTsKLQkJ
CWludGVsX2d0X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKKwkJCWludGVsX2d0X3NldF93ZWRnZWQo
Z3QpOwogCQkJZXJyID0gLUVJTzsKIAkJCWdvdG8gZXJyX2N0eF9sbzsKIAkJfQpAQCAtMTUwNywy
OCArMTUwNiwyOCBAQCBzdGF0aWMgaW50IGxpdmVfcHJlZW1wdF9oYW5nKHZvaWQgKmFyZykKIAkJ
CQkJCSBIWiAvIDEwKSkgewogCQkJcHJfZXJyKCJQcmVlbXB0aW9uIGRpZCBub3Qgb2NjdXIgd2l0
aGluIHRpbWVvdXQhIik7CiAJCQlHRU1fVFJBQ0VfRFVNUCgpOwotCQkJaW50ZWxfZ3Rfc2V0X3dl
ZGdlZCgmaTkxNS0+Z3QpOworCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CiAJCQllcnIgPSAt
RUlPOwogCQkJZ290byBlcnJfY3R4X2xvOwogCQl9CiAKLQkJc2V0X2JpdChJOTE1X1JFU0VUX0VO
R0lORSArIGlkLCAmaTkxNS0+Z3QucmVzZXQuZmxhZ3MpOworCQlzZXRfYml0KEk5MTVfUkVTRVRf
RU5HSU5FICsgaWQsICZndC0+cmVzZXQuZmxhZ3MpOwogCQlpbnRlbF9lbmdpbmVfcmVzZXQoZW5n
aW5lLCBOVUxMKTsKLQkJY2xlYXJfYml0KEk5MTVfUkVTRVRfRU5HSU5FICsgaWQsICZpOTE1LT5n
dC5yZXNldC5mbGFncyk7CisJCWNsZWFyX2JpdChJOTE1X1JFU0VUX0VOR0lORSArIGlkLCAmZ3Qt
PnJlc2V0LmZsYWdzKTsKIAogCQllbmdpbmUtPmV4ZWNsaXN0cy5wcmVlbXB0X2hhbmcuaW5qZWN0
X2hhbmcgPSBmYWxzZTsKIAogCQlpZiAoIWlndF93YWl0X2Zvcl9zcGlubmVyKCZzcGluX2hpLCBy
cSkpIHsKIAkJCUdFTV9UUkFDRSgiaGkgc3Bpbm5lciBmYWlsZWQgdG8gc3RhcnRcbiIpOwogCQkJ
R0VNX1RSQUNFX0RVTVAoKTsKLQkJCWludGVsX2d0X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKKwkJ
CWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOwogCQkJZXJyID0gLUVJTzsKIAkJCWdvdG8gZXJyX2N0
eF9sbzsKIAkJfQogCiAJCWlndF9zcGlubmVyX2VuZCgmc3Bpbl9oaSk7CiAJCWlndF9zcGlubmVy
X2VuZCgmc3Bpbl9sbyk7Ci0JCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkgeworCQlpZiAoaWd0
X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpKSB7CiAJCQllcnIgPSAtRUlPOwogCQkJZ290byBlcnJfY3R4
X2xvOwogCQl9CkBAIC0xNTU3LDcgKzE1NTYsNyBAQCBzdGF0aWMgaW50IHJhbmRvbV9wcmlvcml0
eShzdHJ1Y3Qgcm5kX3N0YXRlICpybmQpCiB9CiAKIHN0cnVjdCBwcmVlbXB0X3Ntb2tlIHsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNTsKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0OwogCXN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICoqY29udGV4dHM7CiAJc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpiYXRjaDsKQEAgLTE2NTcs
NyArMTY1Niw3IEBAIHN0YXRpYyBpbnQgc21va2VfY3Jlc2NlbmRvKHN0cnVjdCBwcmVlbXB0X3Nt
b2tlICpzbW9rZSwgdW5zaWduZWQgaW50IGZsYWdzKQogCXVuc2lnbmVkIGxvbmcgY291bnQ7CiAJ
aW50IGVyciA9IDA7CiAKLQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBzbW9rZS0+aTkxNSwgaWQp
IHsKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBzbW9rZS0+Z3QtPmk5MTUsIGlkKSB7CiAJCWFy
Z1tpZF0gPSAqc21va2U7CiAJCWFyZ1tpZF0uZW5naW5lID0gZW5naW5lOwogCQlpZiAoIShmbGFn
cyAmIEJBVENIKSkKQEAgLTE2NzQsNyArMTY3Myw3IEBAIHN0YXRpYyBpbnQgc21va2VfY3Jlc2Nl
bmRvKHN0cnVjdCBwcmVlbXB0X3Ntb2tlICpzbW9rZSwgdW5zaWduZWQgaW50IGZsYWdzKQogCX0K
IAogCWNvdW50ID0gMDsKLQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBzbW9rZS0+aTkxNSwgaWQp
IHsKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBzbW9rZS0+Z3QtPmk5MTUsIGlkKSB7CiAJCWlu
dCBzdGF0dXM7CiAKIAkJaWYgKElTX0VSUl9PUl9OVUxMKHRza1tpZF0pKQpAQCAtMTY5MSw3ICsx
NjkwLDcgQEAgc3RhdGljIGludCBzbW9rZV9jcmVzY2VuZG8oc3RydWN0IHByZWVtcHRfc21va2Ug
KnNtb2tlLCB1bnNpZ25lZCBpbnQgZmxhZ3MpCiAKIAlwcl9pbmZvKCJTdWJtaXR0ZWQgJWx1IGNy
ZXNjZW5kbzoleCByZXF1ZXN0cyBhY3Jvc3MgJWQgZW5naW5lcyBhbmQgJWQgY29udGV4dHNcbiIs
CiAJCWNvdW50LCBmbGFncywKLQkJUlVOVElNRV9JTkZPKHNtb2tlLT5pOTE1KS0+bnVtX2VuZ2lu
ZXMsIHNtb2tlLT5uY29udGV4dCk7CisJCVJVTlRJTUVfSU5GTyhzbW9rZS0+Z3QtPmk5MTUpLT5u
dW1fZW5naW5lcywgc21va2UtPm5jb250ZXh0KTsKIAlyZXR1cm4gMDsKIH0KIApAQCAtMTcwMyw3
ICsxNzAyLDcgQEAgc3RhdGljIGludCBzbW9rZV9yYW5kb20oc3RydWN0IHByZWVtcHRfc21va2Ug
KnNtb2tlLCB1bnNpZ25lZCBpbnQgZmxhZ3MpCiAKIAljb3VudCA9IDA7CiAJZG8gewotCQlmb3Jf
ZWFjaF9lbmdpbmUoc21va2UtPmVuZ2luZSwgc21va2UtPmk5MTUsIGlkKSB7CisJCWZvcl9lYWNo
X2VuZ2luZShzbW9rZS0+ZW5naW5lLCBzbW9rZS0+Z3QtPmk5MTUsIGlkKSB7CiAJCQlzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqY3R4ID0gc21va2VfY29udGV4dChzbW9rZSk7CiAJCQlpbnQgZXJy
OwogCkBAIC0xNzE5LDE0ICsxNzE4LDE0IEBAIHN0YXRpYyBpbnQgc21va2VfcmFuZG9tKHN0cnVj
dCBwcmVlbXB0X3Ntb2tlICpzbW9rZSwgdW5zaWduZWQgaW50IGZsYWdzKQogCiAJcHJfaW5mbygi
U3VibWl0dGVkICVsdSByYW5kb206JXggcmVxdWVzdHMgYWNyb3NzICVkIGVuZ2luZXMgYW5kICVk
IGNvbnRleHRzXG4iLAogCQljb3VudCwgZmxhZ3MsCi0JCVJVTlRJTUVfSU5GTyhzbW9rZS0+aTkx
NSktPm51bV9lbmdpbmVzLCBzbW9rZS0+bmNvbnRleHQpOworCQlSVU5USU1FX0lORk8oc21va2Ut
Pmd0LT5pOTE1KS0+bnVtX2VuZ2luZXMsIHNtb2tlLT5uY29udGV4dCk7CiAJcmV0dXJuIDA7CiB9
CiAKIHN0YXRpYyBpbnQgbGl2ZV9wcmVlbXB0X3Ntb2tlKHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3Qg
cHJlZW1wdF9zbW9rZSBzbW9rZSA9IHsKLQkJLmk5MTUgPSBhcmcsCisJCS5ndCA9IGFyZywKIAkJ
LnBybmcgPSBJOTE1X1JORF9TVEFURV9JTklUSUFMSVpFUihpOTE1X3NlbGZ0ZXN0LnJhbmRvbV9z
ZWVkKSwKIAkJLm5jb250ZXh0ID0gMTAyNCwKIAl9OwpAQCAtMTczNiw3ICsxNzM1LDcgQEAgc3Rh
dGljIGludCBsaXZlX3ByZWVtcHRfc21va2Uodm9pZCAqYXJnKQogCXUzMiAqY3M7CiAJaW50IG47
CiAKLQlpZiAoIUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1QVElPTihzbW9rZS5pOTE1KSkKKwlpZiAo
IUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1QVElPTihzbW9rZS5ndC0+aTkxNSkpCiAJCXJldHVybiAw
OwogCiAJc21va2UuY29udGV4dHMgPSBrbWFsbG9jX2FycmF5KHNtb2tlLm5jb250ZXh0LApAQCAt
MTc0NSw3ICsxNzQ0LDggQEAgc3RhdGljIGludCBsaXZlX3ByZWVtcHRfc21va2Uodm9pZCAqYXJn
KQogCWlmICghc21va2UuY29udGV4dHMpCiAJCXJldHVybiAtRU5PTUVNOwogCi0Jc21va2UuYmF0
Y2ggPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKHNtb2tlLmk5MTUsIFBBR0VfU0la
RSk7CisJc21va2UuYmF0Y2ggPQorCQlpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKHNt
b2tlLmd0LT5pOTE1LCBQQUdFX1NJWkUpOwogCWlmIChJU19FUlIoc21va2UuYmF0Y2gpKSB7CiAJ
CWVyciA9IFBUUl9FUlIoc21va2UuYmF0Y2gpOwogCQlnb3RvIGVycl9mcmVlOwpAQCAtMTc2Miwx
MyArMTc2MiwxMyBAQCBzdGF0aWMgaW50IGxpdmVfcHJlZW1wdF9zbW9rZSh2b2lkICphcmcpCiAJ
aTkxNV9nZW1fb2JqZWN0X2ZsdXNoX21hcChzbW9rZS5iYXRjaCk7CiAJaTkxNV9nZW1fb2JqZWN0
X3VucGluX21hcChzbW9rZS5iYXRjaCk7CiAKLQlpZiAoaWd0X2xpdmVfdGVzdF9iZWdpbigmdCwg
c21va2UuaTkxNSwgX19mdW5jX18sICJhbGwiKSkgeworCWlmIChpZ3RfbGl2ZV90ZXN0X2JlZ2lu
KCZ0LCBzbW9rZS5ndC0+aTkxNSwgX19mdW5jX18sICJhbGwiKSkgewogCQllcnIgPSAtRUlPOwog
CQlnb3RvIGVycl9iYXRjaDsKIAl9CiAKIAlmb3IgKG4gPSAwOyBuIDwgc21va2UubmNvbnRleHQ7
IG4rKykgewotCQlzbW9rZS5jb250ZXh0c1tuXSA9IGtlcm5lbF9jb250ZXh0KHNtb2tlLmk5MTUp
OworCQlzbW9rZS5jb250ZXh0c1tuXSA9IGtlcm5lbF9jb250ZXh0KHNtb2tlLmd0LT5pOTE1KTsK
IAkJaWYgKCFzbW9rZS5jb250ZXh0c1tuXSkKIAkJCWdvdG8gZXJyX2N0eDsKIAl9CkBAIC0xODAx
LDcgKzE4MDEsNyBAQCBzdGF0aWMgaW50IGxpdmVfcHJlZW1wdF9zbW9rZSh2b2lkICphcmcpCiAJ
cmV0dXJuIGVycjsKIH0KIAotc3RhdGljIGludCBub3BfdmlydHVhbF9lbmdpbmUoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCitzdGF0aWMgaW50IG5vcF92aXJ0dWFsX2VuZ2luZShzdHJ1
Y3QgaW50ZWxfZ3QgKmd0LAogCQkJICAgICAgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqKnNpYmxp
bmdzLAogCQkJICAgICAgdW5zaWduZWQgaW50IG5zaWJsaW5nLAogCQkJICAgICAgdW5zaWduZWQg
aW50IG5jdHgsCkBAIC0xODIwLDcgKzE4MjAsNyBAQCBzdGF0aWMgaW50IG5vcF92aXJ0dWFsX2Vu
Z2luZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlHRU1fQlVHX09OKCFuY3R4IHx8
IG5jdHggPiBBUlJBWV9TSVpFKGN0eCkpOwogCiAJZm9yIChuID0gMDsgbiA8IG5jdHg7IG4rKykg
ewotCQljdHhbbl0gPSBrZXJuZWxfY29udGV4dChpOTE1KTsKKwkJY3R4W25dID0ga2VybmVsX2Nv
bnRleHQoZ3QtPmk5MTUpOwogCQlpZiAoIWN0eFtuXSkgewogCQkJZXJyID0gLUVOT01FTTsKIAkJ
CW5jdHggPSBuOwpAQCAtMTg0NSw3ICsxODQ1LDcgQEAgc3RhdGljIGludCBub3BfdmlydHVhbF9l
bmdpbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCX0KIAl9CiAKLQllcnIgPSBp
Z3RfbGl2ZV90ZXN0X2JlZ2luKCZ0LCBpOTE1LCBfX2Z1bmNfXywgdmVbMF0tPmVuZ2luZS0+bmFt
ZSk7CisJZXJyID0gaWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgZ3QtPmk5MTUsIF9fZnVuY19fLCB2
ZVswXS0+ZW5naW5lLT5uYW1lKTsKIAlpZiAoZXJyKQogCQlnb3RvIG91dDsKIApAQCAtMTg5Miw3
ICsxODkyLDcgQEAgc3RhdGljIGludCBub3BfdmlydHVhbF9lbmdpbmUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJCQkJCSAgcmVxdWVzdFtuY10tPmZlbmNlLmNvbnRleHQsCiAJCQkJ
CSAgcmVxdWVzdFtuY10tPmZlbmNlLnNlcW5vKTsKIAkJCQlHRU1fVFJBQ0VfRFVNUCgpOwotCQkJ
CWludGVsX2d0X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKKwkJCQlpbnRlbF9ndF9zZXRfd2VkZ2Vk
KGd0KTsKIAkJCQlicmVhazsKIAkJCX0KIAkJfQpAQCAtMTkxNCw3ICsxOTE0LDcgQEAgc3RhdGlj
IGludCBub3BfdmlydHVhbF9lbmdpbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJ
CXByaW1lLCBkaXY2NF91NjQoa3RpbWVfdG9fbnModGltZXNbMV0pLCBwcmltZSkpOwogCiBvdXQ6
Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUpKQorCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkx
NSkpCiAJCWVyciA9IC1FSU87CiAKIAlmb3IgKG5jID0gMDsgbmMgPCBuY3R4OyBuYysrKSB7CkBA
IC0xOTI3LDE5ICsxOTI3LDE4IEBAIHN0YXRpYyBpbnQgbm9wX3ZpcnR1YWxfZW5naW5lKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCiBzdGF0aWMgaW50IGxpdmVfdmlydHVhbF9lbmdp
bmUodm9pZCAqYXJnKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnOwor
CXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqc2li
bGluZ3NbTUFYX0VOR0lORV9JTlNUQU5DRSArIDFdOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZTsKLQlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gJmk5MTUtPmd0OwogCWVudW0gaW50ZWxf
ZW5naW5lX2lkIGlkOwogCXVuc2lnbmVkIGludCBjbGFzcywgaW5zdDsKIAlpbnQgZXJyOwogCi0J
aWYgKFVTRVNfR1VDX1NVQk1JU1NJT04oaTkxNSkpCisJaWYgKFVTRVNfR1VDX1NVQk1JU1NJT04o
Z3QtPmk5MTUpKQogCQlyZXR1cm4gMDsKIAotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUs
IGlkKSB7Ci0JCWVyciA9IG5vcF92aXJ0dWFsX2VuZ2luZShpOTE1LCAmZW5naW5lLCAxLCAxLCAw
KTsKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndC0+aTkxNSwgaWQpIHsKKwkJZXJyID0gbm9w
X3ZpcnR1YWxfZW5naW5lKGd0LCAmZW5naW5lLCAxLCAxLCAwKTsKIAkJaWYgKGVycikgewogCQkJ
cHJfZXJyKCJGYWlsZWQgdG8gd3JhcCBlbmdpbmUgJXM6IGVycj0lZFxuIiwKIAkJCSAgICAgICBl
bmdpbmUtPm5hbWUsIGVycik7CkBAIC0xOTYxLDEzICsxOTYwLDEzIEBAIHN0YXRpYyBpbnQgbGl2
ZV92aXJ0dWFsX2VuZ2luZSh2b2lkICphcmcpCiAJCQljb250aW51ZTsKIAogCQlmb3IgKG4gPSAx
OyBuIDw9IG5zaWJsaW5nICsgMTsgbisrKSB7Ci0JCQllcnIgPSBub3BfdmlydHVhbF9lbmdpbmUo
aTkxNSwgc2libGluZ3MsIG5zaWJsaW5nLAorCQkJZXJyID0gbm9wX3ZpcnR1YWxfZW5naW5lKGd0
LCBzaWJsaW5ncywgbnNpYmxpbmcsCiAJCQkJCQkgbiwgMCk7CiAJCQlpZiAoZXJyKQogCQkJCXJl
dHVybiBlcnI7CiAJCX0KIAotCQllcnIgPSBub3BfdmlydHVhbF9lbmdpbmUoaTkxNSwgc2libGlu
Z3MsIG5zaWJsaW5nLCBuLCBDSEFJTik7CisJCWVyciA9IG5vcF92aXJ0dWFsX2VuZ2luZShndCwg
c2libGluZ3MsIG5zaWJsaW5nLCBuLCBDSEFJTik7CiAJCWlmIChlcnIpCiAJCQlyZXR1cm4gZXJy
OwogCX0KQEAgLTE5NzUsNyArMTk3NCw3IEBAIHN0YXRpYyBpbnQgbGl2ZV92aXJ0dWFsX2VuZ2lu
ZSh2b2lkICphcmcpCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgbWFza192aXJ0dWFsX2Vu
Z2luZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKK3N0YXRpYyBpbnQgbWFza192aXJ0
dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCQkJICAgICAgIHN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKipzaWJsaW5ncywKIAkJCSAgICAgICB1bnNpZ25lZCBpbnQgbnNpYmxpbmcpCiB7
CkBAIC0xOTkxLDcgKzE5OTAsNyBAQCBzdGF0aWMgaW50IG1hc2tfdmlydHVhbF9lbmdpbmUoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJICogcmVzdHJpY3QgaXQgdG8gb3VyIGRlc2ly
ZWQgZW5naW5lIHdpdGhpbiB0aGUgdmlydHVhbCBlbmdpbmUuCiAJICovCiAKLQljdHggPSBrZXJu
ZWxfY29udGV4dChpOTE1KTsKKwljdHggPSBrZXJuZWxfY29udGV4dChndC0+aTkxNSk7CiAJaWYg
KCFjdHgpCiAJCXJldHVybiAtRU5PTUVNOwogCkBAIC0yMDA1LDcgKzIwMDQsNyBAQCBzdGF0aWMg
aW50IG1hc2tfdmlydHVhbF9lbmdpbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJ
aWYgKGVycikKIAkJZ290byBvdXRfcHV0OwogCi0JZXJyID0gaWd0X2xpdmVfdGVzdF9iZWdpbigm
dCwgaTkxNSwgX19mdW5jX18sIHZlLT5lbmdpbmUtPm5hbWUpOworCWVyciA9IGlndF9saXZlX3Rl
c3RfYmVnaW4oJnQsIGd0LT5pOTE1LCBfX2Z1bmNfXywgdmUtPmVuZ2luZS0+bmFtZSk7CiAJaWYg
KGVycikKIAkJZ290byBvdXRfdW5waW47CiAKQEAgLTIwMzYsNyArMjAzNSw3IEBAIHN0YXRpYyBp
bnQgbWFza192aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJ
CQkgIHJlcXVlc3Rbbl0tPmZlbmNlLmNvbnRleHQsCiAJCQkJICByZXF1ZXN0W25dLT5mZW5jZS5z
ZXFubyk7CiAJCQlHRU1fVFJBQ0VfRFVNUCgpOwotCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZCgmaTkx
NS0+Z3QpOworCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CiAJCQllcnIgPSAtRUlPOwogCQkJ
Z290byBvdXQ7CiAJCX0KQEAgLTIwNTIsNyArMjA1MSw3IEBAIHN0YXRpYyBpbnQgbWFza192aXJ0
dWFsX2VuZ2luZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAogCWVyciA9IGlndF9s
aXZlX3Rlc3RfZW5kKCZ0KTsKIG91dDoKLQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCisJaWYg
KGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KSkKIAkJZXJyID0gLUVJTzsKIAogCWZvciAobiA9IDA7
IG4gPCBuc2libGluZzsgbisrKQpAQCAtMjA2OSwxMyArMjA2OCwxMiBAQCBzdGF0aWMgaW50IG1h
c2tfdmlydHVhbF9lbmdpbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAKIHN0YXRp
YyBpbnQgbGl2ZV92aXJ0dWFsX21hc2sodm9pZCAqYXJnKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gYXJnOworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CiAJc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqc2libGluZ3NbTUFYX0VOR0lORV9JTlNUQU5DRSArIDFdOwotCXN0
cnVjdCBpbnRlbF9ndCAqZ3QgPSAmaTkxNS0+Z3Q7CiAJdW5zaWduZWQgaW50IGNsYXNzLCBpbnN0
OwogCWludCBlcnI7CiAKLQlpZiAoVVNFU19HVUNfU1VCTUlTU0lPTihpOTE1KSkKKwlpZiAoVVNF
U19HVUNfU1VCTUlTU0lPTihndC0+aTkxNSkpCiAJCXJldHVybiAwOwogCiAJZm9yIChjbGFzcyA9
IDA7IGNsYXNzIDw9IE1BWF9FTkdJTkVfQ0xBU1M7IGNsYXNzKyspIHsKQEAgLTIwOTEsNyArMjA4
OSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV92aXJ0dWFsX21hc2sodm9pZCAqYXJnKQogCQlpZiAobnNp
YmxpbmcgPCAyKQogCQkJY29udGludWU7CiAKLQkJZXJyID0gbWFza192aXJ0dWFsX2VuZ2luZShp
OTE1LCBzaWJsaW5ncywgbnNpYmxpbmcpOworCQllcnIgPSBtYXNrX3ZpcnR1YWxfZW5naW5lKGd0
LCBzaWJsaW5ncywgbnNpYmxpbmcpOwogCQlpZiAoZXJyKQogCQkJcmV0dXJuIGVycjsKIAl9CkBA
IC0yMDk5LDcgKzIwOTcsNyBAQCBzdGF0aWMgaW50IGxpdmVfdmlydHVhbF9tYXNrKHZvaWQgKmFy
ZykKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGludCBwcmVzZXJ2ZWRfdmlydHVhbF9lbmdpbmUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCitzdGF0aWMgaW50IHByZXNlcnZlZF92aXJ0
dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCQkJCSAgICBzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICoqc2libGluZ3MsCiAJCQkJICAgIHVuc2lnbmVkIGludCBuc2libGluZykKIHsKQEAg
LTIxMTIsNyArMjExMCw3IEBAIHN0YXRpYyBpbnQgcHJlc2VydmVkX3ZpcnR1YWxfZW5naW5lKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCWludCBlcnIgPSAwOwogCXUzMiAqY3M7CiAK
LQljdHggPSBrZXJuZWxfY29udGV4dChpOTE1KTsKKwljdHggPSBrZXJuZWxfY29udGV4dChndC0+
aTkxNSk7CiAJaWYgKCFjdHgpCiAJCXJldHVybiAtRU5PTUVNOwogCkBAIC0yMTMyLDcgKzIxMzAs
NyBAQCBzdGF0aWMgaW50IHByZXNlcnZlZF92aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKIAlpZiAoZXJyKQogCQlnb3RvIG91dF9wdXQ7CiAKLQllcnIgPSBpZ3Rf
bGl2ZV90ZXN0X2JlZ2luKCZ0LCBpOTE1LCBfX2Z1bmNfXywgdmUtPmVuZ2luZS0+bmFtZSk7CisJ
ZXJyID0gaWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgZ3QtPmk5MTUsIF9fZnVuY19fLCB2ZS0+ZW5n
aW5lLT5uYW1lKTsKIAlpZiAoZXJyKQogCQlnb3RvIG91dF91bnBpbjsKIApAQCAtMjIxMiw5ICsy
MjEwLDggQEAgc3RhdGljIGludCBwcmVzZXJ2ZWRfdmlydHVhbF9lbmdpbmUoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsCiAKIHN0YXRpYyBpbnQgbGl2ZV92aXJ0dWFsX3ByZXNlcnZlZCh2
b2lkICphcmcpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CisJc3Ry
dWN0IGludGVsX2d0ICpndCA9IGFyZzsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpzaWJsaW5n
c1tNQVhfRU5HSU5FX0lOU1RBTkNFICsgMV07Ci0Jc3RydWN0IGludGVsX2d0ICpndCA9ICZpOTE1
LT5ndDsKIAl1bnNpZ25lZCBpbnQgY2xhc3MsIGluc3Q7CiAKIAkvKgpAQCAtMjIyMywxMSArMjIy
MCwxMSBAQCBzdGF0aWMgaW50IGxpdmVfdmlydHVhbF9wcmVzZXJ2ZWQodm9pZCAqYXJnKQogCSAq
IGFyZSBwcmVzZXJ2ZWQuCiAJICovCiAKLQlpZiAoVVNFU19HVUNfU1VCTUlTU0lPTihpOTE1KSkK
KwlpZiAoVVNFU19HVUNfU1VCTUlTU0lPTihndC0+aTkxNSkpCiAJCXJldHVybiAwOwogCiAJLyog
QXMgd2UgdXNlIENTX0dQUiB3ZSBjYW5ub3QgcnVuIGJlZm9yZSB0aGV5IGV4aXN0ZWQgb24gYWxs
IGVuZ2luZXMuICovCi0JaWYgKElOVEVMX0dFTihpOTE1KSA8IDkpCisJaWYgKElOVEVMX0dFTihn
dC0+aTkxNSkgPCA5KQogCQlyZXR1cm4gMDsKIAogCWZvciAoY2xhc3MgPSAwOyBjbGFzcyA8PSBN
QVhfRU5HSU5FX0NMQVNTOyBjbGFzcysrKSB7CkBAIC0yMjQzLDcgKzIyNDAsNyBAQCBzdGF0aWMg
aW50IGxpdmVfdmlydHVhbF9wcmVzZXJ2ZWQodm9pZCAqYXJnKQogCQlpZiAobnNpYmxpbmcgPCAy
KQogCQkJY29udGludWU7CiAKLQkJZXJyID0gcHJlc2VydmVkX3ZpcnR1YWxfZW5naW5lKGk5MTUs
IHNpYmxpbmdzLCBuc2libGluZyk7CisJCWVyciA9IHByZXNlcnZlZF92aXJ0dWFsX2VuZ2luZShn
dCwgc2libGluZ3MsIG5zaWJsaW5nKTsKIAkJaWYgKGVycikKIAkJCXJldHVybiBlcnI7CiAJfQpA
QCAtMjI1MSw3ICsyMjQ4LDcgQEAgc3RhdGljIGludCBsaXZlX3ZpcnR1YWxfcHJlc2VydmVkKHZv
aWQgKmFyZykKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGludCBib25kX3ZpcnR1YWxfZW5naW5l
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAorc3RhdGljIGludCBib25kX3ZpcnR1YWxf
ZW5naW5lKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCiAJCQkgICAgICAgdW5zaWduZWQgaW50IGNsYXNz
LAogCQkJICAgICAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKipzaWJsaW5ncywKIAkJCSAgICAg
ICB1bnNpZ25lZCBpbnQgbnNpYmxpbmcsCkBAIC0yMjY3LDEzICsyMjY0LDEzIEBAIHN0YXRpYyBp
bnQgYm9uZF92aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAog
CUdFTV9CVUdfT04obnNpYmxpbmcgPj0gQVJSQVlfU0laRShycSkgLSAxKTsKIAotCWN0eCA9IGtl
cm5lbF9jb250ZXh0KGk5MTUpOworCWN0eCA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKIAlp
ZiAoIWN0eCkKIAkJcmV0dXJuIC1FTk9NRU07CiAKIAllcnIgPSAwOwogCXJxWzBdID0gRVJSX1BU
UigtRU5PTUVNKTsKLQlmb3JfZWFjaF9lbmdpbmUobWFzdGVyLCBpOTE1LCBpZCkgeworCWZvcl9l
YWNoX2VuZ2luZShtYXN0ZXIsIGd0LT5pOTE1LCBpZCkgewogCQlzdHJ1Y3QgaTkxNV9zd19mZW5j
ZSBmZW5jZSA9IHt9OwogCiAJCWlmIChtYXN0ZXItPmNsYXNzID09IGNsYXNzKQpAQCAtMjM3OCw3
ICsyMzc1LDcgQEAgc3RhdGljIGludCBib25kX3ZpcnR1YWxfZW5naW5lKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1LAogb3V0OgogCWZvciAobiA9IDA7ICFJU19FUlIocnFbbl0pOyBuKysp
CiAJCWk5MTVfcmVxdWVzdF9wdXQocnFbbl0pOwotCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkK
KwlpZiAoaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpKQogCQllcnIgPSAtRUlPOwogCiAJa2VybmVs
X2NvbnRleHRfY2xvc2UoY3R4KTsKQEAgLTIzOTUsMTMgKzIzOTIsMTIgQEAgc3RhdGljIGludCBs
aXZlX3ZpcnR1YWxfYm9uZCh2b2lkICphcmcpCiAJCXsgInNjaGVkdWxlIiwgQk9ORF9TQ0hFRFVM
RSB9LAogCQl7IH0sCiAJfTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsK
KwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKnNp
YmxpbmdzW01BWF9FTkdJTkVfSU5TVEFOQ0UgKyAxXTsKLQlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0g
Jmk5MTUtPmd0OwogCXVuc2lnbmVkIGludCBjbGFzcywgaW5zdDsKIAlpbnQgZXJyOwogCi0JaWYg
KFVTRVNfR1VDX1NVQk1JU1NJT04oaTkxNSkpCisJaWYgKFVTRVNfR1VDX1NVQk1JU1NJT04oZ3Qt
Pmk5MTUpKQogCQlyZXR1cm4gMDsKIAogCWZvciAoY2xhc3MgPSAwOyBjbGFzcyA8PSBNQVhfRU5H
SU5FX0NMQVNTOyBjbGFzcysrKSB7CkBAIC0yNDIwLDcgKzI0MTYsNyBAQCBzdGF0aWMgaW50IGxp
dmVfdmlydHVhbF9ib25kKHZvaWQgKmFyZykKIAkJCWNvbnRpbnVlOwogCiAJCWZvciAocCA9IHBo
YXNlczsgcC0+bmFtZTsgcCsrKSB7Ci0JCQllcnIgPSBib25kX3ZpcnR1YWxfZW5naW5lKGk5MTUs
CisJCQllcnIgPSBib25kX3ZpcnR1YWxfZW5naW5lKGd0LAogCQkJCQkJICBjbGFzcywgc2libGlu
Z3MsIG5zaWJsaW5nLAogCQkJCQkJICBwLT5mbGFncyk7CiAJCQlpZiAoZXJyKSB7CkBAIC0yNDYy
LDcgKzI0NTgsNyBAQCBpbnQgaW50ZWxfZXhlY2xpc3RzX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogCWlmIChpbnRlbF9ndF9pc193ZWRnZWQoJmk5MTUtPmd0
KSkKIAkJcmV0dXJuIDA7CiAKLQlyZXR1cm4gaTkxNV9saXZlX3N1YnRlc3RzKHRlc3RzLCBpOTE1
KTsKKwlyZXR1cm4gaW50ZWxfZ3RfbGl2ZV9zdWJ0ZXN0cyh0ZXN0cywgJmk5MTUtPmd0KTsKIH0K
IAogc3RhdGljIHZvaWQgaGV4ZHVtcChjb25zdCB2b2lkICpidWYsIHNpemVfdCBsZW4pCi0tIAoy
LjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCklu
dGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

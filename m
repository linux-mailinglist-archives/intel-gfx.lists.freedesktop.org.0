Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 2C0A31B4A24
	for <lists+intel-gfx@lfdr.de>; Wed, 22 Apr 2020 18:19:28 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 677D96EA31;
	Wed, 22 Apr 2020 16:19:26 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga18.intel.com (mga18.intel.com [134.134.136.126])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6584D6EA30
 for <intel-gfx@lists.freedesktop.org>; Wed, 22 Apr 2020 16:19:24 +0000 (UTC)
IronPort-SDR: Fx3/qm/qFeIpUXctfEK4S1qiO9bB4dQhA1GOFLaDUHp0qDnV+8agbJTbxoUbHwNZmVZaquwZLk
 rUc2FdYO3WXg==
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga003.fm.intel.com ([10.253.24.29])
 by orsmga106.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 22 Apr 2020 09:19:23 -0700
IronPort-SDR: Y8TY4bfknC7e0a80nBNPdt0LXlAdVMeKZ3sJZl46vh8uL+1BHvlIlgFIZSUMkyqRsL1HUL2ixN
 0PyO5vFj94TQ==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.73,304,1583222400"; d="scan'208";a="300961752"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by FMSMGA003.fm.intel.com with SMTP; 22 Apr 2020 09:19:21 -0700
Received: by stinkbox (sSMTP sendmail emulation);
 Wed, 22 Apr 2020 19:19:20 +0300
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 22 Apr 2020 19:19:13 +0300
Message-Id: <20200422161917.17389-2-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.24.1
In-Reply-To: <20200422161917.17389-1-ville.syrjala@linux.intel.com>
References: <20200422161917.17389-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v3 2/6] drm/i915: Flatten a bunch of the pfit
 functions
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KCk1v
c3Qgb2YgdGhlIHBmaXQgZnVuY3Rpb25zIGFyZSBvZiB0aGUgZm9ybToKCmZ1bmMoKQp7CglpZiAo
cGZpdF9lbmFibGVkKSB7CgkJLi4uCgl9Cn0KCkZsaXAgdGhlIHBmaXRfZW5hYmxlZCBjaGVjayBh
cm91bmQgdG8gZmxhdHRlbiB0aGUgZnVuY3Rpb25zLgoKQW5kIHdoaWxlIHdlJ3JlIHRvdWNoaW5n
IGFsbCB0aGlzIGxldCdzIGRvIHRoZSB1c3VhbApzL3BpcGVfY29uZmlnL2NydGNfc3RhdGUvIHJl
cGxhY2VtZW50LgoKUmV2aWV3ZWQtYnk6IE1hbmFzaSBOYXZhcmUgPG1hbmFzaS5kLm5hdmFyZUBp
bnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBs
aW51eC5pbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
aXNwbGF5LmMgfCAyMzUgKysrKysrKysrLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDExNiBp
bnNlcnRpb25zKCspLCAxMTkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRleCAzNzVmM2ZmMTY0MmYuLjk2ZDA3NjhlY2Y1ZCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTYy
MjIsNDMgKzYyMjIsNDMgQEAgc3RhdGljIHZvaWQgc2tsX3BmaXRfZW5hYmxlKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+
cGlwZTsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zY2FsZXJfc3RhdGUgKnNjYWxlcl9zdGF0
ZSA9CiAJCSZjcnRjX3N0YXRlLT5zY2FsZXJfc3RhdGU7CisJdTE2IHV2X3JnYl9ocGhhc2UsIHV2
X3JnYl92cGhhc2U7CisJaW50IHBmaXRfdywgcGZpdF9oLCBoc2NhbGUsIHZzY2FsZTsKKwl1bnNp
Z25lZCBsb25nIGlycWZsYWdzOworCWludCBpZDsKIAotCWlmIChjcnRjX3N0YXRlLT5wY2hfcGZp
dC5lbmFibGVkKSB7Ci0JCXUxNiB1dl9yZ2JfaHBoYXNlLCB1dl9yZ2JfdnBoYXNlOwotCQlpbnQg
cGZpdF93LCBwZml0X2gsIGhzY2FsZSwgdnNjYWxlOwotCQl1bnNpZ25lZCBsb25nIGlycWZsYWdz
OwotCQlpbnQgaWQ7CisJaWYgKCFjcnRjX3N0YXRlLT5wY2hfcGZpdC5lbmFibGVkKQorCQlyZXR1
cm47CiAKLQkJaWYgKGRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLAotCQkJCWNydGNfc3RhdGUt
PnNjYWxlcl9zdGF0ZS5zY2FsZXJfaWQgPCAwKSkKLQkJCXJldHVybjsKKwlpZiAoZHJtX1dBUk5f
T04oJmRldl9wcml2LT5kcm0sCisJCQljcnRjX3N0YXRlLT5zY2FsZXJfc3RhdGUuc2NhbGVyX2lk
IDwgMCkpCisJCXJldHVybjsKIAotCQlwZml0X3cgPSAoY3J0Y19zdGF0ZS0+cGNoX3BmaXQuc2l6
ZSA+PiAxNikgJiAweEZGRkY7Ci0JCXBmaXRfaCA9IGNydGNfc3RhdGUtPnBjaF9wZml0LnNpemUg
JiAweEZGRkY7CisJcGZpdF93ID0gKGNydGNfc3RhdGUtPnBjaF9wZml0LnNpemUgPj4gMTYpICYg
MHhGRkZGOworCXBmaXRfaCA9IGNydGNfc3RhdGUtPnBjaF9wZml0LnNpemUgJiAweEZGRkY7CiAK
LQkJaHNjYWxlID0gKGNydGNfc3RhdGUtPnBpcGVfc3JjX3cgPDwgMTYpIC8gcGZpdF93OwotCQl2
c2NhbGUgPSAoY3J0Y19zdGF0ZS0+cGlwZV9zcmNfaCA8PCAxNikgLyBwZml0X2g7CisJaHNjYWxl
ID0gKGNydGNfc3RhdGUtPnBpcGVfc3JjX3cgPDwgMTYpIC8gcGZpdF93OworCXZzY2FsZSA9IChj
cnRjX3N0YXRlLT5waXBlX3NyY19oIDw8IDE2KSAvIHBmaXRfaDsKIAotCQl1dl9yZ2JfaHBoYXNl
ID0gc2tsX3NjYWxlcl9jYWxjX3BoYXNlKDEsIGhzY2FsZSwgZmFsc2UpOwotCQl1dl9yZ2JfdnBo
YXNlID0gc2tsX3NjYWxlcl9jYWxjX3BoYXNlKDEsIHZzY2FsZSwgZmFsc2UpOworCXV2X3JnYl9o
cGhhc2UgPSBza2xfc2NhbGVyX2NhbGNfcGhhc2UoMSwgaHNjYWxlLCBmYWxzZSk7CisJdXZfcmdi
X3ZwaGFzZSA9IHNrbF9zY2FsZXJfY2FsY19waGFzZSgxLCB2c2NhbGUsIGZhbHNlKTsKIAotCQlp
ZCA9IHNjYWxlcl9zdGF0ZS0+c2NhbGVyX2lkOworCWlkID0gc2NhbGVyX3N0YXRlLT5zY2FsZXJf
aWQ7CiAKLQkJc3Bpbl9sb2NrX2lycXNhdmUoJmRldl9wcml2LT51bmNvcmUubG9jaywgaXJxZmxh
Z3MpOworCXNwaW5fbG9ja19pcnFzYXZlKCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZsYWdz
KTsKIAotCQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgU0tMX1BTX0NUUkwocGlwZSwgaWQp
LCBQU19TQ0FMRVJfRU4gfAotCQkJCSAgUFNfRklMVEVSX01FRElVTSB8IHNjYWxlcl9zdGF0ZS0+
c2NhbGVyc1tpZF0ubW9kZSk7Ci0JCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBTS0xfUFNf
VlBIQVNFKHBpcGUsIGlkKSwKLQkJCQkgIFBTX1lfUEhBU0UoMCkgfCBQU19VVl9SR0JfUEhBU0Uo
dXZfcmdiX3ZwaGFzZSkpOwotCQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgU0tMX1BTX0hQ
SEFTRShwaXBlLCBpZCksCi0JCQkJICBQU19ZX1BIQVNFKDApIHwgUFNfVVZfUkdCX1BIQVNFKHV2
X3JnYl9ocGhhc2UpKTsKLQkJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFNLTF9QU19XSU5f
UE9TKHBpcGUsIGlkKSwKLQkJCQkgIGNydGNfc3RhdGUtPnBjaF9wZml0LnBvcyk7Ci0JCWludGVs
X2RlX3dyaXRlX2Z3KGRldl9wcml2LCBTS0xfUFNfV0lOX1NaKHBpcGUsIGlkKSwKLQkJCQkgIGNy
dGNfc3RhdGUtPnBjaF9wZml0LnNpemUpOworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBT
S0xfUFNfQ1RSTChwaXBlLCBpZCksIFBTX1NDQUxFUl9FTiB8CisJCQkgIFBTX0ZJTFRFUl9NRURJ
VU0gfCBzY2FsZXJfc3RhdGUtPnNjYWxlcnNbaWRdLm1vZGUpOworCWludGVsX2RlX3dyaXRlX2Z3
KGRldl9wcml2LCBTS0xfUFNfVlBIQVNFKHBpcGUsIGlkKSwKKwkJCSAgUFNfWV9QSEFTRSgwKSB8
IFBTX1VWX1JHQl9QSEFTRSh1dl9yZ2JfdnBoYXNlKSk7CisJaW50ZWxfZGVfd3JpdGVfZncoZGV2
X3ByaXYsIFNLTF9QU19IUEhBU0UocGlwZSwgaWQpLAorCQkJICBQU19ZX1BIQVNFKDApIHwgUFNf
VVZfUkdCX1BIQVNFKHV2X3JnYl9ocGhhc2UpKTsKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJp
diwgU0tMX1BTX1dJTl9QT1MocGlwZSwgaWQpLAorCQkJICBjcnRjX3N0YXRlLT5wY2hfcGZpdC5w
b3MpOworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBTS0xfUFNfV0lOX1NaKHBpcGUsIGlk
KSwKKwkJCSAgY3J0Y19zdGF0ZS0+cGNoX3BmaXQuc2l6ZSk7CiAKLQkJc3Bpbl91bmxvY2tfaXJx
cmVzdG9yZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7Ci0JfQorCXNwaW5fdW5s
b2NrX2lycXJlc3RvcmUoJmRldl9wcml2LT51bmNvcmUubG9jaywgaXJxZmxhZ3MpOwogfQogCiBz
dGF0aWMgdm9pZCBpbGtfcGZpdF9lbmFibGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUpCkBAIC02MjY3LDIyICs2MjY3LDIzIEBAIHN0YXRpYyB2b2lkIGlsa19wZml0
X2VuYWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsK
IAllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAKLQlpZiAoY3J0Y19zdGF0ZS0+cGNoX3Bm
aXQuZW5hYmxlZCkgewotCQkvKiBGb3JjZSB1c2Ugb2YgaGFyZC1jb2RlZCBmaWx0ZXIgY29lZmZp
Y2llbnRzCi0JCSAqIGFzIHNvbWUgcHJlLXByb2dyYW1tZWQgdmFsdWVzIGFyZSBicm9rZW4sCi0J
CSAqIGUuZy4geDIwMS4KLQkJICovCi0JCWlmIChJU19JVllCUklER0UoZGV2X3ByaXYpIHx8IElT
X0hBU1dFTEwoZGV2X3ByaXYpKQotCQkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIFBGX0NUTChw
aXBlKSwKLQkJCQkgICAgICAgUEZfRU5BQkxFIHwgUEZfRklMVEVSX01FRF8zeDMgfCBQRl9QSVBF
X1NFTF9JVkIocGlwZSkpOwotCQllbHNlCi0JCQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgUEZf
Q1RMKHBpcGUpLAotCQkJCSAgICAgICBQRl9FTkFCTEUgfCBQRl9GSUxURVJfTUVEXzN4Myk7Ci0J
CWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBQRl9XSU5fUE9TKHBpcGUpLAotCQkJICAgICAgIGNy
dGNfc3RhdGUtPnBjaF9wZml0LnBvcyk7Ci0JCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBQRl9X
SU5fU1oocGlwZSksCi0JCQkgICAgICAgY3J0Y19zdGF0ZS0+cGNoX3BmaXQuc2l6ZSk7Ci0JfQor
CWlmICghY3J0Y19zdGF0ZS0+cGNoX3BmaXQuZW5hYmxlZCkKKwkJcmV0dXJuOworCisJLyogRm9y
Y2UgdXNlIG9mIGhhcmQtY29kZWQgZmlsdGVyIGNvZWZmaWNpZW50cworCSAqIGFzIHNvbWUgcHJl
LXByb2dyYW1tZWQgdmFsdWVzIGFyZSBicm9rZW4sCisJICogZS5nLiB4MjAxLgorCSAqLworCWlm
IChJU19JVllCUklER0UoZGV2X3ByaXYpIHx8IElTX0hBU1dFTEwoZGV2X3ByaXYpKQorCQlpbnRl
bF9kZV93cml0ZShkZXZfcHJpdiwgUEZfQ1RMKHBpcGUpLCBQRl9FTkFCTEUgfAorCQkJICAgICAg
IFBGX0ZJTFRFUl9NRURfM3gzIHwgUEZfUElQRV9TRUxfSVZCKHBpcGUpKTsKKwllbHNlCisJCWlu
dGVsX2RlX3dyaXRlKGRldl9wcml2LCBQRl9DVEwocGlwZSksIFBGX0VOQUJMRSB8CisJCQkgICAg
ICAgUEZfRklMVEVSX01FRF8zeDMpOworCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBQRl9XSU5f
UE9TKHBpcGUpLAorCQkgICAgICAgY3J0Y19zdGF0ZS0+cGNoX3BmaXQucG9zKTsKKwlpbnRlbF9k
ZV93cml0ZShkZXZfcHJpdiwgUEZfV0lOX1NaKHBpcGUpLAorCQkgICAgICAgY3J0Y19zdGF0ZS0+
cGNoX3BmaXQuc2l6ZSk7CiB9CiAKIHZvaWQgaHN3X2VuYWJsZV9pcHMoY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCkBAIC03MDk5LDExICs3MTAwLDEyIEBAIHZvaWQg
aWxrX3BmaXRfZGlzYWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNf
c3RhdGUpCiAKIAkvKiBUbyBhdm9pZCB1cHNldHRpbmcgdGhlIHBvd2VyIHdlbGwgb24gaGFzd2Vs
bCBvbmx5IGRpc2FibGUgdGhlIHBmaXQgaWYKIAkgKiBpdCdzIGluIHVzZS4gVGhlIGh3IHN0YXRl
IGNvZGUgd2lsbCBtYWtlIHN1cmUgd2UgZ2V0IHRoaXMgcmlnaHQuICovCi0JaWYgKG9sZF9jcnRj
X3N0YXRlLT5wY2hfcGZpdC5lbmFibGVkKSB7Ci0JCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBQ
Rl9DVEwocGlwZSksIDApOwotCQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgUEZfV0lOX1BPUyhw
aXBlKSwgMCk7Ci0JCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBQRl9XSU5fU1oocGlwZSksIDAp
OwotCX0KKwlpZiAoIW9sZF9jcnRjX3N0YXRlLT5wY2hfcGZpdC5lbmFibGVkKQorCQlyZXR1cm47
CisKKwlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgUEZfQ1RMKHBpcGUpLCAwKTsKKwlpbnRlbF9k
ZV93cml0ZShkZXZfcHJpdiwgUEZfV0lOX1BPUyhwaXBlKSwgMCk7CisJaW50ZWxfZGVfd3JpdGUo
ZGV2X3ByaXYsIFBGX1dJTl9TWihwaXBlKSwgMCk7CiB9CiAKIHN0YXRpYyB2b2lkIGlsa19jcnRj
X2Rpc2FibGUoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCkBAIC03OTMxLDQwICs3
OTMzLDM2IEBAIHN0YXRpYyBib29sIGludGVsX2NydGNfc3VwcG9ydHNfZG91YmxlX3dpZGUoY29u
c3Qgc3RydWN0IGludGVsX2NydGMgKmNydGMpCiAJCShjcnRjLT5waXBlID09IFBJUEVfQSB8fCBJ
U19JOTE1RyhkZXZfcHJpdikpOwogfQogCi1zdGF0aWMgdTMyIGlsa19waXBlX3BpeGVsX3JhdGUo
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQorc3RhdGljIHUzMiBp
bGtfcGlwZV9waXhlbF9yYXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlKQogewotCXUzMiBwaXhlbF9yYXRlOwotCi0JcGl4ZWxfcmF0ZSA9IHBpcGVfY29uZmlnLT5o
dy5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2s7CisJdTMyIHBpeGVsX3JhdGUgPSBjcnRjX3N0YXRl
LT5ody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2s7CisJdTMyIHBmaXRfc2l6ZSA9IGNydGNfc3Rh
dGUtPnBjaF9wZml0LnNpemU7CisJdTY0IHBpcGVfdywgcGlwZV9oLCBwZml0X3csIHBmaXRfaDsK
IAogCS8qCiAJICogV2Ugb25seSB1c2UgSUYtSUQgaW50ZXJsYWNpbmcuIElmIHdlIGV2ZXIgdXNl
CiAJICogUEYtSUQgd2UnbGwgbmVlZCB0byBhZGp1c3QgdGhlIHBpeGVsX3JhdGUgaGVyZS4KIAkg
Ki8KIAotCWlmIChwaXBlX2NvbmZpZy0+cGNoX3BmaXQuZW5hYmxlZCkgewotCQl1NjQgcGlwZV93
LCBwaXBlX2gsIHBmaXRfdywgcGZpdF9oOwotCQl1MzIgcGZpdF9zaXplID0gcGlwZV9jb25maWct
PnBjaF9wZml0LnNpemU7CisJaWYgKCFjcnRjX3N0YXRlLT5wY2hfcGZpdC5lbmFibGVkKQorCQly
ZXR1cm4gcGl4ZWxfcmF0ZTsKIAotCQlwaXBlX3cgPSBwaXBlX2NvbmZpZy0+cGlwZV9zcmNfdzsK
LQkJcGlwZV9oID0gcGlwZV9jb25maWctPnBpcGVfc3JjX2g7CisJcGlwZV93ID0gY3J0Y19zdGF0
ZS0+cGlwZV9zcmNfdzsKKwlwaXBlX2ggPSBjcnRjX3N0YXRlLT5waXBlX3NyY19oOwogCi0JCXBm
aXRfdyA9IChwZml0X3NpemUgPj4gMTYpICYgMHhGRkZGOwotCQlwZml0X2ggPSBwZml0X3NpemUg
JiAweEZGRkY7Ci0JCWlmIChwaXBlX3cgPCBwZml0X3cpCi0JCQlwaXBlX3cgPSBwZml0X3c7Ci0J
CWlmIChwaXBlX2ggPCBwZml0X2gpCi0JCQlwaXBlX2ggPSBwZml0X2g7CisJcGZpdF93ID0gKHBm
aXRfc2l6ZSA+PiAxNikgJiAweEZGRkY7CisJcGZpdF9oID0gcGZpdF9zaXplICYgMHhGRkZGOwor
CWlmIChwaXBlX3cgPCBwZml0X3cpCisJCXBpcGVfdyA9IHBmaXRfdzsKKwlpZiAocGlwZV9oIDwg
cGZpdF9oKQorCQlwaXBlX2ggPSBwZml0X2g7CiAKLQkJaWYgKGRybV9XQVJOX09OKHBpcGVfY29u
ZmlnLT51YXBpLmNydGMtPmRldiwKLQkJCQkhcGZpdF93IHx8ICFwZml0X2gpKQotCQkJcmV0dXJu
IHBpeGVsX3JhdGU7CisJaWYgKGRybV9XQVJOX09OKGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2
LAorCQkJIXBmaXRfdyB8fCAhcGZpdF9oKSkKKwkJcmV0dXJuIHBpeGVsX3JhdGU7CiAKLQkJcGl4
ZWxfcmF0ZSA9IGRpdl91NjQobXVsX3UzMl91MzIocGl4ZWxfcmF0ZSwgcGlwZV93ICogcGlwZV9o
KSwKLQkJCQkgICAgIHBmaXRfdyAqIHBmaXRfaCk7Ci0JfQotCi0JcmV0dXJuIHBpeGVsX3JhdGU7
CisJcmV0dXJuIGRpdl91NjQobXVsX3UzMl91MzIocGl4ZWxfcmF0ZSwgcGlwZV93ICogcGlwZV9o
KSwKKwkJICAgICAgIHBmaXRfdyAqIHBmaXRfaCk7CiB9CiAKIHN0YXRpYyB2b2lkIGludGVsX2Ny
dGNfY29tcHV0ZV9waXhlbF9yYXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
KQpAQCAtOTE1OCw5ICs5MTU2LDkgQEAgc3RhdGljIGJvb2wgaTl4eF9oYXNfcGZpdChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCUlTX1BJTkVWSUVXKGRldl9wcml2KSB8fCBJ
U19NT0JJTEUoZGV2X3ByaXYpOwogfQogCi1zdGF0aWMgdm9pZCBpOXh4X2dldF9wZml0X2NvbmZp
ZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKLQkJCQkgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KnBpcGVfY29uZmlnKQorc3RhdGljIHZvaWQgaTl4eF9nZXRfcGZpdF9jb25maWcoc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMg
PSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJdTMyIHRtcDsK
IApAQCAtOTE4MCw5ICs5MTc4LDkgQEAgc3RhdGljIHZvaWQgaTl4eF9nZXRfcGZpdF9jb25maWco
c3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQlyZXR1cm47CiAJfQogCi0JcGlwZV9jb25maWct
PmdtY2hfcGZpdC5jb250cm9sID0gdG1wOwotCXBpcGVfY29uZmlnLT5nbWNoX3BmaXQucGdtX3Jh
dGlvcyA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsCi0JCQkJCQkJICBQRklUX1BHTV9SQVRJT1Mp
OworCWNydGNfc3RhdGUtPmdtY2hfcGZpdC5jb250cm9sID0gdG1wOworCWNydGNfc3RhdGUtPmdt
Y2hfcGZpdC5wZ21fcmF0aW9zID0KKwkJaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgUEZJVF9QR01f
UkFUSU9TKTsKIH0KIAogc3RhdGljIHZvaWQgdmx2X2NydGNfY2xvY2tfZ2V0KHN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjLApAQCAtOTQzMiw3ICs5NDMwLDcgQEAgc3RhdGljIGJvb2wgaTl4eF9nZXRf
cGlwZV9jb25maWcoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJaW50ZWxfZ2V0X3BpcGVfdGlt
aW5ncyhjcnRjLCBwaXBlX2NvbmZpZyk7CiAJaW50ZWxfZ2V0X3BpcGVfc3JjX3NpemUoY3J0Yywg
cGlwZV9jb25maWcpOwogCi0JaTl4eF9nZXRfcGZpdF9jb25maWcoY3J0YywgcGlwZV9jb25maWcp
OworCWk5eHhfZ2V0X3BmaXRfY29uZmlnKHBpcGVfY29uZmlnKTsKIAogCWlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDQpIHsKIAkJLyogTm8gd2F5IHRvIHJlYWQgaXQgb3V0IG9uIHBpcGVzIEIg
YW5kIEMgKi8KQEAgLTEwNDAyLDM3ICsxMDQwMCwzNyBAQCBzdGF0aWMgdm9pZCBpbGtfZ2V0X2Zk
aV9tX25fY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJCSAgICAgJnBpcGVfY29u
ZmlnLT5mZGlfbV9uLCBOVUxMKTsKIH0KIAotc3RhdGljIHZvaWQgc2tsX2dldF9wZml0X2NvbmZp
ZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKLQkJCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
cGlwZV9jb25maWcpCitzdGF0aWMgdm9pZCBza2xfZ2V0X3BmaXRfY29uZmlnKHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBj
cnRjLT5iYXNlLmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGRldik7Ci0Jc3RydWN0IGludGVsX2NydGNfc2NhbGVyX3N0YXRlICpzY2FsZXJfc3RhdGUg
PSAmcGlwZV9jb25maWctPnNjYWxlcl9zdGF0ZTsKLQl1MzIgcHNfY3RybCA9IDA7CisJc3RydWN0
IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNl
LmRldik7CisJc3RydWN0IGludGVsX2NydGNfc2NhbGVyX3N0YXRlICpzY2FsZXJfc3RhdGUgPSAm
Y3J0Y19zdGF0ZS0+c2NhbGVyX3N0YXRlOwogCWludCBpZCA9IC0xOwogCWludCBpOwogCiAJLyog
ZmluZCBzY2FsZXIgYXR0YWNoZWQgdG8gdGhpcyBwaXBlICovCiAJZm9yIChpID0gMDsgaSA8IGNy
dGMtPm51bV9zY2FsZXJzOyBpKyspIHsKLQkJcHNfY3RybCA9IGludGVsX2RlX3JlYWQoZGV2X3By
aXYsIFNLTF9QU19DVFJMKGNydGMtPnBpcGUsIGkpKTsKLQkJaWYgKHBzX2N0cmwgJiBQU19TQ0FM
RVJfRU4gJiYgIShwc19jdHJsICYgUFNfUExBTkVfU0VMX01BU0spKSB7Ci0JCQlpZCA9IGk7Ci0J
CQlwaXBlX2NvbmZpZy0+cGNoX3BmaXQuZW5hYmxlZCA9IHRydWU7Ci0JCQlwaXBlX2NvbmZpZy0+
cGNoX3BmaXQucG9zID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwKLQkJCQkJCQkJICBTS0xfUFNf
V0lOX1BPUyhjcnRjLT5waXBlLCBpKSk7Ci0JCQlwaXBlX2NvbmZpZy0+cGNoX3BmaXQuc2l6ZSA9
IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsCi0JCQkJCQkJCSAgIFNLTF9QU19XSU5fU1ooY3J0Yy0+
cGlwZSwgaSkpOwotCQkJc2NhbGVyX3N0YXRlLT5zY2FsZXJzW2ldLmluX3VzZSA9IHRydWU7Ci0J
CQlicmVhazsKLQkJfQorCQl1MzIgdG1wOworCisJCXRtcCA9IGludGVsX2RlX3JlYWQoZGV2X3By
aXYsIFNLTF9QU19DVFJMKGNydGMtPnBpcGUsIGkpKTsKKwkJaWYgKCh0bXAgJiAoUFNfU0NBTEVS
X0VOIHwgUFNfUExBTkVfU0VMX01BU0spKSAhPSBQU19TQ0FMRVJfRU4pCisJCQljb250aW51ZTsK
KworCQlpZCA9IGk7CisJCWNydGNfc3RhdGUtPnBjaF9wZml0LmVuYWJsZWQgPSB0cnVlOworCQlj
cnRjX3N0YXRlLT5wY2hfcGZpdC5wb3MgPQorCQkJaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgU0tM
X1BTX1dJTl9QT1MoY3J0Yy0+cGlwZSwgaSkpOworCQljcnRjX3N0YXRlLT5wY2hfcGZpdC5zaXpl
ID0KKwkJCWludGVsX2RlX3JlYWQoZGV2X3ByaXYsIFNLTF9QU19XSU5fU1ooY3J0Yy0+cGlwZSwg
aSkpOworCQlzY2FsZXJfc3RhdGUtPnNjYWxlcnNbaV0uaW5fdXNlID0gdHJ1ZTsKKwkJYnJlYWs7
CiAJfQogCiAJc2NhbGVyX3N0YXRlLT5zY2FsZXJfaWQgPSBpZDsKLQlpZiAoaWQgPj0gMCkgewor
CWlmIChpZCA+PSAwKQogCQlzY2FsZXJfc3RhdGUtPnNjYWxlcl91c2VycyB8PSAoMSA8PCBTS0xf
Q1JUQ19JTkRFWCk7Ci0JfSBlbHNlIHsKKwllbHNlCiAJCXNjYWxlcl9zdGF0ZS0+c2NhbGVyX3Vz
ZXJzICY9IH4oMSA8PCBTS0xfQ1JUQ19JTkRFWCk7Ci0JfQogfQogCiBzdGF0aWMgdm9pZApAQCAt
MTA1NjgsMzAgKzEwNTY2LDI5IEBAIHNrbF9nZXRfaW5pdGlhbF9wbGFuZV9jb25maWcoc3RydWN0
IGludGVsX2NydGMgKmNydGMsCiAJa2ZyZWUoaW50ZWxfZmIpOwogfQogCi1zdGF0aWMgdm9pZCBp
bGtfZ2V0X3BmaXRfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAotCQkJCXN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKK3N0YXRpYyB2b2lkIGlsa19nZXRfcGZpdF9j
b25maWcoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGRy
bV9kZXZpY2UgKmRldiA9IGNydGMtPmJhc2UuZGV2OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRv
X2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAl1MzIgdG1wOwogCiAJ
dG1wID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgUEZfQ1RMKGNydGMtPnBpcGUpKTsKKwlpZiAo
KHRtcCAmIFBGX0VOQUJMRSkgPT0gMCkKKwkJcmV0dXJuOwogCi0JaWYgKHRtcCAmIFBGX0VOQUJM
RSkgewotCQlwaXBlX2NvbmZpZy0+cGNoX3BmaXQuZW5hYmxlZCA9IHRydWU7Ci0JCXBpcGVfY29u
ZmlnLT5wY2hfcGZpdC5wb3MgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LAotCQkJCQkJCSAgUEZf
V0lOX1BPUyhjcnRjLT5waXBlKSk7Ci0JCXBpcGVfY29uZmlnLT5wY2hfcGZpdC5zaXplID0gaW50
ZWxfZGVfcmVhZChkZXZfcHJpdiwKLQkJCQkJCQkgICBQRl9XSU5fU1ooY3J0Yy0+cGlwZSkpOwor
CWNydGNfc3RhdGUtPnBjaF9wZml0LmVuYWJsZWQgPSB0cnVlOworCWNydGNfc3RhdGUtPnBjaF9w
Zml0LnBvcyA9CisJCWludGVsX2RlX3JlYWQoZGV2X3ByaXYsIFBGX1dJTl9QT1MoY3J0Yy0+cGlw
ZSkpOworCWNydGNfc3RhdGUtPnBjaF9wZml0LnNpemUgPQorCQlpbnRlbF9kZV9yZWFkKGRldl9w
cml2LCBQRl9XSU5fU1ooY3J0Yy0+cGlwZSkpOwogCi0JCS8qIFdlIGN1cnJlbnRseSBkbyBub3Qg
ZnJlZSBhc3NpZ25lbWVudHMgb2YgcGFuZWwgZml0dGVycyBvbgotCQkgKiBpdmIvaHN3IChzaW5j
ZSB3ZSBkb24ndCB1c2UgdGhlIGhpZ2hlciB1cHNjYWxpbmcgbW9kZXMgd2hpY2gKLQkJICogZGlm
ZmVyZW50aWF0ZXMgdGhlbSkgc28ganVzdCBXQVJOIGFib3V0IHRoaXMgY2FzZSBmb3Igbm93LiAq
LwotCQlpZiAoSVNfR0VOKGRldl9wcml2LCA3KSkgewotCQkJZHJtX1dBUk5fT04oZGV2LCAodG1w
ICYgUEZfUElQRV9TRUxfTUFTS19JVkIpICE9Ci0JCQkJICAgIFBGX1BJUEVfU0VMX0lWQihjcnRj
LT5waXBlKSk7Ci0JCX0KLQl9CisJLyoKKwkgKiBXZSBjdXJyZW50bHkgZG8gbm90IGZyZWUgYXNz
aWduZW1lbnRzIG9mIHBhbmVsIGZpdHRlcnMgb24KKwkgKiBpdmIvaHN3IChzaW5jZSB3ZSBkb24n
dCB1c2UgdGhlIGhpZ2hlciB1cHNjYWxpbmcgbW9kZXMgd2hpY2gKKwkgKiBkaWZmZXJlbnRpYXRl
cyB0aGVtKSBzbyBqdXN0IFdBUk4gYWJvdXQgdGhpcyBjYXNlIGZvciBub3cuCisJICovCisJZHJt
X1dBUk5fT04oJmRldl9wcml2LT5kcm0sIElTX0dFTihkZXZfcHJpdiwgNykgJiYKKwkJICAgICh0
bXAgJiBQRl9QSVBFX1NFTF9NQVNLX0lWQikgIT0gUEZfUElQRV9TRUxfSVZCKGNydGMtPnBpcGUp
KTsKIH0KIAogc3RhdGljIGJvb2wgaWxrX2dldF9waXBlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0
YyAqY3J0YywKQEAgLTEwNzAyLDcgKzEwNjk5LDcgQEAgc3RhdGljIGJvb2wgaWxrX2dldF9waXBl
X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAlpbnRlbF9nZXRfcGlwZV90aW1pbmdz
KGNydGMsIHBpcGVfY29uZmlnKTsKIAlpbnRlbF9nZXRfcGlwZV9zcmNfc2l6ZShjcnRjLCBwaXBl
X2NvbmZpZyk7CiAKLQlpbGtfZ2V0X3BmaXRfY29uZmlnKGNydGMsIHBpcGVfY29uZmlnKTsKKwlp
bGtfZ2V0X3BmaXRfY29uZmlnKHBpcGVfY29uZmlnKTsKIAogCXJldCA9IHRydWU7CiAKQEAgLTEx
MTc2LDkgKzExMTczLDkgQEAgc3RhdGljIGJvb2wgaHN3X2dldF9waXBlX2NvbmZpZyhzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YywKIAkJcG93ZXJfZG9tYWluX21hc2sgfD0gQklUX1VMTChwb3dlcl9k
b21haW4pOwogCiAJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkpCi0JCQlza2xfZ2V0X3Bm
aXRfY29uZmlnKGNydGMsIHBpcGVfY29uZmlnKTsKKwkJCXNrbF9nZXRfcGZpdF9jb25maWcocGlw
ZV9jb25maWcpOwogCQllbHNlCi0JCQlpbGtfZ2V0X3BmaXRfY29uZmlnKGNydGMsIHBpcGVfY29u
ZmlnKTsKKwkJCWlsa19nZXRfcGZpdF9jb25maWcocGlwZV9jb25maWcpOwogCX0KIAogCWlmICho
c3dfY3J0Y19zdXBwb3J0c19pcHMoY3J0YykpIHsKLS0gCjIuMjQuMQoKX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJ
bnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Au
b3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

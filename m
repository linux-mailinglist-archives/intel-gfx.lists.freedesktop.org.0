Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 4E4EBA4E2D
	for <lists+intel-gfx@lfdr.de>; Mon,  2 Sep 2019 06:05:00 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9C6D389388;
	Mon,  2 Sep 2019 04:04:58 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C5F8689388
 for <intel-gfx@lists.freedesktop.org>; Mon,  2 Sep 2019 04:04:56 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18339010-1500050 
 for multiple; Mon, 02 Sep 2019 05:03:06 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  2 Sep 2019 05:02:47 +0100
Message-Id: <20190902040303.14195-5-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190902040303.14195-1-chris@chris-wilson.co.uk>
References: <20190902040303.14195-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 05/21] drm/i915: Replace obj->pin_global with
 obj->frontbuffer
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

b2JqLT5waW5fZ2xvYmFsIHdhcyBvcmlnaW5hbCB1c2VkIGFzIGEgbWVhbnMgdG8ga2VlcCB0aGUg
c2hyaW5rZXIgb2ZmCnRoZSBhY3RpdmUgc2Nhbm91dCwgYnV0IHdlIHVzZSB0aGUgdm1hLT5waW5f
Y291bnQgaXRzZWxmIGZvciB0aGF0IGFuZAp0aGUgb2JqLT5mcm9udGJ1ZmZlciB0byBkZWxheSBz
aHJpbmtpbmcgYWN0aXZlIGZyYW1lYnVmZmVycy4gVGhlIG90aGVyCnJvbGUgdGhhdCBvYmotPnBp
bl9nbG9iYWwgZ2FpbmVkIHdhcyBmb3Igc3BvdHRpbmcgZGlzcGxheSBvYmplY3RzIGluc2lkZQpH
RU0gYW5kIHdvcmtpbmcgaGFyZGVyIHRvIGtlZXAgdGhvc2UgY29oZXJlbnQ7IGZvciB3aGljaCB3
ZSBjYW4gYWdhaW4Kc2ltcGx5IGluc3BlY3Qgb2JqLT5mcm9udGJ1ZmZlciBkaXJlY3RseS4KCkNv
bWluZyB1cCBuZXh0LCB3ZSB3aWxsIHdhbnQgdG8gbWFuaXB1bGF0ZSB0aGUgcGluX2dsb2JhbCBj
b3VudGVyCm91dHNpZGUgb2YgdGhlIHByaW5jaXBsZSBsb2Nrcywgc28gd291bGQgbmVlZCB0byBt
YWtlIHBpbl9nbG9iYWwgYXRvbWljLgpIb3dldmVyLCBzaW5jZSBvYmotPmZyb250YnVmZmVyIGlz
IGFscmVhZHkgbWFuYWdlZCBhdG9taWNhbGx5LCBpdCBtYWtlcwpzZW5zZSB0byB1c2UgdGhhdCB0
aGUgcHJpbWFyeSBrZXkgZm9yIGRpc3BsYXkgb2JqZWN0cyBpbnN0ZWFkIG9mIGhhdmluZwpwaW5f
Z2xvYmFsLgoKVmlsbGUgcG9pbnRlZCBvdXQgdGhlIHByaW5jaXBsZSBkaWZmZXJlbmNlIGlzIHRo
YXQgb2JqLT5mcm9udGJ1ZmZlciBpcwpzZXQgZm9yIGFzIGxvbmcgYXMgYW4gaW50ZWxfZnJhbWVi
dWZmZXIgaXMgYXR0YWNoZWQgdG8gYW4gb2JqZWN0LCBidXQKb2JqLT5waW5fZ2xvYmFsIHdhcyBv
bmx5IHJhaXNlZCBmb3IgYXMgbG9uZyBhcyB0aGUgb2JqZWN0IHdhcyBhY3RpdmUuIEluCnByYWN0
aWNlLCB0aGlzIG1lYW5zIHRoYXQgd2UgY29uc2lkZXIgdGhlIG9iamVjdCBhcyBiZWluZyBvbiB0
aGUgc2Nhbm91dApmb3IgbG9uZ2VyIHRoYW4gaXMgc3RyaWN0bHkgcmVxdWlyZWQsIGNhdXNpbmcg
dXMgdG8gYmUgbW9yZSBwcm9hY3RpdmUgaW4KZmx1c2hpbmcgLS0gdGhvdWdoIGl0IHNob3VsZCBi
ZSB0cnVlIHRoYXQgd2Ugd291bGQgaGF2ZSBmbHVzaGVkCmV2ZW50dWFsbHkgd2hlbiB0aGUgYmFj
ayBiZWNhbWUgdGhlIGZyb250LCBleGNlcHQgdGhhdCBvbiB0aGUgZmxpcCBwYXRoCnRoYXQgZmx1
c2ggaXMgYXN5bmMgYnV0IHdoZW4gaGl0IGZyb20gYW5vdGhlciBpb2N0bCBpdCB3aWxsIGJlCnN5
bmNocm9ub3VzLgoKdjI6IGk5MTVfZ2VtX29iamVjdF9pc19mcmFtZWJ1ZmZlcigpCgpTaWduZWQt
b2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IE1pa2Eg
S3VvcHBhbGEgPG1pa2Eua3VvcHBhbGFAbGludXguaW50ZWwuY29tPgpDYzogVmlsbGUgU3lyasOk
bMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyAgfCAgMiArKwogLi4uL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Zyb250YnVmZmVyLmMgIHwgMTMgKysrKystLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jICAgIHwgMzQgKysrKysrLS0tLS0tLS0tLS0tLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oICAgIHwgIDMgKy0KIC4u
Li9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oICB8ICAyIC0tCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYyAgfCAxNSArKystLS0tLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgICAgICAgICAgIHwgMTIgKystLS0t
LQogNyBmaWxlcyBjaGFuZ2VkLCAzMSBpbnNlcnRpb25zKCspLCA1MCBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4IGU2NjFl
MjA5OTExOC4uNWUzYjIyZTNmNjFkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXkuYwpAQCAtMjA4MCw2ICsyMDgwLDggQEAgaW50ZWxfcGluX2FuZF9mZW5j
ZV9mYl9vYmooc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCiAJdTMyIGFsaWdubWVudDsKIAog
CVdBUk5fT04oIW11dGV4X2lzX2xvY2tlZCgmZGV2LT5zdHJ1Y3RfbXV0ZXgpKTsKKwlpZiAoV0FS
Tl9PTighaTkxNV9nZW1fb2JqZWN0X2lzX2ZyYW1lYnVmZmVyKG9iaikpKQorCQlyZXR1cm4gRVJS
X1BUUigtRUlOVkFMKTsKIAogCWFsaWdubWVudCA9IGludGVsX3N1cmZfYWxpZ25tZW50KGZiLCAw
KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mcm9u
dGJ1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mcm9udGJ1ZmZl
ci5jCmluZGV4IDcxOTM3OTc3NGZhNS4uZmM0MGRjMWZkYmNjIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Zyb250YnVmZmVyLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mcm9udGJ1ZmZlci5jCkBAIC0yMjAsMTEgKzIyMCwx
OCBAQCBzdGF0aWMgdm9pZCBmcm9udGJ1ZmZlcl9yZWxlYXNlKHN0cnVjdCBrcmVmICpyZWYpCiB7
CiAJc3RydWN0IGludGVsX2Zyb250YnVmZmVyICpmcm9udCA9CiAJCWNvbnRhaW5lcl9vZihyZWYs
IHR5cGVvZigqZnJvbnQpLCByZWYpOworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmog
PSBmcm9udC0+b2JqOworCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCi0JZnJvbnQtPm9iai0+ZnJv
bnRidWZmZXIgPSBOVUxMOwotCXNwaW5fdW5sb2NrKCZ0b19pOTE1KGZyb250LT5vYmotPmJhc2Uu
ZGV2KS0+ZmJfdHJhY2tpbmcubG9jayk7CisJc3Bpbl9sb2NrKCZvYmotPnZtYS5sb2NrKTsKKwlm
b3JfZWFjaF9nZ3R0X3ZtYSh2bWEsIG9iaikKKwkJdm1hLT5kaXNwbGF5X2FsaWdubWVudCA9IEk5
MTVfR1RUX01JTl9BTElHTk1FTlQ7CisJc3Bpbl91bmxvY2soJm9iai0+dm1hLmxvY2spOwogCi0J
aTkxNV9nZW1fb2JqZWN0X3B1dChmcm9udC0+b2JqKTsKKwlvYmotPmZyb250YnVmZmVyID0gTlVM
TDsKKwlzcGluX3VubG9jaygmdG9faTkxNShvYmotPmJhc2UuZGV2KS0+ZmJfdHJhY2tpbmcubG9j
ayk7CisKKwlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CiAJa2ZyZWUoZnJvbnQpOwogfQogCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMKaW5kZXggOWM1OGU4ZmFj
MWQ5Li42YWY3NDBhNWUzZGIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9kb21haW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
ZG9tYWluLmMKQEAgLTI3LDcgKzI3LDcgQEAgc3RhdGljIHZvaWQgX19pOTE1X2dlbV9vYmplY3Rf
Zmx1c2hfZm9yX2Rpc3BsYXkoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAogdm9p
ZCBpOTE1X2dlbV9vYmplY3RfZmx1c2hfaWZfZGlzcGxheShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqKQogewotCWlmICghUkVBRF9PTkNFKG9iai0+cGluX2dsb2JhbCkpCisJaWYgKCFp
OTE1X2dlbV9vYmplY3RfaXNfZnJhbWVidWZmZXIob2JqKSkKIAkJcmV0dXJuOwogCiAJaTkxNV9n
ZW1fb2JqZWN0X2xvY2sob2JqKTsKQEAgLTQyMiwxMiArNDIyLDggQEAgaTkxNV9nZW1fb2JqZWN0
X3Bpbl90b19kaXNwbGF5X3BsYW5lKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAK
IAlhc3NlcnRfb2JqZWN0X2hlbGQob2JqKTsKIAotCS8qIE1hcmsgdGhlIGdsb2JhbCBwaW4gZWFy
bHkgc28gdGhhdCB3ZSBhY2NvdW50IGZvciB0aGUKLQkgKiBkaXNwbGF5IGNvaGVyZW5jeSB3aGls
c3Qgc2V0dGluZyB1cCB0aGUgY2FjaGUgZG9tYWlucy4KLQkgKi8KLQlvYmotPnBpbl9nbG9iYWwr
KzsKLQotCS8qIFRoZSBkaXNwbGF5IGVuZ2luZSBpcyBub3QgY29oZXJlbnQgd2l0aCB0aGUgTExD
IGNhY2hlIG9uIGdlbjYuICBBcworCS8qCisJICogVGhlIGRpc3BsYXkgZW5naW5lIGlzIG5vdCBj
b2hlcmVudCB3aXRoIHRoZSBMTEMgY2FjaGUgb24gZ2VuNi4gIEFzCiAJICogYSByZXN1bHQsIHdl
IG1ha2Ugc3VyZSB0aGF0IHRoZSBwaW5uaW5nIHRoYXQgaXMgYWJvdXQgdG8gb2NjdXIgaXMKIAkg
KiBkb25lIHdpdGggdW5jYWNoZWQgUFRFcy4gVGhpcyBpcyBsb3dlc3QgY29tbW9uIGRlbm9taW5h
dG9yIGZvciBhbGwKIAkgKiBjaGlwc2V0cy4KQEAgLTQzOSwxMiArNDM1LDExIEBAIGk5MTVfZ2Vt
X29iamVjdF9waW5fdG9fZGlzcGxheV9wbGFuZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqLAogCXJldCA9IGk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVfbGV2ZWwob2JqLAogCQkJCQkg
ICAgICBIQVNfV1QodG9faTkxNShvYmotPmJhc2UuZGV2KSkgPwogCQkJCQkgICAgICBJOTE1X0NB
Q0hFX1dUIDogSTkxNV9DQUNIRV9OT05FKTsKLQlpZiAocmV0KSB7Ci0JCXZtYSA9IEVSUl9QVFIo
cmV0KTsKLQkJZ290byBlcnJfdW5waW5fZ2xvYmFsOwotCX0KKwlpZiAocmV0KQorCQlyZXR1cm4g
RVJSX1BUUihyZXQpOwogCi0JLyogQXMgdGhlIHVzZXIgbWF5IG1hcCB0aGUgYnVmZmVyIG9uY2Ug
cGlubmVkIGluIHRoZSBkaXNwbGF5IHBsYW5lCisJLyoKKwkgKiBBcyB0aGUgdXNlciBtYXkgbWFw
IHRoZSBidWZmZXIgb25jZSBwaW5uZWQgaW4gdGhlIGRpc3BsYXkgcGxhbmUKIAkgKiAoZS5nLiBs
aWJrbXMgZm9yIHRoZSBib290dXAgc3BsYXNoKSwgd2UgaGF2ZSB0byBlbnN1cmUgdGhhdCB3ZQog
CSAqIGFsd2F5cyB1c2UgbWFwX2FuZF9mZW5jZWFibGUgZm9yIGFsbCBzY2Fub3V0IGJ1ZmZlcnMu
IEhvd2V2ZXIsCiAJICogaXQgbWF5IHNpbXBseSBiZSB0b28gYmlnIHRvIGZpdCBpbnRvIG1hcHBh
YmxlLCBpbiB3aGljaCBjYXNlCkBAIC00NjEsMjIgKzQ1NiwxOSBAQCBpOTE1X2dlbV9vYmplY3Rf
cGluX3RvX2Rpc3BsYXlfcGxhbmUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlp
ZiAoSVNfRVJSKHZtYSkpCiAJCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihvYmosIHZp
ZXcsIDAsIGFsaWdubWVudCwgZmxhZ3MpOwogCWlmIChJU19FUlIodm1hKSkKLQkJZ290byBlcnJf
dW5waW5fZ2xvYmFsOworCQlyZXR1cm4gdm1hOwogCiAJdm1hLT5kaXNwbGF5X2FsaWdubWVudCA9
IG1heF90KHU2NCwgdm1hLT5kaXNwbGF5X2FsaWdubWVudCwgYWxpZ25tZW50KTsKIAogCV9faTkx
NV9nZW1fb2JqZWN0X2ZsdXNoX2Zvcl9kaXNwbGF5KG9iaik7CiAKLQkvKiBJdCBzaG91bGQgbm93
IGJlIG91dCBvZiBhbnkgb3RoZXIgd3JpdGUgZG9tYWlucywgYW5kIHdlIGNhbiB1cGRhdGUKKwkv
KgorCSAqIEl0IHNob3VsZCBub3cgYmUgb3V0IG9mIGFueSBvdGhlciB3cml0ZSBkb21haW5zLCBh
bmQgd2UgY2FuIHVwZGF0ZQogCSAqIHRoZSBkb21haW4gdmFsdWVzIGZvciBvdXIgY2hhbmdlcy4K
IAkgKi8KIAlvYmotPnJlYWRfZG9tYWlucyB8PSBJOTE1X0dFTV9ET01BSU5fR1RUOwogCiAJcmV0
dXJuIHZtYTsKLQotZXJyX3VucGluX2dsb2JhbDoKLQlvYmotPnBpbl9nbG9iYWwtLTsKLQlyZXR1
cm4gdm1hOwogfQogCiBzdGF0aWMgdm9pZCBpOTE1X2dlbV9vYmplY3RfYnVtcF9pbmFjdGl2ZV9n
Z3R0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCkBAIC01MTQsMTIgKzUwNiw2IEBA
IGk5MTVfZ2VtX29iamVjdF91bnBpbl9mcm9tX2Rpc3BsYXlfcGxhbmUoc3RydWN0IGk5MTVfdm1h
ICp2bWEpCiAKIAlhc3NlcnRfb2JqZWN0X2hlbGQob2JqKTsKIAotCWlmIChXQVJOX09OKG9iai0+
cGluX2dsb2JhbCA9PSAwKSkKLQkJcmV0dXJuOwotCi0JaWYgKC0tb2JqLT5waW5fZ2xvYmFsID09
IDApCi0JCXZtYS0+ZGlzcGxheV9hbGlnbm1lbnQgPSBJOTE1X0dUVF9NSU5fQUxJR05NRU5UOwot
CiAJLyogQnVtcCB0aGUgTFJVIHRvIHRyeSBhbmQgYXZvaWQgcHJlbWF0dXJlIGV2aWN0aW9uIHdo
aWxzdCBmbGlwcGluZyAgKi8KIAlpOTE1X2dlbV9vYmplY3RfYnVtcF9pbmFjdGl2ZV9nZ3R0KG9i
aik7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmpl
Y3QuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaAppbmRleCA1
ZWZiOTkzNmUwNWIuLjI5YjllZGRjNGM3ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9vYmplY3QuaApAQCAtNDA2LDcgKzQwNiw4IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBj
cHVfd3JpdGVfbmVlZHNfY2xmbHVzaChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQog
CWlmICghKG9iai0+Y2FjaGVfY29oZXJlbnQgJiBJOTE1X0JPX0NBQ0hFX0NPSEVSRU5UX0ZPUl9X
UklURSkpCiAJCXJldHVybiB0cnVlOwogCi0JcmV0dXJuIG9iai0+cGluX2dsb2JhbDsgLyogY3Vy
cmVudGx5IGluIHVzZSBieSBIVywga2VlcCBmbHVzaGVkICovCisJLyogQ3VycmVudGx5IGluIHVz
ZSBieSBIVyAoZGlzcGxheSBlbmdpbmUpPyBLZWVwIGZsdXNoZWQuICovCisJcmV0dXJuIGk5MTVf
Z2VtX29iamVjdF9pc19mcmFtZWJ1ZmZlcihvYmopOwogfQogCiBzdGF0aWMgaW5saW5lIHZvaWQg
X19zdGFydF9jcHVfd3JpdGUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaCBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaAppbmRleCBl
ZGUwZWI0MjE4YTguLjEzYjlkYzBlMWE4OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaApAQCAtMTUyLDggKzE1Miw2IEBAIHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0IHsKIAogCS8qKiBDb3VudCBvZiBWTUEgYWN0dWFsbHkgYm91bmQg
YnkgdGhpcyBvYmplY3QgKi8KIAlhdG9taWNfdCBiaW5kX2NvdW50OwotCS8qKiBDb3VudCBvZiBo
b3cgbWFueSBnbG9iYWwgVk1BIGFyZSBjdXJyZW50bHkgcGlubmVkIGZvciB1c2UgYnkgSFcgKi8K
LQl1bnNpZ25lZCBpbnQgcGluX2dsb2JhbDsKIAogCXN0cnVjdCB7CiAJCXN0cnVjdCBtdXRleCBs
b2NrOyAvKiBwcm90ZWN0cyB0aGUgcGFnZXMgYW5kIHRoZWlyIHVzZSAqLwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYwppbmRleCBlZGQyMWQxNGU2NGYuLjRl
NTVjZmMyYjBkYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X3Nocmlua2VyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlu
a2VyLmMKQEAgLTYxLDcgKzYxLDggQEAgc3RhdGljIGJvb2wgY2FuX3JlbGVhc2VfcGFnZXMoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAlpZiAoIWk5MTVfZ2VtX29iamVjdF9pc19z
aHJpbmthYmxlKG9iaikpCiAJCXJldHVybiBmYWxzZTsKIAotCS8qIE9ubHkgcmVwb3J0IHRydWUg
aWYgYnkgdW5iaW5kaW5nIHRoZSBvYmplY3QgYW5kIHB1dHRpbmcgaXRzIHBhZ2VzCisJLyoKKwkg
KiBPbmx5IHJlcG9ydCB0cnVlIGlmIGJ5IHVuYmluZGluZyB0aGUgb2JqZWN0IGFuZCBwdXR0aW5n
IGl0cyBwYWdlcwogCSAqIHdlIGNhbiBhY3R1YWxseSBtYWtlIGZvcndhcmQgcHJvZ3Jlc3MgdG93
YXJkcyBmcmVlaW5nIHBoeXNpY2FsCiAJICogcGFnZXMuCiAJICoKQEAgLTcyLDE2ICs3Myw4IEBA
IHN0YXRpYyBib29sIGNhbl9yZWxlYXNlX3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmopCiAJaWYgKGF0b21pY19yZWFkKCZvYmotPm1tLnBhZ2VzX3Bpbl9jb3VudCkgPiBhdG9t
aWNfcmVhZCgmb2JqLT5iaW5kX2NvdW50KSkKIAkJcmV0dXJuIGZhbHNlOwogCi0JLyogSWYgYW55
IHZtYSBhcmUgInBlcm1hbmVudGx5IiBwaW5uZWQsIGl0IHdpbGwgcHJldmVudCB1cyBmcm9tCi0J
ICogcmVjbGFpbWluZyB0aGUgb2JqLT5tbS5wYWdlcy4gV2Ugb25seSBhbGxvdyBzY2Fub3V0IG9i
amVjdHMgdG8gY2xhaW0KLQkgKiBhIHBlcm1hbmVudCBwaW4sIGFsb25nIHdpdGggYSBmZXcgb3Ro
ZXJzIGxpa2UgdGhlIGNvbnRleHQgb2JqZWN0cy4KLQkgKiBUbyBzaW1wbGlmeSB0aGUgc2Nhbiwg
YW5kIHRvIGF2b2lkIHdhbGtpbmcgdGhlIGxpc3Qgb2Ygdm1hIHVuZGVyIHRoZQotCSAqIG9iamVj
dCwgd2UganVzdCBjaGVjayB0aGUgY291bnQgb2YgaXRzIHBlcm1hbmVudGx5IHBpbm5lZC4KLQkg
Ki8KLQlpZiAoUkVBRF9PTkNFKG9iai0+cGluX2dsb2JhbCkpCi0JCXJldHVybiBmYWxzZTsKLQot
CS8qIFdlIGNhbiBvbmx5IHJldHVybiBwaHlzaWNhbCBwYWdlcyB0byB0aGUgc3lzdGVtIGlmIHdl
IGNhbiBlaXRoZXIKKwkvKgorCSAqIFdlIGNhbiBvbmx5IHJldHVybiBwaHlzaWNhbCBwYWdlcyB0
byB0aGUgc3lzdGVtIGlmIHdlIGNhbiBlaXRoZXIKIAkgKiBkaXNjYXJkIHRoZSBjb250ZW50cyAo
YmVjYXVzZSB0aGUgdXNlciBoYXMgbWFya2VkIHRoZW0gYXMgYmVpbmcKIAkgKiBwdXJnZWFibGUp
IG9yIGlmIHdlIGNhbiBtb3ZlIHRoZWlyIGNvbnRlbnRzIG91dCB0byBzd2FwLgogCSAqLwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwppbmRleCA1ZTgxYzRmYzEzYWUuLjMwYjBiNTkyZTIw
ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKQEAgLTc3LDExICs3Nyw2IEBAIHN0
YXRpYyBpbnQgaTkxNV9jYXBhYmlsaXRpZXMoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRh
KQogCXJldHVybiAwOwogfQogCi1zdGF0aWMgY2hhciBnZXRfcGluX2ZsYWcoc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaikKLXsKLQlyZXR1cm4gb2JqLT5waW5fZ2xvYmFsID8gJ3AnIDog
JyAnOwotfQotCiBzdGF0aWMgY2hhciBnZXRfdGlsaW5nX2ZsYWcoc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaikKIHsKIAlzd2l0Y2ggKGk5MTVfZ2VtX29iamVjdF9nZXRfdGlsaW5nKG9i
aikpIHsKQEAgLTE0MCw5ICsxMzUsOCBAQCBkZXNjcmliZV9vYmooc3RydWN0IHNlcV9maWxlICpt
LCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCXN0cnVjdCBpOTE1X3ZtYSAqdm1h
OwogCWludCBwaW5fY291bnQgPSAwOwogCi0Jc2VxX3ByaW50ZihtLCAiJXBLOiAlYyVjJWMlYyAl
OHpkS2lCICUwMnggJTAyeCAlcyVzJXMiLAorCXNlcV9wcmludGYobSwgIiVwSzogJWMlYyVjICU4
emRLaUIgJTAyeCAlMDJ4ICVzJXMlcyIsCiAJCSAgICZvYmotPmJhc2UsCi0JCSAgIGdldF9waW5f
ZmxhZyhvYmopLAogCQkgICBnZXRfdGlsaW5nX2ZsYWcob2JqKSwKIAkJICAgZ2V0X2dsb2JhbF9m
bGFnKG9iaiksCiAJCSAgIGdldF9waW5fbWFwcGVkX2ZsYWcob2JqKSwKQEAgLTIyMSw4ICsyMTUs
OCBAQCBkZXNjcmliZV9vYmooc3RydWN0IHNlcV9maWxlICptLCBzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqKQogCXNlcV9wcmludGYobSwgIiAocGlubmVkIHggJWQpIiwgcGluX2NvdW50
KTsKIAlpZiAob2JqLT5zdG9sZW4pCiAJCXNlcV9wcmludGYobSwgIiAoc3RvbGVuOiAlMDhsbHgp
Iiwgb2JqLT5zdG9sZW4tPnN0YXJ0KTsKLQlpZiAob2JqLT5waW5fZ2xvYmFsKQotCQlzZXFfcHJp
bnRmKG0sICIgKGdsb2JhbCkiKTsKKwlpZiAoaTkxNV9nZW1fb2JqZWN0X2lzX2ZyYW1lYnVmZmVy
KG9iaikpCisJCXNlcV9wcmludGYobSwgIiAoZmIpIik7CiAKIAllbmdpbmUgPSBpOTE1X2dlbV9v
YmplY3RfbGFzdF93cml0ZV9lbmdpbmUob2JqKTsKIAlpZiAoZW5naW5lKQotLSAKMi4yMy4wCgpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZngg
bWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0
cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3A1EF89FE6
	for <lists+intel-gfx@lfdr.de>; Mon, 12 Aug 2019 15:41:18 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5B3996E523;
	Mon, 12 Aug 2019 13:41:16 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A34786E514
 for <intel-gfx@lists.freedesktop.org>; Mon, 12 Aug 2019 13:41:09 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17969932-1500050 
 for multiple; Mon, 12 Aug 2019 14:39:20 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 12 Aug 2019 14:39:14 +0100
Message-Id: <20190812133915.18824-17-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190812133915.18824-1-chris@chris-wilson.co.uk>
References: <20190812133915.18824-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 17/18] drm/i915: Drop GEM context as a direct
 link from i915_request
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

S2VlcCB0aGUgaW50ZWxfY29udGV4dCBhcyBiZWluZyB0aGUgcHJpbWFyeSBzdGF0ZSBmb3IgaTkx
NV9yZXF1ZXN0LCB3aXRoCnRoZSBHRU0gY29udGV4dCBhIGJhY2twb2ludGVyIGZyb20gdGhlIGxv
dyBsZXZlbCBzdGF0ZSBmb3IgdGhlIHJhcmVyCmNhc2VzIHdlIG5lZWQgY2xpZW50IGluZm9ybWF0
aW9uLiBPdXIgZ29hbCBpcyB0byByZW1vdmUgc3VjaCByZWZlcmVuY2VzCnRvIGNsaWVudHMgZnJv
bSB0aGUgYmFja2VuZCwgYW5kIGxlYXZlIHRoZSBIVyBzdWJtaXNzaW9uIGFnbm9zdGljIHRvCmNs
aWVudCBpbnRlcmZhY2VzIGFuZCBzZWxmLWNvbnRhaW5lZC4KClNpZ25lZC1vZmYtYnk6IENocmlz
IFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgICB8ICA1ICsrLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaCAgIHwgMjAgLS0tLS0tLS0tCiAuLi4vZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0X3R5cGVzLmggfCAgNiArLS0KIC4uLi9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyAgICB8ICA2ICstLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfYnJlYWRjcnVtYnMuYyAgIHwgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2NvbnRleHQuYyAgICAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9jb250ZXh0LmggICAgICAgfCAyNCArKysrKysrKysrKwogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dF90eXBlcy5oIHwgIDQgKy0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jICAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9scmMuYyAgICAgICAgICAgfCA0MiArKysrKysrKystLS0tLS0tLS0tCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZXNldC5jICAgICAgICAgfCAzOCArKysrKysr
KystLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jICAg
IHwgMTIgKysrLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX2d1Y19zdWJtaXNzaW9u
LmMgfCAgNiArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYyAgICAgICAg
ICB8IDE4ICsrKystLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jICAgICAgICAg
ICAgICAgfCAgNiArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMgICAg
ICAgICB8IDExICsrKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYyAgICAg
ICAgICAgfCAxNSArKysrLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaCAg
ICAgICAgICAgfCAgMyArLQogMTggZmlsZXMgY2hhbmdlZCwgMTE3IGluc2VydGlvbnMoKyksIDEw
NyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRl
eHQuYwppbmRleCA1MWI4MTAxZTk4MzYuLjFkN2U5YzMyYzJiYiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCkBAIC02OSw4ICs2OSw5IEBACiAKICNpbmNs
dWRlIDxkcm0vaTkxNV9kcm0uaD4KIAotI2luY2x1ZGUgImd0L2ludGVsX2xyY19yZWcuaCIKKyNp
bmNsdWRlICJndC9pbnRlbF9jb250ZXh0LmgiCiAjaW5jbHVkZSAiZ3QvaW50ZWxfZW5naW5lX3Vz
ZXIuaCIKKyNpbmNsdWRlICJndC9pbnRlbF9scmNfcmVnLmgiCiAKICNpbmNsdWRlICJpOTE1X2dl
bV9jb250ZXh0LmgiCiAjaW5jbHVkZSAiaTkxNV9nbG9iYWxzLmgiCkBAIC04NDIsNyArODQzLDcg
QEAgc3RhdGljIHZvaWQgc2V0X3BwZ3R0X2JhcnJpZXIodm9pZCAqZGF0YSkKIAogc3RhdGljIGlu
dCBlbWl0X3BwZ3R0X3VwZGF0ZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgdm9pZCAqZGF0YSkK
IHsKLQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IHJxLT5od19jb250ZXh0LT52bTsK
KwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IHJxLT5jb250ZXh0LT52bTsKIAlzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUgPSBycS0+ZW5naW5lOwogCXUzMiBiYXNlID0gZW5n
aW5lLT5tbWlvX2Jhc2U7CiAJdTMyICpjczsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fY29udGV4dC5oCmluZGV4IDQ0MTcxNWY5ZWUzYS4uYmZjMDgyNjU5MWM1IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5oCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmgKQEAgLTc0LDI2ICs3NCw2
IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBpOTE1X2dlbV9jb250ZXh0X2NsZWFyX3JlY292ZXJhYmxl
KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjCiAJY2xlYXJfYml0KFVDT05URVhUX1JFQ09WRVJB
QkxFLCAmY3R4LT51c2VyX2ZsYWdzKTsKIH0KIAotc3RhdGljIGlubGluZSBib29sIGk5MTVfZ2Vt
X2NvbnRleHRfaXNfYmFubmVkKGNvbnN0IHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCi17
Ci0JcmV0dXJuIHRlc3RfYml0KENPTlRFWFRfQkFOTkVELCAmY3R4LT5mbGFncyk7Ci19Ci0KLXN0
YXRpYyBpbmxpbmUgdm9pZCBpOTE1X2dlbV9jb250ZXh0X3NldF9iYW5uZWQoc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHQgKmN0eCkKLXsKLQlzZXRfYml0KENPTlRFWFRfQkFOTkVELCAmY3R4LT5mbGFn
cyk7Ci19Ci0KLXN0YXRpYyBpbmxpbmUgYm9vbCBpOTE1X2dlbV9jb250ZXh0X2ZvcmNlX3Npbmds
ZV9zdWJtaXNzaW9uKGNvbnN0IHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCi17Ci0JcmV0
dXJuIHRlc3RfYml0KENPTlRFWFRfRk9SQ0VfU0lOR0xFX1NVQk1JU1NJT04sICZjdHgtPmZsYWdz
KTsKLX0KLQotc3RhdGljIGlubGluZSB2b2lkIGk5MTVfZ2VtX2NvbnRleHRfc2V0X2ZvcmNlX3Np
bmdsZV9zdWJtaXNzaW9uKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCi17Ci0JX19zZXRf
Yml0KENPTlRFWFRfRk9SQ0VfU0lOR0xFX1NVQk1JU1NJT04sICZjdHgtPmZsYWdzKTsKLX0KLQog
c3RhdGljIGlubGluZSBib29sCiBpOTE1X2dlbV9jb250ZXh0X3VzZXJfZW5naW5lcyhjb25zdCBz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQogewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHRfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0X3R5cGVzLmgKaW5kZXggODdiZTI3ODc3ZTIyLi41M2Ux
ZjE3ZWQzZmUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9j
b250ZXh0X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2Nv
bnRleHRfdHlwZXMuaApAQCAtMTQyLDEwICsxNDIsOCBAQCBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCB7CiAJICogQGZsYWdzOiBzbWFsbCBzZXQgb2YgYm9vbGVhbnMKIAkgKi8KIAl1bnNpZ25lZCBs
b25nIGZsYWdzOwotI2RlZmluZSBDT05URVhUX0JBTk5FRAkJCTAKLSNkZWZpbmUgQ09OVEVYVF9D
TE9TRUQJCQkxCi0jZGVmaW5lIENPTlRFWFRfRk9SQ0VfU0lOR0xFX1NVQk1JU1NJT04JMgotI2Rl
ZmluZSBDT05URVhUX1VTRVJfRU5HSU5FUwkJMworI2RlZmluZSBDT05URVhUX0NMT1NFRAkJCTAK
KyNkZWZpbmUgQ09OVEVYVF9VU0VSX0VOR0lORVMJCTEKIAogCXN0cnVjdCBtdXRleCBtdXRleDsK
IApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZm
ZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKaW5k
ZXggYjg0MzJjMzQzN2U5Li42MGJkYTAzYzUzZjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYwpAQCAtNzQyLDkgKzc0Miw2IEBAIHN0YXRpYyBp
bnQgZWJfbG9va3VwX3ZtYXMoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIpCiAJdW5zaWduZWQg
aW50IGksIGJhdGNoOwogCWludCBlcnI7CiAKLQlpZiAodW5saWtlbHkoaTkxNV9nZW1fY29udGV4
dF9pc19iYW5uZWQoZWItPmdlbV9jb250ZXh0KSkpCi0JCXJldHVybiAtRUlPOwotCiAJSU5JVF9M
SVNUX0hFQUQoJmViLT5yZWxvY3MpOwogCUlOSVRfTElTVF9IRUFEKCZlYi0+dW5ib3VuZCk7CiAK
QEAgLTIxNTIsNiArMjE0OSw5IEBAIHN0YXRpYyBpbnQgX19lYl9waW5fZW5naW5lKHN0cnVjdCBp
OTE1X2V4ZWNidWZmZXIgKmViLCBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAJaWYgKGVycikK
IAkJcmV0dXJuIGVycjsKIAorCWlmICh1bmxpa2VseShpbnRlbF9jb250ZXh0X2lzX2Jhbm5lZChj
ZSkpKQorCQlyZXR1cm4gLUVJTzsKKwogCS8qCiAJICogUGlubmluZyB0aGUgY29udGV4dHMgbWF5
IGdlbmVyYXRlIHJlcXVlc3RzIGluIG9yZGVyIHRvIGFjcXVpcmUKIAkgKiBHR1RUIHNwYWNlLCBz
byBkbyB0aGlzIGZpcnN0IGJlZm9yZSB3ZSByZXNlcnZlIGEgc2Vxbm8gZm9yCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9icmVhZGNydW1icy5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfYnJlYWRjcnVtYnMuYwppbmRleCA5MGRiNDFkMTczZGYuLmE1
OWQyY2FmYzg5YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfYnJl
YWRjcnVtYnMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9icmVhZGNydW1i
cy5jCkBAIC0zMDAsNyArMzAwLDcgQEAgYm9vbCBpOTE1X3JlcXVlc3RfZW5hYmxlX2JyZWFkY3J1
bWIoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAKIAlpZiAodGVzdF9iaXQoSTkxNV9GRU5DRV9G
TEFHX0FDVElWRSwgJnJxLT5mZW5jZS5mbGFncykpIHsKIAkJc3RydWN0IGludGVsX2JyZWFkY3J1
bWJzICpiID0gJnJxLT5lbmdpbmUtPmJyZWFkY3J1bWJzOwotCQlzdHJ1Y3QgaW50ZWxfY29udGV4
dCAqY2UgPSBycS0+aHdfY29udGV4dDsKKwkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlID0gcnEt
PmNvbnRleHQ7CiAJCXN0cnVjdCBsaXN0X2hlYWQgKnBvczsKIAogCQlzcGluX2xvY2soJmItPmly
cV9sb2NrKTsKQEAgLTM1Niw3ICszNTYsNyBAQCB2b2lkIGk5MTVfcmVxdWVzdF9jYW5jZWxfYnJl
YWRjcnVtYihzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAkgKi8KIAlzcGluX2xvY2soJmItPmly
cV9sb2NrKTsKIAlpZiAodGVzdF9iaXQoSTkxNV9GRU5DRV9GTEFHX1NJR05BTCwgJnJxLT5mZW5j
ZS5mbGFncykpIHsKLQkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlID0gcnEtPmh3X2NvbnRleHQ7
CisJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSA9IHJxLT5jb250ZXh0OwogCiAJCWxpc3RfZGVs
KCZycS0+c2lnbmFsX2xpbmspOwogCQlpZiAobGlzdF9lbXB0eSgmY2UtPnNpZ25hbHMpKQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCmluZGV4IGY1NTY5MWQxNTFhZS4uNDBl
NjExODRmMjRmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250
ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCkBAIC0y
OTYsNyArMjk2LDcgQEAgaW50IGludGVsX2NvbnRleHRfcHJlcGFyZV9yZW1vdGVfcmVxdWVzdChz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJaW50IGVycjsKIAogCS8qIE9ubHkgc3VpdGFibGUg
Zm9yIHVzZSBpbiByZW1vdGVseSBtb2RpZnlpbmcgdGhpcyBjb250ZXh0ICovCi0JR0VNX0JVR19P
TihycS0+aHdfY29udGV4dCA9PSBjZSk7CisJR0VNX0JVR19PTihycS0+Y29udGV4dCA9PSBjZSk7
CiAKIAlpZiAocnEtPnRpbWVsaW5lICE9IHRsKSB7IC8qIGJld2FyZSB0aW1lbGluZSBzaGFyaW5n
ICovCiAJCWVyciA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZV9uZXN0ZWQoJnRsLT5tdXRleCwK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuaCBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuaAppbmRleCBkZDc0MmFjMmZiZGIu
LmZlMDNiMWVlYWI2MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
Y29udGV4dC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuaApA
QCAtNyw3ICs3LDkgQEAKICNpZm5kZWYgX19JTlRFTF9DT05URVhUX0hfXwogI2RlZmluZSBfX0lO
VEVMX0NPTlRFWFRfSF9fCiAKKyNpbmNsdWRlIDxsaW51eC9iaXRvcHMuaD4KICNpbmNsdWRlIDxs
aW51eC9sb2NrZGVwLmg+CisjaW5jbHVkZSA8bGludXgvdHlwZXMuaD4KIAogI2luY2x1ZGUgImk5
MTVfYWN0aXZlLmgiCiAjaW5jbHVkZSAiaW50ZWxfY29udGV4dF90eXBlcy5oIgpAQCAtMTUyLDQg
KzE1NCwyNiBAQCBzdGF0aWMgaW5saW5lIHN0cnVjdCBpbnRlbF9yaW5nICpfX2ludGVsX2NvbnRl
eHRfcmluZ19zaXplKHU2NCBzeikKIAlyZXR1cm4gdTY0X3RvX3B0cihzdHJ1Y3QgaW50ZWxfcmlu
Zywgc3opOwogfQogCitzdGF0aWMgaW5saW5lIGJvb2wgaW50ZWxfY29udGV4dF9pc19iYW5uZWQo
Y29uc3Qgc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQoreworCXJldHVybiB0ZXN0X2JpdChDT05U
RVhUX0JBTk5FRCwgJmNlLT5mbGFncyk7Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9pZCBpbnRlbF9j
b250ZXh0X3NldF9iYW5uZWQoc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQoreworCXNldF9iaXQo
Q09OVEVYVF9CQU5ORUQsICZjZS0+ZmxhZ3MpOworfQorCitzdGF0aWMgaW5saW5lIGJvb2wKK2lu
dGVsX2NvbnRleHRfZm9yY2Vfc2luZ2xlX3N1Ym1pc3Npb24oY29uc3Qgc3RydWN0IGludGVsX2Nv
bnRleHQgKmNlKQoreworCXJldHVybiB0ZXN0X2JpdChDT05URVhUX0ZPUkNFX1NJTkdMRV9TVUJN
SVNTSU9OLCAmY2UtPmZsYWdzKTsKK30KKworc3RhdGljIGlubGluZSB2b2lkCitpbnRlbF9jb250
ZXh0X3NldF9zaW5nbGVfc3VibWlzc2lvbihzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCit7CisJ
X19zZXRfYml0KENPTlRFWFRfRk9SQ0VfU0lOR0xFX1NVQk1JU1NJT04sICZjZS0+ZmxhZ3MpOwor
fQorCiAjZW5kaWYgLyogX19JTlRFTF9DT05URVhUX0hfXyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dF90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfY29udGV4dF90eXBlcy5oCmluZGV4IGEzNTc4ZWYyNDA3OS4uOWM4YzZk
Y2QwZjA3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0
X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dF90eXBl
cy5oCkBAIC01NCw3ICs1NCw5IEBAIHN0cnVjdCBpbnRlbF9jb250ZXh0IHsKIAlzdHJ1Y3QgaW50
ZWxfdGltZWxpbmUgKnRpbWVsaW5lOwogCiAJdW5zaWduZWQgbG9uZyBmbGFnczsKLSNkZWZpbmUg
Q09OVEVYVF9BTExPQ19CSVQgMAorI2RlZmluZSBDT05URVhUX0FMTE9DX0JJVAkJMAorI2RlZmlu
ZSBDT05URVhUX0JBTk5FRAkJCTEKKyNkZWZpbmUgQ09OVEVYVF9GT1JDRV9TSU5HTEVfU1VCTUlT
U0lPTgkyCiAKIAl1MzIgKmxyY19yZWdfc3RhdGU7CiAJdTY0IGxyY19kZXNjOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYwppbmRleCA4YTlkM2NkMmMzMWMuLjk3MWM2
YTEwYjY0OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5l
X2NzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKQEAg
LTE0NTgsNyArMTQ1OCw3IEBAIGludCBpbnRlbF9lbmFibGVfZW5naW5lX3N0YXRzKHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAogCQlmb3IgKHBvcnQgPSBleGVjbGlzdHMtPnBlbmRp
bmc7IChycSA9ICpwb3J0KTsgcG9ydCsrKSB7CiAJCQkvKiBFeGNsdWRlIGFueSBjb250ZXh0cyBh
bHJlYWR5IGNvdW50ZWQgaW4gYWN0aXZlICovCi0JCQlpZiAoIWludGVsX2NvbnRleHRfaW5mbGln
aHRfY291bnQocnEtPmh3X2NvbnRleHQpKQorCQkJaWYgKCFpbnRlbF9jb250ZXh0X2luZmxpZ2h0
X2NvdW50KHJxLT5jb250ZXh0KSkKIAkJCQllbmdpbmUtPnN0YXRzLmFjdGl2ZSsrOwogCQl9CiAK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKaW5kZXggOTQ3YmY5OTRkNTg2Li5lOTZkZDA0
OWEyY2EgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCkBAIC00NzcsNyArNDc3LDcg
QEAgX191bndpbmRfaW5jb21wbGV0ZV9yZXF1ZXN0cyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpl
bmdpbmUpCiAJCSAqIGVuZ2luZSBzbyB0aGF0IGl0IGNhbiBiZSBtb3ZlZCBhY3Jvc3Mgb250byBh
bm90aGVyIHBoeXNpY2FsCiAJCSAqIGVuZ2luZSBhcyBsb2FkIGRpY3RhdGVzLgogCQkgKi8KLQkJ
b3duZXIgPSBycS0+aHdfY29udGV4dC0+ZW5naW5lOworCQlvd25lciA9IHJxLT5jb250ZXh0LT5l
bmdpbmU7CiAJCWlmIChsaWtlbHkob3duZXIgPT0gZW5naW5lKSkgewogCQkJR0VNX0JVR19PTihy
cV9wcmlvKHJxKSA9PSBJOTE1X1BSSU9SSVRZX0lOVkFMSUQpOwogCQkJaWYgKHJxX3ByaW8ocnEp
ICE9IHByaW8pIHsKQEAgLTUzOCw3ICs1MzgsNyBAQCBzdGF0aWMgaW5saW5lIHN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKgogX19leGVjbGlzdHNfc2NoZWR1bGVfaW4oc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnEpCiB7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqIGNvbnN0IGVuZ2luZSA9IHJxLT5l
bmdpbmU7Ci0Jc3RydWN0IGludGVsX2NvbnRleHQgKiBjb25zdCBjZSA9IHJxLT5od19jb250ZXh0
OworCXN0cnVjdCBpbnRlbF9jb250ZXh0ICogY29uc3QgY2UgPSBycS0+Y29udGV4dDsKIAogCWlu
dGVsX2NvbnRleHRfZ2V0KGNlKTsKIApAQCAtNTYxLDcgKzU2MSw3IEBAIF9fZXhlY2xpc3RzX3Nj
aGVkdWxlX2luKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogc3RhdGljIGlubGluZSBzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICoKIGV4ZWNsaXN0c19zY2hlZHVsZV9pbihzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycSwgaW50IGlkeCkKIHsKLQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqIGNvbnN0IGNlID0gcnEt
Pmh3X2NvbnRleHQ7CisJc3RydWN0IGludGVsX2NvbnRleHQgKiBjb25zdCBjZSA9IHJxLT5jb250
ZXh0OwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKm9sZDsKIAogCUdFTV9CVUdfT04oIWludGVs
X2VuZ2luZV9wbV9pc19hd2FrZShycS0+ZW5naW5lKSk7CkBAIC01OTIsNyArNTkyLDcgQEAgc3Rh
dGljIGlubGluZSB2b2lkCiBfX2V4ZWNsaXN0c19zY2hlZHVsZV9vdXQoc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnEpCiB7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqIGNvbnN0IGVuZ2luZSA9IHJx
LT5lbmdpbmU7Ci0Jc3RydWN0IGludGVsX2NvbnRleHQgKiBjb25zdCBjZSA9IHJxLT5od19jb250
ZXh0OworCXN0cnVjdCBpbnRlbF9jb250ZXh0ICogY29uc3QgY2UgPSBycS0+Y29udGV4dDsKIAog
CWludGVsX2VuZ2luZV9jb250ZXh0X291dChlbmdpbmUpOwogCWV4ZWNsaXN0c19jb250ZXh0X3N0
YXR1c19jaGFuZ2UocnEsIElOVEVMX0NPTlRFWFRfU0NIRURVTEVfT1VUKTsKQEAgLTYxNiw3ICs2
MTYsNyBAQCBfX2V4ZWNsaXN0c19zY2hlZHVsZV9vdXQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEp
CiBzdGF0aWMgaW5saW5lIHZvaWQKIGV4ZWNsaXN0c19zY2hlZHVsZV9vdXQoc3RydWN0IGk5MTVf
cmVxdWVzdCAqcnEpCiB7Ci0Jc3RydWN0IGludGVsX2NvbnRleHQgKiBjb25zdCBjZSA9IHJxLT5o
d19jb250ZXh0OworCXN0cnVjdCBpbnRlbF9jb250ZXh0ICogY29uc3QgY2UgPSBycS0+Y29udGV4
dDsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpjdXIsICpvbGQ7CiAKIAl0cmFjZV9pOTE1X3Jl
cXVlc3Rfb3V0KHJxKTsKQEAgLTYzNCw3ICs2MzQsNyBAQCBleGVjbGlzdHNfc2NoZWR1bGVfb3V0
KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCiBzdGF0aWMgdTY0IGV4ZWNsaXN0c191cGRhdGVf
Y29udGV4dChjb25zdCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKLQlzdHJ1Y3QgaW50ZWxf
Y29udGV4dCAqY2UgPSBycS0+aHdfY29udGV4dDsKKwlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2Ug
PSBycS0+Y29udGV4dDsKIAl1NjQgZGVzYzsKIAogCWNlLT5scmNfcmVnX3N0YXRlW0NUWF9SSU5H
X1RBSUwgKyAxXSA9CkBAIC03MDksMTAgKzcwOSwxMCBAQCBhc3NlcnRfcGVuZGluZ192YWxpZChj
b25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2V4ZWNsaXN0cyAqZXhlY2xpc3RzLAogCQlyZXR1cm4g
ZmFsc2U7CiAKIAlmb3IgKHBvcnQgPSBleGVjbGlzdHMtPnBlbmRpbmc7IChycSA9ICpwb3J0KTsg
cG9ydCsrKSB7Ci0JCWlmIChjZSA9PSBycS0+aHdfY29udGV4dCkKKwkJaWYgKGNlID09IHJxLT5j
b250ZXh0KQogCQkJcmV0dXJuIGZhbHNlOwogCi0JCWNlID0gcnEtPmh3X2NvbnRleHQ7CisJCWNl
ID0gcnEtPmNvbnRleHQ7CiAJCWlmIChpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJxKSkKIAkJCWNv
bnRpbnVlOwogCkBAIC03NjUsNyArNzY1LDcgQEAgc3RhdGljIHZvaWQgZXhlY2xpc3RzX3N1Ym1p
dF9wb3J0cyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiBzdGF0aWMgYm9vbCBjdHhf
c2luZ2xlX3BvcnRfc3VibWlzc2lvbihjb25zdCBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiB7
CiAJcmV0dXJuIChJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9HVlQpICYmCi0JCWk5MTVfZ2Vt
X2NvbnRleHRfZm9yY2Vfc2luZ2xlX3N1Ym1pc3Npb24oY2UtPmdlbV9jb250ZXh0KSk7CisJCWlu
dGVsX2NvbnRleHRfZm9yY2Vfc2luZ2xlX3N1Ym1pc3Npb24oY2UpKTsKIH0KIAogc3RhdGljIGJv
b2wgY2FuX21lcmdlX2N0eChjb25zdCBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqcHJldiwKQEAgLTc4
Niw3ICs3ODYsNyBAQCBzdGF0aWMgYm9vbCBjYW5fbWVyZ2VfcnEoY29uc3Qgc3RydWN0IGk5MTVf
cmVxdWVzdCAqcHJldiwKIAlHRU1fQlVHX09OKHByZXYgPT0gbmV4dCk7CiAJR0VNX0JVR19PTigh
YXNzZXJ0X3ByaW9yaXR5X3F1ZXVlKHByZXYsIG5leHQpKTsKIAotCWlmICghY2FuX21lcmdlX2N0
eChwcmV2LT5od19jb250ZXh0LCBuZXh0LT5od19jb250ZXh0KSkKKwlpZiAoIWNhbl9tZXJnZV9j
dHgocHJldi0+Y29udGV4dCwgbmV4dC0+Y29udGV4dCkpCiAJCXJldHVybiBmYWxzZTsKIAogCXJl
dHVybiB0cnVlOwpAQCAtMTA4MCw3ICsxMDgwLDcgQEAgc3RhdGljIHZvaWQgZXhlY2xpc3RzX2Rl
cXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCQkJICogdGVuZGVuY3kgdG8g
aWdub3JlIHVzIHJld2luZGluZyB0aGUgVEFJTCB0byB0aGUKIAkJCSAqIGVuZCBvZiBhbiBlYXJs
aWVyIHJlcXVlc3QuCiAJCQkgKi8KLQkJCWxhc3QtPmh3X2NvbnRleHQtPmxyY19kZXNjIHw9IENU
WF9ERVNDX0ZPUkNFX1JFU1RPUkU7CisJCQlsYXN0LT5jb250ZXh0LT5scmNfZGVzYyB8PSBDVFhf
REVTQ19GT1JDRV9SRVNUT1JFOwogCQkJbGFzdCA9IE5VTEw7CiAJCX0gZWxzZSBpZiAobmVlZF90
aW1lc2xpY2UoZW5naW5lLCBsYXN0KSAmJgogCQkJICAgIXRpbWVyX3BlbmRpbmcoJmVuZ2luZS0+
ZXhlY2xpc3RzLnRpbWVyKSkgewpAQCAtMTE1Miw3ICsxMTUyLDcgQEAgc3RhdGljIHZvaWQgZXhl
Y2xpc3RzX2RlcXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCiAJCUdFTV9C
VUdfT04ocnEgIT0gdmUtPnJlcXVlc3QpOwogCQlHRU1fQlVHX09OKHJxLT5lbmdpbmUgIT0gJnZl
LT5iYXNlKTsKLQkJR0VNX0JVR19PTihycS0+aHdfY29udGV4dCAhPSAmdmUtPmNvbnRleHQpOwor
CQlHRU1fQlVHX09OKHJxLT5jb250ZXh0ICE9ICZ2ZS0+Y29udGV4dCk7CiAKIAkJaWYgKHJxX3By
aW8ocnEpID49IHF1ZXVlX3ByaW8oZXhlY2xpc3RzKSkgewogCQkJaWYgKCF2aXJ0dWFsX21hdGNo
ZXModmUsIHJxLCBlbmdpbmUpKSB7CkBAIC0xMjcxLDcgKzEyNzEsNyBAQCBzdGF0aWMgdm9pZCBl
eGVjbGlzdHNfZGVxdWV1ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJCQkJICog
c2FtZSBMUkNBLCBpLmUuIHdlIG11c3Qgc3VibWl0IDIgZGlmZmVyZW50CiAJCQkJICogY29udGV4
dHMgaWYgd2Ugc3VibWl0IDIgRUxTUC4KIAkJCQkgKi8KLQkJCQlpZiAobGFzdC0+aHdfY29udGV4
dCA9PSBycS0+aHdfY29udGV4dCkKKwkJCQlpZiAobGFzdC0+Y29udGV4dCA9PSBycS0+Y29udGV4
dCkKIAkJCQkJZ290byBkb25lOwogCiAJCQkJLyoKQEAgLTEyODEsOCArMTI4MSw4IEBAIHN0YXRp
YyB2b2lkIGV4ZWNsaXN0c19kZXF1ZXVlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkK
IAkJCQkgKiB0aGUgc2FtZSBjb250ZXh0IChldmVuIHRob3VnaCBhIGRpZmZlcmVudAogCQkJCSAq
IHJlcXVlc3QpIHRvIHRoZSBzZWNvbmQgcG9ydC4KIAkJCQkgKi8KLQkJCQlpZiAoY3R4X3Npbmds
ZV9wb3J0X3N1Ym1pc3Npb24obGFzdC0+aHdfY29udGV4dCkgfHwKLQkJCQkgICAgY3R4X3Npbmds
ZV9wb3J0X3N1Ym1pc3Npb24ocnEtPmh3X2NvbnRleHQpKQorCQkJCWlmIChjdHhfc2luZ2xlX3Bv
cnRfc3VibWlzc2lvbihsYXN0LT5jb250ZXh0KSB8fAorCQkJCSAgICBjdHhfc2luZ2xlX3BvcnRf
c3VibWlzc2lvbihycS0+Y29udGV4dCkpCiAJCQkJCWdvdG8gZG9uZTsKIAogCQkJCSpwb3J0ID0g
ZXhlY2xpc3RzX3NjaGVkdWxlX2luKGxhc3QsIHBvcnQgLSBleGVjbGlzdHMtPnBlbmRpbmcpOwpA
QCAtMTc1NCw3ICsxNzU0LDcgQEAgc3RhdGljIGludCBnZW44X2VtaXRfaW5pdF9icmVhZGNydW1i
KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogc3RhdGljIGludCBlbWl0X3BkcHMoc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnEpCiB7CiAJY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqIGNvbnN0
IGVuZ2luZSA9IHJxLT5lbmdpbmU7Ci0Jc3RydWN0IGk5MTVfcHBndHQgKiBjb25zdCBwcGd0dCA9
IGk5MTVfdm1fdG9fcHBndHQocnEtPmh3X2NvbnRleHQtPnZtKTsKKwlzdHJ1Y3QgaTkxNV9wcGd0
dCAqIGNvbnN0IHBwZ3R0ID0gaTkxNV92bV90b19wcGd0dChycS0+Y29udGV4dC0+dm0pOwogCWlu
dCBlcnIsIGk7CiAJdTMyICpjczsKIApAQCAtMTgwOSw3ICsxODA5LDcgQEAgc3RhdGljIGludCBl
eGVjbGlzdHNfcmVxdWVzdF9hbGxvYyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0KQogewog
CWludCByZXQ7CiAKLQlHRU1fQlVHX09OKCFpbnRlbF9jb250ZXh0X2lzX3Bpbm5lZChyZXF1ZXN0
LT5od19jb250ZXh0KSk7CisJR0VNX0JVR19PTighaW50ZWxfY29udGV4dF9pc19waW5uZWQocmVx
dWVzdC0+Y29udGV4dCkpOwogCiAJLyoKIAkgKiBGbHVzaCBlbm91Z2ggc3BhY2UgdG8gcmVkdWNl
IHRoZSBsaWtlbGlob29kIG9mIHdhaXRpbmcgYWZ0ZXIKQEAgLTE4MjcsNyArMTgyNyw3IEBAIHN0
YXRpYyBpbnQgZXhlY2xpc3RzX3JlcXVlc3RfYWxsb2Moc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVx
dWVzdCkKIAkgKi8KIAogCS8qIFVuY29uZGl0aW9uYWxseSBpbnZhbGlkYXRlIEdQVSBjYWNoZXMg
YW5kIFRMQnMuICovCi0JaWYgKGk5MTVfdm1faXNfNGx2bChyZXF1ZXN0LT5od19jb250ZXh0LT52
bSkpCisJaWYgKGk5MTVfdm1faXNfNGx2bChyZXF1ZXN0LT5jb250ZXh0LT52bSkpCiAJCXJldCA9
IHJlcXVlc3QtPmVuZ2luZS0+ZW1pdF9mbHVzaChyZXF1ZXN0LCBFTUlUX0lOVkFMSURBVEUpOwog
CWVsc2UKIAkJcmV0ID0gZW1pdF9wZHBzKHJlcXVlc3QpOwpAQCAtMjI3OSwxNCArMjI3OSwxNCBA
QCBzdGF0aWMgdm9pZCByZXNldF9jc2JfcG9pbnRlcnMoc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lKQogc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3QgKmFjdGl2ZV9yZXF1ZXN0KHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxKQogewogCWNvbnN0IHN0cnVjdCBsaXN0X2hlYWQgKiBjb25zdCBs
aXN0ID0gJnJxLT50aW1lbGluZS0+cmVxdWVzdHM7Ci0JY29uc3Qgc3RydWN0IGludGVsX2NvbnRl
eHQgKiBjb25zdCBjZSA9IHJxLT5od19jb250ZXh0OworCWNvbnN0IHN0cnVjdCBpbnRlbF9jb250
ZXh0ICogY29uc3QgY2UgPSBycS0+Y29udGV4dDsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICphY3Rp
dmUgPSBOVUxMOwogCiAJbGlzdF9mb3JfZWFjaF9lbnRyeV9mcm9tX3JldmVyc2UocnEsIGxpc3Qs
IGxpbmspIHsKIAkJaWYgKGk5MTVfcmVxdWVzdF9jb21wbGV0ZWQocnEpKQogCQkJYnJlYWs7CiAK
LQkJaWYgKHJxLT5od19jb250ZXh0ICE9IGNlKQorCQlpZiAocnEtPmNvbnRleHQgIT0gY2UpCiAJ
CQlicmVhazsKIAogCQlhY3RpdmUgPSBycTsKQEAgLTIzMTYsNyArMjMxNiw3IEBAIHN0YXRpYyB2
b2lkIF9fZXhlY2xpc3RzX3Jlc2V0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgYm9v
bCBzdGFsbGVkKQogCWlmICghcnEpCiAJCWdvdG8gdW53aW5kOwogCi0JY2UgPSBycS0+aHdfY29u
dGV4dDsKKwljZSA9IHJxLT5jb250ZXh0OwogCUdFTV9CVUdfT04oaTkxNV9hY3RpdmVfaXNfaWRs
ZSgmY2UtPmFjdGl2ZSkpOwogCUdFTV9CVUdfT04oIWk5MTVfdm1hX2lzX3Bpbm5lZChjZS0+c3Rh
dGUpKTsKIAlycSA9IGFjdGl2ZV9yZXF1ZXN0KHJxKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9yZXNldC5jCmluZGV4IDA3NzcxNjQ0MmM5MC4uNjI5YmIwMzA5NDY5IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZXNldC5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMKQEAgLTQwLDI4ICs0MCwzMiBAQCBzdGF0aWMgdm9pZCBy
bXdfY2xlYXJfZncoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlLCBpOTE1X3JlZ190IHJlZywg
dTMyIGNscikKIHN0YXRpYyB2b2lkIGVuZ2luZV9za2lwX2NvbnRleHQoc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnEpCiB7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lID0gcnEtPmVuZ2lu
ZTsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqaHVuZ19jdHggPSBycS0+Z2VtX2NvbnRleHQ7
CisJc3RydWN0IGludGVsX2NvbnRleHQgKmh1bmdfY3R4ID0gcnEtPmNvbnRleHQ7CiAKIAlsb2Nr
ZGVwX2Fzc2VydF9oZWxkKCZlbmdpbmUtPmFjdGl2ZS5sb2NrKTsKIAogCWlmICghaTkxNV9yZXF1
ZXN0X2lzX2FjdGl2ZShycSkpCi0JCXJldHVybjsKKwkJcnEgPSBsaXN0X2ZpcnN0X2VudHJ5KCZl
bmdpbmUtPmFjdGl2ZS5yZXF1ZXN0cywKKwkJCQkgICAgICB0eXBlb2YoKnJxKSwgc2NoZWQubGlu
ayk7CiAKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5X2NvbnRpbnVlKHJxLCAmZW5naW5lLT5hY3RpdmUu
cmVxdWVzdHMsIHNjaGVkLmxpbmspCi0JCWlmIChycS0+Z2VtX2NvbnRleHQgPT0gaHVuZ19jdHgp
CisJCWlmIChycS0+Y29udGV4dCA9PSBodW5nX2N0eCkKIAkJCWk5MTVfcmVxdWVzdF9za2lwKHJx
LCAtRUlPKTsKIH0KIAotc3RhdGljIHZvaWQgY2xpZW50X21hcmtfZ3VpbHR5KHN0cnVjdCBkcm1f
aTkxNV9maWxlX3ByaXZhdGUgKmZpbGVfcHJpdiwKLQkJCSAgICAgICBjb25zdCBzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dCAqY3R4KQorc3RhdGljIHZvaWQgY2xpZW50X21hcmtfZ3VpbHR5KHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxLCBib29sIGJhbm5lZCkKIHsKLQl1bnNpZ25lZCBpbnQgc2NvcmU7
CisJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IHJxLT5jb250ZXh0LT5nZW1fY29udGV4
dDsKKwlzdHJ1Y3QgZHJtX2k5MTVfZmlsZV9wcml2YXRlICpmaWxlX3ByaXYgPSBjdHgtPmZpbGVf
cHJpdjsKIAl1bnNpZ25lZCBsb25nIHByZXZfaGFuZzsKKwl1bnNpZ25lZCBpbnQgc2NvcmU7CiAK
LQlpZiAoaTkxNV9nZW1fY29udGV4dF9pc19iYW5uZWQoY3R4KSkKKwlpZiAoSVNfRVJSX09SX05V
TEwoZmlsZV9wcml2KSkKKwkJcmV0dXJuOworCisJc2NvcmUgPSAwOworCWlmIChiYW5uZWQpCiAJ
CXNjb3JlID0gSTkxNV9DTElFTlRfU0NPUkVfQ09OVEVYVF9CQU47Ci0JZWxzZQotCQlzY29yZSA9
IDA7CiAKIAlwcmV2X2hhbmcgPSB4Y2hnKCZmaWxlX3ByaXYtPmhhbmdfdGltZXN0YW1wLCBqaWZm
aWVzKTsKIAlpZiAodGltZV9iZWZvcmUoamlmZmllcywgcHJldl9oYW5nICsgSTkxNV9DTElFTlRf
RkFTVF9IQU5HX0pJRkZJRVMpKQpAQCAtNzYsOCArODAsOSBAQCBzdGF0aWMgdm9pZCBjbGllbnRf
bWFya19ndWlsdHkoc3RydWN0IGRybV9pOTE1X2ZpbGVfcHJpdmF0ZSAqZmlsZV9wcml2LAogCX0K
IH0KIAotc3RhdGljIGJvb2wgY29udGV4dF9tYXJrX2d1aWx0eShzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqY3R4KQorc3RhdGljIGJvb2wgbWFya19ndWlsdHkoc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnEpCiB7CisJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IHJxLT5jb250ZXh0LT5nZW1f
Y29udGV4dDsKIAl1bnNpZ25lZCBsb25nIHByZXZfaGFuZzsKIAlib29sIGJhbm5lZDsKIAlpbnQg
aTsKQEAgLTEwMSwxOCArMTA2LDE3IEBAIHN0YXRpYyBib29sIGNvbnRleHRfbWFya19ndWlsdHko
c3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIAlpZiAoYmFubmVkKSB7CiAJCURSTV9ERUJV
R19EUklWRVIoImNvbnRleHQgJXM6IGd1aWx0eSAlZCwgYmFubmVkXG4iLAogCQkJCSBjdHgtPm5h
bWUsIGF0b21pY19yZWFkKCZjdHgtPmd1aWx0eV9jb3VudCkpOwotCQlpOTE1X2dlbV9jb250ZXh0
X3NldF9iYW5uZWQoY3R4KTsKKwkJaW50ZWxfY29udGV4dF9zZXRfYmFubmVkKHJxLT5jb250ZXh0
KTsKIAl9CiAKLQlpZiAoIUlTX0VSUl9PUl9OVUxMKGN0eC0+ZmlsZV9wcml2KSkKLQkJY2xpZW50
X21hcmtfZ3VpbHR5KGN0eC0+ZmlsZV9wcml2LCBjdHgpOworCWNsaWVudF9tYXJrX2d1aWx0eShy
cSwgYmFubmVkKTsKIAogCXJldHVybiBiYW5uZWQ7CiB9CiAKLXN0YXRpYyB2b2lkIGNvbnRleHRf
bWFya19pbm5vY2VudChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQorc3RhdGljIHZvaWQg
bWFya19pbm5vY2VudChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKLQlhdG9taWNfaW5jKCZj
dHgtPmFjdGl2ZV9jb3VudCk7CisJYXRvbWljX2luYygmcnEtPmNvbnRleHQtPmdlbV9jb250ZXh0
LT5hY3RpdmVfY291bnQpOwogfQogCiB2b2lkIF9faTkxNV9yZXF1ZXN0X3Jlc2V0KHN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxLCBib29sIGd1aWx0eSkKQEAgLTEyOCwxMSArMTMyLDExIEBAIHZvaWQg
X19pOTE1X3JlcXVlc3RfcmVzZXQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsIGJvb2wgZ3VpbHR5
KQogCiAJaWYgKGd1aWx0eSkgewogCQlpOTE1X3JlcXVlc3Rfc2tpcChycSwgLUVJTyk7Ci0JCWlm
IChjb250ZXh0X21hcmtfZ3VpbHR5KHJxLT5nZW1fY29udGV4dCkpCisJCWlmIChtYXJrX2d1aWx0
eShycSkpCiAJCQllbmdpbmVfc2tpcF9jb250ZXh0KHJxKTsKIAl9IGVsc2UgewogCQlkbWFfZmVu
Y2Vfc2V0X2Vycm9yKCZycS0+ZmVuY2UsIC1FQUdBSU4pOwotCQljb250ZXh0X21hcmtfaW5ub2Nl
bnQocnEtPmdlbV9jb250ZXh0KTsKKwkJbWFya19pbm5vY2VudChycSk7CiAJfQogfQogCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMKaW5kZXggOGNlNWE1NTQyN2Mx
Li41NjM1ZGNhOTRmMDYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X3JpbmdidWZmZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVm
ZmVyLmMKQEAgLTE2NDksNyArMTY0OSw3IEBAIHN0YXRpYyBpbmxpbmUgaW50IG1pX3NldF9jb250
ZXh0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCB1MzIgZmxhZ3MpCiAKIAkqY3MrKyA9IE1JX05P
T1A7CiAJKmNzKysgPSBNSV9TRVRfQ09OVEVYVDsKLQkqY3MrKyA9IGk5MTVfZ2d0dF9vZmZzZXQo
cnEtPmh3X2NvbnRleHQtPnN0YXRlKSB8IGZsYWdzOworCSpjcysrID0gaTkxNV9nZ3R0X29mZnNl
dChycS0+Y29udGV4dC0+c3RhdGUpIHwgZmxhZ3M7CiAJLyoKIAkgKiB3L2E6IE1JX1NFVF9DT05U
RVhUIG11c3QgYWx3YXlzIGJlIGZvbGxvd2VkIGJ5IE1JX05PT1AKIAkgKiBXYU1pU2V0Q29udGV4
dF9IYW5nOnNuYixpdmIsdmx2CkBAIC0xNzE5LDcgKzE3MTksNyBAQCBzdGF0aWMgaW50IHJlbWFw
X2wzX3NsaWNlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBpbnQgc2xpY2UpCiAKIHN0YXRpYyBp
bnQgcmVtYXBfbDMoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7Ci0Jc3RydWN0IGk5MTVfZ2Vt
X2NvbnRleHQgKmN0eCA9IHJxLT5nZW1fY29udGV4dDsKKwlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqY3R4ID0gcnEtPmNvbnRleHQtPmdlbV9jb250ZXh0OwogCWludCBpLCBlcnI7CiAKIAlpZiAo
IWN0eC0+cmVtYXBfc2xpY2UpCkBAIC0xNzQxLDcgKzE3NDEsNyBAQCBzdGF0aWMgaW50IHJlbWFw
X2wzKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogc3RhdGljIGludCBzd2l0Y2hfY29udGV4dChz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmUgPSBycS0+ZW5naW5lOwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gdm1fYWxp
YXMocnEtPmh3X2NvbnRleHQpOworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gdm1f
YWxpYXMocnEtPmNvbnRleHQpOwogCXVuc2lnbmVkIGludCB1bndpbmRfbW0gPSAwOwogCXUzMiBo
d19mbGFncyA9IDA7CiAJaW50IHJldDsKQEAgLTE3NzgsNyArMTc3OCw3IEBAIHN0YXRpYyBpbnQg
c3dpdGNoX2NvbnRleHQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJCX0KIAl9CiAKLQlpZiAo
cnEtPmh3X2NvbnRleHQtPnN0YXRlKSB7CisJaWYgKHJxLT5jb250ZXh0LT5zdGF0ZSkgewogCQlH
RU1fQlVHX09OKGVuZ2luZS0+aWQgIT0gUkNTMCk7CiAKIAkJLyoKQEAgLTE3ODgsNyArMTc4OCw3
IEBAIHN0YXRpYyBpbnQgc3dpdGNoX2NvbnRleHQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJ
CSAqIGFzIG5vdGhpbmcgYWN0dWFsbHkgZXhlY3V0ZXMgdXNpbmcgdGhlIGtlcm5lbCBjb250ZXh0
OyBpdAogCQkgKiBpcyBwdXJlbHkgdXNlZCBmb3IgZmx1c2hpbmcgdXNlciBjb250ZXh0cy4KIAkJ
ICovCi0JCWlmIChpOTE1X2dlbV9jb250ZXh0X2lzX2tlcm5lbChycS0+Z2VtX2NvbnRleHQpKQor
CQlpZiAoaTkxNV9nZW1fY29udGV4dF9pc19rZXJuZWwocnEtPmNvbnRleHQtPmdlbV9jb250ZXh0
KSkKIAkJCWh3X2ZsYWdzID0gTUlfUkVTVE9SRV9JTkhJQklUOwogCiAJCXJldCA9IG1pX3NldF9j
b250ZXh0KHJxLCBod19mbGFncyk7CkBAIC0xODM5LDcgKzE4MzksNyBAQCBzdGF0aWMgaW50IHJp
bmdfcmVxdWVzdF9hbGxvYyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0KQogewogCWludCBy
ZXQ7CiAKLQlHRU1fQlVHX09OKCFpbnRlbF9jb250ZXh0X2lzX3Bpbm5lZChyZXF1ZXN0LT5od19j
b250ZXh0KSk7CisJR0VNX0JVR19PTighaW50ZWxfY29udGV4dF9pc19waW5uZWQocmVxdWVzdC0+
Y29udGV4dCkpOwogCUdFTV9CVUdfT04ocmVxdWVzdC0+dGltZWxpbmUtPmhhc19pbml0aWFsX2Jy
ZWFkY3J1bWIpOwogCiAJLyoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Vj
L2ludGVsX2d1Y19zdWJtaXNzaW9uLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRl
bF9ndWNfc3VibWlzc2lvbi5jCmluZGV4IGEzN2FmYzYyNjZlYy4uMmZlNTcxNTFmYTllIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF9ndWNfc3VibWlzc2lvbi5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX2d1Y19zdWJtaXNzaW9uLmMK
QEAgLTQ2NCw3ICs0NjQsNyBAQCBzdGF0aWMgdm9pZCBndWNfYWRkX3JlcXVlc3Qoc3RydWN0IGlu
dGVsX2d1YyAqZ3VjLCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKIAlzdHJ1Y3QgaW50ZWxf
Z3VjX2NsaWVudCAqY2xpZW50ID0gZ3VjLT5leGVjYnVmX2NsaWVudDsKIAlzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmUgPSBycS0+ZW5naW5lOwotCXUzMiBjdHhfZGVzYyA9IGxvd2VyXzMy
X2JpdHMocnEtPmh3X2NvbnRleHQtPmxyY19kZXNjKTsKKwl1MzIgY3R4X2Rlc2MgPSBsb3dlcl8z
Ml9iaXRzKHJxLT5jb250ZXh0LT5scmNfZGVzYyk7CiAJdTMyIHJpbmdfdGFpbCA9IGludGVsX3Jp
bmdfc2V0X3RhaWwocnEtPnJpbmcsIHJxLT50YWlsKSAvIHNpemVvZih1NjQpOwogCiAJZ3VjX3dx
X2l0ZW1fYXBwZW5kKGNsaWVudCwgZW5naW5lLT5ndWNfaWQsIGN0eF9kZXNjLApAQCAtNTU1LDcg
KzU1NSw3IEBAIHN0YXRpYyB2b2lkIF9fZ3VjX2RlcXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lKQogCQlpbnQgaTsKIAogCQlwcmlvbGlzdF9mb3JfZWFjaF9yZXF1ZXN0X2NvbnN1
bWUocnEsIHJuLCBwLCBpKSB7Ci0JCQlpZiAobGFzdCAmJiBycS0+aHdfY29udGV4dCAhPSBsYXN0
LT5od19jb250ZXh0KSB7CisJCQlpZiAobGFzdCAmJiBycS0+Y29udGV4dCAhPSBsYXN0LT5jb250
ZXh0KSB7CiAJCQkJaWYgKHBvcnQgPT0gbGFzdF9wb3J0KQogCQkJCQlnb3RvIGRvbmU7CiAKQEAg
LTY1OCw3ICs2NTgsNyBAQCBzdGF0aWMgdm9pZCBndWNfcmVzZXQoc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lLCBib29sIHN0YWxsZWQpCiAJCXN0YWxsZWQgPSBmYWxzZTsKIAogCV9faTkx
NV9yZXF1ZXN0X3Jlc2V0KHJxLCBzdGFsbGVkKTsKLQlpbnRlbF9scl9jb250ZXh0X3Jlc2V0KGVu
Z2luZSwgcnEtPmh3X2NvbnRleHQsIHJxLT5oZWFkLCBzdGFsbGVkKTsKKwlpbnRlbF9scl9jb250
ZXh0X3Jlc2V0KGVuZ2luZSwgcnEtPmNvbnRleHQsIHJxLT5oZWFkLCBzdGFsbGVkKTsKIAogb3V0
X3VubG9jazoKIAlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZlbmdpbmUtPmFjdGl2ZS5sb2NrLCBm
bGFncyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVyLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVyLmMKaW5kZXggMWEyOGUzNjY2OTUx
Li4zYmY2MzczMDI4MjkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hl
ZHVsZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVyLmMKQEAgLTU4
LDcgKzU4LDcgQEAgc3RhdGljIHZvaWQgc2V0X2NvbnRleHRfcGRwX3Jvb3RfcG9pbnRlcigKIHN0
YXRpYyB2b2lkIHVwZGF0ZV9zaGFkb3dfcGRwcyhzdHJ1Y3QgaW50ZWxfdmdwdV93b3JrbG9hZCAq
d29ya2xvYWQpCiB7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKmN0eF9vYmogPQotCQl3
b3JrbG9hZC0+cmVxLT5od19jb250ZXh0LT5zdGF0ZS0+b2JqOworCQl3b3JrbG9hZC0+cmVxLT5j
b250ZXh0LT5zdGF0ZS0+b2JqOwogCXN0cnVjdCBleGVjbGlzdF9yaW5nX2NvbnRleHQgKnNoYWRv
d19yaW5nX2NvbnRleHQ7CiAJc3RydWN0IHBhZ2UgKnBhZ2U7CiAKQEAgLTEyOSw3ICsxMjksNyBA
QCBzdGF0aWMgaW50IHBvcHVsYXRlX3NoYWRvd19jb250ZXh0KHN0cnVjdCBpbnRlbF92Z3B1X3dv
cmtsb2FkICp3b3JrbG9hZCkKIAlzdHJ1Y3QgaW50ZWxfZ3Z0ICpndnQgPSB2Z3B1LT5ndnQ7CiAJ
aW50IHJpbmdfaWQgPSB3b3JrbG9hZC0+cmluZ19pZDsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqY3R4X29iaiA9Ci0JCXdvcmtsb2FkLT5yZXEtPmh3X2NvbnRleHQtPnN0YXRlLT5vYmo7
CisJCXdvcmtsb2FkLT5yZXEtPmNvbnRleHQtPnN0YXRlLT5vYmo7CiAJc3RydWN0IGV4ZWNsaXN0
X3JpbmdfY29udGV4dCAqc2hhZG93X3JpbmdfY29udGV4dDsKIAlzdHJ1Y3QgcGFnZSAqcGFnZTsK
IAl2b2lkICpkc3Q7CkBAIC0yMDQsOSArMjA0LDkgQEAgc3RhdGljIGludCBwb3B1bGF0ZV9zaGFk
b3dfY29udGV4dChzdHJ1Y3QgaW50ZWxfdmdwdV93b3JrbG9hZCAqd29ya2xvYWQpCiAJcmV0dXJu
IDA7CiB9CiAKLXN0YXRpYyBpbmxpbmUgYm9vbCBpc19ndnRfcmVxdWVzdChzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpyZXEpCitzdGF0aWMgaW5saW5lIGJvb2wgaXNfZ3Z0X3JlcXVlc3Qoc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnEpCiB7Ci0JcmV0dXJuIGk5MTVfZ2VtX2NvbnRleHRfZm9yY2Vfc2luZ2xl
X3N1Ym1pc3Npb24ocmVxLT5nZW1fY29udGV4dCk7CisJcmV0dXJuIGludGVsX2NvbnRleHRfZm9y
Y2Vfc2luZ2xlX3N1Ym1pc3Npb24ocnEtPmNvbnRleHQpOwogfQogCiBzdGF0aWMgdm9pZCBzYXZl
X3JpbmdfaHdfc3RhdGUoc3RydWN0IGludGVsX3ZncHUgKnZncHUsIGludCByaW5nX2lkKQpAQCAt
MzA2LDcgKzMwNiw3IEBAIHN0YXRpYyBpbnQgY29weV93b3JrbG9hZF90b19yaW5nX2J1ZmZlcihz
dHJ1Y3QgaW50ZWxfdmdwdV93b3JrbG9hZCAqd29ya2xvYWQpCiAJdTMyICpjczsKIAlpbnQgZXJy
OwogCi0JaWYgKElTX0dFTihyZXEtPmk5MTUsIDkpICYmIGlzX2luaGliaXRfY29udGV4dChyZXEt
Pmh3X2NvbnRleHQpKQorCWlmIChJU19HRU4ocmVxLT5pOTE1LCA5KSAmJiBpc19pbmhpYml0X2Nv
bnRleHQocmVxLT5jb250ZXh0KSkKIAkJaW50ZWxfdmdwdV9yZXN0b3JlX2luaGliaXRfY29udGV4
dCh2Z3B1LCByZXEpOwogCiAJLyoKQEAgLTUyOSw3ICs1MjksNyBAQCBzdGF0aWMgdm9pZCB1cGRh
dGVfd2FfY3R4XzJfc2hhZG93X2N0eChzdHJ1Y3QgaW50ZWxfc2hhZG93X3dhX2N0eCAqd2FfY3R4
KQogCQljb250YWluZXJfb2Yod2FfY3R4LCBzdHJ1Y3QgaW50ZWxfdmdwdV93b3JrbG9hZCwgd2Ff
Y3R4KTsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSA9IHdvcmtsb2FkLT5yZXE7CiAJc3RydWN0
IGV4ZWNsaXN0X3JpbmdfY29udGV4dCAqc2hhZG93X3JpbmdfY29udGV4dCA9Ci0JCShzdHJ1Y3Qg
ZXhlY2xpc3RfcmluZ19jb250ZXh0ICopcnEtPmh3X2NvbnRleHQtPmxyY19yZWdfc3RhdGU7CisJ
CShzdHJ1Y3QgZXhlY2xpc3RfcmluZ19jb250ZXh0ICopcnEtPmNvbnRleHQtPmxyY19yZWdfc3Rh
dGU7CiAKIAlzaGFkb3dfcmluZ19jb250ZXh0LT5iYl9wZXJfY3R4X3B0ci52YWwgPQogCQkoc2hh
ZG93X3JpbmdfY29udGV4dC0+YmJfcGVyX2N0eF9wdHIudmFsICYKQEAgLTc4Niw3ICs3ODYsNyBA
QCBzdGF0aWMgdm9pZCB1cGRhdGVfZ3Vlc3RfY29udGV4dChzdHJ1Y3QgaW50ZWxfdmdwdV93b3Jr
bG9hZCAqd29ya2xvYWQpCiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEgPSB3b3JrbG9hZC0+cmVx
OwogCXN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1ID0gd29ya2xvYWQtPnZncHU7CiAJc3RydWN0IGlu
dGVsX2d2dCAqZ3Z0ID0gdmdwdS0+Z3Z0OwotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpj
dHhfb2JqID0gcnEtPmh3X2NvbnRleHQtPnN0YXRlLT5vYmo7CisJc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKmN0eF9vYmogPSBycS0+Y29udGV4dC0+c3RhdGUtPm9iajsKIAlzdHJ1Y3QgZXhl
Y2xpc3RfcmluZ19jb250ZXh0ICpzaGFkb3dfcmluZ19jb250ZXh0OwogCXN0cnVjdCBwYWdlICpw
YWdlOwogCXZvaWQgKnNyYzsKQEAgLTEyMjcsOCArMTIyNyw2IEBAIGludCBpbnRlbF92Z3B1X3Nl
dHVwX3N1Ym1pc3Npb24oc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAJCWdvdG8gb3V0X3VubG9j
azsKIAl9CiAKLQlpOTE1X2dlbV9jb250ZXh0X3NldF9mb3JjZV9zaW5nbGVfc3VibWlzc2lvbihj
dHgpOwotCiAJaTkxNV9jb250ZXh0X3BwZ3R0X3Jvb3Rfc2F2ZShzLCBpOTE1X3ZtX3RvX3BwZ3R0
KGN0eC0+dm0pKTsKIAogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGkpIHsKQEAgLTEy
NDMsNiArMTI0MSw4IEBAIGludCBpbnRlbF92Z3B1X3NldHVwX3N1Ym1pc3Npb24oc3RydWN0IGlu
dGVsX3ZncHUgKnZncHUpCiAJCQlnb3RvIG91dF9zaGFkb3dfY3R4OwogCQl9CiAKKwkJaW50ZWxf
Y29udGV4dF9zZXRfc2luZ2xlX3N1Ym1pc3Npb24oY2UpOworCiAJCWlmICghVVNFU19HVUNfU1VC
TUlTU0lPTihpOTE1KSkgeyAvKiBNYXggcmluZyBidWZmZXIgc2l6ZSAqLwogCQkJY29uc3QgdW5z
aWduZWQgaW50IHJpbmdfc2l6ZSA9IDUxMiAqIFNaXzRLOwogCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0u
YwppbmRleCBkNTdlNDM4MTdhMGQuLjZlZDAyY2MwZGUzNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dl
bS5jCkBAIC0xMzEzLDkgKzEzMTMsOSBAQCBzdGF0aWMgaW50IF9faW50ZWxfZW5naW5lc19yZWNv
cmRfZGVmYXVsdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJCQljb250aW51ZTsK
IAogCQkvKiBXZSB3YW50IHRvIGJlIGFibGUgdG8gdW5iaW5kIHRoZSBzdGF0ZSBmcm9tIHRoZSBH
R1RUICovCi0JCUdFTV9CVUdfT04oaW50ZWxfY29udGV4dF9pc19waW5uZWQocnEtPmh3X2NvbnRl
eHQpKTsKKwkJR0VNX0JVR19PTihpbnRlbF9jb250ZXh0X2lzX3Bpbm5lZChycS0+Y29udGV4dCkp
OwogCi0JCXN0YXRlID0gcnEtPmh3X2NvbnRleHQtPnN0YXRlOworCQlzdGF0ZSA9IHJxLT5jb250
ZXh0LT5zdGF0ZTsKIAkJaWYgKCFzdGF0ZSkKIAkJCWNvbnRpbnVlOwogCkBAIC0xMzY3LDcgKzEz
NjcsNyBAQCBzdGF0aWMgaW50IF9faW50ZWxfZW5naW5lc19yZWNvcmRfZGVmYXVsdHMoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJCWlmICghcnEpCiAJCQljb250aW51ZTsKIAotCQlj
ZSA9IHJxLT5od19jb250ZXh0OworCQljZSA9IHJxLT5jb250ZXh0OwogCQlpOTE1X3JlcXVlc3Rf
cHV0KHJxKTsKIAkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwogCX0KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dwdV9lcnJvci5jCmluZGV4IDNiNWJmZTUwZTAwYS4uZWU5ZWJkNmMxNTczIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMKQEAgLTExNjksNyArMTE2OSw3IEBAIHN0YXRp
YyB2b2lkIGVycm9yX3JlY29yZF9lbmdpbmVfcmVnaXN0ZXJzKHN0cnVjdCBpOTE1X2dwdV9zdGF0
ZSAqZXJyb3IsCiBzdGF0aWMgdm9pZCByZWNvcmRfcmVxdWVzdChjb25zdCBzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpyZXF1ZXN0LAogCQkJICAgc3RydWN0IGRybV9pOTE1X2Vycm9yX3JlcXVlc3QgKmVy
cSkKIHsKLQljb25zdCBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4ID0gcmVxdWVzdC0+Z2Vt
X2NvbnRleHQ7CisJY29uc3Qgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IHJlcXVlc3Qt
PmNvbnRleHQtPmdlbV9jb250ZXh0OwogCiAJZXJxLT5mbGFncyA9IHJlcXVlc3QtPmZlbmNlLmZs
YWdzOwogCWVycS0+Y29udGV4dCA9IHJlcXVlc3QtPmZlbmNlLmNvbnRleHQ7CkBAIC0xMTgxLDcg
KzExODEsNyBAQCBzdGF0aWMgdm9pZCByZWNvcmRfcmVxdWVzdChjb25zdCBzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpyZXF1ZXN0LAogCWVycS0+dGFpbCA9IHJlcXVlc3QtPnRhaWw7CiAKIAlyY3VfcmVh
ZF9sb2NrKCk7Ci0JZXJxLT5waWQgPSBjdHgtPnBpZCA/IHBpZF9ucihjdHgtPnBpZCkgOiAwOwor
CWVycS0+cGlkID0gY3R4ICYmIGN0eC0+cGlkID8gcGlkX25yKGN0eC0+cGlkKSA6IDA7CiAJcmN1
X3JlYWRfdW5sb2NrKCk7CiB9CiAKQEAgLTEyNDksNyArMTI0OSwxMCBAQCBzdGF0aWMgdm9pZCBl
cnJvcl9yZWNvcmRfZW5naW5lX2V4ZWNsaXN0cyhjb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmUsCiBzdGF0aWMgYm9vbCByZWNvcmRfY29udGV4dChzdHJ1Y3QgZHJtX2k5MTVfZXJy
b3JfY29udGV4dCAqZSwKIAkJCSAgIGNvbnN0IHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogewot
CWNvbnN0IHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHggPSBycS0+Z2VtX2NvbnRleHQ7CisJ
Y29uc3Qgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IHJxLT5jb250ZXh0LT5nZW1fY29u
dGV4dDsKKworCWlmICghY3R4KQorCQlyZXR1cm4gZmFsc2U7CiAKIAlpZiAoY3R4LT5waWQpIHsK
IAkJc3RydWN0IHRhc2tfc3RydWN0ICp0YXNrOwpAQCAtMTQwMyw3ICsxNDA2LDcgQEAgZ2VtX3Jl
Y29yZF9yaW5ncyhzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKmVycm9yLCBzdHJ1Y3QgY29tcHJlc3Mg
KmNvbXByZXNzKQogCQljYXB0dXJlID0gcmVxdWVzdF9yZWNvcmRfdXNlcl9ibyhyZXF1ZXN0LCBl
ZSwgY2FwdHVyZSk7CiAKIAkJY2FwdHVyZSA9IGNhcHR1cmVfdm1hKGNhcHR1cmUsCi0JCQkJICAg
ICAgcmVxdWVzdC0+aHdfY29udGV4dC0+c3RhdGUsCisJCQkJICAgICAgcmVxdWVzdC0+Y29udGV4
dC0+c3RhdGUsCiAJCQkJICAgICAgJmVlLT5jdHgpOwogCiAJCWNhcHR1cmUgPSBjYXB0dXJlX3Zt
YShjYXB0dXJlLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYwppbmRleCA3MTcwY2NiM2M2
NzcuLmM2YWM2YjkxMjU5NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9y
ZXF1ZXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKQEAgLTcy
LDcgKzcyLDcgQEAgc3RhdGljIGNvbnN0IGNoYXIgKmk5MTVfZmVuY2VfZ2V0X3RpbWVsaW5lX25h
bWUoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCiAJaWYgKHRlc3RfYml0KERNQV9GRU5DRV9GTEFH
X1NJR05BTEVEX0JJVCwgJmZlbmNlLT5mbGFncykpCiAJCXJldHVybiAic2lnbmFsZWQiOwogCi0J
cmV0dXJuIHRvX3JlcXVlc3QoZmVuY2UpLT5nZW1fY29udGV4dC0+bmFtZSA/OiAiW2k5MTVdIjsK
KwlyZXR1cm4gdG9fcmVxdWVzdChmZW5jZSktPmNvbnRleHQtPmdlbV9jb250ZXh0LT5uYW1lID86
ICJbaTkxNV0iOwogfQogCiBzdGF0aWMgYm9vbCBpOTE1X2ZlbmNlX3NpZ25hbGVkKHN0cnVjdCBk
bWFfZmVuY2UgKmZlbmNlKQpAQCAtMjg1LDggKzI4NSw4IEBAIHN0YXRpYyBib29sIGk5MTVfcmVx
dWVzdF9yZXRpcmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJaTkxNV9yZXF1ZXN0X3JlbW92
ZV9mcm9tX2NsaWVudChycSk7CiAJbGlzdF9kZWwoJnJxLT5saW5rKTsKIAotCWludGVsX2NvbnRl
eHRfZXhpdChycS0+aHdfY29udGV4dCk7Ci0JaW50ZWxfY29udGV4dF91bnBpbihycS0+aHdfY29u
dGV4dCk7CisJaW50ZWxfY29udGV4dF9leGl0KHJxLT5jb250ZXh0KTsKKwlpbnRlbF9jb250ZXh0
X3VucGluKHJxLT5jb250ZXh0KTsKIAogCWZyZWVfY2FwdHVyZV9saXN0KHJxKTsKIAlpOTE1X3Nj
aGVkX25vZGVfZmluaSgmcnEtPnNjaGVkKTsKQEAgLTM3MCw3ICszNzAsNyBAQCB2b2lkIF9faTkx
NV9yZXF1ZXN0X3N1Ym1pdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0KQogCUdFTV9CVUdf
T04oIWlycXNfZGlzYWJsZWQoKSk7CiAJbG9ja2RlcF9hc3NlcnRfaGVsZCgmZW5naW5lLT5hY3Rp
dmUubG9jayk7CiAKLQlpZiAoaTkxNV9nZW1fY29udGV4dF9pc19iYW5uZWQocmVxdWVzdC0+Z2Vt
X2NvbnRleHQpKQorCWlmIChpbnRlbF9jb250ZXh0X2lzX2Jhbm5lZChyZXF1ZXN0LT5jb250ZXh0
KSkKIAkJaTkxNV9yZXF1ZXN0X3NraXAocmVxdWVzdCwgLUVJTyk7CiAKIAkvKgpAQCAtNjMzLDgg
KzYzMyw3IEBAIF9faTkxNV9yZXF1ZXN0X2NyZWF0ZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2Us
IGdmcF90IGdmcCkKIAkJZ290byBlcnJfZnJlZTsKIAogCXJxLT5pOTE1ID0gY2UtPmVuZ2luZS0+
aTkxNTsKLQlycS0+aHdfY29udGV4dCA9IGNlOwotCXJxLT5nZW1fY29udGV4dCA9IGNlLT5nZW1f
Y29udGV4dDsKKwlycS0+Y29udGV4dCA9IGNlOwogCXJxLT5lbmdpbmUgPSBjZS0+ZW5naW5lOwog
CXJxLT5yaW5nID0gY2UtPnJpbmc7CiAJcnEtPnRpbWVsaW5lID0gdGw7CkBAIC04NTMsNyArODUy
LDcgQEAgaTkxNV9yZXF1ZXN0X2F3YWl0X3JlcXVlc3Qoc3RydWN0IGk5MTVfcmVxdWVzdCAqdG8s
IHN0cnVjdCBpOTE1X3JlcXVlc3QgKmZyb20pCiAJCQkJCQkgICAgICAgJmZyb20tPnN1Ym1pdCwK
IAkJCQkJCSAgICAgICBJOTE1X0ZFTkNFX0dGUCk7CiAJfSBlbHNlIGlmIChpbnRlbF9lbmdpbmVf
aGFzX3NlbWFwaG9yZXModG8tPmVuZ2luZSkgJiYKLQkJICAgdG8tPmdlbV9jb250ZXh0LT5zY2hl
ZC5wcmlvcml0eSA+PSBJOTE1X1BSSU9SSVRZX05PUk1BTCkgeworCQkgICB0by0+Y29udGV4dC0+
Z2VtX2NvbnRleHQtPnNjaGVkLnByaW9yaXR5ID49IEk5MTVfUFJJT1JJVFlfTk9STUFMKSB7CiAJ
CXJldCA9IGVtaXRfc2VtYXBob3JlX3dhaXQodG8sIGZyb20sIEk5MTVfRkVOQ0VfR0ZQKTsKIAl9
IGVsc2UgewogCQlyZXQgPSBpOTE1X3N3X2ZlbmNlX2F3YWl0X2RtYV9mZW5jZSgmdG8tPnN1Ym1p
dCwKQEAgLTExNzgsNyArMTE3Nyw3IEBAIHZvaWQgX19pOTE1X3JlcXVlc3RfcXVldWUoc3RydWN0
IGk5MTVfcmVxdWVzdCAqcnEsCiAKIHZvaWQgaTkxNV9yZXF1ZXN0X2FkZChzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpycSkKIHsKLQlzdHJ1Y3QgaTkxNV9zY2hlZF9hdHRyIGF0dHIgPSBycS0+Z2VtX2Nv
bnRleHQtPnNjaGVkOworCXN0cnVjdCBpOTE1X3NjaGVkX2F0dHIgYXR0ciA9IHJxLT5jb250ZXh0
LT5nZW1fY29udGV4dC0+c2NoZWQ7CiAJc3RydWN0IGludGVsX3RpbWVsaW5lICogY29uc3QgdGwg
PSBycS0+dGltZWxpbmU7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcHJldjsKIApkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmggYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3JlcXVlc3QuaAppbmRleCA4YWM2ZTEyMjZhNTYuLmZkNDFhYmJmYzc1YiAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmgKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmgKQEAgLTEwOSw5ICsxMDksOCBAQCBzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0IHsKIAkgKiBpOTE1X3JlcXVlc3RfZnJlZSgpIHdpbGwgdGhlbiBkZWNyZW1l
bnQgdGhlIHJlZmNvdW50IG9uIHRoZQogCSAqIGNvbnRleHQuCiAJICovCi0Jc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHQgKmdlbV9jb250ZXh0OwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZTsKLQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqaHdfY29udGV4dDsKKwlzdHJ1Y3QgaW50ZWxfY29u
dGV4dCAqY29udGV4dDsKIAlzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZzsKIAlzdHJ1Y3QgaW50ZWxf
dGltZWxpbmUgKnRpbWVsaW5lOwogCXN0cnVjdCBsaXN0X2hlYWQgc2lnbmFsX2xpbms7Ci0tIAoy
LjIzLjAucmMxCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
XwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcK
aHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 615363AF76
	for <lists+intel-gfx@lfdr.de>; Mon, 10 Jun 2019 09:21:39 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5907389107;
	Mon, 10 Jun 2019 07:21:36 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 325AA88FA4
 for <intel-gfx@lists.freedesktop.org>; Mon, 10 Jun 2019 07:21:33 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16848381-1500050 
 for multiple; Mon, 10 Jun 2019 08:21:32 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 10 Jun 2019 08:21:26 +0100
Message-Id: <20190610072126.6355-29-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190610072126.6355-1-chris@chris-wilson.co.uk>
References: <20190610072126.6355-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 28/28] drm/i915: Use vm->mutex for serialising
 GTT insertion
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U2VyaWFsaXNpbmcgaW5zZXJ0aW9uIGludG8gZWFjaCBvZiB0aGUgZ2xvYmFsIEdUVCBhbmQgcHBH
VFQgYWNjb3VudHMgZm9yCmEgbGFyZ2UgY2h1bmsgb2YgdGhlIGN1cnJlbnQgc3RydWN0X211dGV4
IHNlcmlhbGlzYXRpb24gcmVxdWlyZWVtbnRzLgooTm90ZSB0aGF0IGl0IGlzIG5vdCBqdXN0IHRo
ZSBkcm1fbW0gLyBndHQgbWFuYWdlbWVudCBpdHNlbGYgYmVpbmcKc2VyaWFsaXNlZCwgYnV0IHRo
ZSBwaW4gY291bnQgYW5kIHZhcmlvdXMgZmxhZ3MuKSBQcmV2aW91c2x5LCB0aGUgbWFpbgpibG9j
a2VyIGZvciByZXBsYWNpbmcgdGhpcyBtdXRleCB3YXMgdGhlIHJlc2V0IGhhbmRpbmcsIGJ1dCB3
aXRoIHRoZQphZHZlbnQgb2YgImxvY2tsZXNzIiByZXNldHMsIHdlIGNhbiBmcmVlbHkgdGFrZSB0
aGUgdm0tPm11dGV4IGFuZCBibG9jawp3YWl0aW5nIGZvciB0aGUgR1BVICh3aXRob3V0IGZlYXIg
b2YgZGVhZGxvY2sgaWYgdGhlIEdQVSBoYW5ncykuIFdlIGFsc28KcHJvc2NyaWJlIGFsbG9jYXRp
b25zIHVuZGVybmVhdGggdm0tPm11dGV4LCBhbGxvd2luZyB1cyB0byB0YWtlIHRoZQptdXRleCBp
bnNpZGUgdGhlIHNocmlua2VyLCBhdm9pZGluZyB0aGUgcmVjdXJzaXZlIHN0cnVjdF9tdXRleCB3
ZQpwcmV2aW91c2x5IHVzZWQuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNo
cmlzLXdpbHNvbi5jby51az4KLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGll
bnRfYmx0LmMgICAgfCAgIDcgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9k
b21haW4uYyAgICB8ICAzMyArKy0tLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhl
Y2J1ZmZlci5jICAgIHwgICA1ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
bW1hbi5jICAgICAgfCAgMjcgKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X29iamVjdC5jICAgIHwgIDExICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
b2JqZWN0LmggICAgfCAgIDMgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVj
dF90eXBlcy5oICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3No
cmlua2VyLmMgIHwgIDkzICstLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9zdG9sZW4uYyAgICB8ICAgNSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX3RpbGluZy5jICAgIHwgIDYwICsrKysrLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX3VzZXJwdHIuYyAgIHwgIDI4ICstLS0KIC4uLi9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL2k5MTVfZ2VtX21tYW4uYyAgICB8ICAgMiArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9jb250ZXh0LmMgICAgICAgfCAgIDUgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX3JpbmdidWZmZXIuYyAgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0
L2FwZXJ0dXJlX2dtLmMgICAgICAgIHwgIDIyICsrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZGVidWdmcy5jICAgICAgICAgICB8ICAxMCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9nZW0uYyAgICAgICAgICAgICAgIHwgMTIzICsrKysrKysrKysrLS0tLS0tLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9nZW1fZXZpY3QuYyAgICAgICAgIHwgIDI4ICstLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5jICAgICB8ICA3MSArKysrKy0tLS0tCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYyAgICAgICAgICAgfCAgODUgKystLS0t
LS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaCAgICAgICAgICAgfCAg
IDMgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgICAgICAgICAgICAgIHwgIDIw
ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYyAgICAgICAgICAgICAgIHwgIDc3
ICsrKysrKy0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5oICAgICAgICAgICAg
ICAgfCAgNjEgKysrLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kaXNwbGF5LmMg
ICAgICAgICAgfCAgMzIgKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2ZiZGV2LmMg
ICAgICAgICAgICB8ICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjLmMgICAg
ICAgICAgICAgIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX292ZXJsYXkuYyAg
ICAgICAgICB8ICAxMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfdm1h
LmMgICAgIHwgICAyICsKIDI5IGZpbGVzIGNoYW5nZWQsIDMwMSBpbnNlcnRpb25zKCspLCA1Mzkg
ZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX2NsaWVudF9ibHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGll
bnRfYmx0LmMKaW5kZXggZjI1M2VjNTc2NWFkLi40NTNmNTAxODJmNTUgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsaWVudF9ibHQuYwpAQCAtMTU0LDcgKzE1NCw2
IEBAIHN0YXRpYyB2b2lkIGNsZWFyX3BhZ2VzX2RtYV9mZW5jZV9jYihzdHJ1Y3QgZG1hX2ZlbmNl
ICpmZW5jZSwKIHN0YXRpYyB2b2lkIGNsZWFyX3BhZ2VzX3dvcmtlcihzdHJ1Y3Qgd29ya19zdHJ1
Y3QgKndvcmspCiB7CiAJc3RydWN0IGNsZWFyX3BhZ2VzX3dvcmsgKncgPSBjb250YWluZXJfb2Yo
d29yaywgdHlwZW9mKCp3KSwgd29yayk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSB3LT5jZS0+Z2VtX2NvbnRleHQtPmk5MTU7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iaiA9IHctPnNsZWV2ZS0+b2JqOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hID0gdy0+c2xlZXZl
LT52bWE7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CkBAIC0xNzAsMTEgKzE2OSw5IEBAIHN0
YXRpYyB2b2lkIGNsZWFyX3BhZ2VzX3dvcmtlcihzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJ
CW9iai0+Y2FjaGVfZGlydHkgPSBmYWxzZTsKIAl9CiAKLQkvKiBYWFg6IHdlIG5lZWQgdG8ga2ls
bCB0aGlzICovCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJZXJyID0g
aTkxNV92bWFfcGluKHZtYSwgMCwgMCwgUElOX1VTRVIpOwogCWlmICh1bmxpa2VseShlcnIpKQot
CQlnb3RvIG91dF91bmxvY2s7CisJCWdvdG8gb3V0X3NpZ25hbDsKIAogCXJxID0gaTkxNV9yZXF1
ZXN0X2NyZWF0ZSh3LT5jZSk7CiAJaWYgKElTX0VSUihycSkpIHsKQEAgLTIxMCw4ICsyMDcsNiBA
QCBzdGF0aWMgdm9pZCBjbGVhcl9wYWdlc193b3JrZXIoc3RydWN0IHdvcmtfc3RydWN0ICp3b3Jr
KQogCWk5MTVfcmVxdWVzdF9hZGQocnEpOwogb3V0X3VucGluOgogCWk5MTVfdm1hX3VucGluKHZt
YSk7Ci1vdXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiBvdXRfc2lnbmFsOgogCWlmICh1bmxpa2VseShlcnIpKSB7CiAJCWRtYV9mZW5jZV9zZXRfZXJy
b3IoJnctPmRtYSwgZXJyKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9kb21haW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21h
aW4uYwppbmRleCA3ZTZlZDc2NzM0OGMuLjU2YWFkZThmYjcwMiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYwpAQCAtMjYsNyArMjYsNyBAQCBzdGF0aWMgdm9p
ZCBfX2k5MTVfZ2VtX29iamVjdF9mbHVzaF9mb3JfZGlzcGxheShzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqKQogCiB2b2lkIGk5MTVfZ2VtX29iamVjdF9mbHVzaF9pZl9kaXNwbGF5KHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiB7Ci0JaWYgKCFSRUFEX09OQ0Uob2JqLT5w
aW5fZ2xvYmFsKSkKKwlpZiAoIWF0b21pY19yZWFkKCZvYmotPnBpbl9nbG9iYWwpKQogCQlyZXR1
cm47CiAKIAlpOTE1X2dlbV9vYmplY3RfbG9jayhvYmopOwpAQCAtMzY5LDE2ICszNjksMTEgQEAg
aW50IGk5MTVfZ2VtX3NldF9jYWNoaW5nX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZv
aWQgKmRhdGEsCiAJaWYgKHJldCkKIAkJZ290byBvdXQ7CiAKLQlyZXQgPSBtdXRleF9sb2NrX2lu
dGVycnVwdGlibGUoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChyZXQpCi0JCWdvdG8g
b3V0OwotCiAJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X2xvY2tfaW50ZXJydXB0aWJsZShvYmopOwog
CWlmIChyZXQgPT0gMCkgewogCQlyZXQgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X2NhY2hlX2xldmVs
KG9iaiwgbGV2ZWwpOwogCQlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKG9iaik7CiAJfQotCW11dGV4
X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIG91dDoKIAlpOTE1X2dlbV9vYmpl
Y3RfcHV0KG9iaik7CkBAIC00MDUsNyArNDAwLDcgQEAgaTkxNV9nZW1fb2JqZWN0X3Bpbl90b19k
aXNwbGF5X3BsYW5lKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJLyogTWFyayB0
aGUgZ2xvYmFsIHBpbiBlYXJseSBzbyB0aGF0IHdlIGFjY291bnQgZm9yIHRoZQogCSAqIGRpc3Bs
YXkgY29oZXJlbmN5IHdoaWxzdCBzZXR0aW5nIHVwIHRoZSBjYWNoZSBkb21haW5zLgogCSAqLwot
CW9iai0+cGluX2dsb2JhbCsrOworCWF0b21pY19pbmMoJm9iai0+cGluX2dsb2JhbCk7CiAKIAkv
KiBUaGUgZGlzcGxheSBlbmdpbmUgaXMgbm90IGNvaGVyZW50IHdpdGggdGhlIExMQyBjYWNoZSBv
biBnZW42LiAgQXMKIAkgKiBhIHJlc3VsdCwgd2UgbWFrZSBzdXJlIHRoYXQgdGhlIHBpbm5pbmcg
dGhhdCBpcyBhYm91dCB0byBvY2N1ciBpcwpAQCAtNDU1LDI1ICs0NTAsMjcgQEAgaTkxNV9nZW1f
b2JqZWN0X3Bpbl90b19kaXNwbGF5X3BsYW5lKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
YmosCiAJcmV0dXJuIHZtYTsKIAogZXJyX3VucGluX2dsb2JhbDoKLQlvYmotPnBpbl9nbG9iYWwt
LTsKKwlhdG9taWNfZGVjKCZvYmotPnBpbl9nbG9iYWwpOwogCXJldHVybiB2bWE7CiB9CiAKIHN0
YXRpYyB2b2lkIGk5MTVfZ2VtX29iamVjdF9idW1wX2luYWN0aXZlX2dndHQoc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaikKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IHRvX2k5MTUob2JqLT5iYXNlLmRldik7Ci0Jc3RydWN0IGk5MTVfdm1hICp2bWE7CiAKIAlHRU1f
QlVHX09OKCFpOTE1X2dlbV9vYmplY3RfaGFzX3Bpbm5lZF9wYWdlcyhvYmopKTsKIAotCW11dGV4
X2xvY2soJmk5MTUtPmdndHQudm0ubXV0ZXgpOwotCWZvcl9lYWNoX2dndHRfdm1hKHZtYSwgb2Jq
KSB7Ci0JCWlmICghZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKQotCQkJY29udGlu
dWU7CisJaWYgKG11dGV4X3RyeWxvY2soJmk5MTUtPmdndHQudm0ubXV0ZXgpKSB7CisJCXN0cnVj
dCBpOTE1X3ZtYSAqdm1hOwogCi0JCWxpc3RfbW92ZV90YWlsKCZ2bWEtPnZtX2xpbmssICZ2bWEt
PnZtLT5ib3VuZF9saXN0KTsKKwkJZm9yX2VhY2hfZ2d0dF92bWEodm1hLCBvYmopIHsKKwkJCWlm
ICghZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKQorCQkJCWNvbnRpbnVlOworCisJ
CQlsaXN0X21vdmVfdGFpbCgmdm1hLT52bV9saW5rLCAmdm1hLT52bS0+Ym91bmRfbGlzdCk7CisJ
CX0KKwkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIAl9Ci0JbXV0ZXhfdW5s
b2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIAogCWlmIChpOTE1X2dlbV9vYmplY3RfaXNfc2hy
aW5rYWJsZShvYmopKSB7CiAJCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CkBAIC00OTIsMTIgKzQ4OSwx
MCBAQCBpOTE1X2dlbV9vYmplY3RfdW5waW5fZnJvbV9kaXNwbGF5X3BsYW5lKHN0cnVjdCBpOTE1
X3ZtYSAqdm1hKQogewogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB2bWEtPm9i
ajsKIAotCWFzc2VydF9vYmplY3RfaGVsZChvYmopOwotCi0JaWYgKFdBUk5fT04ob2JqLT5waW5f
Z2xvYmFsID09IDApKQorCWlmIChHRU1fV0FSTl9PTighYXRvbWljX3JlYWQoJm9iai0+cGluX2ds
b2JhbCkpKQogCQlyZXR1cm47CiAKLQlpZiAoLS1vYmotPnBpbl9nbG9iYWwgPT0gMCkKKwlpZiAo
YXRvbWljX2RlY19hbmRfdGVzdCgmb2JqLT5waW5fZ2xvYmFsKSkKIAkJdm1hLT5kaXNwbGF5X2Fs
aWdubWVudCA9IEk5MTVfR1RUX01JTl9BTElHTk1FTlQ7CiAKIAkvKiBCdW1wIHRoZSBMUlUgdG8g
dHJ5IGFuZCBhdm9pZCBwcmVtYXR1cmUgZXZpY3Rpb24gd2hpbHN0IGZsaXBwaW5nICAqLwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKaW5kZXggY2Ni
MDg5NDIwODMwLi5jZGMxYmQyODVjNjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX2V4ZWNidWZmZXIuYwpAQCAtNTQ3LDggKzU0NywxMSBAQCBlYl9hZGRfdm1hKHN0
cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViLAogCQllYl91bnJlc2VydmVfdm1hKHZtYSwgdm1hLT5l
eGVjX2ZsYWdzKTsKIAogCQlsaXN0X2FkZF90YWlsKCZ2bWEtPmV4ZWNfbGluaywgJmViLT51bmJv
dW5kKTsKLQkJaWYgKGRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5ub2RlKSkKKwkJaWYgKGRy
bV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5ub2RlKSkgeworCQkJbXV0ZXhfbG9jaygmdm1hLT52
bS0+bXV0ZXgpOwogCQkJZXJyID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CisJCQltdXRleF91bmxv
Y2soJnZtYS0+dm0tPm11dGV4KTsKKwkJfQogCQlpZiAodW5saWtlbHkoZXJyKSkKIAkJCXZtYS0+
ZXhlY19mbGFncyA9IE5VTEw7CiAJfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX21tYW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9t
bWFuLmMKaW5kZXggNDljZjlhZDk3YmZjLi45ZmEwNTY5YWZiNTAgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYwpAQCAtMjQ4LDE2ICsyNDgsNiBAQCB2bV9mYXVsdF90
IGk5MTVfZ2VtX2ZhdWx0KHN0cnVjdCB2bV9mYXVsdCAqdm1mKQogCQlnb3RvIGVycl9ycG07CiAJ
fQogCi0JcmV0ID0gaTkxNV9tdXRleF9sb2NrX2ludGVycnVwdGlibGUoZGV2KTsKLQlpZiAocmV0
KQotCQlnb3RvIGVycl9yZXNldDsKLQotCS8qIEFjY2VzcyB0byBzbm9vcGFibGUgcGFnZXMgdGhy
b3VnaCB0aGUgR1RUIGlzIGluY29oZXJlbnQuICovCi0JaWYgKG9iai0+Y2FjaGVfbGV2ZWwgIT0g
STkxNV9DQUNIRV9OT05FICYmICFIQVNfTExDKGk5MTUpKSB7Ci0JCXJldCA9IC1FRkFVTFQ7Ci0J
CWdvdG8gZXJyX3VubG9jazsKLQl9Ci0KIAkvKiBOb3cgcGluIGl0IGludG8gdGhlIEdUVCBhcyBu
ZWVkZWQgKi8KIAl2bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4ob2JqLCBOVUxMLCAwLCAw
LAogCQkJCSAgICAgICBQSU5fTUFQUEFCTEUgfApAQCAtMjg3LDEzICsyNzcsMTkgQEAgdm1fZmF1
bHRfdCBpOTE1X2dlbV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikKIAl9CiAJaWYgKElTX0VS
Uih2bWEpKSB7CiAJCXJldCA9IFBUUl9FUlIodm1hKTsKLQkJZ290byBlcnJfdW5sb2NrOworCQln
b3RvIGVycl9yZXNldDsKIAl9CiAKLQlyZXQgPSBpOTE1X3ZtYV9waW5fZmVuY2Uodm1hKTsKKwlh
c3NlcnRfcnBtX3dha2Vsb2NrX2hlbGQoaTkxNSk7CisKKwlyZXQgPSBtdXRleF9sb2NrX2ludGVy
cnVwdGlibGUoJnZtYS0+dm0tPm11dGV4KTsKIAlpZiAocmV0KQogCQlnb3RvIGVycl91bnBpbjsK
IAorCXJldCA9IF9faTkxNV92bWFfcGluX2ZlbmNlKHZtYSk7CisJaWYgKHJldCkKKwkJZ290byBl
cnJfdW5sb2NrOworCiAJLyogRmluYWxseSwgcmVtYXAgaXQgdXNpbmcgdGhlIG5ldyBHVFQgb2Zm
c2V0ICovCiAJcmV0ID0gcmVtYXBfaW9fbWFwcGluZyhhcmVhLAogCQkJICAgICAgIGFyZWEtPnZt
X3N0YXJ0ICsgKHZtYS0+Z2d0dF92aWV3LnBhcnRpYWwub2Zmc2V0IDw8IFBBR0VfU0hJRlQpLApA
QCAtMzA0LDcgKzMwMCw2IEBAIHZtX2ZhdWx0X3QgaTkxNV9nZW1fZmF1bHQoc3RydWN0IHZtX2Zh
dWx0ICp2bWYpCiAJCWdvdG8gZXJyX2ZlbmNlOwogCiAJLyogTWFyayBhcyBiZWluZyBtbWFwcGVk
IGludG8gdXNlcnNwYWNlIGZvciBsYXRlciByZXZvY2F0aW9uICovCi0JYXNzZXJ0X3JwbV93YWtl
bG9ja19oZWxkKGk5MTUpOwogCWlmICghaTkxNV92bWFfc2V0X3VzZXJmYXVsdCh2bWEpICYmICFv
YmotPnVzZXJmYXVsdF9jb3VudCsrKQogCQlsaXN0X2FkZCgmb2JqLT51c2VyZmF1bHRfbGluaywg
Jmk5MTUtPmdndHQudXNlcmZhdWx0X2xpc3QpOwogCWlmIChDT05GSUdfRFJNX0k5MTVfVVNFUkZB
VUxUX0FVVE9TVVNQRU5EKQpAQCAtMzE2LDEwICszMTEsMTAgQEAgdm1fZmF1bHRfdCBpOTE1X2dl
bV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikKIAogZXJyX2ZlbmNlOgogCWk5MTVfdm1hX3Vu
cGluX2ZlbmNlKHZtYSk7CitlcnJfdW5sb2NrOgorCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0
ZXgpOwogZXJyX3VucGluOgogCV9faTkxNV92bWFfdW5waW4odm1hKTsKLWVycl91bmxvY2s6Ci0J
bXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CiBlcnJfcmVzZXQ6CiAJaTkxNV9yZXNl
dF91bmxvY2soaTkxNSwgc3JjdSk7CiBlcnJfcnBtOgpAQCAtNDA1LDcgKzQwMCw3IEBAIHZvaWQg
aTkxNV9nZW1fb2JqZWN0X3JlbGVhc2VfbW1hcChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqKQogCSAqIHJlcXVpcmVtZW50IHRoYXQgb3BlcmF0aW9ucyB0byB0aGUgR0dUVCBiZSBtYWRl
IGhvbGRpbmcgdGhlIFJQTQogCSAqIHdha2VyZWYuCiAJICovCi0JbG9ja2RlcF9hc3NlcnRfaGVs
ZCgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+
Z2d0dC52bS5tdXRleCk7CiAJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KGk5MTUpOwog
CiAJaWYgKCFvYmotPnVzZXJmYXVsdF9jb3VudCkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9vYmplY3QuYwppbmRleCBlZTY5Y2Q3OTQ4YzAuLmE2MmJhNWRlNTZiNCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYwpAQCAtMTc0LDEyICsxNzQs
MTUgQEAgc3RhdGljIHZvaWQgX19pOTE1X2dlbV9mcmVlX29iamVjdHMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAKIAkJdHJhY2VfaTkxNV9nZW1fb2JqZWN0X2Rlc3Ryb3kob2JqKTsK
IAotCQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCQlsaXN0X2Zvcl9l
YWNoX2VudHJ5X3NhZmUodm1hLCB2biwgJm9iai0+dm1hLmxpc3QsIG9ial9saW5rKSB7CisJCQlz
dHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IHZtYS0+dm07CisKIAkJCUdFTV9CVUdfT04o
aTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpOwotCQkJdm1hLT5mbGFncyAmPSB+STkxNV9WTUFfUElO
X01BU0s7CisJCQlhdG9taWNfc2V0KCZ2bWEtPnBpbl9jb3VudCwgMCk7CisKKwkJCW11dGV4X2xv
Y2soJnZtLT5tdXRleCk7CiAJCQlpOTE1X3ZtYV9kZXN0cm95KHZtYSk7CisJCQltdXRleF91bmxv
Y2soJnZtLT5tdXRleCk7CiAJCX0KIAkJR0VNX0JVR19PTighbGlzdF9lbXB0eSgmb2JqLT52bWEu
bGlzdCkpOwogCQlHRU1fQlVHX09OKCFSQl9FTVBUWV9ST09UKCZvYmotPnZtYS50cmVlKSk7CkBA
IC0yMDAsOCArMjAzLDYgQEAgc3RhdGljIHZvaWQgX19pOTE1X2dlbV9mcmVlX29iamVjdHMoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZp
OTE1LT5tbS5vYmpfbG9jaywgZmxhZ3MpOwogCQl9CiAKLQkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKLQogCQlHRU1fQlVHX09OKGF0b21pY19yZWFkKCZvYmotPmJpbmRf
Y291bnQpKTsKIAkJR0VNX0JVR19PTihvYmotPnVzZXJmYXVsdF9jb3VudCk7CiAJCUdFTV9CVUdf
T04oIWxpc3RfZW1wdHkoJm9iai0+bHV0X2xpc3QpKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9vYmplY3QuaAppbmRleCA3ZWE4MDEzZDEwOGYuLjBmYzU0OTI0YjMzYSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaApAQCAtNDAzLDcgKzQw
Myw4IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBjcHVfd3JpdGVfbmVlZHNfY2xmbHVzaChzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCWlmICghKG9iai0+Y2FjaGVfY29oZXJlbnQgJiBJ
OTE1X0JPX0NBQ0hFX0NPSEVSRU5UX0ZPUl9XUklURSkpCiAJCXJldHVybiB0cnVlOwogCi0JcmV0
dXJuIG9iai0+cGluX2dsb2JhbDsgLyogY3VycmVudGx5IGluIHVzZSBieSBIVywga2VlcCBmbHVz
aGVkICovCisJLyogQ3VycmVudGx5IGluIHVzZSBieSBIVz8gS2VlcCBmbHVzaGVkLiAqLworCXJl
dHVybiBhdG9taWNfcmVhZCgmb2JqLT5waW5fZ2xvYmFsKTsKIH0KIAogc3RhdGljIGlubGluZSB2
b2lkIF9fc3RhcnRfY3B1X3dyaXRlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVz
LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmgKaW5k
ZXggOGY2MWQ3YTkzMDc4Li5mNzkyOTUzYjhhNzEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmgKQEAgLTE1OSw3ICsxNTksNyBAQCBzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCB7CiAJLyoqIENvdW50IG9mIFZNQSBhY3R1YWxseSBib3Vu
ZCBieSB0aGlzIG9iamVjdCAqLwogCWF0b21pY190IGJpbmRfY291bnQ7CiAJLyoqIENvdW50IG9m
IGhvdyBtYW55IGdsb2JhbCBWTUEgYXJlIGN1cnJlbnRseSBwaW5uZWQgZm9yIHVzZSBieSBIVyAq
LwotCXVuc2lnbmVkIGludCBwaW5fZ2xvYmFsOworCWF0b21pY190IHBpbl9nbG9iYWw7CiAKIAlz
dHJ1Y3QgewogCQlzdHJ1Y3QgbXV0ZXggbG9jazsgLyogcHJvdGVjdHMgdGhlIHBhZ2VzIGFuZCB0
aGVpciB1c2UgKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9zaHJpbmtlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2Vy
LmMKaW5kZXggNDg0NTExMTBlNzM2Li40ZWVlZjYyMjVhNzEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jCkBAIC0xNiw0MCArMTYsNiBAQAogCiAjaW5j
bHVkZSAiaTkxNV90cmFjZS5oIgogCi1zdGF0aWMgYm9vbCBzaHJpbmtlcl9sb2NrKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAotCQkJICB1bnNpZ25lZCBpbnQgZmxhZ3MsCi0JCQkgIGJv
b2wgKnVubG9jaykKLXsKLQlzdHJ1Y3QgbXV0ZXggKm0gPSAmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eDsKLQotCXN3aXRjaCAobXV0ZXhfdHJ5bG9ja19yZWN1cnNpdmUobSkpIHsKLQljYXNlIE1VVEVY
X1RSWUxPQ0tfUkVDVVJTSVZFOgotCQkqdW5sb2NrID0gZmFsc2U7Ci0JCXJldHVybiB0cnVlOwot
Ci0JY2FzZSBNVVRFWF9UUllMT0NLX0ZBSUxFRDoKLQkJKnVubG9jayA9IGZhbHNlOwotCQlpZiAo
ZmxhZ3MgJiBJOTE1X1NIUklOS19BQ1RJVkUgJiYKLQkJICAgIG11dGV4X2xvY2tfa2lsbGFibGVf
bmVzdGVkKG0sIEk5MTVfTU1fU0hSSU5LRVIpID09IDApCi0JCQkqdW5sb2NrID0gdHJ1ZTsKLQkJ
cmV0dXJuICp1bmxvY2s7Ci0KLQljYXNlIE1VVEVYX1RSWUxPQ0tfU1VDQ0VTUzoKLQkJKnVubG9j
ayA9IHRydWU7Ci0JCXJldHVybiB0cnVlOwotCX0KLQotCUJVRygpOwotfQotCi1zdGF0aWMgdm9p
ZCBzaHJpbmtlcl91bmxvY2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGJvb2wgdW5s
b2NrKQotewotCWlmICghdW5sb2NrKQotCQlyZXR1cm47Ci0KLQltdXRleF91bmxvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwotfQotCiBzdGF0aWMgYm9vbCBzd2FwX2F2YWlsYWJsZSh2b2lk
KQogewogCXJldHVybiBnZXRfbnJfc3dhcF9wYWdlcygpID4gMDsKQEAgLTc4LDcgKzQ0LDcgQEAg
c3RhdGljIGJvb2wgY2FuX3JlbGVhc2VfcGFnZXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iaikKIAkgKiBUbyBzaW1wbGlmeSB0aGUgc2NhbiwgYW5kIHRvIGF2b2lkIHdhbGtpbmcgdGhl
IGxpc3Qgb2Ygdm1hIHVuZGVyIHRoZQogCSAqIG9iamVjdCwgd2UganVzdCBjaGVjayB0aGUgY291
bnQgb2YgaXRzIHBlcm1hbmVudGx5IHBpbm5lZC4KIAkgKi8KLQlpZiAoUkVBRF9PTkNFKG9iai0+
cGluX2dsb2JhbCkpCisJaWYgKGF0b21pY19yZWFkKCZvYmotPnBpbl9nbG9iYWwpKQogCQlyZXR1
cm4gZmFsc2U7CiAKIAkvKiBXZSBjYW4gb25seSByZXR1cm4gcGh5c2ljYWwgcGFnZXMgdG8gdGhl
IHN5c3RlbSBpZiB3ZSBjYW4gZWl0aGVyCkBAIC0xNTQsMTAgKzEyMCw2IEBAIGk5MTVfZ2VtX3No
cmluayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlpbnRlbF93YWtlcmVmX3Qgd2Fr
ZXJlZiA9IDA7CiAJdW5zaWduZWQgbG9uZyBjb3VudCA9IDA7CiAJdW5zaWduZWQgbG9uZyBzY2Fu
bmVkID0gMDsKLQlib29sIHVubG9jazsKLQotCWlmICghc2hyaW5rZXJfbG9jayhpOTE1LCBmbGFn
cywgJnVubG9jaykpCi0JCXJldHVybiAwOwogCiAJLyoKIAkgKiBXaGVuIHNocmlua2luZyB0aGUg
YWN0aXZlIGxpc3QsIGFsc28gY29uc2lkZXIgYWN0aXZlIGNvbnRleHRzLgpAQCAtMTc0LDcgKzEz
Niw2IEBAIGk5MTVfZ2VtX3NocmluayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJ
CQkgICAgICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwogCiAJdHJhY2VfaTkxNV9nZW1fc2hyaW5r
KGk5MTUsIHRhcmdldCwgZmxhZ3MpOwotCWk5MTVfcmV0aXJlX3JlcXVlc3RzKGk5MTUpOwogCiAJ
LyoKIAkgKiBVbmJpbmRpbmcgb2Ygb2JqZWN0cyB3aWxsIHJlcXVpcmUgSFcgYWNjZXNzOyBMZXQg
dXMgbm90IHdha2UgdGhlCkBAIC0yMTYsMTMgKzE3Nyw2IEBAIGk5MTVfZ2VtX3NocmluayhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAogCQlJTklUX0xJU1RfSEVBRCgmc3RpbGxfaW5f
bGlzdCk7CiAKLQkJLyoKLQkJICogV2Ugc2VyaWFsaXplIG91ciBhY2Nlc3MgdG8gdW5yZWZlcmVu
Y2VkIG9iamVjdHMgdGhyb3VnaAotCQkgKiB0aGUgdXNlIG9mIHRoZSBzdHJ1Y3RfbXV0ZXguIFdo
aWxlIHRoZSBvYmplY3RzIGFyZSBub3QKLQkJICogeWV0IGZyZWVkIChkdWUgdG8gUkNVIHRoZW4g
YSB3b3JrcXVldWUpIHdlIHN0aWxsIHdhbnQKLQkJICogdG8gYmUgYWJsZSB0byBzaHJpbmsgdGhl
aXIgcGFnZXMsIHNvIHRoZXkgcmVtYWluIG9uCi0JCSAqIHRoZSB1bmJvdW5kL2JvdW5kIGxpc3Qg
dW50aWwgYWN0dWFsbHkgZnJlZWQuCi0JCSAqLwogCQlzcGluX2xvY2tfaXJxc2F2ZSgmaTkxNS0+
bW0ub2JqX2xvY2ssIGZsYWdzKTsKIAkJd2hpbGUgKGNvdW50IDwgdGFyZ2V0ICYmCiAJCSAgICAg
ICAob2JqID0gbGlzdF9maXJzdF9lbnRyeV9vcl9udWxsKHBoYXNlLT5saXN0LApAQCAtMjcwLDEw
ICsyMjQsNiBAQCBpOTE1X2dlbV9zaHJpbmsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CiAJaWYgKGZsYWdzICYgSTkxNV9TSFJJTktfQk9VTkQpCiAJCWludGVsX3J1bnRpbWVfcG1fcHV0
KGk5MTUsIHdha2VyZWYpOwogCi0JaTkxNV9yZXRpcmVfcmVxdWVzdHMoaTkxNSk7Ci0KLQlzaHJp
bmtlcl91bmxvY2soaTkxNSwgdW5sb2NrKTsKLQogCWlmIChucl9zY2FubmVkKQogCQkqbnJfc2Nh
bm5lZCArPSBzY2FubmVkOwogCXJldHVybiBjb3VudDsKQEAgLTM0MywxMyArMjkzLDkgQEAgaTkx
NV9nZW1fc2hyaW5rZXJfc2NhbihzdHJ1Y3Qgc2hyaW5rZXIgKnNocmlua2VyLCBzdHJ1Y3Qgc2hy
aW5rX2NvbnRyb2wgKnNjKQogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0KIAkJY29u
dGFpbmVyX29mKHNocmlua2VyLCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSwgbW0uc2hyaW5rZXIp
OwogCXVuc2lnbmVkIGxvbmcgZnJlZWQ7Ci0JYm9vbCB1bmxvY2s7CiAKIAlzYy0+bnJfc2Nhbm5l
ZCA9IDA7CiAKLQlpZiAoIXNocmlua2VyX2xvY2soaTkxNSwgMCwgJnVubG9jaykpCi0JCXJldHVy
biBTSFJJTktfU1RPUDsKLQogCWZyZWVkID0gaTkxNV9nZW1fc2hyaW5rKGk5MTUsCiAJCQkJc2Mt
Pm5yX3RvX3NjYW4sCiAJCQkJJnNjLT5ucl9zY2FubmVkLApAQCAtMzcwLDggKzMxNiw2IEBAIGk5
MTVfZ2VtX3Nocmlua2VyX3NjYW4oc3RydWN0IHNocmlua2VyICpzaHJpbmtlciwgc3RydWN0IHNo
cmlua19jb250cm9sICpzYykKIAkJfQogCX0KIAotCXNocmlua2VyX3VubG9jayhpOTE1LCB1bmxv
Y2spOwotCiAJcmV0dXJuIHNjLT5ucl9zY2FubmVkID8gZnJlZWQgOiBTSFJJTktfU1RPUDsKIH0K
IApAQCAtNDIzLDE2ICszNjcsMTIgQEAgaTkxNV9nZW1fc2hyaW5rZXJfdm1hcChzdHJ1Y3Qgbm90
aWZpZXJfYmxvY2sgKm5iLCB1bnNpZ25lZCBsb25nIGV2ZW50LCB2b2lkICpwdHIKIAlzdHJ1Y3Qg
aTkxNV92bWEgKnZtYSwgKm5leHQ7CiAJdW5zaWduZWQgbG9uZyBmcmVlZF9wYWdlcyA9IDA7CiAJ
aW50ZWxfd2FrZXJlZl90IHdha2VyZWY7Ci0JYm9vbCB1bmxvY2s7Ci0KLQlpZiAoIXNocmlua2Vy
X2xvY2soaTkxNSwgMCwgJnVubG9jaykpCi0JCXJldHVybiBOT1RJRllfRE9ORTsKIAogCS8qIEZv
cmNlIGV2ZXJ5dGhpbmcgb250byB0aGUgaW5hY3RpdmUgbGlzdHMgKi8KIAlpZiAoaTkxNV9nZW1f
d2FpdF9mb3JfaWRsZShpOTE1LAogCQkJCSAgIEk5MTVfV0FJVF9MT0NLRUQsCiAJCQkJICAgTUFY
X1NDSEVEVUxFX1RJTUVPVVQpKQotCQlnb3RvIG91dDsKKwkJcmV0dXJuIE5PVElGWV9ET05FOwog
CiAJd2l0aF9pbnRlbF9ydW50aW1lX3BtKGk5MTUsIHdha2VyZWYpCiAJCWZyZWVkX3BhZ2VzICs9
IGk5MTVfZ2VtX3NocmluayhpOTE1LCAtMVVMLCBOVUxMLApAQCAtNDQ5LDE2ICszODksMTEgQEAg
aTkxNV9nZW1fc2hyaW5rZXJfdm1hcChzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sgKm5iLCB1bnNpZ25l
ZCBsb25nIGV2ZW50LCB2b2lkICpwdHIKIAkJaWYgKCF2bWEtPmlvbWFwIHx8IGk5MTVfdm1hX2lz
X2FjdGl2ZSh2bWEpKQogCQkJY29udGludWU7CiAKLQkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5nZ3R0
LnZtLm11dGV4KTsKIAkJaWYgKGk5MTVfdm1hX3VuYmluZCh2bWEpID09IDApCiAJCQlmcmVlZF9w
YWdlcyArPSBjb3VudDsKLQkJbXV0ZXhfbG9jaygmaTkxNS0+Z2d0dC52bS5tdXRleCk7CiAJfQog
CW11dGV4X3VubG9jaygmaTkxNS0+Z2d0dC52bS5tdXRleCk7CiAKLW91dDoKLQlzaHJpbmtlcl91
bmxvY2soaTkxNSwgdW5sb2NrKTsKLQogCSoodW5zaWduZWQgbG9uZyAqKXB0ciArPSBmcmVlZF9w
YWdlczsKIAlyZXR1cm4gTk9USUZZX0RPTkU7CiB9CkBAIC01MDAsMzcgKzQzNSwxMyBAQCB2b2lk
IGk5MTVfZ2VtX3Nocmlua2VyX3VucmVnaXN0ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCiB2b2lkIGk5MTVfZ2VtX3Nocmlua2VyX3RhaW50c19tdXRleChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgc3RydWN0IG11dGV4ICptdXRleCkKIHsKLQlib29sIHVu
bG9jayA9IGZhbHNlOwotCiAJaWYgKCFJU19FTkFCTEVEKENPTkZJR19MT0NLREVQKSkKIAkJcmV0
dXJuOwogCi0JaWYgKCFsb2NrZGVwX2lzX2hlbGRfdHlwZSgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCwgLTEpKSB7Ci0JCW11dGV4X2FjcXVpcmUoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXguZGVwX21h
cCwKLQkJCSAgICAgIEk5MTVfTU1fTk9STUFMLCAwLCBfUkVUX0lQXyk7Ci0JCXVubG9jayA9IHRy
dWU7Ci0JfQotCiAJZnNfcmVjbGFpbV9hY3F1aXJlKEdGUF9LRVJORUwpOwogCi0JLyoKLQkgKiBB
cyB3ZSBpbnZhcmlhYmx5IHJlbHkgb24gdGhlIHN0cnVjdF9tdXRleCB3aXRoaW4gdGhlIHNocmlu
a2VyLAotCSAqIGJ1dCBoYXZlIGEgY29tcGxpY2F0ZWQgcmVjdXJzaW9uIGRhbmNlLCB0YWludCBh
bGwgdGhlIG11dGV4ZXMgdXNlZAotCSAqIHdpdGhpbiB0aGUgc2hyaW5rZXIgd2l0aCB0aGUgc3Ry
dWN0X211dGV4LiBGb3IgY29tcGxldGVuZXNzLCB3ZQotCSAqIHRhaW50IHdpdGggYWxsIHN1YmNs
YXNzIG9mIHN0cnVjdF9tdXRleCwgZXZlbiB0aG91Z2ggd2Ugc2hvdWxkCi0JICogb25seSBuZWVk
IHRhaW50aW5nIGJ5IEk5MTVfTU1fTk9STUFMIHRvIGNhdGNoIHBvc3NpYmxlIEFCQkEKLQkgKiBk
ZWFkbG9ja3MgZnJvbSB1c2luZyBzdHJ1Y3RfbXV0ZXggaW5zaWRlIEBtdXRleC4KLQkgKi8KLQlt
dXRleF9hY3F1aXJlKCZpOTE1LT5kcm0uc3RydWN0X211dGV4LmRlcF9tYXAsCi0JCSAgICAgIEk5
MTVfTU1fU0hSSU5LRVIsIDAsIF9SRVRfSVBfKTsKLQogCW11dGV4X2FjcXVpcmUoJm11dGV4LT5k
ZXBfbWFwLCAwLCAwLCBfUkVUX0lQXyk7CiAJbXV0ZXhfcmVsZWFzZSgmbXV0ZXgtPmRlcF9tYXAs
IDAsIF9SRVRfSVBfKTsKIAotCW11dGV4X3JlbGVhc2UoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgu
ZGVwX21hcCwgMCwgX1JFVF9JUF8pOwotCiAJZnNfcmVjbGFpbV9yZWxlYXNlKEdGUF9LRVJORUwp
OwotCi0JaWYgKHVubG9jaykKLQkJbXV0ZXhfcmVsZWFzZSgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eC5kZXBfbWFwLCAwLCBfUkVUX0lQXyk7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fc3RvbGVuLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fc3RvbGVuLmMKaW5kZXggNjViYTg1NjU1NTgyLi4yOTkwZWYzNjA0YWEgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zdG9sZW4uYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc3RvbGVuLmMKQEAgLTYxOCw4ICs2MTgsNiBA
QCBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3N0b2xlbl9mb3JfcHJlYWxsb2NhdGVkKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdgogCWlmICghZHJtX21tX2luaXRpYWxpemVkKCZkZXZf
cHJpdi0+bW0uc3RvbGVuKSkKIAkJcmV0dXJuIE5VTEw7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxk
KCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlEUk1fREVCVUdfRFJJVkVSKCJjcmVh
dGluZyBwcmVhbGxvY2F0ZWQgc3RvbGVuIG9iamVjdDogc3RvbGVuX29mZnNldD0lcGEsIGd0dF9v
ZmZzZXQ9JXBhLCBzaXplPSVwYVxuIiwKIAkJCSAmc3RvbGVuX29mZnNldCwgJmd0dF9vZmZzZXQs
ICZzaXplKTsKIApAQCAtNjcxLDEwICs2NjksMTIgQEAgaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9z
dG9sZW5fZm9yX3ByZWFsbG9jYXRlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYK
IAkgKiBzZXR0aW5nIHVwIHRoZSBHVFQgc3BhY2UuIFRoZSBhY3R1YWwgcmVzZXJ2YXRpb24gd2ls
bCBvY2N1cgogCSAqIGxhdGVyLgogCSAqLworCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsK
IAlyZXQgPSBpOTE1X2dlbV9ndHRfcmVzZXJ2ZSgmZ2d0dC0+dm0sICZ2bWEtPm5vZGUsCiAJCQkJ
ICAgc2l6ZSwgZ3R0X29mZnNldCwgb2JqLT5jYWNoZV9sZXZlbCwKIAkJCQkgICAwKTsKIAlpZiAo
cmV0KSB7CisJCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQlEUk1fREVCVUdfRFJJ
VkVSKCJmYWlsZWQgdG8gYWxsb2NhdGUgc3RvbGVuIEdUVCBzcGFjZVxuIik7CiAJCWdvdG8gZXJy
X3BhZ2VzOwogCX0KQEAgLTY4NSw3ICs2ODUsNiBAQCBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3N0
b2xlbl9mb3JfcHJlYWxsb2NhdGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdgog
CXZtYS0+ZmxhZ3MgfD0gSTkxNV9WTUFfR0xPQkFMX0JJTkQ7CiAJX19pOTE1X3ZtYV9zZXRfbWFw
X2FuZF9mZW5jZWFibGUodm1hKTsKIAotCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAls
aXN0X2FkZF90YWlsKCZ2bWEtPnZtX2xpbmssICZnZ3R0LT52bS5ib3VuZF9saXN0KTsKIAltdXRl
eF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX3RpbGluZy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX3RpbGluZy5jCmluZGV4IGNhMGMyZjQ1MTc0Mi4uZjkxOWRiYjM2ZWRiIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdGlsaW5nLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3RpbGluZy5jCkBAIC0yMTIsMTUgKzIxMiwx
OCBAQCBpOTE1X2dlbV9vYmplY3Rfc2V0X3RpbGluZyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqLAogCiAJR0VNX0JVR19PTighaTkxNV90aWxpbmdfb2sob2JqLCB0aWxpbmcsIHN0cmlk
ZSkpOwogCUdFTV9CVUdfT04oIXN0cmlkZSBeICh0aWxpbmcgPT0gSTkxNV9USUxJTkdfTk9ORSkp
OwotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJaWYg
KCh0aWxpbmcgfCBzdHJpZGUpID09IG9iai0+dGlsaW5nX2FuZF9zdHJpZGUpCiAJCXJldHVybiAw
OwogCi0JaWYgKGk5MTVfZ2VtX29iamVjdF9pc19mcmFtZWJ1ZmZlcihvYmopKQorCWk5MTVfZ2Vt
X29iamVjdF9sb2NrKG9iaik7CisJaWYgKGk5MTVfZ2VtX29iamVjdF9pc19mcmFtZWJ1ZmZlcihv
YmopKSB7CisJCWk5MTVfZ2VtX29iamVjdF91bmxvY2sob2JqKTsKIAkJcmV0dXJuIC1FQlVTWTsK
Kwl9CiAKLQkvKiBXZSBuZWVkIHRvIHJlYmluZCB0aGUgb2JqZWN0IGlmIGl0cyBjdXJyZW50IGFs
bG9jYXRpb24KKwkvKgorCSAqIFdlIG5lZWQgdG8gcmViaW5kIHRoZSBvYmplY3QgaWYgaXRzIGN1
cnJlbnQgYWxsb2NhdGlvbgogCSAqIG5vIGxvbmdlciBtZWV0cyB0aGUgYWxpZ25tZW50IHJlc3Ry
aWN0aW9ucyBmb3IgaXRzIG5ldwogCSAqIHRpbGluZyBtb2RlLiBPdGhlcndpc2Ugd2UgY2FuIGp1
c3QgbGVhdmUgaXQgYWxvbmUsIGJ1dAogCSAqIG5lZWQgdG8gZW5zdXJlIHRoYXQgYW55IGZlbmNl
IHJlZ2lzdGVyIGlzIHVwZGF0ZWQgYmVmb3JlCkBAIC0yMzMsMTcgKzIzNiwzNyBAQCBpOTE1X2dl
bV9vYmplY3Rfc2V0X3RpbGluZyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCSAq
IHdoaWxzdCBleGVjdXRpbmcgYSBmZW5jZWQgY29tbWFuZCBmb3IgYW4gdW50aWxlZCBvYmplY3Qu
CiAJICovCiAKLQllcnIgPSBpOTE1X2dlbV9vYmplY3RfZmVuY2VfcHJlcGFyZShvYmosIHRpbGlu
Zywgc3RyaWRlKTsKLQlpZiAoZXJyKQorCWVyciA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgm
aTkxNS0+Z2d0dC52bS5tdXRleCk7CisJaWYgKGVycikgeworCQlpOTE1X2dlbV9vYmplY3RfdW5s
b2NrKG9iaik7CiAJCXJldHVybiBlcnI7CisJfQogCi0JaTkxNV9nZW1fb2JqZWN0X2xvY2sob2Jq
KTsKLQlpZiAoaTkxNV9nZW1fb2JqZWN0X2lzX2ZyYW1lYnVmZmVyKG9iaikpIHsKKwllcnIgPSBp
OTE1X2dlbV9vYmplY3RfZmVuY2VfcHJlcGFyZShvYmosIHRpbGluZywgc3RyaWRlKTsKKwlpZiAo
ZXJyKSB7CisJCW11dGV4X3VubG9jaygmaTkxNS0+Z2d0dC52bS5tdXRleCk7CiAJCWk5MTVfZ2Vt
X29iamVjdF91bmxvY2sob2JqKTsKLQkJcmV0dXJuIC1FQlVTWTsKKwkJcmV0dXJuIGVycjsKIAl9
CiAKLQkvKiBJZiB0aGUgbWVtb3J5IGhhcyB1bmtub3duIChpLmUuIHZhcnlpbmcpIHN3aXp6bGlu
Zywgd2UgcGluIHRoZQorCWZvcl9lYWNoX2dndHRfdm1hKHZtYSwgb2JqKSB7CisJCXZtYS0+ZmVu
Y2Vfc2l6ZSA9CisJCQlpOTE1X2dlbV9mZW5jZV9zaXplKGk5MTUsIHZtYS0+c2l6ZSwgdGlsaW5n
LCBzdHJpZGUpOworCQl2bWEtPmZlbmNlX2FsaWdubWVudCA9CisJCQlpOTE1X2dlbV9mZW5jZV9h
bGlnbm1lbnQoaTkxNSwKKwkJCQkJCSB2bWEtPnNpemUsIHRpbGluZywgc3RyaWRlKTsKKworCQlp
ZiAodm1hLT5mZW5jZSkKKwkJCXZtYS0+ZmVuY2UtPmRpcnR5ID0gdHJ1ZTsKKwl9CisKKwkvKiBG
b3JjZSB0aGUgZmVuY2UgdG8gYmUgcmVhY3F1aXJlZCBmb3IgR1RUIGFjY2VzcyAqLworCWk5MTVf
Z2VtX29iamVjdF9yZWxlYXNlX21tYXAob2JqKTsKKworCW11dGV4X3VubG9jaygmaTkxNS0+Z2d0
dC52bS5tdXRleCk7CisKKwkvKgorCSAqIElmIHRoZSBtZW1vcnkgaGFzIHVua25vd24gKGkuZS4g
dmFyeWluZykgc3dpenpsaW5nLCB3ZSBwaW4gdGhlCiAJICogcGFnZXMgdG8gcHJldmVudCB0aGVt
IGJlaW5nIHN3YXBwZWQgb3V0IGFuZCBjYXVzaW5nIGNvcnJ1cHRpb24KIAkgKiBkdWUgdG8gdGhl
IGNoYW5nZSBpbiBzd2l6emxpbmcuCiAJICovCkBAIC0yNjQsMjMgKzI4Nyw5IEBAIGk5MTVfZ2Vt
X29iamVjdF9zZXRfdGlsaW5nKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJfQog
CW11dGV4X3VubG9jaygmb2JqLT5tbS5sb2NrKTsKIAotCWZvcl9lYWNoX2dndHRfdm1hKHZtYSwg
b2JqKSB7Ci0JCXZtYS0+ZmVuY2Vfc2l6ZSA9Ci0JCQlpOTE1X2dlbV9mZW5jZV9zaXplKGk5MTUs
IHZtYS0+c2l6ZSwgdGlsaW5nLCBzdHJpZGUpOwotCQl2bWEtPmZlbmNlX2FsaWdubWVudCA9Ci0J
CQlpOTE1X2dlbV9mZW5jZV9hbGlnbm1lbnQoaTkxNSwKLQkJCQkJCSB2bWEtPnNpemUsIHRpbGlu
Zywgc3RyaWRlKTsKLQotCQlpZiAodm1hLT5mZW5jZSkKLQkJCXZtYS0+ZmVuY2UtPmRpcnR5ID0g
dHJ1ZTsKLQl9Ci0KIAlvYmotPnRpbGluZ19hbmRfc3RyaWRlID0gdGlsaW5nIHwgc3RyaWRlOwog
CWk5MTVfZ2VtX29iamVjdF91bmxvY2sob2JqKTsKIAotCS8qIEZvcmNlIHRoZSBmZW5jZSB0byBi
ZSByZWFjcXVpcmVkIGZvciBHVFQgYWNjZXNzICovCi0JaTkxNV9nZW1fb2JqZWN0X3JlbGVhc2Vf
bW1hcChvYmopOwotCiAJLyogVHJ5IHRvIHByZWFsbG9jYXRlIG1lbW9yeSByZXF1aXJlZCB0byBz
YXZlIHN3aXp6bGluZyBvbiBwdXQtcGFnZXMgKi8KIAlpZiAoaTkxNV9nZW1fb2JqZWN0X25lZWRz
X2JpdDE3X3N3aXp6bGUob2JqKSkgewogCQlpZiAoIW9iai0+Yml0XzE3KSB7CkBAIC0zNjQsMTIg
KzM3Myw3IEBAIGk5MTVfZ2VtX3NldF90aWxpbmdfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRl
diwgdm9pZCAqZGF0YSwKIAkJfQogCX0KIAotCWVyciA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJs
ZSgmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChlcnIpCi0JCWdvdG8gZXJyOwotCiAJZXJyID0g
aTkxNV9nZW1fb2JqZWN0X3NldF90aWxpbmcob2JqLCBhcmdzLT50aWxpbmdfbW9kZSwgYXJncy0+
c3RyaWRlKTsKLQltdXRleF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKIAogCS8qIFdlIGhh
dmUgdG8gbWFpbnRhaW4gdGhpcyBleGlzdGluZyBBQkkuLi4gKi8KIAlhcmdzLT5zdHJpZGUgPSBp
OTE1X2dlbV9vYmplY3RfZ2V0X3N0cmlkZShvYmopOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV91c2VycHRyLmMKaW5kZXggNTI4YjYxNjc4MzM0Li5mMDkzZGVhZWI1YzAgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYwpAQCAtOTMsNyAr
OTMsNiBAQCB1c2VycHRyX21uX2ludmFsaWRhdGVfcmFuZ2Vfc3RhcnQoc3RydWN0IG1tdV9ub3Rp
ZmllciAqX21uLAogCXN0cnVjdCBpOTE1X21tdV9ub3RpZmllciAqbW4gPQogCQljb250YWluZXJf
b2YoX21uLCBzdHJ1Y3QgaTkxNV9tbXVfbm90aWZpZXIsIG1uKTsKIAlzdHJ1Y3QgaW50ZXJ2YWxf
dHJlZV9ub2RlICppdDsKLQlzdHJ1Y3QgbXV0ZXggKnVubG9jayA9IE5VTEw7CiAJdW5zaWduZWQg
bG9uZyBlbmQ7CiAJaW50IHJldCA9IDA7CiAKQEAgLTEzMCwzMiArMTI5LDEyIEBAIHVzZXJwdHJf
bW5faW52YWxpZGF0ZV9yYW5nZV9zdGFydChzdHJ1Y3QgbW11X25vdGlmaWVyICpfbW4sCiAJCX0K
IAkJc3Bpbl91bmxvY2soJm1uLT5sb2NrKTsKIAotCQlpZiAoIXVubG9jaykgewotCQkJdW5sb2Nr
ID0gJm1uLT5tbS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleDsKLQotCQkJc3dpdGNoIChtdXRleF90
cnlsb2NrX3JlY3Vyc2l2ZSh1bmxvY2spKSB7Ci0JCQlkZWZhdWx0OgotCQkJY2FzZSBNVVRFWF9U
UllMT0NLX0ZBSUxFRDoKLQkJCQlpZiAobXV0ZXhfbG9ja19raWxsYWJsZV9uZXN0ZWQodW5sb2Nr
LCBJOTE1X01NX1NIUklOS0VSKSkgewotCQkJCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7Ci0J
CQkJCXJldHVybiAtRUlOVFI7Ci0JCQkJfQotCQkJCS8qIGZhbGwgdGhyb3VnaCAqLwotCQkJY2Fz
ZSBNVVRFWF9UUllMT0NLX1NVQ0NFU1M6Ci0JCQkJYnJlYWs7Ci0KLQkJCWNhc2UgTVVURVhfVFJZ
TE9DS19SRUNVUlNJVkU6Ci0JCQkJdW5sb2NrID0gRVJSX1BUUigtRUVYSVNUKTsKLQkJCQlicmVh
azsKLQkJCX0KLQkJfQotCiAJCXJldCA9IGk5MTVfZ2VtX29iamVjdF91bmJpbmQob2JqKTsKIAkJ
aWYgKHJldCA9PSAwKQogCQkJcmV0ID0gX19pOTE1X2dlbV9vYmplY3RfcHV0X3BhZ2VzKG9iaiwg
STkxNV9NTV9TSFJJTktFUik7CiAJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKIAkJaWYgKHJl
dCkKLQkJCWdvdG8gdW5sb2NrOworCQkJcmV0dXJuIHJldDsKIAogCQlzcGluX2xvY2soJm1uLT5s
b2NrKTsKIApAQCAtMTY4LDEyICsxNDcsNyBAQCB1c2VycHRyX21uX2ludmFsaWRhdGVfcmFuZ2Vf
c3RhcnQoc3RydWN0IG1tdV9ub3RpZmllciAqX21uLAogCX0KIAlzcGluX3VubG9jaygmbW4tPmxv
Y2spOwogCi11bmxvY2s6Ci0JaWYgKCFJU19FUlJfT1JfTlVMTCh1bmxvY2spKQotCQltdXRleF91
bmxvY2sodW5sb2NrKTsKLQogCXJldHVybiByZXQ7Ci0KIH0KIAogc3RhdGljIGNvbnN0IHN0cnVj
dCBtbXVfbm90aWZpZXJfb3BzIGk5MTVfZ2VtX3VzZXJwdHJfbm90aWZpZXIgPSB7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jCmluZGV4
IGIwYmExNjgwZWRlNi4uZmJiYjg5MDUxYzIxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYwpAQCAtMTY4LDcgKzE2OCw5IEBAIHN0
YXRpYyBpbnQgY2hlY2tfcGFydGlhbF9tYXBwaW5nKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmosCiAJCWlmIChlcnIpCiAJCQlyZXR1cm4gZXJyOwogCisJCW11dGV4X2xvY2soJnRvX2k5
MTUob2JqLT5iYXNlLmRldiktPmdndHQudm0ubXV0ZXgpOwogCQlpOTE1X3ZtYV9kZXN0cm95KHZt
YSk7CisJCW11dGV4X3VubG9jaygmdG9faTkxNShvYmotPmJhc2UuZGV2KS0+Z2d0dC52bS5tdXRl
eCk7CiAJfQogCiAJcmV0dXJuIDA7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0
LmMKaW5kZXggYTMyNjk4Zjc2NDVmLi5lOWI4Njc4N2U4YWQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9jb250ZXh0LmMKQEAgLTExMCw3ICsxMTAsNyBAQCBzdGF0aWMgaW50IF9fY29u
dGV4dF9waW5fc3RhdGUoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJICogQW5kIG1hcmsgaXQgYXMg
YSBnbG9iYWxseSBwaW5uZWQgb2JqZWN0IHRvIGxldCB0aGUgc2hyaW5rZXIga25vdwogCSAqIGl0
IGNhbm5vdCByZWNsYWltIHRoZSBvYmplY3QgdW50aWwgd2UgcmVsZWFzZSBpdC4KIAkgKi8KLQl2
bWEtPm9iai0+cGluX2dsb2JhbCsrOworCWF0b21pY19pbmMoJnZtYS0+b2JqLT5waW5fZ2xvYmFs
KTsKIAl2bWEtPm9iai0+bW0uZGlydHkgPSB0cnVlOwogCiAJcmV0dXJuIDA7CkBAIC0xMTgsNyAr
MTE4LDggQEAgc3RhdGljIGludCBfX2NvbnRleHRfcGluX3N0YXRlKHN0cnVjdCBpOTE1X3ZtYSAq
dm1hKQogCiBzdGF0aWMgdm9pZCBfX2NvbnRleHRfdW5waW5fc3RhdGUoc3RydWN0IGk5MTVfdm1h
ICp2bWEpCiB7Ci0Jdm1hLT5vYmotPnBpbl9nbG9iYWwtLTsKKwlHRU1fQlVHX09OKCFhdG9taWNf
cmVhZCgmdm1hLT5vYmotPnBpbl9nbG9iYWwpKTsKKwlhdG9taWNfZGVjKCZ2bWEtPm9iai0+cGlu
X2dsb2JhbCk7CiAJX19pOTE1X3ZtYV91bnBpbih2bWEpOwogfQogCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMKaW5kZXggZjQ3NTAyMDdjMzkzLi4yYjQ0ODVkOTE4
ZjEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMKQEAgLTEx
ODMsNyArMTE4Myw3IEBAIGludCBpbnRlbF9yaW5nX3BpbihzdHJ1Y3QgaW50ZWxfcmluZyAqcmlu
ZykKIAkJZ290byB1bnBpbl9yaW5nOwogCX0KIAotCXZtYS0+b2JqLT5waW5fZ2xvYmFsKys7CisJ
YXRvbWljX3JlYWQoJnZtYS0+b2JqLT5waW5fZ2xvYmFsKTsKIAogCXJpbmctPnZhZGRyID0gYWRk
cjsKIAlyZXR1cm4gMDsKQEAgLTEyMTksNyArMTIxOSw3IEBAIHZvaWQgaW50ZWxfcmluZ191bnBp
bihzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZykKIAkJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChy
aW5nLT52bWEtPm9iaik7CiAJcmluZy0+dmFkZHIgPSBOVUxMOwogCi0JcmluZy0+dm1hLT5vYmot
PnBpbl9nbG9iYWwtLTsKKwlhdG9taWNfZGVjKCZyaW5nLT52bWEtPm9iai0+cGluX2dsb2JhbCk7
CiAJaTkxNV92bWFfdW5waW4ocmluZy0+dm1hKTsKIAogCWk5MTVfdGltZWxpbmVfdW5waW4ocmlu
Zy0+dGltZWxpbmUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2FwZXJ0
dXJlX2dtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvYXBlcnR1cmVfZ20uYwppbmRleCA0
MDk4OTAyYmZhZWIuLmEyZDdhMWRmODIwZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Z0L2FwZXJ0dXJlX2dtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2FwZXJ0
dXJlX2dtLmMKQEAgLTYxLDE0ICs2MSwxNCBAQCBzdGF0aWMgaW50IGFsbG9jX2dtKHN0cnVjdCBp
bnRlbF92Z3B1ICp2Z3B1LCBib29sIGhpZ2hfZ20pCiAJCWZsYWdzID0gUElOX01BUFBBQkxFOwog
CX0KIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF9s
b2NrKCZkZXZfcHJpdi0+Z2d0dC52bS5tdXRleCk7CiAJbW1pb19od19hY2Nlc3NfcHJlKGRldl9w
cml2KTsKIAlyZXQgPSBpOTE1X2dlbV9ndHRfaW5zZXJ0KCZkZXZfcHJpdi0+Z2d0dC52bSwgbm9k
ZSwKIAkJCQkgIHNpemUsIEk5MTVfR1RUX1BBR0VfU0laRSwKIAkJCQkgIEk5MTVfQ09MT1JfVU5F
VklDVEFCTEUsCiAJCQkJICBzdGFydCwgZW5kLCBmbGFncyk7CiAJbW1pb19od19hY2Nlc3NfcG9z
dChkZXZfcHJpdik7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7
CisJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+Z2d0dC52bS5tdXRleCk7CiAJaWYgKHJldCkKIAkJ
Z3Z0X2VycigiZmFpbCB0byBhbGxvYyAlcyBnbSBzcGFjZSBmcm9tIGhvc3RcbiIsCiAJCQloaWdo
X2dtID8gImhpZ2giIDogImxvdyIpOwpAQCAtOTgsOSArOTgsOSBAQCBzdGF0aWMgaW50IGFsbG9j
X3ZncHVfZ20oc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAKIAlyZXR1cm4gMDsKIG91dF9mcmVl
X2FwZXJ0dXJlOgotCW11dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwlt
dXRleF9sb2NrKCZkZXZfcHJpdi0+Z2d0dC52bS5tdXRleCk7CiAJZHJtX21tX3JlbW92ZV9ub2Rl
KCZ2Z3B1LT5nbS5sb3dfZ21fbm9kZSk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0
cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+Z2d0dC52bS5tdXRleCk7CiAJ
cmV0dXJuIHJldDsKIH0KIApAQCAtMTA4LDEwICsxMDgsMTAgQEAgc3RhdGljIHZvaWQgZnJlZV92
Z3B1X2dtKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHZncHUtPmd2dC0+ZGV2X3ByaXY7CiAKLQltdXRleF9sb2NrKCZkZXZf
cHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmdndHQudm0u
bXV0ZXgpOwogCWRybV9tbV9yZW1vdmVfbm9kZSgmdmdwdS0+Z20ubG93X2dtX25vZGUpOwogCWRy
bV9tbV9yZW1vdmVfbm9kZSgmdmdwdS0+Z20uaGlnaF9nbV9ub2RlKTsKLQltdXRleF91bmxvY2so
JmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF91bmxvY2soJmRldl9wcml2LT5n
Z3R0LnZtLm11dGV4KTsKIH0KIAogLyoqCkBAIC0xNzIsMTQgKzE3MiwxNCBAQCBzdGF0aWMgdm9p
ZCBmcmVlX3ZncHVfZmVuY2Uoc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAKIAlpbnRlbF9ydW50
aW1lX3BtX2dldChkZXZfcHJpdik7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVj
dF9tdXRleCk7CisJbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmdndHQudm0ubXV0ZXgpOwogCV9jbGVh
cl92Z3B1X2ZlbmNlKHZncHUpOwogCWZvciAoaSA9IDA7IGkgPCB2Z3B1X2ZlbmNlX3N6KHZncHUp
OyBpKyspIHsKIAkJcmVnID0gdmdwdS0+ZmVuY2UucmVnc1tpXTsKIAkJaTkxNV91bnJlc2VydmVf
ZmVuY2UocmVnKTsKIAkJdmdwdS0+ZmVuY2UucmVnc1tpXSA9IE5VTEw7CiAJfQotCW11dGV4X3Vu
bG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X3VubG9jaygmZGV2X3By
aXYtPmdndHQudm0ubXV0ZXgpOwogCiAJaW50ZWxfcnVudGltZV9wbV9wdXRfdW5jaGVja2VkKGRl
dl9wcml2KTsKIH0KQEAgLTE5NCw3ICsxOTQsNyBAQCBzdGF0aWMgaW50IGFsbG9jX3ZncHVfZmVu
Y2Uoc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAJaW50ZWxfcnVudGltZV9wbV9nZXQoZGV2X3By
aXYpOwogCiAJLyogUmVxdWVzdCBmZW5jZXMgZnJvbSBob3N0ICovCi0JbXV0ZXhfbG9jaygmZGV2
X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X2xvY2soJmRldl9wcml2LT5nZ3R0LnZt
Lm11dGV4KTsKIAogCWZvciAoaSA9IDA7IGkgPCB2Z3B1X2ZlbmNlX3N6KHZncHUpOyBpKyspIHsK
IAkJcmVnID0gaTkxNV9yZXNlcnZlX2ZlbmNlKGRldl9wcml2KTsKQEAgLTIwNiw3ICsyMDYsNyBA
QCBzdGF0aWMgaW50IGFsbG9jX3ZncHVfZmVuY2Uoc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAK
IAlfY2xlYXJfdmdwdV9mZW5jZSh2Z3B1KTsKIAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmdndHQudm0ubXV0ZXgp
OwogCWludGVsX3J1bnRpbWVfcG1fcHV0X3VuY2hlY2tlZChkZXZfcHJpdik7CiAJcmV0dXJuIDA7
CiBvdXRfZnJlZV9mZW5jZToKQEAgLTIxOSw3ICsyMTksNyBAQCBzdGF0aWMgaW50IGFsbG9jX3Zn
cHVfZmVuY2Uoc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAJCWk5MTVfdW5yZXNlcnZlX2ZlbmNl
KHJlZyk7CiAJCXZncHUtPmZlbmNlLnJlZ3NbaV0gPSBOVUxMOwogCX0KLQltdXRleF91bmxvY2so
JmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF91bmxvY2soJmRldl9wcml2LT5n
Z3R0LnZtLm11dGV4KTsKIAlpbnRlbF9ydW50aW1lX3BtX3B1dF91bmNoZWNrZWQoZGV2X3ByaXYp
OwogCXJldHVybiAtRU5PU1BDOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9kZWJ1Z2ZzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwppbmRl
eCBlMmQ2YjhkZmY0YWIuLjNlNzhiNWQwZDVhNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1
Z2ZzLmMKQEAgLTc2LDcgKzc2LDcgQEAgc3RhdGljIGludCBpOTE1X2NhcGFiaWxpdGllcyhzdHJ1
Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAKIHN0YXRpYyBjaGFyIGdldF9waW5fZmxhZyhz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogewotCXJldHVybiBvYmotPnBpbl9nbG9i
YWwgPyAncCcgOiAnICc7CisJcmV0dXJuIGF0b21pY19yZWFkKCZvYmotPnBpbl9nbG9iYWwpID8g
J3AnIDogJyAnOwogfQogCiBzdGF0aWMgY2hhciBnZXRfdGlsaW5nX2ZsYWcoc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaikKQEAgLTIxOCw3ICsyMTgsNyBAQCBkZXNjcmliZV9vYmooc3Ry
dWN0IHNlcV9maWxlICptLCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCXNlcV9w
cmludGYobSwgIiAocGlubmVkIHggJWQpIiwgcGluX2NvdW50KTsKIAlpZiAob2JqLT5zdG9sZW4p
CiAJCXNlcV9wcmludGYobSwgIiAoc3RvbGVuOiAlMDhsbHgpIiwgb2JqLT5zdG9sZW4tPnN0YXJ0
KTsKLQlpZiAob2JqLT5waW5fZ2xvYmFsKQorCWlmIChhdG9taWNfcmVhZCgmb2JqLT5waW5fZ2xv
YmFsKSkKIAkJc2VxX3ByaW50ZihtLCAiIChnbG9iYWwpIik7CiAKIAllbmdpbmUgPSBpOTE1X2dl
bV9vYmplY3RfbGFzdF93cml0ZV9lbmdpbmUob2JqKTsKQEAgLTE2MDIsMTEgKzE2MDIsNiBAQCBz
dGF0aWMgaW50IGk5MTVfZ2VtX2ZyYW1lYnVmZmVyX2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2
b2lkICpkYXRhKQogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmZGV2X3ByaXYtPmRybTsKIAlz
dHJ1Y3QgaW50ZWxfZnJhbWVidWZmZXIgKmZiZGV2X2ZiID0gTlVMTDsKIAlzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpkcm1fZmI7Ci0JaW50IHJldDsKLQotCXJldCA9IG11dGV4X2xvY2tfaW50ZXJy
dXB0aWJsZSgmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7CiAK
ICNpZmRlZiBDT05GSUdfRFJNX0ZCREVWX0VNVUxBVElPTgogCWlmIChkZXZfcHJpdi0+ZmJkZXYg
JiYgZGV2X3ByaXYtPmZiZGV2LT5oZWxwZXIuZmIpIHsKQEAgLTE2NDEsNyArMTYzNiw2IEBAIHN0
YXRpYyBpbnQgaTkxNV9nZW1fZnJhbWVidWZmZXJfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZv
aWQgKmRhdGEpCiAJCXNlcV9wdXRjKG0sICdcbicpOwogCX0KIAltdXRleF91bmxvY2soJmRldi0+
bW9kZV9jb25maWcuZmJfbG9jayk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7
CiAKIAlyZXR1cm4gMDsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
Z2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IGQ3NGZjZGRkODYz
ZS4uZmRlOTk1YjA1YzgxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dl
bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTYwLDIwICs2MCwz
MSBAQAogI2luY2x1ZGUgImludGVsX3BtLmgiCiAKIHN0YXRpYyBpbnQKLWluc2VydF9tYXBwYWJs
ZV9ub2RlKHN0cnVjdCBpOTE1X2dndHQgKmdndHQsCi0gICAgICAgICAgICAgICAgICAgICBzdHJ1
Y3QgZHJtX21tX25vZGUgKm5vZGUsIHUzMiBzaXplKQoraW5zZXJ0X21hcHBhYmxlX25vZGUoc3Ry
dWN0IGk5MTVfZ2d0dCAqZ2d0dCwgc3RydWN0IGRybV9tbV9ub2RlICpub2RlLCB1MzIgc2l6ZSkK
IHsKKwlpbnQgcmV0OworCiAJbWVtc2V0KG5vZGUsIDAsIHNpemVvZigqbm9kZSkpOwotCXJldHVy
biBkcm1fbW1faW5zZXJ0X25vZGVfaW5fcmFuZ2UoJmdndHQtPnZtLm1tLCBub2RlLAotCQkJCQkg
ICBzaXplLCAwLCBJOTE1X0NPTE9SX1VORVZJQ1RBQkxFLAotCQkJCQkgICAwLCBnZ3R0LT5tYXBw
YWJsZV9lbmQsCi0JCQkJCSAgIERSTV9NTV9JTlNFUlRfTE9XKTsKKworCXJldCA9IG11dGV4X2xv
Y2tfaW50ZXJydXB0aWJsZSgmZ2d0dC0+dm0ubXV0ZXgpOworCWlmIChyZXQpCisJCXJldHVybiBy
ZXQ7CisKKwlyZXQgPSBkcm1fbW1faW5zZXJ0X25vZGVfaW5fcmFuZ2UoJmdndHQtPnZtLm1tLCBu
b2RlLAorCQkJCQkgIHNpemUsIDAsIEk5MTVfQ09MT1JfVU5FVklDVEFCTEUsCisJCQkJCSAgMCwg
Z2d0dC0+bWFwcGFibGVfZW5kLAorCQkJCQkgIERSTV9NTV9JTlNFUlRfTE9XKTsKKwltdXRleF91
bmxvY2soJmdndHQtPnZtLm11dGV4KTsKKworCXJldHVybiByZXQ7CiB9CiAKIHN0YXRpYyB2b2lk
Ci1yZW1vdmVfbWFwcGFibGVfbm9kZShzdHJ1Y3QgZHJtX21tX25vZGUgKm5vZGUpCityZW1vdmVf
bWFwcGFibGVfbm9kZShzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0LCBzdHJ1Y3QgZHJtX21tX25vZGUg
Km5vZGUpCiB7CisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWRybV9tbV9yZW1vdmVf
bm9kZShub2RlKTsKKwltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIH0KIAogaW50CkBA
IC04NCw4ICs5NSwxMSBAQCBpOTE1X2dlbV9nZXRfYXBlcnR1cmVfaW9jdGwoc3RydWN0IGRybV9k
ZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2dldF9hcGVydHVy
ZSAqYXJncyA9IGRhdGE7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJdTY0IHBpbm5lZDsKKwlp
bnQgcmV0OwogCi0JbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOworCXJldCA9IG11dGV4X2xv
Y2tfaW50ZXJydXB0aWJsZSgmZ2d0dC0+dm0ubXV0ZXgpOworCWlmIChyZXQpCisJCXJldHVybiBy
ZXQ7CiAKIAlwaW5uZWQgPSBnZ3R0LT52bS5yZXNlcnZlZDsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5
KHZtYSwgJmdndHQtPnZtLmJvdW5kX2xpc3QsIHZtX2xpbmspCkBAIC0xMDYsOCArMTIwLDYgQEAg
aW50IGk5MTVfZ2VtX29iamVjdF91bmJpbmQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9i
aikKIAlMSVNUX0hFQUQoc3RpbGxfaW5fbGlzdCk7CiAJaW50IHJldCA9IDA7CiAKLQlsb2NrZGVw
X2Fzc2VydF9oZWxkKCZvYmotPmJhc2UuZGV2LT5zdHJ1Y3RfbXV0ZXgpOwotCiAJc3Bpbl9sb2Nr
KCZvYmotPnZtYS5sb2NrKTsKIAl3aGlsZSAoIXJldCAmJiAodm1hID0gbGlzdF9maXJzdF9lbnRy
eV9vcl9udWxsKCZvYmotPnZtYS5saXN0LAogCQkJCQkJICAgICAgIHN0cnVjdCBpOTE1X3ZtYSwK
QEAgLTExNSw3ICsxMjcsMTEgQEAgaW50IGk5MTVfZ2VtX29iamVjdF91bmJpbmQoc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAkJbGlzdF9tb3ZlX3RhaWwoJnZtYS0+b2JqX2xpbmss
ICZzdGlsbF9pbl9saXN0KTsKIAkJc3Bpbl91bmxvY2soJm9iai0+dm1hLmxvY2spOwogCi0JCXJl
dCA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGli
bGUoJnZtYS0+dm0tPm11dGV4KTsKKwkJaWYgKCFyZXQpIHsKKwkJCXJldCA9IGk5MTVfdm1hX3Vu
YmluZCh2bWEpOworCQkJbXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CisJCX0KIAogCQlz
cGluX2xvY2soJm9iai0+dm1hLmxvY2spOwogCX0KQEAgLTM3MSwxMCArMzg3LDYgQEAgaTkxNV9n
ZW1fZ3R0X3ByZWFkKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJdTY0IHJlbWFp
biwgb2Zmc2V0OwogCWludCByZXQ7CiAKLQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUo
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KIAl3
YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoaTkxNSk7CiAJdm1hID0gaTkxNV9nZW1fb2Jq
ZWN0X2dndHRfcGluKG9iaiwgTlVMTCwgMCwgMCwKIAkJCQkgICAgICAgUElOX01BUFBBQkxFIHwK
QEAgLTM4Myw3ICszOTUsMTIgQEAgaTkxNV9nZW1fZ3R0X3ByZWFkKHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmosCiAJaWYgKCFJU19FUlIodm1hKSkgewogCQlub2RlLnN0YXJ0ID0gaTkx
NV9nZ3R0X29mZnNldCh2bWEpOwogCQlub2RlLmFsbG9jYXRlZCA9IGZhbHNlOwotCQlyZXQgPSBp
OTE1X3ZtYV9wdXRfZmVuY2Uodm1hKTsKKworCQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGli
bGUoJnZtYS0+dm0tPm11dGV4KTsKKwkJaWYgKCFyZXQpIHsKKwkJCXJldCA9IGk5MTVfdm1hX3B1
dF9mZW5jZSh2bWEpOworCQkJbXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CisJCX0KIAkJ
aWYgKHJldCkgewogCQkJaTkxNV92bWFfdW5waW4odm1hKTsKIAkJCXZtYSA9IEVSUl9QVFIocmV0
KTsKQEAgLTM5MiwxMiArNDA5LDEwIEBAIGk5MTVfZ2VtX2d0dF9wcmVhZChzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqLAogCWlmIChJU19FUlIodm1hKSkgewogCQlyZXQgPSBpbnNlcnRf
bWFwcGFibGVfbm9kZShnZ3R0LCAmbm9kZSwgUEFHRV9TSVpFKTsKIAkJaWYgKHJldCkKLQkJCWdv
dG8gb3V0X3VubG9jazsKKwkJCWdvdG8gb3V0X3JwbTsKIAkJR0VNX0JVR19PTighbm9kZS5hbGxv
Y2F0ZWQpOwogCX0KIAotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0K
IAlyZXQgPSBpOTE1X2dlbV9vYmplY3RfbG9ja19pbnRlcnJ1cHRpYmxlKG9iaik7CiAJaWYgKHJl
dCkKIAkJZ290byBvdXRfdW5waW47CkBAIC00NTMsMTcgKzQ2OCwxNSBAQCBpOTE1X2dlbV9ndHRf
cHJlYWQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAogCWk5MTVfZ2VtX29iamVj
dF91bmxvY2tfZmVuY2Uob2JqLCBmZW5jZSk7CiBvdXRfdW5waW46Ci0JbXV0ZXhfbG9jaygmaTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKG5vZGUuYWxsb2NhdGVkKSB7CiAJCXdtYigpOwog
CQlnZ3R0LT52bS5jbGVhcl9yYW5nZSgmZ2d0dC0+dm0sIG5vZGUuc3RhcnQsIG5vZGUuc2l6ZSk7
Ci0JCXJlbW92ZV9tYXBwYWJsZV9ub2RlKCZub2RlKTsKKwkJcmVtb3ZlX21hcHBhYmxlX25vZGUo
Z2d0dCwgJm5vZGUpOwogCX0gZWxzZSB7CiAJCWk5MTVfdm1hX3VucGluKHZtYSk7CiAJfQotb3V0
X3VubG9jazoKK291dF9ycG06CiAJaW50ZWxfcnVudGltZV9wbV9wdXQoaTkxNSwgd2FrZXJlZik7
Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCXJldHVybiByZXQ7
CiB9CkBAIC01NzAsMTAgKzU4Myw2IEBAIGk5MTVfZ2VtX2d0dF9wd3JpdGVfZmFzdChzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCXZvaWQgX191c2VyICp1c2VyX2RhdGE7CiAJaW50
IHJldDsKIAotCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQogCWlmIChpOTE1X2dlbV9vYmpl
Y3RfaGFzX3N0cnVjdF9wYWdlKG9iaikpIHsKIAkJLyoKIAkJICogQXZvaWQgd2FraW5nIHRoZSBk
ZXZpY2UgdXAgaWYgd2UgY2FuIGZhbGxiYWNrLCBhcwpAQCAtNTgzLDEwICs1OTIsOCBAQCBpOTE1
X2dlbV9ndHRfcHdyaXRlX2Zhc3Qoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJ
ICogdXNpbmcgdGhlIGNhY2hlIGJ5cGFzcyBvZiBpbmRpcmVjdCBHR1RUIGFjY2Vzcy4KIAkJICov
CiAJCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldF9pZl9pbl91c2UoaTkxNSk7Ci0JCWlm
ICghd2FrZXJlZikgewotCQkJcmV0ID0gLUVGQVVMVDsKLQkJCWdvdG8gb3V0X3VubG9jazsKLQkJ
fQorCQlpZiAoIXdha2VyZWYpCisJCQlyZXR1cm4gLUVGQVVMVDsKIAl9IGVsc2UgewogCQkvKiBO
byBiYWNraW5nIHBhZ2VzLCBubyBmYWxsYmFjaywgd2UgbXVzdCBmb3JjZSBHR1RUIGFjY2VzcyAq
LwogCQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoaTkxNSk7CkBAIC01OTksNyArNjA2
LDEyIEBAIGk5MTVfZ2VtX2d0dF9wd3JpdGVfZmFzdChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqLAogCWlmICghSVNfRVJSKHZtYSkpIHsKIAkJbm9kZS5zdGFydCA9IGk5MTVfZ2d0dF9v
ZmZzZXQodm1hKTsKIAkJbm9kZS5hbGxvY2F0ZWQgPSBmYWxzZTsKLQkJcmV0ID0gaTkxNV92bWFf
cHV0X2ZlbmNlKHZtYSk7CisKKwkJcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZ2bWEt
PnZtLT5tdXRleCk7CisJCWlmICghcmV0KSB7CisJCQlyZXQgPSBpOTE1X3ZtYV9wdXRfZmVuY2Uo
dm1hKTsKKwkJCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOworCQl9CiAJCWlmIChyZXQp
IHsKIAkJCWk5MTVfdm1hX3VucGluKHZtYSk7CiAJCQl2bWEgPSBFUlJfUFRSKHJldCk7CkBAIC02
MTIsOCArNjI0LDYgQEAgaTkxNV9nZW1fZ3R0X3B3cml0ZV9mYXN0KHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmosCiAJCUdFTV9CVUdfT04oIW5vZGUuYWxsb2NhdGVkKTsKIAl9CiAKLQlt
dXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJcmV0ID0gaTkxNV9nZW1f
b2JqZWN0X2xvY2tfaW50ZXJydXB0aWJsZShvYmopOwogCWlmIChyZXQpCiAJCWdvdG8gb3V0X3Vu
cGluOwpAQCAtNjc2LDE4ICs2ODYsMTUgQEAgaTkxNV9nZW1fZ3R0X3B3cml0ZV9mYXN0KHN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAKIAlpOTE1X2dlbV9vYmplY3RfdW5sb2NrX2Zl
bmNlKG9iaiwgZmVuY2UpOwogb3V0X3VucGluOgotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCWlmIChub2RlLmFsbG9jYXRlZCkgewogCQl3bWIoKTsKIAkJZ2d0dC0+dm0u
Y2xlYXJfcmFuZ2UoJmdndHQtPnZtLCBub2RlLnN0YXJ0LCBub2RlLnNpemUpOwotCQlyZW1vdmVf
bWFwcGFibGVfbm9kZSgmbm9kZSk7CisJCXJlbW92ZV9tYXBwYWJsZV9ub2RlKGdndHQsICZub2Rl
KTsKIAl9IGVsc2UgewogCQlpOTE1X3ZtYV91bnBpbih2bWEpOwogCX0KIG91dF9ycG06CiAJaW50
ZWxfcnVudGltZV9wbV9wdXQoaTkxNSwgd2FrZXJlZik7Ci1vdXRfdW5sb2NrOgotCW11dGV4X3Vu
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIHJldDsKIH0KIApAQCAtMTAz
Miw4ICsxMDM5LDYgQEAgaTkxNV9nZW1fb2JqZWN0X2dndHRfcGluKHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmosCiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJaW50IHJldDsKIAotCWxv
Y2tkZXBfYXNzZXJ0X2hlbGQoJm9iai0+YmFzZS5kZXYtPnN0cnVjdF9tdXRleCk7Ci0KIAlpZiAo
ZmxhZ3MgJiBQSU5fTUFQUEFCTEUgJiYKIAkgICAgKCF2aWV3IHx8IHZpZXctPnR5cGUgPT0gSTkx
NV9HR1RUX1ZJRVdfTk9STUFMKSkgewogCQkvKiBJZiB0aGUgcmVxdWlyZWQgc3BhY2UgaXMgbGFy
Z2VyIHRoYW4gdGhlIGF2YWlsYWJsZQpAQCAtMTA3MCwxNCArMTA3NSwyOCBAQCBpOTE1X2dlbV9v
YmplY3RfZ2d0dF9waW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlpZiAoSVNf
RVJSKHZtYSkpCiAJCXJldHVybiB2bWE7CiAKKwlyZXQgPSBpOTE1X2dlbV9vYmplY3RfcGluX3Bh
Z2VzKG9iaik7CisJaWYgKHJldCkKKwkJcmV0dXJuIEVSUl9QVFIocmV0KTsKKworCXJldCA9IG11
dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmdm0tPm11dGV4KTsKKwlpZiAocmV0KSB7CisJCXZtYSA9
IEVSUl9QVFIocmV0KTsKKwkJZ290byB1bnBpbjsKKwl9CisKIAlpZiAoaTkxNV92bWFfbWlzcGxh
Y2VkKHZtYSwgc2l6ZSwgYWxpZ25tZW50LCBmbGFncykpIHsKIAkJaWYgKGZsYWdzICYgUElOX05P
TkJMT0NLKSB7Ci0JCQlpZiAoaTkxNV92bWFfaXNfcGlubmVkKHZtYSkgfHwgaTkxNV92bWFfaXNf
YWN0aXZlKHZtYSkpCi0JCQkJcmV0dXJuIEVSUl9QVFIoLUVOT1NQQyk7CisJCQlpZiAoaTkxNV92
bWFfaXNfcGlubmVkKHZtYSkgfHwgaTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpIHsKKwkJCQl2bWEg
PSBFUlJfUFRSKC1FTk9TUEMpOworCQkJCWdvdG8gdW5sb2NrOworCQkJfQogCiAJCQlpZiAoZmxh
Z3MgJiBQSU5fTUFQUEFCTEUgJiYKLQkJCSAgICB2bWEtPmZlbmNlX3NpemUgPiBkZXZfcHJpdi0+
Z2d0dC5tYXBwYWJsZV9lbmQgLyAyKQotCQkJCXJldHVybiBFUlJfUFRSKC1FTk9TUEMpOworCQkJ
ICAgIHZtYS0+ZmVuY2Vfc2l6ZSA+IGRldl9wcml2LT5nZ3R0Lm1hcHBhYmxlX2VuZCAvIDIpIHsK
KwkJCQl2bWEgPSBFUlJfUFRSKC1FTk9TUEMpOworCQkJCWdvdG8gdW5sb2NrOworCQkJfQogCQl9
CiAKIAkJV0FSTihpOTE1X3ZtYV9pc19waW5uZWQodm1hKSwKQEAgLTEwODgsMTQgKzExMDcsMjAg
QEAgaTkxNV9nZW1fb2JqZWN0X2dndHRfcGluKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
YmosCiAJCSAgICAgISEoZmxhZ3MgJiBQSU5fTUFQUEFCTEUpLAogCQkgICAgIGk5MTVfdm1hX2lz
X21hcF9hbmRfZmVuY2VhYmxlKHZtYSkpOwogCQlyZXQgPSBpOTE1X3ZtYV91bmJpbmQodm1hKTsK
LQkJaWYgKHJldCkKLQkJCXJldHVybiBFUlJfUFRSKHJldCk7CisJCWlmIChyZXQpIHsKKwkJCXZt
YSA9IEVSUl9QVFIocmV0KTsKKwkJCWdvdG8gdW5sb2NrOworCQl9CiAJfQogCi0JcmV0ID0gaTkx
NV92bWFfcGluKHZtYSwgc2l6ZSwgYWxpZ25tZW50LCBmbGFncyB8IFBJTl9HTE9CQUwpOworCXJl
dCA9IF9faTkxNV92bWFfZG9fcGluKHZtYSwgc2l6ZSwgYWxpZ25tZW50LCBmbGFncyB8IFBJTl9H
TE9CQUwpOwogCWlmIChyZXQpCi0JCXJldHVybiBFUlJfUFRSKHJldCk7CisJCXZtYSA9IEVSUl9Q
VFIocmV0KTsKIAordW5sb2NrOgorCW11dGV4X3VubG9jaygmdm0tPm11dGV4KTsKK3VucGluOgor
CWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmopOwogCXJldHVybiB2bWE7CiB9CiAKQEAg
LTEzOTQsNyArMTQxOSw5IEBAIHN0YXRpYyBpbnQgX19pbnRlbF9lbmdpbmVzX3JlY29yZF9kZWZh
dWx0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkJICogZnJvbSB0aGUgR1RUIHRv
IHByZXZlbnQgc3VjaCBhY2NpZGVudHMgYW5kIHJlY2xhaW0gdGhlCiAJCSAqIHNwYWNlLgogCQkg
Ki8KKwkJbXV0ZXhfbG9jaygmc3RhdGUtPnZtLT5tdXRleCk7CiAJCWVyciA9IGk5MTVfdm1hX3Vu
YmluZChzdGF0ZSk7CisJCW11dGV4X3VubG9jaygmc3RhdGUtPnZtLT5tdXRleCk7CiAJCWlmIChl
cnIpCiAJCQlnb3RvIGVycl9hY3RpdmU7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtX2V2aWN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ldmlj
dC5jCmluZGV4IGE1NzgzYzRjYjk4Yi4uMDIwMmY1OGQ4YmI1IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ldmljdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ2VtX2V2aWN0LmMKQEAgLTQ4LDggKzQ4LDcgQEAgc3RhdGljIGludCBnZ3R0X2ZsdXNo
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCSAqIGJvdW5kIGJ5IHRoZWlyIGFjdGl2
ZSByZWZlcmVuY2UuCiAJICovCiAJcmV0dXJuIGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoaTkxNSwK
LQkJCQkgICAgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSB8Ci0JCQkJICAgICAgSTkxNV9XQUlU
X0xPQ0tFRCwKKwkJCQkgICAgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSwKIAkJCQkgICAgICBN
QVhfU0NIRURVTEVfVElNRU9VVCk7CiB9CiAKQEAgLTEwOCw3ICsxMDcsNyBAQCBpOTE1X2dlbV9l
dmljdF9zb21ldGhpbmcoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJc3RydWN0IGk5
MTVfdm1hICphY3RpdmU7CiAJaW50IHJldDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5p
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bS0+bXV0ZXgp
OwogCXRyYWNlX2k5MTVfZ2VtX2V2aWN0KHZtLCBtaW5fc2l6ZSwgYWxpZ25tZW50LCBmbGFncyk7
CiAKIAkvKgpAQCAtMTMxLDE1ICsxMzAsNiBAQCBpOTE1X2dlbV9ldmljdF9zb21ldGhpbmcoc3Ry
dWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJCQkJICAgIG1pbl9zaXplLCBhbGlnbm1lbnQs
IGNhY2hlX2xldmVsLAogCQkJCSAgICBzdGFydCwgZW5kLCBtb2RlKTsKIAotCS8qCi0JICogUmV0
aXJlIGJlZm9yZSB3ZSBzZWFyY2ggdGhlIGFjdGl2ZSBsaXN0LiBBbHRob3VnaCB3ZSBoYXZlCi0J
ICogcmVhc29uYWJsZSBhY2N1cmFjeSBpbiBvdXIgcmV0aXJlbWVudCBsaXN0cywgd2UgbWF5IGhh
dmUKLQkgKiBhIHN0cmF5IHBpbiAocHJldmVudGluZyBldmljdGlvbikgdGhhdCBjYW4gb25seSBi
ZSByZXNvbHZlZCBieQotCSAqIHJldGlyaW5nLgotCSAqLwotCWlmICghKGZsYWdzICYgUElOX05P
TkJMT0NLKSkKLQkJaTkxNV9yZXRpcmVfcmVxdWVzdHMoZGV2X3ByaXYpOwotCiBzZWFyY2hfYWdh
aW46CiAJYWN0aXZlID0gTlVMTDsKIAlJTklUX0xJU1RfSEVBRCgmZXZpY3Rpb25fbGlzdCk7CkBA
IC0yNzMsMjAgKzI2MywxMiBAQCBpbnQgaTkxNV9nZW1fZXZpY3RfZm9yX25vZGUoc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJYm9vbCBjaGVja19jb2xvcjsKIAlpbnQgcmV0ID0gMDsK
IAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwls
b2NrZGVwX2Fzc2VydF9oZWxkKCZ2bS0+bXV0ZXgpOwogCUdFTV9CVUdfT04oIUlTX0FMSUdORUQo
c3RhcnQsIEk5MTVfR1RUX1BBR0VfU0laRSkpOwogCUdFTV9CVUdfT04oIUlTX0FMSUdORUQoZW5k
LCBJOTE1X0dUVF9QQUdFX1NJWkUpKTsKIAogCXRyYWNlX2k5MTVfZ2VtX2V2aWN0X25vZGUodm0s
IHRhcmdldCwgZmxhZ3MpOwogCi0JLyogUmV0aXJlIGJlZm9yZSB3ZSBzZWFyY2ggdGhlIGFjdGl2
ZSBsaXN0LiBBbHRob3VnaCB3ZSBoYXZlCi0JICogcmVhc29uYWJsZSBhY2N1cmFjeSBpbiBvdXIg
cmV0aXJlbWVudCBsaXN0cywgd2UgbWF5IGhhdmUKLQkgKiBhIHN0cmF5IHBpbiAocHJldmVudGlu
ZyBldmljdGlvbikgdGhhdCBjYW4gb25seSBiZSByZXNvbHZlZCBieQotCSAqIHJldGlyaW5nLgot
CSAqLwotCWlmICghKGZsYWdzICYgUElOX05PTkJMT0NLKSkKLQkJaTkxNV9yZXRpcmVfcmVxdWVz
dHModm0tPmk5MTUpOwotCiAJY2hlY2tfY29sb3IgPSB2bS0+bW0uY29sb3JfYWRqdXN0OwogCWlm
IChjaGVja19jb2xvcikgewogCQkvKiBFeHBhbmQgc2VhcmNoIHRvIGNvdmVyIG5laWdoYm91cmlu
ZyBndWFyZCBwYWdlcyAob3IgbGFjayEpICovCkBAIC0zODQsNyArMzY2LDcgQEAgaW50IGk5MTVf
Z2VtX2V2aWN0X3ZtKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogCXN0cnVjdCBpOTE1
X3ZtYSAqdm1hLCAqbmV4dDsKIAlpbnQgcmV0OwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm0t
Pmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5tdXRl
eCk7CiAJdHJhY2VfaTkxNV9nZW1fZXZpY3Rfdm0odm0pOwogCiAJLyogU3dpdGNoIGJhY2sgdG8g
dGhlIGRlZmF1bHQgY29udGV4dCBpbiBvcmRlciB0byB1bnBpbgpAQCAtMzk5LDcgKzM4MSw2IEBA
IGludCBpOTE1X2dlbV9ldmljdF92bShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIAl9
CiAKIAlJTklUX0xJU1RfSEVBRCgmZXZpY3Rpb25fbGlzdCk7Ci0JbXV0ZXhfbG9jaygmdm0tPm11
dGV4KTsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KHZtYSwgJnZtLT5ib3VuZF9saXN0LCB2bV9saW5r
KSB7CiAJCWlmIChpOTE1X3ZtYV9pc19waW5uZWQodm1hKSkKIAkJCWNvbnRpbnVlOwpAQCAtNDA3
LDcgKzM4OCw2IEBAIGludCBpOTE1X2dlbV9ldmljdF92bShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3Nw
YWNlICp2bSkKIAkJX19pOTE1X3ZtYV9waW4odm1hKTsKIAkJbGlzdF9hZGQoJnZtYS0+ZXZpY3Rf
bGluaywgJmV2aWN0aW9uX2xpc3QpOwogCX0KLQltdXRleF91bmxvY2soJnZtLT5tdXRleCk7CiAK
IAlyZXQgPSAwOwogCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZSh2bWEsIG5leHQsICZldmljdGlv
bl9saXN0LCBldmljdF9saW5rKSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9mZW5jZV9yZWcuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2ZlbmNl
X3JlZy5jCmluZGV4IDU0M2M1YTQ3Y2M3OS4uNTdmMWNhNGNjOWZiIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9mZW5jZV9yZWcuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbV9mZW5jZV9yZWcuYwpAQCAtMzM5LDI2ICszMzksOCBAQCBzdGF0aWMg
c3RydWN0IGk5MTVfZmVuY2VfcmVnICpmZW5jZV9maW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQogCXJldHVybiBFUlJfUFRSKC1FREVBRExLKTsKIH0KIAotLyoqCi0gKiBpOTE1X3Zt
YV9waW5fZmVuY2UgLSBzZXQgdXAgZmVuY2luZyBmb3IgYSB2bWEKLSAqIEB2bWE6IHZtYSB0byBt
YXAgdGhyb3VnaCBhIGZlbmNlIHJlZwotICoKLSAqIFdoZW4gbWFwcGluZyBvYmplY3RzIHRocm91
Z2ggdGhlIEdUVCwgdXNlcnNwYWNlIHdhbnRzIHRvIGJlIGFibGUgdG8gd3JpdGUKLSAqIHRvIHRo
ZW0gd2l0aG91dCBoYXZpbmcgdG8gd29ycnkgYWJvdXQgc3dpenpsaW5nIGlmIHRoZSBvYmplY3Qg
aXMgdGlsZWQuCi0gKiBUaGlzIGZ1bmN0aW9uIHdhbGtzIHRoZSBmZW5jZSByZWdzIGxvb2tpbmcg
Zm9yIGEgZnJlZSBvbmUgZm9yIEBvYmosCi0gKiBzdGVhbGluZyBvbmUgaWYgaXQgY2FuJ3QgZmlu
ZCBhbnkuCi0gKgotICogSXQgdGhlbiBzZXRzIHVwIHRoZSByZWcgYmFzZWQgb24gdGhlIG9iamVj
dCdzIHByb3BlcnRpZXM6IGFkZHJlc3MsIHBpdGNoCi0gKiBhbmQgdGlsaW5nIGZvcm1hdC4KLSAq
Ci0gKiBGb3IgYW4gdW50aWxlZCBzdXJmYWNlLCB0aGlzIHJlbW92ZXMgYW55IGV4aXN0aW5nIGZl
bmNlLgotICoKLSAqIFJldHVybnM6Ci0gKgotICogMCBvbiBzdWNjZXNzLCBuZWdhdGl2ZSBlcnJv
ciBjb2RlIG9uIGZhaWx1cmUuCi0gKi8KIGludAotaTkxNV92bWFfcGluX2ZlbmNlKHN0cnVjdCBp
OTE1X3ZtYSAqdm1hKQorX19pOTE1X3ZtYV9waW5fZmVuY2Uoc3RydWN0IGk5MTVfdm1hICp2bWEp
CiB7CiAJc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCA9IGk5MTVfdm1fdG9fZ2d0dCh2bWEtPnZtKTsK
IAlzdHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmZlbmNlOwpAQCAtMzcwLDEyICszNTIsOSBAQCBpOTE1
X3ZtYV9waW5fZmVuY2Uoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJICogbXVzdCBrZWVwIHRoZSBk
ZXZpY2UgYXdha2Ugd2hpbHN0IHVzaW5nIHRoZSBmZW5jZS4KIAkgKi8KIAlhc3NlcnRfcnBtX3dh
a2Vsb2NrX2hlbGQoZ2d0dC0+dm0uaTkxNSk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmZ2d0dC0+
dm0ubXV0ZXgpOwogCUdFTV9CVUdfT04oIWk5MTVfdm1hX2lzX3Bpbm5lZCh2bWEpKTsKIAotCWVy
ciA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmZ2d0dC0+dm0ubXV0ZXgpOwotCWlmIChlcnIp
Ci0JCXJldHVybiBlcnI7Ci0KIAkvKiBKdXN0IHVwZGF0ZSBvdXIgcGxhY2UgaW4gdGhlIExSVSBp
ZiBvdXIgZmVuY2UgaXMgZ2V0dGluZyByZXVzZWQuICovCiAJaWYgKHZtYS0+ZmVuY2UpIHsKIAkJ
ZmVuY2UgPSB2bWEtPmZlbmNlOwpAQCAtMzgzLDE5ICszNjIsMTcgQEAgaTkxNV92bWFfcGluX2Zl
bmNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCQlhdG9taWNfaW5jKCZmZW5jZS0+cGluX2NvdW50
KTsKIAkJaWYgKCFmZW5jZS0+ZGlydHkpIHsKIAkJCWxpc3RfbW92ZV90YWlsKCZmZW5jZS0+bGlu
aywgJmdndHQtPmZlbmNlX2xpc3QpOwotCQkJZ290byB1bmxvY2s7CisJCQlyZXR1cm4gMDsKIAkJ
fQogCX0gZWxzZSBpZiAoc2V0KSB7CiAJCWZlbmNlID0gZmVuY2VfZmluZCh2bWEtPnZtLT5pOTE1
KTsKLQkJaWYgKElTX0VSUihmZW5jZSkpIHsKLQkJCWVyciA9IFBUUl9FUlIoZmVuY2UpOwotCQkJ
Z290byB1bmxvY2s7Ci0JCX0KKwkJaWYgKElTX0VSUihmZW5jZSkpCisJCQlyZXR1cm4gUFRSX0VS
UihmZW5jZSk7CiAKIAkJR0VNX0JVR19PTihhdG9taWNfcmVhZCgmZmVuY2UtPnBpbl9jb3VudCkp
OwogCQlhdG9taWNfaW5jKCZmZW5jZS0+cGluX2NvdW50KTsKIAl9IGVsc2UgewotCQlnb3RvIHVu
bG9jazsKKwkJcmV0dXJuIDA7CiAJfQogCiAJZXJyID0gZmVuY2VfdXBkYXRlKGZlbmNlLCBzZXQp
OwpAQCAtNDA2LDEyICszODMsNDQgQEAgaTkxNV92bWFfcGluX2ZlbmNlKHN0cnVjdCBpOTE1X3Zt
YSAqdm1hKQogCUdFTV9CVUdfT04odm1hLT5mZW5jZSAhPSAoc2V0ID8gZmVuY2UgOiBOVUxMKSk7
CiAKIAlpZiAoc2V0KQotCQlnb3RvIHVubG9jazsKKwkJcmV0dXJuIDA7CiAKIG91dF91bnBpbjoK
IAlhdG9taWNfZGVjKCZmZW5jZS0+cGluX2NvdW50KTsKLXVubG9jazoKKwlyZXR1cm4gZXJyOwor
fQorCisvKioKKyAqIGk5MTVfdm1hX3Bpbl9mZW5jZSAtIHNldCB1cCBmZW5jaW5nIGZvciBhIHZt
YQorICogQHZtYTogdm1hIHRvIG1hcCB0aHJvdWdoIGEgZmVuY2UgcmVnCisgKgorICogV2hlbiBt
YXBwaW5nIG9iamVjdHMgdGhyb3VnaCB0aGUgR1RULCB1c2Vyc3BhY2Ugd2FudHMgdG8gYmUgYWJs
ZSB0byB3cml0ZQorICogdG8gdGhlbSB3aXRob3V0IGhhdmluZyB0byB3b3JyeSBhYm91dCBzd2l6
emxpbmcgaWYgdGhlIG9iamVjdCBpcyB0aWxlZC4KKyAqIFRoaXMgZnVuY3Rpb24gd2Fsa3MgdGhl
IGZlbmNlIHJlZ3MgbG9va2luZyBmb3IgYSBmcmVlIG9uZSBmb3IgQG9iaiwKKyAqIHN0ZWFsaW5n
IG9uZSBpZiBpdCBjYW4ndCBmaW5kIGFueS4KKyAqCisgKiBJdCB0aGVuIHNldHMgdXAgdGhlIHJl
ZyBiYXNlZCBvbiB0aGUgb2JqZWN0J3MgcHJvcGVydGllczogYWRkcmVzcywgcGl0Y2gKKyAqIGFu
ZCB0aWxpbmcgZm9ybWF0LgorICoKKyAqIEZvciBhbiB1bnRpbGVkIHN1cmZhY2UsIHRoaXMgcmVt
b3ZlcyBhbnkgZXhpc3RpbmcgZmVuY2UuCisgKgorICogUmV0dXJuczoKKyAqCisgKiAwIG9uIHN1
Y2Nlc3MsIG5lZ2F0aXZlIGVycm9yIGNvZGUgb24gZmFpbHVyZS4KKyAqLworaW50CitpOTE1X3Zt
YV9waW5fZmVuY2Uoc3RydWN0IGk5MTVfdm1hICp2bWEpCit7CisJc3RydWN0IGk5MTVfZ2d0dCAq
Z2d0dCA9IGk5MTVfdm1fdG9fZ2d0dCh2bWEtPnZtKTsKKwlpbnQgZXJyOworCisJZXJyID0gbXV0
ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZnZ3R0LT52bS5tdXRleCk7CisJaWYgKGVycikKKwkJcmV0
dXJuIGVycjsKKworCWVyciA9IF9faTkxNV92bWFfcGluX2ZlbmNlKHZtYSk7CiAJbXV0ZXhfdW5s
b2NrKCZnZ3R0LT52bS5tdXRleCk7CisKIAlyZXR1cm4gZXJyOwogfQogCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ2VtX2d0dC5jCmluZGV4IGJmY2E4YTRhODhlMi4uZjRkYmU0MTk5MTIwIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwpAQCAtMTkyOSw2MiArMTkyOSwxNSBAQCBzdGF0aWMg
dm9pZCBnZW42X3BwZ3R0X2ZyZWVfcGQoc3RydWN0IGdlbjZfcHBndHQgKnBwZ3R0KQogCQkJZnJl
ZV9wdCgmcHBndHQtPmJhc2Uudm0sIHB0KTsKIH0KIAotc3RydWN0IGdlbjZfcHBndHRfY2xlYW51
cF93b3JrIHsKLQlzdHJ1Y3Qgd29ya19zdHJ1Y3QgYmFzZTsKLQlzdHJ1Y3QgaTkxNV92bWEgKnZt
YTsKLX07Ci0KLXN0YXRpYyB2b2lkIGdlbjZfcHBndHRfY2xlYW51cF93b3JrKHN0cnVjdCB3b3Jr
X3N0cnVjdCAqd3JrKQotewotCXN0cnVjdCBnZW42X3BwZ3R0X2NsZWFudXBfd29yayAqd29yayA9
Ci0JCWNvbnRhaW5lcl9vZih3cmssIHR5cGVvZigqd29yayksIGJhc2UpOwotCS8qIFNpZGUgbm90
ZSwgdm1hLT52bSBpcyB0aGUgR0dUVCBub3QgdGhlIHBwZ3R0IHdlIGp1c3QgZGVzdHJveWVkISAq
LwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gd29yay0+dm1hLT52bS0+aTkxNTsK
LQotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWk5MTVfdm1hX2Rlc3Ry
b3kod29yay0+dm1hKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwot
Ci0Ja2ZyZWUod29yayk7Ci19Ci0KLXN0YXRpYyBpbnQgbm9wX3NldF9wYWdlcyhzdHJ1Y3QgaTkx
NV92bWEgKnZtYSkKLXsKLQlyZXR1cm4gLUVOT0RFVjsKLX0KLQotc3RhdGljIHZvaWQgbm9wX2Ns
ZWFyX3BhZ2VzKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQotewotfQotCi1zdGF0aWMgaW50IG5vcF9i
aW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAotCQkgICAgZW51bSBpOTE1X2NhY2hlX2xldmVsIGNh
Y2hlX2xldmVsLAotCQkgICAgdTMyIHVudXNlZCkKLXsKLQlyZXR1cm4gLUVOT0RFVjsKLX0KLQot
c3RhdGljIHZvaWQgbm9wX3VuYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKLXsKLX0KLQotc3Rh
dGljIGNvbnN0IHN0cnVjdCBpOTE1X3ZtYV9vcHMgbm9wX3ZtYV9vcHMgPSB7Ci0JLnNldF9wYWdl
cyA9IG5vcF9zZXRfcGFnZXMsCi0JLmNsZWFyX3BhZ2VzID0gbm9wX2NsZWFyX3BhZ2VzLAotCS5i
aW5kX3ZtYSA9IG5vcF9iaW5kLAotCS51bmJpbmRfdm1hID0gbm9wX3VuYmluZCwKLX07Ci0KIHN0
YXRpYyB2b2lkIGdlbjZfcHBndHRfY2xlYW51cChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2
bSkKIHsKIAlzdHJ1Y3QgZ2VuNl9wcGd0dCAqcHBndHQgPSB0b19nZW42X3BwZ3R0KGk5MTVfdm1f
dG9fcHBndHQodm0pKTsKLQlzdHJ1Y3QgZ2VuNl9wcGd0dF9jbGVhbnVwX3dvcmsgKndvcmsgPSBw
cGd0dC0+d29yazsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICpnZ3R0ID0gcHBndHQtPnZt
YS0+dm07CiAKLQkvKiBGSVhNRSByZW1vdmUgdGhlIHN0cnVjdF9tdXRleCB0byBicmluZyB0aGUg
bG9ja2luZyB1bmRlciBjb250cm9sICovCi0JSU5JVF9XT1JLKCZ3b3JrLT5iYXNlLCBnZW42X3Bw
Z3R0X2NsZWFudXBfd29yayk7Ci0Jd29yay0+dm1hID0gcHBndHQtPnZtYTsKLQl3b3JrLT52bWEt
Pm9wcyA9ICZub3Bfdm1hX29wczsKLQlzY2hlZHVsZV93b3JrKCZ3b3JrLT5iYXNlKTsKKwltdXRl
eF9sb2NrKCZnZ3R0LT5tdXRleCk7CisJR0VNX0JVR19PTihwcGd0dC0+dm1hLT52bSAhPSBnZ3R0
KTsKKwlpOTE1X3ZtYV9kZXN0cm95KHBwZ3R0LT52bWEpOworCW11dGV4X3VubG9jaygmZ2d0dC0+
bXV0ZXgpOwogCiAJZ2VuNl9wcGd0dF9mcmVlX3BkKHBwZ3R0KTsKIAlnZW42X3BwZ3R0X2ZyZWVf
c2NyYXRjaCh2bSk7CkBAIC0yMTU5LDE1ICsyMTEyLDkgQEAgc3RhdGljIHN0cnVjdCBpOTE1X3Bw
Z3R0ICpnZW42X3BwZ3R0X2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAog
CXBwZ3R0LT5iYXNlLnZtLnB0ZV9lbmNvZGUgPSBnZ3R0LT52bS5wdGVfZW5jb2RlOwogCi0JcHBn
dHQtPndvcmsgPSBrbWFsbG9jKHNpemVvZigqcHBndHQtPndvcmspLCBHRlBfS0VSTkVMKTsKLQlp
ZiAoIXBwZ3R0LT53b3JrKSB7Ci0JCWVyciA9IC1FTk9NRU07Ci0JCWdvdG8gZXJyX2ZyZWU7Ci0J
fQotCiAJZXJyID0gZ2VuNl9wcGd0dF9pbml0X3NjcmF0Y2gocHBndHQpOwogCWlmIChlcnIpCi0J
CWdvdG8gZXJyX3dvcms7CisJCWdvdG8gZXJyX2ZyZWU7CiAKIAlwcGd0dC0+dm1hID0gcGRfdm1h
X2NyZWF0ZShwcGd0dCwgR0VONl9QRF9TSVpFKTsKIAlpZiAoSVNfRVJSKHBwZ3R0LT52bWEpKSB7
CkBAIC0yMTc5LDggKzIxMjYsNiBAQCBzdGF0aWMgc3RydWN0IGk5MTVfcHBndHQgKmdlbjZfcHBn
dHRfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCiBlcnJfc2NyYXRjaDoK
IAlnZW42X3BwZ3R0X2ZyZWVfc2NyYXRjaCgmcHBndHQtPmJhc2Uudm0pOwotZXJyX3dvcms6Ci0J
a2ZyZWUocHBndHQtPndvcmspOwogZXJyX2ZyZWU6CiAJa2ZyZWUocHBndHQpOwogCXJldHVybiBF
UlJfUFRSKGVycik7CkBAIC0yMjcyLDcgKzIyMTcsOSBAQCB2b2lkIGk5MTVfdm1fcmVsZWFzZShz
dHJ1Y3Qga3JlZiAqa3JlZikKIAlHRU1fQlVHX09OKGk5MTVfaXNfZ2d0dCh2bSkpOwogCXRyYWNl
X2k5MTVfcHBndHRfcmVsZWFzZSh2bSk7CiAKKwltdXRleF9sb2NrKCZ2bS0+bXV0ZXgpOwogCXBw
Z3R0X2Rlc3Ryb3lfdm1hKHZtKTsKKwltdXRleF91bmxvY2soJnZtLT5tdXRleCk7CiAKIAlHRU1f
QlVHX09OKCFsaXN0X2VtcHR5KCZ2bS0+Ym91bmRfbGlzdCkpOwogCkBAIC0yOTQ0LDExICsyODkx
LDEyIEBAIHZvaWQgaTkxNV9nZ3R0X2NsZWFudXBfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQogCiAJZ2d0dC0+dm0uY2xvc2VkID0gdHJ1ZTsKIAotCW11dGV4X2xvY2soJmRl
dl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIAlmaW5pX2FsaWFzaW5nX3BwZ3R0KGRldl9wcml2
KTsKIAorCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5
X3NhZmUodm1hLCB2biwgJmdndHQtPnZtLmJvdW5kX2xpc3QsIHZtX2xpbmspCiAJCVdBUk5fT04o
aTkxNV92bWFfdW5iaW5kKHZtYSkpOworCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwog
CiAJaWYgKGRybV9tbV9ub2RlX2FsbG9jYXRlZCgmZ2d0dC0+ZXJyb3JfY2FwdHVyZSkpCiAJCWRy
bV9tbV9yZW1vdmVfbm9kZSgmZ2d0dC0+ZXJyb3JfY2FwdHVyZSk7CkBAIC0yOTY4LDggKzI5MTYs
NiBAQCB2b2lkIGk5MTVfZ2d0dF9jbGVhbnVwX2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKIAkJX19wYWdldmVjX3JlbGVhc2UocHZlYyk7CiAJfQogCi0JbXV0ZXhfdW5sb2Nr
KCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlhcmNoX3BoeXNfd2NfZGVsKGdndHQt
Pm10cnIpOwogCWlvX21hcHBpbmdfZmluaSgmZ2d0dC0+aW9tYXApOwogCkBAIC0zNTcyLDcgKzM1
MTgsNiBAQCBpbnQgaTkxNV9nZ3R0X2luaXRfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQogCSAqIGJleW9uZCB0aGUgZW5kIG9mIHRoZSBiYXRjaCBidWZmZXIsIGFjcm9zcyB0
aGUgcGFnZSBib3VuZGFyeSwKIAkgKiBhbmQgYmV5b25kIHRoZSBlbmQgb2YgdGhlIEdUVCBpZiB3
ZSBkbyBub3QgcHJvdmlkZSBhIGd1YXJkLgogCSAqLwotCW11dGV4X2xvY2soJmRldl9wcml2LT5k
cm0uc3RydWN0X211dGV4KTsKIAlpOTE1X2FkZHJlc3Nfc3BhY2VfaW5pdCgmZ2d0dC0+dm0sIFZN
X0NMQVNTX0dHVFQpOwogCiAJZ2d0dC0+dm0uaXNfZ2d0dCA9IHRydWU7CkBAIC0zNTgyLDcgKzM1
MjcsNiBAQCBpbnQgaTkxNV9nZ3R0X2luaXRfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQogCiAJaWYgKCFIQVNfTExDKGRldl9wcml2KSAmJiAhSEFTX1BQR1RUKGRldl9wcml2
KSkKIAkJZ2d0dC0+dm0ubW0uY29sb3JfYWRqdXN0ID0gaTkxNV9ndHRfY29sb3JfYWRqdXN0Owot
CW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJaWYgKCFpb19t
YXBwaW5nX2luaXRfd2MoJmRldl9wcml2LT5nZ3R0LmlvbWFwLAogCQkJCWRldl9wcml2LT5nZ3R0
LmdtYWRyLnN0YXJ0LApAQCAtMzY2MSwxMCArMzYwNSw4IEBAIHZvaWQgaTkxNV9nZW1fcmVzdG9y
ZV9ndHRfbWFwcGluZ3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlpZiAo
ISh2bWEtPmZsYWdzICYgSTkxNV9WTUFfR0xPQkFMX0JJTkQpKQogCQkJY29udGludWU7CiAKLQkJ
bXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7Ci0KIAkJaWYgKCFpOTE1X3ZtYV91bmJpbmQo
dm1hKSkKLQkJCWdvdG8gbG9jazsKKwkJCWNvbnRpbnVlOwogCiAJCVdBUk5fT04oaTkxNV92bWFf
YmluZCh2bWEsCiAJCQkJICAgICAgb2JqID8gb2JqLT5jYWNoZV9sZXZlbCA6IDAsCkBAIC0zNjc0
LDkgKzM2MTYsNiBAQCB2b2lkIGk5MTVfZ2VtX3Jlc3RvcmVfZ3R0X21hcHBpbmdzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJCVdBUk5fT04oaTkxNV9nZW1fb2JqZWN0X3Nl
dF90b19ndHRfZG9tYWluKG9iaiwgZmFsc2UpKTsKIAkJCWk5MTVfZ2VtX29iamVjdF91bmxvY2so
b2JqKTsKIAkJfQotCi1sb2NrOgotCQltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJfQog
CiAJZ2d0dC0+dm0uY2xvc2VkID0gZmFsc2U7CkBAIC00MDczLDcgKzQwMTIsNyBAQCBpbnQgaTkx
NV9nZW1fZ3R0X2luc2VydChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAl1NjQgb2Zm
c2V0OwogCWludCBlcnI7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bS0+aTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm0tPm11dGV4KTsKIAlHRU1fQlVH
X09OKCFzaXplKTsKIAlHRU1fQlVHX09OKCFJU19BTElHTkVEKHNpemUsIEk5MTVfR1RUX1BBR0Vf
U0laRSkpOwogCUdFTV9CVUdfT04oYWxpZ25tZW50ICYmICFpc19wb3dlcl9vZl8yKGFsaWdubWVu
dCkpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaAppbmRleCAwZTk5MjZiMzI0MDguLjgw
NmJhMjgxNmE2OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0
LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmgKQEAgLTQzOSw4ICs0
MzksNiBAQCBzdHJ1Y3QgZ2VuNl9wcGd0dCB7CiAKIAl1bnNpZ25lZCBpbnQgcGluX2NvdW50Owog
CWJvb2wgc2Nhbl9mb3JfdW51c2VkX3B0OwotCi0Jc3RydWN0IGdlbjZfcHBndHRfY2xlYW51cF93
b3JrICp3b3JrOwogfTsKIAogI2RlZmluZSBfX3RvX2dlbjZfcHBndHQoYmFzZSkgY29udGFpbmVy
X29mKGJhc2UsIHN0cnVjdCBnZW42X3BwZ3R0LCBiYXNlKQpAQCAtNjk0LDcgKzY5Miw2IEBAIGlu
dCBpOTE1X2dlbV9ndHRfaW5zZXJ0KHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogI2Rl
ZmluZSBQSU5fT0ZGU0VUX0JJQVMJCUJJVF9VTEwoNikKICNkZWZpbmUgUElOX09GRlNFVF9GSVhF
RAlCSVRfVUxMKDcpCiAKLSNkZWZpbmUgUElOX01CWgkJCUJJVF9VTEwoOCkgLyogSTkxNV9WTUFf
UElOX09WRVJGTE9XICovCiAjZGVmaW5lIFBJTl9HTE9CQUwJCUJJVF9VTEwoOSkgLyogSTkxNV9W
TUFfR0xPQkFMX0JJTkQgKi8KICNkZWZpbmUgUElOX1VTRVIJCUJJVF9VTEwoMTApIC8qIEk5MTVf
Vk1BX0xPQ0FMX0JJTkQgKi8KICNkZWZpbmUgUElOX1VQREFURQkJQklUX1VMTCgxMSkKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9wZXJmLmMKaW5kZXggMmUzM2E5YjRlYWU3Li41MTdjM2ExNmYxY2QgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcGVyZi5jCkBAIC0xMzQ3LDEzICsxMzQ3LDkgQEAgc3RhdGljIHZvaWQg
b2FfcHV0X3JlbmRlcl9jdHhfaWQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIHN0
YXRpYyB2b2lkCiBmcmVlX29hX2J1ZmZlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
IHsKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWk5MTVfdm1hX3Vu
cGluX2FuZF9yZWxlYXNlKCZpOTE1LT5wZXJmLm9hLm9hX2J1ZmZlci52bWEsCiAJCQkJICAgSTkx
NV9WTUFfUkVMRUFTRV9NQVApOwogCi0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKLQogCWk5MTUtPnBlcmYub2Eub2FfYnVmZmVyLnZhZGRyID0gTlVMTDsKIH0KIApAQCAt
MTUwNSwxOSArMTUwMSwxMiBAQCBzdGF0aWMgaW50IGFsbG9jX29hX2J1ZmZlcihzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJaWYgKFdBUk5fT04oZGV2X3ByaXYtPnBlcmYub2Eu
b2FfYnVmZmVyLnZtYSkpCiAJCXJldHVybiAtRU5PREVWOwogCi0JcmV0ID0gaTkxNV9tdXRleF9s
b2NrX2ludGVycnVwdGlibGUoJmRldl9wcml2LT5kcm0pOwotCWlmIChyZXQpCi0JCXJldHVybiBy
ZXQ7Ci0KIAlCVUlMRF9CVUdfT05fTk9UX1BPV0VSX09GXzIoT0FfQlVGRkVSX1NJWkUpOwogCUJV
SUxEX0JVR19PTihPQV9CVUZGRVJfU0laRSA8IFNaXzEyOEsgfHwgT0FfQlVGRkVSX1NJWkUgPiBT
Wl8xNk0pOwogCiAJYm8gPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtKGRldl9wcml2LCBP
QV9CVUZGRVJfU0laRSk7Ci0JaWYgKElTX0VSUihibykpIHsKLQkJRFJNX0VSUk9SKCJGYWlsZWQg
dG8gYWxsb2NhdGUgT0EgYnVmZmVyXG4iKTsKLQkJcmV0ID0gUFRSX0VSUihibyk7Ci0JCWdvdG8g
dW5sb2NrOwotCX0KKwlpZiAoSVNfRVJSKGJvKSkKKwkJcmV0dXJuIFBUUl9FUlIoYm8pOwogCiAJ
aTkxNV9nZW1fb2JqZWN0X3NldF9jYWNoZV9jb2hlcmVuY3koYm8sIEk5MTVfQ0FDSEVfTExDKTsK
IApAQCAtMTUzOSw4ICsxNTI4LDcgQEAgc3RhdGljIGludCBhbGxvY19vYV9idWZmZXIoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCURSTV9ERUJVR19EUklWRVIoIk9BIEJ1ZmZl
ciBpbml0aWFsaXplZCwgZ3R0IG9mZnNldCA9IDB4JXgsIHZhZGRyID0gJXBcbiIsCiAJCQkgaTkx
NV9nZ3R0X29mZnNldChkZXZfcHJpdi0+cGVyZi5vYS5vYV9idWZmZXIudm1hKSwKIAkJCSBkZXZf
cHJpdi0+cGVyZi5vYS5vYV9idWZmZXIudmFkZHIpOwotCi0JZ290byB1bmxvY2s7CisJcmV0dXJu
IDA7CiAKIGVycl91bnBpbjoKIAlfX2k5MTVfdm1hX3VucGluKHZtYSk7CkBAIC0xNTUxLDggKzE1
MzksNiBAQCBzdGF0aWMgaW50IGFsbG9jX29hX2J1ZmZlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCiAJZGV2X3ByaXYtPnBlcmYub2Eub2FfYnVmZmVyLnZhZGRyID0gTlVMTDsK
IAlkZXZfcHJpdi0+cGVyZi5vYS5vYV9idWZmZXIudm1hID0gTlVMTDsKIAotdW5sb2NrOgotCW11
dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiByZXQ7CiB9
CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCmluZGV4IDg5MDc5NjMwZDBhZi4uNjhiNDVkM2JiYTli
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKQEAgLTMxNCw4ICszMTQsNiBAQCB2bWFfbG9va3Vw
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAgKiBPbmNlIGNyZWF0ZWQsIHRoZSBW
TUEgaXMga2VwdCB1bnRpbCBlaXRoZXIgdGhlIG9iamVjdCBpcyBmcmVlZCwgb3IgdGhlCiAgKiBh
ZGRyZXNzIHNwYWNlIGlzIGNsb3NlZC4KICAqCi0gKiBNdXN0IGJlIGNhbGxlZCB3aXRoIHN0cnVj
dF9tdXRleCBoZWxkLgotICoKICAqIFJldHVybnMgdGhlIHZtYSwgb3IgYW4gZXJyb3IgcG9pbnRl
ci4KICAqLwogc3RydWN0IGk5MTVfdm1hICoKQEAgLTQ0OCw3ICs0NDYsOCBAQCB2b2lkIF9faW9t
ZW0gKmk5MTVfdm1hX3Bpbl9pb21hcChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAkvKiBBY2Nlc3Mg
dGhyb3VnaCB0aGUgR1RUIHJlcXVpcmVzIHRoZSBkZXZpY2UgdG8gYmUgYXdha2UuICovCiAJYXNz
ZXJ0X3JwbV93YWtlbG9ja19oZWxkKHZtYS0+dm0tPmk5MTUpOwogCi0JbG9ja2RlcF9hc3NlcnRf
aGVsZCgmdm1hLT52bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfbG9jaygmdm1h
LT52bS0+bXV0ZXgpOworCiAJaWYgKFdBUk5fT04oIWk5MTVfdm1hX2lzX21hcF9hbmRfZmVuY2Vh
YmxlKHZtYSkpKSB7CiAJCWVyciA9IC1FTk9ERVY7CiAJCWdvdG8gZXJyOwpAQCAtNDcyLDE2ICs0
NzEsMTkgQEAgdm9pZCBfX2lvbWVtICppOTE1X3ZtYV9waW5faW9tYXAoc3RydWN0IGk5MTVfdm1h
ICp2bWEpCiAKIAlfX2k5MTVfdm1hX3Bpbih2bWEpOwogCi0JZXJyID0gaTkxNV92bWFfcGluX2Zl
bmNlKHZtYSk7CisJZXJyID0gX19pOTE1X3ZtYV9waW5fZmVuY2Uodm1hKTsKIAlpZiAoZXJyKQog
CQlnb3RvIGVycl91bnBpbjsKIAogCWk5MTVfdm1hX3NldF9nZ3R0X3dyaXRlKHZtYSk7CisJbXV0
ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CisKIAlyZXR1cm4gcHRyOwogCiBlcnJfdW5waW46
CiAJX19pOTE1X3ZtYV91bnBpbih2bWEpOwogZXJyOgorCW11dGV4X3VubG9jaygmdm1hLT52bS0+
bXV0ZXgpOwogCXJldHVybiBJT19FUlJfUFRSKGVycik7CiB9CiAKQEAgLTQ5Nyw4ICs0OTksNiBA
QCB2b2lkIGk5MTVfdm1hX2ZsdXNoX3dyaXRlcyhzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAogdm9p
ZCBpOTE1X3ZtYV91bnBpbl9pb21hcChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKLQlsb2NrZGVw
X2Fzc2VydF9oZWxkKCZ2bWEtPnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCUdFTV9C
VUdfT04odm1hLT5pb21hcCA9PSBOVUxMKTsKIAogCWk5MTVfdm1hX2ZsdXNoX3dyaXRlcyh2bWEp
OwpAQCAtNjgwLDEwICs2ODAsNyBAQCBpOTE1X3ZtYV9pbnNlcnQoc3RydWN0IGk5MTVfdm1hICp2
bWEsIHU2NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3MpCiAJfQogCiAJaWYgKHZtYS0+
b2JqKSB7Ci0JCXJldCA9IGk5MTVfZ2VtX29iamVjdF9waW5fcGFnZXNfYXN5bmModm1hLT5vYmop
OwotCQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsKLQorCQlfX2k5MTVfZ2VtX29iamVjdF9waW5f
cGFnZXModm1hLT5vYmopOwogCQljYWNoZV9sZXZlbCA9IHZtYS0+b2JqLT5jYWNoZV9sZXZlbDsK
IAl9IGVsc2UgewogCQljYWNoZV9sZXZlbCA9IDA7CkBAIC03NDgsOSArNzQ1LDcgQEAgaTkxNV92
bWFfaW5zZXJ0KHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1NjQgc2l6ZSwgdTY0IGFsaWdubWVudCwg
dTY0IGZsYWdzKQogCUdFTV9CVUdfT04oIWRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5ub2Rl
KSk7CiAJR0VNX0JVR19PTighaTkxNV9nZW1fdmFsaWRfZ3R0X3NwYWNlKHZtYSwgY2FjaGVfbGV2
ZWwpKTsKIAotCW11dGV4X2xvY2soJnZtYS0+dm0tPm11dGV4KTsKIAlsaXN0X2FkZF90YWlsKCZ2
bWEtPnZtX2xpbmssICZ2bWEtPnZtLT5ib3VuZF9saXN0KTsKLQltdXRleF91bmxvY2soJnZtYS0+
dm0tPm11dGV4KTsKIAogCWlmICh2bWEtPm9iaikgewogCQlhdG9taWNfaW5jKCZ2bWEtPm9iai0+
YmluZF9jb3VudCk7CkBAIC03NzMsMTAgKzc2OCw4IEBAIGk5MTVfdm1hX3JlbW92ZShzdHJ1Y3Qg
aTkxNV92bWEgKnZtYSkKIAogCXZtYS0+b3BzLT5jbGVhcl9wYWdlcyh2bWEpOwogCi0JbXV0ZXhf
bG9jaygmdm1hLT52bS0+bXV0ZXgpOwogCWRybV9tbV9yZW1vdmVfbm9kZSgmdm1hLT5ub2RlKTsK
IAlsaXN0X2RlbCgmdm1hLT52bV9saW5rKTsKLQltdXRleF91bmxvY2soJnZtYS0+dm0tPm11dGV4
KTsKIAogCS8qCiAJICogU2luY2UgdGhlIHVuYm91bmQgbGlzdCBpcyBnbG9iYWwsIG9ubHkgbW92
ZSB0byB0aGF0IGxpc3QgaWYKQEAgLTc5NywyNSArNzkwLDIwIEBAIGk5MTVfdm1hX3JlbW92ZShz
dHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAl9CiB9CiAKLWludCBfX2k5MTVfdm1hX2RvX3BpbihzdHJ1
Y3QgaTkxNV92bWEgKnZtYSwKLQkJICAgICAgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBm
bGFncykKK2ludCBfX2k5MTVfdm1hX2RvX3BpbihzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNp
emUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncykKIHsKIAljb25zdCB1bnNpZ25lZCBpbnQgYm91
bmQgPSB2bWEtPmZsYWdzOwogCWludCByZXQ7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bWEt
PnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlHRU1fQlVHX09OKChmbGFncyAmIChQSU5f
R0xPQkFMIHwgUElOX1VTRVIpKSA9PSAwKTsKLQlHRU1fQlVHX09OKChmbGFncyAmIFBJTl9HTE9C
QUwpICYmICFpOTE1X3ZtYV9pc19nZ3R0KHZtYSkpOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZt
YS0+dm0tPm11dGV4KTsKIAotCWlmIChXQVJOX09OKGJvdW5kICYgSTkxNV9WTUFfUElOX09WRVJG
TE9XKSkgewotCQlyZXQgPSAtRUJVU1k7Ci0JCWdvdG8gZXJyX3VucGluOwotCX0KKwlpZiAoYXRv
bWljX3JlYWQoJnZtYS0+cGluX2NvdW50KSkKKwkJZ290byBvdXQ7CiAKIAlpZiAoKGJvdW5kICYg
STkxNV9WTUFfQklORF9NQVNLKSA9PSAwKSB7CiAJCXJldCA9IGk5MTVfdm1hX2luc2VydCh2bWEs
IHNpemUsIGFsaWdubWVudCwgZmxhZ3MpOwogCQlpZiAocmV0KQotCQkJZ290byBlcnJfdW5waW47
CisJCQlyZXR1cm4gcmV0OwogCX0KIAlHRU1fQlVHX09OKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQo
JnZtYS0+bm9kZSkpOwogCkBAIC04MjksNiArODE3LDkgQEAgaW50IF9faTkxNV92bWFfZG9fcGlu
KHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCQlfX2k5MTVfdm1hX3NldF9tYXBfYW5kX2ZlbmNlYWJs
ZSh2bWEpOwogCiAJR0VNX0JVR19PTihpOTE1X3ZtYV9taXNwbGFjZWQodm1hLCBzaXplLCBhbGln
bm1lbnQsIGZsYWdzKSk7CisKK291dDoKKwlhdG9taWNfaW5jKCZ2bWEtPnBpbl9jb3VudCk7CiAJ
cmV0dXJuIDA7CiAKIGVycl9yZW1vdmU6CkBAIC04MzcsMTEgKzgyOCwzNCBAQCBpbnQgX19pOTE1
X3ZtYV9kb19waW4oc3RydWN0IGk5MTVfdm1hICp2bWEsCiAJCUdFTV9CVUdfT04odm1hLT5wYWdl
cyk7CiAJCUdFTV9CVUdfT04odm1hLT5mbGFncyAmIEk5MTVfVk1BX0JJTkRfTUFTSyk7CiAJfQot
ZXJyX3VucGluOgotCV9faTkxNV92bWFfdW5waW4odm1hKTsKIAlyZXR1cm4gcmV0OwogfQogCitp
bnQgaTkxNV92bWFfZG9fcGluKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1NjQgc2l6ZSwgdTY0IGFs
aWdubWVudCwgdTY0IGZsYWdzKQoreworCWludCBlcnI7CisKKwlHRU1fQlVHX09OKChmbGFncyAm
IChQSU5fR0xPQkFMIHwgUElOX1VTRVIpKSA9PSAwKTsKKwlHRU1fQlVHX09OKChmbGFncyAmIFBJ
Tl9HTE9CQUwpICYmICFpOTE1X3ZtYV9pc19nZ3R0KHZtYSkpOworCisJaWYgKHZtYS0+b2JqKSB7
CisJCWVyciA9IGk5MTVfZ2VtX29iamVjdF9waW5fcGFnZXNfYXN5bmModm1hLT5vYmopOworCQlp
ZiAoZXJyKQorCQkJcmV0dXJuIGVycjsKKwl9CisKKwllcnIgPSBtdXRleF9sb2NrX2ludGVycnVw
dGlibGUoJnZtYS0+dm0tPm11dGV4KTsKKwlpZiAoIWVycikgeworCQllcnIgPSBfX2k5MTVfdm1h
X2RvX3Bpbih2bWEsIHNpemUsIGFsaWdubWVudCwgZmxhZ3MpOworCQltdXRleF91bmxvY2soJnZt
YS0+dm0tPm11dGV4KTsKKwl9CisKKwlpZiAodm1hLT5vYmopCisJCWk5MTVfZ2VtX29iamVjdF91
bnBpbl9wYWdlcyh2bWEtPm9iaik7CisKKwlyZXR1cm4gZXJyOworfQorCiB2b2lkIGk5MTVfdm1h
X2Nsb3NlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gdm1hLT52bS0+aTkxNTsKQEAgLTkwNCw3ICs5MTgsNyBAQCBzdGF0aWMgdm9pZCBf
X2k5MTVfdm1hX2Rlc3Ryb3koc3RydWN0IGk5MTVfdm1hICp2bWEpCiAKIHZvaWQgaTkxNV92bWFf
ZGVzdHJveShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2
bWEtPnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2
bWEtPnZtLT5tdXRleCk7CiAKIAlHRU1fQlVHX09OKGk5MTVfdm1hX2lzX3Bpbm5lZCh2bWEpKTsK
IApAQCAtOTIyLDEwICs5MzYsMTQgQEAgdm9pZCBpOTE1X3ZtYV9wYXJrZWQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiAKIAlzcGluX2xvY2tfaXJxKCZpOTE1LT5ndC5jbG9zZWRfbG9j
ayk7CiAJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHZtYSwgbmV4dCwgJmk5MTUtPmd0LmNsb3Nl
ZF92bWEsIGNsb3NlZF9saW5rKSB7CisJCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0g
dm1hLT52bTsKKwogCQlsaXN0X2RlbF9pbml0KCZ2bWEtPmNsb3NlZF9saW5rKTsKIAkJc3Bpbl91
bmxvY2tfaXJxKCZpOTE1LT5ndC5jbG9zZWRfbG9jayk7CiAKKwkJbXV0ZXhfbG9jaygmdm0tPm11
dGV4KTsKIAkJaTkxNV92bWFfZGVzdHJveSh2bWEpOworCQltdXRleF91bmxvY2soJnZtLT5tdXRl
eCk7CiAKIAkJc3Bpbl9sb2NrX2lycSgmaTkxNS0+Z3QuY2xvc2VkX2xvY2spOwogCX0KQEAgLTk0
OCw3ICs5NjYsOCBAQCB2b2lkIGk5MTVfdm1hX3Jldm9rZV9tbWFwKHN0cnVjdCBpOTE1X3ZtYSAq
dm1hKQogCXN0cnVjdCBkcm1fdm1hX29mZnNldF9ub2RlICpub2RlID0gJnZtYS0+b2JqLT5iYXNl
LnZtYV9ub2RlOwogCXU2NCB2bWFfb2Zmc2V0OwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm1h
LT52bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm1h
LT52bS0+bXV0ZXgpOworCUdFTV9CVUdfT04oIWk5MTVfdm1hX2lzX2dndHQodm1hKSk7CiAKIAlp
ZiAoIWk5MTVfdm1hX2hhc191c2VyZmF1bHQodm1hKSkKIAkJcmV0dXJuOwpAQCAtMTAzMSw3ICsx
MDUwLDcgQEAgaW50IGk5MTVfdm1hX3VuYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKIAlp
bnQgcmV0OwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm1hLT52bS0+aTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm1hLT52bS0+bXV0ZXgpOwogCiAJaWYg
KHZtYS0+YXN5bmMuZG1hICYmCiAJICAgIGRtYV9mZW5jZV93YWl0X3RpbWVvdXQodm1hLT5hc3lu
Yy5kbWEsIHRydWUsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5o
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaAppbmRleCA2N2U0M2Y1ZDAxZjYuLjY3
NTQ3MmM0NGE0YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5oCkBAIC03MiwzOCArNzIsMTQgQEAg
c3RydWN0IGk5MTVfdm1hIHsKIAkgKiB0aGF0IGV4aXN0IGluIHRoZSBjdHgtPmhhbmRsZV92bWFz
IExVVCBmb3IgdGhpcyB2bWEuCiAJICovCiAJYXRvbWljX3Qgb3Blbl9jb3VudDsKKwlhdG9taWNf
dCBwaW5fY291bnQ7CiAJdW5zaWduZWQgbG9uZyBmbGFnczsKLQkvKioKLQkgKiBIb3cgbWFueSB1
c2VycyBoYXZlIHBpbm5lZCB0aGlzIG9iamVjdCBpbiBHVFQgc3BhY2UuCi0JICoKLQkgKiBUaGlz
IGlzIGEgdGlnaHRseSBib3VuZCwgZmFpcmx5IHNtYWxsIG51bWJlciBvZiB1c2Vycywgc28gd2UK
LQkgKiBzdHVmZiBpbnNpZGUgdGhlIGZsYWdzIGZpZWxkIHNvIHRoYXQgd2UgY2FuIGJvdGggY2hl
Y2sgZm9yIG92ZXJmbG93Ci0JICogYW5kIGRldGVjdCBhIG5vLW9wIGk5MTVfdm1hX3BpbigpIGlu
IGEgc2luZ2xlIGNoZWNrLCB3aGlsZSBhbHNvCi0JICogcGlubmluZyB0aGUgdm1hLgotCSAqCi0J
ICogVGhlIHdvcnN0IGNhc2UgZGlzcGxheSBzZXR1cCB3b3VsZCBoYXZlIHRoZSBzYW1lIHZtYSBw
aW5uZWQgZm9yCi0JICogdXNlIG9uIGVhY2ggcGxhbmUgb24gZWFjaCBjcnRjLCB3aGlsZSBhbHNv
IGJ1aWxkaW5nIHRoZSBuZXh0IGF0b21pYwotCSAqIHN0YXRlIGFuZCBob2xkaW5nIGEgcGluIGZv
ciB0aGUgbGVuZ3RoIG9mIHRoZSBjbGVhbnVwIHF1ZXVlLiBJbiB0aGUKLQkgKiBmdXR1cmUsIHRo
ZSBmbGlwIHF1ZXVlIG1heSBiZSBpbmNyZWFzZWQgZnJvbSAxLgotCSAqIEVzdGltYXRlZCB3b3Jz
dCBjYXNlOiAzIFtxbGVuXSAqIDQgW21heCBjcnRjc10gKiA3IFttYXggcGxhbmVzXSA9IDg0Ci0J
ICoKLQkgKiBGb3IgR0VNLCB0aGUgbnVtYmVyIG9mIGNvbmN1cnJlbnQgdXNlcnMgZm9yIHB3cml0
ZS9wcmVhZCBpcwotCSAqIHVuYm91bmRlZC4gRm9yIGV4ZWNidWZmZXIsIGl0IGlzIGN1cnJlbnRs
eSBvbmUgYnV0IHdpbGwgaW4gZnV0dXJlCi0JICogYmUgZXh0ZW5kZWQgdG8gYWxsb3cgbXVsdGlw
bGUgY2xpZW50cyB0byBwaW4gdm1hIGNvbmN1cnJlbnRseS4KLQkgKgotCSAqIFdlIGFsc28gdXNl
IHN1YmFsbG9jYXRlZCBwYWdlcywgd2l0aCBlYWNoIHN1YmFsbG9jYXRpb24gY2xhaW1pbmcKLQkg
KiBpdHMgb3duIHBpbiBvbiB0aGUgc2hhcmVkIHZtYS4gQXQgcHJlc2VudCwgdGhpcyBpcyBsaW1p
dGVkIHRvCi0JICogZXhjbHVzaXZlIGNhY2hlbGluZXMgb2YgYSBzaW5nbGUgcGFnZSwgc28gYSBt
YXhpbXVtIG9mIDY0IHBvc3NpYmxlCi0JICogdXNlcnMuCi0JICovCi0jZGVmaW5lIEk5MTVfVk1B
X1BJTl9NQVNLIDB4ZmYKLSNkZWZpbmUgSTkxNV9WTUFfUElOX09WRVJGTE9XCUJJVCg4KQogCiAJ
LyoqIEZsYWdzIGFuZCBhZGRyZXNzIHNwYWNlIHRoaXMgVk1BIGlzIGJvdW5kIHRvICovCiAjZGVm
aW5lIEk5MTVfVk1BX0dMT0JBTF9CSU5ECUJJVCg5KQogI2RlZmluZSBJOTE1X1ZNQV9MT0NBTF9C
SU5ECUJJVCgxMCkKLSNkZWZpbmUgSTkxNV9WTUFfQklORF9NQVNLIChJOTE1X1ZNQV9HTE9CQUxf
QklORCB8IEk5MTVfVk1BX0xPQ0FMX0JJTkQgfCBJOTE1X1ZNQV9QSU5fT1ZFUkZMT1cpCi0jZGVm
aW5lIEk5MTVfVk1BX0FMTE9DX0JJTkQJSTkxNV9WTUFfUElOX09WRVJGTE9XIC8qIG5vdCBzdG9y
ZWQgKi8KKyNkZWZpbmUgSTkxNV9WTUFfQklORF9NQVNLCShJOTE1X1ZNQV9HTE9CQUxfQklORCB8
IEk5MTVfVk1BX0xPQ0FMX0JJTkQpCisjZGVmaW5lIEk5MTVfVk1BX0FMTE9DX0JJTkQJQklUKDAp
IC8qIG5vdCBzdG9yZWQgKi8KIAogI2RlZmluZSBJOTE1X1ZNQV9HR1RUCQlCSVQoMTEpCiAjZGVm
aW5lIEk5MTVfVk1BX0NBTl9GRU5DRQlCSVQoMTIpCkBAIC0zMjQsMzAgKzMwMCwyNyBAQCBzdGF0
aWMgaW5saW5lIHZvaWQgaTkxNV92bWFfdW5sb2NrKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCXJl
c2VydmF0aW9uX29iamVjdF91bmxvY2sodm1hLT5yZXN2KTsKIH0KIAotaW50IF9faTkxNV92bWFf
ZG9fcGluKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAotCQkgICAgICB1NjQgc2l6ZSwgdTY0IGFsaWdu
bWVudCwgdTY0IGZsYWdzKTsKK2ludCBfX2k5MTVfdm1hX2RvX3BpbihzdHJ1Y3QgaTkxNV92bWEg
KnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncyk7CitpbnQgaTkxNV92bWFf
ZG9fcGluKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1NjQgc2l6ZSwgdTY0IGFsaWdubWVudCwgdTY0
IGZsYWdzKTsKKwogc3RhdGljIGlubGluZSBpbnQgX19tdXN0X2NoZWNrCiBpOTE1X3ZtYV9waW4o
c3RydWN0IGk5MTVfdm1hICp2bWEsIHU2NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3Mp
CiB7Ci0JQlVJTERfQlVHX09OKFBJTl9NQlogIT0gSTkxNV9WTUFfUElOX09WRVJGTE9XKTsKIAlC
VUlMRF9CVUdfT04oUElOX0dMT0JBTCAhPSBJOTE1X1ZNQV9HTE9CQUxfQklORCk7CiAJQlVJTERf
QlVHX09OKFBJTl9VU0VSICE9IEk5MTVfVk1BX0xPQ0FMX0JJTkQpOwogCi0JLyogUGluIGVhcmx5
IHRvIHByZXZlbnQgdGhlIHNocmlua2VyL2V2aWN0aW9uIGxvZ2ljIGZyb20gZGVzdHJveWluZwot
CSAqIG91ciB2bWEgYXMgd2UgaW5zZXJ0IGFuZCBiaW5kLgotCSAqLwotCWlmIChsaWtlbHkoKCgr
K3ZtYS0+ZmxhZ3MgXiBmbGFncykgJiBJOTE1X1ZNQV9CSU5EX01BU0spID09IDApKSB7CisJaWYg
KGF0b21pY19hZGRfdW5sZXNzKCZ2bWEtPnBpbl9jb3VudCwgMSwgMCkpIHsKIAkJR0VNX0JVR19P
TighZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKTsKIAkJR0VNX0JVR19PTihpOTE1
X3ZtYV9taXNwbGFjZWQodm1hLCBzaXplLCBhbGlnbm1lbnQsIGZsYWdzKSk7CiAJCXJldHVybiAw
OwogCX0KIAotCXJldHVybiBfX2k5MTVfdm1hX2RvX3Bpbih2bWEsIHNpemUsIGFsaWdubWVudCwg
ZmxhZ3MpOworCXJldHVybiBpOTE1X3ZtYV9kb19waW4odm1hLCBzaXplLCBhbGlnbm1lbnQsIGZs
YWdzKTsKIH0KIAogc3RhdGljIGlubGluZSBpbnQgaTkxNV92bWFfcGluX2NvdW50KGNvbnN0IHN0
cnVjdCBpOTE1X3ZtYSAqdm1hKQogewotCXJldHVybiB2bWEtPmZsYWdzICYgSTkxNV9WTUFfUElO
X01BU0s7CisJcmV0dXJuIGF0b21pY19yZWFkKCZ2bWEtPnBpbl9jb3VudCk7CiB9CiAKIHN0YXRp
YyBpbmxpbmUgYm9vbCBpOTE1X3ZtYV9pc19waW5uZWQoY29uc3Qgc3RydWN0IGk5MTVfdm1hICp2
bWEpCkBAIC0zNTcsMTkgKzMzMCwxOCBAQCBzdGF0aWMgaW5saW5lIGJvb2wgaTkxNV92bWFfaXNf
cGlubmVkKGNvbnN0IHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCiBzdGF0aWMgaW5saW5lIHZvaWQg
X19pOTE1X3ZtYV9waW4oc3RydWN0IGk5MTVfdm1hICp2bWEpCiB7Ci0Jdm1hLT5mbGFncysrOwot
CUdFTV9CVUdfT04odm1hLT5mbGFncyAmIEk5MTVfVk1BX1BJTl9PVkVSRkxPVyk7CisJYXRvbWlj
X2luYygmdm1hLT5waW5fY291bnQpOwogfQogCiBzdGF0aWMgaW5saW5lIHZvaWQgX19pOTE1X3Zt
YV91bnBpbihzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKLQl2bWEtPmZsYWdzLS07CisJYXRvbWlj
X2RlYygmdm1hLT5waW5fY291bnQpOwogfQogCiBzdGF0aWMgaW5saW5lIHZvaWQgaTkxNV92bWFf
dW5waW4oc3RydWN0IGk5MTVfdm1hICp2bWEpCiB7Ci0JR0VNX0JVR19PTighaTkxNV92bWFfaXNf
cGlubmVkKHZtYSkpOwogCUdFTV9CVUdfT04oIWRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5u
b2RlKSk7CisJR0VNX0JVR19PTighYXRvbWljX3JlYWQoJnZtYS0+cGluX2NvdW50KSk7CiAJX19p
OTE1X3ZtYV91bnBpbih2bWEpOwogfQogCkBAIC0zODgsOCArMzYwLDYgQEAgc3RhdGljIGlubGlu
ZSBib29sIGk5MTVfdm1hX2lzX2JvdW5kKGNvbnN0IHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogICog
dGhlIGNhbGxlciBtdXN0IGNhbGwgaTkxNV92bWFfdW5waW5faW9tYXAgdG8gcmVsaW5xdWlzaCB0
aGUgcGlubmluZwogICogYWZ0ZXIgdGhlIGlvbWFwcGluZyBpcyBubyBsb25nZXIgcmVxdWlyZWQu
CiAgKgotICogQ2FsbGVycyBtdXN0IGhvbGQgdGhlIHN0cnVjdF9tdXRleC4KLSAqCiAgKiBSZXR1
cm5zIGEgdmFsaWQgaW9tYXBwZWQgcG9pbnRlciBvciBFUlJfUFRSLgogICovCiB2b2lkIF9faW9t
ZW0gKmk5MTVfdm1hX3Bpbl9pb21hcChzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7CkBAIC00MDEsOCAr
MzcxLDggQEAgdm9pZCBfX2lvbWVtICppOTE1X3ZtYV9waW5faW9tYXAoc3RydWN0IGk5MTVfdm1h
ICp2bWEpOwogICoKICAqIFVucGlucyB0aGUgcHJldmlvdXNseSBpb21hcHBlZCBWTUEgZnJvbSBp
OTE1X3ZtYV9waW5faW9tYXAoKS4KICAqCi0gKiBDYWxsZXJzIG11c3QgaG9sZCB0aGUgc3RydWN0
X211dGV4LiBUaGlzIGZ1bmN0aW9uIGlzIG9ubHkgdmFsaWQgdG8gYmUKLSAqIGNhbGxlZCBvbiBh
IFZNQSBwcmV2aW91c2x5IGlvbWFwcGVkIGJ5IHRoZSBjYWxsZXIgd2l0aCBpOTE1X3ZtYV9waW5f
aW9tYXAoKS4KKyAqIFRoaXMgZnVuY3Rpb24gaXMgb25seSB2YWxpZCB0byBiZSBjYWxsZWQgb24g
YSBWTUEgcHJldmlvdXNseSBpb21hcHBlZAorICogYnkgdGhlIGNhbGxlciB3aXRoIGk5MTVfdm1h
X3Bpbl9pb21hcCgpLgogICovCiB2b2lkIGk5MTVfdm1hX3VucGluX2lvbWFwKHN0cnVjdCBpOTE1
X3ZtYSAqdm1hKTsKIApAQCAtNDEyLDYgKzM4Miw4IEBAIHN0YXRpYyBpbmxpbmUgc3RydWN0IHBh
Z2UgKmk5MTVfdm1hX2ZpcnN0X3BhZ2Uoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJcmV0dXJuIHNn
X3BhZ2Uodm1hLT5wYWdlcy0+c2dsKTsKIH0KIAoraW50IF9faTkxNV92bWFfcGluX2ZlbmNlKHN0
cnVjdCBpOTE1X3ZtYSAqdm1hKTsKKwogLyoqCiAgKiBpOTE1X3ZtYV9waW5fZmVuY2UgLSBwaW4g
ZmVuY2luZyBzdGF0ZQogICogQHZtYTogdm1hIHRvIHBpbiBmZW5jaW5nIGZvcgpAQCAtNDQ3LDcg
KzQxOSw2IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBfX2k5MTVfdm1hX3VucGluX2ZlbmNlKHN0cnVj
dCBpOTE1X3ZtYSAqdm1hKQogc3RhdGljIGlubGluZSB2b2lkCiBpOTE1X3ZtYV91bnBpbl9mZW5j
ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKLQkvKiBsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bWEt
PnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsgKi8KIAlpZiAodm1hLT5mZW5jZSkKIAkJX19p
OTE1X3ZtYV91bnBpbl9mZW5jZSh2bWEpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZGlzcGxh
eS5jCmluZGV4IDNhMzI5ODgxMmFkOC4uYWE5NGY0NDk5ZGZlIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aW50ZWxfZGlzcGxheS5jCkBAIC0yMDkzLDggKzIwOTMsNiBAQCBpbnRlbF9waW5fYW5kX2ZlbmNl
X2ZiX29iaihzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKIAl1bnNpZ25lZCBpbnQgcGluY3Rs
OwogCXUzMiBhbGlnbm1lbnQ7CiAKLQlXQVJOX09OKCFtdXRleF9pc19sb2NrZWQoJmRldi0+c3Ry
dWN0X211dGV4KSk7Ci0KIAlhbGlnbm1lbnQgPSBpbnRlbF9zdXJmX2FsaWdubWVudChmYiwgMCk7
CiAKIAkvKiBOb3RlIHRoYXQgdGhlIHcvYSBhbHNvIHJlcXVpcmVzIDY0IFBURSBvZiBwYWRkaW5n
IGZvbGxvd2luZyB0aGUKQEAgLTIxNzUsMTMgKzIxNzMsOSBAQCBpbnRlbF9waW5fYW5kX2ZlbmNl
X2ZiX29iaihzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKIAogdm9pZCBpbnRlbF91bnBpbl9m
Yl92bWEoc3RydWN0IGk5MTVfdm1hICp2bWEsIHVuc2lnbmVkIGxvbmcgZmxhZ3MpCiB7Ci0JbG9j
a2RlcF9hc3NlcnRfaGVsZCgmdm1hLT52bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQlp
OTE1X2dlbV9vYmplY3RfbG9jayh2bWEtPm9iaik7CiAJaWYgKGZsYWdzICYgUExBTkVfSEFTX0ZF
TkNFKQogCQlpOTE1X3ZtYV91bnBpbl9mZW5jZSh2bWEpOwogCWk5MTVfZ2VtX29iamVjdF91bnBp
bl9mcm9tX2Rpc3BsYXlfcGxhbmUodm1hKTsKLQlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKHZtYS0+
b2JqKTsKIAogCWk5MTVfdm1hX3B1dCh2bWEpOwogfQpAQCAtMzA3NywxMiArMzA3MSwxMCBAQCBp
bnRlbF9hbGxvY19pbml0aWFsX3BsYW5lX29iaihzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJ
cmV0dXJuIGZhbHNlOwogCX0KIAotCW11dGV4X2xvY2soJmRldi0+c3RydWN0X211dGV4KTsKIAlv
YmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3N0b2xlbl9mb3JfcHJlYWxsb2NhdGVkKGRldl9w
cml2LAogCQkJCQkJCSAgICAgYmFzZV9hbGlnbmVkLAogCQkJCQkJCSAgICAgYmFzZV9hbGlnbmVk
LAogCQkJCQkJCSAgICAgc2l6ZV9hbGlnbmVkKTsKLQltdXRleF91bmxvY2soJmRldi0+c3RydWN0
X211dGV4KTsKIAlpZiAoIW9iaikKIAkJcmV0dXJuIGZhbHNlOwogCkBAIC0zMjQ0LDEzICszMjM2
LDExIEBAIGludGVsX2ZpbmRfaW5pdGlhbF9wbGFuZV9vYmooc3RydWN0IGludGVsX2NydGMgKmlu
dGVsX2NydGMsCiAJaW50ZWxfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLnN0cmlkZSA9CiAJCWludGVs
X2ZiX3BpdGNoKGZiLCAwLCBpbnRlbF9zdGF0ZS0+YmFzZS5yb3RhdGlvbik7CiAKLQltdXRleF9s
b2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CiAJaW50ZWxfc3RhdGUtPnZtYSA9CiAJCWludGVsX3Bp
bl9hbmRfZmVuY2VfZmJfb2JqKGZiLAogCQkJCQkgICAmaW50ZWxfc3RhdGUtPnZpZXcsCiAJCQkJ
CSAgIGludGVsX3BsYW5lX3VzZXNfZmVuY2UoaW50ZWxfc3RhdGUpLAogCQkJCQkgICAmaW50ZWxf
c3RhdGUtPmZsYWdzKTsKLQltdXRleF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKIAlpZiAo
SVNfRVJSKGludGVsX3N0YXRlLT52bWEpKSB7CiAJCURSTV9FUlJPUigiZmFpbGVkIHRvIHBpbiBi
b290IGZiIG9uIHBpcGUgJWQ6ICVsaVxuIiwKIAkJCSAgaW50ZWxfY3J0Yy0+cGlwZSwgUFRSX0VS
UihpbnRlbF9zdGF0ZS0+dm1hKSk7CkBAIC0xNDE1Miw4ICsxNDE0Miw2IEBAIHN0YXRpYyB2b2lk
IGZiX29ial9idW1wX3JlbmRlcl9wcmlvcml0eShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqKQogICogYml0cy4gIFNvbWUgb2xkZXIgcGxhdGZvcm1zIG5lZWQgc3BlY2lhbCBwaHlzaWNh
bCBhZGRyZXNzIGhhbmRsaW5nIGZvcgogICogY3Vyc29yIHBsYW5lcy4KICAqCi0gKiBNdXN0IGJl
IGNhbGxlZCB3aXRoIHN0cnVjdF9tdXRleCBoZWxkLgotICoKICAqIFJldHVybnMgMCBvbiBzdWNj
ZXNzLCBuZWdhdGl2ZSBlcnJvciBjb2RlIG9uIGZhaWx1cmUuCiAgKi8KIGludApAQCAtMTQyMTAs
MTUgKzE0MTk4LDggQEAgaW50ZWxfcHJlcGFyZV9wbGFuZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpw
bGFuZSwKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRl
cnJ1cHRpYmxlKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKHJldCkgewotCQlp
OTE1X2dlbV9vYmplY3RfdW5waW5fcGFnZXMob2JqKTsKLQkJcmV0dXJuIHJldDsKLQl9Ci0KIAly
ZXQgPSBpbnRlbF9wbGFuZV9waW5fZmIodG9faW50ZWxfcGxhbmVfc3RhdGUobmV3X3N0YXRlKSk7
CiAKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIAlpOTE1X2dl
bV9vYmplY3RfdW5waW5fcGFnZXMob2JqKTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwpAQCAt
MTQyNjcsOCArMTQyNDgsNiBAQCBpbnRlbF9wcmVwYXJlX3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxh
bmUgKnBsYW5lLAogICogQG9sZF9zdGF0ZTogdGhlIHN0YXRlIGZyb20gdGhlIHByZXZpb3VzIG1v
ZGVzZXQKICAqCiAgKiBDbGVhbnMgdXAgYSBmcmFtZWJ1ZmZlciB0aGF0IGhhcyBqdXN0IGJlZW4g
cmVtb3ZlZCBmcm9tIGEgcGxhbmUuCi0gKgotICogTXVzdCBiZSBjYWxsZWQgd2l0aCBzdHJ1Y3Rf
bXV0ZXggaGVsZC4KICAqLwogdm9pZAogaW50ZWxfY2xlYW51cF9wbGFuZV9mYihzdHJ1Y3QgZHJt
X3BsYW5lICpwbGFuZSwKQEAgLTE0Mjg0LDkgKzE0MjYzLDcgQEAgaW50ZWxfY2xlYW51cF9wbGFu
ZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAl9CiAKIAkvKiBTaG91bGQgb25seSBiZSBj
YWxsZWQgYWZ0ZXIgYSBzdWNjZXNzZnVsIGludGVsX3ByZXBhcmVfcGxhbmVfZmIoKSEgKi8KLQlt
dXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaW50ZWxfcGxhbmVfdW5w
aW5fZmIodG9faW50ZWxfcGxhbmVfc3RhdGUob2xkX3N0YXRlKSk7Ci0JbXV0ZXhfdW5sb2NrKCZk
ZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiB9CiAKIGludApAQCAtMTQ0OTAsNyArMTQ0Njcs
NiBAQCBpbnRlbF9sZWdhY3lfY3Vyc29yX3VwZGF0ZShzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwK
IAkJCSAgIHUzMiBzcmNfdywgdTMyIHNyY19oLAogCQkJICAgc3RydWN0IGRybV9tb2Rlc2V0X2Fj
cXVpcmVfY3R4ICpjdHgpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShjcnRjLT5kZXYpOwogCXN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKm9sZF9wbGFuZV9z
dGF0ZSwgKm5ld19wbGFuZV9zdGF0ZTsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKmludGVsX3BsYW5l
ID0gdG9faW50ZWxfcGxhbmUocGxhbmUpOwogCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlID0KQEAgLTE0NTU2LDEzICsxNDUzMiw5IEBAIGludGVsX2xlZ2FjeV9jdXJzb3JfdXBk
YXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCWlmIChyZXQpCiAJCWdvdG8gb3V0X2ZyZWU7
CiAKLQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmRldl9wcml2LT5kcm0uc3RydWN0
X211dGV4KTsKLQlpZiAocmV0KQotCQlnb3RvIG91dF9mcmVlOwotCiAJcmV0ID0gaW50ZWxfcGxh
bmVfcGluX2ZiKHRvX2ludGVsX3BsYW5lX3N0YXRlKG5ld19wbGFuZV9zdGF0ZSkpOwogCWlmIChy
ZXQpCi0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290byBvdXRfZnJlZTsKIAogCWludGVsX2Zyb250
YnVmZmVyX2ZsdXNoKHRvX2ludGVsX2Zyb250YnVmZmVyKGZiKSwgT1JJR0lOX0ZMSVApOwogCWlu
dGVsX2Zyb250YnVmZmVyX3RyYWNrKHRvX2ludGVsX2Zyb250YnVmZmVyKG9sZF9wbGFuZV9zdGF0
ZS0+ZmIpLApAQCAtMTQ1OTIsOCArMTQ1NjQsNiBAQCBpbnRlbF9sZWdhY3lfY3Vyc29yX3VwZGF0
ZShzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAogCWludGVsX3BsYW5lX3VucGluX2ZiKHRvX2lu
dGVsX3BsYW5lX3N0YXRlKG9sZF9wbGFuZV9zdGF0ZSkpOwogCi1vdXRfdW5sb2NrOgotCW11dGV4
X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogb3V0X2ZyZWU6CiAJaWYgKG5l
d19jcnRjX3N0YXRlKQogCQlpbnRlbF9jcnRjX2Rlc3Ryb3lfc3RhdGUoY3J0YywgJm5ld19jcnRj
X3N0YXRlLT5iYXNlKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Zi
ZGV2LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9mYmRldi5jCmluZGV4IGM3YzExZDE4
NDJhZi4uMTQ2NDE1N2QwZmZlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF9mYmRldi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2ZiZGV2LmMKQEAgLTIx
Miw3ICsyMTIsNiBAQCBzdGF0aWMgaW50IGludGVsZmJfY3JlYXRlKHN0cnVjdCBkcm1fZmJfaGVs
cGVyICpoZWxwZXIsCiAJCXNpemVzLT5mYl9oZWlnaHQgPSBpbnRlbF9mYi0+YmFzZS5oZWlnaHQ7
CiAJfQogCi0JbXV0ZXhfbG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogCXdha2VyZWYgPSBpbnRl
bF9ydW50aW1lX3BtX2dldChkZXZfcHJpdik7CiAKIAkvKiBQaW4gdGhlIEdHVFQgdm1hIGZvciBv
dXIgYWNjZXNzIHZpYSBpbmZvLT5zY3JlZW5fYmFzZS4KQEAgLTI3Myw3ICsyNzIsNiBAQCBzdGF0
aWMgaW50IGludGVsZmJfY3JlYXRlKHN0cnVjdCBkcm1fZmJfaGVscGVyICpoZWxwZXIsCiAJaWZi
ZGV2LT52bWFfZmxhZ3MgPSBmbGFnczsKIAogCWludGVsX3J1bnRpbWVfcG1fcHV0KGRldl9wcml2
LCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKIAl2Z2Ffc3dp
dGNoZXJvb19jbGllbnRfZmJfc2V0KHBkZXYsIGluZm8pOwogCXJldHVybiAwOwogCkBAIC0yODEs
NyArMjc5LDYgQEAgc3RhdGljIGludCBpbnRlbGZiX2NyZWF0ZShzdHJ1Y3QgZHJtX2ZiX2hlbHBl
ciAqaGVscGVyLAogCWludGVsX3VucGluX2ZiX3ZtYSh2bWEsIGZsYWdzKTsKIG91dF91bmxvY2s6
CiAJaW50ZWxfcnVudGltZV9wbV9wdXQoZGV2X3ByaXYsIHdha2VyZWYpOwotCW11dGV4X3VubG9j
aygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiByZXQ7CiB9CiAKQEAgLTI5OCwxMSArMjk1
LDggQEAgc3RhdGljIHZvaWQgaW50ZWxfZmJkZXZfZGVzdHJveShzdHJ1Y3QgaW50ZWxfZmJkZXYg
KmlmYmRldikKIAogCWRybV9mYl9oZWxwZXJfZmluaSgmaWZiZGV2LT5oZWxwZXIpOwogCi0JaWYg
KGlmYmRldi0+dm1hKSB7Ci0JCW11dGV4X2xvY2soJmlmYmRldi0+aGVscGVyLmRldi0+c3RydWN0
X211dGV4KTsKKwlpZiAoaWZiZGV2LT52bWEpCiAJCWludGVsX3VucGluX2ZiX3ZtYShpZmJkZXYt
PnZtYSwgaWZiZGV2LT52bWFfZmxhZ3MpOwotCQltdXRleF91bmxvY2soJmlmYmRldi0+aGVscGVy
LmRldi0+c3RydWN0X211dGV4KTsKLQl9CiAKIAlpZiAoaWZiZGV2LT5mYikKIAkJZHJtX2ZyYW1l
YnVmZmVyX3JlbW92ZSgmaWZiZGV2LT5mYi0+YmFzZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9ndWMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5j
CmluZGV4IDQzMjMyMjQyZDE2Ny4uNGEwZTc2OTEwOTBmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9ndWMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9n
dWMuYwpAQCAtNjczLDYgKzY3Myw3IEBAIHN0cnVjdCBpOTE1X3ZtYSAqaW50ZWxfZ3VjX2FsbG9j
YXRlX3ZtYShzdHJ1Y3QgaW50ZWxfZ3VjICpndWMsIHUzMiBzaXplKQogCQlnb3RvIGVycjsKIAog
CWZsYWdzID0gUElOX0dMT0JBTCB8IFBJTl9PRkZTRVRfQklBUyB8IGk5MTVfZ2d0dF9waW5fYmlh
cyh2bWEpOworCiAJcmV0ID0gaTkxNV92bWFfcGluKHZtYSwgMCwgMCwgZmxhZ3MpOwogCWlmIChy
ZXQpIHsKIAkJdm1hID0gRVJSX1BUUihyZXQpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaW50ZWxfb3ZlcmxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfb3Zlcmxh
eS5jCmluZGV4IGRjN2I2NmM5NGY3NC4uY2VjNzY1Y2EzNjE0IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pbnRlbF9vdmVybGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aW50ZWxfb3ZlcmxheS5jCkBAIC03NTIsNyArNzUyLDYgQEAgc3RhdGljIGludCBpbnRlbF9vdmVy
bGF5X2RvX3B1dF9pbWFnZShzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3ZlcmxheSwKIAlzdHJ1Y3Qg
aTkxNV92bWEgKnZtYTsKIAlpbnQgcmV0LCB0bXBfd2lkdGg7CiAKLQlsb2NrZGVwX2Fzc2VydF9o
ZWxkKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJV0FSTl9PTighZHJtX21vZGVzZXRf
aXNfbG9ja2VkKCZkZXZfcHJpdi0+ZHJtLm1vZGVfY29uZmlnLmNvbm5lY3Rpb25fbXV0ZXgpKTsK
IAogCXJldCA9IGludGVsX292ZXJsYXlfcmVsZWFzZV9vbGRfdmlkKG92ZXJsYXkpOwpAQCAtMTMw
OCwxNSArMTMwNywxMSBAQCBzdGF0aWMgaW50IGdldF9yZWdpc3RlcnMoc3RydWN0IGludGVsX292
ZXJsYXkgKm92ZXJsYXksIGJvb2wgdXNlX3BoeXMpCiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJ
aW50IGVycjsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJb2Jq
ID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zdG9sZW4oaTkxNSwgUEFHRV9TSVpFKTsKIAlpZiAo
b2JqID09IE5VTEwpCiAJCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoaTkx
NSwgUEFHRV9TSVpFKTsKLQlpZiAoSVNfRVJSKG9iaikpIHsKLQkJZXJyID0gUFRSX0VSUihvYmop
OwotCQlnb3RvIGVycl91bmxvY2s7Ci0JfQorCWlmIChJU19FUlIob2JqKSkKKwkJcmV0dXJuIFBU
Ul9FUlIob2JqKTsKIAogCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihvYmosIE5VTEws
IDAsIDAsIFBJTl9NQVBQQUJMRSk7CiAJaWYgKElTX0VSUih2bWEpKSB7CkBAIC0xMzM3LDEzICsx
MzMyLDEwIEBAIHN0YXRpYyBpbnQgZ2V0X3JlZ2lzdGVycyhzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAq
b3ZlcmxheSwgYm9vbCB1c2VfcGh5cykKIAl9CiAKIAlvdmVybGF5LT5yZWdfYm8gPSBvYmo7Ci0J
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4gMDsKIAogZXJy
X3B1dF9ibzoKIAlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7Ci1lcnJfdW5sb2NrOgotCW11dGV4
X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIApkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfdm1hLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYwppbmRleCA2MTVhYzQ4NWM3MzEu
LmVlYjA0NTBjM2Y4NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3Rz
L2k5MTVfdm1hLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfdm1h
LmMKQEAgLTMzNyw3ICszMzcsOSBAQCBzdGF0aWMgaW50IGlndF92bWFfcGluMSh2b2lkICphcmcp
CiAKIAkJaWYgKCFlcnIpIHsKIAkJCWk5MTVfdm1hX3VucGluKHZtYSk7CisJCQltdXRleF9sb2Nr
KCZnZ3R0LT52bS5tdXRleCk7CiAJCQllcnIgPSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJCW11
dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQkJaWYgKGVycikgewogCQkJCXByX2Vycigi
RmFpbGVkIHRvIHVuYmluZCBzaW5nbGUgcGFnZSBmcm9tIEdHVFQsIGVycj0lZFxuIiwgZXJyKTsK
IAkJCQlnb3RvIG91dDsKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlz
dGluZm8vaW50ZWwtZ2Z4

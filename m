Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E99EEB9766
	for <lists+intel-gfx@lfdr.de>; Fri, 20 Sep 2019 20:54:02 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 457C16FD97;
	Fri, 20 Sep 2019 18:54:01 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga03.intel.com (mga03.intel.com [134.134.136.65])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 353806FD97
 for <intel-gfx@lists.freedesktop.org>; Fri, 20 Sep 2019 18:54:00 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga001.fm.intel.com ([10.253.24.23])
 by orsmga103.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 20 Sep 2019 11:54:00 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,529,1559545200"; d="scan'208";a="202554690"
Received: from ericferx-mobl1.ger.corp.intel.com (HELO localhost)
 ([10.249.39.24])
 by fmsmga001.fm.intel.com with ESMTP; 20 Sep 2019 11:53:57 -0700
From: Jani Nikula <jani.nikula@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 20 Sep 2019 21:53:43 +0300
Message-Id: <20190920185347.17760-2-jani.nikula@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190920185347.17760-1-jani.nikula@intel.com>
References: <20190920185347.17760-1-jani.nikula@intel.com>
MIME-Version: 1.0
Organization: Intel Finland Oy - BIC 0357606-4 - Westendinkatu 7, 02160 Espoo
Subject: [Intel-gfx] [PATCH v2 2/6] drm/i915: pass i915 to
 i915_driver_modeset_probe()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com, chris@freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SW4gZ2VuZXJhbCwgcHJlZmVyIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICogb3ZlciBzdHJ1Y3Qg
ZHJtX2RldmljZSAqCndoZW4gZWl0aGVyIHdpbGwgZG8uIFJlbmFtZSB0aGUgbG9jYWwgdmFyaWFi
bGUgdG8gaTkxNS4gTm8gZnVuY3Rpb25hbApjaGFuZ2VzLgoKUmV2aWV3ZWQtYnk6IENocmlzIFdp
bHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpTaWduZWQtb2ZmLWJ5OiBKYW5pIE5pa3Vs
YSA8amFuaS5uaWt1bGFAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZHJ2LmMgfCA1OSArKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFu
Z2VkLCAyOSBpbnNlcnRpb25zKCspLCAzMCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9k
cnYuYwppbmRleCA0Y2I5NWZkOWIzNWQuLjNlNGVhNWQ2ZmNjMiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2Rydi5jCkBAIC0zMjksMjMgKzMyOSwyMiBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IHZnYV9zd2l0
Y2hlcm9vX2NsaWVudF9vcHMgaTkxNV9zd2l0Y2hlcm9vX29wcyA9IHsKIAkuY2FuX3N3aXRjaCA9
IGk5MTVfc3dpdGNoZXJvb19jYW5fc3dpdGNoLAogfTsKIAotc3RhdGljIGludCBpOTE1X2RyaXZl
cl9tb2Rlc2V0X3Byb2JlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCitzdGF0aWMgaW50IGk5MTVf
ZHJpdmVyX21vZGVzZXRfcHJvYmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwotCXN0cnVj
dCBwY2lfZGV2ICpwZGV2ID0gZGV2X3ByaXYtPmRybS5wZGV2OworCXN0cnVjdCBwY2lfZGV2ICpw
ZGV2ID0gaTkxNS0+ZHJtLnBkZXY7CiAJaW50IHJldDsKIAotCWlmIChpOTE1X2luamVjdF9wcm9i
ZV9mYWlsdXJlKGRldl9wcml2KSkKKwlpZiAoaTkxNV9pbmplY3RfcHJvYmVfZmFpbHVyZShpOTE1
KSkKIAkJcmV0dXJuIC1FTk9ERVY7CiAKLQlpZiAoSEFTX0RJU1BMQVkoZGV2X3ByaXYpICYmIElO
VEVMX0RJU1BMQVlfRU5BQkxFRChkZXZfcHJpdikpIHsKLQkJcmV0ID0gZHJtX3ZibGFua19pbml0
KCZkZXZfcHJpdi0+ZHJtLAotCQkJCSAgICAgIElOVEVMX05VTV9QSVBFUyhkZXZfcHJpdikpOwor
CWlmIChIQVNfRElTUExBWShpOTE1KSAmJiBJTlRFTF9ESVNQTEFZX0VOQUJMRUQoaTkxNSkpIHsK
KwkJcmV0ID0gZHJtX3ZibGFua19pbml0KCZpOTE1LT5kcm0sCisJCQkJICAgICAgSU5URUxfTlVN
X1BJUEVTKGk5MTUpKTsKIAkJaWYgKHJldCkKIAkJCWdvdG8gb3V0OwogCX0KIAotCWludGVsX2Jp
b3NfaW5pdChkZXZfcHJpdik7CisJaW50ZWxfYmlvc19pbml0KGk5MTUpOwogCiAJLyogSWYgd2Ug
aGF2ZSA+IDEgVkdBIGNhcmRzLCB0aGVuIHdlIG5lZWQgdG8gYXJiaXRyYXRlIGFjY2VzcwogCSAq
IHRvIHRoZSBjb21tb24gVkdBIHJlc291cmNlcy4KQEAgLTM1NCw3ICszNTMsNyBAQCBzdGF0aWMg
aW50IGk5MTVfZHJpdmVyX21vZGVzZXRfcHJvYmUoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAkg
KiB0aGVuIHdlIGRvIG5vdCB0YWtlIHBhcnQgaW4gVkdBIGFyYml0cmF0aW9uIGFuZCB0aGUKIAkg
KiB2Z2FfY2xpZW50X3JlZ2lzdGVyKCkgZmFpbHMgd2l0aCAtRU5PREVWLgogCSAqLwotCXJldCA9
IHZnYV9jbGllbnRfcmVnaXN0ZXIocGRldiwgZGV2X3ByaXYsIE5VTEwsIGk5MTVfdmdhX3NldF9k
ZWNvZGUpOworCXJldCA9IHZnYV9jbGllbnRfcmVnaXN0ZXIocGRldiwgaTkxNSwgTlVMTCwgaTkx
NV92Z2Ffc2V0X2RlY29kZSk7CiAJaWYgKHJldCAmJiByZXQgIT0gLUVOT0RFVikKIAkJZ290byBv
dXQ7CiAKQEAgLTM2NSw1NiArMzY0LDU2IEBAIHN0YXRpYyBpbnQgaTkxNV9kcml2ZXJfbW9kZXNl
dF9wcm9iZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCQlnb3RvIGNsZWFudXBfdmdhX2NsaWVu
dDsKIAogCS8qIG11c3QgaGFwcGVuIGJlZm9yZSBpbnRlbF9wb3dlcl9kb21haW5zX2luaXRfaHco
KSBvbiBWTFYvQ0hWICovCi0JaW50ZWxfdXBkYXRlX3Jhd2NsayhkZXZfcHJpdik7CisJaW50ZWxf
dXBkYXRlX3Jhd2NsayhpOTE1KTsKIAotCWludGVsX3Bvd2VyX2RvbWFpbnNfaW5pdF9odyhkZXZf
cHJpdiwgZmFsc2UpOworCWludGVsX3Bvd2VyX2RvbWFpbnNfaW5pdF9odyhpOTE1LCBmYWxzZSk7
CiAKLQlpbnRlbF9jc3JfdWNvZGVfaW5pdChkZXZfcHJpdik7CisJaW50ZWxfY3NyX3Vjb2RlX2lu
aXQoaTkxNSk7CiAKLQlyZXQgPSBpbnRlbF9pcnFfaW5zdGFsbChkZXZfcHJpdik7CisJcmV0ID0g
aW50ZWxfaXJxX2luc3RhbGwoaTkxNSk7CiAJaWYgKHJldCkKIAkJZ290byBjbGVhbnVwX2NzcjsK
IAotCWludGVsX2dtYnVzX3NldHVwKGRldl9wcml2KTsKKwlpbnRlbF9nbWJ1c19zZXR1cChpOTE1
KTsKIAogCS8qIEltcG9ydGFudDogVGhlIG91dHB1dCBzZXR1cCBmdW5jdGlvbnMgY2FsbGVkIGJ5
IG1vZGVzZXRfaW5pdCBuZWVkCiAJICogd29ya2luZyBpcnFzIGZvciBlLmcuIGdtYnVzIGFuZCBk
cCBhdXggdHJhbnNmZXJzLiAqLwotCXJldCA9IGludGVsX21vZGVzZXRfaW5pdChkZXYpOworCXJl
dCA9IGludGVsX21vZGVzZXRfaW5pdCgmaTkxNS0+ZHJtKTsKIAlpZiAocmV0KQogCQlnb3RvIGNs
ZWFudXBfaXJxOwogCi0JcmV0ID0gaTkxNV9nZW1faW5pdChkZXZfcHJpdik7CisJcmV0ID0gaTkx
NV9nZW1faW5pdChpOTE1KTsKIAlpZiAocmV0KQogCQlnb3RvIGNsZWFudXBfbW9kZXNldDsKIAot
CWludGVsX292ZXJsYXlfc2V0dXAoZGV2X3ByaXYpOworCWludGVsX292ZXJsYXlfc2V0dXAoaTkx
NSk7CiAKLQlpZiAoIUhBU19ESVNQTEFZKGRldl9wcml2KSB8fCAhSU5URUxfRElTUExBWV9FTkFC
TEVEKGRldl9wcml2KSkKKwlpZiAoIUhBU19ESVNQTEFZKGk5MTUpIHx8ICFJTlRFTF9ESVNQTEFZ
X0VOQUJMRUQoaTkxNSkpCiAJCXJldHVybiAwOwogCi0JcmV0ID0gaW50ZWxfZmJkZXZfaW5pdChk
ZXYpOworCXJldCA9IGludGVsX2ZiZGV2X2luaXQoJmk5MTUtPmRybSk7CiAJaWYgKHJldCkKIAkJ
Z290byBjbGVhbnVwX2dlbTsKIAogCS8qIE9ubHkgZW5hYmxlIGhvdHBsdWcgaGFuZGxpbmcgb25j
ZSB0aGUgZmJkZXYgaXMgZnVsbHkgc2V0IHVwLiAqLwotCWludGVsX2hwZF9pbml0KGRldl9wcml2
KTsKKwlpbnRlbF9ocGRfaW5pdChpOTE1KTsKIAotCWludGVsX2luaXRfaXBjKGRldl9wcml2KTsK
KwlpbnRlbF9pbml0X2lwYyhpOTE1KTsKIAogCXJldHVybiAwOwogCiBjbGVhbnVwX2dlbToKLQlp
OTE1X2dlbV9zdXNwZW5kKGRldl9wcml2KTsKLQlpOTE1X2dlbV9kcml2ZXJfcmVtb3ZlKGRldl9w
cml2KTsKLQlpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZShkZXZfcHJpdik7CisJaTkxNV9nZW1fc3Vz
cGVuZChpOTE1KTsKKwlpOTE1X2dlbV9kcml2ZXJfcmVtb3ZlKGk5MTUpOworCWk5MTVfZ2VtX2Ry
aXZlcl9yZWxlYXNlKGk5MTUpOwogY2xlYW51cF9tb2Rlc2V0OgotCWludGVsX21vZGVzZXRfZHJp
dmVyX3JlbW92ZShkZXYpOworCWludGVsX21vZGVzZXRfZHJpdmVyX3JlbW92ZSgmaTkxNS0+ZHJt
KTsKIGNsZWFudXBfaXJxOgotCWludGVsX2lycV91bmluc3RhbGwoZGV2X3ByaXYpOwotCWludGVs
X2dtYnVzX3RlYXJkb3duKGRldl9wcml2KTsKKwlpbnRlbF9pcnFfdW5pbnN0YWxsKGk5MTUpOwor
CWludGVsX2dtYnVzX3RlYXJkb3duKGk5MTUpOwogY2xlYW51cF9jc3I6Ci0JaW50ZWxfY3NyX3Vj
b2RlX2ZpbmkoZGV2X3ByaXYpOwotCWludGVsX3Bvd2VyX2RvbWFpbnNfZHJpdmVyX3JlbW92ZShk
ZXZfcHJpdik7CisJaW50ZWxfY3NyX3Vjb2RlX2ZpbmkoaTkxNSk7CisJaW50ZWxfcG93ZXJfZG9t
YWluc19kcml2ZXJfcmVtb3ZlKGk5MTUpOwogCXZnYV9zd2l0Y2hlcm9vX3VucmVnaXN0ZXJfY2xp
ZW50KHBkZXYpOwogY2xlYW51cF92Z2FfY2xpZW50OgogCXZnYV9jbGllbnRfcmVnaXN0ZXIocGRl
diwgTlVMTCwgTlVMTCwgTlVMTCk7CkBAIC0xNTcwLDcgKzE1NjksNyBAQCBpbnQgaTkxNV9kcml2
ZXJfcHJvYmUoc3RydWN0IHBjaV9kZXYgKnBkZXYsIGNvbnN0IHN0cnVjdCBwY2lfZGV2aWNlX2lk
ICplbnQpCiAJaWYgKHJldCA8IDApCiAJCWdvdG8gb3V0X2NsZWFudXBfbW1pbzsKIAotCXJldCA9
IGk5MTVfZHJpdmVyX21vZGVzZXRfcHJvYmUoJmRldl9wcml2LT5kcm0pOworCXJldCA9IGk5MTVf
ZHJpdmVyX21vZGVzZXRfcHJvYmUoZGV2X3ByaXYpOwogCWlmIChyZXQgPCAwKQogCQlnb3RvIG91
dF9jbGVhbnVwX2h3OwogCi0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3Rz
LmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xp
c3RpbmZvL2ludGVsLWdmeA==

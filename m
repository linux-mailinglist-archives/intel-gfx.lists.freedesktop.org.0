Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0A935D199C
	for <lists+intel-gfx@lfdr.de>; Wed,  9 Oct 2019 22:37:02 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A2F1E6E964;
	Wed,  9 Oct 2019 20:36:59 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0286D6E964
 for <intel-gfx@lists.freedesktop.org>; Wed,  9 Oct 2019 20:36:55 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18782945-1500050 
 for multiple; Wed, 09 Oct 2019 21:36:45 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  9 Oct 2019 21:36:38 +0100
Message-Id: <20191009203641.15477-8-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191009203641.15477-1-chris@chris-wilson.co.uk>
References: <20191009203641.15477-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 08/11] drm/i915/perf: execute OA configuration
 from command stream
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwuY29tPgoK
V2UgaGF2ZW4ndCBydW4gaW50byBpc3N1ZXMgd2l0aCBwcm9ncmFtbWluZyB0aGUgZ2xvYmFsIE9B
L05PQQpyZWdpc3RlcnMgY29uZmlndXJhdGlvbiBmcm9tIENQVSBzbyBmYXIsIGJ1dCBIVyBlbmdp
bmVlcnMgYWN0dWFsbHkKcmVjb21tZW5kIGRvaW5nIHRoaXMgZnJvbSB0aGUgY29tbWFuZCBzdHJl
YW1lci4gT24gVEdMIGluIHBhcnRpY3VsYXIKb25lIG9mIHRoZSBjbG9jayBkb21haW4gaW4gd2hp
Y2ggc29tZSBvZiB0aGF0IHByb2dyYW1taW5nIGdvZXMgbWlnaHQKbm90IGJlIHBvd2VyZWQgd2hl
biB3ZSBwb2tlIHRoaW5ncyBmcm9tIHRoZSBDUFUuCgpTaW5jZSB3ZSBoYXZlIGEgY29tbWFuZCBi
dWZmZXIgcHJlcGFyZWQgZm9yIHRoZSBleGVjYnVmZmVyIHNpZGUgb2YKdGhpbmdzLCB3ZSBjYW4g
cmV1c2UgdGhhdCBhcHByb2FjaCBoZXJlIHRvby4KClRoaXMgYWxzbyBhbGxvd3MgdXMgdG8gc2ln
bmlmaWNhbnRseSByZWR1Y2UgdGhlIGFtb3VudCBvZiB0aW1lIHdlIGhvbGQKdGhlIG1haW4gbG9j
ay4KCnYyOiBEcm9wIHRoZSBnbG9iYWwgbG9jayBhcyBtdWNoIGFzIHBvc3NpYmxlCgp2MzogVGFr
ZSBnbG9iYWwgbG9jayB0byBwaW4gZ2xvYmFsCgp2NDogQ3JlYXRlIGk5MTUgcmVxdWVzdCBpbiBl
bWl0X29hX2NvbmZpZygpIHRvIGF2b2lkIGRlYWRsb2NrcyAoTGlvbmVsKQoKdjU6IE1vdmUgbG9j
a2luZyB0byB0aGUgc3RyZWFtIChMaW9uZWwpCgp2NjogTW92ZSBhY3RpdmUgcmVjb25maWd1cmF0
aW9uIHJlcXVlc3QgaW50byBpOTE1X3BlcmZfc3RyZWFtIChMaW9uZWwpCgp2NzogUGluIFZNQSBv
dXRzaWRlIHJlcXVlc3QgY3JlYXRpb24gKENocmlzKQogICAgTG9jayBWTUEgYmVmb3JlIG1vdmUg
dG8gYWN0aXZlIChDaHJpcykKCnY4OiBGaXggZG91YmxlIGZyZWUgb24gc3RyZWFtLT5pbml0aWFs
X29hX2NvbmZpZ19ibyAoTGlvbmVsKQogICAgRG9uJ3QgYWxsb3cgaW50ZXJydXB0aW9uIHdoZW4g
d2FpdGluZyBvbiBhY3RpdmUgY29uZmlnIHJlcXVlc3QKICAgIChMaW9uZWwpCgpTaWduZWQtb2Zm
LWJ5OiBMaW9uZWwgTGFuZHdlcmxpbiA8bGlvbmVsLmcubGFuZHdlcmxpbkBpbnRlbC5jb20+Ci0t
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgfCAyMDEgKysrKysrKysrKysrKysr
KysrKysrKysrLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDE1NSBpbnNlcnRpb25zKCspLCA0NiBk
ZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCmluZGV4IDZiZjAyZTRjNWYwOS4u
OWYyZDkyYjlkMjJkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYwpAQCAtMTcyNSw1NiArMTcy
NSwxNzkgQEAgc3RhdGljIGludCBhbGxvY19ub2Ffd2FpdChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVh
bSAqc3RyZWFtKQogCXJldHVybiAwOwogCiBlcnJfdW5waW46Ci0JX19pOTE1X3ZtYV91bnBpbih2
bWEpOworCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZ2bWEsIDApOwogZXJyX3VucmVmOgog
CWk5MTVfZ2VtX29iamVjdF9wdXQoYm8pOwogCXJldHVybiByZXQ7CiB9CiAKLXN0YXRpYyB2b2lk
IGNvbmZpZ19vYV9yZWdzKHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSwKLQkJCSAgIGNvbnN0
IHN0cnVjdCBpOTE1X29hX3JlZyAqcmVncywKLQkJCSAgIHUzMiBuX3JlZ3MpCitzdGF0aWMgdTMy
ICp3cml0ZV9jc19taV9scmkodTMyICpjcywKKwkJCSAgICBjb25zdCBzdHJ1Y3QgaTkxNV9vYV9y
ZWcgKnJlZ19kYXRhLAorCQkJICAgIHUzMiBuX3JlZ3MpCiB7CiAJdTMyIGk7CiAKIAlmb3IgKGkg
PSAwOyBpIDwgbl9yZWdzOyBpKyspIHsKLQkJY29uc3Qgc3RydWN0IGk5MTVfb2FfcmVnICpyZWcg
PSByZWdzICsgaTsKKwkJaWYgKChpICUgTUlfTE9BRF9SRUdJU1RFUl9JTU1fTUFYX1JFR1MpID09
IDApIHsKKwkJCXUzMiBuX2xyaSA9IG1pbl90KHUzMiwKKwkJCQkJICBuX3JlZ3MgLSBpLAorCQkJ
CQkgIE1JX0xPQURfUkVHSVNURVJfSU1NX01BWF9SRUdTKTsKKworCQkJKmNzKysgPSBNSV9MT0FE
X1JFR0lTVEVSX0lNTShuX2xyaSk7CisJCX0KKwkJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNl
dChyZWdfZGF0YVtpXS5hZGRyKTsKKwkJKmNzKysgPSByZWdfZGF0YVtpXS52YWx1ZTsKKwl9CisK
KwlyZXR1cm4gY3M7Cit9CisKK3N0YXRpYyBpbnQgbnVtX2xyaV9kd29yZHMoaW50IG51bV9yZWdz
KQoreworCWludCBjb3VudCA9IDA7CisKKwlpZiAobnVtX3JlZ3MgPiAwKSB7CisJCWNvdW50ICs9
IERJVl9ST1VORF9VUChudW1fcmVncywgTUlfTE9BRF9SRUdJU1RFUl9JTU1fTUFYX1JFR1MpOwor
CQljb3VudCArPSBudW1fcmVncyAqIDI7CisJfQorCisJcmV0dXJuIGNvdW50OworfQorCitzdGF0
aWMgc3RydWN0IGk5MTVfb2FfY29uZmlnX2JvICoKK2FsbG9jX29hX2NvbmZpZ19idWZmZXIoc3Ry
dWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwKKwkJICAgICAgIHN0cnVjdCBpOTE1X29hX2Nv
bmZpZyAqb2FfY29uZmlnKQoreworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CisJ
c3RydWN0IGk5MTVfb2FfY29uZmlnX2JvICpvYV9ibzsKKwlzaXplX3QgY29uZmlnX2xlbmd0aCA9
IDA7CisJdTMyICpjczsKKwlpbnQgZXJyOwogCi0JCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUs
IHJlZy0+YWRkciwgcmVnLT52YWx1ZSk7CisJb2FfYm8gPSBremFsbG9jKHNpemVvZigqb2FfYm8p
LCBHRlBfS0VSTkVMKTsKKwlpZiAoIW9hX2JvKQorCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsK
KworCWNvbmZpZ19sZW5ndGggKz0gbnVtX2xyaV9kd29yZHMob2FfY29uZmlnLT5tdXhfcmVnc19s
ZW4pOworCWNvbmZpZ19sZW5ndGggKz0gbnVtX2xyaV9kd29yZHMob2FfY29uZmlnLT5iX2NvdW50
ZXJfcmVnc19sZW4pOworCWNvbmZpZ19sZW5ndGggKz0gbnVtX2xyaV9kd29yZHMob2FfY29uZmln
LT5mbGV4X3JlZ3NfbGVuKTsKKwljb25maWdfbGVuZ3RoKys7IC8qIE1JX0JBVENIX0JVRkZFUl9F
TkQgKi8KKwljb25maWdfbGVuZ3RoID0gQUxJR04oc2l6ZW9mKHUzMikgKiBjb25maWdfbGVuZ3Ro
LCBJOTE1X0dUVF9QQUdFX1NJWkUpOworCisJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9z
aG1lbShzdHJlYW0tPnBlcmYtPmk5MTUsIGNvbmZpZ19sZW5ndGgpOworCWlmIChJU19FUlIob2Jq
KSkgeworCQllcnIgPSBQVFJfRVJSKG9iaik7CisJCWdvdG8gZXJyX2ZyZWU7CisJfQorCisJY3Mg
PSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChvYmosIEk5MTVfTUFQX1dCKTsKKwlpZiAoSVNfRVJS
KGNzKSkgeworCQllcnIgPSBQVFJfRVJSKGNzKTsKKwkJZ290byBlcnJfb2FfYm87CiAJfQorCisJ
Y3MgPSB3cml0ZV9jc19taV9scmkoY3MsCisJCQkgICAgIG9hX2NvbmZpZy0+bXV4X3JlZ3MsCisJ
CQkgICAgIG9hX2NvbmZpZy0+bXV4X3JlZ3NfbGVuKTsKKwljcyA9IHdyaXRlX2NzX21pX2xyaShj
cywKKwkJCSAgICAgb2FfY29uZmlnLT5iX2NvdW50ZXJfcmVncywKKwkJCSAgICAgb2FfY29uZmln
LT5iX2NvdW50ZXJfcmVnc19sZW4pOworCWNzID0gd3JpdGVfY3NfbWlfbHJpKGNzLAorCQkJICAg
ICBvYV9jb25maWctPmZsZXhfcmVncywKKwkJCSAgICAgb2FfY29uZmlnLT5mbGV4X3JlZ3NfbGVu
KTsKKworCSpjcysrID0gTUlfQkFUQ0hfQlVGRkVSX0VORDsKKworCWk5MTVfZ2VtX29iamVjdF9m
bHVzaF9tYXAob2JqKTsKKwlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKG9iaik7CisKKwlvYV9i
by0+dm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCAmc3RyZWFtLT5ndC0+Z2d0dC0+dm0sIE5V
TEwpOworCWlmIChJU19FUlIob2FfYm8tPnZtYSkpIHsKKwkJZXJyID0gUFRSX0VSUihvYV9iby0+
dm1hKTsKKwkJZ290byBlcnJfb2FfYm87CisJfQorCisJb2FfYm8tPm9hX2NvbmZpZyA9IGk5MTVf
b2FfY29uZmlnX2dldChvYV9jb25maWcpOworCWxsaXN0X2FkZCgmb2FfYm8tPm5vZGUsICZzdHJl
YW0tPm9hX2NvbmZpZ19ib3MpOworCisJcmV0dXJuIG9hX2JvOworCitlcnJfb2FfYm86CisJaTkx
NV9nZW1fb2JqZWN0X3B1dChvYmopOworZXJyX2ZyZWU6CisJa2ZyZWUob2FfYm8pOworCXJldHVy
biBFUlJfUFRSKGVycik7CiB9CiAKLXN0YXRpYyB2b2lkIGRlbGF5X2FmdGVyX211eCh2b2lkKQor
c3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqCitnZXRfb2Ffdm1hKHN0cnVjdCBpOTE1X3BlcmZfc3Ry
ZWFtICpzdHJlYW0sIHN0cnVjdCBpOTE1X29hX2NvbmZpZyAqb2FfY29uZmlnKQogeworCXN0cnVj
dCBpOTE1X29hX2NvbmZpZ19ibyAqb2FfYm87CisKIAkvKgotCSAqIEl0IGFwcGFyZW50bHkgdGFr
ZXMgYSBmYWlybHkgbG9uZyB0aW1lIGZvciBhIG5ldyBNVVgKLQkgKiBjb25maWd1cmF0aW9uIHRv
IGJlIGJlIGFwcGxpZWQgYWZ0ZXIgdGhlc2UgcmVnaXN0ZXIgd3JpdGVzLgotCSAqIFRoaXMgZGVs
YXkgZHVyYXRpb24gd2FzIGRlcml2ZWQgZW1waXJpY2FsbHkgYmFzZWQgb24gdGhlCi0JICogcmVu
ZGVyX2Jhc2ljIGNvbmZpZyBidXQgaG9wZWZ1bGx5IGl0IGNvdmVycyB0aGUgbWF4aW11bQotCSAq
IGNvbmZpZ3VyYXRpb24gbGF0ZW5jeS4KLQkgKgotCSAqIEFzIGEgZmFsbGJhY2ssIHRoZSBjaGVj
a3MgaW4gX2FwcGVuZF9vYV9yZXBvcnRzKCkgdG8gc2tpcAotCSAqIGludmFsaWQgT0EgcmVwb3J0
cyBkbyBhbHNvIHNlZW0gdG8gd29yayB0byBkaXNjYXJkIHJlcG9ydHMKLQkgKiBnZW5lcmF0ZWQg
YmVmb3JlIHRoaXMgY29uZmlnIGhhcyBjb21wbGV0ZWQgLSBhbGJlaXQgbm90Ci0JICogc2lsZW50
bHkuCi0JICoKLQkgKiBVbmZvcnR1bmF0ZWx5IHRoaXMgaXMgZXNzZW50aWFsbHkgYSBtYWdpYyBu
dW1iZXIsIHNpbmNlIHdlCi0JICogZG9uJ3QgY3VycmVudGx5IGtub3cgb2YgYSByZWxpYWJsZSBt
ZWNoYW5pc20gZm9yIHByZWRpY3RpbmcKLQkgKiBob3cgbG9uZyB0aGUgTVVYIGNvbmZpZyB3aWxs
IHRha2UgdG8gYXBwbHkgYW5kIGJlc2lkZXMKLQkgKiBzZWVpbmcgaW52YWxpZCByZXBvcnRzIHdl
IGRvbid0IGtub3cgb2YgYSByZWxpYWJsZSB3YXkgdG8KLQkgKiBleHBsaWNpdGx5IGNoZWNrIHRo
YXQgdGhlIE1VWCBjb25maWcgaGFzIGxhbmRlZC4KLQkgKgotCSAqIEl0J3MgZXZlbiBwb3NzaWJs
ZSB3ZSd2ZSBtaXNzIGNoYXJhY3Rlcml6ZWQgdGhlIHVuZGVybHlpbmcKLQkgKiBwcm9ibGVtIC0g
aXQganVzdCBzZWVtcyBsaWtlIHRoZSBzaW1wbGVzdCBleHBsYW5hdGlvbiB3aHkKLQkgKiBhIGRl
bGF5IGF0IHRoaXMgbG9jYXRpb24gd291bGQgbWl0aWdhdGUgYW55IGludmFsaWQgcmVwb3J0cy4K
KwkgKiBMb29rIGZvciB0aGUgYnVmZmVyIGluIHRoZSBhbHJlYWR5IGFsbG9jYXRlZCBCT3MgYXR0
YWNoZWQKKwkgKiB0byB0aGUgc3RyZWFtLgogCSAqLwotCXVzbGVlcF9yYW5nZSgxNTAwMCwgMjAw
MDApOworCWxsaXN0X2Zvcl9lYWNoX2VudHJ5KG9hX2JvLCBzdHJlYW0tPm9hX2NvbmZpZ19ib3Mu
Zmlyc3QsIG5vZGUpIHsKKwkJaWYgKG9hX2JvLT5vYV9jb25maWcgPT0gb2FfY29uZmlnICYmCisJ
CSAgICBtZW1jbXAob2FfYm8tPm9hX2NvbmZpZy0+dXVpZCwKKwkJCSAgIG9hX2NvbmZpZy0+dXVp
ZCwKKwkJCSAgIHNpemVvZihvYV9jb25maWctPnV1aWQpKSA9PSAwKQorCQkJZ290byBvdXQ7CisJ
fQorCisJb2FfYm8gPSBhbGxvY19vYV9jb25maWdfYnVmZmVyKHN0cmVhbSwgb2FfY29uZmlnKTsK
KwlpZiAoSVNfRVJSKG9hX2JvKSkKKwkJcmV0dXJuIEVSUl9DQVNUKG9hX2JvKTsKKworb3V0Ogor
CXJldHVybiBpOTE1X3ZtYV9nZXQob2FfYm8tPnZtYSk7Cit9CisKK3N0YXRpYyBpbnQgZW1pdF9v
YV9jb25maWcoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwKKwkJCSAgc3RydWN0IGlu
dGVsX2NvbnRleHQgKmNlKQoreworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCXN0cnVjdCBp
OTE1X3ZtYSAqdm1hOworCWludCBlcnI7CisKKwl2bWEgPSBnZXRfb2Ffdm1hKHN0cmVhbSwgc3Ry
ZWFtLT5vYV9jb25maWcpOworCWlmIChJU19FUlIodm1hKSkKKwkJcmV0dXJuIFBUUl9FUlIodm1h
KTsKKworCWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIFBJTl9HTE9CQUwgfCBQSU5fSElH
SCk7CisJaWYgKGVycikKKwkJZ290byBlcnJfdm1hX3B1dDsKKworCXJxID0gaTkxNV9yZXF1ZXN0
X2NyZWF0ZShjZSk7CisJaWYgKElTX0VSUihycSkpIHsKKwkJZXJyID0gUFRSX0VSUihycSk7CisJ
CWdvdG8gZXJyX3ZtYV91bnBpbjsKKwl9CisKKwlpOTE1X3ZtYV9sb2NrKHZtYSk7CisJZXJyID0g
aTkxNV9yZXF1ZXN0X2F3YWl0X29iamVjdChycSwgdm1hLT5vYmosIDApOworCWlmICghZXJyKQor
CQllcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZSh2bWEsIHJxLCAwKTsKKwlpOTE1X3ZtYV91
bmxvY2sodm1hKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl9hZGRfcmVxdWVzdDsKKworCWVyciA9
IHJxLT5lbmdpbmUtPmVtaXRfYmJfc3RhcnQocnEsCisJCQkJCXZtYS0+bm9kZS5zdGFydCwgMCwK
KwkJCQkJSTkxNV9ESVNQQVRDSF9TRUNVUkUpOworZXJyX2FkZF9yZXF1ZXN0OgorCWk5MTVfcmVx
dWVzdF9hZGQocnEpOworZXJyX3ZtYV91bnBpbjoKKwlpOTE1X3ZtYV91bnBpbih2bWEpOworZXJy
X3ZtYV9wdXQ6CisJaTkxNV92bWFfcHV0KHZtYSk7CisJcmV0dXJuIGVycjsKIH0KIAogc3RhdGlj
IGludCBoc3dfZW5hYmxlX21ldHJpY19zZXQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVh
bSkKIHsKIAlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSBzdHJlYW0tPmd0LT51bmNvcmU7
Ci0JY29uc3Qgc3RydWN0IGk5MTVfb2FfY29uZmlnICpvYV9jb25maWcgPSBzdHJlYW0tPm9hX2Nv
bmZpZzsKIAogCS8qCiAJICogUFJNOgpAQCAtMTc5MSwxMyArMTkxNCw3IEBAIHN0YXRpYyBpbnQg
aHN3X2VuYWJsZV9tZXRyaWNfc2V0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiAJ
aW50ZWxfdW5jb3JlX3Jtdyh1bmNvcmUsIEdFTjZfVUNHQ1RMMSwKIAkJCSAwLCBHRU42X0NTVU5J
VF9DTE9DS19HQVRFX0RJU0FCTEUpOwogCi0JY29uZmlnX29hX3JlZ3ModW5jb3JlLCBvYV9jb25m
aWctPm11eF9yZWdzLCBvYV9jb25maWctPm11eF9yZWdzX2xlbik7Ci0JZGVsYXlfYWZ0ZXJfbXV4
KCk7Ci0KLQljb25maWdfb2FfcmVncyh1bmNvcmUsIG9hX2NvbmZpZy0+Yl9jb3VudGVyX3JlZ3Ms
Ci0JCSAgICAgICBvYV9jb25maWctPmJfY291bnRlcl9yZWdzX2xlbik7Ci0KLQlyZXR1cm4gMDsK
KwlyZXR1cm4gZW1pdF9vYV9jb25maWcoc3RyZWFtLCBzdHJlYW0tPmVuZ2luZS0+a2VybmVsX2Nv
bnRleHQpOwogfQogCiBzdGF0aWMgdm9pZCBoc3dfZGlzYWJsZV9tZXRyaWNfc2V0KHN0cnVjdCBp
OTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCkBAIC0yMTYxLDEzICsyMjc4LDcgQEAgc3RhdGljIGlu
dCBnZW44X2VuYWJsZV9tZXRyaWNfc2V0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0p
CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAotCWNvbmZpZ19vYV9yZWdzKHVuY29yZSwgb2Ff
Y29uZmlnLT5tdXhfcmVncywgb2FfY29uZmlnLT5tdXhfcmVnc19sZW4pOwotCWRlbGF5X2FmdGVy
X211eCgpOwotCi0JY29uZmlnX29hX3JlZ3ModW5jb3JlLCBvYV9jb25maWctPmJfY291bnRlcl9y
ZWdzLAotCQkgICAgICAgb2FfY29uZmlnLT5iX2NvdW50ZXJfcmVnc19sZW4pOwotCi0JcmV0dXJu
IDA7CisJcmV0dXJuIGVtaXRfb2FfY29uZmlnKHN0cmVhbSwgc3RyZWFtLT5lbmdpbmUtPmtlcm5l
bF9jb250ZXh0KTsKIH0KIAogc3RhdGljIHZvaWQgZ2VuOF9kaXNhYmxlX21ldHJpY19zZXQoc3Ry
dWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKQEAgLTI0MjgsMTAgKzI1MzksOCBAQCBzdGF0
aWMgaW50IGk5MTVfb2Ffc3RyZWFtX2luaXQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVh
bSwKIAlwZXJmLT5leGNsdXNpdmVfc3RyZWFtID0gc3RyZWFtOwogCiAJcmV0ID0gcGVyZi0+b3Bz
LmVuYWJsZV9tZXRyaWNfc2V0KHN0cmVhbSk7Ci0JaWYgKHJldCkgewotCQlEUk1fREVCVUcoIlVu
YWJsZSB0byBlbmFibGUgbWV0cmljIHNldFxuIik7CisJaWYgKHJldCkKIAkJZ290byBlcnJfZW5h
YmxlOwotCX0KIAogCURSTV9ERUJVRygib3BlbmluZyBzdHJlYW0gb2EgY29uZmlnIHV1aWQ9JXNc
biIsCiAJCSAgc3RyZWFtLT5vYV9jb25maWctPnV1aWQpOwotLSAKMi4yMy4wCgpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBs
aXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id CB26121E42
	for <lists+intel-gfx@lfdr.de>; Fri, 17 May 2019 21:31:38 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D532B8997C;
	Fri, 17 May 2019 19:31:36 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga01.intel.com (mga01.intel.com [192.55.52.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8ABDA8997C
 for <intel-gfx@lists.freedesktop.org>; Fri, 17 May 2019 19:31:35 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga007.jf.intel.com ([10.7.209.58])
 by fmsmga101.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 17 May 2019 12:31:35 -0700
X-ExtLoop1: 1
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by orsmga007.jf.intel.com with SMTP; 17 May 2019 12:31:32 -0700
Received: by stinkbox (sSMTP sendmail emulation);
 Fri, 17 May 2019 22:31:32 +0300
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 17 May 2019 22:31:19 +0300
Message-Id: <20190517193132.8140-1-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.21.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 01/14] drm/i915: Pass intel_atomic_state to
 cdclk funcs
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KClBh
c3MgYXJvdW5kIGludGVsX2F0b21pY19zdGF0ZSByYXRoZXIgdGhhbiBkcm1fYXRvbWljX3N0YXRl
LgpUaGlzIGF2b2lkcyBzb21lIGV4dHJhIGNhc3RzIGFuZCBhbm5vaW5nIGFsaWFzaW5nIHZhcmlh
Ymxlcy4KClNpZ25lZC1vZmYtYnk6IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBsaW51
eC5pbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAgICAgIHwg
ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9jZGNsay5jICAgfCAxNjcgKysrKysr
KysrKysrLS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kaXNwbGF5
LmMgfCAgIDIgKy0KIDMgZmlsZXMgY2hhbmdlZCwgNzkgaW5zZXJ0aW9ucygrKSwgOTIgZGVsZXRp
b25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKaW5kZXggNTgwMWY1NDA3NTg5Li43YWM4ZDk3
NTE3ZGYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaApAQCAtMjk4LDcgKzI5OCw3IEBAIHN0cnVj
dCBkcm1faTkxNV9kaXNwbGF5X2Z1bmNzIHsKIAkJCQkgICAgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNzdGF0ZSk7CiAJaW50ICgqY29tcHV0ZV9nbG9iYWxfd2F0ZXJtYXJrcykoc3RydWN0IGlu
dGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpOwogCXZvaWQgKCp1cGRhdGVfd20pKHN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjKTsKLQlpbnQgKCptb2Rlc2V0X2NhbGNfY2RjbGspKHN0cnVjdCBkcm1fYXRv
bWljX3N0YXRlICpzdGF0ZSk7CisJaW50ICgqbW9kZXNldF9jYWxjX2NkY2xrKShzdHJ1Y3QgaW50
ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSk7CiAJLyogUmV0dXJucyB0aGUgYWN0aXZlIHN0YXRlIG9m
IHRoZSBjcnRjLCBhbmQgaWYgdGhlIGNydGMgaXMgYWN0aXZlLAogCSAqIGZpbGxzIG91dCB0aGUg
cGlwZS1jb25maWcgd2l0aCB0aGUgaHcgc3RhdGUuICovCiAJYm9vbCAoKmdldF9waXBlX2NvbmZp
Zykoc3RydWN0IGludGVsX2NydGMgKiwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2ludGVsX2NkY2xrLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9jZGNsay5jCmluZGV4
IDc4ZDlmNjE5OTU2Yy4uNmU3MTJmZWM5MjVmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9jZGNsay5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2NkY2xr
LmMKQEAgLTIyODMsMjkgKzIyODMsMjggQEAgaW50IGludGVsX2NydGNfY29tcHV0ZV9taW5fY2Rj
bGsoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJcmV0dXJuIG1p
bl9jZGNsazsKIH0KIAotc3RhdGljIGludCBpbnRlbF9jb21wdXRlX21pbl9jZGNsayhzdHJ1Y3Qg
ZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCitzdGF0aWMgaW50IGludGVsX2NvbXB1dGVfbWluX2Nk
Y2xrKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogewotCXN0cnVjdCBpbnRlbF9h
dG9taWNfc3RhdGUgKmludGVsX3N0YXRlID0gdG9faW50ZWxfYXRvbWljX3N0YXRlKHN0YXRlKTsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHN0YXRlLT5kZXYp
OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoc3RhdGUtPmJh
c2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZTsKIAlpbnQgbWluX2NkY2xrLCBpOwogCWVudW0gcGlwZSBwaXBlOwog
Ci0JbWVtY3B5KGludGVsX3N0YXRlLT5taW5fY2RjbGssIGRldl9wcml2LT5taW5fY2RjbGssCi0J
ICAgICAgIHNpemVvZihpbnRlbF9zdGF0ZS0+bWluX2NkY2xrKSk7CisJbWVtY3B5KHN0YXRlLT5t
aW5fY2RjbGssIGRldl9wcml2LT5taW5fY2RjbGssCisJICAgICAgIHNpemVvZihzdGF0ZS0+bWlu
X2NkY2xrKSk7CiAKLQlmb3JfZWFjaF9uZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShpbnRlbF9zdGF0
ZSwgY3J0YywgY3J0Y19zdGF0ZSwgaSkgeworCWZvcl9lYWNoX25ld19pbnRlbF9jcnRjX2luX3N0
YXRlKHN0YXRlLCBjcnRjLCBjcnRjX3N0YXRlLCBpKSB7CiAJCW1pbl9jZGNsayA9IGludGVsX2Ny
dGNfY29tcHV0ZV9taW5fY2RjbGsoY3J0Y19zdGF0ZSk7CiAJCWlmIChtaW5fY2RjbGsgPCAwKQog
CQkJcmV0dXJuIG1pbl9jZGNsazsKIAotCQlpbnRlbF9zdGF0ZS0+bWluX2NkY2xrW2ldID0gbWlu
X2NkY2xrOworCQlzdGF0ZS0+bWluX2NkY2xrW2ldID0gbWluX2NkY2xrOwogCX0KIAotCW1pbl9j
ZGNsayA9IGludGVsX3N0YXRlLT5jZGNsay5mb3JjZV9taW5fY2RjbGs7CisJbWluX2NkY2xrID0g
c3RhdGUtPmNkY2xrLmZvcmNlX21pbl9jZGNsazsKIAlmb3JfZWFjaF9waXBlKGRldl9wcml2LCBw
aXBlKQotCQltaW5fY2RjbGsgPSBtYXgoaW50ZWxfc3RhdGUtPm1pbl9jZGNsa1twaXBlXSwgbWlu
X2NkY2xrKTsKKwkJbWluX2NkY2xrID0gbWF4KHN0YXRlLT5taW5fY2RjbGtbcGlwZV0sIG1pbl9j
ZGNsayk7CiAKIAlyZXR1cm4gbWluX2NkY2xrOwogfQpAQCAtMjM0NywxMCArMjM0Niw5IEBAIHN0
YXRpYyB1OCBjbmxfY29tcHV0ZV9taW5fdm9sdGFnZV9sZXZlbChzdHJ1Y3QgaW50ZWxfYXRvbWlj
X3N0YXRlICpzdGF0ZSkKIAlyZXR1cm4gbWluX3ZvbHRhZ2VfbGV2ZWw7CiB9CiAKLXN0YXRpYyBp
bnQgdmx2X21vZGVzZXRfY2FsY19jZGNsayhzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUp
CitzdGF0aWMgaW50IHZsdl9tb2Rlc2V0X2NhbGNfY2RjbGsoc3RydWN0IGludGVsX2F0b21pY19z
dGF0ZSAqc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShzdGF0ZS0+ZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICppbnRlbF9zdGF0
ZSA9IHRvX2ludGVsX2F0b21pY19zdGF0ZShzdGF0ZSk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5kZXYpOwogCWludCBtaW5fY2RjbGss
IGNkY2xrOwogCiAJbWluX2NkY2xrID0gaW50ZWxfY29tcHV0ZV9taW5fY2RjbGsoc3RhdGUpOwpA
QCAtMjM1OSwyOCArMjM1NywyNSBAQCBzdGF0aWMgaW50IHZsdl9tb2Rlc2V0X2NhbGNfY2RjbGso
c3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQogCiAJY2RjbGsgPSB2bHZfY2FsY19jZGNs
ayhkZXZfcHJpdiwgbWluX2NkY2xrKTsKIAotCWludGVsX3N0YXRlLT5jZGNsay5sb2dpY2FsLmNk
Y2xrID0gY2RjbGs7Ci0JaW50ZWxfc3RhdGUtPmNkY2xrLmxvZ2ljYWwudm9sdGFnZV9sZXZlbCA9
CisJc3RhdGUtPmNkY2xrLmxvZ2ljYWwuY2RjbGsgPSBjZGNsazsKKwlzdGF0ZS0+Y2RjbGsubG9n
aWNhbC52b2x0YWdlX2xldmVsID0KIAkJdmx2X2NhbGNfdm9sdGFnZV9sZXZlbChkZXZfcHJpdiwg
Y2RjbGspOwogCi0JaWYgKCFpbnRlbF9zdGF0ZS0+YWN0aXZlX2NydGNzKSB7Ci0JCWNkY2xrID0g
dmx2X2NhbGNfY2RjbGsoZGV2X3ByaXYsCi0JCQkJICAgICAgIGludGVsX3N0YXRlLT5jZGNsay5m
b3JjZV9taW5fY2RjbGspOworCWlmICghc3RhdGUtPmFjdGl2ZV9jcnRjcykgeworCQljZGNsayA9
IHZsdl9jYWxjX2NkY2xrKGRldl9wcml2LCBzdGF0ZS0+Y2RjbGsuZm9yY2VfbWluX2NkY2xrKTsK
IAotCQlpbnRlbF9zdGF0ZS0+Y2RjbGsuYWN0dWFsLmNkY2xrID0gY2RjbGs7Ci0JCWludGVsX3N0
YXRlLT5jZGNsay5hY3R1YWwudm9sdGFnZV9sZXZlbCA9CisJCXN0YXRlLT5jZGNsay5hY3R1YWwu
Y2RjbGsgPSBjZGNsazsKKwkJc3RhdGUtPmNkY2xrLmFjdHVhbC52b2x0YWdlX2xldmVsID0KIAkJ
CXZsdl9jYWxjX3ZvbHRhZ2VfbGV2ZWwoZGV2X3ByaXYsIGNkY2xrKTsKIAl9IGVsc2UgewotCQlp
bnRlbF9zdGF0ZS0+Y2RjbGsuYWN0dWFsID0KLQkJCWludGVsX3N0YXRlLT5jZGNsay5sb2dpY2Fs
OworCQlzdGF0ZS0+Y2RjbGsuYWN0dWFsID0gc3RhdGUtPmNkY2xrLmxvZ2ljYWw7CiAJfQogCiAJ
cmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgYmR3X21vZGVzZXRfY2FsY19jZGNsayhzdHJ1Y3Qg
ZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCitzdGF0aWMgaW50IGJkd19tb2Rlc2V0X2NhbGNfY2Rj
bGsoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2F0
b21pY19zdGF0ZSAqaW50ZWxfc3RhdGUgPSB0b19pbnRlbF9hdG9taWNfc3RhdGUoc3RhdGUpOwog
CWludCBtaW5fY2RjbGssIGNkY2xrOwogCiAJbWluX2NkY2xrID0gaW50ZWxfY29tcHV0ZV9taW5f
Y2RjbGsoc3RhdGUpOwpAQCAtMjM5MywzNiArMjM4OCwzNSBAQCBzdGF0aWMgaW50IGJkd19tb2Rl
c2V0X2NhbGNfY2RjbGsoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQogCSAqLwogCWNk
Y2xrID0gYmR3X2NhbGNfY2RjbGsobWluX2NkY2xrKTsKIAotCWludGVsX3N0YXRlLT5jZGNsay5s
b2dpY2FsLmNkY2xrID0gY2RjbGs7Ci0JaW50ZWxfc3RhdGUtPmNkY2xrLmxvZ2ljYWwudm9sdGFn
ZV9sZXZlbCA9CisJc3RhdGUtPmNkY2xrLmxvZ2ljYWwuY2RjbGsgPSBjZGNsazsKKwlzdGF0ZS0+
Y2RjbGsubG9naWNhbC52b2x0YWdlX2xldmVsID0KIAkJYmR3X2NhbGNfdm9sdGFnZV9sZXZlbChj
ZGNsayk7CiAKLQlpZiAoIWludGVsX3N0YXRlLT5hY3RpdmVfY3J0Y3MpIHsKLQkJY2RjbGsgPSBi
ZHdfY2FsY19jZGNsayhpbnRlbF9zdGF0ZS0+Y2RjbGsuZm9yY2VfbWluX2NkY2xrKTsKKwlpZiAo
IXN0YXRlLT5hY3RpdmVfY3J0Y3MpIHsKKwkJY2RjbGsgPSBiZHdfY2FsY19jZGNsayhzdGF0ZS0+
Y2RjbGsuZm9yY2VfbWluX2NkY2xrKTsKIAotCQlpbnRlbF9zdGF0ZS0+Y2RjbGsuYWN0dWFsLmNk
Y2xrID0gY2RjbGs7Ci0JCWludGVsX3N0YXRlLT5jZGNsay5hY3R1YWwudm9sdGFnZV9sZXZlbCA9
CisJCXN0YXRlLT5jZGNsay5hY3R1YWwuY2RjbGsgPSBjZGNsazsKKwkJc3RhdGUtPmNkY2xrLmFj
dHVhbC52b2x0YWdlX2xldmVsID0KIAkJCWJkd19jYWxjX3ZvbHRhZ2VfbGV2ZWwoY2RjbGspOwog
CX0gZWxzZSB7Ci0JCWludGVsX3N0YXRlLT5jZGNsay5hY3R1YWwgPQotCQkJaW50ZWxfc3RhdGUt
PmNkY2xrLmxvZ2ljYWw7CisJCXN0YXRlLT5jZGNsay5hY3R1YWwgPSBzdGF0ZS0+Y2RjbGsubG9n
aWNhbDsKIAl9CiAKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGludCBza2xfZHBsbDBfdmNvKHN0
cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKmludGVsX3N0YXRlKQorc3RhdGljIGludCBza2xfZHBs
bDBfdmNvKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogewotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoaW50ZWxfc3RhdGUtPmJhc2UuZGV2KTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHN0YXRlLT5iYXNl
LmRldik7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGM7CiAJc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGU7CiAJaW50IHZjbywgaTsKIAotCXZjbyA9IGludGVsX3N0YXRlLT5jZGNs
ay5sb2dpY2FsLnZjbzsKKwl2Y28gPSBzdGF0ZS0+Y2RjbGsubG9naWNhbC52Y287CiAJaWYgKCF2
Y28pCiAJCXZjbyA9IGRldl9wcml2LT5za2xfcHJlZmVycmVkX3Zjb19mcmVxOwogCi0JZm9yX2Vh
Y2hfbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoaW50ZWxfc3RhdGUsIGNydGMsIGNydGNfc3RhdGUs
IGkpIHsKKwlmb3JfZWFjaF9uZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0YywgY3J0
Y19zdGF0ZSwgaSkgewogCQlpZiAoIWNydGNfc3RhdGUtPmJhc2UuZW5hYmxlKQogCQkJY29udGlu
dWU7CiAKQEAgLTI0NDcsMTYgKzI0NDEsMTUgQEAgc3RhdGljIGludCBza2xfZHBsbDBfdmNvKHN0
cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKmludGVsX3N0YXRlKQogCXJldHVybiB2Y287CiB9CiAK
LXN0YXRpYyBpbnQgc2tsX21vZGVzZXRfY2FsY19jZGNsayhzdHJ1Y3QgZHJtX2F0b21pY19zdGF0
ZSAqc3RhdGUpCitzdGF0aWMgaW50IHNrbF9tb2Rlc2V0X2NhbGNfY2RjbGsoc3RydWN0IGludGVs
X2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqaW50
ZWxfc3RhdGUgPSB0b19pbnRlbF9hdG9taWNfc3RhdGUoc3RhdGUpOwogCWludCBtaW5fY2RjbGss
IGNkY2xrLCB2Y287CiAKIAltaW5fY2RjbGsgPSBpbnRlbF9jb21wdXRlX21pbl9jZGNsayhzdGF0
ZSk7CiAJaWYgKG1pbl9jZGNsayA8IDApCiAJCXJldHVybiBtaW5fY2RjbGs7CiAKLQl2Y28gPSBz
a2xfZHBsbDBfdmNvKGludGVsX3N0YXRlKTsKKwl2Y28gPSBza2xfZHBsbDBfdmNvKHN0YXRlKTsK
IAogCS8qCiAJICogRklYTUUgc2hvdWxkIGFsc28gYWNjb3VudCBmb3IgcGxhbmUgcmF0aW8KQEAg
LTI0NjQsMzAgKzI0NTcsMjggQEAgc3RhdGljIGludCBza2xfbW9kZXNldF9jYWxjX2NkY2xrKHN0
cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkgKi8KIAljZGNsayA9IHNrbF9jYWxjX2Nk
Y2xrKG1pbl9jZGNsaywgdmNvKTsKIAotCWludGVsX3N0YXRlLT5jZGNsay5sb2dpY2FsLnZjbyA9
IHZjbzsKLQlpbnRlbF9zdGF0ZS0+Y2RjbGsubG9naWNhbC5jZGNsayA9IGNkY2xrOwotCWludGVs
X3N0YXRlLT5jZGNsay5sb2dpY2FsLnZvbHRhZ2VfbGV2ZWwgPQorCXN0YXRlLT5jZGNsay5sb2dp
Y2FsLnZjbyA9IHZjbzsKKwlzdGF0ZS0+Y2RjbGsubG9naWNhbC5jZGNsayA9IGNkY2xrOworCXN0
YXRlLT5jZGNsay5sb2dpY2FsLnZvbHRhZ2VfbGV2ZWwgPQogCQlza2xfY2FsY192b2x0YWdlX2xl
dmVsKGNkY2xrKTsKIAotCWlmICghaW50ZWxfc3RhdGUtPmFjdGl2ZV9jcnRjcykgewotCQljZGNs
ayA9IHNrbF9jYWxjX2NkY2xrKGludGVsX3N0YXRlLT5jZGNsay5mb3JjZV9taW5fY2RjbGssIHZj
byk7CisJaWYgKCFzdGF0ZS0+YWN0aXZlX2NydGNzKSB7CisJCWNkY2xrID0gc2tsX2NhbGNfY2Rj
bGsoc3RhdGUtPmNkY2xrLmZvcmNlX21pbl9jZGNsaywgdmNvKTsKIAotCQlpbnRlbF9zdGF0ZS0+
Y2RjbGsuYWN0dWFsLnZjbyA9IHZjbzsKLQkJaW50ZWxfc3RhdGUtPmNkY2xrLmFjdHVhbC5jZGNs
ayA9IGNkY2xrOwotCQlpbnRlbF9zdGF0ZS0+Y2RjbGsuYWN0dWFsLnZvbHRhZ2VfbGV2ZWwgPQor
CQlzdGF0ZS0+Y2RjbGsuYWN0dWFsLnZjbyA9IHZjbzsKKwkJc3RhdGUtPmNkY2xrLmFjdHVhbC5j
ZGNsayA9IGNkY2xrOworCQlzdGF0ZS0+Y2RjbGsuYWN0dWFsLnZvbHRhZ2VfbGV2ZWwgPQogCQkJ
c2tsX2NhbGNfdm9sdGFnZV9sZXZlbChjZGNsayk7CiAJfSBlbHNlIHsKLQkJaW50ZWxfc3RhdGUt
PmNkY2xrLmFjdHVhbCA9Ci0JCQlpbnRlbF9zdGF0ZS0+Y2RjbGsubG9naWNhbDsKKwkJc3RhdGUt
PmNkY2xrLmFjdHVhbCA9IHN0YXRlLT5jZGNsay5sb2dpY2FsOwogCX0KIAogCXJldHVybiAwOwog
fQogCi1zdGF0aWMgaW50IGJ4dF9tb2Rlc2V0X2NhbGNfY2RjbGsoc3RydWN0IGRybV9hdG9taWNf
c3RhdGUgKnN0YXRlKQorc3RhdGljIGludCBieHRfbW9kZXNldF9jYWxjX2NkY2xrKHN0cnVjdCBp
bnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoc3RhdGUtPmRldik7Ci0Jc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSAqaW50ZWxfc3RhdGUgPSB0b19pbnRlbF9hdG9taWNfc3RhdGUoc3RhdGUpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoc3RhdGUtPmJhc2UuZGV2KTsKIAlp
bnQgbWluX2NkY2xrLCBjZGNsaywgdmNvOwogCiAJbWluX2NkY2xrID0gaW50ZWxfY29tcHV0ZV9t
aW5fY2RjbGsoc3RhdGUpOwpAQCAtMjUwMiwzNiArMjQ5MywzNCBAQCBzdGF0aWMgaW50IGJ4dF9t
b2Rlc2V0X2NhbGNfY2RjbGsoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQl2Y28g
PSBieHRfZGVfcGxsX3ZjbyhkZXZfcHJpdiwgY2RjbGspOwogCX0KIAotCWludGVsX3N0YXRlLT5j
ZGNsay5sb2dpY2FsLnZjbyA9IHZjbzsKLQlpbnRlbF9zdGF0ZS0+Y2RjbGsubG9naWNhbC5jZGNs
ayA9IGNkY2xrOwotCWludGVsX3N0YXRlLT5jZGNsay5sb2dpY2FsLnZvbHRhZ2VfbGV2ZWwgPQor
CXN0YXRlLT5jZGNsay5sb2dpY2FsLnZjbyA9IHZjbzsKKwlzdGF0ZS0+Y2RjbGsubG9naWNhbC5j
ZGNsayA9IGNkY2xrOworCXN0YXRlLT5jZGNsay5sb2dpY2FsLnZvbHRhZ2VfbGV2ZWwgPQogCQli
eHRfY2FsY192b2x0YWdlX2xldmVsKGNkY2xrKTsKIAotCWlmICghaW50ZWxfc3RhdGUtPmFjdGl2
ZV9jcnRjcykgeworCWlmICghc3RhdGUtPmFjdGl2ZV9jcnRjcykgewogCQlpZiAoSVNfR0VNSU5J
TEFLRShkZXZfcHJpdikpIHsKLQkJCWNkY2xrID0gZ2xrX2NhbGNfY2RjbGsoaW50ZWxfc3RhdGUt
PmNkY2xrLmZvcmNlX21pbl9jZGNsayk7CisJCQljZGNsayA9IGdsa19jYWxjX2NkY2xrKHN0YXRl
LT5jZGNsay5mb3JjZV9taW5fY2RjbGspOwogCQkJdmNvID0gZ2xrX2RlX3BsbF92Y28oZGV2X3By
aXYsIGNkY2xrKTsKIAkJfSBlbHNlIHsKLQkJCWNkY2xrID0gYnh0X2NhbGNfY2RjbGsoaW50ZWxf
c3RhdGUtPmNkY2xrLmZvcmNlX21pbl9jZGNsayk7CisJCQljZGNsayA9IGJ4dF9jYWxjX2NkY2xr
KHN0YXRlLT5jZGNsay5mb3JjZV9taW5fY2RjbGspOwogCQkJdmNvID0gYnh0X2RlX3BsbF92Y28o
ZGV2X3ByaXYsIGNkY2xrKTsKIAkJfQogCi0JCWludGVsX3N0YXRlLT5jZGNsay5hY3R1YWwudmNv
ID0gdmNvOwotCQlpbnRlbF9zdGF0ZS0+Y2RjbGsuYWN0dWFsLmNkY2xrID0gY2RjbGs7Ci0JCWlu
dGVsX3N0YXRlLT5jZGNsay5hY3R1YWwudm9sdGFnZV9sZXZlbCA9CisJCXN0YXRlLT5jZGNsay5h
Y3R1YWwudmNvID0gdmNvOworCQlzdGF0ZS0+Y2RjbGsuYWN0dWFsLmNkY2xrID0gY2RjbGs7CisJ
CXN0YXRlLT5jZGNsay5hY3R1YWwudm9sdGFnZV9sZXZlbCA9CiAJCQlieHRfY2FsY192b2x0YWdl
X2xldmVsKGNkY2xrKTsKIAl9IGVsc2UgewotCQlpbnRlbF9zdGF0ZS0+Y2RjbGsuYWN0dWFsID0K
LQkJCWludGVsX3N0YXRlLT5jZGNsay5sb2dpY2FsOworCQlzdGF0ZS0+Y2RjbGsuYWN0dWFsID0g
c3RhdGUtPmNkY2xrLmxvZ2ljYWw7CiAJfQogCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQg
Y25sX21vZGVzZXRfY2FsY19jZGNsayhzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCitz
dGF0aWMgaW50IGNubF9tb2Rlc2V0X2NhbGNfY2RjbGsoc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSAqc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShzdGF0ZS0+ZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICppbnRlbF9zdGF0ZSA9
IHRvX2ludGVsX2F0b21pY19zdGF0ZShzdGF0ZSk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5kZXYpOwogCWludCBtaW5fY2RjbGssIGNk
Y2xrLCB2Y287CiAKIAltaW5fY2RjbGsgPSBpbnRlbF9jb21wdXRlX21pbl9jZGNsayhzdGF0ZSk7
CkBAIC0yNTQxLDMzICsyNTMwLDMxIEBAIHN0YXRpYyBpbnQgY25sX21vZGVzZXRfY2FsY19jZGNs
ayhzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJY2RjbGsgPSBjbmxfY2FsY19jZGNs
ayhtaW5fY2RjbGspOwogCXZjbyA9IGNubF9jZGNsa19wbGxfdmNvKGRldl9wcml2LCBjZGNsayk7
CiAKLQlpbnRlbF9zdGF0ZS0+Y2RjbGsubG9naWNhbC52Y28gPSB2Y287Ci0JaW50ZWxfc3RhdGUt
PmNkY2xrLmxvZ2ljYWwuY2RjbGsgPSBjZGNsazsKLQlpbnRlbF9zdGF0ZS0+Y2RjbGsubG9naWNh
bC52b2x0YWdlX2xldmVsID0KKwlzdGF0ZS0+Y2RjbGsubG9naWNhbC52Y28gPSB2Y287CisJc3Rh
dGUtPmNkY2xrLmxvZ2ljYWwuY2RjbGsgPSBjZGNsazsKKwlzdGF0ZS0+Y2RjbGsubG9naWNhbC52
b2x0YWdlX2xldmVsID0KIAkJbWF4KGNubF9jYWxjX3ZvbHRhZ2VfbGV2ZWwoY2RjbGspLAotCQkg
ICAgY25sX2NvbXB1dGVfbWluX3ZvbHRhZ2VfbGV2ZWwoaW50ZWxfc3RhdGUpKTsKKwkJICAgIGNu
bF9jb21wdXRlX21pbl92b2x0YWdlX2xldmVsKHN0YXRlKSk7CiAKLQlpZiAoIWludGVsX3N0YXRl
LT5hY3RpdmVfY3J0Y3MpIHsKLQkJY2RjbGsgPSBjbmxfY2FsY19jZGNsayhpbnRlbF9zdGF0ZS0+
Y2RjbGsuZm9yY2VfbWluX2NkY2xrKTsKKwlpZiAoIXN0YXRlLT5hY3RpdmVfY3J0Y3MpIHsKKwkJ
Y2RjbGsgPSBjbmxfY2FsY19jZGNsayhzdGF0ZS0+Y2RjbGsuZm9yY2VfbWluX2NkY2xrKTsKIAkJ
dmNvID0gY25sX2NkY2xrX3BsbF92Y28oZGV2X3ByaXYsIGNkY2xrKTsKIAotCQlpbnRlbF9zdGF0
ZS0+Y2RjbGsuYWN0dWFsLnZjbyA9IHZjbzsKLQkJaW50ZWxfc3RhdGUtPmNkY2xrLmFjdHVhbC5j
ZGNsayA9IGNkY2xrOwotCQlpbnRlbF9zdGF0ZS0+Y2RjbGsuYWN0dWFsLnZvbHRhZ2VfbGV2ZWwg
PQorCQlzdGF0ZS0+Y2RjbGsuYWN0dWFsLnZjbyA9IHZjbzsKKwkJc3RhdGUtPmNkY2xrLmFjdHVh
bC5jZGNsayA9IGNkY2xrOworCQlzdGF0ZS0+Y2RjbGsuYWN0dWFsLnZvbHRhZ2VfbGV2ZWwgPQog
CQkJY25sX2NhbGNfdm9sdGFnZV9sZXZlbChjZGNsayk7CiAJfSBlbHNlIHsKLQkJaW50ZWxfc3Rh
dGUtPmNkY2xrLmFjdHVhbCA9Ci0JCQlpbnRlbF9zdGF0ZS0+Y2RjbGsubG9naWNhbDsKKwkJc3Rh
dGUtPmNkY2xrLmFjdHVhbCA9IHN0YXRlLT5jZGNsay5sb2dpY2FsOwogCX0KIAogCXJldHVybiAw
OwogfQogCi1zdGF0aWMgaW50IGljbF9tb2Rlc2V0X2NhbGNfY2RjbGsoc3RydWN0IGRybV9hdG9t
aWNfc3RhdGUgKnN0YXRlKQorc3RhdGljIGludCBpY2xfbW9kZXNldF9jYWxjX2NkY2xrKHN0cnVj
dCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoc3RhdGUtPmRldik7Ci0Jc3RydWN0IGludGVsX2F0b21pY19z
dGF0ZSAqaW50ZWxfc3RhdGUgPSB0b19pbnRlbF9hdG9taWNfc3RhdGUoc3RhdGUpOwotCXVuc2ln
bmVkIGludCByZWYgPSBpbnRlbF9zdGF0ZS0+Y2RjbGsubG9naWNhbC5yZWY7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5kZXYpOworCXVu
c2lnbmVkIGludCByZWYgPSBzdGF0ZS0+Y2RjbGsubG9naWNhbC5yZWY7CiAJaW50IG1pbl9jZGNs
aywgY2RjbGssIHZjbzsKIAogCW1pbl9jZGNsayA9IGludGVsX2NvbXB1dGVfbWluX2NkY2xrKHN0
YXRlKTsKQEAgLTI1NzcsMjIgKzI1NjQsMjIgQEAgc3RhdGljIGludCBpY2xfbW9kZXNldF9jYWxj
X2NkY2xrKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKIAljZGNsayA9IGljbF9jYWxj
X2NkY2xrKG1pbl9jZGNsaywgcmVmKTsKIAl2Y28gPSBpY2xfY2FsY19jZGNsa19wbGxfdmNvKGRl
dl9wcml2LCBjZGNsayk7CiAKLQlpbnRlbF9zdGF0ZS0+Y2RjbGsubG9naWNhbC52Y28gPSB2Y287
Ci0JaW50ZWxfc3RhdGUtPmNkY2xrLmxvZ2ljYWwuY2RjbGsgPSBjZGNsazsKLQlpbnRlbF9zdGF0
ZS0+Y2RjbGsubG9naWNhbC52b2x0YWdlX2xldmVsID0KKwlzdGF0ZS0+Y2RjbGsubG9naWNhbC52
Y28gPSB2Y287CisJc3RhdGUtPmNkY2xrLmxvZ2ljYWwuY2RjbGsgPSBjZGNsazsKKwlzdGF0ZS0+
Y2RjbGsubG9naWNhbC52b2x0YWdlX2xldmVsID0KIAkJbWF4KGljbF9jYWxjX3ZvbHRhZ2VfbGV2
ZWwoY2RjbGspLAotCQkgICAgY25sX2NvbXB1dGVfbWluX3ZvbHRhZ2VfbGV2ZWwoaW50ZWxfc3Rh
dGUpKTsKKwkJICAgIGNubF9jb21wdXRlX21pbl92b2x0YWdlX2xldmVsKHN0YXRlKSk7CiAKLQlp
ZiAoIWludGVsX3N0YXRlLT5hY3RpdmVfY3J0Y3MpIHsKLQkJY2RjbGsgPSBpY2xfY2FsY19jZGNs
ayhpbnRlbF9zdGF0ZS0+Y2RjbGsuZm9yY2VfbWluX2NkY2xrLCByZWYpOworCWlmICghc3RhdGUt
PmFjdGl2ZV9jcnRjcykgeworCQljZGNsayA9IGljbF9jYWxjX2NkY2xrKHN0YXRlLT5jZGNsay5m
b3JjZV9taW5fY2RjbGssIHJlZik7CiAJCXZjbyA9IGljbF9jYWxjX2NkY2xrX3BsbF92Y28oZGV2
X3ByaXYsIGNkY2xrKTsKIAotCQlpbnRlbF9zdGF0ZS0+Y2RjbGsuYWN0dWFsLnZjbyA9IHZjbzsK
LQkJaW50ZWxfc3RhdGUtPmNkY2xrLmFjdHVhbC5jZGNsayA9IGNkY2xrOwotCQlpbnRlbF9zdGF0
ZS0+Y2RjbGsuYWN0dWFsLnZvbHRhZ2VfbGV2ZWwgPQorCQlzdGF0ZS0+Y2RjbGsuYWN0dWFsLnZj
byA9IHZjbzsKKwkJc3RhdGUtPmNkY2xrLmFjdHVhbC5jZGNsayA9IGNkY2xrOworCQlzdGF0ZS0+
Y2RjbGsuYWN0dWFsLnZvbHRhZ2VfbGV2ZWwgPQogCQkJaWNsX2NhbGNfdm9sdGFnZV9sZXZlbChj
ZGNsayk7CiAJfSBlbHNlIHsKLQkJaW50ZWxfc3RhdGUtPmNkY2xrLmFjdHVhbCA9IGludGVsX3N0
YXRlLT5jZGNsay5sb2dpY2FsOworCQlzdGF0ZS0+Y2RjbGsuYWN0dWFsID0gc3RhdGUtPmNkY2xr
LmxvZ2ljYWw7CiAJfQogCiAJcmV0dXJuIDA7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kaXNwbGF5
LmMKaW5kZXggOTBjZDFmNTFlZGE2Li4yNzNjYTg3Y2NmOGIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF9kaXNwbGF5LmMKQEAgLTEyOTUzLDcgKzEyOTUzLDcgQEAgc3RhdGljIGludCBpbnRlbF9t
b2Rlc2V0X2NoZWNrcyhzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJaWYgKGRldl9w
cml2LT5kaXNwbGF5Lm1vZGVzZXRfY2FsY19jZGNsaykgewogCQllbnVtIHBpcGUgcGlwZTsKIAot
CQlyZXQgPSBkZXZfcHJpdi0+ZGlzcGxheS5tb2Rlc2V0X2NhbGNfY2RjbGsoc3RhdGUpOworCQly
ZXQgPSBkZXZfcHJpdi0+ZGlzcGxheS5tb2Rlc2V0X2NhbGNfY2RjbGsoaW50ZWxfc3RhdGUpOwog
CQlpZiAocmV0IDwgMCkKIAkJCXJldHVybiByZXQ7CiAKLS0gCjIuMjEuMAoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlz
dApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

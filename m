Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 6D88D10EBC4
	for <lists+intel-gfx@lfdr.de>; Mon,  2 Dec 2019 15:47:20 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D46E86E1F8;
	Mon,  2 Dec 2019 14:47:18 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C09C96E1F8
 for <intel-gfx@lists.freedesktop.org>; Mon,  2 Dec 2019 14:47:17 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19429147-1500050 
 for multiple; Mon, 02 Dec 2019 14:47:02 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  2 Dec 2019 14:46:59 +0000
Message-Id: <20191202144702.2536644-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 1/4] drm/i915: Lift i915_vma_pin() out of
 intel_renderstate_emit()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

T25jZSBpbnNpZGUgYSByZXF1ZXN0LCBpbnNpZGUgdGhlIHRpbWVsaW5lLT5tdXRleCwgcGlubmlu
ZyBpcyB2ZXJib3Rlbi4KCjw0PiBbODk2LjAzMjgyOV0gPT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Cjw0PiBbODk2LjAzMjgzMV0gV0FSTklORzog
cG9zc2libGUgY2lyY3VsYXIgbG9ja2luZyBkZXBlbmRlbmN5IGRldGVjdGVkCjw0PiBbODk2LjAz
MjgzNV0gNS40LjAtcmM4LUNJLVBhdGNod29ya18xNTUzMysgIzEgVGFpbnRlZDogRyAgICAgVQo8
ND4gWzg5Ni4wMzI4MzhdIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLQo8ND4gWzg5Ni4wMzI4NDFdIGdlbV9leGVjX3BhcmFsbC8zNzIwIGlzIHRy
eWluZyB0byBhY3F1aXJlIGxvY2s6Cjw0PiBbODk2LjAzMjg0NF0gZmZmZjg4ODQwMTg2MzI3MCAo
Jmtlcm5lbCMyKXsrLisufSwgYXQ6IGk5MTVfcmVxdWVzdF9jcmVhdGUrMHgxNi8weDFjMCBbaTkx
NV0KPDQ+IFs4OTYuMDMyOTE1XQpidXQgdGFzayBpcyBhbHJlYWR5IGhvbGRpbmcgbG9jazoKPDQ+
IFs4OTYuMDMyOTE3XSBmZmZmODg4M2VjMWM5M2MwICgmdm0tPm11dGV4KXsrLisufSwgYXQ6IGk5
MTVfdm1hX3BpbisweGYzLzB4MTFjMCBbaTkxNV0KPDQ+IFs4OTYuMDMyOTUyXQp3aGljaCBsb2Nr
IGFscmVhZHkgZGVwZW5kcyBvbiB0aGUgbmV3IGxvY2suCgo8ND4gWzg5Ni4wMzI5NTRdCnRoZSBl
eGlzdGluZyBkZXBlbmRlbmN5IGNoYWluIChpbiByZXZlcnNlIG9yZGVyKSBpczoKPDQ+IFs4OTYu
MDMyOTU2XQotPiAjMSAoJnZtLT5tdXRleCl7Ky4rLn06Cjw0PiBbODk2LjAzMjk2MV0gICAgICAg
IF9fbXV0ZXhfbG9jaysweDlhLzB4OWQwCjw0PiBbODk2LjAzMjk5NV0gICAgICAgIGk5MTVfdm1h
X3BpbisweGYzLzB4MTFjMCBbaTkxNV0KPDQ+IFs4OTYuMDMzMDMzXSAgICAgICAgaW50ZWxfcmVu
ZGVyc3RhdGVfZW1pdCsweGI5LzB4OWUwIFtpOTE1XQo8ND4gWzg5Ni4wMzMwODFdICAgICAgICBp
OTE1X2dlbV9pbml0KzB4NWE5LzB4YTUwIFtpOTE1XQo8ND4gWzg5Ni4wMzMxMTJdICAgICAgICBp
OTE1X2RyaXZlcl9wcm9iZSsweGIwMC8weDE1ZjAgW2k5MTVdCjw0PiBbODk2LjAzMzE0NF0gICAg
ICAgIGk5MTVfcGNpX3Byb2JlKzB4NDMvMHgxYzAgW2k5MTVdCjw0PiBbODk2LjAzMzE0OV0gICAg
ICAgIHBjaV9kZXZpY2VfcHJvYmUrMHg5ZS8weDEyMAo8ND4gWzg5Ni4wMzMxNTRdICAgICAgICBy
ZWFsbHlfcHJvYmUrMHhlYS8weDQyMAo8ND4gWzg5Ni4wMzMxNThdICAgICAgICBkcml2ZXJfcHJv
YmVfZGV2aWNlKzB4MTBiLzB4MTIwCjw0PiBbODk2LjAzMzE2MV0gICAgICAgIGRldmljZV9kcml2
ZXJfYXR0YWNoKzB4NGEvMHg1MAo8ND4gWzg5Ni4wMzMxNjRdICAgICAgICBfX2RyaXZlcl9hdHRh
Y2grMHg5Ny8weDEzMAo8ND4gWzg5Ni4wMzMxNjhdICAgICAgICBidXNfZm9yX2VhY2hfZGV2KzB4
NzQvMHhjMAo8ND4gWzg5Ni4wMzMxNzFdICAgICAgICBidXNfYWRkX2RyaXZlcisweDE0Mi8weDIy
MAo8ND4gWzg5Ni4wMzMxNzRdICAgICAgICBkcml2ZXJfcmVnaXN0ZXIrMHg1Ni8weGYwCjw0PiBb
ODk2LjAzMzE3OF0gICAgICAgIGRvX29uZV9pbml0Y2FsbCsweDU4LzB4MmZmCjw0PiBbODk2LjAz
MzE4M10gICAgICAgIGRvX2luaXRfbW9kdWxlKzB4NTYvMHgxZjgKPDQ+IFs4OTYuMDMzMTg3XSAg
ICAgICAgbG9hZF9tb2R1bGUrMHgyNDNlLzB4MjlmMAo8ND4gWzg5Ni4wMzMxOTBdICAgICAgICBf
X2RvX3N5c19maW5pdF9tb2R1bGUrMHhlOS8weDExMAo8ND4gWzg5Ni4wMzMxOTRdICAgICAgICBk
b19zeXNjYWxsXzY0KzB4NGYvMHgyMTAKPDQ+IFs4OTYuMDMzMTk3XSAgICAgICAgZW50cnlfU1lT
Q0FMTF82NF9hZnRlcl9od2ZyYW1lKzB4NDkvMHhiZQo8ND4gWzg5Ni4wMzMyMDBdCi0+ICMwICgm
a2VybmVsIzIpeysuKy59Ogo8ND4gWzg5Ni4wMzMyMDZdICAgICAgICBfX2xvY2tfYWNxdWlyZSsw
eDEzMjgvMHgxNWQwCjw0PiBbODk2LjAzMzIwOV0gICAgICAgIGxvY2tfYWNxdWlyZSsweGE3LzB4
MWMwCjw0PiBbODk2LjAzMzIxM10gICAgICAgIF9fbXV0ZXhfbG9jaysweDlhLzB4OWQwCjw0PiBb
ODk2LjAzMzI1NV0gICAgICAgIGk5MTVfcmVxdWVzdF9jcmVhdGUrMHgxNi8weDFjMCBbaTkxNV0K
PDQ+IFs4OTYuMDMzMjg3XSAgICAgICAgaW50ZWxfZW5naW5lX2ZsdXNoX2JhcnJpZXJzKzB4NGMv
MHgxMDAgW2k5MTVdCjw0PiBbODk2LjAzMzMyN10gICAgICAgIGdndHRfZmx1c2grMHgzNy8weDYw
IFtpOTE1XQo8ND4gWzg5Ni4wMzMzNjZdICAgICAgICBpOTE1X2dlbV9ldmljdF9zb21ldGhpbmcr
MHg0NmIvMHg1YTAgW2k5MTVdCjw0PiBbODk2LjAzMzQwN10gICAgICAgIGk5MTVfZ2VtX2d0dF9p
bnNlcnQrMHgyMWQvMHg2YTAgW2k5MTVdCjw0PiBbODk2LjAzMzQ0OV0gICAgICAgIGk5MTVfdm1h
X3BpbisweGIzNi8weDExYzAgW2k5MTVdCjw0PiBbODk2LjAzMzQ4OF0gICAgICAgIGdlbjZfcHBn
dHRfcGluKzB4ZDUvMHgxNzAgW2k5MTVdCjw0PiBbODk2LjAzMzUyM10gICAgICAgIHJpbmdfY29u
dGV4dF9waW4rMHgyZS8weGMwIFtpOTE1XQo8ND4gWzg5Ni4wMzM1NTRdICAgICAgICBfX2ludGVs
X2NvbnRleHRfZG9fcGluKzB4NmIvMHgxOTAgW2k5MTVdCjw0PiBbODk2LjAzMzU5MV0gICAgICAg
IGk5MTVfZ2VtX2RvX2V4ZWNidWZmZXIrMHgxODE0LzB4MjZjMCBbaTkxNV0KPDQ+IFs4OTYuMDMz
NjI3XSAgICAgICAgaTkxNV9nZW1fZXhlY2J1ZmZlcjJfaW9jdGwrMHgxMWIvMHg0NjAgW2k5MTVd
Cjw0PiBbODk2LjAzMzYzMl0gICAgICAgIGRybV9pb2N0bF9rZXJuZWwrMHhhNy8weGYwCjw0PiBb
ODk2LjAzMzYzNV0gICAgICAgIGRybV9pb2N0bCsweDJlMS8weDM5MAo8ND4gWzg5Ni4wMzM2Mzhd
ICAgICAgICBkb192ZnNfaW9jdGwrMHhhMC8weDZmMAo8ND4gWzg5Ni4wMzM2NDFdICAgICAgICBr
c3lzX2lvY3RsKzB4MzUvMHg2MAo8ND4gWzg5Ni4wMzM2NDRdICAgICAgICBfX3g2NF9zeXNfaW9j
dGwrMHgxMS8weDIwCjw0PiBbODk2LjAzMzY0N10gICAgICAgIGRvX3N5c2NhbGxfNjQrMHg0Zi8w
eDIxMAo8ND4gWzg5Ni4wMzM2NTBdICAgICAgICBlbnRyeV9TWVNDQUxMXzY0X2FmdGVyX2h3ZnJh
bWUrMHg0OS8weGJlCgpMaWZ0IHRoZSBvYmplY3QgYWxsb2NhdGlvbiBhbmQgcGluIHByaW9yIHRv
IHRoZSByZXF1ZXN0IGNvbnN0cnVjdGlvbi4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8
Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogTWlrYSBLdW9wcGFsYSA8bWlrYS5rdW9wcGFs
YUBsaW51eC5pbnRlbC5jb20+CkNjOiBNYWFydGVuIExhbmtob3JzdCA8bWFhcnRlbi5sYW5raG9y
c3RAbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jl
bmRlcnN0YXRlLmMgfCA5NyArKysrKysrKysrKystLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX3JlbmRlcnN0YXRlLmggfCAxNyArKystCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbS5jICAgICAgICAgICAgIHwgIDggKy0KIDMgZmlsZXMgY2hhbmdlZCwgNzggaW5z
ZXJ0aW9ucygrKSwgNDQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfcmVuZGVyc3RhdGUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX3JlbmRlcnN0YXRlLmMKaW5kZXggYzRlZGMzNWU3ZDg5Li44ZDQwNDVkODNlNGMgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JlbmRlcnN0YXRlLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVuZGVyc3RhdGUuYwpAQCAtMjksMTYgKzI5
LDYgQEAKICNpbmNsdWRlICJpbnRlbF9yZW5kZXJzdGF0ZS5oIgogI2luY2x1ZGUgImludGVsX3Jp
bmcuaCIKIAotc3RydWN0IGludGVsX3JlbmRlcnN0YXRlIHsKLQljb25zdCBzdHJ1Y3QgaW50ZWxf
cmVuZGVyc3RhdGVfcm9kYXRhICpyb2RhdGE7Ci0Jc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iajsKLQlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKLQl1MzIgYmF0Y2hfb2Zmc2V0OwotCXUzMiBi
YXRjaF9zaXplOwotCXUzMiBhdXhfb2Zmc2V0OwotCXUzMiBhdXhfc2l6ZTsKLX07Ci0KIHN0YXRp
YyBjb25zdCBzdHJ1Y3QgaW50ZWxfcmVuZGVyc3RhdGVfcm9kYXRhICoKIHJlbmRlcl9zdGF0ZV9n
ZXRfcm9kYXRhKGNvbnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKQEAgLTg0
LDExICs3NCwxMSBAQCBzdGF0aWMgaW50IHJlbmRlcl9zdGF0ZV9zZXR1cChzdHJ1Y3QgaW50ZWxf
cmVuZGVyc3RhdGUgKnNvLAogCXUzMiAqZDsKIAlpbnQgcmV0OwogCi0JcmV0ID0gaTkxNV9nZW1f
b2JqZWN0X3ByZXBhcmVfd3JpdGUoc28tPm9iaiwgJm5lZWRzX2NsZmx1c2gpOworCXJldCA9IGk5
MTVfZ2VtX29iamVjdF9wcmVwYXJlX3dyaXRlKHNvLT52bWEtPm9iaiwgJm5lZWRzX2NsZmx1c2gp
OwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlkID0ga21hcF9hdG9taWMoaTkxNV9nZW1f
b2JqZWN0X2dldF9kaXJ0eV9wYWdlKHNvLT5vYmosIDApKTsKKwlkID0ga21hcF9hdG9taWMoaTkx
NV9nZW1fb2JqZWN0X2dldF9kaXJ0eV9wYWdlKHNvLT52bWEtPm9iaiwgMCkpOwogCiAJd2hpbGUg
KGkgPCByb2RhdGEtPmJhdGNoX2l0ZW1zKSB7CiAJCXUzMiBzID0gcm9kYXRhLT5iYXRjaFtpXTsK
QEAgLTE2Niw3ICsxNTYsNyBAQCBzdGF0aWMgaW50IHJlbmRlcl9zdGF0ZV9zZXR1cChzdHJ1Y3Qg
aW50ZWxfcmVuZGVyc3RhdGUgKnNvLAogCiAJcmV0ID0gMDsKIG91dDoKLQlpOTE1X2dlbV9vYmpl
Y3RfZmluaXNoX2FjY2Vzcyhzby0+b2JqKTsKKwlpOTE1X2dlbV9vYmplY3RfZmluaXNoX2FjY2Vz
cyhzby0+dm1hLT5vYmopOwogCXJldHVybiByZXQ7CiAKIGVycjoKQEAgLTE3Nyw2MSArMTY3LDg0
IEBAIHN0YXRpYyBpbnQgcmVuZGVyX3N0YXRlX3NldHVwKHN0cnVjdCBpbnRlbF9yZW5kZXJzdGF0
ZSAqc28sCiAKICN1bmRlZiBPVVRfQkFUQ0gKIAotaW50IGludGVsX3JlbmRlcnN0YXRlX2VtaXQo
c3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCitpbnQgaW50ZWxfcmVuZGVyc3RhdGVfcHJlcGFyZShz
dHJ1Y3QgaW50ZWxfcmVuZGVyc3RhdGUgKnNvLAorCQkJICAgICAgc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lKQogewotCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSA9IHJxLT5l
bmdpbmU7Ci0Jc3RydWN0IGludGVsX3JlbmRlcnN0YXRlIHNvID0ge307IC8qIGtlZXAgdGhlIGNv
bXBpbGVyIGhhcHB5ICovCisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKIAlpbnQg
ZXJyOwogCi0Jc28ucm9kYXRhID0gcmVuZGVyX3N0YXRlX2dldF9yb2RhdGEoZW5naW5lKTsKLQlp
ZiAoIXNvLnJvZGF0YSkKKwltZW1zZXQoc28sIDAsIHNpemVvZigqc28pKTsKKworCXNvLT5yb2Rh
dGEgPSByZW5kZXJfc3RhdGVfZ2V0X3JvZGF0YShlbmdpbmUpOworCWlmICghc28tPnJvZGF0YSkK
IAkJcmV0dXJuIDA7CiAKLQlpZiAoc28ucm9kYXRhLT5iYXRjaF9pdGVtcyAqIDQgPiBQQUdFX1NJ
WkUpCisJaWYgKHNvLT5yb2RhdGEtPmJhdGNoX2l0ZW1zICogNCA+IFBBR0VfU0laRSkKIAkJcmV0
dXJuIC1FSU5WQUw7CiAKLQlzby5vYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFs
KGVuZ2luZS0+aTkxNSwgUEFHRV9TSVpFKTsKLQlpZiAoSVNfRVJSKHNvLm9iaikpCi0JCXJldHVy
biBQVFJfRVJSKHNvLm9iaik7CisJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5h
bChlbmdpbmUtPmk5MTUsIFBBR0VfU0laRSk7CisJaWYgKElTX0VSUihvYmopKQorCQlyZXR1cm4g
UFRSX0VSUihvYmopOwogCi0Jc28udm1hID0gaTkxNV92bWFfaW5zdGFuY2Uoc28ub2JqLCAmZW5n
aW5lLT5ndC0+Z2d0dC0+dm0sIE5VTEwpOwotCWlmIChJU19FUlIoc28udm1hKSkgewotCQllcnIg
PSBQVFJfRVJSKHNvLnZtYSk7CisJc28tPnZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgJmVu
Z2luZS0+Z3QtPmdndHQtPnZtLCBOVUxMKTsKKwlpZiAoSVNfRVJSKHNvLT52bWEpKSB7CisJCWVy
ciA9IFBUUl9FUlIoc28tPnZtYSk7CiAJCWdvdG8gZXJyX29iajsKIAl9CiAKLQllcnIgPSBpOTE1
X3ZtYV9waW4oc28udm1hLCAwLCAwLCBQSU5fR0xPQkFMIHwgUElOX0hJR0gpOworCWVyciA9IGk5
MTVfdm1hX3Bpbihzby0+dm1hLCAwLCAwLCBQSU5fR0xPQkFMIHwgUElOX0hJR0gpOwogCWlmIChl
cnIpCiAJCWdvdG8gZXJyX3ZtYTsKIAotCWVyciA9IHJlbmRlcl9zdGF0ZV9zZXR1cCgmc28sIHJx
LT5pOTE1KTsKKwllcnIgPSByZW5kZXJfc3RhdGVfc2V0dXAoc28sIGVuZ2luZS0+aTkxNSk7CiAJ
aWYgKGVycikKIAkJZ290byBlcnJfdW5waW47CiAKKwlyZXR1cm4gMDsKKworZXJyX3VucGluOgor
CWk5MTVfdm1hX3VucGluKHNvLT52bWEpOworZXJyX3ZtYToKKwlpOTE1X3ZtYV9jbG9zZShzby0+
dm1hKTsKK2Vycl9vYmo6CisJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCXNvLT52bWEgPSBO
VUxMOworCXJldHVybiBlcnI7Cit9CisKK2ludCBpbnRlbF9yZW5kZXJzdGF0ZV9lbWl0KHN0cnVj
dCBpbnRlbF9yZW5kZXJzdGF0ZSAqc28sCisJCQkgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkK
K3sKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUgPSBycS0+ZW5naW5lOworCWludCBl
cnI7CisKKwlpZiAoIXNvLT52bWEpCisJCXJldHVybiAwOworCiAJZXJyID0gZW5naW5lLT5lbWl0
X2JiX3N0YXJ0KHJxLAotCQkJCSAgICBzby5iYXRjaF9vZmZzZXQsIHNvLmJhdGNoX3NpemUsCisJ
CQkJICAgIHNvLT5iYXRjaF9vZmZzZXQsIHNvLT5iYXRjaF9zaXplLAogCQkJCSAgICBJOTE1X0RJ
U1BBVENIX1NFQ1VSRSk7CiAJaWYgKGVycikKLQkJZ290byBlcnJfdW5waW47CisJCXJldHVybiBl
cnI7CiAKLQlpZiAoc28uYXV4X3NpemUgPiA4KSB7CisJaWYgKHNvLT5hdXhfc2l6ZSA+IDgpIHsK
IAkJZXJyID0gZW5naW5lLT5lbWl0X2JiX3N0YXJ0KHJxLAotCQkJCQkgICAgc28uYXV4X29mZnNl
dCwgc28uYXV4X3NpemUsCisJCQkJCSAgICBzby0+YXV4X29mZnNldCwgc28tPmF1eF9zaXplLAog
CQkJCQkgICAgSTkxNV9ESVNQQVRDSF9TRUNVUkUpOwogCQlpZiAoZXJyKQotCQkJZ290byBlcnJf
dW5waW47CisJCQlyZXR1cm4gZXJyOwogCX0KIAotCWk5MTVfdm1hX2xvY2soc28udm1hKTsKLQll
cnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfb2JqZWN0KHJxLCBzby52bWEtPm9iaiwgZmFsc2UpOwor
CWk5MTVfdm1hX2xvY2soc28tPnZtYSk7CisJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X29iamVj
dChycSwgc28tPnZtYS0+b2JqLCBmYWxzZSk7CiAJaWYgKGVyciA9PSAwKQotCQllcnIgPSBpOTE1
X3ZtYV9tb3ZlX3RvX2FjdGl2ZShzby52bWEsIHJxLCAwKTsKLQlpOTE1X3ZtYV91bmxvY2soc28u
dm1hKTsKLWVycl91bnBpbjoKLQlpOTE1X3ZtYV91bnBpbihzby52bWEpOwotZXJyX3ZtYToKLQlp
OTE1X3ZtYV9jbG9zZShzby52bWEpOwotZXJyX29iajoKLQlpOTE1X2dlbV9vYmplY3RfcHV0KHNv
Lm9iaik7CisJCWVyciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHNvLT52bWEsIHJxLCAwKTsK
KwlpOTE1X3ZtYV91bmxvY2soc28tPnZtYSk7CisKIAlyZXR1cm4gZXJyOwogfQorCit2b2lkIGlu
dGVsX3JlbmRlcnN0YXRlX2ZpbmlzaChzdHJ1Y3QgaW50ZWxfcmVuZGVyc3RhdGUgKnNvKQorewor
CWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZzby0+dm1hLCAwKTsKK30KZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JlbmRlcnN0YXRlLmggYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9yZW5kZXJzdGF0ZS5oCmluZGV4IDhkNTA3OTE0NTA1NC4uYzY2
MWEzY2E1NDk2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZW5k
ZXJzdGF0ZS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JlbmRlcnN0YXRl
LmgKQEAgLTI3LDYgKzI3LDggQEAKICNpbmNsdWRlIDxsaW51eC90eXBlcy5oPgogCiBzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0Oworc3RydWN0IGludGVsX2VuZ2luZV9jczsKK3N0cnVjdCBpOTE1X3ZtYTsK
IAogc3RydWN0IGludGVsX3JlbmRlcnN0YXRlX3JvZGF0YSB7CiAJY29uc3QgdTMyICpyZWxvYzsK
QEAgLTQ2LDYgKzQ4LDE5IEBAIGV4dGVybiBjb25zdCBzdHJ1Y3QgaW50ZWxfcmVuZGVyc3RhdGVf
cm9kYXRhIGdlbjdfbnVsbF9zdGF0ZTsKIGV4dGVybiBjb25zdCBzdHJ1Y3QgaW50ZWxfcmVuZGVy
c3RhdGVfcm9kYXRhIGdlbjhfbnVsbF9zdGF0ZTsKIGV4dGVybiBjb25zdCBzdHJ1Y3QgaW50ZWxf
cmVuZGVyc3RhdGVfcm9kYXRhIGdlbjlfbnVsbF9zdGF0ZTsKIAotaW50IGludGVsX3JlbmRlcnN0
YXRlX2VtaXQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpOworc3RydWN0IGludGVsX3JlbmRlcnN0
YXRlIHsKKwljb25zdCBzdHJ1Y3QgaW50ZWxfcmVuZGVyc3RhdGVfcm9kYXRhICpyb2RhdGE7CisJ
c3RydWN0IGk5MTVfdm1hICp2bWE7CisJdTMyIGJhdGNoX29mZnNldDsKKwl1MzIgYmF0Y2hfc2l6
ZTsKKwl1MzIgYXV4X29mZnNldDsKKwl1MzIgYXV4X3NpemU7Cit9OworCitpbnQgaW50ZWxfcmVu
ZGVyc3RhdGVfcHJlcGFyZShzdHJ1Y3QgaW50ZWxfcmVuZGVyc3RhdGUgKnNvLAorCQkJICAgICAg
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKK2ludCBpbnRlbF9yZW5kZXJzdGF0ZV9l
bWl0KHN0cnVjdCBpbnRlbF9yZW5kZXJzdGF0ZSAqc28sCisJCQkgICBzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycSk7Cit2b2lkIGludGVsX3JlbmRlcnN0YXRlX2ZpbmlzaChzdHJ1Y3QgaW50ZWxfcmVu
ZGVyc3RhdGUgKnNvKTsKIAogI2VuZGlmIC8qIF9JTlRFTF9SRU5ERVJTVEFURV9IXyAqLwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtLmMKaW5kZXggNjEzOTViMDM0NDNlLi4yM2ZjYzQwMzk0ZjIgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9nZW0uYwpAQCAtMTA3MSw5ICsxMDcxLDE0IEBAIHN0YXRpYyBpbnQgX19p
bnRlbF9lbmdpbmVzX3JlY29yZF9kZWZhdWx0cyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogCSAqLwog
CiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7CisJCXN0cnVjdCBpbnRlbF9yZW5k
ZXJzdGF0ZSBzbzsKIAkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCQlzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpycTsKIAorCQllcnIgPSBpbnRlbF9yZW5kZXJzdGF0ZV9wcmVwYXJlKCZzbywgZW5n
aW5lKTsKKwkJaWYgKGVycikKKwkJCWdvdG8gb3V0OworCiAJCS8qIFdlIG11c3QgYmUgYWJsZSB0
byBzd2l0Y2ggdG8gc29tZXRoaW5nISAqLwogCQlHRU1fQlVHX09OKCFlbmdpbmUtPmtlcm5lbF9j
b250ZXh0KTsKIAkJZW5naW5lLT5zZXJpYWwrKzsgLyogZm9yY2UgdGhlIGtlcm5lbCBjb250ZXh0
IHN3aXRjaCAqLwpAQCAtMTA5NiwxMyArMTEwMSwxNCBAQCBzdGF0aWMgaW50IF9faW50ZWxfZW5n
aW5lc19yZWNvcmRfZGVmYXVsdHMoc3RydWN0IGludGVsX2d0ICpndCkKIAkJaWYgKGVycikKIAkJ
CWdvdG8gZXJyX3JxOwogCi0JCWVyciA9IGludGVsX3JlbmRlcnN0YXRlX2VtaXQocnEpOworCQll
cnIgPSBpbnRlbF9yZW5kZXJzdGF0ZV9lbWl0KCZzbywgcnEpOwogCQlpZiAoZXJyKQogCQkJZ290
byBlcnJfcnE7CiAKIGVycl9ycToKIAkJcmVxdWVzdHNbaWRdID0gaTkxNV9yZXF1ZXN0X2dldChy
cSk7CiAJCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCQlpbnRlbF9yZW5kZXJzdGF0ZV9maW5pc2go
JnNvKTsKIAkJaWYgKGVycikKIAkJCWdvdG8gb3V0OwogCX0KLS0gCjIuMjQuMAoKX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcg
bGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRl
c2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

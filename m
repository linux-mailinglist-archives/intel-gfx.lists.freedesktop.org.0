Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 108CB33736
	for <lists+intel-gfx@lfdr.de>; Mon,  3 Jun 2019 19:49:52 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4F06C892C8;
	Mon,  3 Jun 2019 17:49:47 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7EC7C892AE
 for <intel-gfx@lists.freedesktop.org>; Mon,  3 Jun 2019 17:49:45 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16778861-1500050 
 for multiple; Mon, 03 Jun 2019 18:49:38 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  3 Jun 2019 18:49:30 +0100
Message-Id: <20190603174935.23982-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190603174935.23982-1-chris@chris-wilson.co.uk>
References: <20190603174935.23982-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 2/7] drm/i915: Propagate fence errors
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RXJyb3JzIHNwcmVhZCBsaWtlIHdpbGRmaXJlLCBhbmQgbXVzdCBldmVudHVhbGx5IGJlIHJldHVy
bmVkIHRvIHRoZQp1c2VyLiBUaGV5IG5lZWQgdG8gYmUgY2FwdHVyZWQgYW5kIHBhc3NlZCBhbG9u
ZyB0aGUgZmxvdyBvZiBmZW5jZXMsCmluZmVjdGluZyBlYWNoIGluIHR1cm4gd2l0aCB0aGUgZXhp
c3RpbmcgZXJyb3IsIHVudGlsIGZpbmFsbHkgdGhleSBmYWxsCm91dCBvZiBhIHVzZXIgdmlzaWJs
ZSByZXN1bHQuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNv
bi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYyAgICAgICAg
ICAgfCAgOCArKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N3X2ZlbmNlLmMgICAg
ICAgICAgfCAyMyArKysrKysrKysrKysrKystLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3N3X2ZlbmNlLmggICAgICAgICAgfCAgNyArKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9saWJfc3dfZmVuY2UuYyB8ICAxICsKIDQgZmlsZXMgY2hhbmdlZCwgMzQgaW5zZXJ0
aW9ucygrKSwgNSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3JlcXVlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCmlu
ZGV4IGRhMWU2OTg0YThjYy4uYWM4MzRiMzg3OGIzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3JlcXVlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Jl
cXVlc3QuYwpAQCAtNTY4LDYgKzU2OCwxMCBAQCBzdWJtaXRfbm90aWZ5KHN0cnVjdCBpOTE1X3N3
X2ZlbmNlICpmZW5jZSwgZW51bSBpOTE1X3N3X2ZlbmNlX25vdGlmeSBzdGF0ZSkKIAlzd2l0Y2gg
KHN0YXRlKSB7CiAJY2FzZSBGRU5DRV9DT01QTEVURToKIAkJdHJhY2VfaTkxNV9yZXF1ZXN0X3N1
Ym1pdChyZXF1ZXN0KTsKKworCQlpZiAodW5saWtlbHkoZmVuY2UtPmVycm9yKSkKKwkJCWk5MTVf
cmVxdWVzdF9za2lwKHJlcXVlc3QsIGZlbmNlLT5lcnJvcik7CisKIAkJLyoKIAkJICogV2UgbmVl
ZCB0byBzZXJpYWxpemUgdXNlIG9mIHRoZSBzdWJtaXRfcmVxdWVzdCgpIGNhbGxiYWNrCiAJCSAq
IHdpdGggaXRzIGhvdHBsdWdnaW5nIHBlcmZvcm1lZCBkdXJpbmcgYW4gZW1lcmdlbmN5CkBAIC0x
MTE3LDYgKzExMjEsOSBAQCB2b2lkIGk5MTVfcmVxdWVzdF9za2lwKHN0cnVjdCBpOTE1X3JlcXVl
c3QgKnJxLCBpbnQgZXJyb3IpCiAJR0VNX0JVR19PTighSVNfRVJSX1ZBTFVFKChsb25nKWVycm9y
KSk7CiAJZG1hX2ZlbmNlX3NldF9lcnJvcigmcnEtPmZlbmNlLCBlcnJvcik7CiAKKwlpZiAocnEt
PmluZml4ID09IHJxLT5wb3N0Zml4KQorCQlyZXR1cm47CisKIAkvKgogCSAqIEFzIHRoaXMgcmVx
dWVzdCBsaWtlbHkgZGVwZW5kcyBvbiBzdGF0ZSBmcm9tIHRoZSBsb3N0CiAJICogY29udGV4dCwg
Y2xlYXIgb3V0IGFsbCB0aGUgdXNlciBvcGVyYXRpb25zIGxlYXZpbmcgdGhlCkBAIC0xMTI4LDYg
KzExMzUsNyBAQCB2b2lkIGk5MTVfcmVxdWVzdF9za2lwKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
LCBpbnQgZXJyb3IpCiAJCWhlYWQgPSAwOwogCX0KIAltZW1zZXQodmFkZHIgKyBoZWFkLCAwLCBy
cS0+cG9zdGZpeCAtIGhlYWQpOworCXJxLT5pbmZpeCA9IHJxLT5wb3N0Zml4OwogfQogCiBzdGF0
aWMgc3RydWN0IGk5MTVfcmVxdWVzdCAqCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3N3X2ZlbmNlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N3X2ZlbmNlLmMK
aW5kZXggNTM4N2FhZmQzNDI0Li5kZWRhY2FmYzk0NDIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfc3dfZmVuY2UuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3N3X2ZlbmNlLmMKQEAgLTE1Nyw4ICsxNTcsMTEgQEAgc3RhdGljIHZvaWQgX19pOTE1X3N3X2Zl
bmNlX3dha2VfdXBfYWxsKHN0cnVjdCBpOTE1X3N3X2ZlbmNlICpmZW5jZSwKIAkJTElTVF9IRUFE
KGV4dHJhKTsKIAogCQlkbyB7Ci0JCQlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUocG9zLCBuZXh0
LCAmeC0+aGVhZCwgZW50cnkpCi0JCQkJcG9zLT5mdW5jKHBvcywgVEFTS19OT1JNQUwsIDAsICZl
eHRyYSk7CisJCQlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUocG9zLCBuZXh0LCAmeC0+aGVhZCwg
ZW50cnkpIHsKKwkJCQlwb3MtPmZ1bmMocG9zLAorCQkJCQkgIFRBU0tfTk9STUFMLCBmZW5jZS0+
ZXJyb3IsCisJCQkJCSAgJmV4dHJhKTsKKwkJCX0KIAogCQkJaWYgKGxpc3RfZW1wdHkoJmV4dHJh
KSkKIAkJCQlicmVhazsKQEAgLTIxOSw2ICsyMjIsOCBAQCB2b2lkIF9faTkxNV9zd19mZW5jZV9p
bml0KHN0cnVjdCBpOTE1X3N3X2ZlbmNlICpmZW5jZSwKIAogCV9faW5pdF93YWl0cXVldWVfaGVh
ZCgmZmVuY2UtPndhaXQsIG5hbWUsIGtleSk7CiAJYXRvbWljX3NldCgmZmVuY2UtPnBlbmRpbmcs
IDEpOworCWZlbmNlLT5lcnJvciA9IDA7CisKIAlmZW5jZS0+ZmxhZ3MgPSAodW5zaWduZWQgbG9u
ZylmbjsKIH0KIApAQCAtMjMwLDYgKzIzNSw4IEBAIHZvaWQgaTkxNV9zd19mZW5jZV9jb21taXQo
c3RydWN0IGk5MTVfc3dfZmVuY2UgKmZlbmNlKQogCiBzdGF0aWMgaW50IGk5MTVfc3dfZmVuY2Vf
d2FrZSh3YWl0X3F1ZXVlX2VudHJ5X3QgKndxLCB1bnNpZ25lZCBtb2RlLCBpbnQgZmxhZ3MsIHZv
aWQgKmtleSkKIHsKKwlpOTE1X3N3X2ZlbmNlX3NldF9lcnJvcl9vbmNlKHdxLT5wcml2YXRlLCBm
bGFncyk7CisKIAlsaXN0X2RlbCgmd3EtPmVudHJ5KTsKIAlfX2k5MTVfc3dfZmVuY2VfY29tcGxl
dGUod3EtPnByaXZhdGUsIGtleSk7CiAKQEAgLTMwMiw4ICszMDksMTAgQEAgc3RhdGljIGludCBf
X2k5MTVfc3dfZmVuY2VfYXdhaXRfc3dfZmVuY2Uoc3RydWN0IGk5MTVfc3dfZmVuY2UgKmZlbmNl
LAogCWRlYnVnX2ZlbmNlX2Fzc2VydChmZW5jZSk7CiAJbWlnaHRfc2xlZXBfaWYoZ2ZwZmxhZ3Nf
YWxsb3dfYmxvY2tpbmcoZ2ZwKSk7CiAKLQlpZiAoaTkxNV9zd19mZW5jZV9kb25lKHNpZ25hbGVy
KSkKKwlpZiAoaTkxNV9zd19mZW5jZV9kb25lKHNpZ25hbGVyKSkgeworCQlpOTE1X3N3X2ZlbmNl
X3NldF9lcnJvcl9vbmNlKGZlbmNlLCBzaWduYWxlci0+ZXJyb3IpOwogCQlyZXR1cm4gMDsKKwl9
CiAKIAlkZWJ1Z19mZW5jZV9hc3NlcnQoc2lnbmFsZXIpOwogCkBAIC0zMTksNiArMzI4LDcgQEAg
c3RhdGljIGludCBfX2k5MTVfc3dfZmVuY2VfYXdhaXRfc3dfZmVuY2Uoc3RydWN0IGk5MTVfc3df
ZmVuY2UgKmZlbmNlLAogCQkJCXJldHVybiAtRU5PTUVNOwogCiAJCQlpOTE1X3N3X2ZlbmNlX3dh
aXQoc2lnbmFsZXIpOworCQkJaTkxNV9zd19mZW5jZV9zZXRfZXJyb3Jfb25jZShmZW5jZSwgc2ln
bmFsZXItPmVycm9yKTsKIAkJCXJldHVybiAwOwogCQl9CiAKQEAgLTMzNyw3ICszNDcsNyBAQCBz
dGF0aWMgaW50IF9faTkxNV9zd19mZW5jZV9hd2FpdF9zd19mZW5jZShzdHJ1Y3QgaTkxNV9zd19m
ZW5jZSAqZmVuY2UsCiAJCV9fYWRkX3dhaXRfcXVldWVfZW50cnlfdGFpbCgmc2lnbmFsZXItPndh
aXQsIHdxKTsKIAkJcGVuZGluZyA9IDE7CiAJfSBlbHNlIHsKLQkJaTkxNV9zd19mZW5jZV93YWtl
KHdxLCAwLCAwLCBOVUxMKTsKKwkJaTkxNV9zd19mZW5jZV93YWtlKHdxLCAwLCBzaWduYWxlci0+
ZXJyb3IsIE5VTEwpOwogCQlwZW5kaW5nID0gMDsKIAl9CiAJc3Bpbl91bmxvY2tfaXJxcmVzdG9y
ZSgmc2lnbmFsZXItPndhaXQubG9jaywgZmxhZ3MpOwpAQCAtMzcyLDYgKzM4Miw3IEBAIHN0YXRp
YyB2b2lkIGRtYV9pOTE1X3N3X2ZlbmNlX3dha2Uoc3RydWN0IGRtYV9mZW5jZSAqZG1hLAogewog
CXN0cnVjdCBpOTE1X3N3X2RtYV9mZW5jZV9jYiAqY2IgPSBjb250YWluZXJfb2YoZGF0YSwgdHlw
ZW9mKCpjYiksIGJhc2UpOwogCisJaTkxNV9zd19mZW5jZV9zZXRfZXJyb3Jfb25jZShjYi0+ZmVu
Y2UsIGRtYS0+ZXJyb3IpOwogCWk5MTVfc3dfZmVuY2VfY29tcGxldGUoY2ItPmZlbmNlKTsKIAlr
ZnJlZShjYik7CiB9CkBAIC0zOTEsNiArNDAyLDcgQEAgc3RhdGljIHZvaWQgdGltZXJfaTkxNV9z
d19mZW5jZV93YWtlKHN0cnVjdCB0aW1lcl9saXN0ICp0KQogCQkgIGNiLT5kbWEtPnNlcW5vLAog
CQkgIGk5MTVfc3dfZmVuY2VfZGVidWdfaGludChmZW5jZSkpOwogCisJaTkxNV9zd19mZW5jZV9z
ZXRfZXJyb3Jfb25jZShmZW5jZSwgLUVUSU1FRE9VVCk7CiAJaTkxNV9zd19mZW5jZV9jb21wbGV0
ZShmZW5jZSk7CiB9CiAKQEAgLTQ4MCw2ICs0OTIsNyBAQCBzdGF0aWMgdm9pZCBfX2RtYV9pOTE1
X3N3X2ZlbmNlX3dha2Uoc3RydWN0IGRtYV9mZW5jZSAqZG1hLAogewogCXN0cnVjdCBpOTE1X3N3
X2RtYV9mZW5jZV9jYiAqY2IgPSBjb250YWluZXJfb2YoZGF0YSwgdHlwZW9mKCpjYiksIGJhc2Up
OwogCisJaTkxNV9zd19mZW5jZV9zZXRfZXJyb3Jfb25jZShjYi0+ZmVuY2UsIGRtYS0+ZXJyb3Ip
OwogCWk5MTVfc3dfZmVuY2VfY29tcGxldGUoY2ItPmZlbmNlKTsKIH0KIApAQCAtNTAxLDcgKzUx
NCw3IEBAIGludCBfX2k5MTVfc3dfZmVuY2VfYXdhaXRfZG1hX2ZlbmNlKHN0cnVjdCBpOTE1X3N3
X2ZlbmNlICpmZW5jZSwKIAlpZiAocmV0ID09IDApIHsKIAkJcmV0ID0gMTsKIAl9IGVsc2Ugewot
CQlpOTE1X3N3X2ZlbmNlX2NvbXBsZXRlKGZlbmNlKTsKKwkJX19kbWFfaTkxNV9zd19mZW5jZV93
YWtlKGRtYSwgJmNiLT5iYXNlKTsKIAkJaWYgKHJldCA9PSAtRU5PRU5UKSAvKiBmZW5jZSBhbHJl
YWR5IHNpZ25hbGVkICovCiAJCQlyZXQgPSAwOwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfc3dfZmVuY2UuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3df
ZmVuY2UuaAppbmRleCA5Y2I1YzNiMzA3YTYuLjUxOGNiYWFkOWJlYSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zd19mZW5jZS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfc3dfZmVuY2UuaApAQCAtMjIsNiArMjIsNyBAQCBzdHJ1Y3QgaTkxNV9zd19mZW5j
ZSB7CiAJd2FpdF9xdWV1ZV9oZWFkX3Qgd2FpdDsKIAl1bnNpZ25lZCBsb25nIGZsYWdzOwogCWF0
b21pY190IHBlbmRpbmc7CisJaW50IGVycm9yOwogfTsKIAogI2RlZmluZSBJOTE1X1NXX0ZFTkNF
X0NIRUNLRURfQklUCTAgLyogdXNlZCBpbnRlcm5hbGx5IGZvciBEQUcgY2hlY2tpbmcgKi8KQEAg
LTEwNiw0ICsxMDcsMTAgQEAgc3RhdGljIGlubGluZSB2b2lkIGk5MTVfc3dfZmVuY2Vfd2FpdChz
dHJ1Y3QgaTkxNV9zd19mZW5jZSAqZmVuY2UpCiAJd2FpdF9ldmVudChmZW5jZS0+d2FpdCwgaTkx
NV9zd19mZW5jZV9kb25lKGZlbmNlKSk7CiB9CiAKK3N0YXRpYyBpbmxpbmUgdm9pZAoraTkxNV9z
d19mZW5jZV9zZXRfZXJyb3Jfb25jZShzdHJ1Y3QgaTkxNV9zd19mZW5jZSAqZmVuY2UsIGludCBl
cnJvcikKK3sKKwljbXB4Y2hnKCZmZW5jZS0+ZXJyb3IsIDAsIGVycm9yKTsKK30KKwogI2VuZGlm
IC8qIF9JOTE1X1NXX0ZFTkNFX0hfICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvbGliX3N3X2ZlbmNlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvbGliX3N3X2ZlbmNlLmMKaW5kZXggYjk3NmMxMjgxN2M1Li4wODBiOTBiNjNkMTYgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9saWJfc3dfZmVuY2UuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbGliX3N3X2ZlbmNlLmMKQEAgLTQwLDYg
KzQwLDcgQEAgdm9pZCBfX29uc3RhY2tfZmVuY2VfaW5pdChzdHJ1Y3QgaTkxNV9zd19mZW5jZSAq
ZmVuY2UsCiAKIAlfX2luaXRfd2FpdHF1ZXVlX2hlYWQoJmZlbmNlLT53YWl0LCBuYW1lLCBrZXkp
OwogCWF0b21pY19zZXQoJmZlbmNlLT5wZW5kaW5nLCAxKTsKKwlmZW5jZS0+ZXJyb3IgPSAwOwog
CWZlbmNlLT5mbGFncyA9ICh1bnNpZ25lZCBsb25nKW5vcF9mZW5jZV9ub3RpZnk7CiB9CiAKLS0g
CjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
SW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0
dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

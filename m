Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 79969DC06C
	for <lists+intel-gfx@lfdr.de>; Fri, 18 Oct 2019 10:58:05 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0AF346E12B;
	Fri, 18 Oct 2019 08:58:03 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2716C6E093
 for <intel-gfx@lists.freedesktop.org>; Fri, 18 Oct 2019 08:58:00 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18879012-1500050 
 for multiple; Fri, 18 Oct 2019 09:57:46 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 18 Oct 2019 09:57:44 +0100
Message-Id: <20191018085744.15971-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191017080144.16899-1-chris@chris-wilson.co.uk>
References: <20191017080144.16899-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2] drm/i915/selftests: Add coverage of mocs
 registers
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UHJvYmUgdGhlIG1vY3MgcmVnaXN0ZXJzIGZvciBuZXcgY29udGV4dHMgYW5kIGFjcm9zcyBHUFUg
cmVzZXRzLiBTaW1pbGFyCnRvIGludGVsX3dvcmthcm91bmRzLCB3ZSBoYXZlIHRhYmxlcyBvZiB3
aGF0IHJlZ2lzdGVyIHZhbHVlcyB3ZSBleHBlY3QKdG8gc2VlLCBzbyB2ZXJpZnkgdGhhdCB1c2Vy
IGNvbnRleHRzIGFyZSBhZmZlY3RlZCBieSB0aGVtLiBJbiB0aGUKZnV0dXJlLCB3ZSBzaG91bGQg
YWRkIHRlc3RzIHNpbWlsYXIgdG8gaW50ZWxfc3NldSB0byBjb3ZlciBkeW5hbWljCnJlY29uZmln
dXJhdGlvbnMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNv
bi5jby51az4KQ2M6IFByYXRoYXAgS3VtYXIgVmFsc2FuIDxwcmF0aGFwLmt1bWFyLnZhbHNhbkBp
bnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbW9jcy5jICAgICAg
ICAgIHwgICA0ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X21vY3MuYyAgICAg
ICB8IDQzMSArKysrKysrKysrKysrKysrKysKIC4uLi9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9s
aXZlX3NlbGZ0ZXN0cy5oICB8ICAgMSArCiAzIGZpbGVzIGNoYW5nZWQsIDQzNiBpbnNlcnRpb25z
KCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
bW9jcy5jCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbW9jcy5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbW9jcy5jCmluZGV4IDViYWMzOTY2OTA2
Yi4uZjVhMjM5NjQwNTUzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9tb2NzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbW9jcy5jCkBAIC00
OTAsMyArNDkwLDcgQEAgdm9pZCBpbnRlbF9tb2NzX2luaXQoc3RydWN0IGludGVsX2d0ICpndCkK
IAlpZiAoSEFTX0dMT0JBTF9NT0NTX1JFR0lTVEVSUyhndC0+aTkxNSkpCiAJCWludGVsX21vY3Nf
aW5pdF9nbG9iYWwoZ3QpOwogfQorCisjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfU0VM
RlRFU1QpCisjaW5jbHVkZSAic2VsZnRlc3RfbW9jcy5jIgorI2VuZGlmCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9tb2NzLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF9tb2NzLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAw
MDAwMDAwLi5lYmIzYjg3OWU0NTAKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF9tb2NzLmMKQEAgLTAsMCArMSw0MzEgQEAKKy8qCisgKiBTUERYLUxp
Y2Vuc2UtSWRlbnRpZmllcjogTUlUCisgKgorICogQ29weXJpZ2h0IMKpIDIwMTkgSW50ZWwgQ29y
cG9yYXRpb24KKyAqLworCisjaW5jbHVkZSAiZ3QvaW50ZWxfZW5naW5lX3BtLmgiCisjaW5jbHVk
ZSAiaTkxNV9zZWxmdGVzdC5oIgorCisjaW5jbHVkZSAiZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRl
eHQuaCIKKyNpbmNsdWRlICJzZWxmdGVzdHMvaWd0X3Jlc2V0LmgiCisjaW5jbHVkZSAic2VsZnRl
c3RzL2lndF9zcGlubmVyLmgiCisKK3N0cnVjdCBsaXZlX21vY3MgeworCXN0cnVjdCBkcm1faTkx
NV9tb2NzX3RhYmxlIHRhYmxlOworCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CisJc3Ry
dWN0IGk5MTVfdm1hICpzY3JhdGNoOworCXZvaWQgKnZhZGRyOworfTsKKworc3RhdGljIGludCBy
ZXF1ZXN0X2FkZF9zeW5jKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBpbnQgZXJyKQoreworCWk5
MTVfcmVxdWVzdF9nZXQocnEpOworCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCWlmIChpOTE1X3Jl
cXVlc3Rfd2FpdChycSwgMCwgSFogLyA1KSA8IDApCisJCWVyciA9IC1FVElNRTsKKwlpOTE1X3Jl
cXVlc3RfcHV0KHJxKTsKKworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQgcmVxdWVzdF9h
ZGRfc3BpbihzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgc3RydWN0IGlndF9zcGlubmVyICpzcGlu
KQoreworCWludCBlcnIgPSAwOworCisJaTkxNV9yZXF1ZXN0X2dldChycSk7CisJaTkxNV9yZXF1
ZXN0X2FkZChycSk7CisJaWYgKHNwaW4gJiYgIWlndF93YWl0X2Zvcl9zcGlubmVyKHNwaW4sIHJx
KSkKKwkJZXJyID0gLUVUSU1FOworCWk5MTVfcmVxdWVzdF9wdXQocnEpOworCisJcmV0dXJuIGVy
cjsKK30KKworc3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqY3JlYXRlX3NjcmF0Y2goc3RydWN0IGlu
dGVsX2d0ICpndCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOworCXN0cnVj
dCBpOTE1X3ZtYSAqdm1hOworCWludCBlcnI7CisKKwlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3Jl
YXRlX2ludGVybmFsKGd0LT5pOTE1LCBQQUdFX1NJWkUpOworCWlmIChJU19FUlIob2JqKSkKKwkJ
cmV0dXJuIEVSUl9DQVNUKG9iaik7CisKKwlpOTE1X2dlbV9vYmplY3Rfc2V0X2NhY2hlX2NvaGVy
ZW5jeShvYmosIEk5MTVfQ0FDSElOR19DQUNIRUQpOworCisJdm1hID0gaTkxNV92bWFfaW5zdGFu
Y2Uob2JqLCAmZ3QtPmdndHQtPnZtLCBOVUxMKTsKKwlpZiAoSVNfRVJSKHZtYSkpIHsKKwkJaTkx
NV9nZW1fb2JqZWN0X3B1dChvYmopOworCQlyZXR1cm4gdm1hOworCX0KKworCWVyciA9IGk5MTVf
dm1hX3Bpbih2bWEsIDAsIDAsIFBJTl9HTE9CQUwpOworCWlmIChlcnIpIHsKKwkJaTkxNV9nZW1f
b2JqZWN0X3B1dChvYmopOworCQlyZXR1cm4gRVJSX1BUUihlcnIpOworCX0KKworCXJldHVybiB2
bWE7Cit9CisKK3N0YXRpYyBpbnQgbGl2ZV9tb2NzX2luaXQoc3RydWN0IGxpdmVfbW9jcyAqYXJn
LCBzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQoreworCWludCBlcnI7CisKKwlpZiAoIWdldF9tb2NzX3Nl
dHRpbmdzKGd0LT5pOTE1LCAmYXJnLT50YWJsZSkpCisJCXJldHVybiAtRUlOVkFMOworCisJYXJn
LT5jdHggPSBrZXJuZWxfY29udGV4dChndC0+aTkxNSk7CisJaWYgKCFhcmctPmN0eCkKKwkJcmV0
dXJuIC1FTk9NRU07CisKKwlhcmctPnNjcmF0Y2ggPSBjcmVhdGVfc2NyYXRjaChndCk7CisJaWYg
KElTX0VSUihhcmctPnNjcmF0Y2gpKSB7CisJCWVyciA9IFBUUl9FUlIoYXJnLT5zY3JhdGNoKTsK
KwkJZ290byBlcnJfY3R4OworCX0KKworCWFyZy0+dmFkZHIgPSBpOTE1X2dlbV9vYmplY3RfcGlu
X21hcChhcmctPnNjcmF0Y2gtPm9iaiwgSTkxNV9NQVBfV0IpOworCWlmIChJU19FUlIoYXJnLT52
YWRkcikpIHsKKwkJZXJyID0gUFRSX0VSUihhcmctPnZhZGRyKTsKKwkJZ290byBlcnJfc2NyYXRj
aDsKKwl9CisKKwlyZXR1cm4gMDsKKworZXJyX3NjcmF0Y2g6CisJaTkxNV92bWFfdW5waW5fYW5k
X3JlbGVhc2UoJmFyZy0+c2NyYXRjaCwgMCk7CitlcnJfY3R4OgorCWtlcm5lbF9jb250ZXh0X2Ns
b3NlKGFyZy0+Y3R4KTsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgdm9pZCBsaXZlX21vY3Nf
ZmluaShzdHJ1Y3QgbGl2ZV9tb2NzICphcmcpCit7CisJaTkxNV92bWFfdW5waW5fYW5kX3JlbGVh
c2UoJmFyZy0+c2NyYXRjaCwgSTkxNV9WTUFfUkVMRUFTRV9NQVApOworCWtlcm5lbF9jb250ZXh0
X2Nsb3NlKGFyZy0+Y3R4KTsKK30KKworc3RhdGljIGludCByZWFkX21vY3NfdGFibGUoc3RydWN0
IGk5MTVfcmVxdWVzdCAqcnEsCisJCQkgICBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfbW9jc190YWJs
ZSAqdGFibGUsCisJCQkgICBzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgaW50ICpvZmZzZXQpCit7CisJ
dW5zaWduZWQgaW50IGk7CisJdTMyICpjczsKKworCWNzID0gaW50ZWxfcmluZ19iZWdpbihycSwg
NCAqIHRhYmxlLT5uX2VudHJpZXMpOworCWlmIChJU19FUlIoY3MpKQorCQlyZXR1cm4gUFRSX0VS
Uihjcyk7CisKKwlmb3IgKGkgPSAwOyBpIDwgdGFibGUtPm5fZW50cmllczsgaSsrKSB7CisJCSpj
cysrID0gTUlfU1RPUkVfUkVHSVNURVJfTUVNX0dFTjggfCBNSV9VU0VfR0dUVDsKKwkJKmNzKysg
PSBpOTE1X21taW9fcmVnX29mZnNldChIQVNfR0xPQkFMX01PQ1NfUkVHSVNURVJTKHJxLT5pOTE1
KSA/CisJCQkJCSAgICAgR0VOMTJfR0xPQkFMX01PQ1MoaSkgOgorCQkJCQkgICAgIG1vY3NfcmVn
aXN0ZXIocnEtPmVuZ2luZSwgaSkpOworCQkqY3MrKyA9IGk5MTVfZ2d0dF9vZmZzZXQodm1hKSAr
IGkgKiBzaXplb2YodTMyKSArICpvZmZzZXQ7CisJCSpjcysrID0gMDsKKwl9CisKKwlpbnRlbF9y
aW5nX2FkdmFuY2UocnEsIGNzKTsKKwkqb2Zmc2V0ICs9IGkgKiBzaXplb2YodTMyKTsKKworCXJl
dHVybiAwOworfQorCitzdGF0aWMgaW50IHJlYWRfbDNjY190YWJsZShzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycSwKKwkJCSAgIGNvbnN0IHN0cnVjdCBkcm1faTkxNV9tb2NzX3RhYmxlICp0YWJsZSwK
KwkJCSAgIHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCBpbnQgKm9mZnNldCkKK3sKKwl1bnNpZ25lZCBp
bnQgaTsKKwl1MzIgKmNzOworCisJY3MgPSBpbnRlbF9yaW5nX2JlZ2luKHJxLCA0ICogdGFibGUt
Pm5fZW50cmllcyAvIDIpOworCWlmIChJU19FUlIoY3MpKQorCQlyZXR1cm4gUFRSX0VSUihjcyk7
CisKKwkvKiBYWFggY2FuJ3QgcmVhZCB0aGUgTUNSIHJhbmdlIDB4YjAwIGRpcmVjdGx5ICovCisJ
Zm9yIChpID0gMDsgaSA8IHRhYmxlLT5uX2VudHJpZXMgLyAyOyBpKyspIHsKKwkJKmNzKysgPSBN
SV9TVE9SRV9SRUdJU1RFUl9NRU1fR0VOOCB8IE1JX1VTRV9HR1RUOworCQkqY3MrKyA9IGk5MTVf
bW1pb19yZWdfb2Zmc2V0KEdFTjlfTE5DRkNNT0NTKGkpKTsKKwkJKmNzKysgPSBpOTE1X2dndHRf
b2Zmc2V0KHZtYSkgKyBpICogc2l6ZW9mKHUzMikgKyAqb2Zmc2V0OworCQkqY3MrKyA9IDA7CisJ
fQorCisJaW50ZWxfcmluZ19hZHZhbmNlKHJxLCBjcyk7CisJKm9mZnNldCArPSBpICogc2l6ZW9m
KHUzMik7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBjaGVja19tb2NzX3RhYmxlKHN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKKwkJCSAgICBjb25zdCBzdHJ1Y3QgZHJtX2k5
MTVfbW9jc190YWJsZSAqdGFibGUsCisJCQkgICAgY29uc3QgdTMyICp2YWRkciwgaW50ICpvZmZz
ZXQpCit7CisJdW5zaWduZWQgaW50IGk7CisJdTMyIGV4cGVjdDsKKworCWZvciAoaSA9IDA7IGkg
PCB0YWJsZS0+c2l6ZTsgaSsrKSB7CisJCWlmIChIQVNfR0xPQkFMX01PQ1NfUkVHSVNURVJTKGVu
Z2luZS0+aTkxNSkpCisJCQlleHBlY3QgPSB0YWJsZS0+dGFibGVbaV0uY29udHJvbF92YWx1ZTsK
KwkJZWxzZQorCQkJZXhwZWN0ID0gZ2V0X2VudHJ5X2NvbnRyb2wodGFibGUsIGkpOworCQlpZiAo
dmFkZHJbKm9mZnNldF0gIT0gZXhwZWN0KSB7CisJCQlwcl9lcnIoIiVzOiBJbnZhbGlkIE1PQ1Nb
JWRdIGVudHJ5LCBmb3VuZCAlMDh4LCBleHBlY3RlZCAlMDh4XG4iLAorCQkJICAgICAgIGVuZ2lu
ZS0+bmFtZSwgaSwgdmFkZHJbKm9mZnNldF0sIGV4cGVjdCk7CisJCQlyZXR1cm4gLUVJTlZBTDsK
KwkJfQorCQkrKypvZmZzZXQ7CisJfQorCisJLyogQWxsIHJlbWFpbmluZyBlbnRyaWVzIGFyZSBk
ZWZhdWx0ICovCisJaWYgKEhBU19HTE9CQUxfTU9DU19SRUdJU1RFUlMoZW5naW5lLT5pOTE1KSkK
KwkJZXhwZWN0ID0gdGFibGUtPnRhYmxlWzBdLmNvbnRyb2xfdmFsdWU7CisJZWxzZQorCQlleHBl
Y3QgPSB0YWJsZS0+dGFibGVbSTkxNV9NT0NTX1BURV0uY29udHJvbF92YWx1ZTsKKwlmb3IgKDsg
aSA8IHRhYmxlLT5uX2VudHJpZXM7IGkrKykgeworCQlpZiAodmFkZHJbKm9mZnNldF0gIT0gZXhw
ZWN0KSB7CisJCQlwcl9lcnIoIiVzOiBJbnZhbGlkIE1PQ1NbJWQqXSBlbnRyeSwgZm91bmQgJTA4
eCwgZXhwZWN0ZWQgJTA4eFxuIiwKKwkJCSAgICAgICBlbmdpbmUtPm5hbWUsIGksIHZhZGRyWypv
ZmZzZXRdLCBleHBlY3QpOworCQkJcmV0dXJuIC1FSU5WQUw7CisJCX0KKwkJKysqb2Zmc2V0Owor
CX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGNoZWNrX2wzY2NfdGFibGUoc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAorCQkJICAgIGNvbnN0IHN0cnVjdCBkcm1faTkxNV9t
b2NzX3RhYmxlICp0YWJsZSwKKwkJCSAgICBjb25zdCB1MzIgKnZhZGRyLCBpbnQgKm9mZnNldCkK
K3sKKwl1MTYgdW51c2VkX3ZhbHVlID0gdGFibGUtPnRhYmxlW0k5MTVfTU9DU19QVEVdLmwzY2Nf
dmFsdWU7CisJdW5zaWduZWQgaW50IGk7CisJdTMyIGV4cGVjdDsKKworCWlmICgxKSB7IC8qIFhY
WCBza2lwIE1DUiByZWFkIGJhY2sgKi8KKwkJKm9mZnNldCArPSB0YWJsZS0+bl9lbnRyaWVzIC8g
MjsKKwkJcmV0dXJuIDA7CisJfQorCisJZm9yIChpID0gMDsgaSA8IHRhYmxlLT5zaXplIC8gMjsg
aSsrKSB7CisJCXUxNiBsb3cgPSBnZXRfZW50cnlfbDNjYyh0YWJsZSwgMiAqIGkpOworCQl1MTYg
aGlnaCA9IGdldF9lbnRyeV9sM2NjKHRhYmxlLCAyICogaSArIDEpOworCisJCWV4cGVjdCA9IGwz
Y2NfY29tYmluZSh0YWJsZSwgbG93LCBoaWdoKTsKKwkJaWYgKHZhZGRyWypvZmZzZXRdICE9IGV4
cGVjdCkgeworCQkJcHJfZXJyKCIlczogSW52YWxpZCBMM0NDWyVkXSBlbnRyeSwgZm91bmQgJTA4
eCwgZXhwZWN0ZWQgJTA4eFxuIiwKKwkJCSAgICAgICBlbmdpbmUtPm5hbWUsIGksIHZhZGRyWypv
ZmZzZXRdLCBleHBlY3QpOworCQkJcmV0dXJuIC1FSU5WQUw7CisJCX0KKwkJKysqb2Zmc2V0Owor
CX0KKworCS8qIE9kZCB0YWJsZSBzaXplIC0gMSBsZWZ0IG92ZXIgKi8KKwlpZiAodGFibGUtPnNp
emUgJiAxKSB7CisJCXUxNiBsb3cgPSBnZXRfZW50cnlfbDNjYyh0YWJsZSwgMiAqIGkpOworCisJ
CWV4cGVjdCA9IGwzY2NfY29tYmluZSh0YWJsZSwgbG93LCB1bnVzZWRfdmFsdWUpOworCQlpZiAo
dmFkZHJbKm9mZnNldF0gIT0gZXhwZWN0KSB7CisJCQlwcl9lcnIoIiVzOiBJbnZhbGlkIEwzQ0Nb
JWRdIGVudHJ5LCBmb3VuZCAlMDh4LCBleHBlY3RlZCAlMDh4XG4iLAorCQkJICAgICAgIGVuZ2lu
ZS0+bmFtZSwgaSwgdmFkZHJbKm9mZnNldF0sIGV4cGVjdCk7CisJCQlyZXR1cm4gLUVJTlZBTDsK
KwkJfQorCQkrKypvZmZzZXQ7CisJCWkrKzsKKwl9CisKKwkvKiBBbGwgcmVtYWluaW5nIGVudHJp
ZXMgYXJlIGFsc28gdW51c2VkICovCisJZm9yICg7IGkgPCB0YWJsZS0+bl9lbnRyaWVzIC8gMjsg
aSsrKSB7CisJCWV4cGVjdCA9IGwzY2NfY29tYmluZSh0YWJsZSwgdW51c2VkX3ZhbHVlLCB1bnVz
ZWRfdmFsdWUpOworCQlpZiAodmFkZHJbKm9mZnNldF0gIT0gZXhwZWN0KSB7CisJCQlwcl9lcnIo
IiVzOiBJbnZhbGlkIEwzQ0NbJWRdIGVudHJ5LCBmb3VuZCAlMDh4LCBleHBlY3RlZCAlMDh4XG4i
LAorCQkJICAgICAgIGVuZ2luZS0+bmFtZSwgaSwgdmFkZHJbKm9mZnNldF0sIGV4cGVjdCk7CisJ
CQlyZXR1cm4gLUVJTlZBTDsKKwkJfQorCQkrKypvZmZzZXQ7CisJfQorCisJcmV0dXJuIDA7Cit9
CisKK3N0YXRpYyBpbnQgY2hlY2tfbW9jc19lbmdpbmUoc3RydWN0IGxpdmVfbW9jcyAqYXJnLAor
CQkJICAgICBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCit7CisJc3RydWN0IGk5MTVfdm1hICp2
bWEgPSBhcmctPnNjcmF0Y2g7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJaW50IG9mZnNl
dDsKKwlpbnQgZXJyOworCisJbWVtc2V0MzIoYXJnLT52YWRkciwgU1RBQ0tfTUFHSUMsIFBBR0Vf
U0laRSAvIHNpemVvZih1MzIpKTsKKworCXJxID0gaW50ZWxfY29udGV4dF9jcmVhdGVfcmVxdWVz
dChjZSk7CisJaWYgKElTX0VSUihycSkpCisJCXJldHVybiBQVFJfRVJSKHJxKTsKKworCWk5MTVf
dm1hX2xvY2sodm1hKTsKKwllcnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfb2JqZWN0KHJxLCB2bWEt
Pm9iaiwgdHJ1ZSk7CisJaWYgKCFlcnIpCisJCWVyciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZl
KHZtYSwgcnEsIEVYRUNfT0JKRUNUX1dSSVRFKTsKKwlpOTE1X3ZtYV91bmxvY2sodm1hKTsKKwor
CW9mZnNldCA9IDA7CisJaWYgKCFlcnIpCisJCWVyciA9IHJlYWRfbW9jc190YWJsZShycSwgJmFy
Zy0+dGFibGUsIHZtYSwgJm9mZnNldCk7CisJaWYgKCFlcnIgJiYgY2UtPmVuZ2luZS0+Y2xhc3Mg
PT0gUkVOREVSX0NMQVNTKQorCQllcnIgPSByZWFkX2wzY2NfdGFibGUocnEsICZhcmctPnRhYmxl
LCB2bWEsICZvZmZzZXQpOworCisJZXJyID0gcmVxdWVzdF9hZGRfc3luYyhycSwgZXJyKTsKKwlp
ZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJb2Zmc2V0ID0gMDsKKwlpZiAoIWVycikKKwkJZXJy
ID0gY2hlY2tfbW9jc190YWJsZShjZS0+ZW5naW5lLCAmYXJnLT50YWJsZSwKKwkJCQkgICAgICAg
YXJnLT52YWRkciwgJm9mZnNldCk7CisJaWYgKCFlcnIgJiYgY2UtPmVuZ2luZS0+Y2xhc3MgPT0g
UkVOREVSX0NMQVNTKQorCQllcnIgPSBjaGVja19sM2NjX3RhYmxlKGNlLT5lbmdpbmUsICZhcmct
PnRhYmxlLAorCQkJCSAgICAgICBhcmctPnZhZGRyLCAmb2Zmc2V0KTsKKwlpZiAoZXJyKQorCQly
ZXR1cm4gZXJyOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgbGl2ZV9tb2NzX2NsZWFu
KHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOworCXN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKmVuZ2luZTsKKwllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKKwlzdHJ1Y3Qg
bGl2ZV9tb2NzIG1vY3M7CisJaW50IGVycjsKKworCWVyciA9IGxpdmVfbW9jc19pbml0KCZtb2Nz
LCBndCk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWZvcl9lYWNoX2VuZ2luZShlbmdp
bmUsIGd0LCBpZCkgeworCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CisKKwkJY2UgPSBpbnRl
bF9jb250ZXh0X2NyZWF0ZShlbmdpbmUtPmtlcm5lbF9jb250ZXh0LT5nZW1fY29udGV4dCwKKwkJ
CQkJICBlbmdpbmUpOworCQlpZiAoSVNfRVJSKGNlKSkgeworCQkJZXJyID0gUFRSX0VSUihjZSk7
CisJCQlicmVhazsKKwkJfQorCisJCWVyciA9IGNoZWNrX21vY3NfZW5naW5lKCZtb2NzLCBjZSk7
CisJCWludGVsX2NvbnRleHRfcHV0KGNlKTsKKwkJaWYgKGVycikKKwkJCWJyZWFrOworCX0KKwor
CWxpdmVfbW9jc19maW5pKCZtb2NzKTsKKworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQg
YWN0aXZlX2VuZ2luZV9yZXNldChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCisJCQkgICAgICAg
Y29uc3QgY2hhciAqcmVhc29uKQoreworCXN0cnVjdCBpZ3Rfc3Bpbm5lciBzcGluOworCXN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxOworCWludCBlcnI7CisKKwllcnIgPSBpZ3Rfc3Bpbm5lcl9pbml0
KCZzcGluLCBjZS0+ZW5naW5lLT5ndCk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCXJx
ID0gaWd0X3NwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJnNwaW4sIGNlLCBNSV9OT09QKTsKKwlpZiAo
SVNfRVJSKHJxKSkgeworCQlpZ3Rfc3Bpbm5lcl9maW5pKCZzcGluKTsKKwkJcmV0dXJuIFBUUl9F
UlIocnEpOworCX0KKworCWVyciA9IHJlcXVlc3RfYWRkX3NwaW4ocnEsICZzcGluKTsKKwlpZiAo
ZXJyID09IDApCisJCWVyciA9IGludGVsX2VuZ2luZV9yZXNldChjZS0+ZW5naW5lLCByZWFzb24p
OworCisJaWd0X3NwaW5uZXJfZW5kKCZzcGluKTsKKwlpZ3Rfc3Bpbm5lcl9maW5pKCZzcGluKTsK
KworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQgX19saXZlX21vY3NfcmVzZXQoc3RydWN0
IGxpdmVfbW9jcyAqbW9jcywKKwkJCSAgICAgc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQorewor
CWludCBlcnI7CisKKwllcnIgPSBpbnRlbF9lbmdpbmVfcmVzZXQoY2UtPmVuZ2luZSwgIm1vY3Mi
KTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJZXJyID0gY2hlY2tfbW9jc19lbmdpbmUo
bW9jcywgY2UpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwllcnIgPSBhY3RpdmVfZW5n
aW5lX3Jlc2V0KGNlLCAibW9jcyIpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwllcnIg
PSBjaGVja19tb2NzX2VuZ2luZShtb2NzLCBjZSk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsK
KworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGxpdmVfbW9jc19yZXNldCh2b2lkICphcmcp
Cit7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmU7CisJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisJc3RydWN0IGxpdmVfbW9jcyBt
b2NzOworCWludCBlcnIgPSAwOworCisJaWYgKCFpbnRlbF9oYXNfcmVzZXRfZW5naW5lKGd0KSkK
KwkJcmV0dXJuIDA7CisKKwllcnIgPSBsaXZlX21vY3NfaW5pdCgmbW9jcywgZ3QpOworCWlmIChl
cnIpCisJCXJldHVybiBlcnI7CisKKwlpZ3RfZ2xvYmFsX3Jlc2V0X2xvY2soZ3QpOworCWZvcl9l
YWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgeworCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7
CisKKwkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUtPmtlcm5lbF9jb250ZXh0LT5n
ZW1fY29udGV4dCwKKwkJCQkJICBlbmdpbmUpOworCQlpZiAoSVNfRVJSKGNlKSkgeworCQkJZXJy
ID0gUFRSX0VSUihjZSk7CisJCQlicmVhazsKKwkJfQorCisJCWludGVsX2VuZ2luZV9wbV9nZXQo
ZW5naW5lKTsKKwkJZXJyID0gX19saXZlX21vY3NfcmVzZXQoJm1vY3MsIGNlKTsKKwkJaW50ZWxf
ZW5naW5lX3BtX2dldChlbmdpbmUpOworCisJCWludGVsX2NvbnRleHRfcHV0KGNlKTsKKwkJaWYg
KGVycikKKwkJCWJyZWFrOworCX0KKwlpZ3RfZ2xvYmFsX3Jlc2V0X3VubG9jayhndCk7CisKKwls
aXZlX21vY3NfZmluaSgmbW9jcyk7CisJcmV0dXJuIGVycjsKK30KKworaW50IGludGVsX21vY3Nf
bGl2ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCit7CisJc3RhdGlj
IGNvbnN0IHN0cnVjdCBpOTE1X3N1YnRlc3QgdGVzdHNbXSA9IHsKKwkJU1VCVEVTVChsaXZlX21v
Y3NfY2xlYW4pLAorCQlTVUJURVNUKGxpdmVfbW9jc19yZXNldCksCisJfTsKKwlzdHJ1Y3QgZHJt
X2k5MTVfbW9jc190YWJsZSB0YWJsZTsKKworCWlmICghZ2V0X21vY3Nfc2V0dGluZ3MoaTkxNSwg
JnRhYmxlKSkKKwkJcmV0dXJuIDA7CisKKwlyZXR1cm4gaW50ZWxfZ3RfbGl2ZV9zdWJ0ZXN0cyh0
ZXN0cywgJmk5MTUtPmd0KTsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9pOTE1X2xpdmVfc2VsZnRlc3RzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaTkxNV9saXZlX3NlbGZ0ZXN0cy5oCmluZGV4IDZkYWY2NTk5ZWM3OS4uMWE2YWJjZmZj
ZTgxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9saXZl
X3NlbGZ0ZXN0cy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2xp
dmVfc2VsZnRlc3RzLmgKQEAgLTE2LDYgKzE2LDcgQEAgc2VsZnRlc3QoZ3RfZW5naW5lcywgaW50
ZWxfZW5naW5lX2xpdmVfc2VsZnRlc3RzKQogc2VsZnRlc3QoZ3RfdGltZWxpbmVzLCBpbnRlbF90
aW1lbGluZV9saXZlX3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KGd0X2NvbnRleHRzLCBpbnRlbF9jb250
ZXh0X2xpdmVfc2VsZnRlc3RzKQogc2VsZnRlc3QoZ3RfbHJjLCBpbnRlbF9scmNfbGl2ZV9zZWxm
dGVzdHMpCitzZWxmdGVzdChndF9tb2NzLCBpbnRlbF9tb2NzX2xpdmVfc2VsZnRlc3RzKQogc2Vs
ZnRlc3QoZ3RfcG0sIGludGVsX2d0X3BtX2xpdmVfc2VsZnRlc3RzKQogc2VsZnRlc3QocmVxdWVz
dHMsIGk5MTVfcmVxdWVzdF9saXZlX3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KGFjdGl2ZSwgaTkxNV9h
Y3RpdmVfbGl2ZV9zZWxmdGVzdHMpCi0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

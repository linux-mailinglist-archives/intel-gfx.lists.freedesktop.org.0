Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0BBE810D633
	for <lists+intel-gfx@lfdr.de>; Fri, 29 Nov 2019 14:40:20 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 1C5FB6E905;
	Fri, 29 Nov 2019 13:40:18 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9203A6E902
 for <intel-gfx@lists.freedesktop.org>; Fri, 29 Nov 2019 13:40:13 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga004.fm.intel.com ([10.253.24.48])
 by fmsmga104.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 29 Nov 2019 05:40:13 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,257,1571727600"; d="scan'208";a="234712557"
Received: from slisovsk-lenovo-ideapad-720s-13ikb.fi.intel.com ([10.237.72.89])
 by fmsmga004.fm.intel.com with ESMTP; 29 Nov 2019 05:40:11 -0800
From: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 29 Nov 2019 15:37:07 +0200
Message-Id: <20191129133709.24397-3-stanislav.lisovskiy@intel.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191129133709.24397-1-stanislav.lisovskiy@intel.com>
References: <20191129133709.24397-1-stanislav.lisovskiy@intel.com>
Subject: [Intel-gfx] [PATCH v7 2/4] drm/i915: Move dbuf slice update to
 proper place
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q3VycmVudCBEQnVmIHNsaWNlcyB1cGRhdGUgd2Fzbid0IGRvbmUgaW4gcHJvcGVyCnBsYW5lLCBl
c3BlY2lhbGx5IGl0cyAicG9zdCIgcGFydCwgd2hpY2ggc2hvdWxkCmRpc2FibGUgdGhvc2Ugb25s
eSBvbmNlIHZibGFuayBoYWQgcGFzc2VkIGFuZAphbGwgb3RoZXIgY2hhbmdlcyBhcmUgY29tbWl0
dGVkLgoKdjI6IEZpeCB0byB1c2UgZGV2X3ByaXYgYW5kIGludGVsX2F0b21pY19zdGF0ZQogICAg
aW5zdGVhZCBvZiBza2xfZGRiX3ZhbHVlcwogICAgKHRvIGJlIG51a2VkIGluIFZpbGxlcyBwYXRj
aCkKClNpZ25lZC1vZmYtYnk6IFN0YW5pc2xhdiBMaXNvdnNraXkgPHN0YW5pc2xhdi5saXNvdnNr
aXlAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlz
cGxheS5jIHwgMzggKysrKysrKysrKysrKystLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAyOCBpbnNl
cnRpb25zKCspLCAxMCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGlzcGxheS5jCmluZGV4IGRkYTQzZTNkY2RiZi4uZGIwODMwNzQ1ZjI1IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAtMTQ2Mzcs
NiArMTQ2MzcsMjggQEAgc3RhdGljIHZvaWQgaW50ZWxfdXBkYXRlX3RyYW5zX3BvcnRfc3luY19j
cnRjcyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCQkgICAgICAgc3RhdGUpOwogfQogCitz
dGF0aWMgdm9pZCBpY2xfZGJ1Zl9zbGljZV9wcmVfdXBkYXRlKHN0cnVjdCBpbnRlbF9hdG9taWNf
c3RhdGUgKnN0YXRlKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoc3RhdGUtPmJhc2UuZGV2KTsKKwl1OCBod19lbmFibGVkX3NsaWNlcyA9IGRldl9wcml2
LT5lbmFibGVkX3NsaWNlczsKKwl1OCByZXF1aXJlZF9zbGljZXMgPSBzdGF0ZS0+ZW5hYmxlZF9z
bGljZXM7CisKKwkvKiBJZiAybmQgREJ1ZiBzbGljZSByZXF1aXJlZCwgZW5hYmxlIGl0IGhlcmUg
Ki8KKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSAmJiByZXF1aXJlZF9zbGljZXMgPiBo
d19lbmFibGVkX3NsaWNlcykKKwkJaWNsX2RidWZfc2xpY2VzX3VwZGF0ZShkZXZfcHJpdiwgcmVx
dWlyZWRfc2xpY2VzKTsKK30KKworc3RhdGljIHZvaWQgaWNsX2RidWZfc2xpY2VfcG9zdF91cGRh
dGUoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5kZXYpOworCXU4IGh3X2Vu
YWJsZWRfc2xpY2VzID0gZGV2X3ByaXYtPmVuYWJsZWRfc2xpY2VzOworCXU4IHJlcXVpcmVkX3Ns
aWNlcyA9IHN0YXRlLT5lbmFibGVkX3NsaWNlczsKKworCS8qIElmIDJuZCBEQnVmIHNsaWNlIGlz
IG5vIG1vcmUgcmVxdWlyZWQgZGlzYWJsZSBpdCAqLworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
ID49IDExICYmIHJlcXVpcmVkX3NsaWNlcyA8IGh3X2VuYWJsZWRfc2xpY2VzKQorCQlpY2xfZGJ1
Zl9zbGljZXNfdXBkYXRlKGRldl9wcml2LCByZXF1aXJlZF9zbGljZXMpOworfQorCiBzdGF0aWMg
dm9pZCBza2xfY29tbWl0X21vZGVzZXRfZW5hYmxlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
ICpzdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KHN0YXRlLT5iYXNlLmRldik7CkBAIC0xNDY0NSw4ICsxNDY2Nyw2IEBAIHN0YXRpYyB2b2lkIHNr
bF9jb21taXRfbW9kZXNldF9lbmFibGVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRl
KQogCXVuc2lnbmVkIGludCB1cGRhdGVkID0gMDsKIAlib29sIHByb2dyZXNzOwogCWludCBpOwot
CXU4IGh3X2VuYWJsZWRfc2xpY2VzID0gZGV2X3ByaXYtPmVuYWJsZWRfc2xpY2VzOwotCXU4IHJl
cXVpcmVkX3NsaWNlcyA9IHN0YXRlLT5lbmFibGVkX3NsaWNlczsKIAlzdHJ1Y3Qgc2tsX2RkYl9l
bnRyeSBlbnRyaWVzW0k5MTVfTUFYX1BJUEVTXSA9IHt9OwogCiAJZm9yX2VhY2hfb2xkbmV3X2lu
dGVsX2NydGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsIG9sZF9jcnRjX3N0YXRlLCBuZXdfY3J0Y19z
dGF0ZSwgaSkKQEAgLTE0NjU0LDEwICsxNDY3NCw2IEBAIHN0YXRpYyB2b2lkIHNrbF9jb21taXRf
bW9kZXNldF9lbmFibGVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQlpZiAo
bmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2ZSkKIAkJCWVudHJpZXNbaV0gPSBvbGRfY3J0Y19zdGF0
ZS0+d20uc2tsLmRkYjsKIAotCS8qIElmIDJuZCBEQnVmIHNsaWNlIHJlcXVpcmVkLCBlbmFibGUg
aXQgaGVyZSAqLwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExICYmIHJlcXVpcmVkX3Ns
aWNlcyA+IGh3X2VuYWJsZWRfc2xpY2VzKQotCQlpY2xfZGJ1Zl9zbGljZXNfdXBkYXRlKGRldl9w
cml2LCByZXF1aXJlZF9zbGljZXMpOwotCiAJLyoKIAkgKiBXaGVuZXZlciB0aGUgbnVtYmVyIG9m
IGFjdGl2ZSBwaXBlcyBjaGFuZ2VzLCB3ZSBuZWVkIHRvIG1ha2Ugc3VyZSB3ZQogCSAqIHVwZGF0
ZSB0aGUgcGlwZXMgaW4gdGhlIHJpZ2h0IG9yZGVyIHNvIHRoYXQgdGhlaXIgZGRiIGFsbG9jYXRp
b25zCkBAIC0xNDcxNCwxMCArMTQ3MzAsNiBAQCBzdGF0aWMgdm9pZCBza2xfY29tbWl0X21vZGVz
ZXRfZW5hYmxlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJCXByb2dyZXNz
ID0gdHJ1ZTsKIAkJfQogCX0gd2hpbGUgKHByb2dyZXNzKTsKLQotCS8qIElmIDJuZCBEQnVmIHNs
aWNlIGlzIG5vIG1vcmUgcmVxdWlyZWQgZGlzYWJsZSBpdCAqLwotCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDExICYmIHJlcXVpcmVkX3NsaWNlcyA8IGh3X2VuYWJsZWRfc2xpY2VzKQotCQlp
Y2xfZGJ1Zl9zbGljZXNfdXBkYXRlKGRldl9wcml2LCByZXF1aXJlZF9zbGljZXMpOwogfQogCiBz
dGF0aWMgdm9pZCBpbnRlbF9hdG9taWNfaGVscGVyX2ZyZWVfc3RhdGUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQpAQCAtMTQ4NDcsNiArMTQ4NTksOSBAQCBzdGF0aWMgdm9pZCBp
bnRlbF9hdG9taWNfY29tbWl0X3RhaWwoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUp
CiAJaWYgKHN0YXRlLT5tb2Rlc2V0KQogCQlpbnRlbF9lbmNvZGVyc191cGRhdGVfcHJlcGFyZShz
dGF0ZSk7CiAKKwkvKiBFbmFibGUgYWxsIG5ldyBzbGljZXMsIHdlIG1pZ2h0IG5lZWQgKi8KKwlp
Y2xfZGJ1Zl9zbGljZV9wcmVfdXBkYXRlKHN0YXRlKTsKKwogCS8qIE5vdyBlbmFibGUgdGhlIGNs
b2NrcywgcGxhbmUsIHBpcGUsIGFuZCBjb25uZWN0b3JzIHRoYXQgd2Ugc2V0IHVwLiAqLwogCWRl
dl9wcml2LT5kaXNwbGF5LmNvbW1pdF9tb2Rlc2V0X2VuYWJsZXMoc3RhdGUpOwogCkBAIC0xNDkw
Niw2ICsxNDkyMSw5IEBAIHN0YXRpYyB2b2lkIGludGVsX2F0b21pY19jb21taXRfdGFpbChzdHJ1
Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAlpZiAoc3RhdGUtPm1vZGVzZXQgJiYgaW50
ZWxfY2FuX2VuYWJsZV9zYWd2KHN0YXRlKSkKIAkJaW50ZWxfZW5hYmxlX3NhZ3YoZGV2X3ByaXYp
OwogCisJLyogRGlzYWJsZSBhbGwgc2xpY2VzLCB3ZSBkb24ndCBuZWVkICovCisJaWNsX2RidWZf
c2xpY2VfcG9zdF91cGRhdGUoc3RhdGUpOworCiAJZHJtX2F0b21pY19oZWxwZXJfY29tbWl0X2h3
X2RvbmUoJnN0YXRlLT5iYXNlKTsKIAogCWlmIChzdGF0ZS0+bW9kZXNldCkgewotLSAKMi4xNy4x
CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1n
ZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9s
aXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

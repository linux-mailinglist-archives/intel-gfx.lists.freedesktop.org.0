Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 1017E6520B
	for <lists+intel-gfx@lfdr.de>; Thu, 11 Jul 2019 08:52:47 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C265C89EBD;
	Thu, 11 Jul 2019 06:52:44 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D388A89E7C
 for <intel-gfx@lists.freedesktop.org>; Thu, 11 Jul 2019 06:52:39 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17214653-1500050 
 for multiple; Thu, 11 Jul 2019 07:52:30 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 11 Jul 2019 07:52:15 +0100
Message-Id: <20190711065215.4004-18-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190711065215.4004-1-chris@chris-wilson.co.uk>
References: <20190711065215.4004-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 18/18] drm/i915/gt: Use intel_gt as the primary
 object for handling resets
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SGF2aW5nIHRha2VuIHRoZSBmaXJzdCBzdGVwIGluIGVuY2Fwc3VsYXRpbmcgdGhlIGZ1bmN0aW9u
YWxpdHkgYnkgbW92aW5nCnRoZSByZWxhdGVkIGZpbGVzIHVuZGVyIGd0LywgdGhlIG5leHQgc3Rl
cCBpcyB0byBzdGFydCBlbmNhcHN1bGF0aW5nIGJ5CnBhc3NpbmcgYXJvdW5kIHRoZSByZWxldmFu
dCBzdHJ1Y3RzIHJhdGhlciB0aGFuIHRoZSBnbG9iYWwKZHJtX2k5MTVfcHJpdmF0ZS4gSW4gdGhp
cyBzdGVwLCB3ZSBwYXNzIGludGVsX2d0IHRvIGludGVsX3Jlc2V0LmMKClNpZ25lZC1vZmYtYnk6
IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogVHZydGtvIFVyc3Vs
aW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KQ2M6IERhbmllbGUgQ2VyYW9sbyBTcHVyaW8g
PGRhbmllbGUuY2VyYW9sb3NwdXJpb0BpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgIHwgIDIyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fY29udGV4dC5jICAgfCAgIDIgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyAgICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX21tYW4uYyAgICAgIHwgICA4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fcG0uYyAgICAgICAgfCAgMjUgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV90aHJvdHRsZS5jICB8ICAgMiArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL2h1Z2VfcGFnZXMuYyAgIHwgIDIwICstCiAuLi4vaTkxNS9nZW0vc2VsZnRlc3RzL2k5
MTVfZ2VtX2NsaWVudF9ibHQuYyAgfCAgIDQgKy0KIC4uLi9pOTE1L2dlbS9zZWxmdGVzdHMvaTkx
NV9nZW1fY29oZXJlbmN5LmMgICB8ICAgNiArLQogLi4uL2RybS9pOTE1L2dlbS9zZWxmdGVzdHMv
aTkxNV9nZW1fY29udGV4dC5jIHwgIDE3ICstCiAuLi4vZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9p
OTE1X2dlbV9tbWFuLmMgICAgfCAgIDIgKy0KIC4uLi9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9n
ZW1fb2JqZWN0X2JsdC5jICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
ZW5naW5lLmggICAgICAgIHwgICA4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9l
bmdpbmVfY3MuYyAgICAgfCAgMTYgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Vu
Z2luZV9wbS5jICAgICB8ICAgMyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3Qu
YyAgICAgICAgICAgIHwgICA3ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0Lmgg
ICAgICAgICAgICB8ICAxMiArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5j
ICAgICAgICAgfCAgMjIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVz
LmggICAgICB8ICAxMiArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9oYW5nY2hlY2su
YyAgICAgfCAgNjcgKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyAgICAg
ICAgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMgICAg
ICAgICB8IDQzNSArKysrKysrKy0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfcmVzZXQuaCAgICAgICAgIHwgIDczICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfcmVzZXRfdHlwZXMuaCAgIHwgIDUwICsrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9yaW5nYnVmZmVyLmMgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X2hhbmdjaGVjay5jICB8IDQ2MSArKysrKysrKystLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jICAgICAgICB8ICAzOCArLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Qvc2VsZnRlc3RfcmVzZXQuYyAgICAgIHwgIDkzICsrLS0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X3RpbWVsaW5lLmMgICB8ICAgMyArLQogLi4uL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jICAgIHwgIDMzICstCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2RlYnVnZnMuYyAgICAgICAgICAgfCAgNjMgKy0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2Rydi5jICAgICAgICAgICAgICAgfCAgIDUgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZHJ2LmggICAgICAgICAgICAgICB8ICAzNSArLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW0uYyAgICAgICAgICAgICAgIHwgIDMxICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dwdV9lcnJvci5oICAgICAgICAgfCAgNTIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfcmVxdWVzdC5jICAgICAgICAgICB8ICAgNSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9zZWxmdGVzdC5oICAgICAgICAgIHwgICA5ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2lu
dGVsX2d1Y19zdWJtaXNzaW9uLmMgICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfdWMuYyAgICAgICAgICAgICAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaTkxNV9hY3RpdmUuYyAgfCAgIDMgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9pOTE1X2dlbS5jICAgICB8ICAgMyArLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aTkxNV9nZW1fZXZpY3QuYyAgIHwgICAzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaTkxNV9yZXF1ZXN0LmMgfCAgIDQgKy0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5
MTVfc2VsZnRlc3QuYyAgICB8ICAyMyArLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0
X2ZsdXNoX3Rlc3QuYyAgIHwgICA1ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aWd0X3Jlc2V0LmMgICAgfCAgMzggKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
Z3RfcmVzZXQuaCAgICB8ICAxMCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2ln
dF93ZWRnZV9tZS5oIHwgIDU4IC0tLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19n
ZW1fZGV2aWNlLmMgIHwgICA1IC0KIDQ5IGZpbGVzIGNoYW5nZWQsIDg5NyBpbnNlcnRpb25zKCsp
LCA5MTAgZGVsZXRpb25zKC0pCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfcmVzZXRfdHlwZXMuaAogZGVsZXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3Rfd2VkZ2VfbWUuaAoKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggZWQzNTMyZTRjOGFkLi43MzZhNzgxZWEz
MDIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxh
eS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBA
IC00Mjc1LDEyICs0Mjc1LDEzIEBAIHZvaWQgaW50ZWxfcHJlcGFyZV9yZXNldChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCXJldHVybjsKIAogCS8qIFdlIGhhdmUgYSBtb2Rl
c2V0IHZzIHJlc2V0IGRlYWRsb2NrLCBkZWZlbnNpdmVseSB1bmJyZWFrIGl0LiAqLwotCXNldF9i
aXQoSTkxNV9SRVNFVF9NT0RFU0VULCAmZGV2X3ByaXYtPmdwdV9lcnJvci5mbGFncyk7Ci0Jd2Fr
ZV91cF9hbGwoJmRldl9wcml2LT5ncHVfZXJyb3Iud2FpdF9xdWV1ZSk7CisJc2V0X2JpdChJOTE1
X1JFU0VUX01PREVTRVQsICZkZXZfcHJpdi0+Z3QucmVzZXQuZmxhZ3MpOworCXNtcF9tYl9fYWZ0
ZXJfYXRvbWljKCk7CisJd2FrZV91cF9iaXQoJmRldl9wcml2LT5ndC5yZXNldC5mbGFncywgSTkx
NV9SRVNFVF9NT0RFU0VUKTsKIAogCWlmIChhdG9taWNfcmVhZCgmZGV2X3ByaXYtPmdwdV9lcnJv
ci5wZW5kaW5nX2ZiX3BpbikpIHsKIAkJRFJNX0RFQlVHX0tNUygiTW9kZXNldCBwb3RlbnRpYWxs
eSBzdHVjaywgdW5icmVha2luZyB0aHJvdWdoIHdlZGdpbmdcbiIpOwotCQlpOTE1X2dlbV9zZXRf
d2VkZ2VkKGRldl9wcml2KTsKKwkJaW50ZWxfZ3Rfc2V0X3dlZGdlZCgmZGV2X3ByaXYtPmd0KTsK
IAl9CiAKIAkvKgpAQCAtNDMyNiw3ICs0MzI3LDcgQEAgdm9pZCBpbnRlbF9maW5pc2hfcmVzZXQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCWludCByZXQ7CiAKIAkvKiByZXNl
dCBkb2Vzbid0IHRvdWNoIHRoZSBkaXNwbGF5ICovCi0JaWYgKCF0ZXN0X2JpdChJOTE1X1JFU0VU
X01PREVTRVQsICZkZXZfcHJpdi0+Z3B1X2Vycm9yLmZsYWdzKSkKKwlpZiAoIXRlc3RfYml0KEk5
MTVfUkVTRVRfTU9ERVNFVCwgJmRldl9wcml2LT5ndC5yZXNldC5mbGFncykpCiAJCXJldHVybjsK
IAogCXN0YXRlID0gZmV0Y2hfYW5kX3plcm8oJmRldl9wcml2LT5tb2Rlc2V0X3Jlc3RvcmVfc3Rh
dGUpOwpAQCAtNDM2Niw3ICs0MzY3LDcgQEAgdm9pZCBpbnRlbF9maW5pc2hfcmVzZXQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCWRybV9tb2Rlc2V0X2FjcXVpcmVfZmluaShj
dHgpOwogCW11dGV4X3VubG9jaygmZGV2LT5tb2RlX2NvbmZpZy5tdXRleCk7CiAKLQljbGVhcl9i
aXQoSTkxNV9SRVNFVF9NT0RFU0VULCAmZGV2X3ByaXYtPmdwdV9lcnJvci5mbGFncyk7CisJY2xl
YXJfYml0X3VubG9jayhJOTE1X1JFU0VUX01PREVTRVQsICZkZXZfcHJpdi0+Z3QucmVzZXQuZmxh
Z3MpOwogfQogCiBzdGF0aWMgdm9pZCBpY2xfc2V0X3BpcGVfY2hpY2tlbihzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YykKQEAgLTEzODYxLDE4ICsxMzg2MiwyMSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9h
dG9taWNfY29tbWl0X2ZlbmNlX3dhaXQoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqaW50ZWxf
c3RhdAogCWZvciAoOzspIHsKIAkJcHJlcGFyZV90b193YWl0KCZpbnRlbF9zdGF0ZS0+Y29tbWl0
X3JlYWR5LndhaXQsCiAJCQkJJndhaXRfZmVuY2UsIFRBU0tfVU5JTlRFUlJVUFRJQkxFKTsKLQkJ
cHJlcGFyZV90b193YWl0KCZkZXZfcHJpdi0+Z3B1X2Vycm9yLndhaXRfcXVldWUsCisJCXByZXBh
cmVfdG9fd2FpdChiaXRfd2FpdHF1ZXVlKCZkZXZfcHJpdi0+Z3QucmVzZXQuZmxhZ3MsCisJCQkJ
CSAgICAgIEk5MTVfUkVTRVRfTU9ERVNFVCksCiAJCQkJJndhaXRfcmVzZXQsIFRBU0tfVU5JTlRF
UlJVUFRJQkxFKTsKIAogCi0JCWlmIChpOTE1X3N3X2ZlbmNlX2RvbmUoJmludGVsX3N0YXRlLT5j
b21taXRfcmVhZHkpCi0JCSAgICB8fCB0ZXN0X2JpdChJOTE1X1JFU0VUX01PREVTRVQsICZkZXZf
cHJpdi0+Z3B1X2Vycm9yLmZsYWdzKSkKKwkJaWYgKGk5MTVfc3dfZmVuY2VfZG9uZSgmaW50ZWxf
c3RhdGUtPmNvbW1pdF9yZWFkeSkgfHwKKwkJICAgIHRlc3RfYml0KEk5MTVfUkVTRVRfTU9ERVNF
VCwgJmRldl9wcml2LT5ndC5yZXNldC5mbGFncykpCiAJCQlicmVhazsKIAogCQlzY2hlZHVsZSgp
OwogCX0KIAlmaW5pc2hfd2FpdCgmaW50ZWxfc3RhdGUtPmNvbW1pdF9yZWFkeS53YWl0LCAmd2Fp
dF9mZW5jZSk7Ci0JZmluaXNoX3dhaXQoJmRldl9wcml2LT5ncHVfZXJyb3Iud2FpdF9xdWV1ZSwg
JndhaXRfcmVzZXQpOworCWZpbmlzaF93YWl0KGJpdF93YWl0cXVldWUoJmRldl9wcml2LT5ndC5y
ZXNldC5mbGFncywKKwkJCQkgIEk5MTVfUkVTRVRfTU9ERVNFVCksCisJCSAgICAmd2FpdF9yZXNl
dCk7CiB9CiAKIHN0YXRpYyB2b2lkIGludGVsX2F0b21pY19jbGVhbnVwX3dvcmsoc3RydWN0IHdv
cmtfc3RydWN0ICp3b3JrKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250
ZXh0LmMKaW5kZXggOWQ0YmE2OTI4ODg0Li5jZWE1Njg4NGNmZDIgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwpAQCAtMjEzNCw3ICsyMTM0LDcgQEAgaW50
IGk5MTVfZ2VtX2NvbnRleHRfY3JlYXRlX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZv
aWQgKmRhdGEsCiAJaWYgKGFyZ3MtPmZsYWdzICYgSTkxNV9DT05URVhUX0NSRUFURV9GTEFHU19V
TktOT1dOKQogCQlyZXR1cm4gLUVJTlZBTDsKIAotCXJldCA9IGk5MTVfdGVybWluYWxseV93ZWRn
ZWQoaTkxNSk7CisJcmV0ID0gaW50ZWxfZ3RfdGVybWluYWxseV93ZWRnZWQoJmk5MTUtPmd0KTsK
IAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX2V4ZWNidWZmZXIuYwppbmRleCAwZWEyZDQ5YmM4YjkuLjM1MDZhYWZhZGE2YyAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCkBA
IC0yMTQ4LDcgKzIxNDgsNyBAQCBzdGF0aWMgaW50IF9fZWJfcGluX2VuZ2luZShzdHJ1Y3QgaTkx
NV9leGVjYnVmZmVyICplYiwgc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogCSAqIEFCSTogQmVm
b3JlIHVzZXJzcGFjZSBhY2Nlc3NlcyB0aGUgR1BVIChlLmcuIGV4ZWNidWZmZXIpLCByZXBvcnQK
IAkgKiBFSU8gaWYgdGhlIEdQVSBpcyBhbHJlYWR5IHdlZGdlZC4KIAkgKi8KLQllcnIgPSBpOTE1
X3Rlcm1pbmFsbHlfd2VkZ2VkKGViLT5pOTE1KTsKKwllcnIgPSBpbnRlbF9ndF90ZXJtaW5hbGx5
X3dlZGdlZChjZS0+ZW5naW5lLT5ndCk7CiAJaWYgKGVycikKIAkJcmV0dXJuIGVycjsKIApkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMKaW5kZXggYmNjNTNjMmI0ZjY5Li43
MWQxMGFlOTA5MjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9tbWFuLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYwpA
QCAtNyw2ICs3LDggQEAKICNpbmNsdWRlIDxsaW51eC9tbWFuLmg+CiAjaW5jbHVkZSA8bGludXgv
c2l6ZXMuaD4KIAorI2luY2x1ZGUgImd0L2ludGVsX2d0LmgiCisKICNpbmNsdWRlICJpOTE1X2Ry
di5oIgogI2luY2x1ZGUgImk5MTVfZ2VtX2d0dC5oIgogI2luY2x1ZGUgImk5MTVfZ2VtX2lvY3Rs
cy5oIgpAQCAtMjQzLDcgKzI0NSw3IEBAIHZtX2ZhdWx0X3QgaTkxNV9nZW1fZmF1bHQoc3RydWN0
IHZtX2ZhdWx0ICp2bWYpCiAKIAl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQocnBtKTsK
IAotCXNyY3UgPSBpOTE1X3Jlc2V0X3RyeWxvY2soaTkxNSk7CisJc3JjdSA9IGludGVsX2d0X3Jl
c2V0X3RyeWxvY2soZ2d0dC0+dm0uZ3QpOwogCWlmIChzcmN1IDwgMCkgewogCQlyZXQgPSBzcmN1
OwogCQlnb3RvIGVycl9ycG07CkBAIC0zMjIsNyArMzI0LDcgQEAgdm1fZmF1bHRfdCBpOTE1X2dl
bV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikKIGVycl91bmxvY2s6CiAJbXV0ZXhfdW5sb2Nr
KCZkZXYtPnN0cnVjdF9tdXRleCk7CiBlcnJfcmVzZXQ6Ci0JaTkxNV9yZXNldF91bmxvY2soaTkx
NSwgc3JjdSk7CisJaW50ZWxfZ3RfcmVzZXRfdW5sb2NrKGdndHQtPnZtLmd0LCBzcmN1KTsKIGVy
cl9ycG06CiAJaW50ZWxfcnVudGltZV9wbV9wdXQocnBtLCB3YWtlcmVmKTsKIAlpOTE1X2dlbV9v
YmplY3RfdW5waW5fcGFnZXMob2JqKTsKQEAgLTMzNSw3ICszMzcsNyBAQCB2bV9mYXVsdF90IGk5
MTVfZ2VtX2ZhdWx0KHN0cnVjdCB2bV9mYXVsdCAqdm1mKQogCQkgKiBmYWlsKS4gQnV0IGFueSBv
dGhlciAtRUlPIGlzbid0IG91cnMgKGUuZy4gc3dhcCBpbiBmYWlsdXJlKQogCQkgKiBhbmQgc28g
bmVlZHMgdG8gYmUgcmVwb3J0ZWQuCiAJCSAqLwotCQlpZiAoIWk5MTVfdGVybWluYWxseV93ZWRn
ZWQoaTkxNSkpCisJCWlmICghaW50ZWxfZ3RfaXNfd2VkZ2VkKGdndHQtPnZtLmd0KSkKIAkJCXJl
dHVybiBWTV9GQVVMVF9TSUdCVVM7CiAJCS8qIGVsc2U6IGZhbGwgdGhyb3VnaCAqLwogCWNhc2Ug
LUVBR0FJTjoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9w
bS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKaW5kZXggYmYwODVi
MGNiN2M2Li44ZTJlZWFlYzA2Y2IgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9w
bS5jCkBAIC01LDYgKzUsNyBAQAogICovCiAKICNpbmNsdWRlICJnZW0vaTkxNV9nZW1fcG0uaCIK
KyNpbmNsdWRlICJndC9pbnRlbF9ndC5oIgogI2luY2x1ZGUgImd0L2ludGVsX2d0X3BtLmgiCiAK
ICNpbmNsdWRlICJpOTE1X2Rydi5oIgpAQCAtMTAzLDE4ICsxMDQsMTggQEAgc3RhdGljIGludCBw
bV9ub3RpZmllcihzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sgKm5iLAogCXJldHVybiBOT1RJRllfT0s7
CiB9CiAKLXN0YXRpYyBib29sIHN3aXRjaF90b19rZXJuZWxfY29udGV4dF9zeW5jKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQorc3RhdGljIGJvb2wgc3dpdGNoX3RvX2tlcm5lbF9jb250
ZXh0X3N5bmMoc3RydWN0IGludGVsX2d0ICpndCkKIHsKLQlib29sIHJlc3VsdCA9ICFpOTE1X3Rl
cm1pbmFsbHlfd2VkZ2VkKGk5MTUpOworCWJvb2wgcmVzdWx0ID0gIWludGVsX2d0X2lzX3dlZGdl
ZChndCk7CiAKIAlkbyB7Ci0JCWlmIChpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGk5MTUsCisJCWlm
IChpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGd0LT5pOTE1LAogCQkJCQkgICBJOTE1X1dBSVRfTE9D
S0VEIHwKIAkJCQkJICAgSTkxNV9XQUlUX0ZPUl9JRExFX0JPT1NULAogCQkJCQkgICBJOTE1X0dF
TV9JRExFX1RJTUVPVVQpID09IC1FVElNRSkgewogCQkJLyogWFhYIGhpZGUgd2FybmluZyBmcm9t
IGdlbV9laW8gKi8KIAkJCWlmIChpOTE1X21vZHBhcmFtcy5yZXNldCkgewotCQkJCWRldl9lcnIo
aTkxNS0+ZHJtLmRldiwKKwkJCQlkZXZfZXJyKGd0LT5pOTE1LT5kcm0uZGV2LAogCQkJCQkiRmFp
bGVkIHRvIGlkbGUgZW5naW5lcywgZGVjbGFyaW5nIHdlZGdlZCFcbiIpOwogCQkJCUdFTV9UUkFD
RV9EVU1QKCk7CiAJCQl9CkBAIC0xMjMsMTggKzEyNCwxOCBAQCBzdGF0aWMgYm9vbCBzd2l0Y2hf
dG9fa2VybmVsX2NvbnRleHRfc3luYyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkJ
CSAqIEZvcmNpYmx5IGNhbmNlbCBvdXRzdGFuZGluZyB3b3JrIGFuZCBsZWF2ZQogCQkJICogdGhl
IGdwdSBxdWlldC4KIAkJCSAqLwotCQkJaTkxNV9nZW1fc2V0X3dlZGdlZChpOTE1KTsKKwkJCWlu
dGVsX2d0X3NldF93ZWRnZWQoZ3QpOwogCQkJcmVzdWx0ID0gZmFsc2U7CiAJCX0KLQl9IHdoaWxl
IChpOTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1KSAmJiByZXN1bHQpOworCX0gd2hpbGUgKGk5MTVf
cmV0aXJlX3JlcXVlc3RzKGd0LT5pOTE1KSAmJiByZXN1bHQpOwogCi0JR0VNX0JVR19PTihpOTE1
LT5ndC5hd2FrZSk7CisJR0VNX0JVR19PTihndC0+YXdha2UpOwogCXJldHVybiByZXN1bHQ7CiB9
CiAKIGJvb2wgaTkxNV9nZW1fbG9hZF9wb3dlcl9jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQogewotCXJldHVybiBzd2l0Y2hfdG9fa2VybmVsX2NvbnRleHRfc3luYyhpOTE1
KTsKKwlyZXR1cm4gc3dpdGNoX3RvX2tlcm5lbF9jb250ZXh0X3N5bmMoJmk5MTUtPmd0KTsKIH0K
IAogdm9pZCBpOTE1X2dlbV9zdXNwZW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQpA
QCAtMTU1LDcgKzE1Niw3IEBAIHZvaWQgaTkxNV9nZW1fc3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIAkgKiBzdGF0ZS4gRm9ydHVuYXRlbHksIHRoZSBrZXJuZWxfY29udGV4
dCBpcyBkaXNwb3NhYmxlIGFuZCB3ZSBkbwogCSAqIG5vdCByZWx5IG9uIGl0cyBzdGF0ZS4KIAkg
Ki8KLQlzd2l0Y2hfdG9fa2VybmVsX2NvbnRleHRfc3luYyhpOTE1KTsKKwlzd2l0Y2hfdG9fa2Vy
bmVsX2NvbnRleHRfc3luYygmaTkxNS0+Z3QpOwogCiAJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIApAQCAtMTY2LDcgKzE2Nyw3IEBAIHZvaWQgaTkxNV9nZW1fc3VzcGVu
ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAlHRU1fQlVHX09OKGk5MTUtPmd0LmF3
YWtlKTsKIAlmbHVzaF93b3JrKCZpOTE1LT5nZW0uaWRsZV93b3JrKTsKIAotCWNhbmNlbF9kZWxh
eWVkX3dvcmtfc3luYygmaTkxNS0+Z3B1X2Vycm9yLmhhbmdjaGVja193b3JrKTsKKwljYW5jZWxf
ZGVsYXllZF93b3JrX3N5bmMoJmk5MTUtPmd0LmhhbmdjaGVjay53b3JrKTsKIAogCWk5MTVfZ2Vt
X2RyYWluX2ZyZWVkX29iamVjdHMoaTkxNSk7CiAKQEAgLTI3NCwxMCArMjc1LDEwIEBAIHZvaWQg
aTkxNV9nZW1fcmVzdW1lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCXJldHVybjsK
IAogZXJyX3dlZGdlZDoKLQlpZiAoIWk5MTVfcmVzZXRfZmFpbGVkKGk5MTUpKSB7CisJaWYgKCFp
bnRlbF9ndF9pc193ZWRnZWQoJmk5MTUtPmd0KSkgewogCQlkZXZfZXJyKGk5MTUtPmRybS5kZXYs
CiAJCQkiRmFpbGVkIHRvIHJlLWluaXRpYWxpemUgR1BVLCBkZWNsYXJpbmcgaXQgd2VkZ2VkIVxu
Iik7Ci0JCWk5MTVfZ2VtX3NldF93ZWRnZWQoaTkxNSk7CisJCWludGVsX2d0X3NldF93ZWRnZWQo
Jmk5MTUtPmd0KTsKIAl9CiAJZ290byBvdXRfdW5sb2NrOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Rocm90dGxlLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fdGhyb3R0bGUuYwppbmRleCBhZGIzMDc0ZDljZTIuLjFlMzcyNDIw
NzcxYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Rocm90
dGxlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Rocm90dGxlLmMK
QEAgLTQxLDcgKzQxLDcgQEAgaTkxNV9nZW1fdGhyb3R0bGVfaW9jdGwoc3RydWN0IGRybV9kZXZp
Y2UgKmRldiwgdm9pZCAqZGF0YSwKIAlsb25nIHJldDsKIAogCS8qIEFCSTogcmV0dXJuIC1FSU8g
aWYgYWxyZWFkeSB3ZWRnZWQgKi8KLQlyZXQgPSBpOTE1X3Rlcm1pbmFsbHlfd2VkZ2VkKHRvX2k5
MTUoZGV2KSk7CisJcmV0ID0gaW50ZWxfZ3RfdGVybWluYWxseV93ZWRnZWQoJnRvX2k5MTUoZGV2
KS0+Z3QpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMKaW5kZXggODZlZWQ0YzNhZTJiLi42Y2Jk
NGE2NjhjOWEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMv
aHVnZV9wYWdlcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVn
ZV9wYWdlcy5jCkBAIC0xNzUzLDcgKzE3NTMsNyBAQCBpbnQgaTkxNV9nZW1faHVnZV9wYWdlX21v
Y2tfc2VsZnRlc3RzKHZvaWQpCiAJcmV0dXJuIGVycjsKIH0KIAotaW50IGk5MTVfZ2VtX2h1Z2Vf
cGFnZV9saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitp
bnQgaTkxNV9nZW1faHVnZV9wYWdlX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQogewogCXN0YXRpYyBjb25zdCBzdHJ1Y3QgaTkxNV9zdWJ0ZXN0IHRlc3RzW10g
PSB7CiAJCVNVQlRFU1QoaWd0X3Nocmlua190aHApLApAQCAtMTc2OCwyMiArMTc2OCwyMiBAQCBp
bnQgaTkxNV9nZW1faHVnZV9wYWdlX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAlpbnQgZXJyOwogCi0J
aWYgKCFIQVNfUFBHVFQoZGV2X3ByaXYpKSB7CisJaWYgKCFIQVNfUFBHVFQoaTkxNSkpIHsKIAkJ
cHJfaW5mbygiUFBHVFQgbm90IHN1cHBvcnRlZCwgc2tpcHBpbmcgbGl2ZS1zZWxmdGVzdHNcbiIp
OwogCQlyZXR1cm4gMDsKIAl9CiAKLQlpZiAoaTkxNV90ZXJtaW5hbGx5X3dlZGdlZChkZXZfcHJp
dikpCisJaWYgKGludGVsX2d0X2lzX3dlZGdlZCgmaTkxNS0+Z3QpKQogCQlyZXR1cm4gMDsKIAot
CWZpbGUgPSBtb2NrX2ZpbGUoZGV2X3ByaXYpOworCWZpbGUgPSBtb2NrX2ZpbGUoaTkxNSk7CiAJ
aWYgKElTX0VSUihmaWxlKSkKIAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAKLQltdXRleF9sb2Nr
KCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVf
cG1fZ2V0KCZkZXZfcHJpdi0+cnVudGltZV9wbSk7CisJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CisJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50
aW1lX3BtKTsKIAotCWN0eCA9IGxpdmVfY29udGV4dChkZXZfcHJpdiwgZmlsZSk7CisJY3R4ID0g
bGl2ZV9jb250ZXh0KGk5MTUsIGZpbGUpOwogCWlmIChJU19FUlIoY3R4KSkgewogCQllcnIgPSBQ
VFJfRVJSKGN0eCk7CiAJCWdvdG8gb3V0X3VubG9jazsKQEAgLTE3OTUsMTAgKzE3OTUsMTAgQEAg
aW50IGk5MTVfZ2VtX2h1Z2VfcGFnZV9saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCiAJZXJyID0gaTkxNV9zdWJ0ZXN0cyh0ZXN0cywgY3R4KTsKIAogb3V0
X3VubG9jazoKLQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0sIHdh
a2VyZWYpOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWlu
dGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKKwltdXRleF91
bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCi0JbW9ja19maWxlX2ZyZWUoZGV2X3By
aXYsIGZpbGUpOworCW1vY2tfZmlsZV9mcmVlKGk5MTUsIGZpbGUpOwogCiAJcmV0dXJuIGVycjsK
IH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9n
ZW1fY2xpZW50X2JsdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1
X2dlbV9jbGllbnRfYmx0LmMKaW5kZXggZmE3OTIzMzA5M2ViLi4yNzVjMjg5MjYwNjcgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY2xpZW50
X2JsdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1f
Y2xpZW50X2JsdC5jCkBAIC01LDYgKzUsOCBAQAogCiAjaW5jbHVkZSAiaTkxNV9zZWxmdGVzdC5o
IgogCisjaW5jbHVkZSAiZ3QvaW50ZWxfZ3QuaCIKKwogI2luY2x1ZGUgInNlbGZ0ZXN0cy9pZ3Rf
Zmx1c2hfdGVzdC5oIgogI2luY2x1ZGUgInNlbGZ0ZXN0cy9tb2NrX2RybS5oIgogI2luY2x1ZGUg
Im1vY2tfY29udGV4dC5oIgpAQCAtMTAxLDcgKzEwMyw3IEBAIGludCBpOTE1X2dlbV9jbGllbnRf
Ymx0X2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCQlTVUJU
RVNUKGlndF9jbGllbnRfZmlsbCksCiAJfTsKIAotCWlmIChpOTE1X3Rlcm1pbmFsbHlfd2VkZ2Vk
KGk5MTUpKQorCWlmIChpbnRlbF9ndF9pc193ZWRnZWQoJmk5MTUtPmd0KSkKIAkJcmV0dXJuIDA7
CiAKIAlpZiAoIUhBU19FTkdJTkUoaTkxNSwgQkNTMCkpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvaGVyZW5jeS5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb2hlcmVuY3kuYwppbmRleCA4NjFm
MzJiZTdkNDYuLmExYTRiNTNjZGM0YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb2hlcmVuY3kuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvaGVyZW5jeS5jCkBAIC02LDYgKzYsOCBAQAog
CiAjaW5jbHVkZSA8bGludXgvcHJpbWVfbnVtYmVycy5oPgogCisjaW5jbHVkZSAiZ3QvaW50ZWxf
Z3QuaCIKKwogI2luY2x1ZGUgImk5MTVfc2VsZnRlc3QuaCIKICNpbmNsdWRlICJzZWxmdGVzdHMv
aTkxNV9yYW5kb20uaCIKIApAQCAtMjQyLDEyICsyNDQsMTIgQEAgc3RhdGljIGJvb2wgYWx3YXlz
X3ZhbGlkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCiBzdGF0aWMgYm9vbCBuZWVk
c19mZW5jZV9yZWdpc3RlcnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JcmV0
dXJuICFpOTE1X3Rlcm1pbmFsbHlfd2VkZ2VkKGk5MTUpOworCXJldHVybiAhaW50ZWxfZ3RfaXNf
d2VkZ2VkKCZpOTE1LT5ndCk7CiB9CiAKIHN0YXRpYyBib29sIG5lZWRzX21pX3N0b3JlX2R3b3Jk
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCWlmIChpOTE1X3Rlcm1pbmFsbHlf
d2VkZ2VkKGk5MTUpKQorCWlmIChpbnRlbF9ndF9pc193ZWRnZWQoJmk5MTUtPmd0KSkKIAkJcmV0
dXJuIGZhbHNlOwogCiAJaWYgKCFIQVNfRU5HSU5FKGk5MTUsIFJDUzApKQpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYwppbmRl
eCA2OTViZmIxOGIwZDQuLmRiNzg1NmYwZjMxZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKQEAgLTcsNiArNyw3IEBA
CiAjaW5jbHVkZSA8bGludXgvcHJpbWVfbnVtYmVycy5oPgogCiAjaW5jbHVkZSAiZ2VtL2k5MTVf
Z2VtX3BtLmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfZ3QuaCIKICNpbmNsdWRlICJndC9pbnRlbF9y
ZXNldC5oIgogI2luY2x1ZGUgImk5MTVfc2VsZnRlc3QuaCIKIApAQCAtODMsNyArODQsNyBAQCBz
dGF0aWMgaW50IGxpdmVfbm9wX3N3aXRjaCh2b2lkICphcmcpCiAJCX0KIAkJaWYgKGk5MTVfcmVx
dWVzdF93YWl0KHJxLCAwLCBIWiAvIDUpIDwgMCkgewogCQkJcHJfZXJyKCJGYWlsZWQgdG8gcG9w
dWxhdGVkICVkIGNvbnRleHRzXG4iLCBuY3R4KTsKLQkJCWk5MTVfZ2VtX3NldF93ZWRnZWQoaTkx
NSk7CisJCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZpOTE1LT5ndCk7CiAJCQllcnIgPSAtRUlPOwog
CQkJZ290byBvdXRfdW5sb2NrOwogCQl9CkBAIC0xMjcsNyArMTI4LDcgQEAgc3RhdGljIGludCBs
aXZlX25vcF9zd2l0Y2godm9pZCAqYXJnKQogCQkJaWYgKGk5MTVfcmVxdWVzdF93YWl0KHJxLCAw
LCBIWiAvIDUpIDwgMCkgewogCQkJCXByX2VycigiU3dpdGNoaW5nIGJldHdlZW4gJWxkIGNvbnRl
eHRzIHRpbWVkIG91dFxuIiwKIAkJCQkgICAgICAgcHJpbWUpOwotCQkJCWk5MTVfZ2VtX3NldF93
ZWRnZWQoaTkxNSk7CisJCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZCgmaTkxNS0+Z3QpOwogCQkJCWJy
ZWFrOwogCQkJfQogCkBAIC05NTYsNyArOTU3LDcgQEAgX19zc2V1X2ZpbmlzaChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlpbnQgcmV0ID0gMDsKIAogCWlmIChmbGFncyAmIFRFU1Rf
UkVTRVQpIHsKLQkJcmV0ID0gaTkxNV9yZXNldF9lbmdpbmUoY2UtPmVuZ2luZSwgInNzZXUiKTsK
KwkJcmV0ID0gaW50ZWxfZW5naW5lX3Jlc2V0KGNlLT5lbmdpbmUsICJzc2V1Iik7CiAJCWlmIChy
ZXQpCiAJCQlnb3RvIG91dDsKIAl9CkBAIC0xMDU5LDcgKzEwNjAsNyBAQCBfX2lndF9jdHhfc3Nl
dShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7
CiAKIAlpZiAoZmxhZ3MgJiBURVNUX1JFU0VUKQotCQlpZ3RfZ2xvYmFsX3Jlc2V0X2xvY2soaTkx
NSk7CisJCWlndF9nbG9iYWxfcmVzZXRfbG9jaygmaTkxNS0+Z3QpOwogCiAJbXV0ZXhfbG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKQEAgLTExMjAsNyArMTEyMSw3IEBAIF9faWd0X2N0
eF9zc2V1KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCW11dGV4X3VubG9jaygmaTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlpZiAoZmxhZ3MgJiBURVNUX1JFU0VUKQotCQlpZ3Rf
Z2xvYmFsX3Jlc2V0X3VubG9jayhpOTE1KTsKKwkJaWd0X2dsb2JhbF9yZXNldF91bmxvY2soJmk5
MTUtPmd0KTsKIAogCW1vY2tfZmlsZV9mcmVlKGk5MTUsIGZpbGUpOwogCkBAIC0xNzIyLDcgKzE3
MjMsNyBAQCBpbnQgaTkxNV9nZW1fY29udGV4dF9tb2NrX3NlbGZ0ZXN0cyh2b2lkKQogCXJldHVy
biBlcnI7CiB9CiAKLWludCBpOTE1X2dlbV9jb250ZXh0X2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK2ludCBpOTE1X2dlbV9jb250ZXh0X2xpdmVfc2Vs
ZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0YXRpYyBjb25zdCBz
dHJ1Y3QgaTkxNV9zdWJ0ZXN0IHRlc3RzW10gPSB7CiAJCVNVQlRFU1QobGl2ZV9ub3Bfc3dpdGNo
KSwKQEAgLTE3MzMsOCArMTczNCw4IEBAIGludCBpOTE1X2dlbV9jb250ZXh0X2xpdmVfc2VsZnRl
c3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJU1VCVEVTVChpZ3Rfdm1f
aXNvbGF0aW9uKSwKIAl9OwogCi0JaWYgKGk5MTVfdGVybWluYWxseV93ZWRnZWQoZGV2X3ByaXYp
KQorCWlmIChpbnRlbF9ndF9pc193ZWRnZWQoJmk5MTUtPmd0KSkKIAkJcmV0dXJuIDA7CiAKLQly
ZXR1cm4gaTkxNV9saXZlX3N1YnRlc3RzKHRlc3RzLCBkZXZfcHJpdik7CisJcmV0dXJuIGk5MTVf
bGl2ZV9zdWJ0ZXN0cyh0ZXN0cywgaTkxNSk7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jCmluZGV4IDU2MzVjYmI0YWYyMi4uMDE4
NTdjMTJmMTJmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3Rz
L2k5MTVfZ2VtX21tYW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3Rz
L2k5MTVfZ2VtX21tYW4uYwpAQCAtNDc4LDcgKzQ3OCw3IEBAIHN0YXRpYyBpbnQgaWd0X21tYXBf
b2Zmc2V0X2V4aGF1c3Rpb24odm9pZCAqYXJnKQogCiAJLyogTm93IGZpbGwgd2l0aCBidXN5IGRl
YWQgb2JqZWN0cyB0aGF0IHdlIGV4cGVjdCB0byByZWFwICovCiAJZm9yIChsb29wID0gMDsgbG9v
cCA8IDM7IGxvb3ArKykgewotCQlpZiAoaTkxNV90ZXJtaW5hbGx5X3dlZGdlZChpOTE1KSkKKwkJ
aWYgKGludGVsX2d0X2lzX3dlZGdlZCgmaTkxNS0+Z3QpKQogCQkJYnJlYWs7CiAKIAkJb2JqID0g
aTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChpOTE1LCBQQUdFX1NJWkUpOwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmplY3Rf
Ymx0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVj
dF9ibHQuYwppbmRleCAxMWQzNzIzOGM2MmMuLjE5ODQzYWNjODRkMyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmplY3RfYmx0LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmplY3RfYmx0
LmMKQEAgLTMsNiArMyw4IEBACiAgKiBDb3B5cmlnaHQgwqkgMjAxOSBJbnRlbCBDb3Jwb3JhdGlv
bgogICovCiAKKyNpbmNsdWRlICJndC9pbnRlbF9ndC5oIgorCiAjaW5jbHVkZSAiaTkxNV9zZWxm
dGVzdC5oIgogCiAjaW5jbHVkZSAic2VsZnRlc3RzL2lndF9mbHVzaF90ZXN0LmgiCkBAIC05NSw3
ICs5Nyw3IEBAIGludCBpOTE1X2dlbV9vYmplY3RfYmx0X2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogCQlTVUJURVNUKGlndF9maWxsX2JsdCksCiAJfTsKIAot
CWlmIChpOTE1X3Rlcm1pbmFsbHlfd2VkZ2VkKGk5MTUpKQorCWlmIChpbnRlbF9ndF9pc193ZWRn
ZWQoJmk5MTUtPmd0KSkKIAkJcmV0dXJuIDA7CiAKIAlpZiAoIUhBU19FTkdJTkUoaTkxNSwgQkNT
MCkpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmUuaCBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZS5oCmluZGV4IGZhYWExNjQyNjdm
NC4uYTRkYjRkZDIyYjRmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9lbmdpbmUuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmUuaApA
QCAtNDEwLDggKzQxMCw4IEBAIGdlbjhfZW1pdF9nZ3R0X3dyaXRlKHUzMiAqY3MsIHUzMiB2YWx1
ZSwgdTMyIGd0dF9vZmZzZXQsIHUzMiBmbGFncykKIAlyZXR1cm4gY3M7CiB9CiAKLXN0YXRpYyBp
bmxpbmUgdm9pZCBpbnRlbF9lbmdpbmVfcmVzZXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lLAotCQkJCSAgICAgIGJvb2wgc3RhbGxlZCkKK3N0YXRpYyBpbmxpbmUgdm9pZCBfX2ludGVs
X2VuZ2luZV9yZXNldChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCisJCQkJCWJvb2wg
c3RhbGxlZCkKIHsKIAlpZiAoZW5naW5lLT5yZXNldC5yZXNldCkKIAkJZW5naW5lLT5yZXNldC5y
ZXNldChlbmdpbmUsIHN0YWxsZWQpOwpAQCAtNDE5LDkgKzQxOSw5IEBAIHN0YXRpYyBpbmxpbmUg
dm9pZCBpbnRlbF9lbmdpbmVfcmVzZXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAog
fQogCiBib29sIGludGVsX2VuZ2luZV9pc19pZGxlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSk7Ci1ib29sIGludGVsX2VuZ2luZXNfYXJlX2lkbGUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KTsKK2Jvb2wgaW50ZWxfZW5naW5lc19hcmVfaWRsZShzdHJ1Y3QgaW50ZWxf
Z3QgKmd0KTsKIAotdm9pZCBpbnRlbF9lbmdpbmVzX3Jlc2V0X2RlZmF1bHRfc3VibWlzc2lvbihz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGludGVsX2VuZ2luZXNfcmVzZXRf
ZGVmYXVsdF9zdWJtaXNzaW9uKHN0cnVjdCBpbnRlbF9ndCAqZ3QpOwogdW5zaWduZWQgaW50IGlu
dGVsX2VuZ2luZXNfaGFzX2NvbnRleHRfaXNvbGF0aW9uKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KTsKIAogYm9vbCBpbnRlbF9lbmdpbmVfY2FuX3N0b3JlX2R3b3JkKHN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKmVuZ2luZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9lbmdpbmVfY3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2lu
ZV9jcy5jCmluZGV4IGUzZWRmNDc0YzM3Ny4uZWU5ZjlhMGNlYzE5IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYwpAQCAtMTE0Nyw3ICsxMTQ3LDcgQEAgc3RhdGlj
IGJvb2wgcmluZ19pc19pZGxlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIGJvb2wg
aW50ZWxfZW5naW5lX2lzX2lkbGUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewog
CS8qIE1vcmUgd2hpdGUgbGllcywgaWYgd2VkZ2VkLCBodyBzdGF0ZSBpcyBpbmNvbnNpc3RlbnQg
Ki8KLQlpZiAoaTkxNV9yZXNldF9mYWlsZWQoZW5naW5lLT5pOTE1KSkKKwlpZiAoaW50ZWxfZ3Rf
aXNfd2VkZ2VkKGVuZ2luZS0+Z3QpKQogCQlyZXR1cm4gdHJ1ZTsKIAogCWlmICghaW50ZWxfZW5n
aW5lX3BtX2lzX2F3YWtlKGVuZ2luZSkpCkBAIC0xMTgzLDcgKzExODMsNyBAQCBib29sIGludGVs
X2VuZ2luZV9pc19pZGxlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAlyZXR1cm4g
cmluZ19pc19pZGxlKGVuZ2luZSk7CiB9CiAKLWJvb2wgaW50ZWxfZW5naW5lc19hcmVfaWRsZShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK2Jvb2wgaW50ZWxfZW5naW5lc19hcmVfaWRs
ZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogewogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZTsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKQEAgLTExOTIsMTQgKzExOTIsMTQgQEAgYm9v
bCBpbnRlbF9lbmdpbmVzX2FyZV9pZGxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
CSAqIElmIHRoZSBkcml2ZXIgaXMgd2VkZ2VkLCBIVyBzdGF0ZSBtYXkgYmUgdmVyeSBpbmNvbnNp
c3RlbnQgYW5kCiAJICogcmVwb3J0IHRoYXQgaXQgaXMgc3RpbGwgYnVzeSwgZXZlbiB0aG91Z2gg
d2UgaGF2ZSBzdG9wcGVkIHVzaW5nIGl0LgogCSAqLwotCWlmIChpOTE1X3Jlc2V0X2ZhaWxlZChp
OTE1KSkKKwlpZiAoaW50ZWxfZ3RfaXNfd2VkZ2VkKGd0KSkKIAkJcmV0dXJuIHRydWU7CiAKIAkv
KiBBbHJlYWR5IHBhcmtlZCAoYW5kIHBhc3NlZCBhbiBpZGxlbmVzcyB0ZXN0KTsgbXVzdCBzdGls
bCBiZSBpZGxlICovCi0JaWYgKCFSRUFEX09OQ0UoaTkxNS0+Z3QuYXdha2UpKQorCWlmICghUkVB
RF9PTkNFKGd0LT5hd2FrZSkpCiAJCXJldHVybiB0cnVlOwogCi0JZm9yX2VhY2hfZW5naW5lKGVu
Z2luZSwgaTkxNSwgaWQpIHsKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndC0+aTkxNSwgaWQp
IHsKIAkJaWYgKCFpbnRlbF9lbmdpbmVfaXNfaWRsZShlbmdpbmUpKQogCQkJcmV0dXJuIGZhbHNl
OwogCX0KQEAgLTEyMDcsMTIgKzEyMDcsMTIgQEAgYm9vbCBpbnRlbF9lbmdpbmVzX2FyZV9pZGxl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCXJldHVybiB0cnVlOwogfQogCi12b2lk
IGludGVsX2VuZ2luZXNfcmVzZXRfZGVmYXVsdF9zdWJtaXNzaW9uKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQordm9pZCBpbnRlbF9lbmdpbmVzX3Jlc2V0X2RlZmF1bHRfc3VibWlzc2lv
bihzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogewogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZTsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKIAotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUs
IGk5MTUsIGlkKQorCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LT5pOTE1LCBpZCkKIAkJZW5n
aW5lLT5zZXRfZGVmYXVsdF9zdWJtaXNzaW9uKGVuZ2luZSk7CiB9CiAKQEAgLTE0OTAsNyArMTQ5
MCw3IEBAIHZvaWQgaW50ZWxfZW5naW5lX2R1bXAoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lLAogCQl2YV9lbmQoYXApOwogCX0KIAotCWlmIChpOTE1X3Jlc2V0X2ZhaWxlZChlbmdpbmUt
Pmk5MTUpKQorCWlmIChpbnRlbF9ndF9pc193ZWRnZWQoZW5naW5lLT5ndCkpCiAJCWRybV9wcmlu
dGYobSwgIioqKiBXRURHRUQgKioqXG4iKTsKIAogCWRybV9wcmludGYobSwgIlx0QXdha2U/ICVk
XG4iLCBhdG9taWNfcmVhZCgmZW5naW5lLT53YWtlcmVmLmNvdW50KSk7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jCmluZGV4IDM0Mzc2ZDMzZTRjYS4uMTIxOGI3ZDUz
Yjg4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0u
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYwpAQCAtOSw2
ICs5LDcgQEAKICNpbmNsdWRlICJpbnRlbF9lbmdpbmUuaCIKICNpbmNsdWRlICJpbnRlbF9lbmdp
bmVfcG9vbC5oIgogI2luY2x1ZGUgImludGVsX2VuZ2luZV9wbS5oIgorI2luY2x1ZGUgImludGVs
X2d0LmgiCiAjaW5jbHVkZSAiaW50ZWxfZ3RfcG0uaCIKIAogc3RhdGljIGludCBfX2VuZ2luZV91
bnBhcmsoc3RydWN0IGludGVsX3dha2VyZWYgKndmKQpAQCAtNzcsNyArNzgsNyBAQCBzdGF0aWMg
Ym9vbCBzd2l0Y2hfdG9fa2VybmVsX2NvbnRleHQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lKQogCQlyZXR1cm4gdHJ1ZTsKIAogCS8qIEdQVSBpcyBwb2ludGluZyB0byB0aGUgdm9pZCwg
YXMgZ29vZCBhcyBpbiB0aGUga2VybmVsIGNvbnRleHQuICovCi0JaWYgKGk5MTVfcmVzZXRfZmFp
bGVkKGVuZ2luZS0+aTkxNSkpCisJaWYgKGludGVsX2d0X2lzX3dlZGdlZChlbmdpbmUtPmd0KSkK
IAkJcmV0dXJuIHRydWU7CiAKIAkvKgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZ3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0LmMKaW5kZXgg
NDZkMjRkOWQ2MmFjLi45MGVkNzkyODVmZjggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2d0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3Qu
YwpAQCAtMTgsNiArMTgsOCBAQCB2b2lkIGludGVsX2d0X2luaXRfZWFybHkoc3RydWN0IGludGVs
X2d0ICpndCwgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAKIAlzcGluX2xvY2tfaW5p
dCgmZ3QtPmNsb3NlZF9sb2NrKTsKIAorCWludGVsX2d0X2luaXRfaGFuZ2NoZWNrKGd0KTsKKwlp
bnRlbF9ndF9pbml0X3Jlc2V0KGd0KTsKIAlpbnRlbF9ndF9wbV9pbml0X2Vhcmx5KGd0KTsKIH0K
IApAQCAtMjQwLDMgKzI0Miw4IEBAIHZvaWQgaW50ZWxfZ3RfZmluaV9zY3JhdGNoKHN0cnVjdCBp
bnRlbF9ndCAqZ3QpCiB7CiAJaTkxNV92bWFfdW5waW5fYW5kX3JlbGVhc2UoJmd0LT5zY3JhdGNo
LCAwKTsKIH0KKwordm9pZCBpbnRlbF9ndF9jbGVhbnVwX2Vhcmx5KHN0cnVjdCBpbnRlbF9ndCAq
Z3QpCit7CisJaW50ZWxfZ3RfZmluaV9yZXNldChndCk7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfZ3QuaAppbmRleCAxMDkzZGNmMzZmNjMuLjQ5YzAwODUzODVhMCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9ndC5oCkBAIC04LDEyICs4LDE1IEBACiAKICNpbmNsdWRlICJpbnRlbF9lbmdp
bmVfdHlwZXMuaCIKICNpbmNsdWRlICJpbnRlbF9ndF90eXBlcy5oIgorI2luY2x1ZGUgImludGVs
X3Jlc2V0LmgiCiAKIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlOwogCiB2b2lkIGludGVsX2d0X2lu
aXRfZWFybHkoc3RydWN0IGludGVsX2d0ICpndCwgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpOwogdm9pZCBpbnRlbF9ndF9pbml0X2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KTsKIAordm9pZCBpbnRlbF9ndF9jbGVhbnVwX2Vhcmx5KHN0cnVjdCBpbnRlbF9ndCAqZ3QpOwor
CiB2b2lkIGludGVsX2d0X2NoZWNrX2FuZF9jbGVhcl9mYXVsdHMoc3RydWN0IGludGVsX2d0ICpn
dCk7CiB2b2lkIGludGVsX2d0X2NsZWFyX2Vycm9yX3JlZ2lzdGVycyhzdHJ1Y3QgaW50ZWxfZ3Qg
Kmd0LAogCQkJCSAgICBpbnRlbF9lbmdpbmVfbWFza190IGVuZ2luZV9tYXNrKTsKQEAgLTIxLDYg
KzI0LDggQEAgdm9pZCBpbnRlbF9ndF9jbGVhcl9lcnJvcl9yZWdpc3RlcnMoc3RydWN0IGludGVs
X2d0ICpndCwKIHZvaWQgaW50ZWxfZ3RfZmx1c2hfZ2d0dF93cml0ZXMoc3RydWN0IGludGVsX2d0
ICpndCk7CiB2b2lkIGludGVsX2d0X2NoaXBzZXRfZmx1c2goc3RydWN0IGludGVsX2d0ICpndCk7
CiAKK3ZvaWQgaW50ZWxfZ3RfaW5pdF9oYW5nY2hlY2soc3RydWN0IGludGVsX2d0ICpndCk7CisK
IGludCBpbnRlbF9ndF9pbml0X3NjcmF0Y2goc3RydWN0IGludGVsX2d0ICpndCwgdW5zaWduZWQg
aW50IHNpemUpOwogdm9pZCBpbnRlbF9ndF9maW5pX3NjcmF0Y2goc3RydWN0IGludGVsX2d0ICpn
dCk7CiAKQEAgLTMwLDQgKzM1LDExIEBAIHN0YXRpYyBpbmxpbmUgdTMyIGludGVsX2d0X3NjcmF0
Y2hfb2Zmc2V0KGNvbnN0IHN0cnVjdCBpbnRlbF9ndCAqZ3QsCiAJcmV0dXJuIGk5MTVfZ2d0dF9v
ZmZzZXQoZ3QtPnNjcmF0Y2gpICsgZmllbGQ7CiB9CiAKK3N0YXRpYyBpbmxpbmUgYm9vbCBpbnRl
bF9ndF9pc193ZWRnZWQoc3RydWN0IGludGVsX2d0ICpndCkKK3sKKwlyZXR1cm4gX19pbnRlbF9y
ZXNldF9mYWlsZWQoJmd0LT5yZXNldCk7Cit9CisKK3ZvaWQgaW50ZWxfZ3RfcXVldWVfaGFuZ2No
ZWNrKHN0cnVjdCBpbnRlbF9ndCAqZ3QpOworCiAjZW5kaWYgLyogX19JTlRFTF9HVF9IX18gKi8K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5jCmluZGV4IDM2YmE4MGU2YTBiNy4uMTAx
M2JhMGY0OTg0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9w
bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmMKQEAgLTUsNyAr
NSw5IEBACiAgKi8KIAogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCisjaW5jbHVkZSAiaTkxNV9wYXJh
bXMuaCIKICNpbmNsdWRlICJpbnRlbF9lbmdpbmVfcG0uaCIKKyNpbmNsdWRlICJpbnRlbF9ndC5o
IgogI2luY2x1ZGUgImludGVsX2d0X3BtLmgiCiAjaW5jbHVkZSAiaW50ZWxfcG0uaCIKICNpbmNs
dWRlICJpbnRlbF93YWtlcmVmLmgiCkBAIC0xNyw4ICsxOSw4IEBAIHN0YXRpYyB2b2lkIHBtX25v
dGlmeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgaW50IHN0YXRlKQogCiBzdGF0aWMg
aW50IGludGVsX2d0X3VucGFyayhzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiB7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPQotCQljb250YWluZXJfb2Yod2YsIHR5cGVvZigqaTkx
NSksIGd0Lndha2VyZWYpOworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBjb250YWluZXJfb2Yod2Ys
IHR5cGVvZigqZ3QpLCB3YWtlcmVmKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IGd0LT5pOTE1OwogCiAJR0VNX1RSQUNFKCJcbiIpOwogCkBAIC0zMyw4ICszNSw4IEBAIHN0YXRp
YyBpbnQgaW50ZWxfZ3RfdW5wYXJrKHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZikKIAkgKiBXb3Jr
IGFyb3VuZCBpdCBieSBncmFiYmluZyBhIEdUIElSUSBwb3dlciBkb21haW4gd2hpbHN0IHRoZXJl
IGlzIGFueQogCSAqIEdUIGFjdGl2aXR5LCBwcmV2ZW50aW5nIGFueSBEQyBzdGF0ZSB0cmFuc2l0
aW9ucy4KIAkgKi8KLQlpOTE1LT5ndC5hd2FrZSA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0KGk5
MTUsIFBPV0VSX0RPTUFJTl9HVF9JUlEpOwotCUdFTV9CVUdfT04oIWk5MTUtPmd0LmF3YWtlKTsK
KwlndC0+YXdha2UgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldChpOTE1LCBQT1dFUl9ET01BSU5f
R1RfSVJRKTsKKwlHRU1fQlVHX09OKCFndC0+YXdha2UpOwogCiAJaW50ZWxfZW5hYmxlX2d0X3Bv
d2Vyc2F2ZShpOTE1KTsKIApAQCAtNDQsNyArNDYsNyBAQCBzdGF0aWMgaW50IGludGVsX2d0X3Vu
cGFyayhzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiAKIAlpOTE1X3BtdV9ndF91bnBhcmtlZChp
OTE1KTsKIAotCWk5MTVfcXVldWVfaGFuZ2NoZWNrKGk5MTUpOworCWludGVsX2d0X3F1ZXVlX2hh
bmdjaGVjayhndCk7CiAKIAlwbV9ub3RpZnkoaTkxNSwgSU5URUxfR1RfVU5QQVJLKTsKIApAQCAt
OTEsMTIgKzkzLDEyIEBAIHZvaWQgaW50ZWxfZ3RfcG1faW5pdF9lYXJseShzdHJ1Y3QgaW50ZWxf
Z3QgKmd0KQogCUJMT0NLSU5HX0lOSVRfTk9USUZJRVJfSEVBRCgmZ3QtPnBtX25vdGlmaWNhdGlv
bnMpOwogfQogCi1zdGF0aWMgYm9vbCByZXNldF9lbmdpbmVzKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQorc3RhdGljIGJvb2wgcmVzZXRfZW5naW5lcyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0
KQogewotCWlmIChJTlRFTF9JTkZPKGk5MTUpLT5ncHVfcmVzZXRfY2xvYmJlcnNfZGlzcGxheSkK
KwlpZiAoSU5URUxfSU5GTyhndC0+aTkxNSktPmdwdV9yZXNldF9jbG9iYmVyc19kaXNwbGF5KQog
CQlyZXR1cm4gZmFsc2U7CiAKLQlyZXR1cm4gaW50ZWxfZ3B1X3Jlc2V0KGk5MTUsIEFMTF9FTkdJ
TkVTKSA9PSAwOworCXJldHVybiBpbnRlbF9ncHVfcmVzZXQoZ3QsIEFMTF9FTkdJTkVTKSA9PSAw
OwogfQogCiAvKioKQEAgLTExNiwxMSArMTE4LDExIEBAIHZvaWQgaW50ZWxfZ3Rfc2FuaXRpemUo
c3RydWN0IGludGVsX2d0ICpndCwgYm9vbCBmb3JjZSkKIAogCUdFTV9UUkFDRSgiXG4iKTsKIAot
CWlmICghcmVzZXRfZW5naW5lcyhndC0+aTkxNSkgJiYgIWZvcmNlKQorCWlmICghcmVzZXRfZW5n
aW5lcyhndCkgJiYgIWZvcmNlKQogCQlyZXR1cm47CiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5l
LCBndC0+aTkxNSwgaWQpCi0JCWludGVsX2VuZ2luZV9yZXNldChlbmdpbmUsIGZhbHNlKTsKKwkJ
X19pbnRlbF9lbmdpbmVfcmVzZXQoZW5naW5lLCBmYWxzZSk7CiB9CiAKIGludCBpbnRlbF9ndF9y
ZXN1bWUoc3RydWN0IGludGVsX2d0ICpndCkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2d0X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9n
dF90eXBlcy5oCmluZGV4IGI1NTY0NDEzMmI4Zi4uZjM1YzY2YjhjNjdlIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmgKQEAgLTE0LDEyICsxNCwyMSBAQAogI2luY2x1
ZGUgPGxpbnV4L3R5cGVzLmg+CiAKICNpbmNsdWRlICJpOTE1X3ZtYS5oIgorI2luY2x1ZGUgImlu
dGVsX3Jlc2V0X3R5cGVzLmgiCiAjaW5jbHVkZSAiaW50ZWxfd2FrZXJlZi5oIgogCiBzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZTsKIHN0cnVjdCBpOTE1X2dndHQ7CiBzdHJ1Y3QgaW50ZWxfdW5jb3Jl
OwogCitzdHJ1Y3QgaW50ZWxfaGFuZ2NoZWNrIHsKKwkvKiBGb3IgaGFuZ2NoZWNrIHRpbWVyICov
CisjZGVmaW5lIERSTV9JOTE1X0hBTkdDSEVDS19QRVJJT0QgMTUwMCAvKiBpbiBtcyAqLworI2Rl
ZmluZSBEUk1fSTkxNV9IQU5HQ0hFQ0tfSklGRklFUyBtc2Vjc190b19qaWZmaWVzKERSTV9JOTE1
X0hBTkdDSEVDS19QRVJJT0QpCisKKwlzdHJ1Y3QgZGVsYXllZF93b3JrIHdvcms7Cit9OworCiBz
dHJ1Y3QgaW50ZWxfZ3QgewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1OwogCXN0cnVj
dCBpbnRlbF91bmNvcmUgKnVuY29yZTsKQEAgLTM5LDYgKzQ4LDkgQEAgc3RydWN0IGludGVsX2d0
IHsKIAlzdHJ1Y3QgbGlzdF9oZWFkIGNsb3NlZF92bWE7CiAJc3BpbmxvY2tfdCBjbG9zZWRfbG9j
azsgLyogZ3VhcmRzIHRoZSBsaXN0IG9mIGNsb3NlZF92bWEgKi8KIAorCXN0cnVjdCBpbnRlbF9o
YW5nY2hlY2sgaGFuZ2NoZWNrOworCXN0cnVjdCBpbnRlbF9yZXNldCByZXNldDsKKwogCS8qKgog
CSAqIElzIHRoZSBHUFUgY3VycmVudGx5IGNvbnNpZGVyZWQgaWRsZSwgb3IgYnVzeSBleGVjdXRp
bmcKIAkgKiB1c2Vyc3BhY2UgcmVxdWVzdHM/IFdoaWxzdCBpZGxlLCB3ZSBhbGxvdyBydW50aW1l
IHBvd2VyCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9oYW5nY2hl
Y2suYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2hhbmdjaGVjay5jCmluZGV4IDc5
N2Q4ZWYwOTY5Yy4uODgxNzdmNDdiNGQ4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9oYW5nY2hlY2suYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9oYW5nY2hlY2suYwpAQCAtMjIsOCArMjIsMTAgQEAKICAqCiAgKi8KIAotI2luY2x1ZGUgImlu
dGVsX3Jlc2V0LmgiCiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIKKyNpbmNsdWRlICJpbnRlbF9lbmdp
bmUuaCIKKyNpbmNsdWRlICJpbnRlbF9ndC5oIgorI2luY2x1ZGUgImludGVsX3Jlc2V0LmgiCiAK
IHN0cnVjdCBoYW5nY2hlY2sgewogCXU2NCBhY3RoZDsKQEAgLTEwMCw3ICsxMDIsNiBAQCBoZWFk
X3N0dWNrKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgdTY0IGFjdGhkKQogc3RhdGlj
IGVudW0gaW50ZWxfZW5naW5lX2hhbmdjaGVja19hY3Rpb24KIGVuZ2luZV9zdHVjayhzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUsIHU2NCBhY3RoZCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSBlbmdpbmUtPmk5MTU7CiAJZW51bSBpbnRlbF9lbmdpbmVfaGFu
Z2NoZWNrX2FjdGlvbiBoYTsKIAl1MzIgdG1wOwogCkBAIC0xMDgsNyArMTA5LDcgQEAgZW5naW5l
X3N0dWNrKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgdTY0IGFjdGhkKQogCWlmICho
YSAhPSBFTkdJTkVfREVBRCkKIAkJcmV0dXJuIGhhOwogCi0JaWYgKElTX0dFTihkZXZfcHJpdiwg
MikpCisJaWYgKElTX0dFTihlbmdpbmUtPmk5MTUsIDIpKQogCQlyZXR1cm4gRU5HSU5FX0RFQUQ7
CiAKIAkvKiBJcyB0aGUgY2hpcCBoYW5naW5nIG9uIGEgV0FJVF9GT1JfRVZFTlQ/CkBAIC0xMTgs
OCArMTE5LDggQEAgZW5naW5lX3N0dWNrKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwg
dTY0IGFjdGhkKQogCSAqLwogCXRtcCA9IEVOR0lORV9SRUFEKGVuZ2luZSwgUklOR19DVEwpOwog
CWlmICh0bXAgJiBSSU5HX1dBSVQpIHsKLQkJaTkxNV9oYW5kbGVfZXJyb3IoZGV2X3ByaXYsIGVu
Z2luZS0+bWFzaywgMCwKLQkJCQkgICJzdHVjayB3YWl0IG9uICVzIiwgZW5naW5lLT5uYW1lKTsK
KwkJaW50ZWxfZ3RfaGFuZGxlX2Vycm9yKGVuZ2luZS0+Z3QsIGVuZ2luZS0+bWFzaywgMCwKKwkJ
CQkgICAgICAic3R1Y2sgd2FpdCBvbiAlcyIsIGVuZ2luZS0+bmFtZSk7CiAJCUVOR0lORV9XUklU
RShlbmdpbmUsIFJJTkdfQ1RMLCB0bXApOwogCQlyZXR1cm4gRU5HSU5FX1dBSVRfS0lDSzsKIAl9
CkBAIC0yMTksNyArMjIwLDcgQEAgc3RhdGljIHZvaWQgaGFuZ2NoZWNrX2FjY3VtdWxhdGVfc2Ft
cGxlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAkJCQkgSTkxNV9FTkdJTkVfV0VE
R0VEX1RJTUVPVVQpOwogfQogCi1zdGF0aWMgdm9pZCBoYW5nY2hlY2tfZGVjbGFyZV9oYW5nKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAorc3RhdGljIHZvaWQgaGFuZ2NoZWNrX2RlY2xh
cmVfaGFuZyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCQkJCSAgIGludGVsX2VuZ2luZV9tYXNrX3Qg
aHVuZywKIAkJCQkgICBpbnRlbF9lbmdpbmVfbWFza190IHN0dWNrKQogewpAQCAtMjM1LDEyICsy
MzYsMTIgQEAgc3RhdGljIHZvaWQgaGFuZ2NoZWNrX2RlY2xhcmVfaGFuZyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKIAkJaHVuZyAmPSB+c3R1Y2s7CiAJbGVuID0gc2NucHJpbnRmKG1z
Zywgc2l6ZW9mKG1zZyksCiAJCQkiJXMgb24gIiwgc3R1Y2sgPT0gaHVuZyA/ICJubyBwcm9ncmVz
cyIgOiAiaGFuZyIpOwotCWZvcl9lYWNoX2VuZ2luZV9tYXNrZWQoZW5naW5lLCBpOTE1LCBodW5n
LCB0bXApCisJZm9yX2VhY2hfZW5naW5lX21hc2tlZChlbmdpbmUsIGd0LT5pOTE1LCBodW5nLCB0
bXApCiAJCWxlbiArPSBzY25wcmludGYobXNnICsgbGVuLCBzaXplb2YobXNnKSAtIGxlbiwKIAkJ
CQkgIiVzLCAiLCBlbmdpbmUtPm5hbWUpOwogCW1zZ1tsZW4tMl0gPSAnXDAnOwogCi0JcmV0dXJu
IGk5MTVfaGFuZGxlX2Vycm9yKGk5MTUsIGh1bmcsIEk5MTVfRVJST1JfQ0FQVFVSRSwgIiVzIiwg
bXNnKTsKKwlyZXR1cm4gaW50ZWxfZ3RfaGFuZGxlX2Vycm9yKGd0LCBodW5nLCBJOTE1X0VSUk9S
X0NBUFRVUkUsICIlcyIsIG1zZyk7CiB9CiAKIC8qCkBAIC0yNTEsMTEgKzI1MiwxMCBAQCBzdGF0
aWMgdm9pZCBoYW5nY2hlY2tfZGVjbGFyZV9oYW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LAogICogd2Uga2ljayB0aGUgcmluZy4gSWYgd2Ugc2VlIG5vIHByb2dyZXNzIG9uIHRocmVl
IHN1YnNlcXVlbnQgY2FsbHMKICAqIHdlIGFzc3VtZSBjaGlwIGlzIHdlZGdlZCBhbmQgdHJ5IHRv
IGZpeCBpdCBieSByZXNldHRpbmcgdGhlIGNoaXAuCiAgKi8KLXN0YXRpYyB2b2lkIGk5MTVfaGFu
Z2NoZWNrX2VsYXBzZWQoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQorc3RhdGljIHZvaWQgaGFu
Z2NoZWNrX2VsYXBzZWQoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogewotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9Ci0JCWNvbnRhaW5lcl9vZih3b3JrLCB0eXBlb2YoKmRl
dl9wcml2KSwKLQkJCSAgICAgZ3B1X2Vycm9yLmhhbmdjaGVja193b3JrLndvcmspOworCXN0cnVj
dCBpbnRlbF9ndCAqZ3QgPQorCQljb250YWluZXJfb2Yod29yaywgdHlwZW9mKCpndCksIGhhbmdj
aGVjay53b3JrLndvcmspOwogCWludGVsX2VuZ2luZV9tYXNrX3QgaHVuZyA9IDAsIHN0dWNrID0g
MCwgd2VkZ2VkID0gMDsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJZW51bSBp
bnRlbF9lbmdpbmVfaWQgaWQ7CkBAIC0yNjQsMTMgKzI2NCwxMyBAQCBzdGF0aWMgdm9pZCBpOTE1
X2hhbmdjaGVja19lbGFwc2VkKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAlpZiAoIWk5MTVf
bW9kcGFyYW1zLmVuYWJsZV9oYW5nY2hlY2spCiAJCXJldHVybjsKIAotCWlmICghUkVBRF9PTkNF
KGRldl9wcml2LT5ndC5hd2FrZSkpCisJaWYgKCFSRUFEX09OQ0UoZ3QtPmF3YWtlKSkKIAkJcmV0
dXJuOwogCi0JaWYgKGk5MTVfdGVybWluYWxseV93ZWRnZWQoZGV2X3ByaXYpKQorCWlmIChpbnRl
bF9ndF9pc193ZWRnZWQoZ3QpKQogCQlyZXR1cm47CiAKLQl3YWtlcmVmID0gaW50ZWxfcnVudGlt
ZV9wbV9nZXRfaWZfaW5fdXNlKCZkZXZfcHJpdi0+cnVudGltZV9wbSk7CisJd2FrZXJlZiA9IGlu
dGVsX3J1bnRpbWVfcG1fZ2V0X2lmX2luX3VzZSgmZ3QtPmk5MTUtPnJ1bnRpbWVfcG0pOwogCWlm
ICghd2FrZXJlZikKIAkJcmV0dXJuOwogCkBAIC0yNzgsOSArMjc4LDkgQEAgc3RhdGljIHZvaWQg
aTkxNV9oYW5nY2hlY2tfZWxhcHNlZChzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJICogcGVy
aW9kaWNhbGx5IGFybSB0aGUgbW1pbyBjaGVja2VyIHRvIHNlZSBpZiB3ZSBhcmUgdHJpZ2dlcmlu
ZwogCSAqIGFueSBpbnZhbGlkIGFjY2Vzcy4KIAkgKi8KLQlpbnRlbF91bmNvcmVfYXJtX3VuY2xh
aW1lZF9tbWlvX2RldGVjdGlvbigmZGV2X3ByaXYtPnVuY29yZSk7CisJaW50ZWxfdW5jb3JlX2Fy
bV91bmNsYWltZWRfbW1pb19kZXRlY3Rpb24oZ3QtPnVuY29yZSk7CiAKLQlmb3JfZWFjaF9lbmdp
bmUoZW5naW5lLCBkZXZfcHJpdiwgaWQpIHsKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndC0+
aTkxNSwgaWQpIHsKIAkJc3RydWN0IGhhbmdjaGVjayBoYzsKIAogCQlpbnRlbF9lbmdpbmVfc2ln
bmFsX2JyZWFkY3J1bWJzKGVuZ2luZSk7CkBAIC0zMDIsNyArMzAyLDcgQEAgc3RhdGljIHZvaWQg
aTkxNV9oYW5nY2hlY2tfZWxhcHNlZChzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJaWYgKEdF
TV9TSE9XX0RFQlVHKCkgJiYgKGh1bmcgfCBzdHVjaykpIHsKIAkJc3RydWN0IGRybV9wcmludGVy
IHAgPSBkcm1fZGVidWdfcHJpbnRlcigiaGFuZ2NoZWNrIik7CiAKLQkJZm9yX2VhY2hfZW5naW5l
KGVuZ2luZSwgZGV2X3ByaXYsIGlkKSB7CisJCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LT5p
OTE1LCBpZCkgewogCQkJaWYgKGludGVsX2VuZ2luZV9pc19pZGxlKGVuZ2luZSkpCiAJCQkJY29u
dGludWU7CiAKQEAgLTMxMSwyMCArMzExLDM2IEBAIHN0YXRpYyB2b2lkIGk5MTVfaGFuZ2NoZWNr
X2VsYXBzZWQoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCX0KIAogCWlmICh3ZWRnZWQpIHsK
LQkJZGV2X2VycihkZXZfcHJpdi0+ZHJtLmRldiwKKwkJZGV2X2VycihndC0+aTkxNS0+ZHJtLmRl
diwKIAkJCSJHUFUgcmVjb3ZlcnkgdGltZWQgb3V0LCIKIAkJCSIgY2FuY2VsbGluZyBhbGwgaW4t
ZmxpZ2h0IHJlbmRlcmluZy5cbiIpOwogCQlHRU1fVFJBQ0VfRFVNUCgpOwotCQlpOTE1X2dlbV9z
ZXRfd2VkZ2VkKGRldl9wcml2KTsKKwkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CiAJfQogCiAJ
aWYgKGh1bmcpCi0JCWhhbmdjaGVja19kZWNsYXJlX2hhbmcoZGV2X3ByaXYsIGh1bmcsIHN0dWNr
KTsKKwkJaGFuZ2NoZWNrX2RlY2xhcmVfaGFuZyhndCwgaHVuZywgc3R1Y2spOwogCi0JaW50ZWxf
cnVudGltZV9wbV9wdXQoJmRldl9wcml2LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKKwlpbnRlbF9y
dW50aW1lX3BtX3B1dCgmZ3QtPmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwogCiAJLyogUmVz
ZXQgdGltZXIgaW4gY2FzZSBHUFUgaGFuZ3Mgd2l0aG91dCBhbm90aGVyIHJlcXVlc3QgYmVpbmcg
YWRkZWQgKi8KLQlpOTE1X3F1ZXVlX2hhbmdjaGVjayhkZXZfcHJpdik7CisJaW50ZWxfZ3RfcXVl
dWVfaGFuZ2NoZWNrKGd0KTsKK30KKwordm9pZCBpbnRlbF9ndF9xdWV1ZV9oYW5nY2hlY2soc3Ry
dWN0IGludGVsX2d0ICpndCkKK3sKKwl1bnNpZ25lZCBsb25nIGRlbGF5OworCisJaWYgKHVubGlr
ZWx5KCFpOTE1X21vZHBhcmFtcy5lbmFibGVfaGFuZ2NoZWNrKSkKKwkJcmV0dXJuOworCisJLyog
RG9uJ3QgY29udGludWFsbHkgZGVmZXIgdGhlIGhhbmdjaGVjayBzbyB0aGF0IGl0IGlzIGFsd2F5
cyBydW4gYXQKKwkgKiBsZWFzdCBvbmNlIGFmdGVyIHdvcmsgaGFzIGJlZW4gc2NoZWR1bGVkIG9u
IGFueSByaW5nLiBPdGhlcndpc2UsCisJICogd2Ugd2lsbCBpZ25vcmUgYSBodW5nIHJpbmcgaWYg
YSBzZWNvbmQgcmluZyBpcyBrZXB0IGJ1c3kuCisJICovCisKKwlkZWxheSA9IHJvdW5kX2ppZmZp
ZXNfdXBfcmVsYXRpdmUoRFJNX0k5MTVfSEFOR0NIRUNLX0pJRkZJRVMpOworCXF1ZXVlX2RlbGF5
ZWRfd29yayhzeXN0ZW1fbG9uZ193cSwgJmd0LT5oYW5nY2hlY2sud29yaywgZGVsYXkpOwogfQog
CiB2b2lkIGludGVsX2VuZ2luZV9pbml0X2hhbmdjaGVjayhzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmUpCkBAIC0zMzMsMTAgKzM0OSw5IEBAIHZvaWQgaW50ZWxfZW5naW5lX2luaXRfaGFu
Z2NoZWNrKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAllbmdpbmUtPmhhbmdjaGVj
ay5hY3Rpb25fdGltZXN0YW1wID0gamlmZmllczsKIH0KIAotdm9pZCBpbnRlbF9oYW5nY2hlY2tf
aW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3ZvaWQgaW50ZWxfZ3RfaW5pdF9o
YW5nY2hlY2soc3RydWN0IGludGVsX2d0ICpndCkKIHsKLQlJTklUX0RFTEFZRURfV09SSygmaTkx
NS0+Z3B1X2Vycm9yLmhhbmdjaGVja193b3JrLAotCQkJICBpOTE1X2hhbmdjaGVja19lbGFwc2Vk
KTsKKwlJTklUX0RFTEFZRURfV09SSygmZ3QtPmhhbmdjaGVjay53b3JrLCBoYW5nY2hlY2tfZWxh
cHNlZCk7CiB9CiAKICNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9TRUxGVEVTVCkKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKaW5kZXggZjM1MzkxNDdjN2IxLi4xOGQ5ZGRjNWNk
NTggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCkBAIC0yMjk3LDcgKzIyOTcsNyBA
QCBzdGF0aWMgdm9pZCBfX2V4ZWNsaXN0c19yZXNldChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpl
bmdpbmUsIGJvb2wgc3RhbGxlZCkKIAkgKiBhbmQgaGF2ZSB0byBhdCBsZWFzdCByZXN0b3JlIHRo
ZSBSSU5HIHJlZ2lzdGVyIGluIHRoZSBjb250ZXh0CiAJICogaW1hZ2UgYmFjayB0byB0aGUgZXhw
ZWN0ZWQgdmFsdWVzIHRvIHNraXAgb3ZlciB0aGUgZ3VpbHR5IHJlcXVlc3QuCiAJICovCi0JaTkx
NV9yZXNldF9yZXF1ZXN0KHJxLCBzdGFsbGVkKTsKKwlfX2k5MTVfcmVxdWVzdF9yZXNldChycSwg
c3RhbGxlZCk7CiAJaWYgKCFzdGFsbGVkKQogCQlnb3RvIG91dF9yZXBsYXk7CiAKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9yZXNldC5jCmluZGV4IDcyMDAyYzBmOTY5OC4uNjdjMDYyMzFiMDA0
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZXNldC5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMKQEAgLTExNCw3ICsxMTQsNyBA
QCBzdGF0aWMgdm9pZCBjb250ZXh0X21hcmtfaW5ub2NlbnQoc3RydWN0IGk5MTVfZ2VtX2NvbnRl
eHQgKmN0eCkKIAlhdG9taWNfaW5jKCZjdHgtPmFjdGl2ZV9jb3VudCk7CiB9CiAKLXZvaWQgaTkx
NV9yZXNldF9yZXF1ZXN0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBib29sIGd1aWx0eSkKK3Zv
aWQgX19pOTE1X3JlcXVlc3RfcmVzZXQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsIGJvb2wgZ3Vp
bHR5KQogewogCUdFTV9UUkFDRSgiJXMgcnE9JWxseDolbGxkLCBndWlsdHk/ICVzXG4iLAogCQkg
IHJxLT5lbmdpbmUtPm5hbWUsCkBAIC0xNjQsMTYgKzE2NCwxNSBAQCBzdGF0aWMgdm9pZCBnZW4z
X3N0b3BfZW5naW5lKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAkJCSAgaW50ZWxf
dW5jb3JlX3JlYWRfZncodW5jb3JlLCBSSU5HX0hFQUQoYmFzZSkpKTsKIH0KIAotc3RhdGljIHZv
aWQgaTkxNV9zdG9wX2VuZ2luZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCi0JCQkg
ICAgICBpbnRlbF9lbmdpbmVfbWFza190IGVuZ2luZV9tYXNrKQorc3RhdGljIHZvaWQgc3RvcF9l
bmdpbmVzKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIGludGVsX2VuZ2luZV9tYXNrX3QgZW5naW5lX21h
c2spCiB7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCWludGVsX2VuZ2luZV9t
YXNrX3QgdG1wOwogCi0JaWYgKElOVEVMX0dFTihpOTE1KSA8IDMpCisJaWYgKElOVEVMX0dFTihn
dC0+aTkxNSkgPCAzKQogCQlyZXR1cm47CiAKLQlmb3JfZWFjaF9lbmdpbmVfbWFza2VkKGVuZ2lu
ZSwgaTkxNSwgZW5naW5lX21hc2ssIHRtcCkKKwlmb3JfZWFjaF9lbmdpbmVfbWFza2VkKGVuZ2lu
ZSwgZ3QtPmk5MTUsIGVuZ2luZV9tYXNrLCB0bXApCiAJCWdlbjNfc3RvcF9lbmdpbmUoZW5naW5l
KTsKIH0KIApAQCAtMTg1LDExICsxODQsMTEgQEAgc3RhdGljIGJvb2wgaTkxNV9pbl9yZXNldChz
dHJ1Y3QgcGNpX2RldiAqcGRldikKIAlyZXR1cm4gZ2Ryc3QgJiBHUkRPTV9SRVNFVF9TVEFUVVM7
CiB9CiAKLXN0YXRpYyBpbnQgaTkxNV9kb19yZXNldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwKK3N0YXRpYyBpbnQgaTkxNV9kb19yZXNldChzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCQkJ
IGludGVsX2VuZ2luZV9tYXNrX3QgZW5naW5lX21hc2ssCiAJCQkgdW5zaWduZWQgaW50IHJldHJ5
KQogewotCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gaTkxNS0+ZHJtLnBkZXY7CisJc3RydWN0IHBj
aV9kZXYgKnBkZXYgPSBndC0+aTkxNS0+ZHJtLnBkZXY7CiAJaW50IGVycjsKIAogCS8qIEFzc2Vy
dCByZXNldCBmb3IgYXQgbGVhc3QgMjAgdXNlYywgYW5kIHdhaXQgZm9yIGFja25vd2xlZGdlbWVu
dC4gKi8KQEAgLTIxNCwyMiArMjEzLDIyIEBAIHN0YXRpYyBib29sIGc0eF9yZXNldF9jb21wbGV0
ZShzdHJ1Y3QgcGNpX2RldiAqcGRldikKIAlyZXR1cm4gKGdkcnN0ICYgR1JET01fUkVTRVRfRU5B
QkxFKSA9PSAwOwogfQogCi1zdGF0aWMgaW50IGczM19kb19yZXNldChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKK3N0YXRpYyBpbnQgZzMzX2RvX3Jlc2V0KHN0cnVjdCBpbnRlbF9ndCAq
Z3QsCiAJCQlpbnRlbF9lbmdpbmVfbWFza190IGVuZ2luZV9tYXNrLAogCQkJdW5zaWduZWQgaW50
IHJldHJ5KQogewotCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gaTkxNS0+ZHJtLnBkZXY7CisJc3Ry
dWN0IHBjaV9kZXYgKnBkZXYgPSBndC0+aTkxNS0+ZHJtLnBkZXY7CiAKIAlwY2lfd3JpdGVfY29u
ZmlnX2J5dGUocGRldiwgSTkxNV9HRFJTVCwgR1JET01fUkVTRVRfRU5BQkxFKTsKIAlyZXR1cm4g
d2FpdF9mb3JfYXRvbWljKGc0eF9yZXNldF9jb21wbGV0ZShwZGV2KSwgNTApOwogfQogCi1zdGF0
aWMgaW50IGc0eF9kb19yZXNldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKK3N0YXRp
YyBpbnQgZzR4X2RvX3Jlc2V0KHN0cnVjdCBpbnRlbF9ndCAqZ3QsCiAJCQlpbnRlbF9lbmdpbmVf
bWFza190IGVuZ2luZV9tYXNrLAogCQkJdW5zaWduZWQgaW50IHJldHJ5KQogewotCXN0cnVjdCBw
Y2lfZGV2ICpwZGV2ID0gaTkxNS0+ZHJtLnBkZXY7Ci0Jc3RydWN0IGludGVsX3VuY29yZSAqdW5j
b3JlID0gJmk5MTUtPnVuY29yZTsKKwlzdHJ1Y3QgcGNpX2RldiAqcGRldiA9IGd0LT5pOTE1LT5k
cm0ucGRldjsKKwlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSBndC0+dW5jb3JlOwogCWlu
dCByZXQ7CiAKIAkvKiBXYVZjcENsa0dhdGVEaXNhYmxlRm9yTWVkaWFSZXNldDpjdGcsZWxrICov
CkBAIC0yNjEsMTEgKzI2MCwxMSBAQCBzdGF0aWMgaW50IGc0eF9kb19yZXNldChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlyZXR1cm4gcmV0OwogfQogCi1zdGF0aWMgaW50IGlyb25s
YWtlX2RvX3Jlc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAorc3RhdGljIGludCBp
cm9ubGFrZV9kb19yZXNldChzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCQkJICAgICBpbnRlbF9lbmdp
bmVfbWFza190IGVuZ2luZV9tYXNrLAogCQkJICAgICB1bnNpZ25lZCBpbnQgcmV0cnkpCiB7Ci0J
c3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmk5MTUtPnVuY29yZTsKKwlzdHJ1Y3QgaW50
ZWxfdW5jb3JlICp1bmNvcmUgPSBndC0+dW5jb3JlOwogCWludCByZXQ7CiAKIAlpbnRlbF91bmNv
cmVfd3JpdGVfZncodW5jb3JlLCBJTEtfR0RTUiwKQEAgLTI5NywxMCArMjk2LDkgQEAgc3RhdGlj
IGludCBpcm9ubGFrZV9kb19yZXNldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIH0K
IAogLyogUmVzZXQgdGhlIGhhcmR3YXJlIGRvbWFpbnMgKEdFTlhfR1JET01fKikgc3BlY2lmaWVk
IGJ5IG1hc2sgKi8KLXN0YXRpYyBpbnQgZ2VuNl9od19kb21haW5fcmVzZXQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsCi0JCQkJdTMyIGh3X2RvbWFpbl9tYXNrKQorc3RhdGljIGludCBn
ZW42X2h3X2RvbWFpbl9yZXNldChzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCB1MzIgaHdfZG9tYWluX21h
c2spCiB7Ci0Jc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmk5MTUtPnVuY29yZTsKKwlz
dHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSBndC0+dW5jb3JlOwogCWludCBlcnI7CiAKIAkv
KgpAQCAtMzIyLDcgKzMyMCw3IEBAIHN0YXRpYyBpbnQgZ2VuNl9od19kb21haW5fcmVzZXQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJcmV0dXJuIGVycjsKIH0KIAotc3RhdGljIGlu
dCBnZW42X3Jlc2V0X2VuZ2luZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCitzdGF0
aWMgaW50IGdlbjZfcmVzZXRfZW5naW5lcyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCQkJICAgICAg
aW50ZWxfZW5naW5lX21hc2tfdCBlbmdpbmVfbWFzaywKIAkJCSAgICAgIHVuc2lnbmVkIGludCBy
ZXRyeSkKIHsKQEAgLTM0MiwxMyArMzQwLDEzIEBAIHN0YXRpYyBpbnQgZ2VuNl9yZXNldF9lbmdp
bmVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQlpbnRlbF9lbmdpbmVfbWFza190
IHRtcDsKIAogCQlod19tYXNrID0gMDsKLQkJZm9yX2VhY2hfZW5naW5lX21hc2tlZChlbmdpbmUs
IGk5MTUsIGVuZ2luZV9tYXNrLCB0bXApIHsKKwkJZm9yX2VhY2hfZW5naW5lX21hc2tlZChlbmdp
bmUsIGd0LT5pOTE1LCBlbmdpbmVfbWFzaywgdG1wKSB7CiAJCQlHRU1fQlVHX09OKGVuZ2luZS0+
aWQgPj0gQVJSQVlfU0laRShod19lbmdpbmVfbWFzaykpOwogCQkJaHdfbWFzayB8PSBod19lbmdp
bmVfbWFza1tlbmdpbmUtPmlkXTsKIAkJfQogCX0KIAotCXJldHVybiBnZW42X2h3X2RvbWFpbl9y
ZXNldChpOTE1LCBod19tYXNrKTsKKwlyZXR1cm4gZ2VuNl9od19kb21haW5fcmVzZXQoZ3QsIGh3
X21hc2spOwogfQogCiBzdGF0aWMgdTMyIGdlbjExX2xvY2tfc2ZjKHN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZSkKQEAgLTQ0Niw3ICs0NDQsNyBAQCBzdGF0aWMgdm9pZCBnZW4xMV91bmxv
Y2tfc2ZjKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAlybXdfY2xlYXJfZncodW5j
b3JlLCBzZmNfZm9yY2VkX2xvY2ssIHNmY19mb3JjZWRfbG9ja19iaXQpOwogfQogCi1zdGF0aWMg
aW50IGdlbjExX3Jlc2V0X2VuZ2luZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCitz
dGF0aWMgaW50IGdlbjExX3Jlc2V0X2VuZ2luZXMoc3RydWN0IGludGVsX2d0ICpndCwKIAkJCSAg
ICAgICBpbnRlbF9lbmdpbmVfbWFza190IGVuZ2luZV9tYXNrLAogCQkJICAgICAgIHVuc2lnbmVk
IGludCByZXRyeSkKIHsKQEAgLTQ2OSwxNyArNDY3LDE3IEBAIHN0YXRpYyBpbnQgZ2VuMTFfcmVz
ZXRfZW5naW5lcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJaHdfbWFzayA9IEdF
TjExX0dSRE9NX0ZVTEw7CiAJfSBlbHNlIHsKIAkJaHdfbWFzayA9IDA7Ci0JCWZvcl9lYWNoX2Vu
Z2luZV9tYXNrZWQoZW5naW5lLCBpOTE1LCBlbmdpbmVfbWFzaywgdG1wKSB7CisJCWZvcl9lYWNo
X2VuZ2luZV9tYXNrZWQoZW5naW5lLCBndC0+aTkxNSwgZW5naW5lX21hc2ssIHRtcCkgewogCQkJ
R0VNX0JVR19PTihlbmdpbmUtPmlkID49IEFSUkFZX1NJWkUoaHdfZW5naW5lX21hc2spKTsKIAkJ
CWh3X21hc2sgfD0gaHdfZW5naW5lX21hc2tbZW5naW5lLT5pZF07CiAJCQlod19tYXNrIHw9IGdl
bjExX2xvY2tfc2ZjKGVuZ2luZSk7CiAJCX0KIAl9CiAKLQlyZXQgPSBnZW42X2h3X2RvbWFpbl9y
ZXNldChpOTE1LCBod19tYXNrKTsKKwlyZXQgPSBnZW42X2h3X2RvbWFpbl9yZXNldChndCwgaHdf
bWFzayk7CiAKIAlpZiAoZW5naW5lX21hc2sgIT0gQUxMX0VOR0lORVMpCi0JCWZvcl9lYWNoX2Vu
Z2luZV9tYXNrZWQoZW5naW5lLCBpOTE1LCBlbmdpbmVfbWFzaywgdG1wKQorCQlmb3JfZWFjaF9l
bmdpbmVfbWFza2VkKGVuZ2luZSwgZ3QtPmk5MTUsIGVuZ2luZV9tYXNrLCB0bXApCiAJCQlnZW4x
MV91bmxvY2tfc2ZjKGVuZ2luZSk7CiAKIAlyZXR1cm4gcmV0OwpAQCAtNTI5LDcgKzUyNyw3IEBA
IHN0YXRpYyB2b2lkIGdlbjhfZW5naW5lX3Jlc2V0X2NhbmNlbChzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmUpCiAJCQkgICAgICBfTUFTS0VEX0JJVF9ESVNBQkxFKFJFU0VUX0NUTF9SRVFV
RVNUX1JFU0VUKSk7CiB9CiAKLXN0YXRpYyBpbnQgZ2VuOF9yZXNldF9lbmdpbmVzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAorc3RhdGljIGludCBnZW44X3Jlc2V0X2VuZ2luZXMoc3Ry
dWN0IGludGVsX2d0ICpndCwKIAkJCSAgICAgIGludGVsX2VuZ2luZV9tYXNrX3QgZW5naW5lX21h
c2ssCiAJCQkgICAgICB1bnNpZ25lZCBpbnQgcmV0cnkpCiB7CkBAIC01MzgsNyArNTM2LDcgQEAg
c3RhdGljIGludCBnZW44X3Jlc2V0X2VuZ2luZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJaW50ZWxfZW5naW5lX21hc2tfdCB0bXA7CiAJaW50IHJldDsKIAotCWZvcl9lYWNoX2Vu
Z2luZV9tYXNrZWQoZW5naW5lLCBpOTE1LCBlbmdpbmVfbWFzaywgdG1wKSB7CisJZm9yX2VhY2hf
ZW5naW5lX21hc2tlZChlbmdpbmUsIGd0LT5pOTE1LCBlbmdpbmVfbWFzaywgdG1wKSB7CiAJCXJl
dCA9IGdlbjhfZW5naW5lX3Jlc2V0X3ByZXBhcmUoZW5naW5lKTsKIAkJaWYgKHJldCAmJiAhcmVz
ZXRfbm9uX3JlYWR5KQogCQkJZ290byBza2lwX3Jlc2V0OwpAQCAtNTU0LDIzICs1NTIsMjMgQEAg
c3RhdGljIGludCBnZW44X3Jlc2V0X2VuZ2luZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJCSAqIFdlIHJhdGhlciB0YWtlIGNvbnRleHQgY29ycnVwdGlvbiBpbnN0ZWFkIG9mCiAJ
CSAqIGZhaWxlZCByZXNldCB3aXRoIGEgd2VkZ2VkIGRyaXZlci9ncHUuIEFuZAogCQkgKiBhY3Rp
dmUgYmIgZXhlY3V0aW9uIGNhc2Ugc2hvdWxkIGJlIGNvdmVyZWQgYnkKLQkJICogaTkxNV9zdG9w
X2VuZ2luZXMgd2UgaGF2ZSBiZWZvcmUgdGhlIHJlc2V0LgorCQkgKiBzdG9wX2VuZ2luZXMoKSB3
ZSBoYXZlIGJlZm9yZSB0aGUgcmVzZXQuCiAJCSAqLwogCX0KIAotCWlmIChJTlRFTF9HRU4oaTkx
NSkgPj0gMTEpCi0JCXJldCA9IGdlbjExX3Jlc2V0X2VuZ2luZXMoaTkxNSwgZW5naW5lX21hc2ss
IHJldHJ5KTsKKwlpZiAoSU5URUxfR0VOKGd0LT5pOTE1KSA+PSAxMSkKKwkJcmV0ID0gZ2VuMTFf
cmVzZXRfZW5naW5lcyhndCwgZW5naW5lX21hc2ssIHJldHJ5KTsKIAllbHNlCi0JCXJldCA9IGdl
bjZfcmVzZXRfZW5naW5lcyhpOTE1LCBlbmdpbmVfbWFzaywgcmV0cnkpOworCQlyZXQgPSBnZW42
X3Jlc2V0X2VuZ2luZXMoZ3QsIGVuZ2luZV9tYXNrLCByZXRyeSk7CiAKIHNraXBfcmVzZXQ6Ci0J
Zm9yX2VhY2hfZW5naW5lX21hc2tlZChlbmdpbmUsIGk5MTUsIGVuZ2luZV9tYXNrLCB0bXApCisJ
Zm9yX2VhY2hfZW5naW5lX21hc2tlZChlbmdpbmUsIGd0LT5pOTE1LCBlbmdpbmVfbWFzaywgdG1w
KQogCQlnZW44X2VuZ2luZV9yZXNldF9jYW5jZWwoZW5naW5lKTsKIAogCXJldHVybiByZXQ7CiB9
CiAKLXR5cGVkZWYgaW50ICgqcmVzZXRfZnVuYykoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKiwK
K3R5cGVkZWYgaW50ICgqcmVzZXRfZnVuYykoc3RydWN0IGludGVsX2d0ICosCiAJCQkgIGludGVs
X2VuZ2luZV9tYXNrX3QgZW5naW5lX21hc2ssCiAJCQkgIHVuc2lnbmVkIGludCByZXRyeSk7CiAK
QEAgLTU5MiwxNSArNTkwLDE0IEBAIHN0YXRpYyByZXNldF9mdW5jIGludGVsX2dldF9ncHVfcmVz
ZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJCXJldHVybiBOVUxMOwogfQogCi1p
bnQgaW50ZWxfZ3B1X3Jlc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAotCQkgICAg
aW50ZWxfZW5naW5lX21hc2tfdCBlbmdpbmVfbWFzaykKK2ludCBpbnRlbF9ncHVfcmVzZXQoc3Ry
dWN0IGludGVsX2d0ICpndCwgaW50ZWxfZW5naW5lX21hc2tfdCBlbmdpbmVfbWFzaykKIHsKIAlj
b25zdCBpbnQgcmV0cmllcyA9IGVuZ2luZV9tYXNrID09IEFMTF9FTkdJTkVTID8gUkVTRVRfTUFY
X1JFVFJJRVMgOiAxOwogCXJlc2V0X2Z1bmMgcmVzZXQ7CiAJaW50IHJldCA9IC1FVElNRURPVVQ7
CiAJaW50IHJldHJ5OwogCi0JcmVzZXQgPSBpbnRlbF9nZXRfZ3B1X3Jlc2V0KGk5MTUpOworCXJl
c2V0ID0gaW50ZWxfZ2V0X2dwdV9yZXNldChndC0+aTkxNSk7CiAJaWYgKCFyZXNldCkKIAkJcmV0
dXJuIC1FTk9ERVY7CiAKQEAgLTYwOCw3ICs2MDUsNyBAQCBpbnQgaW50ZWxfZ3B1X3Jlc2V0KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCSAqIElmIHRoZSBwb3dlciB3ZWxsIHNsZWVw
cyBkdXJpbmcgdGhlIHJlc2V0LCB0aGUgcmVzZXQKIAkgKiByZXF1ZXN0IG1heSBiZSBkcm9wcGVk
IGFuZCBuZXZlciBjb21wbGV0ZXMgKGNhdXNpbmcgLUVJTykuCiAJICovCi0JaW50ZWxfdW5jb3Jl
X2ZvcmNld2FrZV9nZXQoJmk5MTUtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CisJaW50ZWxfdW5j
b3JlX2ZvcmNld2FrZV9nZXQoZ3QtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CiAJZm9yIChyZXRy
eSA9IDA7IHJldCA9PSAtRVRJTUVET1VUICYmIHJldHJ5IDwgcmV0cmllczsgcmV0cnkrKykgewog
CQkvKgogCQkgKiBXZSBzdG9wIGVuZ2luZXMsIG90aGVyd2lzZSB3ZSBtaWdodCBnZXQgZmFpbGVk
IHJlc2V0IGFuZCBhCkBAIC02MjUsMTQgKzYyMiwxNCBAQCBpbnQgaW50ZWxfZ3B1X3Jlc2V0KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkgKiBGSVhNRTogV2EgZm9yIG1vcmUgbW9k
ZXJuIGdlbnMgbmVlZHMgdG8gYmUgdmFsaWRhdGVkCiAJCSAqLwogCQlpZiAocmV0cnkpCi0JCQlp
OTE1X3N0b3BfZW5naW5lcyhpOTE1LCBlbmdpbmVfbWFzayk7CisJCQlzdG9wX2VuZ2luZXMoZ3Qs
IGVuZ2luZV9tYXNrKTsKIAogCQlHRU1fVFJBQ0UoImVuZ2luZV9tYXNrPSV4XG4iLCBlbmdpbmVf
bWFzayk7CiAJCXByZWVtcHRfZGlzYWJsZSgpOwotCQlyZXQgPSByZXNldChpOTE1LCBlbmdpbmVf
bWFzaywgcmV0cnkpOworCQlyZXQgPSByZXNldChndCwgZW5naW5lX21hc2ssIHJldHJ5KTsKIAkJ
cHJlZW1wdF9lbmFibGUoKTsKIAl9Ci0JaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQoJmk5MTUt
PnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CisJaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQoZ3Qt
PnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CiAKIAlyZXR1cm4gcmV0OwogfQpAQCAtNjUwLDE3ICs2
NDcsMTcgQEAgYm9vbCBpbnRlbF9oYXNfcmVzZXRfZW5naW5lKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQogCXJldHVybiBJTlRFTF9JTkZPKGk5MTUpLT5oYXNfcmVzZXRfZW5naW5lICYm
IGk5MTVfbW9kcGFyYW1zLnJlc2V0ID49IDI7CiB9CiAKLWludCBpbnRlbF9yZXNldF9ndWMoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCitpbnQgaW50ZWxfcmVzZXRfZ3VjKHN0cnVjdCBp
bnRlbF9ndCAqZ3QpCiB7CiAJdTMyIGd1Y19kb21haW4gPQotCQlJTlRFTF9HRU4oaTkxNSkgPj0g
MTEgPyBHRU4xMV9HUkRPTV9HVUMgOiBHRU45X0dSRE9NX0dVQzsKKwkJSU5URUxfR0VOKGd0LT5p
OTE1KSA+PSAxMSA/IEdFTjExX0dSRE9NX0dVQyA6IEdFTjlfR1JET01fR1VDOwogCWludCByZXQ7
CiAKLQlHRU1fQlVHX09OKCFIQVNfR1VDKGk5MTUpKTsKKwlHRU1fQlVHX09OKCFIQVNfR1VDKGd0
LT5pOTE1KSk7CiAKLQlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX2dldCgmaTkxNS0+dW5jb3JlLCBG
T1JDRVdBS0VfQUxMKTsKLQlyZXQgPSBnZW42X2h3X2RvbWFpbl9yZXNldChpOTE1LCBndWNfZG9t
YWluKTsKLQlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX3B1dCgmaTkxNS0+dW5jb3JlLCBGT1JDRVdB
S0VfQUxMKTsKKwlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX2dldChndC0+dW5jb3JlLCBGT1JDRVdB
S0VfQUxMKTsKKwlyZXQgPSBnZW42X2h3X2RvbWFpbl9yZXNldChndCwgZ3VjX2RvbWFpbik7CisJ
aW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQoZ3QtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CiAK
IAlyZXR1cm4gcmV0OwogfQpAQCAtNjgyLDU2ICs2NzksNTUgQEAgc3RhdGljIHZvaWQgcmVzZXRf
cHJlcGFyZV9lbmdpbmUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCWVuZ2luZS0+
cmVzZXQucHJlcGFyZShlbmdpbmUpOwogfQogCi1zdGF0aWMgdm9pZCByZXZva2VfbW1hcHMoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCitzdGF0aWMgdm9pZCByZXZva2VfbW1hcHMoc3Ry
dWN0IGludGVsX2d0ICpndCkKIHsKIAlpbnQgaTsKIAotCWZvciAoaSA9IDA7IGkgPCBpOTE1LT5n
Z3R0Lm51bV9mZW5jZXM7IGkrKykgeworCWZvciAoaSA9IDA7IGkgPCBndC0+Z2d0dC0+bnVtX2Zl
bmNlczsgaSsrKSB7CiAJCXN0cnVjdCBkcm1fdm1hX29mZnNldF9ub2RlICpub2RlOwogCQlzdHJ1
Y3QgaTkxNV92bWEgKnZtYTsKIAkJdTY0IHZtYV9vZmZzZXQ7CiAKLQkJdm1hID0gUkVBRF9PTkNF
KGk5MTUtPmdndHQuZmVuY2VfcmVnc1tpXS52bWEpOworCQl2bWEgPSBSRUFEX09OQ0UoZ3QtPmdn
dHQtPmZlbmNlX3JlZ3NbaV0udm1hKTsKIAkJaWYgKCF2bWEpCiAJCQljb250aW51ZTsKIAogCQlp
ZiAoIWk5MTVfdm1hX2hhc191c2VyZmF1bHQodm1hKSkKIAkJCWNvbnRpbnVlOwogCi0JCUdFTV9C
VUdfT04odm1hLT5mZW5jZSAhPSAmaTkxNS0+Z2d0dC5mZW5jZV9yZWdzW2ldKTsKKwkJR0VNX0JV
R19PTih2bWEtPmZlbmNlICE9ICZndC0+Z2d0dC0+ZmVuY2VfcmVnc1tpXSk7CiAJCW5vZGUgPSAm
dm1hLT5vYmotPmJhc2Uudm1hX25vZGU7CiAJCXZtYV9vZmZzZXQgPSB2bWEtPmdndHRfdmlldy5w
YXJ0aWFsLm9mZnNldCA8PCBQQUdFX1NISUZUOwotCQl1bm1hcF9tYXBwaW5nX3JhbmdlKGk5MTUt
PmRybS5hbm9uX2lub2RlLT5pX21hcHBpbmcsCisJCXVubWFwX21hcHBpbmdfcmFuZ2UoZ3QtPmk5
MTUtPmRybS5hbm9uX2lub2RlLT5pX21hcHBpbmcsCiAJCQkJICAgIGRybV92bWFfbm9kZV9vZmZz
ZXRfYWRkcihub2RlKSArIHZtYV9vZmZzZXQsCiAJCQkJICAgIHZtYS0+c2l6ZSwKIAkJCQkgICAg
MSk7CiAJfQogfQogCi1zdGF0aWMgaW50ZWxfZW5naW5lX21hc2tfdCByZXNldF9wcmVwYXJlKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQorc3RhdGljIGludGVsX2VuZ2luZV9tYXNrX3Qg
cmVzZXRfcHJlcGFyZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogewogCXN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZTsKIAlpbnRlbF9lbmdpbmVfbWFza190IGF3YWtlID0gMDsKIAllbnVtIGlu
dGVsX2VuZ2luZV9pZCBpZDsKIAotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7
CisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5MTUsIGlkKSB7CiAJCWlmIChpbnRlbF9l
bmdpbmVfcG1fZ2V0X2lmX2F3YWtlKGVuZ2luZSkpCiAJCQlhd2FrZSB8PSBlbmdpbmUtPm1hc2s7
CiAJCXJlc2V0X3ByZXBhcmVfZW5naW5lKGVuZ2luZSk7CiAJfQogCi0JaW50ZWxfdWNfcmVzZXRf
cHJlcGFyZShpOTE1KTsKKwlpbnRlbF91Y19yZXNldF9wcmVwYXJlKGd0LT5pOTE1KTsKIAogCXJl
dHVybiBhd2FrZTsKIH0KIAotc3RhdGljIHZvaWQgZ3RfcmV2b2tlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQorc3RhdGljIHZvaWQgZ3RfcmV2b2tlKHN0cnVjdCBpbnRlbF9ndCAqZ3Qp
CiB7Ci0JcmV2b2tlX21tYXBzKGk5MTUpOworCXJldm9rZV9tbWFwcyhndCk7CiB9CiAKLXN0YXRp
YyBpbnQgZ3RfcmVzZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCi0JCSAgICBpbnRl
bF9lbmdpbmVfbWFza190IHN0YWxsZWRfbWFzaykKK3N0YXRpYyBpbnQgZ3RfcmVzZXQoc3RydWN0
IGludGVsX2d0ICpndCwgaW50ZWxfZW5naW5lX21hc2tfdCBzdGFsbGVkX21hc2spCiB7CiAJc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwpA
QCAtNzQxLDE0ICs3MzcsMTQgQEAgc3RhdGljIGludCBndF9yZXNldChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKIAkgKiBFdmVyeXRoaW5nIGRlcGVuZHMgb24gaGF2aW5nIHRoZSBHVFQg
cnVubmluZywgc28gd2UgbmVlZCB0byBzdGFydAogCSAqIHRoZXJlLgogCSAqLwotCWVyciA9IGk5
MTVfZ2d0dF9lbmFibGVfaHcoaTkxNSk7CisJZXJyID0gaTkxNV9nZ3R0X2VuYWJsZV9odyhndC0+
aTkxNSk7CiAJaWYgKGVycikKIAkJcmV0dXJuIGVycjsKIAotCWZvcl9lYWNoX2VuZ2luZShlbmdp
bmUsIGk5MTUsIGlkKQotCQlpbnRlbF9lbmdpbmVfcmVzZXQoZW5naW5lLCBzdGFsbGVkX21hc2sg
JiBlbmdpbmUtPm1hc2spOworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LT5pOTE1LCBpZCkK
KwkJX19pbnRlbF9lbmdpbmVfcmVzZXQoZW5naW5lLCBzdGFsbGVkX21hc2sgJiBlbmdpbmUtPm1h
c2spOwogCi0JaTkxNV9nZW1fcmVzdG9yZV9mZW5jZXMoaTkxNSk7CisJaTkxNV9nZW1fcmVzdG9y
ZV9mZW5jZXMoZ3QtPmk5MTUpOwogCiAJcmV0dXJuIGVycjsKIH0KQEAgLTc2MSwxMyArNzU3LDEy
IEBAIHN0YXRpYyB2b2lkIHJlc2V0X2ZpbmlzaF9lbmdpbmUoc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lKQogCWludGVsX2VuZ2luZV9zaWduYWxfYnJlYWRjcnVtYnMoZW5naW5lKTsKIH0K
IAotc3RhdGljIHZvaWQgcmVzZXRfZmluaXNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LAotCQkJIGludGVsX2VuZ2luZV9tYXNrX3QgYXdha2UpCitzdGF0aWMgdm9pZCByZXNldF9maW5p
c2goc3RydWN0IGludGVsX2d0ICpndCwgaW50ZWxfZW5naW5lX21hc2tfdCBhd2FrZSkKIHsKIAlz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7
CiAKLQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgeworCWZvcl9lYWNoX2VuZ2lu
ZShlbmdpbmUsIGd0LT5pOTE1LCBpZCkgewogCQlyZXNldF9maW5pc2hfZW5naW5lKGVuZ2luZSk7
CiAJCWlmIChhd2FrZSAmIGVuZ2luZS0+bWFzaykKIAkJCWludGVsX2VuZ2luZV9wbV9wdXQoZW5n
aW5lKTsKQEAgLTc5MSwyMCArNzg2LDE5IEBAIHN0YXRpYyB2b2lkIG5vcF9zdWJtaXRfcmVxdWVz
dChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0KQogCWludGVsX2VuZ2luZV9xdWV1ZV9icmVh
ZGNydW1icyhlbmdpbmUpOwogfQogCi1zdGF0aWMgdm9pZCBfX2k5MTVfZ2VtX3NldF93ZWRnZWQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCitzdGF0aWMgdm9pZCBfX2ludGVsX2d0X3Nl
dF93ZWRnZWQoc3RydWN0IGludGVsX2d0ICpndCkKIHsKLQlzdHJ1Y3QgaTkxNV9ncHVfZXJyb3Ig
KmVycm9yID0gJmk5MTUtPmdwdV9lcnJvcjsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmU7CiAJaW50ZWxfZW5naW5lX21hc2tfdCBhd2FrZTsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBp
ZDsKIAotCWlmICh0ZXN0X2JpdChJOTE1X1dFREdFRCwgJmVycm9yLT5mbGFncykpCisJaWYgKHRl
c3RfYml0KEk5MTVfV0VER0VELCAmZ3QtPnJlc2V0LmZsYWdzKSkKIAkJcmV0dXJuOwogCi0JaWYg
KEdFTV9TSE9XX0RFQlVHKCkgJiYgIWludGVsX2VuZ2luZXNfYXJlX2lkbGUoaTkxNSkpIHsKKwlp
ZiAoR0VNX1NIT1dfREVCVUcoKSAmJiAhaW50ZWxfZW5naW5lc19hcmVfaWRsZShndCkpIHsKIAkJ
c3RydWN0IGRybV9wcmludGVyIHAgPSBkcm1fZGVidWdfcHJpbnRlcihfX2Z1bmNfXyk7CiAKLQkJ
Zm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpCisJCWZvcl9lYWNoX2VuZ2luZShlbmdp
bmUsIGd0LT5pOTE1LCBpZCkKIAkJCWludGVsX2VuZ2luZV9kdW1wKGVuZ2luZSwgJnAsICIlc1xu
IiwgZW5naW5lLT5uYW1lKTsKIAl9CiAKQEAgLTgxNSwxNyArODA5LDE3IEBAIHN0YXRpYyB2b2lk
IF9faTkxNV9nZW1fc2V0X3dlZGdlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkg
KiByb2xsaW5nIHRoZSBnbG9iYWwgc2Vxbm8gZm9yd2FyZCAoc2luY2UgdGhpcyB3b3VsZCBjb21w
bGV0ZSByZXF1ZXN0cwogCSAqIGZvciB3aGljaCB3ZSBoYXZlbid0IHNldCB0aGUgZmVuY2UgZXJy
b3IgdG8gRUlPIHlldCkuCiAJICovCi0JYXdha2UgPSByZXNldF9wcmVwYXJlKGk5MTUpOworCWF3
YWtlID0gcmVzZXRfcHJlcGFyZShndCk7CiAKIAkvKiBFdmVuIGlmIHRoZSBHUFUgcmVzZXQgZmFp
bHMsIGl0IHNob3VsZCBzdGlsbCBzdG9wIHRoZSBlbmdpbmVzICovCi0JaWYgKCFJTlRFTF9JTkZP
KGk5MTUpLT5ncHVfcmVzZXRfY2xvYmJlcnNfZGlzcGxheSkKLQkJaW50ZWxfZ3B1X3Jlc2V0KGk5
MTUsIEFMTF9FTkdJTkVTKTsKKwlpZiAoIUlOVEVMX0lORk8oZ3QtPmk5MTUpLT5ncHVfcmVzZXRf
Y2xvYmJlcnNfZGlzcGxheSkKKwkJaW50ZWxfZ3B1X3Jlc2V0KGd0LCBBTExfRU5HSU5FUyk7CiAK
LQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgeworCWZvcl9lYWNoX2VuZ2luZShl
bmdpbmUsIGd0LT5pOTE1LCBpZCkgewogCQllbmdpbmUtPnN1Ym1pdF9yZXF1ZXN0ID0gbm9wX3N1
Ym1pdF9yZXF1ZXN0OwogCQllbmdpbmUtPnNjaGVkdWxlID0gTlVMTDsKIAl9Ci0JaTkxNS0+Y2Fw
cy5zY2hlZHVsZXIgPSAwOworCWd0LT5pOTE1LT5jYXBzLnNjaGVkdWxlciA9IDA7CiAKIAkvKgog
CSAqIE1ha2Ugc3VyZSBubyByZXF1ZXN0IGNhbiBzbGlwIHRocm91Z2ggd2l0aG91dCBnZXR0aW5n
IGNvbXBsZXRlZCBieQpAQCAtODMzLDM4ICs4MjcsMzYgQEAgc3RhdGljIHZvaWQgX19pOTE1X2dl
bV9zZXRfd2VkZ2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCSAqIGluIG5vcF9z
dWJtaXRfcmVxdWVzdC4KIAkgKi8KIAlzeW5jaHJvbml6ZV9yY3VfZXhwZWRpdGVkKCk7Ci0Jc2V0
X2JpdChJOTE1X1dFREdFRCwgJmVycm9yLT5mbGFncyk7CisJc2V0X2JpdChJOTE1X1dFREdFRCwg
Jmd0LT5yZXNldC5mbGFncyk7CiAKIAkvKiBNYXJrIGFsbCBleGVjdXRpbmcgcmVxdWVzdHMgYXMg
c2tpcHBlZCAqLwotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKQorCWZvcl9lYWNo
X2VuZ2luZShlbmdpbmUsIGd0LT5pOTE1LCBpZCkKIAkJZW5naW5lLT5jYW5jZWxfcmVxdWVzdHMo
ZW5naW5lKTsKIAotCXJlc2V0X2ZpbmlzaChpOTE1LCBhd2FrZSk7CisJcmVzZXRfZmluaXNoKGd0
LCBhd2FrZSk7CiAKIAlHRU1fVFJBQ0UoImVuZFxuIik7CiB9CiAKLXZvaWQgaTkxNV9nZW1fc2V0
X3dlZGdlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3ZvaWQgaW50ZWxfZ3Rfc2V0
X3dlZGdlZChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogewotCXN0cnVjdCBpOTE1X2dwdV9lcnJvciAq
ZXJyb3IgPSAmaTkxNS0+Z3B1X2Vycm9yOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCi0J
bXV0ZXhfbG9jaygmZXJyb3ItPndlZGdlX211dGV4KTsKLQl3aXRoX2ludGVsX3J1bnRpbWVfcG0o
Jmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpCi0JCV9faTkxNV9nZW1fc2V0X3dlZGdlZChpOTE1
KTsKLQltdXRleF91bmxvY2soJmVycm9yLT53ZWRnZV9tdXRleCk7CisJbXV0ZXhfbG9jaygmZ3Qt
PnJlc2V0Lm11dGV4KTsKKwl3aXRoX2ludGVsX3J1bnRpbWVfcG0oJmd0LT5pOTE1LT5ydW50aW1l
X3BtLCB3YWtlcmVmKQorCQlfX2ludGVsX2d0X3NldF93ZWRnZWQoZ3QpOworCW11dGV4X3VubG9j
aygmZ3QtPnJlc2V0Lm11dGV4KTsKIH0KIAotc3RhdGljIGJvb2wgX19pOTE1X2dlbV91bnNldF93
ZWRnZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCitzdGF0aWMgYm9vbCBfX2ludGVs
X2d0X3Vuc2V0X3dlZGdlZChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogewotCXN0cnVjdCBpOTE1X2dw
dV9lcnJvciAqZXJyb3IgPSAmaTkxNS0+Z3B1X2Vycm9yOwotCXN0cnVjdCBpbnRlbF9ndF90aW1l
bGluZXMgKnRpbWVsaW5lcyA9ICZpOTE1LT5ndC50aW1lbGluZXM7CisJc3RydWN0IGludGVsX2d0
X3RpbWVsaW5lcyAqdGltZWxpbmVzID0gJmd0LT50aW1lbGluZXM7CiAJc3RydWN0IGludGVsX3Rp
bWVsaW5lICp0bDsKIAotCWlmICghdGVzdF9iaXQoSTkxNV9XRURHRUQsICZlcnJvci0+ZmxhZ3Mp
KQorCWlmICghdGVzdF9iaXQoSTkxNV9XRURHRUQsICZndC0+cmVzZXQuZmxhZ3MpKQogCQlyZXR1
cm4gdHJ1ZTsKIAotCWlmICghaTkxNS0+Z3Quc2NyYXRjaCkgLyogTmV2ZXIgZnVsbCBpbml0aWFs
aXNlZCwgcmVjb3ZlcnkgaW1wb3NzaWJsZSAqLworCWlmICghZ3QtPnNjcmF0Y2gpIC8qIE5ldmVy
IGZ1bGwgaW5pdGlhbGlzZWQsIHJlY292ZXJ5IGltcG9zc2libGUgKi8KIAkJcmV0dXJuIGZhbHNl
OwogCiAJR0VNX1RSQUNFKCJzdGFydFxuIik7CkBAIC05MDUsNyArODk3LDcgQEAgc3RhdGljIGJv
b2wgX19pOTE1X2dlbV91bnNldF93ZWRnZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
CiAJfQogCXNwaW5fdW5sb2NrKCZ0aW1lbGluZXMtPmxvY2spOwogCi0JaW50ZWxfZ3Rfc2FuaXRp
emUoJmk5MTUtPmd0LCBmYWxzZSk7CisJaW50ZWxfZ3Rfc2FuaXRpemUoZ3QsIGZhbHNlKTsKIAog
CS8qCiAJICogVW5kbyBub3Bfc3VibWl0X3JlcXVlc3QuIFdlIHByZXZlbnQgYWxsIG5ldyBpOTE1
IHJlcXVlc3RzIGZyb20KQEAgLTkxNiw1MyArOTA4LDUxIEBAIHN0YXRpYyBib29sIF9faTkxNV9n
ZW1fdW5zZXRfd2VkZ2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCSAqIHRoZSBu
b3Bfc3VibWl0X3JlcXVlc3Qgb24gcmVzZXQsIHdlIGNhbiBkbyB0aGlzIGZyb20gbm9ybWFsCiAJ
ICogY29udGV4dCBhbmQgZG8gbm90IHJlcXVpcmUgc3RvcF9tYWNoaW5lKCkuCiAJICovCi0JaW50
ZWxfZW5naW5lc19yZXNldF9kZWZhdWx0X3N1Ym1pc3Npb24oaTkxNSk7CisJaW50ZWxfZW5naW5l
c19yZXNldF9kZWZhdWx0X3N1Ym1pc3Npb24oZ3QpOwogCiAJR0VNX1RSQUNFKCJlbmRcbiIpOwog
CiAJc21wX21iX19iZWZvcmVfYXRvbWljKCk7IC8qIGNvbXBsZXRlIHRha2VvdmVyIGJlZm9yZSBl
bmFibGluZyBleGVjYnVmICovCi0JY2xlYXJfYml0KEk5MTVfV0VER0VELCAmaTkxNS0+Z3B1X2Vy
cm9yLmZsYWdzKTsKKwljbGVhcl9iaXQoSTkxNV9XRURHRUQsICZndC0+cmVzZXQuZmxhZ3MpOwog
CiAJcmV0dXJuIHRydWU7CiB9CiAKLWJvb2wgaTkxNV9nZW1fdW5zZXRfd2VkZ2VkKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQorYm9vbCBpbnRlbF9ndF91bnNldF93ZWRnZWQoc3RydWN0
IGludGVsX2d0ICpndCkKIHsKLQlzdHJ1Y3QgaTkxNV9ncHVfZXJyb3IgKmVycm9yID0gJmk5MTUt
PmdwdV9lcnJvcjsKIAlib29sIHJlc3VsdDsKIAotCW11dGV4X2xvY2soJmVycm9yLT53ZWRnZV9t
dXRleCk7Ci0JcmVzdWx0ID0gX19pOTE1X2dlbV91bnNldF93ZWRnZWQoaTkxNSk7Ci0JbXV0ZXhf
dW5sb2NrKCZlcnJvci0+d2VkZ2VfbXV0ZXgpOworCW11dGV4X2xvY2soJmd0LT5yZXNldC5tdXRl
eCk7CisJcmVzdWx0ID0gX19pbnRlbF9ndF91bnNldF93ZWRnZWQoZ3QpOworCW11dGV4X3VubG9j
aygmZ3QtPnJlc2V0Lm11dGV4KTsKIAogCXJldHVybiByZXN1bHQ7CiB9CiAKLXN0YXRpYyBpbnQg
ZG9fcmVzZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCi0JCSAgICBpbnRlbF9lbmdp
bmVfbWFza190IHN0YWxsZWRfbWFzaykKK3N0YXRpYyBpbnQgZG9fcmVzZXQoc3RydWN0IGludGVs
X2d0ICpndCwgaW50ZWxfZW5naW5lX21hc2tfdCBzdGFsbGVkX21hc2spCiB7CiAJaW50IGVyciwg
aTsKIAotCWd0X3Jldm9rZShpOTE1KTsKKwlndF9yZXZva2UoZ3QpOwogCi0JZXJyID0gaW50ZWxf
Z3B1X3Jlc2V0KGk5MTUsIEFMTF9FTkdJTkVTKTsKKwllcnIgPSBpbnRlbF9ncHVfcmVzZXQoZ3Qs
IEFMTF9FTkdJTkVTKTsKIAlmb3IgKGkgPSAwOyBlcnIgJiYgaSA8IFJFU0VUX01BWF9SRVRSSUVT
OyBpKyspIHsKIAkJbXNsZWVwKDEwICogKGkgKyAxKSk7Ci0JCWVyciA9IGludGVsX2dwdV9yZXNl
dChpOTE1LCBBTExfRU5HSU5FUyk7CisJCWVyciA9IGludGVsX2dwdV9yZXNldChndCwgQUxMX0VO
R0lORVMpOwogCX0KIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwogCi0JcmV0dXJuIGd0X3Jlc2V0
KGk5MTUsIHN0YWxsZWRfbWFzayk7CisJcmV0dXJuIGd0X3Jlc2V0KGd0LCBzdGFsbGVkX21hc2sp
OwogfQogCi1zdGF0aWMgaW50IHJlc3VtZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
K3N0YXRpYyBpbnQgcmVzdW1lKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiB7CiAJc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwogCWludCByZXQ7
CiAKLQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgeworCWZvcl9lYWNoX2VuZ2lu
ZShlbmdpbmUsIGd0LT5pOTE1LCBpZCkgewogCQlyZXQgPSBlbmdpbmUtPnJlc3VtZShlbmdpbmUp
OwogCQlpZiAocmV0KQogCQkJcmV0dXJuIHJldDsKQEAgLTk3Miw4ICs5NjIsOCBAQCBzdGF0aWMg
aW50IHJlc3VtZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIH0KIAogLyoqCi0gKiBp
OTE1X3Jlc2V0IC0gcmVzZXQgY2hpcCBhZnRlciBhIGhhbmcKLSAqIEBpOTE1OiAjZHJtX2k5MTVf
cHJpdmF0ZSB0byByZXNldAorICogaW50ZWxfZ3RfcmVzZXQgLSByZXNldCBjaGlwIGFmdGVyIGEg
aGFuZworICogQGd0OiAjaW50ZWxfZ3QgdG8gcmVzZXQKICAqIEBzdGFsbGVkX21hc2s6IG1hc2sg
b2YgdGhlIHN0YWxsZWQgZW5naW5lcyB3aXRoIHRoZSBndWlsdHkgcmVxdWVzdHMKICAqIEByZWFz
b246IHVzZXIgZXJyb3IgbWVzc2FnZSBmb3Igd2h5IHdlIGFyZSByZXNldHRpbmcKICAqCkBAIC05
ODgsNTAgKzk3OCw1MCBAQCBzdGF0aWMgaW50IHJlc3VtZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKICAqICAgLSByZS1pbml0IGludGVycnVwdCBzdGF0ZQogICogICAtIHJlLWluaXQg
ZGlzcGxheQogICovCi12b2lkIGk5MTVfcmVzZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCi0JCWludGVsX2VuZ2luZV9tYXNrX3Qgc3RhbGxlZF9tYXNrLAotCQljb25zdCBjaGFyICpy
ZWFzb24pCit2b2lkIGludGVsX2d0X3Jlc2V0KHN0cnVjdCBpbnRlbF9ndCAqZ3QsCisJCSAgICBp
bnRlbF9lbmdpbmVfbWFza190IHN0YWxsZWRfbWFzaywKKwkJICAgIGNvbnN0IGNoYXIgKnJlYXNv
bikKIHsKLQlzdHJ1Y3QgaTkxNV9ncHVfZXJyb3IgKmVycm9yID0gJmk5MTUtPmdwdV9lcnJvcjsK
IAlpbnRlbF9lbmdpbmVfbWFza190IGF3YWtlOwogCWludCByZXQ7CiAKLQlHRU1fVFJBQ0UoImZs
YWdzPSVseFxuIiwgZXJyb3ItPmZsYWdzKTsKKwlHRU1fVFJBQ0UoImZsYWdzPSVseFxuIiwgZ3Qt
PnJlc2V0LmZsYWdzKTsKIAogCW1pZ2h0X3NsZWVwKCk7Ci0JR0VNX0JVR19PTighdGVzdF9iaXQo
STkxNV9SRVNFVF9CQUNLT0ZGLCAmZXJyb3ItPmZsYWdzKSk7Ci0JbXV0ZXhfbG9jaygmZXJyb3It
PndlZGdlX211dGV4KTsKKwlHRU1fQlVHX09OKCF0ZXN0X2JpdChJOTE1X1JFU0VUX0JBQ0tPRkYs
ICZndC0+cmVzZXQuZmxhZ3MpKTsKKwltdXRleF9sb2NrKCZndC0+cmVzZXQubXV0ZXgpOwogCiAJ
LyogQ2xlYXIgYW55IHByZXZpb3VzIGZhaWxlZCBhdHRlbXB0cyBhdCByZWNvdmVyeS4gVGltZSB0
byB0cnkgYWdhaW4uICovCi0JaWYgKCFfX2k5MTVfZ2VtX3Vuc2V0X3dlZGdlZChpOTE1KSkKKwlp
ZiAoIV9faW50ZWxfZ3RfdW5zZXRfd2VkZ2VkKGd0KSkKIAkJZ290byB1bmxvY2s7CiAKIAlpZiAo
cmVhc29uKQotCQlkZXZfbm90aWNlKGk5MTUtPmRybS5kZXYsICJSZXNldHRpbmcgY2hpcCBmb3Ig
JXNcbiIsIHJlYXNvbik7Ci0JZXJyb3ItPnJlc2V0X2NvdW50Kys7CisJCWRldl9ub3RpY2UoZ3Qt
Pmk5MTUtPmRybS5kZXYsCisJCQkgICAiUmVzZXR0aW5nIGNoaXAgZm9yICVzXG4iLCByZWFzb24p
OworCWF0b21pY19pbmMoJmd0LT5pOTE1LT5ncHVfZXJyb3IucmVzZXRfY291bnQpOwogCi0JYXdh
a2UgPSByZXNldF9wcmVwYXJlKGk5MTUpOworCWF3YWtlID0gcmVzZXRfcHJlcGFyZShndCk7CiAK
LQlpZiAoIWludGVsX2hhc19ncHVfcmVzZXQoaTkxNSkpIHsKKwlpZiAoIWludGVsX2hhc19ncHVf
cmVzZXQoZ3QtPmk5MTUpKSB7CiAJCWlmIChpOTE1X21vZHBhcmFtcy5yZXNldCkKLQkJCWRldl9l
cnIoaTkxNS0+ZHJtLmRldiwgIkdQVSByZXNldCBub3Qgc3VwcG9ydGVkXG4iKTsKKwkJCWRldl9l
cnIoZ3QtPmk5MTUtPmRybS5kZXYsICJHUFUgcmVzZXQgbm90IHN1cHBvcnRlZFxuIik7CiAJCWVs
c2UKIAkJCURSTV9ERUJVR19EUklWRVIoIkdQVSByZXNldCBkaXNhYmxlZFxuIik7CiAJCWdvdG8g
ZXJyb3I7CiAJfQogCi0JaWYgKElOVEVMX0lORk8oaTkxNSktPmdwdV9yZXNldF9jbG9iYmVyc19k
aXNwbGF5KQotCQlpbnRlbF9ydW50aW1lX3BtX2Rpc2FibGVfaW50ZXJydXB0cyhpOTE1KTsKKwlp
ZiAoSU5URUxfSU5GTyhndC0+aTkxNSktPmdwdV9yZXNldF9jbG9iYmVyc19kaXNwbGF5KQorCQlp
bnRlbF9ydW50aW1lX3BtX2Rpc2FibGVfaW50ZXJydXB0cyhndC0+aTkxNSk7CiAKLQlpZiAoZG9f
cmVzZXQoaTkxNSwgc3RhbGxlZF9tYXNrKSkgewotCQlkZXZfZXJyKGk5MTUtPmRybS5kZXYsICJG
YWlsZWQgdG8gcmVzZXQgY2hpcFxuIik7CisJaWYgKGRvX3Jlc2V0KGd0LCBzdGFsbGVkX21hc2sp
KSB7CisJCWRldl9lcnIoZ3QtPmk5MTUtPmRybS5kZXYsICJGYWlsZWQgdG8gcmVzZXQgY2hpcFxu
Iik7CiAJCWdvdG8gdGFpbnQ7CiAJfQogCi0JaWYgKElOVEVMX0lORk8oaTkxNSktPmdwdV9yZXNl
dF9jbG9iYmVyc19kaXNwbGF5KQotCQlpbnRlbF9ydW50aW1lX3BtX2VuYWJsZV9pbnRlcnJ1cHRz
KGk5MTUpOworCWlmIChJTlRFTF9JTkZPKGd0LT5pOTE1KS0+Z3B1X3Jlc2V0X2Nsb2JiZXJzX2Rp
c3BsYXkpCisJCWludGVsX3J1bnRpbWVfcG1fZW5hYmxlX2ludGVycnVwdHMoZ3QtPmk5MTUpOwog
Ci0JaW50ZWxfb3ZlcmxheV9yZXNldChpOTE1KTsKKwlpbnRlbF9vdmVybGF5X3Jlc2V0KGd0LT5p
OTE1KTsKIAogCS8qCiAJICogTmV4dCB3ZSBuZWVkIHRvIHJlc3RvcmUgdGhlIGNvbnRleHQsIGJ1
dCB3ZSBkb24ndCB1c2UgdGhvc2UKQEAgLTEwNDEsMjMgKzEwMzEsMjMgQEAgdm9pZCBpOTE1X3Jl
c2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCSAqIHdhcyBydW5uaW5nIGF0IHRo
ZSB0aW1lIG9mIHRoZSByZXNldCAoaS5lLiB3ZSB3ZXJlbid0IFZUCiAJICogc3dpdGNoZWQgYXdh
eSkuCiAJICovCi0JcmV0ID0gaTkxNV9nZW1faW5pdF9odyhpOTE1KTsKKwlyZXQgPSBpOTE1X2dl
bV9pbml0X2h3KGd0LT5pOTE1KTsKIAlpZiAocmV0KSB7CiAJCURSTV9FUlJPUigiRmFpbGVkIHRv
IGluaXRpYWxpc2UgSFcgZm9sbG93aW5nIHJlc2V0ICglZClcbiIsCiAJCQkgIHJldCk7CiAJCWdv
dG8gdGFpbnQ7CiAJfQogCi0JcmV0ID0gcmVzdW1lKGk5MTUpOworCXJldCA9IHJlc3VtZShndCk7
CiAJaWYgKHJldCkKIAkJZ290byB0YWludDsKIAotCWk5MTVfcXVldWVfaGFuZ2NoZWNrKGk5MTUp
OworCWludGVsX2d0X3F1ZXVlX2hhbmdjaGVjayhndCk7CiAKIGZpbmlzaDoKLQlyZXNldF9maW5p
c2goaTkxNSwgYXdha2UpOworCXJlc2V0X2ZpbmlzaChndCwgYXdha2UpOwogdW5sb2NrOgotCW11
dGV4X3VubG9jaygmZXJyb3ItPndlZGdlX211dGV4KTsKKwltdXRleF91bmxvY2soJmd0LT5yZXNl
dC5tdXRleCk7CiAJcmV0dXJuOwogCiB0YWludDoKQEAgLTEwNzUsMTggKzEwNjUsMTcgQEAgdm9p
ZCBpOTE1X3Jlc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCSAqLwogCWFkZF90
YWludF9mb3JfQ0koVEFJTlRfV0FSTik7CiBlcnJvcjoKLQlfX2k5MTVfZ2VtX3NldF93ZWRnZWQo
aTkxNSk7CisJX19pbnRlbF9ndF9zZXRfd2VkZ2VkKGd0KTsKIAlnb3RvIGZpbmlzaDsKIH0KIAot
c3RhdGljIGlubGluZSBpbnQgaW50ZWxfZ3RfcmVzZXRfZW5naW5lKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAotCQkJCQlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCitzdGF0
aWMgaW5saW5lIGludCBpbnRlbF9ndF9yZXNldF9lbmdpbmUoc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lKQogewotCXJldHVybiBpbnRlbF9ncHVfcmVzZXQoaTkxNSwgZW5naW5lLT5tYXNr
KTsKKwlyZXR1cm4gaW50ZWxfZ3B1X3Jlc2V0KGVuZ2luZS0+Z3QsIGVuZ2luZS0+bWFzayk7CiB9
CiAKIC8qKgotICogaTkxNV9yZXNldF9lbmdpbmUgLSByZXNldCBHUFUgZW5naW5lIHRvIHJlY292
ZXIgZnJvbSBhIGhhbmcKKyAqIGludGVsX2VuZ2luZV9yZXNldCAtIHJlc2V0IEdQVSBlbmdpbmUg
dG8gcmVjb3ZlciBmcm9tIGEgaGFuZwogICogQGVuZ2luZTogZW5naW5lIHRvIHJlc2V0CiAgKiBA
bXNnOiByZWFzb24gZm9yIEdQVSByZXNldDsgb3IgTlVMTCBmb3Igbm8gZGV2X25vdGljZSgpCiAg
KgpAQCAtMTA5OCwxMyArMTA4NywxMyBAQCBzdGF0aWMgaW5saW5lIGludCBpbnRlbF9ndF9yZXNl
dF9lbmdpbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAgKiAgLSByZXNldCBlbmdp
bmUgKHdoaWNoIHdpbGwgZm9yY2UgdGhlIGVuZ2luZSB0byBpZGxlKQogICogIC0gcmUtaW5pdC9j
b25maWd1cmUgZW5naW5lCiAgKi8KLWludCBpOTE1X3Jlc2V0X2VuZ2luZShzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmUsIGNvbnN0IGNoYXIgKm1zZykKK2ludCBpbnRlbF9lbmdpbmVfcmVz
ZXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBjb25zdCBjaGFyICptc2cpCiB7Ci0J
c3RydWN0IGk5MTVfZ3B1X2Vycm9yICplcnJvciA9ICZlbmdpbmUtPmk5MTUtPmdwdV9lcnJvcjsK
KwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gZW5naW5lLT5ndDsKIAlpbnQgcmV0OwogCi0JR0VNX1RS
QUNFKCIlcyBmbGFncz0lbHhcbiIsIGVuZ2luZS0+bmFtZSwgZXJyb3ItPmZsYWdzKTsKLQlHRU1f
QlVHX09OKCF0ZXN0X2JpdChJOTE1X1JFU0VUX0VOR0lORSArIGVuZ2luZS0+aWQsICZlcnJvci0+
ZmxhZ3MpKTsKKwlHRU1fVFJBQ0UoIiVzIGZsYWdzPSVseFxuIiwgZW5naW5lLT5uYW1lLCBndC0+
cmVzZXQuZmxhZ3MpOworCUdFTV9CVUdfT04oIXRlc3RfYml0KEk5MTVfUkVTRVRfRU5HSU5FICsg
ZW5naW5lLT5pZCwgJmd0LT5yZXNldC5mbGFncykpOwogCiAJaWYgKCFpbnRlbF9lbmdpbmVfcG1f
Z2V0X2lmX2F3YWtlKGVuZ2luZSkpCiAJCXJldHVybiAwOwpAQCAtMTExNCwxMCArMTEwMywxMCBA
QCBpbnQgaTkxNV9yZXNldF9lbmdpbmUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBj
b25zdCBjaGFyICptc2cpCiAJaWYgKG1zZykKIAkJZGV2X25vdGljZShlbmdpbmUtPmk5MTUtPmRy
bS5kZXYsCiAJCQkgICAiUmVzZXR0aW5nICVzIGZvciAlc1xuIiwgZW5naW5lLT5uYW1lLCBtc2cp
OwotCWVycm9yLT5yZXNldF9lbmdpbmVfY291bnRbZW5naW5lLT5pZF0rKzsKKwlhdG9taWNfaW5j
KCZlbmdpbmUtPmk5MTUtPmdwdV9lcnJvci5yZXNldF9lbmdpbmVfY291bnRbZW5naW5lLT51YWJp
X2NsYXNzXSk7CiAKIAlpZiAoIWVuZ2luZS0+aTkxNS0+Z3VjLmV4ZWNidWZfY2xpZW50KQotCQly
ZXQgPSBpbnRlbF9ndF9yZXNldF9lbmdpbmUoZW5naW5lLT5pOTE1LCBlbmdpbmUpOworCQlyZXQg
PSBpbnRlbF9ndF9yZXNldF9lbmdpbmUoZW5naW5lKTsKIAllbHNlCiAJCXJldCA9IGludGVsX2d1
Y19yZXNldF9lbmdpbmUoJmVuZ2luZS0+aTkxNS0+Z3VjLCBlbmdpbmUpOwogCWlmIChyZXQpIHsK
QEAgLTExMzMsNyArMTEyMiw3IEBAIGludCBpOTE1X3Jlc2V0X2VuZ2luZShzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmUsIGNvbnN0IGNoYXIgKm1zZykKIAkgKiBhY3RpdmUgcmVxdWVzdCBh
bmQgY2FuIGRyb3AgaXQsIGFkanVzdCBoZWFkIHRvIHNraXAgdGhlIG9mZmVuZGluZwogCSAqIHJl
cXVlc3QgdG8gcmVzdW1lIGV4ZWN1dGluZyByZW1haW5pbmcgcmVxdWVzdHMgaW4gdGhlIHF1ZXVl
LgogCSAqLwotCWludGVsX2VuZ2luZV9yZXNldChlbmdpbmUsIHRydWUpOworCV9faW50ZWxfZW5n
aW5lX3Jlc2V0KGVuZ2luZSwgdHJ1ZSk7CiAKIAkvKgogCSAqIFRoZSBlbmdpbmUgYW5kIGl0cyBy
ZWdpc3RlcnMgKGFuZCB3b3JrYXJvdW5kcyBpbiBjYXNlIG9mIHJlbmRlcikKQEAgLTExNDksMTYg
KzExMzgsMTUgQEAgaW50IGk5MTVfcmVzZXRfZW5naW5lKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZSwgY29uc3QgY2hhciAqbXNnKQogCXJldHVybiByZXQ7CiB9CiAKLXN0YXRpYyB2b2lk
IGk5MTVfcmVzZXRfZGV2aWNlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAotCQkJICAg
ICAgdTMyIGVuZ2luZV9tYXNrLAotCQkJICAgICAgY29uc3QgY2hhciAqcmVhc29uKQorc3RhdGlj
IHZvaWQgaW50ZWxfZ3RfcmVzZXRfZ2xvYmFsKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCisJCQkJICB1
MzIgZW5naW5lX21hc2ssCisJCQkJICBjb25zdCBjaGFyICpyZWFzb24pCiB7Ci0Jc3RydWN0IGk5
MTVfZ3B1X2Vycm9yICplcnJvciA9ICZpOTE1LT5ncHVfZXJyb3I7Ci0Jc3RydWN0IGtvYmplY3Qg
KmtvYmogPSAmaTkxNS0+ZHJtLnByaW1hcnktPmtkZXYtPmtvYmo7CisJc3RydWN0IGtvYmplY3Qg
KmtvYmogPSAmZ3QtPmk5MTUtPmRybS5wcmltYXJ5LT5rZGV2LT5rb2JqOwogCWNoYXIgKmVycm9y
X2V2ZW50W10gPSB7IEk5MTVfRVJST1JfVUVWRU5UICI9MSIsIE5VTEwgfTsKIAljaGFyICpyZXNl
dF9ldmVudFtdID0geyBJOTE1X1JFU0VUX1VFVkVOVCAiPTEiLCBOVUxMIH07CiAJY2hhciAqcmVz
ZXRfZG9uZV9ldmVudFtdID0geyBJOTE1X0VSUk9SX1VFVkVOVCAiPTAiLCBOVUxMIH07Ci0Jc3Ry
dWN0IGk5MTVfd2VkZ2VfbWUgdzsKKwlzdHJ1Y3QgaW50ZWxfd2VkZ2VfbWUgdzsKIAogCWtvYmpl
Y3RfdWV2ZW50X2Vudihrb2JqLCBLT0JKX0NIQU5HRSwgZXJyb3JfZXZlbnQpOwogCkBAIC0xMTY2
LDI0ICsxMTU0LDI0IEBAIHN0YXRpYyB2b2lkIGk5MTVfcmVzZXRfZGV2aWNlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCWtvYmplY3RfdWV2ZW50X2Vudihrb2JqLCBLT0JKX0NIQU5H
RSwgcmVzZXRfZXZlbnQpOwogCiAJLyogVXNlIGEgd2F0Y2hkb2cgdG8gZW5zdXJlIHRoYXQgb3Vy
IHJlc2V0IGNvbXBsZXRlcyAqLwotCWk5MTVfd2VkZ2Vfb25fdGltZW91dCgmdywgaTkxNSwgNSAq
IEhaKSB7Ci0JCWludGVsX3ByZXBhcmVfcmVzZXQoaTkxNSk7CisJaW50ZWxfd2VkZ2Vfb25fdGlt
ZW91dCgmdywgZ3QsIDUgKiBIWikgeworCQlpbnRlbF9wcmVwYXJlX3Jlc2V0KGd0LT5pOTE1KTsK
IAogCQkvKiBGbHVzaCBldmVyeW9uZSB1c2luZyBhIHJlc291cmNlIGFib3V0IHRvIGJlIGNsb2Ji
ZXJlZCAqLwotCQlzeW5jaHJvbml6ZV9zcmN1X2V4cGVkaXRlZCgmZXJyb3ItPnJlc2V0X2JhY2tv
ZmZfc3JjdSk7CisJCXN5bmNocm9uaXplX3NyY3VfZXhwZWRpdGVkKCZndC0+cmVzZXQuYmFja29m
Zl9zcmN1KTsKIAotCQlpOTE1X3Jlc2V0KGk5MTUsIGVuZ2luZV9tYXNrLCByZWFzb24pOworCQlp
bnRlbF9ndF9yZXNldChndCwgZW5naW5lX21hc2ssIHJlYXNvbik7CiAKLQkJaW50ZWxfZmluaXNo
X3Jlc2V0KGk5MTUpOworCQlpbnRlbF9maW5pc2hfcmVzZXQoZ3QtPmk5MTUpOwogCX0KIAotCWlm
ICghdGVzdF9iaXQoSTkxNV9XRURHRUQsICZlcnJvci0+ZmxhZ3MpKQorCWlmICghdGVzdF9iaXQo
STkxNV9XRURHRUQsICZndC0+cmVzZXQuZmxhZ3MpKQogCQlrb2JqZWN0X3VldmVudF9lbnYoa29i
aiwgS09CSl9DSEFOR0UsIHJlc2V0X2RvbmVfZXZlbnQpOwogfQogCiAvKioKLSAqIGk5MTVfaGFu
ZGxlX2Vycm9yIC0gaGFuZGxlIGEgZ3B1IGVycm9yCi0gKiBAaTkxNTogaTkxNSBkZXZpY2UgcHJp
dmF0ZQorICogaW50ZWxfZ3RfaGFuZGxlX2Vycm9yIC0gaGFuZGxlIGEgZ3B1IGVycm9yCisgKiBA
Z3Q6IHRoZSBpbnRlbF9ndAogICogQGVuZ2luZV9tYXNrOiBtYXNrIHJlcHJlc2VudGluZyBlbmdp
bmVzIHRoYXQgYXJlIGh1bmcKICAqIEBmbGFnczogY29udHJvbCBmbGFncwogICogQGZtdDogRXJy
b3IgbWVzc2FnZSBmb3JtYXQgc3RyaW5nCkBAIC0xMTk0LDEyICsxMTgyLDExIEBAIHN0YXRpYyB2
b2lkIGk5MTVfcmVzZXRfZGV2aWNlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogICog
c28gdXNlcnNwYWNlIGtub3dzIHNvbWV0aGluZyBiYWQgaGFwcGVuZWQgKHNob3VsZCB0cmlnZ2Vy
IGNvbGxlY3Rpb24KICAqIG9mIGEgcmluZyBkdW1wIGV0Yy4pLgogICovCi12b2lkIGk5MTVfaGFu
ZGxlX2Vycm9yKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAotCQkgICAgICAgaW50ZWxf
ZW5naW5lX21hc2tfdCBlbmdpbmVfbWFzaywKLQkJICAgICAgIHVuc2lnbmVkIGxvbmcgZmxhZ3Ms
Ci0JCSAgICAgICBjb25zdCBjaGFyICpmbXQsIC4uLikKK3ZvaWQgaW50ZWxfZ3RfaGFuZGxlX2Vy
cm9yKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCisJCQkgICBpbnRlbF9lbmdpbmVfbWFza190IGVuZ2lu
ZV9tYXNrLAorCQkJICAgdW5zaWduZWQgbG9uZyBmbGFncywKKwkJCSAgIGNvbnN0IGNoYXIgKmZt
dCwgLi4uKQogewotCXN0cnVjdCBpOTE1X2dwdV9lcnJvciAqZXJyb3IgPSAmaTkxNS0+Z3B1X2Vy
cm9yOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAlpbnRlbF93YWtlcmVmX3Qg
d2FrZXJlZjsKIAlpbnRlbF9lbmdpbmVfbWFza190IHRtcDsKQEAgLTEyMjMsMzMgKzEyMTAsMzEg
QEAgdm9pZCBpOTE1X2hhbmRsZV9lcnJvcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAkgKiBpc24ndCB0aGUgY2FzZSBhdCBsZWFzdCB3aGVuIHdlIGdldCBoZXJlIGJ5IGRvaW5nIGEK
IAkgKiBzaW11bGF0ZWQgcmVzZXQgdmlhIGRlYnVnZnMsIHNvIGdldCBhbiBSUE0gcmVmZXJlbmNl
LgogCSAqLwotCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9w
bSk7CisJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZndC0+aTkxNS0+cnVudGltZV9w
bSk7CiAKLQllbmdpbmVfbWFzayAmPSBJTlRFTF9JTkZPKGk5MTUpLT5lbmdpbmVfbWFzazsKKwll
bmdpbmVfbWFzayAmPSBJTlRFTF9JTkZPKGd0LT5pOTE1KS0+ZW5naW5lX21hc2s7CiAKIAlpZiAo
ZmxhZ3MgJiBJOTE1X0VSUk9SX0NBUFRVUkUpIHsKLQkJaTkxNV9jYXB0dXJlX2Vycm9yX3N0YXRl
KGk5MTUsIGVuZ2luZV9tYXNrLCBtc2cpOwotCQlpbnRlbF9ndF9jbGVhcl9lcnJvcl9yZWdpc3Rl
cnMoJmk5MTUtPmd0LCBlbmdpbmVfbWFzayk7CisJCWk5MTVfY2FwdHVyZV9lcnJvcl9zdGF0ZShn
dC0+aTkxNSwgZW5naW5lX21hc2ssIG1zZyk7CisJCWludGVsX2d0X2NsZWFyX2Vycm9yX3JlZ2lz
dGVycyhndCwgZW5naW5lX21hc2spOwogCX0KIAogCS8qCiAJICogVHJ5IGVuZ2luZSByZXNldCB3
aGVuIGF2YWlsYWJsZS4gV2UgZmFsbCBiYWNrIHRvIGZ1bGwgcmVzZXQgaWYKIAkgKiBzaW5nbGUg
cmVzZXQgZmFpbHMuCiAJICovCi0JaWYgKGludGVsX2hhc19yZXNldF9lbmdpbmUoaTkxNSkgJiYg
IV9faTkxNV93ZWRnZWQoZXJyb3IpKSB7Ci0JCWZvcl9lYWNoX2VuZ2luZV9tYXNrZWQoZW5naW5l
LCBpOTE1LCBlbmdpbmVfbWFzaywgdG1wKSB7CisJaWYgKGludGVsX2hhc19yZXNldF9lbmdpbmUo
Z3QtPmk5MTUpICYmICFpbnRlbF9ndF9pc193ZWRnZWQoZ3QpKSB7CisJCWZvcl9lYWNoX2VuZ2lu
ZV9tYXNrZWQoZW5naW5lLCBndC0+aTkxNSwgZW5naW5lX21hc2ssIHRtcCkgewogCQkJQlVJTERf
QlVHX09OKEk5MTVfUkVTRVRfTU9ERVNFVCA+PSBJOTE1X1JFU0VUX0VOR0lORSk7CiAJCQlpZiAo
dGVzdF9hbmRfc2V0X2JpdChJOTE1X1JFU0VUX0VOR0lORSArIGVuZ2luZS0+aWQsCi0JCQkJCSAg
ICAgJmVycm9yLT5mbGFncykpCisJCQkJCSAgICAgJmd0LT5yZXNldC5mbGFncykpCiAJCQkJY29u
dGludWU7CiAKLQkJCWlmIChpOTE1X3Jlc2V0X2VuZ2luZShlbmdpbmUsIG1zZykgPT0gMCkKKwkJ
CWlmIChpbnRlbF9lbmdpbmVfcmVzZXQoZW5naW5lLCBtc2cpID09IDApCiAJCQkJZW5naW5lX21h
c2sgJj0gfmVuZ2luZS0+bWFzazsKIAotCQkJY2xlYXJfYml0KEk5MTVfUkVTRVRfRU5HSU5FICsg
ZW5naW5lLT5pZCwKLQkJCQkgICZlcnJvci0+ZmxhZ3MpOwotCQkJd2FrZV91cF9iaXQoJmVycm9y
LT5mbGFncywKLQkJCQkgICAgSTkxNV9SRVNFVF9FTkdJTkUgKyBlbmdpbmUtPmlkKTsKKwkJCWNs
ZWFyX2FuZF93YWtlX3VwX2JpdChJOTE1X1JFU0VUX0VOR0lORSArIGVuZ2luZS0+aWQsCisJCQkJ
CSAgICAgICZndC0+cmVzZXQuZmxhZ3MpOwogCQl9CiAJfQogCkBAIC0xMjU3LDkgKzEyNDIsOSBA
QCB2b2lkIGk5MTVfaGFuZGxlX2Vycm9yKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAog
CQlnb3RvIG91dDsKIAogCS8qIEZ1bGwgcmVzZXQgbmVlZHMgdGhlIG11dGV4LCBzdG9wIGFueSBv
dGhlciB1c2VyIHRyeWluZyB0byBkbyBzby4gKi8KLQlpZiAodGVzdF9hbmRfc2V0X2JpdChJOTE1
X1JFU0VUX0JBQ0tPRkYsICZlcnJvci0+ZmxhZ3MpKSB7Ci0JCXdhaXRfZXZlbnQoZXJyb3ItPnJl
c2V0X3F1ZXVlLAotCQkJICAgIXRlc3RfYml0KEk5MTVfUkVTRVRfQkFDS09GRiwgJmVycm9yLT5m
bGFncykpOworCWlmICh0ZXN0X2FuZF9zZXRfYml0KEk5MTVfUkVTRVRfQkFDS09GRiwgJmd0LT5y
ZXNldC5mbGFncykpIHsKKwkJd2FpdF9ldmVudChndC0+cmVzZXQucXVldWUsCisJCQkgICAhdGVz
dF9iaXQoSTkxNV9SRVNFVF9CQUNLT0ZGLCAmZ3QtPnJlc2V0LmZsYWdzKSk7CiAJCWdvdG8gb3V0
OyAvKiBwaWdneS1iYWNrIG9uIHRoZSBvdGhlciByZXNldCAqLwogCX0KIApAQCAtMTI2NywxMTMg
KzEyNTIsMTE5IEBAIHZvaWQgaTkxNV9oYW5kbGVfZXJyb3Ioc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCiAJc3luY2hyb25pemVfcmN1X2V4cGVkaXRlZCgpOwogCiAJLyogUHJldmVudCBh
bnkgb3RoZXIgcmVzZXQtZW5naW5lIGF0dGVtcHQuICovCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2lu
ZSwgaTkxNSwgdG1wKSB7CisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5MTUsIHRtcCkg
ewogCQl3aGlsZSAodGVzdF9hbmRfc2V0X2JpdChJOTE1X1JFU0VUX0VOR0lORSArIGVuZ2luZS0+
aWQsCi0JCQkJCSZlcnJvci0+ZmxhZ3MpKQotCQkJd2FpdF9vbl9iaXQoJmVycm9yLT5mbGFncywK
KwkJCQkJJmd0LT5yZXNldC5mbGFncykpCisJCQl3YWl0X29uX2JpdCgmZ3QtPnJlc2V0LmZsYWdz
LAogCQkJCSAgICBJOTE1X1JFU0VUX0VOR0lORSArIGVuZ2luZS0+aWQsCiAJCQkJICAgIFRBU0tf
VU5JTlRFUlJVUFRJQkxFKTsKIAl9CiAKLQlpOTE1X3Jlc2V0X2RldmljZShpOTE1LCBlbmdpbmVf
bWFzaywgbXNnKTsKKwlpbnRlbF9ndF9yZXNldF9nbG9iYWwoZ3QsIGVuZ2luZV9tYXNrLCBtc2cp
OwogCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgdG1wKSB7Ci0JCWNsZWFyX2JpdChJ
OTE1X1JFU0VUX0VOR0lORSArIGVuZ2luZS0+aWQsCi0JCQkgICZlcnJvci0+ZmxhZ3MpOwotCX0K
LQotCWNsZWFyX2JpdChJOTE1X1JFU0VUX0JBQ0tPRkYsICZlcnJvci0+ZmxhZ3MpOwotCXdha2Vf
dXBfYWxsKCZlcnJvci0+cmVzZXRfcXVldWUpOworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0
LT5pOTE1LCB0bXApCisJCWNsZWFyX2JpdF91bmxvY2soSTkxNV9SRVNFVF9FTkdJTkUgKyBlbmdp
bmUtPmlkLAorCQkJCSAmZ3QtPnJlc2V0LmZsYWdzKTsKKwljbGVhcl9iaXRfdW5sb2NrKEk5MTVf
UkVTRVRfQkFDS09GRiwgJmd0LT5yZXNldC5mbGFncyk7CisJc21wX21iX19hZnRlcl9hdG9taWMo
KTsKKwl3YWtlX3VwX2FsbCgmZ3QtPnJlc2V0LnF1ZXVlKTsKIAogb3V0OgotCWludGVsX3J1bnRp
bWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKKwlpbnRlbF9ydW50aW1lX3Bt
X3B1dCgmZ3QtPmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwogfQogCi1pbnQgaTkxNV9yZXNl
dF90cnlsb2NrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQoraW50IGludGVsX2d0X3Jl
c2V0X3RyeWxvY2soc3RydWN0IGludGVsX2d0ICpndCkKIHsKLQlzdHJ1Y3QgaTkxNV9ncHVfZXJy
b3IgKmVycm9yID0gJmk5MTUtPmdwdV9lcnJvcjsKIAlpbnQgc3JjdTsKIAotCW1pZ2h0X2xvY2so
JmVycm9yLT5yZXNldF9iYWNrb2ZmX3NyY3UpOworCW1pZ2h0X2xvY2soJmd0LT5yZXNldC5iYWNr
b2ZmX3NyY3UpOwogCW1pZ2h0X3NsZWVwKCk7CiAKIAlyY3VfcmVhZF9sb2NrKCk7Ci0Jd2hpbGUg
KHRlc3RfYml0KEk5MTVfUkVTRVRfQkFDS09GRiwgJmVycm9yLT5mbGFncykpIHsKKwl3aGlsZSAo
dGVzdF9iaXQoSTkxNV9SRVNFVF9CQUNLT0ZGLCAmZ3QtPnJlc2V0LmZsYWdzKSkgewogCQlyY3Vf
cmVhZF91bmxvY2soKTsKIAotCQlpZiAod2FpdF9ldmVudF9pbnRlcnJ1cHRpYmxlKGVycm9yLT5y
ZXNldF9xdWV1ZSwKKwkJaWYgKHdhaXRfZXZlbnRfaW50ZXJydXB0aWJsZShndC0+cmVzZXQucXVl
dWUsCiAJCQkJCSAgICAgIXRlc3RfYml0KEk5MTVfUkVTRVRfQkFDS09GRiwKLQkJCQkJCSAgICAg
ICAmZXJyb3ItPmZsYWdzKSkpCisJCQkJCQkgICAgICAgJmd0LT5yZXNldC5mbGFncykpKQogCQkJ
cmV0dXJuIC1FSU5UUjsKIAogCQlyY3VfcmVhZF9sb2NrKCk7CiAJfQotCXNyY3UgPSBzcmN1X3Jl
YWRfbG9jaygmZXJyb3ItPnJlc2V0X2JhY2tvZmZfc3JjdSk7CisJc3JjdSA9IHNyY3VfcmVhZF9s
b2NrKCZndC0+cmVzZXQuYmFja29mZl9zcmN1KTsKIAlyY3VfcmVhZF91bmxvY2soKTsKIAogCXJl
dHVybiBzcmN1OwogfQogCi12b2lkIGk5MTVfcmVzZXRfdW5sb2NrKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LCBpbnQgdGFnKQotX19yZWxlYXNlcygmaTkxNS0+Z3B1X2Vycm9yLnJlc2V0
X2JhY2tvZmZfc3JjdSkKK3ZvaWQgaW50ZWxfZ3RfcmVzZXRfdW5sb2NrKHN0cnVjdCBpbnRlbF9n
dCAqZ3QsIGludCB0YWcpCitfX3JlbGVhc2VzKCZndC0+cmVzZXQuYmFja29mZl9zcmN1KQogewot
CXN0cnVjdCBpOTE1X2dwdV9lcnJvciAqZXJyb3IgPSAmaTkxNS0+Z3B1X2Vycm9yOwotCi0Jc3Jj
dV9yZWFkX3VubG9jaygmZXJyb3ItPnJlc2V0X2JhY2tvZmZfc3JjdSwgdGFnKTsKKwlzcmN1X3Jl
YWRfdW5sb2NrKCZndC0+cmVzZXQuYmFja29mZl9zcmN1LCB0YWcpOwogfQogCi1pbnQgaTkxNV90
ZXJtaW5hbGx5X3dlZGdlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK2ludCBpbnRl
bF9ndF90ZXJtaW5hbGx5X3dlZGdlZChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogewotCXN0cnVjdCBp
OTE1X2dwdV9lcnJvciAqZXJyb3IgPSAmaTkxNS0+Z3B1X2Vycm9yOwotCiAJbWlnaHRfc2xlZXAo
KTsKIAotCWlmICghX19pOTE1X3dlZGdlZChlcnJvcikpCisJaWYgKCFpbnRlbF9ndF9pc193ZWRn
ZWQoZ3QpKQogCQlyZXR1cm4gMDsKIAogCS8qIFJlc2V0IHN0aWxsIGluIHByb2dyZXNzPyBNYXli
ZSB3ZSB3aWxsIHJlY292ZXI/ICovCi0JaWYgKCF0ZXN0X2JpdChJOTE1X1JFU0VUX0JBQ0tPRkYs
ICZlcnJvci0+ZmxhZ3MpKQorCWlmICghdGVzdF9iaXQoSTkxNV9SRVNFVF9CQUNLT0ZGLCAmZ3Qt
PnJlc2V0LmZsYWdzKSkKIAkJcmV0dXJuIC1FSU87CiAKIAkvKiBYWFggaW50ZWxfcmVzZXRfZmlu
aXNoKCkgc3RpbGwgdGFrZXMgc3RydWN0X211dGV4ISEhICovCi0JaWYgKG11dGV4X2lzX2xvY2tl
ZCgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCkpCisJaWYgKG11dGV4X2lzX2xvY2tlZCgmZ3QtPmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpKQogCQlyZXR1cm4gLUVBR0FJTjsKIAotCWlmICh3YWl0X2V2
ZW50X2ludGVycnVwdGlibGUoZXJyb3ItPnJlc2V0X3F1ZXVlLAorCWlmICh3YWl0X2V2ZW50X2lu
dGVycnVwdGlibGUoZ3QtPnJlc2V0LnF1ZXVlLAogCQkJCSAgICAgIXRlc3RfYml0KEk5MTVfUkVT
RVRfQkFDS09GRiwKLQkJCQkJICAgICAgICZlcnJvci0+ZmxhZ3MpKSkKKwkJCQkJICAgICAgICZn
dC0+cmVzZXQuZmxhZ3MpKSkKIAkJcmV0dXJuIC1FSU5UUjsKIAotCXJldHVybiBfX2k5MTVfd2Vk
Z2VkKGVycm9yKSA/IC1FSU8gOiAwOworCXJldHVybiBpbnRlbF9ndF9pc193ZWRnZWQoZ3QpID8g
LUVJTyA6IDA7Cit9CisKK3ZvaWQgaW50ZWxfZ3RfaW5pdF9yZXNldChzdHJ1Y3QgaW50ZWxfZ3Qg
Kmd0KQoreworCWluaXRfd2FpdHF1ZXVlX2hlYWQoJmd0LT5yZXNldC5xdWV1ZSk7CisJbXV0ZXhf
aW5pdCgmZ3QtPnJlc2V0Lm11dGV4KTsKKwlpbml0X3NyY3Vfc3RydWN0KCZndC0+cmVzZXQuYmFj
a29mZl9zcmN1KTsKK30KKwordm9pZCBpbnRlbF9ndF9maW5pX3Jlc2V0KHN0cnVjdCBpbnRlbF9n
dCAqZ3QpCit7CisJY2xlYW51cF9zcmN1X3N0cnVjdCgmZ3QtPnJlc2V0LmJhY2tvZmZfc3JjdSk7
CiB9CiAKLXN0YXRpYyB2b2lkIGk5MTVfd2VkZ2VfbWUoc3RydWN0IHdvcmtfc3RydWN0ICp3b3Jr
KQorc3RhdGljIHZvaWQgaW50ZWxfd2VkZ2VfbWUoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQog
ewotCXN0cnVjdCBpOTE1X3dlZGdlX21lICp3ID0gY29udGFpbmVyX29mKHdvcmssIHR5cGVvZigq
dyksIHdvcmsud29yayk7CisJc3RydWN0IGludGVsX3dlZGdlX21lICp3ID0gY29udGFpbmVyX29m
KHdvcmssIHR5cGVvZigqdyksIHdvcmsud29yayk7CiAKLQlkZXZfZXJyKHctPmk5MTUtPmRybS5k
ZXYsCisJZGV2X2Vycih3LT5ndC0+aTkxNS0+ZHJtLmRldiwKIAkJIiVzIHRpbWVkIG91dCwgY2Fu
Y2VsbGluZyBhbGwgaW4tZmxpZ2h0IHJlbmRlcmluZy5cbiIsCiAJCXctPm5hbWUpOwotCWk5MTVf
Z2VtX3NldF93ZWRnZWQody0+aTkxNSk7CisJaW50ZWxfZ3Rfc2V0X3dlZGdlZCh3LT5ndCk7CiB9
CiAKLXZvaWQgX19pOTE1X2luaXRfd2VkZ2Uoc3RydWN0IGk5MTVfd2VkZ2VfbWUgKncsCi0JCSAg
ICAgICBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKLQkJICAgICAgIGxvbmcgdGltZW91
dCwKLQkJICAgICAgIGNvbnN0IGNoYXIgKm5hbWUpCit2b2lkIF9faW50ZWxfaW5pdF93ZWRnZShz
dHJ1Y3QgaW50ZWxfd2VkZ2VfbWUgKncsCisJCQlzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAorCQkJbG9u
ZyB0aW1lb3V0LAorCQkJY29uc3QgY2hhciAqbmFtZSkKIHsKLQl3LT5pOTE1ID0gaTkxNTsKKwl3
LT5ndCA9IGd0OwogCXctPm5hbWUgPSBuYW1lOwogCi0JSU5JVF9ERUxBWUVEX1dPUktfT05TVEFD
Sygmdy0+d29yaywgaTkxNV93ZWRnZV9tZSk7CisJSU5JVF9ERUxBWUVEX1dPUktfT05TVEFDSygm
dy0+d29yaywgaW50ZWxfd2VkZ2VfbWUpOwogCXNjaGVkdWxlX2RlbGF5ZWRfd29yaygmdy0+d29y
aywgdGltZW91dCk7CiB9CiAKLXZvaWQgX19pOTE1X2Zpbmlfd2VkZ2Uoc3RydWN0IGk5MTVfd2Vk
Z2VfbWUgKncpCit2b2lkIF9faW50ZWxfZmluaV93ZWRnZShzdHJ1Y3QgaW50ZWxfd2VkZ2VfbWUg
KncpCiB7CiAJY2FuY2VsX2RlbGF5ZWRfd29ya19zeW5jKCZ3LT53b3JrKTsKIAlkZXN0cm95X2Rl
bGF5ZWRfd29ya19vbl9zdGFjaygmdy0+d29yayk7Ci0Jdy0+aTkxNSA9IE5VTEw7CisJdy0+Z3Qg
PSBOVUxMOwogfQogCiAjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfU0VMRlRFU1QpCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZXNldC5oIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuaAppbmRleCAwM2ZiYTBhYjM4NjguLjYyZjZj
YjUyMGY5NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQu
aAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZXNldC5oCkBAIC0xMSw1NiAr
MTEsNjcgQEAKICNpbmNsdWRlIDxsaW51eC90eXBlcy5oPgogI2luY2x1ZGUgPGxpbnV4L3NyY3Uu
aD4KIAotI2luY2x1ZGUgImd0L2ludGVsX2VuZ2luZV90eXBlcy5oIgorI2luY2x1ZGUgImludGVs
X2VuZ2luZV90eXBlcy5oIgorI2luY2x1ZGUgImludGVsX3Jlc2V0X3R5cGVzLmgiCiAKIHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlOwogc3RydWN0IGk5MTVfcmVxdWVzdDsKIHN0cnVjdCBpbnRlbF9l
bmdpbmVfY3M7CitzdHJ1Y3QgaW50ZWxfZ3Q7CiBzdHJ1Y3QgaW50ZWxfZ3VjOwogCit2b2lkIGlu
dGVsX2d0X2luaXRfcmVzZXQoc3RydWN0IGludGVsX2d0ICpndCk7Cit2b2lkIGludGVsX2d0X2Zp
bmlfcmVzZXQoc3RydWN0IGludGVsX2d0ICpndCk7CisKIF9fcHJpbnRmKDQsIDUpCi12b2lkIGk5
MTVfaGFuZGxlX2Vycm9yKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAotCQkgICAgICAg
aW50ZWxfZW5naW5lX21hc2tfdCBlbmdpbmVfbWFzaywKLQkJICAgICAgIHVuc2lnbmVkIGxvbmcg
ZmxhZ3MsCi0JCSAgICAgICBjb25zdCBjaGFyICpmbXQsIC4uLik7Cit2b2lkIGludGVsX2d0X2hh
bmRsZV9lcnJvcihzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAorCQkJICAgaW50ZWxfZW5naW5lX21hc2tf
dCBlbmdpbmVfbWFzaywKKwkJCSAgIHVuc2lnbmVkIGxvbmcgZmxhZ3MsCisJCQkgICBjb25zdCBj
aGFyICpmbXQsIC4uLik7CiAjZGVmaW5lIEk5MTVfRVJST1JfQ0FQVFVSRSBCSVQoMCkKIAotdm9p
ZCBpOTE1X3Jlc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAotCQlpbnRlbF9lbmdp
bmVfbWFza190IHN0YWxsZWRfbWFzaywKLQkJY29uc3QgY2hhciAqcmVhc29uKTsKLWludCBpOTE1
X3Jlc2V0X2VuZ2luZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCi0JCSAgICAgIGNv
bnN0IGNoYXIgKnJlYXNvbik7Ci0KLXZvaWQgaTkxNV9yZXNldF9yZXF1ZXN0KHN0cnVjdCBpOTE1
X3JlcXVlc3QgKnJxLCBib29sIGd1aWx0eSk7Cit2b2lkIGludGVsX2d0X3Jlc2V0KHN0cnVjdCBp
bnRlbF9ndCAqZ3QsCisJCSAgICBpbnRlbF9lbmdpbmVfbWFza190IHN0YWxsZWRfbWFzaywKKwkJ
ICAgIGNvbnN0IGNoYXIgKnJlYXNvbik7CitpbnQgaW50ZWxfZW5naW5lX3Jlc2V0KHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKKwkJICAgICAgIGNvbnN0IGNoYXIgKnJlYXNvbik7CiAK
LWludCBfX211c3RfY2hlY2sgaTkxNV9yZXNldF90cnlsb2NrKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KTsKLXZvaWQgaTkxNV9yZXNldF91bmxvY2soc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsIGludCB0YWcpOwordm9pZCBfX2k5MTVfcmVxdWVzdF9yZXNldChzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpycSwgYm9vbCBndWlsdHkpOwogCi1pbnQgaTkxNV90ZXJtaW5hbGx5X3dlZGdl
ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CitpbnQgX19tdXN0X2NoZWNrIGludGVs
X2d0X3Jlc2V0X3RyeWxvY2soc3RydWN0IGludGVsX2d0ICpndCk7Cit2b2lkIGludGVsX2d0X3Jl
c2V0X3VubG9jayhzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBpbnQgdGFnKTsKIAotYm9vbCBpbnRlbF9o
YXNfZ3B1X3Jlc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKLWJvb2wgaW50ZWxf
aGFzX3Jlc2V0X2VuZ2luZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGlu
dGVsX2d0X3NldF93ZWRnZWQoc3RydWN0IGludGVsX2d0ICpndCk7Citib29sIGludGVsX2d0X3Vu
c2V0X3dlZGdlZChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KTsKK2ludCBpbnRlbF9ndF90ZXJtaW5hbGx5
X3dlZGdlZChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KTsKIAotaW50IGludGVsX2dwdV9yZXNldChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKLQkJICAgIGludGVsX2VuZ2luZV9tYXNrX3QgZW5n
aW5lX21hc2spOworaW50IGludGVsX2dwdV9yZXNldChzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBpbnRl
bF9lbmdpbmVfbWFza190IGVuZ2luZV9tYXNrKTsKIAotaW50IGludGVsX3Jlc2V0X2d1YyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CitpbnQgaW50ZWxfcmVzZXRfZ3VjKHN0cnVjdCBp
bnRlbF9ndCAqZ3QpOwogCi1zdHJ1Y3QgaTkxNV93ZWRnZV9tZSB7CitzdHJ1Y3QgaW50ZWxfd2Vk
Z2VfbWUgewogCXN0cnVjdCBkZWxheWVkX3dvcmsgd29yazsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNTsKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0OwogCWNvbnN0IGNoYXIgKm5hbWU7CiB9
OwogCi12b2lkIF9faTkxNV9pbml0X3dlZGdlKHN0cnVjdCBpOTE1X3dlZGdlX21lICp3LAotCQkg
ICAgICAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCi0JCSAgICAgICBsb25nIHRpbWVv
dXQsCi0JCSAgICAgICBjb25zdCBjaGFyICpuYW1lKTsKLXZvaWQgX19pOTE1X2Zpbmlfd2VkZ2Uo
c3RydWN0IGk5MTVfd2VkZ2VfbWUgKncpOwordm9pZCBfX2ludGVsX2luaXRfd2VkZ2Uoc3RydWN0
IGludGVsX3dlZGdlX21lICp3LAorCQkJc3RydWN0IGludGVsX2d0ICpndCwKKwkJCWxvbmcgdGlt
ZW91dCwKKwkJCWNvbnN0IGNoYXIgKm5hbWUpOwordm9pZCBfX2ludGVsX2Zpbmlfd2VkZ2Uoc3Ry
dWN0IGludGVsX3dlZGdlX21lICp3KTsKIAotI2RlZmluZSBpOTE1X3dlZGdlX29uX3RpbWVvdXQo
VywgREVWLCBUSU1FT1VUKQkJCQlcCi0JZm9yIChfX2k5MTVfaW5pdF93ZWRnZSgoVyksIChERVYp
LCAoVElNRU9VVCksIF9fZnVuY19fKTsJXAotCSAgICAgKFcpLT5pOTE1OwkJCQkJCQlcCi0JICAg
ICBfX2k5MTVfZmluaV93ZWRnZSgoVykpKQorI2RlZmluZSBpbnRlbF93ZWRnZV9vbl90aW1lb3V0
KFcsIEdULCBUSU1FT1VUKQkJCQlcCisJZm9yIChfX2ludGVsX2luaXRfd2VkZ2UoKFcpLCAoR1Qp
LCAoVElNRU9VVCksIF9fZnVuY19fKTsJXAorCSAgICAgKFcpLT5ndDsJCQkJCQkJXAorCSAgICAg
X19pbnRlbF9maW5pX3dlZGdlKChXKSkpCisKK3N0YXRpYyBpbmxpbmUgYm9vbCBfX2ludGVsX3Jl
c2V0X2ZhaWxlZChjb25zdCBzdHJ1Y3QgaW50ZWxfcmVzZXQgKnJlc2V0KQoreworCXJldHVybiB1
bmxpa2VseSh0ZXN0X2JpdChJOTE1X1dFREdFRCwgJnJlc2V0LT5mbGFncykpOworfQorCitib29s
IGludGVsX2hhc19ncHVfcmVzZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOworYm9v
bCBpbnRlbF9oYXNfcmVzZXRfZW5naW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsK
IAogI2VuZGlmIC8qIEk5MTVfUkVTRVRfSCAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfcmVzZXRfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX3Jlc2V0X3R5cGVzLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAw
Li4zMTk2ODM1NmUwYzAKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9yZXNldF90eXBlcy5oCkBAIC0wLDAgKzEsNTAgQEAKKy8qIFNQRFgtTGljZW5zZS1J
ZGVudGlmaWVyOiBNSVQgKi8KKy8qCisgKiBDb3B5cmlnaHQgwqkgMjAxOSBJbnRlbCBDb3Jwb3Jh
dGlvbgorICovCisKKyNpZm5kZWYgX19JTlRFTF9SRVNFVF9UWVBFU19IXworI2RlZmluZSBfX0lO
VEVMX1JFU0VUX1RZUEVTX0hfCisKKyNpbmNsdWRlIDxsaW51eC9tdXRleC5oPgorI2luY2x1ZGUg
PGxpbnV4L3dhaXQuaD4KKyNpbmNsdWRlIDxsaW51eC9zcmN1Lmg+CisKK3N0cnVjdCBpbnRlbF9y
ZXNldCB7CisJLyoqCisJICogZmxhZ3M6IENvbnRyb2wgdmFyaW91cyBzdGFnZXMgb2YgdGhlIEdQ
VSByZXNldAorCSAqCisJICogI0k5MTVfUkVTRVRfQkFDS09GRiAtIFdoZW4gd2Ugc3RhcnQgYSBn
bG9iYWwgcmVzZXQsIHdlIG5lZWQgdG8KKwkgKiBzZXJpYWxpc2Ugd2l0aCBhbnkgb3RoZXIgdXNl
cnMgYXR0ZW1wdGluZyB0byBkbyB0aGUgc2FtZSwgYW5kCisJICogYW55IGdsb2JhbCByZXNvdXJj
ZXMgdGhhdCBtYXkgYmUgY2xvYmJlciBieSB0aGUgcmVzZXQgKHN1Y2ggYXMKKwkgKiBGRU5DRSBy
ZWdpc3RlcnMpLgorCSAqCisJICogI0k5MTVfUkVTRVRfRU5HSU5FW251bV9lbmdpbmVzXSAtIFNp
bmNlIHRoZSBkcml2ZXIgZG9lc24ndCBuZWVkIHRvCisJICogYWNxdWlyZSB0aGUgc3RydWN0X211
dGV4IHRvIHJlc2V0IGFuIGVuZ2luZSwgd2UgbmVlZCBhbiBleHBsaWNpdAorCSAqIGZsYWcgdG8g
cHJldmVudCB0d28gY29uY3VycmVudCByZXNldCBhdHRlbXB0cyBpbiB0aGUgc2FtZSBlbmdpbmUu
CisJICogQXMgdGhlIG51bWJlciBvZiBlbmdpbmVzIGNvbnRpbnVlcyB0byBncm93LCBhbGxvY2F0
ZSB0aGUgZmxhZ3MgZnJvbQorCSAqIHRoZSBtb3N0IHNpZ25pZmljYW50IGJpdHMuCisJICoKKwkg
KiAjSTkxNV9XRURHRUQgLSBJZiByZXNldCBmYWlscyBhbmQgd2UgY2FuIG5vIGxvbmdlciB1c2Ug
dGhlIEdQVSwKKwkgKiB3ZSBzZXQgdGhlICNJOTE1X1dFREdFRCBiaXQuIFByaW9yIHRvIGNvbW1h
bmQgc3VibWlzc2lvbiwgZS5nLgorCSAqIGk5MTVfcmVxdWVzdF9hbGxvYygpLCB0aGlzIGJpdCBp
cyBjaGVja2VkIGFuZCB0aGUgc2VxdWVuY2UKKwkgKiBhYm9ydGVkICh3aXRoIC1FSU8gcmVwb3J0
ZWQgdG8gdXNlcnNwYWNlKSBpZiBzZXQuCisJICovCisJdW5zaWduZWQgbG9uZyBmbGFnczsKKyNk
ZWZpbmUgSTkxNV9SRVNFVF9CQUNLT0ZGCTAKKyNkZWZpbmUgSTkxNV9SRVNFVF9NT0RFU0VUCTEK
KyNkZWZpbmUgSTkxNV9SRVNFVF9FTkdJTkUJMgorI2RlZmluZSBJOTE1X1dFREdFRAkJKEJJVFNf
UEVSX0xPTkcgLSAxKQorCisJc3RydWN0IG11dGV4IG11dGV4OyAvKiBzZXJpYWxpc2VzIHdlZGdp
bmcvdW53ZWRnaW5nICovCisKKwkvKioKKwkgKiBXYWl0cXVldWUgdG8gc2lnbmFsIHdoZW4gdGhl
IHJlc2V0IGhhcyBjb21wbGV0ZWQuIFVzZWQgYnkgY2xpZW50cworCSAqIHRoYXQgd2FpdCBmb3Ig
ZGV2X3ByaXYtPm1tLndlZGdlZCB0byBzZXR0bGUuCisJICovCisJd2FpdF9xdWV1ZV9oZWFkX3Qg
cXVldWU7CisKKwlzdHJ1Y3Qgc3JjdV9zdHJ1Y3QgYmFja29mZl9zcmN1OworfTsKKworI2VuZGlm
IC8qIF9JTlRFTF9SRVNFVF9UWVBFU19IXyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfcmluZ2J1ZmZlci5jCmluZGV4IGUyYjVkZTU4OTEzYy4uMTg5Yjc1MDc0MTIxIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jCkBAIC03OTUsNyArNzk1LDcg
QEAgc3RhdGljIHZvaWQgcmVzZXRfcmluZyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUs
IGJvb2wgc3RhbGxlZCkKIAkJICogSWYgdGhlIHJlcXVlc3Qgd2FzIGlubm9jZW50LCB3ZSB0cnkg
dG8gcmVwbGF5IHRoZSByZXF1ZXN0CiAJCSAqIHdpdGggdGhlIHJlc3RvcmVkIGNvbnRleHQuCiAJ
CSAqLwotCQlpOTE1X3Jlc2V0X3JlcXVlc3QocnEsIHN0YWxsZWQpOworCQlfX2k5MTVfcmVxdWVz
dF9yZXNldChycSwgc3RhbGxlZCk7CiAKIAkJR0VNX0JVR19PTihycS0+cmluZyAhPSBlbmdpbmUt
PmJ1ZmZlcik7CiAJCWhlYWQgPSBycS0+aGVhZDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfaGFuZ2NoZWNrLmMKaW5kZXggMmQ5Y2MzY2QxZjI3Li5lMmZhMzhhMWZmMGYgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jCkBAIC0zMiw3
ICszMiw2IEBACiAjaW5jbHVkZSAic2VsZnRlc3RzL2k5MTVfcmFuZG9tLmgiCiAjaW5jbHVkZSAi
c2VsZnRlc3RzL2lndF9mbHVzaF90ZXN0LmgiCiAjaW5jbHVkZSAic2VsZnRlc3RzL2lndF9yZXNl
dC5oIgotI2luY2x1ZGUgInNlbGZ0ZXN0cy9pZ3Rfd2VkZ2VfbWUuaCIKICNpbmNsdWRlICJzZWxm
dGVzdHMvaWd0X2F0b21pYy5oIgogCiAjaW5jbHVkZSAic2VsZnRlc3RzL21vY2tfZHJtLmgiCkBA
IC00Myw3ICs0Miw2IEBACiAjZGVmaW5lIElHVF9JRExFX1RJTUVPVVQgNTAgLyogbXM7IHRpbWUg
dG8gd2FpdCBhZnRlciBmbHVzaGluZyBiZXR3ZWVuIHRlc3RzICovCiAKIHN0cnVjdCBoYW5nIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNTsKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0Owog
CXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpod3M7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iajsKQEAgLTUyLDI3ICs1MCwyNyBAQCBzdHJ1Y3QgaGFuZyB7CiAJdTMyICpiYXRj
aDsKIH07CiAKLXN0YXRpYyBpbnQgaGFuZ19pbml0KHN0cnVjdCBoYW5nICpoLCBzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3N0YXRpYyBpbnQgaGFuZ19pbml0KHN0cnVjdCBoYW5nICpo
LCBzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogewogCXZvaWQgKnZhZGRyOwogCWludCBlcnI7CiAKIAlt
ZW1zZXQoaCwgMCwgc2l6ZW9mKCpoKSk7Ci0JaC0+aTkxNSA9IGk5MTU7CisJaC0+Z3QgPSBndDsK
IAotCWgtPmN0eCA9IGtlcm5lbF9jb250ZXh0KGk5MTUpOworCWgtPmN0eCA9IGtlcm5lbF9jb250
ZXh0KGd0LT5pOTE1KTsKIAlpZiAoSVNfRVJSKGgtPmN0eCkpCiAJCXJldHVybiBQVFJfRVJSKGgt
PmN0eCk7CiAKIAlHRU1fQlVHX09OKGk5MTVfZ2VtX2NvbnRleHRfaXNfYmFubmFibGUoaC0+Y3R4
KSk7CiAKLQloLT5od3MgPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGk5MTUsIFBB
R0VfU0laRSk7CisJaC0+aHdzID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChndC0+
aTkxNSwgUEFHRV9TSVpFKTsKIAlpZiAoSVNfRVJSKGgtPmh3cykpIHsKIAkJZXJyID0gUFRSX0VS
UihoLT5od3MpOwogCQlnb3RvIGVycl9jdHg7CiAJfQogCi0JaC0+b2JqID0gaTkxNV9nZW1fb2Jq
ZWN0X2NyZWF0ZV9pbnRlcm5hbChpOTE1LCBQQUdFX1NJWkUpOworCWgtPm9iaiA9IGk5MTVfZ2Vt
X29iamVjdF9jcmVhdGVfaW50ZXJuYWwoZ3QtPmk5MTUsIFBBR0VfU0laRSk7CiAJaWYgKElTX0VS
UihoLT5vYmopKSB7CiAJCWVyciA9IFBUUl9FUlIoaC0+b2JqKTsKIAkJZ290byBlcnJfaHdzOwpA
QCAtODcsNyArODUsNyBAQCBzdGF0aWMgaW50IGhhbmdfaW5pdChzdHJ1Y3QgaGFuZyAqaCwgc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJaC0+c2Vxbm8gPSBtZW1zZXQodmFkZHIsIDB4
ZmYsIFBBR0VfU0laRSk7CiAKIAl2YWRkciA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKGgtPm9i
aiwKLQkJCQkJaTkxNV9jb2hlcmVudF9tYXBfdHlwZShpOTE1KSk7CisJCQkJCWk5MTVfY29oZXJl
bnRfbWFwX3R5cGUoZ3QtPmk5MTUpKTsKIAlpZiAoSVNfRVJSKHZhZGRyKSkgewogCQllcnIgPSBQ
VFJfRVJSKHZhZGRyKTsKIAkJZ290byBlcnJfdW5waW5faHdzOwpAQCAtMTI5LDcgKzEyNyw3IEBA
IHN0YXRpYyBpbnQgbW92ZV90b19hY3RpdmUoc3RydWN0IGk5MTVfdm1hICp2bWEsCiBzdGF0aWMg
c3RydWN0IGk5MTVfcmVxdWVzdCAqCiBoYW5nX2NyZWF0ZV9yZXF1ZXN0KHN0cnVjdCBoYW5nICpo
LCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSBoLT5pOTE1OworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBoLT5ndDsKIAlz
dHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IGgtPmN0eC0+dm0gPzogJmVuZ2luZS0+Z3Qt
PmdndHQtPnZtOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnEgPSBOVUxMOwpAQCAtMTM5LDExICsxMzcsMTEgQEAgaGFuZ19jcmVhdGVf
cmVxdWVzdChzdHJ1Y3QgaGFuZyAqaCwgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQog
CXUzMiAqYmF0Y2g7CiAJaW50IGVycjsKIAotCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVf
aW50ZXJuYWwoaTkxNSwgUEFHRV9TSVpFKTsKKwlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRl
X2ludGVybmFsKGd0LT5pOTE1LCBQQUdFX1NJWkUpOwogCWlmIChJU19FUlIob2JqKSkKIAkJcmV0
dXJuIEVSUl9DQVNUKG9iaik7CiAKLQl2YWRkciA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKG9i
aiwgaTkxNV9jb2hlcmVudF9tYXBfdHlwZShpOTE1KSk7CisJdmFkZHIgPSBpOTE1X2dlbV9vYmpl
Y3RfcGluX21hcChvYmosIGk5MTVfY29oZXJlbnRfbWFwX3R5cGUoZ3QtPmk5MTUpKTsKIAlpZiAo
SVNfRVJSKHZhZGRyKSkgewogCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CiAJCXJldHVybiBF
UlJfQ0FTVCh2YWRkcik7CkBAIC0xODYsNyArMTg0LDcgQEAgaGFuZ19jcmVhdGVfcmVxdWVzdChz
dHJ1Y3QgaGFuZyAqaCwgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCQlnb3RvIGNh
bmNlbF9ycTsKIAogCWJhdGNoID0gaC0+YmF0Y2g7Ci0JaWYgKElOVEVMX0dFTihpOTE1KSA+PSA4
KSB7CisJaWYgKElOVEVMX0dFTihndC0+aTkxNSkgPj0gOCkgewogCQkqYmF0Y2grKyA9IE1JX1NU
T1JFX0RXT1JEX0lNTV9HRU40OwogCQkqYmF0Y2grKyA9IGxvd2VyXzMyX2JpdHMoaHdzX2FkZHJl
c3MoaHdzLCBycSkpOwogCQkqYmF0Y2grKyA9IHVwcGVyXzMyX2JpdHMoaHdzX2FkZHJlc3MoaHdz
LCBycSkpOwpAQCAtMjAwLDcgKzE5OCw3IEBAIGhhbmdfY3JlYXRlX3JlcXVlc3Qoc3RydWN0IGhh
bmcgKmgsIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAkJKmJhdGNoKysgPSBNSV9C
QVRDSF9CVUZGRVJfU1RBUlQgfCAxIDw8IDggfCAxOwogCQkqYmF0Y2grKyA9IGxvd2VyXzMyX2Jp
dHModm1hLT5ub2RlLnN0YXJ0KTsKIAkJKmJhdGNoKysgPSB1cHBlcl8zMl9iaXRzKHZtYS0+bm9k
ZS5zdGFydCk7Ci0JfSBlbHNlIGlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNikgeworCX0gZWxzZSBp
ZiAoSU5URUxfR0VOKGd0LT5pOTE1KSA+PSA2KSB7CiAJCSpiYXRjaCsrID0gTUlfU1RPUkVfRFdP
UkRfSU1NX0dFTjQ7CiAJCSpiYXRjaCsrID0gMDsKIAkJKmJhdGNoKysgPSBsb3dlcl8zMl9iaXRz
KGh3c19hZGRyZXNzKGh3cywgcnEpKTsKQEAgLTIxMyw3ICsyMTEsNyBAQCBoYW5nX2NyZWF0ZV9y
ZXF1ZXN0KHN0cnVjdCBoYW5nICpoLCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJ
CSpiYXRjaCsrID0gTUlfQVJCX0NIRUNLOwogCQkqYmF0Y2grKyA9IE1JX0JBVENIX0JVRkZFUl9T
VEFSVCB8IDEgPDwgODsKIAkJKmJhdGNoKysgPSBsb3dlcl8zMl9iaXRzKHZtYS0+bm9kZS5zdGFy
dCk7Ci0JfSBlbHNlIGlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNCkgeworCX0gZWxzZSBpZiAoSU5U
RUxfR0VOKGd0LT5pOTE1KSA+PSA0KSB7CiAJCSpiYXRjaCsrID0gTUlfU1RPUkVfRFdPUkRfSU1N
X0dFTjQgfCBNSV9VU0VfR0dUVDsKIAkJKmJhdGNoKysgPSAwOwogCQkqYmF0Y2grKyA9IGxvd2Vy
XzMyX2JpdHMoaHdzX2FkZHJlc3MoaHdzLCBycSkpOwpAQCAtMjQ5LDcgKzI0Nyw3IEBAIGhhbmdf
Y3JlYXRlX3JlcXVlc3Qoc3RydWN0IGhhbmcgKmgsIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSkKIAl9CiAKIAlmbGFncyA9IDA7Ci0JaWYgKElOVEVMX0dFTihpOTE1KSA8PSA1KQorCWlm
IChJTlRFTF9HRU4oZ3QtPmk5MTUpIDw9IDUpCiAJCWZsYWdzIHw9IEk5MTVfRElTUEFUQ0hfU0VD
VVJFOwogCiAJZXJyID0gcnEtPmVuZ2luZS0+ZW1pdF9iYl9zdGFydChycSwgdm1hLT5ub2RlLnN0
YXJ0LCBQQUdFX1NJWkUsIGZsYWdzKTsKQEAgLTI4Niw3ICsyODQsNyBAQCBzdGF0aWMgdm9pZCBo
YW5nX2Zpbmkoc3RydWN0IGhhbmcgKmgpCiAKIAlrZXJuZWxfY29udGV4dF9jbG9zZShoLT5jdHgp
OwogCi0JaWd0X2ZsdXNoX3Rlc3QoaC0+aTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCk7CisJaWd0X2Zs
dXNoX3Rlc3QoaC0+Z3QtPmk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpOwogfQogCiBzdGF0aWMgYm9v
bCB3YWl0X3VudGlsX3J1bm5pbmcoc3RydWN0IGhhbmcgKmgsIHN0cnVjdCBpOTE1X3JlcXVlc3Qg
KnJxKQpAQCAtMzAxLDcgKzI5OSw3IEBAIHN0YXRpYyBib29sIHdhaXRfdW50aWxfcnVubmluZyhz
dHJ1Y3QgaGFuZyAqaCwgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAKIHN0YXRpYyBpbnQgaWd0
X2hhbmdfc2FuaXR5Y2hlY2sodm9pZCAqYXJnKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gYXJnOworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CiAJc3RydWN0IGk5MTVf
cmVxdWVzdCAqcnE7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCWVudW0gaW50
ZWxfZW5naW5lX2lkIGlkOwpAQCAtMzEwLDEzICszMDgsMTMgQEAgc3RhdGljIGludCBpZ3RfaGFu
Z19zYW5pdHljaGVjayh2b2lkICphcmcpCiAKIAkvKiBCYXNpYyBjaGVjayB0aGF0IHdlIGNhbiBl
eGVjdXRlIG91ciBoYW5naW5nIGJhdGNoICovCiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKLQllcnIgPSBoYW5nX2luaXQoJmgsIGk5MTUpOworCW11dGV4X2xvY2soJmd0
LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwllcnIgPSBoYW5nX2luaXQoJmgsIGd0KTsKIAlp
ZiAoZXJyKQogCQlnb3RvIHVubG9jazsKIAotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUs
IGlkKSB7Ci0JCXN0cnVjdCBpZ3Rfd2VkZ2VfbWUgdzsKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5l
LCBndC0+aTkxNSwgaWQpIHsKKwkJc3RydWN0IGludGVsX3dlZGdlX21lIHc7CiAJCWxvbmcgdGlt
ZW91dDsKIAogCQlpZiAoIWludGVsX2VuZ2luZV9jYW5fc3RvcmVfZHdvcmQoZW5naW5lKSkKQEAg
LTMzOCwxMCArMzM2LDEwIEBAIHN0YXRpYyBpbnQgaWd0X2hhbmdfc2FuaXR5Y2hlY2sodm9pZCAq
YXJnKQogCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKIAogCQl0aW1lb3V0ID0gMDsKLQkJaWd0X3dl
ZGdlX29uX3RpbWVvdXQoJncsIGk5MTUsIEhaIC8gMTAgLyogMTAwbXMgdGltZW91dCovKQorCQlp
bnRlbF93ZWRnZV9vbl90aW1lb3V0KCZ3LCBndCwgSFogLyAxMCAvKiAxMDBtcyAqLykKIAkJCXRp
bWVvdXQgPSBpOTE1X3JlcXVlc3Rfd2FpdChycSwgMCwKIAkJCQkJCSAgICBNQVhfU0NIRURVTEVf
VElNRU9VVCk7Ci0JCWlmIChpOTE1X3Jlc2V0X2ZhaWxlZChpOTE1KSkKKwkJaWYgKGludGVsX2d0
X2lzX3dlZGdlZChndCkpCiAJCQl0aW1lb3V0ID0gLUVJTzsKIAogCQlpOTE1X3JlcXVlc3RfcHV0
KHJxKTsKQEAgLTM1Nyw3ICszNTUsNyBAQCBzdGF0aWMgaW50IGlndF9oYW5nX3Nhbml0eWNoZWNr
KHZvaWQgKmFyZykKIGZpbmk6CiAJaGFuZ19maW5pKCZoKTsKIHVubG9jazoKLQltdXRleF91bmxv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CiB9CiAKQEAgLTM2OCw3ICszNjYsOCBAQCBz
dGF0aWMgYm9vbCB3YWl0X2Zvcl9pZGxlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkK
IAogc3RhdGljIGludCBpZ3RfcmVzZXRfbm9wKHZvaWQgKmFyZykKIHsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOworCXN0
cnVjdCBpOTE1X2dwdV9lcnJvciAqZ2xvYmFsID0gJmd0LT5pOTE1LT5ncHVfZXJyb3I7CiAJc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpj
dHg7CiAJdW5zaWduZWQgaW50IHJlc2V0X2NvdW50LCBjb3VudDsKQEAgLTM3OSwyNSArMzc4LDI1
IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X25vcCh2b2lkICphcmcpCiAKIAkvKiBDaGVjayB0aGF0
IHdlIGNhbiByZXNldCBkdXJpbmcgbm9uLXVzZXIgcG9ydGlvbnMgb2YgcmVxdWVzdHMgKi8KIAot
CWZpbGUgPSBtb2NrX2ZpbGUoaTkxNSk7CisJZmlsZSA9IG1vY2tfZmlsZShndC0+aTkxNSk7CiAJ
aWYgKElTX0VSUihmaWxlKSkKIAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAKLQltdXRleF9sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQljdHggPSBsaXZlX2NvbnRleHQoaTkxNSwgZmls
ZSk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF9sb2Nr
KCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJY3R4ID0gbGl2ZV9jb250ZXh0KGd0LT5p
OTE1LCBmaWxlKTsKKwltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
IAlpZiAoSVNfRVJSKGN0eCkpIHsKIAkJZXJyID0gUFRSX0VSUihjdHgpOwogCQlnb3RvIG91dDsK
IAl9CiAKIAlpOTE1X2dlbV9jb250ZXh0X2NsZWFyX2Jhbm5hYmxlKGN0eCk7Ci0JcmVzZXRfY291
bnQgPSBpOTE1X3Jlc2V0X2NvdW50KCZpOTE1LT5ncHVfZXJyb3IpOworCXJlc2V0X2NvdW50ID0g
aTkxNV9yZXNldF9jb3VudChnbG9iYWwpOwogCWNvdW50ID0gMDsKIAlkbyB7Ci0JCW11dGV4X2xv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CiAKLQkJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsK
KwkJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5MTUsIGlkKSB7CiAJCQlpbnQgaTsKIAog
CQkJZm9yIChpID0gMDsgaSA8IDE2OyBpKyspIHsKQEAgLTQxMyw0MyArNDEyLDQzIEBAIHN0YXRp
YyBpbnQgaWd0X3Jlc2V0X25vcCh2b2lkICphcmcpCiAJCQl9CiAJCX0KIAotCQlpZ3RfZ2xvYmFs
X3Jlc2V0X2xvY2soaTkxNSk7Ci0JCWk5MTVfcmVzZXQoaTkxNSwgQUxMX0VOR0lORVMsIE5VTEwp
OwotCQlpZ3RfZ2xvYmFsX3Jlc2V0X3VubG9jayhpOTE1KTsKKwkJaWd0X2dsb2JhbF9yZXNldF9s
b2NrKGd0KTsKKwkJaW50ZWxfZ3RfcmVzZXQoZ3QsIEFMTF9FTkdJTkVTLCBOVUxMKTsKKwkJaWd0
X2dsb2JhbF9yZXNldF91bmxvY2soZ3QpOwogCi0JCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7Ci0JCWlmIChpOTE1X3Jlc2V0X2ZhaWxlZChpOTE1KSkgeworCQltdXRleF91
bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwkJaWYgKGludGVsX2d0X2lzX3dl
ZGdlZChndCkpIHsKIAkJCWVyciA9IC1FSU87CiAJCQlicmVhazsKIAkJfQogCi0JCWlmIChpOTE1
X3Jlc2V0X2NvdW50KCZpOTE1LT5ncHVfZXJyb3IpICE9Ci0JCSAgICByZXNldF9jb3VudCArICsr
Y291bnQpIHsKKwkJaWYgKGk5MTVfcmVzZXRfY291bnQoZ2xvYmFsKSAhPSByZXNldF9jb3VudCAr
ICsrY291bnQpIHsKIAkJCXByX2VycigiRnVsbCBHUFUgcmVzZXQgbm90IHJlY29yZGVkIVxuIik7
CiAJCQllcnIgPSAtRUlOVkFMOwogCQkJYnJlYWs7CiAJCX0KIAotCQllcnIgPSBpZ3RfZmx1c2hf
dGVzdChpOTE1LCAwKTsKKwkJZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUsIDApOwogCQlp
ZiAoZXJyKQogCQkJYnJlYWs7CiAJfSB3aGlsZSAodGltZV9iZWZvcmUoamlmZmllcywgZW5kX3Rp
bWUpKTsKIAlwcl9pbmZvKCIlczogJWQgcmVzZXRzXG4iLCBfX2Z1bmNfXywgY291bnQpOwogCi0J
bXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JZXJyID0gaWd0X2ZsdXNoX3Rl
c3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKKwltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJ
ZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpOworCW11dGV4
X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiBvdXQ6Ci0JbW9ja19maWxl
X2ZyZWUoaTkxNSwgZmlsZSk7Ci0JaWYgKGk5MTVfcmVzZXRfZmFpbGVkKGk5MTUpKQorCW1vY2tf
ZmlsZV9mcmVlKGd0LT5pOTE1LCBmaWxlKTsKKwlpZiAoaW50ZWxfZ3RfaXNfd2VkZ2VkKGd0KSkK
IAkJZXJyID0gLUVJTzsKIAlyZXR1cm4gZXJyOwogfQogCiBzdGF0aWMgaW50IGlndF9yZXNldF9u
b3BfZW5naW5lKHZvaWQgKmFyZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IGFyZzsKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOworCXN0cnVjdCBpOTE1X2dwdV9lcnJv
ciAqZ2xvYmFsID0gJmd0LT5pOTE1LT5ncHVfZXJyb3I7CiAJc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lOwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CiAJZW51bSBpbnRlbF9l
bmdpbmVfaWQgaWQ7CkBAIC00NTgsMzMgKzQ1NywzMiBAQCBzdGF0aWMgaW50IGlndF9yZXNldF9u
b3BfZW5naW5lKHZvaWQgKmFyZykKIAogCS8qIENoZWNrIHRoYXQgd2UgY2FuIGVuZ2luZS1yZXNl
dCBkdXJpbmcgbm9uLXVzZXIgcG9ydGlvbnMgKi8KIAotCWlmICghaW50ZWxfaGFzX3Jlc2V0X2Vu
Z2luZShpOTE1KSkKKwlpZiAoIWludGVsX2hhc19yZXNldF9lbmdpbmUoZ3QtPmk5MTUpKQogCQly
ZXR1cm4gMDsKIAotCWZpbGUgPSBtb2NrX2ZpbGUoaTkxNSk7CisJZmlsZSA9IG1vY2tfZmlsZShn
dC0+aTkxNSk7CiAJaWYgKElTX0VSUihmaWxlKSkKIAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAK
LQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQljdHggPSBsaXZlX2NvbnRl
eHQoaTkxNSwgZmlsZSk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
KwltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJY3R4ID0gbGl2ZV9j
b250ZXh0KGd0LT5pOTE1LCBmaWxlKTsKKwltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKIAlpZiAoSVNfRVJSKGN0eCkpIHsKIAkJZXJyID0gUFRSX0VSUihjdHgpOwog
CQlnb3RvIG91dDsKIAl9CiAKIAlpOTE1X2dlbV9jb250ZXh0X2NsZWFyX2Jhbm5hYmxlKGN0eCk7
Ci0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKKwlmb3JfZWFjaF9lbmdpbmUo
ZW5naW5lLCBndC0+aTkxNSwgaWQpIHsKIAkJdW5zaWduZWQgaW50IHJlc2V0X2NvdW50LCByZXNl
dF9lbmdpbmVfY291bnQ7CiAJCXVuc2lnbmVkIGludCBjb3VudDsKIAkJSUdUX1RJTUVPVVQoZW5k
X3RpbWUpOwogCi0JCXJlc2V0X2NvdW50ID0gaTkxNV9yZXNldF9jb3VudCgmaTkxNS0+Z3B1X2Vy
cm9yKTsKLQkJcmVzZXRfZW5naW5lX2NvdW50ID0gaTkxNV9yZXNldF9lbmdpbmVfY291bnQoJmk5
MTUtPmdwdV9lcnJvciwKLQkJCQkJCQkgICAgIGVuZ2luZSk7CisJCXJlc2V0X2NvdW50ID0gaTkx
NV9yZXNldF9jb3VudChnbG9iYWwpOworCQlyZXNldF9lbmdpbmVfY291bnQgPSBpOTE1X3Jlc2V0
X2VuZ2luZV9jb3VudChnbG9iYWwsIGVuZ2luZSk7CiAJCWNvdW50ID0gMDsKIAotCQlzZXRfYml0
KEk5MTVfUkVTRVRfRU5HSU5FICsgaWQsICZpOTE1LT5ncHVfZXJyb3IuZmxhZ3MpOworCQlzZXRf
Yml0KEk5MTVfUkVTRVRfRU5HSU5FICsgaWQsICZndC0+cmVzZXQuZmxhZ3MpOwogCQlkbyB7CiAJ
CQlpbnQgaTsKIApAQCAtNDk1LDcgKzQ5Myw3IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X25vcF9l
bmdpbmUodm9pZCAqYXJnKQogCQkJCWJyZWFrOwogCQkJfQogCi0JCQltdXRleF9sb2NrKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKKwkJCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKIAkJCWZvciAoaSA9IDA7IGkgPCAxNjsgaSsrKSB7CiAJCQkJc3RydWN0IGk5MTVf
cmVxdWVzdCAqcnE7CiAKQEAgLTUwNywyMCArNTA1LDIwIEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0
X25vcF9lbmdpbmUodm9pZCAqYXJnKQogCiAJCQkJaTkxNV9yZXF1ZXN0X2FkZChycSk7CiAJCQl9
Ci0JCQllcnIgPSBpOTE1X3Jlc2V0X2VuZ2luZShlbmdpbmUsIE5VTEwpOwotCQkJbXV0ZXhfdW5s
b2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwkJCWVyciA9IGludGVsX2VuZ2luZV9yZXNl
dChlbmdpbmUsIE5VTEwpOworCQkJbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAJCQlpZiAoZXJyKSB7CiAJCQkJcHJfZXJyKCJpOTE1X3Jlc2V0X2VuZ2luZSBmYWls
ZWRcbiIpOwogCQkJCWJyZWFrOwogCQkJfQogCi0JCQlpZiAoaTkxNV9yZXNldF9jb3VudCgmaTkx
NS0+Z3B1X2Vycm9yKSAhPSByZXNldF9jb3VudCkgeworCQkJaWYgKGk5MTVfcmVzZXRfY291bnQo
Z2xvYmFsKSAhPSByZXNldF9jb3VudCkgewogCQkJCXByX2VycigiRnVsbCBHUFUgcmVzZXQgcmVj
b3JkZWQhIChlbmdpbmUgcmVzZXQgZXhwZWN0ZWQpXG4iKTsKIAkJCQllcnIgPSAtRUlOVkFMOwog
CQkJCWJyZWFrOwogCQkJfQogCi0JCQlpZiAoaTkxNV9yZXNldF9lbmdpbmVfY291bnQoJmk5MTUt
PmdwdV9lcnJvciwgZW5naW5lKSAhPQorCQkJaWYgKGk5MTVfcmVzZXRfZW5naW5lX2NvdW50KGds
b2JhbCwgZW5naW5lKSAhPQogCQkJICAgIHJlc2V0X2VuZ2luZV9jb3VudCArICsrY291bnQpIHsK
IAkJCQlwcl9lcnIoIiVzIGVuZ2luZSByZXNldCBub3QgcmVjb3JkZWQhXG4iLAogCQkJCSAgICAg
ICBlbmdpbmUtPm5hbWUpOwpAQCAtNTI4LDMwICs1MjYsMzEgQEAgc3RhdGljIGludCBpZ3RfcmVz
ZXRfbm9wX2VuZ2luZSh2b2lkICphcmcpCiAJCQkJYnJlYWs7CiAJCQl9CiAJCX0gd2hpbGUgKHRp
bWVfYmVmb3JlKGppZmZpZXMsIGVuZF90aW1lKSk7Ci0JCWNsZWFyX2JpdChJOTE1X1JFU0VUX0VO
R0lORSArIGlkLCAmaTkxNS0+Z3B1X2Vycm9yLmZsYWdzKTsKKwkJY2xlYXJfYml0KEk5MTVfUkVT
RVRfRU5HSU5FICsgaWQsICZndC0+cmVzZXQuZmxhZ3MpOwogCQlwcl9pbmZvKCIlcyglcyk6ICVk
IHJlc2V0c1xuIiwgX19mdW5jX18sIGVuZ2luZS0+bmFtZSwgY291bnQpOwogCiAJCWlmIChlcnIp
CiAJCQlicmVhazsKIAotCQllcnIgPSBpZ3RfZmx1c2hfdGVzdChpOTE1LCAwKTsKKwkJZXJyID0g
aWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUsIDApOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAJfQog
Ci0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JZXJyID0gaWd0X2ZsdXNo
X3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKKwltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CisJZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpOworCW11
dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiBvdXQ6Ci0JbW9ja19m
aWxlX2ZyZWUoaTkxNSwgZmlsZSk7Ci0JaWYgKGk5MTVfcmVzZXRfZmFpbGVkKGk5MTUpKQorCW1v
Y2tfZmlsZV9mcmVlKGd0LT5pOTE1LCBmaWxlKTsKKwlpZiAoaW50ZWxfZ3RfaXNfd2VkZ2VkKGd0
KSkKIAkJZXJyID0gLUVJTzsKIAlyZXR1cm4gZXJyOwogfQogCi1zdGF0aWMgaW50IF9faWd0X3Jl
c2V0X2VuZ2luZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgYm9vbCBhY3RpdmUpCitz
dGF0aWMgaW50IF9faWd0X3Jlc2V0X2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBib29sIGFj
dGl2ZSkKIHsKKwlzdHJ1Y3QgaTkxNV9ncHVfZXJyb3IgKmdsb2JhbCA9ICZndC0+aTkxNS0+Z3B1
X2Vycm9yOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAllbnVtIGludGVsX2Vu
Z2luZV9pZCBpZDsKIAlzdHJ1Y3QgaGFuZyBoOwpAQCAtNTU5LDE4ICs1NTgsMTggQEAgc3RhdGlj
IGludCBfX2lndF9yZXNldF9lbmdpbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGJv
b2wgYWN0aXZlKQogCiAJLyogQ2hlY2sgdGhhdCB3ZSBjYW4gaXNzdWUgYW4gZW5naW5lIHJlc2V0
IG9uIGFuIGlkbGUgZW5naW5lIChuby1vcCkgKi8KIAotCWlmICghaW50ZWxfaGFzX3Jlc2V0X2Vu
Z2luZShpOTE1KSkKKwlpZiAoIWludGVsX2hhc19yZXNldF9lbmdpbmUoZ3QtPmk5MTUpKQogCQly
ZXR1cm4gMDsKIAogCWlmIChhY3RpdmUpIHsKLQkJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7Ci0JCWVyciA9IGhhbmdfaW5pdCgmaCwgaTkxNSk7Ci0JCW11dGV4X3VubG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKKwkJZXJyID0gaGFuZ19pbml0KCZoLCBndCk7CisJCW11dGV4X3VubG9jaygm
Z3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQlpZiAoZXJyKQogCQkJcmV0dXJuIGVycjsK
IAl9CiAKLQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgeworCWZvcl9lYWNoX2Vu
Z2luZShlbmdpbmUsIGd0LT5pOTE1LCBpZCkgewogCQl1bnNpZ25lZCBpbnQgcmVzZXRfY291bnQs
IHJlc2V0X2VuZ2luZV9jb3VudDsKIAkJSUdUX1RJTUVPVVQoZW5kX3RpbWUpOwogCkBAIC01ODQs
MzAgKzU4MywyOSBAQCBzdGF0aWMgaW50IF9faWd0X3Jlc2V0X2VuZ2luZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwgYm9vbCBhY3RpdmUpCiAJCQlicmVhazsKIAkJfQogCi0JCXJlc2V0
X2NvdW50ID0gaTkxNV9yZXNldF9jb3VudCgmaTkxNS0+Z3B1X2Vycm9yKTsKLQkJcmVzZXRfZW5n
aW5lX2NvdW50ID0gaTkxNV9yZXNldF9lbmdpbmVfY291bnQoJmk5MTUtPmdwdV9lcnJvciwKLQkJ
CQkJCQkgICAgIGVuZ2luZSk7CisJCXJlc2V0X2NvdW50ID0gaTkxNV9yZXNldF9jb3VudChnbG9i
YWwpOworCQlyZXNldF9lbmdpbmVfY291bnQgPSBpOTE1X3Jlc2V0X2VuZ2luZV9jb3VudChnbG9i
YWwsIGVuZ2luZSk7CiAKIAkJaW50ZWxfZW5naW5lX3BtX2dldChlbmdpbmUpOwotCQlzZXRfYml0
KEk5MTVfUkVTRVRfRU5HSU5FICsgaWQsICZpOTE1LT5ncHVfZXJyb3IuZmxhZ3MpOworCQlzZXRf
Yml0KEk5MTVfUkVTRVRfRU5HSU5FICsgaWQsICZndC0+cmVzZXQuZmxhZ3MpOwogCQlkbyB7CiAJ
CQlpZiAoYWN0aXZlKSB7CiAJCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CiAKLQkJCQltdXRl
eF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwkJCQltdXRleF9sb2NrKCZndC0+aTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCQkJcnEgPSBoYW5nX2NyZWF0ZV9yZXF1ZXN0KCZoLCBl
bmdpbmUpOwogCQkJCWlmIChJU19FUlIocnEpKSB7CiAJCQkJCWVyciA9IFBUUl9FUlIocnEpOwot
CQkJCQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCQkJCQltdXRleF91
bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJCQkJYnJlYWs7CiAJCQkJfQog
CiAJCQkJaTkxNV9yZXF1ZXN0X2dldChycSk7CiAJCQkJaTkxNV9yZXF1ZXN0X2FkZChycSk7Ci0J
CQkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwkJCQltdXRleF91bmxv
Y2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCQkJCWlmICghd2FpdF91bnRpbF9y
dW5uaW5nKCZoLCBycSkpIHsKLQkJCQkJc3RydWN0IGRybV9wcmludGVyIHAgPSBkcm1faW5mb19w
cmludGVyKGk5MTUtPmRybS5kZXYpOworCQkJCQlzdHJ1Y3QgZHJtX3ByaW50ZXIgcCA9IGRybV9p
bmZvX3ByaW50ZXIoZ3QtPmk5MTUtPmRybS5kZXYpOwogCiAJCQkJCXByX2VycigiJXM6IEZhaWxl
ZCB0byBzdGFydCByZXF1ZXN0ICVsbHgsIGF0ICV4XG4iLAogCQkJCQkgICAgICAgX19mdW5jX18s
IHJxLT5mZW5jZS5zZXFubywgaHdzX3NlcW5vKCZoLCBycSkpOwpAQCAtNjIyLDE5ICs2MjAsMTkg
QEAgc3RhdGljIGludCBfX2lndF9yZXNldF9lbmdpbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsIGJvb2wgYWN0aXZlKQogCQkJCWk5MTVfcmVxdWVzdF9wdXQocnEpOwogCQkJfQogCi0J
CQllcnIgPSBpOTE1X3Jlc2V0X2VuZ2luZShlbmdpbmUsIE5VTEwpOworCQkJZXJyID0gaW50ZWxf
ZW5naW5lX3Jlc2V0KGVuZ2luZSwgTlVMTCk7CiAJCQlpZiAoZXJyKSB7CiAJCQkJcHJfZXJyKCJp
OTE1X3Jlc2V0X2VuZ2luZSBmYWlsZWRcbiIpOwogCQkJCWJyZWFrOwogCQkJfQogCi0JCQlpZiAo
aTkxNV9yZXNldF9jb3VudCgmaTkxNS0+Z3B1X2Vycm9yKSAhPSByZXNldF9jb3VudCkgeworCQkJ
aWYgKGk5MTVfcmVzZXRfY291bnQoZ2xvYmFsKSAhPSByZXNldF9jb3VudCkgewogCQkJCXByX2Vy
cigiRnVsbCBHUFUgcmVzZXQgcmVjb3JkZWQhIChlbmdpbmUgcmVzZXQgZXhwZWN0ZWQpXG4iKTsK
IAkJCQllcnIgPSAtRUlOVkFMOwogCQkJCWJyZWFrOwogCQkJfQogCi0JCQlpZiAoaTkxNV9yZXNl
dF9lbmdpbmVfY291bnQoJmk5MTUtPmdwdV9lcnJvciwgZW5naW5lKSAhPQorCQkJaWYgKGk5MTVf
cmVzZXRfZW5naW5lX2NvdW50KGdsb2JhbCwgZW5naW5lKSAhPQogCQkJICAgICsrcmVzZXRfZW5n
aW5lX2NvdW50KSB7CiAJCQkJcHJfZXJyKCIlcyBlbmdpbmUgcmVzZXQgbm90IHJlY29yZGVkIVxu
IiwKIAkJCQkgICAgICAgZW5naW5lLT5uYW1lKTsKQEAgLTY0MiwyNCArNjQwLDI0IEBAIHN0YXRp
YyBpbnQgX19pZ3RfcmVzZXRfZW5naW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBi
b29sIGFjdGl2ZSkKIAkJCQlicmVhazsKIAkJCX0KIAkJfSB3aGlsZSAodGltZV9iZWZvcmUoamlm
ZmllcywgZW5kX3RpbWUpKTsKLQkJY2xlYXJfYml0KEk5MTVfUkVTRVRfRU5HSU5FICsgaWQsICZp
OTE1LT5ncHVfZXJyb3IuZmxhZ3MpOworCQljbGVhcl9iaXQoSTkxNV9SRVNFVF9FTkdJTkUgKyBp
ZCwgJmd0LT5yZXNldC5mbGFncyk7CiAJCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKIAog
CQlpZiAoZXJyKQogCQkJYnJlYWs7CiAKLQkJZXJyID0gaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgMCk7
CisJCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1LCAwKTsKIAkJaWYgKGVycikKIAkJCWJy
ZWFrOwogCX0KIAotCWlmIChpOTE1X3Jlc2V0X2ZhaWxlZChpOTE1KSkKKwlpZiAoaW50ZWxfZ3Rf
aXNfd2VkZ2VkKGd0KSkKIAkJZXJyID0gLUVJTzsKIAogCWlmIChhY3RpdmUpIHsKLQkJbXV0ZXhf
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJCW11dGV4X2xvY2soJmd0LT5pOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKIAkJaGFuZ19maW5pKCZoKTsKLQkJbXV0ZXhfdW5sb2NrKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKKwkJbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7CiAJfQogCiAJcmV0dXJuIGVycjsKQEAgLTcwMSw3ICs2OTksNyBAQCBzdGF0aWMg
aW50IGFjdGl2ZV9yZXF1ZXN0X3B1dChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAkJCSAgcnEt
PmZlbmNlLnNlcW5vKTsKIAkJR0VNX1RSQUNFX0RVTVAoKTsKIAotCQlpOTE1X2dlbV9zZXRfd2Vk
Z2VkKHJxLT5pOTE1KTsKKwkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChycS0+ZW5naW5lLT5ndCk7CiAJ
CWVyciA9IC1FSU87CiAJfQogCkBAIC03NzgsMTAgKzc3NiwxMSBAQCBzdGF0aWMgaW50IGFjdGl2
ZV9lbmdpbmUodm9pZCAqZGF0YSkKIAlyZXR1cm4gZXJyOwogfQogCi1zdGF0aWMgaW50IF9faWd0
X3Jlc2V0X2VuZ2luZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCitzdGF0aWMgaW50
IF9faWd0X3Jlc2V0X2VuZ2luZXMoc3RydWN0IGludGVsX2d0ICpndCwKIAkJCSAgICAgICBjb25z
dCBjaGFyICp0ZXN0X25hbWUsCiAJCQkgICAgICAgdW5zaWduZWQgaW50IGZsYWdzKQogeworCXN0
cnVjdCBpOTE1X2dwdV9lcnJvciAqZ2xvYmFsID0gJmd0LT5pOTE1LT5ncHVfZXJyb3I7CiAJc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCAqb3RoZXI7CiAJZW51bSBpbnRlbF9lbmdpbmVf
aWQgaWQsIHRtcDsKIAlzdHJ1Y3QgaGFuZyBoOwpAQCAtNzkxLDEzICs3OTAsMTMgQEAgc3RhdGlj
IGludCBfX2lndF9yZXNldF9lbmdpbmVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAog
CSAqIHdpdGggYW55IG90aGVyIGVuZ2luZS4KIAkgKi8KIAotCWlmICghaW50ZWxfaGFzX3Jlc2V0
X2VuZ2luZShpOTE1KSkKKwlpZiAoIWludGVsX2hhc19yZXNldF9lbmdpbmUoZ3QtPmk5MTUpKQog
CQlyZXR1cm4gMDsKIAogCWlmIChmbGFncyAmIFRFU1RfQUNUSVZFKSB7Ci0JCW11dGV4X2xvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCQllcnIgPSBoYW5nX2luaXQoJmgsIGk5MTUpOwot
CQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCQltdXRleF9sb2NrKCZn
dC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJCWVyciA9IGhhbmdfaW5pdCgmaCwgZ3QpOwor
CQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJaWYgKGVycikK
IAkJCXJldHVybiBlcnI7CiAKQEAgLTgwNSw5ICs4MDQsOSBAQCBzdGF0aWMgaW50IF9faWd0X3Jl
c2V0X2VuZ2luZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQloLmN0eC0+c2No
ZWQucHJpb3JpdHkgPSAxMDI0OwogCX0KIAotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUs
IGlkKSB7CisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5MTUsIGlkKSB7CiAJCXN0cnVj
dCBhY3RpdmVfZW5naW5lIHRocmVhZHNbSTkxNV9OVU1fRU5HSU5FU10gPSB7fTsKLQkJdW5zaWdu
ZWQgbG9uZyBnbG9iYWwgPSBpOTE1X3Jlc2V0X2NvdW50KCZpOTE1LT5ncHVfZXJyb3IpOworCQl1
bnNpZ25lZCBsb25nIGRldmljZSA9IGk5MTVfcmVzZXRfY291bnQoZ2xvYmFsKTsKIAkJdW5zaWdu
ZWQgbG9uZyBjb3VudCA9IDAsIHJlcG9ydGVkOwogCQlJR1RfVElNRU9VVChlbmRfdGltZSk7CiAK
QEAgLTgyMywxMiArODIyLDExIEBAIHN0YXRpYyBpbnQgX19pZ3RfcmVzZXRfZW5naW5lcyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJfQogCiAJCW1lbXNldCh0aHJlYWRzLCAwLCBz
aXplb2YodGhyZWFkcykpOwotCQlmb3JfZWFjaF9lbmdpbmUob3RoZXIsIGk5MTUsIHRtcCkgewor
CQlmb3JfZWFjaF9lbmdpbmUob3RoZXIsIGd0LT5pOTE1LCB0bXApIHsKIAkJCXN0cnVjdCB0YXNr
X3N0cnVjdCAqdHNrOwogCiAJCQl0aHJlYWRzW3RtcF0ucmVzZXRzID0KLQkJCQlpOTE1X3Jlc2V0
X2VuZ2luZV9jb3VudCgmaTkxNS0+Z3B1X2Vycm9yLAotCQkJCQkJCW90aGVyKTsKKwkJCQlpOTE1
X3Jlc2V0X2VuZ2luZV9jb3VudChnbG9iYWwsIG90aGVyKTsKIAogCQkJaWYgKCEoZmxhZ3MgJiBU
RVNUX09USEVSUykpCiAJCQkJY29udGludWU7CkBAIC04NTEsMjUgKzg0OSwyNSBAQCBzdGF0aWMg
aW50IF9faWd0X3Jlc2V0X2VuZ2luZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJ
CX0KIAogCQlpbnRlbF9lbmdpbmVfcG1fZ2V0KGVuZ2luZSk7Ci0JCXNldF9iaXQoSTkxNV9SRVNF
VF9FTkdJTkUgKyBpZCwgJmk5MTUtPmdwdV9lcnJvci5mbGFncyk7CisJCXNldF9iaXQoSTkxNV9S
RVNFVF9FTkdJTkUgKyBpZCwgJmd0LT5yZXNldC5mbGFncyk7CiAJCWRvIHsKIAkJCXN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxID0gTlVMTDsKIAogCQkJaWYgKGZsYWdzICYgVEVTVF9BQ1RJVkUpIHsK
LQkJCQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwkJCQltdXRleF9sb2Nr
KCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCQkJcnEgPSBoYW5nX2NyZWF0ZV9yZXF1
ZXN0KCZoLCBlbmdpbmUpOwogCQkJCWlmIChJU19FUlIocnEpKSB7CiAJCQkJCWVyciA9IFBUUl9F
UlIocnEpOwotCQkJCQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCQkJ
CQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJCQkJYnJlYWs7
CiAJCQkJfQogCiAJCQkJaTkxNV9yZXF1ZXN0X2dldChycSk7CiAJCQkJaTkxNV9yZXF1ZXN0X2Fk
ZChycSk7Ci0JCQkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwkJCQlt
dXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCQkJCWlmICghd2Fp
dF91bnRpbF9ydW5uaW5nKCZoLCBycSkpIHsKLQkJCQkJc3RydWN0IGRybV9wcmludGVyIHAgPSBk
cm1faW5mb19wcmludGVyKGk5MTUtPmRybS5kZXYpOworCQkJCQlzdHJ1Y3QgZHJtX3ByaW50ZXIg
cCA9IGRybV9pbmZvX3ByaW50ZXIoZ3QtPmk5MTUtPmRybS5kZXYpOwogCiAJCQkJCXByX2Vycigi
JXM6IEZhaWxlZCB0byBzdGFydCByZXF1ZXN0ICVsbHgsIGF0ICV4XG4iLAogCQkJCQkgICAgICAg
X19mdW5jX18sIHJxLT5mZW5jZS5zZXFubywgaHdzX3NlcW5vKCZoLCBycSkpOwpAQCAtODgyLDcg
Kzg4MCw3IEBAIHN0YXRpYyBpbnQgX19pZ3RfcmVzZXRfZW5naW5lcyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKIAkJCQl9CiAJCQl9CiAKLQkJCWVyciA9IGk5MTVfcmVzZXRfZW5naW5l
KGVuZ2luZSwgTlVMTCk7CisJCQllcnIgPSBpbnRlbF9lbmdpbmVfcmVzZXQoZW5naW5lLCBOVUxM
KTsKIAkJCWlmIChlcnIpIHsKIAkJCQlwcl9lcnIoImk5MTVfcmVzZXRfZW5naW5lKCVzOiVzKTog
ZmFpbGVkLCBlcnI9JWRcbiIsCiAJCQkJICAgICAgIGVuZ2luZS0+bmFtZSwgdGVzdF9uYW1lLCBl
cnIpOwpAQCAtODk0LDcgKzg5Miw3IEBAIHN0YXRpYyBpbnQgX19pZ3RfcmVzZXRfZW5naW5lcyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCWlmIChycSkgewogCQkJCWlmIChpOTE1
X3JlcXVlc3Rfd2FpdChycSwgMCwgSFogLyA1KSA8IDApIHsKIAkJCQkJc3RydWN0IGRybV9wcmlu
dGVyIHAgPQotCQkJCQkJZHJtX2luZm9fcHJpbnRlcihpOTE1LT5kcm0uZGV2KTsKKwkJCQkJCWRy
bV9pbmZvX3ByaW50ZXIoZ3QtPmk5MTUtPmRybS5kZXYpOwogCiAJCQkJCXByX2VycigiaTkxNV9y
ZXNldF9lbmdpbmUoJXM6JXMpOiIKIAkJCQkJICAgICAgICIgZmFpbGVkIHRvIGNvbXBsZXRlIHJl
cXVlc3QgYWZ0ZXIgcmVzZXRcbiIsCkBAIC05MDQsNyArOTAyLDcgQEAgc3RhdGljIGludCBfX2ln
dF9yZXNldF9lbmdpbmVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCQlpOTE1
X3JlcXVlc3RfcHV0KHJxKTsKIAogCQkJCQlHRU1fVFJBQ0VfRFVNUCgpOwotCQkJCQlpOTE1X2dl
bV9zZXRfd2VkZ2VkKGk5MTUpOworCQkJCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKGd0KTsKIAkJCQkJ
ZXJyID0gLUVJTzsKIAkJCQkJYnJlYWs7CiAJCQkJfQpAQCAtOTE0LDcgKzkxMiw3IEBAIHN0YXRp
YyBpbnQgX19pZ3RfcmVzZXRfZW5naW5lcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAogCQkJaWYgKCEoZmxhZ3MgJiBURVNUX1NFTEYpICYmICF3YWl0X2Zvcl9pZGxlKGVuZ2luZSkp
IHsKIAkJCQlzdHJ1Y3QgZHJtX3ByaW50ZXIgcCA9Ci0JCQkJCWRybV9pbmZvX3ByaW50ZXIoaTkx
NS0+ZHJtLmRldik7CisJCQkJCWRybV9pbmZvX3ByaW50ZXIoZ3QtPmk5MTUtPmRybS5kZXYpOwog
CiAJCQkJcHJfZXJyKCJpOTE1X3Jlc2V0X2VuZ2luZSglczolcyk6IgogCQkJCSAgICAgICAiIGZh
aWxlZCB0byBpZGxlIGFmdGVyIHJlc2V0XG4iLApAQCAtOTI2LDEyICs5MjQsMTIgQEAgc3RhdGlj
IGludCBfX2lndF9yZXNldF9lbmdpbmVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAog
CQkJCWJyZWFrOwogCQkJfQogCQl9IHdoaWxlICh0aW1lX2JlZm9yZShqaWZmaWVzLCBlbmRfdGlt
ZSkpOwotCQljbGVhcl9iaXQoSTkxNV9SRVNFVF9FTkdJTkUgKyBpZCwgJmk5MTUtPmdwdV9lcnJv
ci5mbGFncyk7CisJCWNsZWFyX2JpdChJOTE1X1JFU0VUX0VOR0lORSArIGlkLCAmZ3QtPnJlc2V0
LmZsYWdzKTsKIAkJaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOwogCQlwcl9pbmZvKCJpOTE1
X3Jlc2V0X2VuZ2luZSglczolcyk6ICVsdSByZXNldHNcbiIsCiAJCQllbmdpbmUtPm5hbWUsIHRl
c3RfbmFtZSwgY291bnQpOwogCi0JCXJlcG9ydGVkID0gaTkxNV9yZXNldF9lbmdpbmVfY291bnQo
Jmk5MTUtPmdwdV9lcnJvciwgZW5naW5lKTsKKwkJcmVwb3J0ZWQgPSBpOTE1X3Jlc2V0X2VuZ2lu
ZV9jb3VudChnbG9iYWwsIGVuZ2luZSk7CiAJCXJlcG9ydGVkIC09IHRocmVhZHNbZW5naW5lLT5p
ZF0ucmVzZXRzOwogCQlpZiAocmVwb3J0ZWQgIT0gY291bnQpIHsKIAkJCXByX2VycigiaTkxNV9y
ZXNldF9lbmdpbmUoJXM6JXMpOiByZXNldCAlbHUgdGltZXMsIGJ1dCByZXBvcnRlZCAlbHVcbiIs
CkBAIC05NDEsNyArOTM5LDcgQEAgc3RhdGljIGludCBfX2lndF9yZXNldF9lbmdpbmVzKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQl9CiAKIHVud2luZDoKLQkJZm9yX2VhY2hfZW5n
aW5lKG90aGVyLCBpOTE1LCB0bXApIHsKKwkJZm9yX2VhY2hfZW5naW5lKG90aGVyLCBndC0+aTkx
NSwgdG1wKSB7CiAJCQlpbnQgcmV0OwogCiAJCQlpZiAoIXRocmVhZHNbdG1wXS50YXNrKQpAQCAt
OTU2LDIyICs5NTQsMjEgQEAgc3RhdGljIGludCBfX2lndF9yZXNldF9lbmdpbmVzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJfQogCQkJcHV0X3Rhc2tfc3RydWN0KHRocmVhZHNb
dG1wXS50YXNrKTsKIAotCQkJaWYgKG90aGVyICE9IGVuZ2luZSAmJgorCQkJaWYgKG90aGVyLT51
YWJpX2NsYXNzICE9IGVuZ2luZS0+dWFiaV9jbGFzcyAmJgogCQkJICAgIHRocmVhZHNbdG1wXS5y
ZXNldHMgIT0KLQkJCSAgICBpOTE1X3Jlc2V0X2VuZ2luZV9jb3VudCgmaTkxNS0+Z3B1X2Vycm9y
LCBvdGhlcikpIHsKKwkJCSAgICBpOTE1X3Jlc2V0X2VuZ2luZV9jb3VudChnbG9iYWwsIG90aGVy
KSkgewogCQkJCXByX2VycigiSW5ub2NlbnQgZW5naW5lICVzIHdhcyByZXNldCAoY291bnQ9JWxk
KVxuIiwKIAkJCQkgICAgICAgb3RoZXItPm5hbWUsCi0JCQkJICAgICAgIGk5MTVfcmVzZXRfZW5n
aW5lX2NvdW50KCZpOTE1LT5ncHVfZXJyb3IsCi0JCQkJCQkJICAgICAgIG90aGVyKSAtCisJCQkJ
ICAgICAgIGk5MTVfcmVzZXRfZW5naW5lX2NvdW50KGdsb2JhbCwgb3RoZXIpIC0KIAkJCQkgICAg
ICAgdGhyZWFkc1t0bXBdLnJlc2V0cyk7CiAJCQkJaWYgKCFlcnIpCiAJCQkJCWVyciA9IC1FSU5W
QUw7CiAJCQl9CiAJCX0KIAotCQlpZiAoZ2xvYmFsICE9IGk5MTVfcmVzZXRfY291bnQoJmk5MTUt
PmdwdV9lcnJvcikpIHsKKwkJaWYgKGRldmljZSAhPSBpOTE1X3Jlc2V0X2NvdW50KGdsb2JhbCkp
IHsKIAkJCXByX2VycigiR2xvYmFsIHJlc2V0IChjb3VudD0lbGQpIVxuIiwKLQkJCSAgICAgICBp
OTE1X3Jlc2V0X2NvdW50KCZpOTE1LT5ncHVfZXJyb3IpIC0gZ2xvYmFsKTsKKwkJCSAgICAgICBp
OTE1X3Jlc2V0X2NvdW50KGdsb2JhbCkgLSBkZXZpY2UpOwogCQkJaWYgKCFlcnIpCiAJCQkJZXJy
ID0gLUVJTlZBTDsKIAkJfQpAQCAtOTc5LDIwICs5NzYsMjAgQEAgc3RhdGljIGludCBfX2lndF9y
ZXNldF9lbmdpbmVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQlpZiAoZXJyKQog
CQkJYnJlYWs7CiAKLQkJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JCWVy
ciA9IGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpOwotCQltdXRleF91bmxv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CisJCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1LCBJOTE1X1dB
SVRfTE9DS0VEKTsKKwkJbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiAJCWlmIChlcnIpCiAJCQlicmVhazsKIAl9CiAKLQlpZiAoaTkxNV9yZXNldF9mYWlsZWQoaTkx
NSkpCisJaWYgKGludGVsX2d0X2lzX3dlZGdlZChndCkpCiAJCWVyciA9IC1FSU87CiAKIAlpZiAo
ZmxhZ3MgJiBURVNUX0FDVElWRSkgewotCQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKKwkJbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQloYW5n
X2ZpbmkoJmgpOwotCQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCQlt
dXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAl9CiAKIAlyZXR1cm4g
ZXJyOwpAQCAtMTAxOCwxMyArMTAxNSwxMyBAQCBzdGF0aWMgaW50IGlndF9yZXNldF9lbmdpbmVz
KHZvaWQgKmFyZykKIAkJfSwKIAkJeyB9CiAJfTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IGFyZzsKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwogCXR5cGVvZigqcGhhc2Vz
KSAqcDsKIAlpbnQgZXJyOwogCiAJZm9yIChwID0gcGhhc2VzOyBwLT5uYW1lOyBwKyspIHsKIAkJ
aWYgKHAtPmZsYWdzICYgVEVTVF9QUklPUklUWSkgewotCQkJaWYgKCEoaTkxNS0+Y2Fwcy5zY2hl
ZHVsZXIgJiBJOTE1X1NDSEVEVUxFUl9DQVBfUFJJT1JJVFkpKQorCQkJaWYgKCEoZ3QtPmk5MTUt
PmNhcHMuc2NoZWR1bGVyICYgSTkxNV9TQ0hFRFVMRVJfQ0FQX1BSSU9SSVRZKSkKIAkJCQljb250
aW51ZTsKIAkJfQogCkBAIC0xMDM2LDM4ICsxMDMzLDM5IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0
X2VuZ2luZXModm9pZCAqYXJnKQogCXJldHVybiAwOwogfQogCi1zdGF0aWMgdTMyIGZha2VfaGFu
Z2NoZWNrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAotCQkJICBpbnRlbF9lbmdpbmVf
bWFza190IG1hc2spCitzdGF0aWMgdTMyIGZha2VfaGFuZ2NoZWNrKHN0cnVjdCBpbnRlbF9ndCAq
Z3QsIGludGVsX2VuZ2luZV9tYXNrX3QgbWFzaykKIHsKLQl1MzIgY291bnQgPSBpOTE1X3Jlc2V0
X2NvdW50KCZpOTE1LT5ncHVfZXJyb3IpOworCXUzMiBjb3VudCA9IGk5MTVfcmVzZXRfY291bnQo
Jmd0LT5pOTE1LT5ncHVfZXJyb3IpOwogCi0JaTkxNV9yZXNldChpOTE1LCBtYXNrLCBOVUxMKTsK
KwlpbnRlbF9ndF9yZXNldChndCwgbWFzaywgTlVMTCk7CiAKIAlyZXR1cm4gY291bnQ7CiB9CiAK
IHN0YXRpYyBpbnQgaWd0X3Jlc2V0X3dhaXQodm9pZCAqYXJnKQogewotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gYXJnOworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CisJc3Ry
dWN0IGk5MTVfZ3B1X2Vycm9yICpnbG9iYWwgPSAmZ3QtPmk5MTUtPmdwdV9lcnJvcjsKKwlzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUgPSBndC0+aTkxNS0+ZW5naW5lW1JDUzBdOwogCXN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwogCXVuc2lnbmVkIGludCByZXNldF9jb3VudDsKIAlzdHJ1
Y3QgaGFuZyBoOwogCWxvbmcgdGltZW91dDsKIAlpbnQgZXJyOwogCi0JaWYgKCFpbnRlbF9lbmdp
bmVfY2FuX3N0b3JlX2R3b3JkKGk5MTUtPmVuZ2luZVtSQ1MwXSkpCisJaWYgKCFlbmdpbmUgfHwg
IWludGVsX2VuZ2luZV9jYW5fc3RvcmVfZHdvcmQoZW5naW5lKSkKIAkJcmV0dXJuIDA7CiAKIAkv
KiBDaGVjayB0aGF0IHdlIGRldGVjdCBhIHN0dWNrIHdhaXRlciBhbmQgaXNzdWUgYSByZXNldCAq
LwogCi0JaWd0X2dsb2JhbF9yZXNldF9sb2NrKGk5MTUpOworCWlndF9nbG9iYWxfcmVzZXRfbG9j
ayhndCk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQllcnIgPSBo
YW5nX2luaXQoJmgsIGk5MTUpOworCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKKwllcnIgPSBoYW5nX2luaXQoJmgsIGd0KTsKIAlpZiAoZXJyKQogCQlnb3RvIHVubG9j
azsKIAotCXJxID0gaGFuZ19jcmVhdGVfcmVxdWVzdCgmaCwgaTkxNS0+ZW5naW5lW1JDUzBdKTsK
KwlycSA9IGhhbmdfY3JlYXRlX3JlcXVlc3QoJmgsIGVuZ2luZSk7CiAJaWYgKElTX0VSUihycSkp
IHsKIAkJZXJyID0gUFRSX0VSUihycSk7CiAJCWdvdG8gZmluaTsKQEAgLTEwNzcsMTkgKzEwNzUs
MTkgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfd2FpdCh2b2lkICphcmcpCiAJaTkxNV9yZXF1ZXN0
X2FkZChycSk7CiAKIAlpZiAoIXdhaXRfdW50aWxfcnVubmluZygmaCwgcnEpKSB7Ci0JCXN0cnVj
dCBkcm1fcHJpbnRlciBwID0gZHJtX2luZm9fcHJpbnRlcihpOTE1LT5kcm0uZGV2KTsKKwkJc3Ry
dWN0IGRybV9wcmludGVyIHAgPSBkcm1faW5mb19wcmludGVyKGd0LT5pOTE1LT5kcm0uZGV2KTsK
IAogCQlwcl9lcnIoIiVzOiBGYWlsZWQgdG8gc3RhcnQgcmVxdWVzdCAlbGx4LCBhdCAleFxuIiwK
IAkJICAgICAgIF9fZnVuY19fLCBycS0+ZmVuY2Uuc2Vxbm8sIGh3c19zZXFubygmaCwgcnEpKTsK
IAkJaW50ZWxfZW5naW5lX2R1bXAocnEtPmVuZ2luZSwgJnAsICIlc1xuIiwgcnEtPmVuZ2luZS0+
bmFtZSk7CiAKLQkJaTkxNV9nZW1fc2V0X3dlZGdlZChpOTE1KTsKKwkJaW50ZWxfZ3Rfc2V0X3dl
ZGdlZChndCk7CiAKIAkJZXJyID0gLUVJTzsKIAkJZ290byBvdXRfcnE7CiAJfQogCi0JcmVzZXRf
Y291bnQgPSBmYWtlX2hhbmdjaGVjayhpOTE1LCBBTExfRU5HSU5FUyk7CisJcmVzZXRfY291bnQg
PSBmYWtlX2hhbmdjaGVjayhndCwgQUxMX0VOR0lORVMpOwogCiAJdGltZW91dCA9IGk5MTVfcmVx
dWVzdF93YWl0KHJxLCAwLCAxMCk7CiAJaWYgKHRpbWVvdXQgPCAwKSB7CkBAIC0xMDk5LDcgKzEw
OTcsNyBAQCBzdGF0aWMgaW50IGlndF9yZXNldF93YWl0KHZvaWQgKmFyZykKIAkJZ290byBvdXRf
cnE7CiAJfQogCi0JaWYgKGk5MTVfcmVzZXRfY291bnQoJmk5MTUtPmdwdV9lcnJvcikgPT0gcmVz
ZXRfY291bnQpIHsKKwlpZiAoaTkxNV9yZXNldF9jb3VudChnbG9iYWwpID09IHJlc2V0X2NvdW50
KSB7CiAJCXByX2VycigiTm8gR1BVIHJlc2V0IHJlY29yZGVkIVxuIik7CiAJCWVyciA9IC1FSU5W
QUw7CiAJCWdvdG8gb3V0X3JxOwpAQCAtMTExMCwxMCArMTEwOCwxMCBAQCBzdGF0aWMgaW50IGln
dF9yZXNldF93YWl0KHZvaWQgKmFyZykKIGZpbmk6CiAJaGFuZ19maW5pKCZoKTsKIHVubG9jazoK
LQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlndF9nbG9iYWxfcmVz
ZXRfdW5sb2NrKGk5MTUpOworCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOworCWlndF9nbG9iYWxfcmVzZXRfdW5sb2NrKGd0KTsKIAotCWlmIChpOTE1X3Jlc2V0X2Zh
aWxlZChpOTE1KSkKKwlpZiAoaW50ZWxfZ3RfaXNfd2VkZ2VkKGd0KSkKIAkJcmV0dXJuIC1FSU87
CiAKIAlyZXR1cm4gZXJyOwpAQCAtMTE3MiwxMSArMTE3MCwxMiBAQCBzdGF0aWMgaW50IGV2aWN0
X2ZlbmNlKHZvaWQgKmRhdGEpCiAJcmV0dXJuIGVycjsKIH0KIAotc3RhdGljIGludCBfX2lndF9y
ZXNldF9ldmljdF92bWEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCitzdGF0aWMgaW50
IF9faWd0X3Jlc2V0X2V2aWN0X3ZtYShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCQkJCSBzdHJ1Y3Qg
aTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAkJCQkgaW50ICgqZm4pKHZvaWQgKiksCiAJCQkJIHVu
c2lnbmVkIGludCBmbGFncykKIHsKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUgPSBn
dC0+aTkxNS0+ZW5naW5lW1JDUzBdOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7
CiAJc3RydWN0IHRhc2tfc3RydWN0ICp0c2sgPSBOVUxMOwogCXN0cnVjdCBpOTE1X3JlcXVlc3Qg
KnJxOwpAQCAtMTE4NCwxNyArMTE4MywxNyBAQCBzdGF0aWMgaW50IF9faWd0X3Jlc2V0X2V2aWN0
X3ZtYShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlzdHJ1Y3QgaGFuZyBoOwogCWlu
dCBlcnI7CiAKLQlpZiAoIWludGVsX2VuZ2luZV9jYW5fc3RvcmVfZHdvcmQoaTkxNS0+ZW5naW5l
W1JDUzBdKSkKKwlpZiAoIWVuZ2luZSB8fCAhaW50ZWxfZW5naW5lX2Nhbl9zdG9yZV9kd29yZChl
bmdpbmUpKQogCQlyZXR1cm4gMDsKIAogCS8qIENoZWNrIHRoYXQgd2UgY2FuIHJlY292ZXIgYW4g
dW5iaW5kIHN0dWNrIG9uIGEgaGFuZ2luZyByZXF1ZXN0ICovCiAKLQltdXRleF9sb2NrKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKLQllcnIgPSBoYW5nX2luaXQoJmgsIGk5MTUpOworCW11dGV4
X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwllcnIgPSBoYW5nX2luaXQoJmgs
IGd0KTsKIAlpZiAoZXJyKQogCQlnb3RvIHVubG9jazsKIAotCW9iaiA9IGk5MTVfZ2VtX29iamVj
dF9jcmVhdGVfaW50ZXJuYWwoaTkxNSwgU1pfMU0pOworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9j
cmVhdGVfaW50ZXJuYWwoZ3QtPmk5MTUsIFNaXzFNKTsKIAlpZiAoSVNfRVJSKG9iaikpIHsKIAkJ
ZXJyID0gUFRSX0VSUihvYmopOwogCQlnb3RvIGZpbmk7CkBAIC0xMjE0LDcgKzEyMTMsNyBAQCBz
dGF0aWMgaW50IF9faWd0X3Jlc2V0X2V2aWN0X3ZtYShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwKIAkJZ290byBvdXRfb2JqOwogCX0KIAotCXJxID0gaGFuZ19jcmVhdGVfcmVxdWVzdCgm
aCwgaTkxNS0+ZW5naW5lW1JDUzBdKTsKKwlycSA9IGhhbmdfY3JlYXRlX3JlcXVlc3QoJmgsIGVu
Z2luZSk7CiAJaWYgKElTX0VSUihycSkpIHsKIAkJZXJyID0gUFRSX0VSUihycSk7CiAJCWdvdG8g
b3V0X29iajsKQEAgLTEyNTIsMTYgKzEyNTEsMTYgQEAgc3RhdGljIGludCBfX2lndF9yZXNldF9l
dmljdF92bWEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJaWYgKGVycikKIAkJZ290
byBvdXRfcnE7CiAKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11
dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJaWYgKCF3YWl0X3Vu
dGlsX3J1bm5pbmcoJmgsIHJxKSkgewotCQlzdHJ1Y3QgZHJtX3ByaW50ZXIgcCA9IGRybV9pbmZv
X3ByaW50ZXIoaTkxNS0+ZHJtLmRldik7CisJCXN0cnVjdCBkcm1fcHJpbnRlciBwID0gZHJtX2lu
Zm9fcHJpbnRlcihndC0+aTkxNS0+ZHJtLmRldik7CiAKIAkJcHJfZXJyKCIlczogRmFpbGVkIHRv
IHN0YXJ0IHJlcXVlc3QgJWxseCwgYXQgJXhcbiIsCiAJCSAgICAgICBfX2Z1bmNfXywgcnEtPmZl
bmNlLnNlcW5vLCBod3Nfc2Vxbm8oJmgsIHJxKSk7CiAJCWludGVsX2VuZ2luZV9kdW1wKHJxLT5l
bmdpbmUsICZwLCAiJXNcbiIsIHJxLT5lbmdpbmUtPm5hbWUpOwogCi0JCWk5MTVfZ2VtX3NldF93
ZWRnZWQoaTkxNSk7CisJCWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOwogCQlnb3RvIG91dF9yZXNl
dDsKIAl9CiAKQEAgLTEyNzgsMzEgKzEyNzcsMzEgQEAgc3RhdGljIGludCBfX2lndF9yZXNldF9l
dmljdF92bWEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJd2FpdF9mb3JfY29tcGxl
dGlvbigmYXJnLmNvbXBsZXRpb24pOwogCiAJaWYgKHdhaXRfZm9yKCFsaXN0X2VtcHR5KCZycS0+
ZmVuY2UuY2JfbGlzdCksIDEwKSkgewotCQlzdHJ1Y3QgZHJtX3ByaW50ZXIgcCA9IGRybV9pbmZv
X3ByaW50ZXIoaTkxNS0+ZHJtLmRldik7CisJCXN0cnVjdCBkcm1fcHJpbnRlciBwID0gZHJtX2lu
Zm9fcHJpbnRlcihndC0+aTkxNS0+ZHJtLmRldik7CiAKIAkJcHJfZXJyKCJpZ3QvZXZpY3Rfdm1h
IGt0aHJlYWQgZGlkIG5vdCB3YWl0XG4iKTsKIAkJaW50ZWxfZW5naW5lX2R1bXAocnEtPmVuZ2lu
ZSwgJnAsICIlc1xuIiwgcnEtPmVuZ2luZS0+bmFtZSk7CiAKLQkJaTkxNV9nZW1fc2V0X3dlZGdl
ZChpOTE1KTsKKwkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CiAJCWdvdG8gb3V0X3Jlc2V0Owog
CX0KIAogb3V0X3Jlc2V0OgotCWlndF9nbG9iYWxfcmVzZXRfbG9jayhpOTE1KTsKLQlmYWtlX2hh
bmdjaGVjayhycS0+aTkxNSwgcnEtPmVuZ2luZS0+bWFzayk7Ci0JaWd0X2dsb2JhbF9yZXNldF91
bmxvY2soaTkxNSk7CisJaWd0X2dsb2JhbF9yZXNldF9sb2NrKGd0KTsKKwlmYWtlX2hhbmdjaGVj
ayhndCwgcnEtPmVuZ2luZS0+bWFzayk7CisJaWd0X2dsb2JhbF9yZXNldF91bmxvY2soZ3QpOwog
CiAJaWYgKHRzaykgewotCQlzdHJ1Y3QgaWd0X3dlZGdlX21lIHc7CisJCXN0cnVjdCBpbnRlbF93
ZWRnZV9tZSB3OwogCiAJCS8qIFRoZSByZXNldCwgZXZlbiBpbmRpcmVjdGx5LCBzaG91bGQgdGFr
ZSBsZXNzIHRoYW4gMTBtcy4gKi8KLQkJaWd0X3dlZGdlX29uX3RpbWVvdXQoJncsIGk5MTUsIEha
IC8gMTAgLyogMTAwbXMgdGltZW91dCovKQorCQlpbnRlbF93ZWRnZV9vbl90aW1lb3V0KCZ3LCBn
dCwgSFogLyAxMCAvKiAxMDBtcyAqLykKIAkJCWVyciA9IGt0aHJlYWRfc3RvcCh0c2spOwogCiAJ
CXB1dF90YXNrX3N0cnVjdCh0c2spOwogCX0KIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOworCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIG91
dF9ycToKIAlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKIG91dF9vYmo6CkBAIC0xMzEwLDkgKzEzMDks
OSBAQCBzdGF0aWMgaW50IF9faWd0X3Jlc2V0X2V2aWN0X3ZtYShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwKIGZpbmk6CiAJaGFuZ19maW5pKCZoKTsKIHVubG9jazoKLQltdXRleF91bmxv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwogCi0JaWYgKGk5MTVfcmVzZXRfZmFpbGVkKGk5MTUpKQorCWlmIChp
bnRlbF9ndF9pc193ZWRnZWQoZ3QpKQogCQlyZXR1cm4gLUVJTzsKIAogCXJldHVybiBlcnI7CkBA
IC0xMzIwLDI2ICsxMzE5LDI2IEBAIHN0YXRpYyBpbnQgX19pZ3RfcmVzZXRfZXZpY3Rfdm1hKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCiBzdGF0aWMgaW50IGlndF9yZXNldF9ldmlj
dF9nZ3R0KHZvaWQgKmFyZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFy
ZzsKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwogCi0JcmV0dXJuIF9faWd0X3Jlc2V0X2V2
aWN0X3ZtYShpOTE1LCAmaTkxNS0+Z2d0dC52bSwKKwlyZXR1cm4gX19pZ3RfcmVzZXRfZXZpY3Rf
dm1hKGd0LCAmZ3QtPmdndHQtPnZtLAogCQkJCSAgICAgZXZpY3Rfdm1hLCBFWEVDX09CSkVDVF9X
UklURSk7CiB9CiAKIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X2V2aWN0X3BwZ3R0KHZvaWQgKmFyZykK
IHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKKwlzdHJ1Y3QgaW50ZWxf
Z3QgKmd0ID0gYXJnOwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CiAJc3RydWN0IGRy
bV9maWxlICpmaWxlOwogCWludCBlcnI7CiAKLQlmaWxlID0gbW9ja19maWxlKGk5MTUpOworCWZp
bGUgPSBtb2NrX2ZpbGUoZ3QtPmk5MTUpOwogCWlmIChJU19FUlIoZmlsZSkpCiAJCXJldHVybiBQ
VFJfRVJSKGZpbGUpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0J
Y3R4ID0gbGl2ZV9jb250ZXh0KGk5MTUsIGZpbGUpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OworCWN0eCA9IGxpdmVfY29udGV4dChndC0+aTkxNSwgZmlsZSk7CisJbXV0ZXhfdW5sb2NrKCZn
dC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKElTX0VSUihjdHgpKSB7CiAJCWVyciA9
IFBUUl9FUlIoY3R4KTsKIAkJZ290byBvdXQ7CkBAIC0xMzQ3LDI5ICsxMzQ2LDI5IEBAIHN0YXRp
YyBpbnQgaWd0X3Jlc2V0X2V2aWN0X3BwZ3R0KHZvaWQgKmFyZykKIAogCWVyciA9IDA7CiAJaWYg
KGN0eC0+dm0pIC8qIGFsaWFzaW5nID09IGdsb2JhbCBndHQgbG9ja2luZywgY292ZXJlZCBhYm92
ZSAqLwotCQllcnIgPSBfX2lndF9yZXNldF9ldmljdF92bWEoaTkxNSwgY3R4LT52bSwKKwkJZXJy
ID0gX19pZ3RfcmVzZXRfZXZpY3Rfdm1hKGd0LCBjdHgtPnZtLAogCQkJCQkgICAgZXZpY3Rfdm1h
LCBFWEVDX09CSkVDVF9XUklURSk7CiAKIG91dDoKLQltb2NrX2ZpbGVfZnJlZShpOTE1LCBmaWxl
KTsKKwltb2NrX2ZpbGVfZnJlZShndC0+aTkxNSwgZmlsZSk7CiAJcmV0dXJuIGVycjsKIH0KIAog
c3RhdGljIGludCBpZ3RfcmVzZXRfZXZpY3RfZmVuY2Uodm9pZCAqYXJnKQogewotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnOworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7
CiAKLQlyZXR1cm4gX19pZ3RfcmVzZXRfZXZpY3Rfdm1hKGk5MTUsICZpOTE1LT5nZ3R0LnZtLAor
CXJldHVybiBfX2lndF9yZXNldF9ldmljdF92bWEoZ3QsICZndC0+Z2d0dC0+dm0sCiAJCQkJICAg
ICBldmljdF9mZW5jZSwgRVhFQ19PQkpFQ1RfTkVFRFNfRkVOQ0UpOwogfQogCi1zdGF0aWMgaW50
IHdhaXRfZm9yX290aGVycyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKK3N0YXRpYyBp
bnQgd2FpdF9mb3Jfb3RoZXJzKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCiAJCQkgICBzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICpleGNsdWRlKQogewogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZTsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKIAotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUs
IGk5MTUsIGlkKSB7CisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5MTUsIGlkKSB7CiAJ
CWlmIChlbmdpbmUgPT0gZXhjbHVkZSkKIAkJCWNvbnRpbnVlOwogCkBAIC0xMzgyLDcgKzEzODEs
OCBAQCBzdGF0aWMgaW50IHdhaXRfZm9yX290aGVycyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwKIAogc3RhdGljIGludCBpZ3RfcmVzZXRfcXVldWUodm9pZCAqYXJnKQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnOworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBh
cmc7CisJc3RydWN0IGk5MTVfZ3B1X2Vycm9yICpnbG9iYWwgPSAmZ3QtPmk5MTUtPmdwdV9lcnJv
cjsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJZW51bSBpbnRlbF9lbmdpbmVf
aWQgaWQ7CiAJc3RydWN0IGhhbmcgaDsKQEAgLTEzOTAsMTQgKzEzOTAsMTQgQEAgc3RhdGljIGlu
dCBpZ3RfcmVzZXRfcXVldWUodm9pZCAqYXJnKQogCiAJLyogQ2hlY2sgdGhhdCB3ZSByZXBsYXkg
cGVuZGluZyByZXF1ZXN0cyBmb2xsb3dpbmcgYSBoYW5nICovCiAKLQlpZ3RfZ2xvYmFsX3Jlc2V0
X2xvY2soaTkxNSk7CisJaWd0X2dsb2JhbF9yZXNldF9sb2NrKGd0KTsKIAotCW11dGV4X2xvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWVyciA9IGhhbmdfaW5pdCgmaCwgaTkxNSk7CisJ
bXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWVyciA9IGhhbmdfaW5p
dCgmaCwgZ3QpOwogCWlmIChlcnIpCiAJCWdvdG8gdW5sb2NrOwogCi0JZm9yX2VhY2hfZW5naW5l
KGVuZ2luZSwgaTkxNSwgaWQpIHsKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndC0+aTkxNSwg
aWQpIHsKIAkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcHJldjsKIAkJSUdUX1RJTUVPVVQoZW5kX3Rp
bWUpOwogCQl1bnNpZ25lZCBpbnQgY291bnQ7CkBAIC0xNDM4LDcgKzE0MzgsNyBAQCBzdGF0aWMg
aW50IGlndF9yZXNldF9xdWV1ZSh2b2lkICphcmcpCiAJCQkgKiAoaGFuZ2NoZWNrKSwgb3Igd2Ug
Zm9jdXMgb24gcmVzZXR0aW5nIGp1c3Qgb25lCiAJCQkgKiBlbmdpbmUgYW5kIHNvIGF2b2lkIHJl
cGVhdGVkbHkgcmVzZXR0aW5nIGlubm9jZW50cy4KIAkJCSAqLwotCQkJZXJyID0gd2FpdF9mb3Jf
b3RoZXJzKGk5MTUsIGVuZ2luZSk7CisJCQllcnIgPSB3YWl0X2Zvcl9vdGhlcnMoZ3QsIGVuZ2lu
ZSk7CiAJCQlpZiAoZXJyKSB7CiAJCQkJcHJfZXJyKCIlcyglcyk6IEZhaWxlZCB0byBpZGxlIG90
aGVyIGluYWN0aXZlIGVuZ2luZXMgYWZ0ZXIgZGV2aWNlIHJlc2V0XG4iLAogCQkJCSAgICAgICBf
X2Z1bmNfXywgZW5naW5lLT5uYW1lKTsKQEAgLTE0NDYsMTIgKzE0NDYsMTIgQEAgc3RhdGljIGlu
dCBpZ3RfcmVzZXRfcXVldWUodm9pZCAqYXJnKQogCQkJCWk5MTVfcmVxdWVzdF9wdXQocHJldik7
CiAKIAkJCQlHRU1fVFJBQ0VfRFVNUCgpOwotCQkJCWk5MTVfZ2VtX3NldF93ZWRnZWQoaTkxNSk7
CisJCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CiAJCQkJZ290byBmaW5pOwogCQkJfQogCiAJ
CQlpZiAoIXdhaXRfdW50aWxfcnVubmluZygmaCwgcHJldikpIHsKLQkJCQlzdHJ1Y3QgZHJtX3By
aW50ZXIgcCA9IGRybV9pbmZvX3ByaW50ZXIoaTkxNS0+ZHJtLmRldik7CisJCQkJc3RydWN0IGRy
bV9wcmludGVyIHAgPSBkcm1faW5mb19wcmludGVyKGd0LT5pOTE1LT5kcm0uZGV2KTsKIAogCQkJ
CXByX2VycigiJXMoJXMpOiBGYWlsZWQgdG8gc3RhcnQgcmVxdWVzdCAlbGx4LCBhdCAleFxuIiwK
IAkJCQkgICAgICAgX19mdW5jX18sIGVuZ2luZS0+bmFtZSwKQEAgLTE0NjIsMTMgKzE0NjIsMTMg
QEAgc3RhdGljIGludCBpZ3RfcmVzZXRfcXVldWUodm9pZCAqYXJnKQogCQkJCWk5MTVfcmVxdWVz
dF9wdXQocnEpOwogCQkJCWk5MTVfcmVxdWVzdF9wdXQocHJldik7CiAKLQkJCQlpOTE1X2dlbV9z
ZXRfd2VkZ2VkKGk5MTUpOworCQkJCWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOwogCiAJCQkJZXJy
ID0gLUVJTzsKIAkJCQlnb3RvIGZpbmk7CiAJCQl9CiAKLQkJCXJlc2V0X2NvdW50ID0gZmFrZV9o
YW5nY2hlY2soaTkxNSwgQklUKGlkKSk7CisJCQlyZXNldF9jb3VudCA9IGZha2VfaGFuZ2NoZWNr
KGd0LCBCSVQoaWQpKTsKIAogCQkJaWYgKHByZXYtPmZlbmNlLmVycm9yICE9IC1FSU8pIHsKIAkJ
CQlwcl9lcnIoIkdQVSByZXNldCBub3QgcmVjb3JkZWQgb24gaGFuZ2luZyByZXF1ZXN0IFtmZW5j
ZS5lcnJvcj0lZF0hXG4iLApAQCAtMTQ4OCw3ICsxNDg4LDcgQEAgc3RhdGljIGludCBpZ3RfcmVz
ZXRfcXVldWUodm9pZCAqYXJnKQogCQkJCWdvdG8gZmluaTsKIAkJCX0KIAotCQkJaWYgKGk5MTVf
cmVzZXRfY291bnQoJmk5MTUtPmdwdV9lcnJvcikgPT0gcmVzZXRfY291bnQpIHsKKwkJCWlmIChp
OTE1X3Jlc2V0X2NvdW50KGdsb2JhbCkgPT0gcmVzZXRfY291bnQpIHsKIAkJCQlwcl9lcnIoIk5v
IEdQVSByZXNldCByZWNvcmRlZCFcbiIpOwogCQkJCWk5MTVfcmVxdWVzdF9wdXQocnEpOwogCQkJ
CWk5MTVfcmVxdWVzdF9wdXQocHJldik7CkBAIC0xNTA3LDcgKzE1MDcsNyBAQCBzdGF0aWMgaW50
IGlndF9yZXNldF9xdWV1ZSh2b2lkICphcmcpCiAKIAkJaTkxNV9yZXF1ZXN0X3B1dChwcmV2KTsK
IAotCQllcnIgPSBpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKTsKKwkJZXJy
ID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpOwogCQlpZiAoZXJy
KQogCQkJYnJlYWs7CiAJfQpAQCAtMTUxNSwxMCArMTUxNSwxMCBAQCBzdGF0aWMgaW50IGlndF9y
ZXNldF9xdWV1ZSh2b2lkICphcmcpCiBmaW5pOgogCWhhbmdfZmluaSgmaCk7CiB1bmxvY2s6Ci0J
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZ3RfZ2xvYmFsX3Jlc2V0
X3VubG9jayhpOTE1KTsKKwltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKKwlpZ3RfZ2xvYmFsX3Jlc2V0X3VubG9jayhndCk7CiAKLQlpZiAoaTkxNV9yZXNldF9mYWls
ZWQoaTkxNSkpCisJaWYgKGludGVsX2d0X2lzX3dlZGdlZChndCkpCiAJCXJldHVybiAtRUlPOwog
CiAJcmV0dXJuIGVycjsKQEAgLTE1MjYsOCArMTUyNiw5IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0
X3F1ZXVlKHZvaWQgKmFyZykKIAogc3RhdGljIGludCBpZ3RfaGFuZGxlX2Vycm9yKHZvaWQgKmFy
ZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKLQlzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUgPSBpOTE1LT5lbmdpbmVbUkNTMF07CisJc3RydWN0IGludGVs
X2d0ICpndCA9IGFyZzsKKwlzdHJ1Y3QgaTkxNV9ncHVfZXJyb3IgKmdsb2JhbCA9ICZndC0+aTkx
NS0+Z3B1X2Vycm9yOworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSA9IGd0LT5pOTE1
LT5lbmdpbmVbUkNTMF07CiAJc3RydWN0IGhhbmcgaDsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
cTsKIAlzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKmVycm9yOwpAQCAtMTUzNSwxNSArMTUzNiwxNSBA
QCBzdGF0aWMgaW50IGlndF9oYW5kbGVfZXJyb3Iodm9pZCAqYXJnKQogCiAJLyogQ2hlY2sgdGhh
dCB3ZSBjYW4gaXNzdWUgYSBnbG9iYWwgR1BVIGFuZCBlbmdpbmUgcmVzZXQgKi8KIAotCWlmICgh
aW50ZWxfaGFzX3Jlc2V0X2VuZ2luZShpOTE1KSkKKwlpZiAoIWludGVsX2hhc19yZXNldF9lbmdp
bmUoZ3QtPmk5MTUpKQogCQlyZXR1cm4gMDsKIAogCWlmICghZW5naW5lIHx8ICFpbnRlbF9lbmdp
bmVfY2FuX3N0b3JlX2R3b3JkKGVuZ2luZSkpCiAJCXJldHVybiAwOwogCi0JbXV0ZXhfbG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCi0JZXJyID0gaGFuZ19pbml0KCZoLCBpOTE1KTsKKwllcnIgPSBoYW5nX2lu
aXQoJmgsIGd0KTsKIAlpZiAoZXJyKQogCQlnb3RvIGVycl91bmxvY2s7CiAKQEAgLTE1NTcsMjgg
KzE1NTgsMjggQEAgc3RhdGljIGludCBpZ3RfaGFuZGxlX2Vycm9yKHZvaWQgKmFyZykKIAlpOTE1
X3JlcXVlc3RfYWRkKHJxKTsKIAogCWlmICghd2FpdF91bnRpbF9ydW5uaW5nKCZoLCBycSkpIHsK
LQkJc3RydWN0IGRybV9wcmludGVyIHAgPSBkcm1faW5mb19wcmludGVyKGk5MTUtPmRybS5kZXYp
OworCQlzdHJ1Y3QgZHJtX3ByaW50ZXIgcCA9IGRybV9pbmZvX3ByaW50ZXIoZ3QtPmk5MTUtPmRy
bS5kZXYpOwogCiAJCXByX2VycigiJXM6IEZhaWxlZCB0byBzdGFydCByZXF1ZXN0ICVsbHgsIGF0
ICV4XG4iLAogCQkgICAgICAgX19mdW5jX18sIHJxLT5mZW5jZS5zZXFubywgaHdzX3NlcW5vKCZo
LCBycSkpOwogCQlpbnRlbF9lbmdpbmVfZHVtcChycS0+ZW5naW5lLCAmcCwgIiVzXG4iLCBycS0+
ZW5naW5lLT5uYW1lKTsKIAotCQlpOTE1X2dlbV9zZXRfd2VkZ2VkKGk5MTUpOworCQlpbnRlbF9n
dF9zZXRfd2VkZ2VkKGd0KTsKIAogCQllcnIgPSAtRUlPOwogCQlnb3RvIGVycl9yZXF1ZXN0Owog
CX0KIAotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5s
b2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAkvKiBUZW1wb3JhcmlseSBkaXNh
YmxlIGVycm9yIGNhcHR1cmUgKi8KLQllcnJvciA9IHhjaGcoJmk5MTUtPmdwdV9lcnJvci5maXJz
dF9lcnJvciwgKHZvaWQgKiktMSk7CisJZXJyb3IgPSB4Y2hnKCZnbG9iYWwtPmZpcnN0X2Vycm9y
LCAodm9pZCAqKS0xKTsKIAotCWk5MTVfaGFuZGxlX2Vycm9yKGk5MTUsIGVuZ2luZS0+bWFzaywg
MCwgTlVMTCk7CisJaW50ZWxfZ3RfaGFuZGxlX2Vycm9yKGd0LCBlbmdpbmUtPm1hc2ssIDAsIE5V
TEwpOwogCi0JeGNoZygmaTkxNS0+Z3B1X2Vycm9yLmZpcnN0X2Vycm9yLCBlcnJvcik7CisJeGNo
ZygmZ2xvYmFsLT5maXJzdF9lcnJvciwgZXJyb3IpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwogCiAJaWYgKHJxLT5mZW5jZS5lcnJvciAhPSAtRUlPKSB7CiAJCXByX2VycigiR3VpbHR5IHJl
cXVlc3Qgbm90IGlkZW50aWZpZWQhXG4iKTsKQEAgLTE1OTEsNyArMTU5Miw3IEBAIHN0YXRpYyBp
bnQgaWd0X2hhbmRsZV9lcnJvcih2b2lkICphcmcpCiBlcnJfZmluaToKIAloYW5nX2ZpbmkoJmgp
OwogZXJyX3VubG9jazoKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwor
CW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7
CiB9CiAKQEAgLTE2MDgsNyArMTYwOSw3IEBAIHN0YXRpYyBpbnQgX19pZ3RfYXRvbWljX3Jlc2V0
X2VuZ2luZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJdGFza2xldF9kaXNhYmxl
X25vc3luYyh0KTsKIAlwLT5jcml0aWNhbF9zZWN0aW9uX2JlZ2luKCk7CiAKLQllcnIgPSBpOTE1
X3Jlc2V0X2VuZ2luZShlbmdpbmUsIE5VTEwpOworCWVyciA9IGludGVsX2VuZ2luZV9yZXNldChl
bmdpbmUsIE5VTEwpOwogCiAJcC0+Y3JpdGljYWxfc2VjdGlvbl9lbmQoKTsKIAl0YXNrbGV0X2Vu
YWJsZSh0KTsKQEAgLTE2MjMsNyArMTYyNCw2IEBAIHN0YXRpYyBpbnQgX19pZ3RfYXRvbWljX3Jl
c2V0X2VuZ2luZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiBzdGF0aWMgaW50IGln
dF9hdG9taWNfcmVzZXRfZW5naW5lKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAkJ
CQkgICBjb25zdCBzdHJ1Y3QgaWd0X2F0b21pY19zZWN0aW9uICpwKQogewotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gZW5naW5lLT5pOTE1OwogCXN0cnVjdCBpOTE1X3JlcXVlc3Qg
KnJxOwogCXN0cnVjdCBoYW5nIGg7CiAJaW50IGVycjsKQEAgLTE2MzIsNyArMTYzMiw3IEBAIHN0
YXRpYyBpbnQgaWd0X2F0b21pY19yZXNldF9lbmdpbmUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lLAogCWlmIChlcnIpCiAJCXJldHVybiBlcnI7CiAKLQllcnIgPSBoYW5nX2luaXQoJmgs
IGk5MTUpOworCWVyciA9IGhhbmdfaW5pdCgmaCwgZW5naW5lLT5ndCk7CiAJaWYgKGVycikKIAkJ
cmV0dXJuIGVycjsKIApAQCAtMTY1MSwxNiArMTY1MSwxNiBAQCBzdGF0aWMgaW50IGlndF9hdG9t
aWNfcmVzZXRfZW5naW5lKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAkJcHJfZXJy
KCIlcyglcyk6IEZhaWxlZCB0byBzdGFydCByZXF1ZXN0ICVsbHgsIGF0ICV4XG4iLAogCQkgICAg
ICAgX19mdW5jX18sIGVuZ2luZS0+bmFtZSwKIAkJICAgICAgIHJxLT5mZW5jZS5zZXFubywgaHdz
X3NlcW5vKCZoLCBycSkpOwotCQlpOTE1X2dlbV9zZXRfd2VkZ2VkKGk5MTUpOworCQlpbnRlbF9n
dF9zZXRfd2VkZ2VkKGVuZ2luZS0+Z3QpOwogCQllcnIgPSAtRUlPOwogCX0KIAogCWlmIChlcnIg
PT0gMCkgewotCQlzdHJ1Y3QgaWd0X3dlZGdlX21lIHc7CisJCXN0cnVjdCBpbnRlbF93ZWRnZV9t
ZSB3OwogCi0JCWlndF93ZWRnZV9vbl90aW1lb3V0KCZ3LCBpOTE1LCBIWiAvIDIwIC8qIDUwbXMg
dGltZW91dCovKQorCQlpbnRlbF93ZWRnZV9vbl90aW1lb3V0KCZ3LCBlbmdpbmUtPmd0LCBIWiAv
IDIwIC8qIDUwbXMgKi8pCiAJCQlpOTE1X3JlcXVlc3Rfd2FpdChycSwgMCwgTUFYX1NDSEVEVUxF
X1RJTUVPVVQpOwotCQlpZiAoaTkxNV9yZXNldF9mYWlsZWQoaTkxNSkpCisJCWlmIChpbnRlbF9n
dF9pc193ZWRnZWQoZW5naW5lLT5ndCkpCiAJCQllcnIgPSAtRUlPOwogCX0KIApAQCAtMTY3Miwz
MCArMTY3MiwzMCBAQCBzdGF0aWMgaW50IGlndF9hdG9taWNfcmVzZXRfZW5naW5lKHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAogc3RhdGljIGludCBpZ3RfcmVzZXRfZW5naW5lc19h
dG9taWModm9pZCAqYXJnKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJn
OworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CiAJY29uc3QgdHlwZW9mKCppZ3RfYXRvbWlj
X3BoYXNlcykgKnA7CiAJaW50IGVyciA9IDA7CiAKIAkvKiBDaGVjayB0aGF0IHRoZSBlbmdpbmVz
IHJlc2V0cyBhcmUgdXNhYmxlIGZyb20gYXRvbWljIGNvbnRleHQgKi8KIAotCWlmICghaW50ZWxf
aGFzX3Jlc2V0X2VuZ2luZShpOTE1KSkKKwlpZiAoIWludGVsX2hhc19yZXNldF9lbmdpbmUoZ3Qt
Pmk5MTUpKQogCQlyZXR1cm4gMDsKIAotCWlmIChVU0VTX0dVQ19TVUJNSVNTSU9OKGk5MTUpKQor
CWlmIChVU0VTX0dVQ19TVUJNSVNTSU9OKGd0LT5pOTE1KSkKIAkJcmV0dXJuIDA7CiAKLQlpZ3Rf
Z2xvYmFsX3Jlc2V0X2xvY2soaTkxNSk7Ci0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CisJaWd0X2dsb2JhbF9yZXNldF9sb2NrKGd0KTsKKwltdXRleF9sb2NrKCZndC0+aTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAkvKiBGbHVzaCBhbnkgcmVxdWVzdHMgYmVmb3JlIHdl
IGdldCBzdGFydGVkIGFuZCBjaGVjayBiYXNpY3MgKi8KLQlpZiAoIWlndF9mb3JjZV9yZXNldChp
OTE1KSkKKwlpZiAoIWlndF9mb3JjZV9yZXNldChndCkpCiAJCWdvdG8gdW5sb2NrOwogCiAJZm9y
IChwID0gaWd0X2F0b21pY19waGFzZXM7IHAtPm5hbWU7IHArKykgewogCQlzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmU7CiAJCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwogCi0JCWZvcl9l
YWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7CisJCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUs
IGd0LT5pOTE1LCBpZCkgewogCQkJZXJyID0gaWd0X2F0b21pY19yZXNldF9lbmdpbmUoZW5naW5l
LCBwKTsKIAkJCWlmIChlcnIpCiAJCQkJZ290byBvdXQ7CkBAIC0xNzA0LDExICsxNzA0LDExIEBA
IHN0YXRpYyBpbnQgaWd0X3Jlc2V0X2VuZ2luZXNfYXRvbWljKHZvaWQgKmFyZykKIAogb3V0Ogog
CS8qIEFzIHdlIHBva2UgYXJvdW5kIHRoZSBndXRzLCBkbyBhIGZ1bGwgcmVzZXQgYmVmb3JlIGNv
bnRpbnVpbmcuICovCi0JaWd0X2ZvcmNlX3Jlc2V0KGk5MTUpOworCWlndF9mb3JjZV9yZXNldChn
dCk7CiAKIHVubG9jazoKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwot
CWlndF9nbG9iYWxfcmVzZXRfdW5sb2NrKGk5MTUpOworCW11dGV4X3VubG9jaygmZ3QtPmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOworCWlndF9nbG9iYWxfcmVzZXRfdW5sb2NrKGd0KTsKIAogCXJl
dHVybiBlcnI7CiB9CkBAIC0xNzMwLDI4ICsxNzMwLDI5IEBAIGludCBpbnRlbF9oYW5nY2hlY2tf
bGl2ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJCVNVQlRFU1Qo
aWd0X3Jlc2V0X2V2aWN0X2ZlbmNlKSwKIAkJU1VCVEVTVChpZ3RfaGFuZGxlX2Vycm9yKSwKIAl9
OworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSAmaTkxNS0+Z3Q7CiAJaW50ZWxfd2FrZXJlZl90IHdh
a2VyZWY7CiAJYm9vbCBzYXZlZF9oYW5nY2hlY2s7CiAJaW50IGVycjsKIAotCWlmICghaW50ZWxf
aGFzX2dwdV9yZXNldChpOTE1KSkKKwlpZiAoIWludGVsX2hhc19ncHVfcmVzZXQoZ3QtPmk5MTUp
KQogCQlyZXR1cm4gMDsKIAotCWlmIChpOTE1X3Rlcm1pbmFsbHlfd2VkZ2VkKGk5MTUpKQorCWlm
IChpbnRlbF9ndF9pc193ZWRnZWQoZ3QpKQogCQlyZXR1cm4gLUVJTzsgLyogd2UncmUgbG9uZyBw
YXN0IGhvcGUgb2YgYSBzdWNjZXNzZnVsIHJlc2V0ICovCiAKLQl3YWtlcmVmID0gaW50ZWxfcnVu
dGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOworCXdha2VyZWYgPSBpbnRlbF9ydW50aW1l
X3BtX2dldCgmZ3QtPmk5MTUtPnJ1bnRpbWVfcG0pOwogCXNhdmVkX2hhbmdjaGVjayA9IGZldGNo
X2FuZF96ZXJvKCZpOTE1X21vZHBhcmFtcy5lbmFibGVfaGFuZ2NoZWNrKTsKLQlkcmFpbl9kZWxh
eWVkX3dvcmsoJmk5MTUtPmdwdV9lcnJvci5oYW5nY2hlY2tfd29yayk7IC8qIGZsdXNoIHBhcmFt
ICovCisJZHJhaW5fZGVsYXllZF93b3JrKCZndC0+aGFuZ2NoZWNrLndvcmspOyAvKiBmbHVzaCBw
YXJhbSAqLwogCi0JZXJyID0gaTkxNV9saXZlX3N1YnRlc3RzKHRlc3RzLCBpOTE1KTsKKwllcnIg
PSBpbnRlbF9ndF9saXZlX3N1YnRlc3RzKHRlc3RzLCBndCk7CiAKLQltdXRleF9sb2NrKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9D
S0VEKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X2xv
Y2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlpZ3RfZmx1c2hfdGVzdChndC0+aTkx
NSwgSTkxNV9XQUlUX0xPQ0tFRCk7CisJbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7CiAKIAlpOTE1X21vZHBhcmFtcy5lbmFibGVfaGFuZ2NoZWNrID0gc2F2ZWRfaGFu
Z2NoZWNrOwotCWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVm
KTsKKwlpbnRlbF9ydW50aW1lX3BtX3B1dCgmZ3QtPmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYp
OwogCiAJcmV0dXJuIGVycjsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3NlbGZ0ZXN0X2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMK
aW5kZXggYjliODgxYWI4ZTdjLi42NzhlOWIyZWRmOGQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3NlbGZ0ZXN0X2xyYy5jCkBAIC01NSw3ICs1NSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9zYW5pdHlj
aGVjayh2b2lkICphcmcpCiAJCWlmICghaWd0X3dhaXRfZm9yX3NwaW5uZXIoJnNwaW4sIHJxKSkg
ewogCQkJR0VNX1RSQUNFKCJzcGlubmVyIGZhaWxlZCB0byBzdGFydFxuIik7CiAJCQlHRU1fVFJB
Q0VfRFVNUCgpOwotCQkJaTkxNV9nZW1fc2V0X3dlZGdlZChpOTE1KTsKKwkJCWludGVsX2d0X3Nl
dF93ZWRnZWQoJmk5MTUtPmd0KTsKIAkJCWVyciA9IC1FSU87CiAJCQlnb3RvIGVycl9jdHg7CiAJ
CX0KQEAgLTIxMSw3ICsyMTEsNyBAQCBzbGljZV9zZW1hcGhvcmVfcXVldWUoc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqb3V0ZXIsCiAJCXByX2VycigiRmFpbGVkIHRvIHNsaWNlIGFsb25nIHNlbWFw
aG9yZSBjaGFpbiBvZiBsZW5ndGggKCVkLCAlZCkhXG4iLAogCQkgICAgICAgY291bnQsIG4pOwog
CQlHRU1fVFJBQ0VfRFVNUCgpOwotCQlpOTE1X2dlbV9zZXRfd2VkZ2VkKG91dGVyLT5pOTE1KTsK
KwkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChvdXRlci0+Z3QpOwogCQllcnIgPSAtRUlPOwogCX0KIApA
QCAtNDQ1LDcgKzQ0NSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9idXN5d2FpdF9wcmVlbXB0KHZvaWQg
KmFyZykKIAkJCWludGVsX2VuZ2luZV9kdW1wKGVuZ2luZSwgJnAsICIlc1xuIiwgZW5naW5lLT5u
YW1lKTsKIAkJCUdFTV9UUkFDRV9EVU1QKCk7CiAKLQkJCWk5MTVfZ2VtX3NldF93ZWRnZWQoaTkx
NSk7CisJCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZpOTE1LT5ndCk7CiAJCQllcnIgPSAtRUlPOwog
CQkJZ290byBlcnJfdm1hOwogCQl9CkBAIC01MzQsNyArNTM0LDcgQEAgc3RhdGljIGludCBsaXZl
X3ByZWVtcHQodm9pZCAqYXJnKQogCQlpZiAoIWlndF93YWl0X2Zvcl9zcGlubmVyKCZzcGluX2xv
LCBycSkpIHsKIAkJCUdFTV9UUkFDRSgibG8gc3Bpbm5lciBmYWlsZWQgdG8gc3RhcnRcbiIpOwog
CQkJR0VNX1RSQUNFX0RVTVAoKTsKLQkJCWk5MTVfZ2VtX3NldF93ZWRnZWQoaTkxNSk7CisJCQlp
bnRlbF9ndF9zZXRfd2VkZ2VkKCZpOTE1LT5ndCk7CiAJCQllcnIgPSAtRUlPOwogCQkJZ290byBl
cnJfY3R4X2xvOwogCQl9CkBAIC01NTEsNyArNTUxLDcgQEAgc3RhdGljIGludCBsaXZlX3ByZWVt
cHQodm9pZCAqYXJnKQogCQlpZiAoIWlndF93YWl0X2Zvcl9zcGlubmVyKCZzcGluX2hpLCBycSkp
IHsKIAkJCUdFTV9UUkFDRSgiaGkgc3Bpbm5lciBmYWlsZWQgdG8gc3RhcnRcbiIpOwogCQkJR0VN
X1RSQUNFX0RVTVAoKTsKLQkJCWk5MTVfZ2VtX3NldF93ZWRnZWQoaTkxNSk7CisJCQlpbnRlbF9n
dF9zZXRfd2VkZ2VkKCZpOTE1LT5ndCk7CiAJCQllcnIgPSAtRUlPOwogCQkJZ290byBlcnJfY3R4
X2xvOwogCQl9CkBAIC02ODgsNyArNjg4LDcgQEAgc3RhdGljIGludCBsaXZlX2xhdGVfcHJlZW1w
dCh2b2lkICphcmcpCiBlcnJfd2VkZ2VkOgogCWlndF9zcGlubmVyX2VuZCgmc3Bpbl9oaSk7CiAJ
aWd0X3NwaW5uZXJfZW5kKCZzcGluX2xvKTsKLQlpOTE1X2dlbV9zZXRfd2VkZ2VkKGk5MTUpOwor
CWludGVsX2d0X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKIAllcnIgPSAtRUlPOwogCWdvdG8gZXJy
X2N0eF9sbzsKIH0KQEAgLTgyNCw3ICs4MjQsNyBAQCBzdGF0aWMgaW50IGxpdmVfbm9wcmVlbXB0
KHZvaWQgKmFyZykKIGVycl93ZWRnZWQ6CiAJaWd0X3NwaW5uZXJfZW5kKCZiLnNwaW4pOwogCWln
dF9zcGlubmVyX2VuZCgmYS5zcGluKTsKLQlpOTE1X2dlbV9zZXRfd2VkZ2VkKGk5MTUpOworCWlu
dGVsX2d0X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKIAllcnIgPSAtRUlPOwogCWdvdG8gZXJyX2Ns
aWVudF9iOwogfQpAQCAtOTM0LDcgKzkzNCw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9zdXBwcmVzc19z
ZWxmX3ByZWVtcHQodm9pZCAqYXJnKQogZXJyX3dlZGdlZDoKIAlpZ3Rfc3Bpbm5lcl9lbmQoJmIu
c3Bpbik7CiAJaWd0X3NwaW5uZXJfZW5kKCZhLnNwaW4pOwotCWk5MTVfZ2VtX3NldF93ZWRnZWQo
aTkxNSk7CisJaW50ZWxfZ3Rfc2V0X3dlZGdlZCgmaTkxNS0+Z3QpOwogCWVyciA9IC1FSU87CiAJ
Z290byBlcnJfY2xpZW50X2I7CiB9CkBAIC0xMTA1LDcgKzExMDUsNyBAQCBzdGF0aWMgaW50IGxp
dmVfc3VwcHJlc3Nfd2FpdF9wcmVlbXB0KHZvaWQgKmFyZykKIGVycl93ZWRnZWQ6CiAJZm9yIChp
ID0gMDsgaSA8IEFSUkFZX1NJWkUoY2xpZW50KTsgaSsrKQogCQlpZ3Rfc3Bpbm5lcl9lbmQoJmNs
aWVudFtpXS5zcGluKTsKLQlpOTE1X2dlbV9zZXRfd2VkZ2VkKGk5MTUpOworCWludGVsX2d0X3Nl
dF93ZWRnZWQoJmk5MTUtPmd0KTsKIAllcnIgPSAtRUlPOwogCWdvdG8gZXJyX2NsaWVudF8zOwog
fQpAQCAtMTI1MSw3ICsxMjUxLDcgQEAgc3RhdGljIGludCBsaXZlX2NoYWluX3ByZWVtcHQodm9p
ZCAqYXJnKQogZXJyX3dlZGdlZDoKIAlpZ3Rfc3Bpbm5lcl9lbmQoJmhpLnNwaW4pOwogCWlndF9z
cGlubmVyX2VuZCgmbG8uc3Bpbik7Ci0JaTkxNV9nZW1fc2V0X3dlZGdlZChpOTE1KTsKKwlpbnRl
bF9ndF9zZXRfd2VkZ2VkKCZpOTE1LT5ndCk7CiAJZXJyID0gLUVJTzsKIAlnb3RvIGVycl9jbGll
bnRfbG87CiB9CkBAIC0xMzEwLDcgKzEzMTAsNyBAQCBzdGF0aWMgaW50IGxpdmVfcHJlZW1wdF9o
YW5nKHZvaWQgKmFyZykKIAkJaWYgKCFpZ3Rfd2FpdF9mb3Jfc3Bpbm5lcigmc3Bpbl9sbywgcnEp
KSB7CiAJCQlHRU1fVFJBQ0UoImxvIHNwaW5uZXIgZmFpbGVkIHRvIHN0YXJ0XG4iKTsKIAkJCUdF
TV9UUkFDRV9EVU1QKCk7Ci0JCQlpOTE1X2dlbV9zZXRfd2VkZ2VkKGk5MTUpOworCQkJaW50ZWxf
Z3Rfc2V0X3dlZGdlZCgmaTkxNS0+Z3QpOwogCQkJZXJyID0gLUVJTzsKIAkJCWdvdG8gZXJyX2N0
eF9sbzsKIAkJfQpAQCAtMTMzMiwyMSArMTMzMiwyMSBAQCBzdGF0aWMgaW50IGxpdmVfcHJlZW1w
dF9oYW5nKHZvaWQgKmFyZykKIAkJCQkJCSBIWiAvIDEwKSkgewogCQkJcHJfZXJyKCJQcmVlbXB0
aW9uIGRpZCBub3Qgb2NjdXIgd2l0aGluIHRpbWVvdXQhIik7CiAJCQlHRU1fVFJBQ0VfRFVNUCgp
OwotCQkJaTkxNV9nZW1fc2V0X3dlZGdlZChpOTE1KTsKKwkJCWludGVsX2d0X3NldF93ZWRnZWQo
Jmk5MTUtPmd0KTsKIAkJCWVyciA9IC1FSU87CiAJCQlnb3RvIGVycl9jdHhfbG87CiAJCX0KIAot
CQlzZXRfYml0KEk5MTVfUkVTRVRfRU5HSU5FICsgaWQsICZpOTE1LT5ncHVfZXJyb3IuZmxhZ3Mp
OwotCQlpOTE1X3Jlc2V0X2VuZ2luZShlbmdpbmUsIE5VTEwpOwotCQljbGVhcl9iaXQoSTkxNV9S
RVNFVF9FTkdJTkUgKyBpZCwgJmk5MTUtPmdwdV9lcnJvci5mbGFncyk7CisJCXNldF9iaXQoSTkx
NV9SRVNFVF9FTkdJTkUgKyBpZCwgJmk5MTUtPmd0LnJlc2V0LmZsYWdzKTsKKwkJaW50ZWxfZW5n
aW5lX3Jlc2V0KGVuZ2luZSwgTlVMTCk7CisJCWNsZWFyX2JpdChJOTE1X1JFU0VUX0VOR0lORSAr
IGlkLCAmaTkxNS0+Z3QucmVzZXQuZmxhZ3MpOwogCiAJCWVuZ2luZS0+ZXhlY2xpc3RzLnByZWVt
cHRfaGFuZy5pbmplY3RfaGFuZyA9IGZhbHNlOwogCiAJCWlmICghaWd0X3dhaXRfZm9yX3NwaW5u
ZXIoJnNwaW5faGksIHJxKSkgewogCQkJR0VNX1RSQUNFKCJoaSBzcGlubmVyIGZhaWxlZCB0byBz
dGFydFxuIik7CiAJCQlHRU1fVFJBQ0VfRFVNUCgpOwotCQkJaTkxNV9nZW1fc2V0X3dlZGdlZChp
OTE1KTsKKwkJCWludGVsX2d0X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKIAkJCWVyciA9IC1FSU87
CiAJCQlnb3RvIGVycl9jdHhfbG87CiAJCX0KQEAgLTE3MjYsNyArMTcyNiw3IEBAIHN0YXRpYyBp
bnQgbm9wX3ZpcnR1YWxfZW5naW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJ
CQkgIHJlcXVlc3RbbmNdLT5mZW5jZS5jb250ZXh0LAogCQkJCQkgIHJlcXVlc3RbbmNdLT5mZW5j
ZS5zZXFubyk7CiAJCQkJR0VNX1RSQUNFX0RVTVAoKTsKLQkJCQlpOTE1X2dlbV9zZXRfd2VkZ2Vk
KGk5MTUpOworCQkJCWludGVsX2d0X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKIAkJCQlicmVhazsK
IAkJCX0KIAkJfQpAQCAtMTg3Myw3ICsxODczLDcgQEAgc3RhdGljIGludCBtYXNrX3ZpcnR1YWxf
ZW5naW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgcmVxdWVzdFtuXS0+
ZmVuY2UuY29udGV4dCwKIAkJCQkgIHJlcXVlc3Rbbl0tPmZlbmNlLnNlcW5vKTsKIAkJCUdFTV9U
UkFDRV9EVU1QKCk7Ci0JCQlpOTE1X2dlbV9zZXRfd2VkZ2VkKGk5MTUpOworCQkJaW50ZWxfZ3Rf
c2V0X3dlZGdlZCgmaTkxNS0+Z3QpOwogCQkJZXJyID0gLUVJTzsKIAkJCWdvdG8gb3V0OwogCQl9
CkBAIC0yMTUwLDcgKzIxNTAsNyBAQCBpbnQgaW50ZWxfZXhlY2xpc3RzX2xpdmVfc2VsZnRlc3Rz
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCWlmICghSEFTX0VYRUNMSVNUUyhpOTE1
KSkKIAkJcmV0dXJuIDA7CiAKLQlpZiAoaTkxNV90ZXJtaW5hbGx5X3dlZGdlZChpOTE1KSkKKwlp
ZiAoaW50ZWxfZ3RfaXNfd2VkZ2VkKCZpOTE1LT5ndCkpCiAJCXJldHVybiAwOwogCiAJcmV0dXJu
IGk5MTVfbGl2ZV9zdWJ0ZXN0cyh0ZXN0cywgaTkxNSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9yZXNldC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfcmVzZXQuYwppbmRleCA2NzJlMzJlMWVmOTUuLjgxM2E5MTc2YzQzNiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfcmVzZXQuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9yZXNldC5jCkBAIC05LDI2ICs5LDI5IEBACiAK
IHN0YXRpYyBpbnQgaWd0X2dsb2JhbF9yZXNldCh2b2lkICphcmcpCiB7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKIAl1
bnNpZ25lZCBpbnQgcmVzZXRfY291bnQ7CisJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJaW50
IGVyciA9IDA7CiAKIAkvKiBDaGVjayB0aGF0IHdlIGNhbiBpc3N1ZSBhIGdsb2JhbCBHUFUgcmVz
ZXQgKi8KIAotCWlndF9nbG9iYWxfcmVzZXRfbG9jayhpOTE1KTsKKwlpZ3RfZ2xvYmFsX3Jlc2V0
X2xvY2soZ3QpOworCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldCgmZ3QtPmk5MTUtPnJ1
bnRpbWVfcG0pOwogCi0JcmVzZXRfY291bnQgPSBpOTE1X3Jlc2V0X2NvdW50KCZpOTE1LT5ncHVf
ZXJyb3IpOworCXJlc2V0X2NvdW50ID0gaTkxNV9yZXNldF9jb3VudCgmZ3QtPmk5MTUtPmdwdV9l
cnJvcik7CiAKLQlpOTE1X3Jlc2V0KGk5MTUsIEFMTF9FTkdJTkVTLCBOVUxMKTsKKwlpbnRlbF9n
dF9yZXNldChndCwgQUxMX0VOR0lORVMsIE5VTEwpOwogCi0JaWYgKGk5MTVfcmVzZXRfY291bnQo
Jmk5MTUtPmdwdV9lcnJvcikgPT0gcmVzZXRfY291bnQpIHsKKwlpZiAoaTkxNV9yZXNldF9jb3Vu
dCgmZ3QtPmk5MTUtPmdwdV9lcnJvcikgPT0gcmVzZXRfY291bnQpIHsKIAkJcHJfZXJyKCJObyBH
UFUgcmVzZXQgcmVjb3JkZWQhXG4iKTsKIAkJZXJyID0gLUVJTlZBTDsKIAl9CiAKLQlpZ3RfZ2xv
YmFsX3Jlc2V0X3VubG9jayhpOTE1KTsKKwlpbnRlbF9ydW50aW1lX3BtX3B1dCgmZ3QtPmk5MTUt
PnJ1bnRpbWVfcG0sIHdha2VyZWYpOworCWlndF9nbG9iYWxfcmVzZXRfdW5sb2NrKGd0KTsKIAot
CWlmIChpOTE1X3Jlc2V0X2ZhaWxlZChpOTE1KSkKKwlpZiAoaW50ZWxfZ3RfaXNfd2VkZ2VkKGd0
KSkKIAkJZXJyID0gLUVJTzsKIAogCXJldHVybiBlcnI7CkBAIC0zNiwzOCArMzksMzggQEAgc3Rh
dGljIGludCBpZ3RfZ2xvYmFsX3Jlc2V0KHZvaWQgKmFyZykKIAogc3RhdGljIGludCBpZ3Rfd2Vk
Z2VkX3Jlc2V0KHZvaWQgKmFyZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IGFyZzsKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwogCWludGVsX3dha2VyZWZfdCB3YWtl
cmVmOwogCiAJLyogQ2hlY2sgdGhhdCB3ZSBjYW4gcmVjb3ZlciBhIHdlZGdlZCBkZXZpY2Ugd2l0
aCBhIEdQVSByZXNldCAqLwogCi0JaWd0X2dsb2JhbF9yZXNldF9sb2NrKGk5MTUpOwotCXdha2Vy
ZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7CisJaWd0X2dsb2Jh
bF9yZXNldF9sb2NrKGd0KTsKKwl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmd0LT5p
OTE1LT5ydW50aW1lX3BtKTsKIAotCWk5MTVfZ2VtX3NldF93ZWRnZWQoaTkxNSk7CisJaW50ZWxf
Z3Rfc2V0X3dlZGdlZChndCk7CiAKLQlHRU1fQlVHX09OKCFpOTE1X3Jlc2V0X2ZhaWxlZChpOTE1
KSk7Ci0JaTkxNV9yZXNldChpOTE1LCBBTExfRU5HSU5FUywgTlVMTCk7CisJR0VNX0JVR19PTigh
aW50ZWxfZ3RfaXNfd2VkZ2VkKGd0KSk7CisJaW50ZWxfZ3RfcmVzZXQoZ3QsIEFMTF9FTkdJTkVT
LCBOVUxMKTsKIAotCWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtl
cmVmKTsKLQlpZ3RfZ2xvYmFsX3Jlc2V0X3VubG9jayhpOTE1KTsKKwlpbnRlbF9ydW50aW1lX3Bt
X3B1dCgmZ3QtPmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOworCWlndF9nbG9iYWxfcmVzZXRf
dW5sb2NrKGd0KTsKIAotCXJldHVybiBpOTE1X3Jlc2V0X2ZhaWxlZChpOTE1KSA/IC1FSU8gOiAw
OworCXJldHVybiBpbnRlbF9ndF9pc193ZWRnZWQoZ3QpID8gLUVJTyA6IDA7CiB9CiAKIHN0YXRp
YyBpbnQgaWd0X2F0b21pY19yZXNldCh2b2lkICphcmcpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSBhcmc7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKIAljb25zdCB0
eXBlb2YoKmlndF9hdG9taWNfcGhhc2VzKSAqcDsKIAlpbnQgZXJyID0gMDsKIAogCS8qIENoZWNr
IHRoYXQgdGhlIHJlc2V0cyBhcmUgdXNhYmxlIGZyb20gYXRvbWljIGNvbnRleHQgKi8KIAotCWlu
dGVsX2d0X3BtX2dldCgmaTkxNS0+Z3QpOwotCWlndF9nbG9iYWxfcmVzZXRfbG9jayhpOTE1KTsK
KwlpbnRlbF9ndF9wbV9nZXQoZ3QpOworCWlndF9nbG9iYWxfcmVzZXRfbG9jayhndCk7CiAKIAkv
KiBGbHVzaCBhbnkgcmVxdWVzdHMgYmVmb3JlIHdlIGdldCBzdGFydGVkIGFuZCBjaGVjayBiYXNp
Y3MgKi8KLQlpZiAoIWlndF9mb3JjZV9yZXNldChpOTE1KSkKKwlpZiAoIWlndF9mb3JjZV9yZXNl
dChndCkpCiAJCWdvdG8gdW5sb2NrOwogCiAJZm9yIChwID0gaWd0X2F0b21pY19waGFzZXM7IHAt
Pm5hbWU7IHArKykgewpAQCAtNzUsMTMgKzc4LDEzIEBAIHN0YXRpYyBpbnQgaWd0X2F0b21pY19y
ZXNldCh2b2lkICphcmcpCiAKIAkJR0VNX1RSQUNFKCJpbnRlbF9ncHVfcmVzZXQgdW5kZXIgJXNc
biIsIHAtPm5hbWUpOwogCi0JCWF3YWtlID0gcmVzZXRfcHJlcGFyZShpOTE1KTsKKwkJYXdha2Ug
PSByZXNldF9wcmVwYXJlKGd0KTsKIAkJcC0+Y3JpdGljYWxfc2VjdGlvbl9iZWdpbigpOwogCi0J
CWVyciA9IGludGVsX2dwdV9yZXNldChpOTE1LCBBTExfRU5HSU5FUyk7CisJCWVyciA9IGludGVs
X2dwdV9yZXNldChndCwgQUxMX0VOR0lORVMpOwogCiAJCXAtPmNyaXRpY2FsX3NlY3Rpb25fZW5k
KCk7Ci0JCXJlc2V0X2ZpbmlzaChpOTE1LCBhd2FrZSk7CisJCXJlc2V0X2ZpbmlzaChndCwgYXdh
a2UpOwogCiAJCWlmIChlcnIpIHsKIAkJCXByX2VycigiaW50ZWxfZ3B1X3Jlc2V0IGZhaWxlZCB1
bmRlciAlc1xuIiwgcC0+bmFtZSk7CkBAIC05MCwxOCArOTMsMTggQEAgc3RhdGljIGludCBpZ3Rf
YXRvbWljX3Jlc2V0KHZvaWQgKmFyZykKIAl9CiAKIAkvKiBBcyB3ZSBwb2tlIGFyb3VuZCB0aGUg
Z3V0cywgZG8gYSBmdWxsIHJlc2V0IGJlZm9yZSBjb250aW51aW5nLiAqLwotCWlndF9mb3JjZV9y
ZXNldChpOTE1KTsKKwlpZ3RfZm9yY2VfcmVzZXQoZ3QpOwogCiB1bmxvY2s6Ci0JaWd0X2dsb2Jh
bF9yZXNldF91bmxvY2soaTkxNSk7Ci0JaW50ZWxfZ3RfcG1fcHV0KCZpOTE1LT5ndCk7CisJaWd0
X2dsb2JhbF9yZXNldF91bmxvY2soZ3QpOworCWludGVsX2d0X3BtX3B1dChndCk7CiAKIAlyZXR1
cm4gZXJyOwogfQogCiBzdGF0aWMgaW50IGlndF9hdG9taWNfZW5naW5lX3Jlc2V0KHZvaWQgKmFy
ZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKKwlzdHJ1Y3QgaW50
ZWxfZ3QgKmd0ID0gYXJnOwogCWNvbnN0IHR5cGVvZigqaWd0X2F0b21pY19waGFzZXMpICpwOwog
CXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBp
ZDsKQEAgLTEwOSwzMyArMTEyLDMzIEBAIHN0YXRpYyBpbnQgaWd0X2F0b21pY19lbmdpbmVfcmVz
ZXQodm9pZCAqYXJnKQogCiAJLyogQ2hlY2sgdGhhdCB0aGUgcmVzZXRzIGFyZSB1c2FibGUgZnJv
bSBhdG9taWMgY29udGV4dCAqLwogCi0JaWYgKCFpbnRlbF9oYXNfcmVzZXRfZW5naW5lKGk5MTUp
KQorCWlmICghaW50ZWxfaGFzX3Jlc2V0X2VuZ2luZShndC0+aTkxNSkpCiAJCXJldHVybiAwOwog
Ci0JaWYgKFVTRVNfR1VDX1NVQk1JU1NJT04oaTkxNSkpCisJaWYgKFVTRVNfR1VDX1NVQk1JU1NJ
T04oZ3QtPmk5MTUpKQogCQlyZXR1cm4gMDsKIAotCWludGVsX2d0X3BtX2dldCgmaTkxNS0+Z3Qp
OwotCWlndF9nbG9iYWxfcmVzZXRfbG9jayhpOTE1KTsKKwlpbnRlbF9ndF9wbV9nZXQoZ3QpOwor
CWlndF9nbG9iYWxfcmVzZXRfbG9jayhndCk7CiAKIAkvKiBGbHVzaCBhbnkgcmVxdWVzdHMgYmVm
b3JlIHdlIGdldCBzdGFydGVkIGFuZCBjaGVjayBiYXNpY3MgKi8KLQlpZiAoIWlndF9mb3JjZV9y
ZXNldChpOTE1KSkKKwlpZiAoIWlndF9mb3JjZV9yZXNldChndCkpCiAJCWdvdG8gb3V0X3VubG9j
azsKIAotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7CisJZm9yX2VhY2hfZW5n
aW5lKGVuZ2luZSwgZ3QtPmk5MTUsIGlkKSB7CiAJCXRhc2tsZXRfZGlzYWJsZV9ub3N5bmMoJmVu
Z2luZS0+ZXhlY2xpc3RzLnRhc2tsZXQpOwogCQlpbnRlbF9lbmdpbmVfcG1fZ2V0KGVuZ2luZSk7
CiAKIAkJZm9yIChwID0gaWd0X2F0b21pY19waGFzZXM7IHAtPm5hbWU7IHArKykgewotCQkJR0VN
X1RSQUNFKCJpOTE1X3Jlc2V0X2VuZ2luZSglcykgdW5kZXIgJXNcbiIsCisJCQlHRU1fVFJBQ0Uo
ImludGVsX2VuZ2luZV9yZXNldCglcykgdW5kZXIgJXNcbiIsCiAJCQkJICBlbmdpbmUtPm5hbWUs
IHAtPm5hbWUpOwogCiAJCQlwLT5jcml0aWNhbF9zZWN0aW9uX2JlZ2luKCk7Ci0JCQllcnIgPSBp
OTE1X3Jlc2V0X2VuZ2luZShlbmdpbmUsIE5VTEwpOworCQkJZXJyID0gaW50ZWxfZW5naW5lX3Jl
c2V0KGVuZ2luZSwgTlVMTCk7CiAJCQlwLT5jcml0aWNhbF9zZWN0aW9uX2VuZCgpOwogCiAJCQlp
ZiAoZXJyKSB7Ci0JCQkJcHJfZXJyKCJpOTE1X3Jlc2V0X2VuZ2luZSglcykgZmFpbGVkIHVuZGVy
ICVzXG4iLAorCQkJCXByX2VycigiaW50ZWxfZW5naW5lX3Jlc2V0KCVzKSBmYWlsZWQgdW5kZXIg
JXNcbiIsCiAJCQkJICAgICAgIGVuZ2luZS0+bmFtZSwgcC0+bmFtZSk7CiAJCQkJYnJlYWs7CiAJ
CQl9CkBAIC0xNDgsMTEgKzE1MSwxMSBAQCBzdGF0aWMgaW50IGlndF9hdG9taWNfZW5naW5lX3Jl
c2V0KHZvaWQgKmFyZykKIAl9CiAKIAkvKiBBcyB3ZSBwb2tlIGFyb3VuZCB0aGUgZ3V0cywgZG8g
YSBmdWxsIHJlc2V0IGJlZm9yZSBjb250aW51aW5nLiAqLwotCWlndF9mb3JjZV9yZXNldChpOTE1
KTsKKwlpZ3RfZm9yY2VfcmVzZXQoZ3QpOwogCiBvdXRfdW5sb2NrOgotCWlndF9nbG9iYWxfcmVz
ZXRfdW5sb2NrKGk5MTUpOwotCWludGVsX2d0X3BtX3B1dCgmaTkxNS0+Z3QpOworCWlndF9nbG9i
YWxfcmVzZXRfdW5sb2NrKGd0KTsKKwlpbnRlbF9ndF9wbV9wdXQoZ3QpOwogCiAJcmV0dXJuIGVy
cjsKIH0KQEAgLTE2NSwxNyArMTY4LDEzIEBAIGludCBpbnRlbF9yZXNldF9saXZlX3NlbGZ0ZXN0
cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkJU1VCVEVTVChpZ3RfYXRvbWljX3Jl
c2V0KSwKIAkJU1VCVEVTVChpZ3RfYXRvbWljX2VuZ2luZV9yZXNldCksCiAJfTsKLQlpbnRlbF93
YWtlcmVmX3Qgd2FrZXJlZjsKLQlpbnQgZXJyID0gMDsKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0g
Jmk5MTUtPmd0OwogCi0JaWYgKCFpbnRlbF9oYXNfZ3B1X3Jlc2V0KGk5MTUpKQorCWlmICghaW50
ZWxfaGFzX2dwdV9yZXNldChndC0+aTkxNSkpCiAJCXJldHVybiAwOwogCi0JaWYgKGk5MTVfdGVy
bWluYWxseV93ZWRnZWQoaTkxNSkpCisJaWYgKGludGVsX2d0X2lzX3dlZGdlZChndCkpCiAJCXJl
dHVybiAtRUlPOyAvKiB3ZSdyZSBsb25nIHBhc3QgaG9wZSBvZiBhIHN1Y2Nlc3NmdWwgcmVzZXQg
Ki8KIAotCXdpdGhfaW50ZWxfcnVudGltZV9wbSgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZikK
LQkJZXJyID0gaTkxNV9zdWJ0ZXN0cyh0ZXN0cywgaTkxNSk7Ci0KLQlyZXR1cm4gZXJyOworCXJl
dHVybiBpbnRlbF9ndF9saXZlX3N1YnRlc3RzKHRlc3RzLCBndCk7CiB9CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF90aW1lbGluZS5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfdGltZWxpbmUuYwppbmRleCA0ZDcyY2VmNTA2YWUuLjMyMTQ4
MTQwMzE2NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfdGlt
ZWxpbmUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF90aW1lbGluZS5j
CkBAIC03LDYgKzcsNyBAQAogI2luY2x1ZGUgPGxpbnV4L3ByaW1lX251bWJlcnMuaD4KIAogI2lu
Y2x1ZGUgImdlbS9pOTE1X2dlbV9wbS5oIgorI2luY2x1ZGUgImludGVsX2d0LmgiCiAKICNpbmNs
dWRlICIuLi9zZWxmdGVzdHMvaTkxNV9yYW5kb20uaCIKICNpbmNsdWRlICIuLi9pOTE1X3NlbGZ0
ZXN0LmgiCkBAIC04MzgsNyArODM5LDcgQEAgaW50IGludGVsX3RpbWVsaW5lX2xpdmVfc2VsZnRl
c3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCQlTVUJURVNUKGxpdmVfaHdzcF93
cmFwKSwKIAl9OwogCi0JaWYgKGk5MTVfdGVybWluYWxseV93ZWRnZWQoaTkxNSkpCisJaWYgKGlu
dGVsX2d0X2lzX3dlZGdlZCgmaTkxNS0+Z3QpKQogCQlyZXR1cm4gMDsKIAogCXJldHVybiBpOTE1
X2xpdmVfc3VidGVzdHModGVzdHMsIGk5MTUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Qvc2VsZnRlc3Rfd29ya2Fyb3VuZHMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMKaW5kZXggZmEwMWVhNzg1NWRlLi4yOTc4ZjQzNWRjY2Eg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRz
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29ya2Fyb3VuZHMuYwpA
QCAtMTIsNyArMTIsNiBAQAogI2luY2x1ZGUgInNlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5oIgog
I2luY2x1ZGUgInNlbGZ0ZXN0cy9pZ3RfcmVzZXQuaCIKICNpbmNsdWRlICJzZWxmdGVzdHMvaWd0
X3NwaW5uZXIuaCIKLSNpbmNsdWRlICJzZWxmdGVzdHMvaWd0X3dlZGdlX21lLmgiCiAjaW5jbHVk
ZSAic2VsZnRlc3RzL21vY2tfZHJtLmgiCiAKICNpbmNsdWRlICJnZW0vc2VsZnRlc3RzL2lndF9n
ZW1fdXRpbHMuaCIKQEAgLTE4NSw3ICsxODQsNyBAQCBzdGF0aWMgaW50IGNoZWNrX3doaXRlbGlz
dChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogCQkJICAgc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lKQogewogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpyZXN1bHRzOwot
CXN0cnVjdCBpZ3Rfd2VkZ2VfbWUgd2VkZ2U7CisJc3RydWN0IGludGVsX3dlZGdlX21lIHdlZGdl
OwogCXUzMiAqdmFkZHI7CiAJaW50IGVycjsKIAlpbnQgaTsKQEAgLTE5NiwxMCArMTk1LDEwIEBA
IHN0YXRpYyBpbnQgY2hlY2tfd2hpdGVsaXN0KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgs
CiAKIAllcnIgPSAwOwogCWk5MTVfZ2VtX29iamVjdF9sb2NrKHJlc3VsdHMpOwotCWlndF93ZWRn
ZV9vbl90aW1lb3V0KCZ3ZWRnZSwgY3R4LT5pOTE1LCBIWiAvIDUpIC8qIGEgc2FmZXR5IG5ldCEg
Ki8KKwlpbnRlbF93ZWRnZV9vbl90aW1lb3V0KCZ3ZWRnZSwgJmN0eC0+aTkxNS0+Z3QsIEhaIC8g
NSkgLyogc2FmZXR5IG5ldCEgKi8KIAkJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3NldF90b19jcHVf
ZG9tYWluKHJlc3VsdHMsIGZhbHNlKTsKIAlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKHJlc3VsdHMp
OwotCWlmIChpOTE1X3Rlcm1pbmFsbHlfd2VkZ2VkKGN0eC0+aTkxNSkpCisJaWYgKGludGVsX2d0
X2lzX3dlZGdlZCgmY3R4LT5pOTE1LT5ndCkpCiAJCWVyciA9IC1FSU87CiAJaWYgKGVycikKIAkJ
Z290byBvdXRfcHV0OwpAQCAtMjMyLDEzICsyMzEsMTMgQEAgc3RhdGljIGludCBjaGVja193aGl0
ZWxpc3Qoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAogc3RhdGljIGludCBkb19kZXZp
Y2VfcmVzZXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewotCWk5MTVfcmVzZXQo
ZW5naW5lLT5pOTE1LCBlbmdpbmUtPm1hc2ssICJsaXZlX3dvcmthcm91bmRzIik7CisJaW50ZWxf
Z3RfcmVzZXQoZW5naW5lLT5ndCwgZW5naW5lLT5tYXNrLCAibGl2ZV93b3JrYXJvdW5kcyIpOwog
CXJldHVybiAwOwogfQogCiBzdGF0aWMgaW50IGRvX2VuZ2luZV9yZXNldChzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmUpCiB7Ci0JcmV0dXJuIGk5MTVfcmVzZXRfZW5naW5lKGVuZ2luZSwg
ImxpdmVfd29ya2Fyb3VuZHMiKTsKKwlyZXR1cm4gaW50ZWxfZW5naW5lX3Jlc2V0KGVuZ2luZSwg
ImxpdmVfd29ya2Fyb3VuZHMiKTsKIH0KIAogc3RhdGljIGludApAQCAtNTc0LDcgKzU3Myw3IEBA
IHN0YXRpYyBpbnQgY2hlY2tfZGlydHlfd2hpdGVsaXN0KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0
ICpjdHgsCiAJCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChycSwgMCwgSFogLyA1KSA8IDApIHsKIAkJ
CXByX2VycigiJXM6IEZ1dHppbmcgJXggdGltZWRvdXQ7IGNhbmNlbGxpbmcgdGVzdFxuIiwKIAkJ
CSAgICAgICBlbmdpbmUtPm5hbWUsIHJlZyk7Ci0JCQlpOTE1X2dlbV9zZXRfd2VkZ2VkKGN0eC0+
aTkxNSk7CisJCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZjdHgtPmk5MTUtPmd0KTsKIAkJCWVyciA9
IC1FSU87CiAJCQlnb3RvIG91dF9iYXRjaDsKIAkJfQpAQCAtNzExLDcgKzcxMCw3IEBAIHN0YXRp
YyBpbnQgbGl2ZV9yZXNldF93aGl0ZWxpc3Qodm9pZCAqYXJnKQogCWlmICghZW5naW5lIHx8IGVu
Z2luZS0+d2hpdGVsaXN0LmNvdW50ID09IDApCiAJCXJldHVybiAwOwogCi0JaWd0X2dsb2JhbF9y
ZXNldF9sb2NrKGk5MTUpOworCWlndF9nbG9iYWxfcmVzZXRfbG9jaygmaTkxNS0+Z3QpOwogCiAJ
aWYgKGludGVsX2hhc19yZXNldF9lbmdpbmUoaTkxNSkpIHsKIAkJZXJyID0gY2hlY2tfd2hpdGVs
aXN0X2Fjcm9zc19yZXNldChlbmdpbmUsCkBAIC03MzAsNyArNzI5LDcgQEAgc3RhdGljIGludCBs
aXZlX3Jlc2V0X3doaXRlbGlzdCh2b2lkICphcmcpCiAJfQogCiBvdXQ6Ci0JaWd0X2dsb2JhbF9y
ZXNldF91bmxvY2soaTkxNSk7CisJaWd0X2dsb2JhbF9yZXNldF91bmxvY2soJmk5MTUtPmd0KTsK
IAlyZXR1cm4gZXJyOwogfQogCkBAIC0xMDk4LDcgKzEwOTcsNyBAQCBsaXZlX2dwdV9yZXNldF93
b3JrYXJvdW5kcyh2b2lkICphcmcpCiAKIAlwcl9pbmZvKCJWZXJpZnlpbmcgYWZ0ZXIgR1BVIHJl
c2V0Li4uXG4iKTsKIAotCWlndF9nbG9iYWxfcmVzZXRfbG9jayhpOTE1KTsKKwlpZ3RfZ2xvYmFs
X3Jlc2V0X2xvY2soJmk5MTUtPmd0KTsKIAl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQo
Jmk5MTUtPnJ1bnRpbWVfcG0pOwogCiAJcmVmZXJlbmNlX2xpc3RzX2luaXQoaTkxNSwgJmxpc3Rz
KTsKQEAgLTExMDcsNyArMTEwNiw3IEBAIGxpdmVfZ3B1X3Jlc2V0X3dvcmthcm91bmRzKHZvaWQg
KmFyZykKIAlpZiAoIW9rKQogCQlnb3RvIG91dDsKIAotCWk5MTVfcmVzZXQoaTkxNSwgQUxMX0VO
R0lORVMsICJsaXZlX3dvcmthcm91bmRzIik7CisJaW50ZWxfZ3RfcmVzZXQoJmk5MTUtPmd0LCBB
TExfRU5HSU5FUywgImxpdmVfd29ya2Fyb3VuZHMiKTsKIAogCW9rID0gdmVyaWZ5X3dhX2xpc3Rz
KGN0eCwgJmxpc3RzLCAiYWZ0ZXIgcmVzZXQiKTsKIApAQCAtMTExNSw3ICsxMTE0LDcgQEAgbGl2
ZV9ncHVfcmVzZXRfd29ya2Fyb3VuZHModm9pZCAqYXJnKQogCWtlcm5lbF9jb250ZXh0X2Nsb3Nl
KGN0eCk7CiAJcmVmZXJlbmNlX2xpc3RzX2ZpbmkoaTkxNSwgJmxpc3RzKTsKIAlpbnRlbF9ydW50
aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JaWd0X2dsb2JhbF9yZXNl
dF91bmxvY2soaTkxNSk7CisJaWd0X2dsb2JhbF9yZXNldF91bmxvY2soJmk5MTUtPmd0KTsKIAog
CXJldHVybiBvayA/IDAgOiAtRVNSQ0g7CiB9CkBAIC0xMTQwLDcgKzExMzksNyBAQCBsaXZlX2Vu
Z2luZV9yZXNldF93b3JrYXJvdW5kcyh2b2lkICphcmcpCiAJaWYgKElTX0VSUihjdHgpKQogCQly
ZXR1cm4gUFRSX0VSUihjdHgpOwogCi0JaWd0X2dsb2JhbF9yZXNldF9sb2NrKGk5MTUpOworCWln
dF9nbG9iYWxfcmVzZXRfbG9jaygmaTkxNS0+Z3QpOwogCXdha2VyZWYgPSBpbnRlbF9ydW50aW1l
X3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7CiAKIAlyZWZlcmVuY2VfbGlzdHNfaW5pdChpOTE1
LCAmbGlzdHMpOwpAQCAtMTE1Niw3ICsxMTU1LDcgQEAgbGl2ZV9lbmdpbmVfcmVzZXRfd29ya2Fy
b3VuZHModm9pZCAqYXJnKQogCQkJZ290byBlcnI7CiAJCX0KIAotCQlpOTE1X3Jlc2V0X2VuZ2lu
ZShlbmdpbmUsICJsaXZlX3dvcmthcm91bmRzIik7CisJCWludGVsX2VuZ2luZV9yZXNldChlbmdp
bmUsICJsaXZlX3dvcmthcm91bmRzIik7CiAKIAkJb2sgPSB2ZXJpZnlfd2FfbGlzdHMoY3R4LCAm
bGlzdHMsICJhZnRlciBpZGxlIHJlc2V0Iik7CiAJCWlmICghb2spIHsKQEAgLTExODQsNyArMTE4
Myw3IEBAIGxpdmVfZW5naW5lX3Jlc2V0X3dvcmthcm91bmRzKHZvaWQgKmFyZykKIAkJCWdvdG8g
ZXJyOwogCQl9CiAKLQkJaTkxNV9yZXNldF9lbmdpbmUoZW5naW5lLCAibGl2ZV93b3JrYXJvdW5k
cyIpOworCQlpbnRlbF9lbmdpbmVfcmVzZXQoZW5naW5lLCAibGl2ZV93b3JrYXJvdW5kcyIpOwog
CiAJCWlndF9zcGlubmVyX2VuZCgmc3Bpbik7CiAJCWlndF9zcGlubmVyX2ZpbmkoJnNwaW4pOwpA
QCAtMTE5OSw3ICsxMTk4LDcgQEAgbGl2ZV9lbmdpbmVfcmVzZXRfd29ya2Fyb3VuZHModm9pZCAq
YXJnKQogZXJyOgogCXJlZmVyZW5jZV9saXN0c19maW5pKGk5MTUsICZsaXN0cyk7CiAJaW50ZWxf
cnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCWlndF9nbG9iYWxf
cmVzZXRfdW5sb2NrKGk5MTUpOworCWlndF9nbG9iYWxfcmVzZXRfdW5sb2NrKCZpOTE1LT5ndCk7
CiAJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKIAogCWlndF9mbHVzaF90ZXN0KGk5MTUsIEk5
MTVfV0FJVF9MT0NLRUQpOwpAQCAtMTIxOCw3ICsxMjE3LDcgQEAgaW50IGludGVsX3dvcmthcm91
bmRzX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCX07CiAJ
aW50IGVycjsKIAotCWlmIChpOTE1X3Rlcm1pbmFsbHlfd2VkZ2VkKGk5MTUpKQorCWlmIChpbnRl
bF9ndF9pc193ZWRnZWQoJmk5MTUtPmd0KSkKIAkJcmV0dXJuIDA7CiAKIAltdXRleF9sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZGVidWdmcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKaW5k
ZXggYmM1YWYyZDI5MDlhLi4zNDA1ZDhjYWIyZTQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZGVidWdmcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVi
dWdmcy5jCkBAIC0xMDAwLDE1ICsxMDAwLDE2IEBAIHN0YXRpYyB2b2lkIGk5MTVfaW5zdGRvbmVf
aW5mbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAKIHN0YXRpYyBpbnQgaTkx
NV9oYW5nY2hlY2tfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKnVudXNlZCkKIHsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0
ZSk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBub2RlX3RvX2k5MTUobS0+cHJp
dmF0ZSk7CisJc3RydWN0IGludGVsX2d0ICpndCA9ICZpOTE1LT5ndDsKIAlzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmU7CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJZW51bSBpbnRl
bF9lbmdpbmVfaWQgaWQ7CiAKLQlzZXFfcHJpbnRmKG0sICJSZXNldCBmbGFnczogJWx4XG4iLCBk
ZXZfcHJpdi0+Z3B1X2Vycm9yLmZsYWdzKTsKLQlpZiAodGVzdF9iaXQoSTkxNV9XRURHRUQsICZk
ZXZfcHJpdi0+Z3B1X2Vycm9yLmZsYWdzKSkKKwlzZXFfcHJpbnRmKG0sICJSZXNldCBmbGFnczog
JWx4XG4iLCBndC0+cmVzZXQuZmxhZ3MpOworCWlmICh0ZXN0X2JpdChJOTE1X1dFREdFRCwgJmd0
LT5yZXNldC5mbGFncykpCiAJCXNlcV9wdXRzKG0sICJcdFdlZGdlZFxuIik7Ci0JaWYgKHRlc3Rf
Yml0KEk5MTVfUkVTRVRfQkFDS09GRiwgJmRldl9wcml2LT5ncHVfZXJyb3IuZmxhZ3MpKQorCWlm
ICh0ZXN0X2JpdChJOTE1X1JFU0VUX0JBQ0tPRkYsICZndC0+cmVzZXQuZmxhZ3MpKQogCQlzZXFf
cHV0cyhtLCAiXHREZXZpY2UgKGdsb2JhbCkgcmVzZXQgaW4gcHJvZ3Jlc3NcbiIpOwogCiAJaWYg
KCFpOTE1X21vZHBhcmFtcy5lbmFibGVfaGFuZ2NoZWNrKSB7CkBAIC0xMDE2LDE5ICsxMDE3LDE5
IEBAIHN0YXRpYyBpbnQgaTkxNV9oYW5nY2hlY2tfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZv
aWQgKnVudXNlZCkKIAkJcmV0dXJuIDA7CiAJfQogCi0JaWYgKHRpbWVyX3BlbmRpbmcoJmRldl9w
cml2LT5ncHVfZXJyb3IuaGFuZ2NoZWNrX3dvcmsudGltZXIpKQorCWlmICh0aW1lcl9wZW5kaW5n
KCZndC0+aGFuZ2NoZWNrLndvcmsudGltZXIpKQogCQlzZXFfcHJpbnRmKG0sICJIYW5nY2hlY2sg
YWN0aXZlLCB0aW1lciBmaXJlcyBpbiAlZG1zXG4iLAotCQkJICAgamlmZmllc190b19tc2Vjcyhk
ZXZfcHJpdi0+Z3B1X2Vycm9yLmhhbmdjaGVja193b3JrLnRpbWVyLmV4cGlyZXMgLQorCQkJICAg
amlmZmllc190b19tc2VjcyhndC0+aGFuZ2NoZWNrLndvcmsudGltZXIuZXhwaXJlcyAtCiAJCQkJ
CSAgICBqaWZmaWVzKSk7Ci0JZWxzZSBpZiAoZGVsYXllZF93b3JrX3BlbmRpbmcoJmRldl9wcml2
LT5ncHVfZXJyb3IuaGFuZ2NoZWNrX3dvcmspKQorCWVsc2UgaWYgKGRlbGF5ZWRfd29ya19wZW5k
aW5nKCZndC0+aGFuZ2NoZWNrLndvcmspKQogCQlzZXFfcHV0cyhtLCAiSGFuZ2NoZWNrIGFjdGl2
ZSwgd29yayBwZW5kaW5nXG4iKTsKIAllbHNlCiAJCXNlcV9wdXRzKG0sICJIYW5nY2hlY2sgaW5h
Y3RpdmVcbiIpOwogCi0Jc2VxX3ByaW50ZihtLCAiR1QgYWN0aXZlPyAlc1xuIiwgeWVzbm8oZGV2
X3ByaXYtPmd0LmF3YWtlKSk7CisJc2VxX3ByaW50ZihtLCAiR1QgYWN0aXZlPyAlc1xuIiwgeWVz
bm8oZ3QtPmF3YWtlKSk7CiAKLQl3aXRoX2ludGVsX3J1bnRpbWVfcG0oJmRldl9wcml2LT5ydW50
aW1lX3BtLCB3YWtlcmVmKSB7Ci0JCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGRldl9wcml2LCBp
ZCkgeworCXdpdGhfaW50ZWxfcnVudGltZV9wbSgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZikg
eworCQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgewogCQkJc3RydWN0IGludGVs
X2luc3Rkb25lIGluc3Rkb25lOwogCiAJCQlzZXFfcHJpbnRmKG0sICIlczogJWQgbXMgYWdvXG4i
LApAQCAtMTA0MywxMCArMTA0NCwxMCBAQCBzdGF0aWMgaW50IGk5MTVfaGFuZ2NoZWNrX2luZm8o
c3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCiAJCQlpbnRlbF9lbmdpbmVfZ2V0X2lu
c3Rkb25lKGVuZ2luZSwgJmluc3Rkb25lKTsKIAogCQkJc2VxX3B1dHMobSwgIlx0aW5zdGRvbmUg
cmVhZCA9XG4iKTsKLQkJCWk5MTVfaW5zdGRvbmVfaW5mbyhkZXZfcHJpdiwgbSwgJmluc3Rkb25l
KTsKKwkJCWk5MTVfaW5zdGRvbmVfaW5mbyhpOTE1LCBtLCAmaW5zdGRvbmUpOwogCiAJCQlzZXFf
cHV0cyhtLCAiXHRpbnN0ZG9uZSBhY2N1ID1cbiIpOwotCQkJaTkxNV9pbnN0ZG9uZV9pbmZvKGRl
dl9wcml2LCBtLAorCQkJaTkxNV9pbnN0ZG9uZV9pbmZvKGk5MTUsIG0sCiAJCQkJCSAgICZlbmdp
bmUtPmhhbmdjaGVjay5pbnN0ZG9uZSk7CiAJCX0KIAl9CkBAIC0xMDU0LDIzICsxMDU1LDYgQEAg
c3RhdGljIGludCBpOTE1X2hhbmdjaGVja19pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAq
dW51c2VkKQogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IGk5MTVfcmVzZXRfaW5mbyhzdHJ1
Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKnVudXNlZCkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7Ci0Jc3RydWN0IGk5MTVfZ3B1
X2Vycm9yICplcnJvciA9ICZkZXZfcHJpdi0+Z3B1X2Vycm9yOwotCXN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZTsKLQllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKLQotCXNlcV9wcmludGYo
bSwgImZ1bGwgZ3B1IHJlc2V0ID0gJXVcbiIsIGk5MTVfcmVzZXRfY291bnQoZXJyb3IpKTsKLQot
CWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGRldl9wcml2LCBpZCkgewotCQlzZXFfcHJpbnRmKG0s
ICIlcyA9ICV1XG4iLCBlbmdpbmUtPm5hbWUsCi0JCQkgICBpOTE1X3Jlc2V0X2VuZ2luZV9jb3Vu
dChlcnJvciwgZW5naW5lKSk7Ci0JfQotCi0JcmV0dXJuIDA7Ci19Ci0KIHN0YXRpYyBpbnQgaXJv
bmxha2VfZHJwY19pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKQEAgLTM1NDcsNyArMzUz
MSw4IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zIGk5MTVfY3VyX3dtX2xh
dGVuY3lfZm9wcyA9IHsKIHN0YXRpYyBpbnQKIGk5MTVfd2VkZ2VkX2dldCh2b2lkICpkYXRhLCB1
NjQgKnZhbCkKIHsKLQlpbnQgcmV0ID0gaTkxNV90ZXJtaW5hbGx5X3dlZGdlZChkYXRhKTsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGRhdGE7CisJaW50IHJldCA9IGludGVsX2d0
X3Rlcm1pbmFsbHlfd2VkZ2VkKCZpOTE1LT5ndCk7CiAKIAlzd2l0Y2ggKHJldCkgewogCWNhc2Ug
LUVJTzoKQEAgLTM1NjcsMTEgKzM1NTIsMTEgQEAgaTkxNV93ZWRnZWRfc2V0KHZvaWQgKmRhdGEs
IHU2NCB2YWwpCiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBkYXRhOwogCiAJLyog
Rmx1c2ggYW55IHByZXZpb3VzIHJlc2V0IGJlZm9yZSBhcHBseWluZyBmb3IgYSBuZXcgb25lICov
Ci0Jd2FpdF9ldmVudChpOTE1LT5ncHVfZXJyb3IucmVzZXRfcXVldWUsCi0JCSAgICF0ZXN0X2Jp
dChJOTE1X1JFU0VUX0JBQ0tPRkYsICZpOTE1LT5ncHVfZXJyb3IuZmxhZ3MpKTsKKwl3YWl0X2V2
ZW50KGk5MTUtPmd0LnJlc2V0LnF1ZXVlLAorCQkgICAhdGVzdF9iaXQoSTkxNV9SRVNFVF9CQUNL
T0ZGLCAmaTkxNS0+Z3QucmVzZXQuZmxhZ3MpKTsKIAotCWk5MTVfaGFuZGxlX2Vycm9yKGk5MTUs
IHZhbCwgSTkxNV9FUlJPUl9DQVBUVVJFLAotCQkJICAiTWFudWFsbHkgc2V0IHdlZGdlZCBlbmdp
bmUgbWFzayA9ICVsbHgiLCB2YWwpOworCWludGVsX2d0X2hhbmRsZV9lcnJvcigmaTkxNS0+Z3Qs
IHZhbCwgSTkxNV9FUlJPUl9DQVBUVVJFLAorCQkJICAgICAgIk1hbnVhbGx5IHNldCB3ZWRnZWQg
ZW5naW5lIG1hc2sgPSAlbGx4IiwgdmFsKTsKIAlyZXR1cm4gMDsKIH0KIApAQCAtMzYxNCw4ICsz
NTk5LDkgQEAgaTkxNV9kcm9wX2NhY2hlc19zZXQodm9pZCAqZGF0YSwgdTY0IHZhbCkKIAkJICB2
YWwsIHZhbCAmIERST1BfQUxMKTsKIAogCWlmICh2YWwgJiBEUk9QX1JFU0VUX0FDVElWRSAmJgot
CSAgICB3YWl0X2ZvcihpbnRlbF9lbmdpbmVzX2FyZV9pZGxlKGk5MTUpLCBJOTE1X0lETEVfRU5H
SU5FU19USU1FT1VUKSkKLQkJaTkxNV9nZW1fc2V0X3dlZGdlZChpOTE1KTsKKwkgICAgd2FpdF9m
b3IoaW50ZWxfZW5naW5lc19hcmVfaWRsZSgmaTkxNS0+Z3QpLAorCQkgICAgIEk5MTVfSURMRV9F
TkdJTkVTX1RJTUVPVVQpKQorCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZpOTE1LT5ndCk7CiAKIAkv
KiBObyBuZWVkIHRvIGNoZWNrIGFuZCB3YWl0IGZvciBncHUgcmVzZXRzLCBvbmx5IGxpYmRybSBh
dXRvLXJlc3RhcnRzCiAJICogb24gaW9jdGxzIG9uIC1FQUdBSU4uICovCkBAIC0zNjUwLDggKzM2
MzYsOCBAQCBpOTE1X2Ryb3BfY2FjaGVzX3NldCh2b2lkICpkYXRhLCB1NjQgdmFsKQogCQltdXRl
eF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCX0KIAotCWlmICh2YWwgJiBEUk9Q
X1JFU0VUX0FDVElWRSAmJiBpOTE1X3Rlcm1pbmFsbHlfd2VkZ2VkKGk5MTUpKQotCQlpOTE1X2hh
bmRsZV9lcnJvcihpOTE1LCBBTExfRU5HSU5FUywgMCwgTlVMTCk7CisJaWYgKHZhbCAmIERST1Bf
UkVTRVRfQUNUSVZFICYmIGludGVsX2d0X3Rlcm1pbmFsbHlfd2VkZ2VkKCZpOTE1LT5ndCkpCisJ
CWludGVsX2d0X2hhbmRsZV9lcnJvcigmaTkxNS0+Z3QsIEFMTF9FTkdJTkVTLCAwLCBOVUxMKTsK
IAogCWZzX3JlY2xhaW1fYWNxdWlyZShHRlBfS0VSTkVMKTsKIAlpZiAodmFsICYgRFJPUF9CT1VO
RCkKQEAgLTQzMDUsNyArNDI5MSw2IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2luZm9fbGlz
dCBpOTE1X2RlYnVnZnNfbGlzdFtdID0gewogCXsiaTkxNV9odWNfbG9hZF9zdGF0dXMiLCBpOTE1
X2h1Y19sb2FkX3N0YXR1c19pbmZvLCAwfSwKIAl7Imk5MTVfZnJlcXVlbmN5X2luZm8iLCBpOTE1
X2ZyZXF1ZW5jeV9pbmZvLCAwfSwKIAl7Imk5MTVfaGFuZ2NoZWNrX2luZm8iLCBpOTE1X2hhbmdj
aGVja19pbmZvLCAwfSwKLQl7Imk5MTVfcmVzZXRfaW5mbyIsIGk5MTVfcmVzZXRfaW5mbywgMH0s
CiAJeyJpOTE1X2RycGNfaW5mbyIsIGk5MTVfZHJwY19pbmZvLCAwfSwKIAl7Imk5MTVfZW1vbl9z
dGF0dXMiLCBpOTE1X2Vtb25fc3RhdHVzLCAwfSwKIAl7Imk5MTVfcmluZ19mcmVxX3RhYmxlIiwg
aTkxNV9yaW5nX2ZyZXFfdGFibGUsIDB9LApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9kcnYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMKaW5kZXggNzk0
YzY4MTRhNmQwLi40Yjk4NjA5ODZhOTMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYwpAQCAtOTQx
LDcgKzk0MSw2IEBAIHN0YXRpYyBpbnQgaTkxNV9kcml2ZXJfaW5pdF9lYXJseShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJaWYgKHJldCA8IDApCiAJCWdvdG8gZXJyX3VjOwog
CWludGVsX2lycV9pbml0KGRldl9wcml2KTsKLQlpbnRlbF9oYW5nY2hlY2tfaW5pdChkZXZfcHJp
dik7CiAJaW50ZWxfaW5pdF9kaXNwbGF5X2hvb2tzKGRldl9wcml2KTsKIAlpbnRlbF9pbml0X2Ns
b2NrX2dhdGluZ19ob29rcyhkZXZfcHJpdik7CiAJaW50ZWxfaW5pdF9hdWRpb19ob29rcyhkZXZf
cHJpdik7CkBAIC0xOTYwLDcgKzE5NTksNyBAQCB2b2lkIGk5MTVfZHJpdmVyX3VubG9hZChzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2KQogCSAqIGFsbCBpbi1mbGlnaHQgcmVxdWVzdHMgc28gdGhhdCB3
ZSBjYW4gcXVpY2tseSB1bmJpbmQgdGhlIGFjdGl2ZQogCSAqIHJlc291cmNlcy4KIAkgKi8KLQlp
OTE1X2dlbV9zZXRfd2VkZ2VkKGRldl9wcml2KTsKKwlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZkZXZf
cHJpdi0+Z3QpOwogCiAJLyogRmx1c2ggYW55IGV4dGVybmFsIGNvZGUgdGhhdCBzdGlsbCBtYXkg
YmUgdW5kZXIgdGhlIFJDVSBsb2NrICovCiAJc3luY2hyb25pemVfcmN1KCk7CkBAIC0xOTgxLDcg
KzE5ODAsNyBAQCB2b2lkIGk5MTVfZHJpdmVyX3VubG9hZChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
KQogCWludGVsX2Nzcl91Y29kZV9maW5pKGRldl9wcml2KTsKIAogCS8qIEZyZWUgZXJyb3Igc3Rh
dGUgYWZ0ZXIgaW50ZXJydXB0cyBhcmUgZnVsbHkgZGlzYWJsZWQuICovCi0JY2FuY2VsX2RlbGF5
ZWRfd29ya19zeW5jKCZkZXZfcHJpdi0+Z3B1X2Vycm9yLmhhbmdjaGVja193b3JrKTsKKwljYW5j
ZWxfZGVsYXllZF93b3JrX3N5bmMoJmRldl9wcml2LT5ndC5oYW5nY2hlY2sud29yayk7CiAJaTkx
NV9yZXNldF9lcnJvcl9zdGF0ZShkZXZfcHJpdik7CiAKIAlpOTE1X2dlbV9maW5pX2h3KGRldl9w
cml2KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCmluZGV4IDY0ZDhkZTRkNzcxNi4uMTM1MjI5M2Ez
NjhmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKQEAgLTI0MDAsMjggKzI0MDAsMTAgQEAgZXh0
ZXJuIGludCBpOTE1X2RyaXZlcl9sb2FkKHN0cnVjdCBwY2lfZGV2ICpwZGV2LAogZXh0ZXJuIHZv
aWQgaTkxNV9kcml2ZXJfdW5sb2FkKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpOwogCiBleHRlcm4g
dm9pZCBpbnRlbF9lbmdpbmVfaW5pdF9oYW5nY2hlY2soc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lKTsKLWV4dGVybiB2b2lkIGludGVsX2hhbmdjaGVja19pbml0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdik7CiBpbnQgdmx2X2ZvcmNlX2dmeF9jbG9jayhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGJvb2wgb24pOwogCiB1MzIgaW50ZWxfY2FsY3VsYXRl
X21jcl9zX3NzX3NlbGVjdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogCi1z
dGF0aWMgaW5saW5lIHZvaWQgaTkxNV9xdWV1ZV9oYW5nY2hlY2soc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQotewotCXVuc2lnbmVkIGxvbmcgZGVsYXk7Ci0KLQlpZiAodW5saWtl
bHkoIWk5MTVfbW9kcGFyYW1zLmVuYWJsZV9oYW5nY2hlY2spKQotCQlyZXR1cm47Ci0KLQkvKiBE
b24ndCBjb250aW51YWxseSBkZWZlciB0aGUgaGFuZ2NoZWNrIHNvIHRoYXQgaXQgaXMgYWx3YXlz
IHJ1biBhdAotCSAqIGxlYXN0IG9uY2UgYWZ0ZXIgd29yayBoYXMgYmVlbiBzY2hlZHVsZWQgb24g
YW55IHJpbmcuIE90aGVyd2lzZSwKLQkgKiB3ZSB3aWxsIGlnbm9yZSBhIGh1bmcgcmluZyBpZiBh
IHNlY29uZCByaW5nIGlzIGtlcHQgYnVzeS4KLQkgKi8KLQotCWRlbGF5ID0gcm91bmRfamlmZmll
c191cF9yZWxhdGl2ZShEUk1fSTkxNV9IQU5HQ0hFQ0tfSklGRklFUyk7Ci0JcXVldWVfZGVsYXll
ZF93b3JrKHN5c3RlbV9sb25nX3dxLAotCQkJICAgJmRldl9wcml2LT5ncHVfZXJyb3IuaGFuZ2No
ZWNrX3dvcmssIGRlbGF5KTsKLX0KLQogc3RhdGljIGlubGluZSBib29sIGludGVsX2d2dF9hY3Rp
dmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogewogCXJldHVybiBkZXZfcHJp
di0+Z3Z0OwpAQCAtMjUwNiwzMCArMjQ4OCwxNyBAQCBpbnQgaTkxNV9nZW1fbW1hcF9ndHRfdmVy
c2lvbih2b2lkKTsKIAogaW50IF9fbXVzdF9jaGVjayBpOTE1X2dlbV9zZXRfZ2xvYmFsX3NlcW5v
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHUzMiBzZXFubyk7CiAKLXN0YXRpYyBpbmxpbmUgYm9v
bCBfX2k5MTVfd2VkZ2VkKHN0cnVjdCBpOTE1X2dwdV9lcnJvciAqZXJyb3IpCi17Ci0JcmV0dXJu
IHVubGlrZWx5KHRlc3RfYml0KEk5MTVfV0VER0VELCAmZXJyb3ItPmZsYWdzKSk7Ci19Ci0KLXN0
YXRpYyBpbmxpbmUgYm9vbCBpOTE1X3Jlc2V0X2ZhaWxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKLXsKLQlyZXR1cm4gX19pOTE1X3dlZGdlZCgmaTkxNS0+Z3B1X2Vycm9yKTsKLX0K
LQogc3RhdGljIGlubGluZSB1MzIgaTkxNV9yZXNldF9jb3VudChzdHJ1Y3QgaTkxNV9ncHVfZXJy
b3IgKmVycm9yKQogewotCXJldHVybiBSRUFEX09OQ0UoZXJyb3ItPnJlc2V0X2NvdW50KTsKKwly
ZXR1cm4gYXRvbWljX3JlYWQoJmVycm9yLT5yZXNldF9jb3VudCk7CiB9CiAKIHN0YXRpYyBpbmxp
bmUgdTMyIGk5MTVfcmVzZXRfZW5naW5lX2NvdW50KHN0cnVjdCBpOTE1X2dwdV9lcnJvciAqZXJy
b3IsCiAJCQkJCSAgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewotCXJldHVybiBS
RUFEX09OQ0UoZXJyb3ItPnJlc2V0X2VuZ2luZV9jb3VudFtlbmdpbmUtPmlkXSk7CisJcmV0dXJu
IGF0b21pY19yZWFkKCZlcnJvci0+cmVzZXRfZW5naW5lX2NvdW50W2VuZ2luZS0+dWFiaV9jbGFz
c10pOwogfQogCi12b2lkIGk5MTVfZ2VtX3NldF93ZWRnZWQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KTsKLWJvb2wgaTkxNV9nZW1fdW5zZXRfd2VkZ2VkKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdik7Ci0KIHZvaWQgaTkxNV9nZW1faW5pdF9tbWlvKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KTsKIGludCBfX211c3RfY2hlY2sgaTkxNV9nZW1faW5pdChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogaW50IF9fbXVzdF9jaGVjayBpOTE1
X2dlbV9pbml0X2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW0uYwppbmRleCBjNDJmMjE0NjY3NWMuLjljMzU5ZDQzN2JmNSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbS5jCkBAIC04OTYsMTMgKzg5NiwxMyBAQCB2b2lkIGk5MTVfZ2VtX3J1bnRp
bWVfc3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAl9CiB9CiAKLXN0YXRp
YyBpbnQgd2FpdF9mb3JfZW5naW5lcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3N0
YXRpYyBpbnQgd2FpdF9mb3JfZW5naW5lcyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogewotCWlmICh3
YWl0X2ZvcihpbnRlbF9lbmdpbmVzX2FyZV9pZGxlKGk5MTUpLCBJOTE1X0lETEVfRU5HSU5FU19U
SU1FT1VUKSkgewotCQlkZXZfZXJyKGk5MTUtPmRybS5kZXYsCisJaWYgKHdhaXRfZm9yKGludGVs
X2VuZ2luZXNfYXJlX2lkbGUoZ3QpLCBJOTE1X0lETEVfRU5HSU5FU19USU1FT1VUKSkgeworCQlk
ZXZfZXJyKGd0LT5pOTE1LT5kcm0uZGV2LAogCQkJIkZhaWxlZCB0byBpZGxlIGVuZ2luZXMsIGRl
Y2xhcmluZyB3ZWRnZWQhXG4iKTsKIAkJR0VNX1RSQUNFX0RVTVAoKTsKLQkJaTkxNV9nZW1fc2V0
X3dlZGdlZChpOTE1KTsKKwkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CiAJCXJldHVybiAtRUlP
OwogCX0KIApAQCAtOTczLDcgKzk3Myw3IEBAIGludCBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCiAJCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCi0JCWVyciA9IHdhaXRfZm9yX2VuZ2luZXMoaTkxNSk7
CisJCWVyciA9IHdhaXRfZm9yX2VuZ2luZXMoJmk5MTUtPmd0KTsKIAkJaWYgKGVycikKIAkJCXJl
dHVybiBlcnI7CiAKQEAgLTExNTEsOCArMTE1MSw4IEBAIHZvaWQgaTkxNV9nZW1fc2FuaXRpemUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJICogYmFjayB0byBkZWZhdWx0cywgcmVj
b3ZlcmluZyBmcm9tIHdoYXRldmVyIHdlZGdlZCBzdGF0ZSB3ZSBsZWZ0IGl0CiAJICogaW4gYW5k
IHNvIHdvcnRoIHRyeWluZyB0byB1c2UgdGhlIGRldmljZSBvbmNlIG1vcmUuCiAJICovCi0JaWYg
KGk5MTVfdGVybWluYWxseV93ZWRnZWQoaTkxNSkpCi0JCWk5MTVfZ2VtX3Vuc2V0X3dlZGdlZChp
OTE1KTsKKwlpZiAoaW50ZWxfZ3RfaXNfd2VkZ2VkKCZpOTE1LT5ndCkpCisJCWludGVsX2d0X3Vu
c2V0X3dlZGdlZCgmaTkxNS0+Z3QpOwogCiAJLyoKIAkgKiBJZiB3ZSBpbmhlcml0IGNvbnRleHQg
c3RhdGUgZnJvbSB0aGUgQklPUyBvciBlYXJsaWVyIG9jY3VwYW50cwpAQCAtMTIwNCw3ICsxMjA0
LDcgQEAgaW50IGk5MTVfZ2VtX2luaXRfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
CiAJaW50IHJldDsKIAogCUJVR19PTighaTkxNS0+a2VybmVsX2NvbnRleHQpOwotCXJldCA9IGk5
MTVfdGVybWluYWxseV93ZWRnZWQoaTkxNSk7CisJcmV0ID0gaW50ZWxfZ3RfdGVybWluYWxseV93
ZWRnZWQoZ3QpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKQEAgLTEzODYsNyArMTM4Niw3
IEBAIHN0YXRpYyBpbnQgX19pbnRlbF9lbmdpbmVzX3JlY29yZF9kZWZhdWx0cyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkgKiBhbmQgcmVhZHkgdG8gYmUgdG9ybi1kb3duLiBUaGUg
cXVpY2tlc3Qgd2F5IHdlIGNhbiBhY2NvbXBsaXNoCiAJICogdGhpcyBpcyBieSBkZWNsYXJpbmcg
b3Vyc2VsdmVzIHdlZGdlZC4KIAkgKi8KLQlpOTE1X2dlbV9zZXRfd2VkZ2VkKGk5MTUpOworCWlu
dGVsX2d0X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKIAlnb3RvIG91dF9jdHg7CiB9CiAKQEAgLTE1
NDEsNyArMTU0MSw3IEBAIGludCBpOTE1X2dlbV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKIGVycl9ndDoKIAltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0
X211dGV4KTsKIAotCWk5MTVfZ2VtX3NldF93ZWRnZWQoZGV2X3ByaXYpOworCWludGVsX2d0X3Nl
dF93ZWRnZWQoJmRldl9wcml2LT5ndCk7CiAJaTkxNV9nZW1fc3VzcGVuZChkZXZfcHJpdik7CiAJ
aTkxNV9nZW1fc3VzcGVuZF9sYXRlKGRldl9wcml2KTsKIApAQCAtMTU4MywxMCArMTU4MywxMCBA
QCBpbnQgaTkxNV9nZW1faW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJ
CSAqIHdlZGdlZC4gQnV0IHdlIG9ubHkgd2FudCB0byBkbyB0aGlzIHdoZXJlIHRoZSBHUFUgaXMg
YW5ncnksCiAJCSAqIGZvciBhbGwgb3RoZXIgZmFpbHVyZSwgc3VjaCBhcyBhbiBhbGxvY2F0aW9u
IGZhaWx1cmUsIGJhaWwuCiAJCSAqLwotCQlpZiAoIWk5MTVfcmVzZXRfZmFpbGVkKGRldl9wcml2
KSkgeworCQlpZiAoIWludGVsX2d0X2lzX3dlZGdlZCgmZGV2X3ByaXYtPmd0KSkgewogCQkJaTkx
NV9sb2FkX2Vycm9yKGRldl9wcml2LAogCQkJCQkiRmFpbGVkIHRvIGluaXRpYWxpemUgR1BVLCBk
ZWNsYXJpbmcgaXQgd2VkZ2VkIVxuIik7Ci0JCQlpOTE1X2dlbV9zZXRfd2VkZ2VkKGRldl9wcml2
KTsKKwkJCWludGVsX2d0X3NldF93ZWRnZWQoJmRldl9wcml2LT5ndCk7CiAJCX0KIAogCQkvKiBN
aW5pbWFsIGJhc2ljIHJlY292ZXJ5IGZvciBLTVMgKi8KQEAgLTE2NjgsMTEgKzE2NjgsNiBAQCBp
bnQgaTkxNV9nZW1faW5pdF9lYXJseShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiAJaTkxNV9nZW1faW5pdF9fbW0oZGV2X3ByaXYpOwogCWk5MTVfZ2VtX2luaXRfX3BtKGRldl9w
cml2KTsKIAotCWluaXRfd2FpdHF1ZXVlX2hlYWQoJmRldl9wcml2LT5ncHVfZXJyb3Iud2FpdF9x
dWV1ZSk7Ci0JaW5pdF93YWl0cXVldWVfaGVhZCgmZGV2X3ByaXYtPmdwdV9lcnJvci5yZXNldF9x
dWV1ZSk7Ci0JbXV0ZXhfaW5pdCgmZGV2X3ByaXYtPmdwdV9lcnJvci53ZWRnZV9tdXRleCk7Ci0J
aW5pdF9zcmN1X3N0cnVjdCgmZGV2X3ByaXYtPmdwdV9lcnJvci5yZXNldF9iYWNrb2ZmX3NyY3Up
OwotCiAJYXRvbWljX3NldCgmZGV2X3ByaXYtPm1tLmJzZF9lbmdpbmVfZGlzcGF0Y2hfaW5kZXgs
IDApOwogCiAJc3Bpbl9sb2NrX2luaXQoJmRldl9wcml2LT5mYl90cmFja2luZy5sb2NrKTsKQEAg
LTE2OTEsNyArMTY4Niw3IEBAIHZvaWQgaTkxNV9nZW1fY2xlYW51cF9lYXJseShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJR0VNX0JVR19PTihhdG9taWNfcmVhZCgmZGV2X3By
aXYtPm1tLmZyZWVfY291bnQpKTsKIAlXQVJOX09OKGRldl9wcml2LT5tbS5zaHJpbmtfY291bnQp
OwogCi0JY2xlYW51cF9zcmN1X3N0cnVjdCgmZGV2X3ByaXYtPmdwdV9lcnJvci5yZXNldF9iYWNr
b2ZmX3NyY3UpOworCWludGVsX2d0X2NsZWFudXBfZWFybHkoJmRldl9wcml2LT5ndCk7CiAKIAlp
OTE1X2dlbWZzX2ZpbmkoZGV2X3ByaXYpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9ncHVfZXJyb3IuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vy
cm9yLmgKaW5kZXggZWQ3MTljOGE1YmQ2Li41Y2M5ZGZlYTFlOWUgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9ncHVfZXJyb3IuaApAQCAtNyw2ICs3LDcgQEAKICNpZm5kZWYgX0k5MTVfR1BVX0VS
Uk9SX0hfCiAjZGVmaW5lIF9JOTE1X0dQVV9FUlJPUl9IXwogCisjaW5jbHVkZSA8bGludXgvYXRv
bWljLmg+CiAjaW5jbHVkZSA8bGludXgva3JlZi5oPgogI2luY2x1ZGUgPGxpbnV4L2t0aW1lLmg+
CiAjaW5jbHVkZSA8bGludXgvc2NoZWQuaD4KQEAgLTE2MywxMiArMTY0LDYgQEAgc3RydWN0IGk5
MTVfZ3B1X3N0YXRlIHsKIH07CiAKIHN0cnVjdCBpOTE1X2dwdV9lcnJvciB7Ci0JLyogRm9yIGhh
bmdjaGVjayB0aW1lciAqLwotI2RlZmluZSBEUk1fSTkxNV9IQU5HQ0hFQ0tfUEVSSU9EIDE1MDAg
LyogaW4gbXMgKi8KLSNkZWZpbmUgRFJNX0k5MTVfSEFOR0NIRUNLX0pJRkZJRVMgbXNlY3NfdG9f
amlmZmllcyhEUk1fSTkxNV9IQU5HQ0hFQ0tfUEVSSU9EKQotCi0Jc3RydWN0IGRlbGF5ZWRfd29y
ayBoYW5nY2hlY2tfd29yazsKLQogCS8qIEZvciByZXNldCBhbmQgZXJyb3Jfc3RhdGUgaGFuZGxp
bmcuICovCiAJc3BpbmxvY2tfdCBsb2NrOwogCS8qIFByb3RlY3RlZCBieSB0aGUgYWJvdmUgZGV2
LT5ncHVfZXJyb3IubG9jay4gKi8KQEAgLTE3Niw1MiArMTcxLDExIEBAIHN0cnVjdCBpOTE1X2dw
dV9lcnJvciB7CiAKIAlhdG9taWNfdCBwZW5kaW5nX2ZiX3BpbjsKIAotCS8qKgotCSAqIGZsYWdz
OiBDb250cm9sIHZhcmlvdXMgc3RhZ2VzIG9mIHRoZSBHUFUgcmVzZXQKLQkgKgotCSAqICNJOTE1
X1JFU0VUX0JBQ0tPRkYgLSBXaGVuIHdlIHN0YXJ0IGEgZ2xvYmFsIHJlc2V0LCB3ZSBuZWVkIHRv
Ci0JICogc2VyaWFsaXNlIHdpdGggYW55IG90aGVyIHVzZXJzIGF0dGVtcHRpbmcgdG8gZG8gdGhl
IHNhbWUsIGFuZAotCSAqIGFueSBnbG9iYWwgcmVzb3VyY2VzIHRoYXQgbWF5IGJlIGNsb2JiZXIg
YnkgdGhlIHJlc2V0IChzdWNoIGFzCi0JICogRkVOQ0UgcmVnaXN0ZXJzKS4KLQkgKgotCSAqICNJ
OTE1X1JFU0VUX0VOR0lORVtudW1fZW5naW5lc10gLSBTaW5jZSB0aGUgZHJpdmVyIGRvZXNuJ3Qg
bmVlZCB0bwotCSAqIGFjcXVpcmUgdGhlIHN0cnVjdF9tdXRleCB0byByZXNldCBhbiBlbmdpbmUs
IHdlIG5lZWQgYW4gZXhwbGljaXQKLQkgKiBmbGFnIHRvIHByZXZlbnQgdHdvIGNvbmN1cnJlbnQg
cmVzZXQgYXR0ZW1wdHMgaW4gdGhlIHNhbWUgZW5naW5lLgotCSAqIEFzIHRoZSBudW1iZXIgb2Yg
ZW5naW5lcyBjb250aW51ZXMgdG8gZ3JvdywgYWxsb2NhdGUgdGhlIGZsYWdzIGZyb20KLQkgKiB0
aGUgbW9zdCBzaWduaWZpY2FudCBiaXRzLgotCSAqCi0JICogI0k5MTVfV0VER0VEIC0gSWYgcmVz
ZXQgZmFpbHMgYW5kIHdlIGNhbiBubyBsb25nZXIgdXNlIHRoZSBHUFUsCi0JICogd2Ugc2V0IHRo
ZSAjSTkxNV9XRURHRUQgYml0LiBQcmlvciB0byBjb21tYW5kIHN1Ym1pc3Npb24sIGUuZy4KLQkg
KiBpOTE1X3JlcXVlc3RfYWxsb2MoKSwgdGhpcyBiaXQgaXMgY2hlY2tlZCBhbmQgdGhlIHNlcXVl
bmNlCi0JICogYWJvcnRlZCAod2l0aCAtRUlPIHJlcG9ydGVkIHRvIHVzZXJzcGFjZSkgaWYgc2V0
LgotCSAqLwotCXVuc2lnbmVkIGxvbmcgZmxhZ3M7Ci0jZGVmaW5lIEk5MTVfUkVTRVRfQkFDS09G
RgkwCi0jZGVmaW5lIEk5MTVfUkVTRVRfTU9ERVNFVAkxCi0jZGVmaW5lIEk5MTVfUkVTRVRfRU5H
SU5FCTIKLSNkZWZpbmUgSTkxNV9XRURHRUQJCShCSVRTX1BFUl9MT05HIC0gMSkKLQogCS8qKiBO
dW1iZXIgb2YgdGltZXMgdGhlIGRldmljZSBoYXMgYmVlbiByZXNldCAoZ2xvYmFsKSAqLwotCXUz
MiByZXNldF9jb3VudDsKKwlhdG9taWNfdCByZXNldF9jb3VudDsKIAogCS8qKiBOdW1iZXIgb2Yg
dGltZXMgYW4gZW5naW5lIGhhcyBiZWVuIHJlc2V0ICovCi0JdTMyIHJlc2V0X2VuZ2luZV9jb3Vu
dFtJOTE1X05VTV9FTkdJTkVTXTsKLQotCXN0cnVjdCBtdXRleCB3ZWRnZV9tdXRleDsgLyogc2Vy
aWFsaXNlcyB3ZWRnaW5nL3Vud2VkZ2luZyAqLwotCi0JLyoqCi0JICogV2FpdHF1ZXVlIHRvIHNp
Z25hbCB3aGVuIGEgaGFuZyBpcyBkZXRlY3RlZC4gVXNlZCB0byBmb3Igd2FpdGVycwotCSAqIHRv
IHJlbGVhc2UgdGhlIHN0cnVjdF9tdXRleCBmb3IgdGhlIHJlc2V0IHRvIHByb2NlZGUuCi0JICov
Ci0Jd2FpdF9xdWV1ZV9oZWFkX3Qgd2FpdF9xdWV1ZTsKLQotCS8qKgotCSAqIFdhaXRxdWV1ZSB0
byBzaWduYWwgd2hlbiB0aGUgcmVzZXQgaGFzIGNvbXBsZXRlZC4gVXNlZCBieSBjbGllbnRzCi0J
ICogdGhhdCB3YWl0IGZvciBkZXZfcHJpdi0+bW0ud2VkZ2VkIHRvIHNldHRsZS4KLQkgKi8KLQl3
YWl0X3F1ZXVlX2hlYWRfdCByZXNldF9xdWV1ZTsKLQotCXN0cnVjdCBzcmN1X3N0cnVjdCByZXNl
dF9iYWNrb2ZmX3NyY3U7CisJYXRvbWljX3QgcmVzZXRfZW5naW5lX2NvdW50W0k5MTVfTlVNX0VO
R0lORVNdOwogfTsKIAogc3RydWN0IGRybV9pOTE1X2Vycm9yX3N0YXRlX2J1ZiB7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfcmVxdWVzdC5jCmluZGV4IDE4NTY4NzM4ZmEzMC4uOTIzMTNhNTk1NjNjIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYwpAQCAtMTM2OSw4ICsxMzY5LDcgQEAgbG9u
ZyBpOTE1X3JlcXVlc3Rfd2FpdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKIAkgKiBzZXJpYWxp
c2Ugd2FpdC9yZXNldCB3aXRoIGFuIGV4cGxpY2l0IGxvY2ssIHdlIGRvIHdhbnQKIAkgKiBsb2Nr
ZGVwIHRvIGRldGVjdCBwb3RlbnRpYWwgZGVwZW5kZW5jeSBjeWNsZXMuCiAJICovCi0JbXV0ZXhf
YWNxdWlyZSgmcnEtPmk5MTUtPmdwdV9lcnJvci53ZWRnZV9tdXRleC5kZXBfbWFwLAotCQkgICAg
ICAwLCAwLCBfVEhJU19JUF8pOworCW11dGV4X2FjcXVpcmUoJnJxLT5lbmdpbmUtPmd0LT5yZXNl
dC5tdXRleC5kZXBfbWFwLCAwLCAwLCBfVEhJU19JUF8pOwogCiAJLyoKIAkgKiBPcHRpbWlzdGlj
IHNwaW4gYmVmb3JlIHRvdWNoaW5nIElSUXMuCkBAIC0xNDQ4LDcgKzE0NDcsNyBAQCBsb25nIGk5
MTVfcmVxdWVzdF93YWl0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAogCWRtYV9mZW5jZV9yZW1v
dmVfY2FsbGJhY2soJnJxLT5mZW5jZSwgJndhaXQuY2IpOwogCiBvdXQ6Ci0JbXV0ZXhfcmVsZWFz
ZSgmcnEtPmk5MTUtPmdwdV9lcnJvci53ZWRnZV9tdXRleC5kZXBfbWFwLCAwLCBfVEhJU19JUF8p
OworCW11dGV4X3JlbGVhc2UoJnJxLT5lbmdpbmUtPmd0LT5yZXNldC5tdXRleC5kZXBfbWFwLCAw
LCBfVEhJU19JUF8pOwogCXRyYWNlX2k5MTVfcmVxdWVzdF93YWl0X2VuZChycSk7CiAJcmV0dXJu
IHRpbWVvdXQ7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NlbGZ0
ZXN0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NlbGZ0ZXN0LmgKaW5kZXggZDliMTdi
OWU2OTkzLi5hY2RmNmViOWUyNjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfc2VsZnRlc3QuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NlbGZ0ZXN0LmgK
QEAgLTcyLDYgKzcyLDkgQEAgaW50IF9faTkxNV9ub3BfdGVhcmRvd24oaW50IGVyciwgdm9pZCAq
ZGF0YSk7CiBpbnQgX19pOTE1X2xpdmVfc2V0dXAodm9pZCAqZGF0YSk7CiBpbnQgX19pOTE1X2xp
dmVfdGVhcmRvd24oaW50IGVyciwgdm9pZCAqZGF0YSk7CiAKK2ludCBfX2ludGVsX2d0X2xpdmVf
c2V0dXAodm9pZCAqZGF0YSk7CitpbnQgX19pbnRlbF9ndF9saXZlX3RlYXJkb3duKGludCBlcnIs
IHZvaWQgKmRhdGEpOworCiBpbnQgX19pOTE1X3N1YnRlc3RzKGNvbnN0IGNoYXIgKmNhbGxlciwK
IAkJICAgIGludCAoKnNldHVwKSh2b2lkICpkYXRhKSwKIAkJICAgIGludCAoKnRlYXJkb3duKShp
bnQgZXJyLCB2b2lkICpkYXRhKSwKQEAgLTg4LDYgKzkxLDEyIEBAIGludCBfX2k5MTVfc3VidGVz
dHMoY29uc3QgY2hhciAqY2FsbGVyLAogCQkJX19pOTE1X2xpdmVfc2V0dXAsIF9faTkxNV9saXZl
X3RlYXJkb3duLCBcCiAJCQlULCBBUlJBWV9TSVpFKFQpLCBkYXRhKTsgXAogfSkKKyNkZWZpbmUg
aW50ZWxfZ3RfbGl2ZV9zdWJ0ZXN0cyhULCBkYXRhKSAoeyBcCisJdHlwZWNoZWNrKHN0cnVjdCBp
bnRlbF9ndCAqLCBkYXRhKTsgXAorCV9faTkxNV9zdWJ0ZXN0cyhfX2Z1bmNfXywgXAorCQkJX19p
bnRlbF9ndF9saXZlX3NldHVwLCBfX2ludGVsX2d0X2xpdmVfdGVhcmRvd24sIFwKKwkJCVQsIEFS
UkFZX1NJWkUoVCksIGRhdGEpOyBcCit9KQogCiAjZGVmaW5lIFNVQlRFU1QoeCkgeyB4LCAjeCB9
CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Y19zdWJtaXNzaW9u
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWNfc3VibWlzc2lvbi5jCmluZGV4IGYx
MDRiOTRjMTRlZi4uNDM0ZWEzZmY3ZTRjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9ndWNfc3VibWlzc2lvbi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVs
X2d1Y19zdWJtaXNzaW9uLmMKQEAgLTg4Nyw3ICs4ODcsNyBAQCBzdGF0aWMgdm9pZCBndWNfcmVz
ZXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBib29sIHN0YWxsZWQpCiAJaWYgKCFp
OTE1X3JlcXVlc3Rfc3RhcnRlZChycSkpCiAJCXN0YWxsZWQgPSBmYWxzZTsKIAotCWk5MTVfcmVz
ZXRfcmVxdWVzdChycSwgc3RhbGxlZCk7CisJX19pOTE1X3JlcXVlc3RfcmVzZXQocnEsIHN0YWxs
ZWQpOwogCWludGVsX2xyX2NvbnRleHRfcmVzZXQoZW5naW5lLCBycS0+aHdfY29udGV4dCwgcnEt
PmhlYWQsIHN0YWxsZWQpOwogCiBvdXRfdW5sb2NrOgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaW50ZWxfdWMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3VjLmMKaW5k
ZXggZmRmMDBmMWViYjU3Li5iMGU4M2U5MWVhNmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX3VjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdWMuYwpA
QCAtMzgsNyArMzgsNyBAQCBzdGF0aWMgaW50IF9faW50ZWxfdWNfcmVzZXRfaHcoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCWludCByZXQ7CiAJdTMyIGd1Y19zdGF0dXM7CiAK
LQlyZXQgPSBpbnRlbF9yZXNldF9ndWMoZGV2X3ByaXYpOworCXJldCA9IGludGVsX3Jlc2V0X2d1
YygmZGV2X3ByaXYtPmd0KTsKIAlpZiAocmV0KSB7CiAJCURSTV9FUlJPUigiRmFpbGVkIHRvIHJl
c2V0IEd1QywgcmV0ID0gJWRcbiIsIHJldCk7CiAJCXJldHVybiByZXQ7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9hY3RpdmUuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jCmluZGV4IDI5NjAzYzUxNzNjNC4uNzdk
ODQ0YWM4YjcxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV9hY3RpdmUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9hY3Rp
dmUuYwpAQCAtNyw2ICs3LDcgQEAKICNpbmNsdWRlIDxsaW51eC9rcmVmLmg+CiAKICNpbmNsdWRl
ICJnZW0vaTkxNV9nZW1fcG0uaCIKKyNpbmNsdWRlICJndC9pbnRlbF9ndC5oIgogCiAjaW5jbHVk
ZSAiaTkxNV9zZWxmdGVzdC5oIgogCkBAIC0yMjAsNyArMjIxLDcgQEAgaW50IGk5MTVfYWN0aXZl
X2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCQlTVUJURVNU
KGxpdmVfYWN0aXZlX3JldGlyZSksCiAJfTsKIAotCWlmIChpOTE1X3Rlcm1pbmFsbHlfd2VkZ2Vk
KGk5MTUpKQorCWlmIChpbnRlbF9ndF9pc193ZWRnZWQoJmk5MTUtPmd0KSkKIAkJcmV0dXJuIDA7
CiAKIAlyZXR1cm4gaTkxNV9zdWJ0ZXN0cyh0ZXN0cywgaTkxNSk7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbS5jCmluZGV4IGI4ZmZhZTQ4MTczMC4uYmI2ZGQ1NGE2ZmYz
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW0uYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW0uYwpAQCAtOCw2ICs4
LDcgQEAKIAogI2luY2x1ZGUgImdlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGlscy5oIgogI2luY2x1
ZGUgImdlbS9zZWxmdGVzdHMvbW9ja19jb250ZXh0LmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfZ3Qu
aCIKIAogI2luY2x1ZGUgImk5MTVfc2VsZnRlc3QuaCIKIApAQCAtMjA2LDcgKzIwNyw3IEBAIGlu
dCBpOTE1X2dlbV9saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
IAkJU1VCVEVTVChpZ3RfZ2VtX2hpYmVybmF0ZSksCiAJfTsKIAotCWlmIChpOTE1X3Rlcm1pbmFs
bHlfd2VkZ2VkKGk5MTUpKQorCWlmIChpbnRlbF9ndF9pc193ZWRnZWQoJmk5MTUtPmd0KSkKIAkJ
cmV0dXJuIDA7CiAKIAlyZXR1cm4gaTkxNV9saXZlX3N1YnRlc3RzKHRlc3RzLCBpOTE1KTsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMKaW5kZXgg
YTNjYjBhYWRlNmYxLi5iNjQ0OWQwYThjMTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5jCkBAIC0yNSw2ICsyNSw3IEBACiAjaW5jbHVkZSAi
Z2VtL2k5MTVfZ2VtX3BtLmgiCiAjaW5jbHVkZSAiZ2VtL3NlbGZ0ZXN0cy9pZ3RfZ2VtX3V0aWxz
LmgiCiAjaW5jbHVkZSAiZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQuaCIKKyNpbmNsdWRlICJn
dC9pbnRlbF9ndC5oIgogCiAjaW5jbHVkZSAiaTkxNV9zZWxmdGVzdC5oIgogCkBAIC01NTcsNyAr
NTU4LDcgQEAgaW50IGk5MTVfZ2VtX2V2aWN0X2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogCQlTVUJURVNUKGlndF9ldmljdF9jb250ZXh0cyksCiAJfTsKIAot
CWlmIChpOTE1X3Rlcm1pbmFsbHlfd2VkZ2VkKGk5MTUpKQorCWlmIChpbnRlbF9ndF9pc193ZWRn
ZWQoJmk5MTUtPmd0KSkKIAkJcmV0dXJuIDA7CiAKIAlyZXR1cm4gaTkxNV9zdWJ0ZXN0cyh0ZXN0
cywgaTkxNSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV9yZXF1ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0
LmMKaW5kZXggMWJiZmM0M2Q0YTllLi44NmMyOTk2NjM5MzQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMKQEAgLTM4MCw3ICszODAsNyBAQCBzdGF0
aWMgaW50IF9faWd0X2JyZWFkY3J1bWJzX3Ntb2tldGVzdCh2b2lkICphcmcpCiAJCQkgICAgICAg
dC0+ZW5naW5lLT5uYW1lKTsKIAkJCUdFTV9UUkFDRV9EVU1QKCk7CiAKLQkJCWk5MTVfZ2VtX3Nl
dF93ZWRnZWQodC0+ZW5naW5lLT5pOTE1KTsKKwkJCWludGVsX2d0X3NldF93ZWRnZWQodC0+ZW5n
aW5lLT5ndCk7CiAJCQlHRU1fQlVHX09OKCFpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJxKSk7CiAJ
CQlpOTE1X3N3X2ZlbmNlX3dhaXQod2FpdCk7CiAJCQllcnIgPSAtRUlPOwpAQCAtMTIzNCw3ICsx
MjM0LDcgQEAgaW50IGk5MTVfcmVxdWVzdF9saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIAkJU1VCVEVTVChsaXZlX2JyZWFkY3J1bWJzX3Ntb2tldGVzdCksCiAJ
fTsKIAotCWlmIChpOTE1X3Rlcm1pbmFsbHlfd2VkZ2VkKGk5MTUpKQorCWlmIChpbnRlbF9ndF9p
c193ZWRnZWQoJmk5MTUtPmd0KSkKIAkJcmV0dXJuIDA7CiAKIAlyZXR1cm4gaTkxNV9zdWJ0ZXN0
cyh0ZXN0cywgaTkxNSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaTkxNV9zZWxmdGVzdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVf
c2VsZnRlc3QuYwppbmRleCBmNDZjY2Y4MTdhZDUuLmRiOWM2NDViYmRmZSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfc2VsZnRlc3QuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9zZWxmdGVzdC5jCkBAIC0yNTYsNyArMjU2
LDcgQEAgaW50IF9faTkxNV9saXZlX3NldHVwKHZvaWQgKmRhdGEpCiB7CiAJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSBkYXRhOwogCi0JcmV0dXJuIGk5MTVfdGVybWluYWxseV93ZWRn
ZWQoaTkxNSk7CisJcmV0dXJuIGludGVsX2d0X3Rlcm1pbmFsbHlfd2VkZ2VkKCZpOTE1LT5ndCk7
CiB9CiAKIGludCBfX2k5MTVfbGl2ZV90ZWFyZG93bihpbnQgZXJyLCB2b2lkICpkYXRhKQpAQCAt
MjczLDYgKzI3MywyNyBAQCBpbnQgX19pOTE1X2xpdmVfdGVhcmRvd24oaW50IGVyciwgdm9pZCAq
ZGF0YSkKIAlyZXR1cm4gZXJyOwogfQogCitpbnQgX19pbnRlbF9ndF9saXZlX3NldHVwKHZvaWQg
KmRhdGEpCit7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGRhdGE7CisKKwlyZXR1cm4gaW50ZWxf
Z3RfdGVybWluYWxseV93ZWRnZWQoZ3QpOworfQorCitpbnQgX19pbnRlbF9ndF9saXZlX3RlYXJk
b3duKGludCBlcnIsIHZvaWQgKmRhdGEpCit7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGRhdGE7
CisKKwltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJaWYgKGlndF9m
bHVzaF90ZXN0KGd0LT5pOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwkJZXJyID0gLUVJTzsKKwlt
dXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKworCWk5MTVfZ2VtX2Ry
YWluX2ZyZWVkX29iamVjdHMoZ3QtPmk5MTUpOworCisJcmV0dXJuIGVycjsKK30KKwogaW50IF9f
aTkxNV9zdWJ0ZXN0cyhjb25zdCBjaGFyICpjYWxsZXIsCiAJCSAgICBpbnQgKCpzZXR1cCkodm9p
ZCAqZGF0YSksCiAJCSAgICBpbnQgKCp0ZWFyZG93bikoaW50IGVyciwgdm9pZCAqZGF0YSksCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2ZsdXNoX3Rlc3Qu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5jCmluZGV4
IDViZmQxYjI2MjZhMi4uZDNiNWViNDAyZDMzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9zZWxmdGVzdHMvaWd0X2ZsdXNoX3Rlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvaWd0X2ZsdXNoX3Rlc3QuYwpAQCAtNSw2ICs1LDcgQEAKICAqLwogCiAjaW5j
bHVkZSAiZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaCIKKyNpbmNsdWRlICJndC9pbnRlbF9ndC5oIgog
CiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIKICNpbmNsdWRlICJpOTE1X3NlbGZ0ZXN0LmgiCkBAIC0x
Myw3ICsxNCw3IEBACiAKIGludCBpZ3RfZmx1c2hfdGVzdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwgdW5zaWduZWQgaW50IGZsYWdzKQogewotCWludCByZXQgPSBpOTE1X3Rlcm1pbmFs
bHlfd2VkZ2VkKGk5MTUpID8gLUVJTyA6IDA7CisJaW50IHJldCA9IGludGVsX2d0X2lzX3dlZGdl
ZCgmaTkxNS0+Z3QpID8gLUVJTyA6IDA7CiAJaW50IHJlcGVhdCA9ICEhKGZsYWdzICYgSTkxNV9X
QUlUX0xPQ0tFRCk7CiAKIAljb25kX3Jlc2NoZWQoKTsKQEAgLTI3LDcgKzI4LDcgQEAgaW50IGln
dF9mbHVzaF90ZXN0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1bnNpZ25lZCBpbnQg
ZmxhZ3MpCiAJCQkJICBfX2J1aWx0aW5fcmV0dXJuX2FkZHJlc3MoMCkpOwogCQkJR0VNX1RSQUNF
X0RVTVAoKTsKIAotCQkJaTkxNV9nZW1fc2V0X3dlZGdlZChpOTE1KTsKKwkJCWludGVsX2d0X3Nl
dF93ZWRnZWQoJmk5MTUtPmd0KTsKIAkJCXJlcGVhdCA9IDA7CiAJCQlyZXQgPSAtRUlPOwogCQl9
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X3Jlc2V0LmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X3Jlc2V0LmMKaW5kZXggNTg3ZGY2
ZmQ0ZmZlLi43ZWM4ZjhiMDQ5YzYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9pZ3RfcmVzZXQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aWd0X3Jlc2V0LmMKQEAgLTcsNDcgKzcsNDUgQEAKICNpbmNsdWRlICJpZ3RfcmVzZXQuaCIKIAog
I2luY2x1ZGUgImd0L2ludGVsX2VuZ2luZS5oIgorI2luY2x1ZGUgImd0L2ludGVsX2d0LmgiCiAK
ICNpbmNsdWRlICIuLi9pOTE1X2Rydi5oIgogCi12b2lkIGlndF9nbG9iYWxfcmVzZXRfbG9jayhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3ZvaWQgaWd0X2dsb2JhbF9yZXNldF9sb2Nr
KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiB7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5l
OwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwogCi0JcHJfZGVidWcoIiVzOiBjdXJyZW50IGdw
dV9lcnJvcj0lMDhseFxuIiwKLQkJIF9fZnVuY19fLCBpOTE1LT5ncHVfZXJyb3IuZmxhZ3MpOwor
CXByX2RlYnVnKCIlczogY3VycmVudCBncHVfZXJyb3I9JTA4bHhcbiIsIF9fZnVuY19fLCBndC0+
cmVzZXQuZmxhZ3MpOwogCi0Jd2hpbGUgKHRlc3RfYW5kX3NldF9iaXQoSTkxNV9SRVNFVF9CQUNL
T0ZGLCAmaTkxNS0+Z3B1X2Vycm9yLmZsYWdzKSkKLQkJd2FpdF9ldmVudChpOTE1LT5ncHVfZXJy
b3IucmVzZXRfcXVldWUsCi0JCQkgICAhdGVzdF9iaXQoSTkxNV9SRVNFVF9CQUNLT0ZGLAotCQkJ
CSAgICAgJmk5MTUtPmdwdV9lcnJvci5mbGFncykpOworCXdoaWxlICh0ZXN0X2FuZF9zZXRfYml0
KEk5MTVfUkVTRVRfQkFDS09GRiwgJmd0LT5yZXNldC5mbGFncykpCisJCXdhaXRfZXZlbnQoZ3Qt
PnJlc2V0LnF1ZXVlLAorCQkJICAgIXRlc3RfYml0KEk5MTVfUkVTRVRfQkFDS09GRiwgJmd0LT5y
ZXNldC5mbGFncykpOwogCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKKwlm
b3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndC0+aTkxNSwgaWQpIHsKIAkJd2hpbGUgKHRlc3RfYW5k
X3NldF9iaXQoSTkxNV9SRVNFVF9FTkdJTkUgKyBpZCwKLQkJCQkJJmk5MTUtPmdwdV9lcnJvci5m
bGFncykpCi0JCQl3YWl0X29uX2JpdCgmaTkxNS0+Z3B1X2Vycm9yLmZsYWdzLAotCQkJCSAgICBJ
OTE1X1JFU0VUX0VOR0lORSArIGlkLAorCQkJCQkmZ3QtPnJlc2V0LmZsYWdzKSkKKwkJCXdhaXRf
b25fYml0KCZndC0+cmVzZXQuZmxhZ3MsIEk5MTVfUkVTRVRfRU5HSU5FICsgaWQsCiAJCQkJICAg
IFRBU0tfVU5JTlRFUlJVUFRJQkxFKTsKIAl9CiB9CiAKLXZvaWQgaWd0X2dsb2JhbF9yZXNldF91
bmxvY2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCit2b2lkIGlndF9nbG9iYWxfcmVz
ZXRfdW5sb2NrKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiB7CiAJc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwogCi0JZm9yX2VhY2hfZW5naW5l
KGVuZ2luZSwgaTkxNSwgaWQpCi0JCWNsZWFyX2JpdChJOTE1X1JFU0VUX0VOR0lORSArIGlkLCAm
aTkxNS0+Z3B1X2Vycm9yLmZsYWdzKTsKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndC0+aTkx
NSwgaWQpCisJCWNsZWFyX2JpdChJOTE1X1JFU0VUX0VOR0lORSArIGlkLCAmZ3QtPnJlc2V0LmZs
YWdzKTsKIAotCWNsZWFyX2JpdChJOTE1X1JFU0VUX0JBQ0tPRkYsICZpOTE1LT5ncHVfZXJyb3Iu
ZmxhZ3MpOwotCXdha2VfdXBfYWxsKCZpOTE1LT5ncHVfZXJyb3IucmVzZXRfcXVldWUpOworCWNs
ZWFyX2JpdChJOTE1X1JFU0VUX0JBQ0tPRkYsICZndC0+cmVzZXQuZmxhZ3MpOworCXdha2VfdXBf
YWxsKCZndC0+cmVzZXQucXVldWUpOwogfQogCi1ib29sIGlndF9mb3JjZV9yZXNldChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK2Jvb2wgaWd0X2ZvcmNlX3Jlc2V0KHN0cnVjdCBpbnRl
bF9ndCAqZ3QpCiB7Ci0JaTkxNV9nZW1fc2V0X3dlZGdlZChpOTE1KTsKLQlpOTE1X3Jlc2V0KGk5
MTUsIDAsIE5VTEwpOworCWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOworCWludGVsX2d0X3Jlc2V0
KGd0LCAwLCBOVUxMKTsKIAotCXJldHVybiAhaTkxNV9yZXNldF9mYWlsZWQoaTkxNSk7CisJcmV0
dXJuICFpbnRlbF9ndF9pc193ZWRnZWQoZ3QpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9yZXNldC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2Vs
ZnRlc3RzL2lndF9yZXNldC5oCmluZGV4IDM2M2JkODUzZTUwZi4uODUxODczYjY3YWIzIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X3Jlc2V0LmgKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9yZXNldC5oCkBAIC03LDEwICs3LDEy
IEBACiAjaWZuZGVmIF9fSTkxNV9TRUxGVEVTVFNfSUdUX1JFU0VUX0hfXwogI2RlZmluZSBfX0k5
MTVfU0VMRlRFU1RTX0lHVF9SRVNFVF9IX18KIAotI2luY2x1ZGUgIi4uL2k5MTVfZHJ2LmgiCisj
aW5jbHVkZSA8bGludXgvdHlwZXMuaD4KIAotdm9pZCBpZ3RfZ2xvYmFsX3Jlc2V0X2xvY2soc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwotdm9pZCBpZ3RfZ2xvYmFsX3Jlc2V0X3VubG9j
ayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Ci1ib29sIGlndF9mb3JjZV9yZXNldChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CitzdHJ1Y3QgaW50ZWxfZ3Q7CisKK3ZvaWQg
aWd0X2dsb2JhbF9yZXNldF9sb2NrKHN0cnVjdCBpbnRlbF9ndCAqZ3QpOwordm9pZCBpZ3RfZ2xv
YmFsX3Jlc2V0X3VubG9jayhzdHJ1Y3QgaW50ZWxfZ3QgKmd0KTsKK2Jvb2wgaWd0X2ZvcmNlX3Jl
c2V0KHN0cnVjdCBpbnRlbF9ndCAqZ3QpOwogCiAjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3Rfd2VkZ2VfbWUuaCBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pZ3Rfd2VkZ2VfbWUuaApkZWxldGVkIGZpbGUgbW9kZSAxMDA2NDQKaW5k
ZXggMDhlNWZmMTFiYmQ5Li4wMDAwMDAwMDAwMDAKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2lndF93ZWRnZV9tZS5oCisrKyAvZGV2L251bGwKQEAgLTEsNTggKzAsMCBAQAot
LyoKLSAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKLSAqCi0gKiBDb3B5cmlnaHQgwqkg
MjAxOCBJbnRlbCBDb3Jwb3JhdGlvbgotICovCi0KLSNpZm5kZWYgSUdUX1dFREdFX01FX0gKLSNk
ZWZpbmUgSUdUX1dFREdFX01FX0gKLQotI2luY2x1ZGUgPGxpbnV4L3dvcmtxdWV1ZS5oPgotCi0j
aW5jbHVkZSAiLi4vaTkxNV9nZW0uaCIKLQotc3RydWN0IGRybV9pOTE1X3ByaXZhdGU7Ci0KLXN0
cnVjdCBpZ3Rfd2VkZ2VfbWUgewotCXN0cnVjdCBkZWxheWVkX3dvcmsgd29yazsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNTsKLQljb25zdCBjaGFyICpuYW1lOwotfTsKLQotc3RhdGlj
IHZvaWQgX19pZ3Rfd2VkZ2VfbWUoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQotewotCXN0cnVj
dCBpZ3Rfd2VkZ2VfbWUgKncgPSBjb250YWluZXJfb2Yod29yaywgdHlwZW9mKCp3KSwgd29yay53
b3JrKTsKLQotCXByX2VycigiJXMgdGltZWQgb3V0LCBjYW5jZWxsaW5nIHRlc3QuXG4iLCB3LT5u
YW1lKTsKLQotCUdFTV9UUkFDRSgiJXMgdGltZWQgb3V0LlxuIiwgdy0+bmFtZSk7Ci0JR0VNX1RS
QUNFX0RVTVAoKTsKLQotCWk5MTVfZ2VtX3NldF93ZWRnZWQody0+aTkxNSk7Ci19Ci0KLXN0YXRp
YyB2b2lkIF9faWd0X2luaXRfd2VkZ2Uoc3RydWN0IGlndF93ZWRnZV9tZSAqdywKLQkJCSAgICAg
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCi0JCQkgICAgIGxvbmcgdGltZW91dCwKLQkJ
CSAgICAgY29uc3QgY2hhciAqbmFtZSkKLXsKLQl3LT5pOTE1ID0gaTkxNTsKLQl3LT5uYW1lID0g
bmFtZTsKLQotCUlOSVRfREVMQVlFRF9XT1JLX09OU1RBQ0soJnctPndvcmssIF9faWd0X3dlZGdl
X21lKTsKLQlzY2hlZHVsZV9kZWxheWVkX3dvcmsoJnctPndvcmssIHRpbWVvdXQpOwotfQotCi1z
dGF0aWMgdm9pZCBfX2lndF9maW5pX3dlZGdlKHN0cnVjdCBpZ3Rfd2VkZ2VfbWUgKncpCi17Ci0J
Y2FuY2VsX2RlbGF5ZWRfd29ya19zeW5jKCZ3LT53b3JrKTsKLQlkZXN0cm95X2RlbGF5ZWRfd29y
a19vbl9zdGFjaygmdy0+d29yayk7Ci0Jdy0+aTkxNSA9IE5VTEw7Ci19Ci0KLSNkZWZpbmUgaWd0
X3dlZGdlX29uX3RpbWVvdXQoVywgREVWLCBUSU1FT1VUKQkJCQlcCi0JZm9yIChfX2lndF9pbml0
X3dlZGdlKChXKSwgKERFViksIChUSU1FT1VUKSwgX19mdW5jX18pOwkJXAotCSAgICAgKFcpLT5p
OTE1OwkJCQkJCQlcCi0JICAgICBfX2lndF9maW5pX3dlZGdlKChXKSkpCi0KLSNlbmRpZiAvKiBJ
R1RfV0VER0VfTUVfSCAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL21vY2tfZ2VtX2RldmljZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21v
Y2tfZ2VtX2RldmljZS5jCmluZGV4IDI3NDE4MDViNTZjMi4uZmQ0Y2M0ODA5ZWI4IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jCkBAIC0x
ODMsMTEgKzE4Myw2IEBAIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICptb2NrX2dlbV9kZXZpY2Uo
dm9pZCkKIAlpbnRlbF9ndF9pbml0X2Vhcmx5KCZpOTE1LT5ndCwgaTkxNSk7CiAJYXRvbWljX2lu
YygmaTkxNS0+Z3Qud2FrZXJlZi5jb3VudCk7IC8qIGRpc2FibGU7IG5vIGh3IHN1cHBvcnQgKi8K
IAotCWluaXRfd2FpdHF1ZXVlX2hlYWQoJmk5MTUtPmdwdV9lcnJvci53YWl0X3F1ZXVlKTsKLQlp
bml0X3dhaXRxdWV1ZV9oZWFkKCZpOTE1LT5ncHVfZXJyb3IucmVzZXRfcXVldWUpOwotCWluaXRf
c3JjdV9zdHJ1Y3QoJmk5MTUtPmdwdV9lcnJvci5yZXNldF9iYWNrb2ZmX3NyY3UpOwotCW11dGV4
X2luaXQoJmk5MTUtPmdwdV9lcnJvci53ZWRnZV9tdXRleCk7Ci0KIAlpOTE1LT53cSA9IGFsbG9j
X29yZGVyZWRfd29ya3F1ZXVlKCJtb2NrIiwgMCk7CiAJaWYgKCFpOTE1LT53cSkKIAkJZ290byBl
cnJfZHJ2OwotLSAKMi4yMi4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVz
a3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9p
bnRlbC1nZng=

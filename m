Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 4BD342FF669
	for <lists+intel-gfx@lfdr.de>; Thu, 21 Jan 2021 21:53:40 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A22E36E95C;
	Thu, 21 Jan 2021 20:53:38 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3AE036E95A
 for <intel-gfx@lists.freedesktop.org>; Thu, 21 Jan 2021 20:53:37 +0000 (UTC)
IronPort-SDR: lD6pWxcRysIgPM+/R1iib6ch9rfPDbkXQ8dj9+c4ZvAIyp2VEVB1+dhqHYOrNWW97fW1M1OJAY
 1BlB6yNRupJQ==
X-IronPort-AV: E=McAfee;i="6000,8403,9871"; a="176771872"
X-IronPort-AV: E=Sophos;i="5.79,365,1602572400"; d="scan'208";a="176771872"
Received: from fmsmga001.fm.intel.com ([10.253.24.23])
 by fmsmga104.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 21 Jan 2021 12:53:30 -0800
IronPort-SDR: JwLyGqKpBs5i4Oq32lPiUNT/OEaaQTW5FQKp0CxoLbp9tnlvI0pgaOsyHONgcG0TC+rNdvONct
 FE6qci81huIA==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.79,365,1602572400"; d="scan'208";a="467618686"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by fmsmga001.fm.intel.com with SMTP; 21 Jan 2021 12:53:28 -0800
Received: by stinkbox (sSMTP sendmail emulation);
 Thu, 21 Jan 2021 22:53:27 +0200
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 21 Jan 2021 22:53:02 +0200
Message-Id: <20210121205302.24897-9-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.26.2
In-Reply-To: <20210121205302.24897-1-ville.syrjala@linux.intel.com>
References: <20210121205302.24897-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 8/8] drm/i915: Do a bit more initial readout
 for dbuf
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KClJl
YWRvdXQgdGhlIGRidWYgcmVsYXRlZCBzdHVmZiBkdXJpbmcgZHJpdmVyIGluaXQvcmVzdW1lIGFu
ZApzdGljayBpdCBpbnRvIG91ciBkYnVmIHN0YXRlLgoKUmV2aWV3ZWQtYnk6IFN0YW5pc2xhdiBM
aXNvdnNraXkgPHN0YW5pc2xhdi5saXNvdnNraXlAaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBW
aWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIHwgIDQgLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX3BtLmMgICAgICAgICAgICAgIHwgNDggKysrKysrKysrKysrKysr
KysrKy0KIDIgZmlsZXMgY2hhbmdlZCwgNDYgaW5zZXJ0aW9ucygrKSwgNiBkZWxldGlvbnMoLSkK
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXku
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4IDc3
NjkyOTIyMGQ4Yy4uOWVhNWFkNTA4NTk5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAtMTQ0MjIsMTQgKzE0NDIyLDEwIEBAIHZvaWQgaW50ZWxf
bW9kZXNldF9pbml0X2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0cnVj
dCBpbnRlbF9jZGNsa19zdGF0ZSAqY2RjbGtfc3RhdGUgPQogCQl0b19pbnRlbF9jZGNsa19zdGF0
ZShpOTE1LT5jZGNsay5vYmouc3RhdGUpOwotCXN0cnVjdCBpbnRlbF9kYnVmX3N0YXRlICpkYnVm
X3N0YXRlID0KLQkJdG9faW50ZWxfZGJ1Zl9zdGF0ZShpOTE1LT5kYnVmLm9iai5zdGF0ZSk7CiAK
IAlpbnRlbF91cGRhdGVfY2RjbGsoaTkxNSk7CiAJaW50ZWxfZHVtcF9jZGNsa19jb25maWcoJmk5
MTUtPmNkY2xrLmh3LCAiQ3VycmVudCBDRENMSyIpOwogCWNkY2xrX3N0YXRlLT5sb2dpY2FsID0g
Y2RjbGtfc3RhdGUtPmFjdHVhbCA9IGk5MTUtPmNkY2xrLmh3OwotCi0JZGJ1Zl9zdGF0ZS0+ZW5h
YmxlZF9zbGljZXMgPSBpOTE1LT5kYnVmLmVuYWJsZWRfc2xpY2VzOwogfQogCiBzdGF0aWMgaW50
IHNhbml0aXplX3dhdGVybWFya3NfYWRkX2FmZmVjdGVkKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRl
ICpzdGF0ZSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCmluZGV4IGU3YzI5MTBlOGQ4Ny4uYTQyOWUy
MmEyMmNhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKQEAgLTU2NjEsNiArNTY2MSwxOCBAQCBz
dGF0aWMgYm9vbCBza2xfZGRiX2VudHJpZXNfb3ZlcmxhcChjb25zdCBzdHJ1Y3Qgc2tsX2RkYl9l
bnRyeSAqYSwKIAlyZXR1cm4gYS0+c3RhcnQgPCBiLT5lbmQgJiYgYi0+c3RhcnQgPCBhLT5lbmQ7
CiB9CiAKK3N0YXRpYyB2b2lkIHNrbF9kZGJfZW50cnlfdW5pb24oc3RydWN0IHNrbF9kZGJfZW50
cnkgKmEsCisJCQkJY29uc3Qgc3RydWN0IHNrbF9kZGJfZW50cnkgKmIpCit7CisJaWYgKGEtPmVu
ZCAmJiBiLT5lbmQpIHsKKwkJYS0+c3RhcnQgPSBtaW4oYS0+c3RhcnQsIGItPnN0YXJ0KTsKKwkJ
YS0+ZW5kID0gbWF4KGEtPmVuZCwgYi0+ZW5kKTsKKwl9IGVsc2UgaWYgKGItPmVuZCkgeworCQlh
LT5zdGFydCA9IGItPnN0YXJ0OworCQlhLT5lbmQgPSBiLT5lbmQ7CisJfQorfQorCiBib29sIHNr
bF9kZGJfYWxsb2NhdGlvbl9vdmVybGFwcyhjb25zdCBzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSAqZGRi
LAogCQkJCSBjb25zdCBzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSAqZW50cmllcywKIAkJCQkgaW50IG51
bV9lbnRyaWVzLCBpbnQgaWdub3JlX2lkeCkKQEAgLTYxNzQsMTUgKzYxODYsNDcgQEAgdm9pZCBz
a2xfcGlwZV93bV9nZXRfaHdfc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAKIHZvaWQg
c2tsX3dtX2dldF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7
CisJc3RydWN0IGludGVsX2RidWZfc3RhdGUgKmRidWZfc3RhdGUgPQorCQl0b19pbnRlbF9kYnVm
X3N0YXRlKGRldl9wcml2LT5kYnVmLm9iai5zdGF0ZSk7CiAJc3RydWN0IGludGVsX2NydGMgKmNy
dGM7Ci0Jc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGU7CiAKIAlmb3JfZWFjaF9p
bnRlbF9jcnRjKCZkZXZfcHJpdi0+ZHJtLCBjcnRjKSB7Ci0JCWNydGNfc3RhdGUgPSB0b19pbnRl
bF9jcnRjX3N0YXRlKGNydGMtPmJhc2Uuc3RhdGUpOworCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSA9CisJCQl0b19pbnRlbF9jcnRjX3N0YXRlKGNydGMtPmJhc2Uuc3RhdGUp
OworCQllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CisJCWVudW0gcGxhbmVfaWQgcGxhbmVf
aWQ7CiAKIAkJc2tsX3BpcGVfd21fZ2V0X2h3X3N0YXRlKGNydGMsICZjcnRjX3N0YXRlLT53bS5z
a2wub3B0aW1hbCk7CiAJCWNydGNfc3RhdGUtPndtLnNrbC5yYXcgPSBjcnRjX3N0YXRlLT53bS5z
a2wub3B0aW1hbDsKKworCQltZW1zZXQoJmRidWZfc3RhdGUtPmRkYltwaXBlXSwgMCwgc2l6ZW9m
KGRidWZfc3RhdGUtPmRkYltwaXBlXSkpOworCisJCWZvcl9lYWNoX3BsYW5lX2lkX29uX2NydGMo
Y3J0YywgcGxhbmVfaWQpIHsKKwkJCXN0cnVjdCBza2xfZGRiX2VudHJ5ICpkZGJfeSA9CisJCQkJ
JmNydGNfc3RhdGUtPndtLnNrbC5wbGFuZV9kZGJfeVtwbGFuZV9pZF07CisJCQlzdHJ1Y3Qgc2ts
X2RkYl9lbnRyeSAqZGRiX3V2ID0KKwkJCQkmY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYl91
dltwbGFuZV9pZF07CisKKwkJCXNrbF9kZGJfZ2V0X2h3X3BsYW5lX3N0YXRlKGRldl9wcml2LCBj
cnRjLT5waXBlLAorCQkJCQkJICAgcGxhbmVfaWQsIGRkYl95LCBkZGJfdXYpOworCisJCQlza2xf
ZGRiX2VudHJ5X3VuaW9uKCZkYnVmX3N0YXRlLT5kZGJbcGlwZV0sIGRkYl95KTsKKwkJCXNrbF9k
ZGJfZW50cnlfdW5pb24oJmRidWZfc3RhdGUtPmRkYltwaXBlXSwgZGRiX3V2KTsKKwkJfQorCisJ
CWRidWZfc3RhdGUtPnNsaWNlc1twaXBlXSA9CisJCQlza2xfY29tcHV0ZV9kYnVmX3NsaWNlcyhj
cnRjLCBkYnVmX3N0YXRlLT5hY3RpdmVfcGlwZXMpOworCisJCWRidWZfc3RhdGUtPndlaWdodFtw
aXBlXSA9IGludGVsX2NydGNfZGRiX3dlaWdodChjcnRjX3N0YXRlKTsKKworCQlkcm1fZGJnX2tt
cygmZGV2X3ByaXYtPmRybSwKKwkJCSAgICAiW0NSVEM6JWQ6JXNdIGRidWYgc2xpY2VzIDB4JXgs
IGRkYiAoJWQgLSAlZCksIGFjdGl2ZSBwaXBlcyAweCV4XG4iLAorCQkJICAgIGNydGMtPmJhc2Uu
YmFzZS5pZCwgY3J0Yy0+YmFzZS5uYW1lLAorCQkJICAgIGRidWZfc3RhdGUtPnNsaWNlc1twaXBl
XSwgZGJ1Zl9zdGF0ZS0+ZGRiW3BpcGVdLnN0YXJ0LAorCQkJICAgIGRidWZfc3RhdGUtPmRkYltw
aXBlXS5lbmQsIGRidWZfc3RhdGUtPmFjdGl2ZV9waXBlcyk7CiAJfQorCisJZGJ1Zl9zdGF0ZS0+
ZW5hYmxlZF9zbGljZXMgPSBkZXZfcHJpdi0+ZGJ1Zi5lbmFibGVkX3NsaWNlczsKIH0KIAogc3Rh
dGljIHZvaWQgaWxrX3BpcGVfd21fZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRj
KQotLSAKMi4yNi4yCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5v
cmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1n
ZngK

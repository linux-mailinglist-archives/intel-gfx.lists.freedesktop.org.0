Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D70172518D
	for <lists+intel-gfx@lfdr.de>; Tue, 21 May 2019 16:09:32 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 1331B893A7;
	Tue, 21 May 2019 14:09:30 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A9BDE8935B
 for <intel-gfx@lists.freedesktop.org>; Tue, 21 May 2019 14:09:28 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga005.fm.intel.com ([10.253.24.32])
 by fmsmga104.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 21 May 2019 07:09:28 -0700
X-ExtLoop1: 1
Received: from ylukoyan-mobl.ccr.corp.intel.com (HELO
 delly.ger.corp.intel.com) ([10.251.94.80])
 by fmsmga005.fm.intel.com with ESMTP; 21 May 2019 07:09:27 -0700
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 21 May 2019 15:08:55 +0100
Message-Id: <20190521140855.3957-6-lionel.g.landwerlin@intel.com>
X-Mailer: git-send-email 2.21.0.392.gf8f6787159e
In-Reply-To: <20190521140855.3957-1-lionel.g.landwerlin@intel.com>
References: <20190521140855.3957-1-lionel.g.landwerlin@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 5/5] drm/i915: add support for perf
 configuration queries
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TGlzdGluZyBjb25maWd1cmF0aW9ucyBhdCB0aGUgbW9tZW50IGlzIHN1cHBvcnRlZCBvbmx5IHRo
cm91Z2ggc3lzZnMuClRoaXMgbWlnaHQgY2F1c2UgaXNzdWVzIGZvciBhcHBsaWNhdGlvbnMgd2Fu
dGluZyB0byBsaXN0CmNvbmZpZ3VyYXRpb25zIGZyb20gYSBjb250YWluZXIgd2hlcmUgc3lzZnMg
aXNuJ3QgYXZhaWxhYmxlLgoKVGhpcyBjaGFuZ2UgYWRkcyBhIHdheSB0byBxdWVyeSB0aGUgbnVt
YmVyIG9mIGNvbmZpZ3VyYXRpb25zIGFuZCB0aGVpcgpjb250ZW50IHRocm91Z2ggdGhlIGk5MTUg
cXVlcnkgdUFQSS4KCnYyOiBGaXggc3BhcnNlIHdhcm5pbmdzIChMaW9uZWwpCiAgICBBZGQgc3Vw
cG9ydCB0byBxdWVyeSBjb25maWd1cmF0aW9uIHVzaW5nIHV1aWQgKExpb25lbCkKCnYzOiBGaXgg
c29tZSBpbmNvbnNpc3RlbmN5IGluIHVhcGkgaGVhZGVyIChMaW9uZWwpCiAgICBGaXggdW5sb2Nr
aW5nIHdoZW4gbm90IGxvY2tlZCBpc3N1ZSAoTGlvbmVsKQogICAgQWRkIGRlYnVnIG1lc3NhZ2Vz
IChMaW9uZWwpCgpTaWduZWQtb2ZmLWJ5OiBMaW9uZWwgTGFuZHdlcmxpbiA8bGlvbmVsLmcubGFu
ZHdlcmxpbkBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAg
IHwgICA2ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jICB8ICAgNCArCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3F1ZXJ5LmMgfCAyNzcgKysrKysrKysrKysrKysrKysrKysr
KysrKysrKysrCiBpbmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJtLmggICAgICAgfCAgNjIgKysrKysr
LQogNCBmaWxlcyBjaGFuZ2VkLCAzNDggaW5zZXJ0aW9ucygrKSwgMSBkZWxldGlvbigtKQoKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2Rydi5oCmluZGV4IDI1ODYwZDk5ZmZjNi4uNjEyN2M2ODkwZTBiIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZHJ2LmgKQEAgLTE4NzUsNiArMTg3NSwxMiBAQCBzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSB7CiAJCSAqLwogCQlzdHJ1Y3QgbGlzdF9oZWFkIG1ldHJpY3NfYnVmZmVyczsK
IAorCQkvKgorCQkgKiBOdW1iZXIgb2YgZHluYW1pYyBjb25maWd1cmF0aW9ucywgeW91IG5lZWQg
dG8gaG9sZAorCQkgKiBkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2xvY2sgdG8gYWNjZXNzIGl0Lgor
CQkgKi8KKwkJdTMyIG5fbWV0cmljczsKKwogCQkvKgogCQkgKiBMb2NrIGFzc29jaWF0ZWQgd2l0
aCBhbnl0aGluZyBiZWxvdyB3aXRoaW4gdGhpcyBzdHJ1Y3R1cmUKIAkJICogZXhjZXB0IGV4Y2x1
c2l2ZV9zdHJlYW0uCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCmluZGV4IDdiODYxZjEyZjE2MS4u
NmFiNDE0ZTBiYTFjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYwpAQCAtMzQzMiw2ICszNDMy
LDggQEAgaW50IGk5MTVfcGVyZl9hZGRfY29uZmlnX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsIHZvaWQgKmRhdGEsCiAJCWdvdG8gc3lzZnNfZXJyOwogCX0KIAorCWRldl9wcml2LT5wZXJm
Lm5fbWV0cmljcysrOworCiAJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2xv
Y2spOwogCiAJRFJNX0RFQlVHKCJBZGRlZCBjb25maWcgJXMgaWQ9JWlcbiIsIG9hX2NvbmZpZy0+
dXVpZCwgb2FfY29uZmlnLT5pZCk7CkBAIC0zNDkzLDYgKzM0OTUsOCBAQCBpbnQgaTkxNV9wZXJm
X3JlbW92ZV9jb25maWdfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwK
IAogCWlkcl9yZW1vdmUoJmRldl9wcml2LT5wZXJmLm1ldHJpY3NfaWRyLCAqYXJnKTsKIAorCWRl
dl9wcml2LT5wZXJmLm5fbWV0cmljcy0tOworCiAJRFJNX0RFQlVHKCJSZW1vdmVkIGNvbmZpZyAl
cyBpZD0laVxuIiwgb2FfY29uZmlnLT51dWlkLCBvYV9jb25maWctPmlkKTsKIAogCWk5MTVfb2Ff
Y29uZmlnX3B1dChvYV9jb25maWcpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9xdWVyeS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9xdWVyeS5jCmluZGV4IDc4
MjE4M2I3OGY0OS4uODJiZDZkOTczNTI3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3F1ZXJ5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9xdWVyeS5jCkBA
IC05Niw5ICs5NiwyODYgQEAgc3RhdGljIGludCBxdWVyeV90b3BvbG9neV9pbmZvKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlyZXR1cm4gdG90YWxfbGVuZ3RoOwogfQogCitz
dGF0aWMgaW50IGNhbl9jb3B5X3BlcmZfY29uZmlnX3JlZ2lzdGVyc19vcl9udW1iZXIodTMyIHVz
ZXJfbl9yZWdzLAorCQkJCQkJICAgIHU2NCB1c2VyX3JlZ3NfcHRyLAorCQkJCQkJICAgIHUzMiBr
ZXJuZWxfbl9yZWdzKQoreworCS8qCisJICogV2UnbGwganVzdCBwdXQgdGhlIG51bWJlciBvZiBy
ZWdpc3RlcnMsIGFuZCB3b24ndCBjb3B5IHRoZQorCSAqIHJlZ2lzdGVyLgorCSAqLworCWlmICh1
c2VyX25fcmVncyA9PSAwKQorCQlyZXR1cm4gMDsKKworCWlmICh1c2VyX25fcmVncyA8IGtlcm5l
bF9uX3JlZ3MpCisJCXJldHVybiAtRUlOVkFMOworCisJaWYgKCFhY2Nlc3Nfb2sodTY0X3RvX3Vz
ZXJfcHRyKHVzZXJfcmVnc19wdHIpLAorCQkgICAgICAgMiAqIHNpemVvZih1MzIpICoga2VybmVs
X25fcmVncykpCisJCXJldHVybiAtRUZBVUxUOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBp
bnQgY29weV9wZXJmX2NvbmZpZ19yZWdpc3RlcnNfb3JfbnVtYmVyKGNvbnN0IHN0cnVjdCBpOTE1
X29hX3JlZyAqa2VybmVsX3JlZ3MsCisJCQkJCQl1MzIga2VybmVsX25fcmVncywKKwkJCQkJCXU2
NCB1c2VyX3JlZ3NfcHRyLAorCQkJCQkJdTMyICp1c2VyX25fcmVncykKK3sKKwl1MzIgcjsKKwor
CWlmICgqdXNlcl9uX3JlZ3MgPT0gMCkgeworCQkqdXNlcl9uX3JlZ3MgPSBrZXJuZWxfbl9yZWdz
OworCQlyZXR1cm4gMDsKKwl9CisKKwkqdXNlcl9uX3JlZ3MgPSBrZXJuZWxfbl9yZWdzOworCisJ
Zm9yIChyID0gMDsgciA8IGtlcm5lbF9uX3JlZ3M7IHIrKykgeworCQl1MzIgX191c2VyICp1c2Vy
X3JlZ19wdHIgPQorCQkJdTY0X3RvX3VzZXJfcHRyKHVzZXJfcmVnc19wdHIgKyBzaXplb2YodTMy
KSAqIHIgKiAyKTsKKwkJdTMyIF9fdXNlciAqdXNlcl92YWxfcHRyID0KKwkJCXU2NF90b191c2Vy
X3B0cih1c2VyX3JlZ3NfcHRyICsgc2l6ZW9mKHUzMikgKiByICogMiArCisJCQkJCXNpemVvZih1
MzIpKTsKKwkJaW50IHJldDsKKworCQlyZXQgPSBfX3B1dF91c2VyKGk5MTVfbW1pb19yZWdfb2Zm
c2V0KGtlcm5lbF9yZWdzW3JdLmFkZHIpLAorCQkJCSB1c2VyX3JlZ19wdHIpOworCQlpZiAocmV0
KQorCQkJcmV0dXJuIC1FRkFVTFQ7CisKKwkJcmV0ID0gX19wdXRfdXNlcihrZXJuZWxfcmVnc1ty
XS52YWx1ZSwgdXNlcl92YWxfcHRyKTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiAtRUZBVUxUOwor
CX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IHF1ZXJ5X3BlcmZfY29uZmlnX2RhdGEo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCisJCQkJICBzdHJ1Y3QgZHJtX2k5MTVfcXVl
cnlfaXRlbSAqcXVlcnlfaXRlbSwKKwkJCQkgIGJvb2wgdXNlX3V1aWQpCit7CisJc3RydWN0IGRy
bV9pOTE1X3F1ZXJ5X3BlcmZfY29uZmlnIF9fdXNlciAqdXNlcl9xdWVyeV9jb25maWdfcHRyID0K
KwkJdTY0X3RvX3VzZXJfcHRyKHF1ZXJ5X2l0ZW0tPmRhdGFfcHRyKTsKKwlzdHJ1Y3QgZHJtX2k5
MTVfcGVyZl9vYV9jb25maWcgX191c2VyICp1c2VyX2NvbmZpZ19wdHIgPQorCQl1NjRfdG9fdXNl
cl9wdHIocXVlcnlfaXRlbS0+ZGF0YV9wdHIgKworCQkJCXNpemVvZihzdHJ1Y3QgZHJtX2k5MTVf
cXVlcnlfcGVyZl9jb25maWcpKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcGVyZl9vYV9jb25maWcgdXNl
cl9jb25maWc7CisJc3RydWN0IGk5MTVfb2FfY29uZmlnICpvYV9jb25maWcgPSBOVUxMOworCXUz
MiBmbGFncywgdG90YWxfc2l6ZTsKKwlpbnQgcmV0OworCisJaWYgKCFpOTE1LT5wZXJmLmluaXRp
YWxpemVkKQorCQlyZXR1cm4gLUVOT0RFVjsKKworCXRvdGFsX3NpemUgPSBzaXplb2Yoc3RydWN0
IGRybV9pOTE1X3F1ZXJ5X3BlcmZfY29uZmlnKSArCisJCXNpemVvZihzdHJ1Y3QgZHJtX2k5MTVf
cGVyZl9vYV9jb25maWcpOworCisJaWYgKHF1ZXJ5X2l0ZW0tPmxlbmd0aCA9PSAwKQorCQlyZXR1
cm4gdG90YWxfc2l6ZTsKKworCWlmIChxdWVyeV9pdGVtLT5sZW5ndGggPCB0b3RhbF9zaXplKSB7
CisJCURSTV9ERUJVRygiSW52YWxpZCBxdWVyeSBjb25maWcgZGF0YSBpdGVtIHNpemU9JXUgZXhw
ZWN0ZWQ9JXVcbiIsCisJCQkgIHF1ZXJ5X2l0ZW0tPmxlbmd0aCwgdG90YWxfc2l6ZSk7CisJCXJl
dHVybiAtRUlOVkFMOworCX0KKworCWlmICghYWNjZXNzX29rKHVzZXJfcXVlcnlfY29uZmlnX3B0
ciwgdG90YWxfc2l6ZSkpCisJCXJldHVybiAtRUZBVUxUOworCisJaWYgKF9fZ2V0X3VzZXIoZmxh
Z3MsICZ1c2VyX3F1ZXJ5X2NvbmZpZ19wdHItPmZsYWdzKSkKKwkJcmV0dXJuIC1FRkFVTFQ7CisK
KwlpZiAoZmxhZ3MgIT0gMCkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlyZXQgPSBtdXRleF9sb2Nr
X2ludGVycnVwdGlibGUoJmk5MTUtPnBlcmYubWV0cmljc19sb2NrKTsKKwlpZiAocmV0KQorCQly
ZXR1cm4gcmV0OworCisJaWYgKHVzZV91dWlkKSB7CisJCWNoYXIgdXVpZFtVVUlEX1NUUklOR19M
RU4gKyAxXSA9IHsgMCwgfTsKKwkJc3RydWN0IGk5MTVfb2FfY29uZmlnICp0bXA7CisJCWludCBp
ZDsKKworCQlCVUlMRF9CVUdfT04oc2l6ZW9mKHVzZXJfcXVlcnlfY29uZmlnX3B0ci0+dXVpZCkg
Pj0gc2l6ZW9mKHV1aWQpKTsKKworCQlpZiAoX19jb3B5X2Zyb21fdXNlcih1dWlkLCB1c2VyX3F1
ZXJ5X2NvbmZpZ19wdHItPnV1aWQsCisJCQkJICAgICBzaXplb2YodXNlcl9xdWVyeV9jb25maWdf
cHRyLT51dWlkKSkpIHsKKwkJCXJldCA9IC1FRkFVTFQ7CisJCQlnb3RvIG91dDsKKwkJfQorCisJ
CWlkcl9mb3JfZWFjaF9lbnRyeSgmaTkxNS0+cGVyZi5tZXRyaWNzX2lkciwgdG1wLCBpZCkgewor
CQkJaWYgKCFzdHJjbXAodG1wLT51dWlkLCB1dWlkKSkgeworCQkJCW9hX2NvbmZpZyA9IHRtcDsK
KwkJCQlicmVhazsKKwkJCX0KKwkJfQorCX0gZWxzZSB7CisJCXU2NCBjb25maWdfaWQ7CisKKwkJ
aWYgKF9fZ2V0X3VzZXIoY29uZmlnX2lkLCAmdXNlcl9xdWVyeV9jb25maWdfcHRyLT5jb25maWcp
KQorCQkJcmV0dXJuIC1FRkFVTFQ7CisKKwkJaWYgKGNvbmZpZ19pZCA9PSAxKQorCQkJb2FfY29u
ZmlnID0gJmk5MTUtPnBlcmYub2EudGVzdF9jb25maWc7CisJCWVsc2UKKwkJCW9hX2NvbmZpZyA9
IGlkcl9maW5kKCZpOTE1LT5wZXJmLm1ldHJpY3NfaWRyLCBjb25maWdfaWQpOworCX0KKworCWlm
ICghb2FfY29uZmlnKSB7CisJCXJldCA9IC1FTk9FTlQ7CisJCWdvdG8gb3V0OworCX0KKworCWlm
IChfX2NvcHlfZnJvbV91c2VyKCZ1c2VyX2NvbmZpZywgdXNlcl9jb25maWdfcHRyLAorCQkJICAg
ICBzaXplb2YodXNlcl9jb25maWcpKSkgeworCQlyZXQgPSAtRUZBVUxUOworCQlnb3RvIG91dDsK
Kwl9CisKKwlyZXQgPSBjYW5fY29weV9wZXJmX2NvbmZpZ19yZWdpc3RlcnNfb3JfbnVtYmVyKHVz
ZXJfY29uZmlnLm5fYm9vbGVhbl9yZWdzLAorCQkJCQkJICAgICAgIHVzZXJfY29uZmlnLmJvb2xl
YW5fcmVnc19wdHIsCisJCQkJCQkgICAgICAgb2FfY29uZmlnLT5iX2NvdW50ZXJfcmVnc19sZW4p
OworCWlmIChyZXQpCisJCWdvdG8gb3V0OworCisJcmV0ID0gY2FuX2NvcHlfcGVyZl9jb25maWdf
cmVnaXN0ZXJzX29yX251bWJlcih1c2VyX2NvbmZpZy5uX2ZsZXhfcmVncywKKwkJCQkJCSAgICAg
ICB1c2VyX2NvbmZpZy5mbGV4X3JlZ3NfcHRyLAorCQkJCQkJICAgICAgIG9hX2NvbmZpZy0+Zmxl
eF9yZWdzX2xlbik7CisJaWYgKHJldCkKKwkJZ290byBvdXQ7CisKKwlyZXQgPSBjYW5fY29weV9w
ZXJmX2NvbmZpZ19yZWdpc3RlcnNfb3JfbnVtYmVyKHVzZXJfY29uZmlnLm5fbXV4X3JlZ3MsCisJ
CQkJCQkgICAgICAgdXNlcl9jb25maWcubXV4X3JlZ3NfcHRyLAorCQkJCQkJICAgICAgIG9hX2Nv
bmZpZy0+bXV4X3JlZ3NfbGVuKTsKKwlpZiAocmV0KQorCQlnb3RvIG91dDsKKworCXJldCA9IGNv
cHlfcGVyZl9jb25maWdfcmVnaXN0ZXJzX29yX251bWJlcihvYV9jb25maWctPmJfY291bnRlcl9y
ZWdzLAorCQkJCQkJICAgb2FfY29uZmlnLT5iX2NvdW50ZXJfcmVnc19sZW4sCisJCQkJCQkgICB1
c2VyX2NvbmZpZy5ib29sZWFuX3JlZ3NfcHRyLAorCQkJCQkJICAgJnVzZXJfY29uZmlnLm5fYm9v
bGVhbl9yZWdzKTsKKwlpZiAocmV0KQorCQlnb3RvIG91dDsKKworCXJldCA9IGNvcHlfcGVyZl9j
b25maWdfcmVnaXN0ZXJzX29yX251bWJlcihvYV9jb25maWctPmZsZXhfcmVncywKKwkJCQkJCSAg
IG9hX2NvbmZpZy0+ZmxleF9yZWdzX2xlbiwKKwkJCQkJCSAgIHVzZXJfY29uZmlnLmZsZXhfcmVn
c19wdHIsCisJCQkJCQkgICAmdXNlcl9jb25maWcubl9mbGV4X3JlZ3MpOworCWlmIChyZXQpCisJ
CWdvdG8gb3V0OworCisJcmV0ID0gY29weV9wZXJmX2NvbmZpZ19yZWdpc3RlcnNfb3JfbnVtYmVy
KG9hX2NvbmZpZy0+bXV4X3JlZ3MsCisJCQkJCQkgICBvYV9jb25maWctPm11eF9yZWdzX2xlbiwK
KwkJCQkJCSAgIHVzZXJfY29uZmlnLm11eF9yZWdzX3B0ciwKKwkJCQkJCSAgICZ1c2VyX2NvbmZp
Zy5uX211eF9yZWdzKTsKKwlpZiAocmV0KQorCQlnb3RvIG91dDsKKworCW1lbWNweSh1c2VyX2Nv
bmZpZy51dWlkLCBvYV9jb25maWctPnV1aWQsIHNpemVvZih1c2VyX2NvbmZpZy51dWlkKSk7CisK
KwlpZiAoX19jb3B5X3RvX3VzZXIodXNlcl9jb25maWdfcHRyLCAmdXNlcl9jb25maWcsCisJCQkg
ICBzaXplb2YodXNlcl9jb25maWcpKSkgeworCQlyZXQgPSAtRUZBVUxUOworCQlnb3RvIG91dDsK
Kwl9CisKKwlyZXQgPSB0b3RhbF9zaXplOworCitvdXQ6CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5w
ZXJmLm1ldHJpY3NfbG9jayk7CisJcmV0dXJuIHJldDsKK30KKworc3RhdGljIGludCBxdWVyeV9w
ZXJmX2NvbmZpZ19saXN0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAorCQkJCSAgc3Ry
dWN0IGRybV9pOTE1X3F1ZXJ5X2l0ZW0gKnF1ZXJ5X2l0ZW0pCit7CisJc3RydWN0IGRybV9pOTE1
X3F1ZXJ5X3BlcmZfY29uZmlnIF9fdXNlciAqdXNlcl9xdWVyeV9jb25maWdfcHRyID0KKwkJdTY0
X3RvX3VzZXJfcHRyKHF1ZXJ5X2l0ZW0tPmRhdGFfcHRyKTsKKwlzdHJ1Y3QgaTkxNV9vYV9jb25m
aWcgKm9hX2NvbmZpZzsKKwl1MzIgZmxhZ3MsIHRvdGFsX3NpemU7CisJdTY0IG5fY29uZmlnczsK
KwlpbnQgcmV0LCBpZDsKKworCWlmICghaTkxNS0+cGVyZi5pbml0aWFsaXplZCkKKwkJcmV0dXJu
IC1FTk9ERVY7CisKKwkvKiBDb3VudCB0aGUgZGVmYXVsdCB0ZXN0IGNvbmZpZ3VyYXRpb24gKi8K
KwluX2NvbmZpZ3MgPSBpOTE1LT5wZXJmLm5fbWV0cmljcyArIDE7CisJdG90YWxfc2l6ZSA9IHNp
emVvZihzdHJ1Y3QgZHJtX2k5MTVfcXVlcnlfcGVyZl9jb25maWcpICsKKwkJc2l6ZW9mKHU2NCkg
KiBuX2NvbmZpZ3M7CisKKwlpZiAocXVlcnlfaXRlbS0+bGVuZ3RoID09IDApCisJCXJldHVybiB0
b3RhbF9zaXplOworCisJaWYgKHF1ZXJ5X2l0ZW0tPmxlbmd0aCA8IHRvdGFsX3NpemUpIHsKKwkJ
RFJNX0RFQlVHKCJJbnZhbGlkIHF1ZXJ5IGNvbmZpZyBsaXN0IGl0ZW0gc2l6ZT0ldSBleHBlY3Rl
ZD0ldVxuIiwKKwkJCSAgcXVlcnlfaXRlbS0+bGVuZ3RoLCB0b3RhbF9zaXplKTsKKwkJcmV0dXJu
IC1FSU5WQUw7CisJfQorCisJaWYgKCFhY2Nlc3Nfb2sodXNlcl9xdWVyeV9jb25maWdfcHRyLCB0
b3RhbF9zaXplKSkKKwkJcmV0dXJuIC1FRkFVTFQ7CisKKwlpZiAoX19nZXRfdXNlcihmbGFncywg
JnVzZXJfcXVlcnlfY29uZmlnX3B0ci0+ZmxhZ3MpKQorCQlyZXR1cm4gLUVGQVVMVDsKKworCWlm
IChmbGFncyAhPSAwKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWlmIChfX3B1dF91c2VyKG5fY29u
ZmlncywgJnVzZXJfcXVlcnlfY29uZmlnX3B0ci0+Y29uZmlnKSkKKwkJcmV0dXJuIC1FRkFVTFQ7
CisKKwlpZiAoX19wdXRfdXNlcigodTY0KTFVTEwsICZ1c2VyX3F1ZXJ5X2NvbmZpZ19wdHItPmRh
dGFbMF0pKQorCQlyZXR1cm4gLUVGQVVMVDsKKworCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0
aWJsZSgmaTkxNS0+cGVyZi5tZXRyaWNzX2xvY2spOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7
CisKKwluX2NvbmZpZ3MgPSAxOworCWlkcl9mb3JfZWFjaF9lbnRyeSgmaTkxNS0+cGVyZi5tZXRy
aWNzX2lkciwgb2FfY29uZmlnLCBpZCkgeworCQl1NjQgX191c2VyICppdGVtID0KKwkJCXU2NF90
b191c2VyX3B0cihxdWVyeV9pdGVtLT5kYXRhX3B0ciArCisJCQkJCXNpemVvZihzdHJ1Y3QgZHJt
X2k5MTVfcXVlcnlfcGVyZl9jb25maWcpICsKKwkJCQkJbl9jb25maWdzICogc2l6ZW9mKHU2NCkp
OworCisJCWlmIChfX3B1dF91c2VyKCh1NjQpaWQsIGl0ZW0pKSB7CisJCQlyZXQgPSAtRUZBVUxU
OworCQkJZ290byBvdXQ7CisJCX0KKwkJbl9jb25maWdzKys7CisJfQorCisJcmV0ID0gdG90YWxf
c2l6ZTsKKworb3V0OgorCW11dGV4X3VubG9jaygmaTkxNS0+cGVyZi5tZXRyaWNzX2xvY2spOwor
CXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBpbnQgcXVlcnlfcGVyZl9jb25maWcoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCisJCQkgICAgIHN0cnVjdCBkcm1faTkxNV9xdWVyeV9pdGVt
ICpxdWVyeV9pdGVtKQoreworCXN3aXRjaCAocXVlcnlfaXRlbS0+ZmxhZ3MpIHsKKwljYXNlIERS
TV9JOTE1X1FVRVJZX1BFUkZfQ09ORklHX0xJU1Q6CisJCXJldHVybiBxdWVyeV9wZXJmX2NvbmZp
Z19saXN0KGk5MTUsIHF1ZXJ5X2l0ZW0pOworCWNhc2UgRFJNX0k5MTVfUVVFUllfUEVSRl9DT05G
SUdfREFUQV9GT1JfVVVJRDoKKwkJcmV0dXJuIHF1ZXJ5X3BlcmZfY29uZmlnX2RhdGEoaTkxNSwg
cXVlcnlfaXRlbSwgdHJ1ZSk7CisJY2FzZSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NPTkZJR19EQVRB
X0ZPUl9JRDoKKwkJcmV0dXJuIHF1ZXJ5X3BlcmZfY29uZmlnX2RhdGEoaTkxNSwgcXVlcnlfaXRl
bSwgZmFsc2UpOworCWRlZmF1bHQ6CisJCXJldHVybiAtRUlOVkFMOworCX0KK30KKwogc3RhdGlj
IGludCAoKiBjb25zdCBpOTE1X3F1ZXJ5X2Z1bmNzW10pKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIAkJCQkJc3RydWN0IGRybV9pOTE1X3F1ZXJ5X2l0ZW0gKnF1ZXJ5X2l0ZW0p
ID0gewogCXF1ZXJ5X3RvcG9sb2d5X2luZm8sCisJcXVlcnlfcGVyZl9jb25maWcsCiB9OwogCiBp
bnQgaTkxNV9xdWVyeV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLCBz
dHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCmRpZmYgLS1naXQgYS9pbmNsdWRlL3VhcGkvZHJtL2k5MTVf
ZHJtLmggYi9pbmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJtLmgKaW5kZXggZTU3ZmI1ZjI0OWRhLi5h
YWZlN2EzNTY5ZWYgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaAorKysg
Yi9pbmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJtLmgKQEAgLTE4NjksNiArMTg2OSw3IEBAIHN0cnVj
dCBkcm1faTkxNV9wZXJmX29hX2NvbmZpZyB7CiBzdHJ1Y3QgZHJtX2k5MTVfcXVlcnlfaXRlbSB7
CiAJX191NjQgcXVlcnlfaWQ7CiAjZGVmaW5lIERSTV9JOTE1X1FVRVJZX1RPUE9MT0dZX0lORk8g
ICAgMQorI2RlZmluZSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NPTkZJRyAgICAgIDIKIC8qIE11c3Qg
YmUga2VwdCBjb21wYWN0IC0tIG5vIGhvbGVzIGFuZCB3ZWxsIGRvY3VtZW50ZWQgKi8KIAogCS8q
CkBAIC0xODgwLDkgKzE4ODEsMTggQEAgc3RydWN0IGRybV9pOTE1X3F1ZXJ5X2l0ZW0gewogCV9f
czMyIGxlbmd0aDsKIAogCS8qCi0JICogVW51c2VkIGZvciBub3cuIE11c3QgYmUgY2xlYXJlZCB0
byB6ZXJvLgorCSAqIFdoZW4gcXVlcnlfaWQgPT0gRFJNX0k5MTVfUVVFUllfVE9QT0xPR1lfSU5G
TywgbXVzdCBiZSAwLgorCSAqCisJICogV2hlbiBxdWVyeV9pZCA9PSBEUk1fSTkxNV9RVUVSWV9Q
RVJGX0NPTkZJRywgbXVzdCBiZSBvbmUgb2YgdGhlCisJICogZm9sbG93aW5nIDoKKwkgKiAgICAg
ICAgIC0gRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfTElTVAorCSAqICAgICAgICAgLSBEUk1f
STkxNV9RVUVSWV9QRVJGX0NPTkZJR19EQVRBX0ZPUl9VVUlECisJICogICAgICAgICAtIERSTV9J
OTE1X1FVRVJZX1BFUkZfQ09ORklHX0ZPUl9VVUlECiAJICovCiAJX191MzIgZmxhZ3M7CisjZGVm
aW5lIERSTV9JOTE1X1FVRVJZX1BFUkZfQ09ORklHX0xJU1QgICAgICAgICAgMQorI2RlZmluZSBE
Uk1fSTkxNV9RVUVSWV9QRVJGX0NPTkZJR19EQVRBX0ZPUl9VVUlEIDIKKyNkZWZpbmUgRFJNX0k5
MTVfUVVFUllfUEVSRl9DT05GSUdfREFUQV9GT1JfSUQgICAzCiAKIAkvKgogCSAqIERhdGEgd2ls
bCBiZSB3cml0dGVuIGF0IHRoZSBsb2NhdGlvbiBwb2ludGVkIGJ5IGRhdGFfcHRyIHdoZW4gdGhl
CkBAIC0xOTY3LDYgKzE5NzcsNTYgQEAgc3RydWN0IGRybV9pOTE1X3F1ZXJ5X3RvcG9sb2d5X2lu
Zm8gewogCV9fdTggZGF0YVtdOwogfTsKIAorLyoKKyAqIERhdGEgd3JpdHRlbiBieSB0aGUga2Vy
bmVsIHdpdGggcXVlcnkgRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUcuCisgKi8KK3N0cnVjdCBk
cm1faTkxNV9xdWVyeV9wZXJmX2NvbmZpZyB7CisJdW5pb24geworCQkvKgorCQkgKiBXaGVuIHF1
ZXJ5X2l0ZW0uZmxhZ3MgPT0gRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfTElTVCwgaTkxNSBz
ZXRzCisJCSAqIHRoaXMgZmllbGRzIHRvIHRoZSBudW1iZXIgb2YgY29uZmlndXJhdGlvbnMgYXZh
aWxhYmxlLgorCQkgKi8KKwkJX191NjQgbl9jb25maWdzOworCisJCS8qCisJCSAqIFdoZW4gcXVl
cnlfaWQgPT0gRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfREFUQV9GT1JfSUQsCisJCSAqIGk5
MTUgd2lsbCB1c2UgdGhlIHZhbHVlIGluIHRoaXMgZmllbGQgYXMgY29uZmlndXJhdGlvbgorCQkg
KiBpZGVudGlmaWVyIHRvIGRlY2lkZSB3aGF0IGRhdGEgdG8gd3JpdGUgaW50byBjb25maWdfcHRy
LgorCQkgKi8KKwkJX191NjQgY29uZmlnOworCisJCS8qCisJCSAqIFdoZW4gcXVlcnlfaWQgPT0g
RFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfREFUQV9GT1JfVVVJRCwKKwkJICogaTkxNSB3aWxs
IHVzZSB0aGUgdmFsdWUgaW4gdGhpcyBmaWVsZCBhcyBjb25maWd1cmF0aW9uCisJCSAqIGlkZW50
aWZpZXIgdG8gZGVjaWRlIHdoYXQgZGF0YSB0byB3cml0ZSBpbnRvIGNvbmZpZ19wdHIuCisJCSAq
CisJCSAqIFN0cmluZyBmb3JtYXR0ZWQgbGlrZSAiJTA4eC0lMDR4LSUwNHgtJTA0eC0lMDEyeCIK
KwkJICovCisJCWNoYXIgdXVpZFszNl07CisJfTsKKworCS8qCisJICogVW51c2VkIGZvciBub3cu
IE11c3QgYmUgY2xlYXJlZCB0byB6ZXJvLgorCSAqLworCV9fdTMyIGZsYWdzOworCisJLyoKKwkg
KiBXaGVuIHF1ZXJ5X2l0ZW0uZmxhZ3MgPT0gRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfTElT
VCwgaTkxNSB3aWxsCisJICogd3JpdGUgYW4gYXJyYXkgb2YgX191NjQgb2YgY29uZmlndXJhdGlv
biBpZGVudGlmaWVycy4KKwkgKgorCSAqIFdoZW4gcXVlcnlfaXRlbS5mbGFncyA9PSBEUk1fSTkx
NV9RVUVSWV9QRVJGX0NPTkZJR19EQVRBLCBpOTE1IHdpbGwKKwkgKiB3cml0ZSBhIHN0cnVjdCBk
cm1faTkxNV9wZXJmX29hX2NvbmZpZy4gSWYgdGhlIGZvbGxvd2luZyBmaWVsZHMgb2YKKwkgKiBk
cm1faTkxNV9wZXJmX29hX2NvbmZpZyBhcmUgc2V0IG5vdCBzZXQgdG8gMCwgaTkxNSB3aWxsIHdy
aXRlIGludG8KKwkgKiB0aGUgYXNzb2NpYXRlZCBwb2ludGVycyB0aGUgdmFsdWVzIG9mIHN1Ym1p
dHRlZCB3aGVuIHRoZQorCSAqIGNvbmZpZ3VyYXRpb24gd2FzIGNyZWF0ZWQgOgorCSAqCisJICog
ICAgICAgICAtIG5fbXV4X3JlZ3MKKwkgKiAgICAgICAgIC0gbl9ib29sZWFuX3JlZ3MKKwkgKiAg
ICAgICAgIC0gbl9mbGV4X3JlZ3MKKwkgKi8KKwlfX3U4IGRhdGFbXTsKK307CisKICNpZiBkZWZp
bmVkKF9fY3BsdXNwbHVzKQogfQogI2VuZGlmCi0tIAoyLjIxLjAuMzkyLmdmOGY2Nzg3MTU5ZQoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4
IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

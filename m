Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3274B2DC079
	for <lists+intel-gfx@lfdr.de>; Wed, 16 Dec 2020 13:48:20 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C11DC6E1A7;
	Wed, 16 Dec 2020 12:48:15 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga01.intel.com (mga01.intel.com [192.55.52.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1D91C6E1A7
 for <intel-gfx@lists.freedesktop.org>; Wed, 16 Dec 2020 12:48:14 +0000 (UTC)
IronPort-SDR: 9ufpSd6RWdkTve9spry68AX7Pt9fnstA6pv10dLVe9JbwCgfojEY1HWxAyoZMlCvB6+b15Sy1K
 LJPZGKNchp5w==
X-IronPort-AV: E=McAfee;i="6000,8403,9836"; a="193439864"
X-IronPort-AV: E=Sophos;i="5.78,424,1599548400"; d="scan'208";a="193439864"
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by fmsmga101.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 16 Dec 2020 04:48:13 -0800
IronPort-SDR: iBmC7vinT8d50aVe4L7olZZpaya4X9GMvl3Lk+QvdDN+Uwrzdca2BRCYAtPLoVFkjEp3jRnC/P
 s/Y6m1E5CJ2g==
X-IronPort-AV: E=Sophos;i="5.78,424,1599548400"; d="scan'208";a="369038363"
Received: from helsinki.fi.intel.com ([10.237.66.162])
 by orsmga008-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 16 Dec 2020 04:48:11 -0800
From: Gwan-gyeong Mun <gwan-gyeong.mun@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 16 Dec 2020 14:47:42 +0200
Message-Id: <20201216124743.431148-1-gwan-gyeong.mun@intel.com>
X-Mailer: git-send-email 2.25.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v7 1/2] drm/i915/display: Support PSR Multiple
 Transcoders
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SXQgaXMgYSBwcmVsaW1pbmFyeSB3b3JrIGZvciBzdXBwb3J0aW5nIG11bHRpcGxlIEVEUCBQU1Ig
YW5kCkRQIFBhbmVsUmVwbGF5LiBBbmQgaXQgcmVmYWN0b3JzIHNpbmdsZXRvbiBQU1IgdG8gTXVs
dGkgVHJhbnNjb2RlcgpzdXBwb3J0YWJsZSBQU1IuCkFuZCB0aGlzIG1vdmVzIGFuZCByZW5hbWVz
IHRoZSBpOTE1X3BzciBzdHJ1Y3R1cmUgb2YgZHJtX2k5MTVfcHJpdmF0ZSdzIHRvCmludGVsX2Rw
J3MgaW50ZWxfcHNyIHN0cnVjdHVyZS4KSXQgYWxzbyBjYXVzZXMgY2hhbmdlcyBpbiBQU1IgaW50
ZXJydXB0IGhhbmRsaW5nIHJvdXRpbmUgZm9yIHN1cHBvcnRpbmcKbXVsdGlwbGUgdHJhbnNjb2Rl
cnMuIEJ1dCBpdCBkb2VzIG5vdCBjaGFuZ2UgdGhlIHNjZW5hcmlvIGFuZCB0aW1pbmcgb2YKZW5h
YmxpbmcgYW5kIGRpc2FibGluZyBQU1IuIEFuZCBpdCBub3Qgc3VwcG9ydCBtdWx0aXBsZSBwaXBl
cyB3aXRoCmEgc2luZ2xlIHRyYW5zY29kZXIgUFNSIGNhc2UgeWV0LgoKdjI6IEZpeCBpbmRlbnRh
dGlvbiBhbmQgYWRkIGNvbW1lbnRzCnYzOiBSZW1vdmUgQmxhbmsgbGluZQp2NDogUmViYXNlZAp2
NTogUmViYXNlZCBhbmQgQWRkcmVzc2VkIEFuc2h1bWFuJ3MgcmV2aWV3IGNvbW1lbnQuCiAgICAt
IE1vdmUgY2FsbGluZyBvZiBpbnRlbF9wc3JfaW5pdCgpIHRvIGludGVsX2RwX2luaXRfY29ubmVj
dG9yKCkKdjY6IEFkZHJlc3MgQW5zaHVtYW4ncyByZXZpZXcgY29tbWVudHMKICAgLSBSZW1vdmUg
d3JvbmcgY29tbWVudHMgYW5kIGFkZCBjb21tZW50cyBmb3IgYSBsaW1pdCBvZiBzdXBwb3J0aW5n
IG9mCiAgICAgYSBzaW5nbGUgcGlwZSBQU1IKdjc6IFVwZGF0ZSBpbnRlbF9wc3JfY29tcHV0ZV9j
b25maWcoKSBmb3Igc3VwcG9ydGluZyBtdWx0aXBsZSB0cmFuc2NvZGVyCiAgICBQU1Igb24gQkRX
KwoKU2lnbmVkLW9mZi1ieTogR3dhbi1neWVvbmcgTXVuIDxnd2FuLWd5ZW9uZy5tdW5AaW50ZWwu
Y29tPgpDYzogSm9zw6kgUm9iZXJ0byBkZSBTb3V6YSA8am9zZS5zb3V6YUBpbnRlbC5jb20+CkNj
OiBKdWhhLVBla2thIEhlaWtraWxhIDxqdWhhcGVra2EuaGVpa2tpbGFAZ21haWwuY29tPgpDYzog
QW5zaHVtYW4gR3VwdGEgPGFuc2h1bWFuLmd1cHRhQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jICAgICAgfCAgIDMgKwogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgIHwgICA0IC0KIC4uLi9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXlfZGVidWdmcy5jICB8IDExMSArKy0tCiAuLi4vZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggICAgfCAgMzggKysKIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYyAgICAgICB8ICAyMyArLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYyAgICAgIHwgNTg4ICsrKysrKysrKy0tLS0tLS0tLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuaCAgICAgIHwgIDE0ICstCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jICAgfCAgIDYgKy0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggICAgICAgICAgICAgICB8ICAzOCAtLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuYyAgICAgICAgICAgICAgIHwgIDQ5ICstCiAxMCBm
aWxlcyBjaGFuZ2VkLCA0OTAgaW5zZXJ0aW9ucygrKSwgMzg0IGRlbGV0aW9ucygtKQoKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCmluZGV4IDY4NjMyMzZkZjFkMC4uNGI4
N2Y3MmNiOWMwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2RkaS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMKQEAg
LTQzMjAsNyArNDMyMCwxMCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kZGlfdXBkYXRlX3BpcGVfZHAo
c3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAKIAlpbnRlbF9kZGlfc2V0X2RwX21z
YShjcnRjX3N0YXRlLCBjb25uX3N0YXRlKTsKIAorCS8vVE9ETzogbW92ZSBQU1IgcmVsYXRlZCBm
dW5jdGlvbnMgaW50byBpbnRlbF9wc3JfdXBkYXRlKCkKKwlpbnRlbF9wc3IyX3Byb2dyYW1fdHJh
bnNfbWFuX3Rya19jdGwoaW50ZWxfZHAsIGNydGNfc3RhdGUpOwogCWludGVsX3Bzcl91cGRhdGUo
aW50ZWxfZHAsIGNydGNfc3RhdGUsIGNvbm5fc3RhdGUpOworCiAJaW50ZWxfZHBfc2V0X2luZm9m
cmFtZXMoZW5jb2RlciwgdHJ1ZSwgY3J0Y19zdGF0ZSwgY29ubl9zdGF0ZSk7CiAJaW50ZWxfZWRw
X2RycnNfdXBkYXRlKGludGVsX2RwLCBjcnRjX3N0YXRlKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRleCA3ODQ1MmRlNWUxMmYuLmE3NTM2NDdi
MGJjYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMK
QEAgLTE1ODY5LDggKzE1ODY5LDYgQEAgc3RhdGljIHZvaWQgY29tbWl0X3BpcGVfY29uZmlnKHN0
cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCiAJCWlmIChuZXdfY3J0Y19zdGF0ZS0+
dXBkYXRlX3BpcGUpCiAJCQlpbnRlbF9waXBlX2Zhc3RzZXQob2xkX2NydGNfc3RhdGUsIG5ld19j
cnRjX3N0YXRlKTsKLQotCQlpbnRlbF9wc3IyX3Byb2dyYW1fdHJhbnNfbWFuX3Rya19jdGwobmV3
X2NydGNfc3RhdGUpOwogCX0KIAogCWlmIChkZXZfcHJpdi0+ZGlzcGxheS5hdG9taWNfdXBkYXRl
X3dhdGVybWFya3MpCkBAIC0xNzgyOSw4ICsxNzgyNyw2IEBAIHN0YXRpYyB2b2lkIGludGVsX3Nl
dHVwX291dHB1dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlpbnRlbF9k
dm9faW5pdChkZXZfcHJpdik7CiAJfQogCi0JaW50ZWxfcHNyX2luaXQoZGV2X3ByaXYpOwotCiAJ
Zm9yX2VhY2hfaW50ZWxfZW5jb2RlcigmZGV2X3ByaXYtPmRybSwgZW5jb2RlcikgewogCQllbmNv
ZGVyLT5iYXNlLnBvc3NpYmxlX2NydGNzID0KIAkJCWludGVsX2VuY29kZXJfcG9zc2libGVfY3J0
Y3MoZW5jb2Rlcik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2Rpc3BsYXlfZGVidWdmcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kaXNwbGF5X2RlYnVnZnMuYwppbmRleCBjZDdlNTUxOWVlN2QuLjA0MTA1MzE2N2Q3ZiAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X2RlYnVn
ZnMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfZGVi
dWdmcy5jCkBAIC0yNDksMTggKzI0OSwxNyBAQCBzdGF0aWMgaW50IGk5MTVfcHNyX3Npbmtfc3Rh
dHVzX3Nob3coc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCQkic2luayBpbnRlcm5h
bCBlcnJvciIsCiAJfTsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gbS0+cHJp
dmF0ZTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5l
Y3Rvci0+ZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0KIAkJaW50ZWxfYXR0YWNo
ZWRfZHAodG9faW50ZWxfY29ubmVjdG9yKGNvbm5lY3RvcikpOwogCWludCByZXQ7CiAKLQlpZiAo
IUNBTl9QU1IoZGV2X3ByaXYpKSB7Ci0JCXNlcV9wdXRzKG0sICJQU1IgVW5zdXBwb3J0ZWRcbiIp
OworCWlmIChjb25uZWN0b3ItPnN0YXR1cyAhPSBjb25uZWN0b3Jfc3RhdHVzX2Nvbm5lY3RlZCkK
IAkJcmV0dXJuIC1FTk9ERVY7Ci0JfQogCi0JaWYgKGNvbm5lY3Rvci0+c3RhdHVzICE9IGNvbm5l
Y3Rvcl9zdGF0dXNfY29ubmVjdGVkKQorCWlmICghQ0FOX1BTUihpbnRlbF9kcCkpIHsKKwkJc2Vx
X3B1dHMobSwgIlBTUiBVbnN1cHBvcnRlZFxuIik7CiAJCXJldHVybiAtRU5PREVWOworCX0KIAog
CXJldCA9IGRybV9kcF9kcGNkX3JlYWRiKCZpbnRlbF9kcC0+YXV4LCBEUF9QU1JfU1RBVFVTLCAm
dmFsKTsKIApAQCAtMjgwLDEyICsyNzksMTMgQEAgc3RhdGljIGludCBpOTE1X3Bzcl9zaW5rX3N0
YXR1c19zaG93KHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKIERFRklORV9TSE9XX0FU
VFJJQlVURShpOTE1X3Bzcl9zaW5rX3N0YXR1cyk7CiAKIHN0YXRpYyB2b2lkCi1wc3Jfc291cmNl
X3N0YXR1cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHN0cnVjdCBzZXFfZmls
ZSAqbSkKK3Bzcl9zb3VyY2Vfc3RhdHVzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIHN0cnVj
dCBzZXFfZmlsZSAqbSkKIHsKIAl1MzIgdmFsLCBzdGF0dXNfdmFsOwogCWNvbnN0IGNoYXIgKnN0
YXR1cyA9ICJ1bmtub3duIjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBk
cF90b19pOTE1KGludGVsX2RwKTsKIAotCWlmIChkZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxlZCkg
eworCWlmIChpbnRlbF9kcC0+cHNyLnBzcjJfZW5hYmxlZCkgewogCQlzdGF0aWMgY29uc3QgY2hh
ciAqIGNvbnN0IGxpdmVfc3RhdHVzW10gPSB7CiAJCQkiSURMRSIsCiAJCQkiQ0FQVFVSRSIsCkBA
IC0zMDAsNyArMzAwLDcgQEAgcHNyX3NvdXJjZV9zdGF0dXMoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LCBzdHJ1Y3Qgc2VxX2ZpbGUgKm0pCiAJCQkiVEdfT04iCiAJCX07CiAJCXZh
bCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsCi0JCQkJICAgIEVEUF9QU1IyX1NUQVRVUyhkZXZf
cHJpdi0+cHNyLnRyYW5zY29kZXIpKTsKKwkJCQkgICAgRURQX1BTUjJfU1RBVFVTKGludGVsX2Rw
LT5wc3IudHJhbnNjb2RlcikpOwogCQlzdGF0dXNfdmFsID0gKHZhbCAmIEVEUF9QU1IyX1NUQVRV
U19TVEFURV9NQVNLKSA+PgogCQkJICAgICAgRURQX1BTUjJfU1RBVFVTX1NUQVRFX1NISUZUOwog
CQlpZiAoc3RhdHVzX3ZhbCA8IEFSUkFZX1NJWkUobGl2ZV9zdGF0dXMpKQpAQCAtMzE3LDcgKzMx
Nyw3IEBAIHBzcl9zb3VyY2Vfc3RhdHVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwgc3RydWN0IHNlcV9maWxlICptKQogCQkJIlNSREVOVF9PTiIsCiAJCX07CiAJCXZhbCA9IGlu
dGVsX2RlX3JlYWQoZGV2X3ByaXYsCi0JCQkJICAgIEVEUF9QU1JfU1RBVFVTKGRldl9wcml2LT5w
c3IudHJhbnNjb2RlcikpOworCQkJCSAgICBFRFBfUFNSX1NUQVRVUyhpbnRlbF9kcC0+cHNyLnRy
YW5zY29kZXIpKTsKIAkJc3RhdHVzX3ZhbCA9ICh2YWwgJiBFRFBfUFNSX1NUQVRVU19TVEFURV9N
QVNLKSA+PgogCQkJICAgICAgRURQX1BTUl9TVEFUVVNfU1RBVEVfU0hJRlQ7CiAJCWlmIChzdGF0
dXNfdmFsIDwgQVJSQVlfU0laRShsaXZlX3N0YXR1cykpCkBAIC0zMjcsMjEgKzMyNywxOCBAQCBw
c3Jfc291cmNlX3N0YXR1cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHN0cnVj
dCBzZXFfZmlsZSAqbSkKIAlzZXFfcHJpbnRmKG0sICJTb3VyY2UgUFNSIHN0YXR1czogJXMgWzB4
JTA4eF1cbiIsIHN0YXR1cywgdmFsKTsKIH0KIAotc3RhdGljIGludCBpOTE1X2VkcF9wc3Jfc3Rh
dHVzKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKK3N0YXRpYyBpbnQgaW50ZWxfcHNy
X3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19pOTE1KG0tPnBy
aXZhdGUpOwotCXN0cnVjdCBpOTE1X3BzciAqcHNyID0gJmRldl9wcml2LT5wc3I7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisJc3Ry
dWN0IGludGVsX3BzciAqcHNyID0gJmludGVsX2RwLT5wc3I7CiAJaW50ZWxfd2FrZXJlZl90IHdh
a2VyZWY7CiAJY29uc3QgY2hhciAqc3RhdHVzOwogCWJvb2wgZW5hYmxlZDsKIAl1MzIgdmFsOwog
Ci0JaWYgKCFIQVNfUFNSKGRldl9wcml2KSkKLQkJcmV0dXJuIC1FTk9ERVY7Ci0KIAlzZXFfcHJp
bnRmKG0sICJTaW5rIHN1cHBvcnQ6ICVzIiwgeWVzbm8ocHNyLT5zaW5rX3N1cHBvcnQpKTsKLQlp
ZiAocHNyLT5kcCkKLQkJc2VxX3ByaW50ZihtLCAiIFsweCUwMnhdIiwgcHNyLT5kcC0+cHNyX2Rw
Y2RbMF0pOworCWlmIChwc3ItPnNpbmtfc3VwcG9ydCkKKwkJc2VxX3ByaW50ZihtLCAiIFsweCUw
MnhdIiwgaW50ZWxfZHAtPnBzcl9kcGNkWzBdKTsKIAlzZXFfcHV0cyhtLCAiXG4iKTsKIAogCWlm
ICghcHNyLT5zaW5rX3N1cHBvcnQpCkBAIC0zNjUsMTYgKzM2MiwxNiBAQCBzdGF0aWMgaW50IGk5
MTVfZWRwX3Bzcl9zdGF0dXMoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCiAJaWYg
KHBzci0+cHNyMl9lbmFibGVkKSB7CiAJCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsCi0J
CQkJICAgIEVEUF9QU1IyX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpKTsKKwkJCQkgICAg
RURQX1BTUjJfQ1RMKGludGVsX2RwLT5wc3IudHJhbnNjb2RlcikpOwogCQllbmFibGVkID0gdmFs
ICYgRURQX1BTUjJfRU5BQkxFOwogCX0gZWxzZSB7CiAJCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2
X3ByaXYsCi0JCQkJICAgIEVEUF9QU1JfQ1RMKGRldl9wcml2LT5wc3IudHJhbnNjb2RlcikpOwor
CQkJCSAgICBFRFBfUFNSX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpKTsKIAkJZW5hYmxl
ZCA9IHZhbCAmIEVEUF9QU1JfRU5BQkxFOwogCX0KIAlzZXFfcHJpbnRmKG0sICJTb3VyY2UgUFNS
IGN0bDogJXMgWzB4JTA4eF1cbiIsCiAJCSAgIGVuYWJsZWRkaXNhYmxlZChlbmFibGVkKSwgdmFs
KTsKLQlwc3Jfc291cmNlX3N0YXR1cyhkZXZfcHJpdiwgbSk7CisJcHNyX3NvdXJjZV9zdGF0dXMo
aW50ZWxfZHAsIG0pOwogCXNlcV9wcmludGYobSwgIkJ1c3kgZnJvbnRidWZmZXIgYml0czogMHgl
MDh4XG4iLAogCQkgICBwc3ItPmJ1c3lfZnJvbnRidWZmZXJfYml0cyk7CiAKQEAgLTM4Myw3ICsz
ODAsNyBAQCBzdGF0aWMgaW50IGk5MTVfZWRwX3Bzcl9zdGF0dXMoc3RydWN0IHNlcV9maWxlICpt
LCB2b2lkICpkYXRhKQogCSAqLwogCWlmIChJU19IQVNXRUxMKGRldl9wcml2KSB8fCBJU19CUk9B
RFdFTEwoZGV2X3ByaXYpKSB7CiAJCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsCi0JCQkJ
ICAgIEVEUF9QU1JfUEVSRl9DTlQoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSk7CisJCQkJICAg
IEVEUF9QU1JfUEVSRl9DTlQoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSk7CiAJCXZhbCAmPSBF
RFBfUFNSX1BFUkZfQ05UX01BU0s7CiAJCXNlcV9wcmludGYobSwgIlBlcmZvcm1hbmNlIGNvdW50
ZXI6ICV1XG4iLCB2YWwpOwogCX0KQEAgLTQwNCw3ICs0MDEsNyBAQCBzdGF0aWMgaW50IGk5MTVf
ZWRwX3Bzcl9zdGF0dXMoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCQkgKi8KIAkJ
Zm9yIChmcmFtZSA9IDA7IGZyYW1lIDwgUFNSMl9TVV9TVEFUVVNfRlJBTUVTOyBmcmFtZSArPSAz
KSB7CiAJCQl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LAotCQkJCQkgICAgUFNSMl9TVV9T
VEFUVVMoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyLCBmcmFtZSkpOworCQkJCQkgICAgUFNSMl9T
VV9TVEFUVVMoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyLCBmcmFtZSkpOwogCQkJc3VfZnJhbWVz
X3ZhbFtmcmFtZSAvIDNdID0gdmFsOwogCQl9CiAKQEAgLTQzMCwyMyArNDI3LDU3IEBAIHN0YXRp
YyBpbnQgaTkxNV9lZHBfcHNyX3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEp
CiAJcmV0dXJuIDA7CiB9CiAKK3N0YXRpYyBpbnQgaTkxNV9lZHBfcHNyX3N0YXR1cyhzdHJ1Y3Qg
c2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOworCXN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyOworCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBOVUxMOworCisJaWYgKCFI
QVNfUFNSKGRldl9wcml2KSkKKwkJcmV0dXJuIC1FTk9ERVY7CisKKwkvKiBGaW5kIHRoZSBmaXJz
dCBFRFAgKi8KKwlmb3JfZWFjaF9pbnRlbF9kcCgmZGV2X3ByaXYtPmRybSwgZW5jb2Rlcikgewor
CQlpZiAoZW5jb2Rlci0+dHlwZSA9PSBJTlRFTF9PVVRQVVRfRURQKSB7CisJCQlpbnRlbF9kcCA9
IGVuY190b19pbnRlbF9kcChlbmNvZGVyKTsKKwkJCWJyZWFrOworCQl9CisJfQorCisJaWYgKCFp
bnRlbF9kcCkKKwkJcmV0dXJuIC1FTk9ERVY7CisKKwlyZXR1cm4gaW50ZWxfcHNyX3N0YXR1cyht
LCBpbnRlbF9kcCk7Cit9CisKIHN0YXRpYyBpbnQKIGk5MTVfZWRwX3Bzcl9kZWJ1Z19zZXQodm9p
ZCAqZGF0YSwgdTY0IHZhbCkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSBkYXRhOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwotCWludCByZXQ7CisJaW50IHJldCA9
IC1FTk9ERVY7CisJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXI7CiAKLQlpZiAoIUNBTl9Q
U1IoZGV2X3ByaXYpKQotCQlyZXR1cm4gLUVOT0RFVjsKKwlpZiAoIUhBU19QU1IoZGV2X3ByaXYp
KQorCQlyZXR1cm4gcmV0OwogCi0JZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJTZXR0aW5n
IFBTUiBkZWJ1ZyB0byAlbGx4XG4iLCB2YWwpOworCWZvcl9lYWNoX2ludGVsX2RwKCZkZXZfcHJp
di0+ZHJtLCBlbmNvZGVyKSB7CisJCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9f
aW50ZWxfZHAoZW5jb2Rlcik7CiAKLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmRl
dl9wcml2LT5ydW50aW1lX3BtKTsKKwkJaWYgKCFDQU5fUFNSKGludGVsX2RwKSkKKwkJCWNvbnRp
bnVlOwogCi0JcmV0ID0gaW50ZWxfcHNyX2RlYnVnX3NldChkZXZfcHJpdiwgdmFsKTsKKwkJaWYg
KGVuY29kZXItPnR5cGUgPT0gSU5URUxfT1VUUFVUX0VEUCkgeworCQkJZHJtX2RiZ19rbXMoJmRl
dl9wcml2LT5kcm0sICJTZXR0aW5nIFBTUiBkZWJ1ZyB0byAlbGx4XG4iLCB2YWwpOwogCi0JaW50
ZWxfcnVudGltZV9wbV9wdXQoJmRldl9wcml2LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKKwkJCXdh
a2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0pOworCisJ
CQkvLyBUT0RPOiBzcGxpdCB0byBlYWNoIHRyYW5zY29kZXIncyBQU1IgZGVidWcgc3RhdGUKKwkJ
CXJldCA9IGludGVsX3Bzcl9kZWJ1Z19zZXQoaW50ZWxfZHAsIHZhbCk7CisKKwkJCWludGVsX3J1
bnRpbWVfcG1fcHV0KCZkZXZfcHJpdi0+cnVudGltZV9wbSwgd2FrZXJlZik7CisJCX0KKwl9CiAK
IAlyZXR1cm4gcmV0OwogfQpAQCAtNDU1LDEyICs0ODYsMjUgQEAgc3RhdGljIGludAogaTkxNV9l
ZHBfcHNyX2RlYnVnX2dldCh2b2lkICpkYXRhLCB1NjQgKnZhbCkKIHsKIAlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkYXRhOworCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyOwogCi0JaWYgKCFDQU5fUFNSKGRldl9wcml2KSkKKwlpZiAoIUhBU19QU1IoZGV2X3ByaXYp
KQogCQlyZXR1cm4gLUVOT0RFVjsKIAotCSp2YWwgPSBSRUFEX09OQ0UoZGV2X3ByaXYtPnBzci5k
ZWJ1Zyk7Ci0JcmV0dXJuIDA7CisJZm9yX2VhY2hfaW50ZWxfZHAoJmRldl9wcml2LT5kcm0sIGVu
Y29kZXIpIHsKKwkJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcChl
bmNvZGVyKTsKKworCQlpZiAoIUNBTl9QU1IoaW50ZWxfZHApKQorCQkJY29udGludWU7CisKKwkJ
Ly8gVE9ETzogc3BsaXQgdG8gZWFjaCB0cmFuc2NvZGVyJ3MgUFNSIGRlYnVnIHN0YXRlCisJCWlm
IChlbmNvZGVyLT50eXBlID09IElOVEVMX09VVFBVVF9FRFApIHsKKwkJCSp2YWwgPSBSRUFEX09O
Q0UoaW50ZWxfZHAtPnBzci5kZWJ1Zyk7CisJCQlyZXR1cm4gMDsKKwkJfQorCX0KKworCXJldHVy
biAtRU5PREVWOwogfQogCiBERUZJTkVfU0lNUExFX0FUVFJJQlVURShpOTE1X2VkcF9wc3JfZGVi
dWdfZm9wcywKQEAgLTEyMzQsOSArMTI3OCw2IEBAIHN0YXRpYyB2b2lkIGRycnNfc3RhdHVzX3Bl
cl9jcnRjKHN0cnVjdCBzZXFfZmlsZSAqbSwKIAkJLyogZGlzYWJsZV9kcnJzKCkgd2lsbCBtYWtl
IGRycnMtPmRwIE5VTEwgKi8KIAkJaWYgKCFkcnJzLT5kcCkgewogCQkJc2VxX3B1dHMobSwgIklk
bGVuZXNzIERSUlM6IERpc2FibGVkXG4iKTsKLQkJCWlmIChkZXZfcHJpdi0+cHNyLmVuYWJsZWQp
Ci0JCQkJc2VxX3B1dHMobSwKLQkJCQkiXHRBcyBQU1IgaXMgZW5hYmxlZCwgRFJSUyBpcyBub3Qg
ZW5hYmxlZFxuIik7CiAJCQltdXRleF91bmxvY2soJmRycnMtPm11dGV4KTsKIAkJCXJldHVybjsK
IAkJfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlf
dHlwZXMuaAppbmRleCA1YmM1YmZiYzQ1NTEuLjk4OTlmZGRmNGM5OSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKQEAgLTEzMzks
NiArMTMzOSw0MiBAQCBzdHJ1Y3QgaW50ZWxfZHBfY29tcGxpYW5jZSB7CiAJdTggdGVzdF9sYW5l
X2NvdW50OwogfTsKIAorc3RydWN0IGludGVsX3BzciB7CisJLyogTXV0ZXggZm9yIFBTUiBzdGF0
ZSBvZiB0aGUgdHJhbnNjb2RlciAqLworCXN0cnVjdCBtdXRleCBsb2NrOworCisjZGVmaW5lIEk5
MTVfUFNSX0RFQlVHX01PREVfTUFTSwkweDBmCisjZGVmaW5lIEk5MTVfUFNSX0RFQlVHX0RFRkFV
TFQJCTB4MDAKKyNkZWZpbmUgSTkxNV9QU1JfREVCVUdfRElTQUJMRQkJMHgwMQorI2RlZmluZSBJ
OTE1X1BTUl9ERUJVR19FTkFCTEUJCTB4MDIKKyNkZWZpbmUgSTkxNV9QU1JfREVCVUdfRk9SQ0Vf
UFNSMQkweDAzCisjZGVmaW5lIEk5MTVfUFNSX0RFQlVHX0lSUQkJMHgxMAorCisJdTMyIGRlYnVn
OworCWJvb2wgc2lua19zdXBwb3J0OworCWJvb2wgZW5hYmxlZDsKKwllbnVtIHBpcGUgcGlwZTsK
KwllbnVtIHRyYW5zY29kZXIgdHJhbnNjb2RlcjsKKwlib29sIGFjdGl2ZTsKKwlzdHJ1Y3Qgd29y
a19zdHJ1Y3Qgd29yazsKKwl1bnNpZ25lZCBpbnQgYnVzeV9mcm9udGJ1ZmZlcl9iaXRzOworCWJv
b2wgc2lua19wc3IyX3N1cHBvcnQ7CisJYm9vbCBsaW5rX3N0YW5kYnk7CisJYm9vbCBjb2xvcmlt
ZXRyeV9zdXBwb3J0OworCWJvb2wgcHNyMl9lbmFibGVkOworCWJvb2wgcHNyMl9zZWxfZmV0Y2hf
ZW5hYmxlZDsKKwl1OCBzaW5rX3N5bmNfbGF0ZW5jeTsKKwlrdGltZV90IGxhc3RfZW50cnlfYXR0
ZW1wdDsKKwlrdGltZV90IGxhc3RfZXhpdDsKKwlib29sIHNpbmtfbm90X3JlbGlhYmxlOworCWJv
b2wgaXJxX2F1eF9lcnJvcjsKKwl1MTYgc3VfeF9ncmFudWxhcml0eTsKKwlib29sIGRjM2NvX2Vu
YWJsZWQ7CisJdTMyIGRjM2NvX2V4aXRfZGVsYXk7CisJc3RydWN0IGRlbGF5ZWRfd29yayBkYzNj
b193b3JrOworCXN0cnVjdCBkcm1fZHBfdnNjX3NkcCB2c2M7Cit9OworCiBzdHJ1Y3QgaW50ZWxf
ZHAgewogCWk5MTVfcmVnX3Qgb3V0cHV0X3JlZzsKIAl1MzIgRFA7CkBAIC0xNDYwLDYgKzE0OTYs
OCBAQCBzdHJ1Y3QgaW50ZWxfZHAgewogCiAJYm9vbCBob2JsX2ZhaWxlZDsKIAlib29sIGhvYmxf
YWN0aXZlOworCisJc3RydWN0IGludGVsX3BzciBwc3I7CiB9OwogCiBlbnVtIGxzcGNvbl92ZW5k
b3IgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCmluZGV4IGIyYmMwYzhj
MzljNy4uNTczMGNhZDdiNmFjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2RwLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
cC5jCkBAIC0yNzAyLDEyICsyNzAyLDEwIEBAIHZvaWQgaW50ZWxfZHBfY29tcHV0ZV9wc3JfdnNj
X3NkcChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCQkJCSAgY29uc3Qgc3RydWN0IGRybV9j
b25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUsCiAJCQkJICBzdHJ1Y3QgZHJtX2RwX3ZzY19zZHAg
KnZzYykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1
KGludGVsX2RwKTsKLQogCXZzYy0+c2RwX3R5cGUgPSBEUF9TRFBfVlNDOwogCi0JaWYgKGRldl9w
cml2LT5wc3IucHNyMl9lbmFibGVkKSB7Ci0JCWlmIChkZXZfcHJpdi0+cHNyLmNvbG9yaW1ldHJ5
X3N1cHBvcnQgJiYKKwlpZiAoaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJsZWQpIHsKKwkJaWYgKGlu
dGVsX2RwLT5wc3IuY29sb3JpbWV0cnlfc3VwcG9ydCAmJgogCQkgICAgaW50ZWxfZHBfbmVlZHNf
dnNjX3NkcChjcnRjX3N0YXRlLCBjb25uX3N0YXRlKSkgewogCQkJLyogW1BTUjIsICtDb2xvcmlt
ZXRyeV0gKi8KIAkJCWludGVsX2RwX2NvbXB1dGVfdnNjX2NvbG9yaW1ldHJ5KGNydGNfc3RhdGUs
IGNvbm5fc3RhdGUsCkBAIC0zODQ0LDcgKzM4NDIsNyBAQCBib29sIGludGVsX2RwX2luaXRpYWxf
ZmFzdHNldF9jaGVjayhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJcmV0dXJuIGZh
bHNlOwogCX0KIAotCWlmIChDQU5fUFNSKGk5MTUpICYmIGludGVsX2RwX2lzX2VkcChpbnRlbF9k
cCkpIHsKKwlpZiAoQ0FOX1BTUihpbnRlbF9kcCkgJiYgaW50ZWxfZHBfaXNfZWRwKGludGVsX2Rw
KSkgewogCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLCAiRm9yY2luZyBmdWxsIG1vZGVzZXQgdG8g
Y29tcHV0ZSBQU1Igc3RhdGVcbiIpOwogCQljcnRjX3N0YXRlLT51YXBpLm1vZGVfY2hhbmdlZCA9
IHRydWU7CiAJCXJldHVybiBmYWxzZTsKQEAgLTgwNzAsNiArODA2OCwxNyBAQCBzdGF0aWMgdm9p
ZCBpbnRlbF9kcF9tb2Rlc2V0X3JldHJ5X3dvcmtfZm4oc3RydWN0IHdvcmtfc3RydWN0ICp3b3Jr
KQogCWRybV9rbXNfaGVscGVyX2hvdHBsdWdfZXZlbnQoY29ubmVjdG9yLT5kZXYpOwogfQogCitz
dGF0aWMgdm9pZCBpbnRlbF9kcF91cGRhdGVfcGlwZShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
ICpzdGF0ZSwKKwkJCQkgc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCisJCQkJIGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJCSBjb25zdCBzdHJ1Y3Qg
ZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfZHAgKmlu
dGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKGVuY29kZXIpOworCisJaW50ZWxfcGFuZWxfdXBkYXRl
X2JhY2tsaWdodChzdGF0ZSwgZW5jb2RlciwgY3J0Y19zdGF0ZSwgY29ubl9zdGF0ZSk7CisJaW50
ZWxfcHNyMl9wcm9ncmFtX3RyYW5zX21hbl90cmtfY3RsKGludGVsX2RwLCBjcnRjX3N0YXRlKTsK
K30KKwogYm9vbAogaW50ZWxfZHBfaW5pdF9jb25uZWN0b3Ioc3RydWN0IGludGVsX2RpZ2l0YWxf
cG9ydCAqZGlnX3BvcnQsCiAJCQlzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICppbnRlbF9jb25uZWN0
b3IpCkBAIC04MTg0LDYgKzgxOTMsOCBAQCBpbnRlbF9kcF9pbml0X2Nvbm5lY3RvcihzdHJ1Y3Qg
aW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCwKIAkJCSAgICAgICAodGVtcCAmIH4weGYpIHwg
MHhkKTsKIAl9CiAKKwlpbnRlbF9wc3JfaW5pdChpbnRlbF9kcCk7CisKIAlyZXR1cm4gdHJ1ZTsK
IAogZmFpbDoKQEAgLTgyMjUsNyArODIzNiw3IEBAIGJvb2wgaW50ZWxfZHBfaW5pdChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaW50ZWxfZW5jb2Rlci0+Z2V0X2NvbmZpZyA9
IGludGVsX2RwX2dldF9jb25maWc7CiAJaW50ZWxfZW5jb2Rlci0+c3luY19zdGF0ZSA9IGludGVs
X2RwX3N5bmNfc3RhdGU7CiAJaW50ZWxfZW5jb2Rlci0+aW5pdGlhbF9mYXN0c2V0X2NoZWNrID0g
aW50ZWxfZHBfaW5pdGlhbF9mYXN0c2V0X2NoZWNrOwotCWludGVsX2VuY29kZXItPnVwZGF0ZV9w
aXBlID0gaW50ZWxfcGFuZWxfdXBkYXRlX2JhY2tsaWdodDsKKwlpbnRlbF9lbmNvZGVyLT51cGRh
dGVfcGlwZSA9IGludGVsX2RwX3VwZGF0ZV9waXBlOwogCWludGVsX2VuY29kZXItPnN1c3BlbmQg
PSBpbnRlbF9kcF9lbmNvZGVyX3N1c3BlbmQ7CiAJaW50ZWxfZW5jb2Rlci0+c2h1dGRvd24gPSBp
bnRlbF9kcF9lbmNvZGVyX3NodXRkb3duOwogCWlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSkg
ewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmMKaW5kZXggZDlhMzk1YzQ4
NmQzLi5lZWQ3NzU0YzJmNzQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfcHNyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9w
c3IuYwpAQCAtNzksMTEgKzc5LDEzIEBACiAgKiB1c2UgcGFnZSBmbGlwcy4KICAqLwogCi1zdGF0
aWMgYm9vbCBwc3JfZ2xvYmFsX2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
CitzdGF0aWMgYm9vbCBwc3JfZ2xvYmFsX2VuYWJsZWQoc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCkKIHsKLQlzd2l0Y2ggKGk5MTUtPnBzci5kZWJ1ZyAmIEk5MTVfUFNSX0RFQlVHX01PREVfTUFT
SykgeworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50
ZWxfZHApOworCisJc3dpdGNoIChpbnRlbF9kcC0+cHNyLmRlYnVnICYgSTkxNV9QU1JfREVCVUdf
TU9ERV9NQVNLKSB7CiAJY2FzZSBJOTE1X1BTUl9ERUJVR19ERUZBVUxUOgotCQlyZXR1cm4gaTkx
NS0+cGFyYW1zLmVuYWJsZV9wc3I7CisJCXJldHVybiBkZXZfcHJpdi0+cGFyYW1zLmVuYWJsZV9w
c3I7CiAJY2FzZSBJOTE1X1BTUl9ERUJVR19ESVNBQkxFOgogCQlyZXR1cm4gZmFsc2U7CiAJZGVm
YXVsdDoKQEAgLTkxLDkgKzkzLDkgQEAgc3RhdGljIGJvb2wgcHNyX2dsb2JhbF9lbmFibGVkKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCX0KIH0KIAotc3RhdGljIGJvb2wgcHNyMl9n
bG9iYWxfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMg
Ym9vbCBwc3IyX2dsb2JhbF9lbmFibGVkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7Ci0J
c3dpdGNoIChkZXZfcHJpdi0+cHNyLmRlYnVnICYgSTkxNV9QU1JfREVCVUdfTU9ERV9NQVNLKSB7
CisJc3dpdGNoIChpbnRlbF9kcC0+cHNyLmRlYnVnICYgSTkxNV9QU1JfREVCVUdfTU9ERV9NQVNL
KSB7CiAJY2FzZSBJOTE1X1BTUl9ERUJVR19ESVNBQkxFOgogCWNhc2UgSTkxNV9QU1JfREVCVUdf
Rk9SQ0VfUFNSMToKIAkJcmV0dXJuIGZhbHNlOwpAQCAtMTAyLDExICsxMDQsMTIgQEAgc3RhdGlj
IGJvb2wgcHNyMl9nbG9iYWxfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCiAJfQogfQogCi1zdGF0aWMgdm9pZCBwc3JfaXJxX2NvbnRyb2woc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgcHNyX2lycV9jb250cm9sKHN0cnVjdCBp
bnRlbF9kcCAqaW50ZWxfZHApCiB7CiAJZW51bSB0cmFuc2NvZGVyIHRyYW5zX3NoaWZ0OwogCXUz
MiBtYXNrLCB2YWw7CiAJaTkxNV9yZWdfdCBpbXJfcmVnOworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCiAJLyoKIAkgKiBnZW4xMisg
aGFzIHJlZ2lzdGVycyByZWxhdGl2ZSB0byB0cmFuc2NvZGVyIGFuZCBvbmUgcGVyIHRyYW5zY29k
ZXIKQEAgLTExNSwxNCArMTE4LDE0IEBAIHN0YXRpYyB2b2lkIHBzcl9pcnFfY29udHJvbChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJICovCiAJaWYgKElOVEVMX0dFTihkZXZf
cHJpdikgPj0gMTIpIHsKIAkJdHJhbnNfc2hpZnQgPSAwOwotCQlpbXJfcmVnID0gVFJBTlNfUFNS
X0lNUihkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpOworCQlpbXJfcmVnID0gVFJBTlNfUFNSX0lN
UihpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpOwogCX0gZWxzZSB7Ci0JCXRyYW5zX3NoaWZ0ID0g
ZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyOworCQl0cmFuc19zaGlmdCA9IGludGVsX2RwLT5wc3Iu
dHJhbnNjb2RlcjsKIAkJaW1yX3JlZyA9IEVEUF9QU1JfSU1SOwogCX0KIAogCW1hc2sgPSBFRFBf
UFNSX0VSUk9SKHRyYW5zX3NoaWZ0KTsKLQlpZiAoZGV2X3ByaXYtPnBzci5kZWJ1ZyAmIEk5MTVf
UFNSX0RFQlVHX0lSUSkKKwlpZiAoaW50ZWxfZHAtPnBzci5kZWJ1ZyAmIEk5MTVfUFNSX0RFQlVH
X0lSUSkKIAkJbWFzayB8PSBFRFBfUFNSX1BPU1RfRVhJVCh0cmFuc19zaGlmdCkgfAogCQkJRURQ
X1BTUl9QUkVfRU5UUlkodHJhbnNfc2hpZnQpOwogCkBAIC0xNzEsMzggKzE3NCwzNyBAQCBzdGF0
aWMgdm9pZCBwc3JfZXZlbnRfcHJpbnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJ
CWRybV9kYmdfa21zKCZpOTE1LT5kcm0sICJcdFBTUiBkaXNhYmxlZFxuIik7CiB9CiAKLXZvaWQg
aW50ZWxfcHNyX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwg
dTMyIHBzcl9paXIpCit2b2lkIGludGVsX3Bzcl9pcnFfaGFuZGxlcihzdHJ1Y3QgaW50ZWxfZHAg
KmludGVsX2RwLCB1MzIgcHNyX2lpcikKIHsKLQllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29k
ZXIgPSBkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXI7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisJZW51bSB0cmFuc2NvZGVyIGNwdV90
cmFuc2NvZGVyID0gaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyOwogCWVudW0gdHJhbnNjb2RlciB0
cmFuc19zaGlmdDsKIAlpOTE1X3JlZ190IGltcl9yZWc7CiAJa3RpbWVfdCB0aW1lX25zID0gIGt0
aW1lX2dldCgpOwogCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpIHsKIAkJdHJhbnNf
c2hpZnQgPSAwOwotCQlpbXJfcmVnID0gVFJBTlNfUFNSX0lNUihkZXZfcHJpdi0+cHNyLnRyYW5z
Y29kZXIpOworCQlpbXJfcmVnID0gVFJBTlNfUFNSX0lNUihpbnRlbF9kcC0+cHNyLnRyYW5zY29k
ZXIpOwogCX0gZWxzZSB7Ci0JCXRyYW5zX3NoaWZ0ID0gZGV2X3ByaXYtPnBzci50cmFuc2NvZGVy
OworCQl0cmFuc19zaGlmdCA9IGludGVsX2RwLT5wc3IudHJhbnNjb2RlcjsKIAkJaW1yX3JlZyA9
IEVEUF9QU1JfSU1SOwogCX0KIAogCWlmIChwc3JfaWlyICYgRURQX1BTUl9QUkVfRU5UUlkodHJh
bnNfc2hpZnQpKSB7Ci0JCWRldl9wcml2LT5wc3IubGFzdF9lbnRyeV9hdHRlbXB0ID0gdGltZV9u
czsKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCi0JCQkgICAgIlt0cmFuc2NvZGVyICVz
XSBQU1IgZW50cnkgYXR0ZW1wdCBpbiAyIHZibGFua3NcbiIsCi0JCQkgICAgdHJhbnNjb2Rlcl9u
YW1lKGNwdV90cmFuc2NvZGVyKSk7CisJCWludGVsX2RwLT5wc3IubGFzdF9lbnRyeV9hdHRlbXB0
ID0gdGltZV9uczsKKwkJRFJNX0RFQlVHX0tNUygiW3RyYW5zY29kZXIgJXNdIFBTUiBlbnRyeSBh
dHRlbXB0IGluIDIgdmJsYW5rc1xuIiwKKwkJCSAgICAgIHRyYW5zY29kZXJfbmFtZShjcHVfdHJh
bnNjb2RlcikpOwogCX0KIAogCWlmIChwc3JfaWlyICYgRURQX1BTUl9QT1NUX0VYSVQodHJhbnNf
c2hpZnQpKSB7Ci0JCWRldl9wcml2LT5wc3IubGFzdF9leGl0ID0gdGltZV9uczsKLQkJZHJtX2Ri
Z19rbXMoJmRldl9wcml2LT5kcm0sCi0JCQkgICAgIlt0cmFuc2NvZGVyICVzXSBQU1IgZXhpdCBj
b21wbGV0ZWRcbiIsCi0JCQkgICAgdHJhbnNjb2Rlcl9uYW1lKGNwdV90cmFuc2NvZGVyKSk7CisJ
CWludGVsX2RwLT5wc3IubGFzdF9leGl0ID0gdGltZV9uczsKKwkJRFJNX0RFQlVHX0tNUygiW3Ry
YW5zY29kZXIgJXNdIFBTUiBleGl0IGNvbXBsZXRlZFxuIiwKKwkJCSAgICAgIHRyYW5zY29kZXJf
bmFtZShjcHVfdHJhbnNjb2RlcikpOwogCiAJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkp
IHsKIAkJCXUzMiB2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LAogCQkJCQkJUFNSX0VWRU5U
KGNwdV90cmFuc2NvZGVyKSk7Ci0JCQlib29sIHBzcjJfZW5hYmxlZCA9IGRldl9wcml2LT5wc3Iu
cHNyMl9lbmFibGVkOworCQkJYm9vbCBwc3IyX2VuYWJsZWQgPSBpbnRlbF9kcC0+cHNyLnBzcjJf
ZW5hYmxlZDsKIAogCQkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIFBTUl9FVkVOVChjcHVfdHJh
bnNjb2RlciksCiAJCQkJICAgICAgIHZhbCk7CkBAIC0yMTMsMTAgKzIxNSwxMCBAQCB2b2lkIGlu
dGVsX3Bzcl9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUz
MiBwc3JfaWlyKQogCWlmIChwc3JfaWlyICYgRURQX1BTUl9FUlJPUih0cmFuc19zaGlmdCkpIHsK
IAkJdTMyIHZhbDsKIAotCQlkcm1fd2FybigmZGV2X3ByaXYtPmRybSwgIlt0cmFuc2NvZGVyICVz
XSBQU1IgYXV4IGVycm9yXG4iLAorCQlEUk1fV0FSTigiW3RyYW5zY29kZXIgJXNdIFBTUiBhdXgg
ZXJyb3JcbiIsCiAJCQkgdHJhbnNjb2Rlcl9uYW1lKGNwdV90cmFuc2NvZGVyKSk7CiAKLQkJZGV2
X3ByaXYtPnBzci5pcnFfYXV4X2Vycm9yID0gdHJ1ZTsKKwkJaW50ZWxfZHAtPnBzci5pcnFfYXV4
X2Vycm9yID0gdHJ1ZTsKIAogCQkvKgogCQkgKiBJZiB0aGlzIGludGVycnVwdGlvbiBpcyBub3Qg
bWFza2VkIGl0IHdpbGwga2VlcApAQCAtMjMwLDcgKzIzMiw3IEBAIHZvaWQgaW50ZWxfcHNyX2ly
cV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIHBzcl9paXIp
CiAJCXZhbCB8PSBFRFBfUFNSX0VSUk9SKHRyYW5zX3NoaWZ0KTsKIAkJaW50ZWxfZGVfd3JpdGUo
ZGV2X3ByaXYsIGltcl9yZWcsIHZhbCk7CiAKLQkJc2NoZWR1bGVfd29yaygmZGV2X3ByaXYtPnBz
ci53b3JrKTsKKwkJc2NoZWR1bGVfd29yaygmaW50ZWxfZHAtPnBzci53b3JrKTsKIAl9CiB9CiAK
QEAgLTI5MSwxMiArMjkzLDYgQEAgdm9pZCBpbnRlbF9wc3JfaW5pdF9kcGNkKHN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHApCiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KIAkJ
dG9faTkxNShkcF90b19kaWdfcG9ydChpbnRlbF9kcCktPmJhc2UuYmFzZS5kZXYpOwogCi0JaWYg
KGRldl9wcml2LT5wc3IuZHApIHsKLQkJZHJtX3dhcm4oJmRldl9wcml2LT5kcm0sCi0JCQkgIk1v
cmUgdGhhbiBvbmUgZURQIHBhbmVsIGZvdW5kLCBQU1Igc3VwcG9ydCBzaG91bGQgYmUgZXh0ZW5k
ZWRcbiIpOwotCQlyZXR1cm47Ci0JfQotCiAJZHJtX2RwX2RwY2RfcmVhZCgmaW50ZWxfZHAtPmF1
eCwgRFBfUFNSX1NVUFBPUlQsIGludGVsX2RwLT5wc3JfZHBjZCwKIAkJCSBzaXplb2YoaW50ZWxf
ZHAtPnBzcl9kcGNkKSk7CiAKQEAgLTMxNywxMiArMzEzLDEwIEBAIHZvaWQgaW50ZWxfcHNyX2lu
aXRfZHBjZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCQlyZXR1cm47CiAJfQogCi0JZGV2
X3ByaXYtPnBzci5zaW5rX3N1cHBvcnQgPSB0cnVlOwotCWRldl9wcml2LT5wc3Iuc2lua19zeW5j
X2xhdGVuY3kgPQorCWludGVsX2RwLT5wc3Iuc2lua19zdXBwb3J0ID0gdHJ1ZTsKKwlpbnRlbF9k
cC0+cHNyLnNpbmtfc3luY19sYXRlbmN5ID0KIAkJaW50ZWxfZHBfZ2V0X3Npbmtfc3luY19sYXRl
bmN5KGludGVsX2RwKTsKIAotCWRldl9wcml2LT5wc3IuZHAgPSBpbnRlbF9kcDsKLQogCWlmIChJ
TlRFTF9HRU4oZGV2X3ByaXYpID49IDkgJiYKIAkgICAgKGludGVsX2RwLT5wc3JfZHBjZFswXSA9
PSBEUF9QU1IyX1dJVEhfWV9DT09SRF9JU19TVVBQT1JURUQpKSB7CiAJCWJvb2wgeV9yZXEgPSBp
bnRlbF9kcC0+cHNyX2RwY2RbMV0gJgpAQCAtMzQwLDE0ICszMzQsMTQgQEAgdm9pZCBpbnRlbF9w
c3JfaW5pdF9kcGNkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJCSAqIFktY29vcmRpbmF0
ZSByZXF1aXJlbWVudCBwYW5lbHMgd2Ugd291bGQgbmVlZCB0byBlbmFibGUKIAkJICogR1RDIGZp
cnN0LgogCQkgKi8KLQkJZGV2X3ByaXYtPnBzci5zaW5rX3BzcjJfc3VwcG9ydCA9IHlfcmVxICYm
IGFscG07CisJCWludGVsX2RwLT5wc3Iuc2lua19wc3IyX3N1cHBvcnQgPSB5X3JlcSAmJiBhbHBt
OwogCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgIlBTUjIgJXNzdXBwb3J0ZWRcbiIsCi0J
CQkgICAgZGV2X3ByaXYtPnBzci5zaW5rX3BzcjJfc3VwcG9ydCA/ICIiIDogIm5vdCAiKTsKKwkJ
CSAgICBpbnRlbF9kcC0+cHNyLnNpbmtfcHNyMl9zdXBwb3J0ID8gIiIgOiAibm90ICIpOwogCi0J
CWlmIChkZXZfcHJpdi0+cHNyLnNpbmtfcHNyMl9zdXBwb3J0KSB7Ci0JCQlkZXZfcHJpdi0+cHNy
LmNvbG9yaW1ldHJ5X3N1cHBvcnQgPQorCQlpZiAoaW50ZWxfZHAtPnBzci5zaW5rX3BzcjJfc3Vw
cG9ydCkgeworCQkJaW50ZWxfZHAtPnBzci5jb2xvcmltZXRyeV9zdXBwb3J0ID0KIAkJCQlpbnRl
bF9kcF9nZXRfY29sb3JpbWV0cnlfc3RhdHVzKGludGVsX2RwKTsKLQkJCWRldl9wcml2LT5wc3Iu
c3VfeF9ncmFudWxhcml0eSA9CisJCQlpbnRlbF9kcC0+cHNyLnN1X3hfZ3JhbnVsYXJpdHkgPQog
CQkJCWludGVsX2RwX2dldF9zdV94X2dyYW51bGFydGl5KGludGVsX2RwKTsKIAkJfQogCX0KQEAg
LTM3Myw3ICszNjcsNyBAQCBzdGF0aWMgdm9pZCBoc3dfcHNyX3NldHVwX2F1eChzdHJ1Y3QgaW50
ZWxfZHAgKmludGVsX2RwKQogCUJVSUxEX0JVR19PTihzaXplb2YoYXV4X21zZykgPiAyMCk7CiAJ
Zm9yIChpID0gMDsgaSA8IHNpemVvZihhdXhfbXNnKTsgaSArPSA0KQogCQlpbnRlbF9kZV93cml0
ZShkZXZfcHJpdiwKLQkJCSAgICAgICBFRFBfUFNSX0FVWF9EQVRBKGRldl9wcml2LT5wc3IudHJh
bnNjb2RlciwgaSA+PiAyKSwKKwkJCSAgICAgICBFRFBfUFNSX0FVWF9EQVRBKGludGVsX2RwLT5w
c3IudHJhbnNjb2RlciwgaSA+PiAyKSwKIAkJCSAgICAgICBpbnRlbF9kcF9wYWNrX2F1eCgmYXV4
X21zZ1tpXSwgc2l6ZW9mKGF1eF9tc2cpIC0gaSkpOwogCiAJYXV4X2Nsb2NrX2RpdmlkZXIgPSBp
bnRlbF9kcC0+Z2V0X2F1eF9jbG9ja19kaXZpZGVyKGludGVsX2RwLCAwKTsKQEAgLTM4NCw3ICsz
NzgsNyBAQCBzdGF0aWMgdm9pZCBoc3dfcHNyX3NldHVwX2F1eChzdHJ1Y3QgaW50ZWxfZHAgKmlu
dGVsX2RwKQogCiAJLyogU2VsZWN0IG9ubHkgdmFsaWQgYml0cyBmb3IgU1JEX0FVWF9DVEwgKi8K
IAlhdXhfY3RsICY9IHBzcl9hdXhfbWFzazsKLQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRURQ
X1BTUl9BVVhfQ1RMKGRldl9wcml2LT5wc3IudHJhbnNjb2RlciksCisJaW50ZWxfZGVfd3JpdGUo
ZGV2X3ByaXYsIEVEUF9QU1JfQVVYX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpLAogCQkg
ICAgICAgYXV4X2N0bCk7CiB9CiAKQEAgLTM5NCwxNCArMzg4LDE0IEBAIHN0YXRpYyB2b2lkIGlu
dGVsX3Bzcl9lbmFibGVfc2luayhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCXU4IGRwY2Rf
dmFsID0gRFBfUFNSX0VOQUJMRTsKIAogCS8qIEVuYWJsZSBBTFBNIGF0IHNpbmsgZm9yIHBzcjIg
Ki8KLQlpZiAoZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQpIHsKKwlpZiAoaW50ZWxfZHAtPnBz
ci5wc3IyX2VuYWJsZWQpIHsKIAkJZHJtX2RwX2RwY2Rfd3JpdGViKCZpbnRlbF9kcC0+YXV4LCBE
UF9SRUNFSVZFUl9BTFBNX0NPTkZJRywKIAkJCQkgICBEUF9BTFBNX0VOQUJMRSB8CiAJCQkJICAg
RFBfQUxQTV9MT0NLX0VSUk9SX0lSUV9IUERfRU5BQkxFKTsKIAogCQlkcGNkX3ZhbCB8PSBEUF9Q
U1JfRU5BQkxFX1BTUjIgfCBEUF9QU1JfSVJRX0hQRF9XSVRIX0NSQ19FUlJPUlM7CiAJfSBlbHNl
IHsKLQkJaWYgKGRldl9wcml2LT5wc3IubGlua19zdGFuZGJ5KQorCQlpZiAoaW50ZWxfZHAtPnBz
ci5saW5rX3N0YW5kYnkpCiAJCQlkcGNkX3ZhbCB8PSBEUF9QU1JfTUFJTl9MSU5LX0FDVElWRTsK
IAogCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA4KQpAQCAtNDY0LDcgKzQ1OCw3IEBAIHN0
YXRpYyB1OCBwc3JfY29tcHV0ZV9pZGxlX2ZyYW1lcyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2Rw
KQogCSAqIG9mZi1ieS1vbmUgaXNzdWUgdGhhdCBIVyBoYXMgaW4gc29tZSBjYXNlcy4KIAkgKi8K
IAlpZGxlX2ZyYW1lcyA9IG1heCg2LCBkZXZfcHJpdi0+dmJ0LnBzci5pZGxlX2ZyYW1lcyk7Ci0J
aWRsZV9mcmFtZXMgPSBtYXgoaWRsZV9mcmFtZXMsIGRldl9wcml2LT5wc3Iuc2lua19zeW5jX2xh
dGVuY3kgKyAxKTsKKwlpZGxlX2ZyYW1lcyA9IG1heChpZGxlX2ZyYW1lcywgaW50ZWxfZHAtPnBz
ci5zaW5rX3N5bmNfbGF0ZW5jeSArIDEpOwogCiAJaWYgKGRybV9XQVJOX09OKCZkZXZfcHJpdi0+
ZHJtLCBpZGxlX2ZyYW1lcyA+IDB4ZikpCiAJCWlkbGVfZnJhbWVzID0gMHhmOwpAQCAtNDg0LDcg
KzQ3OCw3IEBAIHN0YXRpYyB2b2lkIGhzd19hY3RpdmF0ZV9wc3IxKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHApCiAJaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpKQogCQl2YWwgfD0gRURQX1BTUl9N
SU5fTElOS19FTlRSWV9USU1FXzhfTElORVM7CiAKLQlpZiAoZGV2X3ByaXYtPnBzci5saW5rX3N0
YW5kYnkpCisJaWYgKGludGVsX2RwLT5wc3IubGlua19zdGFuZGJ5KQogCQl2YWwgfD0gRURQX1BT
Ul9MSU5LX1NUQU5EQlk7CiAKIAl2YWwgfD0gaW50ZWxfcHNyMV9nZXRfdHBfdGltZShpbnRlbF9k
cCk7CkBAIC00OTIsOSArNDg2LDkgQEAgc3RhdGljIHZvaWQgaHN3X2FjdGl2YXRlX3BzcjEoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCkKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA4KQog
CQl2YWwgfD0gRURQX1BTUl9DUkNfRU5BQkxFOwogCi0JdmFsIHw9IChpbnRlbF9kZV9yZWFkKGRl
dl9wcml2LCBFRFBfUFNSX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpKSAmCisJdmFsIHw9
IChpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBFRFBfUFNSX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5z
Y29kZXIpKSAmCiAJCUVEUF9QU1JfUkVTVE9SRV9QU1JfQUNUSVZFX0NUWF9NQVNLKTsKLQlpbnRl
bF9kZV93cml0ZShkZXZfcHJpdiwgRURQX1BTUl9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVy
KSwgdmFsKTsKKwlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRURQX1BTUl9DVEwoaW50ZWxfZHAt
PnBzci50cmFuc2NvZGVyKSwgdmFsKTsKIH0KIAogc3RhdGljIHUzMiBpbnRlbF9wc3IyX2dldF90
cF90aW1lKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCkBAIC01MjksNyArNTIzLDcgQEAgc3Rh
dGljIHZvaWQgaHN3X2FjdGl2YXRlX3BzcjIoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAlp
ZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkK
IAkJdmFsIHw9IEVEUF9ZX0NPT1JESU5BVEVfRU5BQkxFOwogCi0JdmFsIHw9IEVEUF9QU1IyX0ZS
QU1FX0JFRk9SRV9TVShkZXZfcHJpdi0+cHNyLnNpbmtfc3luY19sYXRlbmN5ICsgMSk7CisJdmFs
IHw9IEVEUF9QU1IyX0ZSQU1FX0JFRk9SRV9TVShpbnRlbF9kcC0+cHNyLnNpbmtfc3luY19sYXRl
bmN5ICsgMSk7CiAJdmFsIHw9IGludGVsX3BzcjJfZ2V0X3RwX3RpbWUoaW50ZWxfZHApOwogCiAJ
aWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpIHsKQEAgLTU0OCw3ICs1NDIsNyBAQCBzdGF0
aWMgdm9pZCBoc3dfYWN0aXZhdGVfcHNyMihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCQl2
YWwgfD0gRURQX1BTUjJfRkFTVF9XQUtFKDcpOwogCX0KIAotCWlmIChkZXZfcHJpdi0+cHNyLnBz
cjJfc2VsX2ZldGNoX2VuYWJsZWQpIHsKKwlpZiAoaW50ZWxfZHAtPnBzci5wc3IyX3NlbF9mZXRj
aF9lbmFibGVkKSB7CiAJCS8qIFdBIDE0MDgzMzA4NDcgKi8KIAkJaWYgKElTX1RHTF9ESVNQX1JF
VklEKGRldl9wcml2LCBUR0xfUkVWSURfQTAsIFRHTF9SRVZJRF9BMCkgfHwKIAkJICAgIElTX1JL
TF9SRVZJRChkZXZfcHJpdiwgUktMX1JFVklEX0EwLCBSS0xfUkVWSURfQTApKQpAQCAtNTU3LDIw
ICs1NTEsMjAgQEAgc3RhdGljIHZvaWQgaHN3X2FjdGl2YXRlX3BzcjIoc3RydWN0IGludGVsX2Rw
ICppbnRlbF9kcCkKIAkJCQkgICAgIERJU19SQU1fQllQQVNTX1BTUjJfTUFOX1RSQUNLKTsKIAog
CQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwKLQkJCSAgICAgICBQU1IyX01BTl9UUktfQ1RMKGRl
dl9wcml2LT5wc3IudHJhbnNjb2RlciksCisJCQkgICAgICAgUFNSMl9NQU5fVFJLX0NUTChpbnRl
bF9kcC0+cHNyLnRyYW5zY29kZXIpLAogCQkJICAgICAgIFBTUjJfTUFOX1RSS19DVExfRU5BQkxF
KTsKIAl9IGVsc2UgaWYgKEhBU19QU1IyX1NFTF9GRVRDSChkZXZfcHJpdikpIHsKIAkJaW50ZWxf
ZGVfd3JpdGUoZGV2X3ByaXYsCi0JCQkgICAgICAgUFNSMl9NQU5fVFJLX0NUTChkZXZfcHJpdi0+
cHNyLnRyYW5zY29kZXIpLCAwKTsKKwkJCSAgICAgICBQU1IyX01BTl9UUktfQ1RMKGludGVsX2Rw
LT5wc3IudHJhbnNjb2RlciksIDApOwogCX0KIAogCS8qCiAJICogUFNSMiBIVyBpcyBpbmNvcnJl
Y3RseSB1c2luZyBFRFBfUFNSX1RQMV9UUDNfU0VMIGFuZCBCU3BlYyBpcwogCSAqIHJlY29tbWVu
ZGluZyBrZWVwIHRoaXMgYml0IHVuc2V0IHdoaWxlIFBTUjIgaXMgZW5hYmxlZC4KIAkgKi8KLQlp
bnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRURQX1BTUl9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2Nv
ZGVyKSwgMCk7CisJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEVEUF9QU1JfQ1RMKGludGVsX2Rw
LT5wc3IudHJhbnNjb2RlciksIDApOwogCi0JaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEVEUF9Q
U1IyX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpLCB2YWwpOworCWludGVsX2RlX3dyaXRl
KGRldl9wcml2LCBFRFBfUFNSMl9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSwgdmFsKTsK
IH0KIAogc3RhdGljIGJvb2wKQEAgLTU5Myw1NSArNTg3LDU4IEBAIHN0YXRpYyB1MzIgaW50ZWxf
Z2V0X2ZyYW1lX3RpbWVfdXMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNzdGF0ZSkK
IAkJCSAgICBkcm1fbW9kZV92cmVmcmVzaCgmY3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlKSk7CiB9
CiAKLXN0YXRpYyB2b2lkIHBzcjJfcHJvZ3JhbV9pZGxlX2ZyYW1lcyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBwc3IyX3Byb2dyYW1faWRsZV9mcmFtZXMo
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJCQkgICAgIHUzMiBpZGxlX2ZyYW1lcykKIHsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2Rw
KTsKIAl1MzIgdmFsOwogCiAJaWRsZV9mcmFtZXMgPDw9ICBFRFBfUFNSMl9JRExFX0ZSQU1FX1NI
SUZUOwotCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIEVEUF9QU1IyX0NUTChkZXZfcHJp
di0+cHNyLnRyYW5zY29kZXIpKTsKKwl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBFRFBf
UFNSMl9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSk7CiAJdmFsICY9IH5FRFBfUFNSMl9J
RExFX0ZSQU1FX01BU0s7CiAJdmFsIHw9IGlkbGVfZnJhbWVzOwotCWludGVsX2RlX3dyaXRlKGRl
dl9wcml2LCBFRFBfUFNSMl9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSwgdmFsKTsKKwlp
bnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRURQX1BTUjJfQ1RMKGludGVsX2RwLT5wc3IudHJhbnNj
b2RlciksIHZhbCk7CiB9CiAKLXN0YXRpYyB2b2lkIHRnbF9wc3IyX2VuYWJsZV9kYzNjbyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCB0Z2xfcHNyMl9lbmFi
bGVfZGMzY28oc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKLQlwc3IyX3Byb2dyYW1faWRs
ZV9mcmFtZXMoZGV2X3ByaXYsIDApOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCisJcHNyMl9wcm9ncmFtX2lkbGVfZnJhbWVzKGlu
dGVsX2RwLCAwKTsKIAlpbnRlbF9kaXNwbGF5X3Bvd2VyX3NldF90YXJnZXRfZGNfc3RhdGUoZGV2
X3ByaXYsIERDX1NUQVRFX0VOX0RDM0NPKTsKIH0KIAotc3RhdGljIHZvaWQgdGdsX3BzcjJfZGlz
YWJsZV9kYzNjbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9p
ZCB0Z2xfcHNyMl9kaXNhYmxlX2RjM2NvKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7Ci0J
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGRldl9wcml2LT5wc3IuZHA7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAKIAlpbnRl
bF9kaXNwbGF5X3Bvd2VyX3NldF90YXJnZXRfZGNfc3RhdGUoZGV2X3ByaXYsIERDX1NUQVRFX0VO
X1VQVE9fREM2KTsKLQlwc3IyX3Byb2dyYW1faWRsZV9mcmFtZXMoZGV2X3ByaXYsIHBzcl9jb21w
dXRlX2lkbGVfZnJhbWVzKGludGVsX2RwKSk7CisJcHNyMl9wcm9ncmFtX2lkbGVfZnJhbWVzKGlu
dGVsX2RwLCBwc3JfY29tcHV0ZV9pZGxlX2ZyYW1lcyhpbnRlbF9kcCkpOwogfQogCiBzdGF0aWMg
dm9pZCB0Z2xfZGMzY29fZGlzYWJsZV93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQotCQljb250YWluZXJfb2Yod29y
aywgdHlwZW9mKCpkZXZfcHJpdiksIHBzci5kYzNjb193b3JrLndvcmspOworCXN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHAgPQorCQljb250YWluZXJfb2Yod29yaywgdHlwZW9mKCppbnRlbF9kcCks
IHBzci5kYzNjb193b3JrLndvcmspOwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPnBzci5sb2Nr
KTsKKwltdXRleF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOwogCS8qIElmIGRlbGF5ZWQgd29y
ayBpcyBwZW5kaW5nLCBpdCBpcyBub3QgaWRsZSAqLwotCWlmIChkZWxheWVkX3dvcmtfcGVuZGlu
ZygmZGV2X3ByaXYtPnBzci5kYzNjb193b3JrKSkKKwlpZiAoZGVsYXllZF93b3JrX3BlbmRpbmco
JmludGVsX2RwLT5wc3IuZGMzY29fd29yaykpCiAJCWdvdG8gdW5sb2NrOwogCi0JdGdsX3BzcjJf
ZGlzYWJsZV9kYzNjbyhkZXZfcHJpdik7CisJdGdsX3BzcjJfZGlzYWJsZV9kYzNjbyhpbnRlbF9k
cCk7CiB1bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCW11dGV4
X3VubG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKIH0KIAotc3RhdGljIHZvaWQgdGdsX2Rpc2Fs
bG93X2RjM2NvX29uX3BzcjJfZXhpdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CitzdGF0aWMgdm9pZCB0Z2xfZGlzYWxsb3dfZGMzY29fb25fcHNyMl9leGl0KHN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHApCiB7Ci0JaWYgKCFkZXZfcHJpdi0+cHNyLmRjM2NvX2VuYWJsZWQpCisJ
aWYgKCFpbnRlbF9kcC0+cHNyLmRjM2NvX2VuYWJsZWQpCiAJCXJldHVybjsKIAotCWNhbmNlbF9k
ZWxheWVkX3dvcmsoJmRldl9wcml2LT5wc3IuZGMzY29fd29yayk7CisJY2FuY2VsX2RlbGF5ZWRf
d29yaygmaW50ZWxfZHAtPnBzci5kYzNjb193b3JrKTsKIAkvKiBCZWZvcmUgUFNSMiBleGl0IGRp
c2FsbG93IGRjM2NvKi8KLQl0Z2xfcHNyMl9kaXNhYmxlX2RjM2NvKGRldl9wcml2KTsKKwl0Z2xf
cHNyMl9kaXNhYmxlX2RjM2NvKGludGVsX2RwKTsKIH0KIAogc3RhdGljIHZvaWQKQEAgLTcxNCw3
ICs3MTEsNyBAQCBzdGF0aWMgYm9vbCBpbnRlbF9wc3IyX2NvbmZpZ192YWxpZChzdHJ1Y3QgaW50
ZWxfZHAgKmludGVsX2RwLAogCWludCBjcnRjX3ZkaXNwbGF5ID0gY3J0Y19zdGF0ZS0+aHcuYWRq
dXN0ZWRfbW9kZS5jcnRjX3ZkaXNwbGF5OwogCWludCBwc3JfbWF4X2ggPSAwLCBwc3JfbWF4X3Yg
PSAwLCBtYXhfYnBwID0gMDsKIAotCWlmICghZGV2X3ByaXYtPnBzci5zaW5rX3BzcjJfc3VwcG9y
dCkKKwlpZiAoIWludGVsX2RwLT5wc3Iuc2lua19wc3IyX3N1cHBvcnQpCiAJCXJldHVybiBmYWxz
ZTsKIAogCWlmICghdHJhbnNjb2Rlcl9oYXNfcHNyMihkZXZfcHJpdiwgY3J0Y19zdGF0ZS0+Y3B1
X3RyYW5zY29kZXIpKSB7CkBAIC03MjQsNyArNzIxLDcgQEAgc3RhdGljIGJvb2wgaW50ZWxfcHNy
Ml9jb25maWdfdmFsaWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJcmV0dXJuIGZhbHNl
OwogCX0KIAotCWlmICghcHNyMl9nbG9iYWxfZW5hYmxlZChkZXZfcHJpdikpIHsKKwlpZiAoIXBz
cjJfZ2xvYmFsX2VuYWJsZWQoaW50ZWxfZHApKSB7CiAJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+
ZHJtLCAiUFNSMiBkaXNhYmxlZCBieSBmbGFnXG4iKTsKIAkJcmV0dXJuIGZhbHNlOwogCX0KQEAg
LTc3MywxMCArNzcwLDEwIEBAIHN0YXRpYyBib29sIGludGVsX3BzcjJfY29uZmlnX3ZhbGlkKHN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJICogb25seSBuZWVkIHRvIHZhbGlkYXRlIHRoZSBT
VSBibG9jayB3aWR0aCBpcyBhIG11bHRpcGxlIG9mCiAJICogeCBncmFudWxhcml0eS4KIAkgKi8K
LQlpZiAoY3J0Y19oZGlzcGxheSAlIGRldl9wcml2LT5wc3Iuc3VfeF9ncmFudWxhcml0eSkgewor
CWlmIChjcnRjX2hkaXNwbGF5ICUgaW50ZWxfZHAtPnBzci5zdV94X2dyYW51bGFyaXR5KSB7CiAJ
CWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAogCQkJICAgICJQU1IyIG5vdCBlbmFibGVkLCBo
ZGlzcGxheSglZCkgbm90IG11bHRpcGxlIG9mICVkXG4iLAotCQkJICAgIGNydGNfaGRpc3BsYXks
IGRldl9wcml2LT5wc3Iuc3VfeF9ncmFudWxhcml0eSk7CisJCQkgICAgY3J0Y19oZGlzcGxheSwg
aW50ZWxfZHAtPnBzci5zdV94X2dyYW51bGFyaXR5KTsKIAkJcmV0dXJuIGZhbHNlOwogCX0KIApA
QCAtODExLDMwICs4MDgsMjUgQEAgdm9pZCBpbnRlbF9wc3JfY29tcHV0ZV9jb25maWcoc3RydWN0
IGludGVsX2RwICppbnRlbF9kcCwKIAkJJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CiAJ
aW50IHBzcl9zZXR1cF90aW1lOwogCi0JaWYgKCFDQU5fUFNSKGRldl9wcml2KSkKLQkJcmV0dXJu
OwotCi0JaWYgKGludGVsX2RwICE9IGRldl9wcml2LT5wc3IuZHApCisJaWYgKCFDQU5fUFNSKGlu
dGVsX2RwKSkKIAkJcmV0dXJuOwogCi0JaWYgKCFwc3JfZ2xvYmFsX2VuYWJsZWQoZGV2X3ByaXYp
KSB7CisJaWYgKCFwc3JfZ2xvYmFsX2VuYWJsZWQoaW50ZWxfZHApKSB7CiAJCWRybV9kYmdfa21z
KCZkZXZfcHJpdi0+ZHJtLCAiUFNSIGRpc2FibGVkIGJ5IGZsYWdcbiIpOwogCQlyZXR1cm47CiAJ
fQogCiAJLyoKIAkgKiBIU1cgc3BlYyBleHBsaWNpdGx5IHNheXMgUFNSIGlzIHRpZWQgdG8gcG9y
dCBBLgotCSAqIEJEVysgcGxhdGZvcm1zIGhhdmUgYSBpbnN0YW5jZSBvZiBQU1IgcmVnaXN0ZXJz
IHBlciB0cmFuc2NvZGVyIGJ1dAotCSAqIGZvciBub3cgaXQgb25seSBzdXBwb3J0cyBvbmUgaW5z
dGFuY2Ugb2YgUFNSLCBzbyBsZXRzIGtlZXAgaXQKLQkgKiBoYXJkY29kZWQgdG8gUE9SVF9BCisJ
ICogQkRXKyBwbGF0Zm9ybXMgaGF2ZSBhIGluc3RhbmNlIG9mIFBTUiByZWdpc3RlcnMgcGVyIHRy
YW5zY29kZXIuCiAJICovCi0JaWYgKGRpZ19wb3J0LT5iYXNlLnBvcnQgIT0gUE9SVF9BKSB7CisJ
aWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpICYmIGRpZ19wb3J0LT5iYXNlLnBvcnQgIT0gUE9SVF9B
KSB7CiAJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAogCQkJICAgICJQU1IgY29uZGl0aW9u
IGZhaWxlZDogUG9ydCBub3Qgc3VwcG9ydGVkXG4iKTsKIAkJcmV0dXJuOwogCX0KIAotCWlmIChk
ZXZfcHJpdi0+cHNyLnNpbmtfbm90X3JlbGlhYmxlKSB7CisJaWYgKGludGVsX2RwLT5wc3Iuc2lu
a19ub3RfcmVsaWFibGUpIHsKIAkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCiAJCQkgICAg
IlBTUiBzaW5rIGltcGxlbWVudGF0aW9uIGlzIG5vdCByZWxpYWJsZVxuIik7CiAJCXJldHVybjsK
QEAgLTg3MCwyMyArODYyLDI0IEBAIHZvaWQgaW50ZWxfcHNyX2NvbXB1dGVfY29uZmlnKHN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHAsCiBzdGF0aWMgdm9pZCBpbnRlbF9wc3JfYWN0aXZhdGUoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwllbnVtIHRyYW5zY29kZXIgdHJhbnNjb2Rl
ciA9IGludGVsX2RwLT5wc3IudHJhbnNjb2RlcjsKIAotCWlmICh0cmFuc2NvZGVyX2hhc19wc3Iy
KGRldl9wcml2LCBkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpKQorCWlmICh0cmFuc2NvZGVyX2hh
c19wc3IyKGRldl9wcml2LCB0cmFuc2NvZGVyKSkKIAkJZHJtX1dBUk5fT04oJmRldl9wcml2LT5k
cm0sCi0JCQkgICAgaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgRURQX1BTUjJfQ1RMKGRldl9wcml2
LT5wc3IudHJhbnNjb2RlcikpICYgRURQX1BTUjJfRU5BQkxFKTsKKwkJCSAgICBpbnRlbF9kZV9y
ZWFkKGRldl9wcml2LCBFRFBfUFNSMl9DVEwodHJhbnNjb2RlcikpICYgRURQX1BTUjJfRU5BQkxF
KTsKIAogCWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLAotCQkgICAgaW50ZWxfZGVfcmVhZChk
ZXZfcHJpdiwgRURQX1BTUl9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSkgJiBFRFBfUFNS
X0VOQUJMRSk7Ci0JZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIGRldl9wcml2LT5wc3IuYWN0
aXZlKTsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCQkgICAg
aW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgRURQX1BTUl9DVEwodHJhbnNjb2RlcikpICYgRURQX1BT
Ul9FTkFCTEUpOworCWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCBpbnRlbF9kcC0+cHNyLmFj
dGl2ZSk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaW50ZWxfZHAtPnBzci5sb2NrKTsKIAogCS8q
IHBzcjEgYW5kIHBzcjIgYXJlIG11dHVhbGx5IGV4Y2x1c2l2ZS4qLwotCWlmIChkZXZfcHJpdi0+
cHNyLnBzcjJfZW5hYmxlZCkKKwlpZiAoaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJsZWQpCiAJCWhz
d19hY3RpdmF0ZV9wc3IyKGludGVsX2RwKTsKIAllbHNlCiAJCWhzd19hY3RpdmF0ZV9wc3IxKGlu
dGVsX2RwKTsKIAotCWRldl9wcml2LT5wc3IuYWN0aXZlID0gdHJ1ZTsKKwlpbnRlbF9kcC0+cHNy
LmFjdGl2ZSA9IHRydWU7CiB9CiAKIHN0YXRpYyB2b2lkIGludGVsX3Bzcl9lbmFibGVfc291cmNl
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCkBAIC05MDIsNyArODk1LDcgQEAgc3RhdGljIHZv
aWQgaW50ZWxfcHNyX2VuYWJsZV9zb3VyY2Uoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAlp
ZiAoSVNfSEFTV0VMTChkZXZfcHJpdikgfHwgSVNfQlJPQURXRUxMKGRldl9wcml2KSkKIAkJaHN3
X3Bzcl9zZXR1cF9hdXgoaW50ZWxfZHApOwogCi0JaWYgKGRldl9wcml2LT5wc3IucHNyMl9lbmFi
bGVkICYmIChJU19HRU4oZGV2X3ByaXYsIDkpICYmCisJaWYgKGludGVsX2RwLT5wc3IucHNyMl9l
bmFibGVkICYmIChJU19HRU4oZGV2X3ByaXYsIDkpICYmCiAJCQkJCSAgICFJU19HRU1JTklMQUtF
KGRldl9wcml2KSkpIHsKIAkJaTkxNV9yZWdfdCByZWcgPSBDSElDS0VOX1RSQU5TKGNwdV90cmFu
c2NvZGVyKTsKIAkJdTMyIGNoaWNrZW4gPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCByZWcpOwpA
QCAtOTI2LDEwICs5MTksMTAgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHNyX2VuYWJsZV9zb3VyY2Uo
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDEx
KQogCQltYXNrIHw9IEVEUF9QU1JfREVCVUdfTUFTS19ESVNQX1JFR19XUklURTsKIAotCWludGVs
X2RlX3dyaXRlKGRldl9wcml2LCBFRFBfUFNSX0RFQlVHKGRldl9wcml2LT5wc3IudHJhbnNjb2Rl
ciksCisJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEVEUF9QU1JfREVCVUcoaW50ZWxfZHAtPnBz
ci50cmFuc2NvZGVyKSwKIAkJICAgICAgIG1hc2spOwogCi0JcHNyX2lycV9jb250cm9sKGRldl9w
cml2KTsKKwlwc3JfaXJxX2NvbnRyb2woaW50ZWxfZHApOwogCiAJaWYgKGNydGNfc3RhdGUtPmRj
M2NvX2V4aXRsaW5lKSB7CiAJCXUzMiB2YWw7CkBAIC05NDcsMzAgKzk0MCwzMCBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9wc3JfZW5hYmxlX3NvdXJjZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAog
CiAJaWYgKEhBU19QU1JfSFdfVFJBQ0tJTkcoZGV2X3ByaXYpICYmIEhBU19QU1IyX1NFTF9GRVRD
SChkZXZfcHJpdikpCiAJCWludGVsX2RlX3JtdyhkZXZfcHJpdiwgQ0hJQ0tFTl9QQVIxXzEsIElH
Tk9SRV9QU1IyX0hXX1RSQUNLSU5HLAotCQkJICAgICBkZXZfcHJpdi0+cHNyLnBzcjJfc2VsX2Zl
dGNoX2VuYWJsZWQgPworCQkJICAgICBpbnRlbF9kcC0+cHNyLnBzcjJfc2VsX2ZldGNoX2VuYWJs
ZWQgPwogCQkJICAgICBJR05PUkVfUFNSMl9IV19UUkFDS0lORyA6IDApOwogfQogCi1zdGF0aWMg
dm9pZCBpbnRlbF9wc3JfZW5hYmxlX2xvY2tlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCitzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZW5hYmxlX2xvY2tlZChzdHJ1Y3QgaW50ZWxf
ZHAgKmludGVsX2RwLAogCQkJCSAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSwKIAkJCQkgICAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5f
c3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGRldl9wcml2LT5wc3IuZHA7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9k
cCk7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90b19kaWdfcG9y
dChpbnRlbF9kcCk7CiAJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIgPSAmZGlnX3BvcnQt
PmJhc2U7CiAJdTMyIHZhbDsKIAotCWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCBkZXZfcHJp
di0+cHNyLmVuYWJsZWQpOworCWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCBpbnRlbF9kcC0+
cHNyLmVuYWJsZWQpOwogCi0JZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQgPSBjcnRjX3N0YXRl
LT5oYXNfcHNyMjsKLQlkZXZfcHJpdi0+cHNyLmJ1c3lfZnJvbnRidWZmZXJfYml0cyA9IDA7Ci0J
ZGV2X3ByaXYtPnBzci5waXBlID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMp
LT5waXBlOwotCWRldl9wcml2LT5wc3IuZGMzY29fZW5hYmxlZCA9ICEhY3J0Y19zdGF0ZS0+ZGMz
Y29fZXhpdGxpbmU7Ci0JZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyID0gY3J0Y19zdGF0ZS0+Y3B1
X3RyYW5zY29kZXI7CisJaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJsZWQgPSBjcnRjX3N0YXRlLT5o
YXNfcHNyMjsKKwlpbnRlbF9kcC0+cHNyLmJ1c3lfZnJvbnRidWZmZXJfYml0cyA9IDA7CisJaW50
ZWxfZHAtPnBzci5waXBlID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpLT5w
aXBlOworCWludGVsX2RwLT5wc3IuZGMzY29fZW5hYmxlZCA9ICEhY3J0Y19zdGF0ZS0+ZGMzY29f
ZXhpdGxpbmU7CisJaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyID0gY3J0Y19zdGF0ZS0+Y3B1X3Ry
YW5zY29kZXI7CiAJLyogREM1L0RDNiByZXF1aXJlcyBhdCBsZWFzdCA2IGlkbGUgZnJhbWVzICov
CiAJdmFsID0gdXNlY3NfdG9famlmZmllcyhpbnRlbF9nZXRfZnJhbWVfdGltZV91cyhjcnRjX3N0
YXRlKSAqIDYpOwotCWRldl9wcml2LT5wc3IuZGMzY29fZXhpdF9kZWxheSA9IHZhbDsKLQlkZXZf
cHJpdi0+cHNyLnBzcjJfc2VsX2ZldGNoX2VuYWJsZWQgPSBjcnRjX3N0YXRlLT5lbmFibGVfcHNy
Ml9zZWxfZmV0Y2g7CisJaW50ZWxfZHAtPnBzci5kYzNjb19leGl0X2RlbGF5ID0gdmFsOworCWlu
dGVsX2RwLT5wc3IucHNyMl9zZWxfZmV0Y2hfZW5hYmxlZCA9IGNydGNfc3RhdGUtPmVuYWJsZV9w
c3IyX3NlbF9mZXRjaDsKIAogCS8qCiAJICogSWYgYSBQU1IgZXJyb3IgaGFwcGVuZWQgYW5kIHRo
ZSBkcml2ZXIgaXMgcmVsb2FkZWQsIHRoZSBFRFBfUFNSX0lJUgpAQCAtOTgyLDI3ICs5NzUsMjcg
QEAgc3RhdGljIHZvaWQgaW50ZWxfcHNyX2VuYWJsZV9sb2NrZWQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAogCSAqLwogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKSB7
CiAJCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsCi0JCQkJICAgIFRSQU5TX1BTUl9JSVIo
ZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSk7CisJCQkJICAgIFRSQU5TX1BTUl9JSVIoaW50ZWxf
ZHAtPnBzci50cmFuc2NvZGVyKSk7CiAJCXZhbCAmPSBFRFBfUFNSX0VSUk9SKDApOwogCX0gZWxz
ZSB7CiAJCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIEVEUF9QU1JfSUlSKTsKLQkJdmFs
ICY9IEVEUF9QU1JfRVJST1IoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKTsKKwkJdmFsICY9IEVE
UF9QU1JfRVJST1IoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKTsKIAl9CiAJaWYgKHZhbCkgewot
CQlkZXZfcHJpdi0+cHNyLnNpbmtfbm90X3JlbGlhYmxlID0gdHJ1ZTsKKwkJaW50ZWxfZHAtPnBz
ci5zaW5rX25vdF9yZWxpYWJsZSA9IHRydWU7CiAJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJt
LAogCQkJICAgICJQU1IgaW50ZXJydXB0aW9uIGVycm9yIHNldCwgbm90IGVuYWJsaW5nIFBTUlxu
Iik7CiAJCXJldHVybjsKIAl9CiAKIAlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgIkVuYWJs
aW5nIFBTUiVzXG4iLAotCQkgICAgZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQgPyAiMiIgOiAi
MSIpOworCQkgICAgaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJsZWQgPyAiMiIgOiAiMSIpOwogCWlu
dGVsX2RwX2NvbXB1dGVfcHNyX3ZzY19zZHAoaW50ZWxfZHAsIGNydGNfc3RhdGUsIGNvbm5fc3Rh
dGUsCi0JCQkJICAgICAmZGV2X3ByaXYtPnBzci52c2MpOwotCWludGVsX3dyaXRlX2RwX3ZzY19z
ZHAoZW5jb2RlciwgY3J0Y19zdGF0ZSwgJmRldl9wcml2LT5wc3IudnNjKTsKKwkJCQkgICAgICZp
bnRlbF9kcC0+cHNyLnZzYyk7CisJaW50ZWxfd3JpdGVfZHBfdnNjX3NkcChlbmNvZGVyLCBjcnRj
X3N0YXRlLCAmaW50ZWxfZHAtPnBzci52c2MpOwogCWludGVsX3Bzcl9lbmFibGVfc2luayhpbnRl
bF9kcCk7CiAJaW50ZWxfcHNyX2VuYWJsZV9zb3VyY2UoaW50ZWxfZHAsIGNydGNfc3RhdGUpOwot
CWRldl9wcml2LT5wc3IuZW5hYmxlZCA9IHRydWU7CisJaW50ZWxfZHAtPnBzci5lbmFibGVkID0g
dHJ1ZTsKIAogCWludGVsX3Bzcl9hY3RpdmF0ZShpbnRlbF9kcCk7CiB9CkBAIC0xMDIxLDcgKzEw
MTQsNyBAQCB2b2lkIGludGVsX3Bzcl9lbmFibGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwK
IHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVs
X2RwKTsKIAotCWlmICghQ0FOX1BTUihkZXZfcHJpdikgfHwgZGV2X3ByaXYtPnBzci5kcCAhPSBp
bnRlbF9kcCkKKwlpZiAoIUNBTl9QU1IoaW50ZWxfZHApKQogCQlyZXR1cm47CiAKIAlpZiAoIWNy
dGNfc3RhdGUtPmhhc19wc3IpCkBAIC0xMDI5LDQ2ICsxMDIyLDQ3IEBAIHZvaWQgaW50ZWxfcHNy
X2VuYWJsZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCiAJZHJtX1dBUk5fT04oJmRldl9w
cml2LT5kcm0sIGRldl9wcml2LT5kcnJzLmRwKTsKIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5w
c3IubG9jayk7Ci0JaW50ZWxfcHNyX2VuYWJsZV9sb2NrZWQoZGV2X3ByaXYsIGNydGNfc3RhdGUs
IGNvbm5fc3RhdGUpOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRl
eF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOworCWludGVsX3Bzcl9lbmFibGVfbG9ja2VkKGlu
dGVsX2RwLCBjcnRjX3N0YXRlLCBjb25uX3N0YXRlKTsKKwltdXRleF91bmxvY2soJmludGVsX2Rw
LT5wc3IubG9jayk7CiB9CiAKLXN0YXRpYyB2b2lkIGludGVsX3Bzcl9leGl0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGludGVsX3Bzcl9leGl0KHN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJdTMyIHZhbDsKIAotCWlmICghZGV2X3ByaXYt
PnBzci5hY3RpdmUpIHsKLQkJaWYgKHRyYW5zY29kZXJfaGFzX3BzcjIoZGV2X3ByaXYsIGRldl9w
cml2LT5wc3IudHJhbnNjb2RlcikpIHsKKwlpZiAoIWludGVsX2RwLT5wc3IuYWN0aXZlKSB7CisJ
CWlmICh0cmFuc2NvZGVyX2hhc19wc3IyKGRldl9wcml2LCBpbnRlbF9kcC0+cHNyLnRyYW5zY29k
ZXIpKSB7CiAJCQl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LAotCQkJCQkgICAgRURQX1BT
UjJfQ1RMKGRldl9wcml2LT5wc3IudHJhbnNjb2RlcikpOworCQkJCQkgICAgRURQX1BTUjJfQ1RM
KGludGVsX2RwLT5wc3IudHJhbnNjb2RlcikpOwogCQkJZHJtX1dBUk5fT04oJmRldl9wcml2LT5k
cm0sIHZhbCAmIEVEUF9QU1IyX0VOQUJMRSk7CiAJCX0KIAogCQl2YWwgPSBpbnRlbF9kZV9yZWFk
KGRldl9wcml2LAotCQkJCSAgICBFRFBfUFNSX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIp
KTsKKwkJCQkgICAgRURQX1BTUl9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSk7CiAJCWRy
bV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCB2YWwgJiBFRFBfUFNSX0VOQUJMRSk7CiAKIAkJcmV0
dXJuOwogCX0KIAotCWlmIChkZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxlZCkgewotCQl0Z2xfZGlz
YWxsb3dfZGMzY29fb25fcHNyMl9leGl0KGRldl9wcml2KTsKKwlpZiAoaW50ZWxfZHAtPnBzci5w
c3IyX2VuYWJsZWQpIHsKKwkJdGdsX2Rpc2FsbG93X2RjM2NvX29uX3BzcjJfZXhpdChpbnRlbF9k
cCk7CiAJCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsCi0JCQkJICAgIEVEUF9QU1IyX0NU
TChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpKTsKKwkJCQkgICAgRURQX1BTUjJfQ1RMKGludGVs
X2RwLT5wc3IudHJhbnNjb2RlcikpOwogCQlkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwgISh2
YWwgJiBFRFBfUFNSMl9FTkFCTEUpKTsKIAkJdmFsICY9IH5FRFBfUFNSMl9FTkFCTEU7CiAJCWlu
dGVsX2RlX3dyaXRlKGRldl9wcml2LAotCQkJICAgICAgIEVEUF9QU1IyX0NUTChkZXZfcHJpdi0+
cHNyLnRyYW5zY29kZXIpLCB2YWwpOworCQkJICAgICAgIEVEUF9QU1IyX0NUTChpbnRlbF9kcC0+
cHNyLnRyYW5zY29kZXIpLCB2YWwpOwogCX0gZWxzZSB7CiAJCXZhbCA9IGludGVsX2RlX3JlYWQo
ZGV2X3ByaXYsCi0JCQkJICAgIEVEUF9QU1JfQ1RMKGRldl9wcml2LT5wc3IudHJhbnNjb2Rlcikp
OworCQkJCSAgICBFRFBfUFNSX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpKTsKIAkJZHJt
X1dBUk5fT04oJmRldl9wcml2LT5kcm0sICEodmFsICYgRURQX1BTUl9FTkFCTEUpKTsKIAkJdmFs
ICY9IH5FRFBfUFNSX0VOQUJMRTsKIAkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsCi0JCQkgICAg
ICAgRURQX1BTUl9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSwgdmFsKTsKKwkJCSAgICAg
ICBFRFBfUFNSX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpLCB2YWwpOwogCX0KLQlkZXZf
cHJpdi0+cHNyLmFjdGl2ZSA9IGZhbHNlOworCWludGVsX2RwLT5wc3IuYWN0aXZlID0gZmFsc2U7
CiB9CiAKIHN0YXRpYyB2b2lkIGludGVsX3Bzcl9kaXNhYmxlX2xvY2tlZChzdHJ1Y3QgaW50ZWxf
ZHAgKmludGVsX2RwKQpAQCAtMTA3NywyMSArMTA3MSwyMSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9w
c3JfZGlzYWJsZV9sb2NrZWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAlpOTE1X3JlZ190
IHBzcl9zdGF0dXM7CiAJdTMyIHBzcl9zdGF0dXNfbWFzazsKIAotCWxvY2tkZXBfYXNzZXJ0X2hl
bGQoJmRldl9wcml2LT5wc3IubG9jayk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaW50ZWxfZHAt
PnBzci5sb2NrKTsKIAotCWlmICghZGV2X3ByaXYtPnBzci5lbmFibGVkKQorCWlmICghaW50ZWxf
ZHAtPnBzci5lbmFibGVkKQogCQlyZXR1cm47CiAKIAlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRy
bSwgIkRpc2FibGluZyBQU1Ilc1xuIiwKLQkJICAgIGRldl9wcml2LT5wc3IucHNyMl9lbmFibGVk
ID8gIjIiIDogIjEiKTsKKwkJICAgIGludGVsX2RwLT5wc3IucHNyMl9lbmFibGVkID8gIjIiIDog
IjEiKTsKIAotCWludGVsX3Bzcl9leGl0KGRldl9wcml2KTsKKwlpbnRlbF9wc3JfZXhpdChpbnRl
bF9kcCk7CiAKLQlpZiAoZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQpIHsKLQkJcHNyX3N0YXR1
cyA9IEVEUF9QU1IyX1NUQVRVUyhkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpOworCWlmIChpbnRl
bF9kcC0+cHNyLnBzcjJfZW5hYmxlZCkgeworCQlwc3Jfc3RhdHVzID0gRURQX1BTUjJfU1RBVFVT
KGludGVsX2RwLT5wc3IudHJhbnNjb2Rlcik7CiAJCXBzcl9zdGF0dXNfbWFzayA9IEVEUF9QU1Iy
X1NUQVRVU19TVEFURV9NQVNLOwogCX0gZWxzZSB7Ci0JCXBzcl9zdGF0dXMgPSBFRFBfUFNSX1NU
QVRVUyhkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpOworCQlwc3Jfc3RhdHVzID0gRURQX1BTUl9T
VEFUVVMoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKTsKIAkJcHNyX3N0YXR1c19tYXNrID0gRURQ
X1BTUl9TVEFUVVNfU1RBVEVfTUFTSzsKIAl9CiAKQEAgLTExMDEsNyArMTA5NSw3IEBAIHN0YXRp
YyB2b2lkIGludGVsX3Bzcl9kaXNhYmxlX2xvY2tlZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2Rw
KQogCQlkcm1fZXJyKCZkZXZfcHJpdi0+ZHJtLCAiVGltZWQgb3V0IHdhaXRpbmcgUFNSIGlkbGUg
c3RhdGVcbiIpOwogCiAJLyogV0EgMTQwODMzMDg0NyAqLwotCWlmIChkZXZfcHJpdi0+cHNyLnBz
cjJfc2VsX2ZldGNoX2VuYWJsZWQgJiYKKwlpZiAoaW50ZWxfZHAtPnBzci5wc3IyX3NlbF9mZXRj
aF9lbmFibGVkICYmCiAJICAgIChJU19UR0xfRElTUF9SRVZJRChkZXZfcHJpdiwgVEdMX1JFVklE
X0EwLCBUR0xfUkVWSURfQTApIHx8CiAJICAgICBJU19SS0xfUkVWSUQoZGV2X3ByaXYsIFJLTF9S
RVZJRF9BMCwgUktMX1JFVklEX0EwKSkpCiAJCWludGVsX2RlX3JtdyhkZXZfcHJpdiwgQ0hJQ0tF
Tl9QQVIxXzEsCkBAIC0xMTEwLDEwICsxMTA0LDEwIEBAIHN0YXRpYyB2b2lkIGludGVsX3Bzcl9k
aXNhYmxlX2xvY2tlZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCS8qIERpc2FibGUgUFNS
IG9uIFNpbmsgKi8KIAlkcm1fZHBfZHBjZF93cml0ZWIoJmludGVsX2RwLT5hdXgsIERQX1BTUl9F
Tl9DRkcsIDApOwogCi0JaWYgKGRldl9wcml2LT5wc3IucHNyMl9lbmFibGVkKQorCWlmIChpbnRl
bF9kcC0+cHNyLnBzcjJfZW5hYmxlZCkKIAkJZHJtX2RwX2RwY2Rfd3JpdGViKCZpbnRlbF9kcC0+
YXV4LCBEUF9SRUNFSVZFUl9BTFBNX0NPTkZJRywgMCk7CiAKLQlkZXZfcHJpdi0+cHNyLmVuYWJs
ZWQgPSBmYWxzZTsKKwlpbnRlbF9kcC0+cHNyLmVuYWJsZWQgPSBmYWxzZTsKIH0KIAogLyoqCkBA
IC0xMTMxLDIwICsxMTI1LDIyIEBAIHZvaWQgaW50ZWxfcHNyX2Rpc2FibGUoc3RydWN0IGludGVs
X2RwICppbnRlbF9kcCwKIAlpZiAoIW9sZF9jcnRjX3N0YXRlLT5oYXNfcHNyKQogCQlyZXR1cm47
CiAKLQlpZiAoZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sICFDQU5fUFNSKGRldl9wcml2KSkp
CisJaWYgKGRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCAhQ0FOX1BTUihpbnRlbF9kcCkpKQog
CQlyZXR1cm47CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCW11dGV4X2xv
Y2soJmludGVsX2RwLT5wc3IubG9jayk7CiAKIAlpbnRlbF9wc3JfZGlzYWJsZV9sb2NrZWQoaW50
ZWxfZHApOwogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOwotCWNhbmNlbF93
b3JrX3N5bmMoJmRldl9wcml2LT5wc3Iud29yayk7Ci0JY2FuY2VsX2RlbGF5ZWRfd29ya19zeW5j
KCZkZXZfcHJpdi0+cHNyLmRjM2NvX3dvcmspOworCW11dGV4X3VubG9jaygmaW50ZWxfZHAtPnBz
ci5sb2NrKTsKKwljYW5jZWxfd29ya19zeW5jKCZpbnRlbF9kcC0+cHNyLndvcmspOworCWNhbmNl
bF9kZWxheWVkX3dvcmtfc3luYygmaW50ZWxfZHAtPnBzci5kYzNjb193b3JrKTsKIH0KIAotc3Rh
dGljIHZvaWQgcHNyX2ZvcmNlX2h3X3RyYWNraW5nX2V4aXQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgcHNyX2ZvcmNlX2h3X3RyYWNraW5nX2V4aXQoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwogCWlmIChJU19USUdFUkxBS0UoZGV2X3By
aXYpKQogCQkvKgogCQkgKiBXcml0ZXMgdG8gQ1VSU1VSRkxJVkUgaW4gVEdMIGFyZSBjYXVzaW5n
IElPTU1VIGVycm9ycyBhbmQKQEAgLTExNTgsNyArMTE1NCw3IEBAIHN0YXRpYyB2b2lkIHBzcl9m
b3JjZV9od190cmFja2luZ19leGl0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
IAkJICogU28gdXNpbmcgdGhpcyB3b3JrYXJvdW5kIHVudGlsIHRoaXMgaXNzdWUgaXMgcm9vdCBj
YXVzZWQKIAkJICogYW5kIGEgYmV0dGVyIGZpeCBpcyBmb3VuZC4KIAkJICovCi0JCWludGVsX3Bz
cl9leGl0KGRldl9wcml2KTsKKwkJaW50ZWxfcHNyX2V4aXQoaW50ZWxfZHApOwogCWVsc2UgaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkKIAkJLyoKIAkJICogRGlzcGxheSBXQSAjMDg4NDog
c2tsKwpAQCAtMTE2OSwxMyArMTE2NSwxMyBAQCBzdGF0aWMgdm9pZCBwc3JfZm9yY2VfaHdfdHJh
Y2tpbmdfZXhpdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCSAqIGJ1dCBp
dCBtYWtlcyBtb3JlIHNlbnNlIHdyaXRlIHRvIHRoZSBjdXJyZW50IGFjdGl2ZQogCQkgKiBwaXBl
LgogCQkgKi8KLQkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIENVUlNVUkZMSVZFKGRldl9wcml2
LT5wc3IucGlwZSksIDApOworCQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgQ1VSU1VSRkxJVkUo
aW50ZWxfZHAtPnBzci5waXBlKSwgMCk7CiAJZWxzZQogCQkvKgogCQkgKiBBIHdyaXRlIHRvIENV
UlNVUkZMSVZFIGRvIG5vdCBjYXVzZSBIVyB0cmFja2luZyB0byBleGl0IFBTUgogCQkgKiBvbiBv
bGRlciBnZW5zIHNvIGRvaW5nIHRoZSBtYW51YWwgZXhpdCBpbnN0ZWFkLgogCQkgKi8KLQkJaW50
ZWxfcHNyX2V4aXQoZGV2X3ByaXYpOworCQlpbnRlbF9wc3JfZXhpdChpbnRlbF9kcCk7CiB9CiAK
IHZvaWQgaW50ZWxfcHNyMl9wcm9ncmFtX3BsYW5lX3NlbF9mZXRjaChzdHJ1Y3QgaW50ZWxfcGxh
bmUgKnBsYW5lLApAQCAtMTIxNSwxMSArMTIxMSwxMSBAQCB2b2lkIGludGVsX3BzcjJfcHJvZ3Jh
bV9wbGFuZV9zZWxfZmV0Y2goc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAlpbnRlbF9kZV93
cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfU0VMX0ZFVENIX1NJWkUocGlwZSwgcGxhbmUtPmlkKSwg
dmFsKTsKIH0KIAotdm9pZCBpbnRlbF9wc3IyX3Byb2dyYW1fdHJhbnNfbWFuX3Rya19jdGwoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit2b2lkIGludGVsX3BzcjJf
cHJvZ3JhbV90cmFuc19tYW5fdHJrX2N0bChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAorCQkJ
CQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMp
OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFz
ZS5kZXYpOwotCXN0cnVjdCBpOTE1X3BzciAqcHNyID0gJmRldl9wcml2LT5wc3I7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisJc3Ry
dWN0IGludGVsX3BzciAqcHNyID0gJmludGVsX2RwLT5wc3I7CiAKIAlpZiAoIUhBU19QU1IyX1NF
TF9GRVRDSChkZXZfcHJpdikgfHwKIAkgICAgIWNydGNfc3RhdGUtPmVuYWJsZV9wc3IyX3NlbF9m
ZXRjaCkKQEAgLTEzMzYsMTMgKzEzMzIsMTMgQEAgdm9pZCBpbnRlbF9wc3JfdXBkYXRlKHN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCSAgICAgIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9y
X3N0YXRlICpjb25uX3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwotCXN0cnVjdCBpOTE1X3BzciAqcHNyID0gJmRldl9w
cml2LT5wc3I7CisJc3RydWN0IGludGVsX3BzciAqcHNyID0gJmludGVsX2RwLT5wc3I7CiAJYm9v
bCBlbmFibGUsIHBzcjJfZW5hYmxlOwogCi0JaWYgKCFDQU5fUFNSKGRldl9wcml2KSB8fCBSRUFE
X09OQ0UocHNyLT5kcCkgIT0gaW50ZWxfZHApCisJaWYgKCFDQU5fUFNSKGludGVsX2RwKSkKIAkJ
cmV0dXJuOwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRleF9sb2Nr
KCZpbnRlbF9kcC0+cHNyLmxvY2spOwogCiAJZW5hYmxlID0gY3J0Y19zdGF0ZS0+aGFzX3BzcjsK
IAlwc3IyX2VuYWJsZSA9IGNydGNfc3RhdGUtPmhhc19wc3IyOwpAQCAtMTM1MCwxNSArMTM0Niwx
NSBAQCB2b2lkIGludGVsX3Bzcl91cGRhdGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAlp
ZiAoZW5hYmxlID09IHBzci0+ZW5hYmxlZCAmJiBwc3IyX2VuYWJsZSA9PSBwc3ItPnBzcjJfZW5h
YmxlZCkgewogCQkvKiBGb3JjZSBhIFBTUiBleGl0IHdoZW4gZW5hYmxpbmcgQ1JDIHRvIGF2b2lk
IENSQyB0aW1lb3V0cyAqLwogCQlpZiAoY3J0Y19zdGF0ZS0+Y3JjX2VuYWJsZWQgJiYgcHNyLT5l
bmFibGVkKQotCQkJcHNyX2ZvcmNlX2h3X3RyYWNraW5nX2V4aXQoZGV2X3ByaXYpOworCQkJcHNy
X2ZvcmNlX2h3X3RyYWNraW5nX2V4aXQoaW50ZWxfZHApOwogCQllbHNlIGlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpIDwgOSAmJiBwc3ItPmVuYWJsZWQpIHsKIAkJCS8qCiAJCQkgKiBBY3RpdmF0ZSBQ
U1IgYWdhaW4gYWZ0ZXIgYSBmb3JjZSBleGl0IHdoZW4gZW5hYmxpbmcKIAkJCSAqIENSQyBpbiBv
bGRlciBnZW5zCiAJCQkgKi8KLQkJCWlmICghZGV2X3ByaXYtPnBzci5hY3RpdmUgJiYKLQkJCSAg
ICAhZGV2X3ByaXYtPnBzci5idXN5X2Zyb250YnVmZmVyX2JpdHMpCi0JCQkJc2NoZWR1bGVfd29y
aygmZGV2X3ByaXYtPnBzci53b3JrKTsKKwkJCWlmICghaW50ZWxfZHAtPnBzci5hY3RpdmUgJiYK
KwkJCSAgICAhaW50ZWxfZHAtPnBzci5idXN5X2Zyb250YnVmZmVyX2JpdHMpCisJCQkJc2NoZWR1
bGVfd29yaygmaW50ZWxfZHAtPnBzci53b3JrKTsKIAkJfQogCiAJCWdvdG8gdW5sb2NrOwpAQCAt
MTM2OCwzNCArMTM2NCwyMyBAQCB2b2lkIGludGVsX3Bzcl91cGRhdGUoc3RydWN0IGludGVsX2Rw
ICppbnRlbF9kcCwKIAkJaW50ZWxfcHNyX2Rpc2FibGVfbG9ja2VkKGludGVsX2RwKTsKIAogCWlm
IChlbmFibGUpCi0JCWludGVsX3Bzcl9lbmFibGVfbG9ja2VkKGRldl9wcml2LCBjcnRjX3N0YXRl
LCBjb25uX3N0YXRlKTsKKwkJaW50ZWxfcHNyX2VuYWJsZV9sb2NrZWQoaW50ZWxfZHAsIGNydGNf
c3RhdGUsIGNvbm5fc3RhdGUpOwogCiB1bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+
cHNyLmxvY2spOworCW11dGV4X3VubG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKIH0KIAogLyoq
Ci0gKiBpbnRlbF9wc3Jfd2FpdF9mb3JfaWRsZSAtIHdhaXQgZm9yIFBTUjEgdG8gaWRsZQotICog
QG5ld19jcnRjX3N0YXRlOiBuZXcgQ1JUQyBzdGF0ZQorICogcHNyX3dhaXRfZm9yX2lkbGUgLSB3
YWl0IGZvciBQU1IxIHRvIGlkbGUKKyAqIEBpbnRlbF9kcDogSW50ZWwgRFAKICAqIEBvdXRfdmFs
dWU6IFBTUiBzdGF0dXMgaW4gY2FzZSBvZiBmYWlsdXJlCiAgKgotICogVGhpcyBmdW5jdGlvbiBp
cyBleHBlY3RlZCB0byBiZSBjYWxsZWQgZnJvbSBwaXBlX3VwZGF0ZV9zdGFydCgpIHdoZXJlIGl0
IGlzCi0gKiBub3QgZXhwZWN0ZWQgdG8gcmFjZSB3aXRoIFBTUiBlbmFibGUgb3IgZGlzYWJsZS4K
LSAqCiAgKiBSZXR1cm5zOiAwIG9uIHN1Y2Nlc3Mgb3IgLUVUSU1FT1VUIGlmIFBTUiBzdGF0dXMg
ZG9lcyBub3QgaWRsZS4KKyAqCiAgKi8KLWludCBpbnRlbF9wc3Jfd2FpdF9mb3JfaWRsZShjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUsCi0JCQkgICAgdTMyICpv
dXRfdmFsdWUpCitzdGF0aWMgaW50IHBzcl93YWl0X2Zvcl9pZGxlKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHAsIHUzMiAqb3V0X3ZhbHVlKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0g
dG9faW50ZWxfY3J0YyhuZXdfY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKLQotCWlmICgh
ZGV2X3ByaXYtPnBzci5lbmFibGVkIHx8ICFuZXdfY3J0Y19zdGF0ZS0+aGFzX3BzcikKLQkJcmV0
dXJuIDA7Ci0KLQkvKiBGSVhNRTogVXBkYXRlIHRoaXMgZm9yIFBTUjIgaWYgd2UgbmVlZCB0byB3
YWl0IGZvciBpZGxlICovCi0JaWYgKFJFQURfT05DRShkZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxl
ZCkpCi0JCXJldHVybiAwOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRw
X3RvX2k5MTUoaW50ZWxfZHApOwogCiAJLyoKIAkgKiBGcm9tIGJzcGVjOiBQYW5lbCBTZWxmIFJl
ZnJlc2ggKEJEVyspCkBAIC0xNDAzLDMyICsxMzg4LDY0IEBAIGludCBpbnRlbF9wc3Jfd2FpdF9m
b3JfaWRsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUsCiAJ
ICogZXhpdCB0cmFpbmluZyB0aW1lICsgMS41IG1zIG9mIGF1eCBjaGFubmVsIGhhbmRzaGFrZS4g
NTAgbXMgaXMKIAkgKiBkZWZlbnNpdmUgZW5vdWdoIHRvIGNvdmVyIGV2ZXJ5dGhpbmcuCiAJICov
Ci0KIAlyZXR1cm4gX19pbnRlbF93YWl0X2Zvcl9yZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwK
LQkJCQkJIEVEUF9QU1JfU1RBVFVTKGRldl9wcml2LT5wc3IudHJhbnNjb2RlciksCisJCQkJCSBF
RFBfUFNSX1NUQVRVUyhpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpLAogCQkJCQkgRURQX1BTUl9T
VEFUVVNfU1RBVEVfTUFTSywKIAkJCQkJIEVEUF9QU1JfU1RBVFVTX1NUQVRFX0lETEUsIDIsIDUw
LAogCQkJCQkgb3V0X3ZhbHVlKTsKIH0KIAotc3RhdGljIGJvb2wgX19wc3Jfd2FpdF9mb3JfaWRs
ZV9sb2NrZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorLyoqCisgKiBpbnRl
bF9wc3Jfd2FpdF9mb3JfaWRsZSAtIHdhaXQgZm9yIFBTUjEgdG8gaWRsZQorICogQG5ld19jcnRj
X3N0YXRlOiBuZXcgQ1JUQyBzdGF0ZQorICoKKyAqIFRoaXMgZnVuY3Rpb24gaXMgZXhwZWN0ZWQg
dG8gYmUgY2FsbGVkIGZyb20gcGlwZV91cGRhdGVfc3RhcnQoKSB3aGVyZSBpdCBpcworICogbm90
IGV4cGVjdGVkIHRvIHJhY2Ugd2l0aCBQU1IgZW5hYmxlIG9yIGRpc2FibGUuCisgKi8KK3ZvaWQg
aW50ZWxfcHNyX3dhaXRfZm9yX2lkbGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5l
d19jcnRjX3N0YXRlKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUobmV3X2NydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfZW5j
b2RlciAqZW5jb2RlcjsKKwl1MzIgcHNyX3N0YXR1czsKKworCWlmICghbmV3X2NydGNfc3RhdGUt
Pmhhc19wc3IpCisJCXJldHVybjsKKworCWZvcl9lYWNoX2ludGVsX2RwKCZkZXZfcHJpdi0+ZHJt
LCBlbmNvZGVyKSB7CisJCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxf
ZHAoZW5jb2Rlcik7CisKKwkJaWYgKGVuY29kZXItPnR5cGUgIT0gSU5URUxfT1VUUFVUX0VEUCkK
KwkJCWNvbnRpbnVlOworCisJCS8qIHdoZW4gdGhlIFBTUjEgaXMgZW5hYmxlZCAqLworCQlpZiAo
aW50ZWxfZHAtPnBzci5lbmFibGVkICYmICFpbnRlbF9kcC0+cHNyLnBzcjJfZW5hYmxlZCkgewor
CQkJaWYgKHBzcl93YWl0X2Zvcl9pZGxlKGludGVsX2RwLCAmcHNyX3N0YXR1cykpCisJCQkJZHJt
X2VycigmZGV2X3ByaXYtPmRybSwKKwkJCQkJIlBTUiBpZGxlIHRpbWVkIG91dCAweCV4LCBhdG9t
aWMgdXBkYXRlIG1heSBmYWlsXG4iLAorCQkJCQlwc3Jfc3RhdHVzKTsKKwkJfQorCX0KK30KKwor
c3RhdGljIGJvb2wgX19wc3Jfd2FpdF9mb3JfaWRsZV9sb2NrZWQoc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCkKIHsKIAlpOTE1X3JlZ190IHJlZzsKIAl1MzIgbWFzazsKIAlpbnQgZXJyOworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwog
Ci0JaWYgKCFkZXZfcHJpdi0+cHNyLmVuYWJsZWQpCisJaWYgKCFpbnRlbF9kcC0+cHNyLmVuYWJs
ZWQpCiAJCXJldHVybiBmYWxzZTsKIAotCWlmIChkZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxlZCkg
ewotCQlyZWcgPSBFRFBfUFNSMl9TVEFUVVMoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKTsKKwlp
ZiAoaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJsZWQpIHsKKwkJcmVnID0gRURQX1BTUjJfU1RBVFVT
KGludGVsX2RwLT5wc3IudHJhbnNjb2Rlcik7CiAJCW1hc2sgPSBFRFBfUFNSMl9TVEFUVVNfU1RB
VEVfTUFTSzsKIAl9IGVsc2UgewotCQlyZWcgPSBFRFBfUFNSX1NUQVRVUyhkZXZfcHJpdi0+cHNy
LnRyYW5zY29kZXIpOworCQlyZWcgPSBFRFBfUFNSX1NUQVRVUyhpbnRlbF9kcC0+cHNyLnRyYW5z
Y29kZXIpOwogCQltYXNrID0gRURQX1BTUl9TVEFUVVNfU1RBVEVfTUFTSzsKIAl9CiAKLQltdXRl
eF91bmxvY2soJmRldl9wcml2LT5wc3IubG9jayk7CisJbXV0ZXhfdW5sb2NrKCZpbnRlbF9kcC0+
cHNyLmxvY2spOwogCiAJZXJyID0gaW50ZWxfZGVfd2FpdF9mb3JfY2xlYXIoZGV2X3ByaXYsIHJl
ZywgbWFzaywgNTApOwogCWlmIChlcnIpCkBAIC0xNDM2LDggKzE0NTMsOCBAQCBzdGF0aWMgYm9v
bCBfX3Bzcl93YWl0X2Zvcl9pZGxlX2xvY2tlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCiAJCQkiVGltZWQgb3V0IHdhaXRpbmcgZm9yIFBTUiBJZGxlIGZvciByZS1lbmFibGVc
biIpOwogCiAJLyogQWZ0ZXIgdGhlIHVubG9ja2VkIHdhaXQsIHZlcmlmeSB0aGF0IFBTUiBpcyBz
dGlsbCB3YW50ZWQhICovCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKLQlyZXR1
cm4gZXJyID09IDAgJiYgZGV2X3ByaXYtPnBzci5lbmFibGVkOworCW11dGV4X2xvY2soJmludGVs
X2RwLT5wc3IubG9jayk7CisJcmV0dXJuIGVyciA9PSAwICYmIGludGVsX2RwLT5wc3IuZW5hYmxl
ZDsKIH0KIAogc3RhdGljIGludCBpbnRlbF9wc3JfZmFzdHNldF9mb3JjZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCkBAIC0xNTAzLDExICsxNTIwLDEyIEBAIHN0YXRpYyBpbnQg
aW50ZWxfcHNyX2Zhc3RzZXRfZm9yY2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQogCXJldHVybiBlcnI7CiB9CiAKLWludCBpbnRlbF9wc3JfZGVidWdfc2V0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTY0IHZhbCkKK2ludCBpbnRlbF9wc3JfZGVidWdfc2V0
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIHU2NCB2YWwpCiB7CiAJY29uc3QgdTMyIG1vZGUg
PSB2YWwgJiBJOTE1X1BTUl9ERUJVR19NT0RFX01BU0s7CiAJdTMyIG9sZF9tb2RlOwogCWludCBy
ZXQ7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRl
bF9kcCk7CiAKIAlpZiAodmFsICYgfihJOTE1X1BTUl9ERUJVR19JUlEgfCBJOTE1X1BTUl9ERUJV
R19NT0RFX01BU0spIHx8CiAJICAgIG1vZGUgPiBJOTE1X1BTUl9ERUJVR19GT1JDRV9QU1IxKSB7
CkBAIC0xNTE1LDIxICsxNTMzLDIxIEBAIGludCBpbnRlbF9wc3JfZGVidWdfc2V0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTY0IHZhbCkKIAkJcmV0dXJuIC1FSU5WQUw7CiAJ
fQogCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZkZXZfcHJpdi0+cHNyLmxvY2sp
OworCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmaW50ZWxfZHAtPnBzci5sb2NrKTsK
IAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0Jb2xkX21vZGUgPSBkZXZfcHJpdi0+cHNyLmRl
YnVnICYgSTkxNV9QU1JfREVCVUdfTU9ERV9NQVNLOwotCWRldl9wcml2LT5wc3IuZGVidWcgPSB2
YWw7CisJb2xkX21vZGUgPSBpbnRlbF9kcC0+cHNyLmRlYnVnICYgSTkxNV9QU1JfREVCVUdfTU9E
RV9NQVNLOworCWludGVsX2RwLT5wc3IuZGVidWcgPSB2YWw7CiAKIAkvKgogCSAqIERvIGl0IHJp
Z2h0IGF3YXkgaWYgaXQncyBhbHJlYWR5IGVuYWJsZWQsIG90aGVyd2lzZSBpdCB3aWxsIGJlIGRv
bmUKIAkgKiB3aGVuIGVuYWJsaW5nIHRoZSBzb3VyY2UuCiAJICovCi0JaWYgKGRldl9wcml2LT5w
c3IuZW5hYmxlZCkKLQkJcHNyX2lycV9jb250cm9sKGRldl9wcml2KTsKKwlpZiAoaW50ZWxfZHAt
PnBzci5lbmFibGVkKQorCQlwc3JfaXJxX2NvbnRyb2woaW50ZWxfZHApOwogCi0JbXV0ZXhfdW5s
b2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCW11dGV4X3VubG9jaygmaW50ZWxfZHAtPnBzci5s
b2NrKTsKIAogCWlmIChvbGRfbW9kZSAhPSBtb2RlKQogCQlyZXQgPSBpbnRlbF9wc3JfZmFzdHNl
dF9mb3JjZShkZXZfcHJpdik7CkBAIC0xNTM3LDI4ICsxNTU1LDI4IEBAIGludCBpbnRlbF9wc3Jf
ZGVidWdfc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTY0IHZhbCkKIAly
ZXR1cm4gcmV0OwogfQogCi1zdGF0aWMgdm9pZCBpbnRlbF9wc3JfaGFuZGxlX2lycShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBpbnRlbF9wc3JfaGFuZGxl
X2lycShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewotCXN0cnVjdCBpOTE1X3BzciAqcHNy
ID0gJmRldl9wcml2LT5wc3I7CisJc3RydWN0IGludGVsX3BzciAqcHNyID0gJmludGVsX2RwLT5w
c3I7CiAKLQlpbnRlbF9wc3JfZGlzYWJsZV9sb2NrZWQocHNyLT5kcCk7CisJaW50ZWxfcHNyX2Rp
c2FibGVfbG9ja2VkKGludGVsX2RwKTsKIAlwc3ItPnNpbmtfbm90X3JlbGlhYmxlID0gdHJ1ZTsK
IAkvKiBsZXQncyBtYWtlIHN1cmUgdGhhdCBzaW5rIGlzIGF3YWtlbiAqLwotCWRybV9kcF9kcGNk
X3dyaXRlYigmcHNyLT5kcC0+YXV4LCBEUF9TRVRfUE9XRVIsIERQX1NFVF9QT1dFUl9EMCk7CisJ
ZHJtX2RwX2RwY2Rfd3JpdGViKCZpbnRlbF9kcC0+YXV4LCBEUF9TRVRfUE9XRVIsIERQX1NFVF9Q
T1dFUl9EMCk7CiB9CiAKIHN0YXRpYyB2b2lkIGludGVsX3Bzcl93b3JrKHN0cnVjdCB3b3JrX3N0
cnVjdCAqd29yaykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQotCQlj
b250YWluZXJfb2Yod29yaywgdHlwZW9mKCpkZXZfcHJpdiksIHBzci53b3JrKTsKKwlzdHJ1Y3Qg
aW50ZWxfZHAgKmludGVsX2RwID0KKwkJY29udGFpbmVyX29mKHdvcmssIHR5cGVvZigqaW50ZWxf
ZHApLCBwc3Iud29yayk7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCW11
dGV4X2xvY2soJmludGVsX2RwLT5wc3IubG9jayk7CiAKLQlpZiAoIWRldl9wcml2LT5wc3IuZW5h
YmxlZCkKKwlpZiAoIWludGVsX2RwLT5wc3IuZW5hYmxlZCkKIAkJZ290byB1bmxvY2s7CiAKLQlp
ZiAoUkVBRF9PTkNFKGRldl9wcml2LT5wc3IuaXJxX2F1eF9lcnJvcikpCi0JCWludGVsX3Bzcl9o
YW5kbGVfaXJxKGRldl9wcml2KTsKKwlpZiAoUkVBRF9PTkNFKGludGVsX2RwLT5wc3IuaXJxX2F1
eF9lcnJvcikpCisJCWludGVsX3Bzcl9oYW5kbGVfaXJxKGludGVsX2RwKTsKIAogCS8qCiAJICog
V2UgaGF2ZSB0byBtYWtlIHN1cmUgUFNSIGlzIHJlYWR5IGZvciByZS1lbmFibGUKQEAgLTE1NjYs
NyArMTU4NCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3Bzcl93b3JrKHN0cnVjdCB3b3JrX3N0cnVj
dCAqd29yaykKIAkgKiBQU1IgbWlnaHQgdGFrZSBzb21lIHRpbWUgdG8gZ2V0IGZ1bGx5IGRpc2Fi
bGVkCiAJICogYW5kIGJlIHJlYWR5IGZvciByZS1lbmFibGUuCiAJICovCi0JaWYgKCFfX3Bzcl93
YWl0X2Zvcl9pZGxlX2xvY2tlZChkZXZfcHJpdikpCisJaWYgKCFfX3Bzcl93YWl0X2Zvcl9pZGxl
X2xvY2tlZChpbnRlbF9kcCkpCiAJCWdvdG8gdW5sb2NrOwogCiAJLyoKQEAgLTE1NzQsMTIgKzE1
OTIsMTIgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHNyX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3
b3JrKQogCSAqIHJlY2hlY2suIFNpbmNlIHBzcl9mbHVzaCBmaXJzdCBjbGVhcnMgdGhpcyBhbmQg
dGhlbiByZXNjaGVkdWxlcyB3ZQogCSAqIHdvbid0IGV2ZXIgbWlzcyBhIGZsdXNoIHdoZW4gYmFp
bGluZyBvdXQgaGVyZS4KIAkgKi8KLQlpZiAoZGV2X3ByaXYtPnBzci5idXN5X2Zyb250YnVmZmVy
X2JpdHMgfHwgZGV2X3ByaXYtPnBzci5hY3RpdmUpCisJaWYgKGludGVsX2RwLT5wc3IuYnVzeV9m
cm9udGJ1ZmZlcl9iaXRzIHx8IGludGVsX2RwLT5wc3IuYWN0aXZlKQogCQlnb3RvIHVubG9jazsK
IAotCWludGVsX3Bzcl9hY3RpdmF0ZShkZXZfcHJpdi0+cHNyLmRwKTsKKwlpbnRlbF9wc3JfYWN0
aXZhdGUoaW50ZWxfZHApOwogdW5sb2NrOgotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5s
b2NrKTsKKwltdXRleF91bmxvY2soJmludGVsX2RwLT5wc3IubG9jayk7CiB9CiAKIC8qKgpAQCAt
MTU5OCwyNyArMTYxNiwzNSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wc3Jfd29yayhzdHJ1Y3Qgd29y
a19zdHJ1Y3QgKndvcmspCiB2b2lkIGludGVsX3Bzcl9pbnZhbGlkYXRlKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCSAgdW5zaWduZWQgZnJvbnRidWZmZXJfYml0cywgZW51
bSBmYl9vcF9vcmlnaW4gb3JpZ2luKQogewotCWlmICghQ0FOX1BTUihkZXZfcHJpdikpCi0JCXJl
dHVybjsKKwlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKKwlzdHJ1Y3QgaW50ZWxfZHAg
KmludGVsX2RwOwogCi0JaWYgKG9yaWdpbiA9PSBPUklHSU5fRkxJUCkKLQkJcmV0dXJuOworCWZv
cl9lYWNoX2ludGVsX2RwKCZkZXZfcHJpdi0+ZHJtLCBlbmNvZGVyKSB7CiAKLQltdXRleF9sb2Nr
KCZkZXZfcHJpdi0+cHNyLmxvY2spOwotCWlmICghZGV2X3ByaXYtPnBzci5lbmFibGVkKSB7Ci0J
CW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKLQkJcmV0dXJuOwotCX0KKwkJaW50
ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5jb2Rlcik7CisJCWlmIChlbmNvZGVyLT50eXBlICE9
IElOVEVMX09VVFBVVF9FRFApCisJCQljb250aW51ZTsKKwkJaWYgKCFDQU5fUFNSKGludGVsX2Rw
KSkKKwkJCWNvbnRpbnVlOwogCi0JZnJvbnRidWZmZXJfYml0cyAmPSBJTlRFTF9GUk9OVEJVRkZF
Ul9BTExfTUFTSyhkZXZfcHJpdi0+cHNyLnBpcGUpOwotCWRldl9wcml2LT5wc3IuYnVzeV9mcm9u
dGJ1ZmZlcl9iaXRzIHw9IGZyb250YnVmZmVyX2JpdHM7CisJCWlmIChvcmlnaW4gPT0gT1JJR0lO
X0ZMSVApCisJCQljb250aW51ZTsKKworCQltdXRleF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2sp
OworCQlpZiAoIWludGVsX2RwLT5wc3IuZW5hYmxlZCkgeworCQkJbXV0ZXhfdW5sb2NrKCZpbnRl
bF9kcC0+cHNyLmxvY2spOworCQkJY29udGludWU7CisJCX0KIAotCWlmIChmcm9udGJ1ZmZlcl9i
aXRzKQotCQlpbnRlbF9wc3JfZXhpdChkZXZfcHJpdik7CisJCWZyb250YnVmZmVyX2JpdHMgJj0g
SU5URUxfRlJPTlRCVUZGRVJfQUxMX01BU0soaW50ZWxfZHAtPnBzci5waXBlKTsKKwkJaW50ZWxf
ZHAtPnBzci5idXN5X2Zyb250YnVmZmVyX2JpdHMgfD0gZnJvbnRidWZmZXJfYml0czsKIAotCW11
dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKLX0KKwkJaWYgKGZyb250YnVmZmVyX2Jp
dHMpCisJCQlpbnRlbF9wc3JfZXhpdChpbnRlbF9kcCk7CiAKKwkJbXV0ZXhfdW5sb2NrKCZpbnRl
bF9kcC0+cHNyLmxvY2spOworCX0KK30KIC8qCiAgKiBXaGVuIHdlIHdpbGwgYmUgY29tcGxldGVs
eSByZWx5IG9uIFBTUjIgUy9XIHRyYWNraW5nIGluIGZ1dHVyZSwKICAqIGludGVsX3Bzcl9mbHVz
aCgpIHdpbGwgaW52YWxpZGF0ZSBhbmQgZmx1c2ggdGhlIFBTUiBmb3IgT1JJR0lOX0ZMSVAKQEAg
LTE2MjYsMTUgKzE2NTIsMTUgQEAgdm9pZCBpbnRlbF9wc3JfaW52YWxpZGF0ZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAgKiBhY2NvcmRpbmdseSBpbiBmdXR1cmUuCiAgKi8K
IHN0YXRpYyB2b2lkCi10Z2xfZGMzY29fZmx1c2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAotCQl1bnNpZ25lZCBpbnQgZnJvbnRidWZmZXJfYml0cywgZW51bSBmYl9vcF9vcmln
aW4gb3JpZ2luKQordGdsX2RjM2NvX2ZsdXNoKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIHVu
c2lnbmVkIGludCBmcm9udGJ1ZmZlcl9iaXRzLAorCQllbnVtIGZiX29wX29yaWdpbiBvcmlnaW4p
CiB7Ci0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRleF9sb2NrKCZpbnRl
bF9kcC0+cHNyLmxvY2spOwogCi0JaWYgKCFkZXZfcHJpdi0+cHNyLmRjM2NvX2VuYWJsZWQpCisJ
aWYgKCFpbnRlbF9kcC0+cHNyLmRjM2NvX2VuYWJsZWQpCiAJCWdvdG8gdW5sb2NrOwogCi0JaWYg
KCFkZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxlZCB8fCAhZGV2X3ByaXYtPnBzci5hY3RpdmUpCisJ
aWYgKCFpbnRlbF9kcC0+cHNyLnBzcjJfZW5hYmxlZCB8fCAhaW50ZWxfZHAtPnBzci5hY3RpdmUp
CiAJCWdvdG8gdW5sb2NrOwogCiAJLyoKQEAgLTE2NDIsMTUgKzE2NjgsMTUgQEAgdGdsX2RjM2Nv
X2ZsdXNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkgKiB3aGVuIGRlbGF5
ZWQgd29yayBzY2hlZHVsZXMgdGhhdCBtZWFucyBkaXNwbGF5IGhhcyBiZWVuIGlkbGUuCiAJICov
CiAJaWYgKCEoZnJvbnRidWZmZXJfYml0cyAmCi0JICAgIElOVEVMX0ZST05UQlVGRkVSX0FMTF9N
QVNLKGRldl9wcml2LT5wc3IucGlwZSkpKQorCSAgICBJTlRFTF9GUk9OVEJVRkZFUl9BTExfTUFT
SyhpbnRlbF9kcC0+cHNyLnBpcGUpKSkKIAkJZ290byB1bmxvY2s7CiAKLQl0Z2xfcHNyMl9lbmFi
bGVfZGMzY28oZGV2X3ByaXYpOwotCW1vZF9kZWxheWVkX3dvcmsoc3lzdGVtX3dxLCAmZGV2X3By
aXYtPnBzci5kYzNjb193b3JrLAotCQkJIGRldl9wcml2LT5wc3IuZGMzY29fZXhpdF9kZWxheSk7
CisJdGdsX3BzcjJfZW5hYmxlX2RjM2NvKGludGVsX2RwKTsKKwltb2RfZGVsYXllZF93b3JrKHN5
c3RlbV93cSwgJmludGVsX2RwLT5wc3IuZGMzY29fd29yaywKKwkJCSBpbnRlbF9kcC0+cHNyLmRj
M2NvX2V4aXRfZGVsYXkpOwogCiB1bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cHNy
LmxvY2spOworCW11dGV4X3VubG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKIH0KIAogLyoqCkBA
IC0xNjY5LDQ1ICsxNjk1LDU0IEBAIHRnbF9kYzNjb19mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCiB2b2lkIGludGVsX3Bzcl9mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCiAJCSAgICAgdW5zaWduZWQgZnJvbnRidWZmZXJfYml0cywgZW51bSBm
Yl9vcF9vcmlnaW4gb3JpZ2luKQogewotCWlmICghQ0FOX1BTUihkZXZfcHJpdikpCi0JCXJldHVy
bjsKLQotCWlmIChvcmlnaW4gPT0gT1JJR0lOX0ZMSVApIHsKLQkJdGdsX2RjM2NvX2ZsdXNoKGRl
dl9wcml2LCBmcm9udGJ1ZmZlcl9iaXRzLCBvcmlnaW4pOwotCQlyZXR1cm47Ci0JfQotCi0JbXV0
ZXhfbG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKLQlpZiAoIWRldl9wcml2LT5wc3IuZW5hYmxl
ZCkgewotCQltdXRleF91bmxvY2soJmRldl9wcml2LT5wc3IubG9jayk7Ci0JCXJldHVybjsKKwlz
dHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKKwlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2Rw
OworCisJZm9yX2VhY2hfaW50ZWxfZHAoJmRldl9wcml2LT5kcm0sIGVuY29kZXIpIHsKKwkJaW50
ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5jb2Rlcik7CisKKwkJaWYgKGVuY29kZXItPnR5cGUg
PT0gSU5URUxfT1VUUFVUX0VEUCAmJiBDQU5fUFNSKGludGVsX2RwKSkgeworCQkJaWYgKG9yaWdp
biA9PSBPUklHSU5fRkxJUCkgeworCQkJCXRnbF9kYzNjb19mbHVzaChpbnRlbF9kcCwgZnJvbnRi
dWZmZXJfYml0cywgb3JpZ2luKTsKKwkJCQljb250aW51ZTsKKwkJCX0KKworCQkJbXV0ZXhfbG9j
aygmaW50ZWxfZHAtPnBzci5sb2NrKTsKKwkJCWlmICghaW50ZWxfZHAtPnBzci5lbmFibGVkKSB7
CisJCQkJbXV0ZXhfdW5sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOworCQkJCWNvbnRpbnVlOwor
CQkJfQorCisJCQlmcm9udGJ1ZmZlcl9iaXRzICY9IElOVEVMX0ZST05UQlVGRkVSX0FMTF9NQVNL
KGludGVsX2RwLT5wc3IucGlwZSk7CisJCQlpbnRlbF9kcC0+cHNyLmJ1c3lfZnJvbnRidWZmZXJf
Yml0cyAmPSB+ZnJvbnRidWZmZXJfYml0czsKKworCQkJLyogQnkgZGVmaW5pdGlvbiBmbHVzaCA9
IGludmFsaWRhdGUgKyBmbHVzaCAqLworCQkJaWYgKGZyb250YnVmZmVyX2JpdHMpCisJCQkJcHNy
X2ZvcmNlX2h3X3RyYWNraW5nX2V4aXQoaW50ZWxfZHApOworCisJCQlpZiAoIWludGVsX2RwLT5w
c3IuYWN0aXZlICYmICFpbnRlbF9kcC0+cHNyLmJ1c3lfZnJvbnRidWZmZXJfYml0cykKKwkJCQlz
Y2hlZHVsZV93b3JrKCZpbnRlbF9kcC0+cHNyLndvcmspOworCQkJbXV0ZXhfdW5sb2NrKCZpbnRl
bF9kcC0+cHNyLmxvY2spOworCQl9CiAJfQotCi0JZnJvbnRidWZmZXJfYml0cyAmPSBJTlRFTF9G
Uk9OVEJVRkZFUl9BTExfTUFTSyhkZXZfcHJpdi0+cHNyLnBpcGUpOwotCWRldl9wcml2LT5wc3Iu
YnVzeV9mcm9udGJ1ZmZlcl9iaXRzICY9IH5mcm9udGJ1ZmZlcl9iaXRzOwotCi0JLyogQnkgZGVm
aW5pdGlvbiBmbHVzaCA9IGludmFsaWRhdGUgKyBmbHVzaCAqLwotCWlmIChmcm9udGJ1ZmZlcl9i
aXRzKQotCQlwc3JfZm9yY2VfaHdfdHJhY2tpbmdfZXhpdChkZXZfcHJpdik7Ci0KLQlpZiAoIWRl
dl9wcml2LT5wc3IuYWN0aXZlICYmICFkZXZfcHJpdi0+cHNyLmJ1c3lfZnJvbnRidWZmZXJfYml0
cykKLQkJc2NoZWR1bGVfd29yaygmZGV2X3ByaXYtPnBzci53b3JrKTsKLQltdXRleF91bmxvY2so
JmRldl9wcml2LT5wc3IubG9jayk7CiB9CiAKIC8qKgogICogaW50ZWxfcHNyX2luaXQgLSBJbml0
IGJhc2ljIFBTUiB3b3JrIGFuZCBtdXRleC4KLSAqIEBkZXZfcHJpdjogaTkxNSBkZXZpY2UgcHJp
dmF0ZQorICogQGludGVsX2RwOiBJbnRlbCBEUAogICoKLSAqIFRoaXMgZnVuY3Rpb24gaXMgIGNh
bGxlZCBvbmx5IG9uY2UgYXQgZHJpdmVyIGxvYWQgdG8gaW5pdGlhbGl6ZSBiYXNpYwotICogUFNS
IHN0dWZmLgorICogVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgYWZ0ZXIgdGhlIGluaXRpYWxpemlu
ZyBjb25uZWN0b3IuCisgKiAodGhlIGluaXRpYWxpemluZyBvZiBjb25uZWN0b3IgdHJlYXRzIHRo
ZSBoYW5kbGluZyBvZiBjb25uZWN0b3IgY2FwYWJpbGl0aWVzKQorICogQW5kIGl0IGluaXRpYWxp
emVzIGJhc2ljIFBTUiBzdHVmZiBmb3IgZWFjaCBEUCBFbmNvZGVyLgogICovCi12b2lkIGludGVs
X3Bzcl9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3ZvaWQgaW50ZWxf
cHNyX2luaXQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwogCWlmICghSEFTX1BT
UihkZXZfcHJpdikpCiAJCXJldHVybjsKIAotCWlmICghZGV2X3ByaXYtPnBzci5zaW5rX3N1cHBv
cnQpCisJaWYgKCFpbnRlbF9kcC0+cHNyLnNpbmtfc3VwcG9ydCkKIAkJcmV0dXJuOwogCiAJaWYg
KElTX0hBU1dFTEwoZGV2X3ByaXYpKQpAQCAtMTcyNSwxNCArMTc2MCwxNCBAQCB2b2lkIGludGVs
X3Bzcl9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkvKiBTZXQgbGlu
a19zdGFuZGJ5IHggbGlua19vZmYgZGVmYXVsdHMgKi8KIAlpZiAoSVNfSEFTV0VMTChkZXZfcHJp
dikgfHwgSVNfQlJPQURXRUxMKGRldl9wcml2KSkKIAkJLyogSFNXIGFuZCBCRFcgcmVxdWlyZSB3
b3JrYXJvdW5kcyB0aGF0IHdlIGRvbid0IGltcGxlbWVudC4gKi8KLQkJZGV2X3ByaXYtPnBzci5s
aW5rX3N0YW5kYnkgPSBmYWxzZTsKKwkJaW50ZWxfZHAtPnBzci5saW5rX3N0YW5kYnkgPSBmYWxz
ZTsKIAllbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTIpCiAJCS8qIEZvciBuZXcgcGxh
dGZvcm1zIHVwIHRvIFRHTCBsZXQncyByZXNwZWN0IFZCVCBiYWNrIGFnYWluICovCi0JCWRldl9w
cml2LT5wc3IubGlua19zdGFuZGJ5ID0gZGV2X3ByaXYtPnZidC5wc3IuZnVsbF9saW5rOworCQlp
bnRlbF9kcC0+cHNyLmxpbmtfc3RhbmRieSA9IGRldl9wcml2LT52YnQucHNyLmZ1bGxfbGluazsK
IAotCUlOSVRfV09SSygmZGV2X3ByaXYtPnBzci53b3JrLCBpbnRlbF9wc3Jfd29yayk7Ci0JSU5J
VF9ERUxBWUVEX1dPUksoJmRldl9wcml2LT5wc3IuZGMzY29fd29yaywgdGdsX2RjM2NvX2Rpc2Fi
bGVfd29yayk7Ci0JbXV0ZXhfaW5pdCgmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwlJTklUX1dPUkso
JmludGVsX2RwLT5wc3Iud29yaywgaW50ZWxfcHNyX3dvcmspOworCUlOSVRfREVMQVlFRF9XT1JL
KCZpbnRlbF9kcC0+cHNyLmRjM2NvX3dvcmssIHRnbF9kYzNjb19kaXNhYmxlX3dvcmspOworCW11
dGV4X2luaXQoJmludGVsX2RwLT5wc3IubG9jayk7CiB9CiAKIHN0YXRpYyBpbnQgcHNyX2dldF9z
dGF0dXNfYW5kX2Vycm9yX3N0YXR1cyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLApAQCAtMTc1
OCw3ICsxNzkzLDcgQEAgc3RhdGljIHZvaWQgcHNyX2FscG1fY2hlY2soc3RydWN0IGludGVsX2Rw
ICppbnRlbF9kcCkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90
b19pOTE1KGludGVsX2RwKTsKIAlzdHJ1Y3QgZHJtX2RwX2F1eCAqYXV4ID0gJmludGVsX2RwLT5h
dXg7Ci0Jc3RydWN0IGk5MTVfcHNyICpwc3IgPSAmZGV2X3ByaXYtPnBzcjsKKwlzdHJ1Y3QgaW50
ZWxfcHNyICpwc3IgPSAmaW50ZWxfZHAtPnBzcjsKIAl1OCB2YWw7CiAJaW50IHI7CiAKQEAgLTE3
ODUsNyArMTgyMCw3IEBAIHN0YXRpYyB2b2lkIHBzcl9hbHBtX2NoZWNrKHN0cnVjdCBpbnRlbF9k
cCAqaW50ZWxfZHApCiBzdGF0aWMgdm9pZCBwc3JfY2FwYWJpbGl0eV9jaGFuZ2VkX2NoZWNrKHN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7Ci0Jc3RydWN0IGk5MTVfcHNyICpwc3IgPSAm
ZGV2X3ByaXYtPnBzcjsKKwlzdHJ1Y3QgaW50ZWxfcHNyICpwc3IgPSAmaW50ZWxfZHAtPnBzcjsK
IAl1OCB2YWw7CiAJaW50IHI7CiAKQEAgLTE4MDksMTggKzE4NDQsMTggQEAgc3RhdGljIHZvaWQg
cHNyX2NhcGFiaWxpdHlfY2hhbmdlZF9jaGVjayhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQog
dm9pZCBpbnRlbF9wc3Jfc2hvcnRfcHVsc2Uoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2Rw
KTsKLQlzdHJ1Y3QgaTkxNV9wc3IgKnBzciA9ICZkZXZfcHJpdi0+cHNyOworCXN0cnVjdCBpbnRl
bF9wc3IgKnBzciA9ICZpbnRlbF9kcC0+cHNyOwogCXU4IHN0YXR1cywgZXJyb3Jfc3RhdHVzOwog
CWNvbnN0IHU4IGVycm9ycyA9IERQX1BTUl9SRkJfU1RPUkFHRV9FUlJPUiB8CiAJCQkgIERQX1BT
Ul9WU0NfU0RQX1VOQ09SUkVDVEFCTEVfRVJST1IgfAogCQkJICBEUF9QU1JfTElOS19DUkNfRVJS
T1I7CiAKLQlpZiAoIUNBTl9QU1IoZGV2X3ByaXYpIHx8ICFpbnRlbF9kcF9pc19lZHAoaW50ZWxf
ZHApKQorCWlmICghQ0FOX1BTUihpbnRlbF9kcCkgfHwgIWludGVsX2RwX2lzX2VkcChpbnRlbF9k
cCkpCiAJCXJldHVybjsKIAogCW11dGV4X2xvY2soJnBzci0+bG9jayk7CiAKLQlpZiAoIXBzci0+
ZW5hYmxlZCB8fCBwc3ItPmRwICE9IGludGVsX2RwKQorCWlmICghcHNyLT5lbmFibGVkKQogCQln
b3RvIGV4aXQ7CiAKIAlpZiAocHNyX2dldF9zdGF0dXNfYW5kX2Vycm9yX3N0YXR1cyhpbnRlbF9k
cCwgJnN0YXR1cywgJmVycm9yX3N0YXR1cykpIHsKQEAgLTE4NjMsMTUgKzE4OTgsMTQgQEAgdm9p
ZCBpbnRlbF9wc3Jfc2hvcnRfcHVsc2Uoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAogYm9v
bCBpbnRlbF9wc3JfZW5hYmxlZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCWJv
b2wgcmV0OwogCi0JaWYgKCFDQU5fUFNSKGRldl9wcml2KSB8fCAhaW50ZWxfZHBfaXNfZWRwKGlu
dGVsX2RwKSkKKwlpZiAoIUNBTl9QU1IoaW50ZWxfZHApIHx8ICFpbnRlbF9kcF9pc19lZHAoaW50
ZWxfZHApKQogCQlyZXR1cm4gZmFsc2U7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+cHNyLmxv
Y2spOwotCXJldCA9IChkZXZfcHJpdi0+cHNyLmRwID09IGludGVsX2RwICYmIGRldl9wcml2LT5w
c3IuZW5hYmxlZCk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCW11dGV4
X2xvY2soJmludGVsX2RwLT5wc3IubG9jayk7CisJcmV0ID0gaW50ZWxfZHAtPnBzci5lbmFibGVk
OworCW11dGV4X3VubG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKIAogCXJldHVybiByZXQ7CiB9
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5oIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuaAppbmRleCAwYTUxNzk3OGU4
YWYuLjAzZWIxOTU0N2QwOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9wc3IuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bz
ci5oCkBAIC0xOCw3ICsxOCw3IEBAIHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGU7CiBzdHJ1Y3Qg
aW50ZWxfcGxhbmVfc3RhdGU7CiBzdHJ1Y3QgaW50ZWxfcGxhbmU7CiAKLSNkZWZpbmUgQ0FOX1BT
UihkZXZfcHJpdikgKEhBU19QU1IoZGV2X3ByaXYpICYmIGRldl9wcml2LT5wc3Iuc2lua19zdXBw
b3J0KQorI2RlZmluZSBDQU5fUFNSKGludGVsX2RwKSAoSEFTX1BTUihkcF90b19pOTE1KGludGVs
X2RwKSkgJiYgaW50ZWxfZHAtPnBzci5zaW5rX3N1cHBvcnQpCiB2b2lkIGludGVsX3Bzcl9pbml0
X2RwY2Qoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCk7CiB2b2lkIGludGVsX3Bzcl9lbmFibGUo
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCkBAIC0yOCwyNCArMjgsMjQgQEAgdm9pZCBpbnRlbF9wc3Jf
ZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogdm9pZCBpbnRlbF9wc3JfdXBkYXRl
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkgICAgICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rv
cl9zdGF0ZSAqY29ubl9zdGF0ZSk7Ci1pbnQgaW50ZWxfcHNyX2RlYnVnX3NldChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHU2NCB2YWx1ZSk7CitpbnQgaW50ZWxfcHNyX2RlYnVn
X3NldChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCB1NjQgdmFsdWUpOwogdm9pZCBpbnRlbF9w
c3JfaW52YWxpZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkgIHVu
c2lnbmVkIGZyb250YnVmZmVyX2JpdHMsCiAJCQkgIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbik7
CiB2b2lkIGludGVsX3Bzcl9mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CiAJCSAgICAgdW5zaWduZWQgZnJvbnRidWZmZXJfYml0cywKIAkJICAgICBlbnVtIGZiX29wX29y
aWdpbiBvcmlnaW4pOwotdm9pZCBpbnRlbF9wc3JfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpOwordm9pZCBpbnRlbF9wc3JfaW5pdChzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwKTsKIHZvaWQgaW50ZWxfcHNyX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHAsCiAJCQkgICAgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7Ci12
b2lkIGludGVsX3Bzcl9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsIHUzMiBwc3JfaWlyKTsKK3ZvaWQgaW50ZWxfcHNyX2lycV9oYW5kbGVyKHN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHAsIHUzMiBwc3JfaWlyKTsKIHZvaWQgaW50ZWxfcHNyX3Nob3J0X3B1bHNl
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApOwotaW50IGludGVsX3Bzcl93YWl0X2Zvcl9pZGxl
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSwKLQkJCSAgICB1
MzIgKm91dF92YWx1ZSk7Cit2b2lkIGludGVsX3Bzcl93YWl0X2Zvcl9pZGxlKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSk7CiBib29sIGludGVsX3Bzcl9lbmFi
bGVkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApOwogaW50IGludGVsX3BzcjJfc2VsX2ZldGNo
X3VwZGF0ZShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAkJCQlzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0Yyk7Ci12b2lkIGludGVsX3BzcjJfcHJvZ3JhbV90cmFuc19tYW5fdHJrX2N0
bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7Cit2b2lkIGludGVs
X3BzcjJfcHJvZ3JhbV90cmFuc19tYW5fdHJrX2N0bChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2Rw
LAorCQkJCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKIHZv
aWQgaW50ZWxfcHNyMl9wcm9ncmFtX3BsYW5lX3NlbF9mZXRjaChzdHJ1Y3QgaW50ZWxfcGxhbmUg
KnBsYW5lLAogCQkJCQljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwK
IAkJCQkJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCmluZGV4IGI3ZTIwODgxNjA3
NC4uOTQ4MjM0YzYwNjQ4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX3Nwcml0ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
c3ByaXRlLmMKQEAgLTg0LDcgKzg0LDYgQEAgdm9pZCBpbnRlbF9waXBlX3VwZGF0ZV9zdGFydChj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpCiAJYm9vbCBuZWVk
X3Zsdl9kc2lfd2EgPSAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikgfHwgSVNfQ0hFUlJZVklFVyhk
ZXZfcHJpdikpICYmCiAJCWludGVsX2NydGNfaGFzX3R5cGUobmV3X2NydGNfc3RhdGUsIElOVEVM
X09VVFBVVF9EU0kpOwogCURFRklORV9XQUlUKHdhaXQpOwotCXUzMiBwc3Jfc3RhdHVzOwogCiAJ
aWYgKG5ld19jcnRjX3N0YXRlLT51YXBpLmFzeW5jX2ZsaXApCiAJCXJldHVybjsKQEAgLTEwOSwx
MCArMTA4LDcgQEAgdm9pZCBpbnRlbF9waXBlX3VwZGF0ZV9zdGFydChjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpCiAJICogVkJMIGludGVycnVwdHMgd2lsbCBz
dGFydCB0aGUgUFNSIGV4aXQgYW5kIHByZXZlbnQgYSBQU1IKIAkgKiByZS1lbnRyeSBhcyB3ZWxs
LgogCSAqLwotCWlmIChpbnRlbF9wc3Jfd2FpdF9mb3JfaWRsZShuZXdfY3J0Y19zdGF0ZSwgJnBz
cl9zdGF0dXMpKQotCQlkcm1fZXJyKCZkZXZfcHJpdi0+ZHJtLAotCQkJIlBTUiBpZGxlIHRpbWVk
IG91dCAweCV4LCBhdG9taWMgdXBkYXRlIG1heSBmYWlsXG4iLAotCQkJcHNyX3N0YXR1cyk7CisJ
aW50ZWxfcHNyX3dhaXRfZm9yX2lkbGUobmV3X2NydGNfc3RhdGUpOwogCiAJbG9jYWxfaXJxX2Rp
c2FibGUoKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKaW5kZXggNWQwNGIyODJjMDYwLi5hMmUz
OWU4YWRjYmUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaApAQCAtNDc1LDQyICs0NzUsNiBAQCBz
dHJ1Y3QgaTkxNV9kcnJzIHsKIAllbnVtIGRycnNfc3VwcG9ydF90eXBlIHR5cGU7CiB9OwogCi1z
dHJ1Y3QgaTkxNV9wc3IgewotCXN0cnVjdCBtdXRleCBsb2NrOwotCi0jZGVmaW5lIEk5MTVfUFNS
X0RFQlVHX01PREVfTUFTSwkweDBmCi0jZGVmaW5lIEk5MTVfUFNSX0RFQlVHX0RFRkFVTFQJCTB4
MDAKLSNkZWZpbmUgSTkxNV9QU1JfREVCVUdfRElTQUJMRQkJMHgwMQotI2RlZmluZSBJOTE1X1BT
Ul9ERUJVR19FTkFCTEUJCTB4MDIKLSNkZWZpbmUgSTkxNV9QU1JfREVCVUdfRk9SQ0VfUFNSMQkw
eDAzCi0jZGVmaW5lIEk5MTVfUFNSX0RFQlVHX0lSUQkJMHgxMAotCi0JdTMyIGRlYnVnOwotCWJv
b2wgc2lua19zdXBwb3J0OwotCWJvb2wgZW5hYmxlZDsKLQlzdHJ1Y3QgaW50ZWxfZHAgKmRwOwot
CWVudW0gcGlwZSBwaXBlOwotCWVudW0gdHJhbnNjb2RlciB0cmFuc2NvZGVyOwotCWJvb2wgYWN0
aXZlOwotCXN0cnVjdCB3b3JrX3N0cnVjdCB3b3JrOwotCXVuc2lnbmVkIGJ1c3lfZnJvbnRidWZm
ZXJfYml0czsKLQlib29sIHNpbmtfcHNyMl9zdXBwb3J0OwotCWJvb2wgbGlua19zdGFuZGJ5Owot
CWJvb2wgY29sb3JpbWV0cnlfc3VwcG9ydDsKLQlib29sIHBzcjJfZW5hYmxlZDsKLQlib29sIHBz
cjJfc2VsX2ZldGNoX2VuYWJsZWQ7Ci0JdTggc2lua19zeW5jX2xhdGVuY3k7Ci0Ja3RpbWVfdCBs
YXN0X2VudHJ5X2F0dGVtcHQ7Ci0Ja3RpbWVfdCBsYXN0X2V4aXQ7Ci0JYm9vbCBzaW5rX25vdF9y
ZWxpYWJsZTsKLQlib29sIGlycV9hdXhfZXJyb3I7Ci0JdTE2IHN1X3hfZ3JhbnVsYXJpdHk7Ci0J
Ym9vbCBkYzNjb19lbmFibGVkOwotCXUzMiBkYzNjb19leGl0X2RlbGF5OwotCXN0cnVjdCBkZWxh
eWVkX3dvcmsgZGMzY29fd29yazsKLQlzdHJ1Y3QgZHJtX2RwX3ZzY19zZHAgdnNjOwotfTsKLQog
I2RlZmluZSBRVUlSS19MVkRTX1NTQ19ESVNBQkxFICgxPDwxKQogI2RlZmluZSBRVUlSS19JTlZF
UlRfQlJJR0hUTkVTUyAoMTw8MikKICNkZWZpbmUgUVVJUktfQkFDS0xJR0hUX1BSRVNFTlQgKDE8
PDMpCkBAIC0xMDQxLDggKzEwMDUsNiBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSB7CiAKIAlz
dHJ1Y3QgaTkxNV9wb3dlcl9kb21haW5zIHBvd2VyX2RvbWFpbnM7CiAKLQlzdHJ1Y3QgaTkxNV9w
c3IgcHNyOwotCiAJc3RydWN0IGk5MTVfZ3B1X2Vycm9yIGdwdV9lcnJvcjsKIAogCXN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICp2bHZfcGN0eDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfaXJxLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2lycS5jCmluZGV4
IDQ5MWY4MjUwMGQ2OC4uODU0Njc4NjUyMWI1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2lycS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfaXJxLmMKQEAg
LTIwNDQsMTAgKzIwNDQsMjIgQEAgc3RhdGljIHZvaWQgaXZiX2Rpc3BsYXlfaXJxX2hhbmRsZXIo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQlpdmJfZXJyX2ludF9oYW5kbGVy
KGRldl9wcml2KTsKIAogCWlmIChkZV9paXIgJiBERV9FRFBfUFNSX0lOVF9IU1cpIHsKLQkJdTMy
IHBzcl9paXIgPSBpbnRlbF91bmNvcmVfcmVhZCgmZGV2X3ByaXYtPnVuY29yZSwgRURQX1BTUl9J
SVIpOworCQlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKIAotCQlpbnRlbF9wc3JfaXJx
X2hhbmRsZXIoZGV2X3ByaXYsIHBzcl9paXIpOwotCQlpbnRlbF91bmNvcmVfd3JpdGUoJmRldl9w
cml2LT51bmNvcmUsIEVEUF9QU1JfSUlSLCBwc3JfaWlyKTsKKwkJZm9yX2VhY2hfaW50ZWxfZHAo
JmRldl9wcml2LT5kcm0sIGVuY29kZXIpIHsKKwkJCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAg
PSBlbmNfdG9faW50ZWxfZHAoZW5jb2Rlcik7CisKKwkJCWlmIChlbmNvZGVyLT50eXBlID09IElO
VEVMX09VVFBVVF9FRFAgJiYKKwkJCSAgICBDQU5fUFNSKGludGVsX2RwKSkgeworCQkJCXUzMiBw
c3JfaWlyID0gaW50ZWxfdW5jb3JlX3JlYWQoJmRldl9wcml2LT51bmNvcmUsCisJCQkJCQkJCUVE
UF9QU1JfSUlSKTsKKworCQkJCWludGVsX3Bzcl9pcnFfaGFuZGxlcihpbnRlbF9kcCwgcHNyX2lp
cik7CisJCQkJaW50ZWxfdW5jb3JlX3dyaXRlKCZkZXZfcHJpdi0+dW5jb3JlLAorCQkJCQkJICAg
RURQX1BTUl9JSVIsIHBzcl9paXIpOworCQkJCWJyZWFrOworCQkJfQorCQl9CiAJfQogCiAJaWYg
KGRlX2lpciAmIERFX0FVWF9DSEFOTkVMX0FfSVZCKQpAQCAtMjI1NSwyMSArMjI2NywzNCBAQCBn
ZW44X2RlX21pc2NfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LCB1MzIgaWlyKQogCX0KIAogCWlmIChpaXIgJiBHRU44X0RFX0VEUF9QU1IpIHsKKwkJc3RydWN0
IGludGVsX2VuY29kZXIgKmVuY29kZXI7CiAJCXUzMiBwc3JfaWlyOwogCQlpOTE1X3JlZ190IGlp
cl9yZWc7CiAKLQkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpCi0JCQlpaXJfcmVnID0g
VFJBTlNfUFNSX0lJUihkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpOwotCQllbHNlCi0JCQlpaXJf
cmVnID0gRURQX1BTUl9JSVI7CisJCWZvcl9lYWNoX2ludGVsX2RwKCZkZXZfcHJpdi0+ZHJtLCBl
bmNvZGVyKSB7CisJCQlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZW5jX3RvX2ludGVsX2Rw
KGVuY29kZXIpOwogCi0JCXBzcl9paXIgPSBpbnRlbF91bmNvcmVfcmVhZCgmZGV2X3ByaXYtPnVu
Y29yZSwgaWlyX3JlZyk7Ci0JCWludGVsX3VuY29yZV93cml0ZSgmZGV2X3ByaXYtPnVuY29yZSwg
aWlyX3JlZywgcHNyX2lpcik7CisJCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMiAmJiBD
QU5fUFNSKGludGVsX2RwKSkgeworCQkJCWlpcl9yZWcgPSBUUkFOU19QU1JfSUlSKGludGVsX2Rw
LT5wc3IudHJhbnNjb2Rlcik7CisJCQl9IGVsc2UgaWYgKGVuY29kZXItPnR5cGUgPT0gSU5URUxf
T1VUUFVUX0VEUCAmJgorCQkJCSAgIENBTl9QU1IoaW50ZWxfZHApKSB7CisJCQkJaWlyX3JlZyA9
IEVEUF9QU1JfSUlSOworCQkJfSBlbHNlIHsKKwkJCQljb250aW51ZTsKKwkJCX0KKworCQkJcHNy
X2lpciA9IGludGVsX3VuY29yZV9yZWFkKCZkZXZfcHJpdi0+dW5jb3JlLCBpaXJfcmVnKTsKKwkJ
CWludGVsX3VuY29yZV93cml0ZSgmZGV2X3ByaXYtPnVuY29yZSwgaWlyX3JlZywgcHNyX2lpcik7
CisKKwkJCWlmIChwc3JfaWlyKQorCQkJCWZvdW5kID0gdHJ1ZTsKIAotCQlpZiAocHNyX2lpcikK
LQkJCWZvdW5kID0gdHJ1ZTsKKwkJCWludGVsX3Bzcl9pcnFfaGFuZGxlcihpbnRlbF9kcCwgcHNy
X2lpcik7CiAKLQkJaW50ZWxfcHNyX2lycV9oYW5kbGVyKGRldl9wcml2LCBwc3JfaWlyKTsKKwkJ
CS8qIHByaW9yIEdFTjEyIG9ubHkgaGF2ZSBvbmUgRURQIFBTUiAqLworCQkJaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPCAxMikKKwkJCQlicmVhazsKKwkJfQogCX0KIAogCWlmICghZm91bmQpCi0t
IAoyLjI1LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
CkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpo
dHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

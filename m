Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0FDBE22D93
	for <lists+intel-gfx@lfdr.de>; Mon, 20 May 2019 10:03:36 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C5FA389267;
	Mon, 20 May 2019 08:03:30 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4F8648925F
 for <intel-gfx@lists.freedesktop.org>; Mon, 20 May 2019 08:03:29 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16610868-1500050 
 for multiple; Mon, 20 May 2019 09:01:33 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 20 May 2019 09:01:08 +0100
Message-Id: <20190520080127.18255-14-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190520080127.18255-1-chris@chris-wilson.co.uk>
References: <20190520080127.18255-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 14/33] drm/i915: Move shmem object setup to its
 own file
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Matthew Auld <matthew.auld@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U3BsaXQgdGhlIHBsYWluIG9sZCBzaG1lbSBvYmplY3QgaW50byBpdHMgb3duIGZpbGUgdG8gc3Rh
cnQgZGVjbHV0dGVyaW5nCmk5MTVfZ2VtLmMKCnYyOiBMb3NlIHRoZSBjb25mdXNpbmcsIGh5c3Rl
cmljYWwgcmFpc2lucywgc3VmZml4IG9mIF9ndHQuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxz
b24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KUmV2aWV3ZWQtYnk6IE1hdHRoZXcgQXVsZCA8
bWF0dGhldy5hdWxkQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmls
ZSAgICAgICAgICAgICAgICAgfCAgIDMgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9vYmplY3QuYyAgICB8IDI5OCArKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fb2JqZWN0LmggICAgfCAgNDEgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9zaG1lbS5jICAgICB8IDUxMSArKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfbHJjLmMgICAgICAgICAgIHwgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2d2dC9jbWRfcGFyc2VyLmMgICAgICAgICB8ICAyMSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9kcnYuaCAgICAgICAgICAgICAgIHwgIDEwIC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ2VtLmMgICAgICAgICAgICAgICB8IDgyNiArLS0tLS0tLS0tLS0tLS0tLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jICAgICAgICAgICAgICB8ICAgMiArLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvaW50ZWxfZmJkZXYuYyAgICAgICAgICAgIHwgICAyICstCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9ndWMuYyAgICAgICAgICAgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2ludGVsX3VjX2Z3LmMgICAgICAgICAgICB8ICAgMyArLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYyAgIHwgICA2ICstCiAuLi4vZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9kbWFidWYuYyAgfCAgIDggKy0KIC4uLi9ncHUvZHJtL2k5
MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVjdC5jICB8ICAgNCArLQogMTYgZmlsZXMgY2hhbmdl
ZCwgODgyIGluc2VydGlvbnMoKyksIDg2MSBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0
NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2htZW0uYwoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFr
ZWZpbGUKaW5kZXggMWM4YmQwYTUyMTJkLi42MjVmOTc0OTM1NWIgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2Vm
aWxlCkBAIC04Nyw3ICs4Nyw4IEBAIGk5MTUteSArPSAkKGd0LXkpCiAjIEdFTSAoR3JhcGhpY3Mg
RXhlY3V0aW9uIE1hbmFnZW1lbnQpIGNvZGUKIG9iai15ICs9IGdlbS8KIGdlbS15ICs9IFwKLQln
ZW0vaTkxNV9nZW1fb2JqZWN0Lm8KKwlnZW0vaTkxNV9nZW1fb2JqZWN0Lm8gXAorCWdlbS9pOTE1
X2dlbV9zaG1lbS5vCiBpOTE1LXkgKz0gXAogCSAgJChnZW0teSkgXAogCSAgaTkxNV9hY3RpdmUu
byBcCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMKaW5kZXggYWM2
YTVhYjg0NTg2Li45Y2Q4ODA3MTNlMjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9vYmplY3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fb2JqZWN0LmMKQEAgLTI1LDYgKzI1LDcgQEAKICNpbmNsdWRlICJpOTE1X2Rydi5oIgog
I2luY2x1ZGUgImk5MTVfZ2VtX29iamVjdC5oIgogI2luY2x1ZGUgImk5MTVfZ2xvYmFscy5oIgor
I2luY2x1ZGUgImludGVsX2Zyb250YnVmZmVyLmgiCiAKIHN0YXRpYyBzdHJ1Y3QgaTkxNV9nbG9i
YWxfb2JqZWN0IHsKIAlzdHJ1Y3QgaTkxNV9nbG9iYWwgYmFzZTsKQEAgLTQxLDYgKzQyLDY0IEBA
IHZvaWQgaTkxNV9nZW1fb2JqZWN0X2ZyZWUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9i
aikKIAlyZXR1cm4ga21lbV9jYWNoZV9mcmVlKGdsb2JhbC5zbGFiX29iamVjdHMsIG9iaik7CiB9
CiAKKy8qIHNvbWUgYm9va2tlZXBpbmcgKi8KK3N0YXRpYyB2b2lkIGk5MTVfZ2VtX2luZm9fYWRk
X29iaihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKKwkJCQkgIHU2NCBzaXplKQorewor
CXNwaW5fbG9jaygmaTkxNS0+bW0ub2JqZWN0X3N0YXRfbG9jayk7CisJaTkxNS0+bW0ub2JqZWN0
X2NvdW50Kys7CisJaTkxNS0+bW0ub2JqZWN0X21lbW9yeSArPSBzaXplOworCXNwaW5fdW5sb2Nr
KCZpOTE1LT5tbS5vYmplY3Rfc3RhdF9sb2NrKTsKK30KKworc3RhdGljIHZvaWQgaTkxNV9nZW1f
aW5mb19yZW1vdmVfb2JqKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAorCQkJCSAgICAg
dTY0IHNpemUpCit7CisJc3Bpbl9sb2NrKCZpOTE1LT5tbS5vYmplY3Rfc3RhdF9sb2NrKTsKKwlp
OTE1LT5tbS5vYmplY3RfY291bnQtLTsKKwlpOTE1LT5tbS5vYmplY3RfbWVtb3J5IC09IHNpemU7
CisJc3Bpbl91bmxvY2soJmk5MTUtPm1tLm9iamVjdF9zdGF0X2xvY2spOworfQorCitzdGF0aWMg
dm9pZAorZnJvbnRidWZmZXJfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3Rp
dmUsCisJCSAgIHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QpCit7CisJc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaiA9CisJCWNvbnRhaW5lcl9vZihhY3RpdmUsIHR5cGVvZigqb2Jq
KSwgZnJvbnRidWZmZXJfd3JpdGUpOworCisJaW50ZWxfZmJfb2JqX2ZsdXNoKG9iaiwgT1JJR0lO
X0NTKTsKK30KKwordm9pZCBpOTE1X2dlbV9vYmplY3RfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqLAorCQkJICBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdF9vcHMg
Km9wcykKK3sKKwltdXRleF9pbml0KCZvYmotPm1tLmxvY2spOworCisJc3Bpbl9sb2NrX2luaXQo
Jm9iai0+dm1hLmxvY2spOworCUlOSVRfTElTVF9IRUFEKCZvYmotPnZtYS5saXN0KTsKKworCUlO
SVRfTElTVF9IRUFEKCZvYmotPmx1dF9saXN0KTsKKwlJTklUX0xJU1RfSEVBRCgmb2JqLT5iYXRj
aF9wb29sX2xpbmspOworCisJaW5pdF9yY3VfaGVhZCgmb2JqLT5yY3UpOworCisJb2JqLT5vcHMg
PSBvcHM7CisKKwlyZXNlcnZhdGlvbl9vYmplY3RfaW5pdCgmb2JqLT5fX2J1aWx0aW5fcmVzdik7
CisJb2JqLT5yZXN2ID0gJm9iai0+X19idWlsdGluX3Jlc3Y7CisKKwlvYmotPmZyb250YnVmZmVy
X2dndHRfb3JpZ2luID0gT1JJR0lOX0dUVDsKKwlpOTE1X2FjdGl2ZV9yZXF1ZXN0X2luaXQoJm9i
ai0+ZnJvbnRidWZmZXJfd3JpdGUsCisJCQkJIE5VTEwsIGZyb250YnVmZmVyX3JldGlyZSk7CisK
KwlvYmotPm1tLm1hZHYgPSBJOTE1X01BRFZfV0lMTE5FRUQ7CisJSU5JVF9SQURJWF9UUkVFKCZv
YmotPm1tLmdldF9wYWdlLnJhZGl4LCBHRlBfS0VSTkVMIHwgX19HRlBfTk9XQVJOKTsKKwltdXRl
eF9pbml0KCZvYmotPm1tLmdldF9wYWdlLmxvY2spOworCisJaTkxNV9nZW1faW5mb19hZGRfb2Jq
KHRvX2k5MTUob2JqLT5iYXNlLmRldiksIG9iai0+YmFzZS5zaXplKTsKK30KKwogLyoqCiAgKiBN
YXJrIHVwIHRoZSBvYmplY3QncyBjb2hlcmVuY3kgbGV2ZWxzIGZvciBhIGdpdmVuIGNhY2hlX2xl
dmVsCiAgKiBAb2JqOiAjZHJtX2k5MTVfZ2VtX29iamVjdApAQCAtNjMsNiArMTIyLDI0NSBAQCB2
b2lkIGk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVfY29oZXJlbmN5KHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmosCiAJCSEob2JqLT5jYWNoZV9jb2hlcmVudCAmIEk5MTVfQk9fQ0FDSEVf
Q09IRVJFTlRfRk9SX1dSSVRFKTsKIH0KIAordm9pZCBpOTE1X2dlbV9jbG9zZV9vYmplY3Qoc3Ry
dWN0IGRybV9nZW1fb2JqZWN0ICpnZW0sIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKK3sKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZ2VtLT5kZXYpOworCXN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB0b19pbnRlbF9ibyhnZW0pOworCXN0cnVjdCBkcm1f
aTkxNV9maWxlX3ByaXZhdGUgKmZwcml2ID0gZmlsZS0+ZHJpdmVyX3ByaXY7CisJc3RydWN0IGk5
MTVfbHV0X2hhbmRsZSAqbHV0LCAqbG47CisKKwltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKKworCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShsdXQsIGxuLCAmb2JqLT5sdXRf
bGlzdCwgb2JqX2xpbmspIHsKKwkJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IGx1dC0+
Y3R4OworCQlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKKworCQlHRU1fQlVHX09OKGN0eC0+ZmlsZV9w
cml2ID09IEVSUl9QVFIoLUVCQURGKSk7CisJCWlmIChjdHgtPmZpbGVfcHJpdiAhPSBmcHJpdikK
KwkJCWNvbnRpbnVlOworCisJCXZtYSA9IHJhZGl4X3RyZWVfZGVsZXRlKCZjdHgtPmhhbmRsZXNf
dm1hLCBsdXQtPmhhbmRsZSk7CisJCUdFTV9CVUdfT04odm1hLT5vYmogIT0gb2JqKTsKKworCQkv
KiBXZSBhbGxvdyB0aGUgcHJvY2VzcyB0byBoYXZlIG11bHRpcGxlIGhhbmRsZXMgdG8gdGhlIHNh
bWUKKwkJICogdm1hLCBpbiB0aGUgc2FtZSBmZCBuYW1lc3BhY2UsIGJ5IHZpcnR1ZSBvZiBmbGlu
ay9vcGVuLgorCQkgKi8KKwkJR0VNX0JVR19PTighdm1hLT5vcGVuX2NvdW50KTsKKwkJaWYgKCEt
LXZtYS0+b3Blbl9jb3VudCAmJiAhaTkxNV92bWFfaXNfZ2d0dCh2bWEpKQorCQkJaTkxNV92bWFf
Y2xvc2Uodm1hKTsKKworCQlsaXN0X2RlbCgmbHV0LT5vYmpfbGluayk7CisJCWxpc3RfZGVsKCZs
dXQtPmN0eF9saW5rKTsKKworCQlpOTE1X2x1dF9oYW5kbGVfZnJlZShsdXQpOworCQlfX2k5MTVf
Z2VtX29iamVjdF9yZWxlYXNlX3VubGVzc19hY3RpdmUob2JqKTsKKwl9CisKKwltdXRleF91bmxv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworfQorCitzdGF0aWMgYm9vbCBkaXNjYXJkX2Jh
Y2tpbmdfc3RvcmFnZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQoreworCS8qIElm
IHdlIGFyZSB0aGUgbGFzdCB1c2VyIG9mIHRoZSBiYWNraW5nIHN0b3JhZ2UgKGJlIGl0IHNobWVt
ZnMKKwkgKiBwYWdlcyBvciBzdG9sZW4gZXRjKSwgd2Uga25vdyB0aGF0IHRoZSBwYWdlcyBhcmUg
Z29pbmcgdG8gYmUKKwkgKiBpbW1lZGlhdGVseSByZWxlYXNlZC4gSW4gdGhpcyBjYXNlLCB3ZSBj
YW4gdGhlbiBza2lwIGNvcHlpbmcKKwkgKiBiYWNrIHRoZSBjb250ZW50cyBmcm9tIHRoZSBHUFUu
CisJICovCisKKwlpZiAob2JqLT5tbS5tYWR2ICE9IEk5MTVfTUFEVl9XSUxMTkVFRCkKKwkJcmV0
dXJuIGZhbHNlOworCisJaWYgKCFvYmotPmJhc2UuZmlscCkKKwkJcmV0dXJuIHRydWU7CisKKwkv
KiBBdCBmaXJzdCBnbGFuY2UsIHRoaXMgbG9va3MgcmFjeSwgYnV0IHRoZW4gYWdhaW4gc28gd291
bGQgYmUKKwkgKiB1c2Vyc3BhY2UgcmFjaW5nIG1tYXAgYWdhaW5zdCBjbG9zZS4gSG93ZXZlciwg
dGhlIGZpcnN0IGV4dGVybmFsCisJICogcmVmZXJlbmNlIHRvIHRoZSBmaWxwIGNhbiBvbmx5IGJl
IG9idGFpbmVkIHRocm91Z2ggdGhlCisJICogaTkxNV9nZW1fbW1hcF9pb2N0bCgpIHdoaWNoIHNh
ZmVndWFyZHMgdXMgYWdhaW5zdCB0aGUgdXNlcgorCSAqIGFjcXVpcmluZyBzdWNoIGEgcmVmZXJl
bmNlIHdoaWxzdCB3ZSBhcmUgaW4gdGhlIG1pZGRsZSBvZgorCSAqIGZyZWVpbmcgdGhlIG9iamVj
dC4KKwkgKi8KKwlyZXR1cm4gYXRvbWljX2xvbmdfcmVhZCgmb2JqLT5iYXNlLmZpbHAtPmZfY291
bnQpID09IDE7Cit9CisKK3N0YXRpYyB2b2lkIF9faTkxNV9nZW1fZnJlZV9vYmplY3RzKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LAorCQkJCSAgICBzdHJ1Y3QgbGxpc3Rfbm9kZSAqZnJl
ZWQpCit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgKm9uOworCWludGVsX3dh
a2VyZWZfdCB3YWtlcmVmOworCisJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KGk5MTUp
OworCWxsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUob2JqLCBvbiwgZnJlZWQsIGZyZWVkKSB7CisJ
CXN0cnVjdCBpOTE1X3ZtYSAqdm1hLCAqdm47CisKKwkJdHJhY2VfaTkxNV9nZW1fb2JqZWN0X2Rl
c3Ryb3kob2JqKTsKKworCQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwor
CQlHRU1fQlVHX09OKGk5MTVfZ2VtX29iamVjdF9pc19hY3RpdmUob2JqKSk7CisJCWxpc3RfZm9y
X2VhY2hfZW50cnlfc2FmZSh2bWEsIHZuLCAmb2JqLT52bWEubGlzdCwgb2JqX2xpbmspIHsKKwkJ
CUdFTV9CVUdfT04oaTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpOworCQkJdm1hLT5mbGFncyAmPSB+
STkxNV9WTUFfUElOX01BU0s7CisJCQlpOTE1X3ZtYV9kZXN0cm95KHZtYSk7CisJCX0KKwkJR0VN
X0JVR19PTighbGlzdF9lbXB0eSgmb2JqLT52bWEubGlzdCkpOworCQlHRU1fQlVHX09OKCFSQl9F
TVBUWV9ST09UKCZvYmotPnZtYS50cmVlKSk7CisKKwkJLyogVGhpcyBzZXJpYWxpemVzIGZyZWVp
bmcgd2l0aCB0aGUgc2hyaW5rZXIuIFNpbmNlIHRoZSBmcmVlCisJCSAqIGlzIGRlbGF5ZWQsIGZp
cnN0IGJ5IFJDVSB0aGVuIGJ5IHRoZSB3b3JrcXVldWUsIHdlIHdhbnQgdGhlCisJCSAqIHNocmlu
a2VyIHRvIGJlIGFibGUgdG8gZnJlZSBwYWdlcyBvZiB1bnJlZmVyZW5jZWQgb2JqZWN0cywKKwkJ
ICogb3IgZWxzZSB3ZSBtYXkgb29tIHdoaWxzdCB0aGVyZSBhcmUgcGxlbnR5IG9mIGRlZmVycmVk
CisJCSAqIGZyZWVkIG9iamVjdHMuCisJCSAqLworCQlpZiAoaTkxNV9nZW1fb2JqZWN0X2hhc19w
YWdlcyhvYmopKSB7CisJCQlzcGluX2xvY2soJmk5MTUtPm1tLm9ial9sb2NrKTsKKwkJCWxpc3Rf
ZGVsX2luaXQoJm9iai0+bW0ubGluayk7CisJCQlzcGluX3VubG9jaygmaTkxNS0+bW0ub2JqX2xv
Y2spOworCQl9CisKKwkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwor
CQlHRU1fQlVHX09OKG9iai0+YmluZF9jb3VudCk7CisJCUdFTV9CVUdfT04ob2JqLT51c2VyZmF1
bHRfY291bnQpOworCQlHRU1fQlVHX09OKGF0b21pY19yZWFkKCZvYmotPmZyb250YnVmZmVyX2Jp
dHMpKTsKKwkJR0VNX0JVR19PTighbGlzdF9lbXB0eSgmb2JqLT5sdXRfbGlzdCkpOworCisJCWlm
IChvYmotPm9wcy0+cmVsZWFzZSkKKwkJCW9iai0+b3BzLT5yZWxlYXNlKG9iaik7CisKKwkJaWYg
KFdBUk5fT04oaTkxNV9nZW1fb2JqZWN0X2hhc19waW5uZWRfcGFnZXMob2JqKSkpCisJCQlhdG9t
aWNfc2V0KCZvYmotPm1tLnBhZ2VzX3Bpbl9jb3VudCwgMCk7CisJCV9faTkxNV9nZW1fb2JqZWN0
X3B1dF9wYWdlcyhvYmosIEk5MTVfTU1fTk9STUFMKTsKKwkJR0VNX0JVR19PTihpOTE1X2dlbV9v
YmplY3RfaGFzX3BhZ2VzKG9iaikpOworCisJCWlmIChvYmotPmJhc2UuaW1wb3J0X2F0dGFjaCkK
KwkJCWRybV9wcmltZV9nZW1fZGVzdHJveSgmb2JqLT5iYXNlLCBOVUxMKTsKKworCQlyZXNlcnZh
dGlvbl9vYmplY3RfZmluaSgmb2JqLT5fX2J1aWx0aW5fcmVzdik7CisJCWRybV9nZW1fb2JqZWN0
X3JlbGVhc2UoJm9iai0+YmFzZSk7CisJCWk5MTVfZ2VtX2luZm9fcmVtb3ZlX29iaihpOTE1LCBv
YmotPmJhc2Uuc2l6ZSk7CisKKwkJYml0bWFwX2ZyZWUob2JqLT5iaXRfMTcpOworCQlpOTE1X2dl
bV9vYmplY3RfZnJlZShvYmopOworCisJCUdFTV9CVUdfT04oIWF0b21pY19yZWFkKCZpOTE1LT5t
bS5mcmVlX2NvdW50KSk7CisJCWF0b21pY19kZWMoJmk5MTUtPm1tLmZyZWVfY291bnQpOworCisJ
CWlmIChvbikKKwkJCWNvbmRfcmVzY2hlZCgpOworCX0KKwlpbnRlbF9ydW50aW1lX3BtX3B1dChp
OTE1LCB3YWtlcmVmKTsKK30KKwordm9pZCBpOTE1X2dlbV9mbHVzaF9mcmVlX29iamVjdHMoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCit7CisJc3RydWN0IGxsaXN0X25vZGUgKmZyZWVk
OworCisJLyogRnJlZSB0aGUgb2xkZXN0LCBtb3N0IHN0YWxlIG9iamVjdCB0byBrZWVwIHRoZSBm
cmVlX2xpc3Qgc2hvcnQgKi8KKwlmcmVlZCA9IE5VTEw7CisJaWYgKCFsbGlzdF9lbXB0eSgmaTkx
NS0+bW0uZnJlZV9saXN0KSkgeyAvKiBxdWljayB0ZXN0IGZvciBob3RwYXRoICovCisJCS8qIE9u
bHkgb25lIGNvbnN1bWVyIG9mIGxsaXN0X2RlbF9maXJzdCgpIGFsbG93ZWQgKi8KKwkJc3Bpbl9s
b2NrKCZpOTE1LT5tbS5mcmVlX2xvY2spOworCQlmcmVlZCA9IGxsaXN0X2RlbF9maXJzdCgmaTkx
NS0+bW0uZnJlZV9saXN0KTsKKwkJc3Bpbl91bmxvY2soJmk5MTUtPm1tLmZyZWVfbG9jayk7CisJ
fQorCWlmICh1bmxpa2VseShmcmVlZCkpIHsKKwkJZnJlZWQtPm5leHQgPSBOVUxMOworCQlfX2k5
MTVfZ2VtX2ZyZWVfb2JqZWN0cyhpOTE1LCBmcmVlZCk7CisJfQorfQorCitzdGF0aWMgdm9pZCBf
X2k5MTVfZ2VtX2ZyZWVfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCit7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPQorCQljb250YWluZXJfb2Yod29yaywgc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUsIG1tLmZyZWVfd29yayk7CisJc3RydWN0IGxsaXN0X25vZGUgKmZyZWVk
OworCisJLyoKKwkgKiBBbGwgZmlsZS1vd25lZCBWTUEgc2hvdWxkIGhhdmUgYmVlbiByZWxlYXNl
ZCBieSB0aGlzIHBvaW50IHRocm91Z2gKKwkgKiBpOTE1X2dlbV9jbG9zZV9vYmplY3QoKSwgb3Ig
ZWFybGllciBieSBpOTE1X2dlbV9jb250ZXh0X2Nsb3NlKCkuCisJICogSG93ZXZlciwgdGhlIG9i
amVjdCBtYXkgYWxzbyBiZSBib3VuZCBpbnRvIHRoZSBnbG9iYWwgR1RUIChlLmcuCisJICogb2xk
ZXIgR1BVcyB3aXRob3V0IHBlci1wcm9jZXNzIHN1cHBvcnQsIG9yIGZvciBkaXJlY3QgYWNjZXNz
IHRocm91Z2gKKwkgKiB0aGUgR1RUIGVpdGhlciBmb3IgdGhlIHVzZXIgb3IgZm9yIHNjYW5vdXQp
LiBUaG9zZSBWTUEgc3RpbGwgbmVlZCB0bworCSAqIHVuYm91bmQgbm93LgorCSAqLworCisJc3Bp
bl9sb2NrKCZpOTE1LT5tbS5mcmVlX2xvY2spOworCXdoaWxlICgoZnJlZWQgPSBsbGlzdF9kZWxf
YWxsKCZpOTE1LT5tbS5mcmVlX2xpc3QpKSkgeworCQlzcGluX3VubG9jaygmaTkxNS0+bW0uZnJl
ZV9sb2NrKTsKKworCQlfX2k5MTVfZ2VtX2ZyZWVfb2JqZWN0cyhpOTE1LCBmcmVlZCk7CisJCWlm
IChuZWVkX3Jlc2NoZWQoKSkKKwkJCXJldHVybjsKKworCQlzcGluX2xvY2soJmk5MTUtPm1tLmZy
ZWVfbG9jayk7CisJfQorCXNwaW5fdW5sb2NrKCZpOTE1LT5tbS5mcmVlX2xvY2spOworfQorCitz
dGF0aWMgdm9pZCBfX2k5MTVfZ2VtX2ZyZWVfb2JqZWN0X3JjdShzdHJ1Y3QgcmN1X2hlYWQgKmhl
YWQpCit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9CisJCWNvbnRhaW5lcl9v
ZihoZWFkLCB0eXBlb2YoKm9iaiksIHJjdSk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOworCisJLyoKKwkgKiBXZSByZXVzZSBvYmotPnJj
dSBmb3IgdGhlIGZyZWVkIGxpc3QsIHNvIHdlIGhhZCBiZXR0ZXIgbm90IHRyZWF0CisJICogaXQg
bGlrZSBhIHJjdV9oZWFkIGZyb20gdGhpcyBwb2ludCBmb3J3YXJkcy4gQW5kIHdlIGV4cGVjdCBh
bGwKKwkgKiBvYmplY3RzIHRvIGJlIGZyZWVkIHZpYSB0aGlzIHBhdGguCisJICovCisJZGVzdHJv
eV9yY3VfaGVhZCgmb2JqLT5yY3UpOworCisJLyoKKwkgKiBTaW5jZSB3ZSByZXF1aXJlIGJsb2Nr
aW5nIG9uIHN0cnVjdF9tdXRleCB0byB1bmJpbmQgdGhlIGZyZWVkCisJICogb2JqZWN0IGZyb20g
dGhlIEdQVSBiZWZvcmUgcmVsZWFzaW5nIHJlc291cmNlcyBiYWNrIHRvIHRoZQorCSAqIHN5c3Rl
bSwgd2UgY2FuIG5vdCBkbyB0aGF0IGRpcmVjdGx5IGZyb20gdGhlIFJDVSBjYWxsYmFjayAod2hp
Y2ggbWF5CisJICogYmUgYSBzb2Z0aXJxIGNvbnRleHQpLCBidXQgbXVzdCBpbnN0ZWFkIHRoZW4g
ZGVmZXIgdGhhdCB3b3JrIG9udG8gYQorCSAqIGt0aHJlYWQuIFdlIHVzZSB0aGUgUkNVIGNhbGxi
YWNrIHJhdGhlciB0aGFuIG1vdmUgdGhlIGZyZWVkIG9iamVjdAorCSAqIGRpcmVjdGx5IG9udG8g
dGhlIHdvcmsgcXVldWUgc28gdGhhdCB3ZSBjYW4gbWl4IGJldHdlZW4gdXNpbmcgdGhlCisJICog
d29ya2VyIGFuZCBwZXJmb3JtaW5nIGZyZWVzIGRpcmVjdGx5IGZyb20gc3Vic2VxdWVudCBhbGxv
Y2F0aW9ucyBmb3IKKwkgKiBjcnVkZSBidXQgZWZmZWN0aXZlIG1lbW9yeSB0aHJvdHRsaW5nLgor
CSAqLworCWlmIChsbGlzdF9hZGQoJm9iai0+ZnJlZWQsICZpOTE1LT5tbS5mcmVlX2xpc3QpKQor
CQlxdWV1ZV93b3JrKGk5MTUtPndxLCAmaTkxNS0+bW0uZnJlZV93b3JrKTsKK30KKwordm9pZCBp
OTE1X2dlbV9mcmVlX29iamVjdChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmdlbV9vYmopCit7CisJ
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IHRvX2ludGVsX2JvKGdlbV9vYmopOwor
CisJaWYgKG9iai0+bW0ucXVpcmtlZCkKKwkJX19pOTE1X2dlbV9vYmplY3RfdW5waW5fcGFnZXMo
b2JqKTsKKworCWlmIChkaXNjYXJkX2JhY2tpbmdfc3RvcmFnZShvYmopKQorCQlvYmotPm1tLm1h
ZHYgPSBJOTE1X01BRFZfRE9OVE5FRUQ7CisKKwkvKgorCSAqIEJlZm9yZSB3ZSBmcmVlIHRoZSBv
YmplY3QsIG1ha2Ugc3VyZSBhbnkgcHVyZSBSQ1Utb25seQorCSAqIHJlYWQtc2lkZSBjcml0aWNh
bCBzZWN0aW9ucyBhcmUgY29tcGxldGUsIGUuZy4KKwkgKiBpOTE1X2dlbV9idXN5X2lvY3RsKCku
IEZvciB0aGUgY29ycmVzcG9uZGluZyBzeW5jaHJvbml6ZWQKKwkgKiBsb29rdXAgc2VlIGk5MTVf
Z2VtX29iamVjdF9sb29rdXBfcmN1KCkuCisJICovCisJYXRvbWljX2luYygmdG9faTkxNShvYmot
PmJhc2UuZGV2KS0+bW0uZnJlZV9jb3VudCk7CisJY2FsbF9yY3UoJm9iai0+cmN1LCBfX2k5MTVf
Z2VtX2ZyZWVfb2JqZWN0X3JjdSk7Cit9CisKK3ZvaWQgX19pOTE1X2dlbV9vYmplY3RfcmVsZWFz
ZV91bmxlc3NfYWN0aXZlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCit7CisJbG9j
a2RlcF9hc3NlcnRfaGVsZCgmb2JqLT5iYXNlLmRldi0+c3RydWN0X211dGV4KTsKKworCWlmICgh
aTkxNV9nZW1fb2JqZWN0X2hhc19hY3RpdmVfcmVmZXJlbmNlKG9iaikgJiYKKwkgICAgaTkxNV9n
ZW1fb2JqZWN0X2lzX2FjdGl2ZShvYmopKQorCQlpOTE1X2dlbV9vYmplY3Rfc2V0X2FjdGl2ZV9y
ZWZlcmVuY2Uob2JqKTsKKwllbHNlCisJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKK30KKwor
dm9pZCBpOTE1X2dlbV9pbml0X19vYmplY3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQoreworCUlOSVRfV09SSygmaTkxNS0+bW0uZnJlZV93b3JrLCBfX2k5MTVfZ2VtX2ZyZWVfd29y
ayk7Cit9CisKIHN0YXRpYyB2b2lkIGk5MTVfZ2xvYmFsX29iamVjdHNfc2hyaW5rKHZvaWQpCiB7
CiAJa21lbV9jYWNoZV9zaHJpbmsoZ2xvYmFsLnNsYWJfb2JqZWN0cyk7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmggYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKaW5kZXggMDYxYjIwYzNkYTViLi5hZDgyMzAz
Zjc0MWEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmpl
Y3QuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKQEAg
LTE1LDkgKzE1LDI5IEBACiAKICNpbmNsdWRlICJpOTE1X2dlbV9vYmplY3RfdHlwZXMuaCIKIAor
dm9pZCBpOTE1X2dlbV9pbml0X19vYmplY3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KTsKKwogc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKmk5MTVfZ2VtX29iamVjdF9hbGxvYyh2
b2lkKTsKIHZvaWQgaTkxNV9nZW1fb2JqZWN0X2ZyZWUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iaik7CiAKK3ZvaWQgaTkxNV9nZW1fb2JqZWN0X2luaXQoc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaiwKKwkJCSAgY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Rfb3Bz
ICpvcHMpOworc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKgoraTkxNV9nZW1fb2JqZWN0X2Ny
ZWF0ZV9zaG1lbShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTY0IHNpemUpOworc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKgoraTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zaG1lbV9m
cm9tX2RhdGEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCisJCQkJICAgICAgIGNvbnN0
IHZvaWQgKmRhdGEsIHNpemVfdCBzaXplKTsKKworZXh0ZXJuIGNvbnN0IHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0X29wcyBpOTE1X2dlbV9zaG1lbV9vcHM7Cit2b2lkIF9faTkxNV9nZW1fb2Jq
ZWN0X3JlbGVhc2Vfc2htZW0oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKKwkJCQkg
ICAgIHN0cnVjdCBzZ190YWJsZSAqcGFnZXMsCisJCQkJICAgICBib29sIG5lZWRzX2NsZmx1c2gp
OworCit2b2lkIGk5MTVfZ2VtX2Nsb3NlX29iamVjdChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmdl
bSwgc3RydWN0IGRybV9maWxlICpmaWxlKTsKK3ZvaWQgaTkxNV9nZW1fZnJlZV9vYmplY3Qoc3Ry
dWN0IGRybV9nZW1fb2JqZWN0ICpvYmopOworCit2b2lkIGk5MTVfZ2VtX2ZsdXNoX2ZyZWVfb2Jq
ZWN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CisKIC8qKgogICogaTkxNV9nZW1f
b2JqZWN0X2xvb2t1cF9yY3UgLSBsb29rIHVwIGEgdGVtcG9yYXJ5IEdFTSBvYmplY3QgZnJvbSBp
dHMgaGFuZGxlCiAgKiBAZmlscDogRFJNIGZpbGUgcHJpdmF0ZSBkYXRlCkBAIC0zMzgsOCArMzU4
LDIzIEBAIHZvaWQgaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNoZV9jb2hlcmVuY3koc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJCQkJIHVuc2lnbmVkIGludCBjYWNoZV9sZXZlbCk7
CiB2b2lkIGk5MTVfZ2VtX29iamVjdF9mbHVzaF9pZl9kaXNwbGF5KHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmopOwogCi12b2lkIF9faTkxNV9nZW1fb2JqZWN0X3JlbGVhc2Vfc2htZW0o
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKLQkJCQkgICAgIHN0cnVjdCBzZ190YWJs
ZSAqcGFnZXMsCi0JCQkJICAgICBib29sIG5lZWRzX2NsZmx1c2gpOworc3RhdGljIGlubGluZSBi
b29sIGNwdV93cml0ZV9uZWVkc19jbGZsdXNoKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
YmopCit7CisJaWYgKG9iai0+Y2FjaGVfZGlydHkpCisJCXJldHVybiBmYWxzZTsKKworCWlmICgh
KG9iai0+Y2FjaGVfY29oZXJlbnQgJiBJOTE1X0JPX0NBQ0hFX0NPSEVSRU5UX0ZPUl9XUklURSkp
CisJCXJldHVybiB0cnVlOworCisJcmV0dXJuIG9iai0+cGluX2dsb2JhbDsgLyogY3VycmVudGx5
IGluIHVzZSBieSBIVywga2VlcCBmbHVzaGVkICovCit9CisKK3N0YXRpYyBpbmxpbmUgdm9pZCBf
X3N0YXJ0X2NwdV93cml0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQoreworCW9i
ai0+cmVhZF9kb21haW5zID0gSTkxNV9HRU1fRE9NQUlOX0NQVTsKKwlvYmotPndyaXRlX2RvbWFp
biA9IEk5MTVfR0VNX0RPTUFJTl9DUFU7CisJaWYgKGNwdV93cml0ZV9uZWVkc19jbGZsdXNoKG9i
aikpCisJCW9iai0+Y2FjaGVfZGlydHkgPSB0cnVlOworfQogCiAjZW5kaWYKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaG1lbS5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3NobWVtLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXgg
MDAwMDAwMDAwMDAwLi5lMjcyMWJkOWFiNDQKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2htZW0uYwpAQCAtMCwwICsxLDUxMSBAQAorLyoKKyAq
IFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKKyAqCisgKiBDb3B5cmlnaHQgwqkgMjAxNC0y
MDE2IEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2luY2x1ZGUgPGxpbnV4L3BhZ2V2ZWMuaD4K
KyNpbmNsdWRlIDxsaW51eC9zd2FwLmg+CisKKyNpbmNsdWRlICJpOTE1X2Rydi5oIgorI2luY2x1
ZGUgImk5MTVfZ2VtX29iamVjdC5oIgorCisvKgorICogTW92ZSBwYWdlcyB0byBhcHByb3ByaWF0
ZSBscnUgYW5kIHJlbGVhc2UgdGhlIHBhZ2V2ZWMsIGRlY3JlbWVudGluZyB0aGUKKyAqIHJlZiBj
b3VudCBvZiB0aG9zZSBwYWdlcy4KKyAqLworc3RhdGljIHZvaWQgY2hlY2tfcmVsZWFzZV9wYWdl
dmVjKHN0cnVjdCBwYWdldmVjICpwdmVjKQoreworCWNoZWNrX21vdmVfdW5ldmljdGFibGVfcGFn
ZXMocHZlYyk7CisJX19wYWdldmVjX3JlbGVhc2UocHZlYyk7CisJY29uZF9yZXNjaGVkKCk7Cit9
CisKK3N0YXRpYyBpbnQgc2htZW1fZ2V0X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmopCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+
YmFzZS5kZXYpOworCWNvbnN0IHVuc2lnbmVkIGxvbmcgcGFnZV9jb3VudCA9IG9iai0+YmFzZS5z
aXplIC8gUEFHRV9TSVpFOworCXVuc2lnbmVkIGxvbmcgaTsKKwlzdHJ1Y3QgYWRkcmVzc19zcGFj
ZSAqbWFwcGluZzsKKwlzdHJ1Y3Qgc2dfdGFibGUgKnN0OworCXN0cnVjdCBzY2F0dGVybGlzdCAq
c2c7CisJc3RydWN0IHNndF9pdGVyIHNndF9pdGVyOworCXN0cnVjdCBwYWdlICpwYWdlOworCXVu
c2lnbmVkIGxvbmcgbGFzdF9wZm4gPSAwOwkvKiBzdXBwcmVzcyBnY2Mgd2FybmluZyAqLworCXVu
c2lnbmVkIGludCBtYXhfc2VnbWVudCA9IGk5MTVfc2dfc2VnbWVudF9zaXplKCk7CisJdW5zaWdu
ZWQgaW50IHNnX3BhZ2Vfc2l6ZXM7CisJc3RydWN0IHBhZ2V2ZWMgcHZlYzsKKwlnZnBfdCBub3Jl
Y2xhaW07CisJaW50IHJldDsKKworCS8qCisJICogQXNzZXJ0IHRoYXQgdGhlIG9iamVjdCBpcyBu
b3QgY3VycmVudGx5IGluIGFueSBHUFUgZG9tYWluLiBBcyBpdAorCSAqIHdhc24ndCBpbiB0aGUg
R1RULCB0aGVyZSBzaG91bGRuJ3QgYmUgYW55IHdheSBpdCBjb3VsZCBoYXZlIGJlZW4gaW4KKwkg
KiBhIEdQVSBjYWNoZQorCSAqLworCUdFTV9CVUdfT04ob2JqLT5yZWFkX2RvbWFpbnMgJiBJOTE1
X0dFTV9HUFVfRE9NQUlOUyk7CisJR0VNX0JVR19PTihvYmotPndyaXRlX2RvbWFpbiAmIEk5MTVf
R0VNX0dQVV9ET01BSU5TKTsKKworCS8qCisJICogSWYgdGhlcmUncyBubyBjaGFuY2Ugb2YgYWxs
b2NhdGluZyBlbm91Z2ggcGFnZXMgZm9yIHRoZSB3aG9sZQorCSAqIG9iamVjdCwgYmFpbCBlYXJs
eS4KKwkgKi8KKwlpZiAocGFnZV9jb3VudCA+IHRvdGFscmFtX3BhZ2VzKCkpCisJCXJldHVybiAt
RU5PTUVNOworCisJc3QgPSBrbWFsbG9jKHNpemVvZigqc3QpLCBHRlBfS0VSTkVMKTsKKwlpZiAo
IXN0KQorCQlyZXR1cm4gLUVOT01FTTsKKworcmVidWlsZF9zdDoKKwlpZiAoc2dfYWxsb2NfdGFi
bGUoc3QsIHBhZ2VfY291bnQsIEdGUF9LRVJORUwpKSB7CisJCWtmcmVlKHN0KTsKKwkJcmV0dXJu
IC1FTk9NRU07CisJfQorCisJLyoKKwkgKiBHZXQgdGhlIGxpc3Qgb2YgcGFnZXMgb3V0IG9mIG91
ciBzdHJ1Y3QgZmlsZS4gIFRoZXknbGwgYmUgcGlubmVkCisJICogYXQgdGhpcyBwb2ludCB1bnRp
bCB3ZSByZWxlYXNlIHRoZW0uCisJICoKKwkgKiBGYWlsIHNpbGVudGx5IHdpdGhvdXQgc3RhcnRp
bmcgdGhlIHNocmlua2VyCisJICovCisJbWFwcGluZyA9IG9iai0+YmFzZS5maWxwLT5mX21hcHBp
bmc7CisJbWFwcGluZ19zZXRfdW5ldmljdGFibGUobWFwcGluZyk7CisJbm9yZWNsYWltID0gbWFw
cGluZ19nZnBfY29uc3RyYWludChtYXBwaW5nLCB+X19HRlBfUkVDTEFJTSk7CisJbm9yZWNsYWlt
IHw9IF9fR0ZQX05PUkVUUlkgfCBfX0dGUF9OT1dBUk47CisKKwlzZyA9IHN0LT5zZ2w7CisJc3Qt
Pm5lbnRzID0gMDsKKwlzZ19wYWdlX3NpemVzID0gMDsKKwlmb3IgKGkgPSAwOyBpIDwgcGFnZV9j
b3VudDsgaSsrKSB7CisJCWNvbnN0IHVuc2lnbmVkIGludCBzaHJpbmtbXSA9IHsKKwkJCShJOTE1
X1NIUklOS19CT1VORCB8CisJCQkgSTkxNV9TSFJJTktfVU5CT1VORCB8CisJCQkgSTkxNV9TSFJJ
TktfUFVSR0VBQkxFKSwKKwkJCTAsCisJCX0sICpzID0gc2hyaW5rOworCQlnZnBfdCBnZnAgPSBu
b3JlY2xhaW07CisKKwkJZG8geworCQkJY29uZF9yZXNjaGVkKCk7CisJCQlwYWdlID0gc2htZW1f
cmVhZF9tYXBwaW5nX3BhZ2VfZ2ZwKG1hcHBpbmcsIGksIGdmcCk7CisJCQlpZiAoIUlTX0VSUihw
YWdlKSkKKwkJCQlicmVhazsKKworCQkJaWYgKCEqcykgeworCQkJCXJldCA9IFBUUl9FUlIocGFn
ZSk7CisJCQkJZ290byBlcnJfc2c7CisJCQl9CisKKwkJCWk5MTVfZ2VtX3NocmluayhpOTE1LCAy
ICogcGFnZV9jb3VudCwgTlVMTCwgKnMrKyk7CisKKwkJCS8qCisJCQkgKiBXZSd2ZSB0cmllZCBo
YXJkIHRvIGFsbG9jYXRlIHRoZSBtZW1vcnkgYnkgcmVhcGluZworCQkJICogb3VyIG93biBidWZm
ZXIsIG5vdyBsZXQgdGhlIHJlYWwgVk0gZG8gaXRzIGpvYiBhbmQKKwkJCSAqIGdvIGRvd24gaW4g
ZmxhbWVzIGlmIHRydWx5IE9PTS4KKwkJCSAqCisJCQkgKiBIb3dldmVyLCBzaW5jZSBncmFwaGlj
cyB0ZW5kIHRvIGJlIGRpc3Bvc2FibGUsCisJCQkgKiBkZWZlciB0aGUgb29tIGhlcmUgYnkgcmVw
b3J0aW5nIHRoZSBFTk9NRU0gYmFjaworCQkJICogdG8gdXNlcnNwYWNlLgorCQkJICovCisJCQlp
ZiAoISpzKSB7CisJCQkJLyogcmVjbGFpbSBhbmQgd2FybiwgYnV0IG5vIG9vbSAqLworCQkJCWdm
cCA9IG1hcHBpbmdfZ2ZwX21hc2sobWFwcGluZyk7CisKKwkJCQkvKgorCQkJCSAqIE91ciBibyBh
cmUgYWx3YXlzIGRpcnR5IGFuZCBzbyB3ZSByZXF1aXJlCisJCQkJICoga3N3YXBkIHRvIHJlY2xh
aW0gb3VyIHBhZ2VzIChkaXJlY3QgcmVjbGFpbQorCQkJCSAqIGRvZXMgbm90IGVmZmVjdGl2ZWx5
IGJlZ2luIHBhZ2VvdXQgb2Ygb3VyCisJCQkJICogYnVmZmVycyBvbiBpdHMgb3duKS4gSG93ZXZl
ciwgZGlyZWN0IHJlY2xhaW0KKwkJCQkgKiBvbmx5IHdhaXRzIGZvciBrc3dhcGQgd2hlbiB1bmRl
ciBhbGxvY2F0aW9uCisJCQkJICogY29uZ2VzdGlvbi4gU28gYXMgYSByZXN1bHQgX19HRlBfUkVD
TEFJTSBpcworCQkJCSAqIHVucmVsaWFibGUgYW5kIGZhaWxzIHRvIGFjdHVhbGx5IHJlY2xhaW0g
b3VyCisJCQkJICogZGlydHkgcGFnZXMgLS0gdW5sZXNzIHlvdSB0cnkgb3ZlciBhbmQgb3Zlcgor
CQkJCSAqIGFnYWluIHdpdGggIV9fR0ZQX05PUkVUUlkuIEhvd2V2ZXIsIHdlIHN0aWxsCisJCQkJ
ICogd2FudCB0byBmYWlsIHRoaXMgYWxsb2NhdGlvbiByYXRoZXIgdGhhbgorCQkJCSAqIHRyaWdn
ZXIgdGhlIG91dC1vZi1tZW1vcnkga2lsbGVyIGFuZCBmb3IKKwkJCQkgKiB0aGlzIHdlIHdhbnQg
X19HRlBfUkVUUllfTUFZRkFJTC4KKwkJCQkgKi8KKwkJCQlnZnAgfD0gX19HRlBfUkVUUllfTUFZ
RkFJTDsKKwkJCX0KKwkJfSB3aGlsZSAoMSk7CisKKwkJaWYgKCFpIHx8CisJCSAgICBzZy0+bGVu
Z3RoID49IG1heF9zZWdtZW50IHx8CisJCSAgICBwYWdlX3RvX3BmbihwYWdlKSAhPSBsYXN0X3Bm
biArIDEpIHsKKwkJCWlmIChpKSB7CisJCQkJc2dfcGFnZV9zaXplcyB8PSBzZy0+bGVuZ3RoOwor
CQkJCXNnID0gc2dfbmV4dChzZyk7CisJCQl9CisJCQlzdC0+bmVudHMrKzsKKwkJCXNnX3NldF9w
YWdlKHNnLCBwYWdlLCBQQUdFX1NJWkUsIDApOworCQl9IGVsc2UgeworCQkJc2ctPmxlbmd0aCAr
PSBQQUdFX1NJWkU7CisJCX0KKwkJbGFzdF9wZm4gPSBwYWdlX3RvX3BmbihwYWdlKTsKKworCQkv
KiBDaGVjayB0aGF0IHRoZSBpOTY1Zy9nbSB3b3JrYXJvdW5kIHdvcmtzLiAqLworCQlXQVJOX09O
KChnZnAgJiBfX0dGUF9ETUEzMikgJiYgKGxhc3RfcGZuID49IDB4MDAxMDAwMDBVTCkpOworCX0K
KwlpZiAoc2cpIHsgLyogbG9vcCB0ZXJtaW5hdGVkIGVhcmx5OyBzaG9ydCBzZyB0YWJsZSAqLwor
CQlzZ19wYWdlX3NpemVzIHw9IHNnLT5sZW5ndGg7CisJCXNnX21hcmtfZW5kKHNnKTsKKwl9CisK
KwkvKiBUcmltIHVudXNlZCBzZyBlbnRyaWVzIHRvIGF2b2lkIHdhc3RpbmcgbWVtb3J5LiAqLwor
CWk5MTVfc2dfdHJpbShzdCk7CisKKwlyZXQgPSBpOTE1X2dlbV9ndHRfcHJlcGFyZV9wYWdlcyhv
YmosIHN0KTsKKwlpZiAocmV0KSB7CisJCS8qCisJCSAqIERNQSByZW1hcHBpbmcgZmFpbGVkPyBP
bmUgcG9zc2libGUgY2F1c2UgaXMgdGhhdAorCQkgKiBpdCBjb3VsZCBub3QgcmVzZXJ2ZSBlbm91
Z2ggbGFyZ2UgZW50cmllcywgYXNraW5nCisJCSAqIGZvciBQQUdFX1NJWkUgY2h1bmtzIGluc3Rl
YWQgbWF5IGJlIGhlbHBmdWwuCisJCSAqLworCQlpZiAobWF4X3NlZ21lbnQgPiBQQUdFX1NJWkUp
IHsKKwkJCWZvcl9lYWNoX3NndF9wYWdlKHBhZ2UsIHNndF9pdGVyLCBzdCkKKwkJCQlwdXRfcGFn
ZShwYWdlKTsKKwkJCXNnX2ZyZWVfdGFibGUoc3QpOworCisJCQltYXhfc2VnbWVudCA9IFBBR0Vf
U0laRTsKKwkJCWdvdG8gcmVidWlsZF9zdDsKKwkJfSBlbHNlIHsKKwkJCWRldl93YXJuKCZpOTE1
LT5kcm0ucGRldi0+ZGV2LAorCQkJCSAiRmFpbGVkIHRvIERNQSByZW1hcCAlbHUgcGFnZXNcbiIs
CisJCQkJIHBhZ2VfY291bnQpOworCQkJZ290byBlcnJfcGFnZXM7CisJCX0KKwl9CisKKwlpZiAo
aTkxNV9nZW1fb2JqZWN0X25lZWRzX2JpdDE3X3N3aXp6bGUob2JqKSkKKwkJaTkxNV9nZW1fb2Jq
ZWN0X2RvX2JpdF8xN19zd2l6emxlKG9iaiwgc3QpOworCisJX19pOTE1X2dlbV9vYmplY3Rfc2V0
X3BhZ2VzKG9iaiwgc3QsIHNnX3BhZ2Vfc2l6ZXMpOworCisJcmV0dXJuIDA7CisKK2Vycl9zZzoK
KwlzZ19tYXJrX2VuZChzZyk7CitlcnJfcGFnZXM6CisJbWFwcGluZ19jbGVhcl91bmV2aWN0YWJs
ZShtYXBwaW5nKTsKKwlwYWdldmVjX2luaXQoJnB2ZWMpOworCWZvcl9lYWNoX3NndF9wYWdlKHBh
Z2UsIHNndF9pdGVyLCBzdCkgeworCQlpZiAoIXBhZ2V2ZWNfYWRkKCZwdmVjLCBwYWdlKSkKKwkJ
CWNoZWNrX3JlbGVhc2VfcGFnZXZlYygmcHZlYyk7CisJfQorCWlmIChwYWdldmVjX2NvdW50KCZw
dmVjKSkKKwkJY2hlY2tfcmVsZWFzZV9wYWdldmVjKCZwdmVjKTsKKwlzZ19mcmVlX3RhYmxlKHN0
KTsKKwlrZnJlZShzdCk7CisKKwkvKgorCSAqIHNobWVtZnMgZmlyc3QgY2hlY2tzIGlmIHRoZXJl
IGlzIGVub3VnaCBtZW1vcnkgdG8gYWxsb2NhdGUgdGhlIHBhZ2UKKwkgKiBhbmQgcmVwb3J0cyBF
Tk9TUEMgc2hvdWxkIHRoZXJlIGJlIGluc3VmZmljaWVudCwgYWxvbmcgd2l0aCB0aGUgdXN1YWwK
KwkgKiBFTk9NRU0gZm9yIGEgZ2VudWluZSBhbGxvY2F0aW9uIGZhaWx1cmUuCisJICoKKwkgKiBX
ZSB1c2UgRU5PU1BDIGluIG91ciBkcml2ZXIgdG8gbWVhbiB0aGF0IHdlIGhhdmUgcnVuIG91dCBv
ZiBhcGVydHVyZQorCSAqIHNwYWNlIGFuZCBzbyB3YW50IHRvIHRyYW5zbGF0ZSB0aGUgZXJyb3Ig
ZnJvbSBzaG1lbWZzIGJhY2sgdG8gb3VyCisJICogdXN1YWwgdW5kZXJzdGFuZGluZyBvZiBFTk9N
RU0uCisJICovCisJaWYgKHJldCA9PSAtRU5PU1BDKQorCQlyZXQgPSAtRU5PTUVNOworCisJcmV0
dXJuIHJldDsKK30KKwordm9pZAorX19pOTE1X2dlbV9vYmplY3RfcmVsZWFzZV9zaG1lbShzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAorCQkJCXN0cnVjdCBzZ190YWJsZSAqcGFnZXMs
CisJCQkJYm9vbCBuZWVkc19jbGZsdXNoKQoreworCUdFTV9CVUdfT04ob2JqLT5tbS5tYWR2ID09
IF9fSTkxNV9NQURWX1BVUkdFRCk7CisKKwlpZiAob2JqLT5tbS5tYWR2ID09IEk5MTVfTUFEVl9E
T05UTkVFRCkKKwkJb2JqLT5tbS5kaXJ0eSA9IGZhbHNlOworCisJaWYgKG5lZWRzX2NsZmx1c2gg
JiYKKwkgICAgKG9iai0+cmVhZF9kb21haW5zICYgSTkxNV9HRU1fRE9NQUlOX0NQVSkgPT0gMCAm
JgorCSAgICAhKG9iai0+Y2FjaGVfY29oZXJlbnQgJiBJOTE1X0JPX0NBQ0hFX0NPSEVSRU5UX0ZP
Ul9SRUFEKSkKKwkJZHJtX2NsZmx1c2hfc2cocGFnZXMpOworCisJX19zdGFydF9jcHVfd3JpdGUo
b2JqKTsKK30KKworc3RhdGljIHZvaWQKK3NobWVtX3B1dF9wYWdlcyhzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqLCBzdHJ1Y3Qgc2dfdGFibGUgKnBhZ2VzKQoreworCXN0cnVjdCBzZ3Rf
aXRlciBzZ3RfaXRlcjsKKwlzdHJ1Y3QgcGFnZXZlYyBwdmVjOworCXN0cnVjdCBwYWdlICpwYWdl
OworCisJX19pOTE1X2dlbV9vYmplY3RfcmVsZWFzZV9zaG1lbShvYmosIHBhZ2VzLCB0cnVlKTsK
KworCWk5MTVfZ2VtX2d0dF9maW5pc2hfcGFnZXMob2JqLCBwYWdlcyk7CisKKwlpZiAoaTkxNV9n
ZW1fb2JqZWN0X25lZWRzX2JpdDE3X3N3aXp6bGUob2JqKSkKKwkJaTkxNV9nZW1fb2JqZWN0X3Nh
dmVfYml0XzE3X3N3aXp6bGUob2JqLCBwYWdlcyk7CisKKwltYXBwaW5nX2NsZWFyX3VuZXZpY3Rh
YmxlKGZpbGVfaW5vZGUob2JqLT5iYXNlLmZpbHApLT5pX21hcHBpbmcpOworCisJcGFnZXZlY19p
bml0KCZwdmVjKTsKKwlmb3JfZWFjaF9zZ3RfcGFnZShwYWdlLCBzZ3RfaXRlciwgcGFnZXMpIHsK
KwkJaWYgKG9iai0+bW0uZGlydHkpCisJCQlzZXRfcGFnZV9kaXJ0eShwYWdlKTsKKworCQlpZiAo
b2JqLT5tbS5tYWR2ID09IEk5MTVfTUFEVl9XSUxMTkVFRCkKKwkJCW1hcmtfcGFnZV9hY2Nlc3Nl
ZChwYWdlKTsKKworCQlpZiAoIXBhZ2V2ZWNfYWRkKCZwdmVjLCBwYWdlKSkKKwkJCWNoZWNrX3Jl
bGVhc2VfcGFnZXZlYygmcHZlYyk7CisJfQorCWlmIChwYWdldmVjX2NvdW50KCZwdmVjKSkKKwkJ
Y2hlY2tfcmVsZWFzZV9wYWdldmVjKCZwdmVjKTsKKwlvYmotPm1tLmRpcnR5ID0gZmFsc2U7CisK
KwlzZ19mcmVlX3RhYmxlKHBhZ2VzKTsKKwlrZnJlZShwYWdlcyk7Cit9CisKK3N0YXRpYyBpbnQK
K3NobWVtX3B3cml0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAorCSAgICAgY29u
c3Qgc3RydWN0IGRybV9pOTE1X2dlbV9wd3JpdGUgKmFyZykKK3sKKwlzdHJ1Y3QgYWRkcmVzc19z
cGFjZSAqbWFwcGluZyA9IG9iai0+YmFzZS5maWxwLT5mX21hcHBpbmc7CisJY2hhciBfX3VzZXIg
KnVzZXJfZGF0YSA9IHU2NF90b191c2VyX3B0cihhcmctPmRhdGFfcHRyKTsKKwl1NjQgcmVtYWlu
LCBvZmZzZXQ7CisJdW5zaWduZWQgaW50IHBnOworCisJLyogQ2FsbGVyIGFscmVhZHkgdmFsaWRh
dGVkIHVzZXIgYXJncyAqLworCUdFTV9CVUdfT04oIWFjY2Vzc19vayh1c2VyX2RhdGEsIGFyZy0+
c2l6ZSkpOworCisJLyoKKwkgKiBCZWZvcmUgd2UgaW5zdGFudGlhdGUvcGluIHRoZSBiYWNraW5n
IHN0b3JlIGZvciBvdXIgdXNlLCB3ZQorCSAqIGNhbiBwcmVwb3B1bGF0ZSB0aGUgc2htZW1mcyBm
aWxwIGVmZmljaWVudGx5IHVzaW5nIGEgd3JpdGUgaW50bworCSAqIHRoZSBwYWdlY2FjaGUuIFdl
IGF2b2lkIHRoZSBwZW5hbHR5IG9mIGluc3RhbnRpYXRpbmcgYWxsIHRoZQorCSAqIHBhZ2VzLCBp
bXBvcnRhbnQgaWYgdGhlIHVzZXIgaXMganVzdCB3cml0aW5nIHRvIGEgZmV3IGFuZCBuZXZlcgor
CSAqIHVzZXMgdGhlIG9iamVjdCBvbiB0aGUgR1BVLCBhbmQgdXNpbmcgYSBkaXJlY3Qgd3JpdGUg
aW50byBzaG1lbWZzCisJICogYWxsb3dzIGl0IHRvIGF2b2lkIHRoZSBjb3N0IG9mIHJldHJpZXZp
bmcgYSBwYWdlIChlaXRoZXIgc3dhcGluCisJICogb3IgY2xlYXJpbmctYmVmb3JlLXVzZSkgYmVm
b3JlIGl0IGlzIG92ZXJ3cml0dGVuLgorCSAqLworCWlmIChpOTE1X2dlbV9vYmplY3RfaGFzX3Bh
Z2VzKG9iaikpCisJCXJldHVybiAtRU5PREVWOworCisJaWYgKG9iai0+bW0ubWFkdiAhPSBJOTE1
X01BRFZfV0lMTE5FRUQpCisJCXJldHVybiAtRUZBVUxUOworCisJLyoKKwkgKiBCZWZvcmUgdGhl
IHBhZ2VzIGFyZSBpbnN0YW50aWF0ZWQgdGhlIG9iamVjdCBpcyB0cmVhdGVkIGFzIGJlaW5nCisJ
ICogaW4gdGhlIENQVSBkb21haW4uIFRoZSBwYWdlcyB3aWxsIGJlIGNsZmx1c2hlZCBhcyByZXF1
aXJlZCBiZWZvcmUKKwkgKiB1c2UsIGFuZCB3ZSBjYW4gZnJlZWx5IHdyaXRlIGludG8gdGhlIHBh
Z2VzIGRpcmVjdGx5LiBJZiB1c2Vyc3BhY2UKKwkgKiByYWNlcyBwd3JpdGUgd2l0aCBhbnkgb3Ro
ZXIgb3BlcmF0aW9uOyBjb3JydXB0aW9uIHdpbGwgZW5zdWUgLQorCSAqIHRoYXQgaXMgdXNlcnNw
YWNlJ3MgcHJlcm9nYXRpdmUhCisJICovCisKKwlyZW1haW4gPSBhcmctPnNpemU7CisJb2Zmc2V0
ID0gYXJnLT5vZmZzZXQ7CisJcGcgPSBvZmZzZXRfaW5fcGFnZShvZmZzZXQpOworCisJZG8gewor
CQl1bnNpZ25lZCBpbnQgbGVuLCB1bndyaXR0ZW47CisJCXN0cnVjdCBwYWdlICpwYWdlOworCQl2
b2lkICpkYXRhLCAqdmFkZHI7CisJCWludCBlcnI7CisJCWNoYXIgYzsKKworCQlsZW4gPSBQQUdF
X1NJWkUgLSBwZzsKKwkJaWYgKGxlbiA+IHJlbWFpbikKKwkJCWxlbiA9IHJlbWFpbjsKKworCQkv
KiBQcmVmYXVsdCB0aGUgdXNlciBwYWdlIHRvIHJlZHVjZSBwb3RlbnRpYWwgcmVjdXJzaW9uICov
CisJCWVyciA9IF9fZ2V0X3VzZXIoYywgdXNlcl9kYXRhKTsKKwkJaWYgKGVycikKKwkJCXJldHVy
biBlcnI7CisKKwkJZXJyID0gX19nZXRfdXNlcihjLCB1c2VyX2RhdGEgKyBsZW4gLSAxKTsKKwkJ
aWYgKGVycikKKwkJCXJldHVybiBlcnI7CisKKwkJZXJyID0gcGFnZWNhY2hlX3dyaXRlX2JlZ2lu
KG9iai0+YmFzZS5maWxwLCBtYXBwaW5nLAorCQkJCQkgICAgb2Zmc2V0LCBsZW4sIDAsCisJCQkJ
CSAgICAmcGFnZSwgJmRhdGEpOworCQlpZiAoZXJyIDwgMCkKKwkJCXJldHVybiBlcnI7CisKKwkJ
dmFkZHIgPSBrbWFwX2F0b21pYyhwYWdlKTsKKwkJdW53cml0dGVuID0gX19jb3B5X2Zyb21fdXNl
cl9pbmF0b21pYyh2YWRkciArIHBnLAorCQkJCQkJICAgICAgdXNlcl9kYXRhLAorCQkJCQkJICAg
ICAgbGVuKTsKKwkJa3VubWFwX2F0b21pYyh2YWRkcik7CisKKwkJZXJyID0gcGFnZWNhY2hlX3dy
aXRlX2VuZChvYmotPmJhc2UuZmlscCwgbWFwcGluZywKKwkJCQkJICBvZmZzZXQsIGxlbiwgbGVu
IC0gdW53cml0dGVuLAorCQkJCQkgIHBhZ2UsIGRhdGEpOworCQlpZiAoZXJyIDwgMCkKKwkJCXJl
dHVybiBlcnI7CisKKwkJLyogV2UgZG9uJ3QgaGFuZGxlIC1FRkFVTFQsIGxlYXZlIGl0IHRvIHRo
ZSBjYWxsZXIgdG8gY2hlY2sgKi8KKwkJaWYgKHVud3JpdHRlbikKKwkJCXJldHVybiAtRU5PREVW
OworCisJCXJlbWFpbiAtPSBsZW47CisJCXVzZXJfZGF0YSArPSBsZW47CisJCW9mZnNldCArPSBs
ZW47CisJCXBnID0gMDsKKwl9IHdoaWxlIChyZW1haW4pOworCisJcmV0dXJuIDA7Cit9CisKK2Nv
bnN0IHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0X29wcyBpOTE1X2dlbV9zaG1lbV9vcHMgPSB7
CisJLmZsYWdzID0gSTkxNV9HRU1fT0JKRUNUX0hBU19TVFJVQ1RfUEFHRSB8CisJCSBJOTE1X0dF
TV9PQkpFQ1RfSVNfU0hSSU5LQUJMRSwKKworCS5nZXRfcGFnZXMgPSBzaG1lbV9nZXRfcGFnZXMs
CisJLnB1dF9wYWdlcyA9IHNobWVtX3B1dF9wYWdlcywKKworCS5wd3JpdGUgPSBzaG1lbV9wd3Jp
dGUsCit9OworCitzdGF0aWMgaW50IGNyZWF0ZV9zaG1lbShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKKwkJCXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqLAorCQkJc2l6ZV90IHNpemUp
Cit7CisJdW5zaWduZWQgbG9uZyBmbGFncyA9IFZNX05PUkVTRVJWRTsKKwlzdHJ1Y3QgZmlsZSAq
ZmlscDsKKworCWRybV9nZW1fcHJpdmF0ZV9vYmplY3RfaW5pdCgmaTkxNS0+ZHJtLCBvYmosIHNp
emUpOworCisJaWYgKGk5MTUtPm1tLmdlbWZzKQorCQlmaWxwID0gc2htZW1fZmlsZV9zZXR1cF93
aXRoX21udChpOTE1LT5tbS5nZW1mcywgImk5MTUiLCBzaXplLAorCQkJCQkJIGZsYWdzKTsKKwll
bHNlCisJCWZpbHAgPSBzaG1lbV9maWxlX3NldHVwKCJpOTE1Iiwgc2l6ZSwgZmxhZ3MpOworCWlm
IChJU19FUlIoZmlscCkpCisJCXJldHVybiBQVFJfRVJSKGZpbHApOworCisJb2JqLT5maWxwID0g
ZmlscDsKKwlyZXR1cm4gMDsKK30KKworc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKgoraTkx
NV9nZW1fb2JqZWN0X2NyZWF0ZV9zaG1lbShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwg
dTY0IHNpemUpCit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKKwlzdHJ1Y3Qg
YWRkcmVzc19zcGFjZSAqbWFwcGluZzsKKwl1bnNpZ25lZCBpbnQgY2FjaGVfbGV2ZWw7CisJZ2Zw
X3QgbWFzazsKKwlpbnQgcmV0OworCisJLyogVGhlcmUgaXMgYSBwcmV2YWxlbmNlIG9mIHRoZSBh
c3N1bXB0aW9uIHRoYXQgd2UgZml0IHRoZSBvYmplY3QncworCSAqIHBhZ2UgY291bnQgaW5zaWRl
IGEgMzJiaXQgX3NpZ25lZF8gdmFyaWFibGUuIExldCdzIGRvY3VtZW50IHRoaXMgYW5kCisJICog
Y2F0Y2ggaWYgd2UgZXZlciBuZWVkIHRvIGZpeCBpdC4gSW4gdGhlIG1lYW50aW1lLCBpZiB5b3Ug
ZG8gc3BvdAorCSAqIHN1Y2ggYSBsb2NhbCB2YXJpYWJsZSwgcGxlYXNlIGNvbnNpZGVyIGZpeGlu
ZyEKKwkgKi8KKwlpZiAoc2l6ZSA+PiBQQUdFX1NISUZUID4gSU5UX01BWCkKKwkJcmV0dXJuIEVS
Ul9QVFIoLUUyQklHKTsKKworCWlmIChvdmVyZmxvd3NfdHlwZShzaXplLCBvYmotPmJhc2Uuc2l6
ZSkpCisJCXJldHVybiBFUlJfUFRSKC1FMkJJRyk7CisKKwlvYmogPSBpOTE1X2dlbV9vYmplY3Rf
YWxsb2MoKTsKKwlpZiAoIW9iaikKKwkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisKKwlyZXQg
PSBjcmVhdGVfc2htZW0oaTkxNSwgJm9iai0+YmFzZSwgc2l6ZSk7CisJaWYgKHJldCkKKwkJZ290
byBmYWlsOworCisJbWFzayA9IEdGUF9ISUdIVVNFUiB8IF9fR0ZQX1JFQ0xBSU1BQkxFOworCWlm
IChJU19JOTY1R00oaTkxNSkgfHwgSVNfSTk2NUcoaTkxNSkpIHsKKwkJLyogOTY1Z20gY2Fubm90
IHJlbG9jYXRlIG9iamVjdHMgYWJvdmUgNEdpQi4gKi8KKwkJbWFzayAmPSB+X19HRlBfSElHSE1F
TTsKKwkJbWFzayB8PSBfX0dGUF9ETUEzMjsKKwl9CisKKwltYXBwaW5nID0gb2JqLT5iYXNlLmZp
bHAtPmZfbWFwcGluZzsKKwltYXBwaW5nX3NldF9nZnBfbWFzayhtYXBwaW5nLCBtYXNrKTsKKwlH
RU1fQlVHX09OKCEobWFwcGluZ19nZnBfbWFzayhtYXBwaW5nKSAmIF9fR0ZQX1JFQ0xBSU0pKTsK
KworCWk5MTVfZ2VtX29iamVjdF9pbml0KG9iaiwgJmk5MTVfZ2VtX3NobWVtX29wcyk7CisKKwlv
YmotPndyaXRlX2RvbWFpbiA9IEk5MTVfR0VNX0RPTUFJTl9DUFU7CisJb2JqLT5yZWFkX2RvbWFp
bnMgPSBJOTE1X0dFTV9ET01BSU5fQ1BVOworCisJaWYgKEhBU19MTEMoaTkxNSkpCisJCS8qIE9u
IHNvbWUgZGV2aWNlcywgd2UgY2FuIGhhdmUgdGhlIEdQVSB1c2UgdGhlIExMQyAodGhlIENQVQor
CQkgKiBjYWNoZSkgZm9yIGFib3V0IGEgMTAlIHBlcmZvcm1hbmNlIGltcHJvdmVtZW50CisJCSAq
IGNvbXBhcmVkIHRvIHVuY2FjaGVkLiAgR3JhcGhpY3MgcmVxdWVzdHMgb3RoZXIgdGhhbgorCQkg
KiBkaXNwbGF5IHNjYW5vdXQgYXJlIGNvaGVyZW50IHdpdGggdGhlIENQVSBpbgorCQkgKiBhY2Nl
c3NpbmcgdGhpcyBjYWNoZS4gIFRoaXMgbWVhbnMgaW4gdGhpcyBtb2RlIHdlCisJCSAqIGRvbid0
IG5lZWQgdG8gY2xmbHVzaCBvbiB0aGUgQ1BVIHNpZGUsIGFuZCBvbiB0aGUKKwkJICogR1BVIHNp
ZGUgd2Ugb25seSBuZWVkIHRvIGZsdXNoIGludGVybmFsIGNhY2hlcyB0bworCQkgKiBnZXQgZGF0
YSB2aXNpYmxlIHRvIHRoZSBDUFUuCisJCSAqCisJCSAqIEhvd2V2ZXIsIHdlIG1haW50YWluIHRo
ZSBkaXNwbGF5IHBsYW5lcyBhcyBVQywgYW5kIHNvCisJCSAqIG5lZWQgdG8gcmViaW5kIHdoZW4g
Zmlyc3QgdXNlZCBhcyBzdWNoLgorCQkgKi8KKwkJY2FjaGVfbGV2ZWwgPSBJOTE1X0NBQ0hFX0xM
QzsKKwllbHNlCisJCWNhY2hlX2xldmVsID0gSTkxNV9DQUNIRV9OT05FOworCisJaTkxNV9nZW1f
b2JqZWN0X3NldF9jYWNoZV9jb2hlcmVuY3kob2JqLCBjYWNoZV9sZXZlbCk7CisKKwl0cmFjZV9p
OTE1X2dlbV9vYmplY3RfY3JlYXRlKG9iaik7CisKKwlyZXR1cm4gb2JqOworCitmYWlsOgorCWk5
MTVfZ2VtX29iamVjdF9mcmVlKG9iaik7CisJcmV0dXJuIEVSUl9QVFIocmV0KTsKK30KKworLyog
QWxsb2NhdGUgYSBuZXcgR0VNIG9iamVjdCBhbmQgZmlsbCBpdCB3aXRoIHRoZSBzdXBwbGllZCBk
YXRhICovCitzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqCitpOTE1X2dlbV9vYmplY3RfY3Jl
YXRlX3NobWVtX2Zyb21fZGF0YShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJ
CQkJICAgICAgIGNvbnN0IHZvaWQgKmRhdGEsIHNpemVfdCBzaXplKQoreworCXN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmo7CisJc3RydWN0IGZpbGUgKmZpbGU7CisJc2l6ZV90IG9mZnNl
dDsKKwlpbnQgZXJyOworCisJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zaG1lbShkZXZf
cHJpdiwgcm91bmRfdXAoc2l6ZSwgUEFHRV9TSVpFKSk7CisJaWYgKElTX0VSUihvYmopKQorCQly
ZXR1cm4gb2JqOworCisJR0VNX0JVR19PTihvYmotPndyaXRlX2RvbWFpbiAhPSBJOTE1X0dFTV9E
T01BSU5fQ1BVKTsKKworCWZpbGUgPSBvYmotPmJhc2UuZmlscDsKKwlvZmZzZXQgPSAwOworCWRv
IHsKKwkJdW5zaWduZWQgaW50IGxlbiA9IG1pbl90KHR5cGVvZihzaXplKSwgc2l6ZSwgUEFHRV9T
SVpFKTsKKwkJc3RydWN0IHBhZ2UgKnBhZ2U7CisJCXZvaWQgKnBnZGF0YSwgKnZhZGRyOworCisJ
CWVyciA9IHBhZ2VjYWNoZV93cml0ZV9iZWdpbihmaWxlLCBmaWxlLT5mX21hcHBpbmcsCisJCQkJ
CSAgICBvZmZzZXQsIGxlbiwgMCwKKwkJCQkJICAgICZwYWdlLCAmcGdkYXRhKTsKKwkJaWYgKGVy
ciA8IDApCisJCQlnb3RvIGZhaWw7CisKKwkJdmFkZHIgPSBrbWFwKHBhZ2UpOworCQltZW1jcHko
dmFkZHIsIGRhdGEsIGxlbik7CisJCWt1bm1hcChwYWdlKTsKKworCQllcnIgPSBwYWdlY2FjaGVf
d3JpdGVfZW5kKGZpbGUsIGZpbGUtPmZfbWFwcGluZywKKwkJCQkJICBvZmZzZXQsIGxlbiwgbGVu
LAorCQkJCQkgIHBhZ2UsIHBnZGF0YSk7CisJCWlmIChlcnIgPCAwKQorCQkJZ290byBmYWlsOwor
CisJCXNpemUgLT0gbGVuOworCQlkYXRhICs9IGxlbjsKKwkJb2Zmc2V0ICs9IGxlbjsKKwl9IHdo
aWxlIChzaXplKTsKKworCXJldHVybiBvYmo7CisKK2ZhaWw6CisJaTkxNV9nZW1fb2JqZWN0X3B1
dChvYmopOworCXJldHVybiBFUlJfUFRSKGVycik7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2xyYy5jCmluZGV4IDFmN2JlZTBjYWUwYy4uMzhhOGU1NWE3Yzg1IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9scmMuYwpAQCAtMTkxOSw3ICsxOTE5LDcgQEAgc3RhdGljIGludCBscmNfc2V0
dXBfd2FfY3R4KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAlzdHJ1Y3QgaTkxNV92
bWEgKnZtYTsKIAlpbnQgZXJyOwogCi0Jb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZShlbmdp
bmUtPmk5MTUsIENUWF9XQV9CQl9PQkpfU0laRSk7CisJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2Ny
ZWF0ZV9zaG1lbShlbmdpbmUtPmk5MTUsIENUWF9XQV9CQl9PQkpfU0laRSk7CiAJaWYgKElTX0VS
UihvYmopKQogCQlyZXR1cm4gUFRSX0VSUihvYmopOwogCkBAIC0zMDEwLDcgKzMwMTAsNyBAQCBz
dGF0aWMgaW50IGV4ZWNsaXN0c19jb250ZXh0X2RlZmVycmVkX2FsbG9jKHN0cnVjdCBpbnRlbF9j
b250ZXh0ICpjZSwKIAkgKi8KIAljb250ZXh0X3NpemUgKz0gTFJDX0hFQURFUl9QQUdFUyAqIFBB
R0VfU0laRTsKIAotCWN0eF9vYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlKGVuZ2luZS0+aTkx
NSwgY29udGV4dF9zaXplKTsKKwljdHhfb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zaG1l
bShlbmdpbmUtPmk5MTUsIGNvbnRleHRfc2l6ZSk7CiAJaWYgKElTX0VSUihjdHhfb2JqKSkKIAkJ
cmV0dXJuIFBUUl9FUlIoY3R4X29iaik7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X3JpbmdidWZmZXIuYwppbmRleCBmMGQ2MGFmZmRiYTMuLmFjOTMwODBiZDg2MyAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYwpAQCAtMTM5Niw3ICsxMzk2LDcg
QEAgYWxsb2NfY29udGV4dF92bWEoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCXN0
cnVjdCBpOTE1X3ZtYSAqdm1hOwogCWludCBlcnI7CiAKLQlvYmogPSBpOTE1X2dlbV9vYmplY3Rf
Y3JlYXRlKGk5MTUsIGVuZ2luZS0+Y29udGV4dF9zaXplKTsKKwlvYmogPSBpOTE1X2dlbV9vYmpl
Y3RfY3JlYXRlX3NobWVtKGk5MTUsIGVuZ2luZS0+Y29udGV4dF9zaXplKTsKIAlpZiAoSVNfRVJS
KG9iaikpCiAJCXJldHVybiBFUlJfQ0FTVChvYmopOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndnQvY21kX3BhcnNlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2Nt
ZF9wYXJzZXIuYwppbmRleCBhYjAwMmNmZDNjYWIuLmZlNjYyODVmMDIzNiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2NtZF9wYXJzZXIuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndnQvY21kX3BhcnNlci5jCkBAIC0xNzIxLDcgKzE3MjEsNyBAQCBzdGF0aWMgaW50
IHBlcmZvcm1fYmJfc2hhZG93KHN0cnVjdCBwYXJzZXJfZXhlY19zdGF0ZSAqcykKIAlpbnQgcmV0
ID0gMDsKIAlzdHJ1Y3QgaW50ZWxfdmdwdV9tbSAqbW0gPSAocy0+YnVmX2FkZHJfdHlwZSA9PSBH
VFRfQlVGRkVSKSA/CiAJCXMtPnZncHUtPmd0dC5nZ3R0X21tIDogcy0+d29ya2xvYWQtPnNoYWRv
d19tbTsKLQl1bnNpZ25lZCBsb25nIGdtYV9zdGFydF9vZmZzZXQgPSAwOworCXVuc2lnbmVkIGxv
bmcgc3RhcnRfb2Zmc2V0ID0gMDsKIAogCS8qIGdldCB0aGUgc3RhcnQgZ20gYWRkcmVzcyBvZiB0
aGUgYmF0Y2ggYnVmZmVyICovCiAJZ21hID0gZ2V0X2dtYV9iYl9mcm9tX2NtZChzLCAxKTsKQEAg
LTE3MzgsNyArMTczOCw3IEBAIHN0YXRpYyBpbnQgcGVyZm9ybV9iYl9zaGFkb3coc3RydWN0IHBh
cnNlcl9leGVjX3N0YXRlICpzKQogCiAJYmItPnBwZ3R0ID0gKHMtPmJ1Zl9hZGRyX3R5cGUgPT0g
R1RUX0JVRkZFUikgPyBmYWxzZSA6IHRydWU7CiAKLQkvKiB0aGUgZ21hX3N0YXJ0X29mZnNldCBz
dG9yZXMgdGhlIGJhdGNoIGJ1ZmZlcidzIHN0YXJ0IGdtYSdzCisJLyogdGhlIHN0YXJ0X29mZnNl
dCBzdG9yZXMgdGhlIGJhdGNoIGJ1ZmZlcidzIHN0YXJ0IGdtYSdzCiAJICogb2Zmc2V0IHJlbGF0
aXZlIHRvIHBhZ2UgYm91bmRhcnkuIHNvIGZvciBub24tcHJpdmlsZWdlZCBiYXRjaAogCSAqIGJ1
ZmZlciwgdGhlIHNoYWRvd2VkIGdlbSBvYmplY3QgaG9sZHMgZXhhY3RseSB0aGUgc2FtZSBwYWdl
CiAJICogbGF5b3V0IGFzIG9yaWdpbmFsIGdlbSBvYmplY3QuIFRoaXMgaXMgZm9yIHRoZSBjb252
aWVuY2Ugb2YKQEAgLTE3NTAsMTAgKzE3NTAsMTEgQEAgc3RhdGljIGludCBwZXJmb3JtX2JiX3No
YWRvdyhzdHJ1Y3QgcGFyc2VyX2V4ZWNfc3RhdGUgKnMpCiAJICogdGhhdCBvZiBzaGFkb3dlZCBw
YWdlLgogCSAqLwogCWlmIChiYi0+cHBndHQpCi0JCWdtYV9zdGFydF9vZmZzZXQgPSBnbWEgJiB+
STkxNV9HVFRfUEFHRV9NQVNLOworCQlzdGFydF9vZmZzZXQgPSBnbWEgJiB+STkxNV9HVFRfUEFH
RV9NQVNLOwogCi0JYmItPm9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGUocy0+dmdwdS0+Z3Z0
LT5kZXZfcHJpdiwKLQkJCSByb3VuZHVwKGJiX3NpemUgKyBnbWFfc3RhcnRfb2Zmc2V0LCBQQUdF
X1NJWkUpKTsKKwliYi0+b2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zaG1lbShzLT52Z3B1
LT5ndnQtPmRldl9wcml2LAorCQkJCQkgICAgICAgcm91bmRfdXAoYmJfc2l6ZSArIHN0YXJ0X29m
ZnNldCwKKwkJCQkJCQlQQUdFX1NJWkUpKTsKIAlpZiAoSVNfRVJSKGJiLT5vYmopKSB7CiAJCXJl
dCA9IFBUUl9FUlIoYmItPm9iaik7CiAJCWdvdG8gZXJyX2ZyZWVfYmI7CkBAIC0xNzc2LDcgKzE3
NzcsNyBAQCBzdGF0aWMgaW50IHBlcmZvcm1fYmJfc2hhZG93KHN0cnVjdCBwYXJzZXJfZXhlY19z
dGF0ZSAqcykKIAogCXJldCA9IGNvcHlfZ21hX3RvX2h2YShzLT52Z3B1LCBtbSwKIAkJCSAgICAg
IGdtYSwgZ21hICsgYmJfc2l6ZSwKLQkJCSAgICAgIGJiLT52YSArIGdtYV9zdGFydF9vZmZzZXQp
OworCQkJICAgICAgYmItPnZhICsgc3RhcnRfb2Zmc2V0KTsKIAlpZiAocmV0IDwgMCkgewogCQln
dnRfdmdwdV9lcnIoImZhaWwgdG8gY29weSBndWVzdCByaW5nIGJ1ZmZlclxuIik7CiAJCXJldCA9
IC1FRkFVTFQ7CkBAIC0xODAyLDcgKzE4MDMsNyBAQCBzdGF0aWMgaW50IHBlcmZvcm1fYmJfc2hh
ZG93KHN0cnVjdCBwYXJzZXJfZXhlY19zdGF0ZSAqcykKIAkgKiBidWZmZXIncyBnbWEgaW4gcGFp
ci4gQWZ0ZXIgYWxsLCB3ZSBkb24ndCB3YW50IHRvIHBpbiB0aGUgc2hhZG93CiAJICogYnVmZmVy
IGhlcmUgKHRvbyBlYXJseSkuCiAJICovCi0Jcy0+aXBfdmEgPSBiYi0+dmEgKyBnbWFfc3RhcnRf
b2Zmc2V0OworCXMtPmlwX3ZhID0gYmItPnZhICsgc3RhcnRfb2Zmc2V0OwogCXMtPmlwX2dtYSA9
IGdtYTsKIAlyZXR1cm4gMDsKIGVycl91bm1hcDoKQEAgLTI4MjUsOSArMjgyNiw5IEBAIHN0YXRp
YyBpbnQgc2hhZG93X2luZGlyZWN0X2N0eChzdHJ1Y3QgaW50ZWxfc2hhZG93X3dhX2N0eCAqd2Ff
Y3R4KQogCWludCByZXQgPSAwOwogCXZvaWQgKm1hcDsKIAotCW9iaiA9IGk5MTVfZ2VtX29iamVj
dF9jcmVhdGUod29ya2xvYWQtPnZncHUtPmd2dC0+ZGV2X3ByaXYsCi0JCQkJICAgICByb3VuZHVw
KGN0eF9zaXplICsgQ0FDSEVMSU5FX0JZVEVTLAotCQkJCQkgICAgIFBBR0VfU0laRSkpOworCW9i
aiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc2htZW0od29ya2xvYWQtPnZncHUtPmd2dC0+ZGV2
X3ByaXYsCisJCQkJCSAgIHJvdW5kdXAoY3R4X3NpemUgKyBDQUNIRUxJTkVfQllURVMsCisJCQkJ
CQkgICBQQUdFX1NJWkUpKTsKIAlpZiAoSVNfRVJSKG9iaikpCiAJCXJldHVybiBQVFJfRVJSKG9i
aik7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCmluZGV4IGI1NmM1NTgzZjkzMy4uYTU0MWE1MjQz
OTZmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKQEAgLTI3NTAsMTYgKzI3NTAsNiBAQCB2b2lk
IGk5MTVfZ2VtX2xvYWRfaW5pdF9mZW5jZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KTsKIGludCBpOTE1X2dlbV9mcmVlemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KTsKIGludCBpOTE1X2dlbV9mcmVlemVfbGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpOwogCi12b2lkIGk5MTVfZ2VtX29iamVjdF9pbml0KHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmosCi0JCQkgY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Rfb3Bz
ICpvcHMpOwotc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKgotaTkxNV9nZW1fb2JqZWN0X2Ny
ZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHU2NCBzaXplKTsKLXN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICoKLWk5MTVfZ2VtX29iamVjdF9jcmVhdGVfZnJvbV9kYXRh
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCQkgY29uc3Qgdm9pZCAqZGF0
YSwgc2l6ZV90IHNpemUpOwotdm9pZCBpOTE1X2dlbV9jbG9zZV9vYmplY3Qoc3RydWN0IGRybV9n
ZW1fb2JqZWN0ICpnZW0sIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSk7Ci12b2lkIGk5MTVfZ2VtX2Zy
ZWVfb2JqZWN0KHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqKTsKLQogc3RhdGljIGlubGluZSB2
b2lkIGk5MTVfZ2VtX2RyYWluX2ZyZWVkX29iamVjdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCiB7CiAJaWYgKCFhdG9taWNfcmVhZCgmaTkxNS0+bW0uZnJlZV9jb3VudCkpCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW0uYwppbmRleCA3OGNhNjlkY2ZhYTYuLjRjNWZiYTBjN2JmNiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbS5jCkBAIC01NywxOSArNTcsNiBAQAogI2luY2x1ZGUgImludGVsX2Zy
b250YnVmZmVyLmgiCiAjaW5jbHVkZSAiaW50ZWxfcG0uaCIKIAotc3RhdGljIHZvaWQgaTkxNV9n
ZW1fZmx1c2hfZnJlZV9vYmplY3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKLQot
c3RhdGljIGJvb2wgY3B1X3dyaXRlX25lZWRzX2NsZmx1c2goc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaikKLXsKLQlpZiAob2JqLT5jYWNoZV9kaXJ0eSkKLQkJcmV0dXJuIGZhbHNlOwot
Ci0JaWYgKCEob2JqLT5jYWNoZV9jb2hlcmVudCAmIEk5MTVfQk9fQ0FDSEVfQ09IRVJFTlRfRk9S
X1dSSVRFKSkKLQkJcmV0dXJuIHRydWU7Ci0KLQlyZXR1cm4gb2JqLT5waW5fZ2xvYmFsOyAvKiBj
dXJyZW50bHkgaW4gdXNlIGJ5IEhXLCBrZWVwIGZsdXNoZWQgKi8KLX0KLQogc3RhdGljIGludAog
aW5zZXJ0X21hcHBhYmxlX25vZGUoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCwKICAgICAgICAgICAg
ICAgICAgICAgIHN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZSwgdTMyIHNpemUpCkBAIC04NywyNSAr
NzQsNiBAQCByZW1vdmVfbWFwcGFibGVfbm9kZShzdHJ1Y3QgZHJtX21tX25vZGUgKm5vZGUpCiAJ
ZHJtX21tX3JlbW92ZV9ub2RlKG5vZGUpOwogfQogCi0vKiBzb21lIGJvb2trZWVwaW5nICovCi1z
dGF0aWMgdm9pZCBpOTE1X2dlbV9pbmZvX2FkZF9vYmooc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAotCQkJCSAgdTY0IHNpemUpCi17Ci0Jc3Bpbl9sb2NrKCZkZXZfcHJpdi0+bW0u
b2JqZWN0X3N0YXRfbG9jayk7Ci0JZGV2X3ByaXYtPm1tLm9iamVjdF9jb3VudCsrOwotCWRldl9w
cml2LT5tbS5vYmplY3RfbWVtb3J5ICs9IHNpemU7Ci0Jc3Bpbl91bmxvY2soJmRldl9wcml2LT5t
bS5vYmplY3Rfc3RhdF9sb2NrKTsKLX0KLQotc3RhdGljIHZvaWQgaTkxNV9nZW1faW5mb19yZW1v
dmVfb2JqKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCQkgICAgIHU2NCBz
aXplKQotewotCXNwaW5fbG9jaygmZGV2X3ByaXYtPm1tLm9iamVjdF9zdGF0X2xvY2spOwotCWRl
dl9wcml2LT5tbS5vYmplY3RfY291bnQtLTsKLQlkZXZfcHJpdi0+bW0ub2JqZWN0X21lbW9yeSAt
PSBzaXplOwotCXNwaW5fdW5sb2NrKCZkZXZfcHJpdi0+bW0ub2JqZWN0X3N0YXRfbG9jayk7Ci19
Ci0KIGludAogaTkxNV9nZW1fZ2V0X2FwZXJ0dXJlX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsIHZvaWQgKmRhdGEsCiAJCQkgICAgc3RydWN0IGRybV9maWxlICpmaWxlKQpAQCAtMjA2LDMy
ICsxNzQsNiBAQCBzdGF0aWMgaW50IGk5MTVfZ2VtX29iamVjdF9nZXRfcGFnZXNfcGh5cyhzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCXJldHVybiBlcnI7CiB9CiAKLXN0YXRpYyB2
b2lkIF9fc3RhcnRfY3B1X3dyaXRlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCi17
Ci0Jb2JqLT5yZWFkX2RvbWFpbnMgPSBJOTE1X0dFTV9ET01BSU5fQ1BVOwotCW9iai0+d3JpdGVf
ZG9tYWluID0gSTkxNV9HRU1fRE9NQUlOX0NQVTsKLQlpZiAoY3B1X3dyaXRlX25lZWRzX2NsZmx1
c2gob2JqKSkKLQkJb2JqLT5jYWNoZV9kaXJ0eSA9IHRydWU7Ci19Ci0KLXZvaWQKLV9faTkxNV9n
ZW1fb2JqZWN0X3JlbGVhc2Vfc2htZW0oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwK
LQkJCQlzdHJ1Y3Qgc2dfdGFibGUgKnBhZ2VzLAotCQkJCWJvb2wgbmVlZHNfY2xmbHVzaCkKLXsK
LQlHRU1fQlVHX09OKG9iai0+bW0ubWFkdiA9PSBfX0k5MTVfTUFEVl9QVVJHRUQpOwotCi0JaWYg
KG9iai0+bW0ubWFkdiA9PSBJOTE1X01BRFZfRE9OVE5FRUQpCi0JCW9iai0+bW0uZGlydHkgPSBm
YWxzZTsKLQotCWlmIChuZWVkc19jbGZsdXNoICYmCi0JICAgIChvYmotPnJlYWRfZG9tYWlucyAm
IEk5MTVfR0VNX0RPTUFJTl9DUFUpID09IDAgJiYKLQkgICAgIShvYmotPmNhY2hlX2NvaGVyZW50
ICYgSTkxNV9CT19DQUNIRV9DT0hFUkVOVF9GT1JfUkVBRCkpCi0JCWRybV9jbGZsdXNoX3NnKHBh
Z2VzKTsKLQotCV9fc3RhcnRfY3B1X3dyaXRlKG9iaik7Ci19Ci0KIHN0YXRpYyB2b2lkCiBpOTE1
X2dlbV9vYmplY3RfcHV0X3BhZ2VzX3BoeXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9i
aiwKIAkJCSAgICAgICBzdHJ1Y3Qgc2dfdGFibGUgKnBhZ2VzKQpAQCAtMjgzLDggKzIyNSw2IEBA
IHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdF9vcHMgaTkxNV9nZW1fcGh5
c19vcHMgPSB7CiAJLnJlbGVhc2UgPSBpOTE1X2dlbV9vYmplY3RfcmVsZWFzZV9waHlzLAogfTsK
IAotc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0X29wcyBpOTE1X2dlbV9v
YmplY3Rfb3BzOwotCiBpbnQgaTkxNV9nZW1fb2JqZWN0X3VuYmluZChzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqKQogewogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwpAQCAtNTQxLDcgKzQ4
MSw3IEBAIGk5MTVfZ2VtX2NyZWF0ZShzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUsCiAJCXJldHVybiAt
RUlOVkFMOwogCiAJLyogQWxsb2NhdGUgdGhlIG5ldyBvYmplY3QgKi8KLQlvYmogPSBpOTE1X2dl
bV9vYmplY3RfY3JlYXRlKGRldl9wcml2LCBzaXplKTsKKwlvYmogPSBpOTE1X2dlbV9vYmplY3Rf
Y3JlYXRlX3NobWVtKGRldl9wcml2LCBzaXplKTsKIAlpZiAoSVNfRVJSKG9iaikpCiAJCXJldHVy
biBQVFJfRVJSKG9iaik7CiAKQEAgLTIwNjUsNTIgKzIwMDUsNiBAQCB2b2lkIF9faTkxNV9nZW1f
b2JqZWN0X3RydW5jYXRlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiAJb2JqLT5t
bS5wYWdlcyA9IEVSUl9QVFIoLUVGQVVMVCk7CiB9CiAKLS8qCi0gKiBNb3ZlIHBhZ2VzIHRvIGFw
cHJvcHJpYXRlIGxydSBhbmQgcmVsZWFzZSB0aGUgcGFnZXZlYywgZGVjcmVtZW50aW5nIHRoZQot
ICogcmVmIGNvdW50IG9mIHRob3NlIHBhZ2VzLgotICovCi1zdGF0aWMgdm9pZCBjaGVja19yZWxl
YXNlX3BhZ2V2ZWMoc3RydWN0IHBhZ2V2ZWMgKnB2ZWMpCi17Ci0JY2hlY2tfbW92ZV91bmV2aWN0
YWJsZV9wYWdlcyhwdmVjKTsKLQlfX3BhZ2V2ZWNfcmVsZWFzZShwdmVjKTsKLQljb25kX3Jlc2No
ZWQoKTsKLX0KLQotc3RhdGljIHZvaWQKLWk5MTVfZ2VtX29iamVjdF9wdXRfcGFnZXNfZ3R0KHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCi0JCQkgICAgICBzdHJ1Y3Qgc2dfdGFibGUg
KnBhZ2VzKQotewotCXN0cnVjdCBzZ3RfaXRlciBzZ3RfaXRlcjsKLQlzdHJ1Y3QgcGFnZXZlYyBw
dmVjOwotCXN0cnVjdCBwYWdlICpwYWdlOwotCi0JX19pOTE1X2dlbV9vYmplY3RfcmVsZWFzZV9z
aG1lbShvYmosIHBhZ2VzLCB0cnVlKTsKLQlpOTE1X2dlbV9ndHRfZmluaXNoX3BhZ2VzKG9iaiwg
cGFnZXMpOwotCi0JaWYgKGk5MTVfZ2VtX29iamVjdF9uZWVkc19iaXQxN19zd2l6emxlKG9iaikp
Ci0JCWk5MTVfZ2VtX29iamVjdF9zYXZlX2JpdF8xN19zd2l6emxlKG9iaiwgcGFnZXMpOwotCi0J
bWFwcGluZ19jbGVhcl91bmV2aWN0YWJsZShmaWxlX2lub2RlKG9iai0+YmFzZS5maWxwKS0+aV9t
YXBwaW5nKTsKLQotCXBhZ2V2ZWNfaW5pdCgmcHZlYyk7Ci0JZm9yX2VhY2hfc2d0X3BhZ2UocGFn
ZSwgc2d0X2l0ZXIsIHBhZ2VzKSB7Ci0JCWlmIChvYmotPm1tLmRpcnR5KQotCQkJc2V0X3BhZ2Vf
ZGlydHkocGFnZSk7Ci0KLQkJaWYgKG9iai0+bW0ubWFkdiA9PSBJOTE1X01BRFZfV0lMTE5FRUQp
Ci0JCQltYXJrX3BhZ2VfYWNjZXNzZWQocGFnZSk7Ci0KLQkJaWYgKCFwYWdldmVjX2FkZCgmcHZl
YywgcGFnZSkpCi0JCQljaGVja19yZWxlYXNlX3BhZ2V2ZWMoJnB2ZWMpOwotCX0KLQlpZiAocGFn
ZXZlY19jb3VudCgmcHZlYykpCi0JCWNoZWNrX3JlbGVhc2VfcGFnZXZlYygmcHZlYyk7Ci0Jb2Jq
LT5tbS5kaXJ0eSA9IGZhbHNlOwotCi0Jc2dfZnJlZV90YWJsZShwYWdlcyk7Ci0Ja2ZyZWUocGFn
ZXMpOwotfQotCiBzdGF0aWMgdm9pZCBfX2k5MTVfZ2VtX29iamVjdF9yZXNldF9wYWdlX2l0ZXIo
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHsKIAlzdHJ1Y3QgcmFkaXhfdHJlZV9p
dGVyIGl0ZXI7CkBAIC0yMjI2LDE5NiArMjEyMCw2IEBAIGJvb2wgaTkxNV9zZ190cmltKHN0cnVj
dCBzZ190YWJsZSAqb3JpZ19zdCkKIAlyZXR1cm4gdHJ1ZTsKIH0KIAotc3RhdGljIGludCBpOTE1
X2dlbV9vYmplY3RfZ2V0X3BhZ2VzX2d0dChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
KQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUob2JqLT5i
YXNlLmRldik7Ci0JY29uc3QgdW5zaWduZWQgbG9uZyBwYWdlX2NvdW50ID0gb2JqLT5iYXNlLnNp
emUgLyBQQUdFX1NJWkU7Ci0JdW5zaWduZWQgbG9uZyBpOwotCXN0cnVjdCBhZGRyZXNzX3NwYWNl
ICptYXBwaW5nOwotCXN0cnVjdCBzZ190YWJsZSAqc3Q7Ci0Jc3RydWN0IHNjYXR0ZXJsaXN0ICpz
ZzsKLQlzdHJ1Y3Qgc2d0X2l0ZXIgc2d0X2l0ZXI7Ci0Jc3RydWN0IHBhZ2UgKnBhZ2U7Ci0JdW5z
aWduZWQgbG9uZyBsYXN0X3BmbiA9IDA7CS8qIHN1cHByZXNzIGdjYyB3YXJuaW5nICovCi0JdW5z
aWduZWQgaW50IG1heF9zZWdtZW50ID0gaTkxNV9zZ19zZWdtZW50X3NpemUoKTsKLQl1bnNpZ25l
ZCBpbnQgc2dfcGFnZV9zaXplczsKLQlzdHJ1Y3QgcGFnZXZlYyBwdmVjOwotCWdmcF90IG5vcmVj
bGFpbTsKLQlpbnQgcmV0OwotCi0JLyoKLQkgKiBBc3NlcnQgdGhhdCB0aGUgb2JqZWN0IGlzIG5v
dCBjdXJyZW50bHkgaW4gYW55IEdQVSBkb21haW4uIEFzIGl0Ci0JICogd2Fzbid0IGluIHRoZSBH
VFQsIHRoZXJlIHNob3VsZG4ndCBiZSBhbnkgd2F5IGl0IGNvdWxkIGhhdmUgYmVlbiBpbgotCSAq
IGEgR1BVIGNhY2hlCi0JICovCi0JR0VNX0JVR19PTihvYmotPnJlYWRfZG9tYWlucyAmIEk5MTVf
R0VNX0dQVV9ET01BSU5TKTsKLQlHRU1fQlVHX09OKG9iai0+d3JpdGVfZG9tYWluICYgSTkxNV9H
RU1fR1BVX0RPTUFJTlMpOwotCi0JLyoKLQkgKiBJZiB0aGVyZSdzIG5vIGNoYW5jZSBvZiBhbGxv
Y2F0aW5nIGVub3VnaCBwYWdlcyBmb3IgdGhlIHdob2xlCi0JICogb2JqZWN0LCBiYWlsIGVhcmx5
LgotCSAqLwotCWlmIChwYWdlX2NvdW50ID4gdG90YWxyYW1fcGFnZXMoKSkKLQkJcmV0dXJuIC1F
Tk9NRU07Ci0KLQlzdCA9IGttYWxsb2Moc2l6ZW9mKCpzdCksIEdGUF9LRVJORUwpOwotCWlmIChz
dCA9PSBOVUxMKQotCQlyZXR1cm4gLUVOT01FTTsKLQotcmVidWlsZF9zdDoKLQlpZiAoc2dfYWxs
b2NfdGFibGUoc3QsIHBhZ2VfY291bnQsIEdGUF9LRVJORUwpKSB7Ci0JCWtmcmVlKHN0KTsKLQkJ
cmV0dXJuIC1FTk9NRU07Ci0JfQotCi0JLyoKLQkgKiBHZXQgdGhlIGxpc3Qgb2YgcGFnZXMgb3V0
IG9mIG91ciBzdHJ1Y3QgZmlsZS4gIFRoZXknbGwgYmUgcGlubmVkCi0JICogYXQgdGhpcyBwb2lu
dCB1bnRpbCB3ZSByZWxlYXNlIHRoZW0uCi0JICoKLQkgKiBGYWlsIHNpbGVudGx5IHdpdGhvdXQg
c3RhcnRpbmcgdGhlIHNocmlua2VyCi0JICovCi0JbWFwcGluZyA9IG9iai0+YmFzZS5maWxwLT5m
X21hcHBpbmc7Ci0JbWFwcGluZ19zZXRfdW5ldmljdGFibGUobWFwcGluZyk7Ci0Jbm9yZWNsYWlt
ID0gbWFwcGluZ19nZnBfY29uc3RyYWludChtYXBwaW5nLCB+X19HRlBfUkVDTEFJTSk7Ci0Jbm9y
ZWNsYWltIHw9IF9fR0ZQX05PUkVUUlkgfCBfX0dGUF9OT1dBUk47Ci0KLQlzZyA9IHN0LT5zZ2w7
Ci0Jc3QtPm5lbnRzID0gMDsKLQlzZ19wYWdlX3NpemVzID0gMDsKLQlmb3IgKGkgPSAwOyBpIDwg
cGFnZV9jb3VudDsgaSsrKSB7Ci0JCWNvbnN0IHVuc2lnbmVkIGludCBzaHJpbmtbXSA9IHsKLQkJ
CUk5MTVfU0hSSU5LX0JPVU5EIHwgSTkxNV9TSFJJTktfVU5CT1VORCB8IEk5MTVfU0hSSU5LX1BV
UkdFQUJMRSwKLQkJCTAsCi0JCX0sICpzID0gc2hyaW5rOwotCQlnZnBfdCBnZnAgPSBub3JlY2xh
aW07Ci0KLQkJZG8gewotCQkJY29uZF9yZXNjaGVkKCk7Ci0JCQlwYWdlID0gc2htZW1fcmVhZF9t
YXBwaW5nX3BhZ2VfZ2ZwKG1hcHBpbmcsIGksIGdmcCk7Ci0JCQlpZiAoIUlTX0VSUihwYWdlKSkK
LQkJCQlicmVhazsKLQotCQkJaWYgKCEqcykgewotCQkJCXJldCA9IFBUUl9FUlIocGFnZSk7Ci0J
CQkJZ290byBlcnJfc2c7Ci0JCQl9Ci0KLQkJCWk5MTVfZ2VtX3NocmluayhkZXZfcHJpdiwgMiAq
IHBhZ2VfY291bnQsIE5VTEwsICpzKyspOwotCi0JCQkvKgotCQkJICogV2UndmUgdHJpZWQgaGFy
ZCB0byBhbGxvY2F0ZSB0aGUgbWVtb3J5IGJ5IHJlYXBpbmcKLQkJCSAqIG91ciBvd24gYnVmZmVy
LCBub3cgbGV0IHRoZSByZWFsIFZNIGRvIGl0cyBqb2IgYW5kCi0JCQkgKiBnbyBkb3duIGluIGZs
YW1lcyBpZiB0cnVseSBPT00uCi0JCQkgKgotCQkJICogSG93ZXZlciwgc2luY2UgZ3JhcGhpY3Mg
dGVuZCB0byBiZSBkaXNwb3NhYmxlLAotCQkJICogZGVmZXIgdGhlIG9vbSBoZXJlIGJ5IHJlcG9y
dGluZyB0aGUgRU5PTUVNIGJhY2sKLQkJCSAqIHRvIHVzZXJzcGFjZS4KLQkJCSAqLwotCQkJaWYg
KCEqcykgewotCQkJCS8qIHJlY2xhaW0gYW5kIHdhcm4sIGJ1dCBubyBvb20gKi8KLQkJCQlnZnAg
PSBtYXBwaW5nX2dmcF9tYXNrKG1hcHBpbmcpOwotCi0JCQkJLyoKLQkJCQkgKiBPdXIgYm8gYXJl
IGFsd2F5cyBkaXJ0eSBhbmQgc28gd2UgcmVxdWlyZQotCQkJCSAqIGtzd2FwZCB0byByZWNsYWlt
IG91ciBwYWdlcyAoZGlyZWN0IHJlY2xhaW0KLQkJCQkgKiBkb2VzIG5vdCBlZmZlY3RpdmVseSBi
ZWdpbiBwYWdlb3V0IG9mIG91cgotCQkJCSAqIGJ1ZmZlcnMgb24gaXRzIG93bikuIEhvd2V2ZXIs
IGRpcmVjdCByZWNsYWltCi0JCQkJICogb25seSB3YWl0cyBmb3Iga3N3YXBkIHdoZW4gdW5kZXIg
YWxsb2NhdGlvbgotCQkJCSAqIGNvbmdlc3Rpb24uIFNvIGFzIGEgcmVzdWx0IF9fR0ZQX1JFQ0xB
SU0gaXMKLQkJCQkgKiB1bnJlbGlhYmxlIGFuZCBmYWlscyB0byBhY3R1YWxseSByZWNsYWltIG91
cgotCQkJCSAqIGRpcnR5IHBhZ2VzIC0tIHVubGVzcyB5b3UgdHJ5IG92ZXIgYW5kIG92ZXIKLQkJ
CQkgKiBhZ2FpbiB3aXRoICFfX0dGUF9OT1JFVFJZLiBIb3dldmVyLCB3ZSBzdGlsbAotCQkJCSAq
IHdhbnQgdG8gZmFpbCB0aGlzIGFsbG9jYXRpb24gcmF0aGVyIHRoYW4KLQkJCQkgKiB0cmlnZ2Vy
IHRoZSBvdXQtb2YtbWVtb3J5IGtpbGxlciBhbmQgZm9yCi0JCQkJICogdGhpcyB3ZSB3YW50IF9f
R0ZQX1JFVFJZX01BWUZBSUwuCi0JCQkJICovCi0JCQkJZ2ZwIHw9IF9fR0ZQX1JFVFJZX01BWUZB
SUw7Ci0JCQl9Ci0JCX0gd2hpbGUgKDEpOwotCi0JCWlmICghaSB8fAotCQkgICAgc2ctPmxlbmd0
aCA+PSBtYXhfc2VnbWVudCB8fAotCQkgICAgcGFnZV90b19wZm4ocGFnZSkgIT0gbGFzdF9wZm4g
KyAxKSB7Ci0JCQlpZiAoaSkgewotCQkJCXNnX3BhZ2Vfc2l6ZXMgfD0gc2ctPmxlbmd0aDsKLQkJ
CQlzZyA9IHNnX25leHQoc2cpOwotCQkJfQotCQkJc3QtPm5lbnRzKys7Ci0JCQlzZ19zZXRfcGFn
ZShzZywgcGFnZSwgUEFHRV9TSVpFLCAwKTsKLQkJfSBlbHNlIHsKLQkJCXNnLT5sZW5ndGggKz0g
UEFHRV9TSVpFOwotCQl9Ci0JCWxhc3RfcGZuID0gcGFnZV90b19wZm4ocGFnZSk7Ci0KLQkJLyog
Q2hlY2sgdGhhdCB0aGUgaTk2NWcvZ20gd29ya2Fyb3VuZCB3b3Jrcy4gKi8KLQkJV0FSTl9PTigo
Z2ZwICYgX19HRlBfRE1BMzIpICYmIChsYXN0X3BmbiA+PSAweDAwMTAwMDAwVUwpKTsKLQl9Ci0J
aWYgKHNnKSB7IC8qIGxvb3AgdGVybWluYXRlZCBlYXJseTsgc2hvcnQgc2cgdGFibGUgKi8KLQkJ
c2dfcGFnZV9zaXplcyB8PSBzZy0+bGVuZ3RoOwotCQlzZ19tYXJrX2VuZChzZyk7Ci0JfQotCi0J
LyogVHJpbSB1bnVzZWQgc2cgZW50cmllcyB0byBhdm9pZCB3YXN0aW5nIG1lbW9yeS4gKi8KLQlp
OTE1X3NnX3RyaW0oc3QpOwotCi0JcmV0ID0gaTkxNV9nZW1fZ3R0X3ByZXBhcmVfcGFnZXMob2Jq
LCBzdCk7Ci0JaWYgKHJldCkgewotCQkvKgotCQkgKiBETUEgcmVtYXBwaW5nIGZhaWxlZD8gT25l
IHBvc3NpYmxlIGNhdXNlIGlzIHRoYXQKLQkJICogaXQgY291bGQgbm90IHJlc2VydmUgZW5vdWdo
IGxhcmdlIGVudHJpZXMsIGFza2luZwotCQkgKiBmb3IgUEFHRV9TSVpFIGNodW5rcyBpbnN0ZWFk
IG1heSBiZSBoZWxwZnVsLgotCQkgKi8KLQkJaWYgKG1heF9zZWdtZW50ID4gUEFHRV9TSVpFKSB7
Ci0JCQlmb3JfZWFjaF9zZ3RfcGFnZShwYWdlLCBzZ3RfaXRlciwgc3QpCi0JCQkJcHV0X3BhZ2Uo
cGFnZSk7Ci0JCQlzZ19mcmVlX3RhYmxlKHN0KTsKLQotCQkJbWF4X3NlZ21lbnQgPSBQQUdFX1NJ
WkU7Ci0JCQlnb3RvIHJlYnVpbGRfc3Q7Ci0JCX0gZWxzZSB7Ci0JCQlkZXZfd2FybigmZGV2X3By
aXYtPmRybS5wZGV2LT5kZXYsCi0JCQkJICJGYWlsZWQgdG8gRE1BIHJlbWFwICVsdSBwYWdlc1xu
IiwKLQkJCQkgcGFnZV9jb3VudCk7Ci0JCQlnb3RvIGVycl9wYWdlczsKLQkJfQotCX0KLQotCWlm
IChpOTE1X2dlbV9vYmplY3RfbmVlZHNfYml0MTdfc3dpenpsZShvYmopKQotCQlpOTE1X2dlbV9v
YmplY3RfZG9fYml0XzE3X3N3aXp6bGUob2JqLCBzdCk7Ci0KLQlfX2k5MTVfZ2VtX29iamVjdF9z
ZXRfcGFnZXMob2JqLCBzdCwgc2dfcGFnZV9zaXplcyk7Ci0KLQlyZXR1cm4gMDsKLQotZXJyX3Nn
OgotCXNnX21hcmtfZW5kKHNnKTsKLWVycl9wYWdlczoKLQltYXBwaW5nX2NsZWFyX3VuZXZpY3Rh
YmxlKG1hcHBpbmcpOwotCXBhZ2V2ZWNfaW5pdCgmcHZlYyk7Ci0JZm9yX2VhY2hfc2d0X3BhZ2Uo
cGFnZSwgc2d0X2l0ZXIsIHN0KSB7Ci0JCWlmICghcGFnZXZlY19hZGQoJnB2ZWMsIHBhZ2UpKQot
CQkJY2hlY2tfcmVsZWFzZV9wYWdldmVjKCZwdmVjKTsKLQl9Ci0JaWYgKHBhZ2V2ZWNfY291bnQo
JnB2ZWMpKQotCQljaGVja19yZWxlYXNlX3BhZ2V2ZWMoJnB2ZWMpOwotCXNnX2ZyZWVfdGFibGUo
c3QpOwotCWtmcmVlKHN0KTsKLQotCS8qCi0JICogc2htZW1mcyBmaXJzdCBjaGVja3MgaWYgdGhl
cmUgaXMgZW5vdWdoIG1lbW9yeSB0byBhbGxvY2F0ZSB0aGUgcGFnZQotCSAqIGFuZCByZXBvcnRz
IEVOT1NQQyBzaG91bGQgdGhlcmUgYmUgaW5zdWZmaWNpZW50LCBhbG9uZyB3aXRoIHRoZSB1c3Vh
bAotCSAqIEVOT01FTSBmb3IgYSBnZW51aW5lIGFsbG9jYXRpb24gZmFpbHVyZS4KLQkgKgotCSAq
IFdlIHVzZSBFTk9TUEMgaW4gb3VyIGRyaXZlciB0byBtZWFuIHRoYXQgd2UgaGF2ZSBydW4gb3V0
IG9mIGFwZXJ0dXJlCi0JICogc3BhY2UgYW5kIHNvIHdhbnQgdG8gdHJhbnNsYXRlIHRoZSBlcnJv
ciBmcm9tIHNobWVtZnMgYmFjayB0byBvdXIKLQkgKiB1c3VhbCB1bmRlcnN0YW5kaW5nIG9mIEVO
T01FTS4KLQkgKi8KLQlpZiAocmV0ID09IC1FTk9TUEMpCi0JCXJldCA9IC1FTk9NRU07Ci0KLQly
ZXR1cm4gcmV0OwotfQotCiB2b2lkIF9faTkxNV9nZW1fb2JqZWN0X3NldF9wYWdlcyhzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkJCSBzdHJ1Y3Qgc2dfdGFibGUgKnBhZ2VzLAog
CQkJCSB1bnNpZ25lZCBpbnQgc2dfcGFnZV9zaXplcykKQEAgLTI2NjIsMTMzICsyMzY2LDYgQEAg
dm9pZCBfX2k5MTVfZ2VtX29iamVjdF9mbHVzaF9tYXAoc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iaiwKIAl9CiB9CiAKLXN0YXRpYyBpbnQKLWk5MTVfZ2VtX29iamVjdF9wd3JpdGVfZ3R0
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCi0JCQkgICBjb25zdCBzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX3B3cml0ZSAqYXJnKQotewotCXN0cnVjdCBhZGRyZXNzX3NwYWNlICptYXBwaW5n
ID0gb2JqLT5iYXNlLmZpbHAtPmZfbWFwcGluZzsKLQljaGFyIF9fdXNlciAqdXNlcl9kYXRhID0g
dTY0X3RvX3VzZXJfcHRyKGFyZy0+ZGF0YV9wdHIpOwotCXU2NCByZW1haW4sIG9mZnNldDsKLQl1
bnNpZ25lZCBpbnQgcGc7Ci0KLQkvKiBDYWxsZXIgYWxyZWFkeSB2YWxpZGF0ZWQgdXNlciBhcmdz
ICovCi0JR0VNX0JVR19PTighYWNjZXNzX29rKHVzZXJfZGF0YSwgYXJnLT5zaXplKSk7Ci0KLQkv
KgotCSAqIEJlZm9yZSB3ZSBpbnN0YW50aWF0ZS9waW4gdGhlIGJhY2tpbmcgc3RvcmUgZm9yIG91
ciB1c2UsIHdlCi0JICogY2FuIHByZXBvcHVsYXRlIHRoZSBzaG1lbWZzIGZpbHAgZWZmaWNpZW50
bHkgdXNpbmcgYSB3cml0ZSBpbnRvCi0JICogdGhlIHBhZ2VjYWNoZS4gV2UgYXZvaWQgdGhlIHBl
bmFsdHkgb2YgaW5zdGFudGlhdGluZyBhbGwgdGhlCi0JICogcGFnZXMsIGltcG9ydGFudCBpZiB0
aGUgdXNlciBpcyBqdXN0IHdyaXRpbmcgdG8gYSBmZXcgYW5kIG5ldmVyCi0JICogdXNlcyB0aGUg
b2JqZWN0IG9uIHRoZSBHUFUsIGFuZCB1c2luZyBhIGRpcmVjdCB3cml0ZSBpbnRvIHNobWVtZnMK
LQkgKiBhbGxvd3MgaXQgdG8gYXZvaWQgdGhlIGNvc3Qgb2YgcmV0cmlldmluZyBhIHBhZ2UgKGVp
dGhlciBzd2FwaW4KLQkgKiBvciBjbGVhcmluZy1iZWZvcmUtdXNlKSBiZWZvcmUgaXQgaXMgb3Zl
cndyaXR0ZW4uCi0JICovCi0JaWYgKGk5MTVfZ2VtX29iamVjdF9oYXNfcGFnZXMob2JqKSkKLQkJ
cmV0dXJuIC1FTk9ERVY7Ci0KLQlpZiAob2JqLT5tbS5tYWR2ICE9IEk5MTVfTUFEVl9XSUxMTkVF
RCkKLQkJcmV0dXJuIC1FRkFVTFQ7Ci0KLQkvKgotCSAqIEJlZm9yZSB0aGUgcGFnZXMgYXJlIGlu
c3RhbnRpYXRlZCB0aGUgb2JqZWN0IGlzIHRyZWF0ZWQgYXMgYmVpbmcKLQkgKiBpbiB0aGUgQ1BV
IGRvbWFpbi4gVGhlIHBhZ2VzIHdpbGwgYmUgY2xmbHVzaGVkIGFzIHJlcXVpcmVkIGJlZm9yZQot
CSAqIHVzZSwgYW5kIHdlIGNhbiBmcmVlbHkgd3JpdGUgaW50byB0aGUgcGFnZXMgZGlyZWN0bHku
IElmIHVzZXJzcGFjZQotCSAqIHJhY2VzIHB3cml0ZSB3aXRoIGFueSBvdGhlciBvcGVyYXRpb247
IGNvcnJ1cHRpb24gd2lsbCBlbnN1ZSAtCi0JICogdGhhdCBpcyB1c2Vyc3BhY2UncyBwcmVyb2dh
dGl2ZSEKLQkgKi8KLQotCXJlbWFpbiA9IGFyZy0+c2l6ZTsKLQlvZmZzZXQgPSBhcmctPm9mZnNl
dDsKLQlwZyA9IG9mZnNldF9pbl9wYWdlKG9mZnNldCk7Ci0KLQlkbyB7Ci0JCXVuc2lnbmVkIGlu
dCBsZW4sIHVud3JpdHRlbjsKLQkJc3RydWN0IHBhZ2UgKnBhZ2U7Ci0JCXZvaWQgKmRhdGEsICp2
YWRkcjsKLQkJaW50IGVycjsKLQkJY2hhciBjOwotCi0JCWxlbiA9IFBBR0VfU0laRSAtIHBnOwot
CQlpZiAobGVuID4gcmVtYWluKQotCQkJbGVuID0gcmVtYWluOwotCi0JCS8qIFByZWZhdWx0IHRo
ZSB1c2VyIHBhZ2UgdG8gcmVkdWNlIHBvdGVudGlhbCByZWN1cnNpb24gKi8KLQkJZXJyID0gX19n
ZXRfdXNlcihjLCB1c2VyX2RhdGEpOwotCQlpZiAoZXJyKQotCQkJcmV0dXJuIGVycjsKLQotCQll
cnIgPSBfX2dldF91c2VyKGMsIHVzZXJfZGF0YSArIGxlbiAtIDEpOwotCQlpZiAoZXJyKQotCQkJ
cmV0dXJuIGVycjsKLQotCQllcnIgPSBwYWdlY2FjaGVfd3JpdGVfYmVnaW4ob2JqLT5iYXNlLmZp
bHAsIG1hcHBpbmcsCi0JCQkJCSAgICBvZmZzZXQsIGxlbiwgMCwKLQkJCQkJICAgICZwYWdlLCAm
ZGF0YSk7Ci0JCWlmIChlcnIgPCAwKQotCQkJcmV0dXJuIGVycjsKLQotCQl2YWRkciA9IGttYXBf
YXRvbWljKHBhZ2UpOwotCQl1bndyaXR0ZW4gPSBfX2NvcHlfZnJvbV91c2VyX2luYXRvbWljKHZh
ZGRyICsgcGcsCi0JCQkJCQkgICAgICB1c2VyX2RhdGEsCi0JCQkJCQkgICAgICBsZW4pOwotCQlr
dW5tYXBfYXRvbWljKHZhZGRyKTsKLQotCQllcnIgPSBwYWdlY2FjaGVfd3JpdGVfZW5kKG9iai0+
YmFzZS5maWxwLCBtYXBwaW5nLAotCQkJCQkgIG9mZnNldCwgbGVuLCBsZW4gLSB1bndyaXR0ZW4s
Ci0JCQkJCSAgcGFnZSwgZGF0YSk7Ci0JCWlmIChlcnIgPCAwKQotCQkJcmV0dXJuIGVycjsKLQot
CQkvKiBXZSBkb24ndCBoYW5kbGUgLUVGQVVMVCwgbGVhdmUgaXQgdG8gdGhlIGNhbGxlciB0byBj
aGVjayAqLwotCQlpZiAodW53cml0dGVuKQotCQkJcmV0dXJuIC1FTk9ERVY7Ci0KLQkJcmVtYWlu
IC09IGxlbjsKLQkJdXNlcl9kYXRhICs9IGxlbjsKLQkJb2Zmc2V0ICs9IGxlbjsKLQkJcGcgPSAw
OwotCX0gd2hpbGUgKHJlbWFpbik7Ci0KLQlyZXR1cm4gMDsKLX0KLQotdm9pZCBpOTE1X2dlbV9j
bG9zZV9vYmplY3Qoc3RydWN0IGRybV9nZW1fb2JqZWN0ICpnZW0sIHN0cnVjdCBkcm1fZmlsZSAq
ZmlsZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZ2VtLT5k
ZXYpOwotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB0b19pbnRlbF9ibyhnZW0p
OwotCXN0cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGUgKmZwcml2ID0gZmlsZS0+ZHJpdmVyX3By
aXY7Ci0Jc3RydWN0IGk5MTVfbHV0X2hhbmRsZSAqbHV0LCAqbG47Ci0KLQltdXRleF9sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQotCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShsdXQs
IGxuLCAmb2JqLT5sdXRfbGlzdCwgb2JqX2xpbmspIHsKLQkJc3RydWN0IGk5MTVfZ2VtX2NvbnRl
eHQgKmN0eCA9IGx1dC0+Y3R4OwotCQlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKLQotCQlHRU1fQlVH
X09OKGN0eC0+ZmlsZV9wcml2ID09IEVSUl9QVFIoLUVCQURGKSk7Ci0JCWlmIChjdHgtPmZpbGVf
cHJpdiAhPSBmcHJpdikKLQkJCWNvbnRpbnVlOwotCi0JCXZtYSA9IHJhZGl4X3RyZWVfZGVsZXRl
KCZjdHgtPmhhbmRsZXNfdm1hLCBsdXQtPmhhbmRsZSk7Ci0JCUdFTV9CVUdfT04odm1hLT5vYmog
IT0gb2JqKTsKLQotCQkvKiBXZSBhbGxvdyB0aGUgcHJvY2VzcyB0byBoYXZlIG11bHRpcGxlIGhh
bmRsZXMgdG8gdGhlIHNhbWUKLQkJICogdm1hLCBpbiB0aGUgc2FtZSBmZCBuYW1lc3BhY2UsIGJ5
IHZpcnR1ZSBvZiBmbGluay9vcGVuLgotCQkgKi8KLQkJR0VNX0JVR19PTighdm1hLT5vcGVuX2Nv
dW50KTsKLQkJaWYgKCEtLXZtYS0+b3Blbl9jb3VudCAmJiAhaTkxNV92bWFfaXNfZ2d0dCh2bWEp
KQotCQkJaTkxNV92bWFfY2xvc2Uodm1hKTsKLQotCQlsaXN0X2RlbCgmbHV0LT5vYmpfbGluayk7
Ci0JCWxpc3RfZGVsKCZsdXQtPmN0eF9saW5rKTsKLQotCQlpOTE1X2x1dF9oYW5kbGVfZnJlZShs
dXQpOwotCQlfX2k5MTVfZ2VtX29iamVjdF9yZWxlYXNlX3VubGVzc19hY3RpdmUob2JqKTsKLQl9
Ci0KLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotfQotCiBzdGF0aWMg
dW5zaWduZWQgbG9uZyB0b193YWl0X3RpbWVvdXQoczY0IHRpbWVvdXRfbnMpCiB7CiAJaWYgKHRp
bWVvdXRfbnMgPCAwKQpAQCAtMzc4NywzNDggKzMzNjQsNiBAQCBpOTE1X2dlbV9tYWR2aXNlX2lv
Y3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJcmV0dXJuIGVycjsKIH0K
IAotc3RhdGljIHZvaWQKLWZyb250YnVmZmVyX3JldGlyZShzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVx
dWVzdCAqYWN0aXZlLAotCQkgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0KQotewotCXN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPQotCQljb250YWluZXJfb2YoYWN0aXZlLCB0
eXBlb2YoKm9iaiksIGZyb250YnVmZmVyX3dyaXRlKTsKLQotCWludGVsX2ZiX29ial9mbHVzaChv
YmosIE9SSUdJTl9DUyk7Ci19Ci0KLXZvaWQgaTkxNV9nZW1fb2JqZWN0X2luaXQoc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKLQkJCSAgY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3Rfb3BzICpvcHMpCi17Ci0JbXV0ZXhfaW5pdCgmb2JqLT5tbS5sb2NrKTsKLQotCXNwaW5f
bG9ja19pbml0KCZvYmotPnZtYS5sb2NrKTsKLQlJTklUX0xJU1RfSEVBRCgmb2JqLT52bWEubGlz
dCk7Ci0KLQlJTklUX0xJU1RfSEVBRCgmb2JqLT5sdXRfbGlzdCk7Ci0JSU5JVF9MSVNUX0hFQUQo
Jm9iai0+YmF0Y2hfcG9vbF9saW5rKTsKLQotCWluaXRfcmN1X2hlYWQoJm9iai0+cmN1KTsKLQot
CW9iai0+b3BzID0gb3BzOwotCi0JcmVzZXJ2YXRpb25fb2JqZWN0X2luaXQoJm9iai0+X19idWls
dGluX3Jlc3YpOwotCW9iai0+cmVzdiA9ICZvYmotPl9fYnVpbHRpbl9yZXN2OwotCi0Jb2JqLT5m
cm9udGJ1ZmZlcl9nZ3R0X29yaWdpbiA9IE9SSUdJTl9HVFQ7Ci0JaTkxNV9hY3RpdmVfcmVxdWVz
dF9pbml0KCZvYmotPmZyb250YnVmZmVyX3dyaXRlLAotCQkJCSBOVUxMLCBmcm9udGJ1ZmZlcl9y
ZXRpcmUpOwotCi0Jb2JqLT5tbS5tYWR2ID0gSTkxNV9NQURWX1dJTExORUVEOwotCUlOSVRfUkFE
SVhfVFJFRSgmb2JqLT5tbS5nZXRfcGFnZS5yYWRpeCwgR0ZQX0tFUk5FTCB8IF9fR0ZQX05PV0FS
Tik7Ci0JbXV0ZXhfaW5pdCgmb2JqLT5tbS5nZXRfcGFnZS5sb2NrKTsKLQotCWk5MTVfZ2VtX2lu
Zm9fYWRkX29iaih0b19pOTE1KG9iai0+YmFzZS5kZXYpLCBvYmotPmJhc2Uuc2l6ZSk7Ci19Ci0K
LXN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdF9vcHMgaTkxNV9nZW1fb2Jq
ZWN0X29wcyA9IHsKLQkuZmxhZ3MgPSBJOTE1X0dFTV9PQkpFQ1RfSEFTX1NUUlVDVF9QQUdFIHwK
LQkJIEk5MTVfR0VNX09CSkVDVF9JU19TSFJJTktBQkxFLAotCi0JLmdldF9wYWdlcyA9IGk5MTVf
Z2VtX29iamVjdF9nZXRfcGFnZXNfZ3R0LAotCS5wdXRfcGFnZXMgPSBpOTE1X2dlbV9vYmplY3Rf
cHV0X3BhZ2VzX2d0dCwKLQotCS5wd3JpdGUgPSBpOTE1X2dlbV9vYmplY3RfcHdyaXRlX2d0dCwK
LX07Ci0KLXN0YXRpYyBpbnQgaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zaG1lbShzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2LAotCQkJCQlzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiwKLQkJCQkJc2l6
ZV90IHNpemUpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRl
dik7Ci0JdW5zaWduZWQgbG9uZyBmbGFncyA9IFZNX05PUkVTRVJWRTsKLQlzdHJ1Y3QgZmlsZSAq
ZmlscDsKLQotCWRybV9nZW1fcHJpdmF0ZV9vYmplY3RfaW5pdChkZXYsIG9iaiwgc2l6ZSk7Ci0K
LQlpZiAoaTkxNS0+bW0uZ2VtZnMpCi0JCWZpbHAgPSBzaG1lbV9maWxlX3NldHVwX3dpdGhfbW50
KGk5MTUtPm1tLmdlbWZzLCAiaTkxNSIsIHNpemUsCi0JCQkJCQkgZmxhZ3MpOwotCWVsc2UKLQkJ
ZmlscCA9IHNobWVtX2ZpbGVfc2V0dXAoImk5MTUiLCBzaXplLCBmbGFncyk7Ci0KLQlpZiAoSVNf
RVJSKGZpbHApKQotCQlyZXR1cm4gUFRSX0VSUihmaWxwKTsKLQotCW9iai0+ZmlscCA9IGZpbHA7
Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKgotaTkxNV9n
ZW1fb2JqZWN0X2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHU2NCBz
aXplKQotewotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7Ci0Jc3RydWN0IGFkZHJl
c3Nfc3BhY2UgKm1hcHBpbmc7Ci0JdW5zaWduZWQgaW50IGNhY2hlX2xldmVsOwotCWdmcF90IG1h
c2s7Ci0JaW50IHJldDsKLQotCS8qIFRoZXJlIGlzIGEgcHJldmFsZW5jZSBvZiB0aGUgYXNzdW1w
dGlvbiB0aGF0IHdlIGZpdCB0aGUgb2JqZWN0J3MKLQkgKiBwYWdlIGNvdW50IGluc2lkZSBhIDMy
Yml0IF9zaWduZWRfIHZhcmlhYmxlLiBMZXQncyBkb2N1bWVudCB0aGlzIGFuZAotCSAqIGNhdGNo
IGlmIHdlIGV2ZXIgbmVlZCB0byBmaXggaXQuIEluIHRoZSBtZWFudGltZSwgaWYgeW91IGRvIHNw
b3QKLQkgKiBzdWNoIGEgbG9jYWwgdmFyaWFibGUsIHBsZWFzZSBjb25zaWRlciBmaXhpbmchCi0J
ICovCi0JaWYgKHNpemUgPj4gUEFHRV9TSElGVCA+IElOVF9NQVgpCi0JCXJldHVybiBFUlJfUFRS
KC1FMkJJRyk7Ci0KLQlpZiAob3ZlcmZsb3dzX3R5cGUoc2l6ZSwgb2JqLT5iYXNlLnNpemUpKQot
CQlyZXR1cm4gRVJSX1BUUigtRTJCSUcpOwotCi0Jb2JqID0gaTkxNV9nZW1fb2JqZWN0X2FsbG9j
KCk7Ci0JaWYgKG9iaiA9PSBOVUxMKQotCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKLQotCXJl
dCA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc2htZW0oJmRldl9wcml2LT5kcm0sICZvYmotPmJh
c2UsIHNpemUpOwotCWlmIChyZXQpCi0JCWdvdG8gZmFpbDsKLQotCW1hc2sgPSBHRlBfSElHSFVT
RVIgfCBfX0dGUF9SRUNMQUlNQUJMRTsKLQlpZiAoSVNfSTk2NUdNKGRldl9wcml2KSB8fCBJU19J
OTY1RyhkZXZfcHJpdikpIHsKLQkJLyogOTY1Z20gY2Fubm90IHJlbG9jYXRlIG9iamVjdHMgYWJv
dmUgNEdpQi4gKi8KLQkJbWFzayAmPSB+X19HRlBfSElHSE1FTTsKLQkJbWFzayB8PSBfX0dGUF9E
TUEzMjsKLQl9Ci0KLQltYXBwaW5nID0gb2JqLT5iYXNlLmZpbHAtPmZfbWFwcGluZzsKLQltYXBw
aW5nX3NldF9nZnBfbWFzayhtYXBwaW5nLCBtYXNrKTsKLQlHRU1fQlVHX09OKCEobWFwcGluZ19n
ZnBfbWFzayhtYXBwaW5nKSAmIF9fR0ZQX1JFQ0xBSU0pKTsKLQotCWk5MTVfZ2VtX29iamVjdF9p
bml0KG9iaiwgJmk5MTVfZ2VtX29iamVjdF9vcHMpOwotCi0Jb2JqLT53cml0ZV9kb21haW4gPSBJ
OTE1X0dFTV9ET01BSU5fQ1BVOwotCW9iai0+cmVhZF9kb21haW5zID0gSTkxNV9HRU1fRE9NQUlO
X0NQVTsKLQotCWlmIChIQVNfTExDKGRldl9wcml2KSkKLQkJLyogT24gc29tZSBkZXZpY2VzLCB3
ZSBjYW4gaGF2ZSB0aGUgR1BVIHVzZSB0aGUgTExDICh0aGUgQ1BVCi0JCSAqIGNhY2hlKSBmb3Ig
YWJvdXQgYSAxMCUgcGVyZm9ybWFuY2UgaW1wcm92ZW1lbnQKLQkJICogY29tcGFyZWQgdG8gdW5j
YWNoZWQuICBHcmFwaGljcyByZXF1ZXN0cyBvdGhlciB0aGFuCi0JCSAqIGRpc3BsYXkgc2Nhbm91
dCBhcmUgY29oZXJlbnQgd2l0aCB0aGUgQ1BVIGluCi0JCSAqIGFjY2Vzc2luZyB0aGlzIGNhY2hl
LiAgVGhpcyBtZWFucyBpbiB0aGlzIG1vZGUgd2UKLQkJICogZG9uJ3QgbmVlZCB0byBjbGZsdXNo
IG9uIHRoZSBDUFUgc2lkZSwgYW5kIG9uIHRoZQotCQkgKiBHUFUgc2lkZSB3ZSBvbmx5IG5lZWQg
dG8gZmx1c2ggaW50ZXJuYWwgY2FjaGVzIHRvCi0JCSAqIGdldCBkYXRhIHZpc2libGUgdG8gdGhl
IENQVS4KLQkJICoKLQkJICogSG93ZXZlciwgd2UgbWFpbnRhaW4gdGhlIGRpc3BsYXkgcGxhbmVz
IGFzIFVDLCBhbmQgc28KLQkJICogbmVlZCB0byByZWJpbmQgd2hlbiBmaXJzdCB1c2VkIGFzIHN1
Y2guCi0JCSAqLwotCQljYWNoZV9sZXZlbCA9IEk5MTVfQ0FDSEVfTExDOwotCWVsc2UKLQkJY2Fj
aGVfbGV2ZWwgPSBJOTE1X0NBQ0hFX05PTkU7Ci0KLQlpOTE1X2dlbV9vYmplY3Rfc2V0X2NhY2hl
X2NvaGVyZW5jeShvYmosIGNhY2hlX2xldmVsKTsKLQotCXRyYWNlX2k5MTVfZ2VtX29iamVjdF9j
cmVhdGUob2JqKTsKLQotCXJldHVybiBvYmo7Ci0KLWZhaWw6Ci0JaTkxNV9nZW1fb2JqZWN0X2Zy
ZWUob2JqKTsKLQlyZXR1cm4gRVJSX1BUUihyZXQpOwotfQotCi1zdGF0aWMgYm9vbCBkaXNjYXJk
X2JhY2tpbmdfc3RvcmFnZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQotewotCS8q
IElmIHdlIGFyZSB0aGUgbGFzdCB1c2VyIG9mIHRoZSBiYWNraW5nIHN0b3JhZ2UgKGJlIGl0IHNo
bWVtZnMKLQkgKiBwYWdlcyBvciBzdG9sZW4gZXRjKSwgd2Uga25vdyB0aGF0IHRoZSBwYWdlcyBh
cmUgZ29pbmcgdG8gYmUKLQkgKiBpbW1lZGlhdGVseSByZWxlYXNlZC4gSW4gdGhpcyBjYXNlLCB3
ZSBjYW4gdGhlbiBza2lwIGNvcHlpbmcKLQkgKiBiYWNrIHRoZSBjb250ZW50cyBmcm9tIHRoZSBH
UFUuCi0JICovCi0KLQlpZiAob2JqLT5tbS5tYWR2ICE9IEk5MTVfTUFEVl9XSUxMTkVFRCkKLQkJ
cmV0dXJuIGZhbHNlOwotCi0JaWYgKG9iai0+YmFzZS5maWxwID09IE5VTEwpCi0JCXJldHVybiB0
cnVlOwotCi0JLyogQXQgZmlyc3QgZ2xhbmNlLCB0aGlzIGxvb2tzIHJhY3ksIGJ1dCB0aGVuIGFn
YWluIHNvIHdvdWxkIGJlCi0JICogdXNlcnNwYWNlIHJhY2luZyBtbWFwIGFnYWluc3QgY2xvc2Uu
IEhvd2V2ZXIsIHRoZSBmaXJzdCBleHRlcm5hbAotCSAqIHJlZmVyZW5jZSB0byB0aGUgZmlscCBj
YW4gb25seSBiZSBvYnRhaW5lZCB0aHJvdWdoIHRoZQotCSAqIGk5MTVfZ2VtX21tYXBfaW9jdGwo
KSB3aGljaCBzYWZlZ3VhcmRzIHVzIGFnYWluc3QgdGhlIHVzZXIKLQkgKiBhY3F1aXJpbmcgc3Vj
aCBhIHJlZmVyZW5jZSB3aGlsc3Qgd2UgYXJlIGluIHRoZSBtaWRkbGUgb2YKLQkgKiBmcmVlaW5n
IHRoZSBvYmplY3QuCi0JICovCi0JcmV0dXJuIGF0b21pY19sb25nX3JlYWQoJm9iai0+YmFzZS5m
aWxwLT5mX2NvdW50KSA9PSAxOwotfQotCi1zdGF0aWMgdm9pZCBfX2k5MTVfZ2VtX2ZyZWVfb2Jq
ZWN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKLQkJCQkgICAgc3RydWN0IGxsaXN0
X25vZGUgKmZyZWVkKQotewotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosICpvbjsK
LQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKLQotCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3Bt
X2dldChpOTE1KTsKLQlsbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKG9iaiwgb24sIGZyZWVkLCBm
cmVlZCkgewotCQlzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgKnZuOwotCi0JCXRyYWNlX2k5MTVfZ2Vt
X29iamVjdF9kZXN0cm95KG9iaik7Ci0KLQkJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7Ci0KLQkJR0VNX0JVR19PTihpOTE1X2dlbV9vYmplY3RfaXNfYWN0aXZlKG9iaikpOwot
CQlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUodm1hLCB2biwgJm9iai0+dm1hLmxpc3QsIG9ial9s
aW5rKSB7Ci0JCQlHRU1fQlVHX09OKGk5MTVfdm1hX2lzX2FjdGl2ZSh2bWEpKTsKLQkJCXZtYS0+
ZmxhZ3MgJj0gfkk5MTVfVk1BX1BJTl9NQVNLOwotCQkJaTkxNV92bWFfZGVzdHJveSh2bWEpOwot
CQl9Ci0JCUdFTV9CVUdfT04oIWxpc3RfZW1wdHkoJm9iai0+dm1hLmxpc3QpKTsKLQkJR0VNX0JV
R19PTighUkJfRU1QVFlfUk9PVCgmb2JqLT52bWEudHJlZSkpOwotCi0JCS8qIFRoaXMgc2VyaWFs
aXplcyBmcmVlaW5nIHdpdGggdGhlIHNocmlua2VyLiBTaW5jZSB0aGUgZnJlZQotCQkgKiBpcyBk
ZWxheWVkLCBmaXJzdCBieSBSQ1UgdGhlbiBieSB0aGUgd29ya3F1ZXVlLCB3ZSB3YW50IHRoZQot
CQkgKiBzaHJpbmtlciB0byBiZSBhYmxlIHRvIGZyZWUgcGFnZXMgb2YgdW5yZWZlcmVuY2VkIG9i
amVjdHMsCi0JCSAqIG9yIGVsc2Ugd2UgbWF5IG9vbSB3aGlsc3QgdGhlcmUgYXJlIHBsZW50eSBv
ZiBkZWZlcnJlZAotCQkgKiBmcmVlZCBvYmplY3RzLgotCQkgKi8KLQkJaWYgKGk5MTVfZ2VtX29i
amVjdF9oYXNfcGFnZXMob2JqKSkgewotCQkJc3Bpbl9sb2NrKCZpOTE1LT5tbS5vYmpfbG9jayk7
Ci0JCQlsaXN0X2RlbF9pbml0KCZvYmotPm1tLmxpbmspOwotCQkJc3Bpbl91bmxvY2soJmk5MTUt
Pm1tLm9ial9sb2NrKTsKLQkJfQotCi0JCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7Ci0KLQkJR0VNX0JVR19PTihvYmotPmJpbmRfY291bnQpOwotCQlHRU1fQlVHX09OKG9i
ai0+dXNlcmZhdWx0X2NvdW50KTsKLQkJR0VNX0JVR19PTihhdG9taWNfcmVhZCgmb2JqLT5mcm9u
dGJ1ZmZlcl9iaXRzKSk7Ci0JCUdFTV9CVUdfT04oIWxpc3RfZW1wdHkoJm9iai0+bHV0X2xpc3Qp
KTsKLQotCQlpZiAob2JqLT5vcHMtPnJlbGVhc2UpCi0JCQlvYmotPm9wcy0+cmVsZWFzZShvYmop
OwotCi0JCWlmIChXQVJOX09OKGk5MTVfZ2VtX29iamVjdF9oYXNfcGlubmVkX3BhZ2VzKG9iaikp
KQotCQkJYXRvbWljX3NldCgmb2JqLT5tbS5wYWdlc19waW5fY291bnQsIDApOwotCQlfX2k5MTVf
Z2VtX29iamVjdF9wdXRfcGFnZXMob2JqLCBJOTE1X01NX05PUk1BTCk7Ci0JCUdFTV9CVUdfT04o
aTkxNV9nZW1fb2JqZWN0X2hhc19wYWdlcyhvYmopKTsKLQotCQlpZiAob2JqLT5iYXNlLmltcG9y
dF9hdHRhY2gpCi0JCQlkcm1fcHJpbWVfZ2VtX2Rlc3Ryb3koJm9iai0+YmFzZSwgTlVMTCk7Ci0K
LQkJcmVzZXJ2YXRpb25fb2JqZWN0X2ZpbmkoJm9iai0+X19idWlsdGluX3Jlc3YpOwotCQlkcm1f
Z2VtX29iamVjdF9yZWxlYXNlKCZvYmotPmJhc2UpOwotCQlpOTE1X2dlbV9pbmZvX3JlbW92ZV9v
YmooaTkxNSwgb2JqLT5iYXNlLnNpemUpOwotCi0JCWJpdG1hcF9mcmVlKG9iai0+Yml0XzE3KTsK
LQkJaTkxNV9nZW1fb2JqZWN0X2ZyZWUob2JqKTsKLQotCQlHRU1fQlVHX09OKCFhdG9taWNfcmVh
ZCgmaTkxNS0+bW0uZnJlZV9jb3VudCkpOwotCQlhdG9taWNfZGVjKCZpOTE1LT5tbS5mcmVlX2Nv
dW50KTsKLQotCQlpZiAob24pCi0JCQljb25kX3Jlc2NoZWQoKTsKLQl9Ci0JaW50ZWxfcnVudGlt
ZV9wbV9wdXQoaTkxNSwgd2FrZXJlZik7Ci19Ci0KLXN0YXRpYyB2b2lkIGk5MTVfZ2VtX2ZsdXNo
X2ZyZWVfb2JqZWN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKLXsKLQlzdHJ1Y3Qg
bGxpc3Rfbm9kZSAqZnJlZWQ7Ci0KLQkvKiBGcmVlIHRoZSBvbGRlc3QsIG1vc3Qgc3RhbGUgb2Jq
ZWN0IHRvIGtlZXAgdGhlIGZyZWVfbGlzdCBzaG9ydCAqLwotCWZyZWVkID0gTlVMTDsKLQlpZiAo
IWxsaXN0X2VtcHR5KCZpOTE1LT5tbS5mcmVlX2xpc3QpKSB7IC8qIHF1aWNrIHRlc3QgZm9yIGhv
dHBhdGggKi8KLQkJLyogT25seSBvbmUgY29uc3VtZXIgb2YgbGxpc3RfZGVsX2ZpcnN0KCkgYWxs
b3dlZCAqLwotCQlzcGluX2xvY2soJmk5MTUtPm1tLmZyZWVfbG9jayk7Ci0JCWZyZWVkID0gbGxp
c3RfZGVsX2ZpcnN0KCZpOTE1LT5tbS5mcmVlX2xpc3QpOwotCQlzcGluX3VubG9jaygmaTkxNS0+
bW0uZnJlZV9sb2NrKTsKLQl9Ci0JaWYgKHVubGlrZWx5KGZyZWVkKSkgewotCQlmcmVlZC0+bmV4
dCA9IE5VTEw7Ci0JCV9faTkxNV9nZW1fZnJlZV9vYmplY3RzKGk5MTUsIGZyZWVkKTsKLQl9Ci19
Ci0KLXN0YXRpYyB2b2lkIF9faTkxNV9nZW1fZnJlZV93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAq
d29yaykKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9Ci0JCWNvbnRhaW5lcl9v
Zih3b3JrLCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSwgbW0uZnJlZV93b3JrKTsKLQlzdHJ1Y3Qg
bGxpc3Rfbm9kZSAqZnJlZWQ7Ci0KLQkvKgotCSAqIEFsbCBmaWxlLW93bmVkIFZNQSBzaG91bGQg
aGF2ZSBiZWVuIHJlbGVhc2VkIGJ5IHRoaXMgcG9pbnQgdGhyb3VnaAotCSAqIGk5MTVfZ2VtX2Ns
b3NlX29iamVjdCgpLCBvciBlYXJsaWVyIGJ5IGk5MTVfZ2VtX2NvbnRleHRfY2xvc2UoKS4KLQkg
KiBIb3dldmVyLCB0aGUgb2JqZWN0IG1heSBhbHNvIGJlIGJvdW5kIGludG8gdGhlIGdsb2JhbCBH
VFQgKGUuZy4KLQkgKiBvbGRlciBHUFVzIHdpdGhvdXQgcGVyLXByb2Nlc3Mgc3VwcG9ydCwgb3Ig
Zm9yIGRpcmVjdCBhY2Nlc3MgdGhyb3VnaAotCSAqIHRoZSBHVFQgZWl0aGVyIGZvciB0aGUgdXNl
ciBvciBmb3Igc2Nhbm91dCkuIFRob3NlIFZNQSBzdGlsbCBuZWVkIHRvCi0JICogdW5ib3VuZCBu
b3cuCi0JICovCi0KLQlzcGluX2xvY2soJmk5MTUtPm1tLmZyZWVfbG9jayk7Ci0Jd2hpbGUgKChm
cmVlZCA9IGxsaXN0X2RlbF9hbGwoJmk5MTUtPm1tLmZyZWVfbGlzdCkpKSB7Ci0JCXNwaW5fdW5s
b2NrKCZpOTE1LT5tbS5mcmVlX2xvY2spOwotCi0JCV9faTkxNV9nZW1fZnJlZV9vYmplY3RzKGk5
MTUsIGZyZWVkKTsKLQkJaWYgKG5lZWRfcmVzY2hlZCgpKQotCQkJcmV0dXJuOwotCi0JCXNwaW5f
bG9jaygmaTkxNS0+bW0uZnJlZV9sb2NrKTsKLQl9Ci0Jc3Bpbl91bmxvY2soJmk5MTUtPm1tLmZy
ZWVfbG9jayk7Ci19Ci0KLXN0YXRpYyB2b2lkIF9faTkxNV9nZW1fZnJlZV9vYmplY3RfcmN1KHN0
cnVjdCByY3VfaGVhZCAqaGVhZCkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
ID0KLQkJY29udGFpbmVyX29mKGhlYWQsIHR5cGVvZigqb2JqKSwgcmN1KTsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7Ci0KLQkvKgotCSAq
IFdlIHJldXNlIG9iai0+cmN1IGZvciB0aGUgZnJlZWQgbGlzdCwgc28gd2UgaGFkIGJldHRlciBu
b3QgdHJlYXQKLQkgKiBpdCBsaWtlIGEgcmN1X2hlYWQgZnJvbSB0aGlzIHBvaW50IGZvcndhcmRz
LiBBbmQgd2UgZXhwZWN0IGFsbAotCSAqIG9iamVjdHMgdG8gYmUgZnJlZWQgdmlhIHRoaXMgcGF0
aC4KLQkgKi8KLQlkZXN0cm95X3JjdV9oZWFkKCZvYmotPnJjdSk7Ci0KLQkvKgotCSAqIFNpbmNl
IHdlIHJlcXVpcmUgYmxvY2tpbmcgb24gc3RydWN0X211dGV4IHRvIHVuYmluZCB0aGUgZnJlZWQK
LQkgKiBvYmplY3QgZnJvbSB0aGUgR1BVIGJlZm9yZSByZWxlYXNpbmcgcmVzb3VyY2VzIGJhY2sg
dG8gdGhlCi0JICogc3lzdGVtLCB3ZSBjYW4gbm90IGRvIHRoYXQgZGlyZWN0bHkgZnJvbSB0aGUg
UkNVIGNhbGxiYWNrICh3aGljaCBtYXkKLQkgKiBiZSBhIHNvZnRpcnEgY29udGV4dCksIGJ1dCBt
dXN0IGluc3RlYWQgdGhlbiBkZWZlciB0aGF0IHdvcmsgb250byBhCi0JICoga3RocmVhZC4gV2Ug
dXNlIHRoZSBSQ1UgY2FsbGJhY2sgcmF0aGVyIHRoYW4gbW92ZSB0aGUgZnJlZWQgb2JqZWN0Ci0J
ICogZGlyZWN0bHkgb250byB0aGUgd29yayBxdWV1ZSBzbyB0aGF0IHdlIGNhbiBtaXggYmV0d2Vl
biB1c2luZyB0aGUKLQkgKiB3b3JrZXIgYW5kIHBlcmZvcm1pbmcgZnJlZXMgZGlyZWN0bHkgZnJv
bSBzdWJzZXF1ZW50IGFsbG9jYXRpb25zIGZvcgotCSAqIGNydWRlIGJ1dCBlZmZlY3RpdmUgbWVt
b3J5IHRocm90dGxpbmcuCi0JICovCi0JaWYgKGxsaXN0X2FkZCgmb2JqLT5mcmVlZCwgJmk5MTUt
Pm1tLmZyZWVfbGlzdCkpCi0JCXF1ZXVlX3dvcmsoaTkxNS0+d3EsICZpOTE1LT5tbS5mcmVlX3dv
cmspOwotfQotCi12b2lkIGk5MTVfZ2VtX2ZyZWVfb2JqZWN0KHN0cnVjdCBkcm1fZ2VtX29iamVj
dCAqZ2VtX29iaikKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gdG9faW50
ZWxfYm8oZ2VtX29iaik7Ci0KLQlpZiAob2JqLT5tbS5xdWlya2VkKQotCQlfX2k5MTVfZ2VtX29i
amVjdF91bnBpbl9wYWdlcyhvYmopOwotCi0JaWYgKGRpc2NhcmRfYmFja2luZ19zdG9yYWdlKG9i
aikpCi0JCW9iai0+bW0ubWFkdiA9IEk5MTVfTUFEVl9ET05UTkVFRDsKLQotCS8qCi0JICogQmVm
b3JlIHdlIGZyZWUgdGhlIG9iamVjdCwgbWFrZSBzdXJlIGFueSBwdXJlIFJDVS1vbmx5Ci0JICog
cmVhZC1zaWRlIGNyaXRpY2FsIHNlY3Rpb25zIGFyZSBjb21wbGV0ZSwgZS5nLgotCSAqIGk5MTVf
Z2VtX2J1c3lfaW9jdGwoKS4gRm9yIHRoZSBjb3JyZXNwb25kaW5nIHN5bmNocm9uaXplZAotCSAq
IGxvb2t1cCBzZWUgaTkxNV9nZW1fb2JqZWN0X2xvb2t1cF9yY3UoKS4KLQkgKi8KLQlhdG9taWNf
aW5jKCZ0b19pOTE1KG9iai0+YmFzZS5kZXYpLT5tbS5mcmVlX2NvdW50KTsKLQljYWxsX3JjdSgm
b2JqLT5yY3UsIF9faTkxNV9nZW1fZnJlZV9vYmplY3RfcmN1KTsKLX0KLQotdm9pZCBfX2k5MTVf
Z2VtX29iamVjdF9yZWxlYXNlX3VubGVzc19hY3RpdmUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iaikKLXsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZvYmotPmJhc2UuZGV2LT5zdHJ1Y3Rf
bXV0ZXgpOwotCi0JaWYgKCFpOTE1X2dlbV9vYmplY3RfaGFzX2FjdGl2ZV9yZWZlcmVuY2Uob2Jq
KSAmJgotCSAgICBpOTE1X2dlbV9vYmplY3RfaXNfYWN0aXZlKG9iaikpCi0JCWk5MTVfZ2VtX29i
amVjdF9zZXRfYWN0aXZlX3JlZmVyZW5jZShvYmopOwotCWVsc2UKLQkJaTkxNV9nZW1fb2JqZWN0
X3B1dChvYmopOwotfQotCiB2b2lkIGk5MTVfZ2VtX3Nhbml0aXplKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQogewogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwpAQCAtNDcyNSw3ICsz
OTYwLDcgQEAgc3RhdGljIHZvaWQgaTkxNV9nZW1faW5pdF9fbW0oc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCiAJSU5JVF9MSVNUX0hFQUQoJmk5MTUtPm1tLmZlbmNlX2xpc3QpOwogCUlO
SVRfTElTVF9IRUFEKCZpOTE1LT5tbS51c2VyZmF1bHRfbGlzdCk7CiAKLQlJTklUX1dPUksoJmk5
MTUtPm1tLmZyZWVfd29yaywgX19pOTE1X2dlbV9mcmVlX3dvcmspOworCWk5MTVfZ2VtX2luaXRf
X29iamVjdHMoaTkxNSk7CiB9CiAKIGludCBpOTE1X2dlbV9pbml0X2Vhcmx5KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKQEAgLTQ4OTEsNTcgKzQxMjYsNiBAQCB2b2lkIGk5MTVf
Z2VtX3RyYWNrX2ZiKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvbGQsCiAJfQogfQogCi0v
KiBBbGxvY2F0ZSBhIG5ldyBHRU0gb2JqZWN0IGFuZCBmaWxsIGl0IHdpdGggdGhlIHN1cHBsaWVk
IGRhdGEgKi8KLXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICoKLWk5MTVfZ2VtX29iamVjdF9j
cmVhdGVfZnJvbV9kYXRhKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCSAg
ICAgICAgIGNvbnN0IHZvaWQgKmRhdGEsIHNpemVfdCBzaXplKQotewotCXN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmo7Ci0Jc3RydWN0IGZpbGUgKmZpbGU7Ci0Jc2l6ZV90IG9mZnNldDsK
LQlpbnQgZXJyOwotCi0Jb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZShkZXZfcHJpdiwgcm91
bmRfdXAoc2l6ZSwgUEFHRV9TSVpFKSk7Ci0JaWYgKElTX0VSUihvYmopKQotCQlyZXR1cm4gb2Jq
OwotCi0JR0VNX0JVR19PTihvYmotPndyaXRlX2RvbWFpbiAhPSBJOTE1X0dFTV9ET01BSU5fQ1BV
KTsKLQotCWZpbGUgPSBvYmotPmJhc2UuZmlscDsKLQlvZmZzZXQgPSAwOwotCWRvIHsKLQkJdW5z
aWduZWQgaW50IGxlbiA9IG1pbl90KHR5cGVvZihzaXplKSwgc2l6ZSwgUEFHRV9TSVpFKTsKLQkJ
c3RydWN0IHBhZ2UgKnBhZ2U7Ci0JCXZvaWQgKnBnZGF0YSwgKnZhZGRyOwotCi0JCWVyciA9IHBh
Z2VjYWNoZV93cml0ZV9iZWdpbihmaWxlLCBmaWxlLT5mX21hcHBpbmcsCi0JCQkJCSAgICBvZmZz
ZXQsIGxlbiwgMCwKLQkJCQkJICAgICZwYWdlLCAmcGdkYXRhKTsKLQkJaWYgKGVyciA8IDApCi0J
CQlnb3RvIGZhaWw7Ci0KLQkJdmFkZHIgPSBrbWFwKHBhZ2UpOwotCQltZW1jcHkodmFkZHIsIGRh
dGEsIGxlbik7Ci0JCWt1bm1hcChwYWdlKTsKLQotCQllcnIgPSBwYWdlY2FjaGVfd3JpdGVfZW5k
KGZpbGUsIGZpbGUtPmZfbWFwcGluZywKLQkJCQkJICBvZmZzZXQsIGxlbiwgbGVuLAotCQkJCQkg
IHBhZ2UsIHBnZGF0YSk7Ci0JCWlmIChlcnIgPCAwKQotCQkJZ290byBmYWlsOwotCi0JCXNpemUg
LT0gbGVuOwotCQlkYXRhICs9IGxlbjsKLQkJb2Zmc2V0ICs9IGxlbjsKLQl9IHdoaWxlIChzaXpl
KTsKLQotCXJldHVybiBvYmo7Ci0KLWZhaWw6Ci0JaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwot
CXJldHVybiBFUlJfUFRSKGVycik7Ci19Ci0KIHN0cnVjdCBzY2F0dGVybGlzdCAqCiBpOTE1X2dl
bV9vYmplY3RfZ2V0X3NnKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCSAgICAg
ICB1bnNpZ25lZCBpbnQgbiwKQEAgLTUxMDMsNyArNDI4Nyw3IEBAIGludCBpOTE1X2dlbV9vYmpl
Y3RfYXR0YWNoX3BoeXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgaW50IGFsaWdu
KQogCWlmIChvYmotPm9wcyA9PSAmaTkxNV9nZW1fcGh5c19vcHMpCiAJCXJldHVybiAwOwogCi0J
aWYgKG9iai0+b3BzICE9ICZpOTE1X2dlbV9vYmplY3Rfb3BzKQorCWlmIChvYmotPm9wcyAhPSAm
aTkxNV9nZW1fc2htZW1fb3BzKQogCQlyZXR1cm4gLUVJTlZBTDsKIAogCWVyciA9IGk5MTVfZ2Vt
X29iamVjdF91bmJpbmQob2JqKTsKQEAgLTUxMzksMTIgKzQzMjMsMTIgQEAgaW50IGk5MTVfZ2Vt
X29iamVjdF9hdHRhY2hfcGh5cyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCBpbnQg
YWxpZ24pCiAJX19pOTE1X2dlbV9vYmplY3RfcGluX3BhZ2VzKG9iaik7CiAKIAlpZiAoIUlTX0VS
Ul9PUl9OVUxMKHBhZ2VzKSkKLQkJaTkxNV9nZW1fb2JqZWN0X29wcy5wdXRfcGFnZXMob2JqLCBw
YWdlcyk7CisJCWk5MTVfZ2VtX3NobWVtX29wcy5wdXRfcGFnZXMob2JqLCBwYWdlcyk7CiAJbXV0
ZXhfdW5sb2NrKCZvYmotPm1tLmxvY2spOwogCXJldHVybiAwOwogCiBlcnJfeGZlcjoKLQlvYmot
Pm9wcyA9ICZpOTE1X2dlbV9vYmplY3Rfb3BzOworCW9iai0+b3BzID0gJmk5MTVfZ2VtX3NobWVt
X29wczsKIAlpZiAoIUlTX0VSUl9PUl9OVUxMKHBhZ2VzKSkgewogCQl1bnNpZ25lZCBpbnQgc2df
cGFnZV9zaXplcyA9IGk5MTVfc2dfcGFnZV9zaXplcyhwYWdlcy0+c2dsKTsKIApkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3BlcmYuYwppbmRleCBjNDk5NWQ1YTE2ZDIuLjM3OWZkODlhMTgwZiAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9wZXJmLmMKQEAgLTE1MTAsNyArMTUxMCw3IEBAIHN0YXRpYyBpbnQgYWxsb2Nf
b2FfYnVmZmVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlCVUlMRF9CVUdf
T05fTk9UX1BPV0VSX09GXzIoT0FfQlVGRkVSX1NJWkUpOwogCUJVSUxEX0JVR19PTihPQV9CVUZG
RVJfU0laRSA8IFNaXzEyOEsgfHwgT0FfQlVGRkVSX1NJWkUgPiBTWl8xNk0pOwogCi0JYm8gPSBp
OTE1X2dlbV9vYmplY3RfY3JlYXRlKGRldl9wcml2LCBPQV9CVUZGRVJfU0laRSk7CisJYm8gPSBp
OTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtKGRldl9wcml2LCBPQV9CVUZGRVJfU0laRSk7CiAJ
aWYgKElTX0VSUihibykpIHsKIAkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gYWxsb2NhdGUgT0EgYnVm
ZmVyXG4iKTsKIAkJcmV0ID0gUFRSX0VSUihibyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9mYmRldi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZmJkZXYu
YwppbmRleCA4OWRiNzE5OTYxNDguLjBkM2E2ZmE2NzRlNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaW50ZWxfZmJkZXYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF9mYmRldi5jCkBAIC0xNDQsNyArMTQ0LDcgQEAgc3RhdGljIGludCBpbnRlbGZiX2FsbG9jKHN0
cnVjdCBkcm1fZmJfaGVscGVyICpoZWxwZXIsCiAJaWYgKHNpemUgKiAyIDwgZGV2X3ByaXYtPnN0
b2xlbl91c2FibGVfc2l6ZSkKIAkJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zdG9sZW4o
ZGV2X3ByaXYsIHNpemUpOwogCWlmIChvYmogPT0gTlVMTCkKLQkJb2JqID0gaTkxNV9nZW1fb2Jq
ZWN0X2NyZWF0ZShkZXZfcHJpdiwgc2l6ZSk7CisJCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVh
dGVfc2htZW0oZGV2X3ByaXYsIHNpemUpOwogCWlmIChJU19FUlIob2JqKSkgewogCQlEUk1fRVJS
T1IoImZhaWxlZCB0byBhbGxvY2F0ZSBmcmFtZWJ1ZmZlclxuIik7CiAJCXJldCA9IFBUUl9FUlIo
b2JqKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjLmMKaW5kZXggYzRhYzI5MzA5ZmNjLi45OGU0NWE1
MDBhMTUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5jCkBAIC02OTAsNyArNjkwLDcgQEAgc3Ry
dWN0IGk5MTVfdm1hICppbnRlbF9ndWNfYWxsb2NhdGVfdm1hKHN0cnVjdCBpbnRlbF9ndWMgKmd1
YywgdTMyIHNpemUpCiAJdTY0IGZsYWdzOwogCWludCByZXQ7CiAKLQlvYmogPSBpOTE1X2dlbV9v
YmplY3RfY3JlYXRlKGRldl9wcml2LCBzaXplKTsKKwlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3Jl
YXRlX3NobWVtKGRldl9wcml2LCBzaXplKTsKIAlpZiAoSVNfRVJSKG9iaikpCiAJCXJldHVybiBF
UlJfQ0FTVChvYmopOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF91
Y19mdy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdWNfZncuYwppbmRleCBiOWNiNmZl
YTkzMzIuLjMyNTdhMDU0Y2IwYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfdWNfZncuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF91Y19mdy5jCkBAIC0x
NTksNyArMTU5LDggQEAgdm9pZCBpbnRlbF91Y19md19mZXRjaChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCiAJCWdvdG8gZmFpbDsKIAl9CiAKLQlvYmogPSBpOTE1X2dlbV9vYmpl
Y3RfY3JlYXRlX2Zyb21fZGF0YShkZXZfcHJpdiwgZnctPmRhdGEsIGZ3LT5zaXplKTsKKwlvYmog
PSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtX2Zyb21fZGF0YShkZXZfcHJpdiwKKwkJCQkJ
CSAgICAgZnctPmRhdGEsIGZ3LT5zaXplKTsKIAlpZiAoSVNfRVJSKG9iaikpIHsKIAkJZXJyID0g
UFRSX0VSUihvYmopOwogCQlEUk1fREVCVUdfRFJJVkVSKCIlcyBmdyBvYmplY3RfY3JlYXRlIGVy
cj0lZFxuIiwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9odWdl
X3BhZ2VzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jCmlu
ZGV4IDFlMWY4MzMyNmE5Ni4uY2U0ZWM4NzY5OGY2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMKQEAgLTEzOTAsNyArMTM5MCw3IEBAIHN0YXRpYyBpbnQg
aWd0X3BwZ3R0X2dlbWZzX2h1Z2Uodm9pZCAqYXJnKQogCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9T
SVpFKHNpemVzKTsgKytpKSB7CiAJCXVuc2lnbmVkIGludCBzaXplID0gc2l6ZXNbaV07CiAKLQkJ
b2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZShpOTE1LCBzaXplKTsKKwkJb2JqID0gaTkxNV9n
ZW1fb2JqZWN0X2NyZWF0ZV9zaG1lbShpOTE1LCBzaXplKTsKIAkJaWYgKElTX0VSUihvYmopKQog
CQkJcmV0dXJuIFBUUl9FUlIob2JqKTsKIApAQCAtMTU2OCw3ICsxNTY4LDcgQEAgc3RhdGljIGlu
dCBpZ3RfdG1wZnNfZmFsbGJhY2sodm9pZCAqYXJnKQogCiAJaTkxNS0+bW0uZ2VtZnMgPSBOVUxM
OwogCi0Jb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZShpOTE1LCBQQUdFX1NJWkUpOworCW9i
aiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc2htZW0oaTkxNSwgUEFHRV9TSVpFKTsKIAlpZiAo
SVNfRVJSKG9iaikpIHsKIAkJZXJyID0gUFRSX0VSUihvYmopOwogCQlnb3RvIG91dF9yZXN0b3Jl
OwpAQCAtMTYyOCw3ICsxNjI4LDcgQEAgc3RhdGljIGludCBpZ3Rfc2hyaW5rX3RocCh2b2lkICph
cmcpCiAJCXJldHVybiAwOwogCX0KIAotCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGUoaTkx
NSwgU1pfMk0pOworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc2htZW0oaTkxNSwgU1pf
Mk0pOwogCWlmIChJU19FUlIob2JqKSkKIAkJcmV0dXJuIFBUUl9FUlIob2JqKTsKIApkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2RtYWJ1Zi5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2RtYWJ1Zi5jCmluZGV4IDJi
OTQzZWUyNDZjOS4uY2M2NWE1MDNlMmYwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvaTkxNV9nZW1fZG1hYnVmLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2k5MTVfZ2VtX2RtYWJ1Zi5jCkBAIC0zMyw3ICszMyw3IEBAIHN0YXRpYyBpbnQg
aWd0X2RtYWJ1Zl9leHBvcnQodm9pZCAqYXJnKQogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmo7CiAJc3RydWN0IGRtYV9idWYgKmRtYWJ1ZjsKIAotCW9iaiA9IGk5MTVfZ2VtX29iamVj
dF9jcmVhdGUoaTkxNSwgUEFHRV9TSVpFKTsKKwlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRl
X3NobWVtKGk5MTUsIFBBR0VfU0laRSk7CiAJaWYgKElTX0VSUihvYmopKQogCQlyZXR1cm4gUFRS
X0VSUihvYmopOwogCkBAIC01Nyw3ICs1Nyw3IEBAIHN0YXRpYyBpbnQgaWd0X2RtYWJ1Zl9pbXBv
cnRfc2VsZih2b2lkICphcmcpCiAJc3RydWN0IGRtYV9idWYgKmRtYWJ1ZjsKIAlpbnQgZXJyOwog
Ci0Jb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZShpOTE1LCBQQUdFX1NJWkUpOworCW9iaiA9
IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc2htZW0oaTkxNSwgUEFHRV9TSVpFKTsKIAlpZiAoSVNf
RVJSKG9iaikpCiAJCXJldHVybiBQVFJfRVJSKG9iaik7CiAKQEAgLTIzMiw3ICsyMzIsNyBAQCBz
dGF0aWMgaW50IGlndF9kbWFidWZfZXhwb3J0X3ZtYXAodm9pZCAqYXJnKQogCXZvaWQgKnB0cjsK
IAlpbnQgZXJyOwogCi0Jb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZShpOTE1LCBQQUdFX1NJ
WkUpOworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc2htZW0oaTkxNSwgUEFHRV9TSVpF
KTsKIAlpZiAoSVNfRVJSKG9iaikpCiAJCXJldHVybiBQVFJfRVJSKG9iaik7CiAKQEAgLTI3OSw3
ICsyNzksNyBAQCBzdGF0aWMgaW50IGlndF9kbWFidWZfZXhwb3J0X2ttYXAodm9pZCAqYXJnKQog
CXZvaWQgKnB0cjsKIAlpbnQgZXJyOwogCi0Jb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZShp
OTE1LCAyKlBBR0VfU0laRSk7CisJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zaG1lbShp
OTE1LCAyICogUEFHRV9TSVpFKTsKIAlpZiAoSVNfRVJSKG9iaikpCiAJCXJldHVybiBQVFJfRVJS
KG9iaik7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1
X2dlbV9vYmplY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9v
YmplY3QuYwppbmRleCBiOTI2ZDFjZDE2NWQuLmEwZjU5ZmIwZDcwMSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVjdC5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmplY3QuYwpAQCAtMzYsNyArMzYs
NyBAQCBzdGF0aWMgaW50IGlndF9nZW1fb2JqZWN0KHZvaWQgKmFyZykKIAogCS8qIEJhc2ljIHRl
c3QgdG8gZW5zdXJlIHdlIGNhbiBjcmVhdGUgYW4gb2JqZWN0ICovCiAKLQlvYmogPSBpOTE1X2dl
bV9vYmplY3RfY3JlYXRlKGk5MTUsIFBBR0VfU0laRSk7CisJb2JqID0gaTkxNV9nZW1fb2JqZWN0
X2NyZWF0ZV9zaG1lbShpOTE1LCBQQUdFX1NJWkUpOwogCWlmIChJU19FUlIob2JqKSkgewogCQll
cnIgPSBQVFJfRVJSKG9iaik7CiAJCXByX2VycigiaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZSBmYWls
ZWQsIGVycj0lZFxuIiwgZXJyKTsKQEAgLTU5LDcgKzU5LDcgQEAgc3RhdGljIGludCBpZ3RfcGh5
c19vYmplY3Qodm9pZCAqYXJnKQogCSAqIGkuZS4gZXhlcmNpc2UgdGhlIGk5MTVfZ2VtX29iamVj
dF9waHlzIEFQSS4KIAkgKi8KIAotCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGUoaTkxNSwg
UEFHRV9TSVpFKTsKKwlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtKGk5MTUsIFBB
R0VfU0laRSk7CiAJaWYgKElTX0VSUihvYmopKSB7CiAJCWVyciA9IFBUUl9FUlIob2JqKTsKIAkJ
cHJfZXJyKCJpOTE1X2dlbV9vYmplY3RfY3JlYXRlIGZhaWxlZCwgZXJyPSVkXG4iLCBlcnIpOwot
LSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
XwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcK
aHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

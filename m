Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7A76AF1B86
	for <lists+intel-gfx@lfdr.de>; Wed,  6 Nov 2019 17:45:42 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5FA946E27C;
	Wed,  6 Nov 2019 16:45:40 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga17.intel.com (mga17.intel.com [192.55.52.151])
 by gabe.freedesktop.org (Postfix) with ESMTPS id F123F6E27C
 for <intel-gfx@lists.freedesktop.org>; Wed,  6 Nov 2019 16:45:38 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by fmsmga107.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 06 Nov 2019 08:45:38 -0800
X-IronPort-AV: E=Sophos;i="5.68,275,1569308400"; d="scan'208";a="196260789"
Received: from jnikula-mobl3.fi.intel.com (HELO localhost) ([10.237.66.161])
 by orsmga008-auth.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 06 Nov 2019 08:45:35 -0800
From: Jani Nikula <jani.nikula@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  6 Nov 2019 18:45:31 +0200
Message-Id: <20191106164531.7079-1-jani.nikula@intel.com>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Organization: Intel Finland Oy - BIC 0357606-4 - Westendinkatu 7, 02160 Espoo
Subject: [Intel-gfx] [PATCH] drm/i915/bios: store child devices in a list
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VXNpbmcgdGhlIGFycmF5IGlzIGdldHRpbmcgY2x1bXN5LiBNYWtlIHRoaW5ncyBhIGJpdCBtb3Jl
IGR5bmFtaWMuCgpJbiBjb2RlLCBzdGFydCBtaWdyYXRpbmcgdG93YXJkcyBjYWxsaW5nIHRoZSBu
ZXcgc3RydWN0IGNoaWxkX2RldmljZQoiY2hpbGQiIGFuZCB0aGUgVkJULW9yaWdpbmF0aW5nIHN0
cnVjdCBjaGlsZF9kZXZpY2VfY29uZmlnICJjb25maWciLgoKUmVtb3ZlIGVhcmx5IHJldHVybnMg
b24gbm90IGhhdmluZyBjaGlsZCBkZXZpY2VzIHdoZW4gdGhlIGVuZCByZXN1bHQKYWZ0ZXIgIml0
ZXJhdGluZyIgdGhlIGVtcHR5IGxpc3Qgd291bGQgYmUgdGhlIHNhbWUuCgpDYzogVmlsbGUgU3ly
amFsYSA8dmlsbGUuc3lyamFsYUBsaW51eC5pbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6IEphbmkg
TmlrdWxhIDxqYW5pLm5pa3VsYUBpbnRlbC5jb20+CgotLS0KClRoZSBlbmQgZ29hbDogYWxsb3cg
bW9yZSBtZXRhIGluZm9ybWF0aW9uIHRvIGJlIGFkZGVkIHRvIHRoZSBuZXcKY2hpbGRfZGV2aWNl
IHN0cnVjdCwgaW5kZXBlbmRlbnQgb2YgRERJIHBvcnQgaW5mbyBiZWluZyB1c2VkIG9yIG5vdCBv
bgp0aGUgcGxhdGZvcm0sIGFuZCBldmVudHVhbGx5IG1pZ3JhdGUgZGRpX3BvcnRfaW5mbyB0byBp
dCBhcyB3ZWxsLAp1bmlmeWluZyB0aGUgc3R1ZmYgYWNyb3NzIHBsYXRmb3Jtcy4KCkN1cnJlbnRs
eSBpdCdzIG5vdCBlYXNpbHkgcG9zc2libGUgdG8gYXNzb2NpYXRlIGZvciBleGFtcGxlIHRoZSBE
U0MKY29tcHJlc3Npb24gZGF0YSB0byB0aGUgY2hpbGQgZGV2aWNlIGZvciBub24tRERJIHBsYXRm
b3JtcyBvciBmb3IgRFNJCm91dHB1dHMuIFRoaXMgbGV0cyB1cyBhZGQgdGhlIGNvbXByZXNzaW9u
IGRhdGEgKHBvaW50ZXIpIHRvIHN0cnVjdApjaGlsZF9kZXZpY2UuCi0tLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9iaW9zLmMgfCAyMDMgKysrKysrKysrKy0tLS0tLS0tLS0t
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAgICAgICAgICAgfCAgIDMgKy0KIDIg
ZmlsZXMgY2hhbmdlZCwgOTcgaW5zZXJ0aW9ucygrKSwgMTA5IGRlbGV0aW9ucygtKQoKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYmlvcy5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9iaW9zLmMKaW5kZXggYTAzZjU2YjdiNGVmLi4w
MjUwNzQ4NjJhYjAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfYmlvcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYmlvcy5j
CkBAIC01OCw2ICs1OCwxMiBAQAogICogdGhhdC4KICAqLwogCisvKiBXcmFwcGVyIGZvciBWQlQg
Y2hpbGQgZGV2aWNlIGNvbmZpZyAqLworc3RydWN0IGNoaWxkX2RldmljZSB7CisJc3RydWN0IGNo
aWxkX2RldmljZV9jb25maWcgY29uZmlnOworCXN0cnVjdCBsaXN0X2hlYWQgbm9kZTsKK307CisK
ICNkZWZpbmUJU0xBVkVfQUREUjEJMHg3MAogI2RlZmluZQlTTEFWRV9BRERSMgkweDcyCiAKQEAg
LTQ0OSw4ICs0NTUsOSBAQCBzdGF0aWMgdm9pZAogcGFyc2Vfc2R2b19kZXZpY2VfbWFwcGluZyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHU4IGJkYl92ZXJzaW9uKQogewogCXN0
cnVjdCBzZHZvX2RldmljZV9tYXBwaW5nICptYXBwaW5nOwotCWNvbnN0IHN0cnVjdCBjaGlsZF9k
ZXZpY2VfY29uZmlnICpjaGlsZDsKLQlpbnQgaSwgY291bnQgPSAwOworCWNvbnN0IHN0cnVjdCBj
aGlsZF9kZXZpY2VfY29uZmlnICpjb25maWc7CisJY29uc3Qgc3RydWN0IGNoaWxkX2RldmljZSAq
Y2hpbGQ7CisJaW50IGNvdW50ID0gMDsKIAogCS8qCiAJICogT25seSBwYXJzZSBTRFZPIG1hcHBp
bmdzIG9uIGdlbnMgdGhhdCBjb3VsZCBoYXZlIFNEVk8uIFRoaXMgaXNuJ3QKQEAgLTQ2MSwzNSAr
NDY4LDM1IEBAIHBhcnNlX3Nkdm9fZGV2aWNlX21hcHBpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LCB1OCBiZGJfdmVyc2lvbikKIAkJcmV0dXJuOwogCX0KIAotCWZvciAoaSA9
IDAsIGNvdW50ID0gMDsgaSA8IGRldl9wcml2LT52YnQuY2hpbGRfZGV2X251bTsgaSsrKSB7Ci0J
CWNoaWxkID0gZGV2X3ByaXYtPnZidC5jaGlsZF9kZXYgKyBpOworCWxpc3RfZm9yX2VhY2hfZW50
cnkoY2hpbGQsICZkZXZfcHJpdi0+dmJ0LmNoaWxkX2RldmljZXMsIG5vZGUpIHsKKwkJY29uZmln
ID0gJmNoaWxkLT5jb25maWc7CiAKLQkJaWYgKGNoaWxkLT5zbGF2ZV9hZGRyICE9IFNMQVZFX0FE
RFIxICYmCi0JCSAgICBjaGlsZC0+c2xhdmVfYWRkciAhPSBTTEFWRV9BRERSMikgeworCQlpZiAo
Y29uZmlnLT5zbGF2ZV9hZGRyICE9IFNMQVZFX0FERFIxICYmCisJCSAgICBjb25maWctPnNsYXZl
X2FkZHIgIT0gU0xBVkVfQUREUjIpIHsKIAkJCS8qCiAJCQkgKiBJZiB0aGUgc2xhdmUgYWRkcmVz
cyBpcyBuZWl0aGVyIDB4NzAgbm9yIDB4NzIsCiAJCQkgKiBpdCBpcyBub3QgYSBTRFZPIGRldmlj
ZS4gU2tpcCBpdC4KIAkJCSAqLwogCQkJY29udGludWU7CiAJCX0KLQkJaWYgKGNoaWxkLT5kdm9f
cG9ydCAhPSBERVZJQ0VfUE9SVF9EVk9CICYmCi0JCSAgICBjaGlsZC0+ZHZvX3BvcnQgIT0gREVW
SUNFX1BPUlRfRFZPQykgeworCQlpZiAoY29uZmlnLT5kdm9fcG9ydCAhPSBERVZJQ0VfUE9SVF9E
Vk9CICYmCisJCSAgICBjb25maWctPmR2b19wb3J0ICE9IERFVklDRV9QT1JUX0RWT0MpIHsKIAkJ
CS8qIHNraXAgdGhlIGluY29ycmVjdCBTRFZPIHBvcnQgKi8KIAkJCURSTV9ERUJVR19LTVMoIklu
Y29ycmVjdCBTRFZPIHBvcnQuIFNraXAgaXRcbiIpOwogCQkJY29udGludWU7CiAJCX0KIAkJRFJN
X0RFQlVHX0tNUygidGhlIFNEVk8gZGV2aWNlIHdpdGggc2xhdmUgYWRkciAlMnggaXMgZm91bmQg
b24iCiAJCQkgICAgICAiICVzIHBvcnRcbiIsCi0JCQkgICAgICBjaGlsZC0+c2xhdmVfYWRkciwK
LQkJCSAgICAgIChjaGlsZC0+ZHZvX3BvcnQgPT0gREVWSUNFX1BPUlRfRFZPQikgPworCQkJICAg
ICAgY29uZmlnLT5zbGF2ZV9hZGRyLAorCQkJICAgICAgKGNvbmZpZy0+ZHZvX3BvcnQgPT0gREVW
SUNFX1BPUlRfRFZPQikgPwogCQkJICAgICAgIlNEVk9CIiA6ICJTRFZPQyIpOwotCQltYXBwaW5n
ID0gJmRldl9wcml2LT52YnQuc2R2b19tYXBwaW5nc1tjaGlsZC0+ZHZvX3BvcnQgLSAxXTsKKwkJ
bWFwcGluZyA9ICZkZXZfcHJpdi0+dmJ0LnNkdm9fbWFwcGluZ3NbY29uZmlnLT5kdm9fcG9ydCAt
IDFdOwogCQlpZiAoIW1hcHBpbmctPmluaXRpYWxpemVkKSB7Ci0JCQltYXBwaW5nLT5kdm9fcG9y
dCA9IGNoaWxkLT5kdm9fcG9ydDsKLQkJCW1hcHBpbmctPnNsYXZlX2FkZHIgPSBjaGlsZC0+c2xh
dmVfYWRkcjsKLQkJCW1hcHBpbmctPmR2b193aXJpbmcgPSBjaGlsZC0+ZHZvX3dpcmluZzsKLQkJ
CW1hcHBpbmctPmRkY19waW4gPSBjaGlsZC0+ZGRjX3BpbjsKLQkJCW1hcHBpbmctPmkyY19waW4g
PSBjaGlsZC0+aTJjX3BpbjsKKwkJCW1hcHBpbmctPmR2b19wb3J0ID0gY29uZmlnLT5kdm9fcG9y
dDsKKwkJCW1hcHBpbmctPnNsYXZlX2FkZHIgPSBjb25maWctPnNsYXZlX2FkZHI7CisJCQltYXBw
aW5nLT5kdm9fd2lyaW5nID0gY29uZmlnLT5kdm9fd2lyaW5nOworCQkJbWFwcGluZy0+ZGRjX3Bp
biA9IGNvbmZpZy0+ZGRjX3BpbjsKKwkJCW1hcHBpbmctPmkyY19waW4gPSBjb25maWctPmkyY19w
aW47CiAJCQltYXBwaW5nLT5pbml0aWFsaXplZCA9IDE7CiAJCQlEUk1fREVCVUdfS01TKCJTRFZP
IGRldmljZTogZHZvPSV4LCBhZGRyPSV4LCB3aXJpbmc9JWQsIGRkY19waW49JWQsIGkyY19waW49
JWRcbiIsCiAJCQkJICAgICAgbWFwcGluZy0+ZHZvX3BvcnQsCkBAIC01MDEsNyArNTA4LDcgQEAg
cGFyc2Vfc2R2b19kZXZpY2VfbWFwcGluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsIHU4IGJkYl92ZXJzaW9uKQogCQkJRFJNX0RFQlVHX0tNUygiTWF5YmUgb25lIFNEVk8gcG9y
dCBpcyBzaGFyZWQgYnkgIgogCQkJCQkgInR3byBTRFZPIGRldmljZS5cbiIpOwogCQl9Ci0JCWlm
IChjaGlsZC0+c2xhdmUyX2FkZHIpIHsKKwkJaWYgKGNvbmZpZy0+c2xhdmUyX2FkZHIpIHsKIAkJ
CS8qIE1heWJlIHRoaXMgaXMgYSBTRFZPIGRldmljZSB3aXRoIG11bHRpcGxlIGlucHV0cyAqLwog
CQkJLyogQW5kIHRoZSBtYXBwaW5nIGluZm8gaXMgbm90IGFkZGVkICovCiAJCQlEUk1fREVCVUdf
S01TKCJ0aGVyZSBleGlzdHMgdGhlIHNsYXZlMl9hZGRyLiBNYXliZSB0aGlzIgpAQCAtMTU3MSw4
ICsxNTc4LDcgQEAgc3RhdGljIHZvaWQgcGFyc2VfZGRpX3BvcnQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAogCiBzdGF0aWMgdm9pZCBwYXJzZV9kZGlfcG9ydHMoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1OCBiZGJfdmVyc2lvbikKIHsKLQljb25zdCBzdHJ1
Y3QgY2hpbGRfZGV2aWNlX2NvbmZpZyAqY2hpbGQ7Ci0JaW50IGk7CisJY29uc3Qgc3RydWN0IGNo
aWxkX2RldmljZSAqY2hpbGQ7CiAKIAlpZiAoIUhBU19EREkoZGV2X3ByaXYpICYmICFJU19DSEVS
UllWSUVXKGRldl9wcml2KSkKIAkJcmV0dXJuOwpAQCAtMTU4MCwxMSArMTU4Niw4IEBAIHN0YXRp
YyB2b2lkIHBhcnNlX2RkaV9wb3J0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
IHU4IGJkYl92ZXJzaW9uKQogCWlmIChiZGJfdmVyc2lvbiA8IDE1NSkKIAkJcmV0dXJuOwogCi0J
Zm9yIChpID0gMDsgaSA8IGRldl9wcml2LT52YnQuY2hpbGRfZGV2X251bTsgaSsrKSB7Ci0JCWNo
aWxkID0gZGV2X3ByaXYtPnZidC5jaGlsZF9kZXYgKyBpOwotCi0JCXBhcnNlX2RkaV9wb3J0KGRl
dl9wcml2LCBjaGlsZCwgYmRiX3ZlcnNpb24pOwotCX0KKwlsaXN0X2Zvcl9lYWNoX2VudHJ5KGNo
aWxkLCAmZGV2X3ByaXYtPnZidC5jaGlsZF9kZXZpY2VzLCBub2RlKQorCQlwYXJzZV9kZGlfcG9y
dChkZXZfcHJpdiwgJmNoaWxkLT5jb25maWcsIGJkYl92ZXJzaW9uKTsKIH0KIAogc3RhdGljIHZv
aWQKQEAgLTE1OTIsOCArMTU5NSw5IEBAIHBhcnNlX2dlbmVyYWxfZGVmaW5pdGlvbnMoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkJICBjb25zdCBzdHJ1Y3QgYmRiX2hlYWRl
ciAqYmRiKQogewogCWNvbnN0IHN0cnVjdCBiZGJfZ2VuZXJhbF9kZWZpbml0aW9ucyAqZGVmczsK
LQljb25zdCBzdHJ1Y3QgY2hpbGRfZGV2aWNlX2NvbmZpZyAqY2hpbGQ7Ci0JaW50IGksIGNoaWxk
X2RldmljZV9udW0sIGNvdW50OworCWNvbnN0IHN0cnVjdCBjaGlsZF9kZXZpY2VfY29uZmlnICpj
b25maWc7CisJc3RydWN0IGNoaWxkX2RldmljZSAqY2hpbGQ7CisJaW50IGksIGNoaWxkX2Rldmlj
ZV9udW07CiAJdTggZXhwZWN0ZWRfc2l6ZTsKIAl1MTYgYmxvY2tfc2l6ZTsKIAlpbnQgYnVzX3Bp
bjsKQEAgLTE2MjksOCArMTYzMyw4IEBAIHBhcnNlX2dlbmVyYWxfZGVmaW5pdGlvbnMoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCX0gZWxzZSBpZiAoYmRiLT52ZXJzaW9uIDw9
IDIyOSkgewogCQlleHBlY3RlZF9zaXplID0gMzk7CiAJfSBlbHNlIHsKLQkJZXhwZWN0ZWRfc2l6
ZSA9IHNpemVvZigqY2hpbGQpOwotCQlCVUlMRF9CVUdfT04oc2l6ZW9mKCpjaGlsZCkgPCAzOSk7
CisJCWV4cGVjdGVkX3NpemUgPSBzaXplb2YoKmNvbmZpZyk7CisJCUJVSUxEX0JVR19PTihzaXpl
b2YoKmNvbmZpZykgPCAzOSk7CiAJCURSTV9ERUJVR19EUklWRVIoIkV4cGVjdGVkIGNoaWxkIGRl
dmljZSBjb25maWcgc2l6ZSBmb3IgVkJUIHZlcnNpb24gJXUgbm90IGtub3duOyBhc3N1bWluZyAl
dVxuIiwKIAkJCQkgYmRiLT52ZXJzaW9uLCBleHBlY3RlZF9zaXplKTsKIAl9CkBAIC0xNjQ5LDQz
ICsxNjUzLDMwIEBAIHBhcnNlX2dlbmVyYWxfZGVmaW5pdGlvbnMoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAogCiAJLyogZ2V0IHRoZSBudW1iZXIgb2YgY2hpbGQgZGV2aWNlICov
CiAJY2hpbGRfZGV2aWNlX251bSA9IChibG9ja19zaXplIC0gc2l6ZW9mKCpkZWZzKSkgLyBkZWZz
LT5jaGlsZF9kZXZfc2l6ZTsKLQljb3VudCA9IDA7Ci0JLyogZ2V0IHRoZSBudW1iZXIgb2YgY2hp
bGQgZGV2aWNlIHRoYXQgaXMgcHJlc2VudCAqLwotCWZvciAoaSA9IDA7IGkgPCBjaGlsZF9kZXZp
Y2VfbnVtOyBpKyspIHsKLQkJY2hpbGQgPSBjaGlsZF9kZXZpY2VfcHRyKGRlZnMsIGkpOwotCQlp
ZiAoIWNoaWxkLT5kZXZpY2VfdHlwZSkKLQkJCWNvbnRpbnVlOwotCQljb3VudCsrOwotCX0KLQlp
ZiAoIWNvdW50KSB7Ci0JCURSTV9ERUJVR19LTVMoIm5vIGNoaWxkIGRldiBpcyBwYXJzZWQgZnJv
bSBWQlRcbiIpOwotCQlyZXR1cm47Ci0JfQotCWRldl9wcml2LT52YnQuY2hpbGRfZGV2ID0ga2Nh
bGxvYyhjb3VudCwgc2l6ZW9mKCpjaGlsZCksIEdGUF9LRVJORUwpOwotCWlmICghZGV2X3ByaXYt
PnZidC5jaGlsZF9kZXYpIHsKLQkJRFJNX0RFQlVHX0tNUygiTm8gbWVtb3J5IHNwYWNlIGZvciBj
aGlsZCBkZXZpY2VcbiIpOwotCQlyZXR1cm47Ci0JfQogCi0JZGV2X3ByaXYtPnZidC5jaGlsZF9k
ZXZfbnVtID0gY291bnQ7Ci0JY291bnQgPSAwOwogCWZvciAoaSA9IDA7IGkgPCBjaGlsZF9kZXZp
Y2VfbnVtOyBpKyspIHsKLQkJY2hpbGQgPSBjaGlsZF9kZXZpY2VfcHRyKGRlZnMsIGkpOwotCQlp
ZiAoIWNoaWxkLT5kZXZpY2VfdHlwZSkKKwkJY29uZmlnID0gY2hpbGRfZGV2aWNlX3B0cihkZWZz
LCBpKTsKKwkJaWYgKCFjb25maWctPmRldmljZV90eXBlKQogCQkJY29udGludWU7CiAKIAkJRFJN
X0RFQlVHX0tNUygiRm91bmQgVkJUIGNoaWxkIGRldmljZSB3aXRoIHR5cGUgMHgleFxuIiwKLQkJ
CSAgICAgIGNoaWxkLT5kZXZpY2VfdHlwZSk7CisJCQkgICAgICBjb25maWctPmRldmljZV90eXBl
KTsKKworCQljaGlsZCA9IGttYWxsb2Moc2l6ZW9mKCpjaGlsZCksIEdGUF9LRVJORUwpOwogCiAJ
CS8qCiAJCSAqIENvcHkgYXMgbXVjaCBhcyB3ZSBrbm93IChzaXplb2YpIGFuZCBpcyBhdmFpbGFi
bGUKLQkJICogKGNoaWxkX2Rldl9zaXplKSBvZiB0aGUgY2hpbGQgZGV2aWNlLiBBY2Nlc3Npbmcg
dGhlIGRhdGEgbXVzdAotCQkgKiBkZXBlbmQgb24gVkJUIHZlcnNpb24uCisJCSAqIChjaGlsZF9k
ZXZfc2l6ZSkgb2YgdGhlIGNoaWxkIGRldmljZSBjb25maWcuIEFjY2Vzc2luZyB0aGUKKwkJICog
ZGF0YSBtdXN0IGRlcGVuZCBvbiBWQlQgdmVyc2lvbi4KIAkJICovCi0JCW1lbWNweShkZXZfcHJp
di0+dmJ0LmNoaWxkX2RldiArIGNvdW50LCBjaGlsZCwKLQkJICAgICAgIG1pbl90KHNpemVfdCwg
ZGVmcy0+Y2hpbGRfZGV2X3NpemUsIHNpemVvZigqY2hpbGQpKSk7Ci0JCWNvdW50Kys7CisJCW1l
bWNweSgmY2hpbGQtPmNvbmZpZywgY29uZmlnLAorCQkgICAgICAgbWluX3Qoc2l6ZV90LCBkZWZz
LT5jaGlsZF9kZXZfc2l6ZSwgc2l6ZW9mKCpjb25maWcpKSk7CisKKwkJbGlzdF9hZGQoJmNoaWxk
LT5ub2RlLCAmZGV2X3ByaXYtPnZidC5jaGlsZF9kZXZpY2VzKTsKIAl9CisKKwlpZiAobGlzdF9l
bXB0eSgmZGV2X3ByaXYtPnZidC5jaGlsZF9kZXZpY2VzKSkKKwkJRFJNX0RFQlVHX0tNUygibm8g
Y2hpbGQgZGV2IGlzIHBhcnNlZCBmcm9tIFZCVFxuIik7CiB9CiAKIC8qIENvbW1vbiBkZWZhdWx0
cyB3aGljaCBtYXkgYmUgb3ZlcnJpZGRlbiBieSBWQlQuICovCkBAIC0xODQ5LDYgKzE4NDAsOCBA
QCB2b2lkIGludGVsX2Jpb3NfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiAJCXJldHVybjsKIAl9CiAKKwlJTklUX0xJU1RfSEVBRCgmZGV2X3ByaXYtPnZidC5jaGlsZF9k
ZXZpY2VzKTsKKwogCWluaXRfdmJ0X2RlZmF1bHRzKGRldl9wcml2KTsKIAogCS8qIElmIHRoZSBP
cFJlZ2lvbiBkb2VzIG5vdCBoYXZlIFZCVCwgbG9vayBpbiBQQ0kgUk9NLiAqLwpAQCAtMTkwMyw5
ICsxODk2LDEzIEBAIHZvaWQgaW50ZWxfYmlvc19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKICAqLwogdm9pZCBpbnRlbF9iaW9zX2RyaXZlcl9yZW1vdmUoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogewotCWtmcmVlKGRldl9wcml2LT52YnQuY2hpbGRf
ZGV2KTsKLQlkZXZfcHJpdi0+dmJ0LmNoaWxkX2RldiA9IE5VTEw7Ci0JZGV2X3ByaXYtPnZidC5j
aGlsZF9kZXZfbnVtID0gMDsKKwlzdHJ1Y3QgY2hpbGRfZGV2aWNlICpjaGlsZCwgKm47CisKKwls
aXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUoY2hpbGQsIG4sICZkZXZfcHJpdi0+dmJ0LmNoaWxkX2Rl
dmljZXMsIG5vZGUpIHsKKwkJbGlzdF9kZWwoJmNoaWxkLT5ub2RlKTsKKwkJa2ZyZWUoY2hpbGQp
OworCX0KKwogCWtmcmVlKGRldl9wcml2LT52YnQuc2R2b19sdmRzX3ZidF9tb2RlKTsKIAlkZXZf
cHJpdi0+dmJ0LnNkdm9fbHZkc192YnRfbW9kZSA9IE5VTEw7CiAJa2ZyZWUoZGV2X3ByaXYtPnZi
dC5sZnBfbHZkc192YnRfbW9kZSk7CkBAIC0xOTI5LDIxICsxOTI2LDIyIEBAIHZvaWQgaW50ZWxf
Ymlvc19kcml2ZXJfcmVtb3ZlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKICAq
LwogYm9vbCBpbnRlbF9iaW9zX2lzX3R2X3ByZXNlbnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQogewotCWNvbnN0IHN0cnVjdCBjaGlsZF9kZXZpY2VfY29uZmlnICpjaGlsZDsK
LQlpbnQgaTsKKwljb25zdCBzdHJ1Y3QgY2hpbGRfZGV2aWNlX2NvbmZpZyAqY29uZmlnOworCWNv
bnN0IHN0cnVjdCBjaGlsZF9kZXZpY2UgKmNoaWxkOwogCiAJaWYgKCFkZXZfcHJpdi0+dmJ0Lmlu
dF90dl9zdXBwb3J0KQogCQlyZXR1cm4gZmFsc2U7CiAKLQlpZiAoIWRldl9wcml2LT52YnQuY2hp
bGRfZGV2X251bSkKKwlpZiAobGlzdF9lbXB0eSgmZGV2X3ByaXYtPnZidC5jaGlsZF9kZXZpY2Vz
KSkKIAkJcmV0dXJuIHRydWU7CiAKLQlmb3IgKGkgPSAwOyBpIDwgZGV2X3ByaXYtPnZidC5jaGls
ZF9kZXZfbnVtOyBpKyspIHsKLQkJY2hpbGQgPSBkZXZfcHJpdi0+dmJ0LmNoaWxkX2RldiArIGk7
CisJbGlzdF9mb3JfZWFjaF9lbnRyeShjaGlsZCwgJmRldl9wcml2LT52YnQuY2hpbGRfZGV2aWNl
cywgbm9kZSkgeworCQljb25maWcgPSAmY2hpbGQtPmNvbmZpZzsKKwogCQkvKgogCQkgKiBJZiB0
aGUgZGV2aWNlIHR5cGUgaXMgbm90IFRWLCBjb250aW51ZS4KIAkJICovCi0JCXN3aXRjaCAoY2hp
bGQtPmRldmljZV90eXBlKSB7CisJCXN3aXRjaCAoY29uZmlnLT5kZXZpY2VfdHlwZSkgewogCQlj
YXNlIERFVklDRV9UWVBFX0lOVF9UVjoKIAkJY2FzZSBERVZJQ0VfVFlQRV9UVjoKIAkJY2FzZSBE
RVZJQ0VfVFlQRV9UVl9TVklERU9fQ09NUE9TSVRFOgpAQCAtMTk1NCw3ICsxOTUyLDcgQEAgYm9v
bCBpbnRlbF9iaW9zX2lzX3R2X3ByZXNlbnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQogCQkvKiBPbmx5IHdoZW4gdGhlIGFkZGluX29mZnNldCBpcyBub24temVybywgaXQgaXMg
cmVnYXJkZWQKIAkJICogYXMgcHJlc2VudC4KIAkJICovCi0JCWlmIChjaGlsZC0+YWRkaW5fb2Zm
c2V0KQorCQlpZiAoY29uZmlnLT5hZGRpbl9vZmZzZXQpCiAJCQlyZXR1cm4gdHJ1ZTsKIAl9CiAK
QEAgLTE5NzEsMzIgKzE5NjksMzIgQEAgYm9vbCBpbnRlbF9iaW9zX2lzX3R2X3ByZXNlbnQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogICovCiBib29sIGludGVsX2Jpb3NfaXNf
bHZkc19wcmVzZW50KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTggKmkyY19w
aW4pCiB7Ci0JY29uc3Qgc3RydWN0IGNoaWxkX2RldmljZV9jb25maWcgKmNoaWxkOwotCWludCBp
OworCWNvbnN0IHN0cnVjdCBjaGlsZF9kZXZpY2UgKmNoaWxkOworCWNvbnN0IHN0cnVjdCBjaGls
ZF9kZXZpY2VfY29uZmlnICpjb25maWc7CiAKLQlpZiAoIWRldl9wcml2LT52YnQuY2hpbGRfZGV2
X251bSkKKwlpZiAobGlzdF9lbXB0eSgmZGV2X3ByaXYtPnZidC5jaGlsZF9kZXZpY2VzKSkKIAkJ
cmV0dXJuIHRydWU7CiAKLQlmb3IgKGkgPSAwOyBpIDwgZGV2X3ByaXYtPnZidC5jaGlsZF9kZXZf
bnVtOyBpKyspIHsKLQkJY2hpbGQgPSBkZXZfcHJpdi0+dmJ0LmNoaWxkX2RldiArIGk7CisJbGlz
dF9mb3JfZWFjaF9lbnRyeShjaGlsZCwgJmRldl9wcml2LT52YnQuY2hpbGRfZGV2aWNlcywgbm9k
ZSkgeworCQljb25maWcgPSAmY2hpbGQtPmNvbmZpZzsKIAogCQkvKiBJZiB0aGUgZGV2aWNlIHR5
cGUgaXMgbm90IExGUCwgY29udGludWUuCiAJCSAqIFdlIGhhdmUgdG8gY2hlY2sgYm90aCB0aGUg
bmV3IGlkZW50aWZpZXJzIGFzIHdlbGwgYXMgdGhlCiAJCSAqIG9sZCBmb3IgY29tcGF0aWJpbGl0
eSB3aXRoIHNvbWUgQklPU2VzLgogCQkgKi8KLQkJaWYgKGNoaWxkLT5kZXZpY2VfdHlwZSAhPSBE
RVZJQ0VfVFlQRV9JTlRfTEZQICYmCi0JCSAgICBjaGlsZC0+ZGV2aWNlX3R5cGUgIT0gREVWSUNF
X1RZUEVfTEZQKQorCQlpZiAoY29uZmlnLT5kZXZpY2VfdHlwZSAhPSBERVZJQ0VfVFlQRV9JTlRf
TEZQICYmCisJCSAgICBjb25maWctPmRldmljZV90eXBlICE9IERFVklDRV9UWVBFX0xGUCkKIAkJ
CWNvbnRpbnVlOwogCi0JCWlmIChpbnRlbF9nbWJ1c19pc192YWxpZF9waW4oZGV2X3ByaXYsIGNo
aWxkLT5pMmNfcGluKSkKLQkJCSppMmNfcGluID0gY2hpbGQtPmkyY19waW47CisJCWlmIChpbnRl
bF9nbWJ1c19pc192YWxpZF9waW4oZGV2X3ByaXYsIGNvbmZpZy0+aTJjX3BpbikpCisJCQkqaTJj
X3BpbiA9IGNvbmZpZy0+aTJjX3BpbjsKIAogCQkvKiBIb3dldmVyLCB3ZSBjYW5ub3QgdHJ1c3Qg
dGhlIEJJT1Mgd3JpdGVycyB0byBwb3B1bGF0ZQogCQkgKiB0aGUgVkJUIGNvcnJlY3RseS4gIFNp
bmNlIExWRFMgcmVxdWlyZXMgYWRkaXRpb25hbAogCQkgKiBpbmZvcm1hdGlvbiBmcm9tIEFJTSBi
bG9ja3MsIGEgbm9uLXplcm8gYWRkaW4gb2Zmc2V0IGlzCiAJCSAqIGEgZ29vZCBpbmRpY2F0b3Ig
dGhhdCB0aGUgTFZEUyBpcyBhY3R1YWxseSBwcmVzZW50LgogCQkgKi8KLQkJaWYgKGNoaWxkLT5h
ZGRpbl9vZmZzZXQpCisJCWlmIChjb25maWctPmFkZGluX29mZnNldCkKIAkJCXJldHVybiB0cnVl
OwogCiAJCS8qIEJ1dCBldmVuIHRoZW4gc29tZSBCSU9TIHdyaXRlcnMgcGVyZm9ybSBzb21lIGJs
YWNrIG1hZ2ljCkBAIC0yMDIwLDcgKzIwMTgsOCBAQCBib29sIGludGVsX2Jpb3NfaXNfbHZkc19w
cmVzZW50KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTggKmkyY19waW4pCiAg
Ki8KIGJvb2wgaW50ZWxfYmlvc19pc19wb3J0X3ByZXNlbnQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LCBlbnVtIHBvcnQgcG9ydCkKIHsKLQljb25zdCBzdHJ1Y3QgY2hpbGRfZGV2
aWNlX2NvbmZpZyAqY2hpbGQ7CisJY29uc3Qgc3RydWN0IGNoaWxkX2RldmljZV9jb25maWcgKmNv
bmZpZzsKKwljb25zdCBzdHJ1Y3QgY2hpbGRfZGV2aWNlICpjaGlsZDsKIAlzdGF0aWMgY29uc3Qg
c3RydWN0IHsKIAkJdTE2IGRwLCBoZG1pOwogCX0gcG9ydF9tYXBwaW5nW10gPSB7CkBAIC0yMDMw
LDcgKzIwMjksNiBAQCBib29sIGludGVsX2Jpb3NfaXNfcG9ydF9wcmVzZW50KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwb3J0IHBvcgogCQlbUE9SVF9FXSA9IHsgRFZP
X1BPUlRfRFBFLCBEVk9fUE9SVF9IRE1JRSwgfSwKIAkJW1BPUlRfRl0gPSB7IERWT19QT1JUX0RQ
RiwgRFZPX1BPUlRfSERNSUYsIH0sCiAJfTsKLQlpbnQgaTsKIAogCWlmIChIQVNfRERJKGRldl9w
cml2KSkgewogCQljb25zdCBzdHJ1Y3QgZGRpX3ZidF9wb3J0X2luZm8gKnBvcnRfaW5mbyA9CkBA
IC0yMDQ1LDE2ICsyMDQzLDEzIEBAIGJvb2wgaW50ZWxfYmlvc19pc19wb3J0X3ByZXNlbnQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBvcnQgcG9yCiAJaWYgKFdBUk5f
T04ocG9ydCA9PSBQT1JUX0EpIHx8IHBvcnQgPj0gQVJSQVlfU0laRShwb3J0X21hcHBpbmcpKQog
CQlyZXR1cm4gZmFsc2U7CiAKLQlpZiAoIWRldl9wcml2LT52YnQuY2hpbGRfZGV2X251bSkKLQkJ
cmV0dXJuIGZhbHNlOwotCi0JZm9yIChpID0gMDsgaSA8IGRldl9wcml2LT52YnQuY2hpbGRfZGV2
X251bTsgaSsrKSB7Ci0JCWNoaWxkID0gZGV2X3ByaXYtPnZidC5jaGlsZF9kZXYgKyBpOworCWxp
c3RfZm9yX2VhY2hfZW50cnkoY2hpbGQsICZkZXZfcHJpdi0+dmJ0LmNoaWxkX2RldmljZXMsIG5v
ZGUpIHsKKwkJY29uZmlnID0gJmNoaWxkLT5jb25maWc7CiAKLQkJaWYgKChjaGlsZC0+ZHZvX3Bv
cnQgPT0gcG9ydF9tYXBwaW5nW3BvcnRdLmRwIHx8Ci0JCSAgICAgY2hpbGQtPmR2b19wb3J0ID09
IHBvcnRfbWFwcGluZ1twb3J0XS5oZG1pKSAmJgotCQkgICAgKGNoaWxkLT5kZXZpY2VfdHlwZSAm
IChERVZJQ0VfVFlQRV9UTURTX0RWSV9TSUdOQUxJTkcgfAotCQkJCQkgICBERVZJQ0VfVFlQRV9E
SVNQTEFZUE9SVF9PVVRQVVQpKSkKKwkJaWYgKChjb25maWctPmR2b19wb3J0ID09IHBvcnRfbWFw
cGluZ1twb3J0XS5kcCB8fAorCQkgICAgIGNvbmZpZy0+ZHZvX3BvcnQgPT0gcG9ydF9tYXBwaW5n
W3BvcnRdLmhkbWkpICYmCisJCSAgICAoY29uZmlnLT5kZXZpY2VfdHlwZSAmIChERVZJQ0VfVFlQ
RV9UTURTX0RWSV9TSUdOQUxJTkcgfAorCQkJCQkgICAgREVWSUNFX1RZUEVfRElTUExBWVBPUlRf
T1VUUFVUKSkpCiAJCQlyZXR1cm4gdHJ1ZTsKIAl9CiAKQEAgLTIwNzAsNyArMjA2NSw4IEBAIGJv
b2wgaW50ZWxfYmlvc19pc19wb3J0X3ByZXNlbnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LCBlbnVtIHBvcnQgcG9yCiAgKi8KIGJvb2wgaW50ZWxfYmlvc19pc19wb3J0X2VkcChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcG9ydCBwb3J0KQogewotCWNv
bnN0IHN0cnVjdCBjaGlsZF9kZXZpY2VfY29uZmlnICpjaGlsZDsKKwljb25zdCBzdHJ1Y3QgY2hp
bGRfZGV2aWNlX2NvbmZpZyAqY29uZmlnOworCWNvbnN0IHN0cnVjdCBjaGlsZF9kZXZpY2UgKmNo
aWxkOwogCXN0YXRpYyBjb25zdCBzaG9ydCBwb3J0X21hcHBpbmdbXSA9IHsKIAkJW1BPUlRfQl0g
PSBEVk9fUE9SVF9EUEIsCiAJCVtQT1JUX0NdID0gRFZPX1BPUlRfRFBDLApAQCAtMjA3OCwxOSAr
MjA3NCwxNSBAQCBib29sIGludGVsX2Jpb3NfaXNfcG9ydF9lZHAoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LCBlbnVtIHBvcnQgcG9ydCkKIAkJW1BPUlRfRV0gPSBEVk9fUE9SVF9E
UEUsCiAJCVtQT1JUX0ZdID0gRFZPX1BPUlRfRFBGLAogCX07Ci0JaW50IGk7CiAKIAlpZiAoSEFT
X0RESShkZXZfcHJpdikpCiAJCXJldHVybiBkZXZfcHJpdi0+dmJ0LmRkaV9wb3J0X2luZm9bcG9y
dF0uc3VwcG9ydHNfZWRwOwogCi0JaWYgKCFkZXZfcHJpdi0+dmJ0LmNoaWxkX2Rldl9udW0pCi0J
CXJldHVybiBmYWxzZTsKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5KGNoaWxkLCAmZGV2X3ByaXYtPnZi
dC5jaGlsZF9kZXZpY2VzLCBub2RlKSB7CisJCWNvbmZpZyA9ICZjaGlsZC0+Y29uZmlnOwogCi0J
Zm9yIChpID0gMDsgaSA8IGRldl9wcml2LT52YnQuY2hpbGRfZGV2X251bTsgaSsrKSB7Ci0JCWNo
aWxkID0gZGV2X3ByaXYtPnZidC5jaGlsZF9kZXYgKyBpOwotCi0JCWlmIChjaGlsZC0+ZHZvX3Bv
cnQgPT0gcG9ydF9tYXBwaW5nW3BvcnRdICYmCi0JCSAgICAoY2hpbGQtPmRldmljZV90eXBlICYg
REVWSUNFX1RZUEVfZURQX0JJVFMpID09CisJCWlmIChjb25maWctPmR2b19wb3J0ID09IHBvcnRf
bWFwcGluZ1twb3J0XSAmJgorCQkgICAgKGNvbmZpZy0+ZGV2aWNlX3R5cGUgJiBERVZJQ0VfVFlQ
RV9lRFBfQklUUykgPT0KIAkJICAgIChERVZJQ0VfVFlQRV9lRFAgJiBERVZJQ0VfVFlQRV9lRFBf
QklUUykpCiAJCQlyZXR1cm4gdHJ1ZTsKIAl9CkBAIC0yMTM2LDEzICsyMTI4LDEwIEBAIHN0YXRp
YyBib29sIGNoaWxkX2Rldl9pc19kcF9kdWFsX21vZGUoY29uc3Qgc3RydWN0IGNoaWxkX2Rldmlj
ZV9jb25maWcgKmNoaWxkLAogYm9vbCBpbnRlbF9iaW9zX2lzX3BvcnRfZHBfZHVhbF9tb2RlKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCQkgICAgIGVudW0gcG9ydCBwb3J0
KQogewotCWNvbnN0IHN0cnVjdCBjaGlsZF9kZXZpY2VfY29uZmlnICpjaGlsZDsKLQlpbnQgaTsK
Kwljb25zdCBzdHJ1Y3QgY2hpbGRfZGV2aWNlICpjaGlsZDsKIAotCWZvciAoaSA9IDA7IGkgPCBk
ZXZfcHJpdi0+dmJ0LmNoaWxkX2Rldl9udW07IGkrKykgewotCQljaGlsZCA9IGRldl9wcml2LT52
YnQuY2hpbGRfZGV2ICsgaTsKLQotCQlpZiAoY2hpbGRfZGV2X2lzX2RwX2R1YWxfbW9kZShjaGls
ZCwgcG9ydCkpCisJbGlzdF9mb3JfZWFjaF9lbnRyeShjaGlsZCwgJmRldl9wcml2LT52YnQuY2hp
bGRfZGV2aWNlcywgbm9kZSkgeworCQlpZiAoY2hpbGRfZGV2X2lzX2RwX2R1YWxfbW9kZSgmY2hp
bGQtPmNvbmZpZywgcG9ydCkpCiAJCQlyZXR1cm4gdHJ1ZTsKIAl9CiAKQEAgLTIxNTksMTcgKzIx
NDgsMTcgQEAgYm9vbCBpbnRlbF9iaW9zX2lzX3BvcnRfZHBfZHVhbF9tb2RlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIGJvb2wgaW50ZWxfYmlvc19pc19kc2lfcHJlc2VudChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkgICAgICAgZW51bSBwb3J0ICpw
b3J0KQogewotCWNvbnN0IHN0cnVjdCBjaGlsZF9kZXZpY2VfY29uZmlnICpjaGlsZDsKKwljb25z
dCBzdHJ1Y3QgY2hpbGRfZGV2aWNlX2NvbmZpZyAqY29uZmlnOworCWNvbnN0IHN0cnVjdCBjaGls
ZF9kZXZpY2UgKmNoaWxkOwogCXU4IGR2b19wb3J0OwotCWludCBpOwogCi0JZm9yIChpID0gMDsg
aSA8IGRldl9wcml2LT52YnQuY2hpbGRfZGV2X251bTsgaSsrKSB7Ci0JCWNoaWxkID0gZGV2X3By
aXYtPnZidC5jaGlsZF9kZXYgKyBpOworCWxpc3RfZm9yX2VhY2hfZW50cnkoY2hpbGQsICZkZXZf
cHJpdi0+dmJ0LmNoaWxkX2RldmljZXMsIG5vZGUpIHsKKwkJY29uZmlnID0gJmNoaWxkLT5jb25m
aWc7CiAKLQkJaWYgKCEoY2hpbGQtPmRldmljZV90eXBlICYgREVWSUNFX1RZUEVfTUlQSV9PVVRQ
VVQpKQorCQlpZiAoIShjb25maWctPmRldmljZV90eXBlICYgREVWSUNFX1RZUEVfTUlQSV9PVVRQ
VVQpKQogCQkJY29udGludWU7CiAKLQkJZHZvX3BvcnQgPSBjaGlsZC0+ZHZvX3BvcnQ7CisJCWR2
b19wb3J0ID0gY29uZmlnLT5kdm9fcG9ydDsKIAogCQlpZiAoZHZvX3BvcnQgPT0gRFZPX1BPUlRf
TUlQSUEgfHwKIAkJICAgIChkdm9fcG9ydCA9PSBEVk9fUE9SVF9NSVBJQiAmJiBJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDExKSB8fApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKaW5kZXggN2UwZjY3YmFi
ZTIwLi5hZTg1ZmZhMDg2NjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaApAQCAtNzI0LDggKzcy
NCw3IEBAIHN0cnVjdCBpbnRlbF92YnRfZGF0YSB7CiAKIAlpbnQgY3J0X2RkY19waW47CiAKLQlp
bnQgY2hpbGRfZGV2X251bTsKLQlzdHJ1Y3QgY2hpbGRfZGV2aWNlX2NvbmZpZyAqY2hpbGRfZGV2
OworCXN0cnVjdCBsaXN0X2hlYWQgY2hpbGRfZGV2aWNlczsKIAogCXN0cnVjdCBkZGlfdmJ0X3Bv
cnRfaW5mbyBkZGlfcG9ydF9pbmZvW0k5MTVfTUFYX1BPUlRTXTsKIAlzdHJ1Y3Qgc2R2b19kZXZp
Y2VfbWFwcGluZyBzZHZvX21hcHBpbmdzWzJdOwotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0Cklu
dGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

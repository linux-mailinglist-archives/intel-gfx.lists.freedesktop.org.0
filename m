Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 1A632B2873
	for <lists+intel-gfx@lfdr.de>; Sat, 14 Sep 2019 00:33:11 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 54A436F492;
	Fri, 13 Sep 2019 22:33:06 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga17.intel.com (mga17.intel.com [192.55.52.151])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B3CB76F48B
 for <intel-gfx@lists.freedesktop.org>; Fri, 13 Sep 2019 22:32:57 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga004.jf.intel.com ([10.7.209.38])
 by fmsmga107.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 13 Sep 2019 15:32:57 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,489,1559545200"; d="scan'208";a="337037981"
Received: from josouza-mobl.jf.intel.com (HELO josouza-MOBL.intel.com)
 ([10.24.9.135])
 by orsmga004.jf.intel.com with ESMTP; 13 Sep 2019 15:32:56 -0700
From: =?UTF-8?q?Jos=C3=A9=20Roberto=20de=20Souza?= <jose.souza@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 13 Sep 2019 15:32:45 -0700
Message-Id: <20190913223251.354877-9-jose.souza@intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190913223251.354877-1-jose.souza@intel.com>
References: <20190913223251.354877-1-jose.souza@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 08/14] drm/i915/tgl: Add dkl phy programming
 sequences
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Taylor@freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogIlRheWxvciwgQ2xpbnRvbiBBIiA8Y2xpbnRvbi5hLnRheWxvckBpbnRlbC5jb20+CgpB
ZGRlZCBES0wgUGh5IHNlcXVlbmNlcyBhbmQgaGVscGVycyBmdW5jdGlvbnMgdG8gcHJvZ3JhbSB2
b2x0YWdlCnN3aW5nLCBjbG9jayBnYXRpbmcgYW5kIGRwIG1vZGUuCgpJdCBpcyBub3Qgd3JpdHRl
biBpbiBEUCBlbmFibGluZyBzZXF1ZW5jZSBidXQgIlBIWSBDbG9ja2dhdGluZwpwcm9ncmFtbWlu
ZyIgc3RhdGVzIHRoYXQgY2xvY2sgZ2F0aW5nIHNob3VsZCBiZSBlbmFibGVkIGFmdGVyIHRoZQps
aW5rIHRyYWluaW5nIGJ1dCBkb2luZyBzbyBjYXVzZXMgYWxsIHRoZSBmb2xsb3dpbmcgdHJhaW5p
bmdzIHRvIGZhaWwKc28gbm90IGVuYWJsaW5nIGl0IGZvci4KCkJTcGVjOiA0OTI5MgpCU3BlYzog
NDkxOTAKClNpZ25lZC1vZmYtYnk6IEpvc8OpIFJvYmVydG8gZGUgU291emEgPGpvc2Uuc291emFA
aW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBUYXlsb3IsIENsaW50b24gQSA8Y2xpbnRvbi5hLnRh
eWxvckBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
ZGkuYyB8IDI0NiArKysrKysrKysrKysrKysrKysrKystLQogMSBmaWxlIGNoYW5nZWQsIDIzNCBp
bnNlcnRpb25zKCspLCAxMiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kZGkuYwppbmRleCA4MTc5MmEwNGUwYWEuLmRkM2RiNTg0NGJjYiAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCkBAIC01ODYsNiArNTg2LDI1IEBAIHN0
YXRpYyBjb25zdCBzdHJ1Y3QgaWNsX21nX3BoeV9kZGlfYnVmX3RyYW5zIGljbF9tZ19waHlfZGRp
X3RyYW5zbGF0aW9uc1tdID0gewogCXsgMHgwLCAweDAwLCAweDAwIH0sCS8qIDMgICAgICAgICAg
ICAgIDAgICAqLwogfTsKIAorc3RydWN0IHRnbF9ka2xfcGh5X2RkaV9idWZfdHJhbnMgeworCXUz
MiBka2xfdnN3aW5nX2NvbnRyb2w7CisJdTMyIGRrbF9wcmVzaG9vdF9jb250cm9sOworCXUzMiBk
a2xfZGVfZW1waGFzaXNfY29udHJvbDsKK307CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgdGdsX2Rr
bF9waHlfZGRpX2J1Zl90cmFucyB0Z2xfZGtsX3BoeV9kZGlfdHJhbnNsYXRpb25zW10gPSB7CisJ
eyAweDcsIDB4MCwgMHgwMCB9LAkvKiAwICAgICAwICAgNDAwbVYgIDAgZEIgICAqLworCXsgMHg1
LCAweDAsIDB4MDMgfSwJLyogMCAgICAgMSAgIDQwMG1WICAzLjUgZEIgKi8KKwl7IDB4MiwgMHgw
LCAweDBiIH0sCS8qIDAgICAgIDIgICA0MDBtViAgNiBkQiAgICovCisJeyAweDAsIDB4MCwgMHgx
OSB9LAkvKiAwICAgICAzICAgNDAwbVYgIDkuNSBkQiAqLworCXsgMHg1LCAweDAsIDB4MDAgfSwJ
LyogMSAgICAgMCAgIDYwMG1WICAwIGRCICAgKi8KKwl7IDB4MiwgMHgwLCAweDAzIH0sCS8qIDEg
ICAgIDEgICA2MDBtViAgMy41IGRCICovCisJeyAweDAsIDB4MCwgMHgxNCB9LAkvKiAxICAgICAy
ICAgNjAwbVYgIDYgZEIgICAqLworCXsgMHgyLCAweDAsIDB4MDAgfSwJLyogMiAgICAgMCAgIDgw
MG1WICAwIGRCICAgKi8KKwl7IDB4MCwgMHgwLCAweDBCIH0sCS8qIDIgICAgIDEgICA4MDBtViAg
My41IGRCICovCisJeyAweDAsIDB4MCwgMHgwMCB9LAkvKiAzICAgICAwICAxMjAwbVYgIDAgZEIg
ICAgSERNSSBEZWZhdWx0ICovCit9OworCiBzdGF0aWMgY29uc3Qgc3RydWN0IGRkaV9idWZfdHJh
bnMgKgogYmR3X2dldF9idWZfdHJhbnNfZWRwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwgaW50ICpuX2VudHJpZXMpCiB7CkBAIC04NzMsMTEgKzg5MiwxNSBAQCBzdGF0aWMgaW50
IGludGVsX2RkaV9oZG1pX2xldmVsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwg
ZW51bSBwb3J0IHBvcgogCWxldmVsID0gZGV2X3ByaXYtPnZidC5kZGlfcG9ydF9pbmZvW3BvcnRd
LmhkbWlfbGV2ZWxfc2hpZnQ7CiAKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkgewot
CQlpZiAoaW50ZWxfcGh5X2lzX2NvbWJvKGRldl9wcml2LCBwaHkpKQorCQlpZiAoaW50ZWxfcGh5
X2lzX2NvbWJvKGRldl9wcml2LCBwaHkpKSB7CiAJCQlpY2xfZ2V0X2NvbWJvX2J1Zl90cmFucyhk
ZXZfcHJpdiwgSU5URUxfT1VUUFVUX0hETUksCiAJCQkJCQkwLCAmbl9lbnRyaWVzKTsKLQkJZWxz
ZQotCQkJbl9lbnRyaWVzID0gQVJSQVlfU0laRShpY2xfbWdfcGh5X2RkaV90cmFuc2xhdGlvbnMp
OworCQl9IGVsc2UgeworCQkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpCisJCQkJbl9l
bnRyaWVzID0gQVJSQVlfU0laRSh0Z2xfZGtsX3BoeV9kZGlfdHJhbnNsYXRpb25zKTsKKwkJCWVs
c2UKKwkJCQluX2VudHJpZXMgPSBBUlJBWV9TSVpFKGljbF9tZ19waHlfZGRpX3RyYW5zbGF0aW9u
cyk7CisJCX0KIAkJZGVmYXVsdF9lbnRyeSA9IG5fZW50cmllcyAtIDE7CiAJfSBlbHNlIGlmIChJ
U19DQU5OT05MQUtFKGRldl9wcml2KSkgewogCQljbmxfZ2V0X2J1Zl90cmFuc19oZG1pKGRldl9w
cml2LCAmbl9lbnRyaWVzKTsKQEAgLTIzMDgsMTEgKzIzMzEsMTUgQEAgdTggaW50ZWxfZGRpX2Rw
X3ZvbHRhZ2VfbWF4KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogCWludCBuX2VudHJp
ZXM7CiAKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkgewotCQlpZiAoaW50ZWxfcGh5
X2lzX2NvbWJvKGRldl9wcml2LCBwaHkpKQorCQlpZiAoaW50ZWxfcGh5X2lzX2NvbWJvKGRldl9w
cml2LCBwaHkpKSB7CiAJCQlpY2xfZ2V0X2NvbWJvX2J1Zl90cmFucyhkZXZfcHJpdiwgZW5jb2Rl
ci0+dHlwZSwKIAkJCQkJCWludGVsX2RwLT5saW5rX3JhdGUsICZuX2VudHJpZXMpOwotCQllbHNl
Ci0JCQluX2VudHJpZXMgPSBBUlJBWV9TSVpFKGljbF9tZ19waHlfZGRpX3RyYW5zbGF0aW9ucyk7
CisJCX0gZWxzZSB7CisJCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikKKwkJCQluX2Vu
dHJpZXMgPSBBUlJBWV9TSVpFKHRnbF9ka2xfcGh5X2RkaV90cmFuc2xhdGlvbnMpOworCQkJZWxz
ZQorCQkJCW5fZW50cmllcyA9IEFSUkFZX1NJWkUoaWNsX21nX3BoeV9kZGlfdHJhbnNsYXRpb25z
KTsKKwkJfQogCX0gZWxzZSBpZiAoSVNfQ0FOTk9OTEFLRShkZXZfcHJpdikpIHsKIAkJaWYgKGVu
Y29kZXItPnR5cGUgPT0gSU5URUxfT1VUUFVUX0VEUCkKIAkJCWNubF9nZXRfYnVmX3RyYW5zX2Vk
cChkZXZfcHJpdiwgJm5fZW50cmllcyk7CkBAIC0yNzQ5LDYgKzI3NzYsNjYgQEAgc3RhdGljIHZv
aWQgaWNsX2RkaV92c3dpbmdfc2VxdWVuY2Uoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIs
CiAJCWljbF9tZ19waHlfZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBsaW5rX2Nsb2NrLCBs
ZXZlbCk7CiB9CiAKK3N0YXRpYyB2b2lkCit0Z2xfZGtsX3BoeV9kZGlfdnN3aW5nX3NlcXVlbmNl
KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLCBpbnQgbGlua19jbG9jaywKKwkJCQl1MzIg
bGV2ZWwpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShl
bmNvZGVyLT5iYXNlLmRldik7CisJZW51bSB0Y19wb3J0IHRjX3BvcnQgPSBpbnRlbF9wb3J0X3Rv
X3RjKGRldl9wcml2LCBlbmNvZGVyLT5wb3J0KTsKKwljb25zdCBzdHJ1Y3QgdGdsX2RrbF9waHlf
ZGRpX2J1Zl90cmFucyAqZGRpX3RyYW5zbGF0aW9uczsKKwl1MzIgbl9lbnRyaWVzLCB2YWwsIGxu
OworCisJbl9lbnRyaWVzID0gQVJSQVlfU0laRSh0Z2xfZGtsX3BoeV9kZGlfdHJhbnNsYXRpb25z
KTsKKwlkZGlfdHJhbnNsYXRpb25zID0gdGdsX2RrbF9waHlfZGRpX3RyYW5zbGF0aW9uczsKKwor
CWlmIChsZXZlbCA+IG5fZW50cmllcykKKwkJbGV2ZWwgPSBuX2VudHJpZXMgLSAxOworCisJLyoK
KwkgKiBBbGwgcmVnaXN0ZXJzIHByb2dyYW1tZWQgaGVyZSB1c2UgSElQX0lOREVYX1JFRyAwIG9y
IDEKKwkgKi8KKwlmb3IgKGxuID0gMDsgbG4gPCAyOyBsbisrKSB7CisJCUk5MTVfV1JJVEUoSElQ
X0lOREVYX1JFRyh0Y19wb3J0KSwgbG4pOworCisJCS8qIEFsbCB0aGUgcmVnaXN0ZXJzIGFyZSBS
TVcgKi8KKwkJdmFsID0gSTkxNV9SRUFEKERLTF9UWF9EUENOVEwwKHRjX3BvcnQpKTsKKwkJdmFs
ICY9IH4oREtMX1RYX1BSRVNIT09UX0NPRUZGX01BU0sgfAorCQkJIERLTF9UWF9ERV9FTVBBSFNJ
U19DT0VGRl9NQVNLIHwKKwkJCSBES0xfVFhfVlNXSU5HX0NPTlRST0xfTUFTSyk7CisJCXZhbCB8
PSBES0xfVFhfVlNXSU5HX0NPTlRST0woZGRpX3RyYW5zbGF0aW9uc1tsZXZlbF0uZGtsX3Zzd2lu
Z19jb250cm9sKTsKKwkJdmFsIHw9IERLTF9UWF9ERV9FTVBIQVNJU19DT0VGRihkZGlfdHJhbnNs
YXRpb25zW2xldmVsXS5ka2xfZGVfZW1waGFzaXNfY29udHJvbCk7CisJCXZhbCB8PSBES0xfVFhf
UFJFU0hPT1RfQ09FRkYoZGRpX3RyYW5zbGF0aW9uc1tsZXZlbF0uZGtsX3ByZXNob290X2NvbnRy
b2wpOworCQlJOTE1X1dSSVRFKERLTF9UWF9EUENOVEwwKHRjX3BvcnQpLCB2YWwpOworCisJCXZh
bCA9IEk5MTVfUkVBRChES0xfVFhfRFBDTlRMMSh0Y19wb3J0KSk7CisJCXZhbCAmPSB+KERLTF9U
WF9QUkVTSE9PVF9DT0VGRl9NQVNLIHwKKwkJCSBES0xfVFhfREVfRU1QQUhTSVNfQ09FRkZfTUFT
SyB8CisJCQkgREtMX1RYX1ZTV0lOR19DT05UUk9MX01BU0spOworCQl2YWwgfD0gREtMX1RYX1ZT
V0lOR19DT05UUk9MKGRkaV90cmFuc2xhdGlvbnNbbGV2ZWxdLmRrbF92c3dpbmdfY29udHJvbCk7
CisJCXZhbCB8PSBES0xfVFhfREVfRU1QSEFTSVNfQ09FRkYoZGRpX3RyYW5zbGF0aW9uc1tsZXZl
bF0uZGtsX2RlX2VtcGhhc2lzX2NvbnRyb2wpOworCQl2YWwgfD0gREtMX1RYX1BSRVNIT09UX0NP
RUZGKGRkaV90cmFuc2xhdGlvbnNbbGV2ZWxdLmRrbF9wcmVzaG9vdF9jb250cm9sKTsKKwkJSTkx
NV9XUklURShES0xfVFhfRFBDTlRMMSh0Y19wb3J0KSwgdmFsKTsKKworCQl2YWwgPSBJOTE1X1JF
QUQoREtMX1RYX0RQQ05UTDIodGNfcG9ydCkpOworCQl2YWwgJj0gfkRLTF9UWF9EUDIwQklUTU9E
RTsKKwkJSTkxNV9XUklURShES0xfVFhfRFBDTlRMMih0Y19wb3J0KSwgdmFsKTsKKwl9Cit9CisK
K3N0YXRpYyB2b2lkIHRnbF9kZGlfdnN3aW5nX3NlcXVlbmNlKHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyLAorCQkJCSAgICBpbnQgbGlua19jbG9jaywKKwkJCQkgICAgdTMyIGxldmVsLAor
CQkJCSAgICBlbnVtIGludGVsX291dHB1dF90eXBlIHR5cGUpCit7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRldik7CisJZW51bSBw
aHkgcGh5ID0gaW50ZWxfcG9ydF90b19waHkoZGV2X3ByaXYsIGVuY29kZXItPnBvcnQpOworCisJ
aWYgKGludGVsX3BoeV9pc19jb21ibyhkZXZfcHJpdiwgcGh5KSkKKwkJaWNsX2NvbWJvX3BoeV9k
ZGlfdnN3aW5nX3NlcXVlbmNlKGVuY29kZXIsIGxldmVsLCB0eXBlKTsKKwllbHNlCisJCXRnbF9k
a2xfcGh5X2RkaV92c3dpbmdfc2VxdWVuY2UoZW5jb2RlciwgbGlua19jbG9jaywgbGV2ZWwpOwor
fQorCiBzdGF0aWMgdTMyIHRyYW5zbGF0ZV9zaWduYWxfbGV2ZWwoaW50IHNpZ25hbF9sZXZlbHMp
CiB7CiAJaW50IGk7CkBAIC0yNzgwLDcgKzI4NjcsMTAgQEAgdTMyIGJ4dF9zaWduYWxfbGV2ZWxz
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29k
ZXIgPSAmZHBvcnQtPmJhc2U7CiAJaW50IGxldmVsID0gaW50ZWxfZGRpX2RwX2xldmVsKGludGVs
X2RwKTsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQorCWlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDEyKQorCQl0Z2xfZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBpbnRl
bF9kcC0+bGlua19yYXRlLAorCQkJCQlsZXZlbCwgZW5jb2Rlci0+dHlwZSk7CisJZWxzZSBpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKIAkJaWNsX2RkaV92c3dpbmdfc2VxdWVuY2UoZW5j
b2RlciwgaW50ZWxfZHAtPmxpbmtfcmF0ZSwKIAkJCQkJbGV2ZWwsIGVuY29kZXItPnR5cGUpOwog
CWVsc2UgaWYgKElTX0NBTk5PTkxBS0UoZGV2X3ByaXYpKQpAQCAtMzAyNyw2ICszMTE3LDM0IEBA
IHN0YXRpYyB2b2lkIGludGVsX2RkaV9jbGtfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAq
ZW5jb2RlcikKIAl9CiB9CiAKK3N0YXRpYyB2b2lkCit0Z2xfcGh5X2Nsb2NrX2dhdGluZyhzdHJ1
Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCwgYm9vbCBlbmFibGUpCit7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkaWdfcG9ydC0+YmFzZS5iYXNl
LmRldik7CisJZW51bSBwb3J0IHBvcnQgPSBkaWdfcG9ydC0+YmFzZS5wb3J0OworCWVudW0gdGNf
cG9ydCB0Y19wb3J0ID0gaW50ZWxfcG9ydF90b190YyhkZXZfcHJpdiwgcG9ydCk7CisJdTMyIHZh
bCwgcmVnczsKKwlpbnQgbG47CisKKwlpZiAodGNfcG9ydCA9PSBQT1JUX1RDX05PTkUpCisJCXJl
dHVybjsKKworCXJlZ3MgPSBES0xfRFBfTU9ERV9DRkdfVFIyUFdSX0dBVElORyB8IERLTF9EUF9N
T0RFX0NGR19UUlBXUl9HQVRJTkcgfAorCSAgICAgICBES0xfRFBfTU9ERV9DRkdfQ0xOUFdSX0dB
VElORyB8IERLTF9EUF9NT0RFX0NGR19ESUdQV1JfR0FUSU5HIHwKKwkgICAgICAgREtMX0RQX01P
REVfQ0ZHX0dBT05QV1JfR0FUSU5HOworCisJZm9yIChsbiA9IDA7IGxuIDwgMjsgbG4rKykgewor
CQlJOTE1X1dSSVRFKEhJUF9JTkRFWF9SRUcodGNfcG9ydCksIGxuKTsKKworCQl2YWwgPSBJOTE1
X1JFQUQoREtMX0RQX01PREUodGNfcG9ydCkpOworCQlpZiAoZW5hYmxlKQorCQkJdmFsIHw9IHJl
Z3M7CisJCWVsc2UKKwkJCXZhbCAmPSB+cmVnczsKKwkJSTkxNV9XUklURShES0xfRFBfTU9ERSh0
Y19wb3J0KSwgdmFsKTsKKwl9Cit9CisKIHN0YXRpYyB2b2lkIGljbF9lbmFibGVfcGh5X2Nsb2Nr
X2dhdGluZyhzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCkKIHsKIAlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRpZ19wb3J0LT5iYXNlLmJhc2Uu
ZGV2KTsKQEAgLTMxNTMsNiArMzI3MSw5NSBAQCBzdGF0aWMgdm9pZCBpY2xfcHJvZ3JhbV9tZ19k
cF9tb2RlKHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0KQogCUk5MTVf
V1JJVEUoTUdfRFBfTU9ERSgxLCBwb3J0KSwgbG4xKTsKIH0KIAorc3RhdGljIHZvaWQgdGdsX3By
b2dyYW1fZGtsX2RwX21vZGUoc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqaW50ZWxfZGlnX3Bv
cnQpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShpbnRl
bF9kaWdfcG9ydC0+YmFzZS5iYXNlLmRldik7CisJZW51bSBwb3J0IHBvcnQgPSBpbnRlbF9kaWdf
cG9ydC0+YmFzZS5wb3J0OworCWVudW0gdGNfcG9ydCB0Y19wb3J0ID0gaW50ZWxfcG9ydF90b190
YyhkZXZfcHJpdiwgcG9ydCk7CisJdTMyIGxuMCwgbG4xLCBsYW5lX21hc2ssIHBpbl9tYXNrOwor
CWludCBudW1fbGFuZXM7CisKKwlpZiAodGNfcG9ydCA9PSBQT1JUX1RDX05PTkUgfHwKKwkgICAg
aW50ZWxfZGlnX3BvcnQtPnRjX21vZGUgPT0gVENfUE9SVF9UQlRfQUxUKQorCQlyZXR1cm47CisK
KwlJOTE1X1dSSVRFKEhJUF9JTkRFWF9SRUcodGNfcG9ydCksIDB4MCk7CisJbG4wID0gSTkxNV9S
RUFEKERLTF9EUF9NT0RFKHRjX3BvcnQpKTsKKwlJOTE1X1dSSVRFKEhJUF9JTkRFWF9SRUcodGNf
cG9ydCksIDB4MSk7CisJbG4xID0gSTkxNV9SRUFEKERLTF9EUF9NT0RFKHRjX3BvcnQpKTsKKwor
CW51bV9sYW5lcyA9IGludGVsX2RpZ19wb3J0LT5kcC5sYW5lX2NvdW50OworCisJc3dpdGNoIChp
bnRlbF9kaWdfcG9ydC0+dGNfbW9kZSkgeworCWNhc2UgVENfUE9SVF9EUF9BTFQ6CisJCWxuMCAm
PSB+KERLTF9EUF9NT0RFX0NGR19EUF9YMV9NT0RFIHwgREtMX0RQX01PREVfQ0ZHX0RQX1gxX01P
REUpOworCQlsbjEgJj0gfihES0xfRFBfTU9ERV9DRkdfRFBfWDFfTU9ERSB8IERLTF9EUF9NT0RF
X0NGR19EUF9YMl9NT0RFKTsKKworCQlsYW5lX21hc2sgPSBpbnRlbF90Y19wb3J0X2dldF9sYW5l
X21hc2soaW50ZWxfZGlnX3BvcnQpOyAvKiBEUFg0VFhMQVRDICovCisJCXBpbl9tYXNrID0gaW50
ZWxfdGNfcG9ydF9nZXRfcGluX2Fzc2lnbm1lbnRfbWFzayhpbnRlbF9kaWdfcG9ydCk7IC8qIERQ
UEFUQyAqLworCisJCXN3aXRjaCAocGluX21hc2spIHsKKwkJY2FzZSAweDA6CisJCQlpZiAobnVt
X2xhbmVzID09IDEpIHsKKwkJCQlsbjEgfD0gREtMX0RQX01PREVfQ0ZHX0RQX1gxX01PREU7CisJ
CQl9IGVsc2UgeworCQkJCWxuMCB8PSBES0xfRFBfTU9ERV9DRkdfRFBfWDJfTU9ERTsKKwkJCQls
bjEgfD0gREtMX0RQX01PREVfQ0ZHX0RQX1gyX01PREU7CisJCQl9CisJCQlicmVhazsKKwkJY2Fz
ZSAweDE6CisJCQlpZiAobnVtX2xhbmVzID09IDQpIHsKKwkJCQlsbjAgfD0gREtMX0RQX01PREVf
Q0ZHX0RQX1gyX01PREU7CisJCQkJbG4xIHw9IERLTF9EUF9NT0RFX0NGR19EUF9YMl9NT0RFOwor
CQkJfQorCQkJYnJlYWs7CisJCWNhc2UgMHgyOgorCQkJaWYgKG51bV9sYW5lcyA9PSAyKSB7CisJ
CQkJbG4wIHw9IERLTF9EUF9NT0RFX0NGR19EUF9YMl9NT0RFOworCQkJCWxuMSB8PSBES0xfRFBf
TU9ERV9DRkdfRFBfWDJfTU9ERTsKKwkJCX0KKwkJCWJyZWFrOworCQljYXNlIDB4MzoKKwkJY2Fz
ZSAweDU6CisJCQlpZiAobnVtX2xhbmVzID09IDEpIHsKKwkJCQlsbjAgfD0gREtMX0RQX01PREVf
Q0ZHX0RQX1gxX01PREU7CisJCQkJbG4xIHw9IERLTF9EUF9NT0RFX0NGR19EUF9YMV9NT0RFOwor
CQkJfSBlbHNlIHsKKwkJCQlsbjAgfD0gREtMX0RQX01PREVfQ0ZHX0RQX1gyX01PREU7CisJCQkJ
bG4xIHw9IERLTF9EUF9NT0RFX0NGR19EUF9YMl9NT0RFOworCQkJfQorCQkJYnJlYWs7CisJCWNh
c2UgMHg0OgorCQljYXNlIDB4NjoKKwkJCWlmIChudW1fbGFuZXMgPT0gMSkgeworCQkJCWxuMCB8
PSBES0xfRFBfTU9ERV9DRkdfRFBfWDFfTU9ERTsKKwkJCQlsbjEgfD0gREtMX0RQX01PREVfQ0ZH
X0RQX1gxX01PREU7CisJCQl9IGVsc2UgeworCQkJCWxuMCB8PSBES0xfRFBfTU9ERV9DRkdfRFBf
WDJfTU9ERTsKKwkJCQlsbjEgfD0gREtMX0RQX01PREVfQ0ZHX0RQX1gyX01PREU7CisJCQl9CisJ
CQlicmVhazsKKwkJZGVmYXVsdDoKKwkJCU1JU1NJTkdfQ0FTRShsYW5lX21hc2spOworCQl9CisJ
CWJyZWFrOworCisJY2FzZSBUQ19QT1JUX0xFR0FDWToKKwkJbG4wIHw9IERLTF9EUF9NT0RFX0NG
R19EUF9YMV9NT0RFIHwgREtMX0RQX01PREVfQ0ZHX0RQX1gyX01PREU7CisJCWxuMSB8PSBES0xf
RFBfTU9ERV9DRkdfRFBfWDFfTU9ERSB8IERLTF9EUF9NT0RFX0NGR19EUF9YMl9NT0RFOworCQli
cmVhazsKKworCWRlZmF1bHQ6CisJCU1JU1NJTkdfQ0FTRShpbnRlbF9kaWdfcG9ydC0+dGNfbW9k
ZSk7CisJCXJldHVybjsKKwl9CisKKwlJOTE1X1dSSVRFKEhJUF9JTkRFWF9SRUcodGNfcG9ydCks
IDB4MCk7CisJSTkxNV9XUklURShES0xfRFBfTU9ERSh0Y19wb3J0KSwgbG4wKTsKKwlJOTE1X1dS
SVRFKEhJUF9JTkRFWF9SRUcodGNfcG9ydCksIDB4MSk7CisJSTkxNV9XUklURShES0xfRFBfTU9E
RSh0Y19wb3J0KSwgbG4xKTsKK30KKwogc3RhdGljIHZvaWQgaW50ZWxfZHBfc2lua19zZXRfZmVj
X3JlYWR5KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCQkJCWNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewpAQCAtMzIzOSw3ICszNDQ2LDcgQEAgc3RhdGlj
IHZvaWQgdGdsX2RkaV9wcmVfZW5hYmxlX2RwKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
LAogCQkJCQlkaWdfcG9ydC0+ZGRpX2lvX3Bvd2VyX2RvbWFpbik7CiAKIAkvKiA2LiAqLwotCWlj
bF9wcm9ncmFtX21nX2RwX21vZGUoZGlnX3BvcnQpOworCXRnbF9wcm9ncmFtX2RrbF9kcF9tb2Rl
KGRpZ19wb3J0KTsKIAogCS8qCiAJICogNy5hIC0gU3RlcHMgaW4gdGhpcyBmdW5jdGlvbiBzaG91
bGQgb25seSBiZSBleGVjdXRlZCBvdmVyIE1TVApAQCAtMzI1MiwxMCArMzQ1OSwxMCBAQCBzdGF0
aWMgdm9pZCB0Z2xfZGRpX3ByZV9lbmFibGVfZHAoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29k
ZXIsCiAJaW50ZWxfZGRpX2NvbmZpZ190cmFuc2NvZGVyX2Z1bmMoY3J0Y19zdGF0ZSk7CiAKIAkv
KiA3LmQgKi8KLQlpY2xfZGlzYWJsZV9waHlfY2xvY2tfZ2F0aW5nKGRpZ19wb3J0KTsKKwl0Z2xf
cGh5X2Nsb2NrX2dhdGluZyhkaWdfcG9ydCwgZmFsc2UpOwogCiAJLyogNy5lICovCi0JaWNsX2Rk
aV92c3dpbmdfc2VxdWVuY2UoZW5jb2RlciwgY3J0Y19zdGF0ZS0+cG9ydF9jbG9jaywgbGV2ZWws
CisJdGdsX2RkaV92c3dpbmdfc2VxdWVuY2UoZW5jb2RlciwgY3J0Y19zdGF0ZS0+cG9ydF9jbG9j
aywgbGV2ZWwsCiAJCQkJZW5jb2Rlci0+dHlwZSk7CiAKIAkvKiA3LmYgKi8KQEAgLTMyODcsNiAr
MzQ5NCwxNSBAQCBzdGF0aWMgdm9pZCB0Z2xfZGRpX3ByZV9lbmFibGVfZHAoc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIsCiAJLyogNy5rICovCiAJaW50ZWxfZHBfc3RvcF9saW5rX3RyYWlu
KGludGVsX2RwKTsKIAorCS8qCisJICogVE9ETzogZW5hYmxlIGNsb2NrIGdhdGluZworCSAqCisJ
ICogSXQgaXMgbm90IHdyaXR0ZW4gaW4gRFAgZW5hYmxpbmcgc2VxdWVuY2UgYnV0ICJQSFkgQ2xv
Y2tnYXRpbmcKKwkgKiBwcm9ncmFtbWluZyIgc3RhdGVzIHRoYXQgY2xvY2sgZ2F0aW5nIHNob3Vs
ZCBiZSBlbmFibGVkIGFmdGVyIHRoZQorCSAqIGxpbmsgdHJhaW5pbmcgYnV0IGRvaW5nIHNvIGNh
dXNlcyBhbGwgdGhlIGZvbGxvd2luZyB0cmFpbmluZ3MgdG8gZmFpbAorCSAqIHNvIG5vdCBlbmFi
bGluZyBpdCBmb3IuCisJICovCisKIAkvKiA3LmwgKi8KIAlpbnRlbF9kZGlfZW5hYmxlX2ZlYyhl
bmNvZGVyLCBjcnRjX3N0YXRlKTsKIAlpbnRlbF9kc2NfZW5hYmxlKGVuY29kZXIsIGNydGNfc3Rh
dGUpOwpAQCAtMzM5Miw3ICszNjA4LDEwIEBAIHN0YXRpYyB2b2lkIGludGVsX2RkaV9wcmVfZW5h
YmxlX2hkbWkoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJaW50ZWxfZGlzcGxheV9w
b3dlcl9nZXQoZGV2X3ByaXYsIGRpZ19wb3J0LT5kZGlfaW9fcG93ZXJfZG9tYWluKTsKIAogCWlj
bF9wcm9ncmFtX21nX2RwX21vZGUoZGlnX3BvcnQpOwotCWljbF9kaXNhYmxlX3BoeV9jbG9ja19n
YXRpbmcoZGlnX3BvcnQpOworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKQorCQl0Z2xf
cGh5X2Nsb2NrX2dhdGluZyhkaWdfcG9ydCwgZmFsc2UpOworCWVsc2UKKwkJaWNsX2Rpc2FibGVf
cGh5X2Nsb2NrX2dhdGluZyhkaWdfcG9ydCk7CiAKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSAxMSkKIAkJaWNsX2RkaV92c3dpbmdfc2VxdWVuY2UoZW5jb2RlciwgY3J0Y19zdGF0ZS0+cG9y
dF9jbG9jaywKQEAgLTM0MDQsNyArMzYyMywxMCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kZGlfcHJl
X2VuYWJsZV9oZG1pKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCWVsc2UKIAkJaW50
ZWxfcHJlcGFyZV9oZG1pX2RkaV9idWZmZXJzKGVuY29kZXIsIGxldmVsKTsKIAotCWljbF9lbmFi
bGVfcGh5X2Nsb2NrX2dhdGluZyhkaWdfcG9ydCk7CisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikg
Pj0gMTIpCisJCXRnbF9waHlfY2xvY2tfZ2F0aW5nKGRpZ19wb3J0LCB0cnVlKTsKKwllbHNlCisJ
CWljbF9lbmFibGVfcGh5X2Nsb2NrX2dhdGluZyhkaWdfcG9ydCk7CiAKIAlpZiAoSVNfR0VOOV9C
QyhkZXZfcHJpdikpCiAJCXNrbF9kZGlfc2V0X2lib29zdChlbmNvZGVyLCBsZXZlbCwgSU5URUxf
T1VUUFVUX0hETUkpOwotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5m
cmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0
aW5mby9pbnRlbC1nZng=

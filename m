Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 762ED9B0DB
	for <lists+intel-gfx@lfdr.de>; Fri, 23 Aug 2019 15:27:13 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7CF3A6EC8E;
	Fri, 23 Aug 2019 13:27:11 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 990EB6EC8D
 for <intel-gfx@lists.freedesktop.org>; Fri, 23 Aug 2019 13:27:07 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18240606-1500050 
 for multiple; Fri, 23 Aug 2019 14:27:04 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 23 Aug 2019 14:26:57 +0100
Message-Id: <20190823132700.25286-13-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190823132700.25286-1-chris@chris-wilson.co.uk>
References: <20190823132700.25286-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 12/15] drm/i915: Coordinate i915_active with its
 own mutex
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Rm9yZ28gdGhlIHN0cnVjdF9tdXRleCBzZXJpYWxpc2F0aW9uIGZvciBpOTE1X2FjdGl2ZSwgYW5k
IGludGVycG9zZSBpdHMKb3duIG11dGV4IGhhbmRsaW5nIGZvciBhY3RpdmUvcmV0aXJlLgoKVGhp
cyBpcyBhIG11bHRpLWxheWVyZWQgc2xlaWdodC1vZi1oYW5kLiBGaXJzdCwgd2UgaGFkIHRvIGVu
c3VyZSB0aGF0IG5vCmFjdGl2ZS9yZXRpcmUgY2FsbGJhY2tzIGFjY2lkZW50YWxseSBpbnZlcnRl
ZCB0aGUgbXV0ZXggb3JkZXJpbmcgcnVsZXMsCm5vciBhc3N1bWVkIHRoYXQgdGhleSB3ZXJlIHRo
ZW1zZWx2ZXMgc2VyaWFsaXNlZCBieSBzdHJ1Y3RfbXV0ZXguIE1vcmUKY2hhbGxlbmdpbmcgdGhv
dWdoLCBpcyB0aGUgcnVsZSBvdmVyIHVwZGF0aW5nIGVsZW1lbnRzIG9mIHRoZSBhY3RpdmUKcmJ0
cmVlLiBJbnN0ZWFkIG9mIHRoZSB3aG9sZSBpOTE1X2FjdGl2ZSBub3cgYmVpbmcgc2VyaWFsaXNl
ZCBieQpzdHJ1Y3RfbXV0ZXgsIGFsbG9jYXRpb25zL3JvdGF0aW9ucyBvZiB0aGUgdHJlZSBhcmUg
c2VyaWFsaXNlZCBieSB0aGUKaTkxNV9hY3RpdmUubXV0ZXggYW5kIGluZGl2aWR1YWwgbm9kZXMg
YXJlIHNlcmlhbGlzZWQgYnkgdGhlIGNhbGxlcgp1c2luZyB0aGUgaTkxNV90aW1lbGluZS5tdXRl
eCAod2UgbmVlZCB0byB1c2UgbmVzdGVkIHNwaW5sb2NrcyB0bwppbnRlcmFjdCB3aXRoIHRoZSBk
bWFfZmVuY2UgY2FsbGJhY2sgbGlzdHMpLgoKVGhlIHBhaW4gcG9pbnQgaGVyZSBpcyB0aGF0IGlu
c3RlYWQgb2YgYSBzaW5nbGUgbXV0ZXggYXJvdW5kIGV4ZWNidWYsIHdlCm5vdyBoYXZlIHRvIHRh
a2UgYSBtdXRleCBmb3IgYWN0aXZlIHRyYWNrZXIgKG9uZSBmb3IgZWFjaCB2bWEsIGNvbnRleHQs
CmV0YykgYW5kIGEgY291cGxlIG9mIHNwaW5sb2NrcyBmb3IgZWFjaCBmZW5jZSB1cGRhdGUuIFRo
ZSBpbXByb3ZlbWVudCBpbgpmaW5lIGdyYWluZWQgbG9ja2luZyBhbGxvd2luZyBmb3IgbXVsdGlw
bGUgY29uY3VycmVudCBjbGllbnRzCihldmVudHVhbGx5ISkgc2hvdWxkIGJlIHdvcnRoIGl0IGlu
IHR5cGljYWwgbG9hZHMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlz
LXdpbHNvbi5jby51az4KLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZnJvbnRi
dWZmZXIuYyAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3Zl
cmxheS5jICB8ICAgNSArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2Js
dC5jICAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4
dC5jICAgfCAgIDggKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIu
YyAgICB8ICAgMiArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVz
LmggIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jICAgICAg
ICB8ICAgOSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jICAgICAg
IHwgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG9vbC5jICAg
fCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sLmggICB8
ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYyAgICAgICAgIHwg
IDEwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF90aW1lbGluZS5jICAgICAgfCAg
IDkgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmVfdHlwZXMuaCAgICB8ICAg
MiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jICAgIHwgIDE2
ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYyAgICAgICAgfCAgMTAg
Ky0KIC4uLi9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RzL21vY2tfdGltZWxpbmUuYyB8ICAgMiAr
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jICAgICAgICAgIHwgICAzIC0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMgICAgICAgICAgICB8IDI1NiArKysr
KystLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaCAgICAgICAgICAg
IHwgMzE1ICsrKystLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3Rp
dmVfdHlwZXMuaCAgICAgIHwgIDIwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5j
ICAgICAgICAgICAgICAgfCAgNDIgKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9n
dHQuYyAgICAgICAgICAgfCAgIDMgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vy
cm9yLmMgICAgICAgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0
LmMgICAgICAgICAgIHwgIDM5ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0
LmggICAgICAgICAgIHwgICAxIC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMgICAg
ICAgICAgICAgICB8ICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVf
YWN0aXZlLmMgIHwgIDM2ICstCiAyNyBmaWxlcyBjaGFuZ2VkLCAyNTYgaW5zZXJ0aW9ucygrKSwg
NTU5IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZnJvbnRidWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZnJvbnRidWZmZXIuYwppbmRleCBkNjI4MTBjMTI1NmEuLmVlYjU5NjQ3OTdhNyAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mcm9udGJ1ZmZlci5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZnJvbnRidWZmZXIuYwpAQCAt
MjUwLDcgKzI1MCw3IEBAIGludGVsX2Zyb250YnVmZmVyX2dldChzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqKQogCWZyb250LT5vYmogPSBvYmo7CiAJa3JlZl9pbml0KCZmcm9udC0+cmVm
KTsKIAlhdG9taWNfc2V0KCZmcm9udC0+Yml0cywgMCk7Ci0JaTkxNV9hY3RpdmVfaW5pdChpOTE1
LCAmZnJvbnQtPndyaXRlLAorCWk5MTVfYWN0aXZlX2luaXQoJmZyb250LT53cml0ZSwKIAkJCSBm
cm9udGJ1ZmZlcl9hY3RpdmUsCiAJCQkgaTkxNV9hY3RpdmVfbWF5X3NsZWVwKGZyb250YnVmZmVy
X3JldGlyZSkpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX292ZXJsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3Zlcmxh
eS5jCmluZGV4IDRmMzY1NTdiM2YzYi4uNTQ0ZTk1MzM0MmVhIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYwpAQCAtMjMwLDcgKzIzMCw3IEBAIGFsbG9j
X3JlcXVlc3Qoc3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJsYXksIHZvaWQgKCpmbikoc3RydWN0
IGludGVsX292ZXJsYXkgKikpCiAJaWYgKElTX0VSUihycSkpCiAJCXJldHVybiBycTsKIAotCWVy
ciA9IGk5MTVfYWN0aXZlX3JlZigmb3ZlcmxheS0+bGFzdF9mbGlwLCBycS0+dGltZWxpbmUsIHJx
KTsKKwllcnIgPSBpOTE1X2FjdGl2ZV9yZWYoJm92ZXJsYXktPmxhc3RfZmxpcCwgcnEtPnRpbWVs
aW5lLCAmcnEtPmZlbmNlKTsKIAlpZiAoZXJyKSB7CiAJCWk5MTVfcmVxdWVzdF9hZGQocnEpOwog
CQlyZXR1cm4gRVJSX1BUUihlcnIpOwpAQCAtMTM2MCw4ICsxMzYwLDcgQEAgdm9pZCBpbnRlbF9v
dmVybGF5X3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlvdmVybGF5
LT5jb250cmFzdCA9IDc1OwogCW92ZXJsYXktPnNhdHVyYXRpb24gPSAxNDY7CiAKLQlpOTE1X2Fj
dGl2ZV9pbml0KGRldl9wcml2LAotCQkJICZvdmVybGF5LT5sYXN0X2ZsaXAsCisJaTkxNV9hY3Rp
dmVfaW5pdCgmb3ZlcmxheS0+bGFzdF9mbGlwLAogCQkJIE5VTEwsIGludGVsX292ZXJsYXlfbGFz
dF9mbGlwX3JldGlyZSk7CiAKIAlyZXQgPSBnZXRfcmVnaXN0ZXJzKG92ZXJsYXksIE9WRVJMQVlf
TkVFRFNfUEhZU0lDQUwoZGV2X3ByaXYpKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fY2xpZW50X2JsdC5jCmluZGV4IGY5OTkyMDY1Mjc1MS4uYzM0NWQzZDYyZGYxIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2JsdC5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMKQEAg
LTIxMSw3ICsyMTEsNyBAQCBzdGF0aWMgdm9pZCBjbGVhcl9wYWdlc193b3JrZXIoc3RydWN0IHdv
cmtfc3RydWN0ICp3b3JrKQogCSAqIGtlZXAgdHJhY2sgb2YgdGhlIEdQVSBhY3Rpdml0eSB3aXRo
aW4gdGhpcyB2bWEvcmVxdWVzdCwgYW5kCiAJICogcHJvcGFnYXRlIHRoZSBzaWduYWwgZnJvbSB0
aGUgcmVxdWVzdCB0byB3LT5kbWEuCiAJICovCi0JZXJyID0gaTkxNV9hY3RpdmVfcmVmKCZ2bWEt
PmFjdGl2ZSwgcnEtPnRpbWVsaW5lLCBycSk7CisJZXJyID0gaTkxNV9hY3RpdmVfcmVmKCZ2bWEt
PmFjdGl2ZSwgcnEtPnRpbWVsaW5lLCAmcnEtPmZlbmNlKTsKIAlpZiAoZXJyKQogCQlnb3RvIG91
dF9yZXF1ZXN0OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQu
YwppbmRleCA0ZGMzMGM2NDAzODAuLjA5NWVhNjQ3Yzg2MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCkBAIC04NjgsMjAgKzg2OCwxOCBAQCBzdGF0aWMg
aW50IGNvbnRleHRfYmFycmllcl90YXNrKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJ
CQkJdm9pZCAoKnRhc2spKHZvaWQgKmRhdGEpLAogCQkJCXZvaWQgKmRhdGEpCiB7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBjdHgtPmk5MTU7CiAJc3RydWN0IGNvbnRleHRfYmFy
cmllcl90YXNrICpjYjsKIAlzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lc19pdGVyIGl0OwogCXN0cnVj
dCBpbnRlbF9jb250ZXh0ICpjZTsKIAlpbnQgZXJyID0gMDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hl
bGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCUdFTV9CVUdfT04oIXRhc2spOwogCiAJY2Ig
PSBrbWFsbG9jKHNpemVvZigqY2IpLCBHRlBfS0VSTkVMKTsKIAlpZiAoIWNiKQogCQlyZXR1cm4g
LUVOT01FTTsKIAotCWk5MTVfYWN0aXZlX2luaXQoaTkxNSwgJmNiLT5iYXNlLCBOVUxMLCBjYl9y
ZXRpcmUpOworCWk5MTVfYWN0aXZlX2luaXQoJmNiLT5iYXNlLCBOVUxMLCBjYl9yZXRpcmUpOwog
CWVyciA9IGk5MTVfYWN0aXZlX2FjcXVpcmUoJmNiLT5iYXNlKTsKIAlpZiAoZXJyKSB7CiAJCWtm
cmVlKGNiKTsKQEAgLTkxMyw3ICs5MTEsOSBAQCBzdGF0aWMgaW50IGNvbnRleHRfYmFycmllcl90
YXNrKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCWlmIChlbWl0KQogCQkJZXJyID0g
ZW1pdChycSwgZGF0YSk7CiAJCWlmIChlcnIgPT0gMCkKLQkJCWVyciA9IGk5MTVfYWN0aXZlX3Jl
ZigmY2ItPmJhc2UsIHJxLT50aW1lbGluZSwgcnEpOworCQkJZXJyID0gaTkxNV9hY3RpdmVfcmVm
KCZjYi0+YmFzZSwKKwkJCQkJICAgICAgcnEtPnRpbWVsaW5lLAorCQkJCQkgICAgICAmcnEtPmZl
bmNlKTsKIAogCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKIAkJaWYgKGVycikKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCmluZGV4IDA1YTNlMjQyNDhh
NS4uMmFjMjZmYjYzMDAzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fZXhlY2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9leGVjYnVmZmVyLmMKQEAgLTEyNjgsNyArMTI2OCw3IEBAIHJlbG9jYXRlX2VudHJ5KHN0cnVj
dCBpOTE1X3ZtYSAqdm1hLAogCiAJaWYgKCFlYi0+cmVsb2NfY2FjaGUudmFkZHIgJiYKIAkgICAg
KERCR19GT1JDRV9SRUxPQyA9PSBGT1JDRV9HUFVfUkVMT0MgfHwKLQkgICAgICFkbWFfcmVzdl90
ZXN0X3NpZ25hbGVkX3JjdSh2bWEtPnJlc3YsIHRydWUpKSkgeworCSAgICAgaTkxNV92bWFfaXNf
YWN0aXZlKHZtYSkpKSB7CiAJCWNvbnN0IHVuc2lnbmVkIGludCBnZW4gPSBlYi0+cmVsb2NfY2Fj
aGUuZ2VuOwogCQl1bnNpZ25lZCBpbnQgbGVuOwogCQl1MzIgKmJhdGNoOwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oCmluZGV4IGEwOWU3NGUy
NzczNC4uODY1MDliZWMzYTFhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fb2JqZWN0X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX29iamVjdF90eXBlcy5oCkBAIC04LDYgKzgsNyBAQAogI2RlZmluZSBfX0k5MTVfR0VN
X09CSkVDVF9UWVBFU19IX18KIAogI2luY2x1ZGUgPGRybS9kcm1fZ2VtLmg+CisjaW5jbHVkZSA8
dWFwaS9kcm0vaTkxNV9kcm0uaD4KIAogI2luY2x1ZGUgImk5MTVfYWN0aXZlLmgiCiAjaW5jbHVk
ZSAiaTkxNV9zZWxmdGVzdC5oIgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYwpp
bmRleCA5MmU1M2MyNTQyNGMuLjkyNTU4ZmE0NzEwOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX3BtLmMKQEAgLTE2LDE0ICsxNiwxMSBAQCBzdGF0aWMgdm9pZCBjYWxsX2lkbGVf
YmFycmllcnMoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCXN0cnVjdCBsbGlzdF9u
b2RlICpub2RlLCAqbmV4dDsKIAogCWxsaXN0X2Zvcl9lYWNoX3NhZmUobm9kZSwgbmV4dCwgbGxp
c3RfZGVsX2FsbCgmZW5naW5lLT5iYXJyaWVyX3Rhc2tzKSkgewotCQlzdHJ1Y3QgaTkxNV9hY3Rp
dmVfcmVxdWVzdCAqYWN0aXZlID0KKwkJc3RydWN0IGRtYV9mZW5jZV9jYiAqY2IgPQogCQkJY29u
dGFpbmVyX29mKChzdHJ1Y3QgbGlzdF9oZWFkICopbm9kZSwKLQkJCQkgICAgIHR5cGVvZigqYWN0
aXZlKSwgbGluayk7CisJCQkJICAgICB0eXBlb2YoKmNiKSwgbm9kZSk7CiAKLQkJSU5JVF9MSVNU
X0hFQUQoJmFjdGl2ZS0+bGluayk7Ci0JCVJDVV9JTklUX1BPSU5URVIoYWN0aXZlLT5yZXF1ZXN0
LCBOVUxMKTsKLQotCQlhY3RpdmUtPnJldGlyZShhY3RpdmUsIE5VTEwpOworCQljYi0+ZnVuYyhO
VUxMLCBjYik7CiAJfQogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMK
aW5kZXggYWU3YzI2ODllZjMwLi41N2UxM2M2ZjU5YzUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9jb250ZXh0LmMKQEAgLTI0MCw3ICsyNDAsNyBAQCBpbnRlbF9jb250ZXh0X2luaXQo
c3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCiAJbXV0ZXhfaW5pdCgmY2UtPnBpbl9tdXRleCk7
CiAKLQlpOTE1X2FjdGl2ZV9pbml0KGN0eC0+aTkxNSwgJmNlLT5hY3RpdmUsCisJaTkxNV9hY3Rp
dmVfaW5pdCgmY2UtPmFjdGl2ZSwKIAkJCSBfX2ludGVsX2NvbnRleHRfYWN0aXZlLCBfX2ludGVs
X2NvbnRleHRfcmV0aXJlKTsKIH0KIApAQCAtMzA3LDcgKzMwNyw3IEBAIGludCBpbnRlbF9jb250
ZXh0X3ByZXBhcmVfcmVtb3RlX3JlcXVlc3Qoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCQkJ
cmV0dXJuIGVycjsKIAogCQkvKiBRdWV1ZSB0aGlzIHN3aXRjaCBhZnRlciBjdXJyZW50IGFjdGl2
aXR5IGJ5IHRoaXMgY29udGV4dC4gKi8KLQkJZXJyID0gaTkxNV9hY3RpdmVfcmVxdWVzdF9zZXQo
JnRsLT5sYXN0X3JlcXVlc3QsIHJxKTsKKwkJZXJyID0gaTkxNV9hY3RpdmVfZmVuY2Vfc2V0KCZ0
bC0+bGFzdF9yZXF1ZXN0LCBycSk7CiAJCW11dGV4X3VubG9jaygmdGwtPm11dGV4KTsKIAkJaWYg
KGVycikKIAkJCXJldHVybiBlcnI7CkBAIC0zMjEsNyArMzIxLDcgQEAgaW50IGludGVsX2NvbnRl
eHRfcHJlcGFyZV9yZW1vdGVfcmVxdWVzdChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJICog
d29yZHMgdHJhbnNmZXIgdGhlIHBpbm5lZCBjZSBvYmplY3QgdG8gdHJhY2tlZCBhY3RpdmUgcmVx
dWVzdC4KIAkgKi8KIAlHRU1fQlVHX09OKGk5MTVfYWN0aXZlX2lzX2lkbGUoJmNlLT5hY3RpdmUp
KTsKLQlyZXR1cm4gaTkxNV9hY3RpdmVfcmVmKCZjZS0+YWN0aXZlLCBycS0+dGltZWxpbmUsIHJx
KTsKKwlyZXR1cm4gaTkxNV9hY3RpdmVfcmVmKCZjZS0+YWN0aXZlLCBycS0+dGltZWxpbmUsICZy
cS0+ZmVuY2UpOwogfQogCiBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICppbnRlbF9jb250ZXh0X2NyZWF0
ZV9yZXF1ZXN0KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9lbmdpbmVfcG9vbC5jCmluZGV4IDM2ZmE4YjdlNTI0ZC4uMjViMDVjM2RiNjM3
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG9vbC5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sLmMKQEAgLTk1
LDcgKzk1LDcgQEAgbm9kZV9jcmVhdGUoc3RydWN0IGludGVsX2VuZ2luZV9wb29sICpwb29sLCBz
aXplX3Qgc3opCiAJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwogCiAJbm9kZS0+cG9vbCA9IHBv
b2w7Ci0JaTkxNV9hY3RpdmVfaW5pdChlbmdpbmUtPmk5MTUsICZub2RlLT5hY3RpdmUsIHBvb2xf
YWN0aXZlLCBwb29sX3JldGlyZSk7CisJaTkxNV9hY3RpdmVfaW5pdCgmbm9kZS0+YWN0aXZlLCBw
b29sX2FjdGl2ZSwgcG9vbF9yZXRpcmUpOwogCiAJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0
ZV9pbnRlcm5hbChlbmdpbmUtPmk5MTUsIHN6KTsKIAlpZiAoSVNfRVJSKG9iaikpIHsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sLmggYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG9vbC5oCmluZGV4IDhkMDY5ZWZkOTQ1
Ny4uN2U4MzQ1OWI4ZGE2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9lbmdpbmVfcG9vbC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2lu
ZV9wb29sLmgKQEAgLTE4LDcgKzE4LDcgQEAgc3RhdGljIGlubGluZSBpbnQKIGludGVsX2VuZ2lu
ZV9wb29sX21hcmtfYWN0aXZlKHN0cnVjdCBpbnRlbF9lbmdpbmVfcG9vbF9ub2RlICpub2RlLAog
CQkJICAgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7Ci0JcmV0dXJuIGk5MTVfYWN0aXZl
X3JlZigmbm9kZS0+YWN0aXZlLCBycS0+dGltZWxpbmUsIHJxKTsKKwlyZXR1cm4gaTkxNV9hY3Rp
dmVfcmVmKCZub2RlLT5hY3RpdmUsIHJxLT50aW1lbGluZSwgJnJxLT5mZW5jZSk7CiB9CiAKIHN0
YXRpYyBpbmxpbmUgdm9pZApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfcmVzZXQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMKaW5kZXgg
YjlkODRkNTJlOTg2Li40ODI1YzgyYWVmZWUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX3Jlc2V0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
cmVzZXQuYwpAQCAtODE0LDEwICs4MTQsMTAgQEAgc3RhdGljIGJvb2wgX19pbnRlbF9ndF91bnNl
dF93ZWRnZWQoc3RydWN0IGludGVsX2d0ICpndCkKIAkgKi8KIAlzcGluX2xvY2tfaXJxc2F2ZSgm
dGltZWxpbmVzLT5sb2NrLCBmbGFncyk7CiAJbGlzdF9mb3JfZWFjaF9lbnRyeSh0bCwgJnRpbWVs
aW5lcy0+YWN0aXZlX2xpc3QsIGxpbmspIHsKLQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJ
CXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlOwogCi0JCXJxID0gaTkxNV9hY3RpdmVfcmVxdWVzdF9n
ZXRfdW5sb2NrZWQoJnRsLT5sYXN0X3JlcXVlc3QpOwotCQlpZiAoIXJxKQorCQlmZW5jZSA9IGk5
MTVfYWN0aXZlX2ZlbmNlX2dldCgmdGwtPmxhc3RfcmVxdWVzdCk7CisJCWlmICghZmVuY2UpCiAJ
CQljb250aW51ZTsKIAogCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZ0aW1lbGluZXMtPmxvY2ss
IGZsYWdzKTsKQEAgLTgyOSw4ICs4MjksOCBAQCBzdGF0aWMgYm9vbCBfX2ludGVsX2d0X3Vuc2V0
X3dlZGdlZChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogCQkgKiAoSTkxNV9GRU5DRV9USU1FT1VUKSBz
byB0aGlzIHdhaXQgc2hvdWxkIG5vdCBiZSB1bmJvdW5kZWQKIAkJICogaW4gdGhlIHdvcnN0IGNh
c2UuCiAJCSAqLwotCQlkbWFfZmVuY2VfZGVmYXVsdF93YWl0KCZycS0+ZmVuY2UsIGZhbHNlLCBN
QVhfU0NIRURVTEVfVElNRU9VVCk7Ci0JCWk5MTVfcmVxdWVzdF9wdXQocnEpOworCQlkbWFfZmVu
Y2VfZGVmYXVsdF93YWl0KGZlbmNlLCBmYWxzZSwgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOworCQlk
bWFfZmVuY2VfcHV0KGZlbmNlKTsKIAogCQkvKiBSZXN0YXJ0IGl0ZXJhdGlvbiBhZnRlciBkcm9w
aW5nIGxvY2sgKi8KIAkJc3Bpbl9sb2NrX2lycXNhdmUoJnRpbWVsaW5lcy0+bG9jaywgZmxhZ3Mp
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmUuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lLmMKaW5kZXggZDgyNGJjYTQz
ZDU1Li43NWQ4OTYxNjdjZmIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX3RpbWVsaW5lLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxp
bmUuYwpAQCAtMTc4LDggKzE3OCw3IEBAIGNhY2hlbGluZV9hbGxvYyhzdHJ1Y3QgaW50ZWxfdGlt
ZWxpbmVfaHdzcCAqaHdzcCwgdW5zaWduZWQgaW50IGNhY2hlbGluZSkKIAljbC0+aHdzcCA9IGh3
c3A7CiAJY2wtPnZhZGRyID0gcGFnZV9wYWNrX2JpdHModmFkZHIsIGNhY2hlbGluZSk7CiAKLQlp
OTE1X2FjdGl2ZV9pbml0KGh3c3AtPmd0LT5pOTE1LCAmY2wtPmFjdGl2ZSwKLQkJCSBfX2NhY2hl
bGluZV9hY3RpdmUsIF9fY2FjaGVsaW5lX3JldGlyZSk7CisJaTkxNV9hY3RpdmVfaW5pdCgmY2wt
PmFjdGl2ZSwgX19jYWNoZWxpbmVfYWN0aXZlLCBfX2NhY2hlbGluZV9yZXRpcmUpOwogCiAJcmV0
dXJuIGNsOwogfQpAQCAtMjU1LDcgKzI1NCw3IEBAIGludCBpbnRlbF90aW1lbGluZV9pbml0KHN0
cnVjdCBpbnRlbF90aW1lbGluZSAqdGltZWxpbmUsCiAKIAltdXRleF9pbml0KCZ0aW1lbGluZS0+
bXV0ZXgpOwogCi0JSU5JVF9BQ1RJVkVfUkVRVUVTVCgmdGltZWxpbmUtPmxhc3RfcmVxdWVzdCwg
JnRpbWVsaW5lLT5tdXRleCk7CisJSU5JVF9BQ1RJVkVfRkVOQ0UoJnRpbWVsaW5lLT5sYXN0X3Jl
cXVlc3QsICZ0aW1lbGluZS0+bXV0ZXgpOwogCUlOSVRfTElTVF9IRUFEKCZ0aW1lbGluZS0+cmVx
dWVzdHMpOwogCiAJaTkxNV9zeW5jbWFwX2luaXQoJnRpbWVsaW5lLT5zeW5jKTsKQEAgLTQ0Myw3
ICs0NDIsNyBAQCBfX2ludGVsX3RpbWVsaW5lX2dldF9zZXFubyhzdHJ1Y3QgaW50ZWxfdGltZWxp
bmUgKnRsLAogCSAqIGZyZWUgaXQgYWZ0ZXIgdGhlIGN1cnJlbnQgcmVxdWVzdCBpcyByZXRpcmVk
LCB3aGljaCBlbnN1cmVzIHRoYXQKIAkgKiBhbGwgd3JpdGVzIGludG8gdGhlIGNhY2hlbGluZSBm
cm9tIHByZXZpb3VzIHJlcXVlc3RzIGFyZSBjb21wbGV0ZS4KIAkgKi8KLQllcnIgPSBpOTE1X2Fj
dGl2ZV9yZWYoJnRsLT5od3NwX2NhY2hlbGluZS0+YWN0aXZlLCB0bCwgcnEpOworCWVyciA9IGk5
MTVfYWN0aXZlX3JlZigmdGwtPmh3c3BfY2FjaGVsaW5lLT5hY3RpdmUsIHRsLCAmcnEtPmZlbmNl
KTsKIAlpZiAoZXJyKQogCQlnb3RvIGVycl9jYWNoZWxpbmU7CiAKQEAgLTQ5NCw3ICs0OTMsNyBA
QCBpbnQgaW50ZWxfdGltZWxpbmVfZ2V0X3NlcW5vKHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGws
CiBzdGF0aWMgaW50IGNhY2hlbGluZV9yZWYoc3RydWN0IGludGVsX3RpbWVsaW5lX2NhY2hlbGlu
ZSAqY2wsCiAJCQkgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7Ci0JcmV0dXJuIGk5MTVfYWN0
aXZlX3JlZigmY2wtPmFjdGl2ZSwgcnEtPnRpbWVsaW5lLCBycSk7CisJcmV0dXJuIGk5MTVfYWN0
aXZlX3JlZigmY2wtPmFjdGl2ZSwgcnEtPnRpbWVsaW5lLCAmcnEtPmZlbmNlKTsKIH0KIAogaW50
IGludGVsX3RpbWVsaW5lX3JlYWRfaHdzcChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpmcm9tLApkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmVfdHlwZXMuaCBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lX3R5cGVzLmgKaW5kZXggMmIx
YmFmMmZjYzhlLi42ZDdhYzEyOWNlOGEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX3RpbWVsaW5lX3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfdGltZWxpbmVfdHlwZXMuaApAQCAtNjMsNyArNjMsNyBAQCBzdHJ1Y3QgaW50ZWxfdGlt
ZWxpbmUgewogCSAqIHRoZSByZXF1ZXN0IHVzaW5nIGk5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0X3Jl
cXVlc3RfcmN1KCksIG9yIGhvbGQgdGhlCiAJICogc3RydWN0X211dGV4LgogCSAqLwotCXN0cnVj
dCBpOTE1X2FjdGl2ZV9yZXF1ZXN0IGxhc3RfcmVxdWVzdDsKKwlzdHJ1Y3QgaTkxNV9hY3RpdmVf
ZmVuY2UgbGFzdF9yZXF1ZXN0OwogCiAJLyoqCiAJICogV2UgdHJhY2sgdGhlIG1vc3QgcmVjZW50
IHNlcW5vIHRoYXQgd2Ugd2FpdCBvbiBpbiBldmVyeSBjb250ZXh0IHNvCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKaW5kZXggOWQxZWEyNmM3YTJkLi4xNDIwNTMz
ZThmZDUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRl
eHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKQEAg
LTQxLDI0ICs0MSwyMCBAQCBzdGF0aWMgaW50IGNvbnRleHRfc3luYyhzdHJ1Y3QgaW50ZWxfY29u
dGV4dCAqY2UpCiAKIAltdXRleF9sb2NrKCZ0bC0+bXV0ZXgpOwogCWRvIHsKLQkJc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnE7CisJCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlOwogCQlsb25nIHRpbWVv
dXQ7CiAKLQkJcmN1X3JlYWRfbG9jaygpOwotCQlycSA9IHJjdV9kZXJlZmVyZW5jZSh0bC0+bGFz
dF9yZXF1ZXN0LnJlcXVlc3QpOwotCQlpZiAocnEpCi0JCQlycSA9IGk5MTVfcmVxdWVzdF9nZXRf
cmN1KHJxKTsKLQkJcmN1X3JlYWRfdW5sb2NrKCk7Ci0JCWlmICghcnEpCisJCWZlbmNlID0gaTkx
NV9hY3RpdmVfZmVuY2VfZ2V0KCZ0bC0+bGFzdF9yZXF1ZXN0KTsKKwkJaWYgKCFmZW5jZSkKIAkJ
CWJyZWFrOwogCi0JCXRpbWVvdXQgPSBpOTE1X3JlcXVlc3Rfd2FpdChycSwgMCwgSFogLyAxMCk7
CisJCXRpbWVvdXQgPSBkbWFfZmVuY2Vfd2FpdF90aW1lb3V0KGZlbmNlLCBmYWxzZSwgSFogLyAx
MCk7CiAJCWlmICh0aW1lb3V0IDwgMCkKIAkJCWVyciA9IHRpbWVvdXQ7CiAJCWVsc2UKLQkJCWk5
MTVfcmVxdWVzdF9yZXRpcmVfdXB0byhycSk7CisJCQlpOTE1X3JlcXVlc3RfcmV0aXJlX3VwdG8o
dG9fcmVxdWVzdChmZW5jZSkpOwogCi0JCWk5MTVfcmVxdWVzdF9wdXQocnEpOworCQlkbWFfZmVu
Y2VfcHV0KGZlbmNlKTsKIAl9IHdoaWxlICghZXJyKTsKIAltdXRleF91bmxvY2soJnRsLT5tdXRl
eCk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKaW5kZXggZDc5MTE1ODk4
OGQ2Li5hY2ExYjNhOWM1ZGUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Nl
bGZ0ZXN0X2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5j
CkBAIC05ODQsOSArOTg0LDEzIEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpkdW1teV9y
ZXF1ZXN0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAlpZiAoIXJxKQogCQlyZXR1
cm4gTlVMTDsKIAotCUlOSVRfTElTVF9IRUFEKCZycS0+YWN0aXZlX2xpc3QpOwogCXJxLT5lbmdp
bmUgPSBlbmdpbmU7CiAKKwlzcGluX2xvY2tfaW5pdCgmcnEtPmxvY2spOworCUlOSVRfTElTVF9I
RUFEKCZycS0+ZmVuY2UuY2JfbGlzdCk7CisJcnEtPmZlbmNlLmxvY2sgPSAmcnEtPmxvY2s7CisJ
cnEtPmZlbmNlLm9wcyA9ICZpOTE1X2ZlbmNlX29wczsKKwogCWk5MTVfc2NoZWRfbm9kZV9pbml0
KCZycS0+c2NoZWQpOwogCiAJLyogbWFyayB0aGlzIHJlcXVlc3QgYXMgcGVybWFuZW50bHkgaW5j
b21wbGV0ZSAqLwpAQCAtMTA3OSw4ICsxMDgzLDggQEAgc3RhdGljIGludCBsaXZlX3N1cHByZXNz
X3dhaXRfcHJlZW1wdCh2b2lkICphcmcpCiAJCQkJfQogCiAJCQkJLyogRGlzYWJsZSBORVdDTElF
TlQgcHJvbW90aW9uICovCi0JCQkJX19pOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldCgmcnFbaV0tPnRp
bWVsaW5lLT5sYXN0X3JlcXVlc3QsCi0JCQkJCQkJICBkdW1teSk7CisJCQkJX19pOTE1X2FjdGl2
ZV9mZW5jZV9zZXQoJnJxW2ldLT50aW1lbGluZS0+bGFzdF9yZXF1ZXN0LAorCQkJCQkJCSZkdW1t
eS0+ZmVuY2UpOwogCQkJCWk5MTVfcmVxdWVzdF9hZGQocnFbaV0pOwogCQkJfQogCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdHMvbW9ja190aW1lbGluZS5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RzL21vY2tfdGltZWxpbmUuYwppbmRleCA1
OTgxNzBlZmNhZjYuLjJhNzdjMDUxZjM2YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Qvc2VsZnRlc3RzL21vY2tfdGltZWxpbmUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdHMvbW9ja190aW1lbGluZS5jCkBAIC0xNSw3ICsxNSw3IEBAIHZvaWQgbW9j
a190aW1lbGluZV9pbml0KHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGltZWxpbmUsIHU2NCBjb250
ZXh0KQogCiAJbXV0ZXhfaW5pdCgmdGltZWxpbmUtPm11dGV4KTsKIAotCUlOSVRfQUNUSVZFX1JF
UVVFU1QoJnRpbWVsaW5lLT5sYXN0X3JlcXVlc3QsICZ0aW1lbGluZS0+bXV0ZXgpOworCUlOSVRf
QUNUSVZFX0ZFTkNFKCZ0aW1lbGluZS0+bGFzdF9yZXF1ZXN0LCAmdGltZWxpbmUtPm11dGV4KTsK
IAlJTklUX0xJU1RfSEVBRCgmdGltZWxpbmUtPnJlcXVlc3RzKTsKIAogCWk5MTVfc3luY21hcF9p
bml0KCZ0aW1lbGluZS0+c3luYyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dnQvc2NoZWR1bGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVyLmMKaW5k
ZXggODk0MGZhOGQzOTFhLi42YmViNzUzYjFlYTEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d2dC9zY2hlZHVsZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2No
ZWR1bGVyLmMKQEAgLTM4NSwxMSArMzg1LDggQEAgaW50ZWxfZ3Z0X3dvcmtsb2FkX3JlcV9hbGxv
YyhzdHJ1Y3QgaW50ZWxfdmdwdV93b3JrbG9hZCAqd29ya2xvYWQpCiB7CiAJc3RydWN0IGludGVs
X3ZncHUgKnZncHUgPSB3b3JrbG9hZC0+dmdwdTsKIAlzdHJ1Y3QgaW50ZWxfdmdwdV9zdWJtaXNz
aW9uICpzID0gJnZncHUtPnN1Ym1pc3Npb247Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdmdwdS0+Z3Z0LT5kZXZfcHJpdjsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsK
IAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKLQog
CWlmICh3b3JrbG9hZC0+cmVxKQogCQlyZXR1cm4gMDsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0
aXZlLmMKaW5kZXggZmJhNzdkMjg0ZmJhLi4yZWNiNzhjYjY3N2UgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9hY3RpdmUuYwpAQCAtMTIsOCArMTIsNiBAQAogI2luY2x1ZGUgImk5MTVfYWN0aXZlLmgi
CiAjaW5jbHVkZSAiaTkxNV9nbG9iYWxzLmgiCiAKLSNkZWZpbmUgQktMKHJlZikgKCYocmVmKS0+
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCkKLQogLyoKICAqIEFjdGl2ZSByZWZzIG1lbW9yeSBtYW5h
Z2VtZW50CiAgKgpAQCAtMjcsMzUgKzI1LDM1IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV9nbG9iYWxf
YWN0aXZlIHsKIH0gZ2xvYmFsOwogCiBzdHJ1Y3QgYWN0aXZlX25vZGUgewotCXN0cnVjdCBpOTE1
X2FjdGl2ZV9yZXF1ZXN0IGJhc2U7CisJc3RydWN0IGk5MTVfYWN0aXZlX2ZlbmNlIGJhc2U7CiAJ
c3RydWN0IGk5MTVfYWN0aXZlICpyZWY7CiAJc3RydWN0IHJiX25vZGUgbm9kZTsKIAl1NjQgdGlt
ZWxpbmU7CiB9OwogCiBzdGF0aWMgaW5saW5lIHN0cnVjdCBhY3RpdmVfbm9kZSAqCi1ub2RlX2Zy
b21fYWN0aXZlKHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUpCitub2RlX2Zyb21f
YWN0aXZlKHN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlKQogewogCXJldHVybiBjb250
YWluZXJfb2YoYWN0aXZlLCBzdHJ1Y3QgYWN0aXZlX25vZGUsIGJhc2UpOwogfQogCiAjZGVmaW5l
IHRha2VfcHJlYWxsb2NhdGVkX2JhcnJpZXJzKHgpIGxsaXN0X2RlbF9hbGwoJih4KS0+cHJlYWxs
b2NhdGVkX2JhcnJpZXJzKQogCi1zdGF0aWMgaW5saW5lIGJvb2wgaXNfYmFycmllcihjb25zdCBz
dHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlKQorc3RhdGljIGlubGluZSBib29sIGlz
X2JhcnJpZXIoY29uc3Qgc3RydWN0IGk5MTVfYWN0aXZlX2ZlbmNlICphY3RpdmUpCiB7Ci0JcmV0
dXJuIElTX0VSUihyY3VfYWNjZXNzX3BvaW50ZXIoYWN0aXZlLT5yZXF1ZXN0KSk7CisJcmV0dXJu
IElTX0VSUihyY3VfYWNjZXNzX3BvaW50ZXIoYWN0aXZlLT5mZW5jZSkpOwogfQogCiBzdGF0aWMg
aW5saW5lIHN0cnVjdCBsbGlzdF9ub2RlICpiYXJyaWVyX3RvX2xsKHN0cnVjdCBhY3RpdmVfbm9k
ZSAqbm9kZSkKIHsKIAlHRU1fQlVHX09OKCFpc19iYXJyaWVyKCZub2RlLT5iYXNlKSk7Ci0JcmV0
dXJuIChzdHJ1Y3QgbGxpc3Rfbm9kZSAqKSZub2RlLT5iYXNlLmxpbms7CisJcmV0dXJuIChzdHJ1
Y3QgbGxpc3Rfbm9kZSAqKSZub2RlLT5iYXNlLmNiLm5vZGU7CiB9CiAKIHN0YXRpYyBpbmxpbmUg
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqCiBfX2JhcnJpZXJfdG9fZW5naW5lKHN0cnVjdCBhY3Rp
dmVfbm9kZSAqbm9kZSkKIHsKLQlyZXR1cm4gKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKilSRUFE
X09OQ0Uobm9kZS0+YmFzZS5saW5rLnByZXYpOworCXJldHVybiAoc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqKVJFQURfT05DRShub2RlLT5iYXNlLmNiLm5vZGUucHJldik7CiB9CiAKIHN0YXRpYyBp
bmxpbmUgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqCkBAIC02OCw3ICs2Niw3IEBAIGJhcnJpZXJf
dG9fZW5naW5lKHN0cnVjdCBhY3RpdmVfbm9kZSAqbm9kZSkKIHN0YXRpYyBpbmxpbmUgc3RydWN0
IGFjdGl2ZV9ub2RlICpiYXJyaWVyX2Zyb21fbGwoc3RydWN0IGxsaXN0X25vZGUgKngpCiB7CiAJ
cmV0dXJuIGNvbnRhaW5lcl9vZigoc3RydWN0IGxpc3RfaGVhZCAqKXgsCi0JCQkgICAgc3RydWN0
IGFjdGl2ZV9ub2RlLCBiYXNlLmxpbmspOworCQkJICAgIHN0cnVjdCBhY3RpdmVfbm9kZSwgYmFz
ZS5jYi5ub2RlKTsKIH0KIAogI2lmIElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X0RFQlVHX0dF
TSkgJiYgSVNfRU5BQkxFRChDT05GSUdfREVCVUdfT0JKRUNUUykKQEAgLTE0NSwxMyArMTQzLDE2
IEBAIF9fYWN0aXZlX3JldGlyZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIAogCUdFTV9CVUdf
T04ocmN1X2FjY2Vzc19wb2ludGVyKHJlZi0+ZXhjbCkpOwogCXJidHJlZV9wb3N0b3JkZXJfZm9y
X2VhY2hfZW50cnlfc2FmZShpdCwgbiwgJnJvb3QsIG5vZGUpIHsKLQkJR0VNX0JVR19PTihpOTE1
X2FjdGl2ZV9yZXF1ZXN0X2lzc2V0KCZpdC0+YmFzZSkpOworCQlHRU1fQlVHX09OKGk5MTVfYWN0
aXZlX2ZlbmNlX2lzc2V0KCZpdC0+YmFzZSkpOwogCQlrbWVtX2NhY2hlX2ZyZWUoZ2xvYmFsLnNs
YWJfY2FjaGUsIGl0KTsKIAl9CiAKIAkvKiBBZnRlciB0aGUgZmluYWwgcmV0aXJlLCB0aGUgZW50
aXJlIHN0cnVjdCBtYXkgYmUgZnJlZWQgKi8KIAlpZiAocmVmLT5yZXRpcmUpCiAJCXJlZi0+cmV0
aXJlKHJlZik7CisKKwkvKiAuLi4gZXhjZXB0IGlmIHlvdSB3YWl0IG9uIGl0LCB5b3UgbXVzdCBt
YW5hZ2UgeW91ciBvd24gcmVmZXJlbmNlcyEgKi8KKwl3YWtlX3VwX3ZhcihyZWYpOwogfQogCiBz
dGF0aWMgdm9pZApAQCAtMTg1LDEyICsxODYsMTMgQEAgYWN0aXZlX3JldGlyZShzdHJ1Y3QgaTkx
NV9hY3RpdmUgKnJlZikKIH0KIAogc3RhdGljIHZvaWQKLW5vZGVfcmV0aXJlKHN0cnVjdCBpOTE1
X2FjdGl2ZV9yZXF1ZXN0ICpiYXNlLCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKK25vZGVfcmV0
aXJlKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLCBzdHJ1Y3QgZG1hX2ZlbmNlX2NiICpjYikKIHsK
LQlhY3RpdmVfcmV0aXJlKG5vZGVfZnJvbV9hY3RpdmUoYmFzZSktPnJlZik7CisJaTkxNV9hY3Rp
dmVfZmVuY2VfY2IoZmVuY2UsIGNiKTsKKwlhY3RpdmVfcmV0aXJlKGNvbnRhaW5lcl9vZihjYiwg
c3RydWN0IGFjdGl2ZV9ub2RlLCBiYXNlLmNiKS0+cmVmKTsKIH0KIAotc3RhdGljIHN0cnVjdCBp
OTE1X2FjdGl2ZV9yZXF1ZXN0ICoKK3N0YXRpYyBzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKgog
YWN0aXZlX2luc3RhbmNlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCBzdHJ1Y3QgaW50ZWxfdGlt
ZWxpbmUgKnRsKQogewogCXN0cnVjdCBhY3RpdmVfbm9kZSAqbm9kZSwgKnByZWFsbG9jOwpAQCAt
MjM0LDcgKzIzNiw3IEBAIGFjdGl2ZV9pbnN0YW5jZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwg
c3RydWN0IGludGVsX3RpbWVsaW5lICp0bCkKIAl9CiAKIAlub2RlID0gcHJlYWxsb2M7Ci0JaTkx
NV9hY3RpdmVfcmVxdWVzdF9pbml0KCZub2RlLT5iYXNlLCAmdGwtPm11dGV4LCBOVUxMLCBub2Rl
X3JldGlyZSk7CisJX19pOTE1X2FjdGl2ZV9mZW5jZV9pbml0KCZub2RlLT5iYXNlLCAmdGwtPm11
dGV4LCBOVUxMLCBub2RlX3JldGlyZSk7CiAJbm9kZS0+cmVmID0gcmVmOwogCW5vZGUtPnRpbWVs
aW5lID0gaWR4OwogCkBAIC0yNDksOCArMjUxLDcgQEAgYWN0aXZlX2luc3RhbmNlKHN0cnVjdCBp
OTE1X2FjdGl2ZSAqcmVmLCBzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsKQogCXJldHVybiAmbm9k
ZS0+YmFzZTsKIH0KIAotdm9pZCBfX2k5MTVfYWN0aXZlX2luaXQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsCi0JCQlzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKK3ZvaWQgX19pOTE1X2Fj
dGl2ZV9pbml0KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLAogCQkJaW50ICgqYWN0aXZlKShzdHJ1
Y3QgaTkxNV9hY3RpdmUgKnJlZiksCiAJCQl2b2lkICgqcmV0aXJlKShzdHJ1Y3QgaTkxNV9hY3Rp
dmUgKnJlZiksCiAJCQlzdHJ1Y3QgbG9ja19jbGFzc19rZXkgKmtleSkKQEAgLTI1OSw3ICsyNjAs
NiBAQCB2b2lkIF9faTkxNV9hY3RpdmVfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKIAogCWRlYnVnX2FjdGl2ZV9pbml0KHJlZik7CiAKLQlyZWYtPmk5MTUgPSBpOTE1OwogCXJl
Zi0+ZmxhZ3MgPSAwOwogCXJlZi0+YWN0aXZlID0gYWN0aXZlOwogCXJlZi0+cmV0aXJlID0gcHRy
X3VucGFja19iaXRzKHJldGlyZSwgJmJpdHMsIDIpOwpAQCAtMzI1LDkgKzMyNSw5IEBAIF9fYWN0
aXZlX2RlbF9iYXJyaWVyKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCBzdHJ1Y3QgYWN0aXZlX25v
ZGUgKm5vZGUpCiAKIGludCBpOTE1X2FjdGl2ZV9yZWYoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYs
CiAJCSAgICBzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsLAotCQkgICAgc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnEpCisJCSAgICBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSkKIHsKLQlzdHJ1Y3QgaTkx
NV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlOworCXN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0
aXZlOwogCWludCBlcnI7CiAKIAlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ0bC0+bXV0ZXgpOwpAQCAt
MzUwLDE0ICszNTAsMTEgQEAgaW50IGk5MTVfYWN0aXZlX3JlZihzdHJ1Y3QgaTkxNV9hY3RpdmUg
KnJlZiwKIAkJICogcmVxdWVzdCB0aGF0IHdlIHdhbnQgdG8gZW1pdCBvbiB0aGUga2VybmVsX2Nv
bnRleHQuCiAJCSAqLwogCQlfX2FjdGl2ZV9kZWxfYmFycmllcihyZWYsIG5vZGVfZnJvbV9hY3Rp
dmUoYWN0aXZlKSk7Ci0JCVJDVV9JTklUX1BPSU5URVIoYWN0aXZlLT5yZXF1ZXN0LCBOVUxMKTsK
LQkJSU5JVF9MSVNUX0hFQUQoJmFjdGl2ZS0+bGluayk7Ci0JfSBlbHNlIHsKLQkJaWYgKCFpOTE1
X2FjdGl2ZV9yZXF1ZXN0X2lzc2V0KGFjdGl2ZSkpCi0JCQlhdG9taWNfaW5jKCZyZWYtPmNvdW50
KTsKKwkJUkNVX0lOSVRfUE9JTlRFUihhY3RpdmUtPmZlbmNlLCBOVUxMKTsKKwkJYXRvbWljX2Rl
YygmcmVmLT5jb3VudCk7CiAJfQotCUdFTV9CVUdfT04oIWF0b21pY19yZWFkKCZyZWYtPmNvdW50
KSk7Ci0JX19pOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldChhY3RpdmUsIHJxKTsKKwlpZiAoIV9faTkx
NV9hY3RpdmVfZmVuY2Vfc2V0KGFjdGl2ZSwgZmVuY2UpKQorCQlhdG9taWNfaW5jKCZyZWYtPmNv
dW50KTsKIAogb3V0OgogCWk5MTVfYWN0aXZlX3JlbGVhc2UocmVmKTsKQEAgLTQyNywxNDMgKzQy
NCw1MyBAQCBpbnQgaTkxNV9hY3RpdmVfYWNxdWlyZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikK
IAlyZXR1cm4gZXJyOwogfQogCi12b2lkIGk5MTVfYWN0aXZlX3JlbGVhc2Uoc3RydWN0IGk5MTVf
YWN0aXZlICpyZWYpCitib29sIGk5MTVfYWN0aXZlX2FjcXVpcmVfaWZfYnVzeShzdHJ1Y3QgaTkx
NV9hY3RpdmUgKnJlZikKIHsKIAlkZWJ1Z19hY3RpdmVfYXNzZXJ0KHJlZik7Ci0JYWN0aXZlX3Jl
dGlyZShyZWYpOwotfQogCi1zdGF0aWMgdm9pZCBfX2FjdGl2ZV91bmdyYWIoc3RydWN0IGk5MTVf
YWN0aXZlICpyZWYpCi17Ci0JY2xlYXJfYW5kX3dha2VfdXBfYml0KEk5MTVfQUNUSVZFX0dSQUJf
QklULCAmcmVmLT5mbGFncyk7CisJcmV0dXJuIGF0b21pY19hZGRfdW5sZXNzKCZyZWYtPmNvdW50
LCAxLCAwKTsKIH0KIAotYm9vbCBpOTE1X2FjdGl2ZV90cnlncmFiKHN0cnVjdCBpOTE1X2FjdGl2
ZSAqcmVmKQordm9pZCBpOTE1X2FjdGl2ZV9yZWxlYXNlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVm
KQogewogCWRlYnVnX2FjdGl2ZV9hc3NlcnQocmVmKTsKLQotCWlmICh0ZXN0X2FuZF9zZXRfYml0
KEk5MTVfQUNUSVZFX0dSQUJfQklULCAmcmVmLT5mbGFncykpCi0JCXJldHVybiBmYWxzZTsKLQot
CWlmICghYXRvbWljX2FkZF91bmxlc3MoJnJlZi0+Y291bnQsIDEsIDApKSB7Ci0JCV9fYWN0aXZl
X3VuZ3JhYihyZWYpOwotCQlyZXR1cm4gZmFsc2U7Ci0JfQotCi0JcmV0dXJuIHRydWU7Ci19Ci0K
LXZvaWQgaTkxNV9hY3RpdmVfdW5ncmFiKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQotewotCUdF
TV9CVUdfT04oIXRlc3RfYml0KEk5MTVfQUNUSVZFX0dSQUJfQklULCAmcmVmLT5mbGFncykpOwot
CiAJYWN0aXZlX3JldGlyZShyZWYpOwotCV9fYWN0aXZlX3VuZ3JhYihyZWYpOwotfQotCi1zdGF0
aWMgaW50IGV4Y2xfd2FpdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKLXsKLQlzdHJ1Y3QgZG1h
X2ZlbmNlICpvbGQ7Ci0JaW50IGVyciA9IDA7Ci0KLQlpZiAoIXJjdV9hY2Nlc3NfcG9pbnRlcihy
ZWYtPmV4Y2wpKQotCQlyZXR1cm4gMDsKLQotCXJjdV9yZWFkX2xvY2soKTsKLQlvbGQgPSBkbWFf
ZmVuY2VfZ2V0X3JjdV9zYWZlKCZyZWYtPmV4Y2wpOwotCXJjdV9yZWFkX3VubG9jaygpOwotCWlm
IChvbGQpIHsKLQkJZXJyID0gZG1hX2ZlbmNlX3dhaXQob2xkLCB0cnVlKTsKLQkJZG1hX2ZlbmNl
X3B1dChvbGQpOwotCX0KLQotCXJldHVybiBlcnI7CiB9CiAKIGludCBpOTE1X2FjdGl2ZV93YWl0
KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQogewogCXN0cnVjdCBhY3RpdmVfbm9kZSAqaXQsICpu
OwotCWludCBlcnI7CisJaW50IGVyciA9IDA7CiAKIAltaWdodF9zbGVlcCgpOwotCW1pZ2h0X2xv
Y2soJnJlZi0+bXV0ZXgpOwogCi0JaWYgKGk5MTVfYWN0aXZlX2lzX2lkbGUocmVmKSkKKwlpZiAo
IWk5MTVfYWN0aXZlX2FjcXVpcmVfaWZfYnVzeShyZWYpKQogCQlyZXR1cm4gMDsKIAotCWVyciA9
IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmcmVmLT5tdXRleCk7Ci0JaWYgKGVycikKLQkJcmV0
dXJuIGVycjsKLQotCWlmICghYXRvbWljX2FkZF91bmxlc3MoJnJlZi0+Y291bnQsIDEsIDApKSB7
Ci0JCW11dGV4X3VubG9jaygmcmVmLT5tdXRleCk7Ci0JCXJldHVybiAwOwotCX0KKwkvKiBGbHVz
aCBsYXp5IHNpZ25hbHMgKi8KKwlyYnRyZWVfcG9zdG9yZGVyX2Zvcl9lYWNoX2VudHJ5X3NhZmUo
aXQsIG4sICZyZWYtPnRyZWUsIG5vZGUpIHsKKwkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CiAK
LQllcnIgPSBleGNsX3dhaXQocmVmKTsKLQlpZiAoZXJyKQotCQlnb3RvIG91dDsKKwkJaWYgKGlz
X2JhcnJpZXIoJml0LT5iYXNlKSkgLyogdW5jb25uZWN0ZWQgaWRsZSBiYXJyaWVyICovCisJCQlj
b250aW51ZTsKIAotCXJidHJlZV9wb3N0b3JkZXJfZm9yX2VhY2hfZW50cnlfc2FmZShpdCwgbiwg
JnJlZi0+dHJlZSwgbm9kZSkgewotCQlpZiAoaXNfYmFycmllcigmaXQtPmJhc2UpKSB7IC8qIHVu
Y29ubmVjdGVkIGlkbGUtYmFycmllciAqLwotCQkJZXJyID0gLUVCVVNZOwotCQkJYnJlYWs7CisJ
CWZlbmNlID0gaTkxNV9hY3RpdmVfZmVuY2VfZ2V0KCZpdC0+YmFzZSk7CisJCWlmIChmZW5jZSkg
eworCQkJZG1hX2ZlbmNlX2VuYWJsZV9zd19zaWduYWxpbmcoZmVuY2UpOworCQkJZG1hX2ZlbmNl
X3B1dChmZW5jZSk7CiAJCX0KLQotCQllcnIgPSBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3JldGlyZSgm
aXQtPmJhc2UsIEJLTChyZWYpKTsKLQkJaWYgKGVycikKLQkJCWJyZWFrOwogCX0KLQotb3V0Ogot
CV9fYWN0aXZlX3JldGlyZShyZWYpOworCS8qIEFueSBmZW5jZSBhZGRlZCBhZnRlciB0aGUgd2Fp
dCBiZWdpbnMgd2lsbCBub3QgYmUgYXV0by1zaWduYWxlZCAqLworCWk5MTVfYWN0aXZlX3JlbGVh
c2UocmVmKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwogCi0JaWYgKHdhaXRfb25fYml0KCZy
ZWYtPmZsYWdzLCBJOTE1X0FDVElWRV9HUkFCX0JJVCwgVEFTS19LSUxMQUJMRSkpCisJaWYgKHdh
aXRfdmFyX2V2ZW50X2ludGVycnVwdGlibGUocmVmLCBpOTE1X2FjdGl2ZV9pc19pZGxlKHJlZikp
KQogCQlyZXR1cm4gLUVJTlRSOwogCi0JZmx1c2hfd29yaygmcmVmLT53b3JrKTsKLQlpZiAoIWk5
MTVfYWN0aXZlX2lzX2lkbGUocmVmKSkKLQkJcmV0dXJuIC1FQlVTWTsKLQogCXJldHVybiAwOwog
fQogCi1pbnQgaTkxNV9yZXF1ZXN0X2F3YWl0X2FjdGl2ZV9yZXF1ZXN0KHN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJxLAotCQkJCSAgICAgIHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUp
Ci17Ci0Jc3RydWN0IGk5MTVfcmVxdWVzdCAqYmFycmllciA9Ci0JCWk5MTVfYWN0aXZlX3JlcXVl
c3RfcmF3KGFjdGl2ZSwgJnJxLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQotCXJldHVybiBi
YXJyaWVyID8gaTkxNV9yZXF1ZXN0X2F3YWl0X2RtYV9mZW5jZShycSwgJmJhcnJpZXItPmZlbmNl
KSA6IDA7Ci19Ci0KLWludCBpOTE1X3JlcXVlc3RfYXdhaXRfYWN0aXZlKHN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJxLCBzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKLXsKLQlzdHJ1Y3QgYWN0aXZlX25v
ZGUgKml0LCAqbjsKLQlpbnQgZXJyOwotCi0JaWYgKFJCX0VNUFRZX1JPT1QoJnJlZi0+dHJlZSkp
Ci0JCXJldHVybiAwOwotCi0JLyogYXdhaXQgYWxsb2NhdGVzIGFuZCBzbyB3ZSBuZWVkIHRvIGF2
b2lkIGhpdHRpbmcgdGhlIHNocmlua2VyICovCi0JZXJyID0gaTkxNV9hY3RpdmVfYWNxdWlyZShy
ZWYpOwotCWlmIChlcnIpCi0JCXJldHVybiBlcnI7Ci0KLQltdXRleF9sb2NrKCZyZWYtPm11dGV4
KTsKLQlyYnRyZWVfcG9zdG9yZGVyX2Zvcl9lYWNoX2VudHJ5X3NhZmUoaXQsIG4sICZyZWYtPnRy
ZWUsIG5vZGUpIHsKLQkJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X2FjdGl2ZV9yZXF1ZXN0KHJx
LCAmaXQtPmJhc2UpOwotCQlpZiAoZXJyKQotCQkJYnJlYWs7Ci0JfQotCW11dGV4X3VubG9jaygm
cmVmLT5tdXRleCk7Ci0KLQlpOTE1X2FjdGl2ZV9yZWxlYXNlKHJlZik7Ci0JcmV0dXJuIGVycjsK
LX0KLQogI2lmIElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X0RFQlVHX0dFTSkKIHZvaWQgaTkx
NV9hY3RpdmVfZmluaShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIHsKQEAgLTU3Nyw3ICs0ODQs
NyBAQCB2b2lkIGk5MTVfYWN0aXZlX2Zpbmkoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiAKIHN0
YXRpYyBpbmxpbmUgYm9vbCBpc19pZGxlX2JhcnJpZXIoc3RydWN0IGFjdGl2ZV9ub2RlICpub2Rl
LCB1NjQgaWR4KQogewotCXJldHVybiBub2RlLT50aW1lbGluZSA9PSBpZHggJiYgIWk5MTVfYWN0
aXZlX3JlcXVlc3RfaXNzZXQoJm5vZGUtPmJhc2UpOworCXJldHVybiBub2RlLT50aW1lbGluZSA9
PSBpZHggJiYgIWk5MTVfYWN0aXZlX2ZlbmNlX2lzc2V0KCZub2RlLT5iYXNlKTsKIH0KIAogc3Rh
dGljIHN0cnVjdCBhY3RpdmVfbm9kZSAqcmV1c2VfaWRsZV9iYXJyaWVyKHN0cnVjdCBpOTE1X2Fj
dGl2ZSAqcmVmLCB1NjQgaWR4KQpAQCAtNjk3LDEzICs2MDQsMTMgQEAgaW50IGk5MTVfYWN0aXZl
X2FjcXVpcmVfcHJlYWxsb2NhdGVfYmFycmllcihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKIAkJ
CW5vZGUtPmJhc2UubG9jayA9CiAJCQkJJmVuZ2luZS0+a2VybmVsX2NvbnRleHQtPnRpbWVsaW5l
LT5tdXRleDsKICNlbmRpZgotCQkJUkNVX0lOSVRfUE9JTlRFUihub2RlLT5iYXNlLnJlcXVlc3Qs
IE5VTEwpOwotCQkJbm9kZS0+YmFzZS5yZXRpcmUgPSBub2RlX3JldGlyZTsKKwkJCVJDVV9JTklU
X1BPSU5URVIobm9kZS0+YmFzZS5mZW5jZSwgTlVMTCk7CisJCQlub2RlLT5iYXNlLmNiLmZ1bmMg
PSBub2RlX3JldGlyZTsKIAkJCW5vZGUtPnRpbWVsaW5lID0gaWR4OwogCQkJbm9kZS0+cmVmID0g
cmVmOwogCQl9CiAKLQkJaWYgKCFpOTE1X2FjdGl2ZV9yZXF1ZXN0X2lzc2V0KCZub2RlLT5iYXNl
KSkgeworCQlpZiAoIWk5MTVfYWN0aXZlX2ZlbmNlX2lzc2V0KCZub2RlLT5iYXNlKSkgewogCQkJ
LyoKIAkJCSAqIE1hcmsgdGhpcyBhcyBiZWluZyAqb3VyKiB1bmNvbm5lY3RlZCBwcm90by1ub2Rl
LgogCQkJICoKQEAgLTcxMyw4ICs2MjAsOCBAQCBpbnQgaTkxNV9hY3RpdmVfYWNxdWlyZV9wcmVh
bGxvY2F0ZV9iYXJyaWVyKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLAogCQkJICogYW5kIHRoZW4g
d2UgY2FuIHVzZSB0aGUgcmJfbm9kZSBhbmQgbGlzdCBwb2ludGVycwogCQkJICogZm9yIG91ciB0
cmFja2luZyBvZiB0aGUgcGVuZGluZyBiYXJyaWVyLgogCQkJICovCi0JCQlSQ1VfSU5JVF9QT0lO
VEVSKG5vZGUtPmJhc2UucmVxdWVzdCwgRVJSX1BUUigtRUFHQUlOKSk7Ci0JCQlub2RlLT5iYXNl
LmxpbmsucHJldiA9ICh2b2lkICopZW5naW5lOworCQkJUkNVX0lOSVRfUE9JTlRFUihub2RlLT5i
YXNlLmZlbmNlLCBFUlJfUFRSKC1FQUdBSU4pKTsKKwkJCW5vZGUtPmJhc2UuY2Iubm9kZS5wcmV2
ID0gKHZvaWQgKillbmdpbmU7CiAJCQlhdG9taWNfaW5jKCZyZWYtPmNvdW50KTsKIAkJfQogCkBA
IC03ODEsMjUgKzY4OCw2NSBAQCB2b2lkIGk5MTVfcmVxdWVzdF9hZGRfYWN0aXZlX2JhcnJpZXJz
KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogewogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSA9IHJxLT5lbmdpbmU7CiAJc3RydWN0IGxsaXN0X25vZGUgKm5vZGUsICpuZXh0OworCXVu
c2lnbmVkIGxvbmcgZmxhZ3M7CiAKIAlHRU1fQlVHX09OKGludGVsX2VuZ2luZV9pc192aXJ0dWFs
KGVuZ2luZSkpOwogCUdFTV9CVUdfT04ocnEtPnRpbWVsaW5lICE9IGVuZ2luZS0+a2VybmVsX2Nv
bnRleHQtPnRpbWVsaW5lKTsKIAorCW5vZGUgPSBsbGlzdF9kZWxfYWxsKCZlbmdpbmUtPmJhcnJp
ZXJfdGFza3MpOworCWlmICghbm9kZSkKKwkJcmV0dXJuOwogCS8qCiAJICogQXR0YWNoIHRoZSBs
aXN0IG9mIHByb3RvLWZlbmNlcyB0byB0aGUgaW4tZmxpZ2h0IHJlcXVlc3Qgc3VjaAogCSAqIHRo
YXQgdGhlIHBhcmVudCBpOTE1X2FjdGl2ZSB3aWxsIGJlIHJlbGVhc2VkIHdoZW4gdGhpcyByZXF1
ZXN0CiAJICogaXMgcmV0aXJlZC4KIAkgKi8KLQlsbGlzdF9mb3JfZWFjaF9zYWZlKG5vZGUsIG5l
eHQsIGxsaXN0X2RlbF9hbGwoJmVuZ2luZS0+YmFycmllcl90YXNrcykpIHsKLQkJUkNVX0lOSVRf
UE9JTlRFUihiYXJyaWVyX2Zyb21fbGwobm9kZSktPmJhc2UucmVxdWVzdCwgcnEpOworCXNwaW5f
bG9ja19pcnFzYXZlKCZycS0+bG9jaywgZmxhZ3MpOworCWxsaXN0X2Zvcl9lYWNoX3NhZmUobm9k
ZSwgbmV4dCwgbm9kZSkgeworCQlSQ1VfSU5JVF9QT0lOVEVSKGJhcnJpZXJfZnJvbV9sbChub2Rl
KS0+YmFzZS5mZW5jZSwgJnJxLT5mZW5jZSk7CiAJCXNtcF93bWIoKTsgLyogc2VyaWFsaXNlIHdp
dGggcmV1c2VfaWRsZV9iYXJyaWVyICovCi0JCWxpc3RfYWRkX3RhaWwoKHN0cnVjdCBsaXN0X2hl
YWQgKilub2RlLCAmcnEtPmFjdGl2ZV9saXN0KTsKKwkJbGlzdF9hZGRfdGFpbCgoc3RydWN0IGxp
c3RfaGVhZCAqKW5vZGUsICZycS0+ZmVuY2UuY2JfbGlzdCk7CiAJfQorCXNwaW5fdW5sb2NrX2ly
cXJlc3RvcmUoJnJxLT5sb2NrLCBmbGFncyk7CiB9CiAKLWludCBpOTE1X2FjdGl2ZV9yZXF1ZXN0
X3NldChzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLAotCQkJICAgIHN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxKQorI2lmIElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X0RFQlVHX0dF
TSkKKyNkZWZpbmUgYWN0aXZlX2lzX2hlbGQoYWN0aXZlKSBsb2NrZGVwX2lzX2hlbGQoKGFjdGl2
ZSktPmxvY2spCisjZWxzZQorI2RlZmluZSBhY3RpdmVfaXNfaGVsZChhY3RpdmUpIHRydWUKKyNl
bmRpZgorCitzdHJ1Y3QgZG1hX2ZlbmNlICoKK19faTkxNV9hY3RpdmVfZmVuY2Vfc2V0KHN0cnVj
dCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlLAorCQkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2Up
CiB7CisJc3RydWN0IGRtYV9mZW5jZSAqcHJldjsKKwl1bnNpZ25lZCBsb25nIGZsYWdzOworCisJ
LyogTkI6IHVwZGF0ZXMgbXVzdCBiZSBzZXJpYWxpc2VkIGJ5IGFuIG91dGVyIHRpbWVsaW5lIG11
dGV4ICovCisJc3Bpbl9sb2NrX2lycXNhdmUoZmVuY2UtPmxvY2ssIGZsYWdzKTsKKwlHRU1fQlVH
X09OKHRlc3RfYml0KERNQV9GRU5DRV9GTEFHX1NJR05BTEVEX0JJVCwgJmZlbmNlLT5mbGFncykp
OworCisJcHJldiA9IHJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQoYWN0aXZlLT5mZW5jZSwgYWN0
aXZlX2lzX2hlbGQoYWN0aXZlKSk7CisJaWYgKHByZXYpIHsKKwkJc3Bpbl9sb2NrX25lc3RlZChw
cmV2LT5sb2NrLCBTSU5HTEVfREVQVEhfTkVTVElORyk7CisJCV9fbGlzdF9kZWxfZW50cnkoJmFj
dGl2ZS0+Y2Iubm9kZSk7CisJCXNwaW5fdW5sb2NrKHByZXYtPmxvY2spOyAvKiBzZXJpYWxpc2Ug
d2l0aCBwcmV2LT5jYl9saXN0ICovCisJCXByZXYgPSByY3VfYWNjZXNzX3BvaW50ZXIoYWN0aXZl
LT5mZW5jZSk7CisJfQorCisJcmN1X2Fzc2lnbl9wb2ludGVyKGFjdGl2ZS0+ZmVuY2UsIGZlbmNl
KTsKKwlsaXN0X2FkZF90YWlsKCZhY3RpdmUtPmNiLm5vZGUsICZmZW5jZS0+Y2JfbGlzdCk7CisK
KwlzcGluX3VubG9ja19pcnFyZXN0b3JlKGZlbmNlLT5sb2NrLCBmbGFncyk7CisKKwlyZXR1cm4g
cHJldjsKK30KKworaW50IGk5MTVfYWN0aXZlX2ZlbmNlX3NldChzdHJ1Y3QgaTkxNV9hY3RpdmVf
ZmVuY2UgKmFjdGl2ZSwKKwkJCSAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCit7CisJc3RydWN0
IGRtYV9mZW5jZSAqZmVuY2U7CiAJaW50IGVycjsKIAogI2lmIElTX0VOQUJMRUQoQ09ORklHX0RS
TV9JOTE1X0RFQlVHX0dFTSkKQEAgLTgwNywxOCArNzU0LDI1IEBAIGludCBpOTE1X2FjdGl2ZV9y
ZXF1ZXN0X3NldChzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLAogI2VuZGlmCiAK
IAkvKiBNdXN0IG1haW50YWluIG9yZGVyaW5nIHdydCBwcmV2aW91cyBhY3RpdmUgcmVxdWVzdHMg
Ki8KLQllcnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfYWN0aXZlX3JlcXVlc3QocnEsIGFjdGl2ZSk7
Ci0JaWYgKGVycikKLQkJcmV0dXJuIGVycjsKKwlyY3VfcmVhZF9sb2NrKCk7CisJZmVuY2UgPSBf
X2k5MTVfYWN0aXZlX2ZlbmNlX3NldChhY3RpdmUsICZycS0+ZmVuY2UpOworCWlmIChmZW5jZSkK
KwkJZmVuY2UgPSBkbWFfZmVuY2VfZ2V0X3JjdShmZW5jZSk7CisJcmN1X3JlYWRfdW5sb2NrKCk7
CisKKwlpZiAoZmVuY2UpIHsKKwkJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X2RtYV9mZW5jZShy
cSwgZmVuY2UpOworCQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKKwkJaWYgKGVycikKKwkJCXJldHVy
biBlcnI7CisJfQogCi0JX19pOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldChhY3RpdmUsIHJxKTsKIAly
ZXR1cm4gMDsKIH0KIAotdm9pZCBpOTE1X2FjdGl2ZV9yZXRpcmVfbm9vcChzdHJ1Y3QgaTkxNV9h
Y3RpdmVfcmVxdWVzdCAqYWN0aXZlLAotCQkJICAgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1
ZXN0KQordm9pZCBpOTE1X2FjdGl2ZV9ub29wKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLCBzdHJ1
Y3QgZG1hX2ZlbmNlX2NiICpjYikKIHsKLQkvKiBTcGFjZSBsZWZ0IGludGVudGlvbmFsbHkgYmxh
bmsgKi8KKwlpOTE1X2FjdGl2ZV9mZW5jZV9jYihmZW5jZSwgY2IpOwogfQogCiAjaWYgSVNfRU5B
QkxFRChDT05GSUdfRFJNX0k5MTVfU0VMRlRFU1QpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2FjdGl2ZS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUu
aAppbmRleCBiYzFjOWQ1ZDRmNjMuLjA1ZTk0ODc2YzczZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2FjdGl2ZS5oCkBAIC0xMCw3ICsxMCwxMCBAQAogI2luY2x1ZGUgPGxpbnV4L2xvY2tkZXAuaD4K
IAogI2luY2x1ZGUgImk5MTVfYWN0aXZlX3R5cGVzLmgiCi0jaW5jbHVkZSAiaTkxNV9yZXF1ZXN0
LmgiCisKK3N0cnVjdCBpOTE1X3JlcXVlc3Q7CitzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzOworc3Ry
dWN0IGludGVsX3RpbWVsaW5lOwogCiAvKgogICogV2UgdHJlYXQgcmVxdWVzdHMgYXMgZmVuY2Vz
LiBUaGlzIGlzIG5vdCBiZSB0byBjb25mdXNlZCB3aXRoIG91cgpAQCAtMjgsMzA4ICszMSwxMDgg
QEAKICAqIHdyaXRlIGFjY2VzcyBzbyB0aGF0IHdlIGNhbiBwZXJmb3JtIGNvbmN1cnJlbnQgcmVh
ZCBvcGVyYXRpb25zIGJldHdlZW4KICAqIHRoZSBDUFUgYW5kIEdQVSBlbmdpbmVzLCBhcyB3ZWxs
IGFzIHdhaXRpbmcgZm9yIGFsbCByZW5kZXJpbmcgdG8KICAqIGNvbXBsZXRlLCBvciB3YWl0aW5n
IGZvciB0aGUgbGFzdCBHUFUgdXNlciBvZiBhICJmZW5jZSByZWdpc3RlciIuIFRoZQotICogb2Jq
ZWN0IHRoZW4gZW1iZWRzIGEgI2k5MTVfYWN0aXZlX3JlcXVlc3QgdG8gdHJhY2sgdGhlIG1vc3Qg
cmVjZW50IChpbgorICogb2JqZWN0IHRoZW4gZW1iZWRzIGEgI2k5MTVfYWN0aXZlX2ZlbmNlIHRv
IHRyYWNrIHRoZSBtb3N0IHJlY2VudCAoaW4KICAqIHJldGlyZW1lbnQgb3JkZXIpIHJlcXVlc3Qg
cmVsZXZhbnQgZm9yIHRoZSBkZXNpcmVkIG1vZGUgb2YgYWNjZXNzLgotICogVGhlICNpOTE1X2Fj
dGl2ZV9yZXF1ZXN0IGlzIHVwZGF0ZWQgd2l0aCBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldCgpIHRv
CisgKiBUaGUgI2k5MTVfYWN0aXZlX2ZlbmNlIGlzIHVwZGF0ZWQgd2l0aCBpOTE1X2FjdGl2ZV9m
ZW5jZV9zZXQoKSB0bwogICogdHJhY2sgdGhlIG1vc3QgcmVjZW50IGZlbmNlIHJlcXVlc3QsIHR5
cGljYWxseSB0aGlzIGlzIGRvbmUgYXMgcGFydCBvZgogICogaTkxNV92bWFfbW92ZV90b19hY3Rp
dmUoKS4KICAqCi0gKiBXaGVuIHRoZSAjaTkxNV9hY3RpdmVfcmVxdWVzdCBjb21wbGV0ZXMgKGlz
IHJldGlyZWQpLCBpdCB3aWxsCisgKiBXaGVuIHRoZSAjaTkxNV9hY3RpdmVfZmVuY2UgY29tcGxl
dGVzIChpcyByZXRpcmVkKSwgaXQgd2lsbAogICogc2lnbmFsIGl0cyBjb21wbGV0aW9uIHRvIHRo
ZSBvd25lciB0aHJvdWdoIGEgY2FsbGJhY2sgYXMgd2VsbCBhcyBtYXJrCi0gKiBpdHNlbGYgYXMg
aWRsZSAoaTkxNV9hY3RpdmVfcmVxdWVzdC5yZXF1ZXN0ID09IE5VTEwpLiBUaGUgb3duZXIKKyAq
IGl0c2VsZiBhcyBpZGxlIChpOTE1X2FjdGl2ZV9mZW5jZS5yZXF1ZXN0ID09IE5VTEwpLiBUaGUg
b3duZXIKICAqIGNhbiB0aGVuIHBlcmZvcm0gYW55IGFjdGlvbiwgc3VjaCBhcyBkZWxheWVkIGZy
ZWVpbmcgb2YgYW4gYWN0aXZlCiAgKiByZXNvdXJjZSBpbmNsdWRpbmcgaXRzZWxmLgogICovCiAK
LXZvaWQgaTkxNV9hY3RpdmVfcmV0aXJlX25vb3Aoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3Qg
KmFjdGl2ZSwKLQkJCSAgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdCk7Cit2b2lkIGk5
MTVfYWN0aXZlX25vb3Aoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsIHN0cnVjdCBkbWFfZmVuY2Vf
Y2IgKmNiKTsKIAogLyoqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X2luaXQgLSBwcmVwYXJlcyB0
aGUgYWN0aXZpdHkgdHJhY2tlciBmb3IgdXNlCisgKiBfX2k5MTVfYWN0aXZlX2ZlbmNlX2luaXQg
LSBwcmVwYXJlcyB0aGUgYWN0aXZpdHkgdHJhY2tlciBmb3IgdXNlCiAgKiBAYWN0aXZlIC0gdGhl
IGFjdGl2ZSB0cmFja2VyCi0gKiBAcnEgLSBpbml0aWFsIHJlcXVlc3QgdG8gdHJhY2ssIGNhbiBi
ZSBOVUxMCisgKiBAZmVuY2UgLSBpbml0aWFsIGZlbmNlIHRvIHRyYWNrLCBjYW4gYmUgTlVMTAog
ICogQGZ1bmMgLSBhIGNhbGxiYWNrIHdoZW4gdGhlbiB0aGUgdHJhY2tlciBpcyByZXRpcmVkIChi
ZWNvbWVzIGlkbGUpLAogICogICAgICAgICBjYW4gYmUgTlVMTAogICoKLSAqIGk5MTVfYWN0aXZl
X3JlcXVlc3RfaW5pdCgpIHByZXBhcmVzIHRoZSBlbWJlZGRlZCBAYWN0aXZlIHN0cnVjdCBmb3Ig
dXNlIGFzCi0gKiBhbiBhY3Rpdml0eSB0cmFja2VyLCB0aGF0IGlzIGZvciB0cmFja2luZyB0aGUg
bGFzdCBrbm93biBhY3RpdmUgcmVxdWVzdAotICogYXNzb2NpYXRlZCB3aXRoIGl0LiBXaGVuIHRo
ZSBsYXN0IHJlcXVlc3QgYmVjb21lcyBpZGxlLCB3aGVuIGl0IGlzIHJldGlyZWQKKyAqIGk5MTVf
YWN0aXZlX2ZlbmNlX2luaXQoKSBwcmVwYXJlcyB0aGUgZW1iZWRkZWQgQGFjdGl2ZSBzdHJ1Y3Qg
Zm9yIHVzZSBhcworICogYW4gYWN0aXZpdHkgdHJhY2tlciwgdGhhdCBpcyBmb3IgdHJhY2tpbmcg
dGhlIGxhc3Qga25vd24gYWN0aXZlIGZlbmNlCisgKiBhc3NvY2lhdGVkIHdpdGggaXQuIFdoZW4g
dGhlIGxhc3QgZmVuY2UgYmVjb21lcyBpZGxlLCB3aGVuIGl0IGlzIHJldGlyZWQKICAqIGFmdGVy
IGNvbXBsZXRpb24sIHRoZSBvcHRpb25hbCBjYWxsYmFjayBAZnVuYyBpcyBpbnZva2VkLgogICov
CiBzdGF0aWMgaW5saW5lIHZvaWQKLWk5MTVfYWN0aXZlX3JlcXVlc3RfaW5pdChzdHJ1Y3QgaTkx
NV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLAorX19pOTE1X2FjdGl2ZV9mZW5jZV9pbml0KHN0cnVj
dCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlLAogCQkJIHN0cnVjdCBtdXRleCAqbG9jaywKLQkJ
CSBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKLQkJCSBpOTE1X2FjdGl2ZV9yZXRpcmVfZm4gcmV0
aXJlKQorCQkJIHZvaWQgKmZlbmNlLAorCQkJIGRtYV9mZW5jZV9mdW5jX3QgZm4pCiB7Ci0JUkNV
X0lOSVRfUE9JTlRFUihhY3RpdmUtPnJlcXVlc3QsIHJxKTsKLQlJTklUX0xJU1RfSEVBRCgmYWN0
aXZlLT5saW5rKTsKLQlhY3RpdmUtPnJldGlyZSA9IHJldGlyZSA/OiBpOTE1X2FjdGl2ZV9yZXRp
cmVfbm9vcDsKKwlSQ1VfSU5JVF9QT0lOVEVSKGFjdGl2ZS0+ZmVuY2UsIGZlbmNlKTsKKwlhY3Rp
dmUtPmNiLmZ1bmMgPSBmbiA/OiBpOTE1X2FjdGl2ZV9ub29wOwogI2lmIElTX0VOQUJMRUQoQ09O
RklHX0RSTV9JOTE1X0RFQlVHX0dFTSkKIAlhY3RpdmUtPmxvY2sgPSBsb2NrOwogI2VuZGlmCiB9
CiAKLSNkZWZpbmUgSU5JVF9BQ1RJVkVfUkVRVUVTVChuYW1lLCBsb2NrKSBcCi0JaTkxNV9hY3Rp
dmVfcmVxdWVzdF9pbml0KChuYW1lKSwgKGxvY2spLCBOVUxMLCBOVUxMKQotCi0vKioKLSAqIGk5
MTVfYWN0aXZlX3JlcXVlc3Rfc2V0IC0gdXBkYXRlcyB0aGUgdHJhY2tlciB0byB3YXRjaCB0aGUg
Y3VycmVudCByZXF1ZXN0Ci0gKiBAYWN0aXZlIC0gdGhlIGFjdGl2ZSB0cmFja2VyCi0gKiBAcmVx
dWVzdCAtIHRoZSByZXF1ZXN0IHRvIHdhdGNoCi0gKgotICogX19pOTE1X2FjdGl2ZV9yZXF1ZXN0
X3NldCgpIHdhdGNoZXMgdGhlIGdpdmVuIEByZXF1ZXN0IGZvciBjb21wbGV0aW9uLiBXaGlsc3QK
LSAqIHRoYXQgQHJlcXVlc3QgaXMgYnVzeSwgdGhlIEBhY3RpdmUgcmVwb3J0cyBidXN5LiBXaGVu
IHRoYXQgQHJlcXVlc3QgaXMKLSAqIHJldGlyZWQsIHRoZSBAYWN0aXZlIHRyYWNrZXIgaXMgdXBk
YXRlZCB0byByZXBvcnQgaWRsZS4KLSAqLwotc3RhdGljIGlubGluZSB2b2lkCi1fX2k5MTVfYWN0
aXZlX3JlcXVlc3Rfc2V0KHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCi0JCQkg
IHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QpCi17Ci0jaWYgSVNfRU5BQkxFRChDT05GSUdf
RFJNX0k5MTVfREVCVUdfR0VNKQotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoYWN0aXZlLT5sb2NrKTsK
LSNlbmRpZgotCWxpc3RfbW92ZSgmYWN0aXZlLT5saW5rLCAmcmVxdWVzdC0+YWN0aXZlX2xpc3Qp
OwotCXJjdV9hc3NpZ25fcG9pbnRlcihhY3RpdmUtPnJlcXVlc3QsIHJlcXVlc3QpOwotfQorI2Rl
ZmluZSBJTklUX0FDVElWRV9GRU5DRShBLCBMT0NLKSBcCisJX19pOTE1X2FjdGl2ZV9mZW5jZV9p
bml0KChBKSwgKExPQ0spLCBOVUxMLCBOVUxMKQogCi1pbnQgX19tdXN0X2NoZWNrCi1pOTE1X2Fj
dGl2ZV9yZXF1ZXN0X3NldChzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLAotCQkJ
c3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpOworc3RydWN0IGRtYV9mZW5jZSAqCitfX2k5MTVfYWN0
aXZlX2ZlbmNlX3NldChzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2ZSwKKwkJCXN0cnVj
dCBkbWFfZmVuY2UgKmZlbmNlKTsKIAogLyoqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3JhdyAt
IHJldHVybiB0aGUgYWN0aXZlIHJlcXVlc3QKKyAqIGk5MTVfYWN0aXZlX2ZlbmNlX3NldCAtIHVw
ZGF0ZXMgdGhlIHRyYWNrZXIgdG8gd2F0Y2ggdGhlIGN1cnJlbnQgZmVuY2UKICAqIEBhY3RpdmUg
LSB0aGUgYWN0aXZlIHRyYWNrZXIKKyAqIEBycSAtIHRoZSByZXF1ZXN0IHRvIHdhdGNoCiAgKgot
ICogaTkxNV9hY3RpdmVfcmVxdWVzdF9yYXcoKSByZXR1cm5zIHRoZSBjdXJyZW50IHJlcXVlc3Qg
YmVpbmcgdHJhY2tlZCwgb3IgTlVMTC4KLSAqIEl0IGRvZXMgbm90IG9idGFpbiBhIHJlZmVyZW5j
ZSBvbiB0aGUgcmVxdWVzdCBmb3IgdGhlIGNhbGxlciwgc28gdGhlIGNhbGxlcgotICogbXVzdCBo
b2xkIHN0cnVjdF9tdXRleC4KKyAqIGk5MTVfYWN0aXZlX2ZlbmNlX3NldCgpIHdhdGNoZXMgdGhl
IGdpdmVuIEBycSBmb3IgY29tcGxldGlvbi4gV2hpbGUKKyAqIHRoYXQgQHJxIGlzIGJ1c3ksIHRo
ZSBAYWN0aXZlIHJlcG9ydHMgYnVzeS4gV2hlbiB0aGF0IEBycSBpcyBzaWduYWxlZAorICogKG9y
IGVsc2UgcmV0aXJlZCkgdGhlIEBhY3RpdmUgdHJhY2tlciBpcyB1cGRhdGVkIHRvIHJlcG9ydCBp
ZGxlLgogICovCi1zdGF0aWMgaW5saW5lIHN0cnVjdCBpOTE1X3JlcXVlc3QgKgotaTkxNV9hY3Rp
dmVfcmVxdWVzdF9yYXcoY29uc3Qgc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSwK
LQkJCXN0cnVjdCBtdXRleCAqbXV0ZXgpCi17Ci0JcmV0dXJuIHJjdV9kZXJlZmVyZW5jZV9wcm90
ZWN0ZWQoYWN0aXZlLT5yZXF1ZXN0LAotCQkJCQkgbG9ja2RlcF9pc19oZWxkKG11dGV4KSk7Ci19
Ci0KLS8qKgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9wZWVrIC0gcmVwb3J0IHRoZSBhY3RpdmUg
cmVxdWVzdCBiZWluZyBtb25pdG9yZWQKLSAqIEBhY3RpdmUgLSB0aGUgYWN0aXZlIHRyYWNrZXIK
LSAqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3BlZWsoKSByZXR1cm5zIHRoZSBjdXJyZW50IHJl
cXVlc3QgYmVpbmcgdHJhY2tlZCBpZgotICogc3RpbGwgYWN0aXZlLCBvciBOVUxMLiBJdCBkb2Vz
IG5vdCBvYnRhaW4gYSByZWZlcmVuY2Ugb24gdGhlIHJlcXVlc3QKLSAqIGZvciB0aGUgY2FsbGVy
LCBzbyB0aGUgY2FsbGVyIG11c3QgaG9sZCBzdHJ1Y3RfbXV0ZXguCi0gKi8KLXN0YXRpYyBpbmxp
bmUgc3RydWN0IGk5MTVfcmVxdWVzdCAqCi1pOTE1X2FjdGl2ZV9yZXF1ZXN0X3BlZWsoY29uc3Qg
c3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSwKLQkJCSBzdHJ1Y3QgbXV0ZXggKm11
dGV4KQotewotCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3Q7Ci0KLQlyZXF1ZXN0ID0gaTkx
NV9hY3RpdmVfcmVxdWVzdF9yYXcoYWN0aXZlLCBtdXRleCk7Ci0JaWYgKCFyZXF1ZXN0IHx8IGk5
MTVfcmVxdWVzdF9jb21wbGV0ZWQocmVxdWVzdCkpCi0JCXJldHVybiBOVUxMOwotCi0JcmV0dXJu
IHJlcXVlc3Q7Ci19Ci0KLS8qKgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9nZXQgLSByZXR1cm4g
YSByZWZlcmVuY2UgdG8gdGhlIGFjdGl2ZSByZXF1ZXN0Ci0gKiBAYWN0aXZlIC0gdGhlIGFjdGl2
ZSB0cmFja2VyCi0gKgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9nZXQoKSByZXR1cm5zIGEgcmVm
ZXJlbmNlIHRvIHRoZSBhY3RpdmUgcmVxdWVzdCwgb3IgTlVMTAotICogaWYgdGhlIGFjdGl2ZSB0
cmFja2VyIGlzIGlkbGUuIFRoZSBjYWxsZXIgbXVzdCBob2xkIHN0cnVjdF9tdXRleC4KLSAqLwot
c3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICoKLWk5MTVfYWN0aXZlX3JlcXVlc3Rf
Z2V0KGNvbnN0IHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCi0JCQlzdHJ1Y3Qg
bXV0ZXggKm11dGV4KQotewotCXJldHVybiBpOTE1X3JlcXVlc3RfZ2V0KGk5MTVfYWN0aXZlX3Jl
cXVlc3RfcGVlayhhY3RpdmUsIG11dGV4KSk7Ci19Ci0KLS8qKgotICogX19pOTE1X2FjdGl2ZV9y
ZXF1ZXN0X2dldF9yY3UgLSByZXR1cm4gYSByZWZlcmVuY2UgdG8gdGhlIGFjdGl2ZSByZXF1ZXN0
Ci0gKiBAYWN0aXZlIC0gdGhlIGFjdGl2ZSB0cmFja2VyCi0gKgotICogX19pOTE1X2FjdGl2ZV9y
ZXF1ZXN0X2dldCgpIHJldHVybnMgYSByZWZlcmVuY2UgdG8gdGhlIGFjdGl2ZSByZXF1ZXN0LAot
ICogb3IgTlVMTCBpZiB0aGUgYWN0aXZlIHRyYWNrZXIgaXMgaWRsZS4gVGhlIGNhbGxlciBtdXN0
IGhvbGQgdGhlIFJDVSByZWFkCi0gKiBsb2NrLCBidXQgdGhlIHJldHVybmVkIHBvaW50ZXIgaXMg
c2FmZSB0byB1c2Ugb3V0c2lkZSBvZiBSQ1UuCi0gKi8KLXN0YXRpYyBpbmxpbmUgc3RydWN0IGk5
MTVfcmVxdWVzdCAqCi1fX2k5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0X3JjdShjb25zdCBzdHJ1Y3Qg
aTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlKQotewotCS8qCi0JICogUGVyZm9ybWluZyBhIGxv
Y2tsZXNzIHJldHJpZXZhbCBvZiB0aGUgYWN0aXZlIHJlcXVlc3QgaXMgc3VwZXIKLQkgKiB0cmlj
a3kuIFNMQUJfVFlQRVNBRkVfQllfUkNVIG1lcmVseSBndWFyYW50ZWVzIHRoYXQgdGhlIGJhY2tp
bmcKLQkgKiBzbGFiIG9mIHJlcXVlc3Qgb2JqZWN0cyB3aWxsIG5vdCBiZSBmcmVlZCB3aGlsc3Qg
d2UgaG9sZCB0aGUKLQkgKiBSQ1UgcmVhZCBsb2NrLiBJdCBkb2VzIG5vdCBndWFyYW50ZWUgdGhh
dCB0aGUgcmVxdWVzdCBpdHNlbGYKLQkgKiB3aWxsIG5vdCBiZSBmcmVlZCBhbmQgdGhlbiAqcmV1
c2VkKi4gVml6LAotCSAqCi0JICogVGhyZWFkIEEJCQlUaHJlYWQgQgotCSAqCi0JICogcnEgPSBh
Y3RpdmUucmVxdWVzdAotCSAqCQkJCXJldGlyZShycSkgLT4gZnJlZShycSk7Ci0JICoJCQkJKHJx
IGlzIG5vdyBmaXJzdCBvbiB0aGUgc2xhYiBmcmVlbGlzdCkKLQkgKgkJCQlhY3RpdmUucmVxdWVz
dCA9IE5VTEwKLQkgKgotCSAqCQkJCXJxID0gbmV3IHN1Ym1pc3Npb24gb24gYSBuZXcgb2JqZWN0
Ci0JICogcmVmKHJxKQotCSAqCi0JICogVG8gcHJldmVudCB0aGUgcmVxdWVzdCBmcm9tIGJlaW5n
IHJldXNlZCB3aGlsc3QgdGhlIGNhbGxlcgotCSAqIHVzZXMgaXQsIHdlIHRha2UgYSByZWZlcmVu
Y2UgbGlrZSBub3JtYWwuIFdoaWxzdCBhY3F1aXJpbmcKLQkgKiB0aGUgcmVmZXJlbmNlIHdlIGNo
ZWNrIHRoYXQgaXQgaXMgbm90IGluIGEgZGVzdHJveWVkIHN0YXRlCi0JICogKHJlZmNudCA9PSAw
KS4gVGhhdCBwcmV2ZW50cyB0aGUgcmVxdWVzdCBiZWluZyByZWFsbG9jYXRlZAotCSAqIHdoaWxz
dCB0aGUgY2FsbGVyIGhvbGRzIG9uIHRvIGl0LiBUbyBjaGVjayB0aGF0IHRoZSByZXF1ZXN0Ci0J
ICogd2FzIG5vdCByZWFsbG9jYXRlZCBhcyB3ZSBhY3F1aXJlZCB0aGUgcmVmZXJlbmNlIHdlIGhh
dmUgdG8KLQkgKiBjaGVjayB0aGF0IG91ciByZXF1ZXN0IHJlbWFpbnMgdGhlIGFjdGl2ZSByZXF1
ZXN0IGFjcm9zcwotCSAqIHRoZSBsb29rdXAsIGluIHRoZSBzYW1lIG1hbm5lciBhcyBhIHNlcWxv
Y2suIFRoZSB2aXNpYmlsaXR5Ci0JICogb2YgdGhlIHBvaW50ZXIgdmVyc3VzIHRoZSByZWZlcmVu
Y2UgY291bnRpbmcgaXMgY29udHJvbGxlZAotCSAqIGJ5IHVzaW5nIFJDVSBiYXJyaWVycyAocmN1
X2RlcmVmZXJlbmNlIGFuZCByY3VfYXNzaWduX3BvaW50ZXIpLgotCSAqCi0JICogSW4gdGhlIG1p
ZGRsZSBvZiBhbGwgdGhhdCwgd2UgaW5zcGVjdCB3aGV0aGVyIHRoZSByZXF1ZXN0IGlzCi0JICog
Y29tcGxldGUuIFJldGlyaW5nIGlzIGxhenkgc28gdGhlIHJlcXVlc3QgbWF5IGJlIGNvbXBsZXRl
ZCBsb25nCi0JICogYmVmb3JlIHRoZSBhY3RpdmUgdHJhY2tlciBpcyB1cGRhdGVkLiBRdWVyeWlu
ZyB3aGV0aGVyIHRoZQotCSAqIHJlcXVlc3QgaXMgY29tcGxldGUgaXMgZmFyIGNoZWFwZXIgKGFz
IGl0IGludm9sdmVzIG5vIGxvY2tlZAotCSAqIGluc3RydWN0aW9ucyBzZXR0aW5nIGNhY2hlbGlu
ZXMgdG8gZXhjbHVzaXZlKSB0aGFuIGFjcXVpcmluZwotCSAqIHRoZSByZWZlcmVuY2UsIHNvIHdl
IGRvIGl0IGZpcnN0LiBUaGUgUkNVIHJlYWQgbG9jayBlbnN1cmVzIHRoZQotCSAqIHBvaW50ZXIg
ZGVyZWZlcmVuY2UgaXMgdmFsaWQsIGJ1dCBkb2VzIG5vdCBlbnN1cmUgdGhhdCB0aGUKLQkgKiBz
ZXFubyBub3IgSFdTIGlzIHRoZSByaWdodCBvbmUhIEhvd2V2ZXIsIGlmIHRoZSByZXF1ZXN0IHdh
cwotCSAqIHJlYWxsb2NhdGVkLCB0aGF0IG1lYW5zIHRoZSBhY3RpdmUgdHJhY2tlcidzIHJlcXVl
c3Qgd2FzIGNvbXBsZXRlLgotCSAqIElmIHRoZSBuZXcgcmVxdWVzdCBpcyBhbHNvIGNvbXBsZXRl
LCB0aGVuIGJvdGggYXJlIGFuZCB3ZSBjYW4KLQkgKiBqdXN0IHJlcG9ydCB0aGUgYWN0aXZlIHRy
YWNrZXIgaXMgaWRsZS4gSWYgdGhlIG5ldyByZXF1ZXN0IGlzCi0JICogaW5jb21wbGV0ZSwgdGhl
biB3ZSBhY3F1aXJlIGEgcmVmZXJlbmNlIG9uIGl0IGFuZCBjaGVjayB0aGF0Ci0JICogaXQgcmVt
YWluZWQgdGhlIGFjdGl2ZSByZXF1ZXN0LgotCSAqCi0JICogSXQgaXMgdGhlbiBpbXBlcmF0aXZl
IHRoYXQgd2UgZG8gbm90IHplcm8gdGhlIHJlcXVlc3Qgb24KLQkgKiByZWFsbG9jYXRpb24sIHNv
IHRoYXQgd2UgY2FuIGNoYXNlIHRoZSBkYW5nbGluZyBwb2ludGVycyEKLQkgKiBTZWUgaTkxNV9y
ZXF1ZXN0X2FsbG9jKCkuCi0JICovCi0JZG8gewotCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1
ZXN0OwotCi0JCXJlcXVlc3QgPSByY3VfZGVyZWZlcmVuY2UoYWN0aXZlLT5yZXF1ZXN0KTsKLQkJ
aWYgKCFyZXF1ZXN0IHx8IGk5MTVfcmVxdWVzdF9jb21wbGV0ZWQocmVxdWVzdCkpCi0JCQlyZXR1
cm4gTlVMTDsKLQotCQkvKgotCQkgKiBBbiBlc3BlY2lhbGx5IHNpbGx5IGNvbXBpbGVyIGNvdWxk
IGRlY2lkZSB0byByZWNvbXB1dGUgdGhlCi0JCSAqIHJlc3VsdCBvZiBpOTE1X3JlcXVlc3RfY29t
cGxldGVkLCBtb3JlIHNwZWNpZmljYWxseQotCQkgKiByZS1lbWl0IHRoZSBsb2FkIGZvciByZXF1
ZXN0LT5mZW5jZS5zZXFuby4gQSByYWNlIHdvdWxkIGNhdGNoCi0JCSAqIGEgbGF0ZXIgc2Vxbm8g
dmFsdWUsIHdoaWNoIGNvdWxkIGZsaXAgdGhlIHJlc3VsdCBmcm9tIHRydWUgdG8KLQkJICogZmFs
c2UuIFdoaWNoIG1lYW5zIHBhcnQgb2YgdGhlIGluc3RydWN0aW9ucyBiZWxvdyBtaWdodCBub3QK
LQkJICogYmUgZXhlY3V0ZWQsIHdoaWxlIGxhdGVyIG9uIGluc3RydWN0aW9ucyBhcmUgZXhlY3V0
ZWQuIER1ZSB0bwotCQkgKiBiYXJyaWVycyB3aXRoaW4gdGhlIHJlZmNvdW50aW5nIHRoZSBpbmNv
bnNpc3RlbmN5IGNhbid0IHJlYWNoCi0JCSAqIHBhc3QgdGhlIGNhbGwgdG8gaTkxNV9yZXF1ZXN0
X2dldF9yY3UsIGJ1dCBub3QgZXhlY3V0aW5nCi0JCSAqIHRoYXQgd2hpbGUgc3RpbGwgZXhlY3V0
aW5nIGk5MTVfcmVxdWVzdF9wdXQoKSBjcmVhdGVzCi0JCSAqIGhhdm9jIGVub3VnaC4gIFByZXZl
bnQgdGhpcyB3aXRoIGEgY29tcGlsZXIgYmFycmllci4KLQkJICovCi0JCWJhcnJpZXIoKTsKLQot
CQlyZXF1ZXN0ID0gaTkxNV9yZXF1ZXN0X2dldF9yY3UocmVxdWVzdCk7Ci0KLQkJLyoKLQkJICog
V2hhdCBzdG9wcyB0aGUgZm9sbG93aW5nIHJjdV9hY2Nlc3NfcG9pbnRlcigpIGZyb20gb2NjdXJy
aW5nCi0JCSAqIGJlZm9yZSB0aGUgYWJvdmUgaTkxNV9yZXF1ZXN0X2dldF9yY3UoKT8gSWYgd2Ug
d2VyZQotCQkgKiB0byByZWFkIHRoZSB2YWx1ZSBiZWZvcmUgcGF1c2luZyB0byBnZXQgdGhlIHJl
ZmVyZW5jZSB0bwotCQkgKiB0aGUgcmVxdWVzdCwgd2UgbWF5IG5vdCBub3RpY2UgYSBjaGFuZ2Ug
aW4gdGhlIGFjdGl2ZQotCQkgKiB0cmFja2VyLgotCQkgKgotCQkgKiBUaGUgcmN1X2FjY2Vzc19w
b2ludGVyKCkgaXMgYSBtZXJlIGNvbXBpbGVyIGJhcnJpZXIsIHdoaWNoCi0JCSAqIG1lYW5zIGJv
dGggdGhlIENQVSBhbmQgY29tcGlsZXIgYXJlIGZyZWUgdG8gcGVyZm9ybSB0aGUKLQkJICogbWVt
b3J5IHJlYWQgd2l0aG91dCBjb25zdHJhaW50LiBUaGUgY29tcGlsZXIgb25seSBoYXMgdG8KLQkJ
ICogZW5zdXJlIHRoYXQgYW55IG9wZXJhdGlvbnMgYWZ0ZXIgdGhlIHJjdV9hY2Nlc3NfcG9pbnRl
cigpCi0JCSAqIG9jY3VyIGFmdGVyd2FyZHMgaW4gcHJvZ3JhbSBvcmRlci4gVGhpcyBtZWFucyB0
aGUgcmVhZCBtYXkKLQkJICogYmUgcGVyZm9ybWVkIGVhcmxpZXIgYnkgYW4gb3V0LW9mLW9yZGVy
IENQVSwgb3IgYWR2ZW50dXJvdXMKLQkJICogY29tcGlsZXIuCi0JCSAqCi0JCSAqIFRoZSBhdG9t
aWMgb3BlcmF0aW9uIGF0IHRoZSBoZWFydCBvZgotCQkgKiBpOTE1X3JlcXVlc3RfZ2V0X3JjdSgp
LCBzZWUgZG1hX2ZlbmNlX2dldF9yY3UoKSwgaXMKLQkJICogYXRvbWljX2luY19ub3RfemVybygp
IHdoaWNoIGlzIG9ubHkgYSBmdWxsIG1lbW9yeSBiYXJyaWVyCi0JCSAqIHdoZW4gc3VjY2Vzc2Z1
bC4gVGhhdCBpcywgaWYgaTkxNV9yZXF1ZXN0X2dldF9yY3UoKQotCQkgKiByZXR1cm5zIHRoZSBy
ZXF1ZXN0IChhbmQgc28gd2l0aCB0aGUgcmVmZXJlbmNlIGNvdW50ZWQKLQkJICogaW5jcmVtZW50
ZWQpIHRoZW4gdGhlIGZvbGxvd2luZyByZWFkIGZvciByY3VfYWNjZXNzX3BvaW50ZXIoKQotCQkg
KiBtdXN0IG9jY3VyIGFmdGVyIHRoZSBhdG9taWMgb3BlcmF0aW9uIGFuZCBzbyBjb25maXJtCi0J
CSAqIHRoYXQgdGhpcyByZXF1ZXN0IGlzIHRoZSBvbmUgY3VycmVudGx5IGJlaW5nIHRyYWNrZWQu
Ci0JCSAqCi0JCSAqIFRoZSBjb3JyZXNwb25kaW5nIHdyaXRlIGJhcnJpZXIgaXMgcGFydCBvZgot
CQkgKiByY3VfYXNzaWduX3BvaW50ZXIoKS4KLQkJICovCi0JCWlmICghcmVxdWVzdCB8fCByZXF1
ZXN0ID09IHJjdV9hY2Nlc3NfcG9pbnRlcihhY3RpdmUtPnJlcXVlc3QpKQotCQkJcmV0dXJuIHJj
dV9wb2ludGVyX2hhbmRvZmYocmVxdWVzdCk7Ci0KLQkJaTkxNV9yZXF1ZXN0X3B1dChyZXF1ZXN0
KTsKLQl9IHdoaWxlICgxKTsKLX0KLQoraW50IF9fbXVzdF9jaGVjaworaTkxNV9hY3RpdmVfZmVu
Y2Vfc2V0KHN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlLAorCQkgICAgICBzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycSk7CiAvKioKLSAqIGk5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0X3VubG9j
a2VkIC0gcmV0dXJuIGEgcmVmZXJlbmNlIHRvIHRoZSBhY3RpdmUgcmVxdWVzdAorICogaTkxNV9h
Y3RpdmVfZmVuY2VfZ2V0IC0gcmV0dXJuIGEgcmVmZXJlbmNlIHRvIHRoZSBhY3RpdmUgZmVuY2UK
ICAqIEBhY3RpdmUgLSB0aGUgYWN0aXZlIHRyYWNrZXIKICAqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1
ZXN0X2dldF91bmxvY2tlZCgpIHJldHVybnMgYSByZWZlcmVuY2UgdG8gdGhlIGFjdGl2ZSByZXF1
ZXN0LAorICogaTkxNV9hY3RpdmVfZmVuY2VfZ2V0KCkgcmV0dXJucyBhIHJlZmVyZW5jZSB0byB0
aGUgYWN0aXZlIGZlbmNlLAogICogb3IgTlVMTCBpZiB0aGUgYWN0aXZlIHRyYWNrZXIgaXMgaWRs
ZS4gVGhlIHJlZmVyZW5jZSBpcyBvYnRhaW5lZCB1bmRlciBSQ1UsCiAgKiBzbyBubyBsb2NraW5n
IGlzIHJlcXVpcmVkIGJ5IHRoZSBjYWxsZXIuCiAgKgotICogVGhlIHJlZmVyZW5jZSBzaG91bGQg
YmUgZnJlZWQgd2l0aCBpOTE1X3JlcXVlc3RfcHV0KCkuCisgKiBUaGUgcmVmZXJlbmNlIHNob3Vs
ZCBiZSBmcmVlZCB3aXRoIGRtYV9mZW5jZV9wdXQoKS4KICAqLwotc3RhdGljIGlubGluZSBzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICoKLWk5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0X3VubG9ja2VkKGNvbnN0
IHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUpCitzdGF0aWMgaW5saW5lIHN0cnVj
dCBkbWFfZmVuY2UgKgoraTkxNV9hY3RpdmVfZmVuY2VfZ2V0KHN0cnVjdCBpOTE1X2FjdGl2ZV9m
ZW5jZSAqYWN0aXZlKQogewotCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3Q7CisJc3RydWN0
IGRtYV9mZW5jZSAqZmVuY2U7CiAKIAlyY3VfcmVhZF9sb2NrKCk7Ci0JcmVxdWVzdCA9IF9faTkx
NV9hY3RpdmVfcmVxdWVzdF9nZXRfcmN1KGFjdGl2ZSk7CisJZmVuY2UgPSBkbWFfZmVuY2VfZ2V0
X3JjdV9zYWZlKCZhY3RpdmUtPmZlbmNlKTsKIAlyY3VfcmVhZF91bmxvY2soKTsKIAotCXJldHVy
biByZXF1ZXN0OworCXJldHVybiBmZW5jZTsKIH0KIAogLyoqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1
ZXN0X2lzc2V0IC0gcmVwb3J0IHdoZXRoZXIgdGhlIGFjdGl2ZSB0cmFja2VyIGlzIGFzc2lnbmVk
CisgKiBpOTE1X2FjdGl2ZV9mZW5jZV9pc3NldCAtIHJlcG9ydCB3aGV0aGVyIHRoZSBhY3RpdmUg
dHJhY2tlciBpcyBhc3NpZ25lZAogICogQGFjdGl2ZSAtIHRoZSBhY3RpdmUgdHJhY2tlcgogICoK
LSAqIGk5MTVfYWN0aXZlX3JlcXVlc3RfaXNzZXQoKSByZXR1cm5zIHRydWUgaWYgdGhlIGFjdGl2
ZSB0cmFja2VyIGlzIGN1cnJlbnRseQotICogYXNzaWduZWQgdG8gYSByZXF1ZXN0LiBEdWUgdG8g
dGhlIGxhenkgcmV0aXJpbmcsIHRoYXQgcmVxdWVzdCBtYXkgYmUgaWRsZQorICogaTkxNV9hY3Rp
dmVfZmVuY2VfaXNzZXQoKSByZXR1cm5zIHRydWUgaWYgdGhlIGFjdGl2ZSB0cmFja2VyIGlzIGN1
cnJlbnRseQorICogYXNzaWduZWQgdG8gYSBmZW5jZS4gRHVlIHRvIHRoZSBsYXp5IHJldGlyaW5n
LCB0aGF0IGZlbmNlIG1heSBiZSBpZGxlCiAgKiBhbmQgdGhpcyBtYXkgcmVwb3J0IHN0YWxlIGlu
Zm9ybWF0aW9uLgogICovCiBzdGF0aWMgaW5saW5lIGJvb2wKLWk5MTVfYWN0aXZlX3JlcXVlc3Rf
aXNzZXQoY29uc3Qgc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSkKK2k5MTVfYWN0
aXZlX2ZlbmNlX2lzc2V0KGNvbnN0IHN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlKQog
ewotCXJldHVybiByY3VfYWNjZXNzX3BvaW50ZXIoYWN0aXZlLT5yZXF1ZXN0KTsKKwlyZXR1cm4g
cmN1X2FjY2Vzc19wb2ludGVyKGFjdGl2ZS0+ZmVuY2UpOwogfQogCi0vKioKLSAqIGk5MTVfYWN0
aXZlX3JlcXVlc3RfcmV0aXJlIC0gd2FpdHMgdW50aWwgdGhlIHJlcXVlc3QgaXMgcmV0aXJlZAot
ICogQGFjdGl2ZSAtIHRoZSBhY3RpdmUgcmVxdWVzdCBvbiB3aGljaCB0byB3YWl0Ci0gKgotICog
aTkxNV9hY3RpdmVfcmVxdWVzdF9yZXRpcmUoKSB3YWl0cyB1bnRpbCB0aGUgcmVxdWVzdCBpcyBj
b21wbGV0ZWQsCi0gKiBhbmQgdGhlbiBlbnN1cmVzIHRoYXQgYXQgbGVhc3QgdGhlIHJldGlyZW1l
bnQgaGFuZGxlciBmb3IgdGhpcwotICogQGFjdGl2ZSB0cmFja2VyIGlzIGNhbGxlZCBiZWZvcmUg
cmV0dXJuaW5nLiBJZiB0aGUgQGFjdGl2ZQotICogdHJhY2tlciBpcyBpZGxlLCB0aGUgZnVuY3Rp
b24gcmV0dXJucyBpbW1lZGlhdGVseS4KLSAqLwotc3RhdGljIGlubGluZSBpbnQgX19tdXN0X2No
ZWNrCi1pOTE1X2FjdGl2ZV9yZXF1ZXN0X3JldGlyZShzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVz
dCAqYWN0aXZlLAotCQkJICAgc3RydWN0IG11dGV4ICptdXRleCkKK3N0YXRpYyBpbmxpbmUgdm9p
ZAoraTkxNV9hY3RpdmVfZmVuY2VfY2Ioc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsIHN0cnVjdCBk
bWFfZmVuY2VfY2IgKmNiKQogewotCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3Q7Ci0JbG9u
ZyByZXQ7Ci0KLQlyZXF1ZXN0ID0gaTkxNV9hY3RpdmVfcmVxdWVzdF9yYXcoYWN0aXZlLCBtdXRl
eCk7Ci0JaWYgKCFyZXF1ZXN0KQotCQlyZXR1cm4gMDsKLQotCXJldCA9IGk5MTVfcmVxdWVzdF93
YWl0KHJlcXVlc3QsCi0JCQkJSTkxNV9XQUlUX0lOVEVSUlVQVElCTEUsCi0JCQkJTUFYX1NDSEVE
VUxFX1RJTUVPVVQpOwotCWlmIChyZXQgPCAwKQotCQlyZXR1cm4gcmV0OworCXN0cnVjdCBpOTE1
X2FjdGl2ZV9mZW5jZSAqYWN0aXZlID0KKwkJY29udGFpbmVyX29mKGNiLCB0eXBlb2YoKmFjdGl2
ZSksIGNiKTsKIAotCWxpc3RfZGVsX2luaXQoJmFjdGl2ZS0+bGluayk7Ci0JUkNVX0lOSVRfUE9J
TlRFUihhY3RpdmUtPnJlcXVlc3QsIE5VTEwpOwotCi0JYWN0aXZlLT5yZXRpcmUoYWN0aXZlLCBy
ZXF1ZXN0KTsKLQotCXJldHVybiAwOworCVJDVV9JTklUX1BPSU5URVIoYWN0aXZlLT5mZW5jZSwg
TlVMTCk7CiB9CiAKIC8qCkBAIC0zNTgsMjAgKzE2MSwxOSBAQCBpOTE1X2FjdGl2ZV9yZXF1ZXN0
X3JldGlyZShzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLAogICogc3luY2hyb25p
c2F0aW9uLgogICovCiAKLXZvaWQgX19pOTE1X2FjdGl2ZV9pbml0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LAotCQkJc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCit2b2lkIF9faTkxNV9h
Y3RpdmVfaW5pdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKIAkJCWludCAoKmFjdGl2ZSkoc3Ry
dWN0IGk5MTVfYWN0aXZlICpyZWYpLAogCQkJdm9pZCAoKnJldGlyZSkoc3RydWN0IGk5MTVfYWN0
aXZlICpyZWYpLAogCQkJc3RydWN0IGxvY2tfY2xhc3Nfa2V5ICprZXkpOwotI2RlZmluZSBpOTE1
X2FjdGl2ZV9pbml0KGk5MTUsIHJlZiwgYWN0aXZlLCByZXRpcmUpIGRvIHsJCVwKKyNkZWZpbmUg
aTkxNV9hY3RpdmVfaW5pdChyZWYsIGFjdGl2ZSwgcmV0aXJlKSBkbyB7CQlcCiAJc3RhdGljIHN0
cnVjdCBsb2NrX2NsYXNzX2tleSBfX2tleTsJCQkJXAogCQkJCQkJCQkJXAotCV9faTkxNV9hY3Rp
dmVfaW5pdChpOTE1LCByZWYsIGFjdGl2ZSwgcmV0aXJlLCAmX19rZXkpOwkJXAorCV9faTkxNV9h
Y3RpdmVfaW5pdChyZWYsIGFjdGl2ZSwgcmV0aXJlLCAmX19rZXkpOwkJXAogfSB3aGlsZSAoMCkK
IAogaW50IGk5MTVfYWN0aXZlX3JlZihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKIAkJICAgIHN0
cnVjdCBpbnRlbF90aW1lbGluZSAqdGwsCi0JCSAgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSk7
CisJCSAgICBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSk7CiAKIHZvaWQgaTkxNV9hY3RpdmVfc2V0
X2V4Y2x1c2l2ZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgc3RydWN0IGRtYV9mZW5jZSAqZik7
CiAKQEAgLTM3OSwxNSArMTgxLDEyIEBAIGludCBpOTE1X2FjdGl2ZV93YWl0KHN0cnVjdCBpOTE1
X2FjdGl2ZSAqcmVmKTsKIAogaW50IGk5MTVfcmVxdWVzdF9hd2FpdF9hY3RpdmUoc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnEsCiAJCQkgICAgICBzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7Ci1pbnQg
aTkxNV9yZXF1ZXN0X2F3YWl0X2FjdGl2ZV9yZXF1ZXN0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
LAotCQkJCSAgICAgIHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUpOworaW50IGk5
MTVfcmVxdWVzdF9hd2FpdF9hY3RpdmVfZmVuY2Uoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCisJ
CQkJICAgIHN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlKTsKIAogaW50IGk5MTVfYWN0
aXZlX2FjcXVpcmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpOworYm9vbCBpOTE1X2FjdGl2ZV9h
Y3F1aXJlX2lmX2J1c3koc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpOwogdm9pZCBpOTE1X2FjdGl2
ZV9yZWxlYXNlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsKLXZvaWQgX19pOTE1X2FjdGl2ZV9y
ZWxlYXNlX25lc3RlZChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgaW50IHN1YmNsYXNzKTsKLQot
Ym9vbCBpOTE1X2FjdGl2ZV90cnlncmFiKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsKLXZvaWQg
aTkxNV9hY3RpdmVfdW5ncmFiKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsKIAogc3RhdGljIGlu
bGluZSBib29sCiBpOTE1X2FjdGl2ZV9pc19pZGxlKGNvbnN0IHN0cnVjdCBpOTE1X2FjdGl2ZSAq
cmVmKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmVfdHlwZXMu
aCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5cGVzLmgKaW5kZXggMDIxMTY3
ZjAwMDRkLi4xMjNmMmU4ODMyNjEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfYWN0aXZlX3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmVf
dHlwZXMuaApAQCAtMTcsMTcgKzE3LDkgQEAKIAogI2luY2x1ZGUgImk5MTVfdXRpbHMuaCIKIAot
c3RydWN0IGRybV9pOTE1X3ByaXZhdGU7Ci1zdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdDsKLXN0
cnVjdCBpOTE1X3JlcXVlc3Q7Ci0KLXR5cGVkZWYgdm9pZCAoKmk5MTVfYWN0aXZlX3JldGlyZV9m
bikoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKiwKLQkJCQkgICAgICBzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICopOwotCi1zdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCB7Ci0Jc3RydWN0IGk5MTVf
cmVxdWVzdCBfX3JjdSAqcmVxdWVzdDsKLQlzdHJ1Y3QgbGlzdF9oZWFkIGxpbms7Ci0JaTkxNV9h
Y3RpdmVfcmV0aXJlX2ZuIHJldGlyZTsKK3N0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSB7CisJc3Ry
dWN0IGRtYV9mZW5jZSBfX3JjdSAqZmVuY2U7CisJc3RydWN0IGRtYV9mZW5jZV9jYiBjYjsKICNp
ZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9ERUJVR19HRU0pCiAJLyoKIAkgKiBJbmNvcnBv
cmVhbCEKQEAgLTUzLDEyICs0NSwxMSBAQCBzdHJ1Y3QgYWN0aXZlX25vZGU7CiAjZGVmaW5lIGk5
MTVfYWN0aXZlX21heV9zbGVlcChmbikgcHRyX3BhY2tfYml0cygmKGZuKSwgSTkxNV9BQ1RJVkVf
TUFZX1NMRUVQLCAyKQogCiBzdHJ1Y3QgaTkxNV9hY3RpdmUgewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1OworCWF0b21pY190IGNvdW50OworCXN0cnVjdCBtdXRleCBtdXRleDsKIAog
CXN0cnVjdCBhY3RpdmVfbm9kZSAqY2FjaGU7CiAJc3RydWN0IHJiX3Jvb3QgdHJlZTsKLQlzdHJ1
Y3QgbXV0ZXggbXV0ZXg7Ci0JYXRvbWljX3QgY291bnQ7CiAKIAkvKiBQcmVhbGxvY2F0ZWQgImV4
Y2x1c2l2ZSIgbm9kZSAqLwogCXN0cnVjdCBkbWFfZmVuY2UgX19yY3UgKmV4Y2w7CkBAIC02Niw3
ICs1Nyw2IEBAIHN0cnVjdCBpOTE1X2FjdGl2ZSB7CiAKIAl1bnNpZ25lZCBsb25nIGZsYWdzOwog
I2RlZmluZSBJOTE1X0FDVElWRV9SRVRJUkVfU0xFRVBTIEJJVCgwKQotI2RlZmluZSBJOTE1X0FD
VElWRV9HUkFCX0JJVCAxCiAKIAlpbnQgKCphY3RpdmUpKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVm
KTsKIAl2b2lkICgqcmV0aXJlKShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9nZW0uYwppbmRleCA4NTMyM2NkMDgwMjIuLjhmNGM4YzI5Y2FiOCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbS5jCkBAIC04OTIsMjggKzg5MiwzOCBAQCB3YWl0X2Zvcl90aW1lbGluZXMoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAKIAlzcGluX2xvY2tfaXJxc2F2ZSgmdGltZWxp
bmVzLT5sb2NrLCBmbGFncyk7CiAJbGlzdF9mb3JfZWFjaF9lbnRyeSh0bCwgJnRpbWVsaW5lcy0+
YWN0aXZlX2xpc3QsIGxpbmspIHsKLQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJCXN0cnVj
dCBkbWFfZmVuY2UgKmZlbmNlOwogCi0JCXJxID0gaTkxNV9hY3RpdmVfcmVxdWVzdF9nZXRfdW5s
b2NrZWQoJnRsLT5sYXN0X3JlcXVlc3QpOwotCQlpZiAoIXJxKQorCQlmZW5jZSA9IGk5MTVfYWN0
aXZlX2ZlbmNlX2dldCgmdGwtPmxhc3RfcmVxdWVzdCk7CisJCWlmICghZmVuY2UpCiAJCQljb250
aW51ZTsKIAogCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZ0aW1lbGluZXMtPmxvY2ssIGZsYWdz
KTsKIAotCQkvKgotCQkgKiAiUmFjZS10by1pZGxlIi4KLQkJICoKLQkJICogU3dpdGNoaW5nIHRv
IHRoZSBrZXJuZWwgY29udGV4dCBpcyBvZnRlbiB1c2VkIGEgc3luY2hyb25vdXMKLQkJICogc3Rl
cCBwcmlvciB0byBpZGxpbmcsIGUuZy4gaW4gc3VzcGVuZCBmb3IgZmx1c2hpbmcgYWxsCi0JCSAq
IGN1cnJlbnQgb3BlcmF0aW9ucyB0byBtZW1vcnkgYmVmb3JlIHNsZWVwaW5nLiBUaGVzZSB3ZQot
CQkgKiB3YW50IHRvIGNvbXBsZXRlIGFzIHF1aWNrbHkgYXMgcG9zc2libGUgdG8gYXZvaWQgcHJv
bG9uZ2VkCi0JCSAqIHN0YWxscywgc28gYWxsb3cgdGhlIGdwdSB0byBib29zdCB0byBtYXhpbXVt
IGNsb2Nrcy4KLQkJICovCi0JCWlmICh3YWl0ICYgSTkxNV9XQUlUX0ZPUl9JRExFX0JPT1NUKQot
CQkJZ2VuNl9ycHNfYm9vc3QocnEpOworCQlpZiAoIWRtYV9mZW5jZV9pc19pOTE1KGZlbmNlKSkg
eworCQkJdGltZW91dCA9IGRtYV9mZW5jZV93YWl0X3RpbWVvdXQoZmVuY2UsCisJCQkJCQkJIGZs
YWdzICYgSTkxNV9XQUlUX0lOVEVSUlVQVElCTEUsCisJCQkJCQkJIHRpbWVvdXQpOworCQl9IGVs
c2UgeworCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEgPSB0b19yZXF1ZXN0KGZlbmNlKTsKKwor
CQkJLyoKKwkJCSAqICJSYWNlLXRvLWlkbGUiLgorCQkJICoKKwkJCSAqIFN3aXRjaGluZyB0byB0
aGUga2VybmVsIGNvbnRleHQgaXMgb2Z0ZW4gdXNlZCBhcworCQkJICogYSBzeW5jaHJvbm91cyBz
dGVwIHByaW9yIHRvIGlkbGluZywgZS5nLiBpbiBzdXNwZW5kCisJCQkgKiBmb3IgZmx1c2hpbmcg
YWxsIGN1cnJlbnQgb3BlcmF0aW9ucyB0byBtZW1vcnkgYmVmb3JlCisJCQkgKiBzbGVlcGluZy4g
VGhlc2Ugd2Ugd2FudCB0byBjb21wbGV0ZSBhcyBxdWlja2x5IGFzCisJCQkgKiBwb3NzaWJsZSB0
byBhdm9pZCBwcm9sb25nZWQgc3RhbGxzLCBzbyBhbGxvdyB0aGUgZ3B1CisJCQkgKiB0byBib29z
dCB0byBtYXhpbXVtIGNsb2Nrcy4KKwkJCSAqLworCQkJaWYgKGZsYWdzICYgSTkxNV9XQUlUX0ZP
Ul9JRExFX0JPT1NUKQorCQkJCWdlbjZfcnBzX2Jvb3N0KHJxKTsKKworCQkJdGltZW91dCA9IGk5
MTVfcmVxdWVzdF93YWl0KHJxLCBmbGFncywgdGltZW91dCk7CisJCX0KIAotCQl0aW1lb3V0ID0g
aTkxNV9yZXF1ZXN0X3dhaXQocnEsIHdhaXQsIHRpbWVvdXQpOwotCQlpOTE1X3JlcXVlc3RfcHV0
KHJxKTsKKwkJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CiAJCWlmICh0aW1lb3V0IDwgMCkKIAkJCXJl
dHVybiB0aW1lb3V0OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dl
bV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCmluZGV4IDhmNzQy
ZjNlZWM2MC4uMjY4MGIzODhkYzMzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwpA
QCAtMTg2Miw3ICsxODYyLDYgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBpOTE1X3ZtYV9vcHMgcGRf
dm1hX29wcyA9IHsKIAogc3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqcGRfdm1hX2NyZWF0ZShzdHJ1
Y3QgZ2VuNl9wcGd0dCAqcHBndHQsIGludCBzaXplKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gcHBndHQtPmJhc2Uudm0uaTkxNTsKIAlzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0
ID0gcHBndHQtPmJhc2Uudm0uZ3QtPmdndHQ7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAKQEAg
LTE4NzMsNyArMTg3Miw3IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKnBkX3ZtYV9jcmVhdGUo
c3RydWN0IGdlbjZfcHBndHQgKnBwZ3R0LCBpbnQgc2l6ZSkKIAlpZiAoIXZtYSkKIAkJcmV0dXJu
IEVSUl9QVFIoLUVOT01FTSk7CiAKLQlpOTE1X2FjdGl2ZV9pbml0KGk5MTUsICZ2bWEtPmFjdGl2
ZSwgTlVMTCwgTlVMTCk7CisJaTkxNV9hY3RpdmVfaW5pdCgmdm1hLT5hY3RpdmUsIE5VTEwsIE5V
TEwpOwogCiAJdm1hLT52bSA9IGk5MTVfdm1fZ2V0KCZnZ3R0LT52bSk7CiAJdm1hLT5vcHMgPSAm
cGRfdm1hX29wczsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vy
cm9yLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5jCmluZGV4IGUyODRi
ZDc2ZmE4Ni4uZGNlZDg2ZTRhOTVlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dwdV9lcnJvci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9y
LmMKQEAgLTEyOTEsNyArMTI5MSw3IEBAIGNhcHR1cmVfdm1hKHN0cnVjdCBjYXB0dXJlX3ZtYSAq
bmV4dCwKIAlpZiAoIWMpCiAJCXJldHVybiBuZXh0OwogCi0JaWYgKCFpOTE1X2FjdGl2ZV90cnln
cmFiKCZ2bWEtPmFjdGl2ZSkpIHsKKwlpZiAoIWk5MTVfYWN0aXZlX2FjcXVpcmVfaWZfYnVzeSgm
dm1hLT5hY3RpdmUpKSB7CiAJCWtmcmVlKGMpOwogCQlyZXR1cm4gbmV4dDsKIAl9CkBAIC0xNDMx
LDcgKzE0MzEsNyBAQCBnZW1fcmVjb3JkX3JpbmdzKHN0cnVjdCBpOTE1X2dwdV9zdGF0ZSAqZXJy
b3IsIHN0cnVjdCBjb21wcmVzcyAqY29tcHJlc3MpCiAJCQkqdGhpcy0+c2xvdCA9CiAJCQkJaTkx
NV9lcnJvcl9vYmplY3RfY3JlYXRlKGk5MTUsIHZtYSwgY29tcHJlc3MpOwogCi0JCQlpOTE1X2Fj
dGl2ZV91bmdyYWIoJnZtYS0+YWN0aXZlKTsKKwkJCWk5MTVfYWN0aXZlX3JlbGVhc2UoJnZtYS0+
YWN0aXZlKTsKIAkJCWk5MTVfdm1hX3B1dCh2bWEpOwogCiAJCQljYXB0dXJlID0gdGhpcy0+bmV4
dDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKaW5kZXggYTUzNzc3ZGQzNzFjLi5lOWMw
YTA2OGNlZWMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCkBAIC0xOTYsOSArMTk2
LDggQEAgc3RhdGljIHZvaWQgZnJlZV9jYXB0dXJlX2xpc3Qoc3RydWN0IGk5MTVfcmVxdWVzdCAq
cmVxdWVzdCkKIAogc3RhdGljIGJvb2wgaTkxNV9yZXF1ZXN0X3JldGlyZShzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpycSkKIHsKLQlzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLCAqbmV4
dDsKLQogCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnJxLT50aW1lbGluZS0+bXV0ZXgpOworCiAJaWYg
KCFpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJxKSkKIAkJcmV0dXJuIGZhbHNlOwogCkBAIC0yMjIs
MzUgKzIyMSw2IEBAIHN0YXRpYyBib29sIGk5MTVfcmVxdWVzdF9yZXRpcmUoc3RydWN0IGk5MTVf
cmVxdWVzdCAqcnEpCiAJR0VNX0JVR19PTighbGlzdF9pc19maXJzdCgmcnEtPmxpbmssICZycS0+
dGltZWxpbmUtPnJlcXVlc3RzKSk7CiAJcnEtPnJpbmctPmhlYWQgPSBycS0+cG9zdGZpeDsKIAot
CS8qCi0JICogV2FsayB0aHJvdWdoIHRoZSBhY3RpdmUgbGlzdCwgY2FsbGluZyByZXRpcmUgb24g
ZWFjaC4gVGhpcyBhbGxvd3MKLQkgKiBvYmplY3RzIHRvIHRyYWNrIHRoZWlyIEdQVSBhY3Rpdml0
eSBhbmQgbWFyayB0aGVtc2VsdmVzIGFzIGlkbGUKLQkgKiB3aGVuIHRoZWlyICpsYXN0KiBhY3Rp
dmUgcmVxdWVzdCBpcyBjb21wbGV0ZWQgKHVwZGF0aW5nIHN0YXRlCi0JICogdHJhY2tpbmcgbGlz
dHMgZm9yIGV2aWN0aW9uLCBhY3RpdmUgcmVmZXJlbmNlcyBmb3IgR0VNLCBldGMpLgotCSAqCi0J
ICogQXMgdGhlIC0+cmV0aXJlKCkgbWF5IGZyZWUgdGhlIG5vZGUsIHdlIGRlY291cGxlIGl0IGZp
cnN0IGFuZAotCSAqIHBhc3MgYWxvbmcgdGhlIGF1eGlsaWFyeSBpbmZvcm1hdGlvbiAodG8gYXZv
aWQgZGVyZWZlcmVuY2luZwotCSAqIHRoZSBub2RlIGFmdGVyIHRoZSBjYWxsYmFjaykuCi0JICov
Ci0JbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKGFjdGl2ZSwgbmV4dCwgJnJxLT5hY3RpdmVfbGlz
dCwgbGluaykgewotCQkvKgotCQkgKiBJbiBtaWNyb2JlbmNobWFya3Mgb3IgZm9jdXNpbmcgdXBv
biB0aW1lIGluc2lkZSB0aGUga2VybmVsLAotCQkgKiB3ZSBtYXkgc3BlbmQgYW4gaW5vcmRpbmF0
ZSBhbW91bnQgb2YgdGltZSBzaW1wbHkgaGFuZGxpbmcKLQkJICogdGhlIHJldGlyZW1lbnQgb2Yg
cmVxdWVzdHMgYW5kIHByb2Nlc3NpbmcgdGhlaXIgY2FsbGJhY2tzLgotCQkgKiBPZiB3aGljaCwg
dGhpcyBsb29wIGl0c2VsZiBpcyBwYXJ0aWN1bGFybHkgaG90IGR1ZSB0byB0aGUKLQkJICogY2Fj
aGUgbWlzc2VzIHdoZW4ganVtcGluZyBhcm91bmQgdGhlIGxpc3Qgb2YKLQkJICogaTkxNV9hY3Rp
dmVfcmVxdWVzdC4gIFNvIHdlIHRyeSB0byBrZWVwIHRoaXMgbG9vcCBhcwotCQkgKiBzdHJlYW1s
aW5lZCBhcyBwb3NzaWJsZSBhbmQgYWxzbyBwcmVmZXRjaCB0aGUgbmV4dAotCQkgKiBpOTE1X2Fj
dGl2ZV9yZXF1ZXN0IHRvIHRyeSBhbmQgaGlkZSB0aGUgbGlrZWx5IGNhY2hlIG1pc3MuCi0JCSAq
LwotCQlwcmVmZXRjaHcobmV4dCk7Ci0KLQkJSU5JVF9MSVNUX0hFQUQoJmFjdGl2ZS0+bGluayk7
Ci0JCVJDVV9JTklUX1BPSU5URVIoYWN0aXZlLT5yZXF1ZXN0LCBOVUxMKTsKLQotCQlhY3RpdmUt
PnJldGlyZShhY3RpdmUsIHJxKTsKLQl9Ci0KIAlsb2NhbF9pcnFfZGlzYWJsZSgpOwogCiAJLyoK
QEAgLTY2Myw3ICs2MzMsNiBAQCBfX2k5MTVfcmVxdWVzdF9jcmVhdGUoc3RydWN0IGludGVsX2Nv
bnRleHQgKmNlLCBnZnBfdCBnZnApCiAJcnEtPmZsYWdzID0gMDsKIAlycS0+ZXhlY3V0aW9uX21h
c2sgPSBBTExfRU5HSU5FUzsKIAotCUlOSVRfTElTVF9IRUFEKCZycS0+YWN0aXZlX2xpc3QpOwog
CUlOSVRfTElTVF9IRUFEKCZycS0+ZXhlY3V0ZV9jYik7CiAKIAkvKgpAQCAtNzAyLDcgKzY3MSw2
IEBAIF9faTkxNV9yZXF1ZXN0X2NyZWF0ZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIGdmcF90
IGdmcCkKIAljZS0+cmluZy0+ZW1pdCA9IHJxLT5oZWFkOwogCiAJLyogTWFrZSBzdXJlIHdlIGRp
ZG4ndCBhZGQgb3Vyc2VsdmVzIHRvIGV4dGVybmFsIHN0YXRlIGJlZm9yZSBmcmVlaW5nICovCi0J
R0VNX0JVR19PTighbGlzdF9lbXB0eSgmcnEtPmFjdGl2ZV9saXN0KSk7CiAJR0VNX0JVR19PTigh
bGlzdF9lbXB0eSgmcnEtPnNjaGVkLnNpZ25hbGVyc19saXN0KSk7CiAJR0VNX0JVR19PTighbGlz
dF9lbXB0eSgmcnEtPnNjaGVkLndhaXRlcnNfbGlzdCkpOwogCkBAIC0xMDk1LDggKzEwNjMsOCBA
QCBfX2k5MTVfcmVxdWVzdF9hZGRfdG9fdGltZWxpbmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEp
CiAJICogcHJlY2x1ZGVzIG9wdGltaXNpbmcgdG8gdXNlIHNlbWFwaG9yZXMgc2VyaWFsaXNhdGlv
biBvZiBhIHNpbmdsZQogCSAqIHRpbWVsaW5lIGFjcm9zcyBlbmdpbmVzLgogCSAqLwotCXByZXYg
PSByY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKHRpbWVsaW5lLT5sYXN0X3JlcXVlc3QucmVxdWVz
dCwKLQkJCQkJIGxvY2tkZXBfaXNfaGVsZCgmdGltZWxpbmUtPm11dGV4KSk7CisJcHJldiA9IHRv
X3JlcXVlc3QoX19pOTE1X2FjdGl2ZV9mZW5jZV9zZXQoJnRpbWVsaW5lLT5sYXN0X3JlcXVlc3Qs
CisJCQkJCQkgICZycS0+ZmVuY2UpKTsKIAlpZiAocHJldiAmJiAhaTkxNV9yZXF1ZXN0X2NvbXBs
ZXRlZChwcmV2KSkgewogCQlpZiAoaXNfcG93ZXJfb2ZfMihwcmV2LT5lbmdpbmUtPm1hc2sgfCBy
cS0+ZW5naW5lLT5tYXNrKSkKIAkJCWk5MTVfc3dfZmVuY2VfYXdhaXRfc3dfZmVuY2UoJnJxLT5z
dWJtaXQsCkBAIC0xMTIxLDcgKzEwODksNiBAQCBfX2k5MTVfcmVxdWVzdF9hZGRfdG9fdGltZWxp
bmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJICogdXMsIHRoZSB0aW1lbGluZSB3aWxsIGhv
bGQgaXRzIHNlcW5vIHdoaWNoIGlzIGxhdGVyIHRoYW4gb3Vycy4KIAkgKi8KIAlHRU1fQlVHX09O
KHRpbWVsaW5lLT5zZXFubyAhPSBycS0+ZmVuY2Uuc2Vxbm8pOwotCV9faTkxNV9hY3RpdmVfcmVx
dWVzdF9zZXQoJnRpbWVsaW5lLT5sYXN0X3JlcXVlc3QsIHJxKTsKIAogCXJldHVybiBwcmV2Owog
fQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmggYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaAppbmRleCA4YWM2ZTEyMjZhNTYuLjMyNTFk
MmJkYmVlYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmgK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmgKQEAgLTIxMSw3ICsyMTEs
NiBAQCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0IHsKIAkgKiBvbiB0aGUgYWN0aXZlX2xpc3QgKG9mIHRo
ZWlyIGZpbmFsIHJlcXVlc3QpLgogCSAqLwogCXN0cnVjdCBpOTE1X2NhcHR1cmVfbGlzdCAqY2Fw
dHVyZV9saXN0OwotCXN0cnVjdCBsaXN0X2hlYWQgYWN0aXZlX2xpc3Q7CiAKIAkvKiogVGltZSBh
dCB3aGljaCB0aGlzIHJlcXVlc3Qgd2FzIGVtaXR0ZWQsIGluIGppZmZpZXMuICovCiAJdW5zaWdu
ZWQgbG9uZyBlbWl0dGVkX2ppZmZpZXM7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3ZtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwppbmRleCA4ZjM2
NTQyMTZiMjUuLmNlNTdkZDM2NmJmMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV92bWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCkBAIC0xMTks
OCArMTE5LDcgQEAgdm1hX2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAog
CXZtYS0+c2l6ZSA9IG9iai0+YmFzZS5zaXplOwogCXZtYS0+ZGlzcGxheV9hbGlnbm1lbnQgPSBJ
OTE1X0dUVF9NSU5fQUxJR05NRU5UOwogCi0JaTkxNV9hY3RpdmVfaW5pdCh2bS0+aTkxNSwgJnZt
YS0+YWN0aXZlLAotCQkJIF9faTkxNV92bWFfYWN0aXZlLCBfX2k5MTVfdm1hX3JldGlyZSk7CisJ
aTkxNV9hY3RpdmVfaW5pdCgmdm1hLT5hY3RpdmUsIF9faTkxNV92bWFfYWN0aXZlLCBfX2k5MTVf
dm1hX3JldGlyZSk7CiAKIAkvKiBEZWNsYXJlIG91cnNlbHZlcyBzYWZlIGZvciB1c2UgaW5zaWRl
IHNocmlua2VycyAqLwogCWlmIChJU19FTkFCTEVEKENPTkZJR19MT0NLREVQKSkgewpAQCAtOTkz
LDcgKzk5Miw3IEBAIGludCBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShzdHJ1Y3QgaTkxNV92bWEg
KnZtYSwKIAkgKiBhZGQgdGhlIGFjdGl2ZSByZWZlcmVuY2UgZmlyc3QgYW5kIHF1ZXVlIGZvciBp
dCB0byBiZSBkcm9wcGVkCiAJICogKmxhc3QqLgogCSAqLwotCWVyciA9IGk5MTVfYWN0aXZlX3Jl
Zigmdm1hLT5hY3RpdmUsIHJxLT50aW1lbGluZSwgcnEpOworCWVyciA9IGk5MTVfYWN0aXZlX3Jl
Zigmdm1hLT5hY3RpdmUsIHJxLT50aW1lbGluZSwgJnJxLT5mZW5jZSk7CiAJaWYgKHVubGlrZWx5
KGVycikpCiAJCXJldHVybiBlcnI7CiAKQEAgLTEwMDEsNyArMTAwMCw3IEBAIGludCBpOTE1X3Zt
YV9tb3ZlX3RvX2FjdGl2ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAkJaWYgKGludGVsX2Zyb250
YnVmZmVyX2ludmFsaWRhdGUob2JqLT5mcm9udGJ1ZmZlciwgT1JJR0lOX0NTKSkKIAkJCWk5MTVf
YWN0aXZlX3JlZigmb2JqLT5mcm9udGJ1ZmZlci0+d3JpdGUsCiAJCQkJCXJxLT50aW1lbGluZSwK
LQkJCQkJcnEpOworCQkJCQkmcnEtPmZlbmNlKTsKIAogCQlkbWFfcmVzdl9hZGRfZXhjbF9mZW5j
ZSh2bWEtPnJlc3YsICZycS0+ZmVuY2UpOwogCQlvYmotPndyaXRlX2RvbWFpbiA9IEk5MTVfR0VN
X0RPTUFJTl9SRU5ERVI7CkBAIC0xMDM1LDYgKzEwMzQsNyBAQCBpbnQgaTkxNV92bWFfdW5iaW5k
KHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKKwlHRU1f
QlVHX09OKGk5MTVfdm1hX2lzX2FjdGl2ZSh2bWEpKTsKIAlpZiAoaTkxNV92bWFfaXNfcGlubmVk
KHZtYSkpIHsKIAkJdm1hX3ByaW50X2FsbG9jYXRvcih2bWEsICJpcyBwaW5uZWQiKTsKIAkJcmV0
dXJuIC1FQlVTWTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
OTE1X2FjdGl2ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfYWN0aXZl
LmMKaW5kZXggZDVhYzk5NDRkMDkzLi5hZjU4MjdhYWM3YjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jCkBAIC02OCw3ICs2OCw3IEBAIHN0YXRpYyBz
dHJ1Y3QgbGl2ZV9hY3RpdmUgKl9fbGl2ZV9hbGxvYyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIAkJcmV0dXJuIE5VTEw7CiAKIAlrcmVmX2luaXQoJmFjdGl2ZS0+cmVmKTsKLQlpOTE1
X2FjdGl2ZV9pbml0KGk5MTUsICZhY3RpdmUtPmJhc2UsIF9fbGl2ZV9hY3RpdmUsIF9fbGl2ZV9y
ZXRpcmUpOworCWk5MTVfYWN0aXZlX2luaXQoJmFjdGl2ZS0+YmFzZSwgX19saXZlX2FjdGl2ZSwg
X19saXZlX3JldGlyZSk7CiAKIAlyZXR1cm4gYWN0aXZlOwogfQpAQCAtMTEwLDcgKzExMCw5IEBA
IF9fbGl2ZV9hY3RpdmVfc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJCQkJ
CQkgICAgICAgc3VibWl0LAogCQkJCQkJICAgICAgIEdGUF9LRVJORUwpOwogCQlpZiAoZXJyID49
IDApCi0JCQllcnIgPSBpOTE1X2FjdGl2ZV9yZWYoJmFjdGl2ZS0+YmFzZSwgcnEtPnRpbWVsaW5l
LCBycSk7CisJCQllcnIgPSBpOTE1X2FjdGl2ZV9yZWYoJmFjdGl2ZS0+YmFzZSwKKwkJCQkJICAg
ICAgcnEtPnRpbWVsaW5lLAorCQkJCQkgICAgICAmcnEtPmZlbmNlKTsKIAkJaTkxNV9yZXF1ZXN0
X2FkZChycSk7CiAJCWlmIChlcnIpIHsKIAkJCXByX2VycigiRmFpbGVkIHRvIHRyYWNrIGFjdGl2
ZSByZWYhXG4iKTsKQEAgLTE0NiwxOSArMTQ4LDEzIEBAIHN0YXRpYyBpbnQgbGl2ZV9hY3RpdmVf
d2FpdCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7
CiAJc3RydWN0IGxpdmVfYWN0aXZlICphY3RpdmU7Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7
CiAJaW50IGVyciA9IDA7CiAKIAkvKiBDaGVjayB0aGF0IHdlIGdldCBhIGNhbGxiYWNrIHdoZW4g
cmVxdWVzdHMgcmV0aXJlIHVwb24gd2FpdGluZyAqLwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5y
dW50aW1lX3BtKTsKLQogCWFjdGl2ZSA9IF9fbGl2ZV9hY3RpdmVfc2V0dXAoaTkxNSk7Ci0JaWYg
KElTX0VSUihhY3RpdmUpKSB7Ci0JCWVyciA9IFBUUl9FUlIoYWN0aXZlKTsKLQkJZ290byBlcnI7
Ci0JfQorCWlmIChJU19FUlIoYWN0aXZlKSkKKwkJcmV0dXJuIFBUUl9FUlIoYWN0aXZlKTsKIAog
CWk5MTVfYWN0aXZlX3dhaXQoJmFjdGl2ZS0+YmFzZSk7CiAJaWYgKCFSRUFEX09OQ0UoYWN0aXZl
LT5yZXRpcmVkKSkgewpAQCAtMTY4LDExICsxNjQsOSBAQCBzdGF0aWMgaW50IGxpdmVfYWN0aXZl
X3dhaXQodm9pZCAqYXJnKQogCiAJX19saXZlX3B1dChhY3RpdmUpOwogCisJbXV0ZXhfbG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVf
V0FJVF9MT0NLRUQpKQogCQllcnIgPSAtRUlPOwotCi1lcnI6Ci0JaW50ZWxfcnVudGltZV9wbV9w
dXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwogCW11dGV4X3VubG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CiAKIAlyZXR1cm4gZXJyOwpAQCAtMTgyLDIzICsxNzYsMTkgQEAgc3Rh
dGljIGludCBsaXZlX2FjdGl2ZV9yZXRpcmUodm9pZCAqYXJnKQogewogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gYXJnOwogCXN0cnVjdCBsaXZlX2FjdGl2ZSAqYWN0aXZlOwotCWlu
dGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCWludCBlcnIgPSAwOwogCiAJLyogQ2hlY2sgdGhhdCB3
ZSBnZXQgYSBjYWxsYmFjayB3aGVuIHJlcXVlc3RzIGFyZSBpbmRpcmVjdGx5IHJldGlyZWQgKi8K
IAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCXdha2VyZWYgPSBpbnRl
bF9ydW50aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7Ci0KIAlhY3RpdmUgPSBfX2xpdmVf
YWN0aXZlX3NldHVwKGk5MTUpOwotCWlmIChJU19FUlIoYWN0aXZlKSkgewotCQllcnIgPSBQVFJf
RVJSKGFjdGl2ZSk7Ci0JCWdvdG8gZXJyOwotCX0KKwlpZiAoSVNfRVJSKGFjdGl2ZSkpCisJCXJl
dHVybiBQVFJfRVJSKGFjdGl2ZSk7CiAKIAkvKiB3YWl0cyBmb3IgJiByZXRpcmVzIGFsbCByZXF1
ZXN0cyAqLworCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChpZ3Rf
Zmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKIAkJZXJyID0gLUVJTzsKKwltdXRl
eF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJaWYgKCFSRUFEX09OQ0UoYWN0
aXZlLT5yZXRpcmVkKSkgewogCQlwcl9lcnIoImk5MTVfYWN0aXZlIG5vdCByZXRpcmVkIGFmdGVy
IGZsdXNoaW5nIVxuIik7CkBAIC0yMDcsMTAgKzE5Nyw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9hY3Rp
dmVfcmV0aXJlKHZvaWQgKmFyZykKIAogCV9fbGl2ZV9wdXQoYWN0aXZlKTsKIAotZXJyOgotCWlu
dGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91
bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJcmV0dXJuIGVycjsKIH0KIAotLSAK
Mi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJ
bnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0
cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

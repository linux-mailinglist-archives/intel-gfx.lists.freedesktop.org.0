Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id A36214C4B6
	for <lists+intel-gfx@lfdr.de>; Thu, 20 Jun 2019 03:00:55 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EEA196E4AB;
	Thu, 20 Jun 2019 01:00:52 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga01.intel.com (mga01.intel.com [192.55.52.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D6EC06E4A3
 for <intel-gfx@lists.freedesktop.org>; Thu, 20 Jun 2019 01:00:46 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga007.jf.intel.com ([10.7.209.58])
 by fmsmga101.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 19 Jun 2019 18:00:46 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,394,1557212400"; d="scan'208";a="150774388"
Received: from dceraolo-linux.fm.intel.com ([10.1.27.145])
 by orsmga007.jf.intel.com with ESMTP; 19 Jun 2019 18:00:46 -0700
From: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 19 Jun 2019 18:00:19 -0700
Message-Id: <20190620010021.20637-5-daniele.ceraolospurio@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190620010021.20637-1-daniele.ceraolospurio@intel.com>
References: <20190620010021.20637-1-daniele.ceraolospurio@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 4/6] drm/i915: skip forcewake actions on
 forcewake-less uncore
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgYWx3YXlzIGNhbGwgc29tZSBvZiB0aGUgc2V0dXAvY2xlYW51cCBmdW5jdGlvbnMgZm9yIGZv
cmNld2FrZSwgZXZlbgppZiB0aGUgZmVhdHVyZSBpcyBub3QgYWN0dWFsbHkgYXZhaWxhYmxlLiBT
a2lwcGluZyB0aGVzZSBvcGVyYXRpb25zIGlmCmZvcmNld2FrZSBpcyBub3QgYXZhaWxhYmxlIHNh
dmVzIHVzIHNvbWUgb3BlcmF0aW9ucyBvbiBvbGRlciBnZW5zIGFuZApwcmVwYXJlcyB1cyBmb3Ig
aGF2aW5nIGEgZm9yY2V3YWtlLWxlc3MgZGlzcGxheSB1bmNvcmUuCgp2MjogZG8gbm90IG1ha2Ug
c3VzcGVuZC9yZXN1bWUgZnVuY3Rpb25zIGZvcmNld2FrZS1zcGVjaWZpYyAoQ2hyaXMsClR2cnRr
byksIHVzZSBHRU1fQlVHX09OIGluIGludGVybmFsIGZvcmNld2FrZS1vbmx5IGZ1bmN0aW9ucyAo
VHZydGtvKQoKU2lnbmVkLW9mZi1ieTogRGFuaWVsZSBDZXJhb2xvIFNwdXJpbyA8ZGFuaWVsZS5j
ZXJhb2xvc3B1cmlvQGludGVsLmNvbT4KQ2M6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2ls
c29uLmNvLnVrPgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGxpbnV4LmludGVs
LmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF91bmNvcmUuYyB8IDE0MyArKysr
KysrKysrKysrKysrKy0tLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgODcgaW5zZXJ0aW9ucygr
KSwgNTYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfdW5jb3JlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF91bmNvcmUuYwppbmRleCA1
OWNiMjU4MzEyYTIuLjAwYmY1ZTA4NWEyYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfdW5jb3JlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdW5jb3Jl
LmMKQEAgLTQ4NSwxMiArNDg1LDEwIEBAIGNoZWNrX2Zvcl91bmNsYWltZWRfbW1pbyhzdHJ1Y3Qg
aW50ZWxfdW5jb3JlICp1bmNvcmUpCiAJcmV0dXJuIHJldDsKIH0KIAotc3RhdGljIHZvaWQgX19p
bnRlbF91bmNvcmVfZWFybHlfc2FuaXRpemUoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlLAot
CQkJCQkgIHVuc2lnbmVkIGludCByZXN0b3JlX2ZvcmNld2FrZSkKK3N0YXRpYyB2b2lkIGZvcmNl
d2FrZV9lYXJseV9zYW5pdGl6ZShzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUsCisJCQkJICAg
ICB1bnNpZ25lZCBpbnQgcmVzdG9yZV9mb3JjZXdha2UpCiB7Ci0JLyogY2xlYXIgb3V0IHVuY2xh
aW1lZCByZWcgZGV0ZWN0aW9uIGJpdCAqLwotCWlmIChjaGVja19mb3JfdW5jbGFpbWVkX21taW8o
dW5jb3JlKSkKLQkJRFJNX0RFQlVHKCJ1bmNsYWltZWQgbW1pbyBkZXRlY3RlZCBvbiB1bmNvcmUg
aW5pdCwgY2xlYXJpbmdcbiIpOworCUdFTV9CVUdfT04oIWludGVsX3VuY29yZV9oYXNfZm9yY2V3
YWtlKHVuY29yZSkpOwogCiAJLyogV2FEaXNhYmxlU2hhZG93UmVnRm9yQ3BkOmNodiAqLwogCWlm
IChJU19DSEVSUllWSUVXKHVuY29yZS0+aTkxNSkpIHsKQEAgLTUxNSw2ICs1MTMsOSBAQCBzdGF0
aWMgdm9pZCBfX2ludGVsX3VuY29yZV9lYXJseV9zYW5pdGl6ZShzdHJ1Y3QgaW50ZWxfdW5jb3Jl
ICp1bmNvcmUsCiAKIHZvaWQgaW50ZWxfdW5jb3JlX3N1c3BlbmQoc3RydWN0IGludGVsX3VuY29y
ZSAqdW5jb3JlKQogeworCWlmICghaW50ZWxfdW5jb3JlX2hhc19mb3JjZXdha2UodW5jb3JlKSkK
KwkJcmV0dXJuOworCiAJaW9zZl9tYmlfcHVuaXRfYWNxdWlyZSgpOwogCWlvc2ZfbWJpX3VucmVn
aXN0ZXJfcG1pY19idXNfYWNjZXNzX25vdGlmaWVyX3VubG9ja2VkKAogCQkmdW5jb3JlLT5wbWlj
X2J1c19hY2Nlc3NfbmIpOwpAQCAtNTI2LDE0ICs1MjcsMjMgQEAgdm9pZCBpbnRlbF91bmNvcmVf
cmVzdW1lX2Vhcmx5KHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSkKIHsKIAl1bnNpZ25lZCBp
bnQgcmVzdG9yZV9mb3JjZXdha2U7CiAKKwlpZiAoaW50ZWxfdW5jb3JlX3VuY2xhaW1lZF9tbWlv
KHVuY29yZSkpCisJCURSTV9ERUJVRygidW5jbGFpbWVkIG1taW8gZGV0ZWN0ZWQgb24gcmVzdW1l
LCBjbGVhcmluZ1xuIik7CisKKwlpZiAoIWludGVsX3VuY29yZV9oYXNfZm9yY2V3YWtlKHVuY29y
ZSkpCisJCXJldHVybjsKKwogCXJlc3RvcmVfZm9yY2V3YWtlID0gZmV0Y2hfYW5kX3plcm8oJnVu
Y29yZS0+ZndfZG9tYWluc19zYXZlZCk7Ci0JX19pbnRlbF91bmNvcmVfZWFybHlfc2FuaXRpemUo
dW5jb3JlLCByZXN0b3JlX2ZvcmNld2FrZSk7CisJZm9yY2V3YWtlX2Vhcmx5X3Nhbml0aXplKHVu
Y29yZSwgcmVzdG9yZV9mb3JjZXdha2UpOwogCiAJaW9zZl9tYmlfcmVnaXN0ZXJfcG1pY19idXNf
YWNjZXNzX25vdGlmaWVyKCZ1bmNvcmUtPnBtaWNfYnVzX2FjY2Vzc19uYik7CiB9CiAKIHZvaWQg
aW50ZWxfdW5jb3JlX3J1bnRpbWVfcmVzdW1lKHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSkK
IHsKKwlpZiAoIWludGVsX3VuY29yZV9oYXNfZm9yY2V3YWtlKHVuY29yZSkpCisJCXJldHVybjsK
KwogCWlvc2ZfbWJpX3JlZ2lzdGVyX3BtaWNfYnVzX2FjY2Vzc19ub3RpZmllcigmdW5jb3JlLT5w
bWljX2J1c19hY2Nlc3NfbmIpOwogfQogCkBAIC0xMzQ4LDggKzEzNTgsNyBAQCBzdGF0aWMgdm9p
ZCBpbnRlbF91bmNvcmVfZndfZG9tYWluc19pbml0KHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29y
ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHVuY29yZS0+aTkxNTsKIAot
CWlmICghaW50ZWxfdW5jb3JlX2hhc19mb3JjZXdha2UodW5jb3JlKSkKLQkJcmV0dXJuOworCUdF
TV9CVUdfT04oIWludGVsX3VuY29yZV9oYXNfZm9yY2V3YWtlKHVuY29yZSkpOwogCiAJaWYgKElO
VEVMX0dFTihpOTE1KSA+PSAxMSkgewogCQlpbnQgaTsKQEAgLTE1NDIsMzYgKzE1NTEsMjkgQEAg
dm9pZCBpbnRlbF91bmNvcmVfaW5pdF9lYXJseShzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUs
CiAJdW5jb3JlLT5ycG0gPSAmaTkxNS0+cnVudGltZV9wbTsKIH0KIAotaW50IGludGVsX3VuY29y
ZV9pbml0X21taW8oc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQorc3RhdGljIHZvaWQgdW5j
b3JlX3Jhd19pbml0KHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSkKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHVuY29yZS0+aTkxNTsKLQlpbnQgcmV0OworCUdFTV9CVUdf
T04oaW50ZWxfdW5jb3JlX2hhc19mb3JjZXdha2UodW5jb3JlKSk7CiAKLQlyZXQgPSB1bmNvcmVf
bW1pb19zZXR1cCh1bmNvcmUpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7CisJaWYgKElTX0dF
Tih1bmNvcmUtPmk5MTUsIDUpKSB7CisJCUFTU0lHTl9SQVdfV1JJVEVfTU1JT19WRlVOQ1ModW5j
b3JlLCBnZW41KTsKKwkJQVNTSUdOX1JBV19SRUFEX01NSU9fVkZVTkNTKHVuY29yZSwgZ2VuNSk7
CisJfSBlbHNlIHsKKwkJQVNTSUdOX1JBV19XUklURV9NTUlPX1ZGVU5DUyh1bmNvcmUsIGdlbjIp
OworCQlBU1NJR05fUkFXX1JFQURfTU1JT19WRlVOQ1ModW5jb3JlLCBnZW4yKTsKKwl9Cit9CiAK
LQlpOTE1X2NoZWNrX3ZncHUoaTkxNSk7CitzdGF0aWMgdm9pZCB1bmNvcmVfZm9yY2V3YWtlX2lu
aXQoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1ID0gdW5jb3JlLT5pOTE1OwogCi0JaWYgKElOVEVMX0dFTihpOTE1KSA+IDUgJiYg
IWludGVsX3ZncHVfYWN0aXZlKGk5MTUpKQotCQl1bmNvcmUtPmZsYWdzIHw9IFVOQ09SRV9IQVNf
Rk9SQ0VXQUtFOworCUdFTV9CVUdfT04oIWludGVsX3VuY29yZV9oYXNfZm9yY2V3YWtlKHVuY29y
ZSkpOwogCiAJaW50ZWxfdW5jb3JlX2Z3X2RvbWFpbnNfaW5pdCh1bmNvcmUpOwotCV9faW50ZWxf
dW5jb3JlX2Vhcmx5X3Nhbml0aXplKHVuY29yZSwgMCk7Ci0KLQl1bmNvcmUtPnVuY2xhaW1lZF9t
bWlvX2NoZWNrID0gMTsKLQl1bmNvcmUtPnBtaWNfYnVzX2FjY2Vzc19uYi5ub3RpZmllcl9jYWxs
ID0KLQkJaTkxNV9wbWljX2J1c19hY2Nlc3Nfbm90aWZpZXI7CisJZm9yY2V3YWtlX2Vhcmx5X3Nh
bml0aXplKHVuY29yZSwgMCk7CiAKLQlpZiAoIWludGVsX3VuY29yZV9oYXNfZm9yY2V3YWtlKHVu
Y29yZSkpIHsKLQkJaWYgKElTX0dFTihpOTE1LCA1KSkgewotCQkJQVNTSUdOX1JBV19XUklURV9N
TUlPX1ZGVU5DUyh1bmNvcmUsIGdlbjUpOwotCQkJQVNTSUdOX1JBV19SRUFEX01NSU9fVkZVTkNT
KHVuY29yZSwgZ2VuNSk7Ci0JCX0gZWxzZSB7Ci0JCQlBU1NJR05fUkFXX1dSSVRFX01NSU9fVkZV
TkNTKHVuY29yZSwgZ2VuMik7Ci0JCQlBU1NJR05fUkFXX1JFQURfTU1JT19WRlVOQ1ModW5jb3Jl
LCBnZW4yKTsKLQkJfQotCX0gZWxzZSBpZiAoSVNfR0VOX1JBTkdFKGk5MTUsIDYsIDcpKSB7CisJ
aWYgKElTX0dFTl9SQU5HRShpOTE1LCA2LCA3KSkgewogCQlBU1NJR05fV1JJVEVfTU1JT19WRlVO
Q1ModW5jb3JlLCBnZW42KTsKIAogCQlpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSkgewpAQCAtMTU4
NSw3ICsxNTg3LDYgQEAgaW50IGludGVsX3VuY29yZV9pbml0X21taW8oc3RydWN0IGludGVsX3Vu
Y29yZSAqdW5jb3JlKQogCQkJQVNTSUdOX0ZXX0RPTUFJTlNfVEFCTEUodW5jb3JlLCBfX2Nodl9m
d19yYW5nZXMpOwogCQkJQVNTSUdOX1dSSVRFX01NSU9fVkZVTkNTKHVuY29yZSwgZnd0YWJsZSk7
CiAJCQlBU1NJR05fUkVBRF9NTUlPX1ZGVU5DUyh1bmNvcmUsIGZ3dGFibGUpOwotCiAJCX0gZWxz
ZSB7CiAJCQlBU1NJR05fV1JJVEVfTU1JT19WRlVOQ1ModW5jb3JlLCBnZW44KTsKIAkJCUFTU0lH
Tl9SRUFEX01NSU9fVkZVTkNTKHVuY29yZSwgZ2VuNik7CkBAIC0xNjAwLDYgKzE2MDEsMzEgQEAg
aW50IGludGVsX3VuY29yZV9pbml0X21taW8oc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQog
CQlBU1NJR05fUkVBRF9NTUlPX1ZGVU5DUyh1bmNvcmUsIGdlbjExX2Z3dGFibGUpOwogCX0KIAor
CXVuY29yZS0+cG1pY19idXNfYWNjZXNzX25iLm5vdGlmaWVyX2NhbGwgPSBpOTE1X3BtaWNfYnVz
X2FjY2Vzc19ub3RpZmllcjsKKwlpb3NmX21iaV9yZWdpc3Rlcl9wbWljX2J1c19hY2Nlc3Nfbm90
aWZpZXIoJnVuY29yZS0+cG1pY19idXNfYWNjZXNzX25iKTsKK30KKworaW50IGludGVsX3VuY29y
ZV9pbml0X21taW8oc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQoreworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gdW5jb3JlLT5pOTE1OworCWludCByZXQ7CisKKwlyZXQgPSB1
bmNvcmVfbW1pb19zZXR1cCh1bmNvcmUpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlp
OTE1X2NoZWNrX3ZncHUoaTkxNSk7CisKKwlpZiAoSU5URUxfR0VOKGk5MTUpID4gNSAmJiAhaW50
ZWxfdmdwdV9hY3RpdmUoaTkxNSkpCisJCXVuY29yZS0+ZmxhZ3MgfD0gVU5DT1JFX0hBU19GT1JD
RVdBS0U7CisKKwl1bmNvcmUtPnVuY2xhaW1lZF9tbWlvX2NoZWNrID0gMTsKKworCWlmICghaW50
ZWxfdW5jb3JlX2hhc19mb3JjZXdha2UodW5jb3JlKSkKKwkJdW5jb3JlX3Jhd19pbml0KHVuY29y
ZSk7CisJZWxzZQorCQl1bmNvcmVfZm9yY2V3YWtlX2luaXQodW5jb3JlKTsKKwogCS8qIG1ha2Ug
c3VyZSBmdyBmdW5jcyBhcmUgc2V0IGlmIGFuZCBvbmx5IGlmIHdlIGhhdmUgZncqLwogCUdFTV9C
VUdfT04oaW50ZWxfdW5jb3JlX2hhc19mb3JjZXdha2UodW5jb3JlKSAhPSAhIXVuY29yZS0+ZnVu
Y3MuZm9yY2Vfd2FrZV9nZXQpOwogCUdFTV9CVUdfT04oaW50ZWxfdW5jb3JlX2hhc19mb3JjZXdh
a2UodW5jb3JlKSAhPSAhIXVuY29yZS0+ZnVuY3MuZm9yY2Vfd2FrZV9wdXQpOwpAQCAtMTYxNSw3
ICsxNjQxLDkgQEAgaW50IGludGVsX3VuY29yZV9pbml0X21taW8oc3RydWN0IGludGVsX3VuY29y
ZSAqdW5jb3JlKQogCWlmIChJU19HRU5fUkFOR0UoaTkxNSwgNiwgNykpCiAJCXVuY29yZS0+Zmxh
Z3MgfD0gVU5DT1JFX0hBU19GSUZPOwogCi0JaW9zZl9tYmlfcmVnaXN0ZXJfcG1pY19idXNfYWNj
ZXNzX25vdGlmaWVyKCZ1bmNvcmUtPnBtaWNfYnVzX2FjY2Vzc19uYik7CisJLyogY2xlYXIgb3V0
IHVuY2xhaW1lZCByZWcgZGV0ZWN0aW9uIGJpdCAqLworCWlmIChjaGVja19mb3JfdW5jbGFpbWVk
X21taW8odW5jb3JlKSkKKwkJRFJNX0RFQlVHKCJ1bmNsYWltZWQgbW1pbyBkZXRlY3RlZCBvbiB1
bmNvcmUgaW5pdCwgY2xlYXJpbmdcbiIpOwogCiAJcmV0dXJuIDA7CiB9CkBAIC0xNjI4LDQxICsx
NjU2LDQ0IEBAIGludCBpbnRlbF91bmNvcmVfaW5pdF9tbWlvKHN0cnVjdCBpbnRlbF91bmNvcmUg
KnVuY29yZSkKIHZvaWQgaW50ZWxfdW5jb3JlX3BydW5lX21taW9fZG9tYWlucyhzdHJ1Y3QgaW50
ZWxfdW5jb3JlICp1bmNvcmUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB1
bmNvcmUtPmk5MTU7CisJZW51bSBmb3JjZXdha2VfZG9tYWlucyBmd19kb21haW5zID0gdW5jb3Jl
LT5md19kb21haW5zOworCWVudW0gZm9yY2V3YWtlX2RvbWFpbl9pZCBkb21haW5faWQ7CisJaW50
IGk7CiAKLQlpZiAoSU5URUxfR0VOKGk5MTUpID49IDExKSB7Ci0JCWVudW0gZm9yY2V3YWtlX2Rv
bWFpbnMgZndfZG9tYWlucyA9IHVuY29yZS0+ZndfZG9tYWluczsKLQkJZW51bSBmb3JjZXdha2Vf
ZG9tYWluX2lkIGRvbWFpbl9pZDsKLQkJaW50IGk7CisJaWYgKCFpbnRlbF91bmNvcmVfaGFzX2Zv
cmNld2FrZSh1bmNvcmUpIHx8IElOVEVMX0dFTihpOTE1KSA8IDExKQorCQlyZXR1cm47CiAKLQkJ
Zm9yIChpID0gMDsgaSA8IEk5MTVfTUFYX1ZDUzsgaSsrKSB7Ci0JCQlkb21haW5faWQgPSBGV19E
T01BSU5fSURfTUVESUFfVkRCT1gwICsgaTsKKwlmb3IgKGkgPSAwOyBpIDwgSTkxNV9NQVhfVkNT
OyBpKyspIHsKKwkJZG9tYWluX2lkID0gRldfRE9NQUlOX0lEX01FRElBX1ZEQk9YMCArIGk7CiAK
LQkJCWlmIChIQVNfRU5HSU5FKGk5MTUsIF9WQ1MoaSkpKQotCQkJCWNvbnRpbnVlOworCQlpZiAo
SEFTX0VOR0lORShpOTE1LCBfVkNTKGkpKSkKKwkJCWNvbnRpbnVlOwogCi0JCQlpZiAoZndfZG9t
YWlucyAmIEJJVChkb21haW5faWQpKQotCQkJCWZ3X2RvbWFpbl9maW5pKHVuY29yZSwgZG9tYWlu
X2lkKTsKLQkJfQorCQlpZiAoZndfZG9tYWlucyAmIEJJVChkb21haW5faWQpKQorCQkJZndfZG9t
YWluX2ZpbmkodW5jb3JlLCBkb21haW5faWQpOworCX0KIAotCQlmb3IgKGkgPSAwOyBpIDwgSTkx
NV9NQVhfVkVDUzsgaSsrKSB7Ci0JCQlkb21haW5faWQgPSBGV19ET01BSU5fSURfTUVESUFfVkVC
T1gwICsgaTsKKwlmb3IgKGkgPSAwOyBpIDwgSTkxNV9NQVhfVkVDUzsgaSsrKSB7CisJCWRvbWFp
bl9pZCA9IEZXX0RPTUFJTl9JRF9NRURJQV9WRUJPWDAgKyBpOwogCi0JCQlpZiAoSEFTX0VOR0lO
RShpOTE1LCBfVkVDUyhpKSkpCi0JCQkJY29udGludWU7CisJCWlmIChIQVNfRU5HSU5FKGk5MTUs
IF9WRUNTKGkpKSkKKwkJCWNvbnRpbnVlOwogCi0JCQlpZiAoZndfZG9tYWlucyAmIEJJVChkb21h
aW5faWQpKQotCQkJCWZ3X2RvbWFpbl9maW5pKHVuY29yZSwgZG9tYWluX2lkKTsKLQkJfQorCQlp
ZiAoZndfZG9tYWlucyAmIEJJVChkb21haW5faWQpKQorCQkJZndfZG9tYWluX2ZpbmkodW5jb3Jl
LCBkb21haW5faWQpOwogCX0KIH0KIAogdm9pZCBpbnRlbF91bmNvcmVfZmluaV9tbWlvKHN0cnVj
dCBpbnRlbF91bmNvcmUgKnVuY29yZSkKIHsKLQlpb3NmX21iaV9wdW5pdF9hY3F1aXJlKCk7Ci0J
aW9zZl9tYmlfdW5yZWdpc3Rlcl9wbWljX2J1c19hY2Nlc3Nfbm90aWZpZXJfdW5sb2NrZWQoCi0J
CSZ1bmNvcmUtPnBtaWNfYnVzX2FjY2Vzc19uYik7Ci0JaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9y
ZXNldCh1bmNvcmUpOwotCWlvc2ZfbWJpX3B1bml0X3JlbGVhc2UoKTsKKwlpZiAoaW50ZWxfdW5j
b3JlX2hhc19mb3JjZXdha2UodW5jb3JlKSkgeworCQlpb3NmX21iaV9wdW5pdF9hY3F1aXJlKCk7
CisJCWlvc2ZfbWJpX3VucmVnaXN0ZXJfcG1pY19idXNfYWNjZXNzX25vdGlmaWVyX3VubG9ja2Vk
KAorCQkJJnVuY29yZS0+cG1pY19idXNfYWNjZXNzX25iKTsKKwkJaW50ZWxfdW5jb3JlX2ZvcmNl
d2FrZV9yZXNldCh1bmNvcmUpOworCQlpb3NmX21iaV9wdW5pdF9yZWxlYXNlKCk7CisJfQorCiAJ
dW5jb3JlX21taW9fY2xlYW51cCh1bmNvcmUpOwogfQogCi0tIAoyLjIwLjEKCl9fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxp
c3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNr
dG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

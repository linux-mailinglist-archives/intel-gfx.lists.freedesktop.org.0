Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id DBCABFE0E6
	for <lists+intel-gfx@lfdr.de>; Fri, 15 Nov 2019 16:09:01 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7F8D16E7D4;
	Fri, 15 Nov 2019 15:08:57 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 08E986E7D4
 for <intel-gfx@lists.freedesktop.org>; Fri, 15 Nov 2019 15:08:54 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19214699-1500050 
 for multiple; Fri, 15 Nov 2019 15:08:43 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 15 Nov 2019 15:08:41 +0000
Message-Id: <20191115150841.880349-3-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191115150841.880349-1-chris@chris-wilson.co.uk>
References: <20191115150841.880349-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 3/3] drm/i915/gt: Track engine round-trip times
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

S25vd2luZyB0aGUgcm91bmQgdHJpcCB0aW1lIG9mIGFuIGVuZ2luZSBpcyB1c2VmdWwgZm9yIHRy
YWNraW5nIHRoZQpoZWFsdGggb2YgdGhlIHN5c3RlbSBhcyB3ZWxsIGFzIHByb3ZpZGluZyBhIG1l
dHJpYyBmb3IgdGhlIGJhc2VsaW5lCnJlc3BvbnNpdmVuZXNzIG9mIHRoZSBlbmdpbmUuIFdlIGNh
biB1c2UgdGhlIGxhdHRlciBtZXRyaWMgZm9yCmF1dG9tYXRpY2FsbHkgdHVuaW5nIG91ciB3YWl0
cyBpbiBzZWxmdGVzdHMgYW5kIHdoZW4gaWRsaW5nIHNvIHdlIGRvbid0CmNvbmZ1c2UgYSBzbG93
ZXIgc3lzdGVtIHdpdGggYSBkZWFkIG9uZS4KClVwb24gaWRsaW5nIHRoZSBlbmdpbmUsIHdlIHNl
bmQgb25lIGxhc3QgcHVsc2UgdG8gc3dpdGNoIHRoZSBjb250ZXh0CmF3YXkgZnJvbSBwcmVjaW91
cyB1c2VyIHN0YXRlIHRvIHRoZSB2b2xhdGlsZSBrZXJuZWwgY29udGV4dC4gV2Uga25vdwp0aGUg
ZW5naW5lIGlzIGlkbGUgYXQgdGhpcyBwb2ludCwgYW5kIHRoZSBwdWxzZSBpcyBub24tcHJlZW1w
dGFibGUsIHNvCnRoaXMgcHJvdmlkZXMgdXMgd2l0aCBhIGdvb2QgbWVhc3VyZW1lbnQgb2YgdGhl
IHJvdW5kIHRyaXAgdGltZS4gQQpzZWNvbmRhcnkgZWZmZWN0IGlzIHRoYXQgYnkgaW5zdGFsbGlu
ZyBhbiBpbnRlcnJ1cHQgb250byB0aGUgcHVsc2UsIHdlCmNhbiBmbHVzaCB0aGUgZW5naW5lIGlt
bWVkaWF0ZWx5IHVwb24gY29tcGxldGlvbiwgY3VydGFpbGluZyB0aGUKYmFja2dyb3VuZCBmbHVz
aCBhbmQgZW50ZXJpbmcgcG93ZXJzYXZpbmcgaW1tZWRpYXRlbHkuCgp2MjogTWFuYWdlIHBtIHdh
a2VyZWZzIHRvIGF2b2lkIHRvbyBlYXJseSBtb2R1bGUgdW5sb2FkCmZsdXNoIHRoZSBiYXJyaWVy
IHdoaWxlIHdlIGFyZSBub3Qgd2F0Y2hpbmcuCgpSZWZlcmVuY2VzOiA3ZTM0ZjRlNGFhZDMgKCJk
cm0vaTkxNS9nZW44KzogQWRkIFJDNiBDVFggY29ycnVwdGlvbiBXQSIpClNpZ25lZC1vZmYtYnk6
IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogVHZydGtvIFVyc3Vs
aW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KQ2M6IFN0dWFydCBTdW1tZXJzIDxzdHVhcnQu
c3VtbWVyc0BpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5n
aW5lX2NzLmMgICAgfCAgMiArKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5l
X3BtLmMgICAgfCAzNiArKysrKysrKysrKysrKysrKysrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZW5naW5lX3R5cGVzLmggfCAxMSArKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2d0X3BtLmggICAgICAgIHwgIDUgKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF93YWtlcmVmLmggICAgICAgICB8IDEyICsrKysrKysKIDUgZmlsZXMgY2hhbmdlZCwgNjUg
aW5zZXJ0aW9ucygrKSwgMSBkZWxldGlvbigtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfZW5naW5lX2NzLmMKaW5kZXggYjk2MTNkMDQ0MzkzLi4yZDExZGIxM2RjODkgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jCkBAIC0zMzQsNiArMzM0LDcgQEAg
c3RhdGljIGludCBpbnRlbF9lbmdpbmVfc2V0dXAoc3RydWN0IGludGVsX2d0ICpndCwgZW51bSBp
bnRlbF9lbmdpbmVfaWQgaWQpCiAJLyogTm90aGluZyB0byBkbyBoZXJlLCBleGVjdXRlIGluIG9y
ZGVyIG9mIGRlcGVuZGVuY2llcyAqLwogCWVuZ2luZS0+c2NoZWR1bGUgPSBOVUxMOwogCisJZXdt
YV9kZWxheV9pbml0KCZlbmdpbmUtPmRlbGF5KTsKIAlzZXFsb2NrX2luaXQoJmVuZ2luZS0+c3Rh
dHMubG9jayk7CiAKIAlBVE9NSUNfSU5JVF9OT1RJRklFUl9IRUFEKCZlbmdpbmUtPmNvbnRleHRf
c3RhdHVzX25vdGlmaWVyKTsKQEAgLTE0NzcsNiArMTQ3OCw3IEBAIHZvaWQgaW50ZWxfZW5naW5l
X2R1bXAoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCQlkcm1fcHJpbnRmKG0sICIq
KiogV0VER0VEICoqKlxuIik7CiAKIAlkcm1fcHJpbnRmKG0sICJcdEF3YWtlPyAlZFxuIiwgYXRv
bWljX3JlYWQoJmVuZ2luZS0+d2FrZXJlZi5jb3VudCkpOworCWRybV9wcmludGYobSwgIlx0RGVs
YXk6ICVsdXVzXG4iLCBld21hX2RlbGF5X3JlYWQoJmVuZ2luZS0+ZGVsYXkpKTsKIAogCXJjdV9y
ZWFkX2xvY2soKTsKIAlycSA9IFJFQURfT05DRShlbmdpbmUtPmhlYXJ0YmVhdC5zeXN0b2xlKTsK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMKaW5kZXggM2MwZjQ5MGZm
MmM3Li5lNzliMTRlNDU5OWIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2VuZ2luZV9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2lu
ZV9wbS5jCkBAIC03Myw2ICs3MywyNCBAQCBzdGF0aWMgaW5saW5lIHZvaWQgX190aW1lbGluZV9t
YXJrX3VubG9jayhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAKICNlbmRpZiAvKiAhSVNfRU5B
QkxFRChDT05GSUdfTE9DS0RFUCkgKi8KIAorc3RydWN0IGR1cmF0aW9uX2NiIHsKKwlzdHJ1Y3Qg
ZG1hX2ZlbmNlX2NiIGNiOworCWt0aW1lX3QgZW1pdHRlZDsKK307CisKK3N0YXRpYyB2b2lkIGR1
cmF0aW9uX2NiKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLCBzdHJ1Y3QgZG1hX2ZlbmNlX2NiICpj
YikKK3sKKwlzdHJ1Y3QgZHVyYXRpb25fY2IgKmRjYiA9IGNvbnRhaW5lcl9vZihjYiwgdHlwZW9m
KCpkY2IpLCBjYik7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lID0gdG9fcmVxdWVz
dChmZW5jZSktPmVuZ2luZTsKKworCWV3bWFfZGVsYXlfYWRkKCZlbmdpbmUtPmRlbGF5LAorCQkg
ICAgICAga3RpbWVfdXNfZGVsdGEoa3RpbWVfZ2V0KCksIGRjYi0+ZW1pdHRlZCkpOworCisJLyog
S2ljayByZXRpcmUgZm9yIHF1aWNrZXIgcG93ZXJzYXZpbmcgKHNvZnQtcmM2KS4gKi8KKwltb2Rf
ZGVsYXllZF93b3JrKHN5c3RlbV93cSwgJmVuZ2luZS0+Z3QtPnJlcXVlc3RzLnJldGlyZV93b3Jr
LCAwKTsKKwlpbnRlbF9ndF9wbV9wdXQoZW5naW5lLT5ndCk7Cit9CisKIHN0YXRpYyBib29sIHN3
aXRjaF90b19rZXJuZWxfY29udGV4dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7
CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CkBAIC0xMTQsNyArMTMyLDIzIEBAIHN0YXRpYyBi
b29sIHN3aXRjaF90b19rZXJuZWxfY29udGV4dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmUpCiAKIAkvKiBJbnN0YWxsIG91cnNlbHZlcyBhcyBhIHByZWVtcHRpb24gYmFycmllciAqLwog
CXJxLT5zY2hlZC5hdHRyLnByaW9yaXR5ID0gSTkxNV9QUklPUklUWV9CQVJSSUVSOwotCV9faTkx
NV9yZXF1ZXN0X2NvbW1pdChycSk7CisJaWYgKGxpa2VseSghX19pOTE1X3JlcXVlc3RfY29tbWl0
KHJxKSkpIHsgLyogZW5naW5lIHNob3VsZCBiZSBpZGxlISAqLworCQlzdHJ1Y3QgZHVyYXRpb25f
Y2IgKmRjYjsKKworCQlCVUlMRF9CVUdfT04oc2l6ZW9mKCpkY2IpID4gc2l6ZW9mKHJxLT5zdWJt
aXRxKSk7CisJCWRjYiA9IChzdHJ1Y3QgZHVyYXRpb25fY2IgKikmcnEtPnN1Ym1pdHE7CisKKwkJ
LyoKKwkJICogVXNlIGFuIGludGVycnVwdCBmb3IgcHJlY2lzZSBtZWFzdXJlbWVudCBvZiBkdXJh
dGlvbiwKKwkJICogb3RoZXJ3aXNlIHdlIHJlbHkgb24gc29tZW9uZSBlbHNlIHJldGlyaW5nIGFs
bCB0aGUgcmVxdWVzdHMKKwkJICogd2hpY2ggbWF5IGRlbGF5IHRoZSBzaWduYWxpbmcgKGkuZS4g
d2Ugd2lsbCBsaWtlbHkgd2FpdAorCQkgKiB1bnRpbCB0aGUgYmFja2dyb3VuZCByZXF1ZXN0IHJl
dGlyZW1lbnQgcnVubmluZyBldmVyeQorCQkgKiBzZWNvbmQgb3IgdHdvKS4KKwkJICovCisJCV9f
aW50ZWxfZ3RfcG1fZ2V0KHJxLT5lbmdpbmUtPmd0KTsKKwkJZG1hX2ZlbmNlX2FkZF9jYWxsYmFj
aygmcnEtPmZlbmNlLCAmZGNiLT5jYiwgZHVyYXRpb25fY2IpOworCQlkY2ItPmVtaXR0ZWQgPSBr
dGltZV9nZXQoKTsKKwl9CiAKIAkvKiBSZWxlYXNlIG91ciBleGNsdXNpdmUgaG9sZCBvbiB0aGUg
ZW5naW5lICovCiAJX19pbnRlbF93YWtlcmVmX2RlZmVyX3BhcmsoJmVuZ2luZS0+d2FrZXJlZik7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMu
aCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5oCmluZGV4IDc1
OGYwZThlYzY3Mi4uMWRlMTIxNTgzNDgyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9lbmdpbmVfdHlwZXMuaApAQCAtNyw2ICs3LDcgQEAKICNpZm5kZWYgX19JTlRFTF9FTkdJ
TkVfVFlQRVNfXwogI2RlZmluZSBfX0lOVEVMX0VOR0lORV9UWVBFU19fCiAKKyNpbmNsdWRlIDxs
aW51eC9hdmVyYWdlLmg+CiAjaW5jbHVkZSA8bGludXgvaGFzaHRhYmxlLmg+CiAjaW5jbHVkZSA8
bGludXgvaXJxX3dvcmsuaD4KICNpbmNsdWRlIDxsaW51eC9rcmVmLmg+CkBAIC0xMTksNiArMTIw
LDkgQEAgZW51bSBpbnRlbF9lbmdpbmVfaWQgewogI2RlZmluZSBJTlZBTElEX0VOR0lORSAoKGVu
dW0gaW50ZWxfZW5naW5lX2lkKS0xKQogfTsKIAorLyogQSBzaW1wbGUgZXN0aW1hdG9yIGZvciB0
aGUgcm91bmQtdHJpcCByZXNwb25zaXZlIHRpbWUgb2YgYW4gZW5naW5lICovCitERUNMQVJFX0VX
TUEoZGVsYXksIDYsIDQpCisKIHN0cnVjdCBzdF9wcmVlbXB0X2hhbmcgewogCXN0cnVjdCBjb21w
bGV0aW9uIGNvbXBsZXRpb247CiAJdW5zaWduZWQgaW50IGNvdW50OwpAQCAtMzE2LDYgKzMyMCwx
MyBAQCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzIHsKIAkJc3RydWN0IGludGVsX3RpbWVsaW5lICp0
aW1lbGluZTsKIAl9IGxlZ2FjeTsKIAorCS8qCisJICogV2UgdHJhY2sgdGhlIGF2ZXJhZ2UgZHVy
YXRpb24gb2YgdGhlIGlkbGUgcHVsc2Ugb24gcGFya2luZyB0aGUKKwkgKiBlbmdpbmUgdG8ga2Vl
cCBhbiBlc3RpbWF0ZSBvZiB0aGUgaG93IHRoZSBmYXN0IHRoZSBlbmdpbmUgaXMKKwkgKiB1bmRl
ciBpZGVhbCBjb25kaXRpb25zLgorCSAqLworCXN0cnVjdCBld21hX2RlbGF5IGRlbGF5OworCiAJ
LyogUmF0aGVyIHRoYW4gaGF2ZSBldmVyeSBjbGllbnQgd2FpdCB1cG9uIGFsbCB1c2VyIGludGVy
cnVwdHMsCiAJICogd2l0aCB0aGUgaGVyZCB3YWtpbmcgYWZ0ZXIgZXZlcnkgaW50ZXJydXB0IGFu
ZCBlYWNoIGRvaW5nIHRoZQogCSAqIGhlYXZ5d2VpZ2h0IHNlcW5vIGRhbmNlLCB3ZSBkZWxlZ2F0
ZSB0aGUgdGFzayAob2YgYmVpbmcgdGhlCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9ndF9wbS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0u
aAppbmRleCBiM2UxNzM5OWJlOWIuLmM3MjcxYjNhY2RlMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9ndF9wbS5oCkBAIC0yMiw2ICsyMiwxMSBAQCBzdGF0aWMgaW5saW5lIHZvaWQgaW50
ZWxfZ3RfcG1fZ2V0KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAJaW50ZWxfd2FrZXJlZl9nZXQoJmd0
LT53YWtlcmVmKTsKIH0KIAorc3RhdGljIGlubGluZSB2b2lkIF9faW50ZWxfZ3RfcG1fZ2V0KHN0
cnVjdCBpbnRlbF9ndCAqZ3QpCit7CisJX19pbnRlbF93YWtlcmVmX2dldCgmZ3QtPndha2VyZWYp
OworfQorCiBzdGF0aWMgaW5saW5lIGJvb2wgaW50ZWxfZ3RfcG1fZ2V0X2lmX2F3YWtlKHN0cnVj
dCBpbnRlbF9ndCAqZ3QpCiB7CiAJcmV0dXJuIGludGVsX3dha2VyZWZfZ2V0X2lmX2FjdGl2ZSgm
Z3QtPndha2VyZWYpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd2Fr
ZXJlZi5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd2FrZXJlZi5oCmluZGV4IDVmMGM5
NzJhODBmYi4uMjYwM2ExNzc1MThhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF93YWtlcmVmLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd2FrZXJlZi5o
CkBAIC04NCw2ICs4NCwxOCBAQCBpbnRlbF93YWtlcmVmX2dldChzdHJ1Y3QgaW50ZWxfd2FrZXJl
ZiAqd2YpCiAJcmV0dXJuIDA7CiB9CiAKKy8qKgorICogX19pbnRlbF93YWtlcmVmX2dldDogQWNx
dWlyZSB0aGUgd2FrZXJlZiwgYWdhaW4KKyAqIEB3ZjogdGhlIHdha2VyZWYKKyAqCisgKiBBY3F1
aXJlIGEgaG9sZCBvbiBhbiBhbHJlYWR5IGFjdGl2ZSB3YWtlcmVmLgorICovCitzdGF0aWMgaW5s
aW5lIHZvaWQKK19faW50ZWxfd2FrZXJlZl9nZXQoc3RydWN0IGludGVsX3dha2VyZWYgKndmKQor
eworCWF0b21pY19pbmMoJndmLT5jb3VudCk7Cit9CisKIC8qKgogICogaW50ZWxfd2FrZXJlZl9n
ZXRfaWZfaW5fdXNlOiBBY3F1aXJlIHRoZSB3YWtlcmVmCiAgKiBAd2Y6IHRoZSB3YWtlcmVmCi0t
IAoyLjI0LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
CkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpo
dHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

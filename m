Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id ED2DC2644D
	for <lists+intel-gfx@lfdr.de>; Wed, 22 May 2019 15:08:29 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9358589A91;
	Wed, 22 May 2019 13:08:27 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga01.intel.com (mga01.intel.com [192.55.52.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 792A389A77
 for <intel-gfx@lists.freedesktop.org>; Wed, 22 May 2019 13:08:26 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga006.fm.intel.com ([10.253.24.20])
 by fmsmga101.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 22 May 2019 06:08:26 -0700
X-ExtLoop1: 1
Received: from delly.ld.intel.com ([10.103.238.204])
 by fmsmga006.fm.intel.com with ESMTP; 22 May 2019 06:08:25 -0700
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 22 May 2019 14:05:22 +0100
Message-Id: <20190522130524.10223-4-lionel.g.landwerlin@intel.com>
X-Mailer: git-send-email 2.21.0.392.gf8f6787159e
In-Reply-To: <20190522130524.10223-1-lionel.g.landwerlin@intel.com>
References: <20190522130524.10223-1-lionel.g.landwerlin@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 3/5] drm/i915/perf: allow for CS OA configs
 to be created lazily
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SGVyZSB3ZSBpbnRyb2R1Y2UgYSBtZWNoYW5pc20gYnkgd2hpY2ggdGhlIGV4ZWNidWYgcGFydCBv
ZiB0aGUgaTkxNQpkcml2ZXIgd2lsbCBiZSBhYmxlIHRvIHJlcXVlc3QgdGhhdCBhIGJhdGNoIGJ1
ZmZlciBjb250YWluaW5nIHRoZQpwcm9ncmFtbWluZyBmb3IgYSBwYXJ0aWN1bGFyIE9BIGNvbmZp
ZyBiZSBjcmVhdGVkLgoKV2UnbGwgZXhlY3V0ZSB0aGVzZSBPQSBjb25maWd1cmF0aW9uIGJ1ZmZl
cnMgcmlnaHQgYmVmb3JlIGV4ZWN1dGluZyBhCnNldCBvZiB1c2Vyc3BhY2UgY29tbWFuZHMgc28g
dGhhdCBhIHBhcnRpY3VsYXIgdXNlciBiYXRjaGJ1ZmZlciBiZQpleGVjdXRlZCB3aXRoIGEgZ2l2
ZW4gT0EgY29uZmlndXJhdGlvbi4KClRoaXMgbWVjaGFuaXNtIGVzc2VudGlhbGx5IGFsbG93cyB0
aGUgdXNlcnNwYWNlIGRyaXZlciB0byBnbyB0aHJvdWdoCnNldmVyYWwgT0EgY29uZmlndXJhdGlv
biB3aXRob3V0IGhhdmluZyB0byBvcGVuL2Nsb3NlIHRoZSBpOTE1L3BlcmYKc3RyZWFtLgoKdjI6
IE5vIG5lZWQgZm9yIGxvY2tpbmcgb24gb2JqZWN0IE9BIGNvbmZpZyBvYmplY3QgY3JlYXRpb24g
KENocmlzKQogICAgRmx1c2ggY3B1IG1hcHBpbmcgb2YgT0EgY29uZmlnIChDaHJpcykKClNpZ25l
ZC1vZmYtYnk6IExpb25lbCBMYW5kd2VybGluIDxsaW9uZWwuZy5sYW5kd2VybGluQGludGVsLmNv
bT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMuaCB8ICAg
MSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oICAgICAgICAgICAgICB8ICAyMiAr
Ky0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jICAgICAgICAgICAgIHwgMTczICsr
KysrKysrKysrKysrKy0tLS0KIDMgZmlsZXMgY2hhbmdlZCwgMTYzIGluc2VydGlvbnMoKyksIDMz
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2dwdV9jb21tYW5kcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3B1X2NvbW1h
bmRzLmgKaW5kZXggYTM0ZWNlNTNhNzcxLi5iYmNiODBjZjJhODUgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5oCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5oCkBAIC0xMjYsNiArMTI2LDcgQEAKICAq
LwogI2RlZmluZSBNSV9MT0FEX1JFR0lTVEVSX0lNTSh4KQlNSV9JTlNUUigweDIyLCAyKih4KS0x
KQogI2RlZmluZSAgIE1JX0xSSV9GT1JDRV9QT1NURUQJCSgxPDwxMikKKyNkZWZpbmUgTUlfTE9B
RF9SRUdJU1RFUl9JTU1fTUFYX1JFR1MgKDEyNikKICNkZWZpbmUgTUlfU1RPUkVfUkVHSVNURVJf
TUVNICAgICAgICBNSV9JTlNUUigweDI0LCAxKQogI2RlZmluZSBNSV9TVE9SRV9SRUdJU1RFUl9N
RU1fR0VOOCAgIE1JX0lOU1RSKDB4MjQsIDIpCiAjZGVmaW5lICAgTUlfU1JNX0xSTV9HTE9CQUxf
R1RUCQkoMTw8MjIpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5o
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAppbmRleCAxYWQzODE4ZDI2NzYuLmFi
ZDU2NGJmYTAzYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCkBAIC0xMjc0LDYgKzEyNzQsMTAg
QEAgc3RydWN0IGk5MTVfb2FfY29uZmlnIHsKIAlzdHJ1Y3QgYXR0cmlidXRlICphdHRyc1syXTsK
IAlzdHJ1Y3QgZGV2aWNlX2F0dHJpYnV0ZSBzeXNmc19tZXRyaWNfaWQ7CiAKKwlzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqOworCisJc3RydWN0IGxpc3RfaGVhZCB2bWFfbGluazsKKwog
CWF0b21pY190IHJlZl9jb3VudDsKIH07CiAKQEAgLTE4NTYsMTEgKzE4NjAsMjEgQEAgc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgewogCQlzdHJ1Y3QgbXV0ZXggbWV0cmljc19sb2NrOwogCiAJCS8q
Ci0JCSAqIExpc3Qgb2YgZHluYW1pYyBjb25maWd1cmF0aW9ucywgeW91IG5lZWQgdG8gaG9sZAot
CQkgKiBkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2xvY2sgdG8gYWNjZXNzIGl0LgorCQkgKiBMaXN0
IG9mIGR5bmFtaWMgY29uZmlndXJhdGlvbnMgKHN0cnVjdCBpOTE1X29hX2NvbmZpZyksIHlvdQor
CQkgKiBuZWVkIHRvIGhvbGQgZGV2X3ByaXYtPnBlcmYubWV0cmljc19sb2NrIHRvIGFjY2VzcyBp
dC4KIAkJICovCiAJCXN0cnVjdCBpZHIgbWV0cmljc19pZHI7CiAKKwkJLyoKKwkJICogTGlzdCBv
ZiBkeW5hbWljIGNvbmZpZ3VyYXRpb25zIChzdHJ1Y3QgaTkxNV9vYV9jb25maWcpCisJCSAqIHdo
aWNoIGhhdmUgYW4gYWxsb2NhdGVkIGJ1ZmZlciBpbiBHR1RUIGZvciByZWNvbmZpZ3VyYXRpb24s
CisJCSAqIHlvdSBuZWVkIHRvIGhvbGQgZGV2X3ByaXYtPnBlcmYubWV0cmljc19sb2NrIHRvIGFj
Y2VzcyBpdC4KKwkJICogRWxlbWVudHMgYXJlIGFkZGVkIHRvIHRoZSBsaXN0IGxhemlsbHkgb24g
ZXhlY2J1ZiAod2hlbiBhCisJCSAqIHBhcnRpY3VsYXIgY29uZmlndXJhdGlvbiBpcyByZXF1ZXN0
ZWQpLiBUaGUgbGlzdCBpcyBmcmVlZAorCQkgKiB1cG9uIGNsb3NpbmcgdGhlIHBlcmYgc3RyZWFt
LgorCQkgKi8KKwkJc3RydWN0IGxpc3RfaGVhZCBtZXRyaWNzX2J1ZmZlcnM7CisKIAkJLyoKIAkJ
ICogTG9jayBhc3NvY2lhdGVkIHdpdGggYW55dGhpbmcgYmVsb3cgd2l0aGluIHRoaXMgc3RydWN0
dXJlCiAJCSAqIGV4Y2VwdCBleGNsdXNpdmVfc3RyZWFtLgpAQCAtMzEzNiw2ICszMTUwLDEwIEBA
IGludCBpOTE1X3BlcmZfcmVtb3ZlX2NvbmZpZ19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
LCB2b2lkICpkYXRhLAogdm9pZCBpOTE1X29hX2luaXRfcmVnX3N0YXRlKHN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZSwKIAkJCSAgICBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJCQkg
ICAgdTMyICpyZWdfc3RhdGUpOworaW50IGk5MTVfcGVyZl9nZXRfb2FfY29uZmlnKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAorCQkJICAgIGludCBtZXRyaWNzX3NldCwKKwkJCSAgICBz
dHJ1Y3QgaTkxNV9vYV9jb25maWcgKipvdXRfY29uZmlnLAorCQkJICAgIHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICoqb3V0X29iaik7CiAKIC8qIGk5MTVfZ2VtX2V2aWN0LmMgKi8KIGludCBf
X211c3RfY2hlY2sgaTkxNV9nZW1fZXZpY3Rfc29tZXRoaW5nKHN0cnVjdCBpOTE1X2FkZHJlc3Nf
c3BhY2UgKnZtLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYwppbmRleCAzMjEwMTRjYTE1OTIuLjVl
MTRlNzhmYzFlMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKQEAgLTM2Nyw5ICszNjcsMTYg
QEAgc3RydWN0IHBlcmZfb3Blbl9wcm9wZXJ0aWVzIHsKIAlpbnQgb2FfcGVyaW9kX2V4cG9uZW50
OwogfTsKIAotc3RhdGljIHZvaWQgZnJlZV9vYV9jb25maWcoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAotCQkJICAgc3RydWN0IGk5MTVfb2FfY29uZmlnICpvYV9jb25maWcpCitz
dGF0aWMgdm9pZCBwdXRfb2FfY29uZmlnKHN0cnVjdCBpOTE1X29hX2NvbmZpZyAqb2FfY29uZmln
KQogeworCWlmICghYXRvbWljX2RlY19hbmRfdGVzdCgmb2FfY29uZmlnLT5yZWZfY291bnQpKQor
CQlyZXR1cm47CisKKwlpZiAob2FfY29uZmlnLT5vYmopIHsKKwkJbGlzdF9kZWwoJm9hX2NvbmZp
Zy0+dm1hX2xpbmspOworCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9hX2NvbmZpZy0+b2JqKTsKKwl9
CisKIAlpZiAoIVBUUl9FUlIob2FfY29uZmlnLT5mbGV4X3JlZ3MpKQogCQlrZnJlZShvYV9jb25m
aWctPmZsZXhfcmVncyk7CiAJaWYgKCFQVFJfRVJSKG9hX2NvbmZpZy0+Yl9jb3VudGVyX3JlZ3Mp
KQpAQCAtMzc5LDM4ICszODYsMTI2IEBAIHN0YXRpYyB2b2lkIGZyZWVfb2FfY29uZmlnKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlrZnJlZShvYV9jb25maWcpOwogfQogCi1z
dGF0aWMgdm9pZCBwdXRfb2FfY29uZmlnKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKLQkJCSAgc3RydWN0IGk5MTVfb2FfY29uZmlnICpvYV9jb25maWcpCitzdGF0aWMgdTMyICp3
cml0ZV9jc19taV9scmkodTMyICpjcywgY29uc3Qgc3RydWN0IGk5MTVfb2FfcmVnICpyZWdfZGF0
YSwgdTMyIG5fcmVncykKIHsKLQlpZiAoIWF0b21pY19kZWNfYW5kX3Rlc3QoJm9hX2NvbmZpZy0+
cmVmX2NvdW50KSkKLQkJcmV0dXJuOworCXUzMiBpOwogCi0JZnJlZV9vYV9jb25maWcoZGV2X3By
aXYsIG9hX2NvbmZpZyk7CisJZm9yIChpID0gMDsgaSA8IG5fcmVnczsgaSsrKSB7CisJCWlmICgo
aSAlIE1JX0xPQURfUkVHSVNURVJfSU1NX01BWF9SRUdTKSA9PSAwKSB7CisJCQl1MzIgbl9scmkg
PSBtaW4obl9yZWdzIC0gaSwKKwkJCQkJKHUzMikgTUlfTE9BRF9SRUdJU1RFUl9JTU1fTUFYX1JF
R1MpOworCisJCQkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJfSU1NKG5fbHJpKTsKKwkJfQorCQkq
Y3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KHJlZ19kYXRhW2ldLmFkZHIpOworCQkqY3MrKyA9
IHJlZ19kYXRhW2ldLnZhbHVlOworCX0KKworCXJldHVybiBjczsKIH0KIAotc3RhdGljIGludCBn
ZXRfb2FfY29uZmlnKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCSBpbnQg
bWV0cmljc19zZXQsCi0JCQkgc3RydWN0IGk5MTVfb2FfY29uZmlnICoqb3V0X2NvbmZpZykKK3N0
YXRpYyBpbnQgYWxsb2Nfb2FfY29uZmlnX2J1ZmZlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwKKwkJCQkgIHN0cnVjdCBpOTE1X29hX2NvbmZpZyAqb2FfY29uZmlnKQogewotCWludCBy
ZXQ7CisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKmJvOworCXNpemVfdCBjb25maWdfbGVu
Z3RoID0gMDsKKwl1MzIgKmNzOwogCi0JaWYgKG1ldHJpY3Nfc2V0ID09IDEpIHsKLQkJKm91dF9j
b25maWcgPSAmZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWc7Ci0JCWF0b21pY19pbmMoJmRl
dl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnJlZl9jb3VudCk7Ci0JCXJldHVybiAwOworCWlm
IChvYV9jb25maWctPm11eF9yZWdzX2xlbiA+IDApIHsKKwkJY29uZmlnX2xlbmd0aCArPSBESVZf
Uk9VTkRfVVAob2FfY29uZmlnLT5tdXhfcmVnc19sZW4sCisJCQkJCSAgICAgIE1JX0xPQURfUkVH
SVNURVJfSU1NX01BWF9SRUdTKSAqIDQ7CisJCWNvbmZpZ19sZW5ndGggKz0gb2FfY29uZmlnLT5t
dXhfcmVnc19sZW4gKiA4OworCX0KKwlpZiAob2FfY29uZmlnLT5iX2NvdW50ZXJfcmVnc19sZW4g
PiAwKSB7CisJCWNvbmZpZ19sZW5ndGggKz0gRElWX1JPVU5EX1VQKG9hX2NvbmZpZy0+Yl9jb3Vu
dGVyX3JlZ3NfbGVuLAorCQkJCQkgICAgICBNSV9MT0FEX1JFR0lTVEVSX0lNTV9NQVhfUkVHUykg
KiA0OworCQljb25maWdfbGVuZ3RoICs9IG9hX2NvbmZpZy0+Yl9jb3VudGVyX3JlZ3NfbGVuICog
ODsKIAl9CisJaWYgKG9hX2NvbmZpZy0+ZmxleF9yZWdzX2xlbiA+IDApIHsKKwkJY29uZmlnX2xl
bmd0aCArPSBESVZfUk9VTkRfVVAob2FfY29uZmlnLT5mbGV4X3JlZ3NfbGVuLAorCQkJCQkgICAg
ICBNSV9MT0FEX1JFR0lTVEVSX0lNTV9NQVhfUkVHUykgKiA0OworCQljb25maWdfbGVuZ3RoICs9
IG9hX2NvbmZpZy0+ZmxleF9yZWdzX2xlbiAqIDg7CisJfQorCWNvbmZpZ19sZW5ndGggKz0gNDsg
LyogTUlfQkFUQ0hfQlVGRkVSX0VORCAqLworCWNvbmZpZ19sZW5ndGggPSBBTElHTihjb25maWdf
bGVuZ3RoLCBJOTE1X0dUVF9QQUdFX1NJWkUpOwogCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1
cHRpYmxlKCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2xvY2spOworCWJvID0gaTkxNV9nZW1fb2Jq
ZWN0X2NyZWF0ZShpOTE1LCBjb25maWdfbGVuZ3RoKTsKKwlpZiAoSVNfRVJSKGJvKSkKKwkJcmV0
dXJuIFBUUl9FUlIoYm8pOworCisJY3MgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChibywgSTkx
NV9NQVBfV0IpOworCWlmIChJU19FUlIoY3MpKSB7CisJCWk5MTVfZ2VtX29iamVjdF9wdXQoYm8p
OworCQlyZXR1cm4gUFRSX0VSUihjcyk7CisJfQorCisJY3MgPSB3cml0ZV9jc19taV9scmkoY3Ms
IG9hX2NvbmZpZy0+bXV4X3JlZ3MsIG9hX2NvbmZpZy0+bXV4X3JlZ3NfbGVuKTsKKwljcyA9IHdy
aXRlX2NzX21pX2xyaShjcywgb2FfY29uZmlnLT5iX2NvdW50ZXJfcmVncywgb2FfY29uZmlnLT5i
X2NvdW50ZXJfcmVnc19sZW4pOworCWNzID0gd3JpdGVfY3NfbWlfbHJpKGNzLCBvYV9jb25maWct
PmZsZXhfcmVncywgb2FfY29uZmlnLT5mbGV4X3JlZ3NfbGVuKTsKKworCSpjcysrID0gTUlfQkFU
Q0hfQlVGRkVSX0VORDsKKworCWk5MTVfZ2VtX29iamVjdF9mbHVzaF9tYXAoYm8pOworCWk5MTVf
Z2VtX29iamVjdF91bnBpbl9tYXAoYm8pOworCisJb2FfY29uZmlnLT5vYmogPSBibzsKKworCXJl
dHVybiAwOworfQorCitpbnQgaTkxNV9wZXJmX2dldF9vYV9jb25maWcoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCisJCQkgICAgaW50IG1ldHJpY3Nfc2V0LAorCQkJICAgIHN0cnVjdCBp
OTE1X29hX2NvbmZpZyAqKm91dF9jb25maWcsCisJCQkgICAgc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKipvdXRfb2JqKQoreworCWludCByZXQgPSAwOworCXN0cnVjdCBpOTE1X29hX2NvbmZp
ZyAqb2FfY29uZmlnOworCisJaWYgKCFpOTE1LT5wZXJmLmluaXRpYWxpemVkKQorCQlyZXR1cm4g
LUVOT0RFVjsKKworCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkxNS0+cGVyZi5t
ZXRyaWNzX2xvY2spOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQkqb3V0X2NvbmZpZyA9
IGlkcl9maW5kKCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2lkciwgbWV0cmljc19zZXQpOwotCWlm
ICghKm91dF9jb25maWcpCi0JCXJldCA9IC1FSU5WQUw7Ci0JZWxzZQotCQlhdG9taWNfaW5jKCYo
Km91dF9jb25maWcpLT5yZWZfY291bnQpOworCWlmIChtZXRyaWNzX3NldCA9PSAxKSB7CisJCW9h
X2NvbmZpZyA9ICZpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnOworCX0gZWxzZSB7CisJCW9hX2Nv
bmZpZyA9IGlkcl9maW5kKCZpOTE1LT5wZXJmLm1ldHJpY3NfaWRyLCBtZXRyaWNzX3NldCk7CisJ
CWlmICghb2FfY29uZmlnKSB7CisJCQlyZXQgPSAtRUlOVkFMOworCQkJZ290byB1bmxvY2s7CisJ
CX0KKwl9CiAKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5wZXJmLm1ldHJpY3NfbG9jayk7CisJ
aWYgKG91dF9jb25maWcpIHsKKwkJYXRvbWljX2luYygmb2FfY29uZmlnLT5yZWZfY291bnQpOwor
CQkqb3V0X2NvbmZpZyA9IG9hX2NvbmZpZzsKKwl9CisKKwlpZiAob3V0X29iaikgeworCQlpZiAo
b2FfY29uZmlnLT5vYmopIHsKKwkJCSpvdXRfb2JqID0gaTkxNV9nZW1fb2JqZWN0X2dldChvYV9j
b25maWctPm9iaik7CisJCX0gZWxzZSB7CisJCQlyZXQgPSBhbGxvY19vYV9jb25maWdfYnVmZmVy
KGk5MTUsIG9hX2NvbmZpZyk7CisJCQlpZiAocmV0KQorCQkJCWdvdG8gZXJyX2J1Zl9hbGxvYzsK
KworCQkJbGlzdF9hZGQoJm9hX2NvbmZpZy0+dm1hX2xpbmssCisJCQkJICZpOTE1LT5wZXJmLm1l
dHJpY3NfYnVmZmVycyk7CisJCQkqb3V0X29iaiA9IGk5MTVfZ2VtX29iamVjdF9nZXQob2FfY29u
ZmlnLT5vYmopOworCQl9CisJfQorCisJZ290byB1bmxvY2s7CisKK2Vycl9idWZfYWxsb2M6CisJ
aWYgKG91dF9jb25maWcpIHsKKwkJcHV0X29hX2NvbmZpZyhvYV9jb25maWcpOworCQkqb3V0X2Nv
bmZpZyA9IE5VTEw7CisJfQordW5sb2NrOgorCW11dGV4X3VubG9jaygmaTkxNS0+cGVyZi5tZXRy
aWNzX2xvY2spOwogCiAJcmV0dXJuIHJldDsKIH0KQEAgLTEzODcsNyArMTQ4Miw3IEBAIHN0YXRp
YyB2b2lkIGk5MTVfb2Ffc3RyZWFtX2Rlc3Ryb3koc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0
cmVhbSkKIAlpZiAoc3RyZWFtLT5jdHgpCiAJCW9hX3B1dF9yZW5kZXJfY3R4X2lkKHN0cmVhbSk7
CiAKLQlwdXRfb2FfY29uZmlnKGRldl9wcml2LCBzdHJlYW0tPm9hX2NvbmZpZyk7CisJcHV0X29h
X2NvbmZpZyhzdHJlYW0tPm9hX2NvbmZpZyk7CiAKIAlpZiAoZGV2X3ByaXYtPnBlcmYub2Euc3B1
cmlvdXNfcmVwb3J0X3JzLm1pc3NlZCkgewogCQlEUk1fTk9URSgiJWQgc3B1cmlvdXMgT0EgcmVw
b3J0IG5vdGljZXMgc3VwcHJlc3NlZCBkdWUgdG8gcmF0ZWxpbWl0aW5nXG4iLApAQCAtMjEwMSw3
ICsyMTk2LDggQEAgc3RhdGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1X3Bl
cmZfc3RyZWFtICpzdHJlYW0sCiAJCX0KIAl9CiAKLQlyZXQgPSBnZXRfb2FfY29uZmlnKGRldl9w
cml2LCBwcm9wcy0+bWV0cmljc19zZXQsICZzdHJlYW0tPm9hX2NvbmZpZyk7CisJcmV0ID0gaTkx
NV9wZXJmX2dldF9vYV9jb25maWcoZGV2X3ByaXYsIHByb3BzLT5tZXRyaWNzX3NldCwKKwkJCQkg
ICAgICAmc3RyZWFtLT5vYV9jb25maWcsIE5VTEwpOwogCWlmIChyZXQpIHsKIAkJRFJNX0RFQlVH
KCJJbnZhbGlkIE9BIGNvbmZpZyBpZD0laVxuIiwgcHJvcHMtPm1ldHJpY3Nfc2V0KTsKIAkJZ290
byBlcnJfY29uZmlnOwpAQCAtMjExNCw3ICsyMjEwLDcgQEAgc3RhdGljIGludCBpOTE1X29hX3N0
cmVhbV9pbml0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJICogICAiV2hlbiB0
aGlzIGJpdCBpcyBzZXQsIGluIG9yZGVyIHRvIGhhdmUgY29oZXJlbnQgY291bnRzLAogCSAqICAg
UkM2IHBvd2VyIHN0YXRlIGFuZCB0cnVuayBjbG9jayBnYXRpbmcgbXVzdCBiZSBkaXNhYmxlZC4K
IAkgKiAgIFRoaXMgY2FuIGJlIGFjaGlldmVkIGJ5IHByb2dyYW1taW5nIE1NSU8gcmVnaXN0ZXJz
IGFzCi0JICogICAweEEwOTQ9MCBhbmQgMHhBMDkwWzMxXT0xIgorCSAqICAgdTB4QTA5ND0wIGFu
ZCAweEEwOTBbMzFdPTEiCiAJICoKIAkgKiAgIEluIG91ciBjYXNlIHdlIGFyZSBleHBlY3Rpbmcg
dGhhdCB0YWtpbmcgcG0gKyBGT1JDRVdBS0UKIAkgKiAgIHJlZmVyZW5jZXMgd2lsbCBlZmZlY3Rp
dmVseSBkaXNhYmxlIFJDNi4KQEAgLTIxMzksNiArMjIzNSw4IEBAIHN0YXRpYyBpbnQgaTkxNV9v
YV9zdHJlYW1faW5pdChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtLAogCQlnb3RvIGVy
cl9lbmFibGU7CiAJfQogCisJRFJNX0RFQlVHKCJvcGVuaW5nIHN0cmVhbSBvYSBjb25maWcgdXVp
ZD0lc1xuIiwgc3RyZWFtLT5vYV9jb25maWctPnV1aWQpOworCiAJbXV0ZXhfdW5sb2NrKCZkZXZf
cHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlyZXR1cm4gMDsKQEAgLTIxNTIsNyArMjI1MCw3
IEBAIHN0YXRpYyBpbnQgaTkxNV9vYV9zdHJlYW1faW5pdChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVh
bSAqc3RyZWFtLAogCWZyZWVfb2FfYnVmZmVyKGRldl9wcml2KTsKIAogZXJyX29hX2J1Zl9hbGxv
YzoKLQlwdXRfb2FfY29uZmlnKGRldl9wcml2LCBzdHJlYW0tPm9hX2NvbmZpZyk7CisJcHV0X29h
X2NvbmZpZyhzdHJlYW0tPm9hX2NvbmZpZyk7CiAKIAlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX3B1
dCgmZGV2X3ByaXYtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CiAJaW50ZWxfcnVudGltZV9wbV9w
dXQoZGV2X3ByaXYsIHN0cmVhbS0+d2FrZXJlZik7CkBAIC0yNTE5LDkgKzI2MTcsMjEgQEAgc3Rh
dGljIGludCBpOTE1X3BlcmZfcmVsZWFzZShzdHJ1Y3QgaW5vZGUgKmlub2RlLCBzdHJ1Y3QgZmls
ZSAqZmlsZSkKIHsKIAlzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtID0gZmlsZS0+cHJp
dmF0ZV9kYXRhOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHN0cmVhbS0+
ZGV2X3ByaXY7CisJc3RydWN0IGk5MTVfb2FfY29uZmlnICpvYV9jb25maWcsICpuZXh0OwogCiAJ
bXV0ZXhfbG9jaygmZGV2X3ByaXYtPnBlcmYubG9jayk7CisKIAlpOTE1X3BlcmZfZGVzdHJveV9s
b2NrZWQoc3RyZWFtKTsKKworCS8qIERpc3Bvc2Ugb2YgYWxsIG9hIGNvbmZpZyBiYXRjaCBidWZm
ZXJzLiAqLworCW11dGV4X2xvY2soJmRldl9wcml2LT5wZXJmLm1ldHJpY3NfbG9jayk7CisJbGlz
dF9mb3JfZWFjaF9lbnRyeV9zYWZlKG9hX2NvbmZpZywgbmV4dCwgJmRldl9wcml2LT5wZXJmLm1l
dHJpY3NfYnVmZmVycywgdm1hX2xpbmspIHsKKwkJbGlzdF9kZWwoJm9hX2NvbmZpZy0+dm1hX2xp
bmspOworCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9hX2NvbmZpZy0+b2JqKTsKKwkJb2FfY29uZmln
LT5vYmogPSBOVUxMOworCX0KKwltdXRleF91bmxvY2soJmRldl9wcml2LT5wZXJmLm1ldHJpY3Nf
bG9jayk7CisKIAltdXRleF91bmxvY2soJmRldl9wcml2LT5wZXJmLmxvY2spOwogCiAJcmV0dXJu
IDA7CkBAIC0zMzE3LDcgKzM0MjcsNyBAQCBpbnQgaTkxNV9wZXJmX2FkZF9jb25maWdfaW9jdGwo
c3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIHN5c2ZzX2VycjoKIAltdXRleF91
bmxvY2soJmRldl9wcml2LT5wZXJmLm1ldHJpY3NfbG9jayk7CiByZWdfZXJyOgotCXB1dF9vYV9j
b25maWcoZGV2X3ByaXYsIG9hX2NvbmZpZyk7CisJcHV0X29hX2NvbmZpZyhvYV9jb25maWcpOwog
CURSTV9ERUJVRygiRmFpbGVkIHRvIGFkZCBuZXcgT0EgY29uZmlnXG4iKTsKIAlyZXR1cm4gZXJy
OwogfQpAQCAtMzM3MSw3ICszNDgxLDcgQEAgaW50IGk5MTVfcGVyZl9yZW1vdmVfY29uZmlnX2lv
Y3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAKIAlEUk1fREVCVUcoIlJl
bW92ZWQgY29uZmlnICVzIGlkPSVpXG4iLCBvYV9jb25maWctPnV1aWQsIG9hX2NvbmZpZy0+aWQp
OwogCi0JcHV0X29hX2NvbmZpZyhkZXZfcHJpdiwgb2FfY29uZmlnKTsKKwlwdXRfb2FfY29uZmln
KG9hX2NvbmZpZyk7CiAKIGNvbmZpZ19lcnI6CiAJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cGVy
Zi5tZXRyaWNzX2xvY2spOwpAQCAtMzUxMyw2ICszNjIzLDggQEAgdm9pZCBpOTE1X3BlcmZfaW5p
dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCWluaXRfd2FpdHF1ZXVlX2hl
YWQoJmRldl9wcml2LT5wZXJmLm9hLnBvbGxfd3EpOwogCiAJCUlOSVRfTElTVF9IRUFEKCZkZXZf
cHJpdi0+cGVyZi5zdHJlYW1zKTsKKwkJSU5JVF9MSVNUX0hFQUQoJmRldl9wcml2LT5wZXJmLm1l
dHJpY3NfYnVmZmVycyk7CisKIAkJbXV0ZXhfaW5pdCgmZGV2X3ByaXYtPnBlcmYubG9jayk7CiAJ
CXNwaW5fbG9ja19pbml0KCZkZXZfcHJpdi0+cGVyZi5vYS5vYV9idWZmZXIucHRyX2xvY2spOwog
CkBAIC0zNTI5LDEwICszNjQxLDkgQEAgdm9pZCBpOTE1X3BlcmZfaW5pdChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAKIHN0YXRpYyBpbnQgZGVzdHJveV9jb25maWcoaW50IGlk
LCB2b2lkICpwLCB2b2lkICpkYXRhKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IGRhdGE7CiAJc3RydWN0IGk5MTVfb2FfY29uZmlnICpvYV9jb25maWcgPSBwOwogCi0J
cHV0X29hX2NvbmZpZyhkZXZfcHJpdiwgb2FfY29uZmlnKTsKKwlwdXRfb2FfY29uZmlnKG9hX2Nv
bmZpZyk7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTM1NDYsNyArMzY1Nyw3IEBAIHZvaWQgaTkxNV9w
ZXJmX2Zpbmkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCWlmICghZGV2X3By
aXYtPnBlcmYuaW5pdGlhbGl6ZWQpCiAJCXJldHVybjsKIAotCWlkcl9mb3JfZWFjaCgmZGV2X3By
aXYtPnBlcmYubWV0cmljc19pZHIsIGRlc3Ryb3lfY29uZmlnLCBkZXZfcHJpdik7CisJaWRyX2Zv
cl9lYWNoKCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2lkciwgZGVzdHJveV9jb25maWcsIE5VTEwp
OwogCWlkcl9kZXN0cm95KCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2lkcik7CiAKIAl1bnJlZ2lz
dGVyX3N5c2N0bF90YWJsZShkZXZfcHJpdi0+cGVyZi5zeXNjdGxfaGVhZGVyKTsKLS0gCjIuMjEu
MC4zOTIuZ2Y4ZjY3ODcxNTllCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVz
a3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9p
bnRlbC1nZng=

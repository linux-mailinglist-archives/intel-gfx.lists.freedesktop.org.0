Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 2714C46278
	for <lists+intel-gfx@lfdr.de>; Fri, 14 Jun 2019 17:18:03 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 897A589A61;
	Fri, 14 Jun 2019 15:18:01 +0000 (UTC)
X-Original-To: Intel-gfx@lists.freedesktop.org
Delivered-To: Intel-gfx@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 547F889A62
 for <Intel-gfx@lists.freedesktop.org>; Fri, 14 Jun 2019 15:17:58 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga004.jf.intel.com ([10.7.209.38])
 by orsmga105.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 14 Jun 2019 08:17:58 -0700
X-ExtLoop1: 1
Received: from yyosef-mobl.ger.corp.intel.com (HELO localhost.localdomain)
 ([10.252.23.42])
 by orsmga004.jf.intel.com with ESMTP; 14 Jun 2019 08:17:56 -0700
From: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>
To: Intel-gfx@lists.freedesktop.org
Date: Fri, 14 Jun 2019 16:17:13 +0100
Message-Id: <20190614151731.17608-14-tvrtko.ursulin@linux.intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190614151731.17608-1-tvrtko.ursulin@linux.intel.com>
References: <20190614151731.17608-1-tvrtko.ursulin@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [RFC 13/31] drm/i915: Convert i915_gem_init_hw to
 intel_gt
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KCk1vcmUgcmVt
b3ZhbCBvZiBpbXBsaWNpdCBkZXZfcHJpdiBmcm9tIHVzaW5nIG9sZCBtbWlvIGFjY2Vzc29ycy4K
CkFjdHVhbGx5IHRoZSB0b3AgbGV2ZWwgZnVuY3Rpb24gcmVtYWlucyBidXQgaXMgc3BsaXQgaW50
byBhIHBhcnQgd2hpY2gKd3JpdGVzIHRvIGk5MTUgYW5kIHBhcnQgd2hpY2ggb3BlcmF0ZXMgb24g
aW50ZWxfZ3QgaW4gb3JkZXIgdG8gaW5pdGlhbGl6ZQp0aGUgaGFyZHdhcmUuCgpHdUMgYW5kIGVu
Z2luZXMgYXJlIHRoZSBvbmx5IG9kZCBvbmVzIG91dCByZW1haW5pbmcuCgpTaWduZWQtb2ZmLWJ5
OiBUdnJ0a28gVXJzdWxpbiA8dHZydGtvLnVyc3VsaW5AaW50ZWwuY29tPgotLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgfCA2NiArKysrKysrKysrKysrKysrKysrKy0tLS0tLS0t
LS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCA0MCBpbnNlcnRpb25zKCspLCAyNiBkZWxldGlvbnMoLSkK
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9nZW0uYwppbmRleCBlNTRjZDMwNTM0ZGMuLmI2ZjQ1MGU3ODJlNyAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCkBAIC0xMjM0LDI4ICsxMjM0LDMyIEBAIHN0YXRpYyB2
b2lkIGluaXRfdW51c2VkX3JpbmdzKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAJfQogfQogCi1pbnQg
aTkxNV9nZW1faW5pdF9odyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0
aWMgaW50IGluaXRfaHcoc3RydWN0IGludGVsX2d0ICpndCkKIHsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IGd0LT5pOTE1OworCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9
IGd0LT51bmNvcmU7CiAJaW50IHJldDsKIAotCWRldl9wcml2LT5ndC5sYXN0X2luaXRfdGltZSA9
IGt0aW1lX2dldCgpOworCWd0LT5sYXN0X2luaXRfdGltZSA9IGt0aW1lX2dldCgpOwogCiAJLyog
RG91YmxlIGxheWVyIHNlY3VyaXR5IGJsYW5rZXQsIHNlZSBpOTE1X2dlbV9pbml0KCkgKi8KLQlp
bnRlbF91bmNvcmVfZm9yY2V3YWtlX2dldCgmZGV2X3ByaXYtPnVuY29yZSwgRk9SQ0VXQUtFX0FM
TCk7CisJaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9nZXQodW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsK
IAotCWlmIChIQVNfRURSQU0oZGV2X3ByaXYpICYmIElOVEVMX0dFTihkZXZfcHJpdikgPCA5KQot
CQlJOTE1X1dSSVRFKEhTV19JRElDUiwgSTkxNV9SRUFEKEhTV19JRElDUikgfCBJRElIQVNITVNL
KDB4ZikpOworCWlmIChIQVNfRURSQU0oaTkxNSkgJiYgSU5URUxfR0VOKGk5MTUpIDwgOSkKKwkJ
aW50ZWxfdW5jb3JlX3Jtdyh1bmNvcmUsIEhTV19JRElDUiwgMCwgSURJSEFTSE1TSygweGYpKTsK
IAotCWlmIChJU19IQVNXRUxMKGRldl9wcml2KSkKLQkJSTkxNV9XUklURShNSV9QUkVESUNBVEVf
UkVTVUxUXzIsIElTX0hTV19HVDMoZGV2X3ByaXYpID8KLQkJCSAgIExPV0VSX1NMSUNFX0VOQUJM
RUQgOiBMT1dFUl9TTElDRV9ESVNBQkxFRCk7CisJaWYgKElTX0hBU1dFTEwoaTkxNSkpCisJCWlu
dGVsX3VuY29yZV93cml0ZSh1bmNvcmUsCisJCQkJICAgTUlfUFJFRElDQVRFX1JFU1VMVF8yLAor
CQkJCSAgIElTX0hTV19HVDMoaTkxNSkgPworCQkJCSAgIExPV0VSX1NMSUNFX0VOQUJMRUQgOiBM
T1dFUl9TTElDRV9ESVNBQkxFRCk7CiAKIAkvKiBBcHBseSB0aGUgR1Qgd29ya2Fyb3VuZHMuLi4g
Ki8KLQlpbnRlbF9ndF9hcHBseV93b3JrYXJvdW5kcygmZGV2X3ByaXYtPmd0KTsKKwlpbnRlbF9n
dF9hcHBseV93b3JrYXJvdW5kcyhndCk7CiAJLyogLi4uYW5kIGRldGVybWluZSB3aGV0aGVyIHRo
ZXkgYXJlIHN0aWNraW5nLiAqLwotCWludGVsX2d0X3ZlcmlmeV93b3JrYXJvdW5kcygmZGV2X3By
aXYtPmd0LCAiaW5pdCIpOworCWludGVsX2d0X3ZlcmlmeV93b3JrYXJvdW5kcyhndCwgImluaXQi
KTsKIAotCWludGVsX2d0X2luaXRfc3dpenpsaW5nKCZkZXZfcHJpdi0+Z3QpOworCWludGVsX2d0
X2luaXRfc3dpenpsaW5nKGd0KTsKIAogCS8qCiAJICogQXQgbGVhc3QgODMwIGNhbiBsZWF2ZSBz
b21lIG9mIHRoZSB1bnVzZWQgcmluZ3MKQEAgLTEyNjMsNDggKzEyNjcsNTggQEAgaW50IGk5MTVf
Z2VtX2luaXRfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCSAqIHdpbGwg
cHJldmVudCBjMyBlbnRyeS4gTWFrZXMgc3VyZSBhbGwgdW51c2VkIHJpbmdzCiAJICogYXJlIHRv
dGFsbHkgaWRsZS4KIAkgKi8KLQlpbml0X3VudXNlZF9yaW5ncygmZGV2X3ByaXYtPmd0KTsKLQot
CUJVR19PTighZGV2X3ByaXYtPmtlcm5lbF9jb250ZXh0KTsKLQlyZXQgPSBpOTE1X3Rlcm1pbmFs
bHlfd2VkZ2VkKGRldl9wcml2KTsKLQlpZiAocmV0KQotCQlnb3RvIG91dDsKKwlpbml0X3VudXNl
ZF9yaW5ncyhndCk7CiAKLQlyZXQgPSBpOTE1X3BwZ3R0X2luaXRfaHcoJmRldl9wcml2LT5ndCk7
CisJcmV0ID0gaTkxNV9wcGd0dF9pbml0X2h3KGd0KTsKIAlpZiAocmV0KSB7CiAJCURSTV9FUlJP
UigiRW5hYmxpbmcgUFBHVFQgZmFpbGVkICglZClcbiIsIHJldCk7CiAJCWdvdG8gb3V0OwogCX0K
IAotCXJldCA9IGludGVsX3dvcGNtX2luaXRfaHcoJmRldl9wcml2LT53b3BjbSk7CisJcmV0ID0g
aW50ZWxfd29wY21faW5pdF9odygmaTkxNS0+d29wY20pOwogCWlmIChyZXQpIHsKIAkJRFJNX0VS
Uk9SKCJFbmFibGluZyBXT1BDTSBmYWlsZWQgKCVkKVxuIiwgcmV0KTsKIAkJZ290byBvdXQ7CiAJ
fQogCiAJLyogV2UgY2FuJ3QgZW5hYmxlIGNvbnRleHRzIHVudGlsIGFsbCBmaXJtd2FyZSBpcyBs
b2FkZWQgKi8KLQlyZXQgPSBpbnRlbF91Y19pbml0X2h3KGRldl9wcml2KTsKKwlyZXQgPSBpbnRl
bF91Y19pbml0X2h3KGk5MTUpOwogCWlmIChyZXQpIHsKIAkJRFJNX0VSUk9SKCJFbmFibGluZyB1
YyBmYWlsZWQgKCVkKVxuIiwgcmV0KTsKIAkJZ290byBvdXQ7CiAJfQogCi0JaW50ZWxfbW9jc19p
bml0X2wzY2NfdGFibGUoJmRldl9wcml2LT5ndCk7CisJaW50ZWxfbW9jc19pbml0X2wzY2NfdGFi
bGUoZ3QpOwogCiAJLyogT25seSB3aGVuIHRoZSBIVyBpcyByZS1pbml0aWFsaXNlZCwgY2FuIHdl
IHJlcGxheSB0aGUgcmVxdWVzdHMgKi8KLQlyZXQgPSBpbnRlbF9lbmdpbmVzX3Jlc3VtZShkZXZf
cHJpdik7CisJcmV0ID0gaW50ZWxfZW5naW5lc19yZXN1bWUoaTkxNSk7CiAJaWYgKHJldCkKIAkJ
Z290byBjbGVhbnVwX3VjOwogCi0JaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQoJmRldl9wcml2
LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOworCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KHVu
Y29yZSwgRk9SQ0VXQUtFX0FMTCk7CiAKLQlpbnRlbF9lbmdpbmVzX3NldF9zY2hlZHVsZXJfY2Fw
cyhkZXZfcHJpdik7CiAJcmV0dXJuIDA7CiAKIGNsZWFudXBfdWM6Ci0JaW50ZWxfdWNfZmluaV9o
dyhkZXZfcHJpdik7CisJaW50ZWxfdWNfZmluaV9odyhpOTE1KTsKIG91dDoKLQlpbnRlbF91bmNv
cmVfZm9yY2V3YWtlX3B1dCgmZGV2X3ByaXYtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CisJaW50
ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQodW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKKworCXJldHVy
biByZXQ7Cit9CisKK2ludCBpOTE1X2dlbV9pbml0X2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQoreworCWludCByZXQ7CisKKwlCVUdfT04oIWk5MTUtPmtlcm5lbF9jb250ZXh0KTsK
KwlyZXQgPSBpOTE1X3Rlcm1pbmFsbHlfd2VkZ2VkKGk5MTUpOworCWlmIChyZXQpCisJCXJldHVy
biByZXQ7CisKKwlyZXQgPSBpbml0X2h3KCZpOTE1LT5ndCk7CisKKwlpbnRlbF9lbmdpbmVzX3Nl
dF9zY2hlZHVsZXJfY2FwcyhpOTE1KTsKIAogCXJldHVybiByZXQ7CiB9Ci0tIAoyLjIwLjEKCl9f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBt
YWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3Rz
LmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

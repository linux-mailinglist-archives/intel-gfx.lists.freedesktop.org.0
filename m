Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 9C216CA015
	for <lists+intel-gfx@lfdr.de>; Thu,  3 Oct 2019 16:08:54 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 783656E9E8;
	Thu,  3 Oct 2019 14:08:52 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A87CE6E9E8
 for <intel-gfx@lists.freedesktop.org>; Thu,  3 Oct 2019 14:08:49 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18708835-1500050 
 for multiple; Thu, 03 Oct 2019 15:08:27 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  3 Oct 2019 15:08:25 +0100
Message-Id: <20191003140825.10748-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191003093639.10186-17-chris@chris-wilson.co.uk>
References: <20191003093639.10186-17-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: Move context management under GEM
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

S2VlcCB0cmFjayBvZiB0aGUgR0VNIGNvbnRleHRzIHVuZGVybmVhdGggaTkxNS0+Z2VtLmNvbnRl
eHRzIGFuZCBhc3NpZ24KdGhlbSB0aGVpciBvd24gbG9jayBmb3IgdGhlIHB1cnBvc2VzIG9mIGxp
c3QgbWFuYWdlbWVudC4KCnYyOiBGb2N1cyBvbiBsb2NrIHRyYWNraW5nOyBjdHgtPnZtIGlzIHBy
b3RlY3RlZCBieSBjdHgtPm11dGV4CgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlz
QGNocmlzLXdpbHNvbi5jby51az4KQ2M6IFR2cnRrbyBVcnN1bGluIDx0dnJ0a28udXJzdWxpbkBp
bnRlbC5jb20+Ci0tLQpBdm9pZCBrZXJuZWxfY29udGV4dF9jbG9zZSgpIHVuZGVybmVhdGggdGlt
ZWxpbmUtPm11dGV4IChpLmUuIGJlZm9yZQppOTE1X3JlcXVlc3RfYWRkKCkpLgotLS0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgICB8IDE4MyArKysrKysrKyst
LS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmggICB8
ICAyNyArKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHRfdHlwZXMuaCB8
ICAgMiArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jICAgIHwg
ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jICAgfCAg
IDMgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMgICB8ICAz
NiArKy0tCiAuLi4vZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMgfCAx
NjggKysrKysrKystLS0tLS0tLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL21vY2tf
Y29udGV4dC5jIHwgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0
LmMgICAgICAgfCAgMTAgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jICAg
ICAgICAgICB8ICAgNSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0
LmMgICAgfCAgMjQgKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hl
Y2suYyAgfCAgMzkgKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMg
ICAgICAgIHwgICA2ICstCiAuLi4vZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRz
LmMgICAgfCAgMjIgKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVyLmMgICAg
ICAgICAgfCAgMjQgKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyAgICAg
ICAgICAgfCAgNTAgKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMgICAgICAg
ICAgICAgICB8ICAgMiAtCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oICAgICAgICAg
ICAgICAgfCAgMjcgKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jICAgICAgICAg
ICAgICAgfCAgMTAgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jICAgICAg
ICAgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgICAgICAgICAg
ICAgIHwgIDI0ICsrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zeXNmcy5jICAgICAgICAg
ICAgIHwgIDc3ICsrKystLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3RyYWNlLmggICAg
ICAgICAgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dl
bS5jICAgICB8ICAgOCAtCiAuLi4vZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmlj
dC5jICAgfCAgIDMgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2d0
dC5jIHwgIDE1ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0
LmMgfCAgMTIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5jICAg
ICB8ICAgNyArLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMg
IHwgICA2ICstCiAyOSBmaWxlcyBjaGFuZ2VkLCA0MTIgaW5zZXJ0aW9ucygrKSwgMzkwIGRlbGV0
aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9j
b250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCmlu
ZGV4IGFlNTg4NTQ0YmYzYS4uZGFkYjgyMGIwNTAyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKQEAgLTIxOCw5ICsyMTgsMTIgQEAgc3RhdGljIHN0cnVj
dCBpOTE1X2dlbV9lbmdpbmVzICpkZWZhdWx0X2VuZ2luZXMoc3RydWN0IGk5MTVfZ2VtX2NvbnRl
eHQgKmN0eCkKIAogc3RhdGljIHZvaWQgaTkxNV9nZW1fY29udGV4dF9mcmVlKHN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICpjdHgpCiB7Ci0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmY3R4LT5pOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKIAlHRU1fQlVHX09OKCFpOTE1X2dlbV9jb250ZXh0X2lzX2Nsb3Nl
ZChjdHgpKTsKIAorCXNwaW5fbG9jaygmY3R4LT5pOTE1LT5nZW0uY29udGV4dHMubG9jayk7CisJ
bGlzdF9kZWwoJmN0eC0+bGluayk7CisJc3Bpbl91bmxvY2soJmN0eC0+aTkxNS0+Z2VtLmNvbnRl
eHRzLmxvY2spOworCiAJZnJlZV9lbmdpbmVzKHJjdV9hY2Nlc3NfcG9pbnRlcihjdHgtPmVuZ2lu
ZXMpKTsKIAltdXRleF9kZXN0cm95KCZjdHgtPmVuZ2luZXNfbXV0ZXgpOwogCkBAIC0yMzAsNjcg
KzIzMyw1NCBAQCBzdGF0aWMgdm9pZCBpOTE1X2dlbV9jb250ZXh0X2ZyZWUoc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHQgKmN0eCkKIAlrZnJlZShjdHgtPm5hbWUpOwogCXB1dF9waWQoY3R4LT5waWQp
OwogCi0JbGlzdF9kZWwoJmN0eC0+bGluayk7CiAJbXV0ZXhfZGVzdHJveSgmY3R4LT5tdXRleCk7
CiAKIAlrZnJlZV9yY3UoY3R4LCByY3UpOwogfQogCi1zdGF0aWMgdm9pZCBjb250ZXh0c19mcmVl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQorc3RhdGljIHZvaWQgY29udGV4dHNfZnJl
ZV9hbGwoc3RydWN0IGxsaXN0X25vZGUgKmxpc3QpCiB7Ci0Jc3RydWN0IGxsaXN0X25vZGUgKmZy
ZWVkID0gbGxpc3RfZGVsX2FsbCgmaTkxNS0+Y29udGV4dHMuZnJlZV9saXN0KTsKIAlzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqY3R4LCAqY247CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKLQotCWxsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUoY3R4LCBj
biwgZnJlZWQsIGZyZWVfbGluaykKKwlsbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKGN0eCwgY24s
IGxpc3QsIGZyZWVfbGluaykKIAkJaTkxNV9nZW1fY29udGV4dF9mcmVlKGN0eCk7CiB9CiAKLXN0
YXRpYyB2b2lkIGNvbnRleHRzX2ZyZWVfZmlyc3Qoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCitzdGF0aWMgdm9pZCBjb250ZXh0c19mbHVzaF9mcmVlKHN0cnVjdCBpOTE1X2dlbV9jb250
ZXh0cyAqZ2MpCiB7Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKLQlzdHJ1Y3QgbGxp
c3Rfbm9kZSAqZnJlZWQ7Ci0KLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLQotCWZyZWVkID0gbGxpc3RfZGVsX2ZpcnN0KCZpOTE1LT5jb250ZXh0cy5mcmVl
X2xpc3QpOwotCWlmICghZnJlZWQpCi0JCXJldHVybjsKLQotCWN0eCA9IGNvbnRhaW5lcl9vZihm
cmVlZCwgdHlwZW9mKCpjdHgpLCBmcmVlX2xpbmspOwotCWk5MTVfZ2VtX2NvbnRleHRfZnJlZShj
dHgpOworCWNvbnRleHRzX2ZyZWVfYWxsKGxsaXN0X2RlbF9hbGwoJmdjLT5mcmVlX2xpc3QpKTsK
IH0KIAogc3RhdGljIHZvaWQgY29udGV4dHNfZnJlZV93b3JrZXIoc3RydWN0IHdvcmtfc3RydWN0
ICp3b3JrKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0KLQkJY29udGFpbmVy
X29mKHdvcmssIHR5cGVvZigqaTkxNSksIGNvbnRleHRzLmZyZWVfd29yayk7CisJc3RydWN0IGk5
MTVfZ2VtX2NvbnRleHRzICpnYyA9CisJCWNvbnRhaW5lcl9vZih3b3JrLCB0eXBlb2YoKmdjKSwg
ZnJlZV93b3JrKTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWNv
bnRleHRzX2ZyZWUoaTkxNSk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKKwljb250ZXh0c19mbHVzaF9mcmVlKGdjKTsKIH0KIAogdm9pZCBpOTE1X2dlbV9jb250ZXh0
X3JlbGVhc2Uoc3RydWN0IGtyZWYgKnJlZikKIHsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAq
Y3R4ID0gY29udGFpbmVyX29mKHJlZiwgdHlwZW9mKCpjdHgpLCByZWYpOwotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gY3R4LT5pOTE1OworCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0
cyAqZ2MgPSAmY3R4LT5pOTE1LT5nZW0uY29udGV4dHM7CiAKIAl0cmFjZV9pOTE1X2NvbnRleHRf
ZnJlZShjdHgpOwotCWlmIChsbGlzdF9hZGQoJmN0eC0+ZnJlZV9saW5rLCAmaTkxNS0+Y29udGV4
dHMuZnJlZV9saXN0KSkKLQkJcXVldWVfd29yayhpOTE1LT53cSwgJmk5MTUtPmNvbnRleHRzLmZy
ZWVfd29yayk7CisJaWYgKGxsaXN0X2FkZCgmY3R4LT5mcmVlX2xpbmssICZnYy0+ZnJlZV9saXN0
KSkKKwkJcXVldWVfd29yayhjdHgtPmk5MTUtPndxLCAmZ2MtPmZyZWVfd29yayk7CiB9CiAKIHN0
YXRpYyB2b2lkIGNvbnRleHRfY2xvc2Uoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIHsK
LQlpOTE1X2dlbV9jb250ZXh0X3NldF9jbG9zZWQoY3R4KTsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNz
X3NwYWNlICp2bTsKIAotCWlmIChjdHgtPnZtKQotCQlpOTE1X3ZtX2Nsb3NlKGN0eC0+dm0pOwor
CWk5MTVfZ2VtX2NvbnRleHRfc2V0X2Nsb3NlZChjdHgpOwogCiAJbXV0ZXhfbG9jaygmY3R4LT5t
dXRleCk7CiAKKwl2bSA9IGk5MTVfZ2VtX2NvbnRleHRfdm0oY3R4KTsKKwlpZiAodm0pCisJCWk5
MTVfdm1fY2xvc2Uodm0pOworCiAJY3R4LT5maWxlX3ByaXYgPSBFUlJfUFRSKC1FQkFERik7CiAK
IAkvKgpAQCAtMzE3LDcgKzMwNyw2IEBAIF9fY3JlYXRlX2NvbnRleHQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiAJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwogCiAJa3JlZl9pbml0
KCZjdHgtPnJlZik7Ci0JbGlzdF9hZGRfdGFpbCgmY3R4LT5saW5rLCAmaTkxNS0+Y29udGV4dHMu
bGlzdCk7CiAJY3R4LT5pOTE1ID0gaTkxNTsKIAljdHgtPnNjaGVkLnByaW9yaXR5ID0gSTkxNV9V
U0VSX1BSSU9SSVRZKEk5MTVfUFJJT1JJVFlfTk9STUFMKTsKIAltdXRleF9pbml0KCZjdHgtPm11
dGV4KTsKQEAgLTM0Myw2ICszMzIsMTAgQEAgX19jcmVhdGVfY29udGV4dChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIAlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShjdHgtPmhhbmdf
dGltZXN0YW1wKTsgaSsrKQogCQljdHgtPmhhbmdfdGltZXN0YW1wW2ldID0gamlmZmllcyAtIENP
TlRFWFRfRkFTVF9IQU5HX0pJRkZJRVM7CiAKKwlzcGluX2xvY2soJmk5MTUtPmdlbS5jb250ZXh0
cy5sb2NrKTsKKwlsaXN0X2FkZF90YWlsKCZjdHgtPmxpbmssICZpOTE1LT5nZW0uY29udGV4dHMu
bGlzdCk7CisJc3Bpbl91bmxvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKKwogCXJldHVy
biBjdHg7CiAKIGVycl9mcmVlOgpAQCAtMzcyLDExICszNjUsMTEgQEAgc3RhdGljIHZvaWQgX19h
cHBseV9wcGd0dChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIHZvaWQgKnZtKQogc3RhdGljIHN0
cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKgogX19zZXRfcHBndHQoc3RydWN0IGk5MTVfZ2VtX2Nv
bnRleHQgKmN0eCwgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiB7Ci0Jc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqb2xkID0gY3R4LT52bTsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3Nw
YWNlICpvbGQgPSBpOTE1X2dlbV9jb250ZXh0X3ZtKGN0eCk7CiAKIAlHRU1fQlVHX09OKG9sZCAm
JiBpOTE1X3ZtX2lzXzRsdmwodm0pICE9IGk5MTVfdm1faXNfNGx2bChvbGQpKTsKIAotCWN0eC0+
dm0gPSBpOTE1X3ZtX29wZW4odm0pOworCXJjdV9hc3NpZ25fcG9pbnRlcihjdHgtPnZtLCBpOTE1
X3ZtX29wZW4odm0pKTsKIAljb250ZXh0X2FwcGx5X2FsbChjdHgsIF9fYXBwbHlfcHBndHQsIHZt
KTsKIAogCXJldHVybiBvbGQ7CkBAIC0zODUsNyArMzc4LDcgQEAgX19zZXRfcHBndHQoc3RydWN0
IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiBz
dGF0aWMgdm9pZCBfX2Fzc2lnbl9wcGd0dChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAog
CQkJICAgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiB7Ci0JaWYgKHZtID09IGN0eC0+
dm0pCisJaWYgKHZtID09IHJjdV9hY2Nlc3NfcG9pbnRlcihjdHgtPnZtKSkKIAkJcmV0dXJuOwog
CiAJdm0gPSBfX3NldF9wcGd0dChjdHgsIHZtKTsKQEAgLTQxNywyNyArNDEwLDI1IEBAIHN0YXRp
YyB2b2lkIF9fYXNzaWduX3RpbWVsaW5lKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiB9
CiAKIHN0YXRpYyBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqCi1pOTE1X2dlbV9jcmVhdGVfY29u
dGV4dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHVuc2lnbmVkIGludCBmbGFn
cykKK2k5MTVfZ2VtX2NyZWF0ZV9jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LCB1bnNpZ25lZCBpbnQgZmxhZ3MpCiB7CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsK
IAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKLQog
CWlmIChmbGFncyAmIEk5MTVfQ09OVEVYVF9DUkVBVEVfRkxBR1NfU0lOR0xFX1RJTUVMSU5FICYm
Ci0JICAgICFIQVNfRVhFQ0xJU1RTKGRldl9wcml2KSkKKwkgICAgIUhBU19FWEVDTElTVFMoaTkx
NSkpCiAJCXJldHVybiBFUlJfUFRSKC1FSU5WQUwpOwogCi0JLyogUmVhcCB0aGUgbW9zdCBzdGFs
ZSBjb250ZXh0ICovCi0JY29udGV4dHNfZnJlZV9maXJzdChkZXZfcHJpdik7CisJLyogUmVhcCB0
aGUgc3RhbGUgY29udGV4dHMgKi8KKwljb250ZXh0c19mbHVzaF9mcmVlKCZpOTE1LT5nZW0uY29u
dGV4dHMpOwogCi0JY3R4ID0gX19jcmVhdGVfY29udGV4dChkZXZfcHJpdik7CisJY3R4ID0gX19j
cmVhdGVfY29udGV4dChpOTE1KTsKIAlpZiAoSVNfRVJSKGN0eCkpCiAJCXJldHVybiBjdHg7CiAK
LQlpZiAoSEFTX0ZVTExfUFBHVFQoZGV2X3ByaXYpKSB7CisJaWYgKEhBU19GVUxMX1BQR1RUKGk5
MTUpKSB7CiAJCXN0cnVjdCBpOTE1X3BwZ3R0ICpwcGd0dDsKIAotCQlwcGd0dCA9IGk5MTVfcHBn
dHRfY3JlYXRlKGRldl9wcml2KTsKKwkJcHBndHQgPSBpOTE1X3BwZ3R0X2NyZWF0ZShpOTE1KTsK
IAkJaWYgKElTX0VSUihwcGd0dCkpIHsKIAkJCURSTV9ERUJVR19EUklWRVIoIlBQR1RUIHNldHVw
IGZhaWxlZCAoJWxkKVxuIiwKIAkJCQkJIFBUUl9FUlIocHBndHQpKTsKQEAgLTQ0NSwxNCArNDM2
LDE3IEBAIGk5MTVfZ2VtX2NyZWF0ZV9jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwgdW5zaWduZWQgaW50IGZsYWdzKQogCQkJcmV0dXJuIEVSUl9DQVNUKHBwZ3R0KTsK
IAkJfQogCisJCW11dGV4X2xvY2soJmN0eC0+bXV0ZXgpOwogCQlfX2Fzc2lnbl9wcGd0dChjdHgs
ICZwcGd0dC0+dm0pOworCQltdXRleF91bmxvY2soJmN0eC0+bXV0ZXgpOworCiAJCWk5MTVfdm1f
cHV0KCZwcGd0dC0+dm0pOwogCX0KIAogCWlmIChmbGFncyAmIEk5MTVfQ09OVEVYVF9DUkVBVEVf
RkxBR1NfU0lOR0xFX1RJTUVMSU5FKSB7CiAJCXN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGltZWxp
bmU7CiAKLQkJdGltZWxpbmUgPSBpbnRlbF90aW1lbGluZV9jcmVhdGUoJmRldl9wcml2LT5ndCwg
TlVMTCk7CisJCXRpbWVsaW5lID0gaW50ZWxfdGltZWxpbmVfY3JlYXRlKCZpOTE1LT5ndCwgTlVM
TCk7CiAJCWlmIChJU19FUlIodGltZWxpbmUpKSB7CiAJCQljb250ZXh0X2Nsb3NlKGN0eCk7CiAJ
CQlyZXR1cm4gRVJSX0NBU1QodGltZWxpbmUpOwpAQCAtNDk3LDQ4ICs0OTEsNDAgQEAgaTkxNV9n
ZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBp
bnQgcHJpbykKIAlyZXR1cm4gY3R4OwogfQogCi1zdGF0aWMgdm9pZCBpbml0X2NvbnRleHRzKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQorc3RhdGljIHZvaWQgaW5pdF9jb250ZXh0cyhz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dHMgKmdjKQogewotCW11dGV4X2luaXQoJmk5MTUtPmNvbnRl
eHRzLm11dGV4KTsKLQlJTklUX0xJU1RfSEVBRCgmaTkxNS0+Y29udGV4dHMubGlzdCk7Ci0KLQkv
KiBVc2luZyB0aGUgc2ltcGxlIGlkYSBpbnRlcmZhY2UsIHRoZSBtYXggaXMgbGltaXRlZCBieSBz
aXplb2YoaW50KSAqLwotCUJVSUxEX0JVR19PTihNQVhfQ09OVEVYVF9IV19JRCA+IElOVF9NQVgp
OwotCUJVSUxEX0JVR19PTihHRU4xMV9NQVhfQ09OVEVYVF9IV19JRCA+IElOVF9NQVgpOwotCWlk
YV9pbml0KCZpOTE1LT5jb250ZXh0cy5od19pZGEpOwotCUlOSVRfTElTVF9IRUFEKCZpOTE1LT5j
b250ZXh0cy5od19pZF9saXN0KTsKKwlzcGluX2xvY2tfaW5pdCgmZ2MtPmxvY2spOworCUlOSVRf
TElTVF9IRUFEKCZnYy0+bGlzdCk7CiAKLQlJTklUX1dPUksoJmk5MTUtPmNvbnRleHRzLmZyZWVf
d29yaywgY29udGV4dHNfZnJlZV93b3JrZXIpOwotCWluaXRfbGxpc3RfaGVhZCgmaTkxNS0+Y29u
dGV4dHMuZnJlZV9saXN0KTsKKwlJTklUX1dPUksoJmdjLT5mcmVlX3dvcmssIGNvbnRleHRzX2Zy
ZWVfd29ya2VyKTsKKwlpbml0X2xsaXN0X2hlYWQoJmdjLT5mcmVlX2xpc3QpOwogfQogCi1pbnQg
aTkxNV9nZW1fY29udGV4dHNfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CitpbnQgaTkxNV9nZW1faW5pdF9jb250ZXh0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKIHsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwogCiAJLyogUmVhc3N1cmUgb3Vy
c2VsdmVzIHdlIGFyZSBvbmx5IGNhbGxlZCBvbmNlICovCi0JR0VNX0JVR19PTihkZXZfcHJpdi0+
a2VybmVsX2NvbnRleHQpOworCUdFTV9CVUdfT04oaTkxNS0+a2VybmVsX2NvbnRleHQpOwogCi0J
aW5pdF9jb250ZXh0cyhkZXZfcHJpdik7CisJaW5pdF9jb250ZXh0cygmaTkxNS0+Z2VtLmNvbnRl
eHRzKTsKIAogCS8qIGxvd2VzdCBwcmlvcml0eTsgaWRsZSB0YXNrICovCi0JY3R4ID0gaTkxNV9n
ZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKGRldl9wcml2LCBJOTE1X1BSSU9SSVRZX01JTik7CisJ
Y3R4ID0gaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKGk5MTUsIEk5MTVfUFJJT1JJVFlf
TUlOKTsKIAlpZiAoSVNfRVJSKGN0eCkpIHsKIAkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gY3JlYXRl
IGRlZmF1bHQgZ2xvYmFsIGNvbnRleHRcbiIpOwogCQlyZXR1cm4gUFRSX0VSUihjdHgpOwogCX0K
LQlkZXZfcHJpdi0+a2VybmVsX2NvbnRleHQgPSBjdHg7CisJaTkxNS0+a2VybmVsX2NvbnRleHQg
PSBjdHg7CiAKIAlEUk1fREVCVUdfRFJJVkVSKCIlcyBjb250ZXh0IHN1cHBvcnQgaW5pdGlhbGl6
ZWRcbiIsCi0JCQkgRFJJVkVSX0NBUFMoZGV2X3ByaXYpLT5oYXNfbG9naWNhbF9jb250ZXh0cyA/
CisJCQkgRFJJVkVSX0NBUFMoaTkxNSktPmhhc19sb2dpY2FsX2NvbnRleHRzID8KIAkJCSAibG9n
aWNhbCIgOiAiZmFrZSIpOwogCXJldHVybiAwOwogfQogCi12b2lkIGk5MTVfZ2VtX2NvbnRleHRz
X2Zpbmkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCit2b2lkIGk5MTVfZ2VtX2RyaXZl
cl9yZWxlYXNlX19jb250ZXh0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQls
b2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWRlc3Ryb3lf
a2VybmVsX2NvbnRleHQoJmk5MTUtPmtlcm5lbF9jb250ZXh0KTsKIH0KIApAQCAtNTU3LDExICs1
NDMsMTYgQEAgc3RhdGljIGludCB2bV9pZHJfY2xlYW51cChpbnQgaWQsIHZvaWQgKnAsIHZvaWQg
KmRhdGEpCiBzdGF0aWMgaW50IGdlbV9jb250ZXh0X3JlZ2lzdGVyKHN0cnVjdCBpOTE1X2dlbV9j
b250ZXh0ICpjdHgsCiAJCQkJc3RydWN0IGRybV9pOTE1X2ZpbGVfcHJpdmF0ZSAqZnByaXYpCiB7
CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CiAJaW50IHJldDsKIAogCWN0eC0+Zmls
ZV9wcml2ID0gZnByaXY7Ci0JaWYgKGN0eC0+dm0pCi0JCWN0eC0+dm0tPmZpbGUgPSBmcHJpdjsK
KworCW11dGV4X2xvY2soJmN0eC0+bXV0ZXgpOworCXZtID0gaTkxNV9nZW1fY29udGV4dF92bShj
dHgpOworCWlmICh2bSkKKwkJV1JJVEVfT05DRSh2bS0+ZmlsZSwgZnByaXYpOyAvKiBYWFggKi8K
KwltdXRleF91bmxvY2soJmN0eC0+bXV0ZXgpOwogCiAJY3R4LT5waWQgPSBnZXRfdGFza19waWQo
Y3VycmVudCwgUElEVFlQRV9QSUQpOwogCWN0eC0+bmFtZSA9IGthc3ByaW50ZihHRlBfS0VSTkVM
LCAiJXNbJWRdIiwKQEAgLTU5OCw5ICs1ODksNyBAQCBpbnQgaTkxNV9nZW1fY29udGV4dF9vcGVu
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCWlkcl9pbml0KCZmaWxlX3ByaXYtPmNv
bnRleHRfaWRyKTsKIAlpZHJfaW5pdF9iYXNlKCZmaWxlX3ByaXYtPnZtX2lkciwgMSk7CiAKLQlt
dXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAljdHggPSBpOTE1X2dlbV9jcmVh
dGVfY29udGV4dChpOTE1LCAwKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwogCWlmIChJU19FUlIoY3R4KSkgewogCQllcnIgPSBQVFJfRVJSKGN0eCk7CiAJCWdvdG8g
ZXJyOwpAQCAtNjI4LDYgKzYxNyw3IEBAIGludCBpOTE1X2dlbV9jb250ZXh0X29wZW4oc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiB2b2lkIGk5MTVfZ2VtX2NvbnRleHRfY2xvc2Uoc3Ry
dWN0IGRybV9maWxlICpmaWxlKQogewogCXN0cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGUgKmZp
bGVfcHJpdiA9IGZpbGUtPmRyaXZlcl9wcml2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gZmlsZV9wcml2LT5kZXZfcHJpdjsKIAogCWlkcl9mb3JfZWFjaCgmZmlsZV9wcml2LT5j
b250ZXh0X2lkciwgY29udGV4dF9pZHJfY2xlYW51cCwgTlVMTCk7CiAJaWRyX2Rlc3Ryb3koJmZp
bGVfcHJpdi0+Y29udGV4dF9pZHIpOwpAQCAtNjM2LDYgKzYyNiw4IEBAIHZvaWQgaTkxNV9nZW1f
Y29udGV4dF9jbG9zZShzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCiAJaWRyX2Zvcl9lYWNoKCZmaWxl
X3ByaXYtPnZtX2lkciwgdm1faWRyX2NsZWFudXAsIE5VTEwpOwogCWlkcl9kZXN0cm95KCZmaWxl
X3ByaXYtPnZtX2lkcik7CiAJbXV0ZXhfZGVzdHJveSgmZmlsZV9wcml2LT52bV9pZHJfbG9jayk7
CisKKwljb250ZXh0c19mbHVzaF9mcmVlKCZpOTE1LT5nZW0uY29udGV4dHMpOwogfQogCiBpbnQg
aTkxNV9nZW1fdm1fY3JlYXRlX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRh
dGEsCkBAIC04MTQsMTYgKzgwNiwxMiBAQCBzdGF0aWMgaW50IGdldF9wcGd0dChzdHJ1Y3QgZHJt
X2k5MTVfZmlsZV9wcml2YXRlICpmaWxlX3ByaXYsCiAJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZSAqdm07CiAJaW50IHJldDsKIAotCWlmICghY3R4LT52bSkKKwlpZiAoIXJjdV9hY2Nlc3NfcG9p
bnRlcihjdHgtPnZtKSkKIAkJcmV0dXJuIC1FTk9ERVY7CiAKLQkvKiBYWFggcmN1IGFjcXVpcmU/
ICovCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZjdHgtPmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KKwlyY3VfcmVhZF9sb2NrKCk7
CiAJdm0gPSBpOTE1X3ZtX2dldChjdHgtPnZtKTsKLQltdXRleF91bmxvY2soJmN0eC0+aTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CisJcmN1X3JlYWRfdW5sb2NrKCk7CiAKIAlyZXQgPSBtdXRleF9s
b2NrX2ludGVycnVwdGlibGUoJmZpbGVfcHJpdi0+dm1faWRyX2xvY2spOwogCWlmIChyZXQpCkBA
IC05MzIsNyArOTIwLDcgQEAgc3RhdGljIGludCBzZXRfcHBndHQoc3RydWN0IGRybV9pOTE1X2Zp
bGVfcHJpdmF0ZSAqZmlsZV9wcml2LAogCWlmIChhcmdzLT5zaXplKQogCQlyZXR1cm4gLUVJTlZB
TDsKIAotCWlmICghY3R4LT52bSkKKwlpZiAoIXJjdV9hY2Nlc3NfcG9pbnRlcihjdHgtPnZtKSkK
IAkJcmV0dXJuIC1FTk9ERVY7CiAKIAlpZiAodXBwZXJfMzJfYml0cyhhcmdzLT52YWx1ZSkpCkBA
IC05NDYsMTcgKzkzNCwyMCBAQCBzdGF0aWMgaW50IHNldF9wcGd0dChzdHJ1Y3QgZHJtX2k5MTVf
ZmlsZV9wcml2YXRlICpmaWxlX3ByaXYsCiAJaWYgKCF2bSkKIAkJcmV0dXJuIC1FTk9FTlQ7CiAK
LQllcnIgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmN0eC0+aTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CisJZXJyID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZjdHgtPm11dGV4KTsKIAlp
ZiAoZXJyKQogCQlnb3RvIG91dDsKIAotCWlmICh2bSA9PSBjdHgtPnZtKQorCWlmIChpOTE1X2dl
bV9jb250ZXh0X2lzX2Nsb3NlZChjdHgpKSB7CisJCWVyciA9IC1FTk9FTlQ7CisJCWdvdG8gb3V0
OworCX0KKworCWlmICh2bSA9PSByY3VfYWNjZXNzX3BvaW50ZXIoY3R4LT52bSkpCiAJCWdvdG8g
dW5sb2NrOwogCiAJLyogVGVhcmRvd24gdGhlIGV4aXN0aW5nIG9iajp2bWEgY2FjaGUsIGl0IHdp
bGwgaGF2ZSB0byBiZSByZWJ1aWx0LiAqLwotCW11dGV4X2xvY2soJmN0eC0+bXV0ZXgpOwogCWx1
dF9jbG9zZShjdHgpOwotCW11dGV4X3VubG9jaygmY3R4LT5tdXRleCk7CiAKIAlvbGQgPSBfX3Nl
dF9wcGd0dChjdHgsIHZtKTsKIApAQCAtOTc2LDggKzk2Nyw3IEBAIHN0YXRpYyBpbnQgc2V0X3Bw
Z3R0KHN0cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGUgKmZpbGVfcHJpdiwKIAl9CiAKIHVubG9j
azoKLQltdXRleF91bmxvY2soJmN0eC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KKwltdXRl
eF91bmxvY2soJmN0eC0+bXV0ZXgpOwogb3V0OgogCWk5MTVfdm1fcHV0KHZtKTsKIAlyZXR1cm4g
ZXJyOwpAQCAtMTgzMywxMCArMTgyMywxMSBAQCBzdGF0aWMgaW50IGNsb25lX3ZtKHN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0ICpkc3QsCiAJCSAgICBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqc3Jj
KQogewogCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOworCWludCBlcnIgPSAwOwogCiAJ
cmN1X3JlYWRfbG9jaygpOwogCWRvIHsKLQkJdm0gPSBSRUFEX09OQ0Uoc3JjLT52bSk7CisJCXZt
ID0gcmN1X2RlcmVmZXJlbmNlKHNyYy0+dm0pOwogCQlpZiAoIXZtKQogCQkJYnJlYWs7CiAKQEAg
LTE4NTgsNyArMTg0OSw3IEBAIHN0YXRpYyBpbnQgY2xvbmVfdm0oc3RydWN0IGk5MTVfZ2VtX2Nv
bnRleHQgKmRzdCwKIAkJICogaXQgY2Fubm90IGJlIHJlYWxsb2NhdGVkIGVsc2V3aGVyZS4KIAkJ
ICovCiAKLQkJaWYgKHZtID09IFJFQURfT05DRShzcmMtPnZtKSkKKwkJaWYgKHZtID09IHJjdV9h
Y2Nlc3NfcG9pbnRlcihzcmMtPnZtKSkKIAkJCWJyZWFrOwogCiAJCWk5MTVfdm1fcHV0KHZtKTsK
QEAgLTE4NjYsMTEgKzE4NTcsMTYgQEAgc3RhdGljIGludCBjbG9uZV92bShzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqZHN0LAogCXJjdV9yZWFkX3VubG9jaygpOwogCiAJaWYgKHZtKSB7Ci0JCV9f
YXNzaWduX3BwZ3R0KGRzdCwgdm0pOworCQlpZiAoIW11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgm
ZHN0LT5tdXRleCkpIHsKKwkJCV9fYXNzaWduX3BwZ3R0KGRzdCwgdm0pOworCQkJbXV0ZXhfdW5s
b2NrKCZkc3QtPm11dGV4KTsKKwkJfSBlbHNlIHsKKwkJCWVyciA9IC1FSU5UUjsKKwkJfQogCQlp
OTE1X3ZtX3B1dCh2bSk7CiAJfQogCi0JcmV0dXJuIDA7CisJcmV0dXJuIGVycjsKIH0KIAogc3Rh
dGljIGludCBjcmVhdGVfY2xvbmUoc3RydWN0IGk5MTVfdXNlcl9leHRlbnNpb24gX191c2VyICpl
eHQsIHZvaWQgKmRhdGEpCkBAIC0xOTYwLDEyICsxOTU2LDcgQEAgaW50IGk5MTVfZ2VtX2NvbnRl
eHRfY3JlYXRlX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCXJl
dHVybiAtRUlPOwogCX0KIAotCXJldCA9IGk5MTVfbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKGRl
dik7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQogCWV4dF9kYXRhLmN0eCA9IGk5MTVfZ2Vt
X2NyZWF0ZV9jb250ZXh0KGk5MTUsIGFyZ3MtPmZsYWdzKTsKLQltdXRleF91bmxvY2soJmRldi0+
c3RydWN0X211dGV4KTsKIAlpZiAoSVNfRVJSKGV4dF9kYXRhLmN0eCkpCiAJCXJldHVybiBQVFJf
RVJSKGV4dF9kYXRhLmN0eCk7CiAKQEAgLTIwOTIsMTAgKzIwODMsMTIgQEAgaW50IGk5MTVfZ2Vt
X2NvbnRleHRfZ2V0cGFyYW1faW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0
YSwKIAogCWNhc2UgSTkxNV9DT05URVhUX1BBUkFNX0dUVF9TSVpFOgogCQlhcmdzLT5zaXplID0g
MDsKLQkJaWYgKGN0eC0+dm0pCi0JCQlhcmdzLT52YWx1ZSA9IGN0eC0+dm0tPnRvdGFsOworCQly
Y3VfcmVhZF9sb2NrKCk7CisJCWlmIChyY3VfYWNjZXNzX3BvaW50ZXIoY3R4LT52bSkpCisJCQlh
cmdzLT52YWx1ZSA9IHJjdV9kZXJlZmVyZW5jZShjdHgtPnZtKS0+dG90YWw7CiAJCWVsc2UKIAkJ
CWFyZ3MtPnZhbHVlID0gdG9faTkxNShkZXYpLT5nZ3R0LnZtLnRvdGFsOworCQlyY3VfcmVhZF91
bmxvY2soKTsKIAkJYnJlYWs7CiAKIAljYXNlIEk5MTVfQ09OVEVYVF9QQVJBTV9OT19FUlJPUl9D
QVBUVVJFOgpAQCAtMjE2MSw3ICsyMTU0LDcgQEAgaW50IGk5MTVfZ2VtX2NvbnRleHRfc2V0cGFy
YW1faW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIGludCBpOTE1X2dl
bV9jb250ZXh0X3Jlc2V0X3N0YXRzX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCQkJ
ICAgICAgIHZvaWQgKmRhdGEsIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJc3RydWN0IGRybV9pOTE1X3Jlc2V0X3N0
YXRzICphcmdzID0gZGF0YTsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwogCWludCBy
ZXQ7CkBAIC0yMTgzLDcgKzIxNzYsNyBAQCBpbnQgaTkxNV9nZW1fY29udGV4dF9yZXNldF9zdGF0
c19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCSAqLwogCiAJaWYgKGNhcGFibGUoQ0FQ
X1NZU19BRE1JTikpCi0JCWFyZ3MtPnJlc2V0X2NvdW50ID0gaTkxNV9yZXNldF9jb3VudCgmZGV2
X3ByaXYtPmdwdV9lcnJvcik7CisJCWFyZ3MtPnJlc2V0X2NvdW50ID0gaTkxNV9yZXNldF9jb3Vu
dCgmaTkxNS0+Z3B1X2Vycm9yKTsKIAllbHNlCiAJCWFyZ3MtPnJlc2V0X2NvdW50ID0gMDsKIApk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaCBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmgKaW5kZXggNTBiYzI3
ZDMwYzAzLi45MjM0NTg2ODMwZDEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9jb250ZXh0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX2NvbnRleHQuaApAQCAtMTEsNyArMTEsOSBAQAogCiAjaW5jbHVkZSAiZ3QvaW50ZWxfY29u
dGV4dC5oIgogCisjaW5jbHVkZSAiaTkxNV9kcnYuaCIKICNpbmNsdWRlICJpOTE1X2dlbS5oIgor
I2luY2x1ZGUgImk5MTVfZ2VtX2d0dC5oIgogI2luY2x1ZGUgImk5MTVfc2NoZWR1bGVyLmgiCiAj
aW5jbHVkZSAiaW50ZWxfZGV2aWNlX2luZm8uaCIKIApAQCAtMTE4LDggKzEyMCw4IEBAIHN0YXRp
YyBpbmxpbmUgYm9vbCBpOTE1X2dlbV9jb250ZXh0X2lzX2tlcm5lbChzdHJ1Y3QgaTkxNV9nZW1f
Y29udGV4dCAqY3R4KQogfQogCiAvKiBpOTE1X2dlbV9jb250ZXh0LmMgKi8KLWludCBfX211c3Rf
Y2hlY2sgaTkxNV9nZW1fY29udGV4dHNfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpOwotdm9pZCBpOTE1X2dlbV9jb250ZXh0c19maW5pKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdik7CitpbnQgX19tdXN0X2NoZWNrIGk5MTVfZ2VtX2luaXRfY29udGV4dHMo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9pZCBpOTE1X2dlbV9kcml2ZXJfcmVs
ZWFzZV9fY29udGV4dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogCiBpbnQgaTkx
NV9nZW1fY29udGV4dF9vcGVuKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICBz
dHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpOwpAQCAtMTU4LDYgKzE2MCwyNyBAQCBzdGF0aWMgaW5saW5l
IHZvaWQgaTkxNV9nZW1fY29udGV4dF9wdXQoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkK
IAlrcmVmX3B1dCgmY3R4LT5yZWYsIGk5MTVfZ2VtX2NvbnRleHRfcmVsZWFzZSk7CiB9CiAKK3N0
YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqCitpOTE1X2dlbV9jb250ZXh0
X3ZtKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCit7CisJcmV0dXJuIHJjdV9kZXJlZmVy
ZW5jZV9wcm90ZWN0ZWQoY3R4LT52bSwgbG9ja2RlcF9pc19oZWxkKCZjdHgtPm11dGV4KSk7Cit9
CisKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqCitpOTE1X2dlbV9j
b250ZXh0X2dldF92bV9yY3Uoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKK3sKKwlzdHJ1
Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKKworCXJjdV9yZWFkX2xvY2soKTsKKwl2bSA9IHJj
dV9kZXJlZmVyZW5jZShjdHgtPnZtKTsKKwlpZiAoIXZtKQorCQl2bSA9ICZjdHgtPmk5MTUtPmdn
dHQudm07CisJdm0gPSBpOTE1X3ZtX2dldCh2bSk7CisJcmN1X3JlYWRfdW5sb2NrKCk7CisKKwly
ZXR1cm4gdm07Cit9CisKIHN0YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVfZ2VtX2VuZ2luZXMgKgog
aTkxNV9nZW1fY29udGV4dF9lbmdpbmVzKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCiB7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dF90
eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHRfdHlwZXMu
aAppbmRleCA4N2JlMjc4NzdlMjIuLmFiOGUxMzY3ZGZjOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHRfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dF90eXBlcy5oCkBAIC04OCw3ICs4OCw3IEBA
IHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0IHsKIAkgKiBJbiBvdGhlciBtb2RlcywgdGhpcyBpcyBh
IE5VTEwgcG9pbnRlciB3aXRoIHRoZSBleHBlY3RhdGlvbiB0aGF0CiAJICogdGhlIGNhbGxlciB1
c2VzIHRoZSBzaGFyZWQgZ2xvYmFsIEdUVC4KIAkgKi8KLQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3Nw
YWNlICp2bTsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlIF9fcmN1ICp2bTsKIAogCS8qKgog
CSAqIEBwaWQ6IHByb2Nlc3MgaWQgb2YgY3JlYXRvcgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKaW5kZXggODhhODgxYmUxMmVjLi45ODgxNmMzNWZm
YzMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVm
ZmVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIu
YwpAQCAtNzI4LDcgKzcyOCw3IEBAIHN0YXRpYyBpbnQgZWJfc2VsZWN0X2NvbnRleHQoc3RydWN0
IGk5MTVfZXhlY2J1ZmZlciAqZWIpCiAJCXJldHVybiAtRU5PRU5UOwogCiAJZWItPmdlbV9jb250
ZXh0ID0gY3R4OwotCWlmIChjdHgtPnZtKQorCWlmIChyY3VfYWNjZXNzX3BvaW50ZXIoY3R4LT52
bSkpCiAJCWViLT5pbnZhbGlkX2ZsYWdzIHw9IEVYRUNfT0JKRUNUX05FRURTX0dUVDsKIAogCWVi
LT5jb250ZXh0X2ZsYWdzID0gMDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV91c2VycHRyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
dXNlcnB0ci5jCmluZGV4IDE3MzhhMTVlYjkxMS4uNGY5NzA0NzQwMTNmIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMKQEAgLTc1OCw3ICs3NTgsOCBAQCBp
OTE1X2dlbV91c2VycHRyX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCSAqIE9uIGFs
bW9zdCBhbGwgb2YgdGhlIG9sZGVyIGh3LCB3ZSBjYW5ub3QgdGVsbCB0aGUgR1BVIHRoYXQKIAkJ
ICogYSBwYWdlIGlzIHJlYWRvbmx5LgogCQkgKi8KLQkJdm0gPSBkZXZfcHJpdi0+a2VybmVsX2Nv
bnRleHQtPnZtOworCQl2bSA9IHJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQoZGV2X3ByaXYtPmtl
cm5lbF9jb250ZXh0LT52bSwKKwkJCQkJICAgICAgIHRydWUpOyAvKiBzdGF0aWMgdm0gKi8KIAkJ
aWYgKCF2bSB8fCAhdm0tPmhhc19yZWFkX29ubHkpCiAJCQlyZXR1cm4gLUVOT0RFVjsKIAl9CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jCmluZGV4
IDk4YjJhNmNjZmNjMS4uMzMxNDg1OGYzMDQ2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYwpAQCAtMTMyMiwxNSArMTMyMiwxNSBAQCBzdGF0
aWMgaW50IGlndF9wcGd0dF9waW5fdXBkYXRlKHZvaWQgKmFyZykKIAlzdHJ1Y3QgaTkxNV9nZW1f
Y29udGV4dCAqY3R4ID0gYXJnOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IGN0eC0+aTkxNTsKIAl1bnNpZ25lZCBsb25nIHN1cHBvcnRlZCA9IElOVEVMX0lORk8oZGV2X3By
aXYpLT5wYWdlX3NpemVzOwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gY3R4LT52
bTsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwogCXN0cnVjdCBpOTE1X2dlbV9l
bmdpbmVzX2l0ZXIgaXQ7CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CiAJc3RydWN0
IGludGVsX2NvbnRleHQgKmNlOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCXVuc2lnbmVkIGlu
dCBmbGFncyA9IFBJTl9VU0VSIHwgUElOX09GRlNFVF9GSVhFRDsKIAl1bnNpZ25lZCBpbnQgbjsK
IAlpbnQgZmlyc3QsIGxhc3Q7Ci0JaW50IGVycjsKKwlpbnQgZXJyID0gMDsKIAogCS8qCiAJICog
TWFrZSBzdXJlIHRoZXJlJ3Mgbm8gZnVubnkgYnVzaW5lc3Mgd2hlbiBkb2luZyBhIFBJTl9VUERB
VEUgLS0gaW4gdGhlCkBAIC0xMzQwLDkgKzEzNDAsMTAgQEAgc3RhdGljIGludCBpZ3RfcHBndHRf
cGluX3VwZGF0ZSh2b2lkICphcmcpCiAJICogaHVnZS1ndHQtcGFnZXMuCiAJICovCiAKLQlpZiAo
IXZtIHx8ICFpOTE1X3ZtX2lzXzRsdmwodm0pKSB7CisJdm0gPSBpOTE1X2dlbV9jb250ZXh0X2dl
dF92bV9yY3UoY3R4KTsKKwlpZiAoIWk5MTVfdm1faXNfNGx2bCh2bSkpIHsKIAkJcHJfaW5mbygi
NDhiIFBQR1RUIG5vdCBzdXBwb3J0ZWQsIHNraXBwaW5nXG4iKTsKLQkJcmV0dXJuIDA7CisJCWdv
dG8gb3V0X3ZtOwogCX0KIAogCWZpcnN0ID0gaWxvZzIoSTkxNV9HVFRfUEFHRV9TSVpFXzY0Syk7
CkBAIC0xNDUxLDYgKzE0NTIsOCBAQCBzdGF0aWMgaW50IGlndF9wcGd0dF9waW5fdXBkYXRlKHZv
aWQgKmFyZykKIAlpOTE1X3ZtYV9jbG9zZSh2bWEpOwogb3V0X3B1dDoKIAlpOTE1X2dlbV9vYmpl
Y3RfcHV0KG9iaik7CitvdXRfdm06CisJaTkxNV92bV9wdXQodm0pOwogCiAJcmV0dXJuIGVycjsK
IH0KQEAgLTE0NjAsNyArMTQ2Myw3IEBAIHN0YXRpYyBpbnQgaWd0X3RtcGZzX2ZhbGxiYWNrKHZv
aWQgKmFyZykKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4ID0gYXJnOwogCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gY3R4LT5pOTE1OwogCXN0cnVjdCB2ZnNtb3VudCAqZ2Vt
ZnMgPSBpOTE1LT5tbS5nZW1mczsKLQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IGN0
eC0+dm0gPzogJmk5MTUtPmdndHQudm07CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0g
PSBpOTE1X2dlbV9jb250ZXh0X2dldF92bV9yY3UoY3R4KTsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCXUzMiAqdmFkZHI7CkBAIC0x
NTEwLDYgKzE1MTMsNyBAQCBzdGF0aWMgaW50IGlndF90bXBmc19mYWxsYmFjayh2b2lkICphcmcp
CiBvdXRfcmVzdG9yZToKIAlpOTE1LT5tbS5nZW1mcyA9IGdlbWZzOwogCisJaTkxNV92bV9wdXQo
dm0pOwogCXJldHVybiBlcnI7CiB9CiAKQEAgLTE1MTcsMTQgKzE1MjEsMTQgQEAgc3RhdGljIGlu
dCBpZ3Rfc2hyaW5rX3RocCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQg
KmN0eCA9IGFyZzsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGN0eC0+aTkxNTsK
LQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IGN0eC0+dm0gPzogJmk5MTUtPmdndHQu
dm07CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSBpOTE1X2dlbV9jb250ZXh0X2dl
dF92bV9yY3UoY3R4KTsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwogCXN0cnVj
dCBpOTE1X2dlbV9lbmdpbmVzX2l0ZXIgaXQ7CiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwog
CXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCXVuc2lnbmVkIGludCBmbGFncyA9IFBJTl9VU0VSOwog
CXVuc2lnbmVkIGludCBuOwotCWludCBlcnI7CisJaW50IGVyciA9IDA7CiAKIAkvKgogCSAqIFNh
bml0eSBjaGVjayBzaHJpbmtpbmcgaHVnZS1wYWdlZCBvYmplY3QgLS0gbWFrZSBzdXJlIG5vdGhp
bmcgYmxvd3MKQEAgLTE1MzMsMTIgKzE1MzcsMTQgQEAgc3RhdGljIGludCBpZ3Rfc2hyaW5rX3Ro
cCh2b2lkICphcmcpCiAKIAlpZiAoIWlndF9jYW5fYWxsb2NhdGVfdGhwKGk5MTUpKSB7CiAJCXBy
X2luZm8oIm1pc3NpbmcgVEhQIHN1cHBvcnQsIHNraXBwaW5nXG4iKTsKLQkJcmV0dXJuIDA7CisJ
CWdvdG8gb3V0X3ZtOwogCX0KIAogCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc2htZW0o
aTkxNSwgU1pfMk0pOwotCWlmIChJU19FUlIob2JqKSkKLQkJcmV0dXJuIFBUUl9FUlIob2JqKTsK
KwlpZiAoSVNfRVJSKG9iaikpIHsKKwkJZXJyID0gUFRSX0VSUihvYmopOworCQlnb3RvIG91dF92
bTsKKwl9CiAKIAl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosIHZtLCBOVUxMKTsKIAlpZiAo
SVNfRVJSKHZtYSkpIHsKQEAgLTE2MDcsNiArMTYxMyw4IEBAIHN0YXRpYyBpbnQgaWd0X3Nocmlu
a190aHAodm9pZCAqYXJnKQogCWk5MTVfdm1hX2Nsb3NlKHZtYSk7CiBvdXRfcHV0OgogCWk5MTVf
Z2VtX29iamVjdF9wdXQob2JqKTsKK291dF92bToKKwlpOTE1X3ZtX3B1dCh2bSk7CiAKIAlyZXR1
cm4gZXJyOwogfQpAQCAtMTY3NSw2ICsxNjgzLDcgQEAgaW50IGk5MTVfZ2VtX2h1Z2VfcGFnZV9s
aXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAl9OwogCXN0cnVj
dCBkcm1fZmlsZSAqZmlsZTsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OworCXN0cnVj
dCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCWlu
dCBlcnI7CiAKQEAgLTE2OTksOCArMTcwOCwxMSBAQCBpbnQgaTkxNV9nZW1faHVnZV9wYWdlX2xp
dmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCQlnb3RvIG91dF91
bmxvY2s7CiAJfQogCi0JaWYgKGN0eC0+dm0pCi0JCWN0eC0+dm0tPnNjcnViXzY0SyA9IHRydWU7
CisJbXV0ZXhfbG9jaygmY3R4LT5tdXRleCk7CisJdm0gPSBpOTE1X2dlbV9jb250ZXh0X3ZtKGN0
eCk7CisJaWYgKHZtKQorCQlXUklURV9PTkNFKHZtLT5zY3J1Yl82NEssIHRydWUpOworCW11dGV4
X3VubG9jaygmY3R4LT5tdXRleCk7CiAKIAllcnIgPSBpOTE1X3N1YnRlc3RzKHRlc3RzLCBjdHgp
OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVf
Z2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9n
ZW1fY29udGV4dC5jCmluZGV4IDJmYjMxYWRhMmZhNy4uZDQ0ZmE5ZDM1NmYxIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQu
YwpAQCAtNTMsMTkgKzUzLDE3IEBAIHN0YXRpYyBpbnQgbGl2ZV9ub3Bfc3dpdGNoKHZvaWQgKmFy
ZykKIAlpZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKIAotCW11dGV4
X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJY3R4ID0ga2NhbGxvYyhuY3R4LCBz
aXplb2YoKmN0eCksIEdGUF9LRVJORUwpOwogCWlmICghY3R4KSB7CiAJCWVyciA9IC1FTk9NRU07
Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290byBvdXRfZmlsZTsKIAl9CiAKIAlmb3IgKG4gPSAw
OyBuIDwgbmN0eDsgbisrKSB7CiAJCWN0eFtuXSA9IGxpdmVfY29udGV4dChpOTE1LCBmaWxlKTsK
IAkJaWYgKElTX0VSUihjdHhbbl0pKSB7CiAJCQllcnIgPSBQVFJfRVJSKGN0eFtuXSk7Ci0JCQln
b3RvIG91dF91bmxvY2s7CisJCQlnb3RvIG91dF9maWxlOwogCQl9CiAJfQogCkBAIC03OSw3ICs3
Nyw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9ub3Bfc3dpdGNoKHZvaWQgKmFyZykKIAkJCXJxID0gaWd0
X3JlcXVlc3RfYWxsb2MoY3R4W25dLCBlbmdpbmUpOwogCQkJaWYgKElTX0VSUihycSkpIHsKIAkJ
CQllcnIgPSBQVFJfRVJSKHJxKTsKLQkJCQlnb3RvIG91dF91bmxvY2s7CisJCQkJZ290byBvdXRf
ZmlsZTsKIAkJCX0KIAkJCWk5MTVfcmVxdWVzdF9hZGQocnEpOwogCQl9CkBAIC04Nyw3ICs4NSw3
IEBAIHN0YXRpYyBpbnQgbGl2ZV9ub3Bfc3dpdGNoKHZvaWQgKmFyZykKIAkJCXByX2VycigiRmFp
bGVkIHRvIHBvcHVsYXRlZCAlZCBjb250ZXh0c1xuIiwgbmN0eCk7CiAJCQlpbnRlbF9ndF9zZXRf
d2VkZ2VkKCZpOTE1LT5ndCk7CiAJCQllcnIgPSAtRUlPOwotCQkJZ290byBvdXRfdW5sb2NrOwor
CQkJZ290byBvdXRfZmlsZTsKIAkJfQogCiAJCXRpbWVzWzFdID0ga3RpbWVfZ2V0X3JhdygpOwpA
QCAtOTcsNyArOTUsNyBAQCBzdGF0aWMgaW50IGxpdmVfbm9wX3N3aXRjaCh2b2lkICphcmcpCiAK
IAkJZXJyID0gaWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgaTkxNSwgX19mdW5jX18sIGVuZ2luZS0+
bmFtZSk7CiAJCWlmIChlcnIpCi0JCQlnb3RvIG91dF91bmxvY2s7CisJCQlnb3RvIG91dF9maWxl
OwogCiAJCWVuZF90aW1lID0gamlmZmllcyArIGk5MTVfc2VsZnRlc3QudGltZW91dF9qaWZmaWVz
OwogCQlmb3JfZWFjaF9wcmltZV9udW1iZXJfZnJvbShwcmltZSwgMiwgODE5MikgewpAQCAtMTA3
LDcgKzEwNSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9ub3Bfc3dpdGNoKHZvaWQgKmFyZykKIAkJCQly
cSA9IGlndF9yZXF1ZXN0X2FsbG9jKGN0eFtuICUgbmN0eF0sIGVuZ2luZSk7CiAJCQkJaWYgKElT
X0VSUihycSkpIHsKIAkJCQkJZXJyID0gUFRSX0VSUihycSk7Ci0JCQkJCWdvdG8gb3V0X3VubG9j
azsKKwkJCQkJZ290byBvdXRfZmlsZTsKIAkJCQl9CiAKIAkJCQkvKgpAQCAtMTQzLDcgKzE0MSw3
IEBAIHN0YXRpYyBpbnQgbGl2ZV9ub3Bfc3dpdGNoKHZvaWQgKmFyZykKIAogCQllcnIgPSBpZ3Rf
bGl2ZV90ZXN0X2VuZCgmdCk7CiAJCWlmIChlcnIpCi0JCQlnb3RvIG91dF91bmxvY2s7CisJCQln
b3RvIG91dF9maWxlOwogCiAJCXByX2luZm8oIlN3aXRjaCBsYXRlbmNpZXMgb24gJXM6IDEgPSAl
bGx1bnMsICVsdSA9ICVsbHVuc1xuIiwKIAkJCWVuZ2luZS0+bmFtZSwKQEAgLTE1MSw4ICsxNDks
NyBAQCBzdGF0aWMgaW50IGxpdmVfbm9wX3N3aXRjaCh2b2lkICphcmcpCiAJCQlwcmltZSAtIDEs
IGRpdjY0X3U2NChrdGltZV90b19ucyh0aW1lc1sxXSksIHByaW1lIC0gMSkpOwogCX0KIAotb3V0
X3VubG9jazoKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworb3V0X2Zp
bGU6CiAJbW9ja19maWxlX2ZyZWUoaTkxNSwgZmlsZSk7CiAJcmV0dXJuIGVycjsKIH0KQEAgLTI1
MywxMiArMjUwLDEwIEBAIHN0YXRpYyBpbnQgbGl2ZV9wYXJhbGxlbF9zd2l0Y2godm9pZCAqYXJn
KQogCWlmIChJU19FUlIoZmlsZSkpCiAJCXJldHVybiBQVFJfRVJSKGZpbGUpOwogCi0JbXV0ZXhf
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAljdHggPSBsaXZlX2NvbnRleHQoaTkx
NSwgZmlsZSk7CiAJaWYgKElTX0VSUihjdHgpKSB7CiAJCWVyciA9IFBUUl9FUlIoY3R4KTsKLQkJ
Z290byBvdXRfbG9ja2VkOworCQlnb3RvIG91dF9maWxlOwogCX0KIAogCWVuZ2luZXMgPSBpOTE1
X2dlbV9jb250ZXh0X2xvY2tfZW5naW5lcyhjdHgpOwpAQCAtMjY4LDcgKzI2Myw3IEBAIHN0YXRp
YyBpbnQgbGl2ZV9wYXJhbGxlbF9zd2l0Y2godm9pZCAqYXJnKQogCWlmICghZGF0YSkgewogCQlp
OTE1X2dlbV9jb250ZXh0X3VubG9ja19lbmdpbmVzKGN0eCk7CiAJCWVyciA9IC1FTk9NRU07Ci0J
CWdvdG8gb3V0X2xvY2tlZDsKKwkJZ290byBvdXQ7CiAJfQogCiAJbSA9IDA7IC8qIFVzZSB0aGUg
Zmlyc3QgY29udGV4dCBhcyBvdXIgdGVtcGxhdGUgZm9yIHRoZSBlbmdpbmVzICovCkBAIC0yNzYs
NyArMjcxLDcgQEAgc3RhdGljIGludCBsaXZlX3BhcmFsbGVsX3N3aXRjaCh2b2lkICphcmcpCiAJ
CWVyciA9IGludGVsX2NvbnRleHRfcGluKGNlKTsKIAkJaWYgKGVycikgewogCQkJaTkxNV9nZW1f
Y29udGV4dF91bmxvY2tfZW5naW5lcyhjdHgpOwotCQkJZ290byBvdXRfbG9ja2VkOworCQkJZ290
byBvdXQ7CiAJCX0KIAkJZGF0YVttKytdLmNlWzBdID0gaW50ZWxfY29udGV4dF9nZXQoY2UpOwog
CX0KQEAgLTI4Nyw3ICsyODIsNyBAQCBzdGF0aWMgaW50IGxpdmVfcGFyYWxsZWxfc3dpdGNoKHZv
aWQgKmFyZykKIAkJY3R4ID0gbGl2ZV9jb250ZXh0KGk5MTUsIGZpbGUpOwogCQlpZiAoSVNfRVJS
KGN0eCkpIHsKIAkJCWVyciA9IFBUUl9FUlIoY3R4KTsKLQkJCWdvdG8gb3V0X2xvY2tlZDsKKwkJ
CWdvdG8gb3V0OwogCQl9CiAKIAkJZm9yIChtID0gMDsgbSA8IGNvdW50OyBtKyspIHsKQEAgLTI5
NiwyMCArMjkxLDE4IEBAIHN0YXRpYyBpbnQgbGl2ZV9wYXJhbGxlbF9zd2l0Y2godm9pZCAqYXJn
KQogCiAJCQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGN0eCwgZGF0YVttXS5jZVswXS0+ZW5n
aW5lKTsKIAkJCWlmIChJU19FUlIoY2UpKQotCQkJCWdvdG8gb3V0X2xvY2tlZDsKKwkJCQlnb3Rv
IG91dDsKIAogCQkJZXJyID0gaW50ZWxfY29udGV4dF9waW4oY2UpOwogCQkJaWYgKGVycikgewog
CQkJCWludGVsX2NvbnRleHRfcHV0KGNlKTsKLQkJCQlnb3RvIG91dF9sb2NrZWQ7CisJCQkJZ290
byBvdXQ7CiAJCQl9CiAKIAkJCWRhdGFbbV0uY2Vbbl0gPSBjZTsKIAkJfQogCX0KIAotCW11dGV4
X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlmb3IgKGZuID0gZnVuYzsgIWVy
ciAmJiAqZm47IGZuKyspIHsKIAkJc3RydWN0IGlndF9saXZlX3Rlc3QgdDsKIAkJaW50IG47CkBA
IC0zNTQsOCArMzQ3LDcgQEAgc3RhdGljIGludCBsaXZlX3BhcmFsbGVsX3N3aXRjaCh2b2lkICph
cmcpCiAJCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJfQogCi0JbXV0
ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci1vdXRfbG9ja2VkOgorb3V0OgogCWZv
ciAobiA9IDA7IG4gPCBjb3VudDsgbisrKSB7CiAJCWZvciAobSA9IDA7IG0gPCBBUlJBWV9TSVpF
KGRhdGEtPmNlKTsgbSsrKSB7CiAJCQlpZiAoIWRhdGFbbl0uY2VbbV0pCkBAIC0zNjUsOCArMzU3
LDggQEAgc3RhdGljIGludCBsaXZlX3BhcmFsbGVsX3N3aXRjaCh2b2lkICphcmcpCiAJCQlpbnRl
bF9jb250ZXh0X3B1dChkYXRhW25dLmNlW21dKTsKIAkJfQogCX0KLQltdXRleF91bmxvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWtmcmVlKGRhdGEpOworb3V0X2ZpbGU6CiAJbW9ja19m
aWxlX2ZyZWUoaTkxNSwgZmlsZSk7CiAJcmV0dXJuIGVycjsKIH0KQEAgLTYyNiwxMSArNjE4LDkg
QEAgc3RhdGljIGludCBpZ3RfY3R4X2V4ZWModm9pZCAqYXJnKQogCQlpZiAoSVNfRVJSKGZpbGUp
KQogCQkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAKLQkJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7Ci0KIAkJZXJyID0gaWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgaTkxNSwgX19m
dW5jX18sIGVuZ2luZS0+bmFtZSk7CiAJCWlmIChlcnIpCi0JCQlnb3RvIG91dF91bmxvY2s7CisJ
CQlnb3RvIG91dF9maWxlOwogCiAJCW5jb250ZXh0cyA9IDA7CiAJCW5kd29yZHMgPSAwOwpAQCAt
NjQyLDcgKzYzMiw3IEBAIHN0YXRpYyBpbnQgaWd0X2N0eF9leGVjKHZvaWQgKmFyZykKIAkJCWN0
eCA9IGtlcm5lbF9jb250ZXh0KGk5MTUpOwogCQkJaWYgKElTX0VSUihjdHgpKSB7CiAJCQkJZXJy
ID0gUFRSX0VSUihjdHgpOwotCQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCQlnb3RvIG91dF9maWxl
OwogCQkJfQogCiAJCQljZSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X2VuZ2luZShjdHgsIGVuZ2lu
ZS0+bGVnYWN5X2lkeCk7CkBAIC02NTQsNyArNjQ0LDcgQEAgc3RhdGljIGludCBpZ3RfY3R4X2V4
ZWModm9pZCAqYXJnKQogCQkJCQllcnIgPSBQVFJfRVJSKG9iaik7CiAJCQkJCWludGVsX2NvbnRl
eHRfcHV0KGNlKTsKIAkJCQkJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKLQkJCQkJZ290byBv
dXRfdW5sb2NrOworCQkJCQlnb3RvIG91dF9maWxlOwogCQkJCX0KIAkJCX0KIApAQCAtNjYzLDE3
ICs2NTMsMTggQEAgc3RhdGljIGludCBpZ3RfY3R4X2V4ZWModm9pZCAqYXJnKQogCQkJCXByX2Vy
cigiRmFpbGVkIHRvIGZpbGwgZHdvcmQgJWx1IFslbHUvJWx1XSB3aXRoIGdwdSAoJXMpIFtmdWxs
LXBwZ3R0PyAlc10sIGVycj0lZFxuIiwKIAkJCQkgICAgICAgbmR3b3JkcywgZHcsIG1heF9kd29y
ZHMob2JqKSwKIAkJCQkgICAgICAgZW5naW5lLT5uYW1lLAotCQkJCSAgICAgICB5ZXNubyghIWN0
eC0+dm0pLCBlcnIpOworCQkJCSAgICAgICB5ZXNubyghIXJjdV9hY2Nlc3NfcG9pbnRlcihjdHgt
PnZtKSksCisJCQkJICAgICAgIGVycik7CiAJCQkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwogCQkJ
CWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7Ci0JCQkJZ290byBvdXRfdW5sb2NrOworCQkJCWdv
dG8gb3V0X2ZpbGU7CiAJCQl9CiAKIAkJCWVyciA9IHRocm90dGxlKGNlLCB0cSwgQVJSQVlfU0la
RSh0cSkpOwogCQkJaWYgKGVycikgewogCQkJCWludGVsX2NvbnRleHRfcHV0KGNlKTsKIAkJCQlr
ZXJuZWxfY29udGV4dF9jbG9zZShjdHgpOwotCQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCQlnb3Rv
IG91dF9maWxlOwogCQkJfQogCiAJCQlpZiAoKytkdyA9PSBtYXhfZHdvcmRzKG9iaikpIHsKQEAg
LTcwMywxMSArNjk0LDEwIEBAIHN0YXRpYyBpbnQgaWd0X2N0eF9leGVjKHZvaWQgKmFyZykKIAkJ
CWR3ICs9IHJlbTsKIAkJfQogCi1vdXRfdW5sb2NrOgorb3V0X2ZpbGU6CiAJCXRocm90dGxlX3Jl
bGVhc2UodHEsIEFSUkFZX1NJWkUodHEpKTsKIAkJaWYgKGlndF9saXZlX3Rlc3RfZW5kKCZ0KSkK
IAkJCWVyciA9IC1FSU87Ci0JCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiAKIAkJbW9ja19maWxlX2ZyZWUoaTkxNSwgZmlsZSk7CiAJCWlmIChlcnIpCkBAIC03NDIsMjIg
KzczMiwyMCBAQCBzdGF0aWMgaW50IGlndF9zaGFyZWRfY3R4X2V4ZWModm9pZCAqYXJnKQogCWlm
IChJU19FUlIoZmlsZSkpCiAJCXJldHVybiBQVFJfRVJSKGZpbGUpOwogCi0JbXV0ZXhfbG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlwYXJlbnQgPSBsaXZlX2NvbnRleHQoaTkxNSwg
ZmlsZSk7CiAJaWYgKElTX0VSUihwYXJlbnQpKSB7CiAJCWVyciA9IFBUUl9FUlIocGFyZW50KTsK
LQkJZ290byBvdXRfdW5sb2NrOworCQlnb3RvIG91dF9maWxlOwogCX0KIAogCWlmICghcGFyZW50
LT52bSkgeyAvKiBub3QgZnVsbC1wcGd0dDsgbm90aGluZyB0byBzaGFyZSAqLwogCQllcnIgPSAw
OwotCQlnb3RvIG91dF91bmxvY2s7CisJCWdvdG8gb3V0X2ZpbGU7CiAJfQogCiAJZXJyID0gaWd0
X2xpdmVfdGVzdF9iZWdpbigmdCwgaTkxNSwgX19mdW5jX18sICIiKTsKIAlpZiAoZXJyKQotCQln
b3RvIG91dF91bmxvY2s7CisJCWdvdG8gb3V0X2ZpbGU7CiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5n
aW5lLCBpOTE1LCBpZCkgewogCQl1bnNpZ25lZCBsb25nIG5jb250ZXh0cywgbmR3b3JkcywgZHc7
CkBAIC03ODEsNyArNzY5LDkgQEAgc3RhdGljIGludCBpZ3Rfc2hhcmVkX2N0eF9leGVjKHZvaWQg
KmFyZykKIAkJCQlnb3RvIG91dF90ZXN0OwogCQkJfQogCisJCQltdXRleF9sb2NrKCZjdHgtPm11
dGV4KTsKIAkJCV9fYXNzaWduX3BwZ3R0KGN0eCwgcGFyZW50LT52bSk7CisJCQltdXRleF91bmxv
Y2soJmN0eC0+bXV0ZXgpOwogCiAJCQljZSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X2VuZ2luZShj
dHgsIGVuZ2luZS0+bGVnYWN5X2lkeCk7CiAJCQlHRU1fQlVHX09OKElTX0VSUihjZSkpOwpAQCAt
ODAxLDcgKzc5MSw4IEBAIHN0YXRpYyBpbnQgaWd0X3NoYXJlZF9jdHhfZXhlYyh2b2lkICphcmcp
CiAJCQkJcHJfZXJyKCJGYWlsZWQgdG8gZmlsbCBkd29yZCAlbHUgWyVsdS8lbHVdIHdpdGggZ3B1
ICglcykgW2Z1bGwtcHBndHQ/ICVzXSwgZXJyPSVkXG4iLAogCQkJCSAgICAgICBuZHdvcmRzLCBk
dywgbWF4X2R3b3JkcyhvYmopLAogCQkJCSAgICAgICBlbmdpbmUtPm5hbWUsCi0JCQkJICAgICAg
IHllc25vKCEhY3R4LT52bSksIGVycik7CisJCQkJICAgICAgIHllc25vKCEhcmN1X2FjY2Vzc19w
b2ludGVyKGN0eC0+dm0pKSwKKwkJCQkgICAgICAgZXJyKTsKIAkJCQlpbnRlbF9jb250ZXh0X3B1
dChjZSk7CiAJCQkJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKIAkJCQlnb3RvIG91dF90ZXN0
OwpAQCAtODQwLDE3ICs4MzEsMTMgQEAgc3RhdGljIGludCBpZ3Rfc2hhcmVkX2N0eF9leGVjKHZv
aWQgKmFyZykKIAkJCWR3ICs9IHJlbTsKIAkJfQogCi0JCW11dGV4X3VubG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CiAJCWk5MTVfZ2VtX2RyYWluX2ZyZWVkX29iamVjdHMoaTkxNSk7Ci0J
CW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCX0KIG91dF90ZXN0OgogCXRo
cm90dGxlX3JlbGVhc2UodHEsIEFSUkFZX1NJWkUodHEpKTsKIAlpZiAoaWd0X2xpdmVfdGVzdF9l
bmQoJnQpKQogCQllcnIgPSAtRUlPOwotb3V0X3VubG9jazoKLQltdXRleF91bmxvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwotCitvdXRfZmlsZToKIAltb2NrX2ZpbGVfZnJlZShpOTE1LCBm
aWxlKTsKIAlyZXR1cm4gZXJyOwogfQpAQCAtMTIyMiw4ICsxMjA5LDYgQEAgX19pZ3RfY3R4X3Nz
ZXUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJaWYgKGZsYWdzICYgVEVTVF9SRVNF
VCkKIAkJaWd0X2dsb2JhbF9yZXNldF9sb2NrKCZpOTE1LT5ndCk7CiAKLQltdXRleF9sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWN0eCA9IGxpdmVfY29udGV4dChpOTE1LCBmaWxl
KTsKIAlpZiAoSVNfRVJSKGN0eCkpIHsKIAkJcmV0ID0gUFRSX0VSUihjdHgpOwpAQCAtMTI3OCw4
ICsxMjYzLDYgQEAgX19pZ3RfY3R4X3NzZXUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwogCiBvdXRfdW5sb2NrOgotCW11dGV4X3VubG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlpZiAoZmxhZ3MgJiBURVNUX1JFU0VUKQog
CQlpZ3RfZ2xvYmFsX3Jlc2V0X3VubG9jaygmaTkxNS0+Z3QpOwogCkBAIC0xMzM5LDIzICsxMzIy
LDI0IEBAIHN0YXRpYyBpbnQgaWd0X2N0eF9yZWFkb25seSh2b2lkICphcmcpCiAJaWYgKElTX0VS
UihmaWxlKSkKIAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKLQogCWVyciA9IGlndF9saXZlX3Rlc3RfYmVnaW4oJnQsIGk5MTUs
IF9fZnVuY19fLCAiIik7CiAJaWYgKGVycikKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3RvIG91
dF9maWxlOwogCiAJY3R4ID0gbGl2ZV9jb250ZXh0KGk5MTUsIGZpbGUpOwogCWlmIChJU19FUlIo
Y3R4KSkgewogCQllcnIgPSBQVFJfRVJSKGN0eCk7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290
byBvdXRfZmlsZTsKIAl9CiAKLQl2bSA9IGN0eC0+dm0gPzogJmk5MTUtPmdndHQuYWxpYXMtPnZt
OworCXJjdV9yZWFkX2xvY2soKTsKKwl2bSA9IHJjdV9kZXJlZmVyZW5jZShjdHgtPnZtKSA/OiAm
aTkxNS0+Z2d0dC5hbGlhcy0+dm07CiAJaWYgKCF2bSB8fCAhdm0tPmhhc19yZWFkX29ubHkpIHsK
KwkJcmN1X3JlYWRfdW5sb2NrKCk7CiAJCWVyciA9IDA7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJ
Z290byBvdXRfZmlsZTsKIAl9CisJcmN1X3JlYWRfdW5sb2NrKCk7CiAKIAluZHdvcmRzID0gMDsK
IAlkdyA9IDA7CkBAIC0xMzczLDcgKzEzNTcsNyBAQCBzdGF0aWMgaW50IGlndF9jdHhfcmVhZG9u
bHkodm9pZCAqYXJnKQogCQkJCWlmIChJU19FUlIob2JqKSkgewogCQkJCQllcnIgPSBQVFJfRVJS
KG9iaik7CiAJCQkJCWk5MTVfZ2VtX2NvbnRleHRfdW5sb2NrX2VuZ2luZXMoY3R4KTsKLQkJCQkJ
Z290byBvdXRfdW5sb2NrOworCQkJCQlnb3RvIG91dF9maWxlOwogCQkJCX0KIAogCQkJCWlmIChw
cmFuZG9tX3UzMl9zdGF0ZSgmcHJuZykgJiAxKQpAQCAtMTM4NCwxNSArMTM2OCwxNyBAQCBzdGF0
aWMgaW50IGlndF9jdHhfcmVhZG9ubHkodm9pZCAqYXJnKQogCQkJaWYgKGVycikgewogCQkJCXBy
X2VycigiRmFpbGVkIHRvIGZpbGwgZHdvcmQgJWx1IFslbHUvJWx1XSB3aXRoIGdwdSAoJXMpIFtm
dWxsLXBwZ3R0PyAlc10sIGVycj0lZFxuIiwKIAkJCQkgICAgICAgbmR3b3JkcywgZHcsIG1heF9k
d29yZHMob2JqKSwKLQkJCQkgICAgICAgY2UtPmVuZ2luZS0+bmFtZSwgeWVzbm8oISFjdHgtPnZt
KSwgZXJyKTsKKwkJCQkgICAgICAgY2UtPmVuZ2luZS0+bmFtZSwKKwkJCQkgICAgICAgeWVzbm8o
ISFyY3VfYWNjZXNzX3BvaW50ZXIoY3R4LT52bSkpLAorCQkJCSAgICAgICBlcnIpOwogCQkJCWk5
MTVfZ2VtX2NvbnRleHRfdW5sb2NrX2VuZ2luZXMoY3R4KTsKLQkJCQlnb3RvIG91dF91bmxvY2s7
CisJCQkJZ290byBvdXRfZmlsZTsKIAkJCX0KIAogCQkJZXJyID0gdGhyb3R0bGUoY2UsIHRxLCBB
UlJBWV9TSVpFKHRxKSk7CiAJCQlpZiAoZXJyKSB7CiAJCQkJaTkxNV9nZW1fY29udGV4dF91bmxv
Y2tfZW5naW5lcyhjdHgpOwotCQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCQlnb3RvIG91dF9maWxl
OwogCQkJfQogCiAJCQlpZiAoKytkdyA9PSBtYXhfZHdvcmRzKG9iaikpIHsKQEAgLTE0MjQsMjAg
KzE0MTAsMTkgQEAgc3RhdGljIGludCBpZ3RfY3R4X3JlYWRvbmx5KHZvaWQgKmFyZykKIAkJZHcg
Kz0gcmVtOwogCX0KIAotb3V0X3VubG9jazoKK291dF9maWxlOgogCXRocm90dGxlX3JlbGVhc2Uo
dHEsIEFSUkFZX1NJWkUodHEpKTsKIAlpZiAoaWd0X2xpdmVfdGVzdF9lbmQoJnQpKQogCQllcnIg
PSAtRUlPOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAltb2Nr
X2ZpbGVfZnJlZShpOTE1LCBmaWxlKTsKIAlyZXR1cm4gZXJyOwogfQogCi1zdGF0aWMgaW50IGNo
ZWNrX3NjcmF0Y2goc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwgdTY0IG9mZnNldCkKK3N0
YXRpYyBpbnQgY2hlY2tfc2NyYXRjaChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwgdTY0
IG9mZnNldCkKIHsKIAlzdHJ1Y3QgZHJtX21tX25vZGUgKm5vZGUgPQotCQlfX2RybV9tbV9pbnRl
cnZhbF9maXJzdCgmY3R4LT52bS0+bW0sCisJCV9fZHJtX21tX2ludGVydmFsX2ZpcnN0KCZ2bS0+
bW0sCiAJCQkJCW9mZnNldCwgb2Zmc2V0ICsgc2l6ZW9mKHUzMikgLSAxKTsKIAlpZiAoIW5vZGUg
fHwgbm9kZS0+c3RhcnQgPiBvZmZzZXQpCiAJCXJldHVybiAwOwpAQCAtMTQ1NSw2ICsxNDQwLDcg
QEAgc3RhdGljIGludCB3cml0ZV90b19zY3JhdGNoKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpj
dHgsCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBjdHgtPmk5MTU7CiAJc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNl
ICp2bTsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsK
IAl1MzIgKmNtZDsKQEAgLTE0ODcsMTcgKzE0NzMsMTggQEAgc3RhdGljIGludCB3cml0ZV90b19z
Y3JhdGNoKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAKIAlpbnRlbF9ndF9jaGlwc2V0
X2ZsdXNoKGVuZ2luZS0+Z3QpOwogCi0Jdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCBjdHgt
PnZtLCBOVUxMKTsKKwl2bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOworCXZt
YSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgdm0sIE5VTEwpOwogCWlmIChJU19FUlIodm1hKSkg
ewogCQllcnIgPSBQVFJfRVJSKHZtYSk7Ci0JCWdvdG8gZXJyOworCQlnb3RvIGVycl92bTsKIAl9
CiAKIAllcnIgPSBpOTE1X3ZtYV9waW4odm1hLCAwLCAwLCBQSU5fVVNFUiB8IFBJTl9PRkZTRVRf
RklYRUQpOwogCWlmIChlcnIpCi0JCWdvdG8gZXJyOworCQlnb3RvIGVycl92bTsKIAotCWVyciA9
IGNoZWNrX3NjcmF0Y2goY3R4LCBvZmZzZXQpOworCWVyciA9IGNoZWNrX3NjcmF0Y2godm0sIG9m
ZnNldCk7CiAJaWYgKGVycikKIAkJZ290byBlcnJfdW5waW47CiAKQEAgLTE1MjMsNiArMTUxMCw3
IEBAIHN0YXRpYyBpbnQgd3JpdGVfdG9fc2NyYXRjaChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAq
Y3R4LAogCiAJaTkxNV9yZXF1ZXN0X2FkZChycSk7CiAKKwlpOTE1X3ZtX3B1dCh2bSk7CiAJcmV0
dXJuIDA7CiAKIHNraXBfcmVxdWVzdDoKQEAgLTE1MzEsNiArMTUxOSw4IEBAIHN0YXRpYyBpbnQg
d3JpdGVfdG9fc2NyYXRjaChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogCWk5MTVfcmVx
dWVzdF9hZGQocnEpOwogZXJyX3VucGluOgogCWk5MTVfdm1hX3VucGluKHZtYSk7CitlcnJfdm06
CisJaTkxNV92bV9wdXQodm0pOwogZXJyOgogCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKIAly
ZXR1cm4gZXJyOwpAQCAtMTU0Miw2ICsxNTMyLDcgQEAgc3RhdGljIGludCByZWFkX2Zyb21fc2Ny
YXRjaChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogewogCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gY3R4LT5pOTE1OwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
Ymo7CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CiAJY29uc3QgdTMyIFJDU19HUFIw
ID0gMHgyNjAwOyAvKiBub3QgYWxsIGVuZ2luZXMgaGF2ZSB0aGVpciBvd24gR1BSISAqLwogCWNv
bnN0IHUzMiByZXN1bHQgPSAweDEwMDsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKQEAgLTE1
ODYsMTcgKzE1NzcsMTggQEAgc3RhdGljIGludCByZWFkX2Zyb21fc2NyYXRjaChzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dCAqY3R4LAogCiAJaW50ZWxfZ3RfY2hpcHNldF9mbHVzaChlbmdpbmUtPmd0
KTsKIAotCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgY3R4LT52bSwgTlVMTCk7CisJdm0g
PSBpOTE1X2dlbV9jb250ZXh0X2dldF92bV9yY3UoY3R4KTsKKwl2bWEgPSBpOTE1X3ZtYV9pbnN0
YW5jZShvYmosIHZtLCBOVUxMKTsKIAlpZiAoSVNfRVJSKHZtYSkpIHsKIAkJZXJyID0gUFRSX0VS
Uih2bWEpOwotCQlnb3RvIGVycjsKKwkJZ290byBlcnJfdm07CiAJfQogCiAJZXJyID0gaTkxNV92
bWFfcGluKHZtYSwgMCwgMCwgUElOX1VTRVIgfCBQSU5fT0ZGU0VUX0ZJWEVEKTsKIAlpZiAoZXJy
KQotCQlnb3RvIGVycjsKKwkJZ290byBlcnJfdm07CiAKLQllcnIgPSBjaGVja19zY3JhdGNoKGN0
eCwgb2Zmc2V0KTsKKwllcnIgPSBjaGVja19zY3JhdGNoKHZtLCBvZmZzZXQpOwogCWlmIChlcnIp
CiAJCWdvdG8gZXJyX3VucGluOwogCkBAIC0xNjI3LDEyICsxNjE5LDEyIEBAIHN0YXRpYyBpbnQg
cmVhZF9mcm9tX3NjcmF0Y2goc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAllcnIgPSBp
OTE1X2dlbV9vYmplY3Rfc2V0X3RvX2NwdV9kb21haW4ob2JqLCBmYWxzZSk7CiAJaTkxNV9nZW1f
b2JqZWN0X3VubG9jayhvYmopOwogCWlmIChlcnIpCi0JCWdvdG8gZXJyOworCQlnb3RvIGVycl92
bTsKIAogCWNtZCA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKG9iaiwgSTkxNV9NQVBfV0IpOwog
CWlmIChJU19FUlIoY21kKSkgewogCQllcnIgPSBQVFJfRVJSKGNtZCk7Ci0JCWdvdG8gZXJyOwor
CQlnb3RvIGVycl92bTsKIAl9CiAKIAkqdmFsdWUgPSBjbWRbcmVzdWx0IC8gc2l6ZW9mKCpjbWQp
XTsKQEAgLTE2NDcsNiArMTYzOSw4IEBAIHN0YXRpYyBpbnQgcmVhZF9mcm9tX3NjcmF0Y2goc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKIGVycl91
bnBpbjoKIAlpOTE1X3ZtYV91bnBpbih2bWEpOworZXJyX3ZtOgorCWk5MTVfdm1fcHV0KHZtKTsK
IGVycjoKIAlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CiAJcmV0dXJuIGVycjsKQEAgLTE2Nzcs
MjcgKzE2NzEsMjUgQEAgc3RhdGljIGludCBpZ3Rfdm1faXNvbGF0aW9uKHZvaWQgKmFyZykKIAlp
ZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKIAotCW11dGV4X2xvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJZXJyID0gaWd0X2xpdmVfdGVzdF9iZWdpbigm
dCwgaTkxNSwgX19mdW5jX18sICIiKTsKIAlpZiAoZXJyKQotCQlnb3RvIG91dF91bmxvY2s7CisJ
CWdvdG8gb3V0X2ZpbGU7CiAKIAljdHhfYSA9IGxpdmVfY29udGV4dChpOTE1LCBmaWxlKTsKIAlp
ZiAoSVNfRVJSKGN0eF9hKSkgewogCQllcnIgPSBQVFJfRVJSKGN0eF9hKTsKLQkJZ290byBvdXRf
dW5sb2NrOworCQlnb3RvIG91dF9maWxlOwogCX0KIAogCWN0eF9iID0gbGl2ZV9jb250ZXh0KGk5
MTUsIGZpbGUpOwogCWlmIChJU19FUlIoY3R4X2IpKSB7CiAJCWVyciA9IFBUUl9FUlIoY3R4X2Ip
OwotCQlnb3RvIG91dF91bmxvY2s7CisJCWdvdG8gb3V0X2ZpbGU7CiAJfQogCiAJLyogV2UgY2Fu
IG9ubHkgdGVzdCB2bSBpc29sYXRpb24sIGlmIHRoZSB2bSBhcmUgZGlzdGluY3QgKi8KIAlpZiAo
Y3R4X2EtPnZtID09IGN0eF9iLT52bSkKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3RvIG91dF9m
aWxlOwogCiAJdm1fdG90YWwgPSBjdHhfYS0+dm0tPnRvdGFsOwogCUdFTV9CVUdfT04oY3R4X2It
PnZtLT50b3RhbCAhPSB2bV90b3RhbCk7CkBAIC0xNzI2LDcgKzE3MTgsNyBAQCBzdGF0aWMgaW50
IGlndF92bV9pc29sYXRpb24odm9pZCAqYXJnKQogCQkJCWVyciA9IHJlYWRfZnJvbV9zY3JhdGNo
KGN0eF9iLCBlbmdpbmUsCiAJCQkJCQkJb2Zmc2V0LCAmdmFsdWUpOwogCQkJaWYgKGVycikKLQkJ
CQlnb3RvIG91dF91bmxvY2s7CisJCQkJZ290byBvdXRfZmlsZTsKIAogCQkJaWYgKHZhbHVlKSB7
CiAJCQkJcHJfZXJyKCIlczogUmVhZCAlMDh4IGZyb20gc2NyYXRjaCAob2Zmc2V0IDB4JTA4eF8l
MDh4KSwgYWZ0ZXIgJWx1IHJlYWRzIVxuIiwKQEAgLTE3MzUsNyArMTcyNyw3IEBAIHN0YXRpYyBp
bnQgaWd0X3ZtX2lzb2xhdGlvbih2b2lkICphcmcpCiAJCQkJICAgICAgIGxvd2VyXzMyX2JpdHMo
b2Zmc2V0KSwKIAkJCQkgICAgICAgdGhpcyk7CiAJCQkJZXJyID0gLUVJTlZBTDsKLQkJCQlnb3Rv
IG91dF91bmxvY2s7CisJCQkJZ290byBvdXRfZmlsZTsKIAkJCX0KIAogCQkJdGhpcysrOwpAQCAt
MTc0NSwxMSArMTczNyw5IEBAIHN0YXRpYyBpbnQgaWd0X3ZtX2lzb2xhdGlvbih2b2lkICphcmcp
CiAJcHJfaW5mbygiQ2hlY2tlZCAlbHUgc2NyYXRjaCBvZmZzZXRzIGFjcm9zcyAlZCBlbmdpbmVz
XG4iLAogCQljb3VudCwgUlVOVElNRV9JTkZPKGk5MTUpLT5udW1fZW5naW5lcyk7CiAKLW91dF91
bmxvY2s6CitvdXRfZmlsZToKIAlpZiAoaWd0X2xpdmVfdGVzdF9lbmQoJnQpKQogCQllcnIgPSAt
RUlPOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAltb2NrX2Zp
bGVfZnJlZShpOTE1LCBmaWxlKTsKIAlyZXR1cm4gZXJyOwogfQpAQCAtMTc4MSwxMyArMTc3MSw5
IEBAIHN0YXRpYyBpbnQgbW9ja19jb250ZXh0X2JhcnJpZXIodm9pZCAqYXJnKQogCSAqIGEgcmVx
dWVzdDsgdXNlZnVsIGZvciByZXRpcmluZyBvbGQgc3RhdGUgYWZ0ZXIgbG9hZGluZyBuZXcuCiAJ
ICovCiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWN0eCA9IG1v
Y2tfY29udGV4dChpOTE1LCAibW9jayIpOwotCWlmICghY3R4KSB7Ci0JCWVyciA9IC1FTk9NRU07
Ci0JCWdvdG8gdW5sb2NrOwotCX0KKwlpZiAoIWN0eCkKKwkJcmV0dXJuIC1FTk9NRU07CiAKIAlj
b3VudGVyID0gMDsKIAllcnIgPSBjb250ZXh0X2JhcnJpZXJfdGFzayhjdHgsIDAsCkBAIC0xODYw
LDggKzE4NDYsNiBAQCBzdGF0aWMgaW50IG1vY2tfY29udGV4dF9iYXJyaWVyKHZvaWQgKmFyZykK
IAogb3V0OgogCW1vY2tfY29udGV4dF9jbG9zZShjdHgpOwotdW5sb2NrOgotCW11dGV4X3VubG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKICN1bmRlZiBwcl9mbXQK
ICNkZWZpbmUgcHJfZm10KHgpIHgKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9zZWxmdGVzdHMvbW9ja19jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL21vY2tfY29udGV4dC5jCmluZGV4IDAxMDRmMTZiMTMyNy4uZmQ3OTlkZWZkOGJlIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL21vY2tfY29udGV4
dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvbW9ja19jb250ZXh0
LmMKQEAgLTY1LDcgKzY1LDcgQEAgdm9pZCBtb2NrX2NvbnRleHRfY2xvc2Uoc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHQgKmN0eCkKIAogdm9pZCBtb2NrX2luaXRfY29udGV4dHMoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JaW5pdF9jb250ZXh0cyhpOTE1KTsKKwlpbml0X2NvbnRl
eHRzKCZpOTE1LT5nZW0uY29udGV4dHMpOwogfQogCiBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAq
CkBAIC03NCw4ICs3NCw2IEBAIGxpdmVfY29udGV4dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwgc3RydWN0IGRybV9maWxlICpmaWxlKQogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpj
dHg7CiAJaW50IGVycjsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwotCiAJY3R4ID0gaTkxNV9nZW1fY3JlYXRlX2NvbnRleHQoaTkxNSwgMCk7CiAJaWYg
KElTX0VSUihjdHgpKQogCQlyZXR1cm4gY3R4OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
Y29udGV4dC5jCmluZGV4IDM1YTQwYzI4MjBhMi4uYmUzNGQ5N2FjMThmIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCkBAIC0yMjEsMTIgKzIyMSwyMCBAQCBpbnRlbF9j
b250ZXh0X2luaXQoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCQkgICBzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqY3R4LAogCQkgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7
CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CisKIAlHRU1fQlVHX09OKCFlbmdpbmUt
PmNvcHMpOwogCiAJa3JlZl9pbml0KCZjZS0+cmVmKTsKIAogCWNlLT5nZW1fY29udGV4dCA9IGN0
eDsKLQljZS0+dm0gPSBpOTE1X3ZtX2dldChjdHgtPnZtID86ICZlbmdpbmUtPmd0LT5nZ3R0LT52
bSk7CisJcmN1X3JlYWRfbG9jaygpOworCXZtID0gcmN1X2RlcmVmZXJlbmNlKGN0eC0+dm0pOwor
CWlmICh2bSkKKwkJY2UtPnZtID0gaTkxNV92bV9nZXQodm0pOworCWVsc2UKKwkJY2UtPnZtID0g
aTkxNV92bV9nZXQoJmVuZ2luZS0+Z3QtPmdndHQtPnZtKTsKKwlyY3VfcmVhZF91bmxvY2soKTsK
IAlpZiAoY3R4LT50aW1lbGluZSkKIAkJY2UtPnRpbWVsaW5lID0gaW50ZWxfdGltZWxpbmVfZ2V0
KGN0eC0+dGltZWxpbmUpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCmluZGV4IDQ2
ODQzOGZiNDdhZi4uNDcxYzIzZDBjZmZiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMu
YwpAQCAtOTgxLDYgKzk4MSwxMSBAQCBfX2V4ZWNsaXN0c19zY2hlZHVsZV9pbihzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpycSkKIAkJY2UtPmxyY19kZXNjIHw9CiAJCQkodTY0KShlbmdpbmUtPmNvbnRl
eHRfdGFnKysgJSBOVU1fQ09OVEVYVF9UQUcpIDw8CiAJCQlHRU4xMV9TV19DVFhfSURfU0hJRlQ7
CisKKyNkZWZpbmUgR0VOMTFfTUFYX0NPTlRFWFRfSFdfSUQgKDE8PDExKSAvKiBleGNsdXNpdmUg
Ki8KKy8qIGluIEdlbjEyIElEIDB4N0ZGIGlzIHJlc2VydmVkIHRvIGluZGljYXRlIGlkbGUgKi8K
KyNkZWZpbmUgR0VOMTJfTUFYX0NPTlRFWFRfSFdfSUQgICAgICAgIChHRU4xMV9NQVhfQ09OVEVY
VF9IV19JRCAtIDEpCisKIAkJQlVJTERfQlVHX09OKE5VTV9DT05URVhUX1RBRyA+IEdFTjEyX01B
WF9DT05URVhUX0hXX0lEKTsKIAl9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0
X2NvbnRleHQuYwppbmRleCA4NmNmZmJiMGE5Y2IuLjdjODM4YTU3ZTE3NCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYwpAQCAtMTU1LDEzICsxNTUsOSBAQCBz
dGF0aWMgaW50IGxpdmVfY29udGV4dF9zaXplKHZvaWQgKmFyZykKIAkgKiBIVyB0cmllcyB0byB3
cml0ZSBwYXN0IHRoZSBlbmQgb2Ygb25lLgogCSAqLwogCi0JbXV0ZXhfbG9jaygmZ3QtPmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJZml4bWUgPSBrZXJuZWxfY29udGV4dChndC0+aTkxNSk7
Ci0JaWYgKElTX0VSUihmaXhtZSkpIHsKLQkJZXJyID0gUFRSX0VSUihmaXhtZSk7Ci0JCWdvdG8g
dW5sb2NrOwotCX0KKwlpZiAoSVNfRVJSKGZpeG1lKSkKKwkJcmV0dXJuIFBUUl9FUlIoZml4bWUp
OwogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5MTUsIGlkKSB7CiAJCXN0cnVjdCB7
CkBAIC0yMDEsOCArMTk3LDYgQEAgc3RhdGljIGludCBsaXZlX2NvbnRleHRfc2l6ZSh2b2lkICph
cmcpCiAJfQogCiAJa2VybmVsX2NvbnRleHRfY2xvc2UoZml4bWUpOwotdW5sb2NrOgotCW11dGV4
X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CiB9CiAK
QEAgLTMwNSwxMiArMjk5LDEwIEBAIHN0YXRpYyBpbnQgbGl2ZV9hY3RpdmVfY29udGV4dCh2b2lk
ICphcmcpCiAJaWYgKElTX0VSUihmaWxlKSkKIAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAKLQlt
dXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlmaXhtZSA9IGxpdmVf
Y29udGV4dChndC0+aTkxNSwgZmlsZSk7CiAJaWYgKElTX0VSUihmaXhtZSkpIHsKIAkJZXJyID0g
UFRSX0VSUihmaXhtZSk7Ci0JCWdvdG8gdW5sb2NrOworCQlnb3RvIG91dF9maWxlOwogCX0KIAog
CWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LT5pOTE1LCBpZCkgewpAQCAtMzIzLDggKzMxNSw3
IEBAIHN0YXRpYyBpbnQgbGl2ZV9hY3RpdmVfY29udGV4dCh2b2lkICphcmcpCiAJCQlicmVhazsK
IAl9CiAKLXVubG9jazoKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKK291dF9maWxlOgogCW1vY2tfZmlsZV9mcmVlKGd0LT5pOTE1LCBmaWxlKTsKIAlyZXR1cm4g
ZXJyOwogfQpAQCAtNDE4LDEyICs0MDksMTAgQEAgc3RhdGljIGludCBsaXZlX3JlbW90ZV9jb250
ZXh0KHZvaWQgKmFyZykKIAlpZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRSX0VSUihmaWxl
KTsKIAotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWZpeG1l
ID0gbGl2ZV9jb250ZXh0KGd0LT5pOTE1LCBmaWxlKTsKIAlpZiAoSVNfRVJSKGZpeG1lKSkgewog
CQllcnIgPSBQVFJfRVJSKGZpeG1lKTsKLQkJZ290byB1bmxvY2s7CisJCWdvdG8gb3V0X2ZpbGU7
CiAJfQogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5MTUsIGlkKSB7CkBAIC00MzYs
OCArNDI1LDcgQEAgc3RhdGljIGludCBsaXZlX3JlbW90ZV9jb250ZXh0KHZvaWQgKmFyZykKIAkJ
CWJyZWFrOwogCX0KIAotdW5sb2NrOgotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOworb3V0X2ZpbGU6CiAJbW9ja19maWxlX2ZyZWUoZ3QtPmk5MTUsIGZpbGUpOwog
CXJldHVybiBlcnI7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF9oYW5nY2hlY2suYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdj
aGVjay5jCmluZGV4IGZmYmIzZDIzYjg4Ny4uZThhNDBkZjc5YmQwIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYwpAQCAtNTgsOSArNTgsNyBAQCBzdGF0
aWMgaW50IGhhbmdfaW5pdChzdHJ1Y3QgaGFuZyAqaCwgc3RydWN0IGludGVsX2d0ICpndCkKIAlt
ZW1zZXQoaCwgMCwgc2l6ZW9mKCpoKSk7CiAJaC0+Z3QgPSBndDsKIAotCW11dGV4X2xvY2soJmd0
LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAloLT5jdHggPSBrZXJuZWxfY29udGV4dChndC0+
aTkxNSk7Ci0JbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYg
KElTX0VSUihoLT5jdHgpKQogCQlyZXR1cm4gUFRSX0VSUihoLT5jdHgpOwogCkBAIC0xMzMsNyAr
MTMxLDcgQEAgc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3QgKgogaGFuZ19jcmVhdGVfcmVxdWVz
dChzdHJ1Y3QgaGFuZyAqaCwgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewogCXN0
cnVjdCBpbnRlbF9ndCAqZ3QgPSBoLT5ndDsKLQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2
bSA9IGgtPmN0eC0+dm0gPzogJmVuZ2luZS0+Z3QtPmdndHQtPnZtOworCXN0cnVjdCBpOTE1X2Fk
ZHJlc3Nfc3BhY2UgKnZtID0gaTkxNV9nZW1fY29udGV4dF9nZXRfdm1fcmN1KGgtPmN0eCk7CiAJ
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
cSA9IE5VTEw7CiAJc3RydWN0IGk5MTVfdm1hICpod3MsICp2bWE7CkBAIC0xNDMsMTIgKzE0MSwx
NSBAQCBoYW5nX2NyZWF0ZV9yZXF1ZXN0KHN0cnVjdCBoYW5nICpoLCBzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmUpCiAJaW50IGVycjsKIAogCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVh
dGVfaW50ZXJuYWwoZ3QtPmk5MTUsIFBBR0VfU0laRSk7Ci0JaWYgKElTX0VSUihvYmopKQorCWlm
IChJU19FUlIob2JqKSkgeworCQlpOTE1X3ZtX3B1dCh2bSk7CiAJCXJldHVybiBFUlJfQ0FTVChv
YmopOworCX0KIAogCXZhZGRyID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAob2JqLCBpOTE1X2Nv
aGVyZW50X21hcF90eXBlKGd0LT5pOTE1KSk7CiAJaWYgKElTX0VSUih2YWRkcikpIHsKIAkJaTkx
NV9nZW1fb2JqZWN0X3B1dChvYmopOworCQlpOTE1X3ZtX3B1dCh2bSk7CiAJCXJldHVybiBFUlJf
Q0FTVCh2YWRkcik7CiAJfQogCkBAIC0xNTksMTYgKzE2MCwyMiBAQCBoYW5nX2NyZWF0ZV9yZXF1
ZXN0KHN0cnVjdCBoYW5nICpoLCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJaC0+
YmF0Y2ggPSB2YWRkcjsKIAogCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKGgtPm9iaiwgdm0sIE5V
TEwpOwotCWlmIChJU19FUlIodm1hKSkKKwlpZiAoSVNfRVJSKHZtYSkpIHsKKwkJaTkxNV92bV9w
dXQodm0pOwogCQlyZXR1cm4gRVJSX0NBU1Qodm1hKTsKKwl9CiAKIAlod3MgPSBpOTE1X3ZtYV9p
bnN0YW5jZShoLT5od3MsIHZtLCBOVUxMKTsKLQlpZiAoSVNfRVJSKGh3cykpCisJaWYgKElTX0VS
Uihod3MpKSB7CisJCWk5MTVfdm1fcHV0KHZtKTsKIAkJcmV0dXJuIEVSUl9DQVNUKGh3cyk7CisJ
fQogCiAJZXJyID0gaTkxNV92bWFfcGluKHZtYSwgMCwgMCwgUElOX1VTRVIpOwotCWlmIChlcnIp
CisJaWYgKGVycikgeworCQlpOTE1X3ZtX3B1dCh2bSk7CiAJCXJldHVybiBFUlJfUFRSKGVycik7
CisJfQogCiAJZXJyID0gaTkxNV92bWFfcGluKGh3cywgMCwgMCwgUElOX1VTRVIpOwogCWlmIChl
cnIpCkBAIC0yNjYsNiArMjczLDcgQEAgaGFuZ19jcmVhdGVfcmVxdWVzdChzdHJ1Y3QgaGFuZyAq
aCwgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCWk5MTVfdm1hX3VucGluKGh3cyk7
CiB1bnBpbl92bWE6CiAJaTkxNV92bWFfdW5waW4odm1hKTsKKwlpOTE1X3ZtX3B1dCh2bSk7CiAJ
cmV0dXJuIGVyciA/IEVSUl9QVFIoZXJyKSA6IHJxOwogfQogCkBAIC0zODIsOSArMzkwLDcgQEAg
c3RhdGljIGludCBpZ3RfcmVzZXRfbm9wKHZvaWQgKmFyZykKIAlpZiAoSVNfRVJSKGZpbGUpKQog
CQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKIAotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKIAljdHggPSBsaXZlX2NvbnRleHQoZ3QtPmk5MTUsIGZpbGUpOwotCW11dGV4
X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChJU19FUlIoY3R4KSkg
ewogCQllcnIgPSBQVFJfRVJSKGN0eCk7CiAJCWdvdG8gb3V0OwpAQCAtNDU4LDkgKzQ2NCw3IEBA
IHN0YXRpYyBpbnQgaWd0X3Jlc2V0X25vcF9lbmdpbmUodm9pZCAqYXJnKQogCWlmIChJU19FUlIo
ZmlsZSkpCiAJCXJldHVybiBQVFJfRVJSKGZpbGUpOwogCi0JbXV0ZXhfbG9jaygmZ3QtPmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWN0eCA9IGxpdmVfY29udGV4dChndC0+aTkxNSwgZmlsZSk7
Ci0JbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKElTX0VS
UihjdHgpKSB7CiAJCWVyciA9IFBUUl9FUlIoY3R4KTsKIAkJZ290byBvdXQ7CkBAIC03MDUsOSAr
NzA5LDcgQEAgc3RhdGljIGludCBhY3RpdmVfZW5naW5lKHZvaWQgKmRhdGEpCiAJCXJldHVybiBQ
VFJfRVJSKGZpbGUpOwogCiAJZm9yIChjb3VudCA9IDA7IGNvdW50IDwgQVJSQVlfU0laRShjdHgp
OyBjb3VudCsrKSB7Ci0JCW11dGV4X2xvY2soJmVuZ2luZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAJCWN0eFtjb3VudF0gPSBsaXZlX2NvbnRleHQoZW5naW5lLT5pOTE1LCBmaWxlKTsKLQkJ
bXV0ZXhfdW5sb2NrKCZlbmdpbmUtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQlpZiAoSVNf
RVJSKGN0eFtjb3VudF0pKSB7CiAJCQllcnIgPSBQVFJfRVJSKGN0eFtjb3VudF0pOwogCQkJd2hp
bGUgKC0tY291bnQpCkBAIC0xMjkxLDYgKzEyOTMsNyBAQCBzdGF0aWMgaW50IGlndF9yZXNldF9l
dmljdF9wcGd0dCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKIAlz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ug
KnZtOwogCXN0cnVjdCBkcm1fZmlsZSAqZmlsZTsKIAlpbnQgZXJyOwogCkBAIC0xMjk4LDE4ICsx
MzAxLDIwIEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X2V2aWN0X3BwZ3R0KHZvaWQgKmFyZykKIAlp
ZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKIAotCW11dGV4X2xvY2so
Jmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAljdHggPSBsaXZlX2NvbnRleHQoZ3QtPmk5
MTUsIGZpbGUpOwotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
CWlmIChJU19FUlIoY3R4KSkgewogCQllcnIgPSBQVFJfRVJSKGN0eCk7CiAJCWdvdG8gb3V0Owog
CX0KIAogCWVyciA9IDA7Ci0JaWYgKGN0eC0+dm0pIC8qIGFsaWFzaW5nID09IGdsb2JhbCBndHQg
bG9ja2luZywgY292ZXJlZCBhYm92ZSAqLwotCQllcnIgPSBfX2lndF9yZXNldF9ldmljdF92bWEo
Z3QsIGN0eC0+dm0sCisJdm0gPSBpOTE1X2dlbV9jb250ZXh0X2dldF92bV9yY3UoY3R4KTsKKwlp
ZiAoIWk5MTVfaXNfZ2d0dCh2bSkpIHsKKwkJLyogYWxpYXNpbmcgPT0gZ2xvYmFsIGd0dCBsb2Nr
aW5nLCBjb3ZlcmVkIGFib3ZlICovCisJCWVyciA9IF9faWd0X3Jlc2V0X2V2aWN0X3ZtYShndCwg
dm0sCiAJCQkJCSAgICBldmljdF92bWEsIEVYRUNfT0JKRUNUX1dSSVRFKTsKKwl9CisJaTkxNV92
bV9wdXQodm0pOwogCiBvdXQ6CiAJbW9ja19maWxlX2ZyZWUoZ3QtPmk5MTUsIGZpbGUpOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwppbmRleCAwNGMxY2Y1NzM2NDIuLjhkYzQy
YzVjNzU2OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJj
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKQEAgLTE2MzEs
NyArMTYzMSwxMSBAQCBzdGF0aWMgaW50IHNtb2tlX3N1Ym1pdChzdHJ1Y3QgcHJlZW1wdF9zbW9r
ZSAqc21va2UsCiAJaW50IGVyciA9IDA7CiAKIAlpZiAoYmF0Y2gpIHsKLQkJdm1hID0gaTkxNV92
bWFfaW5zdGFuY2UoYmF0Y2gsIGN0eC0+dm0sIE5VTEwpOworCQlzdHJ1Y3QgaTkxNV9hZGRyZXNz
X3NwYWNlICp2bTsKKworCQl2bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOwor
CQl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShiYXRjaCwgdm0sIE5VTEwpOworCQlpOTE1X3ZtX3B1
dCh2bSk7CiAJCWlmIChJU19FUlIodm1hKSkKIAkJCXJldHVybiBQVFJfRVJSKHZtYSk7CiAKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jCmluZGV4IDRl
ZTJlMmJhYmQwZC4uN2M3YWNlYjg1YTc0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMKQEAgLTI2MCw3ICsyNjAsNiBAQCBzd2l0Y2hfdG9fc2Ny
YXRjaF9jb250ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAkJcnEgPSBpZ3Rf
c3Bpbm5lcl9jcmVhdGVfcmVxdWVzdChzcGluLCBjZSwgTUlfTk9PUCk7CiAKIAlpbnRlbF9jb250
ZXh0X3B1dChjZSk7Ci0Ja2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKIAogCWlmIChJU19FUlIo
cnEpKSB7CiAJCXNwaW4gPSBOVUxMOwpAQCAtMjc5LDYgKzI3OCw3IEBAIHN3aXRjaF90b19zY3Jh
dGNoX2NvbnRleHQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCWlmIChlcnIgJiYg
c3BpbikKIAkJaWd0X3NwaW5uZXJfZW5kKHNwaW4pOwogCisJa2VybmVsX2NvbnRleHRfY2xvc2Uo
Y3R4KTsKIAlyZXR1cm4gZXJyOwogfQogCkBAIC0zNTUsNiArMzU1LDcgQEAgc3RhdGljIGludCBj
aGVja193aGl0ZWxpc3RfYWNyb3NzX3Jlc2V0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZSwKIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKmNyZWF0ZV9iYXRjaChzdHJ1Y3QgaTkxNV9nZW1f
Y29udGV4dCAqY3R4KQogewogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CisJc3Ry
dWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJaW50
IGVycjsKIApAQCAtMzYyLDcgKzM2Myw5IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKmNyZWF0
ZV9iYXRjaChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQogCWlmIChJU19FUlIob2JqKSkK
IAkJcmV0dXJuIEVSUl9DQVNUKG9iaik7CiAKLQl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmos
IGN0eC0+dm0sIE5VTEwpOworCXZtID0gaTkxNV9nZW1fY29udGV4dF9nZXRfdm1fcmN1KGN0eCk7
CisJdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCB2bSwgTlVMTCk7CisJaTkxNV92bV9wdXQo
dm0pOwogCWlmIChJU19FUlIodm1hKSkgewogCQllcnIgPSBQVFJfRVJSKHZtYSk7CiAJCWdvdG8g
ZXJyX29iajsKQEAgLTQ2MywxMiArNDY2LDE1IEBAIHN0YXRpYyBpbnQgY2hlY2tfZGlydHlfd2hp
dGVsaXN0KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCTB4ZmZmZjAwZmYsCiAJCTB4
ZmZmZmZmZmYsCiAJfTsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKIAlzdHJ1Y3Qg
aTkxNV92bWEgKnNjcmF0Y2g7CiAJc3RydWN0IGk5MTVfdm1hICpiYXRjaDsKIAlpbnQgZXJyID0g
MCwgaSwgdjsKIAl1MzIgKmNzLCAqcmVzdWx0czsKIAotCXNjcmF0Y2ggPSBjcmVhdGVfc2NyYXRj
aChjdHgtPnZtLCAyICogQVJSQVlfU0laRSh2YWx1ZXMpICsgMSk7CisJdm0gPSBpOTE1X2dlbV9j
b250ZXh0X2dldF92bV9yY3UoY3R4KTsKKwlzY3JhdGNoID0gY3JlYXRlX3NjcmF0Y2godm0sIDIg
KiBBUlJBWV9TSVpFKHZhbHVlcykgKyAxKTsKKwlpOTE1X3ZtX3B1dCh2bSk7CiAJaWYgKElTX0VS
UihzY3JhdGNoKSkKIAkJcmV0dXJuIFBUUl9FUlIoc2NyYXRjaCk7CiAKQEAgLTEwMTAsNiArMTAx
Niw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9pc29sYXRlZF93aGl0ZWxpc3Qodm9pZCAqYXJnKQogCQly
ZXR1cm4gMDsKIAogCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGNsaWVudCk7IGkrKykgewor
CQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKIAkJc3RydWN0IGk5MTVfZ2VtX2NvbnRl
eHQgKmM7CiAKIAkJYyA9IGtlcm5lbF9jb250ZXh0KGk5MTUpOwpAQCAtMTAxOCwyMiArMTAyNSwy
NyBAQCBzdGF0aWMgaW50IGxpdmVfaXNvbGF0ZWRfd2hpdGVsaXN0KHZvaWQgKmFyZykKIAkJCWdv
dG8gZXJyOwogCQl9CiAKLQkJY2xpZW50W2ldLnNjcmF0Y2hbMF0gPSBjcmVhdGVfc2NyYXRjaChj
LT52bSwgMTAyNCk7CisJCXZtID0gaTkxNV9nZW1fY29udGV4dF9nZXRfdm1fcmN1KGMpOworCisJ
CWNsaWVudFtpXS5zY3JhdGNoWzBdID0gY3JlYXRlX3NjcmF0Y2godm0sIDEwMjQpOwogCQlpZiAo
SVNfRVJSKGNsaWVudFtpXS5zY3JhdGNoWzBdKSkgewogCQkJZXJyID0gUFRSX0VSUihjbGllbnRb
aV0uc2NyYXRjaFswXSk7CisJCQlpOTE1X3ZtX3B1dCh2bSk7CiAJCQlrZXJuZWxfY29udGV4dF9j
bG9zZShjKTsKIAkJCWdvdG8gZXJyOwogCQl9CiAKLQkJY2xpZW50W2ldLnNjcmF0Y2hbMV0gPSBj
cmVhdGVfc2NyYXRjaChjLT52bSwgMTAyNCk7CisJCWNsaWVudFtpXS5zY3JhdGNoWzFdID0gY3Jl
YXRlX3NjcmF0Y2godm0sIDEwMjQpOwogCQlpZiAoSVNfRVJSKGNsaWVudFtpXS5zY3JhdGNoWzFd
KSkgewogCQkJZXJyID0gUFRSX0VSUihjbGllbnRbaV0uc2NyYXRjaFsxXSk7CiAJCQlpOTE1X3Zt
YV91bnBpbl9hbmRfcmVsZWFzZSgmY2xpZW50W2ldLnNjcmF0Y2hbMF0sIDApOworCQkJaTkxNV92
bV9wdXQodm0pOwogCQkJa2VybmVsX2NvbnRleHRfY2xvc2UoYyk7CiAJCQlnb3RvIGVycjsKIAkJ
fQogCiAJCWNsaWVudFtpXS5jdHggPSBjOworCQlpOTE1X3ZtX3B1dCh2bSk7CiAJfQogCiAJZm9y
X2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hl
ZHVsZXIuYwppbmRleCAwM2Y1NjcwODQ1NDguLjY4NTBmMWY0MDI0MSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d2dC9zY2hlZHVsZXIuYwpAQCAtMzY1LDcgKzM2NSw4IEBAIHN0YXRpYyB2b2lkIHNldF9j
b250ZXh0X3BwZ3R0X2Zyb21fc2hhZG93KHN0cnVjdCBpbnRlbF92Z3B1X3dvcmtsb2FkICp3b3Jr
bG9hZCwKIAkJCQkJICBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQogewogCXN0cnVjdCBp
bnRlbF92Z3B1X21tICptbSA9IHdvcmtsb2FkLT5zaGFkb3dfbW07Ci0Jc3RydWN0IGk5MTVfcHBn
dHQgKnBwZ3R0ID0gaTkxNV92bV90b19wcGd0dChjdHgtPnZtKTsKKwlzdHJ1Y3QgaTkxNV9wcGd0
dCAqcHBndHQgPQorCQlpOTE1X3ZtX3RvX3BwZ3R0KGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3Jj
dShjdHgpKTsKIAlpbnQgaSA9IDA7CiAKIAlpZiAobW0tPnBwZ3R0X21tLnJvb3RfZW50cnlfdHlw
ZSA9PSBHVFRfVFlQRV9QUEdUVF9ST09UX0w0X0VOVFJZKSB7CkBAIC0zNzgsNiArMzc5LDggQEAg
c3RhdGljIHZvaWQgc2V0X2NvbnRleHRfcHBndHRfZnJvbV9zaGFkb3coc3RydWN0IGludGVsX3Zn
cHVfd29ya2xvYWQgKndvcmtsb2FkLAogCQkJcHhfZG1hKHBkKSA9IG1tLT5wcGd0dF9tbS5zaGFk
b3dfcGRwc1tpXTsKIAkJfQogCX0KKworCWk5MTVfdm1fcHV0KCZwcGd0dC0+dm0pOwogfQogCiBz
dGF0aWMgaW50CkBAIC0xMjMwLDIwICsxMjMzLDE4IEBAIGludCBpbnRlbF92Z3B1X3NldHVwX3N1
Ym1pc3Npb24oc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAJc3RydWN0IGludGVsX3ZncHVfc3Vi
bWlzc2lvbiAqcyA9ICZ2Z3B1LT5zdWJtaXNzaW9uOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZTsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OworCXN0cnVjdCBpOTE1X3Bw
Z3R0ICpwcGd0dDsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpOwogCWludCByZXQ7CiAKLQltdXRl
eF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWN0eCA9IGk5MTVfZ2VtX2NvbnRl
eHRfY3JlYXRlX2tlcm5lbChpOTE1LCBJOTE1X1BSSU9SSVRZX01BWCk7Ci0JaWYgKElTX0VSUihj
dHgpKSB7Ci0JCXJldCA9IFBUUl9FUlIoY3R4KTsKLQkJZ290byBvdXRfdW5sb2NrOwotCX0KKwlp
ZiAoSVNfRVJSKGN0eCkpCisJCXJldHVybiBQVFJfRVJSKGN0eCk7CiAKIAlpOTE1X2dlbV9jb250
ZXh0X3NldF9mb3JjZV9zaW5nbGVfc3VibWlzc2lvbihjdHgpOwogCi0JaTkxNV9jb250ZXh0X3Bw
Z3R0X3Jvb3Rfc2F2ZShzLCBpOTE1X3ZtX3RvX3BwZ3R0KGN0eC0+dm0pKTsKKwlwcGd0dCA9IGk5
MTVfdm1fdG9fcHBndHQoaTkxNV9nZW1fY29udGV4dF9nZXRfdm1fcmN1KGN0eCkpOworCWk5MTVf
Y29udGV4dF9wcGd0dF9yb290X3NhdmUocywgcHBndHQpOwogCiAJZm9yX2VhY2hfZW5naW5lKGVu
Z2luZSwgaTkxNSwgaSkgewogCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CkBAIC0xMjg4LDEy
ICsxMjg5LDEyIEBAIGludCBpbnRlbF92Z3B1X3NldHVwX3N1Ym1pc3Npb24oc3RydWN0IGludGVs
X3ZncHUgKnZncHUpCiAJYXRvbWljX3NldCgmcy0+cnVubmluZ193b3JrbG9hZF9udW0sIDApOwog
CWJpdG1hcF96ZXJvKHMtPnRsYl9oYW5kbGVfcGVuZGluZywgSTkxNV9OVU1fRU5HSU5FUyk7CiAK
KwlpOTE1X3ZtX3B1dCgmcHBndHQtPnZtKTsKIAlpOTE1X2dlbV9jb250ZXh0X3B1dChjdHgpOwot
CW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIDA7CiAKIG91
dF9zaGFkb3dfY3R4OgotCWk5MTVfY29udGV4dF9wcGd0dF9yb290X3Jlc3RvcmUocywgaTkxNV92
bV90b19wcGd0dChjdHgtPnZtKSk7CisJaTkxNV9jb250ZXh0X3BwZ3R0X3Jvb3RfcmVzdG9yZShz
LCBwcGd0dCk7CiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaSkgewogCQlpZiAoSVNf
RVJSKHMtPnNoYWRvd1tpXSkpCiAJCQlicmVhazsKQEAgLTEzMDEsOSArMTMwMiw4IEBAIGludCBp
bnRlbF92Z3B1X3NldHVwX3N1Ym1pc3Npb24oc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAJCWlu
dGVsX2NvbnRleHRfdW5waW4ocy0+c2hhZG93W2ldKTsKIAkJaW50ZWxfY29udGV4dF9wdXQocy0+
c2hhZG93W2ldKTsKIAl9CisJaTkxNV92bV9wdXQoJnBwZ3R0LT52bSk7CiAJaTkxNV9nZW1fY29u
dGV4dF9wdXQoY3R4KTsKLW91dF91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKIAlyZXR1cm4gcmV0OwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2RlYnVnZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdm
cy5jCmluZGV4IDBlOTBhYzYwOGUwNy4uYjA0Y2ViYzI2ZWNhIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2RlYnVnZnMuYwpAQCAtMzE2LDEyICszMTYsMTggQEAgc3RhdGljIHZvaWQgcHJpbnRfY29u
dGV4dF9zdGF0cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sCiAJCQkJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpCiB7CiAJc3RydWN0IGZpbGVfc3RhdHMga3N0YXRzID0ge307Ci0Jc3RydWN0IGk5
MTVfZ2VtX2NvbnRleHQgKmN0eDsKKwlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LCAqY247
CiAKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KGN0eCwgJmk5MTUtPmNvbnRleHRzLmxpc3QsIGxpbmsp
IHsKKwlzcGluX2xvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKKwlsaXN0X2Zvcl9lYWNo
X2VudHJ5X3NhZmUoY3R4LCBjbiwgJmk5MTUtPmdlbS5jb250ZXh0cy5saXN0LCBsaW5rKSB7CiAJ
CXN0cnVjdCBpOTE1X2dlbV9lbmdpbmVzX2l0ZXIgaXQ7CiAJCXN0cnVjdCBpbnRlbF9jb250ZXh0
ICpjZTsKIAorCQlpZiAoIWtyZWZfZ2V0X3VubGVzc196ZXJvKCZjdHgtPnJlZikpCisJCQljb250
aW51ZTsKKworCQlzcGluX3VubG9jaygmaTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOworCiAJCWZv
cl9lYWNoX2dlbV9lbmdpbmUoY2UsCiAJCQkJICAgIGk5MTVfZ2VtX2NvbnRleHRfbG9ja19lbmdp
bmVzKGN0eCksIGl0KSB7CiAJCQlpbnRlbF9jb250ZXh0X2xvY2tfcGlubmVkKGNlKTsKQEAgLTMz
OCw3ICszNDQsOSBAQCBzdGF0aWMgdm9pZCBwcmludF9jb250ZXh0X3N0YXRzKHN0cnVjdCBzZXFf
ZmlsZSAqbSwKIAkJaTkxNV9nZW1fY29udGV4dF91bmxvY2tfZW5naW5lcyhjdHgpOwogCiAJCWlm
ICghSVNfRVJSX09SX05VTEwoY3R4LT5maWxlX3ByaXYpKSB7Ci0JCQlzdHJ1Y3QgZmlsZV9zdGF0
cyBzdGF0cyA9IHsgLnZtID0gY3R4LT52bSwgfTsKKwkJCXN0cnVjdCBmaWxlX3N0YXRzIHN0YXRz
ID0geworCQkJCS52bSA9IHJjdV9hY2Nlc3NfcG9pbnRlcihjdHgtPnZtKSwKKwkJCX07CiAJCQlz
dHJ1Y3QgZHJtX2ZpbGUgKmZpbGUgPSBjdHgtPmZpbGVfcHJpdi0+ZmlsZTsKIAkJCXN0cnVjdCB0
YXNrX3N0cnVjdCAqdGFzazsKIAkJCWNoYXIgbmFtZVs4MF07CkBAIC0zNTUsNyArMzYzLDEyIEBA
IHN0YXRpYyB2b2lkIHByaW50X2NvbnRleHRfc3RhdHMoc3RydWN0IHNlcV9maWxlICptLAogCiAJ
CQlwcmludF9maWxlX3N0YXRzKG0sIG5hbWUsIHN0YXRzKTsKIAkJfQorCisJCXNwaW5fbG9jaygm
aTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOworCQlsaXN0X3NhZmVfcmVzZXRfbmV4dChjdHgsIGNu
LCBsaW5rKTsKKwkJaTkxNV9nZW1fY29udGV4dF9wdXQoY3R4KTsKIAl9CisJc3Bpbl91bmxvY2so
Jmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKIAogCXByaW50X2ZpbGVfc3RhdHMobSwgIltrXWNv
bnRleHRzIiwga3N0YXRzKTsKIH0KQEAgLTM2Myw3ICszNzYsNiBAQCBzdGF0aWMgdm9pZCBwcmlu
dF9jb250ZXh0X3N0YXRzKHN0cnVjdCBzZXFfZmlsZSAqbSwKIHN0YXRpYyBpbnQgaTkxNV9nZW1f
b2JqZWN0X2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogewogCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOwotCWludCBy
ZXQ7CiAKIAlzZXFfcHJpbnRmKG0sICIldSBzaHJpbmthYmxlIFsldSBmcmVlXSBvYmplY3RzLCAl
bGx1IGJ5dGVzXG4iLAogCQkgICBpOTE1LT5tbS5zaHJpbmtfY291bnQsCkBAIC0zNzIsMTIgKzM4
NCw3IEBAIHN0YXRpYyBpbnQgaTkxNV9nZW1fb2JqZWN0X2luZm8oc3RydWN0IHNlcV9maWxlICpt
LCB2b2lkICpkYXRhKQogCiAJc2VxX3B1dGMobSwgJ1xuJyk7CiAKLQlyZXQgPSBtdXRleF9sb2Nr
X2ludGVycnVwdGlibGUoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChyZXQpCi0JCXJl
dHVybiByZXQ7Ci0KIAlwcmludF9jb250ZXh0X3N0YXRzKG0sIGk5MTUpOwotCW11dGV4X3VubG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTE1NzksMTkg
KzE1ODYsMTkgQEAgc3RhdGljIHZvaWQgZGVzY3JpYmVfY3R4X3Jpbmcoc3RydWN0IHNlcV9maWxl
ICptLCBzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZykKIAogc3RhdGljIGludCBpOTE1X2NvbnRleHRf
c3RhdHVzKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqdW51c2VkKQogewotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKLQlzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2ID0gJmRldl9wcml2LT5kcm07Ci0Jc3RydWN0IGk5MTVfZ2VtX2Nv
bnRleHQgKmN0eDsKLQlpbnQgcmV0OwotCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxl
KCZkZXYtPnN0cnVjdF9tdXRleCk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKKwlzdHJ1
Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LCAqY247CiAKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KGN0
eCwgJmRldl9wcml2LT5jb250ZXh0cy5saXN0LCBsaW5rKSB7CisJc3Bpbl9sb2NrKCZpOTE1LT5n
ZW0uY29udGV4dHMubG9jayk7CisJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKGN0eCwgY24sICZp
OTE1LT5nZW0uY29udGV4dHMubGlzdCwgbGluaykgewogCQlzdHJ1Y3QgaTkxNV9nZW1fZW5naW5l
c19pdGVyIGl0OwogCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAKKwkJaWYgKCFrcmVmX2dl
dF91bmxlc3NfemVybygmY3R4LT5yZWYpKQorCQkJY29udGludWU7CisKKwkJc3Bpbl91bmxvY2so
Jmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKKwogCQlzZXFfcHV0cyhtLCAiSFcgY29udGV4dCAi
KTsKIAkJaWYgKGN0eC0+cGlkKSB7CiAJCQlzdHJ1Y3QgdGFza19zdHJ1Y3QgKnRhc2s7CkBAIC0x
NjI2LDkgKzE2MzMsMTIgQEAgc3RhdGljIGludCBpOTE1X2NvbnRleHRfc3RhdHVzKHN0cnVjdCBz
ZXFfZmlsZSAqbSwgdm9pZCAqdW51c2VkKQogCQlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19lbmdp
bmVzKGN0eCk7CiAKIAkJc2VxX3B1dGMobSwgJ1xuJyk7Ci0JfQogCi0JbXV0ZXhfdW5sb2NrKCZk
ZXYtPnN0cnVjdF9tdXRleCk7CisJCXNwaW5fbG9jaygmaTkxNS0+Z2VtLmNvbnRleHRzLmxvY2sp
OworCQlsaXN0X3NhZmVfcmVzZXRfbmV4dChjdHgsIGNuLCBsaW5rKTsKKwkJaTkxNV9nZW1fY29u
dGV4dF9wdXQoY3R4KTsKKwl9CisJc3Bpbl91bmxvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2Nr
KTsKIAogCXJldHVybiAwOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kcnYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMKaW5kZXggNTMyM2U0ZmE1
NWQ5Li4wMjRkYTU4MmJhMGYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYwpAQCAtMTY2NSwxMCAr
MTY2NSw4IEBAIHN0YXRpYyB2b2lkIGk5MTVfZHJpdmVyX3Bvc3RjbG9zZShzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2LCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X2Zp
bGVfcHJpdmF0ZSAqZmlsZV9wcml2ID0gZmlsZS0+ZHJpdmVyX3ByaXY7CiAKLQltdXRleF9sb2Nr
KCZkZXYtPnN0cnVjdF9tdXRleCk7CiAJaTkxNV9nZW1fY29udGV4dF9jbG9zZShmaWxlKTsKIAlp
OTE1X2dlbV9yZWxlYXNlKGRldiwgZmlsZSk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9t
dXRleCk7CiAKIAlrZnJlZV9yY3UoZmlsZV9wcml2LCByY3UpOwogCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9k
cnYuaAppbmRleCBjYjYzYjJiZDBjZTguLjM1YjYxMGQ1MjM3OSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2Rydi5oCkBAIC0xNTM2LDI1ICsxNTM2LDYgQEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgewog
CWludCBhdWRpb19wb3dlcl9yZWZjb3VudDsKIAl1MzIgYXVkaW9fZnJlcV9jbnRybDsKIAotCXN0
cnVjdCB7Ci0JCXN0cnVjdCBtdXRleCBtdXRleDsKLQkJc3RydWN0IGxpc3RfaGVhZCBsaXN0Owot
CQlzdHJ1Y3QgbGxpc3RfaGVhZCBmcmVlX2xpc3Q7Ci0JCXN0cnVjdCB3b3JrX3N0cnVjdCBmcmVl
X3dvcms7Ci0KLQkJLyogVGhlIGh3IHdhbnRzIHRvIGhhdmUgYSBzdGFibGUgY29udGV4dCBpZGVu
dGlmaWVyIGZvciB0aGUKLQkJICogbGlmZXRpbWUgb2YgdGhlIGNvbnRleHQgKGZvciBPQSwgUEFT
SUQsIGZhdWx0cywgZXRjKS4KLQkJICogVGhpcyBpcyBsaW1pdGVkIGluIGV4ZWNsaXN0cyB0byAy
MSBiaXRzLgotCQkgKi8KLQkJc3RydWN0IGlkYSBod19pZGE7Ci0jZGVmaW5lIE1BWF9DT05URVhU
X0hXX0lEICgxPDwyMSkgLyogZXhjbHVzaXZlICovCi0jZGVmaW5lIE1BWF9HVUNfQ09OVEVYVF9I
V19JRCAoMSA8PCAyMCkgLyogZXhjbHVzaXZlICovCi0jZGVmaW5lIEdFTjExX01BWF9DT05URVhU
X0hXX0lEICgxPDwxMSkgLyogZXhjbHVzaXZlICovCi0vKiBpbiBHZW4xMiBJRCAweDdGRiBpcyBy
ZXNlcnZlZCB0byBpbmRpY2F0ZSBpZGxlICovCi0jZGVmaW5lIEdFTjEyX01BWF9DT05URVhUX0hX
X0lECShHRU4xMV9NQVhfQ09OVEVYVF9IV19JRCAtIDEpCi0JCXN0cnVjdCBsaXN0X2hlYWQgaHdf
aWRfbGlzdDsKLQl9IGNvbnRleHRzOwotCiAJdTMyIGZkaV9yeF9jb25maWc7CiAKIAkvKiBTaGFk
b3cgZm9yIERJU1BMQVlfUEhZX0NPTlRST0wgd2hpY2ggY2FuJ3QgYmUgc2FmZWx5IHJlYWQgKi8K
QEAgLTE3MTAsNiArMTY5MSwxNCBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSB7CiAKIAlzdHJ1
Y3QgewogCQlzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sgcG1fbm90aWZpZXI7CisKKwkJc3RydWN0IGk5
MTVfZ2VtX2NvbnRleHRzIHsKKwkJCXNwaW5sb2NrX3QgbG9jazsgLyogbG9ja3MgbGlzdCAqLwor
CQkJc3RydWN0IGxpc3RfaGVhZCBsaXN0OworCisJCQlzdHJ1Y3QgbGxpc3RfaGVhZCBmcmVlX2xp
c3Q7CisJCQlzdHJ1Y3Qgd29ya19zdHJ1Y3QgZnJlZV93b3JrOworCQl9IGNvbnRleHRzOwogCX0g
Z2VtOwogCiAJLyogRm9yIGk5NDVnbSB2YmxhbmsgaXJxIHZzLiBDMyB3b3JrYXJvdW5kICovCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9nZW0uYwppbmRleCA1YTY2NGJkZWFkOGMuLmY2ZGI0MTU5ODVkNSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbS5jCkBAIC0xMjY2LDcgKzEyNjYsNyBAQCBpbnQgaTkxNV9nZW1f
aW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCWdvdG8gZXJyX3VubG9j
azsKIAl9CiAKLQlyZXQgPSBpOTE1X2dlbV9jb250ZXh0c19pbml0KGRldl9wcml2KTsKKwlyZXQg
PSBpOTE1X2dlbV9pbml0X2NvbnRleHRzKGRldl9wcml2KTsKIAlpZiAocmV0KSB7CiAJCUdFTV9C
VUdfT04ocmV0ID09IC1FSU8pOwogCQlnb3RvIGVycl9zY3JhdGNoOwpAQCAtMTM0OCw3ICsxMzQ4
LDcgQEAgaW50IGk5MTVfZ2VtX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQogCX0KIGVycl9jb250ZXh0OgogCWlmIChyZXQgIT0gLUVJTykKLQkJaTkxNV9nZW1fY29udGV4
dHNfZmluaShkZXZfcHJpdik7CisJCWk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNlX19jb250ZXh0cyhk
ZXZfcHJpdik7CiBlcnJfc2NyYXRjaDoKIAlpbnRlbF9ndF9kcml2ZXJfcmVsZWFzZSgmZGV2X3By
aXYtPmd0KTsKIGVycl91bmxvY2s6CkBAIC0xNDE2LDExICsxNDE2LDkgQEAgdm9pZCBpOTE1X2dl
bV9kcml2ZXJfcmVtb3ZlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogdm9p
ZCBpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCiB7Ci0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWludGVs
X2VuZ2luZXNfY2xlYW51cChkZXZfcHJpdik7Ci0JaTkxNV9nZW1fY29udGV4dHNfZmluaShkZXZf
cHJpdik7CisJaTkxNV9nZW1fZHJpdmVyX3JlbGVhc2VfX2NvbnRleHRzKGRldl9wcml2KTsKIAlp
bnRlbF9ndF9kcml2ZXJfcmVsZWFzZSgmZGV2X3ByaXYtPmd0KTsKLQltdXRleF91bmxvY2soJmRl
dl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIAogCWludGVsX3dhX2xpc3RfZnJlZSgmZGV2X3By
aXYtPmd0X3dhX2xpc3QpOwogCkBAIC0xNDMwLDcgKzE0MjgsNyBAQCB2b2lkIGk5MTVfZ2VtX2Ry
aXZlcl9yZWxlYXNlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogCWk5MTVf
Z2VtX2RyYWluX2ZyZWVkX29iamVjdHMoZGV2X3ByaXYpOwogCi0JV0FSTl9PTighbGlzdF9lbXB0
eSgmZGV2X3ByaXYtPmNvbnRleHRzLmxpc3QpKTsKKwlXQVJOX09OKCFsaXN0X2VtcHR5KCZkZXZf
cHJpdi0+Z2VtLmNvbnRleHRzLmxpc3QpKTsKIH0KIAogdm9pZCBpOTE1X2dlbV9pbml0X21taW8o
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0
dC5jCmluZGV4IDFkMjY2MzRjYTU5Ny4uN2IxNWJiODkxOTcwIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9ndHQuYwpAQCAtMTM2Niw3ICsxMzY2LDkgQEAgc3RhdGljIGludCBnZW44X2luaXRf
c2NyYXRjaChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIAlpZiAodm0tPmhhc19yZWFk
X29ubHkgJiYKIAkgICAgdm0tPmk5MTUtPmtlcm5lbF9jb250ZXh0ICYmCiAJICAgIHZtLT5pOTE1
LT5rZXJuZWxfY29udGV4dC0+dm0pIHsKLQkJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqY2xv
bmUgPSB2bS0+aTkxNS0+a2VybmVsX2NvbnRleHQtPnZtOworCQlzdHJ1Y3QgaTkxNV9hZGRyZXNz
X3NwYWNlICpjbG9uZSA9CisJCQlyY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKHZtLT5pOTE1LT5r
ZXJuZWxfY29udGV4dC0+dm0sCisJCQkJCQkgIHRydWUpOyAvKiBzdGF0aWMgKi8KIAogCQlHRU1f
QlVHX09OKCFjbG9uZS0+aGFzX3JlYWRfb25seSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcGVyZi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMK
aW5kZXggZWNmYmMzN2I3MzhiLi4yMzEzODhkMDZjODIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcGVyZi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVy
Zi5jCkBAIC0xODUzLDggKzE4NTMsOCBAQCBzdGF0aWMgaW50IGdlbjhfY29uZmlndXJlX2FsbF9j
b250ZXh0cyhzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtLAogCX07CiAjdW5kZWYgY3R4
X2ZsZXhldU4KIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7Ci0Jc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHQgKmN0eDsKLQlpbnQgaTsKKwlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4
LCAqY247CisJaW50IGksIGVycjsKIAogCWZvciAoaSA9IDI7IGkgPCBBUlJBWV9TSVpFKHJlZ3Mp
OyBpKyspCiAJCXJlZ3NbaV0udmFsdWUgPSBvYV9jb25maWdfZmxleF9yZWcob2FfY29uZmlnLCBy
ZWdzW2ldLnJlZyk7CkBAIC0xODc3LDE2ICsxODc3LDI3IEBAIHN0YXRpYyBpbnQgZ2VuOF9jb25m
aWd1cmVfYWxsX2NvbnRleHRzKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJICog
Y29udGV4dC4gQ29udGV4dHMgaWRsZSBhdCB0aGUgdGltZSBvZiByZWNvbmZpZ3VyYXRpb24gYXJl
IG5vdAogCSAqIHRyYXBwZWQgYmVoaW5kIHRoZSBiYXJyaWVyLgogCSAqLwotCWxpc3RfZm9yX2Vh
Y2hfZW50cnkoY3R4LCAmaTkxNS0+Y29udGV4dHMubGlzdCwgbGluaykgewotCQlpbnQgZXJyOwot
CisJc3Bpbl9sb2NrKCZpOTE1LT5nZW0uY29udGV4dHMubG9jayk7CisJbGlzdF9mb3JfZWFjaF9l
bnRyeV9zYWZlKGN0eCwgY24sICZpOTE1LT5nZW0uY29udGV4dHMubGlzdCwgbGluaykgewogCQlp
ZiAoY3R4ID09IGk5MTUtPmtlcm5lbF9jb250ZXh0KQogCQkJY29udGludWU7CiAKKwkJaWYgKCFr
cmVmX2dldF91bmxlc3NfemVybygmY3R4LT5yZWYpKQorCQkJY29udGludWU7CisKKwkJc3Bpbl91
bmxvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKKwogCQllcnIgPSBnZW44X2NvbmZpZ3Vy
ZV9jb250ZXh0KGN0eCwgcmVncywgQVJSQVlfU0laRShyZWdzKSk7Ci0JCWlmIChlcnIpCisJCWlm
IChlcnIpIHsKKwkJCWk5MTVfZ2VtX2NvbnRleHRfcHV0KGN0eCk7CiAJCQlyZXR1cm4gZXJyOwor
CQl9CisKKwkJc3Bpbl9sb2NrKCZpOTE1LT5nZW0uY29udGV4dHMubG9jayk7CisJCWxpc3Rfc2Fm
ZV9yZXNldF9uZXh0KGN0eCwgY24sIGxpbmspOworCQlpOTE1X2dlbV9jb250ZXh0X3B1dChjdHgp
OwogCX0KKwlzcGluX3VubG9jaygmaTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOwogCiAJLyoKIAkg
KiBBZnRlciB1cGRhdGluZyBhbGwgb3RoZXIgY29udGV4dHMsIHdlIG5lZWQgdG8gbW9kaWZ5IG91
cnNlbHZlcy4KQEAgLTE4OTUsNyArMTkwNiw2IEBAIHN0YXRpYyBpbnQgZ2VuOF9jb25maWd1cmVf
YWxsX2NvbnRleHRzKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJICovCiAJZm9y
X2VhY2hfdWFiaV9lbmdpbmUoZW5naW5lLCBpOTE1KSB7CiAJCXN0cnVjdCBpbnRlbF9jb250ZXh0
ICpjZSA9IGVuZ2luZS0+a2VybmVsX2NvbnRleHQ7Ci0JCWludCBlcnI7CiAKIAkJaWYgKGVuZ2lu
ZS0+Y2xhc3MgIT0gUkVOREVSX0NMQVNTKQogCQkJY29udGludWU7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N5c2ZzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3N5c2ZzLmMKaW5kZXggMDM0YjhhYmM1MDYyLi4yYTcyNDA3YTYzODAgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3lzZnMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3N5c2ZzLmMKQEAgLTE0NCw5ICsxNDQsOSBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGF0
dHJpYnV0ZV9ncm91cCBtZWRpYV9yYzZfYXR0cl9ncm91cCA9IHsKIH07CiAjZW5kaWYKIAotc3Rh
dGljIGludCBsM19hY2Nlc3NfdmFsaWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LCBsb2ZmX3Qgb2Zmc2V0KQorc3RhdGljIGludCBsM19hY2Nlc3NfdmFsaWQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsIGxvZmZfdCBvZmZzZXQpCiB7Ci0JaWYgKCFIQVNfTDNfRFBGKGRl
dl9wcml2KSkKKwlpZiAoIUhBU19MM19EUEYoaTkxNSkpCiAJCXJldHVybiAtRVBFUk07CiAKIAlp
ZiAob2Zmc2V0ICUgNCAhPSAwKQpAQCAtMTY0LDMxICsxNjQsMjQgQEAgaTkxNV9sM19yZWFkKHN0
cnVjdCBmaWxlICpmaWxwLCBzdHJ1Y3Qga29iamVjdCAqa29iaiwKIAkgICAgIGxvZmZfdCBvZmZz
ZXQsIHNpemVfdCBjb3VudCkKIHsKIAlzdHJ1Y3QgZGV2aWNlICprZGV2ID0ga29ial90b19kZXYo
a29iaik7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0ga2Rldl9taW5vcl90
b19pOTE1KGtkZXYpOwotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmZGV2X3ByaXYtPmRybTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGtkZXZfbWlub3JfdG9faTkxNShrZGV2
KTsKIAlpbnQgc2xpY2UgPSAoaW50KSh1aW50cHRyX3QpYXR0ci0+cHJpdmF0ZTsKIAlpbnQgcmV0
OwogCi0JY291bnQgPSByb3VuZF9kb3duKGNvdW50LCA0KTsKLQotCXJldCA9IGwzX2FjY2Vzc192
YWxpZChkZXZfcHJpdiwgb2Zmc2V0KTsKKwlyZXQgPSBsM19hY2Nlc3NfdmFsaWQoaTkxNSwgb2Zm
c2V0KTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCisJY291bnQgPSByb3VuZF9kb3duKGNv
dW50LCA0KTsKIAljb3VudCA9IG1pbl90KHNpemVfdCwgR0VON19MM0xPR19TSVpFIC0gb2Zmc2V0
LCBjb3VudCk7CisJbWVtc2V0KGJ1ZiwgMCwgY291bnQpOwogCi0JcmV0ID0gaTkxNV9tdXRleF9s
b2NrX2ludGVycnVwdGlibGUoZGV2KTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCi0JaWYg
KGRldl9wcml2LT5sM19wYXJpdHkucmVtYXBfaW5mb1tzbGljZV0pCisJc3Bpbl9sb2NrKCZpOTE1
LT5nZW0uY29udGV4dHMubG9jayk7CisJaWYgKGk5MTUtPmwzX3Bhcml0eS5yZW1hcF9pbmZvW3Ns
aWNlXSkKIAkJbWVtY3B5KGJ1ZiwKLQkJICAgICAgIGRldl9wcml2LT5sM19wYXJpdHkucmVtYXBf
aW5mb1tzbGljZV0gKyAob2Zmc2V0LzQpLAorCQkgICAgICAgaTkxNS0+bDNfcGFyaXR5LnJlbWFw
X2luZm9bc2xpY2VdICsgb2Zmc2V0IC8gNCwKIAkJICAgICAgIGNvdW50KTsKLQllbHNlCi0JCW1l
bXNldChidWYsIDAsIGNvdW50KTsKLQotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgp
OworCXNwaW5fdW5sb2NrKCZpOTE1LT5nZW0uY29udGV4dHMubG9jayk7CiAKIAlyZXR1cm4gY291
bnQ7CiB9CkBAIC0xOTksNDYgKzE5Miw0NiBAQCBpOTE1X2wzX3dyaXRlKHN0cnVjdCBmaWxlICpm
aWxwLCBzdHJ1Y3Qga29iamVjdCAqa29iaiwKIAkgICAgICBsb2ZmX3Qgb2Zmc2V0LCBzaXplX3Qg
Y291bnQpCiB7CiAJc3RydWN0IGRldmljZSAqa2RldiA9IGtvYmpfdG9fZGV2KGtvYmopOwotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGtkZXZfbWlub3JfdG9faTkxNShrZGV2
KTsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmRldl9wcml2LT5kcm07CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBrZGV2X21pbm9yX3RvX2k5MTUoa2Rldik7CiAJc3RydWN0
IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKIAlpbnQgc2xpY2UgPSAoaW50KSh1aW50cHRyX3QpYXR0
ci0+cHJpdmF0ZTsKLQl1MzIgKipyZW1hcF9pbmZvOworCXUzMiAqcmVtYXBfaW5mbywgKmZyZWVt
ZSA9IE5VTEw7CiAJaW50IHJldDsKIAotCXJldCA9IGwzX2FjY2Vzc192YWxpZChkZXZfcHJpdiwg
b2Zmc2V0KTsKKwlyZXQgPSBsM19hY2Nlc3NfdmFsaWQoaTkxNSwgb2Zmc2V0KTsKIAlpZiAocmV0
KQogCQlyZXR1cm4gcmV0OwogCi0JcmV0ID0gaTkxNV9tdXRleF9sb2NrX2ludGVycnVwdGlibGUo
ZGV2KTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OworCXJlbWFwX2luZm8gPSBremFsbG9jKEdF
TjdfTDNMT0dfU0laRSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFyZW1hcF9pbmZvKQorCQlyZXR1cm4g
LUVOT01FTTsKIAotCXJlbWFwX2luZm8gPSAmZGV2X3ByaXYtPmwzX3Bhcml0eS5yZW1hcF9pbmZv
W3NsaWNlXTsKLQlpZiAoISpyZW1hcF9pbmZvKSB7Ci0JCSpyZW1hcF9pbmZvID0ga3phbGxvYyhH
RU43X0wzTE9HX1NJWkUsIEdGUF9LRVJORUwpOwotCQlpZiAoISpyZW1hcF9pbmZvKSB7Ci0JCQly
ZXQgPSAtRU5PTUVNOwotCQkJZ290byBvdXQ7Ci0JCX0KKwlzcGluX2xvY2soJmk5MTUtPmdlbS5j
b250ZXh0cy5sb2NrKTsKKworCWlmIChpOTE1LT5sM19wYXJpdHkucmVtYXBfaW5mb1tzbGljZV0p
IHsKKwkJZnJlZW1lID0gcmVtYXBfaW5mbzsKKwkJcmVtYXBfaW5mbyA9IGk5MTUtPmwzX3Bhcml0
eS5yZW1hcF9pbmZvW3NsaWNlXTsKKwl9IGVsc2UgeworCQlpOTE1LT5sM19wYXJpdHkucmVtYXBf
aW5mb1tzbGljZV0gPSByZW1hcF9pbmZvOwogCX0KIAotCS8qIFRPRE86IElkZWFsbHkgd2UgcmVh
bGx5IHdhbnQgYSBHUFUgcmVzZXQgaGVyZSB0byBtYWtlIHN1cmUgZXJyb3JzCi0JICogYXJlbid0
IHByb3BhZ2F0ZWQuIFNpbmNlIEkgY2Fubm90IGZpbmQgYSBzdGFibGUgd2F5IHRvIHJlc2V0IHRo
ZSBHUFUKLQkgKiBhdCB0aGlzIHBvaW50IGl0IGlzIGxlZnQgYXMgYSBUT0RPLgotCSovCi0JbWVt
Y3B5KCpyZW1hcF9pbmZvICsgKG9mZnNldC80KSwgYnVmLCBjb3VudCk7CisJY291bnQgPSByb3Vu
ZF9kb3duKGNvdW50LCA0KTsKKwltZW1jcHkocmVtYXBfaW5mbyArIG9mZnNldCAvIDQsIGJ1Ziwg
Y291bnQpOwogCiAJLyogTkI6IFdlIGRlZmVyIHRoZSByZW1hcHBpbmcgdW50aWwgd2Ugc3dpdGNo
IHRvIHRoZSBjb250ZXh0ICovCi0JbGlzdF9mb3JfZWFjaF9lbnRyeShjdHgsICZkZXZfcHJpdi0+
Y29udGV4dHMubGlzdCwgbGluaykKLQkJY3R4LT5yZW1hcF9zbGljZSB8PSAoMTw8c2xpY2UpOwor
CWxpc3RfZm9yX2VhY2hfZW50cnkoY3R4LCAmaTkxNS0+Z2VtLmNvbnRleHRzLmxpc3QsIGxpbmsp
CisJCWN0eC0+cmVtYXBfc2xpY2UgfD0gQklUKHNsaWNlKTsKIAotCXJldCA9IGNvdW50OworCXNw
aW5fdW5sb2NrKCZpOTE1LT5nZW0uY29udGV4dHMubG9jayk7CisJa2ZyZWUoZnJlZW1lKTsKIAot
b3V0OgotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOworCS8qCisJICogVE9ETzog
SWRlYWxseSB3ZSByZWFsbHkgd2FudCBhIEdQVSByZXNldCBoZXJlIHRvIG1ha2Ugc3VyZSBlcnJv
cnMKKwkgKiBhcmVuJ3QgcHJvcGFnYXRlZC4gU2luY2UgSSBjYW5ub3QgZmluZCBhIHN0YWJsZSB3
YXkgdG8gcmVzZXQgdGhlIEdQVQorCSAqIGF0IHRoaXMgcG9pbnQgaXQgaXMgbGVmdCBhcyBhIFRP
RE8uCisJICovCiAKLQlyZXR1cm4gcmV0OworCXJldHVybiBjb3VudDsKIH0KIAogc3RhdGljIGNv
bnN0IHN0cnVjdCBiaW5fYXR0cmlidXRlIGRwZl9hdHRycyA9IHsKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfdHJhY2UuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
dHJhY2UuaAppbmRleCAxZjJjZjZjZmFmYjUuLjdlZjdhMWUxNjY0YyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV90cmFjZS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfdHJhY2UuaApAQCAtOTUyLDcgKzk1Miw3IEBAIERFQ0xBUkVfRVZFTlRfQ0xBU1MoaTkx
NV9jb250ZXh0LAogCVRQX2Zhc3RfYXNzaWduKAogCQkJX19lbnRyeS0+ZGV2ID0gY3R4LT5pOTE1
LT5kcm0ucHJpbWFyeS0+aW5kZXg7CiAJCQlfX2VudHJ5LT5jdHggPSBjdHg7Ci0JCQlfX2VudHJ5
LT52bSA9IGN0eC0+dm07CisJCQlfX2VudHJ5LT52bSA9IHJjdV9hY2Nlc3NfcG9pbnRlcihjdHgt
PnZtKTsKIAkpLAogCiAJVFBfcHJpbnRrKCJkZXY9JXUsIGN0eD0lcCwgY3R4X3ZtPSVwIiwKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtLmMKaW5kZXggMDM0NmMzZTViNmI2
Li5iZmE0MGE1YjZkOTggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pOTE1X2dlbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dl
bS5jCkBAIC0xMzgsMTEgKzEzOCw5IEBAIHN0YXRpYyBpbnQgaWd0X2dlbV9zdXNwZW5kKHZvaWQg
KmFyZykKIAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAKIAllcnIgPSAtRU5PTUVNOwotCW11dGV4
X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWN0eCA9IGxpdmVfY29udGV4dChpOTE1
LCBmaWxlKTsKIAlpZiAoIUlTX0VSUihjdHgpKQogCQllcnIgPSBzd2l0Y2hfdG9fY29udGV4dChp
OTE1LCBjdHgpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYg
KGVycikKIAkJZ290byBvdXQ7CiAKQEAgLTE1Nyw5ICsxNTUsNyBAQCBzdGF0aWMgaW50IGlndF9n
ZW1fc3VzcGVuZCh2b2lkICphcmcpCiAKIAlwbV9yZXN1bWUoaTkxNSk7CiAKLQltdXRleF9sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAllcnIgPSBzd2l0Y2hfdG9fY29udGV4dChpOTE1
LCBjdHgpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiBvdXQ6CiAJ
bW9ja19maWxlX2ZyZWUoaTkxNSwgZmlsZSk7CiAJcmV0dXJuIGVycjsKQEAgLTE3NywxMSArMTcz
LDkgQEAgc3RhdGljIGludCBpZ3RfZ2VtX2hpYmVybmF0ZSh2b2lkICphcmcpCiAJCXJldHVybiBQ
VFJfRVJSKGZpbGUpOwogCiAJZXJyID0gLUVOT01FTTsKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIAljdHggPSBsaXZlX2NvbnRleHQoaTkxNSwgZmlsZSk7CiAJaWYgKCFJ
U19FUlIoY3R4KSkKIAkJZXJyID0gc3dpdGNoX3RvX2NvbnRleHQoaTkxNSwgY3R4KTsKLQltdXRl
eF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChlcnIpCiAJCWdvdG8gb3V0
OwogCkBAIC0xOTYsOSArMTkwLDcgQEAgc3RhdGljIGludCBpZ3RfZ2VtX2hpYmVybmF0ZSh2b2lk
ICphcmcpCiAKIAlwbV9yZXN1bWUoaTkxNSk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKIAllcnIgPSBzd2l0Y2hfdG9fY29udGV4dChpOTE1LCBjdHgpOwotCW11dGV4
X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiBvdXQ6CiAJbW9ja19maWxlX2ZyZWUo
aTkxNSwgZmlsZSk7CiAJcmV0dXJuIGVycjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2Vs
ZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMKaW5kZXggZjM5ZjAyODJlNzhjLi4wYWY5YTU4ZDAxMWQg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmlj
dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5j
CkBAIC00NzMsNyArNDczLDYgQEAgc3RhdGljIGludCBpZ3RfZXZpY3RfY29udGV4dHModm9pZCAq
YXJnKQogCQl9CiAKIAkJY291bnQgPSAwOwotCQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKIAkJb25zdGFja19mZW5jZV9pbml0KCZmZW5jZSk7CiAJCWRvIHsKIAkJCXN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxOwpAQCAtNTEwLDggKzUwOSw2IEBAIHN0YXRpYyBpbnQgaWd0X2V2
aWN0X2NvbnRleHRzKHZvaWQgKmFyZykKIAkJCWNvdW50Kys7CiAJCQllcnIgPSAwOwogCQl9IHdo
aWxlKDEpOwotCQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJCW9u
c3RhY2tfZmVuY2VfZmluaSgmZmVuY2UpOwogCQlwcl9pbmZvKCJTdWJtaXR0ZWQgJWx1IGNvbnRl
eHRzL3JlcXVlc3RzIG9uICVzXG4iLAogCQkJY291bnQsIGVuZ2luZS0+bmFtZSk7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMKaW5kZXggZTQwZTZjZmE1
MWYxLi44ZDgxMjFjMDIxNjEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aTkxNV9nZW1fZ3R0LmMKQEAgLTEyNDYsNiArMTI0Niw3IEBAIHN0YXRpYyBpbnQgZXhlcmNpc2Vf
bW9jayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgIHVuc2lnbmVkIGxv
bmcgZW5kX3RpbWUpKQogewogCWNvbnN0IHU2NCBsaW1pdCA9IHRvdGFscmFtX3BhZ2VzKCkgPDwg
UEFHRV9TSElGVDsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKIAlzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dCAqY3R4OwogCUlHVF9USU1FT1VUKGVuZF90aW1lKTsKIAlpbnQgZXJyOwpA
QCAtMTI1NCw3ICsxMjU1LDkgQEAgc3RhdGljIGludCBleGVyY2lzZV9tb2NrKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCWlmICghY3R4KQogCQlyZXR1cm4gLUVOT01FTTsKIAotCWVy
ciA9IGZ1bmMoaTkxNSwgY3R4LT52bSwgMCwgbWluKGN0eC0+dm0tPnRvdGFsLCBsaW1pdCksIGVu
ZF90aW1lKTsKKwl2bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOworCWVyciA9
IGZ1bmMoaTkxNSwgdm0sIDAsIG1pbih2bS0+dG90YWwsIGxpbWl0KSwgZW5kX3RpbWUpOworCWk5
MTVfdm1fcHV0KHZtKTsKIAogCW1vY2tfY29udGV4dF9jbG9zZShjdHgpOwogCXJldHVybiBlcnI7
CkBAIC0xODAxLDE1ICsxODA0LDE1IEBAIHN0YXRpYyBpbnQgaWd0X2NzX3RsYih2b2lkICphcmcp
CiAJCWdvdG8gb3V0X3VubG9jazsKIAl9CiAKLQl2bSA9IGN0eC0+dm07Ci0JaWYgKCF2bSkKLQkJ
Z290byBvdXRfdW5sb2NrOworCXZtID0gaTkxNV9nZW1fY29udGV4dF9nZXRfdm1fcmN1KGN0eCk7
CisJaWYgKGk5MTVfaXNfZ2d0dCh2bSkpCisJCWdvdG8gb3V0X3ZtOwogCiAJLyogQ3JlYXRlIHR3
byBwYWdlczsgZHVtbXkgd2UgcHJlZmlsbCB0aGUgVExCLCBhbmQgaW50ZW5kZWQgKi8KIAliYmUg
PSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGk5MTUsIFBBR0VfU0laRSk7CiAJaWYg
KElTX0VSUihiYmUpKSB7CiAJCWVyciA9IFBUUl9FUlIoYmJlKTsKLQkJZ290byBvdXRfdW5sb2Nr
OworCQlnb3RvIG91dF92bTsKIAl9CiAKIAliYXRjaCA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFw
KGJiZSwgSTkxNV9NQVBfV0MpOwpAQCAtMjAxNCw2ICsyMDE3LDggQEAgc3RhdGljIGludCBpZ3Rf
Y3NfdGxiKHZvaWQgKmFyZykKIAlpOTE1X2dlbV9vYmplY3RfcHV0KGFjdCk7CiBvdXRfcHV0X2Ji
ZToKIAlpOTE1X2dlbV9vYmplY3RfcHV0KGJiZSk7CitvdXRfdm06CisJaTkxNV92bV9wdXQodm0p
Owogb3V0X3VubG9jazoKIAltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
CW1vY2tfZmlsZV9mcmVlKGk5MTUsIGZpbGUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL2k5MTVfcmVxdWVzdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2Vs
ZnRlc3RzL2k5MTVfcmVxdWVzdC5jCmluZGV4IGQ3ZDY4YzZhNmJkNS4uMDg5N2E3YjA0OTQ0IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcmVxdWVzdC5jCkBAIC0x
ODEsOSArMTgxLDcgQEAgc3RhdGljIGludCBpZ3RfcmVxdWVzdF9yZXdpbmQodm9pZCAqYXJnKQog
CXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAlpbnQgZXJyID0gLUVJTlZBTDsKIAotCW11dGV4
X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWN0eFswXSA9IG1vY2tfY29udGV4dChp
OTE1LCAiQSIpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlj
ZSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X2VuZ2luZShjdHhbMF0sIFJDUzApOwogCUdFTV9CVUdf
T04oSVNfRVJSKGNlKSk7CkBAIC0xOTcsOSArMTk1LDcgQEAgc3RhdGljIGludCBpZ3RfcmVxdWVz
dF9yZXdpbmQodm9pZCAqYXJnKQogCWk5MTVfcmVxdWVzdF9nZXQocmVxdWVzdCk7CiAJaTkxNV9y
ZXF1ZXN0X2FkZChyZXF1ZXN0KTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwogCWN0eFsxXSA9IG1vY2tfY29udGV4dChpOTE1LCAiQiIpOwotCW11dGV4X3VubG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAljZSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X2Vu
Z2luZShjdHhbMV0sIFJDUzApOwogCUdFTV9CVUdfT04oSVNfRVJSKGNlKSk7CkBAIC00MzgsOSAr
NDM0LDcgQEAgc3RhdGljIGludCBtb2NrX2JyZWFkY3J1bWJzX3Ntb2tldGVzdCh2b2lkICphcmcp
CiAJfQogCiAJZm9yIChuID0gMDsgbiA8IHQubmNvbnRleHRzOyBuKyspIHsKLQkJbXV0ZXhfbG9j
aygmdC5lbmdpbmUtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQl0LmNvbnRleHRzW25dID0g
bW9ja19jb250ZXh0KHQuZW5naW5lLT5pOTE1LCAibW9jayIpOwotCQltdXRleF91bmxvY2soJnQu
ZW5naW5lLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJaWYgKCF0LmNvbnRleHRzW25dKSB7
CiAJCQlyZXQgPSAtRU5PTUVNOwogCQkJZ290byBvdXRfY29udGV4dHM7CkBAIC03MzQsOSArNzI4
LDkgQEAgc3RhdGljIGludCBsaXZlX2VtcHR5X3JlcXVlc3Qodm9pZCAqYXJnKQogc3RhdGljIHN0
cnVjdCBpOTE1X3ZtYSAqcmVjdXJzaXZlX2JhdGNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQogewogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHggPSBpOTE1LT5rZXJuZWxfY29u
dGV4dDsKLQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IGN0eC0+dm0gPzogJmk5MTUt
PmdndHQudm07CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKIAljb25zdCBpbnQg
Z2VuID0gSU5URUxfR0VOKGk5MTUpOworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwog
CXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCXUzMiAqY21kOwogCWludCBlcnI7CkBAIC03NDUsNyAr
NzM5LDkgQEAgc3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqcmVjdXJzaXZlX2JhdGNoKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogCWlmIChJU19FUlIob2JqKSkKIAkJcmV0dXJuIEVSUl9D
QVNUKG9iaik7CiAKKwl2bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOwogCXZt
YSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgdm0sIE5VTEwpOworCWk5MTVfdm1fcHV0KHZtKTsK
IAlpZiAoSVNfRVJSKHZtYSkpIHsKIAkJZXJyID0gUFRSX0VSUih2bWEpOwogCQlnb3RvIGVycjsK
QEAgLTEyMjAsOSArMTIxNiw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9icmVhZGNydW1ic19zbW9rZXRl
c3Qodm9pZCAqYXJnKQogCX0KIAogCWZvciAobiA9IDA7IG4gPCB0WzBdLm5jb250ZXh0czsgbisr
KSB7Ci0JCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQl0WzBdLmNvbnRl
eHRzW25dID0gbGl2ZV9jb250ZXh0KGk5MTUsIGZpbGUpOwotCQltdXRleF91bmxvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQlpZiAoIXRbMF0uY29udGV4dHNbbl0pIHsKIAkJCXJldCA9
IC1FTk9NRU07CiAJCQlnb3RvIG91dF9jb250ZXh0czsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2Vs
ZnRlc3RzL2k5MTVfdm1hLmMKaW5kZXggYWMxZmY1NThlYjkwLi41OGI1ZjQwYTA3ZGQgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5jCkBAIC0yNCw2ICsyNCw3IEBA
CiAKICNpbmNsdWRlIDxsaW51eC9wcmltZV9udW1iZXJzLmg+CiAKKyNpbmNsdWRlICJnZW0vaTkx
NV9nZW1fY29udGV4dC5oIgogI2luY2x1ZGUgImdlbS9zZWxmdGVzdHMvbW9ja19jb250ZXh0Lmgi
CiAKICNpbmNsdWRlICJpOTE1X3NjYXR0ZXJsaXN0LmgiCkBAIC0zOCw3ICszOSw3IEBAIHN0YXRp
YyBib29sIGFzc2VydF92bWEoc3RydWN0IGk5MTVfdm1hICp2bWEsCiB7CiAJYm9vbCBvayA9IHRy
dWU7CiAKLQlpZiAodm1hLT52bSAhPSBjdHgtPnZtKSB7CisJaWYgKHZtYS0+dm0gIT0gcmN1X2Fj
Y2Vzc19wb2ludGVyKGN0eC0+dm0pKSB7CiAJCXByX2VycigiVk1BIGNyZWF0ZWQgd2l0aCB3cm9u
ZyBWTVxuIik7CiAJCW9rID0gZmFsc2U7CiAJfQpAQCAtMTEzLDExICsxMTQsMTMgQEAgc3RhdGlj
IGludCBjcmVhdGVfdm1hcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlsaXN0X2Zv
cl9lYWNoX2VudHJ5KG9iaiwgb2JqZWN0cywgc3RfbGluaykgewogCQlmb3IgKHBpbm5lZCA9IDA7
IHBpbm5lZCA8PSAxOyBwaW5uZWQrKykgewogCQkJbGlzdF9mb3JfZWFjaF9lbnRyeShjdHgsIGNv
bnRleHRzLCBsaW5rKSB7Ci0JCQkJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSBjdHgt
PnZtOworCQkJCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwogCQkJCXN0cnVjdCBpOTE1
X3ZtYSAqdm1hOwogCQkJCWludCBlcnI7CiAKKwkJCQl2bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0
X3ZtX3JjdShjdHgpOwogCQkJCXZtYSA9IGNoZWNrZWRfdm1hX2luc3RhbmNlKG9iaiwgdm0sIE5V
TEwpOworCQkJCWk5MTVfdm1fcHV0KHZtKTsKIAkJCQlpZiAoSVNfRVJSKHZtYSkpCiAJCQkJCXJl
dHVybiBQVFJfRVJSKHZtYSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9tb2NrX2dlbV9kZXZpY2UuYwppbmRleCA0ZTZjZGUwZDQ4NTkuLjMzNWYzN2JhOThkZSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYwpA
QCAtNTksMTEgKzU5LDkgQEAgc3RhdGljIHZvaWQgbW9ja19kZXZpY2VfcmVsZWFzZShzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2KQogCiAJaTkxNV9nZW1fZHJhaW5fd29ya3F1ZXVlKGk5MTUpOwogCi0J
bXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJZm9yX2VhY2hfZW5naW5lKGVu
Z2luZSwgaTkxNSwgaWQpCiAJCW1vY2tfZW5naW5lX2ZyZWUoZW5naW5lKTsKLQlpOTE1X2dlbV9j
b250ZXh0c19maW5pKGk5MTUpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CisJaTkxNV9nZW1fZHJpdmVyX3JlbGVhc2VfX2NvbnRleHRzKGk5MTUpOwogCiAJaW50ZWxf
dGltZWxpbmVzX2ZpbmkoaTkxNSk7CiAKQEAgLTIwNiw3ICsyMDQsNyBAQCBzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqbW9ja19nZW1fZGV2aWNlKHZvaWQpCiAJcmV0dXJuIGk5MTU7CiAKIGVycl9j
b250ZXh0OgotCWk5MTVfZ2VtX2NvbnRleHRzX2ZpbmkoaTkxNSk7CisJaTkxNV9nZW1fZHJpdmVy
X3JlbGVhc2VfX2NvbnRleHRzKGk5MTUpOwogZXJyX2VuZ2luZToKIAltb2NrX2VuZ2luZV9mcmVl
KGk5MTUtPmVuZ2luZVtSQ1MwXSk7CiBlcnJfdW5sb2NrOgotLSAKMi4yMy4wCgpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBs
aXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

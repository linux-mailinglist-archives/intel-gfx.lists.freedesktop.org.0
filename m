Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 6F1206A6BE
	for <lists+intel-gfx@lfdr.de>; Tue, 16 Jul 2019 12:48:34 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 440516E0EA;
	Tue, 16 Jul 2019 10:48:32 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga14.intel.com (mga14.intel.com [192.55.52.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A6E536E0EA
 for <intel-gfx@lists.freedesktop.org>; Tue, 16 Jul 2019 10:48:31 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga007.jf.intel.com ([10.7.209.58])
 by fmsmga103.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 16 Jul 2019 03:48:31 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,498,1557212400"; d="scan'208";a="158104131"
Received: from esulliva-mobl.ger.corp.intel.com (HELO [10.251.94.109])
 ([10.251.94.109])
 by orsmga007.jf.intel.com with ESMTP; 16 Jul 2019 03:48:29 -0700
To: Chris Wilson <chris@chris-wilson.co.uk>, intel-gfx@lists.freedesktop.org
References: <20190715080946.15593-1-chris@chris-wilson.co.uk>
 <20190715080946.15593-7-chris@chris-wilson.co.uk>
From: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>
Organization: Intel Corporation UK Plc
Message-ID: <6ee58779-725d-9f9a-d202-8e050b6c0519@linux.intel.com>
Date: Tue, 16 Jul 2019 11:48:28 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.7.2
MIME-Version: 1.0
In-Reply-To: <20190715080946.15593-7-chris@chris-wilson.co.uk>
Content-Language: en-US
Subject: Re: [Intel-gfx] [PATCH 07/24] drm/i915: Rely on spinlock protection
 for GPU error capture
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Ck9uIDE1LzA3LzIwMTkgMDk6MDksIENocmlzIFdpbHNvbiB3cm90ZToKPiBUcnVzdCB0aGF0IHdl
IG5vdyBoYXZlIGFkZXF1YXRlIHByb3RlY3Rpb24gb3ZlciB0aGUgbG93IGxldmVsIHN0cnVjdHVy
ZXMKPiB2aWEgdGhlIGVuZ2luZS0+YWN0aXZlLmxvY2sgdG8gYWxsb3cgb3Vyc2VsdmVzIHRvIGNh
cHR1cmUgdGhlIEdQVSBlcnJvcgo+IHN0YXRlIHdpdGhvdXQgdGhlIGhlYXZ5IGhhbW1lciBvZiBz
dG9wX21hY2hpbmUoKS4gU2FkbHkgdGhpcyBkb2VzIG1lYW4KPiB0aGF0IHdlIGhhdmUgdG8gZm9y
Z28gc29tZSBvZiB0aGUgbGVzc2VyIHVzZWQgaW5mb3JtYXRpb24gKG5vdCBkZXJpdmVkCj4gZnJv
bSB0aGUgYWN0aXZlIHN0YXRlKSB0aGF0IGlzIG5vdCBjb250cm9sbGVkIGJ5IHRoZSBhY3RpdmUg
bG9ja3MuCj4gCj4gQSB1c2VmdWwgc2lkZS1lZmZlY3QgaXMgdGhhdCB0aGlzIGFsbG93cyB1cyB0
byByZXN0b3JlIGVycm9yIGNhcHR1cmluZwo+IGZvciBCcmFzd2VsbCBhbmQgQnJveHRvbi4KPiAK
PiBTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4K
PiAtLS0KPiAgIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jICAgfCAgIDUgLQo+
ICAgZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3IuYyB8IDUwMyArKysrKysrKysr
Ky0tLS0tLS0tLS0tLS0tLQo+ICAgZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3Iu
aCB8ICAxNyAtCj4gICAzIGZpbGVzIGNoYW5nZWQsIDIwNyBpbnNlcnRpb25zKCspLCAzMTggZGVs
ZXRpb25zKC0pCj4gCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2Vt
X2d0dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKPiBpbmRleCAyMjBh
YmE1YTk0ZDIuLjVjOWM3Y2FlNDgxNyAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbV9ndHQuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0
dC5jCj4gQEAgLTI5NjYsMTEgKzI5NjYsNiBAQCBzdGF0aWMgaW50IGdlbjhfZ21jaF9wcm9iZShz
dHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQo+ICAgCQlnZ3R0LT52bS5pbnNlcnRfcGFnZSAgICA9IGJ4
dF92dGRfZ2d0dF9pbnNlcnRfcGFnZV9fQktMOwo+ICAgCQlpZiAoZ2d0dC0+dm0uY2xlYXJfcmFu
Z2UgIT0gbm9wX2NsZWFyX3JhbmdlKQo+ICAgCQkJZ2d0dC0+dm0uY2xlYXJfcmFuZ2UgPSBieHRf
dnRkX2dndHRfY2xlYXJfcmFuZ2VfX0JLTDsKPiAtCj4gLQkJLyogUHJldmVudCByZWN1cnNpdmVs
eSBjYWxsaW5nIHN0b3BfbWFjaGluZSgpIGFuZCBkZWFkbG9ja3MuICovCj4gLQkJZGV2X2luZm8o
ZGV2X3ByaXYtPmRybS5kZXYsCj4gLQkJCSAiRGlzYWJsaW5nIGVycm9yIGNhcHR1cmUgZm9yIFZU
LWQgd29ya2Fyb3VuZFxuIik7Cj4gLQkJaTkxNV9kaXNhYmxlX2Vycm9yX3N0YXRlKGRldl9wcml2
LCAtRU5PREVWKTsKPiAgIAl9Cj4gICAKPiAgIAlnZ3R0LT5pbnZhbGlkYXRlID0gZ2VuNl9nZ3R0
X2ludmFsaWRhdGU7Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1
X2Vycm9yLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5jCj4gaW5kZXgg
YzViODliZjRkNjE2Li4wMjZlZTFmNTUzNmQgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9ncHVfZXJyb3IuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
Z3B1X2Vycm9yLmMKPiBAQCAtMzAsNyArMzAsNiBAQAo+ICAgI2luY2x1ZGUgPGxpbnV4L2FzY2lp
ODUuaD4KPiAgICNpbmNsdWRlIDxsaW51eC9ubWkuaD4KPiAgICNpbmNsdWRlIDxsaW51eC9zY2F0
dGVybGlzdC5oPgo+IC0jaW5jbHVkZSA8bGludXgvc3RvcF9tYWNoaW5lLmg+Cj4gICAjaW5jbHVk
ZSA8bGludXgvdXRzbmFtZS5oPgo+ICAgI2luY2x1ZGUgPGxpbnV4L3psaWIuaD4KPiAgIAo+IEBA
IC00Niw2ICs0NSw5IEBACj4gICAjaW5jbHVkZSAiaTkxNV9zY2F0dGVybGlzdC5oIgo+ICAgI2lu
Y2x1ZGUgImludGVsX2Nzci5oIgo+ICAgCj4gKyNkZWZpbmUgQUxMT1dfRkFJTCAoR0ZQX0tFUk5F
TCB8IF9fR0ZQX1JFVFJZX01BWUZBSUwgfCBfX0dGUF9OT1dBUk4pCj4gKyNkZWZpbmUgQVRPTUlD
X01BWUZBSUwgKEdGUF9BVE9NSUMgfCBfX0dGUF9OT1dBUk4pCj4gKwo+ICAgc3RhdGljIGlubGlu
ZSBjb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICoKPiAgIGVuZ2luZV9sb29rdXAoY29uc3Qg
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHVuc2lnbmVkIGludCBpZCkKPiAgIHsKPiBA
QCAtNjcsMjYgKzY5LDYgQEAgZW5naW5lX25hbWUoY29uc3Qgc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsIHVuc2lnbmVkIGludCBpZCkKPiAgIAlyZXR1cm4gX19lbmdpbmVfbmFtZShlbmdp
bmVfbG9va3VwKGk5MTUsIGlkKSk7Cj4gICB9Cj4gICAKPiAtc3RhdGljIGNvbnN0IGNoYXIgKnRp
bGluZ19mbGFnKGludCB0aWxpbmcpCj4gLXsKPiAtCXN3aXRjaCAodGlsaW5nKSB7Cj4gLQlkZWZh
dWx0Ogo+IC0JY2FzZSBJOTE1X1RJTElOR19OT05FOiByZXR1cm4gIiI7Cj4gLQljYXNlIEk5MTVf
VElMSU5HX1g6IHJldHVybiAiIFgiOwo+IC0JY2FzZSBJOTE1X1RJTElOR19ZOiByZXR1cm4gIiBZ
IjsKPiAtCX0KPiAtfQo+IC0KPiAtc3RhdGljIGNvbnN0IGNoYXIgKmRpcnR5X2ZsYWcoaW50IGRp
cnR5KQo+IC17Cj4gLQlyZXR1cm4gZGlydHkgPyAiIGRpcnR5IiA6ICIiOwo+IC19Cj4gLQo+IC1z
dGF0aWMgY29uc3QgY2hhciAqcHVyZ2VhYmxlX2ZsYWcoaW50IHB1cmdlYWJsZSkKPiAtewo+IC0J
cmV0dXJuIHB1cmdlYWJsZSA/ICIgcHVyZ2VhYmxlIiA6ICIiOwo+IC19Cj4gLQo+ICAgc3RhdGlj
IHZvaWQgX19zZ19zZXRfYnVmKHN0cnVjdCBzY2F0dGVybGlzdCAqc2csCj4gICAJCQkgdm9pZCAq
YWRkciwgdW5zaWduZWQgaW50IGxlbiwgbG9mZl90IGl0KQo+ICAgewo+IEBAIC0xMTQsNyArOTYs
NyBAQCBzdGF0aWMgYm9vbCBfX2k5MTVfZXJyb3JfZ3JvdyhzdHJ1Y3QgZHJtX2k5MTVfZXJyb3Jf
c3RhdGVfYnVmICplLCBzaXplX3QgbGVuKQo+ICAgCWlmIChlLT5jdXIgPT0gZS0+ZW5kKSB7Cj4g
ICAJCXN0cnVjdCBzY2F0dGVybGlzdCAqc2dsOwo+ICAgCj4gLQkJc2dsID0gKHR5cGVvZihzZ2wp
KV9fZ2V0X2ZyZWVfcGFnZShHRlBfS0VSTkVMKTsKPiArCQlzZ2wgPSAodHlwZW9mKHNnbCkpX19n
ZXRfZnJlZV9wYWdlKEFMTE9XX0ZBSUwpOwo+ICAgCQlpZiAoIXNnbCkgewo+ICAgCQkJZS0+ZXJy
ID0gLUVOT01FTTsKPiAgIAkJCXJldHVybiBmYWxzZTsKPiBAQCAtMTM0LDcgKzExNiw3IEBAIHN0
YXRpYyBib29sIF9faTkxNV9lcnJvcl9ncm93KHN0cnVjdCBkcm1faTkxNV9lcnJvcl9zdGF0ZV9i
dWYgKmUsIHNpemVfdCBsZW4pCj4gICAJfQo+ICAgCj4gICAJZS0+c2l6ZSA9IEFMSUdOKGxlbiAr
IDEsIFNaXzY0Syk7Cj4gLQllLT5idWYgPSBrbWFsbG9jKGUtPnNpemUsIEdGUF9LRVJORUwgfCBf
X0dGUF9OT1dBUk4gfCBfX0dGUF9OT1JFVFJZKTsKPiArCWUtPmJ1ZiA9IGttYWxsb2MoZS0+c2l6
ZSwgQUxMT1dfRkFJTCk7Cj4gICAJaWYgKCFlLT5idWYpIHsKPiAgIAkJZS0+c2l6ZSA9IFBBR0Vf
QUxJR04obGVuICsgMSk7Cj4gICAJCWUtPmJ1ZiA9IGttYWxsb2MoZS0+c2l6ZSwgR0ZQX0tFUk5F
TCk7Cj4gQEAgLTIxMSw0NyArMTkzLDEyNyBAQCBpOTE1X2Vycm9yX3ByaW50ZXIoc3RydWN0IGRy
bV9pOTE1X2Vycm9yX3N0YXRlX2J1ZiAqZSkKPiAgIAlyZXR1cm4gcDsKPiAgIH0KPiAgIAo+ICsv
KiBzaW5nbGUgdGhyZWFkZWQgcGFnZSBhbGxvY2F0b3Igd2l0aCBhIHJlc2VydmVkIHN0YXNoIGZv
ciBlbWVyZ2VuY2llcyAqLwo+ICtzdHJ1Y3QgcG9vbCB7Cj4gKwl2b2lkICpzdGFzaFszMV07CgpX
aHkgMzE/Cgo+ICsJdW5zaWduZWQgaW50IGNvdW50Owo+ICt9Owo+ICsKPiArc3RhdGljIHZvaWQg
Kl9fYWxsb2NfcGFnZShnZnBfdCBnZnApCj4gK3sKPiArCXJldHVybiAodm9pZCAqKV9fZ2V0X2Zy
ZWVfcGFnZShnZnApOwo+ICt9Cj4gKwo+ICtzdGF0aWMgdm9pZCBwb29sX2Zpbmkoc3RydWN0IHBv
b2wgKnApCj4gK3sKPiArCXdoaWxlIChwLT5jb3VudC0tKQo+ICsJCWZyZWVfcGFnZSgodW5zaWdu
ZWQgbG9uZylwLT5zdGFzaFtwLT5jb3VudF0pOwo+ICt9Cj4gKwo+ICtzdGF0aWMgaW50IHBvb2xf
cmVmaWxsKHN0cnVjdCBwb29sICpwLCBnZnBfdCBnZnApCj4gK3sKPiArCXdoaWxlIChwLT5jb3Vu
dCA8IEFSUkFZX1NJWkUocC0+c3Rhc2gpKSB7Cj4gKwkJcC0+c3Rhc2hbcC0+Y291bnRdID0gX19h
bGxvY19wYWdlKGdmcCk7Cj4gKwkJaWYgKCFwLT5zdGFzaFtwLT5jb3VudF0pCj4gKwkJCXJldHVy
biAtRU5PTUVNOwo+ICsKPiArCQlwLT5jb3VudCsrOwo+ICsJfQo+ICsKPiArCXJldHVybiAwOwo+
ICt9Cj4gKwo+ICtzdGF0aWMgaW50IHBvb2xfaW5pdChzdHJ1Y3QgcG9vbCAqcCwgZ2ZwX3QgZ2Zw
KQo+ICt7Cj4gKwlpbnQgZXJyOwo+ICsKPiArCXAtPmNvdW50ID0gMDsKPiArCj4gKwllcnIgPSBw
b29sX3JlZmlsbChwLCBnZnApOwo+ICsJaWYgKGVycikKPiArCQlwb29sX2ZpbmkocCk7Cj4gKwo+
ICsJcmV0dXJuIGVycjsKPiArfQo+ICsKPiArc3RhdGljIHZvaWQgKnBvb2xfYWxsb2Moc3RydWN0
IHBvb2wgKnAsIGdmcF90IGdmcCkKPiArewo+ICsJdm9pZCAqcHRyOwo+ICsKPiArCXB0ciA9IF9f
YWxsb2NfcGFnZShnZnApOwo+ICsJaWYgKHB0cikKPiArCQlyZXR1cm4gcHRyOwo+ICsKPiArCWlm
IChwLT5jb3VudCkKPiArCQlyZXR1cm4gcC0+c3Rhc2hbLS1wLT5jb3VudF07Cj4gKwo+ICsJcmV0
dXJuIE5VTEw7Cj4gK30KPiArCj4gK3N0YXRpYyB2b2lkIHBvb2xfZnJlZShzdHJ1Y3QgcG9vbCAq
cCwgdm9pZCAqcGFnZSkKPiArewo+ICsJaWYgKHAtPmNvdW50IDwgQVJSQVlfU0laRShwLT5zdGFz
aCkpIHsKPiArCQlwLT5zdGFzaFtwLT5jb3VudCsrXSA9IHBhZ2U7Cj4gKwkJcmV0dXJuOwo+ICsJ
fQo+ICsKPiArCWZyZWVfcGFnZSgodW5zaWduZWQgbG9uZylwYWdlKTsKPiArfQo+ICsKPiAgICNp
ZmRlZiBDT05GSUdfRFJNX0k5MTVfQ09NUFJFU1NfRVJST1IKPiAgIAo+ICAgc3RydWN0IGNvbXBy
ZXNzIHsKPiArCXN0cnVjdCBwb29sIHBvb2w7Cj4gICAJc3RydWN0IHpfc3RyZWFtX3MgenN0cmVh
bTsKPiAgIAl2b2lkICp0bXA7Cj4gICB9Owo+ICAgCj4gICBzdGF0aWMgYm9vbCBjb21wcmVzc19p
bml0KHN0cnVjdCBjb21wcmVzcyAqYykKPiAgIHsKPiAtCXN0cnVjdCB6X3N0cmVhbV9zICp6c3Ry
ZWFtID0gbWVtc2V0KCZjLT56c3RyZWFtLCAwLCBzaXplb2YoYy0+enN0cmVhbSkpOwo+ICsJc3Ry
dWN0IHpfc3RyZWFtX3MgKnpzdHJlYW0gPSAmYy0+enN0cmVhbTsKPiAgIAo+IC0JenN0cmVhbS0+
d29ya3NwYWNlID0KPiAtCQlrbWFsbG9jKHpsaWJfZGVmbGF0ZV93b3Jrc3BhY2VzaXplKE1BWF9X
QklUUywgTUFYX01FTV9MRVZFTCksCj4gLQkJCUdGUF9BVE9NSUMgfCBfX0dGUF9OT1dBUk4pOwo+
IC0JaWYgKCF6c3RyZWFtLT53b3Jrc3BhY2UpCj4gKwlpZiAocG9vbF9pbml0KCZjLT5wb29sLCBB
TExPV19GQUlMKSkKPiAgIAkJcmV0dXJuIGZhbHNlOwo+ICAgCj4gLQlpZiAoemxpYl9kZWZsYXRl
SW5pdCh6c3RyZWFtLCBaX0RFRkFVTFRfQ09NUFJFU1NJT04pICE9IFpfT0spIHsKPiAtCQlrZnJl
ZSh6c3RyZWFtLT53b3Jrc3BhY2UpOwo+ICsJenN0cmVhbS0+d29ya3NwYWNlID0KPiArCQlrbWFs
bG9jKHpsaWJfZGVmbGF0ZV93b3Jrc3BhY2VzaXplKE1BWF9XQklUUywgTUFYX01FTV9MRVZFTCks
Cj4gKwkJCUFMTE9XX0ZBSUwpOwo+ICsJaWYgKCF6c3RyZWFtLT53b3Jrc3BhY2UpIHsKPiArCQlw
b29sX2ZpbmkoJmMtPnBvb2wpOwo+ICAgCQlyZXR1cm4gZmFsc2U7Cj4gICAJfQo+ICAgCj4gICAJ
Yy0+dG1wID0gTlVMTDsKPiAgIAlpZiAoaTkxNV9oYXNfbWVtY3B5X2Zyb21fd2MoKSkKPiAtCQlj
LT50bXAgPSAodm9pZCAqKV9fZ2V0X2ZyZWVfcGFnZShHRlBfQVRPTUlDIHwgX19HRlBfTk9XQVJO
KTsKPiArCQljLT50bXAgPSBwb29sX2FsbG9jKCZjLT5wb29sLCBBTExPV19GQUlMKTsKClNvIDMx
IHN0YXNoZWQgcGFnZXMgd2lsbCBiZSBlbm91Z2ggdG8gbm90IG5lZWQgYXRvbWljIGFsbG9jYXRp
b25zLCBvciBJIAptaXNzZWQgYSBwb2ludD8KCldoYXQgZGV0ZXJtaW5lcyAzMSBpcyBlbm91Z2g/
Cgo+ICAgCj4gICAJcmV0dXJuIHRydWU7Cj4gICB9Cj4gICAKPiAtc3RhdGljIHZvaWQgKmNvbXBy
ZXNzX25leHRfcGFnZShzdHJ1Y3QgZHJtX2k5MTVfZXJyb3Jfb2JqZWN0ICpkc3QpCj4gK3N0YXRp
YyBib29sIGNvbXByZXNzX3N0YXJ0KHN0cnVjdCBjb21wcmVzcyAqYykKPiArewo+ICsJc3RydWN0
IHpfc3RyZWFtX3MgKnpzdHJlYW0gPSAmYy0+enN0cmVhbTsKPiArCXZvaWQgKndvcmtzcGFjZSA9
IHpzdHJlYW0tPndvcmtzcGFjZTsKPiArCj4gKwltZW1zZXQoenN0cmVhbSwgMCwgc2l6ZW9mKCp6
c3RyZWFtKSk7Cj4gKwl6c3RyZWFtLT53b3Jrc3BhY2UgPSB3b3Jrc3BhY2U7Cj4gKwo+ICsJcmV0
dXJuIHpsaWJfZGVmbGF0ZUluaXQoenN0cmVhbSwgWl9ERUZBVUxUX0NPTVBSRVNTSU9OKSA9PSBa
X09LOwo+ICt9Cj4gKwo+ICtzdGF0aWMgdm9pZCAqY29tcHJlc3NfbmV4dF9wYWdlKHN0cnVjdCBj
b21wcmVzcyAqYywKPiArCQkJCXN0cnVjdCBkcm1faTkxNV9lcnJvcl9vYmplY3QgKmRzdCkKPiAg
IHsKPiAtCXVuc2lnbmVkIGxvbmcgcGFnZTsKPiArCXZvaWQgKnBhZ2U7Cj4gICAKPiAgIAlpZiAo
ZHN0LT5wYWdlX2NvdW50ID49IGRzdC0+bnVtX3BhZ2VzKQo+ICAgCQlyZXR1cm4gRVJSX1BUUigt
RU5PU1BDKTsKPiAgIAo+IC0JcGFnZSA9IF9fZ2V0X2ZyZWVfcGFnZShHRlBfQVRPTUlDIHwgX19H
RlBfTk9XQVJOKTsKPiArCXBhZ2UgPSBwb29sX2FsbG9jKCZjLT5wb29sLCBBVE9NSUNfTUFZRkFJ
TCk7Cj4gICAJaWYgKCFwYWdlKQo+ICAgCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKPiAgIAo+
IC0JcmV0dXJuIGRzdC0+cGFnZXNbZHN0LT5wYWdlX2NvdW50KytdID0gKHZvaWQgKilwYWdlOwo+
ICsJcmV0dXJuIGRzdC0+cGFnZXNbZHN0LT5wYWdlX2NvdW50KytdID0gcGFnZTsKPiAgIH0KPiAg
IAo+ICAgc3RhdGljIGludCBjb21wcmVzc19wYWdlKHN0cnVjdCBjb21wcmVzcyAqYywKPiBAQCAt
MjY3LDcgKzMyOSw3IEBAIHN0YXRpYyBpbnQgY29tcHJlc3NfcGFnZShzdHJ1Y3QgY29tcHJlc3Mg
KmMsCj4gICAKPiAgIAlkbyB7Cj4gICAJCWlmICh6c3RyZWFtLT5hdmFpbF9vdXQgPT0gMCkgewo+
IC0JCQl6c3RyZWFtLT5uZXh0X291dCA9IGNvbXByZXNzX25leHRfcGFnZShkc3QpOwo+ICsJCQl6
c3RyZWFtLT5uZXh0X291dCA9IGNvbXByZXNzX25leHRfcGFnZShjLCBkc3QpOwo+ICAgCQkJaWYg
KElTX0VSUih6c3RyZWFtLT5uZXh0X291dCkpCj4gICAJCQkJcmV0dXJuIFBUUl9FUlIoenN0cmVh
bS0+bmV4dF9vdXQpOwo+ICAgCj4gQEAgLTI5NSw3ICszNTcsNyBAQCBzdGF0aWMgaW50IGNvbXBy
ZXNzX2ZsdXNoKHN0cnVjdCBjb21wcmVzcyAqYywKPiAgIAlkbyB7Cj4gICAJCXN3aXRjaCAoemxp
Yl9kZWZsYXRlKHpzdHJlYW0sIFpfRklOSVNIKSkgewo+ICAgCQljYXNlIFpfT0s6IC8qIG1vcmUg
c3BhY2UgcmVxdWVzdGVkICovCj4gLQkJCXpzdHJlYW0tPm5leHRfb3V0ID0gY29tcHJlc3NfbmV4
dF9wYWdlKGRzdCk7Cj4gKwkJCXpzdHJlYW0tPm5leHRfb3V0ID0gY29tcHJlc3NfbmV4dF9wYWdl
KGMsIGRzdCk7Cj4gICAJCQlpZiAoSVNfRVJSKHpzdHJlYW0tPm5leHRfb3V0KSkKPiAgIAkJCQly
ZXR1cm4gUFRSX0VSUih6c3RyZWFtLT5uZXh0X291dCk7Cj4gICAKPiBAQCAtMzE2LDE1ICszNzgs
MTcgQEAgc3RhdGljIGludCBjb21wcmVzc19mbHVzaChzdHJ1Y3QgY29tcHJlc3MgKmMsCj4gICAJ
cmV0dXJuIDA7Cj4gICB9Cj4gICAKPiAtc3RhdGljIHZvaWQgY29tcHJlc3NfZmluaShzdHJ1Y3Qg
Y29tcHJlc3MgKmMsCj4gLQkJCSAgc3RydWN0IGRybV9pOTE1X2Vycm9yX29iamVjdCAqZHN0KQo+
ICtzdGF0aWMgdm9pZCBjb21wcmVzc19maW5pc2goc3RydWN0IGNvbXByZXNzICpjKQo+ICAgewo+
IC0Jc3RydWN0IHpfc3RyZWFtX3MgKnpzdHJlYW0gPSAmYy0+enN0cmVhbTsKPiArCXpsaWJfZGVm
bGF0ZUVuZCgmYy0+enN0cmVhbSk7Cj4gK30KPiAgIAo+IC0JemxpYl9kZWZsYXRlRW5kKHpzdHJl
YW0pOwo+IC0Ja2ZyZWUoenN0cmVhbS0+d29ya3NwYWNlKTsKPiArc3RhdGljIHZvaWQgY29tcHJl
c3NfZmluaShzdHJ1Y3QgY29tcHJlc3MgKmMpCj4gK3sKPiArCWtmcmVlKGMtPnpzdHJlYW0ud29y
a3NwYWNlKTsKPiAgIAlpZiAoYy0+dG1wKQo+IC0JCWZyZWVfcGFnZSgodW5zaWduZWQgbG9uZylj
LT50bXApOwo+ICsJCXBvb2xfZnJlZSgmYy0+cG9vbCwgYy0+dG1wKTsKPiArCXBvb2xfZmluaSgm
Yy0+cG9vbCk7Cj4gICB9Cj4gICAKPiAgIHN0YXRpYyB2b2lkIGVycl9jb21wcmVzc2lvbl9tYXJr
ZXIoc3RydWN0IGRybV9pOTE1X2Vycm9yX3N0YXRlX2J1ZiAqbSkKPiBAQCAtMzM1LDkgKzM5OSwx
OCBAQCBzdGF0aWMgdm9pZCBlcnJfY29tcHJlc3Npb25fbWFya2VyKHN0cnVjdCBkcm1faTkxNV9l
cnJvcl9zdGF0ZV9idWYgKm0pCj4gICAjZWxzZQo+ICAgCj4gICBzdHJ1Y3QgY29tcHJlc3Mgewo+
ICsJc3RydWN0IHBvb2wgcG9vbDsKPiAgIH07Cj4gICAKPiAgIHN0YXRpYyBib29sIGNvbXByZXNz
X2luaXQoc3RydWN0IGNvbXByZXNzICpjKQo+ICt7Cj4gKwlpZiAocG9vbF9pbml0KCZjLT5wb29s
LCBBTExPV19GQUlMKSkKPiArCQlyZXR1cm4gZmFsc2U7Cj4gKwo+ICsJcmV0dXJuIHRydWU7Cgpy
ZXR1cm4gcG9vbF9pbml0KCkgPT0gMCA/Cgo+ICt9Cj4gKwo+ICtzdGF0aWMgYm9vbCBjb21wcmVz
c19zdGFydChzdHJ1Y3QgY29tcHJlc3MgKmMpCj4gICB7Cj4gICAJcmV0dXJuIHRydWU7Cj4gICB9
Cj4gQEAgLTM0NiwxNCArNDE5LDEyIEBAIHN0YXRpYyBpbnQgY29tcHJlc3NfcGFnZShzdHJ1Y3Qg
Y29tcHJlc3MgKmMsCj4gICAJCQkgdm9pZCAqc3JjLAo+ICAgCQkJIHN0cnVjdCBkcm1faTkxNV9l
cnJvcl9vYmplY3QgKmRzdCkKPiAgIHsKPiAtCXVuc2lnbmVkIGxvbmcgcGFnZTsKPiAgIAl2b2lk
ICpwdHI7Cj4gICAKPiAtCXBhZ2UgPSBfX2dldF9mcmVlX3BhZ2UoR0ZQX0FUT01JQyB8IF9fR0ZQ
X05PV0FSTik7Cj4gLQlpZiAoIXBhZ2UpCj4gKwlwdHIgPSBwb29sX2FsbG9jKCZjLT5wb29sLCBB
VE9NSUNfTUFZRkFJTCk7Cj4gKwlpZiAoIXB0cikKPiAgIAkJcmV0dXJuIC1FTk9NRU07Cj4gICAK
PiAtCXB0ciA9ICh2b2lkICopcGFnZTsKPiAgIAlpZiAoIWk5MTVfbWVtY3B5X2Zyb21fd2MocHRy
LCBzcmMsIFBBR0VfU0laRSkpCj4gICAJCW1lbWNweShwdHIsIHNyYywgUEFHRV9TSVpFKTsKPiAg
IAlkc3QtPnBhZ2VzW2RzdC0+cGFnZV9jb3VudCsrXSA9IHB0cjsKPiBAQCAtMzY3LDExICs0Mzgs
MTUgQEAgc3RhdGljIGludCBjb21wcmVzc19mbHVzaChzdHJ1Y3QgY29tcHJlc3MgKmMsCj4gICAJ
cmV0dXJuIDA7Cj4gICB9Cj4gICAKPiAtc3RhdGljIHZvaWQgY29tcHJlc3NfZmluaShzdHJ1Y3Qg
Y29tcHJlc3MgKmMsCj4gLQkJCSAgc3RydWN0IGRybV9pOTE1X2Vycm9yX29iamVjdCAqZHN0KQo+
ICtzdGF0aWMgdm9pZCBjb21wcmVzc19maW5pc2goc3RydWN0IGNvbXByZXNzICpjKQo+ICAgewo+
ICAgfQo+ICAgCj4gK3N0YXRpYyB2b2lkIGNvbXByZXNzX2Zpbmkoc3RydWN0IGNvbXByZXNzICpj
KQo+ICt7Cj4gKwlwb29sX2ZpbmkoJmMtPnBvb2wpOwo+ICt9Cj4gKwo+ICAgc3RhdGljIHZvaWQg
ZXJyX2NvbXByZXNzaW9uX21hcmtlcihzdHJ1Y3QgZHJtX2k5MTVfZXJyb3Jfc3RhdGVfYnVmICpt
KQo+ICAgewo+ICAgCWVycl9wdXRzKG0sICJ+Iik7Cj4gQEAgLTM3OSwzNiArNDU0LDYgQEAgc3Rh
dGljIHZvaWQgZXJyX2NvbXByZXNzaW9uX21hcmtlcihzdHJ1Y3QgZHJtX2k5MTVfZXJyb3Jfc3Rh
dGVfYnVmICptKQo+ICAgCj4gICAjZW5kaWYKPiAgIAo+IC1zdGF0aWMgdm9pZCBwcmludF9lcnJv
cl9idWZmZXJzKHN0cnVjdCBkcm1faTkxNV9lcnJvcl9zdGF0ZV9idWYgKm0sCj4gLQkJCQljb25z
dCBjaGFyICpuYW1lLAo+IC0JCQkJc3RydWN0IGRybV9pOTE1X2Vycm9yX2J1ZmZlciAqZXJyLAo+
IC0JCQkJaW50IGNvdW50KQo+IC17Cj4gLQllcnJfcHJpbnRmKG0sICIlcyBbJWRdOlxuIiwgbmFt
ZSwgY291bnQpOwo+IC0KPiAtCXdoaWxlIChjb3VudC0tKSB7Cj4gLQkJZXJyX3ByaW50ZihtLCAi
ICAgICUwOHhfJTA4eCAlOHUgJTAyeCAlMDJ4IiwKPiAtCQkJICAgdXBwZXJfMzJfYml0cyhlcnIt
Pmd0dF9vZmZzZXQpLAo+IC0JCQkgICBsb3dlcl8zMl9iaXRzKGVyci0+Z3R0X29mZnNldCksCj4g
LQkJCSAgIGVyci0+c2l6ZSwKPiAtCQkJICAgZXJyLT5yZWFkX2RvbWFpbnMsCj4gLQkJCSAgIGVy
ci0+d3JpdGVfZG9tYWluKTsKPiAtCQllcnJfcHV0cyhtLCB0aWxpbmdfZmxhZyhlcnItPnRpbGlu
ZykpOwo+IC0JCWVycl9wdXRzKG0sIGRpcnR5X2ZsYWcoZXJyLT5kaXJ0eSkpOwo+IC0JCWVycl9w
dXRzKG0sIHB1cmdlYWJsZV9mbGFnKGVyci0+cHVyZ2VhYmxlKSk7Cj4gLQkJZXJyX3B1dHMobSwg
ZXJyLT51c2VycHRyID8gIiB1c2VycHRyIiA6ICIiKTsKPiAtCQllcnJfcHV0cyhtLCBpOTE1X2Nh
Y2hlX2xldmVsX3N0cihtLT5pOTE1LCBlcnItPmNhY2hlX2xldmVsKSk7Cj4gLQo+IC0JCWlmIChl
cnItPm5hbWUpCj4gLQkJCWVycl9wcmludGYobSwgIiAobmFtZTogJWQpIiwgZXJyLT5uYW1lKTsK
PiAtCQlpZiAoZXJyLT5mZW5jZV9yZWcgIT0gSTkxNV9GRU5DRV9SRUdfTk9ORSkKPiAtCQkJZXJy
X3ByaW50ZihtLCAiIChmZW5jZTogJWQpIiwgZXJyLT5mZW5jZV9yZWcpOwo+IC0KPiAtCQllcnJf
cHV0cyhtLCAiXG4iKTsKPiAtCQllcnIrKzsKPiAtCX0KPiAtfQoKU28gbm8gYWN0aXZlIGFuZCBw
aW5uZWQgYm9zIGFueSBtb3JlLgoKQ2EgeW91IHB1dCBpbiB0aGUgY29tbWl0IG1lc3NhZ2Ugd2hh
dCBkYXRhIGlzIGdvbmUgYW5kIHdoYXQgcmVtYWlucz8gQW5kIApzb21lIG5vdGVzIG9uIGhvdyBk
b2VzIHRoYXQgYWZmZWN0IHRoZSB1c2VmdWxuZXNzIG9mIGVycm9yIHN0YXRlLgoKUmVnYXJkcywK
ClR2cnRrbwoKPiAtCj4gICBzdGF0aWMgdm9pZCBlcnJvcl9wcmludF9pbnN0ZG9uZShzdHJ1Y3Qg
ZHJtX2k5MTVfZXJyb3Jfc3RhdGVfYnVmICptLAo+ICAgCQkJCSBjb25zdCBzdHJ1Y3QgZHJtX2k5
MTVfZXJyb3JfZW5naW5lICplZSkKPiAgIHsKPiBAQCAtNzM0LDMzICs3NzksNiBAQCBzdGF0aWMg
dm9pZCBfX2Vycl9wcmludF90b19zZ2woc3RydWN0IGRybV9pOTE1X2Vycm9yX3N0YXRlX2J1ZiAq
bSwKPiAgIAkJCWVycm9yX3ByaW50X2VuZ2luZShtLCAmZXJyb3ItPmVuZ2luZVtpXSwgZXJyb3It
PmVwb2NoKTsKPiAgIAl9Cj4gICAKPiAtCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGVycm9y
LT5hY3RpdmVfdm0pOyBpKyspIHsKPiAtCQljaGFyIGJ1ZlsxMjhdOwo+IC0JCWludCBsZW4sIGZp
cnN0ID0gMTsKPiAtCj4gLQkJaWYgKCFlcnJvci0+YWN0aXZlX3ZtW2ldKQo+IC0JCQlicmVhazsK
PiAtCj4gLQkJbGVuID0gc2NucHJpbnRmKGJ1Ziwgc2l6ZW9mKGJ1ZiksICJBY3RpdmUgKCIpOwo+
IC0JCWZvciAoaiA9IDA7IGogPCBBUlJBWV9TSVpFKGVycm9yLT5lbmdpbmUpOyBqKyspIHsKPiAt
CQkJaWYgKGVycm9yLT5lbmdpbmVbal0udm0gIT0gZXJyb3ItPmFjdGl2ZV92bVtpXSkKPiAtCQkJ
CWNvbnRpbnVlOwo+IC0KPiAtCQkJbGVuICs9IHNjbnByaW50ZihidWYgKyBsZW4sIHNpemVvZihi
dWYpLCAiJXMlcyIsCj4gLQkJCQkJIGZpcnN0ID8gIiIgOiAiLCAiLAo+IC0JCQkJCSBtLT5pOTE1
LT5lbmdpbmVbal0tPm5hbWUpOwo+IC0JCQlmaXJzdCA9IDA7Cj4gLQkJfQo+IC0JCXNjbnByaW50
ZihidWYgKyBsZW4sIHNpemVvZihidWYpLCAiKSIpOwo+IC0JCXByaW50X2Vycm9yX2J1ZmZlcnMo
bSwgYnVmLAo+IC0JCQkJICAgIGVycm9yLT5hY3RpdmVfYm9baV0sCj4gLQkJCQkgICAgZXJyb3It
PmFjdGl2ZV9ib19jb3VudFtpXSk7Cj4gLQl9Cj4gLQo+IC0JcHJpbnRfZXJyb3JfYnVmZmVycyht
LCAiUGlubmVkIChnbG9iYWwpIiwKPiAtCQkJICAgIGVycm9yLT5waW5uZWRfYm8sCj4gLQkJCSAg
ICBlcnJvci0+cGlubmVkX2JvX2NvdW50KTsKPiAtCj4gICAJZm9yIChpID0gMDsgaSA8IEFSUkFZ
X1NJWkUoZXJyb3ItPmVuZ2luZSk7IGkrKykgewo+ICAgCQljb25zdCBzdHJ1Y3QgZHJtX2k5MTVf
ZXJyb3JfZW5naW5lICplZSA9ICZlcnJvci0+ZW5naW5lW2ldOwo+ICAgCj4gQEAgLTk3NCwxMCAr
OTkyLDYgQEAgdm9pZCBfX2k5MTVfZ3B1X3N0YXRlX2ZyZWUoc3RydWN0IGtyZWYgKmVycm9yX3Jl
ZikKPiAgIAkJa2ZyZWUoZWUtPnJlcXVlc3RzKTsKPiAgIAl9Cj4gICAKPiAtCWZvciAoaSA9IDA7
IGkgPCBBUlJBWV9TSVpFKGVycm9yLT5hY3RpdmVfYm8pOyBpKyspCj4gLQkJa2ZyZWUoZXJyb3It
PmFjdGl2ZV9ib1tpXSk7Cj4gLQlrZnJlZShlcnJvci0+cGlubmVkX2JvKTsKPiAtCj4gICAJa2Zy
ZWUoZXJyb3ItPm92ZXJsYXkpOwo+ICAgCWtmcmVlKGVycm9yLT5kaXNwbGF5KTsKPiAgIAo+IEBA
IC05OTAsMTIgKzEwMDQsMTIgQEAgdm9pZCBfX2k5MTVfZ3B1X3N0YXRlX2ZyZWUoc3RydWN0IGty
ZWYgKmVycm9yX3JlZikKPiAgIAo+ICAgc3RhdGljIHN0cnVjdCBkcm1faTkxNV9lcnJvcl9vYmpl
Y3QgKgo+ICAgaTkxNV9lcnJvcl9vYmplY3RfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAo+IC0JCQkgc3RydWN0IGk5MTVfdm1hICp2bWEpCj4gKwkJCSBzdHJ1Y3QgaTkxNV92
bWEgKnZtYSwKPiArCQkJIHN0cnVjdCBjb21wcmVzcyAqY29tcHJlc3MpCj4gICB7Cj4gICAJc3Ry
dWN0IGk5MTVfZ2d0dCAqZ2d0dCA9ICZpOTE1LT5nZ3R0Owo+ICAgCWNvbnN0IHU2NCBzbG90ID0g
Z2d0dC0+ZXJyb3JfY2FwdHVyZS5zdGFydDsKPiAgIAlzdHJ1Y3QgZHJtX2k5MTVfZXJyb3Jfb2Jq
ZWN0ICpkc3Q7Cj4gLQlzdHJ1Y3QgY29tcHJlc3MgY29tcHJlc3M7Cj4gICAJdW5zaWduZWQgbG9u
ZyBudW1fcGFnZXM7Cj4gICAJc3RydWN0IHNndF9pdGVyIGl0ZXI7Cj4gICAJZG1hX2FkZHJfdCBk
bWE7Cj4gQEAgLTEwMDYsMjIgKzEwMjAsMjEgQEAgaTkxNV9lcnJvcl9vYmplY3RfY3JlYXRlKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAo+ICAgCj4gICAJbnVtX3BhZ2VzID0gbWluX3Qo
dTY0LCB2bWEtPnNpemUsIHZtYS0+b2JqLT5iYXNlLnNpemUpID4+IFBBR0VfU0hJRlQ7Cj4gICAJ
bnVtX3BhZ2VzID0gRElWX1JPVU5EX1VQKDEwICogbnVtX3BhZ2VzLCA4KTsgLyogd29yc3RjYXNl
IHpsaWIgZ3Jvd3RoICovCj4gLQlkc3QgPSBrbWFsbG9jKHNpemVvZigqZHN0KSArIG51bV9wYWdl
cyAqIHNpemVvZih1MzIgKiksCj4gLQkJICAgICAgR0ZQX0FUT01JQyB8IF9fR0ZQX05PV0FSTik7
Cj4gKwlkc3QgPSBrbWFsbG9jKHNpemVvZigqZHN0KSArIG51bV9wYWdlcyAqIHNpemVvZih1MzIg
KiksIEFUT01JQ19NQVlGQUlMKTsKPiAgIAlpZiAoIWRzdCkKPiAgIAkJcmV0dXJuIE5VTEw7Cj4g
ICAKPiArCWlmICghY29tcHJlc3Nfc3RhcnQoY29tcHJlc3MpKSB7Cj4gKwkJa2ZyZWUoZHN0KTsK
PiArCQlyZXR1cm4gTlVMTDsKPiArCX0KPiArCj4gICAJZHN0LT5ndHRfb2Zmc2V0ID0gdm1hLT5u
b2RlLnN0YXJ0Owo+ICAgCWRzdC0+Z3R0X3NpemUgPSB2bWEtPm5vZGUuc2l6ZTsKPiAgIAlkc3Qt
Pm51bV9wYWdlcyA9IG51bV9wYWdlczsKPiAgIAlkc3QtPnBhZ2VfY291bnQgPSAwOwo+ICAgCWRz
dC0+dW51c2VkID0gMDsKPiAgIAo+IC0JaWYgKCFjb21wcmVzc19pbml0KCZjb21wcmVzcykpIHsK
PiAtCQlrZnJlZShkc3QpOwo+IC0JCXJldHVybiBOVUxMOwo+IC0JfQo+IC0KPiAgIAlyZXQgPSAt
RUlOVkFMOwo+ICAgCWZvcl9lYWNoX3NndF9kbWEoZG1hLCBpdGVyLCB2bWEtPnBhZ2VzKSB7Cj4g
ICAJCXZvaWQgX19pb21lbSAqczsKPiBAQCAtMTAyOSw2OSArMTA0MiwyMyBAQCBpOTE1X2Vycm9y
X29iamVjdF9jcmVhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCj4gICAJCWdndHQt
PnZtLmluc2VydF9wYWdlKCZnZ3R0LT52bSwgZG1hLCBzbG90LCBJOTE1X0NBQ0hFX05PTkUsIDAp
Owo+ICAgCj4gICAJCXMgPSBpb19tYXBwaW5nX21hcF9hdG9taWNfd2MoJmdndHQtPmlvbWFwLCBz
bG90KTsKPiAtCQlyZXQgPSBjb21wcmVzc19wYWdlKCZjb21wcmVzcywgKHZvaWQgIF9fZm9yY2Ug
KilzLCBkc3QpOwo+ICsJCXJldCA9IGNvbXByZXNzX3BhZ2UoY29tcHJlc3MsICh2b2lkICBfX2Zv
cmNlICopcywgZHN0KTsKPiAgIAkJaW9fbWFwcGluZ191bm1hcF9hdG9taWMocyk7Cj4gICAJCWlm
IChyZXQpCj4gICAJCQlicmVhazsKPiAgIAl9Cj4gICAKPiAtCWlmIChyZXQgfHwgY29tcHJlc3Nf
Zmx1c2goJmNvbXByZXNzLCBkc3QpKSB7Cj4gKwlpZiAocmV0IHx8IGNvbXByZXNzX2ZsdXNoKGNv
bXByZXNzLCBkc3QpKSB7Cj4gICAJCXdoaWxlIChkc3QtPnBhZ2VfY291bnQtLSkKPiAtCQkJZnJl
ZV9wYWdlKCh1bnNpZ25lZCBsb25nKWRzdC0+cGFnZXNbZHN0LT5wYWdlX2NvdW50XSk7Cj4gKwkJ
CXBvb2xfZnJlZSgmY29tcHJlc3MtPnBvb2wsIGRzdC0+cGFnZXNbZHN0LT5wYWdlX2NvdW50XSk7
Cj4gICAJCWtmcmVlKGRzdCk7Cj4gICAJCWRzdCA9IE5VTEw7Cj4gICAJfQo+ICsJY29tcHJlc3Nf
ZmluaXNoKGNvbXByZXNzKTsKPiAgIAo+IC0JY29tcHJlc3NfZmluaSgmY29tcHJlc3MsIGRzdCk7
Cj4gICAJcmV0dXJuIGRzdDsKPiAgIH0KPiAgIAo+IC1zdGF0aWMgdm9pZCBjYXB0dXJlX2JvKHN0
cnVjdCBkcm1faTkxNV9lcnJvcl9idWZmZXIgKmVyciwKPiAtCQkgICAgICAgc3RydWN0IGk5MTVf
dm1hICp2bWEpCj4gLXsKPiAtCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB2bWEt
Pm9iajsKPiAtCj4gLQllcnItPnNpemUgPSBvYmotPmJhc2Uuc2l6ZTsKPiAtCWVyci0+bmFtZSA9
IG9iai0+YmFzZS5uYW1lOwo+IC0KPiAtCWVyci0+Z3R0X29mZnNldCA9IHZtYS0+bm9kZS5zdGFy
dDsKPiAtCWVyci0+cmVhZF9kb21haW5zID0gb2JqLT5yZWFkX2RvbWFpbnM7Cj4gLQllcnItPndy
aXRlX2RvbWFpbiA9IG9iai0+d3JpdGVfZG9tYWluOwo+IC0JZXJyLT5mZW5jZV9yZWcgPSB2bWEt
PmZlbmNlID8gdm1hLT5mZW5jZS0+aWQgOiAtMTsKPiAtCWVyci0+dGlsaW5nID0gaTkxNV9nZW1f
b2JqZWN0X2dldF90aWxpbmcob2JqKTsKPiAtCWVyci0+ZGlydHkgPSBvYmotPm1tLmRpcnR5Owo+
IC0JZXJyLT5wdXJnZWFibGUgPSBvYmotPm1tLm1hZHYgIT0gSTkxNV9NQURWX1dJTExORUVEOwo+
IC0JZXJyLT51c2VycHRyID0gb2JqLT51c2VycHRyLm1tICE9IE5VTEw7Cj4gLQllcnItPmNhY2hl
X2xldmVsID0gb2JqLT5jYWNoZV9sZXZlbDsKPiAtfQo+IC0KPiAtc3RhdGljIHUzMiBjYXB0dXJl
X2Vycm9yX2JvKHN0cnVjdCBkcm1faTkxNV9lcnJvcl9idWZmZXIgKmVyciwKPiAtCQkJICAgIGlu
dCBjb3VudCwgc3RydWN0IGxpc3RfaGVhZCAqaGVhZCwKPiAtCQkJICAgIHVuc2lnbmVkIGludCBm
bGFncykKPiAtI2RlZmluZSBBQ1RJVkVfT05MWSBCSVQoMCkKPiAtI2RlZmluZSBQSU5ORURfT05M
WSBCSVQoMSkKPiAtewo+IC0Jc3RydWN0IGk5MTVfdm1hICp2bWE7Cj4gLQlpbnQgaSA9IDA7Cj4g
LQo+IC0JbGlzdF9mb3JfZWFjaF9lbnRyeSh2bWEsIGhlYWQsIHZtX2xpbmspIHsKPiAtCQlpZiAo
IXZtYS0+b2JqKQo+IC0JCQljb250aW51ZTsKPiAtCj4gLQkJaWYgKGZsYWdzICYgQUNUSVZFX09O
TFkgJiYgIWk5MTVfdm1hX2lzX2FjdGl2ZSh2bWEpKQo+IC0JCQljb250aW51ZTsKPiAtCj4gLQkJ
aWYgKGZsYWdzICYgUElOTkVEX09OTFkgJiYgIWk5MTVfdm1hX2lzX3Bpbm5lZCh2bWEpKQo+IC0J
CQljb250aW51ZTsKPiAtCj4gLQkJY2FwdHVyZV9ibyhlcnIrKywgdm1hKTsKPiAtCQlpZiAoKytp
ID09IGNvdW50KQo+IC0JCQlicmVhazsKPiAtCX0KPiAtCj4gLQlyZXR1cm4gaTsKPiAtfQo+IC0K
PiAgIC8qCj4gICAgKiBHZW5lcmF0ZSBhIHNlbWktdW5pcXVlIGVycm9yIGNvZGUuIFRoZSBjb2Rl
IGlzIG5vdCBtZWFudCB0byBoYXZlIG1lYW5pbmcsIFRoZQo+ICAgICogY29kZSdzIG9ubHkgcHVy
cG9zZSBpcyB0byB0cnkgdG8gcHJldmVudCBmYWxzZSBkdXBsaWNhdGVkIGJ1ZyByZXBvcnRzIGJ5
Cj4gQEAgLTEyODEsNyArMTI0OCw3IEBAIHN0YXRpYyB2b2lkIGVuZ2luZV9yZWNvcmRfcmVxdWVz
dHMoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAo+ICAgCWlmICghY291bnQpCj4gICAJ
CXJldHVybjsKPiAgIAo+IC0JZWUtPnJlcXVlc3RzID0ga2NhbGxvYyhjb3VudCwgc2l6ZW9mKCpl
ZS0+cmVxdWVzdHMpLCBHRlBfQVRPTUlDKTsKPiArCWVlLT5yZXF1ZXN0cyA9IGtjYWxsb2MoY291
bnQsIHNpemVvZigqZWUtPnJlcXVlc3RzKSwgQVRPTUlDX01BWUZBSUwpOwo+ICAgCWlmICghZWUt
PnJlcXVlc3RzKQo+ICAgCQlyZXR1cm47Cj4gICAKPiBAQCAtMTM0OSw4ICsxMzE2LDEwIEBAIHN0
YXRpYyB2b2lkIHJlY29yZF9jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9lcnJvcl9jb250ZXh0ICpl
LAo+ICAgCWUtPmFjdGl2ZSA9IGF0b21pY19yZWFkKCZjdHgtPmFjdGl2ZV9jb3VudCk7Cj4gICB9
Cj4gICAKPiAtc3RhdGljIHZvaWQgcmVxdWVzdF9yZWNvcmRfdXNlcl9ibyhzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpyZXF1ZXN0LAo+IC0JCQkJICAgc3RydWN0IGRybV9pOTE1X2Vycm9yX2VuZ2luZSAq
ZWUpCj4gK3N0YXRpYyB2b2lkCj4gK3JlcXVlc3RfcmVjb3JkX3VzZXJfYm8oc3RydWN0IGk5MTVf
cmVxdWVzdCAqcmVxdWVzdCwKPiArCQkgICAgICAgc3RydWN0IGRybV9pOTE1X2Vycm9yX2VuZ2lu
ZSAqZWUsCj4gKwkJICAgICAgIHN0cnVjdCBjb21wcmVzcyAqY29tcHJlc3MpCj4gICB7Cj4gICAJ
c3RydWN0IGk5MTVfY2FwdHVyZV9saXN0ICpjOwo+ICAgCXN0cnVjdCBkcm1faTkxNV9lcnJvcl9v
YmplY3QgKipibzsKPiBAQCAtMTM2MiwxOCArMTMzMSwyMCBAQCBzdGF0aWMgdm9pZCByZXF1ZXN0
X3JlY29yZF91c2VyX2JvKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QsCj4gICAJaWYgKCFt
YXgpCj4gICAJCXJldHVybjsKPiAgIAo+IC0JYm8gPSBrbWFsbG9jX2FycmF5KG1heCwgc2l6ZW9m
KCpibyksIEdGUF9BVE9NSUMpOwo+ICsJYm8gPSBrbWFsbG9jX2FycmF5KG1heCwgc2l6ZW9mKCpi
byksIEFUT01JQ19NQVlGQUlMKTsKPiAgIAlpZiAoIWJvKSB7Cj4gICAJCS8qIElmIHdlIGNhbid0
IGNhcHR1cmUgZXZlcnl0aGluZywgdHJ5IHRvIGNhcHR1cmUgc29tZXRoaW5nLiAqLwo+ICAgCQlt
YXggPSBtaW5fdChsb25nLCBtYXgsIFBBR0VfU0laRSAvIHNpemVvZigqYm8pKTsKPiAtCQlibyA9
IGttYWxsb2NfYXJyYXkobWF4LCBzaXplb2YoKmJvKSwgR0ZQX0FUT01JQyk7Cj4gKwkJYm8gPSBr
bWFsbG9jX2FycmF5KG1heCwgc2l6ZW9mKCpibyksIEFUT01JQ19NQVlGQUlMKTsKPiAgIAl9Cj4g
ICAJaWYgKCFibykKPiAgIAkJcmV0dXJuOwo+ICAgCj4gICAJY291bnQgPSAwOwo+ICAgCWZvciAo
YyA9IHJlcXVlc3QtPmNhcHR1cmVfbGlzdDsgYzsgYyA9IGMtPm5leHQpIHsKPiAtCQlib1tjb3Vu
dF0gPSBpOTE1X2Vycm9yX29iamVjdF9jcmVhdGUocmVxdWVzdC0+aTkxNSwgYy0+dm1hKTsKPiAr
CQlib1tjb3VudF0gPSBpOTE1X2Vycm9yX29iamVjdF9jcmVhdGUocmVxdWVzdC0+aTkxNSwKPiAr
CQkJCQkJICAgICBjLT52bWEsCj4gKwkJCQkJCSAgICAgY29tcHJlc3MpOwo+ICAgCQlpZiAoIWJv
W2NvdW50XSkKPiAgIAkJCWJyZWFrOwo+ICAgCQlpZiAoKytjb3VudCA9PSBtYXgpCj4gQEAgLTEz
ODYsNyArMTM1Nyw4IEBAIHN0YXRpYyB2b2lkIHJlcXVlc3RfcmVjb3JkX3VzZXJfYm8oc3RydWN0
IGk5MTVfcmVxdWVzdCAqcmVxdWVzdCwKPiAgIAo+ICAgc3RhdGljIHN0cnVjdCBkcm1faTkxNV9l
cnJvcl9vYmplY3QgKgo+ICAgY2FwdHVyZV9vYmplY3Qoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAo+IC0JICAgICAgIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCj4g
KwkgICAgICAgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKPiArCSAgICAgICBzdHJ1
Y3QgY29tcHJlc3MgKmNvbXByZXNzKQo+ICAgewo+ICAgCWlmIChvYmogJiYgaTkxNV9nZW1fb2Jq
ZWN0X2hhc19wYWdlcyhvYmopKSB7Cj4gICAJCXN0cnVjdCBpOTE1X3ZtYSBmYWtlID0gewo+IEBA
IC0xMzk2LDEzICsxMzY4LDE0IEBAIGNhcHR1cmVfb2JqZWN0KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKPiAgIAkJCS5vYmogPSBvYmosCj4gICAJCX07Cj4gICAKPiAtCQlyZXR1
cm4gaTkxNV9lcnJvcl9vYmplY3RfY3JlYXRlKGRldl9wcml2LCAmZmFrZSk7Cj4gKwkJcmV0dXJu
IGk5MTVfZXJyb3Jfb2JqZWN0X2NyZWF0ZShkZXZfcHJpdiwgJmZha2UsIGNvbXByZXNzKTsKPiAg
IAl9IGVsc2Ugewo+ICAgCQlyZXR1cm4gTlVMTDsKPiAgIAl9Cj4gICB9Cj4gICAKPiAtc3RhdGlj
IHZvaWQgZ2VtX3JlY29yZF9yaW5ncyhzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKmVycm9yKQo+ICtz
dGF0aWMgdm9pZAo+ICtnZW1fcmVjb3JkX3JpbmdzKHN0cnVjdCBpOTE1X2dwdV9zdGF0ZSAqZXJy
b3IsIHN0cnVjdCBjb21wcmVzcyAqY29tcHJlc3MpCj4gICB7Cj4gICAJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSBlcnJvci0+aTkxNTsKPiAgIAlpbnQgaTsKPiBAQCAtMTQyMCw2ICsx
MzkzLDkgQEAgc3RhdGljIHZvaWQgZ2VtX3JlY29yZF9yaW5ncyhzdHJ1Y3QgaTkxNV9ncHVfc3Rh
dGUgKmVycm9yKQo+ICAgCj4gICAJCWVlLT5lbmdpbmVfaWQgPSBpOwo+ICAgCj4gKwkJLyogUmVm
aWxsIG91ciBwYWdlIHBvb2wgYmVmb3JlIGVudGVyaW5nIGF0b21pYyBzZWN0aW9uICovCj4gKwkJ
cG9vbF9yZWZpbGwoJmNvbXByZXNzLT5wb29sLCBBTExPV19GQUlMKTsKPiArCj4gICAJCWVycm9y
X3JlY29yZF9lbmdpbmVfcmVnaXN0ZXJzKGVycm9yLCBlbmdpbmUsIGVlKTsKPiAgIAkJZXJyb3Jf
cmVjb3JkX2VuZ2luZV9leGVjbGlzdHMoZW5naW5lLCBlZSk7Cj4gICAKPiBAQCAtMTQyOSw4ICsx
NDA1LDYgQEAgc3RhdGljIHZvaWQgZ2VtX3JlY29yZF9yaW5ncyhzdHJ1Y3QgaTkxNV9ncHVfc3Rh
dGUgKmVycm9yKQo+ICAgCQkJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IHJlcXVlc3Qt
PmdlbV9jb250ZXh0Owo+ICAgCQkJc3RydWN0IGludGVsX3JpbmcgKnJpbmcgPSByZXF1ZXN0LT5y
aW5nOwo+ICAgCj4gLQkJCWVlLT52bSA9IGN0eC0+dm0gPzogJmVuZ2luZS0+Z3QtPmdndHQtPnZt
Owo+IC0KPiAgIAkJCXJlY29yZF9jb250ZXh0KCZlZS0+Y29udGV4dCwgY3R4KTsKPiAgIAo+ICAg
CQkJLyogV2UgbmVlZCB0byBjb3B5IHRoZXNlIHRvIGFuIGFub255bW91cyBidWZmZXIKPiBAQCAt
MTQzOCwxNyArMTQxMiwyMSBAQCBzdGF0aWMgdm9pZCBnZW1fcmVjb3JkX3JpbmdzKHN0cnVjdCBp
OTE1X2dwdV9zdGF0ZSAqZXJyb3IpCj4gICAJCQkgKiBieSB1c2Vyc3BhY2UuCj4gICAJCQkgKi8K
PiAgIAkJCWVlLT5iYXRjaGJ1ZmZlciA9Cj4gLQkJCQlpOTE1X2Vycm9yX29iamVjdF9jcmVhdGUo
aTkxNSwgcmVxdWVzdC0+YmF0Y2gpOwo+ICsJCQkJaTkxNV9lcnJvcl9vYmplY3RfY3JlYXRlKGk5
MTUsCj4gKwkJCQkJCQkgcmVxdWVzdC0+YmF0Y2gsCj4gKwkJCQkJCQkgY29tcHJlc3MpOwo+ICAg
Cj4gICAJCQlpZiAoSEFTX0JST0tFTl9DU19UTEIoaTkxNSkpCj4gICAJCQkJZWUtPndhX2JhdGNo
YnVmZmVyID0KPiAgIAkJCQkgIGk5MTVfZXJyb3Jfb2JqZWN0X2NyZWF0ZShpOTE1LAo+IC0JCQkJ
CQkJICAgZW5naW5lLT5ndC0+c2NyYXRjaCk7Cj4gLQkJCXJlcXVlc3RfcmVjb3JkX3VzZXJfYm8o
cmVxdWVzdCwgZWUpOwo+ICsJCQkJCQkJICAgZW5naW5lLT5ndC0+c2NyYXRjaCwKPiArCQkJCQkJ
CSAgIGNvbXByZXNzKTsKPiArCQkJcmVxdWVzdF9yZWNvcmRfdXNlcl9ibyhyZXF1ZXN0LCBlZSwg
Y29tcHJlc3MpOwo+ICAgCj4gICAJCQllZS0+Y3R4ID0KPiAgIAkJCQlpOTE1X2Vycm9yX29iamVj
dF9jcmVhdGUoaTkxNSwKPiAtCQkJCQkJCSByZXF1ZXN0LT5od19jb250ZXh0LT5zdGF0ZSk7Cj4g
KwkJCQkJCQkgcmVxdWVzdC0+aHdfY29udGV4dC0+c3RhdGUsCj4gKwkJCQkJCQkgY29tcHJlc3Mp
Owo+ICAgCj4gICAJCQllcnJvci0+c2ltdWxhdGVkIHw9Cj4gICAJCQkJaTkxNV9nZW1fY29udGV4
dF9ub19lcnJvcl9jYXB0dXJlKGN0eCk7Cj4gQEAgLTE0NjAsNyArMTQzOCw5IEBAIHN0YXRpYyB2
b2lkIGdlbV9yZWNvcmRfcmluZ3Moc3RydWN0IGk5MTVfZ3B1X3N0YXRlICplcnJvcikKPiAgIAkJ
CWVlLT5jcHVfcmluZ19oZWFkID0gcmluZy0+aGVhZDsKPiAgIAkJCWVlLT5jcHVfcmluZ190YWls
ID0gcmluZy0+dGFpbDsKPiAgIAkJCWVlLT5yaW5nYnVmZmVyID0KPiAtCQkJCWk5MTVfZXJyb3Jf
b2JqZWN0X2NyZWF0ZShpOTE1LCByaW5nLT52bWEpOwo+ICsJCQkJaTkxNV9lcnJvcl9vYmplY3Rf
Y3JlYXRlKGk5MTUsCj4gKwkJCQkJCQkgcmluZy0+dm1hLAo+ICsJCQkJCQkJIGNvbXByZXNzKTsK
PiAgIAo+ICAgCQkJZW5naW5lX3JlY29yZF9yZXF1ZXN0cyhlbmdpbmUsIHJlcXVlc3QsIGVlKTsK
PiAgIAkJfQo+IEBAIC0xNDY4LDg5ICsxNDQ4LDIxIEBAIHN0YXRpYyB2b2lkIGdlbV9yZWNvcmRf
cmluZ3Moc3RydWN0IGk5MTVfZ3B1X3N0YXRlICplcnJvcikKPiAgIAo+ICAgCQllZS0+aHdzX3Bh
Z2UgPQo+ICAgCQkJaTkxNV9lcnJvcl9vYmplY3RfY3JlYXRlKGk5MTUsCj4gLQkJCQkJCSBlbmdp
bmUtPnN0YXR1c19wYWdlLnZtYSk7Cj4gLQo+IC0JCWVlLT53YV9jdHggPSBpOTE1X2Vycm9yX29i
amVjdF9jcmVhdGUoaTkxNSwgZW5naW5lLT53YV9jdHgudm1hKTsKPiAtCj4gLQkJZWUtPmRlZmF1
bHRfc3RhdGUgPSBjYXB0dXJlX29iamVjdChpOTE1LCBlbmdpbmUtPmRlZmF1bHRfc3RhdGUpOwo+
IC0JfQo+IC19Cj4gLQo+IC1zdGF0aWMgdm9pZCBnZW1fY2FwdHVyZV92bShzdHJ1Y3QgaTkxNV9n
cHVfc3RhdGUgKmVycm9yLAo+IC0JCQkgICBzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwK
PiAtCQkJICAgaW50IGlkeCkKPiAtewo+IC0Jc3RydWN0IGRybV9pOTE1X2Vycm9yX2J1ZmZlciAq
YWN0aXZlX2JvOwo+IC0Jc3RydWN0IGk5MTVfdm1hICp2bWE7Cj4gLQlpbnQgY291bnQ7Cj4gLQo+
IC0JY291bnQgPSAwOwo+IC0JbGlzdF9mb3JfZWFjaF9lbnRyeSh2bWEsICZ2bS0+Ym91bmRfbGlz
dCwgdm1fbGluaykKPiAtCQlpZiAoaTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpCj4gLQkJCWNvdW50
Kys7Cj4gLQo+IC0JYWN0aXZlX2JvID0gTlVMTDsKPiAtCWlmIChjb3VudCkKPiAtCQlhY3RpdmVf
Ym8gPSBrY2FsbG9jKGNvdW50LCBzaXplb2YoKmFjdGl2ZV9ibyksIEdGUF9BVE9NSUMpOwo+IC0J
aWYgKGFjdGl2ZV9ibykKPiAtCQljb3VudCA9IGNhcHR1cmVfZXJyb3JfYm8oYWN0aXZlX2JvLAo+
IC0JCQkJCSBjb3VudCwgJnZtLT5ib3VuZF9saXN0LAo+IC0JCQkJCSBBQ1RJVkVfT05MWSk7Cj4g
LQllbHNlCj4gLQkJY291bnQgPSAwOwo+ICsJCQkJCQkgZW5naW5lLT5zdGF0dXNfcGFnZS52bWEs
Cj4gKwkJCQkJCSBjb21wcmVzcyk7Cj4gICAKPiAtCWVycm9yLT5hY3RpdmVfdm1baWR4XSA9IHZt
Owo+IC0JZXJyb3ItPmFjdGl2ZV9ib1tpZHhdID0gYWN0aXZlX2JvOwo+IC0JZXJyb3ItPmFjdGl2
ZV9ib19jb3VudFtpZHhdID0gY291bnQ7Cj4gLX0KPiAtCj4gLXN0YXRpYyB2b2lkIGNhcHR1cmVf
YWN0aXZlX2J1ZmZlcnMoc3RydWN0IGk5MTVfZ3B1X3N0YXRlICplcnJvcikKPiAtewo+IC0JaW50
IGNudCA9IDAsIGksIGo7Cj4gLQo+IC0JQlVJTERfQlVHX09OKEFSUkFZX1NJWkUoZXJyb3ItPmVu
Z2luZSkgPiBBUlJBWV9TSVpFKGVycm9yLT5hY3RpdmVfYm8pKTsKPiAtCUJVSUxEX0JVR19PTihB
UlJBWV9TSVpFKGVycm9yLT5hY3RpdmVfYm8pICE9IEFSUkFZX1NJWkUoZXJyb3ItPmFjdGl2ZV92
bSkpOwo+IC0JQlVJTERfQlVHX09OKEFSUkFZX1NJWkUoZXJyb3ItPmFjdGl2ZV9ibykgIT0gQVJS
QVlfU0laRShlcnJvci0+YWN0aXZlX2JvX2NvdW50KSk7Cj4gLQo+IC0JLyogU2NhbiBlYWNoIGVu
Z2luZSBsb29raW5nIGZvciB1bmlxdWUgYWN0aXZlIGNvbnRleHRzL3ZtICovCj4gLQlmb3IgKGkg
PSAwOyBpIDwgQVJSQVlfU0laRShlcnJvci0+ZW5naW5lKTsgaSsrKSB7Cj4gLQkJc3RydWN0IGRy
bV9pOTE1X2Vycm9yX2VuZ2luZSAqZWUgPSAmZXJyb3ItPmVuZ2luZVtpXTsKPiAtCQlib29sIGZv
dW5kOwo+IC0KPiAtCQlpZiAoIWVlLT52bSkKPiAtCQkJY29udGludWU7Cj4gKwkJZWUtPndhX2N0
eCA9Cj4gKwkJCWk5MTVfZXJyb3Jfb2JqZWN0X2NyZWF0ZShpOTE1LAo+ICsJCQkJCQkgZW5naW5l
LT53YV9jdHgudm1hLAo+ICsJCQkJCQkgY29tcHJlc3MpOwo+ICAgCj4gLQkJZm91bmQgPSBmYWxz
ZTsKPiAtCQlmb3IgKGogPSAwOyBqIDwgaSAmJiAhZm91bmQ7IGorKykKPiAtCQkJZm91bmQgPSBl
cnJvci0+ZW5naW5lW2pdLnZtID09IGVlLT52bTsKPiAtCQlpZiAoIWZvdW5kKQo+IC0JCQlnZW1f
Y2FwdHVyZV92bShlcnJvciwgZWUtPnZtLCBjbnQrKyk7Cj4gKwkJZWUtPmRlZmF1bHRfc3RhdGUg
PQo+ICsJCQljYXB0dXJlX29iamVjdChpOTE1LCBlbmdpbmUtPmRlZmF1bHRfc3RhdGUsIGNvbXBy
ZXNzKTsKPiAgIAl9Cj4gICB9Cj4gICAKPiAtc3RhdGljIHZvaWQgY2FwdHVyZV9waW5uZWRfYnVm
ZmVycyhzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKmVycm9yKQo+IC17Cj4gLQlzdHJ1Y3QgaTkxNV9h
ZGRyZXNzX3NwYWNlICp2bSA9ICZlcnJvci0+aTkxNS0+Z2d0dC52bTsKPiAtCXN0cnVjdCBkcm1f
aTkxNV9lcnJvcl9idWZmZXIgKmJvOwo+IC0Jc3RydWN0IGk5MTVfdm1hICp2bWE7Cj4gLQlpbnQg
Y291bnQ7Cj4gLQo+IC0JY291bnQgPSAwOwo+IC0JbGlzdF9mb3JfZWFjaF9lbnRyeSh2bWEsICZ2
bS0+Ym91bmRfbGlzdCwgdm1fbGluaykKPiAtCQljb3VudCsrOwo+IC0KPiAtCWJvID0gTlVMTDsK
PiAtCWlmIChjb3VudCkKPiAtCQlibyA9IGtjYWxsb2MoY291bnQsIHNpemVvZigqYm8pLCBHRlBf
QVRPTUlDKTsKPiAtCWlmICghYm8pCj4gLQkJcmV0dXJuOwo+IC0KPiAtCWVycm9yLT5waW5uZWRf
Ym9fY291bnQgPQo+IC0JCWNhcHR1cmVfZXJyb3JfYm8oYm8sIGNvdW50LCAmdm0tPmJvdW5kX2xp
c3QsIFBJTk5FRF9PTkxZKTsKPiAtCWVycm9yLT5waW5uZWRfYm8gPSBibzsKPiAtfQo+IC0KPiAt
c3RhdGljIHZvaWQgY2FwdHVyZV91Y19zdGF0ZShzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKmVycm9y
KQo+ICtzdGF0aWMgdm9pZAo+ICtjYXB0dXJlX3VjX3N0YXRlKHN0cnVjdCBpOTE1X2dwdV9zdGF0
ZSAqZXJyb3IsIHN0cnVjdCBjb21wcmVzcyAqY29tcHJlc3MpCj4gICB7Cj4gICAJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBlcnJvci0+aTkxNTsKPiAgIAlzdHJ1Y3QgaTkxNV9lcnJv
cl91YyAqZXJyb3JfdWMgPSAmZXJyb3ItPnVjOwo+IEBAIC0xNTY3LDkgKzE0NzksMTEgQEAgc3Rh
dGljIHZvaWQgY2FwdHVyZV91Y19zdGF0ZShzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKmVycm9yKQo+
ICAgCSAqIEFzIG1vZHBhcmFtcyBhcmUgZ2VuZXJhbGx5IGFjY2VzaWJsZSBmcm9tIHRoZSB1c2Vy
c3BhY2UgbWFrZQo+ICAgCSAqIGV4cGxpY2l0IGNvcGllcyBvZiB0aGUgZmlybXdhcmUgcGF0aHMu
Cj4gICAJICovCj4gLQllcnJvcl91Yy0+Z3VjX2Z3LnBhdGggPSBrc3RyZHVwKHVjLT5ndWMuZncu
cGF0aCwgR0ZQX0FUT01JQyk7Cj4gLQllcnJvcl91Yy0+aHVjX2Z3LnBhdGggPSBrc3RyZHVwKHVj
LT5odWMuZncucGF0aCwgR0ZQX0FUT01JQyk7Cj4gLQllcnJvcl91Yy0+Z3VjX2xvZyA9IGk5MTVf
ZXJyb3Jfb2JqZWN0X2NyZWF0ZShpOTE1LCB1Yy0+Z3VjLmxvZy52bWEpOwo+ICsJZXJyb3JfdWMt
Pmd1Y19mdy5wYXRoID0ga3N0cmR1cCh1Yy0+Z3VjLmZ3LnBhdGgsIEFMTE9XX0ZBSUwpOwo+ICsJ
ZXJyb3JfdWMtPmh1Y19mdy5wYXRoID0ga3N0cmR1cCh1Yy0+aHVjLmZ3LnBhdGgsIEFMTE9XX0ZB
SUwpOwo+ICsJZXJyb3JfdWMtPmd1Y19sb2cgPSBpOTE1X2Vycm9yX29iamVjdF9jcmVhdGUoaTkx
NSwKPiArCQkJCQkJICAgICB1Yy0+Z3VjLmxvZy52bWEsCj4gKwkJCQkJCSAgICAgY29tcHJlc3Mp
Owo+ICAgfQo+ICAgCj4gICAvKiBDYXB0dXJlIGFsbCByZWdpc3RlcnMgd2hpY2ggZG9uJ3QgZml0
IGludG8gYW5vdGhlciBjYXRlZ29yeS4gKi8KPiBAQCAtMTc1Myw1NiArMTY2Nyw1MyBAQCBzdGF0
aWMgdm9pZCBjYXB0dXJlX2ZpbmlzaChzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKmVycm9yKQo+ICAg
CWdndHQtPnZtLmNsZWFyX3JhbmdlKCZnZ3R0LT52bSwgc2xvdCwgUEFHRV9TSVpFKTsKPiAgIH0K
PiAgIAo+IC1zdGF0aWMgaW50IGNhcHR1cmUodm9pZCAqZGF0YSkKPiAtewo+IC0Jc3RydWN0IGk5
MTVfZ3B1X3N0YXRlICplcnJvciA9IGRhdGE7Cj4gLQo+IC0JZXJyb3ItPnRpbWUgPSBrdGltZV9n
ZXRfcmVhbCgpOwo+IC0JZXJyb3ItPmJvb3R0aW1lID0ga3RpbWVfZ2V0X2Jvb3R0aW1lKCk7Cj4g
LQllcnJvci0+dXB0aW1lID0ga3RpbWVfc3ViKGt0aW1lX2dldCgpLAo+IC0JCQkJICBlcnJvci0+
aTkxNS0+Z3QubGFzdF9pbml0X3RpbWUpOwo+IC0JZXJyb3ItPmNhcHR1cmUgPSBqaWZmaWVzOwo+
IC0KPiAtCWNhcHR1cmVfcGFyYW1zKGVycm9yKTsKPiAtCWNhcHR1cmVfZ2VuX3N0YXRlKGVycm9y
KTsKPiAtCWNhcHR1cmVfdWNfc3RhdGUoZXJyb3IpOwo+IC0JY2FwdHVyZV9yZWdfc3RhdGUoZXJy
b3IpOwo+IC0JZ2VtX3JlY29yZF9mZW5jZXMoZXJyb3IpOwo+IC0JZ2VtX3JlY29yZF9yaW5ncyhl
cnJvcik7Cj4gLQljYXB0dXJlX2FjdGl2ZV9idWZmZXJzKGVycm9yKTsKPiAtCWNhcHR1cmVfcGlu
bmVkX2J1ZmZlcnMoZXJyb3IpOwo+IC0KPiAtCWVycm9yLT5vdmVybGF5ID0gaW50ZWxfb3Zlcmxh
eV9jYXB0dXJlX2Vycm9yX3N0YXRlKGVycm9yLT5pOTE1KTsKPiAtCWVycm9yLT5kaXNwbGF5ID0g
aW50ZWxfZGlzcGxheV9jYXB0dXJlX2Vycm9yX3N0YXRlKGVycm9yLT5pOTE1KTsKPiAtCj4gLQll
cnJvci0+ZXBvY2ggPSBjYXB0dXJlX2ZpbmRfZXBvY2goZXJyb3IpOwo+IC0KPiAtCWNhcHR1cmVf
ZmluaXNoKGVycm9yKTsKPiAtCXJldHVybiAwOwo+IC19Cj4gLQo+ICAgI2RlZmluZSBEQVlfQVNf
U0VDT05EUyh4KSAoMjQgKiA2MCAqIDYwICogKHgpKQo+ICAgCj4gICBzdHJ1Y3QgaTkxNV9ncHVf
c3RhdGUgKgo+ICAgaTkxNV9jYXB0dXJlX2dwdV9zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKPiAgIHsKPiAgIAlzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKmVycm9yOwo+ICsJc3Ry
dWN0IGNvbXByZXNzIGNvbXByZXNzOwo+ICAgCj4gICAJLyogQ2hlY2sgaWYgR1BVIGNhcHR1cmUg
aGFzIGJlZW4gZGlzYWJsZWQgKi8KPiAgIAllcnJvciA9IFJFQURfT05DRShpOTE1LT5ncHVfZXJy
b3IuZmlyc3RfZXJyb3IpOwo+ICAgCWlmIChJU19FUlIoZXJyb3IpKQo+ICAgCQlyZXR1cm4gZXJy
b3I7Cj4gICAKPiAtCWVycm9yID0ga3phbGxvYyhzaXplb2YoKmVycm9yKSwgR0ZQX0FUT01JQyk7
Cj4gKwllcnJvciA9IGt6YWxsb2Moc2l6ZW9mKCplcnJvciksIEFMTE9XX0ZBSUwpOwo+ICAgCWlm
ICghZXJyb3IpIHsKPiAgIAkJaTkxNV9kaXNhYmxlX2Vycm9yX3N0YXRlKGk5MTUsIC1FTk9NRU0p
Owo+ICAgCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKPiAgIAl9Cj4gICAKPiArCWlmICghY29t
cHJlc3NfaW5pdCgmY29tcHJlc3MpKSB7Cj4gKwkJa2ZyZWUoZXJyb3IpOwo+ICsJCWk5MTVfZGlz
YWJsZV9lcnJvcl9zdGF0ZShpOTE1LCAtRU5PTUVNKTsKPiArCQlyZXR1cm4gRVJSX1BUUigtRU5P
TUVNKTsKPiArCX0KPiArCj4gICAJa3JlZl9pbml0KCZlcnJvci0+cmVmKTsKPiAgIAllcnJvci0+
aTkxNSA9IGk5MTU7Cj4gICAKPiAtCXN0b3BfbWFjaGluZShjYXB0dXJlLCBlcnJvciwgTlVMTCk7
Cj4gKwllcnJvci0+dGltZSA9IGt0aW1lX2dldF9yZWFsKCk7Cj4gKwllcnJvci0+Ym9vdHRpbWUg
PSBrdGltZV9nZXRfYm9vdHRpbWUoKTsKPiArCWVycm9yLT51cHRpbWUgPSBrdGltZV9zdWIoa3Rp
bWVfZ2V0KCksIGk5MTUtPmd0Lmxhc3RfaW5pdF90aW1lKTsKPiArCWVycm9yLT5jYXB0dXJlID0g
amlmZmllczsKPiArCj4gKwljYXB0dXJlX3BhcmFtcyhlcnJvcik7Cj4gKwljYXB0dXJlX2dlbl9z
dGF0ZShlcnJvcik7Cj4gKwljYXB0dXJlX3VjX3N0YXRlKGVycm9yLCAmY29tcHJlc3MpOwo+ICsJ
Y2FwdHVyZV9yZWdfc3RhdGUoZXJyb3IpOwo+ICsJZ2VtX3JlY29yZF9mZW5jZXMoZXJyb3IpOwo+
ICsJZ2VtX3JlY29yZF9yaW5ncyhlcnJvciwgJmNvbXByZXNzKTsKPiArCj4gKwllcnJvci0+b3Zl
cmxheSA9IGludGVsX292ZXJsYXlfY2FwdHVyZV9lcnJvcl9zdGF0ZShpOTE1KTsKPiArCWVycm9y
LT5kaXNwbGF5ID0gaW50ZWxfZGlzcGxheV9jYXB0dXJlX2Vycm9yX3N0YXRlKGk5MTUpOwo+ICsK
PiArCWVycm9yLT5lcG9jaCA9IGNhcHR1cmVfZmluZF9lcG9jaChlcnJvcik7Cj4gKwo+ICsJY2Fw
dHVyZV9maW5pc2goZXJyb3IpOwo+ICsJY29tcHJlc3NfZmluaSgmY29tcHJlc3MpOwo+ICAgCj4g
ICAJcmV0dXJuIGVycm9yOwo+ICAgfQo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dwdV9lcnJvci5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3Iu
aAo+IGluZGV4IDg1ZjA2YmM1ZGEwNS4uYTI0YzM1MTA3ZDE2IDEwMDY0NAo+IC0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmgKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dwdV9lcnJvci5oCj4gQEAgLTg1LDcgKzg1LDYgQEAgc3RydWN0IGk5MTVfZ3B1
X3N0YXRlIHsKPiAgIAkJLyogU29mdHdhcmUgdHJhY2tlZCBzdGF0ZSAqLwo+ICAgCQlib29sIGlk
bGU7Cj4gICAJCXVuc2lnbmVkIGxvbmcgaGFuZ2NoZWNrX3RpbWVzdGFtcDsKPiAtCQlzdHJ1Y3Qg
aTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKPiAgIAkJaW50IG51bV9yZXF1ZXN0czsKPiAgIAkJdTMy
IHJlc2V0X2NvdW50Owo+ICAgCj4gQEAgLTE2MSwyMiArMTYwLDYgQEAgc3RydWN0IGk5MTVfZ3B1
X3N0YXRlIHsKPiAgIAkJfSB2bV9pbmZvOwo+ICAgCX0gZW5naW5lW0k5MTVfTlVNX0VOR0lORVNd
Owo+ICAgCj4gLQlzdHJ1Y3QgZHJtX2k5MTVfZXJyb3JfYnVmZmVyIHsKPiAtCQl1MzIgc2l6ZTsK
PiAtCQl1MzIgbmFtZTsKPiAtCQl1NjQgZ3R0X29mZnNldDsKPiAtCQl1MzIgcmVhZF9kb21haW5z
Owo+IC0JCXUzMiB3cml0ZV9kb21haW47Cj4gLQkJczMyIGZlbmNlX3JlZzpJOTE1X01BWF9OVU1f
RkVOQ0VfQklUUzsKPiAtCQl1MzIgdGlsaW5nOjI7Cj4gLQkJdTMyIGRpcnR5OjE7Cj4gLQkJdTMy
IHB1cmdlYWJsZToxOwo+IC0JCXUzMiB1c2VycHRyOjE7Cj4gLQkJdTMyIGNhY2hlX2xldmVsOjM7
Cj4gLQl9ICphY3RpdmVfYm9bSTkxNV9OVU1fRU5HSU5FU10sICpwaW5uZWRfYm87Cj4gLQl1MzIg
YWN0aXZlX2JvX2NvdW50W0k5MTVfTlVNX0VOR0lORVNdLCBwaW5uZWRfYm9fY291bnQ7Cj4gLQlz
dHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICphY3RpdmVfdm1bSTkxNV9OVU1fRU5HSU5FU107Cj4g
LQo+ICAgCXN0cnVjdCBzY2F0dGVybGlzdCAqc2dsLCAqZml0Owo+ICAgfTsKPiAgIAo+IApfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFp
bGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5m
cmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

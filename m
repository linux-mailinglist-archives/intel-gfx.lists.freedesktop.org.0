Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id EF5D11279A0
	for <lists+intel-gfx@lfdr.de>; Fri, 20 Dec 2019 11:50:18 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E009589DFB;
	Fri, 20 Dec 2019 10:50:14 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga09.intel.com (mga09.intel.com [134.134.136.24])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7423889DD3
 for <intel-gfx@lists.freedesktop.org>; Fri, 20 Dec 2019 10:50:09 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga003.jf.intel.com ([10.7.209.27])
 by orsmga102.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 20 Dec 2019 02:50:09 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,335,1571727600"; d="scan'208";a="218778105"
Received: from ideak-desk.fi.intel.com ([10.237.72.183])
 by orsmga003.jf.intel.com with ESMTP; 20 Dec 2019 02:50:06 -0800
From: Imre Deak <imre.deak@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 20 Dec 2019 12:49:30 +0200
Message-Id: <20191220104931.12135-6-imre.deak@intel.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20191218161105.30638-14-imre.deak@intel.com>
References: <20191218161105.30638-14-imre.deak@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 13/15] drm/i915/tgl: Gen-12 display can
 decompress surfaces compressed by the media engine
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Nanley G Chery <nanley.g.chery@intel.com>,
 Yang A Shi <yang.a.shi@intel.com>, Lucas De Marchi <lucas.demarchi@intel.com>,
 Dhinakaran Pandiyan <dhinakaran.pandiyan@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogRGhpbmFrYXJhbiBQYW5kaXlhbiA8ZGhpbmFrYXJhbi5wYW5kaXlhbkBpbnRlbC5jb20+
CgpEZXRlY3QgdGhlIG1vZGlmaWVyIGNvcnJlc3BvbmRpbmcgdG8gbWVkaWEgY29tcHJlc3Npb24g
dG8gZW5hYmxlCmRpc3BsYXkgZGVjb21wcmVzc2lvbiBmb3IgWVVWIGFuZCB4UkdCIHBhY2tlZCBm
b3JtYXRzLiBBIG5ldyBtb2RpZmllciBpcwphZGRlZCBzbyB0aGF0IHRoZSBkcml2ZXIgY2FuIGRp
c3Rpbmd1aXNoIGJldHdlZW4gbWVkaWEgYW5kIHJlbmRlcgpjb21wcmVzc2VkIGJ1ZmZlcnMuIFVu
bGlrZSByZW5kZXIgZGVjb21wcmVzc2lvbiwgcGxhbmUgNiBhbmQgIHBsYW5lIDcgZG8gbm90CnN1
cHBvcnQgbWVkaWEgZGVjb21wcmVzc2lvbi4KCnYyOiBGaXggY2hlY2twYXRjaCB3YXJuaW5ncyBv
biBjb2RlIHN0eWxlIChMdWNhcykKCkZyb20gREs6ClNlcGFyYXRlIG1vZGlmaWVyIGFycmF5IGZv
ciBwbGFuZXMgdGhhdCBjYW5ub3QgZGVjb21wcmVzcyBtZWRpYSAoVmlsbGUpCgp2MzogU3VwcG9y
dCBwbGFuYXIgZm9ybWF0cwp2NDogU3dpdGNoIHBsYW5lIG9yZGVyCnY1OgotIFVzZSBmb3JtYXQg
YmxvY2sgZGVzY3JpcHRvcnMgdG8gZ2V0IENDUyBzdWJzYW1wbGluZyBjYWxjdWxhdGlvbiByaWdo
dAogIGV2ZXJ5d2hlcmUuCi0gRXh0ZW5kIHRoZSBwbGFuZSBzdGF0ZSBub3JtYWwgdmlldyBhcnJh
eSB0byBhY2NvbW1vZGF0ZSA0IGNvbG9yIHBsYW5lcy4KLSBVc2UgaGVscGVycyB0byBjb252ZXJ0
IGJldHdlZW4gbWFpbiBhbmQgQ0NTIHBsYW5lcy4KdjY6IEFkZCBtaXNzaW5nIHBhY2tlZCBZVVYg
Zm9ybWF0cyB0byB0aGUgTUMgZm9ybWF0IGxpc3QuIChZYW5nKQoKQ2M6IE5hbmxleSBHIENoZXJ5
IDxuYW5sZXkuZy5jaGVyeUBpbnRlbC5jb20+CkNjOiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5
cmphbGFAbGludXguaW50ZWwuY29tPgpDYzogTWF0dCBSb3BlciA8bWF0dGhldy5kLnJvcGVyQGlu
dGVsLmNvbT4KQ2M6IFlhbmcgQSBTaGkgPHlhbmcuYS5zaGlAaW50ZWwuY29tPgpDYzogUmFkaGFr
cmlzaG5hIFNyaXBhZGEgPHJhZGhha3Jpc2huYS5zcmlwYWRhQGludGVsLmNvbT4KU2lnbmVkLW9m
Zi1ieTogRGhpbmFrYXJhbiBQYW5kaXlhbiA8ZGhpbmFrYXJhbi5wYW5kaXlhbkBpbnRlbC5jb20+
ClNpZ25lZC1vZmYtYnk6IEx1Y2FzIERlIE1hcmNoaSA8bHVjYXMuZGVtYXJjaGlAaW50ZWwuY29t
PgpTaWduZWQtb2ZmLWJ5OiBJbXJlIERlYWsgPGltcmUuZGVha0BpbnRlbC5jb20+ClJldmlld2Vk
LWJ5OiBSYWRoYWtyaXNobmEgU3JpcGFkYSA8cmFkaGFrcmlzaG5hLnNyaXBhZGFAaW50ZWwuY29t
PgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jICB8IDE4
NCArKysrKysrKysrKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGlzcGxheS5oICB8ICAgMSArCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5
cGVzLmggICAgfCAgIDYgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3By
aXRlLmMgICB8ICA1NSArKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmggICAg
ICAgICAgICAgICB8ICAgMSArCiA1IGZpbGVzIGNoYW5nZWQsIDE5NSBpbnNlcnRpb25zKCspLCA1
MiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlz
cGxheS5jCmluZGV4IDQzM2Q5YWViYmY0Mi4uMjdjZjkwMWRiNWQ5IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAtMTk0Myw3ICsxOTQzLDkgQEAg
c3RhdGljIGJvb2wgaXNfY2NzX3BsYW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
LCBpbnQgcGxhbmUpCiAKIHN0YXRpYyBib29sIGlzX2dlbjEyX2Njc19tb2RpZmllcih1NjQgbW9k
aWZpZXIpCiB7Ci0JcmV0dXJuIG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dF
TjEyX1JDX0NDUzsKKwlyZXR1cm4gbW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURf
R0VOMTJfUkNfQ0NTIHx8CisJICAgICAgIG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJ
TEVEX0dFTjEyX01DX0NDUzsKKwogfQogCiBzdGF0aWMgYm9vbCBpc19nZW4xMl9jY3NfcGxhbmUo
Y29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBwbGFuZSkKQEAgLTE5NzYsOCAr
MTk3OCw3IEBAIHN0YXRpYyBpbnQgY2NzX3RvX21haW5fcGxhbmUoY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIsIGludCBjY3NfcGxhbmUpCiB9CiAKIC8qIFJldHVybiBlaXRoZXIgdGhl
IG1haW4gcGxhbmUncyBDQ1Mgb3IgLSBpZiBub3QgYSBDQ1MgRkIgLSBVViBwbGFuZSAqLwotc3Rh
dGljIGludAotaW50ZWxfbWFpbl90b19hdXhfcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIsIGludCBtYWluX3BsYW5lKQoraW50IGludGVsX21haW5fdG9fYXV4X3BsYW5lKGNv
bnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgbWFpbl9wbGFuZSkKIHsKIAlpZiAo
aXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikpCiAJCXJldHVybiBtYWluX3RvX2Njc19wbGFu
ZShmYiwgbWFpbl9wbGFuZSk7CkBAIC0yMDEyLDYgKzIwMTMsNyBAQCBpbnRlbF90aWxlX3dpZHRo
X2J5dGVzKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgY29sb3JfcGxhbmUp
CiAJCQlyZXR1cm4gMTI4OwogCQkvKiBmYWxsIHRocm91Z2ggKi8KIAljYXNlIEk5MTVfRk9STUFU
X01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUzoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVE
X0dFTjEyX01DX0NDUzoKIAkJaWYgKGlzX2Njc19wbGFuZShmYiwgY29sb3JfcGxhbmUpKQogCQkJ
cmV0dXJuIDY0OwogCQkvKiBmYWxsIHRocm91Z2ggKi8KQEAgLTIxNTIsNiArMjE1NCw3IEBAIHN0
YXRpYyB1bnNpZ25lZCBpbnQgaW50ZWxfc3VyZl9hbGlnbm1lbnQoY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIsCiAJCQlyZXR1cm4gMjU2ICogMTAyNDsKIAkJcmV0dXJuIDA7CiAJY2Fz
ZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1M6CisJY2FzZSBJOTE1X0ZPUk1B
VF9NT0RfWV9USUxFRF9HRU4xMl9NQ19DQ1M6CiAJCXJldHVybiAxNiAqIDEwMjQ7CiAJY2FzZSBJ
OTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1M6CiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElM
RURfQ0NTOgpAQCAtMjUzNiw2ICsyNTM5LDcgQEAgc3RhdGljIHVuc2lnbmVkIGludCBpbnRlbF9m
Yl9tb2RpZmllcl90b190aWxpbmcodTY0IGZiX21vZGlmaWVyKQogCWNhc2UgSTkxNV9GT1JNQVRf
TU9EX1lfVElMRUQ6CiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1M6CiAJY2FzZSBJ
OTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1M6CisJY2FzZSBJOTE1X0ZPUk1BVF9N
T0RfWV9USUxFRF9HRU4xMl9NQ19DQ1M6CiAJCXJldHVybiBJOTE1X1RJTElOR19ZOwogCWRlZmF1
bHQ6CiAJCXJldHVybiBJOTE1X1RJTElOR19OT05FOwpAQCAtMjU4Nyw2ICsyNTkxLDMwIEBAIHN0
YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvIGdlbjEyX2Njc19mb3JtYXRzW10gPSB7
CiAJeyAuZm9ybWF0ID0gRFJNX0ZPUk1BVF9BQkdSODg4OCwgLmRlcHRoID0gMzIsIC5udW1fcGxh
bmVzID0gMiwKIAkgIC5jaGFyX3Blcl9ibG9jayA9IHsgNCwgMSB9LCAuYmxvY2tfdyA9IHsgMSwg
MiB9LCAuYmxvY2tfaCA9IHsgMSwgMSB9LAogCSAgLmhzdWIgPSAxLCAudnN1YiA9IDEsIC5oYXNf
YWxwaGEgPSB0cnVlIH0sCisJeyAuZm9ybWF0ID0gRFJNX0ZPUk1BVF9ZVVlWLCAubnVtX3BsYW5l
cyA9IDIsCisJICAuY2hhcl9wZXJfYmxvY2sgPSB7IDIsIDEgfSwgLmJsb2NrX3cgPSB7IDEsIDIg
fSwgLmJsb2NrX2ggPSB7IDEsIDEgfSwKKwkgIC5oc3ViID0gMiwgLnZzdWIgPSAxLCAuaXNfeXV2
ID0gdHJ1ZSB9LAorCXsgLmZvcm1hdCA9IERSTV9GT1JNQVRfWVZZVSwgLm51bV9wbGFuZXMgPSAy
LAorCSAgLmNoYXJfcGVyX2Jsb2NrID0geyAyLCAxIH0sIC5ibG9ja193ID0geyAxLCAyIH0sIC5i
bG9ja19oID0geyAxLCAxIH0sCisJICAuaHN1YiA9IDIsIC52c3ViID0gMSwgLmlzX3l1diA9IHRy
dWUgfSwKKwl7IC5mb3JtYXQgPSBEUk1fRk9STUFUX1VZVlksIC5udW1fcGxhbmVzID0gMiwKKwkg
IC5jaGFyX3Blcl9ibG9jayA9IHsgMiwgMSB9LCAuYmxvY2tfdyA9IHsgMSwgMiB9LCAuYmxvY2tf
aCA9IHsgMSwgMSB9LAorCSAgLmhzdWIgPSAyLCAudnN1YiA9IDEsIC5pc195dXYgPSB0cnVlIH0s
CisJeyAuZm9ybWF0ID0gRFJNX0ZPUk1BVF9WWVVZLCAubnVtX3BsYW5lcyA9IDIsCisJICAuY2hh
cl9wZXJfYmxvY2sgPSB7IDIsIDEgfSwgLmJsb2NrX3cgPSB7IDEsIDIgfSwgLmJsb2NrX2ggPSB7
IDEsIDEgfSwKKwkgIC5oc3ViID0gMiwgLnZzdWIgPSAxLCAuaXNfeXV2ID0gdHJ1ZSB9LAorCXsg
LmZvcm1hdCA9IERSTV9GT1JNQVRfTlYxMiwgLm51bV9wbGFuZXMgPSA0LAorCSAgLmNoYXJfcGVy
X2Jsb2NrID0geyAxLCAyLCAxLCAxIH0sIC5ibG9ja193ID0geyAxLCAxLCA0LCA0IH0sIC5ibG9j
a19oID0geyAxLCAxLCAxLCAxIH0sCisJICAuaHN1YiA9IDIsIC52c3ViID0gMiwgLmlzX3l1diA9
IHRydWUgfSwKKwl7IC5mb3JtYXQgPSBEUk1fRk9STUFUX1AwMTAsIC5udW1fcGxhbmVzID0gNCwK
KwkgIC5jaGFyX3Blcl9ibG9jayA9IHsgMiwgNCwgMSwgMSB9LCAuYmxvY2tfdyA9IHsgMSwgMSwg
MiwgMiB9LCAuYmxvY2tfaCA9IHsgMSwgMSwgMSwgMSB9LAorCSAgLmhzdWIgPSAyLCAudnN1YiA9
IDIsIC5pc195dXYgPSB0cnVlIH0sCisJeyAuZm9ybWF0ID0gRFJNX0ZPUk1BVF9QMDEyLCAubnVt
X3BsYW5lcyA9IDQsCisJICAuY2hhcl9wZXJfYmxvY2sgPSB7IDIsIDQsIDEsIDEgfSwgLmJsb2Nr
X3cgPSB7IDEsIDEsIDIsIDIgfSwgLmJsb2NrX2ggPSB7IDEsIDEsIDEsIDEgfSwKKwkgIC5oc3Vi
ID0gMiwgLnZzdWIgPSAyLCAuaXNfeXV2ID0gdHJ1ZSB9LAorCXsgLmZvcm1hdCA9IERSTV9GT1JN
QVRfUDAxNiwgLm51bV9wbGFuZXMgPSA0LAorCSAgLmNoYXJfcGVyX2Jsb2NrID0geyAyLCA0LCAx
LCAxIH0sIC5ibG9ja193ID0geyAxLCAxLCAyLCAyIH0sIC5ibG9ja19oID0geyAxLCAxLCAxLCAx
IH0sCisJICAuaHN1YiA9IDIsIC52c3ViID0gMiwgLmlzX3l1diA9IHRydWUgfSwKIH07CiAKIHN0
YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICoKQEAgLTI2MTMsNiArMjY0MSw3IEBA
IGludGVsX2dldF9mb3JtYXRfaW5mbyhjb25zdCBzdHJ1Y3QgZHJtX21vZGVfZmJfY21kMiAqY21k
KQogCQkJCQkgIEFSUkFZX1NJWkUoc2tsX2Njc19mb3JtYXRzKSwKIAkJCQkJICBjbWQtPnBpeGVs
X2Zvcm1hdCk7CiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1M6CisJ
Y2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9NQ19DQ1M6CiAJCXJldHVybiBsb29r
dXBfZm9ybWF0X2luZm8oZ2VuMTJfY2NzX2Zvcm1hdHMsCiAJCQkJCSAgQVJSQVlfU0laRShnZW4x
Ml9jY3NfZm9ybWF0cyksCiAJCQkJCSAgY21kLT5waXhlbF9mb3JtYXQpOwpAQCAtMjYyNCw2ICsy
NjUzLDcgQEAgaW50ZWxfZ2V0X2Zvcm1hdF9pbmZvKGNvbnN0IHN0cnVjdCBkcm1fbW9kZV9mYl9j
bWQyICpjbWQpCiBib29sIGlzX2Njc19tb2RpZmllcih1NjQgbW9kaWZpZXIpCiB7CiAJcmV0dXJu
IG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUyB8fAorCSAg
ICAgICBtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9NQ19DQ1MgfHwK
IAkgICAgICAgbW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfQ0NTIHx8CiAJICAg
ICAgIG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRF9DQ1M7CiB9CkBAIC0yNjk1
LDcgKzI3MjUsNyBAQCBpbnRlbF9mYl9zdHJpZGVfYWxpZ25tZW50KGNvbnN0IHN0cnVjdCBkcm1f
ZnJhbWVidWZmZXIgKmZiLCBpbnQgY29sb3JfcGxhbmUpCiAJfQogCiAJdGlsZV93aWR0aCA9IGlu
dGVsX3RpbGVfd2lkdGhfYnl0ZXMoZmIsIGNvbG9yX3BsYW5lKTsKLQlpZiAoaXNfY2NzX21vZGlm
aWVyKGZiLT5tb2RpZmllcikgJiYgY29sb3JfcGxhbmUgPT0gMCkgeworCWlmIChpc19jY3NfbW9k
aWZpZXIoZmItPm1vZGlmaWVyKSkgewogCQkvKgogCQkgKiBEaXNwbGF5IFdBICMwNTMxOiBza2ws
Ynh0LGtibCxnbGsKIAkJICoKQEAgLTI3MDUsNyArMjczNSw3IEBAIGludGVsX2ZiX3N0cmlkZV9h
bGlnbm1lbnQoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFu
ZSkKIAkJICogcmVxdWlyZSB0aGUgZW50aXJlIGZiIHRvIGFjY29tbW9kYXRlIHRoYXQgdG8gYXZv
aWQKIAkJICogcG90ZW50aWFsIHJ1bnRpbWUgZXJyb3JzIGF0IHBsYW5lIGNvbmZpZ3VyYXRpb24g
dGltZS4KIAkJICovCi0JCWlmIChJU19HRU4oZGV2X3ByaXYsIDkpICYmIGZiLT53aWR0aCA+IDM4
NDApCisJCWlmIChJU19HRU4oZGV2X3ByaXYsIDkpICYmIGNvbG9yX3BsYW5lID09IDAgJiYgZmIt
PndpZHRoID4gMzg0MCkKIAkJCXRpbGVfd2lkdGggKj0gNDsKIAkJLyoKIAkJICogVGhlIG1haW4g
c3VyZmFjZSBwaXRjaCBtdXN0IGJlIHBhZGRlZCB0byBhIG11bHRpcGxlIG9mIGZvdXIKQEAgLTI4
MjcsNiArMjg1NywxNyBAQCBpbnRlbF9mYl9wbGFuZV9nZXRfc3Vic2FtcGxpbmcoaW50ICpoc3Vi
LCBpbnQgKnZzdWIsCiAKIAkqdnN1YiA9IDMyOwogfQorCitzdGF0aWMgdm9pZAoraW50ZWxfZmJf
cGxhbmVfZGltcyhpbnQgKncsIGludCAqaCwgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGlu
dCBjb2xvcl9wbGFuZSkKK3sKKwlpbnQgaHN1YiwgdnN1YjsKKworCWludGVsX2ZiX3BsYW5lX2dl
dF9zdWJzYW1wbGluZygmaHN1YiwgJnZzdWIsIGZiLCBjb2xvcl9wbGFuZSk7CisJKncgPSBmYi0+
d2lkdGggLyBoc3ViOworCSpoID0gZmItPmhlaWdodCAvIHZzdWI7Cit9CisKIHN0YXRpYyBpbnQK
IGludGVsX2ZiX2NoZWNrX2Njc194eShzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNj
c19wbGFuZSwgaW50IHgsIGludCB5KQogewpAQCAtMjk0OSw4ICsyOTkwLDcgQEAgaW50ZWxfZmls
bF9mYl9pbmZvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJaW50IHJldDsK
IAogCQljcHAgPSBmYi0+Zm9ybWF0LT5jcHBbaV07Ci0JCXdpZHRoID0gZHJtX2ZyYW1lYnVmZmVy
X3BsYW5lX3dpZHRoKGZiLT53aWR0aCwgZmIsIGkpOwotCQloZWlnaHQgPSBkcm1fZnJhbWVidWZm
ZXJfcGxhbmVfaGVpZ2h0KGZiLT5oZWlnaHQsIGZiLCBpKTsKKwkJaW50ZWxfZmJfcGxhbmVfZGlt
cygmd2lkdGgsICZoZWlnaHQsIGZiLCBpKTsKIAogCQlyZXQgPSBpbnRlbF9mYl9vZmZzZXRfdG9f
eHkoJngsICZ5LCBmYiwgaSk7CiAJCWlmIChyZXQpIHsKQEAgLTM1ODUsNiArMzYyNSw3IEBAIHN0
YXRpYyBpbnQgc2tsX21heF9wbGFuZV93aWR0aChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVy
ICpmYiwKIAkJCXJldHVybiA1MTIwOwogCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfQ0NT
OgogCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEX0NDUzoKKwljYXNlIEk5MTVfRk9STUFU
X01PRF9ZX1RJTEVEX0dFTjEyX01DX0NDUzoKIAkJLyogRklYTUUgQVVYIHBsYW5lPyAqLwogCWNh
c2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQ6CiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElM
RUQ6CkBAIC0zNjQ0LDEwICszNjg1LDEwIEBAIHN0YXRpYyBpbnQgaWNsX21heF9wbGFuZV9oZWln
aHQodm9pZCkKIH0KIAogc3RhdGljIGJvb2wgc2tsX2NoZWNrX21haW5fY2NzX2Nvb3JkaW5hdGVz
KHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCi0JCQkJCSAgIGludCBtYWlu
X3gsIGludCBtYWluX3ksIHUzMiBtYWluX29mZnNldCkKKwkJCQkJICAgaW50IG1haW5feCwgaW50
IG1haW5feSwgdTMyIG1haW5fb2Zmc2V0LAorCQkJCQkgICBpbnQgY2NzX3BsYW5lKQogewogCWNv
bnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwotCWlu
dCBjY3NfcGxhbmUgPSBtYWluX3RvX2Njc19wbGFuZShmYiwgMCk7CiAJaW50IGF1eF94ID0gcGxh
bmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueDsKIAlpbnQgYXV4X3kgPSBwbGFuZV9z
dGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS55OwogCXUzMiBhdXhfb2Zmc2V0ID0gcGxhbmVf
c3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ub2Zmc2V0OwpAQCAtMzc1Myw3ICszNzk0LDgg
QEAgc3RhdGljIGludCBza2xfY2hlY2tfbWFpbl9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9z
dGF0ZSAqcGxhbmVfc3RhdGUpCiAJICogdGhleSBtYXRjaCB3aXRoIHRoZSBtYWluIHN1cmZhY2Ug
eC95IG9mZnNldHMuCiAJICovCiAJaWYgKGlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpKSB7
Ci0JCXdoaWxlICghc2tsX2NoZWNrX21haW5fY2NzX2Nvb3JkaW5hdGVzKHBsYW5lX3N0YXRlLCB4
LCB5LCBvZmZzZXQpKSB7CisJCXdoaWxlICghc2tsX2NoZWNrX21haW5fY2NzX2Nvb3JkaW5hdGVz
KHBsYW5lX3N0YXRlLCB4LCB5LCBvZmZzZXQsCisJCQkJCQkgICAgICAgYXV4X3BsYW5lKSkgewog
CQkJaWYgKG9mZnNldCA9PSAwKQogCQkJCWJyZWFrOwogCkBAIC0zNzg2LDcgKzM4MjgsOCBAQCBz
dGF0aWMgaW50IHNrbF9jaGVja19udjEyX2F1eF9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9z
dGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIg
PSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3Rh
dGUtPmh3LnJvdGF0aW9uOwotCWludCBtYXhfd2lkdGggPSBza2xfbWF4X3BsYW5lX3dpZHRoKGZi
LCAxLCByb3RhdGlvbik7CisJaW50IHV2X3BsYW5lID0gMTsKKwlpbnQgbWF4X3dpZHRoID0gc2ts
X21heF9wbGFuZV93aWR0aChmYiwgdXZfcGxhbmUsIHJvdGF0aW9uKTsKIAlpbnQgbWF4X2hlaWdo
dCA9IDQwOTY7CiAJaW50IHggPSBwbGFuZV9zdGF0ZS0+dWFwaS5zcmMueDEgPj4gMTc7CiAJaW50
IHkgPSBwbGFuZV9zdGF0ZS0+dWFwaS5zcmMueTEgPj4gMTc7CkBAIC0zNzk0LDggKzM4MzcsOSBA
QCBzdGF0aWMgaW50IHNrbF9jaGVja19udjEyX2F1eF9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFu
ZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJaW50IGggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0
YXRlLT51YXBpLnNyYykgPj4gMTc7CiAJdTMyIG9mZnNldDsKIAotCWludGVsX2FkZF9mYl9vZmZz
ZXRzKCZ4LCAmeSwgcGxhbmVfc3RhdGUsIDEpOwotCW9mZnNldCA9IGludGVsX3BsYW5lX2NvbXB1
dGVfYWxpZ25lZF9vZmZzZXQoJngsICZ5LCBwbGFuZV9zdGF0ZSwgMSk7CisJaW50ZWxfYWRkX2Zi
X29mZnNldHMoJngsICZ5LCBwbGFuZV9zdGF0ZSwgdXZfcGxhbmUpOworCW9mZnNldCA9IGludGVs
X3BsYW5lX2NvbXB1dGVfYWxpZ25lZF9vZmZzZXQoJngsICZ5LAorCQkJCQkJICAgIHBsYW5lX3N0
YXRlLCB1dl9wbGFuZSk7CiAKIAkvKiBGSVhNRSBub3QgcXVpdGUgc3VyZSBob3cvaWYgdGhlc2Ug
YXBwbHkgdG8gdGhlIGNocm9tYSBwbGFuZSAqLwogCWlmICh3ID4gbWF4X3dpZHRoIHx8IGggPiBt
YXhfaGVpZ2h0KSB7CkBAIC0zODA0LDkgKzM4NDgsMzkgQEAgc3RhdGljIGludCBza2xfY2hlY2tf
bnYxMl9hdXhfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQog
CQlyZXR1cm4gLUVJTlZBTDsKIAl9CiAKLQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMV0ub2Zm
c2V0ID0gb2Zmc2V0OwotCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVsxXS54ID0geDsKLQlwbGFu
ZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMV0ueSA9IHk7CisJaWYgKGlzX2Njc19tb2RpZmllcihmYi0+
bW9kaWZpZXIpKSB7CisJCWludCBjY3NfcGxhbmUgPSBtYWluX3RvX2Njc19wbGFuZShmYiwgdXZf
cGxhbmUpOworCQlpbnQgYXV4X29mZnNldCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3Nf
cGxhbmVdLm9mZnNldDsKKwkJaW50IGFsaWdubWVudCA9IGludGVsX3N1cmZfYWxpZ25tZW50KGZi
LCB1dl9wbGFuZSk7CisKKwkJaWYgKG9mZnNldCA+IGF1eF9vZmZzZXQpCisJCQlvZmZzZXQgPSBp
bnRlbF9wbGFuZV9hZGp1c3RfYWxpZ25lZF9vZmZzZXQoJngsICZ5LAorCQkJCQkJCQkgICBwbGFu
ZV9zdGF0ZSwKKwkJCQkJCQkJICAgdXZfcGxhbmUsCisJCQkJCQkJCSAgIG9mZnNldCwKKwkJCQkJ
CQkJICAgYXV4X29mZnNldCAmIH4oYWxpZ25tZW50IC0gMSkpOworCisJCXdoaWxlICghc2tsX2No
ZWNrX21haW5fY2NzX2Nvb3JkaW5hdGVzKHBsYW5lX3N0YXRlLCB4LCB5LAorCQkJCQkJICAgICAg
IG9mZnNldCwgY2NzX3BsYW5lKSkgeworCQkJaWYgKG9mZnNldCA9PSAwKQorCQkJCWJyZWFrOwor
CisJCQlvZmZzZXQgPSBpbnRlbF9wbGFuZV9hZGp1c3RfYWxpZ25lZF9vZmZzZXQoJngsICZ5LAor
CQkJCQkJCQkgICBwbGFuZV9zdGF0ZSwKKwkJCQkJCQkJICAgdXZfcGxhbmUsCisJCQkJCQkJCSAg
IG9mZnNldCwgb2Zmc2V0IC0gYWxpZ25tZW50KTsKKwkJfQorCisJCWlmICh4ICE9IHBsYW5lX3N0
YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLnggfHwKKwkJICAgIHkgIT0gcGxhbmVfc3RhdGUt
PmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueSkgeworCQkJRFJNX0RFQlVHX0tNUygiVW5hYmxlIHRv
IGZpbmQgc3VpdGFibGUgZGlzcGxheSBzdXJmYWNlIG9mZnNldCBkdWUgdG8gQ0NTXG4iKTsKKwkJ
CXJldHVybiAtRUlOVkFMOworCQl9CisJfQorCisJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW3V2
X3BsYW5lXS5vZmZzZXQgPSBvZmZzZXQ7CisJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW3V2X3Bs
YW5lXS54ID0geDsKKwlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbdXZfcGxhbmVdLnkgPSB5Owog
CiAJcmV0dXJuIDA7CiB9CkBAIC0zODE2LDIxICszODkwLDQwIEBAIHN0YXRpYyBpbnQgc2tsX2No
ZWNrX2Njc19hdXhfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRl
KQogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZi
OwogCWludCBzcmNfeCA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy54MSA+PiAxNjsKIAlpbnQgc3Jj
X3kgPSBwbGFuZV9zdGF0ZS0+dWFwaS5zcmMueTEgPj4gMTY7Ci0JaW50IGhzdWI7Ci0JaW50IHZz
dWI7Ci0JaW50IHg7Ci0JaW50IHk7CiAJdTMyIG9mZnNldDsKKwlpbnQgY2NzX3BsYW5lOwogCi0J
aW50ZWxfZmJfcGxhbmVfZ2V0X3N1YnNhbXBsaW5nKCZoc3ViLCAmdnN1YiwgZmIsIDEpOwotCXgg
PSBzcmNfeCAvIGhzdWI7Ci0JeSA9IHNyY195IC8gdnN1YjsKLQlpbnRlbF9hZGRfZmJfb2Zmc2V0
cygmeCwgJnksIHBsYW5lX3N0YXRlLCAxKTsKLQlvZmZzZXQgPSBpbnRlbF9wbGFuZV9jb21wdXRl
X2FsaWduZWRfb2Zmc2V0KCZ4LCAmeSwgcGxhbmVfc3RhdGUsIDEpOworCWZvciAoY2NzX3BsYW5l
ID0gMDsgY2NzX3BsYW5lIDwgZmItPmZvcm1hdC0+bnVtX3BsYW5lczsgY2NzX3BsYW5lKyspIHsK
KwkJaW50IG1haW5faHN1YiwgbWFpbl92c3ViOworCQlpbnQgaHN1YiwgdnN1YjsKKwkJaW50IHgs
IHk7CisKKwkJaWYgKCFpc19jY3NfcGxhbmUoZmIsIGNjc19wbGFuZSkpCisJCQljb250aW51ZTsK
KworCQlpbnRlbF9mYl9wbGFuZV9nZXRfc3Vic2FtcGxpbmcoJm1haW5faHN1YiwgJm1haW5fdnN1
YiwgZmIsCisJCQkJCSAgICAgICBjY3NfdG9fbWFpbl9wbGFuZShmYiwgY2NzX3BsYW5lKSk7CisJ
CWludGVsX2ZiX3BsYW5lX2dldF9zdWJzYW1wbGluZygmaHN1YiwgJnZzdWIsIGZiLCBjY3NfcGxh
bmUpOworCisJCWhzdWIgKj0gbWFpbl9oc3ViOworCQl2c3ViICo9IG1haW5fdnN1YjsKKwkJeCA9
IHNyY194IC8gaHN1YjsKKwkJeSA9IHNyY195IC8gdnN1YjsKIAotCXBsYW5lX3N0YXRlLT5jb2xv
cl9wbGFuZVsxXS5vZmZzZXQgPSBvZmZzZXQ7Ci0JcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzFd
LnggPSB4ICogaHN1YiArIHNyY194ICUgaHN1YjsKLQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVb
MV0ueSA9IHkgKiB2c3ViICsgc3JjX3kgJSB2c3ViOworCQlpbnRlbF9hZGRfZmJfb2Zmc2V0cygm
eCwgJnksIHBsYW5lX3N0YXRlLCBjY3NfcGxhbmUpOworCisJCW9mZnNldCA9IGludGVsX3BsYW5l
X2NvbXB1dGVfYWxpZ25lZF9vZmZzZXQoJngsICZ5LAorCQkJCQkJCSAgICBwbGFuZV9zdGF0ZSwK
KwkJCQkJCQkgICAgY2NzX3BsYW5lKTsKKworCQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2Nz
X3BsYW5lXS5vZmZzZXQgPSBvZmZzZXQ7CisJCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3Nf
cGxhbmVdLnggPSAoeCAqIGhzdWIgKworCQkJCQkJCSBzcmNfeCAlIGhzdWIpIC8KKwkJCQkJCQlt
YWluX2hzdWI7CisJCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLnkgPSAoeSAq
IHZzdWIgKworCQkJCQkJCSBzcmNfeSAlIHZzdWIpIC8KKwkJCQkJCQltYWluX3ZzdWI7CisJfQog
CiAJcmV0dXJuIDA7CiB9CkBAIC0zODM5LDYgKzM5MzIsNyBAQCBpbnQgc2tsX2NoZWNrX3BsYW5l
X3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAljb25z
dCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAlpbnQg
cmV0OworCWJvb2wgbmVlZHNfYXV4ID0gZmFsc2U7CiAKIAlyZXQgPSBpbnRlbF9wbGFuZV9jb21w
dXRlX2d0dChwbGFuZV9zdGF0ZSk7CiAJaWYgKHJldCkKQEAgLTM4NDgsMjIgKzM5NDIsMzIgQEAg
aW50IHNrbF9jaGVja19wbGFuZV9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxh
bmVfc3RhdGUpCiAJCXJldHVybiAwOwogCiAJLyoKLQkgKiBIYW5kbGUgdGhlIEFVWCBzdXJmYWNl
IGZpcnN0IHNpbmNlCi0JICogdGhlIG1haW4gc3VyZmFjZSBzZXR1cCBkZXBlbmRzIG9uIGl0Lgor
CSAqIEhhbmRsZSB0aGUgQVVYIHN1cmZhY2UgZmlyc3Qgc2luY2UgdGhlIG1haW4gc3VyZmFjZSBz
ZXR1cCBkZXBlbmRzIG9uCisJICogaXQuCiAJICovCisJaWYgKGlzX2Njc19tb2RpZmllcihmYi0+
bW9kaWZpZXIpKSB7CisJCW5lZWRzX2F1eCA9IHRydWU7CisJCXJldCA9IHNrbF9jaGVja19jY3Nf
YXV4X3N1cmZhY2UocGxhbmVfc3RhdGUpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKwl9
CisKIAlpZiAoaW50ZWxfZm9ybWF0X2luZm9faXNfeXV2X3NlbWlwbGFuYXIoZmItPmZvcm1hdCwK
IAkJCQkJICAgICAgICBmYi0+bW9kaWZpZXIpKSB7CisJCW5lZWRzX2F1eCA9IHRydWU7CiAJCXJl
dCA9IHNrbF9jaGVja19udjEyX2F1eF9zdXJmYWNlKHBsYW5lX3N0YXRlKTsKIAkJaWYgKHJldCkK
IAkJCXJldHVybiByZXQ7Ci0JfSBlbHNlIGlmIChpc19jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVy
KSkgewotCQlyZXQgPSBza2xfY2hlY2tfY2NzX2F1eF9zdXJmYWNlKHBsYW5lX3N0YXRlKTsKLQkJ
aWYgKHJldCkKLQkJCXJldHVybiByZXQ7Ci0JfSBlbHNlIHsKLQkJcGxhbmVfc3RhdGUtPmNvbG9y
X3BsYW5lWzFdLm9mZnNldCA9IH4weGZmZjsKLQkJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzFd
LnggPSAwOwotCQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMV0ueSA9IDA7CisJfQorCisJaWYg
KCFuZWVkc19hdXgpIHsKKwkJaW50IGk7CisKKwkJZm9yIChpID0gMTsgaSA8IGZiLT5mb3JtYXQt
Pm51bV9wbGFuZXM7IGkrKykgeworCQkJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2ldLm9mZnNl
dCA9IH4weGZmZjsKKwkJCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtpXS54ID0gMDsKKwkJCXBs
YW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtpXS55ID0gMDsKKwkJfQogCX0KIAogCXJldCA9IHNrbF9j
aGVja19tYWluX3N1cmZhY2UocGxhbmVfc3RhdGUpOwpAQCAtNDQ1Myw2ICs0NTU3LDggQEAgc3Rh
dGljIHUzMiBza2xfcGxhbmVfY3RsX3RpbGluZyh1NjQgZmJfbW9kaWZpZXIpCiAJCXJldHVybiBQ
TEFORV9DVExfVElMRURfWSB8CiAJCSAgICAgICBQTEFORV9DVExfUkVOREVSX0RFQ09NUFJFU1NJ
T05fRU5BQkxFIHwKIAkJICAgICAgIFBMQU5FX0NUTF9DTEVBUl9DT0xPUl9ESVNBQkxFOworCWNh
c2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfTUNfQ0NTOgorCQlyZXR1cm4gUExBTkVf
Q1RMX1RJTEVEX1kgfCBQTEFORV9DVExfTUVESUFfREVDT01QUkVTU0lPTl9FTkFCTEU7CiAJY2Fz
ZSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRUQ6CiAJCXJldHVybiBQTEFORV9DVExfVElMRURfWUY7
CiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRURfQ0NTOgpAQCAtMTAxOTUsNiArMTAzMDEs
OCBAQCBza3lsYWtlX2dldF9pbml0aWFsX3BsYW5lX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YywKIAkJCWZiLT5tb2RpZmllciA9IElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIgPwogCQkJ
CUk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUyA6CiAJCQkJSTkxNV9GT1JNQVRf
TU9EX1lfVElMRURfQ0NTOworCQllbHNlIGlmICh2YWwgJiBQTEFORV9DVExfTUVESUFfREVDT01Q
UkVTU0lPTl9FTkFCTEUpCisJCQlmYi0+bW9kaWZpZXIgPSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxF
RF9HRU4xMl9NQ19DQ1M7CiAJCWVsc2UKIAkJCWZiLT5tb2RpZmllciA9IEk5MTVfRk9STUFUX01P
RF9ZX1RJTEVEOwogCQlicmVhazsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZGlzcGxheS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kaXNwbGF5LmgKaW5kZXggMGZlZjkyNjNjZGRjLi5iODExMjM0MDc3M2IgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5oCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5oCkBAIC00NzQsNiArNDc0LDcg
QEAgdm9pZCBpbnRlbF9saW5rX2NvbXB1dGVfbV9uKHUxNiBicHAsIGludCBubGFuZXMsCiAJCQkg
ICAgc3RydWN0IGludGVsX2xpbmtfbV9uICptX24sCiAJCQkgICAgYm9vbCBjb25zdGFudF9uLCBi
b29sIGZlY19lbmFibGUpOwogYm9vbCBpc19jY3NfbW9kaWZpZXIodTY0IG1vZGlmaWVyKTsKK2lu
dCBpbnRlbF9tYWluX3RvX2F1eF9wbGFuZShjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpm
YiwgaW50IG1haW5fcGxhbmUpOwogdm9pZCBscHRfZGlzYWJsZV9jbGtvdXRfZHAoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIHUzMiBpbnRlbF9wbGFuZV9mYl9tYXhfc3RyaWRl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCSAgICAgIHUzMiBwaXhlbF9m
b3JtYXQsIHU2NCBtb2RpZmllcik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCmluZGV4IDgzZWEwNDE0OWI3Ny4uM2NkZjQ0ZmE0MTY0
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlf
dHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlf
dHlwZXMuaApAQCAtOTAsOCArOTAsOCBAQCBzdHJ1Y3QgaW50ZWxfZnJhbWVidWZmZXIgewogCS8q
IGZvciBlYWNoIHBsYW5lIGluIHRoZSBub3JtYWwgR1RUIHZpZXcgKi8KIAlzdHJ1Y3QgewogCQl1
bnNpZ25lZCBpbnQgeCwgeTsKLQl9IG5vcm1hbFsyXTsKLQkvKiBmb3IgZWFjaCBwbGFuZSBpbiB0
aGUgcm90YXRlZCBHVFQgdmlldyAqLworCX0gbm9ybWFsWzRdOworCS8qIGZvciBlYWNoIHBsYW5l
IGluIHRoZSByb3RhdGVkIEdUVCB2aWV3IGZvciBuby1DQ1MgZm9ybWF0cyAqLwogCXN0cnVjdCB7
CiAJCXVuc2lnbmVkIGludCB4LCB5OwogCQl1bnNpZ25lZCBpbnQgcGl0Y2g7IC8qIHBpeGVscyAq
LwpAQCAtNTU1LDcgKzU1NSw3IEBAIHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSB7CiAJCSAqLwog
CQl1MzIgc3RyaWRlOwogCQlpbnQgeCwgeTsKLQl9IGNvbG9yX3BsYW5lWzJdOworCX0gY29sb3Jf
cGxhbmVbNF07CiAKIAkvKiBwbGFuZSBjb250cm9sIHJlZ2lzdGVyICovCiAJdTMyIGN0bDsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCmluZGV4IGI3ZjNhMWIz
MzU4Zi4uYmU1NmI2ZjU2NDExIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX3Nwcml0ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfc3ByaXRlLmMKQEAgLTU4MywxNSArNTgzLDE2IEBAIHNrbF9wcm9ncmFtX3BsYW5lKHN0cnVj
dCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAJY29uc3Qgc3RydWN0IGRybV9pbnRlbF9zcHJpdGVfY29s
b3JrZXkgKmtleSA9ICZwbGFuZV9zdGF0ZS0+Y2tleTsKIAl1MzIgc3VyZl9hZGRyID0gcGxhbmVf
c3RhdGUtPmNvbG9yX3BsYW5lW2NvbG9yX3BsYW5lXS5vZmZzZXQ7CiAJdTMyIHN0cmlkZSA9IHNr
bF9wbGFuZV9zdHJpZGUocGxhbmVfc3RhdGUsIGNvbG9yX3BsYW5lKTsKLQl1MzIgYXV4X2Rpc3Qg
PSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMV0ub2Zmc2V0IC0gc3VyZl9hZGRyOwotCXUzMiBh
dXhfc3RyaWRlID0gc2tsX3BsYW5lX3N0cmlkZShwbGFuZV9zdGF0ZSwgMSk7CisJY29uc3Qgc3Ry
dWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CisJaW50IGF1eF9w
bGFuZSA9IGludGVsX21haW5fdG9fYXV4X3BsYW5lKGZiLCBjb2xvcl9wbGFuZSk7CisJdTMyIGF1
eF9kaXN0ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2F1eF9wbGFuZV0ub2Zmc2V0IC0gc3Vy
Zl9hZGRyOworCXUzMiBhdXhfc3RyaWRlID0gc2tsX3BsYW5lX3N0cmlkZShwbGFuZV9zdGF0ZSwg
YXV4X3BsYW5lKTsKIAlpbnQgY3J0Y194ID0gcGxhbmVfc3RhdGUtPnVhcGkuZHN0LngxOwogCWlu
dCBjcnRjX3kgPSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3QueTE7CiAJdTMyIHggPSBwbGFuZV9zdGF0
ZS0+Y29sb3JfcGxhbmVbY29sb3JfcGxhbmVdLng7CiAJdTMyIHkgPSBwbGFuZV9zdGF0ZS0+Y29s
b3JfcGxhbmVbY29sb3JfcGxhbmVdLnk7CiAJdTMyIHNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBs
YW5lX3N0YXRlLT51YXBpLnNyYykgPj4gMTY7CiAJdTMyIHNyY19oID0gZHJtX3JlY3RfaGVpZ2h0
KCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVi
dWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCXU4IGFscGhhID0gcGxhbmVfc3RhdGUt
Pmh3LmFscGhhID4+IDg7CiAJdTMyIHBsYW5lX2NvbG9yX2N0bCA9IDA7CiAJdW5zaWduZWQgbG9u
ZyBpcnFmbGFnczsKQEAgLTIxMDYsNyArMjEwNyw4IEBAIHN0YXRpYyBpbnQgc2tsX3BsYW5lX2No
ZWNrX2ZiKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCSAgICAg
ZmItPm1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRCB8fAogCSAgICAgZmItPm1v
ZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUyB8fAogCSAgICAgZmItPm1vZGlm
aWVyID09IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRF9DQ1MgfHwKLQkgICAgIGZiLT5tb2RpZmll
ciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1MpKSB7CisJICAgICBmYi0+
bW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTIHx8CisJICAg
ICBmYi0+bW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfTUNfQ0NTKSkg
ewogCQlEUk1fREVCVUdfS01TKCJZL1lmIHRpbGluZyBub3Qgc3VwcG9ydGVkIGluIElGLUlEIG1v
ZGVcbiIpOwogCQlyZXR1cm4gLUVJTlZBTDsKIAl9CkBAIC0yNTc3LDcgKzI1NzksMTYgQEAgc3Rh
dGljIGNvbnN0IHU2NCBza2xfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19jY3NbXSA9IHsKIAlEUk1f
Rk9STUFUX01PRF9JTlZBTElECiB9OwogCi1zdGF0aWMgY29uc3QgdTY0IGdlbjEyX3BsYW5lX2Zv
cm1hdF9tb2RpZmllcnNfY2NzW10gPSB7CitzdGF0aWMgY29uc3QgdTY0IGdlbjEyX3BsYW5lX2Zv
cm1hdF9tb2RpZmllcnNfbWNfY2NzW10gPSB7CisJSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VO
MTJfTUNfQ0NTLAorCUk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUywKKwlJOTE1
X0ZPUk1BVF9NT0RfWV9USUxFRCwKKwlJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRCwKKwlEUk1fRk9S
TUFUX01PRF9MSU5FQVIsCisJRFJNX0ZPUk1BVF9NT0RfSU5WQUxJRAorfTsKKworc3RhdGljIGNv
bnN0IHU2NCBnZW4xMl9wbGFuZV9mb3JtYXRfbW9kaWZpZXJzX3JjX2Njc1tdID0gewogCUk5MTVf
Rk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUywKIAlJOTE1X0ZPUk1BVF9NT0RfWV9USUxF
RCwKIAlJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRCwKQEAgLTI3NDIsMTAgKzI3NTMsMjEgQEAgc3Rh
dGljIGJvb2wgc2tsX3BsYW5lX2Zvcm1hdF9tb2Rfc3VwcG9ydGVkKHN0cnVjdCBkcm1fcGxhbmUg
Kl9wbGFuZSwKIAl9CiB9CiAKK3N0YXRpYyBib29sIGdlbjEyX3BsYW5lX3N1cHBvcnRzX21jX2Nj
cyhlbnVtIHBsYW5lX2lkIHBsYW5lX2lkKQoreworCXJldHVybiBwbGFuZV9pZCA8IFBMQU5FX1NQ
UklURTQ7Cit9CisKIHN0YXRpYyBib29sIGdlbjEyX3BsYW5lX2Zvcm1hdF9tb2Rfc3VwcG9ydGVk
KHN0cnVjdCBkcm1fcGxhbmUgKl9wbGFuZSwKIAkJCQkJICAgICB1MzIgZm9ybWF0LCB1NjQgbW9k
aWZpZXIpCiB7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKF9w
bGFuZSk7CisKIAlzd2l0Y2ggKG1vZGlmaWVyKSB7CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9U
SUxFRF9HRU4xMl9NQ19DQ1M6CisJCWlmICghZ2VuMTJfcGxhbmVfc3VwcG9ydHNfbWNfY2NzKHBs
YW5lLT5pZCkpCisJCQlyZXR1cm4gZmFsc2U7CisJCS8qIGZhbGwgdGhyb3VnaCAqLwogCWNhc2Ug
RFJNX0ZPUk1BVF9NT0RfTElORUFSOgogCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQ6CiAJ
Y2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRDoKQEAgLTI3NjMsMTEgKzI3ODUsNiBAQCBzdGF0
aWMgYm9vbCBnZW4xMl9wbGFuZV9mb3JtYXRfbW9kX3N1cHBvcnRlZChzdHJ1Y3QgZHJtX3BsYW5l
ICpfcGxhbmUsCiAJCWlmIChpc19jY3NfbW9kaWZpZXIobW9kaWZpZXIpKQogCQkJcmV0dXJuIHRy
dWU7CiAJCS8qIGZhbGwgdGhyb3VnaCAqLwotCWNhc2UgRFJNX0ZPUk1BVF9SR0I1NjU6Ci0JY2Fz
ZSBEUk1fRk9STUFUX1hSR0IyMTAxMDEwOgotCWNhc2UgRFJNX0ZPUk1BVF9YQkdSMjEwMTAxMDoK
LQljYXNlIERSTV9GT1JNQVRfQVJHQjIxMDEwMTA6Ci0JY2FzZSBEUk1fRk9STUFUX0FCR1IyMTAx
MDEwOgogCWNhc2UgRFJNX0ZPUk1BVF9ZVVlWOgogCWNhc2UgRFJNX0ZPUk1BVF9ZVllVOgogCWNh
c2UgRFJNX0ZPUk1BVF9VWVZZOgpAQCAtMjc3Niw2ICsyNzkzLDE0IEBAIHN0YXRpYyBib29sIGdl
bjEyX3BsYW5lX2Zvcm1hdF9tb2Rfc3VwcG9ydGVkKHN0cnVjdCBkcm1fcGxhbmUgKl9wbGFuZSwK
IAljYXNlIERSTV9GT1JNQVRfUDAxMDoKIAljYXNlIERSTV9GT1JNQVRfUDAxMjoKIAljYXNlIERS
TV9GT1JNQVRfUDAxNjoKKwkJaWYgKG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVE
X0dFTjEyX01DX0NDUykKKwkJCXJldHVybiB0cnVlOworCQkvKiBmYWxsIHRocm91Z2ggKi8KKwlj
YXNlIERSTV9GT1JNQVRfUkdCNTY1OgorCWNhc2UgRFJNX0ZPUk1BVF9YUkdCMjEwMTAxMDoKKwlj
YXNlIERSTV9GT1JNQVRfWEJHUjIxMDEwMTA6CisJY2FzZSBEUk1fRk9STUFUX0FSR0IyMTAxMDEw
OgorCWNhc2UgRFJNX0ZPUk1BVF9BQkdSMjEwMTAxMDoKIAljYXNlIERSTV9GT1JNQVRfWFZZVTIx
MDEwMTA6CiAJY2FzZSBEUk1fRk9STUFUX0M4OgogCWNhc2UgRFJNX0ZPUk1BVF9YQkdSMTYxNjE2
MTZGOgpAQCAtMjkwOSw2ICsyOTM0LDE0IEBAIHN0YXRpYyBjb25zdCB1MzIgKmljbF9nZXRfcGxh
bmVfZm9ybWF0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJfQogfQogCitz
dGF0aWMgY29uc3QgdTY0ICpnZW4xMl9nZXRfcGxhbmVfbW9kaWZpZXJzKGVudW0gcGxhbmVfaWQg
cGxhbmVfaWQpCit7CisJaWYgKGdlbjEyX3BsYW5lX3N1cHBvcnRzX21jX2NjcyhwbGFuZV9pZCkp
CisJCXJldHVybiBnZW4xMl9wbGFuZV9mb3JtYXRfbW9kaWZpZXJzX21jX2NjczsKKwllbHNlCisJ
CXJldHVybiBnZW4xMl9wbGFuZV9mb3JtYXRfbW9kaWZpZXJzX3JjX2NjczsKK30KKwogc3RhdGlj
IGJvb2wgc2tsX3BsYW5lX2hhc19jY3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAogCQkJICAgICAgZW51bSBwaXBlIHBpcGUsIGVudW0gcGxhbmVfaWQgcGxhbmVfaWQpCiB7CkBA
IC0yOTc0LDcgKzMwMDcsNyBAQCBza2xfdW5pdmVyc2FsX3BsYW5lX2NyZWF0ZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAKIAlwbGFuZS0+aGFzX2NjcyA9IHNrbF9wbGFuZV9o
YXNfY2NzKGRldl9wcml2LCBwaXBlLCBwbGFuZV9pZCk7CiAJaWYgKElOVEVMX0dFTihkZXZfcHJp
dikgPj0gMTIpIHsKLQkJbW9kaWZpZXJzID0gZ2VuMTJfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19j
Y3M7CisJCW1vZGlmaWVycyA9IGdlbjEyX2dldF9wbGFuZV9tb2RpZmllcnMocGxhbmVfaWQpOwog
CQlwbGFuZV9mdW5jcyA9ICZnZW4xMl9wbGFuZV9mdW5jczsKIAl9IGVsc2UgewogCQlpZiAocGxh
bmUtPmhhc19jY3MpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5o
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaAppbmRleCBiYmZlZGViMDBiN2YuLmI2
ZGM3MzVlODVlMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oCkBAIC02ODA4LDYgKzY4MDgsNyBA
QCBlbnVtIHsKICNkZWZpbmUgICBQTEFORV9DVExfVElMRURfWQkJCSg0IDw8IDEwKQogI2RlZmlu
ZSAgIFBMQU5FX0NUTF9USUxFRF9ZRgkJCSg1IDw8IDEwKQogI2RlZmluZSAgIFBMQU5FX0NUTF9G
TElQX0hPUklaT05UQUwJCSgxIDw8IDgpCisjZGVmaW5lICAgUExBTkVfQ1RMX01FRElBX0RFQ09N
UFJFU1NJT05fRU5BQkxFCSgxIDw8IDQpIC8qIFRHTCsgKi8KICNkZWZpbmUgICBQTEFORV9DVExf
QUxQSEFfTUFTSwkJCSgweDMgPDwgNCkgLyogUHJlLUdMSyAqLwogI2RlZmluZSAgIFBMQU5FX0NU
TF9BTFBIQV9ESVNBQkxFCQkoMCA8PCA0KQogI2RlZmluZSAgIFBMQU5FX0NUTF9BTFBIQV9TV19Q
UkVNVUxUSVBMWQkoMiA8PCA0KQotLSAKMi4yMi4wCgpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBs
aXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1h
bi9saXN0aW5mby9pbnRlbC1nZngK

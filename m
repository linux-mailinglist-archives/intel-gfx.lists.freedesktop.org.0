Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 1F59FF8BC4
	for <lists+intel-gfx@lfdr.de>; Tue, 12 Nov 2019 10:29:40 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 156A86EA98;
	Tue, 12 Nov 2019 09:29:25 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BAF7E89E9B
 for <intel-gfx@lists.freedesktop.org>; Tue, 12 Nov 2019 09:29:15 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19170014-1500050 
 for multiple; Tue, 12 Nov 2019 09:28:57 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 12 Nov 2019 09:28:36 +0000
Message-Id: <20191112092854.869-9-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191112092854.869-1-chris@chris-wilson.co.uk>
References: <20191112092854.869-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 09/27] drm/i915: Remove i915->kernel_context
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWxsb2NhdGUgb25seSBhbiBpbnRlcm5hbCBpbnRlbF9jb250ZXh0IGZvciB0aGUga2VybmVsX2Nv
bnRleHQsIGZvcmdvaW5nCmEgZ2xvYmFsIEdFTSBjb250ZXh0IGZvciBpbnRlcm5hbCB1c2UgYXMg
d2Ugb25seSByZXF1aXJlIGEgc2VwYXJhdGUKYWRkcmVzcyBzcGFjZSAoZm9yIG91ciBvd24gcHJv
dGVjdGlvbikuCgpOb3cgaGF2aW5nIHdlYW5lZCBHVCBmcm9tIHJlcXVpcmluZyBjZS0+Z2VtX2Nv
bnRleHQsIHdlIGNhbiBzdG9wCnJlZmVyZW5jaW5nIGl0IGVudGlyZWx5LiBUaGlzIGFsc28gbWVh
bnMgd2Ugbm8gbG9uZ2VyIGhhdmUgdG8gY3JlYXRlIHJhbmRvbQphbmQgdW5uZWNlc3NhcnkgR0VN
IGNvbnRleHRzIGZvciBpbnRlcm5hbCB1c2UuCgpHRU0gY29udGV4dHMgYXJlIG5vdyBlbnRpcmVs
eSBmb3IgdHJhY2tpbmcgR0VNIGNsaWVudHMsIGFuZCBpbnRlbF9jb250ZXh0CnRoZSBleGVjdXRp
b24gZW52aXJvbm1lbnQgb24gdGhlIEdQVS4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8
Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9jb250ZXh0LmMgICB8ICA5MyArKysrKy0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaCAgIHwgICA1ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jICAgfCAgIDYgKy0KIC4uLi9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyB8ICAgNSArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0v
c2VsZnRlc3RzL21vY2tfY29udGV4dC5jIHwgIDExICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9jb250ZXh0LmMgICAgICAgfCAgMzIgKy0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfY29udGV4dC5oICAgICAgIHwgICA5ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9jb250ZXh0X3R5cGVzLmggfCAgMTEgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2VuZ2luZV9jcy5jICAgICB8ICAyMSArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2d0LmMgICAgICAgICAgICB8ICAyNSArKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2d0X3R5cGVzLmggICAgICB8ICAgNyArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9scmMuYyAgICAgICAgICAgfCAgMjEgKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9scmMuaCAgICAgICAgICAgfCAgIDYgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX3Jlc2V0LmMgICAgICAgICB8ICAxNCArLQogLi4uL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9y
aW5nX3N1Ym1pc3Npb24uYyAgIHwgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF9jb250ZXh0LmMgICAgfCAgNTcgKystLS0tLQogLi4uL2RybS9pOTE1L2d0L3NlbGZ0ZXN0
X2VuZ2luZV9oZWFydGJlYXQuYyAgIHwgICAzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9z
ZWxmdGVzdF9oYW5nY2hlY2suYyAgfCAxNDEgKysrKysrKy0tLS0tLS0tLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgICAgICAgIHwgMTUyICsrKysrKy0tLS0tLS0tLS0t
LQogLi4uL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jICAgIHwgIDcyICsr
KystLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jICAgICAgICAgIHwg
IDE2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jICAgICAgICAgICAgfCAg
IDIgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAgICAgICAgICAgICAgIHwgICAz
IC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgICAgICAgICAgICAgICB8ICAxOCAr
LS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jICAgICAgICAgICB8ICAgOCAr
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgICAgICAgICAgICAgIHwgICAzIC0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jICAgICAgICAgICB8ICAgNSArLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcmVxdWVzdC5jIHwgICA2ICstCiAu
Li4vZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYyAgfCAgIDggKy0KIDI5
IGZpbGVzIGNoYW5nZWQsIDI5NCBpbnNlcnRpb25zKCspLCA0NzAgZGVsZXRpb25zKC0pCgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXggY2Q1N2FhMTRm
ZTQzLi4wNjljZWZjMGMyNDEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X2NvbnRleHQuYwpAQCAtMjA4LDYgKzIwOCwzMiBAQCBjb250ZXh0X2dldF92bV9yY3Uoc3RydWN0
IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIAl9IHdoaWxlICgxKTsKIH0KIAorc3RhdGljIHZvaWQg
aW50ZWxfY29udGV4dF9zZXRfZ2VtKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKKwkJCQkgIHN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCit7CisJY2UtPmdlbV9jb250ZXh0ID0gY3R4Owor
CisJY2UtPnJpbmcgPSBfX2ludGVsX2NvbnRleHRfcmluZ19zaXplKFNaXzE2Syk7CisKKwlpZiAo
cmN1X2FjY2Vzc19wb2ludGVyKGN0eC0+dm0pKSB7CisJCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3Bh
Y2UgKnZtOworCisJCXJjdV9yZWFkX2xvY2soKTsKKwkJdm0gPSBjb250ZXh0X2dldF92bV9yY3Uo
Y3R4KTsgLyogaG1tICovCisJCXJjdV9yZWFkX3VubG9jaygpOworCisJCWk5MTVfdm1fcHV0KGNl
LT52bSk7CisJCWNlLT52bSA9IHZtOworCX0KKworCWlmIChjdHgtPnRpbWVsaW5lKQorCQljZS0+
dGltZWxpbmUgPSBpbnRlbF90aW1lbGluZV9nZXQoY3R4LT50aW1lbGluZSk7CisKKwlpZiAoY3R4
LT5zY2hlZC5wcmlvcml0eSA+PSBJOTE1X1BSSU9SSVRZX05PUk1BTCAmJgorCSAgICBpbnRlbF9l
bmdpbmVfaGFzX3NlbWFwaG9yZXMoY2UtPmVuZ2luZSkpCisJCV9fc2V0X2JpdChDT05URVhUX1VT
RV9TRU1BUEhPUkVTLCAmY2UtPmZsYWdzKTsKK30KKwogc3RhdGljIHZvaWQgX19mcmVlX2VuZ2lu
ZXMoc3RydWN0IGk5MTVfZ2VtX2VuZ2luZXMgKmUsIHVuc2lnbmVkIGludCBjb3VudCkKIHsKIAl3
aGlsZSAoY291bnQtLSkgewpAQCAtMjUwLDEyICsyNzYsMTQgQEAgc3RhdGljIHN0cnVjdCBpOTE1
X2dlbV9lbmdpbmVzICpkZWZhdWx0X2VuZ2luZXMoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0
eCkKIAkJR0VNX0JVR19PTihlbmdpbmUtPmxlZ2FjeV9pZHggPj0gSTkxNV9OVU1fRU5HSU5FUyk7
CiAJCUdFTV9CVUdfT04oZS0+ZW5naW5lc1tlbmdpbmUtPmxlZ2FjeV9pZHhdKTsKIAotCQljZSA9
IGludGVsX2NvbnRleHRfY3JlYXRlKGN0eCwgZW5naW5lKTsKKwkJY2UgPSBpbnRlbF9jb250ZXh0
X2NyZWF0ZShlbmdpbmUpOwogCQlpZiAoSVNfRVJSKGNlKSkgewogCQkJX19mcmVlX2VuZ2luZXMo
ZSwgZS0+bnVtX2VuZ2luZXMgKyAxKTsKIAkJCXJldHVybiBFUlJfQ0FTVChjZSk7CiAJCX0KIAor
CQlpbnRlbF9jb250ZXh0X3NldF9nZW0oY2UsIGN0eCk7CisKIAkJZS0+ZW5naW5lc1tlbmdpbmUt
PmxlZ2FjeV9pZHhdID0gY2U7CiAJCWUtPm51bV9lbmdpbmVzID0gbWF4KGUtPm51bV9lbmdpbmVz
LCBlbmdpbmUtPmxlZ2FjeV9pZHgpOwogCX0KQEAgLTcwNSwzNyArNzMzLDYgQEAgaTkxNV9nZW1f
Y3JlYXRlX2NvbnRleHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHVuc2lnbmVkIGlu
dCBmbGFncykKIAlyZXR1cm4gY3R4OwogfQogCi1zdGF0aWMgdm9pZAotZGVzdHJveV9rZXJuZWxf
Y29udGV4dChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqKmN0eHApCi17Ci0Jc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHQgKmN0eDsKLQotCS8qIEtlZXAgdGhlIGNvbnRleHQgcmVmIHNvIHRoYXQgd2Ug
Y2FuIGZyZWUgaXQgaW1tZWRpYXRlbHkgb3Vyc2VsdmVzICovCi0JY3R4ID0gaTkxNV9nZW1fY29u
dGV4dF9nZXQoZmV0Y2hfYW5kX3plcm8oY3R4cCkpOwotCUdFTV9CVUdfT04oIWk5MTVfZ2VtX2Nv
bnRleHRfaXNfa2VybmVsKGN0eCkpOwotCi0JY29udGV4dF9jbG9zZShjdHgpOwotCWk5MTVfZ2Vt
X2NvbnRleHRfZnJlZShjdHgpOwotfQotCi1zdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqCi1pOTE1
X2dlbV9jb250ZXh0X2NyZWF0ZV9rZXJuZWwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
IGludCBwcmlvKQotewotCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7Ci0KLQljdHggPSBp
OTE1X2dlbV9jcmVhdGVfY29udGV4dChpOTE1LCAwKTsKLQlpZiAoSVNfRVJSKGN0eCkpCi0JCXJl
dHVybiBjdHg7Ci0KLQlpOTE1X2dlbV9jb250ZXh0X2NsZWFyX2Jhbm5hYmxlKGN0eCk7Ci0JaTkx
NV9nZW1fY29udGV4dF9zZXRfcGVyc2lzdGVuY2UoY3R4KTsKLQljdHgtPnNjaGVkLnByaW9yaXR5
ID0gSTkxNV9VU0VSX1BSSU9SSVRZKHByaW8pOwotCi0JR0VNX0JVR19PTighaTkxNV9nZW1fY29u
dGV4dF9pc19rZXJuZWwoY3R4KSk7Ci0KLQlyZXR1cm4gY3R4OwotfQotCiBzdGF0aWMgdm9pZCBp
bml0X2NvbnRleHRzKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0cyAqZ2MpCiB7CiAJc3Bpbl9sb2Nr
X2luaXQoJmdjLT5sb2NrKTsKQEAgLTc0NSwzMiArNzQyLDE2IEBAIHN0YXRpYyB2b2lkIGluaXRf
Y29udGV4dHMoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHRzICpnYykKIAlpbml0X2xsaXN0X2hlYWQo
JmdjLT5mcmVlX2xpc3QpOwogfQogCi1pbnQgaTkxNV9nZW1faW5pdF9jb250ZXh0cyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3ZvaWQgaTkxNV9nZW1faW5pdF9fY29udGV4dHMoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQg
KmN0eDsKLQotCS8qIFJlYXNzdXJlIG91cnNlbHZlcyB3ZSBhcmUgb25seSBjYWxsZWQgb25jZSAq
LwotCUdFTV9CVUdfT04oaTkxNS0+a2VybmVsX2NvbnRleHQpOwotCiAJaW5pdF9jb250ZXh0cygm
aTkxNS0+Z2VtLmNvbnRleHRzKTsKLQotCS8qIGxvd2VzdCBwcmlvcml0eTsgaWRsZSB0YXNrICov
Ci0JY3R4ID0gaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKGk5MTUsIEk5MTVfUFJJT1JJ
VFlfTUlOKTsKLQlpZiAoSVNfRVJSKGN0eCkpIHsKLQkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gY3Jl
YXRlIGRlZmF1bHQgZ2xvYmFsIGNvbnRleHRcbiIpOwotCQlyZXR1cm4gUFRSX0VSUihjdHgpOwot
CX0KLQlpOTE1LT5rZXJuZWxfY29udGV4dCA9IGN0eDsKLQogCURSTV9ERUJVR19EUklWRVIoIiVz
IGNvbnRleHQgc3VwcG9ydCBpbml0aWFsaXplZFxuIiwKIAkJCSBEUklWRVJfQ0FQUyhpOTE1KS0+
aGFzX2xvZ2ljYWxfY29udGV4dHMgPwogCQkJICJsb2dpY2FsIiA6ICJmYWtlIik7Ci0JcmV0dXJu
IDA7CiB9CiAKIHZvaWQgaTkxNV9nZW1fZHJpdmVyX3JlbGVhc2VfX2NvbnRleHRzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogewotCWRlc3Ryb3lfa2VybmVsX2NvbnRleHQoJmk5MTUt
Pmtlcm5lbF9jb250ZXh0KTsKIAlmbHVzaF93b3JrKCZpOTE1LT5nZW0uY29udGV4dHMuZnJlZV93
b3JrKTsKIH0KIApAQCAtMTUyMywxMiArMTUwNCwxNCBAQCBzZXRfZW5naW5lc19fbG9hZF9iYWxh
bmNlKHN0cnVjdCBpOTE1X3VzZXJfZXh0ZW5zaW9uIF9fdXNlciAqYmFzZSwgdm9pZCAqZGF0YSkK
IAkJfQogCX0KIAotCWNlID0gaW50ZWxfZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFsKHNldC0+Y3R4
LCBzaWJsaW5ncywgbik7CisJY2UgPSBpbnRlbF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1YWwoc2li
bGluZ3MsIG4pOwogCWlmIChJU19FUlIoY2UpKSB7CiAJCWVyciA9IFBUUl9FUlIoY2UpOwogCQln
b3RvIG91dF9zaWJsaW5nczsKIAl9CiAKKwlpbnRlbF9jb250ZXh0X3NldF9nZW0oY2UsIHNldC0+
Y3R4KTsKKwogCWlmIChjbXB4Y2hnKCZzZXQtPmVuZ2luZXMtPmVuZ2luZXNbaWR4XSwgTlVMTCwg
Y2UpKSB7CiAJCWludGVsX2NvbnRleHRfcHV0KGNlKTsKIAkJZXJyID0gLUVFWElTVDsKQEAgLTE2
OTgsMTIgKzE2ODEsMTQgQEAgc2V0X2VuZ2luZXMoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0
eCwKIAkJCXJldHVybiAtRU5PRU5UOwogCQl9CiAKLQkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0
ZShjdHgsIGVuZ2luZSk7CisJCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKIAkJ
aWYgKElTX0VSUihjZSkpIHsKIAkJCV9fZnJlZV9lbmdpbmVzKHNldC5lbmdpbmVzLCBuKTsKIAkJ
CXJldHVybiBQVFJfRVJSKGNlKTsKIAkJfQogCisJCWludGVsX2NvbnRleHRfc2V0X2dlbShjZSwg
Y3R4KTsKKwogCQlzZXQuZW5naW5lcy0+ZW5naW5lc1tuXSA9IGNlOwogCX0KIAlzZXQuZW5naW5l
cy0+bnVtX2VuZ2luZXMgPSBudW1fZW5naW5lczsKQEAgLTIwMDQsMTMgKzE5ODksMTUgQEAgc3Rh
dGljIGludCBjbG9uZV9lbmdpbmVzKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpkc3QsCiAJCSAq
LwogCQlpZiAoaW50ZWxfZW5naW5lX2lzX3ZpcnR1YWwoZW5naW5lKSkKIAkJCWNsb25lLT5lbmdp
bmVzW25dID0KLQkJCQlpbnRlbF9leGVjbGlzdHNfY2xvbmVfdmlydHVhbChkc3QsIGVuZ2luZSk7
CisJCQkJaW50ZWxfZXhlY2xpc3RzX2Nsb25lX3ZpcnR1YWwoZW5naW5lKTsKIAkJZWxzZQotCQkJ
Y2xvbmUtPmVuZ2luZXNbbl0gPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShkc3QsIGVuZ2luZSk7CisJ
CQljbG9uZS0+ZW5naW5lc1tuXSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CiAJCWlm
IChJU19FUlJfT1JfTlVMTChjbG9uZS0+ZW5naW5lc1tuXSkpIHsKIAkJCV9fZnJlZV9lbmdpbmVz
KGNsb25lLCBuKTsKIAkJCWdvdG8gZXJyX3VubG9jazsKIAkJfQorCisJCWludGVsX2NvbnRleHRf
c2V0X2dlbShjbG9uZS0+ZW5naW5lc1tuXSwgZHN0KTsKIAl9CiAJY2xvbmUtPm51bV9lbmdpbmVz
ID0gbjsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2Nv
bnRleHQuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmgKaW5k
ZXggNjk5MzI4OTk4MDNlLi5jNTE5YjlmOGQ4M2IgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX2NvbnRleHQuaApAQCAtMTE1LDcgKzExNSw3IEBAIHN0YXRpYyBpbmxpbmUg
Ym9vbCBpOTE1X2dlbV9jb250ZXh0X2lzX2tlcm5lbChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAq
Y3R4KQogfQogCiAvKiBpOTE1X2dlbV9jb250ZXh0LmMgKi8KLWludCBfX211c3RfY2hlY2sgaTkx
NV9nZW1faW5pdF9jb250ZXh0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lk
IGk5MTVfZ2VtX2luaXRfX2NvbnRleHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsK
IHZvaWQgaTkxNV9nZW1fZHJpdmVyX3JlbGVhc2VfX2NvbnRleHRzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KTsKIAogaW50IGk5MTVfZ2VtX2NvbnRleHRfb3BlbihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKQEAgLTE0MCw5ICsxNDAsNiBAQCBpbnQgaTkxNV9nZW1fY29udGV4
dF9zZXRwYXJhbV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogaW50
IGk5MTVfZ2VtX2NvbnRleHRfcmVzZXRfc3RhdHNfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRl
diwgdm9pZCAqZGF0YSwKIAkJCQkgICAgICAgc3RydWN0IGRybV9maWxlICpmaWxlKTsKIAotc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKgotaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBpbnQgcHJpbyk7Ci0KIHN0YXRpYyBpbmxpbmUg
c3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKgogaTkxNV9nZW1fY29udGV4dF9nZXQoc3RydWN0IGk5
MTVfZ2VtX2NvbnRleHQgKmN0eCkKIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV91c2VycHRyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fdXNlcnB0ci5jCmluZGV4IDU0ZWJjN2FiNzFiYy4uNWRjY2M5NzU3OTQ3IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMKQEAgLTc3OCwxNSArNzc4LDEx
IEBAIGk5MTVfZ2VtX3VzZXJwdHJfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJcmV0
dXJuIC1FRkFVTFQ7CiAKIAlpZiAoYXJncy0+ZmxhZ3MgJiBJOTE1X1VTRVJQVFJfUkVBRF9PTkxZ
KSB7Ci0JCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwotCiAJCS8qCiAJCSAqIE9uIGFs
bW9zdCBhbGwgb2YgdGhlIG9sZGVyIGh3LCB3ZSBjYW5ub3QgdGVsbCB0aGUgR1BVIHRoYXQKIAkJ
ICogYSBwYWdlIGlzIHJlYWRvbmx5LgogCQkgKi8KLQkJdm0gPSByY3VfZGVyZWZlcmVuY2VfcHJv
dGVjdGVkKGRldl9wcml2LT5rZXJuZWxfY29udGV4dC0+dm0sCi0JCQkJCSAgICAgICB0cnVlKTsg
Lyogc3RhdGljIHZtICovCi0JCWlmICghdm0gfHwgIXZtLT5oYXNfcmVhZF9vbmx5KQorCQlpZiAo
IWRldl9wcml2LT5ndC52bS0+aGFzX3JlYWRfb25seSkKIAkJCXJldHVybiAtRU5PREVWOwogCX0K
IApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dl
bV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2Vt
X2NvbnRleHQuYwppbmRleCA5YTUwOWMxOGI3YzcuLjEwNmEzYmZhM2JiNiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMK
QEAgLTMxNSw3ICszMTUsNyBAQCBzdGF0aWMgaW50IGxpdmVfcGFyYWxsZWxfc3dpdGNoKHZvaWQg
KmFyZykKIAkJCWlmICghZGF0YVttXS5jZVswXSkKIAkJCQljb250aW51ZTsKIAotCQkJY2UgPSBp
bnRlbF9jb250ZXh0X2NyZWF0ZShjdHgsIGRhdGFbbV0uY2VbMF0tPmVuZ2luZSk7CisJCQljZSA9
IGludGVsX2NvbnRleHRfY3JlYXRlKGRhdGFbbV0uY2VbMF0tPmVuZ2luZSk7CiAJCQlpZiAoSVNf
RVJSKGNlKSkKIAkJCQlnb3RvIG91dDsKIApAQCAtMTIzOSw4ICsxMjM5LDcgQEAgX19pZ3RfY3R4
X3NzZXUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQlod2VpZ2h0MzIoZW5naW5l
LT5zc2V1LnNsaWNlX21hc2spLAogCQkJaHdlaWdodDMyKHBnX3NzZXUuc2xpY2VfbWFzaykpOwog
Ci0JCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lLT5rZXJuZWxfY29udGV4dC0+Z2Vt
X2NvbnRleHQsCi0JCQkJCSAgZW5naW5lKTsKKwkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShl
bmdpbmUpOwogCQlpZiAoSVNfRVJSKGNlKSkgewogCQkJcmV0ID0gUFRSX0VSUihjZSk7CiAJCQln
b3RvIG91dF9wdXQ7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRl
c3RzL21vY2tfY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9t
b2NrX2NvbnRleHQuYwppbmRleCA1M2U4OWVmYjA5YzAuLmZkZjJmMTIwMjM0YyAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL21vY2tfY29udGV4dC5jCkBAIC05
Niw3ICs5NiwxNiBAQCBsaXZlX2NvbnRleHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
IHN0cnVjdCBmaWxlICpmaWxlKQogc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKgoga2VybmVsX2Nv
bnRleHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JcmV0dXJuIGk5MTVfZ2Vt
X2NvbnRleHRfY3JlYXRlX2tlcm5lbChpOTE1LCBJOTE1X1BSSU9SSVRZX05PUk1BTCk7CisJc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKKworCWN0eCA9IGk5MTVfZ2VtX2NyZWF0ZV9jb250
ZXh0KGk5MTUsIDApOworCWlmIChJU19FUlIoY3R4KSkKKwkJcmV0dXJuIGN0eDsKKworCUdFTV9C
VUdfT04oIWk5MTVfZ2VtX2NvbnRleHRfaXNfa2VybmVsKGN0eCkpOworCWk5MTVfZ2VtX2NvbnRl
eHRfY2xlYXJfYmFubmFibGUoY3R4KTsKKworCXJldHVybiBjdHg7CiB9CiAKIHZvaWQga2VybmVs
X2NvbnRleHRfY2xvc2Uoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYwppbmRleCA3MDc1ZDAzZjUwOGYuLjA0YWEwNzU5YmUz
OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYwpAQCAtMzEsOCArMzEs
NyBAQCB2b2lkIGludGVsX2NvbnRleHRfZnJlZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiB9
CiAKIHN0cnVjdCBpbnRlbF9jb250ZXh0ICoKLWludGVsX2NvbnRleHRfY3JlYXRlKHN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0ICpjdHgsCi0JCSAgICAgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lKQoraW50ZWxfY29udGV4dF9jcmVhdGUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5l
KQogewogCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIApAQCAtNDAsNyArMzksNyBAQCBpbnRl
bF9jb250ZXh0X2NyZWF0ZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogCWlmICghY2Up
CiAJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwogCi0JaW50ZWxfY29udGV4dF9pbml0KGNlLCBj
dHgsIGVuZ2luZSk7CisJaW50ZWxfY29udGV4dF9pbml0KGNlLCBlbmdpbmUpOwogCXJldHVybiBj
ZTsKIH0KIApAQCAtNzIsOCArNzEsNiBAQCBpbnQgX19pbnRlbF9jb250ZXh0X2RvX3BpbihzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAJCQkgIGNlLT5lbmdpbmUtPm5hbWUsIGNlLT50aW1lbGlu
ZS0+ZmVuY2VfY29udGV4dCwKIAkJCSAgY2UtPnJpbmctPmhlYWQsIGNlLT5yaW5nLT50YWlsKTsK
IAotCQlpOTE1X2dlbV9jb250ZXh0X2dldChjZS0+Z2VtX2NvbnRleHQpOyAvKiBmb3IgY3R4LT5w
cGd0dCAqLwotCiAJCXNtcF9tYl9fYmVmb3JlX2F0b21pYygpOyAvKiBmbHVzaCBwaW4gYmVmb3Jl
IGl0IGlzIHZpc2libGUgKi8KIAl9CiAKQEAgLTEwMyw3ICsxMDAsNiBAQCB2b2lkIGludGVsX2Nv
bnRleHRfdW5waW4oc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogCiAJCWNlLT5vcHMtPnVucGlu
KGNlKTsKIAotCQlpOTE1X2dlbV9jb250ZXh0X3B1dChjZS0+Z2VtX2NvbnRleHQpOwogCQlpbnRl
bF9jb250ZXh0X2FjdGl2ZV9yZWxlYXNlKGNlKTsKIAl9CiAKQEAgLTE5OCw3ICsxOTQsNyBAQCBp
bnQgaW50ZWxfY29udGV4dF9hY3RpdmVfYWNxdWlyZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2Up
CiAJCXJldHVybiBlcnI7CiAKIAkvKiBQcmVhbGxvY2F0ZSB0cmFja2luZyBub2RlcyAqLwotCWlm
ICghaTkxNV9nZW1fY29udGV4dF9pc19rZXJuZWwoY2UtPmdlbV9jb250ZXh0KSkgeworCWlmICgh
aW50ZWxfY29udGV4dF9pc19iYXJyaWVyKGNlKSkgewogCQllcnIgPSBpOTE1X2FjdGl2ZV9hY3F1
aXJlX3ByZWFsbG9jYXRlX2JhcnJpZXIoJmNlLT5hY3RpdmUsCiAJCQkJCQkJICAgICAgY2UtPmVu
Z2luZSk7CiAJCWlmIChlcnIpIHsKQEAgLTIxOSwzMyArMjE1LDE5IEBAIHZvaWQgaW50ZWxfY29u
dGV4dF9hY3RpdmVfcmVsZWFzZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAKIHZvaWQKIGlu
dGVsX2NvbnRleHRfaW5pdChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCi0JCSAgIHN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCSAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZSkKIHsKLQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKLQogCUdFTV9CVUdfT04oIWVu
Z2luZS0+Y29wcyk7CisJR0VNX0JVR19PTighZW5naW5lLT5ndC0+dm0pOwogCiAJa3JlZl9pbml0
KCZjZS0+cmVmKTsKIAotCWNlLT5nZW1fY29udGV4dCA9IGN0eDsKLQlyY3VfcmVhZF9sb2NrKCk7
Ci0Jdm0gPSByY3VfZGVyZWZlcmVuY2UoY3R4LT52bSk7Ci0JaWYgKHZtKQotCQljZS0+dm0gPSBp
OTE1X3ZtX2dldCh2bSk7Ci0JZWxzZQotCQljZS0+dm0gPSBpOTE1X3ZtX2dldCgmZW5naW5lLT5n
dC0+Z2d0dC0+dm0pOwotCXJjdV9yZWFkX3VubG9jaygpOwotCWlmIChjdHgtPnRpbWVsaW5lKQot
CQljZS0+dGltZWxpbmUgPSBpbnRlbF90aW1lbGluZV9nZXQoY3R4LT50aW1lbGluZSk7Ci0JaWYg
KGN0eC0+c2NoZWQucHJpb3JpdHkgPj0gSTkxNV9QUklPUklUWV9OT1JNQUwgJiYKLQkgICAgaW50
ZWxfZW5naW5lX2hhc19zZW1hcGhvcmVzKGVuZ2luZSkpCi0JCV9fc2V0X2JpdChDT05URVhUX1VT
RV9TRU1BUEhPUkVTLCAmY2UtPmZsYWdzKTsKLQogCWNlLT5lbmdpbmUgPSBlbmdpbmU7CiAJY2Ut
Pm9wcyA9IGVuZ2luZS0+Y29wczsKIAljZS0+c3NldSA9IGVuZ2luZS0+c3NldTsKLQljZS0+cmlu
ZyA9IF9faW50ZWxfY29udGV4dF9yaW5nX3NpemUoU1pfMTZLKTsKKwljZS0+cmluZyA9IF9faW50
ZWxfY29udGV4dF9yaW5nX3NpemUoU1pfNEspOworCisJY2UtPnZtID0gaTkxNV92bV9nZXQoZW5n
aW5lLT5ndC0+dm0pOwogCiAJSU5JVF9MSVNUX0hFQUQoJmNlLT5zaWduYWxfbGluayk7CiAJSU5J
VF9MSVNUX0hFQUQoJmNlLT5zaWduYWxzKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2NvbnRleHQuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Nv
bnRleHQuaAppbmRleCBkN2I2NjdhMjZlMDguLjgwZDRjMmFjYzcyOSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5oCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2NvbnRleHQuaApAQCAtMTgsMTMgKzE4LDExIEBACiAjaW5jbHVkZSAi
aW50ZWxfdGltZWxpbmVfdHlwZXMuaCIKIAogdm9pZCBpbnRlbF9jb250ZXh0X2luaXQoc3RydWN0
IGludGVsX2NvbnRleHQgKmNlLAotCQkJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJ
CXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSk7CiB2b2lkIGludGVsX2NvbnRleHRfZmlu
aShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpOwogCiBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqCi1p
bnRlbF9jb250ZXh0X2NyZWF0ZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAotCQkgICAg
IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSk7CitpbnRlbF9jb250ZXh0X2NyZWF0ZShz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOwogCiB2b2lkIGludGVsX2NvbnRleHRfZnJl
ZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpOwogCkBAIC0xNTUsNiArMTUzLDExIEBAIHN0YXRp
YyBpbmxpbmUgc3RydWN0IGludGVsX3JpbmcgKl9faW50ZWxfY29udGV4dF9yaW5nX3NpemUodTY0
IHN6KQogCXJldHVybiB1NjRfdG9fcHRyKHN0cnVjdCBpbnRlbF9yaW5nLCBzeik7CiB9CiAKK3N0
YXRpYyBpbmxpbmUgYm9vbCBpbnRlbF9jb250ZXh0X2lzX2JhcnJpZXIoY29uc3Qgc3RydWN0IGlu
dGVsX2NvbnRleHQgKmNlKQoreworCXJldHVybiB0ZXN0X2JpdChDT05URVhUX0JBUlJJRVJfQklU
LCAmY2UtPmZsYWdzKTsKK30KKwogc3RhdGljIGlubGluZSBib29sIGludGVsX2NvbnRleHRfdXNl
X3NlbWFwaG9yZXMoY29uc3Qgc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogewogCXJldHVybiB0
ZXN0X2JpdChDT05URVhUX1VTRV9TRU1BUEhPUkVTLCAmY2UtPmZsYWdzKTsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHRfdHlwZXMuaCBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHRfdHlwZXMuaAppbmRleCAyNjRjMWVmZGU3NzIu
LmJhNDZjMzZhODhhMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
Y29udGV4dF90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRl
eHRfdHlwZXMuaApAQCAtNTQsMTEgKzU0LDEyIEBAIHN0cnVjdCBpbnRlbF9jb250ZXh0IHsKIAlz
dHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRpbWVsaW5lOwogCiAJdW5zaWduZWQgbG9uZyBmbGFnczsK
LSNkZWZpbmUgQ09OVEVYVF9BTExPQ19CSVQJCTAKLSNkZWZpbmUgQ09OVEVYVF9VU0VfU0VNQVBI
T1JFUwkJMQotI2RlZmluZSBDT05URVhUX0JBTk5FRAkJCTIKLSNkZWZpbmUgQ09OVEVYVF9GT1JD
RV9TSU5HTEVfU1VCTUlTU0lPTgkzCi0jZGVmaW5lIENPTlRFWFRfTk9QUkVFTVBUCQk0CisjZGVm
aW5lIENPTlRFWFRfQkFSUklFUl9CSVQJCTAKKyNkZWZpbmUgQ09OVEVYVF9BTExPQ19CSVQJCTEK
KyNkZWZpbmUgQ09OVEVYVF9VU0VfU0VNQVBIT1JFUwkJMgorI2RlZmluZSBDT05URVhUX0JBTk5F
RAkJCTMKKyNkZWZpbmUgQ09OVEVYVF9GT1JDRV9TSU5HTEVfU1VCTUlTU0lPTgk0CisjZGVmaW5l
IENPTlRFWFRfTk9QUkVFTVBUCQk1CiAKIAl1MzIgKmxyY19yZWdfc3RhdGU7CiAJdTY0IGxyY19k
ZXNjOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2Nz
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYwppbmRleCBjN2Ri
OGJmZTE4ZjQuLjM1MDY5NmJhMzFiZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZW5naW5lX2NzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
ZW5naW5lX2NzLmMKQEAgLTc1OCwxMSArNzU4LDExIEBAIGNyZWF0ZV9rZXJuZWxfY29udGV4dChz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNl
OwogCWludCBlcnI7CiAKLQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZS0+aTkxNS0+
a2VybmVsX2NvbnRleHQsIGVuZ2luZSk7CisJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdp
bmUpOwogCWlmIChJU19FUlIoY2UpKQogCQlyZXR1cm4gY2U7CiAKLQljZS0+cmluZyA9IF9faW50
ZWxfY29udGV4dF9yaW5nX3NpemUoU1pfNEspOworCV9fc2V0X2JpdChDT05URVhUX0JBUlJJRVJf
QklULCAmY2UtPmZsYWdzKTsKIAogCWVyciA9IGludGVsX2NvbnRleHRfcGluKGNlKTsKIAlpZiAo
ZXJyKSB7CkBAIC03OTksNiArNzk5LDEyIEBAIGludCBpbnRlbF9lbmdpbmVfaW5pdF9jb21tb24o
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCiAJZW5naW5lLT5zZXRfZGVmYXVsdF9z
dWJtaXNzaW9uKGVuZ2luZSk7CiAKKwlyZXQgPSBtZWFzdXJlX2JyZWFkY3J1bWJfZHcoZW5naW5l
KTsKKwlpZiAocmV0IDwgMCkKKwkJcmV0dXJuIHJldDsKKworCWVuZ2luZS0+ZW1pdF9maW5pX2Jy
ZWFkY3J1bWJfZHcgPSByZXQ7CisKIAkvKgogCSAqIFdlIG1heSBuZWVkIHRvIGRvIHRoaW5ncyB3
aXRoIHRoZSBzaHJpbmtlciB3aGljaAogCSAqIHJlcXVpcmUgdXMgdG8gaW1tZWRpYXRlbHkgc3dp
dGNoIGJhY2sgdG8gdGhlIGRlZmF1bHQKQEAgLTgxMywxOCArODE5LDcgQEAgaW50IGludGVsX2Vu
Z2luZV9pbml0X2NvbW1vbihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAKIAllbmdp
bmUtPmtlcm5lbF9jb250ZXh0ID0gY2U7CiAKLQlyZXQgPSBtZWFzdXJlX2JyZWFkY3J1bWJfZHco
ZW5naW5lKTsKLQlpZiAocmV0IDwgMCkKLQkJZ290byBlcnJfdW5waW47Ci0KLQllbmdpbmUtPmVt
aXRfZmluaV9icmVhZGNydW1iX2R3ID0gcmV0OwotCiAJcmV0dXJuIDA7Ci0KLWVycl91bnBpbjoK
LQlpbnRlbF9jb250ZXh0X3VucGluKGNlKTsKLQlpbnRlbF9jb250ZXh0X3B1dChjZSk7Ci0JcmV0
dXJuIHJldDsKIH0KIAogLyoqCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9ndC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYwppbmRleCBjMzli
MjFjOGQzMjguLjRjMDc4MjQ3ODI1ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZ3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jCkBA
IC03NCw3ICs3NCw2IEBAIGludCBpbnRlbF9ndF9pbml0X2h3KHN0cnVjdCBpbnRlbF9ndCAqZ3Qp
CiAJc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gZ3QtPnVuY29yZTsKIAlpbnQgcmV0Owog
Ci0JQlVHX09OKCFpOTE1LT5rZXJuZWxfY29udGV4dCk7CiAJcmV0ID0gaW50ZWxfZ3RfdGVybWlu
YWxseV93ZWRnZWQoZ3QpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CkBAIC0zNjUsNiArMzY0
LDE0IEBAIHN0YXRpYyB2b2lkIGludGVsX2d0X2Zpbmlfc2NyYXRjaChzdHJ1Y3QgaW50ZWxfZ3Qg
Kmd0KQogCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZndC0+c2NyYXRjaCwgMCk7CiB9CiAK
K3N0YXRpYyBzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICprZXJuZWxfdm0oc3RydWN0IGludGVs
X2d0ICpndCkKK3sKKwlpZiAoSU5URUxfUFBHVFQoZ3QtPmk5MTUpID4gSU5URUxfUFBHVFRfQUxJ
QVNJTkcpCisJCXJldHVybiAmaTkxNV9wcGd0dF9jcmVhdGUoZ3QtPmk5MTUpLT52bTsKKwllbHNl
CisJCXJldHVybiBpOTE1X3ZtX2dldCgmZ3QtPmdndHQtPnZtKTsKK30KKwogaW50IGludGVsX2d0
X2luaXQoc3RydWN0IGludGVsX2d0ICpndCkKIHsKIAlpbnQgZXJyOwpAQCAtMzc1LDcgKzM4Miwx
NyBAQCBpbnQgaW50ZWxfZ3RfaW5pdChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogCiAJaW50ZWxfZ3Rf
cG1faW5pdChndCk7CiAKKwlndC0+dm0gPSBrZXJuZWxfdm0oZ3QpOworCWlmICghZ3QtPnZtKSB7
CisJCWVyciA9IC1FTk9NRU07CisJCWdvdG8gZXJyX3NjcmF0Y2g7CisJfQorCiAJcmV0dXJuIDA7
CisKK2Vycl9zY3JhdGNoOgorCWludGVsX2d0X2Zpbmlfc2NyYXRjaChndCk7CisJcmV0dXJuIGVy
cjsKIH0KIAogdm9pZCBpbnRlbF9ndF9kcml2ZXJfcmVtb3ZlKHN0cnVjdCBpbnRlbF9ndCAqZ3Qp
CkBAIC0zOTAsNiArNDA3LDEyIEBAIHZvaWQgaW50ZWxfZ3RfZHJpdmVyX3VucmVnaXN0ZXIoc3Ry
dWN0IGludGVsX2d0ICpndCkKIAogdm9pZCBpbnRlbF9ndF9kcml2ZXJfcmVsZWFzZShzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0KQogeworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOworCisJdm0g
PSBmZXRjaF9hbmRfemVybygmZ3QtPnZtKTsKKwlpZiAodm0pIC8qIEZJWE1FIGJlaW5nIGNhbGxl
ZCB0d2ljZSBvbiBlcnJvciBwYXRocyA6KCAqLworCQlpOTE1X3ZtX3B1dCh2bSk7CisKIAlpbnRl
bF9ndF9wbV9maW5pKGd0KTsKIAlpbnRlbF9ndF9maW5pX3NjcmF0Y2goZ3QpOwogfQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaCBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmgKaW5kZXggZDRlMTRkYmQxNzJlLi45Njg5
MGRkMTJiNWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5
cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaApAQCAt
OTAsNiArOTAsMTMgQEAgc3RydWN0IGludGVsX2d0IHsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmVbSTkxNV9OVU1fRU5HSU5FU107CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lX2NsYXNzW01BWF9FTkdJTkVfQ0xBU1MgKyAxXQogCQkJCQkgICAgW01BWF9FTkdJTkVfSU5T
VEFOQ0UgKyAxXTsKKworCS8qCisJICogRGVmYXVsdCBhZGRyZXNzIHNwYWNlIChlaXRoZXIgR0dU
VCBvciBwcEdUVCBkZXBlbmRpbmcgb24gYXJjaCkuCisJICoKKwkgKiBSZXNlcnZlZCBmb3IgZXhj
bHVzaXZlIHVzZSBieSB0aGUga2VybmVsLgorCSAqLworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3Bh
Y2UgKnZtOwogfTsKIAogZW51bSBpbnRlbF9ndF9zY3JhdGNoX2ZpZWxkIHsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfbHJjLmMKaW5kZXggNjc2OGZjNDE3NmYwLi40YjBiZTkxMjFjOTMgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCkBAIC0xMzMsMTIgKzEzMywxMSBAQAogICovCiAj
aW5jbHVkZSA8bGludXgvaW50ZXJydXB0Lmg+CiAKLSNpbmNsdWRlICJnZW0vaTkxNV9nZW1fY29u
dGV4dC5oIgotCiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIKICNpbmNsdWRlICJpOTE1X3BlcmYuaCIK
ICNpbmNsdWRlICJpOTE1X3RyYWNlLmgiCiAjaW5jbHVkZSAiaTkxNV92Z3B1LmgiCisjaW5jbHVk
ZSAiaW50ZWxfY29udGV4dC5oIgogI2luY2x1ZGUgImludGVsX2VuZ2luZV9wbS5oIgogI2luY2x1
ZGUgImludGVsX2d0LmgiCiAjaW5jbHVkZSAiaW50ZWxfZ3RfcG0uaCIKQEAgLTEzMDIsNyArMTMw
MSw4IEBAIGFzc2VydF9wZW5kaW5nX3ZhbGlkKGNvbnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfZXhl
Y2xpc3RzICpleGVjbGlzdHMsCiAJCWlmIChpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJxKSkKIAkJ
CWNvbnRpbnVlOwogCi0JCWlmIChpOTE1X2FjdGl2ZV9pc19pZGxlKCZjZS0+YWN0aXZlKSAmJiBj
ZS0+Z2VtX2NvbnRleHQpIHsKKwkJaWYgKGk5MTVfYWN0aXZlX2lzX2lkbGUoJmNlLT5hY3RpdmUp
ICYmCisJCSAgICAhaW50ZWxfY29udGV4dF9pc19iYXJyaWVyKGNlKSkgewogCQkJR0VNX1RSQUNF
X0VSUigiSW5hY3RpdmUgY29udGV4dDolbGx4IGluIHBlbmRpbmdbJXpkXVxuIiwKIAkJCQkgICAg
ICBjZS0+dGltZWxpbmUtPmZlbmNlX2NvbnRleHQsCiAJCQkJICAgICAgcG9ydCAtIGV4ZWNsaXN0
cy0+cGVuZGluZyk7CkBAIC00NDMzLDggKzQ0MzMsNyBAQCB2aXJ0dWFsX2JvbmRfZXhlY3V0ZShz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgc3RydWN0IGRtYV9mZW5jZSAqc2lnbmFsKQogfQogCiBz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqCi1pbnRlbF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1YWwoc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKLQkJCSAgICAgICBzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICoqc2libGluZ3MsCitpbnRlbF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1YWwoc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqKnNpYmxpbmdzLAogCQkJICAgICAgIHVuc2lnbmVkIGludCBjb3VudCkK
IHsKIAlzdHJ1Y3QgdmlydHVhbF9lbmdpbmUgKnZlOwpAQCAtNDQ0NSwxMyArNDQ0NCwxMyBAQCBp
bnRlbF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1YWwoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0
eCwKIAkJcmV0dXJuIEVSUl9QVFIoLUVJTlZBTCk7CiAKIAlpZiAoY291bnQgPT0gMSkKLQkJcmV0
dXJuIGludGVsX2NvbnRleHRfY3JlYXRlKGN0eCwgc2libGluZ3NbMF0pOworCQlyZXR1cm4gaW50
ZWxfY29udGV4dF9jcmVhdGUoc2libGluZ3NbMF0pOwogCiAJdmUgPSBremFsbG9jKHN0cnVjdF9z
aXplKHZlLCBzaWJsaW5ncywgY291bnQpLCBHRlBfS0VSTkVMKTsKIAlpZiAoIXZlKQogCQlyZXR1
cm4gRVJSX1BUUigtRU5PTUVNKTsKIAotCXZlLT5iYXNlLmk5MTUgPSBjdHgtPmk5MTU7CisJdmUt
PmJhc2UuaTkxNSA9IHNpYmxpbmdzWzBdLT5pOTE1OwogCXZlLT5iYXNlLmd0ID0gc2libGluZ3Nb
MF0tPmd0OwogCXZlLT5iYXNlLnVuY29yZSA9IHNpYmxpbmdzWzBdLT51bmNvcmU7CiAJdmUtPmJh
c2UuaWQgPSAtMTsKQEAgLTQ0OTQsNyArNDQ5Myw3IEBAIGludGVsX2V4ZWNsaXN0c19jcmVhdGVf
dmlydHVhbChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogCQkgICAgIHZpcnR1YWxfc3Vi
bWlzc2lvbl90YXNrbGV0LAogCQkgICAgICh1bnNpZ25lZCBsb25nKXZlKTsKIAotCWludGVsX2Nv
bnRleHRfaW5pdCgmdmUtPmNvbnRleHQsIGN0eCwgJnZlLT5iYXNlKTsKKwlpbnRlbF9jb250ZXh0
X2luaXQoJnZlLT5jb250ZXh0LCAmdmUtPmJhc2UpOwogCiAJZm9yIChuID0gMDsgbiA8IGNvdW50
OyBuKyspIHsKIAkJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqc2libGluZyA9IHNpYmxpbmdzW25d
OwpAQCAtNDU3NSwxNCArNDU3NCwxMiBAQCBpbnRlbF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1YWwo
c3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIH0KIAogc3RydWN0IGludGVsX2NvbnRleHQg
KgotaW50ZWxfZXhlY2xpc3RzX2Nsb25lX3ZpcnR1YWwoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQg
KmN0eCwKLQkJCSAgICAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKnNyYykKK2ludGVsX2V4ZWNs
aXN0c19jbG9uZV92aXJ0dWFsKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKnNyYykKIHsKIAlzdHJ1
Y3QgdmlydHVhbF9lbmdpbmUgKnNlID0gdG9fdmlydHVhbF9lbmdpbmUoc3JjKTsKIAlzdHJ1Y3Qg
aW50ZWxfY29udGV4dCAqZHN0OwogCi0JZHN0ID0gaW50ZWxfZXhlY2xpc3RzX2NyZWF0ZV92aXJ0
dWFsKGN0eCwKLQkJCQkJICAgICBzZS0+c2libGluZ3MsCisJZHN0ID0gaW50ZWxfZXhlY2xpc3Rz
X2NyZWF0ZV92aXJ0dWFsKHNlLT5zaWJsaW5ncywKIAkJCQkJICAgICBzZS0+bnVtX3NpYmxpbmdz
KTsKIAlpZiAoSVNfRVJSKGRzdCkpCiAJCXJldHVybiBkc3Q7CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2xyYy5oCmluZGV4IDA0NTExZDhlYmRjMS4uMDgxNTIxZjE3Yzc0IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9scmMuaApAQCAtMTExLDEzICsxMTEsMTEgQEAgdm9pZCBpbnRlbF9leGVj
bGlzdHNfc2hvd19yZXF1ZXN0cyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJCQkJ
ICAgdW5zaWduZWQgaW50IG1heCk7CiAKIHN0cnVjdCBpbnRlbF9jb250ZXh0ICoKLWludGVsX2V4
ZWNsaXN0c19jcmVhdGVfdmlydHVhbChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAotCQkJ
ICAgICAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKipzaWJsaW5ncywKK2ludGVsX2V4ZWNsaXN0
c19jcmVhdGVfdmlydHVhbChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICoqc2libGluZ3MsCiAJCQkg
ICAgICAgdW5zaWduZWQgaW50IGNvdW50KTsKIAogc3RydWN0IGludGVsX2NvbnRleHQgKgotaW50
ZWxfZXhlY2xpc3RzX2Nsb25lX3ZpcnR1YWwoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwK
LQkJCSAgICAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKnNyYyk7CitpbnRlbF9leGVjbGlzdHNf
Y2xvbmVfdmlydHVhbChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpzcmMpOwogCiBpbnQgaW50ZWxf
dmlydHVhbF9lbmdpbmVfYXR0YWNoX2JvbmQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5l
LAogCQkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqbWFzdGVyLApkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMKaW5kZXggMGQ0YzYxMGE5MGI3Li45ZWNmMjQ0Mzlm
ZGUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYwpAQCAtNTIsOSArNTIsOCBA
QCBzdGF0aWMgdm9pZCBlbmdpbmVfc2tpcF9jb250ZXh0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
KQogCQkJaTkxNV9yZXF1ZXN0X3NraXAocnEsIC1FSU8pOwogfQogCi1zdGF0aWMgdm9pZCBjbGll
bnRfbWFya19ndWlsdHkoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsIGJvb2wgYmFubmVkKQorc3Rh
dGljIHZvaWQgY2xpZW50X21hcmtfZ3VpbHR5KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgs
IGJvb2wgYmFubmVkKQogewotCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHggPSBycS0+Y29u
dGV4dC0+Z2VtX2NvbnRleHQ7CiAJc3RydWN0IGRybV9pOTE1X2ZpbGVfcHJpdmF0ZSAqZmlsZV9w
cml2ID0gY3R4LT5maWxlX3ByaXY7CiAJdW5zaWduZWQgbG9uZyBwcmV2X2hhbmc7CiAJdW5zaWdu
ZWQgaW50IHNjb3JlOwpAQCAtODEsMTEgKzgwLDE1IEBAIHN0YXRpYyB2b2lkIGNsaWVudF9tYXJr
X2d1aWx0eShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgYm9vbCBiYW5uZWQpCiAKIHN0YXRpYyBi
b29sIG1hcmtfZ3VpbHR5KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogewotCXN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICpjdHggPSBycS0+Y29udGV4dC0+Z2VtX2NvbnRleHQ7CisJc3RydWN0IGk5
MTVfZ2VtX2NvbnRleHQgKmN0eDsKIAl1bnNpZ25lZCBsb25nIHByZXZfaGFuZzsKIAlib29sIGJh
bm5lZDsKIAlpbnQgaTsKIAorCWN0eCA9IHJxLT5jb250ZXh0LT5nZW1fY29udGV4dDsKKwlpZiAo
IWN0eCkKKwkJcmV0dXJuIGZhbHNlOworCiAJaWYgKGk5MTVfZ2VtX2NvbnRleHRfaXNfY2xvc2Vk
KGN0eCkpIHsKIAkJaW50ZWxfY29udGV4dF9zZXRfYmFubmVkKHJxLT5jb250ZXh0KTsKIAkJcmV0
dXJuIHRydWU7CkBAIC0xMTcsMTQgKzEyMCwxNSBAQCBzdGF0aWMgYm9vbCBtYXJrX2d1aWx0eShz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAkJaW50ZWxfY29udGV4dF9zZXRfYmFubmVkKHJxLT5j
b250ZXh0KTsKIAl9CiAKLQljbGllbnRfbWFya19ndWlsdHkocnEsIGJhbm5lZCk7CisJY2xpZW50
X21hcmtfZ3VpbHR5KGN0eCwgYmFubmVkKTsKIAogCXJldHVybiBiYW5uZWQ7CiB9CiAKIHN0YXRp
YyB2b2lkIG1hcmtfaW5ub2NlbnQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7Ci0JYXRvbWlj
X2luYygmcnEtPmNvbnRleHQtPmdlbV9jb250ZXh0LT5hY3RpdmVfY291bnQpOworCWlmIChycS0+
Y29udGV4dC0+Z2VtX2NvbnRleHQpCisJCWF0b21pY19pbmMoJnJxLT5jb250ZXh0LT5nZW1fY29u
dGV4dC0+YWN0aXZlX2NvdW50KTsKIH0KIAogdm9pZCBfX2k5MTVfcmVxdWVzdF9yZXNldChzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycSwgYm9vbCBndWlsdHkpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nX3N1Ym1pc3Npb24uYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX3Jpbmdfc3VibWlzc2lvbi5jCmluZGV4IDg3ZDI4OTNkNDhkYi4uODIzNzBk
ZjE4YzY2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nX3N1
Ym1pc3Npb24uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nX3N1Ym1p
c3Npb24uYwpAQCAtMTU2MSw3ICsxNTYxLDcgQEAgc3RhdGljIGludCByZW1hcF9sMyhzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycSkKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4ID0gcnEtPmNv
bnRleHQtPmdlbV9jb250ZXh0OwogCWludCBpLCBlcnI7CiAKLQlpZiAoIWN0eC0+cmVtYXBfc2xp
Y2UpCisJaWYgKCFjdHggfHwgIWN0eC0+cmVtYXBfc2xpY2UpCiAJCXJldHVybiAwOwogCiAJZm9y
IChpID0gMDsgaSA8IE1BWF9MM19TTElDRVM7IGkrKykgewpAQCAtMTYwNCw3ICsxNjA0LDcgQEAg
c3RhdGljIGludCBzd2l0Y2hfY29udGV4dChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAkJICog
aXMgcHVyZWx5IHVzZWQgZm9yIGZsdXNoaW5nIHVzZXIgY29udGV4dHMuCiAJCSAqLwogCQlod19m
bGFncyA9IDA7Ci0JCWlmIChpOTE1X2dlbV9jb250ZXh0X2lzX2tlcm5lbChycS0+Y29udGV4dC0+
Z2VtX2NvbnRleHQpKQorCQlpZiAoIXJxLT5jb250ZXh0LT5nZW1fY29udGV4dCkKIAkJCWh3X2Zs
YWdzID0gTUlfUkVTVE9SRV9JTkhJQklUOwogCiAJCXJldCA9IG1pX3NldF9jb250ZXh0KHJxLCBo
d19mbGFncyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9j
b250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKaW5k
ZXggMTRiYTZjZWI5MTc3Li5iNWVmOTVhOTkzNTggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9zZWxmdGVzdF9jb250ZXh0LmMKQEAgLTY3LDE1ICs2NywxNCBAQCBzdGF0aWMgaW50IGNvbnRl
eHRfc3luYyhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAJcmV0dXJuIGVycjsKIH0KIAotc3Rh
dGljIGludCBfX2xpdmVfY29udGV4dF9zaXplKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZSwKLQkJCSAgICAgICBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqZml4bWUpCitzdGF0aWMgaW50
IF9fbGl2ZV9jb250ZXh0X3NpemUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewog
CXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAl2
b2lkICp2YWRkcjsKIAlpbnQgZXJyOwogCi0JY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShmaXht
ZSwgZW5naW5lKTsKKwljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CiAJaWYgKElT
X0VSUihjZSkpCiAJCXJldHVybiBQVFJfRVJSKGNlKTsKIApAQCAtMTQzLDcgKzE0Miw2IEBAIHN0
YXRpYyBpbnQgbGl2ZV9jb250ZXh0X3NpemUodm9pZCAqYXJnKQogewogCXN0cnVjdCBpbnRlbF9n
dCAqZ3QgPSBhcmc7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCXN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0ICpmaXhtZTsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKIAlpbnQg
ZXJyID0gMDsKIApAQCAtMTUyLDEwICsxNTAsNiBAQCBzdGF0aWMgaW50IGxpdmVfY29udGV4dF9z
aXplKHZvaWQgKmFyZykKIAkgKiBIVyB0cmllcyB0byB3cml0ZSBwYXN0IHRoZSBlbmQgb2Ygb25l
LgogCSAqLwogCi0JZml4bWUgPSBrZXJuZWxfY29udGV4dChndC0+aTkxNSk7Ci0JaWYgKElTX0VS
UihmaXhtZSkpCi0JCXJldHVybiBQVFJfRVJSKGZpeG1lKTsKLQogCWZvcl9lYWNoX2VuZ2luZShl
bmdpbmUsIGd0LCBpZCkgewogCQlzdHJ1Y3QgewogCQkJc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKnN0YXRlOwpAQCAtMTgwLDcgKzE3NCw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9jb250ZXh0X3Np
emUodm9pZCAqYXJnKQogCQkvKiBPdmVybGFwcyB3aXRoIHRoZSBleGVjbGlzdHMgcmVkem9uZSAq
LwogCQllbmdpbmUtPmNvbnRleHRfc2l6ZSArPSBJOTE1X0dUVF9QQUdFX1NJWkU7CiAKLQkJZXJy
ID0gX19saXZlX2NvbnRleHRfc2l6ZShlbmdpbmUsIGZpeG1lKTsKKwkJZXJyID0gX19saXZlX2Nv
bnRleHRfc2l6ZShlbmdpbmUpOwogCiAJCWVuZ2luZS0+Y29udGV4dF9zaXplIC09IEk5MTVfR1RU
X1BBR0VfU0laRTsKIApAQCAtMTkzLDEyICsxODcsMTAgQEAgc3RhdGljIGludCBsaXZlX2NvbnRl
eHRfc2l6ZSh2b2lkICphcmcpCiAJCQlicmVhazsKIAl9CiAKLQlrZXJuZWxfY29udGV4dF9jbG9z
ZShmaXhtZSk7CiAJcmV0dXJuIGVycjsKIH0KIAotc3RhdGljIGludCBfX2xpdmVfYWN0aXZlX2Nv
bnRleHQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAotCQkJCSBzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqZml4bWUpCitzdGF0aWMgaW50IF9fbGl2ZV9hY3RpdmVfY29udGV4dChzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7CiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNl
OwogCWludCBwYXNzOwpAQCAtMjIzLDcgKzIxNSw3IEBAIHN0YXRpYyBpbnQgX19saXZlX2FjdGl2
ZV9jb250ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAkJcmV0dXJuIC1FSU5W
QUw7CiAJfQogCi0JY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShmaXhtZSwgZW5naW5lKTsKKwlj
ZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CiAJaWYgKElTX0VSUihjZSkpCiAJCXJl
dHVybiBQVFJfRVJSKGNlKTsKIApAQCAtMjg3LDIzICsyNzksMTEgQEAgc3RhdGljIGludCBsaXZl
X2FjdGl2ZV9jb250ZXh0KHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJn
OwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqZml4bWU7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7Ci0Jc3RydWN0IGZpbGUgKmZp
bGU7CiAJaW50IGVyciA9IDA7CiAKLQlmaWxlID0gbW9ja19maWxlKGd0LT5pOTE1KTsKLQlpZiAo
SVNfRVJSKGZpbGUpKQotCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKLQotCWZpeG1lID0gbGl2ZV9j
b250ZXh0KGd0LT5pOTE1LCBmaWxlKTsKLQlpZiAoSVNfRVJSKGZpeG1lKSkgewotCQllcnIgPSBQ
VFJfRVJSKGZpeG1lKTsKLQkJZ290byBvdXRfZmlsZTsKLQl9Ci0KIAlmb3JfZWFjaF9lbmdpbmUo
ZW5naW5lLCBndCwgaWQpIHsKLQkJZXJyID0gX19saXZlX2FjdGl2ZV9jb250ZXh0KGVuZ2luZSwg
Zml4bWUpOworCQllcnIgPSBfX2xpdmVfYWN0aXZlX2NvbnRleHQoZW5naW5lKTsKIAkJaWYgKGVy
cikKIAkJCWJyZWFrOwogCkBAIC0zMTIsOCArMjkyLDYgQEAgc3RhdGljIGludCBsaXZlX2FjdGl2
ZV9jb250ZXh0KHZvaWQgKmFyZykKIAkJCWJyZWFrOwogCX0KIAotb3V0X2ZpbGU6Ci0JZnB1dChm
aWxlKTsKIAlyZXR1cm4gZXJyOwogfQogCkBAIC0zNDUsOCArMzIzLDcgQEAgc3RhdGljIGludCBf
X3JlbW90ZV9zeW5jKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgc3RydWN0IGludGVsX2NvbnRl
eHQgKnJlbW90ZSkKIAlyZXR1cm4gZXJyOwogfQogCi1zdGF0aWMgaW50IF9fbGl2ZV9yZW1vdGVf
Y29udGV4dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCi0JCQkJIHN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICpmaXhtZSkKK3N0YXRpYyBpbnQgX19saXZlX3JlbW90ZV9jb250ZXh0KHN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAq
bG9jYWwsICpyZW1vdGU7CiAJaW50IHBhc3M7CkBAIC0zNjAsMTEgKzMzNywxMSBAQCBzdGF0aWMg
aW50IF9fbGl2ZV9yZW1vdGVfY29udGV4dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUs
CiAJICogY2xvYmJlciB0aGUgaWRsZS1iYXJyaWVyLgogCSAqLwogCi0JcmVtb3RlID0gaW50ZWxf
Y29udGV4dF9jcmVhdGUoZml4bWUsIGVuZ2luZSk7CisJcmVtb3RlID0gaW50ZWxfY29udGV4dF9j
cmVhdGUoZW5naW5lKTsKIAlpZiAoSVNfRVJSKHJlbW90ZSkpCiAJCXJldHVybiBQVFJfRVJSKHJl
bW90ZSk7CiAKLQlsb2NhbCA9IGludGVsX2NvbnRleHRfY3JlYXRlKGZpeG1lLCBlbmdpbmUpOwor
CWxvY2FsID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKIAlpZiAoSVNfRVJSKGxvY2Fs
KSkgewogCQllcnIgPSBQVFJfRVJSKGxvY2FsKTsKIAkJZ290byBlcnJfcmVtb3RlOwpAQCAtMzk3
LDIzICszNzQsMTEgQEAgc3RhdGljIGludCBsaXZlX3JlbW90ZV9jb250ZXh0KHZvaWQgKmFyZykK
IHsKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZTsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqZml4bWU7CiAJZW51bSBpbnRlbF9l
bmdpbmVfaWQgaWQ7Ci0Jc3RydWN0IGZpbGUgKmZpbGU7CiAJaW50IGVyciA9IDA7CiAKLQlmaWxl
ID0gbW9ja19maWxlKGd0LT5pOTE1KTsKLQlpZiAoSVNfRVJSKGZpbGUpKQotCQlyZXR1cm4gUFRS
X0VSUihmaWxlKTsKLQotCWZpeG1lID0gbGl2ZV9jb250ZXh0KGd0LT5pOTE1LCBmaWxlKTsKLQlp
ZiAoSVNfRVJSKGZpeG1lKSkgewotCQllcnIgPSBQVFJfRVJSKGZpeG1lKTsKLQkJZ290byBvdXRf
ZmlsZTsKLQl9Ci0KIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwgaWQpIHsKLQkJZXJyID0g
X19saXZlX3JlbW90ZV9jb250ZXh0KGVuZ2luZSwgZml4bWUpOworCQllcnIgPSBfX2xpdmVfcmVt
b3RlX2NvbnRleHQoZW5naW5lKTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCkBAIC00MjIsOCAr
Mzg3LDYgQEAgc3RhdGljIGludCBsaXZlX3JlbW90ZV9jb250ZXh0KHZvaWQgKmFyZykKIAkJCWJy
ZWFrOwogCX0KIAotb3V0X2ZpbGU6Ci0JZnB1dChmaWxlKTsKIAlyZXR1cm4gZXJyOwogfQogCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVfaGVhcnRi
ZWF0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVfaGVhcnRiZWF0
LmMKaW5kZXggZjY2NWEwZTIzYzYxLi4yZmVlYWQ5YjQ0N2EgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9oZWFydGJlYXQuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVfaGVhcnRiZWF0LmMKQEAgLTE3Myw4ICsx
NzMsNyBAQCBzdGF0aWMgaW50IF9fbGl2ZV9oZWFydGJlYXRfZmFzdChzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmUpCiAJaW50IGVycjsKIAlpbnQgaTsKIAotCWNlID0gaW50ZWxfY29udGV4
dF9jcmVhdGUoZW5naW5lLT5rZXJuZWxfY29udGV4dC0+Z2VtX2NvbnRleHQsCi0JCQkJICBlbmdp
bmUpOworCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKIAlpZiAoSVNfRVJSKGNl
KSkKIAkJcmV0dXJuIFBUUl9FUlIoY2UpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Nl
bGZ0ZXN0X2hhbmdjaGVjay5jCmluZGV4IGQxNTVjOTM3NDQ1My4uZmYyZDhhZjI4MmE2IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYwpAQCAtMzc3LDM2
ICszNzcsMzAgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfbm9wKHZvaWQgKmFyZykKIAlzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0ID0gYXJnOwogCXN0cnVjdCBpOTE1X2dwdV9lcnJvciAqZ2xvYmFsID0gJmd0
LT5pOTE1LT5ncHVfZXJyb3I7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCXN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CiAJdW5zaWduZWQgaW50IHJlc2V0X2NvdW50LCBj
b3VudDsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKIAlJR1RfVElNRU9VVChlbmRfdGltZSk7
Ci0Jc3RydWN0IGZpbGUgKmZpbGU7CiAJaW50IGVyciA9IDA7CiAKIAkvKiBDaGVjayB0aGF0IHdl
IGNhbiByZXNldCBkdXJpbmcgbm9uLXVzZXIgcG9ydGlvbnMgb2YgcmVxdWVzdHMgKi8KIAotCWZp
bGUgPSBtb2NrX2ZpbGUoZ3QtPmk5MTUpOwotCWlmIChJU19FUlIoZmlsZSkpCi0JCXJldHVybiBQ
VFJfRVJSKGZpbGUpOwotCi0JY3R4ID0gbGl2ZV9jb250ZXh0KGd0LT5pOTE1LCBmaWxlKTsKLQlp
ZiAoSVNfRVJSKGN0eCkpIHsKLQkJZXJyID0gUFRSX0VSUihjdHgpOwotCQlnb3RvIG91dDsKLQl9
Ci0KLQlpOTE1X2dlbV9jb250ZXh0X2NsZWFyX2Jhbm5hYmxlKGN0eCk7CiAJcmVzZXRfY291bnQg
PSBpOTE1X3Jlc2V0X2NvdW50KGdsb2JhbCk7CiAJY291bnQgPSAwOwogCWRvIHsKIAkJZm9yX2Vh
Y2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7CisJCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7
CiAJCQlpbnQgaTsKIAorCQkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUpOworCQkJ
aWYgKElTX0VSUihjZSkpIHsKKwkJCQllcnIgPSBQVFJfRVJSKGNlKTsKKwkJCQlicmVhazsKKwkJ
CX0KKwogCQkJZm9yIChpID0gMDsgaSA8IDE2OyBpKyspIHsKIAkJCQlzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycTsKIAotCQkJCXJxID0gaWd0X3JlcXVlc3RfYWxsb2MoY3R4LCBlbmdpbmUpOworCQkJ
CXJxID0gaW50ZWxfY29udGV4dF9jcmVhdGVfcmVxdWVzdChjZSk7CiAJCQkJaWYgKElTX0VSUihy
cSkpIHsKIAkJCQkJZXJyID0gUFRSX0VSUihycSk7CiAJCQkJCWJyZWFrOwpAQCAtNDE0LDYgKzQw
OCw4IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X25vcCh2b2lkICphcmcpCiAKIAkJCQlpOTE1X3Jl
cXVlc3RfYWRkKHJxKTsKIAkJCX0KKworCQkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwogCQl9CiAK
IAkJaWd0X2dsb2JhbF9yZXNldF9sb2NrKGd0KTsKQEAgLTQzNywxMCArNDMzLDcgQEAgc3RhdGlj
IGludCBpZ3RfcmVzZXRfbm9wKHZvaWQgKmFyZykKIAl9IHdoaWxlICh0aW1lX2JlZm9yZShqaWZm
aWVzLCBlbmRfdGltZSkpOwogCXByX2luZm8oIiVzOiAlZCByZXNldHNcbiIsIF9fZnVuY19fLCBj
b3VudCk7CiAKLQllcnIgPSBpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSk7Ci1vdXQ6Ci0JZnB1dChm
aWxlKTsKLQlpZiAoaW50ZWxfZ3RfaXNfd2VkZ2VkKGd0KSkKKwlpZiAoaWd0X2ZsdXNoX3Rlc3Qo
Z3QtPmk5MTUpKQogCQllcnIgPSAtRUlPOwogCXJldHVybiBlcnI7CiB9CkBAIC00NTAsMzEgKzQ0
MywyMiBAQCBzdGF0aWMgaW50IGlndF9yZXNldF9ub3BfZW5naW5lKHZvaWQgKmFyZykKIAlzdHJ1
Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwogCXN0cnVjdCBpOTE1X2dwdV9lcnJvciAqZ2xvYmFsID0g
Jmd0LT5pOTE1LT5ncHVfZXJyb3I7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwot
CXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7
Ci0Jc3RydWN0IGZpbGUgKmZpbGU7Ci0JaW50IGVyciA9IDA7CiAKIAkvKiBDaGVjayB0aGF0IHdl
IGNhbiBlbmdpbmUtcmVzZXQgZHVyaW5nIG5vbi11c2VyIHBvcnRpb25zICovCiAKIAlpZiAoIWlu
dGVsX2hhc19yZXNldF9lbmdpbmUoZ3QpKQogCQlyZXR1cm4gMDsKIAotCWZpbGUgPSBtb2NrX2Zp
bGUoZ3QtPmk5MTUpOwotCWlmIChJU19FUlIoZmlsZSkpCi0JCXJldHVybiBQVFJfRVJSKGZpbGUp
OwotCi0JY3R4ID0gbGl2ZV9jb250ZXh0KGd0LT5pOTE1LCBmaWxlKTsKLQlpZiAoSVNfRVJSKGN0
eCkpIHsKLQkJZXJyID0gUFRSX0VSUihjdHgpOwotCQlnb3RvIG91dDsKLQl9Ci0KLQlpOTE1X2dl
bV9jb250ZXh0X2NsZWFyX2Jhbm5hYmxlKGN0eCk7CiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwg
Z3QsIGlkKSB7Ci0JCXVuc2lnbmVkIGludCByZXNldF9jb3VudCwgcmVzZXRfZW5naW5lX2NvdW50
OwotCQl1bnNpZ25lZCBpbnQgY291bnQ7CisJCXVuc2lnbmVkIGludCByZXNldF9jb3VudCwgcmVz
ZXRfZW5naW5lX2NvdW50LCBjb3VudDsKKwkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCQlJ
R1RfVElNRU9VVChlbmRfdGltZSk7CisJCWludCBlcnI7CisKKwkJY2UgPSBpbnRlbF9jb250ZXh0
X2NyZWF0ZShlbmdpbmUpOworCQlpZiAoSVNfRVJSKGNlKSkKKwkJCXJldHVybiBQVFJfRVJSKGNl
KTsKIAogCQlyZXNldF9jb3VudCA9IGk5MTVfcmVzZXRfY291bnQoZ2xvYmFsKTsKIAkJcmVzZXRf
ZW5naW5lX2NvdW50ID0gaTkxNV9yZXNldF9lbmdpbmVfY291bnQoZ2xvYmFsLCBlbmdpbmUpOwpA
QCAtNDk0LDcgKzQ3OCw3IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X25vcF9lbmdpbmUodm9pZCAq
YXJnKQogCQkJZm9yIChpID0gMDsgaSA8IDE2OyBpKyspIHsKIAkJCQlzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycTsKIAotCQkJCXJxID0gaWd0X3JlcXVlc3RfYWxsb2MoY3R4LCBlbmdpbmUpOworCQkJ
CXJxID0gaW50ZWxfY29udGV4dF9jcmVhdGVfcmVxdWVzdChjZSk7CiAJCQkJaWYgKElTX0VSUihy
cSkpIHsKIAkJCQkJZXJyID0gUFRSX0VSUihycSk7CiAJCQkJCWJyZWFrOwpAQCAtNTI1LDIwICs1
MDksMTQgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfbm9wX2VuZ2luZSh2b2lkICphcmcpCiAJCWNs
ZWFyX2JpdChJOTE1X1JFU0VUX0VOR0lORSArIGlkLCAmZ3QtPnJlc2V0LmZsYWdzKTsKIAkJcHJf
aW5mbygiJXMoJXMpOiAlZCByZXNldHNcbiIsIF9fZnVuY19fLCBlbmdpbmUtPm5hbWUsIGNvdW50
KTsKIAorCQlpbnRlbF9jb250ZXh0X3B1dChjZSk7CisJCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+
aTkxNSkpCisJCQllcnIgPSAtRUlPOwogCQlpZiAoZXJyKQotCQkJYnJlYWs7Ci0KLQkJZXJyID0g
aWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpOwotCQlpZiAoZXJyKQotCQkJYnJlYWs7CisJCQlyZXR1
cm4gZXJyOwogCX0KIAotCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KTsKLW91dDoKLQlm
cHV0KGZpbGUpOwotCWlmIChpbnRlbF9ndF9pc193ZWRnZWQoZ3QpKQotCQllcnIgPSAtRUlPOwot
CXJldHVybiBlcnI7CisJcmV0dXJuIDA7CiB9CiAKIHN0YXRpYyBpbnQgX19pZ3RfcmVzZXRfZW5n
aW5lKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIGJvb2wgYWN0aXZlKQpAQCAtNjk5LDQzICs2NzcsNDMg
QEAgc3RhdGljIGludCBhY3RpdmVfZW5naW5lKHZvaWQgKmRhdGEpCiAJc3RydWN0IGFjdGl2ZV9l
bmdpbmUgKmFyZyA9IGRhdGE7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lID0gYXJn
LT5lbmdpbmU7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnFbOF0gPSB7fTsKLQlzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dCAqY3R4W0FSUkFZX1NJWkUocnEpXTsKLQl1bnNpZ25lZCBsb25nIGNvdW50
ID0gMDsKLQlzdHJ1Y3QgZmlsZSAqZmlsZTsKKwlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2VbQVJS
QVlfU0laRShycSldOworCXVuc2lnbmVkIGxvbmcgY291bnQ7CiAJaW50IGVyciA9IDA7CiAKLQlm
aWxlID0gbW9ja19maWxlKGVuZ2luZS0+aTkxNSk7Ci0JaWYgKElTX0VSUihmaWxlKSkKLQkJcmV0
dXJuIFBUUl9FUlIoZmlsZSk7Ci0KLQlmb3IgKGNvdW50ID0gMDsgY291bnQgPCBBUlJBWV9TSVpF
KGN0eCk7IGNvdW50KyspIHsKLQkJY3R4W2NvdW50XSA9IGxpdmVfY29udGV4dChlbmdpbmUtPmk5
MTUsIGZpbGUpOwotCQlpZiAoSVNfRVJSKGN0eFtjb3VudF0pKSB7Ci0JCQllcnIgPSBQVFJfRVJS
KGN0eFtjb3VudF0pOworCWZvciAoY291bnQgPSAwOyBjb3VudCA8IEFSUkFZX1NJWkUoY2UpOyBj
b3VudCsrKSB7CisJCWNlW2NvdW50XSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CisJ
CWlmIChJU19FUlIoY2VbY291bnRdKSkgeworCQkJZXJyID0gUFRSX0VSUihjZVtjb3VudF0pOwog
CQkJd2hpbGUgKC0tY291bnQpCi0JCQkJaTkxNV9nZW1fY29udGV4dF9wdXQoY3R4W2NvdW50XSk7
Ci0JCQlnb3RvIGVycl9maWxlOworCQkJCWludGVsX2NvbnRleHRfcHV0KGNlW2NvdW50XSk7CisJ
CQlyZXR1cm4gZXJyOwogCQl9CiAJfQogCisJY291bnQgPSAwOwogCXdoaWxlICgha3RocmVhZF9z
aG91bGRfc3RvcCgpKSB7CiAJCXVuc2lnbmVkIGludCBpZHggPSBjb3VudCsrICYgKEFSUkFZX1NJ
WkUocnEpIC0gMSk7CiAJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKm9sZCA9IHJxW2lkeF07CiAJCXN0
cnVjdCBpOTE1X3JlcXVlc3QgKm5ldzsKIAotCQluZXcgPSBpZ3RfcmVxdWVzdF9hbGxvYyhjdHhb
aWR4XSwgZW5naW5lKTsKKwkJbmV3ID0gaW50ZWxfY29udGV4dF9jcmVhdGVfcmVxdWVzdChjZVtp
ZHhdKTsKIAkJaWYgKElTX0VSUihuZXcpKSB7CiAJCQllcnIgPSBQVFJfRVJSKG5ldyk7CiAJCQli
cmVhazsKIAkJfQogCi0JCWlmIChhcmctPmZsYWdzICYgVEVTVF9QUklPUklUWSkKLQkJCWN0eFtp
ZHhdLT5zY2hlZC5wcmlvcml0eSA9Ci0JCQkJaTkxNV9wcmFuZG9tX3UzMl9tYXhfc3RhdGUoNTEy
LCAmcHJuZyk7Ci0KIAkJcnFbaWR4XSA9IGk5MTVfcmVxdWVzdF9nZXQobmV3KTsKIAkJaTkxNV9y
ZXF1ZXN0X2FkZChuZXcpOwogCisJCWlmIChlbmdpbmUtPnNjaGVkdWxlICYmIGFyZy0+ZmxhZ3Mg
JiBURVNUX1BSSU9SSVRZKSB7CisJCQlzdHJ1Y3QgaTkxNV9zY2hlZF9hdHRyIGF0dHIgPSB7CisJ
CQkJLnByaW9yaXR5ID0KKwkJCQkJaTkxNV9wcmFuZG9tX3UzMl9tYXhfc3RhdGUoNTEyLCAmcHJu
ZyksCisJCQl9OworCQkJZW5naW5lLT5zY2hlZHVsZShycVtpZHhdLCAmYXR0cik7CisJCX0KKwog
CQllcnIgPSBhY3RpdmVfcmVxdWVzdF9wdXQob2xkKTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwpA
QCAtNzQ5LDEwICs3MjcsMTAgQEAgc3RhdGljIGludCBhY3RpdmVfZW5naW5lKHZvaWQgKmRhdGEp
CiAJCS8qIEtlZXAgdGhlIGZpcnN0IGVycm9yICovCiAJCWlmICghZXJyKQogCQkJZXJyID0gZXJy
X187CisKKwkJaW50ZWxfY29udGV4dF9wdXQoY2VbY291bnRdKTsKIAl9CiAKLWVycl9maWxlOgot
CWZwdXQoZmlsZSk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMTMwMCwzMiArMTI3OCwyMSBAQCBz
dGF0aWMgaW50IGlndF9yZXNldF9ldmljdF9nZ3R0KHZvaWQgKmFyZykKIHN0YXRpYyBpbnQgaWd0
X3Jlc2V0X2V2aWN0X3BwZ3R0KHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0g
YXJnOwotCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7Ci0Jc3RydWN0IGk5MTVfYWRkcmVz
c19zcGFjZSAqdm07Ci0Jc3RydWN0IGZpbGUgKmZpbGU7CisJc3RydWN0IGk5MTVfcHBndHQgKnBw
Z3R0OwogCWludCBlcnI7CiAKLQlmaWxlID0gbW9ja19maWxlKGd0LT5pOTE1KTsKLQlpZiAoSVNf
RVJSKGZpbGUpKQotCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKKwkvKiBhbGlhc2luZyA9PSBnbG9i
YWwgZ3R0IGxvY2tpbmcsIGNvdmVyZWQgYWJvdmUgKi8KKwlpZiAoSU5URUxfUFBHVFQoZ3QtPmk5
MTUpIDwgSU5URUxfUFBHVFRfRlVMTCkKKwkJcmV0dXJuIDA7CiAKLQljdHggPSBsaXZlX2NvbnRl
eHQoZ3QtPmk5MTUsIGZpbGUpOwotCWlmIChJU19FUlIoY3R4KSkgewotCQllcnIgPSBQVFJfRVJS
KGN0eCk7Ci0JCWdvdG8gb3V0OwotCX0KKwlwcGd0dCA9IGk5MTVfcHBndHRfY3JlYXRlKGd0LT5p
OTE1KTsKKwlpZiAoSVNfRVJSKHBwZ3R0KSkKKwkJcmV0dXJuIFBUUl9FUlIocHBndHQpOwogCi0J
ZXJyID0gMDsKLQl2bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOwotCWlmICgh
aTkxNV9pc19nZ3R0KHZtKSkgewotCQkvKiBhbGlhc2luZyA9PSBnbG9iYWwgZ3R0IGxvY2tpbmcs
IGNvdmVyZWQgYWJvdmUgKi8KLQkJZXJyID0gX19pZ3RfcmVzZXRfZXZpY3Rfdm1hKGd0LCB2bSwK
LQkJCQkJICAgIGV2aWN0X3ZtYSwgRVhFQ19PQkpFQ1RfV1JJVEUpOwotCX0KLQlpOTE1X3ZtX3B1
dCh2bSk7CisJZXJyID0gX19pZ3RfcmVzZXRfZXZpY3Rfdm1hKGd0LCAmcHBndHQtPnZtLAorCQkJ
CSAgICBldmljdF92bWEsIEVYRUNfT0JKRUNUX1dSSVRFKTsKKwlpOTE1X3ZtX3B1dCgmcHBndHQt
PnZtKTsKIAotb3V0OgotCWZwdXQoZmlsZSk7CiAJcmV0dXJuIGVycjsKIH0KIApkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwppbmRleCA3ZDU3MTNlYTZiZGUuLjBhOWVhNDNlZTZi
NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKQEAgLTUzLDExICs1Mywx
MCBAQCBzdGF0aWMgc3RydWN0IGk5MTVfdm1hICpjcmVhdGVfc2NyYXRjaChzdHJ1Y3QgaW50ZWxf
Z3QgKmd0KQogc3RhdGljIGludCBsaXZlX3Nhbml0eWNoZWNrKHZvaWQgKmFyZykKIHsKIAlzdHJ1
Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwotCXN0cnVjdCBpOTE1X2dlbV9lbmdpbmVzX2l0ZXIgaXQ7
Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKLQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAq
Y2U7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOworCWVudW0gaW50ZWxfZW5naW5l
X2lkIGlkOwogCXN0cnVjdCBpZ3Rfc3Bpbm5lciBzcGluOwotCWludCBlcnIgPSAtRU5PTUVNOwor
CWludCBlcnIgPSAwOwogCiAJaWYgKCFIQVNfTE9HSUNBTF9SSU5HX0NPTlRFWFRTKGd0LT5pOTE1
KSkKIAkJcmV0dXJuIDA7CkBAIC02NSwxNyArNjQsMjAgQEAgc3RhdGljIGludCBsaXZlX3Nhbml0
eWNoZWNrKHZvaWQgKmFyZykKIAlpZiAoaWd0X3NwaW5uZXJfaW5pdCgmc3BpbiwgZ3QpKQogCQly
ZXR1cm4gLUVOT01FTTsKIAotCWN0eCA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKLQlpZiAo
IWN0eCkKLQkJZ290byBlcnJfc3BpbjsKLQotCWZvcl9lYWNoX2dlbV9lbmdpbmUoY2UsIGk5MTVf
Z2VtX2NvbnRleHRfbG9ja19lbmdpbmVzKGN0eCksIGl0KSB7CisJZm9yX2VhY2hfZW5naW5lKGVu
Z2luZSwgZ3QsIGlkKSB7CisJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAkJc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnE7CiAKKwkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUpOwor
CQlpZiAoSVNfRVJSKGNlKSkgeworCQkJZXJyID0gUFRSX0VSUihjZSk7CisJCQlicmVhazsKKwkJ
fQorCiAJCXJxID0gaWd0X3NwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJnNwaW4sIGNlLCBNSV9OT09Q
KTsKIAkJaWYgKElTX0VSUihycSkpIHsKIAkJCWVyciA9IFBUUl9FUlIocnEpOwotCQkJZ290byBl
cnJfY3R4OworCQkJZ290byBvdXRfY3R4OwogCQl9CiAKIAkJaTkxNV9yZXF1ZXN0X2FkZChycSk7
CkBAIC04NCwyMSArODYsMjEgQEAgc3RhdGljIGludCBsaXZlX3Nhbml0eWNoZWNrKHZvaWQgKmFy
ZykKIAkJCUdFTV9UUkFDRV9EVU1QKCk7CiAJCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKGd0KTsKIAkJ
CWVyciA9IC1FSU87Ci0JCQlnb3RvIGVycl9jdHg7CisJCQlnb3RvIG91dF9jdHg7CiAJCX0KIAog
CQlpZ3Rfc3Bpbm5lcl9lbmQoJnNwaW4pOwogCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUp
KSB7CiAJCQllcnIgPSAtRUlPOwotCQkJZ290byBlcnJfY3R4OworCQkJZ290byBvdXRfY3R4Owog
CQl9CisKK291dF9jdHg6CisJCWludGVsX2NvbnRleHRfcHV0KGNlKTsKKwkJaWYgKGVycikKKwkJ
CWJyZWFrOwogCX0KIAotCWVyciA9IDA7Ci1lcnJfY3R4OgotCWk5MTVfZ2VtX2NvbnRleHRfdW5s
b2NrX2VuZ2luZXMoY3R4KTsKLQlrZXJuZWxfY29udGV4dF9jbG9zZShjdHgpOwotZXJyX3NwaW46
CiAJaWd0X3NwaW5uZXJfZmluaSgmc3Bpbik7CiAJcmV0dXJuIGVycjsKIH0KQEAgLTEwNiw3ICsx
MDgsNiBAQCBzdGF0aWMgaW50IGxpdmVfc2FuaXR5Y2hlY2sodm9pZCAqYXJnKQogc3RhdGljIGlu
dCBsaXZlX3VubGl0ZV9yZXN0b3JlKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIGludCBwcmlvKQogewog
CXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqY3R4OwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwogCXN0cnVjdCBpZ3Rfc3Bpbm5lciBz
cGluOwogCWludCBlcnIgPSAtRU5PTUVNOwpAQCAtMTE5LDEwICsxMjAsNiBAQCBzdGF0aWMgaW50
IGxpdmVfdW5saXRlX3Jlc3RvcmUoc3RydWN0IGludGVsX2d0ICpndCwgaW50IHByaW8pCiAJaWYg
KGlndF9zcGlubmVyX2luaXQoJnNwaW4sIGd0KSkKIAkJcmV0dXJuIGVycjsKIAotCWN0eCA9IGtl
cm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKLQlpZiAoIWN0eCkKLQkJZ290byBlcnJfc3BpbjsKLQog
CWVyciA9IDA7CiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7CiAJCXN0cnVjdCBp
bnRlbF9jb250ZXh0ICpjZVsyXSA9IHt9OwpAQCAtMTQ0LDcgKzE0MSw3IEBAIHN0YXRpYyBpbnQg
bGl2ZV91bmxpdGVfcmVzdG9yZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBpbnQgcHJpbykKIAkJZm9y
IChuID0gMDsgbiA8IEFSUkFZX1NJWkUoY2UpOyBuKyspIHsKIAkJCXN0cnVjdCBpbnRlbF9jb250
ZXh0ICp0bXA7CiAKLQkJCXRtcCA9IGludGVsX2NvbnRleHRfY3JlYXRlKGN0eCwgZW5naW5lKTsK
KwkJCXRtcCA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CiAJCQlpZiAoSVNfRVJSKHRt
cCkpIHsKIAkJCQllcnIgPSBQVFJfRVJSKHRtcCk7CiAJCQkJZ290byBlcnJfY2U7CkBAIC0yNTMs
OCArMjUwLDYgQEAgc3RhdGljIGludCBsaXZlX3VubGl0ZV9yZXN0b3JlKHN0cnVjdCBpbnRlbF9n
dCAqZ3QsIGludCBwcmlvKQogCQkJYnJlYWs7CiAJfQogCi0Ja2VybmVsX2NvbnRleHRfY2xvc2Uo
Y3R4KTsKLWVycl9zcGluOgogCWlndF9zcGlubmVyX2ZpbmkoJnNwaW4pOwogCXJldHVybiBlcnI7
CiB9CkBAIC0zMDksMTcgKzMwNCwxNyBAQCBlbWl0X3NlbWFwaG9yZV9jaGFpbihzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpycSwgc3RydWN0IGk5MTVfdm1hICp2bWEsIGludCBpZHgpCiBzdGF0aWMgc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqCiBzZW1hcGhvcmVfcXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lLCBzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgaW50IGlkeCkKIHsKLQlzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dCAqY3R4OworCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAlzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycTsKIAlpbnQgZXJyOwogCi0JY3R4ID0ga2VybmVsX2NvbnRleHQoZW5n
aW5lLT5pOTE1KTsKLQlpZiAoIWN0eCkKLQkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisJY2Ug
PSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUpOworCWlmIChJU19FUlIoY2UpKQorCQlyZXR1
cm4gRVJSX0NBU1QoY2UpOwogCi0JcnEgPSBpZ3RfcmVxdWVzdF9hbGxvYyhjdHgsIGVuZ2luZSk7
CisJcnEgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZV9yZXF1ZXN0KGNlKTsKIAlpZiAoSVNfRVJSKHJx
KSkKLQkJZ290byBvdXRfY3R4OworCQlnb3RvIG91dF9jZTsKIAogCWVyciA9IDA7CiAJaWYgKHJx
LT5lbmdpbmUtPmVtaXRfaW5pdF9icmVhZGNydW1iKQpAQCAtMzMyLDggKzMyNyw4IEBAIHNlbWFw
aG9yZV9xdWV1ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIHN0cnVjdCBpOTE1X3Zt
YSAqdm1hLCBpbnQgaWR4KQogCWlmIChlcnIpCiAJCXJxID0gRVJSX1BUUihlcnIpOwogCi1vdXRf
Y3R4OgotCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7CitvdXRfY2U6CisJaW50ZWxfY29udGV4
dF9wdXQoY2UpOwogCXJldHVybiBycTsKIH0KIApAQCAtMjM5MiwyNyArMjM4NywxNyBAQCBzdGF0
aWMgaW50IG5vcF92aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogewogCUlHVF9U
SU1FT1VUKGVuZF90aW1lKTsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0WzE2XTsKLQlz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4WzE2XTsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAq
dmVbMTZdOwogCXVuc2lnbmVkIGxvbmcgbiwgcHJpbWUsIG5jOwogCXN0cnVjdCBpZ3RfbGl2ZV90
ZXN0IHQ7CiAJa3RpbWVfdCB0aW1lc1syXSA9IHt9OwogCWludCBlcnI7CiAKLQlHRU1fQlVHX09O
KCFuY3R4IHx8IG5jdHggPiBBUlJBWV9TSVpFKGN0eCkpOworCUdFTV9CVUdfT04oIW5jdHggfHwg
bmN0eCA+IEFSUkFZX1NJWkUodmUpKTsKIAogCWZvciAobiA9IDA7IG4gPCBuY3R4OyBuKyspIHsK
LQkJY3R4W25dID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOwotCQlpZiAoIWN0eFtuXSkgewot
CQkJZXJyID0gLUVOT01FTTsKLQkJCW5jdHggPSBuOwotCQkJZ290byBvdXQ7Ci0JCX0KLQotCQl2
ZVtuXSA9IGludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChjdHhbbl0sCi0JCQkJCQkgICAg
ICAgc2libGluZ3MsIG5zaWJsaW5nKTsKKwkJdmVbbl0gPSBpbnRlbF9leGVjbGlzdHNfY3JlYXRl
X3ZpcnR1YWwoc2libGluZ3MsIG5zaWJsaW5nKTsKIAkJaWYgKElTX0VSUih2ZVtuXSkpIHsKLQkJ
CWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eFtuXSk7CiAJCQllcnIgPSBQVFJfRVJSKHZlW25dKTsK
IAkJCW5jdHggPSBuOwogCQkJZ290byBvdXQ7CkBAIC0yNDIxLDcgKzI0MDYsNiBAQCBzdGF0aWMg
aW50IG5vcF92aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCQllcnIgPSBpbnRl
bF9jb250ZXh0X3Bpbih2ZVtuXSk7CiAJCWlmIChlcnIpIHsKIAkJCWludGVsX2NvbnRleHRfcHV0
KHZlW25dKTsKLQkJCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eFtuXSk7CiAJCQluY3R4ID0gbjsK
IAkJCWdvdG8gb3V0OwogCQl9CkBAIC0yNTAyLDcgKzI0ODYsNiBAQCBzdGF0aWMgaW50IG5vcF92
aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCWZvciAobmMgPSAwOyBuYyA8IG5j
dHg7IG5jKyspIHsKIAkJaW50ZWxfY29udGV4dF91bnBpbih2ZVtuY10pOwogCQlpbnRlbF9jb250
ZXh0X3B1dCh2ZVtuY10pOwotCQlrZXJuZWxfY29udGV4dF9jbG9zZShjdHhbbmNdKTsKIAl9CiAJ
cmV0dXJuIGVycjsKIH0KQEAgLTI1NjEsNyArMjU0NCw2IEBAIHN0YXRpYyBpbnQgbWFza192aXJ0
dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCQkJICAgICAgIHVuc2lnbmVkIGludCBu
c2libGluZykKIHsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0W01BWF9FTkdJTkVfSU5T
VEFOQ0UgKyAxXTsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwogCXN0cnVjdCBpbnRl
bF9jb250ZXh0ICp2ZTsKIAlzdHJ1Y3QgaWd0X2xpdmVfdGVzdCB0OwogCXVuc2lnbmVkIGludCBu
OwpAQCAtMjU3MiwxMSArMjU1NCw3IEBAIHN0YXRpYyBpbnQgbWFza192aXJ0dWFsX2VuZ2luZShz
dHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCSAqIHJlc3RyaWN0IGl0IHRvIG91ciBkZXNpcmVkIGVuZ2lu
ZSB3aXRoaW4gdGhlIHZpcnR1YWwgZW5naW5lLgogCSAqLwogCi0JY3R4ID0ga2VybmVsX2NvbnRl
eHQoZ3QtPmk5MTUpOwotCWlmICghY3R4KQotCQlyZXR1cm4gLUVOT01FTTsKLQotCXZlID0gaW50
ZWxfZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFsKGN0eCwgc2libGluZ3MsIG5zaWJsaW5nKTsKKwl2
ZSA9IGludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChzaWJsaW5ncywgbnNpYmxpbmcpOwog
CWlmIChJU19FUlIodmUpKSB7CiAJCWVyciA9IFBUUl9FUlIodmUpOwogCQlnb3RvIG91dF9jbG9z
ZTsKQEAgLTI2NDQsNyArMjYyMiw2IEBAIHN0YXRpYyBpbnQgbWFza192aXJ0dWFsX2VuZ2luZShz
dHJ1Y3QgaW50ZWxfZ3QgKmd0LAogb3V0X3B1dDoKIAlpbnRlbF9jb250ZXh0X3B1dCh2ZSk7CiBv
dXRfY2xvc2U6Ci0Ja2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKIAlyZXR1cm4gZXJyOwogfQog
CkBAIC0yNjg0LDcgKzI2NjEsNiBAQCBzdGF0aWMgaW50IHByZXNlcnZlZF92aXJ0dWFsX2VuZ2lu
ZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCQkJCSAgICB1bnNpZ25lZCBpbnQgbnNpYmxpbmcpCiB7
CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqbGFzdCA9IE5VTEw7Ci0Jc3RydWN0IGk5MTVfZ2VtX2Nv
bnRleHQgKmN0eDsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqdmU7CiAJc3RydWN0IGk5MTVfdm1h
ICpzY3JhdGNoOwogCXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7CkBAIC0yNjkyLDE3ICsyNjY4LDEx
IEBAIHN0YXRpYyBpbnQgcHJlc2VydmVkX3ZpcnR1YWxfZW5naW5lKHN0cnVjdCBpbnRlbF9ndCAq
Z3QsCiAJaW50IGVyciA9IDA7CiAJdTMyICpjczsKIAotCWN0eCA9IGtlcm5lbF9jb250ZXh0KGd0
LT5pOTE1KTsKLQlpZiAoIWN0eCkKLQkJcmV0dXJuIC1FTk9NRU07Ci0KIAlzY3JhdGNoID0gY3Jl
YXRlX3NjcmF0Y2goc2libGluZ3NbMF0tPmd0KTsKLQlpZiAoSVNfRVJSKHNjcmF0Y2gpKSB7Ci0J
CWVyciA9IFBUUl9FUlIoc2NyYXRjaCk7Ci0JCWdvdG8gb3V0X2Nsb3NlOwotCX0KKwlpZiAoSVNf
RVJSKHNjcmF0Y2gpKQorCQlyZXR1cm4gUFRSX0VSUihzY3JhdGNoKTsKIAotCXZlID0gaW50ZWxf
ZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFsKGN0eCwgc2libGluZ3MsIG5zaWJsaW5nKTsKKwl2ZSA9
IGludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChzaWJsaW5ncywgbnNpYmxpbmcpOwogCWlm
IChJU19FUlIodmUpKSB7CiAJCWVyciA9IFBUUl9FUlIodmUpOwogCQlnb3RvIG91dF9zY3JhdGNo
OwpAQCAtMjc4NSw4ICsyNzU1LDYgQEAgc3RhdGljIGludCBwcmVzZXJ2ZWRfdmlydHVhbF9lbmdp
bmUoc3RydWN0IGludGVsX2d0ICpndCwKIAlpbnRlbF9jb250ZXh0X3B1dCh2ZSk7CiBvdXRfc2Ny
YXRjaDoKIAlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmc2NyYXRjaCwgMCk7Ci1vdXRfY2xv
c2U6Ci0Ja2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKIAlyZXR1cm4gZXJyOwogfQogCkBAIC0y
ODM4LDcgKzI4MDYsNiBAQCBzdGF0aWMgaW50IGJvbmRfdmlydHVhbF9lbmdpbmUoc3RydWN0IGlu
dGVsX2d0ICpndCwKICNkZWZpbmUgQk9ORF9TQ0hFRFVMRSBCSVQoMCkKIHsKIAlzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICptYXN0ZXI7Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKIAlz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycVsxNl07CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAJ
dW5zaWduZWQgbG9uZyBuOwpAQCAtMjg0NiwxMCArMjgxMyw2IEBAIHN0YXRpYyBpbnQgYm9uZF92
aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCiAJR0VNX0JVR19PTihuc2libGlu
ZyA+PSBBUlJBWV9TSVpFKHJxKSAtIDEpOwogCi0JY3R4ID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5
MTUpOwotCWlmICghY3R4KQotCQlyZXR1cm4gLUVOT01FTTsKLQogCWVyciA9IDA7CiAJcnFbMF0g
PSBFUlJfUFRSKC1FTk9NRU0pOwogCWZvcl9lYWNoX2VuZ2luZShtYXN0ZXIsIGd0LCBpZCkgewpA
QCAtMjg2MCw3ICsyODIzLDcgQEAgc3RhdGljIGludCBib25kX3ZpcnR1YWxfZW5naW5lKHN0cnVj
dCBpbnRlbF9ndCAqZ3QsCiAKIAkJbWVtc2V0X3AoKHZvaWQgKilycSwgRVJSX1BUUigtRUlOVkFM
KSwgQVJSQVlfU0laRShycSkpOwogCi0JCXJxWzBdID0gaWd0X3JlcXVlc3RfYWxsb2MoY3R4LCBt
YXN0ZXIpOworCQlycVswXSA9IGk5MTVfcmVxdWVzdF9jcmVhdGUobWFzdGVyLT5rZXJuZWxfY29u
dGV4dCk7CiAJCWlmIChJU19FUlIocnFbMF0pKSB7CiAJCQllcnIgPSBQVFJfRVJSKHJxWzBdKTsK
IAkJCWdvdG8gb3V0OwpAQCAtMjg4MCw5ICsyODQzLDcgQEAgc3RhdGljIGludCBib25kX3ZpcnR1
YWxfZW5naW5lKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCiAJCWZvciAobiA9IDA7IG4gPCBuc2libGlu
ZzsgbisrKSB7CiAJCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqdmU7CiAKLQkJCXZlID0gaW50ZWxf
ZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFsKGN0eCwKLQkJCQkJCQkgICAgc2libGluZ3MsCi0JCQkJ
CQkJICAgIG5zaWJsaW5nKTsKKwkJCXZlID0gaW50ZWxfZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFs
KHNpYmxpbmdzLCBuc2libGluZyk7CiAJCQlpZiAoSVNfRVJSKHZlKSkgewogCQkJCWVyciA9IFBU
Ul9FUlIodmUpOwogCQkJCW9uc3RhY2tfZmVuY2VfZmluaSgmZmVuY2UpOwpAQCAtMjk2MCw3ICsy
OTIxLDYgQEAgc3RhdGljIGludCBib25kX3ZpcnR1YWxfZW5naW5lKHN0cnVjdCBpbnRlbF9ndCAq
Z3QsCiAJaWYgKGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KSkKIAkJZXJyID0gLUVJTzsKIAotCWtl
cm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMzI3MCw4ICsz
MjMwLDcgQEAgc3RhdGljIGludCBsaXZlX2xyY19maXhlZCh2b2lkICphcmcpCiAJcmV0dXJuIGVy
cjsKIH0KIAotc3RhdGljIGludCBfX2xpdmVfbHJjX3N0YXRlKHN0cnVjdCBpOTE1X2dlbV9jb250
ZXh0ICpmaXhtZSwKLQkJCSAgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCitzdGF0
aWMgaW50IF9fbGl2ZV9scmNfc3RhdGUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAog
CQkJICAgIHN0cnVjdCBpOTE1X3ZtYSAqc2NyYXRjaCkKIHsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4
dCAqY2U7CkBAIC0zMjg2LDcgKzMyNDUsNyBAQCBzdGF0aWMgaW50IF9fbGl2ZV9scmNfc3RhdGUo
c3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmZpeG1lLAogCWludCBlcnI7CiAJaW50IG47CiAKLQlj
ZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGZpeG1lLCBlbmdpbmUpOworCWNlID0gaW50ZWxfY29u
dGV4dF9jcmVhdGUoZW5naW5lKTsKIAlpZiAoSVNfRVJSKGNlKSkKIAkJcmV0dXJuIFBUUl9FUlIo
Y2UpOwogCkBAIC0zMzYwLDcgKzMzMTksNiBAQCBzdGF0aWMgaW50IGxpdmVfbHJjX3N0YXRlKHZv
aWQgKmFyZykKIHsKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwogCXN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZTsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqZml4bWU7CiAJc3Ry
dWN0IGk5MTVfdm1hICpzY3JhdGNoOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwogCWludCBl
cnIgPSAwOwpAQCAtMzM3MCwxOCArMzMyOCwxMiBAQCBzdGF0aWMgaW50IGxpdmVfbHJjX3N0YXRl
KHZvaWQgKmFyZykKIAkgKiBpbnRlbF9jb250ZXh0LgogCSAqLwogCi0JZml4bWUgPSBrZXJuZWxf
Y29udGV4dChndC0+aTkxNSk7Ci0JaWYgKCFmaXhtZSkKLQkJcmV0dXJuIC1FTk9NRU07Ci0KIAlz
Y3JhdGNoID0gY3JlYXRlX3NjcmF0Y2goZ3QpOwotCWlmIChJU19FUlIoc2NyYXRjaCkpIHsKLQkJ
ZXJyID0gUFRSX0VSUihzY3JhdGNoKTsKLQkJZ290byBvdXRfY2xvc2U7Ci0JfQorCWlmIChJU19F
UlIoc2NyYXRjaCkpCisJCXJldHVybiBQVFJfRVJSKHNjcmF0Y2gpOwogCiAJZm9yX2VhY2hfZW5n
aW5lKGVuZ2luZSwgZ3QsIGlkKSB7Ci0JCWVyciA9IF9fbGl2ZV9scmNfc3RhdGUoZml4bWUsIGVu
Z2luZSwgc2NyYXRjaCk7CisJCWVyciA9IF9fbGl2ZV9scmNfc3RhdGUoZW5naW5lLCBzY3JhdGNo
KTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCX0KQEAgLTMzOTAsOCArMzM0Miw2IEBAIHN0YXRp
YyBpbnQgbGl2ZV9scmNfc3RhdGUodm9pZCAqYXJnKQogCQllcnIgPSAtRUlPOwogCiAJaTkxNV92
bWFfdW5waW5fYW5kX3JlbGVhc2UoJnNjcmF0Y2gsIDApOwotb3V0X2Nsb3NlOgotCWtlcm5lbF9j
b250ZXh0X2Nsb3NlKGZpeG1lKTsKIAlyZXR1cm4gZXJyOwogfQogCkBAIC0zNDI0LDggKzMzNzQs
NyBAQCBzdGF0aWMgaW50IGdwcl9tYWtlX2RpcnR5KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSkKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGludCBfX2xpdmVfZ3ByX2NsZWFyKHN0cnVj
dCBpOTE1X2dlbV9jb250ZXh0ICpmaXhtZSwKLQkJCSAgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmUsCitzdGF0aWMgaW50IF9fbGl2ZV9ncHJfY2xlYXIoc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lLAogCQkJICAgIHN0cnVjdCBpOTE1X3ZtYSAqc2NyYXRjaCkKIHsKIAlzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2U7CkBAIC0zNDQxLDcgKzMzOTAsNyBAQCBzdGF0aWMgaW50IF9f
bGl2ZV9ncHJfY2xlYXIoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmZpeG1lLAogCWlmIChlcnIp
CiAJCXJldHVybiBlcnI7CiAKLQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGZpeG1lLCBlbmdp
bmUpOworCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKIAlpZiAoSVNfRVJSKGNl
KSkKIAkJcmV0dXJuIFBUUl9FUlIoY2UpOwogCkBAIC0zNTAzLDcgKzM0NTIsNiBAQCBzdGF0aWMg
aW50IGxpdmVfZ3ByX2NsZWFyKHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0g
YXJnOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQlzdHJ1Y3QgaTkxNV9nZW1f
Y29udGV4dCAqZml4bWU7CiAJc3RydWN0IGk5MTVfdm1hICpzY3JhdGNoOwogCWVudW0gaW50ZWxf
ZW5naW5lX2lkIGlkOwogCWludCBlcnIgPSAwOwpAQCAtMzUxMywxOCArMzQ2MSwxMiBAQCBzdGF0
aWMgaW50IGxpdmVfZ3ByX2NsZWFyKHZvaWQgKmFyZykKIAkgKiB0byBhdm9pZCBsZWFraW5nIGFu
eSBpbmZvcm1hdGlvbiBmcm9tIHByZXZpb3VzIGNvbnRleHRzLgogCSAqLwogCi0JZml4bWUgPSBr
ZXJuZWxfY29udGV4dChndC0+aTkxNSk7Ci0JaWYgKCFmaXhtZSkKLQkJcmV0dXJuIC1FTk9NRU07
Ci0KIAlzY3JhdGNoID0gY3JlYXRlX3NjcmF0Y2goZ3QpOwotCWlmIChJU19FUlIoc2NyYXRjaCkp
IHsKLQkJZXJyID0gUFRSX0VSUihzY3JhdGNoKTsKLQkJZ290byBvdXRfY2xvc2U7Ci0JfQorCWlm
IChJU19FUlIoc2NyYXRjaCkpCisJCXJldHVybiBQVFJfRVJSKHNjcmF0Y2gpOwogCiAJZm9yX2Vh
Y2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7Ci0JCWVyciA9IF9fbGl2ZV9ncHJfY2xlYXIoZml4
bWUsIGVuZ2luZSwgc2NyYXRjaCk7CisJCWVyciA9IF9fbGl2ZV9ncHJfY2xlYXIoZW5naW5lLCBz
Y3JhdGNoKTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCX0KQEAgLTM1MzMsOCArMzQ3NSw2IEBA
IHN0YXRpYyBpbnQgbGl2ZV9ncHJfY2xlYXIodm9pZCAqYXJnKQogCQllcnIgPSAtRUlPOwogCiAJ
aTkxNV92bWFfdW5waW5fYW5kX3JlbGVhc2UoJnNjcmF0Y2gsIDApOwotb3V0X2Nsb3NlOgotCWtl
cm5lbF9jb250ZXh0X2Nsb3NlKGZpeG1lKTsKIAlyZXR1cm4gZXJyOwogfQogCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29ya2Fyb3VuZHMuYwppbmRleCBkNWQxZTFhMzIx
ODcuLmFjMTkyMTg1NGNiZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3Rfd29ya2Fyb3VuZHMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVz
dF93b3JrYXJvdW5kcy5jCkBAIC0yNjQsMjIgKzI2NCwxNSBAQCBzdGF0aWMgaW50CiBzd2l0Y2hf
dG9fc2NyYXRjaF9jb250ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAkJCSAg
c3RydWN0IGlndF9zcGlubmVyICpzcGluKQogewotCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpj
dHg7CiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
OwogCWludCBlcnIgPSAwOwogCi0JY3R4ID0ga2VybmVsX2NvbnRleHQoZW5naW5lLT5pOTE1KTsK
LQlpZiAoSVNfRVJSKGN0eCkpCi0JCXJldHVybiBQVFJfRVJSKGN0eCk7Ci0KLQlHRU1fQlVHX09O
KGk5MTVfZ2VtX2NvbnRleHRfaXNfYmFubmFibGUoY3R4KSk7Ci0KLQljZSA9IGk5MTVfZ2VtX2Nv
bnRleHRfZ2V0X2VuZ2luZShjdHgsIGVuZ2luZS0+bGVnYWN5X2lkeCk7Ci0JR0VNX0JVR19PTihJ
U19FUlIoY2UpKTsKKwljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CisJaWYgKElT
X0VSUihjZSkpCisJCXJldHVybiBQVFJfRVJSKGNlKTsKIAogCXJxID0gaWd0X3NwaW5uZXJfY3Jl
YXRlX3JlcXVlc3Qoc3BpbiwgY2UsIE1JX05PT1ApOwotCiAJaW50ZWxfY29udGV4dF9wdXQoY2Up
OwogCiAJaWYgKElTX0VSUihycSkpIHsKQEAgLTI5Myw3ICsyODYsNiBAQCBzd2l0Y2hfdG9fc2Ny
YXRjaF9jb250ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAlpZiAoZXJyICYm
IHNwaW4pCiAJCWlndF9zcGlubmVyX2VuZChzcGluKTsKIAotCWtlcm5lbF9jb250ZXh0X2Nsb3Nl
KGN0eCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMzY3LDIwICszNTksMTcgQEAgc3RhdGljIGlu
dCBjaGVja193aGl0ZWxpc3RfYWNyb3NzX3Jlc2V0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSwKIAlyZXR1cm4gZXJyOwogfQogCi1zdGF0aWMgc3RydWN0IGk5MTVfdm1hICpjcmVhdGVf
YmF0Y2goc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKK3N0YXRpYyBzdHJ1Y3QgaTkxNV92
bWEgKmNyZWF0ZV9iYXRjaChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIHsKIAlzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ug
KnZtOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCWludCBlcnI7CiAKLQlvYmogPSBpOTE1X2dl
bV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGN0eC0+aTkxNSwgMTYgKiBQQUdFX1NJWkUpOworCW9i
aiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwodm0tPmk5MTUsIDE2ICogUEFHRV9T
SVpFKTsKIAlpZiAoSVNfRVJSKG9iaikpCiAJCXJldHVybiBFUlJfQ0FTVChvYmopOwogCi0Jdm0g
PSBpOTE1X2dlbV9jb250ZXh0X2dldF92bV9yY3UoY3R4KTsKIAl2bWEgPSBpOTE1X3ZtYV9pbnN0
YW5jZShvYmosIHZtLCBOVUxMKTsKLQlpOTE1X3ZtX3B1dCh2bSk7CiAJaWYgKElTX0VSUih2bWEp
KSB7CiAJCWVyciA9IFBUUl9FUlIodm1hKTsKIAkJZ290byBlcnJfb2JqOwpAQCAtNDUyLDggKzQ0
MSw3IEBAIHN0YXRpYyBpbnQgd2hpdGVsaXN0X3dyaXRhYmxlX2NvdW50KHN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZSkKIAlyZXR1cm4gY291bnQ7CiB9CiAKLXN0YXRpYyBpbnQgY2hlY2tf
ZGlydHlfd2hpdGVsaXN0KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCi0JCQkJIHN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKK3N0YXRpYyBpbnQgY2hlY2tfZGlydHlfd2hpdGVs
aXN0KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIHsKIAljb25zdCB1MzIgdmFsdWVzW10gPSB7
CiAJCTB4MDAwMDAwMDAsCkBAIC00ODEsMTkgKzQ2OSwxNyBAQCBzdGF0aWMgaW50IGNoZWNrX2Rp
cnR5X3doaXRlbGlzdChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogCQkweGZmZmYwMGZm
LAogCQkweGZmZmZmZmZmLAogCX07Ci0Jc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CisJ
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lID0gY2UtPmVuZ2luZTsKIAlzdHJ1Y3QgaTkx
NV92bWEgKnNjcmF0Y2g7CiAJc3RydWN0IGk5MTVfdm1hICpiYXRjaDsKIAlpbnQgZXJyID0gMCwg
aSwgdjsKIAl1MzIgKmNzLCAqcmVzdWx0czsKIAotCXZtID0gaTkxNV9nZW1fY29udGV4dF9nZXRf
dm1fcmN1KGN0eCk7Ci0Jc2NyYXRjaCA9IGNyZWF0ZV9zY3JhdGNoKHZtLCAyICogQVJSQVlfU0la
RSh2YWx1ZXMpICsgMSk7Ci0JaTkxNV92bV9wdXQodm0pOworCXNjcmF0Y2ggPSBjcmVhdGVfc2Ny
YXRjaChjZS0+dm0sIDIgKiBBUlJBWV9TSVpFKHZhbHVlcykgKyAxKTsKIAlpZiAoSVNfRVJSKHNj
cmF0Y2gpKQogCQlyZXR1cm4gUFRSX0VSUihzY3JhdGNoKTsKIAotCWJhdGNoID0gY3JlYXRlX2Jh
dGNoKGN0eCk7CisJYmF0Y2ggPSBjcmVhdGVfYmF0Y2goY2UtPnZtKTsKIAlpZiAoSVNfRVJSKGJh
dGNoKSkgewogCQllcnIgPSBQVFJfRVJSKGJhdGNoKTsKIAkJZ290byBvdXRfc2NyYXRjaDsKQEAg
LTUxOCw3ICs1MDQsNyBAQCBzdGF0aWMgaW50IGNoZWNrX2RpcnR5X3doaXRlbGlzdChzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqY3R4LAogCiAJCXNybSA9IE1JX1NUT1JFX1JFR0lTVEVSX01FTTsK
IAkJbHJtID0gTUlfTE9BRF9SRUdJU1RFUl9NRU07Ci0JCWlmIChJTlRFTF9HRU4oY3R4LT5pOTE1
KSA+PSA4KQorCQlpZiAoSU5URUxfR0VOKGVuZ2luZS0+aTkxNSkgPj0gOCkKIAkJCWxybSsrLCBz
cm0rKzsKIAogCQlwcl9kZWJ1ZygiJXM6IFdyaXRpbmcgZ2FyYmFnZSB0byAleFxuIiwKQEAgLTU3
Nyw3ICs1NjMsNyBAQCBzdGF0aWMgaW50IGNoZWNrX2RpcnR5X3doaXRlbGlzdChzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dCAqY3R4LAogCQlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKGJhdGNoLT5v
YmopOwogCQlpbnRlbF9ndF9jaGlwc2V0X2ZsdXNoKGVuZ2luZS0+Z3QpOwogCi0JCXJxID0gaWd0
X3JlcXVlc3RfYWxsb2MoY3R4LCBlbmdpbmUpOworCQlycSA9IGludGVsX2NvbnRleHRfY3JlYXRl
X3JlcXVlc3QoY2UpOwogCQlpZiAoSVNfRVJSKHJxKSkgewogCQkJZXJyID0gUFRSX0VSUihycSk7
CiAJCQlnb3RvIG91dF9iYXRjaDsKQEAgLTY5Niw3ICs2ODIsNyBAQCBzdGF0aWMgaW50IGNoZWNr
X2RpcnR5X3doaXRlbGlzdChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogCQkJYnJlYWs7
CiAJfQogCi0JaWYgKGlndF9mbHVzaF90ZXN0KGN0eC0+aTkxNSkpCisJaWYgKGlndF9mbHVzaF90
ZXN0KGVuZ2luZS0+aTkxNSkpCiAJCWVyciA9IC1FSU87CiBvdXRfYmF0Y2g6CiAJaTkxNV92bWFf
dW5waW5fYW5kX3JlbGVhc2UoJmJhdGNoLCAwKTsKQEAgLTcwOSwzOCArNjk1LDMxIEBAIHN0YXRp
YyBpbnQgbGl2ZV9kaXJ0eV93aGl0ZWxpc3Qodm9pZCAqYXJnKQogewogCXN0cnVjdCBpbnRlbF9n
dCAqZ3QgPSBhcmc7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCXN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0ICpjdHg7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7Ci0Jc3RydWN0
IGZpbGUgKmZpbGU7Ci0JaW50IGVyciA9IDA7CiAKIAkvKiBDYW4gdGhlIHVzZXIgd3JpdGUgdG8g
dGhlIHdoaXRlbGlzdGVkIHJlZ2lzdGVycz8gKi8KIAogCWlmIChJTlRFTF9HRU4oZ3QtPmk5MTUp
IDwgNykgLyogbWluaW11bSByZXF1aXJlbWVudCBmb3IgTFJJLCBTUk0sIExSTSAqLwogCQlyZXR1
cm4gMDsKIAotCWZpbGUgPSBtb2NrX2ZpbGUoZ3QtPmk5MTUpOwotCWlmIChJU19FUlIoZmlsZSkp
Ci0JCXJldHVybiBQVFJfRVJSKGZpbGUpOwotCi0JY3R4ID0gbGl2ZV9jb250ZXh0KGd0LT5pOTE1
LCBmaWxlKTsKLQlpZiAoSVNfRVJSKGN0eCkpIHsKLQkJZXJyID0gUFRSX0VSUihjdHgpOwotCQln
b3RvIG91dF9maWxlOwotCX0KLQogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgewor
CQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CisJCWludCBlcnI7CisKIAkJaWYgKGVuZ2luZS0+
d2hpdGVsaXN0LmNvdW50ID09IDApCiAJCQljb250aW51ZTsKIAotCQllcnIgPSBjaGVja19kaXJ0
eV93aGl0ZWxpc3QoY3R4LCBlbmdpbmUpOworCQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVu
Z2luZSk7CisJCWlmIChJU19FUlIoY2UpKQorCQkJcmV0dXJuIFBUUl9FUlIoY2UpOworCisJCWVy
ciA9IGNoZWNrX2RpcnR5X3doaXRlbGlzdChjZSk7CisJCWludGVsX2NvbnRleHRfcHV0KGNlKTsK
IAkJaWYgKGVycikKLQkJCWdvdG8gb3V0X2ZpbGU7CisJCQlyZXR1cm4gZXJyOwogCX0KIAotb3V0
X2ZpbGU6Ci0JZnB1dChmaWxlKTsKLQlyZXR1cm4gZXJyOworCXJldHVybiAwOwogfQogCiBzdGF0
aWMgaW50IGxpdmVfcmVzZXRfd2hpdGVsaXN0KHZvaWQgKmFyZykKQEAgLTgzMCwxMiArODA5LDE1
IEBAIHN0YXRpYyBpbnQgcmVhZF93aGl0ZWxpc3RlZF9yZWdpc3RlcnMoc3RydWN0IGk5MTVfZ2Vt
X2NvbnRleHQgKmN0eCwKIHN0YXRpYyBpbnQgc2NydWJfd2hpdGVsaXN0ZWRfcmVnaXN0ZXJzKHN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCQkJICAgICAgIHN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZSkKIHsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKIAlzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAlzdHJ1Y3QgaTkxNV92bWEgKmJhdGNoOwogCWludCBpLCBl
cnIgPSAwOwogCXUzMiAqY3M7CiAKLQliYXRjaCA9IGNyZWF0ZV9iYXRjaChjdHgpOworCXZtID0g
aTkxNV9nZW1fY29udGV4dF9nZXRfdm1fcmN1KGN0eCk7CisJYmF0Y2ggPSBjcmVhdGVfYmF0Y2go
dm0pOworCWk5MTVfdm1fcHV0KHZtKTsKIAlpZiAoSVNfRVJSKGJhdGNoKSkKIAkJcmV0dXJuIFBU
Ul9FUlIoYmF0Y2gpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2No
ZWR1bGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVyLmMKaW5kZXggMjI4
YzY2NTM0ZTIxLi5iMzI5OWY4OGUyNGUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d2dC9zY2hlZHVsZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVy
LmMKQEAgLTM1LDEyICszNSwxMiBAQAogCiAjaW5jbHVkZSA8bGludXgva3RocmVhZC5oPgogCi0j
aW5jbHVkZSAiZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaCIKICNpbmNsdWRlICJnZW0vaTkxNV9nZW1f
cG0uaCIKICNpbmNsdWRlICJndC9pbnRlbF9jb250ZXh0LmgiCiAjaW5jbHVkZSAiZ3QvaW50ZWxf
cmluZy5oIgogCiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIKKyNpbmNsdWRlICJpOTE1X2dlbV9ndHQu
aCIKICNpbmNsdWRlICJndnQuaCIKIAogI2RlZmluZSBSSU5HX0NUWF9PRkYoeCkgXApAQCAtMTIy
MCwxNiArMTIyMCwxNCBAQCBpbnQgaW50ZWxfdmdwdV9zZXR1cF9zdWJtaXNzaW9uKHN0cnVjdCBp
bnRlbF92Z3B1ICp2Z3B1KQogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdmdwdS0+
Z3Z0LT5kZXZfcHJpdjsKIAlzdHJ1Y3QgaW50ZWxfdmdwdV9zdWJtaXNzaW9uICpzID0gJnZncHUt
PnN1Ym1pc3Npb247CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCXN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0ICpjdHg7CiAJc3RydWN0IGk5MTVfcHBndHQgKnBwZ3R0OwogCWVudW0g
aW50ZWxfZW5naW5lX2lkIGk7CiAJaW50IHJldDsKIAotCWN0eCA9IGk5MTVfZ2VtX2NvbnRleHRf
Y3JlYXRlX2tlcm5lbChpOTE1LCBJOTE1X1BSSU9SSVRZX01BWCk7Ci0JaWYgKElTX0VSUihjdHgp
KQotCQlyZXR1cm4gUFRSX0VSUihjdHgpOworCXBwZ3R0ID0gaTkxNV9wcGd0dF9jcmVhdGUoaTkx
NSk7CisJaWYgKElTX0VSUihwcGd0dCkpCisJCXJldHVybiBQVFJfRVJSKHBwZ3R0KTsKIAotCXBw
Z3R0ID0gaTkxNV92bV90b19wcGd0dChpOTE1X2dlbV9jb250ZXh0X2dldF92bV9yY3UoY3R4KSk7
CiAJaTkxNV9jb250ZXh0X3BwZ3R0X3Jvb3Rfc2F2ZShzLCBwcGd0dCk7CiAKIAlmb3JfZWFjaF9l
bmdpbmUoZW5naW5lLCBpOTE1LCBpKSB7CkBAIC0xMjM4LDEyICsxMjM2LDE0IEBAIGludCBpbnRl
bF92Z3B1X3NldHVwX3N1Ym1pc3Npb24oc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAJCUlOSVRf
TElTVF9IRUFEKCZzLT53b3JrbG9hZF9xX2hlYWRbaV0pOwogCQlzLT5zaGFkb3dbaV0gPSBFUlJf
UFRSKC1FSU5WQUwpOwogCi0JCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoY3R4LCBlbmdpbmUp
OworCQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CiAJCWlmIChJU19FUlIoY2Up
KSB7CiAJCQlyZXQgPSBQVFJfRVJSKGNlKTsKIAkJCWdvdG8gb3V0X3NoYWRvd19jdHg7CiAJCX0K
IAorCQlpOTE1X3ZtX3B1dChjZS0+dm0pOworCQljZS0+dm0gPSBpOTE1X3ZtX2dldCgmcHBndHQt
PnZtKTsKIAkJaW50ZWxfY29udGV4dF9zZXRfc2luZ2xlX3N1Ym1pc3Npb24oY2UpOwogCiAJCWlm
ICghVVNFU19HVUNfU1VCTUlTU0lPTihpOTE1KSkgeyAvKiBNYXggcmluZyBidWZmZXIgc2l6ZSAq
LwpAQCAtMTI3OCw3ICsxMjc4LDYgQEAgaW50IGludGVsX3ZncHVfc2V0dXBfc3VibWlzc2lvbihz
dHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAliaXRtYXBfemVybyhzLT50bGJfaGFuZGxlX3BlbmRp
bmcsIEk5MTVfTlVNX0VOR0lORVMpOwogCiAJaTkxNV92bV9wdXQoJnBwZ3R0LT52bSk7Ci0JaTkx
NV9nZW1fY29udGV4dF9wdXQoY3R4KTsKIAlyZXR1cm4gMDsKIAogb3V0X3NoYWRvd19jdHg6CkBA
IC0xMjkxLDcgKzEyOTAsNiBAQCBpbnQgaW50ZWxfdmdwdV9zZXR1cF9zdWJtaXNzaW9uKHN0cnVj
dCBpbnRlbF92Z3B1ICp2Z3B1KQogCQlpbnRlbF9jb250ZXh0X3B1dChzLT5zaGFkb3dbaV0pOwog
CX0KIAlpOTE1X3ZtX3B1dCgmcHBndHQtPnZtKTsKLQlpOTE1X2dlbV9jb250ZXh0X3B1dChjdHgp
OwogCXJldHVybiByZXQ7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfYWN0aXZlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jCmluZGV4IDIw
NzM4M2RkYTg0ZC4uOTUzMzU5ZmI4MmYyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2FjdGl2ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMK
QEAgLTYsNiArNiw3IEBACiAKICNpbmNsdWRlIDxsaW51eC9kZWJ1Z29iamVjdHMuaD4KIAorI2lu
Y2x1ZGUgImd0L2ludGVsX2NvbnRleHQuaCIKICNpbmNsdWRlICJndC9pbnRlbF9lbmdpbmVfcG0u
aCIKICNpbmNsdWRlICJndC9pbnRlbF9yaW5nLmgiCiAKQEAgLTcwOCw2ICs3MDksNyBAQCB2b2lk
IGk5MTVfcmVxdWVzdF9hZGRfYWN0aXZlX2JhcnJpZXJzKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
KQogCXN0cnVjdCBsbGlzdF9ub2RlICpub2RlLCAqbmV4dDsKIAl1bnNpZ25lZCBsb25nIGZsYWdz
OwogCisJR0VNX0JVR19PTighaW50ZWxfY29udGV4dF9pc19iYXJyaWVyKHJxLT5jb250ZXh0KSk7
CiAJR0VNX0JVR19PTihpbnRlbF9lbmdpbmVfaXNfdmlydHVhbChlbmdpbmUpKTsKIAlHRU1fQlVH
X09OKGk5MTVfcmVxdWVzdF90aW1lbGluZShycSkgIT0gZW5naW5lLT5rZXJuZWxfY29udGV4dC0+
dGltZWxpbmUpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5o
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAppbmRleCA3ZTBmNjdiYWJlMjAuLjdl
OGEwMzllNGYyOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCkBAIC05NjAsOSArOTYwLDYgQEAg
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgewogCiAJc3RydWN0IHBjaV9kZXYgKmJyaWRnZV9kZXY7
CiAKLQkvKiBDb250ZXh0IHVzZWQgaW50ZXJuYWxseSB0byBpZGxlIHRoZSBHUFUgYW5kIHNldHVw
IGluaXRpYWwgc3RhdGUgKi8KLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqa2VybmVsX2NvbnRl
eHQ7Ci0KIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmVbSTkxNV9OVU1fRU5HSU5FU107
CiAJc3RydWN0IHJiX3Jvb3QgdWFiaV9lbmdpbmVzOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwpp
bmRleCBmNGNiZDM3OWRiOTUuLjkyYTVjOWFiMzQ0NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5j
CkBAIC0xMDYzLDggKzEwNjMsNyBAQCBzdGF0aWMgaW50IF9faW50ZWxfZW5naW5lc19yZWNvcmRf
ZGVmYXVsdHMoc3RydWN0IGludGVsX2d0ICpndCkKIAkJR0VNX0JVR19PTighZW5naW5lLT5rZXJu
ZWxfY29udGV4dCk7CiAJCWVuZ2luZS0+c2VyaWFsKys7IC8qIGZvcmNlIHRoZSBrZXJuZWwgY29u
dGV4dCBzd2l0Y2ggKi8KIAotCQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZS0+a2Vy
bmVsX2NvbnRleHQtPmdlbV9jb250ZXh0LAotCQkJCQkgIGVuZ2luZSk7CisJCWNlID0gaW50ZWxf
Y29udGV4dF9jcmVhdGUoZW5naW5lKTsKIAkJaWYgKElTX0VSUihjZSkpIHsKIAkJCWVyciA9IFBU
Ul9FUlIoY2UpOwogCQkJZ290byBvdXQ7CkBAIC0xMjE3LDYgKzEyMTYsNyBAQCBpbnQgaTkxNV9n
ZW1faW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJfQogCiAJaW50ZWxf
Z3RfaW5pdCgmZGV2X3ByaXYtPmd0KTsKKwlpOTE1X2dlbV9pbml0X19jb250ZXh0cyhkZXZfcHJp
dik7CiAKIAlyZXQgPSBpbnRlbF9lbmdpbmVzX3NldHVwKCZkZXZfcHJpdi0+Z3QpOwogCWlmIChy
ZXQpIHsKQEAgLTEyMjQsMTYgKzEyMjQsMTAgQEAgaW50IGk5MTVfZ2VtX2luaXQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlnb3RvIGVycl91bmxvY2s7CiAJfQogCi0JcmV0
ID0gaTkxNV9nZW1faW5pdF9jb250ZXh0cyhkZXZfcHJpdik7Ci0JaWYgKHJldCkgewotCQlHRU1f
QlVHX09OKHJldCA9PSAtRUlPKTsKLQkJZ290byBlcnJfc2NyYXRjaDsKLQl9Ci0KIAlyZXQgPSBp
bnRlbF9lbmdpbmVzX2luaXQoJmRldl9wcml2LT5ndCk7CiAJaWYgKHJldCkgewogCQlHRU1fQlVH
X09OKHJldCA9PSAtRUlPKTsKLQkJZ290byBlcnJfY29udGV4dDsKKwkJZ290byBlcnJfc2NyYXRj
aDsKIAl9CiAKIAlpbnRlbF91Y19pbml0KCZkZXZfcHJpdi0+Z3QudWMpOwpAQCAtMTI5Nyw5ICsx
MjkxLDYgQEAgaW50IGk5MTVfZ2VtX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQogCQlpbnRlbF91Y19maW5pKCZkZXZfcHJpdi0+Z3QudWMpOwogCQlpbnRlbF9lbmdpbmVz
X2NsZWFudXAoJmRldl9wcml2LT5ndCk7CiAJfQotZXJyX2NvbnRleHQ6Ci0JaWYgKHJldCAhPSAt
RUlPKQotCQlpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZV9fY29udGV4dHMoZGV2X3ByaXYpOwogZXJy
X3NjcmF0Y2g6CiAJaW50ZWxfZ3RfZHJpdmVyX3JlbGVhc2UoJmRldl9wcml2LT5ndCk7CiBlcnJf
dW5sb2NrOgpAQCAtMTM2NCw3ICsxMzU1LDYgQEAgdm9pZCBpOTE1X2dlbV9kcml2ZXJfcmVtb3Zl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHZvaWQgaTkxNV9nZW1fZHJpdmVy
X3JlbGVhc2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogewogCWludGVsX2Vu
Z2luZXNfY2xlYW51cCgmZGV2X3ByaXYtPmd0KTsKLQlpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZV9f
Y29udGV4dHMoZGV2X3ByaXYpOwogCWludGVsX2d0X2RyaXZlcl9yZWxlYXNlKCZkZXZfcHJpdi0+
Z3QpOwogCiAJaW50ZWxfd2FfbGlzdF9mcmVlKCZkZXZfcHJpdi0+Z3Rfd2FfbGlzdCk7CkBAIC0x
MzcyLDYgKzEzNjIsOCBAQCB2b2lkIGk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlpbnRlbF91Y19jbGVhbnVwX2Zpcm13YXJlcygmZGV2
X3ByaXYtPmd0LnVjKTsKIAlpOTE1X2dlbV9jbGVhbnVwX3VzZXJwdHIoZGV2X3ByaXYpOwogCisJ
aTkxNV9nZW1fZHJpdmVyX3JlbGVhc2VfX2NvbnRleHRzKGRldl9wcml2KTsKKwogCWk5MTVfZ2Vt
X2RyYWluX2ZyZWVkX29iamVjdHMoZGV2X3ByaXYpOwogCiAJV0FSTl9PTighbGlzdF9lbXB0eSgm
ZGV2X3ByaXYtPmdlbS5jb250ZXh0cy5saXN0KSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0
dC5jCmluZGV4IDYyMzlhOWFkYmYxNC4uYTIyYTJmZTQwOWM0IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9ndHQuYwpAQCAtMTM2MywxMiArMTM2Myw4IEBAIHN0YXRpYyBpbnQgZ2VuOF9pbml0
X3NjcmF0Y2goc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiAJICogSWYgZXZlcnlib2R5
IGFncmVlcyB0byBub3QgdG8gd3JpdGUgaW50byB0aGUgc2NyYXRjaCBwYWdlLAogCSAqIHdlIGNh
biByZXVzZSBpdCBmb3IgYWxsIHZtLCBrZWVwaW5nIGNvbnRleHRzIGFuZCBwcm9jZXNzZXMgc2Vw
YXJhdGUuCiAJICovCi0JaWYgKHZtLT5oYXNfcmVhZF9vbmx5ICYmCi0JICAgIHZtLT5pOTE1LT5r
ZXJuZWxfY29udGV4dCAmJgotCSAgICB2bS0+aTkxNS0+a2VybmVsX2NvbnRleHQtPnZtKSB7Ci0J
CXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKmNsb25lID0KLQkJCXJjdV9kZXJlZmVyZW5jZV9w
cm90ZWN0ZWQodm0tPmk5MTUtPmtlcm5lbF9jb250ZXh0LT52bSwKLQkJCQkJCSAgdHJ1ZSk7IC8q
IHN0YXRpYyAqLworCWlmICh2bS0+aGFzX3JlYWRfb25seSAmJiB2bS0+Z3QtPnZtICYmICFpOTE1
X2lzX2dndHQodm0tPmd0LT52bSkpIHsKKwkJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqY2xv
bmUgPSB2bS0+Z3QtPnZtOwogCiAJCUdFTV9CVUdfT04oIWNsb25lLT5oYXNfcmVhZF9vbmx5KTsK
IApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYwppbmRleCA5ZmYyNmI5OTEyNzYuLjQyMzk3NGY4MWE2
ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKQEAgLTIzNDAsOSArMjM0MCw2IEBAIHN0YXRp
YyBpbnQgbHJjX2NvbmZpZ3VyZV9hbGxfY29udGV4dHMoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0g
KnN0cmVhbSwKIAkgKi8KIAlzcGluX2xvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKIAls
aXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUoY3R4LCBjbiwgJmk5MTUtPmdlbS5jb250ZXh0cy5saXN0
LCBsaW5rKSB7Ci0JCWlmIChjdHggPT0gaTkxNS0+a2VybmVsX2NvbnRleHQpCi0JCQljb250aW51
ZTsKLQogCQlpZiAoIWtyZWZfZ2V0X3VubGVzc196ZXJvKCZjdHgtPnJlZikpCiAJCQljb250aW51
ZTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYwppbmRleCA2NzhiMzIwODk1MDcuLjIw
ZWVlZjM4NjU3NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKQEAgLTEyMzYsOCAr
MTIzNiw4IEBAIHZvaWQgX19pOTE1X3JlcXVlc3RfcXVldWUoc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnEsCiAKIHZvaWQgaTkxNV9yZXF1ZXN0X2FkZChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsK
LQlzdHJ1Y3QgaTkxNV9zY2hlZF9hdHRyIGF0dHIgPSBycS0+Y29udGV4dC0+Z2VtX2NvbnRleHQt
PnNjaGVkOwogCXN0cnVjdCBpbnRlbF90aW1lbGluZSAqIGNvbnN0IHRsID0gaTkxNV9yZXF1ZXN0
X3RpbWVsaW5lKHJxKTsKKwlzdHJ1Y3QgaTkxNV9zY2hlZF9hdHRyIGF0dHIgPSB7fTsKIAlzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpwcmV2OwogCiAJbG9ja2RlcF9hc3NlcnRfaGVsZCgmdGwtPm11dGV4
KTsKQEAgLTEyNDcsNiArMTI0Nyw5IEBAIHZvaWQgaTkxNV9yZXF1ZXN0X2FkZChzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpycSkKIAogCXByZXYgPSBfX2k5MTVfcmVxdWVzdF9jb21taXQocnEpOwogCisJ
aWYgKHJxLT5jb250ZXh0LT5nZW1fY29udGV4dCkKKwkJYXR0ciA9IHJxLT5jb250ZXh0LT5nZW1f
Y29udGV4dC0+c2NoZWQ7CisKIAkvKgogCSAqIEJvb3N0IGFjdHVhbCB3b3JrbG9hZHMgcGFzdCBz
ZW1hcGhvcmVzIQogCSAqCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaTkxNV9yZXF1ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9y
ZXF1ZXN0LmMKaW5kZXggNTBjYzdjYTlhZmJhLi5kMjlmNDRjZjMxNjIgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMKQEAgLTc0MSwxMCArNzQxLDgg
QEAgc3RhdGljIGludCBsaXZlX2VtcHR5X3JlcXVlc3Qodm9pZCAqYXJnKQogCiBzdGF0aWMgc3Ry
dWN0IGk5MTVfdm1hICpyZWN1cnNpdmVfYmF0Y2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCiB7Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IGk5MTUtPmtlcm5lbF9jb250
ZXh0OwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJY29uc3QgaW50IGdlbiA9
IElOVEVMX0dFTihpOTE1KTsKLQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKIAlzdHJ1
Y3QgaTkxNV92bWEgKnZtYTsKIAl1MzIgKmNtZDsKIAlpbnQgZXJyOwpAQCAtNzUzLDkgKzc1MSw3
IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKnJlY3Vyc2l2ZV9iYXRjaChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIAlpZiAoSVNfRVJSKG9iaikpCiAJCXJldHVybiBFUlJfQ0FTVChv
YmopOwogCi0Jdm0gPSBpOTE1X2dlbV9jb250ZXh0X2dldF92bV9yY3UoY3R4KTsKLQl2bWEgPSBp
OTE1X3ZtYV9pbnN0YW5jZShvYmosIHZtLCBOVUxMKTsKLQlpOTE1X3ZtX3B1dCh2bSk7CisJdm1h
ID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCBpOTE1LT5ndC52bSwgTlVMTCk7CiAJaWYgKElTX0VS
Uih2bWEpKSB7CiAJCWVyciA9IFBUUl9FUlIodm1hKTsKIAkJZ290byBlcnI7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKaW5kZXggZTU4YjBi
YzljZGI2Li5hNTM5ZDhiMzk2ODIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKQEAgLTYzLDcgKzYzLDYgQEAgc3RhdGljIHZvaWQgbW9j
a19kZXZpY2VfcmVsZWFzZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCiAJZm9yX2VhY2hfZW5n
aW5lKGVuZ2luZSwgJmk5MTUtPmd0LCBpZCkKIAkJbW9ja19lbmdpbmVfZnJlZShlbmdpbmUpOwot
CWk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNlX19jb250ZXh0cyhpOTE1KTsKIAogCWRyYWluX3dvcmtx
dWV1ZShpOTE1LT53cSk7CiAJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhpOTE1KTsKQEAg
LTE3OSw2ICsxNzgsNyBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqbW9ja19nZW1fZGV2aWNl
KHZvaWQpCiAJbW9ja19pbml0X2NvbnRleHRzKGk5MTUpOwogCiAJbW9ja19pbml0X2dndHQoaTkx
NSwgJmk5MTUtPmdndHQpOworCWk5MTUtPmd0LnZtID0gaTkxNV92bV9nZXQoJmk5MTUtPmdndHQu
dm0pOwogCiAJbWt3cml0ZV9kZXZpY2VfaW5mbyhpOTE1KS0+ZW5naW5lX21hc2sgPSBCSVQoMCk7
CiAKQEAgLTE4NiwxMCArMTg2LDYgQEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKm1vY2tfZ2Vt
X2RldmljZSh2b2lkKQogCWlmICghaTkxNS0+ZW5naW5lW1JDUzBdKQogCQlnb3RvIGVycl91bmxv
Y2s7CiAKLQlpOTE1LT5rZXJuZWxfY29udGV4dCA9IG1vY2tfY29udGV4dChpOTE1LCBOVUxMKTsK
LQlpZiAoIWk5MTUtPmtlcm5lbF9jb250ZXh0KQotCQlnb3RvIGVycl9lbmdpbmU7Ci0KIAlpZiAo
bW9ja19lbmdpbmVfaW5pdChpOTE1LT5lbmdpbmVbUkNTMF0pKQogCQlnb3RvIGVycl9jb250ZXh0
OwogCkBAIC0xOTgsOCArMTk0LDYgQEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKm1vY2tfZ2Vt
X2RldmljZSh2b2lkKQogCXJldHVybiBpOTE1OwogCiBlcnJfY29udGV4dDoKLQlpOTE1X2dlbV9k
cml2ZXJfcmVsZWFzZV9fY29udGV4dHMoaTkxNSk7Ci1lcnJfZW5naW5lOgogCW1vY2tfZW5naW5l
X2ZyZWUoaTkxNS0+ZW5naW5lW1JDUzBdKTsKIGVycl91bmxvY2s6CiAJZGVzdHJveV93b3JrcXVl
dWUoaTkxNS0+d3EpOwotLSAKMi4yNC4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5m
cmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0
aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id F0FB737019
	for <lists+intel-gfx@lfdr.de>; Thu,  6 Jun 2019 11:37:18 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 41B7B8979E;
	Thu,  6 Jun 2019 09:37:17 +0000 (UTC)
X-Original-To: Intel-gfx@lists.freedesktop.org
Delivered-To: Intel-gfx@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3957E89798
 for <Intel-gfx@lists.freedesktop.org>; Thu,  6 Jun 2019 09:37:16 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga006.jf.intel.com ([10.7.209.51])
 by orsmga105.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 06 Jun 2019 02:37:16 -0700
X-ExtLoop1: 1
Received: from ssirotki-mobl3.ger.corp.intel.com (HELO localhost.localdomain)
 ([10.251.93.246])
 by orsmga006.jf.intel.com with ESMTP; 06 Jun 2019 02:37:14 -0700
From: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>
To: Intel-gfx@lists.freedesktop.org
Date: Thu,  6 Jun 2019 10:36:38 +0100
Message-Id: <20190606093639.9372-21-tvrtko.ursulin@linux.intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190606093639.9372-1-tvrtko.ursulin@linux.intel.com>
References: <20190606093639.9372-1-tvrtko.ursulin@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 20/21] drm/i915: Make GuC GGTT reservation work
 on ggtt
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KClRoZXNlIGZ1
bmN0aW9ucyBvcGVyYXRlIG9uIGdndHQgc28gbWFrZSB0aGVtIHRha2UgdGhhdCBkaXJlY3RseSBh
cwpwYXJhbWV0ZXIuCgpBdCB0aGUgc2FtZSB0aW1lIG1vdmUgdGhlIFVTRVNfR1VDIGNvbmRpdGlv
bmFsIGRvd24gdG8KaW50ZWxfZ3VjX3Jlc2VydmVfZ2d0dF90b3AgZm9yIHN5bW1ldHJ5IHdpdGgK
aW50ZWxfZ3VjX3Jlc2VydmVkX2d0dF9zaXplLgoKU2lnbmVkLW9mZi1ieTogVHZydGtvIFVyc3Vs
aW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9ndHQuYyB8IDE0ICsrKysrKy0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF9ndWMuYyAgICB8IDE4ICsrKysrKysrLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfZ3VjLmggICAgfCAgNiArKystLS0KIDMgZmlsZXMgY2hhbmdlZCwgMTcgaW5zZXJ0
aW9ucygrKSwgMjEgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwpp
bmRleCBkM2IzNjc2ZDEwZjMuLmQ5NjdhNGU5Y2ViMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
ZW1fZ3R0LmMKQEAgLTI5MTIsNyArMjkxMiw3IEBAIGludCBpOTE1X2dlbV9pbml0X2dndHQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCSAqIHdoeS4KIAkgKi8KIAlnZ3R0LT5w
aW5fYmlhcyA9IG1heF90KHUzMiwgSTkxNV9HVFRfUEFHRV9TSVpFLAotCQkJICAgICAgIGludGVs
X2d1Y19yZXNlcnZlZF9ndHRfc2l6ZSgmZGV2X3ByaXYtPmd1YykpOworCQkJICAgICAgIGludGVs
X2d1Y19yZXNlcnZlZF9ndHRfc2l6ZShnZ3R0KSk7CiAKIAlyZXQgPSBpbnRlbF92Z3RfYmFsbG9v
bihnZ3R0KTsKIAlpZiAocmV0KQpAQCAtMjkyNiwxMSArMjkyNiw5IEBAIGludCBpOTE1X2dlbV9p
bml0X2dndHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCWlmIChyZXQpCiAJ
CXJldHVybiByZXQ7CiAKLQlpZiAoVVNFU19HVUMoZGV2X3ByaXYpKSB7Ci0JCXJldCA9IGludGVs
X2d1Y19yZXNlcnZlX2dndHRfdG9wKCZkZXZfcHJpdi0+Z3VjKTsKLQkJaWYgKHJldCkKLQkJCWdv
dG8gZXJyX3Jlc2VydmU7Ci0JfQorCXJldCA9IGludGVsX2d1Y19yZXNlcnZlX2dndHRfdG9wKGdn
dHQpOworCWlmIChyZXQpCisJCWdvdG8gZXJyX3Jlc2VydmU7CiAKIAkvKiBDbGVhciBhbnkgbm9u
LXByZWFsbG9jYXRlZCBibG9ja3MgKi8KIAlkcm1fbW1fZm9yX2VhY2hfaG9sZShlbnRyeSwgJmdn
dHQtPnZtLm1tLCBob2xlX3N0YXJ0LCBob2xlX2VuZCkgewpAQCAtMjk1Miw3ICsyOTUwLDcgQEAg
aW50IGk5MTVfZ2VtX2luaXRfZ2d0dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiAJcmV0dXJuIDA7CiAKIGVycl9hcHBndHQ6Ci0JaW50ZWxfZ3VjX3JlbGVhc2VfZ2d0dF90b3Ao
JmRldl9wcml2LT5ndWMpOworCWludGVsX2d1Y19yZWxlYXNlX2dndHRfdG9wKGdndHQpOwogZXJy
X3Jlc2VydmU6CiAJZHJtX21tX3JlbW92ZV9ub2RlKCZnZ3R0LT5lcnJvcl9jYXB0dXJlKTsKIAly
ZXR1cm4gcmV0OwpAQCAtMjk3OSw3ICsyOTc3LDcgQEAgdm9pZCBpOTE1X2dndHRfY2xlYW51cF9o
dyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJaWYgKGRybV9tbV9ub2RlX2Fs
bG9jYXRlZCgmZ2d0dC0+ZXJyb3JfY2FwdHVyZSkpCiAJCWRybV9tbV9yZW1vdmVfbm9kZSgmZ2d0
dC0+ZXJyb3JfY2FwdHVyZSk7CiAKLQlpbnRlbF9ndWNfcmVsZWFzZV9nZ3R0X3RvcCgmZGV2X3By
aXYtPmd1Yyk7CisJaW50ZWxfZ3VjX3JlbGVhc2VfZ2d0dF90b3AoZ2d0dCk7CiAKIAlpZiAoZHJt
X21tX2luaXRpYWxpemVkKCZnZ3R0LT52bS5tbSkpIHsKIAkJaW50ZWxfdmd0X2RlYmFsbG9vbihn
Z3R0KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjLmMKaW5kZXggYjg4YzM0OWM0ZmE2Li42MzMyNDhi
N2RhMjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5jCkBAIC03MTksNyArNzE5LDcgQEAgc3Ry
dWN0IGk5MTVfdm1hICppbnRlbF9ndWNfYWxsb2NhdGVfdm1hKHN0cnVjdCBpbnRlbF9ndWMgKmd1
YywgdTMyIHNpemUpCiAKIC8qKgogICogaW50ZWxfZ3VjX3Jlc2VydmVkX2d0dF9zaXplKCkKLSAq
IEBndWM6CWludGVsX2d1YyBzdHJ1Y3R1cmUKKyAqIEBnZ3R0OglQb2ludGVyIHRvIHN0cnVjdCBp
OTE1X2dndHQKICAqCiAgKiBUaGUgR3VDIFdPUENNIG1hcHBpbmcgc2hhZG93cyB0aGUgbG93ZXIg
cGFydCBvZiB0aGUgR0dUVCwgc28gaWYgd2UgYXJlIHVzaW5nCiAgKiBHdUMgd2UgY2FuJ3QgaGF2
ZSBhbnkgb2JqZWN0cyBwaW5uZWQgaW4gdGhhdCByZWdpb24uIFRoaXMgZnVuY3Rpb24gcmV0dXJu
cwpAQCAtNzI5LDE4ICs3MjksMTkgQEAgc3RydWN0IGk5MTVfdm1hICppbnRlbF9ndWNfYWxsb2Nh
dGVfdm1hKHN0cnVjdCBpbnRlbF9ndWMgKmd1YywgdTMyIHNpemUpCiAgKiAwIGlmIEd1QyBpcyBu
b3QgcHJlc2VudCBvciBub3QgaW4gdXNlLgogICogT3RoZXJ3aXNlLCB0aGUgR3VDIFdPUENNIHNp
emUuCiAgKi8KLXUzMiBpbnRlbF9ndWNfcmVzZXJ2ZWRfZ3R0X3NpemUoc3RydWN0IGludGVsX2d1
YyAqZ3VjKQordTMyIGludGVsX2d1Y19yZXNlcnZlZF9ndHRfc2l6ZShzdHJ1Y3QgaTkxNV9nZ3R0
ICpnZ3R0KQogewotCXJldHVybiBndWNfdG9faTkxNShndWMpLT53b3BjbS5ndWMuc2l6ZTsKKwly
ZXR1cm4gZ2d0dC0+dm0uaTkxNS0+d29wY20uZ3VjLnNpemU7CiB9CiAKLWludCBpbnRlbF9ndWNf
cmVzZXJ2ZV9nZ3R0X3RvcChzdHJ1Y3QgaW50ZWxfZ3VjICpndWMpCitpbnQgaW50ZWxfZ3VjX3Jl
c2VydmVfZ2d0dF90b3Aoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCkKIHsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IGd1Y190b19pOTE1KGd1Yyk7Ci0Jc3RydWN0IGk5MTVfZ2d0dCAq
Z2d0dCA9ICZpOTE1LT5nZ3R0OwogCXU2NCBzaXplOwogCWludCByZXQ7CiAKKwlpZiAoIVVTRVNf
R1VDKGdndHQtPnZtLmk5MTUpKQorCQlyZXR1cm4gMDsKKwogCXNpemUgPSBnZ3R0LT52bS50b3Rh
bCAtIEdVQ19HR1RUX1RPUDsKIAogCXJldCA9IGk5MTVfZ2VtX2d0dF9yZXNlcnZlKCZnZ3R0LT52
bSwgJmdndHQtPnVjX2Z3LCBzaXplLApAQCAtNzUyLDExICs3NTMsOCBAQCBpbnQgaW50ZWxfZ3Vj
X3Jlc2VydmVfZ2d0dF90b3Aoc3RydWN0IGludGVsX2d1YyAqZ3VjKQogCXJldHVybiByZXQ7CiB9
CiAKLXZvaWQgaW50ZWxfZ3VjX3JlbGVhc2VfZ2d0dF90b3Aoc3RydWN0IGludGVsX2d1YyAqZ3Vj
KQordm9pZCBpbnRlbF9ndWNfcmVsZWFzZV9nZ3R0X3RvcChzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0
KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ3VjX3RvX2k5MTUoZ3VjKTsK
LQlzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0ID0gJmk5MTUtPmdndHQ7Ci0KIAlpZiAoZHJtX21tX25v
ZGVfYWxsb2NhdGVkKCZnZ3R0LT51Y19mdykpCiAJCWRybV9tbV9yZW1vdmVfbm9kZSgmZ2d0dC0+
dWNfZncpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjLmgg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWMuaAppbmRleCBjYmZlZDdhNzdjOGIuLjU1
ZWExNDE3NmM1ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjLmgK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjLmgKQEAgLTE3Myw5ICsxNzMsOSBA
QCBpbnQgaW50ZWxfZ3VjX2F1dGhfaHVjKHN0cnVjdCBpbnRlbF9ndWMgKmd1YywgdTMyIHJzYV9v
ZmZzZXQpOwogaW50IGludGVsX2d1Y19zdXNwZW5kKHN0cnVjdCBpbnRlbF9ndWMgKmd1Yyk7CiBp
bnQgaW50ZWxfZ3VjX3Jlc3VtZShzdHJ1Y3QgaW50ZWxfZ3VjICpndWMpOwogc3RydWN0IGk5MTVf
dm1hICppbnRlbF9ndWNfYWxsb2NhdGVfdm1hKHN0cnVjdCBpbnRlbF9ndWMgKmd1YywgdTMyIHNp
emUpOwotdTMyIGludGVsX2d1Y19yZXNlcnZlZF9ndHRfc2l6ZShzdHJ1Y3QgaW50ZWxfZ3VjICpn
dWMpOwotaW50IGludGVsX2d1Y19yZXNlcnZlX2dndHRfdG9wKHN0cnVjdCBpbnRlbF9ndWMgKmd1
Yyk7Ci12b2lkIGludGVsX2d1Y19yZWxlYXNlX2dndHRfdG9wKHN0cnVjdCBpbnRlbF9ndWMgKmd1
Yyk7Cit1MzIgaW50ZWxfZ3VjX3Jlc2VydmVkX2d0dF9zaXplKHN0cnVjdCBpOTE1X2dndHQgKmdn
dHQpOworaW50IGludGVsX2d1Y19yZXNlcnZlX2dndHRfdG9wKHN0cnVjdCBpOTE1X2dndHQgKmdn
dHQpOwordm9pZCBpbnRlbF9ndWNfcmVsZWFzZV9nZ3R0X3RvcChzdHJ1Y3QgaTkxNV9nZ3R0ICpn
Z3R0KTsKIAogc3RhdGljIGlubGluZSBib29sIGludGVsX2d1Y19pc19sb2FkZWQoc3RydWN0IGlu
dGVsX2d1YyAqZ3VjKQogewotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0
cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9s
aXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E3FEBCBBFE
	for <lists+intel-gfx@lfdr.de>; Fri,  4 Oct 2019 15:40:56 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2D72B6EB91;
	Fri,  4 Oct 2019 13:40:50 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 51DFE6EB86
 for <intel-gfx@lists.freedesktop.org>; Fri,  4 Oct 2019 13:40:41 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18723953-1500050 
 for multiple; Fri, 04 Oct 2019 14:40:17 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  4 Oct 2019 14:39:58 +0100
Message-Id: <20191004134015.13204-4-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191004134015.13204-1-chris@chris-wilson.co.uk>
References: <20191004134015.13204-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 03/20] drm/i915: Pull i915_vma_pin under the
 vm->mutex
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UmVwbGFjZSB0aGUgc3RydWN0X211dGV4IHJlcXVpcmVtZW50IGZvciBwaW5uaW5nIHRoZSBpOTE1
X3ZtYSB3aXRoIHRoZQpsb2NhbCB2bS0+bXV0ZXggaW5zdGVhZC4gTm90ZSB0aGF0IHRoZSB2bS0+
bXV0ZXggaXMgdGFpbnRlZCBieSB0aGUKc2hyaW5rZXIgKHdlIHJlcXVpcmUgdW5iaW5kaW5nIGZy
b20gaW5zaWRlIGZzLXJlY2xhaW0pIGFuZCBzbyB3ZSBjYW5ub3QKYWxsb2NhdGUgd2hpbGUgaG9s
ZGluZyB0aGF0IG11dGV4LiBJbnN0ZWFkIHdlIGhhdmUgdG8gcHJlYWxsb2NhdGUKd29ya2VycyB0
byBkbyBhbGxvY2F0ZSBhbmQgYXBwbHkgdGhlIFBURSB1cGRhdGVzIGFmdGVyIHdlIGhhdmUgd2UK
cmVzZXJ2ZWQgdGhlaXIgc2xvdCBpbiB0aGUgZHJtX21tICh1c2luZyBmZW5jZXMgdG8gb3JkZXIg
dGhlIFBURSB3cml0ZXMKd2l0aCB0aGUgR1BVIHdvcmsgYW5kIHdpdGggbGF0ZXIgdW5iaW5kKS4K
CkluIGFkZGluZyB0aGUgYXN5bmNocm9ub3VzIHZtYSBiaW5kaW5nLCBvbmUgc3VidGxlIHJlcXVp
cmVtZW50IGlzIHRvCmF2b2lkIGNvdXBsaW5nIHRoZSBiaW5kaW5nIGZlbmNlIGludG8gdGhlIGJh
Y2tpbmcgb2JqZWN0LT5yZXN2LiBUaGF0IGlzCnRoZSBhc3luY2hyb25vdXMgYmluZGluZyBvbmx5
IGFwcGxpZXMgdG8gdGhlIHZtYSB0aW1lbGluZSBpdHNlbGYgYW5kIG5vdAp0byB0aGUgcGFnZXMg
YXMgdGhhdCBpcyBhIG1vcmUgZ2xvYmFsIHRpbWVsaW5lICh0aGUgYmluZGluZyBvZiBvbmUgdm1h
CmRvZXMgbm90IG5lZWQgdG8gYmUgb3JkZXJlZCB3aXRoIGFub3RoZXIgdm1hLCBub3IgZG9lcyB0
aGUgaW1wbGljaXQgR0VNCmZlbmNpbmcgZGVwZW5kIG9uIGEgdm1hLCBvbmx5IG9uIHdyaXRlcyB0
byB0aGUgYmFja2luZyBzdG9yZSkuIEtlZXBpbmcKdGhlIHZtYSBiaW5kaW5nIGRpc3RpbmN0IGZy
b20gdGhlIGJhY2tpbmcgc3RvcmUgdGltZWxpbmVzIGlzIHZlcmlmaWVkIGJ5CmEgbnVtYmVyIG9m
IGFzeW5jIGdlbV9leGVjX2ZlbmNlIGFuZCBnZW1fZXhlY19zY2hlZHVsZSB0ZXN0cy4gVGhlIHdh
eSB3ZQpkbyB0aGlzIGlzIHF1aXRlIHNpbXBsZSwgd2Uga2VlcCB0aGUgZmVuY2UgZm9yIHRoZSB2
bWEgYmluZGluZyBzZXBhcmF0ZQphbmQgb25seSB3YWl0IG9uIGl0IGFzIHJlcXVpcmVkLCBhbmQg
bmV2ZXIgYWRkIGl0IHRvIHRoZSBvYmotPnJlc3YKaXRzZWxmLgoKQW5vdGhlciBjb25zZXF1ZW5j
ZSBpbiByZWR1Y2luZyB0aGUgbG9ja2luZyBhcm91bmQgdGhlIHZtYSBpcyB0aGUKZGVzdHJ1Y3Rp
b24gb2YgdGhlIHZtYSBpcyBubyBsb25nZXIgZ2xvYmFsbHkgc2VyaWFsaXNlZCBieSBzdHJ1Y3Rf
bXV0ZXguCkEgbmF0dXJhbCBzb2x1dGlvbiB3b3VsZCBiZSB0byBhZGQgYSBrcmVmIHRvIGk5MTVf
dm1hLCBidXQgdGhhdCByZXF1aXJlcwpkZWNvdXBsaW5nIHRoZSByZWZlcmVuY2UgY3ljbGVzLCBw
b3NzaWJseSBieSBpbnRyb2R1Y2luZyBhIG5ldwppOTE1X21tX3BhZ2VzIG9iamVjdCB0aGF0IGlz
IG93biBieSBib3RoIG9iai0+bW0gYW5kIHZtYS0+cGFnZXMuCkhvd2V2ZXIsIHdlIGhhdmUgbm90
IHRha2VuIHRoYXQgcm91dGUgZHVlIHRvIHRoZSBvdmVyc2hhZG93aW5nIGxtZW0vdHRtCmRpc2N1
c3Npb25zLCBhbmQgaW5zdGVhZCBwbGF5IGEgc2VyaWVzIG9mIGNvbXBsaWNhdGVkIGdhbWVzIHdp
dGgKdHJ5bG9ja3MgdG8gKGhvcGVmdWxseSkgZW5zdXJlIHRoYXQgb25seSBvbmUgZGVzdHJ1Y3Rp
b24gcGF0aCBpcyBjYWxsZWQhCgp2MjogQWRkIHNvbWUgY29tbWVudGFyeSwgYW5kIHNvbWUgaGVs
cGVycyB0byByZWR1Y2UgcGF0Y2ggY2h1cm4uCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24g
PGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IFR2cnRrbyBVcnN1bGluIDx0dnJ0a28udXJz
dWxpbkBpbnRlbC5jb20+ClJldmlld2VkLWJ5OiBUdnJ0a28gVXJzdWxpbiA8dHZydGtvLnVyc3Vs
aW5AaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlz
cGxheS5jICB8ICAyOSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kc2Iu
YyAgICAgIHwgICA3ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiZGV2
LmMgICAgfCAgIDggKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3Zlcmxh
eS5jICB8ICAxMSArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2JsdC5j
ICAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5j
ICAgfCAgMjAgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYyAg
ICB8ICAxMyArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jICAg
IHwgIDQzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fbW1hbi5jICAgICAg
fCAgMjAgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYyAgICB8
ICAzMyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oICAgIHwg
ICA1ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jICB8ICA3
MyArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zdG9sZW4uYyAgICB8ICAg
OCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3RpbGluZy5jICAgIHwgIDI3
ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jICAgfCAgMjcg
Ky0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMgICB8ICAgOSAr
LQogLi4uL2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jIHwgIDEyICst
CiAuLi4vZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMgICAgfCAgIDQgLQog
Li4uL2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGlscy5jICAgIHwgICA3ICstCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jICAgICAgICAgICAgfCAgIDUgKy0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYyAgICB8ICAgNCArLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMgIHwgIDE5ICstCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndnQvYXBlcnR1cmVfZ20uYyAgICAgICAgfCAgMTIgKy0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMgICAgICAgICAgICB8ICA5NSArKystCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5oICAgICAgICAgICAgfCAgIDcgKwogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmVfdHlwZXMuaCAgICAgIHwgICA1ICsKIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMgICAgICAgICAgICAgICB8ICAgMiAtCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbS5jICAgICAgICAgICAgICAgfCAgODMgKystCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbV9ldmljdC5jICAgICAgICAgfCAgMjggKy0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5jICAgICB8ICAgOSArLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMgICAgICAgICAgIHwgMTA5ICsrLS0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oICAgICAgICAgICB8ICA0NSArLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9wZXJmLmMgICAgICAgICAgICAgIHwgIDMyICstCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3ZtYS5jICAgICAgICAgICAgICAgfCA1MjQgKysrKysrKysrKysrLS0tLS0t
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5oICAgICAgICAgICAgICAgfCAgODQgKy0t
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW0uYyAgICAgfCAgIDIgLQog
Li4uL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYyAgIHwgIDM2ICstCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMgfCAgNTggKy0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYyB8ICAgNyArCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYyAgICAgfCAgIDYgKy0KIDQwIGZp
bGVzIGNoYW5nZWQsIDgyNCBpbnNlcnRpb25zKCspLCA3MDYgZGVsZXRpb25zKC0pCgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRleCBjM2FjNWE1YzUx
ODUuLjhmNzM2NWI4ZGZmYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kaXNwbGF5LmMKQEAgLTIwNzksNyArMjA3OSw2IEBAIGludGVsX3Bpbl9hbmRfZmVuY2VfZmJf
b2JqKHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAogCXVuc2lnbmVkIGludCBwaW5jdGw7CiAJ
dTMyIGFsaWdubWVudDsKIAotCVdBUk5fT04oIW11dGV4X2lzX2xvY2tlZCgmZGV2LT5zdHJ1Y3Rf
bXV0ZXgpKTsKIAlpZiAoV0FSTl9PTighaTkxNV9nZW1fb2JqZWN0X2lzX2ZyYW1lYnVmZmVyKG9i
aikpKQogCQlyZXR1cm4gRVJSX1BUUigtRUlOVkFMKTsKIApAQCAtMjE2Myw4ICsyMTYyLDYgQEAg
aW50ZWxfcGluX2FuZF9mZW5jZV9mYl9vYmooc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCiAK
IHZvaWQgaW50ZWxfdW5waW5fZmJfdm1hKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1bnNpZ25lZCBs
b25nIGZsYWdzKQogewotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0tPmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwotCiAJaTkxNV9nZW1fb2JqZWN0X2xvY2sodm1hLT5vYmopOwogCWlmIChm
bGFncyAmIFBMQU5FX0hBU19GRU5DRSkKIAkJaTkxNV92bWFfdW5waW5fZmVuY2Uodm1hKTsKQEAg
LTMwNjUsMTIgKzMwNjIsMTAgQEAgaW50ZWxfYWxsb2NfaW5pdGlhbF9wbGFuZV9vYmooc3RydWN0
IGludGVsX2NydGMgKmNydGMsCiAJCXJldHVybiBmYWxzZTsKIAl9CiAKLQltdXRleF9sb2NrKCZk
ZXYtPnN0cnVjdF9tdXRleCk7CiAJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zdG9sZW5f
Zm9yX3ByZWFsbG9jYXRlZChkZXZfcHJpdiwKIAkJCQkJCQkgICAgIGJhc2VfYWxpZ25lZCwKIAkJ
CQkJCQkgICAgIGJhc2VfYWxpZ25lZCwKIAkJCQkJCQkgICAgIHNpemVfYWxpZ25lZCk7Ci0JbXV0
ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CiAJaWYgKCFvYmopCiAJCXJldHVybiBmYWxz
ZTsKIApAQCAtMzIzMiwxMyArMzIyNywxMSBAQCBpbnRlbF9maW5kX2luaXRpYWxfcGxhbmVfb2Jq
KHN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjLAogCWludGVsX3N0YXRlLT5jb2xvcl9wbGFu
ZVswXS5zdHJpZGUgPQogCQlpbnRlbF9mYl9waXRjaChmYiwgMCwgaW50ZWxfc3RhdGUtPmJhc2Uu
cm90YXRpb24pOwogCi0JbXV0ZXhfbG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogCWludGVsX3N0
YXRlLT52bWEgPQogCQlpbnRlbF9waW5fYW5kX2ZlbmNlX2ZiX29iaihmYiwKIAkJCQkJICAgJmlu
dGVsX3N0YXRlLT52aWV3LAogCQkJCQkgICBpbnRlbF9wbGFuZV91c2VzX2ZlbmNlKGludGVsX3N0
YXRlKSwKIAkJCQkJICAgJmludGVsX3N0YXRlLT5mbGFncyk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXYt
PnN0cnVjdF9tdXRleCk7CiAJaWYgKElTX0VSUihpbnRlbF9zdGF0ZS0+dm1hKSkgewogCQlEUk1f
RVJST1IoImZhaWxlZCB0byBwaW4gYm9vdCBmYiBvbiBwaXBlICVkOiAlbGlcbiIsCiAJCQkgIGlu
dGVsX2NydGMtPnBpcGUsIFBUUl9FUlIoaW50ZWxfc3RhdGUtPnZtYSkpOwpAQCAtMTQzNjUsOCAr
MTQzNTgsNiBAQCBzdGF0aWMgdm9pZCBmYl9vYmpfYnVtcF9yZW5kZXJfcHJpb3JpdHkoc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKICAqIGJpdHMuICBTb21lIG9sZGVyIHBsYXRmb3Jt
cyBuZWVkIHNwZWNpYWwgcGh5c2ljYWwgYWRkcmVzcyBoYW5kbGluZyBmb3IKICAqIGN1cnNvciBw
bGFuZXMuCiAgKgotICogTXVzdCBiZSBjYWxsZWQgd2l0aCBzdHJ1Y3RfbXV0ZXggaGVsZC4KLSAq
CiAgKiBSZXR1cm5zIDAgb24gc3VjY2VzcywgbmVnYXRpdmUgZXJyb3IgY29kZSBvbiBmYWlsdXJl
LgogICovCiBpbnQKQEAgLTE0NDIzLDE1ICsxNDQxNCw4IEBAIGludGVsX3ByZXBhcmVfcGxhbmVf
ZmIoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAot
CXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwotCWlmIChyZXQpIHsKLQkJaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKG9iaik7Ci0J
CXJldHVybiByZXQ7Ci0JfQotCiAJcmV0ID0gaW50ZWxfcGxhbmVfcGluX2ZiKHRvX2ludGVsX3Bs
YW5lX3N0YXRlKG5ld19zdGF0ZSkpOwogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0
cnVjdF9tdXRleCk7CiAJaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKG9iaik7CiAJaWYgKHJl
dCkKIAkJcmV0dXJuIHJldDsKQEAgLTE0NDgwLDggKzE0NDY0LDYgQEAgaW50ZWxfcHJlcGFyZV9w
bGFuZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKICAqIEBvbGRfc3RhdGU6IHRoZSBzdGF0
ZSBmcm9tIHRoZSBwcmV2aW91cyBtb2Rlc2V0CiAgKgogICogQ2xlYW5zIHVwIGEgZnJhbWVidWZm
ZXIgdGhhdCBoYXMganVzdCBiZWVuIHJlbW92ZWQgZnJvbSBhIHBsYW5lLgotICoKLSAqIE11c3Qg
YmUgY2FsbGVkIHdpdGggc3RydWN0X211dGV4IGhlbGQuCiAgKi8KIHZvaWQKIGludGVsX2NsZWFu
dXBfcGxhbmVfZmIoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCkBAIC0xNDQ5Nyw5ICsxNDQ3OSw3
IEBAIGludGVsX2NsZWFudXBfcGxhbmVfZmIoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJfQog
CiAJLyogU2hvdWxkIG9ubHkgYmUgY2FsbGVkIGFmdGVyIGEgc3VjY2Vzc2Z1bCBpbnRlbF9wcmVw
YXJlX3BsYW5lX2ZiKCkhICovCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwogCWludGVsX3BsYW5lX3VucGluX2ZiKHRvX2ludGVsX3BsYW5lX3N0YXRlKG9sZF9zdGF0
ZSkpOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogfQogCiBp
bnQKQEAgLTE0NzAyLDcgKzE0NjgyLDYgQEAgaW50ZWxfbGVnYWN5X2N1cnNvcl91cGRhdGUoc3Ry
dWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJCQkgICB1MzIgc3JjX3csIHUzMiBzcmNfaCwKIAkJCSAg
IHN0cnVjdCBkcm1fbW9kZXNldF9hY3F1aXJlX2N0eCAqY3R4KQogewotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+ZGV2KTsKIAlzdHJ1Y3QgZHJtX3Bs
YW5lX3N0YXRlICpvbGRfcGxhbmVfc3RhdGUsICpuZXdfcGxhbmVfc3RhdGU7CiAJc3RydWN0IGlu
dGVsX3BsYW5lICppbnRlbF9wbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lKTsKIAlzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSA9CkBAIC0xNDc2OCwxMyArMTQ3NDcsOSBAQCBp
bnRlbF9sZWdhY3lfY3Vyc29yX3VwZGF0ZShzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAlpZiAo
cmV0KQogCQlnb3RvIG91dF9mcmVlOwogCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxl
KCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKHJldCkKLQkJZ290byBvdXRfZnJl
ZTsKLQogCXJldCA9IGludGVsX3BsYW5lX3Bpbl9mYih0b19pbnRlbF9wbGFuZV9zdGF0ZShuZXdf
cGxhbmVfc3RhdGUpKTsKIAlpZiAocmV0KQotCQlnb3RvIG91dF91bmxvY2s7CisJCWdvdG8gb3V0
X2ZyZWU7CiAKIAlpbnRlbF9mcm9udGJ1ZmZlcl9mbHVzaCh0b19pbnRlbF9mcm9udGJ1ZmZlcihm
YiksIE9SSUdJTl9GTElQKTsKIAlpbnRlbF9mcm9udGJ1ZmZlcl90cmFjayh0b19pbnRlbF9mcm9u
dGJ1ZmZlcihvbGRfcGxhbmVfc3RhdGUtPmZiKSwKQEAgLTE0ODA0LDggKzE0Nzc5LDYgQEAgaW50
ZWxfbGVnYWN5X2N1cnNvcl91cGRhdGUoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAKIAlpbnRl
bF9wbGFuZV91bnBpbl9mYih0b19pbnRlbF9wbGFuZV9zdGF0ZShvbGRfcGxhbmVfc3RhdGUpKTsK
IAotb3V0X3VubG9jazoKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4
KTsKIG91dF9mcmVlOgogCWlmIChuZXdfY3J0Y19zdGF0ZSkKIAkJaW50ZWxfY3J0Y19kZXN0cm95
X3N0YXRlKGNydGMsICZuZXdfY3J0Y19zdGF0ZS0+YmFzZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RzYi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kc2IuYwppbmRleCAwYTBhMTUzNmFjOTYuLmJiNWEwZTkxYjM3MCAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kc2IuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RzYi5jCkBAIC0xMTksOSArMTE5LDcg
QEAgaW50ZWxfZHNiX2dldChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKIAkJZ290byBlcnI7CiAJ
fQogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJdm1hID0gaTkxNV9n
ZW1fb2JqZWN0X2dndHRfcGluKG9iaiwgTlVMTCwgMCwgMCwgUElOX01BUFBBQkxFKTsKLQltdXRl
eF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChJU19FUlIodm1hKSkgewog
CQlEUk1fRVJST1IoIlZtYSBjcmVhdGlvbiBmYWlsZWRcbiIpOwogCQlpOTE1X2dlbV9vYmplY3Rf
cHV0KG9iaik7CkBAIC0xNjQsMTAgKzE2Miw3IEBAIHZvaWQgaW50ZWxfZHNiX3B1dChzdHJ1Y3Qg
aW50ZWxfZHNiICpkc2IpCiAJCXJldHVybjsKIAogCWlmIChhdG9taWNfZGVjX2FuZF90ZXN0KCZk
c2ItPnJlZmNvdW50KSkgewotCQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
LQkJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChkc2ItPnZtYS0+b2JqKTsKLQkJaTkxNV92bWFf
dW5waW5fYW5kX3JlbGVhc2UoJmRzYi0+dm1hLCAwKTsKLQkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKKwkJaTkxNV92bWFfdW5waW5fYW5kX3JlbGVhc2UoJmRzYi0+dm1h
LCBJOTE1X1ZNQV9SRUxFQVNFX01BUCk7CiAJCWRzYi0+Y21kX2J1ZiA9IE5VTEw7CiAJCWRzYi0+
ZnJlZV9wb3MgPSAwOwogCQlkc2ItPmluc19zdGFydF9vZmZzZXQgPSAwOwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmRldi5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmRldi5jCmluZGV4IDY4MzM4NjY5ZjA1NC4uOTdjZGUw
MTc2NzBhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Zi
ZGV2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmRldi5jCkBA
IC0yMDQsNyArMjA0LDYgQEAgc3RhdGljIGludCBpbnRlbGZiX2NyZWF0ZShzdHJ1Y3QgZHJtX2Zi
X2hlbHBlciAqaGVscGVyLAogCQlzaXplcy0+ZmJfaGVpZ2h0ID0gaW50ZWxfZmItPmJhc2UuaGVp
Z2h0OwogCX0KIAotCW11dGV4X2xvY2soJmRldi0+c3RydWN0X211dGV4KTsKIAl3YWtlcmVmID0g
aW50ZWxfcnVudGltZV9wbV9nZXQoJmRldl9wcml2LT5ydW50aW1lX3BtKTsKIAogCS8qIFBpbiB0
aGUgR0dUVCB2bWEgZm9yIG91ciBhY2Nlc3MgdmlhIGluZm8tPnNjcmVlbl9iYXNlLgpAQCAtMjY2
LDcgKzI2NSw2IEBAIHN0YXRpYyBpbnQgaW50ZWxmYl9jcmVhdGUoc3RydWN0IGRybV9mYl9oZWxw
ZXIgKmhlbHBlciwKIAlpZmJkZXYtPnZtYV9mbGFncyA9IGZsYWdzOwogCiAJaW50ZWxfcnVudGlt
ZV9wbV9wdXQoJmRldl9wcml2LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2so
JmRldi0+c3RydWN0X211dGV4KTsKIAl2Z2Ffc3dpdGNoZXJvb19jbGllbnRfZmJfc2V0KHBkZXYs
IGluZm8pOwogCXJldHVybiAwOwogCkBAIC0yNzQsNyArMjcyLDYgQEAgc3RhdGljIGludCBpbnRl
bGZiX2NyZWF0ZShzdHJ1Y3QgZHJtX2ZiX2hlbHBlciAqaGVscGVyLAogCWludGVsX3VucGluX2Zi
X3ZtYSh2bWEsIGZsYWdzKTsKIG91dF91bmxvY2s6CiAJaW50ZWxfcnVudGltZV9wbV9wdXQoJmRl
dl9wcml2LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmRldi0+c3RydWN0
X211dGV4KTsKIAlyZXR1cm4gcmV0OwogfQogCkBAIC0yOTEsMTEgKzI4OCw4IEBAIHN0YXRpYyB2
b2lkIGludGVsX2ZiZGV2X2Rlc3Ryb3koc3RydWN0IGludGVsX2ZiZGV2ICppZmJkZXYpCiAKIAlk
cm1fZmJfaGVscGVyX2ZpbmkoJmlmYmRldi0+aGVscGVyKTsKIAotCWlmIChpZmJkZXYtPnZtYSkg
ewotCQltdXRleF9sb2NrKCZpZmJkZXYtPmhlbHBlci5kZXYtPnN0cnVjdF9tdXRleCk7CisJaWYg
KGlmYmRldi0+dm1hKQogCQlpbnRlbF91bnBpbl9mYl92bWEoaWZiZGV2LT52bWEsIGlmYmRldi0+
dm1hX2ZsYWdzKTsKLQkJbXV0ZXhfdW5sb2NrKCZpZmJkZXYtPmhlbHBlci5kZXYtPnN0cnVjdF9t
dXRleCk7Ci0JfQogCiAJaWYgKGlmYmRldi0+ZmIpCiAJCWRybV9mcmFtZWJ1ZmZlcl9yZW1vdmUo
JmlmYmRldi0+ZmItPmJhc2UpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9vdmVybGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X292ZXJsYXkuYwppbmRleCA1ZWZlZjliYWJhZGIuLjNmNGFjMWVlNzY2OCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMKQEAgLTEzMDMsMTUgKzEzMDMs
MTEgQEAgc3RhdGljIGludCBnZXRfcmVnaXN0ZXJzKHN0cnVjdCBpbnRlbF9vdmVybGF5ICpvdmVy
bGF5LCBib29sIHVzZV9waHlzKQogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCWludCBlcnI7CiAK
LQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCW9iaiA9IGk5MTVfZ2Vt
X29iamVjdF9jcmVhdGVfc3RvbGVuKGk5MTUsIFBBR0VfU0laRSk7CiAJaWYgKG9iaiA9PSBOVUxM
KQogCQlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGk5MTUsIFBBR0VfU0la
RSk7Ci0JaWYgKElTX0VSUihvYmopKSB7Ci0JCWVyciA9IFBUUl9FUlIob2JqKTsKLQkJZ290byBl
cnJfdW5sb2NrOwotCX0KKwlpZiAoSVNfRVJSKG9iaikpCisJCXJldHVybiBQVFJfRVJSKG9iaik7
CiAKIAl2bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4ob2JqLCBOVUxMLCAwLCAwLCBQSU5f
TUFQUEFCTEUpOwogCWlmIChJU19FUlIodm1hKSkgewpAQCAtMTMzMiwxMyArMTMyOCwxMCBAQCBz
dGF0aWMgaW50IGdldF9yZWdpc3RlcnMoc3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJsYXksIGJv
b2wgdXNlX3BoeXMpCiAJfQogCiAJb3ZlcmxheS0+cmVnX2JvID0gb2JqOwotCW11dGV4X3VubG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIDA7CiAKIGVycl9wdXRfYm86CiAJ
aTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwotZXJyX3VubG9jazoKLQltdXRleF91bmxvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CiB9CiAKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2JsdC5jCmluZGV4IDdmNjFhODAyNDEzMy4u
YzFmY2E1NzI4ZTZlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fY2xpZW50X2JsdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9j
bGllbnRfYmx0LmMKQEAgLTIxMSw3ICsyMTEsNyBAQCBzdGF0aWMgdm9pZCBjbGVhcl9wYWdlc193
b3JrZXIoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCSAqIGtlZXAgdHJhY2sgb2YgdGhlIEdQ
VSBhY3Rpdml0eSB3aXRoaW4gdGhpcyB2bWEvcmVxdWVzdCwgYW5kCiAJICogcHJvcGFnYXRlIHRo
ZSBzaWduYWwgZnJvbSB0aGUgcmVxdWVzdCB0byB3LT5kbWEuCiAJICovCi0JZXJyID0gaTkxNV9h
Y3RpdmVfYWRkX3JlcXVlc3QoJnZtYS0+YWN0aXZlLCBycSk7CisJZXJyID0gX19pOTE1X3ZtYV9t
b3ZlX3RvX2FjdGl2ZSh2bWEsIHJxKTsKIAlpZiAoZXJyKQogCQlnb3RvIG91dF9yZXF1ZXN0Owog
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwppbmRleCBmN2Jh
MDkzNWVkNjcuLjk1ZjhlNjZlNDVkYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fY29udGV4dC5jCkBAIC0zMTMsOCArMzEzLDYgQEAgc3RhdGljIHZvaWQgaTkxNV9nZW1f
Y29udGV4dF9mcmVlKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCiAJR0VNX0JVR19PTigh
aTkxNV9nZW1fY29udGV4dF9pc19jbG9zZWQoY3R4KSk7CiAKIAlyZWxlYXNlX2h3X2lkKGN0eCk7
Ci0JaWYgKGN0eC0+dm0pCi0JCWk5MTVfdm1fcHV0KGN0eC0+dm0pOwogCiAJZnJlZV9lbmdpbmVz
KHJjdV9hY2Nlc3NfcG9pbnRlcihjdHgtPmVuZ2luZXMpKTsKIAltdXRleF9kZXN0cm95KCZjdHgt
PmVuZ2luZXNfbXV0ZXgpOwpAQCAtMzc5LDkgKzM3NywxMyBAQCB2b2lkIGk5MTVfZ2VtX2NvbnRl
eHRfcmVsZWFzZShzdHJ1Y3Qga3JlZiAqcmVmKQogCiBzdGF0aWMgdm9pZCBjb250ZXh0X2Nsb3Nl
KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCiB7CisJaTkxNV9nZW1fY29udGV4dF9zZXRf
Y2xvc2VkKGN0eCk7CisKKwlpZiAoY3R4LT52bSkKKwkJaTkxNV92bV9jbG9zZShjdHgtPnZtKTsK
KwogCW11dGV4X2xvY2soJmN0eC0+bXV0ZXgpOwogCi0JaTkxNV9nZW1fY29udGV4dF9zZXRfY2xv
c2VkKGN0eCk7CiAJY3R4LT5maWxlX3ByaXYgPSBFUlJfUFRSKC1FQkFERik7CiAKIAkvKgpAQCAt
NDc0LDcgKzQ3Niw3IEBAIF9fc2V0X3BwZ3R0KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgs
IHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogCiAJR0VNX0JVR19PTihvbGQgJiYgaTkx
NV92bV9pc180bHZsKHZtKSAhPSBpOTE1X3ZtX2lzXzRsdmwob2xkKSk7CiAKLQljdHgtPnZtID0g
aTkxNV92bV9nZXQodm0pOworCWN0eC0+dm0gPSBpOTE1X3ZtX29wZW4odm0pOwogCWNvbnRleHRf
YXBwbHlfYWxsKGN0eCwgX19hcHBseV9wcGd0dCwgdm0pOwogCiAJcmV0dXJuIG9sZDsKQEAgLTQ4
OCw3ICs0OTAsNyBAQCBzdGF0aWMgdm9pZCBfX2Fzc2lnbl9wcGd0dChzdHJ1Y3QgaTkxNV9nZW1f
Y29udGV4dCAqY3R4LAogCiAJdm0gPSBfX3NldF9wcGd0dChjdHgsIHZtKTsKIAlpZiAodm0pCi0J
CWk5MTVfdm1fcHV0KHZtKTsKKwkJaTkxNV92bV9jbG9zZSh2bSk7CiB9CiAKIHN0YXRpYyB2b2lk
IF9fc2V0X3RpbWVsaW5lKHN0cnVjdCBpbnRlbF90aW1lbGluZSAqKmRzdCwKQEAgLTk1Myw3ICs5
NTUsNyBAQCBzdGF0aWMgaW50IGdldF9wcGd0dChzdHJ1Y3QgZHJtX2k5MTVfZmlsZV9wcml2YXRl
ICpmaWxlX3ByaXYsCiAJaWYgKHJldCA8IDApCiAJCWdvdG8gZXJyX3VubG9jazsKIAotCWk5MTVf
dm1fZ2V0KHZtKTsKKwlpOTE1X3ZtX29wZW4odm0pOwogCiAJYXJncy0+c2l6ZSA9IDA7CiAJYXJn
cy0+dmFsdWUgPSByZXQ7CkBAIC05NzMsNyArOTc1LDcgQEAgc3RhdGljIHZvaWQgc2V0X3BwZ3R0
X2JhcnJpZXIodm9pZCAqZGF0YSkKIAlpZiAoSU5URUxfR0VOKG9sZC0+aTkxNSkgPCA4KQogCQln
ZW42X3BwZ3R0X3VucGluX2FsbChpOTE1X3ZtX3RvX3BwZ3R0KG9sZCkpOwogCi0JaTkxNV92bV9w
dXQob2xkKTsKKwlpOTE1X3ZtX2Nsb3NlKG9sZCk7CiB9CiAKIHN0YXRpYyBpbnQgZW1pdF9wcGd0
dF91cGRhdGUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsIHZvaWQgKmRhdGEpCkBAIC0xMDkwLDgg
KzEwOTIsOCBAQCBzdGF0aWMgaW50IHNldF9wcGd0dChzdHJ1Y3QgZHJtX2k5MTVfZmlsZV9wcml2
YXRlICpmaWxlX3ByaXYsCiAJCQkJICAgc2V0X3BwZ3R0X2JhcnJpZXIsCiAJCQkJICAgb2xkKTsK
IAlpZiAoZXJyKSB7Ci0JCWk5MTVfdm1fcHV0KF9fc2V0X3BwZ3R0KGN0eCwgb2xkKSk7Ci0JCWk5
MTVfdm1fcHV0KG9sZCk7CisJCWk5MTVfdm1fY2xvc2UoX19zZXRfcHBndHQoY3R4LCBvbGQpKTsK
KwkJaTkxNV92bV9jbG9zZShvbGQpOwogCX0KIAogdW5sb2NrOgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jCmluZGV4IDU1YzNhYjU5ZTNhYS4uOTkzN2I0YzM0MWYx
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jCkBAIC0yODgs
NyArMjg4LDEyIEBAIGludCBpOTE1X2dlbV9vYmplY3Rfc2V0X2NhY2hlX2xldmVsKHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCQlpZiAoIWRybV9tbV9ub2RlX2FsbG9jYXRlZCgm
dm1hLT5ub2RlKSkKIAkJCQljb250aW51ZTsKIAotCQkJcmV0ID0gaTkxNV92bWFfYmluZCh2bWEs
IGNhY2hlX2xldmVsLCBQSU5fVVBEQVRFKTsKKwkJCS8qIFdhaXQgZm9yIGFuIGVhcmxpZXIgYXN5
bmMgYmluZCwgbmVlZCB0byByZXdyaXRlIGl0ICovCisJCQlyZXQgPSBpOTE1X3ZtYV9zeW5jKHZt
YSk7CisJCQlpZiAocmV0KQorCQkJCXJldHVybiByZXQ7CisKKwkJCXJldCA9IGk5MTVfdm1hX2Jp
bmQodm1hLCBjYWNoZV9sZXZlbCwgUElOX1VQREFURSwgTlVMTCk7CiAJCQlpZiAocmV0KQogCQkJ
CXJldHVybiByZXQ7CiAJCX0KQEAgLTM5MSwxNiArMzk2LDExIEBAIGludCBpOTE1X2dlbV9zZXRf
Y2FjaGluZ19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCWlmIChy
ZXQpCiAJCWdvdG8gb3V0OwogCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAocmV0KQotCQlnb3RvIG91dDsKLQogCXJldCA9IGk5
MTVfZ2VtX29iamVjdF9sb2NrX2ludGVycnVwdGlibGUob2JqKTsKIAlpZiAocmV0ID09IDApIHsK
IAkJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNoZV9sZXZlbChvYmosIGxldmVsKTsKIAkJ
aTkxNV9nZW1fb2JqZWN0X3VubG9jayhvYmopOwogCX0KLQltdXRleF91bmxvY2soJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwogCiBvdXQ6CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwpAQCAt
NDg1LDYgKzQ4NSw3IEBAIHN0YXRpYyB2b2lkIGk5MTVfZ2VtX29iamVjdF9idW1wX2luYWN0aXZl
X2dndHQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAkJaWYgKCFkcm1fbW1fbm9k
ZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpCiAJCQljb250aW51ZTsKIAorCQlHRU1fQlVHX09OKHZt
YS0+dm0gIT0gJmk5MTUtPmdndHQudm0pOwogCQlsaXN0X21vdmVfdGFpbCgmdm1hLT52bV9saW5r
LCAmdm1hLT52bS0+Ym91bmRfbGlzdCk7CiAJfQogCW11dGV4X3VubG9jaygmaTkxNS0+Z2d0dC52
bS5tdXRleCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
ZXhlY2J1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZm
ZXIuYwppbmRleCBjMDQ5MTk5YTFkZjUuLjg4YTg4MWJlMTJlYyAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCkBAIC02OTgsNyArNjk4LDkgQEAg
c3RhdGljIGludCBlYl9yZXNlcnZlKHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViKQogCiAJCWNh
c2UgMToKIAkJCS8qIFRvbyBmcmFnbWVudGVkLCB1bmJpbmQgZXZlcnl0aGluZyBhbmQgcmV0cnkg
Ki8KKwkJCW11dGV4X2xvY2soJmViLT5jb250ZXh0LT52bS0+bXV0ZXgpOwogCQkJZXJyID0gaTkx
NV9nZW1fZXZpY3Rfdm0oZWItPmNvbnRleHQtPnZtKTsKKwkJCW11dGV4X3VubG9jaygmZWItPmNv
bnRleHQtPnZtLT5tdXRleCk7CiAJCQlpZiAoZXJyKQogCQkJCXJldHVybiBlcnI7CiAJCQlicmVh
azsKQEAgLTk3Miw3ICs5NzQsOSBAQCBzdGF0aWMgdm9pZCByZWxvY19jYWNoZV9yZXNldChzdHJ1
Y3QgcmVsb2NfY2FjaGUgKmNhY2hlKQogCQkJZ2d0dC0+dm0uY2xlYXJfcmFuZ2UoJmdndHQtPnZt
LAogCQkJCQkgICAgIGNhY2hlLT5ub2RlLnN0YXJ0LAogCQkJCQkgICAgIGNhY2hlLT5ub2RlLnNp
emUpOworCQkJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQkJZHJtX21tX3JlbW92ZV9u
b2RlKCZjYWNoZS0+bm9kZSk7CisJCQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJ
fSBlbHNlIHsKIAkJCWk5MTVfdm1hX3VucGluKChzdHJ1Y3QgaTkxNV92bWEgKiljYWNoZS0+bm9k
ZS5tbSk7CiAJCX0KQEAgLTEwNDcsMTEgKzEwNTEsMTMgQEAgc3RhdGljIHZvaWQgKnJlbG9jX2lv
bWFwKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCQkJCSAgICAgICBQSU5fTk9F
VklDVCk7CiAJCWlmIChJU19FUlIodm1hKSkgewogCQkJbWVtc2V0KCZjYWNoZS0+bm9kZSwgMCwg
c2l6ZW9mKGNhY2hlLT5ub2RlKSk7CisJCQltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJ
CQllcnIgPSBkcm1fbW1faW5zZXJ0X25vZGVfaW5fcmFuZ2UKIAkJCQkoJmdndHQtPnZtLm1tLCAm
Y2FjaGUtPm5vZGUsCiAJCQkJIFBBR0VfU0laRSwgMCwgSTkxNV9DT0xPUl9VTkVWSUNUQUJMRSwK
IAkJCQkgMCwgZ2d0dC0+bWFwcGFibGVfZW5kLAogCQkJCSBEUk1fTU1fSU5TRVJUX0xPVyk7CisJ
CQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJCWlmIChlcnIpIC8qIG5vIGluYWN0
aXZlIGFwZXJ0dXJlIHNwYWNlLCB1c2UgY3B1IHJlbG9jICovCiAJCQkJcmV0dXJuIE5VTEw7CiAJ
CX0gZWxzZSB7CkBAIC0xNDE2LDcgKzE0MjIsNyBAQCBlYl9yZWxvY2F0ZV9lbnRyeShzdHJ1Y3Qg
aTkxNV9leGVjYnVmZmVyICplYiwKIAkJaWYgKHJlbG9jLT53cml0ZV9kb21haW4gPT0gSTkxNV9H
RU1fRE9NQUlOX0lOU1RSVUNUSU9OICYmCiAJCSAgICBJU19HRU4oZWItPmk5MTUsIDYpKSB7CiAJ
CQllcnIgPSBpOTE1X3ZtYV9iaW5kKHRhcmdldCwgdGFyZ2V0LT5vYmotPmNhY2hlX2xldmVsLAot
CQkJCQkgICAgUElOX0dMT0JBTCk7CisJCQkJCSAgICBQSU5fR0xPQkFMLCBOVUxMKTsKIAkJCWlm
IChXQVJOX09OQ0UoZXJyLAogCQkJCSAgICAgICJVbmV4cGVjdGVkIGZhaWx1cmUgdG8gYmluZCB0
YXJnZXQgVk1BISIpKQogCQkJCXJldHVybiBlcnI7CkBAIC0yMTQwLDM1ICsyMTQ2LDYgQEAgc3Rh
dGljIHN0cnVjdCBpOTE1X3JlcXVlc3QgKmViX3Rocm90dGxlKHN0cnVjdCBpbnRlbF9jb250ZXh0
ICpjZSkKIAlyZXR1cm4gaTkxNV9yZXF1ZXN0X2dldChycSk7CiB9CiAKLXN0YXRpYyBpbnQKLV9f
ZWJfcGluX2NvbnRleHQoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsIHN0cnVjdCBpbnRlbF9j
b250ZXh0ICpjZSkKLXsKLQlpbnQgZXJyOwotCi0JaWYgKGxpa2VseShhdG9taWNfaW5jX25vdF96
ZXJvKCZjZS0+cGluX2NvdW50KSkpCi0JCXJldHVybiAwOwotCi0JZXJyID0gbXV0ZXhfbG9ja19p
bnRlcnJ1cHRpYmxlKCZlYi0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKGVycikKLQkJ
cmV0dXJuIGVycjsKLQotCWVyciA9IF9faW50ZWxfY29udGV4dF9kb19waW4oY2UpOwotCW11dGV4
X3VubG9jaygmZWItPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCi0JcmV0dXJuIGVycjsKLX0K
LQotc3RhdGljIHZvaWQKLV9fZWJfdW5waW5fY29udGV4dChzdHJ1Y3QgaTkxNV9leGVjYnVmZmVy
ICplYiwgc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQotewotCWlmIChsaWtlbHkoYXRvbWljX2Fk
ZF91bmxlc3MoJmNlLT5waW5fY291bnQsIC0xLCAxKSkpCi0JCXJldHVybjsKLQotCW11dGV4X2xv
Y2soJmViLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpbnRlbF9jb250ZXh0X3VucGluKGNl
KTsKLQltdXRleF91bmxvY2soJmViLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLX0KLQogc3Rh
dGljIGludCBfX2ViX3Bpbl9lbmdpbmUoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsIHN0cnVj
dCBpbnRlbF9jb250ZXh0ICpjZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsOwpAQCAt
MjE4OCw3ICsyMTY1LDcgQEAgc3RhdGljIGludCBfX2ViX3Bpbl9lbmdpbmUoc3RydWN0IGk5MTVf
ZXhlY2J1ZmZlciAqZWIsIHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIAkgKiBHR1RUIHNwYWNl
LCBzbyBkbyB0aGlzIGZpcnN0IGJlZm9yZSB3ZSByZXNlcnZlIGEgc2Vxbm8gZm9yCiAJICogb3Vy
c2VsdmVzLgogCSAqLwotCWVyciA9IF9fZWJfcGluX2NvbnRleHQoZWIsIGNlKTsKKwllcnIgPSBp
bnRlbF9jb250ZXh0X3BpbihjZSk7CiAJaWYgKGVycikKIAkJcmV0dXJuIGVycjsKIApAQCAtMjIz
Miw3ICsyMjA5LDcgQEAgc3RhdGljIGludCBfX2ViX3Bpbl9lbmdpbmUoc3RydWN0IGk5MTVfZXhl
Y2J1ZmZlciAqZWIsIHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIAlpbnRlbF9jb250ZXh0X2V4
aXQoY2UpOwogCWludGVsX2NvbnRleHRfdGltZWxpbmVfdW5sb2NrKHRsKTsKIGVycl91bnBpbjoK
LQlfX2ViX3VucGluX2NvbnRleHQoZWIsIGNlKTsKKwlpbnRlbF9jb250ZXh0X3VucGluKGNlKTsK
IAlyZXR1cm4gZXJyOwogfQogCkBAIC0yMjQ1LDcgKzIyMjIsNyBAQCBzdGF0aWMgdm9pZCBlYl91
bnBpbl9lbmdpbmUoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIpCiAJaW50ZWxfY29udGV4dF9l
eGl0KGNlKTsKIAltdXRleF91bmxvY2soJnRsLT5tdXRleCk7CiAKLQlfX2ViX3VucGluX2NvbnRl
eHQoZWIsIGNlKTsKKwlpbnRlbF9jb250ZXh0X3VucGluKGNlKTsKIH0KIAogc3RhdGljIHVuc2ln
bmVkIGludApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21t
YW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMKaW5kZXggZGQw
YzI4NDBiYTRkLi5jMTk0MzFkNjA5ZmMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9tbWFuLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX21tYW4uYwpAQCAtMjQ5LDE2ICsyNDksNiBAQCB2bV9mYXVsdF90IGk5MTVfZ2VtX2ZhdWx0
KHN0cnVjdCB2bV9mYXVsdCAqdm1mKQogCWlmIChyZXQpCiAJCWdvdG8gZXJyX3JwbTsKIAotCXJl
dCA9IGk5MTVfbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKGRldik7Ci0JaWYgKHJldCkKLQkJZ290
byBlcnJfcmVzZXQ7Ci0KLQkvKiBBY2Nlc3MgdG8gc25vb3BhYmxlIHBhZ2VzIHRocm91Z2ggdGhl
IEdUVCBpcyBpbmNvaGVyZW50LiAqLwotCWlmIChvYmotPmNhY2hlX2xldmVsICE9IEk5MTVfQ0FD
SEVfTk9ORSAmJiAhSEFTX0xMQyhpOTE1KSkgewotCQlyZXQgPSAtRUZBVUxUOwotCQlnb3RvIGVy
cl91bmxvY2s7Ci0JfQotCiAJLyogTm93IHBpbiBpdCBpbnRvIHRoZSBHVFQgYXMgbmVlZGVkICov
CiAJdm1hID0gaTkxNV9nZW1fb2JqZWN0X2dndHRfcGluKG9iaiwgTlVMTCwgMCwgMCwKIAkJCQkg
ICAgICAgUElOX01BUFBBQkxFIHwKQEAgLTI5MSw3ICsyODEsMTMgQEAgdm1fZmF1bHRfdCBpOTE1
X2dlbV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikKIAl9CiAJaWYgKElTX0VSUih2bWEpKSB7
CiAJCXJldCA9IFBUUl9FUlIodm1hKTsKLQkJZ290byBlcnJfdW5sb2NrOworCQlnb3RvIGVycl9y
ZXNldDsKKwl9CisKKwkvKiBBY2Nlc3MgdG8gc25vb3BhYmxlIHBhZ2VzIHRocm91Z2ggdGhlIEdU
VCBpcyBpbmNvaGVyZW50LiAqLworCWlmIChvYmotPmNhY2hlX2xldmVsICE9IEk5MTVfQ0FDSEVf
Tk9ORSAmJiAhSEFTX0xMQyhpOTE1KSkgeworCQlyZXQgPSAtRUZBVUxUOworCQlnb3RvIGVycl91
bnBpbjsKIAl9CiAKIAlyZXQgPSBpOTE1X3ZtYV9waW5fZmVuY2Uodm1hKTsKQEAgLTMyOSw4ICsz
MjUsNiBAQCB2bV9mYXVsdF90IGk5MTVfZ2VtX2ZhdWx0KHN0cnVjdCB2bV9mYXVsdCAqdm1mKQog
CWk5MTVfdm1hX3VucGluX2ZlbmNlKHZtYSk7CiBlcnJfdW5waW46CiAJX19pOTE1X3ZtYV91bnBp
bih2bWEpOwotZXJyX3VubG9jazoKLQltdXRleF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsK
IGVycl9yZXNldDoKIAlpbnRlbF9ndF9yZXNldF91bmxvY2soZ2d0dC0+dm0uZ3QsIHNyY3UpOwog
ZXJyX3JwbToKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9v
YmplY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYwppbmRl
eCAwZWY2MGRhZTIzYTcuLmRiZjliZTlhNzlmNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9vYmplY3QuYwpAQCAtMTU1LDIxICsxNTUsMzAgQEAgc3RhdGljIHZvaWQgX19p
OTE1X2dlbV9mcmVlX29iamVjdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAKIAl3
YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwogCWxsaXN0
X2Zvcl9lYWNoX2VudHJ5X3NhZmUob2JqLCBvbiwgZnJlZWQsIGZyZWVkKSB7Ci0JCXN0cnVjdCBp
OTE1X3ZtYSAqdm1hLCAqdm47Ci0KIAkJdHJhY2VfaTkxNV9nZW1fb2JqZWN0X2Rlc3Ryb3kob2Jq
KTsKIAotCQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQotCQlsaXN0X2Zv
cl9lYWNoX2VudHJ5X3NhZmUodm1hLCB2biwgJm9iai0+dm1hLmxpc3QsIG9ial9saW5rKSB7Ci0J
CQlHRU1fQlVHX09OKGk5MTVfdm1hX2lzX2FjdGl2ZSh2bWEpKTsKLQkJCWF0b21pY19hbmQofkk5
MTVfVk1BX1BJTl9NQVNLLCAmdm1hLT5mbGFncyk7Ci0JCQlpOTE1X3ZtYV9kZXN0cm95KHZtYSk7
CisJCWlmICghbGlzdF9lbXB0eSgmb2JqLT52bWEubGlzdCkpIHsKKwkJCXN0cnVjdCBpOTE1X3Zt
YSAqdm1hOworCisJCQkvKgorCQkJICogTm90ZSB0aGF0IHRoZSB2bWEga2VlcHMgYW4gb2JqZWN0
IHJlZmVyZW5jZSB3aGlsZQorCQkJICogaXQgaXMgYWN0aXZlLCBzbyBpdCAqc2hvdWxkKiBub3Qg
c2xlZXAgd2hpbGUgd2UKKwkJCSAqIGRlc3Ryb3kgaXQuIE91ciBkZWJ1ZyBjb2RlIGVycnMgaW5z
aXRzIGl0ICptaWdodCouCisJCQkgKiBGb3IgdGhlIG1vbWVudCwgcGxheSBhbG9uZy4KKwkJCSAq
LworCQkJc3Bpbl9sb2NrKCZvYmotPnZtYS5sb2NrKTsKKwkJCXdoaWxlICgodm1hID0gbGlzdF9m
aXJzdF9lbnRyeV9vcl9udWxsKCZvYmotPnZtYS5saXN0LAorCQkJCQkJCSAgICAgICBzdHJ1Y3Qg
aTkxNV92bWEsCisJCQkJCQkJICAgICAgIG9ial9saW5rKSkpIHsKKwkJCQlHRU1fQlVHX09OKHZt
YS0+b2JqICE9IG9iaik7CisJCQkJc3Bpbl91bmxvY2soJm9iai0+dm1hLmxvY2spOworCisJCQkJ
aTkxNV92bWFfZGVzdHJveSh2bWEpOworCisJCQkJc3Bpbl9sb2NrKCZvYmotPnZtYS5sb2NrKTsK
KwkJCX0KKwkJCXNwaW5fdW5sb2NrKCZvYmotPnZtYS5sb2NrKTsKIAkJfQotCQlHRU1fQlVHX09O
KCFsaXN0X2VtcHR5KCZvYmotPnZtYS5saXN0KSk7Ci0JCUdFTV9CVUdfT04oIVJCX0VNUFRZX1JP
T1QoJm9iai0+dm1hLnRyZWUpKTsKLQotCQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCiAJCUdFTV9CVUdfT04oYXRvbWljX3JlYWQoJm9iai0+YmluZF9jb3VudCkpOwog
CQlHRU1fQlVHX09OKG9iai0+dXNlcmZhdWx0X2NvdW50KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9vYmplY3QuaAppbmRleCA1M2M3MDY5YmEzZTguLjA4NmE5YmY1YWRjYyAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaApAQCAtMTA2LDYg
KzEwNiwxMSBAQCBzdGF0aWMgaW5saW5lIHZvaWQgaTkxNV9nZW1fb2JqZWN0X2xvY2soc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAlkbWFfcmVzdl9sb2NrKG9iai0+YmFzZS5yZXN2
LCBOVUxMKTsKIH0KIAorc3RhdGljIGlubGluZSBib29sIGk5MTVfZ2VtX29iamVjdF90cnlsb2Nr
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCit7CisJcmV0dXJuIGRtYV9yZXN2X3Ry
eWxvY2sob2JqLT5iYXNlLnJlc3YpOworfQorCiBzdGF0aWMgaW5saW5lIGludAogaTkxNV9nZW1f
b2JqZWN0X2xvY2tfaW50ZXJydXB0aWJsZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
KQogewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlu
a2VyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYwppbmRl
eCBkMmMwNWQ3NTI5MDkuLmZkM2NlNmRhODQ5NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMKQEAgLTE2LDQwICsxNiw2IEBACiAKICNpbmNsdWRlICJp
OTE1X3RyYWNlLmgiCiAKLXN0YXRpYyBib29sIHNocmlua2VyX2xvY2soc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCi0JCQkgIHVuc2lnbmVkIGludCBmbGFncywKLQkJCSAgYm9vbCAqdW5s
b2NrKQotewotCXN0cnVjdCBtdXRleCAqbSA9ICZpOTE1LT5kcm0uc3RydWN0X211dGV4OwotCi0J
c3dpdGNoIChtdXRleF90cnlsb2NrX3JlY3Vyc2l2ZShtKSkgewotCWNhc2UgTVVURVhfVFJZTE9D
S19SRUNVUlNJVkU6Ci0JCSp1bmxvY2sgPSBmYWxzZTsKLQkJcmV0dXJuIHRydWU7Ci0KLQljYXNl
IE1VVEVYX1RSWUxPQ0tfRkFJTEVEOgotCQkqdW5sb2NrID0gZmFsc2U7Ci0JCWlmIChmbGFncyAm
IEk5MTVfU0hSSU5LX0FDVElWRSAmJgotCQkgICAgbXV0ZXhfbG9ja19raWxsYWJsZV9uZXN0ZWQo
bSwgSTkxNV9NTV9TSFJJTktFUikgPT0gMCkKLQkJCSp1bmxvY2sgPSB0cnVlOwotCQlyZXR1cm4g
KnVubG9jazsKLQotCWNhc2UgTVVURVhfVFJZTE9DS19TVUNDRVNTOgotCQkqdW5sb2NrID0gdHJ1
ZTsKLQkJcmV0dXJuIHRydWU7Ci0JfQotCi0JQlVHKCk7Ci19Ci0KLXN0YXRpYyB2b2lkIHNocmlu
a2VyX3VubG9jayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgYm9vbCB1bmxvY2spCi17
Ci0JaWYgKCF1bmxvY2spCi0JCXJldHVybjsKLQotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7Ci19Ci0KIHN0YXRpYyBib29sIHN3YXBfYXZhaWxhYmxlKHZvaWQpCiB7CiAJ
cmV0dXJuIGdldF9ucl9zd2FwX3BhZ2VzKCkgPiAwOwpAQCAtMTU1LDEwICsxMjEsNiBAQCBpOTE1
X2dlbV9zaHJpbmsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJaW50ZWxfd2FrZXJl
Zl90IHdha2VyZWYgPSAwOwogCXVuc2lnbmVkIGxvbmcgY291bnQgPSAwOwogCXVuc2lnbmVkIGxv
bmcgc2Nhbm5lZCA9IDA7Ci0JYm9vbCB1bmxvY2s7Ci0KLQlpZiAoIXNocmlua2VyX2xvY2soaTkx
NSwgc2hyaW5rLCAmdW5sb2NrKSkKLQkJcmV0dXJuIDA7CiAKIAkvKgogCSAqIFdoZW4gc2hyaW5r
aW5nIHRoZSBhY3RpdmUgbGlzdCwgd2Ugc2hvdWxkIGFsc28gY29uc2lkZXIgYWN0aXZlCkBAIC0y
NjgsOCArMjMwLDYgQEAgaTkxNV9nZW1fc2hyaW5rKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LAogCWlmIChzaHJpbmsgJiBJOTE1X1NIUklOS19CT1VORCkKIAkJaW50ZWxfcnVudGltZV9w
bV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwogCi0Jc2hyaW5rZXJfdW5sb2NrKGk5
MTUsIHVubG9jayk7Ci0KIAlpZiAobnJfc2Nhbm5lZCkKIAkJKm5yX3NjYW5uZWQgKz0gc2Nhbm5l
ZDsKIAlyZXR1cm4gY291bnQ7CkBAIC0zMzksMTkgKzI5OSwxNCBAQCBpOTE1X2dlbV9zaHJpbmtl
cl9zY2FuKHN0cnVjdCBzaHJpbmtlciAqc2hyaW5rZXIsIHN0cnVjdCBzaHJpbmtfY29udHJvbCAq
c2MpCiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPQogCQljb250YWluZXJfb2Yoc2hy
aW5rZXIsIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlLCBtbS5zaHJpbmtlcik7CiAJdW5zaWduZWQg
bG9uZyBmcmVlZDsKLQlib29sIHVubG9jazsKIAogCXNjLT5ucl9zY2FubmVkID0gMDsKIAotCWlm
ICghc2hyaW5rZXJfbG9jayhpOTE1LCAwLCAmdW5sb2NrKSkKLQkJcmV0dXJuIFNIUklOS19TVE9Q
OwotCiAJZnJlZWQgPSBpOTE1X2dlbV9zaHJpbmsoaTkxNSwKIAkJCQlzYy0+bnJfdG9fc2NhbiwK
IAkJCQkmc2MtPm5yX3NjYW5uZWQsCiAJCQkJSTkxNV9TSFJJTktfQk9VTkQgfAotCQkJCUk5MTVf
U0hSSU5LX1VOQk9VTkQgfAotCQkJCUk5MTVfU0hSSU5LX1dSSVRFQkFDSyk7CisJCQkJSTkxNV9T
SFJJTktfVU5CT1VORCk7CiAJaWYgKHNjLT5ucl9zY2FubmVkIDwgc2MtPm5yX3RvX3NjYW4gJiYg
Y3VycmVudF9pc19rc3dhcGQoKSkgewogCQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIApAQCAt
MzY2LDggKzMyMSw2IEBAIGk5MTVfZ2VtX3Nocmlua2VyX3NjYW4oc3RydWN0IHNocmlua2VyICpz
aHJpbmtlciwgc3RydWN0IHNocmlua19jb250cm9sICpzYykKIAkJfQogCX0KIAotCXNocmlua2Vy
X3VubG9jayhpOTE1LCB1bmxvY2spOwotCiAJcmV0dXJuIHNjLT5ucl9zY2FubmVkID8gZnJlZWQg
OiBTSFJJTktfU1RPUDsKIH0KIApAQCAtMzg0LDYgKzMzNyw3IEBAIGk5MTVfZ2VtX3Nocmlua2Vy
X29vbShzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sgKm5iLCB1bnNpZ25lZCBsb25nIGV2ZW50LCB2b2lk
ICpwdHIpCiAJZnJlZWRfcGFnZXMgPSAwOwogCXdpdGhfaW50ZWxfcnVudGltZV9wbSgmaTkxNS0+
cnVudGltZV9wbSwgd2FrZXJlZikKIAkJZnJlZWRfcGFnZXMgKz0gaTkxNV9nZW1fc2hyaW5rKGk5
MTUsIC0xVUwsIE5VTEwsCisJCQkJCSAgICAgICBJOTE1X1NIUklOS19BQ1RJVkUgfAogCQkJCQkg
ICAgICAgSTkxNV9TSFJJTktfQk9VTkQgfAogCQkJCQkgICAgICAgSTkxNV9TSFJJTktfVU5CT1VO
RCB8CiAJCQkJCSAgICAgICBJOTE1X1NIUklOS19XUklURUJBQ0spOwpAQCAtNDE5LDEwICszNzMs
NiBAQCBpOTE1X2dlbV9zaHJpbmtlcl92bWFwKHN0cnVjdCBub3RpZmllcl9ibG9jayAqbmIsIHVu
c2lnbmVkIGxvbmcgZXZlbnQsIHZvaWQgKnB0cgogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hLCAqbmV4
dDsKIAl1bnNpZ25lZCBsb25nIGZyZWVkX3BhZ2VzID0gMDsKIAlpbnRlbF93YWtlcmVmX3Qgd2Fr
ZXJlZjsKLQlib29sIHVubG9jazsKLQotCWlmICghc2hyaW5rZXJfbG9jayhpOTE1LCAwLCAmdW5s
b2NrKSkKLQkJcmV0dXJuIE5PVElGWV9ET05FOwogCiAJd2l0aF9pbnRlbF9ydW50aW1lX3BtKCZp
OTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKQogCQlmcmVlZF9wYWdlcyArPSBpOTE1X2dlbV9zaHJp
bmsoaTkxNSwgLTFVTCwgTlVMTCwKQEAgLTQzOSwxNSArMzg5LDExIEBAIGk5MTVfZ2VtX3Nocmlu
a2VyX3ZtYXAoc3RydWN0IG5vdGlmaWVyX2Jsb2NrICpuYiwgdW5zaWduZWQgbG9uZyBldmVudCwg
dm9pZCAqcHRyCiAJCWlmICghdm1hLT5pb21hcCB8fCBpOTE1X3ZtYV9pc19hY3RpdmUodm1hKSkK
IAkJCWNvbnRpbnVlOwogCi0JCW11dGV4X3VubG9jaygmaTkxNS0+Z2d0dC52bS5tdXRleCk7Ci0J
CWlmIChpOTE1X3ZtYV91bmJpbmQodm1hKSA9PSAwKQorCQlpZiAoX19pOTE1X3ZtYV91bmJpbmQo
dm1hKSA9PSAwKQogCQkJZnJlZWRfcGFnZXMgKz0gY291bnQ7Ci0JCW11dGV4X2xvY2soJmk5MTUt
PmdndHQudm0ubXV0ZXgpOwogCX0KIAltdXRleF91bmxvY2soJmk5MTUtPmdndHQudm0ubXV0ZXgp
OwogCi0Jc2hyaW5rZXJfdW5sb2NrKGk5MTUsIHVubG9jayk7Ci0KIAkqKHVuc2lnbmVkIGxvbmcg
KilwdHIgKz0gZnJlZWRfcGFnZXM7CiAJcmV0dXJuIE5PVElGWV9ET05FOwogfQpAQCAtNDkwLDIy
ICs0MzYsOSBAQCB2b2lkIGk5MTVfZ2VtX3Nocmlua2VyX3RhaW50c19tdXRleChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAogCWZzX3JlY2xhaW1fYWNxdWlyZShHRlBfS0VSTkVMKTsK
IAotCS8qCi0JICogQXMgd2UgaW52YXJpYWJseSByZWx5IG9uIHRoZSBzdHJ1Y3RfbXV0ZXggd2l0
aGluIHRoZSBzaHJpbmtlciwKLQkgKiBidXQgaGF2ZSBhIGNvbXBsaWNhdGVkIHJlY3Vyc2lvbiBk
YW5jZSwgdGFpbnQgYWxsIHRoZSBtdXRleGVzIHVzZWQKLQkgKiB3aXRoaW4gdGhlIHNocmlua2Vy
IHdpdGggdGhlIHN0cnVjdF9tdXRleC4gRm9yIGNvbXBsZXRlbmVzcywgd2UKLQkgKiB0YWludCB3
aXRoIGFsbCBzdWJjbGFzcyBvZiBzdHJ1Y3RfbXV0ZXgsIGV2ZW4gdGhvdWdoIHdlIHNob3VsZAot
CSAqIG9ubHkgbmVlZCB0YWludGluZyBieSBJOTE1X01NX05PUk1BTCB0byBjYXRjaCBwb3NzaWJs
ZSBBQkJBCi0JICogZGVhZGxvY2tzIGZyb20gdXNpbmcgc3RydWN0X211dGV4IGluc2lkZSBAbXV0
ZXguCi0JICovCi0JbXV0ZXhfYWNxdWlyZSgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleC5kZXBfbWFw
LAotCQkgICAgICBJOTE1X01NX1NIUklOS0VSLCAwLCBfUkVUX0lQXyk7Ci0KIAltdXRleF9hY3F1
aXJlKCZtdXRleC0+ZGVwX21hcCwgMCwgMCwgX1JFVF9JUF8pOwogCW11dGV4X3JlbGVhc2UoJm11
dGV4LT5kZXBfbWFwLCAwLCBfUkVUX0lQXyk7CiAKLQltdXRleF9yZWxlYXNlKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4LmRlcF9tYXAsIDAsIF9SRVRfSVBfKTsKLQogCWZzX3JlY2xhaW1fcmVsZWFz
ZShHRlBfS0VSTkVMKTsKIAogCWlmICh1bmxvY2spCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fc3RvbGVuLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fc3RvbGVuLmMKaW5kZXggZTQ1ZWI4NzIxODUwLi5mYWQ5OGE5MjFjZGUgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zdG9sZW4uYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc3RvbGVuLmMKQEAgLTYyNCw4ICs2MjQs
NiBAQCBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3N0b2xlbl9mb3JfcHJlYWxsb2NhdGVkKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdgogCWlmICghZHJtX21tX2luaXRpYWxpemVkKCZk
ZXZfcHJpdi0+bW0uc3RvbGVuKSkKIAkJcmV0dXJuIE5VTEw7CiAKLQlsb2NrZGVwX2Fzc2VydF9o
ZWxkKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlEUk1fREVCVUdfRFJJVkVSKCJj
cmVhdGluZyBwcmVhbGxvY2F0ZWQgc3RvbGVuIG9iamVjdDogc3RvbGVuX29mZnNldD0lcGEsIGd0
dF9vZmZzZXQ9JXBhLCBzaXplPSVwYVxuIiwKIAkJCSAmc3RvbGVuX29mZnNldCwgJmd0dF9vZmZz
ZXQsICZzaXplKTsKIApAQCAtNjc3LDIxICs2NzUsMjUgQEAgaTkxNV9nZW1fb2JqZWN0X2NyZWF0
ZV9zdG9sZW5fZm9yX3ByZWFsbG9jYXRlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYKIAkgKiBzZXR0aW5nIHVwIHRoZSBHVFQgc3BhY2UuIFRoZSBhY3R1YWwgcmVzZXJ2YXRpb24g
d2lsbCBvY2N1cgogCSAqIGxhdGVyLgogCSAqLworCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4
KTsKIAlyZXQgPSBpOTE1X2dlbV9ndHRfcmVzZXJ2ZSgmZ2d0dC0+dm0sICZ2bWEtPm5vZGUsCiAJ
CQkJICAgc2l6ZSwgZ3R0X29mZnNldCwgb2JqLT5jYWNoZV9sZXZlbCwKIAkJCQkgICAwKTsKIAlp
ZiAocmV0KSB7CiAJCURSTV9ERUJVR19EUklWRVIoImZhaWxlZCB0byBhbGxvY2F0ZSBzdG9sZW4g
R1RUIHNwYWNlXG4iKTsKKwkJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCWdvdG8g
ZXJyX3BhZ2VzOwogCX0KIAogCUdFTV9CVUdfT04oIWRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1h
LT5ub2RlKSk7CiAKKwlHRU1fQlVHX09OKHZtYS0+cGFnZXMpOwogCXZtYS0+cGFnZXMgPSBvYmot
Pm1tLnBhZ2VzOworCWF0b21pY19zZXQoJnZtYS0+cGFnZXNfY291bnQsIEk5MTVfVk1BX1BBR0VT
X0FDVElWRSk7CisKIAlzZXRfYml0KEk5MTVfVk1BX0dMT0JBTF9CSU5EX0JJVCwgX19pOTE1X3Zt
YV9mbGFncyh2bWEpKTsKIAlfX2k5MTVfdm1hX3NldF9tYXBfYW5kX2ZlbmNlYWJsZSh2bWEpOwog
Ci0JbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWxpc3RfYWRkX3RhaWwoJnZtYS0+dm1f
bGluaywgJmdndHQtPnZtLmJvdW5kX2xpc3QpOwogCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0
ZXgpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdGls
aW5nLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdGlsaW5nLmMKaW5kZXgg
ZTVkMWFlOGQ0ZGJhLi5kYzJhODNjZTQ0ZDUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV90aWxpbmcuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fdGlsaW5nLmMKQEAgLTE4MSwyMiArMTgxLDI1IEBAIHN0YXRpYyBpbnQKIGk5MTVf
Z2VtX29iamVjdF9mZW5jZV9wcmVwYXJlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmos
CiAJCQkgICAgICBpbnQgdGlsaW5nX21vZGUsIHVuc2lnbmVkIGludCBzdHJpZGUpCiB7CisJc3Ry
dWN0IGk5MTVfZ2d0dCAqZ2d0dCA9ICZ0b19pOTE1KG9iai0+YmFzZS5kZXYpLT5nZ3R0OwogCXN0
cnVjdCBpOTE1X3ZtYSAqdm1hOwotCWludCByZXQ7CisJaW50IHJldCA9IDA7CiAKIAlpZiAodGls
aW5nX21vZGUgPT0gSTkxNV9USUxJTkdfTk9ORSkKIAkJcmV0dXJuIDA7CiAKKwltdXRleF9sb2Nr
KCZnZ3R0LT52bS5tdXRleCk7CiAJZm9yX2VhY2hfZ2d0dF92bWEodm1hLCBvYmopIHsKIAkJaWYg
KGk5MTVfdm1hX2ZlbmNlX3ByZXBhcmUodm1hLCB0aWxpbmdfbW9kZSwgc3RyaWRlKSkKIAkJCWNv
bnRpbnVlOwogCi0JCXJldCA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQlyZXQgPSBfX2k5MTVf
dm1hX3VuYmluZCh2bWEpOwogCQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsKKwkJCWJyZWFrOwog
CX0KKwltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAotCXJldHVybiAwOworCXJldHVy
biByZXQ7CiB9CiAKIGludApAQCAtMjEyLDcgKzIxNSw2IEBAIGk5MTVfZ2VtX29iamVjdF9zZXRf
dGlsaW5nKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAKIAlHRU1fQlVHX09OKCFp
OTE1X3RpbGluZ19vayhvYmosIHRpbGluZywgc3RyaWRlKSk7CiAJR0VNX0JVR19PTighc3RyaWRl
IF4gKHRpbGluZyA9PSBJOTE1X1RJTElOR19OT05FKSk7Ci0JbG9ja2RlcF9hc3NlcnRfaGVsZCgm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlpZiAoKHRpbGluZyB8IHN0cmlkZSkgPT0gb2Jq
LT50aWxpbmdfYW5kX3N0cmlkZSkKIAkJcmV0dXJuIDA7CkBAIC0yMzMsMTYgKzIzNSwxOCBAQCBp
OTE1X2dlbV9vYmplY3Rfc2V0X3RpbGluZyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
LAogCSAqIHdoaWxzdCBleGVjdXRpbmcgYSBmZW5jZWQgY29tbWFuZCBmb3IgYW4gdW50aWxlZCBv
YmplY3QuCiAJICovCiAKLQllcnIgPSBpOTE1X2dlbV9vYmplY3RfZmVuY2VfcHJlcGFyZShvYmos
IHRpbGluZywgc3RyaWRlKTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gZXJyOwotCiAJaTkxNV9nZW1f
b2JqZWN0X2xvY2sob2JqKTsKIAlpZiAoaTkxNV9nZW1fb2JqZWN0X2lzX2ZyYW1lYnVmZmVyKG9i
aikpIHsKIAkJaTkxNV9nZW1fb2JqZWN0X3VubG9jayhvYmopOwogCQlyZXR1cm4gLUVCVVNZOwog
CX0KIAorCWVyciA9IGk5MTVfZ2VtX29iamVjdF9mZW5jZV9wcmVwYXJlKG9iaiwgdGlsaW5nLCBz
dHJpZGUpOworCWlmIChlcnIpIHsKKwkJaTkxNV9nZW1fb2JqZWN0X3VubG9jayhvYmopOworCQly
ZXR1cm4gZXJyOworCX0KKwogCS8qIElmIHRoZSBtZW1vcnkgaGFzIHVua25vd24gKGkuZS4gdmFy
eWluZykgc3dpenpsaW5nLCB3ZSBwaW4gdGhlCiAJICogcGFnZXMgdG8gcHJldmVudCB0aGVtIGJl
aW5nIHN3YXBwZWQgb3V0IGFuZCBjYXVzaW5nIGNvcnJ1cHRpb24KIAkgKiBkdWUgdG8gdGhlIGNo
YW5nZSBpbiBzd2l6emxpbmcuCkBAIC0zNjgsMTIgKzM3Miw3IEBAIGk5MTVfZ2VtX3NldF90aWxp
bmdfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJfQogCX0KIAot
CWVyciA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwotCWlm
IChlcnIpCi0JCWdvdG8gZXJyOwotCiAJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3NldF90aWxpbmco
b2JqLCBhcmdzLT50aWxpbmdfbW9kZSwgYXJncy0+c3RyaWRlKTsKLQltdXRleF91bmxvY2soJmRl
di0+c3RydWN0X211dGV4KTsKIAogCS8qIFdlIGhhdmUgdG8gbWFpbnRhaW4gdGhpcyBleGlzdGlu
ZyBBQkkuLi4gKi8KIAlhcmdzLT5zdHJpZGUgPSBpOTE1X2dlbV9vYmplY3RfZ2V0X3N0cmlkZShv
YmopOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJw
dHIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMKaW5kZXgg
NmIzYjUwZjBmNmQ5Li4xNzM4YTE1ZWI5MTEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX3VzZXJwdHIuYwpAQCAtOTIsNyArOTIsNiBAQCB1c2VycHRyX21uX2ludmFsaWRh
dGVfcmFuZ2Vfc3RhcnQoc3RydWN0IG1tdV9ub3RpZmllciAqX21uLAogCXN0cnVjdCBpOTE1X21t
dV9ub3RpZmllciAqbW4gPQogCQljb250YWluZXJfb2YoX21uLCBzdHJ1Y3QgaTkxNV9tbXVfbm90
aWZpZXIsIG1uKTsKIAlzdHJ1Y3QgaW50ZXJ2YWxfdHJlZV9ub2RlICppdDsKLQlzdHJ1Y3QgbXV0
ZXggKnVubG9jayA9IE5VTEw7CiAJdW5zaWduZWQgbG9uZyBlbmQ7CiAJaW50IHJldCA9IDA7CiAK
QEAgLTEyOSwzMyArMTI4LDEzIEBAIHVzZXJwdHJfbW5faW52YWxpZGF0ZV9yYW5nZV9zdGFydChz
dHJ1Y3QgbW11X25vdGlmaWVyICpfbW4sCiAJCX0KIAkJc3Bpbl91bmxvY2soJm1uLT5sb2NrKTsK
IAotCQlpZiAoIXVubG9jaykgewotCQkJdW5sb2NrID0gJm1uLT5tbS0+aTkxNS0+ZHJtLnN0cnVj
dF9tdXRleDsKLQotCQkJc3dpdGNoIChtdXRleF90cnlsb2NrX3JlY3Vyc2l2ZSh1bmxvY2spKSB7
Ci0JCQlkZWZhdWx0OgotCQkJY2FzZSBNVVRFWF9UUllMT0NLX0ZBSUxFRDoKLQkJCQlpZiAobXV0
ZXhfbG9ja19raWxsYWJsZV9uZXN0ZWQodW5sb2NrLCBJOTE1X01NX1NIUklOS0VSKSkgewotCQkJ
CQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7Ci0JCQkJCXJldHVybiAtRUlOVFI7Ci0JCQkJfQot
CQkJCS8qIGZhbGwgdGhyb3VnaCAqLwotCQkJY2FzZSBNVVRFWF9UUllMT0NLX1NVQ0NFU1M6Ci0J
CQkJYnJlYWs7Ci0KLQkJCWNhc2UgTVVURVhfVFJZTE9DS19SRUNVUlNJVkU6Ci0JCQkJdW5sb2Nr
ID0gRVJSX1BUUigtRUVYSVNUKTsKLQkJCQlicmVhazsKLQkJCX0KLQkJfQotCiAJCXJldCA9IGk5
MTVfZ2VtX29iamVjdF91bmJpbmQob2JqLAogCQkJCQkgICAgIEk5MTVfR0VNX09CSkVDVF9VTkJJ
TkRfQUNUSVZFKTsKIAkJaWYgKHJldCA9PSAwKQogCQkJcmV0ID0gX19pOTE1X2dlbV9vYmplY3Rf
cHV0X3BhZ2VzKG9iaiwgSTkxNV9NTV9TSFJJTktFUik7CiAJCWk5MTVfZ2VtX29iamVjdF9wdXQo
b2JqKTsKIAkJaWYgKHJldCkKLQkJCWdvdG8gdW5sb2NrOworCQkJcmV0dXJuIHJldDsKIAogCQlz
cGluX2xvY2soJm1uLT5sb2NrKTsKIApAQCAtMTY4LDEwICsxNDcsNiBAQCB1c2VycHRyX21uX2lu
dmFsaWRhdGVfcmFuZ2Vfc3RhcnQoc3RydWN0IG1tdV9ub3RpZmllciAqX21uLAogCX0KIAlzcGlu
X3VubG9jaygmbW4tPmxvY2spOwogCi11bmxvY2s6Ci0JaWYgKCFJU19FUlJfT1JfTlVMTCh1bmxv
Y2spKQotCQltdXRleF91bmxvY2sodW5sb2NrKTsKLQogCXJldHVybiByZXQ7CiAKIH0KZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMKaW5kZXggYzVj
ZWE0Mzc5MjE2Li45OGIyYTZjY2ZjYzEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jCkBAIC0zMzMsNyArMzMzLDEyIEBAIHN0YXRpYyBpbnQg
aWd0X2NoZWNrX3BhZ2Vfc2l6ZXMoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB2bWEtPnZtLT5pOTE1OwogCXVuc2lnbmVkIGludCBzdXBwb3J0
ZWQgPSBJTlRFTF9JTkZPKGk5MTUpLT5wYWdlX3NpemVzOwogCXN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmogPSB2bWEtPm9iajsKLQlpbnQgZXJyID0gMDsKKwlpbnQgZXJyOworCisJLyog
V2UgaGF2ZSB0byB3YWl0IGZvciB0aGUgYXN5bmMgYmluZCB0byBjb21wbGV0ZSBiZWZvcmUgb3Vy
IGFzc2VydHMgKi8KKwllcnIgPSBpOTE1X3ZtYV9zeW5jKHZtYSk7CisJaWYgKGVycikKKwkJcmV0
dXJuIGVycjsKIAogCWlmICghSEFTX1BBR0VfU0laRVMoaTkxNSwgdm1hLT5wYWdlX3NpemVzLnNn
KSkgewogCQlwcl9lcnIoInVuc3VwcG9ydGVkIHBhZ2Vfc2l6ZXMuc2c9JXUsIHN1cHBvcnRlZD0l
dVxuIiwKQEAgLTEzOTAsNyArMTM5NSw3IEBAIHN0YXRpYyBpbnQgaWd0X3BwZ3R0X3Bpbl91cGRh
dGUodm9pZCAqYXJnKQogCQkJZ290byBvdXRfdW5waW47CiAJCX0KIAotCQllcnIgPSBpOTE1X3Zt
YV9iaW5kKHZtYSwgSTkxNV9DQUNIRV9OT05FLCBQSU5fVVBEQVRFKTsKKwkJZXJyID0gaTkxNV92
bWFfYmluZCh2bWEsIEk5MTVfQ0FDSEVfTk9ORSwgUElOX1VQREFURSwgTlVMTCk7CiAJCWlmIChl
cnIpCiAJCQlnb3RvIG91dF91bnBpbjsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYwppbmRleCAwZjRkMDY0NGE0ODAuLjhl
YmEwZDNhMzFkZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0
cy9pOTE1X2dlbV9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0
ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKQEAgLTk3MSwxMCArOTcxLDcgQEAgZW1pdF9ycGNzX3F1
ZXJ5KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJaWYgKGVycikKIAkJZ290byBz
a2lwX3JlcXVlc3Q7CiAKLQlpOTE1X3ZtYV91bnBpbihiYXRjaCk7Ci0JaTkxNV92bWFfY2xvc2Uo
YmF0Y2gpOwotCWk5MTVfdm1hX3B1dChiYXRjaCk7Ci0KKwlpOTE1X3ZtYV91bnBpbl9hbmRfcmVs
ZWFzZSgmYmF0Y2gsIDApOwogCWk5MTVfdm1hX3VucGluKHZtYSk7CiAKIAkqcnFfb3V0ID0gaTkx
NV9yZXF1ZXN0X2dldChycSk7CkBAIC05ODgsOCArOTg1LDcgQEAgZW1pdF9ycGNzX3F1ZXJ5KHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiBlcnJfcmVxdWVzdDoKIAlpOTE1X3JlcXVl
c3RfYWRkKHJxKTsKIGVycl9iYXRjaDoKLQlpOTE1X3ZtYV91bnBpbihiYXRjaCk7Ci0JaTkxNV92
bWFfcHV0KGJhdGNoKTsKKwlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmYmF0Y2gsIDApOwog
ZXJyX3ZtYToKIAlpOTE1X3ZtYV91bnBpbih2bWEpOwogCkBAIC0xNTMzLDkgKzE1MjksNyBAQCBz
dGF0aWMgaW50IHdyaXRlX3RvX3NjcmF0Y2goc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwK
IAlpZiAoZXJyKQogCQlnb3RvIHNraXBfcmVxdWVzdDsKIAotCWk5MTVfdm1hX3VucGluKHZtYSk7
Ci0JaTkxNV92bWFfY2xvc2Uodm1hKTsKLQlpOTE1X3ZtYV9wdXQodm1hKTsKKwlpOTE1X3ZtYV91
bnBpbl9hbmRfcmVsZWFzZSgmdm1hLCAwKTsKIAogCWk5MTVfcmVxdWVzdF9hZGQocnEpOwogCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21t
YW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5j
CmluZGV4IGFlZmU1NTc1MjdmOC4uMzZhY2ExYzE3MmU3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYwpAQCAtMzIyLDcgKzMyMiw2
IEBAIHN0YXRpYyBpbnQgaWd0X3BhcnRpYWxfdGlsaW5nKHZvaWQgKmFyZykKIAkJZ290byBvdXQ7
CiAJfQogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJd2FrZXJlZiA9
IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKIAogCWlmICgxKSB7CkBA
IC00MTUsNyArNDE0LDYgQEAgbmV4dF90aWxpbmc6IDsKIAogb3V0X3VubG9jazoKIAlpbnRlbF9y
dW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpOTE1X2dlbV9vYmplY3RfdW5waW5fcGFnZXMo
b2JqKTsKIG91dDoKIAlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CkBAIC00NTgsNyArNDU2LDYg
QEAgc3RhdGljIGludCBpZ3Rfc21va2VfdGlsaW5nKHZvaWQgKmFyZykKIAkJZ290byBvdXQ7CiAJ
fQogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJd2FrZXJlZiA9IGlu
dGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKIAogCWNvdW50ID0gMDsKQEAg
LTUwOCw3ICs1MDUsNiBAQCBzdGF0aWMgaW50IGlndF9zbW9rZV90aWxpbmcodm9pZCAqYXJnKQog
CXByX2luZm8oIiVzOiBDb21wbGV0ZWQgJWx1IHRyaWFsc1xuIiwgX19mdW5jX18sIGNvdW50KTsK
IAogCWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQlt
dXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWk5MTVfZ2VtX29iamVjdF91
bnBpbl9wYWdlcyhvYmopOwogb3V0OgogCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGlscy5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pZ3RfZ2VtX3V0aWxzLmMKaW5k
ZXggZWU1ZGMxM2EzMGIzLi42NzE4ZGEyMGYzNWQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGlscy5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGlscy5jCkBAIC0xNTQsOSArMTU0LDcgQEAg
aW50IGlndF9ncHVfZmlsbF9kdyhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAKIAlpOTE1X3Jl
cXVlc3RfYWRkKHJxKTsKIAotCWk5MTVfdm1hX3VucGluKGJhdGNoKTsKLQlpOTE1X3ZtYV9jbG9z
ZShiYXRjaCk7Ci0JaTkxNV92bWFfcHV0KGJhdGNoKTsKKwlpOTE1X3ZtYV91bnBpbl9hbmRfcmVs
ZWFzZSgmYmF0Y2gsIDApOwogCiAJcmV0dXJuIDA7CiAKQEAgLTE2NSw3ICsxNjMsNiBAQCBpbnQg
aWd0X2dwdV9maWxsX2R3KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKIGVycl9yZXF1ZXN0Ogog
CWk5MTVfcmVxdWVzdF9hZGQocnEpOwogZXJyX2JhdGNoOgotCWk5MTVfdm1hX3VucGluKGJhdGNo
KTsKLQlpOTE1X3ZtYV9wdXQoYmF0Y2gpOworCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZi
YXRjaCwgMCk7CiAJcmV0dXJuIGVycjsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2d0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jCmlu
ZGV4IDBlNTkwOWVlMDY1Ny4uNzIwNTU5NTM2OWJlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9ndC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2d0LmMKQEAgLTMwMiwxMSArMzAyLDEyIEBAIHZvaWQgaW50ZWxfZ3RfZmx1c2hfZ2d0dF93cml0
ZXMoc3RydWN0IGludGVsX2d0ICpndCkKIAogCXdpdGhfaW50ZWxfcnVudGltZV9wbSgmaTkxNS0+
cnVudGltZV9wbSwgd2FrZXJlZikgewogCQlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSBn
dC0+dW5jb3JlOworCQl1bnNpZ25lZCBsb25nIGZsYWdzOwogCi0JCXNwaW5fbG9ja19pcnEoJnVu
Y29yZS0+bG9jayk7CisJCXNwaW5fbG9ja19pcnFzYXZlKCZ1bmNvcmUtPmxvY2ssIGZsYWdzKTsK
IAkJaW50ZWxfdW5jb3JlX3Bvc3RpbmdfcmVhZF9mdyh1bmNvcmUsCiAJCQkJCSAgICAgUklOR19I
RUFEKFJFTkRFUl9SSU5HX0JBU0UpKTsKLQkJc3Bpbl91bmxvY2tfaXJxKCZ1bmNvcmUtPmxvY2sp
OworCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZ1bmNvcmUtPmxvY2ssIGZsYWdzKTsKIAl9CiB9
CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYwppbmRleCAwNzQ3
YjhjOWY3NjguLmVjMzI5OTYyNTRjMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfcmluZ2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X3JpbmdidWZmZXIuYwpAQCAtMTMzOCwxNSArMTMzOCwxMyBAQCB2b2lkIGludGVsX3JpbmdfZnJl
ZShzdHJ1Y3Qga3JlZiAqcmVmKQogewogCXN0cnVjdCBpbnRlbF9yaW5nICpyaW5nID0gY29udGFp
bmVyX29mKHJlZiwgdHlwZW9mKCpyaW5nKSwgcmVmKTsKIAotCWk5MTVfdm1hX2Nsb3NlKHJpbmct
PnZtYSk7CiAJaTkxNV92bWFfcHV0KHJpbmctPnZtYSk7Ci0KIAlrZnJlZShyaW5nKTsKIH0KIAog
c3RhdGljIHZvaWQgX19yaW5nX2NvbnRleHRfZmluaShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2Up
CiB7Ci0JaTkxNV9nZW1fb2JqZWN0X3B1dChjZS0+c3RhdGUtPm9iaik7CisJaTkxNV92bWFfcHV0
KGNlLT5zdGF0ZSk7CiB9CiAKIHN0YXRpYyB2b2lkIHJpbmdfY29udGV4dF9kZXN0cm95KHN0cnVj
dCBrcmVmICpyZWYpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVz
dF9oYW5nY2hlY2suYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVj
ay5jCmluZGV4IDljMGM4NDQxYzIyYS4uZDNiZWU5Zjg4MDA4IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYwpAQCAtMTEyNywxNSArMTEyNywxNCBAQCBz
dGF0aWMgaW50IGV2aWN0X3ZtYSh2b2lkICpkYXRhKQogewogCXN0cnVjdCBldmljdF92bWEgKmFy
ZyA9IGRhdGE7CiAJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSBhcmctPnZtYS0+dm07
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB2bS0+aTkxNTsKIAlzdHJ1Y3QgZHJt
X21tX25vZGUgZXZpY3QgPSBhcmctPnZtYS0+bm9kZTsKIAlpbnQgZXJyOwogCiAJY29tcGxldGUo
JmFyZy0+Y29tcGxldGlvbik7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKKwltdXRleF9sb2NrKCZ2bS0+bXV0ZXgpOwogCWVyciA9IGk5MTVfZ2VtX2V2aWN0X2Zvcl9u
b2RlKHZtLCAmZXZpY3QsIDApOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CisJbXV0ZXhfdW5sb2NrKCZ2bS0+bXV0ZXgpOwogCiAJcmV0dXJuIGVycjsKIH0KQEAgLTEx
NDMsMzkgKzExNDIsMzMgQEAgc3RhdGljIGludCBldmljdF92bWEodm9pZCAqZGF0YSkKIHN0YXRp
YyBpbnQgZXZpY3RfZmVuY2Uodm9pZCAqZGF0YSkKIHsKIAlzdHJ1Y3QgZXZpY3Rfdm1hICphcmcg
PSBkYXRhOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnLT52bWEtPnZtLT5p
OTE1OwogCWludCBlcnI7CiAKIAljb21wbGV0ZSgmYXJnLT5jb21wbGV0aW9uKTsKIAotCW11dGV4
X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJLyogTWFyayB0aGUgZmVuY2UgcmVn
aXN0ZXIgYXMgZGlydHkgdG8gZm9yY2UgdGhlIG1taW8gdXBkYXRlLiAqLwogCWVyciA9IGk5MTVf
Z2VtX29iamVjdF9zZXRfdGlsaW5nKGFyZy0+dm1hLT5vYmosIEk5MTVfVElMSU5HX1ksIDUxMik7
CiAJaWYgKGVycikgewogCQlwcl9lcnIoIkludmFsaWQgWS10aWxpbmcgc2V0dGluZ3M7IGVycjol
ZFxuIiwgZXJyKTsKLQkJZ290byBvdXRfdW5sb2NrOworCQlyZXR1cm4gZXJyOwogCX0KIAogCWVy
ciA9IGk5MTVfdm1hX3BpbihhcmctPnZtYSwgMCwgMCwgUElOX0dMT0JBTCB8IFBJTl9NQVBQQUJM
RSk7CiAJaWYgKGVycikgewogCQlwcl9lcnIoIlVuYWJsZSB0byBwaW4gdm1hIGZvciBZLXRpbGVk
IGZlbmNlOyBlcnI6JWRcbiIsIGVycik7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJcmV0dXJuIGVy
cjsKIAl9CiAKIAllcnIgPSBpOTE1X3ZtYV9waW5fZmVuY2UoYXJnLT52bWEpOwogCWk5MTVfdm1h
X3VucGluKGFyZy0+dm1hKTsKIAlpZiAoZXJyKSB7CiAJCXByX2VycigiVW5hYmxlIHRvIHBpbiBZ
LXRpbGVkIGZlbmNlOyBlcnI6JWRcbiIsIGVycik7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJcmV0
dXJuIGVycjsKIAl9CiAKIAlpOTE1X3ZtYV91bnBpbl9mZW5jZShhcmctPnZtYSk7CiAKLW91dF91
bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQotCXJldHVy
biBlcnI7CisJcmV0dXJuIDA7CiB9CiAKIHN0YXRpYyBpbnQgX19pZ3RfcmVzZXRfZXZpY3Rfdm1h
KHN0cnVjdCBpbnRlbF9ndCAqZ3QsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dnQvYXBlcnR1cmVfZ20uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9hcGVydHVyZV9nbS5j
CmluZGV4IDVmZjI0MzdiMjk5OC4uZDk5NmJiYzdlYTU5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndnQvYXBlcnR1cmVfZ20uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dnQvYXBlcnR1cmVfZ20uYwpAQCAtNjEsMTQgKzYxLDE0IEBAIHN0YXRpYyBpbnQgYWxsb2NfZ20o
c3RydWN0IGludGVsX3ZncHUgKnZncHUsIGJvb2wgaGlnaF9nbSkKIAkJZmxhZ3MgPSBQSU5fTUFQ
UEFCTEU7CiAJfQogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwor
CW11dGV4X2xvY2soJmRldl9wcml2LT5nZ3R0LnZtLm11dGV4KTsKIAltbWlvX2h3X2FjY2Vzc19w
cmUoZGV2X3ByaXYpOwogCXJldCA9IGk5MTVfZ2VtX2d0dF9pbnNlcnQoJmRldl9wcml2LT5nZ3R0
LnZtLCBub2RlLAogCQkJCSAgc2l6ZSwgSTkxNV9HVFRfUEFHRV9TSVpFLAogCQkJCSAgSTkxNV9D
T0xPUl9VTkVWSUNUQUJMRSwKIAkJCQkgIHN0YXJ0LCBlbmQsIGZsYWdzKTsKIAltbWlvX2h3X2Fj
Y2Vzc19wb3N0KGRldl9wcml2KTsKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0
X211dGV4KTsKKwltdXRleF91bmxvY2soJmRldl9wcml2LT5nZ3R0LnZtLm11dGV4KTsKIAlpZiAo
cmV0KQogCQlndnRfZXJyKCJmYWlsIHRvIGFsbG9jICVzIGdtIHNwYWNlIGZyb20gaG9zdFxuIiwK
IAkJCWhpZ2hfZ20gPyAiaGlnaCIgOiAibG93Iik7CkBAIC05OCw5ICs5OCw5IEBAIHN0YXRpYyBp
bnQgYWxsb2NfdmdwdV9nbShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAogCXJldHVybiAwOwog
b3V0X2ZyZWVfYXBlcnR1cmU6Ci0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0
ZXgpOworCW11dGV4X2xvY2soJmRldl9wcml2LT5nZ3R0LnZtLm11dGV4KTsKIAlkcm1fbW1fcmVt
b3ZlX25vZGUoJnZncHUtPmdtLmxvd19nbV9ub2RlKTsKLQltdXRleF91bmxvY2soJmRldl9wcml2
LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF91bmxvY2soJmRldl9wcml2LT5nZ3R0LnZtLm11
dGV4KTsKIAlyZXR1cm4gcmV0OwogfQogCkBAIC0xMDgsMTAgKzEwOCwxMCBAQCBzdGF0aWMgdm9p
ZCBmcmVlX3ZncHVfZ20oc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiB7CiAJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdmdwdS0+Z3Z0LT5kZXZfcHJpdjsKIAotCW11dGV4X2xv
Y2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF9sb2NrKCZkZXZfcHJpdi0+
Z2d0dC52bS5tdXRleCk7CiAJZHJtX21tX3JlbW92ZV9ub2RlKCZ2Z3B1LT5nbS5sb3dfZ21fbm9k
ZSk7CiAJZHJtX21tX3JlbW92ZV9ub2RlKCZ2Z3B1LT5nbS5oaWdoX2dtX25vZGUpOwotCW11dGV4
X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X3VubG9jaygmZGV2
X3ByaXYtPmdndHQudm0ubXV0ZXgpOwogfQogCiAvKioKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2
ZS5jCmluZGV4IGQ1YWFjNmZmODAzYS4uMDc5MTczNmEwOGZkIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfYWN0aXZlLmMKQEAgLTE0Niw2ICsxNDYsNyBAQCBfX2FjdGl2ZV9yZXRpcmUoc3RydWN0IGk5
MTVfYWN0aXZlICpyZWYpCiAJaWYgKCFyZXRpcmUpCiAJCXJldHVybjsKIAorCUdFTV9CVUdfT04o
cmN1X2FjY2Vzc19wb2ludGVyKHJlZi0+ZXhjbCkpOwogCXJidHJlZV9wb3N0b3JkZXJfZm9yX2Vh
Y2hfZW50cnlfc2FmZShpdCwgbiwgJnJvb3QsIG5vZGUpIHsKIAkJR0VNX0JVR19PTihpOTE1X2Fj
dGl2ZV9yZXF1ZXN0X2lzc2V0KCZpdC0+YmFzZSkpOwogCQlrbWVtX2NhY2hlX2ZyZWUoZ2xvYmFs
LnNsYWJfY2FjaGUsIGl0KTsKQEAgLTI0NSw2ICsyNDYsOCBAQCB2b2lkIF9faTkxNV9hY3RpdmVf
aW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlyZWYtPmZsYWdzID0gMDsKIAly
ZWYtPmFjdGl2ZSA9IGFjdGl2ZTsKIAlyZWYtPnJldGlyZSA9IHJldGlyZTsKKworCXJlZi0+ZXhj
bCA9IE5VTEw7CiAJcmVmLT50cmVlID0gUkJfUk9PVDsKIAlyZWYtPmNhY2hlID0gTlVMTDsKIAlp
bml0X2xsaXN0X2hlYWQoJnJlZi0+cHJlYWxsb2NhdGVkX2JhcnJpZXJzKTsKQEAgLTM0MSw2ICsz
NDQsNDYgQEAgaW50IGk5MTVfYWN0aXZlX3JlZihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKIAly
ZXR1cm4gZXJyOwogfQogCitzdGF0aWMgdm9pZCBleGNsX2NiKHN0cnVjdCBkbWFfZmVuY2UgKmYs
IHN0cnVjdCBkbWFfZmVuY2VfY2IgKmNiKQoreworCXN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmID0g
Y29udGFpbmVyX29mKGNiLCB0eXBlb2YoKnJlZiksIGV4Y2xfY2IpOworCisJUkNVX0lOSVRfUE9J
TlRFUihyZWYtPmV4Y2wsIE5VTEwpOworCWRtYV9mZW5jZV9wdXQoZik7CisKKwlhY3RpdmVfcmV0
aXJlKHJlZik7Cit9CisKK3ZvaWQgaTkxNV9hY3RpdmVfc2V0X2V4Y2x1c2l2ZShzdHJ1Y3QgaTkx
NV9hY3RpdmUgKnJlZiwgc3RydWN0IGRtYV9mZW5jZSAqZikKK3sKKwkvKiBXZSBleHBlY3QgdGhl
IGNhbGxlciB0byBtYW5hZ2UgdGhlIGV4Y2x1c2l2ZSB0aW1lbGluZSBvcmRlcmluZyAqLworCUdF
TV9CVUdfT04oaTkxNV9hY3RpdmVfaXNfaWRsZShyZWYpKTsKKworCWRtYV9mZW5jZV9nZXQoZik7
CisKKwlyY3VfcmVhZF9sb2NrKCk7CisJaWYgKHJjdV9hY2Nlc3NfcG9pbnRlcihyZWYtPmV4Y2wp
KSB7CisJCXN0cnVjdCBkbWFfZmVuY2UgKm9sZDsKKworCQlvbGQgPSBkbWFfZmVuY2VfZ2V0X3Jj
dV9zYWZlKCZyZWYtPmV4Y2wpOworCQlpZiAob2xkKSB7CisJCQlpZiAoZG1hX2ZlbmNlX3JlbW92
ZV9jYWxsYmFjayhvbGQsICZyZWYtPmV4Y2xfY2IpKQorCQkJCWF0b21pY19kZWMoJnJlZi0+Y291
bnQpOworCQkJZG1hX2ZlbmNlX3B1dChvbGQpOworCQl9CisJfQorCXJjdV9yZWFkX3VubG9jaygp
OworCisJYXRvbWljX2luYygmcmVmLT5jb3VudCk7CisJcmN1X2Fzc2lnbl9wb2ludGVyKHJlZi0+
ZXhjbCwgZik7CisKKwlpZiAoZG1hX2ZlbmNlX2FkZF9jYWxsYmFjayhmLCAmcmVmLT5leGNsX2Ni
LCBleGNsX2NiKSkgeworCQlSQ1VfSU5JVF9QT0lOVEVSKHJlZi0+ZXhjbCwgTlVMTCk7CisJCWF0
b21pY19kZWMoJnJlZi0+Y291bnQpOworCQlkbWFfZmVuY2VfcHV0KGYpOworCX0KK30KKwogaW50
IGk5MTVfYWN0aXZlX2FjcXVpcmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiB7CiAJaW50IGVy
cjsKQEAgLTM5OSw2ICs0NDIsMjUgQEAgdm9pZCBpOTE1X2FjdGl2ZV91bmdyYWIoc3RydWN0IGk5
MTVfYWN0aXZlICpyZWYpCiAJX19hY3RpdmVfdW5ncmFiKHJlZik7CiB9CiAKK3N0YXRpYyBpbnQg
ZXhjbF93YWl0KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQoreworCXN0cnVjdCBkbWFfZmVuY2Ug
Km9sZDsKKwlpbnQgZXJyID0gMDsKKworCWlmICghcmN1X2FjY2Vzc19wb2ludGVyKHJlZi0+ZXhj
bCkpCisJCXJldHVybiAwOworCisJcmN1X3JlYWRfbG9jaygpOworCW9sZCA9IGRtYV9mZW5jZV9n
ZXRfcmN1X3NhZmUoJnJlZi0+ZXhjbCk7CisJcmN1X3JlYWRfdW5sb2NrKCk7CisJaWYgKG9sZCkg
eworCQllcnIgPSBkbWFfZmVuY2Vfd2FpdChvbGQsIHRydWUpOworCQlkbWFfZmVuY2VfcHV0KG9s
ZCk7CisJfQorCisJcmV0dXJuIGVycjsKK30KKwogaW50IGk5MTVfYWN0aXZlX3dhaXQoc3RydWN0
IGk5MTVfYWN0aXZlICpyZWYpCiB7CiAJc3RydWN0IGFjdGl2ZV9ub2RlICppdCwgKm47CkBAIC00
MTksNiArNDgxLDEwIEBAIGludCBpOTE1X2FjdGl2ZV93YWl0KHN0cnVjdCBpOTE1X2FjdGl2ZSAq
cmVmKQogCQlyZXR1cm4gMDsKIAl9CiAKKwllcnIgPSBleGNsX3dhaXQocmVmKTsKKwlpZiAoZXJy
KQorCQlnb3RvIG91dDsKKwogCXJidHJlZV9wb3N0b3JkZXJfZm9yX2VhY2hfZW50cnlfc2FmZShp
dCwgbiwgJnJlZi0+dHJlZSwgbm9kZSkgewogCQlpZiAoaXNfYmFycmllcigmaXQtPmJhc2UpKSB7
IC8qIHVuY29ubmVjdGVkIGlkbGUtYmFycmllciAqLwogCQkJZXJyID0gLUVCVVNZOwpAQCAtNDMw
LDYgKzQ5Niw3IEBAIGludCBpOTE1X2FjdGl2ZV93YWl0KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVm
KQogCQkJYnJlYWs7CiAJfQogCitvdXQ6CiAJX19hY3RpdmVfcmV0aXJlKHJlZik7CiAJaWYgKGVy
cikKIAkJcmV0dXJuIGVycjsKQEAgLTQ1NCwyNiArNTIxLDIyIEBAIGludCBpOTE1X3JlcXVlc3Rf
YXdhaXRfYWN0aXZlX3JlcXVlc3Qoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCiAKIGludCBpOTE1
X3JlcXVlc3RfYXdhaXRfYWN0aXZlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBzdHJ1Y3QgaTkx
NV9hY3RpdmUgKnJlZikKIHsKLQlzdHJ1Y3QgYWN0aXZlX25vZGUgKml0LCAqbjsKLQlpbnQgZXJy
OwotCi0JaWYgKFJCX0VNUFRZX1JPT1QoJnJlZi0+dHJlZSkpCi0JCXJldHVybiAwOworCWludCBl
cnIgPSAwOwogCi0JLyogYXdhaXQgYWxsb2NhdGVzIGFuZCBzbyB3ZSBuZWVkIHRvIGF2b2lkIGhp
dHRpbmcgdGhlIHNocmlua2VyICovCi0JZXJyID0gaTkxNV9hY3RpdmVfYWNxdWlyZShyZWYpOwot
CWlmIChlcnIpCi0JCXJldHVybiBlcnI7CisJaWYgKHJjdV9hY2Nlc3NfcG9pbnRlcihyZWYtPmV4
Y2wpKSB7CisJCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlOwogCi0JbXV0ZXhfbG9jaygmcmVmLT5t
dXRleCk7Ci0JcmJ0cmVlX3Bvc3RvcmRlcl9mb3JfZWFjaF9lbnRyeV9zYWZlKGl0LCBuLCAmcmVm
LT50cmVlLCBub2RlKSB7Ci0JCWVyciA9IGk5MTVfcmVxdWVzdF9hd2FpdF9hY3RpdmVfcmVxdWVz
dChycSwgJml0LT5iYXNlKTsKLQkJaWYgKGVycikKLQkJCWJyZWFrOworCQlyY3VfcmVhZF9sb2Nr
KCk7CisJCWZlbmNlID0gZG1hX2ZlbmNlX2dldF9yY3Vfc2FmZSgmcmVmLT5leGNsKTsKKwkJcmN1
X3JlYWRfdW5sb2NrKCk7CisJCWlmIChmZW5jZSkgeworCQkJZXJyID0gaTkxNV9yZXF1ZXN0X2F3
YWl0X2RtYV9mZW5jZShycSwgZmVuY2UpOworCQkJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CisJCX0K
IAl9Ci0JbXV0ZXhfdW5sb2NrKCZyZWYtPm11dGV4KTsKIAotCWk5MTVfYWN0aXZlX3JlbGVhc2Uo
cmVmKTsKKwkvKiBJbiB0aGUgZnV0dXJlIHdlIG1heSBjaG9vc2UgdG8gYXdhaXQgb24gYWxsIGZl
bmNlcyAqLworCiAJcmV0dXJuIGVycjsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9hY3RpdmUuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmgK
aW5kZXggOTQ5YzY4MzUzMzViLi45MDAzNGY2MWI3YzIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfYWN0aXZlLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9h
Y3RpdmUuaApAQCAtMzc5LDYgKzM3OSwxMyBAQCBpOTE1X2FjdGl2ZV9hZGRfcmVxdWVzdChzdHJ1
Y3QgaTkxNV9hY3RpdmUgKnJlZiwgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJcmV0dXJuIGk5
MTVfYWN0aXZlX3JlZihyZWYsIGk5MTVfcmVxdWVzdF90aW1lbGluZShycSksIHJxKTsKIH0KIAor
dm9pZCBpOTE1X2FjdGl2ZV9zZXRfZXhjbHVzaXZlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCBz
dHJ1Y3QgZG1hX2ZlbmNlICpmKTsKKworc3RhdGljIGlubGluZSBib29sIGk5MTVfYWN0aXZlX2hh
c19leGNsdXNpdmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCit7CisJcmV0dXJuIHJjdV9hY2Nl
c3NfcG9pbnRlcihyZWYtPmV4Y2wpOworfQorCiBpbnQgaTkxNV9hY3RpdmVfd2FpdChzdHJ1Y3Qg
aTkxNV9hY3RpdmUgKnJlZik7CiAKIGludCBpOTE1X3JlcXVlc3RfYXdhaXRfYWN0aXZlKHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9hY3RpdmVfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5cGVz
LmgKaW5kZXggMTg1NGU3ZDE2OGMxLi44NmU3YTIzMmVhM2MgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9hY3RpdmVfdHlwZXMuaApAQCAtOCw2ICs4LDcgQEAKICNkZWZpbmUgX0k5MTVfQUNU
SVZFX1RZUEVTX0hfCiAKICNpbmNsdWRlIDxsaW51eC9hdG9taWMuaD4KKyNpbmNsdWRlIDxsaW51
eC9kbWEtZmVuY2UuaD4KICNpbmNsdWRlIDxsaW51eC9sbGlzdC5oPgogI2luY2x1ZGUgPGxpbnV4
L211dGV4Lmg+CiAjaW5jbHVkZSA8bGludXgvcmJ0cmVlLmg+CkBAIC01MSw2ICs1MiwxMCBAQCBz
dHJ1Y3QgaTkxNV9hY3RpdmUgewogCXN0cnVjdCBtdXRleCBtdXRleDsKIAlhdG9taWNfdCBjb3Vu
dDsKIAorCS8qIFByZWFsbG9jYXRlZCAiZXhjbHVzaXZlIiBub2RlICovCisJc3RydWN0IGRtYV9m
ZW5jZSBfX3JjdSAqZXhjbDsKKwlzdHJ1Y3QgZG1hX2ZlbmNlX2NiIGV4Y2xfY2I7CisKIAl1bnNp
Z25lZCBsb25nIGZsYWdzOwogI2RlZmluZSBJOTE1X0FDVElWRV9HUkFCX0JJVCAwCiAKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2Rydi5jCmluZGV4IDMzMDZjNmJiNTE1YS4uNTMyM2U0ZmE1NWQ5IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZHJ2LmMKQEAgLTE4NTgsMTAgKzE4NTgsOCBAQCBzdGF0aWMgaW50IGk5MTVf
ZHJtX3Jlc3VtZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCWlmIChyZXQpCiAJCURSTV9FUlJP
UigiZmFpbGVkIHRvIHJlLWVuYWJsZSBHR1RUXG4iKTsKIAotCW11dGV4X2xvY2soJmRldl9wcml2
LT5kcm0uc3RydWN0X211dGV4KTsKIAlpOTE1X2dlbV9yZXN0b3JlX2d0dF9tYXBwaW5ncyhkZXZf
cHJpdik7CiAJaTkxNV9nZW1fcmVzdG9yZV9mZW5jZXMoZGV2X3ByaXYpOwotCW11dGV4X3VubG9j
aygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJaW50ZWxfY3NyX3Vjb2RlX3Jlc3Vt
ZShkZXZfcHJpdik7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2Vt
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IDcwNDYwNjdmNzBjMS4u
ZjUwMDU4Y2Y4YWI4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTYyLDIwICs2MiwzMSBA
QAogI2luY2x1ZGUgImludGVsX3BtLmgiCiAKIHN0YXRpYyBpbnQKLWluc2VydF9tYXBwYWJsZV9u
b2RlKHN0cnVjdCBpOTE1X2dndHQgKmdndHQsCi0gICAgICAgICAgICAgICAgICAgICBzdHJ1Y3Qg
ZHJtX21tX25vZGUgKm5vZGUsIHUzMiBzaXplKQoraW5zZXJ0X21hcHBhYmxlX25vZGUoc3RydWN0
IGk5MTVfZ2d0dCAqZ2d0dCwgc3RydWN0IGRybV9tbV9ub2RlICpub2RlLCB1MzIgc2l6ZSkKIHsK
KwlpbnQgZXJyOworCisJZXJyID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZnZ3R0LT52bS5t
dXRleCk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKwogCW1lbXNldChub2RlLCAwLCBzaXpl
b2YoKm5vZGUpKTsKLQlyZXR1cm4gZHJtX21tX2luc2VydF9ub2RlX2luX3JhbmdlKCZnZ3R0LT52
bS5tbSwgbm9kZSwKLQkJCQkJICAgc2l6ZSwgMCwgSTkxNV9DT0xPUl9VTkVWSUNUQUJMRSwKLQkJ
CQkJICAgMCwgZ2d0dC0+bWFwcGFibGVfZW5kLAotCQkJCQkgICBEUk1fTU1fSU5TRVJUX0xPVyk7
CisJZXJyID0gZHJtX21tX2luc2VydF9ub2RlX2luX3JhbmdlKCZnZ3R0LT52bS5tbSwgbm9kZSwK
KwkJCQkJICBzaXplLCAwLCBJOTE1X0NPTE9SX1VORVZJQ1RBQkxFLAorCQkJCQkgIDAsIGdndHQt
Pm1hcHBhYmxlX2VuZCwKKwkJCQkJICBEUk1fTU1fSU5TRVJUX0xPVyk7CisKKwltdXRleF91bmxv
Y2soJmdndHQtPnZtLm11dGV4KTsKKworCXJldHVybiBlcnI7CiB9CiAKIHN0YXRpYyB2b2lkCi1y
ZW1vdmVfbWFwcGFibGVfbm9kZShzdHJ1Y3QgZHJtX21tX25vZGUgKm5vZGUpCityZW1vdmVfbWFw
cGFibGVfbm9kZShzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0LCBzdHJ1Y3QgZHJtX21tX25vZGUgKm5v
ZGUpCiB7CisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWRybV9tbV9yZW1vdmVfbm9k
ZShub2RlKTsKKwltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIH0KIAogaW50CkBAIC04
Nyw3ICs5OCw4IEBAIGk5MTVfZ2VtX2dldF9hcGVydHVyZV9pb2N0bChzdHJ1Y3QgZHJtX2Rldmlj
ZSAqZGV2LCB2b2lkICpkYXRhLAogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCXU2NCBwaW5uZWQ7
CiAKLQltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CisJaWYgKG11dGV4X2xvY2tfaW50ZXJy
dXB0aWJsZSgmZ2d0dC0+dm0ubXV0ZXgpKQorCQlyZXR1cm4gLUVJTlRSOwogCiAJcGlubmVkID0g
Z2d0dC0+dm0ucmVzZXJ2ZWQ7CiAJbGlzdF9mb3JfZWFjaF9lbnRyeSh2bWEsICZnZ3R0LT52bS5i
b3VuZF9saXN0LCB2bV9saW5rKQpAQCAtMTA5LDIwICsxMjEsMjQgQEAgaW50IGk5MTVfZ2VtX29i
amVjdF91bmJpbmQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlMSVNUX0hFQUQo
c3RpbGxfaW5fbGlzdCk7CiAJaW50IHJldCA9IDA7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZv
YmotPmJhc2UuZGV2LT5zdHJ1Y3RfbXV0ZXgpOwotCiAJc3Bpbl9sb2NrKCZvYmotPnZtYS5sb2Nr
KTsKIAl3aGlsZSAoIXJldCAmJiAodm1hID0gbGlzdF9maXJzdF9lbnRyeV9vcl9udWxsKCZvYmot
PnZtYS5saXN0LAogCQkJCQkJICAgICAgIHN0cnVjdCBpOTE1X3ZtYSwKIAkJCQkJCSAgICAgICBv
YmpfbGluaykpKSB7CisJCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gdm1hLT52bTsK
KworCQlyZXQgPSAtRUJVU1k7CisJCWlmICghaTkxNV92bV90cnlvcGVuKHZtKSkKKwkJCWJyZWFr
OworCiAJCWxpc3RfbW92ZV90YWlsKCZ2bWEtPm9ial9saW5rLCAmc3RpbGxfaW5fbGlzdCk7CiAJ
CXNwaW5fdW5sb2NrKCZvYmotPnZtYS5sb2NrKTsKIAotCQlyZXQgPSAtRUJVU1k7CiAJCWlmIChm
bGFncyAmIEk5MTVfR0VNX09CSkVDVF9VTkJJTkRfQUNUSVZFIHx8CiAJCSAgICAhaTkxNV92bWFf
aXNfYWN0aXZlKHZtYSkpCiAJCQlyZXQgPSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKIAorCQlpOTE1
X3ZtX2Nsb3NlKHZtKTsKIAkJc3Bpbl9sb2NrKCZvYmotPnZtYS5sb2NrKTsKIAl9CiAJbGlzdF9z
cGxpY2UoJnN0aWxsX2luX2xpc3QsICZvYmotPnZtYS5saXN0KTsKQEAgLTMzOCwxMCArMzU0LDYg
QEAgaTkxNV9nZW1fZ3R0X3ByZWFkKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJ
dTY0IHJlbWFpbiwgb2Zmc2V0OwogCWludCByZXQ7CiAKLQlyZXQgPSBtdXRleF9sb2NrX2ludGVy
cnVwdGlibGUoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChyZXQpCi0JCXJldHVybiBy
ZXQ7Ci0KIAl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0p
OwogCXZtYSA9IEVSUl9QVFIoLUVOT0RFVik7CiAJaWYgKCFpOTE1X2dlbV9vYmplY3RfaXNfdGls
ZWQob2JqKSkKQEAgLTM1NSwxMiArMzY3LDEwIEBAIGk5MTVfZ2VtX2d0dF9wcmVhZChzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCX0gZWxzZSB7CiAJCXJldCA9IGluc2VydF9tYXBw
YWJsZV9ub2RlKGdndHQsICZub2RlLCBQQUdFX1NJWkUpOwogCQlpZiAocmV0KQotCQkJZ290byBv
dXRfdW5sb2NrOworCQkJZ290byBvdXRfcnBtOwogCQlHRU1fQlVHX09OKCFkcm1fbW1fbm9kZV9h
bGxvY2F0ZWQoJm5vZGUpKTsKIAl9CiAKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwotCiAJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X2xvY2tfaW50ZXJydXB0aWJsZShvYmop
OwogCWlmIChyZXQpCiAJCWdvdG8gb3V0X3VucGluOwpAQCAtNDE0LDE3ICs0MjQsMTQgQEAgaTkx
NV9nZW1fZ3R0X3ByZWFkKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAKIAlpOTE1
X2dlbV9vYmplY3RfdW5sb2NrX2ZlbmNlKG9iaiwgZmVuY2UpOwogb3V0X3VucGluOgotCW11dGV4
X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChkcm1fbW1fbm9kZV9hbGxvY2F0
ZWQoJm5vZGUpKSB7CiAJCWdndHQtPnZtLmNsZWFyX3JhbmdlKCZnZ3R0LT52bSwgbm9kZS5zdGFy
dCwgbm9kZS5zaXplKTsKLQkJcmVtb3ZlX21hcHBhYmxlX25vZGUoJm5vZGUpOworCQlyZW1vdmVf
bWFwcGFibGVfbm9kZShnZ3R0LCAmbm9kZSk7CiAJfSBlbHNlIHsKIAkJaTkxNV92bWFfdW5waW4o
dm1hKTsKIAl9Ci1vdXRfdW5sb2NrOgorb3V0X3JwbToKIAlpbnRlbF9ydW50aW1lX3BtX3B1dCgm
aTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKLQogCXJldHVybiByZXQ7CiB9CiAKQEAgLTUzMSwxMCArNTM4LDYgQEAgaTkx
NV9nZW1fZ3R0X3B3cml0ZV9mYXN0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJ
dm9pZCBfX3VzZXIgKnVzZXJfZGF0YTsKIAlpbnQgcmV0OwogCi0JcmV0ID0gbXV0ZXhfbG9ja19p
bnRlcnJ1cHRpYmxlKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAocmV0KQotCQlyZXR1
cm4gcmV0OwotCiAJaWYgKGk5MTVfZ2VtX29iamVjdF9oYXNfc3RydWN0X3BhZ2Uob2JqKSkgewog
CQkvKgogCQkgKiBBdm9pZCB3YWtpbmcgdGhlIGRldmljZSB1cCBpZiB3ZSBjYW4gZmFsbGJhY2ss
IGFzCkBAIC01NDQsMTAgKzU0Nyw4IEBAIGk5MTVfZ2VtX2d0dF9wd3JpdGVfZmFzdChzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkgKiB1c2luZyB0aGUgY2FjaGUgYnlwYXNzIG9m
IGluZGlyZWN0IEdHVFQgYWNjZXNzLgogCQkgKi8KIAkJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVf
cG1fZ2V0X2lmX2luX3VzZShycG0pOwotCQlpZiAoIXdha2VyZWYpIHsKLQkJCXJldCA9IC1FRkFV
TFQ7Ci0JCQlnb3RvIG91dF91bmxvY2s7Ci0JCX0KKwkJaWYgKCF3YWtlcmVmKQorCQkJcmV0dXJu
IC1FRkFVTFQ7CiAJfSBlbHNlIHsKIAkJLyogTm8gYmFja2luZyBwYWdlcywgbm8gZmFsbGJhY2ss
IHdlIG11c3QgZm9yY2UgR0dUVCBhY2Nlc3MgKi8KIAkJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVf
cG1fZ2V0KHJwbSk7CkBAIC01NjksOCArNTcwLDYgQEAgaTkxNV9nZW1fZ3R0X3B3cml0ZV9mYXN0
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCUdFTV9CVUdfT04oIWRybV9tbV9u
b2RlX2FsbG9jYXRlZCgmbm9kZSkpOwogCX0KIAotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7Ci0KIAlyZXQgPSBpOTE1X2dlbV9vYmplY3RfbG9ja19pbnRlcnJ1cHRpYmxl
KG9iaik7CiAJaWYgKHJldCkKIAkJZ290byBvdXRfdW5waW47CkBAIC02MzQsMTggKzYzMywxNSBA
QCBpOTE1X2dlbV9ndHRfcHdyaXRlX2Zhc3Qoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9i
aiwKIAogCWk5MTVfZ2VtX29iamVjdF91bmxvY2tfZmVuY2Uob2JqLCBmZW5jZSk7CiBvdXRfdW5w
aW46Ci0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaW50ZWxfZ3RfZmx1
c2hfZ2d0dF93cml0ZXMoZ2d0dC0+dm0uZ3QpOwogCWlmIChkcm1fbW1fbm9kZV9hbGxvY2F0ZWQo
Jm5vZGUpKSB7CiAJCWdndHQtPnZtLmNsZWFyX3JhbmdlKCZnZ3R0LT52bSwgbm9kZS5zdGFydCwg
bm9kZS5zaXplKTsKLQkJcmVtb3ZlX21hcHBhYmxlX25vZGUoJm5vZGUpOworCQlyZW1vdmVfbWFw
cGFibGVfbm9kZShnZ3R0LCAmbm9kZSk7CiAJfSBlbHNlIHsKIAkJaTkxNV92bWFfdW5waW4odm1h
KTsKIAl9CiBvdXRfcnBtOgogCWludGVsX3J1bnRpbWVfcG1fcHV0KHJwbSwgd2FrZXJlZik7Ci1v
dXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0
dXJuIHJldDsKIH0KIApAQCAtOTY4LDggKzk2NCw2IEBAIGk5MTVfZ2VtX29iamVjdF9nZ3R0X3Bp
bihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCXN0cnVjdCBpOTE1X3ZtYSAqdm1h
OwogCWludCByZXQ7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZvYmotPmJhc2UuZGV2LT5zdHJ1
Y3RfbXV0ZXgpOwotCiAJaWYgKGk5MTVfZ2VtX29iamVjdF9uZXZlcl9iaW5kX2dndHQob2JqKSkK
IAkJcmV0dXJuIEVSUl9QVFIoLUVOT0RFVik7CiAKQEAgLTEwMTksMTMgKzEwMTMsNiBAQCBpOTE1
X2dlbV9vYmplY3RfZ2d0dF9waW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJ
CQlyZXR1cm4gRVJSX1BUUigtRU5PU1BDKTsKIAkJfQogCi0JCVdBUk4oaTkxNV92bWFfaXNfcGlu
bmVkKHZtYSksCi0JCSAgICAgImJvIGlzIGFscmVhZHkgcGlubmVkIGluIGdndHQgd2l0aCBpbmNv
cnJlY3QgYWxpZ25tZW50OiIKLQkJICAgICAiIG9mZnNldD0lMDh4LCByZXEuYWxpZ25tZW50PSVs
bHgsIgotCQkgICAgICIgcmVxLm1hcF9hbmRfZmVuY2VhYmxlPSVkLCB2bWEtPm1hcF9hbmRfZmVu
Y2VhYmxlPSVkXG4iLAotCQkgICAgIGk5MTVfZ2d0dF9vZmZzZXQodm1hKSwgYWxpZ25tZW50LAot
CQkgICAgICEhKGZsYWdzICYgUElOX01BUFBBQkxFKSwKLQkJICAgICBpOTE1X3ZtYV9pc19tYXBf
YW5kX2ZlbmNlYWJsZSh2bWEpKTsKIAkJcmV0ID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CiAJCWlm
IChyZXQpCiAJCQlyZXR1cm4gRVJSX1BUUihyZXQpOwpAQCAtMTQ0NCw4ICsxNDMxLDYgQEAgaW50
IGk5MTVfZ2VtX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCX0KIAog
CWlmIChyZXQgPT0gLUVJTykgewotCQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9t
dXRleCk7Ci0KIAkJLyoKIAkJICogQWxsb3cgZW5naW5lcyBvciB1QyBpbml0aWFsaXNhdGlvbiB0
byBmYWlsIGJ5IG1hcmtpbmcgdGhlIEdQVQogCQkgKiBhcyB3ZWRnZWQuIEJ1dCB3ZSBvbmx5IHdh
bnQgdG8gZG8gdGhpcyB3aGVuIHRoZSBHUFUgaXMgYW5ncnksCkBAIC0xNDYyLDggKzE0NDcsNiBA
QCBpbnQgaTkxNV9nZW1faW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJ
CWk5MTVfZ2VtX3Jlc3RvcmVfZ3R0X21hcHBpbmdzKGRldl9wcml2KTsKIAkJaTkxNV9nZW1fcmVz
dG9yZV9mZW5jZXMoZGV2X3ByaXYpOwogCQlpbnRlbF9pbml0X2Nsb2NrX2dhdGluZyhkZXZfcHJp
dik7Ci0KLQkJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJfQog
CiAJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhkZXZfcHJpdik7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ldmljdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW1fZXZpY3QuYwppbmRleCA4YzFlMDRmNDAyYmMuLjA1NTJiZjkzZWVhMyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZXZpY3QuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ldmljdC5jCkBAIC00Nyw4ICs0Nyw3IEBAIHN0YXRp
YyBpbnQgZ2d0dF9mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkgKiBib3Vu
ZCBieSB0aGVpciBhY3RpdmUgcmVmZXJlbmNlLgogCSAqLwogCXJldHVybiBpOTE1X2dlbV93YWl0
X2Zvcl9pZGxlKGk5MTUsCi0JCQkJICAgICAgSTkxNV9XQUlUX0lOVEVSUlVQVElCTEUgfAotCQkJ
CSAgICAgIEk5MTVfV0FJVF9MT0NLRUQsCisJCQkJICAgICAgSTkxNV9XQUlUX0lOVEVSUlVQVElC
TEUsCiAJCQkJICAgICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwogfQogCkBAIC0xMDQsNyArMTAz
LDcgQEAgaTkxNV9nZW1fZXZpY3Rfc29tZXRoaW5nKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ug
KnZtLAogCXN0cnVjdCBpOTE1X3ZtYSAqYWN0aXZlOwogCWludCByZXQ7CiAKLQlsb2NrZGVwX2Fz
c2VydF9oZWxkKCZ2bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbG9ja2RlcF9hc3NlcnRf
aGVsZCgmdm0tPm11dGV4KTsKIAl0cmFjZV9pOTE1X2dlbV9ldmljdCh2bSwgbWluX3NpemUsIGFs
aWdubWVudCwgZmxhZ3MpOwogCiAJLyoKQEAgLTEyNywxNSArMTI2LDYgQEAgaTkxNV9nZW1fZXZp
Y3Rfc29tZXRoaW5nKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCQkJCSAgICBtaW5f
c2l6ZSwgYWxpZ25tZW50LCBjb2xvciwKIAkJCQkgICAgc3RhcnQsIGVuZCwgbW9kZSk7CiAKLQkv
KgotCSAqIFJldGlyZSBiZWZvcmUgd2Ugc2VhcmNoIHRoZSBhY3RpdmUgbGlzdC4gQWx0aG91Z2gg
d2UgaGF2ZQotCSAqIHJlYXNvbmFibGUgYWNjdXJhY3kgaW4gb3VyIHJldGlyZW1lbnQgbGlzdHMs
IHdlIG1heSBoYXZlCi0JICogYSBzdHJheSBwaW4gKHByZXZlbnRpbmcgZXZpY3Rpb24pIHRoYXQg
Y2FuIG9ubHkgYmUgcmVzb2x2ZWQgYnkKLQkgKiByZXRpcmluZy4KLQkgKi8KLQlpZiAoIShmbGFn
cyAmIFBJTl9OT05CTE9DSykpCi0JCWk5MTVfcmV0aXJlX3JlcXVlc3RzKGRldl9wcml2KTsKLQog
c2VhcmNoX2FnYWluOgogCWFjdGl2ZSA9IE5VTEw7CiAJSU5JVF9MSVNUX0hFQUQoJmV2aWN0aW9u
X2xpc3QpOwpAQCAtMjM1LDEyICsyMjUsMTIgQEAgaTkxNV9nZW1fZXZpY3Rfc29tZXRoaW5nKHN0
cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZSh2
bWEsIG5leHQsICZldmljdGlvbl9saXN0LCBldmljdF9saW5rKSB7CiAJCV9faTkxNV92bWFfdW5w
aW4odm1hKTsKIAkJaWYgKHJldCA9PSAwKQotCQkJcmV0ID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7
CisJCQlyZXQgPSBfX2k5MTVfdm1hX3VuYmluZCh2bWEpOwogCX0KIAogCXdoaWxlIChyZXQgPT0g
MCAmJiAobm9kZSA9IGRybV9tbV9zY2FuX2NvbG9yX2V2aWN0KCZzY2FuKSkpIHsKIAkJdm1hID0g
Y29udGFpbmVyX29mKG5vZGUsIHN0cnVjdCBpOTE1X3ZtYSwgbm9kZSk7Ci0JCXJldCA9IGk5MTVf
dm1hX3VuYmluZCh2bWEpOworCQlyZXQgPSBfX2k5MTVfdm1hX3VuYmluZCh2bWEpOwogCX0KIAog
CXJldHVybiByZXQ7CkBAIC0yNjgsNyArMjU4LDcgQEAgaW50IGk5MTVfZ2VtX2V2aWN0X2Zvcl9u
b2RlKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCXN0cnVjdCBpOTE1X3ZtYSAqdm1h
LCAqbmV4dDsKIAlpbnQgcmV0ID0gMDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5pOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bS0+bXV0ZXgpOwog
CUdFTV9CVUdfT04oIUlTX0FMSUdORUQoc3RhcnQsIEk5MTVfR1RUX1BBR0VfU0laRSkpOwogCUdF
TV9CVUdfT04oIUlTX0FMSUdORUQoZW5kLCBJOTE1X0dUVF9QQUdFX1NJWkUpKTsKIApAQCAtMzQ5
LDcgKzMzOSw3IEBAIGludCBpOTE1X2dlbV9ldmljdF9mb3Jfbm9kZShzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlICp2bSwKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUodm1hLCBuZXh0LCAmZXZp
Y3Rpb25fbGlzdCwgZXZpY3RfbGluaykgewogCQlfX2k5MTVfdm1hX3VucGluKHZtYSk7CiAJCWlm
IChyZXQgPT0gMCkKLQkJCXJldCA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQkJcmV0ID0gX19p
OTE1X3ZtYV91bmJpbmQodm1hKTsKIAl9CiAKIAlyZXR1cm4gcmV0OwpAQCAtMzczLDcgKzM2Myw3
IEBAIGludCBpOTE1X2dlbV9ldmljdF92bShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkK
IAlzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgKm5leHQ7CiAJaW50IHJldDsKIAotCWxvY2tkZXBfYXNz
ZXJ0X2hlbGQoJnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlsb2NrZGVwX2Fzc2VydF9o
ZWxkKCZ2bS0+bXV0ZXgpOwogCXRyYWNlX2k5MTVfZ2VtX2V2aWN0X3ZtKHZtKTsKIAogCS8qIFN3
aXRjaCBiYWNrIHRvIHRoZSBkZWZhdWx0IGNvbnRleHQgaW4gb3JkZXIgdG8gdW5waW4KQEAgLTM4
OCw3ICszNzgsNiBAQCBpbnQgaTkxNV9nZW1fZXZpY3Rfdm0oc3RydWN0IGk5MTVfYWRkcmVzc19z
cGFjZSAqdm0pCiAJfQogCiAJSU5JVF9MSVNUX0hFQUQoJmV2aWN0aW9uX2xpc3QpOwotCW11dGV4
X2xvY2soJnZtLT5tdXRleCk7CiAJbGlzdF9mb3JfZWFjaF9lbnRyeSh2bWEsICZ2bS0+Ym91bmRf
bGlzdCwgdm1fbGluaykgewogCQlpZiAoaTkxNV92bWFfaXNfcGlubmVkKHZtYSkpCiAJCQljb250
aW51ZTsKQEAgLTM5NiwxMyArMzg1LDEyIEBAIGludCBpOTE1X2dlbV9ldmljdF92bShzdHJ1Y3Qg
aTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIAkJX19pOTE1X3ZtYV9waW4odm1hKTsKIAkJbGlzdF9h
ZGQoJnZtYS0+ZXZpY3RfbGluaywgJmV2aWN0aW9uX2xpc3QpOwogCX0KLQltdXRleF91bmxvY2so
JnZtLT5tdXRleCk7CiAKIAlyZXQgPSAwOwogCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZSh2bWEs
IG5leHQsICZldmljdGlvbl9saXN0LCBldmljdF9saW5rKSB7CiAJCV9faTkxNV92bWFfdW5waW4o
dm1hKTsKIAkJaWYgKHJldCA9PSAwKQotCQkJcmV0ID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CisJ
CQlyZXQgPSBfX2k5MTVfdm1hX3VuYmluZCh2bWEpOwogCX0KIAlyZXR1cm4gcmV0OwogfQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZmVuY2VfcmVnLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9mZW5jZV9yZWcuYwppbmRleCA2MTVhOWY0ZWYzMGMu
LjQ4N2I3MjYxZjdlZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1f
ZmVuY2VfcmVnLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZmVuY2VfcmVn
LmMKQEAgLTIzMCwxNCArMjMwLDE1IEBAIHN0YXRpYyBpbnQgZmVuY2VfdXBkYXRlKHN0cnVjdCBp
OTE1X2ZlbmNlX3JlZyAqZmVuY2UsCiAJCQkgaTkxNV9nZW1fb2JqZWN0X2dldF90aWxpbmcodm1h
LT5vYmopKSkKIAkJCXJldHVybiAtRUlOVkFMOwogCi0JCXJldCA9IGk5MTVfYWN0aXZlX3dhaXQo
JnZtYS0+YWN0aXZlKTsKKwkJcmV0ID0gaTkxNV92bWFfc3luYyh2bWEpOwogCQlpZiAocmV0KQog
CQkJcmV0dXJuIHJldDsKIAl9CiAKIAlvbGQgPSB4Y2hnKCZmZW5jZS0+dm1hLCBOVUxMKTsKIAlp
ZiAob2xkKSB7Ci0JCXJldCA9IGk5MTVfYWN0aXZlX3dhaXQoJm9sZC0+YWN0aXZlKTsKKwkJLyog
WFhYIElkZWFsbHkgd2Ugd291bGQgbW92ZSB0aGUgd2FpdGluZyB0byBvdXRzaWRlIHRoZSBtdXRl
eCAqLworCQlyZXQgPSBpOTE1X3ZtYV9zeW5jKG9sZCk7CiAJCWlmIChyZXQpIHsKIAkJCWZlbmNl
LT52bWEgPSBvbGQ7CiAJCQlyZXR1cm4gcmV0OwpAQCAtMzMxLDEzICszMzIsMTUgQEAgc3RhdGlj
IHN0cnVjdCBpOTE1X2ZlbmNlX3JlZyAqZmVuY2VfZmluZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKIAlyZXR1cm4gRVJSX1BUUigtRURFQURMSyk7CiB9CiAKLXN0YXRpYyBpbnQgX19p
OTE1X3ZtYV9waW5fZmVuY2Uoc3RydWN0IGk5MTVfdm1hICp2bWEpCitpbnQgX19pOTE1X3ZtYV9w
aW5fZmVuY2Uoc3RydWN0IGk5MTVfdm1hICp2bWEpCiB7CiAJc3RydWN0IGk5MTVfZ2d0dCAqZ2d0
dCA9IGk5MTVfdm1fdG9fZ2d0dCh2bWEtPnZtKTsKIAlzdHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmZl
bmNlOwogCXN0cnVjdCBpOTE1X3ZtYSAqc2V0ID0gaTkxNV9nZW1fb2JqZWN0X2lzX3RpbGVkKHZt
YS0+b2JqKSA/IHZtYSA6IE5VTEw7CiAJaW50IGVycjsKIAorCWxvY2tkZXBfYXNzZXJ0X2hlbGQo
JnZtYS0+dm0tPm11dGV4KTsKKwogCS8qIEp1c3QgdXBkYXRlIG91ciBwbGFjZSBpbiB0aGUgTFJV
IGlmIG91ciBmZW5jZSBpcyBnZXR0aW5nIHJldXNlZC4gKi8KIAlpZiAodm1hLT5mZW5jZSkgewog
CQlmZW5jZSA9IHZtYS0+ZmVuY2U7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCmluZGV4
IDhlYmE2M2VjZGIwMy4uNTVjZWJmMjU2ZDAzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9n
dHQuYwpAQCAtMTUwLDE2ICsxNTAsMTggQEAgc3RhdGljIHZvaWQgZ21jaF9nZ3R0X2ludmFsaWRh
dGUoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCkKIAogc3RhdGljIGludCBwcGd0dF9iaW5kX3ZtYShz
dHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAkJCSAgZW51bSBpOTE1X2NhY2hlX2xldmVsIGNhY2hlX2xl
dmVsLAotCQkJICB1MzIgdW51c2VkKQorCQkJICB1MzIgZmxhZ3MpCiB7CiAJdTMyIHB0ZV9mbGFn
czsKIAlpbnQgZXJyOwogCi0JaWYgKCFpOTE1X3ZtYV9pc19ib3VuZCh2bWEsIEk5MTVfVk1BX0xP
Q0FMX0JJTkQpKSB7CisJaWYgKGZsYWdzICYgSTkxNV9WTUFfQUxMT0MpIHsKIAkJZXJyID0gdm1h
LT52bS0+YWxsb2NhdGVfdmFfcmFuZ2Uodm1hLT52bSwKIAkJCQkJCSB2bWEtPm5vZGUuc3RhcnQs
IHZtYS0+c2l6ZSk7CiAJCWlmIChlcnIpCiAJCQlyZXR1cm4gZXJyOworCisJCXNldF9iaXQoSTkx
NV9WTUFfQUxMT0NfQklULCBfX2k5MTVfdm1hX2ZsYWdzKHZtYSkpOwogCX0KIAogCS8qIEFwcGxp
Y2FibGUgdG8gVkxWLCBhbmQgZ2VuOCsgKi8KQEAgLTE2Nyw2ICsxNjksNyBAQCBzdGF0aWMgaW50
IHBwZ3R0X2JpbmRfdm1hKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCWlmIChpOTE1X2dlbV9vYmpl
Y3RfaXNfcmVhZG9ubHkodm1hLT5vYmopKQogCQlwdGVfZmxhZ3MgfD0gUFRFX1JFQURfT05MWTsK
IAorCUdFTV9CVUdfT04oIXRlc3RfYml0KEk5MTVfVk1BX0FMTE9DX0JJVCwgX19pOTE1X3ZtYV9m
bGFncyh2bWEpKSk7CiAJdm1hLT52bS0+aW5zZXJ0X2VudHJpZXModm1hLT52bSwgdm1hLCBjYWNo
ZV9sZXZlbCwgcHRlX2ZsYWdzKTsKIAl3bWIoKTsKIApAQCAtMTc1LDcgKzE3OCw4IEBAIHN0YXRp
YyBpbnQgcHBndHRfYmluZF92bWEoc3RydWN0IGk5MTVfdm1hICp2bWEsCiAKIHN0YXRpYyB2b2lk
IHBwZ3R0X3VuYmluZF92bWEoc3RydWN0IGk5MTVfdm1hICp2bWEpCiB7Ci0Jdm1hLT52bS0+Y2xl
YXJfcmFuZ2Uodm1hLT52bSwgdm1hLT5ub2RlLnN0YXJ0LCB2bWEtPnNpemUpOworCWlmICh0ZXN0
X2FuZF9jbGVhcl9iaXQoSTkxNV9WTUFfQUxMT0NfQklULCBfX2k5MTVfdm1hX2ZsYWdzKHZtYSkp
KQorCQl2bWEtPnZtLT5jbGVhcl9yYW5nZSh2bWEtPnZtLCB2bWEtPm5vZGUuc3RhcnQsIHZtYS0+
c2l6ZSk7CiB9CiAKIHN0YXRpYyBpbnQgcHBndHRfc2V0X3BhZ2VzKHN0cnVjdCBpOTE1X3ZtYSAq
dm1hKQpAQCAtNTAzLDE1ICs1MDcsMjYgQEAgc3RhdGljIHZvaWQgaTkxNV9hZGRyZXNzX3NwYWNl
X2Zpbmkoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiAJbXV0ZXhfZGVzdHJveSgmdm0t
Pm11dGV4KTsKIH0KIAotc3RhdGljIHZvaWQgcHBndHRfZGVzdHJveV92bWEoc3RydWN0IGk5MTVf
YWRkcmVzc19zcGFjZSAqdm0pCit2b2lkIF9faTkxNV92bV9jbG9zZShzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlICp2bSkKIHsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgKnZuOwogCi0JbXV0ZXhf
bG9jaygmdm0tPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWxpc3RfZm9yX2VhY2hfZW50cnlf
c2FmZSh2bWEsIHZuLCAmdm0tPmJvdW5kX2xpc3QsIHZtX2xpbmspCisJbXV0ZXhfbG9jaygmdm0t
Pm11dGV4KTsKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUodm1hLCB2biwgJnZtLT5ib3VuZF9s
aXN0LCB2bV9saW5rKSB7CisJCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB2bWEt
Pm9iajsKKworCQkvKiBLZWVwIHRoZSBvYmogKGFuZCBoZW5jZSB0aGUgdm1hKSBhbGl2ZSBhcyBf
d2VfIGRlc3Ryb3kgaXQgKi8KKwkJaWYgKCFrcmVmX2dldF91bmxlc3NfemVybygmb2JqLT5iYXNl
LnJlZmNvdW50KSkKKwkJCWNvbnRpbnVlOworCisJCWF0b21pY19hbmQofkk5MTVfVk1BX1BJTl9N
QVNLLCAmdm1hLT5mbGFncyk7CisJCVdBUk5fT04oX19pOTE1X3ZtYV91bmJpbmQodm1hKSk7CiAJ
CWk5MTVfdm1hX2Rlc3Ryb3kodm1hKTsKKworCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CisJ
fQogCUdFTV9CVUdfT04oIWxpc3RfZW1wdHkoJnZtLT5ib3VuZF9saXN0KSk7Ci0JbXV0ZXhfdW5s
b2NrKCZ2bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZ2bS0+bXV0
ZXgpOwogfQogCiBzdGF0aWMgdm9pZCBfX2k5MTVfdm1fcmVsZWFzZShzdHJ1Y3Qgd29ya19zdHJ1
Y3QgKndvcmspCkBAIC01MTksOCArNTM0LDYgQEAgc3RhdGljIHZvaWQgX19pOTE1X3ZtX3JlbGVh
c2Uoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ug
KnZtID0KIAkJY29udGFpbmVyX29mKHdvcmssIHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UsIHJj
dS53b3JrKTsKIAotCXBwZ3R0X2Rlc3Ryb3lfdm1hKHZtKTsKLQogCXZtLT5jbGVhbnVwKHZtKTsK
IAlpOTE1X2FkZHJlc3Nfc3BhY2VfZmluaSh2bSk7CiAKQEAgLTUzNSw3ICs1NDgsNiBAQCB2b2lk
IGk5MTVfdm1fcmVsZWFzZShzdHJ1Y3Qga3JlZiAqa3JlZikKIAlHRU1fQlVHX09OKGk5MTVfaXNf
Z2d0dCh2bSkpOwogCXRyYWNlX2k5MTVfcHBndHRfcmVsZWFzZSh2bSk7CiAKLQl2bS0+Y2xvc2Vk
ID0gdHJ1ZTsKIAlxdWV1ZV9yY3Vfd29yayh2bS0+aTkxNS0+d3EsICZ2bS0+cmN1KTsKIH0KIApA
QCAtNTQzLDYgKzU1NSw3IEBAIHN0YXRpYyB2b2lkIGk5MTVfYWRkcmVzc19zcGFjZV9pbml0KHN0
cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLCBpbnQgc3ViY2xhc3MpCiB7CiAJa3JlZl9pbml0
KCZ2bS0+cmVmKTsKIAlJTklUX1JDVV9XT1JLKCZ2bS0+cmN1LCBfX2k5MTVfdm1fcmVsZWFzZSk7
CisJYXRvbWljX3NldCgmdm0tPm9wZW4sIDEpOwogCiAJLyoKIAkgKiBUaGUgdm0tPm11dGV4IG11
c3QgYmUgcmVjbGFpbSBzYWZlIChmb3IgdXNlIGluIHRoZSBzaHJpbmtlcikuCkBAIC0xNzcxLDEy
ICsxNzg0LDggQEAgc3RhdGljIHZvaWQgZ2VuNl9wcGd0dF9mcmVlX3BkKHN0cnVjdCBnZW42X3Bw
Z3R0ICpwcGd0dCkKIHN0YXRpYyB2b2lkIGdlbjZfcHBndHRfY2xlYW51cChzdHJ1Y3QgaTkxNV9h
ZGRyZXNzX3NwYWNlICp2bSkKIHsKIAlzdHJ1Y3QgZ2VuNl9wcGd0dCAqcHBndHQgPSB0b19nZW42
X3BwZ3R0KGk5MTVfdm1fdG9fcHBndHQodm0pKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSA9IHZtLT5pOTE1OwogCi0JLyogRklYTUUgcmVtb3ZlIHRoZSBzdHJ1Y3RfbXV0ZXggdG8g
YnJpbmcgdGhlIGxvY2tpbmcgdW5kZXIgY29udHJvbCAqLwotCW11dGV4X2xvY2soJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwogCWk5MTVfdm1hX2Rlc3Ryb3kocHBndHQtPnZtYSk7Ci0JbXV0ZXhf
dW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCWdlbjZfcHBndHRfZnJlZV9wZChw
cGd0dCk7CiAJZnJlZV9zY3JhdGNoKHZtKTsKQEAgLTE4NjUsNyArMTg3NCw4IEBAIHN0YXRpYyBz
dHJ1Y3QgaTkxNV92bWEgKnBkX3ZtYV9jcmVhdGUoc3RydWN0IGdlbjZfcHBndHQgKnBwZ3R0LCBp
bnQgc2l6ZSkKIAogCWk5MTVfYWN0aXZlX2luaXQoaTkxNSwgJnZtYS0+YWN0aXZlLCBOVUxMLCBO
VUxMKTsKIAotCXZtYS0+dm0gPSAmZ2d0dC0+dm07CisJbXV0ZXhfaW5pdCgmdm1hLT5wYWdlc19t
dXRleCk7CisJdm1hLT52bSA9IGk5MTVfdm1fZ2V0KCZnZ3R0LT52bSk7CiAJdm1hLT5vcHMgPSAm
cGRfdm1hX29wczsKIAl2bWEtPnByaXZhdGUgPSBwcGd0dDsKIApAQCAtMTg4NSw3ICsxODk1LDcg
QEAgaW50IGdlbjZfcHBndHRfcGluKHN0cnVjdCBpOTE1X3BwZ3R0ICpiYXNlKQogCXN0cnVjdCBn
ZW42X3BwZ3R0ICpwcGd0dCA9IHRvX2dlbjZfcHBndHQoYmFzZSk7CiAJaW50IGVyciA9IDA7CiAK
LQlHRU1fQlVHX09OKHBwZ3R0LT5iYXNlLnZtLmNsb3NlZCk7CisJR0VNX0JVR19PTighYXRvbWlj
X3JlYWQoJnBwZ3R0LT5iYXNlLnZtLm9wZW4pKTsKIAogCS8qCiAJICogV29ya2Fyb3VuZCB0aGUg
bGltaXRlZCBtYXhpbXVtIHZtYS0+cGluX2NvdW50IGFuZCB0aGUgYWxpYXNpbmdfcHBndHQKQEAg
LTI0NjMsMTQgKzI0NzMsMTggQEAgc3RhdGljIGludCBhbGlhc2luZ19ndHRfYmluZF92bWEoc3Ry
dWN0IGk5MTVfdm1hICp2bWEsCiAJaWYgKGZsYWdzICYgSTkxNV9WTUFfTE9DQUxfQklORCkgewog
CQlzdHJ1Y3QgaTkxNV9wcGd0dCAqYWxpYXMgPSBpOTE1X3ZtX3RvX2dndHQodm1hLT52bSktPmFs
aWFzOwogCi0JCWlmICghaTkxNV92bWFfaXNfYm91bmQodm1hLCBJOTE1X1ZNQV9MT0NBTF9CSU5E
KSkgeworCQlpZiAoZmxhZ3MgJiBJOTE1X1ZNQV9BTExPQykgewogCQkJcmV0ID0gYWxpYXMtPnZt
LmFsbG9jYXRlX3ZhX3JhbmdlKCZhbGlhcy0+dm0sCiAJCQkJCQkJICB2bWEtPm5vZGUuc3RhcnQs
CiAJCQkJCQkJICB2bWEtPnNpemUpOwogCQkJaWYgKHJldCkKIAkJCQlyZXR1cm4gcmV0OworCisJ
CQlzZXRfYml0KEk5MTVfVk1BX0FMTE9DX0JJVCwgX19pOTE1X3ZtYV9mbGFncyh2bWEpKTsKIAkJ
fQogCisJCUdFTV9CVUdfT04oIXRlc3RfYml0KEk5MTVfVk1BX0FMTE9DX0JJVCwKKwkJCQkgICAg
IF9faTkxNV92bWFfZmxhZ3Modm1hKSkpOwogCQlhbGlhcy0+dm0uaW5zZXJ0X2VudHJpZXMoJmFs
aWFzLT52bSwgdm1hLAogCQkJCQkgY2FjaGVfbGV2ZWwsIHB0ZV9mbGFncyk7CiAJfQpAQCAtMjQ5
OSw3ICsyNTEzLDcgQEAgc3RhdGljIHZvaWQgYWxpYXNpbmdfZ3R0X3VuYmluZF92bWEoc3RydWN0
IGk5MTVfdm1hICp2bWEpCiAJCQl2bS0+Y2xlYXJfcmFuZ2Uodm0sIHZtYS0+bm9kZS5zdGFydCwg
dm1hLT5zaXplKTsKIAl9CiAKLQlpZiAoaTkxNV92bWFfaXNfYm91bmQodm1hLCBJOTE1X1ZNQV9M
T0NBTF9CSU5EKSkgeworCWlmICh0ZXN0X2FuZF9jbGVhcl9iaXQoSTkxNV9WTUFfQUxMT0NfQklU
LCBfX2k5MTVfdm1hX2ZsYWdzKHZtYSkpKSB7CiAJCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ug
KnZtID0KIAkJCSZpOTE1X3ZtX3RvX2dndHQodm1hLT52bSktPmFsaWFzLT52bTsKIApAQCAtMjYw
MiwyMiArMjYxNiwxNiBAQCBzdGF0aWMgaW50IGluaXRfYWxpYXNpbmdfcHBndHQoc3RydWN0IGk5
MTVfZ2d0dCAqZ2d0dCkKIAogc3RhdGljIHZvaWQgZmluaV9hbGlhc2luZ19wcGd0dChzdHJ1Y3Qg
aTkxNV9nZ3R0ICpnZ3R0KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ2d0
dC0+dm0uaTkxNTsKIAlzdHJ1Y3QgaTkxNV9wcGd0dCAqcHBndHQ7CiAKLQltdXRleF9sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCXBwZ3R0ID0gZmV0Y2hfYW5kX3plcm8oJmdndHQt
PmFsaWFzKTsKIAlpZiAoIXBwZ3R0KQotCQlnb3RvIG91dDsKKwkJcmV0dXJuOwogCiAJaTkxNV92
bV9wdXQoJnBwZ3R0LT52bSk7CiAKIAlnZ3R0LT52bS52bWFfb3BzLmJpbmRfdm1hICAgPSBnZ3R0
X2JpbmRfdm1hOwogCWdndHQtPnZtLnZtYV9vcHMudW5iaW5kX3ZtYSA9IGdndHRfdW5iaW5kX3Zt
YTsKLQotb3V0OgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiB9CiAK
IHN0YXRpYyBpbnQgZ2d0dF9yZXNlcnZlX2d1Y190b3Aoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCkK
QEAgLTI3MzQsMzIgKzI3NDIsMjggQEAgaW50IGk5MTVfaW5pdF9nZ3R0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogCiBzdGF0aWMgdm9pZCBnZ3R0X2NsZWFudXBfaHcoc3RydWN0IGk5
MTVfZ2d0dCAqZ2d0dCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGdndHQt
PnZtLmk5MTU7CiAJc3RydWN0IGk5MTVfdm1hICp2bWEsICp2bjsKIAotCWdndHQtPnZtLmNsb3Nl
ZCA9IHRydWU7CisJYXRvbWljX3NldCgmZ2d0dC0+dm0ub3BlbiwgMCk7CiAKIAlyY3VfYmFycmll
cigpOyAvKiBmbHVzaCB0aGUgUkNVJ2VkX19pOTE1X3ZtX3JlbGVhc2UgKi8KLQlmbHVzaF93b3Jr
cXVldWUoaTkxNS0+d3EpOworCWZsdXNoX3dvcmtxdWV1ZShnZ3R0LT52bS5pOTE1LT53cSk7CiAK
LQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF9sb2NrKCZnZ3R0
LT52bS5tdXRleCk7CiAKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUodm1hLCB2biwgJmdndHQt
PnZtLmJvdW5kX2xpc3QsIHZtX2xpbmspCi0JCVdBUk5fT04oaTkxNV92bWFfdW5iaW5kKHZtYSkp
OworCQlXQVJOX09OKF9faTkxNV92bWFfdW5iaW5kKHZtYSkpOwogCiAJaWYgKGRybV9tbV9ub2Rl
X2FsbG9jYXRlZCgmZ2d0dC0+ZXJyb3JfY2FwdHVyZSkpCiAJCWRybV9tbV9yZW1vdmVfbm9kZSgm
Z2d0dC0+ZXJyb3JfY2FwdHVyZSk7CiAKIAlnZ3R0X3JlbGVhc2VfZ3VjX3RvcChnZ3R0KTsKLQot
CWlmIChkcm1fbW1faW5pdGlhbGl6ZWQoJmdndHQtPnZtLm1tKSkgewotCQlpbnRlbF92Z3RfZGVi
YWxsb29uKGdndHQpOwotCQlpOTE1X2FkZHJlc3Nfc3BhY2VfZmluaSgmZ2d0dC0+dm0pOwotCX0K
KwlpbnRlbF92Z3RfZGViYWxsb29uKGdndHQpOwogCiAJZ2d0dC0+dm0uY2xlYW51cCgmZ2d0dC0+
dm0pOwogCi0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF91
bmxvY2soJmdndHQtPnZtLm11dGV4KTsKKwlpOTE1X2FkZHJlc3Nfc3BhY2VfZmluaSgmZ2d0dC0+
dm0pOwogCiAJYXJjaF9waHlzX3djX2RlbChnZ3R0LT5tdHJyKTsKIAlpb19tYXBwaW5nX2Zpbmko
JmdndHQtPmlvbWFwKTsKQEAgLTMxODgsOSArMzE5Miw2IEBAIGludCBpOTE1X2dndHRfcHJvYmVf
aHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiBzdGF0aWMgaW50IGdndHRfaW5pdF9o
dyhzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gZ2d0dC0+dm0uaTkxNTsKLQlpbnQgcmV0ID0gMDsKLQotCW11dGV4X2xvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJaTkxNV9hZGRyZXNzX3NwYWNlX2luaXQoJmdndHQtPnZt
LCBWTV9DTEFTU19HR1RUKTsKIApAQCAtMzIwNiwxOCArMzIwNywxNCBAQCBzdGF0aWMgaW50IGdn
dHRfaW5pdF9odyhzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogCQkJCWdndHQtPmdtYWRyLnN0YXJ0
LAogCQkJCWdndHQtPm1hcHBhYmxlX2VuZCkpIHsKIAkJZ2d0dC0+dm0uY2xlYW51cCgmZ2d0dC0+
dm0pOwotCQlyZXQgPSAtRUlPOwotCQlnb3RvIG91dDsKKwkJcmV0dXJuIC1FSU87CiAJfQogCiAJ
Z2d0dC0+bXRyciA9IGFyY2hfcGh5c193Y19hZGQoZ2d0dC0+Z21hZHIuc3RhcnQsIGdndHQtPm1h
cHBhYmxlX2VuZCk7CiAKIAlpOTE1X2dndHRfaW5pdF9mZW5jZXMoZ2d0dCk7CiAKLW91dDoKLQlt
dXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCi0JcmV0dXJuIHJldDsKKwly
ZXR1cm4gMDsKIH0KIAogLyoqCkBAIC0zMjg5LDYgKzMyODYsNyBAQCBzdGF0aWMgdm9pZCBnZ3R0
X3Jlc3RvcmVfbWFwcGluZ3Moc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCkKIHsKIAlzdHJ1Y3QgaTkx
NV92bWEgKnZtYSwgKnZuOwogCWJvb2wgZmx1c2ggPSBmYWxzZTsKKwlpbnQgb3BlbjsKIAogCWlu
dGVsX2d0X2NoZWNrX2FuZF9jbGVhcl9mYXVsdHMoZ2d0dC0+dm0uZ3QpOwogCkBAIC0zMjk2LDcg
KzMyOTQsOSBAQCBzdGF0aWMgdm9pZCBnZ3R0X3Jlc3RvcmVfbWFwcGluZ3Moc3RydWN0IGk5MTVf
Z2d0dCAqZ2d0dCkKIAogCS8qIEZpcnN0IGZpbGwgb3VyIHBvcnRpb24gb2YgdGhlIEdUVCB3aXRo
IHNjcmF0Y2ggcGFnZXMgKi8KIAlnZ3R0LT52bS5jbGVhcl9yYW5nZSgmZ2d0dC0+dm0sIDAsIGdn
dHQtPnZtLnRvdGFsKTsKLQlnZ3R0LT52bS5jbG9zZWQgPSB0cnVlOyAvKiBza2lwIHJld3JpdGlu
ZyBQVEUgb24gVk1BIHVuYmluZCAqLworCisJLyogU2tpcCByZXdyaXRpbmcgUFRFIG9uIFZNQSB1
bmJpbmQuICovCisJb3BlbiA9IGF0b21pY194Y2hnKCZnZ3R0LT52bS5vcGVuLCAwKTsKIAogCS8q
IGNsZmx1c2ggb2JqZWN0cyBib3VuZCBpbnRvIHRoZSBHR1RUIGFuZCByZWJpbmQgdGhlbS4gKi8K
IAlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUodm1hLCB2biwgJmdndHQtPnZtLmJvdW5kX2xpc3Qs
IHZtX2xpbmspIHsKQEAgLTMzMDUsMjQgKzMzMDUsMjAgQEAgc3RhdGljIHZvaWQgZ2d0dF9yZXN0
b3JlX21hcHBpbmdzKHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiAJCWlmICghaTkxNV92bWFfaXNf
Ym91bmQodm1hLCBJOTE1X1ZNQV9HTE9CQUxfQklORCkpCiAJCQljb250aW51ZTsKIAotCQltdXRl
eF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKLQotCQlpZiAoIWk5MTVfdm1hX3VuYmluZCh2bWEp
KQotCQkJZ290byBsb2NrOworCQlpZiAoIV9faTkxNV92bWFfdW5iaW5kKHZtYSkpCisJCQljb250
aW51ZTsKIAorCQljbGVhcl9iaXQoSTkxNV9WTUFfR0xPQkFMX0JJTkRfQklULCBfX2k5MTVfdm1h
X2ZsYWdzKHZtYSkpOwogCQlXQVJOX09OKGk5MTVfdm1hX2JpbmQodm1hLAogCQkJCSAgICAgIG9i
aiA/IG9iai0+Y2FjaGVfbGV2ZWwgOiAwLAotCQkJCSAgICAgIFBJTl9VUERBVEUpKTsKKwkJCQkg
ICAgICBQSU5fR0xPQkFMLCBOVUxMKSk7CiAJCWlmIChvYmopIHsgLyogb25seSB1c2VkIGR1cmlu
ZyByZXN1bWUgPT4gZXhjbHVzaXZlIGFjY2VzcyAqLwogCQkJZmx1c2ggfD0gZmV0Y2hfYW5kX3pl
cm8oJm9iai0+d3JpdGVfZG9tYWluKTsKIAkJCW9iai0+cmVhZF9kb21haW5zIHw9IEk5MTVfR0VN
X0RPTUFJTl9HVFQ7CiAJCX0KLQotbG9jazoKLQkJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgp
OwogCX0KIAotCWdndHQtPnZtLmNsb3NlZCA9IGZhbHNlOworCWF0b21pY19zZXQoJmdndHQtPnZt
Lm9wZW4sIG9wZW4pOwogCWdndHQtPmludmFsaWRhdGUoZ2d0dCk7CiAKIAltdXRleF91bmxvY2so
JmdndHQtPnZtLm11dGV4KTsKQEAgLTM3MTQsNyArMzcxMCw4IEBAIGludCBpOTE1X2dlbV9ndHRf
aW5zZXJ0KHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCXU2NCBvZmZzZXQ7CiAJaW50
IGVycjsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bS0+bXV0ZXgpOworCiAJR0VNX0JVR19PTighc2l6
ZSk7CiAJR0VNX0JVR19PTighSVNfQUxJR05FRChzaXplLCBJOTE1X0dUVF9QQUdFX1NJWkUpKTsK
IAlHRU1fQlVHX09OKGFsaWdubWVudCAmJiAhaXNfcG93ZXJfb2ZfMihhbGlnbm1lbnQpKTsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmgKaW5kZXggMzUwMmI5Yzg1YThlLi4wYTE4ZmRmZTYz
ZmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oCkBAIC0zMDcsNyArMzA3LDE0IEBA
IHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgewogCiAJdW5zaWduZWQgaW50IGJpbmRfYXN5bmNf
ZmxhZ3M7CiAKLQlib29sIGNsb3NlZDsKKwkvKgorCSAqIEVhY2ggYWN0aXZlIHVzZXIgY29udGV4
dCBoYXMgaXRzIG93biBhZGRyZXNzIHNwYWNlIChpbiBmdWxsLXBwZ3R0KS4KKwkgKiBTaW5jZSB0
aGUgdm0gbWF5IGJlIHNoYXJlZCBiZXR3ZWVuIG11bHRpcGxlIGNvbnRleHRzLCB3ZSBjb3VudCBo
b3cKKwkgKiBtYW55IGNvbnRleHRzIGtlZXAgdXMgIm9wZW4iLiBPbmNlIG9wZW4gaGl0cyB6ZXJv
LCB3ZSBhcmUgY2xvc2VkCisJICogYW5kIGRvIG5vdCBhbGxvdyBhbnkgbmV3IGF0dGFjaG1lbnRz
LCBhbmQgcHJvY2VlZCB0byBzaHV0ZG93biBvdXIKKwkgKiB2bWEgYW5kIHBhZ2UgZGlyZWN0b3Jp
ZXMuCisJICovCisJYXRvbWljX3Qgb3BlbjsKIAogCXN0cnVjdCBtdXRleCBtdXRleDsgLyogcHJv
dGVjdHMgdm1hIGFuZCBvdXIgbGlzdHMgKi8KICNkZWZpbmUgVk1fQ0xBU1NfR0dUVCAwCkBAIC01
ODEsNiArNTg4LDM1IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBpOTE1X3ZtX3B1dChzdHJ1Y3QgaTkx
NV9hZGRyZXNzX3NwYWNlICp2bSkKIAlrcmVmX3B1dCgmdm0tPnJlZiwgaTkxNV92bV9yZWxlYXNl
KTsKIH0KIAorc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICoKK2k5MTVf
dm1fb3BlbihzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKK3sKKwlHRU1fQlVHX09OKCFh
dG9taWNfcmVhZCgmdm0tPm9wZW4pKTsKKwlhdG9taWNfaW5jKCZ2bS0+b3Blbik7CisJcmV0dXJu
IGk5MTVfdm1fZ2V0KHZtKTsKK30KKworc3RhdGljIGlubGluZSBib29sCitpOTE1X3ZtX3RyeW9w
ZW4oc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCit7CisJaWYgKGF0b21pY19hZGRfdW5s
ZXNzKCZ2bS0+b3BlbiwgMSwgMCkpCisJCXJldHVybiBpOTE1X3ZtX2dldCh2bSk7CisKKwlyZXR1
cm4gZmFsc2U7Cit9CisKK3ZvaWQgX19pOTE1X3ZtX2Nsb3NlKHN0cnVjdCBpOTE1X2FkZHJlc3Nf
c3BhY2UgKnZtKTsKKworc3RhdGljIGlubGluZSB2b2lkCitpOTE1X3ZtX2Nsb3NlKHN0cnVjdCBp
OTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQoreworCUdFTV9CVUdfT04oIWF0b21pY19yZWFkKCZ2bS0+
b3BlbikpOworCWlmIChhdG9taWNfZGVjX2FuZF90ZXN0KCZ2bS0+b3BlbikpCisJCV9faTkxNV92
bV9jbG9zZSh2bSk7CisKKwlpOTE1X3ZtX3B1dCh2bSk7Cit9CisKIGludCBnZW42X3BwZ3R0X3Bp
bihzdHJ1Y3QgaTkxNV9wcGd0dCAqYmFzZSk7CiB2b2lkIGdlbjZfcHBndHRfdW5waW4oc3RydWN0
IGk5MTVfcHBndHQgKmJhc2UpOwogdm9pZCBnZW42X3BwZ3R0X3VucGluX2FsbChzdHJ1Y3QgaTkx
NV9wcGd0dCAqYmFzZSk7CkBAIC02MTMsMTAgKzY0OSw5IEBAIGludCBpOTE1X2dlbV9ndHRfaW5z
ZXJ0KHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogI2RlZmluZSBQSU5fT0ZGU0VUX0JJ
QVMJCUJJVF9VTEwoNikKICNkZWZpbmUgUElOX09GRlNFVF9GSVhFRAlCSVRfVUxMKDcpCiAKLSNk
ZWZpbmUgUElOX01CWgkJCUJJVF9VTEwoOCkgLyogSTkxNV9WTUFfUElOX09WRVJGTE9XICovCi0j
ZGVmaW5lIFBJTl9HTE9CQUwJCUJJVF9VTEwoOSkgLyogSTkxNV9WTUFfR0xPQkFMX0JJTkQgKi8K
LSNkZWZpbmUgUElOX1VTRVIJCUJJVF9VTEwoMTApIC8qIEk5MTVfVk1BX0xPQ0FMX0JJTkQgKi8K
LSNkZWZpbmUgUElOX1VQREFURQkJQklUX1VMTCgxMSkKKyNkZWZpbmUgUElOX1VQREFURQkJQklU
X1VMTCg5KQorI2RlZmluZSBQSU5fR0xPQkFMCQlCSVRfVUxMKDEwKSAvKiBJOTE1X1ZNQV9HTE9C
QUxfQklORCAqLworI2RlZmluZSBQSU5fVVNFUgkJQklUX1VMTCgxMSkgLyogSTkxNV9WTUFfTE9D
QUxfQklORCAqLwogCiAjZGVmaW5lIFBJTl9PRkZTRVRfTUFTSwkJKC1JOTE1X0dUVF9QQUdFX1NJ
WkUpCiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKaW5kZXggNTI0ZjY3MTBiN2FhLi44MDA1NTUw
MWVjY2IgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCkBAIC0xMjA0LDE1ICsxMjA0LDEwIEBA
IHN0YXRpYyBpbnQgaTkxNV9vYV9yZWFkKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0s
CiBzdGF0aWMgc3RydWN0IGludGVsX2NvbnRleHQgKm9hX3Bpbl9jb250ZXh0KHN0cnVjdCBpOTE1
X3BlcmZfc3RyZWFtICpzdHJlYW0pCiB7CiAJc3RydWN0IGk5MTVfZ2VtX2VuZ2luZXNfaXRlciBp
dDsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHN0cmVhbS0+ZGV2X3ByaXY7CiAJ
c3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IHN0cmVhbS0+Y3R4OwogCXN0cnVjdCBpbnRl
bF9jb250ZXh0ICpjZTsKIAlpbnQgZXJyOwogCi0JZXJyID0gaTkxNV9tdXRleF9sb2NrX2ludGVy
cnVwdGlibGUoJmk5MTUtPmRybSk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIEVSUl9QVFIoZXJyKTsK
LQogCWZvcl9lYWNoX2dlbV9lbmdpbmUoY2UsIGk5MTVfZ2VtX2NvbnRleHRfbG9ja19lbmdpbmVz
KGN0eCksIGl0KSB7CiAJCWlmIChjZS0+ZW5naW5lLT5jbGFzcyAhPSBSRU5ERVJfQ0xBU1MpCiAJ
CQljb250aW51ZTsKQEAgLTEyMjksMTAgKzEyMjQsNiBAQCBzdGF0aWMgc3RydWN0IGludGVsX2Nv
bnRleHQgKm9hX3Bpbl9jb250ZXh0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiAJ
fQogCWk5MTVfZ2VtX2NvbnRleHRfdW5sb2NrX2VuZ2luZXMoY3R4KTsKIAotCW11dGV4X3VubG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIEVSUl9QVFIo
ZXJyKTsKLQogCXJldHVybiBzdHJlYW0tPnBpbm5lZF9jdHg7CiB9CiAKQEAgLTEzMzEsMzIgKzEz
MjIsMjIgQEAgc3RhdGljIGludCBvYV9nZXRfcmVuZGVyX2N0eF9pZChzdHJ1Y3QgaTkxNV9wZXJm
X3N0cmVhbSAqc3RyZWFtKQogICovCiBzdGF0aWMgdm9pZCBvYV9wdXRfcmVuZGVyX2N0eF9pZChz
dHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHN0cmVhbS0+ZGV2X3ByaXY7CiAJc3RydWN0IGludGVsX2NvbnRleHQg
KmNlOwogCiAJc3RyZWFtLT5zcGVjaWZpY19jdHhfaWQgPSBJTlZBTElEX0NUWF9JRDsKIAlzdHJl
YW0tPnNwZWNpZmljX2N0eF9pZF9tYXNrID0gMDsKIAogCWNlID0gZmV0Y2hfYW5kX3plcm8oJnN0
cmVhbS0+cGlubmVkX2N0eCk7Ci0JaWYgKGNlKSB7Ci0JCW11dGV4X2xvY2soJmRldl9wcml2LT5k
cm0uc3RydWN0X211dGV4KTsKKwlpZiAoY2UpCiAJCWludGVsX2NvbnRleHRfdW5waW4oY2UpOwot
CQltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKLQl9CiB9CiAKIHN0
YXRpYyB2b2lkCiBmcmVlX29hX2J1ZmZlcihzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFt
KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gc3RyZWFtLT5kZXZfcHJpdjsK
LQotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJaTkxNV92bWFfdW5w
aW5fYW5kX3JlbGVhc2UoJnN0cmVhbS0+b2FfYnVmZmVyLnZtYSwKIAkJCQkgICBJOTE1X1ZNQV9S
RUxFQVNFX01BUCk7CiAKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwot
CiAJc3RyZWFtLT5vYV9idWZmZXIudmFkZHIgPSBOVUxMOwogfQogCkBAIC0xNTExLDE4ICsxNDky
LDEzIEBAIHN0YXRpYyBpbnQgYWxsb2Nfb2FfYnVmZmVyKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFt
ICpzdHJlYW0pCiAJaWYgKFdBUk5fT04oc3RyZWFtLT5vYV9idWZmZXIudm1hKSkKIAkJcmV0dXJu
IC1FTk9ERVY7CiAKLQlyZXQgPSBpOTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmZGV2X3By
aXYtPmRybSk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQogCUJVSUxEX0JVR19PTl9OT1Rf
UE9XRVJfT0ZfMihPQV9CVUZGRVJfU0laRSk7CiAJQlVJTERfQlVHX09OKE9BX0JVRkZFUl9TSVpF
IDwgU1pfMTI4SyB8fCBPQV9CVUZGRVJfU0laRSA+IFNaXzE2TSk7CiAKIAlibyA9IGk5MTVfZ2Vt
X29iamVjdF9jcmVhdGVfc2htZW0oZGV2X3ByaXYsIE9BX0JVRkZFUl9TSVpFKTsKIAlpZiAoSVNf
RVJSKGJvKSkgewogCQlEUk1fRVJST1IoIkZhaWxlZCB0byBhbGxvY2F0ZSBPQSBidWZmZXJcbiIp
OwotCQlyZXQgPSBQVFJfRVJSKGJvKTsKLQkJZ290byB1bmxvY2s7CisJCXJldHVybiBQVFJfRVJS
KGJvKTsKIAl9CiAKIAlpOTE1X2dlbV9vYmplY3Rfc2V0X2NhY2hlX2NvaGVyZW5jeShibywgSTkx
NV9DQUNIRV9MTEMpOwpAQCAtMTU0Niw3ICsxNTIyLDcgQEAgc3RhdGljIGludCBhbGxvY19vYV9i
dWZmZXIoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIAkJCSBpOTE1X2dndHRfb2Zm
c2V0KHN0cmVhbS0+b2FfYnVmZmVyLnZtYSksCiAJCQkgc3RyZWFtLT5vYV9idWZmZXIudmFkZHIp
OwogCi0JZ290byB1bmxvY2s7CisJcmV0dXJuIDA7CiAKIGVycl91bnBpbjoKIAlfX2k5MTVfdm1h
X3VucGluKHZtYSk7CkBAIC0xNTU3LDggKzE1MzMsNiBAQCBzdGF0aWMgaW50IGFsbG9jX29hX2J1
ZmZlcihzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogCXN0cmVhbS0+b2FfYnVmZmVy
LnZhZGRyID0gTlVMTDsKIAlzdHJlYW0tPm9hX2J1ZmZlci52bWEgPSBOVUxMOwogCi11bmxvY2s6
Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIHJl
dDsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKaW5kZXggZDA5N2Y3Nzg5MGJhLi5mZTkxYTBl
NDdiODggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwpAQCAtMzIsNiArMzIsNyBAQAogCiAjaW5j
bHVkZSAiaTkxNV9kcnYuaCIKICNpbmNsdWRlICJpOTE1X2dsb2JhbHMuaCIKKyNpbmNsdWRlICJp
OTE1X3N3X2ZlbmNlX3dvcmsuaCIKICNpbmNsdWRlICJpOTE1X3RyYWNlLmgiCiAjaW5jbHVkZSAi
aTkxNV92bWEuaCIKIApAQCAtMTEwLDcgKzExMSw4IEBAIHZtYV9jcmVhdGUoc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaiwKIAlpZiAodm1hID09IE5VTEwpCiAJCXJldHVybiBFUlJfUFRS
KC1FTk9NRU0pOwogCi0Jdm1hLT52bSA9IHZtOworCW11dGV4X2luaXQoJnZtYS0+cGFnZXNfbXV0
ZXgpOworCXZtYS0+dm0gPSBpOTE1X3ZtX2dldCh2bSk7CiAJdm1hLT5vcHMgPSAmdm0tPnZtYV9v
cHM7CiAJdm1hLT5vYmogPSBvYmo7CiAJdm1hLT5yZXN2ID0gb2JqLT5iYXNlLnJlc3Y7CkBAIC0y
NjEsOCArMjYzLDYgQEAgdm1hX2xvb2t1cChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
LAogICogT25jZSBjcmVhdGVkLCB0aGUgVk1BIGlzIGtlcHQgdW50aWwgZWl0aGVyIHRoZSBvYmpl
Y3QgaXMgZnJlZWQsIG9yIHRoZQogICogYWRkcmVzcyBzcGFjZSBpcyBjbG9zZWQuCiAgKgotICog
TXVzdCBiZSBjYWxsZWQgd2l0aCBzdHJ1Y3RfbXV0ZXggaGVsZC4KLSAqCiAgKiBSZXR1cm5zIHRo
ZSB2bWEsIG9yIGFuIGVycm9yIHBvaW50ZXIuCiAgKi8KIHN0cnVjdCBpOTE1X3ZtYSAqCkBAIC0y
NzMsNyArMjczLDcgQEAgaTkxNV92bWFfaW5zdGFuY2Uoc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iaiwKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAogCUdFTV9CVUdfT04odmlldyAmJiAh
aTkxNV9pc19nZ3R0KHZtKSk7Ci0JR0VNX0JVR19PTih2bS0+Y2xvc2VkKTsKKwlHRU1fQlVHX09O
KCFhdG9taWNfcmVhZCgmdm0tPm9wZW4pKTsKIAogCXNwaW5fbG9jaygmb2JqLT52bWEubG9jayk7
CiAJdm1hID0gdm1hX2xvb2t1cChvYmosIHZtLCB2aWV3KTsKQEAgLTI4NywxOCArMjg3LDYzIEBA
IGk5MTVfdm1hX2luc3RhbmNlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJcmV0
dXJuIHZtYTsKIH0KIAorc3RydWN0IGk5MTVfdm1hX3dvcmsgeworCXN0cnVjdCBkbWFfZmVuY2Vf
d29yayBiYXNlOworCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOworCWVudW0gaTkxNV9jYWNoZV9sZXZl
bCBjYWNoZV9sZXZlbDsKKwl1bnNpZ25lZCBpbnQgZmxhZ3M7Cit9OworCitzdGF0aWMgaW50IF9f
dm1hX2JpbmQoc3RydWN0IGRtYV9mZW5jZV93b3JrICp3b3JrKQoreworCXN0cnVjdCBpOTE1X3Zt
YV93b3JrICp2dyA9IGNvbnRhaW5lcl9vZih3b3JrLCB0eXBlb2YoKnZ3KSwgYmFzZSk7CisJc3Ry
dWN0IGk5MTVfdm1hICp2bWEgPSB2dy0+dm1hOworCWludCBlcnI7CisKKwllcnIgPSB2bWEtPm9w
cy0+YmluZF92bWEodm1hLCB2dy0+Y2FjaGVfbGV2ZWwsIHZ3LT5mbGFncyk7CisJaWYgKGVycikK
KwkJYXRvbWljX29yKEk5MTVfVk1BX0VSUk9SLCAmdm1hLT5mbGFncyk7CisKKwlpZiAodm1hLT5v
YmopCisJCV9faTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKHZtYS0+b2JqKTsKKworCXJldHVy
biBlcnI7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZG1hX2ZlbmNlX3dvcmtfb3BzIGJpbmRf
b3BzID0geworCS5uYW1lID0gImJpbmQiLAorCS53b3JrID0gX192bWFfYmluZCwKK307CisKK3N0
cnVjdCBpOTE1X3ZtYV93b3JrICppOTE1X3ZtYV93b3JrKHZvaWQpCit7CisJc3RydWN0IGk5MTVf
dm1hX3dvcmsgKnZ3OworCisJdncgPSBremFsbG9jKHNpemVvZigqdncpLCBHRlBfS0VSTkVMKTsK
KwlpZiAoIXZ3KQorCQlyZXR1cm4gTlVMTDsKKworCWRtYV9mZW5jZV93b3JrX2luaXQoJnZ3LT5i
YXNlLCAmYmluZF9vcHMpOworCXZ3LT5iYXNlLmRtYS5lcnJvciA9IC1FQUdBSU47IC8qIGRpc2Fi
bGUgdGhlIHdvcmtlciBieSBkZWZhdWx0ICovCisKKwlyZXR1cm4gdnc7Cit9CisKIC8qKgogICog
aTkxNV92bWFfYmluZCAtIFNldHMgdXAgUFRFcyBmb3IgYW4gVk1BIGluIGl0J3MgY29ycmVzcG9u
ZGluZyBhZGRyZXNzIHNwYWNlLgogICogQHZtYTogVk1BIHRvIG1hcAogICogQGNhY2hlX2xldmVs
OiBtYXBwaW5nIGNhY2hlIGxldmVsCiAgKiBAZmxhZ3M6IGZsYWdzIGxpa2UgZ2xvYmFsIG9yIGxv
Y2FsIG1hcHBpbmcKKyAqIEB3b3JrOiBwcmVhbGxvY2F0ZWQgd29ya2VyIGZvciBhbGxvY2F0aW5n
IGFuZCBiaW5kaW5nIHRoZSBQVEUKICAqCiAgKiBETUEgYWRkcmVzc2VzIGFyZSB0YWtlbiBmcm9t
IHRoZSBzY2F0dGVyLWdhdGhlciB0YWJsZSBvZiB0aGlzIG9iamVjdCAob3Igb2YKICAqIHRoaXMg
Vk1BIGluIGNhc2Ugb2Ygbm9uLWRlZmF1bHQgR0dUVCB2aWV3cykgYW5kIFBURSBlbnRyaWVzIHNl
dCB1cC4KICAqIE5vdGUgdGhhdCBETUEgYWRkcmVzc2VzIGFyZSBhbHNvIHRoZSBvbmx5IHBhcnQg
b2YgdGhlIFNHIHRhYmxlIHdlIGNhcmUgYWJvdXQuCiAgKi8KLWludCBpOTE1X3ZtYV9iaW5kKHN0
cnVjdCBpOTE1X3ZtYSAqdm1hLCBlbnVtIGk5MTVfY2FjaGVfbGV2ZWwgY2FjaGVfbGV2ZWwsCi0J
CSAgdTMyIGZsYWdzKQoraW50IGk5MTVfdm1hX2JpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEsCisJ
CSAgZW51bSBpOTE1X2NhY2hlX2xldmVsIGNhY2hlX2xldmVsLAorCQkgIHUzMiBmbGFncywKKwkJ
ICBzdHJ1Y3QgaTkxNV92bWFfd29yayAqd29yaykKIHsKIAl1MzIgYmluZF9mbGFnczsKIAl1MzIg
dm1hX2ZsYWdzOwpAQCAtMzE1LDExICszNjAsOCBAQCBpbnQgaTkxNV92bWFfYmluZChzdHJ1Y3Qg
aTkxNV92bWEgKnZtYSwgZW51bSBpOTE1X2NhY2hlX2xldmVsIGNhY2hlX2xldmVsLAogCWlmIChH
RU1fREVCVUdfV0FSTl9PTighZmxhZ3MpKQogCQlyZXR1cm4gLUVJTlZBTDsKIAotCWJpbmRfZmxh
Z3MgPSAwOwotCWlmIChmbGFncyAmIFBJTl9HTE9CQUwpCi0JCWJpbmRfZmxhZ3MgfD0gSTkxNV9W
TUFfR0xPQkFMX0JJTkQ7Ci0JaWYgKGZsYWdzICYgUElOX1VTRVIpCi0JCWJpbmRfZmxhZ3MgfD0g
STkxNV9WTUFfTE9DQUxfQklORDsKKwliaW5kX2ZsYWdzID0gZmxhZ3M7CisJYmluZF9mbGFncyAm
PSBJOTE1X1ZNQV9HTE9CQUxfQklORCB8IEk5MTVfVk1BX0xPQ0FMX0JJTkQ7CiAKIAl2bWFfZmxh
Z3MgPSBhdG9taWNfcmVhZCgmdm1hLT5mbGFncyk7CiAJdm1hX2ZsYWdzICY9IEk5MTVfVk1BX0dM
T0JBTF9CSU5EIHwgSTkxNV9WTUFfTE9DQUxfQklORDsKQEAgLTMzMyw5ICszNzUsMzIgQEAgaW50
IGk5MTVfdm1hX2JpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEsIGVudW0gaTkxNV9jYWNoZV9sZXZl
bCBjYWNoZV9sZXZlbCwKIAlHRU1fQlVHX09OKCF2bWEtPnBhZ2VzKTsKIAogCXRyYWNlX2k5MTVf
dm1hX2JpbmQodm1hLCBiaW5kX2ZsYWdzKTsKLQlyZXQgPSB2bWEtPm9wcy0+YmluZF92bWEodm1h
LCBjYWNoZV9sZXZlbCwgYmluZF9mbGFncyk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKKwlp
ZiAod29yayAmJiAoYmluZF9mbGFncyAmIH52bWFfZmxhZ3MpICYgdm1hLT52bS0+YmluZF9hc3lu
Y19mbGFncykgeworCQl3b3JrLT52bWEgPSB2bWE7CisJCXdvcmstPmNhY2hlX2xldmVsID0gY2Fj
aGVfbGV2ZWw7CisJCXdvcmstPmZsYWdzID0gYmluZF9mbGFncyB8IEk5MTVfVk1BX0FMTE9DOwor
CisJCS8qCisJCSAqIE5vdGUgd2Ugb25seSB3YW50IHRvIGNoYWluIHVwIHRvIHRoZSBtaWdyYXRp
b24gZmVuY2Ugb24KKwkJICogdGhlIHBhZ2VzIChub3QgdGhlIG9iamVjdCBpdHNlbGYpLiBBcyB3
ZSBkb24ndCB0cmFjayB0aGF0LAorCQkgKiB5ZXQsIHdlIGhhdmUgdG8gdXNlIHRoZSBleGNsdXNp
dmUgZmVuY2UgaW5zdGVhZC4KKwkJICoKKwkJICogQWxzbyBub3RlIHRoYXQgd2UgZG8gbm90IHdh
bnQgdG8gdHJhY2sgdGhlIGFzeW5jIHZtYSBhcworCQkgKiBwYXJ0IG9mIHRoZSBvYmotPnJlc3Yt
PmV4Y2xfZmVuY2UgYXMgaXQgb25seSBhZmZlY3RzCisJCSAqIGV4ZWN1dGlvbiBhbmQgbm90IGNv
bnRlbnQgb3Igb2JqZWN0J3MgYmFja2luZyBzdG9yZSBsaWZldGltZS4KKwkJICovCisJCUdFTV9C
VUdfT04oaTkxNV9hY3RpdmVfaGFzX2V4Y2x1c2l2ZSgmdm1hLT5hY3RpdmUpKTsKKwkJaTkxNV9h
Y3RpdmVfc2V0X2V4Y2x1c2l2ZSgmdm1hLT5hY3RpdmUsICZ3b3JrLT5iYXNlLmRtYSk7CisJCXdv
cmstPmJhc2UuZG1hLmVycm9yID0gMDsgLyogZW5hYmxlIHRoZSBxdWV1ZV93b3JrKCkgKi8KKwor
CQlpZiAodm1hLT5vYmopCisJCQlfX2k5MTVfZ2VtX29iamVjdF9waW5fcGFnZXModm1hLT5vYmop
OworCX0gZWxzZSB7CisJCUdFTV9CVUdfT04oKGJpbmRfZmxhZ3MgJiB+dm1hX2ZsYWdzKSAmIHZt
YS0+dm0tPmJpbmRfYXN5bmNfZmxhZ3MpOworCQlyZXQgPSB2bWEtPm9wcy0+YmluZF92bWEodm1h
LCBjYWNoZV9sZXZlbCwgYmluZF9mbGFncyk7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gcmV0Owor
CX0KIAogCWF0b21pY19vcihiaW5kX2ZsYWdzLCAmdm1hLT5mbGFncyk7CiAJcmV0dXJuIDA7CkBA
IC0zNDgsOSArNDEzLDcgQEAgdm9pZCBfX2lvbWVtICppOTE1X3ZtYV9waW5faW9tYXAoc3RydWN0
IGk5MTVfdm1hICp2bWEpCiAKIAkvKiBBY2Nlc3MgdGhyb3VnaCB0aGUgR1RUIHJlcXVpcmVzIHRo
ZSBkZXZpY2UgdG8gYmUgYXdha2UuICovCiAJYXNzZXJ0X3JwbV93YWtlbG9ja19oZWxkKCZ2bWEt
PnZtLT5pOTE1LT5ydW50aW1lX3BtKTsKLQotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0t
Pmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChXQVJOX09OKCFpOTE1X3ZtYV9pc19tYXBf
YW5kX2ZlbmNlYWJsZSh2bWEpKSkgeworCWlmIChHRU1fV0FSTl9PTighaTkxNV92bWFfaXNfbWFw
X2FuZF9mZW5jZWFibGUodm1hKSkpIHsKIAkJZXJyID0gLUVOT0RFVjsKIAkJZ290byBlcnI7CiAJ
fQpAQCAtMzU4LDcgKzQyMSw3IEBAIHZvaWQgX19pb21lbSAqaTkxNV92bWFfcGluX2lvbWFwKHN0
cnVjdCBpOTE1X3ZtYSAqdm1hKQogCUdFTV9CVUdfT04oIWk5MTVfdm1hX2lzX2dndHQodm1hKSk7
CiAJR0VNX0JVR19PTighaTkxNV92bWFfaXNfYm91bmQodm1hLCBJOTE1X1ZNQV9HTE9CQUxfQklO
RCkpOwogCi0JcHRyID0gdm1hLT5pb21hcDsKKwlwdHIgPSBSRUFEX09OQ0Uodm1hLT5pb21hcCk7
CiAJaWYgKHB0ciA9PSBOVUxMKSB7CiAJCXB0ciA9IGlvX21hcHBpbmdfbWFwX3djKCZpOTE1X3Zt
X3RvX2dndHQodm1hLT52bSktPmlvbWFwLAogCQkJCQl2bWEtPm5vZGUuc3RhcnQsCkBAIC0zNjgs
NyArNDMxLDEwIEBAIHZvaWQgX19pb21lbSAqaTkxNV92bWFfcGluX2lvbWFwKHN0cnVjdCBpOTE1
X3ZtYSAqdm1hKQogCQkJZ290byBlcnI7CiAJCX0KIAotCQl2bWEtPmlvbWFwID0gcHRyOworCQlp
ZiAodW5saWtlbHkoY21weGNoZygmdm1hLT5pb21hcCwgTlVMTCwgcHRyKSkpIHsKKwkJCWlvX21h
cHBpbmdfdW5tYXAocHRyKTsKKwkJCXB0ciA9IHZtYS0+aW9tYXA7CisJCX0KIAl9CiAKIAlfX2k5
MTVfdm1hX3Bpbih2bWEpOwpAQCAtMzg4LDE4ICs0NTQsMTIgQEAgdm9pZCBfX2lvbWVtICppOTE1
X3ZtYV9waW5faW9tYXAoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAKIHZvaWQgaTkxNV92bWFfZmx1
c2hfd3JpdGVzKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewotCWlmICghaTkxNV92bWFfaGFzX2dn
dHRfd3JpdGUodm1hKSkKLQkJcmV0dXJuOwotCi0JaW50ZWxfZ3RfZmx1c2hfZ2d0dF93cml0ZXMo
dm1hLT52bS0+Z3QpOwotCi0JaTkxNV92bWFfdW5zZXRfZ2d0dF93cml0ZSh2bWEpOworCWlmIChp
OTE1X3ZtYV91bnNldF9nZ3R0X3dyaXRlKHZtYSkpCisJCWludGVsX2d0X2ZsdXNoX2dndHRfd3Jp
dGVzKHZtYS0+dm0tPmd0KTsKIH0KIAogdm9pZCBpOTE1X3ZtYV91bnBpbl9pb21hcChzdHJ1Y3Qg
aTkxNV92bWEgKnZtYSkKIHsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bWEtPnZtLT5pOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKLQogCUdFTV9CVUdfT04odm1hLT5pb21hcCA9PSBOVUxMKTsKIAog
CWk5MTVfdm1hX2ZsdXNoX3dyaXRlcyh2bWEpOwpAQCAtNDM1LDYgKzQ5NSw5IEBAIGJvb2wgaTkx
NV92bWFfbWlzcGxhY2VkKGNvbnN0IHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCWlmICghZHJtX21t
X25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKQogCQlyZXR1cm4gZmFsc2U7CiAKKwlpZiAodGVz
dF9iaXQoSTkxNV9WTUFfRVJST1JfQklULCBfX2k5MTVfdm1hX2ZsYWdzKHZtYSkpKQorCQlyZXR1
cm4gdHJ1ZTsKKwogCWlmICh2bWEtPm5vZGUuc2l6ZSA8IHNpemUpCiAJCXJldHVybiB0cnVlOwog
CkBAIC01MzUsNyArNTk4LDYgQEAgc3RhdGljIHZvaWQgYXNzZXJ0X2JpbmRfY291bnQoY29uc3Qg
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHN0YXRpYyBpbnQKIGk5MTVfdm1hX2lu
c2VydChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBm
bGFncykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB2bWEtPnZtLT5p
OTE1OwogCXVuc2lnbmVkIGxvbmcgY29sb3I7CiAJdTY0IHN0YXJ0LCBlbmQ7CiAJaW50IHJldDsK
QEAgLTU2MSw3ICs2MjMsNyBAQCBpOTE1X3ZtYV9pbnNlcnQoc3RydWN0IGk5MTVfdm1hICp2bWEs
IHU2NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3MpCiAKIAllbmQgPSB2bWEtPnZtLT50
b3RhbDsKIAlpZiAoZmxhZ3MgJiBQSU5fTUFQUEFCTEUpCi0JCWVuZCA9IG1pbl90KHU2NCwgZW5k
LCBkZXZfcHJpdi0+Z2d0dC5tYXBwYWJsZV9lbmQpOworCQllbmQgPSBtaW5fdCh1NjQsIGVuZCwg
aTkxNV92bV90b19nZ3R0KHZtYS0+dm0pLT5tYXBwYWJsZV9lbmQpOwogCWlmIChmbGFncyAmIFBJ
Tl9aT05FXzRHKQogCQllbmQgPSBtaW5fdCh1NjQsIGVuZCwgKDFVTEwgPDwgMzIpIC0gSTkxNV9H
VFRfUEFHRV9TSVpFKTsKIAlHRU1fQlVHX09OKCFJU19BTElHTkVEKGVuZCwgSTkxNV9HVFRfUEFH
RV9TSVpFKSk7CkBAIC01NzgsMzQgKzY0MCwyMCBAQCBpOTE1X3ZtYV9pbnNlcnQoc3RydWN0IGk5
MTVfdm1hICp2bWEsIHU2NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3MpCiAJfQogCiAJ
Y29sb3IgPSAwOwotCWlmICh2bWEtPm9iaikgewotCQlyZXQgPSBpOTE1X2dlbV9vYmplY3RfcGlu
X3BhZ2VzKHZtYS0+b2JqKTsKLQkJaWYgKHJldCkKLQkJCXJldHVybiByZXQ7Ci0KLQkJaWYgKGk5
MTVfdm1faGFzX2NhY2hlX2NvbG9yaW5nKHZtYS0+dm0pKQotCQkJY29sb3IgPSB2bWEtPm9iai0+
Y2FjaGVfbGV2ZWw7Ci0JfQotCi0JR0VNX0JVR19PTih2bWEtPnBhZ2VzKTsKLQotCXJldCA9IHZt
YS0+b3BzLT5zZXRfcGFnZXModm1hKTsKLQlpZiAocmV0KQotCQlnb3RvIGVycl91bnBpbjsKKwlp
ZiAodm1hLT5vYmogJiYgaTkxNV92bV9oYXNfY2FjaGVfY29sb3Jpbmcodm1hLT52bSkpCisJCWNv
bG9yID0gdm1hLT5vYmotPmNhY2hlX2xldmVsOwogCiAJaWYgKGZsYWdzICYgUElOX09GRlNFVF9G
SVhFRCkgewogCQl1NjQgb2Zmc2V0ID0gZmxhZ3MgJiBQSU5fT0ZGU0VUX01BU0s7CiAJCWlmICgh
SVNfQUxJR05FRChvZmZzZXQsIGFsaWdubWVudCkgfHwKLQkJICAgIHJhbmdlX292ZXJmbG93cyhv
ZmZzZXQsIHNpemUsIGVuZCkpIHsKLQkJCXJldCA9IC1FSU5WQUw7Ci0JCQlnb3RvIGVycl9jbGVh
cjsKLQkJfQorCQkgICAgcmFuZ2Vfb3ZlcmZsb3dzKG9mZnNldCwgc2l6ZSwgZW5kKSkKKwkJCXJl
dHVybiAtRUlOVkFMOwogCiAJCXJldCA9IGk5MTVfZ2VtX2d0dF9yZXNlcnZlKHZtYS0+dm0sICZ2
bWEtPm5vZGUsCiAJCQkJCSAgIHNpemUsIG9mZnNldCwgY29sb3IsCiAJCQkJCSAgIGZsYWdzKTsK
IAkJaWYgKHJldCkKLQkJCWdvdG8gZXJyX2NsZWFyOworCQkJcmV0dXJuIHJldDsKIAl9IGVsc2Ug
ewogCQkvKgogCQkgKiBXZSBvbmx5IHN1cHBvcnQgaHVnZSBndHQgcGFnZXMgdGhyb3VnaCB0aGUg
NDhiIFBQR1RULApAQCAtNjQ0LDcgKzY5Miw3IEBAIGk5MTVfdm1hX2luc2VydChzdHJ1Y3QgaTkx
NV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncykKIAkJCQkJICBz
aXplLCBhbGlnbm1lbnQsIGNvbG9yLAogCQkJCQkgIHN0YXJ0LCBlbmQsIGZsYWdzKTsKIAkJaWYg
KHJldCkKLQkJCWdvdG8gZXJyX2NsZWFyOworCQkJcmV0dXJuIHJldDsKIAogCQlHRU1fQlVHX09O
KHZtYS0+bm9kZS5zdGFydCA8IHN0YXJ0KTsKIAkJR0VNX0JVR19PTih2bWEtPm5vZGUuc3RhcnQg
KyB2bWEtPm5vZGUuc2l6ZSA+IGVuZCk7CkBAIC02NTIsMjMgKzcwMCwxNSBAQCBpOTE1X3ZtYV9p
bnNlcnQoc3RydWN0IGk5MTVfdm1hICp2bWEsIHU2NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQg
ZmxhZ3MpCiAJR0VNX0JVR19PTighZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKTsK
IAlHRU1fQlVHX09OKCFpOTE1X2dlbV92YWxpZF9ndHRfc3BhY2Uodm1hLCBjb2xvcikpOwogCi0J
bXV0ZXhfbG9jaygmdm1hLT52bS0+bXV0ZXgpOwogCWxpc3RfYWRkX3RhaWwoJnZtYS0+dm1fbGlu
aywgJnZtYS0+dm0tPmJvdW5kX2xpc3QpOwotCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgp
OwogCiAJaWYgKHZtYS0+b2JqKSB7CisJCWF0b21pY19pbmMoJnZtYS0+b2JqLT5tbS5wYWdlc19w
aW5fY291bnQpOwogCQlhdG9taWNfaW5jKCZ2bWEtPm9iai0+YmluZF9jb3VudCk7CiAJCWFzc2Vy
dF9iaW5kX2NvdW50KHZtYS0+b2JqKTsKIAl9CiAKIAlyZXR1cm4gMDsKLQotZXJyX2NsZWFyOgot
CXZtYS0+b3BzLT5jbGVhcl9wYWdlcyh2bWEpOwotZXJyX3VucGluOgotCWlmICh2bWEtPm9iaikK
LQkJaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKHZtYS0+b2JqKTsKLQlyZXR1cm4gcmV0Owog
fQogCiBzdGF0aWMgdm9pZApAQCAtNjc3LDEyICs3MTcsNyBAQCBpOTE1X3ZtYV9yZW1vdmUoc3Ry
dWN0IGk5MTVfdm1hICp2bWEpCiAJR0VNX0JVR19PTighZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2
bWEtPm5vZGUpKTsKIAlHRU1fQlVHX09OKGk5MTVfdm1hX2lzX2JvdW5kKHZtYSwgSTkxNV9WTUFf
R0xPQkFMX0JJTkQgfCBJOTE1X1ZNQV9MT0NBTF9CSU5EKSk7CiAKLQl2bWEtPm9wcy0+Y2xlYXJf
cGFnZXModm1hKTsKLQotCW11dGV4X2xvY2soJnZtYS0+dm0tPm11dGV4KTsKLQlkcm1fbW1fcmVt
b3ZlX25vZGUoJnZtYS0+bm9kZSk7CiAJbGlzdF9kZWwoJnZtYS0+dm1fbGluayk7Ci0JbXV0ZXhf
dW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CiAKIAkvKgogCSAqIFNpbmNlIHRoZSB1bmJvdW5kIGxp
c3QgaXMgZ2xvYmFsLCBvbmx5IG1vdmUgdG8gdGhhdCBsaXN0IGlmCkBAIC03MDEsNTEgKzczNiwy
MTEgQEAgaTkxNV92bWFfcmVtb3ZlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCQlpOTE1X2dlbV9v
YmplY3RfdW5waW5fcGFnZXMob2JqKTsKIAkJYXNzZXJ0X2JpbmRfY291bnQob2JqKTsKIAl9CisK
Kwlkcm1fbW1fcmVtb3ZlX25vZGUoJnZtYS0+bm9kZSk7CiB9CiAKLWludCBfX2k5MTVfdm1hX2Rv
X3BpbihzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKLQkJICAgICAgdTY0IHNpemUsIHU2NCBhbGlnbm1l
bnQsIHU2NCBmbGFncykKK3N0YXRpYyBib29sIHRyeV9xYWRfcGluKHN0cnVjdCBpOTE1X3ZtYSAq
dm1hLCB1bnNpZ25lZCBpbnQgZmxhZ3MpCiB7Ci0JY29uc3QgdW5zaWduZWQgaW50IGJvdW5kID0g
YXRvbWljX3JlYWQoJnZtYS0+ZmxhZ3MpOwotCWludCByZXQ7CisJdW5zaWduZWQgaW50IGJvdW5k
OworCWJvb2wgcGlubmVkID0gdHJ1ZTsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0t
Pmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCUdFTV9CVUdfT04oKGZsYWdzICYgKFBJTl9HTE9C
QUwgfCBQSU5fVVNFUikpID09IDApOwotCUdFTV9CVUdfT04oKGZsYWdzICYgUElOX0dMT0JBTCkg
JiYgIWk5MTVfdm1hX2lzX2dndHQodm1hKSk7CisJYm91bmQgPSBhdG9taWNfcmVhZCgmdm1hLT5m
bGFncyk7CisJZG8geworCQlpZiAodW5saWtlbHkoZmxhZ3MgJiB+Ym91bmQpKQorCQkJcmV0dXJu
IGZhbHNlOwogCi0JaWYgKFdBUk5fT04oYm91bmQgJiBJOTE1X1ZNQV9QSU5fT1ZFUkZMT1cpKSB7
Ci0JCXJldCA9IC1FQlVTWTsKLQkJZ290byBlcnJfdW5waW47CisJCWlmICh1bmxpa2VseShib3Vu
ZCAmIChJOTE1X1ZNQV9PVkVSRkxPVyB8IEk5MTVfVk1BX0VSUk9SKSkpCisJCQlyZXR1cm4gZmFs
c2U7CisKKwkJaWYgKCEoYm91bmQgJiBJOTE1X1ZNQV9QSU5fTUFTSykpCisJCQlnb3RvIHVucGlu
bmVkOworCisJCUdFTV9CVUdfT04oKChib3VuZCArIDEpICYgSTkxNV9WTUFfUElOX01BU0spID09
IDApOworCX0gd2hpbGUgKCFhdG9taWNfdHJ5X2NtcHhjaGcoJnZtYS0+ZmxhZ3MsICZib3VuZCwg
Ym91bmQgKyAxKSk7CisKKwlyZXR1cm4gdHJ1ZTsKKwordW5waW5uZWQ6CisJLyoKKwkgKiBJZiBw
aW5fY291bnQ9PTAsIGJ1dCB3ZSBhcmUgYm91bmQsIGNoZWNrIHVuZGVyIHRoZSBsb2NrIHRvIGF2
b2lkCisJICogcmFjaW5nIHdpdGggYSBjb25jdXJyZW50IGk5MTVfdm1hX3VuYmluZCgpLgorCSAq
LworCW11dGV4X2xvY2soJnZtYS0+dm0tPm11dGV4KTsKKwlkbyB7CisJCWlmICh1bmxpa2VseShi
b3VuZCAmIChJOTE1X1ZNQV9PVkVSRkxPVyB8IEk5MTVfVk1BX0VSUk9SKSkpIHsKKwkJCXBpbm5l
ZCA9IGZhbHNlOworCQkJYnJlYWs7CisJCX0KKworCQlpZiAodW5saWtlbHkoZmxhZ3MgJiB+Ym91
bmQpKSB7CisJCQlwaW5uZWQgPSBmYWxzZTsKKwkJCWJyZWFrOworCQl9CisJfSB3aGlsZSAoIWF0
b21pY190cnlfY21weGNoZygmdm1hLT5mbGFncywgJmJvdW5kLCBib3VuZCArIDEpKTsKKwltdXRl
eF91bmxvY2soJnZtYS0+dm0tPm11dGV4KTsKKworCXJldHVybiBwaW5uZWQ7Cit9CisKK3N0YXRp
YyBpbnQgdm1hX2dldF9wYWdlcyhzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKK3sKKwlpbnQgZXJyID0g
MDsKKworCWlmIChhdG9taWNfYWRkX3VubGVzcygmdm1hLT5wYWdlc19jb3VudCwgMSwgMCkpCisJ
CXJldHVybiAwOworCisJLyogQWxsb2NhdGlvbnMgYWhveSEgKi8KKwlpZiAobXV0ZXhfbG9ja19p
bnRlcnJ1cHRpYmxlKCZ2bWEtPnBhZ2VzX211dGV4KSkKKwkJcmV0dXJuIC1FSU5UUjsKKworCWlm
ICghYXRvbWljX3JlYWQoJnZtYS0+cGFnZXNfY291bnQpKSB7CisJCWlmICh2bWEtPm9iaikgewor
CQkJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9wYWdlcyh2bWEtPm9iaik7CisJCQlpZiAoZXJy
KQorCQkJCWdvdG8gdW5sb2NrOworCQl9CisKKwkJZXJyID0gdm1hLT5vcHMtPnNldF9wYWdlcyh2
bWEpOworCQlpZiAoZXJyKQorCQkJZ290byB1bmxvY2s7CiAJfQorCWF0b21pY19pbmMoJnZtYS0+
cGFnZXNfY291bnQpOwogCi0JaWYgKChib3VuZCAmIEk5MTVfVk1BX0JJTkRfTUFTSykgPT0gMCkg
ewotCQlyZXQgPSBpOTE1X3ZtYV9pbnNlcnQodm1hLCBzaXplLCBhbGlnbm1lbnQsIGZsYWdzKTsK
LQkJaWYgKHJldCkKLQkJCWdvdG8gZXJyX3VucGluOwordW5sb2NrOgorCW11dGV4X3VubG9jaygm
dm1hLT5wYWdlc19tdXRleCk7CisKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgdm9pZCBfX3Zt
YV9wdXRfcGFnZXMoc3RydWN0IGk5MTVfdm1hICp2bWEsIHVuc2lnbmVkIGludCBjb3VudCkKK3sK
KwkvKiBXZSBhbGxvY2F0ZSB1bmRlciB2bWFfZ2V0X3BhZ2VzLCBzbyBiZXdhcmUgdGhlIHNocmlu
a2VyICovCisJbXV0ZXhfbG9ja19uZXN0ZWQoJnZtYS0+cGFnZXNfbXV0ZXgsIFNJTkdMRV9ERVBU
SF9ORVNUSU5HKTsKKwlHRU1fQlVHX09OKGF0b21pY19yZWFkKCZ2bWEtPnBhZ2VzX2NvdW50KSA8
IGNvdW50KTsKKwlpZiAoYXRvbWljX3N1Yl9yZXR1cm4oY291bnQsICZ2bWEtPnBhZ2VzX2NvdW50
KSA9PSAwKSB7CisJCXZtYS0+b3BzLT5jbGVhcl9wYWdlcyh2bWEpOworCQlHRU1fQlVHX09OKHZt
YS0+cGFnZXMpOworCQlpZiAodm1hLT5vYmopCisJCQlpOTE1X2dlbV9vYmplY3RfdW5waW5fcGFn
ZXModm1hLT5vYmopOwogCX0KLQlHRU1fQlVHX09OKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZt
YS0+bm9kZSkpOworCW11dGV4X3VubG9jaygmdm1hLT5wYWdlc19tdXRleCk7Cit9CiAKLQlyZXQg
PSBpOTE1X3ZtYV9iaW5kKHZtYSwgdm1hLT5vYmogPyB2bWEtPm9iai0+Y2FjaGVfbGV2ZWwgOiAw
LCBmbGFncyk7Ci0JaWYgKHJldCkKLQkJZ290byBlcnJfcmVtb3ZlOworc3RhdGljIHZvaWQgdm1h
X3B1dF9wYWdlcyhzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKK3sKKwlpZiAoYXRvbWljX2FkZF91bmxl
c3MoJnZtYS0+cGFnZXNfY291bnQsIC0xLCAxKSkKKwkJcmV0dXJuOworCisJX192bWFfcHV0X3Bh
Z2VzKHZtYSwgMSk7Cit9CisKK3N0YXRpYyB2b2lkIHZtYV91bmJpbmRfcGFnZXMoc3RydWN0IGk5
MTVfdm1hICp2bWEpCit7CisJdW5zaWduZWQgaW50IGNvdW50OworCisJbG9ja2RlcF9hc3NlcnRf
aGVsZCgmdm1hLT52bS0+bXV0ZXgpOworCisJLyogVGhlIHVwcGVyIHBvcnRpb24gb2YgcGFnZXNf
Y291bnQgaXMgdGhlIG51bWJlciBvZiBiaW5kaW5ncyAqLworCWNvdW50ID0gYXRvbWljX3JlYWQo
JnZtYS0+cGFnZXNfY291bnQpOworCWNvdW50ID4+PSBJOTE1X1ZNQV9QQUdFU19CSUFTOworCUdF
TV9CVUdfT04oIWNvdW50KTsKKworCV9fdm1hX3B1dF9wYWdlcyh2bWEsIGNvdW50IHwgY291bnQg
PDwgSTkxNV9WTUFfUEFHRVNfQklBUyk7Cit9CisKK2ludCBpOTE1X3ZtYV9waW4oc3RydWN0IGk5
MTVfdm1hICp2bWEsIHU2NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3MpCit7CisJc3Ry
dWN0IGk5MTVfdm1hX3dvcmsgKndvcmsgPSBOVUxMOworCXVuc2lnbmVkIGludCBib3VuZDsKKwlp
bnQgZXJyOworCisJQlVJTERfQlVHX09OKFBJTl9HTE9CQUwgIT0gSTkxNV9WTUFfR0xPQkFMX0JJ
TkQpOworCUJVSUxEX0JVR19PTihQSU5fVVNFUiAhPSBJOTE1X1ZNQV9MT0NBTF9CSU5EKTsKKwor
CUdFTV9CVUdfT04oZmxhZ3MgJiBQSU5fVVBEQVRFKTsKKwlHRU1fQlVHX09OKCEoZmxhZ3MgJiAo
UElOX1VTRVIgfCBQSU5fR0xPQkFMKSkpOworCisJLyogRmlyc3QgdHJ5IGFuZCBncmFiIHRoZSBw
aW4gd2l0aG91dCByZWJpbmRpbmcgdGhlIHZtYSAqLworCWlmICh0cnlfcWFkX3Bpbih2bWEsIGZs
YWdzICYgSTkxNV9WTUFfQklORF9NQVNLKSkKKwkJcmV0dXJuIDA7CisKKwllcnIgPSB2bWFfZ2V0
X3BhZ2VzKHZtYSk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWlmIChmbGFncyAmIHZt
YS0+dm0tPmJpbmRfYXN5bmNfZmxhZ3MpIHsKKwkJd29yayA9IGk5MTVfdm1hX3dvcmsoKTsKKwkJ
aWYgKCF3b3JrKSB7CisJCQllcnIgPSAtRU5PTUVNOworCQkJZ290byBlcnJfcGFnZXM7CisJCX0K
Kwl9CisKKwkvKiBObyBtb3JlIGFsbG9jYXRpb25zIGFsbG93ZWQgb25jZSB3ZSBob2xkIHZtLT5t
dXRleCAqLworCWVyciA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmdm1hLT52bS0+bXV0ZXgp
OworCWlmIChlcnIpCisJCWdvdG8gZXJyX2ZlbmNlOworCisJYm91bmQgPSBhdG9taWNfcmVhZCgm
dm1hLT5mbGFncyk7CisJaWYgKHVubGlrZWx5KGJvdW5kICYgSTkxNV9WTUFfRVJST1IpKSB7CisJ
CWVyciA9IC1FTk9NRU07CisJCWdvdG8gZXJyX3VubG9jazsKKwl9CisKKwlpZiAodW5saWtlbHko
ISgoYm91bmQgKyAxKSAmIEk5MTVfVk1BX1BJTl9NQVNLKSkpIHsKKwkJZXJyID0gLUVBR0FJTjsg
LyogcGlucyBhcmUgbWVhbnQgdG8gYmUgZmFpcmx5IHRlbXBvcmFyeSAqLworCQlnb3RvIGVycl91
bmxvY2s7CisJfQorCisJaWYgKHVubGlrZWx5KCEoZmxhZ3MgJiB+Ym91bmQgJiBJOTE1X1ZNQV9C
SU5EX01BU0spKSkgeworCQlfX2k5MTVfdm1hX3Bpbih2bWEpOworCQlnb3RvIGVycl91bmxvY2s7
CisJfQorCisJZXJyID0gaTkxNV9hY3RpdmVfYWNxdWlyZSgmdm1hLT5hY3RpdmUpOworCWlmIChl
cnIpCisJCWdvdG8gZXJyX3VubG9jazsKKworCWlmICghKGJvdW5kICYgSTkxNV9WTUFfQklORF9N
QVNLKSkgeworCQllcnIgPSBpOTE1X3ZtYV9pbnNlcnQodm1hLCBzaXplLCBhbGlnbm1lbnQsIGZs
YWdzKTsKKwkJaWYgKGVycikKKwkJCWdvdG8gZXJyX2FjdGl2ZTsKKworCQlpZiAoaTkxNV9pc19n
Z3R0KHZtYS0+dm0pKQorCQkJX19pOTE1X3ZtYV9zZXRfbWFwX2FuZF9mZW5jZWFibGUodm1hKTsK
Kwl9CiAKLQlHRU1fQlVHX09OKCFpOTE1X3ZtYV9pc19ib3VuZCh2bWEsIEk5MTVfVk1BX0JJTkRf
TUFTSykpOworCUdFTV9CVUdfT04oIXZtYS0+cGFnZXMpOworCWVyciA9IGk5MTVfdm1hX2JpbmQo
dm1hLAorCQkJICAgIHZtYS0+b2JqID8gdm1hLT5vYmotPmNhY2hlX2xldmVsIDogMCwKKwkJCSAg
ICBmbGFncywgd29yayk7CisJaWYgKGVycikKKwkJZ290byBlcnJfcmVtb3ZlOwogCi0JaWYgKChi
b3VuZCBeIGF0b21pY19yZWFkKCZ2bWEtPmZsYWdzKSkgJiBJOTE1X1ZNQV9HTE9CQUxfQklORCkK
LQkJX19pOTE1X3ZtYV9zZXRfbWFwX2FuZF9mZW5jZWFibGUodm1hKTsKKwkvKiBUaGVyZSBzaG91
bGQgb25seSBiZSBhdCBtb3N0IDIgYWN0aXZlIGJpbmRpbmdzICh1c2VyLCBnbG9iYWwpICovCisJ
R0VNX0JVR19PTihib3VuZCArIEk5MTVfVk1BX1BBR0VTX0FDVElWRSA8IGJvdW5kKTsKKwlhdG9t
aWNfYWRkKEk5MTVfVk1BX1BBR0VTX0FDVElWRSwgJnZtYS0+cGFnZXNfY291bnQpOworCWxpc3Rf
bW92ZV90YWlsKCZ2bWEtPnZtX2xpbmssICZ2bWEtPnZtLT5ib3VuZF9saXN0KTsKIAorCV9faTkx
NV92bWFfcGluKHZtYSk7CisJR0VNX0JVR19PTighaTkxNV92bWFfaXNfcGlubmVkKHZtYSkpOwor
CUdFTV9CVUdfT04oIWk5MTVfdm1hX2lzX2JvdW5kKHZtYSwgZmxhZ3MpKTsKIAlHRU1fQlVHX09O
KGk5MTVfdm1hX21pc3BsYWNlZCh2bWEsIHNpemUsIGFsaWdubWVudCwgZmxhZ3MpKTsKLQlyZXR1
cm4gMDsKIAogZXJyX3JlbW92ZToKLQlpZiAoKGJvdW5kICYgSTkxNV9WTUFfQklORF9NQVNLKSA9
PSAwKSB7CisJaWYgKCFpOTE1X3ZtYV9pc19ib3VuZCh2bWEsIEk5MTVfVk1BX0JJTkRfTUFTSykp
CiAJCWk5MTVfdm1hX3JlbW92ZSh2bWEpOwotCQlHRU1fQlVHX09OKHZtYS0+cGFnZXMpOwotCQlH
RU1fQlVHX09OKGF0b21pY19yZWFkKCZ2bWEtPmZsYWdzKSAmIEk5MTVfVk1BX0JJTkRfTUFTSyk7
Ci0JfQotZXJyX3VucGluOgotCV9faTkxNV92bWFfdW5waW4odm1hKTsKLQlyZXR1cm4gcmV0Owor
ZXJyX2FjdGl2ZToKKwlpOTE1X2FjdGl2ZV9yZWxlYXNlKCZ2bWEtPmFjdGl2ZSk7CitlcnJfdW5s
b2NrOgorCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOworZXJyX2ZlbmNlOgorCWlmICh3
b3JrKQorCQlkbWFfZmVuY2Vfd29ya19jb21taXQoJndvcmstPmJhc2UpOworZXJyX3BhZ2VzOgor
CXZtYV9wdXRfcGFnZXModm1hKTsKKwlyZXR1cm4gZXJyOwogfQogCiB2b2lkIGk5MTVfdm1hX2Ns
b3NlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQpAQCAtNzc2LDkgKzk3MSw2IEBAIHN0YXRpYyB2b2lk
IF9faTkxNV92bWFfcmVtb3ZlX2Nsb3NlZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHZtYS0+dm0tPmk5MTU7CiAKLQlpZiAoIWk5MTVf
dm1hX2lzX2Nsb3NlZCh2bWEpKQotCQlyZXR1cm47Ci0KIAlzcGluX2xvY2tfaXJxKCZpOTE1LT5n
dC5jbG9zZWRfbG9jayk7CiAJbGlzdF9kZWxfaW5pdCgmdm1hLT5jbG9zZWRfbGluayk7CiAJc3Bp
bl91bmxvY2tfaXJxKCZpOTE1LT5ndC5jbG9zZWRfbG9jayk7CkBAIC03ODYsNDAgKzk3OCwzNSBA
QCBzdGF0aWMgdm9pZCBfX2k5MTVfdm1hX3JlbW92ZV9jbG9zZWQoc3RydWN0IGk5MTVfdm1hICp2
bWEpCiAKIHZvaWQgaTkxNV92bWFfcmVvcGVuKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewotCV9f
aTkxNV92bWFfcmVtb3ZlX2Nsb3NlZCh2bWEpOworCWlmIChpOTE1X3ZtYV9pc19jbG9zZWQodm1h
KSkKKwkJX19pOTE1X3ZtYV9yZW1vdmVfY2xvc2VkKHZtYSk7CiB9CiAKLXN0YXRpYyB2b2lkIF9f
aTkxNV92bWFfZGVzdHJveShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKK3ZvaWQgaTkxNV92bWFfZGVz
dHJveShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKLQlHRU1fQlVHX09OKGRybV9tbV9ub2RlX2Fs
bG9jYXRlZCgmdm1hLT5ub2RlKSk7Ci0JR0VNX0JVR19PTih2bWEtPmZlbmNlKTsKKwlpZiAoZHJt
X21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKSB7CisJCW11dGV4X2xvY2soJnZtYS0+dm0t
Pm11dGV4KTsKKwkJYXRvbWljX2FuZCh+STkxNV9WTUFfUElOX01BU0ssICZ2bWEtPmZsYWdzKTsK
KwkJV0FSTl9PTihfX2k5MTVfdm1hX3VuYmluZCh2bWEpKTsKKwkJbXV0ZXhfdW5sb2NrKCZ2bWEt
PnZtLT5tdXRleCk7CisJCUdFTV9CVUdfT04oZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5v
ZGUpKTsKKwl9CisJR0VNX0JVR19PTihpOTE1X3ZtYV9pc19hY3RpdmUodm1hKSk7CiAKIAlpZiAo
dm1hLT5vYmopIHsKIAkJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IHZtYS0+b2Jq
OwogCiAJCXNwaW5fbG9jaygmb2JqLT52bWEubG9jayk7CiAJCWxpc3RfZGVsKCZ2bWEtPm9ial9s
aW5rKTsKLQkJcmJfZXJhc2UoJnZtYS0+b2JqX25vZGUsICZ2bWEtPm9iai0+dm1hLnRyZWUpOwor
CQlyYl9lcmFzZSgmdm1hLT5vYmpfbm9kZSwgJm9iai0+dm1hLnRyZWUpOwogCQlzcGluX3VubG9j
aygmb2JqLT52bWEubG9jayk7CiAJfQogCi0JaTkxNV9hY3RpdmVfZmluaSgmdm1hLT5hY3RpdmUp
OwotCi0JaTkxNV92bWFfZnJlZSh2bWEpOwotfQotCi12b2lkIGk5MTVfdm1hX2Rlc3Ryb3koc3Ry
dWN0IGk5MTVfdm1hICp2bWEpCi17Ci0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm1hLT52bS0+aTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQlHRU1fQlVHX09OKGk5MTVfdm1hX2lzX3Bpbm5lZCh2
bWEpKTsKLQogCV9faTkxNV92bWFfcmVtb3ZlX2Nsb3NlZCh2bWEpOworCWk5MTVfdm1fcHV0KHZt
YS0+dm0pOwogCi0JV0FSTl9PTihpOTE1X3ZtYV91bmJpbmQodm1hKSk7Ci0JR0VNX0JVR19PTihp
OTE1X3ZtYV9pc19hY3RpdmUodm1hKSk7Ci0KLQlfX2k5MTVfdm1hX2Rlc3Ryb3kodm1hKTsKKwlp
OTE1X2FjdGl2ZV9maW5pKCZ2bWEtPmFjdGl2ZSk7CisJaTkxNV92bWFfZnJlZSh2bWEpOwogfQog
CiB2b2lkIGk5MTVfdm1hX3BhcmtlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKQEAg
LTgyOCwxMiArMTAxNSwzMiBAQCB2b2lkIGk5MTVfdm1hX3BhcmtlZChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIAogCXNwaW5fbG9ja19pcnEoJmk5MTUtPmd0LmNsb3NlZF9sb2NrKTsK
IAlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUodm1hLCBuZXh0LCAmaTkxNS0+Z3QuY2xvc2VkX3Zt
YSwgY2xvc2VkX2xpbmspIHsKLQkJbGlzdF9kZWxfaW5pdCgmdm1hLT5jbG9zZWRfbGluayk7CisJ
CXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB2bWEtPm9iajsKKwkJc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqdm0gPSB2bWEtPnZtOworCisJCS8qIFhYWCBBbGwgdG8gYXZvaWQg
a2VlcGluZyBhIHJlZmVyZW5jZSBvbiBpOTE1X3ZtYSBpdHNlbGYgKi8KKworCQlpZiAoIWtyZWZf
Z2V0X3VubGVzc196ZXJvKCZvYmotPmJhc2UucmVmY291bnQpKQorCQkJY29udGludWU7CisKKwkJ
aWYgKCFpOTE1X3ZtX3RyeW9wZW4odm0pKSB7CisJCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7
CisJCQlvYmogPSBOVUxMOworCQl9CisKIAkJc3Bpbl91bmxvY2tfaXJxKCZpOTE1LT5ndC5jbG9z
ZWRfbG9jayk7CiAKLQkJaTkxNV92bWFfZGVzdHJveSh2bWEpOworCQlpZiAob2JqKSB7CisJCQlp
OTE1X3ZtYV9kZXN0cm95KHZtYSk7CisJCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CisJCX0K
IAorCQlpOTE1X3ZtX2Nsb3NlKHZtKTsKKworCQkvKiBSZXN0YXJ0IGFmdGVyIGRyb3BwaW5nIGxv
Y2sgKi8KIAkJc3Bpbl9sb2NrX2lycSgmaTkxNS0+Z3QuY2xvc2VkX2xvY2spOworCQluZXh0ID0g
bGlzdF9maXJzdF9lbnRyeSgmaTkxNS0+Z3QuY2xvc2VkX3ZtYSwKKwkJCQkJdHlwZW9mKCpuZXh0
KSwgY2xvc2VkX2xpbmspOwogCX0KIAlzcGluX3VubG9ja19pcnEoJmk5MTUtPmd0LmNsb3NlZF9s
b2NrKTsKIH0KQEAgLTg3Myw2ICsxMDgwLDIwIEBAIHZvaWQgaTkxNV92bWFfcmV2b2tlX21tYXAo
c3RydWN0IGk5MTVfdm1hICp2bWEpCiAJCWxpc3RfZGVsKCZ2bWEtPm9iai0+dXNlcmZhdWx0X2xp
bmspOwogfQogCitpbnQgX19pOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShzdHJ1Y3QgaTkxNV92bWEg
KnZtYSwgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCit7CisJaW50IGVycjsKKworCUdFTV9CVUdf
T04oIWk5MTVfdm1hX2lzX3Bpbm5lZCh2bWEpKTsKKworCS8qIFdhaXQgZm9yIHRoZSB2bWEgdG8g
YmUgYm91bmQgYmVmb3JlIHdlIHN0YXJ0ISAqLworCWVyciA9IGk5MTVfcmVxdWVzdF9hd2FpdF9h
Y3RpdmUocnEsICZ2bWEtPmFjdGl2ZSk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCXJl
dHVybiBpOTE1X2FjdGl2ZV9hZGRfcmVxdWVzdCgmdm1hLT5hY3RpdmUsIHJxKTsKK30KKwogaW50
IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCQkJICAgIHN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAogCQkJICAgIHVuc2lnbmVkIGludCBmbGFncykKQEAgLTg4
MCwxOSArMTEwMSw5IEBAIGludCBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShzdHJ1Y3QgaTkxNV92
bWEgKnZtYSwKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gdm1hLT5vYmo7CiAJ
aW50IGVycjsKIAotCWFzc2VydF92bWFfaGVsZCh2bWEpOwogCWFzc2VydF9vYmplY3RfaGVsZChv
YmopOwotCUdFTV9CVUdfT04oIWRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5ub2RlKSk7CiAK
LQkvKgotCSAqIEFkZCBhIHJlZmVyZW5jZSBpZiB3ZSdyZSBuZXdseSBlbnRlcmluZyB0aGUgYWN0
aXZlIGxpc3QuCi0JICogVGhlIG9yZGVyIGluIHdoaWNoIHdlIGFkZCBvcGVyYXRpb25zIHRvIHRo
ZSByZXRpcmVtZW50IHF1ZXVlIGlzCi0JICogdml0YWwgaGVyZTogbWFya19hY3RpdmUgYWRkcyB0
byB0aGUgc3RhcnQgb2YgdGhlIGNhbGxiYWNrIGxpc3QsCi0JICogc3VjaCB0aGF0IHN1YnNlcXVl
bnQgY2FsbGJhY2tzIGFyZSBjYWxsZWQgZmlyc3QuIFRoZXJlZm9yZSB3ZQotCSAqIGFkZCB0aGUg
YWN0aXZlIHJlZmVyZW5jZSBmaXJzdCBhbmQgcXVldWUgZm9yIGl0IHRvIGJlIGRyb3BwZWQKLQkg
KiAqbGFzdCouCi0JICovCi0JZXJyID0gaTkxNV9hY3RpdmVfYWRkX3JlcXVlc3QoJnZtYS0+YWN0
aXZlLCBycSk7CisJZXJyID0gX19pOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZSh2bWEsIHJxKTsKIAlp
ZiAodW5saWtlbHkoZXJyKSkKIAkJcmV0dXJuIGVycjsKIApAQCAtOTE4LDM4ICsxMTI5LDIzIEBA
IGludCBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAlyZXR1
cm4gMDsKIH0KIAotaW50IGk5MTVfdm1hX3VuYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKK2lu
dCBfX2k5MTVfdm1hX3VuYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKIAlpbnQgcmV0Owog
Ci0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm1hLT52bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm1hLT52bS0+bXV0ZXgpOwogCiAJLyoKIAkgKiBGaXJz
dCB3YWl0IHVwb24gYW55IGFjdGl2aXR5IGFzIHJldGlyaW5nIHRoZSByZXF1ZXN0IG1heQogCSAq
IGhhdmUgc2lkZS1lZmZlY3RzIHN1Y2ggYXMgdW5waW5uaW5nIG9yIGV2ZW4gdW5iaW5kaW5nIHRo
aXMgdm1hLgorCSAqCisJICogWFhYIEFjdHVhbGx5IHdhaXRpbmcgdW5kZXIgdGhlIHZtLT5tdXRl
eCBpcyBhIGhpbmRlcmFuY2UgYW5kCisJICogc2hvdWxkIGJlIHBpcGVsaW5lZCB3aGVyZXZlciBw
b3NzaWJsZS4gSW4gY2FzZXMgd2hlcmUgdGhhdCBpcworCSAqIHVuYXZvaWRhYmxlLCB3ZSBzaG91
bGQgbGlmdCB0aGUgd2FpdCB0byBiZWZvcmUgdGhlIG11dGV4LgogCSAqLwotCW1pZ2h0X3NsZWVw
KCk7Ci0JaWYgKGk5MTVfdm1hX2lzX2FjdGl2ZSh2bWEpKSB7Ci0JCS8qCi0JCSAqIFdoZW4gYSBj
bG9zZWQgVk1BIGlzIHJldGlyZWQsIGl0IGlzIHVuYm91bmQgLSBlZWsuCi0JCSAqIEluIG9yZGVy
IHRvIHByZXZlbnQgaXQgZnJvbSBiZWluZyByZWN1cnNpdmVseSBjbG9zZWQsCi0JCSAqIHRha2Ug
YSBwaW4gb24gdGhlIHZtYSBzbyB0aGF0IHRoZSBzZWNvbmQgdW5iaW5kIGlzCi0JCSAqIGFib3J0
ZWQuCi0JCSAqCi0JCSAqIEV2ZW4gbW9yZSBzY2FyeSBpcyB0aGF0IHRoZSByZXRpcmUgY2FsbGJh
Y2sgbWF5IGZyZWUKLQkJICogdGhlIG9iamVjdCAobGFzdCBhY3RpdmUgdm1hKS4gVG8gcHJldmVu
dCB0aGUgZXhwbG9zaW9uCi0JCSAqIHdlIGRlZmVyIHRoZSBhY3R1YWwgb2JqZWN0IGZyZWUgdG8g
YSB3b3JrZXIgdGhhdCBjYW4KLQkJICogb25seSBwcm9jZWVkIG9uY2UgaXQgYWNxdWlyZXMgdGhl
IHN0cnVjdF9tdXRleCAod2hpY2gKLQkJICogd2UgY3VycmVudGx5IGhvbGQsIHRoZXJlZm9yZSBp
dCBjYW5ub3QgZnJlZSB0aGlzIG9iamVjdAotCQkgKiBiZWZvcmUgd2UgYXJlIGZpbmlzaGVkKS4K
LQkJICovCi0JCV9faTkxNV92bWFfcGluKHZtYSk7Ci0JCXJldCA9IGk5MTVfYWN0aXZlX3dhaXQo
JnZtYS0+YWN0aXZlKTsKLQkJX19pOTE1X3ZtYV91bnBpbih2bWEpOwotCQlpZiAocmV0KQotCQkJ
cmV0dXJuIHJldDsKLQl9Ci0JR0VNX0JVR19PTihpOTE1X3ZtYV9pc19hY3RpdmUodm1hKSk7CisJ
cmV0ID0gaTkxNV92bWFfc3luYyh2bWEpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CiAKIAlp
ZiAoaTkxNV92bWFfaXNfcGlubmVkKHZtYSkpIHsKIAkJdm1hX3ByaW50X2FsbG9jYXRvcih2bWEs
ICJpcyBwaW5uZWQiKTsKQEAgLTk3MCwxNiArMTE2NiwxMiBAQCBpbnQgaTkxNV92bWFfdW5iaW5k
KHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCQlHRU1fQlVHX09OKGk5MTVfdm1hX2hhc19nZ3R0X3dy
aXRlKHZtYSkpOwogCiAJCS8qIHJlbGVhc2UgdGhlIGZlbmNlIHJlZyBfYWZ0ZXJfIGZsdXNoaW5n
ICovCi0JCW11dGV4X2xvY2soJnZtYS0+dm0tPm11dGV4KTsKIAkJcmV0ID0gaTkxNV92bWFfcmV2
b2tlX2ZlbmNlKHZtYSk7Ci0JCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOwogCQlpZiAo
cmV0KQogCQkJcmV0dXJuIHJldDsKIAogCQkvKiBGb3JjZSBhIHBhZ2VmYXVsdCBmb3IgZG9tYWlu
IHRyYWNraW5nIG9uIG5leHQgdXNlciBhY2Nlc3MgKi8KLQkJbXV0ZXhfbG9jaygmdm1hLT52bS0+
bXV0ZXgpOwogCQlpOTE1X3ZtYV9yZXZva2VfbW1hcCh2bWEpOwotCQltdXRleF91bmxvY2soJnZt
YS0+dm0tPm11dGV4KTsKIAogCQlfX2k5MTVfdm1hX2lvdW5tYXAodm1hKTsKIAkJY2xlYXJfYml0
KEk5MTVfVk1BX0NBTl9GRU5DRV9CSVQsIF9faTkxNV92bWFfZmxhZ3Modm1hKSk7CkBAIC05ODcs
MTcgKzExNzksMzMgQEAgaW50IGk5MTVfdm1hX3VuYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkK
IAlHRU1fQlVHX09OKHZtYS0+ZmVuY2UpOwogCUdFTV9CVUdfT04oaTkxNV92bWFfaGFzX3VzZXJm
YXVsdCh2bWEpKTsKIAotCWlmIChsaWtlbHkoIXZtYS0+dm0tPmNsb3NlZCkpIHsKKwlpZiAobGlr
ZWx5KGF0b21pY19yZWFkKCZ2bWEtPnZtLT5vcGVuKSkpIHsKIAkJdHJhY2VfaTkxNV92bWFfdW5i
aW5kKHZtYSk7CiAJCXZtYS0+b3BzLT51bmJpbmRfdm1hKHZtYSk7CiAJfQotCWF0b21pY19hbmQo
fkk5MTVfVk1BX0JJTkRfTUFTSywgJnZtYS0+ZmxhZ3MpOworCWF0b21pY19hbmQofihJOTE1X1ZN
QV9CSU5EX01BU0sgfCBJOTE1X1ZNQV9FUlJPUiksICZ2bWEtPmZsYWdzKTsKIAorCXZtYV91bmJp
bmRfcGFnZXModm1hKTsKIAlpOTE1X3ZtYV9yZW1vdmUodm1hKTsKIAogCXJldHVybiAwOwogfQog
CitpbnQgaTkxNV92bWFfdW5iaW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQoreworCXN0cnVjdCBp
OTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gdm1hLT52bTsKKwlpbnQgZXJyOworCisJZXJyID0gbXV0
ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZ2bS0+bXV0ZXgpOworCWlmIChlcnIpCisJCXJldHVybiBl
cnI7CisKKwllcnIgPSBfX2k5MTVfdm1hX3VuYmluZCh2bWEpOworCW11dGV4X3VubG9jaygmdm0t
Pm11dGV4KTsKKworCXJldHVybiBlcnI7Cit9CisKIHN0cnVjdCBpOTE1X3ZtYSAqaTkxNV92bWFf
bWFrZV91bnNocmlua2FibGUoc3RydWN0IGk5MTVfdm1hICp2bWEpCiB7CiAJaTkxNV9nZW1fb2Jq
ZWN0X21ha2VfdW5zaHJpbmthYmxlKHZtYS0+b2JqKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfdm1hLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5oCmlu
ZGV4IGU0OWIxOTlmN2RlNy4uODU4OTA4ZTNkMWNjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3ZtYS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmgK
QEAgLTk2LDI1ICs5NiwyOCBAQCBzdHJ1Y3QgaTkxNV92bWEgewogCSAqIGV4Y2x1c2l2ZSBjYWNo
ZWxpbmVzIG9mIGEgc2luZ2xlIHBhZ2UsIHNvIGEgbWF4aW11bSBvZiA2NCBwb3NzaWJsZQogCSAq
IHVzZXJzLgogCSAqLwotI2RlZmluZSBJOTE1X1ZNQV9QSU5fTUFTSyAweGZmCi0jZGVmaW5lIEk5
MTVfVk1BX1BJTl9PVkVSRkxPV19CSVQgOAotI2RlZmluZSBJOTE1X1ZNQV9QSU5fT1ZFUkZMT1cJ
KChpbnQpQklUKEk5MTVfVk1BX1BJTl9PVkVSRkxPV19CSVQpKQorI2RlZmluZSBJOTE1X1ZNQV9Q
SU5fTUFTSyAweDNmZgorI2RlZmluZSBJOTE1X1ZNQV9PVkVSRkxPVyAweDIwMAogCiAJLyoqIEZs
YWdzIGFuZCBhZGRyZXNzIHNwYWNlIHRoaXMgVk1BIGlzIGJvdW5kIHRvICovCi0jZGVmaW5lIEk5
MTVfVk1BX0dMT0JBTF9CSU5EX0JJVCA5Ci0jZGVmaW5lIEk5MTVfVk1BX0xPQ0FMX0JJTkRfQklU
IDEwCisjZGVmaW5lIEk5MTVfVk1BX0dMT0JBTF9CSU5EX0JJVCAxMAorI2RlZmluZSBJOTE1X1ZN
QV9MT0NBTF9CSU5EX0JJVCAgMTEKIAogI2RlZmluZSBJOTE1X1ZNQV9HTE9CQUxfQklORAkoKGlu
dClCSVQoSTkxNV9WTUFfR0xPQkFMX0JJTkRfQklUKSkKICNkZWZpbmUgSTkxNV9WTUFfTE9DQUxf
QklORAkoKGludClCSVQoSTkxNV9WTUFfTE9DQUxfQklORF9CSVQpKQogCi0jZGVmaW5lIEk5MTVf
Vk1BX0JJTkRfTUFTSyAoSTkxNV9WTUFfR0xPQkFMX0JJTkQgfCBcCi0JCQkgICAgSTkxNV9WTUFf
TE9DQUxfQklORCB8IFwKLQkJCSAgICBJOTE1X1ZNQV9QSU5fT1ZFUkZMT1cpCisjZGVmaW5lIEk5
MTVfVk1BX0JJTkRfTUFTSyAoSTkxNV9WTUFfR0xPQkFMX0JJTkQgfCBJOTE1X1ZNQV9MT0NBTF9C
SU5EKQogCi0jZGVmaW5lIEk5MTVfVk1BX0dHVFRfQklUCTExCi0jZGVmaW5lIEk5MTVfVk1BX0NB
Tl9GRU5DRV9CSVQJMTIKLSNkZWZpbmUgSTkxNV9WTUFfVVNFUkZBVUxUX0JJVAkxMwotI2RlZmlu
ZSBJOTE1X1ZNQV9HR1RUX1dSSVRFX0JJVAkxNAorI2RlZmluZSBJOTE1X1ZNQV9BTExPQ19CSVQJ
MTIKKyNkZWZpbmUgSTkxNV9WTUFfQUxMT0MJCSgoaW50KUJJVChJOTE1X1ZNQV9BTExPQ19CSVQp
KQorCisjZGVmaW5lIEk5MTVfVk1BX0VSUk9SX0JJVAkxMworI2RlZmluZSBJOTE1X1ZNQV9FUlJP
UgkJKChpbnQpQklUKEk5MTVfVk1BX0VSUk9SX0JJVCkpCisKKyNkZWZpbmUgSTkxNV9WTUFfR0dU
VF9CSVQJMTQKKyNkZWZpbmUgSTkxNV9WTUFfQ0FOX0ZFTkNFX0JJVAkxNQorI2RlZmluZSBJOTE1
X1ZNQV9VU0VSRkFVTFRfQklUCTE2CisjZGVmaW5lIEk5MTVfVk1BX0dHVFRfV1JJVEVfQklUCTE3
CiAKICNkZWZpbmUgSTkxNV9WTUFfR0dUVAkJKChpbnQpQklUKEk5MTVfVk1BX0dHVFRfQklUKSkK
ICNkZWZpbmUgSTkxNV9WTUFfQ0FOX0ZFTkNFCSgoaW50KUJJVChJOTE1X1ZNQV9DQU5fRkVOQ0Vf
QklUKSkKQEAgLTEyMyw2ICsxMjYsMTEgQEAgc3RydWN0IGk5MTVfdm1hIHsKIAogCXN0cnVjdCBp
OTE1X2FjdGl2ZSBhY3RpdmU7CiAKKyNkZWZpbmUgSTkxNV9WTUFfUEFHRVNfQklBUyAyNAorI2Rl
ZmluZSBJOTE1X1ZNQV9QQUdFU19BQ1RJVkUgKEJJVCgyNCkgfCAxKQorCWF0b21pY190IHBhZ2Vz
X2NvdW50OyAvKiBudW1iZXIgb2YgYWN0aXZlIGJpbmRzIHRvIHRoZSBwYWdlcyAqLworCXN0cnVj
dCBtdXRleCBwYWdlc19tdXRleDsgLyogcHJvdGVjdCBhY3F1aXJlL3JlbGVhc2Ugb2YgYmFja2lu
ZyBwYWdlcyAqLworCiAJLyoqCiAJICogU3VwcG9ydCBkaWZmZXJlbnQgR0dUVCB2aWV3cyBpbnRv
IHRoZSBzYW1lIG9iamVjdC4KIAkgKiBUaGlzIG1lYW5zIHRoZXJlIGNhbiBiZSBtdWx0aXBsZSBW
TUEgbWFwcGluZ3MgcGVyIG9iamVjdCBhbmQgcGVyIFZNLgpAQCAtMTY5LDYgKzE3Nyw4IEBAIHN0
YXRpYyBpbmxpbmUgYm9vbCBpOTE1X3ZtYV9pc19hY3RpdmUoY29uc3Qgc3RydWN0IGk5MTVfdm1h
ICp2bWEpCiAJcmV0dXJuICFpOTE1X2FjdGl2ZV9pc19pZGxlKCZ2bWEtPmFjdGl2ZSk7CiB9CiAK
K2ludCBfX211c3RfY2hlY2sgX19pOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShzdHJ1Y3QgaTkxNV92
bWEgKnZtYSwKKwkJCQkJICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpOwogaW50IF9fbXVzdF9j
aGVjayBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAkJCQkJ
IHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAogCQkJCQkgdW5zaWduZWQgaW50IGZsYWdzKTsKQEAg
LTMwNywxMyArMzE3LDE4IEBAIGk5MTVfdm1hX2NvbXBhcmUoc3RydWN0IGk5MTVfdm1hICp2bWEs
CiAJcmV0dXJuIG1lbWNtcCgmdm1hLT5nZ3R0X3ZpZXcucGFydGlhbCwgJnZpZXctPnBhcnRpYWws
IHZpZXctPnR5cGUpOwogfQogCi1pbnQgaTkxNV92bWFfYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZt
YSwgZW51bSBpOTE1X2NhY2hlX2xldmVsIGNhY2hlX2xldmVsLAotCQkgIHUzMiBmbGFncyk7Citz
dHJ1Y3QgaTkxNV92bWFfd29yayAqaTkxNV92bWFfd29yayh2b2lkKTsKK2ludCBpOTE1X3ZtYV9i
aW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAorCQkgIGVudW0gaTkxNV9jYWNoZV9sZXZlbCBjYWNo
ZV9sZXZlbCwKKwkJICB1MzIgZmxhZ3MsCisJCSAgc3RydWN0IGk5MTVfdm1hX3dvcmsgKndvcmsp
OworCiBib29sIGk5MTVfZ2VtX3ZhbGlkX2d0dF9zcGFjZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwg
dW5zaWduZWQgbG9uZyBjb2xvcik7CiBib29sIGk5MTVfdm1hX21pc3BsYWNlZChjb25zdCBzdHJ1
Y3QgaTkxNV92bWEgKnZtYSwKIAkJCXU2NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3Mp
Owogdm9pZCBfX2k5MTVfdm1hX3NldF9tYXBfYW5kX2ZlbmNlYWJsZShzdHJ1Y3QgaTkxNV92bWEg
KnZtYSk7CiB2b2lkIGk5MTVfdm1hX3Jldm9rZV9tbWFwKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKTsK
K2ludCBfX2k5MTVfdm1hX3VuYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7CiBpbnQgX19tdXN0
X2NoZWNrIGk5MTVfdm1hX3VuYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7CiB2b2lkIGk5MTVf
dm1hX3VubGlua19jdHgoc3RydWN0IGk5MTVfdm1hICp2bWEpOwogdm9pZCBpOTE1X3ZtYV9jbG9z
ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7CkBAIC0zMzIsMjYgKzM0Nyw4IEBAIHN0YXRpYyBpbmxp
bmUgdm9pZCBpOTE1X3ZtYV91bmxvY2soc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJZG1hX3Jlc3Zf
dW5sb2NrKHZtYS0+cmVzdik7CiB9CiAKLWludCBfX2k5MTVfdm1hX2RvX3BpbihzdHJ1Y3QgaTkx
NV92bWEgKnZtYSwKLQkJICAgICAgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncyk7
Ci1zdGF0aWMgaW5saW5lIGludCBfX211c3RfY2hlY2sKLWk5MTVfdm1hX3BpbihzdHJ1Y3QgaTkx
NV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncykKLXsKLQlCVUlM
RF9CVUdfT04oUElOX01CWiAhPSBJOTE1X1ZNQV9QSU5fT1ZFUkZMT1cpOwotCUJVSUxEX0JVR19P
TihQSU5fR0xPQkFMICE9IEk5MTVfVk1BX0dMT0JBTF9CSU5EKTsKLQlCVUlMRF9CVUdfT04oUElO
X1VTRVIgIT0gSTkxNV9WTUFfTE9DQUxfQklORCk7Ci0KLQkvKiBQaW4gZWFybHkgdG8gcHJldmVu
dCB0aGUgc2hyaW5rZXIvZXZpY3Rpb24gbG9naWMgZnJvbSBkZXN0cm95aW5nCi0JICogb3VyIHZt
YSBhcyB3ZSBpbnNlcnQgYW5kIGJpbmQuCi0JICovCi0JaWYgKGxpa2VseSgoKGF0b21pY19pbmNf
cmV0dXJuKCZ2bWEtPmZsYWdzKSBeIGZsYWdzKSAmIEk5MTVfVk1BX0JJTkRfTUFTSykgPT0gMCkp
IHsKLQkJR0VNX0JVR19PTighZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKTsKLQkJ
R0VNX0JVR19PTihpOTE1X3ZtYV9taXNwbGFjZWQodm1hLCBzaXplLCBhbGlnbm1lbnQsIGZsYWdz
KSk7Ci0JCXJldHVybiAwOwotCX0KLQotCXJldHVybiBfX2k5MTVfdm1hX2RvX3Bpbih2bWEsIHNp
emUsIGFsaWdubWVudCwgZmxhZ3MpOwotfQoraW50IF9fbXVzdF9jaGVjaworaTkxNV92bWFfcGlu
KHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1NjQgc2l6ZSwgdTY0IGFsaWdubWVudCwgdTY0IGZsYWdz
KTsKIAogc3RhdGljIGlubGluZSBpbnQgaTkxNV92bWFfcGluX2NvdW50KGNvbnN0IHN0cnVjdCBp
OTE1X3ZtYSAqdm1hKQogewpAQCAtMzY2LDE3ICszNjMsMTcgQEAgc3RhdGljIGlubGluZSBib29s
IGk5MTVfdm1hX2lzX3Bpbm5lZChjb25zdCBzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHN0YXRpYyBp
bmxpbmUgdm9pZCBfX2k5MTVfdm1hX3BpbihzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKIAlhdG9t
aWNfaW5jKCZ2bWEtPmZsYWdzKTsKLQlHRU1fQlVHX09OKGF0b21pY19yZWFkKCZ2bWEtPmZsYWdz
KSAmIEk5MTVfVk1BX1BJTl9PVkVSRkxPVyk7CisJR0VNX0JVR19PTighaTkxNV92bWFfaXNfcGlu
bmVkKHZtYSkpOwogfQogCiBzdGF0aWMgaW5saW5lIHZvaWQgX19pOTE1X3ZtYV91bnBpbihzdHJ1
Y3QgaTkxNV92bWEgKnZtYSkKIHsKKwlHRU1fQlVHX09OKCFpOTE1X3ZtYV9pc19waW5uZWQodm1h
KSk7CiAJYXRvbWljX2RlYygmdm1hLT5mbGFncyk7CiB9CiAKIHN0YXRpYyBpbmxpbmUgdm9pZCBp
OTE1X3ZtYV91bnBpbihzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKLQlHRU1fQlVHX09OKCFpOTE1
X3ZtYV9pc19waW5uZWQodm1hKSk7CiAJR0VNX0JVR19PTighZHJtX21tX25vZGVfYWxsb2NhdGVk
KCZ2bWEtPm5vZGUpKTsKIAlfX2k5MTVfdm1hX3VucGluKHZtYSk7CiB9CkBAIC00MDIsOCArMzk5
LDYgQEAgc3RhdGljIGlubGluZSBib29sIGk5MTVfbm9kZV9jb2xvcl9kaWZmZXJzKGNvbnN0IHN0
cnVjdCBkcm1fbW1fbm9kZSAqbm9kZSwKICAqIHRoZSBjYWxsZXIgbXVzdCBjYWxsIGk5MTVfdm1h
X3VucGluX2lvbWFwIHRvIHJlbGlucXVpc2ggdGhlIHBpbm5pbmcKICAqIGFmdGVyIHRoZSBpb21h
cHBpbmcgaXMgbm8gbG9uZ2VyIHJlcXVpcmVkLgogICoKLSAqIENhbGxlcnMgbXVzdCBob2xkIHRo
ZSBzdHJ1Y3RfbXV0ZXguCi0gKgogICogUmV0dXJucyBhIHZhbGlkIGlvbWFwcGVkIHBvaW50ZXIg
b3IgRVJSX1BUUi4KICAqLwogdm9pZCBfX2lvbWVtICppOTE1X3ZtYV9waW5faW9tYXAoc3RydWN0
IGk5MTVfdm1hICp2bWEpOwpAQCAtNDE1LDggKzQxMCw4IEBAIHZvaWQgX19pb21lbSAqaTkxNV92
bWFfcGluX2lvbWFwKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKTsKICAqCiAgKiBVbnBpbnMgdGhlIHBy
ZXZpb3VzbHkgaW9tYXBwZWQgVk1BIGZyb20gaTkxNV92bWFfcGluX2lvbWFwKCkuCiAgKgotICog
Q2FsbGVycyBtdXN0IGhvbGQgdGhlIHN0cnVjdF9tdXRleC4gVGhpcyBmdW5jdGlvbiBpcyBvbmx5
IHZhbGlkIHRvIGJlCi0gKiBjYWxsZWQgb24gYSBWTUEgcHJldmlvdXNseSBpb21hcHBlZCBieSB0
aGUgY2FsbGVyIHdpdGggaTkxNV92bWFfcGluX2lvbWFwKCkuCisgKiBUaGlzIGZ1bmN0aW9uIGlz
IG9ubHkgdmFsaWQgdG8gYmUgY2FsbGVkIG9uIGEgVk1BIHByZXZpb3VzbHkKKyAqIGlvbWFwcGVk
IGJ5IHRoZSBjYWxsZXIgd2l0aCBpOTE1X3ZtYV9waW5faW9tYXAoKS4KICAqLwogdm9pZCBpOTE1
X3ZtYV91bnBpbl9pb21hcChzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7CiAKQEAgLTQ0NCw2ICs0Mzks
OCBAQCBzdGF0aWMgaW5saW5lIHN0cnVjdCBwYWdlICppOTE1X3ZtYV9maXJzdF9wYWdlKHN0cnVj
dCBpOTE1X3ZtYSAqdm1hKQogaW50IF9fbXVzdF9jaGVjayBpOTE1X3ZtYV9waW5fZmVuY2Uoc3Ry
dWN0IGk5MTVfdm1hICp2bWEpOwogaW50IF9fbXVzdF9jaGVjayBpOTE1X3ZtYV9yZXZva2VfZmVu
Y2Uoc3RydWN0IGk5MTVfdm1hICp2bWEpOwogCitpbnQgX19pOTE1X3ZtYV9waW5fZmVuY2Uoc3Ry
dWN0IGk5MTVfdm1hICp2bWEpOworCiBzdGF0aWMgaW5saW5lIHZvaWQgX19pOTE1X3ZtYV91bnBp
bl9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKIAlHRU1fQlVHX09OKGF0b21pY19yZWFk
KCZ2bWEtPmZlbmNlLT5waW5fY291bnQpIDw9IDApOwpAQCAtNDYxLDcgKzQ1OCw2IEBAIHN0YXRp
YyBpbmxpbmUgdm9pZCBfX2k5MTVfdm1hX3VucGluX2ZlbmNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1h
KQogc3RhdGljIGlubGluZSB2b2lkCiBpOTE1X3ZtYV91bnBpbl9mZW5jZShzdHJ1Y3QgaTkxNV92
bWEgKnZtYSkKIHsKLQkvKiBsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bWEtPnZtLT5pOTE1LT5kcm0u
c3RydWN0X211dGV4KTsgKi8KIAlpZiAodm1hLT5mZW5jZSkKIAkJX19pOTE1X3ZtYV91bnBpbl9m
ZW5jZSh2bWEpOwogfQpAQCAtNDkwLDQgKzQ4NiwxMCBAQCBzdHJ1Y3QgaTkxNV92bWEgKmk5MTVf
dm1hX21ha2VfdW5zaHJpbmthYmxlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKTsKIHZvaWQgaTkxNV92
bWFfbWFrZV9zaHJpbmthYmxlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKTsKIHZvaWQgaTkxNV92bWFf
bWFrZV9wdXJnZWFibGUoc3RydWN0IGk5MTVfdm1hICp2bWEpOwogCitzdGF0aWMgaW5saW5lIGlu
dCBpOTE1X3ZtYV9zeW5jKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQoreworCS8qIFdhaXQgZm9yIHRo
ZSBhc3luY2hyb25vdXMgYmluZGluZ3MgYW5kIHBlbmRpbmcgR1BVIHJlYWRzICovCisJcmV0dXJu
IGk5MTVfYWN0aXZlX3dhaXQoJnZtYS0+YWN0aXZlKTsKK30KKwogI2VuZGlmCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbS5jCmluZGV4IDM3NTkzODMxYjUzOS4uMDM0NmMz
ZTViNmI2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9n
ZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW0uYwpAQCAt
MTE5LDEwICsxMTksOCBAQCBzdGF0aWMgdm9pZCBwbV9yZXN1bWUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCiAJCWludGVsX2d0X3Nhbml0aXplKCZpOTE1LT5ndCwgZmFsc2UpOwogCQlp
OTE1X2dlbV9zYW5pdGl6ZShpOTE1KTsKIAotCQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKIAkJaTkxNV9nZW1fcmVzdG9yZV9ndHRfbWFwcGluZ3MoaTkxNSk7CiAJCWk5MTVf
Z2VtX3Jlc3RvcmVfZmVuY2VzKGk5MTUpOwotCQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCiAJCWk5MTVfZ2VtX3Jlc3VtZShpOTE1KTsKIAl9CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5jCmluZGV4IDI5MDVmYjIxZDg2
Ni4uNzVhNDY5NWI4MmJiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaTkxNV9nZW1fZXZpY3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aTkxNV9nZW1fZXZpY3QuYwpAQCAtMTA2LDE0ICsxMDYsMTEgQEAgc3RhdGljIGludCBwb3B1bGF0
ZV9nZ3R0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCiBzdGF0aWMgdm9pZCB1bnBp
bl9nZ3R0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBpOTE1X2dn
dHQgKmdndHQgPSAmaTkxNS0+Z2d0dDsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAotCW11dGV4
X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KHZtYSwgJmk5MTUt
PmdndHQudm0uYm91bmRfbGlzdCwgdm1fbGluaykKIAkJaWYgKHZtYS0+b2JqLT5tbS5xdWlya2Vk
KQogCQkJaTkxNV92bWFfdW5waW4odm1hKTsKLQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4
KTsKIH0KIAogc3RhdGljIHZvaWQgY2xlYW51cF9vYmplY3RzKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LApAQCAtMTI3LDExICsxMjQsNyBAQCBzdGF0aWMgdm9pZCBjbGVhbnVwX29iamVj
dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCWk5MTVfZ2VtX29iamVjdF9wdXQo
b2JqKTsKIAl9CiAKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJ
aTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhpOTE1KTsKLQotCW11dGV4X2xvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogfQogCiBzdGF0aWMgaW50IGlndF9ldmljdF9zb21ldGhpbmco
dm9pZCAqYXJnKQpAQCAtMTQ4LDEwICsxNDEsMTIgQEAgc3RhdGljIGludCBpZ3RfZXZpY3Rfc29t
ZXRoaW5nKHZvaWQgKmFyZykKIAkJZ290byBjbGVhbnVwOwogCiAJLyogRXZlcnl0aGluZyBpcyBw
aW5uZWQsIG5vdGhpbmcgc2hvdWxkIGhhcHBlbiAqLworCW11dGV4X2xvY2soJmdndHQtPnZtLm11
dGV4KTsKIAllcnIgPSBpOTE1X2dlbV9ldmljdF9zb21ldGhpbmcoJmdndHQtPnZtLAogCQkJCSAg
ICAgICBJOTE1X0dUVF9QQUdFX1NJWkUsIDAsIDAsCiAJCQkJICAgICAgIDAsIFU2NF9NQVgsCiAJ
CQkJICAgICAgIDApOworCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWlmIChlcnIg
IT0gLUVOT1NQQykgewogCQlwcl9lcnIoImk5MTVfZ2VtX2V2aWN0X3NvbWV0aGluZyBmYWlsZWQg
b24gYSBmdWxsIEdHVFQgd2l0aCBlcnI9JWRcbiIsCiAJCSAgICAgICBlcnIpOwpAQCAtMTYxLDEw
ICsxNTYsMTIgQEAgc3RhdGljIGludCBpZ3RfZXZpY3Rfc29tZXRoaW5nKHZvaWQgKmFyZykKIAl1
bnBpbl9nZ3R0KGk5MTUpOwogCiAJLyogRXZlcnl0aGluZyBpcyB1bnBpbm5lZCwgd2Ugc2hvdWxk
IGJlIGFibGUgdG8gZXZpY3Qgc29tZXRoaW5nICovCisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0
ZXgpOwogCWVyciA9IGk5MTVfZ2VtX2V2aWN0X3NvbWV0aGluZygmZ2d0dC0+dm0sCiAJCQkJICAg
ICAgIEk5MTVfR1RUX1BBR0VfU0laRSwgMCwgMCwKIAkJCQkgICAgICAgMCwgVTY0X01BWCwKIAkJ
CQkgICAgICAgMCk7CisJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJaWYgKGVycikg
ewogCQlwcl9lcnIoImk5MTVfZ2VtX2V2aWN0X3NvbWV0aGluZyBmYWlsZWQgb24gYSBmdWxsIEdH
VFQgd2l0aCBlcnI9JWRcbiIsCiAJCSAgICAgICBlcnIpOwpAQCAtMjMwLDcgKzIyNyw5IEBAIHN0
YXRpYyBpbnQgaWd0X2V2aWN0X2Zvcl92bWEodm9pZCAqYXJnKQogCQlnb3RvIGNsZWFudXA7CiAK
IAkvKiBFdmVyeXRoaW5nIGlzIHBpbm5lZCwgbm90aGluZyBzaG91bGQgaGFwcGVuICovCisJbXV0
ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWVyciA9IGk5MTVfZ2VtX2V2aWN0X2Zvcl9ub2Rl
KCZnZ3R0LT52bSwgJnRhcmdldCwgMCk7CisJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7
CiAJaWYgKGVyciAhPSAtRU5PU1BDKSB7CiAJCXByX2VycigiaTkxNV9nZW1fZXZpY3RfZm9yX25v
ZGUgb24gYSBmdWxsIEdHVFQgcmV0dXJuZWQgZXJyPSVkXG4iLAogCQkgICAgICAgZXJyKTsKQEAg
LTI0MCw3ICsyMzksOSBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9mb3Jfdm1hKHZvaWQgKmFyZykK
IAl1bnBpbl9nZ3R0KGk5MTUpOwogCiAJLyogRXZlcnl0aGluZyBpcyB1bnBpbm5lZCwgd2Ugc2hv
dWxkIGJlIGFibGUgdG8gZXZpY3QgdGhlIG5vZGUgKi8KKwltdXRleF9sb2NrKCZnZ3R0LT52bS5t
dXRleCk7CiAJZXJyID0gaTkxNV9nZW1fZXZpY3RfZm9yX25vZGUoJmdndHQtPnZtLCAmdGFyZ2V0
LCAwKTsKKwltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAlpZiAoZXJyKSB7CiAJCXBy
X2VycigiaTkxNV9nZW1fZXZpY3RfZm9yX25vZGUgcmV0dXJuZWQgZXJyPSVkXG4iLAogCQkgICAg
ICAgZXJyKTsKQEAgLTMxOSw3ICszMjAsOSBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9mb3JfY2Fj
aGVfY29sb3Iodm9pZCAqYXJnKQogCWk5MTVfdm1hX3VucGluKHZtYSk7CiAKIAkvKiBSZW1vdmUg
anVzdCB0aGUgc2Vjb25kIHZtYSAqLworCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAll
cnIgPSBpOTE1X2dlbV9ldmljdF9mb3Jfbm9kZSgmZ2d0dC0+dm0sICZ0YXJnZXQsIDApOworCW11
dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWlmIChlcnIpIHsKIAkJcHJfZXJyKCJbMF1p
OTE1X2dlbV9ldmljdF9mb3Jfbm9kZSByZXR1cm5lZCBlcnI9JWRcbiIsIGVycik7CiAJCWdvdG8g
Y2xlYW51cDsKQEAgLTMzMCw3ICszMzMsOSBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9mb3JfY2Fj
aGVfY29sb3Iodm9pZCAqYXJnKQogCSAqLwogCXRhcmdldC5jb2xvciA9IEk5MTVfQ0FDSEVfTDNf
TExDOwogCisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWVyciA9IGk5MTVfZ2VtX2V2
aWN0X2Zvcl9ub2RlKCZnZ3R0LT52bSwgJnRhcmdldCwgMCk7CisJbXV0ZXhfdW5sb2NrKCZnZ3R0
LT52bS5tdXRleCk7CiAJaWYgKCFlcnIpIHsKIAkJcHJfZXJyKCJbMV1pOTE1X2dlbV9ldmljdF9m
b3Jfbm9kZSByZXR1cm5lZCBlcnI9JWRcbiIsIGVycik7CiAJCWVyciA9IC1FSU5WQUw7CkBAIC0z
NjAsNyArMzY1LDkgQEAgc3RhdGljIGludCBpZ3RfZXZpY3Rfdm0odm9pZCAqYXJnKQogCQlnb3Rv
IGNsZWFudXA7CiAKIAkvKiBFdmVyeXRoaW5nIGlzIHBpbm5lZCwgbm90aGluZyBzaG91bGQgaGFw
cGVuICovCisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWVyciA9IGk5MTVfZ2VtX2V2
aWN0X3ZtKCZnZ3R0LT52bSk7CisJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJaWYg
KGVycikgewogCQlwcl9lcnIoImk5MTVfZ2VtX2V2aWN0X3ZtIG9uIGEgZnVsbCBHR1RUIHJldHVy
bmVkIGVycj0lZF1cbiIsCiAJCSAgICAgICBlcnIpOwpAQCAtMzY5LDcgKzM3Niw5IEBAIHN0YXRp
YyBpbnQgaWd0X2V2aWN0X3ZtKHZvaWQgKmFyZykKIAogCXVucGluX2dndHQoaTkxNSk7CiAKKwlt
dXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJZXJyID0gaTkxNV9nZW1fZXZpY3Rfdm0oJmdn
dHQtPnZtKTsKKwltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAlpZiAoZXJyKSB7CiAJ
CXByX2VycigiaTkxNV9nZW1fZXZpY3Rfdm0gb24gYSBmdWxsIEdHVFQgcmV0dXJuZWQgZXJyPSVk
XVxuIiwKIAkJICAgICAgIGVycik7CkBAIC00MTAsMTEgKzQxOSwxMSBAQCBzdGF0aWMgaW50IGln
dF9ldmljdF9jb250ZXh0cyh2b2lkICphcmcpCiAJaWYgKCFIQVNfRlVMTF9QUEdUVChpOTE1KSkK
IAkJcmV0dXJuIDA7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAl3
YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwogCiAJLyog
UmVzZXJ2ZSBhIGJsb2NrIHNvIHRoYXQgd2Uga25vdyB3ZSBoYXZlIGVub3VnaCB0byBmaXQgYSBm
ZXcgcnEgKi8KIAltZW1zZXQoJmhvbGUsIDAsIHNpemVvZihob2xlKSk7CisJbXV0ZXhfbG9jaygm
aTkxNS0+Z2d0dC52bS5tdXRleCk7CiAJZXJyID0gaTkxNV9nZW1fZ3R0X2luc2VydCgmaTkxNS0+
Z2d0dC52bSwgJmhvbGUsCiAJCQkJICBQUkVURU5EX0dHVFRfU0laRSwgMCwgSTkxNV9DT0xPUl9V
TkVWSUNUQUJMRSwKIAkJCQkgIDAsIGk5MTUtPmdndHQudm0udG90YWwsCkBAIC00MjcsNyArNDM2
LDkgQEAgc3RhdGljIGludCBpZ3RfZXZpY3RfY29udGV4dHModm9pZCAqYXJnKQogCWRvIHsKIAkJ
c3RydWN0IHJlc2VydmVkICpyOwogCisJCW11dGV4X3VubG9jaygmaTkxNS0+Z2d0dC52bS5tdXRl
eCk7CiAJCXIgPSBrY2FsbG9jKDEsIHNpemVvZigqciksIEdGUF9LRVJORUwpOworCQltdXRleF9s
b2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIAkJaWYgKCFyKSB7CiAJCQllcnIgPSAtRU5PTUVN
OwogCQkJZ290byBvdXRfbG9ja2VkOwpAQCAtNDQ3LDcgKzQ1OCw3IEBAIHN0YXRpYyBpbnQgaWd0
X2V2aWN0X2NvbnRleHRzKHZvaWQgKmFyZykKIAkJY291bnQrKzsKIAl9IHdoaWxlICgxKTsKIAlk
cm1fbW1fcmVtb3ZlX25vZGUoJmhvbGUpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIAlwcl9pbmZv
KCJGaWxsZWQgR0dUVCB3aXRoICVsdSAxTWlCIG5vZGVzXG4iLCBjb3VudCk7CiAKIAkvKiBPdmVy
ZmlsbCB0aGUgR0dUVCB3aXRoIGNvbnRleHQgb2JqZWN0cyBhbmQgc28gdHJ5IHRvIGV2aWN0IG9u
ZS4gKi8KQEAgLTUxMCw3ICs1MjEsNyBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9jb250ZXh0cyh2
b2lkICphcmcpCiAJCQlicmVhazsKIAl9CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKKwltdXRleF9sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIG91dF9sb2NrZWQ6
CiAJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQogCQllcnIgPSAt
RUlPOwpAQCAtNTI0LDggKzUzNSw4IEBAIHN0YXRpYyBpbnQgaWd0X2V2aWN0X2NvbnRleHRzKHZv
aWQgKmFyZykKIAl9CiAJaWYgKGRybV9tbV9ub2RlX2FsbG9jYXRlZCgmaG9sZSkpCiAJCWRybV9t
bV9yZW1vdmVfbm9kZSgmaG9sZSk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4
KTsKIAlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0J
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCXJldHVybiBlcnI7CiB9
CkBAIC01NDcsMTIgKzU1OCw5IEBAIGludCBpOTE1X2dlbV9ldmljdF9tb2NrX3NlbGZ0ZXN0cyh2
b2lkKQogCWlmICghaTkxNSkKIAkJcmV0dXJuIC1FTk9NRU07CiAKLQltdXRleF9sb2NrKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKIAl3aXRoX2ludGVsX3J1bnRpbWVfcG0oJmk5MTUtPnJ1bnRp
bWVfcG0sIHdha2VyZWYpCiAJCWVyciA9IGk5MTVfc3VidGVzdHModGVzdHMsIGk5MTUpOwogCi0J
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWRybV9kZXZfcHV0KCZp
OTE1LT5kcm0pOwogCXJldHVybiBlcnI7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaTkxNV9nZW1fZ3R0LmMKaW5kZXggMDk0NWQ2ZTk3OGEyLi4wMjc0OWJiZmQwY2YgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ndHQuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMKQEAgLTM4
LDE2ICszOCw3IEBACiAKIHN0YXRpYyB2b2lkIGNsZWFudXBfZnJlZWRfb2JqZWN0cyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQkvKgotCSAqIEFzIHdlIG1heSBob2xkIG9udG8g
dGhlIHN0cnVjdF9tdXRleCBmb3IgaW5vcmRpbmF0ZSBsZW5ndGhzIG9mCi0JICogdGltZSwgdGhl
IE5NSSBraHVuZ3Rhc2tkIGRldGVjdG9yIG1heSBmaXJlIGZvciB0aGUgZnJlZSBvYmplY3RzCi0J
ICogd29ya2VyLgotCSAqLwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
Ci0KIAlpOTE1X2dlbV9kcmFpbl9mcmVlZF9vYmplY3RzKGk5MTUpOwotCi0JbXV0ZXhfbG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiB9CiAKIHN0YXRpYyB2b2lkIGZha2VfZnJlZV9wYWdl
cyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLApAQCAtODgwLDYgKzg3MSwxNSBAQCBz
dGF0aWMgaW50IF9fc2hyaW5rX2hvbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJ
CWk5MTVfdm1hX3VucGluKHZtYSk7CiAJCWFkZHIgKz0gc2l6ZTsKIAorCQkvKgorCQkgKiBTaW5j
ZSB3ZSBhcmUgaW5qZWN0aW5nIGFsbG9jYXRpb24gZmF1bHRzIGF0IHJhbmRvbSBpbnRlcnZhbHMs
CisJCSAqIHdhaXQgZm9yIHRoaXMgYWxsb2NhdGlvbiB0byBjb21wbGV0ZSBiZWZvcmUgd2UgY2hh
bmdlIHRoZQorCQkgKiBmYXVsdGluamVjdGlvbi4KKwkJICovCisJCWVyciA9IGk5MTVfdm1hX3N5
bmModm1hKTsKKwkJaWYgKGVycikKKwkJCWJyZWFrOworCiAJCWlmIChpZ3RfdGltZW91dChlbmRf
dGltZSwKIAkJCQkiJXMgdGltZWQgb3V0IGF0IG9mc2V0ICVsbHggWyVsbHggLSAlbGx4XVxuIiwK
IAkJCQlfX2Z1bmNfXywgYWRkciwgaG9sZV9zdGFydCwgaG9sZV9lbmQpKSB7CkBAIC0xMDEzLDIx
ICsxMDEzLDE5IEBAIHN0YXRpYyBpbnQgZXhlcmNpc2VfcHBndHQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAogCWlmIChJU19FUlIoZmlsZSkpCiAJCXJldHVybiBQVFJfRVJSKGZp
bGUpOwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXBwZ3R0
ID0gaTkxNV9wcGd0dF9jcmVhdGUoZGV2X3ByaXYpOwogCWlmIChJU19FUlIocHBndHQpKSB7CiAJ
CWVyciA9IFBUUl9FUlIocHBndHQpOwotCQlnb3RvIG91dF91bmxvY2s7CisJCWdvdG8gb3V0X2Zy
ZWU7CiAJfQogCUdFTV9CVUdfT04ob2Zmc2V0X2luX3BhZ2UocHBndHQtPnZtLnRvdGFsKSk7Ci0J
R0VNX0JVR19PTihwcGd0dC0+dm0uY2xvc2VkKTsKKwlHRU1fQlVHX09OKCFhdG9taWNfcmVhZCgm
cHBndHQtPnZtLm9wZW4pKTsKIAogCWVyciA9IGZ1bmMoZGV2X3ByaXYsICZwcGd0dC0+dm0sIDAs
IHBwZ3R0LT52bS50b3RhbCwgZW5kX3RpbWUpOwogCiAJaTkxNV92bV9wdXQoJnBwZ3R0LT52bSk7
Ci1vdXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwogCitvdXRfZnJlZToKIAltb2NrX2ZpbGVfZnJlZShkZXZfcHJpdiwgZmlsZSk7CiAJcmV0dXJu
IGVycjsKIH0KQEAgLTEwOTAsNyArMTA4OCw2IEBAIHN0YXRpYyBpbnQgZXhlcmNpc2VfZ2d0dChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlJR1RfVElNRU9VVChlbmRfdGltZSk7CiAJ
aW50IGVyciA9IDA7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIHJl
c3RhcnQ6CiAJbGlzdF9zb3J0KE5VTEwsICZnZ3R0LT52bS5tbS5ob2xlX3N0YWNrLCBzb3J0X2hv
bGVzKTsKIAlkcm1fbW1fZm9yX2VhY2hfaG9sZShub2RlLCAmZ2d0dC0+dm0ubW0sIGhvbGVfc3Rh
cnQsIGhvbGVfZW5kKSB7CkBAIC0xMTExLDcgKzExMDgsNiBAQCBzdGF0aWMgaW50IGV4ZXJjaXNl
X2dndHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCWxhc3QgPSBob2xlX2VuZDsK
IAkJZ290byByZXN0YXJ0OwogCX0KLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwogCiAJcmV0dXJuIGVycjsKIH0KQEAgLTExNTMsMTMgKzExNDksOSBAQCBzdGF0aWMgaW50
IGlndF9nZ3R0X3BhZ2Uodm9pZCAqYXJnKQogCXVuc2lnbmVkIGludCAqb3JkZXIsIG47CiAJaW50
IGVycjsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJb2JqID0g
aTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChpOTE1LCBQQUdFX1NJWkUpOwotCWlmIChJ
U19FUlIob2JqKSkgewotCQllcnIgPSBQVFJfRVJSKG9iaik7Ci0JCWdvdG8gb3V0X3VubG9jazsK
LQl9CisJaWYgKElTX0VSUihvYmopKQorCQlyZXR1cm4gUFRSX0VSUihvYmopOwogCiAJZXJyID0g
aTkxNV9nZW1fb2JqZWN0X3Bpbl9wYWdlcyhvYmopOwogCWlmIChlcnIpCkBAIC0xMjI3LDggKzEy
MTksNiBAQCBzdGF0aWMgaW50IGlndF9nZ3R0X3BhZ2Uodm9pZCAqYXJnKQogCWk5MTVfZ2VtX29i
amVjdF91bnBpbl9wYWdlcyhvYmopOwogb3V0X2ZyZWU6CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChv
YmopOwotb3V0X3VubG9jazoKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwogCXJldHVybiBlcnI7CiB9CiAKQEAgLTEyMzksNiArMTIyOSw5IEBAIHN0YXRpYyB2b2lkIHRy
YWNrX3ZtYV9iaW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCWF0b21pY19pbmMoJm9iai0+Ymlu
ZF9jb3VudCk7IC8qIHRyYWNrIGZvciBldmljdGlvbiBsYXRlciAqLwogCV9faTkxNV9nZW1fb2Jq
ZWN0X3Bpbl9wYWdlcyhvYmopOwogCisJR0VNX0JVR19PTih2bWEtPnBhZ2VzKTsKKwlhdG9taWNf
c2V0KCZ2bWEtPnBhZ2VzX2NvdW50LCBJOTE1X1ZNQV9QQUdFU19BQ1RJVkUpOworCV9faTkxNV9n
ZW1fb2JqZWN0X3Bpbl9wYWdlcyhvYmopOwogCXZtYS0+cGFnZXMgPSBvYmotPm1tLnBhZ2VzOwog
CiAJbXV0ZXhfbG9jaygmdm1hLT52bS0+bXV0ZXgpOwpAQCAtMTMzNiwxMSArMTMyOSwxMyBAQCBz
dGF0aWMgaW50IGlndF9ndHRfcmVzZXJ2ZSh2b2lkICphcmcpCiAJCQlnb3RvIG91dDsKIAkJfQog
CisJCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJZXJyID0gaTkxNV9nZW1fZ3R0X3Jl
c2VydmUoJmdndHQtPnZtLCAmdm1hLT5ub2RlLAogCQkJCQkgICBvYmotPmJhc2Uuc2l6ZSwKIAkJ
CQkJICAgdG90YWwsCiAJCQkJCSAgIG9iai0+Y2FjaGVfbGV2ZWwsCiAJCQkJCSAgIDApOworCQlt
dXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJaWYgKGVycikgewogCQkJcHJfZXJyKCJp
OTE1X2dlbV9ndHRfcmVzZXJ2ZSAocGFzcyAxKSBmYWlsZWQgYXQgJWxsdS8lbGx1IHdpdGggZXJy
PSVkXG4iLAogCQkJICAgICAgIHRvdGFsLCBnZ3R0LT52bS50b3RhbCwgZXJyKTsKQEAgLTEzODYs
MTEgKzEzODEsMTMgQEAgc3RhdGljIGludCBpZ3RfZ3R0X3Jlc2VydmUodm9pZCAqYXJnKQogCQkJ
Z290byBvdXQ7CiAJCX0KIAorCQltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCWVyciA9
IGk5MTVfZ2VtX2d0dF9yZXNlcnZlKCZnZ3R0LT52bSwgJnZtYS0+bm9kZSwKIAkJCQkJICAgb2Jq
LT5iYXNlLnNpemUsCiAJCQkJCSAgIHRvdGFsLAogCQkJCQkgICBvYmotPmNhY2hlX2xldmVsLAog
CQkJCQkgICAwKTsKKwkJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCWlmIChlcnIp
IHsKIAkJCXByX2VycigiaTkxNV9nZW1fZ3R0X3Jlc2VydmUgKHBhc3MgMikgZmFpbGVkIGF0ICVs
bHUvJWxsdSB3aXRoIGVycj0lZFxuIiwKIAkJCSAgICAgICB0b3RhbCwgZ2d0dC0+dm0udG90YWws
IGVycik7CkBAIC0xNDMxLDExICsxNDI4LDEzIEBAIHN0YXRpYyBpbnQgaWd0X2d0dF9yZXNlcnZl
KHZvaWQgKmFyZykKIAkJCQkJICAgMiAqIEk5MTVfR1RUX1BBR0VfU0laRSwKIAkJCQkJICAgSTkx
NV9HVFRfTUlOX0FMSUdOTUVOVCk7CiAKKwkJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwog
CQllcnIgPSBpOTE1X2dlbV9ndHRfcmVzZXJ2ZSgmZ2d0dC0+dm0sICZ2bWEtPm5vZGUsCiAJCQkJ
CSAgIG9iai0+YmFzZS5zaXplLAogCQkJCQkgICBvZmZzZXQsCiAJCQkJCSAgIG9iai0+Y2FjaGVf
bGV2ZWwsCiAJCQkJCSAgIDApOworCQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJ
aWYgKGVycikgewogCQkJcHJfZXJyKCJpOTE1X2dlbV9ndHRfcmVzZXJ2ZSAocGFzcyAzKSBmYWls
ZWQgYXQgJWxsdS8lbGx1IHdpdGggZXJyPSVkXG4iLAogCQkJICAgICAgIHRvdGFsLCBnZ3R0LT52
bS50b3RhbCwgZXJyKTsKQEAgLTE1MDQsMTEgKzE1MDMsMTMgQEAgc3RhdGljIGludCBpZ3RfZ3R0
X2luc2VydCh2b2lkICphcmcpCiAKIAkvKiBDaGVjayBhIGNvdXBsZSBvZiBvYnZpb3VzbHkgaW52
YWxpZCByZXF1ZXN0cyAqLwogCWZvciAoaWkgPSBpbnZhbGlkX2luc2VydDsgaWktPnNpemU7IGlp
KyspIHsKKwkJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQllcnIgPSBpOTE1X2dlbV9n
dHRfaW5zZXJ0KCZnZ3R0LT52bSwgJnRtcCwKIAkJCQkJICBpaS0+c2l6ZSwgaWktPmFsaWdubWVu
dCwKIAkJCQkJICBJOTE1X0NPTE9SX1VORVZJQ1RBQkxFLAogCQkJCQkgIGlpLT5zdGFydCwgaWkt
PmVuZCwKIAkJCQkJICAwKTsKKwkJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCWlm
IChlcnIgIT0gLUVOT1NQQykgewogCQkJcHJfZXJyKCJJbnZhbGlkIGk5MTVfZ2VtX2d0dF9pbnNl
cnQoLnNpemU9JWxseCwgLmFsaWdubWVudD0lbGx4LCAuc3RhcnQ9JWxseCwgLmVuZD0lbGx4KSBz
dWNjZWVkZWQgKGVycj0lZClcbiIsCiAJCQkgICAgICAgaWktPnNpemUsIGlpLT5hbGlnbm1lbnQs
IGlpLT5zdGFydCwgaWktPmVuZCwKQEAgLTE1NDQsMTAgKzE1NDUsMTIgQEAgc3RhdGljIGludCBp
Z3RfZ3R0X2luc2VydCh2b2lkICphcmcpCiAJCQlnb3RvIG91dDsKIAkJfQogCisJCW11dGV4X2xv
Y2soJmdndHQtPnZtLm11dGV4KTsKIAkJZXJyID0gaTkxNV9nZW1fZ3R0X2luc2VydCgmZ2d0dC0+
dm0sICZ2bWEtPm5vZGUsCiAJCQkJCSAgb2JqLT5iYXNlLnNpemUsIDAsIG9iai0+Y2FjaGVfbGV2
ZWwsCiAJCQkJCSAgMCwgZ2d0dC0+dm0udG90YWwsCiAJCQkJCSAgMCk7CisJCW11dGV4X3VubG9j
aygmZ2d0dC0+dm0ubXV0ZXgpOwogCQlpZiAoZXJyID09IC1FTk9TUEMpIHsKIAkJCS8qIG1heGVk
IG91dCB0aGUgR0dUVCBzcGFjZSAqLwogCQkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwpAQCAt
MTYwMiwxMCArMTYwNSwxMiBAQCBzdGF0aWMgaW50IGlndF9ndHRfaW5zZXJ0KHZvaWQgKmFyZykK
IAkJCWdvdG8gb3V0OwogCQl9CiAKKwkJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQll
cnIgPSBpOTE1X2dlbV9ndHRfaW5zZXJ0KCZnZ3R0LT52bSwgJnZtYS0+bm9kZSwKIAkJCQkJICBv
YmotPmJhc2Uuc2l6ZSwgMCwgb2JqLT5jYWNoZV9sZXZlbCwKIAkJCQkJICAwLCBnZ3R0LT52bS50
b3RhbCwKIAkJCQkJICAwKTsKKwkJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCWlm
IChlcnIpIHsKIAkJCXByX2VycigiaTkxNV9nZW1fZ3R0X2luc2VydCAocGFzcyAyKSBmYWlsZWQg
YXQgJWxsdS8lbGx1IHdpdGggZXJyPSVkXG4iLAogCQkJICAgICAgIHRvdGFsLCBnZ3R0LT52bS50
b3RhbCwgZXJyKTsKQEAgLTE2NDksMTAgKzE2NTQsMTIgQEAgc3RhdGljIGludCBpZ3RfZ3R0X2lu
c2VydCh2b2lkICphcmcpCiAJCQlnb3RvIG91dDsKIAkJfQogCisJCW11dGV4X2xvY2soJmdndHQt
PnZtLm11dGV4KTsKIAkJZXJyID0gaTkxNV9nZW1fZ3R0X2luc2VydCgmZ2d0dC0+dm0sICZ2bWEt
Pm5vZGUsCiAJCQkJCSAgb2JqLT5iYXNlLnNpemUsIDAsIG9iai0+Y2FjaGVfbGV2ZWwsCiAJCQkJ
CSAgMCwgZ2d0dC0+dm0udG90YWwsCiAJCQkJCSAgMCk7CisJCW11dGV4X3VubG9jaygmZ2d0dC0+
dm0ubXV0ZXgpOwogCQlpZiAoZXJyKSB7CiAJCQlwcl9lcnIoImk5MTVfZ2VtX2d0dF9pbnNlcnQg
KHBhc3MgMykgZmFpbGVkIGF0ICVsbHUvJWxsdSB3aXRoIGVycj0lZFxuIiwKIAkJCSAgICAgICB0
b3RhbCwgZ2d0dC0+dm0udG90YWwsIGVycik7CkBAIC0xNjk2LDggKzE3MDMsOSBAQCBpbnQgaTkx
NV9nZW1fZ3R0X21vY2tfc2VsZnRlc3RzKHZvaWQpCiAJfQogCW1vY2tfaW5pdF9nZ3R0KGk5MTUs
IGdndHQpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJZXJyID0g
aTkxNV9zdWJ0ZXN0cyh0ZXN0cywgZ2d0dCk7CisKKwltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKIAltb2NrX2RldmljZV9mbHVzaChpOTE1KTsKIAltdXRleF91bmxvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaTkxNV9yZXF1ZXN0LmMKaW5kZXggNTdjZDQxODBkMDZjLi5lYjE3NWRhNDg1NDcgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMKQEAgLTY0Nyw4
ICs2NDcsMTUgQEAgc3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqZW1wdHlfYmF0Y2goc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJaWYgKGVycikKIAkJZ290byBlcnI7CiAKKwkvKiBGb3Jj
ZSB0aGUgd2FpdCB3YWl0IG5vdyB0byBhdm9pZCBpbmNsdWRpbmcgaXQgaW4gdGhlIGJlbmNobWFy
ayAqLworCWVyciA9IGk5MTVfdm1hX3N5bmModm1hKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl9w
aW47CisKIAlyZXR1cm4gdm1hOwogCitlcnJfcGluOgorCWk5MTVfdm1hX3VucGluKHZtYSk7CiBl
cnI6CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwogCXJldHVybiBFUlJfUFRSKGVycik7CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5jCmluZGV4IDk3NzUyZGVlY2Nj
Yi4uMGU0ZjY2MzEyYjM5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaTkxNV92bWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92
bWEuYwpAQCAtODMxLDggKzgzMSw5IEBAIGludCBpOTE1X3ZtYV9tb2NrX3NlbGZ0ZXN0cyh2b2lk
KQogCX0KIAltb2NrX2luaXRfZ2d0dChpOTE1LCBnZ3R0KTsKIAotCW11dGV4X2xvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWVyciA9IGk5MTVfc3VidGVzdHModGVzdHMsIGdndHQpOwor
CisJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJbW9ja19kZXZpY2VfZmx1
c2goaTkxNSk7CiAJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIApAQCAt
ODc5LDggKzg4MCw2IEBAIHN0YXRpYyBpbnQgaWd0X3ZtYV9yZW1hcHBlZF9ndHQodm9pZCAqYXJn
KQogCWlmIChJU19FUlIob2JqKSkKIAkJcmV0dXJuIFBUUl9FUlIob2JqKTsKIAotCW11dGV4X2xv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVf
cG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKIAogCWZvciAodCA9IHR5cGVzOyAqdDsgdCsrKSB7
CkBAIC05NzYsNyArOTc1LDYgQEAgc3RhdGljIGludCBpZ3Rfdm1hX3JlbWFwcGVkX2d0dCh2b2lk
ICphcmcpCiAKIG91dDoKIAlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwg
d2FrZXJlZik7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpOTE1
X2dlbV9vYmplY3RfcHV0KG9iaik7CiAKIAlyZXR1cm4gZXJyOwotLSAKMi4yMy4wCgpfX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGlu
ZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVl
ZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

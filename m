Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 367D31C2BA5
	for <lists+intel-gfx@lfdr.de>; Sun,  3 May 2020 13:22:16 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7936E6E20C;
	Sun,  3 May 2020 11:22:14 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 053716E20C
 for <intel-gfx@lists.freedesktop.org>; Sun,  3 May 2020 11:22:11 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from build.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 21097490-1500050 
 for multiple; Sun, 03 May 2020 12:21:38 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sun,  3 May 2020 12:21:25 +0100
Message-Id: <20200503112132.17899-7-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20200503112132.17899-1-chris@chris-wilson.co.uk>
References: <20200503112132.17899-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 07/14] dma-buf: Proxy fence,
 an unsignaled fence placeholder
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Chris Wilson <chris@chris-wilson.co.uk>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

T2Z0ZW4gd2UgbmVlZCB0byBjcmVhdGUgYSBmZW5jZSBmb3IgYSBmdXR1cmUgZXZlbnQgdGhhdCBo
YXMgbm90IHlldCBiZWVuCmFzc29jaWF0ZWQgd2l0aCBhIGZlbmNlLiBXZSBjYW4gc3RvcmUgYSBw
cm94eSBmZW5jZSwgYSBwbGFjZWhvbGRlciwgaW4KdGhlIHRpbWVsaW5lIGFuZCByZXBsYWNlIGl0
IGxhdGVyIHdoZW4gdGhlIHJlYWwgZmVuY2UgaXMga25vd24uIEFueQpsaXN0ZW5lcnMgdGhhdCBh
dHRhY2ggdG8gdGhlIHByb3h5IGZlbmNlIHdpbGwgYXV0b21hdGljYWxseSBiZSBzaWduYWxlZAp3
aGVuIHRoZSByZWFsIGZlbmNlIGNvbXBsZXRlcywgYW5kIGFueSBmdXR1cmUgbGlzdGVuZXJzIHdp
bGwgaW5zdGVhZCBiZQphdHRhY2ggZGlyZWN0bHkgdG8gdGhlIHJlYWwgZmVuY2UgYXZvaWRpbmcg
YW55IGluZGlyZWN0aW9uIG92ZXJoZWFkLgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxj
aHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBMaW9uZWwgTGFuZHdlcmxpbiA8bGlvbmVsLmcu
bGFuZHdlcmxpbkBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9kbWEtYnVmL01ha2VmaWxlICAgICAg
ICAgICAgIHwgIDEzICstCiBkcml2ZXJzL2RtYS1idWYvZG1hLWZlbmNlLXByaXZhdGUuaCAgfCAg
MjAgKwogZHJpdmVycy9kbWEtYnVmL2RtYS1mZW5jZS1wcm94eS5jICAgIHwgMjU1ICsrKysrKysr
KysrKwogZHJpdmVycy9kbWEtYnVmL2RtYS1mZW5jZS5jICAgICAgICAgIHwgICA0ICstCiBkcml2
ZXJzL2RtYS1idWYvc2VsZnRlc3RzLmggICAgICAgICAgfCAgIDEgKwogZHJpdmVycy9kbWEtYnVm
L3N0LWRtYS1mZW5jZS1wcm94eS5jIHwgNTgxICsrKysrKysrKysrKysrKysrKysrKysrKysrKwog
aW5jbHVkZS9saW51eC9kbWEtZmVuY2UtcHJveHkuaCAgICAgIHwgIDM0ICsrCiA3IGZpbGVzIGNo
YW5nZWQsIDkwNCBpbnNlcnRpb25zKCspLCA0IGRlbGV0aW9ucygtKQogY3JlYXRlIG1vZGUgMTAw
NjQ0IGRyaXZlcnMvZG1hLWJ1Zi9kbWEtZmVuY2UtcHJpdmF0ZS5oCiBjcmVhdGUgbW9kZSAxMDA2
NDQgZHJpdmVycy9kbWEtYnVmL2RtYS1mZW5jZS1wcm94eS5jCiBjcmVhdGUgbW9kZSAxMDA2NDQg
ZHJpdmVycy9kbWEtYnVmL3N0LWRtYS1mZW5jZS1wcm94eS5jCiBjcmVhdGUgbW9kZSAxMDA2NDQg
aW5jbHVkZS9saW51eC9kbWEtZmVuY2UtcHJveHkuaAoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1h
LWJ1Zi9NYWtlZmlsZSBiL2RyaXZlcnMvZG1hLWJ1Zi9NYWtlZmlsZQppbmRleCA5OTVlMDVmNjA5
ZmYuLmFmYWY2ZGFkZDlhMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9kbWEtYnVmL01ha2VmaWxlCisr
KyBiL2RyaXZlcnMvZG1hLWJ1Zi9NYWtlZmlsZQpAQCAtMSw2ICsxLDEyIEBACiAjIFNQRFgtTGlj
ZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wLW9ubHkKLW9iai15IDo9IGRtYS1idWYubyBkbWEtZmVu
Y2UubyBkbWEtZmVuY2UtYXJyYXkubyBkbWEtZmVuY2UtY2hhaW4ubyBcCi0JIGRtYS1yZXN2Lm8g
c2Vxbm8tZmVuY2Uubworb2JqLXkgOj0gXAorCWRtYS1idWYubyBcCisJZG1hLWZlbmNlLm8gXAor
CWRtYS1mZW5jZS1hcnJheS5vIFwKKwlkbWEtZmVuY2UtY2hhaW4ubyBcCisJZG1hLWZlbmNlLXBy
b3h5Lm8gXAorCWRtYS1yZXN2Lm8gXAorCXNlcW5vLWZlbmNlLm8KIG9iai0kKENPTkZJR19ETUFC
VUZfSEVBUFMpCSs9IGRtYS1oZWFwLm8KIG9iai0kKENPTkZJR19ETUFCVUZfSEVBUFMpCSs9IGhl
YXBzLwogb2JqLSQoQ09ORklHX1NZTkNfRklMRSkJCSs9IHN5bmNfZmlsZS5vCkBAIC0xMCw2ICsx
Niw3IEBAIG9iai0kKENPTkZJR19VRE1BQlVGKQkJKz0gdWRtYWJ1Zi5vCiBkbWFidWZfc2VsZnRl
c3RzLXkgOj0gXAogCXNlbGZ0ZXN0Lm8gXAogCXN0LWRtYS1mZW5jZS5vIFwKLQlzdC1kbWEtZmVu
Y2UtY2hhaW4ubworCXN0LWRtYS1mZW5jZS1jaGFpbi5vIFwKKwlzdC1kbWEtZmVuY2UtcHJveHku
bwogCiBvYmotJChDT05GSUdfRE1BQlVGX1NFTEZURVNUUykJKz0gZG1hYnVmX3NlbGZ0ZXN0cy5v
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2RtYS1idWYvZG1hLWZlbmNlLXByaXZhdGUuaCBiL2RyaXZl
cnMvZG1hLWJ1Zi9kbWEtZmVuY2UtcHJpdmF0ZS5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4
IDAwMDAwMDAwMDAwMC4uNjkyNGQyOGFmMGZhCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9k
bWEtYnVmL2RtYS1mZW5jZS1wcml2YXRlLmgKQEAgLTAsMCArMSwyMCBAQAorLyogU1BEWC1MaWNl
bnNlLUlkZW50aWZpZXI6IEdQTC0yLjAtb25seSAqLworLyoKKyAqIEZlbmNlIG1lY2hhbmlzbSBm
b3IgZG1hLWJ1ZiBhbmQgdG8gYWxsb3cgZm9yIGFzeW5jaHJvbm91cyBkbWEgYWNjZXNzCisgKgor
ICogQ29weXJpZ2h0IChDKSAyMDEyIENhbm9uaWNhbCBMdGQKKyAqIENvcHlyaWdodCAoQykgMjAx
MiBUZXhhcyBJbnN0cnVtZW50cworICoKKyAqIEF1dGhvcnM6CisgKiBSb2IgQ2xhcmsgPHJvYmRj
bGFya0BnbWFpbC5jb20+CisgKiBNYWFydGVuIExhbmtob3JzdCA8bWFhcnRlbi5sYW5raG9yc3RA
Y2Fub25pY2FsLmNvbT4KKyAqLworCisjaWZuZGVmIERNQV9GRU5DRV9QUklWQVRFX0gKKyNkZWZp
bmUgRE1BX0ZFTkNFX1BSSUFWVEVfSAorCitzdHJ1Y3QgZG1hX2ZlbmNlOworCitib29sIF9fZG1h
X2ZlbmNlX2VuYWJsZV9zaWduYWxpbmcoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpOworCisjZW5k
aWYgLyogRE1BX0ZFTkNFX1BSSUFWVEVfSCAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEtYnVm
L2RtYS1mZW5jZS1wcm94eS5jIGIvZHJpdmVycy9kbWEtYnVmL2RtYS1mZW5jZS1wcm94eS5jCm5l
dyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uNGNkYjFjNDc2M2FiCi0tLSAv
ZGV2L251bGwKKysrIGIvZHJpdmVycy9kbWEtYnVmL2RtYS1mZW5jZS1wcm94eS5jCkBAIC0wLDAg
KzEsMjU1IEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMC1vbmx5CisvKgor
ICogZG1hLWZlbmNlLXByb3h5OiBwbGFjZWhvbGRlciB1bnNpZ25hbGVkIGZlbmNlCisgKgorICog
Q29weXJpZ2h0IChDKSAyMDE3LTIwMTkgSW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaW5jbHVk
ZSA8bGludXgvZG1hLWZlbmNlLmg+CisjaW5jbHVkZSA8bGludXgvZG1hLWZlbmNlLXByb3h5Lmg+
CisjaW5jbHVkZSA8bGludXgvZXhwb3J0Lmg+CisjaW5jbHVkZSA8bGludXgvaXJxX3dvcmsuaD4K
KyNpbmNsdWRlIDxsaW51eC9zbGFiLmg+CisKKyNpbmNsdWRlICJkbWEtZmVuY2UtcHJpdmF0ZS5o
IgorCitzdHJ1Y3QgZG1hX2ZlbmNlX3Byb3h5IHsKKwlzdHJ1Y3QgZG1hX2ZlbmNlIGJhc2U7CisK
KwlzdHJ1Y3QgZG1hX2ZlbmNlICpyZWFsOworCXN0cnVjdCBkbWFfZmVuY2VfY2IgY2I7CisJc3Ry
dWN0IGlycV93b3JrIHdvcms7CisKKwl3YWl0X3F1ZXVlX2hlYWRfdCB3cTsKK307CisKKyNpZmRl
ZiBDT05GSUdfREVCVUdfTE9DS19BTExPQworI2RlZmluZSBzYW1lX2xvY2tjbGFzcyhBLCBCKSAo
QSktPmRlcF9tYXAua2V5ID09IChCKS0+ZGVwX21hcC5rZXkKKyNlbHNlCisjZGVmaW5lIHNhbWVf
bG9ja2NsYXNzKEEsIEIpIDAKKyNlbmRpZgorCitzdGF0aWMgY29uc3QgY2hhciAqcHJveHlfZ2V0
X2RyaXZlcl9uYW1lKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlKQoreworCXN0cnVjdCBkbWFfZmVu
Y2VfcHJveHkgKnAgPSBjb250YWluZXJfb2YoZmVuY2UsIHR5cGVvZigqcCksIGJhc2UpOworCXN0
cnVjdCBkbWFfZmVuY2UgKnJlYWwgPSBSRUFEX09OQ0UocC0+cmVhbCk7CisKKwlyZXR1cm4gcmVh
bCA/IHJlYWwtPm9wcy0+Z2V0X2RyaXZlcl9uYW1lKHJlYWwpIDogInByb3h5IjsKK30KKworc3Rh
dGljIGNvbnN0IGNoYXIgKnByb3h5X2dldF90aW1lbGluZV9uYW1lKHN0cnVjdCBkbWFfZmVuY2Ug
KmZlbmNlKQoreworCXN0cnVjdCBkbWFfZmVuY2VfcHJveHkgKnAgPSBjb250YWluZXJfb2YoZmVu
Y2UsIHR5cGVvZigqcCksIGJhc2UpOworCXN0cnVjdCBkbWFfZmVuY2UgKnJlYWwgPSBSRUFEX09O
Q0UocC0+cmVhbCk7CisKKwlyZXR1cm4gcmVhbCA/IHJlYWwtPm9wcy0+Z2V0X3RpbWVsaW5lX25h
bWUocmVhbCkgOiAidW5zZXQiOworfQorCitzdGF0aWMgdm9pZCBwcm94eV9pcnFfd29yayhzdHJ1
Y3QgaXJxX3dvcmsgKndvcmspCit7CisJc3RydWN0IGRtYV9mZW5jZV9wcm94eSAqcCA9IGNvbnRh
aW5lcl9vZih3b3JrLCB0eXBlb2YoKnApLCB3b3JrKTsKKworCWRtYV9mZW5jZV9zaWduYWwoJnAt
PmJhc2UpOworCWRtYV9mZW5jZV9wdXQoJnAtPmJhc2UpOworfQorCitzdGF0aWMgdm9pZCBwcm94
eV9jYWxsYmFjayhzdHJ1Y3QgZG1hX2ZlbmNlICpyZWFsLCBzdHJ1Y3QgZG1hX2ZlbmNlX2NiICpj
YikKK3sKKwlzdHJ1Y3QgZG1hX2ZlbmNlX3Byb3h5ICpwID0gY29udGFpbmVyX29mKGNiLCB0eXBl
b2YoKnApLCBjYik7CisKKwlpZiAocmVhbC0+ZXJyb3IpCisJCWRtYV9mZW5jZV9zZXRfZXJyb3Io
JnAtPmJhc2UsIHJlYWwtPmVycm9yKTsKKworCS8qIExvd2VyIHRoZSBoZWlnaHQgb2YgdGhlIHBy
b3h5IGNoYWluIC0+IHNpbmdsZSBzdGFjayBmcmFtZSAqLworCWlycV93b3JrX3F1ZXVlKCZwLT53
b3JrKTsKK30KKworc3RhdGljIGJvb2wgcHJveHlfZW5hYmxlX3NpZ25hbGluZyhzdHJ1Y3QgZG1h
X2ZlbmNlICpmZW5jZSkKK3sKKwlzdHJ1Y3QgZG1hX2ZlbmNlX3Byb3h5ICpwID0gY29udGFpbmVy
X29mKGZlbmNlLCB0eXBlb2YoKnApLCBiYXNlKTsKKwlzdHJ1Y3QgZG1hX2ZlbmNlICpyZWFsID0g
UkVBRF9PTkNFKHAtPnJlYWwpOworCWJvb2wgcmV0ID0gdHJ1ZTsKKworCWlmIChyZWFsKSB7CisJ
CXNwaW5fbG9ja19uZXN0ZWQocmVhbC0+bG9jaywKKwkJCQkgc2FtZV9sb2NrY2xhc3MoJnAtPndx
LmxvY2ssIHJlYWwtPmxvY2spKTsKKwkJcmV0ID0gX19kbWFfZmVuY2VfZW5hYmxlX3NpZ25hbGlu
ZyhyZWFsKTsKKwkJc3Bpbl91bmxvY2socmVhbC0+bG9jayk7CisJfQorCisJcmV0dXJuIHJldDsK
K30KKworc3RhdGljIHZvaWQgcHJveHlfcmVsZWFzZShzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSkK
K3sKKwlzdHJ1Y3QgZG1hX2ZlbmNlX3Byb3h5ICpwID0gY29udGFpbmVyX29mKGZlbmNlLCB0eXBl
b2YoKnApLCBiYXNlKTsKKworCWRtYV9mZW5jZV9wdXQocC0+cmVhbCk7CisJZG1hX2ZlbmNlX2Zy
ZWUoJnAtPmJhc2UpOworfQorCitjb25zdCBzdHJ1Y3QgZG1hX2ZlbmNlX29wcyBkbWFfZmVuY2Vf
cHJveHlfb3BzID0geworCS5nZXRfZHJpdmVyX25hbWUgPSBwcm94eV9nZXRfZHJpdmVyX25hbWUs
CisJLmdldF90aW1lbGluZV9uYW1lID0gcHJveHlfZ2V0X3RpbWVsaW5lX25hbWUsCisJLmVuYWJs
ZV9zaWduYWxpbmcgPSBwcm94eV9lbmFibGVfc2lnbmFsaW5nLAorCS53YWl0ID0gZG1hX2ZlbmNl
X2RlZmF1bHRfd2FpdCwKKwkucmVsZWFzZSA9IHByb3h5X3JlbGVhc2UsCit9OworRVhQT1JUX1NZ
TUJPTF9HUEwoZG1hX2ZlbmNlX3Byb3h5X29wcyk7CisKKy8qKgorICogZG1hX2ZlbmNlX2NyZWF0
ZV9wcm94eSAtIENyZWF0ZSBhbiB1bnNldCBkbWEtZmVuY2UKKyAqCisgKiBkbWFfZmVuY2VfY3Jl
YXRlX3Byb3h5KCkgY3JlYXRlcyBhIG5ldyBkbWFfZmVuY2Ugc3R1YiB0aGF0IGlzIGluaXRpYWxs
eQorICogdW5zaWduYWxlZCBhbmQgbWF5IGxhdGVyIGJlIHJlcGxhY2VkIHdpdGggYSByZWFsIGZl
bmNlLiBBbnkgbGlzdGVuZXJzCisgKiB0byB0aGUgcHJveHkgZmVuY2Ugd2lsbCBiZSBzaWduYWxl
ZCB3aGVuIHRoZSB0YXJnZXQgZmVuY2Ugc2lnbmFscyBpdHMKKyAqIGNvbXBsZXRpb24uCisgKi8K
K3N0cnVjdCBkbWFfZmVuY2UgKmRtYV9mZW5jZV9jcmVhdGVfcHJveHkodm9pZCkKK3sKKwlzdHJ1
Y3QgZG1hX2ZlbmNlX3Byb3h5ICpwOworCisJcCA9IGt6YWxsb2Moc2l6ZW9mKCpwKSwgR0ZQX0tF
Uk5FTCk7CisJaWYgKCFwKQorCQlyZXR1cm4gTlVMTDsKKworCWluaXRfd2FpdHF1ZXVlX2hlYWQo
JnAtPndxKTsKKwlkbWFfZmVuY2VfaW5pdCgmcC0+YmFzZSwgJmRtYV9mZW5jZV9wcm94eV9vcHMs
ICZwLT53cS5sb2NrLAorCQkgICAgICAgZG1hX2ZlbmNlX2NvbnRleHRfYWxsb2MoMSksIDApOwor
CWluaXRfaXJxX3dvcmsoJnAtPndvcmssIHByb3h5X2lycV93b3JrKTsKKworCXJldHVybiAmcC0+
YmFzZTsKK30KK0VYUE9SVF9TWU1CT0woZG1hX2ZlbmNlX2NyZWF0ZV9wcm94eSk7CisKK3N0YXRp
YyB2b2lkIHdyYXBfc2lnbmFsX2xvY2tlZChzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSwgc3RydWN0
IGRtYV9mZW5jZSAqcmVhbCkKK3sKKwlpZiAocmVhbC0+ZXJyb3IpCisJCWRtYV9mZW5jZV9zZXRf
ZXJyb3IoZmVuY2UsIHJlYWwtPmVycm9yKTsKKwlkbWFfZmVuY2Vfc2lnbmFsX2xvY2tlZChmZW5j
ZSk7Cit9CisKK3N0YXRpYyB2b2lkIF9fd2FrZV91cF9saXN0ZW5lcnMoc3RydWN0IGRtYV9mZW5j
ZV9wcm94eSAqcCkKK3sKKwlzdHJ1Y3Qgd2FpdF9xdWV1ZV9lbnRyeSAqd2FpdCwgKm5leHQ7CisK
KwlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUod2FpdCwgbmV4dCwgJnAtPndxLmhlYWQsIGVudHJ5
KSB7CisJCUlOSVRfTElTVF9IRUFEKCZ3YWl0LT5lbnRyeSk7CisJCXdhaXQtPmZ1bmMod2FpdCwg
VEFTS19OT1JNQUwsIDAsIHAtPnJlYWwpOworCX0KK30KKworc3RhdGljIHZvaWQgcHJveHlfYXNz
aWduKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLCBzdHJ1Y3QgZG1hX2ZlbmNlICpyZWFsKQorewor
CXN0cnVjdCBkbWFfZmVuY2VfcHJveHkgKnAgPSBjb250YWluZXJfb2YoZmVuY2UsIHR5cGVvZigq
cCksIGJhc2UpOworCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKKwlpZiAoV0FSTl9PTihmZW5jZSA9
PSByZWFsKSkKKwkJcmV0dXJuOworCisJaWYgKFdBUk5fT04odGVzdF9iaXQoRE1BX0ZFTkNFX0ZM
QUdfU0lHTkFMRURfQklULCAmZmVuY2UtPmZsYWdzKSkpCisJCXJldHVybjsKKworCWlmIChXQVJO
X09OKHAtPnJlYWwpKQorCQlyZXR1cm47CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgmcC0+d3EubG9j
aywgZmxhZ3MpOworCisJaWYgKHVubGlrZWx5KCFyZWFsKSkgeworCQlkbWFfZmVuY2Vfc2lnbmFs
X2xvY2tlZCgmcC0+YmFzZSk7CisJCWdvdG8gdW5sb2NrOworCX0KKworCXAtPnJlYWwgPSBkbWFf
ZmVuY2VfZ2V0KHJlYWwpOworCisJc3Bpbl9sb2NrX25lc3RlZChyZWFsLT5sb2NrLCBzYW1lX2xv
Y2tjbGFzcygmcC0+d3EubG9jaywgcmVhbC0+bG9jaykpOworCWlmIChkbWFfZmVuY2VfaXNfc2ln
bmFsZWQocmVhbCkpIHsKKwkJd3JhcF9zaWduYWxfbG9ja2VkKCZwLT5iYXNlLCByZWFsKTsKKwl9
IGVsc2UgaWYgKHRlc3RfYml0KERNQV9GRU5DRV9GTEFHX0VOQUJMRV9TSUdOQUxfQklULAorCQkJ
ICAgICZwLT5iYXNlLmZsYWdzKSAmJgorCQkgICAhX19kbWFfZmVuY2VfZW5hYmxlX3NpZ25hbGlu
ZyhyZWFsKSkgeworCQl3cmFwX3NpZ25hbF9sb2NrZWQoJnAtPmJhc2UsIHJlYWwpOworCX0gZWxz
ZSB7CisJCWRtYV9mZW5jZV9nZXQoJnAtPmJhc2UpOworCQlwLT5jYi5mdW5jID0gcHJveHlfY2Fs
bGJhY2s7CisJCWxpc3RfYWRkX3RhaWwoJnAtPmNiLm5vZGUsICZyZWFsLT5jYl9saXN0KTsKKwl9
CisJc3Bpbl91bmxvY2socmVhbC0+bG9jayk7CisKK3VubG9jazoKKwlfX3dha2VfdXBfbGlzdGVu
ZXJzKHApOworCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnAtPndxLmxvY2ssIGZsYWdzKTsKK30K
KworLyoqCisgKiBkbWFfZmVuY2VfcmVwbGFjZV9wcm94eSAtIFJlcGxhY2UgdGhlIHByb3h5IGZl
bmNlIHdpdGggdGhlIHJlYWwgdGFyZ2V0CisgKiBAc2xvdDogcG9pbnRlciB0byBsb2NhdGlvbiBv
ZiBmZW5jZSB0byB1cGRhdGUKKyAqIEBmZW5jZTogdGhlIG5ldyBmZW5jZSB0byBzdG9yZSBpbiBA
c2xvdAorICoKKyAqIE9uY2UgdGhlIHJlYWwgZG1hX2ZlbmNlIGlzIGtub3duLCB3ZSBjYW4gcmVw
bGFjZSB0aGUgcHJveHkgZmVuY2UgaG9sZGVyCisgKiB3aXRoIGEgcG9pbnRlciB0byB0aGUgcmVh
bCBkbWEgZmVuY2UuIEZ1dHVyZSBsaXN0ZW5lcnMgd2lsbCBhdHRhY2ggdG8KKyAqIHRoZSByZWFs
IGZlbmNlLCBhdm9pZGluZyBhbnkgaW5kaXJlY3Rpb24gb3ZlcmhlYWQuIFByZXZpb3VzIGxpc3Rl
bmVycworICogd2lsbCByZW1haW4gYXR0YWNoZWQgdG8gdGhlIHByb3h5IGZlbmNlLCBhbmQgYmUg
c2lnbmFsZWQgaW4gdHVybiB3aGVuCisgKiB0aGUgdGFyZ2V0IGZlbmNlIGNvbXBsZXRlcy4KKyAq
Lworc3RydWN0IGRtYV9mZW5jZSAqCitkbWFfZmVuY2VfcmVwbGFjZV9wcm94eShzdHJ1Y3QgZG1h
X2ZlbmNlIF9fcmN1ICoqc2xvdCwgc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCit7CisJc3RydWN0
IGRtYV9mZW5jZSAqb2xkOworCisJaWYgKGZlbmNlKQorCQlkbWFfZmVuY2VfZ2V0KGZlbmNlKTsK
KworCW9sZCA9IHJjdV9yZXBsYWNlX3BvaW50ZXIoKnNsb3QsIGZlbmNlLCB0cnVlKTsKKwlpZiAo
b2xkICYmIGRtYV9mZW5jZV9pc19wcm94eShvbGQpKQorCQlwcm94eV9hc3NpZ24ob2xkLCBmZW5j
ZSk7CisKKwlyZXR1cm4gb2xkOworfQorRVhQT1JUX1NZTUJPTChkbWFfZmVuY2VfcmVwbGFjZV9w
cm94eSk7CisKK3ZvaWQgZG1hX2ZlbmNlX2FkZF9wcm94eV9saXN0ZW5lcihzdHJ1Y3QgZG1hX2Zl
bmNlICpmZW5jZSwKKwkJCQkgIHN0cnVjdCB3YWl0X3F1ZXVlX2VudHJ5ICp3YWl0KQoreworCWlm
IChkbWFfZmVuY2VfaXNfcHJveHkoZmVuY2UpKSB7CisJCXN0cnVjdCBkbWFfZmVuY2VfcHJveHkg
KnAgPQorCQkJY29udGFpbmVyX29mKGZlbmNlLCB0eXBlb2YoKnApLCBiYXNlKTsKKwkJdW5zaWdu
ZWQgbG9uZyBmbGFnczsKKworCQlzcGluX2xvY2tfaXJxc2F2ZSgmcC0+d3EubG9jaywgZmxhZ3Mp
OworCQlpZiAoIWRtYV9mZW5jZV9pc19zaWduYWxlZCgmcC0+YmFzZSkpIHsKKwkJCWxpc3RfYWRk
X3RhaWwoJndhaXQtPmVudHJ5LCAmcC0+d3EuaGVhZCk7CisJCQl3YWl0ID0gTlVMTDsKKwkJfQor
CQlmZW5jZSA9IHAtPnJlYWw7CisJCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnAtPndxLmxvY2ss
IGZsYWdzKTsKKwl9CisKKwlpZiAod2FpdCkgeworCQlJTklUX0xJU1RfSEVBRCgmd2FpdC0+ZW50
cnkpOworCQl3YWl0LT5mdW5jKHdhaXQsIFRBU0tfTk9STUFMLCAwLCBmZW5jZSk7CisJfQorfQor
RVhQT1JUX1NZTUJPTChkbWFfZmVuY2VfYWRkX3Byb3h5X2xpc3RlbmVyKTsKKworYm9vbCBkbWFf
ZmVuY2VfcmVtb3ZlX3Byb3h5X2xpc3RlbmVyKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLAorCQkJ
CSAgICAgc3RydWN0IHdhaXRfcXVldWVfZW50cnkgKndhaXQpCit7CisJYm9vbCByZXQgPSBmYWxz
ZTsKKworCWlmIChkbWFfZmVuY2VfaXNfcHJveHkoZmVuY2UpKSB7CisJCXN0cnVjdCBkbWFfZmVu
Y2VfcHJveHkgKnAgPQorCQkJY29udGFpbmVyX29mKGZlbmNlLCB0eXBlb2YoKnApLCBiYXNlKTsK
KwkJdW5zaWduZWQgbG9uZyBmbGFnczsKKworCQlzcGluX2xvY2tfaXJxc2F2ZSgmcC0+d3EubG9j
aywgZmxhZ3MpOworCQlpZiAoIWxpc3RfZW1wdHkoJndhaXQtPmVudHJ5KSkgeworCQkJbGlzdF9k
ZWxfaW5pdCgmd2FpdC0+ZW50cnkpOworCQkJcmV0ID0gdHJ1ZTsKKwkJfQorCQlzcGluX3VubG9j
a19pcnFyZXN0b3JlKCZwLT53cS5sb2NrLCBmbGFncyk7CisJfQorCisJcmV0dXJuIHJldDsKK30K
K0VYUE9SVF9TWU1CT0woZG1hX2ZlbmNlX3JlbW92ZV9wcm94eV9saXN0ZW5lcik7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2RtYS1idWYvZG1hLWZlbmNlLmMgYi9kcml2ZXJzL2RtYS1idWYvZG1hLWZl
bmNlLmMKaW5kZXggMDUyYTQxZTI0NTFjLi5mYTdiZWRjNjcwM2QgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZG1hLWJ1Zi9kbWEtZmVuY2UuYworKysgYi9kcml2ZXJzL2RtYS1idWYvZG1hLWZlbmNlLmMK
QEAgLTE5LDYgKzE5LDggQEAKICNkZWZpbmUgQ1JFQVRFX1RSQUNFX1BPSU5UUwogI2luY2x1ZGUg
PHRyYWNlL2V2ZW50cy9kbWFfZmVuY2UuaD4KIAorI2luY2x1ZGUgImRtYS1mZW5jZS1wcml2YXRl
LmgiCisKIEVYUE9SVF9UUkFDRVBPSU5UX1NZTUJPTChkbWFfZmVuY2VfZW1pdCk7CiBFWFBPUlRf
VFJBQ0VQT0lOVF9TWU1CT0woZG1hX2ZlbmNlX2VuYWJsZV9zaWduYWwpOwogRVhQT1JUX1RSQUNF
UE9JTlRfU1lNQk9MKGRtYV9mZW5jZV9zaWduYWxlZCk7CkBAIC0yNzMsNyArMjc1LDcgQEAgdm9p
ZCBkbWFfZmVuY2VfZnJlZShzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSkKIH0KIEVYUE9SVF9TWU1C
T0woZG1hX2ZlbmNlX2ZyZWUpOwogCi1zdGF0aWMgYm9vbCBfX2RtYV9mZW5jZV9lbmFibGVfc2ln
bmFsaW5nKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlKQorYm9vbCBfX2RtYV9mZW5jZV9lbmFibGVf
c2lnbmFsaW5nKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlKQogewogCWJvb2wgd2FzX3NldDsKIApk
aWZmIC0tZ2l0IGEvZHJpdmVycy9kbWEtYnVmL3NlbGZ0ZXN0cy5oIGIvZHJpdmVycy9kbWEtYnVm
L3NlbGZ0ZXN0cy5oCmluZGV4IDU1OTE4ZWY5YWRhYi4uNjE2ZWNhNzBlMmQ4IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2RtYS1idWYvc2VsZnRlc3RzLmgKKysrIGIvZHJpdmVycy9kbWEtYnVmL3NlbGZ0
ZXN0cy5oCkBAIC0xMiwzICsxMiw0IEBACiBzZWxmdGVzdChzYW5pdHljaGVjaywgX19zYW5pdHlj
aGVja19fKSAvKiBrZWVwIGZpcnN0IChpZ3Qgc2VsZmNoZWNrKSAqLwogc2VsZnRlc3QoZG1hX2Zl
bmNlLCBkbWFfZmVuY2UpCiBzZWxmdGVzdChkbWFfZmVuY2VfY2hhaW4sIGRtYV9mZW5jZV9jaGFp
bikKK3NlbGZ0ZXN0KGRtYV9mZW5jZV9wcm94eSwgZG1hX2ZlbmNlX3Byb3h5KQpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9kbWEtYnVmL3N0LWRtYS1mZW5jZS1wcm94eS5jIGIvZHJpdmVycy9kbWEtYnVm
L3N0LWRtYS1mZW5jZS1wcm94eS5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAw
MDAwMC4uNjU4ZjZiOTBhYmM0Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9kbWEtYnVmL3N0
LWRtYS1mZW5jZS1wcm94eS5jCkBAIC0wLDAgKzEsNTgxIEBACisvLyBTUERYLUxpY2Vuc2UtSWRl
bnRpZmllcjogTUlUCisvKgorICogQ29weXJpZ2h0IMKpIDIwMTkgSW50ZWwgQ29ycG9yYXRpb24K
KyAqLworCisjaW5jbHVkZSA8bGludXgvZGVsYXkuaD4KKyNpbmNsdWRlIDxsaW51eC9kbWEtZmVu
Y2UuaD4KKyNpbmNsdWRlIDxsaW51eC9kbWEtZmVuY2UtcHJveHkuaD4KKyNpbmNsdWRlIDxsaW51
eC9rZXJuZWwuaD4KKyNpbmNsdWRlIDxsaW51eC9zY2hlZC9zaWduYWwuaD4KKyNpbmNsdWRlIDxs
aW51eC9zbGFiLmg+CisjaW5jbHVkZSA8bGludXgvc3BpbmxvY2suaD4KKworI2luY2x1ZGUgInNl
bGZ0ZXN0LmgiCisKK3N0YXRpYyBzdHJ1Y3Qga21lbV9jYWNoZSAqc2xhYl9mZW5jZXM7CisKK3N0
YXRpYyBzdHJ1Y3QgbW9ja19mZW5jZSB7CisJc3RydWN0IGRtYV9mZW5jZSBiYXNlOworCXNwaW5s
b2NrX3QgbG9jazsKK30gKnRvX21vY2tfZmVuY2Uoc3RydWN0IGRtYV9mZW5jZSAqZikgeworCXJl
dHVybiBjb250YWluZXJfb2YoZiwgc3RydWN0IG1vY2tfZmVuY2UsIGJhc2UpOworfQorCitzdGF0
aWMgY29uc3QgY2hhciAqbW9ja19uYW1lKHN0cnVjdCBkbWFfZmVuY2UgKmYpCit7CisJcmV0dXJu
ICJtb2NrIjsKK30KKworc3RhdGljIHZvaWQgbW9ja19mZW5jZV9yZWxlYXNlKHN0cnVjdCBkbWFf
ZmVuY2UgKmYpCit7CisJa21lbV9jYWNoZV9mcmVlKHNsYWJfZmVuY2VzLCB0b19tb2NrX2ZlbmNl
KGYpKTsKK30KKworc3RhdGljIGNvbnN0IHN0cnVjdCBkbWFfZmVuY2Vfb3BzIG1vY2tfb3BzID0g
eworCS5nZXRfZHJpdmVyX25hbWUgPSBtb2NrX25hbWUsCisJLmdldF90aW1lbGluZV9uYW1lID0g
bW9ja19uYW1lLAorCS5yZWxlYXNlID0gbW9ja19mZW5jZV9yZWxlYXNlLAorfTsKKworc3RhdGlj
IHN0cnVjdCBkbWFfZmVuY2UgKm1vY2tfZmVuY2Uodm9pZCkKK3sKKwlzdHJ1Y3QgbW9ja19mZW5j
ZSAqZjsKKworCWYgPSBrbWVtX2NhY2hlX2FsbG9jKHNsYWJfZmVuY2VzLCBHRlBfS0VSTkVMKTsK
KwlpZiAoIWYpCisJCXJldHVybiBOVUxMOworCisJc3Bpbl9sb2NrX2luaXQoJmYtPmxvY2spOwor
CWRtYV9mZW5jZV9pbml0KCZmLT5iYXNlLCAmbW9ja19vcHMsICZmLT5sb2NrLCAwLCAwKTsKKwor
CXJldHVybiAmZi0+YmFzZTsKK30KKworc3RhdGljIGludCBzYW5pdHljaGVjayh2b2lkICphcmcp
Cit7CisJc3RydWN0IGRtYV9mZW5jZSAqZjsKKworCWYgPSBkbWFfZmVuY2VfY3JlYXRlX3Byb3h5
KCk7CisJaWYgKCFmKQorCQlyZXR1cm4gLUVOT01FTTsKKworCWRtYV9mZW5jZV9zaWduYWwoZik7
CisJZG1hX2ZlbmNlX3B1dChmKTsKKworCXJldHVybiAwOworfQorCitzdHJ1Y3QgZmVuY2VzIHsK
KwlzdHJ1Y3QgZG1hX2ZlbmNlICpyZWFsOworCXN0cnVjdCBkbWFfZmVuY2UgKnByb3h5OworCXN0
cnVjdCBkbWFfZmVuY2UgX19yY3UgKnNsb3Q7Cit9OworCitzdGF0aWMgaW50IGNyZWF0ZV9mZW5j
ZXMoc3RydWN0IGZlbmNlcyAqZiwgYm9vbCBhdHRhY2gpCit7CisJZi0+cHJveHkgPSBkbWFfZmVu
Y2VfY3JlYXRlX3Byb3h5KCk7CisJaWYgKCFmLT5wcm94eSkKKwkJcmV0dXJuIC1FTk9NRU07CisK
KwlSQ1VfSU5JVF9QT0lOVEVSKGYtPnNsb3QsIGYtPnByb3h5KTsKKworCWYtPnJlYWwgPSBtb2Nr
X2ZlbmNlKCk7CisJaWYgKCFmLT5yZWFsKSB7CisJCWRtYV9mZW5jZV9wdXQoZi0+cHJveHkpOwor
CQlyZXR1cm4gLUVOT01FTTsKKwl9CisKKwlpZiAoYXR0YWNoKQorCQlkbWFfZmVuY2VfcmVwbGFj
ZV9wcm94eSgmZi0+c2xvdCwgZi0+cmVhbCk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHZv
aWQgZnJlZV9mZW5jZXMoc3RydWN0IGZlbmNlcyAqZikKK3sKKwlkbWFfZmVuY2VfcHV0KGRtYV9m
ZW5jZV9yZXBsYWNlX3Byb3h5KCZmLT5zbG90LCBOVUxMKSk7CisJZG1hX2ZlbmNlX3B1dChmLT5y
ZWFsKTsKKwlkbWFfZmVuY2VfcHV0KGYtPnByb3h5KTsKK30KKworc3RhdGljIGludCB3cmFwX3Np
Z25hbGluZyh2b2lkICphcmcpCit7CisJc3RydWN0IGZlbmNlcyBmOworCWludCBlcnIgPSAtRUlO
VkFMOworCisJaWYgKGNyZWF0ZV9mZW5jZXMoJmYsIHRydWUpKQorCQlyZXR1cm4gLUVOT01FTTsK
KworCWlmIChkbWFfZmVuY2VfaXNfc2lnbmFsZWQoZi5wcm94eSkpIHsKKwkJcHJfZXJyKCJGZW5j
ZSB1bmV4cGVjdGVkbHkgc2lnbmFsZWQgb24gY3JlYXRpb25cbiIpOworCQlnb3RvIGVycl9mcmVl
OworCX0KKworCWlmIChkbWFfZmVuY2Vfc2lnbmFsKGYucmVhbCkpIHsKKwkJcHJfZXJyKCJGZW5j
ZSByZXBvcnRlZCBiZWluZyBhbHJlYWR5IHNpZ25hbGVkXG4iKTsKKwkJZ290byBlcnJfZnJlZTsK
Kwl9CisKKwlpZiAoIWRtYV9mZW5jZV9pc19zaWduYWxlZChmLnByb3h5KSkgeworCQlwcl9lcnIo
IkZlbmNlIG5vdCByZXBvcnRpbmcgc2lnbmFsZWRcbiIpOworCQlnb3RvIGVycl9mcmVlOworCX0K
KworCWVyciA9IDA7CitlcnJfZnJlZToKKwlmcmVlX2ZlbmNlcygmZik7CisJcmV0dXJuIGVycjsK
K30KKworc3RhdGljIGludCB3cmFwX3NpZ25hbGluZ19yZWN1cnNlKHZvaWQgKmFyZykKK3sKKwlz
dHJ1Y3QgZmVuY2VzIGY7CisJc3RydWN0IGRtYV9mZW5jZSAqY2hhaW47CisJaW50IGVyciA9IC1F
SU5WQUw7CisKKwlpZiAoY3JlYXRlX2ZlbmNlcygmZiwgZmFsc2UpKQorCQlyZXR1cm4gLUVOT01F
TTsKKworCWNoYWluID0gZG1hX2ZlbmNlX2NyZWF0ZV9wcm94eSgpOworCWlmICghY2hhaW4pIHsK
KwkJZXJyID0gLUVOT01FTTsKKwkJZ290byBlcnJfZnJlZTsKKwl9CisKKwlkbWFfZmVuY2VfcmVw
bGFjZV9wcm94eSgmZi5zbG90LCBjaGFpbik7CisJZG1hX2ZlbmNlX3B1dChkbWFfZmVuY2VfcmVw
bGFjZV9wcm94eSgmZi5zbG90LCBmLnJlYWwpKTsKKwlkbWFfZmVuY2VfcHV0KGNoYWluKTsKKwor
CS8qIGYucmVhbCA8LSBjaGFpbiA8LSBmLnByb3h5ICovCisKKwlpZiAoZG1hX2ZlbmNlX2lzX3Np
Z25hbGVkKGYucHJveHkpKSB7CisJCXByX2VycigiRmVuY2UgdW5leHBlY3RlZGx5IHNpZ25hbGVk
IG9uIGNyZWF0aW9uXG4iKTsKKwkJZ290byBlcnJfZnJlZTsKKwl9CisKKwlpZiAoZG1hX2ZlbmNl
X3NpZ25hbChmLnJlYWwpKSB7CisJCXByX2VycigiRmVuY2UgcmVwb3J0ZWQgYmVpbmcgYWxyZWFk
eSBzaWduYWxlZFxuIik7CisJCWdvdG8gZXJyX2ZyZWU7CisJfQorCisJaWYgKCFkbWFfZmVuY2Vf
aXNfc2lnbmFsZWQoZi5wcm94eSkpIHsKKwkJcHJfZXJyKCJGZW5jZSBub3QgcmVwb3J0aW5nIHNp
Z25hbGVkXG4iKTsKKwkJZ290byBlcnJfZnJlZTsKKwl9CisKKwllcnIgPSAwOworZXJyX2ZyZWU6
CisJZnJlZV9mZW5jZXMoJmYpOworCXJldHVybiBlcnI7Cit9CisKK3N0cnVjdCBzaW1wbGVfY2Ig
eworCXN0cnVjdCBkbWFfZmVuY2VfY2IgY2I7CisJYm9vbCBzZWVuOworfTsKKworc3RhdGljIHZv
aWQgc2ltcGxlX2NhbGxiYWNrKHN0cnVjdCBkbWFfZmVuY2UgKmYsIHN0cnVjdCBkbWFfZmVuY2Vf
Y2IgKmNiKQoreworCXNtcF9zdG9yZV9tYihjb250YWluZXJfb2YoY2IsIHN0cnVjdCBzaW1wbGVf
Y2IsIGNiKS0+c2VlbiwgdHJ1ZSk7Cit9CisKK3N0YXRpYyBpbnQgd3JhcF9hZGRfY2FsbGJhY2so
dm9pZCAqYXJnKQoreworCXN0cnVjdCBzaW1wbGVfY2IgY2IgPSB7fTsKKwlzdHJ1Y3QgZmVuY2Vz
IGY7CisJaW50IGVyciA9IC1FSU5WQUw7CisKKwlpZiAoY3JlYXRlX2ZlbmNlcygmZiwgdHJ1ZSkp
CisJCXJldHVybiAtRU5PTUVNOworCisJaWYgKGRtYV9mZW5jZV9hZGRfY2FsbGJhY2soZi5wcm94
eSwgJmNiLmNiLCBzaW1wbGVfY2FsbGJhY2spKSB7CisJCXByX2VycigiRmFpbGVkIHRvIGFkZCBj
YWxsYmFjaywgZmVuY2UgYWxyZWFkeSBzaWduYWxlZCFcbiIpOworCQlnb3RvIGVycl9mcmVlOwor
CX0KKworCWRtYV9mZW5jZV9zaWduYWwoZi5yZWFsKTsKKwlpZiAoIWNiLnNlZW4pIHsKKwkJcHJf
ZXJyKCJDYWxsYmFjayBmYWlsZWQhXG4iKTsKKwkJZ290byBlcnJfZnJlZTsKKwl9CisKKwllcnIg
PSAwOworZXJyX2ZyZWU6CisJZnJlZV9mZW5jZXMoJmYpOworCXJldHVybiBlcnI7Cit9CisKK3N0
YXRpYyBpbnQgd3JhcF9hZGRfY2FsbGJhY2tfcmVjdXJzZSh2b2lkICphcmcpCit7CisJc3RydWN0
IHNpbXBsZV9jYiBjYiA9IHt9OworCXN0cnVjdCBkbWFfZmVuY2UgKmNoYWluOworCXN0cnVjdCBm
ZW5jZXMgZjsKKwlpbnQgZXJyID0gLUVJTlZBTDsKKworCWlmIChjcmVhdGVfZmVuY2VzKCZmLCBm
YWxzZSkpCisJCXJldHVybiAtRU5PTUVNOworCisJY2hhaW4gPSBkbWFfZmVuY2VfY3JlYXRlX3By
b3h5KCk7CisJaWYgKCFjaGFpbikgeworCQllcnIgPSAtRU5PTUVNOworCQlnb3RvIGVycl9mcmVl
OworCX0KKworCWRtYV9mZW5jZV9yZXBsYWNlX3Byb3h5KCZmLnNsb3QsIGNoYWluKTsKKwlkbWFf
ZmVuY2VfcHV0KGRtYV9mZW5jZV9yZXBsYWNlX3Byb3h5KCZmLnNsb3QsIGYucmVhbCkpOworCWRt
YV9mZW5jZV9wdXQoY2hhaW4pOworCisJLyogZi5yZWFsIDwtIGNoYWluIDwtIGYucHJveHkgKi8K
KworCWlmIChkbWFfZmVuY2VfYWRkX2NhbGxiYWNrKGYucHJveHksICZjYi5jYiwgc2ltcGxlX2Nh
bGxiYWNrKSkgeworCQlwcl9lcnIoIkZhaWxlZCB0byBhZGQgY2FsbGJhY2ssIGZlbmNlIGFscmVh
ZHkgc2lnbmFsZWQhXG4iKTsKKwkJZ290byBlcnJfZnJlZTsKKwl9CisKKwlkbWFfZmVuY2Vfc2ln
bmFsKGYucmVhbCk7CisJaWYgKCFjYi5zZWVuKSB7CisJCXByX2VycigiQ2FsbGJhY2sgZmFpbGVk
IVxuIik7CisJCWdvdG8gZXJyX2ZyZWU7CisJfQorCisJZXJyID0gMDsKK2Vycl9mcmVlOgorCWZy
ZWVfZmVuY2VzKCZmKTsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgaW50IHdyYXBfbGF0ZV9h
ZGRfY2FsbGJhY2sodm9pZCAqYXJnKQoreworCXN0cnVjdCBzaW1wbGVfY2IgY2IgPSB7fTsKKwlz
dHJ1Y3QgZmVuY2VzIGY7CisJaW50IGVyciA9IC1FSU5WQUw7CisKKwlpZiAoY3JlYXRlX2ZlbmNl
cygmZiwgdHJ1ZSkpCisJCXJldHVybiAtRU5PTUVNOworCisJZG1hX2ZlbmNlX3NpZ25hbChmLnJl
YWwpOworCisJaWYgKCFkbWFfZmVuY2VfYWRkX2NhbGxiYWNrKGYucHJveHksICZjYi5jYiwgc2lt
cGxlX2NhbGxiYWNrKSkgeworCQlwcl9lcnIoIkFkZGVkIGNhbGxiYWNrLCBidXQgZmVuY2Ugd2Fz
IGFscmVhZHkgc2lnbmFsZWQhXG4iKTsKKwkJZ290byBlcnJfZnJlZTsKKwl9CisKKwlkbWFfZmVu
Y2Vfc2lnbmFsKGYucmVhbCk7CisJaWYgKGNiLnNlZW4pIHsKKwkJcHJfZXJyKCJDYWxsYmFjayBj
YWxsZWQgYWZ0ZXIgZmFpbGVkIGF0dGFjaG1lbnQhXG4iKTsKKwkJZ290byBlcnJfZnJlZTsKKwl9
CisKKwllcnIgPSAwOworZXJyX2ZyZWU6CisJZnJlZV9mZW5jZXMoJmYpOworCXJldHVybiBlcnI7
Cit9CisKK3N0YXRpYyBpbnQgd3JhcF9lYXJseV9hZGRfY2FsbGJhY2sodm9pZCAqYXJnKQorewor
CXN0cnVjdCBzaW1wbGVfY2IgY2IgPSB7fTsKKwlzdHJ1Y3QgZmVuY2VzIGY7CisJaW50IGVyciA9
IC1FSU5WQUw7CisKKwlpZiAoY3JlYXRlX2ZlbmNlcygmZiwgZmFsc2UpKQorCQlyZXR1cm4gLUVO
T01FTTsKKworCWlmIChkbWFfZmVuY2VfYWRkX2NhbGxiYWNrKGYucHJveHksICZjYi5jYiwgc2lt
cGxlX2NhbGxiYWNrKSkgeworCQlwcl9lcnIoIkZhaWxlZCB0byBhZGQgY2FsbGJhY2ssIGZlbmNl
IGFscmVhZHkgc2lnbmFsZWQhXG4iKTsKKwkJZ290byBlcnJfZnJlZTsKKwl9CisKKwlkbWFfZmVu
Y2VfcmVwbGFjZV9wcm94eSgmZi5zbG90LCBmLnJlYWwpOworCWRtYV9mZW5jZV9zaWduYWwoZi5y
ZWFsKTsKKwlpZiAoIWNiLnNlZW4pIHsKKwkJcHJfZXJyKCJDYWxsYmFjayBmYWlsZWQhXG4iKTsK
KwkJZ290byBlcnJfZnJlZTsKKwl9CisKKwllcnIgPSAwOworZXJyX2ZyZWU6CisJZnJlZV9mZW5j
ZXMoJmYpOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQgd3JhcF9lYXJseV9hZGRfY2Fs
bGJhY2tfbGF0ZSh2b2lkICphcmcpCit7CisJc3RydWN0IHNpbXBsZV9jYiBjYiA9IHt9OworCXN0
cnVjdCBmZW5jZXMgZjsKKwlpbnQgZXJyID0gLUVJTlZBTDsKKworCWlmIChjcmVhdGVfZmVuY2Vz
KCZmLCBmYWxzZSkpCisJCXJldHVybiAtRU5PTUVNOworCisJZG1hX2ZlbmNlX3NpZ25hbChmLnJl
YWwpOworCisJaWYgKGRtYV9mZW5jZV9hZGRfY2FsbGJhY2soZi5wcm94eSwgJmNiLmNiLCBzaW1w
bGVfY2FsbGJhY2spKSB7CisJCXByX2VycigiRmFpbGVkIHRvIGFkZCBjYWxsYmFjaywgZmVuY2Ug
YWxyZWFkeSBzaWduYWxlZCFcbiIpOworCQlnb3RvIGVycl9mcmVlOworCX0KKworCWRtYV9mZW5j
ZV9yZXBsYWNlX3Byb3h5KCZmLnNsb3QsIGYucmVhbCk7CisJZG1hX2ZlbmNlX3NpZ25hbChmLnJl
YWwpOworCWlmICghY2Iuc2VlbikgeworCQlwcl9lcnIoIkNhbGxiYWNrIGZhaWxlZCFcbiIpOwor
CQlnb3RvIGVycl9mcmVlOworCX0KKworCWVyciA9IDA7CitlcnJfZnJlZToKKwlmcmVlX2ZlbmNl
cygmZik7CisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIGludCB3cmFwX2Vhcmx5X2FkZF9jYWxs
YmFja19lYXJseSh2b2lkICphcmcpCit7CisJc3RydWN0IHNpbXBsZV9jYiBjYiA9IHt9OworCXN0
cnVjdCBmZW5jZXMgZjsKKwlpbnQgZXJyID0gLUVJTlZBTDsKKworCWlmIChjcmVhdGVfZmVuY2Vz
KCZmLCBmYWxzZSkpCisJCXJldHVybiAtRU5PTUVNOworCisJaWYgKGRtYV9mZW5jZV9hZGRfY2Fs
bGJhY2soZi5wcm94eSwgJmNiLmNiLCBzaW1wbGVfY2FsbGJhY2spKSB7CisJCXByX2VycigiRmFp
bGVkIHRvIGFkZCBjYWxsYmFjaywgZmVuY2UgYWxyZWFkeSBzaWduYWxlZCFcbiIpOworCQlnb3Rv
IGVycl9mcmVlOworCX0KKworCWRtYV9mZW5jZV9yZXBsYWNlX3Byb3h5KCZmLnNsb3QsIGYucmVh
bCk7CisJZG1hX2ZlbmNlX3NpZ25hbChmLnJlYWwpOworCWlmICghY2Iuc2VlbikgeworCQlwcl9l
cnIoIkNhbGxiYWNrIGZhaWxlZCFcbiIpOworCQlnb3RvIGVycl9mcmVlOworCX0KKworCWVyciA9
IDA7CitlcnJfZnJlZToKKwlmcmVlX2ZlbmNlcygmZik7CisJcmV0dXJuIGVycjsKK30KKworc3Rh
dGljIGludCB3cmFwX3JtX2NhbGxiYWNrKHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3Qgc2ltcGxlX2Ni
IGNiID0ge307CisJc3RydWN0IGZlbmNlcyBmOworCWludCBlcnIgPSAtRUlOVkFMOworCisJaWYg
KGNyZWF0ZV9mZW5jZXMoJmYsIHRydWUpKQorCQlyZXR1cm4gLUVOT01FTTsKKworCWlmIChkbWFf
ZmVuY2VfYWRkX2NhbGxiYWNrKGYucHJveHksICZjYi5jYiwgc2ltcGxlX2NhbGxiYWNrKSkgewor
CQlwcl9lcnIoIkZhaWxlZCB0byBhZGQgY2FsbGJhY2ssIGZlbmNlIGFscmVhZHkgc2lnbmFsZWQh
XG4iKTsKKwkJZ290byBlcnJfZnJlZTsKKwl9CisKKwlpZiAoIWRtYV9mZW5jZV9yZW1vdmVfY2Fs
bGJhY2soZi5wcm94eSwgJmNiLmNiKSkgeworCQlwcl9lcnIoIkZhaWxlZCB0byByZW1vdmUgY2Fs
bGJhY2shXG4iKTsKKwkJZ290byBlcnJfZnJlZTsKKwl9CisKKwlkbWFfZmVuY2Vfc2lnbmFsKGYu
cmVhbCk7CisJaWYgKGNiLnNlZW4pIHsKKwkJcHJfZXJyKCJDYWxsYmFjayBzdGlsbCBzaWduYWxl
ZCBhZnRlciByZW1vdmFsIVxuIik7CisJCWdvdG8gZXJyX2ZyZWU7CisJfQorCisJZXJyID0gMDsK
K2Vycl9mcmVlOgorCWZyZWVfZmVuY2VzKCZmKTsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMg
aW50IHdyYXBfbGF0ZV9ybV9jYWxsYmFjayh2b2lkICphcmcpCit7CisJc3RydWN0IHNpbXBsZV9j
YiBjYiA9IHt9OworCXN0cnVjdCBmZW5jZXMgZjsKKwlpbnQgZXJyID0gLUVJTlZBTDsKKworCWlm
IChjcmVhdGVfZmVuY2VzKCZmLCB0cnVlKSkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlpZiAoZG1h
X2ZlbmNlX2FkZF9jYWxsYmFjayhmLnByb3h5LCAmY2IuY2IsIHNpbXBsZV9jYWxsYmFjaykpIHsK
KwkJcHJfZXJyKCJGYWlsZWQgdG8gYWRkIGNhbGxiYWNrLCBmZW5jZSBhbHJlYWR5IHNpZ25hbGVk
IVxuIik7CisJCWdvdG8gZXJyX2ZyZWU7CisJfQorCisJZG1hX2ZlbmNlX3NpZ25hbChmLnJlYWwp
OworCWlmICghY2Iuc2VlbikgeworCQlwcl9lcnIoIkNhbGxiYWNrIGZhaWxlZCFcbiIpOworCQln
b3RvIGVycl9mcmVlOworCX0KKworCWlmIChkbWFfZmVuY2VfcmVtb3ZlX2NhbGxiYWNrKGYucHJv
eHksICZjYi5jYikpIHsKKwkJcHJfZXJyKCJDYWxsYmFjayByZW1vdmFsIHN1Y2NlZWQgYWZ0ZXIg
YmVpbmcgZXhlY3V0ZWQhXG4iKTsKKwkJZ290byBlcnJfZnJlZTsKKwl9CisKKwllcnIgPSAwOwor
ZXJyX2ZyZWU6CisJZnJlZV9mZW5jZXMoJmYpOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBp
bnQgd3JhcF9zdGF0dXModm9pZCAqYXJnKQoreworCXN0cnVjdCBmZW5jZXMgZjsKKwlpbnQgZXJy
ID0gLUVJTlZBTDsKKworCWlmIChjcmVhdGVfZmVuY2VzKCZmLCB0cnVlKSkKKwkJcmV0dXJuIC1F
Tk9NRU07CisKKwlpZiAoZG1hX2ZlbmNlX2dldF9zdGF0dXMoZi5wcm94eSkpIHsKKwkJcHJfZXJy
KCJGZW5jZSB1bmV4cGVjdGVkbHkgaGFzIHNpZ25hbGVkIHN0YXR1cyBvbiBjcmVhdGlvblxuIik7
CisJCWdvdG8gZXJyX2ZyZWU7CisJfQorCisJZG1hX2ZlbmNlX3NpZ25hbChmLnJlYWwpOworCWlm
ICghZG1hX2ZlbmNlX2dldF9zdGF0dXMoZi5wcm94eSkpIHsKKwkJcHJfZXJyKCJGZW5jZSBub3Qg
cmVwb3J0aW5nIHNpZ25hbGVkIHN0YXR1c1xuIik7CisJCWdvdG8gZXJyX2ZyZWU7CisJfQorCisJ
ZXJyID0gMDsKK2Vycl9mcmVlOgorCWZyZWVfZmVuY2VzKCZmKTsKKwlyZXR1cm4gZXJyOworfQor
CitzdGF0aWMgaW50IHdyYXBfZXJyb3Iodm9pZCAqYXJnKQoreworCXN0cnVjdCBmZW5jZXMgZjsK
KwlpbnQgZXJyID0gLUVJTlZBTDsKKworCWlmIChjcmVhdGVfZmVuY2VzKCZmLCB0cnVlKSkKKwkJ
cmV0dXJuIC1FTk9NRU07CisKKwlkbWFfZmVuY2Vfc2V0X2Vycm9yKGYucmVhbCwgLUVJTyk7CisK
KwlpZiAoZG1hX2ZlbmNlX2dldF9zdGF0dXMoZi5wcm94eSkpIHsKKwkJcHJfZXJyKCJGZW5jZSB1
bmV4cGVjdGVkbHkgaGFzIGVycm9yIHN0YXR1cyBiZWZvcmUgc2lnbmFsXG4iKTsKKwkJZ290byBl
cnJfZnJlZTsKKwl9CisKKwlkbWFfZmVuY2Vfc2lnbmFsKGYucmVhbCk7CisJaWYgKGRtYV9mZW5j
ZV9nZXRfc3RhdHVzKGYucHJveHkpICE9IC1FSU8pIHsKKwkJcHJfZXJyKCJGZW5jZSBub3QgcmVw
b3J0aW5nIGVycm9yIHN0YXR1cywgZ290ICVkXG4iLAorCQkgICAgICAgZG1hX2ZlbmNlX2dldF9z
dGF0dXMoZi5wcm94eSkpOworCQlnb3RvIGVycl9mcmVlOworCX0KKworCWVyciA9IDA7CitlcnJf
ZnJlZToKKwlmcmVlX2ZlbmNlcygmZik7CisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIGludCB3
cmFwX3dhaXQodm9pZCAqYXJnKQoreworCXN0cnVjdCBmZW5jZXMgZjsKKwlpbnQgZXJyID0gLUVJ
TlZBTDsKKworCWlmIChjcmVhdGVfZmVuY2VzKCZmLCB0cnVlKSkKKwkJcmV0dXJuIC1FTk9NRU07
CisKKwlpZiAoZG1hX2ZlbmNlX3dhaXRfdGltZW91dChmLnByb3h5LCBmYWxzZSwgMCkgIT0gMCkg
eworCQlwcl9lcnIoIldhaXQgcmVwb3J0ZWQgY29tcGxldGUgYmVmb3JlIGJlaW5nIHNpZ25hbGVk
XG4iKTsKKwkJZ290byBlcnJfZnJlZTsKKwl9CisKKwlkbWFfZmVuY2Vfc2lnbmFsKGYucmVhbCk7
CisKKwlpZiAoZG1hX2ZlbmNlX3dhaXRfdGltZW91dChmLnByb3h5LCBmYWxzZSwgMCkgPT0gMCkg
eworCQlwcl9lcnIoIldhaXQgcmVwb3J0ZWQgaW5jb21wbGV0ZSBhZnRlciBiZWluZyBzaWduYWxl
ZFxuIik7CisJCWdvdG8gZXJyX2ZyZWU7CisJfQorCisJZXJyID0gMDsKK2Vycl9mcmVlOgorCWRt
YV9mZW5jZV9zaWduYWwoZi5yZWFsKTsKKwlmcmVlX2ZlbmNlcygmZik7CisJcmV0dXJuIGVycjsK
K30KKworc3RydWN0IHdhaXRfdGltZXIgeworCXN0cnVjdCB0aW1lcl9saXN0IHRpbWVyOworCXN0
cnVjdCBmZW5jZXMgZjsKK307CisKK3N0YXRpYyB2b2lkIHdhaXRfdGltZXIoc3RydWN0IHRpbWVy
X2xpc3QgKnRpbWVyKQoreworCXN0cnVjdCB3YWl0X3RpbWVyICp3dCA9IGZyb21fdGltZXIod3Qs
IHRpbWVyLCB0aW1lcik7CisKKwlkbWFfZmVuY2Vfc2lnbmFsKHd0LT5mLnJlYWwpOworfQorCitz
dGF0aWMgaW50IHdyYXBfd2FpdF90aW1lb3V0KHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3Qgd2FpdF90
aW1lciB3dDsKKwlpbnQgZXJyID0gLUVJTlZBTDsKKworCWlmIChjcmVhdGVfZmVuY2VzKCZ3dC5m
LCB0cnVlKSkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwl0aW1lcl9zZXR1cF9vbl9zdGFjaygmd3Qu
dGltZXIsIHdhaXRfdGltZXIsIDApOworCisJaWYgKGRtYV9mZW5jZV93YWl0X3RpbWVvdXQod3Qu
Zi5wcm94eSwgZmFsc2UsIDEpICE9IDApIHsKKwkJcHJfZXJyKCJXYWl0IHJlcG9ydGVkIGNvbXBs
ZXRlIGJlZm9yZSBiZWluZyBzaWduYWxlZFxuIik7CisJCWdvdG8gZXJyX2ZyZWU7CisJfQorCisJ
bW9kX3RpbWVyKCZ3dC50aW1lciwgamlmZmllcyArIDEpOworCisJaWYgKGRtYV9mZW5jZV93YWl0
X3RpbWVvdXQod3QuZi5wcm94eSwgZmFsc2UsIDIpICE9IDApIHsKKwkJaWYgKHRpbWVyX3BlbmRp
bmcoJnd0LnRpbWVyKSkgeworCQkJcHJfbm90aWNlKCJUaW1lciBkaWQgbm90IGZpcmUgd2l0aGlu
IHRoZSBqaWZmaWUhXG4iKTsKKwkJCWVyciA9IDA7IC8qIG5vdCBvdXIgZmF1bHQhICovCisJCX0g
ZWxzZSB7CisJCQlwcl9lcnIoIldhaXQgcmVwb3J0ZWQgaW5jb21wbGV0ZSBhZnRlciB0aW1lb3V0
XG4iKTsKKwkJfQorCQlnb3RvIGVycl9mcmVlOworCX0KKworCWVyciA9IDA7CitlcnJfZnJlZToK
KwlkZWxfdGltZXJfc3luYygmd3QudGltZXIpOworCWRlc3Ryb3lfdGltZXJfb25fc3RhY2soJnd0
LnRpbWVyKTsKKwlkbWFfZmVuY2Vfc2lnbmFsKHd0LmYucmVhbCk7CisJZnJlZV9mZW5jZXMoJnd0
LmYpOworCXJldHVybiBlcnI7Cit9CisKK2ludCBkbWFfZmVuY2VfcHJveHkodm9pZCkKK3sKKwlz
dGF0aWMgY29uc3Qgc3RydWN0IHN1YnRlc3QgdGVzdHNbXSA9IHsKKwkJU1VCVEVTVChzYW5pdHlj
aGVjayksCisJCVNVQlRFU1Qod3JhcF9zaWduYWxpbmcpLAorCQlTVUJURVNUKHdyYXBfc2lnbmFs
aW5nX3JlY3Vyc2UpLAorCQlTVUJURVNUKHdyYXBfYWRkX2NhbGxiYWNrKSwKKwkJU1VCVEVTVCh3
cmFwX2FkZF9jYWxsYmFja19yZWN1cnNlKSwKKwkJU1VCVEVTVCh3cmFwX2xhdGVfYWRkX2NhbGxi
YWNrKSwKKwkJU1VCVEVTVCh3cmFwX2Vhcmx5X2FkZF9jYWxsYmFjayksCisJCVNVQlRFU1Qod3Jh
cF9lYXJseV9hZGRfY2FsbGJhY2tfbGF0ZSksCisJCVNVQlRFU1Qod3JhcF9lYXJseV9hZGRfY2Fs
bGJhY2tfZWFybHkpLAorCQlTVUJURVNUKHdyYXBfcm1fY2FsbGJhY2spLAorCQlTVUJURVNUKHdy
YXBfbGF0ZV9ybV9jYWxsYmFjayksCisJCVNVQlRFU1Qod3JhcF9zdGF0dXMpLAorCQlTVUJURVNU
KHdyYXBfZXJyb3IpLAorCQlTVUJURVNUKHdyYXBfd2FpdCksCisJCVNVQlRFU1Qod3JhcF93YWl0
X3RpbWVvdXQpLAorCX07CisJaW50IHJldDsKKworCXNsYWJfZmVuY2VzID0gS01FTV9DQUNIRSht
b2NrX2ZlbmNlLAorCQkJCSBTTEFCX1RZUEVTQUZFX0JZX1JDVSB8CisJCQkJIFNMQUJfSFdDQUNI
RV9BTElHTik7CisJaWYgKCFzbGFiX2ZlbmNlcykKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlyZXQg
PSBzdWJ0ZXN0cyh0ZXN0cywgTlVMTCk7CisKKwlrbWVtX2NhY2hlX2Rlc3Ryb3koc2xhYl9mZW5j
ZXMpOworCisJcmV0dXJuIHJldDsKK30KZGlmZiAtLWdpdCBhL2luY2x1ZGUvbGludXgvZG1hLWZl
bmNlLXByb3h5LmggYi9pbmNsdWRlL2xpbnV4L2RtYS1mZW5jZS1wcm94eS5oCm5ldyBmaWxlIG1v
ZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uMDYzY2RlNmI0MmM0Ci0tLSAvZGV2L251bGwK
KysrIGIvaW5jbHVkZS9saW51eC9kbWEtZmVuY2UtcHJveHkuaApAQCAtMCwwICsxLDM0IEBACisv
KiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogR1BMLTIuMC1vbmx5ICovCisvKgorICogZG1hLWZl
bmNlLXByb3h5OiBhbGxvd3Mgd2FpdGluZyB1cG9uIHVuc2V0IGFuZCBmdXR1cmUgZmVuY2VzCisg
KgorICogQ29weXJpZ2h0IChDKSAyMDE3IEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2lmbmRl
ZiBfX0xJTlVYX0RNQV9GRU5DRV9QUk9YWV9ICisjZGVmaW5lIF9fTElOVVhfRE1BX0ZFTkNFX1BS
T1hZX0gKKworI2luY2x1ZGUgPGxpbnV4L2tlcm5lbC5oPgorI2luY2x1ZGUgPGxpbnV4L2RtYS1m
ZW5jZS5oPgorCitzdHJ1Y3Qgd2FpdF9xdWV1ZV9lbnRyeTsKKworZXh0ZXJuIGNvbnN0IHN0cnVj
dCBkbWFfZmVuY2Vfb3BzIGRtYV9mZW5jZV9wcm94eV9vcHM7CisKK3N0cnVjdCBkbWFfZmVuY2Ug
KmRtYV9mZW5jZV9jcmVhdGVfcHJveHkodm9pZCk7CisKK3N0YXRpYyBpbmxpbmUgYm9vbCBkbWFf
ZmVuY2VfaXNfcHJveHkoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCit7CisJcmV0dXJuIGZlbmNl
LT5vcHMgPT0gJmRtYV9mZW5jZV9wcm94eV9vcHM7Cit9CisKK3N0cnVjdCBkbWFfZmVuY2UgKgor
ZG1hX2ZlbmNlX3JlcGxhY2VfcHJveHkoc3RydWN0IGRtYV9mZW5jZSBfX3JjdSAqKnNsb3QsCisJ
CQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSk7CisKK3ZvaWQgZG1hX2ZlbmNlX2FkZF9wcm94eV9s
aXN0ZW5lcihzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSwKKwkJCQkgIHN0cnVjdCB3YWl0X3F1ZXVl
X2VudHJ5ICp3YWl0KTsKK2Jvb2wgZG1hX2ZlbmNlX3JlbW92ZV9wcm94eV9saXN0ZW5lcihzdHJ1
Y3QgZG1hX2ZlbmNlICpmZW5jZSwKKwkJCQkgICAgIHN0cnVjdCB3YWl0X3F1ZXVlX2VudHJ5ICp3
YWl0KTsKKworI2VuZGlmIC8qIF9fTElOVVhfRE1BX0ZFTkNFX1BST1hZX0ggKi8KLS0gCjIuMjAu
MQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwt
Z2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8v
bGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

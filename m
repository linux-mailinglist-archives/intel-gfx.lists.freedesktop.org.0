Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8F226B8F23
	for <lists+intel-gfx@lfdr.de>; Fri, 20 Sep 2019 13:42:55 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8593B6FC9F;
	Fri, 20 Sep 2019 11:42:50 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl
 [IPv6:2a02:2308::216:3eff:fe92:dfa3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BE5876FC9F
 for <intel-gfx@lists.freedesktop.org>; Fri, 20 Sep 2019 11:42:43 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 20 Sep 2019 13:42:33 +0200
Message-Id: <20190920114235.22411-21-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190920114235.22411-1-maarten.lankhorst@linux.intel.com>
References: <20190920114235.22411-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 21/23] drm/i915: Make sure watermarks work
 correctly with bigjoiner as well.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Rm9yIGJpZ2pvaW5lciwgd2UgY2Fubm90IGRvIGRybV9hdG9taWNfY3J0Y19zdGF0ZV9mb3JfZWFj
aF9wbGFuZV9zdGF0ZSgpCm9uIHRoZSBjcnRjLCBiZWNhdXNlIHBsYW5lcyBkb24ndCBtYXRjaCB0
aGUgZHJtIGNvcmUgc3RhdGUuCldlIG5lZWQgYSBzZXBhcmF0ZSBtYXN0ZXJfcGxhbmVfc3RhdGUg
Zm9yIGFsbCB0aGUgcHJvcGVydGllcywKYW5kIGEgc2xhdmVfcGxhbmVfc3RhdGUgZm9yIHRoZSBy
ZWN0YW5nbGVzL3Zpc2liaWxpdHkgZXRjLgoKVGhpcyBpcyBzaW1pbGFyIHRvIGhvdyB3ZSBoYW5k
bGUgdGhlIFkgcGxhbmUsIGJlY2F1c2UgaXQgd29uJ3QgYmUKZGlyZWN0bHkgY2FsY3VsYXRlZCBl
aXRoZXIuIEluc3RlYWQgaXQncyBjYWxjdWxhdGVkIGZyb20gdGhlIG1hc3RlcgpjcnRjLgoKQWRk
IGEgaW50ZWxfYXRvbWljX2NydGNfc3RhdGVfZm9yX2VhY2hfcGxhbmVfc3RhdGUgbWFjcm8sIHdo
aWNoCml0ZXJhdGVzIG92ZXIgbWFzdGVyX3BsYW5lX3N0YXRlIGFuZCBvYnRhaW5zIHNsYXZlX3Bs
YW5lX3N0YXRlCmFzIHdlbGwuIFRoaXMgY2xlYW5zIHVwIGNvZGUgc2xpZ2h0bHkgYXMgd2VsbC4K
ClNpZ25lZC1vZmYtYnk6IE1hYXJ0ZW4gTGFua2hvcnN0IDxtYWFydGVuLmxhbmtob3JzdEBsaW51
eC5pbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9t
aWMuYyAgIHwgICAyICstCiAuLi4vZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljX3Bs
YW5lLmMgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxh
eS5oICB8ICAyMCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYyAgICAgICAgICAg
ICAgIHwgMjAxICsrKysrKysrKystLS0tLS0tLQogNCBmaWxlcyBjaGFuZ2VkLCAxMzQgaW5zZXJ0
aW9ucygrKSwgOTMgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfYXRvbWljLmMKaW5kZXggYThmMzQyNTRjZDJhLi5hZGQ3N2UzM2U1NGUgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYwpAQCAtMjk3LDcgKzI5Nyw3
IEBAIHN0YXRpYyB2b2lkIGludGVsX2F0b21pY19zZXR1cF9zY2FsZXIoc3RydWN0IGludGVsX2Ny
dGNfc2NhbGVyX3N0YXRlICpzY2FsZXJfc3RhCiAJCXJldHVybjsKIAogCS8qIHNldCBzY2FsZXIg
bW9kZSAqLwotCWlmIChwbGFuZV9zdGF0ZSAmJiAocGxhbmVfc3RhdGUtPmxpbmtlZF9wbGFuZSB8
fAorCWlmIChwbGFuZV9zdGF0ZSAmJiAocGxhbmVfc3RhdGUtPnBsYW5hcl9saW5rZWRfcGxhbmUg
fHwKIAkgICAgICghcGxhbmVfc3RhdGUtPmJpZ2pvaW5lcl9zbGF2ZSAmJiBwbGFuZV9zdGF0ZS0+
YmFzZS5mYiAmJgogCSAgICAgIHBsYW5lX3N0YXRlLT5iYXNlLmZiLT5mb3JtYXQtPmlzX3l1diAm
JgogCSAgICAgIHBsYW5lX3N0YXRlLT5iYXNlLmZiLT5mb3JtYXQtPm51bV9wbGFuZXMgPiAxKSkp
IHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWlj
X3BsYW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19wbGFu
ZS5jCmluZGV4IDlmY2E5ZTkwYWY1OC4uZjQ3MWJiMzBjMjBhIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19wbGFuZS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljX3BsYW5lLmMKQEAgLTQxNCwxNCArNDE0
LDE0IEBAIHZvaWQgaWNsX3VwZGF0ZV9iaWdqb2luZXJfcGxhbmVzX29uX2NydGMoc3RydWN0IGlu
dGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAKIAkJCWludGVsX3VwZGF0ZV9zbGF2ZShwbGFuZSwg
bmV3X2NydGNfc3RhdGUsCiAJCQkJCSAgIG1hc3Rlcl9wbGFuZV9zdGF0ZSwgbmV3X3BsYW5lX3N0
YXRlKTsKLQkJfSBlbHNlIGlmIChuZXdfcGxhbmVfc3RhdGUtPnNsYXZlKSB7CisJCX0gZWxzZSBp
ZiAobmV3X3BsYW5lX3N0YXRlLT5wbGFuYXJfc2xhdmUpIHsKIAkJCS8qCiAJCQkgKiBiaWdqb2lu
ZXIgc2xhdmUgKyBwbGFuYXIgc2xhdmUuCiAJCQkgKiBUaGUgY29ycmVjdCBzZXF1ZW5jZSBpcyB0
byBnZXQgZnJvbSB0aGUgcGxhbmFyIHNsYXZlIHRvIHBsYW5hciBtYXN0ZXIsCiAJCQkgKiB0aGVu
IHRvIHRoZSBtYXN0ZXIgcGxhbmUgc3RhdGUgZm9yIHRoZSBtYXN0ZXJfcGxhbmVfc3RhdGUuCiAJ
CQkgKi8KIAotCQkJc3RydWN0IGludGVsX3BsYW5lICpsaW5rZWQgPSBuZXdfcGxhbmVfc3RhdGUt
PmxpbmtlZF9wbGFuZTsKKwkJCXN0cnVjdCBpbnRlbF9wbGFuZSAqbGlua2VkID0gbmV3X3BsYW5l
X3N0YXRlLT5wbGFuYXJfbGlua2VkX3BsYW5lOwogCQkJY29uc3Qgc3RydWN0IGludGVsX3BsYW5l
X3N0YXRlICp1dl9wbGFuZV9zdGF0ZSA9CiAJCQkJaW50ZWxfYXRvbWljX2dldF9uZXdfcGxhbmVf
c3RhdGUoc3RhdGUsIGxpbmtlZCk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kaXNwbGF5LmgKaW5kZXggYThiMjE5OGZjZWYxLi4xNDcxN2E1OWU2NzcgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5oCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5oCkBAIC0zNTAsNyArMzUw
LDcgQEAgZW51bSBwaHlfZmlhIHsKIAkJCSAgICAmKGRldiktPm1vZGVfY29uZmlnLnBsYW5lX2xp
c3QsCQlcCiAJCQkgICAgYmFzZS5oZWFkKQkJCQkJXAogCQlmb3JfZWFjaF9pZigocGxhbmVfbWFz
aykgJgkJCQlcCi0JCQkgICAgZHJtX3BsYW5lX21hc2soJmludGVsX3BsYW5lLT5iYXNlKSkpCisJ
CQkgICAgZHJtX3BsYW5lX21hc2soJmludGVsX3BsYW5lLT5iYXNlKSkKIAogI2RlZmluZSBmb3Jf
ZWFjaF9pbnRlbF9wbGFuZV9vbl9jcnRjKGRldiwgaW50ZWxfY3J0YywgaW50ZWxfcGxhbmUpCVwK
IAlsaXN0X2Zvcl9lYWNoX2VudHJ5KGludGVsX3BsYW5lLAkJCQlcCkBAIC00NDAsNiArNDQwLDI0
IEBAIGVudW0gcGh5X2ZpYSB7CiAJICAgICAoX19pKS0tKSBcCiAJCWZvcl9lYWNoX2lmKGNydGMp
CiAKKyNkZWZpbmUgaW50ZWxfYXRvbWljX2NydGNfc3RhdGVfZm9yX2VhY2hfcGxhbmVfc3RhdGUo
IFwKKwkJICBwbGFuZSwgbWFzdGVyX3BsYW5lX3N0YXRlLCBwbGFuZV9zdGF0ZSwgXAorCQkgIGNy
dGNfc3RhdGUpIFwKKwlmb3JfZWFjaF9pbnRlbF9wbGFuZV9tYXNrKCgoY3J0Y19zdGF0ZSktPnVh
cGkuc3RhdGUtPmRldiksIChwbGFuZSksIFwKKwkJICAoKChjcnRjX3N0YXRlKS0+Ymlnam9pbmVy
X3NsYXZlID8gXAorCQkJaW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZSggXAorCQkJCXRv
X2ludGVsX2F0b21pY19zdGF0ZSgoY3J0Y19zdGF0ZSktPnVhcGkuc3RhdGUpLCBcCisJCQkJKGNy
dGNfc3RhdGUpLT5iaWdqb2luZXJfbGlua2VkX2NydGMpIDogXAorCQkJCShjcnRjX3N0YXRlKSkt
PnVhcGkucGxhbmVfbWFzaykpIFwKKwkJZm9yX2VhY2hfaWYgKCgoKG1hc3Rlcl9wbGFuZV9zdGF0
ZSkgPSBcCisJCQkgICAgICB0b19pbnRlbF9wbGFuZV9zdGF0ZShfX2RybV9hdG9taWNfZ2V0X2N1
cnJlbnRfcGxhbmVfc3RhdGUoKGNydGNfc3RhdGUpLT51YXBpLnN0YXRlLCAmcGxhbmUtPmJhc2Up
KSksIFwKKwkJCSAgICAgICgocGxhbmUpID0gKG1hc3Rlcl9wbGFuZV9zdGF0ZSktPmJpZ2pvaW5l
cl9zbGF2ZSA/IFwKKwkJCQkJIChtYXN0ZXJfcGxhbmVfc3RhdGUpLT5iaWdqb2luZXJfcGxhbmUg
OiBcCisJCQkJCSAocGxhbmUpKSwgXAorCQkJICAgICAgKChwbGFuZV9zdGF0ZSkgPSAobWFzdGVy
X3BsYW5lX3N0YXRlKS0+Ymlnam9pbmVyX3NsYXZlID8gXAorCQkJCXRvX2ludGVsX3BsYW5lX3N0
YXRlKF9fZHJtX2F0b21pY19nZXRfY3VycmVudF9wbGFuZV9zdGF0ZSgoY3J0Y19zdGF0ZSktPnVh
cGkuc3RhdGUsICZwbGFuZS0+YmFzZSkpIDogXAorCQkJCSAgKG1hc3Rlcl9wbGFuZV9zdGF0ZSkp
KSkKKwogdm9pZCBpbnRlbF9saW5rX2NvbXB1dGVfbV9uKHUxNiBicHAsIGludCBubGFuZXMsCiAJ
CQkgICAgaW50IHBpeGVsX2Nsb2NrLCBpbnQgbGlua19jbG9jaywKIAkJCSAgICBzdHJ1Y3QgaW50
ZWxfbGlua19tX24gKm1fbiwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVs
X3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCmluZGV4IGFjYzg3Yjg0MzFm
My4uZWIzODliN2FjNTc4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9w
bS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKQEAgLTgxMiw4ICs4MTIs
MTAgQEAgc3RhdGljIGludCBpbnRlbF93bV9udW1fbGV2ZWxzKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKIAlyZXR1cm4gZGV2X3ByaXYtPndtLm1heF9sZXZlbCArIDE7CiB9CiAK
LXN0YXRpYyBib29sIGludGVsX3dtX3BsYW5lX3Zpc2libGUoY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCQkJICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0
YXRlICpwbGFuZV9zdGF0ZSkKK3N0YXRpYyBib29sCitpbnRlbF93bV9wbGFuZV92aXNpYmxlKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkgICAgICAgY29uc3Qg
c3RydWN0IGludGVsX3BsYW5lX3N0YXRlICptYXN0ZXJfcGxhbmVfc3RhdGUsCisJCSAgICAgICBj
b25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVjdCBp
bnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFu
ZSk7CiAKQEAgLTgzMCw3ICs4MzIsNyBAQCBzdGF0aWMgYm9vbCBpbnRlbF93bV9wbGFuZV92aXNp
YmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCSAqIGFyb3Vu
ZCB0aGlzIHByb2JsZW0gd2l0aCB0aGUgd2F0ZXJtYXJrIGNvZGUuCiAJICovCiAJaWYgKHBsYW5l
LT5pZCA9PSBQTEFORV9DVVJTT1IpCi0JCXJldHVybiBwbGFuZV9zdGF0ZS0+YmFzZS5mYiAhPSBO
VUxMOworCQlyZXR1cm4gbWFzdGVyX3BsYW5lX3N0YXRlLT5iYXNlLmZiICE9IE5VTEw7CiAJZWxz
ZQogCQlyZXR1cm4gcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZTsKIH0KQEAgLTExMTQsNyArMTEx
Niw3IEBAIHN0YXRpYyB1MTYgZzR4X2NvbXB1dGVfd20oY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUsCiAJaWYgKGxhdGVuY3kgPT0gMCkKIAkJcmV0dXJuIFVTSFJUX01B
WDsKIAotCWlmICghaW50ZWxfd21fcGxhbmVfdmlzaWJsZShjcnRjX3N0YXRlLCBwbGFuZV9zdGF0
ZSkpCisJaWYgKCFpbnRlbF93bV9wbGFuZV92aXNpYmxlKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRl
LCBwbGFuZV9zdGF0ZSkpCiAJCXJldHVybiAwOwogCiAJY3BwID0gcGxhbmVfc3RhdGUtPmJhc2Uu
ZmItPmZvcm1hdC0+Y3BwWzBdOwpAQCAtMTIxMiw3ICsxMjE0LDcgQEAgc3RhdGljIGJvb2wgZzR4
X3Jhd19wbGFuZV93bV9jb21wdXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LAogCWJvb2wgZGlydHkgPSBmYWxzZTsKIAlpbnQgbGV2ZWw7CiAKLQlpZiAoIWludGVsX3dtX3Bs
YW5lX3Zpc2libGUoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpKSB7CisJaWYgKCFpbnRlbF93bV9w
bGFuZV92aXNpYmxlKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlLCBwbGFuZV9zdGF0ZSkpIHsKIAkJ
ZGlydHkgfD0gZzR4X3Jhd19wbGFuZV93bV9zZXQoY3J0Y19zdGF0ZSwgMCwgcGxhbmVfaWQsIDAp
OwogCQlpZiAocGxhbmVfaWQgPT0gUExBTkVfUFJJTUFSWSkKIAkJCWRpcnR5IHw9IGc0eF9yYXdf
ZmJjX3dtX3NldChjcnRjX3N0YXRlLCAwLCAwKTsKQEAgLTE2MjIsNyArMTYyNCw3IEBAIHN0YXRp
YyB1MTYgdmx2X2NvbXB1dGVfd21fbGV2ZWwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUsCiAJaWYgKGRldl9wcml2LT53bS5wcmlfbGF0ZW5jeVtsZXZlbF0gPT0gMCkK
IAkJcmV0dXJuIFVTSFJUX01BWDsKIAotCWlmICghaW50ZWxfd21fcGxhbmVfdmlzaWJsZShjcnRj
X3N0YXRlLCBwbGFuZV9zdGF0ZSkpCisJaWYgKCFpbnRlbF93bV9wbGFuZV92aXNpYmxlKGNydGNf
c3RhdGUsIHBsYW5lX3N0YXRlLCBwbGFuZV9zdGF0ZSkpCiAJCXJldHVybiAwOwogCiAJY3BwID0g
cGxhbmVfc3RhdGUtPmJhc2UuZmItPmZvcm1hdC0+Y3BwWzBdOwpAQCAtMTc4OSw3ICsxNzkxLDcg
QEAgc3RhdGljIGJvb2wgdmx2X3Jhd19wbGFuZV93bV9jb21wdXRlKHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlLAogCWludCBsZXZlbDsKIAlib29sIGRpcnR5ID0gZmFsc2U7CiAK
LQlpZiAoIWludGVsX3dtX3BsYW5lX3Zpc2libGUoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpKSB7
CisJaWYgKCFpbnRlbF93bV9wbGFuZV92aXNpYmxlKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlLCBw
bGFuZV9zdGF0ZSkpIHsKIAkJZGlydHkgfD0gdmx2X3Jhd19wbGFuZV93bV9zZXQoY3J0Y19zdGF0
ZSwgMCwgcGxhbmVfaWQsIDApOwogCQlnb3RvIG91dDsKIAl9CkBAIC0yNTA0LDcgKzI1MDYsNyBA
QCBzdGF0aWMgdTMyIGlsa19jb21wdXRlX3ByaV93bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSwKIAlpZiAobWVtX3ZhbHVlID09IDApCiAJCXJldHVybiBVMzJfTUFY
OwogCi0JaWYgKCFpbnRlbF93bV9wbGFuZV92aXNpYmxlKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRl
KSkKKwlpZiAoIWludGVsX3dtX3BsYW5lX3Zpc2libGUoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUs
IHBsYW5lX3N0YXRlKSkKIAkJcmV0dXJuIDA7CiAKIAljcHAgPSBwbGFuZV9zdGF0ZS0+YmFzZS5m
Yi0+Zm9ybWF0LT5jcHBbMF07CkBAIC0yNTM2LDcgKzI1MzgsNyBAQCBzdGF0aWMgdTMyIGlsa19j
b21wdXRlX3Nwcl93bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwK
IAlpZiAobWVtX3ZhbHVlID09IDApCiAJCXJldHVybiBVMzJfTUFYOwogCi0JaWYgKCFpbnRlbF93
bV9wbGFuZV92aXNpYmxlKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKSkKKwlpZiAoIWludGVsX3dt
X3BsYW5lX3Zpc2libGUoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUsIHBsYW5lX3N0YXRlKSkKIAkJ
cmV0dXJuIDA7CiAKIAljcHAgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYi0+Zm9ybWF0LT5jcHBbMF07
CkBAIC0yNTYyLDcgKzI1NjQsNyBAQCBzdGF0aWMgdTMyIGlsa19jb21wdXRlX2N1cl93bShjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlpZiAobWVtX3ZhbHVlID09
IDApCiAJCXJldHVybiBVMzJfTUFYOwogCi0JaWYgKCFpbnRlbF93bV9wbGFuZV92aXNpYmxlKGNy
dGNfc3RhdGUsIHBsYW5lX3N0YXRlKSkKKwlpZiAoIWludGVsX3dtX3BsYW5lX3Zpc2libGUoY3J0
Y19zdGF0ZSwgcGxhbmVfc3RhdGUsIHBsYW5lX3N0YXRlKSkKIAkJcmV0dXJuIDA7CiAKIAljcHAg
PSBwbGFuZV9zdGF0ZS0+YmFzZS5mYi0+Zm9ybWF0LT5jcHBbMF07CkBAIC0yNTc5LDcgKzI1ODEs
NyBAQCBzdGF0aWMgdTMyIGlsa19jb21wdXRlX2ZiY193bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIHsKIAlpbnQgY3BwOwogCi0JaWYgKCFpbnRlbF93bV9wbGFu
ZV92aXNpYmxlKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKSkKKwlpZiAoIWludGVsX3dtX3BsYW5l
X3Zpc2libGUoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUsIHBsYW5lX3N0YXRlKSkKIAkJcmV0dXJu
IDA7CiAKIAljcHAgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYi0+Zm9ybWF0LT5jcHBbMF07CkBAIC00
MDY0LDYgKzQwNjYsNyBAQCB2b2lkIHNrbF9kZGJfZ2V0X2h3X3N0YXRlKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKICAqLwogc3RhdGljIHVpbnRfZml4ZWRfMTZfMTZfdAogc2ts
X3BsYW5lX2Rvd25zY2FsZV9hbW91bnQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUsCisJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm1hc3Rlcl9w
bGFuZV9zdGF0ZSwKIAkJCSAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVf
c3RhdGUpCiB7CiAJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBs
YW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKQEAgLTQwNzEsNyArNDA3NCw4IEBAIHNrbF9wbGFuZV9k
b3duc2NhbGVfYW1vdW50KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LAogCXVpbnRfZml4ZWRfMTZfMTZfdCBmcF93X3JhdGlvLCBmcF9oX3JhdGlvOwogCXVpbnRfZml4
ZWRfMTZfMTZfdCBkb3duc2NhbGVfaCwgZG93bnNjYWxlX3c7CiAKLQlpZiAoV0FSTl9PTighaW50
ZWxfd21fcGxhbmVfdmlzaWJsZShjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSkpKQorCWlmIChXQVJO
X09OKCFpbnRlbF93bV9wbGFuZV92aXNpYmxlKGNydGNfc3RhdGUsCisJCQkJCSAgICBtYXN0ZXJf
cGxhbmVfc3RhdGUsIHBsYW5lX3N0YXRlKSkpCiAJCXJldHVybiB1MzJfdG9fZml4ZWQxNigwKTsK
IAogCS8qIG4uYi4sIHNyYyBpcyAxNi4xNiBmaXhlZCBwb2ludCwgZHN0IGlzIHdob2xlIGludGVn
ZXIgKi8KQEAgLTQwODAsMTAgKzQwODQsMTAgQEAgc2tsX3BsYW5lX2Rvd25zY2FsZV9hbW91bnQo
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCSAqIEN1cnNvcnMg
b25seSBzdXBwb3J0IDAvMTgwIGRlZ3JlZSByb3RhdGlvbiwKIAkJICogaGVuY2Ugbm8gbmVlZCB0
byBhY2NvdW50IGZvciByb3RhdGlvbiBoZXJlLgogCQkgKi8KLQkJc3JjX3cgPSBwbGFuZV9zdGF0
ZS0+YmFzZS5zcmNfdyA+PiAxNjsKLQkJc3JjX2ggPSBwbGFuZV9zdGF0ZS0+YmFzZS5zcmNfaCA+
PiAxNjsKLQkJZHN0X3cgPSBwbGFuZV9zdGF0ZS0+YmFzZS5jcnRjX3c7Ci0JCWRzdF9oID0gcGxh
bmVfc3RhdGUtPmJhc2UuY3J0Y19oOworCQlzcmNfdyA9IG1hc3Rlcl9wbGFuZV9zdGF0ZS0+YmFz
ZS5zcmNfdyA+PiAxNjsKKwkJc3JjX2ggPSBtYXN0ZXJfcGxhbmVfc3RhdGUtPmJhc2Uuc3JjX2gg
Pj4gMTY7CisJCWRzdF93ID0gbWFzdGVyX3BsYW5lX3N0YXRlLT5iYXNlLmNydGNfdzsKKwkJZHN0
X2ggPSBtYXN0ZXJfcGxhbmVfc3RhdGUtPmJhc2UuY3J0Y19oOwogCX0gZWxzZSB7CiAJCS8qCiAJ
CSAqIFNyYyBjb29yZGluYXRlcyBhcmUgYWxyZWFkeSByb3RhdGVkIGJ5IDI3MCBkZWdyZWVzIGZv
cgpAQCAtNDE0MSw5ICs0MTQ1LDEwIEBAIGludCBza2xfY2hlY2tfcGlwZV9tYXhfcGl4ZWxfcmF0
ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YywKIAkJCQkgIHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoaW50ZWxfY3J0Yy0+YmFzZS5kZXYpOwotCXN0cnVjdCBkcm1fYXRvbWljX3N0
YXRlICpzdGF0ZSA9IGNydGNfc3RhdGUtPnVhcGkuc3RhdGU7Ci0Jc3RydWN0IGRybV9wbGFuZSAq
cGxhbmU7Ci0JY29uc3Qgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqZHJtX3BsYW5lX3N0YXRlOwor
CXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlID0KKwkJdG9faW50ZWxfYXRvbWljX3N0
YXRlKGNydGNfc3RhdGUtPnVhcGkuc3RhdGUpOworCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmU7
CisJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICptYXN0ZXJfcGxhbmVfc3RhdGUsICpw
bGFuZV9zdGF0ZTsKIAlpbnQgY3J0Y19jbG9jaywgZG90Y2xrOwogCXUzMiBwaXBlX21heF9waXhl
bF9yYXRlOwogCXVpbnRfZml4ZWRfMTZfMTZfdCBwaXBlX2Rvd25zY2FsZTsKQEAgLTQxNTIsMjEg
KzQxNTcsMjQgQEAgaW50IHNrbF9jaGVja19waXBlX21heF9waXhlbF9yYXRlKHN0cnVjdCBpbnRl
bF9jcnRjICppbnRlbF9jcnRjLAogCWlmICghY3J0Y19zdGF0ZS0+aHcuZW5hYmxlKQogCQlyZXR1
cm4gMDsKIAotCWRybV9hdG9taWNfY3J0Y19zdGF0ZV9mb3JfZWFjaF9wbGFuZV9zdGF0ZShwbGFu
ZSwgZHJtX3BsYW5lX3N0YXRlLCAmY3J0Y19zdGF0ZS0+dWFwaSkgeworCWludGVsX2F0b21pY19j
cnRjX3N0YXRlX2Zvcl9lYWNoX3BsYW5lX3N0YXRlKHBsYW5lLCBtYXN0ZXJfcGxhbmVfc3RhdGUs
CisJCQkJCQkgICAgIHBsYW5lX3N0YXRlLCBjcnRjX3N0YXRlKSB7CiAJCXVpbnRfZml4ZWRfMTZf
MTZfdCBwbGFuZV9kb3duc2NhbGU7CiAJCXVpbnRfZml4ZWRfMTZfMTZfdCBmcF85X2Rpdl84ID0g
ZGl2X2ZpeGVkMTYoOSwgOCk7CiAJCWludCBicHA7Ci0JCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFu
ZV9zdGF0ZSAqcGxhbmVfc3RhdGUgPQotCQkJdG9faW50ZWxfcGxhbmVfc3RhdGUoZHJtX3BsYW5l
X3N0YXRlKTsKIAotCQlpZiAoIWludGVsX3dtX3BsYW5lX3Zpc2libGUoY3J0Y19zdGF0ZSwgcGxh
bmVfc3RhdGUpKQorCQlpZiAoIWludGVsX3dtX3BsYW5lX3Zpc2libGUoY3J0Y19zdGF0ZSwKKwkJ
CQkJICAgIG1hc3Rlcl9wbGFuZV9zdGF0ZSwgcGxhbmVfc3RhdGUpKQogCQkJY29udGludWU7CiAK
LQkJaWYgKFdBUk5fT04oIXBsYW5lX3N0YXRlLT5iYXNlLmZiKSkKKwkJaWYgKFdBUk5fT04oIW1h
c3Rlcl9wbGFuZV9zdGF0ZS0+YmFzZS5mYikpCiAJCQlyZXR1cm4gLUVJTlZBTDsKIAotCQlwbGFu
ZV9kb3duc2NhbGUgPSBza2xfcGxhbmVfZG93bnNjYWxlX2Ftb3VudChjcnRjX3N0YXRlLCBwbGFu
ZV9zdGF0ZSk7Ci0JCWJwcCA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiLT5mb3JtYXQtPmNwcFswXSAq
IDg7CisJCXBsYW5lX2Rvd25zY2FsZSA9IHNrbF9wbGFuZV9kb3duc2NhbGVfYW1vdW50KGNydGNf
c3RhdGUsCisJCQkJCQkJICAgICBtYXN0ZXJfcGxhbmVfc3RhdGUsCisJCQkJCQkJICAgICBwbGFu
ZV9zdGF0ZSk7CisKKwkJYnBwID0gbWFzdGVyX3BsYW5lX3N0YXRlLT5iYXNlLmZiLT5mb3JtYXQt
PmNwcFswXSAqIDg7CiAJCWlmIChicHAgPT0gNjQpCiAJCQlwbGFuZV9kb3duc2NhbGUgPSBtdWxf
Zml4ZWQxNihwbGFuZV9kb3duc2NhbGUsCiAJCQkJCQkgICAgICBmcF85X2Rpdl84KTsKQEAgLTQx
NzgsNyArNDE4Niw3IEBAIGludCBza2xfY2hlY2tfcGlwZV9tYXhfcGl4ZWxfcmF0ZShzdHJ1Y3Qg
aW50ZWxfY3J0YyAqaW50ZWxfY3J0YywKIAlwaXBlX2Rvd25zY2FsZSA9IG11bF9maXhlZDE2KHBp
cGVfZG93bnNjYWxlLCBtYXhfZG93bnNjYWxlKTsKIAogCWNydGNfY2xvY2sgPSBjcnRjX3N0YXRl
LT5ody5hZGp1c3RlZF9tb2RlLmNydGNfY2xvY2s7Ci0JZG90Y2xrID0gdG9faW50ZWxfYXRvbWlj
X3N0YXRlKHN0YXRlKS0+Y2RjbGsubG9naWNhbC5jZGNsazsKKwlkb3RjbGsgPSBzdGF0ZS0+Y2Rj
bGsubG9naWNhbC5jZGNsazsKIAogCWlmIChJU19HRU1JTklMQUtFKGRldl9wcml2KSB8fCBJTlRF
TF9HRU4oZGV2X3ByaXYpID49IDEwKQogCQlkb3RjbGsgKj0gMjsKQEAgLTQxOTUsMTEgKzQyMDMs
MTIgQEAgaW50IHNrbF9jaGVja19waXBlX21heF9waXhlbF9yYXRlKHN0cnVjdCBpbnRlbF9jcnRj
ICppbnRlbF9jcnRjLAogCiBzdGF0aWMgdTY0CiBza2xfcGxhbmVfcmVsYXRpdmVfZGF0YV9yYXRl
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJICAgICBjb25z
dCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm1hc3Rlcl9wbGFuZV9zdGF0ZSwKIAkJCSAgICAg
Y29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKIAkJCSAgICAgaW50
IGNvbG9yX3BsYW5lKQogewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9w
bGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYiA9IG1hc3Rlcl9wbGFuZV9zdGF0ZS0+YmFzZS5mYjsKIAl1MzIgZGF0YV9yYXRl
OwogCXUzMiB3aWR0aCA9IDAsIGhlaWdodCA9IDA7CiAJdWludF9maXhlZF8xNl8xNl90IGRvd25f
c2NhbGVfYW1vdW50OwpAQCAtNDIzMSw3ICs0MjQwLDkgQEAgc2tsX3BsYW5lX3JlbGF0aXZlX2Rh
dGFfcmF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAogCWRh
dGFfcmF0ZSA9IHdpZHRoICogaGVpZ2h0OwogCi0JZG93bl9zY2FsZV9hbW91bnQgPSBza2xfcGxh
bmVfZG93bnNjYWxlX2Ftb3VudChjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7CisJZG93bl9zY2Fs
ZV9hbW91bnQgPSBza2xfcGxhbmVfZG93bnNjYWxlX2Ftb3VudChjcnRjX3N0YXRlLAorCQkJCQkJ
ICAgICAgIG1hc3Rlcl9wbGFuZV9zdGF0ZSwKKwkJCQkJCSAgICAgICBwbGFuZV9zdGF0ZSk7CiAK
IAlyYXRlID0gbXVsX3JvdW5kX3VwX3UzMl9maXhlZDE2KGRhdGFfcmF0ZSwgZG93bl9zY2FsZV9h
bW91bnQpOwogCkBAIC00MjQ0LDI4ICs0MjU1LDI1IEBAIHNrbF9nZXRfdG90YWxfcmVsYXRpdmVf
ZGF0YV9yYXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCSB1NjQg
KnBsYW5lX2RhdGFfcmF0ZSwKIAkJCQkgdTY0ICp1dl9wbGFuZV9kYXRhX3JhdGUpCiB7Ci0Jc3Ry
dWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlID0gY3J0Y19zdGF0ZS0+dWFwaS5zdGF0ZTsKLQlz
dHJ1Y3QgZHJtX3BsYW5lICpwbGFuZTsKLQljb25zdCBzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpk
cm1fcGxhbmVfc3RhdGU7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZTsKKwljb25zdCBzdHJ1
Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm1hc3Rlcl9wbGFuZV9zdGF0ZSwgKnBsYW5lX3N0YXRlOwog
CXU2NCB0b3RhbF9kYXRhX3JhdGUgPSAwOwogCi0JaWYgKFdBUk5fT04oIXN0YXRlKSkKLQkJcmV0
dXJuIDA7Ci0KIAkvKiBDYWxjdWxhdGUgYW5kIGNhY2hlIGRhdGEgcmF0ZSBmb3IgZWFjaCBwbGFu
ZSAqLwotCWRybV9hdG9taWNfY3J0Y19zdGF0ZV9mb3JfZWFjaF9wbGFuZV9zdGF0ZShwbGFuZSwg
ZHJtX3BsYW5lX3N0YXRlLCAmY3J0Y19zdGF0ZS0+dWFwaSkgewotCQllbnVtIHBsYW5lX2lkIHBs
YW5lX2lkID0gdG9faW50ZWxfcGxhbmUocGxhbmUpLT5pZDsKLQkJY29uc3Qgc3RydWN0IGludGVs
X3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSA9Ci0JCQl0b19pbnRlbF9wbGFuZV9zdGF0ZShkcm1f
cGxhbmVfc3RhdGUpOworCWludGVsX2F0b21pY19jcnRjX3N0YXRlX2Zvcl9lYWNoX3BsYW5lX3N0
YXRlKHBsYW5lLCBtYXN0ZXJfcGxhbmVfc3RhdGUsCisJCQkJCQkgICAgIHBsYW5lX3N0YXRlLCBj
cnRjX3N0YXRlKSB7CisJCWVudW0gcGxhbmVfaWQgcGxhbmVfaWQgPSBwbGFuZS0+aWQ7CiAJCXU2
NCByYXRlOwogCiAJCS8qIHBhY2tlZC95ICovCi0JCXJhdGUgPSBza2xfcGxhbmVfcmVsYXRpdmVf
ZGF0YV9yYXRlKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlLCAwKTsKKwkJcmF0ZSA9IHNrbF9wbGFu
ZV9yZWxhdGl2ZV9kYXRhX3JhdGUoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUsCisJCQkJCQkgICAg
cGxhbmVfc3RhdGUsIDApOwogCQlwbGFuZV9kYXRhX3JhdGVbcGxhbmVfaWRdID0gcmF0ZTsKIAkJ
dG90YWxfZGF0YV9yYXRlICs9IHJhdGU7CiAKIAkJLyogdXYtcGxhbmUgKi8KLQkJcmF0ZSA9IHNr
bF9wbGFuZV9yZWxhdGl2ZV9kYXRhX3JhdGUoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUsIDEpOwor
CQlyYXRlID0gc2tsX3BsYW5lX3JlbGF0aXZlX2RhdGFfcmF0ZShjcnRjX3N0YXRlLCBwbGFuZV9z
dGF0ZSwKKwkJCQkJCSAgICBwbGFuZV9zdGF0ZSwgMSk7CiAJCXV2X3BsYW5lX2RhdGFfcmF0ZVtw
bGFuZV9pZF0gPSByYXRlOwogCQl0b3RhbF9kYXRhX3JhdGUgKz0gcmF0ZTsKIAl9CkBAIC00Mjc3
LDQ3ICs0Mjg1LDUyIEBAIHN0YXRpYyB1NjQKIGljbF9nZXRfdG90YWxfcmVsYXRpdmVfZGF0YV9y
YXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCSB1NjQgKnBsYW5l
X2RhdGFfcmF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZTsKLQljb25zdCBzdHJ1Y3Qg
ZHJtX3BsYW5lX3N0YXRlICpkcm1fcGxhbmVfc3RhdGU7CisJY29uc3Qgc3RydWN0IGludGVsX3Bs
YW5lX3N0YXRlICptYXN0ZXJfcGxhbmVfc3RhdGUsICpwbGFuZV9zdGF0ZTsKKwlzdHJ1Y3QgaW50
ZWxfcGxhbmUgKnBsYW5lOwogCXU2NCB0b3RhbF9kYXRhX3JhdGUgPSAwOwogCiAJaWYgKFdBUk5f
T04oIWNydGNfc3RhdGUtPnVhcGkuc3RhdGUpKQogCQlyZXR1cm4gMDsKIAogCS8qIENhbGN1bGF0
ZSBhbmQgY2FjaGUgZGF0YSByYXRlIGZvciBlYWNoIHBsYW5lICovCi0JZHJtX2F0b21pY19jcnRj
X3N0YXRlX2Zvcl9lYWNoX3BsYW5lX3N0YXRlKHBsYW5lLCBkcm1fcGxhbmVfc3RhdGUsICZjcnRj
X3N0YXRlLT51YXBpKSB7Ci0JCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVf
c3RhdGUgPQotCQkJdG9faW50ZWxfcGxhbmVfc3RhdGUoZHJtX3BsYW5lX3N0YXRlKTsKLQkJZW51
bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHRvX2ludGVsX3BsYW5lKHBsYW5lKS0+aWQ7CisJaW50ZWxf
YXRvbWljX2NydGNfc3RhdGVfZm9yX2VhY2hfcGxhbmVfc3RhdGUocGxhbmUsIG1hc3Rlcl9wbGFu
ZV9zdGF0ZSwKKwkJCQkJCSAgICAgcGxhbmVfc3RhdGUsIGNydGNfc3RhdGUpIHsKKwkJZW51bSBw
bGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKIAkJdTY0IHJhdGU7CiAKIAkJaWYgKCFwbGFu
ZV9zdGF0ZS0+cGxhbmFyX2xpbmtlZF9wbGFuZSkgewotCQkJcmF0ZSA9IHNrbF9wbGFuZV9yZWxh
dGl2ZV9kYXRhX3JhdGUoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUsIDApOworCQkJcmF0ZSA9IHNr
bF9wbGFuZV9yZWxhdGl2ZV9kYXRhX3JhdGUoY3J0Y19zdGF0ZSwKKwkJCQkJCQkgICAgbWFzdGVy
X3BsYW5lX3N0YXRlLAorCQkJCQkJCSAgICBwbGFuZV9zdGF0ZSwgMCk7CiAJCQlwbGFuZV9kYXRh
X3JhdGVbcGxhbmVfaWRdID0gcmF0ZTsKIAkJCXRvdGFsX2RhdGFfcmF0ZSArPSByYXRlOwogCQl9
IGVsc2UgewogCQkJZW51bSBwbGFuZV9pZCB5X3BsYW5lX2lkOwogCiAJCQkvKgotCQkJICogVGhl
IHNsYXZlIHBsYW5lIG1pZ2h0IG5vdCBpdGVyYXRlIGluCi0JCQkgKiBkcm1fYXRvbWljX2NydGNf
c3RhdGVfZm9yX2VhY2hfcGxhbmVfc3RhdGUoKSwKLQkJCSAqIGFuZCBuZWVkcyB0aGUgbWFzdGVy
IHBsYW5lIHN0YXRlIHdoaWNoIG1heSBiZQotCQkJICogTlVMTCBpZiB3ZSB0cnkgZ2V0X25ld19w
bGFuZV9zdGF0ZSgpLCBzbyB3ZQotCQkJICogYWx3YXlzIGNhbGN1bGF0ZSBmcm9tIHRoZSBtYXN0
ZXIuCi0JCQkgKi8KKwkJCSogVGhlIHNsYXZlIHBsYW5lIG1pZ2h0IG5vdCBpdGVyYXRlIGluCisJ
CQkqIGludGVsX2F0b21pY19jcnRjX3N0YXRlX2Zvcl9lYWNoX3BsYW5lX3N0YXRlKCksCisJCQkq
IGFuZCBuZWVkcyB0aGUgbWFzdGVyIHBsYW5lIHN0YXRlIHdoaWNoIG1heSBiZQorCQkJKiBOVUxM
IGlmIHdlIHRyeSBnZXRfbmV3X3BsYW5lX3N0YXRlKCksIHNvIHdlCisJCQkqIGFsd2F5cyBjYWxj
dWxhdGUgZnJvbSB0aGUgbWFzdGVyLgorCQkJKi8KIAkJCWlmIChwbGFuZV9zdGF0ZS0+cGxhbmFy
X3NsYXZlKQogCQkJCWNvbnRpbnVlOwogCiAJCQkvKiBZIHBsYW5lIHJhdGUgaXMgY2FsY3VsYXRl
ZCBvbiB0aGUgc2xhdmUgKi8KLQkJCXJhdGUgPSBza2xfcGxhbmVfcmVsYXRpdmVfZGF0YV9yYXRl
KGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlLCAwKTsKKwkJCXJhdGUgPSBza2xfcGxhbmVfcmVsYXRp
dmVfZGF0YV9yYXRlKGNydGNfc3RhdGUsCisJCQkJCQkJICAgIG1hc3Rlcl9wbGFuZV9zdGF0ZSwK
KwkJCQkJCQkgICAgcGxhbmVfc3RhdGUsIDApOwogCQkJeV9wbGFuZV9pZCA9IHBsYW5lX3N0YXRl
LT5wbGFuYXJfbGlua2VkX3BsYW5lLT5pZDsKIAkJCXBsYW5lX2RhdGFfcmF0ZVt5X3BsYW5lX2lk
XSA9IHJhdGU7CiAJCQl0b3RhbF9kYXRhX3JhdGUgKz0gcmF0ZTsKIAotCQkJcmF0ZSA9IHNrbF9w
bGFuZV9yZWxhdGl2ZV9kYXRhX3JhdGUoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUsIDEpOworCQkJ
cmF0ZSA9IHNrbF9wbGFuZV9yZWxhdGl2ZV9kYXRhX3JhdGUoY3J0Y19zdGF0ZSwKKwkJCQkJCQkg
ICAgbWFzdGVyX3BsYW5lX3N0YXRlLAorCQkJCQkJCSAgICBwbGFuZV9zdGF0ZSwgMSk7CiAJCQlw
bGFuZV9kYXRhX3JhdGVbcGxhbmVfaWRdID0gcmF0ZTsKIAkJCXRvdGFsX2RhdGFfcmF0ZSArPSBy
YXRlOwotCQl9CisJCSAgfQogCX0KIAogCXJldHVybiB0b3RhbF9kYXRhX3JhdGU7CkBAIC00NjA4
LDEzICs0NjIxLDE1IEBAIGludGVsX2dldF9saW5ldGltZV91cyhjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAogc3RhdGljIHUzMgogc2tsX2FkanVzdGVkX3BsYW5l
X3BpeGVsX3JhdGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJ
CQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm1hc3Rlcl9wbGFuZV9zdGF0
ZSwKIAkJCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUp
CiB7CiAJdTY0IGFkanVzdGVkX3BpeGVsX3JhdGU7CiAJdWludF9maXhlZF8xNl8xNl90IGRvd25z
Y2FsZV9hbW91bnQ7CiAKIAkvKiBTaG91bGRuJ3QgcmVhY2ggaGVyZSBvbiBkaXNhYmxlZCBwbGFu
ZXMuLi4gKi8KLQlpZiAoV0FSTl9PTighaW50ZWxfd21fcGxhbmVfdmlzaWJsZShjcnRjX3N0YXRl
LCBwbGFuZV9zdGF0ZSkpKQorCWlmIChXQVJOX09OKCFpbnRlbF93bV9wbGFuZV92aXNpYmxlKGNy
dGNfc3RhdGUsCisJCQkJCSAgICBtYXN0ZXJfcGxhbmVfc3RhdGUsIHBsYW5lX3N0YXRlKSkpCiAJ
CXJldHVybiAwOwogCiAJLyoKQEAgLTQ2MjIsNyArNDYzNyw5IEBAIHNrbF9hZGp1c3RlZF9wbGFu
ZV9waXhlbF9yYXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAog
CSAqIHdpdGggYWRkaXRpb25hbCBhZGp1c3RtZW50cyBmb3IgcGxhbmUtc3BlY2lmaWMgc2NhbGlu
Zy4KIAkgKi8KIAlhZGp1c3RlZF9waXhlbF9yYXRlID0gY3J0Y19zdGF0ZS0+cGl4ZWxfcmF0ZTsK
LQlkb3duc2NhbGVfYW1vdW50ID0gc2tsX3BsYW5lX2Rvd25zY2FsZV9hbW91bnQoY3J0Y19zdGF0
ZSwgcGxhbmVfc3RhdGUpOworCWRvd25zY2FsZV9hbW91bnQgPSBza2xfcGxhbmVfZG93bnNjYWxl
X2Ftb3VudChjcnRjX3N0YXRlLAorCQkJCQkJICAgICAgbWFzdGVyX3BsYW5lX3N0YXRlLAorCQkJ
CQkJICAgICAgcGxhbmVfc3RhdGUpOwogCiAJcmV0dXJuIG11bF9yb3VuZF91cF91MzJfZml4ZWQx
NihhZGp1c3RlZF9waXhlbF9yYXRlLAogCQkJCQkgICAgZG93bnNjYWxlX2Ftb3VudCk7CkBAIC00
NzIxLDE1ICs0NzM4LDE2IEBAIHNrbF9jb21wdXRlX3dtX3BhcmFtcyhjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAogc3RhdGljIGludAogc2tsX2NvbXB1dGVfcGxh
bmVfd21fcGFyYW1zKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAor
CQkJICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqbWFzdGVyX3BsYW5lX3N0YXRl
LAogCQkJICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCiAJ
CQkgICAgc3RydWN0IHNrbF93bV9wYXJhbXMgKndwLCBpbnQgY29sb3JfcGxhbmUpCiB7CiAJc3Ry
dWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNl
LnBsYW5lKTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRl
LT5iYXNlLmZiOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gbWFzdGVyX3Bs
YW5lX3N0YXRlLT5iYXNlLmZiOwogCWludCB3aWR0aDsKIAogCWlmIChwbGFuZS0+aWQgPT0gUExB
TkVfQ1VSU09SKSB7Ci0JCXdpZHRoID0gcGxhbmVfc3RhdGUtPmJhc2UuY3J0Y193OworCQl3aWR0
aCA9IG1hc3Rlcl9wbGFuZV9zdGF0ZS0+YmFzZS5jcnRjX3c7CiAJfSBlbHNlIHsKIAkJLyoKIAkJ
ICogU3JjIGNvb3JkaW5hdGVzIGFyZSBhbHJlYWR5IHJvdGF0ZWQgYnkgMjcwIGRlZ3JlZXMgZm9y
CkBAIC00NzQxLDggKzQ3NTksOCBAQCBza2xfY29tcHV0ZV9wbGFuZV93bV9wYXJhbXMoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAKIAlyZXR1cm4gc2tsX2NvbXB1
dGVfd21fcGFyYW1zKGNydGNfc3RhdGUsIHdpZHRoLAogCQkJCSAgICAgZmItPmZvcm1hdCwgZmIt
Pm1vZGlmaWVyLAotCQkJCSAgICAgcGxhbmVfc3RhdGUtPmJhc2Uucm90YXRpb24sCi0JCQkJICAg
ICBza2xfYWRqdXN0ZWRfcGxhbmVfcGl4ZWxfcmF0ZShjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSks
CisJCQkJICAgICBtYXN0ZXJfcGxhbmVfc3RhdGUtPmJhc2Uucm90YXRpb24sCisJCQkJICAgICBz
a2xfYWRqdXN0ZWRfcGxhbmVfcGl4ZWxfcmF0ZShjcnRjX3N0YXRlLCBtYXN0ZXJfcGxhbmVfc3Rh
dGUsIHBsYW5lX3N0YXRlKSwKIAkJCQkgICAgIHdwLCBjb2xvcl9wbGFuZSk7CiB9CiAKQEAgLTQ5
NzcsNiArNDk5NSw3IEBAIHN0YXRpYyB2b2lkIHNrbF9jb21wdXRlX3RyYW5zaXRpb25fd20oY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiB9CiAKIHN0YXRpYyBpbnQg
c2tsX2J1aWxkX3BsYW5lX3dtX3NpbmdsZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSwKKwkJCQkgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqbWFzdGVyX3Bs
YW5lX3N0YXRlLAogCQkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFu
ZV9zdGF0ZSwKIAkJCQkgICAgIGVudW0gcGxhbmVfaWQgcGxhbmVfaWQsIGludCBjb2xvcl9wbGFu
ZSkKIHsKQEAgLTQ5ODQsOCArNTAwMyw4IEBAIHN0YXRpYyBpbnQgc2tsX2J1aWxkX3BsYW5lX3dt
X3NpbmdsZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlzdHJ1Y3Qgc2ts
X3dtX3BhcmFtcyB3bV9wYXJhbXM7CiAJaW50IHJldDsKIAotCXJldCA9IHNrbF9jb21wdXRlX3Bs
YW5lX3dtX3BhcmFtcyhjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSwKLQkJCQkJICAmd21fcGFyYW1z
LCBjb2xvcl9wbGFuZSk7CisJcmV0ID0gc2tsX2NvbXB1dGVfcGxhbmVfd21fcGFyYW1zKGNydGNf
c3RhdGUsIG1hc3Rlcl9wbGFuZV9zdGF0ZSwKKwkJCQkJICBwbGFuZV9zdGF0ZSwgJndtX3BhcmFt
cywgY29sb3JfcGxhbmUpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKQEAgLTUwMDcsNyAr
NTAyNiw3IEBAIHN0YXRpYyBpbnQgc2tsX2J1aWxkX3BsYW5lX3dtX3V2KHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCiAJLyogdXYgcGxhbmUgd2F0ZXJtYXJrcyBtdXN0IGFs
c28gYmUgdmFsaWRhdGVkIGZvciBOVjEyL1BsYW5hciAqLwogCXJldCA9IHNrbF9jb21wdXRlX3Bs
YW5lX3dtX3BhcmFtcyhjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSwKLQkJCQkJICAmd21fcGFyYW1z
LCAxKTsKKwkJCQkJICBwbGFuZV9zdGF0ZSwgJndtX3BhcmFtcywgMSk7CiAJaWYgKHJldCkKIAkJ
cmV0dXJuIHJldDsKIApAQCAtNTAyNCwxMCArNTA0MywxMCBAQCBzdGF0aWMgaW50IHNrbF9idWls
ZF9wbGFuZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAllbnVtIHBs
YW5lX2lkIHBsYW5lX2lkID0gcGxhbmUtPmlkOwogCWludCByZXQ7CiAKLQlpZiAoIWludGVsX3dt
X3BsYW5lX3Zpc2libGUoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpKQorCWlmICghaW50ZWxfd21f
cGxhbmVfdmlzaWJsZShjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSwgcGxhbmVfc3RhdGUpKQogCQly
ZXR1cm4gMDsKIAotCXJldCA9IHNrbF9idWlsZF9wbGFuZV93bV9zaW5nbGUoY3J0Y19zdGF0ZSwg
cGxhbmVfc3RhdGUsCisJcmV0ID0gc2tsX2J1aWxkX3BsYW5lX3dtX3NpbmdsZShjcnRjX3N0YXRl
LCBwbGFuZV9zdGF0ZSwgcGxhbmVfc3RhdGUsCiAJCQkJCXBsYW5lX2lkLCAwKTsKIAlpZiAocmV0
KQogCQlyZXR1cm4gcmV0OwpAQCAtNTA0Myw2ICs1MDYyLDcgQEAgc3RhdGljIGludCBza2xfYnVp
bGRfcGxhbmVfd20oc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiB9CiAKIHN0
YXRpYyBpbnQgaWNsX2J1aWxkX3BsYW5lX3dtKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlLAorCQkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICptYXN0ZXJf
cGxhbmVfc3RhdGUsCiAJCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlKQogewogCWVudW0gcGxhbmVfaWQgcGxhbmVfaWQgPSB0b19pbnRlbF9wbGFuZShw
bGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSktPmlkOwpAQCAtNTA1MywyNyArNTA3MywyOCBAQCBzdGF0
aWMgaW50IGljbF9idWlsZF9wbGFuZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSwKIAkJcmV0dXJuIDA7CiAKIAlpZiAocGxhbmVfc3RhdGUtPnBsYW5hcl9saW5rZWRfcGxh
bmUpIHsKLQkJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+
YmFzZS5mYjsKKwkJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBtYXN0ZXJfcGxh
bmVfc3RhdGUtPmJhc2UuZmI7CiAJCWVudW0gcGxhbmVfaWQgeV9wbGFuZV9pZCA9IHBsYW5lX3N0
YXRlLT5wbGFuYXJfbGlua2VkX3BsYW5lLT5pZDsKIAotCQlXQVJOX09OKCFpbnRlbF93bV9wbGFu
ZV92aXNpYmxlKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKSk7CisJCVdBUk5fT04oIWludGVsX3dt
X3BsYW5lX3Zpc2libGUoY3J0Y19zdGF0ZSwKKwkJCQkJCW1hc3Rlcl9wbGFuZV9zdGF0ZSwKKwkJ
CQkJCXBsYW5lX3N0YXRlKSk7CiAJCVdBUk5fT04oIWZiLT5mb3JtYXQtPmlzX3l1diB8fAogCQkJ
ZmItPmZvcm1hdC0+bnVtX3BsYW5lcyA9PSAxKTsKIAotCQlyZXQgPSBza2xfYnVpbGRfcGxhbmVf
d21fc2luZ2xlKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlLAotCQkJCQkJeV9wbGFuZV9pZCwgMCk7
CisJCXJldCA9IHNrbF9idWlsZF9wbGFuZV93bV9zaW5nbGUoY3J0Y19zdGF0ZSwgbWFzdGVyX3Bs
YW5lX3N0YXRlLAorCQkJCQkJcGxhbmVfc3RhdGUsIHlfcGxhbmVfaWQsIDApOwogCQlpZiAocmV0
KQogCQkJcmV0dXJuIHJldDsKIAotCQlyZXQgPSBza2xfYnVpbGRfcGxhbmVfd21fc2luZ2xlKGNy
dGNfc3RhdGUsIHBsYW5lX3N0YXRlLAotCQkJCQkJcGxhbmVfaWQsIDEpOwotCQlpZiAocmV0KQot
CQkJcmV0dXJuIHJldDsKLQl9IGVsc2UgaWYgKGludGVsX3dtX3BsYW5lX3Zpc2libGUoY3J0Y19z
dGF0ZSwgcGxhbmVfc3RhdGUpKSB7Ci0JCXJldCA9IHNrbF9idWlsZF9wbGFuZV93bV9zaW5nbGUo
Y3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUsCi0JCQkJCQlwbGFuZV9pZCwgMCk7CisJCXJldCA9IHNr
bF9idWlsZF9wbGFuZV93bV9zaW5nbGUoY3J0Y19zdGF0ZSwgbWFzdGVyX3BsYW5lX3N0YXRlLAor
CQkJCQkJcGxhbmVfc3RhdGUsIHBsYW5lX2lkLCAxKTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiBy
ZXQ7CisJfSBlbHNlIGlmIChpbnRlbF93bV9wbGFuZV92aXNpYmxlKGNydGNfc3RhdGUsCisJCQkJ
CSAgbWFzdGVyX3BsYW5lX3N0YXRlLCBwbGFuZV9zdGF0ZSkpIHsKKwkJcmV0ID0gc2tsX2J1aWxk
X3BsYW5lX3dtX3NpbmdsZShjcnRjX3N0YXRlLCBtYXN0ZXJfcGxhbmVfc3RhdGUsCisJCQkJCQlw
bGFuZV9zdGF0ZSwgcGxhbmVfaWQsIDApOwogCX0KIAogCXJldHVybiAwOwpAQCAtNTA4Myw4ICs1
MTA0LDggQEAgc3RhdGljIGludCBza2xfYnVpbGRfcGlwZV93bShzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKIAlzdHJ1Y3Qgc2tsX3BpcGVf
d20gKnBpcGVfd20gPSAmY3J0Y19zdGF0ZS0+d20uc2tsLm9wdGltYWw7Ci0Jc3RydWN0IGRybV9w
bGFuZSAqcGxhbmU7Ci0JY29uc3Qgc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqZHJtX3BsYW5lX3N0
YXRlOworCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqbWFzdGVyX3BsYW5lX3N0YXRl
LCAqcGxhbmVfc3RhdGU7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZTsKIAlpbnQgcmV0Owog
CiAJLyoKQEAgLTUwOTMsMTUgKzUxMTQsMTcgQEAgc3RhdGljIGludCBza2xfYnVpbGRfcGlwZV93
bShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkgKi8KIAltZW1zZXQocGlw
ZV93bS0+cGxhbmVzLCAwLCBzaXplb2YocGlwZV93bS0+cGxhbmVzKSk7CiAKLQlkcm1fYXRvbWlj
X2NydGNfc3RhdGVfZm9yX2VhY2hfcGxhbmVfc3RhdGUocGxhbmUsIGRybV9wbGFuZV9zdGF0ZSwK
LQkJCQkJCSAgICZjcnRjX3N0YXRlLT51YXBpKSB7Ci0JCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFu
ZV9zdGF0ZSAqcGxhbmVfc3RhdGUgPQotCQkJdG9faW50ZWxfcGxhbmVfc3RhdGUoZHJtX3BsYW5l
X3N0YXRlKTsKKwlpbnRlbF9hdG9taWNfY3J0Y19zdGF0ZV9mb3JfZWFjaF9wbGFuZV9zdGF0ZShw
bGFuZSwgbWFzdGVyX3BsYW5lX3N0YXRlLAorCQkJCQkJICAgICBwbGFuZV9zdGF0ZSwgY3J0Y19z
dGF0ZSkgeworCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkgeworCQkJcmV0ID0gaWNs
X2J1aWxkX3BsYW5lX3dtKGNydGNfc3RhdGUsCisJCQkJCQkgbWFzdGVyX3BsYW5lX3N0YXRlLAor
CQkJCQkJIHBsYW5lX3N0YXRlKTsKKwkJfSBlbHNlIHsKKwkJCXJldCA9IHNrbF9idWlsZF9wbGFu
ZV93bShjcnRjX3N0YXRlLAorCQkJCQkJIG1hc3Rlcl9wbGFuZV9zdGF0ZSk7CisJCX0KIAotCQlp
ZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKLQkJCXJldCA9IGljbF9idWlsZF9wbGFuZV93
bShjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7Ci0JCWVsc2UKLQkJCXJldCA9IHNrbF9idWlsZF9w
bGFuZV93bShjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4g
cmV0OwogCX0KLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
aW50ZWwtZ2Z4

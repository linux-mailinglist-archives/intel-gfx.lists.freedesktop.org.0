Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D6698D558C
	for <lists+intel-gfx@lfdr.de>; Sun, 13 Oct 2019 11:52:35 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8446D6E0D3;
	Sun, 13 Oct 2019 09:52:33 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B89AE6E0D3
 for <intel-gfx@lists.freedesktop.org>; Sun, 13 Oct 2019 09:52:32 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18820849-1500050 
 for multiple; Sun, 13 Oct 2019 10:52:12 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sun, 13 Oct 2019 10:52:11 +0100
Message-Id: <20191013095211.2922-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/perf: Avoid polluting the
 i915_oa_config with error pointers
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Dan Carpenter <dan.carpenter@oracle.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VXNlIGEgbG9jYWwgdmFyaWFibGUgdG8gdHJhY2sgdGhlIGFsbG9jYXRpb24gZXJyb3JzIHRvIGF2
b2lkIHBvbGx1dGluZwp0aGUgc3RydWN0IGFuZCBrZWVwIHRoZSBmcmVlIHNpbXBsZS4KClJlcG9y
dGVkLWJ5OiBrYnVpbGQgdGVzdCByb2JvdCA8bGtwQGludGVsLmNvbT4KUmVwb3J0ZWQtYnk6IERh
biBDYXJwZW50ZXIgPGRhbi5jYXJwZW50ZXJAb3JhY2xlLmNvbT4KU2lnbmVkLW9mZi1ieTogQ2hy
aXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBMaW9uZWwgTGFuZHdlcmxp
biA8bGlvbmVsLmcubGFuZHdlcmxpbkBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9wZXJmLmMgfCA1MiArKysrKysrKysrKysrKystLS0tLS0tLS0tLS0tLS0tLQogMSBm
aWxlIGNoYW5nZWQsIDI1IGluc2VydGlvbnMoKyksIDI3IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9wZXJmLmMKaW5kZXggYjRlMjMzMmQzNWNiLi4zNjY1ODA3MDFiYTIgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfcGVyZi5jCkBAIC0zODQsMTIgKzM4NCw5IEBAIHZvaWQgaTkxNV9vYV9jb25m
aWdfcmVsZWFzZShzdHJ1Y3Qga3JlZiAqcmVmKQogCXN0cnVjdCBpOTE1X29hX2NvbmZpZyAqb2Ff
Y29uZmlnID0KIAkJY29udGFpbmVyX29mKHJlZiwgdHlwZW9mKCpvYV9jb25maWcpLCByZWYpOwog
Ci0JaWYgKCFQVFJfRVJSKG9hX2NvbmZpZy0+ZmxleF9yZWdzKSkKLQkJa2ZyZWUob2FfY29uZmln
LT5mbGV4X3JlZ3MpOwotCWlmICghUFRSX0VSUihvYV9jb25maWctPmJfY291bnRlcl9yZWdzKSkK
LQkJa2ZyZWUob2FfY29uZmlnLT5iX2NvdW50ZXJfcmVncyk7Ci0JaWYgKCFQVFJfRVJSKG9hX2Nv
bmZpZy0+bXV4X3JlZ3MpKQotCQlrZnJlZShvYV9jb25maWctPm11eF9yZWdzKTsKKwlrZnJlZShv
YV9jb25maWctPmZsZXhfcmVncyk7CisJa2ZyZWUob2FfY29uZmlnLT5iX2NvdW50ZXJfcmVncyk7
CisJa2ZyZWUob2FfY29uZmlnLT5tdXhfcmVncyk7CiAKIAlrZnJlZV9yY3Uob2FfY29uZmlnLCBy
Y3UpOwogfQpAQCAtMzYzMSw2ICszNjI4LDcgQEAgaW50IGk5MTVfcGVyZl9hZGRfY29uZmlnX2lv
Y3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJc3RydWN0IGk5MTVfcGVy
ZiAqcGVyZiA9ICZ0b19pOTE1KGRldiktPnBlcmY7CiAJc3RydWN0IGRybV9pOTE1X3BlcmZfb2Ff
Y29uZmlnICphcmdzID0gZGF0YTsKIAlzdHJ1Y3QgaTkxNV9vYV9jb25maWcgKm9hX2NvbmZpZywg
KnRtcDsKKwlzdGF0aWMgc3RydWN0IGk5MTVfb2FfcmVnICpyZWdzOwogCWludCBlcnIsIGlkOwog
CiAJaWYgKCFwZXJmLT5pOTE1KSB7CkBAIC0zNjc2LDMwICszNjc0LDMwIEBAIGludCBpOTE1X3Bl
cmZfYWRkX2NvbmZpZ19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAog
CW1lbWNweShvYV9jb25maWctPnV1aWQsIGFyZ3MtPnV1aWQsIHNpemVvZihhcmdzLT51dWlkKSk7
CiAKIAlvYV9jb25maWctPm11eF9yZWdzX2xlbiA9IGFyZ3MtPm5fbXV4X3JlZ3M7Ci0Jb2FfY29u
ZmlnLT5tdXhfcmVncyA9Ci0JCWFsbG9jX29hX3JlZ3MocGVyZiwKLQkJCSAgICAgIHBlcmYtPm9w
cy5pc192YWxpZF9tdXhfcmVnLAotCQkJICAgICAgdTY0X3RvX3VzZXJfcHRyKGFyZ3MtPm11eF9y
ZWdzX3B0ciksCi0JCQkgICAgICBhcmdzLT5uX211eF9yZWdzKTsKKwlyZWdzID0gYWxsb2Nfb2Ff
cmVncyhwZXJmLAorCQkJICAgICBwZXJmLT5vcHMuaXNfdmFsaWRfbXV4X3JlZywKKwkJCSAgICAg
dTY0X3RvX3VzZXJfcHRyKGFyZ3MtPm11eF9yZWdzX3B0ciksCisJCQkgICAgIGFyZ3MtPm5fbXV4
X3JlZ3MpOwogCi0JaWYgKElTX0VSUihvYV9jb25maWctPm11eF9yZWdzKSkgeworCWlmIChJU19F
UlIocmVncykpIHsKIAkJRFJNX0RFQlVHKCJGYWlsZWQgdG8gY3JlYXRlIE9BIGNvbmZpZyBmb3Ig
bXV4X3JlZ3NcbiIpOwotCQllcnIgPSBQVFJfRVJSKG9hX2NvbmZpZy0+bXV4X3JlZ3MpOworCQll
cnIgPSBQVFJfRVJSKHJlZ3MpOwogCQlnb3RvIHJlZ19lcnI7CiAJfQorCW9hX2NvbmZpZy0+bXV4
X3JlZ3MgPSByZWdzOwogCiAJb2FfY29uZmlnLT5iX2NvdW50ZXJfcmVnc19sZW4gPSBhcmdzLT5u
X2Jvb2xlYW5fcmVnczsKLQlvYV9jb25maWctPmJfY291bnRlcl9yZWdzID0KLQkJYWxsb2Nfb2Ff
cmVncyhwZXJmLAotCQkJICAgICAgcGVyZi0+b3BzLmlzX3ZhbGlkX2JfY291bnRlcl9yZWcsCi0J
CQkgICAgICB1NjRfdG9fdXNlcl9wdHIoYXJncy0+Ym9vbGVhbl9yZWdzX3B0ciksCi0JCQkgICAg
ICBhcmdzLT5uX2Jvb2xlYW5fcmVncyk7CisJcmVncyA9IGFsbG9jX29hX3JlZ3MocGVyZiwKKwkJ
CSAgICAgcGVyZi0+b3BzLmlzX3ZhbGlkX2JfY291bnRlcl9yZWcsCisJCQkgICAgIHU2NF90b191
c2VyX3B0cihhcmdzLT5ib29sZWFuX3JlZ3NfcHRyKSwKKwkJCSAgICAgYXJncy0+bl9ib29sZWFu
X3JlZ3MpOwogCi0JaWYgKElTX0VSUihvYV9jb25maWctPmJfY291bnRlcl9yZWdzKSkgeworCWlm
IChJU19FUlIocmVncykpIHsKIAkJRFJNX0RFQlVHKCJGYWlsZWQgdG8gY3JlYXRlIE9BIGNvbmZp
ZyBmb3IgYl9jb3VudGVyX3JlZ3NcbiIpOwotCQllcnIgPSBQVFJfRVJSKG9hX2NvbmZpZy0+Yl9j
b3VudGVyX3JlZ3MpOworCQllcnIgPSBQVFJfRVJSKHJlZ3MpOwogCQlnb3RvIHJlZ19lcnI7CiAJ
fQorCW9hX2NvbmZpZy0+Yl9jb3VudGVyX3JlZ3MgPSByZWdzOwogCiAJaWYgKElOVEVMX0dFTihw
ZXJmLT5pOTE1KSA8IDgpIHsKIAkJaWYgKGFyZ3MtPm5fZmxleF9yZWdzICE9IDApIHsKQEAgLTM3
MDgsMTcgKzM3MDYsMTcgQEAgaW50IGk5MTVfcGVyZl9hZGRfY29uZmlnX2lvY3RsKHN0cnVjdCBk
cm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCX0KIAl9IGVsc2UgewogCQlvYV9jb25maWct
PmZsZXhfcmVnc19sZW4gPSBhcmdzLT5uX2ZsZXhfcmVnczsKLQkJb2FfY29uZmlnLT5mbGV4X3Jl
Z3MgPQotCQkJYWxsb2Nfb2FfcmVncyhwZXJmLAotCQkJCSAgICAgIHBlcmYtPm9wcy5pc192YWxp
ZF9mbGV4X3JlZywKLQkJCQkgICAgICB1NjRfdG9fdXNlcl9wdHIoYXJncy0+ZmxleF9yZWdzX3B0
ciksCi0JCQkJICAgICAgYXJncy0+bl9mbGV4X3JlZ3MpOworCQlyZWdzID0gYWxsb2Nfb2FfcmVn
cyhwZXJmLAorCQkJCSAgICAgcGVyZi0+b3BzLmlzX3ZhbGlkX2ZsZXhfcmVnLAorCQkJCSAgICAg
dTY0X3RvX3VzZXJfcHRyKGFyZ3MtPmZsZXhfcmVnc19wdHIpLAorCQkJCSAgICAgYXJncy0+bl9m
bGV4X3JlZ3MpOwogCi0JCWlmIChJU19FUlIob2FfY29uZmlnLT5mbGV4X3JlZ3MpKSB7CisJCWlm
IChJU19FUlIocmVncykpIHsKIAkJCURSTV9ERUJVRygiRmFpbGVkIHRvIGNyZWF0ZSBPQSBjb25m
aWcgZm9yIGZsZXhfcmVnc1xuIik7Ci0JCQllcnIgPSBQVFJfRVJSKG9hX2NvbmZpZy0+ZmxleF9y
ZWdzKTsKKwkJCWVyciA9IFBUUl9FUlIocmVncyk7CiAJCQlnb3RvIHJlZ19lcnI7CiAJCX0KKwkJ
b2FfY29uZmlnLT5mbGV4X3JlZ3MgPSByZWdzOwogCX0KIAogCWVyciA9IG11dGV4X2xvY2tfaW50
ZXJydXB0aWJsZSgmcGVyZi0+bWV0cmljc19sb2NrKTsKLS0gCjIuMjMuMAoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlz
dApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

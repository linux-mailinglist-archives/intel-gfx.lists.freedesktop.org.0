Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id AFE5B2F5F96
	for <lists+intel-gfx@lfdr.de>; Thu, 14 Jan 2021 12:14:47 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id F131D6E24D;
	Thu, 14 Jan 2021 11:14:45 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga01.intel.com (mga01.intel.com [192.55.52.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 867C96E243
 for <intel-gfx@lists.freedesktop.org>; Thu, 14 Jan 2021 11:14:44 +0000 (UTC)
IronPort-SDR: tSkfKwKRorUqgOZZVohrmmr9br03Q928zcvb4+Bx5qRiacM41DE5CoUzZSeHDBDIRrO9Jp+6Kx
 +fAT1NNSPwfA==
X-IronPort-AV: E=McAfee;i="6000,8403,9863"; a="196999398"
X-IronPort-AV: E=Sophos;i="5.79,347,1602572400"; d="scan'208";a="196999398"
Received: from orsmga004.jf.intel.com ([10.7.209.38])
 by fmsmga101.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 14 Jan 2021 03:14:43 -0800
IronPort-SDR: wgj4ZkopKUggFCuY//P9VBYpzUmR1d4QIZj7JqYj2o+fYEV3Kr7ILtO8VOcCmVU5kOyTVVWN1i
 zYW397SGVPoQ==
X-IronPort-AV: E=Sophos;i="5.79,347,1602572400"; d="scan'208";a="499569170"
Received: from dforourk-mobl1.ger.corp.intel.com (HELO localhost)
 ([10.213.254.146])
 by orsmga004-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 14 Jan 2021 03:14:39 -0800
From: Jani Nikula <jani.nikula@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 14 Jan 2021 13:13:50 +0200
Message-Id: <9b51add03de3ffce8a1e9dd59ede79e4e1134c89.1610622609.git.jani.nikula@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <cover.1610622609.git.jani.nikula@intel.com>
References: <cover.1610622609.git.jani.nikula@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 06/11] drm/i915: migrate skl planes code new
 file (v3)
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com, Dave Airlie <airlied@redhat.com>,
 Dan Carpenter <dan.carpenter@oracle.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogRGF2ZSBBaXJsaWUgPGFpcmxpZWRAcmVkaGF0LmNvbT4KClJld29yayB0aGUgcGxhbmUg
aW5pdCBjYWxscyB0byBkbyB0aGUgZ2VuIHRlc3Qgb25lIGxldmVsIGhpZ2hlci4KClJld29yayBz
b21lIG9mIHRoZSBwbGFuZSBoZWxwZXJzIHNvIHRoZXkgY2FuIGxpdmUgaW4gbmV3IGZpbGUsCnRo
ZXJlIGlzIHN0aWxsIHNvbWUgc2NvcGUgdG8gY2xlYW4gdXAgdGhlIHBsYW5lL2ZiIGludGVyYWN0
aW9ucwpsYXRlci4KCnYyOiBkcm9wIGF0b21pYyBjb2RlIGJhY2ssIHJlbmFtZSBmaWxlIHRvIFZp
bGxlIHN1Z2dlc3Rpb25zLAphZGQgaGVhZGVyIGZpbGUuCnYzOiBtb3ZlIHNjYWxlciBiaXRzIGJh
Y2sKClNpZ25lZC1vZmYtYnk6IERhdmUgQWlybGllIDxhaXJsaWVkQHJlZGhhdC5jb20+CltKYW5p
OiBmaXhlZCB1cCBzcGFyc2Ugd2FybmluZ3MuXQpTaWduZWQtb2ZmLWJ5OiBKYW5pIE5pa3VsYSA8
amFuaS5uaWt1bGFAaW50ZWwuY29tPgpSZXBvcnRlZC1ieToga2VybmVsIHRlc3Qgcm9ib3QgPGxr
cEBpbnRlbC5jb20+ClJlcG9ydGVkLWJ5OiBEYW4gQ2FycGVudGVyIDxkYW4uY2FycGVudGVyQG9y
YWNsZS5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgICAgICAgICAgICAg
ICAgIHwgICAgMyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pOXh4X3BsYW5lLmMg
ICAgIHwgICAgNCAtCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ljbF9kc2kuYyAgICAg
ICAgfCAgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY3J0Yy5jICAg
ICB8ICAgMTMgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMgICAg
ICB8ICAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMg
IHwgIDk1NiArLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3Bs
YXkuaCAgfCAgIDI3ICstCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVz
LmggICAgfCAgIDIxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbXN0
LmMgICB8ICAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYyAg
ICAgIHwgICAgMSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5j
ICAgfCAxMzQzICstLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
c3ByaXRlLmggICB8ICAgIDYgKy0KIC4uLi9kcm0vaTkxNS9kaXNwbGF5L3NrbF91bml2ZXJzYWxf
cGxhbmUuYyAgICB8IDIyNjMgKysrKysrKysrKysrKysrKysKIC4uLi9kcm0vaTkxNS9kaXNwbGF5
L3NrbF91bml2ZXJzYWxfcGxhbmUuaCAgICB8ICAgMzMgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS92bHZfZHNpLmMgICAgICAgIHwgICAgMSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF9wbS5jICAgICAgICAgICAgICAgfCAgICAxICsKIDE2IGZpbGVzIGNoYW5nZWQsIDIzODMg
aW5zZXJ0aW9ucygrKSwgMjI5MiBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L3NrbF91bml2ZXJzYWxfcGxhbmUuYwogY3JlYXRlIG1v
ZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvc2tsX3VuaXZlcnNhbF9wbGFu
ZS5oCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9NYWtlZmlsZQppbmRleCA5ZTE5Mzk1YzhjOGUuLmMxMThmZDUxNmNkYyAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvTWFrZWZpbGUKQEAgLTIyMyw3ICsyMjMsOCBAQCBpOTE1LXkgKz0gXAogCWRp
c3BsYXkvaW50ZWxfc3ByaXRlLm8gXAogCWRpc3BsYXkvaW50ZWxfdGMubyBcCiAJZGlzcGxheS9p
bnRlbF92Z2EubyBcCi0JZGlzcGxheS9pOXh4X3BsYW5lLm8KKwlkaXNwbGF5L2k5eHhfcGxhbmUu
byBcCisJZGlzcGxheS9za2xfdW5pdmVyc2FsX3BsYW5lLm8KIGk5MTUtJChDT05GSUdfQUNQSSkg
Kz0gXAogCWRpc3BsYXkvaW50ZWxfYWNwaS5vIFwKIAlkaXNwbGF5L2ludGVsX29wcmVnaW9uLm8K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaTl4eF9wbGFuZS5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pOXh4X3BsYW5lLmMKaW5kZXggYjc4OTg1Yzg1
NWE1Li42YzU2ODA3OWY0OTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaTl4eF9wbGFuZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaTl4eF9w
bGFuZS5jCkBAIC01NzgsMTAgKzU3OCw2IEBAIGludGVsX3ByaW1hcnlfcGxhbmVfY3JlYXRlKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwaXBlIHBpcGUpCiAJaW50IG51
bV9mb3JtYXRzOwogCWludCByZXQsIHpwb3M7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSA5KQotCQlyZXR1cm4gc2tsX3VuaXZlcnNhbF9wbGFuZV9jcmVhdGUoZGV2X3ByaXYsIHBpcGUs
Ci0JCQkJCQkgIFBMQU5FX1BSSU1BUlkpOwotCiAJcGxhbmUgPSBpbnRlbF9wbGFuZV9hbGxvYygp
OwogCWlmIChJU19FUlIocGxhbmUpKQogCQlyZXR1cm4gcGxhbmU7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ljbF9kc2kuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaWNsX2RzaS5jCmluZGV4IDlkMjQ1YTY4OTMyMy4uOWVlZWM2ZmFkZWM3IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ljbF9kc2kuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ljbF9kc2kuYwpAQCAtMzUsNiArMzUsNyBAQAogI2lu
Y2x1ZGUgImludGVsX2RzaS5oIgogI2luY2x1ZGUgImludGVsX3BhbmVsLmgiCiAjaW5jbHVkZSAi
aW50ZWxfdmRzYy5oIgorI2luY2x1ZGUgInNrbF91bml2ZXJzYWxfcGxhbmUuaCIKIAogc3RhdGlj
IGludCBoZWFkZXJfY3JlZGl0c19hdmFpbGFibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAogCQkJCSAgICBlbnVtIHRyYW5zY29kZXIgZHNpX3RyYW5zKQpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jcnRjLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2NydGMuYwppbmRleCA1N2IwYTNlYmU5MDguLmViNDc4NzEy
YzM4MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jcnRj
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jcnRjLmMKQEAgLTIw
LDYgKzIwLDcgQEAKICNpbmNsdWRlICJpbnRlbF9waXBlX2NyYy5oIgogI2luY2x1ZGUgImludGVs
X3Nwcml0ZS5oIgogI2luY2x1ZGUgImk5eHhfcGxhbmUuaCIKKyNpbmNsdWRlICJza2xfdW5pdmVy
c2FsX3BsYW5lLmgiCiAKIHN0YXRpYyB2b2lkIGFzc2VydF92YmxhbmtfZGlzYWJsZWQoc3RydWN0
IGRybV9jcnRjICpjcnRjKQogewpAQCAtMjQzLDcgKzI0NCwxMSBAQCBpbnQgaW50ZWxfY3J0Y19p
bml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwaXBlIHBpcGUpCiAJ
Y3J0Yy0+cGlwZSA9IHBpcGU7CiAJY3J0Yy0+bnVtX3NjYWxlcnMgPSBSVU5USU1FX0lORk8oZGV2
X3ByaXYpLT5udW1fc2NhbGVyc1twaXBlXTsKIAotCXByaW1hcnkgPSBpbnRlbF9wcmltYXJ5X3Bs
YW5lX2NyZWF0ZShkZXZfcHJpdiwgcGlwZSk7CisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
OSkKKwkJcHJpbWFyeSA9IHNrbF91bml2ZXJzYWxfcGxhbmVfY3JlYXRlKGRldl9wcml2LCBwaXBl
LAorCQkJCQkJICAgICBQTEFORV9QUklNQVJZKTsKKwllbHNlCisJCXByaW1hcnkgPSBpbnRlbF9w
cmltYXJ5X3BsYW5lX2NyZWF0ZShkZXZfcHJpdiwgcGlwZSk7CiAJaWYgKElTX0VSUihwcmltYXJ5
KSkgewogCQlyZXQgPSBQVFJfRVJSKHByaW1hcnkpOwogCQlnb3RvIGZhaWw7CkBAIC0yNTMsNyAr
MjU4LDExIEBAIGludCBpbnRlbF9jcnRjX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LCBlbnVtIHBpcGUgcGlwZSkKIAlmb3JfZWFjaF9zcHJpdGUoZGV2X3ByaXYsIHBpcGUs
IHNwcml0ZSkgewogCQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOwogCi0JCXBsYW5lID0gaW50
ZWxfc3ByaXRlX3BsYW5lX2NyZWF0ZShkZXZfcHJpdiwgcGlwZSwgc3ByaXRlKTsKKwkJaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPj0gOSkKKwkJCXBsYW5lID0gc2tsX3VuaXZlcnNhbF9wbGFuZV9j
cmVhdGUoZGV2X3ByaXYsIHBpcGUsCisJCQkJCQkJICAgUExBTkVfU1BSSVRFMCArIHNwcml0ZSk7
CisJCWVsc2UKKwkJCXBsYW5lID0gaW50ZWxfc3ByaXRlX3BsYW5lX2NyZWF0ZShkZXZfcHJpdiwg
cGlwZSwgc3ByaXRlKTsKIAkJaWYgKElTX0VSUihwbGFuZSkpIHsKIAkJCXJldCA9IFBUUl9FUlIo
cGxhbmUpOwogCQkJZ290byBmYWlsOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kZGkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGRpLmMKaW5kZXggNjFhYzFlMWI3YjU1Li40ZDM0Yzg1ZmI2YmYgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYwpAQCAtNTMsNiArNTMsNyBAQAogI2luY2x1ZGUgImlu
dGVsX3Nwcml0ZS5oIgogI2luY2x1ZGUgImludGVsX3RjLmgiCiAjaW5jbHVkZSAiaW50ZWxfdmRz
Yy5oIgorI2luY2x1ZGUgInNrbF91bml2ZXJzYWxfcGxhbmUuaCIKIAogc3RhdGljIGNvbnN0IHU4
IGluZGV4X3RvX2RwX3NpZ25hbF9sZXZlbHNbXSA9IHsKIAlbMF0gPSBEUF9UUkFJTl9WT0xUQUdF
X1NXSU5HX0xFVkVMXzAgfCBEUF9UUkFJTl9QUkVfRU1QSF9MRVZFTF8wLApkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRleCBhMmZhN2EyMTljNGEuLmFi
OWQxNjQzNDVlNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5LmMKQEAgLTkwLDYgKzkwLDcgQEAKICNpbmNsdWRlICJpbnRlbF90Yy5oIgogI2luY2x1ZGUg
ImludGVsX3ZnYS5oIgogI2luY2x1ZGUgImk5eHhfcGxhbmUuaCIKKyNpbmNsdWRlICJza2xfdW5p
dmVyc2FsX3BsYW5lLmgiCiAKIHN0YXRpYyB2b2lkIGk5eHhfY3J0Y19jbG9ja19nZXQoc3RydWN0
IGludGVsX2NydGMgKmNydGMsCiAJCQkJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29u
ZmlnKTsKQEAgLTExMiw3ICsxMTMsNiBAQCBzdGF0aWMgdm9pZCB2bHZfcHJlcGFyZV9wbGwoc3Ry
dWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKnBpcGVfY29uZmlnKTsKIHN0YXRpYyB2b2lkIGNodl9wcmVwYXJlX3BsbChzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YywKIAkJCSAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlw
ZV9jb25maWcpOwotc3RhdGljIHZvaWQgc2tsX3BmaXRfZW5hYmxlKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKIHN0YXRpYyB2b2lkIGlsa19wZml0X2VuYWJsZShj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7CiBzdGF0aWMgdm9pZCBp
bnRlbF9tb2Rlc2V0X3NldHVwX2h3X3N0YXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCQkJ
CSBzdHJ1Y3QgZHJtX21vZGVzZXRfYWNxdWlyZV9jdHggKmN0eCk7CkBAIC0xMDc4LDI2ICsxMDc4
LDYgQEAgc3RhdGljIHVuc2lnbmVkIGludCBpbnRlbF90aWxlX3NpemUoY29uc3Qgc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXJldHVybiBJU19HRU4oZGV2X3ByaXYsIDIpID8g
MjA0OCA6IDQwOTY7CiB9CiAKLXN0YXRpYyBib29sIGlzX2Njc19wbGFuZShjb25zdCBzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IHBsYW5lKQotewotCWlmICghaXNfY2NzX21vZGlmaWVy
KGZiLT5tb2RpZmllcikpCi0JCXJldHVybiBmYWxzZTsKLQotCXJldHVybiBwbGFuZSA+PSBmYi0+
Zm9ybWF0LT5udW1fcGxhbmVzIC8gMjsKLX0KLQotc3RhdGljIGJvb2wgaXNfZ2VuMTJfY2NzX21v
ZGlmaWVyKHU2NCBtb2RpZmllcikKLXsKLQlyZXR1cm4gbW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRf
TU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTIHx8Ci0JICAgICAgIG1vZGlmaWVyID09IEk5MTVfRk9S
TUFUX01PRF9ZX1RJTEVEX0dFTjEyX01DX0NDUzsKLQotfQotCi1zdGF0aWMgYm9vbCBpc19nZW4x
Ml9jY3NfcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBwbGFuZSkK
LXsKLQlyZXR1cm4gaXNfZ2VuMTJfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikgJiYgaXNfY2Nz
X3BsYW5lKGZiLCBwbGFuZSk7Ci19Ci0KIHN0YXRpYyBib29sIGlzX2F1eF9wbGFuZShjb25zdCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IHBsYW5lKQogewogCWlmIChpc19jY3NfbW9k
aWZpZXIoZmItPm1vZGlmaWVyKSkKQEAgLTExMDYsMzUgKzEwODYsNiBAQCBzdGF0aWMgYm9vbCBp
c19hdXhfcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBwbGFuZSkK
IAlyZXR1cm4gcGxhbmUgPT0gMTsKIH0KIAotc3RhdGljIGludCBtYWluX3RvX2Njc19wbGFuZShj
b25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IG1haW5fcGxhbmUpCi17Ci0JZHJt
X1dBUk5fT04oZmItPmRldiwgIWlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpIHx8Ci0JCSAg
ICAobWFpbl9wbGFuZSAmJiBtYWluX3BsYW5lID49IGZiLT5mb3JtYXQtPm51bV9wbGFuZXMgLyAy
KSk7Ci0KLQlyZXR1cm4gZmItPmZvcm1hdC0+bnVtX3BsYW5lcyAvIDIgKyBtYWluX3BsYW5lOwot
fQotCi1zdGF0aWMgaW50IGNjc190b19tYWluX3BsYW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVi
dWZmZXIgKmZiLCBpbnQgY2NzX3BsYW5lKQotewotCWRybV9XQVJOX09OKGZiLT5kZXYsICFpc19j
Y3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSB8fAotCQkgICAgY2NzX3BsYW5lIDwgZmItPmZvcm1h
dC0+bnVtX3BsYW5lcyAvIDIpOwotCi0JcmV0dXJuIGNjc19wbGFuZSAtIGZiLT5mb3JtYXQtPm51
bV9wbGFuZXMgLyAyOwotfQotCi1pbnQgaW50ZWxfbWFpbl90b19hdXhfcGxhbmUoY29uc3Qgc3Ry
dWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBtYWluX3BsYW5lKQotewotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShmYi0+ZGV2KTsKLQotCWlmIChpc19jY3NfbW9k
aWZpZXIoZmItPm1vZGlmaWVyKSkKLQkJcmV0dXJuIG1haW5fdG9fY2NzX3BsYW5lKGZiLCBtYWlu
X3BsYW5lKTsKLQllbHNlIGlmIChJTlRFTF9HRU4oaTkxNSkgPCAxMSAmJgotCQkgaW50ZWxfZm9y
bWF0X2luZm9faXNfeXV2X3NlbWlwbGFuYXIoZmItPmZvcm1hdCwgZmItPm1vZGlmaWVyKSkKLQkJ
cmV0dXJuIDE7Ci0JZWxzZQotCQlyZXR1cm4gMDsKLX0KLQogYm9vbAogaW50ZWxfZm9ybWF0X2lu
Zm9faXNfeXV2X3NlbWlwbGFuYXIoY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyAqaW5mbywK
IAkJCQkgICAgdTY0IG1vZGlmaWVyKQpAQCAtMTE1MCw3ICsxMTAxLDcgQEAgc3RhdGljIGJvb2wg
aXNfc2VtaXBsYW5hcl91dl9wbGFuZShjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwK
IAkgICAgICAgY29sb3JfcGxhbmUgPT0gMTsKIH0KIAotc3RhdGljIHVuc2lnbmVkIGludAordW5z
aWduZWQgaW50CiBpbnRlbF90aWxlX3dpZHRoX2J5dGVzKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVi
dWZmZXIgKmZiLCBpbnQgY29sb3JfcGxhbmUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShmYi0+ZGV2KTsKQEAgLTEyMDMsNyArMTE1NCw3IEBAIGludGVs
X3RpbGVfd2lkdGhfYnl0ZXMoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBj
b2xvcl9wbGFuZSkKIAl9CiB9CiAKLXN0YXRpYyB1bnNpZ25lZCBpbnQKK3Vuc2lnbmVkIGludAog
aW50ZWxfdGlsZV9oZWlnaHQoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBj
b2xvcl9wbGFuZSkKIHsKIAlpZiAoaXNfZ2VuMTJfY2NzX3BsYW5lKGZiLCBjb2xvcl9wbGFuZSkp
CkBAIC0xMzAzLDggKzEyNTQsOCBAQCBzdGF0aWMgdW5zaWduZWQgaW50IGludGVsX2xpbmVhcl9h
bGlnbm1lbnQoY29uc3Qgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcgogCQlyZXR1cm4g
MDsKIH0KIAotc3RhdGljIHVuc2lnbmVkIGludCBpbnRlbF9zdXJmX2FsaWdubWVudChjb25zdCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKLQkJCQkJIGludCBjb2xvcl9wbGFuZSkKK3Vuc2ln
bmVkIGludCBpbnRlbF9zdXJmX2FsaWdubWVudChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVy
ICpmYiwKKwkJCQkgIGludCBjb2xvcl9wbGFuZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGZiLT5kZXYpOwogCkBAIC0xNTczLDEwICsxNTI0LDEwIEBA
IHN0YXRpYyB1MzIgaW50ZWxfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KGludCAqeCwgaW50ICp5LAog
ICogQWRqdXN0IHRoZSB0aWxlIG9mZnNldCBieSBtb3ZpbmcgdGhlIGRpZmZlcmVuY2UgaW50bwog
ICogdGhlIHgveSBvZmZzZXRzLgogICovCi1zdGF0aWMgdTMyIGludGVsX3BsYW5lX2FkanVzdF9h
bGlnbmVkX29mZnNldChpbnQgKngsIGludCAqeSwKLQkJCQkJICAgICBjb25zdCBzdHJ1Y3QgaW50
ZWxfcGxhbmVfc3RhdGUgKnN0YXRlLAotCQkJCQkgICAgIGludCBjb2xvcl9wbGFuZSwKLQkJCQkJ
ICAgICB1MzIgb2xkX29mZnNldCwgdTMyIG5ld19vZmZzZXQpCit1MzIgaW50ZWxfcGxhbmVfYWRq
dXN0X2FsaWduZWRfb2Zmc2V0KGludCAqeCwgaW50ICp5LAorCQkJCSAgICAgIGNvbnN0IHN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqc3RhdGUsCisJCQkJICAgICAgaW50IGNvbG9yX3BsYW5lLAor
CQkJCSAgICAgIHUzMiBvbGRfb2Zmc2V0LCB1MzIgbmV3X29mZnNldCkKIHsKIAlyZXR1cm4gaW50
ZWxfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KHgsIHksIHN0YXRlLT5ody5mYiwgY29sb3JfcGxhbmUs
CiAJCQkJCSAgIHN0YXRlLT5ody5yb3RhdGlvbiwKQEAgLTE4NTAsNyArMTgwMSw3IEBAIGJvb2wg
aXNfY2NzX21vZGlmaWVyKHU2NCBtb2RpZmllcikKIAogc3RhdGljIGludCBnZW4xMl9jY3NfYXV4
X3N0cmlkZShzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNjc19wbGFuZSkKIHsKLQly
ZXR1cm4gRElWX1JPVU5EX1VQKGZiLT5waXRjaGVzW2Njc190b19tYWluX3BsYW5lKGZiLCBjY3Nf
cGxhbmUpXSwKKwlyZXR1cm4gRElWX1JPVU5EX1VQKGZiLT5waXRjaGVzW3NrbF9jY3NfdG9fbWFp
bl9wbGFuZShmYiwgY2NzX3BsYW5lKV0sCiAJCQkgICAgNTEyKSAqIDY0OwogfQogCkBAIC0yMDA4
LDcgKzE5NTksNyBAQCBzdGF0aWMgYm9vbCBpbnRlbF9wbGFuZV9uZWVkc19yZW1hcChjb25zdCBz
dHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCXJldHVybiBzdHJpZGUgPiBt
YXhfc3RyaWRlOwogfQogCi1zdGF0aWMgdm9pZAordm9pZAogaW50ZWxfZmJfcGxhbmVfZ2V0X3N1
YnNhbXBsaW5nKGludCAqaHN1YiwgaW50ICp2c3ViLAogCQkJICAgICAgIGNvbnN0IHN0cnVjdCBk
cm1fZnJhbWVidWZmZXIgKmZiLAogCQkJICAgICAgIGludCBjb2xvcl9wbGFuZSkKQEAgLTIwMzMs
NyArMTk4NCw3IEBAIGludGVsX2ZiX3BsYW5lX2dldF9zdWJzYW1wbGluZyhpbnQgKmhzdWIsIGlu
dCAqdnN1YiwKIAkJcmV0dXJuOwogCX0KIAotCW1haW5fcGxhbmUgPSBjY3NfdG9fbWFpbl9wbGFu
ZShmYiwgY29sb3JfcGxhbmUpOworCW1haW5fcGxhbmUgPSBza2xfY2NzX3RvX21haW5fcGxhbmUo
ZmIsIGNvbG9yX3BsYW5lKTsKIAkqaHN1YiA9IGRybV9mb3JtYXRfaW5mb19ibG9ja193aWR0aChm
Yi0+Zm9ybWF0LCBjb2xvcl9wbGFuZSkgLwogCQlkcm1fZm9ybWF0X2luZm9fYmxvY2tfd2lkdGgo
ZmItPmZvcm1hdCwgbWFpbl9wbGFuZSk7CiAKQEAgLTIwNzMsNyArMjAyNCw3IEBAIGludGVsX2Zi
X2NoZWNrX2Njc194eShzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNjc19wbGFuZSwg
aW50IHgsIGludCB5KQogCWNjc194ID0gKHggKiBoc3ViKSAlIHRpbGVfd2lkdGg7CiAJY2NzX3kg
PSAoeSAqIHZzdWIpICUgdGlsZV9oZWlnaHQ7CiAKLQltYWluX3BsYW5lID0gY2NzX3RvX21haW5f
cGxhbmUoZmIsIGNjc19wbGFuZSk7CisJbWFpbl9wbGFuZSA9IHNrbF9jY3NfdG9fbWFpbl9wbGFu
ZShmYiwgY2NzX3BsYW5lKTsKIAltYWluX3ggPSBpbnRlbF9mYi0+bm9ybWFsW21haW5fcGxhbmVd
LnggJSB0aWxlX3dpZHRoOwogCW1haW5feSA9IGludGVsX2ZiLT5ub3JtYWxbbWFpbl9wbGFuZV0u
eSAlIHRpbGVfaGVpZ2h0OwogCkBAIC0yMDk5LDcgKzIwNTAsNyBAQCBzdGF0aWMgdm9pZAogaW50
ZWxfZmJfcGxhbmVfZGltcyhpbnQgKncsIGludCAqaCwgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAq
ZmIsIGludCBjb2xvcl9wbGFuZSkKIHsKIAlpbnQgbWFpbl9wbGFuZSA9IGlzX2Njc19wbGFuZShm
YiwgY29sb3JfcGxhbmUpID8KLQkJCSBjY3NfdG9fbWFpbl9wbGFuZShmYiwgY29sb3JfcGxhbmUp
IDogMDsKKwkJCSBza2xfY2NzX3RvX21haW5fcGxhbmUoZmIsIGNvbG9yX3BsYW5lKSA6IDA7CiAJ
aW50IG1haW5faHN1YiwgbWFpbl92c3ViOwogCWludCBoc3ViLCB2c3ViOwogCkBAIC0yNDc0LDcz
ICsyNDI1LDYgQEAgc3RhdGljIGludCBpOXh4X2Zvcm1hdF90b19mb3VyY2MoaW50IGZvcm1hdCkK
IAl9CiB9CiAKLWludCBza2xfZm9ybWF0X3RvX2ZvdXJjYyhpbnQgZm9ybWF0LCBib29sIHJnYl9v
cmRlciwgYm9vbCBhbHBoYSkKLXsKLQlzd2l0Y2ggKGZvcm1hdCkgewotCWNhc2UgUExBTkVfQ1RM
X0ZPUk1BVF9SR0JfNTY1OgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9SR0I1NjU7Ci0JY2FzZSBQTEFO
RV9DVExfRk9STUFUX05WMTI6Ci0JCXJldHVybiBEUk1fRk9STUFUX05WMTI7Ci0JY2FzZSBQTEFO
RV9DVExfRk9STUFUX1hZVVY6Ci0JCXJldHVybiBEUk1fRk9STUFUX1hZVVY4ODg4OwotCWNhc2Ug
UExBTkVfQ1RMX0ZPUk1BVF9QMDEwOgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9QMDEwOwotCWNhc2Ug
UExBTkVfQ1RMX0ZPUk1BVF9QMDEyOgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9QMDEyOwotCWNhc2Ug
UExBTkVfQ1RMX0ZPUk1BVF9QMDE2OgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9QMDE2OwotCWNhc2Ug
UExBTkVfQ1RMX0ZPUk1BVF9ZMjEwOgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9ZMjEwOwotCWNhc2Ug
UExBTkVfQ1RMX0ZPUk1BVF9ZMjEyOgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9ZMjEyOwotCWNhc2Ug
UExBTkVfQ1RMX0ZPUk1BVF9ZMjE2OgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9ZMjE2OwotCWNhc2Ug
UExBTkVfQ1RMX0ZPUk1BVF9ZNDEwOgotCQlyZXR1cm4gRFJNX0ZPUk1BVF9YVllVMjEwMTAxMDsK
LQljYXNlIFBMQU5FX0NUTF9GT1JNQVRfWTQxMjoKLQkJcmV0dXJuIERSTV9GT1JNQVRfWFZZVTEy
XzE2MTYxNjE2OwotCWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9ZNDE2OgotCQlyZXR1cm4gRFJNX0ZP
Uk1BVF9YVllVMTYxNjE2MTY7Ci0JZGVmYXVsdDoKLQljYXNlIFBMQU5FX0NUTF9GT1JNQVRfWFJH
Ql84ODg4OgotCQlpZiAocmdiX29yZGVyKSB7Ci0JCQlpZiAoYWxwaGEpCi0JCQkJcmV0dXJuIERS
TV9GT1JNQVRfQUJHUjg4ODg7Ci0JCQllbHNlCi0JCQkJcmV0dXJuIERSTV9GT1JNQVRfWEJHUjg4
ODg7Ci0JCX0gZWxzZSB7Ci0JCQlpZiAoYWxwaGEpCi0JCQkJcmV0dXJuIERSTV9GT1JNQVRfQVJH
Qjg4ODg7Ci0JCQllbHNlCi0JCQkJcmV0dXJuIERSTV9GT1JNQVRfWFJHQjg4ODg7Ci0JCX0KLQlj
YXNlIFBMQU5FX0NUTF9GT1JNQVRfWFJHQl8yMTAxMDEwOgotCQlpZiAocmdiX29yZGVyKSB7Ci0J
CQlpZiAoYWxwaGEpCi0JCQkJcmV0dXJuIERSTV9GT1JNQVRfQUJHUjIxMDEwMTA7Ci0JCQllbHNl
Ci0JCQkJcmV0dXJuIERSTV9GT1JNQVRfWEJHUjIxMDEwMTA7Ci0JCX0gZWxzZSB7Ci0JCQlpZiAo
YWxwaGEpCi0JCQkJcmV0dXJuIERSTV9GT1JNQVRfQVJHQjIxMDEwMTA7Ci0JCQllbHNlCi0JCQkJ
cmV0dXJuIERSTV9GT1JNQVRfWFJHQjIxMDEwMTA7Ci0JCX0KLQljYXNlIFBMQU5FX0NUTF9GT1JN
QVRfWFJHQl8xNjE2MTYxNkY6Ci0JCWlmIChyZ2Jfb3JkZXIpIHsKLQkJCWlmIChhbHBoYSkKLQkJ
CQlyZXR1cm4gRFJNX0ZPUk1BVF9BQkdSMTYxNjE2MTZGOwotCQkJZWxzZQotCQkJCXJldHVybiBE
Uk1fRk9STUFUX1hCR1IxNjE2MTYxNkY7Ci0JCX0gZWxzZSB7Ci0JCQlpZiAoYWxwaGEpCi0JCQkJ
cmV0dXJuIERSTV9GT1JNQVRfQVJHQjE2MTYxNjE2RjsKLQkJCWVsc2UKLQkJCQlyZXR1cm4gRFJN
X0ZPUk1BVF9YUkdCMTYxNjE2MTZGOwotCQl9Ci0JfQotfQotCiBzdGF0aWMgc3RydWN0IGk5MTVf
dm1hICoKIGluaXRpYWxfcGxhbmVfdm1hKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAog
CQkgIHN0cnVjdCBpbnRlbF9pbml0aWFsX3BsYW5lX2NvbmZpZyAqcGxhbmVfY29uZmlnKQpAQCAt
Mjg0NSwzNjIgKzI3MjksNiBAQCBpbnRlbF9maW5kX2luaXRpYWxfcGxhbmVfb2JqKHN0cnVjdCBp
bnRlbF9jcnRjICppbnRlbF9jcnRjLAogCQkgICZ0b19pbnRlbF9mcm9udGJ1ZmZlcihmYiktPmJp
dHMpOwogfQogCi0KLXN0YXRpYyBib29sCi1za2xfY2hlY2tfbWFpbl9jY3NfY29vcmRpbmF0ZXMo
c3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKLQkJCSAgICAgICBpbnQgbWFp
bl94LCBpbnQgbWFpbl95LCB1MzIgbWFpbl9vZmZzZXQsCi0JCQkgICAgICAgaW50IGNjc19wbGFu
ZSkKLXsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5o
dy5mYjsKLQlpbnQgYXV4X3ggPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS54
OwotCWludCBhdXhfeSA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLnk7Ci0J
dTMyIGF1eF9vZmZzZXQgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS5vZmZz
ZXQ7Ci0JdTMyIGFsaWdubWVudCA9IGludGVsX3N1cmZfYWxpZ25tZW50KGZiLCBjY3NfcGxhbmUp
OwotCWludCBoc3ViOwotCWludCB2c3ViOwotCi0JaW50ZWxfZmJfcGxhbmVfZ2V0X3N1YnNhbXBs
aW5nKCZoc3ViLCAmdnN1YiwgZmIsIGNjc19wbGFuZSk7Ci0Jd2hpbGUgKGF1eF9vZmZzZXQgPj0g
bWFpbl9vZmZzZXQgJiYgYXV4X3kgPD0gbWFpbl95KSB7Ci0JCWludCB4LCB5OwotCi0JCWlmIChh
dXhfeCA9PSBtYWluX3ggJiYgYXV4X3kgPT0gbWFpbl95KQotCQkJYnJlYWs7Ci0KLQkJaWYgKGF1
eF9vZmZzZXQgPT0gMCkKLQkJCWJyZWFrOwotCi0JCXggPSBhdXhfeCAvIGhzdWI7Ci0JCXkgPSBh
dXhfeSAvIHZzdWI7Ci0JCWF1eF9vZmZzZXQgPSBpbnRlbF9wbGFuZV9hZGp1c3RfYWxpZ25lZF9v
ZmZzZXQoJngsICZ5LAotCQkJCQkJCSAgICAgICBwbGFuZV9zdGF0ZSwKLQkJCQkJCQkgICAgICAg
Y2NzX3BsYW5lLAotCQkJCQkJCSAgICAgICBhdXhfb2Zmc2V0LAotCQkJCQkJCSAgICAgICBhdXhf
b2Zmc2V0IC0KLQkJCQkJCQkJYWxpZ25tZW50KTsKLQkJYXV4X3ggPSB4ICogaHN1YiArIGF1eF94
ICUgaHN1YjsKLQkJYXV4X3kgPSB5ICogdnN1YiArIGF1eF95ICUgdnN1YjsKLQl9Ci0KLQlpZiAo
YXV4X3ggIT0gbWFpbl94IHx8IGF1eF95ICE9IG1haW5feSkKLQkJcmV0dXJuIGZhbHNlOwotCi0J
cGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ub2Zmc2V0ID0gYXV4X29mZnNldDsK
LQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS54ID0gYXV4X3g7Ci0JcGxhbmVf
c3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueSA9IGF1eF95OwotCi0JcmV0dXJuIHRydWU7
Ci19Ci0KLXVuc2lnbmVkIGludAotaW50ZWxfcGxhbmVfZmVuY2VfeV9vZmZzZXQoY29uc3Qgc3Ry
dWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKLXsKLQlpbnQgeCA9IDAsIHkgPSAw
OwotCi0JaW50ZWxfcGxhbmVfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KCZ4LCAmeSwgcGxhbmVfc3Rh
dGUsIDAsCi0JCQkJCSAgcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLm9mZnNldCwgMCk7Ci0K
LQlyZXR1cm4geTsKLX0KLQotc3RhdGljIGludCBpbnRlbF9wbGFuZV9taW5fd2lkdGgoc3RydWN0
IGludGVsX3BsYW5lICpwbGFuZSwKLQkJCQkgY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAq
ZmIsCi0JCQkJIGludCBjb2xvcl9wbGFuZSwKLQkJCQkgdW5zaWduZWQgaW50IHJvdGF0aW9uKQot
ewotCWlmIChwbGFuZS0+bWluX3dpZHRoKQotCQlyZXR1cm4gcGxhbmUtPm1pbl93aWR0aChmYiwg
Y29sb3JfcGxhbmUsIHJvdGF0aW9uKTsKLQllbHNlCi0JCXJldHVybiAxOwotfQotCi1zdGF0aWMg
aW50IGludGVsX3BsYW5lX21heF93aWR0aChzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAotCQkJ
CSBjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKLQkJCQkgaW50IGNvbG9yX3BsYW5l
LAotCQkJCSB1bnNpZ25lZCBpbnQgcm90YXRpb24pCi17Ci0JaWYgKHBsYW5lLT5tYXhfd2lkdGgp
Ci0JCXJldHVybiBwbGFuZS0+bWF4X3dpZHRoKGZiLCBjb2xvcl9wbGFuZSwgcm90YXRpb24pOwot
CWVsc2UKLQkJcmV0dXJuIElOVF9NQVg7Ci19Ci0KLXN0YXRpYyBpbnQgaW50ZWxfcGxhbmVfbWF4
X2hlaWdodChzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAotCQkJCSAgY29uc3Qgc3RydWN0IGRy
bV9mcmFtZWJ1ZmZlciAqZmIsCi0JCQkJICBpbnQgY29sb3JfcGxhbmUsCi0JCQkJICB1bnNpZ25l
ZCBpbnQgcm90YXRpb24pCi17Ci0JaWYgKHBsYW5lLT5tYXhfaGVpZ2h0KQotCQlyZXR1cm4gcGxh
bmUtPm1heF9oZWlnaHQoZmIsIGNvbG9yX3BsYW5lLCByb3RhdGlvbik7Ci0JZWxzZQotCQlyZXR1
cm4gSU5UX01BWDsKLX0KLQotaW50IHNrbF9jYWxjX21haW5fc3VyZmFjZV9vZmZzZXQoY29uc3Qg
c3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKLQkJCQkgaW50ICp4LCBpbnQg
KnksIHUzMiAqb2Zmc2V0KQotewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRl
bF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwotCWNvbnN0IHN0cnVjdCBk
cm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwotCWNvbnN0IGludCBhdXhf
cGxhbmUgPSBpbnRlbF9tYWluX3RvX2F1eF9wbGFuZShmYiwgMCk7Ci0JY29uc3QgdTMyIGF1eF9v
ZmZzZXQgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbYXV4X3BsYW5lXS5vZmZzZXQ7Ci0JY29u
c3QgdTMyIGFsaWdubWVudCA9IGludGVsX3N1cmZfYWxpZ25tZW50KGZiLCAwKTsKLQljb25zdCBp
bnQgdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OwotCi0J
aW50ZWxfYWRkX2ZiX29mZnNldHMoeCwgeSwgcGxhbmVfc3RhdGUsIDApOwotCSpvZmZzZXQgPSBp
bnRlbF9wbGFuZV9jb21wdXRlX2FsaWduZWRfb2Zmc2V0KHgsIHksIHBsYW5lX3N0YXRlLCAwKTsK
LQlpZiAoZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIGFsaWdubWVudCAmJiAhaXNfcG93ZXJf
b2ZfMihhbGlnbm1lbnQpKSkKLQkJcmV0dXJuIC1FSU5WQUw7Ci0KLQkvKgotCSAqIEFVWCBzdXJm
YWNlIG9mZnNldCBpcyBzcGVjaWZpZWQgYXMgdGhlIGRpc3RhbmNlIGZyb20gdGhlCi0JICogbWFp
biBzdXJmYWNlIG9mZnNldCwgYW5kIGl0IG11c3QgYmUgbm9uLW5lZ2F0aXZlLiBNYWtlCi0JICog
c3VyZSB0aGF0IGlzIHdoYXQgd2Ugd2lsbCBnZXQuCi0JICovCi0JaWYgKGF1eF9wbGFuZSAmJiAq
b2Zmc2V0ID4gYXV4X29mZnNldCkKLQkJKm9mZnNldCA9IGludGVsX3BsYW5lX2FkanVzdF9hbGln
bmVkX29mZnNldCh4LCB5LCBwbGFuZV9zdGF0ZSwgMCwKLQkJCQkJCQkgICAgKm9mZnNldCwKLQkJ
CQkJCQkgICAgYXV4X29mZnNldCAmIH4oYWxpZ25tZW50IC0gMSkpOwotCi0JLyoKLQkgKiBXaGVu
IHVzaW5nIGFuIFgtdGlsZWQgc3VyZmFjZSwgdGhlIHBsYW5lIGJsb3dzIHVwCi0JICogaWYgdGhl
IHggb2Zmc2V0ICsgd2lkdGggZXhjZWVkIHRoZSBzdHJpZGUuCi0JICoKLQkgKiBUT0RPOiBsaW5l
YXIgYW5kIFktdGlsZWQgc2VlbSBmaW5lLCBZZiB1bnRlc3RlZCwKLQkgKi8KLQlpZiAoZmItPm1v
ZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9YX1RJTEVEKSB7Ci0JCWludCBjcHAgPSBmYi0+Zm9y
bWF0LT5jcHBbMF07Ci0KLQkJd2hpbGUgKCgqeCArIHcpICogY3BwID4gcGxhbmVfc3RhdGUtPmNv
bG9yX3BsYW5lWzBdLnN0cmlkZSkgewotCQkJaWYgKCpvZmZzZXQgPT0gMCkgewotCQkJCWRybV9k
Ymdfa21zKCZkZXZfcHJpdi0+ZHJtLAotCQkJCQkgICAgIlVuYWJsZSB0byBmaW5kIHN1aXRhYmxl
IGRpc3BsYXkgc3VyZmFjZSBvZmZzZXQgZHVlIHRvIFgtdGlsaW5nXG4iKTsKLQkJCQlyZXR1cm4g
LUVJTlZBTDsKLQkJCX0KLQotCQkJKm9mZnNldCA9IGludGVsX3BsYW5lX2FkanVzdF9hbGlnbmVk
X29mZnNldCh4LCB5LCBwbGFuZV9zdGF0ZSwgMCwKLQkJCQkJCQkJICAgICpvZmZzZXQsCi0JCQkJ
CQkJCSAgICAqb2Zmc2V0IC0gYWxpZ25tZW50KTsKLQkJfQotCX0KLQotCXJldHVybiAwOwotfQot
Ci1zdGF0aWMgaW50IHNrbF9jaGVja19tYWluX3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0
YXRlICpwbGFuZV9zdGF0ZSkKLXsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50
ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQljb25zdCBzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKLQljb25zdCB1bnNpZ25l
ZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247Ci0JaW50IHggPSBwbGFu
ZV9zdGF0ZS0+dWFwaS5zcmMueDEgPj4gMTY7Ci0JaW50IHkgPSBwbGFuZV9zdGF0ZS0+dWFwaS5z
cmMueTEgPj4gMTY7Ci0JY29uc3QgaW50IHcgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUt
PnVhcGkuc3JjKSA+PiAxNjsKLQljb25zdCBpbnQgaCA9IGRybV9yZWN0X2hlaWdodCgmcGxhbmVf
c3RhdGUtPnVhcGkuc3JjKSA+PiAxNjsKLQljb25zdCBpbnQgbWluX3dpZHRoID0gaW50ZWxfcGxh
bmVfbWluX3dpZHRoKHBsYW5lLCBmYiwgMCwgcm90YXRpb24pOwotCWNvbnN0IGludCBtYXhfd2lk
dGggPSBpbnRlbF9wbGFuZV9tYXhfd2lkdGgocGxhbmUsIGZiLCAwLCByb3RhdGlvbik7Ci0JY29u
c3QgaW50IG1heF9oZWlnaHQgPSBpbnRlbF9wbGFuZV9tYXhfaGVpZ2h0KHBsYW5lLCBmYiwgMCwg
cm90YXRpb24pOwotCWNvbnN0IGludCBhdXhfcGxhbmUgPSBpbnRlbF9tYWluX3RvX2F1eF9wbGFu
ZShmYiwgMCk7Ci0JY29uc3QgdTMyIGFsaWdubWVudCA9IGludGVsX3N1cmZfYWxpZ25tZW50KGZi
LCAwKTsKLQl1MzIgb2Zmc2V0OwotCWludCByZXQ7Ci0KLQlpZiAodyA+IG1heF93aWR0aCB8fCB3
IDwgbWluX3dpZHRoIHx8IGggPiBtYXhfaGVpZ2h0KSB7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJp
di0+ZHJtLAotCQkJICAgICJyZXF1ZXN0ZWQgWS9SR0Igc291cmNlIHNpemUgJWR4JWQgb3V0c2lk
ZSBsaW1pdHMgKG1pbjogJWR4MSBtYXg6ICVkeCVkKVxuIiwKLQkJCSAgICB3LCBoLCBtaW5fd2lk
dGgsIG1heF93aWR0aCwgbWF4X2hlaWdodCk7Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQotCXJl
dCA9IHNrbF9jYWxjX21haW5fc3VyZmFjZV9vZmZzZXQocGxhbmVfc3RhdGUsICZ4LCAmeSwgJm9m
ZnNldCk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQotCS8qCi0JICogQ0NTIEFVWCBzdXJm
YWNlIGRvZXNuJ3QgaGF2ZSBpdHMgb3duIHgveSBvZmZzZXRzLCB3ZSBtdXN0IG1ha2Ugc3VyZQot
CSAqIHRoZXkgbWF0Y2ggd2l0aCB0aGUgbWFpbiBzdXJmYWNlIHgveSBvZmZzZXRzLgotCSAqLwot
CWlmIChpc19jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSkgewotCQl3aGlsZSAoIXNrbF9jaGVj
a19tYWluX2Njc19jb29yZGluYXRlcyhwbGFuZV9zdGF0ZSwgeCwgeSwKLQkJCQkJCSAgICAgICBv
ZmZzZXQsIGF1eF9wbGFuZSkpIHsKLQkJCWlmIChvZmZzZXQgPT0gMCkKLQkJCQlicmVhazsKLQot
CQkJb2Zmc2V0ID0gaW50ZWxfcGxhbmVfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KCZ4LCAmeSwgcGxh
bmVfc3RhdGUsIDAsCi0JCQkJCQkJCSAgIG9mZnNldCwgb2Zmc2V0IC0gYWxpZ25tZW50KTsKLQkJ
fQotCi0JCWlmICh4ICE9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVthdXhfcGxhbmVdLnggfHwK
LQkJICAgIHkgIT0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2F1eF9wbGFuZV0ueSkgewotCQkJ
ZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCi0JCQkJICAgICJVbmFibGUgdG8gZmluZCBzdWl0
YWJsZSBkaXNwbGF5IHN1cmZhY2Ugb2Zmc2V0IGR1ZSB0byBDQ1NcbiIpOwotCQkJcmV0dXJuIC1F
SU5WQUw7Ci0JCX0KLQl9Ci0KLQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ub2Zmc2V0ID0g
b2Zmc2V0OwotCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS54ID0geDsKLQlwbGFuZV9zdGF0
ZS0+Y29sb3JfcGxhbmVbMF0ueSA9IHk7Ci0KLQkvKgotCSAqIFB1dCB0aGUgZmluYWwgY29vcmRp
bmF0ZXMgYmFjayBzbyB0aGF0IHRoZSBzcmMKLQkgKiBjb29yZGluYXRlIGNoZWNrcyB3aWxsIHNl
ZSB0aGUgcmlnaHQgdmFsdWVzLgotCSAqLwotCWRybV9yZWN0X3RyYW5zbGF0ZV90bygmcGxhbmVf
c3RhdGUtPnVhcGkuc3JjLAotCQkJICAgICAgeCA8PCAxNiwgeSA8PCAxNik7Ci0KLQlyZXR1cm4g
MDsKLX0KLQotc3RhdGljIGludCBza2xfY2hlY2tfbnYxMl9hdXhfc3VyZmFjZShzdHJ1Y3QgaW50
ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQotewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxh
bmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7Ci0JY29uc3Qg
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7Ci0JdW5zaWdu
ZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwotCWludCB1dl9wbGFu
ZSA9IDE7Ci0JaW50IG1heF93aWR0aCA9IGludGVsX3BsYW5lX21heF93aWR0aChwbGFuZSwgZmIs
IHV2X3BsYW5lLCByb3RhdGlvbik7Ci0JaW50IG1heF9oZWlnaHQgPSBpbnRlbF9wbGFuZV9tYXhf
aGVpZ2h0KHBsYW5lLCBmYiwgdXZfcGxhbmUsIHJvdGF0aW9uKTsKLQlpbnQgeCA9IHBsYW5lX3N0
YXRlLT51YXBpLnNyYy54MSA+PiAxNzsKLQlpbnQgeSA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy55
MSA+PiAxNzsKLQlpbnQgdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMp
ID4+IDE3OwotCWludCBoID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMp
ID4+IDE3OwotCXUzMiBvZmZzZXQ7Ci0KLQkvKiBGSVhNRSBub3QgcXVpdGUgc3VyZSBob3cvaWYg
dGhlc2UgYXBwbHkgdG8gdGhlIGNocm9tYSBwbGFuZSAqLwotCWlmICh3ID4gbWF4X3dpZHRoIHx8
IGggPiBtYXhfaGVpZ2h0KSB7Ci0JCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCi0JCQkgICAgIkNi
Q3Igc291cmNlIHNpemUgJWR4JWQgdG9vIGJpZyAobGltaXQgJWR4JWQpXG4iLAotCQkJICAgIHcs
IGgsIG1heF93aWR0aCwgbWF4X2hlaWdodCk7Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQotCWlu
dGVsX2FkZF9mYl9vZmZzZXRzKCZ4LCAmeSwgcGxhbmVfc3RhdGUsIHV2X3BsYW5lKTsKLQlvZmZz
ZXQgPSBpbnRlbF9wbGFuZV9jb21wdXRlX2FsaWduZWRfb2Zmc2V0KCZ4LCAmeSwKLQkJCQkJCSAg
ICBwbGFuZV9zdGF0ZSwgdXZfcGxhbmUpOwotCi0JaWYgKGlzX2Njc19tb2RpZmllcihmYi0+bW9k
aWZpZXIpKSB7Ci0JCWludCBjY3NfcGxhbmUgPSBtYWluX3RvX2Njc19wbGFuZShmYiwgdXZfcGxh
bmUpOwotCQl1MzIgYXV4X29mZnNldCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxh
bmVdLm9mZnNldDsKLQkJdTMyIGFsaWdubWVudCA9IGludGVsX3N1cmZfYWxpZ25tZW50KGZiLCB1
dl9wbGFuZSk7Ci0KLQkJaWYgKG9mZnNldCA+IGF1eF9vZmZzZXQpCi0JCQlvZmZzZXQgPSBpbnRl
bF9wbGFuZV9hZGp1c3RfYWxpZ25lZF9vZmZzZXQoJngsICZ5LAotCQkJCQkJCQkgICBwbGFuZV9z
dGF0ZSwKLQkJCQkJCQkJICAgdXZfcGxhbmUsCi0JCQkJCQkJCSAgIG9mZnNldCwKLQkJCQkJCQkJ
ICAgYXV4X29mZnNldCAmIH4oYWxpZ25tZW50IC0gMSkpOwotCi0JCXdoaWxlICghc2tsX2NoZWNr
X21haW5fY2NzX2Nvb3JkaW5hdGVzKHBsYW5lX3N0YXRlLCB4LCB5LAotCQkJCQkJICAgICAgIG9m
ZnNldCwgY2NzX3BsYW5lKSkgewotCQkJaWYgKG9mZnNldCA9PSAwKQotCQkJCWJyZWFrOwotCi0J
CQlvZmZzZXQgPSBpbnRlbF9wbGFuZV9hZGp1c3RfYWxpZ25lZF9vZmZzZXQoJngsICZ5LAotCQkJ
CQkJCQkgICBwbGFuZV9zdGF0ZSwKLQkJCQkJCQkJICAgdXZfcGxhbmUsCi0JCQkJCQkJCSAgIG9m
ZnNldCwgb2Zmc2V0IC0gYWxpZ25tZW50KTsKLQkJfQotCi0JCWlmICh4ICE9IHBsYW5lX3N0YXRl
LT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLnggfHwKLQkJICAgIHkgIT0gcGxhbmVfc3RhdGUtPmNv
bG9yX3BsYW5lW2Njc19wbGFuZV0ueSkgewotCQkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKLQkJ
CQkgICAgIlVuYWJsZSB0byBmaW5kIHN1aXRhYmxlIGRpc3BsYXkgc3VyZmFjZSBvZmZzZXQgZHVl
IHRvIENDU1xuIik7Ci0JCQlyZXR1cm4gLUVJTlZBTDsKLQkJfQotCX0KLQotCXBsYW5lX3N0YXRl
LT5jb2xvcl9wbGFuZVt1dl9wbGFuZV0ub2Zmc2V0ID0gb2Zmc2V0OwotCXBsYW5lX3N0YXRlLT5j
b2xvcl9wbGFuZVt1dl9wbGFuZV0ueCA9IHg7Ci0JcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW3V2
X3BsYW5lXS55ID0geTsKLQotCXJldHVybiAwOwotfQotCi1zdGF0aWMgaW50IHNrbF9jaGVja19j
Y3NfYXV4X3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKLXsK
LQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsK
LQlpbnQgc3JjX3ggPSBwbGFuZV9zdGF0ZS0+dWFwaS5zcmMueDEgPj4gMTY7Ci0JaW50IHNyY195
ID0gcGxhbmVfc3RhdGUtPnVhcGkuc3JjLnkxID4+IDE2OwotCXUzMiBvZmZzZXQ7Ci0JaW50IGNj
c19wbGFuZTsKLQotCWZvciAoY2NzX3BsYW5lID0gMDsgY2NzX3BsYW5lIDwgZmItPmZvcm1hdC0+
bnVtX3BsYW5lczsgY2NzX3BsYW5lKyspIHsKLQkJaW50IG1haW5faHN1YiwgbWFpbl92c3ViOwot
CQlpbnQgaHN1YiwgdnN1YjsKLQkJaW50IHgsIHk7Ci0KLQkJaWYgKCFpc19jY3NfcGxhbmUoZmIs
IGNjc19wbGFuZSkpCi0JCQljb250aW51ZTsKLQotCQlpbnRlbF9mYl9wbGFuZV9nZXRfc3Vic2Ft
cGxpbmcoJm1haW5faHN1YiwgJm1haW5fdnN1YiwgZmIsCi0JCQkJCSAgICAgICBjY3NfdG9fbWFp
bl9wbGFuZShmYiwgY2NzX3BsYW5lKSk7Ci0JCWludGVsX2ZiX3BsYW5lX2dldF9zdWJzYW1wbGlu
ZygmaHN1YiwgJnZzdWIsIGZiLCBjY3NfcGxhbmUpOwotCi0JCWhzdWIgKj0gbWFpbl9oc3ViOwot
CQl2c3ViICo9IG1haW5fdnN1YjsKLQkJeCA9IHNyY194IC8gaHN1YjsKLQkJeSA9IHNyY195IC8g
dnN1YjsKLQotCQlpbnRlbF9hZGRfZmJfb2Zmc2V0cygmeCwgJnksIHBsYW5lX3N0YXRlLCBjY3Nf
cGxhbmUpOwotCi0JCW9mZnNldCA9IGludGVsX3BsYW5lX2NvbXB1dGVfYWxpZ25lZF9vZmZzZXQo
JngsICZ5LAotCQkJCQkJCSAgICBwbGFuZV9zdGF0ZSwKLQkJCQkJCQkgICAgY2NzX3BsYW5lKTsK
LQotCQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS5vZmZzZXQgPSBvZmZzZXQ7
Ci0JCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLnggPSAoeCAqIGhzdWIgKwot
CQkJCQkJCSBzcmNfeCAlIGhzdWIpIC8KLQkJCQkJCQltYWluX2hzdWI7Ci0JCXBsYW5lX3N0YXRl
LT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLnkgPSAoeSAqIHZzdWIgKwotCQkJCQkJCSBzcmNfeSAl
IHZzdWIpIC8KLQkJCQkJCQltYWluX3ZzdWI7Ci0JfQotCi0JcmV0dXJuIDA7Ci19Ci0KLWludCBz
a2xfY2hlY2tfcGxhbmVfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0
YXRlKQotewotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUt
Pmh3LmZiOwotCWludCByZXQsIGk7Ci0KLQlyZXQgPSBpbnRlbF9wbGFuZV9jb21wdXRlX2d0dChw
bGFuZV9zdGF0ZSk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQotCWlmICghcGxhbmVfc3Rh
dGUtPnVhcGkudmlzaWJsZSkKLQkJcmV0dXJuIDA7Ci0KLQkvKgotCSAqIEhhbmRsZSB0aGUgQVVY
IHN1cmZhY2UgZmlyc3Qgc2luY2UgdGhlIG1haW4gc3VyZmFjZSBzZXR1cCBkZXBlbmRzIG9uCi0J
ICogaXQuCi0JICovCi0JaWYgKGlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpKSB7Ci0JCXJl
dCA9IHNrbF9jaGVja19jY3NfYXV4X3N1cmZhY2UocGxhbmVfc3RhdGUpOwotCQlpZiAocmV0KQot
CQkJcmV0dXJuIHJldDsKLQl9Ci0KLQlpZiAoaW50ZWxfZm9ybWF0X2luZm9faXNfeXV2X3NlbWlw
bGFuYXIoZmItPmZvcm1hdCwKLQkJCQkJCWZiLT5tb2RpZmllcikpIHsKLQkJcmV0ID0gc2tsX2No
ZWNrX252MTJfYXV4X3N1cmZhY2UocGxhbmVfc3RhdGUpOwotCQlpZiAocmV0KQotCQkJcmV0dXJu
IHJldDsKLQl9Ci0KLQlmb3IgKGkgPSBmYi0+Zm9ybWF0LT5udW1fcGxhbmVzOyBpIDwgQVJSQVlf
U0laRShwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmUpOyBpKyspIHsKLQkJcGxhbmVfc3RhdGUtPmNv
bG9yX3BsYW5lW2ldLm9mZnNldCA9IDA7Ci0JCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtpXS54
ID0gMDsKLQkJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2ldLnkgPSAwOwotCX0KLQotCXJldCA9
IHNrbF9jaGVja19tYWluX3N1cmZhY2UocGxhbmVfc3RhdGUpOwotCWlmIChyZXQpCi0JCXJldHVy
biByZXQ7Ci0KLQlyZXR1cm4gMDsKLX0KLQogc3RhdGljIHZvaWQgc2tsX2RldGFjaF9zY2FsZXIo
c3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMsIGludCBpZCkKIHsKIAlzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2ID0gaW50ZWxfY3J0Yy0+YmFzZS5kZXY7CkBAIC0zMjMzLDMwNSArMjc2MSwyNCBA
QCBzdGF0aWMgdm9pZCBza2xfZGV0YWNoX3NjYWxlcnMoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUpCiAJfQogfQogCi1zdGF0aWMgdW5zaWduZWQgaW50IHNrbF9wbGFu
ZV9zdHJpZGVfbXVsdChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKLQkJCQkJICBp
bnQgY29sb3JfcGxhbmUsIHVuc2lnbmVkIGludCByb3RhdGlvbikKLXsKLQkvKgotCSAqIFRoZSBz
dHJpZGUgaXMgZWl0aGVyIGV4cHJlc3NlZCBhcyBhIG11bHRpcGxlIG9mIDY0IGJ5dGVzIGNodW5r
cyBmb3IKLQkgKiBsaW5lYXIgYnVmZmVycyBvciBpbiBudW1iZXIgb2YgdGlsZXMgZm9yIHRpbGVk
IGJ1ZmZlcnMuCi0JICovCi0JaWYgKGlzX3N1cmZhY2VfbGluZWFyKGZiLCBjb2xvcl9wbGFuZSkp
Ci0JCXJldHVybiA2NDsKLQllbHNlIGlmIChkcm1fcm90YXRpb25fOTBfb3JfMjcwKHJvdGF0aW9u
KSkKLQkJcmV0dXJuIGludGVsX3RpbGVfaGVpZ2h0KGZiLCBjb2xvcl9wbGFuZSk7Ci0JZWxzZQot
CQlyZXR1cm4gaW50ZWxfdGlsZV93aWR0aF9ieXRlcyhmYiwgY29sb3JfcGxhbmUpOwotfQotCi11
MzIgc2tsX3BsYW5lX3N0cmlkZShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5l
X3N0YXRlLAotCQkgICAgIGludCBjb2xvcl9wbGFuZSkKLXsKLQljb25zdCBzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKLQl1bnNpZ25lZCBpbnQgcm90YXRp
b24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247Ci0JdTMyIHN0cmlkZSA9IHBsYW5lX3N0YXRl
LT5jb2xvcl9wbGFuZVtjb2xvcl9wbGFuZV0uc3RyaWRlOwotCi0JaWYgKGNvbG9yX3BsYW5lID49
IGZiLT5mb3JtYXQtPm51bV9wbGFuZXMpCi0JCXJldHVybiAwOwotCi0JcmV0dXJuIHN0cmlkZSAv
IHNrbF9wbGFuZV9zdHJpZGVfbXVsdChmYiwgY29sb3JfcGxhbmUsIHJvdGF0aW9uKTsKLX0KLQot
c3RhdGljIHUzMiBza2xfcGxhbmVfY3RsX2Zvcm1hdCh1MzIgcGl4ZWxfZm9ybWF0KQotewotCXN3
aXRjaCAocGl4ZWxfZm9ybWF0KSB7Ci0JY2FzZSBEUk1fRk9STUFUX0M4OgotCQlyZXR1cm4gUExB
TkVfQ1RMX0ZPUk1BVF9JTkRFWEVEOwotCWNhc2UgRFJNX0ZPUk1BVF9SR0I1NjU6Ci0JCXJldHVy
biBQTEFORV9DVExfRk9STUFUX1JHQl81NjU7Ci0JY2FzZSBEUk1fRk9STUFUX1hCR1I4ODg4Ogot
CWNhc2UgRFJNX0ZPUk1BVF9BQkdSODg4ODoKLQkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWFJH
Ql84ODg4IHwgUExBTkVfQ1RMX09SREVSX1JHQlg7Ci0JY2FzZSBEUk1fRk9STUFUX1hSR0I4ODg4
OgotCWNhc2UgRFJNX0ZPUk1BVF9BUkdCODg4ODoKLQkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRf
WFJHQl84ODg4OwotCWNhc2UgRFJNX0ZPUk1BVF9YQkdSMjEwMTAxMDoKLQljYXNlIERSTV9GT1JN
QVRfQUJHUjIxMDEwMTA6Ci0JCXJldHVybiBQTEFORV9DVExfRk9STUFUX1hSR0JfMjEwMTAxMCB8
IFBMQU5FX0NUTF9PUkRFUl9SR0JYOwotCWNhc2UgRFJNX0ZPUk1BVF9YUkdCMjEwMTAxMDoKLQlj
YXNlIERSTV9GT1JNQVRfQVJHQjIxMDEwMTA6Ci0JCXJldHVybiBQTEFORV9DVExfRk9STUFUX1hS
R0JfMjEwMTAxMDsKLQljYXNlIERSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RjoKLQljYXNlIERSTV9G
T1JNQVRfQUJHUjE2MTYxNjE2RjoKLQkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWFJHQl8xNjE2
MTYxNkYgfCBQTEFORV9DVExfT1JERVJfUkdCWDsKLQljYXNlIERSTV9GT1JNQVRfWFJHQjE2MTYx
NjE2RjoKLQljYXNlIERSTV9GT1JNQVRfQVJHQjE2MTYxNjE2RjoKLQkJcmV0dXJuIFBMQU5FX0NU
TF9GT1JNQVRfWFJHQl8xNjE2MTYxNkY7Ci0JY2FzZSBEUk1fRk9STUFUX1hZVVY4ODg4OgotCQly
ZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9YWVVWOwotCWNhc2UgRFJNX0ZPUk1BVF9ZVVlWOgotCQly
ZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9ZVVY0MjIgfCBQTEFORV9DVExfWVVWNDIyX1lVWVY7Ci0J
Y2FzZSBEUk1fRk9STUFUX1lWWVU6Ci0JCXJldHVybiBQTEFORV9DVExfRk9STUFUX1lVVjQyMiB8
IFBMQU5FX0NUTF9ZVVY0MjJfWVZZVTsKLQljYXNlIERSTV9GT1JNQVRfVVlWWToKLQkJcmV0dXJu
IFBMQU5FX0NUTF9GT1JNQVRfWVVWNDIyIHwgUExBTkVfQ1RMX1lVVjQyMl9VWVZZOwotCWNhc2Ug
RFJNX0ZPUk1BVF9WWVVZOgotCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9ZVVY0MjIgfCBQTEFO
RV9DVExfWVVWNDIyX1ZZVVk7Ci0JY2FzZSBEUk1fRk9STUFUX05WMTI6Ci0JCXJldHVybiBQTEFO
RV9DVExfRk9STUFUX05WMTI7Ci0JY2FzZSBEUk1fRk9STUFUX1AwMTA6Ci0JCXJldHVybiBQTEFO
RV9DVExfRk9STUFUX1AwMTA7Ci0JY2FzZSBEUk1fRk9STUFUX1AwMTI6Ci0JCXJldHVybiBQTEFO
RV9DVExfRk9STUFUX1AwMTI7Ci0JY2FzZSBEUk1fRk9STUFUX1AwMTY6Ci0JCXJldHVybiBQTEFO
RV9DVExfRk9STUFUX1AwMTY7Ci0JY2FzZSBEUk1fRk9STUFUX1kyMTA6Ci0JCXJldHVybiBQTEFO
RV9DVExfRk9STUFUX1kyMTA7Ci0JY2FzZSBEUk1fRk9STUFUX1kyMTI6Ci0JCXJldHVybiBQTEFO
RV9DVExfRk9STUFUX1kyMTI7Ci0JY2FzZSBEUk1fRk9STUFUX1kyMTY6Ci0JCXJldHVybiBQTEFO
RV9DVExfRk9STUFUX1kyMTY7Ci0JY2FzZSBEUk1fRk9STUFUX1hWWVUyMTAxMDEwOgotCQlyZXR1
cm4gUExBTkVfQ1RMX0ZPUk1BVF9ZNDEwOwotCWNhc2UgRFJNX0ZPUk1BVF9YVllVMTJfMTYxNjE2
MTY6Ci0JCXJldHVybiBQTEFORV9DVExfRk9STUFUX1k0MTI7Ci0JY2FzZSBEUk1fRk9STUFUX1hW
WVUxNjE2MTYxNjoKLQkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWTQxNjsKLQlkZWZhdWx0Ogot
CQlNSVNTSU5HX0NBU0UocGl4ZWxfZm9ybWF0KTsKLQl9Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3Rh
dGljIHUzMiBza2xfcGxhbmVfY3RsX2FscGhhKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0
ZSAqcGxhbmVfc3RhdGUpCi17Ci0JaWYgKCFwbGFuZV9zdGF0ZS0+aHcuZmItPmZvcm1hdC0+aGFz
X2FscGhhKQotCQlyZXR1cm4gUExBTkVfQ1RMX0FMUEhBX0RJU0FCTEU7Ci0KLQlzd2l0Y2ggKHBs
YW5lX3N0YXRlLT5ody5waXhlbF9ibGVuZF9tb2RlKSB7Ci0JY2FzZSBEUk1fTU9ERV9CTEVORF9Q
SVhFTF9OT05FOgotCQlyZXR1cm4gUExBTkVfQ1RMX0FMUEhBX0RJU0FCTEU7Ci0JY2FzZSBEUk1f
TU9ERV9CTEVORF9QUkVNVUxUSToKLQkJcmV0dXJuIFBMQU5FX0NUTF9BTFBIQV9TV19QUkVNVUxU
SVBMWTsKLQljYXNlIERSTV9NT0RFX0JMRU5EX0NPVkVSQUdFOgotCQlyZXR1cm4gUExBTkVfQ1RM
X0FMUEhBX0hXX1BSRU1VTFRJUExZOwotCWRlZmF1bHQ6Ci0JCU1JU1NJTkdfQ0FTRShwbGFuZV9z
dGF0ZS0+aHcucGl4ZWxfYmxlbmRfbW9kZSk7Ci0JCXJldHVybiBQTEFORV9DVExfQUxQSEFfRElT
QUJMRTsKLQl9Ci19Ci0KLXN0YXRpYyB1MzIgZ2xrX3BsYW5lX2NvbG9yX2N0bF9hbHBoYShjb25z
dCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQotewotCWlmICghcGxhbmVf
c3RhdGUtPmh3LmZiLT5mb3JtYXQtPmhhc19hbHBoYSkKLQkJcmV0dXJuIFBMQU5FX0NPTE9SX0FM
UEhBX0RJU0FCTEU7Ci0KLQlzd2l0Y2ggKHBsYW5lX3N0YXRlLT5ody5waXhlbF9ibGVuZF9tb2Rl
KSB7Ci0JY2FzZSBEUk1fTU9ERV9CTEVORF9QSVhFTF9OT05FOgotCQlyZXR1cm4gUExBTkVfQ09M
T1JfQUxQSEFfRElTQUJMRTsKLQljYXNlIERSTV9NT0RFX0JMRU5EX1BSRU1VTFRJOgotCQlyZXR1
cm4gUExBTkVfQ09MT1JfQUxQSEFfU1dfUFJFTVVMVElQTFk7Ci0JY2FzZSBEUk1fTU9ERV9CTEVO
RF9DT1ZFUkFHRToKLQkJcmV0dXJuIFBMQU5FX0NPTE9SX0FMUEhBX0hXX1BSRU1VTFRJUExZOwot
CWRlZmF1bHQ6Ci0JCU1JU1NJTkdfQ0FTRShwbGFuZV9zdGF0ZS0+aHcucGl4ZWxfYmxlbmRfbW9k
ZSk7Ci0JCXJldHVybiBQTEFORV9DT0xPUl9BTFBIQV9ESVNBQkxFOwotCX0KLX0KLQotc3RhdGlj
IHUzMiBza2xfcGxhbmVfY3RsX3RpbGluZyh1NjQgZmJfbW9kaWZpZXIpCi17Ci0Jc3dpdGNoIChm
Yl9tb2RpZmllcikgewotCWNhc2UgRFJNX0ZPUk1BVF9NT0RfTElORUFSOgotCQlicmVhazsKLQlj
YXNlIEk5MTVfRk9STUFUX01PRF9YX1RJTEVEOgotCQlyZXR1cm4gUExBTkVfQ1RMX1RJTEVEX1g7
Ci0JY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRDoKLQkJcmV0dXJuIFBMQU5FX0NUTF9USUxF
RF9ZOwotCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfQ0NTOgotCQlyZXR1cm4gUExBTkVf
Q1RMX1RJTEVEX1kgfCBQTEFORV9DVExfUkVOREVSX0RFQ09NUFJFU1NJT05fRU5BQkxFOwotCWNh
c2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTOgotCQlyZXR1cm4gUExBTkVf
Q1RMX1RJTEVEX1kgfAotCQkgICAgICAgUExBTkVfQ1RMX1JFTkRFUl9ERUNPTVBSRVNTSU9OX0VO
QUJMRSB8Ci0JCSAgICAgICBQTEFORV9DVExfQ0xFQVJfQ09MT1JfRElTQUJMRTsKLQljYXNlIEk5
MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX01DX0NDUzoKLQkJcmV0dXJuIFBMQU5FX0NUTF9U
SUxFRF9ZIHwgUExBTkVfQ1RMX01FRElBX0RFQ09NUFJFU1NJT05fRU5BQkxFOwotCWNhc2UgSTkx
NV9GT1JNQVRfTU9EX1lmX1RJTEVEOgotCQlyZXR1cm4gUExBTkVfQ1RMX1RJTEVEX1lGOwotCWNh
c2UgSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEX0NDUzoKLQkJcmV0dXJuIFBMQU5FX0NUTF9USUxF
RF9ZRiB8IFBMQU5FX0NUTF9SRU5ERVJfREVDT01QUkVTU0lPTl9FTkFCTEU7Ci0JZGVmYXVsdDoK
LQkJTUlTU0lOR19DQVNFKGZiX21vZGlmaWVyKTsKLQl9Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3Rh
dGljIHUzMiBza2xfcGxhbmVfY3RsX3JvdGF0ZSh1bnNpZ25lZCBpbnQgcm90YXRlKQotewotCXN3
aXRjaCAocm90YXRlKSB7Ci0JY2FzZSBEUk1fTU9ERV9ST1RBVEVfMDoKLQkJYnJlYWs7Ci0JLyoK
LQkgKiBEUk1fTU9ERV9ST1RBVEVfIGlzIGNvdW50ZXIgY2xvY2t3aXNlIHRvIHN0YXkgY29tcGF0
aWJsZSB3aXRoIFhyYW5kcgotCSAqIHdoaWxlIGk5MTUgSFcgcm90YXRpb24gaXMgY2xvY2t3aXNl
LCB0aGF0cyB3aHkgdGhpcyBzd2FwcGluZy4KLQkgKi8KLQljYXNlIERSTV9NT0RFX1JPVEFURV85
MDoKLQkJcmV0dXJuIFBMQU5FX0NUTF9ST1RBVEVfMjcwOwotCWNhc2UgRFJNX01PREVfUk9UQVRF
XzE4MDoKLQkJcmV0dXJuIFBMQU5FX0NUTF9ST1RBVEVfMTgwOwotCWNhc2UgRFJNX01PREVfUk9U
QVRFXzI3MDoKLQkJcmV0dXJuIFBMQU5FX0NUTF9ST1RBVEVfOTA7Ci0JZGVmYXVsdDoKLQkJTUlT
U0lOR19DQVNFKHJvdGF0ZSk7Ci0JfQotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyB1MzIgY25s
X3BsYW5lX2N0bF9mbGlwKHVuc2lnbmVkIGludCByZWZsZWN0KQotewotCXN3aXRjaCAocmVmbGVj
dCkgewotCWNhc2UgMDoKLQkJYnJlYWs7Ci0JY2FzZSBEUk1fTU9ERV9SRUZMRUNUX1g6Ci0JCXJl
dHVybiBQTEFORV9DVExfRkxJUF9IT1JJWk9OVEFMOwotCWNhc2UgRFJNX01PREVfUkVGTEVDVF9Z
OgotCWRlZmF1bHQ6Ci0JCU1JU1NJTkdfQ0FTRShyZWZsZWN0KTsKLQl9Ci0KLQlyZXR1cm4gMDsK
LX0KLQotdTMyIHNrbF9wbGFuZV9jdGxfY3J0Yyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKLQl1MzIgcGxhbmVfY3RsID0gMDsK
LQotCWlmIChjcnRjX3N0YXRlLT51YXBpLmFzeW5jX2ZsaXApCi0JCXBsYW5lX2N0bCB8PSBQTEFO
RV9DVExfQVNZTkNfRkxJUDsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8IElT
X0dFTUlOSUxBS0UoZGV2X3ByaXYpKQotCQlyZXR1cm4gcGxhbmVfY3RsOwotCi0JaWYgKGNydGNf
c3RhdGUtPmdhbW1hX2VuYWJsZSkKLQkJcGxhbmVfY3RsIHw9IFBMQU5FX0NUTF9QSVBFX0dBTU1B
X0VOQUJMRTsKLQotCWlmIChjcnRjX3N0YXRlLT5jc2NfZW5hYmxlKQotCQlwbGFuZV9jdGwgfD0g
UExBTkVfQ1RMX1BJUEVfQ1NDX0VOQUJMRTsKLQotCXJldHVybiBwbGFuZV9jdGw7Ci19Ci0KLXUz
MiBza2xfcGxhbmVfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LAotCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCi17Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KLQkJdG9faTkxNShwbGFuZV9zdGF0
ZS0+dWFwaS5wbGFuZS0+ZGV2KTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9
IHBsYW5lX3N0YXRlLT5ody5mYjsKLQl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0
ZS0+aHcucm90YXRpb247Ci0JY29uc3Qgc3RydWN0IGRybV9pbnRlbF9zcHJpdGVfY29sb3JrZXkg
KmtleSA9ICZwbGFuZV9zdGF0ZS0+Y2tleTsKLQl1MzIgcGxhbmVfY3RsOwotCi0JcGxhbmVfY3Rs
ID0gUExBTkVfQ1RMX0VOQUJMRTsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTAgJiYg
IUlTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKSB7Ci0JCXBsYW5lX2N0bCB8PSBza2xfcGxhbmVfY3Rs
X2FscGhhKHBsYW5lX3N0YXRlKTsKLQkJcGxhbmVfY3RsIHw9IFBMQU5FX0NUTF9QTEFORV9HQU1N
QV9ESVNBQkxFOwotCi0JCWlmIChwbGFuZV9zdGF0ZS0+aHcuY29sb3JfZW5jb2RpbmcgPT0gRFJN
X0NPTE9SX1lDQkNSX0JUNzA5KQotCQkJcGxhbmVfY3RsIHw9IFBMQU5FX0NUTF9ZVVZfVE9fUkdC
X0NTQ19GT1JNQVRfQlQ3MDk7Ci0KLQkJaWYgKHBsYW5lX3N0YXRlLT5ody5jb2xvcl9yYW5nZSA9
PSBEUk1fQ09MT1JfWUNCQ1JfRlVMTF9SQU5HRSkKLQkJCXBsYW5lX2N0bCB8PSBQTEFORV9DVExf
WVVWX1JBTkdFX0NPUlJFQ1RJT05fRElTQUJMRTsKLQl9Ci0KLQlwbGFuZV9jdGwgfD0gc2tsX3Bs
YW5lX2N0bF9mb3JtYXQoZmItPmZvcm1hdC0+Zm9ybWF0KTsKLQlwbGFuZV9jdGwgfD0gc2tsX3Bs
YW5lX2N0bF90aWxpbmcoZmItPm1vZGlmaWVyKTsKLQlwbGFuZV9jdGwgfD0gc2tsX3BsYW5lX2N0
bF9yb3RhdGUocm90YXRpb24gJiBEUk1fTU9ERV9ST1RBVEVfTUFTSyk7Ci0KLQlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSAxMCkKLQkJcGxhbmVfY3RsIHw9IGNubF9wbGFuZV9jdGxfZmxpcChy
b3RhdGlvbiAmCi0JCQkJCQlEUk1fTU9ERV9SRUZMRUNUX01BU0spOwotCi0JaWYgKGtleS0+Zmxh
Z3MgJiBJOTE1X1NFVF9DT0xPUktFWV9ERVNUSU5BVElPTikKLQkJcGxhbmVfY3RsIHw9IFBMQU5F
X0NUTF9LRVlfRU5BQkxFX0RFU1RJTkFUSU9OOwotCWVsc2UgaWYgKGtleS0+ZmxhZ3MgJiBJOTE1
X1NFVF9DT0xPUktFWV9TT1VSQ0UpCi0JCXBsYW5lX2N0bCB8PSBQTEFORV9DVExfS0VZX0VOQUJM
RV9TT1VSQ0U7Ci0KLQlyZXR1cm4gcGxhbmVfY3RsOwotfQotCi11MzIgZ2xrX3BsYW5lX2NvbG9y
X2N0bF9jcnRjKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQordm9p
ZCBza2xfc2NhbGVyX2Rpc2FibGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9j
cnRjX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXYpOwotCXUzMiBwbGFuZV9jb2xvcl9jdGwgPSAw
OwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCi0JCXJldHVybiBwbGFuZV9jb2xv
cl9jdGw7Ci0KLQlpZiAoY3J0Y19zdGF0ZS0+Z2FtbWFfZW5hYmxlKQotCQlwbGFuZV9jb2xvcl9j
dGwgfD0gUExBTkVfQ09MT1JfUElQRV9HQU1NQV9FTkFCTEU7Ci0KLQlpZiAoY3J0Y19zdGF0ZS0+
Y3NjX2VuYWJsZSkKLQkJcGxhbmVfY29sb3JfY3RsIHw9IFBMQU5FX0NPTE9SX1BJUEVfQ1NDX0VO
QUJMRTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMob2xkX2NydGNf
c3RhdGUtPnVhcGkuY3J0Yyk7CisJaW50IGk7CiAKLQlyZXR1cm4gcGxhbmVfY29sb3JfY3RsOwor
CWZvciAoaSA9IDA7IGkgPCBjcnRjLT5udW1fc2NhbGVyczsgaSsrKQorCQlza2xfZGV0YWNoX3Nj
YWxlcihjcnRjLCBpKTsKIH0KIAotdTMyIGdsa19wbGFuZV9jb2xvcl9jdGwoY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCQljb25zdCBzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGUgKnBsYW5lX3N0YXRlKQordW5zaWduZWQgaW50CitpbnRlbF9wbGFuZV9mZW5jZV95
X29mZnNldChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9Ci0JCXRvX2k5MTUocGxhbmVfc3Rh
dGUtPnVhcGkucGxhbmUtPmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIg
PSBwbGFuZV9zdGF0ZS0+aHcuZmI7Ci0Jc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2lu
dGVsX3BsYW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKLQl1MzIgcGxhbmVfY29sb3JfY3Rs
ID0gMDsKLQotCXBsYW5lX2NvbG9yX2N0bCB8PSBQTEFORV9DT0xPUl9QTEFORV9HQU1NQV9ESVNB
QkxFOwotCXBsYW5lX2NvbG9yX2N0bCB8PSBnbGtfcGxhbmVfY29sb3JfY3RsX2FscGhhKHBsYW5l
X3N0YXRlKTsKKwlpbnQgeCA9IDAsIHkgPSAwOwogCi0JaWYgKGZiLT5mb3JtYXQtPmlzX3l1diAm
JiAhaWNsX2lzX2hkcl9wbGFuZShkZXZfcHJpdiwgcGxhbmUtPmlkKSkgewotCQlzd2l0Y2ggKHBs
YW5lX3N0YXRlLT5ody5jb2xvcl9lbmNvZGluZykgewotCQljYXNlIERSTV9DT0xPUl9ZQ0JDUl9C
VDcwOToKLQkJCXBsYW5lX2NvbG9yX2N0bCB8PSBQTEFORV9DT0xPUl9DU0NfTU9ERV9ZVVY3MDlf
VE9fUkdCNzA5OwotCQkJYnJlYWs7Ci0JCWNhc2UgRFJNX0NPTE9SX1lDQkNSX0JUMjAyMDoKLQkJ
CXBsYW5lX2NvbG9yX2N0bCB8PQotCQkJCVBMQU5FX0NPTE9SX0NTQ19NT0RFX1lVVjIwMjBfVE9f
UkdCMjAyMDsKLQkJCWJyZWFrOwotCQlkZWZhdWx0OgotCQkJcGxhbmVfY29sb3JfY3RsIHw9Ci0J
CQkJUExBTkVfQ09MT1JfQ1NDX01PREVfWVVWNjAxX1RPX1JHQjYwMTsKLQkJfQotCQlpZiAocGxh
bmVfc3RhdGUtPmh3LmNvbG9yX3JhbmdlID09IERSTV9DT0xPUl9ZQ0JDUl9GVUxMX1JBTkdFKQot
CQkJcGxhbmVfY29sb3JfY3RsIHw9IFBMQU5FX0NPTE9SX1lVVl9SQU5HRV9DT1JSRUNUSU9OX0RJ
U0FCTEU7Ci0JfSBlbHNlIGlmIChmYi0+Zm9ybWF0LT5pc195dXYpIHsKLQkJcGxhbmVfY29sb3Jf
Y3RsIHw9IFBMQU5FX0NPTE9SX0lOUFVUX0NTQ19FTkFCTEU7Ci0JfQorCWludGVsX3BsYW5lX2Fk
anVzdF9hbGlnbmVkX29mZnNldCgmeCwgJnksIHBsYW5lX3N0YXRlLCAwLAorCQkJCQkgIHBsYW5l
X3N0YXRlLT5jb2xvcl9wbGFuZVswXS5vZmZzZXQsIDApOwogCi0JcmV0dXJuIHBsYW5lX2NvbG9y
X2N0bDsKKwlyZXR1cm4geTsKIH0KIAogc3RhdGljIGludApAQCAtNDM4NiwxNSArMzYzMyw2IEBA
IHN0YXRpYyBpbnQgc2tsX3VwZGF0ZV9zY2FsZXJfcGxhbmUoc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUsCiAJcmV0dXJuIDA7CiB9CiAKLXZvaWQgc2tsX3NjYWxlcl9kaXNhYmxl
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSkKLXsKLQlzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMob2xkX2NydGNfc3RhdGUtPnVhcGku
Y3J0Yyk7Ci0JaW50IGk7Ci0KLQlmb3IgKGkgPSAwOyBpIDwgY3J0Yy0+bnVtX3NjYWxlcnM7IGkr
KykKLQkJc2tsX2RldGFjaF9zY2FsZXIoY3J0YywgaSk7Ci19Ci0KIHN0YXRpYyBpbnQgY25sX2Nv
ZWZfdGFwKGludCBpKQogewogCXJldHVybiBpICUgNzsKQEAgLTgyMDAsMTUwICs3NDM4LDYgQEAg
c3RhdGljIHZvaWQgc2tsX2dldF9wZml0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSkKIAkJc2NhbGVyX3N0YXRlLT5zY2FsZXJfdXNlcnMgJj0gfigxIDw8IFNLTF9D
UlRDX0lOREVYKTsKIH0KIAotc3RhdGljIHZvaWQKLXNrbF9nZXRfaW5pdGlhbF9wbGFuZV9jb25m
aWcoc3RydWN0IGludGVsX2NydGMgKmNydGMsCi0JCQkgICAgIHN0cnVjdCBpbnRlbF9pbml0aWFs
X3BsYW5lX2NvbmZpZyAqcGxhbmVfY29uZmlnKQotewotCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlID0gdG9faW50ZWxfY3J0Y19zdGF0ZShjcnRjLT5iYXNlLnN0YXRlKTsKLQlz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0Yy0+YmFzZS5kZXY7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwotCXN0cnVjdCBpbnRlbF9wbGFuZSAq
cGxhbmUgPSB0b19pbnRlbF9wbGFuZShjcnRjLT5iYXNlLnByaW1hcnkpOwotCWVudW0gcGxhbmVf
aWQgcGxhbmVfaWQgPSBwbGFuZS0+aWQ7Ci0JZW51bSBwaXBlIHBpcGU7Ci0JdTMyIHZhbCwgYmFz
ZSwgb2Zmc2V0LCBzdHJpZGVfbXVsdCwgdGlsaW5nLCBhbHBoYTsKLQlpbnQgZm91cmNjLCBwaXhl
bF9mb3JtYXQ7Ci0JdW5zaWduZWQgaW50IGFsaWduZWRfaGVpZ2h0OwotCXN0cnVjdCBkcm1fZnJh
bWVidWZmZXIgKmZiOwotCXN0cnVjdCBpbnRlbF9mcmFtZWJ1ZmZlciAqaW50ZWxfZmI7Ci0KLQlp
ZiAoIXBsYW5lLT5nZXRfaHdfc3RhdGUocGxhbmUsICZwaXBlKSkKLQkJcmV0dXJuOwotCi0JZHJt
X1dBUk5fT04oZGV2LCBwaXBlICE9IGNydGMtPnBpcGUpOwotCi0JaWYgKGNydGNfc3RhdGUtPmJp
Z2pvaW5lcikgewotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKLQkJCSAgICAiVW5zdXBw
b3J0ZWQgYmlnam9pbmVyIGNvbmZpZ3VyYXRpb24gZm9yIGluaXRpYWwgRkJcbiIpOwotCQlyZXR1
cm47Ci0JfQotCi0JaW50ZWxfZmIgPSBremFsbG9jKHNpemVvZigqaW50ZWxfZmIpLCBHRlBfS0VS
TkVMKTsKLQlpZiAoIWludGVsX2ZiKSB7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLCAi
ZmFpbGVkIHRvIGFsbG9jIGZiXG4iKTsKLQkJcmV0dXJuOwotCX0KLQotCWZiID0gJmludGVsX2Zi
LT5iYXNlOwotCi0JZmItPmRldiA9IGRldjsKLQotCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3By
aXYsIFBMQU5FX0NUTChwaXBlLCBwbGFuZV9pZCkpOwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJp
dikgPj0gMTEpCi0JCXBpeGVsX2Zvcm1hdCA9IHZhbCAmIElDTF9QTEFORV9DVExfRk9STUFUX01B
U0s7Ci0JZWxzZQotCQlwaXhlbF9mb3JtYXQgPSB2YWwgJiBQTEFORV9DVExfRk9STUFUX01BU0s7
Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9w
cml2KSkgewotCQlhbHBoYSA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsCi0JCQkJICAgICAgUExB
TkVfQ09MT1JfQ1RMKHBpcGUsIHBsYW5lX2lkKSk7Ci0JCWFscGhhICY9IFBMQU5FX0NPTE9SX0FM
UEhBX01BU0s7Ci0JfSBlbHNlIHsKLQkJYWxwaGEgPSB2YWwgJiBQTEFORV9DVExfQUxQSEFfTUFT
SzsKLQl9Ci0KLQlmb3VyY2MgPSBza2xfZm9ybWF0X3RvX2ZvdXJjYyhwaXhlbF9mb3JtYXQsCi0J
CQkJICAgICAgdmFsICYgUExBTkVfQ1RMX09SREVSX1JHQlgsIGFscGhhKTsKLQlmYi0+Zm9ybWF0
ID0gZHJtX2Zvcm1hdF9pbmZvKGZvdXJjYyk7Ci0KLQl0aWxpbmcgPSB2YWwgJiBQTEFORV9DVExf
VElMRURfTUFTSzsKLQlzd2l0Y2ggKHRpbGluZykgewotCWNhc2UgUExBTkVfQ1RMX1RJTEVEX0xJ
TkVBUjoKLQkJZmItPm1vZGlmaWVyID0gRFJNX0ZPUk1BVF9NT0RfTElORUFSOwotCQlicmVhazsK
LQljYXNlIFBMQU5FX0NUTF9USUxFRF9YOgotCQlwbGFuZV9jb25maWctPnRpbGluZyA9IEk5MTVf
VElMSU5HX1g7Ci0JCWZiLT5tb2RpZmllciA9IEk5MTVfRk9STUFUX01PRF9YX1RJTEVEOwotCQli
cmVhazsKLQljYXNlIFBMQU5FX0NUTF9USUxFRF9ZOgotCQlwbGFuZV9jb25maWctPnRpbGluZyA9
IEk5MTVfVElMSU5HX1k7Ci0JCWlmICh2YWwgJiBQTEFORV9DVExfUkVOREVSX0RFQ09NUFJFU1NJ
T05fRU5BQkxFKQotCQkJZmItPm1vZGlmaWVyID0gSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMiA/
Ci0JCQkJSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTIDoKLQkJCQlJOTE1X0ZP
Uk1BVF9NT0RfWV9USUxFRF9DQ1M7Ci0JCWVsc2UgaWYgKHZhbCAmIFBMQU5FX0NUTF9NRURJQV9E
RUNPTVBSRVNTSU9OX0VOQUJMRSkKLQkJCWZiLT5tb2RpZmllciA9IEk5MTVfRk9STUFUX01PRF9Z
X1RJTEVEX0dFTjEyX01DX0NDUzsKLQkJZWxzZQotCQkJZmItPm1vZGlmaWVyID0gSTkxNV9GT1JN
QVRfTU9EX1lfVElMRUQ7Ci0JCWJyZWFrOwotCWNhc2UgUExBTkVfQ1RMX1RJTEVEX1lGOgotCQlp
ZiAodmFsICYgUExBTkVfQ1RMX1JFTkRFUl9ERUNPTVBSRVNTSU9OX0VOQUJMRSkKLQkJCWZiLT5t
b2RpZmllciA9IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRF9DQ1M7Ci0JCWVsc2UKLQkJCWZiLT5t
b2RpZmllciA9IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRDsKLQkJYnJlYWs7Ci0JZGVmYXVsdDoK
LQkJTUlTU0lOR19DQVNFKHRpbGluZyk7Ci0JCWdvdG8gZXJyb3I7Ci0JfQotCi0JLyoKLQkgKiBE
Uk1fTU9ERV9ST1RBVEVfIGlzIGNvdW50ZXIgY2xvY2t3aXNlIHRvIHN0YXkgY29tcGF0aWJsZSB3
aXRoIFhyYW5kcgotCSAqIHdoaWxlIGk5MTUgSFcgcm90YXRpb24gaXMgY2xvY2t3aXNlLCB0aGF0
cyB3aHkgdGhpcyBzd2FwcGluZy4KLQkgKi8KLQlzd2l0Y2ggKHZhbCAmIFBMQU5FX0NUTF9ST1RB
VEVfTUFTSykgewotCWNhc2UgUExBTkVfQ1RMX1JPVEFURV8wOgotCQlwbGFuZV9jb25maWctPnJv
dGF0aW9uID0gRFJNX01PREVfUk9UQVRFXzA7Ci0JCWJyZWFrOwotCWNhc2UgUExBTkVfQ1RMX1JP
VEFURV85MDoKLQkJcGxhbmVfY29uZmlnLT5yb3RhdGlvbiA9IERSTV9NT0RFX1JPVEFURV8yNzA7
Ci0JCWJyZWFrOwotCWNhc2UgUExBTkVfQ1RMX1JPVEFURV8xODA6Ci0JCXBsYW5lX2NvbmZpZy0+
cm90YXRpb24gPSBEUk1fTU9ERV9ST1RBVEVfMTgwOwotCQlicmVhazsKLQljYXNlIFBMQU5FX0NU
TF9ST1RBVEVfMjcwOgotCQlwbGFuZV9jb25maWctPnJvdGF0aW9uID0gRFJNX01PREVfUk9UQVRF
XzkwOwotCQlicmVhazsKLQl9Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCAmJgot
CSAgICB2YWwgJiBQTEFORV9DVExfRkxJUF9IT1JJWk9OVEFMKQotCQlwbGFuZV9jb25maWctPnJv
dGF0aW9uIHw9IERSTV9NT0RFX1JFRkxFQ1RfWDsKLQotCS8qIDkwLzI3MCBkZWdyZWUgcm90YXRp
b24gd291bGQgcmVxdWlyZSBleHRyYSB3b3JrICovCi0JaWYgKGRybV9yb3RhdGlvbl85MF9vcl8y
NzAocGxhbmVfY29uZmlnLT5yb3RhdGlvbikpCi0JCWdvdG8gZXJyb3I7Ci0KLQliYXNlID0gaW50
ZWxfZGVfcmVhZChkZXZfcHJpdiwgUExBTkVfU1VSRihwaXBlLCBwbGFuZV9pZCkpICYgMHhmZmZm
ZjAwMDsKLQlwbGFuZV9jb25maWctPmJhc2UgPSBiYXNlOwotCi0Jb2Zmc2V0ID0gaW50ZWxfZGVf
cmVhZChkZXZfcHJpdiwgUExBTkVfT0ZGU0VUKHBpcGUsIHBsYW5lX2lkKSk7Ci0KLQl2YWwgPSBp
bnRlbF9kZV9yZWFkKGRldl9wcml2LCBQTEFORV9TSVpFKHBpcGUsIHBsYW5lX2lkKSk7Ci0JZmIt
PmhlaWdodCA9ICgodmFsID4+IDE2KSAmIDB4ZmZmZikgKyAxOwotCWZiLT53aWR0aCA9ICgodmFs
ID4+IDApICYgMHhmZmZmKSArIDE7Ci0KLQl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBQ
TEFORV9TVFJJREUocGlwZSwgcGxhbmVfaWQpKTsKLQlzdHJpZGVfbXVsdCA9IHNrbF9wbGFuZV9z
dHJpZGVfbXVsdChmYiwgMCwgRFJNX01PREVfUk9UQVRFXzApOwotCWZiLT5waXRjaGVzWzBdID0g
KHZhbCAmIDB4M2ZmKSAqIHN0cmlkZV9tdWx0OwotCi0JYWxpZ25lZF9oZWlnaHQgPSBpbnRlbF9m
Yl9hbGlnbl9oZWlnaHQoZmIsIDAsIGZiLT5oZWlnaHQpOwotCi0JcGxhbmVfY29uZmlnLT5zaXpl
ID0gZmItPnBpdGNoZXNbMF0gKiBhbGlnbmVkX2hlaWdodDsKLQotCWRybV9kYmdfa21zKCZkZXZf
cHJpdi0+ZHJtLAotCQkgICAgIiVzLyVzIHdpdGggZmI6IHNpemU9JWR4JWRAJWQsIG9mZnNldD0l
eCwgcGl0Y2ggJWQsIHNpemUgMHgleFxuIiwKLQkJICAgIGNydGMtPmJhc2UubmFtZSwgcGxhbmUt
PmJhc2UubmFtZSwgZmItPndpZHRoLCBmYi0+aGVpZ2h0LAotCQkgICAgZmItPmZvcm1hdC0+Y3Bw
WzBdICogOCwgYmFzZSwgZmItPnBpdGNoZXNbMF0sCi0JCSAgICBwbGFuZV9jb25maWctPnNpemUp
OwotCi0JcGxhbmVfY29uZmlnLT5mYiA9IGludGVsX2ZiOwotCXJldHVybjsKLQotZXJyb3I6Ci0J
a2ZyZWUoaW50ZWxfZmIpOwotfQotCiBzdGF0aWMgdm9pZCBpbGtfZ2V0X3BmaXRfY29uZmlnKHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmggYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuaAppbmRleCBiYjcyZGUxNTI5NDku
LjBiMmZlZDU4YmFkZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kaXNwbGF5LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
aXNwbGF5LmgKQEAgLTUyLDYgKzUyLDcgQEAgc3RydWN0IGludGVsX2NydGNfc3RhdGU7CiBzdHJ1
Y3QgaW50ZWxfZGlnaXRhbF9wb3J0Owogc3RydWN0IGludGVsX2RwOwogc3RydWN0IGludGVsX2Vu
Y29kZXI7CitzdHJ1Y3QgaW50ZWxfaW5pdGlhbF9wbGFuZV9jb25maWc7CiBzdHJ1Y3QgaW50ZWxf
bG9hZF9kZXRlY3RfcGlwZTsKIHN0cnVjdCBpbnRlbF9wbGFuZTsKIHN0cnVjdCBpbnRlbF9wbGFu
ZV9zdGF0ZTsKQEAgLTUwOCw3ICs1MDksNiBAQCB2b2lkIGludGVsX2xpbmtfY29tcHV0ZV9tX24o
dTE2IGJwcCwgaW50IG5sYW5lcywKIAkJCSAgICBzdHJ1Y3QgaW50ZWxfbGlua19tX24gKm1fbiwK
IAkJCSAgICBib29sIGNvbnN0YW50X24sIGJvb2wgZmVjX2VuYWJsZSk7CiBib29sIGlzX2Njc19t
b2RpZmllcih1NjQgbW9kaWZpZXIpOwotaW50IGludGVsX21haW5fdG9fYXV4X3BsYW5lKGNvbnN0
IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgbWFpbl9wbGFuZSk7CiB2b2lkIGxwdF9k
aXNhYmxlX2Nsa291dF9kcChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogdTMy
IGludGVsX3BsYW5lX2ZiX21heF9zdHJpZGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAogCQkJICAgICAgdTMyIHBpeGVsX2Zvcm1hdCwgdTY0IG1vZGlmaWVyKTsKQEAgLTYyMSwx
OCArNjIxLDcgQEAgdTMyIHNrbF9zY2FsZXJfZ2V0X2ZpbHRlcl9zZWxlY3QoZW51bSBkcm1fc2Nh
bGluZ19maWx0ZXIgZmlsdGVyLCBpbnQgc2V0KTsKIHZvaWQgc2tsX3NjYWxlcl9zZXR1cF9maWx0
ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBpcGUgcGlwZSwKIAkJ
CSAgICAgaW50IGlkLCBpbnQgc2V0LCBlbnVtIGRybV9zY2FsaW5nX2ZpbHRlciBmaWx0ZXIpOwog
dm9pZCBpbGtfcGZpdF9kaXNhYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRf
Y3J0Y19zdGF0ZSk7Ci11MzIgZ2xrX3BsYW5lX2NvbG9yX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0
ZSAqcGxhbmVfc3RhdGUpOwotdTMyIGdsa19wbGFuZV9jb2xvcl9jdGxfY3J0Yyhjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7Ci11MzIgc2tsX3BsYW5lX2N0bChjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJICBjb25zdCBzdHJ1Y3Qg
aW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKTsKLXUzMiBza2xfcGxhbmVfY3RsX2NydGMo
Y29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOwotdTMyIHNrbF9wbGFu
ZV9zdHJpZGUoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKLQkJ
ICAgICBpbnQgcGxhbmUpOwotaW50IHNrbF9jaGVja19wbGFuZV9zdXJmYWNlKHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpOwotaW50IHNrbF9jYWxjX21haW5fc3VyZmFjZV9v
ZmZzZXQoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKLQkJCQkg
aW50ICp4LCBpbnQgKnksIHUzMiAqb2Zmc2V0KTsKLWludCBza2xfZm9ybWF0X3RvX2ZvdXJjYyhp
bnQgZm9ybWF0LCBib29sIHJnYl9vcmRlciwgYm9vbCBhbHBoYSk7CisKIGludCBiZHdfZ2V0X3Bp
cGVtaXNjX2JwcChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0Yyk7CiB1bnNpZ25lZCBpbnQgaW50ZWxf
cGxhbmVfZmVuY2VfeV9vZmZzZXQoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFu
ZV9zdGF0ZSk7CiAKQEAgLTY1NSw2ICs2NDQsMTggQEAgc3RydWN0IGludGVsX2VuY29kZXIgKgog
aW50ZWxfZ2V0X2NydGNfbmV3X2VuY29kZXIoY29uc3Qgc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSAqc3RhdGUsCiAJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSk7CiAKK3Vuc2lnbmVkIGludCBpbnRlbF9zdXJmX2FsaWdubWVudChjb25zdCBzdHJ1Y3QgZHJt
X2ZyYW1lYnVmZmVyICpmYiwKKwkJCQkgIGludCBjb2xvcl9wbGFuZSk7Cit2b2lkIGludGVsX2Zi
X3BsYW5lX2dldF9zdWJzYW1wbGluZyhpbnQgKmhzdWIsIGludCAqdnN1YiwKKwkJCQkgICAgY29u
c3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCisJCQkJICAgIGludCBjb2xvcl9wbGFuZSk7
Cit1MzIgaW50ZWxfcGxhbmVfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KGludCAqeCwgaW50ICp5LAor
CQkJCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqc3RhdGUsCisJCQkJICAg
ICAgaW50IGNvbG9yX3BsYW5lLAorCQkJCSAgICAgIHUzMiBvbGRfb2Zmc2V0LCB1MzIgbmV3X29m
ZnNldCk7Cit1bnNpZ25lZCBpbnQgaW50ZWxfdGlsZV93aWR0aF9ieXRlcyhjb25zdCBzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNvbG9yX3BsYW5lKTsKK3Vuc2lnbmVkIGludCBpbnRl
bF90aWxlX2hlaWdodChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNvbG9y
X3BsYW5lKTsKKwogLyogbW9kZXNldHRpbmcgKi8KIHZvaWQgaW50ZWxfbW9kZXNldF9pbml0X2h3
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIGludCBpbnRlbF9tb2Rlc2V0X2luaXRf
bm9pcnEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaAppbmRleCA3Y2RjZjExYjI4
ZGIuLjE3OWMyNzdlNWNmNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKQEAgLTM3LDYgKzM3LDcgQEAKICNpbmNsdWRlIDxkcm0v
ZHJtX2RwX21zdF9oZWxwZXIuaD4KICNpbmNsdWRlIDxkcm0vZHJtX2VuY29kZXIuaD4KICNpbmNs
dWRlIDxkcm0vZHJtX2ZiX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZm91cmNjLmg+CiAj
aW5jbHVkZSA8ZHJtL2RybV9wcm9iZV9oZWxwZXIuaD4KICNpbmNsdWRlIDxkcm0vZHJtX3JlY3Qu
aD4KICNpbmNsdWRlIDxkcm0vZHJtX3ZibGFuay5oPgpAQCAtMTg2MSw0ICsxODYyLDI0IEBAIHN0
YXRpYyBpbmxpbmUgdTMyIGludGVsX2ZkaV9saW5rX2ZyZXEoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAogCQlyZXR1cm4gZGV2X3ByaXYtPmZkaV9wbGxfZnJlcTsKIH0KIAorc3Rh
dGljIGlubGluZSBib29sIGlzX2Njc19wbGFuZShjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVy
ICpmYiwgaW50IHBsYW5lKQoreworCWlmICghaXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikp
CisJCXJldHVybiBmYWxzZTsKKworCXJldHVybiBwbGFuZSA+PSBmYi0+Zm9ybWF0LT5udW1fcGxh
bmVzIC8gMjsKK30KKworc3RhdGljIGlubGluZSBib29sIGlzX2dlbjEyX2Njc19tb2RpZmllcih1
NjQgbW9kaWZpZXIpCit7CisJcmV0dXJuIG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJ
TEVEX0dFTjEyX1JDX0NDUyB8fAorCSAgICAgICBtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0Rf
WV9USUxFRF9HRU4xMl9NQ19DQ1M7CisKK30KKworc3RhdGljIGlubGluZSBib29sIGlzX2dlbjEy
X2Njc19wbGFuZShjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IHBsYW5lKQor
eworCXJldHVybiBpc19nZW4xMl9jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSAmJiBpc19jY3Nf
cGxhbmUoZmIsIHBsYW5lKTsKK30KKwogI2VuZGlmIC8qICBfX0lOVEVMX0RJU1BMQVlfVFlQRVNf
SF9fICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rw
X21zdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9tc3QuYwppbmRl
eCBmNzZlMmMyYTgzYjguLjhlNGI2NjQ3NzUyZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kcF9tc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2RwX21zdC5jCkBAIC0zOSw2ICszOSw3IEBACiAjaW5jbHVkZSAiaW50ZWxf
ZHBfbXN0LmgiCiAjaW5jbHVkZSAiaW50ZWxfZHBpb19waHkuaCIKICNpbmNsdWRlICJpbnRlbF9o
ZGNwLmgiCisjaW5jbHVkZSAic2tsX3VuaXZlcnNhbF9wbGFuZS5oIgogCiBzdGF0aWMgaW50IGlu
dGVsX2RwX21zdF9jb21wdXRlX2xpbmtfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyLAogCQkJCQkgICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYwppbmRleCBjMjRhZTY5NDI2Y2YuLjBk
MGIwZDNjNTJhMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9wc3IuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5jCkBA
IC0zMSw2ICszMSw3IEBACiAjaW5jbHVkZSAiaW50ZWxfcHNyLmgiCiAjaW5jbHVkZSAiaW50ZWxf
c3ByaXRlLmgiCiAjaW5jbHVkZSAiaW50ZWxfaGRtaS5oIgorI2luY2x1ZGUgInNrbF91bml2ZXJz
YWxfcGxhbmUuaCIKIAogLyoqCiAgKiBET0M6IFBhbmVsIFNlbGYgUmVmcmVzaCAoUFNSL1NSRCkK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCmluZGV4IGNmMzU4
OWZkMGRkYi4uODNlNzMzMWY3OWQ1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX3Nwcml0ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfc3ByaXRlLmMKQEAgLTM2NSwyMTIgKzM2NSw3IEBAIGludCBpbnRlbF9wbGFuZV9jaGVj
a19zcmNfY29vcmRpbmF0ZXMoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkK
IAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHU4IGljbF9udjEyX3lfcGxhbmVfbWFzayhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKLXsKLQlpZiAoSVNfUk9DS0VUTEFLRShpOTE1KSkKLQkJ
cmV0dXJuIEJJVChQTEFORV9TUFJJVEUyKSB8IEJJVChQTEFORV9TUFJJVEUzKTsKLQllbHNlCi0J
CXJldHVybiBCSVQoUExBTkVfU1BSSVRFNCkgfCBCSVQoUExBTkVfU1BSSVRFNSk7Ci19Ci0KLWJv
b2wgaWNsX2lzX252MTJfeV9wbGFuZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
Ci0JCQkgZW51bSBwbGFuZV9pZCBwbGFuZV9pZCkKLXsKLQlyZXR1cm4gSU5URUxfR0VOKGRldl9w
cml2KSA+PSAxMSAmJgotCQlpY2xfbnYxMl95X3BsYW5lX21hc2soZGV2X3ByaXYpICYgQklUKHBs
YW5lX2lkKTsKLX0KLQotYm9vbCBpY2xfaXNfaGRyX3BsYW5lKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwgZW51bSBwbGFuZV9pZCBwbGFuZV9pZCkKLXsKLQlyZXR1cm4gSU5URUxf
R0VOKGRldl9wcml2KSA+PSAxMSAmJgotCQlpY2xfaGRyX3BsYW5lX21hc2soKSAmIEJJVChwbGFu
ZV9pZCk7Ci19Ci0KLXN0YXRpYyB2b2lkCi1za2xfcGxhbmVfcmF0aW8oY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9z
dGF0ZSAqcGxhbmVfc3RhdGUsCi0JCXVuc2lnbmVkIGludCAqbnVtLCB1bnNpZ25lZCBpbnQgKmRl
bikKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5l
X3N0YXRlLT51YXBpLnBsYW5lLT5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIg
KmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwotCi0JaWYgKGZiLT5mb3JtYXQtPmNwcFswXSA9PSA4
KSB7Ci0JCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8IElTX0dFTUlOSUxBS0UoZGV2
X3ByaXYpKSB7Ci0JCQkqbnVtID0gMTA7Ci0JCQkqZGVuID0gODsKLQkJfSBlbHNlIHsKLQkJCSpu
dW0gPSA5OwotCQkJKmRlbiA9IDg7Ci0JCX0KLQl9IGVsc2UgewotCQkqbnVtID0gMTsKLQkJKmRl
biA9IDE7Ci0JfQotfQotCi1zdGF0aWMgaW50IHNrbF9wbGFuZV9taW5fY2RjbGsoY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCQkgICAgICAgY29uc3Qgc3RydWN0
IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lLT5kZXYpOwot
CXVuc2lnbmVkIGludCBudW0sIGRlbjsKLQl1bnNpZ25lZCBpbnQgcGl4ZWxfcmF0ZSA9IGludGVs
X3BsYW5lX3BpeGVsX3JhdGUoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOwotCi0Jc2tsX3BsYW5l
X3JhdGlvKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlLCAmbnVtLCAmZGVuKTsKLQotCS8qIHR3byBw
aXhlbHMgcGVyIGNsb2NrIG9uIGdsaysgKi8KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAx
MCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkKLQkJZGVuICo9IDI7Ci0KLQlyZXR1cm4gRElW
X1JPVU5EX1VQKHBpeGVsX3JhdGUgKiBudW0sIGRlbik7Ci19Ci0KLXN0YXRpYyBpbnQgc2tsX3Bs
YW5lX21heF93aWR0aChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKLQkJCSAgICAg
ICBpbnQgY29sb3JfcGxhbmUsCi0JCQkgICAgICAgdW5zaWduZWQgaW50IHJvdGF0aW9uKQotewot
CWludCBjcHAgPSBmYi0+Zm9ybWF0LT5jcHBbY29sb3JfcGxhbmVdOwotCi0Jc3dpdGNoIChmYi0+
bW9kaWZpZXIpIHsKLQljYXNlIERSTV9GT1JNQVRfTU9EX0xJTkVBUjoKLQljYXNlIEk5MTVfRk9S
TUFUX01PRF9YX1RJTEVEOgotCQkvKgotCQkgKiBWYWxpZGF0ZWQgbGltaXQgaXMgNGssIGJ1dCBo
YXMgNWsgc2hvdWxkCi0JCSAqIHdvcmsgYXBhcnQgZnJvbSB0aGUgZm9sbG93aW5nIGZlYXR1cmVz
OgotCQkgKiAtIFl0aWxlIChhbHJlYWR5IGxpbWl0ZWQgdG8gNGspCi0JCSAqIC0gRlAxNiAoYWxy
ZWFkeSBsaW1pdGVkIHRvIDRrKQotCQkgKiAtIHJlbmRlciBjb21wcmVzc2lvbiAoYWxyZWFkeSBs
aW1pdGVkIHRvIDRrKQotCQkgKiAtIEtWTVIgc3ByaXRlIGFuZCBjdXJzb3IgKGRvbid0IGNhcmUp
Ci0JCSAqIC0gaG9yaXpvbnRhbCBwYW5uaW5nIChUT0RPIHZlcmlmeSB0aGlzKQotCQkgKiAtIHBp
cGUgYW5kIHBsYW5lIHNjYWxpbmcgKFRPRE8gdmVyaWZ5IHRoaXMpCi0JCSAqLwotCQlpZiAoY3Bw
ID09IDgpCi0JCQlyZXR1cm4gNDA5NjsKLQkJZWxzZQotCQkJcmV0dXJuIDUxMjA7Ci0JY2FzZSBJ
OTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1M6Ci0JY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElM
RURfQ0NTOgotCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfTUNfQ0NTOgotCQkv
KiBGSVhNRSBBVVggcGxhbmU/ICovCi0JY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRDoKLQlj
YXNlIEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRDoKLQkJaWYgKGNwcCA9PSA4KQotCQkJcmV0dXJu
IDIwNDg7Ci0JCWVsc2UKLQkJCXJldHVybiA0MDk2OwotCWRlZmF1bHQ6Ci0JCU1JU1NJTkdfQ0FT
RShmYi0+bW9kaWZpZXIpOwotCQlyZXR1cm4gMjA0ODsKLQl9Ci19Ci0KLXN0YXRpYyBpbnQgZ2xr
X3BsYW5lX21heF93aWR0aChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKLQkJCSAg
ICAgICBpbnQgY29sb3JfcGxhbmUsCi0JCQkgICAgICAgdW5zaWduZWQgaW50IHJvdGF0aW9uKQot
ewotCWludCBjcHAgPSBmYi0+Zm9ybWF0LT5jcHBbY29sb3JfcGxhbmVdOwotCi0Jc3dpdGNoIChm
Yi0+bW9kaWZpZXIpIHsKLQljYXNlIERSTV9GT1JNQVRfTU9EX0xJTkVBUjoKLQljYXNlIEk5MTVf
Rk9STUFUX01PRF9YX1RJTEVEOgotCQlpZiAoY3BwID09IDgpCi0JCQlyZXR1cm4gNDA5NjsKLQkJ
ZWxzZQotCQkJcmV0dXJuIDUxMjA7Ci0JY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1M6
Ci0JY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRURfQ0NTOgotCQkvKiBGSVhNRSBBVVggcGxh
bmU/ICovCi0JY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRDoKLQljYXNlIEk5MTVfRk9STUFU
X01PRF9ZZl9USUxFRDoKLQkJaWYgKGNwcCA9PSA4KQotCQkJcmV0dXJuIDIwNDg7Ci0JCWVsc2UK
LQkJCXJldHVybiA1MTIwOwotCWRlZmF1bHQ6Ci0JCU1JU1NJTkdfQ0FTRShmYi0+bW9kaWZpZXIp
OwotCQlyZXR1cm4gMjA0ODsKLQl9Ci19Ci0KLXN0YXRpYyBpbnQgaWNsX3BsYW5lX21pbl93aWR0
aChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKLQkJCSAgICAgICBpbnQgY29sb3Jf
cGxhbmUsCi0JCQkgICAgICAgdW5zaWduZWQgaW50IHJvdGF0aW9uKQotewotCS8qIFdhXzE0MDEx
MjY0NjU3LCBXYV8xNDAxMTA1MDU2MzogZ2VuMTErICovCi0Jc3dpdGNoIChmYi0+Zm9ybWF0LT5m
b3JtYXQpIHsKLQljYXNlIERSTV9GT1JNQVRfQzg6Ci0JCXJldHVybiAxODsKLQljYXNlIERSTV9G
T1JNQVRfUkdCNTY1OgotCQlyZXR1cm4gMTA7Ci0JY2FzZSBEUk1fRk9STUFUX1hSR0I4ODg4Ogot
CWNhc2UgRFJNX0ZPUk1BVF9YQkdSODg4ODoKLQljYXNlIERSTV9GT1JNQVRfQVJHQjg4ODg6Ci0J
Y2FzZSBEUk1fRk9STUFUX0FCR1I4ODg4OgotCWNhc2UgRFJNX0ZPUk1BVF9YUkdCMjEwMTAxMDoK
LQljYXNlIERSTV9GT1JNQVRfWEJHUjIxMDEwMTA6Ci0JY2FzZSBEUk1fRk9STUFUX0FSR0IyMTAx
MDEwOgotCWNhc2UgRFJNX0ZPUk1BVF9BQkdSMjEwMTAxMDoKLQljYXNlIERSTV9GT1JNQVRfWFZZ
VTIxMDEwMTA6Ci0JY2FzZSBEUk1fRk9STUFUX1kyMTI6Ci0JY2FzZSBEUk1fRk9STUFUX1kyMTY6
Ci0JCXJldHVybiA2OwotCWNhc2UgRFJNX0ZPUk1BVF9OVjEyOgotCQlyZXR1cm4gMjA7Ci0JY2Fz
ZSBEUk1fRk9STUFUX1AwMTA6Ci0JY2FzZSBEUk1fRk9STUFUX1AwMTI6Ci0JY2FzZSBEUk1fRk9S
TUFUX1AwMTY6Ci0JCXJldHVybiAxMjsKLQljYXNlIERSTV9GT1JNQVRfWFJHQjE2MTYxNjE2RjoK
LQljYXNlIERSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RjoKLQljYXNlIERSTV9GT1JNQVRfQVJHQjE2
MTYxNjE2RjoKLQljYXNlIERSTV9GT1JNQVRfQUJHUjE2MTYxNjE2RjoKLQljYXNlIERSTV9GT1JN
QVRfWFZZVTEyXzE2MTYxNjE2OgotCWNhc2UgRFJNX0ZPUk1BVF9YVllVMTYxNjE2MTY6Ci0JCXJl
dHVybiA0OwotCWRlZmF1bHQ6Ci0JCXJldHVybiAxOwotCX0KLX0KLQotc3RhdGljIGludCBpY2xf
cGxhbmVfbWF4X3dpZHRoKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAotCQkJICAg
ICAgIGludCBjb2xvcl9wbGFuZSwKLQkJCSAgICAgICB1bnNpZ25lZCBpbnQgcm90YXRpb24pCi17
Ci0JcmV0dXJuIDUxMjA7Ci19Ci0KLXN0YXRpYyBpbnQgc2tsX3BsYW5lX21heF9oZWlnaHQoY29u
c3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCi0JCQkJaW50IGNvbG9yX3BsYW5lLAotCQkJ
CXVuc2lnbmVkIGludCByb3RhdGlvbikKLXsKLQlyZXR1cm4gNDA5NjsKLX0KLQotc3RhdGljIGlu
dCBpY2xfcGxhbmVfbWF4X2hlaWdodChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwK
LQkJCQlpbnQgY29sb3JfcGxhbmUsCi0JCQkJdW5zaWduZWQgaW50IHJvdGF0aW9uKQotewotCXJl
dHVybiA0MzIwOwotfQotCi1zdGF0aWMgdW5zaWduZWQgaW50Ci1za2xfcGxhbmVfbWF4X3N0cmlk
ZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAotCQkgICAgIHUzMiBwaXhlbF9mb3JtYXQsIHU2
NCBtb2RpZmllciwKLQkJICAgICB1bnNpZ25lZCBpbnQgcm90YXRpb24pCi17Ci0JY29uc3Qgc3Ry
dWN0IGRybV9mb3JtYXRfaW5mbyAqaW5mbyA9IGRybV9mb3JtYXRfaW5mbyhwaXhlbF9mb3JtYXQp
OwotCWludCBjcHAgPSBpbmZvLT5jcHBbMF07Ci0KLQkvKgotCSAqICJUaGUgc3RyaWRlIGluIGJ5
dGVzIG11c3Qgbm90IGV4Y2VlZCB0aGUKLQkgKiBvZiB0aGUgc2l6ZSBvZiA4SyBwaXhlbHMgYW5k
IDMySyBieXRlcy4iCi0JICovCi0JaWYgKGRybV9yb3RhdGlvbl85MF9vcl8yNzAocm90YXRpb24p
KQotCQlyZXR1cm4gbWluKDgxOTIsIDMyNzY4IC8gY3BwKTsKLQllbHNlCi0JCXJldHVybiBtaW4o
ODE5MiAqIGNwcCwgMzI3NjgpOwotfQotCi1zdGF0aWMgdm9pZAordm9pZAogc2tsX3Byb2dyYW1f
c2NhbGVyKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAJCSAgIGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVf
c3RhdGUgKnBsYW5lX3N0YXRlKQpAQCAtNjMyLDMzMiArNDI3LDYgQEAgc2tsX3Byb2dyYW1fc2Nh
bGVyKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAJCQkgIChjcnRjX3cgPDwgMTYpIHwgY3J0
Y19oKTsKIH0KIAotLyogUHJlb2Zmc2V0IHZhbHVlcyBmb3IgWVVWIHRvIFJHQiBDb252ZXJzaW9u
ICovCi0jZGVmaW5lIFBSRU9GRl9ZVVZfVE9fUkdCX0hJCQkweDE4MDAKLSNkZWZpbmUgUFJFT0ZG
X1lVVl9UT19SR0JfTUUJCTB4MUYwMAotI2RlZmluZSBQUkVPRkZfWVVWX1RPX1JHQl9MTwkJMHgx
ODAwCi0KLSNkZWZpbmUgIFJPRkYoeCkgICAgICAgICAgKCgoeCkgJiAweGZmZmYpIDw8IDE2KQot
I2RlZmluZSAgR09GRih4KSAgICAgICAgICAoKCh4KSAmIDB4ZmZmZikgPDwgMCkKLSNkZWZpbmUg
IEJPRkYoeCkgICAgICAgICAgKCgoeCkgJiAweGZmZmYpIDw8IDE2KQotCi1zdGF0aWMgdm9pZAot
aWNsX3Byb2dyYW1faW5wdXRfY3NjKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCi0JCSAgICAg
IGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAotCQkgICAgICBjb25z
dCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQotewotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQllbnVt
IHBpcGUgcGlwZSA9IHBsYW5lLT5waXBlOwotCWVudW0gcGxhbmVfaWQgcGxhbmVfaWQgPSBwbGFu
ZS0+aWQ7Ci0KLQlzdGF0aWMgY29uc3QgdTE2IGlucHV0X2NzY19tYXRyaXhbXVs5XSA9IHsKLQkJ
LyoKLQkJICogQlQuNjAxIGZ1bGwgcmFuZ2UgWUNiQ3IgLT4gZnVsbCByYW5nZSBSR0IKLQkJICog
VGhlIG1hdHJpeCByZXF1aXJlZCBpcyA6Ci0JCSAqIFsxLjAwMCwgMC4wMDAsIDEuMzcxLAotCQkg
KiAgMS4wMDAsIC0wLjMzNiwgLTAuNjk4LAotCQkgKiAgMS4wMDAsIDEuNzMyLCAwLjAwMDBdCi0J
CSAqLwotCQlbRFJNX0NPTE9SX1lDQkNSX0JUNjAxXSA9IHsKLQkJCTB4N0FGOCwgMHg3ODAwLCAw
eDAsCi0JCQkweDhCMjgsIDB4NzgwMCwgMHg5QUMwLAotCQkJMHgwLCAweDc4MDAsIDB4N0REOCwK
LQkJfSwKLQkJLyoKLQkJICogQlQuNzA5IGZ1bGwgcmFuZ2UgWUNiQ3IgLT4gZnVsbCByYW5nZSBS
R0IKLQkJICogVGhlIG1hdHJpeCByZXF1aXJlZCBpcyA6Ci0JCSAqIFsxLjAwMCwgMC4wMDAsIDEu
NTc0LAotCQkgKiAgMS4wMDAsIC0wLjE4NywgLTAuNDY4LAotCQkgKiAgMS4wMDAsIDEuODU1LCAw
LjAwMDBdCi0JCSAqLwotCQlbRFJNX0NPTE9SX1lDQkNSX0JUNzA5XSA9IHsKLQkJCTB4N0M5OCwg
MHg3ODAwLCAweDAsCi0JCQkweDlFRjgsIDB4NzgwMCwgMHhBQzAwLAotCQkJMHgwLCAweDc4MDAs
ICAweDdFRDgsCi0JCX0sCi0JCS8qCi0JCSAqIEJULjIwMjAgZnVsbCByYW5nZSBZQ2JDciAtPiBm
dWxsIHJhbmdlIFJHQgotCQkgKiBUaGUgbWF0cml4IHJlcXVpcmVkIGlzIDoKLQkJICogWzEuMDAw
LCAwLjAwMCwgMS40NzQsCi0JCSAqICAxLjAwMCwgLTAuMTY0NSwgLTAuNTcxMywKLQkJICogIDEu
MDAwLCAxLjg4MTQsIDAuMDAwMF0KLQkJICovCi0JCVtEUk1fQ09MT1JfWUNCQ1JfQlQyMDIwXSA9
IHsKLQkJCTB4N0JDOCwgMHg3ODAwLCAweDAsCi0JCQkweDg5MjgsIDB4NzgwMCwgMHhBQTg4LAot
CQkJMHgwLCAweDc4MDAsIDB4N0YxMCwKLQkJfSwKLQl9OwotCi0JLyogTWF0cml4IGZvciBMaW1p
dGVkIFJhbmdlIHRvIEZ1bGwgUmFuZ2UgQ29udmVyc2lvbiAqLwotCXN0YXRpYyBjb25zdCB1MTYg
aW5wdXRfY3NjX21hdHJpeF9scltdWzldID0gewotCQkvKgotCQkgKiBCVC42MDEgTGltdGVkIHJh
bmdlIFlDYkNyIC0+IGZ1bGwgcmFuZ2UgUkdCCi0JCSAqIFRoZSBtYXRyaXggcmVxdWlyZWQgaXMg
OgotCQkgKiBbMS4xNjQzODQsIDAuMDAwLCAxLjU5NjAyNywKLQkJICogIDEuMTY0Mzg0LCAtMC4z
OTE3NSwgLTAuODEyODEzLAotCQkgKiAgMS4xNjQzODQsIDIuMDE3MjMyLCAwLjAwMDBdCi0JCSAq
LwotCQlbRFJNX0NPTE9SX1lDQkNSX0JUNjAxXSA9IHsKLQkJCTB4N0NDOCwgMHg3OTUwLCAweDAs
Ci0JCQkweDhEMDAsIDB4Nzk1MCwgMHg5Qzg4LAotCQkJMHgwLCAweDc5NTAsIDB4NjgxMCwKLQkJ
fSwKLQkJLyoKLQkJICogQlQuNzA5IExpbWl0ZWQgcmFuZ2UgWUNiQ3IgLT4gZnVsbCByYW5nZSBS
R0IKLQkJICogVGhlIG1hdHJpeCByZXF1aXJlZCBpcyA6Ci0JCSAqIFsxLjE2NDM4NCwgMC4wMDAs
IDEuNzkyNzQxLAotCQkgKiAgMS4xNjQzODQsIC0wLjIxMzI0OSwgLTAuNTMyOTA5LAotCQkgKiAg
MS4xNjQzODQsIDIuMTEyNDAyLCAwLjAwMDBdCi0JCSAqLwotCQlbRFJNX0NPTE9SX1lDQkNSX0JU
NzA5XSA9IHsKLQkJCTB4N0U1OCwgMHg3OTUwLCAweDAsCi0JCQkweDg4ODgsIDB4Nzk1MCwgMHhB
REE4LAotCQkJMHgwLCAweDc5NTAsICAweDY4NzAsCi0JCX0sCi0JCS8qCi0JCSAqIEJULjIwMjAg
TGltaXRlZCByYW5nZSBZQ2JDciAtPiBmdWxsIHJhbmdlIFJHQgotCQkgKiBUaGUgbWF0cml4IHJl
cXVpcmVkIGlzIDoKLQkJICogWzEuMTY0LCAwLjAwMCwgMS42NzgsCi0JCSAqICAxLjE2NCwgLTAu
MTg3MywgLTAuNjUwNCwKLQkJICogIDEuMTY0LCAyLjE0MTcsIDAuMDAwMF0KLQkJICovCi0JCVtE
Uk1fQ09MT1JfWUNCQ1JfQlQyMDIwXSA9IHsKLQkJCTB4N0Q3MCwgMHg3OTUwLCAweDAsCi0JCQkw
eDhBNjgsIDB4Nzk1MCwgMHhBQzAwLAotCQkJMHgwLCAweDc5NTAsIDB4Njg5MCwKLQkJfSwKLQl9
OwotCWNvbnN0IHUxNiAqY3NjOwotCi0JaWYgKHBsYW5lX3N0YXRlLT5ody5jb2xvcl9yYW5nZSA9
PSBEUk1fQ09MT1JfWUNCQ1JfRlVMTF9SQU5HRSkKLQkJY3NjID0gaW5wdXRfY3NjX21hdHJpeFtw
bGFuZV9zdGF0ZS0+aHcuY29sb3JfZW5jb2RpbmddOwotCWVsc2UKLQkJY3NjID0gaW5wdXRfY3Nj
X21hdHJpeF9scltwbGFuZV9zdGF0ZS0+aHcuY29sb3JfZW5jb2RpbmddOwotCi0JaW50ZWxfZGVf
d3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0lOUFVUX0NTQ19DT0VGRihwaXBlLCBwbGFuZV9pZCwg
MCksCi0JCQkgIFJPRkYoY3NjWzBdKSB8IEdPRkYoY3NjWzFdKSk7Ci0JaW50ZWxfZGVfd3JpdGVf
ZncoZGV2X3ByaXYsIFBMQU5FX0lOUFVUX0NTQ19DT0VGRihwaXBlLCBwbGFuZV9pZCwgMSksCi0J
CQkgIEJPRkYoY3NjWzJdKSk7Ci0JaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0lO
UFVUX0NTQ19DT0VGRihwaXBlLCBwbGFuZV9pZCwgMiksCi0JCQkgIFJPRkYoY3NjWzNdKSB8IEdP
RkYoY3NjWzRdKSk7Ci0JaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0lOUFVUX0NT
Q19DT0VGRihwaXBlLCBwbGFuZV9pZCwgMyksCi0JCQkgIEJPRkYoY3NjWzVdKSk7Ci0JaW50ZWxf
ZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0lOUFVUX0NTQ19DT0VGRihwaXBlLCBwbGFuZV9p
ZCwgNCksCi0JCQkgIFJPRkYoY3NjWzZdKSB8IEdPRkYoY3NjWzddKSk7Ci0JaW50ZWxfZGVfd3Jp
dGVfZncoZGV2X3ByaXYsIFBMQU5FX0lOUFVUX0NTQ19DT0VGRihwaXBlLCBwbGFuZV9pZCwgNSks
Ci0JCQkgIEJPRkYoY3NjWzhdKSk7Ci0KLQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExB
TkVfSU5QVVRfQ1NDX1BSRU9GRihwaXBlLCBwbGFuZV9pZCwgMCksCi0JCQkgIFBSRU9GRl9ZVVZf
VE9fUkdCX0hJKTsKLQlpZiAocGxhbmVfc3RhdGUtPmh3LmNvbG9yX3JhbmdlID09IERSTV9DT0xP
Ul9ZQ0JDUl9GVUxMX1JBTkdFKQotCQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwKLQkJCQkg
IFBMQU5FX0lOUFVUX0NTQ19QUkVPRkYocGlwZSwgcGxhbmVfaWQsIDEpLAotCQkJCSAgMCk7Ci0J
ZWxzZQotCQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwKLQkJCQkgIFBMQU5FX0lOUFVUX0NT
Q19QUkVPRkYocGlwZSwgcGxhbmVfaWQsIDEpLAotCQkJCSAgUFJFT0ZGX1lVVl9UT19SR0JfTUUp
OwotCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9JTlBVVF9DU0NfUFJFT0ZGKHBp
cGUsIHBsYW5lX2lkLCAyKSwKLQkJCSAgUFJFT0ZGX1lVVl9UT19SR0JfTE8pOwotCWludGVsX2Rl
X3dyaXRlX2Z3KGRldl9wcml2LAotCQkJICBQTEFORV9JTlBVVF9DU0NfUE9TVE9GRihwaXBlLCBw
bGFuZV9pZCwgMCksIDB4MCk7Ci0JaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsCi0JCQkgIFBM
QU5FX0lOUFVUX0NTQ19QT1NUT0ZGKHBpcGUsIHBsYW5lX2lkLCAxKSwgMHgwKTsKLQlpbnRlbF9k
ZV93cml0ZV9mdyhkZXZfcHJpdiwKLQkJCSAgUExBTkVfSU5QVVRfQ1NDX1BPU1RPRkYocGlwZSwg
cGxhbmVfaWQsIDIpLCAweDApOwotfQotCi1zdGF0aWMgdm9pZAotc2tsX3BsYW5lX2FzeW5jX2Zs
aXAoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKLQkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVf
c3RhdGUgKnBsYW5lX3N0YXRlKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQl1bnNpZ25lZCBsb25nIGlycWZsYWdzOwot
CWVudW0gcGxhbmVfaWQgcGxhbmVfaWQgPSBwbGFuZS0+aWQ7Ci0JZW51bSBwaXBlIHBpcGUgPSBw
bGFuZS0+cGlwZTsKLQl1MzIgc3VyZl9hZGRyID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBd
Lm9mZnNldDsKLQl1MzIgcGxhbmVfY3RsID0gcGxhbmVfc3RhdGUtPmN0bDsKLQotCXBsYW5lX2N0
bCB8PSBza2xfcGxhbmVfY3RsX2NydGMoY3J0Y19zdGF0ZSk7Ci0KLQlzcGluX2xvY2tfaXJxc2F2
ZSgmZGV2X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7Ci0KLQlpbnRlbF9kZV93cml0ZV9m
dyhkZXZfcHJpdiwgUExBTkVfQ1RMKHBpcGUsIHBsYW5lX2lkKSwgcGxhbmVfY3RsKTsKLQlpbnRl
bF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfU1VSRihwaXBlLCBwbGFuZV9pZCksCi0JCQkg
IGludGVsX3BsYW5lX2dndHRfb2Zmc2V0KHBsYW5lX3N0YXRlKSArIHN1cmZfYWRkcik7Ci0KLQlz
cGluX3VubG9ja19pcnFyZXN0b3JlKCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsK
LX0KLQotc3RhdGljIHZvaWQKLXNrbF9wcm9ncmFtX3BsYW5lKHN0cnVjdCBpbnRlbF9wbGFuZSAq
cGxhbmUsCi0JCSAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCi0J
CSAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKLQkJICBpbnQg
Y29sb3JfcGxhbmUpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShwbGFuZS0+YmFzZS5kZXYpOwotCWVudW0gcGxhbmVfaWQgcGxhbmVfaWQgPSBwbGFuZS0+
aWQ7Ci0JZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlwZTsKLQljb25zdCBzdHJ1Y3QgZHJtX2lu
dGVsX3Nwcml0ZV9jb2xvcmtleSAqa2V5ID0gJnBsYW5lX3N0YXRlLT5ja2V5OwotCXUzMiBzdXJm
X2FkZHIgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY29sb3JfcGxhbmVdLm9mZnNldDsKLQl1
MzIgc3RyaWRlID0gc2tsX3BsYW5lX3N0cmlkZShwbGFuZV9zdGF0ZSwgY29sb3JfcGxhbmUpOwot
CWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwot
CWludCBhdXhfcGxhbmUgPSBpbnRlbF9tYWluX3RvX2F1eF9wbGFuZShmYiwgY29sb3JfcGxhbmUp
OwotCWludCBjcnRjX3ggPSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3QueDE7Ci0JaW50IGNydGNfeSA9
IHBsYW5lX3N0YXRlLT51YXBpLmRzdC55MTsKLQl1MzIgeCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9w
bGFuZVtjb2xvcl9wbGFuZV0ueDsKLQl1MzIgeSA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtj
b2xvcl9wbGFuZV0ueTsKLQl1MzIgc3JjX3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUt
PnVhcGkuc3JjKSA+PiAxNjsKLQl1MzIgc3JjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0
YXRlLT51YXBpLnNyYykgPj4gMTY7Ci0JdTggYWxwaGEgPSBwbGFuZV9zdGF0ZS0+aHcuYWxwaGEg
Pj4gODsKLQl1MzIgcGxhbmVfY29sb3JfY3RsID0gMCwgYXV4X2Rpc3QgPSAwOwotCXVuc2lnbmVk
IGxvbmcgaXJxZmxhZ3M7Ci0JdTMyIGtleW1zaywga2V5bWF4OwotCXUzMiBwbGFuZV9jdGwgPSBw
bGFuZV9zdGF0ZS0+Y3RsOwotCi0JcGxhbmVfY3RsIHw9IHNrbF9wbGFuZV9jdGxfY3J0YyhjcnRj
X3N0YXRlKTsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8IElTX0dFTUlOSUxB
S0UoZGV2X3ByaXYpKQotCQlwbGFuZV9jb2xvcl9jdGwgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfY3Rs
IHwKLQkJCWdsa19wbGFuZV9jb2xvcl9jdGxfY3J0YyhjcnRjX3N0YXRlKTsKLQotCS8qIFNpemVz
IGFyZSAwIGJhc2VkICovCi0Jc3JjX3ctLTsKLQlzcmNfaC0tOwotCi0Ja2V5bWF4ID0gKGtleS0+
bWF4X3ZhbHVlICYgMHhmZmZmZmYpIHwgUExBTkVfS0VZTUFYX0FMUEhBKGFscGhhKTsKLQotCWtl
eW1zayA9IGtleS0+Y2hhbm5lbF9tYXNrICYgMHg3ZmZmZmZmOwotCWlmIChhbHBoYSA8IDB4ZmYp
Ci0JCWtleW1zayB8PSBQTEFORV9LRVlNU0tfQUxQSEFfRU5BQkxFOwotCi0JLyogVGhlIHNjYWxl
ciB3aWxsIGhhbmRsZSB0aGUgb3V0cHV0IHBvc2l0aW9uICovCi0JaWYgKHBsYW5lX3N0YXRlLT5z
Y2FsZXJfaWQgPj0gMCkgewotCQljcnRjX3ggPSAwOwotCQljcnRjX3kgPSAwOwotCX0KLQotCWlm
IChhdXhfcGxhbmUpIHsKLQkJYXV4X2Rpc3QgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbYXV4
X3BsYW5lXS5vZmZzZXQgLSBzdXJmX2FkZHI7Ci0KLQkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikg
PCAxMikKLQkJCWF1eF9kaXN0IHw9IHNrbF9wbGFuZV9zdHJpZGUocGxhbmVfc3RhdGUsIGF1eF9w
bGFuZSk7Ci0JfQotCi0Jc3Bpbl9sb2NrX2lycXNhdmUoJmRldl9wcml2LT51bmNvcmUubG9jaywg
aXJxZmxhZ3MpOwotCi0JaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX1NUUklERShw
aXBlLCBwbGFuZV9pZCksIHN0cmlkZSk7Ci0JaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBM
QU5FX1BPUyhwaXBlLCBwbGFuZV9pZCksCi0JCQkgIChjcnRjX3kgPDwgMTYpIHwgY3J0Y194KTsK
LQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfU0laRShwaXBlLCBwbGFuZV9pZCks
Ci0JCQkgIChzcmNfaCA8PCAxNikgfCBzcmNfdyk7Ci0KLQlpbnRlbF9kZV93cml0ZV9mdyhkZXZf
cHJpdiwgUExBTkVfQVVYX0RJU1QocGlwZSwgcGxhbmVfaWQpLCBhdXhfZGlzdCk7Ci0KLQlpZiAo
aWNsX2lzX2hkcl9wbGFuZShkZXZfcHJpdiwgcGxhbmVfaWQpKQotCQlpbnRlbF9kZV93cml0ZV9m
dyhkZXZfcHJpdiwgUExBTkVfQ1VTX0NUTChwaXBlLCBwbGFuZV9pZCksCi0JCQkJICBwbGFuZV9z
dGF0ZS0+Y3VzX2N0bCk7Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19H
RU1JTklMQUtFKGRldl9wcml2KSkKLQkJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5F
X0NPTE9SX0NUTChwaXBlLCBwbGFuZV9pZCksCi0JCQkJICBwbGFuZV9jb2xvcl9jdGwpOwotCi0J
aWYgKGZiLT5mb3JtYXQtPmlzX3l1diAmJiBpY2xfaXNfaGRyX3BsYW5lKGRldl9wcml2LCBwbGFu
ZV9pZCkpCi0JCWljbF9wcm9ncmFtX2lucHV0X2NzYyhwbGFuZSwgY3J0Y19zdGF0ZSwgcGxhbmVf
c3RhdGUpOwotCi0Jc2tsX3dyaXRlX3BsYW5lX3dtKHBsYW5lLCBjcnRjX3N0YXRlKTsKLQotCWlu
dGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9LRVlWQUwocGlwZSwgcGxhbmVfaWQpLAot
CQkJICBrZXktPm1pbl92YWx1ZSk7Ci0JaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5F
X0tFWU1TSyhwaXBlLCBwbGFuZV9pZCksIGtleW1zayk7Ci0JaW50ZWxfZGVfd3JpdGVfZncoZGV2
X3ByaXYsIFBMQU5FX0tFWU1BWChwaXBlLCBwbGFuZV9pZCksIGtleW1heCk7Ci0KLQlpbnRlbF9k
ZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfT0ZGU0VUKHBpcGUsIHBsYW5lX2lkKSwKLQkJCSAg
KHkgPDwgMTYpIHwgeCk7Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDExKQotCQlpbnRl
bF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfQVVYX09GRlNFVChwaXBlLCBwbGFuZV9pZCks
Ci0JCQkJICAocGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzFdLnkgPDwgMTYpIHwgcGxhbmVfc3Rh
dGUtPmNvbG9yX3BsYW5lWzFdLngpOwotCi0JaWYgKCFkcm1fYXRvbWljX2NydGNfbmVlZHNfbW9k
ZXNldCgmY3J0Y19zdGF0ZS0+dWFwaSkpCi0JCWludGVsX3BzcjJfcHJvZ3JhbV9wbGFuZV9zZWxf
ZmV0Y2gocGxhbmUsIGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlLCBjb2xvcl9wbGFuZSk7Ci0KLQkv
KgotCSAqIFRoZSBjb250cm9sIHJlZ2lzdGVyIHNlbGYtYXJtcyBpZiB0aGUgcGxhbmUgd2FzIHBy
ZXZpb3VzbHkKLQkgKiBkaXNhYmxlZC4gVHJ5IHRvIG1ha2UgdGhlIHBsYW5lIGVuYWJsZSBhdG9t
aWMgYnkgd3JpdGluZwotCSAqIHRoZSBjb250cm9sIHJlZ2lzdGVyIGp1c3QgYmVmb3JlIHRoZSBz
dXJmYWNlIHJlZ2lzdGVyLgotCSAqLwotCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFO
RV9DVEwocGlwZSwgcGxhbmVfaWQpLCBwbGFuZV9jdGwpOwotCWludGVsX2RlX3dyaXRlX2Z3KGRl
dl9wcml2LCBQTEFORV9TVVJGKHBpcGUsIHBsYW5lX2lkKSwKLQkJCSAgaW50ZWxfcGxhbmVfZ2d0
dF9vZmZzZXQocGxhbmVfc3RhdGUpICsgc3VyZl9hZGRyKTsKLQotCWlmIChwbGFuZV9zdGF0ZS0+
c2NhbGVyX2lkID49IDApCi0JCXNrbF9wcm9ncmFtX3NjYWxlcihwbGFuZSwgY3J0Y19zdGF0ZSwg
cGxhbmVfc3RhdGUpOwotCi0Jc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZGV2X3ByaXYtPnVuY29y
ZS5sb2NrLCBpcnFmbGFncyk7Ci19Ci0KLXN0YXRpYyB2b2lkCi1za2xfdXBkYXRlX3BsYW5lKHN0
cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCi0JCSBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKLQkJIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVf
c3RhdGUpCi17Ci0JaW50IGNvbG9yX3BsYW5lID0gMDsKLQotCWlmIChwbGFuZV9zdGF0ZS0+cGxh
bmFyX2xpbmtlZF9wbGFuZSAmJiAhcGxhbmVfc3RhdGUtPnBsYW5hcl9zbGF2ZSkKLQkJLyogUHJv
Z3JhbSB0aGUgVVYgcGxhbmUgb24gcGxhbmFyIG1hc3RlciAqLwotCQljb2xvcl9wbGFuZSA9IDE7
Ci0KLQlza2xfcHJvZ3JhbV9wbGFuZShwbGFuZSwgY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUsIGNv
bG9yX3BsYW5lKTsKLX0KLXN0YXRpYyB2b2lkCi1za2xfZGlzYWJsZV9wbGFuZShzdHJ1Y3QgaW50
ZWxfcGxhbmUgKnBsYW5lLAotCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
cGxhbmUtPmJhc2UuZGV2KTsKLQllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gcGxhbmUtPmlkOwot
CWVudW0gcGlwZSBwaXBlID0gcGxhbmUtPnBpcGU7Ci0JdW5zaWduZWQgbG9uZyBpcnFmbGFnczsK
LQotCXNwaW5fbG9ja19pcnFzYXZlKCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsK
LQotCWlmIChpY2xfaXNfaGRyX3BsYW5lKGRldl9wcml2LCBwbGFuZV9pZCkpCi0JCWludGVsX2Rl
X3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9DVVNfQ1RMKHBpcGUsIHBsYW5lX2lkKSwgMCk7Ci0K
LQlza2xfd3JpdGVfcGxhbmVfd20ocGxhbmUsIGNydGNfc3RhdGUpOwotCi0JaW50ZWxfZGVfd3Jp
dGVfZncoZGV2X3ByaXYsIFBMQU5FX0NUTChwaXBlLCBwbGFuZV9pZCksIDApOwotCWludGVsX2Rl
X3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9TVVJGKHBpcGUsIHBsYW5lX2lkKSwgMCk7Ci0KLQlz
cGluX3VubG9ja19pcnFyZXN0b3JlKCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsK
LX0KLQotc3RhdGljIGJvb2wKLXNrbF9wbGFuZV9nZXRfaHdfc3RhdGUoc3RydWN0IGludGVsX3Bs
YW5lICpwbGFuZSwKLQkJICAgICAgIGVudW0gcGlwZSAqcGlwZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7Ci0JZW51bSBp
bnRlbF9kaXNwbGF5X3Bvd2VyX2RvbWFpbiBwb3dlcl9kb21haW47Ci0JZW51bSBwbGFuZV9pZCBw
bGFuZV9pZCA9IHBsYW5lLT5pZDsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKLQlib29sIHJl
dDsKLQotCXBvd2VyX2RvbWFpbiA9IFBPV0VSX0RPTUFJTl9QSVBFKHBsYW5lLT5waXBlKTsKLQl3
YWtlcmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXRfaWZfZW5hYmxlZChkZXZfcHJpdiwgcG93
ZXJfZG9tYWluKTsKLQlpZiAoIXdha2VyZWYpCi0JCXJldHVybiBmYWxzZTsKLQotCXJldCA9IGlu
dGVsX2RlX3JlYWQoZGV2X3ByaXYsIFBMQU5FX0NUTChwbGFuZS0+cGlwZSwgcGxhbmVfaWQpKSAm
IFBMQU5FX0NUTF9FTkFCTEU7Ci0KLQkqcGlwZSA9IHBsYW5lLT5waXBlOwotCi0JaW50ZWxfZGlz
cGxheV9wb3dlcl9wdXQoZGV2X3ByaXYsIHBvd2VyX2RvbWFpbiwgd2FrZXJlZik7Ci0KLQlyZXR1
cm4gcmV0OwotfQotCiBzdGF0aWMgdm9pZCBpOXh4X3BsYW5lX2xpbmVhcl9nYW1tYSh1MTYgZ2Ft
bWFbOF0pCiB7CiAJLyogVGhlIHBvaW50cyBhcmUgbm90IGV2ZW5seSBzcGFjZWQuICovCkBAIC0y
MjgyLDI0NiArMTc1MSwxMyBAQCB2bHZfc3ByaXRlX2NoZWNrKHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlLAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgYm9vbCBpbnRlbF9mb3Jt
YXRfaXNfcDAxeCh1MzIgZm9ybWF0KQorc3RhdGljIGJvb2wgaGFzX2RzdF9rZXlfaW5fcHJpbWFy
eV9wbGFuZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7Ci0Jc3dpdGNoIChm
b3JtYXQpIHsKLQljYXNlIERSTV9GT1JNQVRfUDAxMDoKLQljYXNlIERSTV9GT1JNQVRfUDAxMjoK
LQljYXNlIERSTV9GT1JNQVRfUDAxNjoKLQkJcmV0dXJuIHRydWU7Ci0JZGVmYXVsdDoKLQkJcmV0
dXJuIGZhbHNlOwotCX0KKwlyZXR1cm4gSU5URUxfR0VOKGRldl9wcml2KSA+PSA5OwogfQogCi1z
dGF0aWMgaW50IHNrbF9wbGFuZV9jaGVja19mYihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKLQkJCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUpCi17Ci0Jc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3Bs
YW5lKHBsYW5lX3N0YXRlLT51YXBpLnBsYW5lKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7Ci0JdW5zaWduZWQgaW50IHJvdGF0
aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwotCXN0cnVjdCBkcm1fZm9ybWF0X25hbWVf
YnVmIGZvcm1hdF9uYW1lOwotCi0JaWYgKCFmYikKLQkJcmV0dXJuIDA7Ci0KLQlpZiAocm90YXRp
b24gJiB+KERSTV9NT0RFX1JPVEFURV8wIHwgRFJNX01PREVfUk9UQVRFXzE4MCkgJiYKLQkgICAg
aXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikpIHsKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2
LT5kcm0sCi0JCQkgICAgIlJDIHN1cHBvcnQgb25seSB3aXRoIDAvMTgwIGRlZ3JlZSByb3RhdGlv
biAoJXgpXG4iLAotCQkJICAgIHJvdGF0aW9uKTsKLQkJcmV0dXJuIC1FSU5WQUw7Ci0JfQotCi0J
aWYgKHJvdGF0aW9uICYgRFJNX01PREVfUkVGTEVDVF9YICYmCi0JICAgIGZiLT5tb2RpZmllciA9
PSBEUk1fRk9STUFUX01PRF9MSU5FQVIpIHsKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0s
Ci0JCQkgICAgImhvcml6b250YWwgZmxpcCBpcyBub3Qgc3VwcG9ydGVkIHdpdGggbGluZWFyIHN1
cmZhY2UgZm9ybWF0c1xuIik7Ci0JCXJldHVybiAtRUlOVkFMOwotCX0KLQotCWlmIChkcm1fcm90
YXRpb25fOTBfb3JfMjcwKHJvdGF0aW9uKSkgewotCQlpZiAoZmItPm1vZGlmaWVyICE9IEk5MTVf
Rk9STUFUX01PRF9ZX1RJTEVEICYmCi0JCSAgICBmYi0+bW9kaWZpZXIgIT0gSTkxNV9GT1JNQVRf
TU9EX1lmX1RJTEVEKSB7Ci0JCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKLQkJCQkgICAg
IlkvWWYgdGlsaW5nIHJlcXVpcmVkIGZvciA5MC8yNzAhXG4iKTsKLQkJCXJldHVybiAtRUlOVkFM
OwotCQl9Ci0KLQkJLyoKLQkJICogOTAvMjcwIGlzIG5vdCBhbGxvd2VkIHdpdGggUkdCNjQgMTY6
MTY6MTY6MTYgYW5kCi0JCSAqIEluZGV4ZWQgOC1iaXQuIFJHQiAxNi1iaXQgNTo2OjUgaXMgYWxs
b3dlZCBnZW4xMSBvbndhcmRzLgotCQkgKi8KLQkJc3dpdGNoIChmYi0+Zm9ybWF0LT5mb3JtYXQp
IHsKLQkJY2FzZSBEUk1fRk9STUFUX1JHQjU2NToKLQkJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
ID49IDExKQotCQkJCWJyZWFrOwotCQkJZmFsbHRocm91Z2g7Ci0JCWNhc2UgRFJNX0ZPUk1BVF9D
ODoKLQkJY2FzZSBEUk1fRk9STUFUX1hSR0IxNjE2MTYxNkY6Ci0JCWNhc2UgRFJNX0ZPUk1BVF9Y
QkdSMTYxNjE2MTZGOgotCQljYXNlIERSTV9GT1JNQVRfQVJHQjE2MTYxNjE2RjoKLQkJY2FzZSBE
Uk1fRk9STUFUX0FCR1IxNjE2MTYxNkY6Ci0JCWNhc2UgRFJNX0ZPUk1BVF9ZMjEwOgotCQljYXNl
IERSTV9GT1JNQVRfWTIxMjoKLQkJY2FzZSBEUk1fRk9STUFUX1kyMTY6Ci0JCWNhc2UgRFJNX0ZP
Uk1BVF9YVllVMTJfMTYxNjE2MTY6Ci0JCWNhc2UgRFJNX0ZPUk1BVF9YVllVMTYxNjE2MTY6Ci0J
CQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKLQkJCQkgICAgIlVuc3VwcG9ydGVkIHBpeGVs
IGZvcm1hdCAlcyBmb3IgOTAvMjcwIVxuIiwKLQkJCQkgICAgZHJtX2dldF9mb3JtYXRfbmFtZShm
Yi0+Zm9ybWF0LT5mb3JtYXQsCi0JCQkJCQkJJmZvcm1hdF9uYW1lKSk7Ci0JCQlyZXR1cm4gLUVJ
TlZBTDsKLQkJZGVmYXVsdDoKLQkJCWJyZWFrOwotCQl9Ci0JfQotCi0JLyogWS10aWxpbmcgaXMg
bm90IHN1cHBvcnRlZCBpbiBJRi1JRCBJbnRlcmxhY2UgbW9kZSAqLwotCWlmIChjcnRjX3N0YXRl
LT5ody5lbmFibGUgJiYKLQkgICAgY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFncyAm
IERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFICYmCi0JICAgIChmYi0+bW9kaWZpZXIgPT0gSTkxNV9G
T1JNQVRfTU9EX1lfVElMRUQgfHwKLQkgICAgIGZiLT5tb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9N
T0RfWWZfVElMRUQgfHwKLQkgICAgIGZiLT5tb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9U
SUxFRF9DQ1MgfHwKLQkgICAgIGZiLT5tb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElM
RURfQ0NTIHx8Ci0JICAgICBmYi0+bW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURf
R0VOMTJfUkNfQ0NTIHx8Ci0JICAgICBmYi0+bW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lf
VElMRURfR0VOMTJfTUNfQ0NTKSkgewotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKLQkJ
CSAgICAiWS9ZZiB0aWxpbmcgbm90IHN1cHBvcnRlZCBpbiBJRi1JRCBtb2RlXG4iKTsKLQkJcmV0
dXJuIC1FSU5WQUw7Ci0JfQotCi0JLyogV2FfMTYwNjA1NDE4ODp0Z2wgKi8KLQlpZiAoSVNfVElH
RVJMQUtFKGRldl9wcml2KSAmJgotCSAgICBwbGFuZV9zdGF0ZS0+Y2tleS5mbGFncyAmIEk5MTVf
U0VUX0NPTE9SS0VZX1NPVVJDRSAmJgotCSAgICBpbnRlbF9mb3JtYXRfaXNfcDAxeChmYi0+Zm9y
bWF0LT5mb3JtYXQpKSB7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAotCQkJICAgICJT
b3VyY2UgY29sb3Iga2V5aW5nIG5vdCBzdXBwb3J0ZWQgd2l0aCBQMDF4IGZvcm1hdHNcbiIpOwot
CQlyZXR1cm4gLUVJTlZBTDsKLQl9Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIGludCBza2xf
cGxhbmVfY2hlY2tfZHN0X2Nvb3JkaW5hdGVzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlLAotCQkJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9Ci0JCXRv
X2k5MTUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUtPmRldik7Ci0JaW50IGNydGNfeCA9IHBsYW5l
X3N0YXRlLT51YXBpLmRzdC54MTsKLQlpbnQgY3J0Y193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5l
X3N0YXRlLT51YXBpLmRzdCk7Ci0JaW50IHBpcGVfc3JjX3cgPSBjcnRjX3N0YXRlLT5waXBlX3Ny
Y193OwotCi0JLyoKLQkgKiBEaXNwbGF5IFdBICMxMTc1OiBjbmwsZ2xrCi0JICogUGxhbmVzIG90
aGVyIHRoYW4gdGhlIGN1cnNvciBtYXkgY2F1c2UgRklGTyB1bmRlcmZsb3cgYW5kIGRpc3BsYXkK
LQkgKiBjb3JydXB0aW9uIGlmIHN0YXJ0aW5nIGxlc3MgdGhhbiA0IHBpeGVscyBmcm9tIHRoZSBy
aWdodCBlZGdlIG9mCi0JICogdGhlIHNjcmVlbi4KLQkgKiBCZXNpZGVzIHRoZSBhYm92ZSBXQSBm
aXggdGhlIHNpbWlsYXIgcHJvYmxlbSwgd2hlcmUgcGxhbmVzIG90aGVyCi0JICogdGhhbiB0aGUg
Y3Vyc29yIGVuZGluZyBsZXNzIHRoYW4gNCBwaXhlbHMgZnJvbSB0aGUgbGVmdCBlZGdlIG9mIHRo
ZQotCSAqIHNjcmVlbiBtYXkgY2F1c2UgRklGTyB1bmRlcmZsb3cgYW5kIGRpc3BsYXkgY29ycnVw
dGlvbi4KLQkgKi8KLQlpZiAoKElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpIHx8IElTX0NBTk5PTkxB
S0UoZGV2X3ByaXYpKSAmJgotCSAgICAoY3J0Y194ICsgY3J0Y193IDwgNCB8fCBjcnRjX3ggPiBw
aXBlX3NyY193IC0gNCkpIHsKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCi0JCQkgICAg
InJlcXVlc3RlZCBwbGFuZSBYICVzIHBvc2l0aW9uICVkIGludmFsaWQgKHZhbGlkIHJhbmdlICVk
LSVkKVxuIiwKLQkJCSAgICBjcnRjX3ggKyBjcnRjX3cgPCA0ID8gImVuZCIgOiAic3RhcnQiLAot
CQkJICAgIGNydGNfeCArIGNydGNfdyA8IDQgPyBjcnRjX3ggKyBjcnRjX3cgOiBjcnRjX3gsCi0J
CQkgICAgNCwgcGlwZV9zcmNfdyAtIDQpOwotCQlyZXR1cm4gLUVSQU5HRTsKLQl9Ci0KLQlyZXR1
cm4gMDsKLX0KLQotc3RhdGljIGludCBza2xfcGxhbmVfY2hlY2tfbnYxMl9yb3RhdGlvbihjb25z
dCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQotewotCWNvbnN0IHN0cnVj
dCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwotCXVuc2lnbmVkIGlu
dCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKLQlpbnQgc3JjX3cgPSBkcm1f
cmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuc3JjKSA+PiAxNjsKLQotCS8qIERpc3BsYXkg
V0EgIzExMDYgKi8KLQlpZiAoaW50ZWxfZm9ybWF0X2luZm9faXNfeXV2X3NlbWlwbGFuYXIoZmIt
PmZvcm1hdCwgZmItPm1vZGlmaWVyKSAmJgotCSAgICBzcmNfdyAmIDMgJiYKLQkgICAgKHJvdGF0
aW9uID09IERSTV9NT0RFX1JPVEFURV8yNzAgfHwKLQkgICAgIHJvdGF0aW9uID09IChEUk1fTU9E
RV9SRUZMRUNUX1ggfCBEUk1fTU9ERV9ST1RBVEVfOTApKSkgewotCQlEUk1fREVCVUdfS01TKCJz
cmMgd2lkdGggbXVzdCBiZSBtdWx0aXBsZSBvZiA0IGZvciByb3RhdGVkIHBsYW5hciBZVVZcbiIp
OwotCQlyZXR1cm4gLUVJTlZBTDsKLQl9Ci0KLQlyZXR1cm4gMDsKLX0KLQotc3RhdGljIGludCBz
a2xfcGxhbmVfbWF4X3NjYWxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJ
CSAgICAgICBjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYikKLXsKLQkvKgotCSAqIFdl
IGRvbid0IHlldCBrbm93IHRoZSBmaW5hbCBzb3VyY2Ugd2lkdGggbm9yCi0JICogd2hldGhlciB3
ZSBjYW4gdXNlIHRoZSBIUSBzY2FsZXIgbW9kZS4gQXNzdW1lCi0JICogdGhlIGJlc3QgY2FzZS4K
LQkgKiBGSVhNRSBuZWVkIHRvIHByb3Blcmx5IGNoZWNrIHRoaXMgbGF0ZXIuCi0JICovCi0JaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikgfHwK
LQkgICAgIWludGVsX2Zvcm1hdF9pbmZvX2lzX3l1dl9zZW1pcGxhbmFyKGZiLT5mb3JtYXQsIGZi
LT5tb2RpZmllcikpCi0JCXJldHVybiAweDMwMDAwIC0gMTsKLQllbHNlCi0JCXJldHVybiAweDIw
MDAwIC0gMTsKLX0KLQotc3RhdGljIGludCBza2xfcGxhbmVfY2hlY2soc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCQkgICBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlKQotewotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFu
ZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJh
bWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwotCWludCBtaW5fc2NhbGUgPSBEUk1f
UExBTkVfSEVMUEVSX05PX1NDQUxJTkc7Ci0JaW50IG1heF9zY2FsZSA9IERSTV9QTEFORV9IRUxQ
RVJfTk9fU0NBTElORzsKLQlpbnQgcmV0OwotCi0JcmV0ID0gc2tsX3BsYW5lX2NoZWNrX2ZiKGNy
dGNfc3RhdGUsIHBsYW5lX3N0YXRlKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCi0JLyog
dXNlIHNjYWxlciB3aGVuIGNvbG9ya2V5IGlzIG5vdCByZXF1aXJlZCAqLwotCWlmICghcGxhbmVf
c3RhdGUtPmNrZXkuZmxhZ3MgJiYgaW50ZWxfZmJfc2NhbGFibGUoZmIpKSB7Ci0JCW1pbl9zY2Fs
ZSA9IDE7Ci0JCW1heF9zY2FsZSA9IHNrbF9wbGFuZV9tYXhfc2NhbGUoZGV2X3ByaXYsIGZiKTsK
LQl9Ci0KLQlyZXQgPSBpbnRlbF9hdG9taWNfcGxhbmVfY2hlY2tfY2xpcHBpbmcocGxhbmVfc3Rh
dGUsIGNydGNfc3RhdGUsCi0JCQkJCQltaW5fc2NhbGUsIG1heF9zY2FsZSwgdHJ1ZSk7Ci0JaWYg
KHJldCkKLQkJcmV0dXJuIHJldDsKLQotCXJldCA9IHNrbF9jaGVja19wbGFuZV9zdXJmYWNlKHBs
YW5lX3N0YXRlKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCi0JaWYgKCFwbGFuZV9zdGF0
ZS0+dWFwaS52aXNpYmxlKQotCQlyZXR1cm4gMDsKLQotCXJldCA9IHNrbF9wbGFuZV9jaGVja19k
c3RfY29vcmRpbmF0ZXMoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOwotCWlmIChyZXQpCi0JCXJl
dHVybiByZXQ7Ci0KLQlyZXQgPSBpbnRlbF9wbGFuZV9jaGVja19zcmNfY29vcmRpbmF0ZXMocGxh
bmVfc3RhdGUpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQlyZXQgPSBza2xfcGxhbmVf
Y2hlY2tfbnYxMl9yb3RhdGlvbihwbGFuZV9zdGF0ZSk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJl
dDsKLQotCS8qIEhXIG9ubHkgaGFzIDggYml0cyBwaXhlbCBwcmVjaXNpb24sIGRpc2FibGUgcGxh
bmUgaWYgaW52aXNpYmxlICovCi0JaWYgKCEocGxhbmVfc3RhdGUtPmh3LmFscGhhID4+IDgpKQot
CQlwbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlID0gZmFsc2U7Ci0KLQlwbGFuZV9zdGF0ZS0+Y3Rs
ID0gc2tsX3BsYW5lX2N0bChjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7Ci0KLQlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkKLQkJcGxhbmVf
c3RhdGUtPmNvbG9yX2N0bCA9IGdsa19wbGFuZV9jb2xvcl9jdGwoY3J0Y19zdGF0ZSwKLQkJCQkJ
CQkgICAgIHBsYW5lX3N0YXRlKTsKLQotCWlmIChpbnRlbF9mb3JtYXRfaW5mb19pc195dXZfc2Vt
aXBsYW5hcihmYi0+Zm9ybWF0LCBmYi0+bW9kaWZpZXIpICYmCi0JICAgIGljbF9pc19oZHJfcGxh
bmUoZGV2X3ByaXYsIHBsYW5lLT5pZCkpCi0JCS8qIEVuYWJsZSBhbmQgdXNlIE1QRUctMiBjaHJv
bWEgc2l0aW5nICovCi0JCXBsYW5lX3N0YXRlLT5jdXNfY3RsID0gUExBTkVfQ1VTX0VOQUJMRSB8
Ci0JCQlQTEFORV9DVVNfSFBIQVNFXzAgfAotCQkJUExBTkVfQ1VTX1ZQSEFTRV9TSUdOX05FR0FU
SVZFIHwgUExBTkVfQ1VTX1ZQSEFTRV8wXzI1OwotCWVsc2UKLQkJcGxhbmVfc3RhdGUtPmN1c19j
dGwgPSAwOwotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBib29sIGhhc19kc3Rfa2V5X2luX3By
aW1hcnlfcGxhbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQotewotCXJldHVy
biBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDk7Ci19Ci0KLXN0YXRpYyB2b2lkIGludGVsX3BsYW5l
X3NldF9ja2V5KHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCi0JCQkJIGNv
bnN0IHN0cnVjdCBkcm1faW50ZWxfc3ByaXRlX2NvbG9ya2V5ICpzZXQpCitzdGF0aWMgdm9pZCBp
bnRlbF9wbGFuZV9zZXRfY2tleShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRl
LAorCQkJCSBjb25zdCBzdHJ1Y3QgZHJtX2ludGVsX3Nwcml0ZV9jb2xvcmtleSAqc2V0KQogewog
CXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+
dWFwaS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShwbGFuZS0+YmFzZS5kZXYpOwpAQCAtMjY5MiwxODQgKzE5MjgsNiBAQCBzdGF0aWMgY29uc3Qg
dTMyIGNodl9waXBlX2Jfc3ByaXRlX2Zvcm1hdHNbXSA9IHsKIAlEUk1fRk9STUFUX1ZZVVksCiB9
OwogCi1zdGF0aWMgY29uc3QgdTMyIHNrbF9wbGFuZV9mb3JtYXRzW10gPSB7Ci0JRFJNX0ZPUk1B
VF9DOCwKLQlEUk1fRk9STUFUX1JHQjU2NSwKLQlEUk1fRk9STUFUX1hSR0I4ODg4LAotCURSTV9G
T1JNQVRfWEJHUjg4ODgsCi0JRFJNX0ZPUk1BVF9BUkdCODg4OCwKLQlEUk1fRk9STUFUX0FCR1I4
ODg4LAotCURSTV9GT1JNQVRfWFJHQjIxMDEwMTAsCi0JRFJNX0ZPUk1BVF9YQkdSMjEwMTAxMCwK
LQlEUk1fRk9STUFUX1hSR0IxNjE2MTYxNkYsCi0JRFJNX0ZPUk1BVF9YQkdSMTYxNjE2MTZGLAot
CURSTV9GT1JNQVRfWVVZViwKLQlEUk1fRk9STUFUX1lWWVUsCi0JRFJNX0ZPUk1BVF9VWVZZLAot
CURSTV9GT1JNQVRfVllVWSwKLQlEUk1fRk9STUFUX1hZVVY4ODg4LAotfTsKLQotc3RhdGljIGNv
bnN0IHUzMiBza2xfcGxhbmFyX2Zvcm1hdHNbXSA9IHsKLQlEUk1fRk9STUFUX0M4LAotCURSTV9G
T1JNQVRfUkdCNTY1LAotCURSTV9GT1JNQVRfWFJHQjg4ODgsCi0JRFJNX0ZPUk1BVF9YQkdSODg4
OCwKLQlEUk1fRk9STUFUX0FSR0I4ODg4LAotCURSTV9GT1JNQVRfQUJHUjg4ODgsCi0JRFJNX0ZP
Uk1BVF9YUkdCMjEwMTAxMCwKLQlEUk1fRk9STUFUX1hCR1IyMTAxMDEwLAotCURSTV9GT1JNQVRf
WFJHQjE2MTYxNjE2RiwKLQlEUk1fRk9STUFUX1hCR1IxNjE2MTYxNkYsCi0JRFJNX0ZPUk1BVF9Z
VVlWLAotCURSTV9GT1JNQVRfWVZZVSwKLQlEUk1fRk9STUFUX1VZVlksCi0JRFJNX0ZPUk1BVF9W
WVVZLAotCURSTV9GT1JNQVRfTlYxMiwKLQlEUk1fRk9STUFUX1hZVVY4ODg4LAotfTsKLQotc3Rh
dGljIGNvbnN0IHUzMiBnbGtfcGxhbmFyX2Zvcm1hdHNbXSA9IHsKLQlEUk1fRk9STUFUX0M4LAot
CURSTV9GT1JNQVRfUkdCNTY1LAotCURSTV9GT1JNQVRfWFJHQjg4ODgsCi0JRFJNX0ZPUk1BVF9Y
QkdSODg4OCwKLQlEUk1fRk9STUFUX0FSR0I4ODg4LAotCURSTV9GT1JNQVRfQUJHUjg4ODgsCi0J
RFJNX0ZPUk1BVF9YUkdCMjEwMTAxMCwKLQlEUk1fRk9STUFUX1hCR1IyMTAxMDEwLAotCURSTV9G
T1JNQVRfWFJHQjE2MTYxNjE2RiwKLQlEUk1fRk9STUFUX1hCR1IxNjE2MTYxNkYsCi0JRFJNX0ZP
Uk1BVF9ZVVlWLAotCURSTV9GT1JNQVRfWVZZVSwKLQlEUk1fRk9STUFUX1VZVlksCi0JRFJNX0ZP
Uk1BVF9WWVVZLAotCURSTV9GT1JNQVRfTlYxMiwKLQlEUk1fRk9STUFUX1hZVVY4ODg4LAotCURS
TV9GT1JNQVRfUDAxMCwKLQlEUk1fRk9STUFUX1AwMTIsCi0JRFJNX0ZPUk1BVF9QMDE2LAotfTsK
LQotc3RhdGljIGNvbnN0IHUzMiBpY2xfc2RyX3lfcGxhbmVfZm9ybWF0c1tdID0gewotCURSTV9G
T1JNQVRfQzgsCi0JRFJNX0ZPUk1BVF9SR0I1NjUsCi0JRFJNX0ZPUk1BVF9YUkdCODg4OCwKLQlE
Uk1fRk9STUFUX1hCR1I4ODg4LAotCURSTV9GT1JNQVRfQVJHQjg4ODgsCi0JRFJNX0ZPUk1BVF9B
QkdSODg4OCwKLQlEUk1fRk9STUFUX1hSR0IyMTAxMDEwLAotCURSTV9GT1JNQVRfWEJHUjIxMDEw
MTAsCi0JRFJNX0ZPUk1BVF9BUkdCMjEwMTAxMCwKLQlEUk1fRk9STUFUX0FCR1IyMTAxMDEwLAot
CURSTV9GT1JNQVRfWVVZViwKLQlEUk1fRk9STUFUX1lWWVUsCi0JRFJNX0ZPUk1BVF9VWVZZLAot
CURSTV9GT1JNQVRfVllVWSwKLQlEUk1fRk9STUFUX1kyMTAsCi0JRFJNX0ZPUk1BVF9ZMjEyLAot
CURSTV9GT1JNQVRfWTIxNiwKLQlEUk1fRk9STUFUX1hZVVY4ODg4LAotCURSTV9GT1JNQVRfWFZZ
VTIxMDEwMTAsCi0JRFJNX0ZPUk1BVF9YVllVMTJfMTYxNjE2MTYsCi0JRFJNX0ZPUk1BVF9YVllV
MTYxNjE2MTYsCi19OwotCi1zdGF0aWMgY29uc3QgdTMyIGljbF9zZHJfdXZfcGxhbmVfZm9ybWF0
c1tdID0gewotCURSTV9GT1JNQVRfQzgsCi0JRFJNX0ZPUk1BVF9SR0I1NjUsCi0JRFJNX0ZPUk1B
VF9YUkdCODg4OCwKLQlEUk1fRk9STUFUX1hCR1I4ODg4LAotCURSTV9GT1JNQVRfQVJHQjg4ODgs
Ci0JRFJNX0ZPUk1BVF9BQkdSODg4OCwKLQlEUk1fRk9STUFUX1hSR0IyMTAxMDEwLAotCURSTV9G
T1JNQVRfWEJHUjIxMDEwMTAsCi0JRFJNX0ZPUk1BVF9BUkdCMjEwMTAxMCwKLQlEUk1fRk9STUFU
X0FCR1IyMTAxMDEwLAotCURSTV9GT1JNQVRfWVVZViwKLQlEUk1fRk9STUFUX1lWWVUsCi0JRFJN
X0ZPUk1BVF9VWVZZLAotCURSTV9GT1JNQVRfVllVWSwKLQlEUk1fRk9STUFUX05WMTIsCi0JRFJN
X0ZPUk1BVF9QMDEwLAotCURSTV9GT1JNQVRfUDAxMiwKLQlEUk1fRk9STUFUX1AwMTYsCi0JRFJN
X0ZPUk1BVF9ZMjEwLAotCURSTV9GT1JNQVRfWTIxMiwKLQlEUk1fRk9STUFUX1kyMTYsCi0JRFJN
X0ZPUk1BVF9YWVVWODg4OCwKLQlEUk1fRk9STUFUX1hWWVUyMTAxMDEwLAotCURSTV9GT1JNQVRf
WFZZVTEyXzE2MTYxNjE2LAotCURSTV9GT1JNQVRfWFZZVTE2MTYxNjE2LAotfTsKLQotc3RhdGlj
IGNvbnN0IHUzMiBpY2xfaGRyX3BsYW5lX2Zvcm1hdHNbXSA9IHsKLQlEUk1fRk9STUFUX0M4LAot
CURSTV9GT1JNQVRfUkdCNTY1LAotCURSTV9GT1JNQVRfWFJHQjg4ODgsCi0JRFJNX0ZPUk1BVF9Y
QkdSODg4OCwKLQlEUk1fRk9STUFUX0FSR0I4ODg4LAotCURSTV9GT1JNQVRfQUJHUjg4ODgsCi0J
RFJNX0ZPUk1BVF9YUkdCMjEwMTAxMCwKLQlEUk1fRk9STUFUX1hCR1IyMTAxMDEwLAotCURSTV9G
T1JNQVRfQVJHQjIxMDEwMTAsCi0JRFJNX0ZPUk1BVF9BQkdSMjEwMTAxMCwKLQlEUk1fRk9STUFU
X1hSR0IxNjE2MTYxNkYsCi0JRFJNX0ZPUk1BVF9YQkdSMTYxNjE2MTZGLAotCURSTV9GT1JNQVRf
QVJHQjE2MTYxNjE2RiwKLQlEUk1fRk9STUFUX0FCR1IxNjE2MTYxNkYsCi0JRFJNX0ZPUk1BVF9Z
VVlWLAotCURSTV9GT1JNQVRfWVZZVSwKLQlEUk1fRk9STUFUX1VZVlksCi0JRFJNX0ZPUk1BVF9W
WVVZLAotCURSTV9GT1JNQVRfTlYxMiwKLQlEUk1fRk9STUFUX1AwMTAsCi0JRFJNX0ZPUk1BVF9Q
MDEyLAotCURSTV9GT1JNQVRfUDAxNiwKLQlEUk1fRk9STUFUX1kyMTAsCi0JRFJNX0ZPUk1BVF9Z
MjEyLAotCURSTV9GT1JNQVRfWTIxNiwKLQlEUk1fRk9STUFUX1hZVVY4ODg4LAotCURSTV9GT1JN
QVRfWFZZVTIxMDEwMTAsCi0JRFJNX0ZPUk1BVF9YVllVMTJfMTYxNjE2MTYsCi0JRFJNX0ZPUk1B
VF9YVllVMTYxNjE2MTYsCi19OwotCi1zdGF0aWMgY29uc3QgdTY0IHNrbF9wbGFuZV9mb3JtYXRf
bW9kaWZpZXJzX25vY2NzW10gPSB7Ci0JSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVELAotCUk5MTVf
Rk9STUFUX01PRF9ZX1RJTEVELAotCUk5MTVfRk9STUFUX01PRF9YX1RJTEVELAotCURSTV9GT1JN
QVRfTU9EX0xJTkVBUiwKLQlEUk1fRk9STUFUX01PRF9JTlZBTElECi19OwotCi1zdGF0aWMgY29u
c3QgdTY0IHNrbF9wbGFuZV9mb3JtYXRfbW9kaWZpZXJzX2Njc1tdID0gewotCUk5MTVfRk9STUFU
X01PRF9ZZl9USUxFRF9DQ1MsCi0JSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfQ0NTLAotCUk5MTVf
Rk9STUFUX01PRF9ZZl9USUxFRCwKLQlJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRCwKLQlJOTE1X0ZP
Uk1BVF9NT0RfWF9USUxFRCwKLQlEUk1fRk9STUFUX01PRF9MSU5FQVIsCi0JRFJNX0ZPUk1BVF9N
T0RfSU5WQUxJRAotfTsKLQotc3RhdGljIGNvbnN0IHU2NCBnZW4xMl9wbGFuZV9mb3JtYXRfbW9k
aWZpZXJzX21jX2Njc1tdID0gewotCUk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX01DX0ND
UywKLQlJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1MsCi0JSTkxNV9GT1JNQVRf
TU9EX1lfVElMRUQsCi0JSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQsCi0JRFJNX0ZPUk1BVF9NT0Rf
TElORUFSLAotCURSTV9GT1JNQVRfTU9EX0lOVkFMSUQKLX07Ci0KLXN0YXRpYyBjb25zdCB1NjQg
Z2VuMTJfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19yY19jY3NbXSA9IHsKLQlJOTE1X0ZPUk1BVF9N
T0RfWV9USUxFRF9HRU4xMl9SQ19DQ1MsCi0JSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQsCi0JSTkx
NV9GT1JNQVRfTU9EX1hfVElMRUQsCi0JRFJNX0ZPUk1BVF9NT0RfTElORUFSLAotCURSTV9GT1JN
QVRfTU9EX0lOVkFMSUQKLX07Ci0KIHN0YXRpYyBib29sIGc0eF9zcHJpdGVfZm9ybWF0X21vZF9z
dXBwb3J0ZWQoc3RydWN0IGRybV9wbGFuZSAqX3BsYW5lLAogCQkJCQkgICAgdTMyIGZvcm1hdCwg
dTY0IG1vZGlmaWVyKQogewpAQCAtMjk2MiwxNDggKzIwMjAsNiBAQCBzdGF0aWMgYm9vbCB2bHZf
c3ByaXRlX2Zvcm1hdF9tb2Rfc3VwcG9ydGVkKHN0cnVjdCBkcm1fcGxhbmUgKl9wbGFuZSwKIAl9
CiB9CiAKLXN0YXRpYyBib29sIHNrbF9wbGFuZV9mb3JtYXRfbW9kX3N1cHBvcnRlZChzdHJ1Y3Qg
ZHJtX3BsYW5lICpfcGxhbmUsCi0JCQkJCSAgIHUzMiBmb3JtYXQsIHU2NCBtb2RpZmllcikKLXsK
LQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUoX3BsYW5lKTsKLQot
CXN3aXRjaCAobW9kaWZpZXIpIHsKLQljYXNlIERSTV9GT1JNQVRfTU9EX0xJTkVBUjoKLQljYXNl
IEk5MTVfRk9STUFUX01PRF9YX1RJTEVEOgotCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQ6
Ci0JY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRUQ6Ci0JCWJyZWFrOwotCWNhc2UgSTkxNV9G
T1JNQVRfTU9EX1lfVElMRURfQ0NTOgotCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEX0ND
UzoKLQkJaWYgKCFwbGFuZS0+aGFzX2NjcykKLQkJCXJldHVybiBmYWxzZTsKLQkJYnJlYWs7Ci0J
ZGVmYXVsdDoKLQkJcmV0dXJuIGZhbHNlOwotCX0KLQotCXN3aXRjaCAoZm9ybWF0KSB7Ci0JY2Fz
ZSBEUk1fRk9STUFUX1hSR0I4ODg4OgotCWNhc2UgRFJNX0ZPUk1BVF9YQkdSODg4ODoKLQljYXNl
IERSTV9GT1JNQVRfQVJHQjg4ODg6Ci0JY2FzZSBEUk1fRk9STUFUX0FCR1I4ODg4OgotCQlpZiAo
aXNfY2NzX21vZGlmaWVyKG1vZGlmaWVyKSkKLQkJCXJldHVybiB0cnVlOwotCQlmYWxsdGhyb3Vn
aDsKLQljYXNlIERSTV9GT1JNQVRfUkdCNTY1OgotCWNhc2UgRFJNX0ZPUk1BVF9YUkdCMjEwMTAx
MDoKLQljYXNlIERSTV9GT1JNQVRfWEJHUjIxMDEwMTA6Ci0JY2FzZSBEUk1fRk9STUFUX0FSR0Iy
MTAxMDEwOgotCWNhc2UgRFJNX0ZPUk1BVF9BQkdSMjEwMTAxMDoKLQljYXNlIERSTV9GT1JNQVRf
WVVZVjoKLQljYXNlIERSTV9GT1JNQVRfWVZZVToKLQljYXNlIERSTV9GT1JNQVRfVVlWWToKLQlj
YXNlIERSTV9GT1JNQVRfVllVWToKLQljYXNlIERSTV9GT1JNQVRfTlYxMjoKLQljYXNlIERSTV9G
T1JNQVRfWFlVVjg4ODg6Ci0JY2FzZSBEUk1fRk9STUFUX1AwMTA6Ci0JY2FzZSBEUk1fRk9STUFU
X1AwMTI6Ci0JY2FzZSBEUk1fRk9STUFUX1AwMTY6Ci0JY2FzZSBEUk1fRk9STUFUX1hWWVUyMTAx
MDEwOgotCQlpZiAobW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEKQotCQkJcmV0
dXJuIHRydWU7Ci0JCWZhbGx0aHJvdWdoOwotCWNhc2UgRFJNX0ZPUk1BVF9DODoKLQljYXNlIERS
TV9GT1JNQVRfWEJHUjE2MTYxNjE2RjoKLQljYXNlIERSTV9GT1JNQVRfQUJHUjE2MTYxNjE2RjoK
LQljYXNlIERSTV9GT1JNQVRfWFJHQjE2MTYxNjE2RjoKLQljYXNlIERSTV9GT1JNQVRfQVJHQjE2
MTYxNjE2RjoKLQljYXNlIERSTV9GT1JNQVRfWTIxMDoKLQljYXNlIERSTV9GT1JNQVRfWTIxMjoK
LQljYXNlIERSTV9GT1JNQVRfWTIxNjoKLQljYXNlIERSTV9GT1JNQVRfWFZZVTEyXzE2MTYxNjE2
OgotCWNhc2UgRFJNX0ZPUk1BVF9YVllVMTYxNjE2MTY6Ci0JCWlmIChtb2RpZmllciA9PSBEUk1f
Rk9STUFUX01PRF9MSU5FQVIgfHwKLQkJICAgIG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9Y
X1RJTEVEIHx8Ci0JCSAgICBtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRCkKLQkJ
CXJldHVybiB0cnVlOwotCQlmYWxsdGhyb3VnaDsKLQlkZWZhdWx0OgotCQlyZXR1cm4gZmFsc2U7
Ci0JfQotfQotCi1zdGF0aWMgYm9vbCBnZW4xMl9wbGFuZV9zdXBwb3J0c19tY19jY3Moc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAotCQkJCQllbnVtIHBsYW5lX2lkIHBsYW5lX2lk
KQotewotCS8qIFdhXzE0MDEwNDc3MDA4OnRnbFthMC4uYzBdLHJrbFthbGxdLGRnMVthbGxdICov
Ci0JaWYgKElTX0RHMShkZXZfcHJpdikgfHwgSVNfUk9DS0VUTEFLRShkZXZfcHJpdikgfHwKLQkg
ICAgSVNfVEdMX0RJU1BfUkVWSUQoZGV2X3ByaXYsIFRHTF9SRVZJRF9BMCwgVEdMX1JFVklEX0Mw
KSkKLQkJcmV0dXJuIGZhbHNlOwotCi0JcmV0dXJuIHBsYW5lX2lkIDwgUExBTkVfU1BSSVRFNDsK
LX0KLQotc3RhdGljIGJvb2wgZ2VuMTJfcGxhbmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQoc3RydWN0
IGRybV9wbGFuZSAqX3BsYW5lLAotCQkJCQkgICAgIHUzMiBmb3JtYXQsIHU2NCBtb2RpZmllcikK
LXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KF9wbGFuZS0+
ZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUoX3BsYW5l
KTsKLQotCXN3aXRjaCAobW9kaWZpZXIpIHsKLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVE
X0dFTjEyX01DX0NDUzoKLQkJaWYgKCFnZW4xMl9wbGFuZV9zdXBwb3J0c19tY19jY3MoZGV2X3By
aXYsIHBsYW5lLT5pZCkpCi0JCQlyZXR1cm4gZmFsc2U7Ci0JCWZhbGx0aHJvdWdoOwotCWNhc2Ug
RFJNX0ZPUk1BVF9NT0RfTElORUFSOgotCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQ6Ci0J
Y2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRDoKLQljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJ
TEVEX0dFTjEyX1JDX0NDUzoKLQkJYnJlYWs7Ci0JZGVmYXVsdDoKLQkJcmV0dXJuIGZhbHNlOwot
CX0KLQotCXN3aXRjaCAoZm9ybWF0KSB7Ci0JY2FzZSBEUk1fRk9STUFUX1hSR0I4ODg4OgotCWNh
c2UgRFJNX0ZPUk1BVF9YQkdSODg4ODoKLQljYXNlIERSTV9GT1JNQVRfQVJHQjg4ODg6Ci0JY2Fz
ZSBEUk1fRk9STUFUX0FCR1I4ODg4OgotCQlpZiAoaXNfY2NzX21vZGlmaWVyKG1vZGlmaWVyKSkK
LQkJCXJldHVybiB0cnVlOwotCQlmYWxsdGhyb3VnaDsKLQljYXNlIERSTV9GT1JNQVRfWVVZVjoK
LQljYXNlIERSTV9GT1JNQVRfWVZZVToKLQljYXNlIERSTV9GT1JNQVRfVVlWWToKLQljYXNlIERS
TV9GT1JNQVRfVllVWToKLQljYXNlIERSTV9GT1JNQVRfTlYxMjoKLQljYXNlIERSTV9GT1JNQVRf
WFlVVjg4ODg6Ci0JY2FzZSBEUk1fRk9STUFUX1AwMTA6Ci0JY2FzZSBEUk1fRk9STUFUX1AwMTI6
Ci0JY2FzZSBEUk1fRk9STUFUX1AwMTY6Ci0JCWlmIChtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9N
T0RfWV9USUxFRF9HRU4xMl9NQ19DQ1MpCi0JCQlyZXR1cm4gdHJ1ZTsKLQkJZmFsbHRocm91Z2g7
Ci0JY2FzZSBEUk1fRk9STUFUX1JHQjU2NToKLQljYXNlIERSTV9GT1JNQVRfWFJHQjIxMDEwMTA6
Ci0JY2FzZSBEUk1fRk9STUFUX1hCR1IyMTAxMDEwOgotCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMjEw
MTAxMDoKLQljYXNlIERSTV9GT1JNQVRfQUJHUjIxMDEwMTA6Ci0JY2FzZSBEUk1fRk9STUFUX1hW
WVUyMTAxMDEwOgotCWNhc2UgRFJNX0ZPUk1BVF9DODoKLQljYXNlIERSTV9GT1JNQVRfWEJHUjE2
MTYxNjE2RjoKLQljYXNlIERSTV9GT1JNQVRfQUJHUjE2MTYxNjE2RjoKLQljYXNlIERSTV9GT1JN
QVRfWFJHQjE2MTYxNjE2RjoKLQljYXNlIERSTV9GT1JNQVRfQVJHQjE2MTYxNjE2RjoKLQljYXNl
IERSTV9GT1JNQVRfWTIxMDoKLQljYXNlIERSTV9GT1JNQVRfWTIxMjoKLQljYXNlIERSTV9GT1JN
QVRfWTIxNjoKLQljYXNlIERSTV9GT1JNQVRfWFZZVTEyXzE2MTYxNjE2OgotCWNhc2UgRFJNX0ZP
Uk1BVF9YVllVMTYxNjE2MTY6Ci0JCWlmIChtb2RpZmllciA9PSBEUk1fRk9STUFUX01PRF9MSU5F
QVIgfHwKLQkJICAgIG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9YX1RJTEVEIHx8Ci0JCSAg
ICBtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRCkKLQkJCXJldHVybiB0cnVlOwot
CQlmYWxsdGhyb3VnaDsKLQlkZWZhdWx0OgotCQlyZXR1cm4gZmFsc2U7Ci0JfQotfQogCiBzdGF0
aWMgY29uc3Qgc3RydWN0IGRybV9wbGFuZV9mdW5jcyBnNHhfc3ByaXRlX2Z1bmNzID0gewogCS51
cGRhdGVfcGxhbmUgPSBkcm1fYXRvbWljX2hlbHBlcl91cGRhdGVfcGxhbmUsCkBAIC0zMTMyLDI1
MSArMjA0OCw2IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX3BsYW5lX2Z1bmNzIHZsdl9zcHJp
dGVfZnVuY3MgPSB7CiAJLmZvcm1hdF9tb2Rfc3VwcG9ydGVkID0gdmx2X3Nwcml0ZV9mb3JtYXRf
bW9kX3N1cHBvcnRlZCwKIH07CiAKLXN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX3BsYW5lX2Z1bmNz
IHNrbF9wbGFuZV9mdW5jcyA9IHsKLQkudXBkYXRlX3BsYW5lID0gZHJtX2F0b21pY19oZWxwZXJf
dXBkYXRlX3BsYW5lLAotCS5kaXNhYmxlX3BsYW5lID0gZHJtX2F0b21pY19oZWxwZXJfZGlzYWJs
ZV9wbGFuZSwKLQkuZGVzdHJveSA9IGludGVsX3BsYW5lX2Rlc3Ryb3ksCi0JLmF0b21pY19kdXBs
aWNhdGVfc3RhdGUgPSBpbnRlbF9wbGFuZV9kdXBsaWNhdGVfc3RhdGUsCi0JLmF0b21pY19kZXN0
cm95X3N0YXRlID0gaW50ZWxfcGxhbmVfZGVzdHJveV9zdGF0ZSwKLQkuZm9ybWF0X21vZF9zdXBw
b3J0ZWQgPSBza2xfcGxhbmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQsCi19OwotCi1zdGF0aWMgY29u
c3Qgc3RydWN0IGRybV9wbGFuZV9mdW5jcyBnZW4xMl9wbGFuZV9mdW5jcyA9IHsKLQkudXBkYXRl
X3BsYW5lID0gZHJtX2F0b21pY19oZWxwZXJfdXBkYXRlX3BsYW5lLAotCS5kaXNhYmxlX3BsYW5l
ID0gZHJtX2F0b21pY19oZWxwZXJfZGlzYWJsZV9wbGFuZSwKLQkuZGVzdHJveSA9IGludGVsX3Bs
YW5lX2Rlc3Ryb3ksCi0JLmF0b21pY19kdXBsaWNhdGVfc3RhdGUgPSBpbnRlbF9wbGFuZV9kdXBs
aWNhdGVfc3RhdGUsCi0JLmF0b21pY19kZXN0cm95X3N0YXRlID0gaW50ZWxfcGxhbmVfZGVzdHJv
eV9zdGF0ZSwKLQkuZm9ybWF0X21vZF9zdXBwb3J0ZWQgPSBnZW4xMl9wbGFuZV9mb3JtYXRfbW9k
X3N1cHBvcnRlZCwKLX07Ci0KLXN0YXRpYyBib29sIHNrbF9wbGFuZV9oYXNfZmJjKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCSAgICAgIGVudW0gcGlwZSBwaXBlLCBlbnVt
IHBsYW5lX2lkIHBsYW5lX2lkKQotewotCWlmICghSEFTX0ZCQyhkZXZfcHJpdikpCi0JCXJldHVy
biBmYWxzZTsKLQotCXJldHVybiBwaXBlID09IFBJUEVfQSAmJiBwbGFuZV9pZCA9PSBQTEFORV9Q
UklNQVJZOwotfQotCi1zdGF0aWMgYm9vbCBza2xfcGxhbmVfaGFzX3BsYW5hcihzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCi0JCQkJIGVudW0gcGlwZSBwaXBlLCBlbnVtIHBsYW5l
X2lkIHBsYW5lX2lkKQotewotCS8qIERpc3BsYXkgV0EgIzA4NzA6IHNrbCwgYnh0ICovCi0JaWYg
KElTX1NLWUxBS0UoZGV2X3ByaXYpIHx8IElTX0JST1hUT04oZGV2X3ByaXYpKQotCQlyZXR1cm4g
ZmFsc2U7Ci0KLQlpZiAoSVNfR0VOKGRldl9wcml2LCA5KSAmJiAhSVNfR0VNSU5JTEFLRShkZXZf
cHJpdikgJiYgcGlwZSA9PSBQSVBFX0MpCi0JCXJldHVybiBmYWxzZTsKLQotCWlmIChwbGFuZV9p
ZCAhPSBQTEFORV9QUklNQVJZICYmIHBsYW5lX2lkICE9IFBMQU5FX1NQUklURTApCi0JCXJldHVy
biBmYWxzZTsKLQotCXJldHVybiB0cnVlOwotfQotCi1zdGF0aWMgY29uc3QgdTMyICpza2xfZ2V0
X3BsYW5lX2Zvcm1hdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAotCQkJCQll
bnVtIHBpcGUgcGlwZSwgZW51bSBwbGFuZV9pZCBwbGFuZV9pZCwKLQkJCQkJaW50ICpudW1fZm9y
bWF0cykKLXsKLQlpZiAoc2tsX3BsYW5lX2hhc19wbGFuYXIoZGV2X3ByaXYsIHBpcGUsIHBsYW5l
X2lkKSkgewotCQkqbnVtX2Zvcm1hdHMgPSBBUlJBWV9TSVpFKHNrbF9wbGFuYXJfZm9ybWF0cyk7
Ci0JCXJldHVybiBza2xfcGxhbmFyX2Zvcm1hdHM7Ci0JfSBlbHNlIHsKLQkJKm51bV9mb3JtYXRz
ID0gQVJSQVlfU0laRShza2xfcGxhbmVfZm9ybWF0cyk7Ci0JCXJldHVybiBza2xfcGxhbmVfZm9y
bWF0czsKLQl9Ci19Ci0KLXN0YXRpYyBjb25zdCB1MzIgKmdsa19nZXRfcGxhbmVfZm9ybWF0cyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCi0JCQkJCWVudW0gcGlwZSBwaXBlLCBl
bnVtIHBsYW5lX2lkIHBsYW5lX2lkLAotCQkJCQlpbnQgKm51bV9mb3JtYXRzKQotewotCWlmIChz
a2xfcGxhbmVfaGFzX3BsYW5hcihkZXZfcHJpdiwgcGlwZSwgcGxhbmVfaWQpKSB7Ci0JCSpudW1f
Zm9ybWF0cyA9IEFSUkFZX1NJWkUoZ2xrX3BsYW5hcl9mb3JtYXRzKTsKLQkJcmV0dXJuIGdsa19w
bGFuYXJfZm9ybWF0czsKLQl9IGVsc2UgewotCQkqbnVtX2Zvcm1hdHMgPSBBUlJBWV9TSVpFKHNr
bF9wbGFuZV9mb3JtYXRzKTsKLQkJcmV0dXJuIHNrbF9wbGFuZV9mb3JtYXRzOwotCX0KLX0KLQot
c3RhdGljIGNvbnN0IHUzMiAqaWNsX2dldF9wbGFuZV9mb3JtYXRzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKLQkJCQkJZW51bSBwaXBlIHBpcGUsIGVudW0gcGxhbmVfaWQgcGxh
bmVfaWQsCi0JCQkJCWludCAqbnVtX2Zvcm1hdHMpCi17Ci0JaWYgKGljbF9pc19oZHJfcGxhbmUo
ZGV2X3ByaXYsIHBsYW5lX2lkKSkgewotCQkqbnVtX2Zvcm1hdHMgPSBBUlJBWV9TSVpFKGljbF9o
ZHJfcGxhbmVfZm9ybWF0cyk7Ci0JCXJldHVybiBpY2xfaGRyX3BsYW5lX2Zvcm1hdHM7Ci0JfSBl
bHNlIGlmIChpY2xfaXNfbnYxMl95X3BsYW5lKGRldl9wcml2LCBwbGFuZV9pZCkpIHsKLQkJKm51
bV9mb3JtYXRzID0gQVJSQVlfU0laRShpY2xfc2RyX3lfcGxhbmVfZm9ybWF0cyk7Ci0JCXJldHVy
biBpY2xfc2RyX3lfcGxhbmVfZm9ybWF0czsKLQl9IGVsc2UgewotCQkqbnVtX2Zvcm1hdHMgPSBB
UlJBWV9TSVpFKGljbF9zZHJfdXZfcGxhbmVfZm9ybWF0cyk7Ci0JCXJldHVybiBpY2xfc2RyX3V2
X3BsYW5lX2Zvcm1hdHM7Ci0JfQotfQotCi1zdGF0aWMgY29uc3QgdTY0ICpnZW4xMl9nZXRfcGxh
bmVfbW9kaWZpZXJzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCQkJICAg
IGVudW0gcGxhbmVfaWQgcGxhbmVfaWQpCi17Ci0JaWYgKGdlbjEyX3BsYW5lX3N1cHBvcnRzX21j
X2NjcyhkZXZfcHJpdiwgcGxhbmVfaWQpKQotCQlyZXR1cm4gZ2VuMTJfcGxhbmVfZm9ybWF0X21v
ZGlmaWVyc19tY19jY3M7Ci0JZWxzZQotCQlyZXR1cm4gZ2VuMTJfcGxhbmVfZm9ybWF0X21vZGlm
aWVyc19yY19jY3M7Ci19Ci0KLXN0YXRpYyBib29sIHNrbF9wbGFuZV9oYXNfY2NzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCSAgICAgIGVudW0gcGlwZSBwaXBlLCBlbnVt
IHBsYW5lX2lkIHBsYW5lX2lkKQotewotCWlmIChwbGFuZV9pZCA9PSBQTEFORV9DVVJTT1IpCi0J
CXJldHVybiBmYWxzZTsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwKQotCQlyZXR1
cm4gdHJ1ZTsKLQotCWlmIChJU19HRU1JTklMQUtFKGRldl9wcml2KSkKLQkJcmV0dXJuIHBpcGUg
IT0gUElQRV9DOwotCi0JcmV0dXJuIHBpcGUgIT0gUElQRV9DICYmCi0JCShwbGFuZV9pZCA9PSBQ
TEFORV9QUklNQVJZIHx8Ci0JCSBwbGFuZV9pZCA9PSBQTEFORV9TUFJJVEUwKTsKLX0KLQotc3Ry
dWN0IGludGVsX3BsYW5lICoKLXNrbF91bml2ZXJzYWxfcGxhbmVfY3JlYXRlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCSAgIGVudW0gcGlwZSBwaXBlLCBlbnVtIHBsYW5l
X2lkIHBsYW5lX2lkKQotewotCWNvbnN0IHN0cnVjdCBkcm1fcGxhbmVfZnVuY3MgKnBsYW5lX2Z1
bmNzOwotCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmU7Ci0JZW51bSBkcm1fcGxhbmVfdHlwZSBw
bGFuZV90eXBlOwotCXVuc2lnbmVkIGludCBzdXBwb3J0ZWRfcm90YXRpb25zOwotCXVuc2lnbmVk
IGludCBzdXBwb3J0ZWRfY3NjOwotCWNvbnN0IHU2NCAqbW9kaWZpZXJzOwotCWNvbnN0IHUzMiAq
Zm9ybWF0czsKLQlpbnQgbnVtX2Zvcm1hdHM7Ci0JaW50IHJldDsKLQotCXBsYW5lID0gaW50ZWxf
cGxhbmVfYWxsb2MoKTsKLQlpZiAoSVNfRVJSKHBsYW5lKSkKLQkJcmV0dXJuIHBsYW5lOwotCi0J
cGxhbmUtPnBpcGUgPSBwaXBlOwotCXBsYW5lLT5pZCA9IHBsYW5lX2lkOwotCXBsYW5lLT5mcm9u
dGJ1ZmZlcl9iaXQgPSBJTlRFTF9GUk9OVEJVRkZFUihwaXBlLCBwbGFuZV9pZCk7Ci0KLQlwbGFu
ZS0+aGFzX2ZiYyA9IHNrbF9wbGFuZV9oYXNfZmJjKGRldl9wcml2LCBwaXBlLCBwbGFuZV9pZCk7
Ci0JaWYgKHBsYW5lLT5oYXNfZmJjKSB7Ci0JCXN0cnVjdCBpbnRlbF9mYmMgKmZiYyA9ICZkZXZf
cHJpdi0+ZmJjOwotCi0JCWZiYy0+cG9zc2libGVfZnJhbWVidWZmZXJfYml0cyB8PSBwbGFuZS0+
ZnJvbnRidWZmZXJfYml0OwotCX0KLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKSB7
Ci0JCXBsYW5lLT5taW5fd2lkdGggPSBpY2xfcGxhbmVfbWluX3dpZHRoOwotCQlwbGFuZS0+bWF4
X3dpZHRoID0gaWNsX3BsYW5lX21heF93aWR0aDsKLQkJcGxhbmUtPm1heF9oZWlnaHQgPSBpY2xf
cGxhbmVfbWF4X2hlaWdodDsKLQl9IGVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAg
fHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpIHsKLQkJcGxhbmUtPm1heF93aWR0aCA9IGdsa19w
bGFuZV9tYXhfd2lkdGg7Ci0JCXBsYW5lLT5tYXhfaGVpZ2h0ID0gc2tsX3BsYW5lX21heF9oZWln
aHQ7Ci0JfSBlbHNlIHsKLQkJcGxhbmUtPm1heF93aWR0aCA9IHNrbF9wbGFuZV9tYXhfd2lkdGg7
Ci0JCXBsYW5lLT5tYXhfaGVpZ2h0ID0gc2tsX3BsYW5lX21heF9oZWlnaHQ7Ci0JfQotCi0JcGxh
bmUtPm1heF9zdHJpZGUgPSBza2xfcGxhbmVfbWF4X3N0cmlkZTsKLQlwbGFuZS0+dXBkYXRlX3Bs
YW5lID0gc2tsX3VwZGF0ZV9wbGFuZTsKLQlwbGFuZS0+ZGlzYWJsZV9wbGFuZSA9IHNrbF9kaXNh
YmxlX3BsYW5lOwotCXBsYW5lLT5nZXRfaHdfc3RhdGUgPSBza2xfcGxhbmVfZ2V0X2h3X3N0YXRl
OwotCXBsYW5lLT5jaGVja19wbGFuZSA9IHNrbF9wbGFuZV9jaGVjazsKLQlwbGFuZS0+bWluX2Nk
Y2xrID0gc2tsX3BsYW5lX21pbl9jZGNsazsKLQlwbGFuZS0+YXN5bmNfZmxpcCA9IHNrbF9wbGFu
ZV9hc3luY19mbGlwOwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCi0JCWZvcm1h
dHMgPSBpY2xfZ2V0X3BsYW5lX2Zvcm1hdHMoZGV2X3ByaXYsIHBpcGUsCi0JCQkJCQlwbGFuZV9p
ZCwgJm51bV9mb3JtYXRzKTsKLQllbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8
IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKQotCQlmb3JtYXRzID0gZ2xrX2dldF9wbGFuZV9mb3Jt
YXRzKGRldl9wcml2LCBwaXBlLAotCQkJCQkJcGxhbmVfaWQsICZudW1fZm9ybWF0cyk7Ci0JZWxz
ZQotCQlmb3JtYXRzID0gc2tsX2dldF9wbGFuZV9mb3JtYXRzKGRldl9wcml2LCBwaXBlLAotCQkJ
CQkJcGxhbmVfaWQsICZudW1fZm9ybWF0cyk7Ci0KLQlwbGFuZS0+aGFzX2NjcyA9IHNrbF9wbGFu
ZV9oYXNfY2NzKGRldl9wcml2LCBwaXBlLCBwbGFuZV9pZCk7Ci0JaWYgKElOVEVMX0dFTihkZXZf
cHJpdikgPj0gMTIpIHsKLQkJbW9kaWZpZXJzID0gZ2VuMTJfZ2V0X3BsYW5lX21vZGlmaWVycyhk
ZXZfcHJpdiwgcGxhbmVfaWQpOwotCQlwbGFuZV9mdW5jcyA9ICZnZW4xMl9wbGFuZV9mdW5jczsK
LQl9IGVsc2UgewotCQlpZiAocGxhbmUtPmhhc19jY3MpCi0JCQltb2RpZmllcnMgPSBza2xfcGxh
bmVfZm9ybWF0X21vZGlmaWVyc19jY3M7Ci0JCWVsc2UKLQkJCW1vZGlmaWVycyA9IHNrbF9wbGFu
ZV9mb3JtYXRfbW9kaWZpZXJzX25vY2NzOwotCQlwbGFuZV9mdW5jcyA9ICZza2xfcGxhbmVfZnVu
Y3M7Ci0JfQotCi0JaWYgKHBsYW5lX2lkID09IFBMQU5FX1BSSU1BUlkpCi0JCXBsYW5lX3R5cGUg
PSBEUk1fUExBTkVfVFlQRV9QUklNQVJZOwotCWVsc2UKLQkJcGxhbmVfdHlwZSA9IERSTV9QTEFO
RV9UWVBFX09WRVJMQVk7Ci0KLQlyZXQgPSBkcm1fdW5pdmVyc2FsX3BsYW5lX2luaXQoJmRldl9w
cml2LT5kcm0sICZwbGFuZS0+YmFzZSwKLQkJCQkgICAgICAgMCwgcGxhbmVfZnVuY3MsCi0JCQkJ
ICAgICAgIGZvcm1hdHMsIG51bV9mb3JtYXRzLCBtb2RpZmllcnMsCi0JCQkJICAgICAgIHBsYW5l
X3R5cGUsCi0JCQkJICAgICAgICJwbGFuZSAlZCVjIiwgcGxhbmVfaWQgKyAxLAotCQkJCSAgICAg
ICBwaXBlX25hbWUocGlwZSkpOwotCWlmIChyZXQpCi0JCWdvdG8gZmFpbDsKLQotCXN1cHBvcnRl
ZF9yb3RhdGlvbnMgPQotCQlEUk1fTU9ERV9ST1RBVEVfMCB8IERSTV9NT0RFX1JPVEFURV85MCB8
Ci0JCURSTV9NT0RFX1JPVEFURV8xODAgfCBEUk1fTU9ERV9ST1RBVEVfMjcwOwotCi0JaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPj0gMTApCi0JCXN1cHBvcnRlZF9yb3RhdGlvbnMgfD0gRFJNX01P
REVfUkVGTEVDVF9YOwotCi0JZHJtX3BsYW5lX2NyZWF0ZV9yb3RhdGlvbl9wcm9wZXJ0eSgmcGxh
bmUtPmJhc2UsCi0JCQkJCSAgIERSTV9NT0RFX1JPVEFURV8wLAotCQkJCQkgICBzdXBwb3J0ZWRf
cm90YXRpb25zKTsKLQotCXN1cHBvcnRlZF9jc2MgPSBCSVQoRFJNX0NPTE9SX1lDQkNSX0JUNjAx
KSB8IEJJVChEUk1fQ09MT1JfWUNCQ1JfQlQ3MDkpOwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJp
dikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCi0JCXN1cHBvcnRlZF9jc2MgfD0g
QklUKERSTV9DT0xPUl9ZQ0JDUl9CVDIwMjApOwotCi0JZHJtX3BsYW5lX2NyZWF0ZV9jb2xvcl9w
cm9wZXJ0aWVzKCZwbGFuZS0+YmFzZSwKLQkJCQkJICBzdXBwb3J0ZWRfY3NjLAotCQkJCQkgIEJJ
VChEUk1fQ09MT1JfWUNCQ1JfTElNSVRFRF9SQU5HRSkgfAotCQkJCQkgIEJJVChEUk1fQ09MT1Jf
WUNCQ1JfRlVMTF9SQU5HRSksCi0JCQkJCSAgRFJNX0NPTE9SX1lDQkNSX0JUNzA5LAotCQkJCQkg
IERSTV9DT0xPUl9ZQ0JDUl9MSU1JVEVEX1JBTkdFKTsKLQotCWRybV9wbGFuZV9jcmVhdGVfYWxw
aGFfcHJvcGVydHkoJnBsYW5lLT5iYXNlKTsKLQlkcm1fcGxhbmVfY3JlYXRlX2JsZW5kX21vZGVf
cHJvcGVydHkoJnBsYW5lLT5iYXNlLAotCQkJCQkgICAgIEJJVChEUk1fTU9ERV9CTEVORF9QSVhF
TF9OT05FKSB8Ci0JCQkJCSAgICAgQklUKERSTV9NT0RFX0JMRU5EX1BSRU1VTFRJKSB8Ci0JCQkJ
CSAgICAgQklUKERSTV9NT0RFX0JMRU5EX0NPVkVSQUdFKSk7Ci0KLQlkcm1fcGxhbmVfY3JlYXRl
X3pwb3NfaW1tdXRhYmxlX3Byb3BlcnR5KCZwbGFuZS0+YmFzZSwgcGxhbmVfaWQpOwotCi0JaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpCi0JCWRybV9wbGFuZV9lbmFibGVfZmJfZGFtYWdl
X2NsaXBzKCZwbGFuZS0+YmFzZSk7Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCkK
LQkJZHJtX3BsYW5lX2NyZWF0ZV9zY2FsaW5nX2ZpbHRlcl9wcm9wZXJ0eSgmcGxhbmUtPmJhc2Us
Ci0JCQkJCQlCSVQoRFJNX1NDQUxJTkdfRklMVEVSX0RFRkFVTFQpIHwKLQkJCQkJCUJJVChEUk1f
U0NBTElOR19GSUxURVJfTkVBUkVTVF9ORUlHSEJPUikpOwotCi0JZHJtX3BsYW5lX2hlbHBlcl9h
ZGQoJnBsYW5lLT5iYXNlLCAmaW50ZWxfcGxhbmVfaGVscGVyX2Z1bmNzKTsKLQotCXJldHVybiBw
bGFuZTsKLQotZmFpbDoKLQlpbnRlbF9wbGFuZV9mcmVlKHBsYW5lKTsKLQotCXJldHVybiBFUlJf
UFRSKHJldCk7Ci19Ci0KIHN0cnVjdCBpbnRlbF9wbGFuZSAqCiBpbnRlbF9zcHJpdGVfcGxhbmVf
Y3JlYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCSAgZW51bSBwaXBl
IHBpcGUsIGludCBzcHJpdGUpCkBAIC0zMzg5LDEwICsyMDYwLDYgQEAgaW50ZWxfc3ByaXRlX3Bs
YW5lX2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaW50IG51bV9m
b3JtYXRzOwogCWludCByZXQsIHpwb3M7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5
KQotCQlyZXR1cm4gc2tsX3VuaXZlcnNhbF9wbGFuZV9jcmVhdGUoZGV2X3ByaXYsIHBpcGUsCi0J
CQkJCQkgIFBMQU5FX1NQUklURTAgKyBzcHJpdGUpOwotCiAJcGxhbmUgPSBpbnRlbF9wbGFuZV9h
bGxvYygpOwogCWlmIChJU19FUlIocGxhbmUpKQogCQlyZXR1cm4gcGxhbmU7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5oIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuaAppbmRleCA3NjEyNmRkOGQ1ODQuLjQx
ODg5N2Y5NTNmYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9zcHJpdGUuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0
ZS5oCkBAIC0zOCw5ICszOCw2IEBAIHZvaWQgaW50ZWxfcGlwZV91cGRhdGVfZW5kKHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSk7CiBpbnQgaW50ZWxfcGxhbmVfY2hlY2tf
c3RyaWRlKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpOwogaW50
IGludGVsX3BsYW5lX2NoZWNrX3NyY19jb29yZGluYXRlcyhzdHJ1Y3QgaW50ZWxfcGxhbmVfc3Rh
dGUgKnBsYW5lX3N0YXRlKTsKIGludCBjaHZfcGxhbmVfY2hlY2tfcm90YXRpb24oY29uc3Qgc3Ry
dWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSk7Ci1zdHJ1Y3QgaW50ZWxfcGxhbmUg
Kgotc2tsX3VuaXZlcnNhbF9wbGFuZV9jcmVhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAotCQkJICAgZW51bSBwaXBlIHBpcGUsIGVudW0gcGxhbmVfaWQgcGxhbmVfaWQpOwog
CiBzdGF0aWMgaW5saW5lIHU4IGljbF9oZHJfcGxhbmVfbWFzayh2b2lkKQogewpAQCAtNTksNCAr
NTYsNyBAQCBpbnQgaHN3X3BsYW5lX21pbl9jZGNsayhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSwKIGludCB2bHZfcGxhbmVfbWluX2NkY2xrKGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJY29uc3Qgc3RydWN0IGludGVsX3BsYW5l
X3N0YXRlICpwbGFuZV9zdGF0ZSk7CiAKK3ZvaWQgc2tsX3Byb2dyYW1fc2NhbGVyKHN0cnVjdCBp
bnRlbF9wbGFuZSAqcGxhbmUsCisJCQljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSwKKwkJCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUp
OwogI2VuZGlmIC8qIF9fSU5URUxfU1BSSVRFX0hfXyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9za2xfdW5pdmVyc2FsX3BsYW5lLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L3NrbF91bml2ZXJzYWxfcGxhbmUuYwpuZXcgZmlsZSBtb2RlIDEwMDY0
NAppbmRleCAwMDAwMDAwMDAwMDAuLmY5NjU5MDc5YWMxOAotLS0gL2Rldi9udWxsCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvc2tsX3VuaXZlcnNhbF9wbGFuZS5jCkBAIC0wLDAg
KzEsMjI2MyBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAorLyoKKyAqIENvcHly
aWdodCDCqSAyMDIwIEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2luY2x1ZGUgPGRybS9kcm1f
YXRvbWljX2hlbHBlci5oPgorI2luY2x1ZGUgPGRybS9kcm1fZGFtYWdlX2hlbHBlci5oPgorI2lu
Y2x1ZGUgPGRybS9kcm1fZm91cmNjLmg+CisjaW5jbHVkZSA8ZHJtL2RybV9wbGFuZV9oZWxwZXIu
aD4KKworI2luY2x1ZGUgImk5MTVfZHJ2LmgiCisjaW5jbHVkZSAiaW50ZWxfYXRvbWljX3BsYW5l
LmgiCisjaW5jbHVkZSAiaW50ZWxfZGlzcGxheV90eXBlcy5oIgorI2luY2x1ZGUgImludGVsX3Bt
LmgiCisjaW5jbHVkZSAiaW50ZWxfcHNyLmgiCisjaW5jbHVkZSAiaW50ZWxfc3ByaXRlLmgiCisj
aW5jbHVkZSAic2tsX3VuaXZlcnNhbF9wbGFuZS5oIgorCitzdGF0aWMgY29uc3QgdTMyIHNrbF9w
bGFuZV9mb3JtYXRzW10gPSB7CisJRFJNX0ZPUk1BVF9DOCwKKwlEUk1fRk9STUFUX1JHQjU2NSwK
KwlEUk1fRk9STUFUX1hSR0I4ODg4LAorCURSTV9GT1JNQVRfWEJHUjg4ODgsCisJRFJNX0ZPUk1B
VF9BUkdCODg4OCwKKwlEUk1fRk9STUFUX0FCR1I4ODg4LAorCURSTV9GT1JNQVRfWFJHQjIxMDEw
MTAsCisJRFJNX0ZPUk1BVF9YQkdSMjEwMTAxMCwKKwlEUk1fRk9STUFUX1hSR0IxNjE2MTYxNkYs
CisJRFJNX0ZPUk1BVF9YQkdSMTYxNjE2MTZGLAorCURSTV9GT1JNQVRfWVVZViwKKwlEUk1fRk9S
TUFUX1lWWVUsCisJRFJNX0ZPUk1BVF9VWVZZLAorCURSTV9GT1JNQVRfVllVWSwKKwlEUk1fRk9S
TUFUX1hZVVY4ODg4LAorfTsKKworc3RhdGljIGNvbnN0IHUzMiBza2xfcGxhbmFyX2Zvcm1hdHNb
XSA9IHsKKwlEUk1fRk9STUFUX0M4LAorCURSTV9GT1JNQVRfUkdCNTY1LAorCURSTV9GT1JNQVRf
WFJHQjg4ODgsCisJRFJNX0ZPUk1BVF9YQkdSODg4OCwKKwlEUk1fRk9STUFUX0FSR0I4ODg4LAor
CURSTV9GT1JNQVRfQUJHUjg4ODgsCisJRFJNX0ZPUk1BVF9YUkdCMjEwMTAxMCwKKwlEUk1fRk9S
TUFUX1hCR1IyMTAxMDEwLAorCURSTV9GT1JNQVRfWFJHQjE2MTYxNjE2RiwKKwlEUk1fRk9STUFU
X1hCR1IxNjE2MTYxNkYsCisJRFJNX0ZPUk1BVF9ZVVlWLAorCURSTV9GT1JNQVRfWVZZVSwKKwlE
Uk1fRk9STUFUX1VZVlksCisJRFJNX0ZPUk1BVF9WWVVZLAorCURSTV9GT1JNQVRfTlYxMiwKKwlE
Uk1fRk9STUFUX1hZVVY4ODg4LAorfTsKKworc3RhdGljIGNvbnN0IHUzMiBnbGtfcGxhbmFyX2Zv
cm1hdHNbXSA9IHsKKwlEUk1fRk9STUFUX0M4LAorCURSTV9GT1JNQVRfUkdCNTY1LAorCURSTV9G
T1JNQVRfWFJHQjg4ODgsCisJRFJNX0ZPUk1BVF9YQkdSODg4OCwKKwlEUk1fRk9STUFUX0FSR0I4
ODg4LAorCURSTV9GT1JNQVRfQUJHUjg4ODgsCisJRFJNX0ZPUk1BVF9YUkdCMjEwMTAxMCwKKwlE
Uk1fRk9STUFUX1hCR1IyMTAxMDEwLAorCURSTV9GT1JNQVRfWFJHQjE2MTYxNjE2RiwKKwlEUk1f
Rk9STUFUX1hCR1IxNjE2MTYxNkYsCisJRFJNX0ZPUk1BVF9ZVVlWLAorCURSTV9GT1JNQVRfWVZZ
VSwKKwlEUk1fRk9STUFUX1VZVlksCisJRFJNX0ZPUk1BVF9WWVVZLAorCURSTV9GT1JNQVRfTlYx
MiwKKwlEUk1fRk9STUFUX1hZVVY4ODg4LAorCURSTV9GT1JNQVRfUDAxMCwKKwlEUk1fRk9STUFU
X1AwMTIsCisJRFJNX0ZPUk1BVF9QMDE2LAorfTsKKworc3RhdGljIGNvbnN0IHUzMiBpY2xfc2Ry
X3lfcGxhbmVfZm9ybWF0c1tdID0geworCURSTV9GT1JNQVRfQzgsCisJRFJNX0ZPUk1BVF9SR0I1
NjUsCisJRFJNX0ZPUk1BVF9YUkdCODg4OCwKKwlEUk1fRk9STUFUX1hCR1I4ODg4LAorCURSTV9G
T1JNQVRfQVJHQjg4ODgsCisJRFJNX0ZPUk1BVF9BQkdSODg4OCwKKwlEUk1fRk9STUFUX1hSR0Iy
MTAxMDEwLAorCURSTV9GT1JNQVRfWEJHUjIxMDEwMTAsCisJRFJNX0ZPUk1BVF9BUkdCMjEwMTAx
MCwKKwlEUk1fRk9STUFUX0FCR1IyMTAxMDEwLAorCURSTV9GT1JNQVRfWVVZViwKKwlEUk1fRk9S
TUFUX1lWWVUsCisJRFJNX0ZPUk1BVF9VWVZZLAorCURSTV9GT1JNQVRfVllVWSwKKwlEUk1fRk9S
TUFUX1kyMTAsCisJRFJNX0ZPUk1BVF9ZMjEyLAorCURSTV9GT1JNQVRfWTIxNiwKKwlEUk1fRk9S
TUFUX1hZVVY4ODg4LAorCURSTV9GT1JNQVRfWFZZVTIxMDEwMTAsCisJRFJNX0ZPUk1BVF9YVllV
MTJfMTYxNjE2MTYsCisJRFJNX0ZPUk1BVF9YVllVMTYxNjE2MTYsCit9OworCitzdGF0aWMgY29u
c3QgdTMyIGljbF9zZHJfdXZfcGxhbmVfZm9ybWF0c1tdID0geworCURSTV9GT1JNQVRfQzgsCisJ
RFJNX0ZPUk1BVF9SR0I1NjUsCisJRFJNX0ZPUk1BVF9YUkdCODg4OCwKKwlEUk1fRk9STUFUX1hC
R1I4ODg4LAorCURSTV9GT1JNQVRfQVJHQjg4ODgsCisJRFJNX0ZPUk1BVF9BQkdSODg4OCwKKwlE
Uk1fRk9STUFUX1hSR0IyMTAxMDEwLAorCURSTV9GT1JNQVRfWEJHUjIxMDEwMTAsCisJRFJNX0ZP
Uk1BVF9BUkdCMjEwMTAxMCwKKwlEUk1fRk9STUFUX0FCR1IyMTAxMDEwLAorCURSTV9GT1JNQVRf
WVVZViwKKwlEUk1fRk9STUFUX1lWWVUsCisJRFJNX0ZPUk1BVF9VWVZZLAorCURSTV9GT1JNQVRf
VllVWSwKKwlEUk1fRk9STUFUX05WMTIsCisJRFJNX0ZPUk1BVF9QMDEwLAorCURSTV9GT1JNQVRf
UDAxMiwKKwlEUk1fRk9STUFUX1AwMTYsCisJRFJNX0ZPUk1BVF9ZMjEwLAorCURSTV9GT1JNQVRf
WTIxMiwKKwlEUk1fRk9STUFUX1kyMTYsCisJRFJNX0ZPUk1BVF9YWVVWODg4OCwKKwlEUk1fRk9S
TUFUX1hWWVUyMTAxMDEwLAorCURSTV9GT1JNQVRfWFZZVTEyXzE2MTYxNjE2LAorCURSTV9GT1JN
QVRfWFZZVTE2MTYxNjE2LAorfTsKKworc3RhdGljIGNvbnN0IHUzMiBpY2xfaGRyX3BsYW5lX2Zv
cm1hdHNbXSA9IHsKKwlEUk1fRk9STUFUX0M4LAorCURSTV9GT1JNQVRfUkdCNTY1LAorCURSTV9G
T1JNQVRfWFJHQjg4ODgsCisJRFJNX0ZPUk1BVF9YQkdSODg4OCwKKwlEUk1fRk9STUFUX0FSR0I4
ODg4LAorCURSTV9GT1JNQVRfQUJHUjg4ODgsCisJRFJNX0ZPUk1BVF9YUkdCMjEwMTAxMCwKKwlE
Uk1fRk9STUFUX1hCR1IyMTAxMDEwLAorCURSTV9GT1JNQVRfQVJHQjIxMDEwMTAsCisJRFJNX0ZP
Uk1BVF9BQkdSMjEwMTAxMCwKKwlEUk1fRk9STUFUX1hSR0IxNjE2MTYxNkYsCisJRFJNX0ZPUk1B
VF9YQkdSMTYxNjE2MTZGLAorCURSTV9GT1JNQVRfQVJHQjE2MTYxNjE2RiwKKwlEUk1fRk9STUFU
X0FCR1IxNjE2MTYxNkYsCisJRFJNX0ZPUk1BVF9ZVVlWLAorCURSTV9GT1JNQVRfWVZZVSwKKwlE
Uk1fRk9STUFUX1VZVlksCisJRFJNX0ZPUk1BVF9WWVVZLAorCURSTV9GT1JNQVRfTlYxMiwKKwlE
Uk1fRk9STUFUX1AwMTAsCisJRFJNX0ZPUk1BVF9QMDEyLAorCURSTV9GT1JNQVRfUDAxNiwKKwlE
Uk1fRk9STUFUX1kyMTAsCisJRFJNX0ZPUk1BVF9ZMjEyLAorCURSTV9GT1JNQVRfWTIxNiwKKwlE
Uk1fRk9STUFUX1hZVVY4ODg4LAorCURSTV9GT1JNQVRfWFZZVTIxMDEwMTAsCisJRFJNX0ZPUk1B
VF9YVllVMTJfMTYxNjE2MTYsCisJRFJNX0ZPUk1BVF9YVllVMTYxNjE2MTYsCit9OworCitzdGF0
aWMgY29uc3QgdTY0IHNrbF9wbGFuZV9mb3JtYXRfbW9kaWZpZXJzX25vY2NzW10gPSB7CisJSTkx
NV9GT1JNQVRfTU9EX1lmX1RJTEVELAorCUk5MTVfRk9STUFUX01PRF9ZX1RJTEVELAorCUk5MTVf
Rk9STUFUX01PRF9YX1RJTEVELAorCURSTV9GT1JNQVRfTU9EX0xJTkVBUiwKKwlEUk1fRk9STUFU
X01PRF9JTlZBTElECit9OworCitzdGF0aWMgY29uc3QgdTY0IHNrbF9wbGFuZV9mb3JtYXRfbW9k
aWZpZXJzX2Njc1tdID0geworCUk5MTVfRk9STUFUX01PRF9ZZl9USUxFRF9DQ1MsCisJSTkxNV9G
T1JNQVRfTU9EX1lfVElMRURfQ0NTLAorCUk5MTVfRk9STUFUX01PRF9ZZl9USUxFRCwKKwlJOTE1
X0ZPUk1BVF9NT0RfWV9USUxFRCwKKwlJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRCwKKwlEUk1fRk9S
TUFUX01PRF9MSU5FQVIsCisJRFJNX0ZPUk1BVF9NT0RfSU5WQUxJRAorfTsKKworc3RhdGljIGNv
bnN0IHU2NCBnZW4xMl9wbGFuZV9mb3JtYXRfbW9kaWZpZXJzX21jX2Njc1tdID0geworCUk5MTVf
Rk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX01DX0NDUywKKwlJOTE1X0ZPUk1BVF9NT0RfWV9USUxF
RF9HRU4xMl9SQ19DQ1MsCisJSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQsCisJSTkxNV9GT1JNQVRf
TU9EX1hfVElMRUQsCisJRFJNX0ZPUk1BVF9NT0RfTElORUFSLAorCURSTV9GT1JNQVRfTU9EX0lO
VkFMSUQKK307CisKK3N0YXRpYyBjb25zdCB1NjQgZ2VuMTJfcGxhbmVfZm9ybWF0X21vZGlmaWVy
c19yY19jY3NbXSA9IHsKKwlJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1MsCisJ
STkxNV9GT1JNQVRfTU9EX1lfVElMRUQsCisJSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQsCisJRFJN
X0ZPUk1BVF9NT0RfTElORUFSLAorCURSTV9GT1JNQVRfTU9EX0lOVkFMSUQKK307CisKK2ludCBz
a2xfZm9ybWF0X3RvX2ZvdXJjYyhpbnQgZm9ybWF0LCBib29sIHJnYl9vcmRlciwgYm9vbCBhbHBo
YSkKK3sKKwlzd2l0Y2ggKGZvcm1hdCkgeworCWNhc2UgUExBTkVfQ1RMX0ZPUk1BVF9SR0JfNTY1
OgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9SR0I1NjU7CisJY2FzZSBQTEFORV9DVExfRk9STUFUX05W
MTI6CisJCXJldHVybiBEUk1fRk9STUFUX05WMTI7CisJY2FzZSBQTEFORV9DVExfRk9STUFUX1hZ
VVY6CisJCXJldHVybiBEUk1fRk9STUFUX1hZVVY4ODg4OworCWNhc2UgUExBTkVfQ1RMX0ZPUk1B
VF9QMDEwOgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9QMDEwOworCWNhc2UgUExBTkVfQ1RMX0ZPUk1B
VF9QMDEyOgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9QMDEyOworCWNhc2UgUExBTkVfQ1RMX0ZPUk1B
VF9QMDE2OgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9QMDE2OworCWNhc2UgUExBTkVfQ1RMX0ZPUk1B
VF9ZMjEwOgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9ZMjEwOworCWNhc2UgUExBTkVfQ1RMX0ZPUk1B
VF9ZMjEyOgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9ZMjEyOworCWNhc2UgUExBTkVfQ1RMX0ZPUk1B
VF9ZMjE2OgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9ZMjE2OworCWNhc2UgUExBTkVfQ1RMX0ZPUk1B
VF9ZNDEwOgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9YVllVMjEwMTAxMDsKKwljYXNlIFBMQU5FX0NU
TF9GT1JNQVRfWTQxMjoKKwkJcmV0dXJuIERSTV9GT1JNQVRfWFZZVTEyXzE2MTYxNjE2OworCWNh
c2UgUExBTkVfQ1RMX0ZPUk1BVF9ZNDE2OgorCQlyZXR1cm4gRFJNX0ZPUk1BVF9YVllVMTYxNjE2
MTY7CisJZGVmYXVsdDoKKwljYXNlIFBMQU5FX0NUTF9GT1JNQVRfWFJHQl84ODg4OgorCQlpZiAo
cmdiX29yZGVyKSB7CisJCQlpZiAoYWxwaGEpCisJCQkJcmV0dXJuIERSTV9GT1JNQVRfQUJHUjg4
ODg7CisJCQllbHNlCisJCQkJcmV0dXJuIERSTV9GT1JNQVRfWEJHUjg4ODg7CisJCX0gZWxzZSB7
CisJCQlpZiAoYWxwaGEpCisJCQkJcmV0dXJuIERSTV9GT1JNQVRfQVJHQjg4ODg7CisJCQllbHNl
CisJCQkJcmV0dXJuIERSTV9GT1JNQVRfWFJHQjg4ODg7CisJCX0KKwljYXNlIFBMQU5FX0NUTF9G
T1JNQVRfWFJHQl8yMTAxMDEwOgorCQlpZiAocmdiX29yZGVyKSB7CisJCQlpZiAoYWxwaGEpCisJ
CQkJcmV0dXJuIERSTV9GT1JNQVRfQUJHUjIxMDEwMTA7CisJCQllbHNlCisJCQkJcmV0dXJuIERS
TV9GT1JNQVRfWEJHUjIxMDEwMTA7CisJCX0gZWxzZSB7CisJCQlpZiAoYWxwaGEpCisJCQkJcmV0
dXJuIERSTV9GT1JNQVRfQVJHQjIxMDEwMTA7CisJCQllbHNlCisJCQkJcmV0dXJuIERSTV9GT1JN
QVRfWFJHQjIxMDEwMTA7CisJCX0KKwljYXNlIFBMQU5FX0NUTF9GT1JNQVRfWFJHQl8xNjE2MTYx
NkY6CisJCWlmIChyZ2Jfb3JkZXIpIHsKKwkJCWlmIChhbHBoYSkKKwkJCQlyZXR1cm4gRFJNX0ZP
Uk1BVF9BQkdSMTYxNjE2MTZGOworCQkJZWxzZQorCQkJCXJldHVybiBEUk1fRk9STUFUX1hCR1Ix
NjE2MTYxNkY7CisJCX0gZWxzZSB7CisJCQlpZiAoYWxwaGEpCisJCQkJcmV0dXJuIERSTV9GT1JN
QVRfQVJHQjE2MTYxNjE2RjsKKwkJCWVsc2UKKwkJCQlyZXR1cm4gRFJNX0ZPUk1BVF9YUkdCMTYx
NjE2MTZGOworCQl9CisJfQorfQorCitzdGF0aWMgdTggaWNsX252MTJfeV9wbGFuZV9tYXNrKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQoreworCWlmIChJU19ST0NLRVRMQUtFKGk5MTUp
KQorCQlyZXR1cm4gQklUKFBMQU5FX1NQUklURTIpIHwgQklUKFBMQU5FX1NQUklURTMpOworCWVs
c2UKKwkJcmV0dXJuIEJJVChQTEFORV9TUFJJVEU0KSB8IEJJVChQTEFORV9TUFJJVEU1KTsKK30K
KworYm9vbCBpY2xfaXNfbnYxMl95X3BsYW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKKwkJCSBlbnVtIHBsYW5lX2lkIHBsYW5lX2lkKQoreworCXJldHVybiBJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDExICYmCisJCWljbF9udjEyX3lfcGxhbmVfbWFzayhkZXZfcHJpdikgJiBC
SVQocGxhbmVfaWQpOworfQorCitib29sIGljbF9pc19oZHJfcGxhbmUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBsYW5lX2lkIHBsYW5lX2lkKQoreworCXJldHVybiBJ
TlRFTF9HRU4oZGV2X3ByaXYpID49IDExICYmCisJCWljbF9oZHJfcGxhbmVfbWFzaygpICYgQklU
KHBsYW5lX2lkKTsKK30KKworc3RhdGljIHZvaWQKK3NrbF9wbGFuZV9yYXRpbyhjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJY29uc3Qgc3RydWN0IGludGVsX3Bs
YW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKKwkJdW5zaWduZWQgaW50ICpudW0sIHVuc2lnbmVkIGlu
dCAqZGVuKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
cGxhbmVfc3RhdGUtPnVhcGkucGxhbmUtPmRldik7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CisKKwlpZiAoZmItPmZvcm1hdC0+Y3BwWzBd
ID09IDgpIHsKKwkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFL
RShkZXZfcHJpdikpIHsKKwkJCSpudW0gPSAxMDsKKwkJCSpkZW4gPSA4OworCQl9IGVsc2Ugewor
CQkJKm51bSA9IDk7CisJCQkqZGVuID0gODsKKwkJfQorCX0gZWxzZSB7CisJCSpudW0gPSAxOwor
CQkqZGVuID0gMTsKKwl9Cit9CisKK3N0YXRpYyBpbnQgc2tsX3BsYW5lX21pbl9jZGNsayhjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCSAgICAgICBjb25zdCBz
dHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQoreworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUtPmRl
dik7CisJdW5zaWduZWQgaW50IG51bSwgZGVuOworCXVuc2lnbmVkIGludCBwaXhlbF9yYXRlID0g
aW50ZWxfcGxhbmVfcGl4ZWxfcmF0ZShjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7CisKKwlza2xf
cGxhbmVfcmF0aW8oY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUsICZudW0sICZkZW4pOworCisJLyog
dHdvIHBpeGVscyBwZXIgY2xvY2sgb24gZ2xrKyAqLworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
ID49IDEwIHx8IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKQorCQlkZW4gKj0gMjsKKworCXJldHVy
biBESVZfUk9VTkRfVVAocGl4ZWxfcmF0ZSAqIG51bSwgZGVuKTsKK30KKworc3RhdGljIGludCBz
a2xfcGxhbmVfbWF4X3dpZHRoKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAorCQkJ
ICAgICAgIGludCBjb2xvcl9wbGFuZSwKKwkJCSAgICAgICB1bnNpZ25lZCBpbnQgcm90YXRpb24p
Cit7CisJaW50IGNwcCA9IGZiLT5mb3JtYXQtPmNwcFtjb2xvcl9wbGFuZV07CisKKwlzd2l0Y2gg
KGZiLT5tb2RpZmllcikgeworCWNhc2UgRFJNX0ZPUk1BVF9NT0RfTElORUFSOgorCWNhc2UgSTkx
NV9GT1JNQVRfTU9EX1hfVElMRUQ6CisJCS8qCisJCSAqIFZhbGlkYXRlZCBsaW1pdCBpcyA0aywg
YnV0IGhhcyA1ayBzaG91bGQKKwkJICogd29yayBhcGFydCBmcm9tIHRoZSBmb2xsb3dpbmcgZmVh
dHVyZXM6CisJCSAqIC0gWXRpbGUgKGFscmVhZHkgbGltaXRlZCB0byA0aykKKwkJICogLSBGUDE2
IChhbHJlYWR5IGxpbWl0ZWQgdG8gNGspCisJCSAqIC0gcmVuZGVyIGNvbXByZXNzaW9uIChhbHJl
YWR5IGxpbWl0ZWQgdG8gNGspCisJCSAqIC0gS1ZNUiBzcHJpdGUgYW5kIGN1cnNvciAoZG9uJ3Qg
Y2FyZSkKKwkJICogLSBob3Jpem9udGFsIHBhbm5pbmcgKFRPRE8gdmVyaWZ5IHRoaXMpCisJCSAq
IC0gcGlwZSBhbmQgcGxhbmUgc2NhbGluZyAoVE9ETyB2ZXJpZnkgdGhpcykKKwkJICovCisJCWlm
IChjcHAgPT0gOCkKKwkJCXJldHVybiA0MDk2OworCQllbHNlCisJCQlyZXR1cm4gNTEyMDsKKwlj
YXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUzoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9Z
Zl9USUxFRF9DQ1M6CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9NQ19DQ1M6
CisJCS8qIEZJWE1FIEFVWCBwbGFuZT8gKi8KKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVE
OgorCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEOgorCQlpZiAoY3BwID09IDgpCisJCQly
ZXR1cm4gMjA0ODsKKwkJZWxzZQorCQkJcmV0dXJuIDQwOTY7CisJZGVmYXVsdDoKKwkJTUlTU0lO
R19DQVNFKGZiLT5tb2RpZmllcik7CisJCXJldHVybiAyMDQ4OworCX0KK30KKworc3RhdGljIGlu
dCBnbGtfcGxhbmVfbWF4X3dpZHRoKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAor
CQkJICAgICAgIGludCBjb2xvcl9wbGFuZSwKKwkJCSAgICAgICB1bnNpZ25lZCBpbnQgcm90YXRp
b24pCit7CisJaW50IGNwcCA9IGZiLT5mb3JtYXQtPmNwcFtjb2xvcl9wbGFuZV07CisKKwlzd2l0
Y2ggKGZiLT5tb2RpZmllcikgeworCWNhc2UgRFJNX0ZPUk1BVF9NT0RfTElORUFSOgorCWNhc2Ug
STkxNV9GT1JNQVRfTU9EX1hfVElMRUQ6CisJCWlmIChjcHAgPT0gOCkKKwkJCXJldHVybiA0MDk2
OworCQllbHNlCisJCQlyZXR1cm4gNTEyMDsKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVE
X0NDUzoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRF9DQ1M6CisJCS8qIEZJWE1FIEFV
WCBwbGFuZT8gKi8KKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEOgorCWNhc2UgSTkxNV9G
T1JNQVRfTU9EX1lmX1RJTEVEOgorCQlpZiAoY3BwID09IDgpCisJCQlyZXR1cm4gMjA0ODsKKwkJ
ZWxzZQorCQkJcmV0dXJuIDUxMjA7CisJZGVmYXVsdDoKKwkJTUlTU0lOR19DQVNFKGZiLT5tb2Rp
Zmllcik7CisJCXJldHVybiAyMDQ4OworCX0KK30KKworc3RhdGljIGludCBpY2xfcGxhbmVfbWlu
X3dpZHRoKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAorCQkJICAgICAgIGludCBj
b2xvcl9wbGFuZSwKKwkJCSAgICAgICB1bnNpZ25lZCBpbnQgcm90YXRpb24pCit7CisJLyogV2Ff
MTQwMTEyNjQ2NTcsIFdhXzE0MDExMDUwNTYzOiBnZW4xMSsgKi8KKwlzd2l0Y2ggKGZiLT5mb3Jt
YXQtPmZvcm1hdCkgeworCWNhc2UgRFJNX0ZPUk1BVF9DODoKKwkJcmV0dXJuIDE4OworCWNhc2Ug
RFJNX0ZPUk1BVF9SR0I1NjU6CisJCXJldHVybiAxMDsKKwljYXNlIERSTV9GT1JNQVRfWFJHQjg4
ODg6CisJY2FzZSBEUk1fRk9STUFUX1hCR1I4ODg4OgorCWNhc2UgRFJNX0ZPUk1BVF9BUkdCODg4
ODoKKwljYXNlIERSTV9GT1JNQVRfQUJHUjg4ODg6CisJY2FzZSBEUk1fRk9STUFUX1hSR0IyMTAx
MDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9YQkdSMjEwMTAxMDoKKwljYXNlIERSTV9GT1JNQVRfQVJH
QjIxMDEwMTA6CisJY2FzZSBEUk1fRk9STUFUX0FCR1IyMTAxMDEwOgorCWNhc2UgRFJNX0ZPUk1B
VF9YVllVMjEwMTAxMDoKKwljYXNlIERSTV9GT1JNQVRfWTIxMjoKKwljYXNlIERSTV9GT1JNQVRf
WTIxNjoKKwkJcmV0dXJuIDY7CisJY2FzZSBEUk1fRk9STUFUX05WMTI6CisJCXJldHVybiAyMDsK
KwljYXNlIERSTV9GT1JNQVRfUDAxMDoKKwljYXNlIERSTV9GT1JNQVRfUDAxMjoKKwljYXNlIERS
TV9GT1JNQVRfUDAxNjoKKwkJcmV0dXJuIDEyOworCWNhc2UgRFJNX0ZPUk1BVF9YUkdCMTYxNjE2
MTZGOgorCWNhc2UgRFJNX0ZPUk1BVF9YQkdSMTYxNjE2MTZGOgorCWNhc2UgRFJNX0ZPUk1BVF9B
UkdCMTYxNjE2MTZGOgorCWNhc2UgRFJNX0ZPUk1BVF9BQkdSMTYxNjE2MTZGOgorCWNhc2UgRFJN
X0ZPUk1BVF9YVllVMTJfMTYxNjE2MTY6CisJY2FzZSBEUk1fRk9STUFUX1hWWVUxNjE2MTYxNjoK
KwkJcmV0dXJuIDQ7CisJZGVmYXVsdDoKKwkJcmV0dXJuIDE7CisJfQorfQorCitzdGF0aWMgaW50
IGljbF9wbGFuZV9tYXhfd2lkdGgoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCisJ
CQkgICAgICAgaW50IGNvbG9yX3BsYW5lLAorCQkJICAgICAgIHVuc2lnbmVkIGludCByb3RhdGlv
bikKK3sKKwlyZXR1cm4gNTEyMDsKK30KKworc3RhdGljIGludCBza2xfcGxhbmVfbWF4X2hlaWdo
dChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKKwkJCQlpbnQgY29sb3JfcGxhbmUs
CisJCQkJdW5zaWduZWQgaW50IHJvdGF0aW9uKQoreworCXJldHVybiA0MDk2OworfQorCitzdGF0
aWMgaW50IGljbF9wbGFuZV9tYXhfaGVpZ2h0KGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIg
KmZiLAorCQkJCWludCBjb2xvcl9wbGFuZSwKKwkJCQl1bnNpZ25lZCBpbnQgcm90YXRpb24pCit7
CisJcmV0dXJuIDQzMjA7Cit9CisKK3N0YXRpYyB1bnNpZ25lZCBpbnQKK3NrbF9wbGFuZV9tYXhf
c3RyaWRlKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCisJCSAgICAgdTMyIHBpeGVsX2Zvcm1h
dCwgdTY0IG1vZGlmaWVyLAorCQkgICAgIHVuc2lnbmVkIGludCByb3RhdGlvbikKK3sKKwljb25z
dCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvICppbmZvID0gZHJtX2Zvcm1hdF9pbmZvKHBpeGVsX2Zv
cm1hdCk7CisJaW50IGNwcCA9IGluZm8tPmNwcFswXTsKKworCS8qCisJICogIlRoZSBzdHJpZGUg
aW4gYnl0ZXMgbXVzdCBub3QgZXhjZWVkIHRoZQorCSAqIG9mIHRoZSBzaXplIG9mIDhLIHBpeGVs
cyBhbmQgMzJLIGJ5dGVzLiIKKwkgKi8KKwlpZiAoZHJtX3JvdGF0aW9uXzkwX29yXzI3MChyb3Rh
dGlvbikpCisJCXJldHVybiBtaW4oODE5MiwgMzI3NjggLyBjcHApOworCWVsc2UKKwkJcmV0dXJu
IG1pbig4MTkyICogY3BwLCAzMjc2OCk7Cit9CisKKworLyogUHJlb2Zmc2V0IHZhbHVlcyBmb3Ig
WVVWIHRvIFJHQiBDb252ZXJzaW9uICovCisjZGVmaW5lIFBSRU9GRl9ZVVZfVE9fUkdCX0hJCQkw
eDE4MDAKKyNkZWZpbmUgUFJFT0ZGX1lVVl9UT19SR0JfTUUJCTB4MUYwMAorI2RlZmluZSBQUkVP
RkZfWVVWX1RPX1JHQl9MTwkJMHgxODAwCisKKyNkZWZpbmUgIFJPRkYoeCkgICAgICAgICAgKCgo
eCkgJiAweGZmZmYpIDw8IDE2KQorI2RlZmluZSAgR09GRih4KSAgICAgICAgICAoKCh4KSAmIDB4
ZmZmZikgPDwgMCkKKyNkZWZpbmUgIEJPRkYoeCkgICAgICAgICAgKCgoeCkgJiAweGZmZmYpIDw8
IDE2KQorCitzdGF0aWMgdm9pZAoraWNsX3Byb2dyYW1faW5wdXRfY3NjKHN0cnVjdCBpbnRlbF9w
bGFuZSAqcGxhbmUsCisJCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlLAorCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0
YXRlKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxh
bmUtPmJhc2UuZGV2KTsKKwllbnVtIHBpcGUgcGlwZSA9IHBsYW5lLT5waXBlOworCWVudW0gcGxh
bmVfaWQgcGxhbmVfaWQgPSBwbGFuZS0+aWQ7CisKKwlzdGF0aWMgY29uc3QgdTE2IGlucHV0X2Nz
Y19tYXRyaXhbXVs5XSA9IHsKKwkJLyoKKwkJICogQlQuNjAxIGZ1bGwgcmFuZ2UgWUNiQ3IgLT4g
ZnVsbCByYW5nZSBSR0IKKwkJICogVGhlIG1hdHJpeCByZXF1aXJlZCBpcyA6CisJCSAqIFsxLjAw
MCwgMC4wMDAsIDEuMzcxLAorCQkgKiAgMS4wMDAsIC0wLjMzNiwgLTAuNjk4LAorCQkgKiAgMS4w
MDAsIDEuNzMyLCAwLjAwMDBdCisJCSAqLworCQlbRFJNX0NPTE9SX1lDQkNSX0JUNjAxXSA9IHsK
KwkJCTB4N0FGOCwgMHg3ODAwLCAweDAsCisJCQkweDhCMjgsIDB4NzgwMCwgMHg5QUMwLAorCQkJ
MHgwLCAweDc4MDAsIDB4N0REOCwKKwkJfSwKKwkJLyoKKwkJICogQlQuNzA5IGZ1bGwgcmFuZ2Ug
WUNiQ3IgLT4gZnVsbCByYW5nZSBSR0IKKwkJICogVGhlIG1hdHJpeCByZXF1aXJlZCBpcyA6CisJ
CSAqIFsxLjAwMCwgMC4wMDAsIDEuNTc0LAorCQkgKiAgMS4wMDAsIC0wLjE4NywgLTAuNDY4LAor
CQkgKiAgMS4wMDAsIDEuODU1LCAwLjAwMDBdCisJCSAqLworCQlbRFJNX0NPTE9SX1lDQkNSX0JU
NzA5XSA9IHsKKwkJCTB4N0M5OCwgMHg3ODAwLCAweDAsCisJCQkweDlFRjgsIDB4NzgwMCwgMHhB
QzAwLAorCQkJMHgwLCAweDc4MDAsICAweDdFRDgsCisJCX0sCisJCS8qCisJCSAqIEJULjIwMjAg
ZnVsbCByYW5nZSBZQ2JDciAtPiBmdWxsIHJhbmdlIFJHQgorCQkgKiBUaGUgbWF0cml4IHJlcXVp
cmVkIGlzIDoKKwkJICogWzEuMDAwLCAwLjAwMCwgMS40NzQsCisJCSAqICAxLjAwMCwgLTAuMTY0
NSwgLTAuNTcxMywKKwkJICogIDEuMDAwLCAxLjg4MTQsIDAuMDAwMF0KKwkJICovCisJCVtEUk1f
Q09MT1JfWUNCQ1JfQlQyMDIwXSA9IHsKKwkJCTB4N0JDOCwgMHg3ODAwLCAweDAsCisJCQkweDg5
MjgsIDB4NzgwMCwgMHhBQTg4LAorCQkJMHgwLCAweDc4MDAsIDB4N0YxMCwKKwkJfSwKKwl9Owor
CisJLyogTWF0cml4IGZvciBMaW1pdGVkIFJhbmdlIHRvIEZ1bGwgUmFuZ2UgQ29udmVyc2lvbiAq
LworCXN0YXRpYyBjb25zdCB1MTYgaW5wdXRfY3NjX21hdHJpeF9scltdWzldID0geworCQkvKgor
CQkgKiBCVC42MDEgTGltdGVkIHJhbmdlIFlDYkNyIC0+IGZ1bGwgcmFuZ2UgUkdCCisJCSAqIFRo
ZSBtYXRyaXggcmVxdWlyZWQgaXMgOgorCQkgKiBbMS4xNjQzODQsIDAuMDAwLCAxLjU5NjAyNywK
KwkJICogIDEuMTY0Mzg0LCAtMC4zOTE3NSwgLTAuODEyODEzLAorCQkgKiAgMS4xNjQzODQsIDIu
MDE3MjMyLCAwLjAwMDBdCisJCSAqLworCQlbRFJNX0NPTE9SX1lDQkNSX0JUNjAxXSA9IHsKKwkJ
CTB4N0NDOCwgMHg3OTUwLCAweDAsCisJCQkweDhEMDAsIDB4Nzk1MCwgMHg5Qzg4LAorCQkJMHgw
LCAweDc5NTAsIDB4NjgxMCwKKwkJfSwKKwkJLyoKKwkJICogQlQuNzA5IExpbWl0ZWQgcmFuZ2Ug
WUNiQ3IgLT4gZnVsbCByYW5nZSBSR0IKKwkJICogVGhlIG1hdHJpeCByZXF1aXJlZCBpcyA6CisJ
CSAqIFsxLjE2NDM4NCwgMC4wMDAsIDEuNzkyNzQxLAorCQkgKiAgMS4xNjQzODQsIC0wLjIxMzI0
OSwgLTAuNTMyOTA5LAorCQkgKiAgMS4xNjQzODQsIDIuMTEyNDAyLCAwLjAwMDBdCisJCSAqLwor
CQlbRFJNX0NPTE9SX1lDQkNSX0JUNzA5XSA9IHsKKwkJCTB4N0U1OCwgMHg3OTUwLCAweDAsCisJ
CQkweDg4ODgsIDB4Nzk1MCwgMHhBREE4LAorCQkJMHgwLCAweDc5NTAsICAweDY4NzAsCisJCX0s
CisJCS8qCisJCSAqIEJULjIwMjAgTGltaXRlZCByYW5nZSBZQ2JDciAtPiBmdWxsIHJhbmdlIFJH
QgorCQkgKiBUaGUgbWF0cml4IHJlcXVpcmVkIGlzIDoKKwkJICogWzEuMTY0LCAwLjAwMCwgMS42
NzgsCisJCSAqICAxLjE2NCwgLTAuMTg3MywgLTAuNjUwNCwKKwkJICogIDEuMTY0LCAyLjE0MTcs
IDAuMDAwMF0KKwkJICovCisJCVtEUk1fQ09MT1JfWUNCQ1JfQlQyMDIwXSA9IHsKKwkJCTB4N0Q3
MCwgMHg3OTUwLCAweDAsCisJCQkweDhBNjgsIDB4Nzk1MCwgMHhBQzAwLAorCQkJMHgwLCAweDc5
NTAsIDB4Njg5MCwKKwkJfSwKKwl9OworCWNvbnN0IHUxNiAqY3NjOworCisJaWYgKHBsYW5lX3N0
YXRlLT5ody5jb2xvcl9yYW5nZSA9PSBEUk1fQ09MT1JfWUNCQ1JfRlVMTF9SQU5HRSkKKwkJY3Nj
ID0gaW5wdXRfY3NjX21hdHJpeFtwbGFuZV9zdGF0ZS0+aHcuY29sb3JfZW5jb2RpbmddOworCWVs
c2UKKwkJY3NjID0gaW5wdXRfY3NjX21hdHJpeF9scltwbGFuZV9zdGF0ZS0+aHcuY29sb3JfZW5j
b2RpbmddOworCisJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0lOUFVUX0NTQ19D
T0VGRihwaXBlLCBwbGFuZV9pZCwgMCksCisJCQkgIFJPRkYoY3NjWzBdKSB8IEdPRkYoY3NjWzFd
KSk7CisJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0lOUFVUX0NTQ19DT0VGRihw
aXBlLCBwbGFuZV9pZCwgMSksCisJCQkgIEJPRkYoY3NjWzJdKSk7CisJaW50ZWxfZGVfd3JpdGVf
ZncoZGV2X3ByaXYsIFBMQU5FX0lOUFVUX0NTQ19DT0VGRihwaXBlLCBwbGFuZV9pZCwgMiksCisJ
CQkgIFJPRkYoY3NjWzNdKSB8IEdPRkYoY3NjWzRdKSk7CisJaW50ZWxfZGVfd3JpdGVfZncoZGV2
X3ByaXYsIFBMQU5FX0lOUFVUX0NTQ19DT0VGRihwaXBlLCBwbGFuZV9pZCwgMyksCisJCQkgIEJP
RkYoY3NjWzVdKSk7CisJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0lOUFVUX0NT
Q19DT0VGRihwaXBlLCBwbGFuZV9pZCwgNCksCisJCQkgIFJPRkYoY3NjWzZdKSB8IEdPRkYoY3Nj
WzddKSk7CisJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0lOUFVUX0NTQ19DT0VG
RihwaXBlLCBwbGFuZV9pZCwgNSksCisJCQkgIEJPRkYoY3NjWzhdKSk7CisKKwlpbnRlbF9kZV93
cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfSU5QVVRfQ1NDX1BSRU9GRihwaXBlLCBwbGFuZV9pZCwg
MCksCisJCQkgIFBSRU9GRl9ZVVZfVE9fUkdCX0hJKTsKKwlpZiAocGxhbmVfc3RhdGUtPmh3LmNv
bG9yX3JhbmdlID09IERSTV9DT0xPUl9ZQ0JDUl9GVUxMX1JBTkdFKQorCQlpbnRlbF9kZV93cml0
ZV9mdyhkZXZfcHJpdiwKKwkJCQkgIFBMQU5FX0lOUFVUX0NTQ19QUkVPRkYocGlwZSwgcGxhbmVf
aWQsIDEpLAorCQkJCSAgMCk7CisJZWxzZQorCQlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwK
KwkJCQkgIFBMQU5FX0lOUFVUX0NTQ19QUkVPRkYocGlwZSwgcGxhbmVfaWQsIDEpLAorCQkJCSAg
UFJFT0ZGX1lVVl9UT19SR0JfTUUpOworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFO
RV9JTlBVVF9DU0NfUFJFT0ZGKHBpcGUsIHBsYW5lX2lkLCAyKSwKKwkJCSAgUFJFT0ZGX1lVVl9U
T19SR0JfTE8pOworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LAorCQkJICBQTEFORV9JTlBV
VF9DU0NfUE9TVE9GRihwaXBlLCBwbGFuZV9pZCwgMCksIDB4MCk7CisJaW50ZWxfZGVfd3JpdGVf
ZncoZGV2X3ByaXYsCisJCQkgIFBMQU5FX0lOUFVUX0NTQ19QT1NUT0ZGKHBpcGUsIHBsYW5lX2lk
LCAxKSwgMHgwKTsKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwKKwkJCSAgUExBTkVfSU5Q
VVRfQ1NDX1BPU1RPRkYocGlwZSwgcGxhbmVfaWQsIDIpLCAweDApOworfQorCitzdGF0aWMgYm9v
bCBpc19zdXJmYWNlX2xpbmVhcihjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50
IGNvbG9yX3BsYW5lKQoreworCXJldHVybiBmYi0+bW9kaWZpZXIgPT0gRFJNX0ZPUk1BVF9NT0Rf
TElORUFSIHx8CisJICAgICAgIGlzX2dlbjEyX2Njc19wbGFuZShmYiwgY29sb3JfcGxhbmUpOwor
fQorCitzdGF0aWMgdW5zaWduZWQgaW50IHNrbF9wbGFuZV9zdHJpZGVfbXVsdChjb25zdCBzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKKwkJCQkJICBpbnQgY29sb3JfcGxhbmUsIHVuc2lnbmVk
IGludCByb3RhdGlvbikKK3sKKwkvKgorCSAqIFRoZSBzdHJpZGUgaXMgZWl0aGVyIGV4cHJlc3Nl
ZCBhcyBhIG11bHRpcGxlIG9mIDY0IGJ5dGVzIGNodW5rcyBmb3IKKwkgKiBsaW5lYXIgYnVmZmVy
cyBvciBpbiBudW1iZXIgb2YgdGlsZXMgZm9yIHRpbGVkIGJ1ZmZlcnMuCisJICovCisJaWYgKGlz
X3N1cmZhY2VfbGluZWFyKGZiLCBjb2xvcl9wbGFuZSkpCisJCXJldHVybiA2NDsKKwllbHNlIGlm
IChkcm1fcm90YXRpb25fOTBfb3JfMjcwKHJvdGF0aW9uKSkKKwkJcmV0dXJuIGludGVsX3RpbGVf
aGVpZ2h0KGZiLCBjb2xvcl9wbGFuZSk7CisJZWxzZQorCQlyZXR1cm4gaW50ZWxfdGlsZV93aWR0
aF9ieXRlcyhmYiwgY29sb3JfcGxhbmUpOworfQorCitzdGF0aWMgdTMyIHNrbF9wbGFuZV9zdHJp
ZGUoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKKwkJCSAgICBp
bnQgY29sb3JfcGxhbmUpCit7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBw
bGFuZV9zdGF0ZS0+aHcuZmI7CisJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUt
Pmh3LnJvdGF0aW9uOworCXUzMiBzdHJpZGUgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY29s
b3JfcGxhbmVdLnN0cmlkZTsKKworCWlmIChjb2xvcl9wbGFuZSA+PSBmYi0+Zm9ybWF0LT5udW1f
cGxhbmVzKQorCQlyZXR1cm4gMDsKKworCXJldHVybiBzdHJpZGUgLyBza2xfcGxhbmVfc3RyaWRl
X211bHQoZmIsIGNvbG9yX3BsYW5lLCByb3RhdGlvbik7Cit9CisKK3N0YXRpYyB2b2lkCitza2xf
ZGlzYWJsZV9wbGFuZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAorCQkgIGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKKwllbnVtIHBsYW5lX2lk
IHBsYW5lX2lkID0gcGxhbmUtPmlkOworCWVudW0gcGlwZSBwaXBlID0gcGxhbmUtPnBpcGU7CisJ
dW5zaWduZWQgbG9uZyBpcnFmbGFnczsKKworCXNwaW5fbG9ja19pcnFzYXZlKCZkZXZfcHJpdi0+
dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsKKworCWlmIChpY2xfaXNfaGRyX3BsYW5lKGRldl9wcml2
LCBwbGFuZV9pZCkpCisJCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9DVVNfQ1RM
KHBpcGUsIHBsYW5lX2lkKSwgMCk7CisKKwlza2xfd3JpdGVfcGxhbmVfd20ocGxhbmUsIGNydGNf
c3RhdGUpOworCisJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0NUTChwaXBlLCBw
bGFuZV9pZCksIDApOworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9TVVJGKHBp
cGUsIHBsYW5lX2lkKSwgMCk7CisKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZXZfcHJpdi0+
dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsKK30KKworc3RhdGljIGJvb2wKK3NrbF9wbGFuZV9nZXRf
aHdfc3RhdGUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKKwkJICAgICAgIGVudW0gcGlwZSAq
cGlwZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBs
YW5lLT5iYXNlLmRldik7CisJZW51bSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2RvbWFpbiBwb3dlcl9k
b21haW47CisJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKKwlpbnRlbF93YWtl
cmVmX3Qgd2FrZXJlZjsKKwlib29sIHJldDsKKworCXBvd2VyX2RvbWFpbiA9IFBPV0VSX0RPTUFJ
Tl9QSVBFKHBsYW5lLT5waXBlKTsKKwl3YWtlcmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXRf
aWZfZW5hYmxlZChkZXZfcHJpdiwgcG93ZXJfZG9tYWluKTsKKwlpZiAoIXdha2VyZWYpCisJCXJl
dHVybiBmYWxzZTsKKworCXJldCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIFBMQU5FX0NUTChw
bGFuZS0+cGlwZSwgcGxhbmVfaWQpKSAmIFBMQU5FX0NUTF9FTkFCTEU7CisKKwkqcGlwZSA9IHBs
YW5lLT5waXBlOworCisJaW50ZWxfZGlzcGxheV9wb3dlcl9wdXQoZGV2X3ByaXYsIHBvd2VyX2Rv
bWFpbiwgd2FrZXJlZik7CisKKwlyZXR1cm4gcmV0OworfQorCitzdGF0aWMgdTMyIHNrbF9wbGFu
ZV9jdGxfZm9ybWF0KHUzMiBwaXhlbF9mb3JtYXQpCit7CisJc3dpdGNoIChwaXhlbF9mb3JtYXQp
IHsKKwljYXNlIERSTV9GT1JNQVRfQzg6CisJCXJldHVybiBQTEFORV9DVExfRk9STUFUX0lOREVY
RUQ7CisJY2FzZSBEUk1fRk9STUFUX1JHQjU2NToKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRf
UkdCXzU2NTsKKwljYXNlIERSTV9GT1JNQVRfWEJHUjg4ODg6CisJY2FzZSBEUk1fRk9STUFUX0FC
R1I4ODg4OgorCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9YUkdCXzg4ODggfCBQTEFORV9DVExf
T1JERVJfUkdCWDsKKwljYXNlIERSTV9GT1JNQVRfWFJHQjg4ODg6CisJY2FzZSBEUk1fRk9STUFU
X0FSR0I4ODg4OgorCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9YUkdCXzg4ODg7CisJY2FzZSBE
Uk1fRk9STUFUX1hCR1IyMTAxMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9BQkdSMjEwMTAxMDoKKwkJ
cmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWFJHQl8yMTAxMDEwIHwgUExBTkVfQ1RMX09SREVSX1JH
Qlg7CisJY2FzZSBEUk1fRk9STUFUX1hSR0IyMTAxMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9BUkdC
MjEwMTAxMDoKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWFJHQl8yMTAxMDEwOworCWNhc2Ug
RFJNX0ZPUk1BVF9YQkdSMTYxNjE2MTZGOgorCWNhc2UgRFJNX0ZPUk1BVF9BQkdSMTYxNjE2MTZG
OgorCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9YUkdCXzE2MTYxNjE2RiB8IFBMQU5FX0NUTF9P
UkRFUl9SR0JYOworCWNhc2UgRFJNX0ZPUk1BVF9YUkdCMTYxNjE2MTZGOgorCWNhc2UgRFJNX0ZP
Uk1BVF9BUkdCMTYxNjE2MTZGOgorCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9YUkdCXzE2MTYx
NjE2RjsKKwljYXNlIERSTV9GT1JNQVRfWFlVVjg4ODg6CisJCXJldHVybiBQTEFORV9DVExfRk9S
TUFUX1hZVVY7CisJY2FzZSBEUk1fRk9STUFUX1lVWVY6CisJCXJldHVybiBQTEFORV9DVExfRk9S
TUFUX1lVVjQyMiB8IFBMQU5FX0NUTF9ZVVY0MjJfWVVZVjsKKwljYXNlIERSTV9GT1JNQVRfWVZZ
VToKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWVVWNDIyIHwgUExBTkVfQ1RMX1lVVjQyMl9Z
VllVOworCWNhc2UgRFJNX0ZPUk1BVF9VWVZZOgorCQlyZXR1cm4gUExBTkVfQ1RMX0ZPUk1BVF9Z
VVY0MjIgfCBQTEFORV9DVExfWVVWNDIyX1VZVlk7CisJY2FzZSBEUk1fRk9STUFUX1ZZVVk6CisJ
CXJldHVybiBQTEFORV9DVExfRk9STUFUX1lVVjQyMiB8IFBMQU5FX0NUTF9ZVVY0MjJfVllVWTsK
KwljYXNlIERSTV9GT1JNQVRfTlYxMjoKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfTlYxMjsK
KwljYXNlIERSTV9GT1JNQVRfUDAxMDoKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfUDAxMDsK
KwljYXNlIERSTV9GT1JNQVRfUDAxMjoKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfUDAxMjsK
KwljYXNlIERSTV9GT1JNQVRfUDAxNjoKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfUDAxNjsK
KwljYXNlIERSTV9GT1JNQVRfWTIxMDoKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWTIxMDsK
KwljYXNlIERSTV9GT1JNQVRfWTIxMjoKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWTIxMjsK
KwljYXNlIERSTV9GT1JNQVRfWTIxNjoKKwkJcmV0dXJuIFBMQU5FX0NUTF9GT1JNQVRfWTIxNjsK
KwljYXNlIERSTV9GT1JNQVRfWFZZVTIxMDEwMTA6CisJCXJldHVybiBQTEFORV9DVExfRk9STUFU
X1k0MTA7CisJY2FzZSBEUk1fRk9STUFUX1hWWVUxMl8xNjE2MTYxNjoKKwkJcmV0dXJuIFBMQU5F
X0NUTF9GT1JNQVRfWTQxMjsKKwljYXNlIERSTV9GT1JNQVRfWFZZVTE2MTYxNjE2OgorCQlyZXR1
cm4gUExBTkVfQ1RMX0ZPUk1BVF9ZNDE2OworCWRlZmF1bHQ6CisJCU1JU1NJTkdfQ0FTRShwaXhl
bF9mb3JtYXQpOworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgdTMyIHNrbF9wbGFuZV9j
dGxfYWxwaGEoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKK3sK
KwlpZiAoIXBsYW5lX3N0YXRlLT5ody5mYi0+Zm9ybWF0LT5oYXNfYWxwaGEpCisJCXJldHVybiBQ
TEFORV9DVExfQUxQSEFfRElTQUJMRTsKKworCXN3aXRjaCAocGxhbmVfc3RhdGUtPmh3LnBpeGVs
X2JsZW5kX21vZGUpIHsKKwljYXNlIERSTV9NT0RFX0JMRU5EX1BJWEVMX05PTkU6CisJCXJldHVy
biBQTEFORV9DVExfQUxQSEFfRElTQUJMRTsKKwljYXNlIERSTV9NT0RFX0JMRU5EX1BSRU1VTFRJ
OgorCQlyZXR1cm4gUExBTkVfQ1RMX0FMUEhBX1NXX1BSRU1VTFRJUExZOworCWNhc2UgRFJNX01P
REVfQkxFTkRfQ09WRVJBR0U6CisJCXJldHVybiBQTEFORV9DVExfQUxQSEFfSFdfUFJFTVVMVElQ
TFk7CisJZGVmYXVsdDoKKwkJTUlTU0lOR19DQVNFKHBsYW5lX3N0YXRlLT5ody5waXhlbF9ibGVu
ZF9tb2RlKTsKKwkJcmV0dXJuIFBMQU5FX0NUTF9BTFBIQV9ESVNBQkxFOworCX0KK30KKworc3Rh
dGljIHUzMiBnbGtfcGxhbmVfY29sb3JfY3RsX2FscGhhKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFu
ZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCit7CisJaWYgKCFwbGFuZV9zdGF0ZS0+aHcuZmItPmZvcm1h
dC0+aGFzX2FscGhhKQorCQlyZXR1cm4gUExBTkVfQ09MT1JfQUxQSEFfRElTQUJMRTsKKworCXN3
aXRjaCAocGxhbmVfc3RhdGUtPmh3LnBpeGVsX2JsZW5kX21vZGUpIHsKKwljYXNlIERSTV9NT0RF
X0JMRU5EX1BJWEVMX05PTkU6CisJCXJldHVybiBQTEFORV9DT0xPUl9BTFBIQV9ESVNBQkxFOwor
CWNhc2UgRFJNX01PREVfQkxFTkRfUFJFTVVMVEk6CisJCXJldHVybiBQTEFORV9DT0xPUl9BTFBI
QV9TV19QUkVNVUxUSVBMWTsKKwljYXNlIERSTV9NT0RFX0JMRU5EX0NPVkVSQUdFOgorCQlyZXR1
cm4gUExBTkVfQ09MT1JfQUxQSEFfSFdfUFJFTVVMVElQTFk7CisJZGVmYXVsdDoKKwkJTUlTU0lO
R19DQVNFKHBsYW5lX3N0YXRlLT5ody5waXhlbF9ibGVuZF9tb2RlKTsKKwkJcmV0dXJuIFBMQU5F
X0NPTE9SX0FMUEhBX0RJU0FCTEU7CisJfQorfQorCitzdGF0aWMgdTMyIHNrbF9wbGFuZV9jdGxf
dGlsaW5nKHU2NCBmYl9tb2RpZmllcikKK3sKKwlzd2l0Y2ggKGZiX21vZGlmaWVyKSB7CisJY2Fz
ZSBEUk1fRk9STUFUX01PRF9MSU5FQVI6CisJCWJyZWFrOworCWNhc2UgSTkxNV9GT1JNQVRfTU9E
X1hfVElMRUQ6CisJCXJldHVybiBQTEFORV9DVExfVElMRURfWDsKKwljYXNlIEk5MTVfRk9STUFU
X01PRF9ZX1RJTEVEOgorCQlyZXR1cm4gUExBTkVfQ1RMX1RJTEVEX1k7CisJY2FzZSBJOTE1X0ZP
Uk1BVF9NT0RfWV9USUxFRF9DQ1M6CisJCXJldHVybiBQTEFORV9DVExfVElMRURfWSB8IFBMQU5F
X0NUTF9SRU5ERVJfREVDT01QUkVTU0lPTl9FTkFCTEU7CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0Rf
WV9USUxFRF9HRU4xMl9SQ19DQ1M6CisJCXJldHVybiBQTEFORV9DVExfVElMRURfWSB8CisJCSAg
ICAgICBQTEFORV9DVExfUkVOREVSX0RFQ09NUFJFU1NJT05fRU5BQkxFIHwKKwkJICAgICAgIFBM
QU5FX0NUTF9DTEVBUl9DT0xPUl9ESVNBQkxFOworCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElM
RURfR0VOMTJfTUNfQ0NTOgorCQlyZXR1cm4gUExBTkVfQ1RMX1RJTEVEX1kgfCBQTEFORV9DVExf
TUVESUFfREVDT01QUkVTU0lPTl9FTkFCTEU7CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElM
RUQ6CisJCXJldHVybiBQTEFORV9DVExfVElMRURfWUY7CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0Rf
WWZfVElMRURfQ0NTOgorCQlyZXR1cm4gUExBTkVfQ1RMX1RJTEVEX1lGIHwgUExBTkVfQ1RMX1JF
TkRFUl9ERUNPTVBSRVNTSU9OX0VOQUJMRTsKKwlkZWZhdWx0OgorCQlNSVNTSU5HX0NBU0UoZmJf
bW9kaWZpZXIpOworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgdTMyIHNrbF9wbGFuZV9j
dGxfcm90YXRlKHVuc2lnbmVkIGludCByb3RhdGUpCit7CisJc3dpdGNoIChyb3RhdGUpIHsKKwlj
YXNlIERSTV9NT0RFX1JPVEFURV8wOgorCQlicmVhazsKKwkvKgorCSAqIERSTV9NT0RFX1JPVEFU
RV8gaXMgY291bnRlciBjbG9ja3dpc2UgdG8gc3RheSBjb21wYXRpYmxlIHdpdGggWHJhbmRyCisJ
ICogd2hpbGUgaTkxNSBIVyByb3RhdGlvbiBpcyBjbG9ja3dpc2UsIHRoYXRzIHdoeSB0aGlzIHN3
YXBwaW5nLgorCSAqLworCWNhc2UgRFJNX01PREVfUk9UQVRFXzkwOgorCQlyZXR1cm4gUExBTkVf
Q1RMX1JPVEFURV8yNzA7CisJY2FzZSBEUk1fTU9ERV9ST1RBVEVfMTgwOgorCQlyZXR1cm4gUExB
TkVfQ1RMX1JPVEFURV8xODA7CisJY2FzZSBEUk1fTU9ERV9ST1RBVEVfMjcwOgorCQlyZXR1cm4g
UExBTkVfQ1RMX1JPVEFURV85MDsKKwlkZWZhdWx0OgorCQlNSVNTSU5HX0NBU0Uocm90YXRlKTsK
Kwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHUzMiBjbmxfcGxhbmVfY3RsX2ZsaXAodW5z
aWduZWQgaW50IHJlZmxlY3QpCit7CisJc3dpdGNoIChyZWZsZWN0KSB7CisJY2FzZSAwOgorCQli
cmVhazsKKwljYXNlIERSTV9NT0RFX1JFRkxFQ1RfWDoKKwkJcmV0dXJuIFBMQU5FX0NUTF9GTElQ
X0hPUklaT05UQUw7CisJY2FzZSBEUk1fTU9ERV9SRUZMRUNUX1k6CisJZGVmYXVsdDoKKwkJTUlT
U0lOR19DQVNFKHJlZmxlY3QpOworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgdTMyIHNr
bF9wbGFuZV9jdGxfY3J0Yyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNf
c3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsKKwl1MzIgcGxhbmVfY3RsID0gMDsKKworCWlmIChjcnRj
X3N0YXRlLT51YXBpLmFzeW5jX2ZsaXApCisJCXBsYW5lX2N0bCB8PSBQTEFORV9DVExfQVNZTkNf
RkxJUDsKKworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwIHx8IElTX0dFTUlOSUxBS0Uo
ZGV2X3ByaXYpKQorCQlyZXR1cm4gcGxhbmVfY3RsOworCisJaWYgKGNydGNfc3RhdGUtPmdhbW1h
X2VuYWJsZSkKKwkJcGxhbmVfY3RsIHw9IFBMQU5FX0NUTF9QSVBFX0dBTU1BX0VOQUJMRTsKKwor
CWlmIChjcnRjX3N0YXRlLT5jc2NfZW5hYmxlKQorCQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RMX1BJ
UEVfQ1NDX0VOQUJMRTsKKworCXJldHVybiBwbGFuZV9jdGw7Cit9CisKK3N0YXRpYyB1MzIgc2ts
X3BsYW5lX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJ
CSBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQoreworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9CisJCXRvX2k5MTUocGxhbmVfc3RhdGUtPnVh
cGkucGxhbmUtPmRldik7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFu
ZV9zdGF0ZS0+aHcuZmI7CisJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3
LnJvdGF0aW9uOworCWNvbnN0IHN0cnVjdCBkcm1faW50ZWxfc3ByaXRlX2NvbG9ya2V5ICprZXkg
PSAmcGxhbmVfc3RhdGUtPmNrZXk7CisJdTMyIHBsYW5lX2N0bDsKKworCXBsYW5lX2N0bCA9IFBM
QU5FX0NUTF9FTkFCTEU7CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDEwICYmICFJU19H
RU1JTklMQUtFKGRldl9wcml2KSkgeworCQlwbGFuZV9jdGwgfD0gc2tsX3BsYW5lX2N0bF9hbHBo
YShwbGFuZV9zdGF0ZSk7CisJCXBsYW5lX2N0bCB8PSBQTEFORV9DVExfUExBTkVfR0FNTUFfRElT
QUJMRTsKKworCQlpZiAocGxhbmVfc3RhdGUtPmh3LmNvbG9yX2VuY29kaW5nID09IERSTV9DT0xP
Ul9ZQ0JDUl9CVDcwOSkKKwkJCXBsYW5lX2N0bCB8PSBQTEFORV9DVExfWVVWX1RPX1JHQl9DU0Nf
Rk9STUFUX0JUNzA5OworCisJCWlmIChwbGFuZV9zdGF0ZS0+aHcuY29sb3JfcmFuZ2UgPT0gRFJN
X0NPTE9SX1lDQkNSX0ZVTExfUkFOR0UpCisJCQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RMX1lVVl9S
QU5HRV9DT1JSRUNUSU9OX0RJU0FCTEU7CisJfQorCisJcGxhbmVfY3RsIHw9IHNrbF9wbGFuZV9j
dGxfZm9ybWF0KGZiLT5mb3JtYXQtPmZvcm1hdCk7CisJcGxhbmVfY3RsIHw9IHNrbF9wbGFuZV9j
dGxfdGlsaW5nKGZiLT5tb2RpZmllcik7CisJcGxhbmVfY3RsIHw9IHNrbF9wbGFuZV9jdGxfcm90
YXRlKHJvdGF0aW9uICYgRFJNX01PREVfUk9UQVRFX01BU0spOworCisJaWYgKElOVEVMX0dFTihk
ZXZfcHJpdikgPj0gMTApCisJCXBsYW5lX2N0bCB8PSBjbmxfcGxhbmVfY3RsX2ZsaXAocm90YXRp
b24gJgorCQkJCQkJRFJNX01PREVfUkVGTEVDVF9NQVNLKTsKKworCWlmIChrZXktPmZsYWdzICYg
STkxNV9TRVRfQ09MT1JLRVlfREVTVElOQVRJT04pCisJCXBsYW5lX2N0bCB8PSBQTEFORV9DVExf
S0VZX0VOQUJMRV9ERVNUSU5BVElPTjsKKwllbHNlIGlmIChrZXktPmZsYWdzICYgSTkxNV9TRVRf
Q09MT1JLRVlfU09VUkNFKQorCQlwbGFuZV9jdGwgfD0gUExBTkVfQ1RMX0tFWV9FTkFCTEVfU09V
UkNFOworCisJcmV0dXJuIHBsYW5lX2N0bDsKK30KKworc3RhdGljIHUzMiBnbGtfcGxhbmVfY29s
b3JfY3RsX2NydGMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRl
LT51YXBpLmNydGMtPmRldik7CisJdTMyIHBsYW5lX2NvbG9yX2N0bCA9IDA7CisKKwlpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA+PSAxMSkKKwkJcmV0dXJuIHBsYW5lX2NvbG9yX2N0bDsKKworCWlm
IChjcnRjX3N0YXRlLT5nYW1tYV9lbmFibGUpCisJCXBsYW5lX2NvbG9yX2N0bCB8PSBQTEFORV9D
T0xPUl9QSVBFX0dBTU1BX0VOQUJMRTsKKworCWlmIChjcnRjX3N0YXRlLT5jc2NfZW5hYmxlKQor
CQlwbGFuZV9jb2xvcl9jdGwgfD0gUExBTkVfQ09MT1JfUElQRV9DU0NfRU5BQkxFOworCisJcmV0
dXJuIHBsYW5lX2NvbG9yX2N0bDsKK30KKworc3RhdGljIHUzMiBnbGtfcGxhbmVfY29sb3JfY3Rs
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJICAgICAgIGNv
bnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCit7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KKwkJdG9faTkxNShwbGFuZV9zdGF0ZS0+dWFwaS5w
bGFuZS0+ZGV2KTsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0
YXRlLT5ody5mYjsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUo
cGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOworCXUzMiBwbGFuZV9jb2xvcl9jdGwgPSAwOworCisJ
cGxhbmVfY29sb3JfY3RsIHw9IFBMQU5FX0NPTE9SX1BMQU5FX0dBTU1BX0RJU0FCTEU7CisJcGxh
bmVfY29sb3JfY3RsIHw9IGdsa19wbGFuZV9jb2xvcl9jdGxfYWxwaGEocGxhbmVfc3RhdGUpOwor
CisJaWYgKGZiLT5mb3JtYXQtPmlzX3l1diAmJiAhaWNsX2lzX2hkcl9wbGFuZShkZXZfcHJpdiwg
cGxhbmUtPmlkKSkgeworCQlzd2l0Y2ggKHBsYW5lX3N0YXRlLT5ody5jb2xvcl9lbmNvZGluZykg
eworCQljYXNlIERSTV9DT0xPUl9ZQ0JDUl9CVDcwOToKKwkJCXBsYW5lX2NvbG9yX2N0bCB8PSBQ
TEFORV9DT0xPUl9DU0NfTU9ERV9ZVVY3MDlfVE9fUkdCNzA5OworCQkJYnJlYWs7CisJCWNhc2Ug
RFJNX0NPTE9SX1lDQkNSX0JUMjAyMDoKKwkJCXBsYW5lX2NvbG9yX2N0bCB8PQorCQkJCVBMQU5F
X0NPTE9SX0NTQ19NT0RFX1lVVjIwMjBfVE9fUkdCMjAyMDsKKwkJCWJyZWFrOworCQlkZWZhdWx0
OgorCQkJcGxhbmVfY29sb3JfY3RsIHw9CisJCQkJUExBTkVfQ09MT1JfQ1NDX01PREVfWVVWNjAx
X1RPX1JHQjYwMTsKKwkJfQorCQlpZiAocGxhbmVfc3RhdGUtPmh3LmNvbG9yX3JhbmdlID09IERS
TV9DT0xPUl9ZQ0JDUl9GVUxMX1JBTkdFKQorCQkJcGxhbmVfY29sb3JfY3RsIHw9IFBMQU5FX0NP
TE9SX1lVVl9SQU5HRV9DT1JSRUNUSU9OX0RJU0FCTEU7CisJfSBlbHNlIGlmIChmYi0+Zm9ybWF0
LT5pc195dXYpIHsKKwkJcGxhbmVfY29sb3JfY3RsIHw9IFBMQU5FX0NPTE9SX0lOUFVUX0NTQ19F
TkFCTEU7CisJfQorCisJcmV0dXJuIHBsYW5lX2NvbG9yX2N0bDsKK30KKworc3RhdGljIGludAor
bWFpbl90b19jY3NfcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBt
YWluX3BsYW5lKQoreworCWRybV9XQVJOX09OKGZiLT5kZXYsICFpc19jY3NfbW9kaWZpZXIoZmIt
Pm1vZGlmaWVyKSB8fAorCQkgICAgKG1haW5fcGxhbmUgJiYgbWFpbl9wbGFuZSA+PSBmYi0+Zm9y
bWF0LT5udW1fcGxhbmVzIC8gMikpOworCisJcmV0dXJuIGZiLT5mb3JtYXQtPm51bV9wbGFuZXMg
LyAyICsgbWFpbl9wbGFuZTsKK30KKworaW50IHNrbF9jY3NfdG9fbWFpbl9wbGFuZShjb25zdCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNjc19wbGFuZSkKK3sKKwlkcm1fV0FSTl9P
TihmYi0+ZGV2LCAhaXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikgfHwKKwkJICAgIGNjc19w
bGFuZSA8IGZiLT5mb3JtYXQtPm51bV9wbGFuZXMgLyAyKTsKKworCXJldHVybiBjY3NfcGxhbmUg
LSBmYi0+Zm9ybWF0LT5udW1fcGxhbmVzIC8gMjsKK30KKworCitzdGF0aWMgaW50Citza2xfbWFp
bl90b19hdXhfcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBtYWlu
X3BsYW5lKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShmYi0+
ZGV2KTsKKworCWlmIChpc19jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSkKKwkJcmV0dXJuIG1h
aW5fdG9fY2NzX3BsYW5lKGZiLCBtYWluX3BsYW5lKTsKKwllbHNlIGlmIChJTlRFTF9HRU4oaTkx
NSkgPCAxMSAmJgorCQkgaW50ZWxfZm9ybWF0X2luZm9faXNfeXV2X3NlbWlwbGFuYXIoZmItPmZv
cm1hdCwgZmItPm1vZGlmaWVyKSkKKwkJcmV0dXJuIDE7CisJZWxzZQorCQlyZXR1cm4gMDsKK30K
Kworc3RhdGljIHZvaWQKK3NrbF9wcm9ncmFtX3BsYW5lKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxh
bmUsCisJCSAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCSAg
Y29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKKwkJICBpbnQgY29s
b3JfcGxhbmUpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShwbGFuZS0+YmFzZS5kZXYpOworCWVudW0gcGxhbmVfaWQgcGxhbmVfaWQgPSBwbGFuZS0+aWQ7
CisJZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlwZTsKKwljb25zdCBzdHJ1Y3QgZHJtX2ludGVs
X3Nwcml0ZV9jb2xvcmtleSAqa2V5ID0gJnBsYW5lX3N0YXRlLT5ja2V5OworCXUzMiBzdXJmX2Fk
ZHIgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY29sb3JfcGxhbmVdLm9mZnNldDsKKwl1MzIg
c3RyaWRlID0gc2tsX3BsYW5lX3N0cmlkZShwbGFuZV9zdGF0ZSwgY29sb3JfcGxhbmUpOworCWNv
bnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOworCWlu
dCBhdXhfcGxhbmUgPSBza2xfbWFpbl90b19hdXhfcGxhbmUoZmIsIGNvbG9yX3BsYW5lKTsKKwlp
bnQgY3J0Y194ID0gcGxhbmVfc3RhdGUtPnVhcGkuZHN0LngxOworCWludCBjcnRjX3kgPSBwbGFu
ZV9zdGF0ZS0+dWFwaS5kc3QueTE7CisJdTMyIHggPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVb
Y29sb3JfcGxhbmVdLng7CisJdTMyIHkgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY29sb3Jf
cGxhbmVdLnk7CisJdTMyIHNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBp
LnNyYykgPj4gMTY7CisJdTMyIHNyY19oID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+
dWFwaS5zcmMpID4+IDE2OworCXU4IGFscGhhID0gcGxhbmVfc3RhdGUtPmh3LmFscGhhID4+IDg7
CisJdTMyIHBsYW5lX2NvbG9yX2N0bCA9IDAsIGF1eF9kaXN0ID0gMDsKKwl1bnNpZ25lZCBsb25n
IGlycWZsYWdzOworCXUzMiBrZXltc2ssIGtleW1heDsKKwl1MzIgcGxhbmVfY3RsID0gcGxhbmVf
c3RhdGUtPmN0bDsKKworCXBsYW5lX2N0bCB8PSBza2xfcGxhbmVfY3RsX2NydGMoY3J0Y19zdGF0
ZSk7CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRl
dl9wcml2KSkKKwkJcGxhbmVfY29sb3JfY3RsID0gcGxhbmVfc3RhdGUtPmNvbG9yX2N0bCB8CisJ
CQlnbGtfcGxhbmVfY29sb3JfY3RsX2NydGMoY3J0Y19zdGF0ZSk7CisKKwkvKiBTaXplcyBhcmUg
MCBiYXNlZCAqLworCXNyY193LS07CisJc3JjX2gtLTsKKworCWtleW1heCA9IChrZXktPm1heF92
YWx1ZSAmIDB4ZmZmZmZmKSB8IFBMQU5FX0tFWU1BWF9BTFBIQShhbHBoYSk7CisKKwlrZXltc2sg
PSBrZXktPmNoYW5uZWxfbWFzayAmIDB4N2ZmZmZmZjsKKwlpZiAoYWxwaGEgPCAweGZmKQorCQlr
ZXltc2sgfD0gUExBTkVfS0VZTVNLX0FMUEhBX0VOQUJMRTsKKworCS8qIFRoZSBzY2FsZXIgd2ls
bCBoYW5kbGUgdGhlIG91dHB1dCBwb3NpdGlvbiAqLworCWlmIChwbGFuZV9zdGF0ZS0+c2NhbGVy
X2lkID49IDApIHsKKwkJY3J0Y194ID0gMDsKKwkJY3J0Y195ID0gMDsKKwl9CisKKwlpZiAoYXV4
X3BsYW5lKSB7CisJCWF1eF9kaXN0ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2F1eF9wbGFu
ZV0ub2Zmc2V0IC0gc3VyZl9hZGRyOworCisJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTIp
CisJCQlhdXhfZGlzdCB8PSBza2xfcGxhbmVfc3RyaWRlKHBsYW5lX3N0YXRlLCBhdXhfcGxhbmUp
OworCX0KKworCXNwaW5fbG9ja19pcnFzYXZlKCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZs
YWdzKTsKKworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9TVFJJREUocGlwZSwg
cGxhbmVfaWQpLCBzdHJpZGUpOworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9Q
T1MocGlwZSwgcGxhbmVfaWQpLAorCQkJICAoY3J0Y195IDw8IDE2KSB8IGNydGNfeCk7CisJaW50
ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX1NJWkUocGlwZSwgcGxhbmVfaWQpLAorCQkJ
ICAoc3JjX2ggPDwgMTYpIHwgc3JjX3cpOworCisJaW50ZWxfZGVfd3JpdGVfZncoZGV2X3ByaXYs
IFBMQU5FX0FVWF9ESVNUKHBpcGUsIHBsYW5lX2lkKSwgYXV4X2Rpc3QpOworCisJaWYgKGljbF9p
c19oZHJfcGxhbmUoZGV2X3ByaXYsIHBsYW5lX2lkKSkKKwkJaW50ZWxfZGVfd3JpdGVfZncoZGV2
X3ByaXYsIFBMQU5FX0NVU19DVEwocGlwZSwgcGxhbmVfaWQpLAorCQkJCSAgcGxhbmVfc3RhdGUt
PmN1c19jdGwpOworCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5J
TEFLRShkZXZfcHJpdikpCisJCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9DT0xP
Ul9DVEwocGlwZSwgcGxhbmVfaWQpLAorCQkJCSAgcGxhbmVfY29sb3JfY3RsKTsKKworCWlmIChm
Yi0+Zm9ybWF0LT5pc195dXYgJiYgaWNsX2lzX2hkcl9wbGFuZShkZXZfcHJpdiwgcGxhbmVfaWQp
KQorCQlpY2xfcHJvZ3JhbV9pbnB1dF9jc2MocGxhbmUsIGNydGNfc3RhdGUsIHBsYW5lX3N0YXRl
KTsKKworCXNrbF93cml0ZV9wbGFuZV93bShwbGFuZSwgY3J0Y19zdGF0ZSk7CisKKwlpbnRlbF9k
ZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfS0VZVkFMKHBpcGUsIHBsYW5lX2lkKSwKKwkJCSAg
a2V5LT5taW5fdmFsdWUpOworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9LRVlN
U0socGlwZSwgcGxhbmVfaWQpLCBrZXltc2spOworCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2
LCBQTEFORV9LRVlNQVgocGlwZSwgcGxhbmVfaWQpLCBrZXltYXgpOworCisJaW50ZWxfZGVfd3Jp
dGVfZncoZGV2X3ByaXYsIFBMQU5FX09GRlNFVChwaXBlLCBwbGFuZV9pZCksCisJCQkgICh5IDw8
IDE2KSB8IHgpOworCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMSkKKwkJaW50ZWxfZGVf
d3JpdGVfZncoZGV2X3ByaXYsIFBMQU5FX0FVWF9PRkZTRVQocGlwZSwgcGxhbmVfaWQpLAorCQkJ
CSAgKHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVsxXS55IDw8IDE2KSB8IHBsYW5lX3N0YXRlLT5j
b2xvcl9wbGFuZVsxXS54KTsKKworCWlmICghZHJtX2F0b21pY19jcnRjX25lZWRzX21vZGVzZXQo
JmNydGNfc3RhdGUtPnVhcGkpKQorCQlpbnRlbF9wc3IyX3Byb2dyYW1fcGxhbmVfc2VsX2ZldGNo
KHBsYW5lLCBjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSwgY29sb3JfcGxhbmUpOworCisJLyoKKwkg
KiBUaGUgY29udHJvbCByZWdpc3RlciBzZWxmLWFybXMgaWYgdGhlIHBsYW5lIHdhcyBwcmV2aW91
c2x5CisJICogZGlzYWJsZWQuIFRyeSB0byBtYWtlIHRoZSBwbGFuZSBlbmFibGUgYXRvbWljIGJ5
IHdyaXRpbmcKKwkgKiB0aGUgY29udHJvbCByZWdpc3RlciBqdXN0IGJlZm9yZSB0aGUgc3VyZmFj
ZSByZWdpc3Rlci4KKwkgKi8KKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfQ1RM
KHBpcGUsIHBsYW5lX2lkKSwgcGxhbmVfY3RsKTsKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZfcHJp
diwgUExBTkVfU1VSRihwaXBlLCBwbGFuZV9pZCksCisJCQkgIGludGVsX3BsYW5lX2dndHRfb2Zm
c2V0KHBsYW5lX3N0YXRlKSArIHN1cmZfYWRkcik7CisKKwlpZiAocGxhbmVfc3RhdGUtPnNjYWxl
cl9pZCA+PSAwKQorCQlza2xfcHJvZ3JhbV9zY2FsZXIocGxhbmUsIGNydGNfc3RhdGUsIHBsYW5l
X3N0YXRlKTsKKworCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmRldl9wcml2LT51bmNvcmUubG9j
aywgaXJxZmxhZ3MpOworfQorCitzdGF0aWMgdm9pZAorc2tsX3BsYW5lX2FzeW5jX2ZsaXAoc3Ry
dWN0IGludGVsX3BsYW5lICpwbGFuZSwKKwkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSwKKwkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUg
KnBsYW5lX3N0YXRlKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKKwl1bnNpZ25lZCBsb25nIGlycWZsYWdzOworCWVudW0g
cGxhbmVfaWQgcGxhbmVfaWQgPSBwbGFuZS0+aWQ7CisJZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+
cGlwZTsKKwl1MzIgc3VyZl9hZGRyID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLm9mZnNl
dDsKKwl1MzIgcGxhbmVfY3RsID0gcGxhbmVfc3RhdGUtPmN0bDsKKworCXBsYW5lX2N0bCB8PSBz
a2xfcGxhbmVfY3RsX2NydGMoY3J0Y19zdGF0ZSk7CisKKwlzcGluX2xvY2tfaXJxc2F2ZSgmZGV2
X3ByaXYtPnVuY29yZS5sb2NrLCBpcnFmbGFncyk7CisKKwlpbnRlbF9kZV93cml0ZV9mdyhkZXZf
cHJpdiwgUExBTkVfQ1RMKHBpcGUsIHBsYW5lX2lkKSwgcGxhbmVfY3RsKTsKKwlpbnRlbF9kZV93
cml0ZV9mdyhkZXZfcHJpdiwgUExBTkVfU1VSRihwaXBlLCBwbGFuZV9pZCksCisJCQkgIGludGVs
X3BsYW5lX2dndHRfb2Zmc2V0KHBsYW5lX3N0YXRlKSArIHN1cmZfYWRkcik7CisKKwlzcGluX3Vu
bG9ja19pcnFyZXN0b3JlKCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsKK30KKwor
c3RhdGljIHZvaWQKK3NrbF91cGRhdGVfcGxhbmUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwK
KwkJIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkgY29uc3Qg
c3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKK3sKKwlpbnQgY29sb3JfcGxh
bmUgPSAwOworCisJaWYgKHBsYW5lX3N0YXRlLT5wbGFuYXJfbGlua2VkX3BsYW5lICYmICFwbGFu
ZV9zdGF0ZS0+cGxhbmFyX3NsYXZlKQorCQkvKiBQcm9ncmFtIHRoZSBVViBwbGFuZSBvbiBwbGFu
YXIgbWFzdGVyICovCisJCWNvbG9yX3BsYW5lID0gMTsKKworCXNrbF9wcm9ncmFtX3BsYW5lKHBs
YW5lLCBjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSwgY29sb3JfcGxhbmUpOworfQorCitzdGF0aWMg
Ym9vbCBpbnRlbF9mb3JtYXRfaXNfcDAxeCh1MzIgZm9ybWF0KQoreworCXN3aXRjaCAoZm9ybWF0
KSB7CisJY2FzZSBEUk1fRk9STUFUX1AwMTA6CisJY2FzZSBEUk1fRk9STUFUX1AwMTI6CisJY2Fz
ZSBEUk1fRk9STUFUX1AwMTY6CisJCXJldHVybiB0cnVlOworCWRlZmF1bHQ6CisJCXJldHVybiBm
YWxzZTsKKwl9Cit9CisKK3N0YXRpYyBpbnQgc2tsX3BsYW5lX2NoZWNrX2ZiKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJICAgICAgY29uc3Qgc3RydWN0IGlu
dGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBs
YW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKKwlj
b25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKKwl1
bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247CisJc3RydWN0
IGRybV9mb3JtYXRfbmFtZV9idWYgZm9ybWF0X25hbWU7CisKKwlpZiAoIWZiKQorCQlyZXR1cm4g
MDsKKworCWlmIChyb3RhdGlvbiAmIH4oRFJNX01PREVfUk9UQVRFXzAgfCBEUk1fTU9ERV9ST1RB
VEVfMTgwKSAmJgorCSAgICBpc19jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSkgeworCQlkcm1f
ZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwkJCSAgICAiUkMgc3VwcG9ydCBvbmx5IHdpdGggMC8x
ODAgZGVncmVlIHJvdGF0aW9uICgleClcbiIsCisJCQkgICAgcm90YXRpb24pOworCQlyZXR1cm4g
LUVJTlZBTDsKKwl9CisKKwlpZiAocm90YXRpb24gJiBEUk1fTU9ERV9SRUZMRUNUX1ggJiYKKwkg
ICAgZmItPm1vZGlmaWVyID09IERSTV9GT1JNQVRfTU9EX0xJTkVBUikgeworCQlkcm1fZGJnX2tt
cygmZGV2X3ByaXYtPmRybSwKKwkJCSAgICAiaG9yaXpvbnRhbCBmbGlwIGlzIG5vdCBzdXBwb3J0
ZWQgd2l0aCBsaW5lYXIgc3VyZmFjZSBmb3JtYXRzXG4iKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJ
fQorCisJaWYgKGRybV9yb3RhdGlvbl85MF9vcl8yNzAocm90YXRpb24pKSB7CisJCWlmIChmYi0+
bW9kaWZpZXIgIT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQgJiYKKwkJICAgIGZiLT5tb2RpZmll
ciAhPSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRUQpIHsKKwkJCWRybV9kYmdfa21zKCZkZXZfcHJp
di0+ZHJtLAorCQkJCSAgICAiWS9ZZiB0aWxpbmcgcmVxdWlyZWQgZm9yIDkwLzI3MCFcbiIpOwor
CQkJcmV0dXJuIC1FSU5WQUw7CisJCX0KKworCQkvKgorCQkgKiA5MC8yNzAgaXMgbm90IGFsbG93
ZWQgd2l0aCBSR0I2NCAxNjoxNjoxNjoxNiBhbmQKKwkJICogSW5kZXhlZCA4LWJpdC4gUkdCIDE2
LWJpdCA1OjY6NSBpcyBhbGxvd2VkIGdlbjExIG9ud2FyZHMuCisJCSAqLworCQlzd2l0Y2ggKGZi
LT5mb3JtYXQtPmZvcm1hdCkgeworCQljYXNlIERSTV9GT1JNQVRfUkdCNTY1OgorCQkJaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCisJCQkJYnJlYWs7CisJCQlmYWxsdGhyb3VnaDsKKwkJ
Y2FzZSBEUk1fRk9STUFUX0M4OgorCQljYXNlIERSTV9GT1JNQVRfWFJHQjE2MTYxNjE2RjoKKwkJ
Y2FzZSBEUk1fRk9STUFUX1hCR1IxNjE2MTYxNkY6CisJCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMTYx
NjE2MTZGOgorCQljYXNlIERSTV9GT1JNQVRfQUJHUjE2MTYxNjE2RjoKKwkJY2FzZSBEUk1fRk9S
TUFUX1kyMTA6CisJCWNhc2UgRFJNX0ZPUk1BVF9ZMjEyOgorCQljYXNlIERSTV9GT1JNQVRfWTIx
NjoKKwkJY2FzZSBEUk1fRk9STUFUX1hWWVUxMl8xNjE2MTYxNjoKKwkJY2FzZSBEUk1fRk9STUFU
X1hWWVUxNjE2MTYxNjoKKwkJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJCSAgICAi
VW5zdXBwb3J0ZWQgcGl4ZWwgZm9ybWF0ICVzIGZvciA5MC8yNzAhXG4iLAorCQkJCSAgICBkcm1f
Z2V0X2Zvcm1hdF9uYW1lKGZiLT5mb3JtYXQtPmZvcm1hdCwKKwkJCQkJCQkmZm9ybWF0X25hbWUp
KTsKKwkJCXJldHVybiAtRUlOVkFMOworCQlkZWZhdWx0OgorCQkJYnJlYWs7CisJCX0KKwl9CisK
KwkvKiBZLXRpbGluZyBpcyBub3Qgc3VwcG9ydGVkIGluIElGLUlEIEludGVybGFjZSBtb2RlICov
CisJaWYgKGNydGNfc3RhdGUtPmh3LmVuYWJsZSAmJgorCSAgICBjcnRjX3N0YXRlLT5ody5hZGp1
c3RlZF9tb2RlLmZsYWdzICYgRFJNX01PREVfRkxBR19JTlRFUkxBQ0UgJiYKKwkgICAgKGZiLT5t
b2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRCB8fAorCSAgICAgZmItPm1vZGlmaWVy
ID09IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRCB8fAorCSAgICAgZmItPm1vZGlmaWVyID09IEk5
MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUyB8fAorCSAgICAgZmItPm1vZGlmaWVyID09IEk5MTVf
Rk9STUFUX01PRF9ZZl9USUxFRF9DQ1MgfHwKKwkgICAgIGZiLT5tb2RpZmllciA9PSBJOTE1X0ZP
Uk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1MgfHwKKwkgICAgIGZiLT5tb2RpZmllciA9PSBJ
OTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9NQ19DQ1MpKSB7CisJCWRybV9kYmdfa21zKCZk
ZXZfcHJpdi0+ZHJtLAorCQkJICAgICJZL1lmIHRpbGluZyBub3Qgc3VwcG9ydGVkIGluIElGLUlE
IG1vZGVcbiIpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwkvKiBXYV8xNjA2MDU0MTg4OnRn
bCAqLworCWlmIChJU19USUdFUkxBS0UoZGV2X3ByaXYpICYmCisJICAgIHBsYW5lX3N0YXRlLT5j
a2V5LmZsYWdzICYgSTkxNV9TRVRfQ09MT1JLRVlfU09VUkNFICYmCisJICAgIGludGVsX2Zvcm1h
dF9pc19wMDF4KGZiLT5mb3JtYXQtPmZvcm1hdCkpIHsKKwkJZHJtX2RiZ19rbXMoJmRldl9wcml2
LT5kcm0sCisJCQkgICAgIlNvdXJjZSBjb2xvciBrZXlpbmcgbm90IHN1cHBvcnRlZCB3aXRoIFAw
MXggZm9ybWF0c1xuIik7CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCXJldHVybiAwOworfQor
CitzdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVja19kc3RfY29vcmRpbmF0ZXMoY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkJCSAgIGNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0KKwkJdG9faTkxNShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZS0+ZGV2KTsKKwlp
bnQgY3J0Y194ID0gcGxhbmVfc3RhdGUtPnVhcGkuZHN0LngxOworCWludCBjcnRjX3cgPSBkcm1f
cmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPnVhcGkuZHN0KTsKKwlpbnQgcGlwZV9zcmNfdyA9IGNy
dGNfc3RhdGUtPnBpcGVfc3JjX3c7CisKKwkvKgorCSAqIERpc3BsYXkgV0EgIzExNzU6IGNubCxn
bGsKKwkgKiBQbGFuZXMgb3RoZXIgdGhhbiB0aGUgY3Vyc29yIG1heSBjYXVzZSBGSUZPIHVuZGVy
ZmxvdyBhbmQgZGlzcGxheQorCSAqIGNvcnJ1cHRpb24gaWYgc3RhcnRpbmcgbGVzcyB0aGFuIDQg
cGl4ZWxzIGZyb20gdGhlIHJpZ2h0IGVkZ2Ugb2YKKwkgKiB0aGUgc2NyZWVuLgorCSAqIEJlc2lk
ZXMgdGhlIGFib3ZlIFdBIGZpeCB0aGUgc2ltaWxhciBwcm9ibGVtLCB3aGVyZSBwbGFuZXMgb3Ro
ZXIKKwkgKiB0aGFuIHRoZSBjdXJzb3IgZW5kaW5nIGxlc3MgdGhhbiA0IHBpeGVscyBmcm9tIHRo
ZSBsZWZ0IGVkZ2Ugb2YgdGhlCisJICogc2NyZWVuIG1heSBjYXVzZSBGSUZPIHVuZGVyZmxvdyBh
bmQgZGlzcGxheSBjb3JydXB0aW9uLgorCSAqLworCWlmICgoSVNfR0VNSU5JTEFLRShkZXZfcHJp
dikgfHwgSVNfQ0FOTk9OTEFLRShkZXZfcHJpdikpICYmCisJICAgIChjcnRjX3ggKyBjcnRjX3cg
PCA0IHx8IGNydGNfeCA+IHBpcGVfc3JjX3cgLSA0KSkgeworCQlkcm1fZGJnX2ttcygmZGV2X3By
aXYtPmRybSwKKwkJCSAgICAicmVxdWVzdGVkIHBsYW5lIFggJXMgcG9zaXRpb24gJWQgaW52YWxp
ZCAodmFsaWQgcmFuZ2UgJWQtJWQpXG4iLAorCQkJICAgIGNydGNfeCArIGNydGNfdyA8IDQgPyAi
ZW5kIiA6ICJzdGFydCIsCisJCQkgICAgY3J0Y194ICsgY3J0Y193IDwgNCA/IGNydGNfeCArIGNy
dGNfdyA6IGNydGNfeCwKKwkJCSAgICA0LCBwaXBlX3NyY193IC0gNCk7CisJCXJldHVybiAtRVJB
TkdFOworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVja19u
djEyX3JvdGF0aW9uKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUp
Cit7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcu
ZmI7CisJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwor
CWludCBzcmNfdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2
OworCisJLyogRGlzcGxheSBXQSAjMTEwNiAqLworCWlmIChpbnRlbF9mb3JtYXRfaW5mb19pc195
dXZfc2VtaXBsYW5hcihmYi0+Zm9ybWF0LCBmYi0+bW9kaWZpZXIpICYmCisJICAgIHNyY193ICYg
MyAmJgorCSAgICAocm90YXRpb24gPT0gRFJNX01PREVfUk9UQVRFXzI3MCB8fAorCSAgICAgcm90
YXRpb24gPT0gKERSTV9NT0RFX1JFRkxFQ1RfWCB8IERSTV9NT0RFX1JPVEFURV85MCkpKSB7CisJ
CURSTV9ERUJVR19LTVMoInNyYyB3aWR0aCBtdXN0IGJlIG11bHRpcGxlIG9mIDQgZm9yIHJvdGF0
ZWQgcGxhbmFyIFlVVlxuIik7CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCXJldHVybiAwOwor
fQorCitzdGF0aWMgaW50IHNrbF9wbGFuZV9tYXhfc2NhbGUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAorCQkJICAgICAgIGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
KQoreworCS8qCisJICogV2UgZG9uJ3QgeWV0IGtub3cgdGhlIGZpbmFsIHNvdXJjZSB3aWR0aCBu
b3IKKwkgKiB3aGV0aGVyIHdlIGNhbiB1c2UgdGhlIEhRIHNjYWxlciBtb2RlLiBBc3N1bWUKKwkg
KiB0aGUgYmVzdCBjYXNlLgorCSAqIEZJWE1FIG5lZWQgdG8gcHJvcGVybHkgY2hlY2sgdGhpcyBs
YXRlci4KKwkgKi8KKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklM
QUtFKGRldl9wcml2KSB8fAorCSAgICAhaW50ZWxfZm9ybWF0X2luZm9faXNfeXV2X3NlbWlwbGFu
YXIoZmItPmZvcm1hdCwgZmItPm1vZGlmaWVyKSkKKwkJcmV0dXJuIDB4MzAwMDAgLSAxOworCWVs
c2UKKwkJcmV0dXJuIDB4MjAwMDAgLSAxOworfQorCitzdGF0aWMgaW50IGludGVsX3BsYW5lX21p
bl93aWR0aChzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAorCQkJCSBjb25zdCBzdHJ1Y3QgZHJt
X2ZyYW1lYnVmZmVyICpmYiwKKwkJCQkgaW50IGNvbG9yX3BsYW5lLAorCQkJCSB1bnNpZ25lZCBp
bnQgcm90YXRpb24pCit7CisJaWYgKHBsYW5lLT5taW5fd2lkdGgpCisJCXJldHVybiBwbGFuZS0+
bWluX3dpZHRoKGZiLCBjb2xvcl9wbGFuZSwgcm90YXRpb24pOworCWVsc2UKKwkJcmV0dXJuIDE7
Cit9CisKK3N0YXRpYyBpbnQgaW50ZWxfcGxhbmVfbWF4X3dpZHRoKHN0cnVjdCBpbnRlbF9wbGFu
ZSAqcGxhbmUsCisJCQkJIGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAorCQkJCSBp
bnQgY29sb3JfcGxhbmUsCisJCQkJIHVuc2lnbmVkIGludCByb3RhdGlvbikKK3sKKwlpZiAocGxh
bmUtPm1heF93aWR0aCkKKwkJcmV0dXJuIHBsYW5lLT5tYXhfd2lkdGgoZmIsIGNvbG9yX3BsYW5l
LCByb3RhdGlvbik7CisJZWxzZQorCQlyZXR1cm4gSU5UX01BWDsKK30KKworc3RhdGljIGludCBp
bnRlbF9wbGFuZV9tYXhfaGVpZ2h0KHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCisJCQkJICBj
b25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKKwkJCQkgIGludCBjb2xvcl9wbGFuZSwK
KwkJCQkgIHVuc2lnbmVkIGludCByb3RhdGlvbikKK3sKKwlpZiAocGxhbmUtPm1heF9oZWlnaHQp
CisJCXJldHVybiBwbGFuZS0+bWF4X2hlaWdodChmYiwgY29sb3JfcGxhbmUsIHJvdGF0aW9uKTsK
KwllbHNlCisJCXJldHVybiBJTlRfTUFYOworfQorCitzdGF0aWMgYm9vbAorc2tsX2NoZWNrX21h
aW5fY2NzX2Nvb3JkaW5hdGVzKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUs
CisJCQkgICAgICAgaW50IG1haW5feCwgaW50IG1haW5feSwgdTMyIG1haW5fb2Zmc2V0LAorCQkJ
ICAgICAgIGludCBjY3NfcGxhbmUpCit7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAq
ZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CisJaW50IGF1eF94ID0gcGxhbmVfc3RhdGUtPmNvbG9y
X3BsYW5lW2Njc19wbGFuZV0ueDsKKwlpbnQgYXV4X3kgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxh
bmVbY2NzX3BsYW5lXS55OworCXUzMiBhdXhfb2Zmc2V0ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3Bs
YW5lW2Njc19wbGFuZV0ub2Zmc2V0OworCXUzMiBhbGlnbm1lbnQgPSBpbnRlbF9zdXJmX2FsaWdu
bWVudChmYiwgY2NzX3BsYW5lKTsKKwlpbnQgaHN1YjsKKwlpbnQgdnN1YjsKKworCWludGVsX2Zi
X3BsYW5lX2dldF9zdWJzYW1wbGluZygmaHN1YiwgJnZzdWIsIGZiLCBjY3NfcGxhbmUpOworCXdo
aWxlIChhdXhfb2Zmc2V0ID49IG1haW5fb2Zmc2V0ICYmIGF1eF95IDw9IG1haW5feSkgeworCQlp
bnQgeCwgeTsKKworCQlpZiAoYXV4X3ggPT0gbWFpbl94ICYmIGF1eF95ID09IG1haW5feSkKKwkJ
CWJyZWFrOworCisJCWlmIChhdXhfb2Zmc2V0ID09IDApCisJCQlicmVhazsKKworCQl4ID0gYXV4
X3ggLyBoc3ViOworCQl5ID0gYXV4X3kgLyB2c3ViOworCQlhdXhfb2Zmc2V0ID0gaW50ZWxfcGxh
bmVfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KCZ4LCAmeSwKKwkJCQkJCQkgICAgICAgcGxhbmVfc3Rh
dGUsCisJCQkJCQkJICAgICAgIGNjc19wbGFuZSwKKwkJCQkJCQkgICAgICAgYXV4X29mZnNldCwK
KwkJCQkJCQkgICAgICAgYXV4X29mZnNldCAtCisJCQkJCQkJCWFsaWdubWVudCk7CisJCWF1eF94
ID0geCAqIGhzdWIgKyBhdXhfeCAlIGhzdWI7CisJCWF1eF95ID0geSAqIHZzdWIgKyBhdXhfeSAl
IHZzdWI7CisJfQorCisJaWYgKGF1eF94ICE9IG1haW5feCB8fCBhdXhfeSAhPSBtYWluX3kpCisJ
CXJldHVybiBmYWxzZTsKKworCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLm9m
ZnNldCA9IGF1eF9vZmZzZXQ7CisJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0u
eCA9IGF1eF94OworCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLnkgPSBhdXhf
eTsKKworCXJldHVybiB0cnVlOworfQorCisKK2ludCBza2xfY2FsY19tYWluX3N1cmZhY2Vfb2Zm
c2V0KGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCisJCQkJIGlu
dCAqeCwgaW50ICp5LCB1MzIgKm9mZnNldCkKK3sKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5l
ID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPnVhcGkucGxhbmUpOworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKKwljb25z
dCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKKwljb25z
dCBpbnQgYXV4X3BsYW5lID0gc2tsX21haW5fdG9fYXV4X3BsYW5lKGZiLCAwKTsKKwljb25zdCB1
MzIgYXV4X29mZnNldCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVthdXhfcGxhbmVdLm9mZnNl
dDsKKwljb25zdCB1MzIgYWxpZ25tZW50ID0gaW50ZWxfc3VyZl9hbGlnbm1lbnQoZmIsIDApOwor
CWNvbnN0IGludCB3ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT51YXBpLnNyYykgPj4g
MTY7CisKKwlpbnRlbF9hZGRfZmJfb2Zmc2V0cyh4LCB5LCBwbGFuZV9zdGF0ZSwgMCk7CisJKm9m
ZnNldCA9IGludGVsX3BsYW5lX2NvbXB1dGVfYWxpZ25lZF9vZmZzZXQoeCwgeSwgcGxhbmVfc3Rh
dGUsIDApOworCWlmIChkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwgYWxpZ25tZW50ICYmICFp
c19wb3dlcl9vZl8yKGFsaWdubWVudCkpKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCS8qCisJICog
QVVYIHN1cmZhY2Ugb2Zmc2V0IGlzIHNwZWNpZmllZCBhcyB0aGUgZGlzdGFuY2UgZnJvbSB0aGUK
KwkgKiBtYWluIHN1cmZhY2Ugb2Zmc2V0LCBhbmQgaXQgbXVzdCBiZSBub24tbmVnYXRpdmUuIE1h
a2UKKwkgKiBzdXJlIHRoYXQgaXMgd2hhdCB3ZSB3aWxsIGdldC4KKwkgKi8KKwlpZiAoYXV4X3Bs
YW5lICYmICpvZmZzZXQgPiBhdXhfb2Zmc2V0KQorCQkqb2Zmc2V0ID0gaW50ZWxfcGxhbmVfYWRq
dXN0X2FsaWduZWRfb2Zmc2V0KHgsIHksIHBsYW5lX3N0YXRlLCAwLAorCQkJCQkJCSAgICAqb2Zm
c2V0LAorCQkJCQkJCSAgICBhdXhfb2Zmc2V0ICYgfihhbGlnbm1lbnQgLSAxKSk7CisKKwkvKgor
CSAqIFdoZW4gdXNpbmcgYW4gWC10aWxlZCBzdXJmYWNlLCB0aGUgcGxhbmUgYmxvd3MgdXAKKwkg
KiBpZiB0aGUgeCBvZmZzZXQgKyB3aWR0aCBleGNlZWQgdGhlIHN0cmlkZS4KKwkgKgorCSAqIFRP
RE86IGxpbmVhciBhbmQgWS10aWxlZCBzZWVtIGZpbmUsIFlmIHVudGVzdGVkLAorCSAqLworCWlm
IChmYi0+bW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQpIHsKKwkJaW50IGNwcCA9
IGZiLT5mb3JtYXQtPmNwcFswXTsKKworCQl3aGlsZSAoKCp4ICsgdykgKiBjcHAgPiBwbGFuZV9z
dGF0ZS0+Y29sb3JfcGxhbmVbMF0uc3RyaWRlKSB7CisJCQlpZiAoKm9mZnNldCA9PSAwKSB7CisJ
CQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCQkJCSAgICAiVW5hYmxlIHRvIGZpbmQg
c3VpdGFibGUgZGlzcGxheSBzdXJmYWNlIG9mZnNldCBkdWUgdG8gWC10aWxpbmdcbiIpOworCQkJ
CXJldHVybiAtRUlOVkFMOworCQkJfQorCisJCQkqb2Zmc2V0ID0gaW50ZWxfcGxhbmVfYWRqdXN0
X2FsaWduZWRfb2Zmc2V0KHgsIHksIHBsYW5lX3N0YXRlLCAwLAorCQkJCQkJCQkgICAgKm9mZnNl
dCwKKwkJCQkJCQkJICAgICpvZmZzZXQgLSBhbGlnbm1lbnQpOworCQl9CisJfQorCisJcmV0dXJu
IDA7Cit9CisKK3N0YXRpYyBpbnQgc2tsX2NoZWNrX21haW5fc3VyZmFjZShzdHJ1Y3QgaW50ZWxf
cGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQoreworCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUg
PSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOworCWNvbnN0
IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOworCWNvbnN0
IHVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKKwlpbnQg
eCA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy54MSA+PiAxNjsKKwlpbnQgeSA9IHBsYW5lX3N0YXRl
LT51YXBpLnNyYy55MSA+PiAxNjsKKwljb25zdCBpbnQgdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFu
ZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OworCWNvbnN0IGludCBoID0gZHJtX3JlY3RfaGVpZ2h0
KCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpID4+IDE2OworCWNvbnN0IGludCBtaW5fd2lkdGggPSBp
bnRlbF9wbGFuZV9taW5fd2lkdGgocGxhbmUsIGZiLCAwLCByb3RhdGlvbik7CisJY29uc3QgaW50
IG1heF93aWR0aCA9IGludGVsX3BsYW5lX21heF93aWR0aChwbGFuZSwgZmIsIDAsIHJvdGF0aW9u
KTsKKwljb25zdCBpbnQgbWF4X2hlaWdodCA9IGludGVsX3BsYW5lX21heF9oZWlnaHQocGxhbmUs
IGZiLCAwLCByb3RhdGlvbik7CisJY29uc3QgaW50IGF1eF9wbGFuZSA9IHNrbF9tYWluX3RvX2F1
eF9wbGFuZShmYiwgMCk7CisJY29uc3QgdTMyIGFsaWdubWVudCA9IGludGVsX3N1cmZfYWxpZ25t
ZW50KGZiLCAwKTsKKwl1MzIgb2Zmc2V0OworCWludCByZXQ7CisKKwlpZiAodyA+IG1heF93aWR0
aCB8fCB3IDwgbWluX3dpZHRoIHx8IGggPiBtYXhfaGVpZ2h0KSB7CisJCWRybV9kYmdfa21zKCZk
ZXZfcHJpdi0+ZHJtLAorCQkJICAgICJyZXF1ZXN0ZWQgWS9SR0Igc291cmNlIHNpemUgJWR4JWQg
b3V0c2lkZSBsaW1pdHMgKG1pbjogJWR4MSBtYXg6ICVkeCVkKVxuIiwKKwkJCSAgICB3LCBoLCBt
aW5fd2lkdGgsIG1heF93aWR0aCwgbWF4X2hlaWdodCk7CisJCXJldHVybiAtRUlOVkFMOworCX0K
KworCXJldCA9IHNrbF9jYWxjX21haW5fc3VyZmFjZV9vZmZzZXQocGxhbmVfc3RhdGUsICZ4LCAm
eSwgJm9mZnNldCk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCS8qCisJICogQ0NTIEFV
WCBzdXJmYWNlIGRvZXNuJ3QgaGF2ZSBpdHMgb3duIHgveSBvZmZzZXRzLCB3ZSBtdXN0IG1ha2Ug
c3VyZQorCSAqIHRoZXkgbWF0Y2ggd2l0aCB0aGUgbWFpbiBzdXJmYWNlIHgveSBvZmZzZXRzLgor
CSAqLworCWlmIChpc19jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSkgeworCQl3aGlsZSAoIXNr
bF9jaGVja19tYWluX2Njc19jb29yZGluYXRlcyhwbGFuZV9zdGF0ZSwgeCwgeSwKKwkJCQkJCSAg
ICAgICBvZmZzZXQsIGF1eF9wbGFuZSkpIHsKKwkJCWlmIChvZmZzZXQgPT0gMCkKKwkJCQlicmVh
azsKKworCQkJb2Zmc2V0ID0gaW50ZWxfcGxhbmVfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KCZ4LCAm
eSwgcGxhbmVfc3RhdGUsIDAsCisJCQkJCQkJCSAgIG9mZnNldCwgb2Zmc2V0IC0gYWxpZ25tZW50
KTsKKwkJfQorCisJCWlmICh4ICE9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVthdXhfcGxhbmVd
LnggfHwKKwkJICAgIHkgIT0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2F1eF9wbGFuZV0ueSkg
eworCQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCQkJICAgICJVbmFibGUgdG8gZmlu
ZCBzdWl0YWJsZSBkaXNwbGF5IHN1cmZhY2Ugb2Zmc2V0IGR1ZSB0byBDQ1NcbiIpOworCQkJcmV0
dXJuIC1FSU5WQUw7CisJCX0KKwl9CisKKwlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ub2Zm
c2V0ID0gb2Zmc2V0OworCXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS54ID0geDsKKwlwbGFu
ZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0ueSA9IHk7CisKKwkvKgorCSAqIFB1dCB0aGUgZmluYWwg
Y29vcmRpbmF0ZXMgYmFjayBzbyB0aGF0IHRoZSBzcmMKKwkgKiBjb29yZGluYXRlIGNoZWNrcyB3
aWxsIHNlZSB0aGUgcmlnaHQgdmFsdWVzLgorCSAqLworCWRybV9yZWN0X3RyYW5zbGF0ZV90bygm
cGxhbmVfc3RhdGUtPnVhcGkuc3JjLAorCQkJICAgICAgeCA8PCAxNiwgeSA8PCAxNik7CisKKwly
ZXR1cm4gMDsKK30KKworc3RhdGljIGludCBza2xfY2hlY2tfbnYxMl9hdXhfc3VyZmFjZShzdHJ1
Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQoreworCXN0cnVjdCBpbnRlbF9wbGFu
ZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CisJ
Y29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CisJ
dW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOworCWludCB1
dl9wbGFuZSA9IDE7CisJaW50IG1heF93aWR0aCA9IGludGVsX3BsYW5lX21heF93aWR0aChwbGFu
ZSwgZmIsIHV2X3BsYW5lLCByb3RhdGlvbik7CisJaW50IG1heF9oZWlnaHQgPSBpbnRlbF9wbGFu
ZV9tYXhfaGVpZ2h0KHBsYW5lLCBmYiwgdXZfcGxhbmUsIHJvdGF0aW9uKTsKKwlpbnQgeCA9IHBs
YW5lX3N0YXRlLT51YXBpLnNyYy54MSA+PiAxNzsKKwlpbnQgeSA9IHBsYW5lX3N0YXRlLT51YXBp
LnNyYy55MSA+PiAxNzsKKwlpbnQgdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+dWFw
aS5zcmMpID4+IDE3OworCWludCBoID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+dWFw
aS5zcmMpID4+IDE3OworCXUzMiBvZmZzZXQ7CisKKwkvKiBGSVhNRSBub3QgcXVpdGUgc3VyZSBo
b3cvaWYgdGhlc2UgYXBwbHkgdG8gdGhlIGNocm9tYSBwbGFuZSAqLworCWlmICh3ID4gbWF4X3dp
ZHRoIHx8IGggPiBtYXhfaGVpZ2h0KSB7CisJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCisJCQkg
ICAgIkNiQ3Igc291cmNlIHNpemUgJWR4JWQgdG9vIGJpZyAobGltaXQgJWR4JWQpXG4iLAorCQkJ
ICAgIHcsIGgsIG1heF93aWR0aCwgbWF4X2hlaWdodCk7CisJCXJldHVybiAtRUlOVkFMOworCX0K
KworCWludGVsX2FkZF9mYl9vZmZzZXRzKCZ4LCAmeSwgcGxhbmVfc3RhdGUsIHV2X3BsYW5lKTsK
KwlvZmZzZXQgPSBpbnRlbF9wbGFuZV9jb21wdXRlX2FsaWduZWRfb2Zmc2V0KCZ4LCAmeSwKKwkJ
CQkJCSAgICBwbGFuZV9zdGF0ZSwgdXZfcGxhbmUpOworCisJaWYgKGlzX2Njc19tb2RpZmllcihm
Yi0+bW9kaWZpZXIpKSB7CisJCWludCBjY3NfcGxhbmUgPSBtYWluX3RvX2Njc19wbGFuZShmYiwg
dXZfcGxhbmUpOworCQl1MzIgYXV4X29mZnNldCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtj
Y3NfcGxhbmVdLm9mZnNldDsKKwkJdTMyIGFsaWdubWVudCA9IGludGVsX3N1cmZfYWxpZ25tZW50
KGZiLCB1dl9wbGFuZSk7CisKKwkJaWYgKG9mZnNldCA+IGF1eF9vZmZzZXQpCisJCQlvZmZzZXQg
PSBpbnRlbF9wbGFuZV9hZGp1c3RfYWxpZ25lZF9vZmZzZXQoJngsICZ5LAorCQkJCQkJCQkgICBw
bGFuZV9zdGF0ZSwKKwkJCQkJCQkJICAgdXZfcGxhbmUsCisJCQkJCQkJCSAgIG9mZnNldCwKKwkJ
CQkJCQkJICAgYXV4X29mZnNldCAmIH4oYWxpZ25tZW50IC0gMSkpOworCisJCXdoaWxlICghc2ts
X2NoZWNrX21haW5fY2NzX2Nvb3JkaW5hdGVzKHBsYW5lX3N0YXRlLCB4LCB5LAorCQkJCQkJICAg
ICAgIG9mZnNldCwgY2NzX3BsYW5lKSkgeworCQkJaWYgKG9mZnNldCA9PSAwKQorCQkJCWJyZWFr
OworCisJCQlvZmZzZXQgPSBpbnRlbF9wbGFuZV9hZGp1c3RfYWxpZ25lZF9vZmZzZXQoJngsICZ5
LAorCQkJCQkJCQkgICBwbGFuZV9zdGF0ZSwKKwkJCQkJCQkJICAgdXZfcGxhbmUsCisJCQkJCQkJ
CSAgIG9mZnNldCwgb2Zmc2V0IC0gYWxpZ25tZW50KTsKKwkJfQorCisJCWlmICh4ICE9IHBsYW5l
X3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLnggfHwKKwkJICAgIHkgIT0gcGxhbmVfc3Rh
dGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueSkgeworCQkJZHJtX2RiZ19rbXMoJmk5MTUtPmRy
bSwKKwkJCQkgICAgIlVuYWJsZSB0byBmaW5kIHN1aXRhYmxlIGRpc3BsYXkgc3VyZmFjZSBvZmZz
ZXQgZHVlIHRvIENDU1xuIik7CisJCQlyZXR1cm4gLUVJTlZBTDsKKwkJfQorCX0KKworCXBsYW5l
X3N0YXRlLT5jb2xvcl9wbGFuZVt1dl9wbGFuZV0ub2Zmc2V0ID0gb2Zmc2V0OworCXBsYW5lX3N0
YXRlLT5jb2xvcl9wbGFuZVt1dl9wbGFuZV0ueCA9IHg7CisJcGxhbmVfc3RhdGUtPmNvbG9yX3Bs
YW5lW3V2X3BsYW5lXS55ID0geTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IHNrbF9j
aGVja19jY3NfYXV4X3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0
ZSkKK3sKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5o
dy5mYjsKKwlpbnQgc3JjX3ggPSBwbGFuZV9zdGF0ZS0+dWFwaS5zcmMueDEgPj4gMTY7CisJaW50
IHNyY195ID0gcGxhbmVfc3RhdGUtPnVhcGkuc3JjLnkxID4+IDE2OworCXUzMiBvZmZzZXQ7CisJ
aW50IGNjc19wbGFuZTsKKworCWZvciAoY2NzX3BsYW5lID0gMDsgY2NzX3BsYW5lIDwgZmItPmZv
cm1hdC0+bnVtX3BsYW5lczsgY2NzX3BsYW5lKyspIHsKKwkJaW50IG1haW5faHN1YiwgbWFpbl92
c3ViOworCQlpbnQgaHN1YiwgdnN1YjsKKwkJaW50IHgsIHk7CisKKwkJaWYgKCFpc19jY3NfcGxh
bmUoZmIsIGNjc19wbGFuZSkpCisJCQljb250aW51ZTsKKworCQlpbnRlbF9mYl9wbGFuZV9nZXRf
c3Vic2FtcGxpbmcoJm1haW5faHN1YiwgJm1haW5fdnN1YiwgZmIsCisJCQkJCSAgICAgICBza2xf
Y2NzX3RvX21haW5fcGxhbmUoZmIsIGNjc19wbGFuZSkpOworCQlpbnRlbF9mYl9wbGFuZV9nZXRf
c3Vic2FtcGxpbmcoJmhzdWIsICZ2c3ViLCBmYiwgY2NzX3BsYW5lKTsKKworCQloc3ViICo9IG1h
aW5faHN1YjsKKwkJdnN1YiAqPSBtYWluX3ZzdWI7CisJCXggPSBzcmNfeCAvIGhzdWI7CisJCXkg
PSBzcmNfeSAvIHZzdWI7CisKKwkJaW50ZWxfYWRkX2ZiX29mZnNldHMoJngsICZ5LCBwbGFuZV9z
dGF0ZSwgY2NzX3BsYW5lKTsKKworCQlvZmZzZXQgPSBpbnRlbF9wbGFuZV9jb21wdXRlX2FsaWdu
ZWRfb2Zmc2V0KCZ4LCAmeSwKKwkJCQkJCQkgICAgcGxhbmVfc3RhdGUsCisJCQkJCQkJICAgIGNj
c19wbGFuZSk7CisKKwkJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ub2Zmc2V0
ID0gb2Zmc2V0OworCQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS54ID0gKHgg
KiBoc3ViICsKKwkJCQkJCQkgc3JjX3ggJSBoc3ViKSAvCisJCQkJCQkJbWFpbl9oc3ViOworCQlw
bGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS55ID0gKHkgKiB2c3ViICsKKwkJCQkJ
CQkgc3JjX3kgJSB2c3ViKSAvCisJCQkJCQkJbWFpbl92c3ViOworCX0KKworCXJldHVybiAwOwor
fQorCitzdGF0aWMgaW50IHNrbF9jaGVja19wbGFuZV9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFu
ZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCit7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAq
ZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CisJaW50IHJldCwgaTsKKworCXJldCA9IGludGVsX3Bs
YW5lX2NvbXB1dGVfZ3R0KHBsYW5lX3N0YXRlKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0Owor
CisJaWYgKCFwbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlKQorCQlyZXR1cm4gMDsKKworCS8qCisJ
ICogSGFuZGxlIHRoZSBBVVggc3VyZmFjZSBmaXJzdCBzaW5jZSB0aGUgbWFpbiBzdXJmYWNlIHNl
dHVwIGRlcGVuZHMgb24KKwkgKiBpdC4KKwkgKi8KKwlpZiAoaXNfY2NzX21vZGlmaWVyKGZiLT5t
b2RpZmllcikpIHsKKwkJcmV0ID0gc2tsX2NoZWNrX2Njc19hdXhfc3VyZmFjZShwbGFuZV9zdGF0
ZSk7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gcmV0OworCX0KKworCWlmIChpbnRlbF9mb3JtYXRf
aW5mb19pc195dXZfc2VtaXBsYW5hcihmYi0+Zm9ybWF0LAorCQkJCQkJZmItPm1vZGlmaWVyKSkg
eworCQlyZXQgPSBza2xfY2hlY2tfbnYxMl9hdXhfc3VyZmFjZShwbGFuZV9zdGF0ZSk7CisJCWlm
IChyZXQpCisJCQlyZXR1cm4gcmV0OworCX0KKworCWZvciAoaSA9IGZiLT5mb3JtYXQtPm51bV9w
bGFuZXM7IGkgPCBBUlJBWV9TSVpFKHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZSk7IGkrKykgewor
CQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbaV0ub2Zmc2V0ID0gMDsKKwkJcGxhbmVfc3RhdGUt
PmNvbG9yX3BsYW5lW2ldLnggPSAwOworCQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbaV0ueSA9
IDA7CisJfQorCisJcmV0ID0gc2tsX2NoZWNrX21haW5fc3VyZmFjZShwbGFuZV9zdGF0ZSk7CisJ
aWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgYm9vbCBp
bnRlbF9mYl9zY2FsYWJsZShjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYikKK3sKKwlp
ZiAoIWZiKQorCQlyZXR1cm4gZmFsc2U7CisKKwlzd2l0Y2ggKGZiLT5mb3JtYXQtPmZvcm1hdCkg
eworCWNhc2UgRFJNX0ZPUk1BVF9DODoKKwkJcmV0dXJuIGZhbHNlOworCWNhc2UgRFJNX0ZPUk1B
VF9YUkdCMTYxNjE2MTZGOgorCWNhc2UgRFJNX0ZPUk1BVF9BUkdCMTYxNjE2MTZGOgorCWNhc2Ug
RFJNX0ZPUk1BVF9YQkdSMTYxNjE2MTZGOgorCWNhc2UgRFJNX0ZPUk1BVF9BQkdSMTYxNjE2MTZG
OgorCQlyZXR1cm4gSU5URUxfR0VOKHRvX2k5MTUoZmItPmRldikpID49IDExOworCWRlZmF1bHQ6
CisJCXJldHVybiB0cnVlOworCX0KK30KKworc3RhdGljIGludCBza2xfcGxhbmVfY2hlY2soc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkgICBzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGUgKnBsYW5lX3N0YXRlKQoreworCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0
b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOworCWNvbnN0IHN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOworCWludCBtaW5f
c2NhbGUgPSBEUk1fUExBTkVfSEVMUEVSX05PX1NDQUxJTkc7CisJaW50IG1heF9zY2FsZSA9IERS
TV9QTEFORV9IRUxQRVJfTk9fU0NBTElORzsKKwlpbnQgcmV0OworCisJcmV0ID0gc2tsX3BsYW5l
X2NoZWNrX2ZiKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKTsKKwlpZiAocmV0KQorCQlyZXR1cm4g
cmV0OworCisJLyogdXNlIHNjYWxlciB3aGVuIGNvbG9ya2V5IGlzIG5vdCByZXF1aXJlZCAqLwor
CWlmICghcGxhbmVfc3RhdGUtPmNrZXkuZmxhZ3MgJiYgaW50ZWxfZmJfc2NhbGFibGUoZmIpKSB7
CisJCW1pbl9zY2FsZSA9IDE7CisJCW1heF9zY2FsZSA9IHNrbF9wbGFuZV9tYXhfc2NhbGUoZGV2
X3ByaXYsIGZiKTsKKwl9CisKKwlyZXQgPSBpbnRlbF9hdG9taWNfcGxhbmVfY2hlY2tfY2xpcHBp
bmcocGxhbmVfc3RhdGUsIGNydGNfc3RhdGUsCisJCQkJCQltaW5fc2NhbGUsIG1heF9zY2FsZSwg
dHJ1ZSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCXJldCA9IHNrbF9jaGVja19wbGFu
ZV9zdXJmYWNlKHBsYW5lX3N0YXRlKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OworCisJaWYg
KCFwbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlKQorCQlyZXR1cm4gMDsKKworCXJldCA9IHNrbF9w
bGFuZV9jaGVja19kc3RfY29vcmRpbmF0ZXMoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOworCWlm
IChyZXQpCisJCXJldHVybiByZXQ7CisKKwlyZXQgPSBpbnRlbF9wbGFuZV9jaGVja19zcmNfY29v
cmRpbmF0ZXMocGxhbmVfc3RhdGUpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlyZXQg
PSBza2xfcGxhbmVfY2hlY2tfbnYxMl9yb3RhdGlvbihwbGFuZV9zdGF0ZSk7CisJaWYgKHJldCkK
KwkJcmV0dXJuIHJldDsKKworCS8qIEhXIG9ubHkgaGFzIDggYml0cyBwaXhlbCBwcmVjaXNpb24s
IGRpc2FibGUgcGxhbmUgaWYgaW52aXNpYmxlICovCisJaWYgKCEocGxhbmVfc3RhdGUtPmh3LmFs
cGhhID4+IDgpKQorCQlwbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlID0gZmFsc2U7CisKKwlwbGFu
ZV9zdGF0ZS0+Y3RsID0gc2tsX3BsYW5lX2N0bChjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7CisK
KwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2
KSkKKwkJcGxhbmVfc3RhdGUtPmNvbG9yX2N0bCA9IGdsa19wbGFuZV9jb2xvcl9jdGwoY3J0Y19z
dGF0ZSwKKwkJCQkJCQkgICAgIHBsYW5lX3N0YXRlKTsKKworCWlmIChpbnRlbF9mb3JtYXRfaW5m
b19pc195dXZfc2VtaXBsYW5hcihmYi0+Zm9ybWF0LCBmYi0+bW9kaWZpZXIpICYmCisJICAgIGlj
bF9pc19oZHJfcGxhbmUoZGV2X3ByaXYsIHBsYW5lLT5pZCkpCisJCS8qIEVuYWJsZSBhbmQgdXNl
IE1QRUctMiBjaHJvbWEgc2l0aW5nICovCisJCXBsYW5lX3N0YXRlLT5jdXNfY3RsID0gUExBTkVf
Q1VTX0VOQUJMRSB8CisJCQlQTEFORV9DVVNfSFBIQVNFXzAgfAorCQkJUExBTkVfQ1VTX1ZQSEFT
RV9TSUdOX05FR0FUSVZFIHwgUExBTkVfQ1VTX1ZQSEFTRV8wXzI1OworCWVsc2UKKwkJcGxhbmVf
c3RhdGUtPmN1c19jdGwgPSAwOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBib29sIHNrbF9w
bGFuZV9oYXNfZmJjKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCSAgICAg
IGVudW0gcGlwZSBwaXBlLCBlbnVtIHBsYW5lX2lkIHBsYW5lX2lkKQoreworCWlmICghSEFTX0ZC
QyhkZXZfcHJpdikpCisJCXJldHVybiBmYWxzZTsKKworCXJldHVybiBwaXBlID09IFBJUEVfQSAm
JiBwbGFuZV9pZCA9PSBQTEFORV9QUklNQVJZOworfQorCitzdGF0aWMgYm9vbCBza2xfcGxhbmVf
aGFzX3BsYW5hcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJCQkJIGVudW0g
cGlwZSBwaXBlLCBlbnVtIHBsYW5lX2lkIHBsYW5lX2lkKQoreworCS8qIERpc3BsYXkgV0EgIzA4
NzA6IHNrbCwgYnh0ICovCisJaWYgKElTX1NLWUxBS0UoZGV2X3ByaXYpIHx8IElTX0JST1hUT04o
ZGV2X3ByaXYpKQorCQlyZXR1cm4gZmFsc2U7CisKKwlpZiAoSVNfR0VOKGRldl9wcml2LCA5KSAm
JiAhSVNfR0VNSU5JTEFLRShkZXZfcHJpdikgJiYgcGlwZSA9PSBQSVBFX0MpCisJCXJldHVybiBm
YWxzZTsKKworCWlmIChwbGFuZV9pZCAhPSBQTEFORV9QUklNQVJZICYmIHBsYW5lX2lkICE9IFBM
QU5FX1NQUklURTApCisJCXJldHVybiBmYWxzZTsKKworCXJldHVybiB0cnVlOworfQorCitzdGF0
aWMgY29uc3QgdTMyICpza2xfZ2V0X3BsYW5lX2Zvcm1hdHMoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAorCQkJCQllbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFuZV9pZCBwbGFuZV9p
ZCwKKwkJCQkJaW50ICpudW1fZm9ybWF0cykKK3sKKwlpZiAoc2tsX3BsYW5lX2hhc19wbGFuYXIo
ZGV2X3ByaXYsIHBpcGUsIHBsYW5lX2lkKSkgeworCQkqbnVtX2Zvcm1hdHMgPSBBUlJBWV9TSVpF
KHNrbF9wbGFuYXJfZm9ybWF0cyk7CisJCXJldHVybiBza2xfcGxhbmFyX2Zvcm1hdHM7CisJfSBl
bHNlIHsKKwkJKm51bV9mb3JtYXRzID0gQVJSQVlfU0laRShza2xfcGxhbmVfZm9ybWF0cyk7CisJ
CXJldHVybiBza2xfcGxhbmVfZm9ybWF0czsKKwl9Cit9CisKK3N0YXRpYyBjb25zdCB1MzIgKmds
a19nZXRfcGxhbmVfZm9ybWF0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJ
CQkJCWVudW0gcGlwZSBwaXBlLCBlbnVtIHBsYW5lX2lkIHBsYW5lX2lkLAorCQkJCQlpbnQgKm51
bV9mb3JtYXRzKQoreworCWlmIChza2xfcGxhbmVfaGFzX3BsYW5hcihkZXZfcHJpdiwgcGlwZSwg
cGxhbmVfaWQpKSB7CisJCSpudW1fZm9ybWF0cyA9IEFSUkFZX1NJWkUoZ2xrX3BsYW5hcl9mb3Jt
YXRzKTsKKwkJcmV0dXJuIGdsa19wbGFuYXJfZm9ybWF0czsKKwl9IGVsc2UgeworCQkqbnVtX2Zv
cm1hdHMgPSBBUlJBWV9TSVpFKHNrbF9wbGFuZV9mb3JtYXRzKTsKKwkJcmV0dXJuIHNrbF9wbGFu
ZV9mb3JtYXRzOworCX0KK30KKworc3RhdGljIGNvbnN0IHUzMiAqaWNsX2dldF9wbGFuZV9mb3Jt
YXRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCQkJZW51bSBwaXBlIHBp
cGUsIGVudW0gcGxhbmVfaWQgcGxhbmVfaWQsCisJCQkJCWludCAqbnVtX2Zvcm1hdHMpCit7CisJ
aWYgKGljbF9pc19oZHJfcGxhbmUoZGV2X3ByaXYsIHBsYW5lX2lkKSkgeworCQkqbnVtX2Zvcm1h
dHMgPSBBUlJBWV9TSVpFKGljbF9oZHJfcGxhbmVfZm9ybWF0cyk7CisJCXJldHVybiBpY2xfaGRy
X3BsYW5lX2Zvcm1hdHM7CisJfSBlbHNlIGlmIChpY2xfaXNfbnYxMl95X3BsYW5lKGRldl9wcml2
LCBwbGFuZV9pZCkpIHsKKwkJKm51bV9mb3JtYXRzID0gQVJSQVlfU0laRShpY2xfc2RyX3lfcGxh
bmVfZm9ybWF0cyk7CisJCXJldHVybiBpY2xfc2RyX3lfcGxhbmVfZm9ybWF0czsKKwl9IGVsc2Ug
eworCQkqbnVtX2Zvcm1hdHMgPSBBUlJBWV9TSVpFKGljbF9zZHJfdXZfcGxhbmVfZm9ybWF0cyk7
CisJCXJldHVybiBpY2xfc2RyX3V2X3BsYW5lX2Zvcm1hdHM7CisJfQorfQorCitzdGF0aWMgYm9v
bCBza2xfcGxhbmVfaGFzX2NjcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJ
CQkgICAgICBlbnVtIHBpcGUgcGlwZSwgZW51bSBwbGFuZV9pZCBwbGFuZV9pZCkKK3sKKwlpZiAo
cGxhbmVfaWQgPT0gUExBTkVfQ1VSU09SKQorCQlyZXR1cm4gZmFsc2U7CisKKwlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSAxMCkKKwkJcmV0dXJuIHRydWU7CisKKwlpZiAoSVNfR0VNSU5JTEFL
RShkZXZfcHJpdikpCisJCXJldHVybiBwaXBlICE9IFBJUEVfQzsKKworCXJldHVybiBwaXBlICE9
IFBJUEVfQyAmJgorCQkocGxhbmVfaWQgPT0gUExBTkVfUFJJTUFSWSB8fAorCQkgcGxhbmVfaWQg
PT0gUExBTkVfU1BSSVRFMCk7Cit9CisKK3N0YXRpYyBib29sIHNrbF9wbGFuZV9mb3JtYXRfbW9k
X3N1cHBvcnRlZChzdHJ1Y3QgZHJtX3BsYW5lICpfcGxhbmUsCisJCQkJCSAgIHUzMiBmb3JtYXQs
IHU2NCBtb2RpZmllcikKK3sKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxf
cGxhbmUoX3BsYW5lKTsKKworCXN3aXRjaCAobW9kaWZpZXIpIHsKKwljYXNlIERSTV9GT1JNQVRf
TU9EX0xJTkVBUjoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9YX1RJTEVEOgorCWNhc2UgSTkxNV9G
T1JNQVRfTU9EX1lfVElMRUQ6CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRUQ6CisJCWJy
ZWFrOworCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfQ0NTOgorCWNhc2UgSTkxNV9GT1JN
QVRfTU9EX1lmX1RJTEVEX0NDUzoKKwkJaWYgKCFwbGFuZS0+aGFzX2NjcykKKwkJCXJldHVybiBm
YWxzZTsKKwkJYnJlYWs7CisJZGVmYXVsdDoKKwkJcmV0dXJuIGZhbHNlOworCX0KKworCXN3aXRj
aCAoZm9ybWF0KSB7CisJY2FzZSBEUk1fRk9STUFUX1hSR0I4ODg4OgorCWNhc2UgRFJNX0ZPUk1B
VF9YQkdSODg4ODoKKwljYXNlIERSTV9GT1JNQVRfQVJHQjg4ODg6CisJY2FzZSBEUk1fRk9STUFU
X0FCR1I4ODg4OgorCQlpZiAoaXNfY2NzX21vZGlmaWVyKG1vZGlmaWVyKSkKKwkJCXJldHVybiB0
cnVlOworCQlmYWxsdGhyb3VnaDsKKwljYXNlIERSTV9GT1JNQVRfUkdCNTY1OgorCWNhc2UgRFJN
X0ZPUk1BVF9YUkdCMjEwMTAxMDoKKwljYXNlIERSTV9GT1JNQVRfWEJHUjIxMDEwMTA6CisJY2Fz
ZSBEUk1fRk9STUFUX0FSR0IyMTAxMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9BQkdSMjEwMTAxMDoK
KwljYXNlIERSTV9GT1JNQVRfWVVZVjoKKwljYXNlIERSTV9GT1JNQVRfWVZZVToKKwljYXNlIERS
TV9GT1JNQVRfVVlWWToKKwljYXNlIERSTV9GT1JNQVRfVllVWToKKwljYXNlIERSTV9GT1JNQVRf
TlYxMjoKKwljYXNlIERSTV9GT1JNQVRfWFlVVjg4ODg6CisJY2FzZSBEUk1fRk9STUFUX1AwMTA6
CisJY2FzZSBEUk1fRk9STUFUX1AwMTI6CisJY2FzZSBEUk1fRk9STUFUX1AwMTY6CisJY2FzZSBE
Uk1fRk9STUFUX1hWWVUyMTAxMDEwOgorCQlpZiAobW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9E
X1lmX1RJTEVEKQorCQkJcmV0dXJuIHRydWU7CisJCWZhbGx0aHJvdWdoOworCWNhc2UgRFJNX0ZP
Uk1BVF9DODoKKwljYXNlIERSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JN
QVRfQUJHUjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfWFJHQjE2MTYxNjE2RjoKKwljYXNl
IERSTV9GT1JNQVRfQVJHQjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfWTIxMDoKKwljYXNl
IERSTV9GT1JNQVRfWTIxMjoKKwljYXNlIERSTV9GT1JNQVRfWTIxNjoKKwljYXNlIERSTV9GT1JN
QVRfWFZZVTEyXzE2MTYxNjE2OgorCWNhc2UgRFJNX0ZPUk1BVF9YVllVMTYxNjE2MTY6CisJCWlm
IChtb2RpZmllciA9PSBEUk1fRk9STUFUX01PRF9MSU5FQVIgfHwKKwkJICAgIG1vZGlmaWVyID09
IEk5MTVfRk9STUFUX01PRF9YX1RJTEVEIHx8CisJCSAgICBtb2RpZmllciA9PSBJOTE1X0ZPUk1B
VF9NT0RfWV9USUxFRCkKKwkJCXJldHVybiB0cnVlOworCQlmYWxsdGhyb3VnaDsKKwlkZWZhdWx0
OgorCQlyZXR1cm4gZmFsc2U7CisJfQorfQorCitzdGF0aWMgYm9vbCBnZW4xMl9wbGFuZV9zdXBw
b3J0c19tY19jY3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorCQkJCQllbnVt
IHBsYW5lX2lkIHBsYW5lX2lkKQoreworCS8qIFdhXzE0MDEwNDc3MDA4OnRnbFthMC4uYzBdLHJr
bFthbGxdLGRnMVthbGxdICovCisJaWYgKElTX0RHMShkZXZfcHJpdikgfHwgSVNfUk9DS0VUTEFL
RShkZXZfcHJpdikgfHwKKwkgICAgSVNfVEdMX0RJU1BfUkVWSUQoZGV2X3ByaXYsIFRHTF9SRVZJ
RF9BMCwgVEdMX1JFVklEX0MwKSkKKwkJcmV0dXJuIGZhbHNlOworCisJcmV0dXJuIHBsYW5lX2lk
IDwgUExBTkVfU1BSSVRFNDsKK30KKworc3RhdGljIGJvb2wgZ2VuMTJfcGxhbmVfZm9ybWF0X21v
ZF9zdXBwb3J0ZWQoc3RydWN0IGRybV9wbGFuZSAqX3BsYW5lLAorCQkJCQkgICAgIHUzMiBmb3Jt
YXQsIHU2NCBtb2RpZmllcikKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KF9wbGFuZS0+ZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9f
aW50ZWxfcGxhbmUoX3BsYW5lKTsKKworCXN3aXRjaCAobW9kaWZpZXIpIHsKKwljYXNlIEk5MTVf
Rk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX01DX0NDUzoKKwkJaWYgKCFnZW4xMl9wbGFuZV9zdXBw
b3J0c19tY19jY3MoZGV2X3ByaXYsIHBsYW5lLT5pZCkpCisJCQlyZXR1cm4gZmFsc2U7CisJCWZh
bGx0aHJvdWdoOworCWNhc2UgRFJNX0ZPUk1BVF9NT0RfTElORUFSOgorCWNhc2UgSTkxNV9GT1JN
QVRfTU9EX1hfVElMRUQ6CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRDoKKwljYXNlIEk5
MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUzoKKwkJYnJlYWs7CisJZGVmYXVsdDoK
KwkJcmV0dXJuIGZhbHNlOworCX0KKworCXN3aXRjaCAoZm9ybWF0KSB7CisJY2FzZSBEUk1fRk9S
TUFUX1hSR0I4ODg4OgorCWNhc2UgRFJNX0ZPUk1BVF9YQkdSODg4ODoKKwljYXNlIERSTV9GT1JN
QVRfQVJHQjg4ODg6CisJY2FzZSBEUk1fRk9STUFUX0FCR1I4ODg4OgorCQlpZiAoaXNfY2NzX21v
ZGlmaWVyKG1vZGlmaWVyKSkKKwkJCXJldHVybiB0cnVlOworCQlmYWxsdGhyb3VnaDsKKwljYXNl
IERSTV9GT1JNQVRfWVVZVjoKKwljYXNlIERSTV9GT1JNQVRfWVZZVToKKwljYXNlIERSTV9GT1JN
QVRfVVlWWToKKwljYXNlIERSTV9GT1JNQVRfVllVWToKKwljYXNlIERSTV9GT1JNQVRfTlYxMjoK
KwljYXNlIERSTV9GT1JNQVRfWFlVVjg4ODg6CisJY2FzZSBEUk1fRk9STUFUX1AwMTA6CisJY2Fz
ZSBEUk1fRk9STUFUX1AwMTI6CisJY2FzZSBEUk1fRk9STUFUX1AwMTY6CisJCWlmIChtb2RpZmll
ciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9NQ19DQ1MpCisJCQlyZXR1cm4gdHJ1
ZTsKKwkJZmFsbHRocm91Z2g7CisJY2FzZSBEUk1fRk9STUFUX1JHQjU2NToKKwljYXNlIERSTV9G
T1JNQVRfWFJHQjIxMDEwMTA6CisJY2FzZSBEUk1fRk9STUFUX1hCR1IyMTAxMDEwOgorCWNhc2Ug
RFJNX0ZPUk1BVF9BUkdCMjEwMTAxMDoKKwljYXNlIERSTV9GT1JNQVRfQUJHUjIxMDEwMTA6CisJ
Y2FzZSBEUk1fRk9STUFUX1hWWVUyMTAxMDEwOgorCWNhc2UgRFJNX0ZPUk1BVF9DODoKKwljYXNl
IERSTV9GT1JNQVRfWEJHUjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfQUJHUjE2MTYxNjE2
RjoKKwljYXNlIERSTV9GT1JNQVRfWFJHQjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfQVJH
QjE2MTYxNjE2RjoKKwljYXNlIERSTV9GT1JNQVRfWTIxMDoKKwljYXNlIERSTV9GT1JNQVRfWTIx
MjoKKwljYXNlIERSTV9GT1JNQVRfWTIxNjoKKwljYXNlIERSTV9GT1JNQVRfWFZZVTEyXzE2MTYx
NjE2OgorCWNhc2UgRFJNX0ZPUk1BVF9YVllVMTYxNjE2MTY6CisJCWlmIChtb2RpZmllciA9PSBE
Uk1fRk9STUFUX01PRF9MSU5FQVIgfHwKKwkJICAgIG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01P
RF9YX1RJTEVEIHx8CisJCSAgICBtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRCkK
KwkJCXJldHVybiB0cnVlOworCQlmYWxsdGhyb3VnaDsKKwlkZWZhdWx0OgorCQlyZXR1cm4gZmFs
c2U7CisJfQorfQorCitzdGF0aWMgY29uc3QgdTY0ICpnZW4xMl9nZXRfcGxhbmVfbW9kaWZpZXJz
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCQkJICAgIGVudW0gcGxhbmVf
aWQgcGxhbmVfaWQpCit7CisJaWYgKGdlbjEyX3BsYW5lX3N1cHBvcnRzX21jX2NjcyhkZXZfcHJp
diwgcGxhbmVfaWQpKQorCQlyZXR1cm4gZ2VuMTJfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19tY19j
Y3M7CisJZWxzZQorCQlyZXR1cm4gZ2VuMTJfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19yY19jY3M7
Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX3BsYW5lX2Z1bmNzIHNrbF9wbGFuZV9mdW5j
cyA9IHsKKwkudXBkYXRlX3BsYW5lID0gZHJtX2F0b21pY19oZWxwZXJfdXBkYXRlX3BsYW5lLAor
CS5kaXNhYmxlX3BsYW5lID0gZHJtX2F0b21pY19oZWxwZXJfZGlzYWJsZV9wbGFuZSwKKwkuZGVz
dHJveSA9IGludGVsX3BsYW5lX2Rlc3Ryb3ksCisJLmF0b21pY19kdXBsaWNhdGVfc3RhdGUgPSBp
bnRlbF9wbGFuZV9kdXBsaWNhdGVfc3RhdGUsCisJLmF0b21pY19kZXN0cm95X3N0YXRlID0gaW50
ZWxfcGxhbmVfZGVzdHJveV9zdGF0ZSwKKwkuZm9ybWF0X21vZF9zdXBwb3J0ZWQgPSBza2xfcGxh
bmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQsCit9OworCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9w
bGFuZV9mdW5jcyBnZW4xMl9wbGFuZV9mdW5jcyA9IHsKKwkudXBkYXRlX3BsYW5lID0gZHJtX2F0
b21pY19oZWxwZXJfdXBkYXRlX3BsYW5lLAorCS5kaXNhYmxlX3BsYW5lID0gZHJtX2F0b21pY19o
ZWxwZXJfZGlzYWJsZV9wbGFuZSwKKwkuZGVzdHJveSA9IGludGVsX3BsYW5lX2Rlc3Ryb3ksCisJ
LmF0b21pY19kdXBsaWNhdGVfc3RhdGUgPSBpbnRlbF9wbGFuZV9kdXBsaWNhdGVfc3RhdGUsCisJ
LmF0b21pY19kZXN0cm95X3N0YXRlID0gaW50ZWxfcGxhbmVfZGVzdHJveV9zdGF0ZSwKKwkuZm9y
bWF0X21vZF9zdXBwb3J0ZWQgPSBnZW4xMl9wbGFuZV9mb3JtYXRfbW9kX3N1cHBvcnRlZCwKK307
CisKK3N0cnVjdCBpbnRlbF9wbGFuZSAqCitza2xfdW5pdmVyc2FsX3BsYW5lX2NyZWF0ZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJCQkgICBlbnVtIHBpcGUgcGlwZSwgZW51
bSBwbGFuZV9pZCBwbGFuZV9pZCkKK3sKKwljb25zdCBzdHJ1Y3QgZHJtX3BsYW5lX2Z1bmNzICpw
bGFuZV9mdW5jczsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOworCWVudW0gZHJtX3BsYW5l
X3R5cGUgcGxhbmVfdHlwZTsKKwl1bnNpZ25lZCBpbnQgc3VwcG9ydGVkX3JvdGF0aW9uczsKKwl1
bnNpZ25lZCBpbnQgc3VwcG9ydGVkX2NzYzsKKwljb25zdCB1NjQgKm1vZGlmaWVyczsKKwljb25z
dCB1MzIgKmZvcm1hdHM7CisJaW50IG51bV9mb3JtYXRzOworCWludCByZXQ7CisKKwlwbGFuZSA9
IGludGVsX3BsYW5lX2FsbG9jKCk7CisJaWYgKElTX0VSUihwbGFuZSkpCisJCXJldHVybiBwbGFu
ZTsKKworCXBsYW5lLT5waXBlID0gcGlwZTsKKwlwbGFuZS0+aWQgPSBwbGFuZV9pZDsKKwlwbGFu
ZS0+ZnJvbnRidWZmZXJfYml0ID0gSU5URUxfRlJPTlRCVUZGRVIocGlwZSwgcGxhbmVfaWQpOwor
CisJcGxhbmUtPmhhc19mYmMgPSBza2xfcGxhbmVfaGFzX2ZiYyhkZXZfcHJpdiwgcGlwZSwgcGxh
bmVfaWQpOworCWlmIChwbGFuZS0+aGFzX2ZiYykgeworCQlzdHJ1Y3QgaW50ZWxfZmJjICpmYmMg
PSAmZGV2X3ByaXYtPmZiYzsKKworCQlmYmMtPnBvc3NpYmxlX2ZyYW1lYnVmZmVyX2JpdHMgfD0g
cGxhbmUtPmZyb250YnVmZmVyX2JpdDsKKwl9CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSAxMSkgeworCQlwbGFuZS0+bWluX3dpZHRoID0gaWNsX3BsYW5lX21pbl93aWR0aDsKKwkJcGxh
bmUtPm1heF93aWR0aCA9IGljbF9wbGFuZV9tYXhfd2lkdGg7CisJCXBsYW5lLT5tYXhfaGVpZ2h0
ID0gaWNsX3BsYW5lX21heF9oZWlnaHQ7CisJfSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
ID49IDEwIHx8IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKSB7CisJCXBsYW5lLT5tYXhfd2lkdGgg
PSBnbGtfcGxhbmVfbWF4X3dpZHRoOworCQlwbGFuZS0+bWF4X2hlaWdodCA9IHNrbF9wbGFuZV9t
YXhfaGVpZ2h0OworCX0gZWxzZSB7CisJCXBsYW5lLT5tYXhfd2lkdGggPSBza2xfcGxhbmVfbWF4
X3dpZHRoOworCQlwbGFuZS0+bWF4X2hlaWdodCA9IHNrbF9wbGFuZV9tYXhfaGVpZ2h0OworCX0K
KworCXBsYW5lLT5tYXhfc3RyaWRlID0gc2tsX3BsYW5lX21heF9zdHJpZGU7CisJcGxhbmUtPnVw
ZGF0ZV9wbGFuZSA9IHNrbF91cGRhdGVfcGxhbmU7CisJcGxhbmUtPmRpc2FibGVfcGxhbmUgPSBz
a2xfZGlzYWJsZV9wbGFuZTsKKwlwbGFuZS0+Z2V0X2h3X3N0YXRlID0gc2tsX3BsYW5lX2dldF9o
d19zdGF0ZTsKKwlwbGFuZS0+Y2hlY2tfcGxhbmUgPSBza2xfcGxhbmVfY2hlY2s7CisJcGxhbmUt
Pm1pbl9jZGNsayA9IHNrbF9wbGFuZV9taW5fY2RjbGs7CisJcGxhbmUtPmFzeW5jX2ZsaXAgPSBz
a2xfcGxhbmVfYXN5bmNfZmxpcDsKKworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQor
CQlmb3JtYXRzID0gaWNsX2dldF9wbGFuZV9mb3JtYXRzKGRldl9wcml2LCBwaXBlLAorCQkJCQkJ
cGxhbmVfaWQsICZudW1fZm9ybWF0cyk7CisJZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSAxMCB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkKKwkJZm9ybWF0cyA9IGdsa19nZXRfcGxh
bmVfZm9ybWF0cyhkZXZfcHJpdiwgcGlwZSwKKwkJCQkJCXBsYW5lX2lkLCAmbnVtX2Zvcm1hdHMp
OworCWVsc2UKKwkJZm9ybWF0cyA9IHNrbF9nZXRfcGxhbmVfZm9ybWF0cyhkZXZfcHJpdiwgcGlw
ZSwKKwkJCQkJCXBsYW5lX2lkLCAmbnVtX2Zvcm1hdHMpOworCisJcGxhbmUtPmhhc19jY3MgPSBz
a2xfcGxhbmVfaGFzX2NjcyhkZXZfcHJpdiwgcGlwZSwgcGxhbmVfaWQpOworCWlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDEyKSB7CisJCW1vZGlmaWVycyA9IGdlbjEyX2dldF9wbGFuZV9tb2Rp
ZmllcnMoZGV2X3ByaXYsIHBsYW5lX2lkKTsKKwkJcGxhbmVfZnVuY3MgPSAmZ2VuMTJfcGxhbmVf
ZnVuY3M7CisJfSBlbHNlIHsKKwkJaWYgKHBsYW5lLT5oYXNfY2NzKQorCQkJbW9kaWZpZXJzID0g
c2tsX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfY2NzOworCQllbHNlCisJCQltb2RpZmllcnMgPSBz
a2xfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19ub2NjczsKKwkJcGxhbmVfZnVuY3MgPSAmc2tsX3Bs
YW5lX2Z1bmNzOworCX0KKworCWlmIChwbGFuZV9pZCA9PSBQTEFORV9QUklNQVJZKQorCQlwbGFu
ZV90eXBlID0gRFJNX1BMQU5FX1RZUEVfUFJJTUFSWTsKKwllbHNlCisJCXBsYW5lX3R5cGUgPSBE
Uk1fUExBTkVfVFlQRV9PVkVSTEFZOworCisJcmV0ID0gZHJtX3VuaXZlcnNhbF9wbGFuZV9pbml0
KCZkZXZfcHJpdi0+ZHJtLCAmcGxhbmUtPmJhc2UsCisJCQkJICAgICAgIDAsIHBsYW5lX2Z1bmNz
LAorCQkJCSAgICAgICBmb3JtYXRzLCBudW1fZm9ybWF0cywgbW9kaWZpZXJzLAorCQkJCSAgICAg
ICBwbGFuZV90eXBlLAorCQkJCSAgICAgICAicGxhbmUgJWQlYyIsIHBsYW5lX2lkICsgMSwKKwkJ
CQkgICAgICAgcGlwZV9uYW1lKHBpcGUpKTsKKwlpZiAocmV0KQorCQlnb3RvIGZhaWw7CisKKwlz
dXBwb3J0ZWRfcm90YXRpb25zID0KKwkJRFJNX01PREVfUk9UQVRFXzAgfCBEUk1fTU9ERV9ST1RB
VEVfOTAgfAorCQlEUk1fTU9ERV9ST1RBVEVfMTgwIHwgRFJNX01PREVfUk9UQVRFXzI3MDsKKwor
CWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwKQorCQlzdXBwb3J0ZWRfcm90YXRpb25zIHw9
IERSTV9NT0RFX1JFRkxFQ1RfWDsKKworCWRybV9wbGFuZV9jcmVhdGVfcm90YXRpb25fcHJvcGVy
dHkoJnBsYW5lLT5iYXNlLAorCQkJCQkgICBEUk1fTU9ERV9ST1RBVEVfMCwKKwkJCQkJICAgc3Vw
cG9ydGVkX3JvdGF0aW9ucyk7CisKKwlzdXBwb3J0ZWRfY3NjID0gQklUKERSTV9DT0xPUl9ZQ0JD
Ul9CVDYwMSkgfCBCSVQoRFJNX0NPTE9SX1lDQkNSX0JUNzA5KTsKKworCWlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDEwIHx8IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKQorCQlzdXBwb3J0ZWRf
Y3NjIHw9IEJJVChEUk1fQ09MT1JfWUNCQ1JfQlQyMDIwKTsKKworCWRybV9wbGFuZV9jcmVhdGVf
Y29sb3JfcHJvcGVydGllcygmcGxhbmUtPmJhc2UsCisJCQkJCSAgc3VwcG9ydGVkX2NzYywKKwkJ
CQkJICBCSVQoRFJNX0NPTE9SX1lDQkNSX0xJTUlURURfUkFOR0UpIHwKKwkJCQkJICBCSVQoRFJN
X0NPTE9SX1lDQkNSX0ZVTExfUkFOR0UpLAorCQkJCQkgIERSTV9DT0xPUl9ZQ0JDUl9CVDcwOSwK
KwkJCQkJICBEUk1fQ09MT1JfWUNCQ1JfTElNSVRFRF9SQU5HRSk7CisKKwlkcm1fcGxhbmVfY3Jl
YXRlX2FscGhhX3Byb3BlcnR5KCZwbGFuZS0+YmFzZSk7CisJZHJtX3BsYW5lX2NyZWF0ZV9ibGVu
ZF9tb2RlX3Byb3BlcnR5KCZwbGFuZS0+YmFzZSwKKwkJCQkJICAgICBCSVQoRFJNX01PREVfQkxF
TkRfUElYRUxfTk9ORSkgfAorCQkJCQkgICAgIEJJVChEUk1fTU9ERV9CTEVORF9QUkVNVUxUSSkg
fAorCQkJCQkgICAgIEJJVChEUk1fTU9ERV9CTEVORF9DT1ZFUkFHRSkpOworCisJZHJtX3BsYW5l
X2NyZWF0ZV96cG9zX2ltbXV0YWJsZV9wcm9wZXJ0eSgmcGxhbmUtPmJhc2UsIHBsYW5lX2lkKTsK
KworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKQorCQlkcm1fcGxhbmVfZW5hYmxlX2Zi
X2RhbWFnZV9jbGlwcygmcGxhbmUtPmJhc2UpOworCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikg
Pj0gMTApCisJCWRybV9wbGFuZV9jcmVhdGVfc2NhbGluZ19maWx0ZXJfcHJvcGVydHkoJnBsYW5l
LT5iYXNlLAorCQkJCQkJQklUKERSTV9TQ0FMSU5HX0ZJTFRFUl9ERUZBVUxUKSB8CisJCQkJCQlC
SVQoRFJNX1NDQUxJTkdfRklMVEVSX05FQVJFU1RfTkVJR0hCT1IpKTsKKworCWRybV9wbGFuZV9o
ZWxwZXJfYWRkKCZwbGFuZS0+YmFzZSwgJmludGVsX3BsYW5lX2hlbHBlcl9mdW5jcyk7CisKKwly
ZXR1cm4gcGxhbmU7CisKK2ZhaWw6CisJaW50ZWxfcGxhbmVfZnJlZShwbGFuZSk7CisKKwlyZXR1
cm4gRVJSX1BUUihyZXQpOworfQorCit2b2lkCitza2xfZ2V0X2luaXRpYWxfcGxhbmVfY29uZmln
KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAorCQkJICAgICBzdHJ1Y3QgaW50ZWxfaW5pdGlhbF9w
bGFuZV9jb25maWcgKnBsYW5lX2NvbmZpZykKK3sKKwlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSA9IHRvX2ludGVsX2NydGNfc3RhdGUoY3J0Yy0+YmFzZS5zdGF0ZSk7CisJc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmJhc2UuZGV2OworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBs
YW5lID0gdG9faW50ZWxfcGxhbmUoY3J0Yy0+YmFzZS5wcmltYXJ5KTsKKwllbnVtIHBsYW5lX2lk
IHBsYW5lX2lkID0gcGxhbmUtPmlkOworCWVudW0gcGlwZSBwaXBlOworCXUzMiB2YWwsIGJhc2Us
IG9mZnNldCwgc3RyaWRlX211bHQsIHRpbGluZywgYWxwaGE7CisJaW50IGZvdXJjYywgcGl4ZWxf
Zm9ybWF0OworCXVuc2lnbmVkIGludCBhbGlnbmVkX2hlaWdodDsKKwlzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYjsKKwlzdHJ1Y3QgaW50ZWxfZnJhbWVidWZmZXIgKmludGVsX2ZiOworCisJaWYg
KCFwbGFuZS0+Z2V0X2h3X3N0YXRlKHBsYW5lLCAmcGlwZSkpCisJCXJldHVybjsKKworCWRybV9X
QVJOX09OKGRldiwgcGlwZSAhPSBjcnRjLT5waXBlKTsKKworCWlmIChjcnRjX3N0YXRlLT5iaWdq
b2luZXIpIHsKKwkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCQkgICAgIlVuc3VwcG9y
dGVkIGJpZ2pvaW5lciBjb25maWd1cmF0aW9uIGZvciBpbml0aWFsIEZCXG4iKTsKKwkJcmV0dXJu
OworCX0KKworCWludGVsX2ZiID0ga3phbGxvYyhzaXplb2YoKmludGVsX2ZiKSwgR0ZQX0tFUk5F
TCk7CisJaWYgKCFpbnRlbF9mYikgeworCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgImZh
aWxlZCB0byBhbGxvYyBmYlxuIik7CisJCXJldHVybjsKKwl9CisKKwlmYiA9ICZpbnRlbF9mYi0+
YmFzZTsKKworCWZiLT5kZXYgPSBkZXY7CisKKwl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2
LCBQTEFORV9DVEwocGlwZSwgcGxhbmVfaWQpKTsKKworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
ID49IDExKQorCQlwaXhlbF9mb3JtYXQgPSB2YWwgJiBJQ0xfUExBTkVfQ1RMX0ZPUk1BVF9NQVNL
OworCWVsc2UKKwkJcGl4ZWxfZm9ybWF0ID0gdmFsICYgUExBTkVfQ1RMX0ZPUk1BVF9NQVNLOwor
CisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJp
dikpIHsKKwkJYWxwaGEgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LAorCQkJCSAgICAgIFBMQU5F
X0NPTE9SX0NUTChwaXBlLCBwbGFuZV9pZCkpOworCQlhbHBoYSAmPSBQTEFORV9DT0xPUl9BTFBI
QV9NQVNLOworCX0gZWxzZSB7CisJCWFscGhhID0gdmFsICYgUExBTkVfQ1RMX0FMUEhBX01BU0s7
CisJfQorCisJZm91cmNjID0gc2tsX2Zvcm1hdF90b19mb3VyY2MocGl4ZWxfZm9ybWF0LAorCQkJ
CSAgICAgIHZhbCAmIFBMQU5FX0NUTF9PUkRFUl9SR0JYLCBhbHBoYSk7CisJZmItPmZvcm1hdCA9
IGRybV9mb3JtYXRfaW5mbyhmb3VyY2MpOworCisJdGlsaW5nID0gdmFsICYgUExBTkVfQ1RMX1RJ
TEVEX01BU0s7CisJc3dpdGNoICh0aWxpbmcpIHsKKwljYXNlIFBMQU5FX0NUTF9USUxFRF9MSU5F
QVI6CisJCWZiLT5tb2RpZmllciA9IERSTV9GT1JNQVRfTU9EX0xJTkVBUjsKKwkJYnJlYWs7CisJ
Y2FzZSBQTEFORV9DVExfVElMRURfWDoKKwkJcGxhbmVfY29uZmlnLT50aWxpbmcgPSBJOTE1X1RJ
TElOR19YOworCQlmYi0+bW9kaWZpZXIgPSBJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRDsKKwkJYnJl
YWs7CisJY2FzZSBQTEFORV9DVExfVElMRURfWToKKwkJcGxhbmVfY29uZmlnLT50aWxpbmcgPSBJ
OTE1X1RJTElOR19ZOworCQlpZiAodmFsICYgUExBTkVfQ1RMX1JFTkRFUl9ERUNPTVBSRVNTSU9O
X0VOQUJMRSkKKwkJCWZiLT5tb2RpZmllciA9IElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIgPwor
CQkJCUk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUyA6CisJCQkJSTkxNV9GT1JN
QVRfTU9EX1lfVElMRURfQ0NTOworCQllbHNlIGlmICh2YWwgJiBQTEFORV9DVExfTUVESUFfREVD
T01QUkVTU0lPTl9FTkFCTEUpCisJCQlmYi0+bW9kaWZpZXIgPSBJOTE1X0ZPUk1BVF9NT0RfWV9U
SUxFRF9HRU4xMl9NQ19DQ1M7CisJCWVsc2UKKwkJCWZiLT5tb2RpZmllciA9IEk5MTVfRk9STUFU
X01PRF9ZX1RJTEVEOworCQlicmVhazsKKwljYXNlIFBMQU5FX0NUTF9USUxFRF9ZRjoKKwkJaWYg
KHZhbCAmIFBMQU5FX0NUTF9SRU5ERVJfREVDT01QUkVTU0lPTl9FTkFCTEUpCisJCQlmYi0+bW9k
aWZpZXIgPSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRURfQ0NTOworCQllbHNlCisJCQlmYi0+bW9k
aWZpZXIgPSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRUQ7CisJCWJyZWFrOworCWRlZmF1bHQ6CisJ
CU1JU1NJTkdfQ0FTRSh0aWxpbmcpOworCQlnb3RvIGVycm9yOworCX0KKworCS8qCisJICogRFJN
X01PREVfUk9UQVRFXyBpcyBjb3VudGVyIGNsb2Nrd2lzZSB0byBzdGF5IGNvbXBhdGlibGUgd2l0
aCBYcmFuZHIKKwkgKiB3aGlsZSBpOTE1IEhXIHJvdGF0aW9uIGlzIGNsb2Nrd2lzZSwgdGhhdHMg
d2h5IHRoaXMgc3dhcHBpbmcuCisJICovCisJc3dpdGNoICh2YWwgJiBQTEFORV9DVExfUk9UQVRF
X01BU0spIHsKKwljYXNlIFBMQU5FX0NUTF9ST1RBVEVfMDoKKwkJcGxhbmVfY29uZmlnLT5yb3Rh
dGlvbiA9IERSTV9NT0RFX1JPVEFURV8wOworCQlicmVhazsKKwljYXNlIFBMQU5FX0NUTF9ST1RB
VEVfOTA6CisJCXBsYW5lX2NvbmZpZy0+cm90YXRpb24gPSBEUk1fTU9ERV9ST1RBVEVfMjcwOwor
CQlicmVhazsKKwljYXNlIFBMQU5FX0NUTF9ST1RBVEVfMTgwOgorCQlwbGFuZV9jb25maWctPnJv
dGF0aW9uID0gRFJNX01PREVfUk9UQVRFXzE4MDsKKwkJYnJlYWs7CisJY2FzZSBQTEFORV9DVExf
Uk9UQVRFXzI3MDoKKwkJcGxhbmVfY29uZmlnLT5yb3RhdGlvbiA9IERSTV9NT0RFX1JPVEFURV85
MDsKKwkJYnJlYWs7CisJfQorCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgJiYKKwkg
ICAgdmFsICYgUExBTkVfQ1RMX0ZMSVBfSE9SSVpPTlRBTCkKKwkJcGxhbmVfY29uZmlnLT5yb3Rh
dGlvbiB8PSBEUk1fTU9ERV9SRUZMRUNUX1g7CisKKwkvKiA5MC8yNzAgZGVncmVlIHJvdGF0aW9u
IHdvdWxkIHJlcXVpcmUgZXh0cmEgd29yayAqLworCWlmIChkcm1fcm90YXRpb25fOTBfb3JfMjcw
KHBsYW5lX2NvbmZpZy0+cm90YXRpb24pKQorCQlnb3RvIGVycm9yOworCisJYmFzZSA9IGludGVs
X2RlX3JlYWQoZGV2X3ByaXYsIFBMQU5FX1NVUkYocGlwZSwgcGxhbmVfaWQpKSAmIDB4ZmZmZmYw
MDA7CisJcGxhbmVfY29uZmlnLT5iYXNlID0gYmFzZTsKKworCW9mZnNldCA9IGludGVsX2RlX3Jl
YWQoZGV2X3ByaXYsIFBMQU5FX09GRlNFVChwaXBlLCBwbGFuZV9pZCkpOworCisJdmFsID0gaW50
ZWxfZGVfcmVhZChkZXZfcHJpdiwgUExBTkVfU0laRShwaXBlLCBwbGFuZV9pZCkpOworCWZiLT5o
ZWlnaHQgPSAoKHZhbCA+PiAxNikgJiAweGZmZmYpICsgMTsKKwlmYi0+d2lkdGggPSAoKHZhbCA+
PiAwKSAmIDB4ZmZmZikgKyAxOworCisJdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgUExB
TkVfU1RSSURFKHBpcGUsIHBsYW5lX2lkKSk7CisJc3RyaWRlX211bHQgPSBza2xfcGxhbmVfc3Ry
aWRlX211bHQoZmIsIDAsIERSTV9NT0RFX1JPVEFURV8wKTsKKwlmYi0+cGl0Y2hlc1swXSA9ICh2
YWwgJiAweDNmZikgKiBzdHJpZGVfbXVsdDsKKworCWFsaWduZWRfaGVpZ2h0ID0gaW50ZWxfZmJf
YWxpZ25faGVpZ2h0KGZiLCAwLCBmYi0+aGVpZ2h0KTsKKworCXBsYW5lX2NvbmZpZy0+c2l6ZSA9
IGZiLT5waXRjaGVzWzBdICogYWxpZ25lZF9oZWlnaHQ7CisKKwlkcm1fZGJnX2ttcygmZGV2X3By
aXYtPmRybSwKKwkJICAgICIlcy8lcyB3aXRoIGZiOiBzaXplPSVkeCVkQCVkLCBvZmZzZXQ9JXgs
IHBpdGNoICVkLCBzaXplIDB4JXhcbiIsCisJCSAgICBjcnRjLT5iYXNlLm5hbWUsIHBsYW5lLT5i
YXNlLm5hbWUsIGZiLT53aWR0aCwgZmItPmhlaWdodCwKKwkJICAgIGZiLT5mb3JtYXQtPmNwcFsw
XSAqIDgsIGJhc2UsIGZiLT5waXRjaGVzWzBdLAorCQkgICAgcGxhbmVfY29uZmlnLT5zaXplKTsK
KworCXBsYW5lX2NvbmZpZy0+ZmIgPSBpbnRlbF9mYjsKKwlyZXR1cm47CisKK2Vycm9yOgorCWtm
cmVlKGludGVsX2ZiKTsKK30KKwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9za2xfdW5pdmVyc2FsX3BsYW5lLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L3NrbF91bml2ZXJzYWxfcGxhbmUuaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAw
MDAwMDAuLjcwZWI1MDEwY2QyOAotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvc2tsX3VuaXZlcnNhbF9wbGFuZS5oCkBAIC0wLDAgKzEsMzMgQEAKKy8qIFNQ
RFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQgKi8KKy8qCisgKiBDb3B5cmlnaHQgwqkgMjAyMCBJ
bnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpZm5kZWYgX1NLTF9VTklWRVJTQUxfUExBTkVfSF8K
KyNkZWZpbmUgX1NLTF9VTklWRVJTQUxfUExBTkVfSF8KKworI2luY2x1ZGUgPGxpbnV4L3R5cGVz
Lmg+CisKK3N0cnVjdCBkcm1fZnJhbWVidWZmZXI7CitzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZTsK
K3N0cnVjdCBpbnRlbF9jcnRjOworc3RydWN0IGludGVsX2luaXRpYWxfcGxhbmVfY29uZmlnOwor
c3RydWN0IGludGVsX3BsYW5lX3N0YXRlOworCitlbnVtIHBpcGU7CitlbnVtIHBsYW5lX2lkOwor
CitzdHJ1Y3QgaW50ZWxfcGxhbmUgKgorc2tsX3VuaXZlcnNhbF9wbGFuZV9jcmVhdGUoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorCQkJICAgZW51bSBwaXBlIHBpcGUsIGVudW0g
cGxhbmVfaWQgcGxhbmVfaWQpOworCit2b2lkIHNrbF9nZXRfaW5pdGlhbF9wbGFuZV9jb25maWco
c3RydWN0IGludGVsX2NydGMgKmNydGMsCisJCQkJICBzdHJ1Y3QgaW50ZWxfaW5pdGlhbF9wbGFu
ZV9jb25maWcgKnBsYW5lX2NvbmZpZyk7CisKK2ludCBza2xfZm9ybWF0X3RvX2ZvdXJjYyhpbnQg
Zm9ybWF0LCBib29sIHJnYl9vcmRlciwgYm9vbCBhbHBoYSk7CisKK2ludCBza2xfY2NzX3RvX21h
aW5fcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjY3NfcGxhbmUp
OworaW50IHNrbF9jYWxjX21haW5fc3VyZmFjZV9vZmZzZXQoY29uc3Qgc3RydWN0IGludGVsX3Bs
YW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKKwkJCQkgaW50ICp4LCBpbnQgKnksIHUzMiAqb2Zmc2V0
KTsKKworI2VuZGlmCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L3Zs
dl9kc2kuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvdmx2X2RzaS5jCmluZGV4IGY5
NDAyNWVjNjAzYS4uZWJmMjY2NDU3NTE4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L3Zsdl9kc2kuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L3Zs
dl9kc2kuYwpAQCAtMzgsNiArMzgsNyBAQAogI2luY2x1ZGUgImludGVsX2ZpZm9fdW5kZXJydW4u
aCIKICNpbmNsdWRlICJpbnRlbF9wYW5lbC5oIgogI2luY2x1ZGUgImludGVsX3NpZGViYW5kLmgi
CisjaW5jbHVkZSAic2tsX3VuaXZlcnNhbF9wbGFuZS5oIgogCiAvKiByZXR1cm4gcGl4ZWxzIGlu
IHRlcm1zIG9mIHR4Ynl0ZWNsa2hzICovCiBzdGF0aWMgdTE2IHR4Ynl0ZWNsa2hzKHUxNiBwaXhl
bHMsIGludCBicHAsIGludCBsYW5lX2NvdW50LApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaW50ZWxfcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKaW5kZXgg
YmJjNzNkZjdmNzUzLi5iYzQwZWNjMTdhNTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2ludGVsX3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwpAQCAt
MzgsNiArMzgsNyBAQAogI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oIgog
I2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfZmJjLmgiCiAjaW5jbHVkZSAiZGlzcGxheS9pbnRlbF9z
cHJpdGUuaCIKKyNpbmNsdWRlICJkaXNwbGF5L3NrbF91bml2ZXJzYWxfcGxhbmUuaCIKIAogI2lu
Y2x1ZGUgImd0L2ludGVsX2xsYy5oIgogCi0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwt
Z2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9t
YWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

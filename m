Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8ACFBF09E3
	for <lists+intel-gfx@lfdr.de>; Tue,  5 Nov 2019 23:53:52 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id F29746EB7B;
	Tue,  5 Nov 2019 22:53:50 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga17.intel.com (mga17.intel.com [192.55.52.151])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2A2356EB7B
 for <intel-gfx@lists.freedesktop.org>; Tue,  5 Nov 2019 22:53:49 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga006.fm.intel.com ([10.253.24.20])
 by fmsmga107.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 05 Nov 2019 14:53:40 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.68,271,1569308400"; d="scan'208";a="403527439"
Received: from dceraolo-linux.fm.intel.com ([10.1.27.145])
 by fmsmga006.fm.intel.com with ESMTP; 05 Nov 2019 14:53:40 -0800
From: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue,  5 Nov 2019 14:53:21 -0800
Message-Id: <20191105225321.26642-1-daniele.ceraolospurio@intel.com>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2] drm/i915/guc: Properly capture & release GuC
 interrupts on Gen11+
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Oscar Mateo <oscar.mateo@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2l0aCB0aGUgbmV3IGludGVycnVwdCByZS1wYXJ0aXRpb25pbmcgaW4gR2VuMTEsIEd1QyBjb250
cm9scyBieSBpdHNlbGYKdGhlIGludGVycnVwdHMgaXQgcmVjZWl2ZXMsIHNvIHN0ZWVyaW5nIGJp
dHMgYW5kIHJlZ2lzdGVycyBoYXZlIGJlZW4KZGVmZWF0dXJlZC4gQmVpbmcgdGhpcyB0aGUgY2Fz
ZSwgd2hlbiB0aGUgR3VDIGlzIGluIGNvbnRyb2wgb2YKc3VibWlzc2lvbnMgd2Ugd29uJ3Qga25v
dyB3aGF0IHRvIGRvIHdpdGggdGhlIGN0eCBzd2l0Y2ggaW50ZXJydXB0CmluIHRoZSBkcml2ZXIs
IHNvIGRpc2FibGUgaXQuCgp2MiAoRGFuaWVsZSk6IHJlcGxhY2UgdGhlIGdlbjkgcGF0aHMgaW5z
dGVhZCBvZiBrZWVwaW5nIGdlbjkgYW5kIGdlbjExCmZ1bmN0aW9ucyBzaW5jZSB3ZSB3b24ndCBz
dXBwb3J0IGd1YyBzdWJtaXNzaW9uIG9uIGFueSBwcmUtZ2VuMTEgcGxhdGZvcm0uCgpTaWduZWQt
b2ZmLWJ5OiBPc2NhciBNYXRlbyA8b3NjYXIubWF0ZW9AaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5
OiBNaWNoYWwgV2FqZGVjemtvIDxtaWNoYWwud2FqZGVjemtvQGludGVsLmNvbT4KU2lnbmVkLW9m
Zi1ieTogRGFuaWVsZSBDZXJhb2xvIFNwdXJpbyA8ZGFuaWVsZS5jZXJhb2xvc3B1cmlvQGludGVs
LmNvbT4KQ2M6IEpvaG4gSGFycmlzb24gPEpvaG4uQy5IYXJyaXNvbkBJbnRlbC5jb20+CkNjOiBN
YXR0aGV3IEJyb3N0IDxtYXR0aGV3LmJyb3N0QGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9ycHMuYyAgICAgICAgICAgfCAgMiArLQogLi4uL2dwdS9kcm0vaTkx
NS9ndC91Yy9pbnRlbF9ndWNfc3VibWlzc2lvbi5jIHwgNzIgKysrKy0tLS0tLS0tLS0tLS0tLQog
MiBmaWxlcyBjaGFuZ2VkLCAxNCBpbnNlcnRpb25zKCspLCA2MCBkZWxldGlvbnMoLSkKCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ycHMuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX3Jwcy5jCmluZGV4IDIwZDZlZTE0OGFmYy4uMDhhMzhhM2I5MGIw
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ycHMuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ycHMuYwpAQCAtMTY2Myw3ICsxNjYzLDcgQEAg
dm9pZCBpbnRlbF9ycHNfaW5pdChzdHJ1Y3QgaW50ZWxfcnBzICpycHMpCiAJaWYgKElOVEVMX0dF
TihpOTE1KSA8PSA3KQogCQlycHMtPnBtX2ludHJtc2tfbWJ6IHw9IEdFTjZfUE1fUlBfVVBfRUlf
RVhQSVJFRDsKIAotCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gOCkKKwlpZiAoSU5URUxfR0VOKGk5
MTUpID49IDggJiYgSU5URUxfR0VOKGk5MTUpIDwgMTEpCiAJCXJwcy0+cG1faW50cm1za19tYnog
fD0gR0VOOF9QTUlOVFJfRElTQUJMRV9SRURJUkVDVF9UT19HVUM7CiB9CiAKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX2d1Y19zdWJtaXNzaW9uLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF9ndWNfc3VibWlzc2lvbi5jCmluZGV4IDI0OThj
NTVlMGVhNS4uOTAyZTI1ZWI2YjlkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC91Yy9pbnRlbF9ndWNfc3VibWlzc2lvbi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3VjL2ludGVsX2d1Y19zdWJtaXNzaW9uLmMKQEAgLTEwMTEsNzQgKzEwMTEsMjggQEAgdm9pZCBp
bnRlbF9ndWNfc3VibWlzc2lvbl9maW5pKHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKIAogc3RhdGlj
IHZvaWQgZ3VjX2ludGVycnVwdHNfY2FwdHVyZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogewotCXN0
cnVjdCBpbnRlbF9ycHMgKnJwcyA9ICZndC0+cnBzOwogCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVu
Y29yZSA9IGd0LT51bmNvcmU7Ci0Jc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCWVu
dW0gaW50ZWxfZW5naW5lX2lkIGlkOwotCWludCBpcnFzOworCXUzMiBpcnFzID0gR1RfQ09OVEVY
VF9TV0lUQ0hfSU5URVJSVVBUOworCXUzMiBkbWFzayA9IGlycXMgPDwgMTYgfCBpcnFzOwogCi0J
LyogdGVsbCBhbGwgY29tbWFuZCBzdHJlYW1lcnMgdG8gZm9yd2FyZCBpbnRlcnJ1cHRzIChidXQg
bm90IHZibGFuaykKLQkgKiB0byBHdUMKLQkgKi8KLQlpcnFzID0gX01BU0tFRF9CSVRfRU5BQkxF
KEdGWF9JTlRFUlJVUFRfU1RFRVJJTkcpOwotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBp
ZCkKLQkJRU5HSU5FX1dSSVRFKGVuZ2luZSwgUklOR19NT0RFX0dFTjcsIGlycXMpOwotCi0JLyog
cm91dGUgVVNFUl9JTlRFUlJVUFQgdG8gSG9zdCwgYWxsIG90aGVycyBhcmUgc2VudCB0byBHdUMu
ICovCi0JaXJxcyA9IEdUX1JFTkRFUl9VU0VSX0lOVEVSUlVQVCA8PCBHRU44X1JDU19JUlFfU0hJ
RlQgfAotCSAgICAgICBHVF9SRU5ERVJfVVNFUl9JTlRFUlJVUFQgPDwgR0VOOF9CQ1NfSVJRX1NI
SUZUOwotCS8qIFRoZXNlIHRocmVlIHJlZ2lzdGVycyBoYXZlIHRoZSBzYW1lIGJpdCBkZWZpbml0
aW9ucyAqLwotCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsIEdVQ19CQ1NfUkNTX0lFUiwgfmly
cXMpOwotCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsIEdVQ19WQ1MyX1ZDUzFfSUVSLCB+aXJx
cyk7Ci0JaW50ZWxfdW5jb3JlX3dyaXRlKHVuY29yZSwgR1VDX1dEX1ZFQ1NfSUVSLCB+aXJxcyk7
CisJR0VNX0JVR19PTihJTlRFTF9HRU4oZ3QtPmk5MTUpIDwgMTEpOwogCi0JLyoKLQkgKiBUaGUg
UkVESVJFQ1RfVE9fR1VDIGJpdCBvZiB0aGUgUE1JTlRSTVNLIHJlZ2lzdGVyIGRpcmVjdHMgYWxs
Ci0JICogKHVubWFza2VkKSBQTSBpbnRlcnJ1cHRzIHRvIHRoZSBHdUMuIEFsbCBvdGhlciBiaXRz
IG9mIHRoaXMKLQkgKiByZWdpc3RlciAqZGlzYWJsZSogZ2VuZXJhdGlvbiBvZiBhIHNwZWNpZmlj
IGludGVycnVwdC4KLQkgKgotCSAqICdwbV9pbnRybXNrX21ieicgaW5kaWNhdGVzIGJpdHMgdGhh
dCBhcmUgTk9UIHRvIGJlIHNldCB3aGVuCi0JICogd3JpdGluZyB0byB0aGUgUE0gaW50ZXJydXB0
IG1hc2sgcmVnaXN0ZXIsIGkuZS4gaW50ZXJydXB0cwotCSAqIHRoYXQgbXVzdCBub3QgYmUgZGlz
YWJsZWQuCi0JICoKLQkgKiBJZiB0aGUgR3VDIGlzIGhhbmRsaW5nIHRoZXNlIGludGVycnVwdHMs
IHRoZW4gd2UgbXVzdCBub3QgbGV0Ci0JICogdGhlIFBNIGNvZGUgZGlzYWJsZSBBTlkgaW50ZXJy
dXB0IHRoYXQgdGhlIEd1QyBpcyBleHBlY3RpbmcuCi0JICogU28gZm9yIGVhY2ggRU5BQkxFRCAo
MCkgYml0IGluIHRoaXMgcmVnaXN0ZXIsIHdlIG11c3QgU0VUIHRoZQotCSAqIGJpdCBpbiBwbV9p
bnRybXNrX21ieiBzbyB0aGF0IGl0J3MgbGVmdCBlbmFibGVkIGZvciB0aGUgR3VDLgotCSAqIEd1
QyBuZWVkcyBBUkFUIGV4cGlyZWQgaW50ZXJydXB0IHVubWFza2VkIGhlbmNlIGl0IGlzIHNldCBp
bgotCSAqIHBtX2ludHJtc2tfbWJ6LgotCSAqCi0JICogSGVyZSB3ZSBDTEVBUiBSRURJUkVDVF9U
T19HVUMgYml0IGluIHBtX2ludHJtc2tfbWJ6LCB3aGljaCB3aWxsCi0JICogcmVzdWx0IGluIHRo
ZSByZWdpc3RlciBiaXQgYmVpbmcgbGVmdCBTRVQhCi0JICovCi0JcnBzLT5wbV9pbnRybXNrX21i
eiB8PSBBUkFUX0VYUElSRURfSU5UUk1TSzsKLQlycHMtPnBtX2ludHJtc2tfbWJ6ICY9IH5HRU44
X1BNSU5UUl9ESVNBQkxFX1JFRElSRUNUX1RPX0dVQzsKKwkvKiBEb24ndCBoYW5kbGUgdGhlIGN0
eCBzd2l0Y2ggaW50ZXJydXB0IGluIEd1QyBzdWJtaXNzaW9uIG1vZGUgKi8KKwlpbnRlbF91bmNv
cmVfcm13KHVuY29yZSwgR0VOMTFfUkVOREVSX0NPUFlfSU5UUl9FTkFCTEUsIGRtYXNrLCAwKTsK
KwlpbnRlbF91bmNvcmVfcm13KHVuY29yZSwgR0VOMTFfVkNTX1ZFQ1NfSU5UUl9FTkFCTEUsIGRt
YXNrLCAwKTsKIH0KIAogc3RhdGljIHZvaWQgZ3VjX2ludGVycnVwdHNfcmVsZWFzZShzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0KQogewotCXN0cnVjdCBpbnRlbF9ycHMgKnJwcyA9ICZndC0+cnBzOwogCXN0
cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9IGd0LT51bmNvcmU7Ci0Jc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lOwotCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwotCWludCBpcnFzOwor
CXUzMiBpcnFzID0gR1RfQ09OVEVYVF9TV0lUQ0hfSU5URVJSVVBUOworCXUzMiBkbWFzayA9IGly
cXMgPDwgMTYgfCBpcnFzOwogCi0JLyoKLQkgKiB0ZWxsIGFsbCBjb21tYW5kIHN0cmVhbWVycyBO
T1QgdG8gZm9yd2FyZCBpbnRlcnJ1cHRzIG9yIHZibGFuawotCSAqIHRvIEd1Qy4KLQkgKi8KLQlp
cnFzID0gX01BU0tFRF9GSUVMRChHRlhfRk9SV0FSRF9WQkxBTktfTUFTSywgR0ZYX0ZPUldBUkRf
VkJMQU5LX05FVkVSKTsKLQlpcnFzIHw9IF9NQVNLRURfQklUX0RJU0FCTEUoR0ZYX0lOVEVSUlVQ
VF9TVEVFUklORyk7Ci0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKQotCQlFTkdJTkVf
V1JJVEUoZW5naW5lLCBSSU5HX01PREVfR0VONywgaXJxcyk7Ci0KLQkvKiByb3V0ZSBhbGwgR1Qg
aW50ZXJydXB0cyB0byB0aGUgaG9zdCAqLwotCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsIEdV
Q19CQ1NfUkNTX0lFUiwgMCk7Ci0JaW50ZWxfdW5jb3JlX3dyaXRlKHVuY29yZSwgR1VDX1ZDUzJf
VkNTMV9JRVIsIDApOwotCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsIEdVQ19XRF9WRUNTX0lF
UiwgMCk7Ci0KLQlycHMtPnBtX2ludHJtc2tfbWJ6IHw9IEdFTjhfUE1JTlRSX0RJU0FCTEVfUkVE
SVJFQ1RfVE9fR1VDOwotCXJwcy0+cG1faW50cm1za19tYnogJj0gfkFSQVRfRVhQSVJFRF9JTlRS
TVNLOworCUdFTV9CVUdfT04oSU5URUxfR0VOKGd0LT5pOTE1KSA8IDExKTsKKworCS8qIEhhbmRs
ZSBjdHggc3dpdGNoIGludGVycnVwdHMgYWdhaW4gKi8KKwlpbnRlbF91bmNvcmVfcm13KHVuY29y
ZSwgR0VOMTFfUkVOREVSX0NPUFlfSU5UUl9FTkFCTEUsIDAsIGRtYXNrKTsKKwlpbnRlbF91bmNv
cmVfcm13KHVuY29yZSwgR0VOMTFfVkNTX1ZFQ1NfSU5UUl9FTkFCTEUsIDAsIGRtYXNrKTsKIH0K
IAogc3RhdGljIHZvaWQgZ3VjX3NldF9kZWZhdWx0X3N1Ym1pc3Npb24oc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lKQotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0
cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9s
aXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7FA6533F85E
	for <lists+intel-gfx@lfdr.de>; Wed, 17 Mar 2021 19:49:15 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BE95B6E1ED;
	Wed, 17 Mar 2021 18:49:12 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C02876E1ED
 for <intel-gfx@lists.freedesktop.org>; Wed, 17 Mar 2021 18:49:08 +0000 (UTC)
IronPort-SDR: Pa1iYcql/s0NbKfWcMCVHk0D3UG2N8XOj/xUJab2LVkKuyU03uW5qhyA7Y9327SBYznj4elxOb
 IFLuvkCT1gYg==
X-IronPort-AV: E=McAfee;i="6000,8403,9926"; a="253537472"
X-IronPort-AV: E=Sophos;i="5.81,257,1610438400"; d="scan'208";a="253537472"
Received: from fmsmga001.fm.intel.com ([10.253.24.23])
 by orsmga105.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 17 Mar 2021 11:49:08 -0700
IronPort-SDR: wGfihjOPLa1IELisnTFUl3lzhVAFhvZNk+icKz2ezxEAZw3zpeUqzEg7YcdeC/QOYRnVd0lU2A
 txh9171yxc9g==
X-IronPort-AV: E=Sophos;i="5.81,257,1610438400"; d="scan'208";a="511828574"
Received: from ideak-desk.fi.intel.com ([10.237.68.141])
 by fmsmga001-auth.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 17 Mar 2021 11:49:07 -0700
From: Imre Deak <imre.deak@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 17 Mar 2021 20:49:00 +0200
Message-Id: <20210317184901.4029798-3-imre.deak@intel.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20210317184901.4029798-1-imre.deak@intel.com>
References: <20210317184901.4029798-1-imre.deak@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 2/3] drm/i915: Disable LTTPR support when the
 DPCD rev < 1.4
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: stable@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QnkgdGhlIHNwZWNpZmljYXRpb24gdGhlIDB4RjAwMDAtMHhGMDJGRiByYW5nZSBpcyBvbmx5IHZh
bGlkIHdoZW4gdGhlCkRQQ0QgcmV2aXNpb24gaXMgMS40IG9yIGhpZ2hlci4gRGlzYWJsZSBMVFRQ
UiBzdXBwb3J0IGlmIHRoaXMgaXNuJ3Qgc28uCgpUcnlpbmcgdG8gZGV0ZWN0IExUVFBScyByZXR1
cm5lZCBjb3JydXB0ZWQgdmFsdWVzIGZvciB0aGUgYWJvdmUgRFBDRApyYW5nZSBhdCBsZWFzdCBv
biBhIFNreWxha2UgaG9zdCB3aXRoIGFuIExHIDQzVUQ3OS1CIG1vbml0b3Igd2l0aCBhIERQQ0QK
cmV2aXNpb24gMS4yIGNvbm5lY3RlZC4KCkZpeGVzOiA3YjJhNGFiOGIwZWYgKCJkcm0vaTkxNTog
U3dpdGNoIHRvIExUVFBSIHRyYW5zcGFyZW50IG1vZGUgbGluayB0cmFpbmluZyIpCkNjOiA8c3Rh
YmxlQHZnZXIua2VybmVsLm9yZz4gIyB2NS4xMQpDYzogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5z
eXJqYWxhQGxpbnV4LmludGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogSW1yZSBEZWFrIDxpbXJlLmRl
YWtAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAu
YyAgICAgICB8ICA0ICstCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9saW5rX3RyYWlu
aW5nLmMgfCAzOSArKysrKysrKysrKysrLS0tLS0tCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kcF9saW5rX3RyYWluaW5nLmggfCAgMiArLQogMyBmaWxlcyBjaGFuZ2VkLCAzMCBpbnNlcnRp
b25zKCspLCAxNSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2RwLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2RwLmMKaW5kZXggYjZiNTc3NmY1YTY2Li44NzM2ODRkYTBjZDQgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2RwLmMKQEAgLTM3MTEsOSArMzcxMSw3IEBAIGludGVsX2RwX2dl
dF9kcGNkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CiAJaW50IHJldDsKIAotCWludGVs
X2RwX2x0dHByX2luaXQoaW50ZWxfZHApOwotCi0JaWYgKGRybV9kcF9yZWFkX2RwY2RfY2Fwcygm
aW50ZWxfZHAtPmF1eCwgaW50ZWxfZHAtPmRwY2QpKQorCWlmIChpbnRlbF9kcF9pbml0X2x0dHBy
X2FuZF9kcHJ4X2NhcHMoaW50ZWxfZHApIDwgMCkKIAkJcmV0dXJuIGZhbHNlOwogCiAJLyoKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbGlua190cmFp
bmluZy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9saW5rX3RyYWlu
aW5nLmMKaW5kZXggYzBlMjVjNzVjMTA1Li5kOGQ5MDkwMzIyNmYgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbGlua190cmFpbmluZy5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbGlua190cmFpbmluZy5jCkBAIC0z
NSw2ICszNSwxMSBAQCBpbnRlbF9kcF9kdW1wX2xpbmtfc3RhdHVzKHN0cnVjdCBkcm1fZGV2aWNl
ICpkcm0sCiAJCSAgICBsaW5rX3N0YXR1c1szXSwgbGlua19zdGF0dXNbNF0sIGxpbmtfc3RhdHVz
WzVdKTsKIH0KIAorc3RhdGljIHZvaWQgaW50ZWxfZHBfcmVzZXRfbHR0cHJfY29tbW9uX2NhcHMo
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKK3sKKwltZW1zZXQoJmludGVsX2RwLT5sdHRwcl9j
b21tb25fY2FwcywgMCwgc2l6ZW9mKGludGVsX2RwLT5sdHRwcl9jb21tb25fY2FwcykpOworfQor
CiBzdGF0aWMgdm9pZCBpbnRlbF9kcF9yZXNldF9sdHRwcl9jb3VudChzdHJ1Y3QgaW50ZWxfZHAg
KmludGVsX2RwKQogewogCWludGVsX2RwLT5sdHRwcl9jb21tb25fY2Fwc1tEUF9QSFlfUkVQRUFU
RVJfQ05UIC0KQEAgLTk2LDggKzEwMSw3IEBAIHN0YXRpYyBib29sIGludGVsX2RwX3JlYWRfbHR0
cHJfY29tbW9uX2NhcHMoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAogCWlmIChkcm1fZHBf
cmVhZF9sdHRwcl9jb21tb25fY2FwcygmaW50ZWxfZHAtPmF1eCwKIAkJCQkJICBpbnRlbF9kcC0+
bHR0cHJfY29tbW9uX2NhcHMpIDwgMCkgewotCQltZW1zZXQoaW50ZWxfZHAtPmx0dHByX2NvbW1v
bl9jYXBzLCAwLAotCQkgICAgICAgc2l6ZW9mKGludGVsX2RwLT5sdHRwcl9jb21tb25fY2Fwcykp
OworCQlpbnRlbF9kcF9yZXNldF9sdHRwcl9jb21tb25fY2FwcyhpbnRlbF9kcCk7CiAJCXJldHVy
biBmYWxzZTsKIAl9CiAKQEAgLTExOSwyNyArMTIzLDM3IEBAIGludGVsX2RwX3NldF9sdHRwcl90
cmFuc3BhcmVudF9tb2RlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIGJvb2wgZW5hYmxlKQog
fQogCiAvKioKLSAqIGludGVsX2RwX2x0dHByX2luaXQgLSBkZXRlY3QgTFRUUFJzIGFuZCBpbml0
IHRoZSBMVFRQUiBsaW5rIHRyYWluaW5nIG1vZGUKKyAqIGludGVsX2RwX2luaXRfbHR0cHJfYW5k
X2RwcnhfY2FwcyAtIGRldGVjdCBMVFRQUiBhbmQgRFBSWCBjYXBzLCBpbml0IHRoZSBMVFRQUiBs
aW5rIHRyYWluaW5nIG1vZGUKICAqIEBpbnRlbF9kcDogSW50ZWwgRFAgc3RydWN0CiAgKgotICog
UmVhZCB0aGUgTFRUUFIgY29tbW9uIGNhcGFiaWxpdGllcywgc3dpdGNoIHRvIG5vbi10cmFuc3Bh
cmVudCBsaW5rIHRyYWluaW5nCi0gKiBtb2RlIGlmIGFueSBpcyBkZXRlY3RlZCBhbmQgcmVhZCB0
aGUgUEhZIGNhcGFiaWxpdGllcyBmb3IgYWxsIGRldGVjdGVkCi0gKiBMVFRQUnMuIEluIGNhc2Ug
b2YgYW4gTFRUUFIgZGV0ZWN0aW9uIGVycm9yIG9yIGlmIHRoZSBudW1iZXIgb2YKKyAqIFJlYWQg
dGhlIExUVFBSIGNvbW1vbiBhbmQgRFBSWCBjYXBhYmlsaXRpZXMgYW5kIHN3aXRjaCB0byBub24t
dHJhbnNwYXJlbnQKKyAqIGxpbmsgdHJhaW5pbmcgbW9kZSBpZiBhbnkgaXMgZGV0ZWN0ZWQgYW5k
IHJlYWQgdGhlIFBIWSBjYXBhYmlsaXRpZXMgZm9yIGFsbAorICogZGV0ZWN0ZWQgTFRUUFJzLiBJ
biBjYXNlIG9mIGFuIExUVFBSIGRldGVjdGlvbiBlcnJvciBvciBpZiB0aGUgbnVtYmVyIG9mCiAg
KiBMVFRQUnMgaXMgbW9yZSB0aGFuIGlzIHN1cHBvcnRlZCAoOCksIGZhbGwgYmFjayB0byB0aGUg
bm8tTFRUUFIsCiAgKiB0cmFuc3BhcmVudCBtb2RlIGxpbmsgdHJhaW5pbmcgbW9kZS4KICAqCiAg
KiBSZXR1cm5zOgotICogICA+MCAgaWYgTFRUUFJzIHdlcmUgZGV0ZWN0ZWQgYW5kIHRoZSBub24t
dHJhbnNwYXJlbnQgTFQgbW9kZSB3YXMgc2V0CisgKiAgID4wICBpZiBMVFRQUnMgd2VyZSBkZXRl
Y3RlZCBhbmQgdGhlIG5vbi10cmFuc3BhcmVudCBMVCBtb2RlIHdhcyBzZXQuIFRoZQorICogICAg
ICAgRFBSWCBjYXBhYmlsaXRpZXMgYXJlIHJlYWQgb3V0LgogICogICAgMCAgaWYgbm8gTFRUUFJz
IG9yIG1vcmUgdGhhbiA4IExUVFBScyB3ZXJlIGRldGVjdGVkIG9yIGluIGNhc2Ugb2YgYQotICog
ICAgICAgZGV0ZWN0aW9uIGZhaWx1cmUgYW5kIHRoZSB0cmFuc3BhcmVudCBMVCBtb2RlIHdhcyBz
ZXQKKyAqICAgICAgIGRldGVjdGlvbiBmYWlsdXJlIGFuZCB0aGUgdHJhbnNwYXJlbnQgTFQgbW9k
ZSB3YXMgc2V0LiBUaGUgRFBSWAorICogICAgICAgY2FwYWJpbGl0aWVzIGFyZSByZWFkIG91dC4K
KyAqICAgPDAgIFJlYWRpbmcgb3V0IHRoZSBEUFJYIGNhcGFiaWxpdGllcyBmYWlsZWQuCiAgKi8K
LWludCBpbnRlbF9kcF9sdHRwcl9pbml0KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCitpbnQg
aW50ZWxfZHBfaW5pdF9sdHRwcl9hbmRfZHByeF9jYXBzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHApCiB7CiAJaW50IGx0dHByX2NvdW50OwogCWJvb2wgcmV0OwogCWludCBpOwogCiAJcmV0ID0g
aW50ZWxfZHBfcmVhZF9sdHRwcl9jb21tb25fY2FwcyhpbnRlbF9kcCk7CisKKwkvKiBUaGUgRFBU
WCBzaGFsbCByZWFkIHRoZSBEUlBYIGNhcHMgYWZ0ZXIgTFRUUFIgZGV0ZWN0aW9uLiAqLworCWlm
IChkcm1fZHBfcmVhZF9kcGNkX2NhcHMoJmludGVsX2RwLT5hdXgsIGludGVsX2RwLT5kcGNkKSkg
eworCQlpbnRlbF9kcF9yZXNldF9sdHRwcl9jb21tb25fY2FwcyhpbnRlbF9kcCk7CisJCXJldHVy
biAtRUlPOworCX0KKwogCWlmICghcmV0KQogCQlyZXR1cm4gMDsKIApAQCAtMTgyLDcgKzE5Niw3
IEBAIGludCBpbnRlbF9kcF9sdHRwcl9pbml0KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAK
IAlyZXR1cm4gbHR0cHJfY291bnQ7CiB9Ci1FWFBPUlRfU1lNQk9MKGludGVsX2RwX2x0dHByX2lu
aXQpOworRVhQT1JUX1NZTUJPTChpbnRlbF9kcF9pbml0X2x0dHByX2FuZF9kcHJ4X2NhcHMpOwog
CiBzdGF0aWMgdTggZHBfdm9sdGFnZV9tYXgodTggcHJlZW1waCkKIHsKQEAgLTgxNyw3ICs4MzEs
MTAgQEAgdm9pZCBpbnRlbF9kcF9zdGFydF9saW5rX3RyYWluKHN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHAsCiAJICogVE9ETzogUmVpbml0aW5nIExUVFBScyBoZXJlIHdvbid0IGJlIG5lZWRlZCBv
bmNlIHByb3BlciBjb25uZWN0b3IKIAkgKiBIVyBzdGF0ZSByZWFkb3V0IGlzIGFkZGVkLgogCSAq
LwotCWludCBsdHRwcl9jb3VudCA9IGludGVsX2RwX2x0dHByX2luaXQoaW50ZWxfZHApOworCWlu
dCBsdHRwcl9jb3VudCA9IGludGVsX2RwX2luaXRfbHR0cHJfYW5kX2RwcnhfY2FwcyhpbnRlbF9k
cCk7CisKKwlpZiAobHR0cHJfY291bnQgPCAwKQorCQlyZXR1cm47CiAKIAlpZiAoIWludGVsX2Rw
X2xpbmtfdHJhaW5fYWxsX3BoeXMoaW50ZWxfZHAsIGNydGNfc3RhdGUsIGx0dHByX2NvdW50KSkK
IAkJaW50ZWxfZHBfc2NoZWR1bGVfZmFsbGJhY2tfbGlua190cmFpbmluZyhpbnRlbF9kcCwgY3J0
Y19zdGF0ZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2RwX2xpbmtfdHJhaW5pbmcuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZHBfbGlua190cmFpbmluZy5oCmluZGV4IDZhMWY3NmJkOGM3NS4uOWNiN2MyODAyN2YwIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX2xpbmtfdHJhaW5p
bmcuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX2xpbmtfdHJh
aW5pbmcuaApAQCAtMTEsNyArMTEsNyBAQAogc3RydWN0IGludGVsX2NydGNfc3RhdGU7CiBzdHJ1
Y3QgaW50ZWxfZHA7CiAKLWludCBpbnRlbF9kcF9sdHRwcl9pbml0KHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHApOworaW50IGludGVsX2RwX2luaXRfbHR0cHJfYW5kX2RwcnhfY2FwcyhzdHJ1Y3Qg
aW50ZWxfZHAgKmludGVsX2RwKTsKIAogdm9pZCBpbnRlbF9kcF9nZXRfYWRqdXN0X3RyYWluKHN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCi0tIAoyLjI1LjEKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

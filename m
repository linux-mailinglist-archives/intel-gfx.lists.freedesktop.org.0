Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id B82C110C0C5
	for <lists+intel-gfx@lfdr.de>; Thu, 28 Nov 2019 00:44:54 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 94C4E898A8;
	Wed, 27 Nov 2019 23:44:52 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga09.intel.com (mga09.intel.com [134.134.136.24])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2E61F898A8
 for <intel-gfx@lists.freedesktop.org>; Wed, 27 Nov 2019 23:44:51 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga005.fm.intel.com ([10.253.24.32])
 by orsmga102.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 27 Nov 2019 15:44:50 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,251,1571727600"; d="scan'208";a="409178028"
Received: from fmsmsx104.amr.corp.intel.com ([10.18.124.202])
 by fmsmga005.fm.intel.com with ESMTP; 27 Nov 2019 15:44:50 -0800
Received: from fmsmsx118.amr.corp.intel.com (10.18.116.18) by
 fmsmsx104.amr.corp.intel.com (10.18.124.202) with Microsoft SMTP Server (TLS)
 id 14.3.439.0; Wed, 27 Nov 2019 15:44:49 -0800
Received: from fmsmsx117.amr.corp.intel.com ([169.254.3.27]) by
 fmsmsx118.amr.corp.intel.com ([169.254.1.68]) with mapi id 14.03.0439.000;
 Wed, 27 Nov 2019 15:44:49 -0800
From: "Souza, Jose" <jose.souza@intel.com>
To: "ville.syrjala@linux.intel.com" <ville.syrjala@linux.intel.com>,
 "intel-gfx@lists.freedesktop.org" <intel-gfx@lists.freedesktop.org>
Thread-Topic: [Intel-gfx] [PATCH 5/7] drm/i915: Clean up the gen2 "no planes
 -> underrun" workaround
Thread-Index: AQHVpVXFjNJN/3trlkuN7GQJ9UWrC6egNMCA
Date: Wed, 27 Nov 2019 23:44:49 +0000
Message-ID: <928320811037923cd854ab819123f60e6a97e9b4.camel@intel.com>
References: <20191127190556.1574-1-ville.syrjala@linux.intel.com>
 <20191127190556.1574-6-ville.syrjala@linux.intel.com>
In-Reply-To: <20191127190556.1574-6-ville.syrjala@linux.intel.com>
Accept-Language: en-US
Content-Language: en-US
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-originating-ip: [10.98.40.66]
Content-ID: <94460D5B17103E4E9558F83EF9D55BE7@intel.com>
MIME-Version: 1.0
Subject: Re: [Intel-gfx] [PATCH 5/7] drm/i915: Clean up the gen2 "no planes
 -> underrun" workaround
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

T24gV2VkLCAyMDE5LTExLTI3IGF0IDIxOjA1ICswMjAwLCBWaWxsZSBTeXJqYWxhIHdyb3RlOg0K
PiBGcm9tOiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29tPg0K
PiANCj4gV2UgaGF2ZSB0aGUgYWN0aXZlX3BsYW5lcyBiaXRtYXNrIG5vdyBzbyB1c2UgaXQgdG8g
cHJvcGVybHkNCj4gZGV0ZXJtaW5lIHdoZW4gc29tZSBwbGFuZXMgYXJlIHZpc2libGUgZm9yIHRo
ZSBnZW4yIHVuZGVycnVuDQo+IHdvcmthcm91bmQuDQo+IA0KPiBUaGlzIGxldCdzIHVzIGFsbW9z
dCBlbGltaW5hdGUgaW50ZWxfcG9zdF9lbmFibGVfcHJpbWFyeSgpLg0KPiBUaGUgbWFudWFsIHVu
ZGVycnVuIGNoZWNrcyB3ZSBjYW4gc2ltcGx5IG1vdmUgaW50bw0KPiBpbnRlbF9hdG9taWNfY29t
bWl0X3RhaWwoKSBzaW5jZSB0aGV5IGxvb3Agb3ZlciBhbGwgdGhlIHBpcGVzDQo+IGFscmVhZHku
IE5vIHBvaW50IGluIHJlcGVhdGluZyB0aGUgY2hlY2tzIG11bHRpcGxlIHRpbWVzIHdoZW4NCj4g
dGhlcmUgYXJlIG11bHRpcGxlIHBpcGVzIGluIHRoZSBjb21taXQuDQo+IA0KPiBTaWduZWQtb2Zm
LWJ5OiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29tPg0KPiAt
LS0NCj4gIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIHwgMTU1
ICsrKysrKysrKy0tLS0tLQ0KPiAtLS0tDQo+ICAxIGZpbGUgY2hhbmdlZCwgNzAgaW5zZXJ0aW9u
cygrKSwgODUgZGVsZXRpb25zKC0pDQo+IA0KPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMNCj4gYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXkuYw0KPiBpbmRleCA3MjY1NWI1YjEzNjUuLjUzNjhmM2FiNzBh
ZiAxMDA2NDQNCj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5LmMNCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5
LmMNCj4gQEAgLTU5MDgsMzcgKzU5MDgsNiBAQCBzdGF0aWMgdm9pZA0KPiBpbnRlbF9jcnRjX2Rw
bXNfb3ZlcmxheV9kaXNhYmxlKHN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjKQ0KPiAgCSAq
Lw0KPiAgfQ0KPiAgDQo+IC0vKioNCj4gLSAqIGludGVsX3Bvc3RfZW5hYmxlX3ByaW1hcnkgLSBQ
ZXJmb3JtIG9wZXJhdGlvbnMgYWZ0ZXIgZW5hYmxpbmcNCj4gcHJpbWFyeSBwbGFuZQ0KPiAtICog
QGNydGM6IHRoZSBDUlRDIHdob3NlIHByaW1hcnkgcGxhbmUgd2FzIGp1c3QgZW5hYmxlZA0KPiAt
ICogQG5ld19jcnRjX3N0YXRlOiB0aGUgZW5hYmxpbmcgc3RhdGUNCj4gLSAqDQo+IC0gKiBQZXJm
b3JtcyBwb3RlbnRpYWxseSBzbGVlcGluZyBvcGVyYXRpb25zIHRoYXQgbXVzdCBiZSBkb25lIGFm
dGVyDQo+IHRoZSBwcmltYXJ5DQo+IC0gKiBwbGFuZSBpcyBlbmFibGVkLCBzdWNoIGFzIHVwZGF0
aW5nIEZCQyBhbmQgSVBTLiAgTm90ZSB0aGF0IHRoaXMNCj4gbWF5IGJlDQo+IC0gKiBjYWxsZWQg
ZHVlIHRvIGFuIGV4cGxpY2l0IHByaW1hcnkgcGxhbmUgdXBkYXRlLCBvciBkdWUgdG8gYW4NCj4g
aW1wbGljaXQNCj4gLSAqIHJlLWVuYWJsZSB0aGF0IGlzIGNhdXNlZCB3aGVuIGEgc3ByaXRlIHBs
YW5lIGlzIHVwZGF0ZWQgdG8gbm8NCj4gbG9uZ2VyDQo+IC0gKiBjb21wbGV0ZWx5IGhpZGUgdGhl
IHByaW1hcnkgcGxhbmUuDQo+IC0gKi8NCj4gLXN0YXRpYyB2b2lkDQo+IC1pbnRlbF9wb3N0X2Vu
YWJsZV9wcmltYXJ5KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQ0KPiAtew0KPiAtCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOw0KPiAt
CWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsNCj4gLQ0KPiAtCS8qDQo+IC0JICogR2VuMiBy
ZXBvcnRzIHBpcGUgdW5kZXJydW5zIHdoZW5ldmVyIGFsbCBwbGFuZXMgYXJlDQo+IGRpc2FibGVk
Lg0KPiAtCSAqIFNvIGRvbid0IGVuYWJsZSB1bmRlcnJ1biByZXBvcnRpbmcgYmVmb3JlIGF0IGxl
YXN0IHNvbWUNCj4gcGxhbmVzDQo+IC0JICogYXJlIGVuYWJsZWQuDQo+IC0JICogRklYTUU6IE5l
ZWQgdG8gZml4IHRoZSBsb2dpYyB0byB3b3JrIHdoZW4gd2UgdHVybiBvZmYgYWxsDQo+IHBsYW5l
cw0KPiAtCSAqIGJ1dCBsZWF2ZSB0aGUgcGlwZSBydW5uaW5nLg0KPiAtCSAqLw0KPiAtCWlmIChJ
U19HRU4oZGV2X3ByaXYsIDIpKQ0KPiAtCQlpbnRlbF9zZXRfY3B1X2ZpZm9fdW5kZXJydW5fcmVw
b3J0aW5nKGRldl9wcml2LCBwaXBlLA0KPiB0cnVlKTsNCj4gLQ0KPiAtCS8qIFVuZGVycnVucyBk
b24ndCBhbHdheXMgcmFpc2UgaW50ZXJydXB0cywgc28gY2hlY2sgbWFudWFsbHkuDQo+ICovDQo+
IC0JaW50ZWxfY2hlY2tfY3B1X2ZpZm9fdW5kZXJydW5zKGRldl9wcml2KTsNCj4gLQlpbnRlbF9j
aGVja19wY2hfZmlmb191bmRlcnJ1bnMoZGV2X3ByaXYpOw0KPiAtfQ0KPiAgDQo+ICAvKiBGSVhN
RSBnZXQgcmlkIG9mIHRoaXMgYW5kIHVzZSBwcmVfcGxhbmVfdXBkYXRlICovDQo+ICBzdGF0aWMg
dm9pZA0KPiBAQCAtNjA1OSw2ICs2MDI4LDIwIEBAIHN0YXRpYyBib29sIG5lZWRzX3NjYWxlcmNs
a193YShjb25zdCBzdHJ1Y3QNCj4gaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkNCj4gIAly
ZXR1cm4gZmFsc2U7DQo+ICB9DQo+ICANCj4gK3N0YXRpYyBib29sIHBsYW5lc19lbmFibGluZyhj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZQ0KPiAqb2xkX2NydGNfc3RhdGUsDQo+ICsJCQkg
ICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUNCj4gKm5ld19jcnRjX3N0YXRlKQ0KPiAr
ew0KPiArCXJldHVybiAoIW9sZF9jcnRjX3N0YXRlLT5hY3RpdmVfcGxhbmVzIHx8DQo+IG5lZWRz
X21vZGVzZXQobmV3X2NydGNfc3RhdGUpKSAmJg0KPiArCQluZXdfY3J0Y19zdGF0ZS0+YWN0aXZl
X3BsYW5lczsNCj4gK30NCj4gKw0KPiArc3RhdGljIGJvb2wgcGxhbmVzX2Rpc2FibGluZyhjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZQ0KPiAqb2xkX2NydGNfc3RhdGUsDQo+ICsJCQkgICAg
IGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlDQo+ICpuZXdfY3J0Y19zdGF0ZSkNCj4gK3sN
Cj4gKwlyZXR1cm4gb2xkX2NydGNfc3RhdGUtPmFjdGl2ZV9wbGFuZXMgJiYNCj4gKwkJKCFuZXdf
Y3J0Y19zdGF0ZS0+YWN0aXZlX3BsYW5lcyB8fA0KPiBuZWVkc19tb2Rlc2V0KG5ld19jcnRjX3N0
YXRlKSk7DQo+ICt9DQo+ICsNCj4gIHN0YXRpYyB2b2lkIGludGVsX3Bvc3RfcGxhbmVfdXBkYXRl
KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUNCj4gKnN0YXRlLA0KPiAgCQkJCSAgICBzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YykNCj4gIHsNCj4gQEAgLTYwNjgsMTAgKzYwNTEsOSBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9wb3N0X3BsYW5lX3VwZGF0ZShzdHJ1Y3QNCj4gaW50ZWxfYXRvbWljX3N0YXRl
ICpzdGF0ZSwNCj4gIAkJaW50ZWxfYXRvbWljX2dldF9vbGRfY3J0Y19zdGF0ZShzdGF0ZSwgY3J0
Yyk7DQo+ICAJY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlID0N
Cj4gIAkJaW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0ZSwgY3J0Yyk7DQo+IC0J
Y29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpvbGRfcHJpbWFyeV9zdGF0ZSA9DQo+IC0J
CWludGVsX2F0b21pY19nZXRfb2xkX3BsYW5lX3N0YXRlKHN0YXRlLCBwcmltYXJ5KTsNCj4gIAlj
b25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm5ld19wcmltYXJ5X3N0YXRlID0NCj4gIAkJ
aW50ZWxfYXRvbWljX2dldF9uZXdfcGxhbmVfc3RhdGUoc3RhdGUsIHByaW1hcnkpOw0KPiArCWVu
dW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsNCj4gIA0KPiAgCWludGVsX2Zyb250YnVmZmVyX2Zs
aXAoZGV2X3ByaXYsIG5ld19jcnRjX3N0YXRlLT5mYl9iaXRzKTsNCj4gIA0KPiBAQCAtNjA4MSwy
MiArNjA2MywxNiBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wb3N0X3BsYW5lX3VwZGF0ZShzdHJ1Y3QN
Cj4gaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwNCj4gIAlpZiAoaHN3X3Bvc3RfdXBkYXRlX2Vu
YWJsZV9pcHMob2xkX2NydGNfc3RhdGUsIG5ld19jcnRjX3N0YXRlKSkNCj4gIAkJaHN3X2VuYWJs
ZV9pcHMobmV3X2NydGNfc3RhdGUpOw0KPiAgDQo+IC0JaWYgKG5ld19wcmltYXJ5X3N0YXRlKSB7
DQo+ICsJaWYgKG5ld19wcmltYXJ5X3N0YXRlKQ0KPiAgCQlpbnRlbF9mYmNfcG9zdF91cGRhdGUo
Y3J0Yyk7DQo+ICANCj4gLQkJaWYgKG5ld19wcmltYXJ5X3N0YXRlLT51YXBpLnZpc2libGUgJiYN
Cj4gLQkJICAgIChuZWVkc19tb2Rlc2V0KG5ld19jcnRjX3N0YXRlKSB8fA0KPiAtCQkgICAgICFv
bGRfcHJpbWFyeV9zdGF0ZS0+dWFwaS52aXNpYmxlKSkNCj4gLQkJCWludGVsX3Bvc3RfZW5hYmxl
X3ByaW1hcnkoY3J0Yyk7DQo+IC0JfQ0KPiAtDQo+ICAJaWYgKG5lZWRzX252MTJfd2Eob2xkX2Ny
dGNfc3RhdGUpICYmDQo+ICAJICAgICFuZWVkc19udjEyX3dhKG5ld19jcnRjX3N0YXRlKSkNCj4g
LQkJc2tsX3dhXzgyNyhkZXZfcHJpdiwgY3J0Yy0+cGlwZSwgZmFsc2UpOw0KPiArCQlza2xfd2Ff
ODI3KGRldl9wcml2LCBwaXBlLCBmYWxzZSk7DQoNCk5pdHBpY2s6IGNvdWxkIGJlIGxlZnQgYXMg
aXQgd2FzKHMvY3J0Yy0+cGlwZS9waXBlKQ0KDQo+ICANCj4gIAlpZiAobmVlZHNfc2NhbGVyY2xr
X3dhKG9sZF9jcnRjX3N0YXRlKSAmJg0KPiAgCSAgICAhbmVlZHNfc2NhbGVyY2xrX3dhKG5ld19j
cnRjX3N0YXRlKSkNCj4gLQkJaWNsX3dhX3NjYWxlcmNsa2dhdGluZyhkZXZfcHJpdiwgY3J0Yy0+
cGlwZSwgZmFsc2UpOw0KPiArCQlpY2xfd2Ffc2NhbGVyY2xrZ2F0aW5nKGRldl9wcml2LCBwaXBl
LCBmYWxzZSk7DQo+ICB9DQo+ICANCj4gIHN0YXRpYyB2b2lkIGludGVsX3ByZV9wbGFuZV91cGRh
dGUoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsDQo+IEBAIC02MTA4LDM1ICs2MDg0
LDI1IEBAIHN0YXRpYyB2b2lkIGludGVsX3ByZV9wbGFuZV91cGRhdGUoc3RydWN0DQo+IGludGVs
X2F0b21pY19zdGF0ZSAqc3RhdGUsDQo+ICAJCWludGVsX2F0b21pY19nZXRfb2xkX2NydGNfc3Rh
dGUoc3RhdGUsIGNydGMpOw0KPiAgCWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdf
Y3J0Y19zdGF0ZSA9DQo+ICAJCWludGVsX2F0b21pY19nZXRfbmV3X2NydGNfc3RhdGUoc3RhdGUs
IGNydGMpOw0KPiAtCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqb2xkX3ByaW1hcnlf
c3RhdGUgPQ0KPiAtCQlpbnRlbF9hdG9taWNfZ2V0X29sZF9wbGFuZV9zdGF0ZShzdGF0ZSwgcHJp
bWFyeSk7DQo+ICAJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpuZXdfcHJpbWFyeV9z
dGF0ZSA9DQo+ICAJCWludGVsX2F0b21pY19nZXRfbmV3X3BsYW5lX3N0YXRlKHN0YXRlLCBwcmlt
YXJ5KTsNCj4gLQlib29sIG1vZGVzZXQgPSBuZWVkc19tb2Rlc2V0KG5ld19jcnRjX3N0YXRlKTsN
Cj4gKwllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7DQo+ICANCj4gIAlpZiAoaHN3X3ByZV91
cGRhdGVfZGlzYWJsZV9pcHMob2xkX2NydGNfc3RhdGUsIG5ld19jcnRjX3N0YXRlKSkNCj4gIAkJ
aHN3X2Rpc2FibGVfaXBzKG9sZF9jcnRjX3N0YXRlKTsNCj4gIA0KPiAtCWlmIChuZXdfcHJpbWFy
eV9zdGF0ZSkgew0KPiArCWlmIChuZXdfcHJpbWFyeV9zdGF0ZSkNCj4gIAkJaW50ZWxfZmJjX3By
ZV91cGRhdGUoY3J0YywgbmV3X2NydGNfc3RhdGUsDQo+IG5ld19wcmltYXJ5X3N0YXRlKTsNCj4g
LQkJLyoNCj4gLQkJICogR2VuMiByZXBvcnRzIHBpcGUgdW5kZXJydW5zIHdoZW5ldmVyIGFsbCBw
bGFuZXMgYXJlDQo+IGRpc2FibGVkLg0KPiAtCQkgKiBTbyBkaXNhYmxlIHVuZGVycnVuIHJlcG9y
dGluZyBiZWZvcmUgYWxsIHRoZSBwbGFuZXMNCj4gZ2V0IGRpc2FibGVkLg0KPiAtCQkgKi8NCj4g
LQkJaWYgKElTX0dFTihkZXZfcHJpdiwgMikgJiYgb2xkX3ByaW1hcnlfc3RhdGUtDQo+ID51YXBp
LnZpc2libGUgJiYNCj4gLQkJICAgIChtb2Rlc2V0IHx8ICFuZXdfcHJpbWFyeV9zdGF0ZS0+dWFw
aS52aXNpYmxlKSkNCj4gLQkJCWludGVsX3NldF9jcHVfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmco
ZGV2X3ByaXYsDQo+IGNydGMtPnBpcGUsIGZhbHNlKTsNCj4gLQl9DQo+ICANCj4gIAkvKiBEaXNw
bGF5IFdBIDgyNyAqLw0KPiAgCWlmICghbmVlZHNfbnYxMl93YShvbGRfY3J0Y19zdGF0ZSkgJiYN
Cj4gIAkgICAgbmVlZHNfbnYxMl93YShuZXdfY3J0Y19zdGF0ZSkpDQo+IC0JCXNrbF93YV84Mjco
ZGV2X3ByaXYsIGNydGMtPnBpcGUsIHRydWUpOw0KPiArCQlza2xfd2FfODI3KGRldl9wcml2LCBw
aXBlLCB0cnVlKTsNCj4gIA0KPiAgCS8qIFdhXzIwMDY2MDQzMTI6aWNsICovDQo+ICAJaWYgKCFu
ZWVkc19zY2FsZXJjbGtfd2Eob2xkX2NydGNfc3RhdGUpICYmDQo+ICAJICAgIG5lZWRzX3NjYWxl
cmNsa193YShuZXdfY3J0Y19zdGF0ZSkpDQo+IC0JCWljbF93YV9zY2FsZXJjbGtnYXRpbmcoZGV2
X3ByaXYsIGNydGMtPnBpcGUsIHRydWUpOw0KPiArCQlpY2xfd2Ffc2NhbGVyY2xrZ2F0aW5nKGRl
dl9wcml2LCBwaXBlLCB0cnVlKTsNCj4gIA0KPiAgCS8qDQo+ICAJICogVmJsYW5rIHRpbWUgdXBk
YXRlcyBmcm9tIHRoZSBzaGFkb3cgdG8gbGl2ZSBwbGFuZSBjb250cm9sDQo+IHJlZ2lzdGVyDQo+
IEBAIC02MTQ5LDcgKzYxMTUsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wcmVfcGxhbmVfdXBkYXRl
KHN0cnVjdA0KPiBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLA0KPiAgCSAqLw0KPiAgCWlmIChI
QVNfR01DSChkZXZfcHJpdikgJiYgb2xkX2NydGNfc3RhdGUtPmh3LmFjdGl2ZSAmJg0KPiAgCSAg
ICBuZXdfY3J0Y19zdGF0ZS0+ZGlzYWJsZV9jeHNyICYmDQo+IGludGVsX3NldF9tZW1vcnlfY3hz
cihkZXZfcHJpdiwgZmFsc2UpKQ0KPiAtCQlpbnRlbF93YWl0X2Zvcl92YmxhbmsoZGV2X3ByaXYs
IGNydGMtPnBpcGUpOw0KPiArCQlpbnRlbF93YWl0X2Zvcl92YmxhbmsoZGV2X3ByaXYsIHBpcGUp
Ow0KPiAgDQo+ICAJLyoNCj4gIAkgKiBJVkIgd29ya2Fyb3VuZDogbXVzdCBkaXNhYmxlIGxvdyBw
b3dlciB3YXRlcm1hcmtzIGZvciBhdA0KPiBsZWFzdA0KPiBAQCAtNjE2MCwzMyArNjEyNiw0MyBA
QCBzdGF0aWMgdm9pZCBpbnRlbF9wcmVfcGxhbmVfdXBkYXRlKHN0cnVjdA0KPiBpbnRlbF9hdG9t
aWNfc3RhdGUgKnN0YXRlLA0KPiAgCSAqLw0KPiAgCWlmIChvbGRfY3J0Y19zdGF0ZS0+aHcuYWN0
aXZlICYmDQo+ICAJICAgIG5ld19jcnRjX3N0YXRlLT5kaXNhYmxlX2xwX3dtICYmDQo+IGlsa19k
aXNhYmxlX2xwX3dtKGRldl9wcml2KSkNCj4gLQkJaW50ZWxfd2FpdF9mb3JfdmJsYW5rKGRldl9w
cml2LCBjcnRjLT5waXBlKTsNCj4gKwkJaW50ZWxfd2FpdF9mb3JfdmJsYW5rKGRldl9wcml2LCBw
aXBlKTsNCj4gIA0KPiAgCS8qDQo+IC0JICogSWYgd2UncmUgZG9pbmcgYSBtb2Rlc2V0LCB3ZSdy
ZSBkb25lLiAgTm8gbmVlZCB0byBkbyBhbnkNCj4gcHJlLXZibGFuaw0KPiAtCSAqIHdhdGVybWFy
ayBwcm9ncmFtbWluZyBoZXJlLg0KPiArCSAqIElmIHdlJ3JlIGRvaW5nIGEgbW9kZXNldCB3ZSBk
b24ndCBuZWVkIHRvIGRvIGFueQ0KPiArCSAqIHByZS12Ymxhbmsgd2F0ZXJtYXJrIHByb2dyYW1t
aW5nIGhlcmUuDQo+ICAJICovDQo+IC0JaWYgKG5lZWRzX21vZGVzZXQobmV3X2NydGNfc3RhdGUp
KQ0KPiAtCQlyZXR1cm47DQo+ICsJaWYgKCFuZWVkc19tb2Rlc2V0KG5ld19jcnRjX3N0YXRlKSkg
ew0KPiArCQkvKg0KPiArCQkgKiBGb3IgcGxhdGZvcm1zIHRoYXQgc3VwcG9ydCBhdG9taWMgd2F0
ZXJtYXJrcywNCj4gcHJvZ3JhbSB0aGUNCj4gKwkJICogJ2ludGVybWVkaWF0ZScgd2F0ZXJtYXJr
cyBpbW1lZGlhdGVseS4gIE9uIHByZS1nZW45DQo+IHBsYXRmb3JtcywgdGhlc2UNCj4gKwkJICog
d2lsbCBiZSB0aGUgaW50ZXJtZWRpYXRlIHZhbHVlcyB0aGF0IGFyZSBzYWZlIGZvcg0KPiBib3Ro
IHByZS0gYW5kDQo+ICsJCSAqIHBvc3QtIHZibGFuazsgd2hlbiB2YmxhbmsgaGFwcGVucywgdGhl
ICdhY3RpdmUnDQo+IHZhbHVlcyB3aWxsIGJlIHNldA0KPiArCQkgKiB0byB0aGUgZmluYWwgJ3Rh
cmdldCcgdmFsdWVzIGFuZCB3ZSdsbCBkbyB0aGlzIGFnYWluDQo+IHRvIGdldCB0aGUNCj4gKwkJ
ICogb3B0aW1hbCB3YXRlcm1hcmtzLiAgRm9yIGdlbjkrIHBsYXRmb3JtcywgdGhlIHZhbHVlcw0K
PiB3ZSBwcm9ncmFtIGhlcmUNCj4gKwkJICogd2lsbCBiZSB0aGUgZmluYWwgdGFyZ2V0IHZhbHVl
cyB3aGljaCB3aWxsIGdldA0KPiBhdXRvbWF0aWNhbGx5IGxhdGNoZWQNCj4gKwkJICogYXQgdmJs
YW5rIHRpbWU7IG5vIGZ1cnRoZXIgcHJvZ3JhbW1pbmcgd2lsbCBiZQ0KPiBuZWNlc3NhcnkuDQo+
ICsJCSAqDQo+ICsJCSAqIElmIGEgcGxhdGZvcm0gaGFzbid0IGJlZW4gdHJhbnNpdGlvbmVkIHRv
IGF0b21pYw0KPiB3YXRlcm1hcmtzIHlldCwNCj4gKwkJICogd2UnbGwgY29udGludWUgdG8gdXBk
YXRlIHdhdGVybWFya3MgdGhlIG9sZCB3YXksIGlmDQo+IGZsYWdzIHRlbGwNCj4gKwkJICogdXMg
dG8uDQo+ICsJCSAqLw0KDQpBIGZldyBsaW5lcyBhcmUgbm93IG92ZXIgODAgY2hhcmFjdGVycyBi
dXQgSSBrbm93IHlvdSBkaWQgbm90IHdhbnRlZCB0bw0KY2hhbmdlIGl0Lg0KDQoNClJldmlld2Vk
LWJ5OiBKb3PDqSBSb2JlcnRvIGRlIFNvdXphIDxqb3NlLnNvdXphQGludGVsLmNvbT4NCg0KPiAr
CQlpZiAoZGV2X3ByaXYtPmRpc3BsYXkuaW5pdGlhbF93YXRlcm1hcmtzKQ0KPiArCQkJZGV2X3By
aXYtPmRpc3BsYXkuaW5pdGlhbF93YXRlcm1hcmtzKHN0YXRlLA0KPiBjcnRjKTsNCj4gKwkJZWxz
ZSBpZiAobmV3X2NydGNfc3RhdGUtPnVwZGF0ZV93bV9wcmUpDQo+ICsJCQlpbnRlbF91cGRhdGVf
d2F0ZXJtYXJrcyhjcnRjKTsNCj4gKwl9DQo+ICANCj4gIAkvKg0KPiAtCSAqIEZvciBwbGF0Zm9y
bXMgdGhhdCBzdXBwb3J0IGF0b21pYyB3YXRlcm1hcmtzLCBwcm9ncmFtIHRoZQ0KPiAtCSAqICdp
bnRlcm1lZGlhdGUnIHdhdGVybWFya3MgaW1tZWRpYXRlbHkuICBPbiBwcmUtZ2VuOQ0KPiBwbGF0
Zm9ybXMsIHRoZXNlDQo+IC0JICogd2lsbCBiZSB0aGUgaW50ZXJtZWRpYXRlIHZhbHVlcyB0aGF0
IGFyZSBzYWZlIGZvciBib3RoIHByZS0NCj4gYW5kDQo+IC0JICogcG9zdC0gdmJsYW5rOyB3aGVu
IHZibGFuayBoYXBwZW5zLCB0aGUgJ2FjdGl2ZScgdmFsdWVzIHdpbGwNCj4gYmUgc2V0DQo+IC0J
ICogdG8gdGhlIGZpbmFsICd0YXJnZXQnIHZhbHVlcyBhbmQgd2UnbGwgZG8gdGhpcyBhZ2FpbiB0
byBnZXQNCj4gdGhlDQo+IC0JICogb3B0aW1hbCB3YXRlcm1hcmtzLiAgRm9yIGdlbjkrIHBsYXRm
b3JtcywgdGhlIHZhbHVlcyB3ZQ0KPiBwcm9ncmFtIGhlcmUNCj4gLQkgKiB3aWxsIGJlIHRoZSBm
aW5hbCB0YXJnZXQgdmFsdWVzIHdoaWNoIHdpbGwgZ2V0IGF1dG9tYXRpY2FsbHkNCj4gbGF0Y2hl
ZA0KPiAtCSAqIGF0IHZibGFuayB0aW1lOyBubyBmdXJ0aGVyIHByb2dyYW1taW5nIHdpbGwgYmUg
bmVjZXNzYXJ5Lg0KPiArCSAqIEdlbjIgcmVwb3J0cyBwaXBlIHVuZGVycnVucyB3aGVuZXZlciBh
bGwgcGxhbmVzIGFyZQ0KPiBkaXNhYmxlZC4NCj4gKwkgKiBTbyBkaXNhYmxlIHVuZGVycnVuIHJl
cG9ydGluZyBiZWZvcmUgYWxsIHRoZSBwbGFuZXMgZ2V0DQo+IGRpc2FibGVkLg0KPiAgCSAqDQo+
IC0JICogSWYgYSBwbGF0Zm9ybSBoYXNuJ3QgYmVlbiB0cmFuc2l0aW9uZWQgdG8gYXRvbWljIHdh
dGVybWFya3MNCj4geWV0LA0KPiAtCSAqIHdlJ2xsIGNvbnRpbnVlIHRvIHVwZGF0ZSB3YXRlcm1h
cmtzIHRoZSBvbGQgd2F5LCBpZiBmbGFncw0KPiB0ZWxsDQo+IC0JICogdXMgdG8uDQo+ICsJICog
V2UgZG8gdGhpcyBhZnRlciAuaW5pdGlhbF93YXRlcm1hcmtzKCkgc28gdGhhdCB3ZSBoYXZlIGEN
Cj4gKwkgKiBjaGFuY2Ugb2YgY2F0Y2hpbmcgdW5kZXJydW5zIHdpdGggdGhlIGludGVybWVkaWF0
ZQ0KPiB3YXRlcm1hcmtzDQo+ICsJICogdnMuIHRoZSBvbGQgcGxhbmUgY29uZmlndXJhdGlvbi4N
Cj4gIAkgKi8NCj4gLQlpZiAoZGV2X3ByaXYtPmRpc3BsYXkuaW5pdGlhbF93YXRlcm1hcmtzKQ0K
PiAtCQlkZXZfcHJpdi0+ZGlzcGxheS5pbml0aWFsX3dhdGVybWFya3Moc3RhdGUsIGNydGMpOw0K
PiAtCWVsc2UgaWYgKG5ld19jcnRjX3N0YXRlLT51cGRhdGVfd21fcHJlKQ0KPiAtCQlpbnRlbF91
cGRhdGVfd2F0ZXJtYXJrcyhjcnRjKTsNCj4gKwlpZiAoSVNfR0VOKGRldl9wcml2LCAyKSAmJiBw
bGFuZXNfZGlzYWJsaW5nKG9sZF9jcnRjX3N0YXRlLA0KPiBuZXdfY3J0Y19zdGF0ZSkpDQo+ICsJ
CWludGVsX3NldF9jcHVfZmlmb191bmRlcnJ1bl9yZXBvcnRpbmcoZGV2X3ByaXYsIHBpcGUsDQo+
IGZhbHNlKTsNCj4gIH0NCj4gIA0KPiAgc3RhdGljIHZvaWQgaW50ZWxfY3J0Y19kaXNhYmxlX3Bs
YW5lcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlDQo+ICpzdGF0ZSwNCj4gQEAgLTE0NDIzLDEz
ICsxNDM5OSw2IEBAIHN0YXRpYyB2b2lkDQo+IGludGVsX29sZF9jcnRjX3N0YXRlX2Rpc2FibGVz
KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLA0KPiAgCWludGVsX2ZiY19kaXNhYmxl
KGNydGMpOw0KPiAgCWludGVsX2Rpc2FibGVfc2hhcmVkX2RwbGwob2xkX2NydGNfc3RhdGUpOw0K
PiAgDQo+IC0JLyoNCj4gLQkgKiBVbmRlcnJ1bnMgZG9uJ3QgYWx3YXlzIHJhaXNlIGludGVycnVw
dHMsDQo+IC0JICogc28gY2hlY2sgbWFudWFsbHkuDQo+IC0JICovDQo+IC0JaW50ZWxfY2hlY2tf
Y3B1X2ZpZm9fdW5kZXJydW5zKGRldl9wcml2KTsNCj4gLQlpbnRlbF9jaGVja19wY2hfZmlmb191
bmRlcnJ1bnMoZGV2X3ByaXYpOw0KPiAtDQo+ICAJLyogRklYTUUgdW5pZnkgdGhpcyBmb3IgYWxs
IHBsYXRmb3JtcyAqLw0KPiAgCWlmICghbmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2ZSAmJg0KPiAg
CSAgICAhSEFTX0dNQ0goZGV2X3ByaXYpICYmDQo+IEBAIC0xNDg4Miw3ICsxNDg1MSwxOSBAQCBz
dGF0aWMgdm9pZCBpbnRlbF9hdG9taWNfY29tbWl0X3RhaWwoc3RydWN0DQo+IGludGVsX2F0b21p
Y19zdGF0ZSAqc3RhdGUpDQo+ICAJICoNCj4gIAkgKiBUT0RPOiBNb3ZlIHRoaXMgKGFuZCBvdGhl
ciBjbGVhbnVwKSB0byBhbiBhc3luYyB3b3JrZXINCj4gZXZlbnR1YWxseS4NCj4gIAkgKi8NCj4g
LQlmb3JfZWFjaF9uZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0YywgbmV3X2NydGNf
c3RhdGUsDQo+IGkpIHsNCj4gKwlmb3JfZWFjaF9vbGRuZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShz
dGF0ZSwgY3J0YywNCj4gb2xkX2NydGNfc3RhdGUsDQo+ICsJCQkJCSAgICBuZXdfY3J0Y19zdGF0
ZSwgaSkgew0KPiArCQkvKg0KPiArCQkgKiBHZW4yIHJlcG9ydHMgcGlwZSB1bmRlcnJ1bnMgd2hl
bmV2ZXIgYWxsIHBsYW5lcyBhcmUNCj4gZGlzYWJsZWQuDQo+ICsJCSAqIFNvIHJlLWVuYWJsZSB1
bmRlcnJ1biByZXBvcnRpbmcgYWZ0ZXIgc29tZSBwbGFuZXMNCj4gZ2V0IGVuYWJsZWQuDQo+ICsJ
CSAqDQo+ICsJCSAqIFdlIGRvIHRoaXMgYmVmb3JlIC5vcHRpbWl6ZV93YXRlcm1hcmtzKCkgc28g
dGhhdCB3ZQ0KPiBoYXZlIGENCj4gKwkJICogY2hhbmNlIG9mIGNhdGNoaW5nIHVuZGVycnVucyB3
aXRoIHRoZSBpbnRlcm1lZGlhdGUNCj4gd2F0ZXJtYXJrcw0KPiArCQkgKiB2cy4gdGhlIG5ldyBw
bGFuZSBjb25maWd1cmF0aW9uLg0KPiArCQkgKi8NCj4gKwkJaWYgKElTX0dFTihkZXZfcHJpdiwg
MikgJiYNCj4gcGxhbmVzX2VuYWJsaW5nKG9sZF9jcnRjX3N0YXRlLCBuZXdfY3J0Y19zdGF0ZSkp
DQo+ICsJCQlpbnRlbF9zZXRfY3B1X2ZpZm9fdW5kZXJydW5fcmVwb3J0aW5nKGRldl9wcml2LA0K
PiBjcnRjLT5waXBlLCB0cnVlKTsNCj4gKw0KPiAgCQlpZiAoZGV2X3ByaXYtPmRpc3BsYXkub3B0
aW1pemVfd2F0ZXJtYXJrcykNCj4gIAkJCWRldl9wcml2LT5kaXNwbGF5Lm9wdGltaXplX3dhdGVy
bWFya3Moc3RhdGUsDQo+IGNydGMpOw0KPiAgCX0NCj4gQEAgLTE0ODk2LDYgKzE0ODc3LDEwIEBA
IHN0YXRpYyB2b2lkIGludGVsX2F0b21pY19jb21taXRfdGFpbChzdHJ1Y3QNCj4gaW50ZWxfYXRv
bWljX3N0YXRlICpzdGF0ZSkNCj4gIAkJaW50ZWxfbW9kZXNldF92ZXJpZnlfY3J0YyhjcnRjLCBz
dGF0ZSwgb2xkX2NydGNfc3RhdGUsDQo+IG5ld19jcnRjX3N0YXRlKTsNCj4gIAl9DQo+ICANCj4g
KwkvKiBVbmRlcnJ1bnMgZG9uJ3QgYWx3YXlzIHJhaXNlIGludGVycnVwdHMsIHNvIGNoZWNrIG1h
bnVhbGx5DQo+ICovDQo+ICsJaW50ZWxfY2hlY2tfY3B1X2ZpZm9fdW5kZXJydW5zKGRldl9wcml2
KTsNCj4gKwlpbnRlbF9jaGVja19wY2hfZmlmb191bmRlcnJ1bnMoZGV2X3ByaXYpOw0KPiArDQo+
ICAJaWYgKHN0YXRlLT5tb2Rlc2V0KQ0KPiAgCQlpbnRlbF92ZXJpZnlfcGxhbmVzKHN0YXRlKTsN
Cj4gIA0KX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50
ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E15C7FCA87
	for <lists+intel-gfx@lfdr.de>; Thu, 14 Nov 2019 17:05:36 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 1C6246EBEC;
	Thu, 14 Nov 2019 16:05:33 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4F0DD6EBED
 for <intel-gfx@lists.freedesktop.org>; Thu, 14 Nov 2019 16:05:27 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 14 Nov 2019 17:05:21 +0100
Message-Id: <20191114160522.9699-10-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191114160522.9699-1-maarten.lankhorst@linux.intel.com>
References: <20191114160522.9699-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 10/11] drm/i915: Add intel_update_bigjoiner
 handling.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RW5hYmxpbmcgaXMgZG9uZSBpbiBhIHNwZWNpYWwgc2VxdWVuY2UgYW5kIHNvIHNob3VsZCBwbGFu
ZSB1cGRhdGVzCmJlLiBJZGVhbGx5IHRoZSBlbmQgdXNlciBuZXZlciBub3RpY2VzIHRoZSBzZWNv
bmQgcGlwZSBpcyB1c2VkLApzbyB1c2UgdGhlIHZibGFuayBldmFzaW9uIHRvIGNvdmVyIGJvdGgg
cGlwZXMuCgpUaGlzIHdheSBpZGVhbGx5IGV2ZXJ5dGhpbmcgd2lsbCBiZSB0ZWFyIGZyZWUsIGFu
ZCB1cGRhdGVzIGFyZQpyZWFsbHkgYXRvbWljIGFzIHVzZXJzcGFjZSBleHBlY3RzIGl0LgoKU2ln
bmVkLW9mZi1ieTogTWFhcnRlbiBMYW5raG9yc3QgPG1hYXJ0ZW4ubGFua2hvcnN0QGxpbnV4Lmlu
dGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXku
YyB8IDExMyArKysrKysrKysrKysrKysrLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX3Nwcml0ZS5jICB8ICAyMiArKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX3Nwcml0ZS5oICB8ICAgMyArLQogMyBmaWxlcyBjaGFuZ2VkLCAxMTkgaW5zZXJ0aW9u
cygrKSwgMTkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2Rpc3BsYXkuYwppbmRleCA0YzRlNTFlNDA5ZjYuLmYzZmM4OWU1MmIxYiAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTE0ODI2LDcgKzE0
ODI2LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfdXBkYXRlX2NydGMoc3RydWN0IGludGVsX2NydGMg
KmNydGMsCiAJZWxzZQogCQlpOXh4X3VwZGF0ZV9wbGFuZXNfb25fY3J0YyhzdGF0ZSwgY3J0Yyk7
CiAKLQlpbnRlbF9waXBlX3VwZGF0ZV9lbmQobmV3X2NydGNfc3RhdGUpOworCWludGVsX3BpcGVf
dXBkYXRlX2VuZChuZXdfY3J0Y19zdGF0ZSwgTlVMTCk7CiAKIAkvKgogCSAqIFdlIHVzdWFsbHkg
ZW5hYmxlIEZJRk8gdW5kZXJydW4gaW50ZXJydXB0cyBhcyBwYXJ0IG9mIHRoZQpAQCAtMTQ5NzMs
NiArMTQ5NzMsNTQgQEAgc3RhdGljIHZvaWQgaW50ZWxfY29tbWl0X21vZGVzZXRfZGlzYWJsZXMo
c3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJfQogfQogCitzdGF0aWMgdm9pZCBp
bnRlbF91cGRhdGVfYmlnam9pbmVyKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAorCQkJCSAgIHN0
cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAorCQkJCSAgIHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwKKwkJCQkgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
bmV3X2NydGNfc3RhdGUpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShzdGF0ZS0+YmFzZS5kZXYpOworCWJvb2wgbW9kZXNldCA9IG5lZWRzX21vZGVzZXQo
bmV3X2NydGNfc3RhdGUpOworCXN0cnVjdCBpbnRlbF9jcnRjICpzbGF2ZSA9IG5ld19jcnRjX3N0
YXRlLT5iaWdqb2luZXJfbGlua2VkX2NydGM7CisJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5l
d19zbGF2ZV9jcnRjX3N0YXRlID0KKwkJaW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShz
dGF0ZSwgc2xhdmUpOworCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfc2xhdmVfY3J0Y19z
dGF0ZSA9CisJCWludGVsX2F0b21pY19nZXRfb2xkX2NydGNfc3RhdGUoc3RhdGUsIHNsYXZlKTsK
KworCWlmIChtb2Rlc2V0KSB7CisJCS8qIEVuYWJsZSBzbGF2ZSBmaXJzdCAqLworCQlpbnRlbF9j
cnRjX3VwZGF0ZV9hY3RpdmVfdGltaW5ncyhuZXdfc2xhdmVfY3J0Y19zdGF0ZSk7CisJCWRldl9w
cml2LT5kaXNwbGF5LmNydGNfZW5hYmxlKG5ld19zbGF2ZV9jcnRjX3N0YXRlLCBzdGF0ZSk7CisK
KwkJLyogVGhlbiBtYXN0ZXIgKi8KKwkJaW50ZWxfY3J0Y191cGRhdGVfYWN0aXZlX3RpbWluZ3Mo
bmV3X2NydGNfc3RhdGUpOworCQlkZXZfcHJpdi0+ZGlzcGxheS5jcnRjX2VuYWJsZShuZXdfY3J0
Y19zdGF0ZSwgc3RhdGUpOworCisJCS8qIHZibGFua3Mgd29yayBhZ2FpbiwgcmUtZW5hYmxlIHBp
cGUgQ1JDLiAqLworCQlpbnRlbF9jcnRjX2VuYWJsZV9waXBlX2NyYyhjcnRjKTsKKworCX0gZWxz
ZSB7CisJCWludGVsX3ByZV9wbGFuZV91cGRhdGUob2xkX2NydGNfc3RhdGUsIG5ld19jcnRjX3N0
YXRlKTsKKwkJaW50ZWxfcHJlX3BsYW5lX3VwZGF0ZShvbGRfc2xhdmVfY3J0Y19zdGF0ZSwgbmV3
X3NsYXZlX2NydGNfc3RhdGUpOworCisJCWlmIChuZXdfY3J0Y19zdGF0ZS0+dXBkYXRlX3BpcGUp
CisJCQlpbnRlbF9lbmNvZGVyc191cGRhdGVfcGlwZShjcnRjLCBuZXdfY3J0Y19zdGF0ZSwgc3Rh
dGUpOworCX0KKworCS8qCisJICogUGVyZm9ybSB2YmxhbmsgZXZhc2lvbiBhcm91bmQgY29tbWl0
IG9wZXJhdGlvbiwgYW5kIG1ha2Ugc3VyZSB0bworCSAqIGNvbW1pdCBib3RoIHBsYW5lcyBzaW11
bHRhbmVvdXNseSBmb3IgYmVzdCByZXN1bHRzLgorCSAqLworCWludGVsX3BpcGVfdXBkYXRlX3N0
YXJ0KG5ld19jcnRjX3N0YXRlKTsKKworCWNvbW1pdF9waXBlX2NvbmZpZyhzdGF0ZSwgb2xkX2Ny
dGNfc3RhdGUsIG5ld19jcnRjX3N0YXRlKTsKKwljb21taXRfcGlwZV9jb25maWcoc3RhdGUsIG9s
ZF9zbGF2ZV9jcnRjX3N0YXRlLCBuZXdfc2xhdmVfY3J0Y19zdGF0ZSk7CisKKwlza2xfdXBkYXRl
X3BsYW5lc19vbl9jcnRjKHN0YXRlLCBjcnRjKTsKKwlza2xfdXBkYXRlX3BsYW5lc19vbl9jcnRj
KHN0YXRlLCBzbGF2ZSk7CisKKwlpbnRlbF9waXBlX3VwZGF0ZV9lbmQobmV3X2NydGNfc3RhdGUs
IG5ld19zbGF2ZV9jcnRjX3N0YXRlKTsKK30KKwogc3RhdGljIHZvaWQgaW50ZWxfY29tbWl0X21v
ZGVzZXRfZW5hYmxlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIHsKIAlzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YzsKQEAgLTE1MDM2LDcgKzE1MDg0LDcgQEAgc3RhdGljIHZvaWQg
aW50ZWxfcG9zdF9jcnRjX2VuYWJsZV91cGRhdGVzKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAog
CWludGVsX3BpcGVfdXBkYXRlX3N0YXJ0KG5ld19jcnRjX3N0YXRlKTsKIAljb21taXRfcGlwZV9j
b25maWcoc3RhdGUsIG9sZF9jcnRjX3N0YXRlLCBuZXdfY3J0Y19zdGF0ZSk7CiAJc2tsX3VwZGF0
ZV9wbGFuZXNfb25fY3J0YyhzdGF0ZSwgY3J0Yyk7Ci0JaW50ZWxfcGlwZV91cGRhdGVfZW5kKG5l
d19jcnRjX3N0YXRlKTsKKwlpbnRlbF9waXBlX3VwZGF0ZV9lbmQobmV3X2NydGNfc3RhdGUsIE5V
TEwpOwogCiAJLyoKIAkgKiBXZSB1c3VhbGx5IGVuYWJsZSBGSUZPIHVuZGVycnVuIGludGVycnVw
dHMgYXMgcGFydCBvZiB0aGUKQEAgLTE1MDk4LDcgKzE1MTQ2LDcgQEAgc3RhdGljIHZvaWQgaW50
ZWxfdXBkYXRlX3RyYW5zX3BvcnRfc3luY19jcnRjcyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywK
IHN0YXRpYyB2b2lkIHNrbF9jb21taXRfbW9kZXNldF9lbmFibGVzKHN0cnVjdCBpbnRlbF9hdG9t
aWNfc3RhdGUgKnN0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IHRvX2k5MTUoc3RhdGUtPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKKwlz
dHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywgKnNsYXZlOwogCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpvbGRfY3J0Y19zdGF0ZSwgKm5ld19jcnRjX3N0YXRlOwogCXVuc2lnbmVkIGludCB1cGRhdGVk
ID0gMDsKIAlib29sIHByb2dyZXNzOwpAQCAtMTUxMDYsMTEgKzE1MTU0LDQ3IEBAIHN0YXRpYyB2
b2lkIHNrbF9jb21taXRfbW9kZXNldF9lbmFibGVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUg
KnN0YXRlKQogCXU4IGh3X2VuYWJsZWRfc2xpY2VzID0gZGV2X3ByaXYtPndtLnNrbF9ody5kZGIu
ZW5hYmxlZF9zbGljZXM7CiAJdTggcmVxdWlyZWRfc2xpY2VzID0gc3RhdGUtPndtX3Jlc3VsdHMu
ZGRiLmVuYWJsZWRfc2xpY2VzOwogCXN0cnVjdCBza2xfZGRiX2VudHJ5IGVudHJpZXNbSTkxNV9N
QVhfUElQRVNdID0ge307CisJc3RydWN0IHNrbF9kZGJfZW50cnkgbmV3X2VudHJpZXNbSTkxNV9N
QVhfUElQRVNdID0ge307CisJY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnNsYXZlX2Ny
dGNfc3RhdGU7CisJdTMyIGRpcnR5X3BpcGVzID0gc3RhdGUtPndtX3Jlc3VsdHMuZGlydHlfcGlw
ZXM7CisKKwlmb3JfZWFjaF9vbGRuZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0Yywg
b2xkX2NydGNfc3RhdGUsIG5ld19jcnRjX3N0YXRlLCBpKSB7CisJCWlmIChuZXdfY3J0Y19zdGF0
ZS0+Ymlnam9pbmVyX3NsYXZlKSB7CisJCQkvKiBjbGVhciBkaXJ0eSBiaXQsIHdlJ3JlIHVwZGF0
ZWQgaW4gbWFzdGVyICovCisJCQlkaXJ0eV9waXBlcyAmPSB+ZHJtX2NydGNfbWFzaygmY3J0Yy0+
YmFzZSk7CisJCQljb250aW51ZTsKKwkJfQorCisJCWlmIChuZXdfY3J0Y19zdGF0ZS0+aHcuYWN0
aXZlKSB7CisJCQlpZiAobmV3X2NydGNfc3RhdGUtPmJpZ2pvaW5lcikgeworCQkJCXNsYXZlID0g
bmV3X2NydGNfc3RhdGUtPmJpZ2pvaW5lcl9saW5rZWRfY3J0YzsKKwkJCQlzbGF2ZV9jcnRjX3N0
YXRlID0KKwkJCQkJaW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0ZSwKKwkJCQkJ
CQkJCXNsYXZlKTsKKworCQkJCS8qIHB1dCBib3RoIGVudHJpZXMgaW4gKi8KKwkJCQluZXdfZW50
cmllc1tpXS5zdGFydCA9IG5ld19jcnRjX3N0YXRlLT53bS5za2wuZGRiLnN0YXJ0OworCQkJCW5l
d19lbnRyaWVzW2ldLmVuZCA9IHNsYXZlX2NydGNfc3RhdGUtPndtLnNrbC5kZGIuZW5kOworCQkJ
fSBlbHNlIHsKKwkJCQluZXdfZW50cmllc1tpXSA9IG5ld19jcnRjX3N0YXRlLT53bS5za2wuZGRi
OworCQkJfQorCQl9CiAKLQlmb3JfZWFjaF9vbGRuZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0
ZSwgY3J0Yywgb2xkX2NydGNfc3RhdGUsIG5ld19jcnRjX3N0YXRlLCBpKQogCQkvKiBpZ25vcmUg
YWxsb2NhdGlvbnMgZm9yIGNydGMncyB0aGF0IGhhdmUgYmVlbiB0dXJuZWQgb2ZmLiAqLwotCQlp
ZiAobmV3X2NydGNfc3RhdGUtPmh3LmFjdGl2ZSkKKwkJaWYgKCFuZXdfY3J0Y19zdGF0ZS0+aHcu
YWN0aXZlIHx8IG5lZWRzX21vZGVzZXQobmV3X2NydGNfc3RhdGUpKQorCQkJY29udGludWU7CisK
KwkJaWYgKG9sZF9jcnRjX3N0YXRlLT5iaWdqb2luZXIpIHsKKwkJCXNsYXZlID0gb2xkX2NydGNf
c3RhdGUtPmJpZ2pvaW5lcl9saW5rZWRfY3J0YzsKKwkJCXNsYXZlX2NydGNfc3RhdGUgPQorCQkJ
CWludGVsX2F0b21pY19nZXRfb2xkX2NydGNfc3RhdGUoc3RhdGUsIHNsYXZlKTsKKworCQkJZW50
cmllc1tpXS5zdGFydCA9IG9sZF9jcnRjX3N0YXRlLT53bS5za2wuZGRiLnN0YXJ0OworCQkJZW50
cmllc1tpXS5lbmQgPSBzbGF2ZV9jcnRjX3N0YXRlLT53bS5za2wuZGRiLmVuZDsKKwkJfSBlbHNl
IHsKIAkJCWVudHJpZXNbaV0gPSBvbGRfY3J0Y19zdGF0ZS0+d20uc2tsLmRkYjsKKwkJfQorCX0K
IAogCS8qIElmIDJuZCBEQnVmIHNsaWNlIHJlcXVpcmVkLCBlbmFibGUgaXQgaGVyZSAqLwogCWlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExICYmIHJlcXVpcmVkX3NsaWNlcyA+IGh3X2VuYWJs
ZWRfc2xpY2VzKQpAQCAtMTUxMzAsMTYgKzE1MjE0LDE2IEBAIHN0YXRpYyB2b2lkIHNrbF9jb21t
aXRfbW9kZXNldF9lbmFibGVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQkJ
Ym9vbCB2Ymxfd2FpdCA9IGZhbHNlOwogCQkJYm9vbCBtb2Rlc2V0ID0gbmVlZHNfbW9kZXNldChu
ZXdfY3J0Y19zdGF0ZSk7CiAKLQkJCWlmICh1cGRhdGVkICYgQklUKGNydGMtPnBpcGUpIHx8ICFu
ZXdfY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKQorCQkJaWYgKHVwZGF0ZWQgJiBCSVQoY3J0Yy0+cGlw
ZSkgfHwgIW5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUgfHwKKwkJCSAgICBuZXdfY3J0Y19zdGF0
ZS0+Ymlnam9pbmVyX3NsYXZlKQogCQkJCWNvbnRpbnVlOwogCi0JCQlpZiAoc2tsX2RkYl9hbGxv
Y2F0aW9uX292ZXJsYXBzKCZuZXdfY3J0Y19zdGF0ZS0+d20uc2tsLmRkYiwKLQkJCQkJCQllbnRy
aWVzLAorCQkJaWYgKHNrbF9kZGJfYWxsb2NhdGlvbl9vdmVybGFwcygmbmV3X2VudHJpZXNbaV0s
IGVudHJpZXMsCiAJCQkJCQkJSU5URUxfTlVNX1BJUEVTKGRldl9wcml2KSwgaSkpCiAJCQkJY29u
dGludWU7CiAKIAkJCXVwZGF0ZWQgfD0gQklUKHBpcGUpOwotCQkJZW50cmllc1tpXSA9IG5ld19j
cnRjX3N0YXRlLT53bS5za2wuZGRiOworCQkJZW50cmllc1tpXSA9IG5ld19lbnRyaWVzW2ldOwog
CiAJCQkvKgogCQkJICogSWYgdGhpcyBpcyBhbiBhbHJlYWR5IGFjdGl2ZSBwaXBlLCBpdCdzIERE
QiBjaGFuZ2VkLApAQCAtMTUxNDcsMTAgKzE1MjMxLDkgQEAgc3RhdGljIHZvaWQgc2tsX2NvbW1p
dF9tb2Rlc2V0X2VuYWJsZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCQkg
KiB0aGVuIHdlIG5lZWQgdG8gd2FpdCBmb3IgYSB2YmxhbmsgdG8gcGFzcyBmb3IgdGhlCiAJCQkg
KiBuZXcgZGRiIGFsbG9jYXRpb24gdG8gdGFrZSBlZmZlY3QuCiAJCQkgKi8KLQkJCWlmICghc2ts
X2RkYl9lbnRyeV9lcXVhbCgmbmV3X2NydGNfc3RhdGUtPndtLnNrbC5kZGIsCi0JCQkJCQkgJm9s
ZF9jcnRjX3N0YXRlLT53bS5za2wuZGRiKSAmJgotCQkJICAgICFtb2Rlc2V0ICYmCi0JCQkgICAg
c3RhdGUtPndtX3Jlc3VsdHMuZGlydHlfcGlwZXMgIT0gdXBkYXRlZCkKKwkJCWlmICghc2tsX2Rk
Yl9lbnRyeV9lcXVhbCgmZW50cmllc1tpXSwgJm5ld19lbnRyaWVzW2ldKSAmJgorCQkJICAgICFu
ZWVkc19tb2Rlc2V0KG5ld19jcnRjX3N0YXRlKSAmJgorCQkJICAgIGRpcnR5X3BpcGVzICE9IHVw
ZGF0ZWQpCiAJCQkJdmJsX3dhaXQgPSB0cnVlOwogCiAJCQlpZiAobW9kZXNldCAmJiBpc190cmFu
c19wb3J0X3N5bmNfbW9kZShuZXdfY3J0Y19zdGF0ZSkpIHsKQEAgLTE1MTYxLDYgKzE1MjQ0LDEw
IEBAIHN0YXRpYyB2b2lkIHNrbF9jb21taXRfbW9kZXNldF9lbmFibGVzKHN0cnVjdCBpbnRlbF9h
dG9taWNfc3RhdGUgKnN0YXRlKQogCQkJCQkJCQkJICAgbmV3X2NydGNfc3RhdGUpOwogCQkJCWVs
c2UKIAkJCQkJY29udGludWU7CisJCQl9IGVsc2UgaWYgKG5ld19jcnRjX3N0YXRlLT5iaWdqb2lu
ZXIpIHsKKwkJCQlpbnRlbF91cGRhdGVfYmlnam9pbmVyKGNydGMsIHN0YXRlLAorCQkJCQkJICAg
ICAgIG9sZF9jcnRjX3N0YXRlLAorCQkJCQkJICAgICAgIG5ld19jcnRjX3N0YXRlKTsKIAkJCX0g
ZWxzZSB7CiAJCQkJaW50ZWxfdXBkYXRlX2NydGMoY3J0Yywgc3RhdGUsIG9sZF9jcnRjX3N0YXRl
LAogCQkJCQkJICBuZXdfY3J0Y19zdGF0ZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9zcHJpdGUuYwppbmRleCA1NGI4MWY1Y2I0YzUuLjAwNGRlMDVmMzk5NSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCkBAIC05OCw2ICs5OCw4
IEBAIHZvaWQgaW50ZWxfcGlwZV91cGRhdGVfc3RhcnQoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKm5ld19jcnRjX3N0YXRlKQogCiAJLyogRklYTUUgbmVlZHMgdG8gYmUgY2FsaWJyYXRl
ZCBzZW5zaWJseSAqLwogCW1pbiA9IHZibGFua19zdGFydCAtIGludGVsX3VzZWNzX3RvX3NjYW5s
aW5lcyhhZGp1c3RlZF9tb2RlLAorCQkJCQkJICAgICAgbmV3X2NydGNfc3RhdGUtPmJpZ2pvaW5l
ciA/CisJCQkJCQkgICAgICAyICogVkJMQU5LX0VWQVNJT05fVElNRV9VUyA6CiAJCQkJCQkgICAg
ICBWQkxBTktfRVZBU0lPTl9USU1FX1VTKTsKIAltYXggPSB2Ymxhbmtfc3RhcnQgLSAxOwogCkBA
IC0xODgsNyArMTkwLDggQEAgdm9pZCBpbnRlbF9waXBlX3VwZGF0ZV9zdGFydChjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpCiAgKiByZS1lbmFibGVzIGludGVy
cnVwdHMgYW5kIHZlcmlmaWVzIHRoZSB1cGRhdGUgd2FzIGFjdHVhbGx5IGNvbXBsZXRlZAogICog
YmVmb3JlIGEgdmJsYW5rLgogICovCi12b2lkIGludGVsX3BpcGVfdXBkYXRlX2VuZChzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpCit2b2lkIGludGVsX3BpcGVfdXBkYXRl
X2VuZChzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUsCisJCQkgICBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqc2xhdmVfY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMobmV3X2NydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CiAJ
ZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwpAQCAtMjAzLDE1ICsyMDYsMjQgQEAgdm9pZCBp
bnRlbF9waXBlX3VwZGF0ZV9lbmQoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0
YXRlKQogCSAqIFdvdWxkIGJlIHNsaWdodGx5IG5pY2UgdG8ganVzdCBncmFiIHRoZSB2Ymxhbmsg
Y291bnQgYW5kIGFybSB0aGUKIAkgKiBldmVudCBvdXRzaWRlIG9mIHRoZSBjcml0aWNhbCBzZWN0
aW9uIC0gdGhlIHNwaW5sb2NrIG1pZ2h0IHNwaW4gZm9yIGEKIAkgKiB3aGlsZSAuLi4gKi8KLQlp
ZiAobmV3X2NydGNfc3RhdGUtPnVhcGkuZXZlbnQpIHsKLQkJV0FSTl9PTihkcm1fY3J0Y192Ymxh
bmtfZ2V0KCZjcnRjLT5iYXNlKSAhPSAwKTsKKwlpZiAobmV3X2NydGNfc3RhdGUtPnVhcGkuZXZl
bnQgfHwgKHNsYXZlX2NydGNfc3RhdGUgJiYgc2xhdmVfY3J0Y19zdGF0ZS0+dWFwaS5ldmVudCkp
IHsKKwkJaWYgKG5ld19jcnRjX3N0YXRlLT51YXBpLmV2ZW50KQorCQkJV0FSTl9PTihkcm1fY3J0
Y192YmxhbmtfZ2V0KCZjcnRjLT5iYXNlKSAhPSAwKTsKKwkJaWYgKHNsYXZlX2NydGNfc3RhdGUg
JiYgc2xhdmVfY3J0Y19zdGF0ZS0+dWFwaS5ldmVudCkKKwkJCVdBUk5fT04oZHJtX2NydGNfdmJs
YW5rX2dldCgmY3J0Yy0+YmFzZSkgIT0gMCk7CiAKIAkJc3Bpbl9sb2NrKCZjcnRjLT5iYXNlLmRl
di0+ZXZlbnRfbG9jayk7Ci0JCWRybV9jcnRjX2FybV92YmxhbmtfZXZlbnQoJmNydGMtPmJhc2Us
Ci0JCQkJICAgICAgICAgIG5ld19jcnRjX3N0YXRlLT51YXBpLmV2ZW50KTsKKwkJaWYgKG5ld19j
cnRjX3N0YXRlLT51YXBpLmV2ZW50KQorCQkJZHJtX2NydGNfYXJtX3ZibGFua19ldmVudCgmY3J0
Yy0+YmFzZSwKKwkJCQkJCSAgbmV3X2NydGNfc3RhdGUtPnVhcGkuZXZlbnQpOworCQlpZiAoc2xh
dmVfY3J0Y19zdGF0ZSAmJiBzbGF2ZV9jcnRjX3N0YXRlLT51YXBpLmV2ZW50KQorCQkJZHJtX2Ny
dGNfYXJtX3ZibGFua19ldmVudCgmY3J0Yy0+YmFzZSwKKwkJCQkJCSAgc2xhdmVfY3J0Y19zdGF0
ZS0+dWFwaS5ldmVudCk7CiAJCXNwaW5fdW5sb2NrKCZjcnRjLT5iYXNlLmRldi0+ZXZlbnRfbG9j
ayk7CiAKIAkJbmV3X2NydGNfc3RhdGUtPnVhcGkuZXZlbnQgPSBOVUxMOworCQlpZiAoc2xhdmVf
Y3J0Y19zdGF0ZSkKKwkJCXNsYXZlX2NydGNfc3RhdGUtPnVhcGkuZXZlbnQgPSBOVUxMOwogCX0K
IAogCWxvY2FsX2lycV9lbmFibGUoKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX3Nwcml0ZS5oCmluZGV4IDVlZWFhOTI0MjBkMS4uMzEzMzVkMTJjZjU2IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5oCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmgKQEAgLTI0LDcgKzI0LDggQEAg
c3RydWN0IGludGVsX3BsYW5lICppbnRlbF9zcHJpdGVfcGxhbmVfY3JlYXRlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIGludCBpbnRlbF9zcHJpdGVfc2V0X2NvbG9ya2V5X2lv
Y3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCQkJICAgIHN0cnVjdCBk
cm1fZmlsZSAqZmlsZV9wcml2KTsKIHZvaWQgaW50ZWxfcGlwZV91cGRhdGVfc3RhcnQoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKTsKLXZvaWQgaW50ZWxfcGlw
ZV91cGRhdGVfZW5kKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSk7Cit2
b2lkIGludGVsX3BpcGVfdXBkYXRlX2VuZChzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2Ny
dGNfc3RhdGUsCisJCQkgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqc2xhdmVfY3J0Y19zdGF0
ZSk7CiBpbnQgaW50ZWxfcGxhbmVfY2hlY2tfc3RyaWRlKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFu
ZV9zdGF0ZSAqcGxhbmVfc3RhdGUpOwogaW50IGludGVsX3BsYW5lX2NoZWNrX3NyY19jb29yZGlu
YXRlcyhzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKTsKIGludCBjaHZfcGxh
bmVfY2hlY2tfcm90YXRpb24oY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9z
dGF0ZSk7Ci0tIAoyLjI0LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2lu
dGVsLWdmeA==

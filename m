Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 6FFEE9B4AA
	for <lists+intel-gfx@lfdr.de>; Fri, 23 Aug 2019 18:39:38 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DC3996ECED;
	Fri, 23 Aug 2019 16:39:36 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 78C1789B98
 for <intel-gfx@lists.freedesktop.org>; Fri, 23 Aug 2019 16:39:34 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18243026-1500050 
 for multiple; Fri, 23 Aug 2019 17:39:28 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 23 Aug 2019 17:39:26 +0100
Message-Id: <20190823163926.9919-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190823162041.9482-1-chris@chris-wilson.co.uk>
References: <20190823162041.9482-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: Replace obj->pin_global with
 obj->frontbuffer
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

b2JqLT5waW5fZ2xvYmFsIHdhcyBvcmlnaW5hbCB1c2VkIGFzIGEgbWVhbnMgdG8ga2VlcCB0aGUg
c2hyaW5rZXIgb2ZmCnRoZSBhY3RpdmUgc2Nhbm91dCwgYnV0IHdlIHVzZSB0aGUgdm1hLT5waW5f
Y291bnQgaXRzZWxmIGZvciB0aGF0IGFuZAp0aGUgb2JqLT5mcm9udGJ1ZmZlciB0byBkZWxheSBz
aHJpbmtpbmcgYWN0aXZlIGZyYW1lYnVmZmVycy4gVGhlIG90aGVyCnJvbGUgdGhhdCBvYmotPnBp
bl9nbG9iYWwgZ2FpbmVkIHdhcyBmb3Igc3BvdHRpbmcgZGlzcGxheSBvYmplY3RzIGluc2lkZQpH
RU0gYW5kIHdvcmtpbmcgaGFyZGVyIHRvIGtlZXAgdGhvc2UgY29oZXJlbnQ7IGZvciB3aGljaCB3
ZSBjYW4gYWdhaW4Kc2ltcGx5IGluc3BlY3Qgb2JqLT5mcm9udGJ1ZmZlciBkaXJlY3RseS4KCkNv
bWluZyB1cCBuZXh0LCB3ZSB3aWxsIHdhbnQgdG8gbWFuaXB1bGF0ZSB0aGUgcGluX2dsb2JhbCBj
b3VudGVyCm91dHNpZGUgb2YgdGhlIHByaW5jaXBsZSBsb2Nrcywgc28gd291bGQgbmVlZCB0byBt
YWtlIHBpbl9nbG9iYWwgYXRvbWljLgpIb3dldmVyLCBzaW5jZSBvYmotPmZyb250YnVmZmVyIGlz
IGFscmVhZHkgbWFuYWdlZCBhdG9taWNhbGx5LCBpdCBtYWtlcwpzZW5zZSB0byB1c2UgdGhhdCB0
aGUgcHJpbWFyeSBrZXkgZm9yIGRpc3BsYXkgb2JqZWN0cyBpbnN0ZWFkIG9mIGhhdmluZwpwaW5f
Z2xvYmFsLgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24u
Y28udWs+CkNjOiBNaWthIEt1b3BwYWxhIDxtaWthLmt1b3BwYWxhQGxpbnV4LmludGVsLmNvbT4K
LS0tCiAuLi4vZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZnJvbnRidWZmZXIuYyAgfCAxMyAr
KysrKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMgICAgfCAz
NCArKysrKystLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
b2JqZWN0LmggICAgfCAgMyArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0
X3R5cGVzLmggIHwgIDIgLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJp
bmtlci5jICB8IDE1ICsrKy0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMu
YyAgICAgICAgICAgfCAxMiArKy0tLS0tCiA2IGZpbGVzIGNoYW5nZWQsIDI5IGluc2VydGlvbnMo
KyksIDUwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZnJvbnRidWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZnJvbnRidWZmZXIuYwppbmRleCA3MTkzNzk3NzRmYTUuLmZjNDBkYzFmZGJjYyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mcm9udGJ1ZmZlci5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZnJvbnRidWZmZXIuYwpA
QCAtMjIwLDExICsyMjAsMTggQEAgc3RhdGljIHZvaWQgZnJvbnRidWZmZXJfcmVsZWFzZShzdHJ1
Y3Qga3JlZiAqcmVmKQogewogCXN0cnVjdCBpbnRlbF9mcm9udGJ1ZmZlciAqZnJvbnQgPQogCQlj
b250YWluZXJfb2YocmVmLCB0eXBlb2YoKmZyb250KSwgcmVmKTsKKwlzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqID0gZnJvbnQtPm9iajsKKwlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAot
CWZyb250LT5vYmotPmZyb250YnVmZmVyID0gTlVMTDsKLQlzcGluX3VubG9jaygmdG9faTkxNShm
cm9udC0+b2JqLT5iYXNlLmRldiktPmZiX3RyYWNraW5nLmxvY2spOworCXNwaW5fbG9jaygmb2Jq
LT52bWEubG9jayk7CisJZm9yX2VhY2hfZ2d0dF92bWEodm1hLCBvYmopCisJCXZtYS0+ZGlzcGxh
eV9hbGlnbm1lbnQgPSBJOTE1X0dUVF9NSU5fQUxJR05NRU5UOworCXNwaW5fdW5sb2NrKCZvYmot
PnZtYS5sb2NrKTsKIAotCWk5MTVfZ2VtX29iamVjdF9wdXQoZnJvbnQtPm9iaik7CisJb2JqLT5m
cm9udGJ1ZmZlciA9IE5VTEw7CisJc3Bpbl91bmxvY2soJnRvX2k5MTUob2JqLT5iYXNlLmRldikt
PmZiX3RyYWNraW5nLmxvY2spOworCisJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwogCWtmcmVl
KGZyb250KTsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX2RvbWFpbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5j
CmluZGV4IDljNThlOGZhYzFkOS4uMDM0MWIzZGE5MzBhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jCkBAIC0yNyw3ICsyNyw3IEBAIHN0YXRpYyB2b2lkIF9f
aTkxNV9nZW1fb2JqZWN0X2ZsdXNoX2Zvcl9kaXNwbGF5KHN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmopCiAKIHZvaWQgaTkxNV9nZW1fb2JqZWN0X2ZsdXNoX2lmX2Rpc3BsYXkoc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHsKLQlpZiAoIVJFQURfT05DRShvYmotPnBpbl9n
bG9iYWwpKQorCWlmICghUkVBRF9PTkNFKG9iai0+ZnJvbnRidWZmZXIpKQogCQlyZXR1cm47CiAK
IAlpOTE1X2dlbV9vYmplY3RfbG9jayhvYmopOwpAQCAtNDIyLDEyICs0MjIsOCBAQCBpOTE1X2dl
bV9vYmplY3RfcGluX3RvX2Rpc3BsYXlfcGxhbmUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iaiwKIAogCWFzc2VydF9vYmplY3RfaGVsZChvYmopOwogCi0JLyogTWFyayB0aGUgZ2xvYmFs
IHBpbiBlYXJseSBzbyB0aGF0IHdlIGFjY291bnQgZm9yIHRoZQotCSAqIGRpc3BsYXkgY29oZXJl
bmN5IHdoaWxzdCBzZXR0aW5nIHVwIHRoZSBjYWNoZSBkb21haW5zLgotCSAqLwotCW9iai0+cGlu
X2dsb2JhbCsrOwotCi0JLyogVGhlIGRpc3BsYXkgZW5naW5lIGlzIG5vdCBjb2hlcmVudCB3aXRo
IHRoZSBMTEMgY2FjaGUgb24gZ2VuNi4gIEFzCisJLyoKKwkgKiBUaGUgZGlzcGxheSBlbmdpbmUg
aXMgbm90IGNvaGVyZW50IHdpdGggdGhlIExMQyBjYWNoZSBvbiBnZW42LiAgQXMKIAkgKiBhIHJl
c3VsdCwgd2UgbWFrZSBzdXJlIHRoYXQgdGhlIHBpbm5pbmcgdGhhdCBpcyBhYm91dCB0byBvY2N1
ciBpcwogCSAqIGRvbmUgd2l0aCB1bmNhY2hlZCBQVEVzLiBUaGlzIGlzIGxvd2VzdCBjb21tb24g
ZGVub21pbmF0b3IgZm9yIGFsbAogCSAqIGNoaXBzZXRzLgpAQCAtNDM5LDEyICs0MzUsMTEgQEAg
aTkxNV9nZW1fb2JqZWN0X3Bpbl90b19kaXNwbGF5X3BsYW5lKHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmosCiAJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNoZV9sZXZlbChvYmos
CiAJCQkJCSAgICAgIEhBU19XVCh0b19pOTE1KG9iai0+YmFzZS5kZXYpKSA/CiAJCQkJCSAgICAg
IEk5MTVfQ0FDSEVfV1QgOiBJOTE1X0NBQ0hFX05PTkUpOwotCWlmIChyZXQpIHsKLQkJdm1hID0g
RVJSX1BUUihyZXQpOwotCQlnb3RvIGVycl91bnBpbl9nbG9iYWw7Ci0JfQorCWlmIChyZXQpCisJ
CXJldHVybiBFUlJfUFRSKHJldCk7CiAKLQkvKiBBcyB0aGUgdXNlciBtYXkgbWFwIHRoZSBidWZm
ZXIgb25jZSBwaW5uZWQgaW4gdGhlIGRpc3BsYXkgcGxhbmUKKwkvKgorCSAqIEFzIHRoZSB1c2Vy
IG1heSBtYXAgdGhlIGJ1ZmZlciBvbmNlIHBpbm5lZCBpbiB0aGUgZGlzcGxheSBwbGFuZQogCSAq
IChlLmcuIGxpYmttcyBmb3IgdGhlIGJvb3R1cCBzcGxhc2gpLCB3ZSBoYXZlIHRvIGVuc3VyZSB0
aGF0IHdlCiAJICogYWx3YXlzIHVzZSBtYXBfYW5kX2ZlbmNlYWJsZSBmb3IgYWxsIHNjYW5vdXQg
YnVmZmVycy4gSG93ZXZlciwKIAkgKiBpdCBtYXkgc2ltcGx5IGJlIHRvbyBiaWcgdG8gZml0IGlu
dG8gbWFwcGFibGUsIGluIHdoaWNoIGNhc2UKQEAgLTQ2MSwyMiArNDU2LDE5IEBAIGk5MTVfZ2Vt
X29iamVjdF9waW5fdG9fZGlzcGxheV9wbGFuZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqLAogCWlmIChJU19FUlIodm1hKSkKIAkJdm1hID0gaTkxNV9nZW1fb2JqZWN0X2dndHRfcGlu
KG9iaiwgdmlldywgMCwgYWxpZ25tZW50LCBmbGFncyk7CiAJaWYgKElTX0VSUih2bWEpKQotCQln
b3RvIGVycl91bnBpbl9nbG9iYWw7CisJCXJldHVybiB2bWE7CiAKIAl2bWEtPmRpc3BsYXlfYWxp
Z25tZW50ID0gbWF4X3QodTY0LCB2bWEtPmRpc3BsYXlfYWxpZ25tZW50LCBhbGlnbm1lbnQpOwog
CiAJX19pOTE1X2dlbV9vYmplY3RfZmx1c2hfZm9yX2Rpc3BsYXkob2JqKTsKIAotCS8qIEl0IHNo
b3VsZCBub3cgYmUgb3V0IG9mIGFueSBvdGhlciB3cml0ZSBkb21haW5zLCBhbmQgd2UgY2FuIHVw
ZGF0ZQorCS8qCisJICogSXQgc2hvdWxkIG5vdyBiZSBvdXQgb2YgYW55IG90aGVyIHdyaXRlIGRv
bWFpbnMsIGFuZCB3ZSBjYW4gdXBkYXRlCiAJICogdGhlIGRvbWFpbiB2YWx1ZXMgZm9yIG91ciBj
aGFuZ2VzLgogCSAqLwogCW9iai0+cmVhZF9kb21haW5zIHw9IEk5MTVfR0VNX0RPTUFJTl9HVFQ7
CiAKIAlyZXR1cm4gdm1hOwotCi1lcnJfdW5waW5fZ2xvYmFsOgotCW9iai0+cGluX2dsb2JhbC0t
OwotCXJldHVybiB2bWE7CiB9CiAKIHN0YXRpYyB2b2lkIGk5MTVfZ2VtX29iamVjdF9idW1wX2lu
YWN0aXZlX2dndHQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKQEAgLTUxNCwxMiAr
NTA2LDYgQEAgaTkxNV9nZW1fb2JqZWN0X3VucGluX2Zyb21fZGlzcGxheV9wbGFuZShzdHJ1Y3Qg
aTkxNV92bWEgKnZtYSkKIAogCWFzc2VydF9vYmplY3RfaGVsZChvYmopOwogCi0JaWYgKFdBUk5f
T04ob2JqLT5waW5fZ2xvYmFsID09IDApKQotCQlyZXR1cm47Ci0KLQlpZiAoLS1vYmotPnBpbl9n
bG9iYWwgPT0gMCkKLQkJdm1hLT5kaXNwbGF5X2FsaWdubWVudCA9IEk5MTVfR1RUX01JTl9BTElH
Tk1FTlQ7Ci0KIAkvKiBCdW1wIHRoZSBMUlUgdG8gdHJ5IGFuZCBhdm9pZCBwcmVtYXR1cmUgZXZp
Y3Rpb24gd2hpbHN0IGZsaXBwaW5nICAqLwogCWk5MTVfZ2VtX29iamVjdF9idW1wX2luYWN0aXZl
X2dndHQob2JqKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX29iamVjdC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5o
CmluZGV4IDVlZmI5OTM2ZTA1Yi4uZDYwMDVjYWQ5ZDVjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oCkBAIC00MDYsNyArNDA2LDggQEAgc3RhdGljIGlubGlu
ZSBib29sIGNwdV93cml0ZV9uZWVkc19jbGZsdXNoKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmopCiAJaWYgKCEob2JqLT5jYWNoZV9jb2hlcmVudCAmIEk5MTVfQk9fQ0FDSEVfQ09IRVJF
TlRfRk9SX1dSSVRFKSkKIAkJcmV0dXJuIHRydWU7CiAKLQlyZXR1cm4gb2JqLT5waW5fZ2xvYmFs
OyAvKiBjdXJyZW50bHkgaW4gdXNlIGJ5IEhXLCBrZWVwIGZsdXNoZWQgKi8KKwkvKiBDdXJyZW50
bHkgaW4gdXNlIGJ5IEhXIChkaXNwbGF5IGVuZ2luZSk/IEtlZXAgZmx1c2hlZC4gKi8KKwlyZXR1
cm4gUkVBRF9PTkNFKG9iai0+ZnJvbnRidWZmZXIpOwogfQogCiBzdGF0aWMgaW5saW5lIHZvaWQg
X19zdGFydF9jcHVfd3JpdGUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaCBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaAppbmRleCBl
ZGUwZWI0MjE4YTguLjEzYjlkYzBlMWE4OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaApAQCAtMTUyLDggKzE1Miw2IEBAIHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0IHsKIAogCS8qKiBDb3VudCBvZiBWTUEgYWN0dWFsbHkgYm91bmQg
YnkgdGhpcyBvYmplY3QgKi8KIAlhdG9taWNfdCBiaW5kX2NvdW50OwotCS8qKiBDb3VudCBvZiBo
b3cgbWFueSBnbG9iYWwgVk1BIGFyZSBjdXJyZW50bHkgcGlubmVkIGZvciB1c2UgYnkgSFcgKi8K
LQl1bnNpZ25lZCBpbnQgcGluX2dsb2JhbDsKIAogCXN0cnVjdCB7CiAJCXN0cnVjdCBtdXRleCBs
b2NrOyAvKiBwcm90ZWN0cyB0aGUgcGFnZXMgYW5kIHRoZWlyIHVzZSAqLwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYwppbmRleCBlZGQyMWQxNGU2NGYuLjRl
NTVjZmMyYjBkYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X3Nocmlua2VyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlu
a2VyLmMKQEAgLTYxLDcgKzYxLDggQEAgc3RhdGljIGJvb2wgY2FuX3JlbGVhc2VfcGFnZXMoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAlpZiAoIWk5MTVfZ2VtX29iamVjdF9pc19z
aHJpbmthYmxlKG9iaikpCiAJCXJldHVybiBmYWxzZTsKIAotCS8qIE9ubHkgcmVwb3J0IHRydWUg
aWYgYnkgdW5iaW5kaW5nIHRoZSBvYmplY3QgYW5kIHB1dHRpbmcgaXRzIHBhZ2VzCisJLyoKKwkg
KiBPbmx5IHJlcG9ydCB0cnVlIGlmIGJ5IHVuYmluZGluZyB0aGUgb2JqZWN0IGFuZCBwdXR0aW5n
IGl0cyBwYWdlcwogCSAqIHdlIGNhbiBhY3R1YWxseSBtYWtlIGZvcndhcmQgcHJvZ3Jlc3MgdG93
YXJkcyBmcmVlaW5nIHBoeXNpY2FsCiAJICogcGFnZXMuCiAJICoKQEAgLTcyLDE2ICs3Myw4IEBA
IHN0YXRpYyBib29sIGNhbl9yZWxlYXNlX3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmopCiAJaWYgKGF0b21pY19yZWFkKCZvYmotPm1tLnBhZ2VzX3Bpbl9jb3VudCkgPiBhdG9t
aWNfcmVhZCgmb2JqLT5iaW5kX2NvdW50KSkKIAkJcmV0dXJuIGZhbHNlOwogCi0JLyogSWYgYW55
IHZtYSBhcmUgInBlcm1hbmVudGx5IiBwaW5uZWQsIGl0IHdpbGwgcHJldmVudCB1cyBmcm9tCi0J
ICogcmVjbGFpbWluZyB0aGUgb2JqLT5tbS5wYWdlcy4gV2Ugb25seSBhbGxvdyBzY2Fub3V0IG9i
amVjdHMgdG8gY2xhaW0KLQkgKiBhIHBlcm1hbmVudCBwaW4sIGFsb25nIHdpdGggYSBmZXcgb3Ro
ZXJzIGxpa2UgdGhlIGNvbnRleHQgb2JqZWN0cy4KLQkgKiBUbyBzaW1wbGlmeSB0aGUgc2Nhbiwg
YW5kIHRvIGF2b2lkIHdhbGtpbmcgdGhlIGxpc3Qgb2Ygdm1hIHVuZGVyIHRoZQotCSAqIG9iamVj
dCwgd2UganVzdCBjaGVjayB0aGUgY291bnQgb2YgaXRzIHBlcm1hbmVudGx5IHBpbm5lZC4KLQkg
Ki8KLQlpZiAoUkVBRF9PTkNFKG9iai0+cGluX2dsb2JhbCkpCi0JCXJldHVybiBmYWxzZTsKLQot
CS8qIFdlIGNhbiBvbmx5IHJldHVybiBwaHlzaWNhbCBwYWdlcyB0byB0aGUgc3lzdGVtIGlmIHdl
IGNhbiBlaXRoZXIKKwkvKgorCSAqIFdlIGNhbiBvbmx5IHJldHVybiBwaHlzaWNhbCBwYWdlcyB0
byB0aGUgc3lzdGVtIGlmIHdlIGNhbiBlaXRoZXIKIAkgKiBkaXNjYXJkIHRoZSBjb250ZW50cyAo
YmVjYXVzZSB0aGUgdXNlciBoYXMgbWFya2VkIHRoZW0gYXMgYmVpbmcKIAkgKiBwdXJnZWFibGUp
IG9yIGlmIHdlIGNhbiBtb3ZlIHRoZWlyIGNvbnRlbnRzIG91dCB0byBzd2FwLgogCSAqLwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwppbmRleCBlMTAzZmNiYTY0MzUuLmI5MDM3MTg0NDY4
OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKQEAgLTc3LDExICs3Nyw2IEBAIHN0
YXRpYyBpbnQgaTkxNV9jYXBhYmlsaXRpZXMoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRh
KQogCXJldHVybiAwOwogfQogCi1zdGF0aWMgY2hhciBnZXRfcGluX2ZsYWcoc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaikKLXsKLQlyZXR1cm4gb2JqLT5waW5fZ2xvYmFsID8gJ3AnIDog
JyAnOwotfQotCiBzdGF0aWMgY2hhciBnZXRfdGlsaW5nX2ZsYWcoc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaikKIHsKIAlzd2l0Y2ggKGk5MTVfZ2VtX29iamVjdF9nZXRfdGlsaW5nKG9i
aikpIHsKQEAgLTE0MCw5ICsxMzUsOCBAQCBkZXNjcmliZV9vYmooc3RydWN0IHNlcV9maWxlICpt
LCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCXN0cnVjdCBpOTE1X3ZtYSAqdm1h
OwogCWludCBwaW5fY291bnQgPSAwOwogCi0Jc2VxX3ByaW50ZihtLCAiJXBLOiAlYyVjJWMlYyAl
OHpkS2lCICUwMnggJTAyeCAlcyVzJXMiLAorCXNlcV9wcmludGYobSwgIiVwSzogJWMlYyVjICU4
emRLaUIgJTAyeCAlMDJ4ICVzJXMlcyIsCiAJCSAgICZvYmotPmJhc2UsCi0JCSAgIGdldF9waW5f
ZmxhZyhvYmopLAogCQkgICBnZXRfdGlsaW5nX2ZsYWcob2JqKSwKIAkJICAgZ2V0X2dsb2JhbF9m
bGFnKG9iaiksCiAJCSAgIGdldF9waW5fbWFwcGVkX2ZsYWcob2JqKSwKQEAgLTIyMSw4ICsyMTUs
OCBAQCBkZXNjcmliZV9vYmooc3RydWN0IHNlcV9maWxlICptLCBzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqKQogCXNlcV9wcmludGYobSwgIiAocGlubmVkIHggJWQpIiwgcGluX2NvdW50
KTsKIAlpZiAob2JqLT5zdG9sZW4pCiAJCXNlcV9wcmludGYobSwgIiAoc3RvbGVuOiAlMDhsbHgp
Iiwgb2JqLT5zdG9sZW4tPnN0YXJ0KTsKLQlpZiAob2JqLT5waW5fZ2xvYmFsKQotCQlzZXFfcHJp
bnRmKG0sICIgKGdsb2JhbCkiKTsKKwlpZiAoUkVBRF9PTkNFKG9iai0+ZnJvbnRidWZmZXIpKQor
CQlzZXFfcHJpbnRmKG0sICIgKGZyb250KSIpOwogCiAJZW5naW5lID0gaTkxNV9nZW1fb2JqZWN0
X2xhc3Rfd3JpdGVfZW5naW5lKG9iaik7CiAJaWYgKGVuZ2luZSkKLS0gCjIuMjMuMAoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxp
bmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

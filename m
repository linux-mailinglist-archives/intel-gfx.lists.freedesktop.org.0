Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id CC13E34614
	for <lists+intel-gfx@lfdr.de>; Tue,  4 Jun 2019 14:00:30 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3B21C897BC;
	Tue,  4 Jun 2019 12:00:29 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D571E89780
 for <intel-gfx@lists.freedesktop.org>; Tue,  4 Jun 2019 12:00:27 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16787579-1500050 
 for <intel-gfx@lists.freedesktop.org>; Tue, 04 Jun 2019 13:00:26 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue,  4 Jun 2019 13:00:21 +0100
Message-Id: <20190604120022.20472-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190604120022.20472-1-chris@chris-wilson.co.uk>
References: <20190604120022.20472-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 2/3] drm/i915: Use unchecked writes for setting up
 the fences
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QXMgdGhlIGZlbmNlIHJlZ2lzdGVycyBhcmUgbm90IHBhcnQgb2YgdGhlIGVuZ2luZSBwb3dlcndl
bGxzLCB3ZSBkbyBub3QKbmVlZCB0byBmaWRkbGUgd2l0aCBmb3JjZXdha2UgaW4gb3JkZXIgdG8g
dXBkYXRlIGEgZmVuY2UuIEF2b2lkIHVzaW5nCnRoZSBoZWF2eXdlaWdodCBkZWJ1ZyBjaGVja2lu
ZyBub3JtYWwgbW1pbyB3cml0ZXMgYXMgdGhlIGNoZWNraW5nCmRvbWluYXRlcyB0aGUgc2VsZnRl
c3QgcnVudGltZSBhbmQgaXMgc3VwZXJmbHVvdXMhCgpJbiB0aGUgcHJvY2VzcywgcmV0aXJlIHRo
ZSBJOTE1X1dSSVRFKCkgaW1wbGljaXQgbWFjcm8gd2l0aCB0aGUgbmV3CmludGVsX3VuY29yZV93
cml0ZSBpbnRlcmZhY2UuCgp2Mjogcy91bmMvdW5jb3JlLwoKU2lnbmVkLW9mZi1ieTogQ2hyaXMg
V2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+ClJldmlld2VkLWJ5OiBKb29uYXMgTGFo
dGluZW4gPGpvb25hcy5sYWh0aW5lbkBsaW51eC5pbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9nZW1fZmVuY2VfcmVnLmMgfCAxMjMgKysrKysrKysrKysrLS0tLS0tLS0t
LQogMSBmaWxlIGNoYW5nZWQsIDY4IGluc2VydGlvbnMoKyksIDU1IGRlbGV0aW9ucygtKQoKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZmVuY2VfcmVnLmMKaW5kZXggMmU5ZTMyMzMwYWFh
Li4xMGFhNmUzNTBiZmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2Vt
X2ZlbmNlX3JlZy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2ZlbmNlX3Jl
Zy5jCkBAIC05NCw5ICs5NCwxMCBAQCBzdGF0aWMgdm9pZCBpOTY1X3dyaXRlX2ZlbmNlX3JlZyhz
dHJ1Y3QgZHJtX2k5MTVfZmVuY2VfcmVnICpmZW5jZSwKIAl9CiAKIAlpZiAoIXBpcGVsaW5lZCkg
ewotCQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBmZW5jZS0+aTkxNTsKKwkJ
c3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmZlbmNlLT5pOTE1LT51bmNvcmU7CiAKLQkJ
LyogVG8gdy9hIGluY29oZXJlbmN5IHdpdGggbm9uLWF0b21pYyA2NC1iaXQgcmVnaXN0ZXIgdXBk
YXRlcywKKwkJLyoKKwkJICogVG8gdy9hIGluY29oZXJlbmN5IHdpdGggbm9uLWF0b21pYyA2NC1i
aXQgcmVnaXN0ZXIgdXBkYXRlcywKIAkJICogd2Ugc3BsaXQgdGhlIDY0LWJpdCB1cGRhdGUgaW50
byB0d28gMzItYml0IHdyaXRlcy4gSW4gb3JkZXIKIAkJICogZm9yIGEgcGFydGlhbCBmZW5jZSBu
b3QgdG8gYmUgZXZhbHVhdGVkIGJldHdlZW4gd3JpdGVzLCB3ZQogCQkgKiBwcmVjZWRlIHRoZSB1
cGRhdGUgd2l0aCB3cml0ZSB0byB0dXJuIG9mZiB0aGUgZmVuY2UgcmVnaXN0ZXIsCkBAIC0xMDUs
MTIgKzEwNiwxMiBAQCBzdGF0aWMgdm9pZCBpOTY1X3dyaXRlX2ZlbmNlX3JlZyhzdHJ1Y3QgZHJt
X2k5MTVfZmVuY2VfcmVnICpmZW5jZSwKIAkJICogRm9yIGV4dHJhIGxldmVscyBvZiBwYXJhbm9p
YSwgd2UgbWFrZSBzdXJlIGVhY2ggc3RlcCBsYW5kcwogCQkgKiBiZWZvcmUgYXBwbHlpbmcgdGhl
IG5leHQgc3RlcC4KIAkJICovCi0JCUk5MTVfV1JJVEUoZmVuY2VfcmVnX2xvLCAwKTsKLQkJUE9T
VElOR19SRUFEKGZlbmNlX3JlZ19sbyk7CisJCWludGVsX3VuY29yZV93cml0ZV9mdyh1bmNvcmUs
IGZlbmNlX3JlZ19sbywgMCk7CisJCWludGVsX3VuY29yZV9wb3N0aW5nX3JlYWRfZncodW5jb3Jl
LCBmZW5jZV9yZWdfbG8pOwogCi0JCUk5MTVfV1JJVEUoZmVuY2VfcmVnX2hpLCB1cHBlcl8zMl9i
aXRzKHZhbCkpOwotCQlJOTE1X1dSSVRFKGZlbmNlX3JlZ19sbywgbG93ZXJfMzJfYml0cyh2YWwp
KTsKLQkJUE9TVElOR19SRUFEKGZlbmNlX3JlZ19sbyk7CisJCWludGVsX3VuY29yZV93cml0ZV9m
dyh1bmNvcmUsIGZlbmNlX3JlZ19oaSwgdXBwZXJfMzJfYml0cyh2YWwpKTsKKwkJaW50ZWxfdW5j
b3JlX3dyaXRlX2Z3KHVuY29yZSwgZmVuY2VfcmVnX2xvLCBsb3dlcl8zMl9iaXRzKHZhbCkpOwor
CQlpbnRlbF91bmNvcmVfcG9zdGluZ19yZWFkX2Z3KHVuY29yZSwgZmVuY2VfcmVnX2xvKTsKIAl9
CiB9CiAKQEAgLTE0NiwxMSArMTQ3LDExIEBAIHN0YXRpYyB2b2lkIGk5MTVfd3JpdGVfZmVuY2Vf
cmVnKHN0cnVjdCBkcm1faTkxNV9mZW5jZV9yZWcgKmZlbmNlLAogCX0KIAogCWlmICghcGlwZWxp
bmVkKSB7Ci0JCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGZlbmNlLT5pOTE1
OworCQlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSAmZmVuY2UtPmk5MTUtPnVuY29yZTsK
IAkJaTkxNV9yZWdfdCByZWcgPSBGRU5DRV9SRUcoZmVuY2UtPmlkKTsKIAotCQlJOTE1X1dSSVRF
KHJlZywgdmFsKTsKLQkJUE9TVElOR19SRUFEKHJlZyk7CisJCWludGVsX3VuY29yZV93cml0ZV9m
dyh1bmNvcmUsIHJlZywgdmFsKTsKKwkJaW50ZWxfdW5jb3JlX3Bvc3RpbmdfcmVhZF9mdyh1bmNv
cmUsIHJlZyk7CiAJfQogfQogCkBAIC0xNzgsMTggKzE3OSwxOSBAQCBzdGF0aWMgdm9pZCBpODMw
X3dyaXRlX2ZlbmNlX3JlZyhzdHJ1Y3QgZHJtX2k5MTVfZmVuY2VfcmVnICpmZW5jZSwKIAl9CiAK
IAlpZiAoIXBpcGVsaW5lZCkgewotCQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSBmZW5jZS0+aTkxNTsKKwkJc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmZlbmNlLT5p
OTE1LT51bmNvcmU7CiAJCWk5MTVfcmVnX3QgcmVnID0gRkVOQ0VfUkVHKGZlbmNlLT5pZCk7CiAK
LQkJSTkxNV9XUklURShyZWcsIHZhbCk7Ci0JCVBPU1RJTkdfUkVBRChyZWcpOworCQlpbnRlbF91
bmNvcmVfd3JpdGVfZncodW5jb3JlLCByZWcsIHZhbCk7CisJCWludGVsX3VuY29yZV9wb3N0aW5n
X3JlYWRfZncodW5jb3JlLCByZWcpOwogCX0KIH0KIAogc3RhdGljIHZvaWQgZmVuY2Vfd3JpdGUo
c3RydWN0IGRybV9pOTE1X2ZlbmNlX3JlZyAqZmVuY2UsCiAJCQlzdHJ1Y3QgaTkxNV92bWEgKnZt
YSkKIHsKLQkvKiBQcmV2aW91cyBhY2Nlc3MgdGhyb3VnaCB0aGUgZmVuY2UgcmVnaXN0ZXIgaXMg
bWFyc2hhbGxlZCBieQorCS8qCisJICogUHJldmlvdXMgYWNjZXNzIHRocm91Z2ggdGhlIGZlbmNl
IHJlZ2lzdGVyIGlzIG1hcnNoYWxsZWQgYnkKIAkgKiB0aGUgbWIoKSBpbnNpZGUgdGhlIGZhdWx0
IGhhbmRsZXJzIChpOTE1X2dlbV9yZWxlYXNlX21tYXBzKQogCSAqIGFuZCBleHBsaWNpdGx5IG1h
bmFnZWQgZm9yIGludGVybmFsIHVzZXJzLgogCSAqLwpAQCAtMjAxLDcgKzIwMyw4IEBAIHN0YXRp
YyB2b2lkIGZlbmNlX3dyaXRlKHN0cnVjdCBkcm1faTkxNV9mZW5jZV9yZWcgKmZlbmNlLAogCWVs
c2UKIAkJaTk2NV93cml0ZV9mZW5jZV9yZWcoZmVuY2UsIHZtYSk7CiAKLQkvKiBBY2Nlc3MgdGhy
b3VnaCB0aGUgZmVuY2VkIHJlZ2lvbiBhZnRlcndhcmRzIGlzCisJLyoKKwkgKiBBY2Nlc3MgdGhy
b3VnaCB0aGUgZmVuY2VkIHJlZ2lvbiBhZnRlcndhcmRzIGlzCiAJICogb3JkZXJlZCBieSB0aGUg
cG9zdGluZyByZWFkcyB3aGlsc3Qgd3JpdGluZyB0aGUgcmVnaXN0ZXJzLgogCSAqLwogCkBAIC0z
MDgsMTEgKzMxMSwxMSBAQCBpbnQgaTkxNV92bWFfcHV0X2ZlbmNlKHN0cnVjdCBpOTE1X3ZtYSAq
dm1hKQogCXJldHVybiBmZW5jZV91cGRhdGUoZmVuY2UsIE5VTEwpOwogfQogCi1zdGF0aWMgc3Ry
dWN0IGRybV9pOTE1X2ZlbmNlX3JlZyAqZmVuY2VfZmluZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCitzdGF0aWMgc3RydWN0IGRybV9pOTE1X2ZlbmNlX3JlZyAqZmVuY2VfZmlu
ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfZmVu
Y2VfcmVnICpmZW5jZTsKIAotCWxpc3RfZm9yX2VhY2hfZW50cnkoZmVuY2UsICZkZXZfcHJpdi0+
bW0uZmVuY2VfbGlzdCwgbGluaykgeworCWxpc3RfZm9yX2VhY2hfZW50cnkoZmVuY2UsICZpOTE1
LT5tbS5mZW5jZV9saXN0LCBsaW5rKSB7CiAJCUdFTV9CVUdfT04oZmVuY2UtPnZtYSAmJiBmZW5j
ZS0+dm1hLT5mZW5jZSAhPSBmZW5jZSk7CiAKIAkJaWYgKGZlbmNlLT5waW5fY291bnQpCkBAIC0z
MjIsNyArMzI1LDcgQEAgc3RhdGljIHN0cnVjdCBkcm1faTkxNV9mZW5jZV9yZWcgKmZlbmNlX2Zp
bmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCX0KIAogCS8qIFdhaXQgZm9y
IGNvbXBsZXRpb24gb2YgcGVuZGluZyBmbGlwcyB3aGljaCBjb25zdW1lIGZlbmNlcyAqLwotCWlm
IChpbnRlbF9oYXNfcGVuZGluZ19mYl91bnBpbihkZXZfcHJpdikpCisJaWYgKGludGVsX2hhc19w
ZW5kaW5nX2ZiX3VucGluKGk5MTUpKQogCQlyZXR1cm4gRVJSX1BUUigtRUFHQUlOKTsKIAogCXJl
dHVybiBFUlJfUFRSKC1FREVBRExLKTsKQEAgLTM1Myw3ICszNTYsOCBAQCBpOTE1X3ZtYV9waW5f
ZmVuY2Uoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJc3RydWN0IGk5MTVfdm1hICpzZXQgPSBpOTE1
X2dlbV9vYmplY3RfaXNfdGlsZWQodm1hLT5vYmopID8gdm1hIDogTlVMTDsKIAlpbnQgZXJyOwog
Ci0JLyogTm90ZSB0aGF0IHdlIHJldm9rZSBmZW5jZXMgb24gcnVudGltZSBzdXNwZW5kLiBUaGVy
ZWZvcmUgdGhlIHVzZXIKKwkvKgorCSAqIE5vdGUgdGhhdCB3ZSByZXZva2UgZmVuY2VzIG9uIHJ1
bnRpbWUgc3VzcGVuZC4gVGhlcmVmb3JlIHRoZSB1c2VyCiAJICogbXVzdCBrZWVwIHRoZSBkZXZp
Y2UgYXdha2Ugd2hpbHN0IHVzaW5nIHRoZSBmZW5jZS4KIAkgKi8KIAlhc3NlcnRfcnBtX3dha2Vs
b2NrX2hlbGQodm1hLT52bS0+aTkxNSk7CkBAIC0zOTUsMjggKzM5OSwyOCBAQCBpOTE1X3ZtYV9w
aW5fZmVuY2Uoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAKIC8qKgogICogaTkxNV9yZXNlcnZlX2Zl
bmNlIC0gUmVzZXJ2ZSBhIGZlbmNlIGZvciB2R1BVCi0gKiBAZGV2X3ByaXY6IGk5MTUgZGV2aWNl
IHByaXZhdGUKKyAqIEBpOTE1OiBpOTE1IGRldmljZSBwcml2YXRlCiAgKgogICogVGhpcyBmdW5j
dGlvbiB3YWxrcyB0aGUgZmVuY2UgcmVncyBsb29raW5nIGZvciBhIGZyZWUgb25lIGFuZCByZW1v
dmUKICAqIGl0IGZyb20gdGhlIGZlbmNlX2xpc3QuIEl0IGlzIHVzZWQgdG8gcmVzZXJ2ZSBmZW5j
ZSBmb3IgdkdQVSB0byB1c2UuCiAgKi8KIHN0cnVjdCBkcm1faTkxNV9mZW5jZV9yZWcgKgotaTkx
NV9yZXNlcnZlX2ZlbmNlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK2k5MTVf
cmVzZXJ2ZV9mZW5jZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3Qg
ZHJtX2k5MTVfZmVuY2VfcmVnICpmZW5jZTsKIAlpbnQgY291bnQ7CiAJaW50IHJldDsKIAotCWxv
Y2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwlsb2NrZGVw
X2Fzc2VydF9oZWxkKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCS8qIEtlZXAgYXQgbGVh
c3Qgb25lIGZlbmNlIGF2YWlsYWJsZSBmb3IgdGhlIGRpc3BsYXkgZW5naW5lLiAqLwogCWNvdW50
ID0gMDsKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KGZlbmNlLCAmZGV2X3ByaXYtPm1tLmZlbmNlX2xp
c3QsIGxpbmspCisJbGlzdF9mb3JfZWFjaF9lbnRyeShmZW5jZSwgJmk5MTUtPm1tLmZlbmNlX2xp
c3QsIGxpbmspCiAJCWNvdW50ICs9ICFmZW5jZS0+cGluX2NvdW50OwogCWlmIChjb3VudCA8PSAx
KQogCQlyZXR1cm4gRVJSX1BUUigtRU5PU1BDKTsKIAotCWZlbmNlID0gZmVuY2VfZmluZChkZXZf
cHJpdik7CisJZmVuY2UgPSBmZW5jZV9maW5kKGk5MTUpOwogCWlmIChJU19FUlIoZmVuY2UpKQog
CQlyZXR1cm4gZmVuY2U7CiAKQEAgLTQ0NiwxOSArNDUwLDE5IEBAIHZvaWQgaTkxNV91bnJlc2Vy
dmVfZmVuY2Uoc3RydWN0IGRybV9pOTE1X2ZlbmNlX3JlZyAqZmVuY2UpCiAKIC8qKgogICogaTkx
NV9nZW1fcmVzdG9yZV9mZW5jZXMgLSByZXN0b3JlIGZlbmNlIHN0YXRlCi0gKiBAZGV2X3ByaXY6
IGk5MTUgZGV2aWNlIHByaXZhdGUKKyAqIEBpOTE1OiBpOTE1IGRldmljZSBwcml2YXRlCiAgKgog
ICogUmVzdG9yZSB0aGUgaHcgZmVuY2Ugc3RhdGUgdG8gbWF0Y2ggdGhlIHNvZnR3YXJlIHRyYWNr
aW5nIGFnYWluLCB0byBiZSBjYWxsZWQKICAqIGFmdGVyIGEgZ3B1IHJlc2V0IGFuZCBvbiByZXN1
bWUuIE5vdGUgdGhhdCBvbiBydW50aW1lIHN1c3BlbmQgd2Ugb25seSBjYW5jZWwKICAqIHRoZSBm
ZW5jZXMsIHRvIGJlIHJlYWNxdWlyZWQgYnkgdGhlIHVzZXIgbGF0ZXIuCiAgKi8KLXZvaWQgaTkx
NV9nZW1fcmVzdG9yZV9mZW5jZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQor
dm9pZCBpOTE1X2dlbV9yZXN0b3JlX2ZlbmNlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKIHsKIAlpbnQgaTsKIAogCXJjdV9yZWFkX2xvY2soKTsgLyoga2VlcCBvYmogYWxpdmUgYXMg
d2UgZGVyZWZlcmVuY2UgKi8KLQlmb3IgKGkgPSAwOyBpIDwgZGV2X3ByaXYtPm51bV9mZW5jZV9y
ZWdzOyBpKyspIHsKLQkJc3RydWN0IGRybV9pOTE1X2ZlbmNlX3JlZyAqcmVnID0gJmRldl9wcml2
LT5mZW5jZV9yZWdzW2ldOworCWZvciAoaSA9IDA7IGkgPCBpOTE1LT5udW1fZmVuY2VfcmVnczsg
aSsrKSB7CisJCXN0cnVjdCBkcm1faTkxNV9mZW5jZV9yZWcgKnJlZyA9ICZpOTE1LT5mZW5jZV9y
ZWdzW2ldOwogCQlzdHJ1Y3QgaTkxNV92bWEgKnZtYSA9IFJFQURfT05DRShyZWctPnZtYSk7CiAK
IAkJR0VNX0JVR19PTih2bWEgJiYgdm1hLT5mZW5jZSAhPSByZWcpOwpAQCAtNTI1LDE4ICs1Mjks
MTkgQEAgdm9pZCBpOTE1X2dlbV9yZXN0b3JlX2ZlbmNlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCiAKIC8qKgogICogaTkxNV9nZW1fZGV0ZWN0X2JpdF82X3N3aXp6bGUgLSBk
ZXRlY3QgYml0IDYgc3dpenpsaW5nIHBhdHRlcm4KLSAqIEBkZXZfcHJpdjogaTkxNSBkZXZpY2Ug
cHJpdmF0ZQorICogQGk5MTU6IGk5MTUgZGV2aWNlIHByaXZhdGUKICAqCiAgKiBEZXRlY3RzIGJp
dCA2IHN3aXp6bGluZyBvZiBhZGRyZXNzIGxvb2t1cCBiZXR3ZWVuIElHRCBhY2Nlc3MgYW5kIENQ
VQogICogYWNjZXNzIHRocm91Z2ggbWFpbiBtZW1vcnkuCiAgKi8KIHZvaWQKLWk5MTVfZ2VtX2Rl
dGVjdF9iaXRfNl9zd2l6emxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK2k5
MTVfZ2VtX2RldGVjdF9iaXRfNl9zd2l6emxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQogeworCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9ICZpOTE1LT51bmNvcmU7CiAJdTMy
IHN3aXp6bGVfeCA9IEk5MTVfQklUXzZfU1dJWlpMRV9VTktOT1dOOwogCXUzMiBzd2l6emxlX3kg
PSBJOTE1X0JJVF82X1NXSVpaTEVfVU5LTk9XTjsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
ID49IDggfHwgSVNfVkFMTEVZVklFVyhkZXZfcHJpdikpIHsKKwlpZiAoSU5URUxfR0VOKGk5MTUp
ID49IDggfHwgSVNfVkFMTEVZVklFVyhpOTE1KSkgewogCQkvKgogCQkgKiBPbiBCRFcrLCBzd2l6
emxpbmcgaXMgbm90IHVzZWQuIFdlIGxlYXZlIHRoZSBDUFUgbWVtb3J5CiAJCSAqIGNvbnRyb2xs
ZXIgaW4gY2hhcmdlIG9mIG9wdGltaXppbmcgbWVtb3J5IGFjY2Vzc2VzIHdpdGhvdXQKQEAgLTU0
Niw5ICs1NTEsOSBAQCBpOTE1X2dlbV9kZXRlY3RfYml0XzZfc3dpenpsZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCSAqLwogCQlzd2l6emxlX3ggPSBJOTE1X0JJVF82X1NX
SVpaTEVfTk9ORTsKIAkJc3dpenpsZV95ID0gSTkxNV9CSVRfNl9TV0laWkxFX05PTkU7Ci0JfSBl
bHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDYpIHsKLQkJaWYgKGRldl9wcml2LT5wcmVz
ZXJ2ZV9iaW9zX3N3aXp6bGUpIHsKLQkJCWlmIChJOTE1X1JFQUQoRElTUF9BUkJfQ1RMKSAmCisJ
fSBlbHNlIGlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNikgeworCQlpZiAoaTkxNS0+cHJlc2VydmVf
Ymlvc19zd2l6emxlKSB7CisJCQlpZiAoaW50ZWxfdW5jb3JlX3JlYWQodW5jb3JlLCBESVNQX0FS
Ql9DVEwpICYKIAkJCSAgICBESVNQX1RJTEVfU1VSRkFDRV9TV0laWkxJTkcpIHsKIAkJCQlzd2l6
emxlX3ggPSBJOTE1X0JJVF82X1NXSVpaTEVfOV8xMDsKIAkJCQlzd2l6emxlX3kgPSBJOTE1X0JJ
VF82X1NXSVpaTEVfOTsKQEAgLTU1OCwxNSArNTYzLDE3IEBAIGk5MTVfZ2VtX2RldGVjdF9iaXRf
Nl9zd2l6emxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJCX0KIAkJfSBl
bHNlIHsKIAkJCXUzMiBkaW1tX2MwLCBkaW1tX2MxOwotCQkJZGltbV9jMCA9IEk5MTVfUkVBRChN
QURfRElNTV9DMCk7Ci0JCQlkaW1tX2MxID0gSTkxNV9SRUFEKE1BRF9ESU1NX0MxKTsKKwkJCWRp
bW1fYzAgPSBpbnRlbF91bmNvcmVfcmVhZCh1bmNvcmUsIE1BRF9ESU1NX0MwKTsKKwkJCWRpbW1f
YzEgPSBpbnRlbF91bmNvcmVfcmVhZCh1bmNvcmUsIE1BRF9ESU1NX0MxKTsKIAkJCWRpbW1fYzAg
Jj0gTUFEX0RJTU1fQV9TSVpFX01BU0sgfCBNQURfRElNTV9CX1NJWkVfTUFTSzsKIAkJCWRpbW1f
YzEgJj0gTUFEX0RJTU1fQV9TSVpFX01BU0sgfCBNQURfRElNTV9CX1NJWkVfTUFTSzsKLQkJCS8q
IEVuYWJsZSBzd2l6emxpbmcgd2hlbiB0aGUgY2hhbm5lbHMgYXJlIHBvcHVsYXRlZAorCQkJLyoK
KwkJCSAqIEVuYWJsZSBzd2l6emxpbmcgd2hlbiB0aGUgY2hhbm5lbHMgYXJlIHBvcHVsYXRlZAog
CQkJICogd2l0aCBpZGVudGljYWxseSBzaXplZCBkaW1tcy4gV2UgZG9uJ3QgbmVlZCB0byBjaGVj
awogCQkJICogdGhlIDNyZCBjaGFubmVsIGJlY2F1c2Ugbm8gY3B1IHdpdGggZ3B1IGF0dGFjaGVk
CiAJCQkgKiBzaGlwcyBpbiB0aGF0IGNvbmZpZ3VyYXRpb24uIEFsc28sIHN3aXp6bGluZyBvbmx5
Ci0JCQkgKiBtYWtlcyBzZW5zZSBmb3IgMiBjaGFubmVscyBhbnl3YXkuICovCisJCQkgKiBtYWtl
cyBzZW5zZSBmb3IgMiBjaGFubmVscyBhbnl3YXkuCisJCQkgKi8KIAkJCWlmIChkaW1tX2MwID09
IGRpbW1fYzEpIHsKIAkJCQlzd2l6emxlX3ggPSBJOTE1X0JJVF82X1NXSVpaTEVfOV8xMDsKIAkJ
CQlzd2l6emxlX3kgPSBJOTE1X0JJVF82X1NXSVpaTEVfOTsKQEAgLTU3NSwyMCArNTgyLDIzIEBA
IGk5MTVfZ2VtX2RldGVjdF9iaXRfNl9zd2l6emxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKIAkJCQlzd2l6emxlX3kgPSBJOTE1X0JJVF82X1NXSVpaTEVfTk9ORTsKIAkJCX0K
IAkJfQotCX0gZWxzZSBpZiAoSVNfR0VOKGRldl9wcml2LCA1KSkgewotCQkvKiBPbiBJcm9ubGFr
ZSB3aGF0ZXZlciBEUkFNIGNvbmZpZywgR1BVIGFsd2F5cyBkbworCX0gZWxzZSBpZiAoSVNfR0VO
KGk5MTUsIDUpKSB7CisJCS8qCisJCSAqIE9uIElyb25sYWtlIHdoYXRldmVyIERSQU0gY29uZmln
LCBHUFUgYWx3YXlzIGRvCiAJCSAqIHNhbWUgc3dpenpsaW5nIHNldHVwLgogCQkgKi8KIAkJc3dp
enpsZV94ID0gSTkxNV9CSVRfNl9TV0laWkxFXzlfMTA7CiAJCXN3aXp6bGVfeSA9IEk5MTVfQklU
XzZfU1dJWlpMRV85OwotCX0gZWxzZSBpZiAoSVNfR0VOKGRldl9wcml2LCAyKSkgewotCQkvKiBB
cyBmYXIgYXMgd2Uga25vdywgdGhlIDg2NSBkb2Vzbid0IGhhdmUgdGhlc2UgYml0IDYKKwl9IGVs
c2UgaWYgKElTX0dFTihpOTE1LCAyKSkgeworCQkvKgorCQkgKiBBcyBmYXIgYXMgd2Uga25vdywg
dGhlIDg2NSBkb2Vzbid0IGhhdmUgdGhlc2UgYml0IDYKIAkJICogc3dpenpsaW5nIGlzc3Vlcy4K
IAkJICovCiAJCXN3aXp6bGVfeCA9IEk5MTVfQklUXzZfU1dJWlpMRV9OT05FOwogCQlzd2l6emxl
X3kgPSBJOTE1X0JJVF82X1NXSVpaTEVfTk9ORTsKLQl9IGVsc2UgaWYgKElTX0c0NShkZXZfcHJp
dikgfHwgSVNfSTk2NUcoZGV2X3ByaXYpIHx8IElTX0czMyhkZXZfcHJpdikpIHsKLQkJLyogVGhl
IDk2NSwgRzMzLCBhbmQgbmV3ZXIsIGhhdmUgYSB2ZXJ5IGZsZXhpYmxlIG1lbW9yeQorCX0gZWxz
ZSBpZiAoSVNfRzQ1KGk5MTUpIHx8IElTX0k5NjVHKGk5MTUpIHx8IElTX0czMyhpOTE1KSkgewor
CQkvKgorCQkgKiBUaGUgOTY1LCBHMzMsIGFuZCBuZXdlciwgaGF2ZSBhIHZlcnkgZmxleGlibGUg
bWVtb3J5CiAJCSAqIGNvbmZpZ3VyYXRpb24uICBJdCB3aWxsIGVuYWJsZSBkdWFsLWNoYW5uZWwg
bW9kZQogCQkgKiAoaW50ZXJsZWF2aW5nKSBvbiBhcyBtdWNoIG1lbW9yeSBhcyBpdCBjYW4sIGFu
ZCB0aGUgR1BVCiAJCSAqIHdpbGwgYWRkaXRpb25hbGx5IHNvbWV0aW1lcyBlbmFibGUgZGlmZmVy
ZW50IGJpdCA2CkBAIC02MTQsMTQgKzYyNCwxNiBAQCBpOTE1X2dlbV9kZXRlY3RfYml0XzZfc3dp
enpsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCSAqIGJhbmtzIG9mIG1l
bW9yeSBhcmUgcGFpcmVkIGFuZCB1bnN3aXp6bGVkIG9uIHRoZQogCQkgKiB1bmV2ZW4gcG9ydGlv
biwgc28gbGVhdmUgdGhhdCBhcyB1bmtub3duLgogCQkgKi8KLQkJaWYgKEk5MTVfUkVBRDE2KEMw
RFJCMykgPT0gSTkxNV9SRUFEMTYoQzFEUkIzKSkgeworCQlpZiAoaW50ZWxfdW5jb3JlX3JlYWQo
dW5jb3JlLCBDMERSQjMpID09CisJCSAgICBpbnRlbF91bmNvcmVfcmVhZCh1bmNvcmUsIEMxRFJC
MykpIHsKIAkJCXN3aXp6bGVfeCA9IEk5MTVfQklUXzZfU1dJWlpMRV85XzEwOwogCQkJc3dpenps
ZV95ID0gSTkxNV9CSVRfNl9TV0laWkxFXzk7CiAJCX0KIAl9IGVsc2UgewotCQl1MzIgZGNjOwor
CQl1MzIgZGNjID0gaW50ZWxfdW5jb3JlX3JlYWQodW5jb3JlLCBEQ0MpOwogCi0JCS8qIE9uIDl4
eCBjaGlwc2V0cywgY2hhbm5lbCBpbnRlcmxlYXZlIGJ5IHRoZSBDUFUgaXMKKwkJLyoKKwkJICog
T24gOXh4IGNoaXBzZXRzLCBjaGFubmVsIGludGVybGVhdmUgYnkgdGhlIENQVSBpcwogCQkgKiBk
ZXRlcm1pbmVkIGJ5IERDQy4gIEZvciBzaW5nbGUtY2hhbm5lbCwgbmVpdGhlciB0aGUgQ1BVCiAJ
CSAqIG5vciB0aGUgR1BVIGRvIHN3aXp6bGluZy4gIEZvciBkdWFsIGNoYW5uZWwgaW50ZXJsZWF2
ZWQsCiAJCSAqIHRoZSBHUFUncyBpbnRlcmxlYXZlIGlzIGJpdCA5IGFuZCAxMCBmb3IgWCB0aWxl
ZCwgYW5kIGJpdApAQCAtNjI5LDcgKzY0MSw2IEBAIGk5MTVfZ2VtX2RldGVjdF9iaXRfNl9zd2l6
emxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJICogY2FuIGJlIGJhc2Vk
IG9uIGVpdGhlciBiaXQgMTEgKGhhdmVuJ3Qgc2VlbiB0aGlzIHlldCkgb3IKIAkJICogYml0IDE3
IChjb21tb24pLgogCQkgKi8KLQkJZGNjID0gSTkxNV9SRUFEKERDQyk7CiAJCXN3aXRjaCAoZGNj
ICYgRENDX0FERFJFU1NJTkdfTU9ERV9NQVNLKSB7CiAJCWNhc2UgRENDX0FERFJFU1NJTkdfTU9E
RV9TSU5HTEVfQ0hBTk5FTDoKIAkJY2FzZSBEQ0NfQUREUkVTU0lOR19NT0RFX0RVQUxfQ0hBTk5F
TF9BU1lNTUVUUklDOgpAQCAtNjM4LDcgKzY0OSw4IEBAIGk5MTVfZ2VtX2RldGVjdF9iaXRfNl9z
d2l6emxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJCWJyZWFrOwogCQlj
YXNlIERDQ19BRERSRVNTSU5HX01PREVfRFVBTF9DSEFOTkVMX0lOVEVSTEVBVkVEOgogCQkJaWYg
KGRjYyAmIERDQ19DSEFOTkVMX1hPUl9ESVNBQkxFKSB7Ci0JCQkJLyogVGhpcyBpcyB0aGUgYmFz
ZSBzd2l6emxpbmcgYnkgdGhlIEdQVSBmb3IKKwkJCQkvKgorCQkJCSAqIFRoaXMgaXMgdGhlIGJh
c2Ugc3dpenpsaW5nIGJ5IHRoZSBHUFUgZm9yCiAJCQkJICogdGlsZWQgYnVmZmVycy4KIAkJCQkg
Ki8KIAkJCQlzd2l6emxlX3ggPSBJOTE1X0JJVF82X1NXSVpaTEVfOV8xMDsKQEAgLTY1Niw4ICs2
NjgsOCBAQCBpOTE1X2dlbV9kZXRlY3RfYml0XzZfc3dpenpsZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCiAJCX0KIAogCQkvKiBjaGVjayBmb3IgTC1zaGFwZWQgbWVtb3J5IGFr
YSBtb2RpZmllZCBlbmhhbmNlZCBhZGRyZXNzaW5nICovCi0JCWlmIChJU19HRU4oZGV2X3ByaXYs
IDQpICYmCi0JCSAgICAhKEk5MTVfUkVBRChEQ0MyKSAmIERDQzJfTU9ESUZJRURfRU5IQU5DRURf
RElTQUJMRSkpIHsKKwkJaWYgKElTX0dFTihpOTE1LCA0KSAmJgorCQkgICAgIShpbnRlbF91bmNv
cmVfcmVhZCh1bmNvcmUsIERDQzIpICYgRENDMl9NT0RJRklFRF9FTkhBTkNFRF9ESVNBQkxFKSkg
ewogCQkJc3dpenpsZV94ID0gSTkxNV9CSVRfNl9TV0laWkxFX1VOS05PV047CiAJCQlzd2l6emxl
X3kgPSBJOTE1X0JJVF82X1NXSVpaTEVfVU5LTk9XTjsKIAkJfQpAQCAtNjcyLDcgKzY4NCw4IEBA
IGk5MTVfZ2VtX2RldGVjdF9iaXRfNl9zd2l6emxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKIAogCWlmIChzd2l6emxlX3ggPT0gSTkxNV9CSVRfNl9TV0laWkxFX1VOS05PV04g
fHwKIAkgICAgc3dpenpsZV95ID09IEk5MTVfQklUXzZfU1dJWlpMRV9VTktOT1dOKSB7Ci0JCS8q
IFVzZXJzcGFjZSBsaWtlcyB0byBleHBsb2RlIGlmIGl0IHNlZXMgdW5rbm93biBzd2l6emxpbmcs
CisJCS8qCisJCSAqIFVzZXJzcGFjZSBsaWtlcyB0byBleHBsb2RlIGlmIGl0IHNlZXMgdW5rbm93
biBzd2l6emxpbmcsCiAJCSAqIHNvIGxpZS4gV2Ugd2lsbCBmaW5pc2ggdGhlIGxpZSB3aGVuIHJl
cG9ydGluZyB0aHJvdWdoCiAJCSAqIHRoZSBnZXQtdGlsaW5nLWlvY3RsIGJ5IHJlcG9ydGluZyB0
aGUgcGh5c2ljYWwgc3dpenpsZQogCQkgKiBtb2RlIGFzIHVua25vd24gaW5zdGVhZC4KQEAgLTY4
MSwxMyArNjk0LDEzIEBAIGk5MTVfZ2VtX2RldGVjdF9iaXRfNl9zd2l6emxlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJICogYml0MTcgZGVwZW5kZW50LCBhbmQgc28gd2Ug
bmVlZCB0byBhbHNvIHByZXZlbnQgdGhlIHBhZ2VzCiAJCSAqIGZyb20gYmVpbmcgbW92ZWQuCiAJ
CSAqLwotCQlkZXZfcHJpdi0+cXVpcmtzIHw9IFFVSVJLX1BJTl9TV0laWkxFRF9QQUdFUzsKKwkJ
aTkxNS0+cXVpcmtzIHw9IFFVSVJLX1BJTl9TV0laWkxFRF9QQUdFUzsKIAkJc3dpenpsZV94ID0g
STkxNV9CSVRfNl9TV0laWkxFX05PTkU7CiAJCXN3aXp6bGVfeSA9IEk5MTVfQklUXzZfU1dJWlpM
RV9OT05FOwogCX0KIAotCWRldl9wcml2LT5tbS5iaXRfNl9zd2l6emxlX3ggPSBzd2l6emxlX3g7
Ci0JZGV2X3ByaXYtPm1tLmJpdF82X3N3aXp6bGVfeSA9IHN3aXp6bGVfeTsKKwlpOTE1LT5tbS5i
aXRfNl9zd2l6emxlX3ggPSBzd2l6emxlX3g7CisJaTkxNS0+bW0uYml0XzZfc3dpenpsZV95ID0g
c3dpenpsZV95OwogfQogCiAvKgotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBs
aXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1h
bi9saXN0aW5mby9pbnRlbC1nZng=

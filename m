Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id A6B0C97AD4
	for <lists+intel-gfx@lfdr.de>; Wed, 21 Aug 2019 15:32:31 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CEE466E3B8;
	Wed, 21 Aug 2019 13:32:26 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl
 [IPv6:2a02:2308::216:3eff:fe92:dfa3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AD6876E345
 for <intel-gfx@lists.freedesktop.org>; Wed, 21 Aug 2019 13:32:24 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 21 Aug 2019 15:32:14 +0200
Message-Id: <20190821133221.29456-4-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190821133221.29456-1-maarten.lankhorst@linux.intel.com>
References: <20190821133221.29456-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 03/10] drm/i915: Handle a few more cases for
 hw/sw split
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgYXJlIHN0aWxsIGxvb2tpbmcgYXQgZHJtX2NydGNfc3RhdGUgaW4gYSBmZXcgcGxhY2VzLCBj
b252ZXJ0IHRob3NlCnRvIHVzZSBpbnRlbF9jcnRjX3N0YXRlIGluc3RlYWQuIExvb2sgYXQgdWFw
aS9odyB3aGVyZSBhcHByb3ByaWF0ZS4KClNpZ25lZC1vZmYtYnk6IE1hYXJ0ZW4gTGFua2hvcnN0
IDxtYWFydGVuLmxhbmtob3JzdEBsaW51eC5pbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgfCAyMiArKysrKysrKysrLS0tLS0tLS0tLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9tc3QuYyAgfCAgMiArLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYyAgICAgfCAgNCArKy0tCiAzIGZp
bGVzIGNoYW5nZWQsIDE0IGluc2VydGlvbnMoKyksIDE0IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggYzZkN2UzMmFlNzBh
Li4zMWJlNzY3YmNhMzIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGlzcGxheS5jCkBAIC0xMTc1NCwxMCArMTE3NTQsMTAgQEAgc3RhdGljIGludCBpbnRlbF9jcnRj
X2F0b21pY19jaGVjayhzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJYm9vbCBtb2RlX2NoYW5nZWQg
PSBuZWVkc19tb2Rlc2V0KHBpcGVfY29uZmlnKTsKIAogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
IDwgNSAmJiAhSVNfRzRYKGRldl9wcml2KSAmJgotCSAgICBtb2RlX2NoYW5nZWQgJiYgIWNydGNf
c3RhdGUtPmFjdGl2ZSkKKwkgICAgbW9kZV9jaGFuZ2VkICYmICFwaXBlX2NvbmZpZy0+aHcuYWN0
aXZlKQogCQlwaXBlX2NvbmZpZy0+dXBkYXRlX3dtX3Bvc3QgPSB0cnVlOwogCi0JaWYgKG1vZGVf
Y2hhbmdlZCAmJiBjcnRjX3N0YXRlLT5lbmFibGUgJiYKKwlpZiAobW9kZV9jaGFuZ2VkICYmIHBp
cGVfY29uZmlnLT5ody5lbmFibGUgJiYKIAkgICAgZGV2X3ByaXYtPmRpc3BsYXkuY3J0Y19jb21w
dXRlX2Nsb2NrICYmCiAJICAgICFXQVJOX09OKHBpcGVfY29uZmlnLT5zaGFyZWRfZHBsbCkpIHsK
IAkJcmV0ID0gZGV2X3ByaXYtPmRpc3BsYXkuY3J0Y19jb21wdXRlX2Nsb2NrKGludGVsX2NydGMs
CkBAIC0xMTc3MSwxMCArMTE3NzEsMTAgQEAgc3RhdGljIGludCBpbnRlbF9jcnRjX2F0b21pY19j
aGVjayhzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiAJICogd2hlbiBDOCBwbGFuZXMgYXJlIGdldHRp
bmcgZW5hYmxlZC9kaXNhYmxlZC4KIAkgKi8KIAlpZiAoYzhfcGxhbmVzX2NoYW5nZWQocGlwZV9j
b25maWcpKQotCQljcnRjX3N0YXRlLT5jb2xvcl9tZ210X2NoYW5nZWQgPSB0cnVlOworCQlwaXBl
X2NvbmZpZy0+dWFwaS5jb2xvcl9tZ210X2NoYW5nZWQgPSB0cnVlOwogCiAJaWYgKG1vZGVfY2hh
bmdlZCB8fCBwaXBlX2NvbmZpZy0+dXBkYXRlX3BpcGUgfHwKLQkgICAgY3J0Y19zdGF0ZS0+Y29s
b3JfbWdtdF9jaGFuZ2VkKSB7CisJICAgIHBpcGVfY29uZmlnLT51YXBpLmNvbG9yX21nbXRfY2hh
bmdlZCkgewogCQlyZXQgPSBpbnRlbF9jb2xvcl9jaGVjayhwaXBlX2NvbmZpZyk7CiAJCWlmIChy
ZXQpCiAJCQlyZXR1cm4gcmV0OwpAQCAtMTYwNTEsOCArMTYwNTEsOCBAQCBzdGF0aWMgaW50IGlu
dGVsX2luaXRpYWxfY29tbWl0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiB7CiAJc3RydWN0IGRy
bV9hdG9taWNfc3RhdGUgKnN0YXRlID0gTlVMTDsKIAlzdHJ1Y3QgZHJtX21vZGVzZXRfYWNxdWly
ZV9jdHggY3R4OwotCXN0cnVjdCBkcm1fY3J0YyAqY3J0YzsKLQlzdHJ1Y3QgZHJtX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGU7CisJc3RydWN0IGludGVsX2NydGMgKmNydGM7CisJc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGU7CiAJaW50IHJldCA9IDA7CiAKIAlzdGF0ZSA9IGRybV9h
dG9taWNfc3RhdGVfYWxsb2MoZGV2KTsKQEAgLTE2MDY0LDE1ICsxNjA2NCwxNSBAQCBzdGF0aWMg
aW50IGludGVsX2luaXRpYWxfY29tbWl0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiByZXRyeToK
IAlzdGF0ZS0+YWNxdWlyZV9jdHggPSAmY3R4OwogCi0JZHJtX2Zvcl9lYWNoX2NydGMoY3J0Yywg
ZGV2KSB7Ci0JCWNydGNfc3RhdGUgPSBkcm1fYXRvbWljX2dldF9jcnRjX3N0YXRlKHN0YXRlLCBj
cnRjKTsKKwlmb3JfZWFjaF9pbnRlbF9jcnRjKGRldiwgY3J0YykgeworCQljcnRjX3N0YXRlID0g
aW50ZWxfYXRvbWljX2dldF9jcnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsKIAkJaWYgKElTX0VSUihj
cnRjX3N0YXRlKSkgewogCQkJcmV0ID0gUFRSX0VSUihjcnRjX3N0YXRlKTsKIAkJCWdvdG8gb3V0
OwogCQl9CiAKLQkJaWYgKGNydGNfc3RhdGUtPmFjdGl2ZSkgewotCQkJcmV0ID0gZHJtX2F0b21p
Y19hZGRfYWZmZWN0ZWRfcGxhbmVzKHN0YXRlLCBjcnRjKTsKKwkJaWYgKGNydGNfc3RhdGUtPmh3
LmFjdGl2ZSkgeworCQkJcmV0ID0gZHJtX2F0b21pY19hZGRfYWZmZWN0ZWRfcGxhbmVzKHN0YXRl
LCAmY3J0Yy0+YmFzZSk7CiAJCQlpZiAocmV0KQogCQkJCWdvdG8gb3V0OwogCkBAIC0xNjA4Miw3
ICsxNjA4Miw3IEBAIHN0YXRpYyBpbnQgaW50ZWxfaW5pdGlhbF9jb21taXQoc3RydWN0IGRybV9k
ZXZpY2UgKmRldikKIAkJCSAqIGhhdmluZyBhIHByb3BlciBMVVQgbG9hZGVkLiBSZW1vdmUgb25j
ZSB3ZQogCQkJICogaGF2ZSByZWFkb3V0IGZvciBwaXBlIGdhbW1hIGVuYWJsZS4KIAkJCSAqLwot
CQkJY3J0Y19zdGF0ZS0+Y29sb3JfbWdtdF9jaGFuZ2VkID0gdHJ1ZTsKKwkJCWNydGNfc3RhdGUt
PnVhcGkuY29sb3JfbWdtdF9jaGFuZ2VkID0gdHJ1ZTsKIAkJfQogCX0KIApkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9tc3QuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbXN0LmMKaW5kZXggNTBjNDgwYTNlNjYzLi43ODQ5
NmQwNDcwODYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZHBfbXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9tc3Qu
YwpAQCAtMTc5LDcgKzE3OSw3IEBAIGludGVsX2RwX21zdF9hdG9taWNfY2hlY2soc3RydWN0IGRy
bV9jb25uZWN0b3IgKmNvbm5lY3RvciwKIAogCQlpZiAoIWNydGNfc3RhdGUgfHwKIAkJICAgICFk
cm1fYXRvbWljX2NydGNfbmVlZHNfbW9kZXNldChjcnRjX3N0YXRlKSB8fAotCQkgICAgY3J0Y19z
dGF0ZS0+ZW5hYmxlKQorCQkgICAgdG9faW50ZWxfY3J0Y19zdGF0ZShjcnRjX3N0YXRlKS0+aHcu
ZW5hYmxlKQogCQkJcmV0dXJuIDA7CiAJfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX3Bzci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9wc3IuYwppbmRleCAzMjA3ZjQ4ZmZkNTQuLmJjNzc1YjFjZjRjZiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5jCkBAIC0xMDI1LDkgKzEwMjUsOSBAQCBzdGF0
aWMgaW50IGludGVsX3Bzcl9mYXN0c2V0X2ZvcmNlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKIAogCQlpbnRlbF9jcnRjX3N0YXRlID0gdG9faW50ZWxfY3J0Y19zdGF0ZShjcnRj
X3N0YXRlKTsKIAotCQlpZiAoY3J0Y19zdGF0ZS0+YWN0aXZlICYmIGludGVsX2NydGNfc3RhdGUt
Pmhhc19wc3IpIHsKKwkJaWYgKGludGVsX2NydGNfc3RhdGUtPmh3LmFjdGl2ZSAmJiBpbnRlbF9j
cnRjX3N0YXRlLT5oYXNfcHNyKSB7CiAJCQkvKiBNYXJrIG1vZGUgYXMgY2hhbmdlZCB0byB0cmln
Z2VyIGEgcGlwZS0+dXBkYXRlKCkgKi8KLQkJCWNydGNfc3RhdGUtPm1vZGVfY2hhbmdlZCA9IHRy
dWU7CisJCQlpbnRlbF9jcnRjX3N0YXRlLT51YXBpLm1vZGVfY2hhbmdlZCA9IHRydWU7CiAJCQli
cmVhazsKIAkJfQogCX0KLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlz
dGluZm8vaW50ZWwtZ2Z4

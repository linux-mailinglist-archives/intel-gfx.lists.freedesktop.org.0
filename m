Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 598EC31DDDE
	for <lists+intel-gfx@lfdr.de>; Wed, 17 Feb 2021 18:04:35 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id AC4FE6E59D;
	Wed, 17 Feb 2021 17:04:33 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 46AB26E59D
 for <intel-gfx@lists.freedesktop.org>; Wed, 17 Feb 2021 17:04:32 +0000 (UTC)
IronPort-SDR: 0jWe+XOkePGq+V28qsiki7lEel8mR3lKfpJlRD325EadMAVfWbvPUWNOsEayz0l9xRuU8q6+7W
 6WvfiXNCFOTw==
X-IronPort-AV: E=McAfee;i="6000,8403,9898"; a="247322953"
X-IronPort-AV: E=Sophos;i="5.81,184,1610438400"; d="scan'208";a="247322953"
Received: from fmsmga008.fm.intel.com ([10.253.24.58])
 by orsmga105.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 17 Feb 2021 09:03:57 -0800
IronPort-SDR: M2ZiBU2CEqjXTwGkwQijW/2N/ZqtD2OEF2WQ4IpU44CfG9pLxQ3Ednx2Cb7OvIRlS12a1sX61t
 vMdzD3/sLw/g==
X-IronPort-AV: E=Sophos;i="5.81,184,1610438400"; d="scan'208";a="385260641"
Received: from mvalka-mobl1.ger.corp.intel.com (HELO localhost)
 ([10.252.39.140])
 by fmsmga008-auth.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 17 Feb 2021 09:03:54 -0800
From: Jani Nikula <jani.nikula@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 17 Feb 2021 19:03:31 +0200
Message-Id: <d0ff0662285d317d5c10d433a46f6dab2bbedf64.1613580193.git.jani.nikula@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <cover.1613580193.git.jani.nikula@intel.com>
References: <cover.1613580193.git.jani.nikula@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 01/12] drm/i915/bios: mass convert dev_priv to
 i915
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com, Lucas De Marchi <lucas.demarchi@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGltZSB0byBqdXN0IHlhbmsgb3V0IHRoZSBiYW5kYWdlLiBObyBmdW5jdGlvbmFsIGNoYW5nZXMu
CgpDYzogTHVjYXMgRGUgTWFyY2hpIDxsdWNhcy5kZW1hcmNoaUBpbnRlbC5jb20+CkNjOiBWaWxs
ZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5
OiBKYW5pIE5pa3VsYSA8amFuaS5uaWt1bGFAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfYmlvcy5jIHwgNzY2ICsrKysrKysrKysrLS0tLS0tLS0tLS0K
IDEgZmlsZSBjaGFuZ2VkLCAzODMgaW5zZXJ0aW9ucygrKSwgMzgzIGRlbGV0aW9ucygtKQoKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYmlvcy5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9iaW9zLmMKaW5kZXggNzkwMmQ0YzI2NzNl
Li44MDJjMjI4YjI5NDAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfYmlvcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYmlv
cy5jCkBAIC0yMTEsNyArMjExLDcgQEAgZ2V0X2x2ZHNfZnBfdGltaW5nKGNvbnN0IHN0cnVjdCBi
ZGJfaGVhZGVyICpiZGIsCiAKIC8qIFBhcnNlIGdlbmVyYWwgcGFuZWwgb3B0aW9ucyAqLwogc3Rh
dGljIHZvaWQKLXBhcnNlX3BhbmVsX29wdGlvbnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAorcGFyc2VfcGFuZWxfb3B0aW9ucyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKIAkJICAgIGNvbnN0IHN0cnVjdCBiZGJfaGVhZGVyICpiZGIpCiB7CiAJY29uc3Qgc3RydWN0
IGJkYl9sdmRzX29wdGlvbnMgKmx2ZHNfb3B0aW9uczsKQEAgLTIyMywyNyArMjIzLDI3IEBAIHBh
cnNlX3BhbmVsX29wdGlvbnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCWlm
ICghbHZkc19vcHRpb25zKQogCQlyZXR1cm47CiAKLQlkZXZfcHJpdi0+dmJ0Lmx2ZHNfZGl0aGVy
ID0gbHZkc19vcHRpb25zLT5waXhlbF9kaXRoZXI7CisJaTkxNS0+dmJ0Lmx2ZHNfZGl0aGVyID0g
bHZkc19vcHRpb25zLT5waXhlbF9kaXRoZXI7CiAKLQlyZXQgPSBpbnRlbF9vcHJlZ2lvbl9nZXRf
cGFuZWxfdHlwZShkZXZfcHJpdik7CisJcmV0ID0gaW50ZWxfb3ByZWdpb25fZ2V0X3BhbmVsX3R5
cGUoaTkxNSk7CiAJaWYgKHJldCA+PSAwKSB7Ci0JCWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJt
LCByZXQgPiAweGYpOworCQlkcm1fV0FSTl9PTigmaTkxNS0+ZHJtLCByZXQgPiAweGYpOwogCQlw
YW5lbF90eXBlID0gcmV0OwotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgIlBhbmVsIHR5
cGU6ICVkIChPcFJlZ2lvbilcbiIsCisJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sICJQYW5lbCB0
eXBlOiAlZCAoT3BSZWdpb24pXG4iLAogCQkJICAgIHBhbmVsX3R5cGUpOwogCX0gZWxzZSB7CiAJ
CWlmIChsdmRzX29wdGlvbnMtPnBhbmVsX3R5cGUgPiAweGYpIHsKLQkJCWRybV9kYmdfa21zKCZk
ZXZfcHJpdi0+ZHJtLAorCQkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKIAkJCQkgICAgIkludmFs
aWQgVkJUIHBhbmVsIHR5cGUgMHgleFxuIiwKIAkJCQkgICAgbHZkc19vcHRpb25zLT5wYW5lbF90
eXBlKTsKIAkJCXJldHVybjsKIAkJfQogCQlwYW5lbF90eXBlID0gbHZkc19vcHRpb25zLT5wYW5l
bF90eXBlOwotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgIlBhbmVsIHR5cGU6ICVkIChW
QlQpXG4iLAorCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLCAiUGFuZWwgdHlwZTogJWQgKFZCVClc
biIsCiAJCQkgICAgcGFuZWxfdHlwZSk7CiAJfQogCi0JZGV2X3ByaXYtPnZidC5wYW5lbF90eXBl
ID0gcGFuZWxfdHlwZTsKKwlpOTE1LT52YnQucGFuZWxfdHlwZSA9IHBhbmVsX3R5cGU7CiAKIAlk
cnJzX21vZGUgPSAobHZkc19vcHRpb25zLT5kcHNfcGFuZWxfdHlwZV9iaXRzCiAJCQkJPj4gKHBh
bmVsX3R5cGUgKiAyKSkgJiBNT0RFX01BU0s7CkBAIC0yNTQsMTcgKzI1NCwxNyBAQCBwYXJzZV9w
YW5lbF9vcHRpb25zKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkgKi8KIAlz
d2l0Y2ggKGRycnNfbW9kZSkgewogCWNhc2UgMDoKLQkJZGV2X3ByaXYtPnZidC5kcnJzX3R5cGUg
PSBTVEFUSUNfRFJSU19TVVBQT1JUOwotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgIkRS
UlMgc3VwcG9ydGVkIG1vZGUgaXMgc3RhdGljXG4iKTsKKwkJaTkxNS0+dmJ0LmRycnNfdHlwZSA9
IFNUQVRJQ19EUlJTX1NVUFBPUlQ7CisJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sICJEUlJTIHN1
cHBvcnRlZCBtb2RlIGlzIHN0YXRpY1xuIik7CiAJCWJyZWFrOwogCWNhc2UgMjoKLQkJZGV2X3By
aXYtPnZidC5kcnJzX3R5cGUgPSBTRUFNTEVTU19EUlJTX1NVUFBPUlQ7Ci0JCWRybV9kYmdfa21z
KCZkZXZfcHJpdi0+ZHJtLAorCQlpOTE1LT52YnQuZHJyc190eXBlID0gU0VBTUxFU1NfRFJSU19T
VVBQT1JUOworCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAogCQkJICAgICJEUlJTIHN1cHBvcnRl
ZCBtb2RlIGlzIHNlYW1sZXNzXG4iKTsKIAkJYnJlYWs7CiAJZGVmYXVsdDoKLQkJZGV2X3ByaXYt
PnZidC5kcnJzX3R5cGUgPSBEUlJTX05PVF9TVVBQT1JURUQ7Ci0JCWRybV9kYmdfa21zKCZkZXZf
cHJpdi0+ZHJtLAorCQlpOTE1LT52YnQuZHJyc190eXBlID0gRFJSU19OT1RfU1VQUE9SVEVEOwor
CQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAogCQkJICAgICJEUlJTIG5vdCBzdXBwb3J0ZWQgKFZC
VCBpbnB1dClcbiIpOwogCQlicmVhazsKIAl9CkBAIC0yNzIsNyArMjcyLDcgQEAgcGFyc2VfcGFu
ZWxfb3B0aW9ucyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAKIC8qIFRyeSB0
byBmaW5kIGludGVncmF0ZWQgcGFuZWwgdGltaW5nIGRhdGEgKi8KIHN0YXRpYyB2b2lkCi1wYXJz
ZV9sZnBfcGFuZWxfZHRkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3BhcnNl
X2xmcF9wYW5lbF9kdGQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCSAgICBjb25z
dCBzdHJ1Y3QgYmRiX2hlYWRlciAqYmRiKQogewogCWNvbnN0IHN0cnVjdCBiZGJfbHZkc19sZnBf
ZGF0YSAqbHZkc19sZnBfZGF0YTsKQEAgLTI4MCw3ICsyODAsNyBAQCBwYXJzZV9sZnBfcGFuZWxf
ZHRkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAljb25zdCBzdHJ1Y3QgbHZk
c19kdm9fdGltaW5nICpwYW5lbF9kdm9fdGltaW5nOwogCWNvbnN0IHN0cnVjdCBsdmRzX2ZwX3Rp
bWluZyAqZnBfdGltaW5nOwogCXN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICpwYW5lbF9maXhlZF9t
b2RlOwotCWludCBwYW5lbF90eXBlID0gZGV2X3ByaXYtPnZidC5wYW5lbF90eXBlOworCWludCBw
YW5lbF90eXBlID0gaTkxNS0+dmJ0LnBhbmVsX3R5cGU7CiAKIAlsdmRzX2xmcF9kYXRhID0gZmlu
ZF9zZWN0aW9uKGJkYiwgQkRCX0xWRFNfTEZQX0RBVEEpOwogCWlmICghbHZkc19sZnBfZGF0YSkK
QEAgLTMwMCw5ICszMDAsOSBAQCBwYXJzZV9sZnBfcGFuZWxfZHRkKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKIAogCWZpbGxfZGV0YWlsX3RpbWluZ19kYXRhKHBhbmVsX2ZpeGVk
X21vZGUsIHBhbmVsX2R2b190aW1pbmcpOwogCi0JZGV2X3ByaXYtPnZidC5sZnBfbHZkc192YnRf
bW9kZSA9IHBhbmVsX2ZpeGVkX21vZGU7CisJaTkxNS0+dmJ0LmxmcF9sdmRzX3ZidF9tb2RlID0g
cGFuZWxfZml4ZWRfbW9kZTsKIAotCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCWRybV9k
Ymdfa21zKCZpOTE1LT5kcm0sCiAJCSAgICAiRm91bmQgcGFuZWwgbW9kZSBpbiBCSU9TIFZCVCBs
ZWdhY3kgbGZwIHRhYmxlOlxuIik7CiAJZHJtX21vZGVfZGVidWdfcHJpbnRtb2RlbGluZShwYW5l
bF9maXhlZF9tb2RlKTsKIApAQCAtMzEzLDE2ICszMTMsMTYgQEAgcGFyc2VfbGZwX3BhbmVsX2R0
ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCS8qIGNoZWNrIHRoZSByZXNv
bHV0aW9uLCBqdXN0IHRvIGJlIHN1cmUgKi8KIAkJaWYgKGZwX3RpbWluZy0+eF9yZXMgPT0gcGFu
ZWxfZml4ZWRfbW9kZS0+aGRpc3BsYXkgJiYKIAkJICAgIGZwX3RpbWluZy0+eV9yZXMgPT0gcGFu
ZWxfZml4ZWRfbW9kZS0+dmRpc3BsYXkpIHsKLQkJCWRldl9wcml2LT52YnQuYmlvc19sdmRzX3Zh
bCA9IGZwX3RpbWluZy0+bHZkc19yZWdfdmFsOwotCQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5k
cm0sCisJCQlpOTE1LT52YnQuYmlvc19sdmRzX3ZhbCA9IGZwX3RpbWluZy0+bHZkc19yZWdfdmFs
OworCQkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKIAkJCQkgICAgIlZCVCBpbml0aWFsIExWRFMg
dmFsdWUgJXhcbiIsCi0JCQkJICAgIGRldl9wcml2LT52YnQuYmlvc19sdmRzX3ZhbCk7CisJCQkJ
ICAgIGk5MTUtPnZidC5iaW9zX2x2ZHNfdmFsKTsKIAkJfQogCX0KIH0KIAogc3RhdGljIHZvaWQK
LXBhcnNlX2dlbmVyaWNfZHRkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3Bh
cnNlX2dlbmVyaWNfZHRkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkgIGNvbnN0
IHN0cnVjdCBiZGJfaGVhZGVyICpiZGIpCiB7CiAJY29uc3Qgc3RydWN0IGJkYl9nZW5lcmljX2R0
ZCAqZ2VuZXJpY19kdGQ7CkBAIC0zMzUsMjYgKzMzNSwyNiBAQCBwYXJzZV9nZW5lcmljX2R0ZChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCXJldHVybjsKIAogCWlmIChnZW5l
cmljX2R0ZC0+Z2R0ZF9zaXplIDwgc2l6ZW9mKHN0cnVjdCBnZW5lcmljX2R0ZF9lbnRyeSkpIHsK
LQkJZHJtX2VycigmZGV2X3ByaXYtPmRybSwgIkdEVEQgc2l6ZSAldSBpcyB0b28gc21hbGwuXG4i
LAorCQlkcm1fZXJyKCZpOTE1LT5kcm0sICJHRFREIHNpemUgJXUgaXMgdG9vIHNtYWxsLlxuIiwK
IAkJCWdlbmVyaWNfZHRkLT5nZHRkX3NpemUpOwogCQlyZXR1cm47CiAJfSBlbHNlIGlmIChnZW5l
cmljX2R0ZC0+Z2R0ZF9zaXplICE9CiAJCSAgIHNpemVvZihzdHJ1Y3QgZ2VuZXJpY19kdGRfZW50
cnkpKSB7Ci0JCWRybV9lcnIoJmRldl9wcml2LT5kcm0sICJVbmV4cGVjdGVkIEdEVEQgc2l6ZSAl
dVxuIiwKKwkJZHJtX2VycigmaTkxNS0+ZHJtLCAiVW5leHBlY3RlZCBHRFREIHNpemUgJXVcbiIs
CiAJCQlnZW5lcmljX2R0ZC0+Z2R0ZF9zaXplKTsKIAkJLyogRFREIGhhcyB1bmtub3duIGZpZWxk
cywgYnV0IGtlZXAgZ29pbmcgKi8KIAl9CiAKIAludW1fZHRkID0gKGdldF9ibG9ja3NpemUoZ2Vu
ZXJpY19kdGQpIC0KIAkJICAgc2l6ZW9mKHN0cnVjdCBiZGJfZ2VuZXJpY19kdGQpKSAvIGdlbmVy
aWNfZHRkLT5nZHRkX3NpemU7Ci0JaWYgKGRldl9wcml2LT52YnQucGFuZWxfdHlwZSA+PSBudW1f
ZHRkKSB7Ci0JCWRybV9lcnIoJmRldl9wcml2LT5kcm0sCisJaWYgKGk5MTUtPnZidC5wYW5lbF90
eXBlID49IG51bV9kdGQpIHsKKwkJZHJtX2VycigmaTkxNS0+ZHJtLAogCQkJIlBhbmVsIHR5cGUg
JWQgbm90IGZvdW5kIGluIHRhYmxlIG9mICVkIERURCdzXG4iLAotCQkJZGV2X3ByaXYtPnZidC5w
YW5lbF90eXBlLCBudW1fZHRkKTsKKwkJCWk5MTUtPnZidC5wYW5lbF90eXBlLCBudW1fZHRkKTsK
IAkJcmV0dXJuOwogCX0KIAotCWR0ZCA9ICZnZW5lcmljX2R0ZC0+ZHRkW2Rldl9wcml2LT52YnQu
cGFuZWxfdHlwZV07CisJZHRkID0gJmdlbmVyaWNfZHRkLT5kdGRbaTkxNS0+dmJ0LnBhbmVsX3R5
cGVdOwogCiAJcGFuZWxfZml4ZWRfbW9kZSA9IGt6YWxsb2Moc2l6ZW9mKCpwYW5lbF9maXhlZF9t
b2RlKSwgR0ZQX0tFUk5FTCk7CiAJaWYgKCFwYW5lbF9maXhlZF9tb2RlKQpAQCAtMzkzLDE1ICsz
OTMsMTUgQEAgcGFyc2VfZ2VuZXJpY19kdGQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAogCWVsc2UKIAkJcGFuZWxfZml4ZWRfbW9kZS0+ZmxhZ3MgfD0gRFJNX01PREVfRkxBR19O
VlNZTkM7CiAKLQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwlkcm1fZGJnX2ttcygmaTkx
NS0+ZHJtLAogCQkgICAgIkZvdW5kIHBhbmVsIG1vZGUgaW4gQklPUyBWQlQgZ2VuZXJpYyBkdGQg
dGFibGU6XG4iKTsKIAlkcm1fbW9kZV9kZWJ1Z19wcmludG1vZGVsaW5lKHBhbmVsX2ZpeGVkX21v
ZGUpOwogCi0JZGV2X3ByaXYtPnZidC5sZnBfbHZkc192YnRfbW9kZSA9IHBhbmVsX2ZpeGVkX21v
ZGU7CisJaTkxNS0+dmJ0LmxmcF9sdmRzX3ZidF9tb2RlID0gcGFuZWxfZml4ZWRfbW9kZTsKIH0K
IAogc3RhdGljIHZvaWQKLXBhcnNlX3BhbmVsX2R0ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCitwYXJzZV9wYW5lbF9kdGQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CiAJCWNvbnN0IHN0cnVjdCBiZGJfaGVhZGVyICpiZGIpCiB7CiAJLyoKQEAgLTQxMywxOCArNDEz
LDE4IEBAIHBhcnNlX3BhbmVsX2R0ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CiAJICogYmFjayB0byB0cnlpbmcgdGhlIG9sZCBMRlAgYmxvY2sgaWYgdGhhdCBmYWlscy4KIAkg
Ki8KIAlpZiAoYmRiLT52ZXJzaW9uID49IDIyOSkKLQkJcGFyc2VfZ2VuZXJpY19kdGQoZGV2X3By
aXYsIGJkYik7Ci0JaWYgKCFkZXZfcHJpdi0+dmJ0LmxmcF9sdmRzX3ZidF9tb2RlKQotCQlwYXJz
ZV9sZnBfcGFuZWxfZHRkKGRldl9wcml2LCBiZGIpOworCQlwYXJzZV9nZW5lcmljX2R0ZChpOTE1
LCBiZGIpOworCWlmICghaTkxNS0+dmJ0LmxmcF9sdmRzX3ZidF9tb2RlKQorCQlwYXJzZV9sZnBf
cGFuZWxfZHRkKGk5MTUsIGJkYik7CiB9CiAKIHN0YXRpYyB2b2lkCi1wYXJzZV9sZnBfYmFja2xp
Z2h0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3BhcnNlX2xmcF9iYWNrbGln
aHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCSAgICBjb25zdCBzdHJ1Y3QgYmRi
X2hlYWRlciAqYmRiKQogewogCWNvbnN0IHN0cnVjdCBiZGJfbGZwX2JhY2tsaWdodF9kYXRhICpi
YWNrbGlnaHRfZGF0YTsKIAljb25zdCBzdHJ1Y3QgbGZwX2JhY2tsaWdodF9kYXRhX2VudHJ5ICpl
bnRyeTsKLQlpbnQgcGFuZWxfdHlwZSA9IGRldl9wcml2LT52YnQucGFuZWxfdHlwZTsKKwlpbnQg
cGFuZWxfdHlwZSA9IGk5MTUtPnZidC5wYW5lbF90eXBlOwogCXUxNiBsZXZlbDsKIAogCWJhY2ts
aWdodF9kYXRhID0gZmluZF9zZWN0aW9uKGJkYiwgQkRCX0xWRFNfQkFDS0xJR0hUKTsKQEAgLTQz
Miw3ICs0MzIsNyBAQCBwYXJzZV9sZnBfYmFja2xpZ2h0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIAkJcmV0dXJuOwogCiAJaWYgKGJhY2tsaWdodF9kYXRhLT5lbnRyeV9zaXpl
ICE9IHNpemVvZihiYWNrbGlnaHRfZGF0YS0+ZGF0YVswXSkpIHsKLQkJZHJtX2RiZ19rbXMoJmRl
dl9wcml2LT5kcm0sCisJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCiAJCQkgICAgIlVuc3VwcG9y
dGVkIGJhY2tsaWdodCBkYXRhIGVudHJ5IHNpemUgJXVcbiIsCiAJCQkgICAgYmFja2xpZ2h0X2Rh
dGEtPmVudHJ5X3NpemUpOwogCQlyZXR1cm47CkBAIC00NDAsMjYgKzQ0MCwyNiBAQCBwYXJzZV9s
ZnBfYmFja2xpZ2h0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAogCWVudHJ5
ID0gJmJhY2tsaWdodF9kYXRhLT5kYXRhW3BhbmVsX3R5cGVdOwogCi0JZGV2X3ByaXYtPnZidC5i
YWNrbGlnaHQucHJlc2VudCA9IGVudHJ5LT50eXBlID09IEJEQl9CQUNLTElHSFRfVFlQRV9QV007
Ci0JaWYgKCFkZXZfcHJpdi0+dmJ0LmJhY2tsaWdodC5wcmVzZW50KSB7Ci0JCWRybV9kYmdfa21z
KCZkZXZfcHJpdi0+ZHJtLAorCWk5MTUtPnZidC5iYWNrbGlnaHQucHJlc2VudCA9IGVudHJ5LT50
eXBlID09IEJEQl9CQUNLTElHSFRfVFlQRV9QV007CisJaWYgKCFpOTE1LT52YnQuYmFja2xpZ2h0
LnByZXNlbnQpIHsKKwkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKIAkJCSAgICAiUFdNIGJhY2ts
aWdodCBub3QgcHJlc2VudCBpbiBWQlQgKHR5cGUgJXUpXG4iLAogCQkJICAgIGVudHJ5LT50eXBl
KTsKIAkJcmV0dXJuOwogCX0KIAotCWRldl9wcml2LT52YnQuYmFja2xpZ2h0LnR5cGUgPSBJTlRF
TF9CQUNLTElHSFRfRElTUExBWV9EREk7CisJaTkxNS0+dmJ0LmJhY2tsaWdodC50eXBlID0gSU5U
RUxfQkFDS0xJR0hUX0RJU1BMQVlfRERJOwogCWlmIChiZGItPnZlcnNpb24gPj0gMTkxICYmCiAJ
ICAgIGdldF9ibG9ja3NpemUoYmFja2xpZ2h0X2RhdGEpID49IHNpemVvZigqYmFja2xpZ2h0X2Rh
dGEpKSB7CiAJCWNvbnN0IHN0cnVjdCBsZnBfYmFja2xpZ2h0X2NvbnRyb2xfbWV0aG9kICptZXRo
b2Q7CiAKIAkJbWV0aG9kID0gJmJhY2tsaWdodF9kYXRhLT5iYWNrbGlnaHRfY29udHJvbFtwYW5l
bF90eXBlXTsKLQkJZGV2X3ByaXYtPnZidC5iYWNrbGlnaHQudHlwZSA9IG1ldGhvZC0+dHlwZTsK
LQkJZGV2X3ByaXYtPnZidC5iYWNrbGlnaHQuY29udHJvbGxlciA9IG1ldGhvZC0+Y29udHJvbGxl
cjsKKwkJaTkxNS0+dmJ0LmJhY2tsaWdodC50eXBlID0gbWV0aG9kLT50eXBlOworCQlpOTE1LT52
YnQuYmFja2xpZ2h0LmNvbnRyb2xsZXIgPSBtZXRob2QtPmNvbnRyb2xsZXI7CiAJfQogCi0JZGV2
X3ByaXYtPnZidC5iYWNrbGlnaHQucHdtX2ZyZXFfaHogPSBlbnRyeS0+cHdtX2ZyZXFfaHo7Ci0J
ZGV2X3ByaXYtPnZidC5iYWNrbGlnaHQuYWN0aXZlX2xvd19wd20gPSBlbnRyeS0+YWN0aXZlX2xv
d19wd207CisJaTkxNS0+dmJ0LmJhY2tsaWdodC5wd21fZnJlcV9oeiA9IGVudHJ5LT5wd21fZnJl
cV9oejsKKwlpOTE1LT52YnQuYmFja2xpZ2h0LmFjdGl2ZV9sb3dfcHdtID0gZW50cnktPmFjdGl2
ZV9sb3dfcHdtOwogCiAJaWYgKGJkYi0+dmVyc2lvbiA+PSAyMzQpIHsKIAkJdTE2IG1pbl9sZXZl
bDsKQEAgLTQ3NywzNyArNDc3LDM3IEBAIHBhcnNlX2xmcF9iYWNrbGlnaHQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkJbWluX2xldmVsID0gbWluX2xldmVsIC8gMjU1Owog
CiAJCWlmIChtaW5fbGV2ZWwgPiAyNTUpIHsKLQkJCWRybV93YXJuKCZkZXZfcHJpdi0+ZHJtLCAi
QnJpZ2h0bmVzcyBtaW4gbGV2ZWwgPiAyNTVcbiIpOworCQkJZHJtX3dhcm4oJmk5MTUtPmRybSwg
IkJyaWdodG5lc3MgbWluIGxldmVsID4gMjU1XG4iKTsKIAkJCWxldmVsID0gMjU1OwogCQl9Ci0J
CWRldl9wcml2LT52YnQuYmFja2xpZ2h0Lm1pbl9icmlnaHRuZXNzID0gbWluX2xldmVsOworCQlp
OTE1LT52YnQuYmFja2xpZ2h0Lm1pbl9icmlnaHRuZXNzID0gbWluX2xldmVsOwogCX0gZWxzZSB7
CiAJCWxldmVsID0gYmFja2xpZ2h0X2RhdGEtPmxldmVsW3BhbmVsX3R5cGVdOwotCQlkZXZfcHJp
di0+dmJ0LmJhY2tsaWdodC5taW5fYnJpZ2h0bmVzcyA9IGVudHJ5LT5taW5fYnJpZ2h0bmVzczsK
KwkJaTkxNS0+dmJ0LmJhY2tsaWdodC5taW5fYnJpZ2h0bmVzcyA9IGVudHJ5LT5taW5fYnJpZ2h0
bmVzczsKIAl9CiAKLQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwlkcm1fZGJnX2ttcygm
aTkxNS0+ZHJtLAogCQkgICAgIlZCVCBiYWNrbGlnaHQgUFdNIG1vZHVsYXRpb24gZnJlcXVlbmN5
ICV1IEh6LCAiCiAJCSAgICAiYWN0aXZlICVzLCBtaW4gYnJpZ2h0bmVzcyAldSwgbGV2ZWwgJXUs
IGNvbnRyb2xsZXIgJXVcbiIsCi0JCSAgICBkZXZfcHJpdi0+dmJ0LmJhY2tsaWdodC5wd21fZnJl
cV9oeiwKLQkJICAgIGRldl9wcml2LT52YnQuYmFja2xpZ2h0LmFjdGl2ZV9sb3dfcHdtID8gImxv
dyIgOiAiaGlnaCIsCi0JCSAgICBkZXZfcHJpdi0+dmJ0LmJhY2tsaWdodC5taW5fYnJpZ2h0bmVz
cywKKwkJICAgIGk5MTUtPnZidC5iYWNrbGlnaHQucHdtX2ZyZXFfaHosCisJCSAgICBpOTE1LT52
YnQuYmFja2xpZ2h0LmFjdGl2ZV9sb3dfcHdtID8gImxvdyIgOiAiaGlnaCIsCisJCSAgICBpOTE1
LT52YnQuYmFja2xpZ2h0Lm1pbl9icmlnaHRuZXNzLAogCQkgICAgbGV2ZWwsCi0JCSAgICBkZXZf
cHJpdi0+dmJ0LmJhY2tsaWdodC5jb250cm9sbGVyKTsKKwkJICAgIGk5MTUtPnZidC5iYWNrbGln
aHQuY29udHJvbGxlcik7CiB9CiAKIC8qIFRyeSB0byBmaW5kIHNkdm8gcGFuZWwgZGF0YSAqLwog
c3RhdGljIHZvaWQKLXBhcnNlX3Nkdm9fcGFuZWxfZGF0YShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCitwYXJzZV9zZHZvX3BhbmVsX2RhdGEoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCiAJCSAgICAgIGNvbnN0IHN0cnVjdCBiZGJfaGVhZGVyICpiZGIpCiB7CiAJY29u
c3Qgc3RydWN0IGJkYl9zZHZvX3BhbmVsX2R0ZHMgKmR0ZHM7CiAJc3RydWN0IGRybV9kaXNwbGF5
X21vZGUgKnBhbmVsX2ZpeGVkX21vZGU7CiAJaW50IGluZGV4OwogCi0JaW5kZXggPSBkZXZfcHJp
di0+cGFyYW1zLnZidF9zZHZvX3BhbmVsX3R5cGU7CisJaW5kZXggPSBpOTE1LT5wYXJhbXMudmJ0
X3Nkdm9fcGFuZWxfdHlwZTsKIAlpZiAoaW5kZXggPT0gLTIpIHsKLQkJZHJtX2RiZ19rbXMoJmRl
dl9wcml2LT5kcm0sCisJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCiAJCQkgICAgIklnbm9yZSBT
RFZPIHBhbmVsIG1vZGUgZnJvbSBCSU9TIFZCVCB0YWJsZXMuXG4iKTsKIAkJcmV0dXJuOwogCX0K
QEAgLTUzMiwxNyArNTMyLDE3IEBAIHBhcnNlX3Nkdm9fcGFuZWxfZGF0YShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAKIAlmaWxsX2RldGFpbF90aW1pbmdfZGF0YShwYW5lbF9m
aXhlZF9tb2RlLCAmZHRkcy0+ZHRkc1tpbmRleF0pOwogCi0JZGV2X3ByaXYtPnZidC5zZHZvX2x2
ZHNfdmJ0X21vZGUgPSBwYW5lbF9maXhlZF9tb2RlOworCWk5MTUtPnZidC5zZHZvX2x2ZHNfdmJ0
X21vZGUgPSBwYW5lbF9maXhlZF9tb2RlOwogCi0JZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0s
CisJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKIAkJICAgICJGb3VuZCBTRFZPIHBhbmVsIG1vZGUg
aW4gQklPUyBWQlQgdGFibGVzOlxuIik7CiAJZHJtX21vZGVfZGVidWdfcHJpbnRtb2RlbGluZShw
YW5lbF9maXhlZF9tb2RlKTsKIH0KIAotc3RhdGljIGludCBpbnRlbF9iaW9zX3NzY19mcmVxdWVu
Y3koc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIGludCBpbnRlbF9i
aW9zX3NzY19mcmVxdWVuY3koc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAg
IGJvb2wgYWx0ZXJuYXRlKQogewotCXN3aXRjaCAoSU5URUxfR0VOKGRldl9wcml2KSkgeworCXN3
aXRjaCAoSU5URUxfR0VOKGk5MTUpKSB7CiAJY2FzZSAyOgogCQlyZXR1cm4gYWx0ZXJuYXRlID8g
NjY2NjcgOiA0ODAwMDsKIAljYXNlIDM6CkBAIC01NTQsNyArNTU0LDcgQEAgc3RhdGljIGludCBp
bnRlbF9iaW9zX3NzY19mcmVxdWVuY3koc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAogfQogCiBzdGF0aWMgdm9pZAotcGFyc2VfZ2VuZXJhbF9mZWF0dXJlcyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitwYXJzZV9nZW5lcmFsX2ZlYXR1cmVzKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCQkgICAgICAgY29uc3Qgc3RydWN0IGJkYl9oZWFkZXIgKmJk
YikKIHsKIAljb25zdCBzdHJ1Y3QgYmRiX2dlbmVyYWxfZmVhdHVyZXMgKmdlbmVyYWw7CkBAIC01
NjMsMzEgKzU2MywzMSBAQCBwYXJzZV9nZW5lcmFsX2ZlYXR1cmVzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKIAlpZiAoIWdlbmVyYWwpCiAJCXJldHVybjsKIAotCWRldl9wcml2
LT52YnQuaW50X3R2X3N1cHBvcnQgPSBnZW5lcmFsLT5pbnRfdHZfc3VwcG9ydDsKKwlpOTE1LT52
YnQuaW50X3R2X3N1cHBvcnQgPSBnZW5lcmFsLT5pbnRfdHZfc3VwcG9ydDsKIAkvKiBpbnRfY3J0
X3N1cHBvcnQgY2FuJ3QgYmUgdHJ1c3RlZCBvbiBlYXJsaWVyIHBsYXRmb3JtcyAqLwogCWlmIChi
ZGItPnZlcnNpb24gPj0gMTU1ICYmCi0JICAgIChIQVNfRERJKGRldl9wcml2KSB8fCBJU19WQUxM
RVlWSUVXKGRldl9wcml2KSkpCi0JCWRldl9wcml2LT52YnQuaW50X2NydF9zdXBwb3J0ID0gZ2Vu
ZXJhbC0+aW50X2NydF9zdXBwb3J0OwotCWRldl9wcml2LT52YnQubHZkc191c2Vfc3NjID0gZ2Vu
ZXJhbC0+ZW5hYmxlX3NzYzsKLQlkZXZfcHJpdi0+dmJ0Lmx2ZHNfc3NjX2ZyZXEgPQotCQlpbnRl
bF9iaW9zX3NzY19mcmVxdWVuY3koZGV2X3ByaXYsIGdlbmVyYWwtPnNzY19mcmVxKTsKLQlkZXZf
cHJpdi0+dmJ0LmRpc3BsYXlfY2xvY2tfbW9kZSA9IGdlbmVyYWwtPmRpc3BsYXlfY2xvY2tfbW9k
ZTsKLQlkZXZfcHJpdi0+dmJ0LmZkaV9yeF9wb2xhcml0eV9pbnZlcnRlZCA9IGdlbmVyYWwtPmZk
aV9yeF9wb2xhcml0eV9pbnZlcnRlZDsKKwkgICAgKEhBU19EREkoaTkxNSkgfHwgSVNfVkFMTEVZ
VklFVyhpOTE1KSkpCisJCWk5MTUtPnZidC5pbnRfY3J0X3N1cHBvcnQgPSBnZW5lcmFsLT5pbnRf
Y3J0X3N1cHBvcnQ7CisJaTkxNS0+dmJ0Lmx2ZHNfdXNlX3NzYyA9IGdlbmVyYWwtPmVuYWJsZV9z
c2M7CisJaTkxNS0+dmJ0Lmx2ZHNfc3NjX2ZyZXEgPQorCQlpbnRlbF9iaW9zX3NzY19mcmVxdWVu
Y3koaTkxNSwgZ2VuZXJhbC0+c3NjX2ZyZXEpOworCWk5MTUtPnZidC5kaXNwbGF5X2Nsb2NrX21v
ZGUgPSBnZW5lcmFsLT5kaXNwbGF5X2Nsb2NrX21vZGU7CisJaTkxNS0+dmJ0LmZkaV9yeF9wb2xh
cml0eV9pbnZlcnRlZCA9IGdlbmVyYWwtPmZkaV9yeF9wb2xhcml0eV9pbnZlcnRlZDsKIAlpZiAo
YmRiLT52ZXJzaW9uID49IDE4MSkgewotCQlkZXZfcHJpdi0+dmJ0Lm9yaWVudGF0aW9uID0gZ2Vu
ZXJhbC0+cm90YXRlXzE4MCA/CisJCWk5MTUtPnZidC5vcmllbnRhdGlvbiA9IGdlbmVyYWwtPnJv
dGF0ZV8xODAgPwogCQkJRFJNX01PREVfUEFORUxfT1JJRU5UQVRJT05fQk9UVE9NX1VQIDoKIAkJ
CURSTV9NT0RFX1BBTkVMX09SSUVOVEFUSU9OX05PUk1BTDsKIAl9IGVsc2UgewotCQlkZXZfcHJp
di0+dmJ0Lm9yaWVudGF0aW9uID0gRFJNX01PREVfUEFORUxfT1JJRU5UQVRJT05fVU5LTk9XTjsK
KwkJaTkxNS0+dmJ0Lm9yaWVudGF0aW9uID0gRFJNX01PREVfUEFORUxfT1JJRU5UQVRJT05fVU5L
Tk9XTjsKIAl9Ci0JZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJZHJtX2RiZ19rbXMoJmk5
MTUtPmRybSwKIAkJICAgICJCREJfR0VORVJBTF9GRUFUVVJFUyBpbnRfdHZfc3VwcG9ydCAlZCBp
bnRfY3J0X3N1cHBvcnQgJWQgbHZkc191c2Vfc3NjICVkIGx2ZHNfc3NjX2ZyZXEgJWQgZGlzcGxh
eV9jbG9ja19tb2RlICVkIGZkaV9yeF9wb2xhcml0eV9pbnZlcnRlZCAlZFxuIiwKLQkJICAgIGRl
dl9wcml2LT52YnQuaW50X3R2X3N1cHBvcnQsCi0JCSAgICBkZXZfcHJpdi0+dmJ0LmludF9jcnRf
c3VwcG9ydCwKLQkJICAgIGRldl9wcml2LT52YnQubHZkc191c2Vfc3NjLAotCQkgICAgZGV2X3By
aXYtPnZidC5sdmRzX3NzY19mcmVxLAotCQkgICAgZGV2X3ByaXYtPnZidC5kaXNwbGF5X2Nsb2Nr
X21vZGUsCi0JCSAgICBkZXZfcHJpdi0+dmJ0LmZkaV9yeF9wb2xhcml0eV9pbnZlcnRlZCk7CisJ
CSAgICBpOTE1LT52YnQuaW50X3R2X3N1cHBvcnQsCisJCSAgICBpOTE1LT52YnQuaW50X2NydF9z
dXBwb3J0LAorCQkgICAgaTkxNS0+dmJ0Lmx2ZHNfdXNlX3NzYywKKwkJICAgIGk5MTUtPnZidC5s
dmRzX3NzY19mcmVxLAorCQkgICAgaTkxNS0+dmJ0LmRpc3BsYXlfY2xvY2tfbW9kZSwKKwkJICAg
IGk5MTUtPnZidC5mZGlfcnhfcG9sYXJpdHlfaW52ZXJ0ZWQpOwogfQogCiBzdGF0aWMgY29uc3Qg
c3RydWN0IGNoaWxkX2RldmljZV9jb25maWcgKgpAQCAtNTk3LDcgKzU5Nyw3IEBAIGNoaWxkX2Rl
dmljZV9wdHIoY29uc3Qgc3RydWN0IGJkYl9nZW5lcmFsX2RlZmluaXRpb25zICpkZWZzLCBpbnQg
aSkKIH0KIAogc3RhdGljIHZvaWQKLXBhcnNlX3Nkdm9fZGV2aWNlX21hcHBpbmcoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1OCBiZGJfdmVyc2lvbikKK3BhcnNlX3Nkdm9fZGV2
aWNlX21hcHBpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHU4IGJkYl92ZXJzaW9u
KQogewogCXN0cnVjdCBzZHZvX2RldmljZV9tYXBwaW5nICptYXBwaW5nOwogCWNvbnN0IHN0cnVj
dCBkaXNwbGF5X2RldmljZV9kYXRhICpkZXZkYXRhOwpAQCAtNjA4LDEyICs2MDgsMTIgQEAgcGFy
c2Vfc2R2b19kZXZpY2VfbWFwcGluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
IHU4IGJkYl92ZXJzaW9uKQogCSAqIE9ubHkgcGFyc2UgU0RWTyBtYXBwaW5ncyBvbiBnZW5zIHRo
YXQgY291bGQgaGF2ZSBTRFZPLiBUaGlzIGlzbid0CiAJICogYWNjdXJhdGUgYW5kIGRvZXNuJ3Qg
aGF2ZSB0byBiZSwgYXMgbG9uZyBhcyBpdCdzIG5vdCB0b28gc3RyaWN0LgogCSAqLwotCWlmICgh
SVNfR0VOX1JBTkdFKGRldl9wcml2LCAzLCA3KSkgewotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYt
PmRybSwgIlNraXBwaW5nIFNEVk8gZGV2aWNlIG1hcHBpbmdcbiIpOworCWlmICghSVNfR0VOX1JB
TkdFKGk5MTUsIDMsIDcpKSB7CisJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sICJTa2lwcGluZyBT
RFZPIGRldmljZSBtYXBwaW5nXG4iKTsKIAkJcmV0dXJuOwogCX0KIAotCWxpc3RfZm9yX2VhY2hf
ZW50cnkoZGV2ZGF0YSwgJmRldl9wcml2LT52YnQuZGlzcGxheV9kZXZpY2VzLCBub2RlKSB7CisJ
bGlzdF9mb3JfZWFjaF9lbnRyeShkZXZkYXRhLCAmaTkxNS0+dmJ0LmRpc3BsYXlfZGV2aWNlcywg
bm9kZSkgewogCQljaGlsZCA9ICZkZXZkYXRhLT5jaGlsZDsKIAogCQlpZiAoY2hpbGQtPnNsYXZl
X2FkZHIgIT0gU0xBVkVfQUREUjEgJiYKQEAgLTYyNywxNyArNjI3LDE3IEBAIHBhcnNlX3Nkdm9f
ZGV2aWNlX21hcHBpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1OCBiZGJf
dmVyc2lvbikKIAkJaWYgKGNoaWxkLT5kdm9fcG9ydCAhPSBERVZJQ0VfUE9SVF9EVk9CICYmCiAJ
CSAgICBjaGlsZC0+ZHZvX3BvcnQgIT0gREVWSUNFX1BPUlRfRFZPQykgewogCQkJLyogc2tpcCB0
aGUgaW5jb3JyZWN0IFNEVk8gcG9ydCAqLwotCQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0s
CisJCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAogCQkJCSAgICAiSW5jb3JyZWN0IFNEVk8gcG9y
dC4gU2tpcCBpdFxuIik7CiAJCQljb250aW51ZTsKIAkJfQotCQlkcm1fZGJnX2ttcygmZGV2X3By
aXYtPmRybSwKKwkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKIAkJCSAgICAidGhlIFNEVk8gZGV2
aWNlIHdpdGggc2xhdmUgYWRkciAlMnggaXMgZm91bmQgb24iCiAJCQkgICAgIiAlcyBwb3J0XG4i
LAogCQkJICAgIGNoaWxkLT5zbGF2ZV9hZGRyLAogCQkJICAgIChjaGlsZC0+ZHZvX3BvcnQgPT0g
REVWSUNFX1BPUlRfRFZPQikgPwogCQkJICAgICJTRFZPQiIgOiAiU0RWT0MiKTsKLQkJbWFwcGlu
ZyA9ICZkZXZfcHJpdi0+dmJ0LnNkdm9fbWFwcGluZ3NbY2hpbGQtPmR2b19wb3J0IC0gMV07CisJ
CW1hcHBpbmcgPSAmaTkxNS0+dmJ0LnNkdm9fbWFwcGluZ3NbY2hpbGQtPmR2b19wb3J0IC0gMV07
CiAJCWlmICghbWFwcGluZy0+aW5pdGlhbGl6ZWQpIHsKIAkJCW1hcHBpbmctPmR2b19wb3J0ID0g
Y2hpbGQtPmR2b19wb3J0OwogCQkJbWFwcGluZy0+c2xhdmVfYWRkciA9IGNoaWxkLT5zbGF2ZV9h
ZGRyOwpAQCAtNjQ1LDIwICs2NDUsMjAgQEAgcGFyc2Vfc2R2b19kZXZpY2VfbWFwcGluZyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHU4IGJkYl92ZXJzaW9uKQogCQkJbWFwcGlu
Zy0+ZGRjX3BpbiA9IGNoaWxkLT5kZGNfcGluOwogCQkJbWFwcGluZy0+aTJjX3BpbiA9IGNoaWxk
LT5pMmNfcGluOwogCQkJbWFwcGluZy0+aW5pdGlhbGl6ZWQgPSAxOwotCQkJZHJtX2RiZ19rbXMo
JmRldl9wcml2LT5kcm0sCisJCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAogCQkJCSAgICAiU0RW
TyBkZXZpY2U6IGR2bz0leCwgYWRkcj0leCwgd2lyaW5nPSVkLCBkZGNfcGluPSVkLCBpMmNfcGlu
PSVkXG4iLAogCQkJCSAgICBtYXBwaW5nLT5kdm9fcG9ydCwgbWFwcGluZy0+c2xhdmVfYWRkciwK
IAkJCQkgICAgbWFwcGluZy0+ZHZvX3dpcmluZywgbWFwcGluZy0+ZGRjX3BpbiwKIAkJCQkgICAg
bWFwcGluZy0+aTJjX3Bpbik7CiAJCX0gZWxzZSB7Ci0JCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYt
PmRybSwKKwkJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCiAJCQkJICAgICJNYXliZSBvbmUgU0RW
TyBwb3J0IGlzIHNoYXJlZCBieSAiCiAJCQkJICAgICJ0d28gU0RWTyBkZXZpY2UuXG4iKTsKIAkJ
fQogCQlpZiAoY2hpbGQtPnNsYXZlMl9hZGRyKSB7CiAJCQkvKiBNYXliZSB0aGlzIGlzIGEgU0RW
TyBkZXZpY2Ugd2l0aCBtdWx0aXBsZSBpbnB1dHMgKi8KIAkJCS8qIEFuZCB0aGUgbWFwcGluZyBp
bmZvIGlzIG5vdCBhZGRlZCAqLwotCQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCQlk
cm1fZGJnX2ttcygmaTkxNS0+ZHJtLAogCQkJCSAgICAidGhlcmUgZXhpc3RzIHRoZSBzbGF2ZTJf
YWRkci4gTWF5YmUgdGhpcyIKIAkJCQkgICAgIiBpcyBhIFNEVk8gZGV2aWNlIHdpdGggbXVsdGlw
bGUgaW5wdXRzLlxuIik7CiAJCX0KQEAgLTY2NywxMyArNjY3LDEzIEBAIHBhcnNlX3Nkdm9fZGV2
aWNlX21hcHBpbmcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1OCBiZGJfdmVy
c2lvbikKIAogCWlmICghY291bnQpIHsKIAkJLyogTm8gU0RWTyBkZXZpY2UgaW5mbyBpcyBmb3Vu
ZCAqLwotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwkJZHJtX2RiZ19rbXMoJmk5MTUt
PmRybSwKIAkJCSAgICAiTm8gU0RWTyBkZXZpY2UgaW5mbyBpcyBmb3VuZCBpbiBWQlRcbiIpOwog
CX0KIH0KIAogc3RhdGljIHZvaWQKLXBhcnNlX2RyaXZlcl9mZWF0dXJlcyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitwYXJzZV9kcml2ZXJfZmVhdHVyZXMoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsCiAJCSAgICAgIGNvbnN0IHN0cnVjdCBiZGJfaGVhZGVyICpiZGIp
CiB7CiAJY29uc3Qgc3RydWN0IGJkYl9kcml2ZXJfZmVhdHVyZXMgKmRyaXZlcjsKQEAgLTY4Miwx
NCArNjgyLDE0IEBAIHBhcnNlX2RyaXZlcl9mZWF0dXJlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCiAJaWYgKCFkcml2ZXIpCiAJCXJldHVybjsKIAotCWlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDUpIHsKKwlpZiAoSU5URUxfR0VOKGk5MTUpID49IDUpIHsKIAkJLyoKIAkJ
ICogTm90ZSB0aGF0IHdlIGNvbnNpZGVyIEJEQl9EUklWRVJfRkVBVFVSRV9JTlRfU0RWT19MVkRT
CiAJCSAqIHRvIG1lYW4gImVEUCIuIFRoZSBWQlQgc3BlYyBkb2Vzbid0IGFncmVlIHdpdGggdGhh
dAogCQkgKiBpbnRlcnByZXRhdGlvbiwgYnV0IHJlYWwgd29ybGQgVkJUcyBzZWVtIHRvLgogCQkg
Ki8KIAkJaWYgKGRyaXZlci0+bHZkc19jb25maWcgIT0gQkRCX0RSSVZFUl9GRUFUVVJFX0lOVF9M
VkRTKQotCQkJZGV2X3ByaXYtPnZidC5pbnRfbHZkc19zdXBwb3J0ID0gMDsKKwkJCWk5MTUtPnZi
dC5pbnRfbHZkc19zdXBwb3J0ID0gMDsKIAl9IGVsc2UgewogCQkvKgogCQkgKiBGSVhNRSBpdCdz
IG5vdCBjbGVhciB3aGljaCBCREIgdmVyc2lvbiBoYXMgdGhlIExWRFMgY29uZmlnCkBAIC03MDUs
MTEgKzcwNSwxMSBAQCBwYXJzZV9kcml2ZXJfZmVhdHVyZXMoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAogCQlpZiAoYmRiLT52ZXJzaW9uID49IDEzNCAmJgogCQkgICAgZHJpdmVy
LT5sdmRzX2NvbmZpZyAhPSBCREJfRFJJVkVSX0ZFQVRVUkVfSU5UX0xWRFMgJiYKIAkJICAgIGRy
aXZlci0+bHZkc19jb25maWcgIT0gQkRCX0RSSVZFUl9GRUFUVVJFX0lOVF9TRFZPX0xWRFMpCi0J
CQlkZXZfcHJpdi0+dmJ0LmludF9sdmRzX3N1cHBvcnQgPSAwOworCQkJaTkxNS0+dmJ0LmludF9s
dmRzX3N1cHBvcnQgPSAwOwogCX0KIAogCWlmIChiZGItPnZlcnNpb24gPCAyMjgpIHsKLQkJZHJt
X2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJEUlJTIFN0YXRlIEVuYWJsZWQ6JWRcbiIsCisJCWRy
bV9kYmdfa21zKCZpOTE1LT5kcm0sICJEUlJTIFN0YXRlIEVuYWJsZWQ6JWRcbiIsCiAJCQkgICAg
ZHJpdmVyLT5kcnJzX2VuYWJsZWQpOwogCQkvKgogCQkgKiBJZiBEUlJTIGlzIG5vdCBzdXBwb3J0
ZWQsIGRycnNfdHlwZSBoYXMgdG8gYmUgc2V0IHRvIDAuCkBAIC03MTgsMTggKzcxOCwxOCBAQCBw
YXJzZV9kcml2ZXJfZmVhdHVyZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAog
CQkgKiBkcml2ZXItPmRycnNfZW5hYmxlZD1mYWxzZQogCQkgKi8KIAkJaWYgKCFkcml2ZXItPmRy
cnNfZW5hYmxlZCkKLQkJCWRldl9wcml2LT52YnQuZHJyc190eXBlID0gRFJSU19OT1RfU1VQUE9S
VEVEOworCQkJaTkxNS0+dmJ0LmRycnNfdHlwZSA9IERSUlNfTk9UX1NVUFBPUlRFRDsKIAotCQlk
ZXZfcHJpdi0+dmJ0LnBzci5lbmFibGUgPSBkcml2ZXItPnBzcl9lbmFibGVkOworCQlpOTE1LT52
YnQucHNyLmVuYWJsZSA9IGRyaXZlci0+cHNyX2VuYWJsZWQ7CiAJfQogfQogCiBzdGF0aWMgdm9p
ZAotcGFyc2VfcG93ZXJfY29uc2VydmF0aW9uX2ZlYXR1cmVzKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKK3BhcnNlX3Bvd2VyX2NvbnNlcnZhdGlvbl9mZWF0dXJlcyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgIGNvbnN0IHN0cnVjdCBiZGJfaGVhZGVyICpi
ZGIpCiB7CiAJY29uc3Qgc3RydWN0IGJkYl9sZnBfcG93ZXIgKnBvd2VyOwotCXU4IHBhbmVsX3R5
cGUgPSBkZXZfcHJpdi0+dmJ0LnBhbmVsX3R5cGU7CisJdTggcGFuZWxfdHlwZSA9IGk5MTUtPnZi
dC5wYW5lbF90eXBlOwogCiAJaWYgKGJkYi0+dmVyc2lvbiA8IDIyOCkKIAkJcmV0dXJuOwpAQCAt
NzM4LDcgKzczOCw3IEBAIHBhcnNlX3Bvd2VyX2NvbnNlcnZhdGlvbl9mZWF0dXJlcyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaWYgKCFwb3dlcikKIAkJcmV0dXJuOwogCi0J
ZGV2X3ByaXYtPnZidC5wc3IuZW5hYmxlID0gcG93ZXItPnBzciAmIEJJVChwYW5lbF90eXBlKTsK
KwlpOTE1LT52YnQucHNyLmVuYWJsZSA9IHBvd2VyLT5wc3IgJiBCSVQocGFuZWxfdHlwZSk7CiAK
IAkvKgogCSAqIElmIERSUlMgaXMgbm90IHN1cHBvcnRlZCwgZHJyc190eXBlIGhhcyB0byBiZSBz
ZXQgdG8gMC4KQEAgLTc0NywxOSArNzQ3LDE5IEBAIHBhcnNlX3Bvd2VyX2NvbnNlcnZhdGlvbl9m
ZWF0dXJlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJICogcG93ZXItPmRy
cnMgJiBCSVQocGFuZWxfdHlwZSk9ZmFsc2UKIAkgKi8KIAlpZiAoIShwb3dlci0+ZHJycyAmIEJJ
VChwYW5lbF90eXBlKSkpCi0JCWRldl9wcml2LT52YnQuZHJyc190eXBlID0gRFJSU19OT1RfU1VQ
UE9SVEVEOworCQlpOTE1LT52YnQuZHJyc190eXBlID0gRFJSU19OT1RfU1VQUE9SVEVEOwogCiAJ
aWYgKGJkYi0+dmVyc2lvbiA+PSAyMzIpCi0JCWRldl9wcml2LT52YnQuZWRwLmhvYmwgPSBwb3dl
ci0+aG9ibCAmIEJJVChwYW5lbF90eXBlKTsKKwkJaTkxNS0+dmJ0LmVkcC5ob2JsID0gcG93ZXIt
PmhvYmwgJiBCSVQocGFuZWxfdHlwZSk7CiB9CiAKIHN0YXRpYyB2b2lkCi1wYXJzZV9lZHAoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBjb25zdCBzdHJ1Y3QgYmRiX2hlYWRlciAq
YmRiKQorcGFyc2VfZWRwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBjb25zdCBzdHJ1
Y3QgYmRiX2hlYWRlciAqYmRiKQogewogCWNvbnN0IHN0cnVjdCBiZGJfZWRwICplZHA7CiAJY29u
c3Qgc3RydWN0IGVkcF9wb3dlcl9zZXEgKmVkcF9wcHM7CiAJY29uc3Qgc3RydWN0IGVkcF9mYXN0
X2xpbmtfcGFyYW1zICplZHBfbGlua19wYXJhbXM7Ci0JaW50IHBhbmVsX3R5cGUgPSBkZXZfcHJp
di0+dmJ0LnBhbmVsX3R5cGU7CisJaW50IHBhbmVsX3R5cGUgPSBpOTE1LT52YnQucGFuZWxfdHlw
ZTsKIAogCWVkcCA9IGZpbmRfc2VjdGlvbihiZGIsIEJEQl9FRFApOwogCWlmICghZWRwKQpAQCAt
NzY3LDEzICs3NjcsMTMgQEAgcGFyc2VfZWRwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwgY29uc3Qgc3RydWN0IGJkYl9oZWFkZXIgKmJkYikKIAogCXN3aXRjaCAoKGVkcC0+Y29s
b3JfZGVwdGggPj4gKHBhbmVsX3R5cGUgKiAyKSkgJiAzKSB7CiAJY2FzZSBFRFBfMThCUFA6Ci0J
CWRldl9wcml2LT52YnQuZWRwLmJwcCA9IDE4OworCQlpOTE1LT52YnQuZWRwLmJwcCA9IDE4Owog
CQlicmVhazsKIAljYXNlIEVEUF8yNEJQUDoKLQkJZGV2X3ByaXYtPnZidC5lZHAuYnBwID0gMjQ7
CisJCWk5MTUtPnZidC5lZHAuYnBwID0gMjQ7CiAJCWJyZWFrOwogCWNhc2UgRURQXzMwQlBQOgot
CQlkZXZfcHJpdi0+dmJ0LmVkcC5icHAgPSAzMDsKKwkJaTkxNS0+dmJ0LmVkcC5icHAgPSAzMDsK
IAkJYnJlYWs7CiAJfQogCkBAIC03ODEsMTcgKzc4MSwxNyBAQCBwYXJzZV9lZHAoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBjb25zdCBzdHJ1Y3QgYmRiX2hlYWRlciAqYmRiKQog
CWVkcF9wcHMgPSAmZWRwLT5wb3dlcl9zZXFzW3BhbmVsX3R5cGVdOwogCWVkcF9saW5rX3BhcmFt
cyA9ICZlZHAtPmZhc3RfbGlua19wYXJhbXNbcGFuZWxfdHlwZV07CiAKLQlkZXZfcHJpdi0+dmJ0
LmVkcC5wcHMgPSAqZWRwX3BwczsKKwlpOTE1LT52YnQuZWRwLnBwcyA9ICplZHBfcHBzOwogCiAJ
c3dpdGNoIChlZHBfbGlua19wYXJhbXMtPnJhdGUpIHsKIAljYXNlIEVEUF9SQVRFXzFfNjI6Ci0J
CWRldl9wcml2LT52YnQuZWRwLnJhdGUgPSBEUF9MSU5LX0JXXzFfNjI7CisJCWk5MTUtPnZidC5l
ZHAucmF0ZSA9IERQX0xJTktfQldfMV82MjsKIAkJYnJlYWs7CiAJY2FzZSBFRFBfUkFURV8yXzc6
Ci0JCWRldl9wcml2LT52YnQuZWRwLnJhdGUgPSBEUF9MSU5LX0JXXzJfNzsKKwkJaTkxNS0+dmJ0
LmVkcC5yYXRlID0gRFBfTElOS19CV18yXzc7CiAJCWJyZWFrOwogCWRlZmF1bHQ6Ci0JCWRybV9k
Ymdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAogCQkJICAg
ICJWQlQgaGFzIHVua25vd24gZURQIGxpbmsgcmF0ZSB2YWx1ZSAldVxuIiwKIAkJCSAgICAgZWRw
X2xpbmtfcGFyYW1zLT5yYXRlKTsKIAkJYnJlYWs7CkBAIC03OTksMTYgKzc5OSwxNiBAQCBwYXJz
ZV9lZHAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBjb25zdCBzdHJ1Y3QgYmRi
X2hlYWRlciAqYmRiKQogCiAJc3dpdGNoIChlZHBfbGlua19wYXJhbXMtPmxhbmVzKSB7CiAJY2Fz
ZSBFRFBfTEFORV8xOgotCQlkZXZfcHJpdi0+dmJ0LmVkcC5sYW5lcyA9IDE7CisJCWk5MTUtPnZi
dC5lZHAubGFuZXMgPSAxOwogCQlicmVhazsKIAljYXNlIEVEUF9MQU5FXzI6Ci0JCWRldl9wcml2
LT52YnQuZWRwLmxhbmVzID0gMjsKKwkJaTkxNS0+dmJ0LmVkcC5sYW5lcyA9IDI7CiAJCWJyZWFr
OwogCWNhc2UgRURQX0xBTkVfNDoKLQkJZGV2X3ByaXYtPnZidC5lZHAubGFuZXMgPSA0OworCQlp
OTE1LT52YnQuZWRwLmxhbmVzID0gNDsKIAkJYnJlYWs7CiAJZGVmYXVsdDoKLQkJZHJtX2RiZ19r
bXMoJmRldl9wcml2LT5kcm0sCisJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCiAJCQkgICAgIlZC
VCBoYXMgdW5rbm93biBlRFAgbGFuZSBjb3VudCB2YWx1ZSAldVxuIiwKIAkJCSAgICBlZHBfbGlu
a19wYXJhbXMtPmxhbmVzKTsKIAkJYnJlYWs7CkBAIC04MTYsMTkgKzgxNiwxOSBAQCBwYXJzZV9l
ZHAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBjb25zdCBzdHJ1Y3QgYmRiX2hl
YWRlciAqYmRiKQogCiAJc3dpdGNoIChlZHBfbGlua19wYXJhbXMtPnByZWVtcGhhc2lzKSB7CiAJ
Y2FzZSBFRFBfUFJFRU1QSEFTSVNfTk9ORToKLQkJZGV2X3ByaXYtPnZidC5lZHAucHJlZW1waGFz
aXMgPSBEUF9UUkFJTl9QUkVfRU1QSF9MRVZFTF8wOworCQlpOTE1LT52YnQuZWRwLnByZWVtcGhh
c2lzID0gRFBfVFJBSU5fUFJFX0VNUEhfTEVWRUxfMDsKIAkJYnJlYWs7CiAJY2FzZSBFRFBfUFJF
RU1QSEFTSVNfM181ZEI6Ci0JCWRldl9wcml2LT52YnQuZWRwLnByZWVtcGhhc2lzID0gRFBfVFJB
SU5fUFJFX0VNUEhfTEVWRUxfMTsKKwkJaTkxNS0+dmJ0LmVkcC5wcmVlbXBoYXNpcyA9IERQX1RS
QUlOX1BSRV9FTVBIX0xFVkVMXzE7CiAJCWJyZWFrOwogCWNhc2UgRURQX1BSRUVNUEhBU0lTXzZk
QjoKLQkJZGV2X3ByaXYtPnZidC5lZHAucHJlZW1waGFzaXMgPSBEUF9UUkFJTl9QUkVfRU1QSF9M
RVZFTF8yOworCQlpOTE1LT52YnQuZWRwLnByZWVtcGhhc2lzID0gRFBfVFJBSU5fUFJFX0VNUEhf
TEVWRUxfMjsKIAkJYnJlYWs7CiAJY2FzZSBFRFBfUFJFRU1QSEFTSVNfOV81ZEI6Ci0JCWRldl9w
cml2LT52YnQuZWRwLnByZWVtcGhhc2lzID0gRFBfVFJBSU5fUFJFX0VNUEhfTEVWRUxfMzsKKwkJ
aTkxNS0+dmJ0LmVkcC5wcmVlbXBoYXNpcyA9IERQX1RSQUlOX1BSRV9FTVBIX0xFVkVMXzM7CiAJ
CWJyZWFrOwogCWRlZmF1bHQ6Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQlkcm1f
ZGJnX2ttcygmaTkxNS0+ZHJtLAogCQkJICAgICJWQlQgaGFzIHVua25vd24gZURQIHByZS1lbXBo
YXNpcyB2YWx1ZSAldVxuIiwKIAkJCSAgICBlZHBfbGlua19wYXJhbXMtPnByZWVtcGhhc2lzKTsK
IAkJYnJlYWs7CkBAIC04MzYsMTkgKzgzNiwxOSBAQCBwYXJzZV9lZHAoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LCBjb25zdCBzdHJ1Y3QgYmRiX2hlYWRlciAqYmRiKQogCiAJc3dp
dGNoIChlZHBfbGlua19wYXJhbXMtPnZzd2luZykgewogCWNhc2UgRURQX1ZTV0lOR18wXzRWOgot
CQlkZXZfcHJpdi0+dmJ0LmVkcC52c3dpbmcgPSBEUF9UUkFJTl9WT0xUQUdFX1NXSU5HX0xFVkVM
XzA7CisJCWk5MTUtPnZidC5lZHAudnN3aW5nID0gRFBfVFJBSU5fVk9MVEFHRV9TV0lOR19MRVZF
TF8wOwogCQlicmVhazsKIAljYXNlIEVEUF9WU1dJTkdfMF82VjoKLQkJZGV2X3ByaXYtPnZidC5l
ZHAudnN3aW5nID0gRFBfVFJBSU5fVk9MVEFHRV9TV0lOR19MRVZFTF8xOworCQlpOTE1LT52YnQu
ZWRwLnZzd2luZyA9IERQX1RSQUlOX1ZPTFRBR0VfU1dJTkdfTEVWRUxfMTsKIAkJYnJlYWs7CiAJ
Y2FzZSBFRFBfVlNXSU5HXzBfOFY6Ci0JCWRldl9wcml2LT52YnQuZWRwLnZzd2luZyA9IERQX1RS
QUlOX1ZPTFRBR0VfU1dJTkdfTEVWRUxfMjsKKwkJaTkxNS0+dmJ0LmVkcC52c3dpbmcgPSBEUF9U
UkFJTl9WT0xUQUdFX1NXSU5HX0xFVkVMXzI7CiAJCWJyZWFrOwogCWNhc2UgRURQX1ZTV0lOR18x
XzJWOgotCQlkZXZfcHJpdi0+dmJ0LmVkcC52c3dpbmcgPSBEUF9UUkFJTl9WT0xUQUdFX1NXSU5H
X0xFVkVMXzM7CisJCWk5MTUtPnZidC5lZHAudnN3aW5nID0gRFBfVFJBSU5fVk9MVEFHRV9TV0lO
R19MRVZFTF8zOwogCQlicmVhazsKIAlkZWZhdWx0OgotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYt
PmRybSwKKwkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKIAkJCSAgICAiVkJUIGhhcyB1bmtub3du
IGVEUCB2b2x0YWdlIHN3aW5nIHZhbHVlICV1XG4iLAogCQkJICAgIGVkcF9saW5rX3BhcmFtcy0+
dnN3aW5nKTsKIAkJYnJlYWs7CkBAIC04NTgsNTMgKzg1OCw1MyBAQCBwYXJzZV9lZHAoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBjb25zdCBzdHJ1Y3QgYmRiX2hlYWRlciAqYmRi
KQogCQl1OCB2c3dpbmc7CiAKIAkJLyogRG9uJ3QgcmVhZCBmcm9tIFZCVCBpZiBtb2R1bGUgcGFy
YW1ldGVyIGhhcyB2YWxpZCB2YWx1ZSovCi0JCWlmIChkZXZfcHJpdi0+cGFyYW1zLmVkcF92c3dp
bmcpIHsKLQkJCWRldl9wcml2LT52YnQuZWRwLmxvd192c3dpbmcgPQotCQkJCWRldl9wcml2LT5w
YXJhbXMuZWRwX3Zzd2luZyA9PSAxOworCQlpZiAoaTkxNS0+cGFyYW1zLmVkcF92c3dpbmcpIHsK
KwkJCWk5MTUtPnZidC5lZHAubG93X3Zzd2luZyA9CisJCQkJaTkxNS0+cGFyYW1zLmVkcF92c3dp
bmcgPT0gMTsKIAkJfSBlbHNlIHsKIAkJCXZzd2luZyA9IChlZHAtPmVkcF92c3dpbmdfcHJlZW1w
aCA+PiAocGFuZWxfdHlwZSAqIDQpKSAmIDB4RjsKLQkJCWRldl9wcml2LT52YnQuZWRwLmxvd192
c3dpbmcgPSB2c3dpbmcgPT0gMDsKKwkJCWk5MTUtPnZidC5lZHAubG93X3Zzd2luZyA9IHZzd2lu
ZyA9PSAwOwogCQl9CiAJfQogfQogCiBzdGF0aWMgdm9pZAotcGFyc2VfcHNyKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwgY29uc3Qgc3RydWN0IGJkYl9oZWFkZXIgKmJkYikKK3Bh
cnNlX3BzcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgY29uc3Qgc3RydWN0IGJkYl9o
ZWFkZXIgKmJkYikKIHsKIAljb25zdCBzdHJ1Y3QgYmRiX3BzciAqcHNyOwogCWNvbnN0IHN0cnVj
dCBwc3JfdGFibGUgKnBzcl90YWJsZTsKLQlpbnQgcGFuZWxfdHlwZSA9IGRldl9wcml2LT52YnQu
cGFuZWxfdHlwZTsKKwlpbnQgcGFuZWxfdHlwZSA9IGk5MTUtPnZidC5wYW5lbF90eXBlOwogCiAJ
cHNyID0gZmluZF9zZWN0aW9uKGJkYiwgQkRCX1BTUik7CiAJaWYgKCFwc3IpIHsKLQkJZHJtX2Ri
Z19rbXMoJmRldl9wcml2LT5kcm0sICJObyBQU1IgQkRCIGZvdW5kLlxuIik7CisJCWRybV9kYmdf
a21zKCZpOTE1LT5kcm0sICJObyBQU1IgQkRCIGZvdW5kLlxuIik7CiAJCXJldHVybjsKIAl9CiAK
IAlwc3JfdGFibGUgPSAmcHNyLT5wc3JfdGFibGVbcGFuZWxfdHlwZV07CiAKLQlkZXZfcHJpdi0+
dmJ0LnBzci5mdWxsX2xpbmsgPSBwc3JfdGFibGUtPmZ1bGxfbGluazsKLQlkZXZfcHJpdi0+dmJ0
LnBzci5yZXF1aXJlX2F1eF93YWtldXAgPSBwc3JfdGFibGUtPnJlcXVpcmVfYXV4X3RvX3dha2V1
cDsKKwlpOTE1LT52YnQucHNyLmZ1bGxfbGluayA9IHBzcl90YWJsZS0+ZnVsbF9saW5rOworCWk5
MTUtPnZidC5wc3IucmVxdWlyZV9hdXhfd2FrZXVwID0gcHNyX3RhYmxlLT5yZXF1aXJlX2F1eF90
b193YWtldXA7CiAKIAkvKiBBbGxvd2VkIFZCVCB2YWx1ZXMgZ29lcyBmcm9tIDAgdG8gMTUgKi8K
LQlkZXZfcHJpdi0+dmJ0LnBzci5pZGxlX2ZyYW1lcyA9IHBzcl90YWJsZS0+aWRsZV9mcmFtZXMg
PCAwID8gMCA6CisJaTkxNS0+dmJ0LnBzci5pZGxlX2ZyYW1lcyA9IHBzcl90YWJsZS0+aWRsZV9m
cmFtZXMgPCAwID8gMCA6CiAJCXBzcl90YWJsZS0+aWRsZV9mcmFtZXMgPiAxNSA/IDE1IDogcHNy
X3RhYmxlLT5pZGxlX2ZyYW1lczsKIAogCXN3aXRjaCAocHNyX3RhYmxlLT5saW5lc190b193YWl0
KSB7CiAJY2FzZSAwOgotCQlkZXZfcHJpdi0+dmJ0LnBzci5saW5lc190b193YWl0ID0gUFNSXzBf
TElORVNfVE9fV0FJVDsKKwkJaTkxNS0+dmJ0LnBzci5saW5lc190b193YWl0ID0gUFNSXzBfTElO
RVNfVE9fV0FJVDsKIAkJYnJlYWs7CiAJY2FzZSAxOgotCQlkZXZfcHJpdi0+dmJ0LnBzci5saW5l
c190b193YWl0ID0gUFNSXzFfTElORV9UT19XQUlUOworCQlpOTE1LT52YnQucHNyLmxpbmVzX3Rv
X3dhaXQgPSBQU1JfMV9MSU5FX1RPX1dBSVQ7CiAJCWJyZWFrOwogCWNhc2UgMjoKLQkJZGV2X3By
aXYtPnZidC5wc3IubGluZXNfdG9fd2FpdCA9IFBTUl80X0xJTkVTX1RPX1dBSVQ7CisJCWk5MTUt
PnZidC5wc3IubGluZXNfdG9fd2FpdCA9IFBTUl80X0xJTkVTX1RPX1dBSVQ7CiAJCWJyZWFrOwog
CWNhc2UgMzoKLQkJZGV2X3ByaXYtPnZidC5wc3IubGluZXNfdG9fd2FpdCA9IFBTUl84X0xJTkVT
X1RPX1dBSVQ7CisJCWk5MTUtPnZidC5wc3IubGluZXNfdG9fd2FpdCA9IFBTUl84X0xJTkVTX1RP
X1dBSVQ7CiAJCWJyZWFrOwogCWRlZmF1bHQ6Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJt
LAorCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAogCQkJICAgICJWQlQgaGFzIHVua25vd24gUFNS
IGxpbmVzIHRvIHdhaXQgJXVcbiIsCiAJCQkgICAgcHNyX3RhYmxlLT5saW5lc190b193YWl0KTsK
IAkJYnJlYWs7CkBAIC05MTUsNTAgKzkxNSw1MCBAQCBwYXJzZV9wc3Ioc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LCBjb25zdCBzdHJ1Y3QgYmRiX2hlYWRlciAqYmRiKQogCSAqIE9s
ZCBkZWNpbWFsIHZhbHVlIGlzIHdha2UgdXAgdGltZSBpbiBtdWx0aXBsZXMgb2YgMTAwIHVzLgog
CSAqLwogCWlmIChiZGItPnZlcnNpb24gPj0gMjA1ICYmCi0JICAgIChJU19HRU45X0JDKGRldl9w
cml2KSB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSB8fAotCSAgICAgSU5URUxfR0VOKGRldl9w
cml2KSA+PSAxMCkpIHsKKwkgICAgKElTX0dFTjlfQkMoaTkxNSkgfHwgSVNfR0VNSU5JTEFLRShp
OTE1KSB8fAorCSAgICAgSU5URUxfR0VOKGk5MTUpID49IDEwKSkgewogCQlzd2l0Y2ggKHBzcl90
YWJsZS0+dHAxX3dha2V1cF90aW1lKSB7CiAJCWNhc2UgMDoKLQkJCWRldl9wcml2LT52YnQucHNy
LnRwMV93YWtldXBfdGltZV91cyA9IDUwMDsKKwkJCWk5MTUtPnZidC5wc3IudHAxX3dha2V1cF90
aW1lX3VzID0gNTAwOwogCQkJYnJlYWs7CiAJCWNhc2UgMToKLQkJCWRldl9wcml2LT52YnQucHNy
LnRwMV93YWtldXBfdGltZV91cyA9IDEwMDsKKwkJCWk5MTUtPnZidC5wc3IudHAxX3dha2V1cF90
aW1lX3VzID0gMTAwOwogCQkJYnJlYWs7CiAJCWNhc2UgMzoKLQkJCWRldl9wcml2LT52YnQucHNy
LnRwMV93YWtldXBfdGltZV91cyA9IDA7CisJCQlpOTE1LT52YnQucHNyLnRwMV93YWtldXBfdGlt
ZV91cyA9IDA7CiAJCQlicmVhazsKIAkJZGVmYXVsdDoKLQkJCWRybV9kYmdfa21zKCZkZXZfcHJp
di0+ZHJtLAorCQkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKIAkJCQkgICAgIlZCVCB0cDEgd2Fr
ZXVwIHRpbWUgdmFsdWUgJWQgaXMgb3V0c2lkZSByYW5nZVswLTNdLCBkZWZhdWx0aW5nIHRvIG1h
eCB2YWx1ZSAyNTAwdXNcbiIsCiAJCQkJICAgIHBzcl90YWJsZS0+dHAxX3dha2V1cF90aW1lKTsK
IAkJCWZhbGx0aHJvdWdoOwogCQljYXNlIDI6Ci0JCQlkZXZfcHJpdi0+dmJ0LnBzci50cDFfd2Fr
ZXVwX3RpbWVfdXMgPSAyNTAwOworCQkJaTkxNS0+dmJ0LnBzci50cDFfd2FrZXVwX3RpbWVfdXMg
PSAyNTAwOwogCQkJYnJlYWs7CiAJCX0KIAogCQlzd2l0Y2ggKHBzcl90YWJsZS0+dHAyX3RwM193
YWtldXBfdGltZSkgewogCQljYXNlIDA6Ci0JCQlkZXZfcHJpdi0+dmJ0LnBzci50cDJfdHAzX3dh
a2V1cF90aW1lX3VzID0gNTAwOworCQkJaTkxNS0+dmJ0LnBzci50cDJfdHAzX3dha2V1cF90aW1l
X3VzID0gNTAwOwogCQkJYnJlYWs7CiAJCWNhc2UgMToKLQkJCWRldl9wcml2LT52YnQucHNyLnRw
Ml90cDNfd2FrZXVwX3RpbWVfdXMgPSAxMDA7CisJCQlpOTE1LT52YnQucHNyLnRwMl90cDNfd2Fr
ZXVwX3RpbWVfdXMgPSAxMDA7CiAJCQlicmVhazsKIAkJY2FzZSAzOgotCQkJZGV2X3ByaXYtPnZi
dC5wc3IudHAyX3RwM193YWtldXBfdGltZV91cyA9IDA7CisJCQlpOTE1LT52YnQucHNyLnRwMl90
cDNfd2FrZXVwX3RpbWVfdXMgPSAwOwogCQkJYnJlYWs7CiAJCWRlZmF1bHQ6Ci0JCQlkcm1fZGJn
X2ttcygmZGV2X3ByaXYtPmRybSwKKwkJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCiAJCQkJICAg
ICJWQlQgdHAyX3RwMyB3YWtldXAgdGltZSB2YWx1ZSAlZCBpcyBvdXRzaWRlIHJhbmdlWzAtM10s
IGRlZmF1bHRpbmcgdG8gbWF4IHZhbHVlIDI1MDB1c1xuIiwKIAkJCQkgICAgcHNyX3RhYmxlLT50
cDJfdHAzX3dha2V1cF90aW1lKTsKIAkJCWZhbGx0aHJvdWdoOwogCQljYXNlIDI6Ci0JCQlkZXZf
cHJpdi0+dmJ0LnBzci50cDJfdHAzX3dha2V1cF90aW1lX3VzID0gMjUwMDsKKwkJCWk5MTUtPnZi
dC5wc3IudHAyX3RwM193YWtldXBfdGltZV91cyA9IDI1MDA7CiAJCWJyZWFrOwogCQl9CiAJfSBl
bHNlIHsKLQkJZGV2X3ByaXYtPnZidC5wc3IudHAxX3dha2V1cF90aW1lX3VzID0gcHNyX3RhYmxl
LT50cDFfd2FrZXVwX3RpbWUgKiAxMDA7Ci0JCWRldl9wcml2LT52YnQucHNyLnRwMl90cDNfd2Fr
ZXVwX3RpbWVfdXMgPSBwc3JfdGFibGUtPnRwMl90cDNfd2FrZXVwX3RpbWUgKiAxMDA7CisJCWk5
MTUtPnZidC5wc3IudHAxX3dha2V1cF90aW1lX3VzID0gcHNyX3RhYmxlLT50cDFfd2FrZXVwX3Rp
bWUgKiAxMDA7CisJCWk5MTUtPnZidC5wc3IudHAyX3RwM193YWtldXBfdGltZV91cyA9IHBzcl90
YWJsZS0+dHAyX3RwM193YWtldXBfdGltZSAqIDEwMDsKIAl9CiAKIAlpZiAoYmRiLT52ZXJzaW9u
ID49IDIyNikgewpAQCAtOTgwLDc0ICs5ODAsNzQgQEAgcGFyc2VfcHNyKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwgY29uc3Qgc3RydWN0IGJkYl9oZWFkZXIgKmJkYikKIAkJCXdh
a2V1cF90aW1lID0gMjUwMDsKIAkJCWJyZWFrOwogCQl9Ci0JCWRldl9wcml2LT52YnQucHNyLnBz
cjJfdHAyX3RwM193YWtldXBfdGltZV91cyA9IHdha2V1cF90aW1lOworCQlpOTE1LT52YnQucHNy
LnBzcjJfdHAyX3RwM193YWtldXBfdGltZV91cyA9IHdha2V1cF90aW1lOwogCX0gZWxzZSB7CiAJ
CS8qIFJldXNpbmcgUFNSMSB3YWtldXAgdGltZSBmb3IgUFNSMiBpbiBvbGRlciBWQlRzICovCi0J
CWRldl9wcml2LT52YnQucHNyLnBzcjJfdHAyX3RwM193YWtldXBfdGltZV91cyA9IGRldl9wcml2
LT52YnQucHNyLnRwMl90cDNfd2FrZXVwX3RpbWVfdXM7CisJCWk5MTUtPnZidC5wc3IucHNyMl90
cDJfdHAzX3dha2V1cF90aW1lX3VzID0gaTkxNS0+dmJ0LnBzci50cDJfdHAzX3dha2V1cF90aW1l
X3VzOwogCX0KIH0KIAotc3RhdGljIHZvaWQgcGFyc2VfZHNpX2JhY2tsaWdodF9wb3J0cyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBwYXJzZV9kc2lfYmFj
a2xpZ2h0X3BvcnRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAgICAgIHUx
NiB2ZXJzaW9uLCBlbnVtIHBvcnQgcG9ydCkKIHsKLQlpZiAoIWRldl9wcml2LT52YnQuZHNpLmNv
bmZpZy0+ZHVhbF9saW5rIHx8IHZlcnNpb24gPCAxOTcpIHsKLQkJZGV2X3ByaXYtPnZidC5kc2ku
YmxfcG9ydHMgPSBCSVQocG9ydCk7Ci0JCWlmIChkZXZfcHJpdi0+dmJ0LmRzaS5jb25maWctPmNh
YmNfc3VwcG9ydGVkKQotCQkJZGV2X3ByaXYtPnZidC5kc2kuY2FiY19wb3J0cyA9IEJJVChwb3J0
KTsKKwlpZiAoIWk5MTUtPnZidC5kc2kuY29uZmlnLT5kdWFsX2xpbmsgfHwgdmVyc2lvbiA8IDE5
NykgeworCQlpOTE1LT52YnQuZHNpLmJsX3BvcnRzID0gQklUKHBvcnQpOworCQlpZiAoaTkxNS0+
dmJ0LmRzaS5jb25maWctPmNhYmNfc3VwcG9ydGVkKQorCQkJaTkxNS0+dmJ0LmRzaS5jYWJjX3Bv
cnRzID0gQklUKHBvcnQpOwogCiAJCXJldHVybjsKIAl9CiAKLQlzd2l0Y2ggKGRldl9wcml2LT52
YnQuZHNpLmNvbmZpZy0+ZGxfZGNzX2JhY2tsaWdodF9wb3J0cykgeworCXN3aXRjaCAoaTkxNS0+
dmJ0LmRzaS5jb25maWctPmRsX2Rjc19iYWNrbGlnaHRfcG9ydHMpIHsKIAljYXNlIERMX0RDU19Q
T1JUX0E6Ci0JCWRldl9wcml2LT52YnQuZHNpLmJsX3BvcnRzID0gQklUKFBPUlRfQSk7CisJCWk5
MTUtPnZidC5kc2kuYmxfcG9ydHMgPSBCSVQoUE9SVF9BKTsKIAkJYnJlYWs7CiAJY2FzZSBETF9E
Q1NfUE9SVF9DOgotCQlkZXZfcHJpdi0+dmJ0LmRzaS5ibF9wb3J0cyA9IEJJVChQT1JUX0MpOwor
CQlpOTE1LT52YnQuZHNpLmJsX3BvcnRzID0gQklUKFBPUlRfQyk7CiAJCWJyZWFrOwogCWRlZmF1
bHQ6CiAJY2FzZSBETF9EQ1NfUE9SVF9BX0FORF9DOgotCQlkZXZfcHJpdi0+dmJ0LmRzaS5ibF9w
b3J0cyA9IEJJVChQT1JUX0EpIHwgQklUKFBPUlRfQyk7CisJCWk5MTUtPnZidC5kc2kuYmxfcG9y
dHMgPSBCSVQoUE9SVF9BKSB8IEJJVChQT1JUX0MpOwogCQlicmVhazsKIAl9CiAKLQlpZiAoIWRl
dl9wcml2LT52YnQuZHNpLmNvbmZpZy0+Y2FiY19zdXBwb3J0ZWQpCisJaWYgKCFpOTE1LT52YnQu
ZHNpLmNvbmZpZy0+Y2FiY19zdXBwb3J0ZWQpCiAJCXJldHVybjsKIAotCXN3aXRjaCAoZGV2X3By
aXYtPnZidC5kc2kuY29uZmlnLT5kbF9kY3NfY2FiY19wb3J0cykgeworCXN3aXRjaCAoaTkxNS0+
dmJ0LmRzaS5jb25maWctPmRsX2Rjc19jYWJjX3BvcnRzKSB7CiAJY2FzZSBETF9EQ1NfUE9SVF9B
OgotCQlkZXZfcHJpdi0+dmJ0LmRzaS5jYWJjX3BvcnRzID0gQklUKFBPUlRfQSk7CisJCWk5MTUt
PnZidC5kc2kuY2FiY19wb3J0cyA9IEJJVChQT1JUX0EpOwogCQlicmVhazsKIAljYXNlIERMX0RD
U19QT1JUX0M6Ci0JCWRldl9wcml2LT52YnQuZHNpLmNhYmNfcG9ydHMgPSBCSVQoUE9SVF9DKTsK
KwkJaTkxNS0+dmJ0LmRzaS5jYWJjX3BvcnRzID0gQklUKFBPUlRfQyk7CiAJCWJyZWFrOwogCWRl
ZmF1bHQ6CiAJY2FzZSBETF9EQ1NfUE9SVF9BX0FORF9DOgotCQlkZXZfcHJpdi0+dmJ0LmRzaS5j
YWJjX3BvcnRzID0KKwkJaTkxNS0+dmJ0LmRzaS5jYWJjX3BvcnRzID0KIAkJCQkJQklUKFBPUlRf
QSkgfCBCSVQoUE9SVF9DKTsKIAkJYnJlYWs7CiAJfQogfQogCiBzdGF0aWMgdm9pZAotcGFyc2Vf
bWlwaV9jb25maWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorcGFyc2VfbWlw
aV9jb25maWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCSAgY29uc3Qgc3RydWN0
IGJkYl9oZWFkZXIgKmJkYikKIHsKIAljb25zdCBzdHJ1Y3QgYmRiX21pcGlfY29uZmlnICpzdGFy
dDsKIAljb25zdCBzdHJ1Y3QgbWlwaV9jb25maWcgKmNvbmZpZzsKIAljb25zdCBzdHJ1Y3QgbWlw
aV9wcHNfZGF0YSAqcHBzOwotCWludCBwYW5lbF90eXBlID0gZGV2X3ByaXYtPnZidC5wYW5lbF90
eXBlOworCWludCBwYW5lbF90eXBlID0gaTkxNS0+dmJ0LnBhbmVsX3R5cGU7CiAJZW51bSBwb3J0
IHBvcnQ7CiAKIAkvKiBwYXJzZSBNSVBJIGJsb2NrcyBvbmx5IGlmIExGUCB0eXBlIGlzIE1JUEkg
Ki8KLQlpZiAoIWludGVsX2Jpb3NfaXNfZHNpX3ByZXNlbnQoZGV2X3ByaXYsICZwb3J0KSkKKwlp
ZiAoIWludGVsX2Jpb3NfaXNfZHNpX3ByZXNlbnQoaTkxNSwgJnBvcnQpKQogCQlyZXR1cm47CiAK
IAkvKiBJbml0aWFsaXplIHRoaXMgdG8gdW5kZWZpbmVkIGluZGljYXRpbmcgbm8gZ2VuZXJpYyBN
SVBJIHN1cHBvcnQgKi8KLQlkZXZfcHJpdi0+dmJ0LmRzaS5wYW5lbF9pZCA9IE1JUElfRFNJX1VO
REVGSU5FRF9QQU5FTF9JRDsKKwlpOTE1LT52YnQuZHNpLnBhbmVsX2lkID0gTUlQSV9EU0lfVU5E
RUZJTkVEX1BBTkVMX0lEOwogCiAJLyogQmxvY2sgIzQwIGlzIGFscmVhZHkgcGFyc2VkIGFuZCBw
YW5lbF9maXhlZF9tb2RlIGlzCi0JICogc3RvcmVkIGluIGRldl9wcml2LT5sZnBfbHZkc192YnRf
bW9kZQorCSAqIHN0b3JlZCBpbiBpOTE1LT5sZnBfbHZkc192YnRfbW9kZQogCSAqIHJlc3VzZSB0
aGlzIHdoZW4gbmVlZGVkCiAJICovCiAKQEAgLTEwNTYsMTEgKzEwNTYsMTEgQEAgcGFyc2VfbWlw
aV9jb25maWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCSAqLwogCXN0YXJ0
ID0gZmluZF9zZWN0aW9uKGJkYiwgQkRCX01JUElfQ09ORklHKTsKIAlpZiAoIXN0YXJ0KSB7Ci0J
CWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLCAiTm8gTUlQSSBjb25maWcgQkRCIGZvdW5kIik7
CisJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sICJObyBNSVBJIGNvbmZpZyBCREIgZm91bmQiKTsK
IAkJcmV0dXJuOwogCX0KIAotCWRybV9kYmcoJmRldl9wcml2LT5kcm0sICJGb3VuZCBNSVBJIENv
bmZpZyBibG9jaywgcGFuZWwgaW5kZXggPSAlZFxuIiwKKwlkcm1fZGJnKCZpOTE1LT5kcm0sICJG
b3VuZCBNSVBJIENvbmZpZyBibG9jaywgcGFuZWwgaW5kZXggPSAlZFxuIiwKIAkJcGFuZWxfdHlw
ZSk7CiAKIAkvKgpAQCAtMTA3MSwxNyArMTA3MSwxNyBAQCBwYXJzZV9taXBpX2NvbmZpZyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJcHBzID0gJnN0YXJ0LT5wcHNbcGFuZWxf
dHlwZV07CiAKIAkvKiBzdG9yZSBhcyBvZiBub3cgZnVsbCBkYXRhLiBUcmltIHdoZW4gd2UgcmVh
bGlzZSBhbGwgaXMgbm90IG5lZWRlZCAqLwotCWRldl9wcml2LT52YnQuZHNpLmNvbmZpZyA9IGtt
ZW1kdXAoY29uZmlnLCBzaXplb2Yoc3RydWN0IG1pcGlfY29uZmlnKSwgR0ZQX0tFUk5FTCk7Ci0J
aWYgKCFkZXZfcHJpdi0+dmJ0LmRzaS5jb25maWcpCisJaTkxNS0+dmJ0LmRzaS5jb25maWcgPSBr
bWVtZHVwKGNvbmZpZywgc2l6ZW9mKHN0cnVjdCBtaXBpX2NvbmZpZyksIEdGUF9LRVJORUwpOwor
CWlmICghaTkxNS0+dmJ0LmRzaS5jb25maWcpCiAJCXJldHVybjsKIAotCWRldl9wcml2LT52YnQu
ZHNpLnBwcyA9IGttZW1kdXAocHBzLCBzaXplb2Yoc3RydWN0IG1pcGlfcHBzX2RhdGEpLCBHRlBf
S0VSTkVMKTsKLQlpZiAoIWRldl9wcml2LT52YnQuZHNpLnBwcykgewotCQlrZnJlZShkZXZfcHJp
di0+dmJ0LmRzaS5jb25maWcpOworCWk5MTUtPnZidC5kc2kucHBzID0ga21lbWR1cChwcHMsIHNp
emVvZihzdHJ1Y3QgbWlwaV9wcHNfZGF0YSksIEdGUF9LRVJORUwpOworCWlmICghaTkxNS0+dmJ0
LmRzaS5wcHMpIHsKKwkJa2ZyZWUoaTkxNS0+dmJ0LmRzaS5jb25maWcpOwogCQlyZXR1cm47CiAJ
fQogCi0JcGFyc2VfZHNpX2JhY2tsaWdodF9wb3J0cyhkZXZfcHJpdiwgYmRiLT52ZXJzaW9uLCBw
b3J0KTsKKwlwYXJzZV9kc2lfYmFja2xpZ2h0X3BvcnRzKGk5MTUsIGJkYi0+dmVyc2lvbiwgcG9y
dCk7CiAKIAkvKiBGSVhNRSBpcyB0aGUgOTAgdnMuIDI3MCBjb3JyZWN0PyAqLwogCXN3aXRjaCAo
Y29uZmlnLT5yb3RhdGlvbikgewpAQCAtMTA5MCwyNSArMTA5MCwyNSBAQCBwYXJzZV9taXBpX2Nv
bmZpZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCSAqIE1vc3QgKGFsbD8p
IFZCVHMgY2xhaW0gMCBkZWdyZWVzIGRlc3BpdGUgaGF2aW5nCiAJCSAqIGFuIHVwc2lkZSBkb3du
IHBhbmVsLCB0aHVzIHdlIGRvIG5vdCB0cnVzdCB0aGlzLgogCQkgKi8KLQkJZGV2X3ByaXYtPnZi
dC5kc2kub3JpZW50YXRpb24gPQorCQlpOTE1LT52YnQuZHNpLm9yaWVudGF0aW9uID0KIAkJCURS
TV9NT0RFX1BBTkVMX09SSUVOVEFUSU9OX1VOS05PV047CiAJCWJyZWFrOwogCWNhc2UgRU5BQkxF
X1JPVEFUSU9OXzkwOgotCQlkZXZfcHJpdi0+dmJ0LmRzaS5vcmllbnRhdGlvbiA9CisJCWk5MTUt
PnZidC5kc2kub3JpZW50YXRpb24gPQogCQkJRFJNX01PREVfUEFORUxfT1JJRU5UQVRJT05fUklH
SFRfVVA7CiAJCWJyZWFrOwogCWNhc2UgRU5BQkxFX1JPVEFUSU9OXzE4MDoKLQkJZGV2X3ByaXYt
PnZidC5kc2kub3JpZW50YXRpb24gPQorCQlpOTE1LT52YnQuZHNpLm9yaWVudGF0aW9uID0KIAkJ
CURSTV9NT0RFX1BBTkVMX09SSUVOVEFUSU9OX0JPVFRPTV9VUDsKIAkJYnJlYWs7CiAJY2FzZSBF
TkFCTEVfUk9UQVRJT05fMjcwOgotCQlkZXZfcHJpdi0+dmJ0LmRzaS5vcmllbnRhdGlvbiA9CisJ
CWk5MTUtPnZidC5kc2kub3JpZW50YXRpb24gPQogCQkJRFJNX01PREVfUEFORUxfT1JJRU5UQVRJ
T05fTEVGVF9VUDsKIAkJYnJlYWs7CiAJfQogCiAJLyogV2UgaGF2ZSBtYW5kYXRvcnkgbWlwaSBj
b25maWcgYmxvY2tzLiBJbml0aWFsaXplIGFzIGdlbmVyaWMgcGFuZWwgKi8KLQlkZXZfcHJpdi0+
dmJ0LmRzaS5wYW5lbF9pZCA9IE1JUElfRFNJX0dFTkVSSUNfUEFORUxfSUQ7CisJaTkxNS0+dmJ0
LmRzaS5wYW5lbF9pZCA9IE1JUElfRFNJX0dFTkVSSUNfUEFORUxfSUQ7CiB9CiAKIC8qIEZpbmQg
dGhlIHNlcXVlbmNlIGJsb2NrIGFuZCBzaXplIGZvciB0aGUgZ2l2ZW4gcGFuZWwuICovCkBAIC0x
MjcxLDEzICsxMjcxLDEzIEBAIHN0YXRpYyBpbnQgZ290b19uZXh0X3NlcXVlbmNlX3YzKGNvbnN0
IHU4ICpkYXRhLCBpbnQgaW5kZXgsIGludCB0b3RhbCkKICAqIEdldCBsZW4gb2YgcHJlLWZpeGVk
IGRlYXNzZXJ0IGZyYWdtZW50IGZyb20gYSB2MSBpbml0IE9UUCBzZXF1ZW5jZSwKICAqIHNraXAg
YWxsIGRlbGF5ICsgZ3BpbyBvcGVyYW5kcyBhbmQgc3RvcCBhdCB0aGUgZmlyc3QgRFNJIHBhY2tl
dCBvcC4KICAqLwotc3RhdGljIGludCBnZXRfaW5pdF9vdHBfZGVhc3NlcnRfZnJhZ21lbnRfbGVu
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyBpbnQgZ2V0X2luaXRf
b3RwX2RlYXNzZXJ0X2ZyYWdtZW50X2xlbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
IHsKLQljb25zdCB1OCAqZGF0YSA9IGRldl9wcml2LT52YnQuZHNpLnNlcXVlbmNlW01JUElfU0VR
X0lOSVRfT1RQXTsKKwljb25zdCB1OCAqZGF0YSA9IGk5MTUtPnZidC5kc2kuc2VxdWVuY2VbTUlQ
SV9TRVFfSU5JVF9PVFBdOwogCWludCBpbmRleCwgbGVuOwogCi0JaWYgKGRybV9XQVJOX09OKCZk
ZXZfcHJpdi0+ZHJtLAotCQkJIWRhdGEgfHwgZGV2X3ByaXYtPnZidC5kc2kuc2VxX3ZlcnNpb24g
IT0gMSkpCisJaWYgKGRybV9XQVJOX09OKCZpOTE1LT5kcm0sCisJCQkhZGF0YSB8fCBpOTE1LT52
YnQuZHNpLnNlcV92ZXJzaW9uICE9IDEpKQogCQlyZXR1cm4gMDsKIAogCS8qIGluZGV4ID0gMSB0
byBza2lwIHNlcXVlbmNlIGJ5dGUgKi8KQEAgLTEzMDUsNTUgKzEzMDUsNTUgQEAgc3RhdGljIGlu
dCBnZXRfaW5pdF9vdHBfZGVhc3NlcnRfZnJhZ21lbnRfbGVuKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKICAqIHRoZXNlIGRldmljZXMgd2Ugc3BsaXQgdGhlIGluaXQgT1RQIHNl
cXVlbmNlIGludG8gYSBkZWFzc2VydCBzZXF1ZW5jZSBhbmQKICAqIHRoZSBhY3R1YWwgaW5pdCBP
VFAgcGFydC4KICAqLwotc3RhdGljIHZvaWQgZml4dXBfbWlwaV9zZXF1ZW5jZXMoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgZml4dXBfbWlwaV9zZXF1ZW5j
ZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJdTggKmluaXRfb3RwOwogCWlu
dCBsZW47CiAKIAkvKiBMaW1pdCB0aGlzIHRvIFZMViBmb3Igbm93LiAqLwotCWlmICghSVNfVkFM
TEVZVklFVyhkZXZfcHJpdikpCisJaWYgKCFJU19WQUxMRVlWSUVXKGk5MTUpKQogCQlyZXR1cm47
CiAKIAkvKiBMaW1pdCB0aGlzIHRvIHYxIHZpZC1tb2RlIHNlcXVlbmNlcyAqLwotCWlmIChkZXZf
cHJpdi0+dmJ0LmRzaS5jb25maWctPmlzX2NtZF9tb2RlIHx8Ci0JICAgIGRldl9wcml2LT52YnQu
ZHNpLnNlcV92ZXJzaW9uICE9IDEpCisJaWYgKGk5MTUtPnZidC5kc2kuY29uZmlnLT5pc19jbWRf
bW9kZSB8fAorCSAgICBpOTE1LT52YnQuZHNpLnNlcV92ZXJzaW9uICE9IDEpCiAJCXJldHVybjsK
IAogCS8qIE9ubHkgZG8gdGhpcyBpZiB0aGVyZSBhcmUgb3RwIGFuZCBhc3NlcnQgc2VxcyBhbmQg
bm8gZGVhc3NlcnQgc2VxICovCi0JaWYgKCFkZXZfcHJpdi0+dmJ0LmRzaS5zZXF1ZW5jZVtNSVBJ
X1NFUV9JTklUX09UUF0gfHwKLQkgICAgIWRldl9wcml2LT52YnQuZHNpLnNlcXVlbmNlW01JUElf
U0VRX0FTU0VSVF9SRVNFVF0gfHwKLQkgICAgZGV2X3ByaXYtPnZidC5kc2kuc2VxdWVuY2VbTUlQ
SV9TRVFfREVBU1NFUlRfUkVTRVRdKQorCWlmICghaTkxNS0+dmJ0LmRzaS5zZXF1ZW5jZVtNSVBJ
X1NFUV9JTklUX09UUF0gfHwKKwkgICAgIWk5MTUtPnZidC5kc2kuc2VxdWVuY2VbTUlQSV9TRVFf
QVNTRVJUX1JFU0VUXSB8fAorCSAgICBpOTE1LT52YnQuZHNpLnNlcXVlbmNlW01JUElfU0VRX0RF
QVNTRVJUX1JFU0VUXSkKIAkJcmV0dXJuOwogCiAJLyogVGhlIGRlYXNzZXJ0LXNlcXVlbmNlIGVu
ZHMgYXQgdGhlIGZpcnN0IERTSSBwYWNrZXQgKi8KLQlsZW4gPSBnZXRfaW5pdF9vdHBfZGVhc3Nl
cnRfZnJhZ21lbnRfbGVuKGRldl9wcml2KTsKKwlsZW4gPSBnZXRfaW5pdF9vdHBfZGVhc3NlcnRf
ZnJhZ21lbnRfbGVuKGk5MTUpOwogCWlmICghbGVuKQogCQlyZXR1cm47CiAKLQlkcm1fZGJnX2tt
cygmZGV2X3ByaXYtPmRybSwKKwlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAogCQkgICAgIlVzaW5n
IGluaXQgT1RQIGZyYWdtZW50IHRvIGRlYXNzZXJ0IHJlc2V0XG4iKTsKIAogCS8qIENvcHkgdGhl
IGZyYWdtZW50LCB1cGRhdGUgc2VxIGJ5dGUgYW5kIHRlcm1pbmF0ZSBpdCAqLwotCWluaXRfb3Rw
ID0gKHU4ICopZGV2X3ByaXYtPnZidC5kc2kuc2VxdWVuY2VbTUlQSV9TRVFfSU5JVF9PVFBdOwot
CWRldl9wcml2LT52YnQuZHNpLmRlYXNzZXJ0X3NlcSA9IGttZW1kdXAoaW5pdF9vdHAsIGxlbiAr
IDEsIEdGUF9LRVJORUwpOwotCWlmICghZGV2X3ByaXYtPnZidC5kc2kuZGVhc3NlcnRfc2VxKQor
CWluaXRfb3RwID0gKHU4ICopaTkxNS0+dmJ0LmRzaS5zZXF1ZW5jZVtNSVBJX1NFUV9JTklUX09U
UF07CisJaTkxNS0+dmJ0LmRzaS5kZWFzc2VydF9zZXEgPSBrbWVtZHVwKGluaXRfb3RwLCBsZW4g
KyAxLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWk5MTUtPnZidC5kc2kuZGVhc3NlcnRfc2VxKQogCQly
ZXR1cm47Ci0JZGV2X3ByaXYtPnZidC5kc2kuZGVhc3NlcnRfc2VxWzBdID0gTUlQSV9TRVFfREVB
U1NFUlRfUkVTRVQ7Ci0JZGV2X3ByaXYtPnZidC5kc2kuZGVhc3NlcnRfc2VxW2xlbl0gPSBNSVBJ
X1NFUV9FTEVNX0VORDsKKwlpOTE1LT52YnQuZHNpLmRlYXNzZXJ0X3NlcVswXSA9IE1JUElfU0VR
X0RFQVNTRVJUX1JFU0VUOworCWk5MTUtPnZidC5kc2kuZGVhc3NlcnRfc2VxW2xlbl0gPSBNSVBJ
X1NFUV9FTEVNX0VORDsKIAkvKiBVc2UgdGhlIGNvcHkgZm9yIGRlYXNzZXJ0ICovCi0JZGV2X3By
aXYtPnZidC5kc2kuc2VxdWVuY2VbTUlQSV9TRVFfREVBU1NFUlRfUkVTRVRdID0KLQkJZGV2X3By
aXYtPnZidC5kc2kuZGVhc3NlcnRfc2VxOworCWk5MTUtPnZidC5kc2kuc2VxdWVuY2VbTUlQSV9T
RVFfREVBU1NFUlRfUkVTRVRdID0KKwkJaTkxNS0+dmJ0LmRzaS5kZWFzc2VydF9zZXE7CiAJLyog
UmVwbGFjZSB0aGUgbGFzdCBieXRlIG9mIHRoZSBmcmFnbWVudCB3aXRoIGluaXQgT1RQIHNlcSBi
eXRlICovCiAJaW5pdF9vdHBbbGVuIC0gMV0gPSBNSVBJX1NFUV9JTklUX09UUDsKIAkvKiBBbmQg
bWFrZSBNSVBJX01JUElfU0VRX0lOSVRfT1RQIHBvaW50IHRvIGl0ICovCi0JZGV2X3ByaXYtPnZi
dC5kc2kuc2VxdWVuY2VbTUlQSV9TRVFfSU5JVF9PVFBdID0gaW5pdF9vdHAgKyBsZW4gLSAxOwor
CWk5MTUtPnZidC5kc2kuc2VxdWVuY2VbTUlQSV9TRVFfSU5JVF9PVFBdID0gaW5pdF9vdHAgKyBs
ZW4gLSAxOwogfQogCiBzdGF0aWMgdm9pZAotcGFyc2VfbWlwaV9zZXF1ZW5jZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitwYXJzZV9taXBpX3NlcXVlbmNlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogCQkgICAgY29uc3Qgc3RydWN0IGJkYl9oZWFkZXIgKmJkYikK
IHsKLQlpbnQgcGFuZWxfdHlwZSA9IGRldl9wcml2LT52YnQucGFuZWxfdHlwZTsKKwlpbnQgcGFu
ZWxfdHlwZSA9IGk5MTUtPnZidC5wYW5lbF90eXBlOwogCWNvbnN0IHN0cnVjdCBiZGJfbWlwaV9z
ZXF1ZW5jZSAqc2VxdWVuY2U7CiAJY29uc3QgdTggKnNlcV9kYXRhOwogCXUzMiBzZXFfc2l6ZTsK
QEAgLTEzNjEsMjUgKzEzNjEsMjUgQEAgcGFyc2VfbWlwaV9zZXF1ZW5jZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaW50IGluZGV4ID0gMDsKIAogCS8qIE9ubHkgb3VyIGdl
bmVyaWMgcGFuZWwgZHJpdmVyIHVzZXMgdGhlIHNlcXVlbmNlIGJsb2NrLiAqLwotCWlmIChkZXZf
cHJpdi0+dmJ0LmRzaS5wYW5lbF9pZCAhPSBNSVBJX0RTSV9HRU5FUklDX1BBTkVMX0lEKQorCWlm
IChpOTE1LT52YnQuZHNpLnBhbmVsX2lkICE9IE1JUElfRFNJX0dFTkVSSUNfUEFORUxfSUQpCiAJ
CXJldHVybjsKIAogCXNlcXVlbmNlID0gZmluZF9zZWN0aW9uKGJkYiwgQkRCX01JUElfU0VRVUVO
Q0UpOwogCWlmICghc2VxdWVuY2UpIHsKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJ
CWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCiAJCQkgICAgIk5vIE1JUEkgU2VxdWVuY2UgZm91bmQs
IHBhcnNpbmcgY29tcGxldGVcbiIpOwogCQlyZXR1cm47CiAJfQogCiAJLyogRmFpbCBncmFjZWZ1
bGx5IGZvciBmb3J3YXJkIGluY29tcGF0aWJsZSBzZXF1ZW5jZSBibG9jay4gKi8KIAlpZiAoc2Vx
dWVuY2UtPnZlcnNpb24gPj0gNCkgewotCQlkcm1fZXJyKCZkZXZfcHJpdi0+ZHJtLAorCQlkcm1f
ZXJyKCZpOTE1LT5kcm0sCiAJCQkiVW5hYmxlIHRvIHBhcnNlIE1JUEkgU2VxdWVuY2UgQmxvY2sg
diV1XG4iLAogCQkJc2VxdWVuY2UtPnZlcnNpb24pOwogCQlyZXR1cm47CiAJfQogCi0JZHJtX2Ri
ZygmZGV2X3ByaXYtPmRybSwgIkZvdW5kIE1JUEkgc2VxdWVuY2UgYmxvY2sgdiV1XG4iLAorCWRy
bV9kYmcoJmk5MTUtPmRybSwgIkZvdW5kIE1JUEkgc2VxdWVuY2UgYmxvY2sgdiV1XG4iLAogCQlz
ZXF1ZW5jZS0+dmVyc2lvbik7CiAKIAlzZXFfZGF0YSA9IGZpbmRfcGFuZWxfc2VxdWVuY2VfYmxv
Y2soc2VxdWVuY2UsIHBhbmVsX3R5cGUsICZzZXFfc2l6ZSk7CkBAIC0xMzk3LDQxICsxMzk3LDQx
IEBAIHBhcnNlX21pcGlfc2VxdWVuY2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAogCQkJYnJlYWs7CiAKIAkJaWYgKHNlcV9pZCA+PSBNSVBJX1NFUV9NQVgpIHsKLQkJCWRybV9l
cnIoJmRldl9wcml2LT5kcm0sICJVbmtub3duIHNlcXVlbmNlICV1XG4iLAorCQkJZHJtX2Vycigm
aTkxNS0+ZHJtLCAiVW5rbm93biBzZXF1ZW5jZSAldVxuIiwKIAkJCQlzZXFfaWQpOwogCQkJZ290
byBlcnI7CiAJCX0KIAogCQkvKiBMb2cgYWJvdXQgcHJlc2VuY2Ugb2Ygc2VxdWVuY2VzIHdlIHdv
bid0IHJ1bi4gKi8KIAkJaWYgKHNlcV9pZCA9PSBNSVBJX1NFUV9URUFSX09OIHx8IHNlcV9pZCA9
PSBNSVBJX1NFUV9URUFSX09GRikKLQkJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJ
ZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKIAkJCQkgICAgIlVuc3VwcG9ydGVkIHNlcXVlbmNlICV1
XG4iLCBzZXFfaWQpOwogCi0JCWRldl9wcml2LT52YnQuZHNpLnNlcXVlbmNlW3NlcV9pZF0gPSBk
YXRhICsgaW5kZXg7CisJCWk5MTUtPnZidC5kc2kuc2VxdWVuY2Vbc2VxX2lkXSA9IGRhdGEgKyBp
bmRleDsKIAogCQlpZiAoc2VxdWVuY2UtPnZlcnNpb24gPj0gMykKIAkJCWluZGV4ID0gZ290b19u
ZXh0X3NlcXVlbmNlX3YzKGRhdGEsIGluZGV4LCBzZXFfc2l6ZSk7CiAJCWVsc2UKIAkJCWluZGV4
ID0gZ290b19uZXh0X3NlcXVlbmNlKGRhdGEsIGluZGV4LCBzZXFfc2l6ZSk7CiAJCWlmICghaW5k
ZXgpIHsKLQkJCWRybV9lcnIoJmRldl9wcml2LT5kcm0sICJJbnZhbGlkIHNlcXVlbmNlICV1XG4i
LAorCQkJZHJtX2VycigmaTkxNS0+ZHJtLCAiSW52YWxpZCBzZXF1ZW5jZSAldVxuIiwKIAkJCQlz
ZXFfaWQpOwogCQkJZ290byBlcnI7CiAJCX0KIAl9CiAKLQlkZXZfcHJpdi0+dmJ0LmRzaS5kYXRh
ID0gZGF0YTsKLQlkZXZfcHJpdi0+dmJ0LmRzaS5zaXplID0gc2VxX3NpemU7Ci0JZGV2X3ByaXYt
PnZidC5kc2kuc2VxX3ZlcnNpb24gPSBzZXF1ZW5jZS0+dmVyc2lvbjsKKwlpOTE1LT52YnQuZHNp
LmRhdGEgPSBkYXRhOworCWk5MTUtPnZidC5kc2kuc2l6ZSA9IHNlcV9zaXplOworCWk5MTUtPnZi
dC5kc2kuc2VxX3ZlcnNpb24gPSBzZXF1ZW5jZS0+dmVyc2lvbjsKIAotCWZpeHVwX21pcGlfc2Vx
dWVuY2VzKGRldl9wcml2KTsKKwlmaXh1cF9taXBpX3NlcXVlbmNlcyhpOTE1KTsKIAotCWRybV9k
YmcoJmRldl9wcml2LT5kcm0sICJNSVBJIHJlbGF0ZWQgVkJUIHBhcnNpbmcgY29tcGxldGVcbiIp
OworCWRybV9kYmcoJmk5MTUtPmRybSwgIk1JUEkgcmVsYXRlZCBWQlQgcGFyc2luZyBjb21wbGV0
ZVxuIik7CiAJcmV0dXJuOwogCiBlcnI6CiAJa2ZyZWUoZGF0YSk7Ci0JbWVtc2V0KGRldl9wcml2
LT52YnQuZHNpLnNlcXVlbmNlLCAwLCBzaXplb2YoZGV2X3ByaXYtPnZidC5kc2kuc2VxdWVuY2Up
KTsKKwltZW1zZXQoaTkxNS0+dmJ0LmRzaS5zZXF1ZW5jZSwgMCwgc2l6ZW9mKGk5MTUtPnZidC5k
c2kuc2VxdWVuY2UpKTsKIH0KIAogc3RhdGljIHZvaWQKQEAgLTE1MTUsMTggKzE1MTUsMTggQEAg
c3RhdGljIGVudW0gcG9ydCBnZXRfcG9ydF9ieV9kZGNfcGluKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LCB1OCBkZGNfcGluKQogCXJldHVybiBQT1JUX05PTkU7CiB9CiAKLXN0YXRpYyB2
b2lkIHNhbml0aXplX2RkY19waW4oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAor
c3RhdGljIHZvaWQgc2FuaXRpemVfZGRjX3BpbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKIAkJCSAgICAgZW51bSBwb3J0IHBvcnQpCiB7Ci0Jc3RydWN0IGRkaV92YnRfcG9ydF9pbmZv
ICppbmZvID0gJmRldl9wcml2LT52YnQuZGRpX3BvcnRfaW5mb1twb3J0XTsKKwlzdHJ1Y3QgZGRp
X3ZidF9wb3J0X2luZm8gKmluZm8gPSAmaTkxNS0+dmJ0LmRkaV9wb3J0X2luZm9bcG9ydF07CiAJ
ZW51bSBwb3J0IHA7CiAKIAlpZiAoIWluZm8tPmFsdGVybmF0ZV9kZGNfcGluKQogCQlyZXR1cm47
CiAKLQlwID0gZ2V0X3BvcnRfYnlfZGRjX3BpbihkZXZfcHJpdiwgaW5mby0+YWx0ZXJuYXRlX2Rk
Y19waW4pOworCXAgPSBnZXRfcG9ydF9ieV9kZGNfcGluKGk5MTUsIGluZm8tPmFsdGVybmF0ZV9k
ZGNfcGluKTsKIAlpZiAocCAhPSBQT1JUX05PTkUpIHsKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2
LT5kcm0sCisJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCiAJCQkgICAgInBvcnQgJWMgdHJ5aW5n
IHRvIHVzZSB0aGUgc2FtZSBEREMgcGluICgweCV4KSBhcyBwb3J0ICVjLCAiCiAJCQkgICAgImRp
c2FibGluZyBwb3J0ICVjIERWSS9IRE1JIHN1cHBvcnRcbiIsCiAJCQkgICAgcG9ydF9uYW1lKHBv
cnQpLCBpbmZvLT5hbHRlcm5hdGVfZGRjX3BpbiwKQEAgLTE1NDQsNyArMTU0NCw3IEBAIHN0YXRp
YyB2b2lkIHNhbml0aXplX2RkY19waW4oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAogCQkgKiBwb3J0IEEgYW5kIHBvcnQgRSB3aXRoIHRoZSBzYW1lIEFVWCBjaCBhbmQKIAkJICog
d2UgbXVzdCBwaWNrIHBvcnQgRSA6KAogCQkgKi8KLQkJaW5mbyA9ICZkZXZfcHJpdi0+dmJ0LmRk
aV9wb3J0X2luZm9bcF07CisJCWluZm8gPSAmaTkxNS0+dmJ0LmRkaV9wb3J0X2luZm9bcF07CiAK
IAkJaW5mby0+c3VwcG9ydHNfZHZpID0gZmFsc2U7CiAJCWluZm8tPnN1cHBvcnRzX2hkbWkgPSBm
YWxzZTsKQEAgLTE1NjcsMTggKzE1NjcsMTggQEAgc3RhdGljIGVudW0gcG9ydCBnZXRfcG9ydF9i
eV9hdXhfY2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHU4IGF1eF9jaCkKIAlyZXR1
cm4gUE9SVF9OT05FOwogfQogCi1zdGF0aWMgdm9pZCBzYW5pdGl6ZV9hdXhfY2goc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgc2FuaXRpemVfYXV4X2NoKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgIGVudW0gcG9ydCBwb3J0KQogewot
CXN0cnVjdCBkZGlfdmJ0X3BvcnRfaW5mbyAqaW5mbyA9ICZkZXZfcHJpdi0+dmJ0LmRkaV9wb3J0
X2luZm9bcG9ydF07CisJc3RydWN0IGRkaV92YnRfcG9ydF9pbmZvICppbmZvID0gJmk5MTUtPnZi
dC5kZGlfcG9ydF9pbmZvW3BvcnRdOwogCWVudW0gcG9ydCBwOwogCiAJaWYgKCFpbmZvLT5hbHRl
cm5hdGVfYXV4X2NoYW5uZWwpCiAJCXJldHVybjsKIAotCXAgPSBnZXRfcG9ydF9ieV9hdXhfY2go
ZGV2X3ByaXYsIGluZm8tPmFsdGVybmF0ZV9hdXhfY2hhbm5lbCk7CisJcCA9IGdldF9wb3J0X2J5
X2F1eF9jaChpOTE1LCBpbmZvLT5hbHRlcm5hdGVfYXV4X2NoYW5uZWwpOwogCWlmIChwICE9IFBP
UlRfTk9ORSkgewotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwkJZHJtX2RiZ19rbXMo
Jmk5MTUtPmRybSwKIAkJCSAgICAicG9ydCAlYyB0cnlpbmcgdG8gdXNlIHRoZSBzYW1lIEFVWCBD
SCAoMHgleCkgYXMgcG9ydCAlYywgIgogCQkJICAgICJkaXNhYmxpbmcgcG9ydCAlYyBEUCBzdXBw
b3J0XG4iLAogCQkJICAgIHBvcnRfbmFtZShwb3J0KSwgaW5mby0+YWx0ZXJuYXRlX2F1eF9jaGFu
bmVsLApAQCAtMTU5Niw3ICsxNTk2LDcgQEAgc3RhdGljIHZvaWQgc2FuaXRpemVfYXV4X2NoKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJICogcG9ydCBBIGFuZCBwb3J0IEUg
d2l0aCB0aGUgc2FtZSBBVVggY2ggYW5kCiAJCSAqIHdlIG11c3QgcGljayBwb3J0IEUgOigKIAkJ
ICovCi0JCWluZm8gPSAmZGV2X3ByaXYtPnZidC5kZGlfcG9ydF9pbmZvW3BdOworCQlpbmZvID0g
Jmk5MTUtPnZidC5kZGlfcG9ydF9pbmZvW3BdOwogCiAJCWluZm8tPnN1cHBvcnRzX2RwID0gZmFs
c2U7CiAJCWluZm8tPmFsdGVybmF0ZV9hdXhfY2hhbm5lbCA9IDA7CkBAIC0xNjQ0LDI2ICsxNjQ0
LDI2IEBAIHN0YXRpYyBjb25zdCB1OCBnZW45YmNfdGdwX2RkY19waW5fbWFwW10gPSB7CiAJW0RE
Q19CVVNfRERJX0RdID0gR01CVVNfUElOXzEwX1RDMl9JQ1AsCiB9OwogCi1zdGF0aWMgdTggbWFw
X2RkY19waW4oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1OCB2YnRfcGluKQor
c3RhdGljIHU4IG1hcF9kZGNfcGluKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1OCB2
YnRfcGluKQogewogCWNvbnN0IHU4ICpkZGNfcGluX21hcDsKIAlpbnQgbl9lbnRyaWVzOwogCi0J
aWYgKEhBU19QQ0hfQURQKGRldl9wcml2KSkgeworCWlmIChIQVNfUENIX0FEUChpOTE1KSkgewog
CQlkZGNfcGluX21hcCA9IGFkbHNfZGRjX3Bpbl9tYXA7CiAJCW5fZW50cmllcyA9IEFSUkFZX1NJ
WkUoYWRsc19kZGNfcGluX21hcCk7Ci0JfSBlbHNlIGlmIChJTlRFTF9QQ0hfVFlQRShkZXZfcHJp
dikgPj0gUENIX0RHMSkgeworCX0gZWxzZSBpZiAoSU5URUxfUENIX1RZUEUoaTkxNSkgPj0gUENI
X0RHMSkgewogCQlyZXR1cm4gdmJ0X3BpbjsKLQl9IGVsc2UgaWYgKElTX1JPQ0tFVExBS0UoZGV2
X3ByaXYpICYmIElOVEVMX1BDSF9UWVBFKGRldl9wcml2KSA9PSBQQ0hfVEdQKSB7CisJfSBlbHNl
IGlmIChJU19ST0NLRVRMQUtFKGk5MTUpICYmIElOVEVMX1BDSF9UWVBFKGk5MTUpID09IFBDSF9U
R1ApIHsKIAkJZGRjX3Bpbl9tYXAgPSBya2xfcGNoX3RncF9kZGNfcGluX21hcDsKIAkJbl9lbnRy
aWVzID0gQVJSQVlfU0laRShya2xfcGNoX3RncF9kZGNfcGluX21hcCk7Ci0JfSBlbHNlIGlmIChI
QVNfUENIX1RHUChkZXZfcHJpdikgJiYgSVNfR0VOOV9CQyhkZXZfcHJpdikpIHsKKwl9IGVsc2Ug
aWYgKEhBU19QQ0hfVEdQKGk5MTUpICYmIElTX0dFTjlfQkMoaTkxNSkpIHsKIAkJZGRjX3Bpbl9t
YXAgPSBnZW45YmNfdGdwX2RkY19waW5fbWFwOwogCQluX2VudHJpZXMgPSBBUlJBWV9TSVpFKGdl
bjliY190Z3BfZGRjX3Bpbl9tYXApOwotCX0gZWxzZSBpZiAoSU5URUxfUENIX1RZUEUoZGV2X3By
aXYpID49IFBDSF9JQ1ApIHsKKwl9IGVsc2UgaWYgKElOVEVMX1BDSF9UWVBFKGk5MTUpID49IFBD
SF9JQ1ApIHsKIAkJZGRjX3Bpbl9tYXAgPSBpY3BfZGRjX3Bpbl9tYXA7CiAJCW5fZW50cmllcyA9
IEFSUkFZX1NJWkUoaWNwX2RkY19waW5fbWFwKTsKLQl9IGVsc2UgaWYgKEhBU19QQ0hfQ05QKGRl
dl9wcml2KSkgeworCX0gZWxzZSBpZiAoSEFTX1BDSF9DTlAoaTkxNSkpIHsKIAkJZGRjX3Bpbl9t
YXAgPSBjbnBfZGRjX3Bpbl9tYXA7CiAJCW5fZW50cmllcyA9IEFSUkFZX1NJWkUoY25wX2RkY19w
aW5fbWFwKTsKIAl9IGVsc2UgewpAQCAtMTY3NCw3ICsxNjc0LDcgQEAgc3RhdGljIHU4IG1hcF9k
ZGNfcGluKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTggdmJ0X3BpbikKIAlp
ZiAodmJ0X3BpbiA8IG5fZW50cmllcyAmJiBkZGNfcGluX21hcFt2YnRfcGluXSAhPSAwKQogCQly
ZXR1cm4gZGRjX3Bpbl9tYXBbdmJ0X3Bpbl07CiAKLQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRy
bSwKKwlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAogCQkgICAgIklnbm9yaW5nIGFsdGVybmF0ZSBw
aW46IFZCVCBjbGFpbXMgRERDIHBpbiAlZCwgd2hpY2ggaXMgbm90IHZhbGlkIGZvciB0aGlzIHBs
YXRmb3JtXG4iLAogCQkgICAgdmJ0X3Bpbik7CiAJcmV0dXJuIDA7CkBAIC0xNjk5LDcgKzE2OTks
NyBAQCBzdGF0aWMgZW51bSBwb3J0IF9fZHZvX3BvcnRfdG9fcG9ydChpbnQgbl9wb3J0cywgaW50
IG5fZHZvLAogCXJldHVybiBQT1JUX05PTkU7CiB9CiAKLXN0YXRpYyBlbnVtIHBvcnQgZHZvX3Bv
cnRfdG9fcG9ydChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgZW51
bSBwb3J0IGR2b19wb3J0X3RvX3BvcnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJ
CQkJICB1OCBkdm9fcG9ydCkKIHsKIAkvKgpAQCAtMTc0MiwxMiArMTc0MiwxMiBAQCBzdGF0aWMg
ZW51bSBwb3J0IGR2b19wb3J0X3RvX3BvcnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAogCQlbUE9SVF9UQzRdID0geyBEVk9fUE9SVF9IRE1JRSwgRFZPX1BPUlRfRFBFLCAtMSB9
LAogCX07CiAKLQlpZiAoSVNfQUxERVJMQUtFX1MoZGV2X3ByaXYpKQorCWlmIChJU19BTERFUkxB
S0VfUyhpOTE1KSkKIAkJcmV0dXJuIF9fZHZvX3BvcnRfdG9fcG9ydChBUlJBWV9TSVpFKGFkbHNf
cG9ydF9tYXBwaW5nKSwKIAkJCQkJICBBUlJBWV9TSVpFKGFkbHNfcG9ydF9tYXBwaW5nWzBdKSwK
IAkJCQkJICBhZGxzX3BvcnRfbWFwcGluZywKIAkJCQkJICBkdm9fcG9ydCk7Ci0JZWxzZSBpZiAo
SVNfREcxKGRldl9wcml2KSB8fCBJU19ST0NLRVRMQUtFKGRldl9wcml2KSkKKwllbHNlIGlmIChJ
U19ERzEoaTkxNSkgfHwgSVNfUk9DS0VUTEFLRShpOTE1KSkKIAkJcmV0dXJuIF9fZHZvX3BvcnRf
dG9fcG9ydChBUlJBWV9TSVpFKHJrbF9wb3J0X21hcHBpbmcpLAogCQkJCQkgIEFSUkFZX1NJWkUo
cmtsX3BvcnRfbWFwcGluZ1swXSksCiAJCQkJCSAgcmtsX3BvcnRfbWFwcGluZywKQEAgLTE3NTks
NyArMTc1OSw3IEBAIHN0YXRpYyBlbnVtIHBvcnQgZHZvX3BvcnRfdG9fcG9ydChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkJCSAgZHZvX3BvcnQpOwogfQogCi1zdGF0aWMg
dm9pZCBwYXJzZV9kZGlfcG9ydChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitz
dGF0aWMgdm9pZCBwYXJzZV9kZGlfcG9ydChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAkJCSAgIHN0cnVjdCBkaXNwbGF5X2RldmljZV9kYXRhICpkZXZkYXRhLAogCQkJICAgdTggYmRi
X3ZlcnNpb24pCiB7CkBAIC0xNzY4LDE0ICsxNzY4LDE0IEBAIHN0YXRpYyB2b2lkIHBhcnNlX2Rk
aV9wb3J0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlib29sIGlzX2R2aSwg
aXNfaGRtaSwgaXNfZHAsIGlzX2VkcCwgaXNfY3J0OwogCWVudW0gcG9ydCBwb3J0OwogCi0JcG9y
dCA9IGR2b19wb3J0X3RvX3BvcnQoZGV2X3ByaXYsIGNoaWxkLT5kdm9fcG9ydCk7CisJcG9ydCA9
IGR2b19wb3J0X3RvX3BvcnQoaTkxNSwgY2hpbGQtPmR2b19wb3J0KTsKIAlpZiAocG9ydCA9PSBQ
T1JUX05PTkUpCiAJCXJldHVybjsKIAotCWluZm8gPSAmZGV2X3ByaXYtPnZidC5kZGlfcG9ydF9p
bmZvW3BvcnRdOworCWluZm8gPSAmaTkxNS0+dmJ0LmRkaV9wb3J0X2luZm9bcG9ydF07CiAKIAlp
ZiAoaW5mby0+Y2hpbGQpIHsKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCWRybV9k
Ymdfa21zKCZpOTE1LT5kcm0sCiAJCQkgICAgIk1vcmUgdGhhbiBvbmUgY2hpbGQgZGV2aWNlIGZv
ciBwb3J0ICVjIGluIFZCVCwgdXNpbmcgdGhlIGZpcnN0LlxuIiwKIAkJCSAgICBwb3J0X25hbWUo
cG9ydCkpOwogCQlyZXR1cm47CkBAIC0xNzg3LDggKzE3ODcsOCBAQCBzdGF0aWMgdm9pZCBwYXJz
ZV9kZGlfcG9ydChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaXNfaGRtaSA9
IGlzX2R2aSAmJiAoY2hpbGQtPmRldmljZV90eXBlICYgREVWSUNFX1RZUEVfTk9UX0hETUlfT1VU
UFVUKSA9PSAwOwogCWlzX2VkcCA9IGlzX2RwICYmIChjaGlsZC0+ZGV2aWNlX3R5cGUgJiBERVZJ
Q0VfVFlQRV9JTlRFUk5BTF9DT05ORUNUT1IpOwogCi0JaWYgKHBvcnQgPT0gUE9SVF9BICYmIGlz
X2R2aSAmJiBJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTIpIHsKLQkJZHJtX2RiZ19rbXMoJmRldl9w
cml2LT5kcm0sCisJaWYgKHBvcnQgPT0gUE9SVF9BICYmIGlzX2R2aSAmJiBJTlRFTF9HRU4oaTkx
NSkgPCAxMikgeworCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAogCQkJICAgICJWQlQgY2xhaW1z
IHBvcnQgQSBzdXBwb3J0cyBEVkklcywgaWdub3JpbmdcbiIsCiAJCQkgICAgaXNfaGRtaSA/ICIv
SERNSSIgOiAiIik7CiAJCWlzX2R2aSA9IGZhbHNlOwpAQCAtMTgwNiwyMiArMTgwNiwyMiBAQCBz
dGF0aWMgdm9pZCBwYXJzZV9kZGlfcG9ydChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCiAJaWYgKGJkYl92ZXJzaW9uID49IDIwOSkKIAkJaW5mby0+c3VwcG9ydHNfdGJ0ID0gY2hp
bGQtPnRidDsKIAotCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCWRybV9kYmdfa21zKCZp
OTE1LT5kcm0sCiAJCSAgICAiUG9ydCAlYyBWQlQgaW5mbzogQ1JUOiVkIERWSTolZCBIRE1JOiVk
IERQOiVkIGVEUDolZCBMU1BDT046JWQgVVNCLVR5cGUtQzolZCBUQlQ6JWQgRFNDOiVkXG4iLAog
CQkgICAgcG9ydF9uYW1lKHBvcnQpLCBpc19jcnQsIGlzX2R2aSwgaXNfaGRtaSwgaXNfZHAsIGlz
X2VkcCwKLQkJICAgIEhBU19MU1BDT04oZGV2X3ByaXYpICYmIGNoaWxkLT5sc3Bjb24sCisJCSAg
ICBIQVNfTFNQQ09OKGk5MTUpICYmIGNoaWxkLT5sc3Bjb24sCiAJCSAgICBpbmZvLT5zdXBwb3J0
c190eXBlY191c2IsIGluZm8tPnN1cHBvcnRzX3RidCwKIAkJICAgIGRldmRhdGEtPmRzYyAhPSBO
VUxMKTsKIAogCWlmIChpc19kdmkpIHsKIAkJdTggZGRjX3BpbjsKIAotCQlkZGNfcGluID0gbWFw
X2RkY19waW4oZGV2X3ByaXYsIGNoaWxkLT5kZGNfcGluKTsKLQkJaWYgKGludGVsX2dtYnVzX2lz
X3ZhbGlkX3BpbihkZXZfcHJpdiwgZGRjX3BpbikpIHsKKwkJZGRjX3BpbiA9IG1hcF9kZGNfcGlu
KGk5MTUsIGNoaWxkLT5kZGNfcGluKTsKKwkJaWYgKGludGVsX2dtYnVzX2lzX3ZhbGlkX3Bpbihp
OTE1LCBkZGNfcGluKSkgewogCQkJaW5mby0+YWx0ZXJuYXRlX2RkY19waW4gPSBkZGNfcGluOwot
CQkJc2FuaXRpemVfZGRjX3BpbihkZXZfcHJpdiwgcG9ydCk7CisJCQlzYW5pdGl6ZV9kZGNfcGlu
KGk5MTUsIHBvcnQpOwogCQl9IGVsc2UgewotCQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0s
CisJCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAogCQkJCSAgICAiUG9ydCAlYyBoYXMgaW52YWxp
ZCBEREMgcGluICVkLCAiCiAJCQkJICAgICJzdGlja2luZyB0byBkZWZhdWx0c1xuIiwKIAkJCQkg
ICAgcG9ydF9uYW1lKHBvcnQpLCBkZGNfcGluKTsKQEAgLTE4MzEsMTMgKzE4MzEsMTMgQEAgc3Rh
dGljIHZvaWQgcGFyc2VfZGRpX3BvcnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAogCWlmIChpc19kcCkgewogCQlpbmZvLT5hbHRlcm5hdGVfYXV4X2NoYW5uZWwgPSBjaGlsZC0+
YXV4X2NoYW5uZWw7CiAKLQkJc2FuaXRpemVfYXV4X2NoKGRldl9wcml2LCBwb3J0KTsKKwkJc2Fu
aXRpemVfYXV4X2NoKGk5MTUsIHBvcnQpOwogCX0KIAogCWlmIChiZGJfdmVyc2lvbiA+PSAxNTgp
IHsKIAkJLyogVGhlIFZCVCBIRE1JIGxldmVsIHNoaWZ0IHZhbHVlcyBtYXRjaCB0aGUgdGFibGUg
d2UgaGF2ZS4gKi8KIAkJdTggaGRtaV9sZXZlbF9zaGlmdCA9IGNoaWxkLT5oZG1pX2xldmVsX3No
aWZ0ZXJfdmFsdWU7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQlkcm1fZGJnX2tt
cygmaTkxNS0+ZHJtLAogCQkJICAgICJQb3J0ICVjIFZCVCBIRE1JIGxldmVsIHNoaWZ0OiAlZFxu
IiwKIAkJCSAgICBwb3J0X25hbWUocG9ydCksCiAJCQkgICAgaGRtaV9sZXZlbF9zaGlmdCk7CkBA
IC0xODY0LDcgKzE4NjQsNyBAQCBzdGF0aWMgdm9pZCBwYXJzZV9kZGlfcG9ydChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCX0KIAogCQlpZiAobWF4X3RtZHNfY2xvY2spCi0J
CQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKKwkJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0s
CiAJCQkJICAgICJQb3J0ICVjIFZCVCBIRE1JIG1heCBUTURTIGNsb2NrOiAlZCBrSHpcbiIsCiAJ
CQkJICAgIHBvcnRfbmFtZShwb3J0KSwgbWF4X3RtZHNfY2xvY2spOwogCQlpbmZvLT5tYXhfdG1k
c19jbG9jayA9IG1heF90bWRzX2Nsb2NrOwpAQCAtMTg3MywxMSArMTg3MywxMSBAQCBzdGF0aWMg
dm9pZCBwYXJzZV9kZGlfcG9ydChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJ
LyogUGFyc2UgdGhlIElfYm9vc3QgY29uZmlnIGZvciBTS0wgYW5kIGFib3ZlICovCiAJaWYgKGJk
Yl92ZXJzaW9uID49IDE5NiAmJiBjaGlsZC0+aWJvb3N0KSB7CiAJCWluZm8tPmRwX2Jvb3N0X2xl
dmVsID0gdHJhbnNsYXRlX2lib29zdChjaGlsZC0+ZHBfaWJvb3N0X2xldmVsKTsKLQkJZHJtX2Ri
Z19rbXMoJmRldl9wcml2LT5kcm0sCisJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCiAJCQkgICAg
IlBvcnQgJWMgVkJUIChlKURQIGJvb3N0IGxldmVsOiAlZFxuIiwKIAkJCSAgICBwb3J0X25hbWUo
cG9ydCksIGluZm8tPmRwX2Jvb3N0X2xldmVsKTsKIAkJaW5mby0+aGRtaV9ib29zdF9sZXZlbCA9
IHRyYW5zbGF0ZV9pYm9vc3QoY2hpbGQtPmhkbWlfaWJvb3N0X2xldmVsKTsKLQkJZHJtX2RiZ19r
bXMoJmRldl9wcml2LT5kcm0sCisJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sCiAJCQkgICAgIlBv
cnQgJWMgVkJUIEhETUkgYm9vc3QgbGV2ZWw6ICVkXG4iLAogCQkJICAgIHBvcnRfbmFtZShwb3J0
KSwgaW5mby0+aGRtaV9ib29zdF9sZXZlbCk7CiAJfQpAQCAtMTg5OSw3ICsxODk5LDcgQEAgc3Rh
dGljIHZvaWQgcGFyc2VfZGRpX3BvcnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAogCQkJaW5mby0+ZHBfbWF4X2xpbmtfcmF0ZSA9IDE2MjAwMDsKIAkJCWJyZWFrOwogCQl9Ci0J
CWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAog
CQkJICAgICJQb3J0ICVjIFZCVCBEUCBtYXggbGluayByYXRlOiAlZFxuIiwKIAkJCSAgICBwb3J0
X25hbWUocG9ydCksIGluZm8tPmRwX21heF9saW5rX3JhdGUpOwogCX0KQEAgLTE5MDcsMjIgKzE5
MDcsMjIgQEAgc3RhdGljIHZvaWQgcGFyc2VfZGRpX3BvcnQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAogCWluZm8tPmNoaWxkID0gY2hpbGQ7CiB9CiAKLXN0YXRpYyB2b2lkIHBh
cnNlX2RkaV9wb3J0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHU4IGJkYl92
ZXJzaW9uKQorc3RhdGljIHZvaWQgcGFyc2VfZGRpX3BvcnRzKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LCB1OCBiZGJfdmVyc2lvbikKIHsKIAlzdHJ1Y3QgZGlzcGxheV9kZXZpY2VfZGF0
YSAqZGV2ZGF0YTsKIAotCWlmICghSEFTX0RESShkZXZfcHJpdikgJiYgIUlTX0NIRVJSWVZJRVco
ZGV2X3ByaXYpKQorCWlmICghSEFTX0RESShpOTE1KSAmJiAhSVNfQ0hFUlJZVklFVyhpOTE1KSkK
IAkJcmV0dXJuOwogCiAJaWYgKGJkYl92ZXJzaW9uIDwgMTU1KQogCQlyZXR1cm47CiAKLQlsaXN0
X2Zvcl9lYWNoX2VudHJ5KGRldmRhdGEsICZkZXZfcHJpdi0+dmJ0LmRpc3BsYXlfZGV2aWNlcywg
bm9kZSkKLQkJcGFyc2VfZGRpX3BvcnQoZGV2X3ByaXYsIGRldmRhdGEsIGJkYl92ZXJzaW9uKTsK
KwlsaXN0X2Zvcl9lYWNoX2VudHJ5KGRldmRhdGEsICZpOTE1LT52YnQuZGlzcGxheV9kZXZpY2Vz
LCBub2RlKQorCQlwYXJzZV9kZGlfcG9ydChpOTE1LCBkZXZkYXRhLCBiZGJfdmVyc2lvbik7CiB9
CiAKIHN0YXRpYyB2b2lkCi1wYXJzZV9nZW5lcmFsX2RlZmluaXRpb25zKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKK3BhcnNlX2dlbmVyYWxfZGVmaW5pdGlvbnMoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgIGNvbnN0IHN0cnVjdCBiZGJfaGVhZGVyICpiZGIp
CiB7CiAJY29uc3Qgc3RydWN0IGJkYl9nZW5lcmFsX2RlZmluaXRpb25zICpkZWZzOwpAQCAtMTkz
NSwyMyArMTkzNSwyMyBAQCBwYXJzZV9nZW5lcmFsX2RlZmluaXRpb25zKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKIAogCWRlZnMgPSBmaW5kX3NlY3Rpb24oYmRiLCBCREJfR0VO
RVJBTF9ERUZJTklUSU9OUyk7CiAJaWYgKCFkZWZzKSB7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJp
di0+ZHJtLAorCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAogCQkJICAgICJObyBnZW5lcmFsIGRl
ZmluaXRpb24gYmxvY2sgaXMgZm91bmQsIG5vIGRldmljZXMgZGVmaW5lZC5cbiIpOwogCQlyZXR1
cm47CiAJfQogCiAJYmxvY2tfc2l6ZSA9IGdldF9ibG9ja3NpemUoZGVmcyk7CiAJaWYgKGJsb2Nr
X3NpemUgPCBzaXplb2YoKmRlZnMpKSB7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAor
CQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAogCQkJICAgICJHZW5lcmFsIGRlZmluaXRpb25zIGJs
b2NrIHRvbyBzbWFsbCAoJXUpXG4iLAogCQkJICAgIGJsb2NrX3NpemUpOwogCQlyZXR1cm47CiAJ
fQogCiAJYnVzX3BpbiA9IGRlZnMtPmNydF9kZGNfZ21idXNfcGluOwotCWRybV9kYmdfa21zKCZk
ZXZfcHJpdi0+ZHJtLCAiY3J0X2RkY19idXNfcGluOiAlZFxuIiwgYnVzX3Bpbik7Ci0JaWYgKGlu
dGVsX2dtYnVzX2lzX3ZhbGlkX3BpbihkZXZfcHJpdiwgYnVzX3BpbikpCi0JCWRldl9wcml2LT52
YnQuY3J0X2RkY19waW4gPSBidXNfcGluOworCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sICJjcnRf
ZGRjX2J1c19waW46ICVkXG4iLCBidXNfcGluKTsKKwlpZiAoaW50ZWxfZ21idXNfaXNfdmFsaWRf
cGluKGk5MTUsIGJ1c19waW4pKQorCQlpOTE1LT52YnQuY3J0X2RkY19waW4gPSBidXNfcGluOwog
CiAJaWYgKGJkYi0+dmVyc2lvbiA8IDEwNikgewogCQlleHBlY3RlZF9zaXplID0gMjI7CkBAIC0x
OTY4LDIwICsxOTY4LDIwIEBAIHBhcnNlX2dlbmVyYWxfZGVmaW5pdGlvbnMoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAogCX0gZWxzZSB7CiAJCWV4cGVjdGVkX3NpemUgPSBzaXpl
b2YoKmNoaWxkKTsKIAkJQlVJTERfQlVHX09OKHNpemVvZigqY2hpbGQpIDwgMzkpOwotCQlkcm1f
ZGJnKCZkZXZfcHJpdi0+ZHJtLAorCQlkcm1fZGJnKCZpOTE1LT5kcm0sCiAJCQkiRXhwZWN0ZWQg
Y2hpbGQgZGV2aWNlIGNvbmZpZyBzaXplIGZvciBWQlQgdmVyc2lvbiAldSBub3Qga25vd247IGFz
c3VtaW5nICV1XG4iLAogCQkJYmRiLT52ZXJzaW9uLCBleHBlY3RlZF9zaXplKTsKIAl9CiAKIAkv
KiBGbGFnIGFuIGVycm9yIGZvciB1bmV4cGVjdGVkIHNpemUsIGJ1dCBjb250aW51ZSBhbnl3YXku
ICovCiAJaWYgKGRlZnMtPmNoaWxkX2Rldl9zaXplICE9IGV4cGVjdGVkX3NpemUpCi0JCWRybV9l
cnIoJmRldl9wcml2LT5kcm0sCisJCWRybV9lcnIoJmk5MTUtPmRybSwKIAkJCSJVbmV4cGVjdGVk
IGNoaWxkIGRldmljZSBjb25maWcgc2l6ZSAldSAoZXhwZWN0ZWQgJXUgZm9yIFZCVCB2ZXJzaW9u
ICV1KVxuIiwKIAkJCWRlZnMtPmNoaWxkX2Rldl9zaXplLCBleHBlY3RlZF9zaXplLCBiZGItPnZl
cnNpb24pOwogCiAJLyogVGhlIGxlZ2FjeSBzaXplZCBjaGlsZCBkZXZpY2UgY29uZmlnIGlzIHRo
ZSBtaW5pbXVtIHdlIG5lZWQuICovCiAJaWYgKGRlZnMtPmNoaWxkX2Rldl9zaXplIDwgTEVHQUNZ
X0NISUxEX0RFVklDRV9DT05GSUdfU0laRSkgewotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRy
bSwKKwkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKIAkJCSAgICAiQ2hpbGQgZGV2aWNlIGNvbmZp
ZyBzaXplICV1IGlzIHRvbyBzbWFsbC5cbiIsCiAJCQkgICAgZGVmcy0+Y2hpbGRfZGV2X3NpemUp
OwogCQlyZXR1cm47CkBAIC0xOTk1LDcgKzE5OTUsNyBAQCBwYXJzZV9nZW5lcmFsX2RlZmluaXRp
b25zKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJaWYgKCFjaGlsZC0+ZGV2
aWNlX3R5cGUpCiAJCQljb250aW51ZTsKIAotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwK
KwkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKIAkJCSAgICAiRm91bmQgVkJUIGNoaWxkIGRldmlj
ZSB3aXRoIHR5cGUgMHgleFxuIiwKIAkJCSAgICBjaGlsZC0+ZGV2aWNlX3R5cGUpOwogCkBAIC0y
MDExLDY0ICsyMDExLDY0IEBAIHBhcnNlX2dlbmVyYWxfZGVmaW5pdGlvbnMoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQltZW1jcHkoJmRldmRhdGEtPmNoaWxkLCBjaGlsZCwK
IAkJICAgICAgIG1pbl90KHNpemVfdCwgZGVmcy0+Y2hpbGRfZGV2X3NpemUsIHNpemVvZigqY2hp
bGQpKSk7CiAKLQkJbGlzdF9hZGRfdGFpbCgmZGV2ZGF0YS0+bm9kZSwgJmRldl9wcml2LT52YnQu
ZGlzcGxheV9kZXZpY2VzKTsKKwkJbGlzdF9hZGRfdGFpbCgmZGV2ZGF0YS0+bm9kZSwgJmk5MTUt
PnZidC5kaXNwbGF5X2RldmljZXMpOwogCX0KIAotCWlmIChsaXN0X2VtcHR5KCZkZXZfcHJpdi0+
dmJ0LmRpc3BsYXlfZGV2aWNlcykpCi0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCWlm
IChsaXN0X2VtcHR5KCZpOTE1LT52YnQuZGlzcGxheV9kZXZpY2VzKSkKKwkJZHJtX2RiZ19rbXMo
Jmk5MTUtPmRybSwKIAkJCSAgICAibm8gY2hpbGQgZGV2IGlzIHBhcnNlZCBmcm9tIFZCVFxuIik7
CiB9CiAKIC8qIENvbW1vbiBkZWZhdWx0cyB3aGljaCBtYXkgYmUgb3ZlcnJpZGRlbiBieSBWQlQu
ICovCiBzdGF0aWMgdm9pZAotaW5pdF92YnRfZGVmYXVsdHMoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQoraW5pdF92YnRfZGVmYXVsdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCiB7Ci0JZGV2X3ByaXYtPnZidC5jcnRfZGRjX3BpbiA9IEdNQlVTX1BJTl9WR0FEREM7
CisJaTkxNS0+dmJ0LmNydF9kZGNfcGluID0gR01CVVNfUElOX1ZHQUREQzsKIAogCS8qIERlZmF1
bHQgdG8gaGF2aW5nIGJhY2tsaWdodCAqLwotCWRldl9wcml2LT52YnQuYmFja2xpZ2h0LnByZXNl
bnQgPSB0cnVlOworCWk5MTUtPnZidC5iYWNrbGlnaHQucHJlc2VudCA9IHRydWU7CiAKIAkvKiBM
RlAgcGFuZWwgZGF0YSAqLwotCWRldl9wcml2LT52YnQubHZkc19kaXRoZXIgPSAxOworCWk5MTUt
PnZidC5sdmRzX2RpdGhlciA9IDE7CiAKIAkvKiBTRFZPIHBhbmVsIGRhdGEgKi8KLQlkZXZfcHJp
di0+dmJ0LnNkdm9fbHZkc192YnRfbW9kZSA9IE5VTEw7CisJaTkxNS0+dmJ0LnNkdm9fbHZkc192
YnRfbW9kZSA9IE5VTEw7CiAKIAkvKiBnZW5lcmFsIGZlYXR1cmVzICovCi0JZGV2X3ByaXYtPnZi
dC5pbnRfdHZfc3VwcG9ydCA9IDE7Ci0JZGV2X3ByaXYtPnZidC5pbnRfY3J0X3N1cHBvcnQgPSAx
OworCWk5MTUtPnZidC5pbnRfdHZfc3VwcG9ydCA9IDE7CisJaTkxNS0+dmJ0LmludF9jcnRfc3Vw
cG9ydCA9IDE7CiAKIAkvKiBkcml2ZXIgZmVhdHVyZXMgKi8KLQlkZXZfcHJpdi0+dmJ0LmludF9s
dmRzX3N1cHBvcnQgPSAxOworCWk5MTUtPnZidC5pbnRfbHZkc19zdXBwb3J0ID0gMTsKIAogCS8q
IERlZmF1bHQgdG8gdXNpbmcgU1NDICovCi0JZGV2X3ByaXYtPnZidC5sdmRzX3VzZV9zc2MgPSAx
OworCWk5MTUtPnZidC5sdmRzX3VzZV9zc2MgPSAxOwogCS8qCiAJICogQ29yZS9TYW5keUJyaWRn
ZS9JdnlCcmlkZ2UgdXNlIGFsdGVybmF0aXZlICgxMjBNSHopIHJlZmVyZW5jZQogCSAqIGNsb2Nr
IGZvciBMVkRTLgogCSAqLwotCWRldl9wcml2LT52YnQubHZkc19zc2NfZnJlcSA9IGludGVsX2Jp
b3Nfc3NjX2ZyZXF1ZW5jeShkZXZfcHJpdiwKLQkJCSFIQVNfUENIX1NQTElUKGRldl9wcml2KSk7
Ci0JZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJTZXQgZGVmYXVsdCB0byBTU0MgYXQgJWQg
a0h6XG4iLAotCQkgICAgZGV2X3ByaXYtPnZidC5sdmRzX3NzY19mcmVxKTsKKwlpOTE1LT52YnQu
bHZkc19zc2NfZnJlcSA9IGludGVsX2Jpb3Nfc3NjX2ZyZXF1ZW5jeShpOTE1LAorCQkJIUhBU19Q
Q0hfU1BMSVQoaTkxNSkpOworCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sICJTZXQgZGVmYXVsdCB0
byBTU0MgYXQgJWQga0h6XG4iLAorCQkgICAgaTkxNS0+dmJ0Lmx2ZHNfc3NjX2ZyZXEpOwogfQog
CiAvKiBEZWZhdWx0cyB0byBpbml0aWFsaXplIG9ubHkgaWYgdGhlcmUgaXMgbm8gVkJULiAqLwog
c3RhdGljIHZvaWQKLWluaXRfdmJ0X21pc3NpbmdfZGVmYXVsdHMoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQoraW5pdF92YnRfbWlzc2luZ19kZWZhdWx0cyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAllbnVtIHBvcnQgcG9ydDsKIAogCWZvcl9lYWNoX3BvcnQo
cG9ydCkgewogCQlzdHJ1Y3QgZGRpX3ZidF9wb3J0X2luZm8gKmluZm8gPQotCQkJJmRldl9wcml2
LT52YnQuZGRpX3BvcnRfaW5mb1twb3J0XTsKLQkJZW51bSBwaHkgcGh5ID0gaW50ZWxfcG9ydF90
b19waHkoZGV2X3ByaXYsIHBvcnQpOworCQkJJmk5MTUtPnZidC5kZGlfcG9ydF9pbmZvW3BvcnRd
OworCQllbnVtIHBoeSBwaHkgPSBpbnRlbF9wb3J0X3RvX3BoeShpOTE1LCBwb3J0KTsKIAogCQkv
KgogCQkgKiBWQlQgaGFzIHRoZSBUeXBlQyBtb2RlIChuYXRpdmUsVEJUL1VTQikgYW5kIHdlIGRv
bid0IHdhbnQKIAkJICogdG8gZGV0ZWN0IGl0LgogCQkgKi8KLQkJaWYgKGludGVsX3BoeV9pc190
YyhkZXZfcHJpdiwgcGh5KSkKKwkJaWYgKGludGVsX3BoeV9pc190YyhpOTE1LCBwaHkpKQogCQkJ
Y29udGludWU7CiAKIAkJaW5mby0+c3VwcG9ydHNfZHZpID0gKHBvcnQgIT0gUE9SVF9BICYmIHBv
cnQgIT0gUE9SVF9FKTsKQEAgLTIxMzQsOSArMjEzNCw5IEBAIGJvb2wgaW50ZWxfYmlvc19pc192
YWxpZF92YnQoY29uc3Qgdm9pZCAqYnVmLCBzaXplX3Qgc2l6ZSkKIAlyZXR1cm4gdmJ0OwogfQog
Ci1zdGF0aWMgc3RydWN0IHZidF9oZWFkZXIgKm9wcm9tX2dldF92YnQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHN0cnVjdCB2YnRfaGVhZGVyICpvcHJvbV9nZXRf
dmJ0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBwY2lfZGV2ICpw
ZGV2ID0gdG9fcGNpX2RldihkZXZfcHJpdi0+ZHJtLmRldik7CisJc3RydWN0IHBjaV9kZXYgKnBk
ZXYgPSB0b19wY2lfZGV2KGk5MTUtPmRybS5kZXYpOwogCXZvaWQgX19pb21lbSAqcCA9IE5VTEws
ICpvcHJvbTsKIAlzdHJ1Y3QgdmJ0X2hlYWRlciAqdmJ0OwogCXUxNiB2YnRfc2l6ZTsKQEAgLTIx
NjAsMTMgKzIxNjAsMTMgQEAgc3RhdGljIHN0cnVjdCB2YnRfaGVhZGVyICpvcHJvbV9nZXRfdmJ0
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJZ290byBlcnJfdW5tYXBfb3By
b207CiAKIAlpZiAoc2l6ZW9mKHN0cnVjdCB2YnRfaGVhZGVyKSA+IHNpemUpIHsKLQkJZHJtX2Ri
ZygmZGV2X3ByaXYtPmRybSwgIlZCVCBoZWFkZXIgaW5jb21wbGV0ZVxuIik7CisJCWRybV9kYmco
Jmk5MTUtPmRybSwgIlZCVCBoZWFkZXIgaW5jb21wbGV0ZVxuIik7CiAJCWdvdG8gZXJyX3VubWFw
X29wcm9tOwogCX0KIAogCXZidF9zaXplID0gaW9yZWFkMTYocCArIG9mZnNldG9mKHN0cnVjdCB2
YnRfaGVhZGVyLCB2YnRfc2l6ZSkpOwogCWlmICh2YnRfc2l6ZSA+IHNpemUpIHsKLQkJZHJtX2Ri
ZygmZGV2X3ByaXYtPmRybSwKKwkJZHJtX2RiZygmaTkxNS0+ZHJtLAogCQkJIlZCVCBpbmNvbXBs
ZXRlICh2YnRfc2l6ZSBvdmVyZmxvd3MpXG4iKTsKIAkJZ290byBlcnJfdW5tYXBfb3Byb207CiAJ
fQpAQCAtMjE5NSw3MSArMjE5NSw3MSBAQCBzdGF0aWMgc3RydWN0IHZidF9oZWFkZXIgKm9wcm9t
X2dldF92YnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCiAvKioKICAqIGlu
dGVsX2Jpb3NfaW5pdCAtIGZpbmQgVkJUIGFuZCBpbml0aWFsaXplIHNldHRpbmdzIGZyb20gdGhl
IEJJT1MKLSAqIEBkZXZfcHJpdjogaTkxNSBkZXZpY2UgaW5zdGFuY2UKKyAqIEBpOTE1OiBpOTE1
IGRldmljZSBpbnN0YW5jZQogICoKICAqIFBhcnNlIGFuZCBpbml0aWFsaXplIHNldHRpbmdzIGZy
b20gdGhlIFZpZGVvIEJJT1MgVGFibGVzIChWQlQpLiBJZiB0aGUgVkJUCiAgKiB3YXMgbm90IGZv
dW5kIGluIEFDUEkgT3BSZWdpb24sIHRyeSB0byBmaW5kIGl0IGluIFBDSSBST00gZmlyc3QuIEFs
c28KICAqIGluaXRpYWxpemUgc29tZSBkZWZhdWx0cyBpZiB0aGUgVkJUIGlzIG5vdCBwcmVzZW50
IGF0IGFsbC4KICAqLwotdm9pZCBpbnRlbF9iaW9zX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9iaW9zX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpCiB7Ci0JY29uc3Qgc3RydWN0IHZidF9oZWFkZXIgKnZidCA9IGRldl9wcml2LT5v
cHJlZ2lvbi52YnQ7CisJY29uc3Qgc3RydWN0IHZidF9oZWFkZXIgKnZidCA9IGk5MTUtPm9wcmVn
aW9uLnZidDsKIAlzdHJ1Y3QgdmJ0X2hlYWRlciAqb3Byb21fdmJ0ID0gTlVMTDsKIAljb25zdCBz
dHJ1Y3QgYmRiX2hlYWRlciAqYmRiOwogCi0JSU5JVF9MSVNUX0hFQUQoJmRldl9wcml2LT52YnQu
ZGlzcGxheV9kZXZpY2VzKTsKKwlJTklUX0xJU1RfSEVBRCgmaTkxNS0+dmJ0LmRpc3BsYXlfZGV2
aWNlcyk7CiAKLQlpZiAoIUhBU19ESVNQTEFZKGRldl9wcml2KSkgewotCQlkcm1fZGJnX2ttcygm
ZGV2X3ByaXYtPmRybSwKKwlpZiAoIUhBU19ESVNQTEFZKGk5MTUpKSB7CisJCWRybV9kYmdfa21z
KCZpOTE1LT5kcm0sCiAJCQkgICAgIlNraXBwaW5nIFZCVCBpbml0IGR1ZSB0byBkaXNhYmxlZCBk
aXNwbGF5LlxuIik7CiAJCXJldHVybjsKIAl9CiAKLQlpbml0X3ZidF9kZWZhdWx0cyhkZXZfcHJp
dik7CisJaW5pdF92YnRfZGVmYXVsdHMoaTkxNSk7CiAKIAkvKiBJZiB0aGUgT3BSZWdpb24gZG9l
cyBub3QgaGF2ZSBWQlQsIGxvb2sgaW4gUENJIFJPTS4gKi8KIAlpZiAoIXZidCkgewotCQlvcHJv
bV92YnQgPSBvcHJvbV9nZXRfdmJ0KGRldl9wcml2KTsKKwkJb3Byb21fdmJ0ID0gb3Byb21fZ2V0
X3ZidChpOTE1KTsKIAkJaWYgKCFvcHJvbV92YnQpCiAJCQlnb3RvIG91dDsKIAogCQl2YnQgPSBv
cHJvbV92YnQ7CiAKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJGb3VuZCB2YWxpZCBW
QlQgaW4gUENJIFJPTVxuIik7CisJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sICJGb3VuZCB2YWxp
ZCBWQlQgaW4gUENJIFJPTVxuIik7CiAJfQogCiAJYmRiID0gZ2V0X2JkYl9oZWFkZXIodmJ0KTsK
IAotCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCWRybV9kYmdfa21zKCZpOTE1LT5kcm0s
CiAJCSAgICAiVkJUIHNpZ25hdHVyZSBcIiUuKnNcIiwgQkRCIHZlcnNpb24gJWRcbiIsCiAJCSAg
ICAoaW50KXNpemVvZih2YnQtPnNpZ25hdHVyZSksIHZidC0+c2lnbmF0dXJlLCBiZGItPnZlcnNp
b24pOwogCiAJLyogR3JhYiB1c2VmdWwgZ2VuZXJhbCBkZWZpbml0aW9ucyAqLwotCXBhcnNlX2dl
bmVyYWxfZmVhdHVyZXMoZGV2X3ByaXYsIGJkYik7Ci0JcGFyc2VfZ2VuZXJhbF9kZWZpbml0aW9u
cyhkZXZfcHJpdiwgYmRiKTsKLQlwYXJzZV9wYW5lbF9vcHRpb25zKGRldl9wcml2LCBiZGIpOwot
CXBhcnNlX3BhbmVsX2R0ZChkZXZfcHJpdiwgYmRiKTsKLQlwYXJzZV9sZnBfYmFja2xpZ2h0KGRl
dl9wcml2LCBiZGIpOwotCXBhcnNlX3Nkdm9fcGFuZWxfZGF0YShkZXZfcHJpdiwgYmRiKTsKLQlw
YXJzZV9kcml2ZXJfZmVhdHVyZXMoZGV2X3ByaXYsIGJkYik7Ci0JcGFyc2VfcG93ZXJfY29uc2Vy
dmF0aW9uX2ZlYXR1cmVzKGRldl9wcml2LCBiZGIpOwotCXBhcnNlX2VkcChkZXZfcHJpdiwgYmRi
KTsKLQlwYXJzZV9wc3IoZGV2X3ByaXYsIGJkYik7Ci0JcGFyc2VfbWlwaV9jb25maWcoZGV2X3By
aXYsIGJkYik7Ci0JcGFyc2VfbWlwaV9zZXF1ZW5jZShkZXZfcHJpdiwgYmRiKTsKKwlwYXJzZV9n
ZW5lcmFsX2ZlYXR1cmVzKGk5MTUsIGJkYik7CisJcGFyc2VfZ2VuZXJhbF9kZWZpbml0aW9ucyhp
OTE1LCBiZGIpOworCXBhcnNlX3BhbmVsX29wdGlvbnMoaTkxNSwgYmRiKTsKKwlwYXJzZV9wYW5l
bF9kdGQoaTkxNSwgYmRiKTsKKwlwYXJzZV9sZnBfYmFja2xpZ2h0KGk5MTUsIGJkYik7CisJcGFy
c2Vfc2R2b19wYW5lbF9kYXRhKGk5MTUsIGJkYik7CisJcGFyc2VfZHJpdmVyX2ZlYXR1cmVzKGk5
MTUsIGJkYik7CisJcGFyc2VfcG93ZXJfY29uc2VydmF0aW9uX2ZlYXR1cmVzKGk5MTUsIGJkYik7
CisJcGFyc2VfZWRwKGk5MTUsIGJkYik7CisJcGFyc2VfcHNyKGk5MTUsIGJkYik7CisJcGFyc2Vf
bWlwaV9jb25maWcoaTkxNSwgYmRiKTsKKwlwYXJzZV9taXBpX3NlcXVlbmNlKGk5MTUsIGJkYik7
CiAKIAkvKiBEZXBlbmRzIG9uIGNoaWxkIGRldmljZSBsaXN0ICovCi0JcGFyc2VfY29tcHJlc3Np
b25fcGFyYW1ldGVycyhkZXZfcHJpdiwgYmRiKTsKKwlwYXJzZV9jb21wcmVzc2lvbl9wYXJhbWV0
ZXJzKGk5MTUsIGJkYik7CiAKIAkvKiBGdXJ0aGVyIHByb2Nlc3Npbmcgb24gcHJlLXBhcnNlZCBk
YXRhICovCi0JcGFyc2Vfc2R2b19kZXZpY2VfbWFwcGluZyhkZXZfcHJpdiwgYmRiLT52ZXJzaW9u
KTsKLQlwYXJzZV9kZGlfcG9ydHMoZGV2X3ByaXYsIGJkYi0+dmVyc2lvbik7CisJcGFyc2Vfc2R2
b19kZXZpY2VfbWFwcGluZyhpOTE1LCBiZGItPnZlcnNpb24pOworCXBhcnNlX2RkaV9wb3J0cyhp
OTE1LCBiZGItPnZlcnNpb24pOwogCiBvdXQ6CiAJaWYgKCF2YnQpIHsKLQkJZHJtX2luZm8oJmRl
dl9wcml2LT5kcm0sCisJCWRybV9pbmZvKCZpOTE1LT5kcm0sCiAJCQkgIkZhaWxlZCB0byBmaW5k
IFZCSU9TIHRhYmxlcyAoVkJUKVxuIik7Ci0JCWluaXRfdmJ0X21pc3NpbmdfZGVmYXVsdHMoZGV2
X3ByaXYpOworCQlpbml0X3ZidF9taXNzaW5nX2RlZmF1bHRzKGk5MTUpOwogCX0KIAogCWtmcmVl
KG9wcm9tX3ZidCk7CkBAIC0yMjY3LDUxICsyMjY3LDUxIEBAIHZvaWQgaW50ZWxfYmlvc19pbml0
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogLyoqCiAgKiBpbnRlbF9iaW9z
X2RyaXZlcl9yZW1vdmUgLSBGcmVlIGFueSByZXNvdXJjZXMgYWxsb2NhdGVkIGJ5IGludGVsX2Jp
b3NfaW5pdCgpCi0gKiBAZGV2X3ByaXY6IGk5MTUgZGV2aWNlIGluc3RhbmNlCisgKiBAaTkxNTog
aTkxNSBkZXZpY2UgaW5zdGFuY2UKICAqLwotdm9pZCBpbnRlbF9iaW9zX2RyaXZlcl9yZW1vdmUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQordm9pZCBpbnRlbF9iaW9zX2RyaXZl
cl9yZW1vdmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RydWN0IGRpc3Bs
YXlfZGV2aWNlX2RhdGEgKmRldmRhdGEsICpuOwogCi0JbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZl
KGRldmRhdGEsIG4sICZkZXZfcHJpdi0+dmJ0LmRpc3BsYXlfZGV2aWNlcywgbm9kZSkgeworCWxp
c3RfZm9yX2VhY2hfZW50cnlfc2FmZShkZXZkYXRhLCBuLCAmaTkxNS0+dmJ0LmRpc3BsYXlfZGV2
aWNlcywgbm9kZSkgewogCQlsaXN0X2RlbCgmZGV2ZGF0YS0+bm9kZSk7CiAJCWtmcmVlKGRldmRh
dGEtPmRzYyk7CiAJCWtmcmVlKGRldmRhdGEpOwogCX0KIAotCWtmcmVlKGRldl9wcml2LT52YnQu
c2R2b19sdmRzX3ZidF9tb2RlKTsKLQlkZXZfcHJpdi0+dmJ0LnNkdm9fbHZkc192YnRfbW9kZSA9
IE5VTEw7Ci0Ja2ZyZWUoZGV2X3ByaXYtPnZidC5sZnBfbHZkc192YnRfbW9kZSk7Ci0JZGV2X3By
aXYtPnZidC5sZnBfbHZkc192YnRfbW9kZSA9IE5VTEw7Ci0Ja2ZyZWUoZGV2X3ByaXYtPnZidC5k
c2kuZGF0YSk7Ci0JZGV2X3ByaXYtPnZidC5kc2kuZGF0YSA9IE5VTEw7Ci0Ja2ZyZWUoZGV2X3By
aXYtPnZidC5kc2kucHBzKTsKLQlkZXZfcHJpdi0+dmJ0LmRzaS5wcHMgPSBOVUxMOwotCWtmcmVl
KGRldl9wcml2LT52YnQuZHNpLmNvbmZpZyk7Ci0JZGV2X3ByaXYtPnZidC5kc2kuY29uZmlnID0g
TlVMTDsKLQlrZnJlZShkZXZfcHJpdi0+dmJ0LmRzaS5kZWFzc2VydF9zZXEpOwotCWRldl9wcml2
LT52YnQuZHNpLmRlYXNzZXJ0X3NlcSA9IE5VTEw7CisJa2ZyZWUoaTkxNS0+dmJ0LnNkdm9fbHZk
c192YnRfbW9kZSk7CisJaTkxNS0+dmJ0LnNkdm9fbHZkc192YnRfbW9kZSA9IE5VTEw7CisJa2Zy
ZWUoaTkxNS0+dmJ0LmxmcF9sdmRzX3ZidF9tb2RlKTsKKwlpOTE1LT52YnQubGZwX2x2ZHNfdmJ0
X21vZGUgPSBOVUxMOworCWtmcmVlKGk5MTUtPnZidC5kc2kuZGF0YSk7CisJaTkxNS0+dmJ0LmRz
aS5kYXRhID0gTlVMTDsKKwlrZnJlZShpOTE1LT52YnQuZHNpLnBwcyk7CisJaTkxNS0+dmJ0LmRz
aS5wcHMgPSBOVUxMOworCWtmcmVlKGk5MTUtPnZidC5kc2kuY29uZmlnKTsKKwlpOTE1LT52YnQu
ZHNpLmNvbmZpZyA9IE5VTEw7CisJa2ZyZWUoaTkxNS0+dmJ0LmRzaS5kZWFzc2VydF9zZXEpOwor
CWk5MTUtPnZidC5kc2kuZGVhc3NlcnRfc2VxID0gTlVMTDsKIH0KIAogLyoqCiAgKiBpbnRlbF9i
aW9zX2lzX3R2X3ByZXNlbnQgLSBpcyBpbnRlZ3JhdGVkIFRWIHByZXNlbnQgaW4gVkJUCi0gKiBA
ZGV2X3ByaXY6CWk5MTUgZGV2aWNlIGluc3RhbmNlCisgKiBAaTkxNTogaTkxNSBkZXZpY2UgaW5z
dGFuY2UKICAqCiAgKiBSZXR1cm4gdHJ1ZSBpZiBUViBpcyBwcmVzZW50LiBJZiBubyBjaGlsZCBk
ZXZpY2VzIHdlcmUgcGFyc2VkIGZyb20gVkJULAogICogYXNzdW1lIFRWIGlzIHByZXNlbnQuCiAg
Ki8KLWJvb2wgaW50ZWxfYmlvc19pc190dl9wcmVzZW50KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKK2Jvb2wgaW50ZWxfYmlvc19pc190dl9wcmVzZW50KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogewogCWNvbnN0IHN0cnVjdCBkaXNwbGF5X2RldmljZV9kYXRhICpk
ZXZkYXRhOwogCWNvbnN0IHN0cnVjdCBjaGlsZF9kZXZpY2VfY29uZmlnICpjaGlsZDsKIAotCWlm
ICghZGV2X3ByaXYtPnZidC5pbnRfdHZfc3VwcG9ydCkKKwlpZiAoIWk5MTUtPnZidC5pbnRfdHZf
c3VwcG9ydCkKIAkJcmV0dXJuIGZhbHNlOwogCi0JaWYgKGxpc3RfZW1wdHkoJmRldl9wcml2LT52
YnQuZGlzcGxheV9kZXZpY2VzKSkKKwlpZiAobGlzdF9lbXB0eSgmaTkxNS0+dmJ0LmRpc3BsYXlf
ZGV2aWNlcykpCiAJCXJldHVybiB0cnVlOwogCi0JbGlzdF9mb3JfZWFjaF9lbnRyeShkZXZkYXRh
LCAmZGV2X3ByaXYtPnZidC5kaXNwbGF5X2RldmljZXMsIG5vZGUpIHsKKwlsaXN0X2Zvcl9lYWNo
X2VudHJ5KGRldmRhdGEsICZpOTE1LT52YnQuZGlzcGxheV9kZXZpY2VzLCBub2RlKSB7CiAJCWNo
aWxkID0gJmRldmRhdGEtPmNoaWxkOwogCiAJCS8qCkBAIC0yMzM3LDIxICsyMzM3LDIxIEBAIGJv
b2wgaW50ZWxfYmlvc19pc190dl9wcmVzZW50KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIAogLyoqCiAgKiBpbnRlbF9iaW9zX2lzX2x2ZHNfcHJlc2VudCAtIGlzIExWRFMgcHJl
c2VudCBpbiBWQlQKLSAqIEBkZXZfcHJpdjoJaTkxNSBkZXZpY2UgaW5zdGFuY2UKKyAqIEBpOTE1
OglpOTE1IGRldmljZSBpbnN0YW5jZQogICogQGkyY19waW46CWkyYyBwaW4gZm9yIExWRFMgaWYg
cHJlc2VudAogICoKICAqIFJldHVybiB0cnVlIGlmIExWRFMgaXMgcHJlc2VudC4gSWYgbm8gY2hp
bGQgZGV2aWNlcyB3ZXJlIHBhcnNlZCBmcm9tIFZCVCwKICAqIGFzc3VtZSBMVkRTIGlzIHByZXNl
bnQuCiAgKi8KLWJvb2wgaW50ZWxfYmlvc19pc19sdmRzX3ByZXNlbnQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LCB1OCAqaTJjX3BpbikKK2Jvb2wgaW50ZWxfYmlvc19pc19sdmRz
X3ByZXNlbnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHU4ICppMmNfcGluKQogewog
CWNvbnN0IHN0cnVjdCBkaXNwbGF5X2RldmljZV9kYXRhICpkZXZkYXRhOwogCWNvbnN0IHN0cnVj
dCBjaGlsZF9kZXZpY2VfY29uZmlnICpjaGlsZDsKIAotCWlmIChsaXN0X2VtcHR5KCZkZXZfcHJp
di0+dmJ0LmRpc3BsYXlfZGV2aWNlcykpCisJaWYgKGxpc3RfZW1wdHkoJmk5MTUtPnZidC5kaXNw
bGF5X2RldmljZXMpKQogCQlyZXR1cm4gdHJ1ZTsKIAotCWxpc3RfZm9yX2VhY2hfZW50cnkoZGV2
ZGF0YSwgJmRldl9wcml2LT52YnQuZGlzcGxheV9kZXZpY2VzLCBub2RlKSB7CisJbGlzdF9mb3Jf
ZWFjaF9lbnRyeShkZXZkYXRhLCAmaTkxNS0+dmJ0LmRpc3BsYXlfZGV2aWNlcywgbm9kZSkgewog
CQljaGlsZCA9ICZkZXZkYXRhLT5jaGlsZDsKIAogCQkvKiBJZiB0aGUgZGV2aWNlIHR5cGUgaXMg
bm90IExGUCwgY29udGludWUuCkBAIC0yMzYyLDcgKzIzNjIsNyBAQCBib29sIGludGVsX2Jpb3Nf
aXNfbHZkc19wcmVzZW50KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTggKmky
Y19waW4pCiAJCSAgICBjaGlsZC0+ZGV2aWNlX3R5cGUgIT0gREVWSUNFX1RZUEVfTEZQKQogCQkJ
Y29udGludWU7CiAKLQkJaWYgKGludGVsX2dtYnVzX2lzX3ZhbGlkX3BpbihkZXZfcHJpdiwgY2hp
bGQtPmkyY19waW4pKQorCQlpZiAoaW50ZWxfZ21idXNfaXNfdmFsaWRfcGluKGk5MTUsIGNoaWxk
LT5pMmNfcGluKSkKIAkJCSppMmNfcGluID0gY2hpbGQtPmkyY19waW47CiAKIAkJLyogSG93ZXZl
ciwgd2UgY2Fubm90IHRydXN0IHRoZSBCSU9TIHdyaXRlcnMgdG8gcG9wdWxhdGUKQEAgLTIzNzgs
NyArMjM3OCw3IEBAIGJvb2wgaW50ZWxfYmlvc19pc19sdmRzX3ByZXNlbnQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LCB1OCAqaTJjX3BpbikKIAkJICogYWRkaXRpb25hbCBkYXRh
LiAgVHJ1c3QgdGhhdCBpZiB0aGUgVkJUIHdhcyB3cml0dGVuIGludG8KIAkJICogdGhlIE9wUmVn
aW9uIHRoZW4gdGhleSBoYXZlIHZhbGlkYXRlZCB0aGUgTFZEUydzIGV4aXN0ZW5jZS4KIAkJICov
Ci0JCWlmIChkZXZfcHJpdi0+b3ByZWdpb24udmJ0KQorCQlpZiAoaTkxNS0+b3ByZWdpb24udmJ0
KQogCQkJcmV0dXJuIHRydWU7CiAJfQogCkBAIC0yMzg3LDEyICsyMzg3LDEyIEBAIGJvb2wgaW50
ZWxfYmlvc19pc19sdmRzX3ByZXNlbnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LCB1OCAqaTJjX3BpbikKIAogLyoqCiAgKiBpbnRlbF9iaW9zX2lzX3BvcnRfcHJlc2VudCAtIGlz
IHRoZSBzcGVjaWZpZWQgZGlnaXRhbCBwb3J0IHByZXNlbnQKLSAqIEBkZXZfcHJpdjoJaTkxNSBk
ZXZpY2UgaW5zdGFuY2UKKyAqIEBpOTE1OglpOTE1IGRldmljZSBpbnN0YW5jZQogICogQHBvcnQ6
CXBvcnQgdG8gY2hlY2sKICAqCiAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgZGV2aWNlIGluICVwb3J0
IGlzIHByZXNlbnQuCiAgKi8KLWJvb2wgaW50ZWxfYmlvc19pc19wb3J0X3ByZXNlbnQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBvcnQgcG9ydCkKK2Jvb2wgaW50ZWxf
Ymlvc19pc19wb3J0X3ByZXNlbnQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGVudW0g
cG9ydCBwb3J0KQogewogCWNvbnN0IHN0cnVjdCBkaXNwbGF5X2RldmljZV9kYXRhICpkZXZkYXRh
OwogCWNvbnN0IHN0cnVjdCBjaGlsZF9kZXZpY2VfY29uZmlnICpjaGlsZDsKQEAgLTI0MDYsMTkg
KzI0MDYsMTkgQEAgYm9vbCBpbnRlbF9iaW9zX2lzX3BvcnRfcHJlc2VudChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcG9ydCBwb3IKIAkJW1BPUlRfRl0gPSB7IERWT19Q
T1JUX0RQRiwgRFZPX1BPUlRfSERNSUYsIH0sCiAJfTsKIAotCWlmIChIQVNfRERJKGRldl9wcml2
KSkgeworCWlmIChIQVNfRERJKGk5MTUpKSB7CiAJCWNvbnN0IHN0cnVjdCBkZGlfdmJ0X3BvcnRf
aW5mbyAqcG9ydF9pbmZvID0KLQkJCSZkZXZfcHJpdi0+dmJ0LmRkaV9wb3J0X2luZm9bcG9ydF07
CisJCQkmaTkxNS0+dmJ0LmRkaV9wb3J0X2luZm9bcG9ydF07CiAKIAkJcmV0dXJuIHBvcnRfaW5m
by0+Y2hpbGQ7CiAJfQogCiAJLyogRklYTUUgbWF5YmUgZGVhbCB3aXRoIHBvcnQgQSBhcyB3ZWxs
PyAqLwotCWlmIChkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwKKwlpZiAoZHJtX1dBUk5fT04o
Jmk5MTUtPmRybSwKIAkJCXBvcnQgPT0gUE9SVF9BKSB8fCBwb3J0ID49IEFSUkFZX1NJWkUocG9y
dF9tYXBwaW5nKSkKIAkJcmV0dXJuIGZhbHNlOwogCi0JbGlzdF9mb3JfZWFjaF9lbnRyeShkZXZk
YXRhLCAmZGV2X3ByaXYtPnZidC5kaXNwbGF5X2RldmljZXMsIG5vZGUpIHsKKwlsaXN0X2Zvcl9l
YWNoX2VudHJ5KGRldmRhdGEsICZpOTE1LT52YnQuZGlzcGxheV9kZXZpY2VzLCBub2RlKSB7CiAJ
CWNoaWxkID0gJmRldmRhdGEtPmNoaWxkOwogCiAJCWlmICgoY2hpbGQtPmR2b19wb3J0ID09IHBv
cnRfbWFwcGluZ1twb3J0XS5kcCB8fApAQCAtMjQzMywxMiArMjQzMywxMiBAQCBib29sIGludGVs
X2Jpb3NfaXNfcG9ydF9wcmVzZW50KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwg
ZW51bSBwb3J0IHBvcgogCiAvKioKICAqIGludGVsX2Jpb3NfaXNfcG9ydF9lZHAgLSBpcyB0aGUg
ZGV2aWNlIGluIGdpdmVuIHBvcnQgZURQCi0gKiBAZGV2X3ByaXY6CWk5MTUgZGV2aWNlIGluc3Rh
bmNlCisgKiBAaTkxNToJaTkxNSBkZXZpY2UgaW5zdGFuY2UKICAqIEBwb3J0Oglwb3J0IHRvIGNo
ZWNrCiAgKgogICogUmV0dXJuIHRydWUgaWYgdGhlIGRldmljZSBpbiAlcG9ydCBpcyBlRFAuCiAg
Ki8KLWJvb2wgaW50ZWxfYmlvc19pc19wb3J0X2VkcChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsIGVudW0gcG9ydCBwb3J0KQorYm9vbCBpbnRlbF9iaW9zX2lzX3BvcnRfZWRwKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBlbnVtIHBvcnQgcG9ydCkKIHsKIAljb25zdCBz
dHJ1Y3QgZGlzcGxheV9kZXZpY2VfZGF0YSAqZGV2ZGF0YTsKIAljb25zdCBzdHJ1Y3QgY2hpbGRf
ZGV2aWNlX2NvbmZpZyAqY2hpbGQ7CkBAIC0yNDUwLDEwICsyNDUwLDEwIEBAIGJvb2wgaW50ZWxf
Ymlvc19pc19wb3J0X2VkcChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0g
cG9ydCBwb3J0KQogCQlbUE9SVF9GXSA9IERWT19QT1JUX0RQRiwKIAl9OwogCi0JaWYgKEhBU19E
REkoZGV2X3ByaXYpKQotCQlyZXR1cm4gZGV2X3ByaXYtPnZidC5kZGlfcG9ydF9pbmZvW3BvcnRd
LnN1cHBvcnRzX2VkcDsKKwlpZiAoSEFTX0RESShpOTE1KSkKKwkJcmV0dXJuIGk5MTUtPnZidC5k
ZGlfcG9ydF9pbmZvW3BvcnRdLnN1cHBvcnRzX2VkcDsKIAotCWxpc3RfZm9yX2VhY2hfZW50cnko
ZGV2ZGF0YSwgJmRldl9wcml2LT52YnQuZGlzcGxheV9kZXZpY2VzLCBub2RlKSB7CisJbGlzdF9m
b3JfZWFjaF9lbnRyeShkZXZkYXRhLCAmaTkxNS0+dmJ0LmRpc3BsYXlfZGV2aWNlcywgbm9kZSkg
ewogCQljaGlsZCA9ICZkZXZkYXRhLT5jaGlsZDsKIAogCQlpZiAoY2hpbGQtPmR2b19wb3J0ID09
IHBvcnRfbWFwcGluZ1twb3J0XSAmJgpAQCAtMjUwMCwxMiArMjUwMCwxMiBAQCBzdGF0aWMgYm9v
bCBjaGlsZF9kZXZfaXNfZHBfZHVhbF9tb2RlKGNvbnN0IHN0cnVjdCBjaGlsZF9kZXZpY2VfY29u
ZmlnICpjaGlsZCwKIAlyZXR1cm4gZmFsc2U7CiB9CiAKLWJvb2wgaW50ZWxfYmlvc19pc19wb3J0
X2RwX2R1YWxfbW9kZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitib29sIGlu
dGVsX2Jpb3NfaXNfcG9ydF9kcF9kdWFsX21vZGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJCQkJICAgICBlbnVtIHBvcnQgcG9ydCkKIHsKIAljb25zdCBzdHJ1Y3QgZGlzcGxheV9k
ZXZpY2VfZGF0YSAqZGV2ZGF0YTsKIAotCWxpc3RfZm9yX2VhY2hfZW50cnkoZGV2ZGF0YSwgJmRl
dl9wcml2LT52YnQuZGlzcGxheV9kZXZpY2VzLCBub2RlKSB7CisJbGlzdF9mb3JfZWFjaF9lbnRy
eShkZXZkYXRhLCAmaTkxNS0+dmJ0LmRpc3BsYXlfZGV2aWNlcywgbm9kZSkgewogCQlpZiAoY2hp
bGRfZGV2X2lzX2RwX2R1YWxfbW9kZSgmZGV2ZGF0YS0+Y2hpbGQsIHBvcnQpKQogCQkJcmV0dXJu
IHRydWU7CiAJfQpAQCAtMjUxNSwxOSArMjUxNSwxOSBAQCBib29sIGludGVsX2Jpb3NfaXNfcG9y
dF9kcF9kdWFsX21vZGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCiAvKioK
ICAqIGludGVsX2Jpb3NfaXNfZHNpX3ByZXNlbnQgLSBpcyBEU0kgcHJlc2VudCBpbiBWQlQKLSAq
IEBkZXZfcHJpdjoJaTkxNSBkZXZpY2UgaW5zdGFuY2UKKyAqIEBpOTE1OglpOTE1IGRldmljZSBp
bnN0YW5jZQogICogQHBvcnQ6CXBvcnQgZm9yIERTSSBpZiBwcmVzZW50CiAgKgogICogUmV0dXJu
IHRydWUgaWYgRFNJIGlzIHByZXNlbnQsIGFuZCByZXR1cm4gdGhlIHBvcnQgaW4gJXBvcnQuCiAg
Ki8KLWJvb2wgaW50ZWxfYmlvc19pc19kc2lfcHJlc2VudChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCitib29sIGludGVsX2Jpb3NfaXNfZHNpX3ByZXNlbnQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgICAgZW51bSBwb3J0ICpwb3J0KQogewogCWNvbnN0
IHN0cnVjdCBkaXNwbGF5X2RldmljZV9kYXRhICpkZXZkYXRhOwogCWNvbnN0IHN0cnVjdCBjaGls
ZF9kZXZpY2VfY29uZmlnICpjaGlsZDsKIAl1OCBkdm9fcG9ydDsKIAotCWxpc3RfZm9yX2VhY2hf
ZW50cnkoZGV2ZGF0YSwgJmRldl9wcml2LT52YnQuZGlzcGxheV9kZXZpY2VzLCBub2RlKSB7CisJ
bGlzdF9mb3JfZWFjaF9lbnRyeShkZXZkYXRhLCAmaTkxNS0+dmJ0LmRpc3BsYXlfZGV2aWNlcywg
bm9kZSkgewogCQljaGlsZCA9ICZkZXZkYXRhLT5jaGlsZDsKIAogCQlpZiAoIShjaGlsZC0+ZGV2
aWNlX3R5cGUgJiBERVZJQ0VfVFlQRV9NSVBJX09VVFBVVCkpCkBAIC0yNTM2LDE1ICsyNTM2LDE1
IEBAIGJvb2wgaW50ZWxfYmlvc19pc19kc2lfcHJlc2VudChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCiAJCWR2b19wb3J0ID0gY2hpbGQtPmR2b19wb3J0OwogCiAJCWlmIChkdm9f
cG9ydCA9PSBEVk9fUE9SVF9NSVBJQSB8fAotCQkgICAgKGR2b19wb3J0ID09IERWT19QT1JUX01J
UElCICYmIElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpIHx8Ci0JCSAgICAoZHZvX3BvcnQgPT0g
RFZPX1BPUlRfTUlQSUMgJiYgSU5URUxfR0VOKGRldl9wcml2KSA8IDExKSkgeworCQkgICAgKGR2
b19wb3J0ID09IERWT19QT1JUX01JUElCICYmIElOVEVMX0dFTihpOTE1KSA+PSAxMSkgfHwKKwkJ
ICAgIChkdm9fcG9ydCA9PSBEVk9fUE9SVF9NSVBJQyAmJiBJTlRFTF9HRU4oaTkxNSkgPCAxMSkp
IHsKIAkJCWlmIChwb3J0KQogCQkJCSpwb3J0ID0gZHZvX3BvcnQgLSBEVk9fUE9SVF9NSVBJQTsK
IAkJCXJldHVybiB0cnVlOwogCQl9IGVsc2UgaWYgKGR2b19wb3J0ID09IERWT19QT1JUX01JUElC
IHx8CiAJCQkgICBkdm9fcG9ydCA9PSBEVk9fUE9SVF9NSVBJQyB8fAogCQkJICAgZHZvX3BvcnQg
PT0gRFZPX1BPUlRfTUlQSUQpIHsKLQkJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAorCQkJ
ZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKIAkJCQkgICAgIlZCVCBoYXMgdW5zdXBwb3J0ZWQgRFNJ
IHBvcnQgJWNcbiIsCiAJCQkJICAgIHBvcnRfbmFtZShkdm9fcG9ydCAtIERWT19QT1JUX01JUElB
KSk7CiAJCX0KQEAgLTI3MDAsMTcgKzI3MDAsMTcgQEAgaW50ZWxfYmlvc19pc19sYW5lX3JldmVy
c2FsX25lZWRlZChjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlyZXR1cm4g
Y2hpbGQgJiYgY2hpbGQtPmxhbmVfcmV2ZXJzYWw7CiB9CiAKLWVudW0gYXV4X2NoIGludGVsX2Jp
b3NfcG9ydF9hdXhfY2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorZW51bSBh
dXhfY2ggaW50ZWxfYmlvc19wb3J0X2F1eF9jaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKIAkJCQkgICBlbnVtIHBvcnQgcG9ydCkKIHsKIAljb25zdCBzdHJ1Y3QgZGRpX3ZidF9wb3J0
X2luZm8gKmluZm8gPQotCQkmZGV2X3ByaXYtPnZidC5kZGlfcG9ydF9pbmZvW3BvcnRdOworCQkm
aTkxNS0+dmJ0LmRkaV9wb3J0X2luZm9bcG9ydF07CiAJZW51bSBhdXhfY2ggYXV4X2NoOwogCiAJ
aWYgKCFpbmZvLT5hbHRlcm5hdGVfYXV4X2NoYW5uZWwpIHsKIAkJYXV4X2NoID0gKGVudW0gYXV4
X2NoKXBvcnQ7CiAKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCWRybV9kYmdfa21z
KCZpOTE1LT5kcm0sCiAJCQkgICAgInVzaW5nIEFVWCAlYyBmb3IgcG9ydCAlYyAocGxhdGZvcm0g
ZGVmYXVsdClcbiIsCiAJCQkgICAgYXV4X2NoX25hbWUoYXV4X2NoKSwgcG9ydF9uYW1lKHBvcnQp
KTsKIAkJcmV0dXJuIGF1eF9jaDsKQEAgLTI3MjgsMjkgKzI3MjgsMjkgQEAgZW51bSBhdXhfY2gg
aW50ZWxfYmlvc19wb3J0X2F1eF9jaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CiAJCWF1eF9jaCA9IEFVWF9DSF9BOwogCQlicmVhazsKIAljYXNlIERQX0FVWF9COgotCQlpZiAo
SVNfQUxERVJMQUtFX1MoZGV2X3ByaXYpKQorCQlpZiAoSVNfQUxERVJMQUtFX1MoaTkxNSkpCiAJ
CQlhdXhfY2ggPSBBVVhfQ0hfVVNCQzE7CiAJCWVsc2UKIAkJCWF1eF9jaCA9IEFVWF9DSF9COwog
CQlicmVhazsKIAljYXNlIERQX0FVWF9DOgotCQlpZiAoSVNfQUxERVJMQUtFX1MoZGV2X3ByaXYp
KQorCQlpZiAoSVNfQUxERVJMQUtFX1MoaTkxNSkpCiAJCQlhdXhfY2ggPSBBVVhfQ0hfVVNCQzI7
Ci0JCWVsc2UgaWYgKElTX0RHMShkZXZfcHJpdikgfHwgSVNfUk9DS0VUTEFLRShkZXZfcHJpdikp
CisJCWVsc2UgaWYgKElTX0RHMShpOTE1KSB8fCBJU19ST0NLRVRMQUtFKGk5MTUpKQogCQkJYXV4
X2NoID0gQVVYX0NIX1VTQkMxOwogCQllbHNlCiAJCQlhdXhfY2ggPSBBVVhfQ0hfQzsKIAkJYnJl
YWs7CiAJY2FzZSBEUF9BVVhfRDoKLQkJaWYgKElTX0FMREVSTEFLRV9TKGRldl9wcml2KSkKKwkJ
aWYgKElTX0FMREVSTEFLRV9TKGk5MTUpKQogCQkJYXV4X2NoID0gQVVYX0NIX1VTQkMzOwotCQll
bHNlIGlmIChJU19ERzEoZGV2X3ByaXYpIHx8IElTX1JPQ0tFVExBS0UoZGV2X3ByaXYpKQorCQll
bHNlIGlmIChJU19ERzEoaTkxNSkgfHwgSVNfUk9DS0VUTEFLRShpOTE1KSkKIAkJCWF1eF9jaCA9
IEFVWF9DSF9VU0JDMjsKIAkJZWxzZQogCQkJYXV4X2NoID0gQVVYX0NIX0Q7CiAJCWJyZWFrOwog
CWNhc2UgRFBfQVVYX0U6Ci0JCWlmIChJU19BTERFUkxBS0VfUyhkZXZfcHJpdikpCisJCWlmIChJ
U19BTERFUkxBS0VfUyhpOTE1KSkKIAkJCWF1eF9jaCA9IEFVWF9DSF9VU0JDNDsKIAkJZWxzZQog
CQkJYXV4X2NoID0gQVVYX0NIX0U7CkBAIC0yNzczLDcgKzI3NzMsNyBAQCBlbnVtIGF1eF9jaCBp
bnRlbF9iaW9zX3BvcnRfYXV4X2NoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
IAkJYnJlYWs7CiAJfQogCi0JZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJ1c2luZyBBVVgg
JWMgZm9yIHBvcnQgJWMgKFZCVClcbiIsCisJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwgInVzaW5n
IEFVWCAlYyBmb3IgcG9ydCAlYyAoVkJUKVxuIiwKIAkJICAgIGF1eF9jaF9uYW1lKGF1eF9jaCks
IHBvcnRfbmFtZShwb3J0KSk7CiAKIAlyZXR1cm4gYXV4X2NoOwotLSAKMi4yMC4xCgpfX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGlu
ZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVl
ZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZngK

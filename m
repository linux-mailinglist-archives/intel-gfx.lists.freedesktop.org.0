Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id EBA50D6B78
	for <lists+intel-gfx@lfdr.de>; Tue, 15 Oct 2019 00:05:54 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6DF2589D42;
	Mon, 14 Oct 2019 22:05:49 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3A82189D3E
 for <intel-gfx@lists.freedesktop.org>; Mon, 14 Oct 2019 22:05:48 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18837431-1500050 
 for multiple; Mon, 14 Oct 2019 23:05:37 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 14 Oct 2019 23:05:30 +0100
Message-Id: <20191014220534.1662-6-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191014220534.1662-1-chris@chris-wilson.co.uk>
References: <20191014220534.1662-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 06/10] drm/i915/execlists: Cancel banned
 contexts on schedule-out
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

T24gc2NoZWR1bGUtb3V0IChDUyBjb21wbGV0aW9uKSBvZiBhIGJhbm5lZCBjb250ZXh0LCBzY3J1
YiB0aGUgY29udGV4dAppbWFnZSBzbyB0aGF0IHdlIGRvIG5vdCByZXBsYXkgdGhlIGFjdGl2ZSBw
YXlsb2FkLiBUaGUgaW50ZW50IGlzIHRoYXQgd2UKc2tpcCBiYW5uZWQgcGF5bG9hZHMgb24gcmVx
dWVzdCBzdWJtaXNzaW9uIHNvIHRoYXQgdGhlIHRpbWVsaW5lCmFkdmFuY2VtZW50IGNvbnRpbnVl
cyBvbiBpbiB0aGUgYmFja2dyb3VuZC4gSG93ZXZlciwgaWYgd2UgYXJlIHJldHVybmluZwp0byBh
IHByZWVtcHRlZCByZXF1ZXN0LCBpOTE1X3JlcXVlc3Rfc2tpcCgpIGlzIGluZWZmZWN0aXZlIGFu
ZCBpbnN0ZWFkIHdlCm5lZWQgdG8gcGF0Y2ggdXAgdGhlIGNvbnRleHQgaW1hZ2Ugc28gdGhhdCBp
dCBjb250aW51ZXMgZnJvbSB0aGUgc3RhcnQKb2YgdGhlIG5leHQgcmVxdWVzdC4KCnYyOiBGaXh1
cCBjYW5jZWxsYXRpb24gc28gdGhhdCB3ZSBvbmx5IHNjcnViIHRoZSBwYXlsb2FkIG9mIHRoZSBh
Y3RpdmUKcmVxdWVzdCBhbmQgZG8gbm90IHNob3J0LWNpcmN1aXQgdGhlIGJyZWFkY3J1bWJzICh3
aGljaCBtaWdodCBjYXVzZQpvdGhlciBjb250ZXh0cyB0byBleGVjdXRlIG91dCBvZiBvcmRlciku
CnYzOiBHcmFtbWFyIHBhc3MKClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hy
aXMtd2lsc29uLmNvLnVrPgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVs
LmNvbT4KUmV2aWV3ZWQtYnk6IFR2cnRrbyBVcnN1bGluIDx0dnJ0a28udXJzdWxpbkBpbnRlbC5j
b20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgICAgfCAxMzQgKysr
KysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jIHwgMzIxICsr
KysrKysrKysrKysrKysrKysrKysrKysKIDIgZmlsZXMgY2hhbmdlZCwgNDE0IGluc2VydGlvbnMo
KyksIDQxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKaW5kZXgg
YWUwMzhhZjY4YzZlLi42MGU4OTdjMDAwYjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xy
Yy5jCkBAIC0yMzQsNiArMjM0LDkgQEAgc3RhdGljIHZvaWQgZXhlY2xpc3RzX2luaXRfcmVnX3N0
YXRlKHUzMiAqcmVnX3N0YXRlLAogCQkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lLAogCQkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX3JpbmcgKnJpbmcsCiAJCQkJ
ICAgICBib29sIGNsb3NlKTsKK3N0YXRpYyB2b2lkCitfX2V4ZWNsaXN0c191cGRhdGVfcmVnX3N0
YXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKKwkJCSAgICAgY29uc3Qgc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKIAogc3RhdGljIHZvaWQgY2FuY2VsX3RpbWVyKHN0
cnVjdCB0aW1lcl9saXN0ICp0KQogewpAQCAtMjcwLDYgKzI3MywzMSBAQCBzdGF0aWMgdm9pZCBt
YXJrX2VpbyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAlpOTE1X3JlcXVlc3RfbWFya19jb21w
bGV0ZShycSk7CiB9CiAKK3N0YXRpYyBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICphY3RpdmVfcmVxdWVz
dChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKK3sKKwljb25zdCBzdHJ1Y3QgaW50ZWxfY29udGV4
dCAqIGNvbnN0IGNlID0gcnEtPmh3X2NvbnRleHQ7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqYWN0
aXZlID0gTlVMTDsKKwlzdHJ1Y3QgbGlzdF9oZWFkICpsaXN0OworCisJaWYgKCFpOTE1X3JlcXVl
c3RfaXNfYWN0aXZlKHJxKSkgLyogdW53b3VuZCwgYnV0IGluY29tcGxldGUhICovCisJCXJldHVy
biBycTsKKworCXJjdV9yZWFkX2xvY2soKTsKKwlsaXN0ID0gJnJjdV9kZXJlZmVyZW5jZShycS0+
dGltZWxpbmUpLT5yZXF1ZXN0czsKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5X2Zyb21fcmV2ZXJzZShy
cSwgbGlzdCwgbGluaykgeworCQlpZiAoaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChycSkpCisJCQli
cmVhazsKKworCQlpZiAocnEtPmh3X2NvbnRleHQgIT0gY2UpCisJCQlicmVhazsKKworCQlhY3Rp
dmUgPSBycTsKKwl9CisJcmN1X3JlYWRfdW5sb2NrKCk7CisKKwlyZXR1cm4gYWN0aXZlOworfQor
CiBzdGF0aWMgaW5saW5lIHUzMiBpbnRlbF9od3NfcHJlZW1wdF9hZGRyZXNzKHN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKIAlyZXR1cm4gKGk5MTVfZ2d0dF9vZmZzZXQoZW5naW5l
LT5zdGF0dXNfcGFnZS52bWEpICsKQEAgLTk5MSw2ICsxMDE5LDYxIEBAIHN0YXRpYyB2b2lkIGtp
Y2tfc2libGluZ3Moc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsIHN0cnVjdCBpbnRlbF9jb250ZXh0
ICpjZSkKIAkJdGFza2xldF9zY2hlZHVsZSgmdmUtPmJhc2UuZXhlY2xpc3RzLnRhc2tsZXQpOwog
fQogCitzdGF0aWMgdm9pZCByZXN0b3JlX2RlZmF1bHRfc3RhdGUoc3RydWN0IGludGVsX2NvbnRl
eHQgKmNlLAorCQkJCSAgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQoreworCXUzMiAq
cmVncyA9IGNlLT5scmNfcmVnX3N0YXRlOworCisJaWYgKGVuZ2luZS0+cGlubmVkX2RlZmF1bHRf
c3RhdGUpCisJCW1lbWNweShyZWdzLCAvKiBza2lwIHJlc3RvcmluZyB0aGUgdmFuaWxsYSBQUEhX
U1AgKi8KKwkJICAgICAgIGVuZ2luZS0+cGlubmVkX2RlZmF1bHRfc3RhdGUgKyBMUkNfU1RBVEVf
UE4gKiBQQUdFX1NJWkUsCisJCSAgICAgICBlbmdpbmUtPmNvbnRleHRfc2l6ZSAtIFBBR0VfU0la
RSk7CisKKwlleGVjbGlzdHNfaW5pdF9yZWdfc3RhdGUocmVncywgY2UsIGVuZ2luZSwgY2UtPnJp
bmcsIGZhbHNlKTsKK30KKworc3RhdGljIHZvaWQgcmVzZXRfYWN0aXZlKHN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJxLAorCQkJIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKK3sKKwlzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqIGNvbnN0IGNlID0gcnEtPmh3X2NvbnRleHQ7CisKKwkvKgorCSAq
IFRoZSBleGVjdXRpbmcgY29udGV4dCBoYXMgYmVlbiBjYW5jZWxsZWQuIFdlIHdhbnQgdG8gcHJl
dmVudAorCSAqIGZ1cnRoZXIgZXhlY3V0aW9uIGFsb25nIHRoaXMgY29udGV4dCBhbmQgcHJvcGFn
YXRlIHRoZSBlcnJvciBvbgorCSAqIHRvIGFueXRoaW5nIGRlcGVuZGluZyBvbiBpdHMgcmVzdWx0
cy4KKwkgKgorCSAqIEluIF9faTkxNV9yZXF1ZXN0X3N1Ym1pdCgpLCB3ZSBhcHBseSB0aGUgLUVJ
TyBhbmQgcmVtb3ZlIHRoZQorCSAqIHJlcXVlc3RzJyBwYXlsb2FkcyBmb3IgYW55IGJhbm5lZCBy
ZXF1ZXN0cy4gQnV0IGZpcnN0LCB3ZSBtdXN0CisJICogcmV3aW5kIHRoZSBjb250ZXh0IGJhY2sg
dG8gdGhlIHN0YXJ0IG9mIHRoZSBpbmNvbXBsZXRlIHJlcXVlc3Qgc28KKwkgKiB0aGF0IHdlIGRv
IG5vdCBqdW1wIGJhY2sgaW50byB0aGUgbWlkZGxlIG9mIHRoZSBiYXRjaC4KKwkgKgorCSAqIFdl
IHByZXNlcnZlIHRoZSBicmVhZGNydW1icyBhbmQgc2VtYXBob3JlcyBvZiB0aGUgaW5jb21wbGV0
ZQorCSAqIHJlcXVlc3RzIHNvIHRoYXQgaW50ZXItdGltZWxpbmUgZGVwZW5kZW5jaWVzIChpLmUg
b3RoZXIgdGltZWxpbmVzKQorCSAqIHJlbWFpbiBjb3JyZWN0bHkgb3JkZXJlZC4gQW5kIHdlIGRl
ZmVyIHRvIF9faTkxNV9yZXF1ZXN0X3N1Ym1pdCgpCisJICogc28gdGhhdCBhbGwgYXN5bmNocm9u
b3VzIHdhaXRzIGFyZSBjb3JyZWN0bHkgaGFuZGxlZC4KKwkgKi8KKwlHRU1fVFJBQ0UoIiVzKCVz
KTogeyBycT0lbGx4OiVsbGQgfVxuIiwKKwkJICBfX2Z1bmNfXywgZW5naW5lLT5uYW1lLCBycS0+
ZmVuY2UuY29udGV4dCwgcnEtPmZlbmNlLnNlcW5vKTsKKwlfX2NvbnRleHRfcGluX2FjcXVpcmUo
Y2UpOworCisJLyogT24gcmVzdWJtaXNzaW9uIG9mIHRoZSBhY3RpdmUgcmVxdWVzdCwgcGF5bG9h
ZCB3aWxsIGJlIHNjcnViYmVkICovCisJcnEgPSBhY3RpdmVfcmVxdWVzdChycSk7CisJaWYgKHJx
KQorCQljZS0+cmluZy0+aGVhZCA9IGludGVsX3Jpbmdfd3JhcChjZS0+cmluZywgcnEtPmhlYWQp
OworCWVsc2UKKwkJY2UtPnJpbmctPmhlYWQgPSBjZS0+cmluZy0+dGFpbDsKKwlpbnRlbF9yaW5n
X3VwZGF0ZV9zcGFjZShjZS0+cmluZyk7CisKKwkvKiBTY3J1YiB0aGUgY29udGV4dCBpbWFnZSB0
byBwcmV2ZW50IHJlcGxheWluZyB0aGUgcHJldmlvdXMgYmF0Y2ggKi8KKwlyZXN0b3JlX2RlZmF1
bHRfc3RhdGUoY2UsIGVuZ2luZSk7CisJX19leGVjbGlzdHNfdXBkYXRlX3JlZ19zdGF0ZShjZSwg
ZW5naW5lKTsKKworCS8qIFdlJ3ZlIHN3aXRjaGVkIGF3YXksIHNvIHRoaXMgc2hvdWxkIGJlIGEg
bm8tb3AsIGJ1dCBpbnRlbnQgbWF0dGVycyAqLworCWNlLT5scmNfZGVzYyB8PSBDVFhfREVTQ19G
T1JDRV9SRVNUT1JFOworCisJX19jb250ZXh0X3Bpbl9yZWxlYXNlKGNlKTsKK30KKwogc3RhdGlj
IGlubGluZSB2b2lkCiBfX2V4ZWNsaXN0c19zY2hlZHVsZV9vdXQoc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnEsCiAJCQkgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqIGNvbnN0IGVuZ2luZSkKQEAgLTEw
MDEsNiArMTA4NCw5IEBAIF9fZXhlY2xpc3RzX3NjaGVkdWxlX291dChzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycSwKIAlleGVjbGlzdHNfY29udGV4dF9zdGF0dXNfY2hhbmdlKHJxLCBJTlRFTF9DT05U
RVhUX1NDSEVEVUxFX09VVCk7CiAJaW50ZWxfZ3RfcG1fcHV0KGVuZ2luZS0+Z3QpOwogCisJaWYg
KHVubGlrZWx5KGk5MTVfZ2VtX2NvbnRleHRfaXNfYmFubmVkKGNlLT5nZW1fY29udGV4dCkpKQor
CQlyZXNldF9hY3RpdmUocnEsIGVuZ2luZSk7CisKIAkvKgogCSAqIElmIHRoaXMgaXMgcGFydCBv
ZiBhIHZpcnR1YWwgZW5naW5lLCBpdHMgbmV4dCByZXF1ZXN0IG1heQogCSAqIGhhdmUgYmVlbiBi
bG9ja2VkIHdhaXRpbmcgZm9yIGFjY2VzcyB0byB0aGUgYWN0aXZlIGNvbnRleHQuCkBAIC0xMzk1
LDYgKzE0ODEsMTAgQEAgc3RhdGljIHVuc2lnbmVkIGxvbmcgYWN0aXZlX3ByZWVtcHRfdGltZW91
dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJaWYgKCFycSkKIAkJcmV0dXJuIDA7
CiAKKwkvKiBGb3JjZSBhIGZhc3QgcmVzZXQgZm9yIHRlcm1pbmF0ZWQgY29udGV4dHMgKGlnbm9y
aW5nIHN5c2ZzISkgKi8KKwlpZiAodW5saWtlbHkoaTkxNV9nZW1fY29udGV4dF9pc19iYW5uZWQo
cnEtPmdlbV9jb250ZXh0KSkpCisJCXJldHVybiAxOworCiAJcmV0dXJuIFJFQURfT05DRShlbmdp
bmUtPnByb3BzLnByZWVtcHRfdGltZW91dCk7CiB9CiAKQEAgLTI4MTYsMjkgKzI5MDYsNiBAQCBz
dGF0aWMgdm9pZCByZXNldF9jc2JfcG9pbnRlcnMoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lKQogCQkJICAgICAgICZleGVjbGlzdHMtPmNzYl9zdGF0dXNbcmVzZXRfdmFsdWVdKTsKIH0K
IAotc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3QgKmFjdGl2ZV9yZXF1ZXN0KHN0cnVjdCBpOTE1
X3JlcXVlc3QgKnJxKQotewotCWNvbnN0IHN0cnVjdCBpbnRlbF9jb250ZXh0ICogY29uc3QgY2Ug
PSBycS0+aHdfY29udGV4dDsKLQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICphY3RpdmUgPSBOVUxMOwot
CXN0cnVjdCBsaXN0X2hlYWQgKmxpc3Q7Ci0KLQlpZiAoIWk5MTVfcmVxdWVzdF9pc19hY3RpdmUo
cnEpKSAvKiB1bndvdW5kLCBidXQgaW5jb21wbGV0ZSEgKi8KLQkJcmV0dXJuIHJxOwotCi0JbGlz
dCA9ICZpOTE1X3JlcXVlc3RfYWN0aXZlX3RpbWVsaW5lKHJxKS0+cmVxdWVzdHM7Ci0JbGlzdF9m
b3JfZWFjaF9lbnRyeV9mcm9tX3JldmVyc2UocnEsIGxpc3QsIGxpbmspIHsKLQkJaWYgKGk5MTVf
cmVxdWVzdF9jb21wbGV0ZWQocnEpKQotCQkJYnJlYWs7Ci0KLQkJaWYgKHJxLT5od19jb250ZXh0
ICE9IGNlKQotCQkJYnJlYWs7Ci0KLQkJYWN0aXZlID0gcnE7Ci0JfQotCi0JcmV0dXJuIGFjdGl2
ZTsKLX0KLQogc3RhdGljIHZvaWQgX19leGVjbGlzdHNfcmVzZXRfcmVnX3N0YXRlKGNvbnN0IHN0
cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKIAkJCQkJY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lKQogewpAQCAtMjg1NSw3ICsyOTIyLDYgQEAgc3RhdGljIHZvaWQgX19leGVjbGlz
dHNfcmVzZXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBib29sIHN0YWxsZWQpCiAJ
c3RydWN0IGludGVsX2VuZ2luZV9leGVjbGlzdHMgKiBjb25zdCBleGVjbGlzdHMgPSAmZW5naW5l
LT5leGVjbGlzdHM7CiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCXN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJxOwotCXUzMiAqcmVnczsKIAogCW1iKCk7IC8qIHBhcmFub2lhOiByZWFkIHRoZSBD
U0IgcG9pbnRlcnMgZnJvbSBhZnRlciB0aGUgcmVzZXQgKi8KIAljbGZsdXNoKGV4ZWNsaXN0cy0+
Y3NiX3dyaXRlKTsKQEAgLTI5MzQsMTMgKzMwMDAsNyBAQCBzdGF0aWMgdm9pZCBfX2V4ZWNsaXN0
c19yZXNldChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIGJvb2wgc3RhbGxlZCkKIAkg
KiB0byByZWNyZWF0ZSBpdHMgb3duIHN0YXRlLgogCSAqLwogCUdFTV9CVUdfT04oIWludGVsX2Nv
bnRleHRfaXNfcGlubmVkKGNlKSk7Ci0JcmVncyA9IGNlLT5scmNfcmVnX3N0YXRlOwotCWlmIChl
bmdpbmUtPnBpbm5lZF9kZWZhdWx0X3N0YXRlKSB7Ci0JCW1lbWNweShyZWdzLCAvKiBza2lwIHJl
c3RvcmluZyB0aGUgdmFuaWxsYSBQUEhXU1AgKi8KLQkJICAgICAgIGVuZ2luZS0+cGlubmVkX2Rl
ZmF1bHRfc3RhdGUgKyBMUkNfU1RBVEVfUE4gKiBQQUdFX1NJWkUsCi0JCSAgICAgICBlbmdpbmUt
PmNvbnRleHRfc2l6ZSAtIFBBR0VfU0laRSk7Ci0JfQotCWV4ZWNsaXN0c19pbml0X3JlZ19zdGF0
ZShyZWdzLCBjZSwgZW5naW5lLCBjZS0+cmluZywgZmFsc2UpOworCXJlc3RvcmVfZGVmYXVsdF9z
dGF0ZShjZSwgZW5naW5lKTsKIAogb3V0X3JlcGxheToKIAlHRU1fVFJBQ0UoIiVzIHJlcGxheSB7
aGVhZDolMDR4LCB0YWlsOiUwNHhcbiIsCkBAIC00NTc3LDE2ICs0NjM3LDggQEAgdm9pZCBpbnRl
bF9scl9jb250ZXh0X3Jlc2V0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAkgKiBm
dXR1cmUgcmVxdWVzdCB3aWxsIGJlIGFmdGVyIHVzZXJzcGFjZSBoYXMgaGFkIHRoZSBvcHBvcnR1
bml0eQogCSAqIHRvIHJlY3JlYXRlIGl0cyBvd24gc3RhdGUuCiAJICovCi0JaWYgKHNjcnViKSB7
Ci0JCXUzMiAqcmVncyA9IGNlLT5scmNfcmVnX3N0YXRlOwotCi0JCWlmIChlbmdpbmUtPnBpbm5l
ZF9kZWZhdWx0X3N0YXRlKSB7Ci0JCQltZW1jcHkocmVncywgLyogc2tpcCByZXN0b3JpbmcgdGhl
IHZhbmlsbGEgUFBIV1NQICovCi0JCQkgICAgICAgZW5naW5lLT5waW5uZWRfZGVmYXVsdF9zdGF0
ZSArIExSQ19TVEFURV9QTiAqIFBBR0VfU0laRSwKLQkJCSAgICAgICBlbmdpbmUtPmNvbnRleHRf
c2l6ZSAtIFBBR0VfU0laRSk7Ci0JCX0KLQkJZXhlY2xpc3RzX2luaXRfcmVnX3N0YXRlKHJlZ3Ms
IGNlLCBlbmdpbmUsIGNlLT5yaW5nLCBmYWxzZSk7Ci0JfQorCWlmIChzY3J1YikKKwkJcmVzdG9y
ZV9kZWZhdWx0X3N0YXRlKGNlLCBlbmdpbmUpOwogCiAJLyogUmVydW4gdGhlIHJlcXVlc3Q7IGl0
cyBwYXlsb2FkIGhhcyBiZWVuIG5ldXRlcmVkIChpZiBndWlsdHkpLiAqLwogCWNlLT5yaW5nLT5o
ZWFkID0gaGVhZDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0
X2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKaW5kZXggZTdh
ODZmNjBjZjgyLi5iOWFkZTM5N2E2OTEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3NlbGZ0ZXN0X2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0
X2xyYy5jCkBAIC03LDYgKzcsNyBAQAogI2luY2x1ZGUgPGxpbnV4L3ByaW1lX251bWJlcnMuaD4K
IAogI2luY2x1ZGUgImdlbS9pOTE1X2dlbV9wbS5oIgorI2luY2x1ZGUgImd0L2ludGVsX2VuZ2lu
ZV9oZWFydGJlYXQuaCIKICNpbmNsdWRlICJndC9pbnRlbF9yZXNldC5oIgogCiAjaW5jbHVkZSAi
aTkxNV9zZWxmdGVzdC5oIgpAQCAtMTAxNiw2ICsxMDE3LDMyNSBAQCBzdGF0aWMgaW50IGxpdmVf
bm9wcmVlbXB0KHZvaWQgKmFyZykKIAlnb3RvIGVycl9jbGllbnRfYjsKIH0KIAorc3RydWN0IGxp
dmVfcHJlZW1wdF9jYW5jZWwgeworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKKwlz
dHJ1Y3QgcHJlZW1wdF9jbGllbnQgYSwgYjsKK307CisKK3N0YXRpYyBpbnQgX19jYW5jZWxfYWN0
aXZlMChzdHJ1Y3QgbGl2ZV9wcmVlbXB0X2NhbmNlbCAqYXJnKQoreworCXN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJxOworCXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7CisJaW50IGVycjsKKworCS8qIFBy
ZWVtcHQgY2FuY2VsIG9mIEVMU1AwICovCisJR0VNX1RSQUNFKCIlcyglcylcbiIsIF9fZnVuY19f
LCBhcmctPmVuZ2luZS0+bmFtZSk7CisJaWYgKGlndF9saXZlX3Rlc3RfYmVnaW4oJnQsIGFyZy0+
ZW5naW5lLT5pOTE1LAorCQkJCV9fZnVuY19fLCBhcmctPmVuZ2luZS0+bmFtZSkpCisJCXJldHVy
biAtRUlPOworCisJY2xlYXJfYml0KENPTlRFWFRfQkFOTkVELCAmYXJnLT5hLmN0eC0+ZmxhZ3Mp
OworCXJxID0gc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmYXJnLT5hLnNwaW4sCisJCQkJICAgIGFy
Zy0+YS5jdHgsIGFyZy0+ZW5naW5lLAorCQkJCSAgICBNSV9BUkJfQ0hFQ0spOworCWlmIChJU19F
UlIocnEpKQorCQlyZXR1cm4gUFRSX0VSUihycSk7CisKKwlpOTE1X3JlcXVlc3RfZ2V0KHJxKTsK
KwlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKwlpZiAoIWlndF93YWl0X2Zvcl9zcGlubmVyKCZhcmct
PmEuc3BpbiwgcnEpKSB7CisJCWVyciA9IC1FSU87CisJCWdvdG8gb3V0OworCX0KKworCWk5MTVf
Z2VtX2NvbnRleHRfc2V0X2Jhbm5lZChhcmctPmEuY3R4KTsKKwllcnIgPSBpbnRlbF9lbmdpbmVf
cHVsc2UoYXJnLT5lbmdpbmUpOworCWlmIChlcnIpCisJCWdvdG8gb3V0OworCisJaWYgKGk5MTVf
cmVxdWVzdF93YWl0KHJxLCAwLCBIWiAvIDUpIDwgMCkgeworCQllcnIgPSAtRUlPOworCQlnb3Rv
IG91dDsKKwl9CisKKwlpZiAocnEtPmZlbmNlLmVycm9yICE9IC1FSU8pIHsKKwkJcHJfZXJyKCJD
YW5jZWxsZWQgaW5mbGlnaHQwIHJlcXVlc3QgZGlkIG5vdCByZXBvcnQgLUVJT1xuIik7CisJCWVy
ciA9IC1FSU5WQUw7CisJCWdvdG8gb3V0OworCX0KKworb3V0OgorCWk5MTVfcmVxdWVzdF9wdXQo
cnEpOworCWlmIChpZ3RfbGl2ZV90ZXN0X2VuZCgmdCkpCisJCWVyciA9IC1FSU87CisJcmV0dXJu
IGVycjsKK30KKworc3RhdGljIGludCBfX2NhbmNlbF9hY3RpdmUxKHN0cnVjdCBsaXZlX3ByZWVt
cHRfY2FuY2VsICphcmcpCit7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnFbMl0gPSB7fTsKKwlz
dHJ1Y3QgaWd0X2xpdmVfdGVzdCB0OworCWludCBlcnI7CisKKwkvKiBQcmVlbXB0IGNhbmNlbCBv
ZiBFTFNQMSAqLworCUdFTV9UUkFDRSgiJXMoJXMpXG4iLCBfX2Z1bmNfXywgYXJnLT5lbmdpbmUt
Pm5hbWUpOworCWlmIChpZ3RfbGl2ZV90ZXN0X2JlZ2luKCZ0LCBhcmctPmVuZ2luZS0+aTkxNSwK
KwkJCQlfX2Z1bmNfXywgYXJnLT5lbmdpbmUtPm5hbWUpKQorCQlyZXR1cm4gLUVJTzsKKworCWNs
ZWFyX2JpdChDT05URVhUX0JBTk5FRCwgJmFyZy0+YS5jdHgtPmZsYWdzKTsKKwlycVswXSA9IHNw
aW5uZXJfY3JlYXRlX3JlcXVlc3QoJmFyZy0+YS5zcGluLAorCQkJCSAgICAgICBhcmctPmEuY3R4
LCBhcmctPmVuZ2luZSwKKwkJCQkgICAgICAgTUlfTk9PUCk7IC8qIG5vIHByZWVtcHRpb24gKi8K
KwlpZiAoSVNfRVJSKHJxWzBdKSkKKwkJcmV0dXJuIFBUUl9FUlIocnFbMF0pOworCisJaTkxNV9y
ZXF1ZXN0X2dldChycVswXSk7CisJaTkxNV9yZXF1ZXN0X2FkZChycVswXSk7CisJaWYgKCFpZ3Rf
d2FpdF9mb3Jfc3Bpbm5lcigmYXJnLT5hLnNwaW4sIHJxWzBdKSkgeworCQllcnIgPSAtRUlPOwor
CQlnb3RvIG91dDsKKwl9CisKKwljbGVhcl9iaXQoQ09OVEVYVF9CQU5ORUQsICZhcmctPmIuY3R4
LT5mbGFncyk7CisJcnFbMV0gPSBzcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZhcmctPmIuc3BpbiwK
KwkJCQkgICAgICAgYXJnLT5iLmN0eCwgYXJnLT5lbmdpbmUsCisJCQkJICAgICAgIE1JX0FSQl9D
SEVDSyk7CisJaWYgKElTX0VSUihycVsxXSkpIHsKKwkJZXJyID0gUFRSX0VSUihycVsxXSk7CisJ
CWdvdG8gb3V0OworCX0KKworCWk5MTVfcmVxdWVzdF9nZXQocnFbMV0pOworCWVyciA9IGk5MTVf
cmVxdWVzdF9hd2FpdF9kbWFfZmVuY2UocnFbMV0sICZycVswXS0+ZmVuY2UpOworCWk5MTVfcmVx
dWVzdF9hZGQocnFbMV0pOworCWlmIChlcnIpCisJCWdvdG8gb3V0OworCisJaTkxNV9nZW1fY29u
dGV4dF9zZXRfYmFubmVkKGFyZy0+Yi5jdHgpOworCWVyciA9IGludGVsX2VuZ2luZV9wdWxzZShh
cmctPmVuZ2luZSk7CisJaWYgKGVycikKKwkJZ290byBvdXQ7CisKKwlpZ3Rfc3Bpbm5lcl9lbmQo
JmFyZy0+YS5zcGluKTsKKwlpZiAoaTkxNV9yZXF1ZXN0X3dhaXQocnFbMV0sIDAsIEhaIC8gNSkg
PCAwKSB7CisJCWVyciA9IC1FSU87CisJCWdvdG8gb3V0OworCX0KKworCWlmIChycVswXS0+ZmVu
Y2UuZXJyb3IgIT0gMCkgeworCQlwcl9lcnIoIk5vcm1hbCBpbmZsaWdodDAgcmVxdWVzdCBkaWQg
bm90IGNvbXBsZXRlXG4iKTsKKwkJZXJyID0gLUVJTlZBTDsKKwkJZ290byBvdXQ7CisJfQorCisJ
aWYgKHJxWzFdLT5mZW5jZS5lcnJvciAhPSAtRUlPKSB7CisJCXByX2VycigiQ2FuY2VsbGVkIGlu
ZmxpZ2h0MSByZXF1ZXN0IGRpZCBub3QgcmVwb3J0IC1FSU9cbiIpOworCQllcnIgPSAtRUlOVkFM
OworCQlnb3RvIG91dDsKKwl9CisKK291dDoKKwlpOTE1X3JlcXVlc3RfcHV0KHJxWzFdKTsKKwlp
OTE1X3JlcXVlc3RfcHV0KHJxWzBdKTsKKwlpZiAoaWd0X2xpdmVfdGVzdF9lbmQoJnQpKQorCQll
cnIgPSAtRUlPOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQgX19jYW5jZWxfcXVldWVk
KHN0cnVjdCBsaXZlX3ByZWVtcHRfY2FuY2VsICphcmcpCit7CisJc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnFbM10gPSB7fTsKKwlzdHJ1Y3QgaWd0X2xpdmVfdGVzdCB0OworCWludCBlcnI7CisKKwkv
KiBGdWxsIEVMU1AgYW5kIG9uZSBpbiB0aGUgd2luZ3MgKi8KKwlHRU1fVFJBQ0UoIiVzKCVzKVxu
IiwgX19mdW5jX18sIGFyZy0+ZW5naW5lLT5uYW1lKTsKKwlpZiAoaWd0X2xpdmVfdGVzdF9iZWdp
bigmdCwgYXJnLT5lbmdpbmUtPmk5MTUsCisJCQkJX19mdW5jX18sIGFyZy0+ZW5naW5lLT5uYW1l
KSkKKwkJcmV0dXJuIC1FSU87CisKKwljbGVhcl9iaXQoQ09OVEVYVF9CQU5ORUQsICZhcmctPmEu
Y3R4LT5mbGFncyk7CisJcnFbMF0gPSBzcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZhcmctPmEuc3Bp
biwKKwkJCQkgICAgICAgYXJnLT5hLmN0eCwgYXJnLT5lbmdpbmUsCisJCQkJICAgICAgIE1JX0FS
Ql9DSEVDSyk7CisJaWYgKElTX0VSUihycVswXSkpCisJCXJldHVybiBQVFJfRVJSKHJxWzBdKTsK
KworCWk5MTVfcmVxdWVzdF9nZXQocnFbMF0pOworCWk5MTVfcmVxdWVzdF9hZGQocnFbMF0pOwor
CWlmICghaWd0X3dhaXRfZm9yX3NwaW5uZXIoJmFyZy0+YS5zcGluLCBycVswXSkpIHsKKwkJZXJy
ID0gLUVJTzsKKwkJZ290byBvdXQ7CisJfQorCisJY2xlYXJfYml0KENPTlRFWFRfQkFOTkVELCAm
YXJnLT5iLmN0eC0+ZmxhZ3MpOworCXJxWzFdID0gaWd0X3JlcXVlc3RfYWxsb2MoYXJnLT5iLmN0
eCwgYXJnLT5lbmdpbmUpOworCWlmIChJU19FUlIocnFbMV0pKSB7CisJCWVyciA9IFBUUl9FUlIo
cnFbMV0pOworCQlnb3RvIG91dDsKKwl9CisKKwlpOTE1X3JlcXVlc3RfZ2V0KHJxWzFdKTsKKwll
cnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfZG1hX2ZlbmNlKHJxWzFdLCAmcnFbMF0tPmZlbmNlKTsK
KwlpOTE1X3JlcXVlc3RfYWRkKHJxWzFdKTsKKwlpZiAoZXJyKQorCQlnb3RvIG91dDsKKworCXJx
WzJdID0gc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmYXJnLT5iLnNwaW4sCisJCQkJICAgICAgIGFy
Zy0+YS5jdHgsIGFyZy0+ZW5naW5lLAorCQkJCSAgICAgICBNSV9BUkJfQ0hFQ0spOworCWlmIChJ
U19FUlIocnFbMl0pKSB7CisJCWVyciA9IFBUUl9FUlIocnFbMl0pOworCQlnb3RvIG91dDsKKwl9
CisKKwlpOTE1X3JlcXVlc3RfZ2V0KHJxWzJdKTsKKwllcnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRf
ZG1hX2ZlbmNlKHJxWzJdLCAmcnFbMV0tPmZlbmNlKTsKKwlpOTE1X3JlcXVlc3RfYWRkKHJxWzJd
KTsKKwlpZiAoZXJyKQorCQlnb3RvIG91dDsKKworCWk5MTVfZ2VtX2NvbnRleHRfc2V0X2Jhbm5l
ZChhcmctPmEuY3R4KTsKKwllcnIgPSBpbnRlbF9lbmdpbmVfcHVsc2UoYXJnLT5lbmdpbmUpOwor
CWlmIChlcnIpCisJCWdvdG8gb3V0OworCisJaWYgKGk5MTVfcmVxdWVzdF93YWl0KHJxWzJdLCAw
LCBIWiAvIDUpIDwgMCkgeworCQllcnIgPSAtRUlPOworCQlnb3RvIG91dDsKKwl9CisKKwlpZiAo
cnFbMF0tPmZlbmNlLmVycm9yICE9IC1FSU8pIHsKKwkJcHJfZXJyKCJDYW5jZWxsZWQgaW5mbGln
aHQwIHJlcXVlc3QgZGlkIG5vdCByZXBvcnQgLUVJT1xuIik7CisJCWVyciA9IC1FSU5WQUw7CisJ
CWdvdG8gb3V0OworCX0KKworCWlmIChycVsxXS0+ZmVuY2UuZXJyb3IgIT0gMCkgeworCQlwcl9l
cnIoIk5vcm1hbCBpbmZsaWdodDEgcmVxdWVzdCBkaWQgbm90IGNvbXBsZXRlXG4iKTsKKwkJZXJy
ID0gLUVJTlZBTDsKKwkJZ290byBvdXQ7CisJfQorCisJaWYgKHJxWzJdLT5mZW5jZS5lcnJvciAh
PSAtRUlPKSB7CisJCXByX2VycigiQ2FuY2VsbGVkIHF1ZXVlZCByZXF1ZXN0IGRpZCBub3QgcmVw
b3J0IC1FSU9cbiIpOworCQllcnIgPSAtRUlOVkFMOworCQlnb3RvIG91dDsKKwl9CisKK291dDoK
KwlpOTE1X3JlcXVlc3RfcHV0KHJxWzJdKTsKKwlpOTE1X3JlcXVlc3RfcHV0KHJxWzFdKTsKKwlp
OTE1X3JlcXVlc3RfcHV0KHJxWzBdKTsKKwlpZiAoaWd0X2xpdmVfdGVzdF9lbmQoJnQpKQorCQll
cnIgPSAtRUlPOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQgX19jYW5jZWxfaG9zdGls
ZShzdHJ1Y3QgbGl2ZV9wcmVlbXB0X2NhbmNlbCAqYXJnKQoreworCXN0cnVjdCBpOTE1X3JlcXVl
c3QgKnJxOworCWludCBlcnI7CisKKwkvKiBQcmVlbXB0IGNhbmNlbCBub24tcHJlZW1wdGlibGUg
c3Bpbm5lciBpbiBFTFNQMCAqLworCWlmICghQ09ORklHX0RSTV9JOTE1X1BSRUVNUFRfVElNRU9V
VCkKKwkJcmV0dXJuIDA7CisKKwlHRU1fVFJBQ0UoIiVzKCVzKVxuIiwgX19mdW5jX18sIGFyZy0+
ZW5naW5lLT5uYW1lKTsKKwljbGVhcl9iaXQoQ09OVEVYVF9CQU5ORUQsICZhcmctPmEuY3R4LT5m
bGFncyk7CisJcnEgPSBzcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZhcmctPmEuc3BpbiwKKwkJCQkg
ICAgYXJnLT5hLmN0eCwgYXJnLT5lbmdpbmUsCisJCQkJICAgIE1JX05PT1ApOyAvKiBwcmVlbXB0
aW9uIGRpc2FibGVkICovCisJaWYgKElTX0VSUihycSkpCisJCXJldHVybiBQVFJfRVJSKHJxKTsK
KworCWk5MTVfcmVxdWVzdF9nZXQocnEpOworCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCWlmICgh
aWd0X3dhaXRfZm9yX3NwaW5uZXIoJmFyZy0+YS5zcGluLCBycSkpIHsKKwkJZXJyID0gLUVJTzsK
KwkJZ290byBvdXQ7CisJfQorCisJaTkxNV9nZW1fY29udGV4dF9zZXRfYmFubmVkKGFyZy0+YS5j
dHgpOworCWVyciA9IGludGVsX2VuZ2luZV9wdWxzZShhcmctPmVuZ2luZSk7IC8qIGZvcmNlIHJl
c2V0ICovCisJaWYgKGVycikKKwkJZ290byBvdXQ7CisKKwlpZiAoaTkxNV9yZXF1ZXN0X3dhaXQo
cnEsIDAsIEhaIC8gNSkgPCAwKSB7CisJCWVyciA9IC1FSU87CisJCWdvdG8gb3V0OworCX0KKwor
CWlmIChycS0+ZmVuY2UuZXJyb3IgIT0gLUVJTykgeworCQlwcl9lcnIoIkNhbmNlbGxlZCBpbmZs
aWdodDAgcmVxdWVzdCBkaWQgbm90IHJlcG9ydCAtRUlPXG4iKTsKKwkJZXJyID0gLUVJTlZBTDsK
KwkJZ290byBvdXQ7CisJfQorCitvdXQ6CisJaTkxNV9yZXF1ZXN0X3B1dChycSk7CisJaWYgKGln
dF9mbHVzaF90ZXN0KGFyZy0+ZW5naW5lLT5pOTE1KSkKKwkJZXJyID0gLUVJTzsKKwlyZXR1cm4g
ZXJyOworfQorCitzdGF0aWMgaW50IGxpdmVfcHJlZW1wdF9jYW5jZWwodm9pZCAqYXJnKQorewor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnOworCXN0cnVjdCBsaXZlX3ByZWVt
cHRfY2FuY2VsIGRhdGE7CisJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisJaW50IGVyciA9IC1F
Tk9NRU07CisKKwkvKgorCSAqIFRvIGNhbmNlbCBhbiBpbmZsaWdodCBjb250ZXh0LCB3ZSBuZWVk
IHRvIGZpcnN0IHJlbW92ZSBpdCBmcm9tIHRoZQorCSAqIEdQVS4gVGhhdCBzb3VuZHMgbGlrZSBw
cmVlbXB0aW9uISBQbHVzIGEgbGl0dGxlIGJpdCBvZiBib29ra2VlcGluZy4KKwkgKi8KKworCWlm
ICghSEFTX0xPR0lDQUxfUklOR19QUkVFTVBUSU9OKGk5MTUpKQorCQlyZXR1cm4gMDsKKworCWlm
IChwcmVlbXB0X2NsaWVudF9pbml0KGk5MTUsICZkYXRhLmEpKQorCQlyZXR1cm4gLUVOT01FTTsK
KwlpZiAocHJlZW1wdF9jbGllbnRfaW5pdChpOTE1LCAmZGF0YS5iKSkKKwkJZ290byBlcnJfY2xp
ZW50X2E7CisKKwlmb3JfZWFjaF9lbmdpbmUoZGF0YS5lbmdpbmUsIGk5MTUsIGlkKSB7CisJCWlm
ICghaW50ZWxfZW5naW5lX2hhc19wcmVlbXB0aW9uKGRhdGEuZW5naW5lKSkKKwkJCWNvbnRpbnVl
OworCisJCWVyciA9IF9fY2FuY2VsX2FjdGl2ZTAoJmRhdGEpOworCQlpZiAoZXJyKQorCQkJZ290
byBlcnJfd2VkZ2VkOworCisJCWVyciA9IF9fY2FuY2VsX2FjdGl2ZTEoJmRhdGEpOworCQlpZiAo
ZXJyKQorCQkJZ290byBlcnJfd2VkZ2VkOworCisJCWVyciA9IF9fY2FuY2VsX3F1ZXVlZCgmZGF0
YSk7CisJCWlmIChlcnIpCisJCQlnb3RvIGVycl93ZWRnZWQ7CisKKwkJZXJyID0gX19jYW5jZWxf
aG9zdGlsZSgmZGF0YSk7CisJCWlmIChlcnIpCisJCQlnb3RvIGVycl93ZWRnZWQ7CisJfQorCisJ
ZXJyID0gMDsKK2Vycl9jbGllbnRfYjoKKwlwcmVlbXB0X2NsaWVudF9maW5pKCZkYXRhLmIpOwor
ZXJyX2NsaWVudF9hOgorCXByZWVtcHRfY2xpZW50X2ZpbmkoJmRhdGEuYSk7CisJcmV0dXJuIGVy
cjsKKworZXJyX3dlZGdlZDoKKwlHRU1fVFJBQ0VfRFVNUCgpOworCWlndF9zcGlubmVyX2VuZCgm
ZGF0YS5iLnNwaW4pOworCWlndF9zcGlubmVyX2VuZCgmZGF0YS5hLnNwaW4pOworCWludGVsX2d0
X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKKwlnb3RvIGVycl9jbGllbnRfYjsKK30KKwogc3RhdGlj
IGludCBsaXZlX3N1cHByZXNzX3NlbGZfcHJlZW1wdCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CkBAIC0yNTQ5LDYgKzI4NjksNyBAQCBpbnQgaW50
ZWxfZXhlY2xpc3RzX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQogCQlTVUJURVNUKGxpdmVfcHJlZW1wdCksCiAJCVNVQlRFU1QobGl2ZV9sYXRlX3ByZWVtcHQp
LAogCQlTVUJURVNUKGxpdmVfbm9wcmVlbXB0KSwKKwkJU1VCVEVTVChsaXZlX3ByZWVtcHRfY2Fu
Y2VsKSwKIAkJU1VCVEVTVChsaXZlX3N1cHByZXNzX3NlbGZfcHJlZW1wdCksCiAJCVNVQlRFU1Qo
bGl2ZV9zdXBwcmVzc193YWl0X3ByZWVtcHQpLAogCQlTVUJURVNUKGxpdmVfY2hhaW5fcHJlZW1w
dCksCi0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVs
LWdmeA==

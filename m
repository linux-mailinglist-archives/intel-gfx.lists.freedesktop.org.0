Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 815FA91E70
	for <lists+intel-gfx@lfdr.de>; Mon, 19 Aug 2019 09:59:05 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 590FD6E0C1;
	Mon, 19 Aug 2019 07:59:02 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E22C56E0AE
 for <intel-gfx@lists.freedesktop.org>; Mon, 19 Aug 2019 07:58:40 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18185107-1500050 
 for multiple; Mon, 19 Aug 2019 08:58:39 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 19 Aug 2019 08:58:31 +0100
Message-Id: <20190819075835.20065-15-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190819075835.20065-1-chris@chris-wilson.co.uk>
References: <20190819075835.20065-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 14/18] drm/i915: Pull i915_vma_pin under the
 vm->mutex
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UmVwbGFjZSB0aGUgc3RydWN0X211dGV4IHJlcXVpcmVtZW50IGZvciBwaW5uaW5nIHRoZSBpOTE1
X3ZtYSB3aXRoIHRoZQpsb2NhbCB2bS0+bXV0ZXggaW5zdGVhZC4gTm90ZSB0aGF0IHRoZSB2bS0+
bXV0ZXggaXMgdGFpbnRlZCBieSB0aGUKc2hyaW5rZXIgKHdlIHJlcXVpcmUgdW5iaW5kaW5nIGZy
b20gaW5zaWRlIGZzLXJlY2xhaW0pIGFuZCBzbyB3ZSBjYW5ub3QKYWxsb2NhdGUgd2hpbGUgaG9s
ZGluZyB0aGF0IG11dGV4LiBJbnN0ZWFkIHdlIGhhdmUgdG8gcHJlYWxsb2NhdGUKd29ya2VycyB0
byBkbyBhbGxvY2F0ZSBhbmQgYXBwbHkgdGhlIFBURSB1cGRhdGVzIGFmdGVyIHdlIGhhdmUgd2UK
cmVzZXJ2ZWQgdGhlaXIgc2xvdCBpbiB0aGUgZHJtX21tICh1c2luZyBmZW5jZXMgdG8gb3JkZXIg
dGhlIFBURSB3cml0ZXMKd2l0aCB0aGUgR1BVIHdvcmsgYW5kIHdpdGggbGF0ZXIgdW5iaW5kKS4K
Ck9wZW5zOiB2bWEtPm9wcy0+c2V0X3BhZ2VzKCkgY2FuIG1hbGxvYyBidXQgaXMgdW5kZXIgdm0t
Pm11dGV4CgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5j
by51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyAg
fCAgIDIgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMgIHwg
IDExICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMgICAgfCAg
MjQgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyAgICB8ICAx
NCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYyAgICAgIHwgIDIx
ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMgICAgfCAgIDUg
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oICAgIHwgICA1ICsK
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jICB8ICA2NyAtLS0t
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3N0b2xlbi5jICAgIHwgICA1ICst
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdGlsaW5nLmMgICAgfCAgIDYgLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYyAgIHwgIDI3ICstCiAu
Li4vZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jICAgfCAgIDIgKy0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0LmMgICAgICAgICAgICB8ICAgNSArLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMgIHwgIDE5ICstCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndnQvYXBlcnR1cmVfZ20uYyAgICAgICAgfCAgMTIgKy0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMgICAgICAgICAgICB8ICA2NiArKysrKwogZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaCAgICAgICAgICAgIHwgICAyICsKIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5cGVzLmggICAgICB8ICAgNSArCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jICAgICAgICAgICAgICAgfCAgNzcgKysrLS0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2V2aWN0LmMgICAgICAgICB8ICAyMCArLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZmVuY2VfcmVnLmMgICAgIHwgICA0ICstCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYyAgICAgICAgICAgfCAgNjggKystLS0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jICAgICAgICAgICAgICB8ICAyNiArLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYyAgICAgICAgICAgICAgIHwgMjczICsrKysrKysrKysr
LS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaCAgICAgICAgICAgICAgIHwg
IDU4ICsrLS0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMgICB8
ICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfdm1hLmMgICAgIHwg
ICAyICsKIDI3IGZpbGVzIGNoYW5nZWQsIDQwMyBpbnNlcnRpb25zKCspLCA0MzEgZGVsZXRpb25z
KC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRl
eCBlZTU0ZDk2NTljOTkuLjA0YTAyNmI4MGRlZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTMwNjMsMTIgKzMwNjMsMTAgQEAgaW50ZWxfYWxs
b2NfaW5pdGlhbF9wbGFuZV9vYmooc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCXJldHVybiBm
YWxzZTsKIAl9CiAKLQltdXRleF9sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CiAJb2JqID0gaTkx
NV9nZW1fb2JqZWN0X2NyZWF0ZV9zdG9sZW5fZm9yX3ByZWFsbG9jYXRlZChkZXZfcHJpdiwKIAkJ
CQkJCQkgICAgIGJhc2VfYWxpZ25lZCwKIAkJCQkJCQkgICAgIGJhc2VfYWxpZ25lZCwKIAkJCQkJ
CQkgICAgIHNpemVfYWxpZ25lZCk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7
CiAJaWYgKCFvYmopCiAJCXJldHVybiBmYWxzZTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX292ZXJsYXkuYwppbmRleCAyOWVkZmMzNDM3MTYuLjRmMzY1NTdiM2YzYiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMKQEAgLTEz
MDMsMTUgKzEzMDMsMTEgQEAgc3RhdGljIGludCBnZXRfcmVnaXN0ZXJzKHN0cnVjdCBpbnRlbF9v
dmVybGF5ICpvdmVybGF5LCBib29sIHVzZV9waHlzKQogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwog
CWludCBlcnI7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCW9i
aiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc3RvbGVuKGk5MTUsIFBBR0VfU0laRSk7CiAJaWYg
KG9iaiA9PSBOVUxMKQogCQlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGk5
MTUsIFBBR0VfU0laRSk7Ci0JaWYgKElTX0VSUihvYmopKSB7Ci0JCWVyciA9IFBUUl9FUlIob2Jq
KTsKLQkJZ290byBlcnJfdW5sb2NrOwotCX0KKwlpZiAoSVNfRVJSKG9iaikpCisJCXJldHVybiBQ
VFJfRVJSKG9iaik7CiAKIAl2bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4ob2JqLCBOVUxM
LCAwLCAwLCBQSU5fTUFQUEFCTEUpOwogCWlmIChJU19FUlIodm1hKSkgewpAQCAtMTMzMiwxMyAr
MTMyOCwxMCBAQCBzdGF0aWMgaW50IGdldF9yZWdpc3RlcnMoc3RydWN0IGludGVsX292ZXJsYXkg
Km92ZXJsYXksIGJvb2wgdXNlX3BoeXMpCiAJfQogCiAJb3ZlcmxheS0+cmVnX2JvID0gb2JqOwot
CW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIDA7CiAKIGVy
cl9wdXRfYm86CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwotZXJyX3VubG9jazoKLQltdXRl
eF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CiB9CiAKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYwppbmRleCBmYmU1MWY0ODUy
YWIuLjExNjQxYTgyY2VjNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX2RvbWFpbi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9k
b21haW4uYwpAQCAtMjM1LDcgKzIzNSwxMiBAQCBpbnQgaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNo
ZV9sZXZlbChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkJcmV0dXJuIHJldDsK
IAogCQlpZiAoIUhBU19MTEMoaTkxNSkgJiYgY2FjaGVfbGV2ZWwgIT0gSTkxNV9DQUNIRV9OT05F
KSB7Ci0JCQkvKiBBY2Nlc3MgdG8gc25vb3BhYmxlIHBhZ2VzIHRocm91Z2ggdGhlIEdUVCBpcwor
CQkJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CisKKwkJCXdha2VyZWYgPSBpbnRlbF9ydW50aW1l
X3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7CisKKwkJCS8qCisJCQkgKiBBY2Nlc3MgdG8gc25v
b3BhYmxlIHBhZ2VzIHRocm91Z2ggdGhlIEdUVCBpcwogCQkJICogaW5jb2hlcmVudCBhbmQgb24g
c29tZSBtYWNoaW5lcyBjYXVzZXMgYSBoYXJkCiAJCQkgKiBsb2NrdXAuIFJlbGlucXVpc2ggdGhl
IENQVSBtbWFwaW5nIHRvIGZvcmNlCiAJCQkgKiB1c2Vyc3BhY2UgdG8gcmVmYXVsdCBpbiB0aGUg
cGFnZXMgYW5kIHdlIGNhbgpAQCAtMjQzLDEwICsyNDgsMTQgQEAgaW50IGk5MTVfZ2VtX29iamVj
dF9zZXRfY2FjaGVfbGV2ZWwoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJCSAq
IHZhbGlkIGZvciB0aGF0IHBvaW50ZXIgYWNjZXNzLgogCQkJICovCiAJCQlyZXQgPSBtdXRleF9s
b2NrX2ludGVycnVwdGlibGUoJmk5MTUtPmdndHQudm0ubXV0ZXgpOwotCQkJaWYgKHJldCkKKwkJ
CWlmIChyZXQpIHsKKwkJCQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwK
KwkJCQkJCSAgICAgd2FrZXJlZik7CiAJCQkJcmV0dXJuIHJldDsKKwkJCX0KIAotCQkJaTkxNV9n
ZW1fb2JqZWN0X3JlbGVhc2VfbW1hcChvYmopOworCQkJaWYgKG9iai0+dXNlcmZhdWx0X2NvdW50
KQorCQkJCV9faTkxNV9nZW1fb2JqZWN0X3JlbGVhc2VfbW1hcChvYmopOwogCiAJCQkvKiBBcyB3
ZSBubyBsb25nZXIgbmVlZCBhIGZlbmNlIGZvciBHVFQgYWNjZXNzLAogCQkJICogd2UgY2FuIHJl
bGlucXVpc2ggaXQgbm93IChhbmQgc28gcHJldmVudCBoYXZpbmcKQEAgLTI2MSw2ICsyNzAsNyBA
QCBpbnQgaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNoZV9sZXZlbChzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqLAogCQkJCQlicmVhazsKIAkJCX0KIAkJCW11dGV4X3VubG9jaygmaTkxNS0+
Z2d0dC52bS5tdXRleCk7CisJCQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9w
bSwgd2FrZXJlZik7CiAJCQlpZiAocmV0KQogCQkJCXJldHVybiByZXQ7CiAJCX0gZWxzZSB7CkBA
IC0yNzcsNyArMjg3LDcgQEAgaW50IGk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVfbGV2ZWwoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJCWlmICghZHJtX21tX25vZGVfYWxsb2Nh
dGVkKCZ2bWEtPm5vZGUpKQogCQkJCWNvbnRpbnVlOwogCi0JCQlyZXQgPSBpOTE1X3ZtYV9iaW5k
KHZtYSwgY2FjaGVfbGV2ZWwsIFBJTl9VUERBVEUpOworCQkJcmV0ID0gaTkxNV92bWFfYmluZCh2
bWEsIGNhY2hlX2xldmVsLCBQSU5fVVBEQVRFLCBOVUxMKTsKIAkJCWlmIChyZXQpCiAJCQkJcmV0
dXJuIHJldDsKIAkJfQpAQCAtMzc4LDE2ICszODgsMTEgQEAgaW50IGk5MTVfZ2VtX3NldF9jYWNo
aW5nX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJaWYgKHJldCkK
IAkJZ290byBvdXQ7CiAKLQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChyZXQpCi0JCWdvdG8gb3V0OwotCiAJcmV0ID0gaTkxNV9n
ZW1fb2JqZWN0X2xvY2tfaW50ZXJydXB0aWJsZShvYmopOwogCWlmIChyZXQgPT0gMCkgewogCQly
ZXQgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X2NhY2hlX2xldmVsKG9iaiwgbGV2ZWwpOwogCQlpOTE1
X2dlbV9vYmplY3RfdW5sb2NrKG9iaik7CiAJfQotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CiAKIG91dDoKIAlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CkBAIC00ODAs
NiArNDg1LDcgQEAgc3RhdGljIHZvaWQgaTkxNV9nZW1fb2JqZWN0X2J1bXBfaW5hY3RpdmVfZ2d0
dChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCQlpZiAoIWRybV9tbV9ub2RlX2Fs
bG9jYXRlZCgmdm1hLT5ub2RlKSkKIAkJCWNvbnRpbnVlOwogCisJCUdFTV9CVUdfT04odm1hLT52
bSAhPSAmaTkxNS0+Z2d0dC52bSk7CiAJCWxpc3RfbW92ZV90YWlsKCZ2bWEtPnZtX2xpbmssICZ2
bWEtPnZtLT5ib3VuZF9saXN0KTsKIAl9CiAJbXV0ZXhfdW5sb2NrKCZpOTE1LT5nZ3R0LnZtLm11
dGV4KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVj
YnVmZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5j
CmluZGV4IDQ5MDIwNzIwYmU1ZS4uYTkwODVjMDMwN2Y0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKQEAgLTU0OSw4ICs1NDksMTEgQEAgZWJf
YWRkX3ZtYShzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYiwKIAkJZWJfdW5yZXNlcnZlX3ZtYSh2
bWEsIHZtYS0+ZXhlY19mbGFncyk7CiAKIAkJbGlzdF9hZGRfdGFpbCgmdm1hLT5leGVjX2xpbmss
ICZlYi0+dW5ib3VuZCk7Ci0JCWlmIChkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkp
CisJCWlmIChkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpIHsKKwkJCW11dGV4X2xv
Y2soJnZtYS0+dm0tPm11dGV4KTsKIAkJCWVyciA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQkJ
bXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CisJCX0KIAkJaWYgKHVubGlrZWx5KGVycikp
CiAJCQl2bWEtPmV4ZWNfZmxhZ3MgPSBOVUxMOwogCX0KQEAgLTY5Nyw3ICs3MDAsOSBAQCBzdGF0
aWMgaW50IGViX3Jlc2VydmUoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIpCiAKIAkJY2FzZSAx
OgogCQkJLyogVG9vIGZyYWdtZW50ZWQsIHVuYmluZCBldmVyeXRoaW5nIGFuZCByZXRyeSAqLwor
CQkJbXV0ZXhfbG9jaygmZWItPmNvbnRleHQtPnZtLT5tdXRleCk7CiAJCQllcnIgPSBpOTE1X2dl
bV9ldmljdF92bShlYi0+Y29udGV4dC0+dm0pOworCQkJbXV0ZXhfdW5sb2NrKCZlYi0+Y29udGV4
dC0+dm0tPm11dGV4KTsKIAkJCWlmIChlcnIpCiAJCQkJcmV0dXJuIGVycjsKIAkJCWJyZWFrOwpA
QCAtMTE4OSw4ICsxMTk0LDkgQEAgc3RhdGljIGludCBfX3JlbG9jX2dwdV9hbGxvYyhzdHJ1Y3Qg
aTkxNV9leGVjYnVmZmVyICplYiwKIAkJZ290byBza2lwX3JlcXVlc3Q7CiAKIAlpOTE1X3ZtYV9s
b2NrKGJhdGNoKTsKLQlHRU1fQlVHX09OKCFkbWFfcmVzdl90ZXN0X3NpZ25hbGVkX3JjdShiYXRj
aC0+cmVzdiwgdHJ1ZSkpOwotCWVyciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKGJhdGNoLCBy
cSwgMCk7CisJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X29iamVjdChycSwgYmF0Y2gtPm9iaiwg
dHJ1ZSk7CisJaWYgKGVyciA9PSAwKQorCQllcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShi
YXRjaCwgcnEsIDApOwogCWk5MTVfdm1hX3VubG9jayhiYXRjaCk7CiAJaWYgKGVycikKIAkJZ290
byBza2lwX3JlcXVlc3Q7CkBAIC0xMzg3LDcgKzEzOTMsNyBAQCBlYl9yZWxvY2F0ZV9lbnRyeShz
dHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYiwKIAkJaWYgKHJlbG9jLT53cml0ZV9kb21haW4gPT0g
STkxNV9HRU1fRE9NQUlOX0lOU1RSVUNUSU9OICYmCiAJCSAgICBJU19HRU4oZWItPmk5MTUsIDYp
KSB7CiAJCQllcnIgPSBpOTE1X3ZtYV9iaW5kKHRhcmdldCwgdGFyZ2V0LT5vYmotPmNhY2hlX2xl
dmVsLAotCQkJCQkgICAgUElOX0dMT0JBTCk7CisJCQkJCSAgICBQSU5fR0xPQkFMLCBOVUxMKTsK
IAkJCWlmIChXQVJOX09OQ0UoZXJyLAogCQkJCSAgICAgICJVbmV4cGVjdGVkIGZhaWx1cmUgdG8g
YmluZCB0YXJnZXQgVk1BISIpKQogCQkJCXJldHVybiBlcnI7CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fbW1hbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX21tYW4uYwppbmRleCA1OTU1MzlhMDllMzguLjA0NDBkYmZkYTI5NSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fbW1hbi5jCkBAIC0yNTEsMTYgKzI1MSw2
IEBAIHZtX2ZhdWx0X3QgaTkxNV9nZW1fZmF1bHQoc3RydWN0IHZtX2ZhdWx0ICp2bWYpCiAJCWdv
dG8gZXJyX3JwbTsKIAl9CiAKLQlyZXQgPSBpOTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZShk
ZXYpOwotCWlmIChyZXQpCi0JCWdvdG8gZXJyX3Jlc2V0OwotCi0JLyogQWNjZXNzIHRvIHNub29w
YWJsZSBwYWdlcyB0aHJvdWdoIHRoZSBHVFQgaXMgaW5jb2hlcmVudC4gKi8KLQlpZiAob2JqLT5j
YWNoZV9sZXZlbCAhPSBJOTE1X0NBQ0hFX05PTkUgJiYgIUhBU19MTEMoaTkxNSkpIHsKLQkJcmV0
ID0gLUVGQVVMVDsKLQkJZ290byBlcnJfdW5sb2NrOwotCX0KLQogCS8qIE5vdyBwaW4gaXQgaW50
byB0aGUgR1RUIGFzIG5lZWRlZCAqLwogCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3Bpbihv
YmosIE5VTEwsIDAsIDAsCiAJCQkJICAgICAgIFBJTl9NQVBQQUJMRSB8CkBAIC0yOTAsNyArMjgw
LDEzIEBAIHZtX2ZhdWx0X3QgaTkxNV9nZW1fZmF1bHQoc3RydWN0IHZtX2ZhdWx0ICp2bWYpCiAJ
fQogCWlmIChJU19FUlIodm1hKSkgewogCQlyZXQgPSBQVFJfRVJSKHZtYSk7Ci0JCWdvdG8gZXJy
X3VubG9jazsKKwkJZ290byBlcnJfcmVzZXQ7CisJfQorCisJLyogQWNjZXNzIHRvIHNub29wYWJs
ZSBwYWdlcyB0aHJvdWdoIHRoZSBHVFQgaXMgaW5jb2hlcmVudC4gKi8KKwlpZiAob2JqLT5jYWNo
ZV9sZXZlbCAhPSBJOTE1X0NBQ0hFX05PTkUgJiYgIUhBU19MTEMoaTkxNSkpIHsKKwkJcmV0ID0g
LUVGQVVMVDsKKwkJZ290byBlcnJfdW5waW47CiAJfQogCiAJcmV0ID0gaTkxNV92bWFfcGluX2Zl
bmNlKHZtYSk7CkBAIC0zMTksMTMgKzMxNSwxMCBAQCB2bV9mYXVsdF90IGk5MTVfZ2VtX2ZhdWx0
KHN0cnVjdCB2bV9mYXVsdCAqdm1mKQogCQkJCSAgIG1zZWNzX3RvX2ppZmZpZXNfdGltZW91dChD
T05GSUdfRFJNX0k5MTVfVVNFUkZBVUxUX0FVVE9TVVNQRU5EKSk7CiAKIAlpOTE1X3ZtYV9zZXRf
Z2d0dF93cml0ZSh2bWEpOwotCiBlcnJfZmVuY2U6CiAJaTkxNV92bWFfdW5waW5fZmVuY2Uodm1h
KTsKIGVycl91bnBpbjoKIAlfX2k5MTVfdm1hX3VucGluKHZtYSk7Ci1lcnJfdW5sb2NrOgotCW11
dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogZXJyX3Jlc2V0OgogCWludGVsX2d0X3Jl
c2V0X3VubG9jayhnZ3R0LT52bS5ndCwgc3JjdSk7CiBlcnJfcnBtOgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jCmluZGV4IDBlZjYwZGFlMjNhNy4uODI4YzI5MWJh
ZjAxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jCkBAIC0x
NTksMTggKzE1OSwxMyBAQCBzdGF0aWMgdm9pZCBfX2k5MTVfZ2VtX2ZyZWVfb2JqZWN0cyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAogCQl0cmFjZV9pOTE1X2dlbV9vYmplY3RfZGVz
dHJveShvYmopOwogCi0JCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJ
CWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZSh2bWEsIHZuLCAmb2JqLT52bWEubGlzdCwgb2JqX2xp
bmspIHsKIAkJCUdFTV9CVUdfT04oaTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpOwotCQkJYXRvbWlj
X2FuZCh+STkxNV9WTUFfUElOX01BU0ssICZ2bWEtPmZsYWdzKTsKIAkJCWk5MTVfdm1hX2Rlc3Ry
b3kodm1hKTsKIAkJfQogCQlHRU1fQlVHX09OKCFsaXN0X2VtcHR5KCZvYmotPnZtYS5saXN0KSk7
CiAJCUdFTV9CVUdfT04oIVJCX0VNUFRZX1JPT1QoJm9iai0+dm1hLnRyZWUpKTsKIAotCQltdXRl
eF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJCUdFTV9CVUdfT04oYXRvbWlj
X3JlYWQoJm9iai0+YmluZF9jb3VudCkpOwogCQlHRU1fQlVHX09OKG9iai0+dXNlcmZhdWx0X2Nv
dW50KTsKIAkJR0VNX0JVR19PTighbGlzdF9lbXB0eSgmb2JqLT5sdXRfbGlzdCkpOwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oCmluZGV4IDVlZmI5OTM2ZTA1Yi4u
NmUyNmY4ZTE3Y2I1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fb2JqZWN0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVj
dC5oCkBAIC0xMDYsNiArMTA2LDExIEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBpOTE1X2dlbV9vYmpl
Y3RfbG9jayhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCWRtYV9yZXN2X2xvY2so
b2JqLT5iYXNlLnJlc3YsIE5VTEwpOwogfQogCitzdGF0aWMgaW5saW5lIGJvb2wgaTkxNV9nZW1f
b2JqZWN0X3RyeWxvY2soc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKK3sKKwlyZXR1
cm4gZG1hX3Jlc3ZfdHJ5bG9jayhvYmotPmJhc2UucmVzdik7Cit9CisKIHN0YXRpYyBpbmxpbmUg
aW50CiBpOTE1X2dlbV9vYmplY3RfbG9ja19pbnRlcnJ1cHRpYmxlKHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmopCiB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fc2hyaW5rZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9z
aHJpbmtlci5jCmluZGV4IDk0OTcwZjYwZDdmNi4uZGFlYzdkNzg5MThlIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYwpAQCAtMTYsNDAgKzE2LDYgQEAK
IAogI2luY2x1ZGUgImk5MTVfdHJhY2UuaCIKIAotc3RhdGljIGJvb2wgc2hyaW5rZXJfbG9jayhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKLQkJCSAgdW5zaWduZWQgaW50IGZsYWdzLAot
CQkJICBib29sICp1bmxvY2spCi17Ci0Jc3RydWN0IG11dGV4ICptID0gJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXg7Ci0KLQlzd2l0Y2ggKG11dGV4X3RyeWxvY2tfcmVjdXJzaXZlKG0pKSB7Ci0JY2Fz
ZSBNVVRFWF9UUllMT0NLX1JFQ1VSU0lWRToKLQkJKnVubG9jayA9IGZhbHNlOwotCQlyZXR1cm4g
dHJ1ZTsKLQotCWNhc2UgTVVURVhfVFJZTE9DS19GQUlMRUQ6Ci0JCSp1bmxvY2sgPSBmYWxzZTsK
LQkJaWYgKGZsYWdzICYgSTkxNV9TSFJJTktfQUNUSVZFICYmCi0JCSAgICBtdXRleF9sb2NrX2tp
bGxhYmxlX25lc3RlZChtLCBJOTE1X01NX1NIUklOS0VSKSA9PSAwKQotCQkJKnVubG9jayA9IHRy
dWU7Ci0JCXJldHVybiAqdW5sb2NrOwotCi0JY2FzZSBNVVRFWF9UUllMT0NLX1NVQ0NFU1M6Ci0J
CSp1bmxvY2sgPSB0cnVlOwotCQlyZXR1cm4gdHJ1ZTsKLQl9Ci0KLQlCVUcoKTsKLX0KLQotc3Rh
dGljIHZvaWQgc2hyaW5rZXJfdW5sb2NrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBi
b29sIHVubG9jaykKLXsKLQlpZiAoIXVubG9jaykKLQkJcmV0dXJuOwotCi0JbXV0ZXhfdW5sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLX0KLQogc3RhdGljIGJvb2wgc3dhcF9hdmFpbGFi
bGUodm9pZCkKIHsKIAlyZXR1cm4gZ2V0X25yX3N3YXBfcGFnZXMoKSA+IDA7CkBAIC0xNjIsMTAg
KzEyOCw2IEBAIGk5MTVfZ2VtX3NocmluayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZiA9IDA7CiAJdW5zaWduZWQgbG9uZyBjb3VudCA9IDA7
CiAJdW5zaWduZWQgbG9uZyBzY2FubmVkID0gMDsKLQlib29sIHVubG9jazsKLQotCWlmICghc2hy
aW5rZXJfbG9jayhpOTE1LCBzaHJpbmssICZ1bmxvY2spKQotCQlyZXR1cm4gMDsKIAogCS8qCiAJ
ICogV2hlbiBzaHJpbmtpbmcgdGhlIGFjdGl2ZSBsaXN0LCB3ZSBzaG91bGQgYWxzbyBjb25zaWRl
ciBhY3RpdmUKQEAgLTI3NSw4ICsyMzcsNiBAQCBpOTE1X2dlbV9zaHJpbmsoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsCiAJaWYgKHNocmluayAmIEk5MTVfU0hSSU5LX0JPVU5EKQogCQlp
bnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7CiAKLQlzaHJp
bmtlcl91bmxvY2soaTkxNSwgdW5sb2NrKTsKLQogCWlmIChucl9zY2FubmVkKQogCQkqbnJfc2Nh
bm5lZCArPSBzY2FubmVkOwogCXJldHVybiBjb3VudDsKQEAgLTM0NiwxMyArMzA2LDkgQEAgaTkx
NV9nZW1fc2hyaW5rZXJfc2NhbihzdHJ1Y3Qgc2hyaW5rZXIgKnNocmlua2VyLCBzdHJ1Y3Qgc2hy
aW5rX2NvbnRyb2wgKnNjKQogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0KIAkJY29u
dGFpbmVyX29mKHNocmlua2VyLCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSwgbW0uc2hyaW5rZXIp
OwogCXVuc2lnbmVkIGxvbmcgZnJlZWQ7Ci0JYm9vbCB1bmxvY2s7CiAKIAlzYy0+bnJfc2Nhbm5l
ZCA9IDA7CiAKLQlpZiAoIXNocmlua2VyX2xvY2soaTkxNSwgMCwgJnVubG9jaykpCi0JCXJldHVy
biBTSFJJTktfU1RPUDsKLQogCWZyZWVkID0gaTkxNV9nZW1fc2hyaW5rKGk5MTUsCiAJCQkJc2Mt
Pm5yX3RvX3NjYW4sCiAJCQkJJnNjLT5ucl9zY2FubmVkLApAQCAtMzczLDggKzMyOSw2IEBAIGk5
MTVfZ2VtX3Nocmlua2VyX3NjYW4oc3RydWN0IHNocmlua2VyICpzaHJpbmtlciwgc3RydWN0IHNo
cmlua19jb250cm9sICpzYykKIAkJfQogCX0KIAotCXNocmlua2VyX3VubG9jayhpOTE1LCB1bmxv
Y2spOwotCiAJcmV0dXJuIHNjLT5ucl9zY2FubmVkID8gZnJlZWQgOiBTSFJJTktfU1RPUDsKIH0K
IApAQCAtNDI2LDEwICszODAsNiBAQCBpOTE1X2dlbV9zaHJpbmtlcl92bWFwKHN0cnVjdCBub3Rp
Zmllcl9ibG9jayAqbmIsIHVuc2lnbmVkIGxvbmcgZXZlbnQsIHZvaWQgKnB0cgogCXN0cnVjdCBp
OTE1X3ZtYSAqdm1hLCAqbmV4dDsKIAl1bnNpZ25lZCBsb25nIGZyZWVkX3BhZ2VzID0gMDsKIAlp
bnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKLQlib29sIHVubG9jazsKLQotCWlmICghc2hyaW5rZXJf
bG9jayhpOTE1LCAwLCAmdW5sb2NrKSkKLQkJcmV0dXJuIE5PVElGWV9ET05FOwogCiAJd2l0aF9p
bnRlbF9ydW50aW1lX3BtKCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKQogCQlmcmVlZF9wYWdl
cyArPSBpOTE1X2dlbV9zaHJpbmsoaTkxNSwgLTFVTCwgTlVMTCwKQEAgLTQ0NiwxNSArMzk2LDEx
IEBAIGk5MTVfZ2VtX3Nocmlua2VyX3ZtYXAoc3RydWN0IG5vdGlmaWVyX2Jsb2NrICpuYiwgdW5z
aWduZWQgbG9uZyBldmVudCwgdm9pZCAqcHRyCiAJCWlmICghdm1hLT5pb21hcCB8fCBpOTE1X3Zt
YV9pc19hY3RpdmUodm1hKSkKIAkJCWNvbnRpbnVlOwogCi0JCW11dGV4X3VubG9jaygmaTkxNS0+
Z2d0dC52bS5tdXRleCk7CiAJCWlmIChpOTE1X3ZtYV91bmJpbmQodm1hKSA9PSAwKQogCQkJZnJl
ZWRfcGFnZXMgKz0gY291bnQ7Ci0JCW11dGV4X2xvY2soJmk5MTUtPmdndHQudm0ubXV0ZXgpOwog
CX0KIAltdXRleF91bmxvY2soJmk5MTUtPmdndHQudm0ubXV0ZXgpOwogCi0Jc2hyaW5rZXJfdW5s
b2NrKGk5MTUsIHVubG9jayk7Ci0KIAkqKHVuc2lnbmVkIGxvbmcgKilwdHIgKz0gZnJlZWRfcGFn
ZXM7CiAJcmV0dXJuIE5PVElGWV9ET05FOwogfQpAQCAtNDk3LDIyICs0NDMsOSBAQCB2b2lkIGk5
MTVfZ2VtX3Nocmlua2VyX3RhaW50c19tdXRleChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKIAogCWZzX3JlY2xhaW1fYWNxdWlyZShHRlBfS0VSTkVMKTsKIAotCS8qCi0JICogQXMgd2Ug
aW52YXJpYWJseSByZWx5IG9uIHRoZSBzdHJ1Y3RfbXV0ZXggd2l0aGluIHRoZSBzaHJpbmtlciwK
LQkgKiBidXQgaGF2ZSBhIGNvbXBsaWNhdGVkIHJlY3Vyc2lvbiBkYW5jZSwgdGFpbnQgYWxsIHRo
ZSBtdXRleGVzIHVzZWQKLQkgKiB3aXRoaW4gdGhlIHNocmlua2VyIHdpdGggdGhlIHN0cnVjdF9t
dXRleC4gRm9yIGNvbXBsZXRlbmVzcywgd2UKLQkgKiB0YWludCB3aXRoIGFsbCBzdWJjbGFzcyBv
ZiBzdHJ1Y3RfbXV0ZXgsIGV2ZW4gdGhvdWdoIHdlIHNob3VsZAotCSAqIG9ubHkgbmVlZCB0YWlu
dGluZyBieSBJOTE1X01NX05PUk1BTCB0byBjYXRjaCBwb3NzaWJsZSBBQkJBCi0JICogZGVhZGxv
Y2tzIGZyb20gdXNpbmcgc3RydWN0X211dGV4IGluc2lkZSBAbXV0ZXguCi0JICovCi0JbXV0ZXhf
YWNxdWlyZSgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleC5kZXBfbWFwLAotCQkgICAgICBJOTE1X01N
X1NIUklOS0VSLCAwLCBfUkVUX0lQXyk7Ci0KIAltdXRleF9hY3F1aXJlKCZtdXRleC0+ZGVwX21h
cCwgMCwgMCwgX1JFVF9JUF8pOwogCW11dGV4X3JlbGVhc2UoJm11dGV4LT5kZXBfbWFwLCAwLCBf
UkVUX0lQXyk7CiAKLQltdXRleF9yZWxlYXNlKCZpOTE1LT5kcm0uc3RydWN0X211dGV4LmRlcF9t
YXAsIDAsIF9SRVRfSVBfKTsKLQogCWZzX3JlY2xhaW1fcmVsZWFzZShHRlBfS0VSTkVMKTsKIAog
CWlmICh1bmxvY2spCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fc3RvbGVuLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc3RvbGVuLmMK
aW5kZXggMGQ4MWRlMTQ2MWI0Li4xNThkZGQ2ZTczNWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zdG9sZW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fc3RvbGVuLmMKQEAgLTYyMSw4ICs2MjEsNiBAQCBpOTE1X2dlbV9vYmpl
Y3RfY3JlYXRlX3N0b2xlbl9mb3JfcHJlYWxsb2NhdGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdgogCWlmICghZHJtX21tX2luaXRpYWxpemVkKCZkZXZfcHJpdi0+bW0uc3RvbGVu
KSkKIAkJcmV0dXJuIE5VTEw7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJpdi0+ZHJt
LnN0cnVjdF9tdXRleCk7Ci0KIAlEUk1fREVCVUdfRFJJVkVSKCJjcmVhdGluZyBwcmVhbGxvY2F0
ZWQgc3RvbGVuIG9iamVjdDogc3RvbGVuX29mZnNldD0lcGEsIGd0dF9vZmZzZXQ9JXBhLCBzaXpl
PSVwYVxuIiwKIAkJCSAmc3RvbGVuX29mZnNldCwgJmd0dF9vZmZzZXQsICZzaXplKTsKIApAQCAt
Njc0LDExICs2NzIsMTMgQEAgaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zdG9sZW5fZm9yX3ByZWFs
bG9jYXRlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYKIAkgKiBzZXR0aW5nIHVw
IHRoZSBHVFQgc3BhY2UuIFRoZSBhY3R1YWwgcmVzZXJ2YXRpb24gd2lsbCBvY2N1cgogCSAqIGxh
dGVyLgogCSAqLworCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAlyZXQgPSBpOTE1X2dl
bV9ndHRfcmVzZXJ2ZSgmZ2d0dC0+dm0sICZ2bWEtPm5vZGUsCiAJCQkJICAgc2l6ZSwgZ3R0X29m
ZnNldCwgb2JqLT5jYWNoZV9sZXZlbCwKIAkJCQkgICAwKTsKIAlpZiAocmV0KSB7CiAJCURSTV9E
RUJVR19EUklWRVIoImZhaWxlZCB0byBhbGxvY2F0ZSBzdG9sZW4gR1RUIHNwYWNlXG4iKTsKKwkJ
bXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCWdvdG8gZXJyX3BhZ2VzOwogCX0KIApA
QCAtNjg4LDcgKzY4OCw2IEBAIGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc3RvbGVuX2Zvcl9wcmVh
bGxvY2F0ZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2CiAJc2V0X2JpdChJOTE1
X1ZNQV9HTE9CQUxfQklORF9CSVQsIF9faTkxNV92bWFfZmxhZ3Modm1hKSk7CiAJX19pOTE1X3Zt
YV9zZXRfbWFwX2FuZF9mZW5jZWFibGUodm1hKTsKIAotCW11dGV4X2xvY2soJmdndHQtPnZtLm11
dGV4KTsKIAlsaXN0X2FkZF90YWlsKCZ2bWEtPnZtX2xpbmssICZnZ3R0LT52bS5ib3VuZF9saXN0
KTsKIAltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3RpbGluZy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX3RpbGluZy5jCmluZGV4IGNhMGMyZjQ1MTc0Mi4uZDJjZDA2NmJkMDY1
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdGlsaW5nLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3RpbGluZy5jCkBAIC0yMTIs
NyArMjEyLDYgQEAgaTkxNV9nZW1fb2JqZWN0X3NldF90aWxpbmcoc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaiwKIAogCUdFTV9CVUdfT04oIWk5MTVfdGlsaW5nX29rKG9iaiwgdGlsaW5n
LCBzdHJpZGUpKTsKIAlHRU1fQlVHX09OKCFzdHJpZGUgXiAodGlsaW5nID09IEk5MTVfVElMSU5H
X05PTkUpKTsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
IAogCWlmICgodGlsaW5nIHwgc3RyaWRlKSA9PSBvYmotPnRpbGluZ19hbmRfc3RyaWRlKQogCQly
ZXR1cm4gMDsKQEAgLTM2NCwxMiArMzYzLDcgQEAgaTkxNV9nZW1fc2V0X3RpbGluZ19pb2N0bChz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCQl9CiAJfQogCi0JZXJyID0gbXV0
ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZkZXYtPnN0cnVjdF9tdXRleCk7Ci0JaWYgKGVycikKLQkJ
Z290byBlcnI7Ci0KIAllcnIgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X3RpbGluZyhvYmosIGFyZ3Mt
PnRpbGluZ19tb2RlLCBhcmdzLT5zdHJpZGUpOwotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3Rf
bXV0ZXgpOwogCiAJLyogV2UgaGF2ZSB0byBtYWludGFpbiB0aGlzIGV4aXN0aW5nIEFCSS4uLiAq
LwogCWFyZ3MtPnN0cmlkZSA9IGk5MTVfZ2VtX29iamVjdF9nZXRfc3RyaWRlKG9iaik7CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYwppbmRleCA3NGRhMzU2MTFk
N2MuLmNkMzYyMzZlM2ZhZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX3VzZXJwdHIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
dXNlcnB0ci5jCkBAIC05Miw3ICs5Miw2IEBAIHVzZXJwdHJfbW5faW52YWxpZGF0ZV9yYW5nZV9z
dGFydChzdHJ1Y3QgbW11X25vdGlmaWVyICpfbW4sCiAJc3RydWN0IGk5MTVfbW11X25vdGlmaWVy
ICptbiA9CiAJCWNvbnRhaW5lcl9vZihfbW4sIHN0cnVjdCBpOTE1X21tdV9ub3RpZmllciwgbW4p
OwogCXN0cnVjdCBpbnRlcnZhbF90cmVlX25vZGUgKml0OwotCXN0cnVjdCBtdXRleCAqdW5sb2Nr
ID0gTlVMTDsKIAl1bnNpZ25lZCBsb25nIGVuZDsKIAlpbnQgcmV0ID0gMDsKIApAQCAtMTI5LDMz
ICsxMjgsMTMgQEAgdXNlcnB0cl9tbl9pbnZhbGlkYXRlX3JhbmdlX3N0YXJ0KHN0cnVjdCBtbXVf
bm90aWZpZXIgKl9tbiwKIAkJfQogCQlzcGluX3VubG9jaygmbW4tPmxvY2spOwogCi0JCWlmICgh
dW5sb2NrKSB7Ci0JCQl1bmxvY2sgPSAmbW4tPm1tLT5pOTE1LT5kcm0uc3RydWN0X211dGV4Owot
Ci0JCQlzd2l0Y2ggKG11dGV4X3RyeWxvY2tfcmVjdXJzaXZlKHVubG9jaykpIHsKLQkJCWRlZmF1
bHQ6Ci0JCQljYXNlIE1VVEVYX1RSWUxPQ0tfRkFJTEVEOgotCQkJCWlmIChtdXRleF9sb2NrX2tp
bGxhYmxlX25lc3RlZCh1bmxvY2ssIEk5MTVfTU1fU0hSSU5LRVIpKSB7Ci0JCQkJCWk5MTVfZ2Vt
X29iamVjdF9wdXQob2JqKTsKLQkJCQkJcmV0dXJuIC1FSU5UUjsKLQkJCQl9Ci0JCQkJLyogZmFs
bCB0aHJvdWdoICovCi0JCQljYXNlIE1VVEVYX1RSWUxPQ0tfU1VDQ0VTUzoKLQkJCQlicmVhazsK
LQotCQkJY2FzZSBNVVRFWF9UUllMT0NLX1JFQ1VSU0lWRToKLQkJCQl1bmxvY2sgPSBFUlJfUFRS
KC1FRVhJU1QpOwotCQkJCWJyZWFrOwotCQkJfQotCQl9Ci0KIAkJcmV0ID0gaTkxNV9nZW1fb2Jq
ZWN0X3VuYmluZChvYmosCiAJCQkJCSAgICAgSTkxNV9HRU1fT0JKRUNUX1VOQklORF9BQ1RJVkUp
OwogCQlpZiAocmV0ID09IDApCiAJCQlyZXQgPSBfX2k5MTVfZ2VtX29iamVjdF9wdXRfcGFnZXMo
b2JqLCBJOTE1X01NX1NIUklOS0VSKTsKIAkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwogCQlp
ZiAocmV0KQotCQkJZ290byB1bmxvY2s7CisJCQlyZXR1cm4gcmV0OwogCiAJCXNwaW5fbG9jaygm
bW4tPmxvY2spOwogCkBAIC0xNjgsMTAgKzE0Nyw2IEBAIHVzZXJwdHJfbW5faW52YWxpZGF0ZV9y
YW5nZV9zdGFydChzdHJ1Y3QgbW11X25vdGlmaWVyICpfbW4sCiAJfQogCXNwaW5fdW5sb2NrKCZt
bi0+bG9jayk7CiAKLXVubG9jazoKLQlpZiAoIUlTX0VSUl9PUl9OVUxMKHVubG9jaykpCi0JCW11
dGV4X3VubG9jayh1bmxvY2spOwotCiAJcmV0dXJuIHJldDsKIAogfQpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYwppbmRleCA4ZGU4M2M2ZDgxZjUu
LmI2NmYwMmVlM2VkNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0
ZXN0cy9odWdlX3BhZ2VzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0
cy9odWdlX3BhZ2VzLmMKQEAgLTEzODcsNyArMTM4Nyw3IEBAIHN0YXRpYyBpbnQgaWd0X3BwZ3R0
X3Bpbl91cGRhdGUodm9pZCAqYXJnKQogCQkJZ290byBvdXRfdW5waW47CiAJCX0KIAotCQllcnIg
PSBpOTE1X3ZtYV9iaW5kKHZtYSwgSTkxNV9DQUNIRV9OT05FLCBQSU5fVVBEQVRFKTsKKwkJZXJy
ID0gaTkxNV92bWFfYmluZCh2bWEsIEk5MTVfQ0FDSEVfTk9ORSwgUElOX1VQREFURSwgTlVMTCk7
CiAJCWlmIChlcnIpCiAJCQlnb3RvIG91dF91bnBpbjsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2d0LmMKaW5kZXggZDQ4ZWM5YTc2ZWQxLi5jMmFmZmZiOTQ0NzQgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZ3QuYwpAQCAtMjA3LDExICsyMDcsMTIgQEAgdm9pZCBpbnRlbF9ndF9mbHVzaF9n
Z3R0X3dyaXRlcyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogCiAJd2l0aF9pbnRlbF9ydW50aW1lX3Bt
KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKSB7CiAJCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVu
Y29yZSA9IGd0LT51bmNvcmU7CisJCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAKLQkJc3Bpbl9sb2Nr
X2lycSgmdW5jb3JlLT5sb2NrKTsKKwkJc3Bpbl9sb2NrX2lycXNhdmUoJnVuY29yZS0+bG9jaywg
ZmxhZ3MpOwogCQlpbnRlbF91bmNvcmVfcG9zdGluZ19yZWFkX2Z3KHVuY29yZSwKIAkJCQkJICAg
ICBSSU5HX0hFQUQoUkVOREVSX1JJTkdfQkFTRSkpOwotCQlzcGluX3VubG9ja19pcnEoJnVuY29y
ZS0+bG9jayk7CisJCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnVuY29yZS0+bG9jaywgZmxhZ3Mp
OwogCX0KIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
aGFuZ2NoZWNrLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2su
YwppbmRleCBhMzFlZWQyYmIwMGYuLjc5YTI2MjA0NjI0OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMKQEAgLTExMjQsMTUgKzExMjQsMTQgQEAgc3Rh
dGljIGludCBldmljdF92bWEodm9pZCAqZGF0YSkKIHsKIAlzdHJ1Y3QgZXZpY3Rfdm1hICphcmcg
PSBkYXRhOwogCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gYXJnLT52bWEtPnZtOwot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdm0tPmk5MTU7CiAJc3RydWN0IGRybV9t
bV9ub2RlIGV2aWN0ID0gYXJnLT52bWEtPm5vZGU7CiAJaW50IGVycjsKIAogCWNvbXBsZXRlKCZh
cmctPmNvbXBsZXRpb24pOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CisJbXV0ZXhfbG9jaygmdm0tPm11dGV4KTsKIAllcnIgPSBpOTE1X2dlbV9ldmljdF9mb3Jfbm9k
ZSh2bSwgJmV2aWN0LCAwKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OworCW11dGV4X3VubG9jaygmdm0tPm11dGV4KTsKIAogCXJldHVybiBlcnI7CiB9CkBAIC0xMTQw
LDM5ICsxMTM5LDMzIEBAIHN0YXRpYyBpbnQgZXZpY3Rfdm1hKHZvaWQgKmRhdGEpCiBzdGF0aWMg
aW50IGV2aWN0X2ZlbmNlKHZvaWQgKmRhdGEpCiB7CiAJc3RydWN0IGV2aWN0X3ZtYSAqYXJnID0g
ZGF0YTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZy0+dm1hLT52bS0+aTkx
NTsKIAlpbnQgZXJyOwogCiAJY29tcGxldGUoJmFyZy0+Y29tcGxldGlvbik7CiAKLQltdXRleF9s
b2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCS8qIE1hcmsgdGhlIGZlbmNlIHJlZ2lz
dGVyIGFzIGRpcnR5IHRvIGZvcmNlIHRoZSBtbWlvIHVwZGF0ZS4gKi8KIAllcnIgPSBpOTE1X2dl
bV9vYmplY3Rfc2V0X3RpbGluZyhhcmctPnZtYS0+b2JqLCBJOTE1X1RJTElOR19ZLCA1MTIpOwog
CWlmIChlcnIpIHsKIAkJcHJfZXJyKCJJbnZhbGlkIFktdGlsaW5nIHNldHRpbmdzOyBlcnI6JWRc
biIsIGVycik7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJcmV0dXJuIGVycjsKIAl9CiAKIAllcnIg
PSBpOTE1X3ZtYV9waW4oYXJnLT52bWEsIDAsIDAsIFBJTl9HTE9CQUwgfCBQSU5fTUFQUEFCTEUp
OwogCWlmIChlcnIpIHsKIAkJcHJfZXJyKCJVbmFibGUgdG8gcGluIHZtYSBmb3IgWS10aWxlZCBm
ZW5jZTsgZXJyOiVkXG4iLCBlcnIpOwotCQlnb3RvIG91dF91bmxvY2s7CisJCXJldHVybiBlcnI7
CiAJfQogCiAJZXJyID0gaTkxNV92bWFfcGluX2ZlbmNlKGFyZy0+dm1hKTsKIAlpOTE1X3ZtYV91
bnBpbihhcmctPnZtYSk7CiAJaWYgKGVycikgewogCQlwcl9lcnIoIlVuYWJsZSB0byBwaW4gWS10
aWxlZCBmZW5jZTsgZXJyOiVkXG4iLCBlcnIpOwotCQlnb3RvIG91dF91bmxvY2s7CisJCXJldHVy
biBlcnI7CiAJfQogCiAJaTkxNV92bWFfdW5waW5fZmVuY2UoYXJnLT52bWEpOwogCi1vdXRfdW5s
b2NrOgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQlyZXR1cm4g
ZXJyOworCXJldHVybiAwOwogfQogCiBzdGF0aWMgaW50IF9faWd0X3Jlc2V0X2V2aWN0X3ZtYShz
dHJ1Y3QgaW50ZWxfZ3QgKmd0LApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0
L2FwZXJ0dXJlX2dtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvYXBlcnR1cmVfZ20uYwpp
bmRleCA1ZmYyNDM3YjI5OTguLmQ5OTZiYmM3ZWE1OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Z0L2FwZXJ0dXJlX2dtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0
L2FwZXJ0dXJlX2dtLmMKQEAgLTYxLDE0ICs2MSwxNCBAQCBzdGF0aWMgaW50IGFsbG9jX2dtKHN0
cnVjdCBpbnRlbF92Z3B1ICp2Z3B1LCBib29sIGhpZ2hfZ20pCiAJCWZsYWdzID0gUElOX01BUFBB
QkxFOwogCX0KIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwlt
dXRleF9sb2NrKCZkZXZfcHJpdi0+Z2d0dC52bS5tdXRleCk7CiAJbW1pb19od19hY2Nlc3NfcHJl
KGRldl9wcml2KTsKIAlyZXQgPSBpOTE1X2dlbV9ndHRfaW5zZXJ0KCZkZXZfcHJpdi0+Z2d0dC52
bSwgbm9kZSwKIAkJCQkgIHNpemUsIEk5MTVfR1RUX1BBR0VfU0laRSwKIAkJCQkgIEk5MTVfQ09M
T1JfVU5FVklDVEFCTEUsCiAJCQkJICBzdGFydCwgZW5kLCBmbGFncyk7CiAJbW1pb19od19hY2Nl
c3NfcG9zdChkZXZfcHJpdik7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9t
dXRleCk7CisJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+Z2d0dC52bS5tdXRleCk7CiAJaWYgKHJl
dCkKIAkJZ3Z0X2VycigiZmFpbCB0byBhbGxvYyAlcyBnbSBzcGFjZSBmcm9tIGhvc3RcbiIsCiAJ
CQloaWdoX2dtID8gImhpZ2giIDogImxvdyIpOwpAQCAtOTgsOSArOTgsOSBAQCBzdGF0aWMgaW50
IGFsbG9jX3ZncHVfZ20oc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAKIAlyZXR1cm4gMDsKIG91
dF9mcmVlX2FwZXJ0dXJlOgotCW11dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4
KTsKKwltdXRleF9sb2NrKCZkZXZfcHJpdi0+Z2d0dC52bS5tdXRleCk7CiAJZHJtX21tX3JlbW92
ZV9ub2RlKCZ2Z3B1LT5nbS5sb3dfZ21fbm9kZSk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+
ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+Z2d0dC52bS5tdXRl
eCk7CiAJcmV0dXJuIHJldDsKIH0KIApAQCAtMTA4LDEwICsxMDgsMTAgQEAgc3RhdGljIHZvaWQg
ZnJlZV92Z3B1X2dtKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQogewogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHZncHUtPmd2dC0+ZGV2X3ByaXY7CiAKLQltdXRleF9sb2Nr
KCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmdn
dHQudm0ubXV0ZXgpOwogCWRybV9tbV9yZW1vdmVfbm9kZSgmdmdwdS0+Z20ubG93X2dtX25vZGUp
OwogCWRybV9tbV9yZW1vdmVfbm9kZSgmdmdwdS0+Z20uaGlnaF9nbV9ub2RlKTsKLQltdXRleF91
bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF91bmxvY2soJmRldl9w
cml2LT5nZ3R0LnZtLm11dGV4KTsKIH0KIAogLyoqCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2FjdGl2ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUu
YwppbmRleCA0OGUxNmFkOTNiYmQuLjVlOWY4MjZmZjEzMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2FjdGl2ZS5jCkBAIC0xNDIsNiArMTQyLDcgQEAgX19hY3RpdmVfcmV0aXJlKHN0cnVjdCBpOTE1
X2FjdGl2ZSAqcmVmKQogCWlmICghcmV0aXJlKQogCQlyZXR1cm47CiAKKwlHRU1fQlVHX09OKHJj
dV9hY2Nlc3NfcG9pbnRlcihyZWYtPmV4Y2wpKTsKIAlyYnRyZWVfcG9zdG9yZGVyX2Zvcl9lYWNo
X2VudHJ5X3NhZmUoaXQsIG4sICZyb290LCBub2RlKSB7CiAJCUdFTV9CVUdfT04oaTkxNV9hY3Rp
dmVfcmVxdWVzdF9pc3NldCgmaXQtPmJhc2UpKTsKIAkJa21lbV9jYWNoZV9mcmVlKGdsb2JhbC5z
bGFiX2NhY2hlLCBpdCk7CkBAIC0yNDEsNiArMjQyLDggQEAgdm9pZCBfX2k5MTVfYWN0aXZlX2lu
aXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJcmVmLT5mbGFncyA9IDA7CiAJcmVm
LT5hY3RpdmUgPSBhY3RpdmU7CiAJcmVmLT5yZXRpcmUgPSByZXRpcmU7CisKKwlyZWYtPmV4Y2wg
PSBOVUxMOwogCXJlZi0+dHJlZSA9IFJCX1JPT1Q7CiAJcmVmLT5jYWNoZSA9IE5VTEw7CiAJaW5p
dF9sbGlzdF9oZWFkKCZyZWYtPnByZWFsbG9jYXRlZF9iYXJyaWVycyk7CkBAIC0zMzcsNiArMzQw
LDQ1IEBAIGludCBpOTE1X2FjdGl2ZV9yZWYoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCiAJcmV0
dXJuIGVycjsKIH0KIAorc3RhdGljIHZvaWQgZXhjbF9jYihzdHJ1Y3QgZG1hX2ZlbmNlICpmLCBz
dHJ1Y3QgZG1hX2ZlbmNlX2NiICpjYikKK3sKKwlzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiA9IGNv
bnRhaW5lcl9vZihjYiwgdHlwZW9mKCpyZWYpLCBleGNsX2NiKTsKKworCVJDVV9JTklUX1BPSU5U
RVIocmVmLT5leGNsLCBOVUxMKTsKKwlkbWFfZmVuY2VfcHV0KGYpOworCisJYWN0aXZlX3JldGly
ZShyZWYpOworfQorCit2b2lkIGk5MTVfYWN0aXZlX3NldF9leGNsdXNpdmUoc3RydWN0IGk5MTVf
YWN0aXZlICpyZWYsIHN0cnVjdCBkbWFfZmVuY2UgKmYpCit7CisJR0VNX0JVR19PTihpOTE1X2Fj
dGl2ZV9pc19pZGxlKHJlZikpOworCisJZG1hX2ZlbmNlX2dldChmKTsKKworCXJjdV9yZWFkX2xv
Y2soKTsKKwlpZiAocmN1X2FjY2Vzc19wb2ludGVyKHJlZi0+ZXhjbCkpIHsKKwkJc3RydWN0IGRt
YV9mZW5jZSAqb2xkOworCisJCW9sZCA9IGRtYV9mZW5jZV9nZXRfcmN1X3NhZmUoJnJlZi0+ZXhj
bCk7CisJCWlmIChvbGQpIHsKKwkJCWlmIChkbWFfZmVuY2VfcmVtb3ZlX2NhbGxiYWNrKG9sZCwg
JnJlZi0+ZXhjbF9jYikpCisJCQkJYXRvbWljX2RlYygmcmVmLT5jb3VudCk7CisJCQlkbWFfZmVu
Y2VfcHV0KG9sZCk7CisJCX0KKwl9CisJcmN1X3JlYWRfdW5sb2NrKCk7CisKKwlhdG9taWNfaW5j
KCZyZWYtPmNvdW50KTsKKwlyY3VfYXNzaWduX3BvaW50ZXIocmVmLT5leGNsLCBmKTsKKworCWlm
IChkbWFfZmVuY2VfYWRkX2NhbGxiYWNrKGYsICZyZWYtPmV4Y2xfY2IsIGV4Y2xfY2IpKSB7CisJ
CVJDVV9JTklUX1BPSU5URVIocmVmLT5leGNsLCBOVUxMKTsKKwkJYXRvbWljX2RlYygmcmVmLT5j
b3VudCk7CisJCWRtYV9mZW5jZV9wdXQoZik7CisJfQorfQorCiBpbnQgaTkxNV9hY3RpdmVfYWNx
dWlyZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIHsKIAlpbnQgZXJyOwpAQCAtMzk1LDYgKzQz
NywyNSBAQCB2b2lkIGk5MTVfYWN0aXZlX3VuZ3JhYihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikK
IAlfX2FjdGl2ZV91bmdyYWIocmVmKTsKIH0KIAorc3RhdGljIGludCBleGNsX3dhaXQoc3RydWN0
IGk5MTVfYWN0aXZlICpyZWYpCit7CisJc3RydWN0IGRtYV9mZW5jZSAqb2xkOworCWludCBlcnIg
PSAwOworCisJaWYgKCFyY3VfYWNjZXNzX3BvaW50ZXIocmVmLT5leGNsKSkKKwkJcmV0dXJuIDA7
CisKKwlyY3VfcmVhZF9sb2NrKCk7CisJb2xkID0gZG1hX2ZlbmNlX2dldF9yY3Vfc2FmZSgmcmVm
LT5leGNsKTsKKwlyY3VfcmVhZF91bmxvY2soKTsKKwlpZiAob2xkKSB7CisJCWVyciA9IGRtYV9m
ZW5jZV93YWl0KG9sZCwgdHJ1ZSk7CisJCWRtYV9mZW5jZV9wdXQob2xkKTsKKwl9CisKKwlyZXR1
cm4gZXJyOworfQorCiBpbnQgaTkxNV9hY3RpdmVfd2FpdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJl
ZikKIHsKIAlzdHJ1Y3QgYWN0aXZlX25vZGUgKml0LCAqbjsKQEAgLTQxNSw2ICs0NzYsMTAgQEAg
aW50IGk5MTVfYWN0aXZlX3dhaXQoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiAJCXJldHVybiAw
OwogCX0KIAorCWVyciA9IGV4Y2xfd2FpdChyZWYpOworCWlmIChlcnIpCisJCWdvdG8gb3V0Owor
CiAJcmJ0cmVlX3Bvc3RvcmRlcl9mb3JfZWFjaF9lbnRyeV9zYWZlKGl0LCBuLCAmcmVmLT50cmVl
LCBub2RlKSB7CiAJCWlmIChpc19iYXJyaWVyKCZpdC0+YmFzZSkpIHsgLyogdW5jb25uZWN0ZWQg
aWRsZS1iYXJyaWVyICovCiAJCQllcnIgPSAtRUJVU1k7CkBAIC00MjYsNiArNDkxLDcgQEAgaW50
IGk5MTVfYWN0aXZlX3dhaXQoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiAJCQlicmVhazsKIAl9
CiAKK291dDoKIAlfX2FjdGl2ZV9yZXRpcmUocmVmKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJy
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaCBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmgKaW5kZXggZjk1MDU4Zjk5MDU3Li5iYzFjOWQ1
ZDRmNjMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmgKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaApAQCAtMzczLDYgKzM3Myw4IEBA
IGludCBpOTE1X2FjdGl2ZV9yZWYoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCiAJCSAgICBzdHJ1
Y3QgaW50ZWxfdGltZWxpbmUgKnRsLAogCQkgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpOwog
Cit2b2lkIGk5MTVfYWN0aXZlX3NldF9leGNsdXNpdmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYs
IHN0cnVjdCBkbWFfZmVuY2UgKmYpOworCiBpbnQgaTkxNV9hY3RpdmVfd2FpdChzdHJ1Y3QgaTkx
NV9hY3RpdmUgKnJlZik7CiAKIGludCBpOTE1X3JlcXVlc3RfYXdhaXRfYWN0aXZlKHN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9h
Y3RpdmVfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5cGVzLmgK
aW5kZXggMTg1NGU3ZDE2OGMxLi44NmU3YTIzMmVhM2MgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9hY3RpdmVfdHlwZXMuaApAQCAtOCw2ICs4LDcgQEAKICNkZWZpbmUgX0k5MTVfQUNUSVZF
X1RZUEVTX0hfCiAKICNpbmNsdWRlIDxsaW51eC9hdG9taWMuaD4KKyNpbmNsdWRlIDxsaW51eC9k
bWEtZmVuY2UuaD4KICNpbmNsdWRlIDxsaW51eC9sbGlzdC5oPgogI2luY2x1ZGUgPGxpbnV4L211
dGV4Lmg+CiAjaW5jbHVkZSA8bGludXgvcmJ0cmVlLmg+CkBAIC01MSw2ICs1MiwxMCBAQCBzdHJ1
Y3QgaTkxNV9hY3RpdmUgewogCXN0cnVjdCBtdXRleCBtdXRleDsKIAlhdG9taWNfdCBjb3VudDsK
IAorCS8qIFByZWFsbG9jYXRlZCAiZXhjbHVzaXZlIiBub2RlICovCisJc3RydWN0IGRtYV9mZW5j
ZSBfX3JjdSAqZXhjbDsKKwlzdHJ1Y3QgZG1hX2ZlbmNlX2NiIGV4Y2xfY2I7CisKIAl1bnNpZ25l
ZCBsb25nIGZsYWdzOwogI2RlZmluZSBJOTE1X0FDVElWRV9HUkFCX0JJVCAwCiAKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbS5jCmluZGV4IGJlZjQwNGZhNzU1Ni4uMzQ1YjZhY2U3NTk0IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtLmMKQEAgLTYyLDIwICs2MiwzMSBAQAogI2luY2x1ZGUgImludGVsX3BtLmgi
CiAKIHN0YXRpYyBpbnQKLWluc2VydF9tYXBwYWJsZV9ub2RlKHN0cnVjdCBpOTE1X2dndHQgKmdn
dHQsCi0gICAgICAgICAgICAgICAgICAgICBzdHJ1Y3QgZHJtX21tX25vZGUgKm5vZGUsIHUzMiBz
aXplKQoraW5zZXJ0X21hcHBhYmxlX25vZGUoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCwgc3RydWN0
IGRybV9tbV9ub2RlICpub2RlLCB1MzIgc2l6ZSkKIHsKKwlpbnQgZXJyOworCisJZXJyID0gbXV0
ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZnZ3R0LT52bS5tdXRleCk7CisJaWYgKGVycikKKwkJcmV0
dXJuIGVycjsKKwogCW1lbXNldChub2RlLCAwLCBzaXplb2YoKm5vZGUpKTsKLQlyZXR1cm4gZHJt
X21tX2luc2VydF9ub2RlX2luX3JhbmdlKCZnZ3R0LT52bS5tbSwgbm9kZSwKLQkJCQkJICAgc2l6
ZSwgMCwgSTkxNV9DT0xPUl9VTkVWSUNUQUJMRSwKLQkJCQkJICAgMCwgZ2d0dC0+bWFwcGFibGVf
ZW5kLAotCQkJCQkgICBEUk1fTU1fSU5TRVJUX0xPVyk7CisJZXJyID0gZHJtX21tX2luc2VydF9u
b2RlX2luX3JhbmdlKCZnZ3R0LT52bS5tbSwgbm9kZSwKKwkJCQkJICBzaXplLCAwLCBJOTE1X0NP
TE9SX1VORVZJQ1RBQkxFLAorCQkJCQkgIDAsIGdndHQtPm1hcHBhYmxlX2VuZCwKKwkJCQkJICBE
Uk1fTU1fSU5TRVJUX0xPVyk7CisKKwltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKKwor
CXJldHVybiBlcnI7CiB9CiAKIHN0YXRpYyB2b2lkCi1yZW1vdmVfbWFwcGFibGVfbm9kZShzdHJ1
Y3QgZHJtX21tX25vZGUgKm5vZGUpCityZW1vdmVfbWFwcGFibGVfbm9kZShzdHJ1Y3QgaTkxNV9n
Z3R0ICpnZ3R0LCBzdHJ1Y3QgZHJtX21tX25vZGUgKm5vZGUpCiB7CisJbXV0ZXhfbG9jaygmZ2d0
dC0+dm0ubXV0ZXgpOwogCWRybV9tbV9yZW1vdmVfbm9kZShub2RlKTsKKwltdXRleF91bmxvY2so
JmdndHQtPnZtLm11dGV4KTsKIH0KIAogaW50CkBAIC04Nyw3ICs5OCw4IEBAIGk5MTVfZ2VtX2dl
dF9hcGVydHVyZV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCXN0
cnVjdCBpOTE1X3ZtYSAqdm1hOwogCXU2NCBwaW5uZWQ7CiAKLQltdXRleF9sb2NrKCZnZ3R0LT52
bS5tdXRleCk7CisJaWYgKG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmZ2d0dC0+dm0ubXV0ZXgp
KQorCQlyZXR1cm4gLUVJTlRSOwogCiAJcGlubmVkID0gZ2d0dC0+dm0ucmVzZXJ2ZWQ7CiAJbGlz
dF9mb3JfZWFjaF9lbnRyeSh2bWEsICZnZ3R0LT52bS5ib3VuZF9saXN0LCB2bV9saW5rKQpAQCAt
MTA5LDggKzEyMSw2IEBAIGludCBpOTE1X2dlbV9vYmplY3RfdW5iaW5kKHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmosCiAJTElTVF9IRUFEKHN0aWxsX2luX2xpc3QpOwogCWludCByZXQg
PSAwOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmb2JqLT5iYXNlLmRldi0+c3RydWN0X211dGV4
KTsKLQogCXNwaW5fbG9jaygmb2JqLT52bWEubG9jayk7CiAJd2hpbGUgKCFyZXQgJiYgKHZtYSA9
IGxpc3RfZmlyc3RfZW50cnlfb3JfbnVsbCgmb2JqLT52bWEubGlzdCwKIAkJCQkJCSAgICAgICBz
dHJ1Y3QgaTkxNV92bWEsCkBAIC0xMjAsOCArMTMwLDEzIEBAIGludCBpOTE1X2dlbV9vYmplY3Rf
dW5iaW5kKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAKIAkJcmV0ID0gLUVCVVNZ
OwogCQlpZiAoZmxhZ3MgJiBJOTE1X0dFTV9PQkpFQ1RfVU5CSU5EX0FDVElWRSB8fAotCQkgICAg
IWk5MTVfdm1hX2lzX2FjdGl2ZSh2bWEpKQotCQkJcmV0ID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7
CisJCSAgICAhaTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpIHsKKwkJCXJldCA9IG11dGV4X2xvY2tf
aW50ZXJydXB0aWJsZSgmdm1hLT52bS0+bXV0ZXgpOworCQkJaWYgKCFyZXQpIHsKKwkJCQlyZXQg
PSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJCQltdXRleF91bmxvY2soJnZtYS0+dm0tPm11dGV4
KTsKKwkJCX0KKwkJfQogCiAJCXNwaW5fbG9jaygmb2JqLT52bWEubG9jayk7CiAJfQpAQCAtMzM4
LDEwICszNTMsNiBAQCBpOTE1X2dlbV9ndHRfcHJlYWQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iaiwKIAl1NjQgcmVtYWluLCBvZmZzZXQ7CiAJaW50IHJldDsKIAotCXJldCA9IG11dGV4
X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKHJldCkK
LQkJcmV0dXJuIHJldDsKLQogCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldCgmaTkxNS0+
cnVudGltZV9wbSk7CiAJdm1hID0gRVJSX1BUUigtRU5PREVWKTsKIAlpZiAoIWk5MTVfZ2VtX29i
amVjdF9pc190aWxlZChvYmopKQpAQCAtMzU1LDEyICszNjYsMTAgQEAgaTkxNV9nZW1fZ3R0X3By
ZWFkKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJfSBlbHNlIHsKIAkJcmV0ID0g
aW5zZXJ0X21hcHBhYmxlX25vZGUoZ2d0dCwgJm5vZGUsIFBBR0VfU0laRSk7CiAJCWlmIChyZXQp
Ci0JCQlnb3RvIG91dF91bmxvY2s7CisJCQlnb3RvIG91dF9ycG07CiAJCUdFTV9CVUdfT04oIW5v
ZGUuYWxsb2NhdGVkKTsKIAl9CiAKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwotCiAJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X2xvY2tfaW50ZXJydXB0aWJsZShvYmopOwog
CWlmIChyZXQpCiAJCWdvdG8gb3V0X3VucGluOwpAQCAtNDE0LDE3ICs0MjMsMTQgQEAgaTkxNV9n
ZW1fZ3R0X3ByZWFkKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAKIAlpOTE1X2dl
bV9vYmplY3RfdW5sb2NrX2ZlbmNlKG9iaiwgZmVuY2UpOwogb3V0X3VucGluOgotCW11dGV4X2xv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChub2RlLmFsbG9jYXRlZCkgewogCQln
Z3R0LT52bS5jbGVhcl9yYW5nZSgmZ2d0dC0+dm0sIG5vZGUuc3RhcnQsIG5vZGUuc2l6ZSk7Ci0J
CXJlbW92ZV9tYXBwYWJsZV9ub2RlKCZub2RlKTsKKwkJcmVtb3ZlX21hcHBhYmxlX25vZGUoZ2d0
dCwgJm5vZGUpOwogCX0gZWxzZSB7CiAJCWk5MTVfdm1hX3VucGluKHZtYSk7CiAJfQotb3V0X3Vu
bG9jazoKK291dF9ycG06CiAJaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0s
IHdha2VyZWYpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAly
ZXR1cm4gcmV0OwogfQogCkBAIC01MzEsMTAgKzUzNyw2IEBAIGk5MTVfZ2VtX2d0dF9wd3JpdGVf
ZmFzdChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCXZvaWQgX191c2VyICp1c2Vy
X2RhdGE7CiAJaW50IHJldDsKIAotCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQogCWlmIChp
OTE1X2dlbV9vYmplY3RfaGFzX3N0cnVjdF9wYWdlKG9iaikpIHsKIAkJLyoKIAkJICogQXZvaWQg
d2FraW5nIHRoZSBkZXZpY2UgdXAgaWYgd2UgY2FuIGZhbGxiYWNrLCBhcwpAQCAtNTQ0LDEwICs1
NDYsOCBAQCBpOTE1X2dlbV9ndHRfcHdyaXRlX2Zhc3Qoc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iaiwKIAkJICogdXNpbmcgdGhlIGNhY2hlIGJ5cGFzcyBvZiBpbmRpcmVjdCBHR1RUIGFj
Y2Vzcy4KIAkJICovCiAJCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldF9pZl9pbl91c2Uo
cnBtKTsKLQkJaWYgKCF3YWtlcmVmKSB7Ci0JCQlyZXQgPSAtRUZBVUxUOwotCQkJZ290byBvdXRf
dW5sb2NrOwotCQl9CisJCWlmICghd2FrZXJlZikKKwkJCXJldHVybiAtRUZBVUxUOwogCX0gZWxz
ZSB7CiAJCS8qIE5vIGJhY2tpbmcgcGFnZXMsIG5vIGZhbGxiYWNrLCB3ZSBtdXN0IGZvcmNlIEdH
VFQgYWNjZXNzICovCiAJCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldChycG0pOwpAQCAt
NTY5LDggKzU2OSw2IEBAIGk5MTVfZ2VtX2d0dF9wd3JpdGVfZmFzdChzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqLAogCQlHRU1fQlVHX09OKCFub2RlLmFsbG9jYXRlZCk7CiAJfQogCi0J
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCXJldCA9IGk5MTVfZ2Vt
X29iamVjdF9sb2NrX2ludGVycnVwdGlibGUob2JqKTsKIAlpZiAocmV0KQogCQlnb3RvIG91dF91
bnBpbjsKQEAgLTYzNCwxOCArNjMyLDE1IEBAIGk5MTVfZ2VtX2d0dF9wd3JpdGVfZmFzdChzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCiAJaTkxNV9nZW1fb2JqZWN0X3VubG9ja19m
ZW5jZShvYmosIGZlbmNlKTsKIG91dF91bnBpbjoKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKIAlpbnRlbF9ndF9mbHVzaF9nZ3R0X3dyaXRlcyhnZ3R0LT52bS5ndCk7CiAJ
aWYgKG5vZGUuYWxsb2NhdGVkKSB7CiAJCWdndHQtPnZtLmNsZWFyX3JhbmdlKCZnZ3R0LT52bSwg
bm9kZS5zdGFydCwgbm9kZS5zaXplKTsKLQkJcmVtb3ZlX21hcHBhYmxlX25vZGUoJm5vZGUpOwor
CQlyZW1vdmVfbWFwcGFibGVfbm9kZShnZ3R0LCAmbm9kZSk7CiAJfSBlbHNlIHsKIAkJaTkxNV92
bWFfdW5waW4odm1hKTsKIAl9CiBvdXRfcnBtOgogCWludGVsX3J1bnRpbWVfcG1fcHV0KHJwbSwg
d2FrZXJlZik7Ci1vdXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAJcmV0dXJuIHJldDsKIH0KIApAQCAtOTY2LDggKzk2MSw2IEBAIGk5MTVfZ2VtX29i
amVjdF9nZ3R0X3BpbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCXN0cnVjdCBp
OTE1X3ZtYSAqdm1hOwogCWludCByZXQ7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZvYmotPmJh
c2UuZGV2LT5zdHJ1Y3RfbXV0ZXgpOwotCiAJaWYgKGZsYWdzICYgUElOX01BUFBBQkxFICYmCiAJ
ICAgICghdmlldyB8fCB2aWV3LT50eXBlID09IEk5MTVfR0dUVF9WSUVXX05PUk1BTCkpIHsKIAkJ
LyogSWYgdGhlIHJlcXVpcmVkIHNwYWNlIGlzIGxhcmdlciB0aGFuIHRoZSBhdmFpbGFibGUKQEAg
LTEwMjEsNyArMTAxNCw5IEBAIGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqLAogCQkgICAgIGk5MTVfZ2d0dF9vZmZzZXQodm1hKSwgYWxpZ25t
ZW50LAogCQkgICAgICEhKGZsYWdzICYgUElOX01BUFBBQkxFKSwKIAkJICAgICBpOTE1X3ZtYV9p
c19tYXBfYW5kX2ZlbmNlYWJsZSh2bWEpKTsKKwkJbXV0ZXhfbG9jaygmdm1hLT52bS0+bXV0ZXgp
OwogCQlyZXQgPSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJbXV0ZXhfdW5sb2NrKCZ2bWEtPnZt
LT5tdXRleCk7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gRVJSX1BUUihyZXQpOwogCX0KQEAgLTEz
MTksNyArMTMxNCw5IEBAIHN0YXRpYyBpbnQgX19pbnRlbF9lbmdpbmVzX3JlY29yZF9kZWZhdWx0
cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkJICogZnJvbSB0aGUgR1RUIHRvIHBy
ZXZlbnQgc3VjaCBhY2NpZGVudHMgYW5kIHJlY2xhaW0gdGhlCiAJCSAqIHNwYWNlLgogCQkgKi8K
KwkJbXV0ZXhfbG9jaygmc3RhdGUtPnZtLT5tdXRleCk7CiAJCWVyciA9IGk5MTVfdm1hX3VuYmlu
ZChzdGF0ZSk7CisJCW11dGV4X3VubG9jaygmc3RhdGUtPnZtLT5tdXRleCk7CiAJCWlmIChlcnIp
CiAJCQlnb3RvIG91dDsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
ZW1fZXZpY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2V2aWN0LmMKaW5kZXgg
NTJjODZjNmUwNjczLi43MjJiMDNhZjM4OTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtX2V2aWN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1f
ZXZpY3QuYwpAQCAtNDcsOCArNDcsNyBAQCBzdGF0aWMgaW50IGdndHRfZmx1c2goc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJICogYm91bmQgYnkgdGhlaXIgYWN0aXZlIHJlZmVyZW5j
ZS4KIAkgKi8KIAlyZXR1cm4gaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShpOTE1LAotCQkJCSAgICAg
IEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFIHwKLQkJCQkgICAgICBJOTE1X1dBSVRfTE9DS0VELAor
CQkJCSAgICAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFLAogCQkJCSAgICAgIE1BWF9TQ0hFRFVM
RV9USU1FT1VUKTsKIH0KIApAQCAtMTA0LDcgKzEwMyw3IEBAIGk5MTVfZ2VtX2V2aWN0X3NvbWV0
aGluZyhzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAlzdHJ1Y3QgaTkxNV92bWEgKmFj
dGl2ZTsKIAlpbnQgcmV0OwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm0tPmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5tdXRleCk7CiAJdHJhY2Vf
aTkxNV9nZW1fZXZpY3Qodm0sIG1pbl9zaXplLCBhbGlnbm1lbnQsIGZsYWdzKTsKIAogCS8qCkBA
IC0xMjcsMTUgKzEyNiw2IEBAIGk5MTVfZ2VtX2V2aWN0X3NvbWV0aGluZyhzdHJ1Y3QgaTkxNV9h
ZGRyZXNzX3NwYWNlICp2bSwKIAkJCQkgICAgbWluX3NpemUsIGFsaWdubWVudCwgY2FjaGVfbGV2
ZWwsCiAJCQkJICAgIHN0YXJ0LCBlbmQsIG1vZGUpOwogCi0JLyoKLQkgKiBSZXRpcmUgYmVmb3Jl
IHdlIHNlYXJjaCB0aGUgYWN0aXZlIGxpc3QuIEFsdGhvdWdoIHdlIGhhdmUKLQkgKiByZWFzb25h
YmxlIGFjY3VyYWN5IGluIG91ciByZXRpcmVtZW50IGxpc3RzLCB3ZSBtYXkgaGF2ZQotCSAqIGEg
c3RyYXkgcGluIChwcmV2ZW50aW5nIGV2aWN0aW9uKSB0aGF0IGNhbiBvbmx5IGJlIHJlc29sdmVk
IGJ5Ci0JICogcmV0aXJpbmcuCi0JICovCi0JaWYgKCEoZmxhZ3MgJiBQSU5fTk9OQkxPQ0spKQot
CQlpOTE1X3JldGlyZV9yZXF1ZXN0cyhkZXZfcHJpdik7Ci0KIHNlYXJjaF9hZ2FpbjoKIAlhY3Rp
dmUgPSBOVUxMOwogCUlOSVRfTElTVF9IRUFEKCZldmljdGlvbl9saXN0KTsKQEAgLTI2OSw3ICsy
NTksNyBAQCBpbnQgaTkxNV9nZW1fZXZpY3RfZm9yX25vZGUoc3RydWN0IGk5MTVfYWRkcmVzc19z
cGFjZSAqdm0sCiAJYm9vbCBjaGVja19jb2xvcjsKIAlpbnQgcmV0ID0gMDsKIAotCWxvY2tkZXBf
YXNzZXJ0X2hlbGQoJnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlsb2NrZGVwX2Fzc2Vy
dF9oZWxkKCZ2bS0+bXV0ZXgpOwogCUdFTV9CVUdfT04oIUlTX0FMSUdORUQoc3RhcnQsIEk5MTVf
R1RUX1BBR0VfU0laRSkpOwogCUdFTV9CVUdfT04oIUlTX0FMSUdORUQoZW5kLCBJOTE1X0dUVF9Q
QUdFX1NJWkUpKTsKIApAQCAtMzc1LDcgKzM2NSw3IEBAIGludCBpOTE1X2dlbV9ldmljdF92bShz
dHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgKm5l
eHQ7CiAJaW50IHJldDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5pOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bS0+bXV0ZXgpOwogCXRyYWNlX2k5
MTVfZ2VtX2V2aWN0X3ZtKHZtKTsKIAogCS8qIFN3aXRjaCBiYWNrIHRvIHRoZSBkZWZhdWx0IGNv
bnRleHQgaW4gb3JkZXIgdG8gdW5waW4KQEAgLTM5MCw3ICszODAsNiBAQCBpbnQgaTkxNV9nZW1f
ZXZpY3Rfdm0oc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiAJfQogCiAJSU5JVF9MSVNU
X0hFQUQoJmV2aWN0aW9uX2xpc3QpOwotCW11dGV4X2xvY2soJnZtLT5tdXRleCk7CiAJbGlzdF9m
b3JfZWFjaF9lbnRyeSh2bWEsICZ2bS0+Ym91bmRfbGlzdCwgdm1fbGluaykgewogCQlpZiAoaTkx
NV92bWFfaXNfcGlubmVkKHZtYSkpCiAJCQljb250aW51ZTsKQEAgLTM5OCw3ICszODcsNiBAQCBp
bnQgaTkxNV9nZW1fZXZpY3Rfdm0oc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiAJCV9f
aTkxNV92bWFfcGluKHZtYSk7CiAJCWxpc3RfYWRkKCZ2bWEtPmV2aWN0X2xpbmssICZldmljdGlv
bl9saXN0KTsKIAl9Ci0JbXV0ZXhfdW5sb2NrKCZ2bS0+bXV0ZXgpOwogCiAJcmV0ID0gMDsKIAls
aXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUodm1hLCBuZXh0LCAmZXZpY3Rpb25fbGlzdCwgZXZpY3Rf
bGluaykgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZmVuY2Vf
cmVnLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9mZW5jZV9yZWcuYwppbmRleCA2
MTVhOWY0ZWYzMGMuLjFlOTNmMmFhZmM4MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW1fZmVuY2VfcmVnLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
ZW1fZmVuY2VfcmVnLmMKQEAgLTMzMSwxMyArMzMxLDE1IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV9m
ZW5jZV9yZWcgKmZlbmNlX2ZpbmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJcmV0
dXJuIEVSUl9QVFIoLUVERUFETEspOwogfQogCi1zdGF0aWMgaW50IF9faTkxNV92bWFfcGluX2Zl
bmNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQoraW50IF9faTkxNV92bWFfcGluX2ZlbmNlKHN0cnVj
dCBpOTE1X3ZtYSAqdm1hKQogewogCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSBpOTE1X3ZtX3Rv
X2dndHQodm1hLT52bSk7CiAJc3RydWN0IGk5MTVfZmVuY2VfcmVnICpmZW5jZTsKIAlzdHJ1Y3Qg
aTkxNV92bWEgKnNldCA9IGk5MTVfZ2VtX29iamVjdF9pc190aWxlZCh2bWEtPm9iaikgPyB2bWEg
OiBOVUxMOwogCWludCBlcnI7CiAKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bWEtPnZtLT5tdXRl
eCk7CisKIAkvKiBKdXN0IHVwZGF0ZSBvdXIgcGxhY2UgaW4gdGhlIExSVSBpZiBvdXIgZmVuY2Ug
aXMgZ2V0dGluZyByZXVzZWQuICovCiAJaWYgKHZtYS0+ZmVuY2UpIHsKIAkJZmVuY2UgPSB2bWEt
PmZlbmNlOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwppbmRleCBjNzA2ZWNmOGUxYTMu
LjAyZTY5YjM2NjQwMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1f
Z3R0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKQEAgLTE0Mywx
MiArMTQzLDEyIEBAIHN0YXRpYyB2b2lkIGdtY2hfZ2d0dF9pbnZhbGlkYXRlKHN0cnVjdCBpOTE1
X2dndHQgKmdndHQpCiAKIHN0YXRpYyBpbnQgcHBndHRfYmluZF92bWEoc3RydWN0IGk5MTVfdm1h
ICp2bWEsCiAJCQkgIGVudW0gaTkxNV9jYWNoZV9sZXZlbCBjYWNoZV9sZXZlbCwKLQkJCSAgdTMy
IHVudXNlZCkKKwkJCSAgdTMyIGZsYWdzKQogewogCXUzMiBwdGVfZmxhZ3M7CiAJaW50IGVycjsK
IAotCWlmICghaTkxNV92bWFfaXNfYm91bmQodm1hLCBJOTE1X1ZNQV9MT0NBTF9CSU5EKSkgewor
CWlmIChmbGFncyAmIEJJTkRfQUxMT0MpIHsKIAkJZXJyID0gdm1hLT52bS0+YWxsb2NhdGVfdmFf
cmFuZ2Uodm1hLT52bSwKIAkJCQkJCSB2bWEtPm5vZGUuc3RhcnQsIHZtYS0+c2l6ZSk7CiAJCWlm
IChlcnIpCkBAIC00OTksMTEgKzQ5OSw5IEBAIHN0YXRpYyB2b2lkIHBwZ3R0X2Rlc3Ryb3lfdm1h
KHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogewogCXN0cnVjdCBpOTE1X3ZtYSAqdm1h
LCAqdm47CiAKLQltdXRleF9sb2NrKCZ2bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJbGlz
dF9mb3JfZWFjaF9lbnRyeV9zYWZlKHZtYSwgdm4sICZ2bS0+Ym91bmRfbGlzdCwgdm1fbGluaykK
IAkJaTkxNV92bWFfZGVzdHJveSh2bWEpOwogCUdFTV9CVUdfT04oIWxpc3RfZW1wdHkoJnZtLT5i
b3VuZF9saXN0KSk7Ci0JbXV0ZXhfdW5sb2NrKCZ2bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiB9CiAKIHN0YXRpYyB2b2lkIF9faTkxNV92bV9yZWxlYXNlKHN0cnVjdCB3b3JrX3N0cnVjdCAq
d29yaykKQEAgLTE3NjQsMTIgKzE3NjIsOCBAQCBzdGF0aWMgdm9pZCBnZW42X3BwZ3R0X2ZyZWVf
cGQoc3RydWN0IGdlbjZfcHBndHQgKnBwZ3R0KQogc3RhdGljIHZvaWQgZ2VuNl9wcGd0dF9jbGVh
bnVwKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogewogCXN0cnVjdCBnZW42X3BwZ3R0
ICpwcGd0dCA9IHRvX2dlbjZfcHBndHQoaTkxNV92bV90b19wcGd0dCh2bSkpOwotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdm0tPmk5MTU7CiAKLQkvKiBGSVhNRSByZW1vdmUgdGhl
IHN0cnVjdF9tdXRleCB0byBicmluZyB0aGUgbG9ja2luZyB1bmRlciBjb250cm9sICovCi0JbXV0
ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaTkxNV92bWFfZGVzdHJveShwcGd0
dC0+dm1hKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJZ2Vu
Nl9wcGd0dF9mcmVlX3BkKHBwZ3R0KTsKIAlmcmVlX3NjcmF0Y2godm0pOwpAQCAtMjQ1Miw3ICsy
NDQ2LDcgQEAgc3RhdGljIGludCBhbGlhc2luZ19ndHRfYmluZF92bWEoc3RydWN0IGk5MTVfdm1h
ICp2bWEsCiAJaWYgKGZsYWdzICYgSTkxNV9WTUFfTE9DQUxfQklORCkgewogCQlzdHJ1Y3QgaTkx
NV9wcGd0dCAqYWxpYXMgPSBpOTE1X3ZtX3RvX2dndHQodm1hLT52bSktPmFsaWFzOwogCi0JCWlm
ICghaTkxNV92bWFfaXNfYm91bmQodm1hLCBJOTE1X1ZNQV9MT0NBTF9CSU5EKSkgeworCQlpZiAo
ZmxhZ3MgJiBCSU5EX0FMTE9DKSB7CiAJCQlyZXQgPSBhbGlhcy0+dm0uYWxsb2NhdGVfdmFfcmFu
Z2UoJmFsaWFzLT52bSwKIAkJCQkJCQkgIHZtYS0+bm9kZS5zdGFydCwKIAkJCQkJCQkgIHZtYS0+
c2l6ZSk7CkBAIC0yNTg4LDIyICsyNTgyLDE2IEBAIHN0YXRpYyBpbnQgaW5pdF9hbGlhc2luZ19w
cGd0dChzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogCiBzdGF0aWMgdm9pZCBmaW5pX2FsaWFzaW5n
X3BwZ3R0KHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSBnZ3R0LT52bS5pOTE1OwogCXN0cnVjdCBpOTE1X3BwZ3R0ICpwcGd0dDsKIAot
CW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJcHBndHQgPSBmZXRjaF9h
bmRfemVybygmZ2d0dC0+YWxpYXMpOwogCWlmICghcHBndHQpCi0JCWdvdG8gb3V0OworCQlyZXR1
cm47CiAKIAlpOTE1X3ZtX3B1dCgmcHBndHQtPnZtKTsKIAogCWdndHQtPnZtLnZtYV9vcHMuYmlu
ZF92bWEgICA9IGdndHRfYmluZF92bWE7CiAJZ2d0dC0+dm0udm1hX29wcy51bmJpbmRfdm1hID0g
Z2d0dF91bmJpbmRfdm1hOwotCi1vdXQ6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKIH0KIAogc3RhdGljIGludCBnZ3R0X3Jlc2VydmVfZ3VjX3RvcChzdHJ1Y3QgaTkx
NV9nZ3R0ICpnZ3R0KQpAQCAtMjcyMCwxNSArMjcwOCwxNCBAQCBpbnQgaTkxNV9pbml0X2dndHQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAKIHN0YXRpYyB2b2lkIGdndHRfY2xlYW51
cF9odyhzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gZ2d0dC0+dm0uaTkxNTsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgKnZuOwogCiAJ
Z2d0dC0+dm0uY2xvc2VkID0gdHJ1ZTsKIAogCXJjdV9iYXJyaWVyKCk7IC8qIGZsdXNoIHRoZSBS
Q1UnZWRfX2k5MTVfdm1fcmVsZWFzZSAqLwotCWZsdXNoX3dvcmtxdWV1ZShpOTE1LT53cSk7CisJ
Zmx1c2hfd29ya3F1ZXVlKGdndHQtPnZtLmk5MTUtPndxKTsKIAotCW11dGV4X2xvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAogCWxp
c3RfZm9yX2VhY2hfZW50cnlfc2FmZSh2bWEsIHZuLCAmZ2d0dC0+dm0uYm91bmRfbGlzdCwgdm1f
bGluaykKIAkJV0FSTl9PTihpOTE1X3ZtYV91bmJpbmQodm1hKSk7CkBAIC0yNzM3LDE1ICsyNzI0
LDEyIEBAIHN0YXRpYyB2b2lkIGdndHRfY2xlYW51cF9odyhzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0
KQogCQlkcm1fbW1fcmVtb3ZlX25vZGUoJmdndHQtPmVycm9yX2NhcHR1cmUpOwogCiAJZ2d0dF9y
ZWxlYXNlX2d1Y190b3AoZ2d0dCk7Ci0KLQlpZiAoZHJtX21tX2luaXRpYWxpemVkKCZnZ3R0LT52
bS5tbSkpIHsKLQkJaW50ZWxfdmd0X2RlYmFsbG9vbihnZ3R0KTsKLQkJaTkxNV9hZGRyZXNzX3Nw
YWNlX2ZpbmkoJmdndHQtPnZtKTsKLQl9CisJaW50ZWxfdmd0X2RlYmFsbG9vbihnZ3R0KTsKIAog
CWdndHQtPnZtLmNsZWFudXAoJmdndHQtPnZtKTsKIAotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CisJaTkxNV9h
ZGRyZXNzX3NwYWNlX2ZpbmkoJmdndHQtPnZtKTsKIAogCWFyY2hfcGh5c193Y19kZWwoZ2d0dC0+
bXRycik7CiAJaW9fbWFwcGluZ19maW5pKCZnZ3R0LT5pb21hcCk7CkBAIC0zMTU5LDkgKzMxNDMs
NiBAQCBpbnQgaTkxNV9nZ3R0X3Byb2JlX2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQogc3RhdGljIGludCBnZ3R0X2luaXRfaHcoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCkKIHsKIAlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGdndHQtPnZtLmk5MTU7Ci0JaW50IHJldCA9
IDA7Ci0KLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCWk5MTVfYWRk
cmVzc19zcGFjZV9pbml0KCZnZ3R0LT52bSwgVk1fQ0xBU1NfR0dUVCk7CiAKQEAgLTMxNzcsMTgg
KzMxNTgsMTQgQEAgc3RhdGljIGludCBnZ3R0X2luaXRfaHcoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0
dCkKIAkJCQlnZ3R0LT5nbWFkci5zdGFydCwKIAkJCQlnZ3R0LT5tYXBwYWJsZV9lbmQpKSB7CiAJ
CWdndHQtPnZtLmNsZWFudXAoJmdndHQtPnZtKTsKLQkJcmV0ID0gLUVJTzsKLQkJZ290byBvdXQ7
CisJCXJldHVybiAtRUlPOwogCX0KIAogCWdndHQtPm10cnIgPSBhcmNoX3BoeXNfd2NfYWRkKGdn
dHQtPmdtYWRyLnN0YXJ0LCBnZ3R0LT5tYXBwYWJsZV9lbmQpOwogCiAJaTkxNV9nZ3R0X2luaXRf
ZmVuY2VzKGdndHQpOwogCi1vdXQ6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKLQotCXJldHVybiByZXQ7CisJcmV0dXJuIDA7CiB9CiAKIC8qKgpAQCAtMzI1OSw2ICsz
MjM2LDcgQEAgdm9pZCBpOTE1X2dndHRfZGlzYWJsZV9ndWMoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0
dCkKIHN0YXRpYyB2b2lkIGdndHRfcmVzdG9yZV9tYXBwaW5ncyhzdHJ1Y3QgaTkxNV9nZ3R0ICpn
Z3R0KQogewogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hLCAqdm47CisJYm9vbCBmbHVzaCA9IGZhbHNl
OwogCiAJaW50ZWxfZ3RfY2hlY2tfYW5kX2NsZWFyX2ZhdWx0cyhnZ3R0LT52bS5ndCk7CiAKQEAg
LTMyNzUsMjggKzMyNTMsMjUgQEAgc3RhdGljIHZvaWQgZ2d0dF9yZXN0b3JlX21hcHBpbmdzKHN0
cnVjdCBpOTE1X2dndHQgKmdndHQpCiAJCWlmICghaTkxNV92bWFfaXNfYm91bmQodm1hLCBJOTE1
X1ZNQV9HTE9CQUxfQklORCkpCiAJCQljb250aW51ZTsKIAotCQltdXRleF91bmxvY2soJmdndHQt
PnZtLm11dGV4KTsKLQogCQlpZiAoIWk5MTVfdm1hX3VuYmluZCh2bWEpKQotCQkJZ290byBsb2Nr
OworCQkJY29udGludWU7CiAKIAkJV0FSTl9PTihpOTE1X3ZtYV9iaW5kKHZtYSwKIAkJCQkgICAg
ICBvYmogPyBvYmotPmNhY2hlX2xldmVsIDogMCwKLQkJCQkgICAgICBQSU5fVVBEQVRFKSk7Ci0J
CWlmIChvYmopIHsKLQkJCWk5MTVfZ2VtX29iamVjdF9sb2NrKG9iaik7Ci0JCQlXQVJOX09OKGk5
MTVfZ2VtX29iamVjdF9zZXRfdG9fZ3R0X2RvbWFpbihvYmosIGZhbHNlKSk7Ci0JCQlpOTE1X2dl
bV9vYmplY3RfdW5sb2NrKG9iaik7CisJCQkJICAgICAgUElOX1VQREFURSwgTlVMTCkpOworCQlp
ZiAob2JqKSB7IC8qIG9ubHkgdXNlZCBkdXJpbmcgcmVzdW1lID0+IGV4Y2x1c2l2ZSBhY2Nlc3Mg
Ki8KKwkJCWZsdXNoIHw9IGZldGNoX2FuZF96ZXJvKCZvYmotPndyaXRlX2RvbWFpbik7CisJCQlv
YmotPnJlYWRfZG9tYWlucyB8PSBJOTE1X0dFTV9ET01BSU5fR1RUOwogCQl9Ci0KLWxvY2s6Ci0J
CW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAl9CiAKIAlnZ3R0LT52bS5jbG9zZWQgPSBm
YWxzZTsKIAlnZ3R0LT5pbnZhbGlkYXRlKGdndHQpOwogCiAJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52
bS5tdXRleCk7CisKKwlpZiAoZmx1c2gpCisJCXdiaW52ZF9vbl9hbGxfY3B1cygpOwogfQogCiB2
b2lkIGk5MTVfZ2VtX3Jlc3RvcmVfZ3R0X21hcHBpbmdzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQpAQCAtMzY4Miw3ICszNjU3LDggQEAgaW50IGk5MTVfZ2VtX2d0dF9pbnNlcnQoc3Ry
dWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJdTY0IG9mZnNldDsKIAlpbnQgZXJyOwogCi0J
bG9ja2RlcF9hc3NlcnRfaGVsZCgmdm0tPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWxvY2tk
ZXBfYXNzZXJ0X2hlbGQoJnZtLT5tdXRleCk7CisKIAlHRU1fQlVHX09OKCFzaXplKTsKIAlHRU1f
QlVHX09OKCFJU19BTElHTkVEKHNpemUsIEk5MTVfR1RUX1BBR0VfU0laRSkpOwogCUdFTV9CVUdf
T04oYWxpZ25tZW50ICYmICFpc19wb3dlcl9vZl8yKGFsaWdubWVudCkpOwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3BlcmYuYwppbmRleCBlNDJiODY4MjdkNmIuLmU2YWE1NmQ4MmY5YiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9wZXJmLmMKQEAgLTEyMDQsMTUgKzEyMDQsMTAgQEAgc3RhdGljIGludCBpOTE1X29h
X3JlYWQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwKIHN0YXRpYyBzdHJ1Y3QgaW50
ZWxfY29udGV4dCAqb2FfcGluX2NvbnRleHQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVh
bSkKIHsKIAlzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lc19pdGVyIGl0OwotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gc3RyZWFtLT5kZXZfcHJpdjsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqY3R4ID0gc3RyZWFtLT5jdHg7CiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCWlu
dCBlcnI7CiAKLQllcnIgPSBpOTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkxNS0+ZHJt
KTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gRVJSX1BUUihlcnIpOwotCiAJZm9yX2VhY2hfZ2VtX2Vu
Z2luZShjZSwgaTkxNV9nZW1fY29udGV4dF9sb2NrX2VuZ2luZXMoY3R4KSwgaXQpIHsKIAkJaWYg
KGNlLT5lbmdpbmUtPmNsYXNzICE9IFJFTkRFUl9DTEFTUykKIAkJCWNvbnRpbnVlOwpAQCAtMTIy
OSwxMCArMTIyNCw2IEBAIHN0YXRpYyBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqb2FfcGluX2NvbnRl
eHQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIAl9CiAJaTkxNV9nZW1fY29udGV4
dF91bmxvY2tfZW5naW5lcyhjdHgpOwogCi0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gRVJSX1BUUihlcnIpOwotCiAJcmV0dXJuIHN0
cmVhbS0+cGlubmVkX2N0eDsKIH0KIApAQCAtMTM0NywxNSArMTMzOCw5IEBAIHN0YXRpYyB2b2lk
IG9hX3B1dF9yZW5kZXJfY3R4X2lkKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiBz
dGF0aWMgdm9pZAogZnJlZV9vYV9idWZmZXIoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVh
bSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHN0cmVhbS0+ZGV2X3ByaXY7
Ci0KLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWk5MTVfdm1hX3Vu
cGluX2FuZF9yZWxlYXNlKCZzdHJlYW0tPm9hX2J1ZmZlci52bWEsCiAJCQkJICAgSTkxNV9WTUFf
UkVMRUFTRV9NQVApOwogCi0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
LQogCXN0cmVhbS0+b2FfYnVmZmVyLnZhZGRyID0gTlVMTDsKIH0KIApAQCAtMTUxMCwxOCArMTQ5
NSwxMyBAQCBzdGF0aWMgaW50IGFsbG9jX29hX2J1ZmZlcihzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVh
bSAqc3RyZWFtKQogCWlmIChXQVJOX09OKHN0cmVhbS0+b2FfYnVmZmVyLnZtYSkpCiAJCXJldHVy
biAtRU5PREVWOwogCi0JcmV0ID0gaTkxNV9tdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmRldl9w
cml2LT5kcm0pOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KIAlCVUlMRF9CVUdfT05fTk9U
X1BPV0VSX09GXzIoT0FfQlVGRkVSX1NJWkUpOwogCUJVSUxEX0JVR19PTihPQV9CVUZGRVJfU0la
RSA8IFNaXzEyOEsgfHwgT0FfQlVGRkVSX1NJWkUgPiBTWl8xNk0pOwogCiAJYm8gPSBpOTE1X2dl
bV9vYmplY3RfY3JlYXRlX3NobWVtKGRldl9wcml2LCBPQV9CVUZGRVJfU0laRSk7CiAJaWYgKElT
X0VSUihibykpIHsKIAkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gYWxsb2NhdGUgT0EgYnVmZmVyXG4i
KTsKLQkJcmV0ID0gUFRSX0VSUihibyk7Ci0JCWdvdG8gdW5sb2NrOworCQlyZXR1cm4gUFRSX0VS
Uihibyk7CiAJfQogCiAJaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNoZV9jb2hlcmVuY3koYm8sIEk5
MTVfQ0FDSEVfTExDKTsKQEAgLTE1NDUsNyArMTUyNSw3IEBAIHN0YXRpYyBpbnQgYWxsb2Nfb2Ff
YnVmZmVyKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiAJCQkgaTkxNV9nZ3R0X29m
ZnNldChzdHJlYW0tPm9hX2J1ZmZlci52bWEpLAogCQkJIHN0cmVhbS0+b2FfYnVmZmVyLnZhZGRy
KTsKIAotCWdvdG8gdW5sb2NrOworCXJldHVybiAwOwogCiBlcnJfdW5waW46CiAJX19pOTE1X3Zt
YV91bnBpbih2bWEpOwpAQCAtMTU1Niw4ICsxNTM2LDYgQEAgc3RhdGljIGludCBhbGxvY19vYV9i
dWZmZXIoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIAlzdHJlYW0tPm9hX2J1ZmZl
ci52YWRkciA9IE5VTEw7CiAJc3RyZWFtLT5vYV9idWZmZXIudm1hID0gTlVMTDsKIAotdW5sb2Nr
OgotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBy
ZXQ7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCmluZGV4IGI4MTRjYjJhNjAxOS4uZTBlYzdi
M2EwZDUzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKQEAgLTMyLDYgKzMyLDcgQEAKIAogI2lu
Y2x1ZGUgImk5MTVfZHJ2LmgiCiAjaW5jbHVkZSAiaTkxNV9nbG9iYWxzLmgiCisjaW5jbHVkZSAi
aTkxNV9zd19mZW5jZV93b3JrLmgiCiAjaW5jbHVkZSAiaTkxNV90cmFjZS5oIgogI2luY2x1ZGUg
Imk5MTVfdm1hLmgiCiAKQEAgLTI2Miw4ICsyNjMsNiBAQCB2bWFfbG9va3VwKHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmosCiAgKiBPbmNlIGNyZWF0ZWQsIHRoZSBWTUEgaXMga2VwdCB1
bnRpbCBlaXRoZXIgdGhlIG9iamVjdCBpcyBmcmVlZCwgb3IgdGhlCiAgKiBhZGRyZXNzIHNwYWNl
IGlzIGNsb3NlZC4KICAqCi0gKiBNdXN0IGJlIGNhbGxlZCB3aXRoIHN0cnVjdF9tdXRleCBoZWxk
LgotICoKICAqIFJldHVybnMgdGhlIHZtYSwgb3IgYW4gZXJyb3IgcG9pbnRlci4KICAqLwogc3Ry
dWN0IGk5MTVfdm1hICoKQEAgLTI4OCwxOCArMjg3LDUzIEBAIGk5MTVfdm1hX2luc3RhbmNlKHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJcmV0dXJuIHZtYTsKIH0KIAorc3RydWN0
IGk5MTVfdm1hX3dvcmsgeworCXN0cnVjdCBkbWFfZmVuY2Vfd29yayBiYXNlOworCXN0cnVjdCBp
OTE1X3ZtYSAqdm1hOworCWVudW0gaTkxNV9jYWNoZV9sZXZlbCBjYWNoZV9sZXZlbDsKKwl1bnNp
Z25lZCBpbnQgZmxhZ3M7Cit9OworCitzdGF0aWMgaW50IF9fdm1hX2JpbmQoc3RydWN0IGRtYV9m
ZW5jZV93b3JrICp3b3JrKQoreworCXN0cnVjdCBpOTE1X3ZtYV93b3JrICp2dyA9IGNvbnRhaW5l
cl9vZih3b3JrLCB0eXBlb2YoKnZ3KSwgYmFzZSk7CisJc3RydWN0IGk5MTVfdm1hICp2bWEgPSB2
dy0+dm1hOworCWludCBlcnI7CisKKwllcnIgPSB2bWEtPm9wcy0+YmluZF92bWEodm1hLCB2dy0+
Y2FjaGVfbGV2ZWwsIHZ3LT5mbGFncyk7CisJaWYgKGVycikKKwkJYXRvbWljX29yKEk5MTVfVk1B
X0VSUk9SLCAmdm1hLT5mbGFncyk7CisKKwlyZXR1cm4gZXJyOworfQorCitzdHJ1Y3QgaTkxNV92
bWFfd29yayAqaTkxNV92bWFfd29yayh2b2lkKQoreworCXN0cnVjdCBpOTE1X3ZtYV93b3JrICp2
dzsKKworCXZ3ID0ga3phbGxvYyhzaXplb2YoKnZ3KSwgR0ZQX0tFUk5FTCk7CisJaWYgKCF2dykK
KwkJcmV0dXJuIE5VTEw7CisKKwlkbWFfZmVuY2Vfd29ya19pbml0KCZ2dy0+YmFzZSwgTlVMTCwg
TlVMTCk7CisJcmV0dXJuIHZ3OworfQorCiAvKioKICAqIGk5MTVfdm1hX2JpbmQgLSBTZXRzIHVw
IFBURXMgZm9yIGFuIFZNQSBpbiBpdCdzIGNvcnJlc3BvbmRpbmcgYWRkcmVzcyBzcGFjZS4KICAq
IEB2bWE6IFZNQSB0byBtYXAKICAqIEBjYWNoZV9sZXZlbDogbWFwcGluZyBjYWNoZSBsZXZlbAog
ICogQGZsYWdzOiBmbGFncyBsaWtlIGdsb2JhbCBvciBsb2NhbCBtYXBwaW5nCisgKiBAd29yazog
cHJlYWxsb2NhdGVkIHdvcmtlciBmb3IgYWxsb2NhdGluZyBhbmQgYmluZGluZyB0aGUgUFRFCiAg
KgogICogRE1BIGFkZHJlc3NlcyBhcmUgdGFrZW4gZnJvbSB0aGUgc2NhdHRlci1nYXRoZXIgdGFi
bGUgb2YgdGhpcyBvYmplY3QgKG9yIG9mCiAgKiB0aGlzIFZNQSBpbiBjYXNlIG9mIG5vbi1kZWZh
dWx0IEdHVFQgdmlld3MpIGFuZCBQVEUgZW50cmllcyBzZXQgdXAuCiAgKiBOb3RlIHRoYXQgRE1B
IGFkZHJlc3NlcyBhcmUgYWxzbyB0aGUgb25seSBwYXJ0IG9mIHRoZSBTRyB0YWJsZSB3ZSBjYXJl
IGFib3V0LgogICovCi1pbnQgaTkxNV92bWFfYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgZW51
bSBpOTE1X2NhY2hlX2xldmVsIGNhY2hlX2xldmVsLAotCQkgIHUzMiBmbGFncykKK2ludCBpOTE1
X3ZtYV9iaW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAorCQkgIGVudW0gaTkxNV9jYWNoZV9sZXZl
bCBjYWNoZV9sZXZlbCwKKwkJICB1MzIgZmxhZ3MsCisJCSAgc3RydWN0IGk5MTVfdm1hX3dvcmsg
KndvcmspCiB7CiAJdTMyIGJpbmRfZmxhZ3M7CiAJdTMyIHZtYV9mbGFnczsKQEAgLTMxNiwxMSAr
MzUwLDggQEAgaW50IGk5MTVfdm1hX2JpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEsIGVudW0gaTkx
NV9jYWNoZV9sZXZlbCBjYWNoZV9sZXZlbCwKIAlpZiAoR0VNX0RFQlVHX1dBUk5fT04oIWZsYWdz
KSkKIAkJcmV0dXJuIC1FSU5WQUw7CiAKLQliaW5kX2ZsYWdzID0gMDsKLQlpZiAoZmxhZ3MgJiBQ
SU5fR0xPQkFMKQotCQliaW5kX2ZsYWdzIHw9IEk5MTVfVk1BX0dMT0JBTF9CSU5EOwotCWlmIChm
bGFncyAmIFBJTl9VU0VSKQotCQliaW5kX2ZsYWdzIHw9IEk5MTVfVk1BX0xPQ0FMX0JJTkQ7CisJ
YmluZF9mbGFncyA9IGZsYWdzOworCWJpbmRfZmxhZ3MgJj0gSTkxNV9WTUFfR0xPQkFMX0JJTkQg
fCBJOTE1X1ZNQV9MT0NBTF9CSU5EOwogCiAJdm1hX2ZsYWdzID0gYXRvbWljX3JlYWQoJnZtYS0+
ZmxhZ3MpOwogCXZtYV9mbGFncyAmPSBJOTE1X1ZNQV9HTE9CQUxfQklORCB8IEk5MTVfVk1BX0xP
Q0FMX0JJTkQ7CkBAIC0zMzQsOSArMzY1LDI2IEBAIGludCBpOTE1X3ZtYV9iaW5kKHN0cnVjdCBp
OTE1X3ZtYSAqdm1hLCBlbnVtIGk5MTVfY2FjaGVfbGV2ZWwgY2FjaGVfbGV2ZWwsCiAJR0VNX0JV
R19PTighdm1hLT5wYWdlcyk7CiAKIAl0cmFjZV9pOTE1X3ZtYV9iaW5kKHZtYSwgYmluZF9mbGFn
cyk7Ci0JcmV0ID0gdm1hLT5vcHMtPmJpbmRfdm1hKHZtYSwgY2FjaGVfbGV2ZWwsIGJpbmRfZmxh
Z3MpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7CisJaWYgKHdvcmsgJiYgYmluZF9mbGFncyAm
IEk5MTVfVk1BX0xPQ0FMX0JJTkQpIHsKKwkJd29yay0+dm1hID0gdm1hOworCQl3b3JrLT5jYWNo
ZV9sZXZlbCA9IGNhY2hlX2xldmVsOworCQl3b3JrLT5mbGFncyA9IGJpbmRfZmxhZ3MgfCBCSU5E
X0FMTE9DOworCisJCWlmICghaTkxNV92bWFfdHJ5bG9jayh2bWEpKQorCQkJcmV0dXJuIC1FQUdB
SU47CisKKwkJZG1hX2ZlbmNlX3dvcmtfY2hhaW4oJndvcmstPmJhc2UsIGRtYV9yZXN2X2dldF9l
eGNsKHZtYS0+cmVzdikpOworCQlkbWFfcmVzdl9hZGRfZXhjbF9mZW5jZSh2bWEtPnJlc3YsICZ3
b3JrLT5iYXNlLmRtYSk7CisJCWk5MTVfdm1hX3VubG9jayh2bWEpOworCisJCWk5MTVfYWN0aXZl
X3NldF9leGNsdXNpdmUoJnZtYS0+YWN0aXZlLCAmd29yay0+YmFzZS5kbWEpOworCQl3b3JrLT5i
YXNlLmZuID0gX192bWFfYmluZDsKKwl9IGVsc2UgeworCQlHRU1fQlVHX09OKChiaW5kX2ZsYWdz
ICYgfnZtYV9mbGFncykgJiBJOTE1X1ZNQV9MT0NBTF9CSU5EKTsKKwkJcmV0ID0gdm1hLT5vcHMt
PmJpbmRfdm1hKHZtYSwgY2FjaGVfbGV2ZWwsIGJpbmRfZmxhZ3MpOworCQlpZiAocmV0KQorCQkJ
cmV0dXJuIHJldDsKKwl9CiAKIAlhdG9taWNfb3IoYmluZF9mbGFncywgJnZtYS0+ZmxhZ3MpOwog
CXJldHVybiAwOwpAQCAtMzQ5LDkgKzM5Nyw3IEBAIHZvaWQgX19pb21lbSAqaTkxNV92bWFfcGlu
X2lvbWFwKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCiAJLyogQWNjZXNzIHRocm91Z2ggdGhlIEdU
VCByZXF1aXJlcyB0aGUgZGV2aWNlIHRvIGJlIGF3YWtlLiAqLwogCWFzc2VydF9ycG1fd2FrZWxv
Y2tfaGVsZCgmdm1hLT52bS0+aTkxNS0+cnVudGltZV9wbSk7Ci0KLQlsb2NrZGVwX2Fzc2VydF9o
ZWxkKCZ2bWEtPnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAoV0FSTl9PTighaTkx
NV92bWFfaXNfbWFwX2FuZF9mZW5jZWFibGUodm1hKSkpIHsKKwlpZiAoR0VNX1dBUk5fT04oIWk5
MTVfdm1hX2lzX21hcF9hbmRfZmVuY2VhYmxlKHZtYSkpKSB7CiAJCWVyciA9IC1FTk9ERVY7CiAJ
CWdvdG8gZXJyOwogCX0KQEAgLTM2OSw3ICs0MTUsOCBAQCB2b2lkIF9faW9tZW0gKmk5MTVfdm1h
X3Bpbl9pb21hcChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAkJCWdvdG8gZXJyOwogCQl9CiAKLQkJ
dm1hLT5pb21hcCA9IHB0cjsKKwkJaWYgKHVubGlrZWx5KGNtcHhjaGcoJnZtYS0+aW9tYXAsIE5V
TEwsIHB0cikpKQorCQkJaW9fbWFwcGluZ191bm1hcChwdHIpOwogCX0KIAogCV9faTkxNV92bWFf
cGluKHZtYSk7CkBAIC0zODksMTggKzQzNiwxMiBAQCB2b2lkIF9faW9tZW0gKmk5MTVfdm1hX3Bp
bl9pb21hcChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAogdm9pZCBpOTE1X3ZtYV9mbHVzaF93cml0
ZXMoc3RydWN0IGk5MTVfdm1hICp2bWEpCiB7Ci0JaWYgKCFpOTE1X3ZtYV9oYXNfZ2d0dF93cml0
ZSh2bWEpKQotCQlyZXR1cm47Ci0KLQlpbnRlbF9ndF9mbHVzaF9nZ3R0X3dyaXRlcyh2bWEtPnZt
LT5ndCk7Ci0KLQlpOTE1X3ZtYV91bnNldF9nZ3R0X3dyaXRlKHZtYSk7CisJaWYgKGk5MTVfdm1h
X3Vuc2V0X2dndHRfd3JpdGUodm1hKSkKKwkJaW50ZWxfZ3RfZmx1c2hfZ2d0dF93cml0ZXModm1h
LT52bS0+Z3QpOwogfQogCiB2b2lkIGk5MTVfdm1hX3VucGluX2lvbWFwKHN0cnVjdCBpOTE1X3Zt
YSAqdm1hKQogewotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0tPmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwotCiAJR0VNX0JVR19PTih2bWEtPmlvbWFwID09IE5VTEwpOwogCiAJaTkxNV92
bWFfZmx1c2hfd3JpdGVzKHZtYSk7CkBAIC01MzksNyArNTgwLDYgQEAgc3RhdGljIHZvaWQgYXNz
ZXJ0X2JpbmRfY291bnQoY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHN0
YXRpYyBpbnQKIGk5MTVfdm1hX2luc2VydChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUs
IHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB2bWEtPnZtLT5pOTE1OwogCXVuc2lnbmVkIGludCBjYWNoZV9sZXZlbDsKIAl1
NjQgc3RhcnQsIGVuZDsKIAlpbnQgcmV0OwpAQCAtNTY1LDcgKzYwNSw3IEBAIGk5MTVfdm1hX2lu
c2VydChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBm
bGFncykKIAogCWVuZCA9IHZtYS0+dm0tPnRvdGFsOwogCWlmIChmbGFncyAmIFBJTl9NQVBQQUJM
RSkKLQkJZW5kID0gbWluX3QodTY0LCBlbmQsIGRldl9wcml2LT5nZ3R0Lm1hcHBhYmxlX2VuZCk7
CisJCWVuZCA9IG1pbl90KHU2NCwgZW5kLCBpOTE1X3ZtX3RvX2dndHQodm1hLT52bSktPm1hcHBh
YmxlX2VuZCk7CiAJaWYgKGZsYWdzICYgUElOX1pPTkVfNEcpCiAJCWVuZCA9IG1pbl90KHU2NCwg
ZW5kLCAoMVVMTCA8PCAzMikgLSBJOTE1X0dUVF9QQUdFX1NJWkUpOwogCUdFTV9CVUdfT04oIUlT
X0FMSUdORUQoZW5kLCBJOTE1X0dUVF9QQUdFX1NJWkUpKTsKQEAgLTU4MSwyMSArNjIxLDE0IEBA
IGk5MTVfdm1hX2luc2VydChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGln
bm1lbnQsIHU2NCBmbGFncykKIAkJcmV0dXJuIC1FTk9TUEM7CiAJfQogCi0JaWYgKHZtYS0+b2Jq
KSB7Ci0JCXJldCA9IGk5MTVfZ2VtX29iamVjdF9waW5fcGFnZXModm1hLT5vYmopOwotCQlpZiAo
cmV0KQotCQkJcmV0dXJuIHJldDsKLQotCQljYWNoZV9sZXZlbCA9IHZtYS0+b2JqLT5jYWNoZV9s
ZXZlbDsKLQl9IGVsc2UgewotCQljYWNoZV9sZXZlbCA9IDA7Ci0JfQotCiAJR0VNX0JVR19PTih2
bWEtPnBhZ2VzKTsKLQogCXJldCA9IHZtYS0+b3BzLT5zZXRfcGFnZXModm1hKTsKIAlpZiAocmV0
KQotCQlnb3RvIGVycl91bnBpbjsKKwkJcmV0dXJuIHJldDsKKworCWNhY2hlX2xldmVsID0gMDsK
KwlpZiAodm1hLT5vYmopCisJCWNhY2hlX2xldmVsID0gdm1hLT5vYmotPmNhY2hlX2xldmVsOwog
CiAJaWYgKGZsYWdzICYgUElOX09GRlNFVF9GSVhFRCkgewogCQl1NjQgb2Zmc2V0ID0gZmxhZ3Mg
JiBQSU5fT0ZGU0VUX01BU0s7CkBAIC02NTYsMTEgKzY4OSwxMCBAQCBpOTE1X3ZtYV9pbnNlcnQo
c3RydWN0IGk5MTVfdm1hICp2bWEsIHU2NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3Mp
CiAJR0VNX0JVR19PTighZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKTsKIAlHRU1f
QlVHX09OKCFpOTE1X2dlbV92YWxpZF9ndHRfc3BhY2Uodm1hLCBjYWNoZV9sZXZlbCkpOwogCi0J
bXV0ZXhfbG9jaygmdm1hLT52bS0+bXV0ZXgpOwogCWxpc3RfYWRkX3RhaWwoJnZtYS0+dm1fbGlu
aywgJnZtYS0+dm0tPmJvdW5kX2xpc3QpOwotCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgp
OwogCiAJaWYgKHZtYS0+b2JqKSB7CisJCWF0b21pY19pbmMoJnZtYS0+b2JqLT5tbS5wYWdlc19w
aW5fY291bnQpOwogCQlhdG9taWNfaW5jKCZ2bWEtPm9iai0+YmluZF9jb3VudCk7CiAJCWFzc2Vy
dF9iaW5kX2NvdW50KHZtYS0+b2JqKTsKIAl9CkBAIC02NjksOSArNzAxLDYgQEAgaTkxNV92bWFf
aW5zZXJ0KHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1NjQgc2l6ZSwgdTY0IGFsaWdubWVudCwgdTY0
IGZsYWdzKQogCiBlcnJfY2xlYXI6CiAJdm1hLT5vcHMtPmNsZWFyX3BhZ2VzKHZtYSk7Ci1lcnJf
dW5waW46Ci0JaWYgKHZtYS0+b2JqKQotCQlpOTE1X2dlbV9vYmplY3RfdW5waW5fcGFnZXModm1h
LT5vYmopOwogCXJldHVybiByZXQ7CiB9CiAKQEAgLTY4MywxMCArNzEyLDggQEAgaTkxNV92bWFf
cmVtb3ZlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCiAJdm1hLT5vcHMtPmNsZWFyX3BhZ2VzKHZt
YSk7CiAKLQltdXRleF9sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CiAJZHJtX21tX3JlbW92ZV9ub2Rl
KCZ2bWEtPm5vZGUpOwogCWxpc3RfZGVsKCZ2bWEtPnZtX2xpbmspOwotCW11dGV4X3VubG9jaygm
dm1hLT52bS0+bXV0ZXgpOwogCiAJLyoKIAkgKiBTaW5jZSB0aGUgdW5ib3VuZCBsaXN0IGlzIGds
b2JhbCwgb25seSBtb3ZlIHRvIHRoYXQgbGlzdCBpZgpAQCAtNzA3LDI5ICs3MzQsMjYgQEAgaTkx
NV92bWFfcmVtb3ZlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCX0KIH0KIAotaW50IF9faTkxNV92
bWFfZG9fcGluKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAotCQkgICAgICB1NjQgc2l6ZSwgdTY0IGFs
aWdubWVudCwgdTY0IGZsYWdzKQorc3RhdGljIGludCBfX2k5MTVfdm1hX2RvX3BpbihzdHJ1Y3Qg
aTkxNV92bWEgKnZtYSwKKwkJCSAgICAgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFn
cywKKwkJCSAgICAgc3RydWN0IGk5MTVfdm1hX3dvcmsgKndvcmspCiB7CiAJY29uc3QgdW5zaWdu
ZWQgaW50IGJvdW5kID0gYXRvbWljX3JlYWQoJnZtYS0+ZmxhZ3MpOwogCWludCByZXQ7CiAKLQls
b2NrZGVwX2Fzc2VydF9oZWxkKCZ2bWEtPnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlH
RU1fQlVHX09OKChmbGFncyAmIChQSU5fR0xPQkFMIHwgUElOX1VTRVIpKSA9PSAwKTsKIAlHRU1f
QlVHX09OKChmbGFncyAmIFBJTl9HTE9CQUwpICYmICFpOTE1X3ZtYV9pc19nZ3R0KHZtYSkpOwog
Ci0JaWYgKFdBUk5fT04oYm91bmQgJiBJOTE1X1ZNQV9QSU5fT1ZFUkZMT1cpKSB7Ci0JCXJldCA9
IC1FQlVTWTsKLQkJZ290byBlcnJfdW5waW47Ci0JfQotCiAJaWYgKChib3VuZCAmIEk5MTVfVk1B
X0JJTkRfTUFTSykgPT0gMCkgewogCQlyZXQgPSBpOTE1X3ZtYV9pbnNlcnQodm1hLCBzaXplLCBh
bGlnbm1lbnQsIGZsYWdzKTsKIAkJaWYgKHJldCkKLQkJCWdvdG8gZXJyX3VucGluOworCQkJcmV0
dXJuIHJldDsKIAl9CiAJR0VNX0JVR19PTighZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5v
ZGUpKTsKIAotCXJldCA9IGk5MTVfdm1hX2JpbmQodm1hLCB2bWEtPm9iaiA/IHZtYS0+b2JqLT5j
YWNoZV9sZXZlbCA6IDAsIGZsYWdzKTsKKwlyZXQgPSBpOTE1X3ZtYV9iaW5kKHZtYSwKKwkJCSAg
ICB2bWEtPm9iaiA/IHZtYS0+b2JqLT5jYWNoZV9sZXZlbCA6IDAsCisJCQkgICAgZmxhZ3MsIHdv
cmspOwogCWlmIChyZXQpCiAJCWdvdG8gZXJyX3JlbW92ZTsKIApAQCAtNzM5LDYgKzc2Myw4IEBA
IGludCBfX2k5MTVfdm1hX2RvX3BpbihzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAkJX19pOTE1X3Zt
YV9zZXRfbWFwX2FuZF9mZW5jZWFibGUodm1hKTsKIAogCUdFTV9CVUdfT04oaTkxNV92bWFfbWlz
cGxhY2VkKHZtYSwgc2l6ZSwgYWxpZ25tZW50LCBmbGFncykpOworCisJX19pOTE1X3ZtYV9waW4o
dm1hKTsKIAlyZXR1cm4gMDsKIAogZXJyX3JlbW92ZToKQEAgLTc0NywxMSArNzczLDc3IEBAIGlu
dCBfX2k5MTVfdm1hX2RvX3BpbihzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAkJR0VNX0JVR19PTih2
bWEtPnBhZ2VzKTsKIAkJR0VNX0JVR19PTihhdG9taWNfcmVhZCgmdm1hLT5mbGFncykgJiBJOTE1
X1ZNQV9CSU5EX01BU0spOwogCX0KLWVycl91bnBpbjoKLQlfX2k5MTVfdm1hX3VucGluKHZtYSk7
CiAJcmV0dXJuIHJldDsKIH0KIAoraW50IGk5MTVfdm1hX3BpbihzdHJ1Y3QgaTkxNV92bWEgKnZt
YSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncykKK3sKKwlzdHJ1Y3QgaTkxNV92
bWFfd29yayAqd29yayA9IE5VTEw7CisJdW5zaWduZWQgaW50IGJvdW5kOworCWludCBlcnI7CisK
KwlCVUlMRF9CVUdfT04oUElOX01CWiAhPSBJOTE1X1ZNQV9QSU5fT1ZFUkZMT1cpOworCUJVSUxE
X0JVR19PTihQSU5fR0xPQkFMICE9IEk5MTVfVk1BX0dMT0JBTF9CSU5EKTsKKwlCVUlMRF9CVUdf
T04oUElOX1VTRVIgIT0gSTkxNV9WTUFfTE9DQUxfQklORCk7CisKKwlHRU1fQlVHX09OKGZsYWdz
ICYgSTkxNV9WTUFfUElOX09WRVJGTE9XKTsKKwlHRU1fQlVHX09OKGZsYWdzICYgSTkxNV9WTUFf
RVJST1IpOworCisJYm91bmQgPSBhdG9taWNfaW5jX3JldHVybigmdm1hLT5mbGFncyk7CisJaWYg
KGxpa2VseSgoKGJvdW5kIF4gZmxhZ3MpICYgSTkxNV9WTUFfQklORF9NQVNLKSA9PSAwKSkgewor
CQlHRU1fQlVHX09OKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpOworCQlHRU1f
QlVHX09OKGk5MTVfdm1hX21pc3BsYWNlZCh2bWEsIHNpemUsIGFsaWdubWVudCwgZmxhZ3MpKTsK
KwkJcmV0dXJuIDA7CisJfQorCisJaWYgKGJvdW5kICYgSTkxNV9WTUFfRVJST1IpIHsKKwkJZXJy
ID0gLUVOT01FTTsKKwkJZ290byBlcnJfdW5waW47CisJfQorCisJaWYgKFdBUk5fT04oYm91bmQg
JiBJOTE1X1ZNQV9QSU5fT1ZFUkZMT1cpKSB7CisJCWVyciA9IC1FTk9NRU07CisJCWdvdG8gZXJy
X3VucGluOworCX0KKworCWlmICh2bWEtPm9iaikgeworCQllcnIgPSBpOTE1X2dlbV9vYmplY3Rf
cGluX3BhZ2VzKHZtYS0+b2JqKTsKKwkJaWYgKGVycikKKwkJCXJldHVybiBlcnI7CisJfQorCisJ
aWYgKGZsYWdzICYgUElOX1VTRVIpIHsKKwkJd29yayA9IGk5MTVfdm1hX3dvcmsoKTsKKwkJaWYg
KCF3b3JrKSB7CisJCQllcnIgPSAtRU5PTUVNOworCQkJZ290byBlcnJfcGFnZXM7CisJCX0KKwl9
CisKKwllcnIgPSBpOTE1X2FjdGl2ZV9hY3F1aXJlKCZ2bWEtPmFjdGl2ZSk7CisJaWYgKGVycikK
KwkJZ290byBlcnJfZmVuY2U7CisKKwllcnIgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJnZt
YS0+dm0tPm11dGV4KTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl9hY3RpdmU7CisKKwllcnIgPSBf
X2k5MTVfdm1hX2RvX3Bpbih2bWEsIHNpemUsIGFsaWdubWVudCwgZmxhZ3MsIHdvcmspOworCisJ
bXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CitlcnJfYWN0aXZlOgorCWk5MTVfYWN0aXZl
X3JlbGVhc2UoJnZtYS0+YWN0aXZlKTsKK2Vycl9mZW5jZToKKwlpZiAod29yaykKKwkJZG1hX2Zl
bmNlX3dvcmtfY29tbWl0KCZ3b3JrLT5iYXNlKTsKK2Vycl9wYWdlczoKKwlpZiAodm1hLT5vYmop
CisJCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyh2bWEtPm9iaik7CitlcnJfdW5waW46CisJ
YXRvbWljX2RlYygmdm1hLT5mbGFncyk7CisJcmV0dXJuIGVycjsKK30KKwogdm9pZCBpOTE1X3Zt
YV9jbG9zZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHZtYS0+dm0tPmk5MTU7CkBAIC03OTMsMTAgKzg4NSwxOCBAQCB2b2lkIGk5MTVf
dm1hX3Jlb3BlbihzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAlfX2k5MTVfdm1hX3JlbW92ZV9jbG9z
ZWQodm1hKTsKIH0KIAotc3RhdGljIHZvaWQgX19pOTE1X3ZtYV9kZXN0cm95KHN0cnVjdCBpOTE1
X3ZtYSAqdm1hKQordm9pZCBpOTE1X3ZtYV9kZXN0cm95KHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQog
ewotCUdFTV9CVUdfT04odm1hLT5ub2RlLmFsbG9jYXRlZCk7Ci0JR0VNX0JVR19PTih2bWEtPmZl
bmNlKTsKKwlfX2k5MTVfdm1hX3JlbW92ZV9jbG9zZWQodm1hKTsKKworCWlmIChkcm1fbW1fbm9k
ZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpIHsKKwkJbXV0ZXhfbG9jaygmdm1hLT52bS0+bXV0ZXgp
OworCQlhdG9taWNfYW5kKH5JOTE1X1ZNQV9QSU5fTUFTSywgJnZtYS0+ZmxhZ3MpOworCQlXQVJO
X09OKGk5MTVfdm1hX3VuYmluZCh2bWEpKTsKKwkJbXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRl
eCk7CisJCUdFTV9CVUdfT04oZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKTsKKwl9
CisJR0VNX0JVR19PTihpOTE1X3ZtYV9pc19hY3RpdmUodm1hKSk7CiAKIAlpZiAodm1hLT5vYmop
IHsKIAkJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IHZtYS0+b2JqOwpAQCAtODA4
LDM0ICs5MDgsMjYgQEAgc3RhdGljIHZvaWQgX19pOTE1X3ZtYV9kZXN0cm95KHN0cnVjdCBpOTE1
X3ZtYSAqdm1hKQogCX0KIAogCWk5MTVfYWN0aXZlX2ZpbmkoJnZtYS0+YWN0aXZlKTsKLQogCWk5
MTVfdm1hX2ZyZWUodm1hKTsKIH0KIAotdm9pZCBpOTE1X3ZtYV9kZXN0cm95KHN0cnVjdCBpOTE1
X3ZtYSAqdm1hKQotewotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0tPmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwotCi0JR0VNX0JVR19PTihpOTE1X3ZtYV9pc19waW5uZWQodm1hKSk7Ci0K
LQlfX2k5MTVfdm1hX3JlbW92ZV9jbG9zZWQodm1hKTsKLQotCVdBUk5fT04oaTkxNV92bWFfdW5i
aW5kKHZtYSkpOwotCUdFTV9CVUdfT04oaTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpOwotCi0JX19p
OTE1X3ZtYV9kZXN0cm95KHZtYSk7Ci19Ci0KIHZvaWQgaTkxNV92bWFfcGFya2VkKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hLCAqbmV4dDsK
IAogCXNwaW5fbG9ja19pcnEoJmk5MTUtPmd0LmNsb3NlZF9sb2NrKTsKIAlsaXN0X2Zvcl9lYWNo
X2VudHJ5X3NhZmUodm1hLCBuZXh0LCAmaTkxNS0+Z3QuY2xvc2VkX3ZtYSwgY2xvc2VkX2xpbmsp
IHsKKwkJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IHZtYS0+b2JqOworCiAJCWxp
c3RfZGVsX2luaXQoJnZtYS0+Y2xvc2VkX2xpbmspOworCisJCWlmICgha3JlZl9nZXRfdW5sZXNz
X3plcm8oJm9iai0+YmFzZS5yZWZjb3VudCkpCisJCQljb250aW51ZTsKKwogCQlzcGluX3VubG9j
a19pcnEoJmk5MTUtPmd0LmNsb3NlZF9sb2NrKTsKIAogCQlpOTE1X3ZtYV9kZXN0cm95KHZtYSk7
CisJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKIAogCQlzcGluX2xvY2tfaXJxKCZpOTE1LT5n
dC5jbG9zZWRfbG9jayk7CiAJfQpAQCAtOTI4LDM0ICsxMDIwLDE1IEBAIGludCBpOTE1X3ZtYV91
bmJpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEpCiB7CiAJaW50IHJldDsKIAotCWxvY2tkZXBfYXNz
ZXJ0X2hlbGQoJnZtYS0+dm0tPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWxvY2tkZXBfYXNz
ZXJ0X2hlbGQoJnZtYS0+dm0tPm11dGV4KTsKIAogCS8qCiAJICogRmlyc3Qgd2FpdCB1cG9uIGFu
eSBhY3Rpdml0eSBhcyByZXRpcmluZyB0aGUgcmVxdWVzdCBtYXkKIAkgKiBoYXZlIHNpZGUtZWZm
ZWN0cyBzdWNoIGFzIHVucGlubmluZyBvciBldmVuIHVuYmluZGluZyB0aGlzIHZtYS4KIAkgKi8K
LQltaWdodF9zbGVlcCgpOwotCWlmIChpOTE1X3ZtYV9pc19hY3RpdmUodm1hKSkgewotCQkvKgot
CQkgKiBXaGVuIGEgY2xvc2VkIFZNQSBpcyByZXRpcmVkLCBpdCBpcyB1bmJvdW5kIC0gZWVrLgot
CQkgKiBJbiBvcmRlciB0byBwcmV2ZW50IGl0IGZyb20gYmVpbmcgcmVjdXJzaXZlbHkgY2xvc2Vk
LAotCQkgKiB0YWtlIGEgcGluIG9uIHRoZSB2bWEgc28gdGhhdCB0aGUgc2Vjb25kIHVuYmluZCBp
cwotCQkgKiBhYm9ydGVkLgotCQkgKgotCQkgKiBFdmVuIG1vcmUgc2NhcnkgaXMgdGhhdCB0aGUg
cmV0aXJlIGNhbGxiYWNrIG1heSBmcmVlCi0JCSAqIHRoZSBvYmplY3QgKGxhc3QgYWN0aXZlIHZt
YSkuIFRvIHByZXZlbnQgdGhlIGV4cGxvc2lvbgotCQkgKiB3ZSBkZWZlciB0aGUgYWN0dWFsIG9i
amVjdCBmcmVlIHRvIGEgd29ya2VyIHRoYXQgY2FuCi0JCSAqIG9ubHkgcHJvY2VlZCBvbmNlIGl0
IGFjcXVpcmVzIHRoZSBzdHJ1Y3RfbXV0ZXggKHdoaWNoCi0JCSAqIHdlIGN1cnJlbnRseSBob2xk
LCB0aGVyZWZvcmUgaXQgY2Fubm90IGZyZWUgdGhpcyBvYmplY3QKLQkJICogYmVmb3JlIHdlIGFy
ZSBmaW5pc2hlZCkuCi0JCSAqLwotCQlfX2k5MTVfdm1hX3Bpbih2bWEpOwotCQlyZXQgPSBpOTE1
X2FjdGl2ZV93YWl0KCZ2bWEtPmFjdGl2ZSk7Ci0JCV9faTkxNV92bWFfdW5waW4odm1hKTsKLQkJ
aWYgKHJldCkKLQkJCXJldHVybiByZXQ7Ci0JfQotCUdFTV9CVUdfT04oaTkxNV92bWFfaXNfYWN0
aXZlKHZtYSkpOworCXJldCA9IGk5MTVfYWN0aXZlX3dhaXQoJnZtYS0+YWN0aXZlKTsKKwlpZiAo
cmV0KQorCQlyZXR1cm4gcmV0OwogCiAJaWYgKGk5MTVfdm1hX2lzX3Bpbm5lZCh2bWEpKSB7CiAJ
CXZtYV9wcmludF9hbGxvY2F0b3Iodm1hLCAiaXMgcGlubmVkIik7CkBAIC05NzYsMTYgKzEwNDks
MTIgQEAgaW50IGk5MTVfdm1hX3VuYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAkJR0VNX0JV
R19PTihpOTE1X3ZtYV9oYXNfZ2d0dF93cml0ZSh2bWEpKTsKIAogCQkvKiByZWxlYXNlIHRoZSBm
ZW5jZSByZWcgX2FmdGVyXyBmbHVzaGluZyAqLwotCQltdXRleF9sb2NrKCZ2bWEtPnZtLT5tdXRl
eCk7CiAJCXJldCA9IGk5MTVfdm1hX3Jldm9rZV9mZW5jZSh2bWEpOwotCQltdXRleF91bmxvY2so
JnZtYS0+dm0tPm11dGV4KTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiByZXQ7CiAKIAkJLyogRm9y
Y2UgYSBwYWdlZmF1bHQgZm9yIGRvbWFpbiB0cmFja2luZyBvbiBuZXh0IHVzZXIgYWNjZXNzICov
Ci0JCW11dGV4X2xvY2soJnZtYS0+dm0tPm11dGV4KTsKIAkJaTkxNV92bWFfcmV2b2tlX21tYXAo
dm1hKTsKLQkJbXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CiAKIAkJX19pOTE1X3ZtYV9p
b3VubWFwKHZtYSk7CiAJCWNsZWFyX2JpdChJOTE1X1ZNQV9DQU5fRkVOQ0VfQklULCBfX2k5MTVf
dm1hX2ZsYWdzKHZtYSkpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92
bWEuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmgKaW5kZXggYzM1ZTc4M2IyZjc1
Li4wMzA0NTg1NTBhZTUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1h
LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaApAQCAtNzMsNiArNzMsNyBA
QCBzdHJ1Y3QgaTkxNV92bWEgewogCSAqLwogCWF0b21pY190IG9wZW5fY291bnQ7CiAJYXRvbWlj
X3QgZmxhZ3M7CisKIAkvKioKIAkgKiBIb3cgbWFueSB1c2VycyBoYXZlIHBpbm5lZCB0aGlzIG9i
amVjdCBpbiBHVFQgc3BhY2UuCiAJICoKQEAgLTEwMCwyMSArMTAxLDI2IEBAIHN0cnVjdCBpOTE1
X3ZtYSB7CiAjZGVmaW5lIEk5MTVfVk1BX1BJTl9PVkVSRkxPV19CSVQgOAogI2RlZmluZSBJOTE1
X1ZNQV9QSU5fT1ZFUkZMT1cJKChpbnQpQklUKEk5MTVfVk1BX1BJTl9PVkVSRkxPV19CSVQpKQog
CisjZGVmaW5lIEJJTkRfQUxMT0MgSTkxNV9WTUFfUElOX09WRVJGTE9XCisKIAkvKiogRmxhZ3Mg
YW5kIGFkZHJlc3Mgc3BhY2UgdGhpcyBWTUEgaXMgYm91bmQgdG8gKi8KICNkZWZpbmUgSTkxNV9W
TUFfR0xPQkFMX0JJTkRfQklUIDkKICNkZWZpbmUgSTkxNV9WTUFfTE9DQUxfQklORF9CSVQgMTAK
KyNkZWZpbmUgSTkxNV9WTUFfRVJST1JfQklUCTExCiAKICNkZWZpbmUgSTkxNV9WTUFfR0xPQkFM
X0JJTkQJKChpbnQpQklUKEk5MTVfVk1BX0dMT0JBTF9CSU5EX0JJVCkpCiAjZGVmaW5lIEk5MTVf
Vk1BX0xPQ0FMX0JJTkQJKChpbnQpQklUKEk5MTVfVk1BX0xPQ0FMX0JJTkRfQklUKSkKKyNkZWZp
bmUgSTkxNV9WTUFfRVJST1IJCSgoaW50KUJJVChJOTE1X1ZNQV9FUlJPUl9CSVQpKQogCiAjZGVm
aW5lIEk5MTVfVk1BX0JJTkRfTUFTSyAoSTkxNV9WTUFfR0xPQkFMX0JJTkQgfCBcCiAJCQkgICAg
STkxNV9WTUFfTE9DQUxfQklORCB8IFwKKwkJCSAgICBJOTE1X1ZNQV9FUlJPUiB8IFwKIAkJCSAg
ICBJOTE1X1ZNQV9QSU5fT1ZFUkZMT1cpCiAKLSNkZWZpbmUgSTkxNV9WTUFfR0dUVF9CSVQJMTEK
LSNkZWZpbmUgSTkxNV9WTUFfQ0FOX0ZFTkNFX0JJVAkxMgotI2RlZmluZSBJOTE1X1ZNQV9VU0VS
RkFVTFRfQklUCTEzCi0jZGVmaW5lIEk5MTVfVk1BX0dHVFRfV1JJVEVfQklUCTE0CisjZGVmaW5l
IEk5MTVfVk1BX0dHVFRfQklUCTEyCisjZGVmaW5lIEk5MTVfVk1BX0NBTl9GRU5DRV9CSVQJMTMK
KyNkZWZpbmUgSTkxNV9WTUFfVVNFUkZBVUxUX0JJVAkxNAorI2RlZmluZSBJOTE1X1ZNQV9HR1RU
X1dSSVRFX0JJVAkxNQogCiAjZGVmaW5lIEk5MTVfVk1BX0dHVFQJCSgoaW50KUJJVChJOTE1X1ZN
QV9HR1RUX0JJVCkpCiAjZGVmaW5lIEk5MTVfVk1BX0NBTl9GRU5DRQkoKGludClCSVQoSTkxNV9W
TUFfQ0FOX0ZFTkNFX0JJVCkpCkBAIC0zMDAsOCArMzA2LDEyIEBAIGk5MTVfdm1hX2NvbXBhcmUo
c3RydWN0IGk5MTVfdm1hICp2bWEsCiAJcmV0dXJuIG1lbWNtcCgmdm1hLT5nZ3R0X3ZpZXcucGFy
dGlhbCwgJnZpZXctPnBhcnRpYWwsIHZpZXctPnR5cGUpOwogfQogCi1pbnQgaTkxNV92bWFfYmlu
ZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgZW51bSBpOTE1X2NhY2hlX2xldmVsIGNhY2hlX2xldmVs
LAotCQkgIHUzMiBmbGFncyk7CitzdHJ1Y3QgaTkxNV92bWFfd29yayAqaTkxNV92bWFfd29yayh2
b2lkKTsKK2ludCBpOTE1X3ZtYV9iaW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAorCQkgIGVudW0g
aTkxNV9jYWNoZV9sZXZlbCBjYWNoZV9sZXZlbCwKKwkJICB1MzIgZmxhZ3MsCisJCSAgc3RydWN0
IGk5MTVfdm1hX3dvcmsgKndvcmspOworCiBib29sIGk5MTVfZ2VtX3ZhbGlkX2d0dF9zcGFjZShz
dHJ1Y3QgaTkxNV92bWEgKnZtYSwgdW5zaWduZWQgbG9uZyBjYWNoZV9sZXZlbCk7CiBib29sIGk5
MTVfdm1hX21pc3BsYWNlZChjb25zdCBzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAkJCXU2NCBzaXpl
LCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3MpOwpAQCAtMzIwLDMyICszMzAsMTkgQEAgc3RhdGlj
IGlubGluZSB2b2lkIGk5MTVfdm1hX2xvY2soc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJZG1hX3Jl
c3ZfbG9jayh2bWEtPnJlc3YsIE5VTEwpOwogfQogCi1zdGF0aWMgaW5saW5lIHZvaWQgaTkxNV92
bWFfdW5sb2NrKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQorc3RhdGljIGlubGluZSBib29sIGk5MTVf
dm1hX3RyeWxvY2soc3RydWN0IGk5MTVfdm1hICp2bWEpCiB7Ci0JZG1hX3Jlc3ZfdW5sb2NrKHZt
YS0+cmVzdik7CisJcmV0dXJuIGRtYV9yZXN2X3RyeWxvY2sodm1hLT5yZXN2KTsKIH0KIAotaW50
IF9faTkxNV92bWFfZG9fcGluKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAotCQkgICAgICB1NjQgc2l6
ZSwgdTY0IGFsaWdubWVudCwgdTY0IGZsYWdzKTsKLXN0YXRpYyBpbmxpbmUgaW50IF9fbXVzdF9j
aGVjawotaTkxNV92bWFfcGluKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1NjQgc2l6ZSwgdTY0IGFs
aWdubWVudCwgdTY0IGZsYWdzKQorc3RhdGljIGlubGluZSB2b2lkIGk5MTVfdm1hX3VubG9jayhz
dHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKLQlCVUlMRF9CVUdfT04oUElOX01CWiAhPSBJOTE1X1ZN
QV9QSU5fT1ZFUkZMT1cpOwotCUJVSUxEX0JVR19PTihQSU5fR0xPQkFMICE9IEk5MTVfVk1BX0dM
T0JBTF9CSU5EKTsKLQlCVUlMRF9CVUdfT04oUElOX1VTRVIgIT0gSTkxNV9WTUFfTE9DQUxfQklO
RCk7Ci0KLQkvKiBQaW4gZWFybHkgdG8gcHJldmVudCB0aGUgc2hyaW5rZXIvZXZpY3Rpb24gbG9n
aWMgZnJvbSBkZXN0cm95aW5nCi0JICogb3VyIHZtYSBhcyB3ZSBpbnNlcnQgYW5kIGJpbmQuCi0J
ICovCi0JaWYgKGxpa2VseSgoKGF0b21pY19pbmNfcmV0dXJuKCZ2bWEtPmZsYWdzKSBeIGZsYWdz
KSAmIEk5MTVfVk1BX0JJTkRfTUFTSykgPT0gMCkpIHsKLQkJR0VNX0JVR19PTighZHJtX21tX25v
ZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKTsKLQkJR0VNX0JVR19PTihpOTE1X3ZtYV9taXNwbGFj
ZWQodm1hLCBzaXplLCBhbGlnbm1lbnQsIGZsYWdzKSk7Ci0JCXJldHVybiAwOwotCX0KLQotCXJl
dHVybiBfX2k5MTVfdm1hX2RvX3Bpbih2bWEsIHNpemUsIGFsaWdubWVudCwgZmxhZ3MpOworCWRt
YV9yZXN2X3VubG9jayh2bWEtPnJlc3YpOwogfQogCitpbnQgX19tdXN0X2NoZWNrCitpOTE1X3Zt
YV9waW4oc3RydWN0IGk5MTVfdm1hICp2bWEsIHU2NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQg
ZmxhZ3MpOworCiBzdGF0aWMgaW5saW5lIGludCBpOTE1X3ZtYV9waW5fY291bnQoY29uc3Qgc3Ry
dWN0IGk5MTVfdm1hICp2bWEpCiB7CiAJcmV0dXJuIGF0b21pY19yZWFkKCZ2bWEtPmZsYWdzKSAm
IEk5MTVfVk1BX1BJTl9NQVNLOwpAQCAtMzg5LDggKzM4Niw2IEBAIHN0YXRpYyBpbmxpbmUgYm9v
bCBpOTE1X3ZtYV9pc19ib3VuZChjb25zdCBzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKICAqIHRoZSBj
YWxsZXIgbXVzdCBjYWxsIGk5MTVfdm1hX3VucGluX2lvbWFwIHRvIHJlbGlucXVpc2ggdGhlIHBp
bm5pbmcKICAqIGFmdGVyIHRoZSBpb21hcHBpbmcgaXMgbm8gbG9uZ2VyIHJlcXVpcmVkLgogICoK
LSAqIENhbGxlcnMgbXVzdCBob2xkIHRoZSBzdHJ1Y3RfbXV0ZXguCi0gKgogICogUmV0dXJucyBh
IHZhbGlkIGlvbWFwcGVkIHBvaW50ZXIgb3IgRVJSX1BUUi4KICAqLwogdm9pZCBfX2lvbWVtICpp
OTE1X3ZtYV9waW5faW9tYXAoc3RydWN0IGk5MTVfdm1hICp2bWEpOwpAQCAtNDAyLDggKzM5Nyw4
IEBAIHZvaWQgX19pb21lbSAqaTkxNV92bWFfcGluX2lvbWFwKHN0cnVjdCBpOTE1X3ZtYSAqdm1h
KTsKICAqCiAgKiBVbnBpbnMgdGhlIHByZXZpb3VzbHkgaW9tYXBwZWQgVk1BIGZyb20gaTkxNV92
bWFfcGluX2lvbWFwKCkuCiAgKgotICogQ2FsbGVycyBtdXN0IGhvbGQgdGhlIHN0cnVjdF9tdXRl
eC4gVGhpcyBmdW5jdGlvbiBpcyBvbmx5IHZhbGlkIHRvIGJlCi0gKiBjYWxsZWQgb24gYSBWTUEg
cHJldmlvdXNseSBpb21hcHBlZCBieSB0aGUgY2FsbGVyIHdpdGggaTkxNV92bWFfcGluX2lvbWFw
KCkuCisgKiBUaGlzIGZ1bmN0aW9uIGlzIG9ubHkgdmFsaWQgdG8gYmUgY2FsbGVkIG9uIGEgVk1B
IHByZXZpb3VzbHkKKyAqIGlvbWFwcGVkIGJ5IHRoZSBjYWxsZXIgd2l0aCBpOTE1X3ZtYV9waW5f
aW9tYXAoKS4KICAqLwogdm9pZCBpOTE1X3ZtYV91bnBpbl9pb21hcChzdHJ1Y3QgaTkxNV92bWEg
KnZtYSk7CiAKQEAgLTQzMSw2ICs0MjYsOCBAQCBzdGF0aWMgaW5saW5lIHN0cnVjdCBwYWdlICpp
OTE1X3ZtYV9maXJzdF9wYWdlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogaW50IF9fbXVzdF9jaGVj
ayBpOTE1X3ZtYV9waW5fZmVuY2Uoc3RydWN0IGk5MTVfdm1hICp2bWEpOwogaW50IF9fbXVzdF9j
aGVjayBpOTE1X3ZtYV9yZXZva2VfZmVuY2Uoc3RydWN0IGk5MTVfdm1hICp2bWEpOwogCitpbnQg
X19pOTE1X3ZtYV9waW5fZmVuY2Uoc3RydWN0IGk5MTVfdm1hICp2bWEpOworCiBzdGF0aWMgaW5s
aW5lIHZvaWQgX19pOTE1X3ZtYV91bnBpbl9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsK
IAlHRU1fQlVHX09OKGF0b21pY19yZWFkKCZ2bWEtPmZlbmNlLT5waW5fY291bnQpIDw9IDApOwpA
QCAtNDQ4LDcgKzQ0NSw2IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBfX2k5MTVfdm1hX3VucGluX2Zl
bmNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogc3RhdGljIGlubGluZSB2b2lkCiBpOTE1X3ZtYV91
bnBpbl9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKLQkvKiBsb2NrZGVwX2Fzc2VydF9o
ZWxkKCZ2bWEtPnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsgKi8KIAlpZiAodm1hLT5mZW5j
ZSkKIAkJX19pOTE1X3ZtYV91bnBpbl9mZW5jZSh2bWEpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYwppbmRleCBjYjMwYzY2OWIxYjcuLjI5
YTdkZTkxODFkNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5
MTVfZ2VtX2V2aWN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVf
Z2VtX2V2aWN0LmMKQEAgLTQwOCw3ICs0MDgsNyBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9jb250
ZXh0cyh2b2lkICphcmcpCiAJaWYgKCFIQVNfRlVMTF9QUEdUVChpOTE1KSkKIAkJcmV0dXJuIDA7
CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF9sb2NrKCZp
OTE1LT5nZ3R0LnZtLm11dGV4KTsKIAl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmk5
MTUtPnJ1bnRpbWVfcG0pOwogCiAJLyogUmVzZXJ2ZSBhIGJsb2NrIHNvIHRoYXQgd2Uga25vdyB3
ZSBoYXZlIGVub3VnaCB0byBmaXQgYSBmZXcgcnEgKi8KQEAgLTQ0NSw3ICs0NDUsNyBAQCBzdGF0
aWMgaW50IGlndF9ldmljdF9jb250ZXh0cyh2b2lkICphcmcpCiAJCWNvdW50Kys7CiAJfSB3aGls
ZSAoMSk7CiAJZHJtX21tX3JlbW92ZV9ub2RlKCZob2xlKTsKLQltdXRleF91bmxvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X3VubG9jaygmaTkxNS0+Z2d0dC52bS5tdXRleCk7
CiAJcHJfaW5mbygiRmlsbGVkIEdHVFQgd2l0aCAlbHUgMU1pQiBub2Rlc1xuIiwgY291bnQpOwog
CiAJLyogT3ZlcmZpbGwgdGhlIEdHVFQgd2l0aCBjb250ZXh0IG9iamVjdHMgYW5kIHNvIHRyeSB0
byBldmljdCBvbmUuICovCkBAIC01NDUsMTEgKzU0NSwxMSBAQCBpbnQgaTkxNV9nZW1fZXZpY3Rf
bW9ja19zZWxmdGVzdHModm9pZCkKIAlpZiAoIWk5MTUpCiAJCXJldHVybiAtRU5PTUVNOwogCi0J
bXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfbG9jaygmaTkxNS0+
Z2d0dC52bS5tdXRleCk7CiAJd2l0aF9pbnRlbF9ydW50aW1lX3BtKCZpOTE1LT5ydW50aW1lX3Bt
LCB3YWtlcmVmKQogCQllcnIgPSBpOTE1X3N1YnRlc3RzKHRlc3RzLCBpOTE1KTsKIAotCW11dGV4
X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5n
Z3R0LnZtLm11dGV4KTsKIAogCWRybV9kZXZfcHV0KCZpOTE1LT5kcm0pOwogCXJldHVybiBlcnI7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5jCmluZGV4IGE1YmVjMGE0
Y2RjYy4uNTNhYWZiOWEzZDY0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaTkxNV92bWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV92bWEuYwpAQCAtMzM3LDcgKzMzNyw5IEBAIHN0YXRpYyBpbnQgaWd0X3ZtYV9waW4xKHZvaWQg
KmFyZykKIAogCQlpZiAoIWVycikgewogCQkJaTkxNV92bWFfdW5waW4odm1hKTsKKwkJCW11dGV4
X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJCWVyciA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOwor
CQkJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCQlpZiAoZXJyKSB7CiAJCQkJcHJf
ZXJyKCJGYWlsZWQgdG8gdW5iaW5kIHNpbmdsZSBwYWdlIGZyb20gR0dUVCwgZXJyPSVkXG4iLCBl
cnIpOwogCQkJCWdvdG8gb3V0OwotLSAKMi4yMy4wLnJjMQoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1n
ZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21h
aWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

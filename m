Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 41D4A21B25B
	for <lists+intel-gfx@lfdr.de>; Fri, 10 Jul 2020 11:32:57 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5F8BE6EBBA;
	Fri, 10 Jul 2020 09:32:54 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (unknown [77.68.26.236])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E22EB6EBC7;
 Fri, 10 Jul 2020 09:32:49 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 21774858-1500050 
 for multiple; Fri, 10 Jul 2020 10:32:38 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 10 Jul 2020 10:32:33 +0100
Message-Id: <20200710093234.1438712-5-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.27.0
In-Reply-To: <20200710093234.1438712-1-chris@chris-wilson.co.uk>
References: <20200710093234.1438712-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t 5/6] i915/gem_exec_schedule: Try to spot
 unfairness
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org, Chris Wilson <chris@chris-wilson.co.uk>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QW4gaW1wb3J0YW50IHByb3BlcnR5IGZvciBtdWx0aS1jbGllbnQgc3lzdGVtcyBpcyB0aGF0IGVh
Y2ggY2xpZW50IGdldHMKYSAnZmFpcicgYWxsb3RtZW50IG9mIHN5c3RlbSB0aW1lLiAoV2hlcmUg
ZmFpcm5lc3MgaXMgYXQgdGhlIHdoaW0gb2YgdGhlCmNvbnRleHQgcHJvcGVydGllcywgc3VjaCBh
cyBwcmlvcml0aWVzLikgVGhpcyB0ZXN0IGZvcmtzIE4gaW5kZXBlbmRlbnQKY2xpZW50cyAoYWxi
ZWl0IHRoZXkgaGFwcGVuIHRvIHNoYXJlIGEgc2luZ2xlIHZtKSwgYW5kIGRvZXMgYW4gZXF1YWwK
YW1vdW50IG9mIHdvcmsgaW4gY2xpZW50IGFuZCBhc3NlcnRzIHRoYXQgdGhleSB0YWtlIGFuIGVx
dWFsIGFtb3VudCBvZgp0aW1lLgoKVGhvdWdoIHdlIGhhdmUgbmV2ZXIgY2xhaW1lZCB0byBoYXZl
IGEgY29tcGxldGVseSBmYWlyIHNjaGVkdWxlciwgdGhhdAppcyB3aGF0IGlzIGV4cGVjdGVkLgoK
U2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNj
OiBUdnJ0a28gVXJzdWxpbiA8dHZydGtvLnVyc3VsaW5AaW50ZWwuY29tPgpDYzogUmFtYWxpbmdh
bSBDIDxyYW1hbGluZ2FtLmNAaW50ZWwuY29tPgotLS0KIHRlc3RzL2k5MTUvZ2VtX2V4ZWNfc2No
ZWR1bGUuYyB8IDgwNSArKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKIDEgZmlsZSBj
aGFuZ2VkLCA4MDUgaW5zZXJ0aW9ucygrKQoKZGlmZiAtLWdpdCBhL3Rlc3RzL2k5MTUvZ2VtX2V4
ZWNfc2NoZWR1bGUuYyBiL3Rlc3RzL2k5MTUvZ2VtX2V4ZWNfc2NoZWR1bGUuYwppbmRleCAwZTAz
NjI1MDIuLjFiM2NiZmQ3NCAxMDA2NDQKLS0tIGEvdGVzdHMvaTkxNS9nZW1fZXhlY19zY2hlZHVs
ZS5jCisrKyBiL3Rlc3RzL2k5MTUvZ2VtX2V4ZWNfc2NoZWR1bGUuYwpAQCAtMjksNiArMjksNyBA
QAogI2luY2x1ZGUgPHN5cy9wb2xsLmg+CiAjaW5jbHVkZSA8c3lzL2lvY3RsLmg+CiAjaW5jbHVk
ZSA8c3lzL21tYW4uaD4KKyNpbmNsdWRlIDxzeXMvcmVzb3VyY2UuaD4KICNpbmNsdWRlIDxzeXMv
c3lzY2FsbC5oPgogI2luY2x1ZGUgPHNjaGVkLmg+CiAjaW5jbHVkZSA8c2lnbmFsLmg+CkBAIC0y
NTA1LDYgKzI1MDYsNzg5IEBAIHN0YXRpYyB2b2lkIG1lYXN1cmVfc2VtYXBob3JlX3Bvd2VyKGlu
dCBpOTE1KQogCXJhcGxfY2xvc2UoJnBrZyk7CiB9CiAKK3N0YXRpYyBpbnQgcmVhZF90aW1lc3Rh
bXBfZnJlcXVlbmN5KGludCBpOTE1KQoreworCWludCB2YWx1ZSA9IDA7CisJZHJtX2k5MTVfZ2V0
cGFyYW1fdCBncCA9IHsKKwkJLnZhbHVlID0gJnZhbHVlLAorCQkucGFyYW0gPSBJOTE1X1BBUkFN
X0NTX1RJTUVTVEFNUF9GUkVRVUVOQ1ksCisJfTsKKwlpb2N0bChpOTE1LCBEUk1fSU9DVExfSTkx
NV9HRVRQQVJBTSwgJmdwKTsKKwlyZXR1cm4gdmFsdWU7Cit9CisKK3N0YXRpYyB1aW50NjRfdCBk
aXY2NF91NjRfcm91bmRfdXAodWludDY0X3QgeCwgdWludDY0X3QgeSkKK3sKKwlyZXR1cm4gKHgg
KyB5IC0gMSkgLyB5OworfQorCitzdGF0aWMgdWludDY0X3QgbnNfdG9fdGlja3MoaW50IGk5MTUs
IHVpbnQ2NF90IG5zKQoreworCXJldHVybiBkaXY2NF91NjRfcm91bmRfdXAobnMgKiByZWFkX3Rp
bWVzdGFtcF9mcmVxdWVuY3koaTkxNSksCisJCQkJICBOU0VDX1BFUl9TRUMpOworfQorCitzdGF0
aWMgdWludDY0X3QgdGlja3NfdG9fbnMoaW50IGk5MTUsIHVpbnQ2NF90IHRpY2tzKQoreworCXJl
dHVybiBkaXY2NF91NjRfcm91bmRfdXAodGlja3MgKiBOU0VDX1BFUl9TRUMsCisJCQkJICByZWFk
X3RpbWVzdGFtcF9mcmVxdWVuY3koaTkxNSkpOworfQorCisjZGVmaW5lIE1JX0lOU1RSKG9wY29k
ZSwgZmxhZ3MpICgoKG9wY29kZSkgPDwgMjMpIHwgKGZsYWdzKSkKKworI2RlZmluZSBNSV9NQVRI
KHgpICAgICAgICAgICAgICAgICAgICAgIE1JX0lOU1RSKDB4MWEsICh4KSAtIDEpCisjZGVmaW5l
IE1JX01BVEhfSU5TVFIob3Bjb2RlLCBvcDEsIG9wMikgKChvcGNvZGUpIDw8IDIwIHwgKG9wMSkg
PDwgMTAgfCAob3AyKSkKKy8qIE9wY29kZXMgZm9yIE1JX01BVEhfSU5TVFIgKi8KKyNkZWZpbmUg
ICBNSV9NQVRIX05PT1AgICAgICAgICAgICAgICAgICBNSV9NQVRIX0lOU1RSKDB4MDAwLCAweDAs
IDB4MCkKKyNkZWZpbmUgICBNSV9NQVRIX0xPQUQob3AxLCBvcDIpICAgICAgICBNSV9NQVRIX0lO
U1RSKDB4MDgwLCBvcDEsIG9wMikKKyNkZWZpbmUgICBNSV9NQVRIX0xPQURJTlYob3AxLCBvcDIp
ICAgICBNSV9NQVRIX0lOU1RSKDB4NDgwLCBvcDEsIG9wMikKKyNkZWZpbmUgICBNSV9NQVRIX0xP
QUQwKG9wMSkgICAgICAgICAgICBNSV9NQVRIX0lOU1RSKDB4MDgxLCBvcDEpCisjZGVmaW5lICAg
TUlfTUFUSF9MT0FEMShvcDEpICAgICAgICAgICAgTUlfTUFUSF9JTlNUUigweDQ4MSwgb3AxKQor
I2RlZmluZSAgIE1JX01BVEhfQUREICAgICAgICAgICAgICAgICAgIE1JX01BVEhfSU5TVFIoMHgx
MDAsIDB4MCwgMHgwKQorI2RlZmluZSAgIE1JX01BVEhfU1VCICAgICAgICAgICAgICAgICAgIE1J
X01BVEhfSU5TVFIoMHgxMDEsIDB4MCwgMHgwKQorI2RlZmluZSAgIE1JX01BVEhfQU5EICAgICAg
ICAgICAgICAgICAgIE1JX01BVEhfSU5TVFIoMHgxMDIsIDB4MCwgMHgwKQorI2RlZmluZSAgIE1J
X01BVEhfT1IgICAgICAgICAgICAgICAgICAgIE1JX01BVEhfSU5TVFIoMHgxMDMsIDB4MCwgMHgw
KQorI2RlZmluZSAgIE1JX01BVEhfWE9SICAgICAgICAgICAgICAgICAgIE1JX01BVEhfSU5TVFIo
MHgxMDQsIDB4MCwgMHgwKQorI2RlZmluZSAgIE1JX01BVEhfU1RPUkUob3AxLCBvcDIpICAgICAg
IE1JX01BVEhfSU5TVFIoMHgxODAsIG9wMSwgb3AyKQorI2RlZmluZSAgIE1JX01BVEhfU1RPUkVJ
TlYob3AxLCBvcDIpICAgIE1JX01BVEhfSU5TVFIoMHg1ODAsIG9wMSwgb3AyKQorLyogUmVnaXN0
ZXJzIHVzZWQgYXMgb3BlcmFuZHMgaW4gTUlfTUFUSF9JTlNUUiAqLworI2RlZmluZSAgIE1JX01B
VEhfUkVHKHgpICAgICAgICAgICAgICAgICh4KQorI2RlZmluZSAgIE1JX01BVEhfUkVHX1NSQ0Eg
ICAgICAgICAgICAgIDB4MjAKKyNkZWZpbmUgICBNSV9NQVRIX1JFR19TUkNCICAgICAgICAgICAg
ICAweDIxCisjZGVmaW5lICAgTUlfTUFUSF9SRUdfQUNDVSAgICAgICAgICAgICAgMHgzMQorI2Rl
ZmluZSAgIE1JX01BVEhfUkVHX1pGICAgICAgICAgICAgICAgIDB4MzIKKyNkZWZpbmUgICBNSV9N
QVRIX1JFR19DRiAgICAgICAgICAgICAgICAweDMzCisKKyNkZWZpbmUgTUlfTE9BRF9SRUdJU1RF
Ul9SRUcgICAgTUlfSU5TVFIoMHgyQSwgMSkKKworc3RhdGljIHZvaWQgZGVsYXkoaW50IGk5MTUs
CisJCSAgY29uc3Qgc3RydWN0IGludGVsX2V4ZWN1dGlvbl9lbmdpbmUyICplLAorCQkgIHVpbnQz
Ml90IGhhbmRsZSwKKwkJICB1aW50NjRfdCBhZGRyLAorCQkgIHVpbnQ2NF90IG5zKQoreworCWNv
bnN0IGludCB1c2VfNjRiID0gaW50ZWxfZ2VuKGludGVsX2dldF9kcm1fZGV2aWQoaTkxNSkpID49
IDg7CisJY29uc3QgdWludDMyX3QgYmFzZSA9IGdlbV9lbmdpbmVfbW1pb19iYXNlKGk5MTUsIGUt
Pm5hbWUpOworI2RlZmluZSBDU19HUFIoeCkgKGJhc2UgKyAweDYwMCArIDggKiAoeCkpCisjZGVm
aW5lIFJVTlRJTUUgKGJhc2UgKyAweDNhOCkKKwllbnVtIHsgU1RBUlRfVFMsIE5PV19UUyB9Owor
CXVpbnQzMl90ICptYXAsICpjcywgKmptcDsKKworCWlndF9yZXF1aXJlKGJhc2UpOworCisJLyog
TG9vcCB1bnRpbCBDVFhfVElNRVNUQU1QIC0gaW5pdGlhbCA+IEBucyAqLworCisJY3MgPSBtYXAg
PSBnZW1fbW1hcF9fZGV2aWNlX2NvaGVyZW50KGk5MTUsIGhhbmRsZSwgMCwgNDA5NiwgUFJPVF9X
UklURSk7CisKKwkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJfSU1NOworCSpjcysrID0gQ1NfR1BS
KFNUQVJUX1RTKSArIDQ7CisJKmNzKysgPSAwOworCSpjcysrID0gTUlfTE9BRF9SRUdJU1RFUl9S
RUc7CisJKmNzKysgPSBSVU5USU1FOworCSpjcysrID0gQ1NfR1BSKFNUQVJUX1RTKTsKKworCXdo
aWxlIChvZmZzZXRfaW5fcGFnZShjcykgJiA2MykKKwkJKmNzKysgPSAwOworCWptcCA9IGNzOwor
CisJKmNzKysgPSAweDUgPDwgMjM7IC8qIE1JX0FSQl9DSEVDSyAqLworCisJKmNzKysgPSBNSV9M
T0FEX1JFR0lTVEVSX0lNTTsKKwkqY3MrKyA9IENTX0dQUihOT1dfVFMpICsgNDsKKwkqY3MrKyA9
IDA7CisJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX1JFRzsKKwkqY3MrKyA9IFJVTlRJTUU7CisJ
KmNzKysgPSBDU19HUFIoTk9XX1RTKTsKKworCS8qIGRlbHRhID0gbm93IC0gc3RhcnQ7IGludmVy
dGVkIHRvIG1hdGNoIENPTkRfQkJFICovCisJKmNzKysgPSBNSV9NQVRIKDQpOworCSpjcysrID0g
TUlfTUFUSF9MT0FEKE1JX01BVEhfUkVHX1NSQ0EsIE1JX01BVEhfUkVHKE5PV19UUykpOworCSpj
cysrID0gTUlfTUFUSF9MT0FEKE1JX01BVEhfUkVHX1NSQ0IsIE1JX01BVEhfUkVHKFNUQVJUX1RT
KSk7CisJKmNzKysgPSBNSV9NQVRIX1NVQjsKKwkqY3MrKyA9IE1JX01BVEhfU1RPUkVJTlYoTUlf
TUFUSF9SRUcoTk9XX1RTKSwgTUlfTUFUSF9SRUdfQUNDVSk7CisKKwkvKiBTYXZlIGRlbHRhIGZv
ciByZWFkaW5nIGJ5IENPTkRfQkJFICovCisJKmNzKysgPSAweDI0IDw8IDIzIHwgKDEgKyB1c2Vf
NjRiKTsgLyogU1JNICovCisJKmNzKysgPSBDU19HUFIoTk9XX1RTKTsKKwkqY3MrKyA9IGFkZHIg
KyA0MDAwOworCSpjcysrID0gYWRkciA+PiAzMjsKKworCS8qIERlbGF5IGJldHdlZW4gU1JNIGFu
ZCBDT05EX0JCRSB0byBwb3N0IHRoZSB3cml0ZXMgKi8KKwlmb3IgKGludCBuID0gMDsgbiA8IDg7
IG4rKykgeworCQkqY3MrKyA9IE1JX1NUT1JFX0RXT1JEX0lNTTsKKwkJaWYgKHVzZV82NGIpIHsK
KwkJCSpjcysrID0gYWRkciArIDQwNjQ7CisJCQkqY3MrKyA9IGFkZHIgPj4gMzI7CisJCX0gZWxz
ZSB7CisJCQkqY3MrKyA9IDA7CisJCQkqY3MrKyA9IGFkZHIgKyA0MDY0OworCQl9CisJCSpjcysr
ID0gMDsKKwl9CisKKwkvKiBCcmVhayBpZiBkZWx0YSA+IG5zICovCisJKmNzKysgPSBNSV9DT05E
X0JBVENIX0JVRkZFUl9FTkQgfCBNSV9ET19DT01QQVJFIHwgKDEgKyB1c2VfNjRiKTsKKwkqY3Mr
KyA9IH5uc190b190aWNrcyhpOTE1LCBucyk7CisJKmNzKysgPSBhZGRyICsgNDAwMDsKKwkqY3Mr
KyA9IGFkZHIgPj4gMzI7CisKKwkvKiBPdGhlcndpc2UgYmFjayB0byByZWNhbGN1bGF0aW5nIGRl
bHRhICovCisJKmNzKysgPSBNSV9CQVRDSF9CVUZGRVJfU1RBUlQgfCAxIDw8IDggfCB1c2VfNjRi
OworCSpjcysrID0gYWRkciArIG9mZnNldF9pbl9wYWdlKGptcCk7CisJKmNzKysgPSBhZGRyID4+
IDMyOworCisJbXVubWFwKG1hcCwgNDA5Nik7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX2V4ZWNfb2JqZWN0MgorZGVsYXlfY3JlYXRlKGludCBpOTE1LCB1aW50MzJfdCBjdHgsCisJ
ICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2VuZ2luZTIgKmUsCisJICAgICB1aW50
NjRfdCB0YXJnZXRfbnMpCit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9leGVjX29iamVjdDIgb2Jq
ID0geworCQkuaGFuZGxlID0gYmF0Y2hfY3JlYXRlKGk5MTUpLAorCQkuZmxhZ3MgPSBFWEVDX09C
SkVDVF9TVVBQT1JUU180OEJfQUREUkVTUywKKwl9OworCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhl
Y2J1ZmZlcjIgZXhlY2J1ZiA9IHsKKwkJLmJ1ZmZlcnNfcHRyID0gdG9fdXNlcl9wb2ludGVyKCZv
YmopLAorCQkuYnVmZmVyX2NvdW50ID0gMSwKKwkJLnJzdmQxID0gY3R4LAorCQkuZmxhZ3MgPSBl
LT5mbGFncywKKwl9OworCisJb2JqLm9mZnNldCA9IG9iai5oYW5kbGUgPDwgMTI7CisJZ2VtX2V4
ZWNidWYoaTkxNSwgJmV4ZWNidWYpOworCWdlbV9zeW5jKGk5MTUsIG9iai5oYW5kbGUpOworCisJ
ZGVsYXkoaTkxNSwgZSwgb2JqLmhhbmRsZSwgb2JqLm9mZnNldCwgdGFyZ2V0X25zKTsKKworCW9i
ai5mbGFncyB8PSBFWEVDX09CSkVDVF9QSU5ORUQ7CisJcmV0dXJuIG9iajsKK30KKworc3RhdGlj
IHZvaWQgdHNsb2coaW50IGk5MTUsCisJCSAgY29uc3Qgc3RydWN0IGludGVsX2V4ZWN1dGlvbl9l
bmdpbmUyICplLAorCQkgIHVpbnQzMl90IGhhbmRsZSwKKwkJICB1aW50NjRfdCBhZGRyKQorewor
CWNvbnN0IGludCB1c2VfNjRiID0gaW50ZWxfZ2VuKGludGVsX2dldF9kcm1fZGV2aWQoaTkxNSkp
ID49IDg7CisJY29uc3QgdWludDMyX3QgYmFzZSA9IGdlbV9lbmdpbmVfbW1pb19iYXNlKGk5MTUs
IGUtPm5hbWUpOworI2RlZmluZSBDU19HUFIoeCkgKGJhc2UgKyAweDYwMCArIDggKiAoeCkpCisj
ZGVmaW5lIENTX1RJTUVTVEFNUCAoYmFzZSArIDB4MzU4KQorCWVudW0geyBJTkMsIE1BU0ssIEFE
RFIgfTsKKwl1aW50MzJfdCAqdGltZXN0YW1wX2xvLCAqYWRkcl9sbzsKKwl1aW50MzJfdCAqbWFw
LCAqY3M7CisKKwlpZ3RfcmVxdWlyZShiYXNlKTsKKworCW1hcCA9IGdlbV9tbWFwX19kZXZpY2Vf
Y29oZXJlbnQoaTkxNSwgaGFuZGxlLCAwLCA0MDk2LCBQUk9UX1dSSVRFKTsKKwljcyA9IG1hcCAr
IDUxMjsKKworCS8qIFJlY29yZCB0aGUgY3VycmVudCBDU19USU1FU1RBTVAgaW50byBhIGpvdXJu
YWwgW2EgNTEyIHNsb3QgcmluZ10uICovCisJKmNzKysgPSAweDI0IDw8IDIzIHwgKDEgKyB1c2Vf
NjRiKTsgLyogU1JNICovCisJKmNzKysgPSBDU19USU1FU1RBTVA7CisJdGltZXN0YW1wX2xvID0g
Y3M7CisJKmNzKysgPSBhZGRyOworCSpjcysrID0gYWRkciA+PiAzMjsKKworCS8qIExvYWQgdGhl
IGFkZHJlc3MgKyBpbmMgJiBtYXNrIHZhcmlhYmxlcyAqLworCSpjcysrID0gTUlfTE9BRF9SRUdJ
U1RFUl9JTU07CisJKmNzKysgPSBDU19HUFIoQUREUik7CisJYWRkcl9sbyA9IGNzOworCSpjcysr
ID0gYWRkcjsKKwkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJfSU1NOworCSpjcysrID0gQ1NfR1BS
KEFERFIpICsgNDsKKwkqY3MrKyA9IGFkZHIgPj4gMzI7CisKKwkqY3MrKyA9IE1JX0xPQURfUkVH
SVNURVJfSU1NOworCSpjcysrID0gQ1NfR1BSKElOQyk7CisJKmNzKysgPSA0OworCSpjcysrID0g
TUlfTE9BRF9SRUdJU1RFUl9JTU07CisJKmNzKysgPSBDU19HUFIoSU5DKSArIDQ7CisJKmNzKysg
PSAwOworCisJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX0lNTTsKKwkqY3MrKyA9IENTX0dQUihN
QVNLKTsKKwkqY3MrKyA9IDB4ZmZmZmY3ZmY7CisJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX0lN
TTsKKwkqY3MrKyA9IENTX0dQUihNQVNLKSArIDQ7CisJKmNzKysgPSAweGZmZmZmZmZmOworCisJ
LyogSW5jcmVtZW50IHRoZSBbcmluZ10gYWRkcmVzcyBmb3Igc2F2aW5nIENTX1RJTUVTVEFNUCAq
LworCSpjcysrID0gTUlfTUFUSCg4KTsKKwkqY3MrKyA9IE1JX01BVEhfTE9BRChNSV9NQVRIX1JF
R19TUkNBLCBNSV9NQVRIX1JFRyhJTkMpKTsKKwkqY3MrKyA9IE1JX01BVEhfTE9BRChNSV9NQVRI
X1JFR19TUkNCLCBNSV9NQVRIX1JFRyhBRERSKSk7CisJKmNzKysgPSBNSV9NQVRIX0FERDsKKwkq
Y3MrKyA9IE1JX01BVEhfU1RPUkUoTUlfTUFUSF9SRUcoQUREUiksIE1JX01BVEhfUkVHX0FDQ1Up
OworCSpjcysrID0gTUlfTUFUSF9MT0FEKE1JX01BVEhfUkVHX1NSQ0EsIE1JX01BVEhfUkVHKEFE
RFIpKTsKKwkqY3MrKyA9IE1JX01BVEhfTE9BRChNSV9NQVRIX1JFR19TUkNCLCBNSV9NQVRIX1JF
RyhNQVNLKSk7CisJKmNzKysgPSBNSV9NQVRIX0FORDsKKwkqY3MrKyA9IE1JX01BVEhfU1RPUkUo
TUlfTUFUSF9SRUcoQUREUiksIE1JX01BVEhfUkVHX0FDQ1UpOworCisJLyogUmV3cml0ZSB0aGUg
YmF0Y2ggYnVmZmVyIGZvciB0aGUgbmV4dCBleGVjdXRpb24gKi8KKwkqY3MrKyA9IDB4MjQgPDwg
MjMgfCAoMSArIHVzZV82NGIpOyAvKiBTUk0gKi8KKwkqY3MrKyA9IENTX0dQUihBRERSKTsKKwkq
Y3MrKyA9IGFkZHIgKyBvZmZzZXRfaW5fcGFnZSh0aW1lc3RhbXBfbG8pOworCSpjcysrID0gYWRk
ciA+PiAzMjsKKwkqY3MrKyA9IDB4MjQgPDwgMjMgfCAoMSArIHVzZV82NGIpOyAvKiBTUk0gKi8K
KwkqY3MrKyA9IENTX0dQUihBRERSKTsKKwkqY3MrKyA9IGFkZHIgKyBvZmZzZXRfaW5fcGFnZShh
ZGRyX2xvKTsKKwkqY3MrKyA9IGFkZHIgPj4gMzI7CisKKwkqY3MrKyA9IE1JX0JBVENIX0JVRkZF
Ul9FTkQ7CisKKwltdW5tYXAobWFwLCA0MDk2KTsKK30KKworc3RhdGljIHN0cnVjdCBkcm1faTkx
NV9nZW1fZXhlY19vYmplY3QyCit0c2xvZ19jcmVhdGUoaW50IGk5MTUsIHVpbnQzMl90IGN0eCwg
Y29uc3Qgc3RydWN0IGludGVsX2V4ZWN1dGlvbl9lbmdpbmUyICplKQoreworCXN0cnVjdCBkcm1f
aTkxNV9nZW1fZXhlY19vYmplY3QyIG9iaiA9IHsKKwkJLmhhbmRsZSA9IGJhdGNoX2NyZWF0ZShp
OTE1KSwKKwkJLmZsYWdzID0gRVhFQ19PQkpFQ1RfU1VQUE9SVFNfNDhCX0FERFJFU1MsCisJfTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyIGV4ZWNidWYgPSB7CisJCS5idWZmZXJz
X3B0ciA9IHRvX3VzZXJfcG9pbnRlcigmb2JqKSwKKwkJLmJ1ZmZlcl9jb3VudCA9IDEsCisJCS5y
c3ZkMSA9IGN0eCwKKwkJLmZsYWdzID0gZS0+ZmxhZ3MsCisJfTsKKworCW9iai5vZmZzZXQgPSBv
YmouaGFuZGxlIDw8IDEyOworCWdlbV9leGVjYnVmKGk5MTUsICZleGVjYnVmKTsKKwlnZW1fc3lu
YyhpOTE1LCBvYmouaGFuZGxlKTsKKworCXRzbG9nKGk5MTUsIGUsIG9iai5oYW5kbGUsIG9iai5v
ZmZzZXQpOworCisJb2JqLmZsYWdzIHw9IEVYRUNfT0JKRUNUX1BJTk5FRDsKKwlyZXR1cm4gb2Jq
OworfQorCitzdGF0aWMgaW50IGNtcF91MzIoY29uc3Qgdm9pZCAqQSwgY29uc3Qgdm9pZCAqQikK
K3sKKwljb25zdCB1aW50MzJfdCAqYSA9IEEsICpiID0gQjsKKworCWlmICgqYSA8ICpiKQorCQly
ZXR1cm4gLTE7CisJZWxzZSBpZiAoKmEgPiAqYikKKwkJcmV0dXJuIDE7CisJZWxzZQorCQlyZXR1
cm4gMDsKK30KKworc3RhdGljIHN0cnVjdCBpbnRlbF9leGVjdXRpb25fZW5naW5lMgorcGlja19y
YW5kb21fZW5naW5lKGludCBpOTE1LCBjb25zdCBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2VuZ2lu
ZTIgKm5vdCkKK3sKKwljb25zdCBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2VuZ2luZTIgKmU7CisJ
dW5zaWduZWQgaW50IGNvdW50ID0gMDsKKworCV9fZm9yX2VhY2hfcGh5c2ljYWxfZW5naW5lKGk5
MTUsIGUpIHsKKwkJaWYgKGUtPmZsYWdzID09IG5vdC0+ZmxhZ3MpCisJCQljb250aW51ZTsKKwkJ
aWYgKCFnZW1fY2xhc3NfaGFzX211dGFibGVfc3VibWlzc2lvbihpOTE1LCBlLT5jbGFzcykpCisJ
CQljb250aW51ZTsKKwkJY291bnQrKzsKKwl9CisJaWYgKCFjb3VudCkKKwkJcmV0dXJuICpub3Q7
CisKKwljb3VudCA9IHJhbmQoKSAlIGNvdW50OworCV9fZm9yX2VhY2hfcGh5c2ljYWxfZW5naW5l
KGk5MTUsIGUpIHsKKwkJaWYgKGUtPmZsYWdzID09IG5vdC0+ZmxhZ3MpCisJCQljb250aW51ZTsK
KwkJaWYgKCFnZW1fY2xhc3NfaGFzX211dGFibGVfc3VibWlzc2lvbihpOTE1LCBlLT5jbGFzcykp
CisJCQljb250aW51ZTsKKwkJaWYgKCFjb3VudC0tKQorCQkJYnJlYWs7CisJfQorCisJcmV0dXJu
ICplOworfQorCitzdGF0aWMgdm9pZCBmYWlyX2NoaWxkKGludCBpOTE1LCB1aW50MzJfdCBjdHgs
CisJCSAgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2VuZ2luZTIgKmUsCisJCSAg
ICAgICB1aW50NjRfdCBmcmFtZV9ucywKKwkJICAgICAgIGludCB0aW1lbGluZSwKKwkJICAgICAg
IHVpbnQzMl90IGNvbW1vbiwKKwkJICAgICAgIHVuc2lnbmVkIGludCBmbGFncywKKwkJICAgICAg
IHVuc2lnbmVkIGxvbmcgKmN0bCwKKwkJICAgICAgIHVuc2lnbmVkIGxvbmcgKm91dCkKKyNkZWZp
bmUgRl9TWU5DCQkoMSA8PCAwKQorI2RlZmluZSBGX1BBQ0UJCSgxIDw8IDEpCisjZGVmaW5lIEZf
RkxPVwkJKDEgPDwgMikKKyNkZWZpbmUgRl9IQUxGCQkoMSA8PCAzKQorI2RlZmluZSBGX1NPTE8J
CSgxIDw8IDQpCisjZGVmaW5lIEZfU1BBUkUJCSgxIDw8IDUpCisjZGVmaW5lIEZfTkVYVAkJKDEg
PDwgNikKKyNkZWZpbmUgRl9WSVAJCSgxIDw8IDcpCisjZGVmaW5lIEZfUlJVTAkJKDEgPDwgOCkK
KyNkZWZpbmUgRl9TSEFSRQkJKDEgPDwgOSkKKyNkZWZpbmUgRl9QSU5HCQkoMSA8PCAxMCkKKyNk
ZWZpbmUgRl9USFJPVFRMRQkoMSA8PCAxMSkKKyNkZWZpbmUgRl9JU09MQVRFCSgxIDw8IDEyKQor
eworCWNvbnN0IGludCBiYXRjaGVzX3Blcl9mcmFtZSA9IGZsYWdzICYgRl9TT0xPID8gMSA6IDM7
CisJc3RydWN0IGRybV9pOTE1X2dlbV9leGVjX29iamVjdDIgb2JqWzRdID0geworCQl7fSwKKwkJ
eworCQkJLmhhbmRsZSA9IGNvbW1vbiA/OiBnZW1fY3JlYXRlKGk5MTUsIDQwOTYpLAorCQl9LAor
CQlkZWxheV9jcmVhdGUoaTkxNSwgY3R4LCBlLCBmcmFtZV9ucyAvIGJhdGNoZXNfcGVyX2ZyYW1l
KSwKKwkJZGVsYXlfY3JlYXRlKGk5MTUsIGN0eCwgZSwgZnJhbWVfbnMgLyBiYXRjaGVzX3Blcl9m
cmFtZSksCisJfTsKKwlzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2VuZ2luZTIgcGluZyA9ICplOwor
CWludCBwX2ZlbmNlID0gLTEsIG5fZmVuY2UgPSAtMTsKKwl1bnNpZ25lZCBsb25nIGNvdW50ID0g
MDsKKwlpbnQgbjsKKworCXNyYW5kb20oZ2V0cGlkKCkpOworCWlmIChmbGFncyAmIEZfUElORykK
KwkJcGluZyA9IHBpY2tfcmFuZG9tX2VuZ2luZShpOTE1LCBlKTsKKwlvYmpbMF0gPSB0c2xvZ19j
cmVhdGUoaTkxNSwgY3R4LCAmcGluZyk7CisKKwl3aGlsZSAoIVJFQURfT05DRSgqY3RsKSkgewor
CQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyIGV4ZWNidWYgPSB7CisJCQkuYnVmZmVy
c19wdHIgPSB0b191c2VyX3BvaW50ZXIob2JqKSwKKwkJCS5idWZmZXJfY291bnQgPSA0LAorCQkJ
LnJzdmQxID0gY3R4LAorCQkJLnJzdmQyID0gLTEsCisJCQkuZmxhZ3MgPSBlLT5mbGFncywKKwkJ
fTsKKworCQlpZiAoZmxhZ3MgJiBGX0ZMT1cpIHsKKwkJCXVuc2lnbmVkIGludCBzZXE7CisKKwkJ
CXNlcSA9IGNvdW50OworCQkJaWYgKGZsYWdzICYgRl9ORVhUKQorCQkJCXNlcSsrOworCisJCQll
eGVjYnVmLnJzdmQyID0KKwkJCQlzd19zeW5jX3RpbWVsaW5lX2NyZWF0ZV9mZW5jZSh0aW1lbGlu
ZSwgc2VxKTsKKwkJCWV4ZWNidWYuZmxhZ3MgfD0gSTkxNV9FWEVDX0ZFTkNFX0lOOworCQl9CisK
KwkJZXhlY2J1Zi5mbGFncyB8PSBJOTE1X0VYRUNfRkVOQ0VfT1VUOworCQlnZW1fZXhlY2J1Zl93
cihpOTE1LCAmZXhlY2J1Zik7CisJCW5fZmVuY2UgPSBleGVjYnVmLnJzdmQyID4+IDMyOworCQll
eGVjYnVmLmZsYWdzICY9IH4oSTkxNV9FWEVDX0ZFTkNFX09VVCB8IEk5MTVfRVhFQ19GRU5DRV9J
Tik7CisJCWZvciAobiA9IDE7IG4gPCBiYXRjaGVzX3Blcl9mcmFtZTsgbisrKQorCQkJZ2VtX2V4
ZWNidWYoaTkxNSwgJmV4ZWNidWYpOworCQljbG9zZShleGVjYnVmLnJzdmQyKTsKKworCQlleGVj
YnVmLmJ1ZmZlcl9jb3VudCA9IDE7CisJCWV4ZWNidWYuYmF0Y2hfc3RhcnRfb2Zmc2V0ID0gMjA0
ODsKKwkJZXhlY2J1Zi5mbGFncyA9IHBpbmcuZmxhZ3MgfCBJOTE1X0VYRUNfRkVOQ0VfSU47CisJ
CWV4ZWNidWYucnN2ZDIgPSBuX2ZlbmNlOworCQlnZW1fZXhlY2J1ZihpOTE1LCAmZXhlY2J1Zik7
CisKKwkJaWYgKGZsYWdzICYgRl9QQUNFICYmIHBfZmVuY2UgIT0gLTEpIHsKKwkJCXN0cnVjdCBw
b2xsZmQgcGZkID0geworCQkJCS5mZCA9IHBfZmVuY2UsCisJCQkJLmV2ZW50cyA9IFBPTExJTiwK
KwkJCX07CisJCQlwb2xsKCZwZmQsIDEsIC0xKTsKKwkJfQorCQljbG9zZShwX2ZlbmNlKTsKKwor
CQlpZiAoZmxhZ3MgJiBGX1NZTkMpIHsKKwkJCXN0cnVjdCBwb2xsZmQgcGZkID0geworCQkJCS5m
ZCA9IG5fZmVuY2UsCisJCQkJLmV2ZW50cyA9IFBPTExJTiwKKwkJCX07CisJCQlwb2xsKCZwZmQs
IDEsIC0xKTsKKwkJfQorCisJCWlmIChmbGFncyAmIEZfVEhST1RUTEUpCisJCQlpZ3RfaW9jdGwo
aTkxNSwgRFJNX0lPQ1RMX0k5MTVfR0VNX1RIUk9UVExFLCAwKTsKKworCQlpZ3Rfc3dhcChvYmpb
Ml0sIG9ialszXSk7CisJCWlndF9zd2FwKHBfZmVuY2UsIG5fZmVuY2UpOworCQljb3VudCsrOwor
CX0KKwljbG9zZShwX2ZlbmNlKTsKKworCWdlbV9jbG9zZShpOTE1LCBvYmpbM10uaGFuZGxlKTsK
KwlnZW1fY2xvc2UoaTkxNSwgb2JqWzJdLmhhbmRsZSk7CisJaWYgKG9ialsxXS5oYW5kbGUgIT0g
Y29tbW9uKQorCQlnZW1fY2xvc2UoaTkxNSwgb2JqWzFdLmhhbmRsZSk7CisKKwlnZW1fc3luYyhp
OTE1LCBvYmpbMF0uaGFuZGxlKTsKKwlpZiAob3V0KSB7CisJCXVpbnQzMl90ICptYXA7CisKKwkJ
bWFwID0gZ2VtX21tYXBfX2RldmljZV9jb2hlcmVudChpOTE1LCBvYmpbMF0uaGFuZGxlLAorCQkJ
CQkJMCwgNDA5NiwgUFJPVF9XUklURSk7CisJCWZvciAobiA9IDE7IG4gPCBtaW4oY291bnQsIDUx
Mik7IG4rKykgeworCQkJaWd0X2Fzc2VydChtYXBbbl0pOworCQkJbWFwW24gLSAxXSA9IG1hcFtu
XSAtIG1hcFtuIC0gMV07CisJCX0KKwkJcXNvcnQobWFwLCAtLW4sIHNpemVvZigqbWFwKSwgY21w
X3UzMik7CisJCSpvdXQgPSB0aWNrc190b19ucyhpOTE1LCBtYXBbbiAvIDJdKTsKKwkJbXVubWFw
KG1hcCwgNDA5Nik7CisJfQorCWdlbV9jbG9zZShpOTE1LCBvYmpbMF0uaGFuZGxlKTsKK30KKwor
c3RhdGljIGludCBjbXBfdWwoY29uc3Qgdm9pZCAqQSwgY29uc3Qgdm9pZCAqQikKK3sKKwljb25z
dCB1bnNpZ25lZCBsb25nICphID0gQSwgKmIgPSBCOworCisJaWYgKCphIDwgKmIpCisJCXJldHVy
biAtMTsKKwllbHNlIGlmICgqYSA+ICpiKQorCQlyZXR1cm4gMTsKKwllbHNlCisJCXJldHVybiAw
OworfQorCitzdGF0aWMgdWludDY0X3QgZF9jcHVfdGltZShjb25zdCBzdHJ1Y3QgcnVzYWdlICph
LCBjb25zdCBzdHJ1Y3QgcnVzYWdlICpiKQoreworCXVpbnQ2NF90IGNwdV90aW1lID0gMDsKKwor
CWNwdV90aW1lICs9IChhLT5ydV91dGltZS50dl9zZWMgLSBiLT5ydV91dGltZS50dl9zZWMpICog
TlNFQ19QRVJfU0VDOworCWNwdV90aW1lICs9IChhLT5ydV91dGltZS50dl91c2VjIC0gYi0+cnVf
dXRpbWUudHZfdXNlYykgKiAxMDAwOworCisJY3B1X3RpbWUgKz0gKGEtPnJ1X3N0aW1lLnR2X3Nl
YyAtIGItPnJ1X3N0aW1lLnR2X3NlYykgKiBOU0VDX1BFUl9TRUM7CisJY3B1X3RpbWUgKz0gKGEt
PnJ1X3N0aW1lLnR2X3VzZWMgLSBiLT5ydV9zdGltZS50dl91c2VjKSAqIDEwMDA7CisKKwlyZXR1
cm4gY3B1X3RpbWU7Cit9CisKK3N0YXRpYyB2b2lkIHRpbWVsaW5lX2FkdmFuY2UoaW50IHRpbWVs
aW5lLCBpbnQgZGVsYXlfbnMpCit7CisJc3RydWN0IHRpbWVzcGVjIHR2ID0geyAudHZfbnNlYyA9
IGRlbGF5X25zIH07CisJbmFub3NsZWVwKCZ0diwgTlVMTCk7CisJc3dfc3luY190aW1lbGluZV9p
bmModGltZWxpbmUsIDEpOworfQorCitzdGF0aWMgdm9pZCBmYWlybmVzcyhpbnQgaTkxNSwKKwkJ
ICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2VuZ2luZTIgKmUsCisJCSAgICAgaW50
IHRpbWVvdXQsIHVuc2lnbmVkIGludCBmbGFncykKK3sKKwljb25zdCBpbnQgZnJhbWVfbnMgPSAx
NjY2NiAqIDEwMDA7CisJY29uc3QgaW50IGZlbmNlX25zID0gZmxhZ3MgJiBGX0hBTEYgPyAyICog
ZnJhbWVfbnMgOiBmcmFtZV9uczsKKwl1bnNpZ25lZCBsb25nICpyZXN1bHQ7CisJdWludDMyX3Qg
Y29tbW9uID0gMDsKKworCWlndF9yZXF1aXJlKGdlbV9jbGFzc19oYXNfbXV0YWJsZV9zdWJtaXNz
aW9uKGk5MTUsIGUtPmNsYXNzKSk7CisKKwlpZiAoZmxhZ3MgJiBGX1NIQVJFKQorCQljb21tb24g
PSBnZW1fY3JlYXRlKGk5MTUsIDQwOTUpOworCisJcmVzdWx0ID0gbW1hcChOVUxMLCA0MDk2LCBQ
Uk9UX1dSSVRFLCBNQVBfU0hBUkVEIHwgTUFQX0FOT04sIC0xLCAwKTsKKworCWZvciAoaW50IG4g
PSAyOyBuIDw9IDY0OyBuIDw8PSAxKSB7IC8qIDMyID09IDUwMHVzIHBlciBjbGllbnQgKi8KKwkJ
aW50IHRpbWVsaW5lID0gc3dfc3luY190aW1lbGluZV9jcmVhdGUoKTsKKwkJaW50IG5mZW5jZXMg
PSB0aW1lb3V0ICogTlNFQ19QRVJfU0VDIC8gZmVuY2VfbnMgKyAxOworCQljb25zdCBpbnQgbmNo
aWxkID0gbiAtIDE7IC8qIG9kZCBmb3IgZWFzeSBtZWRpYW5zICovCisJCWNvbnN0IGludCBjaGls
ZF9ucyA9IGZyYW1lX25zIC8gKG5jaGlsZCArICEhKGZsYWdzICYgRl9TUEFSRSkpOworCQljb25z
dCBpbnQgbG8gPSBuY2hpbGQgLyA0OworCQljb25zdCBpbnQgaGkgPSAoMyAqIG5jaGlsZCArIDMp
IC8gNCAtIDE7CisJCXN0cnVjdCBydXNhZ2Ugb2xkX3VzYWdlLCB1c2FnZTsKKwkJdWludDY0X3Qg
Y3B1X3RpbWUsIGRfdGltZTsKKwkJdW5zaWduZWQgbG9uZyB2aXAgPSAtMTsKKwkJc3RydWN0IHRp
bWVzcGVjIHR2OworCQlzdHJ1Y3QgaWd0X21lYW4gbTsKKworCQlpZiAoZmxhZ3MgJiBGX1BJTkcp
IHsKKwkJCXN0cnVjdCBpbnRlbF9leGVjdXRpb25fZW5naW5lMiAqcGluZzsKKworCQkJX19mb3Jf
ZWFjaF9waHlzaWNhbF9lbmdpbmUoaTkxNSwgcGluZykgeworCQkJCWlmIChwaW5nLT5mbGFncyA9
PSBlLT5mbGFncykKKwkJCQkJY29udGludWU7CisKKwkJCQlpZ3RfZm9yayhjaGlsZCwgMSkgewor
CQkJCQl1aW50MzJfdCBjdHggPSBnZW1fY29udGV4dF9jbG9uZV93aXRoX2VuZ2luZXMoaTkxNSwg
MCk7CisKKwkJCQkJZmFpcl9jaGlsZChpOTE1LCBjdHgsIHBpbmcsCisJCQkJCQkgICBjaGlsZF9u
cyAvIDgsCisJCQkJCQkgICAtMSwgY29tbW9uLAorCQkJCQkJICAgRl9TT0xPIHwgRl9QQUNFIHwg
Rl9TSEFSRSwKKwkJCQkJCSAgICZyZXN1bHRbbmNoaWxkXSwKKwkJCQkJCSAgIE5VTEwpOworCisJ
CQkJCWdlbV9jb250ZXh0X2Rlc3Ryb3koaTkxNSwgY3R4KTsKKwkJCQl9CisJCQl9CisJCX0KKwor
CQltZW1zZXQocmVzdWx0LCAwLCAobmNoaWxkICsgMSkgKiBzaXplb2YocmVzdWx0WzBdKSk7CisJ
CWdldHJ1c2FnZShSVVNBR0VfQ0hJTERSRU4sICZvbGRfdXNhZ2UpOworCQlpZ3RfbnNlY19lbGFw
c2VkKG1lbXNldCgmdHYsIDAsIHNpemVvZih0dikpKTsKKwkJaWd0X2ZvcmsoY2hpbGQsIG5jaGls
ZCkgeworCQkJdWludDMyX3QgY3R4OworCisJCQlpZiAoZmxhZ3MgJiBGX0lTT0xBVEUpIHsKKwkJ
CQlpbnQgY2xvbmUsIGRtYWJ1ZiA9IC0xOworCisJCQkJaWYgKGNvbW1vbikKKwkJCQkJZG1hYnVm
ID0gcHJpbWVfaGFuZGxlX3RvX2ZkKGk5MTUsIGNvbW1vbik7CisKKwkJCQljbG9uZSA9IGdlbV9y
ZW9wZW5fZHJpdmVyKGk5MTUpOworCQkJCWdlbV9jb250ZXh0X2NvcHlfZW5naW5lcyhpOTE1LCAw
LCBjbG9uZSwgMCk7CisJCQkJaTkxNSA9IGNsb25lOworCisJCQkJaWYgKGRtYWJ1ZiAhPSAtMSkK
KwkJCQkJY29tbW9uID0gcHJpbWVfZmRfdG9faGFuZGxlKGk5MTUsIGRtYWJ1Zik7CisJCQl9CisK
KwkJCWN0eCA9IGdlbV9jb250ZXh0X2Nsb25lX3dpdGhfZW5naW5lcyhpOTE1LCAwKTsKKworCQkJ
aWYgKGZsYWdzICYgRl9WSVAgJiYgY2hpbGQgPT0gMCkgeworCQkJCWdlbV9jb250ZXh0X3NldF9w
cmlvcml0eShpOTE1LCBjdHgsIE1BWF9QUklPKTsKKwkJCQlmbGFncyB8PSBGX0ZMT1c7CisJCQl9
CisJCQlpZiAoZmxhZ3MgJiBGX1JSVUwgJiYgY2hpbGQgPT0gMCkKKwkJCQlmbGFncyB8PSBGX1NP
TE8gfCBGX0ZMT1cgfCBGX1NZTkM7CisKKwkJCWZhaXJfY2hpbGQoaTkxNSwgY3R4LCBlLCBjaGls
ZF9ucywKKwkJCQkgICB0aW1lbGluZSwgY29tbW9uLCBmbGFncywKKwkJCQkgICAmcmVzdWx0W25j
aGlsZF0sCisJCQkJICAgJnJlc3VsdFtjaGlsZF0pOworCisJCQlnZW1fY29udGV4dF9kZXN0cm95
KGk5MTUsIGN0eCk7CisJCX0KKworCQl3aGlsZSAobmZlbmNlcy0tKQorCQkJdGltZWxpbmVfYWR2
YW5jZSh0aW1lbGluZSwgZmVuY2VfbnMpOworCisJCXJlc3VsdFtuY2hpbGRdID0gMTsKKwkJZm9y
IChpbnQgY2hpbGQgPSAwOyBjaGlsZCA8IG5jaGlsZDsgY2hpbGQrKykgeworCQkJd2hpbGUgKCFS
RUFEX09OQ0UocmVzdWx0W2NoaWxkXSkpCisJCQkJdGltZWxpbmVfYWR2YW5jZSh0aW1lbGluZSwg
ZmVuY2VfbnMpOworCQl9CisKKwkJaWd0X3dhaXRjaGlsZHJlbigpOworCQljbG9zZSh0aW1lbGlu
ZSk7CisKKwkJLyogQXJlIHdlIHJ1bm5pbmcgb3V0IG9mIENQVSB0aW1lLCBhbmQgZmFpbCB0byBz
dWJtaXQgZnJhbWVzPyAqLworCQlkX3RpbWUgPSBpZ3RfbnNlY19lbGFwc2VkKCZ0dik7CisJCWdl
dHJ1c2FnZShSVVNBR0VfQ0hJTERSRU4sICZ1c2FnZSk7CisJCWNwdV90aW1lID0gZF9jcHVfdGlt
ZSgmdXNhZ2UsICZvbGRfdXNhZ2UpOworCQlpZiAoMTAgKiBjcHVfdGltZSA+IDkgKiBkX3RpbWUp
IHsKKwkJCWlmIChuY2hpbGQgPiA3KQorCQkJCWJyZWFrOworCisJCQlpZ3Rfc2tpcF9vbl9mKDEw
ICogY3B1X3RpbWUgPiA5ICogZF90aW1lLAorCQkJCSAgICAgICIlLjBmJSUgQ1BVIHVzYWdlLCBw
cmVzdW1pbmcgY2FwYWNpdHkgZXhjZWVkZWRcbiIsCisJCQkJICAgICAgMTAwLiAqIGNwdV90aW1l
IC8gZF90aW1lKTsKKwkJfQorCisJCWlndF9tZWFuX2luaXQoJm0pOworCQlmb3IgKGludCBjaGls
ZCA9IDA7IGNoaWxkIDwgbmNoaWxkOyBjaGlsZCsrKQorCQkJaWd0X21lYW5fYWRkKCZtLCByZXN1
bHRbY2hpbGRdKTsKKworCQlpZiAoZmxhZ3MgJiAoRl9WSVAgfCBGX1JSVUwpKQorCQkJdmlwID0g
cmVzdWx0WzBdOworCisJCXFzb3J0KHJlc3VsdCwgbmNoaWxkLCBzaXplb2YoKnJlc3VsdCksIGNt
cF91bCk7CisJCWlndF9pbmZvKCIlMmQgY2xpZW50cywgcmFuZ2U6IFslLjFmLCAlLjFmXSwgaXFy
OiBbJS4xZiwgJS4xZl0sIG1lZGlhbjogJS4xZiwgbWVhbjogJS4xZiDCsSAlLjJmIG1zXG4iLAor
CQkJIG5jaGlsZCwKKwkJCSAxZS02ICogcmVzdWx0WzBdLCAgMWUtNiAqIHJlc3VsdFtuY2hpbGQg
LSAxXSwKKwkJCSAxZS02ICogcmVzdWx0W2xvXSwgMWUtNiAqIHJlc3VsdFtoaV0sCisJCQkgMWUt
NiAqIHJlc3VsdFtuY2hpbGQgLyAyXSwKKwkJCSAxZS02ICogaWd0X21lYW5fZ2V0KCZtKSwKKwkJ
CSAxZS02ICogc3FydChpZ3RfbWVhbl9nZXRfdmFyaWFuY2UoJm0pKSk7CisKKwkJaWYgKHZpcCAh
PSAtMSkgeworCQkJaWd0X2luZm8oIlZJUCBpbnRlcnZhbCAlLjJmIG1zXG4iLCAxZS02ICogdmlw
KTsKKwkJCWlndF9hc3NlcnQoNCAqIHZpcCA+IDMgKiBmZW5jZV9ucyAmJgorCQkJCSAgIDMgKiB2
aXAgPCA0ICogZmVuY2VfbnMpOworCQl9CisKKwkJLyogTWF5IGJlIHNsb3dlZCBkdWUgdG8gc2hl
ZXIgdm9sdW1lIG9mIGNvbnRleHQgc3dpdGNoZXMgKi8KKwkJaWd0X2Fzc2VydCg0ICogaWd0X21l
YW5fZ2V0KCZtKSA+IDMgKiBmZW5jZV9ucyAmJgorCQkJICAgICAgIGlndF9tZWFuX2dldCgmbSkg
PCAzICogZmVuY2VfbnMpOworCisJCWlndF9hc3NlcnQoNCAqIGlndF9tZWFuX2dldCgmbSkgPiAz
ICogcmVzdWx0W25jaGlsZCAvIDJdICYmCisJCQkgICAzICogaWd0X21lYW5fZ2V0KCZtKSA8IDQg
KiByZXN1bHRbbmNoaWxkIC8gMl0pOworCisJCWlndF9hc3NlcnQoMiAqIChyZXN1bHRbaGldIC0g
cmVzdWx0W2xvXSkgPCByZXN1bHRbbmNoaWxkIC8gMl0pOworCX0KKworCW11bm1hcChyZXN1bHQs
IDQwOTYpOworCWlmIChjb21tb24pCisJCWdlbV9jbG9zZShpOTE1LCBjb21tb24pOworfQorCitz
dGF0aWMgdm9pZCB0ZXN0X2ZhaXJuZXNzKGludCBpOTE1LCBpbnQgdGltZW91dCkKK3sKKwlzdGF0
aWMgY29uc3Qgc3RydWN0IHsKKwkJY29uc3QgY2hhciAqbmFtZTsKKwkJdW5zaWduZWQgaW50IGZs
YWdzOworCX0gZmFpcltdID0geworCQkvKgorCQkgKiBub25lIC0gbWF4aW1hbCBncmVlZCBpbiBl
YWNoIGNsaWVudAorCQkgKgorCQkgKiBQdXNoIGFzIG1hbnkgZnJhbWVzIGZyb20gZWFjaCBjbGll
bnQgYXMgZmFzdCBhcyBwb3NzaWJsZQorCQkgKi8KKwkJeyAibm9uZSIsICAgICAgIDAgfSwKKwkJ
eyAibm9uZS12aXAiLCAgIEZfVklQIH0sIC8qIG9uZSB2aXAgY2xpZW50IG11c3QgbWVldCBkZWFk
bGluZXMgKi8KKwkJeyAibm9uZS1zb2xvIiwgIEZfU09MTyB9LCAvKiAxIGJhdGNoIHBlciBmcmFt
ZSBwZXIgY2xpZW50ICovCisJCXsgIm5vbmUtc2hhcmUiLCBGX1NIQVJFIH0sIC8qIHJlYWQgZnJv
bSBhIGNvbW1vbiBidWZmZXIgKi8KKwkJeyAibm9uZS1ycnVsIiwgIEZfUlJVTCB9LCAvKiAicmVh
bHRpbWUtcmVzcG9uc2UgdW5kZXIgbG9hZCIgKi8KKwkJeyAibm9uZS1waW5nIiwgIEZfUElORyB9
LCAvKiBtZWFzdXJlIGludGVyLWVuZ2luZSBmYWlybmVzcyAqLworCisJCS8qCisJCSAqIHRocm90
dGxlIC0gb3JpZ2luYWwgcGVyIGNsaWVudCB0aHJvdHRsaW5nCisJCSAqCisJCSAqIFVzZWQgZm9y
IGZyb250IGJ1ZmZlcmluZyByZW5kZXJpbmcgd2hlcmUgdGhlcmUgaXMgbm8KKwkJICogZXh0ZW5h
bCBmcmFtZSBtYXJrZXIuIEVhY2ggY2xpZW50IHRyaWVzIHRvIG9ubHkga2VlcAorCQkgKiAyMG1z
IG9mIHdvcmsgc3VibWl0dGVkLCB0aG91Z2ggdGhhdCBtZWFzdXJlbWVudCBpcworCQkgKiBmbGF3
ZWQuLi4KKwkJICoKKwkJICogVGhpcyBpcyB1c2VkIGJ5IFhvcnkgdG8gdHJ5IGFuZCBtYWludGFp
biBzb21lIHJlc2VtYmFsYW5jZQorCQkgKiBvZiBpbnB1dC9vdXRwdXQgY29uc2lzdGVuY3kgd2hl
biBiZWluZyBmZWVkIGEgY29udGludW91cworCQkgKiBzdHJlYW0gb2YgWDExIGRyYXcgcmVxdWVz
dHMgc3RyYWlnaHQgaW50byBzY2Fub3V0LCB3aGVyZQorCQkgKiB0aGUgY2xpZW50cyBtYXkgc3Vi
bWl0IHRoZSB3b3JrIGZhc3RlciB0aGFuIGNhbiBiZSBkcmF3bi4KKwkJICoKKwkJICogVGhyb3R0
bGluZyB0cmFja3MgcmVxdWVzdHMgcGVyLWZpbGUgKGFuZCBhc3N1bWVzIHRoYXQKKwkJICogYWxs
IHJlcXVlc3RzIGFyZSBpbiBzdWJtaXNzaW9uIG9yZGVyIGFjcm9zcyB0aGUgd2hvbGUgZmlsZSks
CisJCSAqIHNvIHdlIHNwbGl0IGVhY2ggY2hpbGQgdG8gaXRzIG93biBmZC4KKwkJICovCisJCXsg
InRocm90dGxlIiwgICAgICAgRl9USFJPVFRMRSB8IEZfSVNPTEFURSB9LAorCQl7ICJ0aHJvdHRs
ZS12aXAiLCAgIEZfVEhST1RUTEUgfCBGX0lTT0xBVEUgfCBGX1ZJUCB9LAorCQl7ICJ0aHJvdHRs
ZS1zb2xvIiwgIEZfVEhST1RUTEUgfCBGX0lTT0xBVEUgfCBGX1NPTE8gfSwKKwkJeyAidGhyb3R0
bGUtc2hhcmUiLCBGX1RIUk9UVExFIHwgRl9JU09MQVRFIHwgRl9TSEFSRSB9LAorCQl7ICJ0aHJv
dHRsZS1ycnVsIiwgIEZfVEhST1RUTEUgfCBGX0lTT0xBVEUgfCBGX1JSVUwgfSwKKworCQkvKgor
CQkgKiBwYWNlIC0gbWVzYSAic3VibWl0IGRvdWJsZSBidWZmZXJpbmciCisJCSAqCisJCSAqIFN1
Ym1pdCBhIGZyYW1lLCB3YWl0IGZvciBwcmV2aW91cyBmcmFtZSB0byBzdGFydC4gVGhpcworCQkg
KiBwcmV2ZW50cyBlYWNoIGNsaWVudCBmcm9tIGdldHRpbmcgdG9vIGZhciBhaGVhZCBvZiBpdHMK
KwkJICogcmVuZGVyaW5nLCBtYWludGFpbmluZyBhIGNvbnNpc3RlbnQgaW5wdXQvb3V0cHV0IGxh
dGVuY3kuCisJCSAqLworCQl7ICJwYWNlIiwgICAgICAgRl9QQUNFIH0sCisJCXsgInBhY2Utc29s
byIsICBGX1BBQ0UgfCBGX1NPTE99LAorCQl7ICJwYWNlLXNoYXJlIiwgRl9QQUNFIHwgRl9TSEFS
RX0sCisJCXsgInBhY2UtcGluZyIsICBGX1BBQ0UgfCBGX1NIQVJFIHwgRl9QSU5HfSwKKworCQkv
KiBzeW5jIC0gb25seSBzdWJtaXQgYSBmcmFtZSBhdCBhIHRpbWUgKi8KKwkJeyAic3luYyIsICAg
ICAgRl9TWU5DIH0sCisJCXsgInN5bmMtdmlwIiwgIEZfU1lOQyB8IEZfVklQIH0sCisJCXsgInN5
bmMtc29sbyIsIEZfU1lOQyB8IEZfU09MTyB9LAorCisJCS8qIGZsb3cgLSBzeW5jaHJvbmlzZSBl
eGVjdXRpb24gYWdhaW5zdCB0aGUgY2xvY2sgKHZibGFuaykgKi8KKwkJeyAiZmxvdyIsICAgICAg
IEZfUEFDRSB8IEZfRkxPVyB9LAorCQl7ICJmbG93LXNoYXJlIiwgRl9QQUNFIHwgRl9GTE9XIHwg
Rl9TSEFSRSB9LAorCQl7ICJmbG93LXBpbmciLCAgRl9QQUNFIHwgRl9GTE9XIHwgRl9TSEFSRSB8
IEZfUElORyB9LAorCisJCS8qIG5leHQgLSBzdWJtaXQgYWhlYWQgb2YgdGhlIGNsb2NrICh2Ymxh
bmsgZG91YmxlIGJ1ZmZlcmluZykgKi8KKwkJeyAibmV4dCIsICAgICAgIEZfUEFDRSB8IEZfRkxP
VyB8IEZfTkVYVCB9LAorCQl7ICJuZXh0LXNoYXJlIiwgRl9QQUNFIHwgRl9GTE9XIHwgRl9ORVhU
IHwgRl9TSEFSRSB9LAorCQl7ICJuZXh0LXBpbmciLCAgRl9QQUNFIHwgRl9GTE9XIHwgRl9ORVhU
IHwgRl9TSEFSRSB8IEZfUElORyB9LAorCisJCS8qIHNwYXJlIC0gdW5kZXJ1dGlsaXNlIGJ5IGEg
c2luZ2xlIGNsaWVudCB0aW1lc2xpY2UgKi8KKwkJeyAic3BhcmUiLCBGX1BBQ0UgfCBGX0ZMT1cg
fCBGX1NQQVJFIH0sCisKKwkJLyogaGFsZiAtIHJ1biBhdCBoYWxmIHBhY2UgKHN1Ym1pdCAxNm1z
IG9mIHdvcmsgZXZlcnkgMzJtcykgKi8KKwkJeyAiaGFsZiIsICBGX1BBQ0UgfCBGX0ZMT1cgfCBG
X0hBTEYgfSwKKworCQl7fQorCX07CisKKwlmb3IgKHR5cGVvZigqZmFpcikgKmYgPSBmYWlyOyBm
LT5uYW1lOyBmKyspIHsKKwkJaWd0X3N1YnRlc3Rfd2l0aF9keW5hbWljX2YoImZhaXItJXMiLCBm
LT5uYW1lKSAgeworCQkJY29uc3Qgc3RydWN0IGludGVsX2V4ZWN1dGlvbl9lbmdpbmUyICplOwor
CisJCQlpZ3RfcmVxdWlyZShpbnRlbF9nZW4oaW50ZWxfZ2V0X2RybV9kZXZpZChpOTE1KSkgPj0g
OCk7CisKKwkJCV9fZm9yX2VhY2hfcGh5c2ljYWxfZW5naW5lKGk5MTUsIGUpIHsKKwkJCQlpZiAo
IWdlbV9jbGFzc19jYW5fc3RvcmVfZHdvcmQoaTkxNSwgZS0+Y2xhc3MpKQorCQkJCQljb250aW51
ZTsKKworCQkJCWlndF9keW5hbWljX2YoIiVzIiwgZS0+bmFtZSkKKwkJCQkJZmFpcm5lc3MoaTkx
NSwgZSwgdGltZW91dCwgZi0+ZmxhZ3MpOworCQkJfQorCQl9CisJfQorfQorCitzdGF0aWMgdWlu
dDMyX3QgcmVhZF9jdHhfdGltZXN0YW1wKGludCBpOTE1LAorCQkJCSAgIHVpbnQzMl90IGN0eCwK
KwkJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2VuZ2luZTIgKmUpCit7CisJY29u
c3QgaW50IHVzZV82NGIgPSBpbnRlbF9nZW4oaW50ZWxfZ2V0X2RybV9kZXZpZChpOTE1KSkgPj0g
ODsKKwljb25zdCB1aW50MzJfdCBiYXNlID0gZ2VtX2VuZ2luZV9tbWlvX2Jhc2UoaTkxNSwgZS0+
bmFtZSk7CisJc3RydWN0IGRybV9pOTE1X2dlbV9yZWxvY2F0aW9uX2VudHJ5IHJlbG9jOworCXN0
cnVjdCBkcm1faTkxNV9nZW1fZXhlY19vYmplY3QyIG9iaiA9IHsKKwkJLmhhbmRsZSA9IGdlbV9j
cmVhdGUoaTkxNSwgNDA5NiksCisJCS5vZmZzZXQgPSAzMiA8PCAyMCwKKwkJLnJlbG9jc19wdHIg
PSB0b191c2VyX3BvaW50ZXIoJnJlbG9jKSwKKwkJLnJlbG9jYXRpb25fY291bnQgPSAxLAorCX07
CisJc3RydWN0IGRybV9pOTE1X2dlbV9leGVjYnVmZmVyMiBleGVjYnVmID0geworCQkuYnVmZmVy
c19wdHIgPSB0b191c2VyX3BvaW50ZXIoJm9iaiksCisJCS5idWZmZXJfY291bnQgPSAxLAorCQku
ZmxhZ3MgPSBlLT5mbGFncywKKwkJLnJzdmQxID0gY3R4LAorCX07CisjZGVmaW5lIFJVTlRJTUUg
KGJhc2UgKyAweDNhOCkKKwl1aW50MzJfdCAqbWFwLCAqY3M7CisJdWludDMyX3QgdHM7CisKKwlp
Z3RfcmVxdWlyZShiYXNlKTsKKworCWNzID0gbWFwID0gZ2VtX21tYXBfX2RldmljZV9jb2hlcmVu
dChpOTE1LCBvYmouaGFuZGxlLAorCQkJCQkgICAgIDAsIDQwOTYsIFBST1RfV1JJVEUpOworCisJ
KmNzKysgPSAweDI0IDw8IDIzIHwgKDEgKyB1c2VfNjRiKTsgLyogU1JNICovCisJKmNzKysgPSBS
VU5USU1FOworCW1lbXNldCgmcmVsb2MsIDAsIHNpemVvZihyZWxvYykpOworCXJlbG9jLnRhcmdl
dF9oYW5kbGUgPSBvYmouaGFuZGxlOworCXJlbG9jLnByZXN1bWVkX29mZnNldCA9IG9iai5vZmZz
ZXQ7CisJcmVsb2Mub2Zmc2V0ID0gb2Zmc2V0X2luX3BhZ2UoY3MpOworCXJlbG9jLmRlbHRhID0g
NDAwMDsKKwkqY3MrKyA9IG9iai5vZmZzZXQgKyA0MDAwOworCSpjcysrID0gb2JqLm9mZnNldCA+
PiAzMjsKKworCSpjcysrID0gTUlfQkFUQ0hfQlVGRkVSX0VORDsKKworCWdlbV9leGVjYnVmKGk5
MTUsICZleGVjYnVmKTsKKwlnZW1fc3luYyhpOTE1LCBvYmouaGFuZGxlKTsKKwlnZW1fY2xvc2Uo
aTkxNSwgb2JqLmhhbmRsZSk7CisKKwl0cyA9IG1hcFsxMDAwXTsKKwltdW5tYXAobWFwLCA0MDk2
KTsKKworCXJldHVybiB0czsKK30KKworc3RhdGljIHZvaWQgZmFpcnNsaWNlKGludCBpOTE1LCBj
b25zdCBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2VuZ2luZTIgKmUpCit7CisJaWd0X3NwaW5fdCAq
c3BpblszXTsKKwl1aW50MzJfdCBjdHhbM107CisJdWludDMyX3QgdHNbM107CisKKwlmb3IgKGlu
dCBpID0gMDsgaSA8IEFSUkFZX1NJWkUoY3R4KTsgaSsrKSB7CisJCWN0eFtpXSA9IGdlbV9jb250
ZXh0X2Nsb25lX3dpdGhfZW5naW5lcyhpOTE1LCAwKTsKKwkJc3BpbltpXSA9IGlndF9zcGluX25l
dyhpOTE1LCAuY3R4ID0gY3R4W2ldLCAuZW5naW5lID0gZS0+ZmxhZ3MpOworCX0KKworCXNsZWVw
KDIpOyAvKiBvdmVyIHRoZSBjb3Vyc2Ugb2YgbWFueSB0aW1lc2xpY2VzICovCisKKwlmb3IgKGlu
dCBpID0gMDsgaSA8IEFSUkFZX1NJWkUoY3R4KTsgaSsrKSB7CisJCWlndF9hc3NlcnQoZ2VtX2Jv
X2J1c3koaTkxNSwgc3BpbltpXS0+aGFuZGxlKSk7CisJCWlndF9zcGluX2VuZChzcGluW2ldKTsK
KworCQl0c1tpXSA9IHJlYWRfY3R4X3RpbWVzdGFtcChpOTE1LCBjdHhbaV0sIGUpOworCX0KKwor
CWZvciAoaW50IGkgPSAwOyBpIDwgQVJSQVlfU0laRShjdHgpOyBpKyspIHsKKwkJaWd0X3NwaW5f
ZnJlZShpOTE1LCBzcGluW2ldKTsKKwkJZ2VtX2NvbnRleHRfZGVzdHJveShpOTE1LCBjdHhbaV0p
OworCX0KKworCXFzb3J0KHRzLCAzLCBzaXplb2YoKnRzKSwgY21wX3UzMik7CisJaWd0X2luZm8o
IiVzOiBbJS4xZiwgJS4xZl0gbXNcbiIsIGUtPm5hbWUsCisJCSAxZS02ICogdGlja3NfdG9fbnMo
aTkxNSwgdHNbMF0pLAorCQkgMWUtNiAqIHRpY2tzX3RvX25zKGk5MTUsIHRzWzJdKSk7CisKKwlp
Z3RfYXNzZXJ0KHRzWzBdICYmIHRzWzJdID4gdHNbMF0pOworCWlndF9hc3NlcnQoNCAqIHRzWzBd
ID4gMyAqIHRzWzJdKTsKK30KKwogI2RlZmluZSB0ZXN0X2VhY2hfZW5naW5lKFQsIGk5MTUsIGUp
IFwKIAlpZ3Rfc3VidGVzdF93aXRoX2R5bmFtaWMoVCkgX19mb3JfZWFjaF9waHlzaWNhbF9lbmdp
bmUoaTkxNSwgZSkgXAogCQlpZ3RfZHluYW1pY19mKCIlcyIsIGUtPm5hbWUpCkBAIC0yNTcxLDYg
KzMzNTUsMjUgQEAgaWd0X21haW4KIAkJdGVzdF9lYWNoX2VuZ2luZSgibGF0ZXNsaWNlIiwgZmQs
IGUpCiAJCQlsYXRlc2xpY2UoZmQsIGUtPmZsYWdzKTsKIAorCQlpZ3Rfc3VidGVzdF9ncm91cCB7
CisJCQlpZ3RfZml4dHVyZSB7CisJCQkJaWd0X3JlcXVpcmUoZ2VtX3NjaGVkdWxlcl9oYXNfc2Vt
YXBob3JlcyhmZCkpOworCQkJCWlndF9yZXF1aXJlKGdlbV9zY2hlZHVsZXJfaGFzX3ByZWVtcHRp
b24oZmQpKTsKKwkJCQlpZ3RfcmVxdWlyZShpbnRlbF9nZW4oaW50ZWxfZ2V0X2RybV9kZXZpZChm
ZCkpID49IDgpOworCQkJfQorCisJCQl0ZXN0X2VhY2hfZW5naW5lKCJmYWlyc2xpY2UiLCBmZCwg
ZSkKKwkJCQlmYWlyc2xpY2UoZmQsIGUpOworCisJCQlpZ3Rfc3VidGVzdCgiZmFpcnNsaWNlLWFs
bCIpICB7CisJCQkJX19mb3JfZWFjaF9waHlzaWNhbF9lbmdpbmUoZmQsIGUpIHsKKwkJCQkJaWd0
X2ZvcmsoY2hpbGQsIDEpCisJCQkJCQlmYWlyc2xpY2UoZmQsIGUpOworCQkJCX0KKwkJCQlpZ3Rf
d2FpdGNoaWxkcmVuKCk7CisJCQl9CisJCX0KKwogCQl0ZXN0X2VhY2hfZW5naW5lKCJzdWJtaXQt
ZWFybHktc2xpY2UiLCBmZCwgZSkKIAkJCXN1Ym1pdF9zbGljZShmZCwgZSwgRUFSTFlfU1VCTUlU
KTsKIAkJdGVzdF9lYWNoX2VuZ2luZSgic3VibWl0LWdvbGRlbi1zbGljZSIsIGZkLCBlKQpAQCAt
MjU5OSw2ICszNDAyLDggQEAgaWd0X21haW4KIAkJdGVzdF9lYWNoX2VuZ2luZV9zdG9yZSgicHJv
bW90aW9uIiwgZmQsIGUpCiAJCQlwcm9tb3Rpb24oZmQsIGUtPmZsYWdzKTsKIAorCQl0ZXN0X2Zh
aXJuZXNzKGZkLCAyKTsKKwogCQlpZ3Rfc3VidGVzdF9ncm91cCB7CiAJCQlpZ3RfZml4dHVyZSB7
CiAJCQkJaWd0X3JlcXVpcmUoZ2VtX3NjaGVkdWxlcl9oYXNfcHJlZW1wdGlvbihmZCkpOwotLSAK
Mi4yNy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJ
bnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0
cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZngK

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 463941149B0
	for <lists+intel-gfx@lfdr.de>; Fri,  6 Dec 2019 00:10:31 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 044FB6F91F;
	Thu,  5 Dec 2019 23:10:29 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 72C4A6F91F
 for <intel-gfx@lists.freedesktop.org>; Thu,  5 Dec 2019 23:10:27 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19477358-1500050 
 for multiple; Thu, 05 Dec 2019 23:10:21 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  5 Dec 2019 23:10:19 +0000
Message-Id: <20191205231019.976451-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191205224035.948962-1-chris@chris-wilson.co.uk>
References: <20191205224035.948962-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: Avoid calling i915_gem_object_unbind
 holding object lock
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SW4gdGhlIGV4dHJlbWUgY2FzZSwgd2UgbWF5IHdpc2ggdG8gd2FpdCBvbiBhbiByY3UtYmFycmll
ciB0byByZWFwIHN0YWxlCnZtIHRvIHB1cmdlIHRoZSBsYXN0IG9mIHRoZSBvYmplY3QgYmluZGlu
Z3MuIEhvd2V2ZXIsIHdlIGFyZSBub3QgYWxsb3dlZAp0byB1c2UgcmN1X2JhcnJpZXIoKSBiZW5l
YXRoIHRoZSBkbWFfcmVzdiAoaS5lLiBvYmplY3QpIGxvY2sgYW5kIGRvIG5vdAp0YWtlIGxpZ2h0
bHkgdGhlIHByb3NwZWN0IG9mIHVubG9ja2luZyBhIG11dGV4IGRlZXAgaW4gdGhlIGJvd2VscyBv
ZiB0aGUKcm91dGluZS4gaTkxNV9nZW1fb2JqZWN0X3VuYmluZCgpIGl0c2VsZiBkb2VzIG5vdCBu
ZWVkIHRoZSBvYmplY3QgbG9jaywKYW5kIGl0IHR1cm5zIG91dCB0aGUgY2FsbGVycyBkbyBub3Qg
bmVlZCB0byB0aGUgdW5iaW5kIGFzIHBhcnQgb2YgYQpsb2NrZWQgc2VxdWVuY2UgYXJvdW5kIHNl
dC1jYWNoZS1sZXZlbCwgc28gcmVhcnJhbmdlIHRoZSBjb2RlIHRvIGF2b2lkCnRha2luZyB0aGUg
b2JqZWN0IGxvY2sgaW4gdGhlIGNhbGxlcnMuCgo8ND4gWzE4Ni44MTYzMTFdID09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQo8ND4gWzE4Ni44MTYz
MTNdIFdBUk5JTkc6IHBvc3NpYmxlIGNpcmN1bGFyIGxvY2tpbmcgZGVwZW5kZW5jeSBkZXRlY3Rl
ZAo8ND4gWzE4Ni44MTYzMTZdIDUuNC4wLXJjOC1DSS1DSV9EUk1fNzQ4NisgIzEgVGFpbnRlZDog
RyAgICAgVQo8ND4gWzE4Ni44MTYzMThdIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLQo8ND4gWzE4Ni44MTYzMjBdIHBlcmZfcG11LzEzMjEgaXMg
dHJ5aW5nIHRvIGFjcXVpcmUgbG9jazoKPDQ+IFsxODYuODE2MzIyXSBmZmZmODg4NDk0ODdjNGQ4
ICgmbW0tPm1tYXBfc2VtIzIpeysrKyt9LCBhdDogX19taWdodF9mYXVsdCsweDM5LzB4OTAKPDQ+
IFsxODYuODE2MzMxXQpidXQgdGFzayBpcyBhbHJlYWR5IGhvbGRpbmcgbG9jazoKPDQ+IFsxODYu
ODE2MzMzXSBmZmZmZThmZmZmYTA1MDA4ICgmY3B1Y3R4X211dGV4KXsrLisufSwgYXQ6IHBlcmZf
ZXZlbnRfY3R4X2xvY2tfbmVzdGVkKzB4YTkvMHgxYjAKPDQ+IFsxODYuODE2MzM5XQp3aGljaCBs
b2NrIGFscmVhZHkgZGVwZW5kcyBvbiB0aGUgbmV3IGxvY2suCgo8ND4gWzE4Ni44MTYzNDFdCnRo
ZSBleGlzdGluZyBkZXBlbmRlbmN5IGNoYWluIChpbiByZXZlcnNlIG9yZGVyKSBpczoKPDQ+IFsx
ODYuODE2MzQzXQotPiAjNiAoJmNwdWN0eF9tdXRleCl7Ky4rLn06Cjw0PiBbMTg2LjgxNjM0OV0g
ICAgICAgIF9fbXV0ZXhfbG9jaysweDlhLzB4OWQwCjw0PiBbMTg2LjgxNjM1Ml0gICAgICAgIHBl
cmZfZXZlbnRfaW5pdF9jcHUrMHhhNC8weDE0MAo8ND4gWzE4Ni44MTYzNTddICAgICAgICBwZXJm
X2V2ZW50X2luaXQrMHgxOWQvMHgxY2QKPDQ+IFsxODYuODE2MzYyXSAgICAgICAgc3RhcnRfa2Vy
bmVsKzB4MzcyLzB4NGY0Cjw0PiBbMTg2LjgxNjM2NV0gICAgICAgIHNlY29uZGFyeV9zdGFydHVw
XzY0KzB4YTQvMHhiMAo8ND4gWzE4Ni44MTYzODFdCi0+ICM1IChwbXVzX2xvY2speysuKy59Ogo8
ND4gWzE4Ni44MTYzODVdICAgICAgICBfX211dGV4X2xvY2srMHg5YS8weDlkMAo8ND4gWzE4Ni44
MTYzODddICAgICAgICBwZXJmX2V2ZW50X2luaXRfY3B1KzB4NmIvMHgxNDAKPDQ+IFsxODYuODE2
NDA0XSAgICAgICAgY3B1aHBfaW52b2tlX2NhbGxiYWNrKzB4OWIvMHg5ZDAKPDQ+IFsxODYuODE2
NDA2XSAgICAgICAgX2NwdV91cCsweGEyLzB4MTQwCjw0PiBbMTg2LjgxNjQwOV0gICAgICAgIGRv
X2NwdV91cCsweDYxLzB4YTAKPDQ+IFsxODYuODE2NDExXSAgICAgICAgc21wX2luaXQrMHg1Ny8w
eDk2Cjw0PiBbMTg2LjgxNjQxM10gICAgICAgIGtlcm5lbF9pbml0X2ZyZWVhYmxlKzB4YWMvMHgx
YzcKPDQ+IFsxODYuODE2NDE2XSAgICAgICAga2VybmVsX2luaXQrMHg1LzB4MTAwCjw0PiBbMTg2
LjgxNjQxOV0gICAgICAgIHJldF9mcm9tX2ZvcmsrMHgyNC8weDUwCjw0PiBbMTg2LjgxNjQyMV0K
LT4gIzQgKGNwdV9ob3RwbHVnX2xvY2sucndfc2VtKXsrKysrfToKPDQ+IFsxODYuODE2NDI0XSAg
ICAgICAgY3B1c19yZWFkX2xvY2srMHgzNC8weGQwCjw0PiBbMTg2LjgxNjQyN10gICAgICAgIHJj
dV9iYXJyaWVyKzB4YWEvMHgxOTAKPDQ+IFsxODYuODE2NDI5XSAgICAgICAga2VybmVsX2luaXQr
MHgyMS8weDEwMAo8ND4gWzE4Ni44MTY0MzFdICAgICAgICByZXRfZnJvbV9mb3JrKzB4MjQvMHg1
MAo8ND4gWzE4Ni44MTY0MzNdCi0+ICMzIChyY3Vfc3RhdGUuYmFycmllcl9tdXRleCl7Ky4rLn06
Cjw0PiBbMTg2LjgxNjQzNl0gICAgICAgIF9fbXV0ZXhfbG9jaysweDlhLzB4OWQwCjw0PiBbMTg2
LjgxNjQzOF0gICAgICAgIHJjdV9iYXJyaWVyKzB4MjMvMHgxOTAKPDQ+IFsxODYuODE2NTAyXSAg
ICAgICAgaTkxNV9nZW1fb2JqZWN0X3VuYmluZCsweDNhNi8weDQwMCBbaTkxNV0KPDQ+IFsxODYu
ODE2NTM3XSAgICAgICAgaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNoZV9sZXZlbCsweDMyLzB4OTAg
W2k5MTVdCjw0PiBbMTg2LjgxNjU3MV0gICAgICAgIGk5MTVfZ2VtX29iamVjdF9waW5fdG9fZGlz
cGxheV9wbGFuZSsweDVkLzB4MTYwIFtpOTE1XQo8ND4gWzE4Ni44MTY2MTJdICAgICAgICBpbnRl
bF9waW5fYW5kX2ZlbmNlX2ZiX29iaisweDllLzB4MjAwIFtpOTE1XQo8ND4gWzE4Ni44MTY2Nzld
ICAgICAgICBpbnRlbF9wbGFuZV9waW5fZmIrMHgzZi8weGQwIFtpOTE1XQo8ND4gWzE4Ni44MTY3
MTddICAgICAgICBpbnRlbF9wcmVwYXJlX3BsYW5lX2ZiKzB4MTMwLzB4NTIwIFtpOTE1XQo8ND4g
WzE4Ni44MTY3MjJdICAgICAgICBkcm1fYXRvbWljX2hlbHBlcl9wcmVwYXJlX3BsYW5lcysweDg1
LzB4MTEwCjw0PiBbMTg2LjgxNjc2MV0gICAgICAgIGludGVsX2F0b21pY19jb21taXQrMHhjNi8w
eDM1MCBbaTkxNV0KPDQ+IFsxODYuODE2NzY0XSAgICAgICAgZHJtX2F0b21pY19oZWxwZXJfdXBk
YXRlX3BsYW5lKzB4ZWQvMHgxMTAKPDQ+IFsxODYuODE2NzY4XSAgICAgICAgc2V0cGxhbmVfaW50
ZXJuYWwrMHg5Ny8weDE5MAo8ND4gWzE4Ni44MTY3NzBdICAgICAgICBkcm1fbW9kZV9zZXRwbGFu
ZSsweGNkLzB4MTkwCjw0PiBbMTg2LjgxNjc3M10gICAgICAgIGRybV9pb2N0bF9rZXJuZWwrMHhh
Ny8weGYwCjw0PiBbMTg2LjgxNjc3NV0gICAgICAgIGRybV9pb2N0bCsweDJlMS8weDM5MAo8ND4g
WzE4Ni44MTY3NzhdICAgICAgICBkb192ZnNfaW9jdGwrMHhhMC8weDZmMAo8ND4gWzE4Ni44MTY3
ODBdICAgICAgICBrc3lzX2lvY3RsKzB4MzUvMHg2MAo8ND4gWzE4Ni44MTY3ODJdICAgICAgICBf
X3g2NF9zeXNfaW9jdGwrMHgxMS8weDIwCjw0PiBbMTg2LjgxNjc4NV0gICAgICAgIGRvX3N5c2Nh
bGxfNjQrMHg0Zi8weDIxMAo8ND4gWzE4Ni44MTY3ODddICAgICAgICBlbnRyeV9TWVNDQUxMXzY0
X2FmdGVyX2h3ZnJhbWUrMHg0OS8weGJlCjw0PiBbMTg2LjgxNjc4OV0KLT4gIzIgKHJlc2VydmF0
aW9uX3d3X2NsYXNzX211dGV4KXsrLisufToKPDQ+IFsxODYuODE2NzkzXSAgICAgICAgX193d19t
dXRleF9sb2NrLmNvbnN0cHJvcC4xNSsweGMzLzB4MTA5MAo8ND4gWzE4Ni44MTY3OTVdICAgICAg
ICB3d19tdXRleF9sb2NrKzB4MzkvMHg3MAo8ND4gWzE4Ni44MTY3OThdICAgICAgICBkbWFfcmVz
dl9sb2NrZGVwKzB4MTBlLzB4MWY3Cjw0PiBbMTg2LjgxNjgwMF0gICAgICAgIGRvX29uZV9pbml0
Y2FsbCsweDU4LzB4MmZmCjw0PiBbMTg2LjgxNjgwMl0gICAgICAgIGtlcm5lbF9pbml0X2ZyZWVh
YmxlKzB4MTM3LzB4MWM3Cjw0PiBbMTg2LjgxNjgwNF0gICAgICAgIGtlcm5lbF9pbml0KzB4NS8w
eDEwMAo8ND4gWzE4Ni44MTY4MDZdICAgICAgICByZXRfZnJvbV9mb3JrKzB4MjQvMHg1MAo8ND4g
WzE4Ni44MTY4MDhdCi0+ICMxIChyZXNlcnZhdGlvbl93d19jbGFzc19hY3F1aXJlKXsrLisufToK
PDQ+IFsxODYuODE2ODExXSAgICAgICAgZG1hX3Jlc3ZfbG9ja2RlcCsweGVjLzB4MWY3Cjw0PiBb
MTg2LjgxNjgxM10gICAgICAgIGRvX29uZV9pbml0Y2FsbCsweDU4LzB4MmZmCjw0PiBbMTg2Ljgx
NjgxNV0gICAgICAgIGtlcm5lbF9pbml0X2ZyZWVhYmxlKzB4MTM3LzB4MWM3Cjw0PiBbMTg2Ljgx
NjgxN10gICAgICAgIGtlcm5lbF9pbml0KzB4NS8weDEwMAo8ND4gWzE4Ni44MTY4MTldICAgICAg
ICByZXRfZnJvbV9mb3JrKzB4MjQvMHg1MAo8ND4gWzE4Ni44MTY4MjBdCi0+ICMwICgmbW0tPm1t
YXBfc2VtIzIpeysrKyt9Ogo8ND4gWzE4Ni44MTY4MjRdICAgICAgICBfX2xvY2tfYWNxdWlyZSsw
eDEzMjgvMHgxNWQwCjw0PiBbMTg2LjgxNjgyNl0gICAgICAgIGxvY2tfYWNxdWlyZSsweGE3LzB4
MWMwCjw0PiBbMTg2LjgxNjgyOF0gICAgICAgIF9fbWlnaHRfZmF1bHQrMHg2My8weDkwCjw0PiBb
MTg2LjgxNjgzMV0gICAgICAgIF9jb3B5X3RvX3VzZXIrMHgxZS8weDgwCjw0PiBbMTg2LjgxNjgz
NF0gICAgICAgIHBlcmZfcmVhZCsweDIwMC8weDJiMAo8ND4gWzE4Ni44MTY4MzZdICAgICAgICB2
ZnNfcmVhZCsweDk2LzB4MTYwCjw0PiBbMTg2LjgxNjgzOF0gICAgICAgIGtzeXNfcmVhZCsweDlm
LzB4ZTAKPDQ+IFsxODYuODE2ODM5XSAgICAgICAgZG9fc3lzY2FsbF82NCsweDRmLzB4MjEwCjw0
PiBbMTg2LjgxNjg0MV0gICAgICAgIGVudHJ5X1NZU0NBTExfNjRfYWZ0ZXJfaHdmcmFtZSsweDQ5
LzB4YmUKPDQ+IFsxODYuODE2ODQzXQpvdGhlciBpbmZvIHRoYXQgbWlnaHQgaGVscCB1cyBkZWJ1
ZyB0aGlzOgoKPDQ+IFsxODYuODE2ODQ2XSBDaGFpbiBleGlzdHMgb2Y6CiAgJm1tLT5tbWFwX3Nl
bSMyIC0tPiBwbXVzX2xvY2sgLS0+ICZjcHVjdHhfbXV0ZXgKCjw0PiBbMTg2LjgxNjg0OV0gIFBv
c3NpYmxlIHVuc2FmZSBsb2NraW5nIHNjZW5hcmlvOgoKPDQ+IFsxODYuODE2ODUxXSAgICAgICAg
Q1BVMCAgICAgICAgICAgICAgICAgICAgQ1BVMQo8ND4gWzE4Ni44MTY4NTNdICAgICAgICAtLS0t
ICAgICAgICAgICAgICAgICAgICAtLS0tCjw0PiBbMTg2LjgxNjg1NF0gICBsb2NrKCZjcHVjdHhf
bXV0ZXgpOwo8ND4gWzE4Ni44MTY4NTZdICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBs
b2NrKHBtdXNfbG9jayk7Cjw0PiBbMTg2LjgxNjg1OF0gICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIGxvY2soJmNwdWN0eF9tdXRleCk7Cjw0PiBbMTg2LjgxNjg2MF0gICBsb2NrKCZtbS0+
bW1hcF9zZW0jMik7Cjw0PiBbMTg2LjgxNjg2MV0KICoqKiBERUFETE9DSyAqKioKCkNsb3Nlczog
aHR0cHM6Ly9naXRsYWIuZnJlZWRlc2t0b3Aub3JnL2RybS9pbnRlbC9pc3N1ZXMvNzI4ClNpZ25l
ZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgotLS0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIHwgMTIgKysrLS0tCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYyB8ICAyIC0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYyAgIHwgNDEgKysrKysrLS0tLS0t
LS0tLS0tLS0KIDMgZmlsZXMgY2hhbmdlZCwgMTYgaW5zZXJ0aW9ucygrKSwgMzkgZGVsZXRpb25z
KC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRl
eCBlYjA1MDVhNjZlYTguLmNjNTc0ODI0MzZkNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTIxNTksMTkgKzIxNTksMTggQEAgaW50ZWxfcGlu
X2FuZF9mZW5jZV9mYl9vYmooc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCiAJICogcGluL3Vu
cGluL2ZlbmNlIGFuZCBub3QgbW9yZS4KIAkgKi8KIAl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9w
bV9nZXQoJmRldl9wcml2LT5ydW50aW1lX3BtKTsKLQlpOTE1X2dlbV9vYmplY3RfbG9jayhvYmop
OwogCiAJYXRvbWljX2luYygmZGV2X3ByaXYtPmdwdV9lcnJvci5wZW5kaW5nX2ZiX3Bpbik7CiAK
LQlwaW5jdGwgPSAwOwotCi0JLyogVmFsbGV5dmlldyBpcyBkZWZpbml0ZWx5IGxpbWl0ZWQgdG8g
c2Nhbm5pbmcgb3V0IHRoZSBmaXJzdAorCS8qCisJICogVmFsbGV5dmlldyBpcyBkZWZpbml0ZWx5
IGxpbWl0ZWQgdG8gc2Nhbm5pbmcgb3V0IHRoZSBmaXJzdAogCSAqIDUxMk1pQi4gTGV0cyBwcmVz
dW1lIHRoaXMgYmVoYXZpb3VyIHdhcyBpbmhlcml0ZWQgZnJvbSB0aGUKIAkgKiBnNHggZGlzcGxh
eSBlbmdpbmUgYW5kIHRoYXQgYWxsIGVhcmxpZXIgZ2VuIGFyZSBzaW1pbGFybHkKIAkgKiBsaW1p
dGVkLiBUZXN0aW5nIHN1Z2dlc3RzIHRoYXQgaXQgaXMgYSBsaXR0bGUgbW9yZQogCSAqIGNvbXBs
aWNhdGVkIHRoYW4gdGhpcy4gRm9yIGV4YW1wbGUsIENoZXJyeXZpZXcgYXBwZWFycyBxdWl0ZQog
CSAqIGhhcHB5IHRvIHNjYW5vdXQgZnJvbSBhbnl3aGVyZSB3aXRoaW4gaXRzIGdsb2JhbCBhcGVy
dHVyZS4KIAkgKi8KKwlwaW5jdGwgPSAwOwogCWlmIChIQVNfR01DSChkZXZfcHJpdikpCiAJCXBp
bmN0bCB8PSBQSU5fTUFQUEFCTEU7CiAKQEAgLTIxODMsNyArMjE4Miw4IEBAIGludGVsX3Bpbl9h
bmRfZmVuY2VfZmJfb2JqKHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAogCWlmICh1c2VzX2Zl
bmNlICYmIGk5MTVfdm1hX2lzX21hcF9hbmRfZmVuY2VhYmxlKHZtYSkpIHsKIAkJaW50IHJldDsK
IAotCQkvKiBJbnN0YWxsIGEgZmVuY2UgZm9yIHRpbGVkIHNjYW4tb3V0LiBQcmUtaTk2NSBhbHdh
eXMgbmVlZHMgYQorCQkvKgorCQkgKiBJbnN0YWxsIGEgZmVuY2UgZm9yIHRpbGVkIHNjYW4tb3V0
LiBQcmUtaTk2NSBhbHdheXMgbmVlZHMgYQogCQkgKiBmZW5jZSwgd2hlcmVhcyA5NjUrIG9ubHkg
cmVxdWlyZXMgYSBmZW5jZSBpZiB1c2luZwogCQkgKiBmcmFtZWJ1ZmZlciBjb21wcmVzc2lvbi4g
IEZvciBzaW1wbGljaXR5LCB3ZSBhbHdheXMsIHdoZW4KIAkJICogcG9zc2libGUsIGluc3RhbGwg
YSBmZW5jZSBhcyB0aGUgY29zdCBpcyBub3QgdGhhdCBvbmVyb3VzLgpAQCAtMjIxMyw4ICsyMjEz
LDYgQEAgaW50ZWxfcGluX2FuZF9mZW5jZV9mYl9vYmooc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAq
ZmIsCiAJaTkxNV92bWFfZ2V0KHZtYSk7CiBlcnI6CiAJYXRvbWljX2RlYygmZGV2X3ByaXYtPmdw
dV9lcnJvci5wZW5kaW5nX2ZiX3Bpbik7Ci0KLQlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKG9iaik7
CiAJaW50ZWxfcnVudGltZV9wbV9wdXQoJmRldl9wcml2LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsK
IAlyZXR1cm4gdm1hOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9vdmVybGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292
ZXJsYXkuYwppbmRleCA4Y2ZiNzg1ZTc2MWMuLjJhNDRiM2JlMjYwMCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMKQEAgLTc1OCwxMCArNzU4LDggQEAg
c3RhdGljIGludCBpbnRlbF9vdmVybGF5X2RvX3B1dF9pbWFnZShzdHJ1Y3QgaW50ZWxfb3Zlcmxh
eSAqb3ZlcmxheSwKIAogCWF0b21pY19pbmMoJmRldl9wcml2LT5ncHVfZXJyb3IucGVuZGluZ19m
Yl9waW4pOwogCi0JaTkxNV9nZW1fb2JqZWN0X2xvY2sobmV3X2JvKTsKIAl2bWEgPSBpOTE1X2dl
bV9vYmplY3RfcGluX3RvX2Rpc3BsYXlfcGxhbmUobmV3X2JvLAogCQkJCQkJICAgMCwgTlVMTCwg
UElOX01BUFBBQkxFKTsKLQlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKG5ld19ibyk7CiAJaWYgKElT
X0VSUih2bWEpKSB7CiAJCXJldCA9IFBUUl9FUlIodm1hKTsKIAkJZ290byBvdXRfcGluX3NlY3Rp
b247CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWlu
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMKaW5kZXggODA4
ZWIzMjdhMjliLi41M2UyOGU0MTdjYzkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9kb21haW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fZG9tYWluLmMKQEAgLTE4NywyMSArMTg3LDIzIEBAIGludCBpOTE1X2dlbV9vYmplY3Rf
c2V0X2NhY2hlX2xldmVsKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiB7CiAJaW50
IHJldDsKIAotCWFzc2VydF9vYmplY3RfaGVsZChvYmopOwotCiAJaWYgKG9iai0+Y2FjaGVfbGV2
ZWwgPT0gY2FjaGVfbGV2ZWwpCiAJCXJldHVybiAwOwogCi0JcmV0ID0gaTkxNV9nZW1fb2JqZWN0
X3VuYmluZChvYmosIEk5MTVfR0VNX09CSkVDVF9VTkJJTkRfQUNUSVZFKTsKKwlyZXQgPSBpOTE1
X2dlbV9vYmplY3RfbG9ja19pbnRlcnJ1cHRpYmxlKG9iaik7CiAJaWYgKHJldCkKIAkJcmV0dXJu
IHJldDsKIAotCS8qIFRoZSBjYWNoZS1sZXZlbCB3aWxsIGJlIGFwcGxpZWQgd2hlbiBlYWNoIHZt
YSBpcyByZWJvdW5kLiAqLworCS8qIEFsd2F5cyBpbnZhbGlkYXRlIHN0YWxlIGNhY2hlbGluZXMg
Ki8KKwlpZiAob2JqLT5jYWNoZV9sZXZlbCAhPSBjYWNoZV9sZXZlbCkgeworCQlpOTE1X2dlbV9v
YmplY3Rfc2V0X2NhY2hlX2NvaGVyZW5jeShvYmosIGNhY2hlX2xldmVsKTsKKwkJb2JqLT5jYWNo
ZV9kaXJ0eSA9IHRydWU7CisJfQogCi0JaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNoZV9jb2hlcmVu
Y3kob2JqLCBjYWNoZV9sZXZlbCk7Ci0Jb2JqLT5jYWNoZV9kaXJ0eSA9IHRydWU7IC8qIEFsd2F5
cyBpbnZhbGlkYXRlIHN0YWxlIGNhY2hlbGluZXMgKi8KKwlpOTE1X2dlbV9vYmplY3RfdW5sb2Nr
KG9iaik7CiAKLQlyZXR1cm4gMDsKKwkvKiBUaGUgY2FjaGUtbGV2ZWwgd2lsbCBiZSBhcHBsaWVk
IHdoZW4gZWFjaCB2bWEgaXMgcmVib3VuZC4gKi8KKwlyZXR1cm4gaTkxNV9nZW1fb2JqZWN0X3Vu
YmluZChvYmosIEk5MTVfR0VNX09CSkVDVF9VTkJJTkRfQUNUSVZFKTsKIH0KIAogaW50IGk5MTVf
Z2VtX2dldF9jYWNoaW5nX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEs
CkBAIC0yODIsMjAgKzI4NCw3IEBAIGludCBpOTE1X2dlbV9zZXRfY2FjaGluZ19pb2N0bChzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCQlnb3RvIG91dDsKIAl9CiAKLQlpZiAo
b2JqLT5jYWNoZV9sZXZlbCA9PSBsZXZlbCkKLQkJZ290byBvdXQ7Ci0KLQlyZXQgPSBpOTE1X2dl
bV9vYmplY3Rfd2FpdChvYmosCi0JCQkJICAgSTkxNV9XQUlUX0lOVEVSUlVQVElCTEUsCi0JCQkJ
ICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwotCWlmIChyZXQpCi0JCWdvdG8gb3V0OwotCi0JcmV0
ID0gaTkxNV9nZW1fb2JqZWN0X2xvY2tfaW50ZXJydXB0aWJsZShvYmopOwotCWlmIChyZXQgPT0g
MCkgewotCQlyZXQgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X2NhY2hlX2xldmVsKG9iaiwgbGV2ZWwp
OwotCQlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKG9iaik7Ci0JfQorCXJldCA9IGk5MTVfZ2VtX29i
amVjdF9zZXRfY2FjaGVfbGV2ZWwob2JqLCBsZXZlbCk7CiAKIG91dDoKIAlpOTE1X2dlbV9vYmpl
Y3RfcHV0KG9iaik7CkBAIC0zMTgsOCArMzA3LDYgQEAgaTkxNV9nZW1fb2JqZWN0X3Bpbl90b19k
aXNwbGF5X3BsYW5lKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJc3RydWN0IGk5
MTVfdm1hICp2bWE7CiAJaW50IHJldDsKIAotCWFzc2VydF9vYmplY3RfaGVsZChvYmopOwotCiAJ
LyogRnJhbWUgYnVmZmVyIG11c3QgYmUgaW4gTE1FTSAobm8gbWlncmF0aW9uIHlldCkgKi8KIAlp
ZiAoSEFTX0xNRU0oaTkxNSkgJiYgIWk5MTVfZ2VtX29iamVjdF9pc19sbWVtKG9iaikpCiAJCXJl
dHVybiBFUlJfUFRSKC1FSU5WQUwpOwpAQCAtMzYyLDEzICszNDksNyBAQCBpOTE1X2dlbV9vYmpl
Y3RfcGluX3RvX2Rpc3BsYXlfcGxhbmUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwK
IAogCXZtYS0+ZGlzcGxheV9hbGlnbm1lbnQgPSBtYXhfdCh1NjQsIHZtYS0+ZGlzcGxheV9hbGln
bm1lbnQsIGFsaWdubWVudCk7CiAKLQlfX2k5MTVfZ2VtX29iamVjdF9mbHVzaF9mb3JfZGlzcGxh
eShvYmopOwotCi0JLyoKLQkgKiBJdCBzaG91bGQgbm93IGJlIG91dCBvZiBhbnkgb3RoZXIgd3Jp
dGUgZG9tYWlucywgYW5kIHdlIGNhbiB1cGRhdGUKLQkgKiB0aGUgZG9tYWluIHZhbHVlcyBmb3Ig
b3VyIGNoYW5nZXMuCi0JICovCi0Jb2JqLT5yZWFkX2RvbWFpbnMgfD0gSTkxNV9HRU1fRE9NQUlO
X0dUVDsKKwlpOTE1X2dlbV9vYmplY3RfZmx1c2hfaWZfZGlzcGxheShvYmopOwogCiAJcmV0dXJu
IHZtYTsKIH0KLS0gCjIuMjQuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
aW50ZWwtZ2Z4

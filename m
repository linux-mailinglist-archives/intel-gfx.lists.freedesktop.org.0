Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id CF74CF8BB4
	for <lists+intel-gfx@lfdr.de>; Tue, 12 Nov 2019 10:29:28 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 971B56EAA2;
	Tue, 12 Nov 2019 09:29:17 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 079E56E0FB
 for <intel-gfx@lists.freedesktop.org>; Tue, 12 Nov 2019 09:29:15 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19170011-1500050 
 for multiple; Tue, 12 Nov 2019 09:28:57 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 12 Nov 2019 09:28:33 +0000
Message-Id: <20191112092854.869-6-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191112092854.869-1-chris@chris-wilson.co.uk>
References: <20191112092854.869-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 06/27] drm/i915: Use a ctor for TYPESAFE_BY_RCU
 i915_request
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QXMgd2Ugc3RhcnQgcGVla2luZyBpbnRvIHJlcXVlc3RzIGZvciBsb25nZXIgYW5kIGxvbmdlciwg
ZS5nLgppbmNvcnBvcmF0aW5nIHVzZSBvZiBzcGlubG9ja3Mgd2hlbiBvbmx5IHByb3RlY3RlZCBi
eSBhbgpyY3VfcmVhZF9sb2NrKCksIHdlIG5lZWQgdG8gYmUgY2FyZWZ1bCBpbiBob3cgd2UgcmVz
ZXQgdGhlIHJlcXVlc3Qgd2hlbgpyZWN5Y2xpbmcgYW5kIG5lZWQgdG8gcHJlc2VydmUgYW55IGJh
cnJpZXJzIHRoYXQgbWF5IHN0aWxsIGJlIGluIHVzZSBhcwp0aGUgcmVxdWVzdCBpcyByZXNldCBm
b3IgcmV1c2UuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNv
bi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYyAgIHwgMzUg
KysrKysrKysrKysrKysrKysrLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Nj
aGVkdWxlci5jIHwgIDYgKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVy
LmggfCAgMSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N3X2ZlbmNlLmMgIHwgIDggKysr
KysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N3X2ZlbmNlLmggIHwgIDIgKysKIDUgZmls
ZXMgY2hhbmdlZCwgNDEgaW5zZXJ0aW9ucygrKSwgMTEgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3JlcXVlc3QuYwppbmRleCAwMDAxMWY5NTMzYjYuLmY3Y2MxM2Q5ZDBhZSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKQEAgLTIxNCw3ICsyMTQsNyBAQCBzdGF0aWMg
dm9pZCByZW1vdmVfZnJvbV9lbmdpbmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJCXNwaW5f
bG9jaygmZW5naW5lLT5hY3RpdmUubG9jayk7CiAJCWxvY2tlZCA9IGVuZ2luZTsKIAl9Ci0JbGlz
dF9kZWwoJnJxLT5zY2hlZC5saW5rKTsKKwlsaXN0X2RlbF9pbml0KCZycS0+c2NoZWQubGluayk7
CiAJc3Bpbl91bmxvY2tfaXJxKCZsb2NrZWQtPmFjdGl2ZS5sb2NrKTsKIH0KIApAQCAtNTg2LDYg
KzU4NiwxOCBAQCByZXF1ZXN0X2FsbG9jX3Nsb3coc3RydWN0IGludGVsX3RpbWVsaW5lICp0bCwg
Z2ZwX3QgZ2ZwKQogCXJldHVybiBrbWVtX2NhY2hlX2FsbG9jKGdsb2JhbC5zbGFiX3JlcXVlc3Rz
LCBnZnApOwogfQogCitzdGF0aWMgdm9pZCBfX2k5MTVfcmVxdWVzdF9jdG9yKHZvaWQgKmFyZykK
K3sKKwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSA9IGFyZzsKKworCXNwaW5fbG9ja19pbml0KCZy
cS0+bG9jayk7CisJaTkxNV9zY2hlZF9ub2RlX2luaXQoJnJxLT5zY2hlZCk7CisJaTkxNV9zd19m
ZW5jZV9pbml0KCZycS0+c3VibWl0LCBzdWJtaXRfbm90aWZ5KTsKKwlpOTE1X3N3X2ZlbmNlX2lu
aXQoJnJxLT5zZW1hcGhvcmUsIHNlbWFwaG9yZV9ub3RpZnkpOworCisJSU5JVF9MSVNUX0hFQUQo
JnJxLT5leGVjdXRlX2NiKTsKK30KKwogc3RydWN0IGk5MTVfcmVxdWVzdCAqCiBfX2k5MTVfcmVx
dWVzdF9jcmVhdGUoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCBnZnBfdCBnZnApCiB7CkBAIC02
NTUsMTUgKzY2NywxNCBAQCBfX2k5MTVfcmVxdWVzdF9jcmVhdGUoc3RydWN0IGludGVsX2NvbnRl
eHQgKmNlLCBnZnBfdCBnZnApCiAKIAlycS0+cmN1c3RhdGUgPSBnZXRfc3RhdGVfc3luY2hyb25p
emVfcmN1KCk7IC8qIGFjdHMgYXMgc21wX21iKCkgKi8KIAotCXNwaW5fbG9ja19pbml0KCZycS0+
bG9jayk7CiAJZG1hX2ZlbmNlX2luaXQoJnJxLT5mZW5jZSwgJmk5MTVfZmVuY2Vfb3BzLCAmcnEt
PmxvY2ssCiAJCSAgICAgICB0bC0+ZmVuY2VfY29udGV4dCwgc2Vxbm8pOwogCiAJLyogV2UgYnVt
cCB0aGUgcmVmIGZvciB0aGUgZmVuY2UgY2hhaW4gKi8KLQlpOTE1X3N3X2ZlbmNlX2luaXQoJmk5
MTVfcmVxdWVzdF9nZXQocnEpLT5zdWJtaXQsIHN1Ym1pdF9ub3RpZnkpOwotCWk5MTVfc3dfZmVu
Y2VfaW5pdCgmaTkxNV9yZXF1ZXN0X2dldChycSktPnNlbWFwaG9yZSwgc2VtYXBob3JlX25vdGlm
eSk7CisJaTkxNV9zd19mZW5jZV9yZWluaXQoJmk5MTVfcmVxdWVzdF9nZXQocnEpLT5zdWJtaXQp
OworCWk5MTVfc3dfZmVuY2VfcmVpbml0KCZpOTE1X3JlcXVlc3RfZ2V0KHJxKS0+c2VtYXBob3Jl
KTsKIAotCWk5MTVfc2NoZWRfbm9kZV9pbml0KCZycS0+c2NoZWQpOworCWk5MTVfc2NoZWRfbm9k
ZV9yZWluaXQoJnJxLT5zY2hlZCk7CiAKIAkvKiBObyB6YWxsb2MsIG11c3QgY2xlYXIgd2hhdCB3
ZSBuZWVkIGJ5IGhhbmQgKi8KIAlycS0+ZmlsZV9wcml2ID0gTlVMTDsKQEAgLTY3MSw4ICs2ODIs
NiBAQCBfX2k5MTVfcmVxdWVzdF9jcmVhdGUoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCBnZnBf
dCBnZnApCiAJcnEtPmNhcHR1cmVfbGlzdCA9IE5VTEw7CiAJcnEtPmZsYWdzID0gMDsKIAotCUlO
SVRfTElTVF9IRUFEKCZycS0+ZXhlY3V0ZV9jYik7Ci0KIAkvKgogCSAqIFJlc2VydmUgc3BhY2Ug
aW4gdGhlIHJpbmcgYnVmZmVyIGZvciBhbGwgdGhlIGNvbW1hbmRzIHJlcXVpcmVkIHRvCiAJICog
ZXZlbnR1YWxseSBlbWl0IHRoaXMgcmVxdWVzdC4gVGhpcyBpcyB0byBndWFyYW50ZWUgdGhhdCB0
aGUKQEAgLTE1MzMsMTAgKzE1NDIsMTQgQEAgc3RhdGljIHN0cnVjdCBpOTE1X2dsb2JhbF9yZXF1
ZXN0IGdsb2JhbCA9IHsgewogCiBpbnQgX19pbml0IGk5MTVfZ2xvYmFsX3JlcXVlc3RfaW5pdCh2
b2lkKQogewotCWdsb2JhbC5zbGFiX3JlcXVlc3RzID0gS01FTV9DQUNIRShpOTE1X3JlcXVlc3Qs
Ci0JCQkJCSAgU0xBQl9IV0NBQ0hFX0FMSUdOIHwKLQkJCQkJICBTTEFCX1JFQ0xBSU1fQUNDT1VO
VCB8Ci0JCQkJCSAgU0xBQl9UWVBFU0FGRV9CWV9SQ1UpOworCWdsb2JhbC5zbGFiX3JlcXVlc3Rz
ID0KKwkJa21lbV9jYWNoZV9jcmVhdGUoImk5MTVfcmVxdWVzdCIsCisJCQkJICBzaXplb2Yoc3Ry
dWN0IGk5MTVfcmVxdWVzdCksCisJCQkJICBfX2FsaWdub2ZfXyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0
KSwKKwkJCQkgIFNMQUJfSFdDQUNIRV9BTElHTiB8CisJCQkJICBTTEFCX1JFQ0xBSU1fQUNDT1VO
VCB8CisJCQkJICBTTEFCX1RZUEVTQUZFX0JZX1JDVSwKKwkJCQkgIF9faTkxNV9yZXF1ZXN0X2N0
b3IpOwogCWlmICghZ2xvYmFsLnNsYWJfcmVxdWVzdHMpCiAJCXJldHVybiAtRU5PTUVNOwogCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIuYwppbmRleCAwMTBkNjdmNDhhZDkuLjcyNGU5
NmZlOTZlOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5jCkBAIC0zODcsNiAr
Mzg3LDEwIEBAIHZvaWQgaTkxNV9zY2hlZF9ub2RlX2luaXQoc3RydWN0IGk5MTVfc2NoZWRfbm9k
ZSAqbm9kZSkKIAlJTklUX0xJU1RfSEVBRCgmbm9kZS0+c2lnbmFsZXJzX2xpc3QpOwogCUlOSVRf
TElTVF9IRUFEKCZub2RlLT53YWl0ZXJzX2xpc3QpOwogCUlOSVRfTElTVF9IRUFEKCZub2RlLT5s
aW5rKTsKK30KKwordm9pZCBpOTE1X3NjaGVkX25vZGVfcmVpbml0KHN0cnVjdCBpOTE1X3NjaGVk
X25vZGUgKm5vZGUpCit7CiAJbm9kZS0+YXR0ci5wcmlvcml0eSA9IEk5MTVfUFJJT1JJVFlfSU5W
QUxJRDsKIAlub2RlLT5zZW1hcGhvcmVzID0gMDsKIAlub2RlLT5mbGFncyA9IDA7CkBAIC00ODEs
NiArNDg1LDcgQEAgdm9pZCBpOTE1X3NjaGVkX25vZGVfZmluaShzdHJ1Y3QgaTkxNV9zY2hlZF9u
b2RlICpub2RlKQogCQlpZiAoZGVwLT5mbGFncyAmIEk5MTVfREVQRU5ERU5DWV9BTExPQykKIAkJ
CWk5MTVfZGVwZW5kZW5jeV9mcmVlKGRlcCk7CiAJfQorCUlOSVRfTElTVF9IRUFEKCZub2RlLT5z
aWduYWxlcnNfbGlzdCk7CiAKIAkvKiBSZW1vdmUgb3Vyc2VsdmVzIGZyb20gZXZlcnlvbmUgd2hv
IGRlcGVuZHMgdXBvbiB1cyAqLwogCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShkZXAsIHRtcCwg
Jm5vZGUtPndhaXRlcnNfbGlzdCwgd2FpdF9saW5rKSB7CkBAIC00OTEsNiArNDk2LDcgQEAgdm9p
ZCBpOTE1X3NjaGVkX25vZGVfZmluaShzdHJ1Y3QgaTkxNV9zY2hlZF9ub2RlICpub2RlKQogCQlp
ZiAoZGVwLT5mbGFncyAmIEk5MTVfREVQRU5ERU5DWV9BTExPQykKIAkJCWk5MTVfZGVwZW5kZW5j
eV9mcmVlKGRlcCk7CiAJfQorCUlOSVRfTElTVF9IRUFEKCZub2RlLT53YWl0ZXJzX2xpc3QpOwog
CiAJc3Bpbl91bmxvY2tfaXJxKCZzY2hlZHVsZV9sb2NrKTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3NjaGVkdWxlci5oCmluZGV4IDA3ZDI0M2FjZjU1My4uZDFkYzRlZmVmNzdiIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5oCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmgKQEAgLTI2LDYgKzI2LDcgQEAKIAkJCQkJIHNj
aGVkLmxpbmspCiAKIHZvaWQgaTkxNV9zY2hlZF9ub2RlX2luaXQoc3RydWN0IGk5MTVfc2NoZWRf
bm9kZSAqbm9kZSk7Cit2b2lkIGk5MTVfc2NoZWRfbm9kZV9yZWluaXQoc3RydWN0IGk5MTVfc2No
ZWRfbm9kZSAqbm9kZSk7CiAKIGJvb2wgX19pOTE1X3NjaGVkX25vZGVfYWRkX2RlcGVuZGVuY3ko
c3RydWN0IGk5MTVfc2NoZWRfbm9kZSAqbm9kZSwKIAkJCQkgICAgICBzdHJ1Y3QgaTkxNV9zY2hl
ZF9ub2RlICpzaWduYWwsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N3
X2ZlbmNlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N3X2ZlbmNlLmMKaW5kZXggNmE4
OGRiMjkxMjUyLi5lYWNjNmM1Y2UwZmQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfc3dfZmVuY2UuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N3X2ZlbmNl
LmMKQEAgLTIyNyw2ICsyMjcsMTQgQEAgdm9pZCBfX2k5MTVfc3dfZmVuY2VfaW5pdChzdHJ1Y3Qg
aTkxNV9zd19mZW5jZSAqZmVuY2UsCiAJZmVuY2UtPmZsYWdzID0gKHVuc2lnbmVkIGxvbmcpZm47
CiB9CiAKK3ZvaWQgaTkxNV9zd19mZW5jZV9yZWluaXQoc3RydWN0IGk5MTVfc3dfZmVuY2UgKmZl
bmNlKQoreworCWRlYnVnX2ZlbmNlX2luaXQoZmVuY2UpOworCisJYXRvbWljX3NldCgmZmVuY2Ut
PnBlbmRpbmcsIDEpOworCWZlbmNlLT5lcnJvciA9IDA7Cit9CisKIHZvaWQgaTkxNV9zd19mZW5j
ZV9jb21taXQoc3RydWN0IGk5MTVfc3dfZmVuY2UgKmZlbmNlKQogewogCWRlYnVnX2ZlbmNlX2Fj
dGl2YXRlKGZlbmNlKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3df
ZmVuY2UuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3dfZmVuY2UuaAppbmRleCBhYjdk
NThiZDBiOWQuLjFlOTBkOWE1MWJkMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9zd19mZW5jZS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3dfZmVuY2Uu
aApAQCAtNTQsNiArNTQsOCBAQCBkbyB7CQkJCQkJCQlcCiAJX19pOTE1X3N3X2ZlbmNlX2luaXQo
KGZlbmNlKSwgKGZuKSwgTlVMTCwgTlVMTCkKICNlbmRpZgogCit2b2lkIGk5MTVfc3dfZmVuY2Vf
cmVpbml0KHN0cnVjdCBpOTE1X3N3X2ZlbmNlICpmZW5jZSk7CisKICNpZmRlZiBDT05GSUdfRFJN
X0k5MTVfU1dfRkVOQ0VfREVCVUdfT0JKRUNUUwogdm9pZCBpOTE1X3N3X2ZlbmNlX2Zpbmkoc3Ry
dWN0IGk5MTVfc3dfZmVuY2UgKmZlbmNlKTsKICNlbHNlCi0tIAoyLjI0LjAKCl9fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxp
c3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNr
dG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E53F32A64C4
	for <lists+intel-gfx@lfdr.de>; Wed,  4 Nov 2020 14:02:25 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4C2B76ED05;
	Wed,  4 Nov 2020 13:02:24 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga01.intel.com (mga01.intel.com [192.55.52.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5358F6ECFB
 for <intel-gfx@lists.freedesktop.org>; Wed,  4 Nov 2020 13:02:21 +0000 (UTC)
IronPort-SDR: tSQPweMmb0tKhl0a5q+jE6m+4aGcdu/h0S8ybLm5rB7EdyNO6ni2Ae8d1BmLAdBAPWh2pq3uHl
 kS85KmtFcJdA==
X-IronPort-AV: E=McAfee;i="6000,8403,9794"; a="187070962"
X-IronPort-AV: E=Sophos;i="5.77,450,1596524400"; d="scan'208";a="187070962"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga005.jf.intel.com ([10.7.209.41])
 by fmsmga101.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 04 Nov 2020 05:02:19 -0800
IronPort-SDR: VVUa+sF9uoZ1WPh5RRdP+10vH1LRgdeytt2DdCpa7lDoMHZMQf0Tz4PuJDFoIOgvLQNqETI45X
 nV41l12LQkZg==
X-IronPort-AV: E=Sophos;i="5.77,451,1596524400"; d="scan'208";a="538913497"
Received: from helsinki.fi.intel.com ([10.237.66.162])
 by orsmga005-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 04 Nov 2020 05:02:12 -0800
From: Gwan-gyeong Mun <gwan-gyeong.mun@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  4 Nov 2020 15:01:58 +0200
Message-Id: <20201104130159.200874-1-gwan-gyeong.mun@intel.com>
X-Mailer: git-send-email 2.25.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v3 1/2] drm/i915/display: Support PSR Multiple
 Transcoders
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SXQgaXMgYSBwcmVsaW1pbmFyeSB3b3JrIGZvciBzdXBwb3J0aW5nIG11bHRpcGxlIEVEUCBQU1Ig
YW5kCkRQIFBhbmVsUmVwbGF5LiBBbmQgaXQgcmVmYWN0b3JzIHNpbmdsZXRvbiBQU1IgdG8gTXVs
dGkgVHJhbnNjb2RlcgpzdXBwb3J0YWJsZSBQU1IuCkFuZCB0aGlzIG1vdmVzIGFuZCByZW5hbWVz
IHRoZSBpOTE1X3BzciBzdHJ1Y3R1cmUgb2YgZHJtX2k5MTVfcHJpdmF0ZSdzIHRvCmludGVsX2Rw
J3MgaW50ZWxfcHNyIHN0cnVjdHVyZS4KSXQgYWxzbyBjYXVzZXMgY2hhbmdlcyBpbiBQU1IgaW50
ZXJydXB0IGhhbmRsaW5nIHJvdXRpbmUgZm9yIHN1cHBvcnRpbmcKbXVsdGlwbGUgdHJhbnNjb2Rl
cnMuIEJ1dCBpdCBkb2VzIG5vdCBjaGFuZ2UgdGhlIHNjZW5hcmlvIGFuZCB0aW1pbmcgb2YKZW5h
YmxpbmcgYW5kIGRpc2FibGluZyBQU1IuCgp2MjogRml4IGluZGVudGF0aW9uIGFuZCBhZGQgY29t
bWVudHMKdjM6IFJlbW92ZSBCbGFuayBsaW5lCgpTaWduZWQtb2ZmLWJ5OiBHd2FuLWd5ZW9uZyBN
dW4gPGd3YW4tZ3llb25nLm11bkBpbnRlbC5jb20+CkNjOiBKb3PDqSBSb2JlcnRvIGRlIFNvdXph
IDxqb3NlLnNvdXphQGludGVsLmNvbT4KQ2M6IEp1aGEtUGVra2EgSGVpa2tpbGEgPGp1aGFwZWtr
YS5oZWlra2lsYUBnbWFpbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kZGkuYyAgICAgIHwgICA1ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheS5jICB8ICAgNiArLQogLi4uL2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxh
eV9kZWJ1Z2ZzLmMgIHwgMTExICsrKy0KIC4uLi9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3Bs
YXlfdHlwZXMuaCAgICB8ICAzOSArKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kcC5jICAgICAgIHwgIDIxICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X3Bzci5jICAgICAgfCA2MjEgKysrKysrKysrLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX3Bzci5oICAgICAgfCAgMTYgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMgICB8ICAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9kcnYuaCAgICAgICAgICAgICAgIHwgIDM5IC0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2lycS5jICAgICAgICAgICAgICAgfCAgNDcgKy0KIDEwIGZpbGVzIGNoYW5nZWQsIDUwNyBp
bnNlcnRpb25zKCspLCA0MDQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGRpLmMKaW5kZXggMTliMTY1MTdhNTAyLi45ODM3ODFjZTM2ODMgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYwpAQCAtNDEyNyw3ICs0MTI3LDEwIEBA
IHN0YXRpYyB2b2lkIGludGVsX2RkaV91cGRhdGVfcGlwZV9kcChzdHJ1Y3QgaW50ZWxfYXRvbWlj
X3N0YXRlICpzdGF0ZSwKIAogCWludGVsX2RkaV9zZXRfZHBfbXNhKGNydGNfc3RhdGUsIGNvbm5f
c3RhdGUpOwogCisJLy9UT0RPOiBtb3ZlIFBTUiByZWxhdGVkIGZ1bmN0aW9ucyBpbnRvIGludGVs
X3Bzcl91cGRhdGUoKQorCWludGVsX3BzcjJfcHJvZ3JhbV90cmFuc19tYW5fdHJrX2N0bChpbnRl
bF9kcCwgY3J0Y19zdGF0ZSk7CiAJaW50ZWxfcHNyX3VwZGF0ZShpbnRlbF9kcCwgY3J0Y19zdGF0
ZSwgY29ubl9zdGF0ZSk7CisKIAlpbnRlbF9kcF9zZXRfaW5mb2ZyYW1lcyhlbmNvZGVyLCB0cnVl
LCBjcnRjX3N0YXRlLCBjb25uX3N0YXRlKTsKIAlpbnRlbF9lZHBfZHJyc191cGRhdGUoaW50ZWxf
ZHAsIGNydGNfc3RhdGUpOwogCkBAIC01Mjc1LDYgKzUyNzgsOCBAQCB2b2lkIGludGVsX2RkaV9p
bml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgZW51bSBwb3J0IHBvcnQpCiAJ
CQlnb3RvIGVycjsKIAogCQlkaWdfcG9ydC0+aHBkX3B1bHNlID0gaW50ZWxfZHBfaHBkX3B1bHNl
OworCisJCWludGVsX3Bzcl9pbml0KCZkaWdfcG9ydC0+ZHApOwogCX0KIAogCS8qIEluIHRoZW9y
eSB3ZSBkb24ndCBuZWVkIHRoZSBlbmNvZGVyLT50eXBlIGNoZWNrLCBidXQgbGVhdmUgaXQganVz
dCBpbgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRl
eCBjZGRiZGE1MzAzZmYuLmJlNTIzOGU1ZDU4NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTE1NTA2LDggKzE1NTA2LDYgQEAgc3RhdGljIHZv
aWQgY29tbWl0X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAog
CiAJCWlmIChuZXdfY3J0Y19zdGF0ZS0+dXBkYXRlX3BpcGUpCiAJCQlpbnRlbF9waXBlX2Zhc3Rz
ZXQob2xkX2NydGNfc3RhdGUsIG5ld19jcnRjX3N0YXRlKTsKLQotCQlpbnRlbF9wc3IyX3Byb2dy
YW1fdHJhbnNfbWFuX3Rya19jdGwobmV3X2NydGNfc3RhdGUpOwogCX0KIAogCWlmIChkZXZfcHJp
di0+ZGlzcGxheS5hdG9taWNfdXBkYXRlX3dhdGVybWFya3MpCkBAIC0xNzQzNSw4ICsxNzQzMyw2
IEBAIHN0YXRpYyB2b2lkIGludGVsX3NldHVwX291dHB1dHMoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQogCQlpbnRlbF9kdm9faW5pdChkZXZfcHJpdik7CiAJfQogCi0JaW50ZWxf
cHNyX2luaXQoZGV2X3ByaXYpOwotCiAJZm9yX2VhY2hfaW50ZWxfZW5jb2RlcigmZGV2X3ByaXYt
PmRybSwgZW5jb2RlcikgewogCQllbmNvZGVyLT5iYXNlLnBvc3NpYmxlX2NydGNzID0KIAkJCWlu
dGVsX2VuY29kZXJfcG9zc2libGVfY3J0Y3MoZW5jb2Rlcik7CkBAIC0xODM3Myw3ICsxODM2OSw3
IEBAIGludCBpbnRlbF9tb2Rlc2V0X2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
CiAKIAlpbnRlbF9pbml0X2lwYyhpOTE1KTsKIAotCWludGVsX3Bzcl9zZXRfZm9yY2VfbW9kZV9j
aGFuZ2VkKGk5MTUtPnBzci5kcCk7CisJaW50ZWxfcHNyX3NldF9mb3JjZV9tb2RlX2NoYW5nZWQo
aTkxNSk7CiAKIAlyZXR1cm4gMDsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9kZWJ1Z2ZzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXlfZGVidWdmcy5jCmluZGV4IGNmYjRjMTQ3NDk4Mi4uODQwMmU2
YWM5Zjc2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rp
c3BsYXlfZGVidWdmcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGlzcGxheV9kZWJ1Z2ZzLmMKQEAgLTI0OCwxOCArMjQ4LDE3IEBAIHN0YXRpYyBpbnQgaTkxNV9w
c3Jfc2lua19zdGF0dXNfc2hvdyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAJCSJz
aW5rIGludGVybmFsIGVycm9yIiwKIAl9OwogCXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0
b3IgPSBtLT5wcml2YXRlOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoY29ubmVjdG9yLT5kZXYpOwogCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPQogCQlp
bnRlbF9hdHRhY2hlZF9kcCh0b19pbnRlbF9jb25uZWN0b3IoY29ubmVjdG9yKSk7CiAJaW50IHJl
dDsKIAotCWlmICghQ0FOX1BTUihkZXZfcHJpdikpIHsKLQkJc2VxX3B1dHMobSwgIlBTUiBVbnN1
cHBvcnRlZFxuIik7CisJaWYgKGNvbm5lY3Rvci0+c3RhdHVzICE9IGNvbm5lY3Rvcl9zdGF0dXNf
Y29ubmVjdGVkKQogCQlyZXR1cm4gLUVOT0RFVjsKLQl9CiAKLQlpZiAoY29ubmVjdG9yLT5zdGF0
dXMgIT0gY29ubmVjdG9yX3N0YXR1c19jb25uZWN0ZWQpCisJaWYgKCFDQU5fUFNSKGludGVsX2Rw
KSkgeworCQlzZXFfcHV0cyhtLCAiUFNSIFVuc3VwcG9ydGVkXG4iKTsKIAkJcmV0dXJuIC1FTk9E
RVY7CisJfQogCiAJcmV0ID0gZHJtX2RwX2RwY2RfcmVhZGIoJmludGVsX2RwLT5hdXgsIERQX1BT
Ul9TVEFUVVMsICZ2YWwpOwogCkBAIC0yNzksMTIgKzI3OCwxMyBAQCBzdGF0aWMgaW50IGk5MTVf
cHNyX3Npbmtfc3RhdHVzX3Nob3coc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogREVG
SU5FX1NIT1dfQVRUUklCVVRFKGk5MTVfcHNyX3Npbmtfc3RhdHVzKTsKIAogc3RhdGljIHZvaWQK
LXBzcl9zb3VyY2Vfc3RhdHVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgc3Ry
dWN0IHNlcV9maWxlICptKQorcHNyX3NvdXJjZV9zdGF0dXMoc3RydWN0IGludGVsX2RwICppbnRl
bF9kcCwgc3RydWN0IHNlcV9maWxlICptKQogewogCXUzMiB2YWwsIHN0YXR1c192YWw7CiAJY29u
c3QgY2hhciAqc3RhdHVzID0gInVua25vd24iOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCi0JaWYgKGRldl9wcml2LT5wc3IucHNy
Ml9lbmFibGVkKSB7CisJaWYgKGludGVsX2RwLT5wc3IucHNyMl9lbmFibGVkKSB7CiAJCXN0YXRp
YyBjb25zdCBjaGFyICogY29uc3QgbGl2ZV9zdGF0dXNbXSA9IHsKIAkJCSJJRExFIiwKIAkJCSJD
QVBUVVJFIiwKQEAgLTI5OSw3ICsyOTksNyBAQCBwc3Jfc291cmNlX3N0YXR1cyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHN0cnVjdCBzZXFfZmlsZSAqbSkKIAkJCSJUR19PTiIK
IAkJfTsKIAkJdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwKLQkJCQkgICAgRURQX1BTUjJf
U1RBVFVTKGRldl9wcml2LT5wc3IudHJhbnNjb2RlcikpOworCQkJCSAgICBFRFBfUFNSMl9TVEFU
VVMoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSk7CiAJCXN0YXR1c192YWwgPSAodmFsICYgRURQ
X1BTUjJfU1RBVFVTX1NUQVRFX01BU0spID4+CiAJCQkgICAgICBFRFBfUFNSMl9TVEFUVVNfU1RB
VEVfU0hJRlQ7CiAJCWlmIChzdGF0dXNfdmFsIDwgQVJSQVlfU0laRShsaXZlX3N0YXR1cykpCkBA
IC0zMTYsNyArMzE2LDcgQEAgcHNyX3NvdXJjZV9zdGF0dXMoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LCBzdHJ1Y3Qgc2VxX2ZpbGUgKm0pCiAJCQkiU1JERU5UX09OIiwKIAkJfTsK
IAkJdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwKLQkJCQkgICAgRURQX1BTUl9TVEFUVVMo
ZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSk7CisJCQkJICAgIEVEUF9QU1JfU1RBVFVTKGludGVs
X2RwLT5wc3IudHJhbnNjb2RlcikpOwogCQlzdGF0dXNfdmFsID0gKHZhbCAmIEVEUF9QU1JfU1RB
VFVTX1NUQVRFX01BU0spID4+CiAJCQkgICAgICBFRFBfUFNSX1NUQVRVU19TVEFURV9TSElGVDsK
IAkJaWYgKHN0YXR1c192YWwgPCBBUlJBWV9TSVpFKGxpdmVfc3RhdHVzKSkKQEAgLTMyNiwyMSAr
MzI2LDE4IEBAIHBzcl9zb3VyY2Vfc3RhdHVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwgc3RydWN0IHNlcV9maWxlICptKQogCXNlcV9wcmludGYobSwgIlNvdXJjZSBQU1Igc3Rh
dHVzOiAlcyBbMHglMDh4XVxuIiwgc3RhdHVzLCB2YWwpOwogfQogCi1zdGF0aWMgaW50IGk5MTVf
ZWRwX3Bzcl9zdGF0dXMoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQorc3RhdGljIGlu
dCBpbnRlbF9wc3Jfc3RhdHVzKHN0cnVjdCBzZXFfZmlsZSAqbSwgc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBub2RlX3Rv
X2k5MTUobS0+cHJpdmF0ZSk7Ci0Jc3RydWN0IGk5MTVfcHNyICpwc3IgPSAmZGV2X3ByaXYtPnBz
cjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVs
X2RwKTsKKwlzdHJ1Y3QgaW50ZWxfcHNyICpwc3IgPSAmaW50ZWxfZHAtPnBzcjsKIAlpbnRlbF93
YWtlcmVmX3Qgd2FrZXJlZjsKIAljb25zdCBjaGFyICpzdGF0dXM7CiAJYm9vbCBlbmFibGVkOwog
CXUzMiB2YWw7CiAKLQlpZiAoIUhBU19QU1IoZGV2X3ByaXYpKQotCQlyZXR1cm4gLUVOT0RFVjsK
LQogCXNlcV9wcmludGYobSwgIlNpbmsgc3VwcG9ydDogJXMiLCB5ZXNubyhwc3ItPnNpbmtfc3Vw
cG9ydCkpOwotCWlmIChwc3ItPmRwKQotCQlzZXFfcHJpbnRmKG0sICIgWzB4JTAyeF0iLCBwc3It
PmRwLT5wc3JfZHBjZFswXSk7CisJaWYgKHBzci0+c2lua19zdXBwb3J0KQorCQlzZXFfcHJpbnRm
KG0sICIgWzB4JTAyeF0iLCBpbnRlbF9kcC0+cHNyX2RwY2RbMF0pOwogCXNlcV9wdXRzKG0sICJc
biIpOwogCiAJaWYgKCFwc3ItPnNpbmtfc3VwcG9ydCkKQEAgLTM2NCwxNiArMzYxLDE2IEBAIHN0
YXRpYyBpbnQgaTkxNV9lZHBfcHNyX3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRh
dGEpCiAKIAlpZiAocHNyLT5wc3IyX2VuYWJsZWQpIHsKIAkJdmFsID0gaW50ZWxfZGVfcmVhZChk
ZXZfcHJpdiwKLQkJCQkgICAgRURQX1BTUjJfQ1RMKGRldl9wcml2LT5wc3IudHJhbnNjb2Rlcikp
OworCQkJCSAgICBFRFBfUFNSMl9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSk7CiAJCWVu
YWJsZWQgPSB2YWwgJiBFRFBfUFNSMl9FTkFCTEU7CiAJfSBlbHNlIHsKIAkJdmFsID0gaW50ZWxf
ZGVfcmVhZChkZXZfcHJpdiwKLQkJCQkgICAgRURQX1BTUl9DVEwoZGV2X3ByaXYtPnBzci50cmFu
c2NvZGVyKSk7CisJCQkJICAgIEVEUF9QU1JfQ1RMKGludGVsX2RwLT5wc3IudHJhbnNjb2Rlcikp
OwogCQllbmFibGVkID0gdmFsICYgRURQX1BTUl9FTkFCTEU7CiAJfQogCXNlcV9wcmludGYobSwg
IlNvdXJjZSBQU1IgY3RsOiAlcyBbMHglMDh4XVxuIiwKIAkJICAgZW5hYmxlZGRpc2FibGVkKGVu
YWJsZWQpLCB2YWwpOwotCXBzcl9zb3VyY2Vfc3RhdHVzKGRldl9wcml2LCBtKTsKKwlwc3Jfc291
cmNlX3N0YXR1cyhpbnRlbF9kcCwgbSk7CiAJc2VxX3ByaW50ZihtLCAiQnVzeSBmcm9udGJ1ZmZl
ciBiaXRzOiAweCUwOHhcbiIsCiAJCSAgIHBzci0+YnVzeV9mcm9udGJ1ZmZlcl9iaXRzKTsKIApA
QCAtMzgyLDcgKzM3OSw3IEBAIHN0YXRpYyBpbnQgaTkxNV9lZHBfcHNyX3N0YXR1cyhzdHJ1Y3Qg
c2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAJICovCiAJaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYp
IHx8IElTX0JST0FEV0VMTChkZXZfcHJpdikpIHsKIAkJdmFsID0gaW50ZWxfZGVfcmVhZChkZXZf
cHJpdiwKLQkJCQkgICAgRURQX1BTUl9QRVJGX0NOVChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIp
KTsKKwkJCQkgICAgRURQX1BTUl9QRVJGX0NOVChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpKTsK
IAkJdmFsICY9IEVEUF9QU1JfUEVSRl9DTlRfTUFTSzsKIAkJc2VxX3ByaW50ZihtLCAiUGVyZm9y
bWFuY2UgY291bnRlcjogJXVcbiIsIHZhbCk7CiAJfQpAQCAtNDAzLDcgKzQwMCw3IEBAIHN0YXRp
YyBpbnQgaTkxNV9lZHBfcHNyX3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEp
CiAJCSAqLwogCQlmb3IgKGZyYW1lID0gMDsgZnJhbWUgPCBQU1IyX1NVX1NUQVRVU19GUkFNRVM7
IGZyYW1lICs9IDMpIHsKIAkJCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsCi0JCQkJCSAg
ICBQU1IyX1NVX1NUQVRVUyhkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIsIGZyYW1lKSk7CisJCQkJ
CSAgICBQU1IyX1NVX1NUQVRVUyhpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIsIGZyYW1lKSk7CiAJ
CQlzdV9mcmFtZXNfdmFsW2ZyYW1lIC8gM10gPSB2YWw7CiAJCX0KIApAQCAtNDI5LDIzICs0MjYs
NTcgQEAgc3RhdGljIGludCBpOTE1X2VkcF9wc3Jfc3RhdHVzKHN0cnVjdCBzZXFfZmlsZSAqbSwg
dm9pZCAqZGF0YSkKIAlyZXR1cm4gMDsKIH0KIAorc3RhdGljIGludCBpOTE1X2VkcF9wc3Jfc3Rh
dHVzKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7CisJc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXI7CisJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IE5VTEw7
CisKKwlpZiAoIUhBU19QU1IoZGV2X3ByaXYpKQorCQlyZXR1cm4gLUVOT0RFVjsKKworCS8qIEZp
bmQgdGhlIGZpcnN0IEVEUCAqLworCWZvcl9lYWNoX2ludGVsX2RwKCZkZXZfcHJpdi0+ZHJtLCBl
bmNvZGVyKSB7CisJCWlmIChlbmNvZGVyLT50eXBlID09IElOVEVMX09VVFBVVF9FRFApIHsKKwkJ
CWludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKGVuY29kZXIpOworCQkJYnJlYWs7CisJCX0KKwl9
CisKKwlpZiAoIWludGVsX2RwKQorCQlyZXR1cm4gLUVOT0RFVjsKKworCXJldHVybiBpbnRlbF9w
c3Jfc3RhdHVzKG0sIGludGVsX2RwKTsKK30KKwogc3RhdGljIGludAogaTkxNV9lZHBfcHNyX2Rl
YnVnX3NldCh2b2lkICpkYXRhLCB1NjQgdmFsKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IGRhdGE7CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7Ci0JaW50IHJldDsK
KwlpbnQgcmV0ID0gLUVOT0RFVjsKKwlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKIAot
CWlmICghQ0FOX1BTUihkZXZfcHJpdikpCi0JCXJldHVybiAtRU5PREVWOworCWlmICghSEFTX1BT
UihkZXZfcHJpdikpCisJCXJldHVybiByZXQ7CiAKLQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRy
bSwgIlNldHRpbmcgUFNSIGRlYnVnIHRvICVsbHhcbiIsIHZhbCk7CisJZm9yX2VhY2hfaW50ZWxf
ZHAoJmRldl9wcml2LT5kcm0sIGVuY29kZXIpIHsKKwkJc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCA9IGVuY190b19pbnRlbF9kcChlbmNvZGVyKTsKIAotCXdha2VyZWYgPSBpbnRlbF9ydW50aW1l
X3BtX2dldCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0pOworCQlpZiAoIUNBTl9QU1IoaW50ZWxfZHAp
KQorCQkJY29udGludWU7CiAKLQlyZXQgPSBpbnRlbF9wc3JfZGVidWdfc2V0KGRldl9wcml2LCB2
YWwpOworCQlpZiAoZW5jb2Rlci0+dHlwZSA9PSBJTlRFTF9PVVRQVVRfRURQKSB7CisJCQlkcm1f
ZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgIlNldHRpbmcgUFNSIGRlYnVnIHRvICVsbHhcbiIsIHZh
bCk7CiAKLQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0sIHdha2Vy
ZWYpOworCQkJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZkZXZfcHJpdi0+cnVudGlt
ZV9wbSk7CisKKwkJCS8vIFRPRE86IHNwbGl0IHRvIGVhY2ggdHJhbnNjb2RlcidzIFBTUiBkZWJ1
ZyBzdGF0ZQorCQkJcmV0ID0gaW50ZWxfcHNyX2RlYnVnX3NldChpbnRlbF9kcCwgdmFsKTsKKwor
CQkJaW50ZWxfcnVudGltZV9wbV9wdXQoJmRldl9wcml2LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsK
KwkJfQorCX0KIAogCXJldHVybiByZXQ7CiB9CkBAIC00NTQsMTIgKzQ4NSwyNSBAQCBzdGF0aWMg
aW50CiBpOTE1X2VkcF9wc3JfZGVidWdfZ2V0KHZvaWQgKmRhdGEsIHU2NCAqdmFsKQogewogCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRhdGE7CisJc3RydWN0IGludGVsX2Vu
Y29kZXIgKmVuY29kZXI7CiAKLQlpZiAoIUNBTl9QU1IoZGV2X3ByaXYpKQorCWlmICghSEFTX1BT
UihkZXZfcHJpdikpCiAJCXJldHVybiAtRU5PREVWOwogCi0JKnZhbCA9IFJFQURfT05DRShkZXZf
cHJpdi0+cHNyLmRlYnVnKTsKLQlyZXR1cm4gMDsKKwlmb3JfZWFjaF9pbnRlbF9kcCgmZGV2X3By
aXYtPmRybSwgZW5jb2RlcikgeworCQlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZW5jX3Rv
X2ludGVsX2RwKGVuY29kZXIpOworCisJCWlmICghQ0FOX1BTUihpbnRlbF9kcCkpCisJCQljb250
aW51ZTsKKworCQkvLyBUT0RPOiBzcGxpdCB0byBlYWNoIHRyYW5zY29kZXIncyBQU1IgZGVidWcg
c3RhdGUKKwkJaWYgKGVuY29kZXItPnR5cGUgPT0gSU5URUxfT1VUUFVUX0VEUCkgeworCQkJKnZh
bCA9IFJFQURfT05DRShpbnRlbF9kcC0+cHNyLmRlYnVnKTsKKwkJCXJldHVybiAwOworCQl9CisJ
fQorCisJcmV0dXJuIC1FTk9ERVY7CiB9CiAKIERFRklORV9TSU1QTEVfQVRUUklCVVRFKGk5MTVf
ZWRwX3Bzcl9kZWJ1Z19mb3BzLApAQCAtMTEwMyw5ICsxMTQ3LDYgQEAgc3RhdGljIHZvaWQgZHJy
c19zdGF0dXNfcGVyX2NydGMoc3RydWN0IHNlcV9maWxlICptLAogCQkvKiBkaXNhYmxlX2RycnMo
KSB3aWxsIG1ha2UgZHJycy0+ZHAgTlVMTCAqLwogCQlpZiAoIWRycnMtPmRwKSB7CiAJCQlzZXFf
cHV0cyhtLCAiSWRsZW5lc3MgRFJSUzogRGlzYWJsZWRcbiIpOwotCQkJaWYgKGRldl9wcml2LT5w
c3IuZW5hYmxlZCkKLQkJCQlzZXFfcHV0cyhtLAotCQkJCSJcdEFzIFBTUiBpcyBlbmFibGVkLCBE
UlJTIGlzIG5vdCBlbmFibGVkXG4iKTsKIAkJCW11dGV4X3VubG9jaygmZHJycy0+bXV0ZXgpOwog
CQkJcmV0dXJuOwogCQl9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXlfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheV90eXBlcy5oCmluZGV4IGY2ZjA2MjY2NDllMC4uZDJjZDYzMDVkZTZiIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMu
aAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMu
aApAQCAtMTI4Niw2ICsxMjg2LDQzIEBAIHN0cnVjdCBpbnRlbF9kcF9jb21wbGlhbmNlIHsKIAl1
OCB0ZXN0X2xhbmVfY291bnQ7CiB9OwogCitzdHJ1Y3QgaW50ZWxfcHNyIHsKKwkvKiBNdXRleCBm
b3IgUFNSIHN0YXRlIG9mIHRoZSB0cmFuc2NvZGVyICovCisJc3RydWN0IG11dGV4IGxvY2s7CisK
KyNkZWZpbmUgSTkxNV9QU1JfREVCVUdfTU9ERV9NQVNLCTB4MGYKKyNkZWZpbmUgSTkxNV9QU1Jf
REVCVUdfREVGQVVMVAkJMHgwMAorI2RlZmluZSBJOTE1X1BTUl9ERUJVR19ESVNBQkxFCQkweDAx
CisjZGVmaW5lIEk5MTVfUFNSX0RFQlVHX0VOQUJMRQkJMHgwMgorI2RlZmluZSBJOTE1X1BTUl9E
RUJVR19GT1JDRV9QU1IxCTB4MDMKKyNkZWZpbmUgSTkxNV9QU1JfREVCVUdfSVJRCQkweDEwCisK
Kwl1MzIgZGVidWc7CisJYm9vbCBzaW5rX3N1cHBvcnQ7CisJYm9vbCBlbmFibGVkOworCWVudW0g
cGlwZSBwaXBlOworCWVudW0gdHJhbnNjb2RlciB0cmFuc2NvZGVyOworCWJvb2wgYWN0aXZlOwor
CXN0cnVjdCB3b3JrX3N0cnVjdCB3b3JrOworCXVuc2lnbmVkIGludCBidXN5X2Zyb250YnVmZmVy
X2JpdHM7CisJYm9vbCBzaW5rX3BzcjJfc3VwcG9ydDsKKwlib29sIGxpbmtfc3RhbmRieTsKKwli
b29sIGNvbG9yaW1ldHJ5X3N1cHBvcnQ7CisJYm9vbCBwc3IyX2VuYWJsZWQ7CisJYm9vbCBwc3Iy
X3NlbF9mZXRjaF9lbmFibGVkOworCXU4IHNpbmtfc3luY19sYXRlbmN5OworCWt0aW1lX3QgbGFz
dF9lbnRyeV9hdHRlbXB0OworCWt0aW1lX3QgbGFzdF9leGl0OworCWJvb2wgc2lua19ub3RfcmVs
aWFibGU7CisJYm9vbCBpcnFfYXV4X2Vycm9yOworCXUxNiBzdV94X2dyYW51bGFyaXR5OworCWJv
b2wgZGMzY29fZW5hYmxlZDsKKwl1MzIgZGMzY29fZXhpdF9kZWxheTsKKwlzdHJ1Y3QgZGVsYXll
ZF93b3JrIGRjM2NvX3dvcms7CisJYm9vbCBmb3JjZV9tb2RlX2NoYW5nZWQ7CisJc3RydWN0IGRy
bV9kcF92c2Nfc2RwIHZzYzsKK307CisKIHN0cnVjdCBpbnRlbF9kcCB7CiAJaTkxNV9yZWdfdCBv
dXRwdXRfcmVnOwogCXUzMiBEUDsKQEAgLTE0MDYsNiArMTQ0Myw4IEBAIHN0cnVjdCBpbnRlbF9k
cCB7CiAKIAlib29sIGhvYmxfZmFpbGVkOwogCWJvb2wgaG9ibF9hY3RpdmU7CisKKwlzdHJ1Y3Qg
aW50ZWxfcHNyIHBzcjsKIH07CiAKIGVudW0gbHNwY29uX3ZlbmRvciB7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2RwLmMKaW5kZXggY2YwOWFjYTc2MDdiLi5mNDYyNzM1MWZhMTcg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMKQEAgLTI2NDAsMTIgKzI2
NDAsMTAgQEAgdm9pZCBpbnRlbF9kcF9jb21wdXRlX3Bzcl92c2Nfc2RwKHN0cnVjdCBpbnRlbF9k
cCAqaW50ZWxfZHAsCiAJCQkJICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29u
bl9zdGF0ZSwKIAkJCQkgIHN0cnVjdCBkcm1fZHBfdnNjX3NkcCAqdnNjKQogewotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwotCiAJdnNj
LT5zZHBfdHlwZSA9IERQX1NEUF9WU0M7CiAKLQlpZiAoZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJs
ZWQpIHsKLQkJaWYgKGRldl9wcml2LT5wc3IuY29sb3JpbWV0cnlfc3VwcG9ydCAmJgorCWlmIChp
bnRlbF9kcC0+cHNyLnBzcjJfZW5hYmxlZCkgeworCQlpZiAoaW50ZWxfZHAtPnBzci5jb2xvcmlt
ZXRyeV9zdXBwb3J0ICYmCiAJCSAgICBpbnRlbF9kcF9uZWVkc192c2Nfc2RwKGNydGNfc3RhdGUs
IGNvbm5fc3RhdGUpKSB7CiAJCQkvKiBbUFNSMiwgK0NvbG9yaW1ldHJ5XSAqLwogCQkJaW50ZWxf
ZHBfY29tcHV0ZV92c2NfY29sb3JpbWV0cnkoY3J0Y19zdGF0ZSwgY29ubl9zdGF0ZSwKQEAgLTc5
NzIsNiArNzk3MCwxNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kcF9tb2Rlc2V0X3JldHJ5X3dvcmtf
Zm4oc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCWRybV9rbXNfaGVscGVyX2hvdHBsdWdfZXZl
bnQoY29ubmVjdG9yLT5kZXYpOwogfQogCitzdGF0aWMgdm9pZCBpbnRlbF9kcF91cGRhdGVfcGlw
ZShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKKwkJCQkgc3RydWN0IGludGVsX2Vu
Y29kZXIgKmVuY29kZXIsCisJCQkJIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlLAorCQkJCSBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0
ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKGVuY29k
ZXIpOworCisJaW50ZWxfcGFuZWxfdXBkYXRlX2JhY2tsaWdodChzdGF0ZSwgZW5jb2RlciwgY3J0
Y19zdGF0ZSwgY29ubl9zdGF0ZSk7CisJaW50ZWxfcHNyMl9wcm9ncmFtX3RyYW5zX21hbl90cmtf
Y3RsKGludGVsX2RwLCBjcnRjX3N0YXRlKTsKK30KKwogYm9vbAogaW50ZWxfZHBfaW5pdF9jb25u
ZWN0b3Ioc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQsCiAJCQlzdHJ1Y3QgaW50
ZWxfY29ubmVjdG9yICppbnRlbF9jb25uZWN0b3IpCkBAIC04MTI3LDcgKzgxMzYsNyBAQCBib29s
IGludGVsX2RwX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCWludGVs
X2VuY29kZXItPmdldF9jb25maWcgPSBpbnRlbF9kcF9nZXRfY29uZmlnOwogCWludGVsX2VuY29k
ZXItPnN5bmNfc3RhdGUgPSBpbnRlbF9kcF9zeW5jX3N0YXRlOwogCWludGVsX2VuY29kZXItPmlu
aXRpYWxfZmFzdHNldF9jaGVjayA9IGludGVsX2RwX2luaXRpYWxfZmFzdHNldF9jaGVjazsKLQlp
bnRlbF9lbmNvZGVyLT51cGRhdGVfcGlwZSA9IGludGVsX3BhbmVsX3VwZGF0ZV9iYWNrbGlnaHQ7
CisJaW50ZWxfZW5jb2Rlci0+dXBkYXRlX3BpcGUgPSBpbnRlbF9kcF91cGRhdGVfcGlwZTsKIAlp
bnRlbF9lbmNvZGVyLT5zdXNwZW5kID0gaW50ZWxfZHBfZW5jb2Rlcl9zdXNwZW5kOwogCWludGVs
X2VuY29kZXItPnNodXRkb3duID0gaW50ZWxfZHBfZW5jb2Rlcl9zaHV0ZG93bjsKIAlpZiAoSVNf
Q0hFUlJZVklFVyhkZXZfcHJpdikpIHsKQEAgLTgyMTQsNiArODIyMyw4IEBAIGJvb2wgaW50ZWxf
ZHBfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaWYgKCFpbnRlbF9k
cF9pbml0X2Nvbm5lY3RvcihkaWdfcG9ydCwgaW50ZWxfY29ubmVjdG9yKSkKIAkJZ290byBlcnJf
aW5pdF9jb25uZWN0b3I7CiAKKwlpbnRlbF9wc3JfaW5pdCgmZGlnX3BvcnQtPmRwKTsKKwogCXJl
dHVybiB0cnVlOwogCiBlcnJfaW5pdF9jb25uZWN0b3I6CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9wc3IuYwppbmRleCAxNTc2YzM3MjJkMGIuLmRmMDI4NjBmNTRkNyAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5jCkBAIC03OSwxMSArNzksMTMgQEAK
ICAqIHVzZSBwYWdlIGZsaXBzLgogICovCiAKLXN0YXRpYyBib29sIHBzcl9nbG9iYWxfZW5hYmxl
ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3N0YXRpYyBib29sIHBzcl9nbG9iYWxf
ZW5hYmxlZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewotCXN3aXRjaCAoaTkxNS0+cHNy
LmRlYnVnICYgSTkxNV9QU1JfREVCVUdfTU9ERV9NQVNLKSB7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisKKwlzd2l0Y2ggKGludGVs
X2RwLT5wc3IuZGVidWcgJiBJOTE1X1BTUl9ERUJVR19NT0RFX01BU0spIHsKIAljYXNlIEk5MTVf
UFNSX0RFQlVHX0RFRkFVTFQ6Ci0JCXJldHVybiBpOTE1LT5wYXJhbXMuZW5hYmxlX3BzcjsKKwkJ
cmV0dXJuIGRldl9wcml2LT5wYXJhbXMuZW5hYmxlX3BzcjsKIAljYXNlIEk5MTVfUFNSX0RFQlVH
X0RJU0FCTEU6CiAJCXJldHVybiBmYWxzZTsKIAlkZWZhdWx0OgpAQCAtOTEsOSArOTMsOSBAQCBz
dGF0aWMgYm9vbCBwc3JfZ2xvYmFsX2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCiAJfQogfQogCi1zdGF0aWMgYm9vbCBwc3IyX2dsb2JhbF9lbmFibGVkKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyBib29sIHBzcjJfZ2xvYmFsX2VuYWJsZWQo
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKLQlzd2l0Y2ggKGRldl9wcml2LT5wc3IuZGVi
dWcgJiBJOTE1X1BTUl9ERUJVR19NT0RFX01BU0spIHsKKwlzd2l0Y2ggKGludGVsX2RwLT5wc3Iu
ZGVidWcgJiBJOTE1X1BTUl9ERUJVR19NT0RFX01BU0spIHsKIAljYXNlIEk5MTVfUFNSX0RFQlVH
X0RJU0FCTEU6CiAJY2FzZSBJOTE1X1BTUl9ERUJVR19GT1JDRV9QU1IxOgogCQlyZXR1cm4gZmFs
c2U7CkBAIC0xMDIsMTEgKzEwNCwxMiBAQCBzdGF0aWMgYm9vbCBwc3IyX2dsb2JhbF9lbmFibGVk
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAl9CiB9CiAKLXN0YXRpYyB2b2lk
IHBzcl9pcnFfY29udHJvbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0
aWMgdm9pZCBwc3JfaXJxX2NvbnRyb2woc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKIAll
bnVtIHRyYW5zY29kZXIgdHJhbnNfc2hpZnQ7CiAJdTMyIG1hc2ssIHZhbDsKIAlpOTE1X3JlZ190
IGltcl9yZWc7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkx
NShpbnRlbF9kcCk7CiAKIAkvKgogCSAqIGdlbjEyKyBoYXMgcmVnaXN0ZXJzIHJlbGF0aXZlIHRv
IHRyYW5zY29kZXIgYW5kIG9uZSBwZXIgdHJhbnNjb2RlcgpAQCAtMTE1LDE0ICsxMTgsMTQgQEAg
c3RhdGljIHZvaWQgcHNyX2lycV9jb250cm9sKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIAkgKi8KIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikgewogCQl0cmFuc19z
aGlmdCA9IDA7Ci0JCWltcl9yZWcgPSBUUkFOU19QU1JfSU1SKGRldl9wcml2LT5wc3IudHJhbnNj
b2Rlcik7CisJCWltcl9yZWcgPSBUUkFOU19QU1JfSU1SKGludGVsX2RwLT5wc3IudHJhbnNjb2Rl
cik7CiAJfSBlbHNlIHsKLQkJdHJhbnNfc2hpZnQgPSBkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXI7
CisJCXRyYW5zX3NoaWZ0ID0gaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyOwogCQlpbXJfcmVnID0g
RURQX1BTUl9JTVI7CiAJfQogCiAJbWFzayA9IEVEUF9QU1JfRVJST1IodHJhbnNfc2hpZnQpOwot
CWlmIChkZXZfcHJpdi0+cHNyLmRlYnVnICYgSTkxNV9QU1JfREVCVUdfSVJRKQorCWlmIChpbnRl
bF9kcC0+cHNyLmRlYnVnICYgSTkxNV9QU1JfREVCVUdfSVJRKQogCQltYXNrIHw9IEVEUF9QU1Jf
UE9TVF9FWElUKHRyYW5zX3NoaWZ0KSB8CiAJCQlFRFBfUFNSX1BSRV9FTlRSWSh0cmFuc19zaGlm
dCk7CiAKQEAgLTE3MSwzOCArMTc0LDM3IEBAIHN0YXRpYyB2b2lkIHBzcl9ldmVudF9wcmludChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwg
Ilx0UFNSIGRpc2FibGVkXG4iKTsKIH0KIAotdm9pZCBpbnRlbF9wc3JfaXJxX2hhbmRsZXIoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgcHNyX2lpcikKK3ZvaWQgaW50ZWxf
cHNyX2lycV9oYW5kbGVyKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIHUzMiBwc3JfaWlyKQog
ewotCWVudW0gdHJhbnNjb2RlciBjcHVfdHJhbnNjb2RlciA9IGRldl9wcml2LT5wc3IudHJhbnNj
b2RlcjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGlu
dGVsX2RwKTsKKwllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIgPSBpbnRlbF9kcC0+cHNy
LnRyYW5zY29kZXI7CiAJZW51bSB0cmFuc2NvZGVyIHRyYW5zX3NoaWZ0OwogCWk5MTVfcmVnX3Qg
aW1yX3JlZzsKIAlrdGltZV90IHRpbWVfbnMgPSAga3RpbWVfZ2V0KCk7CiAKIAlpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSAxMikgewogCQl0cmFuc19zaGlmdCA9IDA7Ci0JCWltcl9yZWcgPSBU
UkFOU19QU1JfSU1SKGRldl9wcml2LT5wc3IudHJhbnNjb2Rlcik7CisJCWltcl9yZWcgPSBUUkFO
U19QU1JfSU1SKGludGVsX2RwLT5wc3IudHJhbnNjb2Rlcik7CiAJfSBlbHNlIHsKLQkJdHJhbnNf
c2hpZnQgPSBkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXI7CisJCXRyYW5zX3NoaWZ0ID0gaW50ZWxf
ZHAtPnBzci50cmFuc2NvZGVyOwogCQlpbXJfcmVnID0gRURQX1BTUl9JTVI7CiAJfQogCiAJaWYg
KHBzcl9paXIgJiBFRFBfUFNSX1BSRV9FTlRSWSh0cmFuc19zaGlmdCkpIHsKLQkJZGV2X3ByaXYt
PnBzci5sYXN0X2VudHJ5X2F0dGVtcHQgPSB0aW1lX25zOwotCQlkcm1fZGJnX2ttcygmZGV2X3By
aXYtPmRybSwKLQkJCSAgICAiW3RyYW5zY29kZXIgJXNdIFBTUiBlbnRyeSBhdHRlbXB0IGluIDIg
dmJsYW5rc1xuIiwKLQkJCSAgICB0cmFuc2NvZGVyX25hbWUoY3B1X3RyYW5zY29kZXIpKTsKKwkJ
aW50ZWxfZHAtPnBzci5sYXN0X2VudHJ5X2F0dGVtcHQgPSB0aW1lX25zOworCQlEUk1fREVCVUdf
S01TKCJbdHJhbnNjb2RlciAlc10gUFNSIGVudHJ5IGF0dGVtcHQgaW4gMiB2YmxhbmtzXG4iLAor
CQkJICAgICAgdHJhbnNjb2Rlcl9uYW1lKGNwdV90cmFuc2NvZGVyKSk7CiAJfQogCiAJaWYgKHBz
cl9paXIgJiBFRFBfUFNSX1BPU1RfRVhJVCh0cmFuc19zaGlmdCkpIHsKLQkJZGV2X3ByaXYtPnBz
ci5sYXN0X2V4aXQgPSB0aW1lX25zOwotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKLQkJ
CSAgICAiW3RyYW5zY29kZXIgJXNdIFBTUiBleGl0IGNvbXBsZXRlZFxuIiwKLQkJCSAgICB0cmFu
c2NvZGVyX25hbWUoY3B1X3RyYW5zY29kZXIpKTsKKwkJaW50ZWxfZHAtPnBzci5sYXN0X2V4aXQg
PSB0aW1lX25zOworCQlEUk1fREVCVUdfS01TKCJbdHJhbnNjb2RlciAlc10gUFNSIGV4aXQgY29t
cGxldGVkXG4iLAorCQkJICAgICAgdHJhbnNjb2Rlcl9uYW1lKGNwdV90cmFuc2NvZGVyKSk7CiAK
IAkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkgewogCQkJdTMyIHZhbCA9IGludGVsX2Rl
X3JlYWQoZGV2X3ByaXYsCiAJCQkJCQlQU1JfRVZFTlQoY3B1X3RyYW5zY29kZXIpKTsKLQkJCWJv
b2wgcHNyMl9lbmFibGVkID0gZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQ7CisJCQlib29sIHBz
cjJfZW5hYmxlZCA9IGludGVsX2RwLT5wc3IucHNyMl9lbmFibGVkOwogCiAJCQlpbnRlbF9kZV93
cml0ZShkZXZfcHJpdiwgUFNSX0VWRU5UKGNwdV90cmFuc2NvZGVyKSwKIAkJCQkgICAgICAgdmFs
KTsKQEAgLTIxMywxMCArMjE1LDEwIEBAIHZvaWQgaW50ZWxfcHNyX2lycV9oYW5kbGVyKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIHBzcl9paXIpCiAJaWYgKHBzcl9paXIg
JiBFRFBfUFNSX0VSUk9SKHRyYW5zX3NoaWZ0KSkgewogCQl1MzIgdmFsOwogCi0JCWRybV93YXJu
KCZkZXZfcHJpdi0+ZHJtLCAiW3RyYW5zY29kZXIgJXNdIFBTUiBhdXggZXJyb3JcbiIsCisJCURS
TV9XQVJOKCJbdHJhbnNjb2RlciAlc10gUFNSIGF1eCBlcnJvclxuIiwKIAkJCSB0cmFuc2NvZGVy
X25hbWUoY3B1X3RyYW5zY29kZXIpKTsKIAotCQlkZXZfcHJpdi0+cHNyLmlycV9hdXhfZXJyb3Ig
PSB0cnVlOworCQlpbnRlbF9kcC0+cHNyLmlycV9hdXhfZXJyb3IgPSB0cnVlOwogCiAJCS8qCiAJ
CSAqIElmIHRoaXMgaW50ZXJydXB0aW9uIGlzIG5vdCBtYXNrZWQgaXQgd2lsbCBrZWVwCkBAIC0y
MzAsNyArMjMyLDcgQEAgdm9pZCBpbnRlbF9wc3JfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgcHNyX2lpcikKIAkJdmFsIHw9IEVEUF9QU1JfRVJST1Io
dHJhbnNfc2hpZnQpOwogCQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgaW1yX3JlZywgdmFsKTsK
IAotCQlzY2hlZHVsZV93b3JrKCZkZXZfcHJpdi0+cHNyLndvcmspOworCQlzY2hlZHVsZV93b3Jr
KCZpbnRlbF9kcC0+cHNyLndvcmspOwogCX0KIH0KIApAQCAtMjkxLDEyICsyOTMsNiBAQCB2b2lk
IGludGVsX3Bzcl9pbml0X2RwY2Qoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQogCQl0b19pOTE1KGRwX3RvX2RpZ19wb3J0KGlu
dGVsX2RwKS0+YmFzZS5iYXNlLmRldik7CiAKLQlpZiAoZGV2X3ByaXYtPnBzci5kcCkgewotCQlk
cm1fd2FybigmZGV2X3ByaXYtPmRybSwKLQkJCSAiTW9yZSB0aGFuIG9uZSBlRFAgcGFuZWwgZm91
bmQsIFBTUiBzdXBwb3J0IHNob3VsZCBiZSBleHRlbmRlZFxuIik7Ci0JCXJldHVybjsKLQl9Ci0K
IAlkcm1fZHBfZHBjZF9yZWFkKCZpbnRlbF9kcC0+YXV4LCBEUF9QU1JfU1VQUE9SVCwgaW50ZWxf
ZHAtPnBzcl9kcGNkLAogCQkJIHNpemVvZihpbnRlbF9kcC0+cHNyX2RwY2QpKTsKIApAQCAtMzE3
LDEyICszMTMsMTAgQEAgdm9pZCBpbnRlbF9wc3JfaW5pdF9kcGNkKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHApCiAJCXJldHVybjsKIAl9CiAKLQlkZXZfcHJpdi0+cHNyLnNpbmtfc3VwcG9ydCA9
IHRydWU7Ci0JZGV2X3ByaXYtPnBzci5zaW5rX3N5bmNfbGF0ZW5jeSA9CisJaW50ZWxfZHAtPnBz
ci5zaW5rX3N1cHBvcnQgPSB0cnVlOworCWludGVsX2RwLT5wc3Iuc2lua19zeW5jX2xhdGVuY3kg
PQogCQlpbnRlbF9kcF9nZXRfc2lua19zeW5jX2xhdGVuY3koaW50ZWxfZHApOwogCi0JZGV2X3By
aXYtPnBzci5kcCA9IGludGVsX2RwOwotCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSAm
JgogCSAgICAoaW50ZWxfZHAtPnBzcl9kcGNkWzBdID09IERQX1BTUjJfV0lUSF9ZX0NPT1JEX0lT
X1NVUFBPUlRFRCkpIHsKIAkJYm9vbCB5X3JlcSA9IGludGVsX2RwLT5wc3JfZHBjZFsxXSAmCkBA
IC0zNDAsMTQgKzMzNCwxNCBAQCB2b2lkIGludGVsX3Bzcl9pbml0X2RwY2Qoc3RydWN0IGludGVs
X2RwICppbnRlbF9kcCkKIAkJICogWS1jb29yZGluYXRlIHJlcXVpcmVtZW50IHBhbmVscyB3ZSB3
b3VsZCBuZWVkIHRvIGVuYWJsZQogCQkgKiBHVEMgZmlyc3QuCiAJCSAqLwotCQlkZXZfcHJpdi0+
cHNyLnNpbmtfcHNyMl9zdXBwb3J0ID0geV9yZXEgJiYgYWxwbTsKKwkJaW50ZWxfZHAtPnBzci5z
aW5rX3BzcjJfc3VwcG9ydCA9IHlfcmVxICYmIGFscG07CiAJCWRybV9kYmdfa21zKCZkZXZfcHJp
di0+ZHJtLCAiUFNSMiAlc3N1cHBvcnRlZFxuIiwKLQkJCSAgICBkZXZfcHJpdi0+cHNyLnNpbmtf
cHNyMl9zdXBwb3J0ID8gIiIgOiAibm90ICIpOworCQkJICAgIGludGVsX2RwLT5wc3Iuc2lua19w
c3IyX3N1cHBvcnQgPyAiIiA6ICJub3QgIik7CiAKLQkJaWYgKGRldl9wcml2LT5wc3Iuc2lua19w
c3IyX3N1cHBvcnQpIHsKLQkJCWRldl9wcml2LT5wc3IuY29sb3JpbWV0cnlfc3VwcG9ydCA9CisJ
CWlmIChpbnRlbF9kcC0+cHNyLnNpbmtfcHNyMl9zdXBwb3J0KSB7CisJCQlpbnRlbF9kcC0+cHNy
LmNvbG9yaW1ldHJ5X3N1cHBvcnQgPQogCQkJCWludGVsX2RwX2dldF9jb2xvcmltZXRyeV9zdGF0
dXMoaW50ZWxfZHApOwotCQkJZGV2X3ByaXYtPnBzci5zdV94X2dyYW51bGFyaXR5ID0KKwkJCWlu
dGVsX2RwLT5wc3Iuc3VfeF9ncmFudWxhcml0eSA9CiAJCQkJaW50ZWxfZHBfZ2V0X3N1X3hfZ3Jh
bnVsYXJ0aXkoaW50ZWxfZHApOwogCQl9CiAJfQpAQCAtMzczLDcgKzM2Nyw3IEBAIHN0YXRpYyB2
b2lkIGhzd19wc3Jfc2V0dXBfYXV4KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJQlVJTERf
QlVHX09OKHNpemVvZihhdXhfbXNnKSA+IDIwKTsKIAlmb3IgKGkgPSAwOyBpIDwgc2l6ZW9mKGF1
eF9tc2cpOyBpICs9IDQpCiAJCWludGVsX2RlX3dyaXRlKGRldl9wcml2LAotCQkJICAgICAgIEVE
UF9QU1JfQVVYX0RBVEEoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyLCBpID4+IDIpLAorCQkJICAg
ICAgIEVEUF9QU1JfQVVYX0RBVEEoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyLCBpID4+IDIpLAog
CQkJICAgICAgIGludGVsX2RwX3BhY2tfYXV4KCZhdXhfbXNnW2ldLCBzaXplb2YoYXV4X21zZykg
LSBpKSk7CiAKIAlhdXhfY2xvY2tfZGl2aWRlciA9IGludGVsX2RwLT5nZXRfYXV4X2Nsb2NrX2Rp
dmlkZXIoaW50ZWxfZHAsIDApOwpAQCAtMzg0LDcgKzM3OCw3IEBAIHN0YXRpYyB2b2lkIGhzd19w
c3Jfc2V0dXBfYXV4KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAKIAkvKiBTZWxlY3Qgb25s
eSB2YWxpZCBiaXRzIGZvciBTUkRfQVVYX0NUTCAqLwogCWF1eF9jdGwgJj0gcHNyX2F1eF9tYXNr
OwotCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBFRFBfUFNSX0FVWF9DVEwoZGV2X3ByaXYtPnBz
ci50cmFuc2NvZGVyKSwKKwlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRURQX1BTUl9BVVhfQ1RM
KGludGVsX2RwLT5wc3IudHJhbnNjb2RlciksCiAJCSAgICAgICBhdXhfY3RsKTsKIH0KIApAQCAt
Mzk0LDE0ICszODgsMTQgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHNyX2VuYWJsZV9zaW5rKHN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJdTggZHBjZF92YWwgPSBEUF9QU1JfRU5BQkxFOwogCiAJ
LyogRW5hYmxlIEFMUE0gYXQgc2luayBmb3IgcHNyMiAqLwotCWlmIChkZXZfcHJpdi0+cHNyLnBz
cjJfZW5hYmxlZCkgeworCWlmIChpbnRlbF9kcC0+cHNyLnBzcjJfZW5hYmxlZCkgewogCQlkcm1f
ZHBfZHBjZF93cml0ZWIoJmludGVsX2RwLT5hdXgsIERQX1JFQ0VJVkVSX0FMUE1fQ09ORklHLAog
CQkJCSAgIERQX0FMUE1fRU5BQkxFIHwKIAkJCQkgICBEUF9BTFBNX0xPQ0tfRVJST1JfSVJRX0hQ
RF9FTkFCTEUpOwogCiAJCWRwY2RfdmFsIHw9IERQX1BTUl9FTkFCTEVfUFNSMiB8IERQX1BTUl9J
UlFfSFBEX1dJVEhfQ1JDX0VSUk9SUzsKIAl9IGVsc2UgewotCQlpZiAoZGV2X3ByaXYtPnBzci5s
aW5rX3N0YW5kYnkpCisJCWlmIChpbnRlbF9kcC0+cHNyLmxpbmtfc3RhbmRieSkKIAkJCWRwY2Rf
dmFsIHw9IERQX1BTUl9NQUlOX0xJTktfQUNUSVZFOwogCiAJCWlmIChJTlRFTF9HRU4oZGV2X3By
aXYpID49IDgpCkBAIC00NjQsNyArNDU4LDcgQEAgc3RhdGljIHU4IHBzcl9jb21wdXRlX2lkbGVf
ZnJhbWVzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJICogb2ZmLWJ5LW9uZSBpc3N1ZSB0
aGF0IEhXIGhhcyBpbiBzb21lIGNhc2VzLgogCSAqLwogCWlkbGVfZnJhbWVzID0gbWF4KDYsIGRl
dl9wcml2LT52YnQucHNyLmlkbGVfZnJhbWVzKTsKLQlpZGxlX2ZyYW1lcyA9IG1heChpZGxlX2Zy
YW1lcywgZGV2X3ByaXYtPnBzci5zaW5rX3N5bmNfbGF0ZW5jeSArIDEpOworCWlkbGVfZnJhbWVz
ID0gbWF4KGlkbGVfZnJhbWVzLCBpbnRlbF9kcC0+cHNyLnNpbmtfc3luY19sYXRlbmN5ICsgMSk7
CiAKIAlpZiAoZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIGlkbGVfZnJhbWVzID4gMHhmKSkK
IAkJaWRsZV9mcmFtZXMgPSAweGY7CkBAIC00ODQsNyArNDc4LDcgQEAgc3RhdGljIHZvaWQgaHN3
X2FjdGl2YXRlX3BzcjEoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAlpZiAoSVNfSEFTV0VM
TChkZXZfcHJpdikpCiAJCXZhbCB8PSBFRFBfUFNSX01JTl9MSU5LX0VOVFJZX1RJTUVfOF9MSU5F
UzsKIAotCWlmIChkZXZfcHJpdi0+cHNyLmxpbmtfc3RhbmRieSkKKwlpZiAoaW50ZWxfZHAtPnBz
ci5saW5rX3N0YW5kYnkpCiAJCXZhbCB8PSBFRFBfUFNSX0xJTktfU1RBTkRCWTsKIAogCXZhbCB8
PSBpbnRlbF9wc3IxX2dldF90cF90aW1lKGludGVsX2RwKTsKQEAgLTQ5Miw5ICs0ODYsOSBAQCBz
dGF0aWMgdm9pZCBoc3dfYWN0aXZhdGVfcHNyMShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQog
CWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDgpCiAJCXZhbCB8PSBFRFBfUFNSX0NSQ19FTkFC
TEU7CiAKLQl2YWwgfD0gKGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIEVEUF9QU1JfQ1RMKGRldl9w
cml2LT5wc3IudHJhbnNjb2RlcikpICYKKwl2YWwgfD0gKGludGVsX2RlX3JlYWQoZGV2X3ByaXYs
IEVEUF9QU1JfQ1RMKGludGVsX2RwLT5wc3IudHJhbnNjb2RlcikpICYKIAkJRURQX1BTUl9SRVNU
T1JFX1BTUl9BQ1RJVkVfQ1RYX01BU0spOwotCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBFRFBf
UFNSX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpLCB2YWwpOworCWludGVsX2RlX3dyaXRl
KGRldl9wcml2LCBFRFBfUFNSX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpLCB2YWwpOwog
fQogCiBzdGF0aWMgdTMyIGludGVsX3BzcjJfZ2V0X3RwX3RpbWUoc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCkKQEAgLTUyOSw3ICs1MjMsNyBAQCBzdGF0aWMgdm9pZCBoc3dfYWN0aXZhdGVfcHNy
MihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49
IDEwIHx8IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKQogCQl2YWwgfD0gRURQX1lfQ09PUkRJTkFU
RV9FTkFCTEU7CiAKLQl2YWwgfD0gRURQX1BTUjJfRlJBTUVfQkVGT1JFX1NVKGRldl9wcml2LT5w
c3Iuc2lua19zeW5jX2xhdGVuY3kgKyAxKTsKKwl2YWwgfD0gRURQX1BTUjJfRlJBTUVfQkVGT1JF
X1NVKGludGVsX2RwLT5wc3Iuc2lua19zeW5jX2xhdGVuY3kgKyAxKTsKIAl2YWwgfD0gaW50ZWxf
cHNyMl9nZXRfdHBfdGltZShpbnRlbF9kcCk7CiAKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSAxMikgewpAQCAtNTQ4LDcgKzU0Miw3IEBAIHN0YXRpYyB2b2lkIGhzd19hY3RpdmF0ZV9wc3Iy
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJCXZhbCB8PSBFRFBfUFNSMl9GQVNUX1dBS0Uo
Nyk7CiAJfQogCi0JaWYgKGRldl9wcml2LT5wc3IucHNyMl9zZWxfZmV0Y2hfZW5hYmxlZCkgewor
CWlmIChpbnRlbF9kcC0+cHNyLnBzcjJfc2VsX2ZldGNoX2VuYWJsZWQpIHsKIAkJLyogV0EgMTQw
ODMzMDg0NyAqLwogCQlpZiAoSVNfVEdMX0RJU1BfUkVWSUQoZGV2X3ByaXYsIFRHTF9SRVZJRF9B
MCwgVEdMX1JFVklEX0EwKSB8fAogCQkgICAgSVNfUktMX1JFVklEKGRldl9wcml2LCBSS0xfUkVW
SURfQTAsIFJLTF9SRVZJRF9BMCkpCkBAIC01NTcsMjAgKzU1MSwyMCBAQCBzdGF0aWMgdm9pZCBo
c3dfYWN0aXZhdGVfcHNyMihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCQkJCSAgICAgRElT
X1JBTV9CWVBBU1NfUFNSMl9NQU5fVFJBQ0spOwogCiAJCWludGVsX2RlX3dyaXRlKGRldl9wcml2
LAotCQkJICAgICAgIFBTUjJfTUFOX1RSS19DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSwK
KwkJCSAgICAgICBQU1IyX01BTl9UUktfQ1RMKGludGVsX2RwLT5wc3IudHJhbnNjb2RlciksCiAJ
CQkgICAgICAgUFNSMl9NQU5fVFJLX0NUTF9FTkFCTEUpOwogCX0gZWxzZSBpZiAoSEFTX1BTUjJf
U0VMX0ZFVENIKGRldl9wcml2KSkgewogCQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwKLQkJCSAg
ICAgICBQU1IyX01BTl9UUktfQ1RMKGRldl9wcml2LT5wc3IudHJhbnNjb2RlciksIDApOworCQkJ
ICAgICAgIFBTUjJfTUFOX1RSS19DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSwgMCk7CiAJ
fQogCiAJLyoKIAkgKiBQU1IyIEhXIGlzIGluY29ycmVjdGx5IHVzaW5nIEVEUF9QU1JfVFAxX1RQ
M19TRUwgYW5kIEJTcGVjIGlzCiAJICogcmVjb21tZW5kaW5nIGtlZXAgdGhpcyBiaXQgdW5zZXQg
d2hpbGUgUFNSMiBpcyBlbmFibGVkLgogCSAqLwotCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBF
RFBfUFNSX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpLCAwKTsKKwlpbnRlbF9kZV93cml0
ZShkZXZfcHJpdiwgRURQX1BTUl9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSwgMCk7CiAK
LQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRURQX1BTUjJfQ1RMKGRldl9wcml2LT5wc3IudHJh
bnNjb2RlciksIHZhbCk7CisJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEVEUF9QU1IyX0NUTChp
bnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpLCB2YWwpOwogfQogCiBzdGF0aWMgYm9vbApAQCAtNTkz
LDU1ICs1ODcsNTggQEAgc3RhdGljIHUzMiBpbnRlbF9nZXRfZnJhbWVfdGltZV91cyhjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3N0YXRlKQogCQkJICAgIGRybV9tb2RlX3ZyZWZyZXNo
KCZjc3RhdGUtPmh3LmFkanVzdGVkX21vZGUpKTsKIH0KIAotc3RhdGljIHZvaWQgcHNyMl9wcm9n
cmFtX2lkbGVfZnJhbWVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRp
YyB2b2lkIHBzcjJfcHJvZ3JhbV9pZGxlX2ZyYW1lcyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2Rw
LAogCQkJCSAgICAgdTMyIGlkbGVfZnJhbWVzKQogeworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCXUzMiB2YWw7CiAKIAlpZGxlX2Zy
YW1lcyA8PD0gIEVEUF9QU1IyX0lETEVfRlJBTUVfU0hJRlQ7Ci0JdmFsID0gaW50ZWxfZGVfcmVh
ZChkZXZfcHJpdiwgRURQX1BTUjJfQ1RMKGRldl9wcml2LT5wc3IudHJhbnNjb2RlcikpOworCXZh
bCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIEVEUF9QU1IyX0NUTChpbnRlbF9kcC0+cHNyLnRy
YW5zY29kZXIpKTsKIAl2YWwgJj0gfkVEUF9QU1IyX0lETEVfRlJBTUVfTUFTSzsKIAl2YWwgfD0g
aWRsZV9mcmFtZXM7Ci0JaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEVEUF9QU1IyX0NUTChkZXZf
cHJpdi0+cHNyLnRyYW5zY29kZXIpLCB2YWwpOworCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBF
RFBfUFNSMl9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSwgdmFsKTsKIH0KIAotc3RhdGlj
IHZvaWQgdGdsX3BzcjJfZW5hYmxlX2RjM2NvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKK3N0YXRpYyB2b2lkIHRnbF9wc3IyX2VuYWJsZV9kYzNjbyhzdHJ1Y3QgaW50ZWxfZHAg
KmludGVsX2RwKQogewotCXBzcjJfcHJvZ3JhbV9pZGxlX2ZyYW1lcyhkZXZfcHJpdiwgMCk7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7
CisKKwlwc3IyX3Byb2dyYW1faWRsZV9mcmFtZXMoaW50ZWxfZHAsIDApOwogCWludGVsX2Rpc3Bs
YXlfcG93ZXJfc2V0X3RhcmdldF9kY19zdGF0ZShkZXZfcHJpdiwgRENfU1RBVEVfRU5fREMzQ08p
OwogfQogCi1zdGF0aWMgdm9pZCB0Z2xfcHNyMl9kaXNhYmxlX2RjM2NvKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIHRnbF9wc3IyX2Rpc2FibGVfZGMzY28o
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKLQlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2Rw
ID0gZGV2X3ByaXYtPnBzci5kcDsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSBkcF90b19pOTE1KGludGVsX2RwKTsKIAogCWludGVsX2Rpc3BsYXlfcG93ZXJfc2V0X3Rhcmdl
dF9kY19zdGF0ZShkZXZfcHJpdiwgRENfU1RBVEVfRU5fVVBUT19EQzYpOwotCXBzcjJfcHJvZ3Jh
bV9pZGxlX2ZyYW1lcyhkZXZfcHJpdiwgcHNyX2NvbXB1dGVfaWRsZV9mcmFtZXMoaW50ZWxfZHAp
KTsKKwlwc3IyX3Byb2dyYW1faWRsZV9mcmFtZXMoaW50ZWxfZHAsIHBzcl9jb21wdXRlX2lkbGVf
ZnJhbWVzKGludGVsX2RwKSk7CiB9CiAKIHN0YXRpYyB2b2lkIHRnbF9kYzNjb19kaXNhYmxlX3dv
cmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9Ci0JCWNvbnRhaW5lcl9vZih3b3JrLCB0eXBlb2YoKmRldl9wcml2KSwgcHNy
LmRjM2NvX3dvcmsud29yayk7CisJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9CisJCWNvbnRh
aW5lcl9vZih3b3JrLCB0eXBlb2YoKmludGVsX2RwKSwgcHNyLmRjM2NvX3dvcmsud29yayk7CiAK
LQltdXRleF9sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCW11dGV4X2xvY2soJmludGVsX2Rw
LT5wc3IubG9jayk7CiAJLyogSWYgZGVsYXllZCB3b3JrIGlzIHBlbmRpbmcsIGl0IGlzIG5vdCBp
ZGxlICovCi0JaWYgKGRlbGF5ZWRfd29ya19wZW5kaW5nKCZkZXZfcHJpdi0+cHNyLmRjM2NvX3dv
cmspKQorCWlmIChkZWxheWVkX3dvcmtfcGVuZGluZygmaW50ZWxfZHAtPnBzci5kYzNjb193b3Jr
KSkKIAkJZ290byB1bmxvY2s7CiAKLQl0Z2xfcHNyMl9kaXNhYmxlX2RjM2NvKGRldl9wcml2KTsK
Kwl0Z2xfcHNyMl9kaXNhYmxlX2RjM2NvKGludGVsX2RwKTsKIHVubG9jazoKLQltdXRleF91bmxv
Y2soJmRldl9wcml2LT5wc3IubG9jayk7CisJbXV0ZXhfdW5sb2NrKCZpbnRlbF9kcC0+cHNyLmxv
Y2spOwogfQogCi1zdGF0aWMgdm9pZCB0Z2xfZGlzYWxsb3dfZGMzY29fb25fcHNyMl9leGl0KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIHRnbF9kaXNhbGxv
d19kYzNjb19vbl9wc3IyX2V4aXQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKLQlpZiAo
IWRldl9wcml2LT5wc3IuZGMzY29fZW5hYmxlZCkKKwlpZiAoIWludGVsX2RwLT5wc3IuZGMzY29f
ZW5hYmxlZCkKIAkJcmV0dXJuOwogCi0JY2FuY2VsX2RlbGF5ZWRfd29yaygmZGV2X3ByaXYtPnBz
ci5kYzNjb193b3JrKTsKKwljYW5jZWxfZGVsYXllZF93b3JrKCZpbnRlbF9kcC0+cHNyLmRjM2Nv
X3dvcmspOwogCS8qIEJlZm9yZSBQU1IyIGV4aXQgZGlzYWxsb3cgZGMzY28qLwotCXRnbF9wc3Iy
X2Rpc2FibGVfZGMzY28oZGV2X3ByaXYpOworCXRnbF9wc3IyX2Rpc2FibGVfZGMzY28oaW50ZWxf
ZHApOwogfQogCiBzdGF0aWMgdm9pZApAQCAtNzE0LDcgKzcxMSw3IEBAIHN0YXRpYyBib29sIGlu
dGVsX3BzcjJfY29uZmlnX3ZhbGlkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJaW50IGNy
dGNfdmRpc3BsYXkgPSBjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfdmRpc3BsYXk7
CiAJaW50IHBzcl9tYXhfaCA9IDAsIHBzcl9tYXhfdiA9IDAsIG1heF9icHAgPSAwOwogCi0JaWYg
KCFkZXZfcHJpdi0+cHNyLnNpbmtfcHNyMl9zdXBwb3J0KQorCWlmICghaW50ZWxfZHAtPnBzci5z
aW5rX3BzcjJfc3VwcG9ydCkKIAkJcmV0dXJuIGZhbHNlOwogCiAJaWYgKCF0cmFuc2NvZGVyX2hh
c19wc3IyKGRldl9wcml2LCBjcnRjX3N0YXRlLT5jcHVfdHJhbnNjb2RlcikpIHsKQEAgLTcyNCw3
ICs3MjEsNyBAQCBzdGF0aWMgYm9vbCBpbnRlbF9wc3IyX2NvbmZpZ192YWxpZChzdHJ1Y3QgaW50
ZWxfZHAgKmludGVsX2RwLAogCQlyZXR1cm4gZmFsc2U7CiAJfQogCi0JaWYgKCFwc3IyX2dsb2Jh
bF9lbmFibGVkKGRldl9wcml2KSkgeworCWlmICghcHNyMl9nbG9iYWxfZW5hYmxlZChpbnRlbF9k
cCkpIHsKIAkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJQU1IyIGRpc2FibGVkIGJ5IGZs
YWdcbiIpOwogCQlyZXR1cm4gZmFsc2U7CiAJfQpAQCAtNzczLDEwICs3NzAsMTAgQEAgc3RhdGlj
IGJvb2wgaW50ZWxfcHNyMl9jb25maWdfdmFsaWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwK
IAkgKiBvbmx5IG5lZWQgdG8gdmFsaWRhdGUgdGhlIFNVIGJsb2NrIHdpZHRoIGlzIGEgbXVsdGlw
bGUgb2YKIAkgKiB4IGdyYW51bGFyaXR5LgogCSAqLwotCWlmIChjcnRjX2hkaXNwbGF5ICUgZGV2
X3ByaXYtPnBzci5zdV94X2dyYW51bGFyaXR5KSB7CisJaWYgKGNydGNfaGRpc3BsYXkgJSBpbnRl
bF9kcC0+cHNyLnN1X3hfZ3JhbnVsYXJpdHkpIHsKIAkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5k
cm0sCiAJCQkgICAgIlBTUjIgbm90IGVuYWJsZWQsIGhkaXNwbGF5KCVkKSBub3QgbXVsdGlwbGUg
b2YgJWRcbiIsCi0JCQkgICAgY3J0Y19oZGlzcGxheSwgZGV2X3ByaXYtPnBzci5zdV94X2dyYW51
bGFyaXR5KTsKKwkJCSAgICBjcnRjX2hkaXNwbGF5LCBpbnRlbF9kcC0+cHNyLnN1X3hfZ3JhbnVs
YXJpdHkpOwogCQlyZXR1cm4gZmFsc2U7CiAJfQogCkBAIC04MTEsMTMgKzgwOCwxMCBAQCB2b2lk
IGludGVsX3Bzcl9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCQkm
Y3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsKIAlpbnQgcHNyX3NldHVwX3RpbWU7CiAKLQlp
ZiAoIUNBTl9QU1IoZGV2X3ByaXYpKQorCWlmICghQ0FOX1BTUihpbnRlbF9kcCkpCiAJCXJldHVy
bjsKIAotCWlmIChpbnRlbF9kcCAhPSBkZXZfcHJpdi0+cHNyLmRwKQotCQlyZXR1cm47Ci0KLQlp
ZiAoIXBzcl9nbG9iYWxfZW5hYmxlZChkZXZfcHJpdikpIHsKKwlpZiAoIXBzcl9nbG9iYWxfZW5h
YmxlZChpbnRlbF9kcCkpIHsKIAkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJQU1IgZGlz
YWJsZWQgYnkgZmxhZ1xuIik7CiAJCXJldHVybjsKIAl9CkBAIC04MzQsNyArODI4LDcgQEAgdm9p
ZCBpbnRlbF9wc3JfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJ
cmV0dXJuOwogCX0KIAotCWlmIChkZXZfcHJpdi0+cHNyLnNpbmtfbm90X3JlbGlhYmxlKSB7CisJ
aWYgKGludGVsX2RwLT5wc3Iuc2lua19ub3RfcmVsaWFibGUpIHsKIAkJZHJtX2RiZ19rbXMoJmRl
dl9wcml2LT5kcm0sCiAJCQkgICAgIlBTUiBzaW5rIGltcGxlbWVudGF0aW9uIGlzIG5vdCByZWxp
YWJsZVxuIik7CiAJCXJldHVybjsKQEAgLTg3MCwyMyArODY0LDI0IEBAIHZvaWQgaW50ZWxfcHNy
X2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiBzdGF0aWMgdm9pZCBp
bnRlbF9wc3JfYWN0aXZhdGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKIAlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwllbnVt
IHRyYW5zY29kZXIgdHJhbnNjb2RlciA9IGludGVsX2RwLT5wc3IudHJhbnNjb2RlcjsKIAotCWlm
ICh0cmFuc2NvZGVyX2hhc19wc3IyKGRldl9wcml2LCBkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIp
KQorCWlmICh0cmFuc2NvZGVyX2hhc19wc3IyKGRldl9wcml2LCB0cmFuc2NvZGVyKSkKIAkJZHJt
X1dBUk5fT04oJmRldl9wcml2LT5kcm0sCi0JCQkgICAgaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwg
RURQX1BTUjJfQ1RMKGRldl9wcml2LT5wc3IudHJhbnNjb2RlcikpICYgRURQX1BTUjJfRU5BQkxF
KTsKKwkJCSAgICBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBFRFBfUFNSMl9DVEwodHJhbnNjb2Rl
cikpICYgRURQX1BTUjJfRU5BQkxFKTsKIAogCWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLAot
CQkgICAgaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgRURQX1BTUl9DVEwoZGV2X3ByaXYtPnBzci50
cmFuc2NvZGVyKSkgJiBFRFBfUFNSX0VOQUJMRSk7Ci0JZHJtX1dBUk5fT04oJmRldl9wcml2LT5k
cm0sIGRldl9wcml2LT5wc3IuYWN0aXZlKTsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJp
di0+cHNyLmxvY2spOworCQkgICAgaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgRURQX1BTUl9DVEwo
dHJhbnNjb2RlcikpICYgRURQX1BTUl9FTkFCTEUpOworCWRybV9XQVJOX09OKCZkZXZfcHJpdi0+
ZHJtLCBpbnRlbF9kcC0+cHNyLmFjdGl2ZSk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaW50ZWxf
ZHAtPnBzci5sb2NrKTsKIAogCS8qIHBzcjEgYW5kIHBzcjIgYXJlIG11dHVhbGx5IGV4Y2x1c2l2
ZS4qLwotCWlmIChkZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxlZCkKKwlpZiAoaW50ZWxfZHAtPnBz
ci5wc3IyX2VuYWJsZWQpCiAJCWhzd19hY3RpdmF0ZV9wc3IyKGludGVsX2RwKTsKIAllbHNlCiAJ
CWhzd19hY3RpdmF0ZV9wc3IxKGludGVsX2RwKTsKIAotCWRldl9wcml2LT5wc3IuYWN0aXZlID0g
dHJ1ZTsKKwlpbnRlbF9kcC0+cHNyLmFjdGl2ZSA9IHRydWU7CiB9CiAKIHN0YXRpYyB2b2lkIGlu
dGVsX3Bzcl9lbmFibGVfc291cmNlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCkBAIC05MDIs
NyArODk3LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHNyX2VuYWJsZV9zb3VyY2Uoc3RydWN0IGlu
dGVsX2RwICppbnRlbF9kcCwKIAlpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikgfHwgSVNfQlJPQURX
RUxMKGRldl9wcml2KSkKIAkJaHN3X3Bzcl9zZXR1cF9hdXgoaW50ZWxfZHApOwogCi0JaWYgKGRl
dl9wcml2LT5wc3IucHNyMl9lbmFibGVkICYmIChJU19HRU4oZGV2X3ByaXYsIDkpICYmCisJaWYg
KGludGVsX2RwLT5wc3IucHNyMl9lbmFibGVkICYmIChJU19HRU4oZGV2X3ByaXYsIDkpICYmCiAJ
CQkJCSAgICFJU19HRU1JTklMQUtFKGRldl9wcml2KSkpIHsKIAkJaTkxNV9yZWdfdCByZWcgPSBD
SElDS0VOX1RSQU5TKGNwdV90cmFuc2NvZGVyKTsKIAkJdTMyIGNoaWNrZW4gPSBpbnRlbF9kZV9y
ZWFkKGRldl9wcml2LCByZWcpOwpAQCAtOTI2LDEwICs5MjEsMTAgQEAgc3RhdGljIHZvaWQgaW50
ZWxfcHNyX2VuYWJsZV9zb3VyY2Uoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAlpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA8IDExKQogCQltYXNrIHw9IEVEUF9QU1JfREVCVUdfTUFTS19ESVNQ
X1JFR19XUklURTsKIAotCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBFRFBfUFNSX0RFQlVHKGRl
dl9wcml2LT5wc3IudHJhbnNjb2RlciksCisJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEVEUF9Q
U1JfREVCVUcoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSwKIAkJICAgICAgIG1hc2spOwogCi0J
cHNyX2lycV9jb250cm9sKGRldl9wcml2KTsKKwlwc3JfaXJxX2NvbnRyb2woaW50ZWxfZHApOwog
CiAJaWYgKGNydGNfc3RhdGUtPmRjM2NvX2V4aXRsaW5lKSB7CiAJCXUzMiB2YWw7CkBAIC05NDcs
MzAgKzk0MiwzMCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZW5hYmxlX3NvdXJjZShzdHJ1Y3Qg
aW50ZWxfZHAgKmludGVsX2RwLAogCiAJaWYgKEhBU19QU1JfSFdfVFJBQ0tJTkcoZGV2X3ByaXYp
ICYmIEhBU19QU1IyX1NFTF9GRVRDSChkZXZfcHJpdikpCiAJCWludGVsX2RlX3JtdyhkZXZfcHJp
diwgQ0hJQ0tFTl9QQVIxXzEsIElHTk9SRV9QU1IyX0hXX1RSQUNLSU5HLAotCQkJICAgICBkZXZf
cHJpdi0+cHNyLnBzcjJfc2VsX2ZldGNoX2VuYWJsZWQgPworCQkJICAgICBpbnRlbF9kcC0+cHNy
LnBzcjJfc2VsX2ZldGNoX2VuYWJsZWQgPwogCQkJICAgICBJR05PUkVfUFNSMl9IV19UUkFDS0lO
RyA6IDApOwogfQogCi1zdGF0aWMgdm9pZCBpbnRlbF9wc3JfZW5hYmxlX2xvY2tlZChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZW5hYmxl
X2xvY2tlZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCQkJCSAgICBjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkgICAgY29uc3Qgc3RydWN0IGRybV9j
b25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCA9IGRldl9wcml2LT5wc3IuZHA7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGln
X3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7CiAJc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIgPSAmZGlnX3BvcnQtPmJhc2U7CiAJdTMyIHZhbDsKIAotCWRybV9XQVJOX09OKCZk
ZXZfcHJpdi0+ZHJtLCBkZXZfcHJpdi0+cHNyLmVuYWJsZWQpOworCWRybV9XQVJOX09OKCZkZXZf
cHJpdi0+ZHJtLCBpbnRlbF9kcC0+cHNyLmVuYWJsZWQpOwogCi0JZGV2X3ByaXYtPnBzci5wc3Iy
X2VuYWJsZWQgPSBjcnRjX3N0YXRlLT5oYXNfcHNyMjsKLQlkZXZfcHJpdi0+cHNyLmJ1c3lfZnJv
bnRidWZmZXJfYml0cyA9IDA7Ci0JZGV2X3ByaXYtPnBzci5waXBlID0gdG9faW50ZWxfY3J0Yyhj
cnRjX3N0YXRlLT51YXBpLmNydGMpLT5waXBlOwotCWRldl9wcml2LT5wc3IuZGMzY29fZW5hYmxl
ZCA9ICEhY3J0Y19zdGF0ZS0+ZGMzY29fZXhpdGxpbmU7Ci0JZGV2X3ByaXYtPnBzci50cmFuc2Nv
ZGVyID0gY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXI7CisJaW50ZWxfZHAtPnBzci5wc3IyX2Vu
YWJsZWQgPSBjcnRjX3N0YXRlLT5oYXNfcHNyMjsKKwlpbnRlbF9kcC0+cHNyLmJ1c3lfZnJvbnRi
dWZmZXJfYml0cyA9IDA7CisJaW50ZWxfZHAtPnBzci5waXBlID0gdG9faW50ZWxfY3J0YyhjcnRj
X3N0YXRlLT51YXBpLmNydGMpLT5waXBlOworCWludGVsX2RwLT5wc3IuZGMzY29fZW5hYmxlZCA9
ICEhY3J0Y19zdGF0ZS0+ZGMzY29fZXhpdGxpbmU7CisJaW50ZWxfZHAtPnBzci50cmFuc2NvZGVy
ID0gY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXI7CiAJLyogREM1L0RDNiByZXF1aXJlcyBhdCBs
ZWFzdCA2IGlkbGUgZnJhbWVzICovCiAJdmFsID0gdXNlY3NfdG9famlmZmllcyhpbnRlbF9nZXRf
ZnJhbWVfdGltZV91cyhjcnRjX3N0YXRlKSAqIDYpOwotCWRldl9wcml2LT5wc3IuZGMzY29fZXhp
dF9kZWxheSA9IHZhbDsKLQlkZXZfcHJpdi0+cHNyLnBzcjJfc2VsX2ZldGNoX2VuYWJsZWQgPSBj
cnRjX3N0YXRlLT5lbmFibGVfcHNyMl9zZWxfZmV0Y2g7CisJaW50ZWxfZHAtPnBzci5kYzNjb19l
eGl0X2RlbGF5ID0gdmFsOworCWludGVsX2RwLT5wc3IucHNyMl9zZWxfZmV0Y2hfZW5hYmxlZCA9
IGNydGNfc3RhdGUtPmVuYWJsZV9wc3IyX3NlbF9mZXRjaDsKIAogCS8qCiAJICogSWYgYSBQU1Ig
ZXJyb3IgaGFwcGVuZWQgYW5kIHRoZSBkcml2ZXIgaXMgcmVsb2FkZWQsIHRoZSBFRFBfUFNSX0lJ
UgpAQCAtOTgyLDI3ICs5NzcsMjcgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHNyX2VuYWJsZV9sb2Nr
ZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCSAqLwogCWlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDEyKSB7CiAJCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsCi0J
CQkJICAgIFRSQU5TX1BTUl9JSVIoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSk7CisJCQkJICAg
IFRSQU5TX1BTUl9JSVIoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSk7CiAJCXZhbCAmPSBFRFBf
UFNSX0VSUk9SKDApOwogCX0gZWxzZSB7CiAJCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYs
IEVEUF9QU1JfSUlSKTsKLQkJdmFsICY9IEVEUF9QU1JfRVJST1IoZGV2X3ByaXYtPnBzci50cmFu
c2NvZGVyKTsKKwkJdmFsICY9IEVEUF9QU1JfRVJST1IoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVy
KTsKIAl9CiAJaWYgKHZhbCkgewotCQlkZXZfcHJpdi0+cHNyLnNpbmtfbm90X3JlbGlhYmxlID0g
dHJ1ZTsKKwkJaW50ZWxfZHAtPnBzci5zaW5rX25vdF9yZWxpYWJsZSA9IHRydWU7CiAJCWRybV9k
Ymdfa21zKCZkZXZfcHJpdi0+ZHJtLAogCQkJICAgICJQU1IgaW50ZXJydXB0aW9uIGVycm9yIHNl
dCwgbm90IGVuYWJsaW5nIFBTUlxuIik7CiAJCXJldHVybjsKIAl9CiAKIAlkcm1fZGJnX2ttcygm
ZGV2X3ByaXYtPmRybSwgIkVuYWJsaW5nIFBTUiVzXG4iLAotCQkgICAgZGV2X3ByaXYtPnBzci5w
c3IyX2VuYWJsZWQgPyAiMiIgOiAiMSIpOworCQkgICAgaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJs
ZWQgPyAiMiIgOiAiMSIpOwogCWludGVsX2RwX2NvbXB1dGVfcHNyX3ZzY19zZHAoaW50ZWxfZHAs
IGNydGNfc3RhdGUsIGNvbm5fc3RhdGUsCi0JCQkJICAgICAmZGV2X3ByaXYtPnBzci52c2MpOwot
CWludGVsX3dyaXRlX2RwX3ZzY19zZHAoZW5jb2RlciwgY3J0Y19zdGF0ZSwgJmRldl9wcml2LT5w
c3IudnNjKTsKKwkJCQkgICAgICZpbnRlbF9kcC0+cHNyLnZzYyk7CisJaW50ZWxfd3JpdGVfZHBf
dnNjX3NkcChlbmNvZGVyLCBjcnRjX3N0YXRlLCAmaW50ZWxfZHAtPnBzci52c2MpOwogCWludGVs
X3Bzcl9lbmFibGVfc2luayhpbnRlbF9kcCk7CiAJaW50ZWxfcHNyX2VuYWJsZV9zb3VyY2UoaW50
ZWxfZHAsIGNydGNfc3RhdGUpOwotCWRldl9wcml2LT5wc3IuZW5hYmxlZCA9IHRydWU7CisJaW50
ZWxfZHAtPnBzci5lbmFibGVkID0gdHJ1ZTsKIAogCWludGVsX3Bzcl9hY3RpdmF0ZShpbnRlbF9k
cCk7CiB9CkBAIC0xMDIxLDU2ICsxMDE2LDU3IEBAIHZvaWQgaW50ZWxfcHNyX2VuYWJsZShzdHJ1
Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCi0JaWYgKCFDQU5fUFNSKGRldl9wcml2KSB8
fCBkZXZfcHJpdi0+cHNyLmRwICE9IGludGVsX2RwKQorCWlmICghQ0FOX1BTUihpbnRlbF9kcCkp
CiAJCXJldHVybjsKIAotCWRldl9wcml2LT5wc3IuZm9yY2VfbW9kZV9jaGFuZ2VkID0gZmFsc2U7
CisJaW50ZWxfZHAtPnBzci5mb3JjZV9tb2RlX2NoYW5nZWQgPSBmYWxzZTsKIAogCWlmICghY3J0
Y19zdGF0ZS0+aGFzX3BzcikKIAkJcmV0dXJuOwogCiAJZHJtX1dBUk5fT04oJmRldl9wcml2LT5k
cm0sIGRldl9wcml2LT5kcnJzLmRwKTsKIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5wc3IubG9j
ayk7Ci0JaW50ZWxfcHNyX2VuYWJsZV9sb2NrZWQoZGV2X3ByaXYsIGNydGNfc3RhdGUsIGNvbm5f
c3RhdGUpOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRleF9sb2Nr
KCZpbnRlbF9kcC0+cHNyLmxvY2spOworCWludGVsX3Bzcl9lbmFibGVfbG9ja2VkKGludGVsX2Rw
LCBjcnRjX3N0YXRlLCBjb25uX3N0YXRlKTsKKwltdXRleF91bmxvY2soJmludGVsX2RwLT5wc3Iu
bG9jayk7CiB9CiAKLXN0YXRpYyB2b2lkIGludGVsX3Bzcl9leGl0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGludGVsX3Bzcl9leGl0KHN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHApCiB7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
ZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJdTMyIHZhbDsKIAotCWlmICghZGV2X3ByaXYtPnBzci5h
Y3RpdmUpIHsKLQkJaWYgKHRyYW5zY29kZXJfaGFzX3BzcjIoZGV2X3ByaXYsIGRldl9wcml2LT5w
c3IudHJhbnNjb2RlcikpIHsKKwlpZiAoIWludGVsX2RwLT5wc3IuYWN0aXZlKSB7CisJCWlmICh0
cmFuc2NvZGVyX2hhc19wc3IyKGRldl9wcml2LCBpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpKSB7
CiAJCQl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LAotCQkJCQkgICAgRURQX1BTUjJfQ1RM
KGRldl9wcml2LT5wc3IudHJhbnNjb2RlcikpOworCQkJCQkgICAgRURQX1BTUjJfQ1RMKGludGVs
X2RwLT5wc3IudHJhbnNjb2RlcikpOwogCQkJZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIHZh
bCAmIEVEUF9QU1IyX0VOQUJMRSk7CiAJCX0KIAogCQl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9w
cml2LAotCQkJCSAgICBFRFBfUFNSX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpKTsKKwkJ
CQkgICAgRURQX1BTUl9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSk7CiAJCWRybV9XQVJO
X09OKCZkZXZfcHJpdi0+ZHJtLCB2YWwgJiBFRFBfUFNSX0VOQUJMRSk7CiAKIAkJcmV0dXJuOwog
CX0KIAotCWlmIChkZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxlZCkgewotCQl0Z2xfZGlzYWxsb3df
ZGMzY29fb25fcHNyMl9leGl0KGRldl9wcml2KTsKKwlpZiAoaW50ZWxfZHAtPnBzci5wc3IyX2Vu
YWJsZWQpIHsKKwkJdGdsX2Rpc2FsbG93X2RjM2NvX29uX3BzcjJfZXhpdChpbnRlbF9kcCk7CiAJ
CXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsCi0JCQkJICAgIEVEUF9QU1IyX0NUTChkZXZf
cHJpdi0+cHNyLnRyYW5zY29kZXIpKTsKKwkJCQkgICAgRURQX1BTUjJfQ1RMKGludGVsX2RwLT5w
c3IudHJhbnNjb2RlcikpOwogCQlkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwgISh2YWwgJiBF
RFBfUFNSMl9FTkFCTEUpKTsKIAkJdmFsICY9IH5FRFBfUFNSMl9FTkFCTEU7CiAJCWludGVsX2Rl
X3dyaXRlKGRldl9wcml2LAotCQkJICAgICAgIEVEUF9QU1IyX0NUTChkZXZfcHJpdi0+cHNyLnRy
YW5zY29kZXIpLCB2YWwpOworCQkJICAgICAgIEVEUF9QU1IyX0NUTChpbnRlbF9kcC0+cHNyLnRy
YW5zY29kZXIpLCB2YWwpOwogCX0gZWxzZSB7CiAJCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3By
aXYsCi0JCQkJICAgIEVEUF9QU1JfQ1RMKGRldl9wcml2LT5wc3IudHJhbnNjb2RlcikpOworCQkJ
CSAgICBFRFBfUFNSX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpKTsKIAkJZHJtX1dBUk5f
T04oJmRldl9wcml2LT5kcm0sICEodmFsICYgRURQX1BTUl9FTkFCTEUpKTsKIAkJdmFsICY9IH5F
RFBfUFNSX0VOQUJMRTsKIAkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsCi0JCQkgICAgICAgRURQ
X1BTUl9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSwgdmFsKTsKKwkJCSAgICAgICBFRFBf
UFNSX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpLCB2YWwpOwogCX0KLQlkZXZfcHJpdi0+
cHNyLmFjdGl2ZSA9IGZhbHNlOworCWludGVsX2RwLT5wc3IuYWN0aXZlID0gZmFsc2U7CiB9CiAK
IHN0YXRpYyB2b2lkIGludGVsX3Bzcl9kaXNhYmxlX2xvY2tlZChzdHJ1Y3QgaW50ZWxfZHAgKmlu
dGVsX2RwKQpAQCAtMTA3OSwyMSArMTA3NSwyMSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZGlz
YWJsZV9sb2NrZWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAlpOTE1X3JlZ190IHBzcl9z
dGF0dXM7CiAJdTMyIHBzcl9zdGF0dXNfbWFzazsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmRl
dl9wcml2LT5wc3IubG9jayk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaW50ZWxfZHAtPnBzci5s
b2NrKTsKIAotCWlmICghZGV2X3ByaXYtPnBzci5lbmFibGVkKQorCWlmICghaW50ZWxfZHAtPnBz
ci5lbmFibGVkKQogCQlyZXR1cm47CiAKIAlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgIkRp
c2FibGluZyBQU1Ilc1xuIiwKLQkJICAgIGRldl9wcml2LT5wc3IucHNyMl9lbmFibGVkID8gIjIi
IDogIjEiKTsKKwkJICAgIGludGVsX2RwLT5wc3IucHNyMl9lbmFibGVkID8gIjIiIDogIjEiKTsK
IAotCWludGVsX3Bzcl9leGl0KGRldl9wcml2KTsKKwlpbnRlbF9wc3JfZXhpdChpbnRlbF9kcCk7
CiAKLQlpZiAoZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQpIHsKLQkJcHNyX3N0YXR1cyA9IEVE
UF9QU1IyX1NUQVRVUyhkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpOworCWlmIChpbnRlbF9kcC0+
cHNyLnBzcjJfZW5hYmxlZCkgeworCQlwc3Jfc3RhdHVzID0gRURQX1BTUjJfU1RBVFVTKGludGVs
X2RwLT5wc3IudHJhbnNjb2Rlcik7CiAJCXBzcl9zdGF0dXNfbWFzayA9IEVEUF9QU1IyX1NUQVRV
U19TVEFURV9NQVNLOwogCX0gZWxzZSB7Ci0JCXBzcl9zdGF0dXMgPSBFRFBfUFNSX1NUQVRVUyhk
ZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpOworCQlwc3Jfc3RhdHVzID0gRURQX1BTUl9TVEFUVVMo
aW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKTsKIAkJcHNyX3N0YXR1c19tYXNrID0gRURQX1BTUl9T
VEFUVVNfU1RBVEVfTUFTSzsKIAl9CiAKQEAgLTExMDMsNyArMTA5OSw3IEBAIHN0YXRpYyB2b2lk
IGludGVsX3Bzcl9kaXNhYmxlX2xvY2tlZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCQlk
cm1fZXJyKCZkZXZfcHJpdi0+ZHJtLCAiVGltZWQgb3V0IHdhaXRpbmcgUFNSIGlkbGUgc3RhdGVc
biIpOwogCiAJLyogV0EgMTQwODMzMDg0NyAqLwotCWlmIChkZXZfcHJpdi0+cHNyLnBzcjJfc2Vs
X2ZldGNoX2VuYWJsZWQgJiYKKwlpZiAoaW50ZWxfZHAtPnBzci5wc3IyX3NlbF9mZXRjaF9lbmFi
bGVkICYmCiAJICAgIChJU19UR0xfRElTUF9SRVZJRChkZXZfcHJpdiwgVEdMX1JFVklEX0EwLCBU
R0xfUkVWSURfQTApIHx8CiAJICAgICBJU19SS0xfUkVWSUQoZGV2X3ByaXYsIFJLTF9SRVZJRF9B
MCwgUktMX1JFVklEX0EwKSkpCiAJCWludGVsX2RlX3JtdyhkZXZfcHJpdiwgQ0hJQ0tFTl9QQVIx
XzEsCkBAIC0xMTEyLDEwICsxMTA4LDEwIEBAIHN0YXRpYyB2b2lkIGludGVsX3Bzcl9kaXNhYmxl
X2xvY2tlZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCS8qIERpc2FibGUgUFNSIG9uIFNp
bmsgKi8KIAlkcm1fZHBfZHBjZF93cml0ZWIoJmludGVsX2RwLT5hdXgsIERQX1BTUl9FTl9DRkcs
IDApOwogCi0JaWYgKGRldl9wcml2LT5wc3IucHNyMl9lbmFibGVkKQorCWlmIChpbnRlbF9kcC0+
cHNyLnBzcjJfZW5hYmxlZCkKIAkJZHJtX2RwX2RwY2Rfd3JpdGViKCZpbnRlbF9kcC0+YXV4LCBE
UF9SRUNFSVZFUl9BTFBNX0NPTkZJRywgMCk7CiAKLQlkZXZfcHJpdi0+cHNyLmVuYWJsZWQgPSBm
YWxzZTsKKwlpbnRlbF9kcC0+cHNyLmVuYWJsZWQgPSBmYWxzZTsKIH0KIAogLyoqCkBAIC0xMTMz
LDIwICsxMTI5LDIyIEBAIHZvaWQgaW50ZWxfcHNyX2Rpc2FibGUoc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCwKIAlpZiAoIW9sZF9jcnRjX3N0YXRlLT5oYXNfcHNyKQogCQlyZXR1cm47CiAKLQlp
ZiAoZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sICFDQU5fUFNSKGRldl9wcml2KSkpCisJaWYg
KGRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCAhQ0FOX1BTUihpbnRlbF9kcCkpKQogCQlyZXR1
cm47CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCW11dGV4X2xvY2soJmlu
dGVsX2RwLT5wc3IubG9jayk7CiAKIAlpbnRlbF9wc3JfZGlzYWJsZV9sb2NrZWQoaW50ZWxfZHAp
OwogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOwotCWNhbmNlbF93b3JrX3N5
bmMoJmRldl9wcml2LT5wc3Iud29yayk7Ci0JY2FuY2VsX2RlbGF5ZWRfd29ya19zeW5jKCZkZXZf
cHJpdi0+cHNyLmRjM2NvX3dvcmspOworCW11dGV4X3VubG9jaygmaW50ZWxfZHAtPnBzci5sb2Nr
KTsKKwljYW5jZWxfd29ya19zeW5jKCZpbnRlbF9kcC0+cHNyLndvcmspOworCWNhbmNlbF9kZWxh
eWVkX3dvcmtfc3luYygmaW50ZWxfZHAtPnBzci5kYzNjb193b3JrKTsKIH0KIAotc3RhdGljIHZv
aWQgcHNyX2ZvcmNlX2h3X3RyYWNraW5nX2V4aXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQorc3RhdGljIHZvaWQgcHNyX2ZvcmNlX2h3X3RyYWNraW5nX2V4aXQoc3RydWN0IGlu
dGVsX2RwICppbnRlbF9kcCkKIHsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSBkcF90b19pOTE1KGludGVsX2RwKTsKKwogCWlmIChJU19USUdFUkxBS0UoZGV2X3ByaXYpKQog
CQkvKgogCQkgKiBXcml0ZXMgdG8gQ1VSU1VSRkxJVkUgaW4gVEdMIGFyZSBjYXVzaW5nIElPTU1V
IGVycm9ycyBhbmQKQEAgLTExNjAsNyArMTE1OCw3IEBAIHN0YXRpYyB2b2lkIHBzcl9mb3JjZV9o
d190cmFja2luZ19leGl0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJICog
U28gdXNpbmcgdGhpcyB3b3JrYXJvdW5kIHVudGlsIHRoaXMgaXNzdWUgaXMgcm9vdCBjYXVzZWQK
IAkJICogYW5kIGEgYmV0dGVyIGZpeCBpcyBmb3VuZC4KIAkJICovCi0JCWludGVsX3Bzcl9leGl0
KGRldl9wcml2KTsKKwkJaW50ZWxfcHNyX2V4aXQoaW50ZWxfZHApOwogCWVsc2UgaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPj0gOSkKIAkJLyoKIAkJICogRGlzcGxheSBXQSAjMDg4NDogc2tsKwpA
QCAtMTE3MSwxMyArMTE2OSwxMyBAQCBzdGF0aWMgdm9pZCBwc3JfZm9yY2VfaHdfdHJhY2tpbmdf
ZXhpdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCSAqIGJ1dCBpdCBtYWtl
cyBtb3JlIHNlbnNlIHdyaXRlIHRvIHRoZSBjdXJyZW50IGFjdGl2ZQogCQkgKiBwaXBlLgogCQkg
Ki8KLQkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIENVUlNVUkZMSVZFKGRldl9wcml2LT5wc3Iu
cGlwZSksIDApOworCQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgQ1VSU1VSRkxJVkUoaW50ZWxf
ZHAtPnBzci5waXBlKSwgMCk7CiAJZWxzZQogCQkvKgogCQkgKiBBIHdyaXRlIHRvIENVUlNVUkZM
SVZFIGRvIG5vdCBjYXVzZSBIVyB0cmFja2luZyB0byBleGl0IFBTUgogCQkgKiBvbiBvbGRlciBn
ZW5zIHNvIGRvaW5nIHRoZSBtYW51YWwgZXhpdCBpbnN0ZWFkLgogCQkgKi8KLQkJaW50ZWxfcHNy
X2V4aXQoZGV2X3ByaXYpOworCQlpbnRlbF9wc3JfZXhpdChpbnRlbF9kcCk7CiB9CiAKIHZvaWQg
aW50ZWxfcHNyMl9wcm9ncmFtX3BsYW5lX3NlbF9mZXRjaChzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBs
YW5lLApAQCAtMTIxMiwxMSArMTIxMCwxMSBAQCB2b2lkIGludGVsX3BzcjJfcHJvZ3JhbV9wbGFu
ZV9zZWxfZmV0Y2goc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAlpbnRlbF9kZV93cml0ZV9m
dyhkZXZfcHJpdiwgUExBTkVfU0VMX0ZFVENIX1NJWkUocGlwZSwgcGxhbmUtPmlkKSwgdmFsKTsK
IH0KIAotdm9pZCBpbnRlbF9wc3IyX3Byb2dyYW1fdHJhbnNfbWFuX3Rya19jdGwoY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit2b2lkIGludGVsX3BzcjJfcHJvZ3Jh
bV90cmFuc19tYW5fdHJrX2N0bChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAorCQkJCQkgIGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYp
OwotCXN0cnVjdCBpOTE1X3BzciAqcHNyID0gJmRldl9wcml2LT5wc3I7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisJc3RydWN0IGlu
dGVsX3BzciAqcHNyID0gJmludGVsX2RwLT5wc3I7CiAKIAlpZiAoIUhBU19QU1IyX1NFTF9GRVRD
SChkZXZfcHJpdikgfHwKIAkgICAgIWNydGNfc3RhdGUtPmVuYWJsZV9wc3IyX3NlbF9mZXRjaCkK
QEAgLTEzMjgsMTUgKzEzMjYsMTUgQEAgdm9pZCBpbnRlbF9wc3JfdXBkYXRlKHN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHAsCiAJCSAgICAgIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRl
ICpjb25uX3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRw
X3RvX2k5MTUoaW50ZWxfZHApOwotCXN0cnVjdCBpOTE1X3BzciAqcHNyID0gJmRldl9wcml2LT5w
c3I7CisJc3RydWN0IGludGVsX3BzciAqcHNyID0gJmludGVsX2RwLT5wc3I7CiAJYm9vbCBlbmFi
bGUsIHBzcjJfZW5hYmxlOwogCi0JaWYgKCFDQU5fUFNSKGRldl9wcml2KSB8fCBSRUFEX09OQ0Uo
cHNyLT5kcCkgIT0gaW50ZWxfZHApCisJaWYgKCFDQU5fUFNSKGludGVsX2RwKSkKIAkJcmV0dXJu
OwogCi0JZGV2X3ByaXYtPnBzci5mb3JjZV9tb2RlX2NoYW5nZWQgPSBmYWxzZTsKKwlpbnRlbF9k
cC0+cHNyLmZvcmNlX21vZGVfY2hhbmdlZCA9IGZhbHNlOwogCi0JbXV0ZXhfbG9jaygmZGV2X3By
aXYtPnBzci5sb2NrKTsKKwltdXRleF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOwogCiAJZW5h
YmxlID0gY3J0Y19zdGF0ZS0+aGFzX3BzcjsKIAlwc3IyX2VuYWJsZSA9IGNydGNfc3RhdGUtPmhh
c19wc3IyOwpAQCAtMTM0NCwxNSArMTM0MiwxNSBAQCB2b2lkIGludGVsX3Bzcl91cGRhdGUoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCwKIAlpZiAoZW5hYmxlID09IHBzci0+ZW5hYmxlZCAmJiBw
c3IyX2VuYWJsZSA9PSBwc3ItPnBzcjJfZW5hYmxlZCkgewogCQkvKiBGb3JjZSBhIFBTUiBleGl0
IHdoZW4gZW5hYmxpbmcgQ1JDIHRvIGF2b2lkIENSQyB0aW1lb3V0cyAqLwogCQlpZiAoY3J0Y19z
dGF0ZS0+Y3JjX2VuYWJsZWQgJiYgcHNyLT5lbmFibGVkKQotCQkJcHNyX2ZvcmNlX2h3X3RyYWNr
aW5nX2V4aXQoZGV2X3ByaXYpOworCQkJcHNyX2ZvcmNlX2h3X3RyYWNraW5nX2V4aXQoaW50ZWxf
ZHApOwogCQllbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgOSAmJiBwc3ItPmVuYWJsZWQp
IHsKIAkJCS8qCiAJCQkgKiBBY3RpdmF0ZSBQU1IgYWdhaW4gYWZ0ZXIgYSBmb3JjZSBleGl0IHdo
ZW4gZW5hYmxpbmcKIAkJCSAqIENSQyBpbiBvbGRlciBnZW5zCiAJCQkgKi8KLQkJCWlmICghZGV2
X3ByaXYtPnBzci5hY3RpdmUgJiYKLQkJCSAgICAhZGV2X3ByaXYtPnBzci5idXN5X2Zyb250YnVm
ZmVyX2JpdHMpCi0JCQkJc2NoZWR1bGVfd29yaygmZGV2X3ByaXYtPnBzci53b3JrKTsKKwkJCWlm
ICghaW50ZWxfZHAtPnBzci5hY3RpdmUgJiYKKwkJCSAgICAhaW50ZWxfZHAtPnBzci5idXN5X2Zy
b250YnVmZmVyX2JpdHMpCisJCQkJc2NoZWR1bGVfd29yaygmaW50ZWxfZHAtPnBzci53b3JrKTsK
IAkJfQogCiAJCWdvdG8gdW5sb2NrOwpAQCAtMTM2MiwzNCArMTM2MCwyMyBAQCB2b2lkIGludGVs
X3Bzcl91cGRhdGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJaW50ZWxfcHNyX2Rpc2Fi
bGVfbG9ja2VkKGludGVsX2RwKTsKIAogCWlmIChlbmFibGUpCi0JCWludGVsX3Bzcl9lbmFibGVf
bG9ja2VkKGRldl9wcml2LCBjcnRjX3N0YXRlLCBjb25uX3N0YXRlKTsKKwkJaW50ZWxfcHNyX2Vu
YWJsZV9sb2NrZWQoaW50ZWxfZHAsIGNydGNfc3RhdGUsIGNvbm5fc3RhdGUpOwogCiB1bmxvY2s6
Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCW11dGV4X3VubG9jaygmaW50
ZWxfZHAtPnBzci5sb2NrKTsKIH0KIAogLyoqCi0gKiBpbnRlbF9wc3Jfd2FpdF9mb3JfaWRsZSAt
IHdhaXQgZm9yIFBTUjEgdG8gaWRsZQotICogQG5ld19jcnRjX3N0YXRlOiBuZXcgQ1JUQyBzdGF0
ZQorICogcHNyX3dhaXRfZm9yX2lkbGUgLSB3YWl0IGZvciBQU1IxIHRvIGlkbGUKKyAqIEBpbnRl
bF9kcDogSW50ZWwgRFAKICAqIEBvdXRfdmFsdWU6IFBTUiBzdGF0dXMgaW4gY2FzZSBvZiBmYWls
dXJlCiAgKgotICogVGhpcyBmdW5jdGlvbiBpcyBleHBlY3RlZCB0byBiZSBjYWxsZWQgZnJvbSBw
aXBlX3VwZGF0ZV9zdGFydCgpIHdoZXJlIGl0IGlzCi0gKiBub3QgZXhwZWN0ZWQgdG8gcmFjZSB3
aXRoIFBTUiBlbmFibGUgb3IgZGlzYWJsZS4KLSAqCiAgKiBSZXR1cm5zOiAwIG9uIHN1Y2Nlc3Mg
b3IgLUVUSU1FT1VUIGlmIFBTUiBzdGF0dXMgZG9lcyBub3QgaWRsZS4KKyAqCiAgKi8KLWludCBp
bnRlbF9wc3Jfd2FpdF9mb3JfaWRsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3
X2NydGNfc3RhdGUsCi0JCQkgICAgdTMyICpvdXRfdmFsdWUpCitzdGF0aWMgaW50IHBzcl93YWl0
X2Zvcl9pZGxlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIHUzMiAqb3V0X3ZhbHVlKQogewot
CXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhuZXdfY3J0Y19zdGF0ZS0+
dWFwaS5jcnRjKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGNydGMtPmJhc2UuZGV2KTsKLQotCWlmICghZGV2X3ByaXYtPnBzci5lbmFibGVkIHx8ICFuZXdf
Y3J0Y19zdGF0ZS0+aGFzX3BzcikKLQkJcmV0dXJuIDA7Ci0KLQkvKiBGSVhNRTogVXBkYXRlIHRo
aXMgZm9yIFBTUjIgaWYgd2UgbmVlZCB0byB3YWl0IGZvciBpZGxlICovCi0JaWYgKFJFQURfT05D
RShkZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxlZCkpCi0JCXJldHVybiAwOworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCiAJLyoKIAkg
KiBGcm9tIGJzcGVjOiBQYW5lbCBTZWxmIFJlZnJlc2ggKEJEVyspCkBAIC0xMzk3LDMyICsxMzg0
LDY3IEBAIGludCBpbnRlbF9wc3Jfd2FpdF9mb3JfaWRsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUsCiAJICogZXhpdCB0cmFpbmluZyB0aW1lICsgMS41IG1z
IG9mIGF1eCBjaGFubmVsIGhhbmRzaGFrZS4gNTAgbXMgaXMKIAkgKiBkZWZlbnNpdmUgZW5vdWdo
IHRvIGNvdmVyIGV2ZXJ5dGhpbmcuCiAJICovCi0KIAlyZXR1cm4gX19pbnRlbF93YWl0X2Zvcl9y
ZWdpc3RlcigmZGV2X3ByaXYtPnVuY29yZSwKLQkJCQkJIEVEUF9QU1JfU1RBVFVTKGRldl9wcml2
LT5wc3IudHJhbnNjb2RlciksCisJCQkJCSBFRFBfUFNSX1NUQVRVUyhpbnRlbF9kcC0+cHNyLnRy
YW5zY29kZXIpLAogCQkJCQkgRURQX1BTUl9TVEFUVVNfU1RBVEVfTUFTSywKIAkJCQkJIEVEUF9Q
U1JfU1RBVFVTX1NUQVRFX0lETEUsIDIsIDUwLAogCQkJCQkgb3V0X3ZhbHVlKTsKIH0KIAotc3Rh
dGljIGJvb2wgX19wc3Jfd2FpdF9mb3JfaWRsZV9sb2NrZWQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQorLyoqCisgKiBpbnRlbF9wc3Jfd2FpdF9mb3JfaWRsZSAtIHdhaXQgZm9y
IFBTUjEgdG8gaWRsZQorICogQG5ld19jcnRjX3N0YXRlOiBuZXcgQ1JUQyBzdGF0ZQorICoKKyAq
IFRoaXMgZnVuY3Rpb24gaXMgZXhwZWN0ZWQgdG8gYmUgY2FsbGVkIGZyb20gcGlwZV91cGRhdGVf
c3RhcnQoKSB3aGVyZSBpdCBpcworICogbm90IGV4cGVjdGVkIHRvIHJhY2Ugd2l0aCBQU1IgZW5h
YmxlIG9yIGRpc2FibGUuCisgKi8KK3ZvaWQgaW50ZWxfcHNyX3dhaXRfZm9yX2lkbGUoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKQoreworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUobmV3X2NydGNfc3RhdGUtPnVhcGkuY3J0
Yy0+ZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKKwl1MzIgcHNyX3N0YXR1
czsKKworCWlmICghbmV3X2NydGNfc3RhdGUtPmhhc19wc3IpCisJCXJldHVybjsKKworCWZvcl9l
YWNoX2ludGVsX2RwKCZkZXZfcHJpdi0+ZHJtLCBlbmNvZGVyKSB7CisJCXN0cnVjdCBpbnRlbF9k
cCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5jb2Rlcik7CisKKwkJaWYgKGVuY29kZXIt
PnR5cGUgIT0gSU5URUxfT1VUUFVUX0VEUCkKKwkJCWNvbnRpbnVlOworCisJCS8qIHdoZW4gdGhl
IFBTUjEgaXMgZW5hYmxlZCAqLworCQlpZiAoaW50ZWxfZHAtPnBzci5lbmFibGVkICYmICFpbnRl
bF9kcC0+cHNyLnBzcjJfZW5hYmxlZCkgeworCQkJaWYgKHBzcl93YWl0X2Zvcl9pZGxlKGludGVs
X2RwLCAmcHNyX3N0YXR1cykpCisJCQkJZHJtX2VycigmZGV2X3ByaXYtPmRybSwKKwkJCQkJIlBT
UiBpZGxlIHRpbWVkIG91dCAweCV4LCBhdG9taWMgdXBkYXRlIG1heSBmYWlsXG4iLAorCQkJCQlw
c3Jfc3RhdHVzKTsKKworCQkJLyogb25seSBvbmUgdHJhbmNvZGVyIGNhbiBlbmFibGUgUFNSMSAq
LworCQkJYnJlYWs7CisJCX0KKwl9Cit9CisKK3N0YXRpYyBib29sIF9fcHNyX3dhaXRfZm9yX2lk
bGVfbG9ja2VkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CiAJaTkxNV9yZWdfdCByZWc7
CiAJdTMyIG1hc2s7CiAJaW50IGVycjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAotCWlmICghZGV2X3ByaXYtPnBzci5lbmFibGVk
KQorCWlmICghaW50ZWxfZHAtPnBzci5lbmFibGVkKQogCQlyZXR1cm4gZmFsc2U7CiAKLQlpZiAo
ZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQpIHsKLQkJcmVnID0gRURQX1BTUjJfU1RBVFVTKGRl
dl9wcml2LT5wc3IudHJhbnNjb2Rlcik7CisJaWYgKGludGVsX2RwLT5wc3IucHNyMl9lbmFibGVk
KSB7CisJCXJlZyA9IEVEUF9QU1IyX1NUQVRVUyhpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpOwog
CQltYXNrID0gRURQX1BTUjJfU1RBVFVTX1NUQVRFX01BU0s7CiAJfSBlbHNlIHsKLQkJcmVnID0g
RURQX1BTUl9TVEFUVVMoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKTsKKwkJcmVnID0gRURQX1BT
Ul9TVEFUVVMoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKTsKIAkJbWFzayA9IEVEUF9QU1JfU1RB
VFVTX1NUQVRFX01BU0s7CiAJfQogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2sp
OworCW11dGV4X3VubG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKIAogCWVyciA9IGludGVsX2Rl
X3dhaXRfZm9yX2NsZWFyKGRldl9wcml2LCByZWcsIG1hc2ssIDUwKTsKIAlpZiAoZXJyKQpAQCAt
MTQzMCw4ICsxNDUyLDggQEAgc3RhdGljIGJvb2wgX19wc3Jfd2FpdF9mb3JfaWRsZV9sb2NrZWQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQkJIlRpbWVkIG91dCB3YWl0aW5n
IGZvciBQU1IgSWRsZSBmb3IgcmUtZW5hYmxlXG4iKTsKIAogCS8qIEFmdGVyIHRoZSB1bmxvY2tl
ZCB3YWl0LCB2ZXJpZnkgdGhhdCBQU1IgaXMgc3RpbGwgd2FudGVkISAqLwotCW11dGV4X2xvY2so
JmRldl9wcml2LT5wc3IubG9jayk7Ci0JcmV0dXJuIGVyciA9PSAwICYmIGRldl9wcml2LT5wc3Iu
ZW5hYmxlZDsKKwltdXRleF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOworCXJldHVybiBlcnIg
PT0gMCAmJiBpbnRlbF9kcC0+cHNyLmVuYWJsZWQ7CiB9CiAKIHN0YXRpYyBpbnQgaW50ZWxfcHNy
X2Zhc3RzZXRfZm9yY2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQpAQCAtMTQ5
NywxMSArMTUxOSwxMiBAQCBzdGF0aWMgaW50IGludGVsX3Bzcl9mYXN0c2V0X2ZvcmNlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlyZXR1cm4gZXJyOwogfQogCi1pbnQgaW50
ZWxfcHNyX2RlYnVnX3NldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHU2NCB2
YWwpCitpbnQgaW50ZWxfcHNyX2RlYnVnX3NldChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCB1
NjQgdmFsKQogewogCWNvbnN0IHUzMiBtb2RlID0gdmFsICYgSTkxNV9QU1JfREVCVUdfTU9ERV9N
QVNLOwogCXUzMiBvbGRfbW9kZTsKIAlpbnQgcmV0OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCiAJaWYgKHZhbCAmIH4oSTkxNV9Q
U1JfREVCVUdfSVJRIHwgSTkxNV9QU1JfREVCVUdfTU9ERV9NQVNLKSB8fAogCSAgICBtb2RlID4g
STkxNV9QU1JfREVCVUdfRk9SQ0VfUFNSMSkgewpAQCAtMTUwOSwyMSArMTUzMiwyMSBAQCBpbnQg
aW50ZWxfcHNyX2RlYnVnX3NldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHU2
NCB2YWwpCiAJCXJldHVybiAtRUlOVkFMOwogCX0KIAotCXJldCA9IG11dGV4X2xvY2tfaW50ZXJy
dXB0aWJsZSgmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVw
dGlibGUoJmludGVsX2RwLT5wc3IubG9jayk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAot
CW9sZF9tb2RlID0gZGV2X3ByaXYtPnBzci5kZWJ1ZyAmIEk5MTVfUFNSX0RFQlVHX01PREVfTUFT
SzsKLQlkZXZfcHJpdi0+cHNyLmRlYnVnID0gdmFsOworCW9sZF9tb2RlID0gaW50ZWxfZHAtPnBz
ci5kZWJ1ZyAmIEk5MTVfUFNSX0RFQlVHX01PREVfTUFTSzsKKwlpbnRlbF9kcC0+cHNyLmRlYnVn
ID0gdmFsOwogCiAJLyoKIAkgKiBEbyBpdCByaWdodCBhd2F5IGlmIGl0J3MgYWxyZWFkeSBlbmFi
bGVkLCBvdGhlcndpc2UgaXQgd2lsbCBiZSBkb25lCiAJICogd2hlbiBlbmFibGluZyB0aGUgc291
cmNlLgogCSAqLwotCWlmIChkZXZfcHJpdi0+cHNyLmVuYWJsZWQpCi0JCXBzcl9pcnFfY29udHJv
bChkZXZfcHJpdik7CisJaWYgKGludGVsX2RwLT5wc3IuZW5hYmxlZCkKKwkJcHNyX2lycV9jb250
cm9sKGludGVsX2RwKTsKIAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwlt
dXRleF91bmxvY2soJmludGVsX2RwLT5wc3IubG9jayk7CiAKIAlpZiAob2xkX21vZGUgIT0gbW9k
ZSkKIAkJcmV0ID0gaW50ZWxfcHNyX2Zhc3RzZXRfZm9yY2UoZGV2X3ByaXYpOwpAQCAtMTUzMSwy
OCArMTU1NCwyOCBAQCBpbnQgaW50ZWxfcHNyX2RlYnVnX3NldChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsIHU2NCB2YWwpCiAJcmV0dXJuIHJldDsKIH0KIAotc3RhdGljIHZvaWQg
aW50ZWxfcHNyX2hhbmRsZV9pcnEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQor
c3RhdGljIHZvaWQgaW50ZWxfcHNyX2hhbmRsZV9pcnEoc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCkKIHsKLQlzdHJ1Y3QgaTkxNV9wc3IgKnBzciA9ICZkZXZfcHJpdi0+cHNyOworCXN0cnVjdCBp
bnRlbF9wc3IgKnBzciA9ICZpbnRlbF9kcC0+cHNyOwogCi0JaW50ZWxfcHNyX2Rpc2FibGVfbG9j
a2VkKHBzci0+ZHApOworCWludGVsX3Bzcl9kaXNhYmxlX2xvY2tlZChpbnRlbF9kcCk7CiAJcHNy
LT5zaW5rX25vdF9yZWxpYWJsZSA9IHRydWU7CiAJLyogbGV0J3MgbWFrZSBzdXJlIHRoYXQgc2lu
ayBpcyBhd2FrZW4gKi8KLQlkcm1fZHBfZHBjZF93cml0ZWIoJnBzci0+ZHAtPmF1eCwgRFBfU0VU
X1BPV0VSLCBEUF9TRVRfUE9XRVJfRDApOworCWRybV9kcF9kcGNkX3dyaXRlYigmaW50ZWxfZHAt
PmF1eCwgRFBfU0VUX1BPV0VSLCBEUF9TRVRfUE9XRVJfRDApOwogfQogCiBzdGF0aWMgdm9pZCBp
bnRlbF9wc3Jfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiB7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0KLQkJY29udGFpbmVyX29mKHdvcmssIHR5cGVvZigqZGV2
X3ByaXYpLCBwc3Iud29yayk7CisJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9CisJCWNvbnRh
aW5lcl9vZih3b3JrLCB0eXBlb2YoKmludGVsX2RwKSwgcHNyLndvcmspOwogCi0JbXV0ZXhfbG9j
aygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRleF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2sp
OwogCi0JaWYgKCFkZXZfcHJpdi0+cHNyLmVuYWJsZWQpCisJaWYgKCFpbnRlbF9kcC0+cHNyLmVu
YWJsZWQpCiAJCWdvdG8gdW5sb2NrOwogCi0JaWYgKFJFQURfT05DRShkZXZfcHJpdi0+cHNyLmly
cV9hdXhfZXJyb3IpKQotCQlpbnRlbF9wc3JfaGFuZGxlX2lycShkZXZfcHJpdik7CisJaWYgKFJF
QURfT05DRShpbnRlbF9kcC0+cHNyLmlycV9hdXhfZXJyb3IpKQorCQlpbnRlbF9wc3JfaGFuZGxl
X2lycShpbnRlbF9kcCk7CiAKIAkvKgogCSAqIFdlIGhhdmUgdG8gbWFrZSBzdXJlIFBTUiBpcyBy
ZWFkeSBmb3IgcmUtZW5hYmxlCkBAIC0xNTYwLDcgKzE1ODMsNyBAQCBzdGF0aWMgdm9pZCBpbnRl
bF9wc3Jfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJICogUFNSIG1pZ2h0IHRha2Ug
c29tZSB0aW1lIHRvIGdldCBmdWxseSBkaXNhYmxlZAogCSAqIGFuZCBiZSByZWFkeSBmb3IgcmUt
ZW5hYmxlLgogCSAqLwotCWlmICghX19wc3Jfd2FpdF9mb3JfaWRsZV9sb2NrZWQoZGV2X3ByaXYp
KQorCWlmICghX19wc3Jfd2FpdF9mb3JfaWRsZV9sb2NrZWQoaW50ZWxfZHApKQogCQlnb3RvIHVu
bG9jazsKIAogCS8qCkBAIC0xNTY4LDEyICsxNTkxLDEyIEBAIHN0YXRpYyB2b2lkIGludGVsX3Bz
cl93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAkgKiByZWNoZWNrLiBTaW5jZSBwc3Jf
Zmx1c2ggZmlyc3QgY2xlYXJzIHRoaXMgYW5kIHRoZW4gcmVzY2hlZHVsZXMgd2UKIAkgKiB3b24n
dCBldmVyIG1pc3MgYSBmbHVzaCB3aGVuIGJhaWxpbmcgb3V0IGhlcmUuCiAJICovCi0JaWYgKGRl
dl9wcml2LT5wc3IuYnVzeV9mcm9udGJ1ZmZlcl9iaXRzIHx8IGRldl9wcml2LT5wc3IuYWN0aXZl
KQorCWlmIChpbnRlbF9kcC0+cHNyLmJ1c3lfZnJvbnRidWZmZXJfYml0cyB8fCBpbnRlbF9kcC0+
cHNyLmFjdGl2ZSkKIAkJZ290byB1bmxvY2s7CiAKLQlpbnRlbF9wc3JfYWN0aXZhdGUoZGV2X3By
aXYtPnBzci5kcCk7CisJaW50ZWxfcHNyX2FjdGl2YXRlKGludGVsX2RwKTsKIHVubG9jazoKLQlt
dXRleF91bmxvY2soJmRldl9wcml2LT5wc3IubG9jayk7CisJbXV0ZXhfdW5sb2NrKCZpbnRlbF9k
cC0+cHNyLmxvY2spOwogfQogCiAvKioKQEAgLTE1OTIsMjcgKzE2MTUsMzUgQEAgc3RhdGljIHZv
aWQgaW50ZWxfcHNyX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogdm9pZCBpbnRlbF9w
c3JfaW52YWxpZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkgIHVu
c2lnbmVkIGZyb250YnVmZmVyX2JpdHMsIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbikKIHsKLQlp
ZiAoIUNBTl9QU1IoZGV2X3ByaXYpKQotCQlyZXR1cm47CisJc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXI7CisJc3RydWN0IGludGVsX2RwICppbnRlbF9kcDsKIAotCWlmIChvcmlnaW4gPT0g
T1JJR0lOX0ZMSVApCi0JCXJldHVybjsKKwlmb3JfZWFjaF9pbnRlbF9kcCgmZGV2X3ByaXYtPmRy
bSwgZW5jb2RlcikgewogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKLQlpZiAo
IWRldl9wcml2LT5wc3IuZW5hYmxlZCkgewotCQltdXRleF91bmxvY2soJmRldl9wcml2LT5wc3Iu
bG9jayk7Ci0JCXJldHVybjsKLQl9CisJCWludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKGVuY29k
ZXIpOworCQlpZiAoZW5jb2Rlci0+dHlwZSAhPSBJTlRFTF9PVVRQVVRfRURQKQorCQkJY29udGlu
dWU7CisJCWlmICghQ0FOX1BTUihpbnRlbF9kcCkpCisJCQljb250aW51ZTsKKworCQlpZiAob3Jp
Z2luID09IE9SSUdJTl9GTElQKQorCQkJY29udGludWU7CiAKLQlmcm9udGJ1ZmZlcl9iaXRzICY9
IElOVEVMX0ZST05UQlVGRkVSX0FMTF9NQVNLKGRldl9wcml2LT5wc3IucGlwZSk7Ci0JZGV2X3By
aXYtPnBzci5idXN5X2Zyb250YnVmZmVyX2JpdHMgfD0gZnJvbnRidWZmZXJfYml0czsKKwkJbXV0
ZXhfbG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKKwkJaWYgKCFpbnRlbF9kcC0+cHNyLmVuYWJs
ZWQpIHsKKwkJCW11dGV4X3VubG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKKwkJCWNvbnRpbnVl
OworCQl9CiAKLQlpZiAoZnJvbnRidWZmZXJfYml0cykKLQkJaW50ZWxfcHNyX2V4aXQoZGV2X3By
aXYpOworCQlmcm9udGJ1ZmZlcl9iaXRzICY9IElOVEVMX0ZST05UQlVGRkVSX0FMTF9NQVNLKGlu
dGVsX2RwLT5wc3IucGlwZSk7CisJCWludGVsX2RwLT5wc3IuYnVzeV9mcm9udGJ1ZmZlcl9iaXRz
IHw9IGZyb250YnVmZmVyX2JpdHM7CiAKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5wc3IubG9j
ayk7Ci19CisJCWlmIChmcm9udGJ1ZmZlcl9iaXRzKQorCQkJaW50ZWxfcHNyX2V4aXQoaW50ZWxf
ZHApOwogCisJCW11dGV4X3VubG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKKwl9Cit9CiAvKgog
ICogV2hlbiB3ZSB3aWxsIGJlIGNvbXBsZXRlbHkgcmVseSBvbiBQU1IyIFMvVyB0cmFja2luZyBp
biBmdXR1cmUsCiAgKiBpbnRlbF9wc3JfZmx1c2goKSB3aWxsIGludmFsaWRhdGUgYW5kIGZsdXNo
IHRoZSBQU1IgZm9yIE9SSUdJTl9GTElQCkBAIC0xNjIwLDE1ICsxNjUxLDE1IEBAIHZvaWQgaW50
ZWxfcHNyX2ludmFsaWRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogICog
YWNjb3JkaW5nbHkgaW4gZnV0dXJlLgogICovCiBzdGF0aWMgdm9pZAotdGdsX2RjM2NvX2ZsdXNo
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJdW5zaWduZWQgaW50IGZyb250
YnVmZmVyX2JpdHMsIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbikKK3RnbF9kYzNjb19mbHVzaChz
dHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCB1bnNpZ25lZCBpbnQgZnJvbnRidWZmZXJfYml0cywK
KwkJZW51bSBmYl9vcF9vcmlnaW4gb3JpZ2luKQogewotCW11dGV4X2xvY2soJmRldl9wcml2LT5w
c3IubG9jayk7CisJbXV0ZXhfbG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKIAotCWlmICghZGV2
X3ByaXYtPnBzci5kYzNjb19lbmFibGVkKQorCWlmICghaW50ZWxfZHAtPnBzci5kYzNjb19lbmFi
bGVkKQogCQlnb3RvIHVubG9jazsKIAotCWlmICghZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQg
fHwgIWRldl9wcml2LT5wc3IuYWN0aXZlKQorCWlmICghaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJs
ZWQgfHwgIWludGVsX2RwLT5wc3IuYWN0aXZlKQogCQlnb3RvIHVubG9jazsKIAogCS8qCkBAIC0x
NjM2LDE1ICsxNjY3LDE1IEBAIHRnbF9kYzNjb19mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCiAJICogd2hlbiBkZWxheWVkIHdvcmsgc2NoZWR1bGVzIHRoYXQgbWVhbnMg
ZGlzcGxheSBoYXMgYmVlbiBpZGxlLgogCSAqLwogCWlmICghKGZyb250YnVmZmVyX2JpdHMgJgot
CSAgICBJTlRFTF9GUk9OVEJVRkZFUl9BTExfTUFTSyhkZXZfcHJpdi0+cHNyLnBpcGUpKSkKKwkg
ICAgSU5URUxfRlJPTlRCVUZGRVJfQUxMX01BU0soaW50ZWxfZHAtPnBzci5waXBlKSkpCiAJCWdv
dG8gdW5sb2NrOwogCi0JdGdsX3BzcjJfZW5hYmxlX2RjM2NvKGRldl9wcml2KTsKLQltb2RfZGVs
YXllZF93b3JrKHN5c3RlbV93cSwgJmRldl9wcml2LT5wc3IuZGMzY29fd29yaywKLQkJCSBkZXZf
cHJpdi0+cHNyLmRjM2NvX2V4aXRfZGVsYXkpOworCXRnbF9wc3IyX2VuYWJsZV9kYzNjbyhpbnRl
bF9kcCk7CisJbW9kX2RlbGF5ZWRfd29yayhzeXN0ZW1fd3EsICZpbnRlbF9kcC0+cHNyLmRjM2Nv
X3dvcmssCisJCQkgaW50ZWxfZHAtPnBzci5kYzNjb19leGl0X2RlbGF5KTsKIAogdW5sb2NrOgot
CW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRleF91bmxvY2soJmludGVs
X2RwLT5wc3IubG9jayk7CiB9CiAKIC8qKgpAQCAtMTY2Myw0NSArMTY5NCw1NCBAQCB0Z2xfZGMz
Y29fZmx1c2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogdm9pZCBpbnRlbF9w
c3JfZmx1c2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkgICAgIHVuc2ln
bmVkIGZyb250YnVmZmVyX2JpdHMsIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbikKIHsKLQlpZiAo
IUNBTl9QU1IoZGV2X3ByaXYpKQotCQlyZXR1cm47Ci0KLQlpZiAob3JpZ2luID09IE9SSUdJTl9G
TElQKSB7Ci0JCXRnbF9kYzNjb19mbHVzaChkZXZfcHJpdiwgZnJvbnRidWZmZXJfYml0cywgb3Jp
Z2luKTsKLQkJcmV0dXJuOwotCX0KLQotCW11dGV4X2xvY2soJmRldl9wcml2LT5wc3IubG9jayk7
Ci0JaWYgKCFkZXZfcHJpdi0+cHNyLmVuYWJsZWQpIHsKLQkJbXV0ZXhfdW5sb2NrKCZkZXZfcHJp
di0+cHNyLmxvY2spOwotCQlyZXR1cm47CisJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXI7
CisJc3RydWN0IGludGVsX2RwICppbnRlbF9kcDsKKworCWZvcl9lYWNoX2ludGVsX2RwKCZkZXZf
cHJpdi0+ZHJtLCBlbmNvZGVyKSB7CisJCWludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKGVuY29k
ZXIpOworCisJCWlmIChlbmNvZGVyLT50eXBlID09IElOVEVMX09VVFBVVF9FRFAgJiYgQ0FOX1BT
UihpbnRlbF9kcCkpIHsKKwkJCWlmIChvcmlnaW4gPT0gT1JJR0lOX0ZMSVApIHsKKwkJCQl0Z2xf
ZGMzY29fZmx1c2goaW50ZWxfZHAsIGZyb250YnVmZmVyX2JpdHMsIG9yaWdpbik7CisJCQkJY29u
dGludWU7CisJCQl9CisKKwkJCW11dGV4X2xvY2soJmludGVsX2RwLT5wc3IubG9jayk7CisJCQlp
ZiAoIWludGVsX2RwLT5wc3IuZW5hYmxlZCkgeworCQkJCW11dGV4X3VubG9jaygmaW50ZWxfZHAt
PnBzci5sb2NrKTsKKwkJCQljb250aW51ZTsKKwkJCX0KKworCQkJZnJvbnRidWZmZXJfYml0cyAm
PSBJTlRFTF9GUk9OVEJVRkZFUl9BTExfTUFTSyhpbnRlbF9kcC0+cHNyLnBpcGUpOworCQkJaW50
ZWxfZHAtPnBzci5idXN5X2Zyb250YnVmZmVyX2JpdHMgJj0gfmZyb250YnVmZmVyX2JpdHM7CisK
KwkJCS8qIEJ5IGRlZmluaXRpb24gZmx1c2ggPSBpbnZhbGlkYXRlICsgZmx1c2ggKi8KKwkJCWlm
IChmcm9udGJ1ZmZlcl9iaXRzKQorCQkJCXBzcl9mb3JjZV9od190cmFja2luZ19leGl0KGludGVs
X2RwKTsKKworCQkJaWYgKCFpbnRlbF9kcC0+cHNyLmFjdGl2ZSAmJiAhaW50ZWxfZHAtPnBzci5i
dXN5X2Zyb250YnVmZmVyX2JpdHMpCisJCQkJc2NoZWR1bGVfd29yaygmaW50ZWxfZHAtPnBzci53
b3JrKTsKKwkJCW11dGV4X3VubG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKKwkJfQogCX0KLQot
CWZyb250YnVmZmVyX2JpdHMgJj0gSU5URUxfRlJPTlRCVUZGRVJfQUxMX01BU0soZGV2X3ByaXYt
PnBzci5waXBlKTsKLQlkZXZfcHJpdi0+cHNyLmJ1c3lfZnJvbnRidWZmZXJfYml0cyAmPSB+ZnJv
bnRidWZmZXJfYml0czsKLQotCS8qIEJ5IGRlZmluaXRpb24gZmx1c2ggPSBpbnZhbGlkYXRlICsg
Zmx1c2ggKi8KLQlpZiAoZnJvbnRidWZmZXJfYml0cykKLQkJcHNyX2ZvcmNlX2h3X3RyYWNraW5n
X2V4aXQoZGV2X3ByaXYpOwotCi0JaWYgKCFkZXZfcHJpdi0+cHNyLmFjdGl2ZSAmJiAhZGV2X3By
aXYtPnBzci5idXN5X2Zyb250YnVmZmVyX2JpdHMpCi0JCXNjaGVkdWxlX3dvcmsoJmRldl9wcml2
LT5wc3Iud29yayk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOwogfQogCiAv
KioKICAqIGludGVsX3Bzcl9pbml0IC0gSW5pdCBiYXNpYyBQU1Igd29yayBhbmQgbXV0ZXguCi0g
KiBAZGV2X3ByaXY6IGk5MTUgZGV2aWNlIHByaXZhdGUKKyAqIEBpbnRlbF9kcDogSW50ZWwgRFAK
ICAqCi0gKiBUaGlzIGZ1bmN0aW9uIGlzICBjYWxsZWQgb25seSBvbmNlIGF0IGRyaXZlciBsb2Fk
IHRvIGluaXRpYWxpemUgYmFzaWMKLSAqIFBTUiBzdHVmZi4KKyAqIFRoaXMgZnVuY3Rpb24gaXMg
Y2FsbGVkIGFmdGVyIHRoZSBpbml0aWFsaXppbmcgY29ubmVjdG9yLgorICogKHRoZSBpbml0aWFs
aXppbmcgb2YgY29ubmVjdG9yIHRyZWF0cyB0aGUgaGFuZGxpbmcgb2YgY29ubmVjdG9yIGNhcGFi
aWxpdGllcykKKyAqIEFuZCBpdCBpbml0aWFsaXplcyBiYXNpYyBQU1Igc3R1ZmYgZm9yIGVhY2gg
RFAgRW5jb2Rlci4KICAqLwotdm9pZCBpbnRlbF9wc3JfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCit2b2lkIGludGVsX3Bzcl9pbml0KHN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHApCiB7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkx
NShpbnRlbF9kcCk7CisKIAlpZiAoIUhBU19QU1IoZGV2X3ByaXYpKQogCQlyZXR1cm47CiAKLQlp
ZiAoIWRldl9wcml2LT5wc3Iuc2lua19zdXBwb3J0KQorCWlmICghaW50ZWxfZHAtPnBzci5zaW5r
X3N1cHBvcnQpCiAJCXJldHVybjsKIAogCWlmIChJU19IQVNXRUxMKGRldl9wcml2KSkKQEAgLTE3
MTksMTQgKzE3NTksMTQgQEAgdm9pZCBpbnRlbF9wc3JfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCiAJLyogU2V0IGxpbmtfc3RhbmRieSB4IGxpbmtfb2ZmIGRlZmF1bHRz
ICovCiAJaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpIHx8IElTX0JST0FEV0VMTChkZXZfcHJpdikp
CiAJCS8qIEhTVyBhbmQgQkRXIHJlcXVpcmUgd29ya2Fyb3VuZHMgdGhhdCB3ZSBkb24ndCBpbXBs
ZW1lbnQuICovCi0JCWRldl9wcml2LT5wc3IubGlua19zdGFuZGJ5ID0gZmFsc2U7CisJCWludGVs
X2RwLT5wc3IubGlua19zdGFuZGJ5ID0gZmFsc2U7CiAJZWxzZSBpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA8IDEyKQogCQkvKiBGb3IgbmV3IHBsYXRmb3JtcyB1cCB0byBUR0wgbGV0J3MgcmVzcGVj
dCBWQlQgYmFjayBhZ2FpbiAqLwotCQlkZXZfcHJpdi0+cHNyLmxpbmtfc3RhbmRieSA9IGRldl9w
cml2LT52YnQucHNyLmZ1bGxfbGluazsKKwkJaW50ZWxfZHAtPnBzci5saW5rX3N0YW5kYnkgPSBk
ZXZfcHJpdi0+dmJ0LnBzci5mdWxsX2xpbms7CiAKLQlJTklUX1dPUksoJmRldl9wcml2LT5wc3Iu
d29yaywgaW50ZWxfcHNyX3dvcmspOwotCUlOSVRfREVMQVlFRF9XT1JLKCZkZXZfcHJpdi0+cHNy
LmRjM2NvX3dvcmssIHRnbF9kYzNjb19kaXNhYmxlX3dvcmspOwotCW11dGV4X2luaXQoJmRldl9w
cml2LT5wc3IubG9jayk7CisJSU5JVF9XT1JLKCZpbnRlbF9kcC0+cHNyLndvcmssIGludGVsX3Bz
cl93b3JrKTsKKwlJTklUX0RFTEFZRURfV09SSygmaW50ZWxfZHAtPnBzci5kYzNjb193b3JrLCB0
Z2xfZGMzY29fZGlzYWJsZV93b3JrKTsKKwltdXRleF9pbml0KCZpbnRlbF9kcC0+cHNyLmxvY2sp
OwogfQogCiBzdGF0aWMgaW50IHBzcl9nZXRfc3RhdHVzX2FuZF9lcnJvcl9zdGF0dXMoc3RydWN0
IGludGVsX2RwICppbnRlbF9kcCwKQEAgLTE3NTIsNyArMTc5Miw3IEBAIHN0YXRpYyB2b2lkIHBz
cl9hbHBtX2NoZWNrKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CiAJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJc3RydWN0IGRy
bV9kcF9hdXggKmF1eCA9ICZpbnRlbF9kcC0+YXV4OwotCXN0cnVjdCBpOTE1X3BzciAqcHNyID0g
JmRldl9wcml2LT5wc3I7CisJc3RydWN0IGludGVsX3BzciAqcHNyID0gJmludGVsX2RwLT5wc3I7
CiAJdTggdmFsOwogCWludCByOwogCkBAIC0xNzc5LDcgKzE4MTksNyBAQCBzdGF0aWMgdm9pZCBw
c3JfYWxwbV9jaGVjayhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogc3RhdGljIHZvaWQgcHNy
X2NhcGFiaWxpdHlfY2hhbmdlZF9jaGVjayhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHAp
OwotCXN0cnVjdCBpOTE1X3BzciAqcHNyID0gJmRldl9wcml2LT5wc3I7CisJc3RydWN0IGludGVs
X3BzciAqcHNyID0gJmludGVsX2RwLT5wc3I7CiAJdTggdmFsOwogCWludCByOwogCkBAIC0xODAz
LDE4ICsxODQzLDE4IEBAIHN0YXRpYyB2b2lkIHBzcl9jYXBhYmlsaXR5X2NoYW5nZWRfY2hlY2so
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHZvaWQgaW50ZWxfcHNyX3Nob3J0X3B1bHNlKHN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7Ci0Jc3RydWN0IGk5MTVfcHNyICpwc3IgPSAm
ZGV2X3ByaXYtPnBzcjsKKwlzdHJ1Y3QgaW50ZWxfcHNyICpwc3IgPSAmaW50ZWxfZHAtPnBzcjsK
IAl1OCBzdGF0dXMsIGVycm9yX3N0YXR1czsKIAljb25zdCB1OCBlcnJvcnMgPSBEUF9QU1JfUkZC
X1NUT1JBR0VfRVJST1IgfAogCQkJICBEUF9QU1JfVlNDX1NEUF9VTkNPUlJFQ1RBQkxFX0VSUk9S
IHwKIAkJCSAgRFBfUFNSX0xJTktfQ1JDX0VSUk9SOwogCi0JaWYgKCFDQU5fUFNSKGRldl9wcml2
KSB8fCAhaW50ZWxfZHBfaXNfZWRwKGludGVsX2RwKSkKKwlpZiAoIUNBTl9QU1IoaW50ZWxfZHAp
IHx8ICFpbnRlbF9kcF9pc19lZHAoaW50ZWxfZHApKQogCQlyZXR1cm47CiAKIAltdXRleF9sb2Nr
KCZwc3ItPmxvY2spOwogCi0JaWYgKCFwc3ItPmVuYWJsZWQgfHwgcHNyLT5kcCAhPSBpbnRlbF9k
cCkKKwlpZiAoIXBzci0+ZW5hYmxlZCkKIAkJZ290byBleGl0OwogCiAJaWYgKHBzcl9nZXRfc3Rh
dHVzX2FuZF9lcnJvcl9zdGF0dXMoaW50ZWxfZHAsICZzdGF0dXMsICZlcnJvcl9zdGF0dXMpKSB7
CkBAIC0xODU3LDE1ICsxODk3LDE0IEBAIHZvaWQgaW50ZWxfcHNyX3Nob3J0X3B1bHNlKHN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHApCiAKIGJvb2wgaW50ZWxfcHNyX2VuYWJsZWQoc3RydWN0IGlu
dGVsX2RwICppbnRlbF9kcCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSBkcF90b19pOTE1KGludGVsX2RwKTsKIAlib29sIHJldDsKIAotCWlmICghQ0FOX1BTUihkZXZf
cHJpdikgfHwgIWludGVsX2RwX2lzX2VkcChpbnRlbF9kcCkpCisJaWYgKCFDQU5fUFNSKGludGVs
X2RwKSB8fCAhaW50ZWxfZHBfaXNfZWRwKGludGVsX2RwKSkKIAkJcmV0dXJuIGZhbHNlOwogCi0J
bXV0ZXhfbG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKLQlyZXQgPSAoZGV2X3ByaXYtPnBzci5k
cCA9PSBpbnRlbF9kcCAmJiBkZXZfcHJpdi0+cHNyLmVuYWJsZWQpOwotCW11dGV4X3VubG9jaygm
ZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRleF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOwor
CXJldCA9IGludGVsX2RwLT5wc3IuZW5hYmxlZDsKKwltdXRleF91bmxvY2soJmludGVsX2RwLT5w
c3IubG9jayk7CiAKIAlyZXR1cm4gcmV0OwogfQpAQCAtMTg3NCwxOCArMTkxMywxMSBAQCB2b2lk
IGludGVsX3Bzcl9hdG9taWNfY2hlY2soc3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwK
IAkJCSAgICBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqb2xkX3N0YXRlLAogCQkJICAgIHN0
cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpuZXdfc3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjb25uZWN0b3ItPmRldik7Ci0Jc3RydWN0IGlu
dGVsX2Nvbm5lY3RvciAqaW50ZWxfY29ubmVjdG9yOwotCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3Bv
cnQgKmRpZ19wb3J0OwogCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKKwlzdHJ1
Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gaW50ZWxfYXR0YWNoZWRfZHAodG9faW50ZWxfY29ubmVj
dG9yKGNvbm5lY3RvcikpOwogCi0JaWYgKCFDQU5fUFNSKGRldl9wcml2KSB8fCAhbmV3X3N0YXRl
LT5jcnRjIHx8Ci0JICAgICFkZXZfcHJpdi0+cHNyLmZvcmNlX21vZGVfY2hhbmdlZCkKLQkJcmV0
dXJuOwotCi0JaW50ZWxfY29ubmVjdG9yID0gdG9faW50ZWxfY29ubmVjdG9yKGNvbm5lY3Rvcik7
Ci0JZGlnX3BvcnQgPSBlbmNfdG9fZGlnX3BvcnQodG9faW50ZWxfZW5jb2RlcihuZXdfc3RhdGUt
PmJlc3RfZW5jb2RlcikpOwotCWlmIChkZXZfcHJpdi0+cHNyLmRwICE9ICZkaWdfcG9ydC0+ZHAp
CisJaWYgKCFDQU5fUFNSKGludGVsX2RwKSB8fCAhbmV3X3N0YXRlLT5jcnRjIHx8CisJICAgICFp
bnRlbF9kcC0+cHNyLmZvcmNlX21vZGVfY2hhbmdlZCkKIAkJcmV0dXJuOwogCiAJY3J0Y19zdGF0
ZSA9IGRybV9hdG9taWNfZ2V0X25ld19jcnRjX3N0YXRlKG5ld19zdGF0ZS0+c3RhdGUsCkBAIC0x
ODkzLDE2ICsxOTI1LDE1IEBAIHZvaWQgaW50ZWxfcHNyX2F0b21pY19jaGVjayhzdHJ1Y3QgZHJt
X2Nvbm5lY3RvciAqY29ubmVjdG9yLAogCWNydGNfc3RhdGUtPm1vZGVfY2hhbmdlZCA9IHRydWU7
CiB9CiAKLXZvaWQgaW50ZWxfcHNyX3NldF9mb3JjZV9tb2RlX2NoYW5nZWQoc3RydWN0IGludGVs
X2RwICppbnRlbF9kcCkKKy8qIEFmdGVyIGluaXRpYWxpemluZyBQU1Igc2luaywgaXQgY2hlY2tz
IHJlcXVpcmluZyBvZiBtb2RlX2NoYW5nZWQgKi8KK3ZvaWQgaW50ZWxfcHNyX3NldF9mb3JjZV9t
b2RlX2NoYW5nZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2OworCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
OworCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHA7CiAKLQlpZiAoIWludGVsX2RwKQotCQlyZXR1
cm47Ci0KLQlkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwotCWlmICghQ0FOX1BTUihk
ZXZfcHJpdikgfHwgaW50ZWxfZHAgIT0gZGV2X3ByaXYtPnBzci5kcCkKLQkJcmV0dXJuOwotCi0J
ZGV2X3ByaXYtPnBzci5mb3JjZV9tb2RlX2NoYW5nZWQgPSB0cnVlOworCWZvcl9lYWNoX2ludGVs
X2RwKCZpOTE1LT5kcm0sIGVuY29kZXIpIHsKKwkJaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAo
ZW5jb2Rlcik7CisJCWlmIChDQU5fUFNSKGludGVsX2RwKSkKKwkJCWludGVsX2RwLT5wc3IuZm9y
Y2VfbW9kZV9jaGFuZ2VkID0gdHJ1ZTsKKwl9CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9wc3IuaAppbmRleCAzZWNhOWRjZWMzYzAuLjg3ZDc1NDZiMzRjZSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuaAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5oCkBAIC0xOCw3ICsxOCw3IEBAIHN0cnVj
dCBpbnRlbF9hdG9taWNfc3RhdGU7CiBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGU7CiBzdHJ1Y3Qg
aW50ZWxfcGxhbmU7CiAKLSNkZWZpbmUgQ0FOX1BTUihkZXZfcHJpdikgKEhBU19QU1IoZGV2X3By
aXYpICYmIGRldl9wcml2LT5wc3Iuc2lua19zdXBwb3J0KQorI2RlZmluZSBDQU5fUFNSKGludGVs
X2RwKSAoSEFTX1BTUihkcF90b19pOTE1KGludGVsX2RwKSkgJiYgaW50ZWxfZHAtPnBzci5zaW5r
X3N1cHBvcnQpCiB2b2lkIGludGVsX3Bzcl9pbml0X2RwY2Qoc3RydWN0IGludGVsX2RwICppbnRl
bF9kcCk7CiB2b2lkIGludGVsX3Bzcl9lbmFibGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwK
IAkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCkBAIC0y
OCwyOCArMjgsMjggQEAgdm9pZCBpbnRlbF9wc3JfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZHAgKmlu
dGVsX2RwLAogdm9pZCBpbnRlbF9wc3JfdXBkYXRlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAs
CiAJCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkg
ICAgICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSk7Ci1pbnQg
aW50ZWxfcHNyX2RlYnVnX3NldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHU2
NCB2YWx1ZSk7CitpbnQgaW50ZWxfcHNyX2RlYnVnX3NldChzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwLCB1NjQgdmFsdWUpOwogdm9pZCBpbnRlbF9wc3JfaW52YWxpZGF0ZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkgIHVuc2lnbmVkIGZyb250YnVmZmVyX2JpdHMsCiAJ
CQkgIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbik7CiB2b2lkIGludGVsX3Bzcl9mbHVzaChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCSAgICAgdW5zaWduZWQgZnJvbnRidWZm
ZXJfYml0cywKIAkJICAgICBlbnVtIGZiX29wX29yaWdpbiBvcmlnaW4pOwotdm9pZCBpbnRlbF9w
c3JfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwordm9pZCBpbnRlbF9w
c3JfaW5pdChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKTsKIHZvaWQgaW50ZWxfcHNyX2NvbXB1
dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCQkgICAgICBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7Ci12b2lkIGludGVsX3Bzcl9pcnFfaGFuZGxlcihz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBwc3JfaWlyKTsKK3ZvaWQgaW50
ZWxfcHNyX2lycV9oYW5kbGVyKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIHUzMiBwc3JfaWly
KTsKIHZvaWQgaW50ZWxfcHNyX3Nob3J0X3B1bHNlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAp
OwotaW50IGludGVsX3Bzcl93YWl0X2Zvcl9pZGxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpuZXdfY3J0Y19zdGF0ZSwKLQkJCSAgICB1MzIgKm91dF92YWx1ZSk7Cit2b2lkIGludGVs
X3Bzcl93YWl0X2Zvcl9pZGxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0
Y19zdGF0ZSk7CiBib29sIGludGVsX3Bzcl9lbmFibGVkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHApOwogdm9pZCBpbnRlbF9wc3JfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fY29ubmVjdG9yICpj
b25uZWN0b3IsCiAJCQkgICAgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKm9sZF9zdGF0ZSwK
IAkJCSAgICBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqbmV3X3N0YXRlKTsKLXZvaWQgaW50
ZWxfcHNyX3NldF9mb3JjZV9tb2RlX2NoYW5nZWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCk7
Cit2b2lkIGludGVsX3Bzcl9zZXRfZm9yY2VfbW9kZV9jaGFuZ2VkKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KTsKIGludCBpbnRlbF9wc3IyX3NlbF9mZXRjaF91cGRhdGUoc3RydWN0IGlu
dGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJCQkJc3RydWN0IGludGVsX2NydGMgKmNydGMpOwot
dm9pZCBpbnRlbF9wc3IyX3Byb2dyYW1fdHJhbnNfbWFuX3Rya19jdGwoY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOwordm9pZCBpbnRlbF9wc3IyX3Byb2dyYW1fdHJh
bnNfbWFuX3Rya19jdGwoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKKwkJCQkJICBjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7CiB2b2lkIGludGVsX3BzcjJfcHJv
Z3JhbV9wbGFuZV9zZWxfZmV0Y2goc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAkJCQkJY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJCWNvbnN0IHN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9zcHJpdGUuYwppbmRleCBiNmRlZWIzMzg0NzcuLmNjZDg2ZjE2ODM1NyAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCkBAIC05Miw3
ICs5Miw2IEBAIHZvaWQgaW50ZWxfcGlwZV91cGRhdGVfc3RhcnQoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKQogCWJvb2wgbmVlZF92bHZfZHNpX3dhID0gKElT
X1ZBTExFWVZJRVcoZGV2X3ByaXYpIHx8IElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpKSAmJgogCQlp
bnRlbF9jcnRjX2hhc190eXBlKG5ld19jcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfRFNJKTsKIAlE
RUZJTkVfV0FJVCh3YWl0KTsKLQl1MzIgcHNyX3N0YXR1czsKIAogCWlmIChuZXdfY3J0Y19zdGF0
ZS0+dWFwaS5hc3luY19mbGlwKQogCQlyZXR1cm47CkBAIC0xMTcsMTAgKzExNiw3IEBAIHZvaWQg
aW50ZWxfcGlwZV91cGRhdGVfc3RhcnQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5l
d19jcnRjX3N0YXRlKQogCSAqIFZCTCBpbnRlcnJ1cHRzIHdpbGwgc3RhcnQgdGhlIFBTUiBleGl0
IGFuZCBwcmV2ZW50IGEgUFNSCiAJICogcmUtZW50cnkgYXMgd2VsbC4KIAkgKi8KLQlpZiAoaW50
ZWxfcHNyX3dhaXRfZm9yX2lkbGUobmV3X2NydGNfc3RhdGUsICZwc3Jfc3RhdHVzKSkKLQkJZHJt
X2VycigmZGV2X3ByaXYtPmRybSwKLQkJCSJQU1IgaWRsZSB0aW1lZCBvdXQgMHgleCwgYXRvbWlj
IHVwZGF0ZSBtYXkgZmFpbFxuIiwKLQkJCXBzcl9zdGF0dXMpOworCWludGVsX3Bzcl93YWl0X2Zv
cl9pZGxlKG5ld19jcnRjX3N0YXRlKTsKIAogCWxvY2FsX2lycV9kaXNhYmxlKCk7CiAKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2Rydi5oCmluZGV4IGJjZDg2NTA2MDNkOC4uMmQ5NmJhNzY2YzEzIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZHJ2LmgKQEAgLTQ3NSw0MyArNDc1LDYgQEAgc3RydWN0IGk5MTVfZHJycyB7
CiAJZW51bSBkcnJzX3N1cHBvcnRfdHlwZSB0eXBlOwogfTsKIAotc3RydWN0IGk5MTVfcHNyIHsK
LQlzdHJ1Y3QgbXV0ZXggbG9jazsKLQotI2RlZmluZSBJOTE1X1BTUl9ERUJVR19NT0RFX01BU0sJ
MHgwZgotI2RlZmluZSBJOTE1X1BTUl9ERUJVR19ERUZBVUxUCQkweDAwCi0jZGVmaW5lIEk5MTVf
UFNSX0RFQlVHX0RJU0FCTEUJCTB4MDEKLSNkZWZpbmUgSTkxNV9QU1JfREVCVUdfRU5BQkxFCQkw
eDAyCi0jZGVmaW5lIEk5MTVfUFNSX0RFQlVHX0ZPUkNFX1BTUjEJMHgwMwotI2RlZmluZSBJOTE1
X1BTUl9ERUJVR19JUlEJCTB4MTAKLQotCXUzMiBkZWJ1ZzsKLQlib29sIHNpbmtfc3VwcG9ydDsK
LQlib29sIGVuYWJsZWQ7Ci0Jc3RydWN0IGludGVsX2RwICpkcDsKLQllbnVtIHBpcGUgcGlwZTsK
LQllbnVtIHRyYW5zY29kZXIgdHJhbnNjb2RlcjsKLQlib29sIGFjdGl2ZTsKLQlzdHJ1Y3Qgd29y
a19zdHJ1Y3Qgd29yazsKLQl1bnNpZ25lZCBidXN5X2Zyb250YnVmZmVyX2JpdHM7Ci0JYm9vbCBz
aW5rX3BzcjJfc3VwcG9ydDsKLQlib29sIGxpbmtfc3RhbmRieTsKLQlib29sIGNvbG9yaW1ldHJ5
X3N1cHBvcnQ7Ci0JYm9vbCBwc3IyX2VuYWJsZWQ7Ci0JYm9vbCBwc3IyX3NlbF9mZXRjaF9lbmFi
bGVkOwotCXU4IHNpbmtfc3luY19sYXRlbmN5OwotCWt0aW1lX3QgbGFzdF9lbnRyeV9hdHRlbXB0
OwotCWt0aW1lX3QgbGFzdF9leGl0OwotCWJvb2wgc2lua19ub3RfcmVsaWFibGU7Ci0JYm9vbCBp
cnFfYXV4X2Vycm9yOwotCXUxNiBzdV94X2dyYW51bGFyaXR5OwotCWJvb2wgZGMzY29fZW5hYmxl
ZDsKLQl1MzIgZGMzY29fZXhpdF9kZWxheTsKLQlzdHJ1Y3QgZGVsYXllZF93b3JrIGRjM2NvX3dv
cms7Ci0JYm9vbCBmb3JjZV9tb2RlX2NoYW5nZWQ7Ci0Jc3RydWN0IGRybV9kcF92c2Nfc2RwIHZz
YzsKLX07Ci0KICNkZWZpbmUgUVVJUktfTFZEU19TU0NfRElTQUJMRSAoMTw8MSkKICNkZWZpbmUg
UVVJUktfSU5WRVJUX0JSSUdIVE5FU1MgKDE8PDIpCiAjZGVmaW5lIFFVSVJLX0JBQ0tMSUdIVF9Q
UkVTRU5UICgxPDwzKQpAQCAtMTA0Miw4ICsxMDA1LDYgQEAgc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgewogCiAJc3RydWN0IGk5MTVfcG93ZXJfZG9tYWlucyBwb3dlcl9kb21haW5zOwogCi0Jc3Ry
dWN0IGk5MTVfcHNyIHBzcjsKLQogCXN0cnVjdCBpOTE1X2dwdV9lcnJvciBncHVfZXJyb3I7CiAK
IAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqdmx2X3BjdHg7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2lycS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9p
cnEuYwppbmRleCBlMGViMzJiZDk2MDcuLjZkNDMyOThjNDZkZCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2lycS5jCkBAIC0yMDU3LDEwICsyMDU3LDIwIEBAIHN0YXRpYyB2b2lkIGl2Yl9kaXNwbGF5X2ly
cV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJaXZiX2Vycl9p
bnRfaGFuZGxlcihkZXZfcHJpdik7CiAKIAlpZiAoZGVfaWlyICYgREVfRURQX1BTUl9JTlRfSFNX
KSB7Ci0JCXUzMiBwc3JfaWlyID0gSTkxNV9SRUFEKEVEUF9QU1JfSUlSKTsKKwkJc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXI7CiAKLQkJaW50ZWxfcHNyX2lycV9oYW5kbGVyKGRldl9wcml2
LCBwc3JfaWlyKTsKLQkJSTkxNV9XUklURShFRFBfUFNSX0lJUiwgcHNyX2lpcik7CisJCWZvcl9l
YWNoX2ludGVsX2RwKCZkZXZfcHJpdi0+ZHJtLCBlbmNvZGVyKSB7CisJCQlzdHJ1Y3QgaW50ZWxf
ZHAgKmludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKGVuY29kZXIpOworCisJCQlpZiAoZW5jb2Rl
ci0+dHlwZSA9PSBJTlRFTF9PVVRQVVRfRURQICYmCisJCQkgICAgQ0FOX1BTUihpbnRlbF9kcCkp
IHsKKwkJCQl1MzIgcHNyX2lpciA9IEk5MTVfUkVBRChFRFBfUFNSX0lJUik7CisKKwkJCQlpbnRl
bF9wc3JfaXJxX2hhbmRsZXIoaW50ZWxfZHAsIHBzcl9paXIpOworCQkJCUk5MTVfV1JJVEUoRURQ
X1BTUl9JSVIsIHBzcl9paXIpOworCQkJCWJyZWFrOworCQkJfQorCQl9CiAJfQogCiAJaWYgKGRl
X2lpciAmIERFX0FVWF9DSEFOTkVMX0FfSVZCKQpAQCAtMjI2OCwyMSArMjI3OCwzNCBAQCBnZW44
X2RlX21pc2NfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1
MzIgaWlyKQogCX0KIAogCWlmIChpaXIgJiBHRU44X0RFX0VEUF9QU1IpIHsKKwkJc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXI7CiAJCXUzMiBwc3JfaWlyOwogCQlpOTE1X3JlZ190IGlpcl9y
ZWc7CiAKLQkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpCi0JCQlpaXJfcmVnID0gVFJB
TlNfUFNSX0lJUihkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpOwotCQllbHNlCi0JCQlpaXJfcmVn
ID0gRURQX1BTUl9JSVI7CisJCWZvcl9lYWNoX2ludGVsX2RwKCZkZXZfcHJpdi0+ZHJtLCBlbmNv
ZGVyKSB7CisJCQlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKGVu
Y29kZXIpOwogCi0JCXBzcl9paXIgPSBJOTE1X1JFQUQoaWlyX3JlZyk7Ci0JCUk5MTVfV1JJVEUo
aWlyX3JlZywgcHNyX2lpcik7CisJCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMiAmJiBD
QU5fUFNSKGludGVsX2RwKSkgeworCQkJCWlpcl9yZWcgPSBUUkFOU19QU1JfSUlSKGludGVsX2Rw
LT5wc3IudHJhbnNjb2Rlcik7CisJCQl9IGVsc2UgaWYgKGVuY29kZXItPnR5cGUgPT0gSU5URUxf
T1VUUFVUX0VEUCAmJgorCQkJCSAgIENBTl9QU1IoaW50ZWxfZHApKSB7CisJCQkJaWlyX3JlZyA9
IEVEUF9QU1JfSUlSOworCQkJfSBlbHNlIHsKKwkJCQljb250aW51ZTsKKwkJCX0KKworCQkJcHNy
X2lpciA9IEk5MTVfUkVBRChpaXJfcmVnKTsKKwkJCUk5MTVfV1JJVEUoaWlyX3JlZywgcHNyX2lp
cik7CisKKwkJCWlmIChwc3JfaWlyKQorCQkJCWZvdW5kID0gdHJ1ZTsKIAotCQlpZiAocHNyX2lp
cikKLQkJCWZvdW5kID0gdHJ1ZTsKKwkJCWludGVsX3Bzcl9pcnFfaGFuZGxlcihpbnRlbF9kcCwg
cHNyX2lpcik7CiAKLQkJaW50ZWxfcHNyX2lycV9oYW5kbGVyKGRldl9wcml2LCBwc3JfaWlyKTsK
KwkJCS8qIHByaW9yIEdFTjEyIG9ubHkgaGF2ZSBvbmUgRURQIFBTUiAqLworCQkJaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPCAxMikKKwkJCQlicmVhazsKKwkJfQogCX0KIAogCWlmICghZm91bmQp
Ci0tIAoyLjI1LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdm
eAo=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 18A839CA13
	for <lists+intel-gfx@lfdr.de>; Mon, 26 Aug 2019 09:22:41 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EAFCC6E1C0;
	Mon, 26 Aug 2019 07:22:37 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 20F346E1BD
 for <intel-gfx@lists.freedesktop.org>; Mon, 26 Aug 2019 07:22:14 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18262694-1500050 
 for multiple; Mon, 26 Aug 2019 08:21:55 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 26 Aug 2019 08:21:40 +0100
Message-Id: <20190826072149.9447-19-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190826072149.9447-1-chris@chris-wilson.co.uk>
References: <20190826072149.9447-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 19/28] drm/i915: Drop struct_mutex from around
 i915_retire_requests()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgZG9uJ3QgbmVlZCB0byBob2xkIHN0cnVjdF9tdXRleCBub3cgZm9yIHJldGlyaW5nIHJlcXVl
c3RzLCBzbyBkcm9wIGl0CmZyb20gaTkxNV9yZXRpcmVfcmVxdWVzdHMoKSBhbmQgaTkxNV9nZW1f
d2FpdF9mb3JfaWRsZSgpLCBmaW5hbGx5CnJlbW92aW5nIEk5MTVfV0FJVF9MT0NLRUQgZm9yIGdv
b2QuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51
az4KLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMgICAgfCAg
NyArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgICB8IDIw
ICstLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMgICAgICAg
IHwgNDUgKysrKysrKy0tLS0tLS0tLS0tLQogLi4uL2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkx
NV9nZW1fY29udGV4dC5jIHwgIDQgKy0KIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVf
Z2VtX21tYW4uYyAgICB8ICA2ICstLQogLi4uL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9v
YmplY3RfYmx0LmMgIHwgIDIgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29u
dGV4dC5jICAgIHwgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdj
aGVjay5jICB8IDI4ICsrKystLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfbHJjLmMgICAgICAgIHwgMjEgKysrKystLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9z
ZWxmdGVzdF90aW1lbGluZS5jICAgfCAgNiArLS0KIC4uLi9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3Rfd29ya2Fyb3VuZHMuYyAgICB8ICA2ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9k
ZWJ1Z2ZzLmMgICAgICAgICAgIHwgNDIgKysrKystLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtLmMgICAgICAgICAgICAgICB8IDE5ICsrKystLS0tCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaCAgICAgICAgICAgfCAgNyArKy0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jICB8ICA4ICstLS0KIC4uLi9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMgICB8ICAyICstCiAuLi4vZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X3NlbGZ0ZXN0LmMgICAgfCAgOCArLS0tCiAuLi4vZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5jICAgfCAzMCArKysrKy0tLS0tLS0tCiAuLi4v
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5oICAgfCAgMiArLQogLi4uL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2xpdmVfdGVzdC5jICAgIHwgIDkgKy0tLQogLi4uL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMgIHwgIDQgLS0KIDIxIGZpbGVz
IGNoYW5nZWQsIDkxIGluc2VydGlvbnMoKyksIDE4OSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2JsdC5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsaWVudF9ibHQuYwppbmRleCBjMzQ1ZDNkNjJk
ZjEuLjM1MDIwNzFlMTM5MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX2NsaWVudF9ibHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fY2xpZW50X2JsdC5jCkBAIC0xNTUsNyArMTU1LDYgQEAgc3RhdGljIHZvaWQgY2xlYXJfcGFn
ZXNfZG1hX2ZlbmNlX2NiKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLAogc3RhdGljIHZvaWQgY2xl
YXJfcGFnZXNfd29ya2VyKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIHsKIAlzdHJ1Y3QgY2xl
YXJfcGFnZXNfd29yayAqdyA9IGNvbnRhaW5lcl9vZih3b3JrLCB0eXBlb2YoKncpLCB3b3JrKTsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHctPmNlLT5lbmdpbmUtPmk5MTU7CiAJ
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IHctPnNsZWV2ZS0+dm1hLT5vYmo7CiAJ
c3RydWN0IGk5MTVfdm1hICp2bWEgPSB3LT5zbGVldmUtPnZtYTsKIAlzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycTsKQEAgLTE3MywxMSArMTcyLDkgQEAgc3RhdGljIHZvaWQgY2xlYXJfcGFnZXNfd29y
a2VyKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAlvYmotPnJlYWRfZG9tYWlucyA9IEk5MTVf
R0VNX0dQVV9ET01BSU5TOwogCW9iai0+d3JpdGVfZG9tYWluID0gMDsKIAotCS8qIFhYWDogd2Ug
bmVlZCB0byBraWxsIHRoaXMgKi8KLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKIAllcnIgPSBpOTE1X3ZtYV9waW4odm1hLCAwLCAwLCBQSU5fVVNFUik7CiAJaWYgKHVubGlr
ZWx5KGVycikpCi0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290byBvdXRfc2lnbmFsOwogCiAJYmF0
Y2ggPSBpbnRlbF9lbWl0X3ZtYV9maWxsX2JsdCh3LT5jZSwgdm1hLCB3LT52YWx1ZSk7CiAJaWYg
KElTX0VSUihiYXRjaCkpIHsKQEAgLTIyOSw4ICsyMjYsNiBAQCBzdGF0aWMgdm9pZCBjbGVhcl9w
YWdlc193b3JrZXIoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCWludGVsX2VtaXRfdm1hX3Jl
bGVhc2Uody0+Y2UsIGJhdGNoKTsKIG91dF91bnBpbjoKIAlpOTE1X3ZtYV91bnBpbih2bWEpOwot
b3V0X3VubG9jazoKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogb3V0
X3NpZ25hbDoKIAlpZiAodW5saWtlbHkoZXJyKSkgewogCQlkbWFfZmVuY2Vfc2V0X2Vycm9yKCZ3
LT5kbWEsIGVycik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQu
YwppbmRleCA5MGFlZDRkMTYzYjMuLmJkOTM5NzY2OTMzMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCkBAIC0xMTY1LDggKzExNjUsNyBAQCBnZW44X21v
ZGlmeV9ycGNzKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgc3RydWN0IGludGVsX3NzZXUgc3Nl
dSkKIH0KIAogc3RhdGljIGludAotX19pbnRlbF9jb250ZXh0X3JlY29uZmlndXJlX3NzZXUoc3Ry
dWN0IGludGVsX2NvbnRleHQgKmNlLAotCQkJCSBzdHJ1Y3QgaW50ZWxfc3NldSBzc2V1KQoraW50
ZWxfY29udGV4dF9yZWNvbmZpZ3VyZV9zc2V1KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgc3Ry
dWN0IGludGVsX3NzZXUgc3NldSkKIHsKIAlpbnQgcmV0OwogCkBAIC0xMTg5LDIzICsxMTg4LDYg
QEAgX19pbnRlbF9jb250ZXh0X3JlY29uZmlndXJlX3NzZXUoc3RydWN0IGludGVsX2NvbnRleHQg
KmNlLAogCXJldHVybiByZXQ7CiB9CiAKLXN0YXRpYyBpbnQKLWludGVsX2NvbnRleHRfcmVjb25m
aWd1cmVfc3NldShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIHN0cnVjdCBpbnRlbF9zc2V1IHNz
ZXUpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBjZS0+ZW5naW5lLT5pOTE1
OwotCWludCByZXQ7Ci0KLQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQlyZXQgPSBfX2lu
dGVsX2NvbnRleHRfcmVjb25maWd1cmVfc3NldShjZSwgc3NldSk7Ci0KLQltdXRleF91bmxvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCi0JcmV0dXJuIHJldDsKLX0KLQogc3RhdGljIGlu
dAogdXNlcl90b19jb250ZXh0X3NzZXUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJ
CSAgICAgY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9jb250ZXh0X3BhcmFtX3NzZXUgKnVzZXIs
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCmluZGV4IDZlNGNjMTc3Y2M3YS4u
ZmVjMGI0MTBkMWQ5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYwpAQCAt
NDgsMTEgKzQ4LDcgQEAgc3RhdGljIHZvaWQgcmV0aXJlX3dvcmtfaGFuZGxlcihzdHJ1Y3Qgd29y
a19zdHJ1Y3QgKndvcmspCiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPQogCQljb250
YWluZXJfb2Yod29yaywgdHlwZW9mKCppOTE1KSwgZ2VtLnJldGlyZV93b3JrLndvcmspOwogCi0J
LyogQ29tZSBiYWNrIGxhdGVyIGlmIHRoZSBkZXZpY2UgaXMgYnVzeS4uLiAqLwotCWlmIChtdXRl
eF90cnlsb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KSkgewotCQlpOTE1X3JldGlyZV9yZXF1
ZXN0cyhpOTE1KTsKLQkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl9
CisJaTkxNV9yZXRpcmVfcmVxdWVzdHMoaTkxNSk7CiAKIAlxdWV1ZV9kZWxheWVkX3dvcmsoaTkx
NS0+d3EsCiAJCQkgICAmaTkxNS0+Z2VtLnJldGlyZV93b3JrLApAQCAtODYsMjYgKzgyLDIzIEBA
IHN0YXRpYyBib29sIHN3aXRjaF90b19rZXJuZWxfY29udGV4dF9zeW5jKHN0cnVjdCBpbnRlbF9n
dCAqZ3QpCiB7CiAJYm9vbCByZXN1bHQgPSAhaW50ZWxfZ3RfaXNfd2VkZ2VkKGd0KTsKIAotCWRv
IHsKLQkJaWYgKGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoZ3QtPmk5MTUsCi0JCQkJCSAgIEk5MTVf
V0FJVF9MT0NLRUQgfAotCQkJCQkgICBJOTE1X1dBSVRfRk9SX0lETEVfQk9PU1QsCi0JCQkJCSAg
IEk5MTVfR0VNX0lETEVfVElNRU9VVCkgPT0gLUVUSU1FKSB7Ci0JCQkvKiBYWFggaGlkZSB3YXJu
aW5nIGZyb20gZ2VtX2VpbyAqLwotCQkJaWYgKGk5MTVfbW9kcGFyYW1zLnJlc2V0KSB7Ci0JCQkJ
ZGV2X2VycihndC0+aTkxNS0+ZHJtLmRldiwKLQkJCQkJIkZhaWxlZCB0byBpZGxlIGVuZ2luZXMs
IGRlY2xhcmluZyB3ZWRnZWQhXG4iKTsKLQkJCQlHRU1fVFJBQ0VfRFVNUCgpOwotCQkJfQotCi0J
CQkvKgotCQkJICogRm9yY2libHkgY2FuY2VsIG91dHN0YW5kaW5nIHdvcmsgYW5kIGxlYXZlCi0J
CQkgKiB0aGUgZ3B1IHF1aWV0LgotCQkJICovCi0JCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKGd0KTsK
LQkJCXJlc3VsdCA9IGZhbHNlOworCWlmIChpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGd0LT5pOTE1
LAorCQkJCSAgIEk5MTVfV0FJVF9GT1JfSURMRV9CT09TVCwKKwkJCQkgICBJOTE1X0dFTV9JRExF
X1RJTUVPVVQpID09IC1FVElNRSkgeworCQkvKiBYWFggaGlkZSB3YXJuaW5nIGZyb20gZ2VtX2Vp
byAqLworCQlpZiAoaTkxNV9tb2RwYXJhbXMucmVzZXQpIHsKKwkJCWRldl9lcnIoZ3QtPmk5MTUt
PmRybS5kZXYsCisJCQkJIkZhaWxlZCB0byBpZGxlIGVuZ2luZXMsIGRlY2xhcmluZyB3ZWRnZWQh
XG4iKTsKKwkJCUdFTV9UUkFDRV9EVU1QKCk7CiAJCX0KLQl9IHdoaWxlIChpOTE1X3JldGlyZV9y
ZXF1ZXN0cyhndC0+aTkxNSkgJiYgcmVzdWx0KTsKKworCQkvKgorCQkgKiBGb3JjaWJseSBjYW5j
ZWwgb3V0c3RhbmRpbmcgd29yayBhbmQgbGVhdmUKKwkJICogdGhlIGdwdSBxdWlldC4KKwkJICov
CisJCWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOworCQlyZXN1bHQgPSBmYWxzZTsKKwl9CiAKIAlp
ZiAoaW50ZWxfZ3RfcG1fd2FpdF9mb3JfaWRsZShndCkpCiAJCXJlc3VsdCA9IGZhbHNlOwpAQCAt
MTI1LDggKzExOCw2IEBAIHZvaWQgaTkxNV9nZW1fc3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSkKIAlpbnRlbF93YWtlcmVmX2F1dG8oJmk5MTUtPmdndHQudXNlcmZhdWx0X3dh
a2VyZWYsIDApOwogCWZsdXNoX3dvcmtxdWV1ZShpOTE1LT53cSk7CiAKLQltdXRleF9sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCS8qCiAJICogV2UgaGF2ZSB0byBmbHVzaCBhbGwg
dGhlIGV4ZWN1dGluZyBjb250ZXh0cyB0byBtYWluIG1lbW9yeSBzbwogCSAqIHRoYXQgdGhleSBj
YW4gc2F2ZWQgaW4gdGhlIGhpYmVybmF0aW9uIGltYWdlLiBUbyBlbnN1cmUgdGhlIGxhc3QKQEAg
LTEzOCw4ICsxMjksNiBAQCB2b2lkIGk5MTVfZ2VtX3N1c3BlbmQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCiAJICovCiAJc3dpdGNoX3RvX2tlcm5lbF9jb250ZXh0X3N5bmMoJmk5MTUt
Pmd0KTsKIAotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAljYW5j
ZWxfZGVsYXllZF93b3JrX3N5bmMoJmk5MTUtPmd0LmhhbmdjaGVjay53b3JrKTsKIAogCWk5MTVf
Z2VtX2RyYWluX2ZyZWVkX29iamVjdHMoaTkxNSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCmluZGV4IDA2NWY1YmFkNDY2
Yi4uYTgyMjA4NjhhNTZhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
c2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYwpAQCAtOTUwLDcgKzk1MCw3IEBAIF9fc3NldV90
ZXN0KGNvbnN0IGNoYXIgKm5hbWUsCiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAotCXJldCA9
IF9faW50ZWxfY29udGV4dF9yZWNvbmZpZ3VyZV9zc2V1KGNlLCBzc2V1KTsKKwlyZXQgPSBpbnRl
bF9jb250ZXh0X3JlY29uZmlndXJlX3NzZXUoY2UsIHNzZXUpOwogCWlmIChyZXQpCiAJCWdvdG8g
b3V0X3NwaW47CiAKQEAgLTEwNTQsNyArMTA1NCw3IEBAIF9faWd0X2N0eF9zc2V1KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCQlnb3RvIG91dF9mYWlsOwogCiBvdXRfZmFpbDoKLQlp
ZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJaWYgKGlndF9mbHVz
aF90ZXN0KGk5MTUpKQogCQlyZXQgPSAtRUlPOwogCiAJaW50ZWxfY29udGV4dF91bnBpbihjZSk7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2Vt
X21tYW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1h
bi5jCmluZGV4IDljMjE3ZGZlOTZhOS4uMzljMDFiYzRlYjUxIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYwpAQCAtMzkzLDEyICsz
OTMsOCBAQCBzdGF0aWMgdm9pZCBkaXNhYmxlX3JldGlyZV93b3JrZXIoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiAKIHN0YXRpYyB2b2lkIHJlc3RvcmVfcmV0aXJlX3dvcmtlcihzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKKwlpZ3RfZmx1c2hfdGVzdChpOTE1KTsKIAlp
bnRlbF9ndF9wbV9wdXQoJmk5MTUtPmd0KTsKLQotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwotCWlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpOwotCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlpOTE1X2dlbV9kcml2ZXJf
cmVnaXN0ZXJfX3Nocmlua2VyKGk5MTUpOwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVjdF9ibHQuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fb2JqZWN0X2JsdC5jCmluZGV4IGMyMWQ3
NDdlN2QwNS4uNWEzNTE5OThhOThkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVjdF9ibHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVjdF9ibHQuYwpAQCAtMTY2LDkgKzE2Niw3
IEBAIHN0YXRpYyBpbnQgaWd0X2NvcHlfYmx0KHZvaWQgKmFyZykKIAkJaWYgKCEoZHN0LT5jYWNo
ZV9jb2hlcmVudCAmIEk5MTVfQk9fQ0FDSEVfQ09IRVJFTlRfRk9SX1dSSVRFKSkKIAkJCWRzdC0+
Y2FjaGVfZGlydHkgPSB0cnVlOwogCi0JCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwogCQllcnIgPSBpOTE1X2dlbV9vYmplY3RfY29weV9ibHQoc3JjLCBkc3QsIGNlKTsKLQkJ
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJaWYgKGVycikKIAkJCWdv
dG8gZXJyX3VucGluOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0
LmMKaW5kZXggMTQyMDUzM2U4ZmQ1Li44ODM3MzkzNTRiMDcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKQEAgLTMxMiw3ICszMTIsNyBAQCBzdGF0aWMgaW50
IGxpdmVfYWN0aXZlX2NvbnRleHQodm9pZCAqYXJnKQogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAK
LQkJZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpOworCQll
cnIgPSBpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSk7CiAJCWlmIChlcnIpCiAJCQlicmVhazsKIAl9
CkBAIC00MjUsNyArNDI1LDcgQEAgc3RhdGljIGludCBsaXZlX3JlbW90ZV9jb250ZXh0KHZvaWQg
KmFyZykKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCi0JCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0
LT5pOTE1LCBJOTE1X1dBSVRfTE9DS0VEKTsKKwkJZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5
MTUpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAJfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9zZWxmdGVzdF9oYW5nY2hlY2suYwppbmRleCBlNTNlZWExMDUwZjguLjM1YWI3MDNkYWMzNCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMKQEAgLTI4
NSw3ICsyODUsNyBAQCBzdGF0aWMgdm9pZCBoYW5nX2Zpbmkoc3RydWN0IGhhbmcgKmgpCiAKIAlr
ZXJuZWxfY29udGV4dF9jbG9zZShoLT5jdHgpOwogCi0JaWd0X2ZsdXNoX3Rlc3QoaC0+Z3QtPmk5
MTUsIEk5MTVfV0FJVF9MT0NLRUQpOworCWlndF9mbHVzaF90ZXN0KGgtPmd0LT5pOTE1KTsKIH0K
IAogc3RhdGljIGJvb2wgd2FpdF91bnRpbF9ydW5uaW5nKHN0cnVjdCBoYW5nICpoLCBzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycSkKQEAgLTQyOSwxNiArNDI5LDEzIEBAIHN0YXRpYyBpbnQgaWd0X3Jl
c2V0X25vcCh2b2lkICphcmcpCiAJCQlicmVhazsKIAkJfQogCi0JCWVyciA9IGlndF9mbHVzaF90
ZXN0KGd0LT5pOTE1LCAwKTsKKwkJZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpOwogCQlp
ZiAoZXJyKQogCQkJYnJlYWs7CiAJfSB3aGlsZSAodGltZV9iZWZvcmUoamlmZmllcywgZW5kX3Rp
bWUpKTsKIAlwcl9pbmZvKCIlczogJWQgcmVzZXRzXG4iLCBfX2Z1bmNfXywgY291bnQpOwogCi0J
bXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWVyciA9IGlndF9mbHVz
aF90ZXN0KGd0LT5pOTE1LCBJOTE1X1dBSVRfTE9DS0VEKTsKLQltdXRleF91bmxvY2soJmd0LT5p
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQorCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1
KTsKIG91dDoKIAltb2NrX2ZpbGVfZnJlZShndC0+aTkxNSwgZmlsZSk7CiAJaWYgKGludGVsX2d0
X2lzX3dlZGdlZChndCkpCkBAIC01MzMsMTUgKzUzMCwxMiBAQCBzdGF0aWMgaW50IGlndF9yZXNl
dF9ub3BfZW5naW5lKHZvaWQgKmFyZykKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCi0JCWVyciA9
IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1LCAwKTsKKwkJZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3Qt
Pmk5MTUpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAJfQogCi0JbXV0ZXhfbG9jaygmZ3QtPmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1LCBJ
OTE1X1dBSVRfTE9DS0VEKTsKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKLQorCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KTsKIG91dDoKIAltb2NrX2Zp
bGVfZnJlZShndC0+aTkxNSwgZmlsZSk7CiAJaWYgKGludGVsX2d0X2lzX3dlZGdlZChndCkpCkBA
IC02NDcsNyArNjQxLDcgQEAgc3RhdGljIGludCBfX2lndF9yZXNldF9lbmdpbmUoc3RydWN0IGlu
dGVsX2d0ICpndCwgYm9vbCBhY3RpdmUpCiAJCWlmIChlcnIpCiAJCQlicmVhazsKIAotCQllcnIg
PSBpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSwgMCk7CisJCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0
LT5pOTE1KTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCX0KQEAgLTk3Nyw5ICs5NzEsNyBAQCBz
dGF0aWMgaW50IF9faWd0X3Jlc2V0X2VuZ2luZXMoc3RydWN0IGludGVsX2d0ICpndCwKIAkJaWYg
KGVycikKIAkJCWJyZWFrOwogCi0JCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKLQkJZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUsIEk5MTVfV0FJVF9MT0NLRUQp
OwotCQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwkJZXJyID0g
aWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAJfQpAQCAt
MTUxMSw3ICsxNTAzLDcgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfcXVldWUodm9pZCAqYXJnKQog
CiAJCWk5MTVfcmVxdWVzdF9wdXQocHJldik7CiAKLQkJZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3Qt
Pmk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpOworCQllcnIgPSBpZ3RfZmx1c2hfdGVzdChndC0+aTkx
NSk7CiAJCWlmIChlcnIpCiAJCQlicmVhazsKIAl9CkBAIC0xNzUxLDEwICsxNzQzLDYgQEAgaW50
IGludGVsX2hhbmdjaGVja19saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIAogCWVyciA9IGludGVsX2d0X2xpdmVfc3VidGVzdHModGVzdHMsIGd0KTsKIAotCW11
dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZ3RfZmx1c2hfdGVzdChn
dC0+aTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCk7Ci0JbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7Ci0KIAlpOTE1X21vZHBhcmFtcy5lbmFibGVfaGFuZ2NoZWNrID0gc2F2
ZWRfaGFuZ2NoZWNrOwogCWludGVsX3J1bnRpbWVfcG1fcHV0KCZndC0+aTkxNS0+cnVudGltZV9w
bSwgd2FrZXJlZik7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKaW5kZXgg
YWNhMWIzYTljNWRlLi4yMjJhNzM3NWM3ODcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X2xyYy5jCkBAIC02MSw3ICs2MSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9zYW5pdHljaGVjayh2
b2lkICphcmcpCiAJCX0KIAogCQlpZ3Rfc3Bpbm5lcl9lbmQoJnNwaW4pOwotCQlpZiAoaWd0X2Zs
dXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpIHsKKwkJaWYgKGlndF9mbHVzaF90ZXN0
KGk5MTUpKSB7CiAJCQllcnIgPSAtRUlPOwogCQkJZ290byBlcnJfY3R4OwogCQl9CkBAIC0yMDYs
OCArMjA2LDcgQEAgc2xpY2Vfc2VtYXBob3JlX3F1ZXVlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
Km91dGVyLAogCWlmIChlcnIpCiAJCWdvdG8gb3V0OwogCi0JaWYgKGk5MTVfcmVxdWVzdF93YWl0
KGhlYWQsCi0JCQkgICAgICBJOTE1X1dBSVRfTE9DS0VELAorCWlmIChpOTE1X3JlcXVlc3Rfd2Fp
dChoZWFkLCAwLAogCQkJICAgICAgMiAqIFJVTlRJTUVfSU5GTyhvdXRlci0+aTkxNSktPm51bV9l
bmdpbmVzICogKGNvdW50ICsgMikgKiAoY291bnQgKyAzKSkgPCAwKSB7CiAJCXByX2VycigiRmFp
bGVkIHRvIHNsaWNlIGFsb25nIHNlbWFwaG9yZSBjaGFpbiBvZiBsZW5ndGggKCVkLCAlZCkhXG4i
LAogCQkgICAgICAgY291bnQsIG4pOwpAQCAtMjc5LDcgKzI3OCw3IEBAIHN0YXRpYyBpbnQgbGl2
ZV90aW1lc2xpY2VfcHJlZW1wdCh2b2lkICphcmcpCiAJCQlpZiAoZXJyKQogCQkJCWdvdG8gZXJy
X3BpbjsKIAotCQkJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKSB7
CisJCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpIHsKIAkJCQllcnIgPSAtRUlPOwogCQkJCWdv
dG8gZXJyX3BpbjsKIAkJCX0KQEAgLTgzMiw3ICs4MzEsNyBAQCBzdGF0aWMgaW50IGxpdmVfbm9w
cmVlbXB0KHZvaWQgKmFyZykKIAkJCWdvdG8gZXJyX3dlZGdlZDsKIAkJfQogCi0JCWlmIChpZ3Rf
Zmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwkJaWYgKGlndF9mbHVzaF90ZXN0
KGk5MTUpKQogCQkJZ290byBlcnJfd2VkZ2VkOwogCX0KIApAQCAtOTQ4LDcgKzk0Nyw3IEBAIHN0
YXRpYyBpbnQgbGl2ZV9zdXBwcmVzc19zZWxmX3ByZWVtcHQodm9pZCAqYXJnKQogCQkJZ290byBl
cnJfY2xpZW50X2I7CiAJCX0KIAotCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlU
X0xPQ0tFRCkpCisJCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJCWdvdG8gZXJyX3dlZGdl
ZDsKIAl9CiAKQEAgLTExMDksNyArMTEwOCw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9zdXBwcmVzc193
YWl0X3ByZWVtcHQodm9pZCAqYXJnKQogCQkJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUoY2xp
ZW50KTsgaSsrKQogCQkJCWlndF9zcGlubmVyX2VuZCgmY2xpZW50W2ldLnNwaW4pOwogCi0JCQlp
ZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJCQlpZiAoaWd0X2Zs
dXNoX3Rlc3QoaTkxNSkpCiAJCQkJZ290byBlcnJfd2VkZ2VkOwogCiAJCQlpZiAoZW5naW5lLT5l
eGVjbGlzdHMucHJlZW1wdF9oYW5nLmNvdW50KSB7CkBAIC0xMzg4LDcgKzEzODcsNyBAQCBzdGF0
aWMgaW50IGxpdmVfcHJlZW1wdF9oYW5nKHZvaWQgKmFyZykKIAogCQlpZ3Rfc3Bpbm5lcl9lbmQo
JnNwaW5faGkpOwogCQlpZ3Rfc3Bpbm5lcl9lbmQoJnNwaW5fbG8pOwotCQlpZiAoaWd0X2ZsdXNo
X3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpIHsKKwkJaWYgKGlndF9mbHVzaF90ZXN0KGk5
MTUpKSB7CiAJCQllcnIgPSAtRUlPOwogCQkJZ290byBlcnJfY3R4X2xvOwogCQl9CkBAIC0xNzg1
LDcgKzE3ODQsNyBAQCBzdGF0aWMgaW50IG5vcF92aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKIAkJcHJpbWUsIGRpdjY0X3U2NChrdGltZV90b19ucyh0aW1lc1sx
XSksIHByaW1lKSk7CiAKIG91dDoKLQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlU
X0xPQ0tFRCkpCisJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUpKQogCQllcnIgPSAtRUlPOwogCiAJ
Zm9yIChuYyA9IDA7IG5jIDwgbmN0eDsgbmMrKykgewpAQCAtMTkzMCw3ICsxOTI5LDcgQEAgc3Rh
dGljIGludCBtYXNrX3ZpcnR1YWxfZW5naW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LAogCQlnb3RvIG91dDsKIAogb3V0OgotCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dB
SVRfTE9DS0VEKSkKKwlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJCWVyciA9IC1FSU87CiAK
IAlmb3IgKG4gPSAwOyBuIDwgbnNpYmxpbmc7IG4rKykKQEAgLTIxMDgsNyArMjEwNyw3IEBAIHN0
YXRpYyBpbnQgYm9uZF92aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKIG91dDoKIAlmb3IgKG4gPSAwOyAhSVNfRVJSKHJxW25dKTsgbisrKQogCQlpOTE1X3JlcXVl
c3RfcHV0KHJxW25dKTsKLQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tF
RCkpCisJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUpKQogCQllcnIgPSAtRUlPOwogCiAJa2VybmVs
X2NvbnRleHRfY2xvc2UoY3R4KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3NlbGZ0ZXN0X3RpbWVsaW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF90
aW1lbGluZS5jCmluZGV4IDMyMTQ4MTQwMzE2NS4uNDJkMGJiYmJjN2VhIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF90aW1lbGluZS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3RpbWVsaW5lLmMKQEAgLTU0NSw3ICs1NDUsNyBAQCBz
dGF0aWMgaW50IGxpdmVfaHdzcF9lbmdpbmUodm9pZCAqYXJnKQogCX0KIAogb3V0OgotCWlmIChp
Z3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwlpZiAoaWd0X2ZsdXNoX3Rl
c3QoaTkxNSkpCiAJCWVyciA9IC1FSU87CiAKIAlmb3IgKG4gPSAwOyBuIDwgY291bnQ7IG4rKykg
ewpAQCAtNjIxLDcgKzYyMSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX2FsdGVybmF0ZSh2b2lk
ICphcmcpCiAJfQogCiBvdXQ6Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9M
T0NLRUQpKQorCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJZXJyID0gLUVJTzsKIAogCWZv
ciAobiA9IDA7IG4gPCBjb3VudDsgbisrKSB7CkBAIC03NDcsNyArNzQ3LDcgQEAgc3RhdGljIGlu
dCBsaXZlX2h3c3Bfd3JhcCh2b2lkICphcmcpCiAJfQogCiBvdXQ6Ci0JaWYgKGlndF9mbHVzaF90
ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQorCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkK
IAkJZXJyID0gLUVJTzsKIAogCWludGVsX3RpbWVsaW5lX3VucGluKHRsKTsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jCmluZGV4IDk5OWE5OGYwMDQ5
NC4uMDYzNTFmZWZiYmYzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF93b3JrYXJvdW5kcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0
X3dvcmthcm91bmRzLmMKQEAgLTY3Niw3ICs2NzYsNyBAQCBzdGF0aWMgaW50IGNoZWNrX2RpcnR5
X3doaXRlbGlzdChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogCQkJYnJlYWs7CiAJfQog
Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGN0eC0+aTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJaWYg
KGlndF9mbHVzaF90ZXN0KGN0eC0+aTkxNSkpCiAJCWVyciA9IC1FSU87CiBvdXRfYmF0Y2g6CiAJ
aTkxNV92bWFfdW5waW5fYW5kX3JlbGVhc2UoJmJhdGNoLCAwKTsKQEAgLTEwOTAsNyArMTA5MCw3
IEBAIHN0YXRpYyBpbnQgbGl2ZV9pc29sYXRlZF93aGl0ZWxpc3Qodm9pZCAqYXJnKQogCQlrZXJu
ZWxfY29udGV4dF9jbG9zZShjbGllbnRbaV0uY3R4KTsKIAl9CiAKLQlpZiAoaWd0X2ZsdXNoX3Rl
c3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUpKQog
CQllcnIgPSAtRUlPOwogCiAJcmV0dXJuIGVycjsKQEAgLTEyNDgsNyArMTI0OCw3IEBAIGxpdmVf
ZW5naW5lX3Jlc2V0X3dvcmthcm91bmRzKHZvaWQgKmFyZykKIAlpZ3RfZ2xvYmFsX3Jlc2V0X3Vu
bG9jaygmaTkxNS0+Z3QpOwogCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7CiAKLQlpZ3RfZmx1
c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKTsKKwlpZ3RfZmx1c2hfdGVzdChpOTE1KTsK
IAogCXJldHVybiByZXQ7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2RlYnVnZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCmluZGV4IDI3
YWNlZGQ4OTc4NS4uYjM1MDdlYzljOGQ2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2RlYnVnZnMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMu
YwpAQCAtMzYwMiw2ICszNjAyLDcgQEAgc3RhdGljIGludAogaTkxNV9kcm9wX2NhY2hlc19zZXQo
dm9pZCAqZGF0YSwgdTY0IHZhbCkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IGRhdGE7CisJaW50IHJldDsKIAogCURSTV9ERUJVRygiRHJvcHBpbmcgY2FjaGVzOiAweCUwOGxs
eCBbMHglMDhsbHhdXG4iLAogCQkgIHZhbCwgdmFsICYgRFJPUF9BTEwpOwpAQCAtMzYxMSw0MCAr
MzYxMiwyMSBAQCBpOTE1X2Ryb3BfY2FjaGVzX3NldCh2b2lkICpkYXRhLCB1NjQgdmFsKQogCQkg
ICAgIEk5MTVfSURMRV9FTkdJTkVTX1RJTUVPVVQpKQogCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZp
OTE1LT5ndCk7CiAKLQkvKiBObyBuZWVkIHRvIGNoZWNrIGFuZCB3YWl0IGZvciBncHUgcmVzZXRz
LCBvbmx5IGxpYmRybSBhdXRvLXJlc3RhcnRzCi0JICogb24gaW9jdGxzIG9uIC1FQUdBSU4uICov
Ci0JaWYgKHZhbCAmIChEUk9QX0FDVElWRSB8IERST1BfSURMRSB8IERST1BfUkVUSVJFIHwgRFJP
UF9SRVNFVF9TRVFOTykpIHsKLQkJaW50IHJldDsKKwlpZiAodmFsICYgRFJPUF9SRVRJUkUpCisJ
CWk5MTVfcmV0aXJlX3JlcXVlc3RzKGk5MTUpOwogCi0JCXJldCA9IG11dGV4X2xvY2tfaW50ZXJy
dXB0aWJsZSgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJaWYgKHZhbCAmIChEUk9QX0lETEUg
fCBEUk9QX0FDVElWRSkpIHsKKwkJcmV0ID0gaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShpOTE1LAor
CQkJCQkgICAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFLAorCQkJCQkgICAgIE1BWF9TQ0hFRFVM
RV9USU1FT1VUKTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiByZXQ7CisJfQogCi0JCS8qCi0JCSAq
IFRvIGZpbmlzaCB0aGUgZmx1c2ggb2YgdGhlIGlkbGVfd29ya2VyLCB3ZSBtdXN0IGNvbXBsZXRl
Ci0JCSAqIHRoZSBzd2l0Y2gtdG8ta2VybmVsLWNvbnRleHQsIHdoaWNoIHJlcXVpcmVzIGEgZG91
YmxlCi0JCSAqIHBhc3MgdGhyb3VnaCB3YWl0X2Zvcl9pZGxlOiBmaXJzdCBxdWV1ZXMgdGhlIHN3
aXRjaCwKLQkJICogc2Vjb25kIHdhaXRzIGZvciB0aGUgc3dpdGNoLgotCQkgKi8KLQkJaWYgKHJl
dCA9PSAwICYmIHZhbCAmIChEUk9QX0lETEUgfCBEUk9QX0FDVElWRSkpCi0JCQlyZXQgPSBpOTE1
X2dlbV93YWl0X2Zvcl9pZGxlKGk5MTUsCi0JCQkJCQkgICAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJ
QkxFIHwKLQkJCQkJCSAgICAgSTkxNV9XQUlUX0xPQ0tFRCwKLQkJCQkJCSAgICAgTUFYX1NDSEVE
VUxFX1RJTUVPVVQpOwotCi0JCWlmIChyZXQgPT0gMCAmJiB2YWwgJiBEUk9QX0lETEUpCi0JCQly
ZXQgPSBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGk5MTUsCi0JCQkJCQkgICAgIEk5MTVfV0FJVF9J
TlRFUlJVUFRJQkxFIHwKLQkJCQkJCSAgICAgSTkxNV9XQUlUX0xPQ0tFRCwKLQkJCQkJCSAgICAg
TUFYX1NDSEVEVUxFX1RJTUVPVVQpOwotCi0JCWlmICh2YWwgJiBEUk9QX1JFVElSRSkKLQkJCWk5
MTVfcmV0aXJlX3JlcXVlc3RzKGk5MTUpOwotCi0JCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7Ci0KLQkJaWYgKHJldCA9PSAwICYmIHZhbCAmIERST1BfSURMRSkKLQkJCXJl
dCA9IGludGVsX2d0X3BtX3dhaXRfZm9yX2lkbGUoJmk5MTUtPmd0KTsKKwlpZiAodmFsICYgRFJP
UF9JRExFKSB7CisJCXJldCA9IGludGVsX2d0X3BtX3dhaXRfZm9yX2lkbGUoJmk5MTUtPmd0KTsK
KwkJaWYgKHJldCkKKwkJCXJldHVybiByZXQ7CiAJfQogCiAJaWYgKHZhbCAmIERST1BfUkVTRVRf
QUNUSVZFICYmIGludGVsX2d0X3Rlcm1pbmFsbHlfd2VkZ2VkKCZpOTE1LT5ndCkpCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW0uYwppbmRleCBhYzg2MTYzODJjNjkuLjM4MTBjZDMwNTQwOSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbS5jCkBAIC05NDUsMTkgKzk0NSwxNiBAQCBpbnQgaTkxNV9nZW1fd2FpdF9m
b3JfaWRsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlpZiAoIWludGVsX2d0X3Bt
X2lzX2F3YWtlKCZpOTE1LT5ndCkpCiAJCXJldHVybiAwOwogCi0JR0VNX1RSQUNFKCJmbGFncz0l
eCAoJXMpLCB0aW1lb3V0PSVsZCVzXG4iLAotCQkgIGZsYWdzLCBmbGFncyAmIEk5MTVfV0FJVF9M
T0NLRUQgPyAibG9ja2VkIiA6ICJ1bmxvY2tlZCIsCi0JCSAgdGltZW91dCwgdGltZW91dCA9PSBN
QVhfU0NIRURVTEVfVElNRU9VVCA/ICIgKGZvcmV2ZXIpIiA6ICIiKTsKLQotCXRpbWVvdXQgPSB3
YWl0X2Zvcl90aW1lbGluZXMoaTkxNSwgZmxhZ3MsIHRpbWVvdXQpOwotCWlmICh0aW1lb3V0IDwg
MCkKLQkJcmV0dXJuIHRpbWVvdXQ7CisJZG8geworCQl0aW1lb3V0ID0gd2FpdF9mb3JfdGltZWxp
bmVzKGk5MTUsIGZsYWdzLCB0aW1lb3V0KTsKKwkJaWYgKHRpbWVvdXQgPCAwKQorCQkJcmV0dXJu
IHRpbWVvdXQ7CiAKLQlpZiAoZmxhZ3MgJiBJOTE1X1dBSVRfTE9DS0VEKSB7Ci0JCWxvY2tkZXBf
YXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCQljb25kX3Jlc2NoZWQoKTsK
KwkJaWYgKHNpZ25hbF9wZW5kaW5nKGN1cnJlbnQpKQorCQkJcmV0dXJuIC1FSU5UUjsKIAotCQlp
OTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1KTsKLQl9CisJfSB3aGlsZSAoaTkxNV9yZXRpcmVfcmVx
dWVzdHMoaTkxNSkpOwogCiAJcmV0dXJuIDA7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3JlcXVlc3QuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVz
dC5oCmluZGV4IDMyNTFkMmJkYmVlYS4uNTdhMjE5M2M2NGQxIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3JlcXVlc3QuaApAQCAtMzA4LDEwICszMDgsOSBAQCBsb25nIGk5MTVfcmVxdWVzdF93YWl0
KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAogCQkgICAgICAgbG9uZyB0aW1lb3V0KQogCV9fYXR0
cmlidXRlX18oKG5vbm51bGwoMSkpKTsKICNkZWZpbmUgSTkxNV9XQUlUX0lOVEVSUlVQVElCTEUJ
QklUKDApCi0jZGVmaW5lIEk5MTVfV0FJVF9MT0NLRUQJQklUKDEpIC8qIHN0cnVjdF9tdXRleCBo
ZWxkLCBoYW5kbGUgR1BVIHJlc2V0ICovCi0jZGVmaW5lIEk5MTVfV0FJVF9QUklPUklUWQlCSVQo
MikgLyogc21hbGwgcHJpb3JpdHkgYnVtcCBmb3IgdGhlIHJlcXVlc3QgKi8KLSNkZWZpbmUgSTkx
NV9XQUlUX0FMTAkJQklUKDMpIC8qIHVzZWQgYnkgaTkxNV9nZW1fb2JqZWN0X3dhaXQoKSAqLwot
I2RlZmluZSBJOTE1X1dBSVRfRk9SX0lETEVfQk9PU1QgQklUKDQpCisjZGVmaW5lIEk5MTVfV0FJ
VF9QUklPUklUWQlCSVQoMSkgLyogc21hbGwgcHJpb3JpdHkgYnVtcCBmb3IgdGhlIHJlcXVlc3Qg
Ki8KKyNkZWZpbmUgSTkxNV9XQUlUX0FMTAkJQklUKDIpIC8qIHVzZWQgYnkgaTkxNV9nZW1fb2Jq
ZWN0X3dhaXQoKSAqLworI2RlZmluZSBJOTE1X1dBSVRfRk9SX0lETEVfQk9PU1QgQklUKDMpCiAK
IHN0YXRpYyBpbmxpbmUgYm9vbCBpOTE1X3JlcXVlc3Rfc2lnbmFsZWQoY29uc3Qgc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnEpCiB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaTkxNV9hY3RpdmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1
X2FjdGl2ZS5jCmluZGV4IGFmNTgyN2FhYzdiMi4uZmYxMzM3ZTM0NTIyIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9hY3RpdmUuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9hY3RpdmUuYwpAQCAtMTY0LDEwICsxNjQsOCBA
QCBzdGF0aWMgaW50IGxpdmVfYWN0aXZlX3dhaXQodm9pZCAqYXJnKQogCiAJX19saXZlX3B1dChh
Y3RpdmUpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKGln
dF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQorCWlmIChpZ3RfZmx1c2hfdGVz
dChpOTE1KSkKIAkJZXJyID0gLUVJTzsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCiAJcmV0dXJuIGVycjsKIH0KQEAgLTE4NSwxMCArMTgzLDggQEAgc3RhdGljIGlu
dCBsaXZlX2FjdGl2ZV9yZXRpcmUodm9pZCAqYXJnKQogCQlyZXR1cm4gUFRSX0VSUihhY3RpdmUp
OwogCiAJLyogd2FpdHMgZm9yICYgcmV0aXJlcyBhbGwgcmVxdWVzdHMgKi8KLQltdXRleF9sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkx
NV9XQUlUX0xPQ0tFRCkpCisJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUpKQogCQllcnIgPSAtRUlP
OwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlpZiAoIVJFQURf
T05DRShhY3RpdmUtPnJldGlyZWQpKSB7CiAJCXByX2VycigiaTkxNV9hY3RpdmUgbm90IHJldGly
ZWQgYWZ0ZXIgZmx1c2hpbmchXG4iKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2k5MTVfZ2VtX2V2aWN0LmMKaW5kZXggYmE2MDY0MTQ3MTczLi40MjEzOWRiMGQ2OWMgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5jCkBA
IC01MjEsNyArNTIxLDcgQEAgc3RhdGljIGludCBpZ3RfZXZpY3RfY29udGV4dHModm9pZCAqYXJn
KQogCiAJbXV0ZXhfbG9jaygmaTkxNS0+Z2d0dC52bS5tdXRleCk7CiBvdXRfbG9ja2VkOgotCWlm
IChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwlpZiAoaWd0X2ZsdXNo
X3Rlc3QoaTkxNSkpCiAJCWVyciA9IC1FSU87CiAJd2hpbGUgKHJlc2VydmVkKSB7CiAJCXN0cnVj
dCByZXNlcnZlZCAqbmV4dCA9IHJlc2VydmVkLT5uZXh0OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfc2VsZnRlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X3NlbGZ0ZXN0LmMKaW5kZXggNDM4ZWEwZWFhNDE2Li44MjVhODI4
NmNiZTggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3Nl
bGZ0ZXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfc2VsZnRl
c3QuYwpAQCAtMjYzLDEwICsyNjMsOCBAQCBpbnQgX19pOTE1X2xpdmVfdGVhcmRvd24oaW50IGVy
ciwgdm9pZCAqZGF0YSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGRhdGE7
CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAoaWd0X2ZsdXNo
X3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUp
KQogCQllcnIgPSAtRUlPOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiAKIAlpOTE1X2dlbV9kcmFpbl9mcmVlZF9vYmplY3RzKGk5MTUpOwogCkBAIC0yODQsMTAgKzI4
Miw4IEBAIGludCBfX2ludGVsX2d0X2xpdmVfdGVhcmRvd24oaW50IGVyciwgdm9pZCAqZGF0YSkK
IHsKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gZGF0YTsKIAotCW11dGV4X2xvY2soJmd0LT5pOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAoaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUsIEk5MTVf
V0FJVF9MT0NLRUQpKQorCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpCiAJCWVyciA9IC1F
SU87Ci0JbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlpOTE1
X2dlbV9kcmFpbl9mcmVlZF9vYmplY3RzKGd0LT5pOTE1KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9mbHVzaF90ZXN0LmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaWd0X2ZsdXNoX3Rlc3QuYwppbmRleCBkM2I1ZWI0MDJkMzMuLjJh
NWZiZTQ2ZWE5ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2ln
dF9mbHVzaF90ZXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9m
bHVzaF90ZXN0LmMKQEAgLTEyLDMxICsxMiwyNSBAQAogCiAjaW5jbHVkZSAiaWd0X2ZsdXNoX3Rl
c3QuaCIKIAotaW50IGlndF9mbHVzaF90ZXN0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LCB1bnNpZ25lZCBpbnQgZmxhZ3MpCitpbnQgaWd0X2ZsdXNoX3Rlc3Qoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiB7CiAJaW50IHJldCA9IGludGVsX2d0X2lzX3dlZGdlZCgmaTkxNS0+
Z3QpID8gLUVJTyA6IDA7Ci0JaW50IHJlcGVhdCA9ICEhKGZsYWdzICYgSTkxNV9XQUlUX0xPQ0tF
RCk7CiAKIAljb25kX3Jlc2NoZWQoKTsKIAotCWRvIHsKLQkJaWYgKGk5MTVfZ2VtX3dhaXRfZm9y
X2lkbGUoaTkxNSwgZmxhZ3MsIEhaIC8gNSkgPT0gLUVUSU1FKSB7Ci0JCQlwcl9lcnIoIiVwUyB0
aW1lZCBvdXQsIGNhbmNlbGxpbmcgYWxsIGZ1cnRoZXIgdGVzdGluZy5cbiIsCi0JCQkgICAgICAg
X19idWlsdGluX3JldHVybl9hZGRyZXNzKDApKTsKKwlpOTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1
KTsKKwlpZiAoaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShpOTE1LCAwLCBIWiAvIDUpID09IC1FVElN
RSkgeworCQlwcl9lcnIoIiVwUyB0aW1lZCBvdXQsIGNhbmNlbGxpbmcgYWxsIGZ1cnRoZXIgdGVz
dGluZy5cbiIsCisJCSAgICAgICBfX2J1aWx0aW5fcmV0dXJuX2FkZHJlc3MoMCkpOwogCi0JCQlH
RU1fVFJBQ0UoIiVwUyB0aW1lZCBvdXQuXG4iLAotCQkJCSAgX19idWlsdGluX3JldHVybl9hZGRy
ZXNzKDApKTsKLQkJCUdFTV9UUkFDRV9EVU1QKCk7CisJCUdFTV9UUkFDRSgiJXBTIHRpbWVkIG91
dC5cbiIsCisJCQkgIF9fYnVpbHRpbl9yZXR1cm5fYWRkcmVzcygwKSk7CisJCUdFTV9UUkFDRV9E
VU1QKCk7CiAKLQkJCWludGVsX2d0X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKLQkJCXJlcGVhdCA9
IDA7Ci0JCQlyZXQgPSAtRUlPOwotCQl9Ci0KLQkJLyogRW5zdXJlIHdlIGFsc28gZmx1c2ggYWZ0
ZXIgd2VkZ2luZy4gKi8KLQkJaWYgKGZsYWdzICYgSTkxNV9XQUlUX0xPQ0tFRCkKLQkJCWk5MTVf
cmV0aXJlX3JlcXVlc3RzKGk5MTUpOwotCX0gd2hpbGUgKHJlcGVhdC0tKTsKKwkJaW50ZWxfZ3Rf
c2V0X3dlZGdlZCgmaTkxNS0+Z3QpOworCQlyZXQgPSAtRUlPOworCX0KKwlpOTE1X3JldGlyZV9y
ZXF1ZXN0cyhpOTE1KTsKIAogCXJldHVybiByZXQ7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2ZsdXNoX3Rlc3QuaCBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5oCmluZGV4IDYzZTAwOTkyN2M0My4uNzU0MWZh
NzRlNjQxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2Zs
dXNoX3Rlc3QuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2ZsdXNo
X3Rlc3QuaApAQCAtOSw2ICs5LDYgQEAKIAogc3RydWN0IGRybV9pOTE1X3ByaXZhdGU7CiAKLWlu
dCBpZ3RfZmx1c2hfdGVzdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdW5zaWduZWQg
aW50IGZsYWdzKTsKK2ludCBpZ3RfZmx1c2hfdGVzdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSk7CiAKICNlbmRpZiAvKiBJR1RfRkxVU0hfVEVTVF9IICovCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2xpdmVfdGVzdC5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9saXZlX3Rlc3QuYwppbmRleCAzZTkwMjc2MWNkMTYuLjA0
YTZmODhmZGY2NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2ln
dF9saXZlX3Rlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2xp
dmVfdGVzdC5jCkBAIC0xOSwxNSArMTksMTIgQEAgaW50IGlndF9saXZlX3Rlc3RfYmVnaW4oc3Ry
dWN0IGlndF9saXZlX3Rlc3QgKnQsCiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAJaW50IGVy
cjsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJ
dC0+aTkxNSA9IGk5MTU7CiAJdC0+ZnVuYyA9IGZ1bmM7CiAJdC0+bmFtZSA9IG5hbWU7CiAKIAll
cnIgPSBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGk5MTUsCi0JCQkJICAgICBJOTE1X1dBSVRfSU5U
RVJSVVBUSUJMRSB8Ci0JCQkJICAgICBJOTE1X1dBSVRfTE9DS0VELAorCQkJCSAgICAgSTkxNV9X
QUlUX0lOVEVSUlVQVElCTEUsCiAJCQkJICAgICBNQVhfU0NIRURVTEVfVElNRU9VVCk7CiAJaWYg
KGVycikgewogCQlwcl9lcnIoIiVzKCVzKTogZmFpbGVkIHRvIGlkbGUgYmVmb3JlLCB3aXRoIGVy
cj0lZCEiLApAQCAtNTAsOSArNDcsNyBAQCBpbnQgaWd0X2xpdmVfdGVzdF9lbmQoc3RydWN0IGln
dF9saXZlX3Rlc3QgKnQpCiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCWVudW0g
aW50ZWxfZW5naW5lX2lkIGlkOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7Ci0KLQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tF
RCkpCisJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUpKQogCQlyZXR1cm4gLUVJTzsKIAogCWlmICh0
LT5yZXNldF9nbG9iYWwgIT0gaTkxNV9yZXNldF9jb3VudCgmaTkxNS0+Z3B1X2Vycm9yKSkgewpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2Rldmlj
ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jCmlu
ZGV4IDAxYTg5YzA3MWJmNS4uMTk1NjAwNmEwZDViIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jCkBAIC00MSw4ICs0MSw2IEBAIHZvaWQg
bW9ja19kZXZpY2VfZmx1c2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwogCi0J
bG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlkbyB7CiAJ
CWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKQogCQkJbW9ja19lbmdpbmVfZmx1c2go
ZW5naW5lKTsKQEAgLTU1LDkgKzUzLDcgQEAgc3RhdGljIHZvaWQgbW9ja19kZXZpY2VfcmVsZWFz
ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZTsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCW1vY2tfZGV2aWNlX2ZsdXNoKGk5MTUpOwotCW11dGV4X3VubG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlmbHVzaF93b3JrKCZpOTE1LT5nZW0uaWRsZV93
b3JrKTsKIAlpOTE1X2dlbV9kcmFpbl93b3JrcXVldWUoaTkxNSk7Ci0tIAoyLjIzLjAKCl9fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWls
aW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZy
ZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

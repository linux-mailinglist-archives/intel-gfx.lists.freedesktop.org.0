Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4B0E811E4BC
	for <lists+intel-gfx@lfdr.de>; Fri, 13 Dec 2019 14:35:08 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E29206E872;
	Fri, 13 Dec 2019 13:35:03 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga18.intel.com (mga18.intel.com [134.134.136.126])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8A27A6E872
 for <intel-gfx@lists.freedesktop.org>; Fri, 13 Dec 2019 13:35:02 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga001.jf.intel.com ([10.7.209.18])
 by orsmga106.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 13 Dec 2019 05:35:01 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,309,1571727600"; d="scan'208";a="296927261"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by orsmga001.jf.intel.com with SMTP; 13 Dec 2019 05:34:59 -0800
Received: by stinkbox (sSMTP sendmail emulation);
 Fri, 13 Dec 2019 15:34:59 +0200
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 13 Dec 2019 15:34:50 +0200
Message-Id: <20191213133453.22152-3-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191213133453.22152-1-ville.syrjala@linux.intel.com>
References: <20191213133453.22152-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 3/6] drm/i915/fbc: Move the plane state check
 into the fbc functions
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KCklu
c3RlYWQgb2YgZGVhbGluZyB3aXRoIHRoZSBwcmVzZW5jZS9hYnNlbmNlIG9mIHRoZSBwcmltYXJ5
CnBsYW5lIGluIHRoZSBoaWdoZXIgbGV2ZWwgcHJlL3Bvc3QgcGxhbmUgdXBkYXRlIGNvZGUgbGV0
J3MKbW92ZSBhbGwgdGhhdCBpbnRvIHRoZSBmYmMgY29kZSBpdHNlbGYuIE5vdyB0aGUgaGlnaGVy
IGxldmVsCmNvZGUgZG9lc24ndCBoYXZlIHRvIHRoaW5rIGFib3V0IEZCQyBkZXRhaWxzIGFueW1v
cmUuCgpTaWduZWQtb2ZmLWJ5OiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFAbGludXgu
aW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxh
eS5jIHwgMjYgKysrLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9mYmMuYyAgICAgfCA0MCArKysrKysrKysrKysrKystLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9mYmMuaCAgICAgfCAxMyArKystLS0tCiAzIGZpbGVzIGNoYW5nZWQs
IDQyIGluc2VydGlvbnMoKyksIDM3IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggOGYxNDM1MmEyMTkzLi4zZTU0MGZjY2Ey
MTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxh
eS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBA
IC02MDEzLDEzICs2MDEzLDEwIEBAIHN0YXRpYyB2b2lkIGludGVsX3Bvc3RfcGxhbmVfdXBkYXRl
KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQkJCSAgICBzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YykKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KHN0YXRlLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX3BsYW5lICpwcmltYXJ5ID0gdG9f
aW50ZWxfcGxhbmUoY3J0Yy0+YmFzZS5wcmltYXJ5KTsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUgPQogCQlpbnRlbF9hdG9taWNfZ2V0X29sZF9jcnRjX3N0
YXRlKHN0YXRlLCBjcnRjKTsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2Ny
dGNfc3RhdGUgPQogCQlpbnRlbF9hdG9taWNfZ2V0X25ld19jcnRjX3N0YXRlKHN0YXRlLCBjcnRj
KTsKLQljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm5ld19wcmltYXJ5X3N0YXRlID0K
LQkJaW50ZWxfYXRvbWljX2dldF9uZXdfcGxhbmVfc3RhdGUoc3RhdGUsIHByaW1hcnkpOwogCWVu
dW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAogCWludGVsX2Zyb250YnVmZmVyX2ZsaXAoZGV2
X3ByaXYsIG5ld19jcnRjX3N0YXRlLT5mYl9iaXRzKTsKQEAgLTYwMzAsOCArNjAyNyw3IEBAIHN0
YXRpYyB2b2lkIGludGVsX3Bvc3RfcGxhbmVfdXBkYXRlKHN0cnVjdCBpbnRlbF9hdG9taWNfc3Rh
dGUgKnN0YXRlLAogCWlmIChoc3dfcG9zdF91cGRhdGVfZW5hYmxlX2lwcyhvbGRfY3J0Y19zdGF0
ZSwgbmV3X2NydGNfc3RhdGUpKQogCQloc3dfZW5hYmxlX2lwcyhuZXdfY3J0Y19zdGF0ZSk7CiAK
LQlpZiAobmV3X3ByaW1hcnlfc3RhdGUpCi0JCWludGVsX2ZiY19wb3N0X3VwZGF0ZShjcnRjKTsK
KwlpbnRlbF9mYmNfcG9zdF91cGRhdGUoc3RhdGUsIGNydGMpOwogCiAJaWYgKG5lZWRzX252MTJf
d2Eob2xkX2NydGNfc3RhdGUpICYmCiAJICAgICFuZWVkc19udjEyX3dhKG5ld19jcnRjX3N0YXRl
KSkKQEAgLTYwNDYsMjAgKzYwNDIsMTYgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHJlX3BsYW5lX3Vw
ZGF0ZShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAkJCQkgICBzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YykKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KHN0YXRlLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX3BsYW5lICpwcmltYXJ5ID0g
dG9faW50ZWxfcGxhbmUoY3J0Yy0+YmFzZS5wcmltYXJ5KTsKIAljb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUgPQogCQlpbnRlbF9hdG9taWNfZ2V0X29sZF9jcnRj
X3N0YXRlKHN0YXRlLCBjcnRjKTsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3
X2NydGNfc3RhdGUgPQogCQlpbnRlbF9hdG9taWNfZ2V0X25ld19jcnRjX3N0YXRlKHN0YXRlLCBj
cnRjKTsKLQljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm5ld19wcmltYXJ5X3N0YXRl
ID0KLQkJaW50ZWxfYXRvbWljX2dldF9uZXdfcGxhbmVfc3RhdGUoc3RhdGUsIHByaW1hcnkpOwog
CWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAogCWlmIChoc3dfcHJlX3VwZGF0ZV9kaXNh
YmxlX2lwcyhvbGRfY3J0Y19zdGF0ZSwgbmV3X2NydGNfc3RhdGUpKQogCQloc3dfZGlzYWJsZV9p
cHMob2xkX2NydGNfc3RhdGUpOwogCi0JaWYgKG5ld19wcmltYXJ5X3N0YXRlICYmCi0JICAgIGlu
dGVsX2ZiY19wcmVfdXBkYXRlKGNydGMsIG5ld19jcnRjX3N0YXRlLCBuZXdfcHJpbWFyeV9zdGF0
ZSkpCisJaWYgKGludGVsX2ZiY19wcmVfdXBkYXRlKHN0YXRlLCBjcnRjKSkKIAkJaW50ZWxfd2Fp
dF9mb3JfdmJsYW5rKGRldl9wcml2LCBwaXBlKTsKIAogCS8qIERpc3BsYXkgV0EgODI3ICovCkBA
IC0xNDI4OSw5ICsxNDI4MSw2IEBAIHN0YXRpYyB2b2lkIGludGVsX3VwZGF0ZV9jcnRjKHN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjLAogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoc3RhdGUtPmJhc2UuZGV2KTsKIAlib29sIG1vZGVzZXQgPSBuZWVkc19tb2Rl
c2V0KG5ld19jcnRjX3N0YXRlKTsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm5ld19wbGFu
ZV9zdGF0ZSA9Ci0JCWludGVsX2F0b21pY19nZXRfbmV3X3BsYW5lX3N0YXRlKHN0YXRlLAotCQkJ
CQkJIHRvX2ludGVsX3BsYW5lKGNydGMtPmJhc2UucHJpbWFyeSkpOwogCiAJaWYgKG1vZGVzZXQp
IHsKIAkJaW50ZWxfY3J0Y191cGRhdGVfYWN0aXZlX3RpbWluZ3MobmV3X2NydGNfc3RhdGUpOwpA
QCAtMTQzMTQsOCArMTQzMDMsOCBAQCBzdGF0aWMgdm9pZCBpbnRlbF91cGRhdGVfY3J0YyhzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAogCWlmIChuZXdfY3J0Y19zdGF0ZS0+dXBkYXRlX3BpcGUg
JiYgIW5ld19jcnRjX3N0YXRlLT5lbmFibGVfZmJjKQogCQlpbnRlbF9mYmNfZGlzYWJsZShjcnRj
KTsKLQllbHNlIGlmIChuZXdfcGxhbmVfc3RhdGUpCi0JCWludGVsX2ZiY19lbmFibGUoY3J0Yywg
bmV3X2NydGNfc3RhdGUsIG5ld19wbGFuZV9zdGF0ZSk7CisJZWxzZQorCQlpbnRlbF9mYmNfZW5h
YmxlKHN0YXRlLCBjcnRjKTsKIAogCS8qIFBlcmZvcm0gdmJsYW5rIGV2YXNpb24gYXJvdW5kIGNv
bW1pdCBvcGVyYXRpb24gKi8KIAlpbnRlbF9waXBlX3VwZGF0ZV9zdGFydChuZXdfY3J0Y19zdGF0
ZSk7CkBAIC0xNDQ3MiwxNSArMTQ0NjEsMTIgQEAgc3RhdGljIHZvaWQgaW50ZWxfcG9zdF9jcnRj
X2VuYWJsZV91cGRhdGVzKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQlpbnRlbF9hdG9taWNf
Z2V0X25ld19jcnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqb2xkX2NydGNfc3RhdGUgPQogCQlpbnRlbF9hdG9taWNfZ2V0X29sZF9jcnRjX3N0YXRlKHN0
YXRlLCBjcnRjKTsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm5ld19wbGFuZV9zdGF0ZSA9
Ci0JCWludGVsX2F0b21pY19nZXRfbmV3X3BsYW5lX3N0YXRlKHN0YXRlLAotCQkJCQkJIHRvX2lu
dGVsX3BsYW5lKGNydGMtPmJhc2UucHJpbWFyeSkpOwogCWJvb2wgbW9kZXNldCA9IG5lZWRzX21v
ZGVzZXQobmV3X2NydGNfc3RhdGUpOwogCiAJaWYgKG5ld19jcnRjX3N0YXRlLT51cGRhdGVfcGlw
ZSAmJiAhbmV3X2NydGNfc3RhdGUtPmVuYWJsZV9mYmMpCiAJCWludGVsX2ZiY19kaXNhYmxlKGNy
dGMpOwotCWVsc2UgaWYgKG5ld19wbGFuZV9zdGF0ZSkKLQkJaW50ZWxfZmJjX2VuYWJsZShjcnRj
LCBuZXdfY3J0Y19zdGF0ZSwgbmV3X3BsYW5lX3N0YXRlKTsKKwllbHNlCisJCWludGVsX2ZiY19l
bmFibGUoc3RhdGUsIGNydGMpOwogCiAJLyogUGVyZm9ybSB2YmxhbmsgZXZhc2lvbiBhcm91bmQg
Y29tbWl0IG9wZXJhdGlvbiAqLwogCWludGVsX3BpcGVfdXBkYXRlX3N0YXJ0KG5ld19jcnRjX3N0
YXRlKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJj
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiYy5jCmluZGV4IGExMDQ4
ZWNlNTQxZS4uNDI1MDRlNjM1M2Q1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2ZiYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZmJjLmMKQEAgLTg2NywxMCArODY3LDE0IEBAIHN0YXRpYyBib29sIGludGVsX2ZiY19jYW5f
ZmxpcF9udWtlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCXJl
dHVybiB0cnVlOwogfQogCi1ib29sIGludGVsX2ZiY19wcmVfdXBkYXRlKHN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjLAotCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSwKLQkJCSAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKK2Jv
b2wgaW50ZWxfZmJjX3ByZV91cGRhdGUoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUs
CisJCQkgIHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQogeworCXN0cnVjdCBpbnRlbF9wbGFuZSAq
cGxhbmUgPSB0b19pbnRlbF9wbGFuZShjcnRjLT5iYXNlLnByaW1hcnkpOworCWNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlID0KKwkJaW50ZWxfYXRvbWljX2dldF9uZXdf
Y3J0Y19zdGF0ZShzdGF0ZSwgY3J0Yyk7CisJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICpwbGFuZV9zdGF0ZSA9CisJCWludGVsX2F0b21pY19nZXRfbmV3X3BsYW5lX3N0YXRlKHN0YXRl
LCBwbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShj
cnRjLT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX2ZiYyAqZmJjID0gJmRldl9wcml2LT5mYmM7
CiAJY29uc3QgY2hhciAqcmVhc29uID0gInVwZGF0ZSBwZW5kaW5nIjsKQEAgLTg3OSw2ICs4ODMs
OSBAQCBib29sIGludGVsX2ZiY19wcmVfdXBkYXRlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAog
CWlmICghZmJjX3N1cHBvcnRlZChkZXZfcHJpdikpCiAJCXJldHVybiBuZWVkX3ZibGFua193YWl0
OwogCisJaWYgKCFwbGFuZV9zdGF0ZSkKKwkJcmV0dXJuIG5lZWRfdmJsYW5rX3dhaXQ7CisKIAlt
dXRleF9sb2NrKCZmYmMtPmxvY2spOwogCiAJaWYgKGZiYy0+Y3J0YyAhPSBjcnRjKQpAQCAtOTY3
LDE0ICs5NzQsMjEgQEAgc3RhdGljIHZvaWQgX19pbnRlbF9mYmNfcG9zdF91cGRhdGUoc3RydWN0
IGludGVsX2NydGMgKmNydGMpCiAJCWludGVsX2ZiY19kZWFjdGl2YXRlKGRldl9wcml2LCAiZnJv
bnRidWZmZXIgd3JpdGUiKTsKIH0KIAotdm9pZCBpbnRlbF9mYmNfcG9zdF91cGRhdGUoc3RydWN0
IGludGVsX2NydGMgKmNydGMpCit2b2lkIGludGVsX2ZiY19wb3N0X3VwZGF0ZShzdHJ1Y3QgaW50
ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKKwkJCSAgIHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQog
ewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFz
ZS5kZXYpOworCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShjcnRj
LT5iYXNlLnByaW1hcnkpOworCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVf
c3RhdGUgPQorCQlpbnRlbF9hdG9taWNfZ2V0X25ld19wbGFuZV9zdGF0ZShzdGF0ZSwgcGxhbmUp
OwogCXN0cnVjdCBpbnRlbF9mYmMgKmZiYyA9ICZkZXZfcHJpdi0+ZmJjOwogCiAJaWYgKCFmYmNf
c3VwcG9ydGVkKGRldl9wcml2KSkKIAkJcmV0dXJuOwogCisJaWYgKCFwbGFuZV9zdGF0ZSkKKwkJ
cmV0dXJuOworCiAJbXV0ZXhfbG9jaygmZmJjLT5sb2NrKTsKIAlfX2ludGVsX2ZiY19wb3N0X3Vw
ZGF0ZShjcnRjKTsKIAltdXRleF91bmxvY2soJmZiYy0+bG9jayk7CkBAIC0xMTA3LDE4ICsxMTIx
LDI0IEBAIHZvaWQgaW50ZWxfZmJjX2Nob29zZV9jcnRjKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKICAqIGludGVsX2ZiY19lbmFibGUgbXVsdGlwbGUgdGltZXMgZm9yIHRoZSBz
YW1lIHBpcGUgd2l0aG91dCBhbgogICogaW50ZWxfZmJjX2Rpc2FibGUgaW4gdGhlIG1pZGRsZSwg
YXMgbG9uZyBhcyBpdCBpcyBkZWFjdGl2YXRlZC4KICAqLwotdm9pZCBpbnRlbF9mYmNfZW5hYmxl
KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAotCQkgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0
YXRlICpwbGFuZV9zdGF0ZSkKK3ZvaWQgaW50ZWxfZmJjX2VuYWJsZShzdHJ1Y3QgaW50ZWxfYXRv
bWljX3N0YXRlICpzdGF0ZSwKKwkJICAgICAgc3RydWN0IGludGVsX2NydGMgKmNydGMpCiB7CiAJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRl
dik7CisJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKGNydGMtPmJh
c2UucHJpbWFyeSk7CisJY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUg
PQorCQlpbnRlbF9hdG9taWNfZ2V0X25ld19jcnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsKKwljb25z
dCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlID0KKwkJaW50ZWxfYXRvbWlj
X2dldF9uZXdfcGxhbmVfc3RhdGUoc3RhdGUsIHBsYW5lKTsKIAlzdHJ1Y3QgaW50ZWxfZmJjICpm
YmMgPSAmZGV2X3ByaXYtPmZiYzsKIAlzdHJ1Y3QgaW50ZWxfZmJjX3N0YXRlX2NhY2hlICpjYWNo
ZSA9ICZmYmMtPnN0YXRlX2NhY2hlOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
ID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCiAJaWYgKCFmYmNfc3VwcG9ydGVkKGRldl9wcml2KSkK
IAkJcmV0dXJuOwogCisJaWYgKCFwbGFuZV9zdGF0ZSkKKwkJcmV0dXJuOworCiAJbXV0ZXhfbG9j
aygmZmJjLT5sb2NrKTsKIAogCWlmIChmYmMtPmNydGMpIHsKQEAgLTExMzksMTQgKzExNTksMTQg
QEAgdm9pZCBpbnRlbF9mYmNfZW5hYmxlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCiAJaWYg
KGludGVsX2ZiY19hbGxvY19jZmIoZGV2X3ByaXYsCiAJCQkJaW50ZWxfZmJjX2NhbGN1bGF0ZV9j
ZmJfc2l6ZShkZXZfcHJpdiwgY2FjaGUpLAotCQkJCWZiLT5mb3JtYXQtPmNwcFswXSkpIHsKKwkJ
CQlwbGFuZV9zdGF0ZS0+aHcuZmItPmZvcm1hdC0+Y3BwWzBdKSkgewogCQljYWNoZS0+cGxhbmUu
dmlzaWJsZSA9IGZhbHNlOwogCQlmYmMtPm5vX2ZiY19yZWFzb24gPSAibm90IGVub3VnaCBzdG9s
ZW4gbWVtb3J5IjsKIAkJZ290byBvdXQ7CiAJfQogCiAJaWYgKChJU19HRU45X0JDKGRldl9wcml2
KSB8fCBJU19CUk9YVE9OKGRldl9wcml2KSkgJiYKLQkgICAgZmItPm1vZGlmaWVyICE9IEk5MTVf
Rk9STUFUX01PRF9YX1RJTEVEKQorCSAgICBwbGFuZV9zdGF0ZS0+aHcuZmItPm1vZGlmaWVyICE9
IEk5MTVfRk9STUFUX01PRF9YX1RJTEVEKQogCQljYWNoZS0+Z2VuOV93YV9jZmJfc3RyaWRlID0K
IAkJCURJVl9ST1VORF9VUChjYWNoZS0+cGxhbmUuc3JjX3csIDMyICogZmJjLT50aHJlc2hvbGQp
ICogODsKIAllbHNlCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2ZiYy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmMuaAppbmRl
eCBjOGE1ZTUwOTg2ODcuLjZkYzFlZGVmZTgxYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9mYmMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2ZiYy5oCkBAIC0xOSwxNCArMTksMTMgQEAgc3RydWN0IGludGVsX3BsYW5lX3N0
YXRlOwogdm9pZCBpbnRlbF9mYmNfY2hvb3NlX2NydGMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogCQkJICAgc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpOwogYm9v
bCBpbnRlbF9mYmNfaXNfYWN0aXZlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7
Ci1ib29sIGludGVsX2ZiY19wcmVfdXBkYXRlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAotCQkJ
ICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKLQkJCSAgY29uc3Qg
c3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSk7Ci12b2lkIGludGVsX2ZiY19w
b3N0X3VwZGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0Yyk7Citib29sIGludGVsX2ZiY19wcmVf
dXBkYXRlKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAorCQkJICBzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0Yyk7Cit2b2lkIGludGVsX2ZiY19wb3N0X3VwZGF0ZShzdHJ1Y3QgaW50ZWxf
YXRvbWljX3N0YXRlICpzdGF0ZSwKKwkJCSAgIHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKTsKIHZv
aWQgaW50ZWxfZmJjX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXZv
aWQgaW50ZWxfZmJjX2VuYWJsZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKLQkJICAgICAgY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCi0JCSAgICAgIGNvbnN0IHN0
cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpOwordm9pZCBpbnRlbF9mYmNfZW5h
YmxlKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAorCQkgICAgICBzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0Yyk7CiB2b2lkIGludGVsX2ZiY19kaXNhYmxlKHN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjKTsKIHZvaWQgaW50ZWxfZmJjX2dsb2JhbF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdik7CiB2b2lkIGludGVsX2ZiY19pbnZhbGlkYXRlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1n
ZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21h
aWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

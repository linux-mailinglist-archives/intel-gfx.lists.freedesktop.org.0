Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 06B498F1E8
	for <lists+intel-gfx@lfdr.de>; Thu, 15 Aug 2019 19:16:55 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 688406E44A;
	Thu, 15 Aug 2019 17:16:53 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga03.intel.com (mga03.intel.com [134.134.136.65])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8691D6E44A
 for <intel-gfx@lists.freedesktop.org>; Thu, 15 Aug 2019 17:16:52 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga002.fm.intel.com ([10.253.24.26])
 by orsmga103.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 15 Aug 2019 10:12:34 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,389,1559545200"; d="scan'208";a="205961408"
Received: from irvmail001.ir.intel.com ([163.33.26.43])
 by fmsmga002.fm.intel.com with ESMTP; 15 Aug 2019 10:12:33 -0700
Received: from mwajdecz-MOBL1.ger.corp.intel.com
 (mwajdecz-mobl1.ger.corp.intel.com [10.249.129.244])
 by irvmail001.ir.intel.com (8.14.3/8.13.6/MailSET/Hub) with ESMTP id
 x7FHCU6k030661; Thu, 15 Aug 2019 18:12:32 +0100
From: Michal Wajdeczko <michal.wajdeczko@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 15 Aug 2019 17:12:25 +0000
Message-Id: <20190815171228.31920-3-michal.wajdeczko@intel.com>
X-Mailer: git-send-email 2.21.0.windows.1
In-Reply-To: <20190815171228.31920-1-michal.wajdeczko@intel.com>
References: <20190815171228.31920-1-michal.wajdeczko@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 2/5] drm/i915/wopcm: Check WOPCM layout
 separately from calculations
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgY2FuIGRvIFdPUENNIHBhcnRpdGlvbmluZyB1c2luZyByb3VnaCBlc3RpbWF0ZXMgYW5kIGxp
bWl0cwphbmQgcGVyZm9ybSBkZXRhaWxlZCBjaGVjayBhcyBzZXBhcmF0ZSBzdGVwLgoKU2lnbmVk
LW9mZi1ieTogTWljaGFsIFdhamRlY3prbyA8bWljaGFsLndhamRlY3prb0BpbnRlbC5jb20+CkNj
OiBEYW5pZWxlIENlcmFvbG8gU3B1cmlvIDxkYW5pZWxlLmNlcmFvbG9zcHVyaW9AaW50ZWwuY29t
PgpDYzogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0tLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaW50ZWxfd29wY20uYyB8IDEwNSArKysrKysrKysrKysrKysrKysrKy0t
LS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDc0IGluc2VydGlvbnMoKyksIDMxIGRlbGV0aW9ucygt
KQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dvcGNtLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF93b3BjbS5jCmluZGV4IDI5NzVlMDBmNTdmNS4uM2FjMDUw
NTViYjA4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF93b3BjbS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dvcGNtLmMKQEAgLTg3LDcgKzg3LDggQEAg
dm9pZCBpbnRlbF93b3BjbV9pbml0X2Vhcmx5KHN0cnVjdCBpbnRlbF93b3BjbSAqd29wY20pCiAJ
ZWxzZQogCQl3b3BjbS0+c2l6ZSA9IEdFTjlfV09QQ01fU0laRTsKIAotCURSTV9ERUJVR19EUklW
RVIoIldPUENNIHNpemU6ICV1S2lCXG4iLCB3b3BjbS0+c2l6ZSAvIDEwMjQpOworCURSTV9ERVZf
REVCVUdfRFJJVkVSKGk5MTUtPmRybS5kZXYsICJXT1BDTTogc2l6ZSAldUtpQlxuIiwKKwkJCSAg
ICAgd29wY20tPnNpemUgLyBTWl8xSyk7CiB9CiAKIHN0YXRpYyBpbmxpbmUgdTMyIGNvbnRleHRf
cmVzZXJ2ZWRfc2l6ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKQEAgLTEzOCw5ICsx
MzksOSBAQCBzdGF0aWMgaW5saW5lIGludCBnZW45X2NoZWNrX2h1Y19md19maXRzKHUzMiBndWNf
d29wY21fc2l6ZSwgdTMyIGh1Y19md19zaXplKQogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW5s
aW5lIGludCBjaGVja19od19yZXN0cmljdGlvbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKLQkJCQkgICAgICAgdTMyIGd1Y193b3BjbV9iYXNlLCB1MzIgZ3VjX3dvcGNtX3NpemUsCi0J
CQkJICAgICAgIHUzMiBodWNfZndfc2l6ZSkKK3N0YXRpYyBpbmxpbmUgYm9vbCBjaGVja19od19y
ZXN0cmljdGlvbnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCisJCQkJCSB1MzIgZ3Vj
X3dvcGNtX2Jhc2UsIHUzMiBndWNfd29wY21fc2l6ZSwKKwkJCQkJIHUzMiBodWNfZndfc2l6ZSkK
IHsKIAlpbnQgZXJyID0gMDsKIApAQCAtMTUxLDcgKzE1Miw2NCBAQCBzdGF0aWMgaW5saW5lIGlu
dCBjaGVja19od19yZXN0cmljdGlvbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkg
ICAgKElTX0dFTihpOTE1LCA5KSB8fCBJU19DTkxfUkVWSUQoaTkxNSwgQ05MX1JFVklEX0EwLCBD
TkxfUkVWSURfQTApKSkKIAkJZXJyID0gZ2VuOV9jaGVja19odWNfZndfZml0cyhndWNfd29wY21f
c2l6ZSwgaHVjX2Z3X3NpemUpOwogCi0JcmV0dXJuIGVycjsKKwlyZXR1cm4gIWVycjsKK30KKwor
c3RhdGljIGlubGluZSBib29sIF9fY2hlY2tfbGF5b3V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LCB1MzIgd29wY21fc2l6ZSwKKwkJCQkgIHUzMiBndWNfd29wY21fYmFzZSwgdTMyIGd1
Y193b3BjbV9zaXplLAorCQkJCSAgdTMyIGd1Y19md19zaXplLCB1MzIgaHVjX2Z3X3NpemUpCit7
CisJY29uc3QgdTMyIGN0eF9yc3ZkID0gY29udGV4dF9yZXNlcnZlZF9zaXplKGk5MTUpOworCXUz
MiBzaXplOworCisJaWYgKHVubGlrZWx5KGd1Y193b3BjbV9iYXNlID4gd29wY21fc2l6ZSkpIHsK
KwkJZGV2X2VycihpOTE1LT5kcm0uZGV2LAorCQkJIldPUENNOiBpbnZhbGlkIEd1QyByZWdpb24g
YmFzZTogJXVLID4gJXVLXG4iLAorCQkJZ3VjX3dvcGNtX2Jhc2UgLyBTWl8xSywgd29wY21fc2l6
ZSAvIFNaXzFLKTsKKwkJcmV0dXJuIGZhbHNlOworCX0KKworCXNpemUgPSB3b3BjbV9zaXplIC0g
Y3R4X3JzdmQ7CisJaWYgKHVubGlrZWx5KGd1Y193b3BjbV9iYXNlID4gc2l6ZSkpIHsKKwkJZGV2
X2VycihpOTE1LT5kcm0uZGV2LAorCQkJIldPUENNOiBpbnZhbGlkIEd1QyByZWdpb24gYmFzZTog
JXVLID4gJXVLXG4iLAorCQkJZ3VjX3dvcGNtX2Jhc2UgLyBTWl8xSywgc2l6ZSAvIFNaXzFLKTsK
KwkJcmV0dXJuIGZhbHNlOworCX0KKworCWlmICh1bmxpa2VseShndWNfd29wY21fc2l6ZSA+IHdv
cGNtX3NpemUpKSB7CisJCWRldl9lcnIoaTkxNS0+ZHJtLmRldiwKKwkJCSJXT1BDTTogaW52YWxp
ZCBHdUMgcmVnaW9uIHNpemU6ICV1SyA+ICV1S1xuIiwKKwkJCWd1Y193b3BjbV9zaXplIC8gU1pf
MUssIHdvcGNtX3NpemUgLyBTWl8xSyk7CisJCXJldHVybiBmYWxzZTsKKwl9CisKKwlzaXplID0g
d29wY21fc2l6ZSAtIGd1Y193b3BjbV9iYXNlIC0gY3R4X3JzdmQ7CisJaWYgKHVubGlrZWx5KGd1
Y193b3BjbV9zaXplID4gc2l6ZSkpIHsKKwkJZGV2X2VycihpOTE1LT5kcm0uZGV2LAorCQkJIldP
UENNOiBpbnZhbGlkIEd1QyByZWdpb24gc2l6ZTogJXVLID4gJXVLXG4iLAorCQkJZ3VjX3dvcGNt
X3NpemUgLyBTWl8xSywgc2l6ZSAvIFNaXzFLKTsKKwkJcmV0dXJuIGZhbHNlOworCX0KKworCXNp
emUgPSBndWNfZndfc2l6ZSArIEdVQ19XT1BDTV9SRVNFUlZFRCArIEdVQ19XT1BDTV9TVEFDS19S
RVNFUlZFRDsKKwlpZiAodW5saWtlbHkoZ3VjX3dvcGNtX3NpemUgPCBzaXplKSkgeworCQlkZXZf
ZXJyKGk5MTUtPmRybS5kZXYsICJXT1BDTTogbm8gc3BhY2UgZm9yICVzOiAldUsgPCAldUtcbiIs
CisJCQlpbnRlbF91Y19md190eXBlX3JlcHIoSU5URUxfVUNfRldfVFlQRV9HVUMpLAorCQkJZ3Vj
X3dvcGNtX3NpemUgLyBTWl8xSywgc2l6ZSAvIFNaXzFLKTsKKwkJcmV0dXJuIGZhbHNlOworCX0K
KworCXNpemUgPSBodWNfZndfc2l6ZSArIFdPUENNX1JFU0VSVkVEX1NJWkU7CisJaWYgKHVubGlr
ZWx5KGd1Y193b3BjbV9iYXNlIDwgc2l6ZSkpIHsKKwkJZGV2X2VycihpOTE1LT5kcm0uZGV2LCAi
V09QQ006IG5vIHNwYWNlIGZvciAlczogJXVLIDwgJXVLXG4iLAorCQkJaW50ZWxfdWNfZndfdHlw
ZV9yZXByKElOVEVMX1VDX0ZXX1RZUEVfSFVDKSwKKwkJCWd1Y193b3BjbV9iYXNlIC8gU1pfMUss
IHNpemUgLyBTWl8xSyk7CisJCXJldHVybiBmYWxzZTsKKwl9CisKKwlyZXR1cm4gY2hlY2tfaHdf
cmVzdHJpY3Rpb25zKGk5MTUsIGd1Y193b3BjbV9iYXNlLCBndWNfd29wY21fc2l6ZSwKKwkJCQkg
ICAgIGh1Y19md19zaXplKTsKIH0KIAogLyoqCkBAIC0xNzIsOCArMjMwLDYgQEAgdm9pZCBpbnRl
bF93b3BjbV9pbml0KHN0cnVjdCBpbnRlbF93b3BjbSAqd29wY20pCiAJdTMyIGN0eF9yc3ZkID0g
Y29udGV4dF9yZXNlcnZlZF9zaXplKGk5MTUpOwogCXUzMiBndWNfd29wY21fYmFzZTsKIAl1MzIg
Z3VjX3dvcGNtX3NpemU7Ci0JdTMyIGd1Y193b3BjbV9yc3ZkOwotCWludCBlcnI7CiAKIAlpZiAo
IWd1Y19md19zaXplKQogCQlyZXR1cm47CkBAIC0xODMsMzkgKzIzOSwyNiBAQCB2b2lkIGludGVs
X3dvcGNtX2luaXQoc3RydWN0IGludGVsX3dvcGNtICp3b3BjbSkKIAlHRU1fQlVHX09OKHdvcGNt
LT5ndWMuc2l6ZSk7CiAJR0VNX0JVR19PTihndWNfZndfc2l6ZSA+PSB3b3BjbS0+c2l6ZSk7CiAJ
R0VNX0JVR19PTihodWNfZndfc2l6ZSA+PSB3b3BjbS0+c2l6ZSk7CisJR0VNX0JVR19PTihjdHhf
cnN2ZCArIFdPUENNX1JFU0VSVkVEX1NJWkUgPj0gd29wY20tPnNpemUpOwogCiAJaWYgKGk5MTVf
aW5qZWN0X3Byb2JlX2ZhaWx1cmUoaTkxNSkpCiAJCXJldHVybjsKIAogCWd1Y193b3BjbV9iYXNl
ID0gQUxJR04oaHVjX2Z3X3NpemUgKyBXT1BDTV9SRVNFUlZFRF9TSVpFLAogCQkJICAgICAgIEdV
Q19XT1BDTV9PRkZTRVRfQUxJR05NRU5UKTsKLQlpZiAoKGd1Y193b3BjbV9iYXNlICsgY3R4X3Jz
dmQpID49IHdvcGNtLT5zaXplKSB7Ci0JCURSTV9FUlJPUigiR3VDIFdPUENNIGJhc2UgKCV1S2lC
KSBpcyB0b28gYmlnLlxuIiwKLQkJCSAgZ3VjX3dvcGNtX2Jhc2UgLyAxMDI0KTsKLQkJcmV0dXJu
OwotCX0KLQorCWd1Y193b3BjbV9iYXNlID0gbWF4KHdvcGNtLT5zaXplIC0gY3R4X3JzdmQsIGd1
Y193b3BjbV9iYXNlKTsKIAlndWNfd29wY21fc2l6ZSA9IHdvcGNtLT5zaXplIC0gZ3VjX3dvcGNt
X2Jhc2UgLSBjdHhfcnN2ZDsKIAlndWNfd29wY21fc2l6ZSAmPSBHVUNfV09QQ01fU0laRV9NQVNL
OwogCi0JRFJNX0RFQlVHX0RSSVZFUigiQ2FsY3VsYXRlZCBHdUMgV09QQ00gUmVnaW9uOiBbJXVL
aUIsICV1S2lCKVxuIiwKLQkJCSBndWNfd29wY21fYmFzZSAvIDEwMjQsIGd1Y193b3BjbV9zaXpl
IC8gMTAyNCk7CisJRFJNX0RFVl9ERUJVR19EUklWRVIoaTkxNS0+ZHJtLmRldiwKKwkJCSAgICAg
IkNhbGN1bGF0ZWQgR3VDIFdPUENNIFJlZ2lvbjogWyV1S2lCLCAldUtpQilcbiIsCisJCQkgICAg
IGd1Y193b3BjbV9iYXNlIC8gU1pfMUssIGd1Y193b3BjbV9zaXplIC8gU1pfMUspOwogCi0JZ3Vj
X3dvcGNtX3JzdmQgPSBHVUNfV09QQ01fUkVTRVJWRUQgKyBHVUNfV09QQ01fU1RBQ0tfUkVTRVJW
RUQ7Ci0JaWYgKChndWNfZndfc2l6ZSArIGd1Y193b3BjbV9yc3ZkKSA+IGd1Y193b3BjbV9zaXpl
KSB7Ci0JCURSTV9FUlJPUigiTmVlZCAldUtpQiBXT1BDTSBmb3IgR3VDLCAldUtpQiBhdmFpbGFi
bGUuXG4iLAotCQkJICAoZ3VjX2Z3X3NpemUgKyBndWNfd29wY21fcnN2ZCkgLyAxMDI0LAotCQkJ
ICBndWNfd29wY21fc2l6ZSAvIDEwMjQpOwotCQlyZXR1cm47CisJaWYgKF9fY2hlY2tfbGF5b3V0
KGk5MTUsIHdvcGNtLT5zaXplLCBndWNfd29wY21fYmFzZSwgZ3VjX3dvcGNtX3NpemUsCisJCQkg
ICBndWNfZndfc2l6ZSwgaHVjX2Z3X3NpemUpKSB7CisJCXdvcGNtLT5ndWMuYmFzZSA9IGd1Y193
b3BjbV9iYXNlOworCQl3b3BjbS0+Z3VjLnNpemUgPSBndWNfd29wY21fc2l6ZTsKKwkJR0VNX0JV
R19PTighd29wY20tPmd1Yy5iYXNlKTsKKwkJR0VNX0JVR19PTighd29wY20tPmd1Yy5zaXplKTsK
IAl9Ci0KLQllcnIgPSBjaGVja19od19yZXN0cmljdGlvbihpOTE1LCBndWNfd29wY21fYmFzZSwg
Z3VjX3dvcGNtX3NpemUsCi0JCQkJICAgaHVjX2Z3X3NpemUpOwotCWlmIChlcnIpCi0JCXJldHVy
bjsKLQotCXdvcGNtLT5ndWMuYmFzZSA9IGd1Y193b3BjbV9iYXNlOwotCXdvcGNtLT5ndWMuc2l6
ZSA9IGd1Y193b3BjbV9zaXplOwotCUdFTV9CVUdfT04oIXdvcGNtLT5ndWMuYmFzZSk7Ci0JR0VN
X0JVR19PTighd29wY20tPmd1Yy5zaXplKTsKIH0KLS0gCjIuMTkuMgoKX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJ
bnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Au
b3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

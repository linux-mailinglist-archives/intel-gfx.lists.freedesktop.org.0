Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 2DC17DC1C6
	for <lists+intel-gfx@lfdr.de>; Fri, 18 Oct 2019 11:51:02 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 881276EB0B;
	Fri, 18 Oct 2019 09:51:00 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga09.intel.com (mga09.intel.com [134.134.136.24])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 05CAD6EB0B
 for <intel-gfx@lists.freedesktop.org>; Fri, 18 Oct 2019 09:50:58 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga007.jf.intel.com ([10.7.209.58])
 by orsmga102.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 18 Oct 2019 02:50:58 -0700
X-IronPort-AV: E=Sophos;i="5.67,311,1566889200"; d="scan'208";a="186777464"
Received: from dwiesing-mobl.ger.corp.intel.com (HELO [10.252.31.172])
 ([10.252.31.172])
 by orsmga007-auth.jf.intel.com with ESMTP/TLS/AES256-SHA;
 18 Oct 2019 02:50:57 -0700
To: Chris Wilson <chris@chris-wilson.co.uk>, intel-gfx@lists.freedesktop.org
References: <20191016195251.17863-1-chris@chris-wilson.co.uk>
 <20191017095206.3954-1-chris@chris-wilson.co.uk>
From: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>
Organization: Intel Corporation UK Plc
Message-ID: <a179fdd3-96c9-57cf-322d-74b997686a86@linux.intel.com>
Date: Fri, 18 Oct 2019 10:50:55 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <20191017095206.3954-1-chris@chris-wilson.co.uk>
Content-Language: en-US
Subject: Re: [Intel-gfx] [PATCH] drm/i915/execlists: Don't merely skip
 submission if maybe timeslicing
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Ck9uIDE3LzEwLzIwMTkgMTA6NTIsIENocmlzIFdpbHNvbiB3cm90ZToKPiBOb3JtYWxseSwgd2Ug
dHJ5IGFuZCBza2lwIHN1Ym1pc3Npb24gaWYgRUxTUFsxXSBpcyBmaWxsZWQuIEhvd2V2ZXIsIHdl
Cj4gbWF5IGRlc2lyZSB0byBlbmFibGUgdGltZXNsaWNpbmcgZHVlIHRvIHRoZSBxdWV1ZSBwcmlv
cml0eSwgZXZlbiBpZgo+IEVMU1BbMV0gaXRzZWxmIGRvZXMgbm90IHJlcXVpcmUgdGltZXNsaWNp
bmcuIFRoYXQgaXMgdGhlIHF1ZXVlIGlzIGVxdWFsCj4gcHJpb3JpdHkgdG8gRUxTUFswXSBhbmQg
aGlnaGVyIHByaW9yaXR5IHRoZW4gRUxTUFsxXS4gUHJldmlvdXNseSwgd2UKPiB3b3VsZCB3YWl0
IHVudGlsIHRoZSBjb250ZXh0IHN3aXRjaCB0byBwcmVlbXB0IHRoZSBjdXJyZW50IEVMU1BbMV0s
IGJ1dAo+IHdpdGggdGltZXNsaWNpbmcsIHdlIHdhbnQgdG8gcHJlZW1wdCBFTFNQWzBdIGFuZCBy
ZXBsYWNlIGl0IHdpdGggdGhlCj4gcXVldWUuCgpXaHkgd2Ugd2FudCB0byBwcmVlbXB0IEVMU1Bb
MF0gaWYgdGhlIHN0YXRlbWVudCBpcyBxdWV1ZSBpcyBub3QgaGlnaGVyIApwcmlvcml0eSBmcm9t
IGl0PwoKPiAKPiBJbiB3cml0aW5nIHRoZSB0ZXN0IGNhc2UsIGl0IGJlY29tZSBxdWlja2x5IGFw
cGFyZW50IHRoYXQgd2Ugd2VyZSBhbHNvCj4gc3VwcHJlc3NpbmcgdGhlIHRhc2tsZXQgZHVyaW5n
IHByb21vdGlvbiBhbmQgc28gZmFpbGluZyB0byBub3RpY2Ugd2hlbgo+IHRoZSBxdWV1ZSBzdGFy
dGVkIHJlcXVpcmluZyB0aW1lc2xpY2luZy4KPiAKPiBGaXhlczogMjIyOWFkYzgxMzgwICgiZHJt
L2k5MTUvZXhlY2xpc3Q6IFRyaW0gaW1tZWRpYXRlIHRpbWVzbGljZSBleHBpcnkiKQo+IFNpZ25l
ZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgo+IENjOiBU
dnJ0a28gVXJzdWxpbiA8dHZydGtvLnVyc3VsaW5AaW50ZWwuY29tPgo+IC0tLQo+IEtpY2sgZXhl
Y2xpc3RzX3N1Ym1pc3Npb25fdGFza2xldCBoYXJkZXIuCj4gLS0tCj4gICBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9scmMuYyAgICB8ICAyMiArKystCj4gICBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF9scmMuYyB8IDE2NCArKysrKysrKysrKysrKysrKysrKysrKystCj4g
ICBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5jICB8ICAxNyArKy0KPiAgIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmggIHwgIDE4IC0tLQo+ICAgNCBmaWxl
cyBjaGFuZ2VkLCAxOTIgaW5zZXJ0aW9ucygrKSwgMjkgZGVsZXRpb25zKC0pCj4gCj4gZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKPiBpbmRleCBlOWZlOWY3OWNlZGQuLmQwMDg4ZDAyMDIy
MCAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYwo+ICsr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCj4gQEAgLTM1MiwxMCArMzUy
LDE1IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBuZWVkX3ByZWVtcHQoY29uc3Qgc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lLAo+ICAgCSAqIEhvd2V2ZXIsIHRoZSBwcmlvcml0eSBoaW50IGlz
IGEgbWVyZSBoaW50IHRoYXQgd2UgbWF5IG5lZWQgdG8KPiAgIAkgKiBwcmVlbXB0LiBJZiB0aGF0
IGhpbnQgaXMgc3RhbGUgb3Igd2UgbWF5IGJlIHRyeWluZyB0byBwcmVlbXB0Cj4gICAJICogb3Vy
c2VsdmVzLCBpZ25vcmUgdGhlIHJlcXVlc3QuCj4gKwkgKgo+ICsJICogTW9yZSBuYXR1cmFsbHkg
d2Ugd291bGQgd3JpdGUKPiArCSAqICAgICAgcHJpbyA+PSBtYXgoMCwgbGFzdCk7Cj4gKwkgKiBl
eGNlcHQgdGhhdCB3ZSB3aXNoIHRvIHByZXZlbnQgdHJpZ2dlcmluZyBwcmVlbXB0aW9uIGF0IHRo
ZSBzYW1lCj4gKwkgKiBwcmlvcml0eSBsZXZlbDogdGhlIHRhc2sgdGhhdCBpcyBydW5uaW5nIHNo
b3VsZCByZW1haW4gcnVubmluZwo+ICsJICogdG8gcHJlc2VydmUgRklGTyBvcmRlcmluZyBvZiBk
ZXBlbmRlbmNpZXMuCj4gICAJICovCj4gLQlsYXN0X3ByaW8gPSBlZmZlY3RpdmVfcHJpbyhycSk7
Cj4gLQlpZiAoIWk5MTVfc2NoZWR1bGVyX25lZWRfcHJlZW1wdChlbmdpbmUtPmV4ZWNsaXN0cy5x
dWV1ZV9wcmlvcml0eV9oaW50LAo+IC0JCQkJCSBsYXN0X3ByaW8pKQo+ICsJbGFzdF9wcmlvID0g
bWF4KGVmZmVjdGl2ZV9wcmlvKHJxKSwgSTkxNV9QUklPUklUWV9OT1JNQUwgLSAxKTsKPiArCWlm
IChlbmdpbmUtPmV4ZWNsaXN0cy5xdWV1ZV9wcmlvcml0eV9oaW50IDw9IGxhc3RfcHJpbykKCk9r
YXkgdGhpcyBldmVudHVhbGx5IHJlc29sdmVzIHRvIHRoZSBleGFjdCBzYW1lIGNvbmRpdGlvbiBh
cyBiZWZvcmUgc28gCml0IHNlZW1zIHRvIG9ubHkgYmUgY2h1cm4gYXMgY29uc2VxdWVuY2Ugb2Yg
cmVtb3ZpbmcgCmk5MTVfc2NoZWR1bGVyX25lZWRfcHJlZW1wdC4gVGhlbiBsZXRzIHNlZS4uCgo+
ICAgCQlyZXR1cm4gZmFsc2U7Cj4gICAKPiAgIAkvKgo+IEBAIC0xNTA5LDggKzE1MTQsMTcgQEAg
c3RhdGljIHZvaWQgZXhlY2xpc3RzX2RlcXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lKQo+ICAgCQkJICogc3VibWlzc2lvbi4KPiAgIAkJCSAqLwo+ICAgCQkJaWYgKCFsaXN0X2lz
X2xhc3QoJmxhc3QtPnNjaGVkLmxpbmssCj4gLQkJCQkJICAmZW5naW5lLT5hY3RpdmUucmVxdWVz
dHMpKQo+ICsJCQkJCSAgJmVuZ2luZS0+YWN0aXZlLnJlcXVlc3RzKSkgewo+ICsJCQkJLyoKPiAr
CQkJCSAqIEV2ZW4gaWYgRUxTUFsxXSBpcyBvY2N1cGllZCBhbmQgbm90IHdvcnRoeQo+ICsJCQkJ
ICogb2YgdGltZXNsaWNlcywgb3VyIHF1ZXVlIG1pZ2h0IGJlLgo+ICsJCQkJICovCj4gKwkJCQlp
ZiAoIWV4ZWNsaXN0cy0+dGltZXIuZXhwaXJlcyAmJgo+ICsJCQkJICAgIG5lZWRfdGltZXNsaWNl
KGVuZ2luZSwgbGFzdCkpCj4gKwkJCQkJbW9kX3RpbWVyKCZleGVjbGlzdHMtPnRpbWVyLAo+ICsJ
CQkJCQkgIGppZmZpZXMgKyAxKTsKPiAgIAkJCQlyZXR1cm47Cj4gKwkJCX0KPiAgIAo+ICAgCQkJ
LyoKPiAgIAkJCSAqIFdhSWRsZUxpdGVSZXN0b3JlOmJkdyxza2wKPiBkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF9scmMuYwo+IGluZGV4IDI4NjgzNzFjNjA5ZS4uNWJjZmU0YTI0NjZmIDEw
MDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCj4gKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKPiBAQCAtMzI1LDcgKzMy
NSwxMyBAQCBzZW1hcGhvcmVfcXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBz
dHJ1Y3QgaTkxNV92bWEgKnZtYSwgaW50IGlkeCkKPiAgIAlpZiAoSVNfRVJSKHJxKSkKPiAgIAkJ
Z290byBvdXRfY3R4Owo+ICAgCj4gLQllcnIgPSBlbWl0X3NlbWFwaG9yZV9jaGFpbihycSwgdm1h
LCBpZHgpOwo+ICsJZXJyID0gMDsKPiArCWlmIChycS0+ZW5naW5lLT5lbWl0X2luaXRfYnJlYWRj
cnVtYikKPiArCQllcnIgPSBycS0+ZW5naW5lLT5lbWl0X2luaXRfYnJlYWRjcnVtYihycSk7Cj4g
KwlpZiAoZXJyID09IDApCj4gKwkJZXJyID0gZW1pdF9zZW1hcGhvcmVfY2hhaW4ocnEsIHZtYSwg
aWR4KTsKPiArCWlmIChlcnIgPT0gMCkKPiArCQlpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKPiAgIAlp
OTE1X3JlcXVlc3RfYWRkKHJxKTsKPiAgIAlpZiAoZXJyKQo+ICAgCQlycSA9IEVSUl9QVFIoZXJy
KTsKPiBAQCAtMzM4LDEwICszNDQsMTAgQEAgc2VtYXBob3JlX3F1ZXVlKHN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZSwgc3RydWN0IGk5MTVfdm1hICp2bWEsIGludCBpZHgpCj4gICBzdGF0
aWMgaW50Cj4gICByZWxlYXNlX3F1ZXVlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwK
PiAgIAkgICAgICBzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKPiAtCSAgICAgIGludCBpZHgpCj4gKwkg
ICAgICBpbnQgaWR4LCBpbnQgcHJpbykKPiAgIHsKPiAgIAlzdHJ1Y3QgaTkxNV9zY2hlZF9hdHRy
IGF0dHIgPSB7Cj4gLQkJLnByaW9yaXR5ID0gSTkxNV9VU0VSX1BSSU9SSVRZKEk5MTVfUFJJT1JJ
VFlfTUFYKSwKPiArCQkucHJpb3JpdHkgPSBwcmlvLAo+ICAgCX07Cj4gICAJc3RydWN0IGk5MTVf
cmVxdWVzdCAqcnE7Cj4gICAJdTMyICpjczsKPiBAQCAtMzYyLDkgKzM2OCwxNSBAQCByZWxlYXNl
X3F1ZXVlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKPiAgIAkqY3MrKyA9IDE7Cj4g
ICAKPiAgIAlpbnRlbF9yaW5nX2FkdmFuY2UocnEsIGNzKTsKPiArCj4gKwlpOTE1X3JlcXVlc3Rf
Z2V0KHJxKTsKPiAgIAlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKPiAgIAo+ICsJbG9jYWxfYmhfZGlz
YWJsZSgpOwo+ICAgCWVuZ2luZS0+c2NoZWR1bGUocnEsICZhdHRyKTsKPiArCWxvY2FsX2JoX2Vu
YWJsZSgpOyAvKiBraWNrIHRhc2tsZXQgKi8KPiArCj4gKwlpOTE1X3JlcXVlc3RfcHV0KHJxKTsK
PiAgIAo+ICAgCXJldHVybiAwOwo+ICAgfQo+IEBAIC0zODMsNyArMzk1LDYgQEAgc2xpY2Vfc2Vt
YXBob3JlX3F1ZXVlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKm91dGVyLAo+ICAgCWlmIChJU19F
UlIoaGVhZCkpCj4gICAJCXJldHVybiBQVFJfRVJSKGhlYWQpOwo+ICAgCj4gLQlpOTE1X3JlcXVl
c3RfZ2V0KGhlYWQpOwo+ICAgCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIG91dGVyLT5pOTE1LCBp
ZCkgewo+ICAgCQlmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewo+ICAgCQkJc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnE7Cj4gQEAgLTM5MywxMCArNDA0LDEyIEBAIHNsaWNlX3NlbWFwaG9yZV9x
dWV1ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpvdXRlciwKPiAgIAkJCQllcnIgPSBQVFJfRVJS
KHJxKTsKPiAgIAkJCQlnb3RvIG91dDsKPiAgIAkJCX0KPiArCj4gKwkJCWk5MTVfcmVxdWVzdF9w
dXQocnEpOwo+ICAgCQl9Cj4gICAJfQo+ICAgCj4gLQllcnIgPSByZWxlYXNlX3F1ZXVlKG91dGVy
LCB2bWEsIG4pOwo+ICsJZXJyID0gcmVsZWFzZV9xdWV1ZShvdXRlciwgdm1hLCBuLCBJTlRfTUFY
KTsKPiAgIAlpZiAoZXJyKQo+ICAgCQlnb3RvIG91dDsKPiAgIAo+IEBAIC00ODIsNiArNDk1LDE0
NiBAQCBzdGF0aWMgaW50IGxpdmVfdGltZXNsaWNlX3ByZWVtcHQodm9pZCAqYXJnKQo+ICAgCXJl
dHVybiBlcnI7Cj4gICB9Cj4gICAKPiArc3RhdGljIGludCBub3BfcmVxdWVzdChzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUpCj4gK3sKPiArCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwo+
ICsKPiArCXJxID0gaTkxNV9yZXF1ZXN0X2NyZWF0ZShlbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsK
PiArCWlmIChJU19FUlIocnEpKQo+ICsJCXJldHVybiBQVFJfRVJSKHJxKTsKPiArCj4gKwlpOTE1
X3JlcXVlc3RfYWRkKHJxKTsKPiArCXJldHVybiAwOwo+ICt9Cj4gKwo+ICtzdGF0aWMgdm9pZCB3
YWl0X2Zvcl9zdWJtaXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQo+ICt7Cj4gKwlk
byB7Cj4gKwkJY29uZF9yZXNjaGVkKCk7Cj4gKwkJaW50ZWxfZW5naW5lX2ZsdXNoX3N1Ym1pc3Np
b24oZW5naW5lKTsKPiArCX0gd2hpbGUgKFJFQURfT05DRShlbmdpbmUtPmV4ZWNsaXN0cy5wZW5k
aW5nWzBdKSk7Cj4gK30KPiArCj4gK3N0YXRpYyBpbnQgbGl2ZV90aW1lc2xpY2VfcXVldWUodm9p
ZCAqYXJnKQo+ICt7Cj4gKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwo+ICsJc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iajsKPiArCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZTsKPiArCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwo+ICsJc3RydWN0IGk5MTVfdm1hICp2bWE7
Cj4gKwl2b2lkICp2YWRkcjsKPiArCWludCBlcnIgPSAwOwo+ICsKPiArCS8qCj4gKwkgKiBNYWtl
IHN1cmUgdGhhdCBldmVuIGlmIEVMU1BbMF0gYW5kIEVMU1BbMV0gYXJlIGZpbGxlZCB3aXRoCj4g
KwkgKiB0aW1lc2xpY2luZyBiZXR3ZWVuIHRoZW0gZGlzYWJsZWQsIHdlICpkbyogZW5hYmxlIHRp
bWVzbGljaW5nCj4gKwkgKiBpZiB0aGUgcXVldWUgZGVtYW5kcyBpdC4gKE5vcm1hbGx5LCB3ZSBk
byBub3Qgc3VibWl0IGlmCj4gKwkgKiBFTFNQWzFdIGlzIGFscmVhZHkgb2NjdXBpZWQsIHNvIG11
c3QgcmVseSBvbiB0aW1lc2xpY2luZyB0bwo+ICsJICogZWplY3QgRUxTUFswXSBpbiBmYXZvdXIg
b2YgdGhlIHF1ZXVlLikKPiArCSAqLwo+ICsKPiArCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVh
dGVfaW50ZXJuYWwoZ3QtPmk5MTUsIFBBR0VfU0laRSk7Cj4gKwlpZiAoSVNfRVJSKG9iaikpCj4g
KwkJcmV0dXJuIFBUUl9FUlIob2JqKTsKPiArCj4gKwl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShv
YmosICZndC0+Z2d0dC0+dm0sIE5VTEwpOwo+ICsJaWYgKElTX0VSUih2bWEpKSB7Cj4gKwkJZXJy
ID0gUFRSX0VSUih2bWEpOwo+ICsJCWdvdG8gZXJyX29iajsKPiArCX0KPiArCj4gKwl2YWRkciA9
IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKG9iaiwgSTkxNV9NQVBfV0MpOwo+ICsJaWYgKElTX0VS
Uih2YWRkcikpIHsKPiArCQllcnIgPSBQVFJfRVJSKHZhZGRyKTsKPiArCQlnb3RvIGVycl9vYmo7
Cj4gKwl9Cj4gKwo+ICsJZXJyID0gaTkxNV92bWFfcGluKHZtYSwgMCwgMCwgUElOX0dMT0JBTCk7
Cj4gKwlpZiAoZXJyKQo+ICsJCWdvdG8gZXJyX21hcDsKPiArCj4gKwlmb3JfZWFjaF9lbmdpbmUo
ZW5naW5lLCBndC0+aTkxNSwgaWQpIHsKCk1ha2UgaXQgZ3Qgbm93LgoKPiArCQlzdHJ1Y3QgaTkx
NV9zY2hlZF9hdHRyIGF0dHIgPSB7Cj4gKwkJCS5wcmlvcml0eSA9IEk5MTVfVVNFUl9QUklPUklU
WShJOTE1X1BSSU9SSVRZX01BWCksCj4gKwkJfTsKPiArCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
cTsKPiArCj4gKwkJaWYgKCFpbnRlbF9lbmdpbmVfaGFzX3ByZWVtcHRpb24oZW5naW5lKSkKPiAr
CQkJY29udGludWU7Cj4gKwo+ICsJCW1lbXNldCh2YWRkciwgMCwgUEFHRV9TSVpFKTsKPiArCj4g
KwkJLyogRUxTUFswXTogc2VtYXBob3JlIHdhaXQgKi8KPiArCQlycSA9IHNlbWFwaG9yZV9xdWV1
ZShlbmdpbmUsIHZtYSwgMCk7Cj4gKwkJaWYgKElTX0VSUihycSkpIHsKPiArCQkJZXJyID0gUFRS
X0VSUihycSk7Cj4gKwkJCWdvdG8gZXJyX3BpbjsKPiArCQl9Cj4gKwkJZW5naW5lLT5zY2hlZHVs
ZShycSwgJmF0dHIpOwo+ICsJCXdhaXRfZm9yX3N1Ym1pdChlbmdpbmUpOwo+ICsKPiArCQkvKiBF
TFNQWzFdOiBub3AgcmVxdWVzdCAqLwo+ICsJCWVyciA9IG5vcF9yZXF1ZXN0KGVuZ2luZSk7Cj4g
KwkJaWYgKGVycikgewo+ICsJCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKPiArCQkJZ290byBlcnJf
cGluOwo+ICsJCX0KPiArCQl3YWl0X2Zvcl9zdWJtaXQoZW5naW5lKTsKPiArCj4gKwkJR0VNX0JV
R19PTihpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJxKSk7Cj4gKwkJR0VNX0JVR19PTihleGVjbGlz
dHNfYWN0aXZlKCZlbmdpbmUtPmV4ZWNsaXN0cykgIT0gcnEpOwo+ICsKPiArCQkvKiBRdWV1ZTog
c2VtYXBob3JlIHNpZ25hbCwgbWF0Y2hpbmcgcHJpb3JpdHkgYXMgc2VtYXBob3JlICovCj4gKwkJ
ZXJyID0gcmVsZWFzZV9xdWV1ZShlbmdpbmUsIHZtYSwgMSwgZWZmZWN0aXZlX3ByaW8ocnEpKTsK
PiArCQlpZiAoZXJyKSB7Cj4gKwkJCWk5MTVfcmVxdWVzdF9wdXQocnEpOwo+ICsJCQlnb3RvIGVy
cl9waW47Cj4gKwkJfQo+ICsKPiArCQlpbnRlbF9lbmdpbmVfZmx1c2hfc3VibWlzc2lvbihlbmdp
bmUpOwo+ICsJCWlmICghUkVBRF9PTkNFKGVuZ2luZS0+ZXhlY2xpc3RzLnRpbWVyLmV4cGlyZXMp
ICYmCj4gKwkJICAgICFpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJxKSkgewo+ICsJCQlzdHJ1Y3Qg
ZHJtX3ByaW50ZXIgcCA9Cj4gKwkJCQlkcm1faW5mb19wcmludGVyKGd0LT5pOTE1LT5kcm0uZGV2
KTsKPiArCj4gKwkJCUdFTV9UUkFDRV9FUlIoIiVzOiBGYWlsZWQgdG8gZW5hYmxlIHRpbWVzbGlj
aW5nIVxuIiwKPiArCQkJCSAgICAgIGVuZ2luZS0+bmFtZSk7Cj4gKwkJCWludGVsX2VuZ2luZV9k
dW1wKGVuZ2luZSwgJnAsCj4gKwkJCQkJICAiJXNcbiIsIGVuZ2luZS0+bmFtZSk7Cj4gKwkJCUdF
TV9UUkFDRV9EVU1QKCk7Cj4gKwo+ICsJCQltZW1zZXQodmFkZHIsIDB4ZmYsIFBBR0VfU0laRSk7
Cj4gKwkJCWVyciA9IC1FSU5WQUw7Cj4gKwkJfQo+ICsKPiArCQkvKiBUaW1lc2xpY2UgZXZlcnkg
amlmZmllLCBzbyB3aXRoaW4gMiB3ZSBzaG91bGQgc2lnbmFsICovCj4gKwkJaWYgKGk5MTVfcmVx
dWVzdF93YWl0KHJxLCAwLCAzKSA8IDApIHsKPiArCQkJc3RydWN0IGRybV9wcmludGVyIHAgPQo+
ICsJCQkJZHJtX2luZm9fcHJpbnRlcihndC0+aTkxNS0+ZHJtLmRldik7Cj4gKwo+ICsJCQlwcl9l
cnIoIiVzOiBGYWlsZWQgdG8gdGltZXNsaWNlIGludG8gcXVldWVcbiIsCj4gKwkJCSAgICAgICBl
bmdpbmUtPm5hbWUpOwo+ICsJCQlpbnRlbF9lbmdpbmVfZHVtcChlbmdpbmUsICZwLAo+ICsJCQkJ
CSAgIiVzXG4iLCBlbmdpbmUtPm5hbWUpOwo+ICsKPiArCQkJbWVtc2V0KHZhZGRyLCAweGZmLCBQ
QUdFX1NJWkUpOwo+ICsJCQllcnIgPSAtRUlPOwo+ICsJCX0KPiArCQlpOTE1X3JlcXVlc3RfcHV0
KHJxKTsKPiArCQlpZiAoZXJyKQo+ICsJCQlicmVhazsKPiArCX0KPiArCj4gKwo+ICtlcnJfcGlu
Ogo+ICsJaTkxNV92bWFfdW5waW4odm1hKTsKPiArZXJyX21hcDoKPiArCWk5MTVfZ2VtX29iamVj
dF91bnBpbl9tYXAob2JqKTsKPiArZXJyX29iajoKPiArCWk5MTVfZ2VtX29iamVjdF9wdXQob2Jq
KTsKPiArCXJldHVybiBlcnI7Cj4gK30KPiArCj4gICBzdGF0aWMgaW50IGxpdmVfYnVzeXdhaXRf
cHJlZW1wdCh2b2lkICphcmcpCj4gICB7Cj4gICAJc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsK
PiBAQCAtMjQzNyw2ICsyNTkwLDcgQEAgaW50IGludGVsX2V4ZWNsaXN0c19saXZlX3NlbGZ0ZXN0
cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKPiAgIAkJU1VCVEVTVChsaXZlX3VubGl0
ZV9zd2l0Y2gpLAo+ICAgCQlTVUJURVNUKGxpdmVfdW5saXRlX3ByZWVtcHQpLAo+ICAgCQlTVUJU
RVNUKGxpdmVfdGltZXNsaWNlX3ByZWVtcHQpLAo+ICsJCVNVQlRFU1QobGl2ZV90aW1lc2xpY2Vf
cXVldWUpLAo+ICAgCQlTVUJURVNUKGxpdmVfYnVzeXdhaXRfcHJlZW1wdCksCj4gICAJCVNVQlRF
U1QobGl2ZV9wcmVlbXB0KSwKPiAgIAkJU1VCVEVTVChsaXZlX2xhdGVfcHJlZW1wdCksCj4gZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5jCj4gaW5kZXggN2I4NGViY2EyOTAxLi4wY2E0
MGY2YmYwOGMgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVs
ZXIuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmMKPiBAQCAt
MTc3LDkgKzE3NywyMiBAQCBzdGF0aWMgaW5saW5lIGludCBycV9wcmlvKGNvbnN0IHN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxKQo+ICAgCXJldHVybiBycS0+c2NoZWQuYXR0ci5wcmlvcml0eSB8IF9f
Tk9fUFJFRU1QVElPTjsKPiAgIH0KPiAgIAo+ICtzdGF0aWMgaW5saW5lIGJvb2wgbmVlZF9wcmVl
bXB0KGludCBwcmlvLCBpbnQgYWN0aXZlKQo+ICt7Cj4gKwkvKgo+ICsJICogQWxsb3cgcHJlZW1w
dGlvbiBvZiBsb3cgLT4gbm9ybWFsIC0+IGhpZ2gsIGJ1dCB3ZSBkbwo+ICsJICogbm90IGFsbG93
IGxvdyBwcmlvcml0eSB0YXNrcyB0byBwcmVlbXB0IG90aGVyIGxvdyBwcmlvcml0eQo+ICsJICog
dGFza3MgdW5kZXIgdGhlIGltcHJlc3Npb24gdGhhdCBsYXRlbmN5IGZvciBsb3cgcHJpb3JpdHkK
PiArCSAqIHRhc2tzIGRvZXMgbm90IG1hdHRlciAoYXMgbXVjaCBhcyBiYWNrZ3JvdW5kIHRocm91
Z2hwdXQpLAo+ICsJICogc28ga2lzcy4KPiArCSAqLwo+ICsJcmV0dXJuIHByaW8gPj0gbWF4KEk5
MTVfUFJJT1JJVFlfTk9STUFMLCBhY3RpdmUpOwoKSXMgdGhpcyB0aGUgc2FtZSBhcyB0aGUgY3Vy
cmVudDoKCiAgIHJldHVybiBwcmlvID4gbWF4KEk5MTVfUFJJT1JJVFlfTk9STUFMIC0gMSwgYWN0
aXZlKTsKCkhtIG5vLCBpdCBub3cgYWxsb3dzIGZvciBoaWdoIHByaW8gdGFza3MgdG8gcHJlZW1w
dCBlcXVhbCBoaWdoIHByaW8uCgpTbyBpdCB3aWxsIGtpY2sgdGhlIHRhc2tsZXQgYW5kIGRlcXVl
dWUgd2lsbCB0aGVuIGRlY2lkZSBubyB0byAKbmVlZF9wcmVlbXB0IGFmdGVyIGFsbC4gV2hlcmUg
aXQgaXMgdGhlIGNhdGNoPyBPa2F5IGNhdGNoIGlzIGluIHRoZSAKb3RoZXIgZXhlY2xpc3RfZGVx
dWV1ZSBodW5rIC0gdGhhdCBpdCB3aWxsIG5vdyBlbmFibGUgdGhlIHRpbWVzbGljZSB0aW1lci4K
CkkgaGF2ZSB0byBzYXkgaXQgaXMgZ2V0dGluZyB2ZXJ5IGRpZmZpY3VsdCB0byB0aWUgZXZlcnl0
aGluZyB0b2dldGhlci4gSSAKd2lzaCBmb3IgYSBzaW1wbGVyIGRlc2lnbiB3aXRoIG1vcmUgY2Vu
dHJhbGl6ZWQgIm1hZ2ljIiBvbiBoYWRsaW5nIApwcmlvcml0aWVzIGV0Yy4KCj4gK30KPiArCj4g
ICBzdGF0aWMgdm9pZCBraWNrX3N1Ym1pc3Npb24oc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lLCBpbnQgcHJpbykKPiAgIHsKPiAtCWNvbnN0IHN0cnVjdCBpOTE1X3JlcXVlc3QgKmluZmxp
Z2h0ID0gKmVuZ2luZS0+ZXhlY2xpc3RzLmFjdGl2ZTsKPiArCWNvbnN0IHN0cnVjdCBpOTE1X3Jl
cXVlc3QgKmluZmxpZ2h0ID0KPiArCQlleGVjbGlzdHNfYWN0aXZlKCZlbmdpbmUtPmV4ZWNsaXN0
cyk7Cj4gICAKPiAgIAkvKgo+ICAgCSAqIElmIHdlIGFyZSBhbHJlYWR5IHRoZSBjdXJyZW50bHkg
ZXhlY3V0aW5nIGNvbnRleHQsIGRvbid0Cj4gQEAgLTE4OCw3ICsyMDEsNyBAQCBzdGF0aWMgdm9p
ZCBraWNrX3N1Ym1pc3Npb24oc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBpbnQgcHJp
bykKPiAgIAkgKiB0YXNrbGV0LCBpLmUuIHdlIGhhdmUgbm90IGNoYW5nZSB0aGUgcHJpb3JpdHkg
cXVldWUKPiAgIAkgKiBzdWZmaWNpZW50bHkgdG8gb3VzdCB0aGUgcnVubmluZyBjb250ZXh0Lgo+
ICAgCSAqLwo+IC0JaWYgKCFpbmZsaWdodCB8fCAhaTkxNV9zY2hlZHVsZXJfbmVlZF9wcmVlbXB0
KHByaW8sIHJxX3ByaW8oaW5mbGlnaHQpKSkKPiArCWlmICghaW5mbGlnaHQgfHwgIW5lZWRfcHJl
ZW1wdChwcmlvLCBycV9wcmlvKGluZmxpZ2h0KSkpCj4gICAJCXJldHVybjsKPiAgIAo+ICAgCXRh
c2tsZXRfaGlfc2NoZWR1bGUoJmVuZ2luZS0+ZXhlY2xpc3RzLnRhc2tsZXQpOwo+IGRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5oIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIuaAo+IGluZGV4IDdlZWZjY2ZmMzliZi4uMDdkMjQzYWNm
NTUzIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmgK
PiArKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5oCj4gQEAgLTUyLDIy
ICs1Miw0IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBpOTE1X3ByaW9saXN0X2ZyZWUoc3RydWN0IGk5
MTVfcHJpb2xpc3QgKnApCj4gICAJCV9faTkxNV9wcmlvbGlzdF9mcmVlKHApOwo+ICAgfQo+ICAg
Cj4gLXN0YXRpYyBpbmxpbmUgYm9vbCBpOTE1X3NjaGVkdWxlcl9uZWVkX3ByZWVtcHQoaW50IHBy
aW8sIGludCBhY3RpdmUpCj4gLXsKPiAtCS8qCj4gLQkgKiBBbGxvdyBwcmVlbXB0aW9uIG9mIGxv
dyAtPiBub3JtYWwgLT4gaGlnaCwgYnV0IHdlIGRvCj4gLQkgKiBub3QgYWxsb3cgbG93IHByaW9y
aXR5IHRhc2tzIHRvIHByZWVtcHQgb3RoZXIgbG93IHByaW9yaXR5Cj4gLQkgKiB0YXNrcyB1bmRl
ciB0aGUgaW1wcmVzc2lvbiB0aGF0IGxhdGVuY3kgZm9yIGxvdyBwcmlvcml0eQo+IC0JICogdGFz
a3MgZG9lcyBub3QgbWF0dGVyIChhcyBtdWNoIGFzIGJhY2tncm91bmQgdGhyb3VnaHB1dCksCj4g
LQkgKiBzbyBraXNzLgo+IC0JICoKPiAtCSAqIE1vcmUgbmF0dXJhbGx5IHdlIHdvdWxkIHdyaXRl
Cj4gLQkgKglwcmlvID49IG1heCgwLCBsYXN0KTsKPiAtCSAqIGV4Y2VwdCB0aGF0IHdlIHdpc2gg
dG8gcHJldmVudCB0cmlnZ2VyaW5nIHByZWVtcHRpb24gYXQgdGhlIHNhbWUKPiAtCSAqIHByaW9y
aXR5IGxldmVsOiB0aGUgdGFzayB0aGF0IGlzIHJ1bm5pbmcgc2hvdWxkIHJlbWFpbiBydW5uaW5n
Cj4gLQkgKiB0byBwcmVzZXJ2ZSBGSUZPIG9yZGVyaW5nIG9mIGRlcGVuZGVuY2llcy4KPiAtCSAq
Lwo+IC0JcmV0dXJuIHByaW8gPiBtYXgoSTkxNV9QUklPUklUWV9OT1JNQUwgLSAxLCBhY3RpdmUp
Owo+IC19Cj4gLQo+ICAgI2VuZGlmIC8qIF9JOTE1X1NDSEVEVUxFUl9IXyAqLwo+IAoKUmV2aWV3
ZWQtYnk6IFR2cnRrbyBVcnN1bGluIDx0dnJ0a28udXJzdWxpbkBpbnRlbC5jb20+CgpSZWdhcmRz
LAoKVHZydGtvCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
CkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpo
dHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id CB9F0F28D5
	for <lists+intel-gfx@lfdr.de>; Thu,  7 Nov 2019 09:13:19 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5927A6EECB;
	Thu,  7 Nov 2019 08:13:10 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 95F046EEC8
 for <intel-gfx@lists.freedesktop.org>; Thu,  7 Nov 2019 08:13:07 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19110672-1500050 
 for multiple; Thu, 07 Nov 2019 08:12:56 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  7 Nov 2019 08:12:39 +0000
Message-Id: <20191107081252.10542-15-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191107081252.10542-1-chris@chris-wilson.co.uk>
References: <20191107081252.10542-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 15/28] drm/i915: Remove i915->kernel_context
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWxsb2NhdGUgb25seSBhbiBpbnRlcm5hbCBpbnRlbF9jb250ZXh0IGZvciB0aGUga2VybmVsX2Nv
bnRleHQsIGZvcmdvaW5nCmEgZ2xvYmFsIEdFTSBjb250ZXh0IGZvciBpbnRlcm5hbCB1c2UgYXMg
d2Ugb25seSByZXF1aXJlIGEgc2VwYXJhdGUKYWRkcmVzcyBzcGFjZSAoZm9yIG91ciBvd24gcHJv
dGVjdGlvbikuCgpOb3cgaGF2aW5nIHdlYW5lZCBHVCBmcm9tIHJlcXVpcmluZyBjZS0+Z2VtX2Nv
bnRleHQsIHdlIGNhbiBzdG9wCnJlZmVyZW5jaW5nIGl0IGVudGlyZWx5LiBUaGlzIGFsc28gbWVh
bnMgd2Ugbm8gbG9uZ2VyIGhhdmUgdG8gY3JlYXRlIHJhbmRvbQphbmQgdW5uZWNlc3NhcnkgR0VN
IGNvbnRleHRzIGZvciBpbnRlcm5hbCB1c2UuCgpHRU0gY29udGV4dHMgYXJlIG5vdyBlbnRpcmVs
eSBmb3IgdHJhY2tpbmcgR0VNIGNsaWVudHMsIGFuZCBpbnRlbF9jb250ZXh0CnRoZSBleGVjdXRp
b24gZW52aXJvbm1lbnQgb24gdGhlIEdQVS4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8
Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9jb250ZXh0LmMgICB8ICA5MSArKysrKy0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmggICB8ICAgNiArLQogLi4uL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jICAgIHwgICAzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jICAgfCAgIDYgKy0KIC4uLi9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyB8ICAgNSArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0v
c2VsZnRlc3RzL21vY2tfY29udGV4dC5jIHwgIDExICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9jb250ZXh0LmMgICAgICAgfCAgMzIgKy0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfY29udGV4dC5oICAgICAgIHwgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9lbmdpbmVfY3MuYyAgICAgfCAgMjEgKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9ndC5jICAgICAgICAgICAgfCAgMjYgKysrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZ3RfdHlwZXMuaCAgICAgIHwgICA3ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2xyYy5jICAgICAgICAgICB8ICAxOCArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2xyYy5oICAgICAgICAgICB8ICAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfcmVzZXQuYyAgICAgICAgIHwgICA2ICstCiAuLi4vZ3B1L2RybS9pOTE1L2d0L2ludGVs
X3Jpbmdfc3VibWlzc2lvbi5jICAgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Nl
bGZ0ZXN0X2NvbnRleHQuYyAgICB8ICA1OSArKystLS0tLQogLi4uL2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X2VuZ2luZV9oZWFydGJlYXQuYyAgIHwgICAzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9zZWxmdGVzdF9oYW5nY2hlY2suYyAgfCAgMjkgKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Qvc2VsZnRlc3RfbHJjLmMgICAgICAgIHwgMTM3ICsrKysrKy0tLS0tLS0tLS0tLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jICAgICAgICAgIHwgIDE2ICstCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oICAgICAgICAgICAgICAgfCAgIDMgLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9nZW0uYyAgICAgICAgICAgICAgIHwgIDE2ICstCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYyAgICAgICAgICAgfCAgIDggKy0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcGVyZi5jICAgICAgICAgICAgICB8ICAgMyAtCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3JlcXVlc3QuYyAgICAgICAgICAgfCAgIDUgKy0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYyB8ICAgNiArLQogLi4uL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMgIHwgICA4ICstCiAyNyBmaWxlcyBjaGFuZ2Vk
LCAyMTEgaW5zZXJ0aW9ucygrKSwgMzI4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCmluZGV4IDQ1NjI0MmUyMmJlMy4uNDljZjEwZjY4
ZWYyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4
dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKQEAg
LTE3MCw2ICsxNzAsMjYgQEAgbG9va3VwX3VzZXJfZW5naW5lKHN0cnVjdCBpOTE1X2dlbV9jb250
ZXh0ICpjdHgsCiAJcmV0dXJuIGk5MTVfZ2VtX2NvbnRleHRfZ2V0X2VuZ2luZShjdHgsIGlkeCk7
CiB9CiAKK3N0YXRpYyB2b2lkIGludGVsX2NvbnRleHRfc2V0X2dlbShzdHJ1Y3QgaW50ZWxfY29u
dGV4dCAqY2UsCisJCQkJICBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQoreworCWNlLT5n
ZW1fY29udGV4dCA9IGN0eDsKKworCWNlLT5yaW5nID0gX19pbnRlbF9jb250ZXh0X3Jpbmdfc2l6
ZShTWl8xNkspOworCisJaWYgKGN0eC0+dm0pIHsKKwkJaTkxNV92bV9wdXQoY2UtPnZtKTsKKwkJ
Y2UtPnZtID0gaTkxNV92bV9nZXQoY3R4LT52bSk7CisJfQorCisJaWYgKGN0eC0+dGltZWxpbmUp
CisJCWNlLT50aW1lbGluZSA9IGludGVsX3RpbWVsaW5lX2dldChjdHgtPnRpbWVsaW5lKTsKKwor
CWlmIChjdHgtPnNjaGVkLnByaW9yaXR5ID49IEk5MTVfUFJJT1JJVFlfTk9STUFMICYmCisJICAg
IGludGVsX2VuZ2luZV9oYXNfc2VtYXBob3JlcyhjZS0+ZW5naW5lKSkKKwkJX19zZXRfYml0KENP
TlRFWFRfVVNFX1NFTUFQSE9SRVMsICZjZS0+ZmxhZ3MpOworfQorCiBzdGF0aWMgdm9pZCBfX2Zy
ZWVfZW5naW5lcyhzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lcyAqZSwgdW5zaWduZWQgaW50IGNvdW50
KQogewogCXdoaWxlIChjb3VudC0tKSB7CkBAIC0yMTIsMTIgKzIzMiwxNCBAQCBzdGF0aWMgc3Ry
dWN0IGk5MTVfZ2VtX2VuZ2luZXMgKmRlZmF1bHRfZW5naW5lcyhzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqY3R4KQogCQlHRU1fQlVHX09OKGVuZ2luZS0+bGVnYWN5X2lkeCA+PSBJOTE1X05VTV9F
TkdJTkVTKTsKIAkJR0VNX0JVR19PTihlLT5lbmdpbmVzW2VuZ2luZS0+bGVnYWN5X2lkeF0pOwog
Ci0JCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoY3R4LCBlbmdpbmUpOworCQljZSA9IGludGVs
X2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CiAJCWlmIChJU19FUlIoY2UpKSB7CiAJCQlfX2ZyZWVf
ZW5naW5lcyhlLCBlLT5udW1fZW5naW5lcyArIDEpOwogCQkJcmV0dXJuIEVSUl9DQVNUKGNlKTsK
IAkJfQogCisJCWludGVsX2NvbnRleHRfc2V0X2dlbShjZSwgY3R4KTsKKwogCQllLT5lbmdpbmVz
W2VuZ2luZS0+bGVnYWN5X2lkeF0gPSBjZTsKIAkJZS0+bnVtX2VuZ2luZXMgPSBtYXgoZS0+bnVt
X2VuZ2luZXMsIGVuZ2luZS0+bGVnYWN5X2lkeCk7CiAJfQpAQCAtNjUxLDM3ICs2NzMsNiBAQCBp
OTE1X2dlbV9jcmVhdGVfY29udGV4dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdW5z
aWduZWQgaW50IGZsYWdzKQogCXJldHVybiBjdHg7CiB9CiAKLXN0YXRpYyB2b2lkCi1kZXN0cm95
X2tlcm5lbF9jb250ZXh0KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICoqY3R4cCkKLXsKLQlzdHJ1
Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwotCi0JLyogS2VlcCB0aGUgY29udGV4dCByZWYgc28g
dGhhdCB3ZSBjYW4gZnJlZSBpdCBpbW1lZGlhdGVseSBvdXJzZWx2ZXMgKi8KLQljdHggPSBpOTE1
X2dlbV9jb250ZXh0X2dldChmZXRjaF9hbmRfemVybyhjdHhwKSk7Ci0JR0VNX0JVR19PTighaTkx
NV9nZW1fY29udGV4dF9pc19rZXJuZWwoY3R4KSk7Ci0KLQljb250ZXh0X2Nsb3NlKGN0eCk7Ci0J
aTkxNV9nZW1fY29udGV4dF9mcmVlKGN0eCk7Ci19Ci0KLXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0
ICoKLWk5MTVfZ2VtX2NvbnRleHRfY3JlYXRlX2tlcm5lbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwgaW50IHByaW8pCi17Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKLQot
CWN0eCA9IGk5MTVfZ2VtX2NyZWF0ZV9jb250ZXh0KGk5MTUsIDApOwotCWlmIChJU19FUlIoY3R4
KSkKLQkJcmV0dXJuIGN0eDsKLQotCWk5MTVfZ2VtX2NvbnRleHRfY2xlYXJfYmFubmFibGUoY3R4
KTsKLQlpOTE1X2dlbV9jb250ZXh0X3NldF9wZXJzaXN0ZW5jZShjdHgpOwotCWN0eC0+c2NoZWQu
cHJpb3JpdHkgPSBJOTE1X1VTRVJfUFJJT1JJVFkocHJpbyk7Ci0KLQlHRU1fQlVHX09OKCFpOTE1
X2dlbV9jb250ZXh0X2lzX2tlcm5lbChjdHgpKTsKLQotCXJldHVybiBjdHg7Ci19Ci0KIHN0YXRp
YyB2b2lkIGluaXRfY29udGV4dHMoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHRzICpnYykKIHsKIAlz
cGluX2xvY2tfaW5pdCgmZ2MtPmxvY2spOwpAQCAtNjkxLDMyICs2ODIsMTIgQEAgc3RhdGljIHZv
aWQgaW5pdF9jb250ZXh0cyhzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dHMgKmdjKQogCWluaXRfbGxp
c3RfaGVhZCgmZ2MtPmZyZWVfbGlzdCk7CiB9CiAKLWludCBpOTE1X2dlbV9pbml0X2NvbnRleHRz
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQordm9pZCBpOTE1X2dlbV9pbml0X2NvbnRl
eHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBpOTE1X2dlbV9j
b250ZXh0ICpjdHg7Ci0KLQkvKiBSZWFzc3VyZSBvdXJzZWx2ZXMgd2UgYXJlIG9ubHkgY2FsbGVk
IG9uY2UgKi8KLQlHRU1fQlVHX09OKGk5MTUtPmtlcm5lbF9jb250ZXh0KTsKLQogCWluaXRfY29u
dGV4dHMoJmk5MTUtPmdlbS5jb250ZXh0cyk7Ci0KLQkvKiBsb3dlc3QgcHJpb3JpdHk7IGlkbGUg
dGFzayAqLwotCWN0eCA9IGk5MTVfZ2VtX2NvbnRleHRfY3JlYXRlX2tlcm5lbChpOTE1LCBJOTE1
X1BSSU9SSVRZX01JTik7Ci0JaWYgKElTX0VSUihjdHgpKSB7Ci0JCURSTV9FUlJPUigiRmFpbGVk
IHRvIGNyZWF0ZSBkZWZhdWx0IGdsb2JhbCBjb250ZXh0XG4iKTsKLQkJcmV0dXJuIFBUUl9FUlIo
Y3R4KTsKLQl9Ci0JaTkxNS0+a2VybmVsX2NvbnRleHQgPSBjdHg7Ci0KIAlEUk1fREVCVUdfRFJJ
VkVSKCIlcyBjb250ZXh0IHN1cHBvcnQgaW5pdGlhbGl6ZWRcbiIsCiAJCQkgRFJJVkVSX0NBUFMo
aTkxNSktPmhhc19sb2dpY2FsX2NvbnRleHRzID8KIAkJCSAibG9naWNhbCIgOiAiZmFrZSIpOwot
CXJldHVybiAwOwotfQotCi12b2lkIGk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNlX19jb250ZXh0cyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKLXsKLQlkZXN0cm95X2tlcm5lbF9jb250ZXh0
KCZpOTE1LT5rZXJuZWxfY29udGV4dCk7CiB9CiAKIHN0YXRpYyBpbnQgY29udGV4dF9pZHJfY2xl
YW51cChpbnQgaWQsIHZvaWQgKnAsIHZvaWQgKmRhdGEpCkBAIC0xNTA2LDEyICsxNDc3LDE0IEBA
IHNldF9lbmdpbmVzX19sb2FkX2JhbGFuY2Uoc3RydWN0IGk5MTVfdXNlcl9leHRlbnNpb24gX191
c2VyICpiYXNlLCB2b2lkICpkYXRhKQogCQl9CiAJfQogCi0JY2UgPSBpbnRlbF9leGVjbGlzdHNf
Y3JlYXRlX3ZpcnR1YWwoc2V0LT5jdHgsIHNpYmxpbmdzLCBuKTsKKwljZSA9IGludGVsX2V4ZWNs
aXN0c19jcmVhdGVfdmlydHVhbChzaWJsaW5ncywgbik7CiAJaWYgKElTX0VSUihjZSkpIHsKIAkJ
ZXJyID0gUFRSX0VSUihjZSk7CiAJCWdvdG8gb3V0X3NpYmxpbmdzOwogCX0KIAorCWludGVsX2Nv
bnRleHRfc2V0X2dlbShjZSwgc2V0LT5jdHgpOworCiAJaWYgKGNtcHhjaGcoJnNldC0+ZW5naW5l
cy0+ZW5naW5lc1tpZHhdLCBOVUxMLCBjZSkpIHsKIAkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwog
CQllcnIgPSAtRUVYSVNUOwpAQCAtMTY4MSwxMiArMTY1NCwxNCBAQCBzZXRfZW5naW5lcyhzdHJ1
Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogCQkJcmV0dXJuIC1FTk9FTlQ7CiAJCX0KIAotCQlj
ZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGN0eCwgZW5naW5lKTsKKwkJY2UgPSBpbnRlbF9jb250
ZXh0X2NyZWF0ZShlbmdpbmUpOwogCQlpZiAoSVNfRVJSKGNlKSkgewogCQkJX19mcmVlX2VuZ2lu
ZXMoc2V0LmVuZ2luZXMsIG4pOwogCQkJcmV0dXJuIFBUUl9FUlIoY2UpOwogCQl9CiAKKwkJaW50
ZWxfY29udGV4dF9zZXRfZ2VtKGNlLCBjdHgpOworCiAJCXNldC5lbmdpbmVzLT5lbmdpbmVzW25d
ID0gY2U7CiAJfQogCXNldC5lbmdpbmVzLT5udW1fZW5naW5lcyA9IG51bV9lbmdpbmVzOwpAQCAt
MTk4NywxMyArMTk2MiwxNSBAQCBzdGF0aWMgaW50IGNsb25lX2VuZ2luZXMoc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHQgKmRzdCwKIAkJICovCiAJCWlmIChpbnRlbF9lbmdpbmVfaXNfdmlydHVhbChl
bmdpbmUpKQogCQkJY2xvbmUtPmVuZ2luZXNbbl0gPQotCQkJCWludGVsX2V4ZWNsaXN0c19jbG9u
ZV92aXJ0dWFsKGRzdCwgZW5naW5lKTsKKwkJCQlpbnRlbF9leGVjbGlzdHNfY2xvbmVfdmlydHVh
bChlbmdpbmUpOwogCQllbHNlCi0JCQljbG9uZS0+ZW5naW5lc1tuXSA9IGludGVsX2NvbnRleHRf
Y3JlYXRlKGRzdCwgZW5naW5lKTsKKwkJCWNsb25lLT5lbmdpbmVzW25dID0gaW50ZWxfY29udGV4
dF9jcmVhdGUoZW5naW5lKTsKIAkJaWYgKElTX0VSUl9PUl9OVUxMKGNsb25lLT5lbmdpbmVzW25d
KSkgewogCQkJX19mcmVlX2VuZ2luZXMoY2xvbmUsIG4pOwogCQkJZ290byBlcnJfdW5sb2NrOwog
CQl9CisKKwkJaW50ZWxfY29udGV4dF9zZXRfZ2VtKGNsb25lLT5lbmdpbmVzW25dLCBkc3QpOwog
CX0KIAljbG9uZS0+bnVtX2VuZ2luZXMgPSBuOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX2NvbnRleHQuaAppbmRleCA2OTkzMjg5OTgwM2UuLmQ5OWZmZjQ4MWQ1OSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5oCkBAIC0xMTUsOCAr
MTE1LDcgQEAgc3RhdGljIGlubGluZSBib29sIGk5MTVfZ2VtX2NvbnRleHRfaXNfa2VybmVsKHN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCiB9CiAKIC8qIGk5MTVfZ2VtX2NvbnRleHQuYyAq
LwotaW50IF9fbXVzdF9jaGVjayBpOTE1X2dlbV9pbml0X2NvbnRleHRzKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KTsKLXZvaWQgaTkxNV9nZW1fZHJpdmVyX3JlbGVhc2VfX2NvbnRleHRz
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgaTkxNV9nZW1faW5pdF9jb250
ZXh0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiAKIGludCBpOTE1X2dlbV9jb250
ZXh0X29wZW4oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgIHN0cnVjdCBkcm1f
ZmlsZSAqZmlsZSk7CkBAIC0xNDAsOSArMTM5LDYgQEAgaW50IGk5MTVfZ2VtX2NvbnRleHRfc2V0
cGFyYW1faW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIGludCBpOTE1
X2dlbV9jb250ZXh0X3Jlc2V0X3N0YXRzX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZv
aWQgKmRhdGEsCiAJCQkJICAgICAgIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSk7CiAKLXN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0ICoKLWk5MTVfZ2VtX2NvbnRleHRfY3JlYXRlX2tlcm5lbChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgaW50IHByaW8pOwotCiBzdGF0aWMgaW5saW5lIHN0cnVj
dCBpOTE1X2dlbV9jb250ZXh0ICoKIGk5MTVfZ2VtX2NvbnRleHRfZ2V0KHN0cnVjdCBpOTE1X2dl
bV9jb250ZXh0ICpjdHgpCiB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fZXhlY2J1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X2V4ZWNidWZmZXIuYwppbmRleCA2ZGM4NmMxMjllZWUuLjRmNmI4NDdlYTAxMSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCkBAIC0xMjYxLDgg
KzEyNjEsNyBAQCBzdGF0aWMgdTMyICpyZWxvY19ncHUoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAq
ZWIsCiAJCQkgKiBtZW1vcnkgbG9jYXRpb24uCiAJCQkgKi8KIAkJCWlmIChjYWNoZS0+Z2VuID49
IDEyKQotCQkJCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZWItPmNvbnRleHQtPmdlbV9jb250
ZXh0LAotCQkJCQkJCSAgZWItPmVuZ2luZSk7CisJCQkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0
ZShlYi0+ZW5naW5lKTsKIAkJCWVsc2UKIAkJCQljZSA9IGludGVsX2NvbnRleHRfZ2V0KGViLT5j
b250ZXh0KTsKIAkJCWlmIChJU19FUlIoY2UpKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV91c2VycHRyLmMKaW5kZXggNGM3MmQ3NGQ2NTc2Li42M2VkZDhjODNiOGEgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYwpAQCAtNzczLDE1ICs3
NzMsMTEgQEAgaTkxNV9nZW1fdXNlcnB0cl9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAog
CQlyZXR1cm4gLUVGQVVMVDsKIAogCWlmIChhcmdzLT5mbGFncyAmIEk5MTVfVVNFUlBUUl9SRUFE
X09OTFkpIHsKLQkJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07Ci0KIAkJLyoKIAkJICog
T24gYWxtb3N0IGFsbCBvZiB0aGUgb2xkZXIgaHcsIHdlIGNhbm5vdCB0ZWxsIHRoZSBHUFUgdGhh
dAogCQkgKiBhIHBhZ2UgaXMgcmVhZG9ubHkuCiAJCSAqLwotCQl2bSA9IHJjdV9kZXJlZmVyZW5j
ZV9wcm90ZWN0ZWQoZGV2X3ByaXYtPmtlcm5lbF9jb250ZXh0LT52bSwKLQkJCQkJICAgICAgIHRy
dWUpOyAvKiBzdGF0aWMgdm0gKi8KLQkJaWYgKCF2bSB8fCAhdm0tPmhhc19yZWFkX29ubHkpCisJ
CWlmICghZGV2X3ByaXYtPmd0LnZtLT5oYXNfcmVhZF9vbmx5KQogCQkJcmV0dXJuIC1FTk9ERVY7
CiAJfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5
MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkx
NV9nZW1fY29udGV4dC5jCmluZGV4IDQ3ODkwYzkyNTM0Yy4uZThkMzI4OTBkYjkzIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRl
eHQuYwpAQCAtMzA5LDcgKzMwOSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9wYXJhbGxlbF9zd2l0Y2go
dm9pZCAqYXJnKQogCQkJaWYgKCFkYXRhW21dLmNlWzBdKQogCQkJCWNvbnRpbnVlOwogCi0JCQlj
ZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGN0eCwgZGF0YVttXS5jZVswXS0+ZW5naW5lKTsKKwkJ
CWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZGF0YVttXS5jZVswXS0+ZW5naW5lKTsKIAkJCWlm
IChJU19FUlIoY2UpKQogCQkJCWdvdG8gb3V0OwogCkBAIC0xMjMyLDggKzEyMzIsNyBAQCBfX2ln
dF9jdHhfc3NldShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCWh3ZWlnaHQzMihl
bmdpbmUtPnNzZXUuc2xpY2VfbWFzayksCiAJCQlod2VpZ2h0MzIocGdfc3NldS5zbGljZV9tYXNr
KSk7CiAKLQkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUtPmtlcm5lbF9jb250ZXh0
LT5nZW1fY29udGV4dCwKLQkJCQkJICBlbmdpbmUpOworCQljZSA9IGludGVsX2NvbnRleHRfY3Jl
YXRlKGVuZ2luZSk7CiAJCWlmIChJU19FUlIoY2UpKSB7CiAJCQlyZXQgPSBQVFJfRVJSKGNlKTsK
IAkJCWdvdG8gb3V0X3B1dDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9z
ZWxmdGVzdHMvbW9ja19jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRl
c3RzL21vY2tfY29udGV4dC5jCmluZGV4IDI5Yjg5ODRmMGU0Ny4uZjQ3MmZjOTI0MGQ1IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL21vY2tfY29udGV4dC5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvbW9ja19jb250ZXh0LmMK
QEAgLTk3LDcgKzk3LDE2IEBAIGxpdmVfY29udGV4dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwgc3RydWN0IGRybV9maWxlICpmaWxlKQogc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKgog
a2VybmVsX2NvbnRleHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JcmV0dXJu
IGk5MTVfZ2VtX2NvbnRleHRfY3JlYXRlX2tlcm5lbChpOTE1LCBJOTE1X1BSSU9SSVRZX05PUk1B
TCk7CisJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKKworCWN0eCA9IGk5MTVfZ2VtX2Ny
ZWF0ZV9jb250ZXh0KGk5MTUsIDApOworCWlmIChJU19FUlIoY3R4KSkKKwkJcmV0dXJuIGN0eDsK
KworCUdFTV9CVUdfT04oIWk5MTVfZ2VtX2NvbnRleHRfaXNfa2VybmVsKGN0eCkpOworCWk5MTVf
Z2VtX2NvbnRleHRfY2xlYXJfYmFubmFibGUoY3R4KTsKKworCXJldHVybiBjdHg7CiB9CiAKIHZv
aWQga2VybmVsX2NvbnRleHRfY2xvc2Uoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYwppbmRleCA3MDc1ZDAzZjUwOGYuLjhi
NzFiMmNjYmYyNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29u
dGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYwpAQCAt
MzEsOCArMzEsNyBAQCB2b2lkIGludGVsX2NvbnRleHRfZnJlZShzdHJ1Y3QgaW50ZWxfY29udGV4
dCAqY2UpCiB9CiAKIHN0cnVjdCBpbnRlbF9jb250ZXh0ICoKLWludGVsX2NvbnRleHRfY3JlYXRl
KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCi0JCSAgICAgc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lKQoraW50ZWxfY29udGV4dF9jcmVhdGUoc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lKQogewogCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIApAQCAtNDAsNyArMzks
NyBAQCBpbnRlbF9jb250ZXh0X2NyZWF0ZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAog
CWlmICghY2UpCiAJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwogCi0JaW50ZWxfY29udGV4dF9p
bml0KGNlLCBjdHgsIGVuZ2luZSk7CisJaW50ZWxfY29udGV4dF9pbml0KGNlLCBlbmdpbmUpOwog
CXJldHVybiBjZTsKIH0KIApAQCAtNzIsOCArNzEsNiBAQCBpbnQgX19pbnRlbF9jb250ZXh0X2Rv
X3BpbihzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAJCQkgIGNlLT5lbmdpbmUtPm5hbWUsIGNl
LT50aW1lbGluZS0+ZmVuY2VfY29udGV4dCwKIAkJCSAgY2UtPnJpbmctPmhlYWQsIGNlLT5yaW5n
LT50YWlsKTsKIAotCQlpOTE1X2dlbV9jb250ZXh0X2dldChjZS0+Z2VtX2NvbnRleHQpOyAvKiBm
b3IgY3R4LT5wcGd0dCAqLwotCiAJCXNtcF9tYl9fYmVmb3JlX2F0b21pYygpOyAvKiBmbHVzaCBw
aW4gYmVmb3JlIGl0IGlzIHZpc2libGUgKi8KIAl9CiAKQEAgLTEwMyw3ICsxMDAsNiBAQCB2b2lk
IGludGVsX2NvbnRleHRfdW5waW4oc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogCiAJCWNlLT5v
cHMtPnVucGluKGNlKTsKIAotCQlpOTE1X2dlbV9jb250ZXh0X3B1dChjZS0+Z2VtX2NvbnRleHQp
OwogCQlpbnRlbF9jb250ZXh0X2FjdGl2ZV9yZWxlYXNlKGNlKTsKIAl9CiAKQEAgLTE5OCw3ICsx
OTQsNyBAQCBpbnQgaW50ZWxfY29udGV4dF9hY3RpdmVfYWNxdWlyZShzdHJ1Y3QgaW50ZWxfY29u
dGV4dCAqY2UpCiAJCXJldHVybiBlcnI7CiAKIAkvKiBQcmVhbGxvY2F0ZSB0cmFja2luZyBub2Rl
cyAqLwotCWlmICghaTkxNV9nZW1fY29udGV4dF9pc19rZXJuZWwoY2UtPmdlbV9jb250ZXh0KSkg
eworCWlmIChjZS0+Z2VtX2NvbnRleHQpIHsKIAkJZXJyID0gaTkxNV9hY3RpdmVfYWNxdWlyZV9w
cmVhbGxvY2F0ZV9iYXJyaWVyKCZjZS0+YWN0aXZlLAogCQkJCQkJCSAgICAgIGNlLT5lbmdpbmUp
OwogCQlpZiAoZXJyKSB7CkBAIC0yMTksMzMgKzIxNSwxOSBAQCB2b2lkIGludGVsX2NvbnRleHRf
YWN0aXZlX3JlbGVhc2Uoc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogCiB2b2lkCiBpbnRlbF9j
b250ZXh0X2luaXQoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAotCQkgICBzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqY3R4LAogCQkgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7
Ci0Jc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07Ci0KIAlHRU1fQlVHX09OKCFlbmdpbmUt
PmNvcHMpOworCUdFTV9CVUdfT04oIWVuZ2luZS0+Z3QtPnZtKTsKIAogCWtyZWZfaW5pdCgmY2Ut
PnJlZik7CiAKLQljZS0+Z2VtX2NvbnRleHQgPSBjdHg7Ci0JcmN1X3JlYWRfbG9jaygpOwotCXZt
ID0gcmN1X2RlcmVmZXJlbmNlKGN0eC0+dm0pOwotCWlmICh2bSkKLQkJY2UtPnZtID0gaTkxNV92
bV9nZXQodm0pOwotCWVsc2UKLQkJY2UtPnZtID0gaTkxNV92bV9nZXQoJmVuZ2luZS0+Z3QtPmdn
dHQtPnZtKTsKLQlyY3VfcmVhZF91bmxvY2soKTsKLQlpZiAoY3R4LT50aW1lbGluZSkKLQkJY2Ut
PnRpbWVsaW5lID0gaW50ZWxfdGltZWxpbmVfZ2V0KGN0eC0+dGltZWxpbmUpOwotCWlmIChjdHgt
PnNjaGVkLnByaW9yaXR5ID49IEk5MTVfUFJJT1JJVFlfTk9STUFMICYmCi0JICAgIGludGVsX2Vu
Z2luZV9oYXNfc2VtYXBob3JlcyhlbmdpbmUpKQotCQlfX3NldF9iaXQoQ09OVEVYVF9VU0VfU0VN
QVBIT1JFUywgJmNlLT5mbGFncyk7Ci0KIAljZS0+ZW5naW5lID0gZW5naW5lOwogCWNlLT5vcHMg
PSBlbmdpbmUtPmNvcHM7CiAJY2UtPnNzZXUgPSBlbmdpbmUtPnNzZXU7Ci0JY2UtPnJpbmcgPSBf
X2ludGVsX2NvbnRleHRfcmluZ19zaXplKFNaXzE2Syk7CisJY2UtPnJpbmcgPSBfX2ludGVsX2Nv
bnRleHRfcmluZ19zaXplKFNaXzRLKTsKKworCWNlLT52bSA9IGk5MTVfdm1fZ2V0KGVuZ2luZS0+
Z3QtPnZtKTsKIAogCUlOSVRfTElTVF9IRUFEKCZjZS0+c2lnbmFsX2xpbmspOwogCUlOSVRfTElT
VF9IRUFEKCZjZS0+c2lnbmFscyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9jb250ZXh0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0
LmgKaW5kZXggZDdiNjY3YTI2ZTA4Li4xNWJjNDZlMWIzMDggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9jb250ZXh0LmgKQEAgLTE4LDEzICsxOCwxMSBAQAogI2luY2x1ZGUgImludGVs
X3RpbWVsaW5lX3R5cGVzLmgiCiAKIHZvaWQgaW50ZWxfY29udGV4dF9pbml0KHN0cnVjdCBpbnRl
bF9jb250ZXh0ICpjZSwKLQkJCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCQlzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOwogdm9pZCBpbnRlbF9jb250ZXh0X2Zpbmkoc3Ry
dWN0IGludGVsX2NvbnRleHQgKmNlKTsKIAogc3RydWN0IGludGVsX2NvbnRleHQgKgotaW50ZWxf
Y29udGV4dF9jcmVhdGUoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKLQkJICAgICBzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOworaW50ZWxfY29udGV4dF9jcmVhdGUoc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKIAogdm9pZCBpbnRlbF9jb250ZXh0X2ZyZWUoc3Ry
dWN0IGludGVsX2NvbnRleHQgKmNlKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9l
bmdpbmVfY3MuYwppbmRleCBlZmRlM2Y4ZTA1NTkuLmIzOGVhNDRhYjc2MSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKQEAgLTc1NiwxMiArNzU2LDEwIEBAIGNy
ZWF0ZV9rZXJuZWxfY29udGV4dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJc3Ry
dWN0IGludGVsX2NvbnRleHQgKmNlOwogCWludCBlcnI7CiAKLQljZSA9IGludGVsX2NvbnRleHRf
Y3JlYXRlKGVuZ2luZS0+aTkxNS0+a2VybmVsX2NvbnRleHQsIGVuZ2luZSk7CisJY2UgPSBpbnRl
bF9jb250ZXh0X2NyZWF0ZShlbmdpbmUpOwogCWlmIChJU19FUlIoY2UpKQogCQlyZXR1cm4gY2U7
CiAKLQljZS0+cmluZyA9IF9faW50ZWxfY29udGV4dF9yaW5nX3NpemUoU1pfNEspOwotCiAJZXJy
ID0gaW50ZWxfY29udGV4dF9waW4oY2UpOwogCWlmIChlcnIpIHsKIAkJaW50ZWxfY29udGV4dF9w
dXQoY2UpOwpAQCAtNzk3LDYgKzc5NSwxMiBAQCBpbnQgaW50ZWxfZW5naW5lX2luaXRfY29tbW9u
KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAogCWVuZ2luZS0+c2V0X2RlZmF1bHRf
c3VibWlzc2lvbihlbmdpbmUpOwogCisJcmV0ID0gbWVhc3VyZV9icmVhZGNydW1iX2R3KGVuZ2lu
ZSk7CisJaWYgKHJldCA8IDApCisJCXJldHVybiByZXQ7CisKKwllbmdpbmUtPmVtaXRfZmluaV9i
cmVhZGNydW1iX2R3ID0gcmV0OworCiAJLyoKIAkgKiBXZSBtYXkgbmVlZCB0byBkbyB0aGluZ3Mg
d2l0aCB0aGUgc2hyaW5rZXIgd2hpY2gKIAkgKiByZXF1aXJlIHVzIHRvIGltbWVkaWF0ZWx5IHN3
aXRjaCBiYWNrIHRvIHRoZSBkZWZhdWx0CkBAIC04MTEsMTggKzgxNSw3IEBAIGludCBpbnRlbF9l
bmdpbmVfaW5pdF9jb21tb24oc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCiAJZW5n
aW5lLT5rZXJuZWxfY29udGV4dCA9IGNlOwogCi0JcmV0ID0gbWVhc3VyZV9icmVhZGNydW1iX2R3
KGVuZ2luZSk7Ci0JaWYgKHJldCA8IDApCi0JCWdvdG8gZXJyX3VucGluOwotCi0JZW5naW5lLT5l
bWl0X2ZpbmlfYnJlYWRjcnVtYl9kdyA9IHJldDsKLQogCXJldHVybiAwOwotCi1lcnJfdW5waW46
Ci0JaW50ZWxfY29udGV4dF91bnBpbihjZSk7Ci0JaW50ZWxfY29udGV4dF9wdXQoY2UpOwotCXJl
dHVybiByZXQ7CiB9CiAKIC8qKgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfZ3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0LmMKaW5kZXggYzM5
YjIxYzhkMzI4Li4wMjQ4NDg2MGNhYTggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2d0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYwpA
QCAtNzQsNyArNzQsNiBAQCBpbnQgaW50ZWxfZ3RfaW5pdF9odyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0
KQogCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9IGd0LT51bmNvcmU7CiAJaW50IHJldDsK
IAotCUJVR19PTighaTkxNS0+a2VybmVsX2NvbnRleHQpOwogCXJldCA9IGludGVsX2d0X3Rlcm1p
bmFsbHlfd2VkZ2VkKGd0KTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwpAQCAtMzY1LDYgKzM2
NCwxNCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9ndF9maW5pX3NjcmF0Y2goc3RydWN0IGludGVsX2d0
ICpndCkKIAlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmZ3QtPnNjcmF0Y2gsIDApOwogfQog
CitzdGF0aWMgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqa2VybmVsX3ZtKHN0cnVjdCBpbnRl
bF9ndCAqZ3QpCit7CisJaWYgKElOVEVMX1BQR1RUKGd0LT5pOTE1KSA+IElOVEVMX1BQR1RUX0FM
SUFTSU5HKQorCQlyZXR1cm4gJmk5MTVfcHBndHRfY3JlYXRlKGd0LT5pOTE1KS0+dm07CisJZWxz
ZQorCQlyZXR1cm4gaTkxNV92bV9nZXQoJmd0LT5nZ3R0LT52bSk7Cit9CisKIGludCBpbnRlbF9n
dF9pbml0KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiB7CiAJaW50IGVycjsKQEAgLTM3NSw3ICszODIs
MTcgQEAgaW50IGludGVsX2d0X2luaXQoc3RydWN0IGludGVsX2d0ICpndCkKIAogCWludGVsX2d0
X3BtX2luaXQoZ3QpOwogCisJZ3QtPnZtID0ga2VybmVsX3ZtKGd0KTsKKwlpZiAoIWd0LT52bSkg
eworCQllcnIgPSAtRU5PTUVNOworCQlnb3RvIGVycl9zY3JhdGNoOworCX0KKwogCXJldHVybiAw
OworCitlcnJfc2NyYXRjaDoKKwlpbnRlbF9ndF9maW5pX3NjcmF0Y2goZ3QpOworCXJldHVybiBl
cnI7CiB9CiAKIHZvaWQgaW50ZWxfZ3RfZHJpdmVyX3JlbW92ZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0
KQpAQCAtMzkwLDYgKzQwNywxMyBAQCB2b2lkIGludGVsX2d0X2RyaXZlcl91bnJlZ2lzdGVyKHN0
cnVjdCBpbnRlbF9ndCAqZ3QpCiAKIHZvaWQgaW50ZWxfZ3RfZHJpdmVyX3JlbGVhc2Uoc3RydWN0
IGludGVsX2d0ICpndCkKIHsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKKworCXZt
ID0gZmV0Y2hfYW5kX3plcm8oJmd0LT52bSk7CisJaWYgKCF2bSkgLyogRklYTUUgYmVpbmcgY2Fs
bGVkIHR3aWNlIG9uIGVycm9yIHBhdGhzIDooICovCisJCXJldHVybjsKKworCWk5MTVfdm1fcHV0
KHZtKTsKIAlpbnRlbF9ndF9wbV9maW5pKGd0KTsKIAlpbnRlbF9ndF9maW5pX3NjcmF0Y2goZ3Qp
OwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMu
aCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmgKaW5kZXggZDRlMTRk
YmQxNzJlLi45Njg5MGRkMTJiNWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2d0X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3Rf
dHlwZXMuaApAQCAtOTAsNiArOTAsMTMgQEAgc3RydWN0IGludGVsX2d0IHsKIAlzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmVbSTkxNV9OVU1fRU5HSU5FU107CiAJc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lX2NsYXNzW01BWF9FTkdJTkVfQ0xBU1MgKyAxXQogCQkJCQkgICAgW01B
WF9FTkdJTkVfSU5TVEFOQ0UgKyAxXTsKKworCS8qCisJICogRGVmYXVsdCBhZGRyZXNzIHNwYWNl
IChlaXRoZXIgR0dUVCBvciBwcEdUVCBkZXBlbmRpbmcgb24gYXJjaCkuCisJICoKKwkgKiBSZXNl
cnZlZCBmb3IgZXhjbHVzaXZlIHVzZSBieSB0aGUga2VybmVsLgorCSAqLworCXN0cnVjdCBpOTE1
X2FkZHJlc3Nfc3BhY2UgKnZtOwogfTsKIAogZW51bSBpbnRlbF9ndF9zY3JhdGNoX2ZpZWxkIHsK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKaW5kZXggZjg5YzA1NjI3OWEyLi5kMjU1ZTkw
N2Y4NmMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCkBAIC0xMzMsMTIgKzEzMywx
MSBAQAogICovCiAjaW5jbHVkZSA8bGludXgvaW50ZXJydXB0Lmg+CiAKLSNpbmNsdWRlICJnZW0v
aTkxNV9nZW1fY29udGV4dC5oIgotCiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIKICNpbmNsdWRlICJp
OTE1X3BlcmYuaCIKICNpbmNsdWRlICJpOTE1X3RyYWNlLmgiCiAjaW5jbHVkZSAiaTkxNV92Z3B1
LmgiCisjaW5jbHVkZSAiaW50ZWxfY29udGV4dC5oIgogI2luY2x1ZGUgImludGVsX2VuZ2luZV9w
bS5oIgogI2luY2x1ZGUgImludGVsX2d0LmgiCiAjaW5jbHVkZSAiaW50ZWxfZ3RfcG0uaCIKQEAg
LTQ0MzIsOCArNDQzMSw3IEBAIHZpcnR1YWxfYm9uZF9leGVjdXRlKHN0cnVjdCBpOTE1X3JlcXVl
c3QgKnJxLCBzdHJ1Y3QgZG1hX2ZlbmNlICpzaWduYWwpCiB9CiAKIHN0cnVjdCBpbnRlbF9jb250
ZXh0ICoKLWludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqY3R4LAotCQkJICAgICAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKipzaWJsaW5ncywK
K2ludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICoq
c2libGluZ3MsCiAJCQkgICAgICAgdW5zaWduZWQgaW50IGNvdW50KQogewogCXN0cnVjdCB2aXJ0
dWFsX2VuZ2luZSAqdmU7CkBAIC00NDQ0LDEzICs0NDQyLDEzIEBAIGludGVsX2V4ZWNsaXN0c19j
cmVhdGVfdmlydHVhbChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogCQlyZXR1cm4gRVJS
X1BUUigtRUlOVkFMKTsKIAogCWlmIChjb3VudCA9PSAxKQotCQlyZXR1cm4gaW50ZWxfY29udGV4
dF9jcmVhdGUoY3R4LCBzaWJsaW5nc1swXSk7CisJCXJldHVybiBpbnRlbF9jb250ZXh0X2NyZWF0
ZShzaWJsaW5nc1swXSk7CiAKIAl2ZSA9IGt6YWxsb2Moc3RydWN0X3NpemUodmUsIHNpYmxpbmdz
LCBjb3VudCksIEdGUF9LRVJORUwpOwogCWlmICghdmUpCiAJCXJldHVybiBFUlJfUFRSKC1FTk9N
RU0pOwogCi0JdmUtPmJhc2UuaTkxNSA9IGN0eC0+aTkxNTsKKwl2ZS0+YmFzZS5pOTE1ID0gc2li
bGluZ3NbMF0tPmk5MTU7CiAJdmUtPmJhc2UuZ3QgPSBzaWJsaW5nc1swXS0+Z3Q7CiAJdmUtPmJh
c2UudW5jb3JlID0gc2libGluZ3NbMF0tPnVuY29yZTsKIAl2ZS0+YmFzZS5pZCA9IC0xOwpAQCAt
NDQ5Myw3ICs0NDkxLDcgQEAgaW50ZWxfZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFsKHN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCSAgICAgdmlydHVhbF9zdWJtaXNzaW9uX3Rhc2tsZXQs
CiAJCSAgICAgKHVuc2lnbmVkIGxvbmcpdmUpOwogCi0JaW50ZWxfY29udGV4dF9pbml0KCZ2ZS0+
Y29udGV4dCwgY3R4LCAmdmUtPmJhc2UpOworCWludGVsX2NvbnRleHRfaW5pdCgmdmUtPmNvbnRl
eHQsICZ2ZS0+YmFzZSk7CiAKIAlmb3IgKG4gPSAwOyBuIDwgY291bnQ7IG4rKykgewogCQlzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICpzaWJsaW5nID0gc2libGluZ3Nbbl07CkBAIC00NTc0LDE0ICs0
NTcyLDEyIEBAIGludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChzdHJ1Y3QgaTkxNV9nZW1f
Y29udGV4dCAqY3R4LAogfQogCiBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqCi1pbnRlbF9leGVjbGlz
dHNfY2xvbmVfdmlydHVhbChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAotCQkJICAgICAg
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqc3JjKQoraW50ZWxfZXhlY2xpc3RzX2Nsb25lX3ZpcnR1
YWwoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqc3JjKQogewogCXN0cnVjdCB2aXJ0dWFsX2VuZ2lu
ZSAqc2UgPSB0b192aXJ0dWFsX2VuZ2luZShzcmMpOwogCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpk
c3Q7CiAKLQlkc3QgPSBpbnRlbF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1YWwoY3R4LAotCQkJCQkg
ICAgIHNlLT5zaWJsaW5ncywKKwlkc3QgPSBpbnRlbF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1YWwo
c2UtPnNpYmxpbmdzLAogCQkJCQkgICAgIHNlLT5udW1fc2libGluZ3MpOwogCWlmIChJU19FUlIo
ZHN0KSkKIAkJcmV0dXJuIGRzdDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2xyYy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmgKaW5kZXgg
MDQ1MTFkOGViZGMxLi4wODE1MjFmMTdjNzQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2xyYy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xy
Yy5oCkBAIC0xMTEsMTMgKzExMSwxMSBAQCB2b2lkIGludGVsX2V4ZWNsaXN0c19zaG93X3JlcXVl
c3RzKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAkJCQkgICB1bnNpZ25lZCBpbnQg
bWF4KTsKIAogc3RydWN0IGludGVsX2NvbnRleHQgKgotaW50ZWxfZXhlY2xpc3RzX2NyZWF0ZV92
aXJ0dWFsKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCi0JCQkgICAgICAgc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqKnNpYmxpbmdzLAoraW50ZWxfZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFs
KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKipzaWJsaW5ncywKIAkJCSAgICAgICB1bnNpZ25lZCBp
bnQgY291bnQpOwogCiBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqCi1pbnRlbF9leGVjbGlzdHNfY2xv
bmVfdmlydHVhbChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAotCQkJICAgICAgc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqc3JjKTsKK2ludGVsX2V4ZWNsaXN0c19jbG9uZV92aXJ0dWFsKHN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKnNyYyk7CiAKIGludCBpbnRlbF92aXJ0dWFsX2VuZ2luZV9h
dHRhY2hfYm9uZChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJCQkJICAgICBjb25z
dCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICptYXN0ZXIsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9yZXNldC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfcmVzZXQuYwppbmRleCBiNGMwYWQ0YTYwODEuLjk4ZTdiYmE1OTc5ZSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9yZXNldC5jCkBAIC04Niw2ICs4Niw5IEBAIHN0YXRpYyBib29sIG1h
cmtfZ3VpbHR5KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCWJvb2wgYmFubmVkOwogCWludCBp
OwogCisJaWYgKCFjdHgpCisJCXJldHVybiBmYWxzZTsKKwogCWF0b21pY19pbmMoJmN0eC0+Z3Vp
bHR5X2NvdW50KTsKIAogCS8qIENvb2wgY29udGV4dHMgYXJlIHRvbyBjb29sIHRvIGJlIGJhbm5l
ZCEgKFVzZWQgZm9yIHJlc2V0IHRlc3RpbmcuKSAqLwpAQCAtMTE1LDcgKzExOCw4IEBAIHN0YXRp
YyBib29sIG1hcmtfZ3VpbHR5KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCiBzdGF0aWMgdm9p
ZCBtYXJrX2lubm9jZW50KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogewotCWF0b21pY19pbmMo
JnJxLT5jb250ZXh0LT5nZW1fY29udGV4dC0+YWN0aXZlX2NvdW50KTsKKwlpZiAocnEtPmNvbnRl
eHQtPmdlbV9jb250ZXh0KQorCQlhdG9taWNfaW5jKCZycS0+Y29udGV4dC0+Z2VtX2NvbnRleHQt
PmFjdGl2ZV9jb3VudCk7CiB9CiAKIHZvaWQgX19pOTE1X3JlcXVlc3RfcmVzZXQoc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnEsIGJvb2wgZ3VpbHR5KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfcmluZ19zdWJtaXNzaW9uLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9yaW5nX3N1Ym1pc3Npb24uYwppbmRleCAxYzJmM2MzYTg4NDAuLjZkZGZlOGE4NmRi
ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ19zdWJtaXNz
aW9uLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ19zdWJtaXNzaW9u
LmMKQEAgLTE1NTgsNyArMTU1OCw3IEBAIHN0YXRpYyBpbnQgcmVtYXBfbDMoc3RydWN0IGk5MTVf
cmVxdWVzdCAqcnEpCiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IHJxLT5jb250ZXh0
LT5nZW1fY29udGV4dDsKIAlpbnQgaSwgZXJyOwogCi0JaWYgKCFjdHgtPnJlbWFwX3NsaWNlKQor
CWlmICghY3R4IHx8ICFjdHgtPnJlbWFwX3NsaWNlKQogCQlyZXR1cm4gMDsKIAogCWZvciAoaSA9
IDA7IGkgPCBNQVhfTDNfU0xJQ0VTOyBpKyspIHsKQEAgLTE2MDEsNyArMTYwMSw3IEBAIHN0YXRp
YyBpbnQgc3dpdGNoX2NvbnRleHQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJCSAqIGlzIHB1
cmVseSB1c2VkIGZvciBmbHVzaGluZyB1c2VyIGNvbnRleHRzLgogCQkgKi8KIAkJaHdfZmxhZ3Mg
PSAwOwotCQlpZiAoaTkxNV9nZW1fY29udGV4dF9pc19rZXJuZWwocnEtPmNvbnRleHQtPmdlbV9j
b250ZXh0KSkKKwkJaWYgKCFycS0+Y29udGV4dC0+Z2VtX2NvbnRleHQpCiAJCQlod19mbGFncyA9
IE1JX1JFU1RPUkVfSU5ISUJJVDsKIAogCQlyZXQgPSBtaV9zZXRfY29udGV4dChycSwgaHdfZmxh
Z3MpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4
dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jCmluZGV4IGE1
Njg4ZjdkOTA3My4uZmNlMGVlMGMyZmRiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfY29udGV4dC5jCkBAIC02NywxNSArNjcsMTQgQEAgc3RhdGljIGludCBjb250ZXh0X3N5
bmMoc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogCXJldHVybiBlcnI7CiB9CiAKLXN0YXRpYyBp
bnQgX19saXZlX2NvbnRleHRfc2l6ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCi0J
CQkgICAgICAgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmZpeG1lKQorc3RhdGljIGludCBfX2xp
dmVfY29udGV4dF9zaXplKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKIAlzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CiAJdm9pZCAq
dmFkZHI7CiAJaW50IGVycjsKIAotCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZml4bWUsIGVu
Z2luZSk7CisJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUpOwogCWlmIChJU19FUlIo
Y2UpKQogCQlyZXR1cm4gUFRSX0VSUihjZSk7CiAKQEAgLTE0Myw3ICsxNDIsNiBAQCBzdGF0aWMg
aW50IGxpdmVfY29udGV4dF9zaXplKHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0
ID0gYXJnOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQlzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqZml4bWU7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAJaW50IGVyciA9
IDA7CiAKQEAgLTE1MiwxMCArMTUwLDYgQEAgc3RhdGljIGludCBsaXZlX2NvbnRleHRfc2l6ZSh2
b2lkICphcmcpCiAJICogSFcgdHJpZXMgdG8gd3JpdGUgcGFzdCB0aGUgZW5kIG9mIG9uZS4KIAkg
Ki8KIAotCWZpeG1lID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOwotCWlmIChJU19FUlIoZml4
bWUpKQotCQlyZXR1cm4gUFRSX0VSUihmaXhtZSk7Ci0KIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5l
LCBndCwgaWQpIHsKIAkJc3RydWN0IHsKIAkJCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpz
dGF0ZTsKQEAgLTE4MCw3ICsxNzQsNyBAQCBzdGF0aWMgaW50IGxpdmVfY29udGV4dF9zaXplKHZv
aWQgKmFyZykKIAkJLyogT3ZlcmxhcHMgd2l0aCB0aGUgZXhlY2xpc3RzIHJlZHpvbmUgKi8KIAkJ
ZW5naW5lLT5jb250ZXh0X3NpemUgKz0gSTkxNV9HVFRfUEFHRV9TSVpFOwogCi0JCWVyciA9IF9f
bGl2ZV9jb250ZXh0X3NpemUoZW5naW5lLCBmaXhtZSk7CisJCWVyciA9IF9fbGl2ZV9jb250ZXh0
X3NpemUoZW5naW5lKTsKIAogCQllbmdpbmUtPmNvbnRleHRfc2l6ZSAtPSBJOTE1X0dUVF9QQUdF
X1NJWkU7CiAKQEAgLTE5MywxMiArMTg3LDEwIEBAIHN0YXRpYyBpbnQgbGl2ZV9jb250ZXh0X3Np
emUodm9pZCAqYXJnKQogCQkJYnJlYWs7CiAJfQogCi0Ja2VybmVsX2NvbnRleHRfY2xvc2UoZml4
bWUpOwogCXJldHVybiBlcnI7CiB9CiAKLXN0YXRpYyBpbnQgX19saXZlX2FjdGl2ZV9jb250ZXh0
KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKLQkJCQkgc3RydWN0IGk5MTVfZ2VtX2Nv
bnRleHQgKmZpeG1lKQorc3RhdGljIGludCBfX2xpdmVfYWN0aXZlX2NvbnRleHQoc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewogCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAlp
bnQgcGFzczsKQEAgLTIyMywxMCArMjE1LDE1IEBAIHN0YXRpYyBpbnQgX19saXZlX2FjdGl2ZV9j
b250ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAkJcmV0dXJuIC1FSU5WQUw7
CiAJfQogCi0JY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShmaXhtZSwgZW5naW5lKTsKKwljZSA9
IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CiAJaWYgKElTX0VSUihjZSkpCiAJCXJldHVy
biBQVFJfRVJSKGNlKTsKIAorCS8qIFByZXRlbmQgdG8gYmUgYSB1c2VyIGNvbnRleHQgdG8gcGFy
dGFrZSBpbiBpZGxlIGJhcnJpZXJzICovCisJY2UtPmdlbV9jb250ZXh0ID0ga2VybmVsX2NvbnRl
eHQoZW5naW5lLT5pOTE1KTsKKwlpZiAoSVNfRVJSKGNlLT5nZW1fY29udGV4dCkpCisJCWdvdG8g
ZXJyX2NlOworCiAJZm9yIChwYXNzID0gMDsgcGFzcyA8PSAyOyBwYXNzKyspIHsKIAkJc3RydWN0
IGk5MTVfcmVxdWVzdCAqcnE7CiAKQEAgLTI3OSw2ICsyNzYsOCBAQCBzdGF0aWMgaW50IF9fbGl2
ZV9hY3RpdmVfY29udGV4dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJfQogCiBl
cnI6CisJa2VybmVsX2NvbnRleHRfY2xvc2UoY2UtPmdlbV9jb250ZXh0KTsKK2Vycl9jZToKIAlp
bnRlbF9jb250ZXh0X3B1dChjZSk7CiAJcmV0dXJuIGVycjsKIH0KQEAgLTI4Nyw3ICsyODYsNiBA
QCBzdGF0aWMgaW50IGxpdmVfYWN0aXZlX2NvbnRleHQodm9pZCAqYXJnKQogewogCXN0cnVjdCBp
bnRlbF9ndCAqZ3QgPSBhcmc7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCXN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpmaXhtZTsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsK
IAlzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGU7CiAJaW50IGVyciA9IDA7CkBAIC0yOTYsMTQgKzI5NCw4
IEBAIHN0YXRpYyBpbnQgbGl2ZV9hY3RpdmVfY29udGV4dCh2b2lkICphcmcpCiAJaWYgKElTX0VS
UihmaWxlKSkKIAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAKLQlmaXhtZSA9IGxpdmVfY29udGV4
dChndC0+aTkxNSwgZmlsZSk7Ci0JaWYgKElTX0VSUihmaXhtZSkpIHsKLQkJZXJyID0gUFRSX0VS
UihmaXhtZSk7Ci0JCWdvdG8gb3V0X2ZpbGU7Ci0JfQotCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2lu
ZSwgZ3QsIGlkKSB7Ci0JCWVyciA9IF9fbGl2ZV9hY3RpdmVfY29udGV4dChlbmdpbmUsIGZpeG1l
KTsKKwkJZXJyID0gX19saXZlX2FjdGl2ZV9jb250ZXh0KGVuZ2luZSk7CiAJCWlmIChlcnIpCiAJ
CQlicmVhazsKIApAQCAtMzEyLDcgKzMwNCw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9hY3RpdmVfY29u
dGV4dCh2b2lkICphcmcpCiAJCQlicmVhazsKIAl9CiAKLW91dF9maWxlOgogCW1vY2tfZmlsZV9w
dXQoZmlsZSk7CiAJcmV0dXJuIGVycjsKIH0KQEAgLTM0NSw4ICszMzYsNyBAQCBzdGF0aWMgaW50
IF9fcmVtb3RlX3N5bmMoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCBzdHJ1Y3QgaW50ZWxfY29u
dGV4dCAqcmVtb3RlKQogCXJldHVybiBlcnI7CiB9CiAKLXN0YXRpYyBpbnQgX19saXZlX3JlbW90
ZV9jb250ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKLQkJCQkgc3RydWN0IGk5
MTVfZ2VtX2NvbnRleHQgKmZpeG1lKQorc3RhdGljIGludCBfX2xpdmVfcmVtb3RlX2NvbnRleHQo
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewogCXN0cnVjdCBpbnRlbF9jb250ZXh0
ICpsb2NhbCwgKnJlbW90ZTsKIAlpbnQgcGFzczsKQEAgLTM2MCwxMSArMzUwLDE2IEBAIHN0YXRp
YyBpbnQgX19saXZlX3JlbW90ZV9jb250ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZSwKIAkgKiBjbG9iYmVyIHRoZSBpZGxlLWJhcnJpZXIuCiAJICovCiAKLQlyZW1vdGUgPSBpbnRl
bF9jb250ZXh0X2NyZWF0ZShmaXhtZSwgZW5naW5lKTsKKwlyZW1vdGUgPSBpbnRlbF9jb250ZXh0
X2NyZWF0ZShlbmdpbmUpOwogCWlmIChJU19FUlIocmVtb3RlKSkKIAkJcmV0dXJuIFBUUl9FUlIo
cmVtb3RlKTsKIAotCWxvY2FsID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZml4bWUsIGVuZ2luZSk7
CisJLyogUHJldGVuZCB0byBiZSBhIHVzZXIgY29udGV4dCB0byBwYXJ0YWtlIGluIGlkbGUgYmFy
cmllcnMgKi8KKwlyZW1vdGUtPmdlbV9jb250ZXh0ID0ga2VybmVsX2NvbnRleHQoZW5naW5lLT5p
OTE1KTsKKwlpZiAoSVNfRVJSKHJlbW90ZS0+Z2VtX2NvbnRleHQpKQorCQlnb3RvIGVycl9yZW1v
dGVfY2U7CisKKwlsb2NhbCA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CiAJaWYgKElT
X0VSUihsb2NhbCkpIHsKIAkJZXJyID0gUFRSX0VSUihsb2NhbCk7CiAJCWdvdG8gZXJyX3JlbW90
ZTsKQEAgLTM4OSw2ICszODQsOCBAQCBzdGF0aWMgaW50IF9fbGl2ZV9yZW1vdGVfY29udGV4dChz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAKIAlpbnRlbF9jb250ZXh0X3B1dChsb2Nh
bCk7CiBlcnJfcmVtb3RlOgorCWtlcm5lbF9jb250ZXh0X2Nsb3NlKHJlbW90ZS0+Z2VtX2NvbnRl
eHQpOworZXJyX3JlbW90ZV9jZToKIAlpbnRlbF9jb250ZXh0X3B1dChyZW1vdGUpOwogCXJldHVy
biBlcnI7CiB9CkBAIC0zOTcsNyArMzk0LDYgQEAgc3RhdGljIGludCBsaXZlX3JlbW90ZV9jb250
ZXh0KHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwogCXN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqZml4bWU7
CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAJc3RydWN0IGRybV9maWxlICpmaWxlOwogCWlu
dCBlcnIgPSAwOwpAQCAtNDA2LDE0ICs0MDIsOCBAQCBzdGF0aWMgaW50IGxpdmVfcmVtb3RlX2Nv
bnRleHQodm9pZCAqYXJnKQogCWlmIChJU19FUlIoZmlsZSkpCiAJCXJldHVybiBQVFJfRVJSKGZp
bGUpOwogCi0JZml4bWUgPSBsaXZlX2NvbnRleHQoZ3QtPmk5MTUsIGZpbGUpOwotCWlmIChJU19F
UlIoZml4bWUpKSB7Ci0JCWVyciA9IFBUUl9FUlIoZml4bWUpOwotCQlnb3RvIG91dF9maWxlOwot
CX0KLQogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgewotCQllcnIgPSBfX2xpdmVf
cmVtb3RlX2NvbnRleHQoZW5naW5lLCBmaXhtZSk7CisJCWVyciA9IF9fbGl2ZV9yZW1vdGVfY29u
dGV4dChlbmdpbmUpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAKQEAgLTQyMiw3ICs0MTIsNiBA
QCBzdGF0aWMgaW50IGxpdmVfcmVtb3RlX2NvbnRleHQodm9pZCAqYXJnKQogCQkJYnJlYWs7CiAJ
fQogCi1vdXRfZmlsZToKIAltb2NrX2ZpbGVfcHV0KGZpbGUpOwogCXJldHVybiBlcnI7CiB9CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVfaGVhcnRi
ZWF0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVfaGVhcnRiZWF0
LmMKaW5kZXggZjY2NWEwZTIzYzYxLi4yZmVlYWQ5YjQ0N2EgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9oZWFydGJlYXQuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdpbmVfaGVhcnRiZWF0LmMKQEAgLTE3Myw4ICsx
NzMsNyBAQCBzdGF0aWMgaW50IF9fbGl2ZV9oZWFydGJlYXRfZmFzdChzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmUpCiAJaW50IGVycjsKIAlpbnQgaTsKIAotCWNlID0gaW50ZWxfY29udGV4
dF9jcmVhdGUoZW5naW5lLT5rZXJuZWxfY29udGV4dC0+Z2VtX2NvbnRleHQsCi0JCQkJICBlbmdp
bmUpOworCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKIAlpZiAoSVNfRVJSKGNl
KSkKIAkJcmV0dXJuIFBUUl9FUlIoY2UpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Nl
bGZ0ZXN0X2hhbmdjaGVjay5jCmluZGV4IGNkYWFlZTQ0MzJiMi4uYmM3ZjA2ZTc5OTE2IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYwpAQCAtMzc3LDM2
ICszNzcsMzAgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfbm9wKHZvaWQgKmFyZykKIAlzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0ID0gYXJnOwogCXN0cnVjdCBpOTE1X2dwdV9lcnJvciAqZ2xvYmFsID0gJmd0
LT5pOTE1LT5ncHVfZXJyb3I7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCXN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CiAJdW5zaWduZWQgaW50IHJlc2V0X2NvdW50LCBj
b3VudDsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKLQlzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGU7
CiAJSUdUX1RJTUVPVVQoZW5kX3RpbWUpOwogCWludCBlcnIgPSAwOwogCiAJLyogQ2hlY2sgdGhh
dCB3ZSBjYW4gcmVzZXQgZHVyaW5nIG5vbi11c2VyIHBvcnRpb25zIG9mIHJlcXVlc3RzICovCiAK
LQlmaWxlID0gbW9ja19maWxlKGd0LT5pOTE1KTsKLQlpZiAoSVNfRVJSKGZpbGUpKQotCQlyZXR1
cm4gUFRSX0VSUihmaWxlKTsKLQotCWN0eCA9IGxpdmVfY29udGV4dChndC0+aTkxNSwgZmlsZSk7
Ci0JaWYgKElTX0VSUihjdHgpKSB7Ci0JCWVyciA9IFBUUl9FUlIoY3R4KTsKLQkJZ290byBvdXQ7
Ci0JfQotCi0JaTkxNV9nZW1fY29udGV4dF9jbGVhcl9iYW5uYWJsZShjdHgpOwogCXJlc2V0X2Nv
dW50ID0gaTkxNV9yZXNldF9jb3VudChnbG9iYWwpOwogCWNvdW50ID0gMDsKIAlkbyB7CiAJCWZv
cl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgeworCQkJc3RydWN0IGludGVsX2NvbnRleHQg
KmNlOwogCQkJaW50IGk7CiAKKwkJCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsK
KwkJCWlmIChJU19FUlIoY2UpKSB7CisJCQkJZXJyID0gUFRSX0VSUihjZSk7CisJCQkJYnJlYWs7
CisJCQl9CisKIAkJCWZvciAoaSA9IDA7IGkgPCAxNjsgaSsrKSB7CiAJCQkJc3RydWN0IGk5MTVf
cmVxdWVzdCAqcnE7CiAKLQkJCQlycSA9IGlndF9yZXF1ZXN0X2FsbG9jKGN0eCwgZW5naW5lKTsK
KwkJCQlycSA9IGludGVsX2NvbnRleHRfY3JlYXRlX3JlcXVlc3QoY2UpOwogCQkJCWlmIChJU19F
UlIocnEpKSB7CiAJCQkJCWVyciA9IFBUUl9FUlIocnEpOwogCQkJCQlicmVhazsKQEAgLTQxNCw2
ICs0MDgsOCBAQCBzdGF0aWMgaW50IGlndF9yZXNldF9ub3Aodm9pZCAqYXJnKQogCiAJCQkJaTkx
NV9yZXF1ZXN0X2FkZChycSk7CiAJCQl9CisKKwkJCWludGVsX2NvbnRleHRfcHV0KGNlKTsKIAkJ
fQogCiAJCWlndF9nbG9iYWxfcmVzZXRfbG9jayhndCk7CkBAIC00MzcsMTAgKzQzMyw3IEBAIHN0
YXRpYyBpbnQgaWd0X3Jlc2V0X25vcCh2b2lkICphcmcpCiAJfSB3aGlsZSAodGltZV9iZWZvcmUo
amlmZmllcywgZW5kX3RpbWUpKTsKIAlwcl9pbmZvKCIlczogJWQgcmVzZXRzXG4iLCBfX2Z1bmNf
XywgY291bnQpOwogCi0JZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpOwotb3V0OgotCW1v
Y2tfZmlsZV9wdXQoZmlsZSk7Ci0JaWYgKGludGVsX2d0X2lzX3dlZGdlZChndCkpCisJaWYgKGln
dF9mbHVzaF90ZXN0KGd0LT5pOTE1KSkKIAkJZXJyID0gLUVJTzsKIAlyZXR1cm4gZXJyOwogfQpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwppbmRleCA3ZDU3MTNlYTZiZGUuLmVj
OWRmYmNmMDIyMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
bHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKQEAgLTUz
LDExICs1MywxMCBAQCBzdGF0aWMgc3RydWN0IGk5MTVfdm1hICpjcmVhdGVfc2NyYXRjaChzdHJ1
Y3QgaW50ZWxfZ3QgKmd0KQogc3RhdGljIGludCBsaXZlX3Nhbml0eWNoZWNrKHZvaWQgKmFyZykK
IHsKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwotCXN0cnVjdCBpOTE1X2dlbV9lbmdpbmVz
X2l0ZXIgaXQ7Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKLQlzdHJ1Y3QgaW50ZWxf
Y29udGV4dCAqY2U7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOworCWVudW0gaW50
ZWxfZW5naW5lX2lkIGlkOwogCXN0cnVjdCBpZ3Rfc3Bpbm5lciBzcGluOwotCWludCBlcnIgPSAt
RU5PTUVNOworCWludCBlcnIgPSAwOwogCiAJaWYgKCFIQVNfTE9HSUNBTF9SSU5HX0NPTlRFWFRT
KGd0LT5pOTE1KSkKIAkJcmV0dXJuIDA7CkBAIC02NSwxNyArNjQsMjAgQEAgc3RhdGljIGludCBs
aXZlX3Nhbml0eWNoZWNrKHZvaWQgKmFyZykKIAlpZiAoaWd0X3NwaW5uZXJfaW5pdCgmc3Bpbiwg
Z3QpKQogCQlyZXR1cm4gLUVOT01FTTsKIAotCWN0eCA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1
KTsKLQlpZiAoIWN0eCkKLQkJZ290byBlcnJfc3BpbjsKLQotCWZvcl9lYWNoX2dlbV9lbmdpbmUo
Y2UsIGk5MTVfZ2VtX2NvbnRleHRfbG9ja19lbmdpbmVzKGN0eCksIGl0KSB7CisJZm9yX2VhY2hf
ZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7CisJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAkJ
c3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CiAKKwkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShl
bmdpbmUpOworCQlpZiAoSVNfRVJSKGNlKSkgeworCQkJZXJyID0gUFRSX0VSUihjZSk7CisJCQli
cmVhazsKKwkJfQorCiAJCXJxID0gaWd0X3NwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJnNwaW4sIGNl
LCBNSV9OT09QKTsKIAkJaWYgKElTX0VSUihycSkpIHsKIAkJCWVyciA9IFBUUl9FUlIocnEpOwot
CQkJZ290byBlcnJfY3R4OworCQkJZ290byBvdXRfY3R4OwogCQl9CiAKIAkJaTkxNV9yZXF1ZXN0
X2FkZChycSk7CkBAIC04NCwyMSArODYsMjEgQEAgc3RhdGljIGludCBsaXZlX3Nhbml0eWNoZWNr
KHZvaWQgKmFyZykKIAkJCUdFTV9UUkFDRV9EVU1QKCk7CiAJCQlpbnRlbF9ndF9zZXRfd2VkZ2Vk
KGd0KTsKIAkJCWVyciA9IC1FSU87Ci0JCQlnb3RvIGVycl9jdHg7CisJCQlnb3RvIG91dF9jdHg7
CiAJCX0KIAogCQlpZ3Rfc3Bpbm5lcl9lbmQoJnNwaW4pOwogCQlpZiAoaWd0X2ZsdXNoX3Rlc3Qo
Z3QtPmk5MTUpKSB7CiAJCQllcnIgPSAtRUlPOwotCQkJZ290byBlcnJfY3R4OworCQkJZ290byBv
dXRfY3R4OwogCQl9CisKK291dF9jdHg6CisJCWludGVsX2NvbnRleHRfcHV0KGNlKTsKKwkJaWYg
KGVycikKKwkJCWJyZWFrOwogCX0KIAotCWVyciA9IDA7Ci1lcnJfY3R4OgotCWk5MTVfZ2VtX2Nv
bnRleHRfdW5sb2NrX2VuZ2luZXMoY3R4KTsKLQlrZXJuZWxfY29udGV4dF9jbG9zZShjdHgpOwot
ZXJyX3NwaW46CiAJaWd0X3NwaW5uZXJfZmluaSgmc3Bpbik7CiAJcmV0dXJuIGVycjsKIH0KQEAg
LTE0NCw3ICsxNDYsNyBAQCBzdGF0aWMgaW50IGxpdmVfdW5saXRlX3Jlc3RvcmUoc3RydWN0IGlu
dGVsX2d0ICpndCwgaW50IHByaW8pCiAJCWZvciAobiA9IDA7IG4gPCBBUlJBWV9TSVpFKGNlKTsg
bisrKSB7CiAJCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqdG1wOwogCi0JCQl0bXAgPSBpbnRlbF9j
b250ZXh0X2NyZWF0ZShjdHgsIGVuZ2luZSk7CisJCQl0bXAgPSBpbnRlbF9jb250ZXh0X2NyZWF0
ZShlbmdpbmUpOwogCQkJaWYgKElTX0VSUih0bXApKSB7CiAJCQkJZXJyID0gUFRSX0VSUih0bXAp
OwogCQkJCWdvdG8gZXJyX2NlOwpAQCAtMzA5LDE3ICszMTEsMTcgQEAgZW1pdF9zZW1hcGhvcmVf
Y2hhaW4oc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsIHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCBpbnQg
aWR4KQogc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3QgKgogc2VtYXBob3JlX3F1ZXVlKHN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgc3RydWN0IGk5MTVfdm1hICp2bWEsIGludCBpZHgp
CiB7Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKKwlzdHJ1Y3QgaW50ZWxfY29udGV4
dCAqY2U7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CiAJaW50IGVycjsKIAotCWN0eCA9IGtl
cm5lbF9jb250ZXh0KGVuZ2luZS0+aTkxNSk7Ci0JaWYgKCFjdHgpCi0JCXJldHVybiBFUlJfUFRS
KC1FTk9NRU0pOworCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKKwlpZiAoSVNf
RVJSKGNlKSkKKwkJcmV0dXJuIEVSUl9DQVNUKGNlKTsKIAotCXJxID0gaWd0X3JlcXVlc3RfYWxs
b2MoY3R4LCBlbmdpbmUpOworCXJxID0gaW50ZWxfY29udGV4dF9jcmVhdGVfcmVxdWVzdChjZSk7
CiAJaWYgKElTX0VSUihycSkpCi0JCWdvdG8gb3V0X2N0eDsKKwkJZ290byBvdXRfY2U7CiAKIAll
cnIgPSAwOwogCWlmIChycS0+ZW5naW5lLT5lbWl0X2luaXRfYnJlYWRjcnVtYikKQEAgLTMzMiw4
ICszMzQsOCBAQCBzZW1hcGhvcmVfcXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5l
LCBzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgaW50IGlkeCkKIAlpZiAoZXJyKQogCQlycSA9IEVSUl9Q
VFIoZXJyKTsKIAotb3V0X2N0eDoKLQlrZXJuZWxfY29udGV4dF9jbG9zZShjdHgpOworb3V0X2Nl
OgorCWludGVsX2NvbnRleHRfcHV0KGNlKTsKIAlyZXR1cm4gcnE7CiB9CiAKQEAgLTIzOTIsMjcg
KzIzOTQsMTcgQEAgc3RhdGljIGludCBub3BfdmlydHVhbF9lbmdpbmUoc3RydWN0IGludGVsX2d0
ICpndCwKIHsKIAlJR1RfVElNRU9VVChlbmRfdGltZSk7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAq
cmVxdWVzdFsxNl07Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eFsxNl07CiAJc3RydWN0
IGludGVsX2NvbnRleHQgKnZlWzE2XTsKIAl1bnNpZ25lZCBsb25nIG4sIHByaW1lLCBuYzsKIAlz
dHJ1Y3QgaWd0X2xpdmVfdGVzdCB0OwogCWt0aW1lX3QgdGltZXNbMl0gPSB7fTsKIAlpbnQgZXJy
OwogCi0JR0VNX0JVR19PTighbmN0eCB8fCBuY3R4ID4gQVJSQVlfU0laRShjdHgpKTsKKwlHRU1f
QlVHX09OKCFuY3R4IHx8IG5jdHggPiBBUlJBWV9TSVpFKHZlKSk7CiAKIAlmb3IgKG4gPSAwOyBu
IDwgbmN0eDsgbisrKSB7Ci0JCWN0eFtuXSA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKLQkJ
aWYgKCFjdHhbbl0pIHsKLQkJCWVyciA9IC1FTk9NRU07Ci0JCQluY3R4ID0gbjsKLQkJCWdvdG8g
b3V0OwotCQl9Ci0KLQkJdmVbbl0gPSBpbnRlbF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1YWwoY3R4
W25dLAotCQkJCQkJICAgICAgIHNpYmxpbmdzLCBuc2libGluZyk7CisJCXZlW25dID0gaW50ZWxf
ZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFsKHNpYmxpbmdzLCBuc2libGluZyk7CiAJCWlmIChJU19F
UlIodmVbbl0pKSB7Ci0JCQlrZXJuZWxfY29udGV4dF9jbG9zZShjdHhbbl0pOwogCQkJZXJyID0g
UFRSX0VSUih2ZVtuXSk7CiAJCQluY3R4ID0gbjsKIAkJCWdvdG8gb3V0OwpAQCAtMjQyMSw3ICsy
NDEzLDYgQEAgc3RhdGljIGludCBub3BfdmlydHVhbF9lbmdpbmUoc3RydWN0IGludGVsX2d0ICpn
dCwKIAkJZXJyID0gaW50ZWxfY29udGV4dF9waW4odmVbbl0pOwogCQlpZiAoZXJyKSB7CiAJCQlp
bnRlbF9jb250ZXh0X3B1dCh2ZVtuXSk7Ci0JCQlrZXJuZWxfY29udGV4dF9jbG9zZShjdHhbbl0p
OwogCQkJbmN0eCA9IG47CiAJCQlnb3RvIG91dDsKIAkJfQpAQCAtMjUwMiw3ICsyNDkzLDYgQEAg
c3RhdGljIGludCBub3BfdmlydHVhbF9lbmdpbmUoc3RydWN0IGludGVsX2d0ICpndCwKIAlmb3Ig
KG5jID0gMDsgbmMgPCBuY3R4OyBuYysrKSB7CiAJCWludGVsX2NvbnRleHRfdW5waW4odmVbbmNd
KTsKIAkJaW50ZWxfY29udGV4dF9wdXQodmVbbmNdKTsKLQkJa2VybmVsX2NvbnRleHRfY2xvc2Uo
Y3R4W25jXSk7CiAJfQogCXJldHVybiBlcnI7CiB9CkBAIC0yNTYxLDcgKzI1NTEsNiBAQCBzdGF0
aWMgaW50IG1hc2tfdmlydHVhbF9lbmdpbmUoc3RydWN0IGludGVsX2d0ICpndCwKIAkJCSAgICAg
ICB1bnNpZ25lZCBpbnQgbnNpYmxpbmcpCiB7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVz
dFtNQVhfRU5HSU5FX0lOU1RBTkNFICsgMV07Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0
eDsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqdmU7CiAJc3RydWN0IGlndF9saXZlX3Rlc3QgdDsK
IAl1bnNpZ25lZCBpbnQgbjsKQEAgLTI1NzIsMTEgKzI1NjEsNyBAQCBzdGF0aWMgaW50IG1hc2tf
dmlydHVhbF9lbmdpbmUoc3RydWN0IGludGVsX2d0ICpndCwKIAkgKiByZXN0cmljdCBpdCB0byBv
dXIgZGVzaXJlZCBlbmdpbmUgd2l0aGluIHRoZSB2aXJ0dWFsIGVuZ2luZS4KIAkgKi8KIAotCWN0
eCA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKLQlpZiAoIWN0eCkKLQkJcmV0dXJuIC1FTk9N
RU07Ci0KLQl2ZSA9IGludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChjdHgsIHNpYmxpbmdz
LCBuc2libGluZyk7CisJdmUgPSBpbnRlbF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1YWwoc2libGlu
Z3MsIG5zaWJsaW5nKTsKIAlpZiAoSVNfRVJSKHZlKSkgewogCQllcnIgPSBQVFJfRVJSKHZlKTsK
IAkJZ290byBvdXRfY2xvc2U7CkBAIC0yNjQ0LDcgKzI2MjksNiBAQCBzdGF0aWMgaW50IG1hc2tf
dmlydHVhbF9lbmdpbmUoc3RydWN0IGludGVsX2d0ICpndCwKIG91dF9wdXQ6CiAJaW50ZWxfY29u
dGV4dF9wdXQodmUpOwogb3V0X2Nsb3NlOgotCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7CiAJ
cmV0dXJuIGVycjsKIH0KIApAQCAtMjY4NCw3ICsyNjY4LDYgQEAgc3RhdGljIGludCBwcmVzZXJ2
ZWRfdmlydHVhbF9lbmdpbmUoc3RydWN0IGludGVsX2d0ICpndCwKIAkJCQkgICAgdW5zaWduZWQg
aW50IG5zaWJsaW5nKQogewogCXN0cnVjdCBpOTE1X3JlcXVlc3QgKmxhc3QgPSBOVUxMOwotCXN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CiAJc3RydWN0IGludGVsX2NvbnRleHQgKnZlOwog
CXN0cnVjdCBpOTE1X3ZtYSAqc2NyYXRjaDsKIAlzdHJ1Y3QgaWd0X2xpdmVfdGVzdCB0OwpAQCAt
MjY5MiwxNyArMjY3NSwxMSBAQCBzdGF0aWMgaW50IHByZXNlcnZlZF92aXJ0dWFsX2VuZ2luZShz
dHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCWludCBlcnIgPSAwOwogCXUzMiAqY3M7CiAKLQljdHggPSBr
ZXJuZWxfY29udGV4dChndC0+aTkxNSk7Ci0JaWYgKCFjdHgpCi0JCXJldHVybiAtRU5PTUVNOwot
CiAJc2NyYXRjaCA9IGNyZWF0ZV9zY3JhdGNoKHNpYmxpbmdzWzBdLT5ndCk7Ci0JaWYgKElTX0VS
UihzY3JhdGNoKSkgewotCQllcnIgPSBQVFJfRVJSKHNjcmF0Y2gpOwotCQlnb3RvIG91dF9jbG9z
ZTsKLQl9CisJaWYgKElTX0VSUihzY3JhdGNoKSkKKwkJcmV0dXJuIFBUUl9FUlIoc2NyYXRjaCk7
CiAKLQl2ZSA9IGludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChjdHgsIHNpYmxpbmdzLCBu
c2libGluZyk7CisJdmUgPSBpbnRlbF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1YWwoc2libGluZ3Ms
IG5zaWJsaW5nKTsKIAlpZiAoSVNfRVJSKHZlKSkgewogCQllcnIgPSBQVFJfRVJSKHZlKTsKIAkJ
Z290byBvdXRfc2NyYXRjaDsKQEAgLTI3ODUsOCArMjc2Miw2IEBAIHN0YXRpYyBpbnQgcHJlc2Vy
dmVkX3ZpcnR1YWxfZW5naW5lKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCiAJaW50ZWxfY29udGV4dF9w
dXQodmUpOwogb3V0X3NjcmF0Y2g6CiAJaTkxNV92bWFfdW5waW5fYW5kX3JlbGVhc2UoJnNjcmF0
Y2gsIDApOwotb3V0X2Nsb3NlOgotCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7CiAJcmV0dXJu
IGVycjsKIH0KIApAQCAtMjg4MCw5ICsyODU1LDcgQEAgc3RhdGljIGludCBib25kX3ZpcnR1YWxf
ZW5naW5lKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCiAJCWZvciAobiA9IDA7IG4gPCBuc2libGluZzsg
bisrKSB7CiAJCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqdmU7CiAKLQkJCXZlID0gaW50ZWxfZXhl
Y2xpc3RzX2NyZWF0ZV92aXJ0dWFsKGN0eCwKLQkJCQkJCQkgICAgc2libGluZ3MsCi0JCQkJCQkJ
ICAgIG5zaWJsaW5nKTsKKwkJCXZlID0gaW50ZWxfZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFsKHNp
YmxpbmdzLCBuc2libGluZyk7CiAJCQlpZiAoSVNfRVJSKHZlKSkgewogCQkJCWVyciA9IFBUUl9F
UlIodmUpOwogCQkJCW9uc3RhY2tfZmVuY2VfZmluaSgmZmVuY2UpOwpAQCAtMzI3MCw4ICszMjQz
LDcgQEAgc3RhdGljIGludCBsaXZlX2xyY19maXhlZCh2b2lkICphcmcpCiAJcmV0dXJuIGVycjsK
IH0KIAotc3RhdGljIGludCBfX2xpdmVfbHJjX3N0YXRlKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0
ICpmaXhtZSwKLQkJCSAgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCitzdGF0aWMg
aW50IF9fbGl2ZV9scmNfc3RhdGUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCQkJ
ICAgIHN0cnVjdCBpOTE1X3ZtYSAqc2NyYXRjaCkKIHsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAq
Y2U7CkBAIC0zMjg2LDcgKzMyNTgsNyBAQCBzdGF0aWMgaW50IF9fbGl2ZV9scmNfc3RhdGUoc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKmZpeG1lLAogCWludCBlcnI7CiAJaW50IG47CiAKLQljZSA9
IGludGVsX2NvbnRleHRfY3JlYXRlKGZpeG1lLCBlbmdpbmUpOworCWNlID0gaW50ZWxfY29udGV4
dF9jcmVhdGUoZW5naW5lKTsKIAlpZiAoSVNfRVJSKGNlKSkKIAkJcmV0dXJuIFBUUl9FUlIoY2Up
OwogCkBAIC0zMzYwLDcgKzMzMzIsNiBAQCBzdGF0aWMgaW50IGxpdmVfbHJjX3N0YXRlKHZvaWQg
KmFyZykKIHsKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwogCXN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZTsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqZml4bWU7CiAJc3RydWN0
IGk5MTVfdm1hICpzY3JhdGNoOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwogCWludCBlcnIg
PSAwOwpAQCAtMzM3MCwxOCArMzM0MSwxMiBAQCBzdGF0aWMgaW50IGxpdmVfbHJjX3N0YXRlKHZv
aWQgKmFyZykKIAkgKiBpbnRlbF9jb250ZXh0LgogCSAqLwogCi0JZml4bWUgPSBrZXJuZWxfY29u
dGV4dChndC0+aTkxNSk7Ci0JaWYgKCFmaXhtZSkKLQkJcmV0dXJuIC1FTk9NRU07Ci0KIAlzY3Jh
dGNoID0gY3JlYXRlX3NjcmF0Y2goZ3QpOwotCWlmIChJU19FUlIoc2NyYXRjaCkpIHsKLQkJZXJy
ID0gUFRSX0VSUihzY3JhdGNoKTsKLQkJZ290byBvdXRfY2xvc2U7Ci0JfQorCWlmIChJU19FUlIo
c2NyYXRjaCkpCisJCXJldHVybiBQVFJfRVJSKHNjcmF0Y2gpOwogCiAJZm9yX2VhY2hfZW5naW5l
KGVuZ2luZSwgZ3QsIGlkKSB7Ci0JCWVyciA9IF9fbGl2ZV9scmNfc3RhdGUoZml4bWUsIGVuZ2lu
ZSwgc2NyYXRjaCk7CisJCWVyciA9IF9fbGl2ZV9scmNfc3RhdGUoZW5naW5lLCBzY3JhdGNoKTsK
IAkJaWYgKGVycikKIAkJCWJyZWFrOwogCX0KQEAgLTMzOTAsOCArMzM1NSw2IEBAIHN0YXRpYyBp
bnQgbGl2ZV9scmNfc3RhdGUodm9pZCAqYXJnKQogCQllcnIgPSAtRUlPOwogCiAJaTkxNV92bWFf
dW5waW5fYW5kX3JlbGVhc2UoJnNjcmF0Y2gsIDApOwotb3V0X2Nsb3NlOgotCWtlcm5lbF9jb250
ZXh0X2Nsb3NlKGZpeG1lKTsKIAlyZXR1cm4gZXJyOwogfQogCkBAIC0zNDI0LDggKzMzODcsNyBA
QCBzdGF0aWMgaW50IGdwcl9tYWtlX2RpcnR5KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZSkKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGludCBfX2xpdmVfZ3ByX2NsZWFyKHN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0ICpmaXhtZSwKLQkJCSAgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpl
bmdpbmUsCitzdGF0aWMgaW50IF9fbGl2ZV9ncHJfY2xlYXIoc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lLAogCQkJICAgIHN0cnVjdCBpOTE1X3ZtYSAqc2NyYXRjaCkKIHsKIAlzdHJ1Y3Qg
aW50ZWxfY29udGV4dCAqY2U7CkBAIC0zNDQxLDcgKzM0MDMsNyBAQCBzdGF0aWMgaW50IF9fbGl2
ZV9ncHJfY2xlYXIoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmZpeG1lLAogCWlmIChlcnIpCiAJ
CXJldHVybiBlcnI7CiAKLQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGZpeG1lLCBlbmdpbmUp
OworCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKIAlpZiAoSVNfRVJSKGNlKSkK
IAkJcmV0dXJuIFBUUl9FUlIoY2UpOwogCkBAIC0zNTAzLDcgKzM0NjUsNiBAQCBzdGF0aWMgaW50
IGxpdmVfZ3ByX2NsZWFyKHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJn
OwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqZml4bWU7CiAJc3RydWN0IGk5MTVfdm1hICpzY3JhdGNoOwogCWVudW0gaW50ZWxfZW5n
aW5lX2lkIGlkOwogCWludCBlcnIgPSAwOwpAQCAtMzUxMywxOCArMzQ3NCwxMiBAQCBzdGF0aWMg
aW50IGxpdmVfZ3ByX2NsZWFyKHZvaWQgKmFyZykKIAkgKiB0byBhdm9pZCBsZWFraW5nIGFueSBp
bmZvcm1hdGlvbiBmcm9tIHByZXZpb3VzIGNvbnRleHRzLgogCSAqLwogCi0JZml4bWUgPSBrZXJu
ZWxfY29udGV4dChndC0+aTkxNSk7Ci0JaWYgKCFmaXhtZSkKLQkJcmV0dXJuIC1FTk9NRU07Ci0K
IAlzY3JhdGNoID0gY3JlYXRlX3NjcmF0Y2goZ3QpOwotCWlmIChJU19FUlIoc2NyYXRjaCkpIHsK
LQkJZXJyID0gUFRSX0VSUihzY3JhdGNoKTsKLQkJZ290byBvdXRfY2xvc2U7Ci0JfQorCWlmIChJ
U19FUlIoc2NyYXRjaCkpCisJCXJldHVybiBQVFJfRVJSKHNjcmF0Y2gpOwogCiAJZm9yX2VhY2hf
ZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7Ci0JCWVyciA9IF9fbGl2ZV9ncHJfY2xlYXIoZml4bWUs
IGVuZ2luZSwgc2NyYXRjaCk7CisJCWVyciA9IF9fbGl2ZV9ncHJfY2xlYXIoZW5naW5lLCBzY3Jh
dGNoKTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCX0KQEAgLTM1MzMsOCArMzQ4OCw2IEBAIHN0
YXRpYyBpbnQgbGl2ZV9ncHJfY2xlYXIodm9pZCAqYXJnKQogCQllcnIgPSAtRUlPOwogCiAJaTkx
NV92bWFfdW5waW5fYW5kX3JlbGVhc2UoJnNjcmF0Y2gsIDApOwotb3V0X2Nsb3NlOgotCWtlcm5l
bF9jb250ZXh0X2Nsb3NlKGZpeG1lKTsKIAlyZXR1cm4gZXJyOwogfQogCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndnQvc2NoZWR1bGVyLmMKaW5kZXggMjI4YzY2NTM0ZTIxLi5iMzI5OWY4OGUyNGUgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVyLmMKQEAgLTM1LDEyICszNSwxMiBAQAogCiAjaW5j
bHVkZSA8bGludXgva3RocmVhZC5oPgogCi0jaW5jbHVkZSAiZ2VtL2k5MTVfZ2VtX2NvbnRleHQu
aCIKICNpbmNsdWRlICJnZW0vaTkxNV9nZW1fcG0uaCIKICNpbmNsdWRlICJndC9pbnRlbF9jb250
ZXh0LmgiCiAjaW5jbHVkZSAiZ3QvaW50ZWxfcmluZy5oIgogCiAjaW5jbHVkZSAiaTkxNV9kcnYu
aCIKKyNpbmNsdWRlICJpOTE1X2dlbV9ndHQuaCIKICNpbmNsdWRlICJndnQuaCIKIAogI2RlZmlu
ZSBSSU5HX0NUWF9PRkYoeCkgXApAQCAtMTIyMCwxNiArMTIyMCwxNCBAQCBpbnQgaW50ZWxfdmdw
dV9zZXR1cF9zdWJtaXNzaW9uKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQogCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gdmdwdS0+Z3Z0LT5kZXZfcHJpdjsKIAlzdHJ1Y3QgaW50ZWxf
dmdwdV9zdWJtaXNzaW9uICpzID0gJnZncHUtPnN1Ym1pc3Npb247CiAJc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lOwotCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CiAJc3RydWN0
IGk5MTVfcHBndHQgKnBwZ3R0OwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGk7CiAJaW50IHJldDsK
IAotCWN0eCA9IGk5MTVfZ2VtX2NvbnRleHRfY3JlYXRlX2tlcm5lbChpOTE1LCBJOTE1X1BSSU9S
SVRZX01BWCk7Ci0JaWYgKElTX0VSUihjdHgpKQotCQlyZXR1cm4gUFRSX0VSUihjdHgpOworCXBw
Z3R0ID0gaTkxNV9wcGd0dF9jcmVhdGUoaTkxNSk7CisJaWYgKElTX0VSUihwcGd0dCkpCisJCXJl
dHVybiBQVFJfRVJSKHBwZ3R0KTsKIAotCXBwZ3R0ID0gaTkxNV92bV90b19wcGd0dChpOTE1X2dl
bV9jb250ZXh0X2dldF92bV9yY3UoY3R4KSk7CiAJaTkxNV9jb250ZXh0X3BwZ3R0X3Jvb3Rfc2F2
ZShzLCBwcGd0dCk7CiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpKSB7CkBAIC0x
MjM4LDEyICsxMjM2LDE0IEBAIGludCBpbnRlbF92Z3B1X3NldHVwX3N1Ym1pc3Npb24oc3RydWN0
IGludGVsX3ZncHUgKnZncHUpCiAJCUlOSVRfTElTVF9IRUFEKCZzLT53b3JrbG9hZF9xX2hlYWRb
aV0pOwogCQlzLT5zaGFkb3dbaV0gPSBFUlJfUFRSKC1FSU5WQUwpOwogCi0JCWNlID0gaW50ZWxf
Y29udGV4dF9jcmVhdGUoY3R4LCBlbmdpbmUpOworCQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRl
KGVuZ2luZSk7CiAJCWlmIChJU19FUlIoY2UpKSB7CiAJCQlyZXQgPSBQVFJfRVJSKGNlKTsKIAkJ
CWdvdG8gb3V0X3NoYWRvd19jdHg7CiAJCX0KIAorCQlpOTE1X3ZtX3B1dChjZS0+dm0pOworCQlj
ZS0+dm0gPSBpOTE1X3ZtX2dldCgmcHBndHQtPnZtKTsKIAkJaW50ZWxfY29udGV4dF9zZXRfc2lu
Z2xlX3N1Ym1pc3Npb24oY2UpOwogCiAJCWlmICghVVNFU19HVUNfU1VCTUlTU0lPTihpOTE1KSkg
eyAvKiBNYXggcmluZyBidWZmZXIgc2l6ZSAqLwpAQCAtMTI3OCw3ICsxMjc4LDYgQEAgaW50IGlu
dGVsX3ZncHVfc2V0dXBfc3VibWlzc2lvbihzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAliaXRt
YXBfemVybyhzLT50bGJfaGFuZGxlX3BlbmRpbmcsIEk5MTVfTlVNX0VOR0lORVMpOwogCiAJaTkx
NV92bV9wdXQoJnBwZ3R0LT52bSk7Ci0JaTkxNV9nZW1fY29udGV4dF9wdXQoY3R4KTsKIAlyZXR1
cm4gMDsKIAogb3V0X3NoYWRvd19jdHg6CkBAIC0xMjkxLDcgKzEyOTAsNiBAQCBpbnQgaW50ZWxf
dmdwdV9zZXR1cF9zdWJtaXNzaW9uKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQogCQlpbnRlbF9j
b250ZXh0X3B1dChzLT5zaGFkb3dbaV0pOwogCX0KIAlpOTE1X3ZtX3B1dCgmcHBndHQtPnZtKTsK
LQlpOTE1X2dlbV9jb250ZXh0X3B1dChjdHgpOwogCXJldHVybiByZXQ7CiB9CiAKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2Rydi5oCmluZGV4IDdlMGY2N2JhYmUyMC4uN2U4YTAzOWU0ZjI4IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZHJ2LmgKQEAgLTk2MCw5ICs5NjAsNiBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSB7CiAKIAlzdHJ1Y3QgcGNpX2RldiAqYnJpZGdlX2RldjsKIAotCS8qIENvbnRleHQgdXNlZCBp
bnRlcm5hbGx5IHRvIGlkbGUgdGhlIEdQVSBhbmQgc2V0dXAgaW5pdGlhbCBzdGF0ZSAqLwotCXN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICprZXJuZWxfY29udGV4dDsKLQogCXN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZVtJOTE1X05VTV9FTkdJTkVTXTsKIAlzdHJ1Y3QgcmJfcm9vdCB1YWJp
X2VuZ2luZXM7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IGY0Y2JkMzc5ZGI5NS4uYjI0
ODI1YzY5MWY3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTEwNjMsOCArMTA2Myw3IEBA
IHN0YXRpYyBpbnQgX19pbnRlbF9lbmdpbmVzX3JlY29yZF9kZWZhdWx0cyhzdHJ1Y3QgaW50ZWxf
Z3QgKmd0KQogCQlHRU1fQlVHX09OKCFlbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKIAkJZW5naW5l
LT5zZXJpYWwrKzsgLyogZm9yY2UgdGhlIGtlcm5lbCBjb250ZXh0IHN3aXRjaCAqLwogCi0JCWNl
ID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lLT5rZXJuZWxfY29udGV4dC0+Z2VtX2NvbnRl
eHQsCi0JCQkJCSAgZW5naW5lKTsKKwkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUp
OwogCQlpZiAoSVNfRVJSKGNlKSkgewogCQkJZXJyID0gUFRSX0VSUihjZSk7CiAJCQlnb3RvIG91
dDsKQEAgLTEyMTcsNiArMTIxNiw3IEBAIGludCBpOTE1X2dlbV9pbml0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKIAl9CiAKIAlpbnRlbF9ndF9pbml0KCZkZXZfcHJpdi0+Z3Qp
OworCWk5MTVfZ2VtX2luaXRfY29udGV4dHMoZGV2X3ByaXYpOwogCiAJcmV0ID0gaW50ZWxfZW5n
aW5lc19zZXR1cCgmZGV2X3ByaXYtPmd0KTsKIAlpZiAocmV0KSB7CkBAIC0xMjI0LDE2ICsxMjI0
LDEwIEBAIGludCBpOTE1X2dlbV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dikKIAkJZ290byBlcnJfdW5sb2NrOwogCX0KIAotCXJldCA9IGk5MTVfZ2VtX2luaXRfY29udGV4
dHMoZGV2X3ByaXYpOwotCWlmIChyZXQpIHsKLQkJR0VNX0JVR19PTihyZXQgPT0gLUVJTyk7Ci0J
CWdvdG8gZXJyX3NjcmF0Y2g7Ci0JfQotCiAJcmV0ID0gaW50ZWxfZW5naW5lc19pbml0KCZkZXZf
cHJpdi0+Z3QpOwogCWlmIChyZXQpIHsKIAkJR0VNX0JVR19PTihyZXQgPT0gLUVJTyk7Ci0JCWdv
dG8gZXJyX2NvbnRleHQ7CisJCWdvdG8gZXJyX3NjcmF0Y2g7CiAJfQogCiAJaW50ZWxfdWNfaW5p
dCgmZGV2X3ByaXYtPmd0LnVjKTsKQEAgLTEyOTcsOSArMTI5MSw2IEBAIGludCBpOTE1X2dlbV9p
bml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJaW50ZWxfdWNfZmluaSgm
ZGV2X3ByaXYtPmd0LnVjKTsKIAkJaW50ZWxfZW5naW5lc19jbGVhbnVwKCZkZXZfcHJpdi0+Z3Qp
OwogCX0KLWVycl9jb250ZXh0OgotCWlmIChyZXQgIT0gLUVJTykKLQkJaTkxNV9nZW1fZHJpdmVy
X3JlbGVhc2VfX2NvbnRleHRzKGRldl9wcml2KTsKIGVycl9zY3JhdGNoOgogCWludGVsX2d0X2Ry
aXZlcl9yZWxlYXNlKCZkZXZfcHJpdi0+Z3QpOwogZXJyX3VubG9jazoKQEAgLTEzNjQsNyArMTM1
NSw2IEBAIHZvaWQgaTkxNV9nZW1fZHJpdmVyX3JlbW92ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCiB2b2lkIGk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNlKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKIHsKIAlpbnRlbF9lbmdpbmVzX2NsZWFudXAoJmRldl9wcml2
LT5ndCk7Ci0JaTkxNV9nZW1fZHJpdmVyX3JlbGVhc2VfX2NvbnRleHRzKGRldl9wcml2KTsKIAlp
bnRlbF9ndF9kcml2ZXJfcmVsZWFzZSgmZGV2X3ByaXYtPmd0KTsKIAogCWludGVsX3dhX2xpc3Rf
ZnJlZSgmZGV2X3ByaXYtPmd0X3dhX2xpc3QpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQu
YwppbmRleCA2MjM5YTlhZGJmMTQuLmEyMmEyZmU0MDljNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9nZW1fZ3R0LmMKQEAgLTEzNjMsMTIgKzEzNjMsOCBAQCBzdGF0aWMgaW50IGdlbjhfaW5pdF9z
Y3JhdGNoKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogCSAqIElmIGV2ZXJ5Ym9keSBh
Z3JlZXMgdG8gbm90IHRvIHdyaXRlIGludG8gdGhlIHNjcmF0Y2ggcGFnZSwKIAkgKiB3ZSBjYW4g
cmV1c2UgaXQgZm9yIGFsbCB2bSwga2VlcGluZyBjb250ZXh0cyBhbmQgcHJvY2Vzc2VzIHNlcGFy
YXRlLgogCSAqLwotCWlmICh2bS0+aGFzX3JlYWRfb25seSAmJgotCSAgICB2bS0+aTkxNS0+a2Vy
bmVsX2NvbnRleHQgJiYKLQkgICAgdm0tPmk5MTUtPmtlcm5lbF9jb250ZXh0LT52bSkgewotCQlz
dHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICpjbG9uZSA9Ci0JCQlyY3VfZGVyZWZlcmVuY2VfcHJv
dGVjdGVkKHZtLT5pOTE1LT5rZXJuZWxfY29udGV4dC0+dm0sCi0JCQkJCQkgIHRydWUpOyAvKiBz
dGF0aWMgKi8KKwlpZiAodm0tPmhhc19yZWFkX29ubHkgJiYgdm0tPmd0LT52bSAmJiAhaTkxNV9p
c19nZ3R0KHZtLT5ndC0+dm0pKSB7CisJCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKmNsb25l
ID0gdm0tPmd0LT52bTsKIAogCQlHRU1fQlVHX09OKCFjbG9uZS0+aGFzX3JlYWRfb25seSk7CiAK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKaW5kZXggMTkyNGQ0NDA4MWU5Li4yNWRiZDAxYjgyMmYg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCkBAIC0yMzQwLDkgKzIzNDAsNiBAQCBzdGF0aWMg
aW50IGxyY19jb25maWd1cmVfYWxsX2NvbnRleHRzKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpz
dHJlYW0sCiAJICovCiAJc3Bpbl9sb2NrKCZpOTE1LT5nZW0uY29udGV4dHMubG9jayk7CiAJbGlz
dF9mb3JfZWFjaF9lbnRyeV9zYWZlKGN0eCwgY24sICZpOTE1LT5nZW0uY29udGV4dHMubGlzdCwg
bGluaykgewotCQlpZiAoY3R4ID09IGk5MTUtPmtlcm5lbF9jb250ZXh0KQotCQkJY29udGludWU7
Ci0KIAkJaWYgKCFrcmVmX2dldF91bmxlc3NfemVybygmY3R4LT5yZWYpKQogCQkJY29udGludWU7
CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKaW5kZXggNjc4YjMyMDg5NTA3Li4yMGVl
ZWYzODY1NzcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCkBAIC0xMjM2LDggKzEy
MzYsOCBAQCB2b2lkIF9faTkxNV9yZXF1ZXN0X3F1ZXVlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
LAogCiB2b2lkIGk5MTVfcmVxdWVzdF9hZGQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7Ci0J
c3RydWN0IGk5MTVfc2NoZWRfYXR0ciBhdHRyID0gcnEtPmNvbnRleHQtPmdlbV9jb250ZXh0LT5z
Y2hlZDsKIAlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKiBjb25zdCB0bCA9IGk5MTVfcmVxdWVzdF90
aW1lbGluZShycSk7CisJc3RydWN0IGk5MTVfc2NoZWRfYXR0ciBhdHRyID0ge307CiAJc3RydWN0
IGk5MTVfcmVxdWVzdCAqcHJldjsKIAogCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnRsLT5tdXRleCk7
CkBAIC0xMjQ3LDYgKzEyNDcsOSBAQCB2b2lkIGk5MTVfcmVxdWVzdF9hZGQoc3RydWN0IGk5MTVf
cmVxdWVzdCAqcnEpCiAKIAlwcmV2ID0gX19pOTE1X3JlcXVlc3RfY29tbWl0KHJxKTsKIAorCWlm
IChycS0+Y29udGV4dC0+Z2VtX2NvbnRleHQpCisJCWF0dHIgPSBycS0+Y29udGV4dC0+Z2VtX2Nv
bnRleHQtPnNjaGVkOworCiAJLyoKIAkgKiBCb29zdCBhY3R1YWwgd29ya2xvYWRzIHBhc3Qgc2Vt
YXBob3JlcyEKIAkgKgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3Rz
L2k5MTVfcmVxdWVzdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcmVx
dWVzdC5jCmluZGV4IDdjNTZlZTM4Y2M1Yi4uMzViNTZmYzMwMDA2IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcmVxdWVzdC5jCkBAIC03NDEsMTAgKzc0MSw4IEBA
IHN0YXRpYyBpbnQgbGl2ZV9lbXB0eV9yZXF1ZXN0KHZvaWQgKmFyZykKIAogc3RhdGljIHN0cnVj
dCBpOTE1X3ZtYSAqcmVjdXJzaXZlX2JhdGNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQogewotCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHggPSBpOTE1LT5rZXJuZWxfY29udGV4
dDsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwogCWNvbnN0IGludCBnZW4gPSBJ
TlRFTF9HRU4oaTkxNSk7Ci0Jc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CiAJc3RydWN0
IGk5MTVfdm1hICp2bWE7CiAJdTMyICpjbWQ7CiAJaW50IGVycjsKQEAgLTc1Myw5ICs3NTEsNyBA
QCBzdGF0aWMgc3RydWN0IGk5MTVfdm1hICpyZWN1cnNpdmVfYmF0Y2goc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiAJaWYgKElTX0VSUihvYmopKQogCQlyZXR1cm4gRVJSX0NBU1Qob2Jq
KTsKIAotCXZtID0gaTkxNV9nZW1fY29udGV4dF9nZXRfdm1fcmN1KGN0eCk7Ci0Jdm1hID0gaTkx
NV92bWFfaW5zdGFuY2Uob2JqLCB2bSwgTlVMTCk7Ci0JaTkxNV92bV9wdXQodm0pOworCXZtYSA9
IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgaTkxNS0+Z3Qudm0sIE5VTEwpOwogCWlmIChJU19FUlIo
dm1hKSkgewogCQllcnIgPSBQVFJfRVJSKHZtYSk7CiAJCWdvdG8gZXJyOwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jCmluZGV4IGU1OGIwYmM5
Y2RiNi4uYTUzOWQ4YjM5NjgyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL21vY2tfZ2VtX2RldmljZS5jCkBAIC02Myw3ICs2Myw2IEBAIHN0YXRpYyB2b2lkIG1vY2tf
ZGV2aWNlX3JlbGVhc2Uoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAogCWZvcl9lYWNoX2VuZ2lu
ZShlbmdpbmUsICZpOTE1LT5ndCwgaWQpCiAJCW1vY2tfZW5naW5lX2ZyZWUoZW5naW5lKTsKLQlp
OTE1X2dlbV9kcml2ZXJfcmVsZWFzZV9fY29udGV4dHMoaTkxNSk7CiAKIAlkcmFpbl93b3JrcXVl
dWUoaTkxNS0+d3EpOwogCWk5MTVfZ2VtX2RyYWluX2ZyZWVkX29iamVjdHMoaTkxNSk7CkBAIC0x
NzksNiArMTc4LDcgQEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKm1vY2tfZ2VtX2RldmljZSh2
b2lkKQogCW1vY2tfaW5pdF9jb250ZXh0cyhpOTE1KTsKIAogCW1vY2tfaW5pdF9nZ3R0KGk5MTUs
ICZpOTE1LT5nZ3R0KTsKKwlpOTE1LT5ndC52bSA9IGk5MTVfdm1fZ2V0KCZpOTE1LT5nZ3R0LnZt
KTsKIAogCW1rd3JpdGVfZGV2aWNlX2luZm8oaTkxNSktPmVuZ2luZV9tYXNrID0gQklUKDApOwog
CkBAIC0xODYsMTAgKzE4Niw2IEBAIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICptb2NrX2dlbV9k
ZXZpY2Uodm9pZCkKIAlpZiAoIWk5MTUtPmVuZ2luZVtSQ1MwXSkKIAkJZ290byBlcnJfdW5sb2Nr
OwogCi0JaTkxNS0+a2VybmVsX2NvbnRleHQgPSBtb2NrX2NvbnRleHQoaTkxNSwgTlVMTCk7Ci0J
aWYgKCFpOTE1LT5rZXJuZWxfY29udGV4dCkKLQkJZ290byBlcnJfZW5naW5lOwotCiAJaWYgKG1v
Y2tfZW5naW5lX2luaXQoaTkxNS0+ZW5naW5lW1JDUzBdKSkKIAkJZ290byBlcnJfY29udGV4dDsK
IApAQCAtMTk4LDggKzE5NCw2IEBAIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICptb2NrX2dlbV9k
ZXZpY2Uodm9pZCkKIAlyZXR1cm4gaTkxNTsKIAogZXJyX2NvbnRleHQ6Ci0JaTkxNV9nZW1fZHJp
dmVyX3JlbGVhc2VfX2NvbnRleHRzKGk5MTUpOwotZXJyX2VuZ2luZToKIAltb2NrX2VuZ2luZV9m
cmVlKGk5MTUtPmVuZ2luZVtSQ1MwXSk7CiBlcnJfdW5sb2NrOgogCWRlc3Ryb3lfd29ya3F1ZXVl
KGk5MTUtPndxKTsKLS0gCjIuMjQuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGlu
Zm8vaW50ZWwtZ2Z4

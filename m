Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7A7BAAD93E
	for <lists+intel-gfx@lfdr.de>; Mon,  9 Sep 2019 14:41:02 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DA51C899D4;
	Mon,  9 Sep 2019 12:41:00 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 08AF489998
 for <intel-gfx@lists.freedesktop.org>; Mon,  9 Sep 2019 12:40:57 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga006.fm.intel.com ([10.253.24.20])
 by fmsmga104.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 09 Sep 2019 05:40:56 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,484,1559545200"; d="scan'208";a="384947509"
Received: from amyers-mobl.ger.corp.intel.com (HELO
 mwahaha-bdw.ger.corp.intel.com) ([10.252.30.4])
 by fmsmga006.fm.intel.com with ESMTP; 09 Sep 2019 05:40:55 -0700
From: Matthew Auld <matthew.auld@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  9 Sep 2019 13:40:52 +0100
Message-Id: <20190909124052.22900-3-matthew.auld@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190909124052.22900-1-matthew.auld@intel.com>
References: <20190909124052.22900-1-matthew.auld@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 3/3] drm/i915: cleanup cache-coloring
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VHJ5IHRvIHRpZHkgdXAgdGhlIGNhY2hlLWNvbG9yaW5nIHN1Y2ggdGhhdCB3ZSByaWQgdGhlIGNv
ZGUgb2YgYW55Cm1tLmNvbG9yX2FkanVzdCBhc3N1bXB0aW9ucywgdGhpcyBzaG91bGQgaG9wZWZ1
bGx5IG1ha2UgaXQgbW9yZSBvYnZpb3VzCmluIHRoZSBjb2RlIHdoZW4gd2UgbmVlZCB0byBhY3R1
YWxseSB1c2UgdGhlIGNhY2hlLWxldmVsIGFzIHRoZSBjb2xvciwKYW5kIGFzIGEgYm9udXMgc2hv
dWxkIG1ha2UgYWRkaW5nIGEgZGlmZmVyZW50IGNvbG9yLXNjaGVtZSBzaW1wbGVyLgoKU2lnbmVk
LW9mZi1ieTogTWF0dGhldyBBdWxkIDxtYXR0aGV3LmF1bGRAaW50ZWwuY29tPgpDYzogQ2hyaXMg
V2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBKb29uYXMgTGFodGluZW4gPGpv
b25hcy5sYWh0aW5lbkBsaW51eC5pbnRlbC5jb20+CkNjOiBSb2RyaWdvIFZpdmkgPHJvZHJpZ28u
dml2aUBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2Rv
bWFpbi5jICAgIHwgIDYgKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggICAg
ICAgICAgICAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ldmljdC5j
ICAgICAgICAgfCAxMiArKysrKy0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9n
dHQuaCAgICAgICAgICAgfCAgNiArKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEu
YyAgICAgICAgICAgICAgIHwgMjIgKysrKysrKysrLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV92bWEuaCAgICAgICAgICAgICAgIHwgIDIgKy0KIC4uLi9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMgICB8IDEwICsrKysrLS0tLQogNyBmaWxlcyBjaGFu
Z2VkLCAzNCBpbnNlcnRpb25zKCspLCAyNiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMKaW5kZXggNmFmNzQwYTVlM2RiLi5kYTNlN2NmMTJh
YTEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4u
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMKQEAgLTI5
NCw4ICsyOTQsMTAgQEAgaW50IGk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVfbGV2ZWwoc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJfQogCX0KIAotCWxpc3RfZm9yX2VhY2hfZW50
cnkodm1hLCAmb2JqLT52bWEubGlzdCwgb2JqX2xpbmspCi0JCXZtYS0+bm9kZS5jb2xvciA9IGNh
Y2hlX2xldmVsOworCWxpc3RfZm9yX2VhY2hfZW50cnkodm1hLCAmb2JqLT52bWEubGlzdCwgb2Jq
X2xpbmspIHsKKwkJaWYgKGk5MTVfdm1faGFzX2NhY2hlX2NvbG9yaW5nKHZtYS0+dm0pKQorCQkJ
dm1hLT5ub2RlLmNvbG9yID0gY2FjaGVfbGV2ZWw7CisJfQogCWk5MTVfZ2VtX29iamVjdF9zZXRf
Y2FjaGVfY29oZXJlbmN5KG9iaiwgY2FjaGVfbGV2ZWwpOwogCW9iai0+Y2FjaGVfZGlydHkgPSB0
cnVlOyAvKiBBbHdheXMgaW52YWxpZGF0ZSBzdGFsZSBjYWNoZWxpbmVzICovCiAKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2Rydi5oCmluZGV4IGRiNzQ4MDgzMWU1Mi4uZTI4OWI0ZmZkMzRiIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZHJ2LmgKQEAgLTIzNjQsNyArMjM2NCw3IEBAIGk5MTVfZ2VtX2NvbnRleHRfbG9v
a3VwKHN0cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGUgKmZpbGVfcHJpdiwgdTMyIGlkKQogLyog
aTkxNV9nZW1fZXZpY3QuYyAqLwogaW50IF9fbXVzdF9jaGVjayBpOTE1X2dlbV9ldmljdF9zb21l
dGhpbmcoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJCQkJCSAgdTY0IG1pbl9zaXpl
LCB1NjQgYWxpZ25tZW50LAotCQkJCQkgIHVuc2lnbmVkIGNhY2hlX2xldmVsLAorCQkJCQkgIHVu
c2lnbmVkIGxvbmcgY29sb3IsCiAJCQkJCSAgdTY0IHN0YXJ0LCB1NjQgZW5kLAogCQkJCQkgIHVu
c2lnbmVkIGZsYWdzKTsKIGludCBfX211c3RfY2hlY2sgaTkxNV9nZW1fZXZpY3RfZm9yX25vZGUo
c3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbV9ldmljdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1f
ZXZpY3QuYwppbmRleCA1MmM4NmM2ZTA2NzMuLmU3NmM5ZGE5OTkyZCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZXZpY3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbV9ldmljdC5jCkBAIC03MCw3ICs3MCw3IEBAIG1hcmtfZnJlZShzdHJ1Y3Qg
ZHJtX21tX3NjYW4gKnNjYW4sCiAgKiBAdm06IGFkZHJlc3Mgc3BhY2UgdG8gZXZpY3QgZnJvbQog
ICogQG1pbl9zaXplOiBzaXplIG9mIHRoZSBkZXNpcmVkIGZyZWUgc3BhY2UKICAqIEBhbGlnbm1l
bnQ6IGFsaWdubWVudCBjb25zdHJhaW50IG9mIHRoZSBkZXNpcmVkIGZyZWUgc3BhY2UKLSAqIEBj
YWNoZV9sZXZlbDogY2FjaGVfbGV2ZWwgZm9yIHRoZSBkZXNpcmVkIHNwYWNlCisgKiBAY29sb3I6
IGNvbG9yIGZvciB0aGUgZGVzaXJlZCBzcGFjZQogICogQHN0YXJ0OiBzdGFydCAoaW5jbHVzaXZl
KSBvZiB0aGUgcmFuZ2UgZnJvbSB3aGljaCB0byBldmljdCBvYmplY3RzCiAgKiBAZW5kOiBlbmQg
KGV4Y2x1c2l2ZSkgb2YgdGhlIHJhbmdlIGZyb20gd2hpY2ggdG8gZXZpY3Qgb2JqZWN0cwogICog
QGZsYWdzOiBhZGRpdGlvbmFsIGZsYWdzIHRvIGNvbnRyb2wgdGhlIGV2aWN0aW9uIGFsZ29yaXRo
bQpAQCAtOTEsNyArOTEsNyBAQCBtYXJrX2ZyZWUoc3RydWN0IGRybV9tbV9zY2FuICpzY2FuLAog
aW50CiBpOTE1X2dlbV9ldmljdF9zb21ldGhpbmcoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAq
dm0sCiAJCQkgdTY0IG1pbl9zaXplLCB1NjQgYWxpZ25tZW50LAotCQkJIHVuc2lnbmVkIGNhY2hl
X2xldmVsLAorCQkJIHVuc2lnbmVkIGxvbmcgY29sb3IsCiAJCQkgdTY0IHN0YXJ0LCB1NjQgZW5k
LAogCQkJIHVuc2lnbmVkIGZsYWdzKQogewpAQCAtMTI0LDcgKzEyNCw3IEBAIGk5MTVfZ2VtX2V2
aWN0X3NvbWV0aGluZyhzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAlpZiAoZmxhZ3Mg
JiBQSU5fTUFQUEFCTEUpCiAJCW1vZGUgPSBEUk1fTU1fSU5TRVJUX0xPVzsKIAlkcm1fbW1fc2Nh
bl9pbml0X3dpdGhfcmFuZ2UoJnNjYW4sICZ2bS0+bW0sCi0JCQkJICAgIG1pbl9zaXplLCBhbGln
bm1lbnQsIGNhY2hlX2xldmVsLAorCQkJCSAgICBtaW5fc2l6ZSwgYWxpZ25tZW50LCBjb2xvciwK
IAkJCQkgICAgc3RhcnQsIGVuZCwgbW9kZSk7CiAKIAkvKgpAQCAtMjY2LDcgKzI2Niw2IEBAIGlu
dCBpOTE1X2dlbV9ldmljdF9mb3Jfbm9kZShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwK
IAl1NjQgc3RhcnQgPSB0YXJnZXQtPnN0YXJ0OwogCXU2NCBlbmQgPSBzdGFydCArIHRhcmdldC0+
c2l6ZTsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgKm5leHQ7Ci0JYm9vbCBjaGVja19jb2xvcjsK
IAlpbnQgcmV0ID0gMDsKIAogCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5pOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKQEAgLTI4Myw4ICsyODIsNyBAQCBpbnQgaTkxNV9nZW1fZXZpY3RfZm9yX25v
ZGUoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJaWYgKCEoZmxhZ3MgJiBQSU5fTk9O
QkxPQ0spKQogCQlpOTE1X3JldGlyZV9yZXF1ZXN0cyh2bS0+aTkxNSk7CiAKLQljaGVja19jb2xv
ciA9IHZtLT5tbS5jb2xvcl9hZGp1c3Q7Ci0JaWYgKGNoZWNrX2NvbG9yKSB7CisJaWYgKGk5MTVf
dm1faGFzX2NhY2hlX2NvbG9yaW5nKHZtKSkgewogCQkvKiBFeHBhbmQgc2VhcmNoIHRvIGNvdmVy
IG5laWdoYm91cmluZyBndWFyZCBwYWdlcyAob3IgbGFjayEpICovCiAJCWlmIChzdGFydCkKIAkJ
CXN0YXJ0IC09IEk5MTVfR1RUX1BBR0VfU0laRTsKQEAgLTMxMCw3ICszMDgsNyBAQCBpbnQgaTkx
NV9nZW1fZXZpY3RfZm9yX25vZGUoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJCSAq
IGFidXR0IGFuZCBjb25mbGljdC4gSWYgdGhleSBhcmUgaW4gY29uZmxpY3QsIHRoZW4gd2UgZXZp
Y3QKIAkJICogdGhvc2UgYXMgd2VsbCB0byBtYWtlIHJvb20gZm9yIG91ciBndWFyZCBwYWdlcy4K
IAkJICovCi0JCWlmIChjaGVja19jb2xvcikgeworCQlpZiAoaTkxNV92bV9oYXNfY2FjaGVfY29s
b3Jpbmcodm0pKSB7CiAJCQlpZiAobm9kZS0+c3RhcnQgKyBub2RlLT5zaXplID09IHRhcmdldC0+
c3RhcnQpIHsKIAkJCQlpZiAobm9kZS0+Y29sb3IgPT0gdGFyZ2V0LT5jb2xvcikKIAkJCQkJY29u
dGludWU7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaCBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oCmluZGV4IDA3Yzg1YzEzNGQ0Yy4u
MjAxNzg4MTI2YTg5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9n
dHQuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaApAQCAtMzc2LDYg
KzM3NiwxMiBAQCBpOTE1X3ZtX2hhc19zY3JhdGNoXzY0SyhzdHJ1Y3QgaTkxNV9hZGRyZXNzX3Nw
YWNlICp2bSkKIAlyZXR1cm4gdm0tPnNjcmF0Y2hfb3JkZXIgPT0gZ2V0X29yZGVyKEk5MTVfR1RU
X1BBR0VfU0laRV82NEspOwogfQogCitzdGF0aWMgaW5saW5lIGJvb2wKK2k5MTVfdm1faGFzX2Nh
Y2hlX2NvbG9yaW5nKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQoreworCXJldHVybiBp
OTE1X2lzX2dndHQodm0pICYmIHZtLT5tbS5jb2xvcl9hZGp1c3Q7Cit9CisKIC8qIFRoZSBHcmFw
aGljcyBUcmFuc2xhdGlvbiBUYWJsZSBpcyB0aGUgd2F5IGluIHdoaWNoIEdFTiBoYXJkd2FyZSB0
cmFuc2xhdGVzIGEKICAqIEdyYXBoaWNzIFZpcnR1YWwgQWRkcmVzcyBpbnRvIGEgUGh5c2ljYWwg
QWRkcmVzcy4gSW4gYWRkaXRpb24gdG8gdGhlIG5vcm1hbAogICogY29sbGF0ZXJhbCBhc3NvY2lh
dGVkIHdpdGggYW55IHZhLT5wYSB0cmFuc2xhdGlvbnMgR0VOIGhhcmR3YXJlIGFsc28gaGFzIGEK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3ZtYS5jCmluZGV4IGE5MGJkMjY3ODM1My4uNjhkOWY5YjRkMDUwIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKQEAgLTQ3Nyw3ICs0NzcsNyBAQCB2b2lkIF9faTkxNV92
bWFfc2V0X21hcF9hbmRfZmVuY2VhYmxlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCQl2bWEtPmZs
YWdzICY9IH5JOTE1X1ZNQV9DQU5fRkVOQ0U7CiB9CiAKLWJvb2wgaTkxNV9nZW1fdmFsaWRfZ3R0
X3NwYWNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1bnNpZ25lZCBsb25nIGNhY2hlX2xldmVsKQor
Ym9vbCBpOTE1X2dlbV92YWxpZF9ndHRfc3BhY2Uoc3RydWN0IGk5MTVfdm1hICp2bWEsIHVuc2ln
bmVkIGxvbmcgY29sb3IpCiB7CiAJc3RydWN0IGRybV9tbV9ub2RlICpub2RlID0gJnZtYS0+bm9k
ZTsKIAlzdHJ1Y3QgZHJtX21tX25vZGUgKm90aGVyOwpAQCAtNDg5LDcgKzQ4OSw3IEBAIGJvb2wg
aTkxNV9nZW1fdmFsaWRfZ3R0X3NwYWNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1bnNpZ25lZCBs
b25nIGNhY2hlX2xldmVsKQogCSAqIHRoZXNlIGNvbnN0cmFpbnRzIGFwcGx5IGFuZCBzZXQgdGhl
IGRybV9tbS5jb2xvcl9hZGp1c3QKIAkgKiBhcHByb3ByaWF0ZWx5LgogCSAqLwotCWlmICh2bWEt
PnZtLT5tbS5jb2xvcl9hZGp1c3QgPT0gTlVMTCkKKwlpZiAoIWk5MTVfdm1faGFzX2NhY2hlX2Nv
bG9yaW5nKHZtYS0+dm0pKQogCQlyZXR1cm4gdHJ1ZTsKIAogCS8qIE9ubHkgdmFsaWQgdG8gYmUg
Y2FsbGVkIG9uIGFuIGFscmVhZHkgaW5zZXJ0ZWQgdm1hICovCkBAIC00OTcsMTIgKzQ5NywxMiBA
QCBib29sIGk5MTVfZ2VtX3ZhbGlkX2d0dF9zcGFjZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdW5z
aWduZWQgbG9uZyBjYWNoZV9sZXZlbCkKIAlHRU1fQlVHX09OKGxpc3RfZW1wdHkoJm5vZGUtPm5v
ZGVfbGlzdCkpOwogCiAJb3RoZXIgPSBsaXN0X3ByZXZfZW50cnkobm9kZSwgbm9kZV9saXN0KTsK
LQlpZiAoaTkxNV9ub2RlX2NvbG9yX2RpZmZlcnMob3RoZXIsIGNhY2hlX2xldmVsKSAmJgorCWlm
IChpOTE1X25vZGVfY29sb3JfZGlmZmVycyhvdGhlciwgY29sb3IpICYmCiAJICAgICFkcm1fbW1f
aG9sZV9mb2xsb3dzKG90aGVyKSkKIAkJcmV0dXJuIGZhbHNlOwogCiAJb3RoZXIgPSBsaXN0X25l
eHRfZW50cnkobm9kZSwgbm9kZV9saXN0KTsKLQlpZiAoaTkxNV9ub2RlX2NvbG9yX2RpZmZlcnMo
b3RoZXIsIGNhY2hlX2xldmVsKSAmJgorCWlmIChpOTE1X25vZGVfY29sb3JfZGlmZmVycyhvdGhl
ciwgY29sb3IpICYmCiAJICAgICFkcm1fbW1faG9sZV9mb2xsb3dzKG5vZGUpKQogCQlyZXR1cm4g
ZmFsc2U7CiAKQEAgLTUzOSw3ICs1MzksNyBAQCBzdGF0aWMgaW50CiBpOTE1X3ZtYV9pbnNlcnQo
c3RydWN0IGk5MTVfdm1hICp2bWEsIHU2NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3Mp
CiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdm1hLT52bS0+aTkxNTsK
LQl1bnNpZ25lZCBpbnQgY2FjaGVfbGV2ZWw7CisJdW5zaWduZWQgbG9uZyBjb2xvcjsKIAl1NjQg
c3RhcnQsIGVuZDsKIAlpbnQgcmV0OwogCkBAIC01ODAsMTQgKzU4MCwxNCBAQCBpOTE1X3ZtYV9p
bnNlcnQoc3RydWN0IGk5MTVfdm1hICp2bWEsIHU2NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQg
ZmxhZ3MpCiAJCXJldHVybiAtRU5PU1BDOwogCX0KIAorCWNvbG9yID0gMDsKIAlpZiAodm1hLT5v
YmopIHsKIAkJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9wYWdlcyh2bWEtPm9iaik7CiAJCWlm
IChyZXQpCiAJCQlyZXR1cm4gcmV0OwogCi0JCWNhY2hlX2xldmVsID0gdm1hLT5vYmotPmNhY2hl
X2xldmVsOwotCX0gZWxzZSB7Ci0JCWNhY2hlX2xldmVsID0gMDsKKwkJaWYgKGk5MTVfdm1faGFz
X2NhY2hlX2NvbG9yaW5nKHZtYS0+dm0pKQorCQkJY29sb3IgPSB2bWEtPm9iai0+Y2FjaGVfbGV2
ZWw7CiAJfQogCiAJR0VNX0JVR19PTih2bWEtPnBhZ2VzKTsKQEAgLTYwNSw3ICs2MDUsNyBAQCBp
OTE1X3ZtYV9pbnNlcnQoc3RydWN0IGk5MTVfdm1hICp2bWEsIHU2NCBzaXplLCB1NjQgYWxpZ25t
ZW50LCB1NjQgZmxhZ3MpCiAJCX0KIAogCQlyZXQgPSBpOTE1X2dlbV9ndHRfcmVzZXJ2ZSh2bWEt
PnZtLCAmdm1hLT5ub2RlLAotCQkJCQkgICBzaXplLCBvZmZzZXQsIGNhY2hlX2xldmVsLAorCQkJ
CQkgICBzaXplLCBvZmZzZXQsIGNvbG9yLAogCQkJCQkgICBmbGFncyk7CiAJCWlmIChyZXQpCiAJ
CQlnb3RvIGVycl9jbGVhcjsKQEAgLTY0NCw3ICs2NDQsNyBAQCBpOTE1X3ZtYV9pbnNlcnQoc3Ry
dWN0IGk5MTVfdm1hICp2bWEsIHU2NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3MpCiAJ
CX0KIAogCQlyZXQgPSBpOTE1X2dlbV9ndHRfaW5zZXJ0KHZtYS0+dm0sICZ2bWEtPm5vZGUsCi0J
CQkJCSAgc2l6ZSwgYWxpZ25tZW50LCBjYWNoZV9sZXZlbCwKKwkJCQkJICBzaXplLCBhbGlnbm1l
bnQsIGNvbG9yLAogCQkJCQkgIHN0YXJ0LCBlbmQsIGZsYWdzKTsKIAkJaWYgKHJldCkKIAkJCWdv
dG8gZXJyX2NsZWFyOwpAQCAtNjUzLDcgKzY1Myw3IEBAIGk5MTVfdm1hX2luc2VydChzdHJ1Y3Qg
aTkxNV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncykKIAkJR0VN
X0JVR19PTih2bWEtPm5vZGUuc3RhcnQgKyB2bWEtPm5vZGUuc2l6ZSA+IGVuZCk7CiAJfQogCUdF
TV9CVUdfT04oIWRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5ub2RlKSk7Ci0JR0VNX0JVR19P
TighaTkxNV9nZW1fdmFsaWRfZ3R0X3NwYWNlKHZtYSwgY2FjaGVfbGV2ZWwpKTsKKwlHRU1fQlVH
X09OKCFpOTE1X2dlbV92YWxpZF9ndHRfc3BhY2Uodm1hLCBjb2xvcikpOwogCiAJbXV0ZXhfbG9j
aygmdm1hLT52bS0+bXV0ZXgpOwogCWxpc3RfbW92ZV90YWlsKCZ2bWEtPnZtX2xpbmssICZ2bWEt
PnZtLT5ib3VuZF9saXN0KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
dm1hLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5oCmluZGV4IDViMWUwY2Y3NjY5
ZC4uNDI1YmRhNGRiMmMyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Zt
YS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmgKQEAgLTI5NSw3ICsyOTUs
NyBAQCBpOTE1X3ZtYV9jb21wYXJlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCiBpbnQgaTkxNV92
bWFfYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgZW51bSBpOTE1X2NhY2hlX2xldmVsIGNhY2hl
X2xldmVsLAogCQkgIHUzMiBmbGFncyk7Ci1ib29sIGk5MTVfZ2VtX3ZhbGlkX2d0dF9zcGFjZShz
dHJ1Y3QgaTkxNV92bWEgKnZtYSwgdW5zaWduZWQgbG9uZyBjYWNoZV9sZXZlbCk7Citib29sIGk5
MTVfZ2VtX3ZhbGlkX2d0dF9zcGFjZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdW5zaWduZWQgbG9u
ZyBjb2xvcik7CiBib29sIGk5MTVfdm1hX21pc3BsYWNlZChjb25zdCBzdHJ1Y3QgaTkxNV92bWEg
KnZtYSwKIAkJCXU2NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3MpOwogdm9pZCBfX2k5
MTVfdm1hX3NldF9tYXBfYW5kX2ZlbmNlYWJsZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5jCmluZGV4IGZj
YTM4MTY3YmRjZS4uMjkwNWZiMjFkODY2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYwpAQCAtMjc0LDEyICsyNzQsMTQgQEAgc3RhdGljIGlu
dCBpZ3RfZXZpY3RfZm9yX2NhY2hlX2NvbG9yKHZvaWQgKmFyZykKIAlMSVNUX0hFQUQob2JqZWN0
cyk7CiAJaW50IGVycjsKIAotCS8qIEN1cnJlbnRseSB0aGUgdXNlIG9mIGNvbG9yX2FkanVzdCBp
cyBsaW1pdGVkIHRvIGNhY2hlIGRvbWFpbnMgd2l0aGluCi0JICogdGhlIGdndHQsIGFuZCBzbyB0
aGUgcHJlc2VuY2Ugb2YgbW0uY29sb3JfYWRqdXN0IGlzIGFzc3VtZWQgdG8gYmUKLQkgKiBpOTE1
X2dndHRfY29sb3JfYWRqdXN0IHRocm91Z2hvdXQgb3VyIGRyaXZlciwgc28gdXNpbmcgYSBtb2Nr
IGNvbG9yCi0JICogYWRqdXN0IHdpbGwgd29yayBqdXN0IGZpbmUgZm9yIG91ciBwdXJwb3Nlcy4K
KwkvKgorCSAqIEN1cnJlbnRseSB0aGUgdXNlIG9mIGNvbG9yX2FkanVzdCBmb3IgdGhlIEdHVFQg
aXMgbGltaXRlZCB0byBjYWNoZQorCSAqIGNvbG9yaW5nIGFuZCBndWFyZCBwYWdlcywgYW5kIHNv
IHRoZSBwcmVzZW5jZSBvZiBtbS5jb2xvcl9hZGp1c3QgZm9yCisJICogdGhlIEdHVFQgaXMgYXNz
dW1lZCB0byBiZSBpOTE1X2dndHRfY29sb3JfYWRqdXN0LCBoZW5jZSB1c2luZyBhIG1vY2sKKwkg
KiBjb2xvciBhZGp1c3Qgd2lsbCB3b3JrIGp1c3QgZmluZSBmb3Igb3VyIHB1cnBvc2VzLgogCSAq
LwogCWdndHQtPnZtLm1tLmNvbG9yX2FkanVzdCA9IG1vY2tfY29sb3JfYWRqdXN0OworCUdFTV9C
VUdfT04oIWk5MTVfdm1faGFzX2NhY2hlX2NvbG9yaW5nKCZnZ3R0LT52bSkpOwogCiAJb2JqID0g
aTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChpOTE1LCBJOTE1X0dUVF9QQUdFX1NJWkUp
OwogCWlmIChJU19FUlIob2JqKSkgewotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdm
eEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFp
bG1hbi9saXN0aW5mby9pbnRlbC1nZng=

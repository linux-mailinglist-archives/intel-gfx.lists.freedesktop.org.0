Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 75F971BE6B1
	for <lists+intel-gfx@lfdr.de>; Wed, 29 Apr 2020 20:55:15 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 99D6D6EADF;
	Wed, 29 Apr 2020 18:55:13 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 73B4A6EADF
 for <intel-gfx@lists.freedesktop.org>; Wed, 29 Apr 2020 18:55:12 +0000 (UTC)
IronPort-SDR: 6trju43c25oRhiSR+9DSfaxq3YZwpyXUFJNnTPX/t6edQ6L5Jo0UlWc9syp1QUonVfc0vwJmGL
 vfXvU5Qg9NdA==
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by fmsmga104.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 29 Apr 2020 11:55:12 -0700
IronPort-SDR: Y66hRemfVbTbP3/ASLZT0/Ke7zDMBW+bmrqS61+728DQ/3RSvQ5C7h9yvKhO4BXSeGKiZAnfsP
 2l0t04iTy0Hw==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.73,333,1583222400"; d="scan'208";a="248065308"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by fmsmga007.fm.intel.com with SMTP; 29 Apr 2020 11:55:04 -0700
Received: by stinkbox (sSMTP sendmail emulation);
 Wed, 29 Apr 2020 21:55:03 +0300
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 29 Apr 2020 21:54:57 +0300
Message-Id: <20200429185457.26235-3-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.24.1
In-Reply-To: <20200429185457.26235-1-ville.syrjala@linux.intel.com>
References: <20200429185457.26235-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 3/3] drm/i915: Streamline the artihmetic
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KCkFs
bCB0aGVzZSBST1VORElORF9GQUNUT1JzIGFuZCB3aGF0bm90IGFyZSBtYWtpbmcgdGhpcyB0aGlu
ZyBoYXJkIHRvCnJlYWQuIEdldCByaWQgb2YgdGhlbS4gQW5kIGxldCdzIG1hc3NhZ2Ugc29tZSBv
ZiB0aGUgZnJhY3Rpb25zIHRvCmdpdmUgdXMgbGVzcyBxdWVzdGlvbmFibGUgaW50ZXJtZWRpYXRl
IHJlc3VsdHMgYW5kIHBlcmhhcHMgbGVzcwpkaXZpc2lvbnMuCgpBbHNvIGxvb2tzIGxpa2UgYSBn
b29kIGhlbHBpbmcgb2YgNjRiaXQgbWF0aCBzdHVmZiBpcyBuZWVkZWQgdG8KYXZvaWQgc29tZSBv
ZiBvdmVyZmxvd3MgcHJlc2VudCBpbiB0aGUgY3VycmVudCBjb2RlLiBUaGVyZQptaWdodCBzdGls
bCBiZSBhIGZldyBvdmVyZmxvd3MsIG5hbWVseSB3aGVuIGNhbGN1bGF0aW5nCmxpbmtfY2xrc19h
dmFpbGFibGUvc2FtcGxlc19yb29tICh3b3VsZCByZXF1aXJlIGEgaHVnZSBoYmxhbmsKdGhvdWdo
KSwgYW5kIHBvdGVudGlhbGx5IHdoZW4gY2FsY3VsYXRpbmcgaGJsYW5rX3Jpc2UgKG5vdCBzdXJl
CmhvdyBsYXJnZSBsaW5rX2Nsa3NfYWN0aXZlIGNhbiBnZXQpLgoKSXQgbG9va3MgbGlrZSB3ZSdy
ZSBzdGlsbCBub3QgY2FsY3VsYXRpbmcgZXhhY3RseSB3aGF0IHRoZSBzcGVjIHNheXMKc2luY2Ug
d2UgdHJ1bmNhdGUgdHVfZGF0YSBhbmQgdHVfbGluZSBlYXJseS4gQnV0IEknbSB0b28gbGF6eSB0
bwpmaWd1cmUgb3V0IGlmIHdlIGNvdWxkIGF2b2lkIHRoYXQuCgpDYzogQW5zaHVtYW4gR3VwdGEg
PGFuc2h1bWFuLmd1cHRhQGludGVsLmNvbT4KQ2M6IFVtYSBTaGFua2FyIDx1bWEuc2hhbmthckBp
bnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBs
aW51eC5pbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9h
dWRpby5jIHwgNTQgKysrKysrKystLS0tLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDE5IGlu
c2VydGlvbnMoKyksIDM1IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXVkaW8uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfYXVkaW8uYwppbmRleCAwMGY3YTNjZjlhMDQuLjA1Y2FiNTA4YzYyNiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdWRpby5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXVkaW8uYwpAQCAtNTE3LDE2ICs1MTcs
MTYgQEAgc3RhdGljIHZvaWQgaHN3X2F1ZGlvX2NvZGVjX2Rpc2FibGUoc3RydWN0IGludGVsX2Vu
Y29kZXIgKmVuY29kZXIsCiAvKiBBZGQgYSBmYWN0b3IgdG8gdGFrZSBjYXJlIG9mIHJvdW5kaW5n
IGFuZCB0cnVuY2F0aW9ucyAqLwogI2RlZmluZSBST1VORElOR19GQUNUT1IgMTAwMDAKIAotc3Rh
dGljIHVuc2lnbmVkIGludCBnZXRfaGJsYW5rX2Vhcmx5X2VuYWJsZV9jb25maWcoc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXIsCi0JCQkJCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSkKK3N0YXRpYyB1bnNpZ25lZCBpbnQgY2FsY19oYmxhbmtfZWFybHlf
cHJvZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKKwkJCQkJICAgY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAl1bnNpZ25lZCBpbnQgbGlu
a19jbGtzX2F2YWlsYWJsZSwgbGlua19jbGtzX3JlcXVpcmVkOwogCXVuc2lnbmVkIGludCB0dV9k
YXRhLCB0dV9saW5lLCBsaW5rX2Nsa3NfYWN0aXZlOwotCXVuc2lnbmVkIGludCBoYmxhbmtfcmlz
ZSwgaGJsYW5rX2Vhcmx5X3Byb2c7CiAJdW5zaWduZWQgaW50IGhfYWN0aXZlLCBoX3RvdGFsLCBo
YmxhbmtfZGVsdGEsIHBpeGVsX2NsazsKIAl1bnNpZ25lZCBpbnQgZmVjX2NvZWZmLCBjZGNsaywg
dmRzY19icHA7CiAJdW5zaWduZWQgaW50IGxpbmtfY2xrLCBsYW5lczsKKwl1bnNpZ25lZCBpbnQg
aGJsYW5rX3Jpc2U7CiAKIAloX2FjdGl2ZSA9IGNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUu
Y3J0Y19oZGlzcGxheTsKIAloX3RvdGFsID0gY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5j
cnRjX2h0b3RhbDsKQEAgLTU0Miw0NCArNTQyLDMzIEBAIHN0YXRpYyB1bnNpZ25lZCBpbnQgZ2V0
X2hibGFua19lYXJseV9lbmFibGVfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
CiAJCSAgICAibGFuZXMgPSAldSB2ZHNjX2JwcCA9ICV1IGNkY2xrID0gJXVcbiIsCiAJCSAgICBo
X2FjdGl2ZSwgbGlua19jbGssIGxhbmVzLCB2ZHNjX2JwcCwgY2RjbGspOwogCi0JaWYgKFdBUk5f
T04oIWxpbmtfY2xrIHx8ICFsYW5lcyB8fCAhdmRzY19icHAgfHwgIWNkY2xrKSkKKwlpZiAoV0FS
Tl9PTighbGlua19jbGsgfHwgIXBpeGVsX2NsayB8fCAhbGFuZXMgfHwgIXZkc2NfYnBwIHx8ICFj
ZGNsaykpCiAJCXJldHVybiAwOwogCi0JbGlua19jbGtzX2F2YWlsYWJsZSA9ICgoKChoX3RvdGFs
IC0gaF9hY3RpdmUpICoKLQkJCSAgICAgICAoKGxpbmtfY2xrICogUk9VTkRJTkdfRkFDVE9SKSAv
Ci0JCQkJcGl4ZWxfY2xrKSkgLyBST1VORElOR19GQUNUT1IpIC0gMjgpOwotCWxpbmtfY2xrc19y
ZXF1aXJlZCA9IERJVl9ST1VORF9VUCgxOTIwMDAsICgxMDAwICogcGl4ZWxfY2xrIC8gaF90b3Rh
bCkpICogKCg0OCAvCi0JCQkJCSAgbGFuZXMpICsgMik7CisJbGlua19jbGtzX2F2YWlsYWJsZSA9
IChoX3RvdGFsIC0gaF9hY3RpdmUpICogbGlua19jbGsgLyBwaXhlbF9jbGsgLSAyODsKKwlsaW5r
X2Nsa3NfcmVxdWlyZWQgPSBESVZfUk9VTkRfVVAoMTkyMDAwICogaF90b3RhbCwgMTAwMCAqIHBp
eGVsX2NsaykgKiAoNDggLyBsYW5lcyArIDIpOwogCiAJaWYgKGxpbmtfY2xrc19hdmFpbGFibGUg
PiBsaW5rX2Nsa3NfcmVxdWlyZWQpCiAJCWhibGFua19kZWx0YSA9IDMyOwogCWVsc2UKLQkJaGJs
YW5rX2RlbHRhID0gRElWX1JPVU5EX1VQKCgoKCg1ICogUk9VTkRJTkdfRkFDVE9SKSAvCi0JCQkJ
CSAgICBsaW5rX2NsaykgKyAoKDUgKgotCQkJCQkgICAgUk9VTkRJTkdfRkFDVE9SKSAvCi0JCQkJ
CSAgICBjZGNsaykpICogcGl4ZWxfY2xrKSwKLQkJCQkJICAgIFJPVU5ESU5HX0ZBQ1RPUik7CisJ
CWhibGFua19kZWx0YSA9IERJVjY0X1U2NF9ST1VORF9VUChtdWxfdTMyX3UzMig1ICogbGlua19j
bGsgKyA1ICogY2RjbGssIHBpeGVsX2NsayksCisJCQkJCQkgIG11bF91MzJfdTMyKGxpbmtfY2xr
LCBjZGNsaykpOwogCi0JdHVfZGF0YSA9IChwaXhlbF9jbGsgKiB2ZHNjX2JwcCAqIDgpIC8gKChs
aW5rX2NsayAqCi0JCSAgIGxhbmVzICogZmVjX2NvZWZmKSAvIDEwMDAwMDApOwotCXR1X2xpbmUg
PSAoKChoX2FjdGl2ZSAqIGxpbmtfY2xrICogZmVjX2NvZWZmKSAvCi0JCSAgIDEwMDAwMDApIC8g
KDY0ICogcGl4ZWxfY2xrKSk7CisJdHVfZGF0YSA9IGRpdjY0X3U2NChtdWxfdTMyX3UzMihwaXhl
bF9jbGsgKiB2ZHNjX2JwcCAqIDgsIDEwMDAwMDApLAorCQkJICAgIG11bF91MzJfdTMyKGxpbmtf
Y2xrICogbGFuZXMsIGZlY19jb2VmZikpOworCXR1X2xpbmUgPSBkaXY2NF91NjQoaF9hY3RpdmUg
KiBtdWxfdTMyX3UzMihsaW5rX2NsaywgZmVjX2NvZWZmKSwKKwkJCSAgICBtdWxfdTMyX3UzMig2
NCAqIHBpeGVsX2NsaywgMTAwMDAwMCkpOwogCWxpbmtfY2xrc19hY3RpdmUgID0gKHR1X2xpbmUg
LSAxKSAqIDY0ICsgdHVfZGF0YTsKIAotCWhibGFua19yaXNlID0gKChsaW5rX2Nsa3NfYWN0aXZl
ICsgNiAqIERJVl9ST1VORF9VUChsaW5rX2Nsa3NfYWN0aXZlLAotCQkJMjUwKSArIDQpICogKChw
aXhlbF9jbGsgKiBST1VORElOR19GQUNUT1IpIC8KLQkJCWxpbmtfY2xrKSkgLyBST1VORElOR19G
QUNUT1I7CisJaGJsYW5rX3Jpc2UgPSAobGlua19jbGtzX2FjdGl2ZSArIDYgKiBESVZfUk9VTkRf
VVAobGlua19jbGtzX2FjdGl2ZSwgMjUwKSArIDQpICogcGl4ZWxfY2xrIC8gbGlua19jbGs7CiAK
LQloYmxhbmtfZWFybHlfcHJvZyA9IGhfYWN0aXZlIC0gaGJsYW5rX3Jpc2UgKyBoYmxhbmtfZGVs
dGE7Ci0KLQlyZXR1cm4gaGJsYW5rX2Vhcmx5X3Byb2c7CisJcmV0dXJuIGhfYWN0aXZlIC0gaGJs
YW5rX3Jpc2UgKyBoYmxhbmtfZGVsdGE7CiB9CiAKLXN0YXRpYyB1bnNpZ25lZCBpbnQgZ2V0X3Nh
bXBsZV9yb29tX3JlcV9jb25maWcoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCitzdGF0aWMgdW5zaWduZWQgaW50IGNhbGNfc2FtcGxlc19yb29tKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewogCXVuc2lnbmVkIGludCBoX2FjdGl2
ZSwgaF90b3RhbCwgcGl4ZWxfY2xrOwogCXVuc2lnbmVkIGludCBsaW5rX2NsaywgbGFuZXM7Ci0J
dW5zaWduZWQgaW50IHNhbXBsZXNfcm9vbTsKIAogCWhfYWN0aXZlID0gY3J0Y19zdGF0ZS0+aHcu
YWRqdXN0ZWRfbW9kZS5oZGlzcGxheTsKIAloX3RvdGFsID0gY3J0Y19zdGF0ZS0+aHcuYWRqdXN0
ZWRfbW9kZS5odG90YWw7CkBAIC01ODcsMTIgKzU3Niw4IEBAIHN0YXRpYyB1bnNpZ25lZCBpbnQg
Z2V0X3NhbXBsZV9yb29tX3JlcV9jb25maWcoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNyCiAJbGlua19jbGsgPSBjcnRjX3N0YXRlLT5wb3J0X2Nsb2NrOwogCWxhbmVzID0gY3J0Y19z
dGF0ZS0+bGFuZV9jb3VudDsKIAotCXNhbXBsZXNfcm9vbSA9ICgoKChoX3RvdGFsIC0gaF9hY3Rp
dmUpICogKChsaW5rX2NsayAqCi0JCQlST1VORElOR19GQUNUT1IpIC8gcGl4ZWxfY2xrKSkgLwot
CQkJUk9VTkRJTkdfRkFDVE9SKSAtIDEyKSAvICgoNDggLwotCQkJbGFuZXMpICsgMik7Ci0KLQly
ZXR1cm4gc2FtcGxlc19yb29tOworCXJldHVybiAoKGhfdG90YWwgLSBoX2FjdGl2ZSkgKiBsaW5r
X2NsayAtIDEyICogcGl4ZWxfY2xrKSAvCisJCShwaXhlbF9jbGsgKiAoNDggLyBsYW5lcyArIDIp
KTsKIH0KIAogc3RhdGljIHZvaWQgZW5hYmxlX2F1ZGlvX2RzY193YShzdHJ1Y3QgaW50ZWxfZW5j
b2RlciAqZW5jb2RlciwKQEAgLTYxOCw4ICs2MDMsNyBAQCBzdGF0aWMgdm9pZCBlbmFibGVfYXVk
aW9fZHNjX3dhKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCSAgICAoY3J0Y19zdGF0
ZS0+aHcuYWRqdXN0ZWRfbW9kZS5oZGlzcGxheSA+PSAzODQwICYmCiAJICAgIGNydGNfc3RhdGUt
Pmh3LmFkanVzdGVkX21vZGUudmRpc3BsYXkgPj0gMjE2MCkpIHsKIAkJLyogR2V0IGhibGFuayBl
YXJseSBlbmFibGUgdmFsdWUgcmVxdWlyZWQgKi8KLQkJaGJsYW5rX2Vhcmx5X3Byb2cgPSBnZXRf
aGJsYW5rX2Vhcmx5X2VuYWJsZV9jb25maWcoZW5jb2RlciwKLQkJCQkJCQkJICAgY3J0Y19zdGF0
ZSk7CisJCWhibGFua19lYXJseV9wcm9nID0gY2FsY19oYmxhbmtfZWFybHlfcHJvZyhlbmNvZGVy
LCBjcnRjX3N0YXRlKTsKIAkJaWYgKGhibGFua19lYXJseV9wcm9nIDwgMzIpIHsKIAkJCXZhbCAm
PSB+SEJMQU5LX1NUQVJUX0NPVU5UX01BU0socGlwZSk7CiAJCQl2YWwgfD0gSEJMQU5LX1NUQVJU
X0NPVU5UKHBpcGUsIEhCTEFOS19TVEFSVF9DT1VOVF8zMik7CkBAIC02MzUsNyArNjE5LDcgQEAg
c3RhdGljIHZvaWQgZW5hYmxlX2F1ZGlvX2RzY193YShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciwKIAkJfQogCiAJCS8qIEdldCBzYW1wbGVzIHJvb20gdmFsdWUgcmVxdWlyZWQgKi8KLQkJ
c2FtcGxlc19yb29tID0gZ2V0X3NhbXBsZV9yb29tX3JlcV9jb25maWcoY3J0Y19zdGF0ZSk7CisJ
CXNhbXBsZXNfcm9vbSA9IGNhbGNfc2FtcGxlc19yb29tKGNydGNfc3RhdGUpOwogCQlpZiAoc2Ft
cGxlc19yb29tIDwgMykgewogCQkJdmFsICY9IH5OVU1CRVJfU0FNUExFU19QRVJfTElORV9NQVNL
KHBpcGUpOwogCQkJdmFsIHw9IE5VTUJFUl9TQU1QTEVTX1BFUl9MSU5FKHBpcGUsIHNhbXBsZXNf
cm9vbSk7Ci0tIAoyLjI0LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2lu
dGVsLWdmeAo=

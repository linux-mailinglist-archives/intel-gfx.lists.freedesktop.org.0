Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 739078BA29
	for <lists+intel-gfx@lfdr.de>; Tue, 13 Aug 2019 15:29:41 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id AABFC89DA8;
	Tue, 13 Aug 2019 13:29:39 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C411789DA2
 for <intel-gfx@lists.freedesktop.org>; Tue, 13 Aug 2019 13:29:36 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18000723-1500050 
 for multiple; Tue, 13 Aug 2019 14:29:17 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 13 Aug 2019 14:29:15 +0100
Message-Id: <20190813132916.20382-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 1/2] drm/i915: Push the wakeref->count deferral
 to the backend
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SWYgdGhlIGJhY2tlbmQgd2lzaGVzIHRvIGRlZmVyIHRoZSB3YWtlcmVmIHBhcmtpbmcsIG1ha2Ug
aXQgcmVzcG9uc2libGUKZm9yIHVubG9ja2luZyB0aGUgd2FrZXJlZiAoaS5lLiBidW1waW5nIHRo
ZSBjb3VudGVyKS4gVGhpcyBhbGxvd3MgaXQgdG8KdGltZSB0aGUgdW5sb2NrIG11Y2ggbW9yZSBj
YXJlZnVsbHkgaW4gY2FzZSBpdCBoYXBwZW5zIHRvIG5lZWRzIHRoZQp3YWtlcmVmIHRvIGJlIGFj
dGl2ZSBkdXJpbmcgaXRzIGRlZmVycmFsLgoKRm9yIGluc3RhbmNlLCBkdXJpbmcgZW5naW5lIHBh
cmtpbmcgd2UgbWF5IGNob29zZSB0byBlbWl0IGFuIGlkbGUKYmFycmllciAoYSByZXF1ZXN0KS4g
VG8gZG8gc28sIHdlIGJvcnJvdyB0aGUgZW5naW5lLT5rZXJuZWxfY29udGV4dAp0aW1lbGluZSBh
bmQgdG8gZW5zdXJlIGV4Y2x1c2l2ZSBhY2Nlc3Mgd2Uga2VlcCB0aGUKZW5naW5lLT53YWtlcmVm
LmNvdW50IGFzIDAuIEhvd2V2ZXIsIHRvIHN1Ym1pdCB0aGF0IHJlcXVlc3QgdG8gSFcgbWF5CnJl
cXVpcmUgYSBpbnRlbF9lbmdpbmVfcG1fZ2V0KCkgKGUuZy4gdG8ga2VlcCB0aGUgc3VibWlzc2lv
biB0YXNrbGV0CmFsaXZlKSBhbmQgYmVmb3JlIHdlIGFsbG93IHRoYXQgd2UgaGF2ZSB0byByZXdh
a2Ugb3VyIHdha2VyZWYgdG8gYXZvaWQgYQpyZWN1cnNpdmUgZGVhZGxvY2suCgo8ND4gWzI1Ny43
NDI5MTZdIElSUXMgbm90IGVuYWJsZWQgYXMgZXhwZWN0ZWQKPDQ+IFsyNTcuNzQyOTMwXSBXQVJO
SU5HOiBDUFU6IDAgUElEOiAwIGF0IGtlcm5lbC9zb2Z0aXJxLmM6MTY5IF9fbG9jYWxfYmhfZW5h
YmxlX2lwKzB4YTkvMHgxMDAKPDQ+IFsyNTcuNzQyOTM2XSBNb2R1bGVzIGxpbmtlZCBpbjogdmdl
bSBzbmRfaGRhX2NvZGVjX2hkbWkgc25kX2hkYV9jb2RlY19yZWFsdGVrIHNuZF9oZGFfY29kZWNf
Z2VuZXJpYyBpOTE1IGJ0dXNiIGJ0cnRsIGJ0YmNtIGJ0aW50ZWwgc25kX2hkYV9pbnRlbCBzbmRf
aW50ZWxfbmhsdCBibHVldG9vdGggc25kX2hkYV9jb2RlYyBjb3JldGVtcCBzbmRfaHdkZXAgY3Jj
dDEwZGlmX3BjbG11bCBzbmRfaGRhX2NvcmUgY3JjMzJfcGNsbXVsIGVjZGhfZ2VuZXJpYyBlY2Mg
Z2hhc2hfY2xtdWxuaV9pbnRlbCBzbmRfcGNtIHI4MTY5IHJlYWx0ZWsgbHBjX2ljaCBwcmltZV9u
dW1iZXJzIGkyY19oaWQKPDQ+IFsyNTcuNzQyOTkxXSBDUFU6IDAgUElEOiAwIENvbW06IHN3YXBw
ZXIvMCBUYWludGVkOiBHICAgICBVICBXICAgICAgICAgNS4zLjAtcmMzLWc1ZDBhMDZjZDUzMmMt
ZHJtdGlwXzM0MCsgIzEKPDQ+IFsyNTcuNzQyOTk4XSBIYXJkd2FyZSBuYW1lOiBHSUdBQllURSBH
Qi1CWEJULTE5MDAvTVpCQVlBQi0wMCwgQklPUyBGNiAwMi8xNy8yMDE1Cjw0PiBbMjU3Ljc0MzAw
OF0gUklQOiAwMDEwOl9fbG9jYWxfYmhfZW5hYmxlX2lwKzB4YTkvMHgxMDAKPDQ+IFsyNTcuNzQz
MDE3XSBDb2RlOiAzNyA1YiA1ZCBjMyA4YiA4MCA1MCAwOCAwMCAwMCA4NSBjMCA3NSBhOSA4MCAz
ZCAwYiBiZSAyNSAwMSAwMCA3NSBhMCA0OCBjNyBjNyBmMyAwYyAwNiBhYyBjNiAwNSBmYiBiZCAy
NSAwMSAwMSBlOCA3NyA4NCBmZiBmZiA8MGY+IDBiIGViIDg5IDQ4IDg5IGVmIGU4IDNiIDQxIDA2
IDAwIGViIDk4IGU4IGU0IDVjIGY0IGZmIDViIDVkIGMzCjw0PiBbMjU3Ljc0MzAyNV0gUlNQOiAw
MDE4OmZmZmZhNzg2MDAwMDNjYjggRUZMQUdTOiAwMDAxMDA4Ngo8ND4gWzI1Ny43NDMwMzVdIFJB
WDogMDAwMDAwMDAwMDAwMDAwMCBSQlg6IDAwMDAwMDAwMDAwMDAyMDAgUkNYOiAwMDAwMDAwMDAw
MDEwMzAyCjw0PiBbMjU3Ljc0MzA0Ml0gUkRYOiAwMDAwMDAwMDgwMDEwMzAyIFJTSTogMDAwMDAw
MDAwMDAwMDAwMCBSREk6IDAwMDAwMDAwZmZmZmZmZmYKPDQ+IFsyNTcuNzQzMDUwXSBSQlA6IGZm
ZmZmZmZmYzA0OTRiYjMgUjA4OiAwMDAwMDAwMDAwMDAwMDAwIFIwOTogMDAwMDAwMDAwMDAwMDAw
MQo8ND4gWzI1Ny43NDMwNThdIFIxMDogMDAwMDAwMDAxNGM4ZjBlOSBSMTE6IDAwMDAwMDAwZmVl
MmZmOGUgUjEyOiBmZmZmYTIzYmE4YzM4MDA4Cjw0PiBbMjU3Ljc0MzA2NV0gUjEzOiBmZmZmYTIz
YmFjYzU3OWMwIFIxNDogZmZmZmEyM2JiN2RiMGY2MCBSMTU6IGZmZmZhMjNiOWNjOGM0MzAKPDQ+
IFsyNTcuNzQzMDc0XSBGUzogIDAwMDAwMDAwMDAwMDAwMDAoMDAwMCkgR1M6ZmZmZmEyM2JiYmEw
MDAwMCgwMDAwKSBrbmxHUzowMDAwMDAwMDAwMDAwMDAwCjw0PiBbMjU3Ljc0MzA4Ml0gQ1M6ICAw
MDEwIERTOiAwMDAwIEVTOiAwMDAwIENSMDogMDAwMDAwMDA4MDA1MDAzMwo8ND4gWzI1Ny43NDMw
ODldIENSMjogMDAwMDdmZTQ3N2IyMDc3OCBDUjM6IDAwMDAwMDAxMWY3MmEwMDAgQ1I0OiAwMDAw
MDAwMDAwMTAwNmYwCjw0PiBbMjU3Ljc0MzA5Nl0gQ2FsbCBUcmFjZToKPDQ+IFsyNTcuNzQzMTA0
XSAgPElSUT4KPDQ+IFsyNTcuNzQzMjY1XSAgX19pOTE1X3JlcXVlc3RfY29tbWl0KzB4MjQwLzB4
NWQwIFtpOTE1XQo8ND4gWzI1Ny43NDM0MjddICA/IF9faTkxNV9yZXF1ZXN0X2NyZWF0ZSsweDIy
OC8weDRjMCBbaTkxNV0KPDQ+IFsyNTcuNzQzNTg0XSAgX19lbmdpbmVfcGFyaysweDY0LzB4MjUw
IFtpOTE1XQo8ND4gWzI1Ny43NDM3MzBdICBfX19faW50ZWxfd2FrZXJlZl9wdXRfbGFzdCsweDFj
LzB4NzAgW2k5MTVdCjw0PiBbMjU3Ljc0Mzg3OF0gIGk5MTVfc2FtcGxlKzB4MmVlLzB4MzEwIFtp
OTE1XQo8ND4gWzI1Ny43NDQwMzBdICA/IGk5MTVfcG11X2NwdV9vZmZsaW5lKzB4YjAvMHhiMCBb
aTkxNV0KPDQ+IFsyNTcuNzQ0MDQwXSAgX19ocnRpbWVyX3J1bl9xdWV1ZXMrMHgxMWUvMHg0YjAK
PDQ+IFsyNTcuNzQ0MDY4XSAgaHJ0aW1lcl9pbnRlcnJ1cHQrMHhlYS8weDI1MAo8ND4gWzI1Ny43
NDQwNzldICA/IGxvY2tkZXBfaGFyZGlycXNfb2ZmKzB4NzkvMHhkMAo8ND4gWzI1Ny43NDQxMDFd
ICBzbXBfYXBpY190aW1lcl9pbnRlcnJ1cHQrMHg5Ni8weDI4MAo8ND4gWzI1Ny43NDQxMTRdICBh
cGljX3RpbWVyX2ludGVycnVwdCsweGYvMHgyMAo8ND4gWzI1Ny43NDQxMjVdIFJJUDogMDAxMDpf
X2RvX3NvZnRpcnErMHhiMy8weDRhZQoKQnVnemlsbGE6IGh0dHBzOi8vYnVncy5mcmVlZGVza3Rv
cC5vcmcvc2hvd19idWcuY2dpP2lkPTExMTM3OApTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24g
PGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IERhbmllbGUgQ2VyYW9sbyBTcHVyaW8gPGRh
bmllbGUuY2VyYW9sb3NwdXJpb0BpbnRlbC5jb20+CkNjOiBNaWthIEt1b3BwYWxhIDxtaWthLmt1
b3BwYWxhQGxpbnV4LmludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9lbmdpbmVfcG0uYyB8ICA4ICsrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0
LmMgICAgICAgfCA2NiArKysrKysrKysrKystLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9yZXF1ZXN0LmggICAgICAgfCAgMiArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3NjaGVkdWxlci5jICAgICB8ICAzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF93YWtl
cmVmLmMgICAgICB8ICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF93YWtlcmVmLmgg
ICAgICB8IDExICsrKysKIDYgZmlsZXMgY2hhbmdlZCwgNTYgaW5zZXJ0aW9ucygrKSwgMzggZGVs
ZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5n
aW5lX3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYwppbmRl
eCA2YjE1ZTMzMzVkZDYuLmFkMzdjOTgwOGMxZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfZW5naW5lX3BtLmMKQEAgLTY4LDkgKzY4LDEzIEBAIHN0YXRpYyBib29sIHN3aXRjaF90
b19rZXJuZWxfY29udGV4dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAKIAkvKiBD
aGVjayBhZ2FpbiBvbiB0aGUgbmV4dCByZXRpcmVtZW50LiAqLwogCWVuZ2luZS0+d2FrZXJlZl9z
ZXJpYWwgPSBlbmdpbmUtPnNlcmlhbCArIDE7Ci0KIAlpOTE1X3JlcXVlc3RfYWRkX2FjdGl2ZV9i
YXJyaWVycyhycSk7CisKKwlycS0+c2NoZWQuYXR0ci5wcmlvcml0eSA9IElOVF9NQVg7IC8qIFBy
ZWVtcHRpb24gYmFycmllciAqLworCiAJX19pOTE1X3JlcXVlc3RfY29tbWl0KHJxKTsKKwlfX2lu
dGVsX3dha2VyZWZfZGVmZXJfcGFyaygmZW5naW5lLT53YWtlcmVmKTsKKwlfX2k5MTVfcmVxdWVz
dF9xdWV1ZShycSwgTlVMTCk7CiAKIAlyZXR1cm4gZmFsc2U7CiB9CkBAIC05OCw3ICsxMDIsNyBA
QCBzdGF0aWMgaW50IF9fZW5naW5lX3Bhcmsoc3RydWN0IGludGVsX3dha2VyZWYgKndmKQogCWlu
dGVsX2VuZ2luZV9wb29sX3BhcmsoJmVuZ2luZS0+cG9vbCk7CiAKIAkvKiBNdXN0IGJlIHJlc2V0
IHVwb24gaWRsaW5nLCBvciB3ZSBtYXkgbWlzcyB0aGUgYnVzeSB3YWtldXAuICovCi0JR0VNX0JV
R19PTihlbmdpbmUtPmV4ZWNsaXN0cy5xdWV1ZV9wcmlvcml0eV9oaW50ICE9IElOVF9NSU4pOwor
CWVuZ2luZS0+ZXhlY2xpc3RzLnF1ZXVlX3ByaW9yaXR5X2hpbnQgPSBJTlRfTUlOOwogCiAJaWYg
KGVuZ2luZS0+cGFyaykKIAkJZW5naW5lLT5wYXJrKGVuZ2luZSk7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfcmVxdWVzdC5jCmluZGV4IDBlYTExMzZkNDUzZS4uNDAyMTMzNGRkMmM1IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3JlcXVlc3QuYwpAQCAtMTE4Niw2ICsxMTg2LDEyIEBAIHN0cnVjdCBpOTE1
X3JlcXVlc3QgKl9faTkxNV9yZXF1ZXN0X2NvbW1pdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkK
IAkJbGlzdF9hZGQoJnJpbmctPmFjdGl2ZV9saW5rLCAmcnEtPmk5MTUtPmd0LmFjdGl2ZV9yaW5n
cyk7CiAJcnEtPmVtaXR0ZWRfamlmZmllcyA9IGppZmZpZXM7CiAKKwlyZXR1cm4gcHJldjsKK30K
Kwordm9pZCBfX2k5MTVfcmVxdWVzdF9xdWV1ZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKKwkJ
CSAgY29uc3Qgc3RydWN0IGk5MTVfc2NoZWRfYXR0ciAqYXR0cikKK3sKIAkvKgogCSAqIExldCB0
aGUgYmFja2VuZCBrbm93IGEgbmV3IHJlcXVlc3QgaGFzIGFycml2ZWQgdGhhdCBtYXkgbmVlZAog
CSAqIHRvIGFkanVzdCB0aGUgZXhpc3RpbmcgZXhlY3V0aW9uIHNjaGVkdWxlIGR1ZSB0byBhIGhp
Z2ggcHJpb3JpdHkKQEAgLTExOTksNDMgKzEyMDUsMTUgQEAgc3RydWN0IGk5MTVfcmVxdWVzdCAq
X19pOTE1X3JlcXVlc3RfY29tbWl0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCSAqLwogCWxv
Y2FsX2JoX2Rpc2FibGUoKTsKIAlpOTE1X3N3X2ZlbmNlX2NvbW1pdCgmcnEtPnNlbWFwaG9yZSk7
Ci0JaWYgKGVuZ2luZS0+c2NoZWR1bGUpIHsKLQkJc3RydWN0IGk5MTVfc2NoZWRfYXR0ciBhdHRy
ID0gcnEtPmdlbV9jb250ZXh0LT5zY2hlZDsKLQotCQkvKgotCQkgKiBCb29zdCBhY3R1YWwgd29y
a2xvYWRzIHBhc3Qgc2VtYXBob3JlcyEKLQkJICoKLQkJICogV2l0aCBzZW1hcGhvcmVzIHdlIHNw
aW4gb24gb25lIGVuZ2luZSB3YWl0aW5nIGZvciBhbm90aGVyLAotCQkgKiBzaW1wbHkgdG8gcmVk
dWNlIHRoZSBsYXRlbmN5IG9mIHN0YXJ0aW5nIG91ciB3b3JrIHdoZW4KLQkJICogdGhlIHNpZ25h
bGVyIGNvbXBsZXRlcy4gSG93ZXZlciwgaWYgdGhlcmUgaXMgYW55IG90aGVyCi0JCSAqIHdvcmsg
dGhhdCB3ZSBjb3VsZCBiZSBkb2luZyBvbiB0aGlzIGVuZ2luZSBpbnN0ZWFkLCB0aGF0Ci0JCSAq
IGlzIGJldHRlciB1dGlsaXNhdGlvbiBhbmQgd2lsbCByZWR1Y2UgdGhlIG92ZXJhbGwgZHVyYXRp
b24KLQkJICogb2YgdGhlIGN1cnJlbnQgd29yay4gVG8gYXZvaWQgUEkgYm9vc3RpbmcgYSBzZW1h
cGhvcmUKLQkJICogZmFyIGluIHRoZSBkaXN0YW5jZSBwYXN0IG92ZXIgdXNlZnVsIHdvcmssIHdl
IGtlZXAgYSBoaXN0b3J5Ci0JCSAqIG9mIGFueSBzZW1hcGhvcmUgdXNlIGFsb25nIG91ciBkZXBl
bmRlbmN5IGNoYWluLgotCQkgKi8KLQkJaWYgKCEocnEtPnNjaGVkLmZsYWdzICYgSTkxNV9TQ0hF
RF9IQVNfU0VNQVBIT1JFX0NIQUlOKSkKLQkJCWF0dHIucHJpb3JpdHkgfD0gSTkxNV9QUklPUklU
WV9OT1NFTUFQSE9SRTsKLQotCQkvKgotCQkgKiBCb29zdCBwcmlvcml0aWVzIHRvIG5ldyBjbGll
bnRzIChuZXcgcmVxdWVzdCBmbG93cykuCi0JCSAqCi0JCSAqIEFsbG93IGludGVyYWN0aXZlL3N5
bmNocm9ub3VzIGNsaWVudHMgdG8ganVtcCBhaGVhZCBvZgotCQkgKiB0aGUgYnVsayBjbGllbnRz
LiAoRlFfQ09ERUwpCi0JCSAqLwotCQlpZiAobGlzdF9lbXB0eSgmcnEtPnNjaGVkLnNpZ25hbGVy
c19saXN0KSkKLQkJCWF0dHIucHJpb3JpdHkgfD0gSTkxNV9QUklPUklUWV9XQUlUOwotCi0JCWVu
Z2luZS0+c2NoZWR1bGUocnEsICZhdHRyKTsKLQl9CisJaWYgKGF0dHIgJiYgcnEtPmVuZ2luZS0+
c2NoZWR1bGUpCisJCXJxLT5lbmdpbmUtPnNjaGVkdWxlKHJxLCBhdHRyKTsKIAlpOTE1X3N3X2Zl
bmNlX2NvbW1pdCgmcnEtPnN1Ym1pdCk7CiAJbG9jYWxfYmhfZW5hYmxlKCk7IC8qIEtpY2sgdGhl
IGV4ZWNsaXN0cyB0YXNrbGV0IGlmIGp1c3Qgc2NoZWR1bGVkICovCi0KLQlyZXR1cm4gcHJldjsK
IH0KIAogdm9pZCBpOTE1X3JlcXVlc3RfYWRkKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogewor
CXN0cnVjdCBpOTE1X3NjaGVkX2F0dHIgYXR0ciA9IHJxLT5nZW1fY29udGV4dC0+c2NoZWQ7CiAJ
c3RydWN0IGk5MTVfcmVxdWVzdCAqcHJldjsKIAogCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnJxLT50
aW1lbGluZS0+bXV0ZXgpOwpAQCAtMTI0NSw2ICsxMjIzLDMyIEBAIHZvaWQgaTkxNV9yZXF1ZXN0
X2FkZChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAogCXByZXYgPSBfX2k5MTVfcmVxdWVzdF9j
b21taXQocnEpOwogCisJLyoKKwkgKiBCb29zdCBhY3R1YWwgd29ya2xvYWRzIHBhc3Qgc2VtYXBo
b3JlcyEKKwkgKgorCSAqIFdpdGggc2VtYXBob3JlcyB3ZSBzcGluIG9uIG9uZSBlbmdpbmUgd2Fp
dGluZyBmb3IgYW5vdGhlciwKKwkgKiBzaW1wbHkgdG8gcmVkdWNlIHRoZSBsYXRlbmN5IG9mIHN0
YXJ0aW5nIG91ciB3b3JrIHdoZW4KKwkgKiB0aGUgc2lnbmFsZXIgY29tcGxldGVzLiBIb3dldmVy
LCBpZiB0aGVyZSBpcyBhbnkgb3RoZXIKKwkgKiB3b3JrIHRoYXQgd2UgY291bGQgYmUgZG9pbmcg
b24gdGhpcyBlbmdpbmUgaW5zdGVhZCwgdGhhdAorCSAqIGlzIGJldHRlciB1dGlsaXNhdGlvbiBh
bmQgd2lsbCByZWR1Y2UgdGhlIG92ZXJhbGwgZHVyYXRpb24KKwkgKiBvZiB0aGUgY3VycmVudCB3
b3JrLiBUbyBhdm9pZCBQSSBib29zdGluZyBhIHNlbWFwaG9yZQorCSAqIGZhciBpbiB0aGUgZGlz
dGFuY2UgcGFzdCBvdmVyIHVzZWZ1bCB3b3JrLCB3ZSBrZWVwIGEgaGlzdG9yeQorCSAqIG9mIGFu
eSBzZW1hcGhvcmUgdXNlIGFsb25nIG91ciBkZXBlbmRlbmN5IGNoYWluLgorCSAqLworCWlmICgh
KHJxLT5zY2hlZC5mbGFncyAmIEk5MTVfU0NIRURfSEFTX1NFTUFQSE9SRV9DSEFJTikpCisJCWF0
dHIucHJpb3JpdHkgfD0gSTkxNV9QUklPUklUWV9OT1NFTUFQSE9SRTsKKworCS8qCisJICogQm9v
c3QgcHJpb3JpdGllcyB0byBuZXcgY2xpZW50cyAobmV3IHJlcXVlc3QgZmxvd3MpLgorCSAqCisJ
ICogQWxsb3cgaW50ZXJhY3RpdmUvc3luY2hyb25vdXMgY2xpZW50cyB0byBqdW1wIGFoZWFkIG9m
CisJICogdGhlIGJ1bGsgY2xpZW50cy4gKEZRX0NPREVMKQorCSAqLworCWlmIChsaXN0X2VtcHR5
KCZycS0+c2NoZWQuc2lnbmFsZXJzX2xpc3QpKQorCQlhdHRyLnByaW9yaXR5IHw9IEk5MTVfUFJJ
T1JJVFlfV0FJVDsKKworCV9faTkxNV9yZXF1ZXN0X3F1ZXVlKHJxLCAmYXR0cik7CisKIAkvKgog
CSAqIEluIHR5cGljYWwgc2NlbmFyaW9zLCB3ZSBkbyBub3QgZXhwZWN0IHRoZSBwcmV2aW91cyBy
ZXF1ZXN0IG9uCiAJICogdGhlIHRpbWVsaW5lIHRvIGJlIHN0aWxsIHRyYWNrZWQgYnkgdGltZWxp
bmUtPmxhc3RfcmVxdWVzdCBpZiBpdApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9yZXF1ZXN0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaAppbmRl
eCAzMTNkZjNjMzcxNTguLmZlYzFkNWYxN2M5NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9yZXF1ZXN0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1
ZXN0LmgKQEAgLTI1MSw2ICsyNTEsOCBAQCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICogX19tdXN0X2No
ZWNrCiBpOTE1X3JlcXVlc3RfY3JlYXRlKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSk7CiAKIHN0
cnVjdCBpOTE1X3JlcXVlc3QgKl9faTkxNV9yZXF1ZXN0X2NvbW1pdChzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpyZXF1ZXN0KTsKK3ZvaWQgX19pOTE1X3JlcXVlc3RfcXVldWUoc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnEsCisJCQkgIGNvbnN0IHN0cnVjdCBpOTE1X3NjaGVkX2F0dHIgKmF0dHIpOwogCiB2
b2lkIGk5MTVfcmVxdWVzdF9yZXRpcmVfdXB0byhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSk7CiAK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5jCmluZGV4IDBiZDQ1MmU4NTFkOC4uN2I4
NGViY2EyOTAxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxl
ci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmMKQEAgLTM0OSw4
ICszNDksNyBAQCB2b2lkIGk5MTVfc2NoZWR1bGVfYnVtcF9wcmlvcml0eShzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpycSwgdW5zaWduZWQgaW50IGJ1bXApCiAJdW5zaWduZWQgbG9uZyBmbGFnczsKIAog
CUdFTV9CVUdfT04oYnVtcCAmIH5JOTE1X1BSSU9SSVRZX01BU0spOwotCi0JaWYgKFJFQURfT05D
RShycS0+c2NoZWQuYXR0ci5wcmlvcml0eSkgPT0gSTkxNV9QUklPUklUWV9JTlZBTElEKQorCWlm
IChSRUFEX09OQ0UocnEtPnNjaGVkLmF0dHIucHJpb3JpdHkpICYgYnVtcCkKIAkJcmV0dXJuOwog
CiAJc3Bpbl9sb2NrX2lycXNhdmUoJnNjaGVkdWxlX2xvY2ssIGZsYWdzKTsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2ludGVsX3dha2VyZWYuYwppbmRleCBkNDQ0M2U4MWMxYzguLjg2OGNjNzgwNDhkMCAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd2FrZXJlZi5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYuYwpAQCAtNTcsMTIgKzU3LDEwIEBAIHN0YXRp
YyB2b2lkIF9fX19pbnRlbF93YWtlcmVmX3B1dF9sYXN0KHN0cnVjdCBpbnRlbF93YWtlcmVmICp3
ZikKIAlpZiAoIWF0b21pY19kZWNfYW5kX3Rlc3QoJndmLT5jb3VudCkpCiAJCWdvdG8gdW5sb2Nr
OwogCisJLyogb3BzLT5wdXQoKSBtdXN0IHJlc2NoZWR1bGUgaXRzIG93biByZWxlYXNlIG9uIGVy
cm9yL2RlZmVycmFsICovCiAJaWYgKGxpa2VseSghd2YtPm9wcy0+cHV0KHdmKSkpIHsKIAkJcnBt
X3B1dCh3Zik7CiAJCXdha2VfdXBfdmFyKCZ3Zi0+d2FrZXJlZik7Ci0JfSBlbHNlIHsKLQkJLyog
b3BzLT5wdXQoKSBtdXN0IHNjaGVkdWxlIGl0cyBvd24gcmVsZWFzZSBvbiBkZWZlcnJhbCAqLwot
CQlhdG9taWNfc2V0X3JlbGVhc2UoJndmLT5jb3VudCwgMSk7CiAJfQogCiB1bmxvY2s6CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF93YWtlcmVmLmggYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF93YWtlcmVmLmgKaW5kZXggNTM1YTNhMTI4NjRiLi41ZjBjOTcyYTgw
ZmIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYuaAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF93YWtlcmVmLmgKQEAgLTE2Myw2ICsxNjMsMTcg
QEAgaW50ZWxfd2FrZXJlZl9pc19hY3RpdmUoY29uc3Qgc3RydWN0IGludGVsX3dha2VyZWYgKndm
KQogCXJldHVybiBSRUFEX09OQ0Uod2YtPndha2VyZWYpOwogfQogCisvKioKKyAqIF9faW50ZWxf
d2FrZXJlZl9kZWZlcl9wYXJrOiBEZWZlciB0aGUgY3VycmVudCBwYXJrIGNhbGxiYWNrCisgKiBA
d2Y6IHRoZSB3YWtlcmVmCisgKi8KK3N0YXRpYyBpbmxpbmUgdm9pZAorX19pbnRlbF93YWtlcmVm
X2RlZmVyX3Bhcmsoc3RydWN0IGludGVsX3dha2VyZWYgKndmKQoreworCUlOVEVMX1dBS0VSRUZf
QlVHX09OKGF0b21pY19yZWFkKCZ3Zi0+Y291bnQpKTsKKwlhdG9taWNfc2V0X3JlbGVhc2UoJndm
LT5jb3VudCwgMSk7Cit9CisKIC8qKgogICogaW50ZWxfd2FrZXJlZl93YWl0X2Zvcl9pZGxlOiBX
YWl0IHVudGlsIHRoZSB3YWtlcmVmIGlzIGlkbGUKICAqIEB3ZjogdGhlIHdha2VyZWYKLS0gCjIu
MjMuMC5yYzEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
CkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpo
dHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C3CADF28D9
	for <lists+intel-gfx@lfdr.de>; Thu,  7 Nov 2019 09:13:22 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 09BC16EED9;
	Thu,  7 Nov 2019 08:13:14 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8EC9A6EEC7
 for <intel-gfx@lists.freedesktop.org>; Thu,  7 Nov 2019 08:13:07 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19110667-1500050 
 for multiple; Thu, 07 Nov 2019 08:12:55 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  7 Nov 2019 08:12:34 +0000
Message-Id: <20191107081252.10542-10-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191107081252.10542-1-chris@chris-wilson.co.uk>
References: <20191107081252.10542-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 10/28] drm/i915/selftests: Perform some basic
 cycle counting of MI ops
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Anna Karas <anna.karas@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U29tZSBiYXNpYyBpbmZvcm1hdGlvbiB0aGF0IGlzIHVzZWZ1bCB0byBrbm93LCBzdWNoIGFzIGhv
dyBtYW55IGN5Y2xlcwppcyBhIE1JX05PT1AuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24g
PGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IEFubmEgS2FyYXMgPGFubmEua2FyYXNAaW50
ZWwuY29tPgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KLS0t
CiAuLi4vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVjdF9ibHQuYyAgfCAgMTUgKy0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9jcy5jICB8IDMzOSArKysr
KysrKysrKysrKysrKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNpLmMgICAgICAgICAg
ICAgICB8ICAgNiArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NlbGZ0ZXN0LmggICAgICAg
ICAgfCAgIDQgKwogLi4uL2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3BlcmZfc2VsZnRlc3RzLmgg
IHwgIDEzICsKIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfc2VsZnRlc3QuYyAgICB8
ICA0MyArKysKIDYgZmlsZXMgY2hhbmdlZCwgNDE3IGluc2VydGlvbnMoKyksIDMgZGVsZXRpb25z
KC0pCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5
MTVfcGVyZl9zZWxmdGVzdHMuaAoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9zZWxmdGVzdHMvaTkxNV9nZW1fb2JqZWN0X2JsdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmplY3RfYmx0LmMKaW5kZXggMTQ2YmE3MWNlNzk3Li4x
N2ZjNjBhYTEyM2EgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVz
dHMvaTkxNV9nZW1fb2JqZWN0X2JsdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9z
ZWxmdGVzdHMvaTkxNV9nZW1fb2JqZWN0X2JsdC5jCkBAIC01MjcsOCArNTI3LDYgQEAgc3RhdGlj
IGludCBpZ3RfY29weV9ibHRfY3R4MCh2b2lkICphcmcpCiBpbnQgaTkxNV9nZW1fb2JqZWN0X2Js
dF9saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdGF0
aWMgY29uc3Qgc3RydWN0IGk5MTVfc3VidGVzdCB0ZXN0c1tdID0gewotCQlTVUJURVNUKHBlcmZf
ZmlsbF9ibHQpLAotCQlTVUJURVNUKHBlcmZfY29weV9ibHQpLAogCQlTVUJURVNUKGlndF9maWxs
X2JsdCksCiAJCVNVQlRFU1QoaWd0X2ZpbGxfYmx0X2N0eDApLAogCQlTVUJURVNUKGlndF9jb3B5
X2JsdCksCkBAIC01NDMsMyArNTQxLDE2IEBAIGludCBpOTE1X2dlbV9vYmplY3RfYmx0X2xpdmVf
c2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCiAJcmV0dXJuIGk5MTVf
bGl2ZV9zdWJ0ZXN0cyh0ZXN0cywgaTkxNSk7CiB9CisKK2ludCBpOTE1X2dlbV9vYmplY3RfYmx0
X3BlcmZfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQoreworCXN0YXRp
YyBjb25zdCBzdHJ1Y3QgaTkxNV9zdWJ0ZXN0IHRlc3RzW10gPSB7CisJCVNVQlRFU1QocGVyZl9m
aWxsX2JsdCksCisJCVNVQlRFU1QocGVyZl9jb3B5X2JsdCksCisJfTsKKworCWlmIChpbnRlbF9n
dF9pc193ZWRnZWQoJmk5MTUtPmd0KSkKKwkJcmV0dXJuIDA7CisKKwlyZXR1cm4gaTkxNV9saXZl
X3N1YnRlc3RzKHRlc3RzLCBpOTE1KTsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9jcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfZW5naW5lX2NzLmMKaW5kZXggMzg4MGYwN2MyOWI4Li5hYTZiMTk5N2VkZGIgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9jcy5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9jcy5jCkBAIC00LDcgKzQs
MzQ0IEBACiAgKiBDb3B5cmlnaHQgwqkgMjAxOCBJbnRlbCBDb3Jwb3JhdGlvbgogICovCiAKLSNp
bmNsdWRlICIuLi9pOTE1X3NlbGZ0ZXN0LmgiCisjaW5jbHVkZSA8bGludXgvc29ydC5oPgorCisj
aW5jbHVkZSAiaW50ZWxfZ3RfcG0uaCIKKyNpbmNsdWRlICJpbnRlbF9ycHMuaCIKKworI2luY2x1
ZGUgImk5MTVfc2VsZnRlc3QuaCIKKyNpbmNsdWRlICJzZWxmdGVzdHMvaWd0X2ZsdXNoX3Rlc3Qu
aCIKKworI2RlZmluZSBDT1VOVCA1CisKK3N0YXRpYyBpbnQgY21wX3UzMihjb25zdCB2b2lkICpB
LCBjb25zdCB2b2lkICpCKQoreworCWNvbnN0IHUzMiAqYSA9IEEsICpiID0gQjsKKworCXJldHVy
biAqYSAtICpiOworfQorCitzdGF0aWMgdm9pZCBwZXJmX2JlZ2luKHN0cnVjdCBpbnRlbF9ndCAq
Z3QpCit7CisJaW50ZWxfZ3RfcG1fZ2V0KGd0KTsKKworCS8qIEJvb3N0IGdwdWZyZXEgdG8gbWF4
IFt3YWl0Ym9vc3RdIGFuZCBrZWVwIGl0IGZpeGVkICovCisJYXRvbWljX2luYygmZ3QtPnJwcy5u
dW1fd2FpdGVycyk7CisJc2NoZWR1bGVfd29yaygmZ3QtPnJwcy53b3JrKTsKKwlmbHVzaF93b3Jr
KCZndC0+cnBzLndvcmspOworfQorCitzdGF0aWMgaW50IHBlcmZfZW5kKHN0cnVjdCBpbnRlbF9n
dCAqZ3QpCit7CisJYXRvbWljX2RlYygmZ3QtPnJwcy5udW1fd2FpdGVycyk7CisJaW50ZWxfZ3Rf
cG1fcHV0KGd0KTsKKworCXJldHVybiBpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSk7Cit9CisKK3N0
YXRpYyBpbnQgd3JpdGVfdGltZXN0YW1wKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBpbnQgc2xv
dCkKK3sKKwl1MzIgY21kOworCXUzMiAqY3M7CisKKwljcyA9IGludGVsX3JpbmdfYmVnaW4ocnEs
IDQpOworCWlmIChJU19FUlIoY3MpKQorCQlyZXR1cm4gUFRSX0VSUihjcyk7CisKKwljbWQgPSBN
SV9TVE9SRV9SRUdJU1RFUl9NRU0gfCBNSV9VU0VfR0dUVDsKKwlpZiAoSU5URUxfR0VOKHJxLT5p
OTE1KSA+PSA4KQorCQljbWQrKzsKKwkqY3MrKyA9IGNtZDsKKwkqY3MrKyA9IHJxLT5lbmdpbmUt
Pm1taW9fYmFzZSArIDB4MzU4OworCSpjcysrID0gaTkxNV9yZXF1ZXN0X3RpbWVsaW5lKHJxKS0+
aHdzcF9vZmZzZXQgKyBzbG90ICogc2l6ZW9mKHUzMik7CisJKmNzKysgPSAwOworCisJaW50ZWxf
cmluZ19hZHZhbmNlKHJxLCBjcyk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHN0cnVjdCBp
OTE1X3ZtYSAqY3JlYXRlX2VtcHR5X2JhdGNoKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKK3sK
KwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOworCXN0cnVjdCBpOTE1X3ZtYSAqdm1h
OworCXUzMiAqY3M7CisJaW50IGVycjsKKworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVf
aW50ZXJuYWwoY2UtPmVuZ2luZS0+aTkxNSwgUEFHRV9TSVpFKTsKKwlpZiAoSVNfRVJSKG9iaikp
CisJCXJldHVybiBFUlJfQ0FTVChvYmopOworCisJY3MgPSBpOTE1X2dlbV9vYmplY3RfcGluX21h
cChvYmosIEk5MTVfTUFQX1dCKTsKKwlpZiAoSVNfRVJSKGNzKSkgeworCQlpOTE1X2dlbV9vYmpl
Y3RfcHV0KG9iaik7CisJCXJldHVybiBFUlJfQ0FTVChjcyk7CisJfQorCisJY3NbMF0gPSBNSV9C
QVRDSF9CVUZGRVJfRU5EOworCisJaTkxNV9nZW1fb2JqZWN0X2ZsdXNoX21hcChvYmopOworCWk5
MTVfZ2VtX29iamVjdF91bnBpbl9tYXAob2JqKTsKKworCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNl
KG9iaiwgY2UtPnZtLCBOVUxMKTsKKwlpZiAoSVNfRVJSKHZtYSkpIHsKKwkJaTkxNV9nZW1fb2Jq
ZWN0X3B1dChvYmopOworCQlyZXR1cm4gdm1hOworCX0KKworCWVyciA9IGk5MTVfdm1hX3Bpbih2
bWEsIDAsIDAsIFBJTl9VU0VSKTsKKwlpZiAoZXJyKSB7CisJCWk5MTVfZ2VtX29iamVjdF9wdXQo
b2JqKTsKKwkJcmV0dXJuIEVSUl9QVFIoZXJyKTsKKwl9CisKKwlyZXR1cm4gdm1hOworfQorCitz
dGF0aWMgdTMyIHRyaWZpbHRlcih1MzIgKmEpCit7CisJdTY0IHN1bTsKKworCXNvcnQoYSwgQ09V
TlQsIHNpemVvZigqYSksIGNtcF91MzIsIE5VTEwpOworCisJc3VtICs9IG11bF91MzJfdTMyKGFb
Ml0sIDIpOworCXN1bSArPSBhWzFdOworCXN1bSArPSBhWzNdOworCisJcmV0dXJuIHN1bSA+PiAy
OworfQorCitzdGF0aWMgaW50IHBlcmZfbWlfYmJfc3RhcnQodm9pZCAqYXJnKQoreworCXN0cnVj
dCBpbnRlbF9ndCAqZ3QgPSBhcmc7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwor
CWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOworCWludCBlcnIgPSAwOworCisJaWYgKElOVEVMX0dF
TihndC0+aTkxNSkgPCA3KSAvKiBmb3IgcGVyLWVuZ2luZSBDU19USU1FU1RBTVAgKi8KKwkJcmV0
dXJuIDA7CisKKwlwZXJmX2JlZ2luKGd0KTsKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwg
aWQpIHsKKwkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlID0gZW5naW5lLT5rZXJuZWxfY29udGV4
dDsKKwkJc3RydWN0IGk5MTVfdm1hICpiYXRjaDsKKwkJdTMyIGN5Y2xlc1tDT1VOVF07CisJCWlu
dCBpOworCisJCWJhdGNoID0gY3JlYXRlX2VtcHR5X2JhdGNoKGNlKTsKKwkJaWYgKElTX0VSUihi
YXRjaCkpIHsKKwkJCWVyciA9IFBUUl9FUlIoYmF0Y2gpOworCQkJYnJlYWs7CisJCX0KKworCQll
cnIgPSBpOTE1X3ZtYV9zeW5jKGJhdGNoKTsKKwkJaWYgKGVycikgeworCQkJaTkxNV92bWFfcHV0
KGJhdGNoKTsKKwkJCWJyZWFrOworCQl9CisKKwkJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUo
Y3ljbGVzKTsgaSsrKSB7CisJCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKKworCQkJcnEgPSBp
OTE1X3JlcXVlc3RfY3JlYXRlKGNlKTsKKwkJCWlmIChJU19FUlIocnEpKSB7CisJCQkJZXJyID0g
UFRSX0VSUihycSk7CisJCQkJYnJlYWs7CisJCQl9CisKKwkJCWVyciA9IHdyaXRlX3RpbWVzdGFt
cChycSwgMik7CisJCQlpZiAoZXJyKQorCQkJCWdvdG8gb3V0OworCisJCQllcnIgPSBycS0+ZW5n
aW5lLT5lbWl0X2JiX3N0YXJ0KHJxLAorCQkJCQkJCWJhdGNoLT5ub2RlLnN0YXJ0LCA4LAorCQkJ
CQkJCTApOworCQkJaWYgKGVycikKKwkJCQlnb3RvIG91dDsKKworCQkJZXJyID0gd3JpdGVfdGlt
ZXN0YW1wKHJxLCAzKTsKKwkJCWlmIChlcnIpCisJCQkJZ290byBvdXQ7CisKK291dDoKKwkJCWk5
MTVfcmVxdWVzdF9nZXQocnEpOworCQkJaTkxNV9yZXF1ZXN0X2FkZChycSk7CisKKwkJCWlmIChp
OTE1X3JlcXVlc3Rfd2FpdChycSwgMCwgSFogLyA1KSA8IDApCisJCQkJZXJyID0gLUVJTzsKKwkJ
CWk5MTVfcmVxdWVzdF9wdXQocnEpOworCQkJaWYgKGVycikKKwkJCQlicmVhazsKKworCQkJY3lj
bGVzW2ldID0gcnEtPmh3c3Bfc2Vxbm9bM10gLSBycS0+aHdzcF9zZXFub1syXTsKKwkJfQorCQlp
OTE1X3ZtYV9wdXQoYmF0Y2gpOworCQlpZiAoZXJyKQorCQkJYnJlYWs7CisKKwkJcHJfaW5mbygi
JXM6IE1JX0JCX1NUQVJUIGN5Y2xlczogJXVcbiIsCisJCQllbmdpbmUtPm5hbWUsIHRyaWZpbHRl
cihjeWNsZXMpKTsKKwl9CisJaWYgKHBlcmZfZW5kKGd0KSkKKwkJZXJyID0gLUVJTzsKKworCXJl
dHVybiBlcnI7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKmNyZWF0ZV9ub3BfYmF0Y2go
c3RydWN0IGludGVsX2NvbnRleHQgKmNlKQoreworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmo7CisJc3RydWN0IGk5MTVfdm1hICp2bWE7CisJdTMyICpjczsKKwlpbnQgZXJyOworCisJ
b2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChjZS0+ZW5naW5lLT5pOTE1LCBT
Wl82NEspOworCWlmIChJU19FUlIob2JqKSkKKwkJcmV0dXJuIEVSUl9DQVNUKG9iaik7CisKKwlj
cyA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKG9iaiwgSTkxNV9NQVBfV0IpOworCWlmIChJU19F
UlIoY3MpKSB7CisJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwkJcmV0dXJuIEVSUl9DQVNU
KGNzKTsKKwl9CisKKwltZW1zZXQoY3MsIDAsIFNaXzY0Syk7CisJY3NbU1pfNjRLIC8gc2l6ZW9m
KCpjcykgLSAxXSA9IE1JX0JBVENIX0JVRkZFUl9FTkQ7CisKKwlpOTE1X2dlbV9vYmplY3RfZmx1
c2hfbWFwKG9iaik7CisJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChvYmopOworCisJdm1hID0g
aTkxNV92bWFfaW5zdGFuY2Uob2JqLCBjZS0+dm0sIE5VTEwpOworCWlmIChJU19FUlIodm1hKSkg
eworCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CisJCXJldHVybiB2bWE7CisJfQorCisJZXJy
ID0gaTkxNV92bWFfcGluKHZtYSwgMCwgMCwgUElOX1VTRVIpOworCWlmIChlcnIpIHsKKwkJaTkx
NV9nZW1fb2JqZWN0X3B1dChvYmopOworCQlyZXR1cm4gRVJSX1BUUihlcnIpOworCX0KKworCXJl
dHVybiB2bWE7Cit9CisKK3N0YXRpYyBpbnQgcGVyZl9taV9ub29wKHZvaWQgKmFyZykKK3sKKwlz
dHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZTsKKwllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKKwlpbnQgZXJyID0gMDsKKworCWlmIChJTlRF
TF9HRU4oZ3QtPmk5MTUpIDwgNykgLyogZm9yIHBlci1lbmdpbmUgQ1NfVElNRVNUQU1QICovCisJ
CXJldHVybiAwOworCisJcGVyZl9iZWdpbihndCk7CisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwg
Z3QsIGlkKSB7CisJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSA9IGVuZ2luZS0+a2VybmVsX2Nv
bnRleHQ7CisJCXN0cnVjdCBpOTE1X3ZtYSAqYmFzZSwgKm5vcDsKKwkJdTMyIGN5Y2xlc1tDT1VO
VF07CisJCWludCBpOworCisJCWJhc2UgPSBjcmVhdGVfZW1wdHlfYmF0Y2goY2UpOworCQlpZiAo
SVNfRVJSKGJhc2UpKSB7CisJCQllcnIgPSBQVFJfRVJSKGJhc2UpOworCQkJYnJlYWs7CisJCX0K
KworCQllcnIgPSBpOTE1X3ZtYV9zeW5jKGJhc2UpOworCQlpZiAoZXJyKSB7CisJCQlpOTE1X3Zt
YV9wdXQoYmFzZSk7CisJCQlicmVhazsKKwkJfQorCisJCW5vcCA9IGNyZWF0ZV9ub3BfYmF0Y2go
Y2UpOworCQlpZiAoSVNfRVJSKG5vcCkpIHsKKwkJCWVyciA9IFBUUl9FUlIobm9wKTsKKwkJCWk5
MTVfdm1hX3B1dChiYXNlKTsKKwkJCWJyZWFrOworCQl9CisKKwkJZXJyID0gaTkxNV92bWFfc3lu
Yyhub3ApOworCQlpZiAoZXJyKSB7CisJCQlpOTE1X3ZtYV9wdXQobm9wKTsKKwkJCWk5MTVfdm1h
X3B1dChiYXNlKTsKKwkJCWJyZWFrOworCQl9CisKKwkJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJ
WkUoY3ljbGVzKTsgaSsrKSB7CisJCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKKworCQkJcnEg
PSBpOTE1X3JlcXVlc3RfY3JlYXRlKGNlKTsKKwkJCWlmIChJU19FUlIocnEpKSB7CisJCQkJZXJy
ID0gUFRSX0VSUihycSk7CisJCQkJYnJlYWs7CisJCQl9CisKKwkJCWVyciA9IHdyaXRlX3RpbWVz
dGFtcChycSwgMik7CisJCQlpZiAoZXJyKQorCQkJCWdvdG8gb3V0OworCisJCQllcnIgPSBycS0+
ZW5naW5lLT5lbWl0X2JiX3N0YXJ0KHJxLAorCQkJCQkJCWJhc2UtPm5vZGUuc3RhcnQsIDgsCisJ
CQkJCQkJMCk7CisJCQlpZiAoZXJyKQorCQkJCWdvdG8gb3V0OworCisJCQllcnIgPSB3cml0ZV90
aW1lc3RhbXAocnEsIDMpOworCQkJaWYgKGVycikKKwkJCQlnb3RvIG91dDsKKworCQkJZXJyID0g
cnEtPmVuZ2luZS0+ZW1pdF9iYl9zdGFydChycSwKKwkJCQkJCQlub3AtPm5vZGUuc3RhcnQsIDQw
OTYsCisJCQkJCQkJMCk7CisJCQlpZiAoZXJyKQorCQkJCWdvdG8gb3V0OworCisJCQllcnIgPSB3
cml0ZV90aW1lc3RhbXAocnEsIDQpOworCQkJaWYgKGVycikKKwkJCQlnb3RvIG91dDsKKworb3V0
OgorCQkJaTkxNV9yZXF1ZXN0X2dldChycSk7CisJCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKwor
CQkJaWYgKGk5MTVfcmVxdWVzdF93YWl0KHJxLCAwLCBIWiAvIDUpIDwgMCkKKwkJCQllcnIgPSAt
RUlPOworCQkJaTkxNV9yZXF1ZXN0X3B1dChycSk7CisJCQlpZiAoZXJyKQorCQkJCWJyZWFrOwor
CisJCQljeWNsZXNbaV0gPQorCQkJCShycS0+aHdzcF9zZXFub1s0XSAtIHJxLT5od3NwX3NlcW5v
WzNdKSAtCisJCQkJKHJxLT5od3NwX3NlcW5vWzNdIC0gcnEtPmh3c3Bfc2Vxbm9bMl0pOworCQl9
CisJCWk5MTVfdm1hX3B1dChub3ApOworCQlpOTE1X3ZtYV9wdXQoYmFzZSk7CisJCWlmIChlcnIp
CisJCQlicmVhazsKKworCQlwcl9pbmZvKCIlczogMTZLIE1JX05PT1AgY3ljbGVzOiAldVxuIiwK
KwkJCWVuZ2luZS0+bmFtZSwgdHJpZmlsdGVyKGN5Y2xlcykpOworCX0KKwlpZiAocGVyZl9lbmQo
Z3QpKQorCQllcnIgPSAtRUlPOworCisJcmV0dXJuIGVycjsKK30KKworaW50IGludGVsX2VuZ2lu
ZV9jc19wZXJmX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3sKKwlz
dGF0aWMgY29uc3Qgc3RydWN0IGk5MTVfc3VidGVzdCB0ZXN0c1tdID0geworCQlTVUJURVNUKHBl
cmZfbWlfYmJfc3RhcnQpLAorCQlTVUJURVNUKHBlcmZfbWlfbm9vcCksCisJfTsKKworCWlmIChp
bnRlbF9ndF9pc193ZWRnZWQoJmk5MTUtPmd0KSkKKwkJcmV0dXJuIDA7CisKKwlyZXR1cm4gaW50
ZWxfZ3RfbGl2ZV9zdWJ0ZXN0cyh0ZXN0cywgJmk5MTUtPmd0KTsKK30KIAogc3RhdGljIGludCBp
bnRlbF9tbWlvX2Jhc2VzX2NoZWNrKHZvaWQgKmFyZykKIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfcGNpLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BjaS5j
CmluZGV4IDFiYjcwMWQzMmE1ZC4uZGEzZTliNTc1MmFjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3BjaS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNp
LmMKQEAgLTEwMDMsNiArMTAwMywxMiBAQCBzdGF0aWMgaW50IGk5MTVfcGNpX3Byb2JlKHN0cnVj
dCBwY2lfZGV2ICpwZGV2LCBjb25zdCBzdHJ1Y3QgcGNpX2RldmljZV9pZCAqZW50KQogCQlyZXR1
cm4gZXJyID4gMCA/IC1FTk9UVFkgOiBlcnI7CiAJfQogCisJZXJyID0gaTkxNV9wZXJmX3NlbGZ0
ZXN0cyhwZGV2KTsKKwlpZiAoZXJyKSB7CisJCWk5MTVfcGNpX3JlbW92ZShwZGV2KTsKKwkJcmV0
dXJuIGVyciA+IDAgPyAtRU5PVFRZIDogZXJyOworCX0KKwogCXJldHVybiAwOwogfQogCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NlbGZ0ZXN0LmggYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3NlbGZ0ZXN0LmgKaW5kZXggNGQ4ODIwNWRlNTFiLi45OGJjYjZmYTBh
YjQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2VsZnRlc3QuaAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NlbGZ0ZXN0LmgKQEAgLTM2LDYgKzM2LDcgQEAg
c3RydWN0IGk5MTVfc2VsZnRlc3QgewogCWNoYXIgKmZpbHRlcjsKIAlpbnQgbW9jazsKIAlpbnQg
bGl2ZTsKKwlpbnQgcGVyZjsKIH07CiAKICNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9T
RUxGVEVTVCkKQEAgLTQ1LDYgKzQ2LDcgQEAgZXh0ZXJuIHN0cnVjdCBpOTE1X3NlbGZ0ZXN0IGk5
MTVfc2VsZnRlc3Q7CiAKIGludCBpOTE1X21vY2tfc2VsZnRlc3RzKHZvaWQpOwogaW50IGk5MTVf
bGl2ZV9zZWxmdGVzdHMoc3RydWN0IHBjaV9kZXYgKnBkZXYpOworaW50IGk5MTVfcGVyZl9zZWxm
dGVzdHMoc3RydWN0IHBjaV9kZXYgKnBkZXYpOwogCiAvKiBXZSBleHRyYWN0IHRoZSBmdW5jdGlv
biBkZWNsYXJhdGlvbnMgZnJvbSBpOTE1X21vY2tfc2VsZnRlc3RzLmggYW5kCiAgKiBpOTE1X2xp
dmVfc2VsZnRlc3RzLmggQWRkIHlvdXIgdW5pdCB0ZXN0IGRlY2xhcmF0aW9ucyB0aGVyZSEKQEAg
LTYxLDYgKzYzLDcgQEAgaW50IGk5MTVfbGl2ZV9zZWxmdGVzdHMoc3RydWN0IHBjaV9kZXYgKnBk
ZXYpOwogI3VuZGVmIHNlbGZ0ZXN0CiAjZGVmaW5lIHNlbGZ0ZXN0KG5hbWUsIGZ1bmMpIGludCBm
dW5jKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKICNpbmNsdWRlICJzZWxmdGVzdHMv
aTkxNV9saXZlX3NlbGZ0ZXN0cy5oIgorI2luY2x1ZGUgInNlbGZ0ZXN0cy9pOTE1X3BlcmZfc2Vs
ZnRlc3RzLmgiCiAjdW5kZWYgc2VsZnRlc3QKIAogc3RydWN0IGk5MTVfc3VidGVzdCB7CkBAIC0x
MDksNiArMTEyLDcgQEAgaW50IF9faTkxNV9zdWJ0ZXN0cyhjb25zdCBjaGFyICpjYWxsZXIsCiAK
IHN0YXRpYyBpbmxpbmUgaW50IGk5MTVfbW9ja19zZWxmdGVzdHModm9pZCkgeyByZXR1cm4gMDsg
fQogc3RhdGljIGlubGluZSBpbnQgaTkxNV9saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgcGNpX2RldiAq
cGRldikgeyByZXR1cm4gMDsgfQorc3RhdGljIGlubGluZSBpbnQgaTkxNV9wZXJmX3NlbGZ0ZXN0
cyhzdHJ1Y3QgcGNpX2RldiAqcGRldikgeyByZXR1cm4gMDsgfQogCiAjZGVmaW5lIEk5MTVfU0VM
RlRFU1RfREVDTEFSRSh4KQogI2RlZmluZSBJOTE1X1NFTEZURVNUX09OTFkoeCkgMApkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcGVyZl9zZWxmdGVzdHMu
aCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3BlcmZfc2VsZnRlc3RzLmgK
bmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5mNzEyOWEyNDNkYWEKLS0t
IC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9wZXJm
X3NlbGZ0ZXN0cy5oCkBAIC0wLDAgKzEsMTMgQEAKKy8qIFNQRFgtTGljZW5zZS1JZGVudGlmaWVy
OiBHUEwtMi4wICovCisvKiBMaXN0IGVhY2ggdW5pdCB0ZXN0IGFzIHNlbGZ0ZXN0KG5hbWUsIGZ1
bmN0aW9uKQorICoKKyAqIFRoZSBuYW1lIGlzIHVzZWQgYXMgYm90aCBhbiBlbnVtIGFuZCBleHBh
bmRlZCBhcyBzdWJ0ZXN0X19uYW1lIHRvIGNyZWF0ZQorICogYSBtb2R1bGUgcGFyYW1ldGVyLiBJ
dCBtdXN0IGJlIHVuaXF1ZSBhbmQgbGVnYWwgZm9yIGEgQyBpZGVudGlmaWVyLgorICoKKyAqIFRo
ZSBmdW5jdGlvbiBzaG91bGQgYmUgb2YgdHlwZSBpbnQgZnVuY3Rpb24odm9pZCkuIEl0IG1heSBi
ZSBjb25kaXRpb25hbGx5CisgKiBjb21waWxlZCB1c2luZyAjaWYgSVNfRU5BQkxFRChEUk1fSTkx
NV9TRUxGVEVTVCkuCisgKgorICogVGVzdHMgYXJlIGV4ZWN1dGVkIGluIG9yZGVyIGJ5IGlndC9p
OTE1X3NlbGZ0ZXN0CisgKi8KK3NlbGZ0ZXN0KGVuZ2luZV9jcywgaW50ZWxfZW5naW5lX2NzX3Bl
cmZfc2VsZnRlc3RzKQorc2VsZnRlc3QoYmx0LCBpOTE1X2dlbV9vYmplY3RfYmx0X3BlcmZfc2Vs
ZnRlc3RzKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVf
c2VsZnRlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3NlbGZ0ZXN0
LmMKaW5kZXggYTZjY2E0YWQ5NmY2Li5kM2JmOWVlZmI2ODIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3NlbGZ0ZXN0LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfc2VsZnRlc3QuYwpAQCAtNTcsNiArNTcsMTIgQEAgZW51
bSB7CiAjdW5kZWYgc2VsZnRlc3QKIH07CiAKK2VudW0geworI2RlZmluZSBzZWxmdGVzdChuYW1l
LCBmdW5jKSBwZXJmXyMjbmFtZSwKKyNpbmNsdWRlICJpOTE1X3BlcmZfc2VsZnRlc3RzLmgiCisj
dW5kZWYgc2VsZnRlc3QKK307CisKIHN0cnVjdCBzZWxmdGVzdCB7CiAJYm9vbCBlbmFibGVkOwog
CWNvbnN0IGNoYXIgKm5hbWU7CkBAIC03OCw2ICs4NCwxMiBAQCBzdGF0aWMgc3RydWN0IHNlbGZ0
ZXN0IGxpdmVfc2VsZnRlc3RzW10gPSB7CiB9OwogI3VuZGVmIHNlbGZ0ZXN0CiAKKyNkZWZpbmUg
c2VsZnRlc3QobiwgZikgW3BlcmZfIyNuXSA9IHsgLm5hbWUgPSAjbiwgeyAubGl2ZSA9IGYgfSB9
LAorc3RhdGljIHN0cnVjdCBzZWxmdGVzdCBwZXJmX3NlbGZ0ZXN0c1tdID0geworI2luY2x1ZGUg
Imk5MTVfcGVyZl9zZWxmdGVzdHMuaCIKK307CisjdW5kZWYgc2VsZnRlc3QKKwogLyogRW1iZWQg
dGhlIGxpbmUgbnVtYmVyIGludG8gdGhlIHBhcmFtZXRlciBuYW1lIHNvIHRoYXQgd2UgY2FuIG9y
ZGVyIHRlc3RzICovCiAjZGVmaW5lIHNlbGZ0ZXN0KG4sIGZ1bmMpIHNlbGZ0ZXN0XzAobiwgZnVu
YywgcGFyYW0obikpCiAjZGVmaW5lIHBhcmFtKG4pIF9fUEFTVEUoaWd0X18sIF9fUEFTVEUoX19M
SU5FX18sIF9fbW9ja18jI24pKQpAQCAtOTMsNiArMTA1LDEzIEBAIG1vZHVsZV9wYXJhbV9uYW1l
ZChpZCwgbGl2ZV9zZWxmdGVzdHNbbGl2ZV8jI25dLmVuYWJsZWQsIGJvb2wsIDA0MDApOwogI2lu
Y2x1ZGUgImk5MTVfbGl2ZV9zZWxmdGVzdHMuaCIKICN1bmRlZiBzZWxmdGVzdF8wCiAjdW5kZWYg
cGFyYW0KKworI2RlZmluZSBwYXJhbShuKSBfX1BBU1RFKGlndF9fLCBfX1BBU1RFKF9fTElORV9f
LCBfX3BlcmZfIyNuKSkKKyNkZWZpbmUgc2VsZnRlc3RfMChuLCBmdW5jLCBpZCkgXAorbW9kdWxl
X3BhcmFtX25hbWVkKGlkLCBwZXJmX3NlbGZ0ZXN0c1twZXJmXyMjbl0uZW5hYmxlZCwgYm9vbCwg
MDQwMCk7CisjaW5jbHVkZSAiaTkxNV9wZXJmX3NlbGZ0ZXN0cy5oIgorI3VuZGVmIHNlbGZ0ZXN0
XzAKKyN1bmRlZiBwYXJhbQogI3VuZGVmIHNlbGZ0ZXN0CiAKIHN0YXRpYyB2b2lkIHNldF9kZWZh
dWx0X3Rlc3RfYWxsKHN0cnVjdCBzZWxmdGVzdCAqc3QsIHVuc2lnbmVkIGludCBjb3VudCkKQEAg
LTIwMCw2ICsyMTksMjcgQEAgaW50IGk5MTVfbGl2ZV9zZWxmdGVzdHMoc3RydWN0IHBjaV9kZXYg
KnBkZXYpCiAJcmV0dXJuIDA7CiB9CiAKK2ludCBpOTE1X3BlcmZfc2VsZnRlc3RzKHN0cnVjdCBw
Y2lfZGV2ICpwZGV2KQoreworCWludCBlcnI7CisKKwlpZiAoIWk5MTVfc2VsZnRlc3QucGVyZikK
KwkJcmV0dXJuIDA7CisKKwllcnIgPSBydW5fc2VsZnRlc3RzKHBlcmYsIHBkZXZfdG9faTkxNShw
ZGV2KSk7CisJaWYgKGVycikgeworCQlpOTE1X3NlbGZ0ZXN0LnBlcmYgPSBlcnI7CisJCXJldHVy
biBlcnI7CisJfQorCisJaWYgKGk5MTVfc2VsZnRlc3QucGVyZiA8IDApIHsKKwkJaTkxNV9zZWxm
dGVzdC5wZXJmID0gLUVOT1RUWTsKKwkJcmV0dXJuIDE7CisJfQorCisJcmV0dXJuIDA7Cit9CisK
IHN0YXRpYyBib29sIGFwcGx5X3N1YnRlc3RfZmlsdGVyKGNvbnN0IGNoYXIgKmNhbGxlciwgY29u
c3QgY2hhciAqbmFtZSkKIHsKIAljaGFyICpmaWx0ZXIsICpzZXAsICp0b2s7CkBAIC0zNjUsMyAr
NDA1LDYgQEAgTU9EVUxFX1BBUk1fREVTQyhtb2NrX3NlbGZ0ZXN0cywgIlJ1biBzZWxmdGVzdHMg
YmVmb3JlIGxvYWRpbmcsIHVzaW5nIG1vY2sgaGFyZHcKIAogbW9kdWxlX3BhcmFtX25hbWVkX3Vu
c2FmZShsaXZlX3NlbGZ0ZXN0cywgaTkxNV9zZWxmdGVzdC5saXZlLCBpbnQsIDA0MDApOwogTU9E
VUxFX1BBUk1fREVTQyhsaXZlX3NlbGZ0ZXN0cywgIlJ1biBzZWxmdGVzdHMgYWZ0ZXIgZHJpdmVy
IGluaXRpYWxpc2F0aW9uIG9uIHRoZSBsaXZlIHN5c3RlbSAoMDpkaXNhYmxlZCBbZGVmYXVsdF0s
IDE6cnVuIHRlc3RzIHRoZW4gY29udGludWUsIC0xOnJ1biB0ZXN0cyB0aGVuIGV4aXQgbW9kdWxl
KSIpOworCittb2R1bGVfcGFyYW1fbmFtZWRfdW5zYWZlKHBlcmZfc2VsZnRlc3RzLCBpOTE1X3Nl
bGZ0ZXN0LnBlcmYsIGludCwgMDQwMCk7CitNT0RVTEVfUEFSTV9ERVNDKHBlcmZfc2VsZnRlc3Rz
LCAiUnVuIHBlcmZvcm1hbmNlIG9yaWVudGF0ZWQgc2VsZnRlc3RzIGFmdGVyIGRyaXZlciBpbml0
aWFsaXNhdGlvbiBvbiB0aGUgbGl2ZSBzeXN0ZW0gKDA6ZGlzYWJsZWQgW2RlZmF1bHRdLCAxOnJ1
biB0ZXN0cyB0aGVuIGNvbnRpbnVlLCAtMTpydW4gdGVzdHMgdGhlbiBleGl0IG1vZHVsZSkiKTsK
LS0gCjIuMjQuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
Cmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 924068F1D4
	for <lists+intel-gfx@lfdr.de>; Thu, 15 Aug 2019 19:15:57 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D91BA6E43A;
	Thu, 15 Aug 2019 17:15:55 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga18.intel.com (mga18.intel.com [134.134.136.126])
 by gabe.freedesktop.org (Postfix) with ESMTPS id DA0006E43A
 for <intel-gfx@lists.freedesktop.org>; Thu, 15 Aug 2019 17:15:54 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga003.jf.intel.com ([10.7.209.27])
 by orsmga106.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 15 Aug 2019 10:12:40 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,389,1559545200"; d="scan'208";a="179425246"
Received: from irvmail001.ir.intel.com ([163.33.26.43])
 by orsmga003.jf.intel.com with ESMTP; 15 Aug 2019 10:12:33 -0700
Received: from mwajdecz-MOBL1.ger.corp.intel.com
 (mwajdecz-mobl1.ger.corp.intel.com [10.249.129.244])
 by irvmail001.ir.intel.com (8.14.3/8.13.6/MailSET/Hub) with ESMTP id
 x7FHCU6l030661; Thu, 15 Aug 2019 18:12:32 +0100
From: Michal Wajdeczko <michal.wajdeczko@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 15 Aug 2019 17:12:26 +0000
Message-Id: <20190815171228.31920-4-michal.wajdeczko@intel.com>
X-Mailer: git-send-email 2.21.0.windows.1
In-Reply-To: <20190815171228.31920-1-michal.wajdeczko@intel.com>
References: <20190815171228.31920-1-michal.wajdeczko@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 3/5] drm/i915/wopcm: Try to use already locked
 WOPCM layout
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SWYgV09QQ00gbGF5b3V0IGlzIGFscmVhZHkgbG9ja2VkIGluIEhXIHdlIHNob3VsZG4ndCBjb250
aW51ZQp3aXRoIG91ciBvd24gcGFydGl0aW9uaW5nIGFzIGl0IGNvdWxkIGJlIGxpa2VseSBkaWZm
ZXJlbnQgYW5kCndlIHdpbGwgYmUgdW5hYmxlIHRvIGVuZm9yY2UgaXQgYW5kIGZhaWwuIEluc3Rl
YWQgd2Ugc2hvdWxkIHRyeQp0byByZXVzZSB3aGF0IGlzIGFscmVhZHkgcHJvZ3JhbW1lZCwgbWF5
YmUgdGhlcmUgd2lsbCBiZSBhIGZpdC4KClRoaXMgc2hvdWxkIGVuYWJsZSB1cyB0byByZWxvYWQg
ZHJpdmVyIHdpdGggc2xpZ2h0bHkgZGlmZmVyZW50Ckh1QyBmaXJtd2FyZSAob3IgZXZlbiB3aXRo
b3V0IEh1Qykgd2l0aG91dCBuZWVkIHRvIHJlYm9vdC4KCnYyOiByZW9yZGVyZWQvcmViYXNlZAoK
U2lnbmVkLW9mZi1ieTogTWljaGFsIFdhamRlY3prbyA8bWljaGFsLndhamRlY3prb0BpbnRlbC5j
b20+CkNjOiBEYW5pZWxlIENlcmFvbG8gU3B1cmlvIDxkYW5pZWxlLmNlcmFvbG9zcHVyaW9AaW50
ZWwuY29tPgpDYzogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBN
aWNoYWwgV2luaWFyc2tpIDxtaWNoYWwud2luaWFyc2tpQGludGVsLmNvbT4KLS0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9pbnRlbF93b3BjbS5jIHwgMjkgKysrKysrKysrKysrKysrKysrKysrKysr
KysrLS0KIDEgZmlsZSBjaGFuZ2VkLCAyNyBpbnNlcnRpb25zKCspLCAyIGRlbGV0aW9ucygtKQoK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dvcGNtLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pbnRlbF93b3BjbS5jCmluZGV4IDNhYzA1MDU1YmIwOC4uZWEwMmVmYjY1
M2E3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF93b3BjbS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dvcGNtLmMKQEAgLTIxMiw2ICsyMTIsMjEgQEAg
c3RhdGljIGlubGluZSBib29sIF9fY2hlY2tfbGF5b3V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LCB1MzIgd29wY21fc2l6ZSwKIAkJCQkgICAgIGh1Y19md19zaXplKTsKIH0KIAorc3Rh
dGljIGJvb2wgX193b3BjbV9yZWdzX2xvY2tlZChzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUs
CisJCQkJdTMyICpndWNfd29wY21fYmFzZSwgdTMyICpndWNfd29wY21fc2l6ZSkKK3sKKwl1MzIg
cmVnX2Jhc2UgPSBpbnRlbF91bmNvcmVfcmVhZCh1bmNvcmUsIERNQV9HVUNfV09QQ01fT0ZGU0VU
KTsKKwl1MzIgcmVnX3NpemUgPSBpbnRlbF91bmNvcmVfcmVhZCh1bmNvcmUsIEdVQ19XT1BDTV9T
SVpFKTsKKworCWlmICghKHJlZ19zaXplICYgR1VDX1dPUENNX1NJWkVfTE9DS0VEKSB8fAorCSAg
ICAhKHJlZ19iYXNlICYgR1VDX1dPUENNX09GRlNFVF9WQUxJRCkpCisJCXJldHVybiBmYWxzZTsK
KworCSpndWNfd29wY21fYmFzZSA9IHJlZ19iYXNlICYgR1VDX1dPUENNX09GRlNFVF9NQVNLOwor
CSpndWNfd29wY21fc2l6ZSA9IHJlZ19zaXplICYgR1VDX1dPUENNX1NJWkVfTUFTSzsKKwlyZXR1
cm4gdHJ1ZTsKK30KKwogLyoqCiAgKiBpbnRlbF93b3BjbV9pbml0KCkgLSBJbml0aWFsaXplIHRo
ZSBXT1BDTSBzdHJ1Y3R1cmUuCiAgKiBAd29wY206IHBvaW50ZXIgdG8gaW50ZWxfd29wY20uCkBA
IC0yMjUsOCArMjQwLDkgQEAgc3RhdGljIGlubGluZSBib29sIF9fY2hlY2tfbGF5b3V0KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1MzIgd29wY21fc2l6ZSwKIHZvaWQgaW50ZWxfd29w
Y21faW5pdChzdHJ1Y3QgaW50ZWxfd29wY20gKndvcGNtKQogewogCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gd29wY21fdG9faTkxNSh3b3BjbSk7Ci0JdTMyIGd1Y19md19zaXplID0g
aW50ZWxfdWNfZndfZ2V0X3VwbG9hZF9zaXplKCZpOTE1LT5ndC51Yy5ndWMuZncpOwotCXUzMiBo
dWNfZndfc2l6ZSA9IGludGVsX3VjX2Z3X2dldF91cGxvYWRfc2l6ZSgmaTkxNS0+Z3QudWMuaHVj
LmZ3KTsKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gJmk5MTUtPmd0OworCXUzMiBndWNfZndfc2l6
ZSA9IGludGVsX3VjX2Z3X2dldF91cGxvYWRfc2l6ZSgmZ3QtPnVjLmd1Yy5mdyk7CisJdTMyIGh1
Y19md19zaXplID0gaW50ZWxfdWNfZndfZ2V0X3VwbG9hZF9zaXplKCZndC0+dWMuaHVjLmZ3KTsK
IAl1MzIgY3R4X3JzdmQgPSBjb250ZXh0X3Jlc2VydmVkX3NpemUoaTkxNSk7CiAJdTMyIGd1Y193
b3BjbV9iYXNlOwogCXUzMiBndWNfd29wY21fc2l6ZTsKQEAgLTI0NCw2ICsyNjAsMTQgQEAgdm9p
ZCBpbnRlbF93b3BjbV9pbml0KHN0cnVjdCBpbnRlbF93b3BjbSAqd29wY20pCiAJaWYgKGk5MTVf
aW5qZWN0X3Byb2JlX2ZhaWx1cmUoaTkxNSkpCiAJCXJldHVybjsKIAorCWlmIChfX3dvcGNtX3Jl
Z3NfbG9ja2VkKGd0LT51bmNvcmUsICZndWNfd29wY21fYmFzZSwgJmd1Y193b3BjbV9zaXplKSkg
eworCQlEUk1fREVWX0RFQlVHX0RSSVZFUihpOTE1LT5kcm0uZGV2LAorCQkJCSAgICAgIkd1QyBX
T1BDTSBpcyBhbHJlYWR5IGxvY2tlZCBbJXVLLCAldUspXG4iLAorCQkJCSAgICAgZ3VjX3dvcGNt
X2Jhc2UgLyBTWl8xSywKKwkJCQkgICAgIGd1Y193b3BjbV9zaXplIC8gU1pfMUspOworCQlnb3Rv
IGNoZWNrOworCX0KKwogCWd1Y193b3BjbV9iYXNlID0gQUxJR04oaHVjX2Z3X3NpemUgKyBXT1BD
TV9SRVNFUlZFRF9TSVpFLAogCQkJICAgICAgIEdVQ19XT1BDTV9PRkZTRVRfQUxJR05NRU5UKTsK
IAlndWNfd29wY21fYmFzZSA9IG1heCh3b3BjbS0+c2l6ZSAtIGN0eF9yc3ZkLCBndWNfd29wY21f
YmFzZSk7CkBAIC0yNTQsNiArMjc4LDcgQEAgdm9pZCBpbnRlbF93b3BjbV9pbml0KHN0cnVjdCBp
bnRlbF93b3BjbSAqd29wY20pCiAJCQkgICAgICJDYWxjdWxhdGVkIEd1QyBXT1BDTSBSZWdpb246
IFsldUtpQiwgJXVLaUIpXG4iLAogCQkJICAgICBndWNfd29wY21fYmFzZSAvIFNaXzFLLCBndWNf
d29wY21fc2l6ZSAvIFNaXzFLKTsKIAorY2hlY2s6CiAJaWYgKF9fY2hlY2tfbGF5b3V0KGk5MTUs
IHdvcGNtLT5zaXplLCBndWNfd29wY21fYmFzZSwgZ3VjX3dvcGNtX3NpemUsCiAJCQkgICBndWNf
Zndfc2l6ZSwgaHVjX2Z3X3NpemUpKSB7CiAJCXdvcGNtLT5ndWMuYmFzZSA9IGd1Y193b3BjbV9i
YXNlOwotLSAKMi4xOS4yCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRl
bC1nZng=

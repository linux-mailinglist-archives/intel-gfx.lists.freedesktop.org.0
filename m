Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 0369CA1366
	for <lists+intel-gfx@lfdr.de>; Thu, 29 Aug 2019 10:12:42 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B6ED56E062;
	Thu, 29 Aug 2019 08:12:24 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9775F6E03A
 for <intel-gfx@lists.freedesktop.org>; Thu, 29 Aug 2019 08:12:07 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18299871-1500050 
 for multiple; Thu, 29 Aug 2019 09:11:55 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 29 Aug 2019 09:11:27 +0100
Message-Id: <20190829081150.10271-14-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190829081150.10271-1-chris@chris-wilson.co.uk>
References: <20190829081150.10271-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 13/36] drm/i915: Pull i915_vma_pin under the
 vm->mutex
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UmVwbGFjZSB0aGUgc3RydWN0X211dGV4IHJlcXVpcmVtZW50IGZvciBwaW5uaW5nIHRoZSBpOTE1
X3ZtYSB3aXRoIHRoZQpsb2NhbCB2bS0+bXV0ZXggaW5zdGVhZC4gTm90ZSB0aGF0IHRoZSB2bS0+
bXV0ZXggaXMgdGFpbnRlZCBieSB0aGUKc2hyaW5rZXIgKHdlIHJlcXVpcmUgdW5iaW5kaW5nIGZy
b20gaW5zaWRlIGZzLXJlY2xhaW0pIGFuZCBzbyB3ZSBjYW5ub3QKYWxsb2NhdGUgd2hpbGUgaG9s
ZGluZyB0aGF0IG11dGV4LiBJbnN0ZWFkIHdlIGhhdmUgdG8gcHJlYWxsb2NhdGUKd29ya2VycyB0
byBkbyBhbGxvY2F0ZSBhbmQgYXBwbHkgdGhlIFBURSB1cGRhdGVzIGFmdGVyIHdlIGhhdmUgd2UK
cmVzZXJ2ZWQgdGhlaXIgc2xvdCBpbiB0aGUgZHJtX21tICh1c2luZyBmZW5jZXMgdG8gb3JkZXIg
dGhlIFBURSB3cml0ZXMKd2l0aCB0aGUgR1BVIHdvcmsgYW5kIHdpdGggbGF0ZXIgdW5iaW5kKS4K
ClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgot
LS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jICB8ICAzMCAr
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmRldi5jICAgIHwgICA4ICst
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYyAgfCAgMTEgKy0K
IC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsaWVudF9ibHQuYyAgICB8ICAyMiArLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYyAgIHwgIDIwICstCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMgICAgfCAgMTkgKy0KIC4u
Li9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyAgICB8ICAxMyArLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYyAgICAgIHwgIDIxICstCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMgICAgfCAgMzMgKy0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaCAgICB8ICAgNSArCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYyAgfCAgNjcgLS0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc3RvbGVuLmMgICAgfCAgIDcgKy0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV90aWxpbmcuYyAgICB8ICAxNSArLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYyAgIHwgIDI3ICstCiAuLi4vZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jICAgfCAgMjMgKy0KIC4uLi9kcm0vaTkx
NS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyB8ICAxMiArLQogLi4uL2RybS9pOTE1
L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jICAgIHwgICAyIC0KIC4uLi9kcm0vaTkxNS9n
ZW0vc2VsZnRlc3RzL2lndF9nZW1fdXRpbHMuYyAgICB8ICAgNyArLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfZ3QuYyAgICAgICAgICAgIHwgICA1ICstCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMgICAgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jICB8ICAxOSArLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Z0L2FwZXJ0dXJlX2dtLmMgICAgICAgIHwgIDEyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2FjdGl2ZS5jICAgICAgICAgICAgfCAgNjYgKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2FjdGl2ZS5oICAgICAgICAgICAgfCAgIDIgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9hY3RpdmVfdHlwZXMuaCAgICAgIHwgICA1ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ2VtLmMgICAgICAgICAgICAgICB8ICA4NyArKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9ldmljdC5jICAgICAgICAgfCAgMjAgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ2VtX2ZlbmNlX3JlZy5jICAgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9nZW1fZ3R0LmMgICAgICAgICAgIHwgMTA0ICsrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ2VtX2d0dC5oICAgICAgICAgICB8ICAzMSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9wZXJmLmMgICAgICAgICAgICAgIHwgIDI2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3ZtYS5jICAgICAgICAgICAgICAgfCA0NjIgKysrKysrKysrKysrLS0tLS0tCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3ZtYS5oICAgICAgICAgICAgICAgfCAgNTYgKy0tCiAuLi4vZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5jICAgfCAgMzYgKy0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ndHQuYyB8ICA5MSArKy0tCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYyAgICAgfCAgIDggKy0KIDM2IGZpbGVzIGNo
YW5nZWQsIDc3NiBpbnNlcnRpb25zKCspLCA2MDQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRleCA0NzczODMyYjBmNDkuLjJi
YjUxZjQ1YmZkMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5LmMKQEAgLTIwNzksOCArMjA3OSw2IEBAIGludGVsX3Bpbl9hbmRfZmVuY2VfZmJfb2JqKHN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAogCXVuc2lnbmVkIGludCBwaW5jdGw7CiAJdTMyIGFs
aWdubWVudDsKIAotCVdBUk5fT04oIW11dGV4X2lzX2xvY2tlZCgmZGV2LT5zdHJ1Y3RfbXV0ZXgp
KTsKLQogCWFsaWdubWVudCA9IGludGVsX3N1cmZfYWxpZ25tZW50KGZiLCAwKTsKIAogCS8qIE5v
dGUgdGhhdCB0aGUgdy9hIGFsc28gcmVxdWlyZXMgNjQgUFRFIG9mIHBhZGRpbmcgZm9sbG93aW5n
IHRoZQpAQCAtMjE2MSw4ICsyMTU5LDYgQEAgaW50ZWxfcGluX2FuZF9mZW5jZV9mYl9vYmooc3Ry
dWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCiAKIHZvaWQgaW50ZWxfdW5waW5fZmJfdm1hKHN0cnVj
dCBpOTE1X3ZtYSAqdm1hLCB1bnNpZ25lZCBsb25nIGZsYWdzKQogewotCWxvY2tkZXBfYXNzZXJ0
X2hlbGQoJnZtYS0+dm0tPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJaTkxNV9nZW1fb2Jq
ZWN0X2xvY2sodm1hLT5vYmopOwogCWlmIChmbGFncyAmIFBMQU5FX0hBU19GRU5DRSkKIAkJaTkx
NV92bWFfdW5waW5fZmVuY2Uodm1hKTsKQEAgLTMwNjMsMTIgKzMwNTksMTAgQEAgaW50ZWxfYWxs
b2NfaW5pdGlhbF9wbGFuZV9vYmooc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCXJldHVybiBm
YWxzZTsKIAl9CiAKLQltdXRleF9sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CiAJb2JqID0gaTkx
NV9nZW1fb2JqZWN0X2NyZWF0ZV9zdG9sZW5fZm9yX3ByZWFsbG9jYXRlZChkZXZfcHJpdiwKIAkJ
CQkJCQkgICAgIGJhc2VfYWxpZ25lZCwKIAkJCQkJCQkgICAgIGJhc2VfYWxpZ25lZCwKIAkJCQkJ
CQkgICAgIHNpemVfYWxpZ25lZCk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7
CiAJaWYgKCFvYmopCiAJCXJldHVybiBmYWxzZTsKIApAQCAtMzIzMCwxMyArMzIyNCwxMSBAQCBp
bnRlbF9maW5kX2luaXRpYWxfcGxhbmVfb2JqKHN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRj
LAogCWludGVsX3N0YXRlLT5jb2xvcl9wbGFuZVswXS5zdHJpZGUgPQogCQlpbnRlbF9mYl9waXRj
aChmYiwgMCwgaW50ZWxfc3RhdGUtPmJhc2Uucm90YXRpb24pOwogCi0JbXV0ZXhfbG9jaygmZGV2
LT5zdHJ1Y3RfbXV0ZXgpOwogCWludGVsX3N0YXRlLT52bWEgPQogCQlpbnRlbF9waW5fYW5kX2Zl
bmNlX2ZiX29iaihmYiwKIAkJCQkJICAgJmludGVsX3N0YXRlLT52aWV3LAogCQkJCQkgICBpbnRl
bF9wbGFuZV91c2VzX2ZlbmNlKGludGVsX3N0YXRlKSwKIAkJCQkJICAgJmludGVsX3N0YXRlLT5m
bGFncyk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CiAJaWYgKElTX0VSUihp
bnRlbF9zdGF0ZS0+dm1hKSkgewogCQlEUk1fRVJST1IoImZhaWxlZCB0byBwaW4gYm9vdCBmYiBv
biBwaXBlICVkOiAlbGlcbiIsCiAJCQkgIGludGVsX2NydGMtPnBpcGUsIFBUUl9FUlIoaW50ZWxf
c3RhdGUtPnZtYSkpOwpAQCAtMTQzMzgsOCArMTQzMzAsNiBAQCBzdGF0aWMgdm9pZCBmYl9vYmpf
YnVtcF9yZW5kZXJfcHJpb3JpdHkoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKICAq
IGJpdHMuICBTb21lIG9sZGVyIHBsYXRmb3JtcyBuZWVkIHNwZWNpYWwgcGh5c2ljYWwgYWRkcmVz
cyBoYW5kbGluZyBmb3IKICAqIGN1cnNvciBwbGFuZXMuCiAgKgotICogTXVzdCBiZSBjYWxsZWQg
d2l0aCBzdHJ1Y3RfbXV0ZXggaGVsZC4KLSAqCiAgKiBSZXR1cm5zIDAgb24gc3VjY2VzcywgbmVn
YXRpdmUgZXJyb3IgY29kZSBvbiBmYWlsdXJlLgogICovCiBpbnQKQEAgLTE0Mzk2LDE1ICsxNDM4
Niw4IEBAIGludGVsX3ByZXBhcmVfcGxhbmVfZmIoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJ
aWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAotCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJs
ZSgmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChyZXQpIHsKLQkJaTkxNV9nZW1f
b2JqZWN0X3VucGluX3BhZ2VzKG9iaik7Ci0JCXJldHVybiByZXQ7Ci0JfQotCiAJcmV0ID0gaW50
ZWxfcGxhbmVfcGluX2ZiKHRvX2ludGVsX3BsYW5lX3N0YXRlKG5ld19zdGF0ZSkpOwogCi0JbXV0
ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaTkxNV9nZW1fb2JqZWN0
X3VucGluX3BhZ2VzKG9iaik7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKQEAgLTE0NDUzLDgg
KzE0NDM2LDYgQEAgaW50ZWxfcHJlcGFyZV9wbGFuZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpwbGFu
ZSwKICAqIEBvbGRfc3RhdGU6IHRoZSBzdGF0ZSBmcm9tIHRoZSBwcmV2aW91cyBtb2Rlc2V0CiAg
KgogICogQ2xlYW5zIHVwIGEgZnJhbWVidWZmZXIgdGhhdCBoYXMganVzdCBiZWVuIHJlbW92ZWQg
ZnJvbSBhIHBsYW5lLgotICoKLSAqIE11c3QgYmUgY2FsbGVkIHdpdGggc3RydWN0X211dGV4IGhl
bGQuCiAgKi8KIHZvaWQKIGludGVsX2NsZWFudXBfcGxhbmVfZmIoc3RydWN0IGRybV9wbGFuZSAq
cGxhbmUsCkBAIC0xNDQ3MCw5ICsxNDQ1MSw3IEBAIGludGVsX2NsZWFudXBfcGxhbmVfZmIoc3Ry
dWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJfQogCiAJLyogU2hvdWxkIG9ubHkgYmUgY2FsbGVkIGFm
dGVyIGEgc3VjY2Vzc2Z1bCBpbnRlbF9wcmVwYXJlX3BsYW5lX2ZiKCkhICovCi0JbXV0ZXhfbG9j
aygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWludGVsX3BsYW5lX3VucGluX2ZiKHRv
X2ludGVsX3BsYW5lX3N0YXRlKG9sZF9zdGF0ZSkpOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogfQogCiBpbnQKQEAgLTE0NjcyLDcgKzE0NjUxLDYgQEAgaW50
ZWxfbGVnYWN5X2N1cnNvcl91cGRhdGUoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJCQkgICB1
MzIgc3JjX3csIHUzMiBzcmNfaCwKIAkJCSAgIHN0cnVjdCBkcm1fbW9kZXNldF9hY3F1aXJlX2N0
eCAqY3R4KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
Y3J0Yy0+ZGV2KTsKIAlzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpvbGRfcGxhbmVfc3RhdGUsICpu
ZXdfcGxhbmVfc3RhdGU7CiAJc3RydWN0IGludGVsX3BsYW5lICppbnRlbF9wbGFuZSA9IHRvX2lu
dGVsX3BsYW5lKHBsYW5lKTsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSA9
CkBAIC0xNDczOCwxMyArMTQ3MTYsOSBAQCBpbnRlbF9sZWdhY3lfY3Vyc29yX3VwZGF0ZShzdHJ1
Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAlpZiAocmV0KQogCQlnb3RvIG91dF9mcmVlOwogCi0JcmV0
ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7
Ci0JaWYgKHJldCkKLQkJZ290byBvdXRfZnJlZTsKLQogCXJldCA9IGludGVsX3BsYW5lX3Bpbl9m
Yih0b19pbnRlbF9wbGFuZV9zdGF0ZShuZXdfcGxhbmVfc3RhdGUpKTsKIAlpZiAocmV0KQotCQln
b3RvIG91dF91bmxvY2s7CisJCWdvdG8gb3V0X2ZyZWU7CiAKIAlpbnRlbF9mcm9udGJ1ZmZlcl9m
bHVzaCh0b19pbnRlbF9mcm9udGJ1ZmZlcihmYiksIE9SSUdJTl9GTElQKTsKIAlpbnRlbF9mcm9u
dGJ1ZmZlcl90cmFjayh0b19pbnRlbF9mcm9udGJ1ZmZlcihvbGRfcGxhbmVfc3RhdGUtPmZiKSwK
QEAgLTE0Nzc0LDggKzE0NzQ4LDYgQEAgaW50ZWxfbGVnYWN5X2N1cnNvcl91cGRhdGUoc3RydWN0
IGRybV9wbGFuZSAqcGxhbmUsCiAKIAlpbnRlbF9wbGFuZV91bnBpbl9mYih0b19pbnRlbF9wbGFu
ZV9zdGF0ZShvbGRfcGxhbmVfc3RhdGUpKTsKIAotb3V0X3VubG9jazoKLQltdXRleF91bmxvY2so
JmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIG91dF9mcmVlOgogCWlmIChuZXdfY3J0Y19z
dGF0ZSkKIAkJaW50ZWxfY3J0Y19kZXN0cm95X3N0YXRlKGNydGMsICZuZXdfY3J0Y19zdGF0ZS0+
YmFzZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Zi
ZGV2LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiZGV2LmMKaW5kZXgg
ZDU5ZWVlNWM1ZDljLi5hM2RlYTNmMmRhY2QgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZmJkZXYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2ZiZGV2LmMKQEAgLTIwNCw3ICsyMDQsNiBAQCBzdGF0aWMgaW50IGludGVsZmJf
Y3JlYXRlKHN0cnVjdCBkcm1fZmJfaGVscGVyICpoZWxwZXIsCiAJCXNpemVzLT5mYl9oZWlnaHQg
PSBpbnRlbF9mYi0+YmFzZS5oZWlnaHQ7CiAJfQogCi0JbXV0ZXhfbG9jaygmZGV2LT5zdHJ1Y3Rf
bXV0ZXgpOwogCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldCgmZGV2X3ByaXYtPnJ1bnRp
bWVfcG0pOwogCiAJLyogUGluIHRoZSBHR1RUIHZtYSBmb3Igb3VyIGFjY2VzcyB2aWEgaW5mby0+
c2NyZWVuX2Jhc2UuCkBAIC0yNjYsNyArMjY1LDYgQEAgc3RhdGljIGludCBpbnRlbGZiX2NyZWF0
ZShzdHJ1Y3QgZHJtX2ZiX2hlbHBlciAqaGVscGVyLAogCWlmYmRldi0+dm1hX2ZsYWdzID0gZmxh
Z3M7CiAKIAlpbnRlbF9ydW50aW1lX3BtX3B1dCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0sIHdha2Vy
ZWYpOwotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogCXZnYV9zd2l0Y2hlcm9v
X2NsaWVudF9mYl9zZXQocGRldiwgaW5mbyk7CiAJcmV0dXJuIDA7CiAKQEAgLTI3NCw3ICsyNzIs
NiBAQCBzdGF0aWMgaW50IGludGVsZmJfY3JlYXRlKHN0cnVjdCBkcm1fZmJfaGVscGVyICpoZWxw
ZXIsCiAJaW50ZWxfdW5waW5fZmJfdm1hKHZtYSwgZmxhZ3MpOwogb3V0X3VubG9jazoKIAlpbnRl
bF9ydW50aW1lX3BtX3B1dCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4
X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiByZXQ7CiB9CiAKQEAgLTI5MSwx
MSArMjg4LDggQEAgc3RhdGljIHZvaWQgaW50ZWxfZmJkZXZfZGVzdHJveShzdHJ1Y3QgaW50ZWxf
ZmJkZXYgKmlmYmRldikKIAogCWRybV9mYl9oZWxwZXJfZmluaSgmaWZiZGV2LT5oZWxwZXIpOwog
Ci0JaWYgKGlmYmRldi0+dm1hKSB7Ci0JCW11dGV4X2xvY2soJmlmYmRldi0+aGVscGVyLmRldi0+
c3RydWN0X211dGV4KTsKKwlpZiAoaWZiZGV2LT52bWEpCiAJCWludGVsX3VucGluX2ZiX3ZtYShp
ZmJkZXYtPnZtYSwgaWZiZGV2LT52bWFfZmxhZ3MpOwotCQltdXRleF91bmxvY2soJmlmYmRldi0+
aGVscGVyLmRldi0+c3RydWN0X211dGV4KTsKLQl9CiAKIAlpZiAoaWZiZGV2LT5mYikKIAkJZHJt
X2ZyYW1lYnVmZmVyX3JlbW92ZSgmaWZiZGV2LT5mYi0+YmFzZSk7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3ZlcmxheS5jCmluZGV4IDI5ZWRmYzM0MzcxNi4uNGYzNjU1
N2IzZjNiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292
ZXJsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXku
YwpAQCAtMTMwMywxNSArMTMwMywxMSBAQCBzdGF0aWMgaW50IGdldF9yZWdpc3RlcnMoc3RydWN0
IGludGVsX292ZXJsYXkgKm92ZXJsYXksIGJvb2wgdXNlX3BoeXMpCiAJc3RydWN0IGk5MTVfdm1h
ICp2bWE7CiAJaW50IGVycjsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwotCiAJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zdG9sZW4oaTkxNSwgUEFHRV9TSVpF
KTsKIAlpZiAob2JqID09IE5VTEwpCiAJCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50
ZXJuYWwoaTkxNSwgUEFHRV9TSVpFKTsKLQlpZiAoSVNfRVJSKG9iaikpIHsKLQkJZXJyID0gUFRS
X0VSUihvYmopOwotCQlnb3RvIGVycl91bmxvY2s7Ci0JfQorCWlmIChJU19FUlIob2JqKSkKKwkJ
cmV0dXJuIFBUUl9FUlIob2JqKTsKIAogCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3Bpbihv
YmosIE5VTEwsIDAsIDAsIFBJTl9NQVBQQUJMRSk7CiAJaWYgKElTX0VSUih2bWEpKSB7CkBAIC0x
MzMyLDEzICsxMzI4LDEwIEBAIHN0YXRpYyBpbnQgZ2V0X3JlZ2lzdGVycyhzdHJ1Y3QgaW50ZWxf
b3ZlcmxheSAqb3ZlcmxheSwgYm9vbCB1c2VfcGh5cykKIAl9CiAKIAlvdmVybGF5LT5yZWdfYm8g
PSBvYmo7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4g
MDsKIAogZXJyX3B1dF9ibzoKIAlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7Ci1lcnJfdW5sb2Nr
OgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsK
IH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsaWVu
dF9ibHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMK
aW5kZXggZjk5OTIwNjUyNzUxLi5lYzAyZmM2MmRiY2IgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX2NsaWVudF9ibHQuYwpAQCAtMTUyLDYgKzE1MiwyNiBAQCBzdGF0
aWMgdm9pZCBjbGVhcl9wYWdlc19kbWFfZmVuY2VfY2Ioc3RydWN0IGRtYV9mZW5jZSAqZmVuY2Us
CiAJaXJxX3dvcmtfcXVldWUoJnctPmlycV93b3JrKTsKIH0KIAorc3RhdGljIGludCBtb3ZlX3Rv
X2FjdGl2ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCit7
CisJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CisJaW50IGVycjsKKworCWlmIChyY3VfYWNjZXNz
X3BvaW50ZXIodm1hLT5hY3RpdmUuZXhjbCkpIHsKKwkJcmN1X3JlYWRfbG9jaygpOworCQlmZW5j
ZSA9IGRtYV9mZW5jZV9nZXRfcmN1X3NhZmUoJnZtYS0+YWN0aXZlLmV4Y2wpOworCQlyY3VfcmVh
ZF91bmxvY2soKTsKKwkJaWYgKGZlbmNlKSB7CisJCQllcnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRf
ZG1hX2ZlbmNlKHJxLCBmZW5jZSk7CisJCQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKKwkJCWlmICh1
bmxpa2VseShlcnIpKQorCQkJCXJldHVybiBlcnI7CisJCX0KKwl9CisKKwlyZXR1cm4gaTkxNV9h
Y3RpdmVfcmVmKCZ2bWEtPmFjdGl2ZSwgcnEtPnRpbWVsaW5lLCBycSk7Cit9CisKIHN0YXRpYyB2
b2lkIGNsZWFyX3BhZ2VzX3dvcmtlcihzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiB7CiAJc3Ry
dWN0IGNsZWFyX3BhZ2VzX3dvcmsgKncgPSBjb250YWluZXJfb2Yod29yaywgdHlwZW9mKCp3KSwg
d29yayk7CkBAIC0yMTEsNyArMjMxLDcgQEAgc3RhdGljIHZvaWQgY2xlYXJfcGFnZXNfd29ya2Vy
KHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAkgKiBrZWVwIHRyYWNrIG9mIHRoZSBHUFUgYWN0
aXZpdHkgd2l0aGluIHRoaXMgdm1hL3JlcXVlc3QsIGFuZAogCSAqIHByb3BhZ2F0ZSB0aGUgc2ln
bmFsIGZyb20gdGhlIHJlcXVlc3QgdG8gdy0+ZG1hLgogCSAqLwotCWVyciA9IGk5MTVfYWN0aXZl
X3JlZigmdm1hLT5hY3RpdmUsIHJxLT50aW1lbGluZSwgcnEpOworCWVyciA9IG1vdmVfdG9fYWN0
aXZlKHZtYSwgcnEpOwogCWlmIChlcnIpCiAJCWdvdG8gb3V0X3JlcXVlc3Q7CiAKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCmluZGV4IGI4OTY5NjA1ZjRlOC4u
NGQ5MTgxYzAwNDRlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250
ZXh0LmMKQEAgLTMxMyw4ICszMTMsNiBAQCBzdGF0aWMgdm9pZCBpOTE1X2dlbV9jb250ZXh0X2Zy
ZWUoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIAlHRU1fQlVHX09OKCFpOTE1X2dlbV9j
b250ZXh0X2lzX2Nsb3NlZChjdHgpKTsKIAogCXJlbGVhc2VfaHdfaWQoY3R4KTsKLQlpZiAoY3R4
LT52bSkKLQkJaTkxNV92bV9wdXQoY3R4LT52bSk7CiAKIAlmcmVlX2VuZ2luZXMocmN1X2FjY2Vz
c19wb2ludGVyKGN0eC0+ZW5naW5lcykpOwogCW11dGV4X2Rlc3Ryb3koJmN0eC0+ZW5naW5lc19t
dXRleCk7CkBAIC0zNzksOSArMzc3LDEzIEBAIHZvaWQgaTkxNV9nZW1fY29udGV4dF9yZWxlYXNl
KHN0cnVjdCBrcmVmICpyZWYpCiAKIHN0YXRpYyB2b2lkIGNvbnRleHRfY2xvc2Uoc3RydWN0IGk5
MTVfZ2VtX2NvbnRleHQgKmN0eCkKIHsKKwlpOTE1X2dlbV9jb250ZXh0X3NldF9jbG9zZWQoY3R4
KTsKKworCWlmIChjdHgtPnZtKQorCQlpOTE1X3ZtX2Nsb3NlKGN0eC0+dm0pOworCiAJbXV0ZXhf
bG9jaygmY3R4LT5tdXRleCk7CiAKLQlpOTE1X2dlbV9jb250ZXh0X3NldF9jbG9zZWQoY3R4KTsK
IAljdHgtPmZpbGVfcHJpdiA9IEVSUl9QVFIoLUVCQURGKTsKIAogCS8qCkBAIC00NzQsNyArNDc2
LDcgQEAgX19zZXRfcHBndHQoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwgc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqdm0pCiAKIAlHRU1fQlVHX09OKG9sZCAmJiBpOTE1X3ZtX2lzXzRs
dmwodm0pICE9IGk5MTVfdm1faXNfNGx2bChvbGQpKTsKIAotCWN0eC0+dm0gPSBpOTE1X3ZtX2dl
dCh2bSk7CisJY3R4LT52bSA9IGk5MTVfdm1fb3Blbih2bSk7CiAJY29udGV4dF9hcHBseV9hbGwo
Y3R4LCBfX2FwcGx5X3BwZ3R0LCB2bSk7CiAKIAlyZXR1cm4gb2xkOwpAQCAtNDg4LDcgKzQ5MCw3
IEBAIHN0YXRpYyB2b2lkIF9fYXNzaWduX3BwZ3R0KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpj
dHgsCiAKIAl2bSA9IF9fc2V0X3BwZ3R0KGN0eCwgdm0pOwogCWlmICh2bSkKLQkJaTkxNV92bV9w
dXQodm0pOworCQlpOTE1X3ZtX2Nsb3NlKHZtKTsKIH0KIAogc3RhdGljIHZvaWQgX19zZXRfdGlt
ZWxpbmUoc3RydWN0IGludGVsX3RpbWVsaW5lICoqZHN0LApAQCAtOTUzLDcgKzk1NSw3IEBAIHN0
YXRpYyBpbnQgZ2V0X3BwZ3R0KHN0cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGUgKmZpbGVfcHJp
diwKIAlpZiAocmV0IDwgMCkKIAkJZ290byBlcnJfdW5sb2NrOwogCi0JaTkxNV92bV9nZXQodm0p
OworCWk5MTVfdm1fb3Blbih2bSk7CiAKIAlhcmdzLT5zaXplID0gMDsKIAlhcmdzLT52YWx1ZSA9
IHJldDsKQEAgLTk3Myw3ICs5NzUsNyBAQCBzdGF0aWMgdm9pZCBzZXRfcHBndHRfYmFycmllcih2
b2lkICpkYXRhKQogCWlmIChJTlRFTF9HRU4ob2xkLT5pOTE1KSA8IDgpCiAJCWdlbjZfcHBndHRf
dW5waW5fYWxsKGk5MTVfdm1fdG9fcHBndHQob2xkKSk7CiAKLQlpOTE1X3ZtX3B1dChvbGQpOwor
CWk5MTVfdm1fY2xvc2Uob2xkKTsKIH0KIAogc3RhdGljIGludCBlbWl0X3BwZ3R0X3VwZGF0ZShz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgdm9pZCAqZGF0YSkKQEAgLTEwOTAsOCArMTA5Miw4IEBA
IHN0YXRpYyBpbnQgc2V0X3BwZ3R0KHN0cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGUgKmZpbGVf
cHJpdiwKIAkJCQkgICBzZXRfcHBndHRfYmFycmllciwKIAkJCQkgICBvbGQpOwogCWlmIChlcnIp
IHsKLQkJaTkxNV92bV9wdXQoX19zZXRfcHBndHQoY3R4LCBvbGQpKTsKLQkJaTkxNV92bV9wdXQo
b2xkKTsKKwkJaTkxNV92bV9jbG9zZShfX3NldF9wcGd0dChjdHgsIG9sZCkpOworCQlpOTE1X3Zt
X2Nsb3NlKG9sZCk7CiAJfQogCiB1bmxvY2s6CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fZG9tYWluLmMKaW5kZXggZjBjNDM3YjZlOTk1Li40NmEyMzQwOWUxYzAgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMKQEAgLTIwMiw3ICsyMDIsMTEg
QEAgaW50IGk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVfbGV2ZWwoc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaiwKIAkJICAgIGk5MTVfZ2VtX3ZhbGlkX2d0dF9zcGFjZSh2bWEsIGNhY2hl
X2xldmVsKSkKIAkJCWNvbnRpbnVlOwogCi0JCXJldCA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOwor
CQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJnZtYS0+dm0tPm11dGV4KTsKKwkJaWYg
KCFyZXQpIHsKKwkJCXJldCA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQkJbXV0ZXhfdW5sb2Nr
KCZ2bWEtPnZtLT5tdXRleCk7CisJCX0KIAkJaWYgKHJldCkKIAkJCXJldHVybiByZXQ7CiAKQEAg
LTI4OCw3ICsyOTIsMTIgQEAgaW50IGk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVfbGV2ZWwoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJCWlmICghZHJtX21tX25vZGVfYWxsb2Nh
dGVkKCZ2bWEtPm5vZGUpKQogCQkJCWNvbnRpbnVlOwogCi0JCQlyZXQgPSBpOTE1X3ZtYV9iaW5k
KHZtYSwgY2FjaGVfbGV2ZWwsIFBJTl9VUERBVEUpOworCQkJLyogV2FpdCBmb3IgYW4gZWFybGll
ciBhc3luYyBiaW5kICovCisJCQlyZXQgPSBpOTE1X2FjdGl2ZV93YWl0KCZ2bWEtPmFjdGl2ZSk7
CisJCQlpZiAocmV0KQorCQkJCXJldHVybiByZXQ7CisKKwkJCXJldCA9IGk5MTVfdm1hX2JpbmQo
dm1hLCBjYWNoZV9sZXZlbCwgUElOX1VQREFURSwgTlVMTCk7CiAJCQlpZiAocmV0KQogCQkJCXJl
dHVybiByZXQ7CiAJCX0KQEAgLTM4OSwxNiArMzk4LDExIEBAIGludCBpOTE1X2dlbV9zZXRfY2Fj
aGluZ19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCWlmIChyZXQp
CiAJCWdvdG8gb3V0OwogCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZpOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKLQlpZiAocmV0KQotCQlnb3RvIG91dDsKLQogCXJldCA9IGk5MTVf
Z2VtX29iamVjdF9sb2NrX2ludGVycnVwdGlibGUob2JqKTsKIAlpZiAocmV0ID09IDApIHsKIAkJ
cmV0ID0gaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNoZV9sZXZlbChvYmosIGxldmVsKTsKIAkJaTkx
NV9nZW1fb2JqZWN0X3VubG9jayhvYmopOwogCX0KLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCiBvdXQ6CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwpAQCAtNDgz
LDYgKzQ4Nyw3IEBAIHN0YXRpYyB2b2lkIGk5MTVfZ2VtX29iamVjdF9idW1wX2luYWN0aXZlX2dn
dHQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAkJaWYgKCFkcm1fbW1fbm9kZV9h
bGxvY2F0ZWQoJnZtYS0+bm9kZSkpCiAJCQljb250aW51ZTsKIAorCQlHRU1fQlVHX09OKHZtYS0+
dm0gIT0gJmk5MTUtPmdndHQudm0pOwogCQlsaXN0X21vdmVfdGFpbCgmdm1hLT52bV9saW5rLCAm
dm1hLT52bS0+Ym91bmRfbGlzdCk7CiAJfQogCW11dGV4X3VubG9jaygmaTkxNS0+Z2d0dC52bS5t
dXRleCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhl
Y2J1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIu
YwppbmRleCBjMDQ5MTk5YTFkZjUuLjE0NjdjNjY2ZWE4NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCkBAIC01NTAsOCArNTUwLDExIEBAIGVi
X2FkZF92bWEoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsCiAJCWViX3VucmVzZXJ2ZV92bWEo
dm1hLCB2bWEtPmV4ZWNfZmxhZ3MpOwogCiAJCWxpc3RfYWRkX3RhaWwoJnZtYS0+ZXhlY19saW5r
LCAmZWItPnVuYm91bmQpOwotCQlpZiAoZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUp
KQorCQlpZiAoZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKSB7CisJCQltdXRleF9s
b2NrKCZ2bWEtPnZtLT5tdXRleCk7CiAJCQllcnIgPSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJ
CW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOworCQl9CiAJCWlmICh1bmxpa2VseShlcnIp
KQogCQkJdm1hLT5leGVjX2ZsYWdzID0gTlVMTDsKIAl9CkBAIC02OTgsNyArNzAxLDkgQEAgc3Rh
dGljIGludCBlYl9yZXNlcnZlKHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViKQogCiAJCWNhc2Ug
MToKIAkJCS8qIFRvbyBmcmFnbWVudGVkLCB1bmJpbmQgZXZlcnl0aGluZyBhbmQgcmV0cnkgKi8K
KwkJCW11dGV4X2xvY2soJmViLT5jb250ZXh0LT52bS0+bXV0ZXgpOwogCQkJZXJyID0gaTkxNV9n
ZW1fZXZpY3Rfdm0oZWItPmNvbnRleHQtPnZtKTsKKwkJCW11dGV4X3VubG9jaygmZWItPmNvbnRl
eHQtPnZtLT5tdXRleCk7CiAJCQlpZiAoZXJyKQogCQkJCXJldHVybiBlcnI7CiAJCQlicmVhazsK
QEAgLTk3Miw3ICs5NzcsOSBAQCBzdGF0aWMgdm9pZCByZWxvY19jYWNoZV9yZXNldChzdHJ1Y3Qg
cmVsb2NfY2FjaGUgKmNhY2hlKQogCQkJZ2d0dC0+dm0uY2xlYXJfcmFuZ2UoJmdndHQtPnZtLAog
CQkJCQkgICAgIGNhY2hlLT5ub2RlLnN0YXJ0LAogCQkJCQkgICAgIGNhY2hlLT5ub2RlLnNpemUp
OworCQkJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQkJZHJtX21tX3JlbW92ZV9ub2Rl
KCZjYWNoZS0+bm9kZSk7CisJCQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJfSBl
bHNlIHsKIAkJCWk5MTVfdm1hX3VucGluKChzdHJ1Y3QgaTkxNV92bWEgKiljYWNoZS0+bm9kZS5t
bSk7CiAJCX0KQEAgLTEwNDcsMTEgKzEwNTQsMTMgQEAgc3RhdGljIHZvaWQgKnJlbG9jX2lvbWFw
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCQkJCSAgICAgICBQSU5fTk9FVklD
VCk7CiAJCWlmIChJU19FUlIodm1hKSkgewogCQkJbWVtc2V0KCZjYWNoZS0+bm9kZSwgMCwgc2l6
ZW9mKGNhY2hlLT5ub2RlKSk7CisJCQltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCQll
cnIgPSBkcm1fbW1faW5zZXJ0X25vZGVfaW5fcmFuZ2UKIAkJCQkoJmdndHQtPnZtLm1tLCAmY2Fj
aGUtPm5vZGUsCiAJCQkJIFBBR0VfU0laRSwgMCwgSTkxNV9DT0xPUl9VTkVWSUNUQUJMRSwKIAkJ
CQkgMCwgZ2d0dC0+bWFwcGFibGVfZW5kLAogCQkJCSBEUk1fTU1fSU5TRVJUX0xPVyk7CisJCQlt
dXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJCWlmIChlcnIpIC8qIG5vIGluYWN0aXZl
IGFwZXJ0dXJlIHNwYWNlLCB1c2UgY3B1IHJlbG9jICovCiAJCQkJcmV0dXJuIE5VTEw7CiAJCX0g
ZWxzZSB7CkBAIC0xNDE2LDcgKzE0MjUsNyBAQCBlYl9yZWxvY2F0ZV9lbnRyeShzdHJ1Y3QgaTkx
NV9leGVjYnVmZmVyICplYiwKIAkJaWYgKHJlbG9jLT53cml0ZV9kb21haW4gPT0gSTkxNV9HRU1f
RE9NQUlOX0lOU1RSVUNUSU9OICYmCiAJCSAgICBJU19HRU4oZWItPmk5MTUsIDYpKSB7CiAJCQll
cnIgPSBpOTE1X3ZtYV9iaW5kKHRhcmdldCwgdGFyZ2V0LT5vYmotPmNhY2hlX2xldmVsLAotCQkJ
CQkgICAgUElOX0dMT0JBTCk7CisJCQkJCSAgICBQSU5fR0xPQkFMLCBOVUxMKTsKIAkJCWlmIChX
QVJOX09OQ0UoZXJyLAogCQkJCSAgICAgICJVbmV4cGVjdGVkIGZhaWx1cmUgdG8gYmluZCB0YXJn
ZXQgVk1BISIpKQogCQkJCXJldHVybiBlcnI7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fbW1hbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX21tYW4uYwppbmRleCAyNjFjOWJkODNmNTEuLmU0YWVlMjY3ODU0NiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fbW1hbi5jCkBAIC0yNTEsMTYgKzI1MSw2IEBAIHZtX2Zh
dWx0X3QgaTkxNV9nZW1fZmF1bHQoc3RydWN0IHZtX2ZhdWx0ICp2bWYpCiAJCWdvdG8gZXJyX3Jw
bTsKIAl9CiAKLQlyZXQgPSBpOTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZShkZXYpOwotCWlm
IChyZXQpCi0JCWdvdG8gZXJyX3Jlc2V0OwotCi0JLyogQWNjZXNzIHRvIHNub29wYWJsZSBwYWdl
cyB0aHJvdWdoIHRoZSBHVFQgaXMgaW5jb2hlcmVudC4gKi8KLQlpZiAob2JqLT5jYWNoZV9sZXZl
bCAhPSBJOTE1X0NBQ0hFX05PTkUgJiYgIUhBU19MTEMoaTkxNSkpIHsKLQkJcmV0ID0gLUVGQVVM
VDsKLQkJZ290byBlcnJfdW5sb2NrOwotCX0KLQogCS8qIE5vdyBwaW4gaXQgaW50byB0aGUgR1RU
IGFzIG5lZWRlZCAqLwogCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihvYmosIE5VTEws
IDAsIDAsCiAJCQkJICAgICAgIFBJTl9NQVBQQUJMRSB8CkBAIC0yOTAsNyArMjgwLDEzIEBAIHZt
X2ZhdWx0X3QgaTkxNV9nZW1fZmF1bHQoc3RydWN0IHZtX2ZhdWx0ICp2bWYpCiAJfQogCWlmIChJ
U19FUlIodm1hKSkgewogCQlyZXQgPSBQVFJfRVJSKHZtYSk7Ci0JCWdvdG8gZXJyX3VubG9jazsK
KwkJZ290byBlcnJfcmVzZXQ7CisJfQorCisJLyogQWNjZXNzIHRvIHNub29wYWJsZSBwYWdlcyB0
aHJvdWdoIHRoZSBHVFQgaXMgaW5jb2hlcmVudC4gKi8KKwlpZiAob2JqLT5jYWNoZV9sZXZlbCAh
PSBJOTE1X0NBQ0hFX05PTkUgJiYgIUhBU19MTEMoaTkxNSkpIHsKKwkJcmV0ID0gLUVGQVVMVDsK
KwkJZ290byBlcnJfdW5waW47CiAJfQogCiAJcmV0ID0gaTkxNV92bWFfcGluX2ZlbmNlKHZtYSk7
CkBAIC0zMTksMTMgKzMxNSwxMCBAQCB2bV9mYXVsdF90IGk5MTVfZ2VtX2ZhdWx0KHN0cnVjdCB2
bV9mYXVsdCAqdm1mKQogCQkJCSAgIG1zZWNzX3RvX2ppZmZpZXNfdGltZW91dChDT05GSUdfRFJN
X0k5MTVfVVNFUkZBVUxUX0FVVE9TVVNQRU5EKSk7CiAKIAlpOTE1X3ZtYV9zZXRfZ2d0dF93cml0
ZSh2bWEpOwotCiBlcnJfZmVuY2U6CiAJaTkxNV92bWFfdW5waW5fZmVuY2Uodm1hKTsKIGVycl91
bnBpbjoKIAlfX2k5MTVfdm1hX3VucGluKHZtYSk7Ci1lcnJfdW5sb2NrOgotCW11dGV4X3VubG9j
aygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogZXJyX3Jlc2V0OgogCWludGVsX2d0X3Jlc2V0X3VubG9j
ayhnZ3R0LT52bS5ndCwgc3JjdSk7CiBlcnJfcnBtOgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX29iamVjdC5jCmluZGV4IDBlZjYwZGFlMjNhNy4uZGJmOWJlOWE3OWY0IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jCkBAIC0xNTUsMjEgKzE1
NSwzMCBAQCBzdGF0aWMgdm9pZCBfX2k5MTVfZ2VtX2ZyZWVfb2JqZWN0cyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKIAogCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldCgmaTkx
NS0+cnVudGltZV9wbSk7CiAJbGxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShvYmosIG9uLCBmcmVl
ZCwgZnJlZWQpIHsKLQkJc3RydWN0IGk5MTVfdm1hICp2bWEsICp2bjsKLQogCQl0cmFjZV9pOTE1
X2dlbV9vYmplY3RfZGVzdHJveShvYmopOwogCi0JCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwotCi0JCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZSh2bWEsIHZuLCAmb2JqLT52
bWEubGlzdCwgb2JqX2xpbmspIHsKLQkJCUdFTV9CVUdfT04oaTkxNV92bWFfaXNfYWN0aXZlKHZt
YSkpOwotCQkJYXRvbWljX2FuZCh+STkxNV9WTUFfUElOX01BU0ssICZ2bWEtPmZsYWdzKTsKLQkJ
CWk5MTVfdm1hX2Rlc3Ryb3kodm1hKTsKKwkJaWYgKCFsaXN0X2VtcHR5KCZvYmotPnZtYS5saXN0
KSkgeworCQkJc3RydWN0IGk5MTVfdm1hICp2bWE7CisKKwkJCS8qCisJCQkgKiBOb3RlIHRoYXQg
dGhlIHZtYSBrZWVwcyBhbiBvYmplY3QgcmVmZXJlbmNlIHdoaWxlCisJCQkgKiBpdCBpcyBhY3Rp
dmUsIHNvIGl0ICpzaG91bGQqIG5vdCBzbGVlcCB3aGlsZSB3ZQorCQkJICogZGVzdHJveSBpdC4g
T3VyIGRlYnVnIGNvZGUgZXJycyBpbnNpdHMgaXQgKm1pZ2h0Ki4KKwkJCSAqIEZvciB0aGUgbW9t
ZW50LCBwbGF5IGFsb25nLgorCQkJICovCisJCQlzcGluX2xvY2soJm9iai0+dm1hLmxvY2spOwor
CQkJd2hpbGUgKCh2bWEgPSBsaXN0X2ZpcnN0X2VudHJ5X29yX251bGwoJm9iai0+dm1hLmxpc3Qs
CisJCQkJCQkJICAgICAgIHN0cnVjdCBpOTE1X3ZtYSwKKwkJCQkJCQkgICAgICAgb2JqX2xpbmsp
KSkgeworCQkJCUdFTV9CVUdfT04odm1hLT5vYmogIT0gb2JqKTsKKwkJCQlzcGluX3VubG9jaygm
b2JqLT52bWEubG9jayk7CisKKwkJCQlpOTE1X3ZtYV9kZXN0cm95KHZtYSk7CisKKwkJCQlzcGlu
X2xvY2soJm9iai0+dm1hLmxvY2spOworCQkJfQorCQkJc3Bpbl91bmxvY2soJm9iai0+dm1hLmxv
Y2spOwogCQl9Ci0JCUdFTV9CVUdfT04oIWxpc3RfZW1wdHkoJm9iai0+dm1hLmxpc3QpKTsKLQkJ
R0VNX0JVR19PTighUkJfRU1QVFlfUk9PVCgmb2JqLT52bWEudHJlZSkpOwotCi0JCW11dGV4X3Vu
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAkJR0VNX0JVR19PTihhdG9taWNfcmVh
ZCgmb2JqLT5iaW5kX2NvdW50KSk7CiAJCUdFTV9CVUdfT04ob2JqLT51c2VyZmF1bHRfY291bnQp
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5o
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oCmluZGV4IDI5Yjll
ZGRjNGM3Zi4uYTc4YWYyNWRjZTM2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fb2JqZWN0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX29iamVjdC5oCkBAIC0xMDYsNiArMTA2LDExIEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBpOTE1
X2dlbV9vYmplY3RfbG9jayhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCWRtYV9y
ZXN2X2xvY2sob2JqLT5iYXNlLnJlc3YsIE5VTEwpOwogfQogCitzdGF0aWMgaW5saW5lIGJvb2wg
aTkxNV9nZW1fb2JqZWN0X3RyeWxvY2soc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikK
K3sKKwlyZXR1cm4gZG1hX3Jlc3ZfdHJ5bG9jayhvYmotPmJhc2UucmVzdik7Cit9CisKIHN0YXRp
YyBpbmxpbmUgaW50CiBpOTE1X2dlbV9vYmplY3RfbG9ja19pbnRlcnJ1cHRpYmxlKHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9zaHJpbmtlci5jCmluZGV4IGQyYzA1ZDc1MjkwOS4uNDQ3ZWUyYjFlMjIyIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYwpAQCAtMTYsNDAg
KzE2LDYgQEAKIAogI2luY2x1ZGUgImk5MTVfdHJhY2UuaCIKIAotc3RhdGljIGJvb2wgc2hyaW5r
ZXJfbG9jayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKLQkJCSAgdW5zaWduZWQgaW50
IGZsYWdzLAotCQkJICBib29sICp1bmxvY2spCi17Ci0Jc3RydWN0IG11dGV4ICptID0gJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXg7Ci0KLQlzd2l0Y2ggKG11dGV4X3RyeWxvY2tfcmVjdXJzaXZlKG0p
KSB7Ci0JY2FzZSBNVVRFWF9UUllMT0NLX1JFQ1VSU0lWRToKLQkJKnVubG9jayA9IGZhbHNlOwot
CQlyZXR1cm4gdHJ1ZTsKLQotCWNhc2UgTVVURVhfVFJZTE9DS19GQUlMRUQ6Ci0JCSp1bmxvY2sg
PSBmYWxzZTsKLQkJaWYgKGZsYWdzICYgSTkxNV9TSFJJTktfQUNUSVZFICYmCi0JCSAgICBtdXRl
eF9sb2NrX2tpbGxhYmxlX25lc3RlZChtLCBJOTE1X01NX1NIUklOS0VSKSA9PSAwKQotCQkJKnVu
bG9jayA9IHRydWU7Ci0JCXJldHVybiAqdW5sb2NrOwotCi0JY2FzZSBNVVRFWF9UUllMT0NLX1NV
Q0NFU1M6Ci0JCSp1bmxvY2sgPSB0cnVlOwotCQlyZXR1cm4gdHJ1ZTsKLQl9Ci0KLQlCVUcoKTsK
LX0KLQotc3RhdGljIHZvaWQgc2hyaW5rZXJfdW5sb2NrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LCBib29sIHVubG9jaykKLXsKLQlpZiAoIXVubG9jaykKLQkJcmV0dXJuOwotCi0JbXV0
ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLX0KLQogc3RhdGljIGJvb2wgc3dh
cF9hdmFpbGFibGUodm9pZCkKIHsKIAlyZXR1cm4gZ2V0X25yX3N3YXBfcGFnZXMoKSA+IDA7CkBA
IC0xNTUsMTAgKzEyMSw2IEBAIGk5MTVfZ2VtX3NocmluayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZiA9IDA7CiAJdW5zaWduZWQgbG9uZyBj
b3VudCA9IDA7CiAJdW5zaWduZWQgbG9uZyBzY2FubmVkID0gMDsKLQlib29sIHVubG9jazsKLQot
CWlmICghc2hyaW5rZXJfbG9jayhpOTE1LCBzaHJpbmssICZ1bmxvY2spKQotCQlyZXR1cm4gMDsK
IAogCS8qCiAJICogV2hlbiBzaHJpbmtpbmcgdGhlIGFjdGl2ZSBsaXN0LCB3ZSBzaG91bGQgYWxz
byBjb25zaWRlciBhY3RpdmUKQEAgLTI2OCw4ICsyMzAsNiBAQCBpOTE1X2dlbV9zaHJpbmsoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJaWYgKHNocmluayAmIEk5MTVfU0hSSU5LX0JP
VU5EKQogCQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7
CiAKLQlzaHJpbmtlcl91bmxvY2soaTkxNSwgdW5sb2NrKTsKLQogCWlmIChucl9zY2FubmVkKQog
CQkqbnJfc2Nhbm5lZCArPSBzY2FubmVkOwogCXJldHVybiBjb3VudDsKQEAgLTMzOSwxMyArMjk5
LDkgQEAgaTkxNV9nZW1fc2hyaW5rZXJfc2NhbihzdHJ1Y3Qgc2hyaW5rZXIgKnNocmlua2VyLCBz
dHJ1Y3Qgc2hyaW5rX2NvbnRyb2wgKnNjKQogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0KIAkJY29udGFpbmVyX29mKHNocmlua2VyLCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSwgbW0u
c2hyaW5rZXIpOwogCXVuc2lnbmVkIGxvbmcgZnJlZWQ7Ci0JYm9vbCB1bmxvY2s7CiAKIAlzYy0+
bnJfc2Nhbm5lZCA9IDA7CiAKLQlpZiAoIXNocmlua2VyX2xvY2soaTkxNSwgMCwgJnVubG9jaykp
Ci0JCXJldHVybiBTSFJJTktfU1RPUDsKLQogCWZyZWVkID0gaTkxNV9nZW1fc2hyaW5rKGk5MTUs
CiAJCQkJc2MtPm5yX3RvX3NjYW4sCiAJCQkJJnNjLT5ucl9zY2FubmVkLApAQCAtMzY2LDggKzMy
Miw2IEBAIGk5MTVfZ2VtX3Nocmlua2VyX3NjYW4oc3RydWN0IHNocmlua2VyICpzaHJpbmtlciwg
c3RydWN0IHNocmlua19jb250cm9sICpzYykKIAkJfQogCX0KIAotCXNocmlua2VyX3VubG9jayhp
OTE1LCB1bmxvY2spOwotCiAJcmV0dXJuIHNjLT5ucl9zY2FubmVkID8gZnJlZWQgOiBTSFJJTktf
U1RPUDsKIH0KIApAQCAtNDE5LDEwICszNzMsNiBAQCBpOTE1X2dlbV9zaHJpbmtlcl92bWFwKHN0
cnVjdCBub3RpZmllcl9ibG9jayAqbmIsIHVuc2lnbmVkIGxvbmcgZXZlbnQsIHZvaWQgKnB0cgog
CXN0cnVjdCBpOTE1X3ZtYSAqdm1hLCAqbmV4dDsKIAl1bnNpZ25lZCBsb25nIGZyZWVkX3BhZ2Vz
ID0gMDsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKLQlib29sIHVubG9jazsKLQotCWlmICgh
c2hyaW5rZXJfbG9jayhpOTE1LCAwLCAmdW5sb2NrKSkKLQkJcmV0dXJuIE5PVElGWV9ET05FOwog
CiAJd2l0aF9pbnRlbF9ydW50aW1lX3BtKCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKQogCQlm
cmVlZF9wYWdlcyArPSBpOTE1X2dlbV9zaHJpbmsoaTkxNSwgLTFVTCwgTlVMTCwKQEAgLTQzOSwx
NSArMzg5LDExIEBAIGk5MTVfZ2VtX3Nocmlua2VyX3ZtYXAoc3RydWN0IG5vdGlmaWVyX2Jsb2Nr
ICpuYiwgdW5zaWduZWQgbG9uZyBldmVudCwgdm9pZCAqcHRyCiAJCWlmICghdm1hLT5pb21hcCB8
fCBpOTE1X3ZtYV9pc19hY3RpdmUodm1hKSkKIAkJCWNvbnRpbnVlOwogCi0JCW11dGV4X3VubG9j
aygmaTkxNS0+Z2d0dC52bS5tdXRleCk7CiAJCWlmIChpOTE1X3ZtYV91bmJpbmQodm1hKSA9PSAw
KQogCQkJZnJlZWRfcGFnZXMgKz0gY291bnQ7Ci0JCW11dGV4X2xvY2soJmk5MTUtPmdndHQudm0u
bXV0ZXgpOwogCX0KIAltdXRleF91bmxvY2soJmk5MTUtPmdndHQudm0ubXV0ZXgpOwogCi0Jc2hy
aW5rZXJfdW5sb2NrKGk5MTUsIHVubG9jayk7Ci0KIAkqKHVuc2lnbmVkIGxvbmcgKilwdHIgKz0g
ZnJlZWRfcGFnZXM7CiAJcmV0dXJuIE5PVElGWV9ET05FOwogfQpAQCAtNDkwLDIyICs0MzYsOSBA
QCB2b2lkIGk5MTVfZ2VtX3Nocmlua2VyX3RhaW50c19tdXRleChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwKIAogCWZzX3JlY2xhaW1fYWNxdWlyZShHRlBfS0VSTkVMKTsKIAotCS8qCi0J
ICogQXMgd2UgaW52YXJpYWJseSByZWx5IG9uIHRoZSBzdHJ1Y3RfbXV0ZXggd2l0aGluIHRoZSBz
aHJpbmtlciwKLQkgKiBidXQgaGF2ZSBhIGNvbXBsaWNhdGVkIHJlY3Vyc2lvbiBkYW5jZSwgdGFp
bnQgYWxsIHRoZSBtdXRleGVzIHVzZWQKLQkgKiB3aXRoaW4gdGhlIHNocmlua2VyIHdpdGggdGhl
IHN0cnVjdF9tdXRleC4gRm9yIGNvbXBsZXRlbmVzcywgd2UKLQkgKiB0YWludCB3aXRoIGFsbCBz
dWJjbGFzcyBvZiBzdHJ1Y3RfbXV0ZXgsIGV2ZW4gdGhvdWdoIHdlIHNob3VsZAotCSAqIG9ubHkg
bmVlZCB0YWludGluZyBieSBJOTE1X01NX05PUk1BTCB0byBjYXRjaCBwb3NzaWJsZSBBQkJBCi0J
ICogZGVhZGxvY2tzIGZyb20gdXNpbmcgc3RydWN0X211dGV4IGluc2lkZSBAbXV0ZXguCi0JICov
Ci0JbXV0ZXhfYWNxdWlyZSgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleC5kZXBfbWFwLAotCQkgICAg
ICBJOTE1X01NX1NIUklOS0VSLCAwLCBfUkVUX0lQXyk7Ci0KIAltdXRleF9hY3F1aXJlKCZtdXRl
eC0+ZGVwX21hcCwgMCwgMCwgX1JFVF9JUF8pOwogCW11dGV4X3JlbGVhc2UoJm11dGV4LT5kZXBf
bWFwLCAwLCBfUkVUX0lQXyk7CiAKLQltdXRleF9yZWxlYXNlKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4LmRlcF9tYXAsIDAsIF9SRVRfSVBfKTsKLQogCWZzX3JlY2xhaW1fcmVsZWFzZShHRlBfS0VS
TkVMKTsKIAogCWlmICh1bmxvY2spCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fc3RvbGVuLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
c3RvbGVuLmMKaW5kZXggMGQ4MWRlMTQ2MWI0Li4zNWExZjc2YjE2ZDMgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zdG9sZW4uYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc3RvbGVuLmMKQEAgLTYyMSw4ICs2MjEsNiBAQCBpOTE1
X2dlbV9vYmplY3RfY3JlYXRlX3N0b2xlbl9mb3JfcHJlYWxsb2NhdGVkKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdgogCWlmICghZHJtX21tX2luaXRpYWxpemVkKCZkZXZfcHJpdi0+
bW0uc3RvbGVuKSkKIAkJcmV0dXJuIE5VTEw7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZf
cHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlEUk1fREVCVUdfRFJJVkVSKCJjcmVhdGluZyBw
cmVhbGxvY2F0ZWQgc3RvbGVuIG9iamVjdDogc3RvbGVuX29mZnNldD0lcGEsIGd0dF9vZmZzZXQ9
JXBhLCBzaXplPSVwYVxuIiwKIAkJCSAmc3RvbGVuX29mZnNldCwgJmd0dF9vZmZzZXQsICZzaXpl
KTsKIApAQCAtNjc0LDIxICs2NzIsMjQgQEAgaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zdG9sZW5f
Zm9yX3ByZWFsbG9jYXRlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYKIAkgKiBz
ZXR0aW5nIHVwIHRoZSBHVFQgc3BhY2UuIFRoZSBhY3R1YWwgcmVzZXJ2YXRpb24gd2lsbCBvY2N1
cgogCSAqIGxhdGVyLgogCSAqLworCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAlyZXQg
PSBpOTE1X2dlbV9ndHRfcmVzZXJ2ZSgmZ2d0dC0+dm0sICZ2bWEtPm5vZGUsCiAJCQkJICAgc2l6
ZSwgZ3R0X29mZnNldCwgb2JqLT5jYWNoZV9sZXZlbCwKIAkJCQkgICAwKTsKIAlpZiAocmV0KSB7
CiAJCURSTV9ERUJVR19EUklWRVIoImZhaWxlZCB0byBhbGxvY2F0ZSBzdG9sZW4gR1RUIHNwYWNl
XG4iKTsKKwkJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCWdvdG8gZXJyX3BhZ2Vz
OwogCX0KIAogCUdFTV9CVUdfT04oIWRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5ub2RlKSk7
CiAKIAl2bWEtPnBhZ2VzID0gb2JqLT5tbS5wYWdlczsKKwlhdG9taWNfc2V0KCZ2bWEtPnBhZ2Vz
X2NvdW50LCBCSVQoMTYpIHwgMSk7CisKIAlzZXRfYml0KEk5MTVfVk1BX0dMT0JBTF9CSU5EX0JJ
VCwgX19pOTE1X3ZtYV9mbGFncyh2bWEpKTsKIAlfX2k5MTVfdm1hX3NldF9tYXBfYW5kX2ZlbmNl
YWJsZSh2bWEpOwogCi0JbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWxpc3RfYWRkX3Rh
aWwoJnZtYS0+dm1fbGluaywgJmdndHQtPnZtLmJvdW5kX2xpc3QpOwogCW11dGV4X3VubG9jaygm
Z2d0dC0+dm0ubXV0ZXgpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fdGlsaW5nLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdGls
aW5nLmMKaW5kZXggY2EwYzJmNDUxNzQyLi5iOWNmYWUwZTQ0MzUgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV90aWxpbmcuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fdGlsaW5nLmMKQEAgLTE4MSwyMiArMTgxLDI1IEBAIHN0YXRp
YyBpbnQKIGk5MTVfZ2VtX29iamVjdF9mZW5jZV9wcmVwYXJlKHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmosCiAJCQkgICAgICBpbnQgdGlsaW5nX21vZGUsIHVuc2lnbmVkIGludCBzdHJp
ZGUpCiB7CisJc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCA9ICZ0b19pOTE1KG9iai0+YmFzZS5kZXYp
LT5nZ3R0OwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwotCWludCByZXQ7CisJaW50IHJldCA9IDA7
CiAKIAlpZiAodGlsaW5nX21vZGUgPT0gSTkxNV9USUxJTkdfTk9ORSkKIAkJcmV0dXJuIDA7CiAK
KwltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJZm9yX2VhY2hfZ2d0dF92bWEodm1hLCBv
YmopIHsKIAkJaWYgKGk5MTVfdm1hX2ZlbmNlX3ByZXBhcmUodm1hLCB0aWxpbmdfbW9kZSwgc3Ry
aWRlKSkKIAkJCWNvbnRpbnVlOwogCiAJCXJldCA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOwogCQlp
ZiAocmV0KQotCQkJcmV0dXJuIHJldDsKKwkJCWJyZWFrOwogCX0KKwltdXRleF91bmxvY2soJmdn
dHQtPnZtLm11dGV4KTsKIAotCXJldHVybiAwOworCXJldHVybiByZXQ7CiB9CiAKIGludApAQCAt
MjEyLDcgKzIxNSw2IEBAIGk5MTVfZ2VtX29iamVjdF9zZXRfdGlsaW5nKHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmosCiAKIAlHRU1fQlVHX09OKCFpOTE1X3RpbGluZ19vayhvYmosIHRp
bGluZywgc3RyaWRlKSk7CiAJR0VNX0JVR19PTighc3RyaWRlIF4gKHRpbGluZyA9PSBJOTE1X1RJ
TElOR19OT05FKSk7Ci0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAKIAlpZiAoKHRpbGluZyB8IHN0cmlkZSkgPT0gb2JqLT50aWxpbmdfYW5kX3N0cmlkZSkK
IAkJcmV0dXJuIDA7CkBAIC0zNjQsMTIgKzM2Niw3IEBAIGk5MTVfZ2VtX3NldF90aWxpbmdfaW9j
dGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJfQogCX0KIAotCWVyciA9
IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChlcnIp
Ci0JCWdvdG8gZXJyOwotCiAJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3NldF90aWxpbmcob2JqLCBh
cmdzLT50aWxpbmdfbW9kZSwgYXJncy0+c3RyaWRlKTsKLQltdXRleF91bmxvY2soJmRldi0+c3Ry
dWN0X211dGV4KTsKIAogCS8qIFdlIGhhdmUgdG8gbWFpbnRhaW4gdGhpcyBleGlzdGluZyBBQkku
Li4gKi8KIAlhcmdzLT5zdHJpZGUgPSBpOTE1X2dlbV9vYmplY3RfZ2V0X3N0cmlkZShvYmopOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMKaW5kZXggNzRkYTM1
NjExZDdjLi5jZDM2MjM2ZTNmYWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV91c2VycHRyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX3VzZXJwdHIuYwpAQCAtOTIsNyArOTIsNiBAQCB1c2VycHRyX21uX2ludmFsaWRhdGVfcmFu
Z2Vfc3RhcnQoc3RydWN0IG1tdV9ub3RpZmllciAqX21uLAogCXN0cnVjdCBpOTE1X21tdV9ub3Rp
ZmllciAqbW4gPQogCQljb250YWluZXJfb2YoX21uLCBzdHJ1Y3QgaTkxNV9tbXVfbm90aWZpZXIs
IG1uKTsKIAlzdHJ1Y3QgaW50ZXJ2YWxfdHJlZV9ub2RlICppdDsKLQlzdHJ1Y3QgbXV0ZXggKnVu
bG9jayA9IE5VTEw7CiAJdW5zaWduZWQgbG9uZyBlbmQ7CiAJaW50IHJldCA9IDA7CiAKQEAgLTEy
OSwzMyArMTI4LDEzIEBAIHVzZXJwdHJfbW5faW52YWxpZGF0ZV9yYW5nZV9zdGFydChzdHJ1Y3Qg
bW11X25vdGlmaWVyICpfbW4sCiAJCX0KIAkJc3Bpbl91bmxvY2soJm1uLT5sb2NrKTsKIAotCQlp
ZiAoIXVubG9jaykgewotCQkJdW5sb2NrID0gJm1uLT5tbS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eDsKLQotCQkJc3dpdGNoIChtdXRleF90cnlsb2NrX3JlY3Vyc2l2ZSh1bmxvY2spKSB7Ci0JCQlk
ZWZhdWx0OgotCQkJY2FzZSBNVVRFWF9UUllMT0NLX0ZBSUxFRDoKLQkJCQlpZiAobXV0ZXhfbG9j
a19raWxsYWJsZV9uZXN0ZWQodW5sb2NrLCBJOTE1X01NX1NIUklOS0VSKSkgewotCQkJCQlpOTE1
X2dlbV9vYmplY3RfcHV0KG9iaik7Ci0JCQkJCXJldHVybiAtRUlOVFI7Ci0JCQkJfQotCQkJCS8q
IGZhbGwgdGhyb3VnaCAqLwotCQkJY2FzZSBNVVRFWF9UUllMT0NLX1NVQ0NFU1M6Ci0JCQkJYnJl
YWs7Ci0KLQkJCWNhc2UgTVVURVhfVFJZTE9DS19SRUNVUlNJVkU6Ci0JCQkJdW5sb2NrID0gRVJS
X1BUUigtRUVYSVNUKTsKLQkJCQlicmVhazsKLQkJCX0KLQkJfQotCiAJCXJldCA9IGk5MTVfZ2Vt
X29iamVjdF91bmJpbmQob2JqLAogCQkJCQkgICAgIEk5MTVfR0VNX09CSkVDVF9VTkJJTkRfQUNU
SVZFKTsKIAkJaWYgKHJldCA9PSAwKQogCQkJcmV0ID0gX19pOTE1X2dlbV9vYmplY3RfcHV0X3Bh
Z2VzKG9iaiwgSTkxNV9NTV9TSFJJTktFUik7CiAJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsK
IAkJaWYgKHJldCkKLQkJCWdvdG8gdW5sb2NrOworCQkJcmV0dXJuIHJldDsKIAogCQlzcGluX2xv
Y2soJm1uLT5sb2NrKTsKIApAQCAtMTY4LDEwICsxNDcsNiBAQCB1c2VycHRyX21uX2ludmFsaWRh
dGVfcmFuZ2Vfc3RhcnQoc3RydWN0IG1tdV9ub3RpZmllciAqX21uLAogCX0KIAlzcGluX3VubG9j
aygmbW4tPmxvY2spOwogCi11bmxvY2s6Ci0JaWYgKCFJU19FUlJfT1JfTlVMTCh1bmxvY2spKQot
CQltdXRleF91bmxvY2sodW5sb2NrKTsKLQogCXJldHVybiByZXQ7CiAKIH0KZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMKaW5kZXggYzVjZWE0Mzc5
MjE2Li5jZDc3MTE0N2I0MWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9z
ZWxmdGVzdHMvaHVnZV9wYWdlcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxm
dGVzdHMvaHVnZV9wYWdlcy5jCkBAIC0yNSw2ICsyNSwxNyBAQCBzdGF0aWMgY29uc3QgdW5zaWdu
ZWQgaW50IHBhZ2Vfc2l6ZXNbXSA9IHsKIAlJOTE1X0dUVF9QQUdFX1NJWkVfNEssCiB9OwogCitz
dGF0aWMgaW50IHVubG9ja2VkX3ZtYV91bmJpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEpCit7CisJ
aW50IHJldDsKKworCW11dGV4X2xvY2soJnZtYS0+dm0tPm11dGV4KTsKKwlyZXQgPSBpOTE1X3Zt
YV91bmJpbmQodm1hKTsKKwltdXRleF91bmxvY2soJnZtYS0+dm0tPm11dGV4KTsKKworCXJldHVy
biByZXQ7Cit9CisKIHN0YXRpYyB1bnNpZ25lZCBpbnQgZ2V0X2xhcmdlc3RfcGFnZV9zaXplKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCQkgIHU2NCByZW0pCiB7CkBAIC0zMzMs
NyArMzQ0LDExIEBAIHN0YXRpYyBpbnQgaWd0X2NoZWNrX3BhZ2Vfc2l6ZXMoc3RydWN0IGk5MTVf
dm1hICp2bWEpCiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB2bWEtPnZtLT5pOTE1
OwogCXVuc2lnbmVkIGludCBzdXBwb3J0ZWQgPSBJTlRFTF9JTkZPKGk5MTUpLT5wYWdlX3NpemVz
OwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB2bWEtPm9iajsKLQlpbnQgZXJy
ID0gMDsKKwlpbnQgZXJyOworCisJZXJyID0gaTkxNV9hY3RpdmVfd2FpdCgmdm1hLT5hY3RpdmUp
OworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CiAKIAlpZiAoIUhBU19QQUdFX1NJWkVTKGk5MTUs
IHZtYS0+cGFnZV9zaXplcy5zZykpIHsKIAkJcHJfZXJyKCJ1bnN1cHBvcnRlZCBwYWdlX3NpemVz
LnNnPSV1LCBzdXBwb3J0ZWQ9JXVcbiIsCkBAIC01MjYsNyArNTQxLDcgQEAgc3RhdGljIGludCBp
Z3RfbW9ja19wcGd0dF9taXNhbGlnbmVkX2RtYSh2b2lkICphcmcpCiAJCSAqIHBhZ2VzLgogCQkg
Ki8KIAkJZm9yIChvZmZzZXQgPSA0MDk2OyBvZmZzZXQgPCBwYWdlX3NpemU7IG9mZnNldCArPSA0
MDk2KSB7Ci0JCQllcnIgPSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJCWVyciA9IHVubG9ja2Vk
X3ZtYV91bmJpbmQodm1hKTsKIAkJCWlmIChlcnIpIHsKIAkJCQlpOTE1X3ZtYV9jbG9zZSh2bWEp
OwogCQkJCWdvdG8gb3V0X3VucGluOwpAQCAtOTQxLDcgKzk1Niw3IEBAIHN0YXRpYyBpbnQgX19p
Z3Rfd3JpdGVfaHVnZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJaWYgKElTX0VSUih2bWEp
KQogCQlyZXR1cm4gUFRSX0VSUih2bWEpOwogCi0JZXJyID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7
CisJZXJyID0gdW5sb2NrZWRfdm1hX3VuYmluZCh2bWEpOwogCWlmIChlcnIpCiAJCWdvdG8gb3V0
X3ZtYV9jbG9zZTsKIApAQCAtMTM5MCw3ICsxNDA1LDcgQEAgc3RhdGljIGludCBpZ3RfcHBndHRf
cGluX3VwZGF0ZSh2b2lkICphcmcpCiAJCQlnb3RvIG91dF91bnBpbjsKIAkJfQogCi0JCWVyciA9
IGk5MTVfdm1hX2JpbmQodm1hLCBJOTE1X0NBQ0hFX05PTkUsIFBJTl9VUERBVEUpOworCQllcnIg
PSBpOTE1X3ZtYV9iaW5kKHZtYSwgSTkxNV9DQUNIRV9OT05FLCBQSU5fVVBEQVRFLCBOVUxMKTsK
IAkJaWYgKGVycikKIAkJCWdvdG8gb3V0X3VucGluOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCmluZGV4IGRhNTRhNzE4
YzcxMi4uYWE2N2MwMmJhOThjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
c2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYwpAQCAtNzQ3LDEwICs3NDcsNyBAQCBlbWl0
X3JwY3NfcXVlcnkoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlpZiAoZXJyKQog
CQlnb3RvIHNraXBfcmVxdWVzdDsKIAotCWk5MTVfdm1hX3VucGluKGJhdGNoKTsKLQlpOTE1X3Zt
YV9jbG9zZShiYXRjaCk7Ci0JaTkxNV92bWFfcHV0KGJhdGNoKTsKLQorCWk5MTVfdm1hX3VucGlu
X2FuZF9yZWxlYXNlKCZiYXRjaCwgMCk7CiAJaTkxNV92bWFfdW5waW4odm1hKTsKIAogCSpycV9v
dXQgPSBpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKQEAgLTc2NCw4ICs3NjEsNyBAQCBlbWl0X3JwY3Nf
cXVlcnkoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIGVycl9yZXF1ZXN0OgogCWk5
MTVfcmVxdWVzdF9hZGQocnEpOwogZXJyX2JhdGNoOgotCWk5MTVfdm1hX3VucGluKGJhdGNoKTsK
LQlpOTE1X3ZtYV9wdXQoYmF0Y2gpOworCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZiYXRj
aCwgMCk7CiBlcnJfdm1hOgogCWk5MTVfdm1hX3VucGluKHZtYSk7CiAKQEAgLTEzMDksOSArMTMw
NSw3IEBAIHN0YXRpYyBpbnQgd3JpdGVfdG9fc2NyYXRjaChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqY3R4LAogCWlmIChlcnIpCiAJCWdvdG8gc2tpcF9yZXF1ZXN0OwogCi0JaTkxNV92bWFfdW5w
aW4odm1hKTsKLQlpOTE1X3ZtYV9jbG9zZSh2bWEpOwotCWk5MTVfdm1hX3B1dCh2bWEpOworCWk5
MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZ2bWEsIDApOwogCiAJaTkxNV9yZXF1ZXN0X2FkZChy
cSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkx
NV9nZW1fbW1hbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dl
bV9tbWFuLmMKaW5kZXggMWQyN2JhYmZmMGNlLi45YzIxN2RmZTk2YTkgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jCkBAIC0yMDUs
NyArMjA1LDYgQEAgc3RhdGljIGludCBpZ3RfcGFydGlhbF90aWxpbmcodm9pZCAqYXJnKQogCQln
b3RvIG91dDsKIAl9CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAl3
YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwogCiAJaWYg
KDEpIHsKQEAgLTMxOCw3ICszMTcsNiBAQCBuZXh0X3RpbGluZzogOwogCiBvdXRfdW5sb2NrOgog
CWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRl
eF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWk5MTVfZ2VtX29iamVjdF91bnBp
bl9wYWdlcyhvYmopOwogb3V0OgogCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGlscy5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pZ3RfZ2VtX3V0aWxzLmMKaW5kZXgg
ZWU1ZGMxM2EzMGIzLi42NzE4ZGEyMGYzNWQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGlscy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGlscy5jCkBAIC0xNTQsOSArMTU0LDcgQEAgaW50
IGlndF9ncHVfZmlsbF9kdyhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAKIAlpOTE1X3JlcXVl
c3RfYWRkKHJxKTsKIAotCWk5MTVfdm1hX3VucGluKGJhdGNoKTsKLQlpOTE1X3ZtYV9jbG9zZShi
YXRjaCk7Ci0JaTkxNV92bWFfcHV0KGJhdGNoKTsKKwlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFz
ZSgmYmF0Y2gsIDApOwogCiAJcmV0dXJuIDA7CiAKQEAgLTE2NSw3ICsxNjMsNiBAQCBpbnQgaWd0
X2dwdV9maWxsX2R3KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKIGVycl9yZXF1ZXN0OgogCWk5
MTVfcmVxdWVzdF9hZGQocnEpOwogZXJyX2JhdGNoOgotCWk5MTVfdm1hX3VucGluKGJhdGNoKTsK
LQlpOTE1X3ZtYV9wdXQoYmF0Y2gpOworCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZiYXRj
aCwgMCk7CiAJcmV0dXJuIGVycjsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2d0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jCmluZGV4
IGQ0OGVjOWE3NmVkMS4uYzJhZmZmYjk0NDc0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9ndC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0
LmMKQEAgLTIwNywxMSArMjA3LDEyIEBAIHZvaWQgaW50ZWxfZ3RfZmx1c2hfZ2d0dF93cml0ZXMo
c3RydWN0IGludGVsX2d0ICpndCkKIAogCXdpdGhfaW50ZWxfcnVudGltZV9wbSgmaTkxNS0+cnVu
dGltZV9wbSwgd2FrZXJlZikgewogCQlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSBndC0+
dW5jb3JlOworCQl1bnNpZ25lZCBsb25nIGZsYWdzOwogCi0JCXNwaW5fbG9ja19pcnEoJnVuY29y
ZS0+bG9jayk7CisJCXNwaW5fbG9ja19pcnFzYXZlKCZ1bmNvcmUtPmxvY2ssIGZsYWdzKTsKIAkJ
aW50ZWxfdW5jb3JlX3Bvc3RpbmdfcmVhZF9mdyh1bmNvcmUsCiAJCQkJCSAgICAgUklOR19IRUFE
KFJFTkRFUl9SSU5HX0JBU0UpKTsKLQkJc3Bpbl91bmxvY2tfaXJxKCZ1bmNvcmUtPmxvY2spOwor
CQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZ1bmNvcmUtPmxvY2ssIGZsYWdzKTsKIAl9CiB9CiAK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYwppbmRleCBhYzU1YTBk
MDU0YmQuLjg1NWU5N2NjYWY5ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfcmluZ2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jp
bmdidWZmZXIuYwpAQCAtMTMzNiwxNSArMTMzNiwxMyBAQCB2b2lkIGludGVsX3JpbmdfZnJlZShz
dHJ1Y3Qga3JlZiAqcmVmKQogewogCXN0cnVjdCBpbnRlbF9yaW5nICpyaW5nID0gY29udGFpbmVy
X29mKHJlZiwgdHlwZW9mKCpyaW5nKSwgcmVmKTsKIAotCWk5MTVfdm1hX2Nsb3NlKHJpbmctPnZt
YSk7CiAJaTkxNV92bWFfcHV0KHJpbmctPnZtYSk7Ci0KIAlrZnJlZShyaW5nKTsKIH0KIAogc3Rh
dGljIHZvaWQgX19yaW5nX2NvbnRleHRfZmluaShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiB7
Ci0JaTkxNV9nZW1fb2JqZWN0X3B1dChjZS0+c3RhdGUtPm9iaik7CisJaTkxNV92bWFfcHV0KGNl
LT5zdGF0ZSk7CiB9CiAKIHN0YXRpYyB2b2lkIHJpbmdfY29udGV4dF9kZXN0cm95KHN0cnVjdCBr
cmVmICpyZWYpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9o
YW5nY2hlY2suYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5j
CmluZGV4IGEwMDk4ZmMzNTkyMS4uZTUzZWVhMTA1MGY4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYwpAQCAtMTEyNywxNSArMTEyNywxNCBAQCBzdGF0
aWMgaW50IGV2aWN0X3ZtYSh2b2lkICpkYXRhKQogewogCXN0cnVjdCBldmljdF92bWEgKmFyZyA9
IGRhdGE7CiAJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSBhcmctPnZtYS0+dm07Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB2bS0+aTkxNTsKIAlzdHJ1Y3QgZHJtX21t
X25vZGUgZXZpY3QgPSBhcmctPnZtYS0+bm9kZTsKIAlpbnQgZXJyOwogCiAJY29tcGxldGUoJmFy
Zy0+Y29tcGxldGlvbik7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
KwltdXRleF9sb2NrKCZ2bS0+bXV0ZXgpOwogCWVyciA9IGk5MTVfZ2VtX2V2aWN0X2Zvcl9ub2Rl
KHZtLCAmZXZpY3QsIDApOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CisJbXV0ZXhfdW5sb2NrKCZ2bS0+bXV0ZXgpOwogCiAJcmV0dXJuIGVycjsKIH0KQEAgLTExNDMs
MzkgKzExNDIsMzMgQEAgc3RhdGljIGludCBldmljdF92bWEodm9pZCAqZGF0YSkKIHN0YXRpYyBp
bnQgZXZpY3RfZmVuY2Uodm9pZCAqZGF0YSkKIHsKIAlzdHJ1Y3QgZXZpY3Rfdm1hICphcmcgPSBk
YXRhOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnLT52bWEtPnZtLT5pOTE1
OwogCWludCBlcnI7CiAKIAljb21wbGV0ZSgmYXJnLT5jb21wbGV0aW9uKTsKIAotCW11dGV4X2xv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJLyogTWFyayB0aGUgZmVuY2UgcmVnaXN0
ZXIgYXMgZGlydHkgdG8gZm9yY2UgdGhlIG1taW8gdXBkYXRlLiAqLwogCWVyciA9IGk5MTVfZ2Vt
X29iamVjdF9zZXRfdGlsaW5nKGFyZy0+dm1hLT5vYmosIEk5MTVfVElMSU5HX1ksIDUxMik7CiAJ
aWYgKGVycikgewogCQlwcl9lcnIoIkludmFsaWQgWS10aWxpbmcgc2V0dGluZ3M7IGVycjolZFxu
IiwgZXJyKTsKLQkJZ290byBvdXRfdW5sb2NrOworCQlyZXR1cm4gZXJyOwogCX0KIAogCWVyciA9
IGk5MTVfdm1hX3BpbihhcmctPnZtYSwgMCwgMCwgUElOX0dMT0JBTCB8IFBJTl9NQVBQQUJMRSk7
CiAJaWYgKGVycikgewogCQlwcl9lcnIoIlVuYWJsZSB0byBwaW4gdm1hIGZvciBZLXRpbGVkIGZl
bmNlOyBlcnI6JWRcbiIsIGVycik7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJcmV0dXJuIGVycjsK
IAl9CiAKIAllcnIgPSBpOTE1X3ZtYV9waW5fZmVuY2UoYXJnLT52bWEpOwogCWk5MTVfdm1hX3Vu
cGluKGFyZy0+dm1hKTsKIAlpZiAoZXJyKSB7CiAJCXByX2VycigiVW5hYmxlIHRvIHBpbiBZLXRp
bGVkIGZlbmNlOyBlcnI6JWRcbiIsIGVycik7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJcmV0dXJu
IGVycjsKIAl9CiAKIAlpOTE1X3ZtYV91bnBpbl9mZW5jZShhcmctPnZtYSk7CiAKLW91dF91bmxv
Y2s6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQotCXJldHVybiBl
cnI7CisJcmV0dXJuIDA7CiB9CiAKIHN0YXRpYyBpbnQgX19pZ3RfcmVzZXRfZXZpY3Rfdm1hKHN0
cnVjdCBpbnRlbF9ndCAqZ3QsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQv
YXBlcnR1cmVfZ20uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9hcGVydHVyZV9nbS5jCmlu
ZGV4IDVmZjI0MzdiMjk5OC4uZDk5NmJiYzdlYTU5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndnQvYXBlcnR1cmVfZ20uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQv
YXBlcnR1cmVfZ20uYwpAQCAtNjEsMTQgKzYxLDE0IEBAIHN0YXRpYyBpbnQgYWxsb2NfZ20oc3Ry
dWN0IGludGVsX3ZncHUgKnZncHUsIGJvb2wgaGlnaF9nbSkKIAkJZmxhZ3MgPSBQSU5fTUFQUEFC
TEU7CiAJfQogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11
dGV4X2xvY2soJmRldl9wcml2LT5nZ3R0LnZtLm11dGV4KTsKIAltbWlvX2h3X2FjY2Vzc19wcmUo
ZGV2X3ByaXYpOwogCXJldCA9IGk5MTVfZ2VtX2d0dF9pbnNlcnQoJmRldl9wcml2LT5nZ3R0LnZt
LCBub2RlLAogCQkJCSAgc2l6ZSwgSTkxNV9HVFRfUEFHRV9TSVpFLAogCQkJCSAgSTkxNV9DT0xP
Ul9VTkVWSUNUQUJMRSwKIAkJCQkgIHN0YXJ0LCBlbmQsIGZsYWdzKTsKIAltbWlvX2h3X2FjY2Vz
c19wb3N0KGRldl9wcml2KTsKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211
dGV4KTsKKwltdXRleF91bmxvY2soJmRldl9wcml2LT5nZ3R0LnZtLm11dGV4KTsKIAlpZiAocmV0
KQogCQlndnRfZXJyKCJmYWlsIHRvIGFsbG9jICVzIGdtIHNwYWNlIGZyb20gaG9zdFxuIiwKIAkJ
CWhpZ2hfZ20gPyAiaGlnaCIgOiAibG93Iik7CkBAIC05OCw5ICs5OCw5IEBAIHN0YXRpYyBpbnQg
YWxsb2NfdmdwdV9nbShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAogCXJldHVybiAwOwogb3V0
X2ZyZWVfYXBlcnR1cmU6Ci0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgp
OworCW11dGV4X2xvY2soJmRldl9wcml2LT5nZ3R0LnZtLm11dGV4KTsKIAlkcm1fbW1fcmVtb3Zl
X25vZGUoJnZncHUtPmdtLmxvd19nbV9ub2RlKTsKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5k
cm0uc3RydWN0X211dGV4KTsKKwltdXRleF91bmxvY2soJmRldl9wcml2LT5nZ3R0LnZtLm11dGV4
KTsKIAlyZXR1cm4gcmV0OwogfQogCkBAIC0xMDgsMTAgKzEwOCwxMCBAQCBzdGF0aWMgdm9pZCBm
cmVlX3ZncHVfZ20oc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiB7CiAJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdmdwdS0+Z3Z0LT5kZXZfcHJpdjsKIAotCW11dGV4X2xvY2so
JmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF9sb2NrKCZkZXZfcHJpdi0+Z2d0
dC52bS5tdXRleCk7CiAJZHJtX21tX3JlbW92ZV9ub2RlKCZ2Z3B1LT5nbS5sb3dfZ21fbm9kZSk7
CiAJZHJtX21tX3JlbW92ZV9ub2RlKCZ2Z3B1LT5nbS5oaWdoX2dtX25vZGUpOwotCW11dGV4X3Vu
bG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X3VubG9jaygmZGV2X3By
aXYtPmdndHQudm0ubXV0ZXgpOwogfQogCiAvKioKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfYWN0aXZlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5j
CmluZGV4IDZhNDQ3ZjFkMDExMC4uODk0OGY1NjMzOTFhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
YWN0aXZlLmMKQEAgLTE0Niw2ICsxNDYsNyBAQCBfX2FjdGl2ZV9yZXRpcmUoc3RydWN0IGk5MTVf
YWN0aXZlICpyZWYpCiAJaWYgKCFyZXRpcmUpCiAJCXJldHVybjsKIAorCUdFTV9CVUdfT04ocmN1
X2FjY2Vzc19wb2ludGVyKHJlZi0+ZXhjbCkpOwogCXJidHJlZV9wb3N0b3JkZXJfZm9yX2VhY2hf
ZW50cnlfc2FmZShpdCwgbiwgJnJvb3QsIG5vZGUpIHsKIAkJR0VNX0JVR19PTihpOTE1X2FjdGl2
ZV9yZXF1ZXN0X2lzc2V0KCZpdC0+YmFzZSkpOwogCQlrbWVtX2NhY2hlX2ZyZWUoZ2xvYmFsLnNs
YWJfY2FjaGUsIGl0KTsKQEAgLTI0NSw2ICsyNDYsOCBAQCB2b2lkIF9faTkxNV9hY3RpdmVfaW5p
dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlyZWYtPmZsYWdzID0gMDsKIAlyZWYt
PmFjdGl2ZSA9IGFjdGl2ZTsKIAlyZWYtPnJldGlyZSA9IHJldGlyZTsKKworCXJlZi0+ZXhjbCA9
IE5VTEw7CiAJcmVmLT50cmVlID0gUkJfUk9PVDsKIAlyZWYtPmNhY2hlID0gTlVMTDsKIAlpbml0
X2xsaXN0X2hlYWQoJnJlZi0+cHJlYWxsb2NhdGVkX2JhcnJpZXJzKTsKQEAgLTM0MSw2ICszNDQs
NDUgQEAgaW50IGk5MTVfYWN0aXZlX3JlZihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKIAlyZXR1
cm4gZXJyOwogfQogCitzdGF0aWMgdm9pZCBleGNsX2NiKHN0cnVjdCBkbWFfZmVuY2UgKmYsIHN0
cnVjdCBkbWFfZmVuY2VfY2IgKmNiKQoreworCXN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmID0gY29u
dGFpbmVyX29mKGNiLCB0eXBlb2YoKnJlZiksIGV4Y2xfY2IpOworCisJUkNVX0lOSVRfUE9JTlRF
UihyZWYtPmV4Y2wsIE5VTEwpOworCWRtYV9mZW5jZV9wdXQoZik7CisKKwlhY3RpdmVfcmV0aXJl
KHJlZik7Cit9CisKK3ZvaWQgaTkxNV9hY3RpdmVfc2V0X2V4Y2x1c2l2ZShzdHJ1Y3QgaTkxNV9h
Y3RpdmUgKnJlZiwgc3RydWN0IGRtYV9mZW5jZSAqZikKK3sKKwlHRU1fQlVHX09OKGk5MTVfYWN0
aXZlX2lzX2lkbGUocmVmKSk7CisKKwlkbWFfZmVuY2VfZ2V0KGYpOworCisJcmN1X3JlYWRfbG9j
aygpOworCWlmIChyY3VfYWNjZXNzX3BvaW50ZXIocmVmLT5leGNsKSkgeworCQlzdHJ1Y3QgZG1h
X2ZlbmNlICpvbGQ7CisKKwkJb2xkID0gZG1hX2ZlbmNlX2dldF9yY3Vfc2FmZSgmcmVmLT5leGNs
KTsKKwkJaWYgKG9sZCkgeworCQkJaWYgKGRtYV9mZW5jZV9yZW1vdmVfY2FsbGJhY2sob2xkLCAm
cmVmLT5leGNsX2NiKSkKKwkJCQlhdG9taWNfZGVjKCZyZWYtPmNvdW50KTsKKwkJCWRtYV9mZW5j
ZV9wdXQob2xkKTsKKwkJfQorCX0KKwlyY3VfcmVhZF91bmxvY2soKTsKKworCWF0b21pY19pbmMo
JnJlZi0+Y291bnQpOworCXJjdV9hc3NpZ25fcG9pbnRlcihyZWYtPmV4Y2wsIGYpOworCisJaWYg
KGRtYV9mZW5jZV9hZGRfY2FsbGJhY2soZiwgJnJlZi0+ZXhjbF9jYiwgZXhjbF9jYikpIHsKKwkJ
UkNVX0lOSVRfUE9JTlRFUihyZWYtPmV4Y2wsIE5VTEwpOworCQlhdG9taWNfZGVjKCZyZWYtPmNv
dW50KTsKKwkJZG1hX2ZlbmNlX3B1dChmKTsKKwl9Cit9CisKIGludCBpOTE1X2FjdGl2ZV9hY3F1
aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQogewogCWludCBlcnI7CkBAIC0zOTksNiArNDQx
LDI1IEBAIHZvaWQgaTkxNV9hY3RpdmVfdW5ncmFiKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQog
CV9fYWN0aXZlX3VuZ3JhYihyZWYpOwogfQogCitzdGF0aWMgaW50IGV4Y2xfd2FpdChzdHJ1Y3Qg
aTkxNV9hY3RpdmUgKnJlZikKK3sKKwlzdHJ1Y3QgZG1hX2ZlbmNlICpvbGQ7CisJaW50IGVyciA9
IDA7CisKKwlpZiAoIXJjdV9hY2Nlc3NfcG9pbnRlcihyZWYtPmV4Y2wpKQorCQlyZXR1cm4gMDsK
KworCXJjdV9yZWFkX2xvY2soKTsKKwlvbGQgPSBkbWFfZmVuY2VfZ2V0X3JjdV9zYWZlKCZyZWYt
PmV4Y2wpOworCXJjdV9yZWFkX3VubG9jaygpOworCWlmIChvbGQpIHsKKwkJZXJyID0gZG1hX2Zl
bmNlX3dhaXQob2xkLCB0cnVlKTsKKwkJZG1hX2ZlbmNlX3B1dChvbGQpOworCX0KKworCXJldHVy
biBlcnI7Cit9CisKIGludCBpOTE1X2FjdGl2ZV93YWl0KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVm
KQogewogCXN0cnVjdCBhY3RpdmVfbm9kZSAqaXQsICpuOwpAQCAtNDE5LDYgKzQ4MCwxMCBAQCBp
bnQgaTkxNV9hY3RpdmVfd2FpdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIAkJcmV0dXJuIDA7
CiAJfQogCisJZXJyID0gZXhjbF93YWl0KHJlZik7CisJaWYgKGVycikKKwkJZ290byBvdXQ7CisK
IAlyYnRyZWVfcG9zdG9yZGVyX2Zvcl9lYWNoX2VudHJ5X3NhZmUoaXQsIG4sICZyZWYtPnRyZWUs
IG5vZGUpIHsKIAkJaWYgKGlzX2JhcnJpZXIoJml0LT5iYXNlKSkgeyAvKiB1bmNvbm5lY3RlZCBp
ZGxlLWJhcnJpZXIgKi8KIAkJCWVyciA9IC1FQlVTWTsKQEAgLTQzMCw2ICs0OTUsNyBAQCBpbnQg
aTkxNV9hY3RpdmVfd2FpdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIAkJCWJyZWFrOwogCX0K
IAorb3V0OgogCV9fYWN0aXZlX3JldGlyZShyZWYpOwogCWlmIChlcnIpCiAJCXJldHVybiBlcnI7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5oIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaAppbmRleCBmOTUwNThmOTkwNTcuLmJjMWM5ZDVk
NGY2MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5oCkBAIC0zNzMsNiArMzczLDggQEAg
aW50IGk5MTVfYWN0aXZlX3JlZihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKIAkJICAgIHN0cnVj
dCBpbnRlbF90aW1lbGluZSAqdGwsCiAJCSAgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSk7CiAK
K3ZvaWQgaTkxNV9hY3RpdmVfc2V0X2V4Y2x1c2l2ZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwg
c3RydWN0IGRtYV9mZW5jZSAqZik7CisKIGludCBpOTE1X2FjdGl2ZV93YWl0KHN0cnVjdCBpOTE1
X2FjdGl2ZSAqcmVmKTsKIAogaW50IGk5MTVfcmVxdWVzdF9hd2FpdF9hY3RpdmUoc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnEsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Fj
dGl2ZV90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmVfdHlwZXMuaApp
bmRleCAxODU0ZTdkMTY4YzEuLjg2ZTdhMjMyZWEzYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9hY3RpdmVfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2FjdGl2ZV90eXBlcy5oCkBAIC04LDYgKzgsNyBAQAogI2RlZmluZSBfSTkxNV9BQ1RJVkVf
VFlQRVNfSF8KIAogI2luY2x1ZGUgPGxpbnV4L2F0b21pYy5oPgorI2luY2x1ZGUgPGxpbnV4L2Rt
YS1mZW5jZS5oPgogI2luY2x1ZGUgPGxpbnV4L2xsaXN0Lmg+CiAjaW5jbHVkZSA8bGludXgvbXV0
ZXguaD4KICNpbmNsdWRlIDxsaW51eC9yYnRyZWUuaD4KQEAgLTUxLDYgKzUyLDEwIEBAIHN0cnVj
dCBpOTE1X2FjdGl2ZSB7CiAJc3RydWN0IG11dGV4IG11dGV4OwogCWF0b21pY190IGNvdW50Owog
CisJLyogUHJlYWxsb2NhdGVkICJleGNsdXNpdmUiIG5vZGUgKi8KKwlzdHJ1Y3QgZG1hX2ZlbmNl
IF9fcmN1ICpleGNsOworCXN0cnVjdCBkbWFfZmVuY2VfY2IgZXhjbF9jYjsKKwogCXVuc2lnbmVk
IGxvbmcgZmxhZ3M7CiAjZGVmaW5lIEk5MTVfQUNUSVZFX0dSQUJfQklUIDAKIApkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ2VtLmMKaW5kZXggODE0ZjYyZmNhNzI3Li42NmFiYjQyN2FhNDcgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW0uYwpAQCAtNjIsMjAgKzYyLDMxIEBACiAjaW5jbHVkZSAiaW50ZWxfcG0uaCIK
IAogc3RhdGljIGludAotaW5zZXJ0X21hcHBhYmxlX25vZGUoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0
dCwKLSAgICAgICAgICAgICAgICAgICAgIHN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZSwgdTMyIHNp
emUpCitpbnNlcnRfbWFwcGFibGVfbm9kZShzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0LCBzdHJ1Y3Qg
ZHJtX21tX25vZGUgKm5vZGUsIHUzMiBzaXplKQogeworCWludCBlcnI7CisKKwllcnIgPSBtdXRl
eF9sb2NrX2ludGVycnVwdGlibGUoJmdndHQtPnZtLm11dGV4KTsKKwlpZiAoZXJyKQorCQlyZXR1
cm4gZXJyOworCiAJbWVtc2V0KG5vZGUsIDAsIHNpemVvZigqbm9kZSkpOwotCXJldHVybiBkcm1f
bW1faW5zZXJ0X25vZGVfaW5fcmFuZ2UoJmdndHQtPnZtLm1tLCBub2RlLAotCQkJCQkgICBzaXpl
LCAwLCBJOTE1X0NPTE9SX1VORVZJQ1RBQkxFLAotCQkJCQkgICAwLCBnZ3R0LT5tYXBwYWJsZV9l
bmQsCi0JCQkJCSAgIERSTV9NTV9JTlNFUlRfTE9XKTsKKwllcnIgPSBkcm1fbW1faW5zZXJ0X25v
ZGVfaW5fcmFuZ2UoJmdndHQtPnZtLm1tLCBub2RlLAorCQkJCQkgIHNpemUsIDAsIEk5MTVfQ09M
T1JfVU5FVklDVEFCTEUsCisJCQkJCSAgMCwgZ2d0dC0+bWFwcGFibGVfZW5kLAorCQkJCQkgIERS
TV9NTV9JTlNFUlRfTE9XKTsKKworCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOworCisJ
cmV0dXJuIGVycjsKIH0KIAogc3RhdGljIHZvaWQKLXJlbW92ZV9tYXBwYWJsZV9ub2RlKHN0cnVj
dCBkcm1fbW1fbm9kZSAqbm9kZSkKK3JlbW92ZV9tYXBwYWJsZV9ub2RlKHN0cnVjdCBpOTE1X2dn
dHQgKmdndHQsIHN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZSkKIHsKKwltdXRleF9sb2NrKCZnZ3R0
LT52bS5tdXRleCk7CiAJZHJtX21tX3JlbW92ZV9ub2RlKG5vZGUpOworCW11dGV4X3VubG9jaygm
Z2d0dC0+dm0ubXV0ZXgpOwogfQogCiBpbnQKQEAgLTg3LDcgKzk4LDggQEAgaTkxNV9nZW1fZ2V0
X2FwZXJ0dXJlX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJc3Ry
dWN0IGk5MTVfdm1hICp2bWE7CiAJdTY0IHBpbm5lZDsKIAotCW11dGV4X2xvY2soJmdndHQtPnZt
Lm11dGV4KTsKKwlpZiAobXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZnZ3R0LT52bS5tdXRleCkp
CisJCXJldHVybiAtRUlOVFI7CiAKIAlwaW5uZWQgPSBnZ3R0LT52bS5yZXNlcnZlZDsKIAlsaXN0
X2Zvcl9lYWNoX2VudHJ5KHZtYSwgJmdndHQtPnZtLmJvdW5kX2xpc3QsIHZtX2xpbmspCkBAIC0x
MDksMjAgKzEyMSwzMSBAQCBpbnQgaTkxNV9nZW1fb2JqZWN0X3VuYmluZChzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqLAogCUxJU1RfSEVBRChzdGlsbF9pbl9saXN0KTsKIAlpbnQgcmV0
ID0gMDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJm9iai0+YmFzZS5kZXYtPnN0cnVjdF9tdXRl
eCk7Ci0KIAlzcGluX2xvY2soJm9iai0+dm1hLmxvY2spOwogCXdoaWxlICghcmV0ICYmICh2bWEg
PSBsaXN0X2ZpcnN0X2VudHJ5X29yX251bGwoJm9iai0+dm1hLmxpc3QsCiAJCQkJCQkgICAgICAg
c3RydWN0IGk5MTVfdm1hLAogCQkJCQkJICAgICAgIG9ial9saW5rKSkpIHsKKwkJc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqdm0gPSB2bWEtPnZtOworCisJCXJldCA9IC1FQlVTWTsKKwkJaWYg
KCFpOTE1X3ZtX3RyeW9wZW4odm0pKQorCQkJYnJlYWs7CisKIAkJbGlzdF9tb3ZlX3RhaWwoJnZt
YS0+b2JqX2xpbmssICZzdGlsbF9pbl9saXN0KTsKIAkJc3Bpbl91bmxvY2soJm9iai0+dm1hLmxv
Y2spOwogCi0JCXJldCA9IC1FQlVTWTsKIAkJaWYgKGZsYWdzICYgSTkxNV9HRU1fT0JKRUNUX1VO
QklORF9BQ1RJVkUgfHwKLQkJICAgICFpOTE1X3ZtYV9pc19hY3RpdmUodm1hKSkKLQkJCXJldCA9
IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQkgICAgIWk5MTVfdm1hX2lzX2FjdGl2ZSh2bWEpKSB7
CisJCQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IHZtYS0+dm07CisKKwkJCXJldCA9
IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmdm0tPm11dGV4KTsKKwkJCWlmICghcmV0KSB7CisJ
CQkJcmV0ID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CisJCQkJbXV0ZXhfdW5sb2NrKCZ2bS0+bXV0
ZXgpOworCQkJfQorCQl9CiAKKwkJaTkxNV92bV9jbG9zZSh2bSk7CiAJCXNwaW5fbG9jaygmb2Jq
LT52bWEubG9jayk7CiAJfQogCWxpc3Rfc3BsaWNlKCZzdGlsbF9pbl9saXN0LCAmb2JqLT52bWEu
bGlzdCk7CkBAIC0zMzgsMTAgKzM2MSw2IEBAIGk5MTVfZ2VtX2d0dF9wcmVhZChzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCXU2NCByZW1haW4sIG9mZnNldDsKIAlpbnQgcmV0Owog
Ci0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCiAJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVf
cG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKIAl2bWEgPSBFUlJfUFRSKC1FTk9ERVYpOwogCWlm
ICghaTkxNV9nZW1fb2JqZWN0X2lzX3RpbGVkKG9iaikpCkBAIC0zNTUsMTIgKzM3NCwxMCBAQCBp
OTE1X2dlbV9ndHRfcHJlYWQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAl9IGVs
c2UgewogCQlyZXQgPSBpbnNlcnRfbWFwcGFibGVfbm9kZShnZ3R0LCAmbm9kZSwgUEFHRV9TSVpF
KTsKIAkJaWYgKHJldCkKLQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCWdvdG8gb3V0X3JwbTsKIAkJ
R0VNX0JVR19PTighZHJtX21tX25vZGVfYWxsb2NhdGVkKCZub2RlKSk7CiAJfQogCi0JbXV0ZXhf
dW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCXJldCA9IGk5MTVfZ2VtX29iamVj
dF9sb2NrX2ludGVycnVwdGlibGUob2JqKTsKIAlpZiAocmV0KQogCQlnb3RvIG91dF91bnBpbjsK
QEAgLTQxNCwxNyArNDMxLDE0IEBAIGk5MTVfZ2VtX2d0dF9wcmVhZChzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqLAogCiAJaTkxNV9nZW1fb2JqZWN0X3VubG9ja19mZW5jZShvYmosIGZl
bmNlKTsKIG91dF91bnBpbjoKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
IAlpZiAoZHJtX21tX25vZGVfYWxsb2NhdGVkKCZub2RlKSkgewogCQlnZ3R0LT52bS5jbGVhcl9y
YW5nZSgmZ2d0dC0+dm0sIG5vZGUuc3RhcnQsIG5vZGUuc2l6ZSk7Ci0JCXJlbW92ZV9tYXBwYWJs
ZV9ub2RlKCZub2RlKTsKKwkJcmVtb3ZlX21hcHBhYmxlX25vZGUoZ2d0dCwgJm5vZGUpOwogCX0g
ZWxzZSB7CiAJCWk5MTVfdm1hX3VucGluKHZtYSk7CiAJfQotb3V0X3VubG9jazoKK291dF9ycG06
CiAJaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlyZXR1cm4gcmV0OwogfQog
CkBAIC01MzEsMTAgKzU0NSw2IEBAIGk5MTVfZ2VtX2d0dF9wd3JpdGVfZmFzdChzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCXZvaWQgX191c2VyICp1c2VyX2RhdGE7CiAJaW50IHJl
dDsKIAotCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQogCWlmIChpOTE1X2dlbV9vYmplY3Rf
aGFzX3N0cnVjdF9wYWdlKG9iaikpIHsKIAkJLyoKIAkJICogQXZvaWQgd2FraW5nIHRoZSBkZXZp
Y2UgdXAgaWYgd2UgY2FuIGZhbGxiYWNrLCBhcwpAQCAtNTQ0LDEwICs1NTQsOCBAQCBpOTE1X2dl
bV9ndHRfcHdyaXRlX2Zhc3Qoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJICog
dXNpbmcgdGhlIGNhY2hlIGJ5cGFzcyBvZiBpbmRpcmVjdCBHR1RUIGFjY2Vzcy4KIAkJICovCiAJ
CXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldF9pZl9pbl91c2UocnBtKTsKLQkJaWYgKCF3
YWtlcmVmKSB7Ci0JCQlyZXQgPSAtRUZBVUxUOwotCQkJZ290byBvdXRfdW5sb2NrOwotCQl9CisJ
CWlmICghd2FrZXJlZikKKwkJCXJldHVybiAtRUZBVUxUOwogCX0gZWxzZSB7CiAJCS8qIE5vIGJh
Y2tpbmcgcGFnZXMsIG5vIGZhbGxiYWNrLCB3ZSBtdXN0IGZvcmNlIEdHVFQgYWNjZXNzICovCiAJ
CXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldChycG0pOwpAQCAtNTY5LDggKzU3Nyw2IEBA
IGk5MTVfZ2VtX2d0dF9wd3JpdGVfZmFzdChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
LAogCQlHRU1fQlVHX09OKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJm5vZGUpKTsKIAl9CiAKLQlt
dXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJcmV0ID0gaTkxNV9nZW1f
b2JqZWN0X2xvY2tfaW50ZXJydXB0aWJsZShvYmopOwogCWlmIChyZXQpCiAJCWdvdG8gb3V0X3Vu
cGluOwpAQCAtNjM0LDE4ICs2NDAsMTUgQEAgaTkxNV9nZW1fZ3R0X3B3cml0ZV9mYXN0KHN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAKIAlpOTE1X2dlbV9vYmplY3RfdW5sb2NrX2Zl
bmNlKG9iaiwgZmVuY2UpOwogb3V0X3VucGluOgotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCWludGVsX2d0X2ZsdXNoX2dndHRfd3JpdGVzKGdndHQtPnZtLmd0KTsKIAlp
ZiAoZHJtX21tX25vZGVfYWxsb2NhdGVkKCZub2RlKSkgewogCQlnZ3R0LT52bS5jbGVhcl9yYW5n
ZSgmZ2d0dC0+dm0sIG5vZGUuc3RhcnQsIG5vZGUuc2l6ZSk7Ci0JCXJlbW92ZV9tYXBwYWJsZV9u
b2RlKCZub2RlKTsKKwkJcmVtb3ZlX21hcHBhYmxlX25vZGUoZ2d0dCwgJm5vZGUpOwogCX0gZWxz
ZSB7CiAJCWk5MTVfdm1hX3VucGluKHZtYSk7CiAJfQogb3V0X3JwbToKIAlpbnRlbF9ydW50aW1l
X3BtX3B1dChycG0sIHdha2VyZWYpOwotb3V0X3VubG9jazoKLQltdXRleF91bmxvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiByZXQ7CiB9CiAKQEAgLTk2Nyw4ICs5NzAsNiBA
QCBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9i
aiwKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAlpbnQgcmV0OwogCi0JbG9ja2RlcF9hc3NlcnRf
aGVsZCgmb2JqLT5iYXNlLmRldi0+c3RydWN0X211dGV4KTsKLQogCWlmIChmbGFncyAmIFBJTl9N
QVBQQUJMRSAmJgogCSAgICAoIXZpZXcgfHwgdmlldy0+dHlwZSA9PSBJOTE1X0dHVFRfVklFV19O
T1JNQUwpKSB7CiAJCS8qIElmIHRoZSByZXF1aXJlZCBzcGFjZSBpcyBsYXJnZXIgdGhhbiB0aGUg
YXZhaWxhYmxlCkBAIC0xMDIyLDcgKzEwMjMsOSBAQCBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4o
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJICAgICBpOTE1X2dndHRfb2Zmc2V0
KHZtYSksIGFsaWdubWVudCwKIAkJICAgICAhIShmbGFncyAmIFBJTl9NQVBQQUJMRSksCiAJCSAg
ICAgaTkxNV92bWFfaXNfbWFwX2FuZF9mZW5jZWFibGUodm1hKSk7CisJCW11dGV4X2xvY2soJnZt
YS0+dm0tPm11dGV4KTsKIAkJcmV0ID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CisJCW11dGV4X3Vu
bG9jaygmdm1hLT52bS0+bXV0ZXgpOwogCQlpZiAocmV0KQogCQkJcmV0dXJuIEVSUl9QVFIocmV0
KTsKIAl9CkBAIC0xMzI4LDcgKzEzMzEsOSBAQCBzdGF0aWMgaW50IF9faW50ZWxfZW5naW5lc19y
ZWNvcmRfZGVmYXVsdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJCSAqIGZyb20g
dGhlIEdUVCB0byBwcmV2ZW50IHN1Y2ggYWNjaWRlbnRzIGFuZCByZWNsYWltIHRoZQogCQkgKiBz
cGFjZS4KIAkJICovCisJCW11dGV4X2xvY2soJnN0YXRlLT52bS0+bXV0ZXgpOwogCQllcnIgPSBp
OTE1X3ZtYV91bmJpbmQoc3RhdGUpOworCQltdXRleF91bmxvY2soJnN0YXRlLT52bS0+bXV0ZXgp
OwogCQlpZiAoZXJyKQogCQkJZ290byBvdXQ7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtX2V2aWN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9l
dmljdC5jCmluZGV4IDdhYmNhYzNiNWUyZS4uNDRmNWI2MzhmYTQzIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ldmljdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtX2V2aWN0LmMKQEAgLTQ3LDggKzQ3LDcgQEAgc3RhdGljIGludCBnZ3R0X2Zs
dXNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCSAqIGJvdW5kIGJ5IHRoZWlyIGFj
dGl2ZSByZWZlcmVuY2UuCiAJICovCiAJcmV0dXJuIGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoaTkx
NSwKLQkJCQkgICAgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSB8Ci0JCQkJICAgICAgSTkxNV9X
QUlUX0xPQ0tFRCwKKwkJCQkgICAgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSwKIAkJCQkgICAg
ICBNQVhfU0NIRURVTEVfVElNRU9VVCk7CiB9CiAKQEAgLTEwNCw3ICsxMDMsNyBAQCBpOTE1X2dl
bV9ldmljdF9zb21ldGhpbmcoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJc3RydWN0
IGk5MTVfdm1hICphY3RpdmU7CiAJaW50IHJldDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZt
LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bS0+bXV0
ZXgpOwogCXRyYWNlX2k5MTVfZ2VtX2V2aWN0KHZtLCBtaW5fc2l6ZSwgYWxpZ25tZW50LCBmbGFn
cyk7CiAKIAkvKgpAQCAtMTI3LDE1ICsxMjYsNiBAQCBpOTE1X2dlbV9ldmljdF9zb21ldGhpbmco
c3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJCQkJICAgIG1pbl9zaXplLCBhbGlnbm1l
bnQsIGNhY2hlX2xldmVsLAogCQkJCSAgICBzdGFydCwgZW5kLCBtb2RlKTsKIAotCS8qCi0JICog
UmV0aXJlIGJlZm9yZSB3ZSBzZWFyY2ggdGhlIGFjdGl2ZSBsaXN0LiBBbHRob3VnaCB3ZSBoYXZl
Ci0JICogcmVhc29uYWJsZSBhY2N1cmFjeSBpbiBvdXIgcmV0aXJlbWVudCBsaXN0cywgd2UgbWF5
IGhhdmUKLQkgKiBhIHN0cmF5IHBpbiAocHJldmVudGluZyBldmljdGlvbikgdGhhdCBjYW4gb25s
eSBiZSByZXNvbHZlZCBieQotCSAqIHJldGlyaW5nLgotCSAqLwotCWlmICghKGZsYWdzICYgUElO
X05PTkJMT0NLKSkKLQkJaTkxNV9yZXRpcmVfcmVxdWVzdHMoZGV2X3ByaXYpOwotCiBzZWFyY2hf
YWdhaW46CiAJYWN0aXZlID0gTlVMTDsKIAlJTklUX0xJU1RfSEVBRCgmZXZpY3Rpb25fbGlzdCk7
CkBAIC0yNjksNyArMjU5LDcgQEAgaW50IGk5MTVfZ2VtX2V2aWN0X2Zvcl9ub2RlKHN0cnVjdCBp
OTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCWJvb2wgY2hlY2tfY29sb3I7CiAJaW50IHJldCA9IDA7
CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJ
bG9ja2RlcF9hc3NlcnRfaGVsZCgmdm0tPm11dGV4KTsKIAlHRU1fQlVHX09OKCFJU19BTElHTkVE
KHN0YXJ0LCBJOTE1X0dUVF9QQUdFX1NJWkUpKTsKIAlHRU1fQlVHX09OKCFJU19BTElHTkVEKGVu
ZCwgSTkxNV9HVFRfUEFHRV9TSVpFKSk7CiAKQEAgLTM3NSw3ICszNjUsNyBAQCBpbnQgaTkxNV9n
ZW1fZXZpY3Rfdm0oc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiAJc3RydWN0IGk5MTVf
dm1hICp2bWEsICpuZXh0OwogCWludCByZXQ7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bS0+
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm0tPm11dGV4
KTsKIAl0cmFjZV9pOTE1X2dlbV9ldmljdF92bSh2bSk7CiAKIAkvKiBTd2l0Y2ggYmFjayB0byB0
aGUgZGVmYXVsdCBjb250ZXh0IGluIG9yZGVyIHRvIHVucGluCkBAIC0zOTAsNyArMzgwLDYgQEAg
aW50IGk5MTVfZ2VtX2V2aWN0X3ZtKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogCX0K
IAogCUlOSVRfTElTVF9IRUFEKCZldmljdGlvbl9saXN0KTsKLQltdXRleF9sb2NrKCZ2bS0+bXV0
ZXgpOwogCWxpc3RfZm9yX2VhY2hfZW50cnkodm1hLCAmdm0tPmJvdW5kX2xpc3QsIHZtX2xpbmsp
IHsKIAkJaWYgKGk5MTVfdm1hX2lzX3Bpbm5lZCh2bWEpKQogCQkJY29udGludWU7CkBAIC0zOTgs
NyArMzg3LDYgQEAgaW50IGk5MTVfZ2VtX2V2aWN0X3ZtKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3Bh
Y2UgKnZtKQogCQlfX2k5MTVfdm1hX3Bpbih2bWEpOwogCQlsaXN0X2FkZCgmdm1hLT5ldmljdF9s
aW5rLCAmZXZpY3Rpb25fbGlzdCk7CiAJfQotCW11dGV4X3VubG9jaygmdm0tPm11dGV4KTsKIAog
CXJldCA9IDA7CiAJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHZtYSwgbmV4dCwgJmV2aWN0aW9u
X2xpc3QsIGV2aWN0X2xpbmspIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ2VtX2ZlbmNlX3JlZy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZmVuY2Vf
cmVnLmMKaW5kZXggNjE1YTlmNGVmMzBjLi4xZTkzZjJhYWZjODAgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5jCkBAIC0zMzEsMTMgKzMzMSwxNSBAQCBzdGF0aWMg
c3RydWN0IGk5MTVfZmVuY2VfcmVnICpmZW5jZV9maW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQogCXJldHVybiBFUlJfUFRSKC1FREVBRExLKTsKIH0KIAotc3RhdGljIGludCBfX2k5
MTVfdm1hX3Bpbl9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKK2ludCBfX2k5MTVfdm1hX3Bp
bl9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKIAlzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0
ID0gaTkxNV92bV90b19nZ3R0KHZtYS0+dm0pOwogCXN0cnVjdCBpOTE1X2ZlbmNlX3JlZyAqZmVu
Y2U7CiAJc3RydWN0IGk5MTVfdm1hICpzZXQgPSBpOTE1X2dlbV9vYmplY3RfaXNfdGlsZWQodm1h
LT5vYmopID8gdm1hIDogTlVMTDsKIAlpbnQgZXJyOwogCisJbG9ja2RlcF9hc3NlcnRfaGVsZCgm
dm1hLT52bS0+bXV0ZXgpOworCiAJLyogSnVzdCB1cGRhdGUgb3VyIHBsYWNlIGluIHRoZSBMUlUg
aWYgb3VyIGZlbmNlIGlzIGdldHRpbmcgcmV1c2VkLiAqLwogCWlmICh2bWEtPmZlbmNlKSB7CiAJ
CWZlbmNlID0gdm1hLT5mZW5jZTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ2VtX2d0dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKaW5kZXgg
M2UyYmYwMDM3NmYzLi5iYTViZTUzZWVhYzMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtX2d0dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0
dC5jCkBAIC0xNTAsMTYgKzE1MCwxOCBAQCBzdGF0aWMgdm9pZCBnbWNoX2dndHRfaW52YWxpZGF0
ZShzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogCiBzdGF0aWMgaW50IHBwZ3R0X2JpbmRfdm1hKHN0
cnVjdCBpOTE1X3ZtYSAqdm1hLAogCQkJICBlbnVtIGk5MTVfY2FjaGVfbGV2ZWwgY2FjaGVfbGV2
ZWwsCi0JCQkgIHUzMiB1bnVzZWQpCisJCQkgIHUzMiBmbGFncykKIHsKIAl1MzIgcHRlX2ZsYWdz
OwogCWludCBlcnI7CiAKLQlpZiAoIWk5MTVfdm1hX2lzX2JvdW5kKHZtYSwgSTkxNV9WTUFfTE9D
QUxfQklORCkpIHsKKwlpZiAoZmxhZ3MgJiBJOTE1X1ZNQV9BTExPQykgewogCQllcnIgPSB2bWEt
PnZtLT5hbGxvY2F0ZV92YV9yYW5nZSh2bWEtPnZtLAogCQkJCQkJIHZtYS0+bm9kZS5zdGFydCwg
dm1hLT5zaXplKTsKIAkJaWYgKGVycikKIAkJCXJldHVybiBlcnI7CisKKwkJc2V0X2JpdChJOTE1
X1ZNQV9BTExPQ19CSVQsIF9faTkxNV92bWFfZmxhZ3Modm1hKSk7CiAJfQogCiAJLyogQXBwbGlj
YWJsZSB0byBWTFYsIGFuZCBnZW44KyAqLwpAQCAtMTY3LDYgKzE2OSw3IEBAIHN0YXRpYyBpbnQg
cHBndHRfYmluZF92bWEoc3RydWN0IGk5MTVfdm1hICp2bWEsCiAJaWYgKGk5MTVfZ2VtX29iamVj
dF9pc19yZWFkb25seSh2bWEtPm9iaikpCiAJCXB0ZV9mbGFncyB8PSBQVEVfUkVBRF9PTkxZOwog
CisJR0VNX0JVR19PTighdGVzdF9iaXQoSTkxNV9WTUFfQUxMT0NfQklULCBfX2k5MTVfdm1hX2Zs
YWdzKHZtYSkpKTsKIAl2bWEtPnZtLT5pbnNlcnRfZW50cmllcyh2bWEtPnZtLCB2bWEsIGNhY2hl
X2xldmVsLCBwdGVfZmxhZ3MpOwogCXdtYigpOwogCkBAIC0xNzUsNyArMTc4LDggQEAgc3RhdGlj
IGludCBwcGd0dF9iaW5kX3ZtYShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAogc3RhdGljIHZvaWQg
cHBndHRfdW5iaW5kX3ZtYShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKLQl2bWEtPnZtLT5jbGVh
cl9yYW5nZSh2bWEtPnZtLCB2bWEtPm5vZGUuc3RhcnQsIHZtYS0+c2l6ZSk7CisJaWYgKHRlc3Rf
YW5kX2NsZWFyX2JpdChJOTE1X1ZNQV9BTExPQ19CSVQsIF9faTkxNV92bWFfZmxhZ3Modm1hKSkp
CisJCXZtYS0+dm0tPmNsZWFyX3JhbmdlKHZtYS0+dm0sIHZtYS0+bm9kZS5zdGFydCwgdm1hLT5z
aXplKTsKIH0KIAogc3RhdGljIGludCBwcGd0dF9zZXRfcGFnZXMoc3RydWN0IGk5MTVfdm1hICp2
bWEpCkBAIC01MDMsMTUgKzUwNywyNSBAQCBzdGF0aWMgdm9pZCBpOTE1X2FkZHJlc3Nfc3BhY2Vf
ZmluaShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIAltdXRleF9kZXN0cm95KCZ2bS0+
bXV0ZXgpOwogfQogCi1zdGF0aWMgdm9pZCBwcGd0dF9kZXN0cm95X3ZtYShzdHJ1Y3QgaTkxNV9h
ZGRyZXNzX3NwYWNlICp2bSkKK3ZvaWQgX19pOTE1X3ZtX2Nsb3NlKHN0cnVjdCBpOTE1X2FkZHJl
c3Nfc3BhY2UgKnZtKQogewogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hLCAqdm47CiAKLQltdXRleF9s
b2NrKCZ2bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JbGlzdF9mb3JfZWFjaF9lbnRyeV9z
YWZlKHZtYSwgdm4sICZ2bS0+Ym91bmRfbGlzdCwgdm1fbGluaykKKwltdXRleF9sb2NrKCZ2bS0+
bXV0ZXgpOworCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZSh2bWEsIHZuLCAmdm0tPmJvdW5kX2xp
c3QsIHZtX2xpbmspIHsKKwkJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IHZtYS0+
b2JqOworCisJCWlmICgha3JlZl9nZXRfdW5sZXNzX3plcm8oJm9iai0+YmFzZS5yZWZjb3VudCkp
CisJCQljb250aW51ZTsKKworCQlhdG9taWNfYW5kKH5JOTE1X1ZNQV9QSU5fTUFTSywgJnZtYS0+
ZmxhZ3MpOworCQlXQVJOX09OKGk5MTVfdm1hX3VuYmluZCh2bWEpKTsKIAkJaTkxNV92bWFfZGVz
dHJveSh2bWEpOworCisJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwl9CiAJR0VNX0JVR19P
TighbGlzdF9lbXB0eSgmdm0tPmJvdW5kX2xpc3QpKTsKLQltdXRleF91bmxvY2soJnZtLT5pOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF91bmxvY2soJnZtLT5tdXRleCk7CiB9CiAKIHN0
YXRpYyB2b2lkIF9faTkxNV92bV9yZWxlYXNlKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKQEAg
LTUxOSw4ICs1MzMsNiBAQCBzdGF0aWMgdm9pZCBfX2k5MTVfdm1fcmVsZWFzZShzdHJ1Y3Qgd29y
a19zdHJ1Y3QgKndvcmspCiAJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPQogCQljb250
YWluZXJfb2Yod29yaywgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSwgcmN1LndvcmspOwogCi0J
cHBndHRfZGVzdHJveV92bWEodm0pOwotCiAJdm0tPmNsZWFudXAodm0pOwogCWk5MTVfYWRkcmVz
c19zcGFjZV9maW5pKHZtKTsKIApAQCAtNTM1LDcgKzU0Nyw2IEBAIHZvaWQgaTkxNV92bV9yZWxl
YXNlKHN0cnVjdCBrcmVmICprcmVmKQogCUdFTV9CVUdfT04oaTkxNV9pc19nZ3R0KHZtKSk7CiAJ
dHJhY2VfaTkxNV9wcGd0dF9yZWxlYXNlKHZtKTsKIAotCXZtLT5jbG9zZWQgPSB0cnVlOwogCXF1
ZXVlX3JjdV93b3JrKHZtLT5pOTE1LT53cSwgJnZtLT5yY3UpOwogfQogCkBAIC01NDMsNiArNTU0
LDcgQEAgc3RhdGljIHZvaWQgaTkxNV9hZGRyZXNzX3NwYWNlX2luaXQoc3RydWN0IGk5MTVfYWRk
cmVzc19zcGFjZSAqdm0sIGludCBzdWJjbGFzcykKIHsKIAlrcmVmX2luaXQoJnZtLT5yZWYpOwog
CUlOSVRfUkNVX1dPUksoJnZtLT5yY3UsIF9faTkxNV92bV9yZWxlYXNlKTsKKwlhdG9taWNfc2V0
KCZ2bS0+b3BlbiwgMSk7CiAKIAkvKgogCSAqIFRoZSB2bS0+bXV0ZXggbXVzdCBiZSByZWNsYWlt
IHNhZmUgKGZvciB1c2UgaW4gdGhlIHNocmlua2VyKS4KQEAgLTE3NjksMTIgKzE3ODEsOCBAQCBz
dGF0aWMgdm9pZCBnZW42X3BwZ3R0X2ZyZWVfcGQoc3RydWN0IGdlbjZfcHBndHQgKnBwZ3R0KQog
c3RhdGljIHZvaWQgZ2VuNl9wcGd0dF9jbGVhbnVwKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ug
KnZtKQogewogCXN0cnVjdCBnZW42X3BwZ3R0ICpwcGd0dCA9IHRvX2dlbjZfcHBndHQoaTkxNV92
bV90b19wcGd0dCh2bSkpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdm0tPmk5
MTU7CiAKLQkvKiBGSVhNRSByZW1vdmUgdGhlIHN0cnVjdF9tdXRleCB0byBicmluZyB0aGUgbG9j
a2luZyB1bmRlciBjb250cm9sICovCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAJaTkxNV92bWFfZGVzdHJveShwcGd0dC0+dm1hKTsKLQltdXRleF91bmxvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJZ2VuNl9wcGd0dF9mcmVlX3BkKHBwZ3R0KTsKIAlmcmVl
X3NjcmF0Y2godm0pOwpAQCAtMTg2MSw3ICsxODY5LDggQEAgc3RhdGljIHN0cnVjdCBpOTE1X3Zt
YSAqcGRfdm1hX2NyZWF0ZShzdHJ1Y3QgZ2VuNl9wcGd0dCAqcHBndHQsIGludCBzaXplKQogCiAJ
aTkxNV9hY3RpdmVfaW5pdChpOTE1LCAmdm1hLT5hY3RpdmUsIE5VTEwsIE5VTEwpOwogCi0Jdm1h
LT52bSA9ICZnZ3R0LT52bTsKKwltdXRleF9pbml0KCZ2bWEtPnBhZ2VzX211dGV4KTsKKwl2bWEt
PnZtID0gaTkxNV92bV9nZXQoJmdndHQtPnZtKTsKIAl2bWEtPm9wcyA9ICZwZF92bWFfb3BzOwog
CXZtYS0+cHJpdmF0ZSA9IHBwZ3R0OwogCkBAIC0xODgxLDcgKzE4OTAsNyBAQCBpbnQgZ2VuNl9w
cGd0dF9waW4oc3RydWN0IGk5MTVfcHBndHQgKmJhc2UpCiAJc3RydWN0IGdlbjZfcHBndHQgKnBw
Z3R0ID0gdG9fZ2VuNl9wcGd0dChiYXNlKTsKIAlpbnQgZXJyOwogCi0JR0VNX0JVR19PTihwcGd0
dC0+YmFzZS52bS5jbG9zZWQpOworCUdFTV9CVUdfT04oIWF0b21pY19yZWFkKCZwcGd0dC0+YmFz
ZS52bS5vcGVuKSk7CiAKIAkvKgogCSAqIFdvcmthcm91bmQgdGhlIGxpbWl0ZWQgbWF4aW11bSB2
bWEtPnBpbl9jb3VudCBhbmQgdGhlIGFsaWFzaW5nX3BwZ3R0CkBAIC0yNDU3LDE0ICsyNDY2LDE4
IEBAIHN0YXRpYyBpbnQgYWxpYXNpbmdfZ3R0X2JpbmRfdm1hKHN0cnVjdCBpOTE1X3ZtYSAqdm1h
LAogCWlmIChmbGFncyAmIEk5MTVfVk1BX0xPQ0FMX0JJTkQpIHsKIAkJc3RydWN0IGk5MTVfcHBn
dHQgKmFsaWFzID0gaTkxNV92bV90b19nZ3R0KHZtYS0+dm0pLT5hbGlhczsKIAotCQlpZiAoIWk5
MTVfdm1hX2lzX2JvdW5kKHZtYSwgSTkxNV9WTUFfTE9DQUxfQklORCkpIHsKKwkJaWYgKGZsYWdz
ICYgSTkxNV9WTUFfQUxMT0MpIHsKIAkJCXJldCA9IGFsaWFzLT52bS5hbGxvY2F0ZV92YV9yYW5n
ZSgmYWxpYXMtPnZtLAogCQkJCQkJCSAgdm1hLT5ub2RlLnN0YXJ0LAogCQkJCQkJCSAgdm1hLT5z
aXplKTsKIAkJCWlmIChyZXQpCiAJCQkJcmV0dXJuIHJldDsKKworCQkJc2V0X2JpdChJOTE1X1ZN
QV9BTExPQ19CSVQsIF9faTkxNV92bWFfZmxhZ3Modm1hKSk7CiAJCX0KIAorCQlHRU1fQlVHX09O
KCF0ZXN0X2JpdChJOTE1X1ZNQV9BTExPQ19CSVQsCisJCQkJICAgICBfX2k5MTVfdm1hX2ZsYWdz
KHZtYSkpKTsKIAkJYWxpYXMtPnZtLmluc2VydF9lbnRyaWVzKCZhbGlhcy0+dm0sIHZtYSwKIAkJ
CQkJIGNhY2hlX2xldmVsLCBwdGVfZmxhZ3MpOwogCX0KQEAgLTI0OTMsNyArMjUwNiw3IEBAIHN0
YXRpYyB2b2lkIGFsaWFzaW5nX2d0dF91bmJpbmRfdm1hKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQog
CQkJdm0tPmNsZWFyX3JhbmdlKHZtLCB2bWEtPm5vZGUuc3RhcnQsIHZtYS0+c2l6ZSk7CiAJfQog
Ci0JaWYgKGk5MTVfdm1hX2lzX2JvdW5kKHZtYSwgSTkxNV9WTUFfTE9DQUxfQklORCkpIHsKKwlp
ZiAodGVzdF9hbmRfY2xlYXJfYml0KEk5MTVfVk1BX0FMTE9DX0JJVCwgX19pOTE1X3ZtYV9mbGFn
cyh2bWEpKSkgewogCQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9CiAJCQkmaTkxNV92
bV90b19nZ3R0KHZtYS0+dm0pLT5hbGlhcy0+dm07CiAKQEAgLTI1OTQsMjIgKzI2MDcsMTYgQEAg
c3RhdGljIGludCBpbml0X2FsaWFzaW5nX3BwZ3R0KHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiAK
IHN0YXRpYyB2b2lkIGZpbmlfYWxpYXNpbmdfcHBndHQoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCkK
IHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGdndHQtPnZtLmk5MTU7CiAJc3Ry
dWN0IGk5MTVfcHBndHQgKnBwZ3R0OwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7Ci0KIAlwcGd0dCA9IGZldGNoX2FuZF96ZXJvKCZnZ3R0LT5hbGlhcyk7CiAJaWYgKCFw
cGd0dCkKLQkJZ290byBvdXQ7CisJCXJldHVybjsKIAogCWk5MTVfdm1fcHV0KCZwcGd0dC0+dm0p
OwogCiAJZ2d0dC0+dm0udm1hX29wcy5iaW5kX3ZtYSAgID0gZ2d0dF9iaW5kX3ZtYTsKIAlnZ3R0
LT52bS52bWFfb3BzLnVuYmluZF92bWEgPSBnZ3R0X3VuYmluZF92bWE7Ci0KLW91dDoKLQltdXRl
eF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogfQogCiBzdGF0aWMgaW50IGdndHRf
cmVzZXJ2ZV9ndWNfdG9wKHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCkBAIC0yNzI2LDE1ICsyNzMz
LDE0IEBAIGludCBpOTE1X2luaXRfZ2d0dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
IAogc3RhdGljIHZvaWQgZ2d0dF9jbGVhbnVwX2h3KHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiB7
Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBnZ3R0LT52bS5pOTE1OwogCXN0cnVj
dCBpOTE1X3ZtYSAqdm1hLCAqdm47CiAKLQlnZ3R0LT52bS5jbG9zZWQgPSB0cnVlOworCWF0b21p
Y19zZXQoJmdndHQtPnZtLm9wZW4sIDApOwogCiAJcmN1X2JhcnJpZXIoKTsgLyogZmx1c2ggdGhl
IFJDVSdlZF9faTkxNV92bV9yZWxlYXNlICovCi0JZmx1c2hfd29ya3F1ZXVlKGk5MTUtPndxKTsK
KwlmbHVzaF93b3JrcXVldWUoZ2d0dC0+dm0uaTkxNS0+d3EpOwogCi0JbXV0ZXhfbG9jaygmaTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCiAJ
bGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHZtYSwgdm4sICZnZ3R0LT52bS5ib3VuZF9saXN0LCB2
bV9saW5rKQogCQlXQVJOX09OKGk5MTVfdm1hX3VuYmluZCh2bWEpKTsKQEAgLTI3NDMsMTUgKzI3
NDksMTIgQEAgc3RhdGljIHZvaWQgZ2d0dF9jbGVhbnVwX2h3KHN0cnVjdCBpOTE1X2dndHQgKmdn
dHQpCiAJCWRybV9tbV9yZW1vdmVfbm9kZSgmZ2d0dC0+ZXJyb3JfY2FwdHVyZSk7CiAKIAlnZ3R0
X3JlbGVhc2VfZ3VjX3RvcChnZ3R0KTsKLQotCWlmIChkcm1fbW1faW5pdGlhbGl6ZWQoJmdndHQt
PnZtLm1tKSkgewotCQlpbnRlbF92Z3RfZGViYWxsb29uKGdndHQpOwotCQlpOTE1X2FkZHJlc3Nf
c3BhY2VfZmluaSgmZ2d0dC0+dm0pOwotCX0KKwlpbnRlbF92Z3RfZGViYWxsb29uKGdndHQpOwog
CiAJZ2d0dC0+dm0uY2xlYW51cCgmZ2d0dC0+dm0pOwogCi0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKKwltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKKwlpOTE1
X2FkZHJlc3Nfc3BhY2VfZmluaSgmZ2d0dC0+dm0pOwogCiAJYXJjaF9waHlzX3djX2RlbChnZ3R0
LT5tdHJyKTsKIAlpb19tYXBwaW5nX2ZpbmkoJmdndHQtPmlvbWFwKTsKQEAgLTMxODAsOSArMzE4
Myw2IEBAIGludCBpOTE1X2dndHRfcHJvYmVfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCiBzdGF0aWMgaW50IGdndHRfaW5pdF9odyhzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogewog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ2d0dC0+dm0uaTkxNTsKLQlpbnQgcmV0
ID0gMDsKLQotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJaTkxNV9h
ZGRyZXNzX3NwYWNlX2luaXQoJmdndHQtPnZtLCBWTV9DTEFTU19HR1RUKTsKIApAQCAtMzE5OCwx
OCArMzE5OCwxNCBAQCBzdGF0aWMgaW50IGdndHRfaW5pdF9odyhzdHJ1Y3QgaTkxNV9nZ3R0ICpn
Z3R0KQogCQkJCWdndHQtPmdtYWRyLnN0YXJ0LAogCQkJCWdndHQtPm1hcHBhYmxlX2VuZCkpIHsK
IAkJZ2d0dC0+dm0uY2xlYW51cCgmZ2d0dC0+dm0pOwotCQlyZXQgPSAtRUlPOwotCQlnb3RvIG91
dDsKKwkJcmV0dXJuIC1FSU87CiAJfQogCiAJZ2d0dC0+bXRyciA9IGFyY2hfcGh5c193Y19hZGQo
Z2d0dC0+Z21hZHIuc3RhcnQsIGdndHQtPm1hcHBhYmxlX2VuZCk7CiAKIAlpOTE1X2dndHRfaW5p
dF9mZW5jZXMoZ2d0dCk7CiAKLW91dDoKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwotCi0JcmV0dXJuIHJldDsKKwlyZXR1cm4gMDsKIH0KIAogLyoqCkBAIC0zMjgxLDYg
KzMyNzcsNyBAQCBzdGF0aWMgdm9pZCBnZ3R0X3Jlc3RvcmVfbWFwcGluZ3Moc3RydWN0IGk5MTVf
Z2d0dCAqZ2d0dCkKIHsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgKnZuOwogCWJvb2wgZmx1c2gg
PSBmYWxzZTsKKwlpbnQgb3BlbjsKIAogCWludGVsX2d0X2NoZWNrX2FuZF9jbGVhcl9mYXVsdHMo
Z2d0dC0+dm0uZ3QpOwogCkBAIC0zMjg4LDcgKzMyODUsOSBAQCBzdGF0aWMgdm9pZCBnZ3R0X3Jl
c3RvcmVfbWFwcGluZ3Moc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCkKIAogCS8qIEZpcnN0IGZpbGwg
b3VyIHBvcnRpb24gb2YgdGhlIEdUVCB3aXRoIHNjcmF0Y2ggcGFnZXMgKi8KIAlnZ3R0LT52bS5j
bGVhcl9yYW5nZSgmZ2d0dC0+dm0sIDAsIGdndHQtPnZtLnRvdGFsKTsKLQlnZ3R0LT52bS5jbG9z
ZWQgPSB0cnVlOyAvKiBza2lwIHJld3JpdGluZyBQVEUgb24gVk1BIHVuYmluZCAqLworCisJLyog
U2tpcCByZXdyaXRpbmcgUFRFIG9uIFZNQSB1bmJpbmQuICovCisJb3BlbiA9IGF0b21pY194Y2hn
KCZnZ3R0LT52bS5vcGVuLCAwKTsKIAogCS8qIGNsZmx1c2ggb2JqZWN0cyBib3VuZCBpbnRvIHRo
ZSBHR1RUIGFuZCByZWJpbmQgdGhlbS4gKi8KIAlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUodm1h
LCB2biwgJmdndHQtPnZtLmJvdW5kX2xpc3QsIHZtX2xpbmspIHsKQEAgLTMyOTcsMjQgKzMyOTYs
MjAgQEAgc3RhdGljIHZvaWQgZ2d0dF9yZXN0b3JlX21hcHBpbmdzKHN0cnVjdCBpOTE1X2dndHQg
KmdndHQpCiAJCWlmICghaTkxNV92bWFfaXNfYm91bmQodm1hLCBJOTE1X1ZNQV9HTE9CQUxfQklO
RCkpCiAJCQljb250aW51ZTsKIAotCQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKLQog
CQlpZiAoIWk5MTVfdm1hX3VuYmluZCh2bWEpKQotCQkJZ290byBsb2NrOworCQkJY29udGludWU7
CiAKKwkJY2xlYXJfYml0KEk5MTVfVk1BX0dMT0JBTF9CSU5EX0JJVCwgX19pOTE1X3ZtYV9mbGFn
cyh2bWEpKTsKIAkJV0FSTl9PTihpOTE1X3ZtYV9iaW5kKHZtYSwKIAkJCQkgICAgICBvYmogPyBv
YmotPmNhY2hlX2xldmVsIDogMCwKLQkJCQkgICAgICBQSU5fVVBEQVRFKSk7CisJCQkJICAgICAg
UElOX0dMT0JBTCwgTlVMTCkpOwogCQlpZiAob2JqKSB7IC8qIG9ubHkgdXNlZCBkdXJpbmcgcmVz
dW1lID0+IGV4Y2x1c2l2ZSBhY2Nlc3MgKi8KIAkJCWZsdXNoIHw9IGZldGNoX2FuZF96ZXJvKCZv
YmotPndyaXRlX2RvbWFpbik7CiAJCQlvYmotPnJlYWRfZG9tYWlucyB8PSBJOTE1X0dFTV9ET01B
SU5fR1RUOwogCQl9Ci0KLWxvY2s6Ci0JCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAl9
CiAKLQlnZ3R0LT52bS5jbG9zZWQgPSBmYWxzZTsKKwlhdG9taWNfc2V0KCZnZ3R0LT52bS5vcGVu
LCBvcGVuKTsKIAlnZ3R0LT5pbnZhbGlkYXRlKGdndHQpOwogCiAJbXV0ZXhfdW5sb2NrKCZnZ3R0
LT52bS5tdXRleCk7CkBAIC0zNzA2LDcgKzM3MDEsOCBAQCBpbnQgaTkxNV9nZW1fZ3R0X2luc2Vy
dChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAl1NjQgb2Zmc2V0OwogCWludCBlcnI7
CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJ
bG9ja2RlcF9hc3NlcnRfaGVsZCgmdm0tPm11dGV4KTsKKwogCUdFTV9CVUdfT04oIXNpemUpOwog
CUdFTV9CVUdfT04oIUlTX0FMSUdORUQoc2l6ZSwgSTkxNV9HVFRfUEFHRV9TSVpFKSk7CiAJR0VN
X0JVR19PTihhbGlnbm1lbnQgJiYgIWlzX3Bvd2VyX29mXzIoYWxpZ25tZW50KSk7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaCBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtX2d0dC5oCmluZGV4IDlmYWY1OTBhOGU4YS4uYzMwZTc3YjlhMTJkIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaAorKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaApAQCAtMzA3LDcgKzMwNyw3IEBAIHN0cnVj
dCBpOTE1X2FkZHJlc3Nfc3BhY2UgewogCiAJdW5zaWduZWQgaW50IGJpbmRfYWxsb2M7CiAKLQli
b29sIGNsb3NlZDsKKwlhdG9taWNfdCBvcGVuOwogCiAJc3RydWN0IG11dGV4IG11dGV4OyAvKiBw
cm90ZWN0cyB2bWEgYW5kIG91ciBsaXN0cyAqLwogI2RlZmluZSBWTV9DTEFTU19HR1RUIDAKQEAg
LTU3Myw2ICs1NzMsMzUgQEAgc3RhdGljIGlubGluZSB2b2lkIGk5MTVfdm1fcHV0KHN0cnVjdCBp
OTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogCWtyZWZfcHV0KCZ2bS0+cmVmLCBpOTE1X3ZtX3JlbGVh
c2UpOwogfQogCitzdGF0aWMgaW5saW5lIHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKgoraTkx
NV92bV9vcGVuKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQoreworCUdFTV9CVUdfT04o
IWF0b21pY19yZWFkKCZ2bS0+b3BlbikpOworCWF0b21pY19pbmMoJnZtLT5vcGVuKTsKKwlyZXR1
cm4gaTkxNV92bV9nZXQodm0pOworfQorCitzdGF0aWMgaW5saW5lIGJvb2wKK2k5MTVfdm1fdHJ5
b3BlbihzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKK3sKKwlpZiAoYXRvbWljX2FkZF91
bmxlc3MoJnZtLT5vcGVuLCAxLCAwKSkKKwkJcmV0dXJuIGk5MTVfdm1fZ2V0KHZtKTsKKworCXJl
dHVybiBmYWxzZTsKK30KKwordm9pZCBfX2k5MTVfdm1fY2xvc2Uoc3RydWN0IGk5MTVfYWRkcmVz
c19zcGFjZSAqdm0pOworCitzdGF0aWMgaW5saW5lIHZvaWQKK2k5MTVfdm1fY2xvc2Uoc3RydWN0
IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCit7CisJR0VNX0JVR19PTighYXRvbWljX3JlYWQoJnZt
LT5vcGVuKSk7CisJaWYgKGF0b21pY19kZWNfYW5kX3Rlc3QoJnZtLT5vcGVuKSkKKwkJX19pOTE1
X3ZtX2Nsb3NlKHZtKTsKKworCWk5MTVfdm1fcHV0KHZtKTsKK30KKwogaW50IGdlbjZfcHBndHRf
cGluKHN0cnVjdCBpOTE1X3BwZ3R0ICpiYXNlKTsKIHZvaWQgZ2VuNl9wcGd0dF91bnBpbihzdHJ1
Y3QgaTkxNV9wcGd0dCAqYmFzZSk7CiB2b2lkIGdlbjZfcHBndHRfdW5waW5fYWxsKHN0cnVjdCBp
OTE1X3BwZ3R0ICpiYXNlKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
cGVyZi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKaW5kZXggMmM5ZjQ2ZTEy
NjIyLi4xMjQzYTg5YTQ3OGYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
cGVyZi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCkBAIC0xMjA0LDE1
ICsxMjA0LDEwIEBAIHN0YXRpYyBpbnQgaTkxNV9vYV9yZWFkKHN0cnVjdCBpOTE1X3BlcmZfc3Ry
ZWFtICpzdHJlYW0sCiBzdGF0aWMgc3RydWN0IGludGVsX2NvbnRleHQgKm9hX3Bpbl9jb250ZXh0
KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiB7CiAJc3RydWN0IGk5MTVfZ2VtX2Vu
Z2luZXNfaXRlciBpdDsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHN0cmVhbS0+
ZGV2X3ByaXY7CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IHN0cmVhbS0+Y3R4Owog
CXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAlpbnQgZXJyOwogCi0JZXJyID0gaTkxNV9tdXRl
eF9sb2NrX2ludGVycnVwdGlibGUoJmk5MTUtPmRybSk7Ci0JaWYgKGVycikKLQkJcmV0dXJuIEVS
Ul9QVFIoZXJyKTsKLQogCWZvcl9lYWNoX2dlbV9lbmdpbmUoY2UsIGk5MTVfZ2VtX2NvbnRleHRf
bG9ja19lbmdpbmVzKGN0eCksIGl0KSB7CiAJCWlmIChjZS0+ZW5naW5lLT5jbGFzcyAhPSBSRU5E
RVJfQ0xBU1MpCiAJCQljb250aW51ZTsKQEAgLTEyMjksMTAgKzEyMjQsNiBAQCBzdGF0aWMgc3Ry
dWN0IGludGVsX2NvbnRleHQgKm9hX3Bpbl9jb250ZXh0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFt
ICpzdHJlYW0pCiAJfQogCWk5MTVfZ2VtX2NvbnRleHRfdW5sb2NrX2VuZ2luZXMoY3R4KTsKIAot
CW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKGVycikKLQkJcmV0
dXJuIEVSUl9QVFIoZXJyKTsKLQogCXJldHVybiBzdHJlYW0tPnBpbm5lZF9jdHg7CiB9CiAKQEAg
LTEzNDgsMTUgKzEzMzksOSBAQCBzdGF0aWMgdm9pZCBvYV9wdXRfcmVuZGVyX2N0eF9pZChzdHJ1
Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogc3RhdGljIHZvaWQKIGZyZWVfb2FfYnVmZmVy
KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSBzdHJlYW0tPmRldl9wcml2OwotCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7Ci0KIAlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmc3RyZWFtLT5v
YV9idWZmZXIudm1hLAogCQkJCSAgIEk5MTVfVk1BX1JFTEVBU0VfTUFQKTsKIAotCW11dGV4X3Vu
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlzdHJlYW0tPm9hX2J1ZmZlci52YWRk
ciA9IE5VTEw7CiB9CiAKQEAgLTE1MTEsMTggKzE0OTYsMTMgQEAgc3RhdGljIGludCBhbGxvY19v
YV9idWZmZXIoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIAlpZiAoV0FSTl9PTihz
dHJlYW0tPm9hX2J1ZmZlci52bWEpKQogCQlyZXR1cm4gLUVOT0RFVjsKIAotCXJldCA9IGk5MTVf
bXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZkZXZfcHJpdi0+ZHJtKTsKLQlpZiAocmV0KQotCQly
ZXR1cm4gcmV0OwotCiAJQlVJTERfQlVHX09OX05PVF9QT1dFUl9PRl8yKE9BX0JVRkZFUl9TSVpF
KTsKIAlCVUlMRF9CVUdfT04oT0FfQlVGRkVSX1NJWkUgPCBTWl8xMjhLIHx8IE9BX0JVRkZFUl9T
SVpFID4gU1pfMTZNKTsKIAogCWJvID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zaG1lbShkZXZf
cHJpdiwgT0FfQlVGRkVSX1NJWkUpOwogCWlmIChJU19FUlIoYm8pKSB7CiAJCURSTV9FUlJPUigi
RmFpbGVkIHRvIGFsbG9jYXRlIE9BIGJ1ZmZlclxuIik7Ci0JCXJldCA9IFBUUl9FUlIoYm8pOwot
CQlnb3RvIHVubG9jazsKKwkJcmV0dXJuIFBUUl9FUlIoYm8pOwogCX0KIAogCWk5MTVfZ2VtX29i
amVjdF9zZXRfY2FjaGVfY29oZXJlbmN5KGJvLCBJOTE1X0NBQ0hFX0xMQyk7CkBAIC0xNTQ2LDcg
KzE1MjYsNyBAQCBzdGF0aWMgaW50IGFsbG9jX29hX2J1ZmZlcihzdHJ1Y3QgaTkxNV9wZXJmX3N0
cmVhbSAqc3RyZWFtKQogCQkJIGk5MTVfZ2d0dF9vZmZzZXQoc3RyZWFtLT5vYV9idWZmZXIudm1h
KSwKIAkJCSBzdHJlYW0tPm9hX2J1ZmZlci52YWRkcik7CiAKLQlnb3RvIHVubG9jazsKKwlyZXR1
cm4gMDsKIAogZXJyX3VucGluOgogCV9faTkxNV92bWFfdW5waW4odm1hKTsKQEAgLTE1NTcsOCAr
MTUzNyw2IEBAIHN0YXRpYyBpbnQgYWxsb2Nfb2FfYnVmZmVyKHN0cnVjdCBpOTE1X3BlcmZfc3Ry
ZWFtICpzdHJlYW0pCiAJc3RyZWFtLT5vYV9idWZmZXIudmFkZHIgPSBOVUxMOwogCXN0cmVhbS0+
b2FfYnVmZmVyLnZtYSA9IE5VTEw7CiAKLXVubG9jazoKLQltdXRleF91bmxvY2soJmRldl9wcml2
LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4gcmV0OwogfQogCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92
bWEuYwppbmRleCA5YWRiODViYTZkYWEuLjZlNGQ4ODViMmNlMiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3ZtYS5jCkBAIC0zMiw2ICszMiw3IEBACiAKICNpbmNsdWRlICJpOTE1X2Rydi5oIgogI2luY2x1
ZGUgImk5MTVfZ2xvYmFscy5oIgorI2luY2x1ZGUgImk5MTVfc3dfZmVuY2Vfd29yay5oIgogI2lu
Y2x1ZGUgImk5MTVfdHJhY2UuaCIKICNpbmNsdWRlICJpOTE1X3ZtYS5oIgogCkBAIC0xMTAsNyAr
MTExLDggQEAgdm1hX2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCWlm
ICh2bWEgPT0gTlVMTCkKIAkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CiAKLQl2bWEtPnZtID0g
dm07CisJbXV0ZXhfaW5pdCgmdm1hLT5wYWdlc19tdXRleCk7CisJdm1hLT52bSA9IGk5MTVfdm1f
Z2V0KHZtKTsKIAl2bWEtPm9wcyA9ICZ2bS0+dm1hX29wczsKIAl2bWEtPm9iaiA9IG9iajsKIAl2
bWEtPnJlc3YgPSBvYmotPmJhc2UucmVzdjsKQEAgLTI2MSw4ICsyNjMsNiBAQCB2bWFfbG9va3Vw
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAgKiBPbmNlIGNyZWF0ZWQsIHRoZSBW
TUEgaXMga2VwdCB1bnRpbCBlaXRoZXIgdGhlIG9iamVjdCBpcyBmcmVlZCwgb3IgdGhlCiAgKiBh
ZGRyZXNzIHNwYWNlIGlzIGNsb3NlZC4KICAqCi0gKiBNdXN0IGJlIGNhbGxlZCB3aXRoIHN0cnVj
dF9tdXRleCBoZWxkLgotICoKICAqIFJldHVybnMgdGhlIHZtYSwgb3IgYW4gZXJyb3IgcG9pbnRl
ci4KICAqLwogc3RydWN0IGk5MTVfdm1hICoKQEAgLTI3Myw3ICsyNzMsNyBAQCBpOTE1X3ZtYV9p
bnN0YW5jZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCXN0cnVjdCBpOTE1X3Zt
YSAqdm1hOwogCiAJR0VNX0JVR19PTih2aWV3ICYmICFpOTE1X2lzX2dndHQodm0pKTsKLQlHRU1f
QlVHX09OKHZtLT5jbG9zZWQpOworCUdFTV9CVUdfT04oIWF0b21pY19yZWFkKCZ2bS0+b3Blbikp
OwogCiAJc3Bpbl9sb2NrKCZvYmotPnZtYS5sb2NrKTsKIAl2bWEgPSB2bWFfbG9va3VwKG9iaiwg
dm0sIHZpZXcpOwpAQCAtMjg3LDE4ICsyODcsNjMgQEAgaTkxNV92bWFfaW5zdGFuY2Uoc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlyZXR1cm4gdm1hOwogfQogCitzdHJ1Y3QgaTkx
NV92bWFfd29yayB7CisJc3RydWN0IGRtYV9mZW5jZV93b3JrIGJhc2U7CisJc3RydWN0IGk5MTVf
dm1hICp2bWE7CisJZW51bSBpOTE1X2NhY2hlX2xldmVsIGNhY2hlX2xldmVsOworCXVuc2lnbmVk
IGludCBmbGFnczsKK307CisKK3N0YXRpYyBpbnQgX192bWFfYmluZChzdHJ1Y3QgZG1hX2ZlbmNl
X3dvcmsgKndvcmspCit7CisJc3RydWN0IGk5MTVfdm1hX3dvcmsgKnZ3ID0gY29udGFpbmVyX29m
KHdvcmssIHR5cGVvZigqdncpLCBiYXNlKTsKKwlzdHJ1Y3QgaTkxNV92bWEgKnZtYSA9IHZ3LT52
bWE7CisJaW50IGVycjsKKworCWVyciA9IHZtYS0+b3BzLT5iaW5kX3ZtYSh2bWEsIHZ3LT5jYWNo
ZV9sZXZlbCwgdnctPmZsYWdzKTsKKwlpZiAoZXJyKQorCQlhdG9taWNfb3IoSTkxNV9WTUFfRVJS
T1IsICZ2bWEtPmZsYWdzKTsKKworCWlmICh2bWEtPm9iaikKKwkJX19pOTE1X2dlbV9vYmplY3Rf
dW5waW5fcGFnZXModm1hLT5vYmopOworCisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIGNvbnN0
IHN0cnVjdCBkbWFfZmVuY2Vfd29ya19vcHMgYmluZF9vcHMgPSB7CisJLm5hbWUgPSAiYmluZCIs
CisJLndvcmsgPSBfX3ZtYV9iaW5kLAorfTsKKworc3RydWN0IGk5MTVfdm1hX3dvcmsgKmk5MTVf
dm1hX3dvcmsodm9pZCkKK3sKKwlzdHJ1Y3QgaTkxNV92bWFfd29yayAqdnc7CisKKwl2dyA9IGt6
YWxsb2Moc2l6ZW9mKCp2dyksIEdGUF9LRVJORUwpOworCWlmICghdncpCisJCXJldHVybiBOVUxM
OworCisJZG1hX2ZlbmNlX3dvcmtfaW5pdCgmdnctPmJhc2UsICZiaW5kX29wcyk7CisJdnctPmJh
c2UuZG1hLmVycm9yID0gLUVBR0FJTjsgLyogZGlzYWJsZSB0aGUgd29ya2VyIGJ5IGRlZmF1bHQg
Ki8KKworCXJldHVybiB2dzsKK30KKwogLyoqCiAgKiBpOTE1X3ZtYV9iaW5kIC0gU2V0cyB1cCBQ
VEVzIGZvciBhbiBWTUEgaW4gaXQncyBjb3JyZXNwb25kaW5nIGFkZHJlc3Mgc3BhY2UuCiAgKiBA
dm1hOiBWTUEgdG8gbWFwCiAgKiBAY2FjaGVfbGV2ZWw6IG1hcHBpbmcgY2FjaGUgbGV2ZWwKICAq
IEBmbGFnczogZmxhZ3MgbGlrZSBnbG9iYWwgb3IgbG9jYWwgbWFwcGluZworICogQHdvcms6IHBy
ZWFsbG9jYXRlZCB3b3JrZXIgZm9yIGFsbG9jYXRpbmcgYW5kIGJpbmRpbmcgdGhlIFBURQogICoK
ICAqIERNQSBhZGRyZXNzZXMgYXJlIHRha2VuIGZyb20gdGhlIHNjYXR0ZXItZ2F0aGVyIHRhYmxl
IG9mIHRoaXMgb2JqZWN0IChvciBvZgogICogdGhpcyBWTUEgaW4gY2FzZSBvZiBub24tZGVmYXVs
dCBHR1RUIHZpZXdzKSBhbmQgUFRFIGVudHJpZXMgc2V0IHVwLgogICogTm90ZSB0aGF0IERNQSBh
ZGRyZXNzZXMgYXJlIGFsc28gdGhlIG9ubHkgcGFydCBvZiB0aGUgU0cgdGFibGUgd2UgY2FyZSBh
Ym91dC4KICAqLwotaW50IGk5MTVfdm1hX2JpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEsIGVudW0g
aTkxNV9jYWNoZV9sZXZlbCBjYWNoZV9sZXZlbCwKLQkJICB1MzIgZmxhZ3MpCitpbnQgaTkxNV92
bWFfYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKKwkJICBlbnVtIGk5MTVfY2FjaGVfbGV2ZWwg
Y2FjaGVfbGV2ZWwsCisJCSAgdTMyIGZsYWdzLAorCQkgIHN0cnVjdCBpOTE1X3ZtYV93b3JrICp3
b3JrKQogewogCXUzMiBiaW5kX2ZsYWdzOwogCXUzMiB2bWFfZmxhZ3M7CkBAIC0zMTUsMTEgKzM2
MCw4IEBAIGludCBpOTE1X3ZtYV9iaW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCBlbnVtIGk5MTVf
Y2FjaGVfbGV2ZWwgY2FjaGVfbGV2ZWwsCiAJaWYgKEdFTV9ERUJVR19XQVJOX09OKCFmbGFncykp
CiAJCXJldHVybiAtRUlOVkFMOwogCi0JYmluZF9mbGFncyA9IDA7Ci0JaWYgKGZsYWdzICYgUElO
X0dMT0JBTCkKLQkJYmluZF9mbGFncyB8PSBJOTE1X1ZNQV9HTE9CQUxfQklORDsKLQlpZiAoZmxh
Z3MgJiBQSU5fVVNFUikKLQkJYmluZF9mbGFncyB8PSBJOTE1X1ZNQV9MT0NBTF9CSU5EOworCWJp
bmRfZmxhZ3MgPSBmbGFnczsKKwliaW5kX2ZsYWdzICY9IEk5MTVfVk1BX0dMT0JBTF9CSU5EIHwg
STkxNV9WTUFfTE9DQUxfQklORDsKIAogCXZtYV9mbGFncyA9IGF0b21pY19yZWFkKCZ2bWEtPmZs
YWdzKTsKIAl2bWFfZmxhZ3MgJj0gSTkxNV9WTUFfR0xPQkFMX0JJTkQgfCBJOTE1X1ZNQV9MT0NB
TF9CSU5EOwpAQCAtMzMzLDkgKzM3NSwzMSBAQCBpbnQgaTkxNV92bWFfYmluZChzdHJ1Y3QgaTkx
NV92bWEgKnZtYSwgZW51bSBpOTE1X2NhY2hlX2xldmVsIGNhY2hlX2xldmVsLAogCUdFTV9CVUdf
T04oIXZtYS0+cGFnZXMpOwogCiAJdHJhY2VfaTkxNV92bWFfYmluZCh2bWEsIGJpbmRfZmxhZ3Mp
OwotCXJldCA9IHZtYS0+b3BzLT5iaW5kX3ZtYSh2bWEsIGNhY2hlX2xldmVsLCBiaW5kX2ZsYWdz
KTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OworCWlmICh3b3JrICYmIChiaW5kX2ZsYWdzICYg
fnZtYV9mbGFncykgJiB2bWEtPnZtLT5iaW5kX2FsbG9jKSB7CisJCXdvcmstPnZtYSA9IHZtYTsK
KwkJd29yay0+Y2FjaGVfbGV2ZWwgPSBjYWNoZV9sZXZlbDsKKwkJd29yay0+ZmxhZ3MgPSBiaW5k
X2ZsYWdzIHwgSTkxNV9WTUFfQUxMT0M7CisKKwkJLyoKKwkJICogTm90ZSB3ZSBvbmx5IHdhbnQg
dG8gY2hhaW4gdXAgdG8gdGhlIG1pZ3JhdGlvbiBmZW5jZSBvbgorCQkgKiB0aGUgcGFnZXMgKG5v
dCB0aGUgb2JqZWN0IGl0c2VsZikuIEFzIHdlIGRvbid0IHRyYWNrIHRoYXQsCisJCSAqIHlldCwg
d2UgaGF2ZSB0byB1c2UgdGhlIGV4Y2x1c2l2ZSBmZW5jZSBpbnN0ZWFkLgorCQkgKgorCQkgKiBB
bHNvIG5vdGUgdGhhdCB3ZSBkbyBub3Qgd2FudCB0byB0cmFjayB0aGUgYXN5bmMgdm1hIGFzCisJ
CSAqIHBhcnQgb2YgdGhlIG9iai0+cmVzdi0+ZXhjbF9mZW5jZSBhcyBpdCBvbmx5IGFmZmVjdHMK
KwkJICogZXhlY3V0aW9uIGFuZCBub3QgY29udGVudCBvciBvYmplY3QncyBiYWNraW5nIHN0b3Jl
IGxpZmV0aW1lLgorCQkgKi8KKwkJaTkxNV9hY3RpdmVfc2V0X2V4Y2x1c2l2ZSgmdm1hLT5hY3Rp
dmUsICZ3b3JrLT5iYXNlLmRtYSk7CisJCXdvcmstPmJhc2UuZG1hLmVycm9yID0gMDsgLyogZW5h
YmxlIHRoZSBxdWV1ZV93b3JrKCkgKi8KKworCQlpZiAodm1hLT5vYmopCisJCQlfX2k5MTVfZ2Vt
X29iamVjdF9waW5fcGFnZXModm1hLT5vYmopOworCX0gZWxzZSB7CisJCUdFTV9CVUdfT04oKGJp
bmRfZmxhZ3MgJiB+dm1hX2ZsYWdzKSAmIHZtYS0+dm0tPmJpbmRfYWxsb2MpOworCQlyZXQgPSB2
bWEtPm9wcy0+YmluZF92bWEodm1hLCBjYWNoZV9sZXZlbCwgYmluZF9mbGFncyk7CisJCWlmIChy
ZXQpCisJCQlyZXR1cm4gcmV0OworCX0KIAogCWF0b21pY19vcihiaW5kX2ZsYWdzLCAmdm1hLT5m
bGFncyk7CiAJcmV0dXJuIDA7CkBAIC0zNDgsOSArNDEyLDcgQEAgdm9pZCBfX2lvbWVtICppOTE1
X3ZtYV9waW5faW9tYXAoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAKIAkvKiBBY2Nlc3MgdGhyb3Vn
aCB0aGUgR1RUIHJlcXVpcmVzIHRoZSBkZXZpY2UgdG8gYmUgYXdha2UuICovCiAJYXNzZXJ0X3Jw
bV93YWtlbG9ja19oZWxkKCZ2bWEtPnZtLT5pOTE1LT5ydW50aW1lX3BtKTsKLQotCWxvY2tkZXBf
YXNzZXJ0X2hlbGQoJnZtYS0+dm0tPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChXQVJO
X09OKCFpOTE1X3ZtYV9pc19tYXBfYW5kX2ZlbmNlYWJsZSh2bWEpKSkgeworCWlmIChHRU1fV0FS
Tl9PTighaTkxNV92bWFfaXNfbWFwX2FuZF9mZW5jZWFibGUodm1hKSkpIHsKIAkJZXJyID0gLUVO
T0RFVjsKIAkJZ290byBlcnI7CiAJfQpAQCAtMzY4LDcgKzQzMCw4IEBAIHZvaWQgX19pb21lbSAq
aTkxNV92bWFfcGluX2lvbWFwKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCQkJZ290byBlcnI7CiAJ
CX0KIAotCQl2bWEtPmlvbWFwID0gcHRyOworCQlpZiAodW5saWtlbHkoY21weGNoZygmdm1hLT5p
b21hcCwgTlVMTCwgcHRyKSkpCisJCQlpb19tYXBwaW5nX3VubWFwKHB0cik7CiAJfQogCiAJX19p
OTE1X3ZtYV9waW4odm1hKTsKQEAgLTM4OCwxOCArNDUxLDEyIEBAIHZvaWQgX19pb21lbSAqaTkx
NV92bWFfcGluX2lvbWFwKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCiB2b2lkIGk5MTVfdm1hX2Zs
dXNoX3dyaXRlcyhzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKLQlpZiAoIWk5MTVfdm1hX2hhc19n
Z3R0X3dyaXRlKHZtYSkpCi0JCXJldHVybjsKLQotCWludGVsX2d0X2ZsdXNoX2dndHRfd3JpdGVz
KHZtYS0+dm0tPmd0KTsKLQotCWk5MTVfdm1hX3Vuc2V0X2dndHRfd3JpdGUodm1hKTsKKwlpZiAo
aTkxNV92bWFfdW5zZXRfZ2d0dF93cml0ZSh2bWEpKQorCQlpbnRlbF9ndF9mbHVzaF9nZ3R0X3dy
aXRlcyh2bWEtPnZtLT5ndCk7CiB9CiAKIHZvaWQgaTkxNV92bWFfdW5waW5faW9tYXAoc3RydWN0
IGk5MTVfdm1hICp2bWEpCiB7Ci0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm1hLT52bS0+aTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlHRU1fQlVHX09OKHZtYS0+aW9tYXAgPT0gTlVMTCk7CiAK
IAlpOTE1X3ZtYV9mbHVzaF93cml0ZXModm1hKTsKQEAgLTUzOCw3ICs1OTUsNiBAQCBzdGF0aWMg
dm9pZCBhc3NlcnRfYmluZF9jb3VudChjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqKQogc3RhdGljIGludAogaTkxNV92bWFfaW5zZXJ0KHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1
NjQgc2l6ZSwgdTY0IGFsaWdubWVudCwgdTY0IGZsYWdzKQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IHZtYS0+dm0tPmk5MTU7CiAJdW5zaWduZWQgaW50IGNhY2hlX2xl
dmVsOwogCXU2NCBzdGFydCwgZW5kOwogCWludCByZXQ7CkBAIC01NjQsNyArNjIwLDcgQEAgaTkx
NV92bWFfaW5zZXJ0KHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1NjQgc2l6ZSwgdTY0IGFsaWdubWVu
dCwgdTY0IGZsYWdzKQogCiAJZW5kID0gdm1hLT52bS0+dG90YWw7CiAJaWYgKGZsYWdzICYgUElO
X01BUFBBQkxFKQotCQllbmQgPSBtaW5fdCh1NjQsIGVuZCwgZGV2X3ByaXYtPmdndHQubWFwcGFi
bGVfZW5kKTsKKwkJZW5kID0gbWluX3QodTY0LCBlbmQsIGk5MTVfdm1fdG9fZ2d0dCh2bWEtPnZt
KS0+bWFwcGFibGVfZW5kKTsKIAlpZiAoZmxhZ3MgJiBQSU5fWk9ORV80RykKIAkJZW5kID0gbWlu
X3QodTY0LCBlbmQsICgxVUxMIDw8IDMyKSAtIEk5MTVfR1RUX1BBR0VfU0laRSk7CiAJR0VNX0JV
R19PTighSVNfQUxJR05FRChlbmQsIEk5MTVfR1RUX1BBR0VfU0laRSkpOwpAQCAtNTgwLDM1ICs2
MzYsMjEgQEAgaTkxNV92bWFfaW5zZXJ0KHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1NjQgc2l6ZSwg
dTY0IGFsaWdubWVudCwgdTY0IGZsYWdzKQogCQlyZXR1cm4gLUVOT1NQQzsKIAl9CiAKLQlpZiAo
dm1hLT5vYmopIHsKLQkJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9wYWdlcyh2bWEtPm9iaik7
Ci0JCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0OwotCisJY2FjaGVfbGV2ZWwgPSAwOworCWlmICh2
bWEtPm9iaikKIAkJY2FjaGVfbGV2ZWwgPSB2bWEtPm9iai0+Y2FjaGVfbGV2ZWw7Ci0JfSBlbHNl
IHsKLQkJY2FjaGVfbGV2ZWwgPSAwOwotCX0KLQotCUdFTV9CVUdfT04odm1hLT5wYWdlcyk7Ci0K
LQlyZXQgPSB2bWEtPm9wcy0+c2V0X3BhZ2VzKHZtYSk7Ci0JaWYgKHJldCkKLQkJZ290byBlcnJf
dW5waW47CiAKIAlpZiAoZmxhZ3MgJiBQSU5fT0ZGU0VUX0ZJWEVEKSB7CiAJCXU2NCBvZmZzZXQg
PSBmbGFncyAmIFBJTl9PRkZTRVRfTUFTSzsKIAkJaWYgKCFJU19BTElHTkVEKG9mZnNldCwgYWxp
Z25tZW50KSB8fAotCQkgICAgcmFuZ2Vfb3ZlcmZsb3dzKG9mZnNldCwgc2l6ZSwgZW5kKSkgewot
CQkJcmV0ID0gLUVJTlZBTDsKLQkJCWdvdG8gZXJyX2NsZWFyOwotCQl9CisJCSAgICByYW5nZV9v
dmVyZmxvd3Mob2Zmc2V0LCBzaXplLCBlbmQpKQorCQkJcmV0dXJuIC1FSU5WQUw7CiAKIAkJcmV0
ID0gaTkxNV9nZW1fZ3R0X3Jlc2VydmUodm1hLT52bSwgJnZtYS0+bm9kZSwKIAkJCQkJICAgc2l6
ZSwgb2Zmc2V0LCBjYWNoZV9sZXZlbCwKIAkJCQkJICAgZmxhZ3MpOwogCQlpZiAocmV0KQotCQkJ
Z290byBlcnJfY2xlYXI7CisJCQlyZXR1cm4gcmV0OwogCX0gZWxzZSB7CiAJCS8qCiAJCSAqIFdl
IG9ubHkgc3VwcG9ydCBodWdlIGd0dCBwYWdlcyB0aHJvdWdoIHRoZSA0OGIgUFBHVFQsCkBAIC02
NDcsNyArNjg5LDcgQEAgaTkxNV92bWFfaW5zZXJ0KHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1NjQg
c2l6ZSwgdTY0IGFsaWdubWVudCwgdTY0IGZsYWdzKQogCQkJCQkgIHNpemUsIGFsaWdubWVudCwg
Y2FjaGVfbGV2ZWwsCiAJCQkJCSAgc3RhcnQsIGVuZCwgZmxhZ3MpOwogCQlpZiAocmV0KQotCQkJ
Z290byBlcnJfY2xlYXI7CisJCQlyZXR1cm4gcmV0OwogCiAJCUdFTV9CVUdfT04odm1hLT5ub2Rl
LnN0YXJ0IDwgc3RhcnQpOwogCQlHRU1fQlVHX09OKHZtYS0+bm9kZS5zdGFydCArIHZtYS0+bm9k
ZS5zaXplID4gZW5kKTsKQEAgLTY1NSwyMyArNjk3LDE1IEBAIGk5MTVfdm1hX2luc2VydChzdHJ1
Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncykKIAlH
RU1fQlVHX09OKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpOwogCUdFTV9CVUdf
T04oIWk5MTVfZ2VtX3ZhbGlkX2d0dF9zcGFjZSh2bWEsIGNhY2hlX2xldmVsKSk7CiAKLQltdXRl
eF9sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CiAJbGlzdF9hZGRfdGFpbCgmdm1hLT52bV9saW5rLCAm
dm1hLT52bS0+Ym91bmRfbGlzdCk7Ci0JbXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CiAK
IAlpZiAodm1hLT5vYmopIHsKKwkJYXRvbWljX2luYygmdm1hLT5vYmotPm1tLnBhZ2VzX3Bpbl9j
b3VudCk7CiAJCWF0b21pY19pbmMoJnZtYS0+b2JqLT5iaW5kX2NvdW50KTsKIAkJYXNzZXJ0X2Jp
bmRfY291bnQodm1hLT5vYmopOwogCX0KIAogCXJldHVybiAwOwotCi1lcnJfY2xlYXI6Ci0Jdm1h
LT5vcHMtPmNsZWFyX3BhZ2VzKHZtYSk7Ci1lcnJfdW5waW46Ci0JaWYgKHZtYS0+b2JqKQotCQlp
OTE1X2dlbV9vYmplY3RfdW5waW5fcGFnZXModm1hLT5vYmopOwotCXJldHVybiByZXQ7CiB9CiAK
IHN0YXRpYyB2b2lkCkBAIC02ODAsMTIgKzcxNCw3IEBAIGk5MTVfdm1hX3JlbW92ZShzdHJ1Y3Qg
aTkxNV92bWEgKnZtYSkKIAlHRU1fQlVHX09OKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+
bm9kZSkpOwogCUdFTV9CVUdfT04oaTkxNV92bWFfaXNfYm91bmQodm1hLCBJOTE1X1ZNQV9HTE9C
QUxfQklORCB8IEk5MTVfVk1BX0xPQ0FMX0JJTkQpKTsKIAotCXZtYS0+b3BzLT5jbGVhcl9wYWdl
cyh2bWEpOwotCi0JbXV0ZXhfbG9jaygmdm1hLT52bS0+bXV0ZXgpOwotCWRybV9tbV9yZW1vdmVf
bm9kZSgmdm1hLT5ub2RlKTsKIAlsaXN0X2RlbCgmdm1hLT52bV9saW5rKTsKLQltdXRleF91bmxv
Y2soJnZtYS0+dm0tPm11dGV4KTsKIAogCS8qCiAJICogU2luY2UgdGhlIHVuYm91bmQgbGlzdCBp
cyBnbG9iYWwsIG9ubHkgbW92ZSB0byB0aGF0IGxpc3QgaWYKQEAgLTcwNCw1MSArNzMzLDE5NCBA
QCBpOTE1X3ZtYV9yZW1vdmUoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJCWk5MTVfZ2VtX29iamVj
dF91bnBpbl9wYWdlcyhvYmopOwogCQlhc3NlcnRfYmluZF9jb3VudChvYmopOwogCX0KKworCWRy
bV9tbV9yZW1vdmVfbm9kZSgmdm1hLT5ub2RlKTsKIH0KIAotaW50IF9faTkxNV92bWFfZG9fcGlu
KHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAotCQkgICAgICB1NjQgc2l6ZSwgdTY0IGFsaWdubWVudCwg
dTY0IGZsYWdzKQorc3RhdGljIGJvb2wgdHJ5X2Zhc3RfcGluKHN0cnVjdCBpOTE1X3ZtYSAqdm1h
LCB1bnNpZ25lZCBpbnQgZmxhZ3MpCiB7Ci0JY29uc3QgdW5zaWduZWQgaW50IGJvdW5kID0gYXRv
bWljX3JlYWQoJnZtYS0+ZmxhZ3MpOwotCWludCByZXQ7CisJdW5zaWduZWQgaW50IGJvdW5kLCBw
aW47CisJYm9vbCBwaW5uZWQgPSB0cnVlOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm1hLT52
bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JR0VNX0JVR19PTigoZmxhZ3MgJiAoUElOX0dM
T0JBTCB8IFBJTl9VU0VSKSkgPT0gMCk7Ci0JR0VNX0JVR19PTigoZmxhZ3MgJiBQSU5fR0xPQkFM
KSAmJiAhaTkxNV92bWFfaXNfZ2d0dCh2bWEpKTsKKwlib3VuZCA9IGF0b21pY19yZWFkKCZ2bWEt
PmZsYWdzKTsKKwlkbyB7CisJCWlmICh1bmxpa2VseSgoKGJvdW5kIF4gZmxhZ3MpICYgSTkxNV9W
TUFfQklORF9NQVNLKSkpCisJCQlyZXR1cm4gZmFsc2U7CiAKLQlpZiAoV0FSTl9PTihib3VuZCAm
IEk5MTVfVk1BX1BJTl9PVkVSRkxPVykpIHsKLQkJcmV0ID0gLUVCVVNZOwotCQlnb3RvIGVycl91
bnBpbjsKKwkJaWYgKChib3VuZCAmIDB4ZmYpIDwgMSkKKwkJCWdvdG8gc2xvdzsKKworCQlwaW4g
PSBib3VuZCArIDE7CisJCWlmIChXQVJOX09OKHBpbiAmIEk5MTVfVk1BX1BJTl9PVkVSRkxPVykp
CisJCQlyZXR1cm4gZmFsc2U7CisJfSB3aGlsZSAoIWF0b21pY190cnlfY21weGNoZygmdm1hLT5m
bGFncywgJmJvdW5kLCBwaW4pKTsKKworCXJldHVybiB0cnVlOworCitzbG93OgorCS8qCisJICog
SWYgcGluX2NvdW50PT0wLCBidXQgd2UgYXJlIGJvdW5kLCBjaGVjayB1bmRlciB0aGUgbG9jayB0
byBhdm9pZAorCSAqIHJhY2luZyB3aXRoIGEgY29uY3VycmVudCBpOTE1X3ZtYV91bmJpbmQoKS4K
KwkgKi8KKwltdXRleF9sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CisJZG8geworCQlpZiAodW5saWtl
bHkoKChib3VuZCBeIGZsYWdzKSAmIEk5MTVfVk1BX0JJTkRfTUFTSykpKSB7CisJCQlwaW5uZWQg
PSBmYWxzZTsKKwkJCWJyZWFrOworCQl9CisKKwkJcGluID0gYm91bmQgKyAxOworCQlpZiAoV0FS
Tl9PTihwaW4gJiBJOTE1X1ZNQV9QSU5fT1ZFUkZMT1cpKSB7CisJCQlwaW5uZWQgPSBmYWxzZTsK
KwkJCWJyZWFrOworCQl9CisJfSB3aGlsZSAoIWF0b21pY190cnlfY21weGNoZygmdm1hLT5mbGFn
cywgJmJvdW5kLCBwaW4pKTsKKwltdXRleF91bmxvY2soJnZtYS0+dm0tPm11dGV4KTsKKworCXJl
dHVybiBwaW5uZWQ7Cit9CisKK3N0YXRpYyBpbnQgdm1hX2dldF9wYWdlcyhzdHJ1Y3QgaTkxNV92
bWEgKnZtYSkKK3sKKwlpbnQgZXJyID0gMDsKKworCWlmIChhdG9taWNfYWRkX3VubGVzcygmdm1h
LT5wYWdlc19jb3VudCwgMSwgMCkpCisJCXJldHVybiAwOworCisJaWYgKG11dGV4X2xvY2tfaW50
ZXJydXB0aWJsZSgmdm1hLT5wYWdlc19tdXRleCkpCisJCXJldHVybiAtRUlOVFI7CisKKwlpZiAo
IWF0b21pY19yZWFkKCZ2bWEtPnBhZ2VzX2NvdW50KSkgeworCQlpZiAodm1hLT5vYmopIHsKKwkJ
CWVyciA9IGk5MTVfZ2VtX29iamVjdF9waW5fcGFnZXModm1hLT5vYmopOworCQkJaWYgKGVycikK
KwkJCQlnb3RvIHVubG9jazsKKwkJfQorCisJCWVyciA9IHZtYS0+b3BzLT5zZXRfcGFnZXModm1h
KTsKKwkJaWYgKGVycikKKwkJCWdvdG8gdW5sb2NrOworCisJCXNtcF9tYl9fYmVmb3JlX2F0b21p
YygpOwogCX0KKwlhdG9taWNfaW5jKCZ2bWEtPnBhZ2VzX2NvdW50KTsKIAotCWlmICgoYm91bmQg
JiBJOTE1X1ZNQV9CSU5EX01BU0spID09IDApIHsKLQkJcmV0ID0gaTkxNV92bWFfaW5zZXJ0KHZt
YSwgc2l6ZSwgYWxpZ25tZW50LCBmbGFncyk7Ci0JCWlmIChyZXQpCi0JCQlnb3RvIGVycl91bnBp
bjsKK3VubG9jazoKKwltdXRleF91bmxvY2soJnZtYS0+cGFnZXNfbXV0ZXgpOworCisJcmV0dXJu
IGVycjsKK30KKworc3RhdGljIHZvaWQgX192bWFfcHV0X3BhZ2VzKHN0cnVjdCBpOTE1X3ZtYSAq
dm1hLCBpbnQgY291bnQpCit7CisJbXV0ZXhfbG9ja19uZXN0ZWQoJnZtYS0+cGFnZXNfbXV0ZXgs
IFNJTkdMRV9ERVBUSF9ORVNUSU5HKTsKKwlHRU1fQlVHX09OKGF0b21pY19yZWFkKCZ2bWEtPnBh
Z2VzX2NvdW50KSA8IGNvdW50KTsKKwlpZiAoYXRvbWljX3N1Yl9yZXR1cm4oY291bnQsICZ2bWEt
PnBhZ2VzX2NvdW50KSA9PSAwKSB7CisJCXZtYS0+b3BzLT5jbGVhcl9wYWdlcyh2bWEpOworCQlH
RU1fQlVHX09OKHZtYS0+cGFnZXMpOworCQlpZiAodm1hLT5vYmopCisJCQlpOTE1X2dlbV9vYmpl
Y3RfdW5waW5fcGFnZXModm1hLT5vYmopOwogCX0KLQlHRU1fQlVHX09OKCFkcm1fbW1fbm9kZV9h
bGxvY2F0ZWQoJnZtYS0+bm9kZSkpOworCW11dGV4X3VubG9jaygmdm1hLT5wYWdlc19tdXRleCk7
Cit9CiAKLQlyZXQgPSBpOTE1X3ZtYV9iaW5kKHZtYSwgdm1hLT5vYmogPyB2bWEtPm9iai0+Y2Fj
aGVfbGV2ZWwgOiAwLCBmbGFncyk7Ci0JaWYgKHJldCkKK3N0YXRpYyB2b2lkIHZtYV9wdXRfcGFn
ZXMoc3RydWN0IGk5MTVfdm1hICp2bWEpCit7CisJaWYgKGF0b21pY19hZGRfdW5sZXNzKCZ2bWEt
PnBhZ2VzX2NvdW50LCAtMSwgMSkpCisJCXJldHVybjsKKworCV9fdm1hX3B1dF9wYWdlcyh2bWEs
IDEpOworfQorCitzdGF0aWMgdm9pZCB2bWFfdW5iaW5kX3BhZ2VzKHN0cnVjdCBpOTE1X3ZtYSAq
dm1hKQoreworCXVuc2lnbmVkIGludCBjb3VudDsKKworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZt
YS0+dm0tPm11dGV4KTsKKworCWNvdW50ID0gYXRvbWljX3JlYWQoJnZtYS0+cGFnZXNfY291bnQp
OworCWNvdW50ID4+PSAxNjsKKwlHRU1fQlVHX09OKCFjb3VudCk7CisKKwlfX3ZtYV9wdXRfcGFn
ZXModm1hLCBjb3VudCB8IGNvdW50IDw8IDE2KTsKK30KKworaW50IGk5MTVfdm1hX3BpbihzdHJ1
Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncykKK3sK
KwlzdHJ1Y3QgaTkxNV92bWFfd29yayAqd29yayA9IE5VTEw7CisJaW50IGVycjsKKworCUJVSUxE
X0JVR19PTihQSU5fTUJaICE9IEk5MTVfVk1BX1BJTl9PVkVSRkxPVyk7CisJQlVJTERfQlVHX09O
KFBJTl9HTE9CQUwgIT0gSTkxNV9WTUFfR0xPQkFMX0JJTkQpOworCUJVSUxEX0JVR19PTihQSU5f
VVNFUiAhPSBJOTE1X1ZNQV9MT0NBTF9CSU5EKTsKKworCUdFTV9CVUdfT04oZmxhZ3MgJiBQSU5f
VVBEQVRFKTsKKwlHRU1fQlVHX09OKCEoZmxhZ3MgJiAoUElOX1VTRVIgfCBQSU5fR0xPQkFMKSkp
OworCisJR0VNX0JVR19PTihmbGFncyAmIEk5MTVfVk1BX1BJTl9PVkVSRkxPVyk7CisJR0VNX0JV
R19PTihmbGFncyAmIEk5MTVfVk1BX0VSUk9SKTsKKworCWlmICh0cnlfZmFzdF9waW4odm1hLCBm
bGFncykpCisJCXJldHVybiAwOworCisJZXJyID0gdm1hX2dldF9wYWdlcyh2bWEpOworCWlmIChl
cnIpCisJCXJldHVybiBlcnI7CisKKwlpZiAoZmxhZ3MgJiBQSU5fVVNFUikgeworCQl3b3JrID0g
aTkxNV92bWFfd29yaygpOworCQlpZiAoIXdvcmspIHsKKwkJCWVyciA9IC1FTk9NRU07CisJCQln
b3RvIGVycl9wYWdlczsKKwkJfQorCX0KKworCWVyciA9IGk5MTVfYWN0aXZlX2FjcXVpcmUoJnZt
YS0+YWN0aXZlKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl9mZW5jZTsKKworCWVyciA9IG11dGV4
X2xvY2tfaW50ZXJydXB0aWJsZSgmdm1hLT52bS0+bXV0ZXgpOworCWlmIChlcnIpCisJCWdvdG8g
ZXJyX2FjdGl2ZTsKKworCWlmICghaTkxNV92bWFfaXNfYm91bmQodm1hLCBJOTE1X1ZNQV9CSU5E
X01BU0spKSB7CisJCWVyciA9IGk5MTVfdm1hX2luc2VydCh2bWEsIHNpemUsIGFsaWdubWVudCwg
ZmxhZ3MpOworCQlpZiAoZXJyKQorCQkJZ290byBlcnJfdW5sb2NrOworCisJCWlmIChpOTE1X2lz
X2dndHQodm1hLT52bSkpCisJCQlfX2k5MTVfdm1hX3NldF9tYXBfYW5kX2ZlbmNlYWJsZSh2bWEp
OworCX0KKworCUdFTV9CVUdfT04oIXZtYS0+cGFnZXMpOworCWVyciA9IGk5MTVfdm1hX2JpbmQo
dm1hLAorCQkJICAgIHZtYS0+b2JqID8gdm1hLT5vYmotPmNhY2hlX2xldmVsIDogMCwKKwkJCSAg
ICBmbGFncywgd29yayk7CisJaWYgKGVycikKIAkJZ290byBlcnJfcmVtb3ZlOwogCiAJR0VNX0JV
R19PTighaTkxNV92bWFfaXNfYm91bmQodm1hLCBJOTE1X1ZNQV9CSU5EX01BU0spKTsKKwlHRU1f
QlVHX09OKGk5MTVfdm1hX21pc3BsYWNlZCh2bWEsIHNpemUsIGFsaWdubWVudCwgZmxhZ3MpKTsK
IAotCWlmICgoYm91bmQgXiBhdG9taWNfcmVhZCgmdm1hLT5mbGFncykpICYgSTkxNV9WTUFfR0xP
QkFMX0JJTkQpCi0JCV9faTkxNV92bWFfc2V0X21hcF9hbmRfZmVuY2VhYmxlKHZtYSk7CisJYXRv
bWljX2FkZChCSVQoMTYpIHwgMSwgJnZtYS0+cGFnZXNfY291bnQpOworCWxpc3RfbW92ZV90YWls
KCZ2bWEtPnZtX2xpbmssICZ2bWEtPnZtLT5ib3VuZF9saXN0KTsKKwlfX2k5MTVfdm1hX3Bpbih2
bWEpOwogCi0JR0VNX0JVR19PTihpOTE1X3ZtYV9taXNwbGFjZWQodm1hLCBzaXplLCBhbGlnbm1l
bnQsIGZsYWdzKSk7Ci0JcmV0dXJuIDA7CisJR0VNX0JVR19PTighaTkxNV92bWFfaXNfcGlubmVk
KHZtYSkpOwogCiBlcnJfcmVtb3ZlOgotCWlmICgoYm91bmQgJiBJOTE1X1ZNQV9CSU5EX01BU0sp
ID09IDApIHsKKwlpZiAoIWk5MTVfdm1hX2lzX2JvdW5kKHZtYSwgSTkxNV9WTUFfQklORF9NQVNL
KSkKIAkJaTkxNV92bWFfcmVtb3ZlKHZtYSk7Ci0JCUdFTV9CVUdfT04odm1hLT5wYWdlcyk7Ci0J
CUdFTV9CVUdfT04oYXRvbWljX3JlYWQoJnZtYS0+ZmxhZ3MpICYgSTkxNV9WTUFfQklORF9NQVNL
KTsKLQl9Ci1lcnJfdW5waW46Ci0JX19pOTE1X3ZtYV91bnBpbih2bWEpOwotCXJldHVybiByZXQ7
CitlcnJfdW5sb2NrOgorCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOworZXJyX2FjdGl2
ZToKKwlpOTE1X2FjdGl2ZV9yZWxlYXNlKCZ2bWEtPmFjdGl2ZSk7CitlcnJfZmVuY2U6CisJaWYg
KHdvcmspCisJCWRtYV9mZW5jZV93b3JrX2NvbW1pdCgmd29yay0+YmFzZSk7CitlcnJfcGFnZXM6
CisJdm1hX3B1dF9wYWdlcyh2bWEpOworCXJldHVybiBlcnI7CiB9CiAKIHZvaWQgaTkxNV92bWFf
Y2xvc2Uoc3RydWN0IGk5MTVfdm1hICp2bWEpCkBAIC03NzksOSArOTUxLDYgQEAgc3RhdGljIHZv
aWQgX19pOTE1X3ZtYV9yZW1vdmVfY2xvc2VkKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewogCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdm1hLT52bS0+aTkxNTsKIAotCWlmICghaTkx
NV92bWFfaXNfY2xvc2VkKHZtYSkpCi0JCXJldHVybjsKLQogCXNwaW5fbG9ja19pcnEoJmk5MTUt
Pmd0LmNsb3NlZF9sb2NrKTsKIAlsaXN0X2RlbF9pbml0KCZ2bWEtPmNsb3NlZF9saW5rKTsKIAlz
cGluX3VubG9ja19pcnEoJmk5MTUtPmd0LmNsb3NlZF9sb2NrKTsKQEAgLTc4OSw0MCArOTU4LDM1
IEBAIHN0YXRpYyB2b2lkIF9faTkxNV92bWFfcmVtb3ZlX2Nsb3NlZChzdHJ1Y3QgaTkxNV92bWEg
KnZtYSkKIAogdm9pZCBpOTE1X3ZtYV9yZW9wZW4oc3RydWN0IGk5MTVfdm1hICp2bWEpCiB7Ci0J
X19pOTE1X3ZtYV9yZW1vdmVfY2xvc2VkKHZtYSk7CisJaWYgKGk5MTVfdm1hX2lzX2Nsb3NlZCh2
bWEpKQorCQlfX2k5MTVfdm1hX3JlbW92ZV9jbG9zZWQodm1hKTsKIH0KIAotc3RhdGljIHZvaWQg
X19pOTE1X3ZtYV9kZXN0cm95KHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQordm9pZCBpOTE1X3ZtYV9k
ZXN0cm95KHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewotCUdFTV9CVUdfT04oZHJtX21tX25vZGVf
YWxsb2NhdGVkKCZ2bWEtPm5vZGUpKTsKLQlHRU1fQlVHX09OKHZtYS0+ZmVuY2UpOworCWlmIChk
cm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpIHsKKwkJbXV0ZXhfbG9jaygmdm1hLT52
bS0+bXV0ZXgpOworCQlhdG9taWNfYW5kKH5JOTE1X1ZNQV9QSU5fTUFTSywgJnZtYS0+ZmxhZ3Mp
OworCQlXQVJOX09OKGk5MTVfdm1hX3VuYmluZCh2bWEpKTsKKwkJbXV0ZXhfdW5sb2NrKCZ2bWEt
PnZtLT5tdXRleCk7CisJCUdFTV9CVUdfT04oZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5v
ZGUpKTsKKwl9CisJR0VNX0JVR19PTihpOTE1X3ZtYV9pc19hY3RpdmUodm1hKSk7CiAKIAlpZiAo
dm1hLT5vYmopIHsKIAkJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IHZtYS0+b2Jq
OwogCiAJCXNwaW5fbG9jaygmb2JqLT52bWEubG9jayk7CiAJCWxpc3RfZGVsKCZ2bWEtPm9ial9s
aW5rKTsKLQkJcmJfZXJhc2UoJnZtYS0+b2JqX25vZGUsICZ2bWEtPm9iai0+dm1hLnRyZWUpOwor
CQlyYl9lcmFzZSgmdm1hLT5vYmpfbm9kZSwgJm9iai0+dm1hLnRyZWUpOwogCQlzcGluX3VubG9j
aygmb2JqLT52bWEubG9jayk7CiAJfQogCi0JaTkxNV9hY3RpdmVfZmluaSgmdm1hLT5hY3RpdmUp
OwotCi0JaTkxNV92bWFfZnJlZSh2bWEpOwotfQotCi12b2lkIGk5MTVfdm1hX2Rlc3Ryb3koc3Ry
dWN0IGk5MTVfdm1hICp2bWEpCi17Ci0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm1hLT52bS0+aTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQlHRU1fQlVHX09OKGk5MTVfdm1hX2lzX3Bpbm5lZCh2
bWEpKTsKLQogCV9faTkxNV92bWFfcmVtb3ZlX2Nsb3NlZCh2bWEpOworCWk5MTVfdm1fcHV0KHZt
YS0+dm0pOwogCi0JV0FSTl9PTihpOTE1X3ZtYV91bmJpbmQodm1hKSk7Ci0JR0VNX0JVR19PTihp
OTE1X3ZtYV9pc19hY3RpdmUodm1hKSk7Ci0KLQlfX2k5MTVfdm1hX2Rlc3Ryb3kodm1hKTsKKwlp
OTE1X2FjdGl2ZV9maW5pKCZ2bWEtPmFjdGl2ZSk7CisJaTkxNV92bWFfZnJlZSh2bWEpOwogfQog
CiB2b2lkIGk5MTVfdm1hX3BhcmtlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKQEAg
LTgzMSwxMiArOTk1LDMyIEBAIHZvaWQgaTkxNV92bWFfcGFya2VkKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQogCiAJc3Bpbl9sb2NrX2lycSgmaTkxNS0+Z3QuY2xvc2VkX2xvY2spOwog
CWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZSh2bWEsIG5leHQsICZpOTE1LT5ndC5jbG9zZWRfdm1h
LCBjbG9zZWRfbGluaykgewotCQlsaXN0X2RlbF9pbml0KCZ2bWEtPmNsb3NlZF9saW5rKTsKKwkJ
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IHZtYS0+b2JqOworCQlzdHJ1Y3QgaTkx
NV9hZGRyZXNzX3NwYWNlICp2bSA9IHZtYS0+dm07CisKKwkJLyogWFhYIEFsbCB0byBhdm9pZCBr
ZWVwaW5nIGEgcmVmZXJlbmNlIG9uIGk5MTVfdm1hIGl0c2VsZiAqLworCisJCWlmICgha3JlZl9n
ZXRfdW5sZXNzX3plcm8oJm9iai0+YmFzZS5yZWZjb3VudCkpCisJCQljb250aW51ZTsKKworCQlp
ZiAoIWk5MTVfdm1fdHJ5b3Blbih2bSkpIHsKKwkJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsK
KwkJCW9iaiA9IE5VTEw7CisJCX0KKwogCQlzcGluX3VubG9ja19pcnEoJmk5MTUtPmd0LmNsb3Nl
ZF9sb2NrKTsKIAotCQlpOTE1X3ZtYV9kZXN0cm95KHZtYSk7CisJCWlmIChvYmopIHsKKwkJCWk5
MTVfdm1hX2Rlc3Ryb3kodm1hKTsKKwkJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwkJfQor
CisJCWk5MTVfdm1fY2xvc2Uodm0pOwogCisJCS8qIFJlc3RhcnQgYWZ0ZXIgZHJvcHBpbmcgbG9j
ayAqLwogCQlzcGluX2xvY2tfaXJxKCZpOTE1LT5ndC5jbG9zZWRfbG9jayk7CisJCW5leHQgPSBs
aXN0X2ZpcnN0X2VudHJ5KCZpOTE1LT5ndC5jbG9zZWRfdm1hLAorCQkJCQl0eXBlb2YoKm5leHQp
LCBjbG9zZWRfbGluayk7CiAJfQogCXNwaW5fdW5sb2NrX2lycSgmaTkxNS0+Z3QuY2xvc2VkX2xv
Y2spOwogfQpAQCAtODg3LDYgKzEwNzEsMjAgQEAgaW50IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZl
KHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCWFzc2VydF9vYmplY3RfaGVsZChvYmopOwogCUdFTV9C
VUdfT04oIWRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5ub2RlKSk7CiAKKwlpZiAocmN1X2Fj
Y2Vzc19wb2ludGVyKHZtYS0+YWN0aXZlLmV4Y2wpKSB7CisJCXN0cnVjdCBkbWFfZmVuY2UgKmZl
bmNlOworCisJCXJjdV9yZWFkX2xvY2soKTsKKwkJZmVuY2UgPSBkbWFfZmVuY2VfZ2V0X3JjdV9z
YWZlKCZ2bWEtPmFjdGl2ZS5leGNsKTsKKwkJcmN1X3JlYWRfdW5sb2NrKCk7CisJCWlmIChmZW5j
ZSkgeworCQkJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X2RtYV9mZW5jZShycSwgZmVuY2UpOwor
CQkJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CisJCQlpZiAodW5saWtlbHkoZXJyKSkKKwkJCQlyZXR1
cm4gZXJyOworCQl9CisJfQorCiAJLyoKIAkgKiBBZGQgYSByZWZlcmVuY2UgaWYgd2UncmUgbmV3
bHkgZW50ZXJpbmcgdGhlIGFjdGl2ZSBsaXN0LgogCSAqIFRoZSBvcmRlciBpbiB3aGljaCB3ZSBh
ZGQgb3BlcmF0aW9ucyB0byB0aGUgcmV0aXJlbWVudCBxdWV1ZSBpcwpAQCAtOTI3LDM0ICsxMTI1
LDE1IEBAIGludCBpOTE1X3ZtYV91bmJpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEpCiB7CiAJaW50
IHJldDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0tPmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0tPm11dGV4KTsKIAogCS8qCiAJ
ICogRmlyc3Qgd2FpdCB1cG9uIGFueSBhY3Rpdml0eSBhcyByZXRpcmluZyB0aGUgcmVxdWVzdCBt
YXkKIAkgKiBoYXZlIHNpZGUtZWZmZWN0cyBzdWNoIGFzIHVucGlubmluZyBvciBldmVuIHVuYmlu
ZGluZyB0aGlzIHZtYS4KIAkgKi8KLQltaWdodF9zbGVlcCgpOwotCWlmIChpOTE1X3ZtYV9pc19h
Y3RpdmUodm1hKSkgewotCQkvKgotCQkgKiBXaGVuIGEgY2xvc2VkIFZNQSBpcyByZXRpcmVkLCBp
dCBpcyB1bmJvdW5kIC0gZWVrLgotCQkgKiBJbiBvcmRlciB0byBwcmV2ZW50IGl0IGZyb20gYmVp
bmcgcmVjdXJzaXZlbHkgY2xvc2VkLAotCQkgKiB0YWtlIGEgcGluIG9uIHRoZSB2bWEgc28gdGhh
dCB0aGUgc2Vjb25kIHVuYmluZCBpcwotCQkgKiBhYm9ydGVkLgotCQkgKgotCQkgKiBFdmVuIG1v
cmUgc2NhcnkgaXMgdGhhdCB0aGUgcmV0aXJlIGNhbGxiYWNrIG1heSBmcmVlCi0JCSAqIHRoZSBv
YmplY3QgKGxhc3QgYWN0aXZlIHZtYSkuIFRvIHByZXZlbnQgdGhlIGV4cGxvc2lvbgotCQkgKiB3
ZSBkZWZlciB0aGUgYWN0dWFsIG9iamVjdCBmcmVlIHRvIGEgd29ya2VyIHRoYXQgY2FuCi0JCSAq
IG9ubHkgcHJvY2VlZCBvbmNlIGl0IGFjcXVpcmVzIHRoZSBzdHJ1Y3RfbXV0ZXggKHdoaWNoCi0J
CSAqIHdlIGN1cnJlbnRseSBob2xkLCB0aGVyZWZvcmUgaXQgY2Fubm90IGZyZWUgdGhpcyBvYmpl
Y3QKLQkJICogYmVmb3JlIHdlIGFyZSBmaW5pc2hlZCkuCi0JCSAqLwotCQlfX2k5MTVfdm1hX3Bp
bih2bWEpOwotCQlyZXQgPSBpOTE1X2FjdGl2ZV93YWl0KCZ2bWEtPmFjdGl2ZSk7Ci0JCV9faTkx
NV92bWFfdW5waW4odm1hKTsKLQkJaWYgKHJldCkKLQkJCXJldHVybiByZXQ7Ci0JfQotCUdFTV9C
VUdfT04oaTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpOworCXJldCA9IGk5MTVfYWN0aXZlX3dhaXQo
JnZtYS0+YWN0aXZlKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OwogCiAJaWYgKGk5MTVfdm1h
X2lzX3Bpbm5lZCh2bWEpKSB7CiAJCXZtYV9wcmludF9hbGxvY2F0b3Iodm1hLCAiaXMgcGlubmVk
Iik7CkBAIC05NzUsMTYgKzExNTQsMTIgQEAgaW50IGk5MTVfdm1hX3VuYmluZChzdHJ1Y3QgaTkx
NV92bWEgKnZtYSkKIAkJR0VNX0JVR19PTihpOTE1X3ZtYV9oYXNfZ2d0dF93cml0ZSh2bWEpKTsK
IAogCQkvKiByZWxlYXNlIHRoZSBmZW5jZSByZWcgX2FmdGVyXyBmbHVzaGluZyAqLwotCQltdXRl
eF9sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CiAJCXJldCA9IGk5MTVfdm1hX3Jldm9rZV9mZW5jZSh2
bWEpOwotCQltdXRleF91bmxvY2soJnZtYS0+dm0tPm11dGV4KTsKIAkJaWYgKHJldCkKIAkJCXJl
dHVybiByZXQ7CiAKIAkJLyogRm9yY2UgYSBwYWdlZmF1bHQgZm9yIGRvbWFpbiB0cmFja2luZyBv
biBuZXh0IHVzZXIgYWNjZXNzICovCi0JCW11dGV4X2xvY2soJnZtYS0+dm0tPm11dGV4KTsKIAkJ
aTkxNV92bWFfcmV2b2tlX21tYXAodm1hKTsKLQkJbXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRl
eCk7CiAKIAkJX19pOTE1X3ZtYV9pb3VubWFwKHZtYSk7CiAJCWNsZWFyX2JpdChJOTE1X1ZNQV9D
QU5fRkVOQ0VfQklULCBfX2k5MTVfdm1hX2ZsYWdzKHZtYSkpOwpAQCAtOTkyLDEyICsxMTY3LDEz
IEBAIGludCBpOTE1X3ZtYV91bmJpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJR0VNX0JVR19P
Tih2bWEtPmZlbmNlKTsKIAlHRU1fQlVHX09OKGk5MTVfdm1hX2hhc191c2VyZmF1bHQodm1hKSk7
CiAKLQlpZiAobGlrZWx5KCF2bWEtPnZtLT5jbG9zZWQpKSB7CisJaWYgKGxpa2VseShhdG9taWNf
cmVhZCgmdm1hLT52bS0+b3BlbikpKSB7CiAJCXRyYWNlX2k5MTVfdm1hX3VuYmluZCh2bWEpOwog
CQl2bWEtPm9wcy0+dW5iaW5kX3ZtYSh2bWEpOwogCX0KIAlhdG9taWNfYW5kKH5JOTE1X1ZNQV9C
SU5EX01BU0ssICZ2bWEtPmZsYWdzKTsKIAorCXZtYV91bmJpbmRfcGFnZXModm1hKTsKIAlpOTE1
X3ZtYV9yZW1vdmUodm1hKTsKIAogCXJldHVybiAwOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV92bWEuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmgKaW5k
ZXggMDJkN2Q4MTU0MDdjLi41N2UzZWMxMTNhNjEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfdm1hLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaApA
QCAtMTAzLDE4ICsxMDMsMjQgQEAgc3RydWN0IGk5MTVfdm1hIHsKIAkvKiogRmxhZ3MgYW5kIGFk
ZHJlc3Mgc3BhY2UgdGhpcyBWTUEgaXMgYm91bmQgdG8gKi8KICNkZWZpbmUgSTkxNV9WTUFfR0xP
QkFMX0JJTkRfQklUIDkKICNkZWZpbmUgSTkxNV9WTUFfTE9DQUxfQklORF9CSVQgMTAKKyNkZWZp
bmUgSTkxNV9WTUFfRVJST1JfQklUCTExCiAKICNkZWZpbmUgSTkxNV9WTUFfR0xPQkFMX0JJTkQJ
KChpbnQpQklUKEk5MTVfVk1BX0dMT0JBTF9CSU5EX0JJVCkpCiAjZGVmaW5lIEk5MTVfVk1BX0xP
Q0FMX0JJTkQJKChpbnQpQklUKEk5MTVfVk1BX0xPQ0FMX0JJTkRfQklUKSkKKyNkZWZpbmUgSTkx
NV9WTUFfRVJST1IJCSgoaW50KUJJVChJOTE1X1ZNQV9FUlJPUl9CSVQpKQogCiAjZGVmaW5lIEk5
MTVfVk1BX0JJTkRfTUFTSyAoSTkxNV9WTUFfR0xPQkFMX0JJTkQgfCBcCiAJCQkgICAgSTkxNV9W
TUFfTE9DQUxfQklORCB8IFwKKwkJCSAgICBJOTE1X1ZNQV9FUlJPUiB8IFwKIAkJCSAgICBJOTE1
X1ZNQV9QSU5fT1ZFUkZMT1cpCiAKLSNkZWZpbmUgSTkxNV9WTUFfR0dUVF9CSVQJMTEKLSNkZWZp
bmUgSTkxNV9WTUFfQ0FOX0ZFTkNFX0JJVAkxMgotI2RlZmluZSBJOTE1X1ZNQV9VU0VSRkFVTFRf
QklUCTEzCi0jZGVmaW5lIEk5MTVfVk1BX0dHVFRfV1JJVEVfQklUCTE0CisjZGVmaW5lIEk5MTVf
Vk1BX0FMTE9DX0JJVAkxMgorI2RlZmluZSBJOTE1X1ZNQV9BTExPQwkJKChpbnQpQklUKEk5MTVf
Vk1BX0FMTE9DX0JJVCkpCisKKyNkZWZpbmUgSTkxNV9WTUFfR0dUVF9CSVQJMTMKKyNkZWZpbmUg
STkxNV9WTUFfQ0FOX0ZFTkNFX0JJVAkxNAorI2RlZmluZSBJOTE1X1ZNQV9VU0VSRkFVTFRfQklU
CTE1CisjZGVmaW5lIEk5MTVfVk1BX0dHVFRfV1JJVEVfQklUCTE2CiAKICNkZWZpbmUgSTkxNV9W
TUFfR0dUVAkJKChpbnQpQklUKEk5MTVfVk1BX0dHVFRfQklUKSkKICNkZWZpbmUgSTkxNV9WTUFf
Q0FOX0ZFTkNFCSgoaW50KUJJVChJOTE1X1ZNQV9DQU5fRkVOQ0VfQklUKSkKQEAgLTEyMyw2ICsx
MjksOSBAQCBzdHJ1Y3QgaTkxNV92bWEgewogCiAJc3RydWN0IGk5MTVfYWN0aXZlIGFjdGl2ZTsK
IAorCWF0b21pY190IHBhZ2VzX2NvdW50OyAvKiBudW1iZXIgb2YgYWN0aXZlIGJpbmRzIHRvIHRo
ZSBwYWdlcyAqLworCXN0cnVjdCBtdXRleCBwYWdlc19tdXRleDsgLyogcHJvdGVjdCBhY3F1aXJl
L3JlbGVhc2Ugb2YgYmFja2luZyBwYWdlcyAqLworCiAJLyoqCiAJICogU3VwcG9ydCBkaWZmZXJl
bnQgR0dUVCB2aWV3cyBpbnRvIHRoZSBzYW1lIG9iamVjdC4KIAkgKiBUaGlzIG1lYW5zIHRoZXJl
IGNhbiBiZSBtdWx0aXBsZSBWTUEgbWFwcGluZ3MgcGVyIG9iamVjdCBhbmQgcGVyIFZNLgpAQCAt
MzA4LDggKzMxNywxMiBAQCBpOTE1X3ZtYV9jb21wYXJlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAog
CXJldHVybiBtZW1jbXAoJnZtYS0+Z2d0dF92aWV3LnBhcnRpYWwsICZ2aWV3LT5wYXJ0aWFsLCB2
aWV3LT50eXBlKTsKIH0KIAotaW50IGk5MTVfdm1hX2JpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEs
IGVudW0gaTkxNV9jYWNoZV9sZXZlbCBjYWNoZV9sZXZlbCwKLQkJICB1MzIgZmxhZ3MpOworc3Ry
dWN0IGk5MTVfdm1hX3dvcmsgKmk5MTVfdm1hX3dvcmsodm9pZCk7CitpbnQgaTkxNV92bWFfYmlu
ZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKKwkJICBlbnVtIGk5MTVfY2FjaGVfbGV2ZWwgY2FjaGVf
bGV2ZWwsCisJCSAgdTMyIGZsYWdzLAorCQkgIHN0cnVjdCBpOTE1X3ZtYV93b3JrICp3b3JrKTsK
KwogYm9vbCBpOTE1X2dlbV92YWxpZF9ndHRfc3BhY2Uoc3RydWN0IGk5MTVfdm1hICp2bWEsIHVu
c2lnbmVkIGxvbmcgY2FjaGVfbGV2ZWwpOwogYm9vbCBpOTE1X3ZtYV9taXNwbGFjZWQoY29uc3Qg
c3RydWN0IGk5MTVfdm1hICp2bWEsCiAJCQl1NjQgc2l6ZSwgdTY0IGFsaWdubWVudCwgdTY0IGZs
YWdzKTsKQEAgLTMzMywyNiArMzQ2LDggQEAgc3RhdGljIGlubGluZSB2b2lkIGk5MTVfdm1hX3Vu
bG9jayhzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAlkbWFfcmVzdl91bmxvY2sodm1hLT5yZXN2KTsK
IH0KIAotaW50IF9faTkxNV92bWFfZG9fcGluKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAotCQkgICAg
ICB1NjQgc2l6ZSwgdTY0IGFsaWdubWVudCwgdTY0IGZsYWdzKTsKLXN0YXRpYyBpbmxpbmUgaW50
IF9fbXVzdF9jaGVjawotaTkxNV92bWFfcGluKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1NjQgc2l6
ZSwgdTY0IGFsaWdubWVudCwgdTY0IGZsYWdzKQotewotCUJVSUxEX0JVR19PTihQSU5fTUJaICE9
IEk5MTVfVk1BX1BJTl9PVkVSRkxPVyk7Ci0JQlVJTERfQlVHX09OKFBJTl9HTE9CQUwgIT0gSTkx
NV9WTUFfR0xPQkFMX0JJTkQpOwotCUJVSUxEX0JVR19PTihQSU5fVVNFUiAhPSBJOTE1X1ZNQV9M
T0NBTF9CSU5EKTsKLQotCS8qIFBpbiBlYXJseSB0byBwcmV2ZW50IHRoZSBzaHJpbmtlci9ldmlj
dGlvbiBsb2dpYyBmcm9tIGRlc3Ryb3lpbmcKLQkgKiBvdXIgdm1hIGFzIHdlIGluc2VydCBhbmQg
YmluZC4KLQkgKi8KLQlpZiAobGlrZWx5KCgoYXRvbWljX2luY19yZXR1cm4oJnZtYS0+ZmxhZ3Mp
IF4gZmxhZ3MpICYgSTkxNV9WTUFfQklORF9NQVNLKSA9PSAwKSkgewotCQlHRU1fQlVHX09OKCFk
cm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpOwotCQlHRU1fQlVHX09OKGk5MTVfdm1h
X21pc3BsYWNlZCh2bWEsIHNpemUsIGFsaWdubWVudCwgZmxhZ3MpKTsKLQkJcmV0dXJuIDA7Ci0J
fQotCi0JcmV0dXJuIF9faTkxNV92bWFfZG9fcGluKHZtYSwgc2l6ZSwgYWxpZ25tZW50LCBmbGFn
cyk7Ci19CitpbnQgX19tdXN0X2NoZWNrCitpOTE1X3ZtYV9waW4oc3RydWN0IGk5MTVfdm1hICp2
bWEsIHU2NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3MpOwogCiBzdGF0aWMgaW5saW5l
IGludCBpOTE1X3ZtYV9waW5fY291bnQoY29uc3Qgc3RydWN0IGk5MTVfdm1hICp2bWEpCiB7CkBA
IC0zOTcsOCArMzkyLDYgQEAgc3RhdGljIGlubGluZSBib29sIGk5MTVfdm1hX2lzX2JvdW5kKGNv
bnN0IHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogICogdGhlIGNhbGxlciBtdXN0IGNhbGwgaTkxNV92
bWFfdW5waW5faW9tYXAgdG8gcmVsaW5xdWlzaCB0aGUgcGlubmluZwogICogYWZ0ZXIgdGhlIGlv
bWFwcGluZyBpcyBubyBsb25nZXIgcmVxdWlyZWQuCiAgKgotICogQ2FsbGVycyBtdXN0IGhvbGQg
dGhlIHN0cnVjdF9tdXRleC4KLSAqCiAgKiBSZXR1cm5zIGEgdmFsaWQgaW9tYXBwZWQgcG9pbnRl
ciBvciBFUlJfUFRSLgogICovCiB2b2lkIF9faW9tZW0gKmk5MTVfdm1hX3Bpbl9pb21hcChzdHJ1
Y3QgaTkxNV92bWEgKnZtYSk7CkBAIC00MTAsOCArNDAzLDggQEAgdm9pZCBfX2lvbWVtICppOTE1
X3ZtYV9waW5faW9tYXAoc3RydWN0IGk5MTVfdm1hICp2bWEpOwogICoKICAqIFVucGlucyB0aGUg
cHJldmlvdXNseSBpb21hcHBlZCBWTUEgZnJvbSBpOTE1X3ZtYV9waW5faW9tYXAoKS4KICAqCi0g
KiBDYWxsZXJzIG11c3QgaG9sZCB0aGUgc3RydWN0X211dGV4LiBUaGlzIGZ1bmN0aW9uIGlzIG9u
bHkgdmFsaWQgdG8gYmUKLSAqIGNhbGxlZCBvbiBhIFZNQSBwcmV2aW91c2x5IGlvbWFwcGVkIGJ5
IHRoZSBjYWxsZXIgd2l0aCBpOTE1X3ZtYV9waW5faW9tYXAoKS4KKyAqIFRoaXMgZnVuY3Rpb24g
aXMgb25seSB2YWxpZCB0byBiZSBjYWxsZWQgb24gYSBWTUEgcHJldmlvdXNseQorICogaW9tYXBw
ZWQgYnkgdGhlIGNhbGxlciB3aXRoIGk5MTVfdm1hX3Bpbl9pb21hcCgpLgogICovCiB2b2lkIGk5
MTVfdm1hX3VucGluX2lvbWFwKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKTsKIApAQCAtNDM5LDYgKzQz
Miw4IEBAIHN0YXRpYyBpbmxpbmUgc3RydWN0IHBhZ2UgKmk5MTVfdm1hX2ZpcnN0X3BhZ2Uoc3Ry
dWN0IGk5MTVfdm1hICp2bWEpCiBpbnQgX19tdXN0X2NoZWNrIGk5MTVfdm1hX3Bpbl9mZW5jZShz
dHJ1Y3QgaTkxNV92bWEgKnZtYSk7CiBpbnQgX19tdXN0X2NoZWNrIGk5MTVfdm1hX3Jldm9rZV9m
ZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7CiAKK2ludCBfX2k5MTVfdm1hX3Bpbl9mZW5jZShz
dHJ1Y3QgaTkxNV92bWEgKnZtYSk7CisKIHN0YXRpYyBpbmxpbmUgdm9pZCBfX2k5MTVfdm1hX3Vu
cGluX2ZlbmNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewogCUdFTV9CVUdfT04oYXRvbWljX3Jl
YWQoJnZtYS0+ZmVuY2UtPnBpbl9jb3VudCkgPD0gMCk7CkBAIC00NTYsNyArNDUxLDYgQEAgc3Rh
dGljIGlubGluZSB2b2lkIF9faTkxNV92bWFfdW5waW5fZmVuY2Uoc3RydWN0IGk5MTVfdm1hICp2
bWEpCiBzdGF0aWMgaW5saW5lIHZvaWQKIGk5MTVfdm1hX3VucGluX2ZlbmNlKHN0cnVjdCBpOTE1
X3ZtYSAqdm1hKQogewotCS8qIGxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0tPmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOyAqLwogCWlmICh2bWEtPmZlbmNlKQogCQlfX2k5MTVfdm1hX3VucGlu
X2ZlbmNlKHZtYSk7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaTkxNV9nZW1fZXZpY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1
X2dlbV9ldmljdC5jCmluZGV4IGNiMzBjNjY5YjFiNy4uYmE2MDY0MTQ3MTczIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYwpAQCAtMTA2LDE0
ICsxMDYsMTEgQEAgc3RhdGljIGludCBwb3B1bGF0ZV9nZ3R0KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAogCiBzdGF0aWMgdm9pZCB1bnBpbl9nZ3R0KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQogewotCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSAmaTkxNS0+Z2d0dDsKIAlz
dHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAotCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAls
aXN0X2Zvcl9lYWNoX2VudHJ5KHZtYSwgJmk5MTUtPmdndHQudm0uYm91bmRfbGlzdCwgdm1fbGlu
aykKIAkJaWYgKHZtYS0+b2JqLT5tbS5xdWlya2VkKQogCQkJaTkxNV92bWFfdW5waW4odm1hKTsK
LQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIH0KIAogc3RhdGljIHZvaWQgY2xlYW51
cF9vYmplY3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LApAQCAtMTI3LDExICsxMjQs
NyBAQCBzdGF0aWMgdm9pZCBjbGVhbnVwX29iamVjdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsCiAJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKIAl9CiAKLQltdXRleF91bmxvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0
cyhpOTE1KTsKLQotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogfQogCiBz
dGF0aWMgaW50IGlndF9ldmljdF9zb21ldGhpbmcodm9pZCAqYXJnKQpAQCAtMTQ4LDEwICsxNDEs
MTIgQEAgc3RhdGljIGludCBpZ3RfZXZpY3Rfc29tZXRoaW5nKHZvaWQgKmFyZykKIAkJZ290byBj
bGVhbnVwOwogCiAJLyogRXZlcnl0aGluZyBpcyBwaW5uZWQsIG5vdGhpbmcgc2hvdWxkIGhhcHBl
biAqLworCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAllcnIgPSBpOTE1X2dlbV9ldmlj
dF9zb21ldGhpbmcoJmdndHQtPnZtLAogCQkJCSAgICAgICBJOTE1X0dUVF9QQUdFX1NJWkUsIDAs
IDAsCiAJCQkJICAgICAgIDAsIFU2NF9NQVgsCiAJCQkJICAgICAgIDApOworCW11dGV4X3VubG9j
aygmZ2d0dC0+dm0ubXV0ZXgpOwogCWlmIChlcnIgIT0gLUVOT1NQQykgewogCQlwcl9lcnIoImk5
MTVfZ2VtX2V2aWN0X3NvbWV0aGluZyBmYWlsZWQgb24gYSBmdWxsIEdHVFQgd2l0aCBlcnI9JWRc
biIsCiAJCSAgICAgICBlcnIpOwpAQCAtMTYxLDEwICsxNTYsMTIgQEAgc3RhdGljIGludCBpZ3Rf
ZXZpY3Rfc29tZXRoaW5nKHZvaWQgKmFyZykKIAl1bnBpbl9nZ3R0KGk5MTUpOwogCiAJLyogRXZl
cnl0aGluZyBpcyB1bnBpbm5lZCwgd2Ugc2hvdWxkIGJlIGFibGUgdG8gZXZpY3Qgc29tZXRoaW5n
ICovCisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWVyciA9IGk5MTVfZ2VtX2V2aWN0
X3NvbWV0aGluZygmZ2d0dC0+dm0sCiAJCQkJICAgICAgIEk5MTVfR1RUX1BBR0VfU0laRSwgMCwg
MCwKIAkJCQkgICAgICAgMCwgVTY0X01BWCwKIAkJCQkgICAgICAgMCk7CisJbXV0ZXhfdW5sb2Nr
KCZnZ3R0LT52bS5tdXRleCk7CiAJaWYgKGVycikgewogCQlwcl9lcnIoImk5MTVfZ2VtX2V2aWN0
X3NvbWV0aGluZyBmYWlsZWQgb24gYSBmdWxsIEdHVFQgd2l0aCBlcnI9JWRcbiIsCiAJCSAgICAg
ICBlcnIpOwpAQCAtMjMwLDcgKzIyNyw5IEBAIHN0YXRpYyBpbnQgaWd0X2V2aWN0X2Zvcl92bWEo
dm9pZCAqYXJnKQogCQlnb3RvIGNsZWFudXA7CiAKIAkvKiBFdmVyeXRoaW5nIGlzIHBpbm5lZCwg
bm90aGluZyBzaG91bGQgaGFwcGVuICovCisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwog
CWVyciA9IGk5MTVfZ2VtX2V2aWN0X2Zvcl9ub2RlKCZnZ3R0LT52bSwgJnRhcmdldCwgMCk7CisJ
bXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJaWYgKGVyciAhPSAtRU5PU1BDKSB7CiAJ
CXByX2VycigiaTkxNV9nZW1fZXZpY3RfZm9yX25vZGUgb24gYSBmdWxsIEdHVFQgcmV0dXJuZWQg
ZXJyPSVkXG4iLAogCQkgICAgICAgZXJyKTsKQEAgLTI0MCw3ICsyMzksOSBAQCBzdGF0aWMgaW50
IGlndF9ldmljdF9mb3Jfdm1hKHZvaWQgKmFyZykKIAl1bnBpbl9nZ3R0KGk5MTUpOwogCiAJLyog
RXZlcnl0aGluZyBpcyB1bnBpbm5lZCwgd2Ugc2hvdWxkIGJlIGFibGUgdG8gZXZpY3QgdGhlIG5v
ZGUgKi8KKwltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJZXJyID0gaTkxNV9nZW1fZXZp
Y3RfZm9yX25vZGUoJmdndHQtPnZtLCAmdGFyZ2V0LCAwKTsKKwltdXRleF91bmxvY2soJmdndHQt
PnZtLm11dGV4KTsKIAlpZiAoZXJyKSB7CiAJCXByX2VycigiaTkxNV9nZW1fZXZpY3RfZm9yX25v
ZGUgcmV0dXJuZWQgZXJyPSVkXG4iLAogCQkgICAgICAgZXJyKTsKQEAgLTMxNyw3ICszMTgsOSBA
QCBzdGF0aWMgaW50IGlndF9ldmljdF9mb3JfY2FjaGVfY29sb3Iodm9pZCAqYXJnKQogCWk5MTVf
dm1hX3VucGluKHZtYSk7CiAKIAkvKiBSZW1vdmUganVzdCB0aGUgc2Vjb25kIHZtYSAqLworCW11
dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAllcnIgPSBpOTE1X2dlbV9ldmljdF9mb3Jfbm9k
ZSgmZ2d0dC0+dm0sICZ0YXJnZXQsIDApOworCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgp
OwogCWlmIChlcnIpIHsKIAkJcHJfZXJyKCJbMF1pOTE1X2dlbV9ldmljdF9mb3Jfbm9kZSByZXR1
cm5lZCBlcnI9JWRcbiIsIGVycik7CiAJCWdvdG8gY2xlYW51cDsKQEAgLTMyOCw3ICszMzEsOSBA
QCBzdGF0aWMgaW50IGlndF9ldmljdF9mb3JfY2FjaGVfY29sb3Iodm9pZCAqYXJnKQogCSAqLwog
CXRhcmdldC5jb2xvciA9IEk5MTVfQ0FDSEVfTDNfTExDOwogCisJbXV0ZXhfbG9jaygmZ2d0dC0+
dm0ubXV0ZXgpOwogCWVyciA9IGk5MTVfZ2VtX2V2aWN0X2Zvcl9ub2RlKCZnZ3R0LT52bSwgJnRh
cmdldCwgMCk7CisJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJaWYgKCFlcnIpIHsK
IAkJcHJfZXJyKCJbMV1pOTE1X2dlbV9ldmljdF9mb3Jfbm9kZSByZXR1cm5lZCBlcnI9JWRcbiIs
IGVycik7CiAJCWVyciA9IC1FSU5WQUw7CkBAIC0zNTgsNyArMzYzLDkgQEAgc3RhdGljIGludCBp
Z3RfZXZpY3Rfdm0odm9pZCAqYXJnKQogCQlnb3RvIGNsZWFudXA7CiAKIAkvKiBFdmVyeXRoaW5n
IGlzIHBpbm5lZCwgbm90aGluZyBzaG91bGQgaGFwcGVuICovCisJbXV0ZXhfbG9jaygmZ2d0dC0+
dm0ubXV0ZXgpOwogCWVyciA9IGk5MTVfZ2VtX2V2aWN0X3ZtKCZnZ3R0LT52bSk7CisJbXV0ZXhf
dW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJaWYgKGVycikgewogCQlwcl9lcnIoImk5MTVfZ2Vt
X2V2aWN0X3ZtIG9uIGEgZnVsbCBHR1RUIHJldHVybmVkIGVycj0lZF1cbiIsCiAJCSAgICAgICBl
cnIpOwpAQCAtMzY3LDcgKzM3NCw5IEBAIHN0YXRpYyBpbnQgaWd0X2V2aWN0X3ZtKHZvaWQgKmFy
ZykKIAogCXVucGluX2dndHQoaTkxNSk7CiAKKwltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7
CiAJZXJyID0gaTkxNV9nZW1fZXZpY3Rfdm0oJmdndHQtPnZtKTsKKwltdXRleF91bmxvY2soJmdn
dHQtPnZtLm11dGV4KTsKIAlpZiAoZXJyKSB7CiAJCXByX2VycigiaTkxNV9nZW1fZXZpY3Rfdm0g
b24gYSBmdWxsIEdHVFQgcmV0dXJuZWQgZXJyPSVkXVxuIiwKIAkJICAgICAgIGVycik7CkBAIC00
MDgsMTEgKzQxNywxMSBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9jb250ZXh0cyh2b2lkICphcmcp
CiAJaWYgKCFIQVNfRlVMTF9QUEdUVChpOTE1KSkKIAkJcmV0dXJuIDA7CiAKLQltdXRleF9sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9n
ZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwogCiAJLyogUmVzZXJ2ZSBhIGJsb2NrIHNvIHRoYXQgd2Ug
a25vdyB3ZSBoYXZlIGVub3VnaCB0byBmaXQgYSBmZXcgcnEgKi8KIAltZW1zZXQoJmhvbGUsIDAs
IHNpemVvZihob2xlKSk7CisJbXV0ZXhfbG9jaygmaTkxNS0+Z2d0dC52bS5tdXRleCk7CiAJZXJy
ID0gaTkxNV9nZW1fZ3R0X2luc2VydCgmaTkxNS0+Z2d0dC52bSwgJmhvbGUsCiAJCQkJICBQUkVU
RU5EX0dHVFRfU0laRSwgMCwgSTkxNV9DT0xPUl9VTkVWSUNUQUJMRSwKIAkJCQkgIDAsIGk5MTUt
PmdndHQudm0udG90YWwsCkBAIC00MjUsNyArNDM0LDkgQEAgc3RhdGljIGludCBpZ3RfZXZpY3Rf
Y29udGV4dHModm9pZCAqYXJnKQogCWRvIHsKIAkJc3RydWN0IHJlc2VydmVkICpyOwogCisJCW11
dGV4X3VubG9jaygmaTkxNS0+Z2d0dC52bS5tdXRleCk7CiAJCXIgPSBrY2FsbG9jKDEsIHNpemVv
ZigqciksIEdGUF9LRVJORUwpOworCQltdXRleF9sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsK
IAkJaWYgKCFyKSB7CiAJCQllcnIgPSAtRU5PTUVNOwogCQkJZ290byBvdXRfbG9ja2VkOwpAQCAt
NDQ1LDcgKzQ1Niw3IEBAIHN0YXRpYyBpbnQgaWd0X2V2aWN0X2NvbnRleHRzKHZvaWQgKmFyZykK
IAkJY291bnQrKzsKIAl9IHdoaWxlICgxKTsKIAlkcm1fbW1fcmVtb3ZlX25vZGUoJmhvbGUpOwot
CW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZp
OTE1LT5nZ3R0LnZtLm11dGV4KTsKIAlwcl9pbmZvKCJGaWxsZWQgR0dUVCB3aXRoICVsdSAxTWlC
IG5vZGVzXG4iLCBjb3VudCk7CiAKIAkvKiBPdmVyZmlsbCB0aGUgR0dUVCB3aXRoIGNvbnRleHQg
b2JqZWN0cyBhbmQgc28gdHJ5IHRvIGV2aWN0IG9uZS4gKi8KQEAgLTUwOCw3ICs1MTksNyBAQCBz
dGF0aWMgaW50IGlndF9ldmljdF9jb250ZXh0cyh2b2lkICphcmcpCiAJCQlicmVhazsKIAl9CiAK
LQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF9sb2NrKCZpOTE1
LT5nZ3R0LnZtLm11dGV4KTsKIG91dF9sb2NrZWQ6CiAJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUs
IEk5MTVfV0FJVF9MT0NLRUQpKQogCQllcnIgPSAtRUlPOwpAQCAtNTIyLDggKzUzMyw4IEBAIHN0
YXRpYyBpbnQgaWd0X2V2aWN0X2NvbnRleHRzKHZvaWQgKmFyZykKIAl9CiAJaWYgKGRybV9tbV9u
b2RlX2FsbG9jYXRlZCgmaG9sZSkpCiAJCWRybV9tbV9yZW1vdmVfbm9kZSgmaG9sZSk7CisJbXV0
ZXhfdW5sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIAlpbnRlbF9ydW50aW1lX3BtX3B1dCgm
aTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKIAogCXJldHVybiBlcnI7CiB9CkBAIC01NDUsMTIgKzU1Niw5IEBAIGludCBp
OTE1X2dlbV9ldmljdF9tb2NrX3NlbGZ0ZXN0cyh2b2lkKQogCWlmICghaTkxNSkKIAkJcmV0dXJu
IC1FTk9NRU07CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAl3aXRo
X2ludGVsX3J1bnRpbWVfcG0oJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpCiAJCWVyciA9IGk5
MTVfc3VidGVzdHModGVzdHMsIGk5MTUpOwogCi0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKLQogCWRybV9kZXZfcHV0KCZpOTE1LT5kcm0pOwogCXJldHVybiBlcnI7CiB9
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMKaW5kZXgg
YTkwYzliZTk1ZjhjLi5mMWE2M2QwNDViY2IgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMKQEAgLTM1LDE2ICszNSw3IEBACiAKIHN0YXRpYyB2b2lk
IGNsZWFudXBfZnJlZWRfb2JqZWN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsK
LQkvKgotCSAqIEFzIHdlIG1heSBob2xkIG9udG8gdGhlIHN0cnVjdF9tdXRleCBmb3IgaW5vcmRp
bmF0ZSBsZW5ndGhzIG9mCi0JICogdGltZSwgdGhlIE5NSSBraHVuZ3Rhc2tkIGRldGVjdG9yIG1h
eSBmaXJlIGZvciB0aGUgZnJlZSBvYmplY3RzCi0JICogd29ya2VyLgotCSAqLwotCW11dGV4X3Vu
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlpOTE1X2dlbV9kcmFpbl9mcmVlZF9v
YmplY3RzKGk5MTUpOwotCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiB9
CiAKIHN0YXRpYyB2b2lkIGZha2VfZnJlZV9wYWdlcyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqLApAQCAtMzE4LDYgKzMwOSwxNyBAQCBzdGF0aWMgaW50IGxvd2xldmVsX2hvbGUoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJcmV0dXJuIDA7CiB9CiAKK3N0YXRpYyBpbnQg
dW5sb2NrZWRfdm1hX3VuYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKK3sKKwlpbnQgcmV0Owor
CisJbXV0ZXhfbG9jaygmdm1hLT52bS0+bXV0ZXgpOworCXJldCA9IGk5MTVfdm1hX3VuYmluZCh2
bWEpOworCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOworCisJcmV0dXJuIHJldDsKK30K
Kwogc3RhdGljIHZvaWQgY2xvc2Vfb2JqZWN0X2xpc3Qoc3RydWN0IGxpc3RfaGVhZCAqb2JqZWN0
cywKIAkJCSAgICAgIHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogewpAQCAtMzI5LDcg
KzMzMSw3IEBAIHN0YXRpYyB2b2lkIGNsb3NlX29iamVjdF9saXN0KHN0cnVjdCBsaXN0X2hlYWQg
Km9iamVjdHMsCiAKIAkJdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCB2bSwgTlVMTCk7CiAJ
CWlmICghSVNfRVJSKHZtYSkpCi0JCQlpZ25vcmVkID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CisJ
CQlpZ25vcmVkID0gdW5sb2NrZWRfdm1hX3VuYmluZCh2bWEpOwogCQkvKiBPbmx5IHBwZ3R0IHZt
YSBtYXkgYmUgY2xvc2VkIGJlZm9yZSB0aGUgb2JqZWN0IGlzIGZyZWVkICovCiAJCWlmICghSVNf
RVJSKHZtYSkgJiYgIWk5MTVfdm1hX2lzX2dndHQodm1hKSkKIAkJCWk5MTVfdm1hX2Nsb3NlKHZt
YSk7CkBAIC00NDQsNyArNDQ2LDcgQEAgc3RhdGljIGludCBmaWxsX2hvbGUoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJCQlnb3RvIGVycjsKIAkJCQkJfQogCi0JCQkJCWVyciA9
IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQkJCQllcnIgPSB1bmxvY2tlZF92bWFfdW5iaW5kKHZt
YSk7CiAJCQkJCWlmIChlcnIpIHsKIAkJCQkJCXByX2VycigiJXMoJXMpIChmb3J3YXJkKSB1bmJp
bmQgb2Ygdm1hLm5vZGU9JWxseCArICVsbHggZmFpbGVkIHdpdGggZXJyPSVkXG4iLAogCQkJCQkJ
ICAgICAgIF9fZnVuY19fLCBwLT5uYW1lLCB2bWEtPm5vZGUuc3RhcnQsIHZtYS0+bm9kZS5zaXpl
LApAQCAtNTE3LDcgKzUxOSw3IEBAIHN0YXRpYyBpbnQgZmlsbF9ob2xlKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1LAogCQkJCQkJZ290byBlcnI7CiAJCQkJCX0KIAotCQkJCQllcnIgPSBp
OTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJCQkJZXJyID0gdW5sb2NrZWRfdm1hX3VuYmluZCh2bWEp
OwogCQkJCQlpZiAoZXJyKSB7CiAJCQkJCQlwcl9lcnIoIiVzKCVzKSAoYmFja3dhcmQpIHVuYmlu
ZCBvZiB2bWEubm9kZT0lbGx4ICsgJWxseCBmYWlsZWQgd2l0aCBlcnI9JWRcbiIsCiAJCQkJCQkg
ICAgICAgX19mdW5jX18sIHAtPm5hbWUsIHZtYS0+bm9kZS5zdGFydCwgdm1hLT5ub2RlLnNpemUs
CkBAIC02MDQsNyArNjA2LDcgQEAgc3RhdGljIGludCB3YWxrX2hvbGUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJCQkJZ290byBlcnJfY2xvc2U7CiAJCQl9CiAKLQkJCWVyciA9IGk5
MTVfdm1hX3VuYmluZCh2bWEpOworCQkJZXJyID0gdW5sb2NrZWRfdm1hX3VuYmluZCh2bWEpOwog
CQkJaWYgKGVycikgewogCQkJCXByX2VycigiJXMgdW5iaW5kIGZhaWxlZCBhdCAlbGx4ICsgJWxs
eCAgd2l0aCBlcnI9JWRcbiIsCiAJCQkJICAgICAgIF9fZnVuY19fLCBhZGRyLCB2bWEtPnNpemUs
IGVycik7CkBAIC02ODUsMTMgKzY4NywxMyBAQCBzdGF0aWMgaW50IHBvdF9ob2xlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCXByX2VycigiJXMgaW5jb3JyZWN0IGF0ICVsbHgg
KyAlbGx4XG4iLAogCQkJCSAgICAgICBfX2Z1bmNfXywgYWRkciwgdm1hLT5zaXplKTsKIAkJCQlp
OTE1X3ZtYV91bnBpbih2bWEpOwotCQkJCWVyciA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQkJ
CWVyciA9IHVubG9ja2VkX3ZtYV91bmJpbmQodm1hKTsKIAkJCQllcnIgPSAtRUlOVkFMOwogCQkJ
CWdvdG8gZXJyOwogCQkJfQogCiAJCQlpOTE1X3ZtYV91bnBpbih2bWEpOwotCQkJZXJyID0gaTkx
NV92bWFfdW5iaW5kKHZtYSk7CisJCQllcnIgPSB1bmxvY2tlZF92bWFfdW5iaW5kKHZtYSk7CiAJ
CQlHRU1fQlVHX09OKGVycik7CiAJCX0KIApAQCAtNzg5LDEzICs3OTEsMTMgQEAgc3RhdGljIGlu
dCBkcnVua19ob2xlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCXByX2Vycigi
JXMgaW5jb3JyZWN0IGF0ICVsbHggKyAlbGx4XG4iLAogCQkJCSAgICAgICBfX2Z1bmNfXywgYWRk
ciwgQklUX1VMTChzaXplKSk7CiAJCQkJaTkxNV92bWFfdW5waW4odm1hKTsKLQkJCQllcnIgPSBp
OTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJCQllcnIgPSB1bmxvY2tlZF92bWFfdW5iaW5kKHZtYSk7
CiAJCQkJZXJyID0gLUVJTlZBTDsKIAkJCQlnb3RvIGVycjsKIAkJCX0KIAogCQkJaTkxNV92bWFf
dW5waW4odm1hKTsKLQkJCWVyciA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQkJZXJyID0gdW5s
b2NrZWRfdm1hX3VuYmluZCh2bWEpOwogCQkJR0VNX0JVR19PTihlcnIpOwogCiAJCQlpZiAoaWd0
X3RpbWVvdXQoZW5kX3RpbWUsCkBAIC04NjcsNyArODY5LDcgQEAgc3RhdGljIGludCBfX3Nocmlu
a19ob2xlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJcHJfZXJyKCIlcyBpbmNv
cnJlY3QgYXQgJWxseCArICVsbHhcbiIsCiAJCQkgICAgICAgX19mdW5jX18sIGFkZHIsIHNpemUp
OwogCQkJaTkxNV92bWFfdW5waW4odm1hKTsKLQkJCWVyciA9IGk5MTVfdm1hX3VuYmluZCh2bWEp
OworCQkJZXJyID0gdW5sb2NrZWRfdm1hX3VuYmluZCh2bWEpOwogCQkJZXJyID0gLUVJTlZBTDsK
IAkJCWJyZWFrOwogCQl9CkBAIC04NzUsNiArODc3LDE1IEBAIHN0YXRpYyBpbnQgX19zaHJpbmtf
aG9sZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJaTkxNV92bWFfdW5waW4odm1h
KTsKIAkJYWRkciArPSBzaXplOwogCisJCS8qCisJCSAqIFNpbmNlIHdlIGFyZSBpbmplY3Rpbmcg
YWxsb2NhdGlvbiBmYXVsdHMgYXQgcmFuZG9tIGludGVydmFscywKKwkJICogd2FpdCBmb3IgdGhp
cyBhbGxvY2F0aW9uIHRvIGNvbXBsZXRlIGJlZm9yZSB3ZSBjaGFuZ2UgdGhlCisJCSAqIGZhdWx0
aW5qZWN0aW9uLgorCQkgKi8KKwkJZXJyID0gaTkxNV9hY3RpdmVfd2FpdCgmdm1hLT5hY3RpdmUp
OworCQlpZiAoZXJyKQorCQkJYnJlYWs7CisKIAkJaWYgKGlndF90aW1lb3V0KGVuZF90aW1lLAog
CQkJCSIlcyB0aW1lZCBvdXQgYXQgb2ZzZXQgJWxseCBbJWxseCAtICVsbHhdXG4iLAogCQkJCV9f
ZnVuY19fLCBhZGRyLCBob2xlX3N0YXJ0LCBob2xlX2VuZCkpIHsKQEAgLTEwMDgsMjEgKzEwMTks
MTkgQEAgc3RhdGljIGludCBleGVyY2lzZV9wcGd0dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCiAJaWYgKElTX0VSUihmaWxlKSkKIAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAK
LQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcHBndHQgPSBpOTE1
X3BwZ3R0X2NyZWF0ZShkZXZfcHJpdik7CiAJaWYgKElTX0VSUihwcGd0dCkpIHsKIAkJZXJyID0g
UFRSX0VSUihwcGd0dCk7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290byBvdXRfZnJlZTsKIAl9
CiAJR0VNX0JVR19PTihvZmZzZXRfaW5fcGFnZShwcGd0dC0+dm0udG90YWwpKTsKLQlHRU1fQlVH
X09OKHBwZ3R0LT52bS5jbG9zZWQpOworCUdFTV9CVUdfT04oIWF0b21pY19yZWFkKCZwcGd0dC0+
dm0ub3BlbikpOwogCiAJZXJyID0gZnVuYyhkZXZfcHJpdiwgJnBwZ3R0LT52bSwgMCwgcHBndHQt
PnZtLnRvdGFsLCBlbmRfdGltZSk7CiAKIAlpOTE1X3ZtX3B1dCgmcHBndHQtPnZtKTsKLW91dF91
bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKK291
dF9mcmVlOgogCW1vY2tfZmlsZV9mcmVlKGRldl9wcml2LCBmaWxlKTsKIAlyZXR1cm4gZXJyOwog
fQpAQCAtMTA4NSw3ICsxMDk0LDYgQEAgc3RhdGljIGludCBleGVyY2lzZV9nZ3R0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCUlHVF9USU1FT1VUKGVuZF90aW1lKTsKIAlpbnQgZXJy
ID0gMDsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogcmVzdGFydDoK
IAlsaXN0X3NvcnQoTlVMTCwgJmdndHQtPnZtLm1tLmhvbGVfc3RhY2ssIHNvcnRfaG9sZXMpOwog
CWRybV9tbV9mb3JfZWFjaF9ob2xlKG5vZGUsICZnZ3R0LT52bS5tbSwgaG9sZV9zdGFydCwgaG9s
ZV9lbmQpIHsKQEAgLTExMDYsNyArMTExNCw2IEBAIHN0YXRpYyBpbnQgZXhlcmNpc2VfZ2d0dChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJbGFzdCA9IGhvbGVfZW5kOwogCQlnb3Rv
IHJlc3RhcnQ7CiAJfQotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAK
IAlyZXR1cm4gZXJyOwogfQpAQCAtMTE0OCwxMyArMTE1NSw5IEBAIHN0YXRpYyBpbnQgaWd0X2dn
dHRfcGFnZSh2b2lkICphcmcpCiAJdW5zaWduZWQgaW50ICpvcmRlciwgbjsKIAlpbnQgZXJyOwog
Ci0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlvYmogPSBpOTE1X2dl
bV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGk5MTUsIFBBR0VfU0laRSk7Ci0JaWYgKElTX0VSUihv
YmopKSB7Ci0JCWVyciA9IFBUUl9FUlIob2JqKTsKLQkJZ290byBvdXRfdW5sb2NrOwotCX0KKwlp
ZiAoSVNfRVJSKG9iaikpCisJCXJldHVybiBQVFJfRVJSKG9iaik7CiAKIAllcnIgPSBpOTE1X2dl
bV9vYmplY3RfcGluX3BhZ2VzKG9iaik7CiAJaWYgKGVycikKQEAgLTEyMjIsOCArMTIyNSw2IEBA
IHN0YXRpYyBpbnQgaWd0X2dndHRfcGFnZSh2b2lkICphcmcpCiAJaTkxNV9nZW1fb2JqZWN0X3Vu
cGluX3BhZ2VzKG9iaik7CiBvdXRfZnJlZToKIAlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7Ci1v
dXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0
dXJuIGVycjsKIH0KIApAQCAtMTIzNCw2ICsxMjM1LDkgQEAgc3RhdGljIHZvaWQgdHJhY2tfdm1h
X2JpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJYXRvbWljX2luYygmb2JqLT5iaW5kX2NvdW50
KTsgLyogdHJhY2sgZm9yIGV2aWN0aW9uIGxhdGVyICovCiAJX19pOTE1X2dlbV9vYmplY3RfcGlu
X3BhZ2VzKG9iaik7CiAKKwlHRU1fQlVHX09OKHZtYS0+cGFnZXMpOworCWF0b21pY19zZXQoJnZt
YS0+cGFnZXNfY291bnQsIEJJVCgxNikgfCAxKTsKKwlfX2k5MTVfZ2VtX29iamVjdF9waW5fcGFn
ZXMob2JqKTsKIAl2bWEtPnBhZ2VzID0gb2JqLT5tbS5wYWdlczsKIAogCW11dGV4X2xvY2soJnZt
YS0+dm0tPm11dGV4KTsKQEAgLTEzMzAsMTEgKzEzMzQsMTMgQEAgc3RhdGljIGludCBpZ3RfZ3R0
X3Jlc2VydmUodm9pZCAqYXJnKQogCQkJZ290byBvdXQ7CiAJCX0KIAorCQltdXRleF9sb2NrKCZn
Z3R0LT52bS5tdXRleCk7CiAJCWVyciA9IGk5MTVfZ2VtX2d0dF9yZXNlcnZlKCZnZ3R0LT52bSwg
JnZtYS0+bm9kZSwKIAkJCQkJICAgb2JqLT5iYXNlLnNpemUsCiAJCQkJCSAgIHRvdGFsLAogCQkJ
CQkgICBvYmotPmNhY2hlX2xldmVsLAogCQkJCQkgICAwKTsKKwkJbXV0ZXhfdW5sb2NrKCZnZ3R0
LT52bS5tdXRleCk7CiAJCWlmIChlcnIpIHsKIAkJCXByX2VycigiaTkxNV9nZW1fZ3R0X3Jlc2Vy
dmUgKHBhc3MgMSkgZmFpbGVkIGF0ICVsbHUvJWxsdSB3aXRoIGVycj0lZFxuIiwKIAkJCSAgICAg
ICB0b3RhbCwgZ2d0dC0+dm0udG90YWwsIGVycik7CkBAIC0xMzgwLDExICsxMzg2LDEzIEBAIHN0
YXRpYyBpbnQgaWd0X2d0dF9yZXNlcnZlKHZvaWQgKmFyZykKIAkJCWdvdG8gb3V0OwogCQl9CiAK
KwkJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQllcnIgPSBpOTE1X2dlbV9ndHRfcmVz
ZXJ2ZSgmZ2d0dC0+dm0sICZ2bWEtPm5vZGUsCiAJCQkJCSAgIG9iai0+YmFzZS5zaXplLAogCQkJ
CQkgICB0b3RhbCwKIAkJCQkJICAgb2JqLT5jYWNoZV9sZXZlbCwKIAkJCQkJICAgMCk7CisJCW11
dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQlpZiAoZXJyKSB7CiAJCQlwcl9lcnIoImk5
MTVfZ2VtX2d0dF9yZXNlcnZlIChwYXNzIDIpIGZhaWxlZCBhdCAlbGx1LyVsbHUgd2l0aCBlcnI9
JWRcbiIsCiAJCQkgICAgICAgdG90YWwsIGdndHQtPnZtLnRvdGFsLCBlcnIpOwpAQCAtMTQxNCw3
ICsxNDIyLDcgQEAgc3RhdGljIGludCBpZ3RfZ3R0X3Jlc2VydmUodm9pZCAqYXJnKQogCQkJZ290
byBvdXQ7CiAJCX0KIAotCQllcnIgPSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJZXJyID0gdW5s
b2NrZWRfdm1hX3VuYmluZCh2bWEpOwogCQlpZiAoZXJyKSB7CiAJCQlwcl9lcnIoImk5MTVfdm1h
X3VuYmluZCBmYWlsZWQgd2l0aCBlcnI9JWQhXG4iLCBlcnIpOwogCQkJZ290byBvdXQ7CkBAIC0x
NDI0LDExICsxNDMyLDEzIEBAIHN0YXRpYyBpbnQgaWd0X2d0dF9yZXNlcnZlKHZvaWQgKmFyZykK
IAkJCQkgICAgICAgMipJOTE1X0dUVF9QQUdFX1NJWkUsCiAJCQkJICAgICAgIEk5MTVfR1RUX01J
Tl9BTElHTk1FTlQpOwogCisJCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJZXJyID0g
aTkxNV9nZW1fZ3R0X3Jlc2VydmUoJmdndHQtPnZtLCAmdm1hLT5ub2RlLAogCQkJCQkgICBvYmot
PmJhc2Uuc2l6ZSwKIAkJCQkJICAgb2Zmc2V0LAogCQkJCQkgICBvYmotPmNhY2hlX2xldmVsLAog
CQkJCQkgICAwKTsKKwkJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCWlmIChlcnIp
IHsKIAkJCXByX2VycigiaTkxNV9nZW1fZ3R0X3Jlc2VydmUgKHBhc3MgMykgZmFpbGVkIGF0ICVs
bHUvJWxsdSB3aXRoIGVycj0lZFxuIiwKIAkJCSAgICAgICB0b3RhbCwgZ2d0dC0+dm0udG90YWws
IGVycik7CkBAIC0xNDk3LDExICsxNTA3LDEzIEBAIHN0YXRpYyBpbnQgaWd0X2d0dF9pbnNlcnQo
dm9pZCAqYXJnKQogCiAJLyogQ2hlY2sgYSBjb3VwbGUgb2Ygb2J2aW91c2x5IGludmFsaWQgcmVx
dWVzdHMgKi8KIAlmb3IgKGlpID0gaW52YWxpZF9pbnNlcnQ7IGlpLT5zaXplOyBpaSsrKSB7CisJ
CW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJZXJyID0gaTkxNV9nZW1fZ3R0X2luc2Vy
dCgmZ2d0dC0+dm0sICZ0bXAsCiAJCQkJCSAgaWktPnNpemUsIGlpLT5hbGlnbm1lbnQsCiAJCQkJ
CSAgSTkxNV9DT0xPUl9VTkVWSUNUQUJMRSwKIAkJCQkJICBpaS0+c3RhcnQsIGlpLT5lbmQsCiAJ
CQkJCSAgMCk7CisJCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQlpZiAoZXJyICE9
IC1FTk9TUEMpIHsKIAkJCXByX2VycigiSW52YWxpZCBpOTE1X2dlbV9ndHRfaW5zZXJ0KC5zaXpl
PSVsbHgsIC5hbGlnbm1lbnQ9JWxseCwgLnN0YXJ0PSVsbHgsIC5lbmQ9JWxseCkgc3VjY2VlZGVk
IChlcnI9JWQpXG4iLAogCQkJICAgICAgIGlpLT5zaXplLCBpaS0+YWxpZ25tZW50LCBpaS0+c3Rh
cnQsIGlpLT5lbmQsCkBAIC0xNTM3LDEwICsxNTQ5LDEyIEBAIHN0YXRpYyBpbnQgaWd0X2d0dF9p
bnNlcnQodm9pZCAqYXJnKQogCQkJZ290byBvdXQ7CiAJCX0KIAorCQltdXRleF9sb2NrKCZnZ3R0
LT52bS5tdXRleCk7CiAJCWVyciA9IGk5MTVfZ2VtX2d0dF9pbnNlcnQoJmdndHQtPnZtLCAmdm1h
LT5ub2RlLAogCQkJCQkgIG9iai0+YmFzZS5zaXplLCAwLCBvYmotPmNhY2hlX2xldmVsLAogCQkJ
CQkgIDAsIGdndHQtPnZtLnRvdGFsLAogCQkJCQkgIDApOworCQltdXRleF91bmxvY2soJmdndHQt
PnZtLm11dGV4KTsKIAkJaWYgKGVyciA9PSAtRU5PU1BDKSB7CiAJCQkvKiBtYXhlZCBvdXQgdGhl
IEdHVFQgc3BhY2UgKi8KIAkJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKQEAgLTE1ODksMTYg
KzE2MDMsMTggQEAgc3RhdGljIGludCBpZ3RfZ3R0X2luc2VydCh2b2lkICphcmcpCiAJCUdFTV9C
VUdfT04oIWRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5ub2RlKSk7CiAJCW9mZnNldCA9IHZt
YS0+bm9kZS5zdGFydDsKIAotCQllcnIgPSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJZXJyID0g
dW5sb2NrZWRfdm1hX3VuYmluZCh2bWEpOwogCQlpZiAoZXJyKSB7CiAJCQlwcl9lcnIoImk5MTVf
dm1hX3VuYmluZCBmYWlsZWQgd2l0aCBlcnI9JWQhXG4iLCBlcnIpOwogCQkJZ290byBvdXQ7CiAJ
CX0KIAorCQltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCWVyciA9IGk5MTVfZ2VtX2d0
dF9pbnNlcnQoJmdndHQtPnZtLCAmdm1hLT5ub2RlLAogCQkJCQkgIG9iai0+YmFzZS5zaXplLCAw
LCBvYmotPmNhY2hlX2xldmVsLAogCQkJCQkgIDAsIGdndHQtPnZtLnRvdGFsLAogCQkJCQkgIDAp
OworCQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJaWYgKGVycikgewogCQkJcHJf
ZXJyKCJpOTE1X2dlbV9ndHRfaW5zZXJ0IChwYXNzIDIpIGZhaWxlZCBhdCAlbGx1LyVsbHUgd2l0
aCBlcnI9JWRcbiIsCiAJCQkgICAgICAgdG90YWwsIGdndHQtPnZtLnRvdGFsLCBlcnIpOwpAQCAt
MTY0MiwxMCArMTY1OCwxMiBAQCBzdGF0aWMgaW50IGlndF9ndHRfaW5zZXJ0KHZvaWQgKmFyZykK
IAkJCWdvdG8gb3V0OwogCQl9CiAKKwkJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQll
cnIgPSBpOTE1X2dlbV9ndHRfaW5zZXJ0KCZnZ3R0LT52bSwgJnZtYS0+bm9kZSwKIAkJCQkJICBv
YmotPmJhc2Uuc2l6ZSwgMCwgb2JqLT5jYWNoZV9sZXZlbCwKIAkJCQkJICAwLCBnZ3R0LT52bS50
b3RhbCwKIAkJCQkJICAwKTsKKwkJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCWlm
IChlcnIpIHsKIAkJCXByX2VycigiaTkxNV9nZW1fZ3R0X2luc2VydCAocGFzcyAzKSBmYWlsZWQg
YXQgJWxsdS8lbGx1IHdpdGggZXJyPSVkXG4iLAogCQkJICAgICAgIHRvdGFsLCBnZ3R0LT52bS50
b3RhbCwgZXJyKTsKQEAgLTE2ODksOCArMTcwNyw5IEBAIGludCBpOTE1X2dlbV9ndHRfbW9ja19z
ZWxmdGVzdHModm9pZCkKIAl9CiAJbW9ja19pbml0X2dndHQoaTkxNSwgZ2d0dCk7CiAKLQltdXRl
eF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAllcnIgPSBpOTE1X3N1YnRlc3RzKHRl
c3RzLCBnZ3R0KTsKKworCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCW1v
Y2tfZGV2aWNlX2ZsdXNoKGk5MTUpOwogCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1
X3ZtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfdm1hLmMKaW5kZXgg
YTViZWMwYTRjZGNjLi5mMTQxYzY4ZTc5NzggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9pOTE1X3ZtYS5jCkBAIC0zMzcsNyArMzM3LDkgQEAgc3RhdGljIGludCBpZ3Rfdm1hX3Bp
bjEodm9pZCAqYXJnKQogCiAJCWlmICghZXJyKSB7CiAJCQlpOTE1X3ZtYV91bnBpbih2bWEpOwor
CQkJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQkJZXJyID0gaTkxNV92bWFfdW5iaW5k
KHZtYSk7CisJCQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJCWlmIChlcnIpIHsK
IAkJCQlwcl9lcnIoIkZhaWxlZCB0byB1bmJpbmQgc2luZ2xlIHBhZ2UgZnJvbSBHR1RULCBlcnI9
JWRcbiIsIGVycik7CiAJCQkJZ290byBvdXQ7CkBAIC04MzEsOCArODMzLDkgQEAgaW50IGk5MTVf
dm1hX21vY2tfc2VsZnRlc3RzKHZvaWQpCiAJfQogCW1vY2tfaW5pdF9nZ3R0KGk5MTUsIGdndHQp
OwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJZXJyID0gaTkxNV9z
dWJ0ZXN0cyh0ZXN0cywgZ2d0dCk7CisKKwltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKIAltb2NrX2RldmljZV9mbHVzaChpOTE1KTsKIAltdXRleF91bmxvY2soJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwogCkBAIC04NzksOCArODgyLDYgQEAgc3RhdGljIGludCBpZ3Rfdm1h
X3JlbWFwcGVkX2d0dCh2b2lkICphcmcpCiAJaWYgKElTX0VSUihvYmopKQogCQlyZXR1cm4gUFRS
X0VSUihvYmopOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAl3
YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwogCiAJZm9y
ICh0ID0gdHlwZXM7ICp0OyB0KyspIHsKQEAgLTk3Niw3ICs5NzcsNiBAQCBzdGF0aWMgaW50IGln
dF92bWFfcmVtYXBwZWRfZ3R0KHZvaWQgKmFyZykKIAogb3V0OgogCWludGVsX3J1bnRpbWVfcG1f
cHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwogCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKIAogCXJldHVybiBl
cnI7Ci0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVs
LWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E1D12F28E6
	for <lists+intel-gfx@lfdr.de>; Thu,  7 Nov 2019 09:13:30 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2AC3D6EED5;
	Thu,  7 Nov 2019 08:13:27 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2D3A16EEBF
 for <intel-gfx@lists.freedesktop.org>; Thu,  7 Nov 2019 08:13:08 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19110662-1500050 
 for multiple; Thu, 07 Nov 2019 08:12:54 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  7 Nov 2019 08:12:29 +0000
Message-Id: <20191107081252.10542-5-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191107081252.10542-1-chris@chris-wilson.co.uk>
References: <20191107081252.10542-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 05/28] drm/i915/selftests: Wrap vm_mmap() around
 GEM objects
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UHJvdmlkZSBhIHV0aWxpdHkgZnVuY3Rpb24gdG8gY3JlYXRlIGEgdm1hIGNvcnJlc3BvbmRpbmcg
dG8gYW4gbW1hcCgpIG9mCm91ciBkZXZpY2UuIEFuZCB1c2UgaXQgdG8gZXhlcmNpc2UgdGhlIGVx
dWl2YWxlbnQgb2YgdXNlcnNwYWNlCnBlcmZvcm1pbmcgYSBHVFQgbW1hcCBvZiBvdXIgb2JqZWN0
cy4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVr
PgpDYzogQWJkaWVsIEphbnVsZ3VlIDxhYmRpZWwuamFudWxndWVAbGludXguaW50ZWwuY29tPgot
LS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlICAgICAgICAgICAgICAgICB8ICAgMSAr
CiAuLi4vZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMgICAgfCAxMDAgKysr
KysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X21tYXAu
YyAgICAgfCAgMzkgKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9t
bWFwLmggICAgIHwgIDE5ICsrKysKIDQgZmlsZXMgY2hhbmdlZCwgMTU5IGluc2VydGlvbnMoKykK
IGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X21t
YXAuYwogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
Z3RfbW1hcC5oCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQppbmRleCA5MGRjZjA5ZjUyY2MuLmUwZmQxMGMw
Y2ZiOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKQEAgLTI1OSw2ICsyNTksNyBAQCBpOTE1LSQoQ09O
RklHX0RSTV9JOTE1X1NFTEZURVNUKSArPSBcCiAJc2VsZnRlc3RzL2k5MTVfc2VsZnRlc3QubyBc
CiAJc2VsZnRlc3RzL2lndF9mbHVzaF90ZXN0Lm8gXAogCXNlbGZ0ZXN0cy9pZ3RfbGl2ZV90ZXN0
Lm8gXAorCXNlbGZ0ZXN0cy9pZ3RfbW1hcC5vIFwKIAlzZWxmdGVzdHMvaWd0X3Jlc2V0Lm8gXAog
CXNlbGZ0ZXN0cy9pZ3Rfc3Bpbm5lci5vCiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMKaW5kZXggMjliMjA3N2I3M2QyLi5kNWFlNDkx
YTAzNjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkx
NV9nZW1fbW1hbi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkx
NV9nZW1fbW1hbi5jCkBAIC0xMiw2ICsxMiw3IEBACiAjaW5jbHVkZSAiaTkxNV9zZWxmdGVzdC5o
IgogI2luY2x1ZGUgInNlbGZ0ZXN0cy9pOTE1X3JhbmRvbS5oIgogI2luY2x1ZGUgInNlbGZ0ZXN0
cy9pZ3RfZmx1c2hfdGVzdC5oIgorI2luY2x1ZGUgInNlbGZ0ZXN0cy9pZ3RfbW1hcC5oIgogCiBz
dHJ1Y3QgdGlsZSB7CiAJdW5zaWduZWQgaW50IHdpZHRoOwpAQCAtNjk0LDEyICs2OTUsMTExIEBA
IHN0YXRpYyBpbnQgaWd0X21tYXBfb2Zmc2V0X2V4aGF1c3Rpb24odm9pZCAqYXJnKQogCWdvdG8g
b3V0OwogfQogCisjZGVmaW5lIGV4cGFuZDMyKHgpICgoKHgpIDw8IDApIHwgKCh4KSA8PCA4KSB8
ICgoeCkgPDwgMTYpIHwgKCh4KSA8PCAyNCkpCitzdGF0aWMgaW50IGlndF9tbWFwX2d0dCh2b2lk
ICphcmcpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CisJc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKKwlzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKmFyZWE7
CisJdW5zaWduZWQgbG9uZyBhZGRyOworCXZvaWQgKnZhZGRyOworCWludCBlcnIsIGk7CisKKwlp
ZiAoIWk5MTVfZ2d0dF9oYXNfYXBlcnR1cmUoJmk5MTUtPmdndHQpKQorCQlyZXR1cm4gMDsKKwor
CW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoaTkxNSwgUEFHRV9TSVpFKTsK
KwlpZiAoSVNfRVJSKG9iaikpCisJCXJldHVybiBQVFJfRVJSKG9iaik7CisKKwl2YWRkciA9IGk5
MTVfZ2VtX29iamVjdF9waW5fbWFwKG9iaiwgSTkxNV9NQVBfV0IpOworCWlmIChJU19FUlIodmFk
ZHIpKSB7CisJCWVyciA9IFBUUl9FUlIodmFkZHIpOworCQlnb3RvIG91dDsKKwl9CisJbWVtc2V0
KHZhZGRyLCBQT0lTT05fSU5VU0UsIFBBR0VfU0laRSk7CisJaTkxNV9nZW1fb2JqZWN0X2ZsdXNo
X21hcChvYmopOworCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAob2JqKTsKKworCWVyciA9IGNy
ZWF0ZV9tbWFwX29mZnNldChvYmopOworCWlmIChlcnIpCisJCWdvdG8gb3V0OworCisJYWRkciA9
IGlndF9tbWFwX25vZGUoaTkxNSwgJm9iai0+YmFzZS52bWFfbm9kZSwKKwkJCSAgICAgMCwgUFJP
VF9XUklURSwgTUFQX1NIQVJFRCk7CisJaWYgKElTX0VSUl9WQUxVRShhZGRyKSkgeworCQllcnIg
PSBhZGRyOworCQlnb3RvIG91dDsKKwl9CisKKwlwcl9kZWJ1ZygiaWd0X21tYXAob2JqOmd0dCkg
QCAlbHhcbiIsIGFkZHIpOworCisJYXJlYSA9IGZpbmRfdm1hKGN1cnJlbnQtPm1tLCBhZGRyKTsK
KwlpZiAoIWFyZWEpIHsKKwkJcHJfZXJyKCJEaWQgbm90IGNyZWF0ZSBhIHZtX2FyZWFfc3RydWN0
IGZvciB0aGUgbW1hcFxuIik7CisJCWVyciA9IC1FSU5WQUw7CisJCWdvdG8gb3V0X3VubWFwOwor
CX0KKworCWlmIChhcmVhLT52bV9wcml2YXRlX2RhdGEgIT0gb2JqKSB7CisJCXByX2Vycigidm1f
YXJlYV9zdHJ1Y3QgZGlkIG5vdCBwb2ludCBiYWNrIHRvIG91ciBvYmplY3QhXG4iKTsKKwkJZXJy
ID0gLUVJTlZBTDsKKwkJZ290byBvdXRfdW5tYXA7CisJfQorCisJZm9yIChpID0gMDsgaSA8IFBB
R0VfU0laRSAvIHNpemVvZih1MzIpOyBpKyspIHsKKwkJdTMyIF9fdXNlciAqdXggPSB1NjRfdG9f
dXNlcl9wdHIoKHU2NCkoYWRkciArIGkgKiBzaXplb2YqKHV4KSkpOworCQl1MzIgeDsKKworCQlp
ZiAoZ2V0X3VzZXIoeCwgdXgpKSB7CisJCQlwcl9lcnIoIlVuYWJsZSB0byByZWFkIGZyb20gR1RU
IG1tYXAsIG9mZnNldDolemRcbiIsCisJCQkgICAgICAgaSAqIHNpemVvZih4KSk7CisJCQllcnIg
PSAtRUZBVUxUOworCQkJYnJlYWs7CisJCX0KKworCQlpZiAoeCAhPSBleHBhbmQzMihQT0lTT05f
SU5VU0UpKSB7CisJCQlwcl9lcnIoIlJlYWQgaW5jb3JyZWN0IHZhbHVlIGZyb20gR1RUIG1tYXAs
IG9mZnNldDolemQsIGZvdW5kOiV4LCBleHBlY3RlZDoleFxuIiwKKwkJCSAgICAgICBpICogc2l6
ZW9mKHgpLCB4LCBleHBhbmQzMihQT0lTT05fSU5VU0UpKTsKKwkJCWVyciA9IC1FSU5WQUw7CisJ
CQlicmVhazsKKwkJfQorCisJCXggPSBleHBhbmQzMihQT0lTT05fRlJFRSk7CisJCWlmIChwdXRf
dXNlcih4LCB1eCkpIHsKKwkJCXByX2VycigiVW5hYmxlIHRvIHdyaXRlIHRvIEdUVCBtbWFwLCBv
ZmZzZXQ6JXpkXG4iLAorCQkJICAgICAgIGkgKiBzaXplb2YoeCkpOworCQkJZXJyID0gLUVGQVVM
VDsKKwkJCWJyZWFrOworCQl9CisJfQorCitvdXRfdW5tYXA6CisJdm1fbXVubWFwKGFkZHIsIFBB
R0VfU0laRSk7CisKKwl2YWRkciA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKG9iaiwgSTkxNV9N
QVBfRk9SQ0VfV0MpOworCWlmIChJU19FUlIodmFkZHIpKSB7CisJCWVyciA9IFBUUl9FUlIodmFk
ZHIpOworCQlnb3RvIG91dDsKKwl9CisJaWYgKGVyciA9PSAwICYmIG1lbWNocl9pbnYodmFkZHIs
IFBPSVNPTl9GUkVFLCBQQUdFX1NJWkUpKSB7CisJCXByX2VycigiV3JpdGUgdmlhIEdHVFQgbW1h
cCBkaWQgbm90IGxhbmQgaW4gYmFja2luZyBzdG9yZVxuIik7CisJCWVyciA9IC1FSU5WQUw7CisJ
fQorCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAob2JqKTsKKworb3V0OgorCWk5MTVfZ2VtX29i
amVjdF9wdXQob2JqKTsKKwlyZXR1cm4gZXJyOworfQorCiBpbnQgaTkxNV9nZW1fbW1hbl9saXZl
X3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdGF0aWMgY29u
c3Qgc3RydWN0IGk5MTVfc3VidGVzdCB0ZXN0c1tdID0gewogCQlTVUJURVNUKGlndF9wYXJ0aWFs
X3RpbGluZyksCiAJCVNVQlRFU1QoaWd0X3Ntb2tlX3RpbGluZyksCiAJCVNVQlRFU1QoaWd0X21t
YXBfb2Zmc2V0X2V4aGF1c3Rpb24pLAorCQlTVUJURVNUKGlndF9tbWFwX2d0dCksCiAJfTsKIAog
CXJldHVybiBpOTE1X3N1YnRlc3RzKHRlc3RzLCBpOTE1KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfbW1hcC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2lndF9tbWFwLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAw
MDAwLi41ODNhNGZmOGI4YzkKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvaWd0X21tYXAuYwpAQCAtMCwwICsxLDM5IEBACisvKgorICogU1BEWC1MaWNl
bnNlLUlkZW50aWZpZXI6IE1JVAorICoKKyAqIENvcHlyaWdodCDCqSAyMDE5IEludGVsIENvcnBv
cmF0aW9uCisgKi8KKworI2luY2x1ZGUgPGRybS9kcm1fZmlsZS5oPgorCisjaW5jbHVkZSAiaTkx
NV9kcnYuaCIKKyNpbmNsdWRlICJpZ3RfbW1hcC5oIgorCit1bnNpZ25lZCBsb25nIGlndF9tbWFw
X25vZGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCisJCQkgICAgc3RydWN0IGRybV92
bWFfb2Zmc2V0X25vZGUgKm5vZGUsCisJCQkgICAgdW5zaWduZWQgbG9uZyBhZGRyLAorCQkJICAg
IHVuc2lnbmVkIGxvbmcgcHJvdCwKKwkJCSAgICB1bnNpZ25lZCBsb25nIGZsYWdzKQoreworCXN0
cnVjdCBmaWxlICpmaWxlOworCWludCBlcnI7CisKKwkvKiBQcmV0ZW5kIHRvIG9wZW4oIi9kZXYv
ZHJpL2NhcmQwIikgKi8KKwlmaWxlID0gbW9ja19kcm1fZ2V0ZmlsZShpOTE1LT5kcm0ucHJpbWFy
eSwgT19SRFdSKTsKKwlpZiAoSVNfRVJSKGZpbGUpKQorCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsK
KworCWVyciA9IGRybV92bWFfbm9kZV9hbGxvdyhub2RlLCBmaWxlLT5wcml2YXRlX2RhdGEpOwor
CWlmIChlcnIpIHsKKwkJYWRkciA9IGVycjsKKwkJZ290byBvdXRfZmlsZTsKKwl9CisKKwlhZGRy
ID0gdm1fbW1hcChmaWxlLCBhZGRyLCBkcm1fdm1hX25vZGVfc2l6ZShub2RlKSA8PCBQQUdFX1NI
SUZULAorCQkgICAgICAgcHJvdCwgZmxhZ3MsIGRybV92bWFfbm9kZV9vZmZzZXRfYWRkcihub2Rl
KSk7CisKKwlkcm1fdm1hX25vZGVfcmV2b2tlKG5vZGUsIGZpbGUtPnByaXZhdGVfZGF0YSk7Citv
dXRfZmlsZToKKwlmcHV0KGZpbGUpOworCXJldHVybiBhZGRyOworfQpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9tbWFwLmggYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9zZWxmdGVzdHMvaWd0X21tYXAuaApuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAw
MDAwMDAwMDAuLjZlNzE2Y2I1OWQ3ZQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfbW1hcC5oCkBAIC0wLDAgKzEsMTkgQEAKKy8qCisgKiBTUERY
LUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUCisgKgorICogQ29weXJpZ2h0IMKpIDIwMTkgSW50ZWwg
Q29ycG9yYXRpb24KKyAqLworCisjaWZuZGVmIElHVF9NTUFQX0gKKyNkZWZpbmUgSUdUX01NQVBf
SAorCitzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZTsKK3N0cnVjdCBkcm1fdm1hX29mZnNldF9ub2Rl
OworCit1bnNpZ25lZCBsb25nIGlndF9tbWFwX25vZGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsCisJCQkgICAgc3RydWN0IGRybV92bWFfb2Zmc2V0X25vZGUgKm5vZGUsCisJCQkgICAg
dW5zaWduZWQgbG9uZyBhZGRyLAorCQkJICAgIHVuc2lnbmVkIGxvbmcgcHJvdCwKKwkJCSAgICB1
bnNpZ25lZCBsb25nIGZsYWdzKTsKKworI2VuZGlmIC8qIElHVF9NTUFQX0ggKi8KLS0gCjIuMjQu
MAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwt
Z2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8v
bGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id B6686FCA88
	for <lists+intel-gfx@lfdr.de>; Thu, 14 Nov 2019 17:05:37 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7E1836EBF3;
	Thu, 14 Nov 2019 16:05:33 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B3C7D6EBD7
 for <intel-gfx@lists.freedesktop.org>; Thu, 14 Nov 2019 16:05:25 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 14 Nov 2019 17:05:16 +0100
Message-Id: <20191114160522.9699-5-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191114160522.9699-1-maarten.lankhorst@linux.intel.com>
References: <20191114160522.9699-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 05/11] drm/i915: Try to make bigjoiner work in
 atomic check, v3.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2hlbiB0aGUgY2xvY2sgaXMgaGlnaGVyIHRoYW4gdGhlIGRvdGNsb2NrLCB0cnkgd2l0aCAyIHBp
cGVzIGVuYWJsZWQuCklmIHdlIGNhbiBlbmFibGUgMiwgdGhlbiB3ZSB3aWxsIGdvIGludG8gYmln
IGpvaW5lciBtb2RlLCBhbmQgc3RlYWwKdGhlIGFkamFjZW50IGNydGMuCgpUaGlzIG9ubHkgbGlu
a3MgdGhlIGNydGMncyBpbiBzb2Z0d2FyZSwgbm8gaGFyZHdhcmUgb3IgcGxhbmUKcHJvZ3JhbW1p
bmcgaXMgZG9uZSB5ZXQuIEJsb2JzIGFyZSBhbHNvIGNvcGllZCBmcm9tIHRoZSBtYXN0ZXIncwpj
cnRjX3N0YXRlLCBzbyBpdCBkb2Vzbid0IGRlcGVuZCBhdCBjb21taXQgdGltZSBvbiB0aGUgb3Ro
ZXIKY3J0Y19zdGF0ZS4KCkNoYW5nZXMgc2luY2UgdjE6Ci0gUmVuYW1lIHBpcGUgdGltaW5ncyB0
byB0cmFuc2NvZGVyIHRpbWluZ3MsIGFzIHRoZXkgYXJlIG5vdyBkaWZmZXJlbnQuCkNoYW5nZXMg
c2luY2UgdjI6Ci0gUmV3b3JrIGJpZ2pvaW5lciBjaGVja3M7IGFsd2F5cyBkaXNhYmxlIHNsYXZl
IHdoZW4gcmVjYWxjdWxhdGluZwogIG1hc3Rlci4gTm8gbmVlZCB0byBoYXZlIGEgc2VwYXJhdGUg
Ymlnam9pbmVyIHBhc3MgYW55IG1vcmUuCi0gVXNlIHBpcGVfbW9kZSBpbnN0ZWFkIG9mIHRyYW5z
Y29kZXJfbW9kZSwgdG8gY2xlYW4gdXAgdGhlIGNvZGUuCgpTaWduZWQtb2ZmLWJ5OiBNYWFydGVu
IExhbmtob3JzdCA8bWFhcnRlbi5sYW5raG9yc3RAbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljLmMgICB8ICAgOSArLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuaCAgIHwgICAzICstCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyAgfCAxOTggKysrKysrKysrKysr
KysrKy0tCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggICAgfCAg
IDkgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jICAgICAgIHwgIDIy
ICstCiA1IGZpbGVzIGNoYW5nZWQsIDIwNyBpbnNlcnRpb25zKCspLCAzNCBkZWxldGlvbnMoLSkK
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYwppbmRleCBmZDAw
MjZmYzM2MTguLmI1YzE3ZDhjMDIwOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9hdG9taWMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2F0b21pYy5jCkBAIC0yMjksMTQgKzIyOSwxNSBAQCB2b2lkIGludGVsX2NydGNfZnJl
ZV9od19zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAlpbnRlbF9j
cnRjX3B1dF9jb2xvcl9ibG9icyhjcnRjX3N0YXRlKTsKIH0KIAotdm9pZCBpbnRlbF9jcnRjX2Nv
cHlfY29sb3JfYmxvYnMoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit2b2lk
IGludGVsX2NydGNfY29weV9jb2xvcl9ibG9icyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSwKKwkJCQkgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmZyb21fY3J0Y19z
dGF0ZSkKIHsKIAlkcm1fcHJvcGVydHlfcmVwbGFjZV9ibG9iKCZjcnRjX3N0YXRlLT5ody5kZWdh
bW1hX2x1dCwKLQkJCQkgIGNydGNfc3RhdGUtPnVhcGkuZGVnYW1tYV9sdXQpOworCQkJCSAgZnJv
bV9jcnRjX3N0YXRlLT51YXBpLmRlZ2FtbWFfbHV0KTsKIAlkcm1fcHJvcGVydHlfcmVwbGFjZV9i
bG9iKCZjcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQsCi0JCQkJICBjcnRjX3N0YXRlLT51YXBpLmdh
bW1hX2x1dCk7CisJCQkJICBmcm9tX2NydGNfc3RhdGUtPnVhcGkuZ2FtbWFfbHV0KTsKIAlkcm1f
cHJvcGVydHlfcmVwbGFjZV9ibG9iKCZjcnRjX3N0YXRlLT5ody5jdG0sCi0JCQkJICBjcnRjX3N0
YXRlLT51YXBpLmN0bSk7CisJCQkJICBmcm9tX2NydGNfc3RhdGUtPnVhcGkuY3RtKTsKIH0KIAog
LyoqCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21p
Yy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuaAppbmRleCA3
YjQ5NjIzNDE5YmEuLmU2NDQ3MzIyNzI4NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2F0b21pYy5oCkBAIC0zNyw3ICszNyw4IEBAIHN0cnVjdCBkcm1fY3J0Y19zdGF0
ZSAqaW50ZWxfY3J0Y19kdXBsaWNhdGVfc3RhdGUoc3RydWN0IGRybV9jcnRjICpjcnRjKTsKIHZv
aWQgaW50ZWxfY3J0Y19kZXN0cm95X3N0YXRlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAkJCSAg
ICAgICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKnN0YXRlKTsKIHZvaWQgaW50ZWxfY3J0Y19mcmVl
X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKLXZvaWQgaW50
ZWxfY3J0Y19jb3B5X2NvbG9yX2Jsb2JzKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlKTsKK3ZvaWQgaW50ZWxfY3J0Y19jb3B5X2NvbG9yX2Jsb2JzKHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlLAorCQkJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
ZnJvbV9jcnRjX3N0YXRlKTsKIHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICppbnRlbF9hdG9taWNf
c3RhdGVfYWxsb2Moc3RydWN0IGRybV9kZXZpY2UgKmRldik7CiB2b2lkIGludGVsX2F0b21pY19z
dGF0ZV9jbGVhcihzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpOwogCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4IDdhNmRhODU4MjNhZi4u
MmRjNjNlZjVjYWY4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rp
c3BsYXkuYwpAQCAtNzU3Niw5ICs3NTc2LDI1IEBAIHN0YXRpYyBpbnQgaW50ZWxfY3J0Y19jb21w
dXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCQkgICAgIHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKLQljb25zdCBzdHJ1Y3QgZHJtX2Rp
c3BsYXlfbW9kZSAqcGlwZV9tb2RlID0gJnBpcGVfY29uZmlnLT5ody5waXBlX21vZGU7CisJc3Ry
dWN0IGRybV9kaXNwbGF5X21vZGUgKnBpcGVfbW9kZSA9ICZwaXBlX2NvbmZpZy0+aHcucGlwZV9t
b2RlOwogCWludCBjbG9ja19saW1pdCA9IGRldl9wcml2LT5tYXhfZG90Y2xrX2ZyZXE7CiAKKwkq
cGlwZV9tb2RlID0gcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CisKKwkvKiBBZGp1c3Qg
cGlwZV9tb2RlIGZvciBiaWdqb2luZXIsIHdpdGggaGFsZiB0aGUgaG9yaXpvbnRhbCBtb2RlICov
CisJaWYgKHBpcGVfY29uZmlnLT5iaWdqb2luZXIpIHsKKwkJcGlwZV9tb2RlLT5jcnRjX2Nsb2Nr
IC89IDI7CisJCXBpcGVfbW9kZS0+Y3J0Y19oZGlzcGxheSAvPSAyOworCQlwaXBlX21vZGUtPmNy
dGNfaGJsYW5rX3N0YXJ0IC89IDI7CisJCXBpcGVfbW9kZS0+Y3J0Y19oYmxhbmtfZW5kIC89IDI7
CisJCXBpcGVfbW9kZS0+Y3J0Y19oc3luY19zdGFydCAvPSAyOworCQlwaXBlX21vZGUtPmNydGNf
aHN5bmNfZW5kIC89IDI7CisJCXBpcGVfbW9kZS0+Y3J0Y19odG90YWwgLz0gMjsKKwkJcGlwZV9t
b2RlLT5jcnRjX2hza2V3IC89IDI7CisKKwkJcGlwZV9jb25maWctPnBpcGVfc3JjX3cgLz0gMjsK
Kwl9CisKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDQpIHsKIAkJY2xvY2tfbGltaXQgPSBk
ZXZfcHJpdi0+bWF4X2NkY2xrX2ZyZXEgKiA5IC8gMTA7CiAKQEAgLTc2MzUsNyArNzY1MSw3IEBA
IHN0YXRpYyBpbnQgaW50ZWxfY3J0Y19jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YywKIAkgKiBXYVBydW5lTW9kZVdpdGhJbmNvcnJlY3RIc3luY09mZnNldDpjdGcsZWxrLGls
ayxzbmIsaXZiLHZsdixoc3cuCiAJICovCiAJaWYgKChJTlRFTF9HRU4oZGV2X3ByaXYpID4gNCB8
fCBJU19HNFgoZGV2X3ByaXYpKSAmJgotCQlwaXBlX21vZGUtPmNydGNfaHN5bmNfc3RhcnQgPT0g
cGlwZV9tb2RlLT5jcnRjX2hkaXNwbGF5KQorCSAgICBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRf
bW9kZS5jcnRjX2hzeW5jX3N0YXJ0ID09IHBpcGVfbW9kZS0+Y3J0Y19oZGlzcGxheSkKIAkJcmV0
dXJuIC1FSU5WQUw7CiAKIAlpbnRlbF9jcnRjX2NvbXB1dGVfcGl4ZWxfcmF0ZShwaXBlX2NvbmZp
Zyk7CkBAIC0xMTkyMSw3ICsxMTkzNyw3IEBAIHN0YXRpYyBib29sIGVuY29kZXJzX2Nsb25lYWJs
ZShjb25zdCBzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqYSwKIAkJCSAgYi0+Y2xvbmVhYmxlICYgKDEg
PDwgYS0+dHlwZSkpOwogfQogCi1zdGF0aWMgYm9vbCBjaGVja19zaW5nbGVfZW5jb2Rlcl9jbG9u
aW5nKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSwKK3N0YXRpYyBib29sIGNoZWNrX3Np
bmdsZV9lbmNvZGVyX2Nsb25pbmcoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJ
CQkJCSBzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCQkJIHN0cnVjdCBpbnRlbF9lbmNvZGVy
ICplbmNvZGVyKQogewpAQCAtMTE5MzAsNyArMTE5NDYsNyBAQCBzdGF0aWMgYm9vbCBjaGVja19z
aW5nbGVfZW5jb2Rlcl9jbG9uaW5nKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSwKIAlz
dHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubmVjdG9yX3N0YXRlOwogCWludCBpOwogCi0J
Zm9yX2VhY2hfbmV3X2Nvbm5lY3Rvcl9pbl9zdGF0ZShzdGF0ZSwgY29ubmVjdG9yLCBjb25uZWN0
b3Jfc3RhdGUsIGkpIHsKKwlmb3JfZWFjaF9uZXdfY29ubmVjdG9yX2luX3N0YXRlKCZzdGF0ZS0+
YmFzZSwgY29ubmVjdG9yLCBjb25uZWN0b3Jfc3RhdGUsIGkpIHsKIAkJaWYgKGNvbm5lY3Rvcl9z
dGF0ZS0+Y3J0YyAhPSAmY3J0Yy0+YmFzZSkKIAkJCWNvbnRpbnVlOwogCkBAIC0xMjE2Nyw2ICsx
MjE4Myw3IEBAIHN0YXRpYyBpbnQgaW50ZWxfY3J0Y19hdG9taWNfY2hlY2soc3RydWN0IGludGVs
X2F0b21pY19zdGF0ZSAqc3RhdGUsCiAKIAlpZiAobW9kZV9jaGFuZ2VkICYmIGNydGNfc3RhdGUt
Pmh3LmVuYWJsZSAmJgogCSAgICBkZXZfcHJpdi0+ZGlzcGxheS5jcnRjX2NvbXB1dGVfY2xvY2sg
JiYKKwkgICAgIWNydGNfc3RhdGUtPmJpZ2pvaW5lcl9zbGF2ZSAmJgogCSAgICAhV0FSTl9PTihj
cnRjX3N0YXRlLT5zaGFyZWRfZHBsbCkpIHsKIAkJcmV0ID0gZGV2X3ByaXYtPmRpc3BsYXkuY3J0
Y19jb21wdXRlX2Nsb2NrKGNydGMsIGNydGNfc3RhdGUpOwogCQlpZiAocmV0KQpAQCAtMTI2Mjcs
MTggKzEyNjQ0LDMxIEBAIHN0YXRpYyBib29sIGNoZWNrX2RpZ2l0YWxfcG9ydF9jb25mbGljdHMo
c3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB9CiAKIHN0YXRpYyB2b2lkCi1pbnRl
bF9jcnRjX2NvcHlfdWFwaV90b19od19zdGF0ZV9ub21vZGVzZXQoc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUpCitpbnRlbF9jcnRjX2NvcHlfdWFwaV90b19od19zdGF0ZV9ub21v
ZGVzZXQoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCisJCQkJCSAgIHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCWludGVsX2NydGNfY29weV9jb2xvcl9i
bG9icyhjcnRjX3N0YXRlKTsKKwljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqZnJvbV9j
cnRjX3N0YXRlID0gY3J0Y19zdGF0ZTsKKworCWlmIChjcnRjX3N0YXRlLT5iaWdqb2luZXJfc2xh
dmUpIHsKKwkJZnJvbV9jcnRjX3N0YXRlID0gaW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0
ZShzdGF0ZSwKKwkJCQkJY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX2xpbmtlZF9jcnRjKTsKKworCQkv
KiBObyBuZWVkIHRvIGNvcHkgc3RhdGUgaWYgdGhlIG1hc3RlciBzdGF0ZSBpcyB1bmNoYW5nZWQg
Ki8KKwkJaWYgKCFmcm9tX2NydGNfc3RhdGUpCisJCQlyZXR1cm47CisJfQorCisJaW50ZWxfY3J0
Y19jb3B5X2NvbG9yX2Jsb2JzKGNydGNfc3RhdGUsIGZyb21fY3J0Y19zdGF0ZSk7CiB9CiAKIHN0
YXRpYyB2b2lkCi1pbnRlbF9jcnRjX2NvcHlfdWFwaV90b19od19zdGF0ZShzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK2ludGVsX2NydGNfY29weV91YXBpX3RvX2h3X3N0YXRl
KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAorCQkJCSBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAljcnRjX3N0YXRlLT5ody5lbmFibGUgPSBjcnRjX3N0
YXRlLT51YXBpLmVuYWJsZTsKIAljcnRjX3N0YXRlLT5ody5hY3RpdmUgPSBjcnRjX3N0YXRlLT51
YXBpLmFjdGl2ZTsKIAljcnRjX3N0YXRlLT5ody5waXBlX21vZGUgPSBjcnRjX3N0YXRlLT5ody5h
ZGp1c3RlZF9tb2RlID0gY3J0Y19zdGF0ZS0+dWFwaS5hZGp1c3RlZF9tb2RlOwotCWludGVsX2Ny
dGNfY29weV91YXBpX3RvX2h3X3N0YXRlX25vbW9kZXNldChjcnRjX3N0YXRlKTsKKwlpbnRlbF9j
cnRjX2NvcHlfdWFwaV90b19od19zdGF0ZV9ub21vZGVzZXQoc3RhdGUsIGNydGNfc3RhdGUpOwog
fQogCiBzdGF0aWMgdm9pZCBpbnRlbF9jcnRjX2NvcHlfaHdfdG9fdWFwaV9zdGF0ZShzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKQEAgLTEyNjYwLDcgKzEyNjkwLDQ5IEBAIHN0
YXRpYyB2b2lkIGludGVsX2NydGNfY29weV9od190b191YXBpX3N0YXRlKHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlCiB9CiAKIHN0YXRpYyBpbnQKLWludGVsX2NydGNfcHJlcGFy
ZV9jbGVhcmVkX3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQorY29w
eV9iaWdqb2luZXJfY3J0Y19zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSwKKwkJCSAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmZyb21fY3J0Y19zdGF0ZSkK
K3sKKwlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqc2F2ZWRfc3RhdGU7CisJc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CisKKwlz
YXZlZF9zdGF0ZSA9IGttZW1kdXAoZnJvbV9jcnRjX3N0YXRlLCBzaXplb2YoKnNhdmVkX3N0YXRl
KSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFzYXZlZF9zdGF0ZSkKKwkJcmV0dXJuIC1FTk9NRU07CisK
KwlzYXZlZF9zdGF0ZS0+dWFwaSA9IGNydGNfc3RhdGUtPnVhcGk7CisJc2F2ZWRfc3RhdGUtPnNj
YWxlcl9zdGF0ZSA9IGNydGNfc3RhdGUtPnNjYWxlcl9zdGF0ZTsKKwlzYXZlZF9zdGF0ZS0+c2hh
cmVkX2RwbGwgPSBjcnRjX3N0YXRlLT5zaGFyZWRfZHBsbDsKKwlzYXZlZF9zdGF0ZS0+ZHBsbF9o
d19zdGF0ZSA9IGNydGNfc3RhdGUtPmRwbGxfaHdfc3RhdGU7CisJc2F2ZWRfc3RhdGUtPmNyY19l
bmFibGVkID0gY3J0Y19zdGF0ZS0+Y3JjX2VuYWJsZWQ7CisKKwlpbnRlbF9jcnRjX2ZyZWVfaHdf
c3RhdGUoY3J0Y19zdGF0ZSk7CisJbWVtY3B5KGNydGNfc3RhdGUsIHNhdmVkX3N0YXRlLCBzaXpl
b2YoKmNydGNfc3RhdGUpKTsKKwlrZnJlZShzYXZlZF9zdGF0ZSk7CisKKwkvKiBSZS1pbml0IGh3
IHN0YXRlICovCisJbWVtc2V0KCZjcnRjX3N0YXRlLT5odywgMCwgc2l6ZW9mKHNhdmVkX3N0YXRl
LT5odykpOworCWNydGNfc3RhdGUtPmh3LmVuYWJsZSA9IGZyb21fY3J0Y19zdGF0ZS0+aHcuZW5h
YmxlOworCWNydGNfc3RhdGUtPmh3LmFjdGl2ZSA9IGZyb21fY3J0Y19zdGF0ZS0+aHcuYWN0aXZl
OworCWNydGNfc3RhdGUtPmh3LnBpcGVfbW9kZSA9IGZyb21fY3J0Y19zdGF0ZS0+aHcucGlwZV9t
b2RlOworCWNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUgPSBmcm9tX2NydGNfc3RhdGUtPmh3
LmFkanVzdGVkX21vZGU7CisKKwkvKiBTb21lIGZpeHVwcyAqLworCWNydGNfc3RhdGUtPnVhcGku
bW9kZV9jaGFuZ2VkID0gZnJvbV9jcnRjX3N0YXRlLT51YXBpLm1vZGVfY2hhbmdlZDsKKwljcnRj
X3N0YXRlLT51YXBpLmNvbm5lY3RvcnNfY2hhbmdlZCA9IGZyb21fY3J0Y19zdGF0ZS0+dWFwaS5j
b25uZWN0b3JzX2NoYW5nZWQ7CisJY3J0Y19zdGF0ZS0+dWFwaS5hY3RpdmVfY2hhbmdlZCA9IGZy
b21fY3J0Y19zdGF0ZS0+dWFwaS5hY3RpdmVfY2hhbmdlZDsKKwljcnRjX3N0YXRlLT5udjEyX3Bs
YW5lcyA9IGNydGNfc3RhdGUtPmM4X3BsYW5lcyA9IGNydGNfc3RhdGUtPnVwZGF0ZV9wbGFuZXMg
PSAwOworCWNydGNfc3RhdGUtPmJpZ2pvaW5lcl9saW5rZWRfY3J0YyA9IHRvX2ludGVsX2NydGMo
ZnJvbV9jcnRjX3N0YXRlLT51YXBpLmNydGMpOworCWNydGNfc3RhdGUtPmJpZ2pvaW5lcl9zbGF2
ZSA9IHRydWU7CisJY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXIgPSAoZW51bSB0cmFuc2NvZGVy
KWNydGMtPnBpcGU7CisJY3J0Y19zdGF0ZS0+aGFzX2F1ZGlvID0gZmFsc2U7CisKKwlyZXR1cm4g
MDsKK30KKworc3RhdGljIGludAoraW50ZWxfY3J0Y19wcmVwYXJlX2NsZWFyZWRfc3RhdGUoc3Ry
dWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCisJCQkJIHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
CiAJCXRvX2k5MTUoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXYpOwpAQCAtMTI3MDMsMTYgKzEy
Nzc1LDE2IEBAIGludGVsX2NydGNfcHJlcGFyZV9jbGVhcmVkX3N0YXRlKHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCWNydGNfc3RhdGUtPnVhcGkubW9kZS5wcml2YXRlX2Zs
YWdzID0gMDsKIAljcnRjX3N0YXRlLT51YXBpLmFkanVzdGVkX21vZGUucHJpdmF0ZV9mbGFncyA9
IDA7CiAKLQlpbnRlbF9jcnRjX2NvcHlfdWFwaV90b19od19zdGF0ZShjcnRjX3N0YXRlKTsKKwlp
bnRlbF9jcnRjX2NvcHlfdWFwaV90b19od19zdGF0ZShzdGF0ZSwgY3J0Y19zdGF0ZSk7CiAKIAly
ZXR1cm4gMDsKIH0KIAogc3RhdGljIGludAotaW50ZWxfbW9kZXNldF9waXBlX2NvbmZpZyhzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCitpbnRlbF9tb2Rlc2V0X3BpcGVfY29u
ZmlnKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAorCQkJICBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7CiAJc3RydWN0IGRybV9jcnRjICpjcnRjID0gcGlw
ZV9jb25maWctPnVhcGkuY3J0YzsKLQlzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUgPSBw
aXBlX2NvbmZpZy0+dWFwaS5zdGF0ZTsKIAlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsK
IAlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yOwogCXN0cnVjdCBkcm1fY29ubmVjdG9y
X3N0YXRlICpjb25uZWN0b3Jfc3RhdGU7CkBAIC0xMjc1NSw3ICsxMjgyNyw3IEBAIGludGVsX21v
ZGVzZXRfcGlwZV9jb25maWcoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQog
CQkJICAgICAgICZwaXBlX2NvbmZpZy0+cGlwZV9zcmNfdywKIAkJCSAgICAgICAmcGlwZV9jb25m
aWctPnBpcGVfc3JjX2gpOwogCi0JZm9yX2VhY2hfbmV3X2Nvbm5lY3Rvcl9pbl9zdGF0ZShzdGF0
ZSwgY29ubmVjdG9yLCBjb25uZWN0b3Jfc3RhdGUsIGkpIHsKKwlmb3JfZWFjaF9uZXdfY29ubmVj
dG9yX2luX3N0YXRlKCZzdGF0ZS0+YmFzZSwgY29ubmVjdG9yLCBjb25uZWN0b3Jfc3RhdGUsIGkp
IHsKIAkJaWYgKGNvbm5lY3Rvcl9zdGF0ZS0+Y3J0YyAhPSBjcnRjKQogCQkJY29udGludWU7CiAK
QEAgLTEyODAwLDcgKzEyODcyLDcgQEAgaW50ZWxfbW9kZXNldF9waXBlX2NvbmZpZyhzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiAJICogYWRqdXN0IGl0IGFjY29yZGluZyB0
byBsaW1pdGF0aW9ucyBvciBjb25uZWN0b3IgcHJvcGVydGllcywgYW5kIGFsc28KIAkgKiBhIGNo
YW5jZSB0byByZWplY3QgdGhlIG1vZGUgZW50aXJlbHkuCiAJICovCi0JZm9yX2VhY2hfbmV3X2Nv
bm5lY3Rvcl9pbl9zdGF0ZShzdGF0ZSwgY29ubmVjdG9yLCBjb25uZWN0b3Jfc3RhdGUsIGkpIHsK
Kwlmb3JfZWFjaF9uZXdfY29ubmVjdG9yX2luX3N0YXRlKCZzdGF0ZS0+YmFzZSwgY29ubmVjdG9y
LCBjb25uZWN0b3Jfc3RhdGUsIGkpIHsKIAkJaWYgKGNvbm5lY3Rvcl9zdGF0ZS0+Y3J0YyAhPSBj
cnRjKQogCQkJY29udGludWU7CiAKQEAgLTEyODUzLDggKzEyOTI1LDYgQEAgaW50ZWxfbW9kZXNl
dF9waXBlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiAJICov
CiAJcGlwZV9jb25maWctPnVhcGkuYWRqdXN0ZWRfbW9kZSA9IHBpcGVfY29uZmlnLT5ody5hZGp1
c3RlZF9tb2RlOwogCi0JLyogd2l0aG91dCBiaWdqb2luZXIsIHBpcGVfbW9kZSA9PSBhZGp1c3Rl
ZF9tb2RlICovCi0JcGlwZV9jb25maWctPmh3LnBpcGVfbW9kZSA9IHBpcGVfY29uZmlnLT5ody5h
ZGp1c3RlZF9tb2RlOwogCXJldHVybiAwOwogfQogCkBAIC0xNDA5MSw2ICsxNDE2MSw3NCBAQCBz
dGF0aWMgaW50IGludGVsX2F0b21pY19jaGVja19jcnRjcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0
YXRlICpzdGF0ZSkKIAlyZXR1cm4gMDsKIH0KIAorc3RhdGljIGludCBpbnRlbF9hdG9taWNfY2hl
Y2tfYmlnam9pbmVyKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAorCQkJCQlzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YywKKwkJCQkJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9j
cnRjX3N0YXRlLAorCQkJCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUp
Cit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShzdGF0ZS0+
YmFzZS5kZXYpOworCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpzbGF2ZV9jcnRjX3N0YXRlLCAq
bWFzdGVyX2NydGNfc3RhdGU7CisJc3RydWN0IGludGVsX2NydGMgKnNsYXZlLCAqbWFzdGVyOwor
CisJLyogc2xhdmUgYmVpbmcgZW5hYmxlZCwgaXMgbWFzdGVyIGlzIHN0aWxsIGNsYWltaW5nIHRo
aXMgY3J0Yz8gKi8KKwlpZiAob2xkX2NydGNfc3RhdGUtPmJpZ2pvaW5lcl9zbGF2ZSkgeworCQlz
bGF2ZSA9IGNydGM7CisJCW1hc3RlciA9IG9sZF9jcnRjX3N0YXRlLT5iaWdqb2luZXJfbGlua2Vk
X2NydGM7CisJCW1hc3Rlcl9jcnRjX3N0YXRlID0gaW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19z
dGF0ZShzdGF0ZSwgbWFzdGVyKTsKKwkJaWYgKCFtYXN0ZXJfY3J0Y19zdGF0ZSB8fCAhbmVlZHNf
bW9kZXNldChtYXN0ZXJfY3J0Y19zdGF0ZSkpCisJCQlnb3RvIGNsYWltZWQ7CisJfQorCisJaWYg
KCFuZXdfY3J0Y19zdGF0ZS0+Ymlnam9pbmVyKQorCQlyZXR1cm4gMDsKKworCWlmICgxICsgY3J0
Yy0+cGlwZSA+PSBJTlRFTF9OVU1fUElQRVMoZGV2X3ByaXYpKSB7CisJCURSTV9ERUJVR19LTVMo
IltDUlRDOiVkOiVzXSBCaWcgam9pbmVyIGNvbmZpZ3VyYXRpb24gcmVxdWlyZXMgIgorCQkJICAg
ICAgIkNSVEMgKyAxIHRvIGJlIHVzZWQsIGRvZXNuJ3QgZXhpc3RcbiIsCisJCQkgICAgICBjcnRj
LT5iYXNlLmJhc2UuaWQsIGNydGMtPmJhc2UubmFtZSk7CisJCXJldHVybiAtRUlOVkFMOworCX0K
KworCXNsYXZlID0gbmV3X2NydGNfc3RhdGUtPmJpZ2pvaW5lcl9saW5rZWRfY3J0YyA9CisJCWlu
dGVsX2dldF9jcnRjX2Zvcl9waXBlKGRldl9wcml2LCBjcnRjLT5waXBlICsgMSk7CisJc2xhdmVf
Y3J0Y19zdGF0ZSA9IGludGVsX2F0b21pY19nZXRfY3J0Y19zdGF0ZSgmc3RhdGUtPmJhc2UsIHNs
YXZlKTsKKwltYXN0ZXIgPSBjcnRjOworCWlmIChJU19FUlIoc2xhdmVfY3J0Y19zdGF0ZSkpCisJ
CXJldHVybiBQVFJfRVJSKHNsYXZlX2NydGNfc3RhdGUpOworCisJLyogbWFzdGVyIGJlaW5nIGVu
YWJsZWQsIHNsYXZlIHdhcyBhbHJlYWR5IGNvbmZpZ3VyZWQ/ICovCisJaWYgKHNsYXZlX2NydGNf
c3RhdGUtPnVhcGkuZW5hYmxlKQorCQlnb3RvIGNsYWltZWQ7CisKKwlEUk1fREVCVUdfS01TKCJb
Q1JUQzolZDolc10gVXNlZCBhcyBzbGF2ZSBmb3IgYmlnIGpvaW5lclxuIiwKKwkJICAgICAgc2xh
dmUtPmJhc2UuYmFzZS5pZCwgc2xhdmUtPmJhc2UubmFtZSk7CisJcmV0dXJuIGNvcHlfYmlnam9p
bmVyX2NydGNfc3RhdGUoc2xhdmVfY3J0Y19zdGF0ZSwgbmV3X2NydGNfc3RhdGUpOworCitjbGFp
bWVkOgorCURSTV9ERUJVR19LTVMoIltDUlRDOiVkOiVzXSBTbGF2ZSBpcyBlbmFibGVkIGFzIG5v
cm1hbCBDUlRDLCBidXQgIgorCQkgICAgICAiW0NSVEM6JWQ6JXNdIGNsYWltaW5nIHRoaXMgQ1JU
QyBmb3IgYmlnam9pbmVyLlxuIiwKKwkJICAgICAgc2xhdmUtPmJhc2UuYmFzZS5pZCwgc2xhdmUt
PmJhc2UubmFtZSwKKwkJICAgICAgbWFzdGVyLT5iYXNlLmJhc2UuaWQsIG1hc3Rlci0+YmFzZS5u
YW1lKTsKKwlyZXR1cm4gLUVJTlZBTDsKK30KKworc3RhdGljIGludCBraWxsX2JpZ2pvaW5lcl9z
bGF2ZShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKKwkJCQlzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqbWFzdGVyX2NydGNfc3RhdGUpCit7CisJc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKnNsYXZlX2NydGNfc3RhdGUgPQorCQlpbnRlbF9hdG9taWNfZ2V0X2NydGNfc3RhdGUoJnN0
YXRlLT5iYXNlLAorCQkJbWFzdGVyX2NydGNfc3RhdGUtPmJpZ2pvaW5lcl9saW5rZWRfY3J0Yyk7
CisKKwlpZiAoSVNfRVJSKHNsYXZlX2NydGNfc3RhdGUpKQorCQlyZXR1cm4gUFRSX0VSUihzbGF2
ZV9jcnRjX3N0YXRlKTsKKworCXNsYXZlX2NydGNfc3RhdGUtPmJpZ2pvaW5lciA9IG1hc3Rlcl9j
cnRjX3N0YXRlLT5iaWdqb2luZXIgPSBmYWxzZTsKKwlzbGF2ZV9jcnRjX3N0YXRlLT5iaWdqb2lu
ZXJfc2xhdmUgPSBtYXN0ZXJfY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX3NsYXZlID0gZmFsc2U7CisJ
c2xhdmVfY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX2xpbmtlZF9jcnRjID0gbWFzdGVyX2NydGNfc3Rh
dGUtPmJpZ2pvaW5lcl9saW5rZWRfY3J0YyA9IE5VTEw7CisJaW50ZWxfY3J0Y19jb3B5X3VhcGlf
dG9faHdfc3RhdGUoc3RhdGUsIHNsYXZlX2NydGNfc3RhdGUpOworCXJldHVybiAwOworfQorCiAv
KioKICAqIGludGVsX2F0b21pY19jaGVjayAtIHZhbGlkYXRlIHN0YXRlIG9iamVjdAogICogQGRl
djogZHJtIGRldmljZQpAQCAtMTQxMjIsMjMgKzE0MjYwLDMxIEBAIHN0YXRpYyBpbnQgaW50ZWxf
YXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJCQkJCSAgICBuZXdfY3J0Y19z
dGF0ZSwgaSkgewogCQlpZiAoIW5lZWRzX21vZGVzZXQobmV3X2NydGNfc3RhdGUpKSB7CiAJCQkv
KiBMaWdodCBjb3B5ICovCi0JCQlpbnRlbF9jcnRjX2NvcHlfdWFwaV90b19od19zdGF0ZV9ub21v
ZGVzZXQobmV3X2NydGNfc3RhdGUpOworCQkJaW50ZWxfY3J0Y19jb3B5X3VhcGlfdG9faHdfc3Rh
dGVfbm9tb2Rlc2V0KHN0YXRlLCBuZXdfY3J0Y19zdGF0ZSk7CiAKIAkJCWNvbnRpbnVlOwogCQl9
CiAKLQkJaWYgKCFuZXdfY3J0Y19zdGF0ZS0+dWFwaS5lbmFibGUpIHsKLQkJCWludGVsX2NydGNf
Y29weV91YXBpX3RvX2h3X3N0YXRlKG5ld19jcnRjX3N0YXRlKTsKKwkJLyogS2lsbCBvbGQgYmln
am9pbmVyIGxpbmssIHdlIG1heSByZS1lc3RhYmxpc2ggYWZ0ZXJ3YXJkcyAqLworCQlpZiAob2xk
X2NydGNfc3RhdGUtPmJpZ2pvaW5lciAmJiAhb2xkX2NydGNfc3RhdGUtPmJpZ2pvaW5lcl9zbGF2
ZSkgeworCQkJcmV0ID0ga2lsbF9iaWdqb2luZXJfc2xhdmUoc3RhdGUsIG5ld19jcnRjX3N0YXRl
KTsKKwkJCWlmIChyZXQpCisJCQkJZ290byBmYWlsOworCQl9CiAKLQkJCWFueV9tcyA9IHRydWU7
CisJCWlmICghbmV3X2NydGNfc3RhdGUtPnVhcGkuZW5hYmxlKSB7CisJCQlpZiAoIW5ld19jcnRj
X3N0YXRlLT5iaWdqb2luZXJfc2xhdmUpIHsKKwkJCQlpbnRlbF9jcnRjX2NvcHlfdWFwaV90b19o
d19zdGF0ZShzdGF0ZSwgbmV3X2NydGNfc3RhdGUpOworCQkJCWFueV9tcyA9IHRydWU7CisJCQl9
CiAJCQljb250aW51ZTsKIAkJfQogCi0JCXJldCA9IGludGVsX2NydGNfcHJlcGFyZV9jbGVhcmVk
X3N0YXRlKG5ld19jcnRjX3N0YXRlKTsKKwkJcmV0ID0gaW50ZWxfY3J0Y19wcmVwYXJlX2NsZWFy
ZWRfc3RhdGUoc3RhdGUsIG5ld19jcnRjX3N0YXRlKTsKIAkJaWYgKHJldCkKIAkJCWdvdG8gZmFp
bDsKIAotCQlyZXQgPSBpbnRlbF9tb2Rlc2V0X3BpcGVfY29uZmlnKG5ld19jcnRjX3N0YXRlKTsK
KwkJcmV0ID0gaW50ZWxfbW9kZXNldF9waXBlX2NvbmZpZyhzdGF0ZSwgbmV3X2NydGNfc3RhdGUp
OwogCQlpZiAocmV0KQogCQkJZ290byBmYWlsOwogCkBAIC0xNDE0Niw2ICsxNDI5MiwxMCBAQCBz
dGF0aWMgaW50IGludGVsX2F0b21pY19jaGVjayhzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCiAJ
CWlmIChuZWVkc19tb2Rlc2V0KG5ld19jcnRjX3N0YXRlKSkKIAkJCWFueV9tcyA9IHRydWU7CisK
KwkJcmV0ID0gaW50ZWxfYXRvbWljX2NoZWNrX2JpZ2pvaW5lcihzdGF0ZSwgY3J0Yywgb2xkX2Ny
dGNfc3RhdGUsIG5ld19jcnRjX3N0YXRlKTsKKwkJaWYgKHJldCkKKwkJCWdvdG8gZmFpbDsKIAl9
CiAKIAlpZiAoYW55X21zICYmICFjaGVja19kaWdpdGFsX3BvcnRfY29uZmxpY3RzKHN0YXRlKSkg
ewpAQCAtMTQzNTAsNyArMTQ1MDAsOSBAQCBzdGF0aWMgdm9pZCBpbnRlbF91cGRhdGVfY3J0Yyhz
dHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAogCWNvbW1pdF9waXBlX2NvbmZpZyhzdGF0ZSwgb2xk
X2NydGNfc3RhdGUsIG5ld19jcnRjX3N0YXRlKTsKIAotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYp
ID49IDkpCisJaWYgKG5ld19jcnRjX3N0YXRlLT5iaWdqb2luZXIpCisJCXsvKiBOb3Qgc3VwcG9y
dGVkIHlldCAqL30KKwllbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkpCiAJCXNrbF91
cGRhdGVfcGxhbmVzX29uX2NydGMoc3RhdGUsIGNydGMpOwogCWVsc2UKIAkJaTl4eF91cGRhdGVf
cGxhbmVzX29uX2NydGMoc3RhdGUsIGNydGMpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaAppbmRleCA3ZjQ2YzE2NDZkM2YuLmNmMmVj
ZmExNzQxNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
aXNwbGF5X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
aXNwbGF5X3R5cGVzLmgKQEAgLTEwNDQsNiArMTA0NCwxNSBAQCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSB7CiAJLyogZW5hYmxlIHBpcGUgY3NjPyAqLwogCWJvb2wgY3NjX2VuYWJsZTsKIAorCS8q
IGVuYWJsZSBwaXBlIGJpZyBqb2luZXI/ICovCisJYm9vbCBiaWdqb2luZXI7CisKKwkvKiBiaWcg
am9pbmVyIHNsYXZlIGNydGM/ICovCisJYm9vbCBiaWdqb2luZXJfc2xhdmU7CisKKwkvKiBsaW5r
ZWQgY3J0YyBmb3IgYmlnam9pbmVyLCBlaXRoZXIgc2xhdmUgb3IgbWFzdGVyICovCisJc3RydWN0
IGludGVsX2NydGMgKmJpZ2pvaW5lcl9saW5rZWRfY3J0YzsKKwogCS8qIERpc3BsYXkgU3RyZWFt
IGNvbXByZXNzaW9uIHN0YXRlICovCiAJc3RydWN0IHsKIAkJYm9vbCBjb21wcmVzc2lvbl9lbmFi
bGU7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMKaW5kZXggOWI3ZGY4ZTg1
ZWEyLi41NGZkZTRjNGM0ZGQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZHAuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rw
LmMKQEAgLTIxNDcsNiArMjE0NywxNSBAQCBzdGF0aWMgaW50IGludGVsX2RwX2RzY19jb21wdXRl
X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCXBpcGVfY29uZmlnLT5wb3J0X2Ns
b2NrID0gaW50ZWxfZHAtPmNvbW1vbl9yYXRlc1tsaW1pdHMtPm1heF9jbG9ja107CiAJcGlwZV9j
b25maWctPmxhbmVfY291bnQgPSBsaW1pdHMtPm1heF9sYW5lX2NvdW50OwogCisJaWYgKGFkanVz
dGVkX21vZGUtPmNydGNfY2xvY2sgPiBpbnRlbF9kcF9tYXhfZG90Y2xvY2soaW50ZWxfZHAsIGZh
bHNlKSkgeworCQlpZiAoYWRqdXN0ZWRfbW9kZS0+Y3J0Y19jbG9jayA+IGludGVsX2RwX21heF9k
b3RjbG9jayhpbnRlbF9kcCwgdHJ1ZSkpIHsKKwkJCURSTV9ERUJVR19LTVMoIkNsb2NrIHJhdGUg
dG9vIGhpZ2ggZm9yIGJpZyBqb2luZXJcbiIpOworCQkJcmV0dXJuIC1FSU5WQUw7CisJCX0KKwkJ
cGlwZV9jb25maWctPmJpZ2pvaW5lciA9IHRydWU7CisJCURSTV9ERUJVR19LTVMoIlVzaW5nIGJp
Z2pvaW5lciBjb25maWd1cmF0aW9uXG4iKTsKKwl9CisKIAlpZiAoaW50ZWxfZHBfaXNfZWRwKGlu
dGVsX2RwKSkgewogCQlwaXBlX2NvbmZpZy0+ZHNjLmNvbXByZXNzZWRfYnBwID0KIAkJCW1pbl90
KHUxNiwgZHJtX2VkcF9kc2Nfc2lua19vdXRwdXRfYnBwKGludGVsX2RwLT5kc2NfZHBjZCkgPj4g
NCwKQEAgLTIxNjQsMTIgKzIxNzMsMTIgQEAgc3RhdGljIGludCBpbnRlbF9kcF9kc2NfY29tcHV0
ZV9jb25maWcoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJCQkJCSAgICBwaXBlX2NvbmZp
Zy0+bGFuZV9jb3VudCwKIAkJCQkJCSAgICBhZGp1c3RlZF9tb2RlLT5jcnRjX2Nsb2NrLAogCQkJ
CQkJICAgIGFkanVzdGVkX21vZGUtPmNydGNfaGRpc3BsYXksCi0JCQkJCQkgICAgZmFsc2UpOwor
CQkJCQkJICAgIHBpcGVfY29uZmlnLT5iaWdqb2luZXIpOwogCQlkc2NfZHBfc2xpY2VfY291bnQg
PQogCQkJaW50ZWxfZHBfZHNjX2dldF9zbGljZV9jb3VudChpbnRlbF9kcCwKIAkJCQkJCSAgICAg
YWRqdXN0ZWRfbW9kZS0+Y3J0Y19jbG9jaywKIAkJCQkJCSAgICAgYWRqdXN0ZWRfbW9kZS0+Y3J0
Y19oZGlzcGxheSwKLQkJCQkJCSAgICAgZmFsc2UpOworCQkJCQkJICAgICBwaXBlX2NvbmZpZy0+
Ymlnam9pbmVyKTsKIAkJaWYgKCFkc2NfbWF4X291dHB1dF9icHAgfHwgIWRzY19kcF9zbGljZV9j
b3VudCkgewogCQkJRFJNX0RFQlVHX0tNUygiQ29tcHJlc3NlZCBCUFAvU2xpY2UgQ291bnQgbm90
IHN1cHBvcnRlZFxuIik7CiAJCQlyZXR1cm4gLUVJTlZBTDsKQEAgLTIxODQsMTMgKzIxOTMsMTQg
QEAgc3RhdGljIGludCBpbnRlbF9kcF9kc2NfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2Rw
ICppbnRlbF9kcCwKIAkgKiBpcyBncmVhdGVyIHRoYW4gdGhlIG1heGltdW0gQ2RjbG9jayBhbmQg
aWYgc2xpY2UgY291bnQgaXMgZXZlbgogCSAqIHRoZW4gd2UgbmVlZCB0byB1c2UgMiBWRFNDIGlu
c3RhbmNlcy4KIAkgKi8KLQlpZiAoYWRqdXN0ZWRfbW9kZS0+Y3J0Y19jbG9jayA+IGRldl9wcml2
LT5tYXhfY2RjbGtfZnJlcSkgewotCQlpZiAocGlwZV9jb25maWctPmRzYy5zbGljZV9jb3VudCA+
IDEpIHsKLQkJCXBpcGVfY29uZmlnLT5kc2MuZHNjX3NwbGl0ID0gdHJ1ZTsKLQkJfSBlbHNlIHsK
KwlpZiAoYWRqdXN0ZWRfbW9kZS0+Y3J0Y19jbG9jayA+IGRldl9wcml2LT5tYXhfY2RjbGtfZnJl
cSB8fAorCSAgICBwaXBlX2NvbmZpZy0+Ymlnam9pbmVyKSB7CisJCWlmIChwaXBlX2NvbmZpZy0+
ZHNjLnNsaWNlX2NvdW50IDwgMikgewogCQkJRFJNX0RFQlVHX0tNUygiQ2Fubm90IHNwbGl0IHN0
cmVhbSB0byB1c2UgMiBWRFNDIGluc3RhbmNlc1xuIik7CiAJCQlyZXR1cm4gLUVJTlZBTDsKIAkJ
fQorCisJCXBpcGVfY29uZmlnLT5kc2MuZHNjX3NwbGl0ID0gdHJ1ZTsKIAl9CiAKIAlyZXQgPSBp
bnRlbF9kc2NfY29tcHV0ZV9wYXJhbXMoJmRpZ19wb3J0LT5iYXNlLCBwaXBlX2NvbmZpZyk7Ci0t
IAoyLjI0LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
CkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpo
dHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 56FAE29358
	for <lists+intel-gfx@lfdr.de>; Fri, 24 May 2019 10:45:25 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B4A706E0A0;
	Fri, 24 May 2019 08:45:23 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 13F8E6E0A0;
 Fri, 24 May 2019 08:45:21 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16664833-1500050 
 for multiple; Fri, 24 May 2019 09:45:10 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 24 May 2019 09:45:08 +0100
Message-Id: <20190524084508.28885-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190524072551.24429-1-chris@chris-wilson.co.uk>
References: <20190524072551.24429-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t v2] benchmarks/gem_wsim: Manually
 calculate VLA struct sizes
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QXBwYXJlbnRseSBWTEEgc3RydWN0cyAoZS5nLiBzdHJ1Y3QgeyBpbnQgYXJyYXlbY291bnRdIH0p
IGlzIGEgZ2NjCmV4dGVuc2lvbiB0aGF0IGNsYW5nIHJlZnVzZXMgdG8gc3VwcG9ydCBhcyBoYW5k
bGluZyBtZW1vcnkgbGF5b3V0IGlzIHRvbwpkaWZmaWN1bHQgZm9yIGl0LiBTbyBjYWxjdWxhdGUg
dGhlIHNpemUgYnkgaGFuZCEKCnYyOiBVc2UgYWxsb2NhKCkuCgpTaWduZWQtb2ZmLWJ5OiBDaHJp
cyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IFR2cnRrbyBVcnN1bGluIDx0
dnJ0a28udXJzdWxpbkBpbnRlbC5jb20+Ci0tLQogYmVuY2htYXJrcy9nZW1fd3NpbS5jIHwgMTE1
ICsrKysrKysrKysrKysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5n
ZWQsIDY0IGluc2VydGlvbnMoKyksIDUxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2JlbmNo
bWFya3MvZ2VtX3dzaW0uYyBiL2JlbmNobWFya3MvZ2VtX3dzaW0uYwppbmRleCBlMmZmYjkzYTku
LmRiMTk5MjViMSAxMDA2NDQKLS0tIGEvYmVuY2htYXJrcy9nZW1fd3NpbS5jCisrKyBiL2JlbmNo
bWFya3MvZ2VtX3dzaW0uYwpAQCAtMTQ0MSw2ICsxNDQxLDI5IEBAIHNldF9jdHhfc3NldShzdHJ1
Y3QgY3R4ICpjdHgsIHVpbnQ2NF90IHNsaWNlX21hc2spCiAJcmV0dXJuIHNsaWNlX21hc2s7CiB9
CiAKK3N0YXRpYyBzaXplX3Qgc2l6ZW9mX2xvYWRfYmFsYW5jZShpbnQgY291bnQpCit7CisJc3Ry
dWN0IGk5MTVfY29udGV4dF9lbmdpbmVzX2xvYWRfYmFsYW5jZSAqcHRyOworCisJcmV0dXJuIHNp
emVvZigqcHRyKSArIGNvdW50ICogc2l6ZW9mKHB0ci0+ZW5naW5lc1swXSk7Cit9CisKK3N0YXRp
YyBzaXplX3Qgc2l6ZW9mX3BhcmFtX2VuZ2luZXMoaW50IGNvdW50KQoreworCXN0cnVjdCBpOTE1
X2NvbnRleHRfcGFyYW1fZW5naW5lcyAqcHRyOworCisJcmV0dXJuIHNpemVvZigqcHRyKSArIGNv
dW50ICogc2l6ZW9mKHB0ci0+ZW5naW5lc1swXSk7Cit9CisKK3N0YXRpYyBzaXplX3Qgc2l6ZW9m
X2VuZ2luZXNfYm9uZChpbnQgY291bnQpCit7CisJc3RydWN0IGk5MTVfY29udGV4dF9lbmdpbmVz
X2JvbmQgKnB0cjsKKworCXJldHVybiBzaXplb2YoKnB0cikgKyBjb3VudCAqIHNpemVvZihwdHIt
PmVuZ2luZXNbMF0pOworfQorCisjZGVmaW5lIGFsbG9jYTAoc3opICh7IHNpemVfdCBzel9fID0g
KHN6KTsgbWVtc2V0KGFsbG9jYShzel9fKSwgMCwgc3pfXyk7IH0pCisKIHN0YXRpYyBpbnQKIHBy
ZXBhcmVfd29ya2xvYWQodW5zaWduZWQgaW50IGlkLCBzdHJ1Y3Qgd29ya2xvYWQgKndyaywgdW5z
aWduZWQgaW50IGZsYWdzKQogewpAQCAtMTY3Niw2NiArMTY5OSw1NCBAQCBwcmVwYXJlX3dvcmts
b2FkKHVuc2lnbmVkIGludCBpZCwgc3RydWN0IHdvcmtsb2FkICp3cmssIHVuc2lnbmVkIGludCBm
bGFncykKIAkJfQogCiAJCWlmIChjdHgtPmVuZ2luZV9tYXApIHsKLQkJCUk5MTVfREVGSU5FX0NP
TlRFWFRfUEFSQU1fRU5HSU5FUyhzZXRfZW5naW5lcywKLQkJCQkJCQkgIGN0eC0+ZW5naW5lX21h
cF9jb3VudCArIDEpOwotCQkJSTkxNV9ERUZJTkVfQ09OVEVYVF9FTkdJTkVTX0xPQURfQkFMQU5D
RShsb2FkX2JhbGFuY2UsCi0JCQkJCQkJCSBjdHgtPmVuZ2luZV9tYXBfY291bnQpOworCQkJc3Ry
dWN0IGk5MTVfY29udGV4dF9wYXJhbV9lbmdpbmVzICpzZXRfZW5naW5lcyA9CisJCQkJYWxsb2Nh
MChzaXplb2ZfcGFyYW1fZW5naW5lcyhjdHgtPmVuZ2luZV9tYXBfY291bnQgKyAxKSk7CisJCQlz
dHJ1Y3QgaTkxNV9jb250ZXh0X2VuZ2luZXNfbG9hZF9iYWxhbmNlICpsb2FkX2JhbGFuY2UgPQor
CQkJCWFsbG9jYTAoc2l6ZW9mX2xvYWRfYmFsYW5jZShjdHgtPmVuZ2luZV9tYXBfY291bnQpKTsK
IAkJCXN0cnVjdCBkcm1faTkxNV9nZW1fY29udGV4dF9wYXJhbSBwYXJhbSA9IHsKIAkJCQkuY3R4
X2lkID0gY3R4X2lkLAogCQkJCS5wYXJhbSA9IEk5MTVfQ09OVEVYVF9QQVJBTV9FTkdJTkVTLAot
CQkJCS5zaXplID0gc2l6ZW9mKHNldF9lbmdpbmVzKSwKLQkJCQkudmFsdWUgPSB0b191c2VyX3Bv
aW50ZXIoJnNldF9lbmdpbmVzKSwKKwkJCQkuc2l6ZSA9IHNpemVvZl9wYXJhbV9lbmdpbmVzKGN0
eC0+ZW5naW5lX21hcF9jb3VudCArIDEpLAorCQkJCS52YWx1ZSA9IHRvX3VzZXJfcG9pbnRlcihz
ZXRfZW5naW5lcyksCiAJCQl9OworCQkJc3RydWN0IGk5MTVfY29udGV4dF9lbmdpbmVzX2JvbmQg
Kmxhc3QgPSBOVUxMOwogCiAJCQlpZiAoY3R4LT53YW50c19iYWxhbmNlKSB7Ci0JCQkJc2V0X2Vu
Z2luZXMuZXh0ZW5zaW9ucyA9Ci0JCQkJCXRvX3VzZXJfcG9pbnRlcigmbG9hZF9iYWxhbmNlKTsK
KwkJCQlzZXRfZW5naW5lcy0+ZXh0ZW5zaW9ucyA9CisJCQkJCXRvX3VzZXJfcG9pbnRlcihsb2Fk
X2JhbGFuY2UpOwogCi0JCQkJbWVtc2V0KCZsb2FkX2JhbGFuY2UsIDAsIHNpemVvZihsb2FkX2Jh
bGFuY2UpKTsKLQkJCQlsb2FkX2JhbGFuY2UuYmFzZS5uYW1lID0KKwkJCQlsb2FkX2JhbGFuY2Ut
PmJhc2UubmFtZSA9CiAJCQkJCUk5MTVfQ09OVEVYVF9FTkdJTkVTX0VYVF9MT0FEX0JBTEFOQ0U7
Ci0JCQkJbG9hZF9iYWxhbmNlLm51bV9zaWJsaW5ncyA9CisJCQkJbG9hZF9iYWxhbmNlLT5udW1f
c2libGluZ3MgPQogCQkJCQljdHgtPmVuZ2luZV9tYXBfY291bnQ7CiAKIAkJCQlmb3IgKGogPSAw
OyBqIDwgY3R4LT5lbmdpbmVfbWFwX2NvdW50OyBqKyspCi0JCQkJCWxvYWRfYmFsYW5jZS5lbmdp
bmVzW2pdID0KKwkJCQkJbG9hZF9iYWxhbmNlLT5lbmdpbmVzW2pdID0KIAkJCQkJCWdldF9lbmdp
bmUoY3R4LT5lbmdpbmVfbWFwW2pdKTsKLQkJCX0gZWxzZSB7Ci0JCQkJc2V0X2VuZ2luZXMuZXh0
ZW5zaW9ucyA9IDA7CiAJCQl9CiAKIAkJCS8qIFJlc2VydmUgc2xvdCBmb3IgdmlydHVhbCBlbmdp
bmUuICovCi0JCQlzZXRfZW5naW5lcy5lbmdpbmVzWzBdLmVuZ2luZV9jbGFzcyA9CisJCQlzZXRf
ZW5naW5lcy0+ZW5naW5lc1swXS5lbmdpbmVfY2xhc3MgPQogCQkJCUk5MTVfRU5HSU5FX0NMQVNT
X0lOVkFMSUQ7Ci0JCQlzZXRfZW5naW5lcy5lbmdpbmVzWzBdLmVuZ2luZV9pbnN0YW5jZSA9CisJ
CQlzZXRfZW5naW5lcy0+ZW5naW5lc1swXS5lbmdpbmVfaW5zdGFuY2UgPQogCQkJCUk5MTVfRU5H
SU5FX0NMQVNTX0lOVkFMSURfTk9ORTsKIAogCQkJZm9yIChqID0gMTsgaiA8PSBjdHgtPmVuZ2lu
ZV9tYXBfY291bnQ7IGorKykKLQkJCQlzZXRfZW5naW5lcy5lbmdpbmVzW2pdID0KKwkJCQlzZXRf
ZW5naW5lcy0+ZW5naW5lc1tqXSA9CiAJCQkJCWdldF9lbmdpbmUoY3R4LT5lbmdpbmVfbWFwW2og
LSAxXSk7CiAKKwkJCWxhc3QgPSBOVUxMOwogCQkJZm9yIChqID0gMDsgaiA8IGN0eC0+Ym9uZF9j
b3VudDsgaisrKSB7CiAJCQkJdW5zaWduZWQgbG9uZyBtYXNrID0gY3R4LT5ib25kc1tqXS5tYXNr
OwotCQkJCUk5MTVfREVGSU5FX0NPTlRFWFRfRU5HSU5FU19CT05EKGJvbmQsCi0JCQkJCQkJCSBf
X2J1aWx0aW5fcG9wY291bnQobWFzaykpOwotCQkJCXN0cnVjdCBpOTE1X2NvbnRleHRfZW5naW5l
c19ib25kICpwID0gTlVMTCwgKnByZXY7CisJCQkJc3RydWN0IGk5MTVfY29udGV4dF9lbmdpbmVz
X2JvbmQgKmJvbmQgPQorCQkJCQlhbGxvY2EwKHNpemVvZl9lbmdpbmVzX2JvbmQoX19idWlsdGlu
X3BvcGNvdW50KG1hc2spKSk7CiAJCQkJdW5zaWduZWQgaW50IGIsIGU7CiAKLQkJCQlwcmV2ID0g
cDsKLQkJCQlwID0gYWxsb2NhKHNpemVvZihib25kKSk7Ci0JCQkJYXNzZXJ0KHApOwotCQkJCW1l
bXNldChwLCAwLCBzaXplb2YoYm9uZCkpOworCQkJCWJvbmQtPmJhc2UubmV4dF9leHRlbnNpb24g
PSB0b191c2VyX3BvaW50ZXIobGFzdCk7CisJCQkJYm9uZC0+YmFzZS5uYW1lID0gSTkxNV9DT05U
RVhUX0VOR0lORVNfRVhUX0JPTkQ7CiAKLQkJCQlpZiAoaiA9PSAwKQotCQkJCQlsb2FkX2JhbGFu
Y2UuYmFzZS5uZXh0X2V4dGVuc2lvbiA9Ci0JCQkJCQl0b191c2VyX3BvaW50ZXIocCk7Ci0JCQkJ
ZWxzZSBpZiAoaiA8IChjdHgtPmJvbmRfY291bnQgLSAxKSkKLQkJCQkJcHJldi0+YmFzZS5uZXh0
X2V4dGVuc2lvbiA9Ci0JCQkJCQl0b191c2VyX3BvaW50ZXIocCk7Ci0KLQkJCQlwLT5iYXNlLm5h
bWUgPSBJOTE1X0NPTlRFWFRfRU5HSU5FU19FWFRfQk9ORDsKLQkJCQlwLT52aXJ0dWFsX2luZGV4
ID0gMDsKLQkJCQlwLT5tYXN0ZXIgPSBnZXRfZW5naW5lKGN0eC0+Ym9uZHNbal0ubWFzdGVyKTsK
KwkJCQlib25kLT52aXJ0dWFsX2luZGV4ID0gMDsKKwkJCQlib25kLT5tYXN0ZXIgPSBnZXRfZW5n
aW5lKGN0eC0+Ym9uZHNbal0ubWFzdGVyKTsKIAogCQkJCWZvciAoYiA9IDAsIGUgPSAwOyBtYXNr
OyBlKyssIG1hc2sgPj49IDEpIHsKIAkJCQkJdW5zaWduZWQgaW50IGlkeDsKQEAgLTE3NDMsNDIg
KzE3NTQsNDQgQEAgcHJlcGFyZV93b3JrbG9hZCh1bnNpZ25lZCBpbnQgaWQsIHN0cnVjdCB3b3Jr
bG9hZCAqd3JrLCB1bnNpZ25lZCBpbnQgZmxhZ3MpCiAJCQkJCWlmICghKG1hc2sgJiAxKSkKIAkJ
CQkJCWNvbnRpbnVlOwogCi0JCQkJCWlkeCA9IGZpbmRfZW5naW5lKCZzZXRfZW5naW5lcy5lbmdp
bmVzWzFdLAorCQkJCQlpZHggPSBmaW5kX2VuZ2luZSgmc2V0X2VuZ2luZXMtPmVuZ2luZXNbMV0s
CiAJCQkJCQkJICBjdHgtPmVuZ2luZV9tYXBfY291bnQsCiAJCQkJCQkJICBlKTsKLQkJCQkJcC0+
ZW5naW5lc1tiKytdID0KLQkJCQkJCXNldF9lbmdpbmVzLmVuZ2luZXNbMSArIGlkeF07CisJCQkJ
CWJvbmQtPmVuZ2luZXNbYisrXSA9CisJCQkJCQlzZXRfZW5naW5lcy0+ZW5naW5lc1sxICsgaWR4
XTsKIAkJCQl9CisKKwkJCQlsYXN0ID0gYm9uZDsKIAkJCX0KKwkJCWxvYWRfYmFsYW5jZS0+YmFz
ZS5uZXh0X2V4dGVuc2lvbiA9IHRvX3VzZXJfcG9pbnRlcihsYXN0KTsKIAogCQkJZ2VtX2NvbnRl
eHRfc2V0X3BhcmFtKGZkLCAmcGFyYW0pOwogCQl9IGVsc2UgaWYgKGN0eC0+d2FudHNfYmFsYW5j
ZSkgewogCQkJY29uc3QgdW5zaWduZWQgaW50IGNvdW50ID0gbnVtX2VuZ2luZXNfaW5fY2xhc3Mo
VkNTKTsKLQkJCUk5MTVfREVGSU5FX0NPTlRFWFRfRU5HSU5FU19MT0FEX0JBTEFOQ0UobG9hZF9i
YWxhbmNlLAotCQkJCQkJCQkgY291bnQpOwotCQkJSTkxNV9ERUZJTkVfQ09OVEVYVF9QQVJBTV9F
TkdJTkVTKHNldF9lbmdpbmVzLAotCQkJCQkJCSAgY291bnQgKyAxKTsKKwkJCXN0cnVjdCBpOTE1
X2NvbnRleHRfZW5naW5lc19sb2FkX2JhbGFuY2UgKmxvYWRfYmFsYW5jZSA9CisJCQkJYWxsb2Nh
MChzaXplb2ZfbG9hZF9iYWxhbmNlKGNvdW50KSk7CisJCQlzdHJ1Y3QgaTkxNV9jb250ZXh0X3Bh
cmFtX2VuZ2luZXMgKnNldF9lbmdpbmVzID0KKwkJCQlhbGxvY2EwKHNpemVvZl9wYXJhbV9lbmdp
bmVzKGNvdW50ICsgMSkpOwogCQkJc3RydWN0IGRybV9pOTE1X2dlbV9jb250ZXh0X3BhcmFtIHBh
cmFtID0gewogCQkJCS5jdHhfaWQgPSBjdHhfaWQsCiAJCQkJLnBhcmFtID0gSTkxNV9DT05URVhU
X1BBUkFNX0VOR0lORVMsCi0JCQkJLnNpemUgPSBzaXplb2Yoc2V0X2VuZ2luZXMpLAotCQkJCS52
YWx1ZSA9IHRvX3VzZXJfcG9pbnRlcigmc2V0X2VuZ2luZXMpLAorCQkJCS5zaXplID0gc2l6ZW9m
X3BhcmFtX2VuZ2luZXMoY291bnQgKyAxKSwKKwkJCQkudmFsdWUgPSB0b191c2VyX3BvaW50ZXIo
c2V0X2VuZ2luZXMpLAogCQkJfTsKIAotCQkJc2V0X2VuZ2luZXMuZXh0ZW5zaW9ucyA9IHRvX3Vz
ZXJfcG9pbnRlcigmbG9hZF9iYWxhbmNlKTsKKwkJCXNldF9lbmdpbmVzLT5leHRlbnNpb25zID0g
dG9fdXNlcl9wb2ludGVyKGxvYWRfYmFsYW5jZSk7CiAKLQkJCXNldF9lbmdpbmVzLmVuZ2luZXNb
MF0uZW5naW5lX2NsYXNzID0KKwkJCXNldF9lbmdpbmVzLT5lbmdpbmVzWzBdLmVuZ2luZV9jbGFz
cyA9CiAJCQkJSTkxNV9FTkdJTkVfQ0xBU1NfSU5WQUxJRDsKLQkJCXNldF9lbmdpbmVzLmVuZ2lu
ZXNbMF0uZW5naW5lX2luc3RhbmNlID0KKwkJCXNldF9lbmdpbmVzLT5lbmdpbmVzWzBdLmVuZ2lu
ZV9pbnN0YW5jZSA9CiAJCQkJSTkxNV9FTkdJTkVfQ0xBU1NfSU5WQUxJRF9OT05FOwotCQkJZmls
bF9lbmdpbmVzX2NsYXNzKCZzZXRfZW5naW5lcy5lbmdpbmVzWzFdLCBWQ1MpOworCQkJZmlsbF9l
bmdpbmVzX2NsYXNzKCZzZXRfZW5naW5lcy0+ZW5naW5lc1sxXSwgVkNTKTsKIAotCQkJbWVtc2V0
KCZsb2FkX2JhbGFuY2UsIDAsIHNpemVvZihsb2FkX2JhbGFuY2UpKTsKLQkJCWxvYWRfYmFsYW5j
ZS5iYXNlLm5hbWUgPQorCQkJbG9hZF9iYWxhbmNlLT5iYXNlLm5hbWUgPQogCQkJCUk5MTVfQ09O
VEVYVF9FTkdJTkVTX0VYVF9MT0FEX0JBTEFOQ0U7Ci0JCQlsb2FkX2JhbGFuY2UubnVtX3NpYmxp
bmdzID0gY291bnQ7CisJCQlsb2FkX2JhbGFuY2UtPm51bV9zaWJsaW5ncyA9IGNvdW50OwogCi0J
CQlmaWxsX2VuZ2luZXNfY2xhc3MoJmxvYWRfYmFsYW5jZS5lbmdpbmVzWzBdLCBWQ1MpOworCQkJ
ZmlsbF9lbmdpbmVzX2NsYXNzKCZsb2FkX2JhbGFuY2UtPmVuZ2luZXNbMF0sIFZDUyk7CiAKIAkJ
CWdlbV9jb250ZXh0X3NldF9wYXJhbShmZCwgJnBhcmFtKTsKIAkJfQotLSAKMi4yMC4xCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFp
bGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5m
cmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

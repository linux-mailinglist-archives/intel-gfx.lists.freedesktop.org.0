Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C5BB366A36
	for <lists+intel-gfx@lfdr.de>; Fri, 12 Jul 2019 11:43:38 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B8AEA6E33C;
	Fri, 12 Jul 2019 09:43:34 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 64C1E6E33A
 for <intel-gfx@lists.freedesktop.org>; Fri, 12 Jul 2019 09:43:32 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17243563-1500050 
 for <intel-gfx@lists.freedesktop.org>; Fri, 12 Jul 2019 10:43:28 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 12 Jul 2019 10:43:27 +0100
Message-Id: <20190712094327.24437-6-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190712094327.24437-1-chris@chris-wilson.co.uk>
References: <20190712094327.24437-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 6/6] drm/i915/gtt: Use NULL to encode scratch
 shadow entries
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgY2FuIHNpbXBsaWZ5IG91ciBndHQgd2Fsa2luZyBjb2RlIGJ5IGNvbXBhcmluZyBhZ2FpbnN0
IE5VTEwgZm9yCnNjcmF0Y2ggZW50cmllcyBhcyBvcHBvc2VkIHRvIGxvb2tpbmcgdXAgdGhlIGRp
c3RpbmN0IHBlci1sZXZlbCBzY3JhdGNoCnBvaW50ZXIuCgpUaGUgb25seSBjYXZlYXQgaXMgdG8g
cmVtZW1iZXIgdG8gcHJvdGVjdCBleHRlcm5hbCBwYXJ0aWVzIGFuZCBtYXAgdGhlCk5VTEwgdG8g
dGhlIHNjcmF0Y2ggdG9wIHBkLgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0Bj
aHJpcy13aWxzb24uY28udWs+ClJldmlld2VkLWJ5OiBNaWthIEt1b3BwYWxhIDxtaWthLmt1b3Bw
YWxhQGxpbnV4LmludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9n
dHQuYyB8IDEwNyArKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbV9ndHQuaCB8ICAgMiArLQogMiBmaWxlcyBjaGFuZ2VkLCAzMyBpbnNlcnRp
b25zKCspLCA3NiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCmlu
ZGV4IDE2YmNmMjE2M2FlMC4uNzUzMDkwYTc3MjllIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dl
bV9ndHQuYwpAQCAtNzEwLDcgKzcxMCw2IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV9wYWdlX3RhYmxl
ICphbGxvY19wdChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIAl9CiAKIAlhdG9taWNf
c2V0KCZwdC0+dXNlZCwgMCk7Ci0KIAlyZXR1cm4gcHQ7CiB9CiAKQEAgLTcxOCwxMyArNzE3LDEx
IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVjdG9yeSAqX19hbGxvY19wZCh2b2lkKQog
ewogCXN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICpwZDsKIAotCXBkID0ga21hbGxvYyhzaXpl
b2YoKnBkKSwgSTkxNV9HRlBfQUxMT1dfRkFJTCk7CisJcGQgPSBremFsbG9jKHNpemVvZigqcGQp
LCBJOTE1X0dGUF9BTExPV19GQUlMKTsKIAlpZiAodW5saWtlbHkoIXBkKSkKIAkJcmV0dXJuIE5V
TEw7CiAKLQlhdG9taWNfc2V0KHB4X3VzZWQocGQpLCAwKTsKIAlzcGluX2xvY2tfaW5pdCgmcGQt
PmxvY2spOwotCiAJcmV0dXJuIHBkOwogfQogCkBAIC03NTIsNjMgKzc0OSw1NiBAQCBzdGF0aWMg
dm9pZCBmcmVlX3BkKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLCBzdHJ1Y3QgaTkxNV9w
YWdlX2RtYSAqcGQpCiAKICNkZWZpbmUgZnJlZV9weCh2bSwgcHgpIGZyZWVfcGQodm0sIHB4X2Jh
c2UocHgpKQogCi1zdGF0aWMgdm9pZCBpbml0X3BkKHN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5
ICpwZCwKLQkJICAgIHN0cnVjdCBpOTE1X3BhZ2Vfc2NyYXRjaCAqc2NyYXRjaCkKLXsKLQlmaWxs
X3B4KHBkLCBzY3JhdGNoLT5lbmNvZGUpOwotCW1lbXNldF9wKHBkLT5lbnRyeSwgc2NyYXRjaCwg
NTEyKTsKLX0KLQogc3RhdGljIGlubGluZSB2b2lkCiB3cml0ZV9kbWFfZW50cnkoc3RydWN0IGk5
MTVfcGFnZV9kbWEgKiBjb25zdCBwZG1hLAotCQljb25zdCB1bnNpZ25lZCBzaG9ydCBwZGUsCisJ
CWNvbnN0IHVuc2lnbmVkIHNob3J0IGlkeCwKIAkJY29uc3QgdTY0IGVuY29kZWRfZW50cnkpCiB7
CiAJdTY0ICogY29uc3QgdmFkZHIgPSBrbWFwX2F0b21pYyhwZG1hLT5wYWdlKTsKIAotCXZhZGRy
W3BkZV0gPSBlbmNvZGVkX2VudHJ5OworCXZhZGRyW2lkeF0gPSBlbmNvZGVkX2VudHJ5OwogCWt1
bm1hcF9hdG9taWModmFkZHIpOwogfQogCiBzdGF0aWMgaW5saW5lIHZvaWQKIF9fc2V0X3BkX2Vu
dHJ5KHN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICogY29uc3QgcGQsCi0JICAgICAgIGNvbnN0
IHVuc2lnbmVkIHNob3J0IHBkZSwKKwkgICAgICAgY29uc3QgdW5zaWduZWQgc2hvcnQgaWR4LAog
CSAgICAgICBzdHJ1Y3QgaTkxNV9wYWdlX2RtYSAqIGNvbnN0IHRvLAogCSAgICAgICB1NjQgKCpl
bmNvZGUpKGNvbnN0IGRtYV9hZGRyX3QsIGNvbnN0IGVudW0gaTkxNV9jYWNoZV9sZXZlbCkpCiB7
CiAJR0VNX0JVR19PTihhdG9taWNfcmVhZChweF91c2VkKHBkKSkgPiA1MTIpOwogCiAJYXRvbWlj
X2luYyhweF91c2VkKHBkKSk7Ci0JcGQtPmVudHJ5W3BkZV0gPSB0bzsKLQl3cml0ZV9kbWFfZW50
cnkocHhfYmFzZShwZCksIHBkZSwgZW5jb2RlKHRvLT5kYWRkciwgSTkxNV9DQUNIRV9MTEMpKTsK
KwlwZC0+ZW50cnlbaWR4XSA9IHRvOworCXdyaXRlX2RtYV9lbnRyeShweF9iYXNlKHBkKSwgaWR4
LCBlbmNvZGUodG8tPmRhZGRyLCBJOTE1X0NBQ0hFX0xMQykpOwogfQogCi0jZGVmaW5lIHNldF9w
ZF9lbnRyeShwZCwgcGRlLCB0bykgXAotCV9fc2V0X3BkX2VudHJ5KChwZCksIChwZGUpLCBweF9i
YXNlKHRvKSwgZ2VuOF9wZGVfZW5jb2RlKQorI2RlZmluZSBzZXRfcGRfZW50cnkocGQsIGlkeCwg
dG8pIFwKKwlfX3NldF9wZF9lbnRyeSgocGQpLCAoaWR4KSwgcHhfYmFzZSh0byksIGdlbjhfcGRl
X2VuY29kZSkKIAogc3RhdGljIGlubGluZSB2b2lkCiBjbGVhcl9wZF9lbnRyeShzdHJ1Y3QgaTkx
NV9wYWdlX2RpcmVjdG9yeSAqIGNvbnN0IHBkLAotCSAgICAgICBjb25zdCB1bnNpZ25lZCBzaG9y
dCBwZGUsCi0JICAgICAgIHN0cnVjdCBpOTE1X3BhZ2Vfc2NyYXRjaCAqIGNvbnN0IHNjcmF0Y2gp
CisJICAgICAgIGNvbnN0IHVuc2lnbmVkIHNob3J0IGlkeCwKKwkgICAgICAgY29uc3Qgc3RydWN0
IGk5MTVfcGFnZV9zY3JhdGNoICogY29uc3Qgc2NyYXRjaCkKIHsKIAlHRU1fQlVHX09OKGF0b21p
Y19yZWFkKHB4X3VzZWQocGQpKSA9PSAwKTsKIAotCXdyaXRlX2RtYV9lbnRyeShweF9iYXNlKHBk
KSwgcGRlLCBzY3JhdGNoLT5lbmNvZGUpOwotCXBkLT5lbnRyeVtwZGVdID0gc2NyYXRjaDsKKwl3
cml0ZV9kbWFfZW50cnkocHhfYmFzZShwZCksIGlkeCwgc2NyYXRjaC0+ZW5jb2RlKTsKKwlwZC0+
ZW50cnlbaWR4XSA9IE5VTEw7CiAJYXRvbWljX2RlYyhweF91c2VkKHBkKSk7CiB9CiAKIHN0YXRp
YyBib29sCiByZWxlYXNlX3BkX2VudHJ5KHN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICogY29u
c3QgcGQsCi0JCSBjb25zdCB1bnNpZ25lZCBzaG9ydCBwZGUsCisJCSBjb25zdCB1bnNpZ25lZCBz
aG9ydCBpZHgsCiAJCSBzdHJ1Y3QgaTkxNV9wYWdlX3RhYmxlICogY29uc3QgcHQsCi0JCSBzdHJ1
Y3QgaTkxNV9wYWdlX3NjcmF0Y2ggKiBjb25zdCBzY3JhdGNoKQorCQkgY29uc3Qgc3RydWN0IGk5
MTVfcGFnZV9zY3JhdGNoICogY29uc3Qgc2NyYXRjaCkKIHsKIAlib29sIGZyZWUgPSBmYWxzZTsK
IAogCXNwaW5fbG9jaygmcGQtPmxvY2spOwogCWlmIChhdG9taWNfZGVjX2FuZF90ZXN0KCZwdC0+
dXNlZCkpIHsKLQkJY2xlYXJfcGRfZW50cnkocGQsIHBkZSwgc2NyYXRjaCk7CisJCWNsZWFyX3Bk
X2VudHJ5KHBkLCBpZHgsIHNjcmF0Y2gpOwogCQlmcmVlID0gdHJ1ZTsKIAl9CiAJc3Bpbl91bmxv
Y2soJnBkLT5sb2NrKTsKQEAgLTkxMiw3ICs5MDIsNyBAQCBzdGF0aWMgdm9pZCBnZW44X2ZyZWVf
cGFnZV90YWJsZXMoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJaW50IGk7CiAKIAlm
b3IgKGkgPSAwOyBpIDwgSTkxNV9QREVTOyBpKyspIHsKLQkJaWYgKHBkLT5lbnRyeVtpXSAhPSAm
dm0tPnNjcmF0Y2hbMV0pCisJCWlmIChwZC0+ZW50cnlbaV0pCiAJCQlmcmVlX3BkKHZtLCBwZC0+
ZW50cnlbaV0pOwogCX0KIH0KQEAgLTkyNCw3ICs5MTQsNyBAQCBzdGF0aWMgdm9pZCBnZW44X3Bw
Z3R0X2NsZWFudXBfM2x2bChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAlpbnQgaTsK
IAogCWZvciAoaSA9IDA7IGkgPCBwZHBlczsgaSsrKSB7Ci0JCWlmIChwZHAtPmVudHJ5W2ldID09
ICZ2bS0+c2NyYXRjaFsyXSkKKwkJaWYgKCFwZHAtPmVudHJ5W2ldKQogCQkJY29udGludWU7CiAK
IAkJZ2VuOF9mcmVlX3BhZ2VfdGFibGVzKHZtLCBwZHAtPmVudHJ5W2ldKTsKQEAgLTk0Miw3ICs5
MzIsNyBAQCBzdGF0aWMgdm9pZCBnZW44X3BwZ3R0X2NsZWFudXBfNGx2bChzdHJ1Y3QgaTkxNV9w
cGd0dCAqcHBndHQpCiAJZm9yIChpID0gMDsgaSA8IEdFTjhfUE1MNEVTX1BFUl9QTUw0OyBpKysp
IHsKIAkJc3RydWN0IGk5MTVfcGFnZV9kaXJlY3RvcnkgKnBkcCA9IGk5MTVfcGRwX2VudHJ5KHBt
bDQsIGkpOwogCi0JCWlmIChweF9iYXNlKHBkcCkgPT0gcHhfYmFzZSgmcHBndHQtPnZtLnNjcmF0
Y2hbM10pKQorCQlpZiAoIXBkcCkKIAkJCWNvbnRpbnVlOwogCiAJCWdlbjhfcHBndHRfY2xlYW51
cF8zbHZsKCZwcGd0dC0+dm0sIHBkcCk7CkBAIC05OTYsOCArOTg2LDYgQEAgc3RhdGljIHZvaWQg
Z2VuOF9wcGd0dF9jbGVhcl9wZChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAl1MzIg
cGRlOwogCiAJZ2VuOF9mb3JfZWFjaF9wZGUocHQsIHBkLCBzdGFydCwgbGVuZ3RoLCBwZGUpIHsK
LQkJR0VNX0JVR19PTihweF9iYXNlKHB0KSA9PSBweF9iYXNlKCZ2bS0+c2NyYXRjaFsxXSkpOwot
CiAJCWF0b21pY19pbmMoJnB0LT51c2VkKTsKIAkJZ2VuOF9wcGd0dF9jbGVhcl9wdCh2bSwgcHQs
IHN0YXJ0LCBsZW5ndGgpOwogCQlpZiAocmVsZWFzZV9wZF9lbnRyeShwZCwgcGRlLCBwdCwgJnZt
LT5zY3JhdGNoWzFdKSkKQEAgLTEwMTYsOCArMTAwNCw2IEBAIHN0YXRpYyB2b2lkIGdlbjhfcHBn
dHRfY2xlYXJfcGRwKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCXVuc2lnbmVkIGlu
dCBwZHBlOwogCiAJZ2VuOF9mb3JfZWFjaF9wZHBlKHBkLCBwZHAsIHN0YXJ0LCBsZW5ndGgsIHBk
cGUpIHsKLQkJR0VNX0JVR19PTihweF9iYXNlKHBkKSA9PSBweF9iYXNlKCZ2bS0+c2NyYXRjaFsy
XSkpOwotCiAJCWF0b21pY19pbmMocHhfdXNlZChwZCkpOwogCQlnZW44X3BwZ3R0X2NsZWFyX3Bk
KHZtLCBwZCwgc3RhcnQsIGxlbmd0aCk7CiAJCWlmIChyZWxlYXNlX3BkX2VudHJ5KHBkcCwgcGRw
ZSwgJnBkLT5wdCwgJnZtLT5zY3JhdGNoWzJdKSkKQEAgLTEwNDYsOCArMTAzMiw2IEBAIHN0YXRp
YyB2b2lkIGdlbjhfcHBndHRfY2xlYXJfNGx2bChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2
bSwKIAlHRU1fQlVHX09OKCFpOTE1X3ZtX2lzXzRsdmwodm0pKTsKIAogCWdlbjhfZm9yX2VhY2hf
cG1sNGUocGRwLCBwbWw0LCBzdGFydCwgbGVuZ3RoLCBwbWw0ZSkgewotCQlHRU1fQlVHX09OKHB4
X2Jhc2UocGRwKSA9PSBweF9iYXNlKCZ2bS0+c2NyYXRjaFszXSkpOwotCiAJCWF0b21pY19pbmMo
cHhfdXNlZChwZHApKTsKIAkJZ2VuOF9wcGd0dF9jbGVhcl9wZHAodm0sIHBkcCwgc3RhcnQsIGxl
bmd0aCk7CiAJCWlmIChyZWxlYXNlX3BkX2VudHJ5KHBtbDQsIHBtbDRlLCAmcGRwLT5wdCwgJnZt
LT5zY3JhdGNoWzNdKSkKQEAgLTEwNjgsNyArMTA1Miw3IEBAIHN0YXRpYyBpbnQgZ2VuOF9wcGd0
dF9hbGxvY19wZChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAlnZW44X2Zvcl9lYWNo
X3BkZShwdCwgcGQsIHN0YXJ0LCBsZW5ndGgsIHBkZSkgewogCQljb25zdCBpbnQgY291bnQgPSBn
ZW44X3B0ZV9jb3VudChzdGFydCwgbGVuZ3RoKTsKIAotCQlpZiAocHhfYmFzZShwdCkgPT0gcHhf
YmFzZSgmdm0tPnNjcmF0Y2hbMV0pKSB7CisJCWlmICghcHQpIHsKIAkJCXNwaW5fdW5sb2NrKCZw
ZC0+bG9jayk7CiAKIAkJCXB0ID0gZmV0Y2hfYW5kX3plcm8oJmFsbG9jKTsKQEAgLTEwODMsNyAr
MTA2Nyw3IEBAIHN0YXRpYyBpbnQgZ2VuOF9wcGd0dF9hbGxvY19wZChzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlICp2bSwKIAkJCQlmaWxsX3B4KHB0LCB2bS0+c2NyYXRjaFswXS5lbmNvZGUpOwog
CiAJCQlzcGluX2xvY2soJnBkLT5sb2NrKTsKLQkJCWlmIChwZC0+ZW50cnlbcGRlXSA9PSAmdm0t
PnNjcmF0Y2hbMV0pIHsKKwkJCWlmICghcGQtPmVudHJ5W3BkZV0pIHsKIAkJCQlzZXRfcGRfZW50
cnkocGQsIHBkZSwgcHQpOwogCQkJfSBlbHNlIHsKIAkJCQlhbGxvYyA9IHB0OwpAQCAtMTExNSw3
ICsxMDk5LDcgQEAgc3RhdGljIGludCBnZW44X3BwZ3R0X2FsbG9jX3BkcChzdHJ1Y3QgaTkxNV9h
ZGRyZXNzX3NwYWNlICp2bSwKIAogCXNwaW5fbG9jaygmcGRwLT5sb2NrKTsKIAlnZW44X2Zvcl9l
YWNoX3BkcGUocGQsIHBkcCwgc3RhcnQsIGxlbmd0aCwgcGRwZSkgewotCQlpZiAocHhfYmFzZShw
ZCkgPT0gcHhfYmFzZSgmdm0tPnNjcmF0Y2hbMl0pKSB7CisJCWlmICghcGQpIHsKIAkJCXNwaW5f
dW5sb2NrKCZwZHAtPmxvY2spOwogCiAJCQlwZCA9IGZldGNoX2FuZF96ZXJvKCZhbGxvYyk7CkBA
IC0xMTI2LDEwICsxMTEwLDEwIEBAIHN0YXRpYyBpbnQgZ2VuOF9wcGd0dF9hbGxvY19wZHAoc3Ry
dWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJCQkJZ290byB1bndpbmQ7CiAJCQl9CiAKLQkJ
CWluaXRfcGQocGQsICZ2bS0+c2NyYXRjaFsxXSk7CisJCQlmaWxsX3B4KHBkLCB2bS0+c2NyYXRj
aFsxXS5lbmNvZGUpOwogCiAJCQlzcGluX2xvY2soJnBkcC0+bG9jayk7Ci0JCQlpZiAocGRwLT5l
bnRyeVtwZHBlXSA9PSAmdm0tPnNjcmF0Y2hbMl0pIHsKKwkJCWlmICghcGRwLT5lbnRyeVtwZHBl
XSkgewogCQkJCXNldF9wZF9lbnRyeShwZHAsIHBkcGUsIHBkKTsKIAkJCX0gZWxzZSB7CiAJCQkJ
YWxsb2MgPSBwZDsKQEAgLTExNzksNyArMTE2Myw3IEBAIHN0YXRpYyBpbnQgZ2VuOF9wcGd0dF9h
bGxvY180bHZsKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCiAJc3Bpbl9sb2NrKCZw
bWw0LT5sb2NrKTsKIAlnZW44X2Zvcl9lYWNoX3BtbDRlKHBkcCwgcG1sNCwgc3RhcnQsIGxlbmd0
aCwgcG1sNGUpIHsKLQkJaWYgKHB4X2Jhc2UocGRwKSA9PSBweF9iYXNlKCZ2bS0+c2NyYXRjaFsz
XSkpIHsKKwkJaWYgKCFwZHApIHsKIAkJCXNwaW5fdW5sb2NrKCZwbWw0LT5sb2NrKTsKIAogCQkJ
cGRwID0gZmV0Y2hfYW5kX3plcm8oJmFsbG9jKTsKQEAgLTExOTAsMTAgKzExNzQsMTAgQEAgc3Rh
dGljIGludCBnZW44X3BwZ3R0X2FsbG9jXzRsdmwoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAq
dm0sCiAJCQkJZ290byB1bndpbmQ7CiAJCQl9CiAKLQkJCWluaXRfcGQocGRwLCAmdm0tPnNjcmF0
Y2hbMl0pOworCQkJZmlsbF9weChwZHAsIHZtLT5zY3JhdGNoWzJdLmVuY29kZSk7CiAKIAkJCXNw
aW5fbG9jaygmcG1sNC0+bG9jayk7Ci0JCQlpZiAocG1sNC0+ZW50cnlbcG1sNGVdID09ICZ2bS0+
c2NyYXRjaFszXSkgeworCQkJaWYgKCFwbWw0LT5lbnRyeVtwbWw0ZV0pIHsKIAkJCQlzZXRfcGRf
ZW50cnkocG1sNCwgcG1sNGUsIHBkcCk7CiAJCQl9IGVsc2UgewogCQkJCWFsbG9jID0gcGRwOwpA
QCAtMTUyOSw3ICsxNTEzLDcgQEAgc3RhdGljIGludCBnZW44X3ByZWFsbG9jYXRlX3RvcF9sZXZl
bF9wZHAoc3RydWN0IGk5MTVfcHBndHQgKnBwZ3R0KQogCQlpZiAoSVNfRVJSKHBkKSkKIAkJCWdv
dG8gdW53aW5kOwogCi0JCWluaXRfcGQocGQsICZ2bS0+c2NyYXRjaFsxXSk7CisJCWZpbGxfcHgo
cGQsIHZtLT5zY3JhdGNoWzFdLmVuY29kZSk7CiAJCXNldF9wZF9lbnRyeShwZHAsIHBkcGUsIHBk
KTsKIAl9CiAKQEAgLTE1NTgsNDYgKzE1NDIsMTkgQEAgc3RhdGljIHZvaWQgcHBndHRfaW5pdChz
dHJ1Y3QgaTkxNV9wcGd0dCAqcHBndHQsIHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAJcHBndHQtPnZt
LnZtYV9vcHMuY2xlYXJfcGFnZXMgPSBjbGVhcl9wYWdlczsKIH0KIAotc3RhdGljIHZvaWQgaW5p
dF9wZF9uKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAotCQkgICAgICBzdHJ1Y3QgaTkx
NV9wYWdlX2RpcmVjdG9yeSAqcGQsCi0JCSAgICAgIHN0cnVjdCBpOTE1X3BhZ2Vfc2NyYXRjaCAq
c2NyYXRjaCwKLQkJICAgICAgY29uc3QgdW5zaWduZWQgaW50IGVudHJpZXMpCi17Ci0JdTY0ICog
Y29uc3QgdmFkZHIgPSBrbWFwX2F0b21pY19weChwZCk7Ci0KLQltZW1zZXQ2NCh2YWRkciwgc2Ny
YXRjaC0+ZW5jb2RlLCBlbnRyaWVzKTsKLQlrdW5tYXBfYXRvbWljKHZhZGRyKTsKLQotCW1lbXNl
dF9wKHBkLT5lbnRyeSwgc2NyYXRjaCwgZW50cmllcyk7Ci19Ci0KIHN0YXRpYyBzdHJ1Y3QgaTkx
NV9wYWdlX2RpcmVjdG9yeSAqCiBnZW44X2FsbG9jX3RvcF9wZChzdHJ1Y3QgaTkxNV9hZGRyZXNz
X3NwYWNlICp2bSkKIHsKKwljb25zdCB1bnNpZ25lZCBpbnQgY291bnQgPSB2bS0+dG90YWwgPj4g
X19nZW44X3B0ZV9zaGlmdCh2bS0+dG9wKTsKIAlzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVjdG9yeSAq
cGQ7CiAKLQlpZiAoaTkxNV92bV9pc180bHZsKHZtKSkgewotCQlwZCA9IGFsbG9jX3BkKHZtKTsK
LQkJaWYgKCFJU19FUlIocGQpKQotCQkJaW5pdF9wZChwZCwgJnZtLT5zY3JhdGNoWzNdKTsKKwlH
RU1fQlVHX09OKGNvdW50ID4gQVJSQVlfU0laRShwZC0+ZW50cnkpKTsKIAorCXBkID0gYWxsb2Nf
cGQodm0pOworCWlmIChJU19FUlIocGQpKQogCQlyZXR1cm4gcGQ7Ci0JfQotCi0JLyogM2x2bCAq
LwotCXBkID0gX19hbGxvY19wZCgpOwotCWlmICghcGQpCi0JCXJldHVybiBFUlJfUFRSKC1FTk9N
RU0pOwotCi0JcGQtPmVudHJ5W0dFTjhfM0xWTF9QRFBFU10gPSBOVUxMOwotCi0JaWYgKHVubGlr
ZWx5KHNldHVwX3BhZ2VfZG1hKHZtLCBweF9iYXNlKHBkKSkpKSB7Ci0JCWtmcmVlKHBkKTsKLQkJ
cmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7Ci0JfQotCi0JaW5pdF9wZF9uKHZtLCBwZCwgJnZtLT5z
Y3JhdGNoWzJdLCBHRU44XzNMVkxfUERQRVMpOwogCisJZmlsbF9wYWdlX2RtYShweF9iYXNlKHBk
KSwgdm0tPnNjcmF0Y2hbdm0tPnRvcF0uZW5jb2RlLCBjb3VudCk7CiAJcmV0dXJuIHBkOwogfQog
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaCBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oCmluZGV4IDFhNDNhYzRhOTI0OS4uYjMwZmZl
MzMzODUyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaApAQCAtNjA5LDcgKzYwOSw3
IEBAIGk5MTVfcGFnZV9kaXJfZG1hX2FkZHIoY29uc3Qgc3RydWN0IGk5MTVfcHBndHQgKnBwZ3R0
LCBjb25zdCB1bnNpZ25lZCBpbnQgbikKIHsKIAlzdHJ1Y3QgaTkxNV9wYWdlX2RtYSAqcHQgPSBw
cGd0dC0+cGQtPmVudHJ5W25dOwogCi0JcmV0dXJuIHB4X2RtYShwdCk7CisJcmV0dXJuIHB4X2Rt
YShwdCA/OiBweF9iYXNlKCZwcGd0dC0+dm0uc2NyYXRjaFtwcGd0dC0+dm0udG9wXSkpOwogfQog
CiBzdGF0aWMgaW5saW5lIHN0cnVjdCBpOTE1X2dndHQgKgotLSAKMi4yMi4wCgpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBs
aXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id CE1C889204
	for <lists+intel-gfx@lfdr.de>; Sun, 11 Aug 2019 16:28:20 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9E83D6E342;
	Sun, 11 Aug 2019 14:28:18 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 653236E343
 for <intel-gfx@lists.freedesktop.org>; Sun, 11 Aug 2019 14:28:15 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17960561-1500050 
 for multiple; Sun, 11 Aug 2019 15:28:03 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sun, 11 Aug 2019 15:28:01 +0100
Message-Id: <20190811142801.2460-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190811142801.2460-1-chris@chris-wilson.co.uk>
References: <20190811142801.2460-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 2/2] drm/i915: Extract general GT interrupt
 handlers
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogQW5kaSBTaHl0aSA8YW5kaS5zaHl0aUBpbnRlbC5jb20+CgppOTE1X2lycS5jIGlzIGxh
cmdlLiBJdCBzZXJ2ZXMgYXMgdGhlIGNlbnRyYWwgZGlzcGF0Y2ggYW5kIGhhbmRsZXIgZm9yCmFs
bCBvZiBvdXIgZGV2aWNlIGludGVycnVwdHMuIExldHMgYnJlYWsgaXQgdXAgYnkgcHVsbGluZyBv
dXQgdGhlIEdUCmludGVycnVwdCBoYW5kbGVycy4KCkJhc2VkIG9uIGEgcGF0Y2ggYnkgQ2hyaXMg
V2lsc29uLgoKU2lnbmVkLW9mZi1ieTogQW5kaSBTaHl0aSA8YW5kaS5zaHl0aUBpbnRlbC5jb20+
Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgICAgICAgICAgICAgICB8ICAgMSAr
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9icmVhZGNydW1icy5jIHwgICA4ICstCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9pcnEuYyAgICAgIHwgNDU1ICsrKysrKysr
KysrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfaXJxLmggICAgICB8ICA0
NCArKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG1faXJxLmMgICB8ICAgMSAr
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90eXBlcy5oICAgIHwgICAxICsKIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYyAgfCAgIDkgKy0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggICAgICAgICAgICAgfCAgIDEgLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9pcnEuYyAgICAgICAgICAgICB8IDYwNCArKy0tLS0tLS0tLS0tLS0t
LS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuaCAgICAgICAgICAgICB8ICA0NyAr
KwogMTAgZmlsZXMgY2hhbmdlZCwgNTkzIGluc2VydGlvbnMoKyksIDU3OCBkZWxldGlvbnMoLSkK
IGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9pcnEu
YwogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X2ly
cS5oCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9NYWtlZmlsZQppbmRleCBkMjI2NjU5ZmRiYjMuLjQ1YWRkODEyMDQ4YiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvTWFrZWZpbGUKQEAgLTc5LDYgKzc5LDcgQEAgZ3QteSArPSBcCiAJZ3QvaW50
ZWxfZW5naW5lX3BtLm8gXAogCWd0L2ludGVsX2VuZ2luZV91c2VyLm8gXAogCWd0L2ludGVsX2d0
Lm8gXAorCWd0L2ludGVsX2d0X2lycS5vIFwKIAlndC9pbnRlbF9ndF9wbS5vIFwKIAlndC9pbnRl
bF9ndF9wbV9pcnEubyBcCiAJZ3QvaW50ZWxfaGFuZ2NoZWNrLm8gXApkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfYnJlYWRjcnVtYnMuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2JyZWFkY3J1bWJzLmMKaW5kZXggZTFiYmM5YjQyOGNkLi5jZWJhMWRh
NjE5NjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2JyZWFkY3J1
bWJzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfYnJlYWRjcnVtYnMuYwpA
QCAtMzUsOSArMzUsOSBAQCBzdGF0aWMgdm9pZCBpcnFfZW5hYmxlKHN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZSkKIAkJcmV0dXJuOwogCiAJLyogQ2FsbGVyIGRpc2FibGVzIGludGVycnVw
dHMgKi8KLQlzcGluX2xvY2soJmVuZ2luZS0+aTkxNS0+aXJxX2xvY2spOworCXNwaW5fbG9jaygm
ZW5naW5lLT5ndC0+aXJxX2xvY2spOwogCWVuZ2luZS0+aXJxX2VuYWJsZShlbmdpbmUpOwotCXNw
aW5fdW5sb2NrKCZlbmdpbmUtPmk5MTUtPmlycV9sb2NrKTsKKwlzcGluX3VubG9jaygmZW5naW5l
LT5ndC0+aXJxX2xvY2spOwogfQogCiBzdGF0aWMgdm9pZCBpcnFfZGlzYWJsZShzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUpCkBAIC00Niw5ICs0Niw5IEBAIHN0YXRpYyB2b2lkIGlycV9k
aXNhYmxlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAkJcmV0dXJuOwogCiAJLyog
Q2FsbGVyIGRpc2FibGVzIGludGVycnVwdHMgKi8KLQlzcGluX2xvY2soJmVuZ2luZS0+aTkxNS0+
aXJxX2xvY2spOworCXNwaW5fbG9jaygmZW5naW5lLT5ndC0+aXJxX2xvY2spOwogCWVuZ2luZS0+
aXJxX2Rpc2FibGUoZW5naW5lKTsKLQlzcGluX3VubG9jaygmZW5naW5lLT5pOTE1LT5pcnFfbG9j
ayk7CisJc3Bpbl91bmxvY2soJmVuZ2luZS0+Z3QtPmlycV9sb2NrKTsKIH0KIAogc3RhdGljIHZv
aWQgX19pbnRlbF9icmVhZGNydW1ic19kaXNhcm1faXJxKHN0cnVjdCBpbnRlbF9icmVhZGNydW1i
cyAqYikKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X2lycS5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfaXJxLmMKbmV3IGZpbGUgbW9kZSAx
MDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi4zNGE0ZmI2MjRiZjcKLS0tIC9kZXYvbnVsbAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9pcnEuYwpAQCAtMCwwICsxLDQ1NSBA
QAorLyoKKyAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKKyAqCisgKiBDb3B5cmlnaHQg
wqkgMjAxOSBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpbmNsdWRlIDxsaW51eC9zY2hlZC9j
bG9jay5oPgorCisjaW5jbHVkZSAiaTkxNV9kcnYuaCIKKyNpbmNsdWRlICJpOTE1X2lycS5oIgor
I2luY2x1ZGUgImludGVsX2d0LmgiCisjaW5jbHVkZSAiaW50ZWxfZ3RfaXJxLmgiCisjaW5jbHVk
ZSAiaW50ZWxfdW5jb3JlLmgiCisKK3N0YXRpYyB2b2lkIGd1Y19pcnFfaGFuZGxlcihzdHJ1Y3Qg
aW50ZWxfZ3VjICpndWMsIHUxNiBpaXIpCit7CisJaWYgKGlpciAmIEdVQ19JTlRSX0dVQzJIT1NU
KQorCQlpbnRlbF9ndWNfdG9faG9zdF9ldmVudF9oYW5kbGVyKGd1Yyk7Cit9CisKK3N0YXRpYyB2
b2lkCitjc19pcnFfaGFuZGxlcihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIHUzMiBp
aXIpCit7CisJYm9vbCB0YXNrbGV0ID0gZmFsc2U7CisKKwlpZiAoaWlyICYgR1RfQ09OVEVYVF9T
V0lUQ0hfSU5URVJSVVBUKQorCQl0YXNrbGV0ID0gdHJ1ZTsKKworCWlmIChpaXIgJiBHVF9SRU5E
RVJfVVNFUl9JTlRFUlJVUFQpIHsKKwkJaW50ZWxfZW5naW5lX2JyZWFkY3J1bWJzX2lycShlbmdp
bmUpOworCQl0YXNrbGV0IHw9IGludGVsX2VuZ2luZV9uZWVkc19icmVhZGNydW1iX3Rhc2tsZXQo
ZW5naW5lKTsKKwl9CisKKwlpZiAodGFza2xldCkKKwkJdGFza2xldF9oaV9zY2hlZHVsZSgmZW5n
aW5lLT5leGVjbGlzdHMudGFza2xldCk7Cit9CisKK3N0YXRpYyB1MzIKK2dlbjExX2d0X2VuZ2lu
ZV9pZGVudGl0eShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAorCQkJIGNvbnN0IHVuc2lnbmVkIGludCBi
YW5rLCBjb25zdCB1bnNpZ25lZCBpbnQgYml0KQoreworCXZvaWQgX19pb21lbSAqIGNvbnN0IHJl
Z3MgPSBndC0+dW5jb3JlLT5yZWdzOworCXUzMiB0aW1lb3V0X3RzOworCXUzMiBpZGVudDsKKwor
CWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmd0LT5pcnFfbG9jayk7CisKKwlyYXdfcmVnX3dyaXRlKHJl
Z3MsIEdFTjExX0lJUl9SRUdfU0VMRUNUT1IoYmFuayksIEJJVChiaXQpKTsKKworCS8qCisJICog
TkI6IFNwZWNzIGRvIG5vdCBzcGVjaWZ5IGhvdyBsb25nIHRvIHNwaW4gd2FpdCwKKwkgKiBzbyB3
ZSBkbyB+MTAwdXMgYXMgYW4gZWR1Y2F0ZWQgZ3Vlc3MuCisJICovCisJdGltZW91dF90cyA9IChs
b2NhbF9jbG9jaygpID4+IDEwKSArIDEwMDsKKwlkbyB7CisJCWlkZW50ID0gcmF3X3JlZ19yZWFk
KHJlZ3MsIEdFTjExX0lOVFJfSURFTlRJVFlfUkVHKGJhbmspKTsKKwl9IHdoaWxlICghKGlkZW50
ICYgR0VOMTFfSU5UUl9EQVRBX1ZBTElEKSAmJgorCQkgIXRpbWVfYWZ0ZXIzMihsb2NhbF9jbG9j
aygpID4+IDEwLCB0aW1lb3V0X3RzKSk7CisKKwlpZiAodW5saWtlbHkoIShpZGVudCAmIEdFTjEx
X0lOVFJfREFUQV9WQUxJRCkpKSB7CisJCURSTV9FUlJPUigiSU5UUl9JREVOVElUWV9SRUcldTol
dSAweCUwOHggbm90IHZhbGlkIVxuIiwKKwkJCSAgYmFuaywgYml0LCBpZGVudCk7CisJCXJldHVy
biAwOworCX0KKworCXJhd19yZWdfd3JpdGUocmVncywgR0VOMTFfSU5UUl9JREVOVElUWV9SRUco
YmFuayksCisJCSAgICAgIEdFTjExX0lOVFJfREFUQV9WQUxJRCk7CisKKwlyZXR1cm4gaWRlbnQ7
Cit9CisKK3N0YXRpYyB2b2lkCitnZW4xMV9vdGhlcl9pcnFfaGFuZGxlcihzdHJ1Y3QgaW50ZWxf
Z3QgKmd0LCBjb25zdCB1OCBpbnN0YW5jZSwKKwkJCWNvbnN0IHUxNiBpaXIpCit7CisJaWYgKGlu
c3RhbmNlID09IE9USEVSX0dVQ19JTlNUQU5DRSkKKwkJcmV0dXJuIGd1Y19pcnFfaGFuZGxlcigm
Z3QtPnVjLmd1YywgaWlyKTsKKworCWlmIChpbnN0YW5jZSA9PSBPVEhFUl9HVFBNX0lOU1RBTkNF
KQorCQlyZXR1cm4gZ2VuMTFfcnBzX2lycV9oYW5kbGVyKGd0LCBpaXIpOworCisJV0FSTl9PTkNF
KDEsICJ1bmhhbmRsZWQgb3RoZXIgaW50ZXJydXB0IGluc3RhbmNlPTB4JXgsIGlpcj0weCV4XG4i
LAorCQkgIGluc3RhbmNlLCBpaXIpOworfQorCitzdGF0aWMgdm9pZAorZ2VuMTFfZW5naW5lX2ly
cV9oYW5kbGVyKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIGNvbnN0IHU4IGNsYXNzLAorCQkJIGNvbnN0
IHU4IGluc3RhbmNlLCBjb25zdCB1MTYgaWlyKQoreworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZTsKKworCWlmIChpbnN0YW5jZSA8PSBNQVhfRU5HSU5FX0lOU1RBTkNFKQorCQllbmdp
bmUgPSBndC0+ZW5naW5lX2NsYXNzW2NsYXNzXVtpbnN0YW5jZV07CisJZWxzZQorCQllbmdpbmUg
PSBOVUxMOworCisJaWYgKGxpa2VseShlbmdpbmUpKQorCQlyZXR1cm4gY3NfaXJxX2hhbmRsZXIo
ZW5naW5lLCBpaXIpOworCisJV0FSTl9PTkNFKDEsICJ1bmhhbmRsZWQgZW5naW5lIGludGVycnVw
dCBjbGFzcz0weCV4LCBpbnN0YW5jZT0weCV4XG4iLAorCQkgIGNsYXNzLCBpbnN0YW5jZSk7Cit9
CisKK3N0YXRpYyB2b2lkCitnZW4xMV9ndF9pZGVudGl0eV9oYW5kbGVyKHN0cnVjdCBpbnRlbF9n
dCAqZ3QsIGNvbnN0IHUzMiBpZGVudGl0eSkKK3sKKwljb25zdCB1OCBjbGFzcyA9IEdFTjExX0lO
VFJfRU5HSU5FX0NMQVNTKGlkZW50aXR5KTsKKwljb25zdCB1OCBpbnN0YW5jZSA9IEdFTjExX0lO
VFJfRU5HSU5FX0lOU1RBTkNFKGlkZW50aXR5KTsKKwljb25zdCB1MTYgaW50ciA9IEdFTjExX0lO
VFJfRU5HSU5FX0lOVFIoaWRlbnRpdHkpOworCisJaWYgKHVubGlrZWx5KCFpbnRyKSkKKwkJcmV0
dXJuOworCisJaWYgKGNsYXNzIDw9IENPUFlfRU5HSU5FX0NMQVNTKQorCQlyZXR1cm4gZ2VuMTFf
ZW5naW5lX2lycV9oYW5kbGVyKGd0LCBjbGFzcywgaW5zdGFuY2UsIGludHIpOworCisJaWYgKGNs
YXNzID09IE9USEVSX0NMQVNTKQorCQlyZXR1cm4gZ2VuMTFfb3RoZXJfaXJxX2hhbmRsZXIoZ3Qs
IGluc3RhbmNlLCBpbnRyKTsKKworCVdBUk5fT05DRSgxLCAidW5rbm93biBpbnRlcnJ1cHQgY2xh
c3M9MHgleCwgaW5zdGFuY2U9MHgleCwgaW50cj0weCV4XG4iLAorCQkgIGNsYXNzLCBpbnN0YW5j
ZSwgaW50cik7Cit9CisKK3N0YXRpYyB2b2lkCitnZW4xMV9ndF9iYW5rX2hhbmRsZXIoc3RydWN0
IGludGVsX2d0ICpndCwgY29uc3QgdW5zaWduZWQgaW50IGJhbmspCit7CisJdm9pZCBfX2lvbWVt
ICogY29uc3QgcmVncyA9IGd0LT51bmNvcmUtPnJlZ3M7CisJdW5zaWduZWQgbG9uZyBpbnRyX2R3
OworCXVuc2lnbmVkIGludCBiaXQ7CisKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZndC0+aXJxX2xv
Y2spOworCisJaW50cl9kdyA9IHJhd19yZWdfcmVhZChyZWdzLCBHRU4xMV9HVF9JTlRSX0RXKGJh
bmspKTsKKworCWZvcl9lYWNoX3NldF9iaXQoYml0LCAmaW50cl9kdywgMzIpIHsKKwkJY29uc3Qg
dTMyIGlkZW50ID0gZ2VuMTFfZ3RfZW5naW5lX2lkZW50aXR5KGd0LCBiYW5rLCBiaXQpOworCisJ
CWdlbjExX2d0X2lkZW50aXR5X2hhbmRsZXIoZ3QsIGlkZW50KTsKKwl9CisKKwkvKiBDbGVhciBt
dXN0IGJlIGFmdGVyIHNoYXJlZCBoYXMgYmVlbiBzZXJ2ZWQgZm9yIGVuZ2luZSAqLworCXJhd19y
ZWdfd3JpdGUocmVncywgR0VOMTFfR1RfSU5UUl9EVyhiYW5rKSwgaW50cl9kdyk7Cit9CisKK3Zv
aWQgZ2VuMTFfZ3RfaXJxX2hhbmRsZXIoc3RydWN0IGludGVsX2d0ICpndCwgY29uc3QgdTMyIG1h
c3Rlcl9jdGwpCit7CisJdW5zaWduZWQgaW50IGJhbms7CisKKwlzcGluX2xvY2soJmd0LT5pcnFf
bG9jayk7CisKKwlmb3IgKGJhbmsgPSAwOyBiYW5rIDwgMjsgYmFuaysrKSB7CisJCWlmIChtYXN0
ZXJfY3RsICYgR0VOMTFfR1RfRFdfSVJRKGJhbmspKQorCQkJZ2VuMTFfZ3RfYmFua19oYW5kbGVy
KGd0LCBiYW5rKTsKKwl9CisKKwlzcGluX3VubG9jaygmZ3QtPmlycV9sb2NrKTsKK30KKworYm9v
bCBnZW4xMV9ndF9yZXNldF9vbmVfaWlyKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCisJCQkgICAgY29u
c3QgdW5zaWduZWQgaW50IGJhbmssIGNvbnN0IHVuc2lnbmVkIGludCBiaXQpCit7CisJdm9pZCBf
X2lvbWVtICogY29uc3QgcmVncyA9IGd0LT51bmNvcmUtPnJlZ3M7CisJdTMyIGR3OworCisJbG9j
a2RlcF9hc3NlcnRfaGVsZCgmZ3QtPmlycV9sb2NrKTsKKworCWR3ID0gcmF3X3JlZ19yZWFkKHJl
Z3MsIEdFTjExX0dUX0lOVFJfRFcoYmFuaykpOworCWlmIChkdyAmIEJJVChiaXQpKSB7CisJCS8q
CisJCSAqIEFjY29yZGluZyB0byB0aGUgQlNwZWMsIERXX0lJUiBiaXRzIGNhbm5vdCBiZSBjbGVh
cmVkIHdpdGhvdXQKKwkJICogZmlyc3Qgc2VydmljaW5nIHRoZSBTZWxlY3RvciAmIFNoYXJlZCBJ
SVIgcmVnaXN0ZXJzLgorCQkgKi8KKwkJZ2VuMTFfZ3RfZW5naW5lX2lkZW50aXR5KGd0LCBiYW5r
LCBiaXQpOworCisJCS8qCisJCSAqIFdlIGxvY2tlZCBHVCBJTlQgRFcgYnkgcmVhZGluZyBpdC4g
SWYgd2Ugd2FudCB0byAodHJ5CisJCSAqIHRvKSByZWNvdmVyIGZyb20gdGhpcyBzdWNjZXNzZnVs
bHksIHdlIG5lZWQgdG8gY2xlYXIKKwkJICogb3VyIGJpdCwgb3RoZXJ3aXNlIHdlIGFyZSBsb2Nr
aW5nIHRoZSByZWdpc3RlciBmb3IKKwkJICogZXZlcnlib2R5LgorCQkgKi8KKwkJcmF3X3JlZ193
cml0ZShyZWdzLCBHRU4xMV9HVF9JTlRSX0RXKGJhbmspLCBCSVQoYml0KSk7CisKKwkJcmV0dXJu
IHRydWU7CisJfQorCisJcmV0dXJuIGZhbHNlOworfQorCit2b2lkIGdlbjExX2d0X2lycV9yZXNl
dChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQoreworCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9
IGd0LT51bmNvcmU7CisKKwkvKiBEaXNhYmxlIFJDUywgQkNTLCBWQ1MgYW5kIFZFQ1MgY2xhc3Mg
ZW5naW5lcy4gKi8KKwlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBHRU4xMV9SRU5ERVJfQ09Q
WV9JTlRSX0VOQUJMRSwgMCk7CisJaW50ZWxfdW5jb3JlX3dyaXRlKHVuY29yZSwgR0VOMTFfVkNT
X1ZFQ1NfSU5UUl9FTkFCTEUsCSAgMCk7CisKKwkvKiBSZXN0b3JlIG1hc2tzIGlycXMgb24gUkNT
LCBCQ1MsIFZDUyBhbmQgVkVDUyBlbmdpbmVzLiAqLworCWludGVsX3VuY29yZV93cml0ZSh1bmNv
cmUsIEdFTjExX1JDUzBfUlNWRF9JTlRSX01BU0ssCX4wKTsKKwlpbnRlbF91bmNvcmVfd3JpdGUo
dW5jb3JlLCBHRU4xMV9CQ1NfUlNWRF9JTlRSX01BU0ssCX4wKTsKKwlpbnRlbF91bmNvcmVfd3Jp
dGUodW5jb3JlLCBHRU4xMV9WQ1MwX1ZDUzFfSU5UUl9NQVNLLAl+MCk7CisJaW50ZWxfdW5jb3Jl
X3dyaXRlKHVuY29yZSwgR0VOMTFfVkNTMl9WQ1MzX0lOVFJfTUFTSywJfjApOworCWludGVsX3Vu
Y29yZV93cml0ZSh1bmNvcmUsIEdFTjExX1ZFQ1MwX1ZFQ1MxX0lOVFJfTUFTSywJfjApOworCisJ
aW50ZWxfdW5jb3JlX3dyaXRlKHVuY29yZSwgR0VOMTFfR1BNX1dHQk9YUEVSRl9JTlRSX0VOQUJM
RSwgMCk7CisJaW50ZWxfdW5jb3JlX3dyaXRlKHVuY29yZSwgR0VOMTFfR1BNX1dHQk9YUEVSRl9J
TlRSX01BU0ssICB+MCk7CisJaW50ZWxfdW5jb3JlX3dyaXRlKHVuY29yZSwgR0VOMTFfR1VDX1NH
X0lOVFJfRU5BQkxFLCAwKTsKKwlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBHRU4xMV9HVUNf
U0dfSU5UUl9NQVNLLCAgfjApOworfQorCit2b2lkIGdlbjExX2d0X2lycV9wb3N0aW5zdGFsbChz
dHJ1Y3QgaW50ZWxfZ3QgKmd0KQoreworCWNvbnN0IHUzMiBpcnFzID0gR1RfUkVOREVSX1VTRVJf
SU5URVJSVVBUIHwgR1RfQ09OVEVYVF9TV0lUQ0hfSU5URVJSVVBUOworCXN0cnVjdCBpbnRlbF91
bmNvcmUgKnVuY29yZSA9IGd0LT51bmNvcmU7CisJY29uc3QgdTMyIGRtYXNrID0gaXJxcyA8PCAx
NiB8IGlycXM7CisJY29uc3QgdTMyIHNtYXNrID0gaXJxcyA8PCAxNjsKKworCUJVSUxEX0JVR19P
TihpcnFzICYgMHhmZmZmMDAwMCk7CisKKwkvKiBFbmFibGUgUkNTLCBCQ1MsIFZDUyBhbmQgVkVD
UyBjbGFzcyBpbnRlcnJ1cHRzLiAqLworCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsIEdFTjEx
X1JFTkRFUl9DT1BZX0lOVFJfRU5BQkxFLCBkbWFzayk7CisJaW50ZWxfdW5jb3JlX3dyaXRlKHVu
Y29yZSwgR0VOMTFfVkNTX1ZFQ1NfSU5UUl9FTkFCTEUsIGRtYXNrKTsKKworCS8qIFVubWFzayBp
cnFzIG9uIFJDUywgQkNTLCBWQ1MgYW5kIFZFQ1MgZW5naW5lcy4gKi8KKwlpbnRlbF91bmNvcmVf
d3JpdGUodW5jb3JlLCBHRU4xMV9SQ1MwX1JTVkRfSU5UUl9NQVNLLCB+c21hc2spOworCWludGVs
X3VuY29yZV93cml0ZSh1bmNvcmUsIEdFTjExX0JDU19SU1ZEX0lOVFJfTUFTSywgfnNtYXNrKTsK
KwlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBHRU4xMV9WQ1MwX1ZDUzFfSU5UUl9NQVNLLCB+
ZG1hc2spOworCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsIEdFTjExX1ZDUzJfVkNTM19JTlRS
X01BU0ssIH5kbWFzayk7CisJaW50ZWxfdW5jb3JlX3dyaXRlKHVuY29yZSwgR0VOMTFfVkVDUzBf
VkVDUzFfSU5UUl9NQVNLLCB+ZG1hc2spOworCisJLyoKKwkgKiBSUFMgaW50ZXJydXB0cyB3aWxs
IGdldCBlbmFibGVkL2Rpc2FibGVkIG9uIGRlbWFuZCB3aGVuIFJQUyBpdHNlbGYKKwkgKiBpcyBl
bmFibGVkL2Rpc2FibGVkLgorCSAqLworCWd0LT5wbV9pZXIgPSAweDA7CisJZ3QtPnBtX2ltciA9
IH5ndC0+cG1faWVyOworCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsIEdFTjExX0dQTV9XR0JP
WFBFUkZfSU5UUl9FTkFCTEUsIDApOworCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsIEdFTjEx
X0dQTV9XR0JPWFBFUkZfSU5UUl9NQVNLLCAgfjApOworCisJLyogU2FtZSB0aGluZyBmb3IgR3VD
IGludGVycnVwdHMgKi8KKwlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBHRU4xMV9HVUNfU0df
SU5UUl9FTkFCTEUsIDApOworCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsIEdFTjExX0dVQ19T
R19JTlRSX01BU0ssICB+MCk7Cit9CisKK3ZvaWQgZ2VuNV9ndF9pcnFfaGFuZGxlcihzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0LCB1MzIgZ3RfaWlyKQoreworCWlmIChndF9paXIgJiBHVF9SRU5ERVJfVVNF
Ul9JTlRFUlJVUFQpCisJCWludGVsX2VuZ2luZV9icmVhZGNydW1ic19pcnEoZ3QtPmVuZ2luZV9j
bGFzc1tSRU5ERVJfQ0xBU1NdWzBdKTsKKwlpZiAoZ3RfaWlyICYgSUxLX0JTRF9VU0VSX0lOVEVS
UlVQVCkKKwkJaW50ZWxfZW5naW5lX2JyZWFkY3J1bWJzX2lycShndC0+ZW5naW5lX2NsYXNzW1ZJ
REVPX0RFQ09ERV9DTEFTU11bMF0pOworfQorCitzdGF0aWMgdm9pZCBnZW43X3Bhcml0eV9lcnJv
cl9pcnFfaGFuZGxlcihzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCB1MzIgaWlyKQoreworCWlmICghSEFT
X0wzX0RQRihndC0+aTkxNSkpCisJCXJldHVybjsKKworCXNwaW5fbG9jaygmZ3QtPmlycV9sb2Nr
KTsKKwlnZW41X2d0X2Rpc2FibGVfaXJxKGd0LCBHVF9QQVJJVFlfRVJST1IoZ3QtPmk5MTUpKTsK
KwlzcGluX3VubG9jaygmZ3QtPmlycV9sb2NrKTsKKworCWlmIChpaXIgJiBHVF9SRU5ERVJfTDNf
UEFSSVRZX0VSUk9SX0lOVEVSUlVQVF9TMSkKKwkJZ3QtPmk5MTUtPmwzX3Bhcml0eS53aGljaF9z
bGljZSB8PSAxIDw8IDE7CisKKwlpZiAoaWlyICYgR1RfUkVOREVSX0wzX1BBUklUWV9FUlJPUl9J
TlRFUlJVUFQpCisJCWd0LT5pOTE1LT5sM19wYXJpdHkud2hpY2hfc2xpY2UgfD0gMSA8PCAwOwor
CisJc2NoZWR1bGVfd29yaygmZ3QtPmk5MTUtPmwzX3Bhcml0eS5lcnJvcl93b3JrKTsKK30KKwor
dm9pZCBnZW42X2d0X2lycV9oYW5kbGVyKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIHUzMiBndF9paXIp
Cit7CisJaWYgKGd0X2lpciAmIEdUX1JFTkRFUl9VU0VSX0lOVEVSUlVQVCkKKwkJaW50ZWxfZW5n
aW5lX2JyZWFkY3J1bWJzX2lycShndC0+ZW5naW5lX2NsYXNzW1JFTkRFUl9DTEFTU11bMF0pOwor
CWlmIChndF9paXIgJiBHVF9CU0RfVVNFUl9JTlRFUlJVUFQpCisJCWludGVsX2VuZ2luZV9icmVh
ZGNydW1ic19pcnEoZ3QtPmVuZ2luZV9jbGFzc1tWSURFT19ERUNPREVfQ0xBU1NdWzBdKTsKKwlp
ZiAoZ3RfaWlyICYgR1RfQkxUX1VTRVJfSU5URVJSVVBUKQorCQlpbnRlbF9lbmdpbmVfYnJlYWRj
cnVtYnNfaXJxKGd0LT5lbmdpbmVfY2xhc3NbQ09QWV9FTkdJTkVfQ0xBU1NdWzBdKTsKKworCWlm
IChndF9paXIgJiAoR1RfQkxUX0NTX0VSUk9SX0lOVEVSUlVQVCB8CisJCSAgICAgIEdUX0JTRF9D
U19FUlJPUl9JTlRFUlJVUFQgfAorCQkgICAgICBHVF9SRU5ERVJfQ1NfTUFTVEVSX0VSUk9SX0lO
VEVSUlVQVCkpCisJCURSTV9ERUJVRygiQ29tbWFuZCBwYXJzZXIgZXJyb3IsIGd0X2lpciAweCUw
OHhcbiIsIGd0X2lpcik7CisKKwlpZiAoZ3RfaWlyICYgR1RfUEFSSVRZX0VSUk9SKGd0LT5pOTE1
KSkKKwkJZ2VuN19wYXJpdHlfZXJyb3JfaXJxX2hhbmRsZXIoZ3QsIGd0X2lpcik7Cit9CisKK3Zv
aWQgZ2VuOF9ndF9pcnFfYWNrKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIHUzMiBtYXN0ZXJfY3RsLCB1
MzIgZ3RfaWlyWzRdKQoreworCXZvaWQgX19pb21lbSAqIGNvbnN0IHJlZ3MgPSBndC0+dW5jb3Jl
LT5yZWdzOworCisJaWYgKG1hc3Rlcl9jdGwgJiAoR0VOOF9HVF9SQ1NfSVJRIHwgR0VOOF9HVF9C
Q1NfSVJRKSkgeworCQlndF9paXJbMF0gPSByYXdfcmVnX3JlYWQocmVncywgR0VOOF9HVF9JSVIo
MCkpOworCQlpZiAobGlrZWx5KGd0X2lpclswXSkpCisJCQlyYXdfcmVnX3dyaXRlKHJlZ3MsIEdF
TjhfR1RfSUlSKDApLCBndF9paXJbMF0pOworCX0KKworCWlmIChtYXN0ZXJfY3RsICYgKEdFTjhf
R1RfVkNTMF9JUlEgfCBHRU44X0dUX1ZDUzFfSVJRKSkgeworCQlndF9paXJbMV0gPSByYXdfcmVn
X3JlYWQocmVncywgR0VOOF9HVF9JSVIoMSkpOworCQlpZiAobGlrZWx5KGd0X2lpclsxXSkpCisJ
CQlyYXdfcmVnX3dyaXRlKHJlZ3MsIEdFTjhfR1RfSUlSKDEpLCBndF9paXJbMV0pOworCX0KKwor
CWlmIChtYXN0ZXJfY3RsICYgKEdFTjhfR1RfUE1fSVJRIHwgR0VOOF9HVF9HVUNfSVJRKSkgewor
CQlndF9paXJbMl0gPSByYXdfcmVnX3JlYWQocmVncywgR0VOOF9HVF9JSVIoMikpOworCQlpZiAo
bGlrZWx5KGd0X2lpclsyXSkpCisJCQlyYXdfcmVnX3dyaXRlKHJlZ3MsIEdFTjhfR1RfSUlSKDIp
LCBndF9paXJbMl0pOworCX0KKworCWlmIChtYXN0ZXJfY3RsICYgR0VOOF9HVF9WRUNTX0lSUSkg
eworCQlndF9paXJbM10gPSByYXdfcmVnX3JlYWQocmVncywgR0VOOF9HVF9JSVIoMykpOworCQlp
ZiAobGlrZWx5KGd0X2lpclszXSkpCisJCQlyYXdfcmVnX3dyaXRlKHJlZ3MsIEdFTjhfR1RfSUlS
KDMpLCBndF9paXJbM10pOworCX0KK30KKwordm9pZCBnZW44X2d0X2lycV9oYW5kbGVyKHN0cnVj
dCBpbnRlbF9ndCAqZ3QsIHUzMiBtYXN0ZXJfY3RsLCB1MzIgZ3RfaWlyWzRdKQoreworCWlmICht
YXN0ZXJfY3RsICYgKEdFTjhfR1RfUkNTX0lSUSB8IEdFTjhfR1RfQkNTX0lSUSkpIHsKKwkJY3Nf
aXJxX2hhbmRsZXIoZ3QtPmVuZ2luZV9jbGFzc1tSRU5ERVJfQ0xBU1NdWzBdLAorCQkJICAgICAg
IGd0X2lpclswXSA+PiBHRU44X1JDU19JUlFfU0hJRlQpOworCQljc19pcnFfaGFuZGxlcihndC0+
ZW5naW5lX2NsYXNzW0NPUFlfRU5HSU5FX0NMQVNTXVswXSwKKwkJCSAgICAgICBndF9paXJbMF0g
Pj4gR0VOOF9CQ1NfSVJRX1NISUZUKTsKKwl9CisKKwlpZiAobWFzdGVyX2N0bCAmIChHRU44X0dU
X1ZDUzBfSVJRIHwgR0VOOF9HVF9WQ1MxX0lSUSkpIHsKKwkJY3NfaXJxX2hhbmRsZXIoZ3QtPmVu
Z2luZV9jbGFzc1tWSURFT19ERUNPREVfQ0xBU1NdWzBdLAorCQkJICAgICAgIGd0X2lpclsxXSA+
PiBHRU44X1ZDUzBfSVJRX1NISUZUKTsKKwkJY3NfaXJxX2hhbmRsZXIoZ3QtPmVuZ2luZV9jbGFz
c1tWSURFT19ERUNPREVfQ0xBU1NdWzFdLAorCQkJICAgICAgIGd0X2lpclsxXSA+PiBHRU44X1ZD
UzFfSVJRX1NISUZUKTsKKwl9CisKKwlpZiAobWFzdGVyX2N0bCAmIEdFTjhfR1RfVkVDU19JUlEp
IHsKKwkJY3NfaXJxX2hhbmRsZXIoZ3QtPmVuZ2luZV9jbGFzc1tWSURFT19FTkhBTkNFTUVOVF9D
TEFTU11bMF0sCisJCQkgICAgICAgZ3RfaWlyWzNdID4+IEdFTjhfVkVDU19JUlFfU0hJRlQpOwor
CX0KKworCWlmIChtYXN0ZXJfY3RsICYgKEdFTjhfR1RfUE1fSVJRIHwgR0VOOF9HVF9HVUNfSVJR
KSkgeworCQlnZW42X3Jwc19pcnFfaGFuZGxlcihndC0+aTkxNSwgZ3RfaWlyWzJdKTsKKwkJZ3Vj
X2lycV9oYW5kbGVyKCZndC0+dWMuZ3VjLCBndF9paXJbMl0gPj4gMTYpOworCX0KK30KKwordm9p
ZCBnZW44X2d0X2lycV9yZXNldChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQoreworCXN0cnVjdCBpbnRl
bF91bmNvcmUgKnVuY29yZSA9IGd0LT51bmNvcmU7CisKKwlHRU44X0lSUV9SRVNFVF9ORFgodW5j
b3JlLCBHVCwgMCk7CisJR0VOOF9JUlFfUkVTRVRfTkRYKHVuY29yZSwgR1QsIDEpOworCUdFTjhf
SVJRX1JFU0VUX05EWCh1bmNvcmUsIEdULCAyKTsKKwlHRU44X0lSUV9SRVNFVF9ORFgodW5jb3Jl
LCBHVCwgMyk7Cit9CisKK3ZvaWQgZ2VuOF9ndF9pcnFfcG9zdGluc3RhbGwoc3RydWN0IGludGVs
X2d0ICpndCkKK3sKKwlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSBndC0+dW5jb3JlOwor
CisJLyogVGhlc2UgYXJlIGludGVycnVwdHMgd2UnbGwgdG9nZ2xlIHdpdGggdGhlIHJpbmcgbWFz
ayByZWdpc3RlciAqLworCXUzMiBndF9pbnRlcnJ1cHRzW10gPSB7CisJCShHVF9SRU5ERVJfVVNF
Ul9JTlRFUlJVUFQgPDwgR0VOOF9SQ1NfSVJRX1NISUZUIHwKKwkJIEdUX0NPTlRFWFRfU1dJVENI
X0lOVEVSUlVQVCA8PCBHRU44X1JDU19JUlFfU0hJRlQgfAorCQkgR1RfUkVOREVSX1VTRVJfSU5U
RVJSVVBUIDw8IEdFTjhfQkNTX0lSUV9TSElGVCB8CisJCSBHVF9DT05URVhUX1NXSVRDSF9JTlRF
UlJVUFQgPDwgR0VOOF9CQ1NfSVJRX1NISUZUKSwKKworCQkoR1RfUkVOREVSX1VTRVJfSU5URVJS
VVBUIDw8IEdFTjhfVkNTMF9JUlFfU0hJRlQgfAorCQkgR1RfQ09OVEVYVF9TV0lUQ0hfSU5URVJS
VVBUIDw8IEdFTjhfVkNTMF9JUlFfU0hJRlQgfAorCQkgR1RfUkVOREVSX1VTRVJfSU5URVJSVVBU
IDw8IEdFTjhfVkNTMV9JUlFfU0hJRlQgfAorCQkgR1RfQ09OVEVYVF9TV0lUQ0hfSU5URVJSVVBU
IDw8IEdFTjhfVkNTMV9JUlFfU0hJRlQpLAorCisJCTAsCisKKwkJKEdUX1JFTkRFUl9VU0VSX0lO
VEVSUlVQVCA8PCBHRU44X1ZFQ1NfSVJRX1NISUZUIHwKKwkJIEdUX0NPTlRFWFRfU1dJVENIX0lO
VEVSUlVQVCA8PCBHRU44X1ZFQ1NfSVJRX1NISUZUKQorCX07CisKKwlndC0+cG1faWVyID0gMHgw
OworCWd0LT5wbV9pbXIgPSB+Z3QtPnBtX2llcjsKKwlHRU44X0lSUV9JTklUX05EWCh1bmNvcmUs
IEdULCAwLCB+Z3RfaW50ZXJydXB0c1swXSwgZ3RfaW50ZXJydXB0c1swXSk7CisJR0VOOF9JUlFf
SU5JVF9ORFgodW5jb3JlLCBHVCwgMSwgfmd0X2ludGVycnVwdHNbMV0sIGd0X2ludGVycnVwdHNb
MV0pOworCS8qCisJICogUlBTIGludGVycnVwdHMgd2lsbCBnZXQgZW5hYmxlZC9kaXNhYmxlZCBv
biBkZW1hbmQgd2hlbiBSUFMgaXRzZWxmCisJICogaXMgZW5hYmxlZC9kaXNhYmxlZC4gU2FtZSB3
aWwgYmUgdGhlIGNhc2UgZm9yIEd1QyBpbnRlcnJ1cHRzLgorCSAqLworCUdFTjhfSVJRX0lOSVRf
TkRYKHVuY29yZSwgR1QsIDIsIGd0LT5wbV9pbXIsIGd0LT5wbV9pZXIpOworCUdFTjhfSVJRX0lO
SVRfTkRYKHVuY29yZSwgR1QsIDMsIH5ndF9pbnRlcnJ1cHRzWzNdLCBndF9pbnRlcnJ1cHRzWzNd
KTsKK30KKworc3RhdGljIHZvaWQgZ2VuNV9ndF91cGRhdGVfaXJxKHN0cnVjdCBpbnRlbF9ndCAq
Z3QsCisJCQkgICAgICAgdTMyIGludGVycnVwdF9tYXNrLAorCQkJICAgICAgIHUzMiBlbmFibGVk
X2lycV9tYXNrKQoreworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmd0LT5pcnFfbG9jayk7CisKKwlH
RU1fQlVHX09OKGVuYWJsZWRfaXJxX21hc2sgJiB+aW50ZXJydXB0X21hc2spOworCisJZ3QtPmd0
X2ltciAmPSB+aW50ZXJydXB0X21hc2s7CisJZ3QtPmd0X2ltciB8PSAofmVuYWJsZWRfaXJxX21h
c2sgJiBpbnRlcnJ1cHRfbWFzayk7CisJaW50ZWxfdW5jb3JlX3dyaXRlKGd0LT51bmNvcmUsIEdU
SU1SLCBndC0+Z3RfaW1yKTsKK30KKwordm9pZCBnZW41X2d0X2VuYWJsZV9pcnEoc3RydWN0IGlu
dGVsX2d0ICpndCwgdTMyIG1hc2spCit7CisJZ2VuNV9ndF91cGRhdGVfaXJxKGd0LCBtYXNrLCBt
YXNrKTsKKwlpbnRlbF91bmNvcmVfcG9zdGluZ19yZWFkX2Z3KGd0LT51bmNvcmUsIEdUSU1SKTsK
K30KKwordm9pZCBnZW41X2d0X2Rpc2FibGVfaXJxKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIHUzMiBt
YXNrKQoreworCWdlbjVfZ3RfdXBkYXRlX2lycShndCwgbWFzaywgMCk7Cit9CisKK3ZvaWQgZ2Vu
NV9ndF9pcnFfcmVzZXQoc3RydWN0IGludGVsX2d0ICpndCkKK3sKKwlzdHJ1Y3QgaW50ZWxfdW5j
b3JlICp1bmNvcmUgPSBndC0+dW5jb3JlOworCisJR0VOM19JUlFfUkVTRVQodW5jb3JlLCBHVCk7
CisJaWYgKElOVEVMX0dFTihndC0+aTkxNSkgPj0gNikKKwkJR0VOM19JUlFfUkVTRVQodW5jb3Jl
LCBHRU42X1BNKTsKK30KKwordm9pZCBnZW41X2d0X2lycV9wb3N0aW5zdGFsbChzdHJ1Y3QgaW50
ZWxfZ3QgKmd0KQoreworCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9IGd0LT51bmNvcmU7
CisJdTMyIHBtX2lycXMgPSAwOworCXUzMiBndF9pcnFzID0gMDsKKworCWd0LT5ndF9pbXIgPSB+
MDsKKwlpZiAoSEFTX0wzX0RQRihndC0+aTkxNSkpIHsKKwkJLyogTDMgcGFyaXR5IGludGVycnVw
dCBpcyBhbHdheXMgdW5tYXNrZWQuICovCisJCWd0LT5ndF9pbXIgPSB+R1RfUEFSSVRZX0VSUk9S
KGd0LT5pOTE1KTsKKwkJZ3RfaXJxcyB8PSBHVF9QQVJJVFlfRVJST1IoZ3QtPmk5MTUpOworCX0K
KworCWd0X2lycXMgfD0gR1RfUkVOREVSX1VTRVJfSU5URVJSVVBUOworCWlmIChJU19HRU4oZ3Qt
Pmk5MTUsIDUpKQorCQlndF9pcnFzIHw9IElMS19CU0RfVVNFUl9JTlRFUlJVUFQ7CisJZWxzZQor
CQlndF9pcnFzIHw9IEdUX0JMVF9VU0VSX0lOVEVSUlVQVCB8IEdUX0JTRF9VU0VSX0lOVEVSUlVQ
VDsKKworCUdFTjNfSVJRX0lOSVQodW5jb3JlLCBHVCwgZ3QtPmd0X2ltciwgZ3RfaXJxcyk7CisK
KwlpZiAoSU5URUxfR0VOKGd0LT5pOTE1KSA+PSA2KSB7CisJCS8qCisJCSAqIFJQUyBpbnRlcnJ1
cHRzIHdpbGwgZ2V0IGVuYWJsZWQvZGlzYWJsZWQgb24gZGVtYW5kIHdoZW4gUlBTCisJCSAqIGl0
c2VsZiBpcyBlbmFibGVkL2Rpc2FibGVkLgorCQkgKi8KKwkJaWYgKEhBU19FTkdJTkUoZ3QtPmk5
MTUsIFZFQ1MwKSkgeworCQkJcG1faXJxcyB8PSBQTV9WRUJPWF9VU0VSX0lOVEVSUlVQVDsKKwkJ
CWd0LT5wbV9pZXIgfD0gUE1fVkVCT1hfVVNFUl9JTlRFUlJVUFQ7CisJCX0KKworCQlndC0+cG1f
aW1yID0gMHhmZmZmZmZmZjsKKwkJR0VOM19JUlFfSU5JVCh1bmNvcmUsIEdFTjZfUE0sIGd0LT5w
bV9pbXIsIHBtX2lycXMpOworCX0KK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2d0X2lycS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfaXJx
LmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi44ZjM3NTkzNzEyYzkK
LS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9pcnEu
aApAQCAtMCwwICsxLDQ0IEBACisvKgorICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAor
ICoKKyAqIENvcHlyaWdodCDCqSAyMDE5IEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2lmbmRl
ZiBJTlRFTF9HVF9JUlFfSAorI2RlZmluZSBJTlRFTF9HVF9JUlFfSAorCisjaW5jbHVkZSA8bGlu
dXgvdHlwZXMuaD4KKworc3RydWN0IGludGVsX2d0OworCisjZGVmaW5lIEdFTjhfR1RfSVJRUyAo
R0VOOF9HVF9SQ1NfSVJRIHwgXAorCQkgICAgICBHRU44X0dUX0JDU19JUlEgfCBcCisJCSAgICAg
IEdFTjhfR1RfVkNTMF9JUlEgfCBcCisJCSAgICAgIEdFTjhfR1RfVkNTMV9JUlEgfCBcCisJCSAg
ICAgIEdFTjhfR1RfVkVDU19JUlEgfCBcCisJCSAgICAgIEdFTjhfR1RfUE1fSVJRIHwgXAorCQkg
ICAgICBHRU44X0dUX0dVQ19JUlEpCisKK3ZvaWQgZ2VuMTFfZ3RfaXJxX3Jlc2V0KHN0cnVjdCBp
bnRlbF9ndCAqZ3QpOwordm9pZCBnZW4xMV9ndF9pcnFfcG9zdGluc3RhbGwoc3RydWN0IGludGVs
X2d0ICpndCk7Cit2b2lkIGdlbjExX2d0X2lycV9oYW5kbGVyKHN0cnVjdCBpbnRlbF9ndCAqZ3Qs
IGNvbnN0IHUzMiBtYXN0ZXJfY3RsKTsKKworYm9vbCBnZW4xMV9ndF9yZXNldF9vbmVfaWlyKHN0
cnVjdCBpbnRlbF9ndCAqZ3QsCisJCQkgICAgY29uc3QgdW5zaWduZWQgaW50IGJhbmssCisJCQkg
ICAgY29uc3QgdW5zaWduZWQgaW50IGJpdCk7CisKK3ZvaWQgZ2VuNV9ndF9pcnFfaGFuZGxlcihz
dHJ1Y3QgaW50ZWxfZ3QgKmd0LCB1MzIgZ3RfaWlyKTsKKwordm9pZCBnZW41X2d0X2lycV9wb3N0
aW5zdGFsbChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KTsKK3ZvaWQgZ2VuNV9ndF9pcnFfcmVzZXQoc3Ry
dWN0IGludGVsX2d0ICpndCk7Cit2b2lkIGdlbjVfZ3RfZGlzYWJsZV9pcnEoc3RydWN0IGludGVs
X2d0ICpndCwgdTMyIG1hc2spOwordm9pZCBnZW41X2d0X2VuYWJsZV9pcnEoc3RydWN0IGludGVs
X2d0ICpndCwgdTMyIG1hc2spOworCit2b2lkIGdlbjZfZ3RfaXJxX2hhbmRsZXIoc3RydWN0IGlu
dGVsX2d0ICpndCwgdTMyIGd0X2lpcik7CisKK3ZvaWQgZ2VuOF9ndF9pcnFfYWNrKHN0cnVjdCBp
bnRlbF9ndCAqZ3QsIHUzMiBtYXN0ZXJfY3RsLCB1MzIgZ3RfaWlyWzRdKTsKK3ZvaWQgZ2VuOF9n
dF9pcnFfcmVzZXQoc3RydWN0IGludGVsX2d0ICpndCk7Cit2b2lkIGdlbjhfZ3RfaXJxX2hhbmRs
ZXIoc3RydWN0IGludGVsX2d0ICpndCwgdTMyIG1hc3Rlcl9jdGwsIHUzMiBndF9paXJbNF0pOwor
dm9pZCBnZW44X2d0X2lycV9wb3N0aW5zdGFsbChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KTsKKworI2Vu
ZGlmIC8qIElOVEVMX0dUX0lSUV9IICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9ndF9wbV9pcnEuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0
X3BtX2lycS5jCmluZGV4IDgzZTExYzJjYzVhYi4uYmFiZTg2NjEyNmQ3IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbV9pcnEuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbV9pcnEuYwpAQCAtNyw2ICs3LDcgQEAKICNpbmNsdWRl
ICJpOTE1X2Rydi5oIgogI2luY2x1ZGUgImk5MTVfcmVnLmgiCiAjaW5jbHVkZSAiaW50ZWxfZ3Qu
aCIKKyNpbmNsdWRlICJpbnRlbF9ndF9pcnEuaCIKICNpbmNsdWRlICJpbnRlbF9ndF9wbV9pcnEu
aCIKIAogc3RhdGljIHZvaWQgd3JpdGVfcG1faW1yKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90eXBlcy5oIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaAppbmRleCBiYjc1MjM2NGQ0NDcuLmFk
YWI0ZDJjMjlhYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3Rf
dHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90eXBlcy5oCkBA
IC03NCw2ICs3NCw3IEBAIHN0cnVjdCBpbnRlbF9ndCB7CiAJc3RydWN0IGk5MTVfdm1hICpzY3Jh
dGNoOwogCiAJc3BpbmxvY2tfdCBpcnFfbG9jazsKKwl1MzIgZ3RfaW1yOwogCXUzMiBwbV9pZXI7
CiAJdTMyIHBtX2ltcjsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfcmluZ2J1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZl
ci5jCmluZGV4IDE1YjAyNDY0MjJjNy4uNDA5ZDc2NGY4YzZkIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jCkBAIC0zNyw2ICszNyw3IEBACiAjaW5jbHVkZSAi
aTkxNV90cmFjZS5oIgogI2luY2x1ZGUgImludGVsX2NvbnRleHQuaCIKICNpbmNsdWRlICJpbnRl
bF9ndC5oIgorI2luY2x1ZGUgImludGVsX2d0X2lycS5oIgogI2luY2x1ZGUgImludGVsX2d0X3Bt
X2lycS5oIgogI2luY2x1ZGUgImludGVsX3Jlc2V0LmgiCiAjaW5jbHVkZSAiaW50ZWxfd29ya2Fy
b3VuZHMuaCIKQEAgLTk4MywxMyArOTg0LDEzIEBAIHN0YXRpYyB1MzIgKmdlbjVfZW1pdF9icmVh
ZGNydW1iKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCB1MzIgKmNzKQogc3RhdGljIHZvaWQKIGdl
bjVfaXJxX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7Ci0JZ2VuNV9l
bmFibGVfZ3RfaXJxKGVuZ2luZS0+aTkxNSwgZW5naW5lLT5pcnFfZW5hYmxlX21hc2spOworCWdl
bjVfZ3RfZW5hYmxlX2lycShlbmdpbmUtPmd0LCBlbmdpbmUtPmlycV9lbmFibGVfbWFzayk7CiB9
CiAKIHN0YXRpYyB2b2lkCiBnZW41X2lycV9kaXNhYmxlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZSkKIHsKLQlnZW41X2Rpc2FibGVfZ3RfaXJxKGVuZ2luZS0+aTkxNSwgZW5naW5lLT5p
cnFfZW5hYmxlX21hc2spOworCWdlbjVfZ3RfZGlzYWJsZV9pcnEoZW5naW5lLT5ndCwgZW5naW5l
LT5pcnFfZW5hYmxlX21hc2spOwogfQogCiBzdGF0aWMgdm9pZApAQCAtMTA1MCwxNCArMTA1MSwx
NCBAQCBnZW42X2lycV9lbmFibGUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCS8q
IEZsdXNoL2RlbGF5IHRvIGVuc3VyZSB0aGUgUklOR19JTVIgaXMgYWN0aXZlIGJlZm9yZSB0aGUg
R1QgSU1SICovCiAJRU5HSU5FX1BPU1RJTkdfUkVBRChlbmdpbmUsIFJJTkdfSU1SKTsKIAotCWdl
bjVfZW5hYmxlX2d0X2lycShlbmdpbmUtPmk5MTUsIGVuZ2luZS0+aXJxX2VuYWJsZV9tYXNrKTsK
KwlnZW41X2d0X2VuYWJsZV9pcnEoZW5naW5lLT5ndCwgZW5naW5lLT5pcnFfZW5hYmxlX21hc2sp
OwogfQogCiBzdGF0aWMgdm9pZAogZ2VuNl9pcnFfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmUpCiB7CiAJRU5HSU5FX1dSSVRFKGVuZ2luZSwgUklOR19JTVIsIH5lbmdpbmUt
PmlycV9rZWVwX21hc2spOwotCWdlbjVfZGlzYWJsZV9ndF9pcnEoZW5naW5lLT5pOTE1LCBlbmdp
bmUtPmlycV9lbmFibGVfbWFzayk7CisJZ2VuNV9ndF9kaXNhYmxlX2lycShlbmdpbmUtPmd0LCBl
bmdpbmUtPmlycV9lbmFibGVfbWFzayk7CiB9CiAKIHN0YXRpYyB2b2lkCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kcnYuaAppbmRleCAxOGJlOGIyNTBhN2MuLjM4ZDYzMjI4MTYwMSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2Rydi5oCkBAIC0xNDI3LDcgKzE0MjcsNiBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSB7
CiAJCXUzMiBpcnFfbWFzazsKIAkJdTMyIGRlX2lycV9tYXNrW0k5MTVfTUFYX1BJUEVTXTsKIAl9
OwotCXUzMiBndF9pcnFfbWFzazsKIAl1MzIgcG1fcnBzX2V2ZW50czsKIAl1MzIgcGlwZXN0YXRf
aXJxX21hc2tbSTkxNV9NQVhfUElQRVNdOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2lycS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuYwppbmRleCA1
Mzg5NzYxNzRhZDcuLmEzNmFlODIzYjIwYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9pcnEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2lycS5jCkBAIC00
NCw2ICs0NCw3IEBACiAjaW5jbHVkZSAiZGlzcGxheS9pbnRlbF9wc3IuaCIKIAogI2luY2x1ZGUg
Imd0L2ludGVsX2d0LmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfZ3RfaXJxLmgiCiAjaW5jbHVkZSAi
Z3QvaW50ZWxfZ3RfcG1faXJxLmgiCiAKICNpbmNsdWRlICJpOTE1X2Rydi5oIgpAQCAtMTc0LDgg
KzE3NSw4IEBAIHN0YXRpYyBjb25zdCB1MzIgaHBkX3RncFtIUERfTlVNX1BJTlNdID0gewogCVtI
UERfUE9SVF9JXSA9IFNERV9UQzZfSE9UUExVR19UR1AsCiB9OwogCi1zdGF0aWMgdm9pZCBnZW4z
X2lycV9yZXNldChzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUsIGk5MTVfcmVnX3QgaW1yLAot
CQkJICAgaTkxNV9yZWdfdCBpaXIsIGk5MTVfcmVnX3QgaWVyKQordm9pZCBnZW4zX2lycV9yZXNl
dChzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUsIGk5MTVfcmVnX3QgaW1yLAorCQkgICAgaTkx
NV9yZWdfdCBpaXIsIGk5MTVfcmVnX3QgaWVyKQogewogCWludGVsX3VuY29yZV93cml0ZSh1bmNv
cmUsIGltciwgMHhmZmZmZmZmZik7CiAJaW50ZWxfdW5jb3JlX3Bvc3RpbmdfcmVhZCh1bmNvcmUs
IGltcik7CkBAIC0xODksNyArMTkwLDcgQEAgc3RhdGljIHZvaWQgZ2VuM19pcnFfcmVzZXQoc3Ry
dWN0IGludGVsX3VuY29yZSAqdW5jb3JlLCBpOTE1X3JlZ190IGltciwKIAlpbnRlbF91bmNvcmVf
cG9zdGluZ19yZWFkKHVuY29yZSwgaWlyKTsKIH0KIAotc3RhdGljIHZvaWQgZ2VuMl9pcnFfcmVz
ZXQoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQordm9pZCBnZW4yX2lycV9yZXNldChzdHJ1
Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpCiB7CiAJaW50ZWxfdW5jb3JlX3dyaXRlMTYodW5jb3Jl
LCBHRU4yX0lNUiwgMHhmZmZmKTsKIAlpbnRlbF91bmNvcmVfcG9zdGluZ19yZWFkMTYodW5jb3Jl
LCBHRU4yX0lNUik7CkBAIC0yMDMsMTkgKzIwNCw2IEBAIHN0YXRpYyB2b2lkIGdlbjJfaXJxX3Jl
c2V0KHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSkKIAlpbnRlbF91bmNvcmVfcG9zdGluZ19y
ZWFkMTYodW5jb3JlLCBHRU4yX0lJUik7CiB9CiAKLSNkZWZpbmUgR0VOOF9JUlFfUkVTRVRfTkRY
KHVuY29yZSwgdHlwZSwgd2hpY2gpIFwKLSh7IFwKLQl1bnNpZ25lZCBpbnQgd2hpY2hfID0gd2hp
Y2g7IFwKLQlnZW4zX2lycV9yZXNldCgodW5jb3JlKSwgR0VOOF8jI3R5cGUjI19JTVIod2hpY2hf
KSwgXAotCQkgICAgICAgR0VOOF8jI3R5cGUjI19JSVIod2hpY2hfKSwgR0VOOF8jI3R5cGUjI19J
RVIod2hpY2hfKSk7IFwKLX0pCi0KLSNkZWZpbmUgR0VOM19JUlFfUkVTRVQodW5jb3JlLCB0eXBl
KSBcCi0JZ2VuM19pcnFfcmVzZXQoKHVuY29yZSksIHR5cGUjI0lNUiwgdHlwZSMjSUlSLCB0eXBl
IyNJRVIpCi0KLSNkZWZpbmUgR0VOMl9JUlFfUkVTRVQodW5jb3JlKSBcCi0JZ2VuMl9pcnFfcmVz
ZXQodW5jb3JlKQotCiAvKgogICogV2Ugc2hvdWxkIGNsZWFyIElNUiBhdCBwcmVpbnN0YWxsL3Vu
aW5zdGFsbCwgYW5kIGp1c3QgY2hlY2sgYXQgcG9zdGluc3RhbGwuCiAgKi8KQEAgLTI0OSwxMCAr
MjM3LDEwIEBAIHN0YXRpYyB2b2lkIGdlbjJfYXNzZXJ0X2lpcl9pc196ZXJvKHN0cnVjdCBpbnRl
bF91bmNvcmUgKnVuY29yZSkKIAlpbnRlbF91bmNvcmVfcG9zdGluZ19yZWFkMTYodW5jb3JlLCBH
RU4yX0lJUik7CiB9CiAKLXN0YXRpYyB2b2lkIGdlbjNfaXJxX2luaXQoc3RydWN0IGludGVsX3Vu
Y29yZSAqdW5jb3JlLAotCQkJICBpOTE1X3JlZ190IGltciwgdTMyIGltcl92YWwsCi0JCQkgIGk5
MTVfcmVnX3QgaWVyLCB1MzIgaWVyX3ZhbCwKLQkJCSAgaTkxNV9yZWdfdCBpaXIpCit2b2lkIGdl
bjNfaXJxX2luaXQoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlLAorCQkgICBpOTE1X3JlZ190
IGltciwgdTMyIGltcl92YWwsCisJCSAgIGk5MTVfcmVnX3QgaWVyLCB1MzIgaWVyX3ZhbCwKKwkJ
ICAgaTkxNV9yZWdfdCBpaXIpCiB7CiAJZ2VuM19hc3NlcnRfaWlyX2lzX3plcm8odW5jb3JlLCBp
aXIpOwogCkBAIC0yNjEsOCArMjQ5LDggQEAgc3RhdGljIHZvaWQgZ2VuM19pcnFfaW5pdChzdHJ1
Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUsCiAJaW50ZWxfdW5jb3JlX3Bvc3RpbmdfcmVhZCh1bmNv
cmUsIGltcik7CiB9CiAKLXN0YXRpYyB2b2lkIGdlbjJfaXJxX2luaXQoc3RydWN0IGludGVsX3Vu
Y29yZSAqdW5jb3JlLAotCQkJICB1MzIgaW1yX3ZhbCwgdTMyIGllcl92YWwpCit2b2lkIGdlbjJf
aXJxX2luaXQoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlLAorCQkgICB1MzIgaW1yX3ZhbCwg
dTMyIGllcl92YWwpCiB7CiAJZ2VuMl9hc3NlcnRfaWlyX2lzX3plcm8odW5jb3JlKTsKIApAQCAt
MjcxLDI3ICsyNTksNiBAQCBzdGF0aWMgdm9pZCBnZW4yX2lycV9pbml0KHN0cnVjdCBpbnRlbF91
bmNvcmUgKnVuY29yZSwKIAlpbnRlbF91bmNvcmVfcG9zdGluZ19yZWFkMTYodW5jb3JlLCBHRU4y
X0lNUik7CiB9CiAKLSNkZWZpbmUgR0VOOF9JUlFfSU5JVF9ORFgodW5jb3JlLCB0eXBlLCB3aGlj
aCwgaW1yX3ZhbCwgaWVyX3ZhbCkgXAotKHsgXAotCXVuc2lnbmVkIGludCB3aGljaF8gPSB3aGlj
aDsgXAotCWdlbjNfaXJxX2luaXQoKHVuY29yZSksIFwKLQkJICAgICAgR0VOOF8jI3R5cGUjI19J
TVIod2hpY2hfKSwgaW1yX3ZhbCwgXAotCQkgICAgICBHRU44XyMjdHlwZSMjX0lFUih3aGljaF8p
LCBpZXJfdmFsLCBcCi0JCSAgICAgIEdFTjhfIyN0eXBlIyNfSUlSKHdoaWNoXykpOyBcCi19KQot
Ci0jZGVmaW5lIEdFTjNfSVJRX0lOSVQodW5jb3JlLCB0eXBlLCBpbXJfdmFsLCBpZXJfdmFsKSBc
Ci0JZ2VuM19pcnFfaW5pdCgodW5jb3JlKSwgXAotCQkgICAgICB0eXBlIyNJTVIsIGltcl92YWws
IFwKLQkJICAgICAgdHlwZSMjSUVSLCBpZXJfdmFsLCBcCi0JCSAgICAgIHR5cGUjI0lJUikKLQot
I2RlZmluZSBHRU4yX0lSUV9JTklUKHVuY29yZSwgaW1yX3ZhbCwgaWVyX3ZhbCkgXAotCWdlbjJf
aXJxX2luaXQoKHVuY29yZSksIGltcl92YWwsIGllcl92YWwpCi0KLXN0YXRpYyB2b2lkIGdlbjZf
cnBzX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIHBt
X2lpcik7Ci1zdGF0aWMgdm9pZCBndWNfaXJxX2hhbmRsZXIoc3RydWN0IGludGVsX2d1YyAqZ3Vj
LCB1MTYgZ3VjX2lpcik7Ci0KIC8qIEZvciBkaXNwbGF5IGhvdHBsdWcgaW50ZXJydXB0ICovCiBz
dGF0aWMgaW5saW5lIHZvaWQKIGk5MTVfaG90cGx1Z19pbnRlcnJ1cHRfdXBkYXRlX2xvY2tlZChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCkBAIC0zMzAsNDEgKzI5Nyw2IEBAIHZv
aWQgaTkxNV9ob3RwbHVnX2ludGVycnVwdF91cGRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogCXNwaW5fdW5sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKIH0KIAot
c3RhdGljIHUzMgotZ2VuMTFfZ3RfZW5naW5lX2lkZW50aXR5KHN0cnVjdCBpbnRlbF9ndCAqZ3Qs
Ci0JCQkgY29uc3QgdW5zaWduZWQgaW50IGJhbmssIGNvbnN0IHVuc2lnbmVkIGludCBiaXQpOwot
Ci1zdGF0aWMgYm9vbCBnZW4xMV9yZXNldF9vbmVfaWlyKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCi0J
CQkJY29uc3QgdW5zaWduZWQgaW50IGJhbmssCi0JCQkJY29uc3QgdW5zaWduZWQgaW50IGJpdCkK
LXsKLQl2b2lkIF9faW9tZW0gKiBjb25zdCByZWdzID0gZ3QtPnVuY29yZS0+cmVnczsKLQl1MzIg
ZHc7Ci0KLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZndC0+aTkxNS0+aXJxX2xvY2spOwotCi0JZHcg
PSByYXdfcmVnX3JlYWQocmVncywgR0VOMTFfR1RfSU5UUl9EVyhiYW5rKSk7Ci0JaWYgKGR3ICYg
QklUKGJpdCkpIHsKLQkJLyoKLQkJICogQWNjb3JkaW5nIHRvIHRoZSBCU3BlYywgRFdfSUlSIGJp
dHMgY2Fubm90IGJlIGNsZWFyZWQgd2l0aG91dAotCQkgKiBmaXJzdCBzZXJ2aWNpbmcgdGhlIFNl
bGVjdG9yICYgU2hhcmVkIElJUiByZWdpc3RlcnMuCi0JCSAqLwotCQlnZW4xMV9ndF9lbmdpbmVf
aWRlbnRpdHkoZ3QsIGJhbmssIGJpdCk7Ci0KLQkJLyoKLQkJICogV2UgbG9ja2VkIEdUIElOVCBE
VyBieSByZWFkaW5nIGl0LiBJZiB3ZSB3YW50IHRvICh0cnkKLQkJICogdG8pIHJlY292ZXIgZnJv
bSB0aGlzIHN1Y2Nlc2Z1bGx5LCB3ZSBuZWVkIHRvIGNsZWFyCi0JCSAqIG91ciBiaXQsIG90aGVy
d2lzZSB3ZSBhcmUgbG9ja2luZyB0aGUgcmVnaXN0ZXIgZm9yCi0JCSAqIGV2ZXJ5Ym9keS4KLQkJ
ICovCi0JCXJhd19yZWdfd3JpdGUocmVncywgR0VOMTFfR1RfSU5UUl9EVyhiYW5rKSwgQklUKGJp
dCkpOwotCi0JCXJldHVybiB0cnVlOwotCX0KLQotCXJldHVybiBmYWxzZTsKLX0KLQogLyoqCiAg
KiBpbGtfdXBkYXRlX2Rpc3BsYXlfaXJxIC0gdXBkYXRlIERFSU1SCiAgKiBAZGV2X3ByaXY6IGRy
aXZlciBwcml2YXRlCkBAIC0zOTUsMzkgKzMyNyw2IEBAIHZvaWQgaWxrX3VwZGF0ZV9kaXNwbGF5
X2lycShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJfQogfQogCi0vKioKLSAq
IGlsa191cGRhdGVfZ3RfaXJxIC0gdXBkYXRlIEdUSU1SCi0gKiBAZGV2X3ByaXY6IGRyaXZlciBw
cml2YXRlCi0gKiBAaW50ZXJydXB0X21hc2s6IG1hc2sgb2YgaW50ZXJydXB0IGJpdHMgdG8gdXBk
YXRlCi0gKiBAZW5hYmxlZF9pcnFfbWFzazogbWFzayBvZiBpbnRlcnJ1cHQgYml0cyB0byBlbmFi
bGUKLSAqLwotc3RhdGljIHZvaWQgaWxrX3VwZGF0ZV9ndF9pcnEoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAotCQkJICAgICAgdTMyIGludGVycnVwdF9tYXNrLAotCQkJICAgICAg
dTMyIGVuYWJsZWRfaXJxX21hc2spCi17Ci0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYt
PmlycV9sb2NrKTsKLQotCVdBUk5fT04oZW5hYmxlZF9pcnFfbWFzayAmIH5pbnRlcnJ1cHRfbWFz
ayk7Ci0KLQlpZiAoV0FSTl9PTighaW50ZWxfaXJxc19lbmFibGVkKGRldl9wcml2KSkpCi0JCXJl
dHVybjsKLQotCWRldl9wcml2LT5ndF9pcnFfbWFzayAmPSB+aW50ZXJydXB0X21hc2s7Ci0JZGV2
X3ByaXYtPmd0X2lycV9tYXNrIHw9ICh+ZW5hYmxlZF9pcnFfbWFzayAmIGludGVycnVwdF9tYXNr
KTsKLQlJOTE1X1dSSVRFKEdUSU1SLCBkZXZfcHJpdi0+Z3RfaXJxX21hc2spOwotfQotCi12b2lk
IGdlbjVfZW5hYmxlX2d0X2lycShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUz
MiBtYXNrKQotewotCWlsa191cGRhdGVfZ3RfaXJxKGRldl9wcml2LCBtYXNrLCBtYXNrKTsKLQlp
bnRlbF91bmNvcmVfcG9zdGluZ19yZWFkX2Z3KCZkZXZfcHJpdi0+dW5jb3JlLCBHVElNUik7Ci19
Ci0KLXZvaWQgZ2VuNV9kaXNhYmxlX2d0X2lycShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsIHUzMiBtYXNrKQotewotCWlsa191cGRhdGVfZ3RfaXJxKGRldl9wcml2LCBtYXNrLCAw
KTsKLX0KLQogc3RhdGljIGk5MTVfcmVnX3QgZ2VuNl9wbV9paXIoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQogewogCVdBUk5fT05fT05DRShJTlRFTF9HRU4oZGV2X3ByaXYpID49
IDExKTsKQEAgLTQ0MSw3ICszNDAsNyBAQCB2b2lkIGdlbjExX3Jlc2V0X3Jwc19pbnRlcnJ1cHRz
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogCXNwaW5fbG9ja19pcnEoJmd0
LT5pcnFfbG9jayk7CiAKLQl3aGlsZSAoZ2VuMTFfcmVzZXRfb25lX2lpcihndCwgMCwgR0VOMTFf
R1RQTSkpCisJd2hpbGUgKGdlbjExX2d0X3Jlc2V0X29uZV9paXIoZ3QsIDAsIEdFTjExX0dUUE0p
KQogCQk7CiAKIAlkZXZfcHJpdi0+Z3RfcG0ucnBzLnBtX2lpciA9IDA7CkBAIC00NzEsNyArMzcw
LDcgQEAgdm9pZCBnZW42X2VuYWJsZV9ycHNfaW50ZXJydXB0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCiAJV0FSTl9PTl9PTkNFKHJwcy0+cG1faWlyKTsKIAogCWlmIChJTlRF
TF9HRU4oZGV2X3ByaXYpID49IDExKQotCQlXQVJOX09OX09OQ0UoZ2VuMTFfcmVzZXRfb25lX2lp
cihndCwgMCwgR0VOMTFfR1RQTSkpOworCQlXQVJOX09OX09OQ0UoZ2VuMTFfZ3RfcmVzZXRfb25l
X2lpcihndCwgMCwgR0VOMTFfR1RQTSkpOwogCWVsc2UKIAkJV0FSTl9PTl9PTkNFKEk5MTVfUkVB
RChnZW42X3BtX2lpcihkZXZfcHJpdikpICYgZGV2X3ByaXYtPnBtX3Jwc19ldmVudHMpOwogCkBA
IC01NjYsNyArNDY1LDcgQEAgdm9pZCBnZW4xMV9yZXNldF9ndWNfaW50ZXJydXB0cyhzdHJ1Y3Qg
aW50ZWxfZ3VjICpndWMpCiAJc3RydWN0IGludGVsX2d0ICpndCA9IGd1Y190b19ndChndWMpOwog
CiAJc3Bpbl9sb2NrX2lycSgmZ3QtPmlycV9sb2NrKTsKLQlnZW4xMV9yZXNldF9vbmVfaWlyKGd0
LCAwLCBHRU4xMV9HVUMpOworCWdlbjExX2d0X3Jlc2V0X29uZV9paXIoZ3QsIDAsIEdFTjExX0dV
Qyk7CiAJc3Bpbl91bmxvY2tfaXJxKCZndC0+aXJxX2xvY2spOwogfQogCkBAIC01NzgsNyArNDc3
LDcgQEAgdm9pZCBnZW4xMV9lbmFibGVfZ3VjX2ludGVycnVwdHMoc3RydWN0IGludGVsX2d1YyAq
Z3VjKQogCWlmICghZ3VjLT5pbnRlcnJ1cHRzLmVuYWJsZWQpIHsKIAkJdTMyIGV2ZW50cyA9IFJF
R19GSUVMRF9QUkVQKEVOR0lORTFfTUFTSywgR1VDX0lOVFJfR1VDMkhPU1QpOwogCi0JCVdBUk5f
T05fT05DRShnZW4xMV9yZXNldF9vbmVfaWlyKGd0LCAwLCBHRU4xMV9HVUMpKTsKKwkJV0FSTl9P
Tl9PTkNFKGdlbjExX2d0X3Jlc2V0X29uZV9paXIoZ3QsIDAsIEdFTjExX0dVQykpOwogCQlpbnRl
bF91bmNvcmVfd3JpdGUoZ3QtPnVuY29yZSwgR0VOMTFfR1VDX1NHX0lOVFJfRU5BQkxFLCBldmVu
dHMpOwogCQlpbnRlbF91bmNvcmVfd3JpdGUoZ3QtPnVuY29yZSwgR0VOMTFfR1VDX1NHX0lOVFJf
TUFTSywgfmV2ZW50cyk7CiAJCWd1Yy0+aW50ZXJydXB0cy5lbmFibGVkID0gdHJ1ZTsKQEAgLTEz
NzksNiArMTI3OCw3IEBAIHN0YXRpYyB2b2lkIGl2eWJyaWRnZV9wYXJpdHlfd29yayhzdHJ1Y3Qg
d29ya19zdHJ1Y3QgKndvcmspCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0KIAkJY29udGFpbmVyX29mKHdvcmssIHR5cGVvZigqZGV2X3ByaXYpLCBsM19wYXJpdHkuZXJy
b3Jfd29yayk7CisJc3RydWN0IGludGVsX2d0ICpndCA9ICZkZXZfcHJpdi0+Z3Q7CiAJdTMyIGVy
cm9yX3N0YXR1cywgcm93LCBiYW5rLCBzdWJiYW5rOwogCWNoYXIgKnBhcml0eV9ldmVudFs2XTsK
IAl1MzIgbWlzY2NwY3RsOwpAQCAtMTQ0MCwxNDQgKzEzNDAsMTMgQEAgc3RhdGljIHZvaWQgaXZ5
YnJpZGdlX3Bhcml0eV93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAogb3V0OgogCVdB
Uk5fT04oZGV2X3ByaXYtPmwzX3Bhcml0eS53aGljaF9zbGljZSk7Ci0Jc3Bpbl9sb2NrX2lycSgm
ZGV2X3ByaXYtPmlycV9sb2NrKTsKLQlnZW41X2VuYWJsZV9ndF9pcnEoZGV2X3ByaXYsIEdUX1BB
UklUWV9FUlJPUihkZXZfcHJpdikpOwotCXNwaW5fdW5sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9s
b2NrKTsKKwlzcGluX2xvY2tfaXJxKCZndC0+aXJxX2xvY2spOworCWdlbjVfZ3RfZW5hYmxlX2ly
cShndCwgR1RfUEFSSVRZX0VSUk9SKGRldl9wcml2KSk7CisJc3Bpbl91bmxvY2tfaXJxKCZndC0+
aXJxX2xvY2spOwogCiAJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7
CiB9CiAKLXN0YXRpYyB2b2lkIGl2eWJyaWRnZV9wYXJpdHlfZXJyb3JfaXJxX2hhbmRsZXIoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAotCQkJCQkgICAgICAgdTMyIGlpcikKLXsK
LQlpZiAoIUhBU19MM19EUEYoZGV2X3ByaXYpKQotCQlyZXR1cm47Ci0KLQlzcGluX2xvY2soJmRl
dl9wcml2LT5pcnFfbG9jayk7Ci0JZ2VuNV9kaXNhYmxlX2d0X2lycShkZXZfcHJpdiwgR1RfUEFS
SVRZX0VSUk9SKGRldl9wcml2KSk7Ci0Jc3Bpbl91bmxvY2soJmRldl9wcml2LT5pcnFfbG9jayk7
Ci0KLQlpaXIgJj0gR1RfUEFSSVRZX0VSUk9SKGRldl9wcml2KTsKLQlpZiAoaWlyICYgR1RfUkVO
REVSX0wzX1BBUklUWV9FUlJPUl9JTlRFUlJVUFRfUzEpCi0JCWRldl9wcml2LT5sM19wYXJpdHku
d2hpY2hfc2xpY2UgfD0gMSA8PCAxOwotCi0JaWYgKGlpciAmIEdUX1JFTkRFUl9MM19QQVJJVFlf
RVJST1JfSU5URVJSVVBUKQotCQlkZXZfcHJpdi0+bDNfcGFyaXR5LndoaWNoX3NsaWNlIHw9IDEg
PDwgMDsKLQotCXF1ZXVlX3dvcmsoZGV2X3ByaXYtPndxLCAmZGV2X3ByaXYtPmwzX3Bhcml0eS5l
cnJvcl93b3JrKTsKLX0KLQotc3RhdGljIHZvaWQgaWxrX2d0X2lycV9oYW5kbGVyKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCSAgICAgICB1MzIgZ3RfaWlyKQotewotCWlm
IChndF9paXIgJiBHVF9SRU5ERVJfVVNFUl9JTlRFUlJVUFQpCi0JCWludGVsX2VuZ2luZV9icmVh
ZGNydW1ic19pcnEoZGV2X3ByaXYtPmVuZ2luZVtSQ1MwXSk7Ci0JaWYgKGd0X2lpciAmIElMS19C
U0RfVVNFUl9JTlRFUlJVUFQpCi0JCWludGVsX2VuZ2luZV9icmVhZGNydW1ic19pcnEoZGV2X3By
aXYtPmVuZ2luZVtWQ1MwXSk7Ci19Ci0KLXN0YXRpYyB2b2lkIHNuYl9ndF9pcnFfaGFuZGxlcihz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCi0JCQkgICAgICAgdTMyIGd0X2lpcikK
LXsKLQlpZiAoZ3RfaWlyICYgR1RfUkVOREVSX1VTRVJfSU5URVJSVVBUKQotCQlpbnRlbF9lbmdp
bmVfYnJlYWRjcnVtYnNfaXJxKGRldl9wcml2LT5lbmdpbmVbUkNTMF0pOwotCWlmIChndF9paXIg
JiBHVF9CU0RfVVNFUl9JTlRFUlJVUFQpCi0JCWludGVsX2VuZ2luZV9icmVhZGNydW1ic19pcnEo
ZGV2X3ByaXYtPmVuZ2luZVtWQ1MwXSk7Ci0JaWYgKGd0X2lpciAmIEdUX0JMVF9VU0VSX0lOVEVS
UlVQVCkKLQkJaW50ZWxfZW5naW5lX2JyZWFkY3J1bWJzX2lycShkZXZfcHJpdi0+ZW5naW5lW0JD
UzBdKTsKLQotCWlmIChndF9paXIgJiAoR1RfQkxUX0NTX0VSUk9SX0lOVEVSUlVQVCB8Ci0JCSAg
ICAgIEdUX0JTRF9DU19FUlJPUl9JTlRFUlJVUFQgfAotCQkgICAgICBHVF9SRU5ERVJfQ1NfTUFT
VEVSX0VSUk9SX0lOVEVSUlVQVCkpCi0JCURSTV9ERUJVRygiQ29tbWFuZCBwYXJzZXIgZXJyb3Is
IGd0X2lpciAweCUwOHhcbiIsIGd0X2lpcik7Ci0KLQlpZiAoZ3RfaWlyICYgR1RfUEFSSVRZX0VS
Uk9SKGRldl9wcml2KSkKLQkJaXZ5YnJpZGdlX3Bhcml0eV9lcnJvcl9pcnFfaGFuZGxlcihkZXZf
cHJpdiwgZ3RfaWlyKTsKLX0KLQotc3RhdGljIHZvaWQKLWdlbjhfY3NfaXJxX2hhbmRsZXIoc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCB1MzIgaWlyKQotewotCWJvb2wgdGFza2xldCA9
IGZhbHNlOwotCi0JaWYgKGlpciAmIEdUX0NPTlRFWFRfU1dJVENIX0lOVEVSUlVQVCkKLQkJdGFz
a2xldCA9IHRydWU7Ci0KLQlpZiAoaWlyICYgR1RfUkVOREVSX1VTRVJfSU5URVJSVVBUKSB7Ci0J
CWludGVsX2VuZ2luZV9icmVhZGNydW1ic19pcnEoZW5naW5lKTsKLQkJdGFza2xldCB8PSBpbnRl
bF9lbmdpbmVfbmVlZHNfYnJlYWRjcnVtYl90YXNrbGV0KGVuZ2luZSk7Ci0JfQotCi0JaWYgKHRh
c2tsZXQpCi0JCXRhc2tsZXRfaGlfc2NoZWR1bGUoJmVuZ2luZS0+ZXhlY2xpc3RzLnRhc2tsZXQp
OwotfQotCi1zdGF0aWMgdm9pZCBnZW44X2d0X2lycV9hY2soc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCi0JCQkgICAgdTMyIG1hc3Rlcl9jdGwsIHUzMiBndF9paXJbNF0pCi17Ci0Jdm9p
ZCBfX2lvbWVtICogY29uc3QgcmVncyA9IGk5MTUtPnVuY29yZS5yZWdzOwotCi0jZGVmaW5lIEdF
TjhfR1RfSVJRUyAoR0VOOF9HVF9SQ1NfSVJRIHwgXAotCQkgICAgICBHRU44X0dUX0JDU19JUlEg
fCBcCi0JCSAgICAgIEdFTjhfR1RfVkNTMF9JUlEgfCBcCi0JCSAgICAgIEdFTjhfR1RfVkNTMV9J
UlEgfCBcCi0JCSAgICAgIEdFTjhfR1RfVkVDU19JUlEgfCBcCi0JCSAgICAgIEdFTjhfR1RfUE1f
SVJRIHwgXAotCQkgICAgICBHRU44X0dUX0dVQ19JUlEpCi0KLQlpZiAobWFzdGVyX2N0bCAmIChH
RU44X0dUX1JDU19JUlEgfCBHRU44X0dUX0JDU19JUlEpKSB7Ci0JCWd0X2lpclswXSA9IHJhd19y
ZWdfcmVhZChyZWdzLCBHRU44X0dUX0lJUigwKSk7Ci0JCWlmIChsaWtlbHkoZ3RfaWlyWzBdKSkK
LQkJCXJhd19yZWdfd3JpdGUocmVncywgR0VOOF9HVF9JSVIoMCksIGd0X2lpclswXSk7Ci0JfQot
Ci0JaWYgKG1hc3Rlcl9jdGwgJiAoR0VOOF9HVF9WQ1MwX0lSUSB8IEdFTjhfR1RfVkNTMV9JUlEp
KSB7Ci0JCWd0X2lpclsxXSA9IHJhd19yZWdfcmVhZChyZWdzLCBHRU44X0dUX0lJUigxKSk7Ci0J
CWlmIChsaWtlbHkoZ3RfaWlyWzFdKSkKLQkJCXJhd19yZWdfd3JpdGUocmVncywgR0VOOF9HVF9J
SVIoMSksIGd0X2lpclsxXSk7Ci0JfQotCi0JaWYgKG1hc3Rlcl9jdGwgJiAoR0VOOF9HVF9QTV9J
UlEgfCBHRU44X0dUX0dVQ19JUlEpKSB7Ci0JCWd0X2lpclsyXSA9IHJhd19yZWdfcmVhZChyZWdz
LCBHRU44X0dUX0lJUigyKSk7Ci0JCWlmIChsaWtlbHkoZ3RfaWlyWzJdKSkKLQkJCXJhd19yZWdf
d3JpdGUocmVncywgR0VOOF9HVF9JSVIoMiksIGd0X2lpclsyXSk7Ci0JfQotCi0JaWYgKG1hc3Rl
cl9jdGwgJiBHRU44X0dUX1ZFQ1NfSVJRKSB7Ci0JCWd0X2lpclszXSA9IHJhd19yZWdfcmVhZChy
ZWdzLCBHRU44X0dUX0lJUigzKSk7Ci0JCWlmIChsaWtlbHkoZ3RfaWlyWzNdKSkKLQkJCXJhd19y
ZWdfd3JpdGUocmVncywgR0VOOF9HVF9JSVIoMyksIGd0X2lpclszXSk7Ci0JfQotfQotCi1zdGF0
aWMgdm9pZCBnZW44X2d0X2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LAotCQkJCXUzMiBtYXN0ZXJfY3RsLCB1MzIgZ3RfaWlyWzRdKQotewotCWlmIChtYXN0ZXJfY3Rs
ICYgKEdFTjhfR1RfUkNTX0lSUSB8IEdFTjhfR1RfQkNTX0lSUSkpIHsKLQkJZ2VuOF9jc19pcnFf
aGFuZGxlcihpOTE1LT5lbmdpbmVbUkNTMF0sCi0JCQkJICAgIGd0X2lpclswXSA+PiBHRU44X1JD
U19JUlFfU0hJRlQpOwotCQlnZW44X2NzX2lycV9oYW5kbGVyKGk5MTUtPmVuZ2luZVtCQ1MwXSwK
LQkJCQkgICAgZ3RfaWlyWzBdID4+IEdFTjhfQkNTX0lSUV9TSElGVCk7Ci0JfQotCi0JaWYgKG1h
c3Rlcl9jdGwgJiAoR0VOOF9HVF9WQ1MwX0lSUSB8IEdFTjhfR1RfVkNTMV9JUlEpKSB7Ci0JCWdl
bjhfY3NfaXJxX2hhbmRsZXIoaTkxNS0+ZW5naW5lW1ZDUzBdLAotCQkJCSAgICBndF9paXJbMV0g
Pj4gR0VOOF9WQ1MwX0lSUV9TSElGVCk7Ci0JCWdlbjhfY3NfaXJxX2hhbmRsZXIoaTkxNS0+ZW5n
aW5lW1ZDUzFdLAotCQkJCSAgICBndF9paXJbMV0gPj4gR0VOOF9WQ1MxX0lSUV9TSElGVCk7Ci0J
fQotCi0JaWYgKG1hc3Rlcl9jdGwgJiBHRU44X0dUX1ZFQ1NfSVJRKSB7Ci0JCWdlbjhfY3NfaXJx
X2hhbmRsZXIoaTkxNS0+ZW5naW5lW1ZFQ1MwXSwKLQkJCQkgICAgZ3RfaWlyWzNdID4+IEdFTjhf
VkVDU19JUlFfU0hJRlQpOwotCX0KLQotCWlmIChtYXN0ZXJfY3RsICYgKEdFTjhfR1RfUE1fSVJR
IHwgR0VOOF9HVF9HVUNfSVJRKSkgewotCQlnZW42X3Jwc19pcnFfaGFuZGxlcihpOTE1LCBndF9p
aXJbMl0pOwotCQlndWNfaXJxX2hhbmRsZXIoJmk5MTUtPmd0LnVjLmd1YywgZ3RfaWlyWzJdID4+
IDE2KTsKLQl9Ci19Ci0KIHN0YXRpYyBib29sIGdlbjExX3BvcnRfaG90cGx1Z19sb25nX2RldGVj
dChlbnVtIGhwZF9waW4gcGluLCB1MzIgdmFsKQogewogCXN3aXRjaCAocGluKSB7CkBAIC0xODg2
LDcgKzE2NTUsNyBAQCBzdGF0aWMgdm9pZCBpOXh4X3BpcGVfY3JjX2lycV9oYW5kbGVyKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIC8qIFRoZSBSUFMgZXZlbnRzIG5lZWQgZm9y
Y2V3YWtlLCBzbyB3ZSBhZGQgdGhlbSB0byBhIHdvcmsgcXVldWUgYW5kIG1hc2sgdGhlaXIKICAq
IElNUiBiaXRzIHVudGlsIHRoZSB3b3JrIGlzIGRvbmUuIE90aGVyIGludGVycnVwdHMgY2FuIGJl
IHByb2Nlc3NlZCB3aXRob3V0CiAgKiB0aGUgd29yayBxdWV1ZS4gKi8KLXN0YXRpYyB2b2lkIGdl
bjExX3Jwc19pcnFfaGFuZGxlcihzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCB1MzIgcG1faWlyKQordm9p
ZCBnZW4xMV9ycHNfaXJxX2hhbmRsZXIoc3RydWN0IGludGVsX2d0ICpndCwgdTMyIHBtX2lpcikK
IHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGd0LT5pOTE1OwogCXN0cnVjdCBp
bnRlbF9ycHMgKnJwcyA9ICZpOTE1LT5ndF9wbS5ycHM7CkBAIC0xOTA2LDcgKzE2NzUsNyBAQCBz
dGF0aWMgdm9pZCBnZW4xMV9ycHNfaXJxX2hhbmRsZXIoc3RydWN0IGludGVsX2d0ICpndCwgdTMy
IHBtX2lpcikKIAlzY2hlZHVsZV93b3JrKCZycHMtPndvcmspOwogfQogCi1zdGF0aWMgdm9pZCBn
ZW42X3Jwc19pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUz
MiBwbV9paXIpCit2b2lkIGdlbjZfcnBzX2lycV9oYW5kbGVyKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwgdTMyIHBtX2lpcikKIHsKIAlzdHJ1Y3QgaW50ZWxfcnBzICpycHMgPSAm
ZGV2X3ByaXYtPmd0X3BtLnJwczsKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gJmRldl9wcml2LT5n
dDsKQEAgLTE5MzEsMTIgKzE3MDAsNiBAQCBzdGF0aWMgdm9pZCBnZW42X3Jwc19pcnFfaGFuZGxl
cihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBwbV9paXIpCiAJCURSTV9E
RUJVRygiQ29tbWFuZCBwYXJzZXIgZXJyb3IsIHBtX2lpciAweCUwOHhcbiIsIHBtX2lpcik7CiB9
CiAKLXN0YXRpYyB2b2lkIGd1Y19pcnFfaGFuZGxlcihzdHJ1Y3QgaW50ZWxfZ3VjICpndWMsIHUx
NiBpaXIpCi17Ci0JaWYgKGlpciAmIEdVQ19JTlRSX0dVQzJIT1NUKQotCQlpbnRlbF9ndWNfdG9f
aG9zdF9ldmVudF9oYW5kbGVyKGd1Yyk7Ci19Ci0KIHN0YXRpYyB2b2lkIGk5eHhfcGlwZXN0YXRf
aXJxX3Jlc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKIAllbnVtIHBp
cGUgcGlwZTsKQEAgLTIyNDQsNyArMjAwNyw3IEBAIHN0YXRpYyBpcnFyZXR1cm5fdCB2YWxsZXl2
aWV3X2lycV9oYW5kbGVyKGludCBpcnEsIHZvaWQgKmFyZykKIAkJSTkxNV9XUklURShWTFZfTUFT
VEVSX0lFUiwgTUFTVEVSX0lOVEVSUlVQVF9FTkFCTEUpOwogCiAJCWlmIChndF9paXIpCi0JCQlz
bmJfZ3RfaXJxX2hhbmRsZXIoZGV2X3ByaXYsIGd0X2lpcik7CisJCQlnZW42X2d0X2lycV9oYW5k
bGVyKCZkZXZfcHJpdi0+Z3QsIGd0X2lpcik7CiAJCWlmIChwbV9paXIpCiAJCQlnZW42X3Jwc19p
cnFfaGFuZGxlcihkZXZfcHJpdiwgcG1faWlyKTsKIApAQCAtMjMwMiw3ICsyMDY1LDcgQEAgc3Rh
dGljIGlycXJldHVybl90IGNoZXJyeXZpZXdfaXJxX2hhbmRsZXIoaW50IGlycSwgdm9pZCAqYXJn
KQogCQlpZXIgPSBJOTE1X1JFQUQoVkxWX0lFUik7CiAJCUk5MTVfV1JJVEUoVkxWX0lFUiwgMCk7
CiAKLQkJZ2VuOF9ndF9pcnFfYWNrKGRldl9wcml2LCBtYXN0ZXJfY3RsLCBndF9paXIpOworCQln
ZW44X2d0X2lycV9hY2soJmRldl9wcml2LT5ndCwgbWFzdGVyX2N0bCwgZ3RfaWlyKTsKIAogCQlp
ZiAoaWlyICYgSTkxNV9ESVNQTEFZX1BPUlRfSU5URVJSVVBUKQogCQkJaG90cGx1Z19zdGF0dXMg
PSBpOXh4X2hwZF9pcnFfYWNrKGRldl9wcml2KTsKQEAgLTIzMjYsNyArMjA4OSw3IEBAIHN0YXRp
YyBpcnFyZXR1cm5fdCBjaGVycnl2aWV3X2lycV9oYW5kbGVyKGludCBpcnEsIHZvaWQgKmFyZykK
IAkJSTkxNV9XUklURShWTFZfSUVSLCBpZXIpOwogCQlJOTE1X1dSSVRFKEdFTjhfTUFTVEVSX0lS
USwgR0VOOF9NQVNURVJfSVJRX0NPTlRST0wpOwogCi0JCWdlbjhfZ3RfaXJxX2hhbmRsZXIoZGV2
X3ByaXYsIG1hc3Rlcl9jdGwsIGd0X2lpcik7CisJCWdlbjhfZ3RfaXJxX2hhbmRsZXIoJmRldl9w
cml2LT5ndCwgbWFzdGVyX2N0bCwgZ3RfaWlyKTsKIAogCQlpZiAoaG90cGx1Z19zdGF0dXMpCiAJ
CQlpOXh4X2hwZF9pcnFfaGFuZGxlcihkZXZfcHJpdiwgaG90cGx1Z19zdGF0dXMpOwpAQCAtMjc1
Niw5ICsyNTE5LDkgQEAgc3RhdGljIGlycXJldHVybl90IGlyb25sYWtlX2lycV9oYW5kbGVyKGlu
dCBpcnEsIHZvaWQgKmFyZykKIAkJSTkxNV9XUklURShHVElJUiwgZ3RfaWlyKTsKIAkJcmV0ID0g
SVJRX0hBTkRMRUQ7CiAJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDYpCi0JCQlzbmJfZ3Rf
aXJxX2hhbmRsZXIoZGV2X3ByaXYsIGd0X2lpcik7CisJCQlnZW42X2d0X2lycV9oYW5kbGVyKCZk
ZXZfcHJpdi0+Z3QsIGd0X2lpcik7CiAJCWVsc2UKLQkJCWlsa19ndF9pcnFfaGFuZGxlcihkZXZf
cHJpdiwgZ3RfaWlyKTsKKwkJCWdlbjVfZ3RfaXJxX2hhbmRsZXIoJmRldl9wcml2LT5ndCwgZ3Rf
aWlyKTsKIAl9CiAKIAlkZV9paXIgPSBJOTE1X1JFQUQoREVJSVIpOwpAQCAtMzA2OSw3ICsyODMy
LDcgQEAgc3RhdGljIGlycXJldHVybl90IGdlbjhfaXJxX2hhbmRsZXIoaW50IGlycSwgdm9pZCAq
YXJnKQogCX0KIAogCS8qIEZpbmQsIGNsZWFyLCB0aGVuIHByb2Nlc3MgZWFjaCBzb3VyY2Ugb2Yg
aW50ZXJydXB0ICovCi0JZ2VuOF9ndF9pcnFfYWNrKGRldl9wcml2LCBtYXN0ZXJfY3RsLCBndF9p
aXIpOworCWdlbjhfZ3RfaXJxX2FjaygmZGV2X3ByaXYtPmd0LCBtYXN0ZXJfY3RsLCBndF9paXIp
OwogCiAJLyogSVJRcyBhcmUgc3luY2VkIGR1cmluZyBydW50aW1lX3N1c3BlbmQsIHdlIGRvbid0
IHJlcXVpcmUgYSB3YWtlcmVmICovCiAJaWYgKG1hc3Rlcl9jdGwgJiB+R0VOOF9HVF9JUlFTKSB7
CkBAIC0zMDgwLDEzNCArMjg0MywxMSBAQCBzdGF0aWMgaXJxcmV0dXJuX3QgZ2VuOF9pcnFfaGFu
ZGxlcihpbnQgaXJxLCB2b2lkICphcmcpCiAKIAlnZW44X21hc3Rlcl9pbnRyX2VuYWJsZShyZWdz
KTsKIAotCWdlbjhfZ3RfaXJxX2hhbmRsZXIoZGV2X3ByaXYsIG1hc3Rlcl9jdGwsIGd0X2lpcik7
CisJZ2VuOF9ndF9pcnFfaGFuZGxlcigmZGV2X3ByaXYtPmd0LCBtYXN0ZXJfY3RsLCBndF9paXIp
OwogCiAJcmV0dXJuIElSUV9IQU5ETEVEOwogfQogCi1zdGF0aWMgdTMyCi1nZW4xMV9ndF9lbmdp
bmVfaWRlbnRpdHkoc3RydWN0IGludGVsX2d0ICpndCwKLQkJCSBjb25zdCB1bnNpZ25lZCBpbnQg
YmFuaywgY29uc3QgdW5zaWduZWQgaW50IGJpdCkKLXsKLQl2b2lkIF9faW9tZW0gKiBjb25zdCBy
ZWdzID0gZ3QtPnVuY29yZS0+cmVnczsKLQl1MzIgdGltZW91dF90czsKLQl1MzIgaWRlbnQ7Ci0K
LQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZndC0+aTkxNS0+aXJxX2xvY2spOwotCi0JcmF3X3JlZ193
cml0ZShyZWdzLCBHRU4xMV9JSVJfUkVHX1NFTEVDVE9SKGJhbmspLCBCSVQoYml0KSk7Ci0KLQkv
KgotCSAqIE5COiBTcGVjcyBkbyBub3Qgc3BlY2lmeSBob3cgbG9uZyB0byBzcGluIHdhaXQsCi0J
ICogc28gd2UgZG8gfjEwMHVzIGFzIGFuIGVkdWNhdGVkIGd1ZXNzLgotCSAqLwotCXRpbWVvdXRf
dHMgPSAobG9jYWxfY2xvY2soKSA+PiAxMCkgKyAxMDA7Ci0JZG8gewotCQlpZGVudCA9IHJhd19y
ZWdfcmVhZChyZWdzLCBHRU4xMV9JTlRSX0lERU5USVRZX1JFRyhiYW5rKSk7Ci0JfSB3aGlsZSAo
IShpZGVudCAmIEdFTjExX0lOVFJfREFUQV9WQUxJRCkgJiYKLQkJICF0aW1lX2FmdGVyMzIobG9j
YWxfY2xvY2soKSA+PiAxMCwgdGltZW91dF90cykpOwotCi0JaWYgKHVubGlrZWx5KCEoaWRlbnQg
JiBHRU4xMV9JTlRSX0RBVEFfVkFMSUQpKSkgewotCQlEUk1fRVJST1IoIklOVFJfSURFTlRJVFlf
UkVHJXU6JXUgMHglMDh4IG5vdCB2YWxpZCFcbiIsCi0JCQkgIGJhbmssIGJpdCwgaWRlbnQpOwot
CQlyZXR1cm4gMDsKLQl9Ci0KLQlyYXdfcmVnX3dyaXRlKHJlZ3MsIEdFTjExX0lOVFJfSURFTlRJ
VFlfUkVHKGJhbmspLAotCQkgICAgICBHRU4xMV9JTlRSX0RBVEFfVkFMSUQpOwotCi0JcmV0dXJu
IGlkZW50OwotfQotCi1zdGF0aWMgdm9pZAotZ2VuMTFfb3RoZXJfaXJxX2hhbmRsZXIoc3RydWN0
IGludGVsX2d0ICpndCwgY29uc3QgdTggaW5zdGFuY2UsCi0JCQljb25zdCB1MTYgaWlyKQotewot
CWlmIChpbnN0YW5jZSA9PSBPVEhFUl9HVUNfSU5TVEFOQ0UpCi0JCXJldHVybiBndWNfaXJxX2hh
bmRsZXIoJmd0LT51Yy5ndWMsIGlpcik7Ci0KLQlpZiAoaW5zdGFuY2UgPT0gT1RIRVJfR1RQTV9J
TlNUQU5DRSkKLQkJcmV0dXJuIGdlbjExX3Jwc19pcnFfaGFuZGxlcihndCwgaWlyKTsKLQotCVdB
Uk5fT05DRSgxLCAidW5oYW5kbGVkIG90aGVyIGludGVycnVwdCBpbnN0YW5jZT0weCV4LCBpaXI9
MHgleFxuIiwKLQkJICBpbnN0YW5jZSwgaWlyKTsKLX0KLQotc3RhdGljIHZvaWQKLWdlbjExX2Vu
Z2luZV9pcnFfaGFuZGxlcihzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBjb25zdCB1OCBjbGFzcywKLQkJ
CSBjb25zdCB1OCBpbnN0YW5jZSwgY29uc3QgdTE2IGlpcikKLXsKLQlzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmU7Ci0KLQlpZiAoaW5zdGFuY2UgPD0gTUFYX0VOR0lORV9JTlNUQU5DRSkK
LQkJZW5naW5lID0gZ3QtPmVuZ2luZV9jbGFzc1tjbGFzc11baW5zdGFuY2VdOwotCWVsc2UKLQkJ
ZW5naW5lID0gTlVMTDsKLQotCWlmIChsaWtlbHkoZW5naW5lKSkKLQkJcmV0dXJuIGdlbjhfY3Nf
aXJxX2hhbmRsZXIoZW5naW5lLCBpaXIpOwotCi0JV0FSTl9PTkNFKDEsICJ1bmhhbmRsZWQgZW5n
aW5lIGludGVycnVwdCBjbGFzcz0weCV4LCBpbnN0YW5jZT0weCV4XG4iLAotCQkgIGNsYXNzLCBp
bnN0YW5jZSk7Ci19Ci0KLXN0YXRpYyB2b2lkCi1nZW4xMV9ndF9pZGVudGl0eV9oYW5kbGVyKHN0
cnVjdCBpbnRlbF9ndCAqZ3QsIGNvbnN0IHUzMiBpZGVudGl0eSkKLXsKLQljb25zdCB1OCBjbGFz
cyA9IEdFTjExX0lOVFJfRU5HSU5FX0NMQVNTKGlkZW50aXR5KTsKLQljb25zdCB1OCBpbnN0YW5j
ZSA9IEdFTjExX0lOVFJfRU5HSU5FX0lOU1RBTkNFKGlkZW50aXR5KTsKLQljb25zdCB1MTYgaW50
ciA9IEdFTjExX0lOVFJfRU5HSU5FX0lOVFIoaWRlbnRpdHkpOwotCi0JaWYgKHVubGlrZWx5KCFp
bnRyKSkKLQkJcmV0dXJuOwotCi0JaWYgKGNsYXNzIDw9IENPUFlfRU5HSU5FX0NMQVNTKQotCQly
ZXR1cm4gZ2VuMTFfZW5naW5lX2lycV9oYW5kbGVyKGd0LCBjbGFzcywgaW5zdGFuY2UsIGludHIp
OwotCi0JaWYgKGNsYXNzID09IE9USEVSX0NMQVNTKQotCQlyZXR1cm4gZ2VuMTFfb3RoZXJfaXJx
X2hhbmRsZXIoZ3QsIGluc3RhbmNlLCBpbnRyKTsKLQotCVdBUk5fT05DRSgxLCAidW5rbm93biBp
bnRlcnJ1cHQgY2xhc3M9MHgleCwgaW5zdGFuY2U9MHgleCwgaW50cj0weCV4XG4iLAotCQkgIGNs
YXNzLCBpbnN0YW5jZSwgaW50cik7Ci19Ci0KLXN0YXRpYyB2b2lkCi1nZW4xMV9ndF9iYW5rX2hh
bmRsZXIoc3RydWN0IGludGVsX2d0ICpndCwgY29uc3QgdW5zaWduZWQgaW50IGJhbmspCi17Ci0J
dm9pZCBfX2lvbWVtICogY29uc3QgcmVncyA9IGd0LT51bmNvcmUtPnJlZ3M7Ci0JdW5zaWduZWQg
bG9uZyBpbnRyX2R3OwotCXVuc2lnbmVkIGludCBiaXQ7Ci0KLQlsb2NrZGVwX2Fzc2VydF9oZWxk
KCZndC0+aTkxNS0+aXJxX2xvY2spOwotCi0JaW50cl9kdyA9IHJhd19yZWdfcmVhZChyZWdzLCBH
RU4xMV9HVF9JTlRSX0RXKGJhbmspKTsKLQotCWZvcl9lYWNoX3NldF9iaXQoYml0LCAmaW50cl9k
dywgMzIpIHsKLQkJY29uc3QgdTMyIGlkZW50ID0gZ2VuMTFfZ3RfZW5naW5lX2lkZW50aXR5KGd0
LCBiYW5rLCBiaXQpOwotCi0JCWdlbjExX2d0X2lkZW50aXR5X2hhbmRsZXIoZ3QsIGlkZW50KTsK
LQl9Ci0KLQkvKiBDbGVhciBtdXN0IGJlIGFmdGVyIHNoYXJlZCBoYXMgYmVlbiBzZXJ2ZWQgZm9y
IGVuZ2luZSAqLwotCXJhd19yZWdfd3JpdGUocmVncywgR0VOMTFfR1RfSU5UUl9EVyhiYW5rKSwg
aW50cl9kdyk7Ci19Ci0KLXN0YXRpYyB2b2lkCi1nZW4xMV9ndF9pcnFfaGFuZGxlcihzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0LCBjb25zdCB1MzIgbWFzdGVyX2N0bCkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IGd0LT5pOTE1OwotCXVuc2lnbmVkIGludCBiYW5rOwotCi0Jc3Bpbl9s
b2NrKCZpOTE1LT5pcnFfbG9jayk7Ci0KLQlmb3IgKGJhbmsgPSAwOyBiYW5rIDwgMjsgYmFuaysr
KSB7Ci0JCWlmIChtYXN0ZXJfY3RsICYgR0VOMTFfR1RfRFdfSVJRKGJhbmspKQotCQkJZ2VuMTFf
Z3RfYmFua19oYW5kbGVyKGd0LCBiYW5rKTsKLQl9Ci0KLQlzcGluX3VubG9jaygmaTkxNS0+aXJx
X2xvY2spOwotfQotCiBzdGF0aWMgdTMyCiBnZW4xMV9ndV9taXNjX2lycV9hY2soc3RydWN0IGlu
dGVsX2d0ICpndCwgY29uc3QgdTMyIG1hc3Rlcl9jdGwpCiB7CkBAIC0zNTE2LDE1ICszMTU2LDYg
QEAgc3RhdGljIHZvaWQgaWJ4X2lycV9wcmVfcG9zdGluc3RhbGwoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQogCVBPU1RJTkdfUkVBRChTREVJRVIpOwogfQogCi1zdGF0aWMgdm9p
ZCBnZW41X2d0X2lycV9yZXNldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCi17
Ci0Jc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmRldl9wcml2LT51bmNvcmU7Ci0KLQlH
RU4zX0lSUV9SRVNFVCh1bmNvcmUsIEdUKTsKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA2
KQotCQlHRU4zX0lSUV9SRVNFVCh1bmNvcmUsIEdFTjZfUE0pOwotfQotCiBzdGF0aWMgdm9pZCB2
bHZfZGlzcGxheV9pcnFfcmVzZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQog
ewogCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9ICZkZXZfcHJpdi0+dW5jb3JlOwpAQCAt
MzU4OSw3ICszMjIwLDcgQEAgc3RhdGljIHZvaWQgaXJvbmxha2VfaXJxX3Jlc2V0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJaW50ZWxfdW5jb3JlX3dyaXRlKHVuY29yZSwg
RURQX1BTUl9JSVIsIDB4ZmZmZmZmZmYpOwogCX0KIAotCWdlbjVfZ3RfaXJxX3Jlc2V0KGRldl9w
cml2KTsKKwlnZW41X2d0X2lycV9yZXNldCgmZGV2X3ByaXYtPmd0KTsKIAogCWlieF9pcnFfcmVz
ZXQoZGV2X3ByaXYpOwogfQpAQCAtMzU5OSw3ICszMjMwLDcgQEAgc3RhdGljIHZvaWQgdmFsbGV5
dmlld19pcnFfcmVzZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCUk5MTVf
V1JJVEUoVkxWX01BU1RFUl9JRVIsIDApOwogCVBPU1RJTkdfUkVBRChWTFZfTUFTVEVSX0lFUik7
CiAKLQlnZW41X2d0X2lycV9yZXNldChkZXZfcHJpdik7CisJZ2VuNV9ndF9pcnFfcmVzZXQoJmRl
dl9wcml2LT5ndCk7CiAKIAlzcGluX2xvY2tfaXJxKCZkZXZfcHJpdi0+aXJxX2xvY2spOwogCWlm
IChkZXZfcHJpdi0+ZGlzcGxheV9pcnFzX2VuYWJsZWQpCkBAIC0zNjA3LDE2ICszMjM4LDYgQEAg
c3RhdGljIHZvaWQgdmFsbGV5dmlld19pcnFfcmVzZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQogCXNwaW5fdW5sb2NrX2lycSgmZGV2X3ByaXYtPmlycV9sb2NrKTsKIH0KIAot
c3RhdGljIHZvaWQgZ2VuOF9ndF9pcnFfcmVzZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQotewotCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9ICZkZXZfcHJpdi0+dW5j
b3JlOwotCi0JR0VOOF9JUlFfUkVTRVRfTkRYKHVuY29yZSwgR1QsIDApOwotCUdFTjhfSVJRX1JF
U0VUX05EWCh1bmNvcmUsIEdULCAxKTsKLQlHRU44X0lSUV9SRVNFVF9ORFgodW5jb3JlLCBHVCwg
Mik7Ci0JR0VOOF9JUlFfUkVTRVRfTkRYKHVuY29yZSwgR1QsIDMpOwotfQotCiBzdGF0aWMgdm9p
ZCBnZW44X2lycV9yZXNldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7CiAJ
c3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gJmRldl9wcml2LT51bmNvcmU7CkBAIC0zNjI0
LDcgKzMyNDUsNyBAQCBzdGF0aWMgdm9pZCBnZW44X2lycV9yZXNldChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpCiAKIAlnZW44X21hc3Rlcl9pbnRyX2Rpc2FibGUoZGV2X3ByaXYt
PnVuY29yZS5yZWdzKTsKIAotCWdlbjhfZ3RfaXJxX3Jlc2V0KGRldl9wcml2KTsKKwlnZW44X2d0
X2lycV9yZXNldCgmZGV2X3ByaXYtPmd0KTsKIAogCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUs
IEVEUF9QU1JfSU1SLCAweGZmZmZmZmZmKTsKIAlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBF
RFBfUFNSX0lJUiwgMHhmZmZmZmZmZik7CkBAIC0zNjQyLDI3ICszMjYzLDYgQEAgc3RhdGljIHZv
aWQgZ2VuOF9pcnFfcmVzZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlp
YnhfaXJxX3Jlc2V0KGRldl9wcml2KTsKIH0KIAotc3RhdGljIHZvaWQgZ2VuMTFfZ3RfaXJxX3Jl
c2V0KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCi17Ci0Jc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3Jl
ID0gZ3QtPnVuY29yZTsKLQotCS8qIERpc2FibGUgUkNTLCBCQ1MsIFZDUyBhbmQgVkVDUyBjbGFz
cyBlbmdpbmVzLiAqLwotCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsIEdFTjExX1JFTkRFUl9D
T1BZX0lOVFJfRU5BQkxFLCAwKTsKLQlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBHRU4xMV9W
Q1NfVkVDU19JTlRSX0VOQUJMRSwJICAwKTsKLQotCS8qIFJlc3RvcmUgbWFza3MgaXJxcyBvbiBS
Q1MsIEJDUywgVkNTIGFuZCBWRUNTIGVuZ2luZXMuICovCi0JaW50ZWxfdW5jb3JlX3dyaXRlKHVu
Y29yZSwgR0VOMTFfUkNTMF9SU1ZEX0lOVFJfTUFTSywJfjApOwotCWludGVsX3VuY29yZV93cml0
ZSh1bmNvcmUsIEdFTjExX0JDU19SU1ZEX0lOVFJfTUFTSywJfjApOwotCWludGVsX3VuY29yZV93
cml0ZSh1bmNvcmUsIEdFTjExX1ZDUzBfVkNTMV9JTlRSX01BU0ssCX4wKTsKLQlpbnRlbF91bmNv
cmVfd3JpdGUodW5jb3JlLCBHRU4xMV9WQ1MyX1ZDUzNfSU5UUl9NQVNLLAl+MCk7Ci0JaW50ZWxf
dW5jb3JlX3dyaXRlKHVuY29yZSwgR0VOMTFfVkVDUzBfVkVDUzFfSU5UUl9NQVNLLAl+MCk7Ci0K
LQlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBHRU4xMV9HUE1fV0dCT1hQRVJGX0lOVFJfRU5B
QkxFLCAwKTsKLQlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBHRU4xMV9HUE1fV0dCT1hQRVJG
X0lOVFJfTUFTSywgIH4wKTsKLQlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBHRU4xMV9HVUNf
U0dfSU5UUl9FTkFCTEUsIDApOwotCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsIEdFTjExX0dV
Q19TR19JTlRSX01BU0ssICB+MCk7Ci19Ci0KIHN0YXRpYyB2b2lkIGdlbjExX2lycV9yZXNldChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7CiAJc3RydWN0IGludGVsX3VuY29y
ZSAqdW5jb3JlID0gJmRldl9wcml2LT51bmNvcmU7CkBAIC0zNzQ0LDcgKzMzNDQsNyBAQCBzdGF0
aWMgdm9pZCBjaGVycnl2aWV3X2lycV9yZXNldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCiAJSTkxNV9XUklURShHRU44X01BU1RFUl9JUlEsIDApOwogCVBPU1RJTkdfUkVBRChH
RU44X01BU1RFUl9JUlEpOwogCi0JZ2VuOF9ndF9pcnFfcmVzZXQoZGV2X3ByaXYpOworCWdlbjhf
Z3RfaXJxX3Jlc2V0KCZkZXZfcHJpdi0+Z3QpOwogCiAJR0VOM19JUlFfUkVTRVQodW5jb3JlLCBH
RU44X1BDVV8pOwogCkBAIC00MDU3LDQ0ICszNjU3LDYgQEAgc3RhdGljIHZvaWQgaWJ4X2lycV9w
b3N0aW5zdGFsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCXNwdF9ocGRf
ZGV0ZWN0aW9uX3NldHVwKGRldl9wcml2KTsKIH0KIAotc3RhdGljIHZvaWQgZ2VuNV9ndF9pcnFf
cG9zdGluc3RhbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQotewotCXN0cnVj
dCBpbnRlbF91bmNvcmUgKnVuY29yZSA9ICZkZXZfcHJpdi0+dW5jb3JlOwotCXUzMiBwbV9pcnFz
LCBndF9pcnFzOwotCi0JcG1faXJxcyA9IGd0X2lycXMgPSAwOwotCi0JZGV2X3ByaXYtPmd0X2ly
cV9tYXNrID0gfjA7Ci0JaWYgKEhBU19MM19EUEYoZGV2X3ByaXYpKSB7Ci0JCS8qIEwzIHBhcml0
eSBpbnRlcnJ1cHQgaXMgYWx3YXlzIHVubWFza2VkLiAqLwotCQlkZXZfcHJpdi0+Z3RfaXJxX21h
c2sgPSB+R1RfUEFSSVRZX0VSUk9SKGRldl9wcml2KTsKLQkJZ3RfaXJxcyB8PSBHVF9QQVJJVFlf
RVJST1IoZGV2X3ByaXYpOwotCX0KLQotCWd0X2lycXMgfD0gR1RfUkVOREVSX1VTRVJfSU5URVJS
VVBUOwotCWlmIChJU19HRU4oZGV2X3ByaXYsIDUpKSB7Ci0JCWd0X2lycXMgfD0gSUxLX0JTRF9V
U0VSX0lOVEVSUlVQVDsKLQl9IGVsc2UgewotCQlndF9pcnFzIHw9IEdUX0JMVF9VU0VSX0lOVEVS
UlVQVCB8IEdUX0JTRF9VU0VSX0lOVEVSUlVQVDsKLQl9Ci0KLQlHRU4zX0lSUV9JTklUKHVuY29y
ZSwgR1QsIGRldl9wcml2LT5ndF9pcnFfbWFzaywgZ3RfaXJxcyk7Ci0KLQlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSA2KSB7Ci0JCS8qCi0JCSAqIFJQUyBpbnRlcnJ1cHRzIHdpbGwgZ2V0IGVu
YWJsZWQvZGlzYWJsZWQgb24gZGVtYW5kIHdoZW4gUlBTCi0JCSAqIGl0c2VsZiBpcyBlbmFibGVk
L2Rpc2FibGVkLgotCQkgKi8KLQkJaWYgKEhBU19FTkdJTkUoZGV2X3ByaXYsIFZFQ1MwKSkgewot
CQkJcG1faXJxcyB8PSBQTV9WRUJPWF9VU0VSX0lOVEVSUlVQVDsKLQkJCWRldl9wcml2LT5ndC5w
bV9pZXIgfD0gUE1fVkVCT1hfVVNFUl9JTlRFUlJVUFQ7Ci0JCX0KLQotCQlkZXZfcHJpdi0+Z3Qu
cG1faW1yID0gMHhmZmZmZmZmZjsKLQkJR0VOM19JUlFfSU5JVCh1bmNvcmUsIEdFTjZfUE0sIGRl
dl9wcml2LT5ndC5wbV9pbXIsIHBtX2lycXMpOwotCX0KLX0KLQogc3RhdGljIHZvaWQgaXJvbmxh
a2VfaXJxX3Bvc3RpbnN0YWxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsK
IAlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSAmZGV2X3ByaXYtPnVuY29yZTsKQEAgLTQx
MjgsNyArMzY5MCw3IEBAIHN0YXRpYyB2b2lkIGlyb25sYWtlX2lycV9wb3N0aW5zdGFsbChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJR0VOM19JUlFfSU5JVCh1bmNvcmUsIERF
LCBkZXZfcHJpdi0+aXJxX21hc2ssCiAJCSAgICAgIGRpc3BsYXlfbWFzayB8IGV4dHJhX21hc2sp
OwogCi0JZ2VuNV9ndF9pcnFfcG9zdGluc3RhbGwoZGV2X3ByaXYpOworCWdlbjVfZ3RfaXJxX3Bv
c3RpbnN0YWxsKCZkZXZfcHJpdi0+Z3QpOwogCiAJaWxrX2hwZF9kZXRlY3Rpb25fc2V0dXAoZGV2
X3ByaXYpOwogCkBAIC00MTc3LDcgKzM3MzksNyBAQCB2b2lkIHZhbGxleXZpZXdfZGlzYWJsZV9k
aXNwbGF5X2lycXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCiBzdGF0aWMg
dm9pZCB2YWxsZXl2aWV3X2lycV9wb3N0aW5zdGFsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCiB7Ci0JZ2VuNV9ndF9pcnFfcG9zdGluc3RhbGwoZGV2X3ByaXYpOworCWdlbjVf
Z3RfaXJxX3Bvc3RpbnN0YWxsKCZkZXZfcHJpdi0+Z3QpOwogCiAJc3Bpbl9sb2NrX2lycSgmZGV2
X3ByaXYtPmlycV9sb2NrKTsKIAlpZiAoZGV2X3ByaXYtPmRpc3BsYXlfaXJxc19lbmFibGVkKQpA
QCAtNDE4OCw0MSArMzc1MCw2IEBAIHN0YXRpYyB2b2lkIHZhbGxleXZpZXdfaXJxX3Bvc3RpbnN0
YWxsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlQT1NUSU5HX1JFQUQoVkxW
X01BU1RFUl9JRVIpOwogfQogCi1zdGF0aWMgdm9pZCBnZW44X2d0X2lycV9wb3N0aW5zdGFsbChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKLXsKLQlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0g
Jmk5MTUtPmd0OwotCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9IGd0LT51bmNvcmU7Ci0K
LQkvKiBUaGVzZSBhcmUgaW50ZXJydXB0cyB3ZSdsbCB0b2dnbGUgd2l0aCB0aGUgcmluZyBtYXNr
IHJlZ2lzdGVyICovCi0JdTMyIGd0X2ludGVycnVwdHNbXSA9IHsKLQkJKEdUX1JFTkRFUl9VU0VS
X0lOVEVSUlVQVCA8PCBHRU44X1JDU19JUlFfU0hJRlQgfAotCQkgR1RfQ09OVEVYVF9TV0lUQ0hf
SU5URVJSVVBUIDw8IEdFTjhfUkNTX0lSUV9TSElGVCB8Ci0JCSBHVF9SRU5ERVJfVVNFUl9JTlRF
UlJVUFQgPDwgR0VOOF9CQ1NfSVJRX1NISUZUIHwKLQkJIEdUX0NPTlRFWFRfU1dJVENIX0lOVEVS
UlVQVCA8PCBHRU44X0JDU19JUlFfU0hJRlQpLAotCi0JCShHVF9SRU5ERVJfVVNFUl9JTlRFUlJV
UFQgPDwgR0VOOF9WQ1MwX0lSUV9TSElGVCB8Ci0JCSBHVF9DT05URVhUX1NXSVRDSF9JTlRFUlJV
UFQgPDwgR0VOOF9WQ1MwX0lSUV9TSElGVCB8Ci0JCSBHVF9SRU5ERVJfVVNFUl9JTlRFUlJVUFQg
PDwgR0VOOF9WQ1MxX0lSUV9TSElGVCB8Ci0JCSBHVF9DT05URVhUX1NXSVRDSF9JTlRFUlJVUFQg
PDwgR0VOOF9WQ1MxX0lSUV9TSElGVCksCi0KLQkJMCwKLQotCQkoR1RfUkVOREVSX1VTRVJfSU5U
RVJSVVBUIDw8IEdFTjhfVkVDU19JUlFfU0hJRlQgfAotCQkgR1RfQ09OVEVYVF9TV0lUQ0hfSU5U
RVJSVVBUIDw8IEdFTjhfVkVDU19JUlFfU0hJRlQpCi0JfTsKLQotCWd0LT5wbV9pZXIgPSAweDA7
Ci0JZ3QtPnBtX2ltciA9IH5ndC0+cG1faWVyOwotCUdFTjhfSVJRX0lOSVRfTkRYKHVuY29yZSwg
R1QsIDAsIH5ndF9pbnRlcnJ1cHRzWzBdLCBndF9pbnRlcnJ1cHRzWzBdKTsKLQlHRU44X0lSUV9J
TklUX05EWCh1bmNvcmUsIEdULCAxLCB+Z3RfaW50ZXJydXB0c1sxXSwgZ3RfaW50ZXJydXB0c1sx
XSk7Ci0JLyoKLQkgKiBSUFMgaW50ZXJydXB0cyB3aWxsIGdldCBlbmFibGVkL2Rpc2FibGVkIG9u
IGRlbWFuZCB3aGVuIFJQUyBpdHNlbGYKLQkgKiBpcyBlbmFibGVkL2Rpc2FibGVkLiBTYW1lIHdp
bCBiZSB0aGUgY2FzZSBmb3IgR3VDIGludGVycnVwdHMuCi0JICovCi0JR0VOOF9JUlFfSU5JVF9O
RFgodW5jb3JlLCBHVCwgMiwgZ3QtPnBtX2ltciwgZ3QtPnBtX2llcik7Ci0JR0VOOF9JUlFfSU5J
VF9ORFgodW5jb3JlLCBHVCwgMywgfmd0X2ludGVycnVwdHNbM10sIGd0X2ludGVycnVwdHNbM10p
OwotfQotCiBzdGF0aWMgdm9pZCBnZW44X2RlX2lycV9wb3N0aW5zdGFsbChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7CiAJc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0g
JmRldl9wcml2LT51bmNvcmU7CkBAIC00Mjk4LDcgKzM4MjUsNyBAQCBzdGF0aWMgdm9pZCBnZW44
X2lycV9wb3N0aW5zdGFsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJaWYg
KEhBU19QQ0hfU1BMSVQoZGV2X3ByaXYpKQogCQlpYnhfaXJxX3ByZV9wb3N0aW5zdGFsbChkZXZf
cHJpdik7CiAKLQlnZW44X2d0X2lycV9wb3N0aW5zdGFsbChkZXZfcHJpdik7CisJZ2VuOF9ndF9p
cnFfcG9zdGluc3RhbGwoJmRldl9wcml2LT5ndCk7CiAJZ2VuOF9kZV9pcnFfcG9zdGluc3RhbGwo
ZGV2X3ByaXYpOwogCiAJaWYgKEhBU19QQ0hfU1BMSVQoZGV2X3ByaXYpKQpAQCAtNDMwNyw0MCAr
MzgzNCw2IEBAIHN0YXRpYyB2b2lkIGdlbjhfaXJxX3Bvc3RpbnN0YWxsKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKIAlnZW44X21hc3Rlcl9pbnRyX2VuYWJsZShkZXZfcHJpdi0+
dW5jb3JlLnJlZ3MpOwogfQogCi1zdGF0aWMgdm9pZCBnZW4xMV9ndF9pcnFfcG9zdGluc3RhbGwo
c3RydWN0IGludGVsX2d0ICpndCkKLXsKLQljb25zdCB1MzIgaXJxcyA9IEdUX1JFTkRFUl9VU0VS
X0lOVEVSUlVQVCB8IEdUX0NPTlRFWFRfU1dJVENIX0lOVEVSUlVQVDsKLQlzdHJ1Y3QgaW50ZWxf
dW5jb3JlICp1bmNvcmUgPSBndC0+dW5jb3JlOwotCWNvbnN0IHUzMiBkbWFzayA9IGlycXMgPDwg
MTYgfCBpcnFzOwotCWNvbnN0IHUzMiBzbWFzayA9IGlycXMgPDwgMTY7Ci0KLQlCVUlMRF9CVUdf
T04oaXJxcyAmIDB4ZmZmZjAwMDApOwotCi0JLyogRW5hYmxlIFJDUywgQkNTLCBWQ1MgYW5kIFZF
Q1MgY2xhc3MgaW50ZXJydXB0cy4gKi8KLQlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBHRU4x
MV9SRU5ERVJfQ09QWV9JTlRSX0VOQUJMRSwgZG1hc2spOwotCWludGVsX3VuY29yZV93cml0ZSh1
bmNvcmUsIEdFTjExX1ZDU19WRUNTX0lOVFJfRU5BQkxFLCBkbWFzayk7Ci0KLQkvKiBVbm1hc2sg
aXJxcyBvbiBSQ1MsIEJDUywgVkNTIGFuZCBWRUNTIGVuZ2luZXMuICovCi0JaW50ZWxfdW5jb3Jl
X3dyaXRlKHVuY29yZSwgR0VOMTFfUkNTMF9SU1ZEX0lOVFJfTUFTSywgfnNtYXNrKTsKLQlpbnRl
bF91bmNvcmVfd3JpdGUodW5jb3JlLCBHRU4xMV9CQ1NfUlNWRF9JTlRSX01BU0ssIH5zbWFzayk7
Ci0JaW50ZWxfdW5jb3JlX3dyaXRlKHVuY29yZSwgR0VOMTFfVkNTMF9WQ1MxX0lOVFJfTUFTSywg
fmRtYXNrKTsKLQlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBHRU4xMV9WQ1MyX1ZDUzNfSU5U
Ul9NQVNLLCB+ZG1hc2spOwotCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsIEdFTjExX1ZFQ1Mw
X1ZFQ1MxX0lOVFJfTUFTSywgfmRtYXNrKTsKLQotCS8qCi0JICogUlBTIGludGVycnVwdHMgd2ls
bCBnZXQgZW5hYmxlZC9kaXNhYmxlZCBvbiBkZW1hbmQgd2hlbiBSUFMgaXRzZWxmCi0JICogaXMg
ZW5hYmxlZC9kaXNhYmxlZC4KLQkgKi8KLQlndC0+cG1faWVyID0gMHgwOwotCWd0LT5wbV9pbXIg
PSB+Z3QtPnBtX2llcjsKLQlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBHRU4xMV9HUE1fV0dC
T1hQRVJGX0lOVFJfRU5BQkxFLCAwKTsKLQlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBHRU4x
MV9HUE1fV0dCT1hQRVJGX0lOVFJfTUFTSywgIH4wKTsKLQotCS8qIFNhbWUgdGhpbmcgZm9yIEd1
QyBpbnRlcnJ1cHRzICovCi0JaW50ZWxfdW5jb3JlX3dyaXRlKHVuY29yZSwgR0VOMTFfR1VDX1NH
X0lOVFJfRU5BQkxFLCAwKTsKLQlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBHRU4xMV9HVUNf
U0dfSU5UUl9NQVNLLCAgfjApOwotfQotCiBzdGF0aWMgdm9pZCBpY3BfaXJxX3Bvc3RpbnN0YWxs
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKIAl1MzIgbWFzayA9IFNERV9H
TUJVU19JQ1A7CkBAIC00MzgzLDcgKzM4NzYsNyBAQCBzdGF0aWMgdm9pZCBnZW4xMV9pcnFfcG9z
dGluc3RhbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCiBzdGF0aWMgdm9p
ZCBjaGVycnl2aWV3X2lycV9wb3N0aW5zdGFsbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCiB7Ci0JZ2VuOF9ndF9pcnFfcG9zdGluc3RhbGwoZGV2X3ByaXYpOworCWdlbjhfZ3Rf
aXJxX3Bvc3RpbnN0YWxsKCZkZXZfcHJpdi0+Z3QpOwogCiAJc3Bpbl9sb2NrX2lycSgmZGV2X3By
aXYtPmlycV9sb2NrKTsKIAlpZiAoZGV2X3ByaXYtPmRpc3BsYXlfaXJxc19lbmFibGVkKQpAQCAt
NDgzNywzMyArNDMzMCw2IEBAIHZvaWQgaW50ZWxfaXJxX2luaXQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQogCWlmIChIQVNfR1RfVUMoZGV2X3ByaXYpICYmIElOVEVMX0dFTihk
ZXZfcHJpdikgPCAxMSkKIAkJZGV2X3ByaXYtPmd0LnBtX2d1Y19ldmVudHMgPSBHVUNfSU5UUl9H
VUMySE9TVCA8PCAxNjsKIAotCS8qIExldCdzIHRyYWNrIHRoZSBlbmFibGVkIHJwcyBldmVudHMg
Ki8KLQlpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikpCi0JCS8qIFdhR3N2UkMwUmVzaWRlbmN5
TWV0aG9kOnZsdiAqLwotCQlkZXZfcHJpdi0+cG1fcnBzX2V2ZW50cyA9IEdFTjZfUE1fUlBfVVBf
RUlfRVhQSVJFRDsKLQllbHNlCi0JCWRldl9wcml2LT5wbV9ycHNfZXZlbnRzID0gKEdFTjZfUE1f
UlBfVVBfVEhSRVNIT0xEIHwKLQkJCQkJICAgR0VONl9QTV9SUF9ET1dOX1RIUkVTSE9MRCB8Ci0J
CQkJCSAgIEdFTjZfUE1fUlBfRE9XTl9USU1FT1VUKTsKLQotCS8qIFdlIHNoYXJlIHRoZSByZWdp
c3RlciB3aXRoIG90aGVyIGVuZ2luZSAqLwotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID4gOSkK
LQkJR0VNX1dBUk5fT04oZGV2X3ByaXYtPnBtX3Jwc19ldmVudHMgJiAweGZmZmYwMDAwKTsKLQot
CXJwcy0+cG1faW50cm1za19tYnogPSAwOwotCi0JLyoKLQkgKiBTTkIsSVZCLEhTVyBjYW4gd2hp
bGUgVkxWLENIViBtYXkgaGFyZCBoYW5nIG9uIGxvb3BpbmcgYmF0Y2hidWZmZXIKLQkgKiBpZiBH
RU42X1BNX1VQX0VJX0VYUElSRUQgaXMgbWFza2VkLgotCSAqCi0JICogVE9ETzogdmVyaWZ5IGlm
IHRoaXMgY2FuIGJlIHJlcHJvZHVjZWQgb24gVkxWLENIVi4KLQkgKi8KLQlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA8PSA3KQotCQlycHMtPnBtX2ludHJtc2tfbWJ6IHw9IEdFTjZfUE1fUlBfVVBf
RUlfRVhQSVJFRDsKLQotCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDgpCi0JCXJwcy0+cG1f
aW50cm1za19tYnogfD0gR0VOOF9QTUlOVFJfRElTQUJMRV9SRURJUkVDVF9UT19HVUM7Ci0KIAlk
ZXYtPnZibGFua19kaXNhYmxlX2ltbWVkaWF0ZSA9IHRydWU7CiAKIAkvKiBNb3N0IHBsYXRmb3Jt
cyB0cmVhdCB0aGUgZGlzcGxheSBpcnEgYmxvY2sgYXMgYW4gYWx3YXlzLW9uCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2lycS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9pcnEuaAppbmRleCA0MmM4ODFkOGFkNjkuLjhlN2U2MDcxNzc3ZSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2lycS5oCkBAIC0xMCw2ICsxMCw3IEBACiAjaW5jbHVkZSA8bGludXgvdHlwZXMuaD4K
IAogI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfZGlzcGxheS5oIgorI2luY2x1ZGUgImk5MTVfcmVn
LmgiCiAKIHN0cnVjdCBkcm1fY3J0YzsKIHN0cnVjdCBkcm1fZGV2aWNlOwpAQCAtMTksNiArMjAs
MTAgQEAgc3RydWN0IGludGVsX2NydGM7CiBzdHJ1Y3QgaW50ZWxfY3J0YzsKIHN0cnVjdCBpbnRl
bF9ndDsKIHN0cnVjdCBpbnRlbF9ndWM7CitzdHJ1Y3QgaW50ZWxfdW5jb3JlOworCit2b2lkIGdl
bjExX3Jwc19pcnFfaGFuZGxlcihzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCB1MzIgcG1faWlyKTsKK3Zv
aWQgZ2VuNl9ycHNfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LCB1MzIgcG1faWlyKTsKIAogdm9pZCBpbnRlbF9pcnFfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpOwogdm9pZCBpbnRlbF9pcnFfZmluaShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpOwpAQCAtMTI3LDQgKzEzMiw0NiBAQCB2b2lkIGk5NjVfZGlzYWJsZV92
Ymxhbmsoc3RydWN0IGRybV9jcnRjICpjcnRjKTsKIHZvaWQgaWxrX2Rpc2FibGVfdmJsYW5rKHN0
cnVjdCBkcm1fY3J0YyAqY3J0Yyk7CiB2b2lkIGJkd19kaXNhYmxlX3ZibGFuayhzdHJ1Y3QgZHJt
X2NydGMgKmNydGMpOwogCit2b2lkIGdlbjJfaXJxX3Jlc2V0KHN0cnVjdCBpbnRlbF91bmNvcmUg
KnVuY29yZSk7Cit2b2lkIGdlbjNfaXJxX3Jlc2V0KHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29y
ZSwgaTkxNV9yZWdfdCBpbXIsCisJCSAgICBpOTE1X3JlZ190IGlpciwgaTkxNV9yZWdfdCBpZXIp
OworCit2b2lkIGdlbjJfaXJxX2luaXQoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlLAorCQkg
ICB1MzIgaW1yX3ZhbCwgdTMyIGllcl92YWwpOwordm9pZCBnZW4zX2lycV9pbml0KHN0cnVjdCBp
bnRlbF91bmNvcmUgKnVuY29yZSwKKwkJICAgaTkxNV9yZWdfdCBpbXIsIHUzMiBpbXJfdmFsLAor
CQkgICBpOTE1X3JlZ190IGllciwgdTMyIGllcl92YWwsCisJCSAgIGk5MTVfcmVnX3QgaWlyKTsK
KworI2RlZmluZSBHRU44X0lSUV9SRVNFVF9ORFgodW5jb3JlLCB0eXBlLCB3aGljaCkgXAorKHsg
XAorCXVuc2lnbmVkIGludCB3aGljaF8gPSB3aGljaDsgXAorCWdlbjNfaXJxX3Jlc2V0KCh1bmNv
cmUpLCBHRU44XyMjdHlwZSMjX0lNUih3aGljaF8pLCBcCisJCSAgICAgICBHRU44XyMjdHlwZSMj
X0lJUih3aGljaF8pLCBHRU44XyMjdHlwZSMjX0lFUih3aGljaF8pKTsgXAorfSkKKworI2RlZmlu
ZSBHRU4zX0lSUV9SRVNFVCh1bmNvcmUsIHR5cGUpIFwKKwlnZW4zX2lycV9yZXNldCgodW5jb3Jl
KSwgdHlwZSMjSU1SLCB0eXBlIyNJSVIsIHR5cGUjI0lFUikKKworI2RlZmluZSBHRU4yX0lSUV9S
RVNFVCh1bmNvcmUpIFwKKwlnZW4yX2lycV9yZXNldCh1bmNvcmUpCisKKyNkZWZpbmUgR0VOOF9J
UlFfSU5JVF9ORFgodW5jb3JlLCB0eXBlLCB3aGljaCwgaW1yX3ZhbCwgaWVyX3ZhbCkgXAorKHsg
XAorCXVuc2lnbmVkIGludCB3aGljaF8gPSB3aGljaDsgXAorCWdlbjNfaXJxX2luaXQoKHVuY29y
ZSksIFwKKwkJICAgICAgR0VOOF8jI3R5cGUjI19JTVIod2hpY2hfKSwgaW1yX3ZhbCwgXAorCQkg
ICAgICBHRU44XyMjdHlwZSMjX0lFUih3aGljaF8pLCBpZXJfdmFsLCBcCisJCSAgICAgIEdFTjhf
IyN0eXBlIyNfSUlSKHdoaWNoXykpOyBcCit9KQorCisjZGVmaW5lIEdFTjNfSVJRX0lOSVQodW5j
b3JlLCB0eXBlLCBpbXJfdmFsLCBpZXJfdmFsKSBcCisJZ2VuM19pcnFfaW5pdCgodW5jb3JlKSwg
XAorCQkgICAgICB0eXBlIyNJTVIsIGltcl92YWwsIFwKKwkJICAgICAgdHlwZSMjSUVSLCBpZXJf
dmFsLCBcCisJCSAgICAgIHR5cGUjI0lJUikKKworI2RlZmluZSBHRU4yX0lSUV9JTklUKHVuY29y
ZSwgaW1yX3ZhbCwgaWVyX3ZhbCkgXAorCWdlbjJfaXJxX2luaXQoKHVuY29yZSksIGltcl92YWws
IGllcl92YWwpCisKICNlbmRpZiAvKiBfX0k5MTVfSVJRX0hfXyAqLwotLSAKMi4yMy4wLnJjMQoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4
IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

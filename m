Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 73001D08C6
	for <lists+intel-gfx@lfdr.de>; Wed,  9 Oct 2019 09:50:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id ADDFB8909C;
	Wed,  9 Oct 2019 07:50:21 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga02.intel.com (mga02.intel.com [134.134.136.20])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7B4B988EA1
 for <intel-gfx@lists.freedesktop.org>; Wed,  9 Oct 2019 07:50:20 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by orsmga101.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 09 Oct 2019 00:50:19 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.67,273,1566889200"; d="scan'208";a="187556068"
Received: from gaia.fi.intel.com ([10.237.72.192])
 by orsmga008.jf.intel.com with ESMTP; 09 Oct 2019 00:50:18 -0700
Received: by gaia.fi.intel.com (Postfix, from userid 1000)
 id A5F3E5C1E39; Wed,  9 Oct 2019 10:49:41 +0300 (EEST)
From: Mika Kuoppala <mika.kuoppala@linux.intel.com>
To: Chris Wilson <chris@chris-wilson.co.uk>, intel-gfx@lists.freedesktop.org
In-Reply-To: <20191009061759.3189-1-chris@chris-wilson.co.uk>
References: <20191009000724.25890-1-chris@chris-wilson.co.uk>
 <20191009061759.3189-1-chris@chris-wilson.co.uk>
Date: Wed, 09 Oct 2019 10:49:41 +0300
Message-ID: <87imoyl5nu.fsf@gaia.fi.intel.com>
MIME-Version: 1.0
Subject: Re: [Intel-gfx] [PATCH] drm/i915/selftests: Hold request reference
 over waits
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+IHdyaXRlczoKCj4gVGFrZSBh
IHJlZmVyZW5jZSBvbiB0aGUgcmVxdWVzdCBiZWZvcmUgc3VibWl0dGluZyBpdCB0byB0aGUgSFcg
YW5kIHRoZW4KPiB3YWl0aW5nIG9uIGl0IGZvciBzZWxmdGVzdF93b3JrYXJvdW5kcy4gT25jZSBz
dWJtaXR0ZWQsIHRoZSByZXF1ZXN0IG1heQo+IGJlIGZyZWVkIGJ5IGEgYmFja2dyb3VuZCB3b3Jr
ZXIsIHVubGVzcyB3ZSB0YWtlIGFuIGV4dHJhIHJlZmVyZW5jZSBmb3IKPiBvdXJzZWx2ZXMuCj4K
PiBSZWZlcmVuY2VzOiBodHRwczovL2J1Z3MuZnJlZWRlc2t0b3Aub3JnL3Nob3dfYnVnLmNnaT9p
ZD0xMTE5MjYKPiBTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNv
bi5jby51az4KClJldmlld2VkLWJ5OiBNaWthIEt1b3BwYWxhIDxtaWthLmt1b3BwYWxhQGxpbnV4
LmludGVsLmNvbT4KCj4gLS0tCj4gIC4uLi9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29ya2Fy
b3VuZHMuYyAgICB8IDczICsrKysrKysrKy0tLS0tLS0tLS0KPiAgMSBmaWxlIGNoYW5nZWQsIDM0
IGluc2VydGlvbnMoKyksIDM5IGRlbGV0aW9ucygtKQo+Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jCj4gaW5kZXggNzQ5NTJiZGE5MjU2Li4xMDQ4
YmU2NDZjMzUgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
d29ya2Fyb3VuZHMuYwo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dv
cmthcm91bmRzLmMKPiBAQCAtMzMsNiArMzMsMzAgQEAgc3RydWN0IHdhX2xpc3RzIHsKPiAgCX0g
ZW5naW5lW0k5MTVfTlVNX0VOR0lORVNdOwo+ICB9Owo+ICAKPiArc3RhdGljIGludCByZXF1ZXN0
X2FkZF9zeW5jKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBpbnQgZXJyKQo+ICt7Cj4gKwlpOTE1
X3JlcXVlc3RfZ2V0KHJxKTsKPiArCWk5MTVfcmVxdWVzdF9hZGQocnEpOwo+ICsJaWYgKGk5MTVf
cmVxdWVzdF93YWl0KHJxLCAwLCBIWiAvIDUpIDwgMCkKPiArCQllcnIgPSAtRUlPOwo+ICsJaTkx
NV9yZXF1ZXN0X3B1dChycSk7Cj4gKwo+ICsJcmV0dXJuIGVycjsKPiArfQo+ICsKPiArc3RhdGlj
IGludCByZXF1ZXN0X2FkZF9zcGluKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBzdHJ1Y3QgaWd0
X3NwaW5uZXIgKnNwaW4pCj4gK3sKPiArCWludCBlcnIgPSAwOwo+ICsKPiArCWk5MTVfcmVxdWVz
dF9nZXQocnEpOwo+ICsJaTkxNV9yZXF1ZXN0X2FkZChycSk7Cj4gKwlpZiAoc3BpbiAmJiAhaWd0
X3dhaXRfZm9yX3NwaW5uZXIoc3BpbiwgcnEpKQo+ICsJCWVyciA9IC1FVElNRURPVVQ7Cj4gKwlp
OTE1X3JlcXVlc3RfcHV0KHJxKTsKPiArCj4gKwlyZXR1cm4gZXJyOwo+ICt9Cj4gKwo+ICBzdGF0
aWMgdm9pZAo+ICByZWZlcmVuY2VfbGlzdHNfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwgc3RydWN0IHdhX2xpc3RzICpsaXN0cykKPiAgewo+IEBAIC0yNDMsNyArMjY3LDYgQEAg
c3dpdGNoX3RvX3NjcmF0Y2hfY29udGV4dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUs
Cj4gIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4Owo+ICAJc3RydWN0IGludGVsX2NvbnRl
eHQgKmNlOwo+ICAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7Cj4gLQlpbnRlbF93YWtlcmVmX3Qg
d2FrZXJlZjsKPiAgCWludCBlcnIgPSAwOwo+ICAKPiAgCWN0eCA9IGtlcm5lbF9jb250ZXh0KGVu
Z2luZS0+aTkxNSk7Cj4gQEAgLTI1NSw5ICsyNzgsNyBAQCBzd2l0Y2hfdG9fc2NyYXRjaF9jb250
ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKPiAgCWNlID0gaTkxNV9nZW1fY29u
dGV4dF9nZXRfZW5naW5lKGN0eCwgZW5naW5lLT5sZWdhY3lfaWR4KTsKPiAgCUdFTV9CVUdfT04o
SVNfRVJSKGNlKSk7Cj4gIAo+IC0JcnEgPSBFUlJfUFRSKC1FTk9ERVYpOwo+IC0Jd2l0aF9pbnRl
bF9ydW50aW1lX3BtKGVuZ2luZS0+dW5jb3JlLT5ycG0sIHdha2VyZWYpCj4gLQkJcnEgPSBpZ3Rf
c3Bpbm5lcl9jcmVhdGVfcmVxdWVzdChzcGluLCBjZSwgTUlfTk9PUCk7Cj4gKwlycSA9IGlndF9z
cGlubmVyX2NyZWF0ZV9yZXF1ZXN0KHNwaW4sIGNlLCBNSV9OT09QKTsKPiAgCj4gIAlpbnRlbF9j
b250ZXh0X3B1dChjZSk7Cj4gIAo+IEBAIC0yNjcsMTMgKzI4OCw3IEBAIHN3aXRjaF90b19zY3Jh
dGNoX2NvbnRleHQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAo+ICAJCWdvdG8gZXJy
Owo+ICAJfQo+ICAKPiAtCWk5MTVfcmVxdWVzdF9hZGQocnEpOwo+IC0KPiAtCWlmIChzcGluICYm
ICFpZ3Rfd2FpdF9mb3Jfc3Bpbm5lcihzcGluLCBycSkpIHsKPiAtCQlwcl9lcnIoIlNwaW5uZXIg
ZmFpbGVkIHRvIHN0YXJ0XG4iKTsKPiAtCQllcnIgPSAtRVRJTUVET1VUOwo+IC0JfQo+IC0KPiAr
CWVyciA9IHJlcXVlc3RfYWRkX3NwaW4ocnEsIHNwaW4pOwo+ICBlcnI6Cj4gIAlpZiAoZXJyICYm
IHNwaW4pCj4gIAkJaWd0X3NwaW5uZXJfZW5kKHNwaW4pOwo+IEBAIC01ODYsMTUgKzYwMSwxMSBA
QCBzdGF0aWMgaW50IGNoZWNrX2RpcnR5X3doaXRlbGlzdChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqY3R4LAo+ICAJCQlnb3RvIGVycl9yZXF1ZXN0Owo+ICAKPiAgZXJyX3JlcXVlc3Q6Cj4gLQkJ
aTkxNV9yZXF1ZXN0X2FkZChycSk7Cj4gLQkJaWYgKGVycikKPiAtCQkJZ290byBvdXRfYmF0Y2g7
Cj4gLQo+IC0JCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChycSwgMCwgSFogLyA1KSA8IDApIHsKPiAr
CQllcnIgPSByZXF1ZXN0X2FkZF9zeW5jKHJxLCBlcnIpOwo+ICsJCWlmIChlcnIpIHsKPiAgCQkJ
cHJfZXJyKCIlczogRnV0emluZyAleCB0aW1lZG91dDsgY2FuY2VsbGluZyB0ZXN0XG4iLAo+ICAJ
CQkgICAgICAgZW5naW5lLT5uYW1lLCByZWcpOwo+ICAJCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZj
dHgtPmk5MTUtPmd0KTsKPiAtCQkJZXJyID0gLUVJTzsKPiAgCQkJZ290byBvdXRfYmF0Y2g7Cj4g
IAkJfQo+ICAKPiBAQCAtNjk3LDcgKzcwOCw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9kaXJ0eV93aGl0
ZWxpc3Qodm9pZCAqYXJnKQo+ICAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwo+ICAJ
c3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKPiAgCWVudW0gaW50ZWxfZW5naW5lX2lkIGlk
Owo+IC0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7Cj4gIAlzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGU7
Cj4gIAlpbnQgZXJyID0gMDsKPiAgCj4gQEAgLTcwNiwxMyArNzE2LDkgQEAgc3RhdGljIGludCBs
aXZlX2RpcnR5X3doaXRlbGlzdCh2b2lkICphcmcpCj4gIAlpZiAoSU5URUxfR0VOKGk5MTUpIDwg
NykgLyogbWluaW11bSByZXF1aXJlbWVudCBmb3IgTFJJLCBTUk0sIExSTSAqLwo+ICAJCXJldHVy
biAwOwo+ICAKPiAtCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldCgmaTkxNS0+cnVudGlt
ZV9wbSk7Cj4gLQo+ICAJZmlsZSA9IG1vY2tfZmlsZShpOTE1KTsKPiAtCWlmIChJU19FUlIoZmls
ZSkpIHsKPiAtCQllcnIgPSBQVFJfRVJSKGZpbGUpOwo+IC0JCWdvdG8gb3V0X3JwbTsKPiAtCX0K
PiArCWlmIChJU19FUlIoZmlsZSkpCj4gKwkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7Cj4gIAo+ICAJ
Y3R4ID0gbGl2ZV9jb250ZXh0KGk5MTUsIGZpbGUpOwo+ICAJaWYgKElTX0VSUihjdHgpKSB7Cj4g
QEAgLTczMSw4ICs3MzcsNiBAQCBzdGF0aWMgaW50IGxpdmVfZGlydHlfd2hpdGVsaXN0KHZvaWQg
KmFyZykKPiAgCj4gIG91dF9maWxlOgo+ICAJbW9ja19maWxlX2ZyZWUoaTkxNSwgZmlsZSk7Cj4g
LW91dF9ycG06Cj4gLQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2Fr
ZXJlZik7Cj4gIAlyZXR1cm4gZXJyOwo+ICB9Cj4gIAo+IEBAIC04MDcsMTIgKzgxMSw3IEBAIHN0
YXRpYyBpbnQgcmVhZF93aGl0ZWxpc3RlZF9yZWdpc3RlcnMoc3RydWN0IGk5MTVfZ2VtX2NvbnRl
eHQgKmN0eCwKPiAgCWludGVsX3JpbmdfYWR2YW5jZShycSwgY3MpOwo+ICAKPiAgZXJyX3JlcToK
PiAtCWk5MTVfcmVxdWVzdF9hZGQocnEpOwo+IC0KPiAtCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChy
cSwgMCwgSFogLyA1KSA8IDApCj4gLQkJZXJyID0gLUVJTzsKPiAtCj4gLQlyZXR1cm4gZXJyOwo+
ICsJcmV0dXJuIHJlcXVlc3RfYWRkX3N5bmMocnEsIGVycik7Cj4gIH0KPiAgCj4gIHN0YXRpYyBp
bnQgc2NydWJfd2hpdGVsaXN0ZWRfcmVnaXN0ZXJzKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpj
dHgsCj4gQEAgLTg3Miw5ICs4NzEsNyBAQCBzdGF0aWMgaW50IHNjcnViX3doaXRlbGlzdGVkX3Jl
Z2lzdGVycyhzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAo+ICAJZXJyID0gZW5naW5lLT5l
bWl0X2JiX3N0YXJ0KHJxLCBiYXRjaC0+bm9kZS5zdGFydCwgMCwgMCk7Cj4gIAo+ICBlcnJfcmVx
dWVzdDoKPiAtCWk5MTVfcmVxdWVzdF9hZGQocnEpOwo+IC0JaWYgKGk5MTVfcmVxdWVzdF93YWl0
KHJxLCAwLCBIWiAvIDUpIDwgMCkKPiAtCQllcnIgPSAtRUlPOwo+ICsJZXJyID0gcmVxdWVzdF9h
ZGRfc3luYyhycSwgZXJyKTsKPiAgCj4gIGVycl91bnBpbjoKPiAgCWk5MTVfZ2VtX29iamVjdF91
bnBpbl9tYXAoYmF0Y2gtPm9iaik7Cj4gQEAgLTEyMjksMTIgKzEyMjYsMTAgQEAgbGl2ZV9lbmdp
bmVfcmVzZXRfd29ya2Fyb3VuZHModm9pZCAqYXJnKQo+ICAJCQlnb3RvIGVycjsKPiAgCQl9Cj4g
IAo+IC0JCWk5MTVfcmVxdWVzdF9hZGQocnEpOwo+IC0KPiAtCQlpZiAoIWlndF93YWl0X2Zvcl9z
cGlubmVyKCZzcGluLCBycSkpIHsKPiArCQlyZXQgPSByZXF1ZXN0X2FkZF9zcGluKHJxLCAmc3Bp
bik7Cj4gKwkJaWYgKHJldCkgewo+ICAJCQlwcl9lcnIoIlNwaW5uZXIgZmFpbGVkIHRvIHN0YXJ0
XG4iKTsKPiAgCQkJaWd0X3NwaW5uZXJfZmluaSgmc3Bpbik7Cj4gLQkJCXJldCA9IC1FVElNRURP
VVQ7Cj4gIAkJCWdvdG8gZXJyOwo+ICAJCX0KPiAgCj4gLS0gCj4gMi4yMy4wCj4KPiBfX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwo+IEludGVsLWdmeCBtYWls
aW5nIGxpc3QKPiBJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCj4gaHR0cHM6Ly9saXN0
cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZngKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlz
dApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

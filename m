Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8857B124ED3
	for <lists+intel-gfx@lfdr.de>; Wed, 18 Dec 2019 18:08:09 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A4BB46E929;
	Wed, 18 Dec 2019 17:08:06 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga03.intel.com (mga03.intel.com [134.134.136.65])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 647036E929
 for <intel-gfx@lists.freedesktop.org>; Wed, 18 Dec 2019 17:08:04 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga003.jf.intel.com ([10.7.209.27])
 by orsmga103.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 18 Dec 2019 09:08:03 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,330,1571727600"; d="scan'208";a="218208952"
Received: from ideak-desk.fi.intel.com ([10.237.72.183])
 by orsmga003.jf.intel.com with ESMTP; 18 Dec 2019 09:08:01 -0800
From: Imre Deak <imre.deak@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 18 Dec 2019 19:07:40 +0200
Message-Id: <20191218170740.829-1-imre.deak@intel.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20191218161105.30638-7-imre.deak@intel.com>
References: <20191218161105.30638-7-imre.deak@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 06/15] drm/i915/tgl: Gen-12 render
 decompression
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Nanley G Chery <nanley.g.chery@intel.com>,
 Lucas De Marchi <lucas.demarchi@intel.com>,
 Dhinakaran Pandiyan <dhinakaran.pandiyan@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogRGhpbmFrYXJhbiBQYW5kaXlhbiA8ZGhpbmFrYXJhbi5wYW5kaXlhbkBpbnRlbC5jb20+
CgpHZW4tMTIgZGlzcGxheSBkZWNvbXByZXNzaW9uIG9wZXJhdGVzIG9uIFktdGlsZWQgY29tcHJl
c3NlZCBtYWluIHN1cmZhY2UuClRoZSBDQ1MgaXMgbGluZWFyIGFuZCBoYXMgNCBiaXRzIG9mIG1l
dGFkYXRhIGZvciBlYWNoIG1haW4gc3VyZmFjZSBjYWNoZQpsaW5lIHBhaXIsIGEgc2l6ZSByYXRp
byBvZiAxOjI1Ni4gR2VuLTEyIGRpc3BsYXkgZGVjb21wcmVzc2lvbiBpcwppbmNvbXBhdGlibGUg
d2l0aCBidWZmZXJzIGNvbXByZXNzZWQgYnkgZWFybGllciBHUFVzLCBzbyBtYWtlIHVzZSBvZiBh
IG5ldwptb2RpZmllciB0byBpZGVudGlmeSBnZW4tMTIgY29tcHJlc3Npb24uIEFub3RoZXIgbm90
YWJsZSBjaGFuZ2UgaXMgdGhhdApyZW5kZXIgZGVjb21wcmVzc2lvbiBpcyBzdXBwb3J0ZWQgb24g
YWxsIHBsYW5lcyBleGNlcHQgY3Vyc29yIGFuZCBvbiBhbGwKcGlwZXMuIFN0YXJ0IGJ5IGFkZGlu
ZyByZW5kZXIgZGVjb21wcmVzc2lvbiBzdXBwb3J0IGZvciBbQSxYXUJHUjg4OCBwaXhlbApmb3Jt
YXRzLgoKdjI6IEZpeCBjaGVja3BhdGNoIHdhcm5pbmdzIChMdWNhcykKdjM6ClJlYmFzZSwgZGlz
YWJsZSBjb2xvciBjbGVhciwgc3R5bGluZyBjaGFuZ2VzIGFuZCBtb2RpZnkKaW50ZWxfdGlsZV93
aWR0aF9ieXRlcyBhbmQgaW50ZWxfdGlsZV9oZWlnaHQgdG8gaGFuZGxlIGxpbmVhciBDQ1MKdjQ6
Ci0gVXNlIGZvcm1hdCBibG9jayBkZXNjcmlwdG9ycyBhbmQgdGhlIGk5MTUgc3BlY2lmaWMgZnVu
YyB0byBnZXQgdGhlCiAgc3Vic2FtcGxpbmcgZm9yIGVhY2ggY29sb3IgcGxhbmUuCi0gVXNlIGhl
bHBlcnMgdG8gY29udmVydCBiZXR3ZWVuIENDUyBhbmQgbWFpbiBwbGFuZXMuCnY1OgotIEZpeCBz
dWJzYW1wbGluZyByZXR1cm5lZCBieSBpbnRlbF9mYl9wbGFuZV9nZXRfc3Vic2FtcGxpbmcoKSBm
b3IKICB0aGUgQ0NTIHBsYW5lIG9mIHRoZSBmaXJzdCBwbGFuZS4KCkNjOiBWaWxsZSBTeXJqw6Rs
w6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29tPgpDYzogTWF0dCBSb3BlciA8bWF0dGhl
dy5kLnJvcGVyQGludGVsLmNvbT4KQ2M6IE5hbmxleSBHIENoZXJ5IDxuYW5sZXkuZy5jaGVyeUBp
bnRlbC5jb20+CkNjOiBKYXNvbiBFa3N0cmFuZCA8amFzb25Aamxla3N0cmFuZC5uZXQ+ClNpZ25l
ZC1vZmYtYnk6IERoaW5ha2FyYW4gUGFuZGl5YW4gPGRoaW5ha2FyYW4ucGFuZGl5YW5AaW50ZWwu
Y29tPgpTaWduZWQtb2ZmLWJ5OiBMdWNhcyBEZSBNYXJjaGkgPGx1Y2FzLmRlbWFyY2hpQGludGVs
LmNvbT4KU2lnbmVkLW9mZi1ieTogSW1yZSBEZWFrIDxpbXJlLmRlYWtAaW50ZWwuY29tPgotLS0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIHwgMTg1ICsrKysr
KysrKysrKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRl
LmMgIHwgIDIzICsrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaCAgICAgICAgICAg
ICAgfCAgIDEgKwogMyBmaWxlcyBjaGFuZ2VkLCAxNjkgaW5zZXJ0aW9ucygrKSwgNDAgZGVsZXRp
b25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
aXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpp
bmRleCA2YmRhMzk3YWU2NzcuLmM5YTkyZDYyYTcwZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTE5NDEsNiArMTk0MSwxNiBAQCBzdGF0aWMg
Ym9vbCBpc19jY3NfcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBw
bGFuZSkKIAlyZXR1cm4gcGxhbmUgPj0gZmItPmZvcm1hdC0+bnVtX3BsYW5lcyAvIDI7CiB9CiAK
K3N0YXRpYyBib29sIGlzX2dlbjEyX2Njc19tb2RpZmllcih1NjQgbW9kaWZpZXIpCit7CisJcmV0
dXJuIG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUzsKK30K
Kworc3RhdGljIGJvb2wgaXNfZ2VuMTJfY2NzX3BsYW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVi
dWZmZXIgKmZiLCBpbnQgcGxhbmUpCit7CisJcmV0dXJuIGlzX2dlbjEyX2Njc19tb2RpZmllcihm
Yi0+bW9kaWZpZXIpICYmIGlzX2Njc19wbGFuZShmYiwgcGxhbmUpOworfQorCiBzdGF0aWMgYm9v
bCBpc19hdXhfcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBwbGFu
ZSkKIHsKIAlpZiAoaXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikpCkBAIC0xOTU3LDYgKzE5
NjcsMTQgQEAgc3RhdGljIGludCBtYWluX3RvX2Njc19wbGFuZShjb25zdCBzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiwgaW50IG1haW5fcGxhbmUpCiAJcmV0dXJuIGZiLT5mb3JtYXQtPm51bV9w
bGFuZXMgLyAyICsgbWFpbl9wbGFuZTsKIH0KIAorc3RhdGljIGludCBjY3NfdG9fbWFpbl9wbGFu
ZShjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNjc19wbGFuZSkKK3sKKwlX
QVJOX09OKCFpc19jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSB8fAorCQljY3NfcGxhbmUgPCBm
Yi0+Zm9ybWF0LT5udW1fcGxhbmVzIC8gMik7CisKKwlyZXR1cm4gY2NzX3BsYW5lIC0gZmItPmZv
cm1hdC0+bnVtX3BsYW5lcyAvIDI7Cit9CisKIC8qIFJldHVybiBlaXRoZXIgdGhlIG1haW4gcGxh
bmUncyBDQ1Mgb3IgLSBpZiBub3QgYSBDQ1MgRkIgLSBVViBwbGFuZSAqLwogc3RhdGljIGludAog
aW50ZWxfbWFpbl90b19hdXhfcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIs
IGludCBtYWluX3BsYW5lKQpAQCAtMTk4NSw2ICsyMDAzLDEwIEBAIGludGVsX3RpbGVfd2lkdGhf
Ynl0ZXMoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFuZSkK
IAkJaWYgKGlzX2Njc19wbGFuZShmYiwgY29sb3JfcGxhbmUpKQogCQkJcmV0dXJuIDEyODsKIAkJ
LyogZmFsbCB0aHJvdWdoICovCisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9S
Q19DQ1M6CisJCWlmIChpc19jY3NfcGxhbmUoZmIsIGNvbG9yX3BsYW5lKSkKKwkJCXJldHVybiA2
NDsKKwkJLyogZmFsbCB0aHJvdWdoICovCiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRDoK
IAkJaWYgKElTX0dFTihkZXZfcHJpdiwgMikgfHwgSEFTXzEyOF9CWVRFX1lfVElMSU5HKGRldl9w
cml2KSkKIAkJCXJldHVybiAxMjg7CkBAIC0yMDE4LDYgKzIwNDAsOSBAQCBpbnRlbF90aWxlX3dp
ZHRoX2J5dGVzKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgY29sb3JfcGxh
bmUpCiBzdGF0aWMgdW5zaWduZWQgaW50CiBpbnRlbF90aWxlX2hlaWdodChjb25zdCBzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNvbG9yX3BsYW5lKQogeworCWlmIChpc19nZW4xMl9j
Y3NfcGxhbmUoZmIsIGNvbG9yX3BsYW5lKSkKKwkJcmV0dXJuIDE7CisKIAlyZXR1cm4gaW50ZWxf
dGlsZV9zaXplKHRvX2k5MTUoZmItPmRldikpIC8KIAkJaW50ZWxfdGlsZV93aWR0aF9ieXRlcyhm
YiwgY29sb3JfcGxhbmUpOwogfQpAQCAtMjExOCw2ICsyMTQzLDggQEAgc3RhdGljIHVuc2lnbmVk
IGludCBpbnRlbF9zdXJmX2FsaWdubWVudChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpm
YiwKIAkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkKIAkJCXJldHVybiAyNTYgKiAxMDI0
OwogCQlyZXR1cm4gMDsKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0ND
UzoKKwkJcmV0dXJuIDE2ICogMTAyNDsKIAljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0ND
UzoKIAljYXNlIEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRF9DQ1M6CiAJY2FzZSBJOTE1X0ZPUk1B
VF9NT0RfWV9USUxFRDoKQEAgLTIzMTAsOSArMjMzNywxMCBAQCBzdGF0aWMgdTMyIGludGVsX2Fk
anVzdF90aWxlX29mZnNldChpbnQgKngsIGludCAqeSwKIAlyZXR1cm4gbmV3X29mZnNldDsKIH0K
IAotc3RhdGljIGJvb2wgaXNfc3VyZmFjZV9saW5lYXIodTY0IG1vZGlmaWVyLCBpbnQgY29sb3Jf
cGxhbmUpCitzdGF0aWMgYm9vbCBpc19zdXJmYWNlX2xpbmVhcihjb25zdCBzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiwgaW50IGNvbG9yX3BsYW5lKQogewotCXJldHVybiBtb2RpZmllciA9PSBE
Uk1fRk9STUFUX01PRF9MSU5FQVI7CisJcmV0dXJuIGZiLT5tb2RpZmllciA9PSBEUk1fRk9STUFU
X01PRF9MSU5FQVIgfHwKKwkgICAgICAgaXNfZ2VuMTJfY2NzX3BsYW5lKGZiLCBjb2xvcl9wbGFu
ZSk7CiB9CiAKIHN0YXRpYyB1MzIgaW50ZWxfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KGludCAqeCwg
aW50ICp5LApAQCAtMjMyNyw3ICsyMzU1LDcgQEAgc3RhdGljIHUzMiBpbnRlbF9hZGp1c3RfYWxp
Z25lZF9vZmZzZXQoaW50ICp4LCBpbnQgKnksCiAKIAlXQVJOX09OKG5ld19vZmZzZXQgPiBvbGRf
b2Zmc2V0KTsKIAotCWlmICghaXNfc3VyZmFjZV9saW5lYXIoZmItPm1vZGlmaWVyLCBjb2xvcl9w
bGFuZSkpIHsKKwlpZiAoIWlzX3N1cmZhY2VfbGluZWFyKGZiLCBjb2xvcl9wbGFuZSkpIHsKIAkJ
dW5zaWduZWQgaW50IHRpbGVfc2l6ZSwgdGlsZV93aWR0aCwgdGlsZV9oZWlnaHQ7CiAJCXVuc2ln
bmVkIGludCBwaXRjaF90aWxlczsKIApAQCAtMjM5Nyw3ICsyNDI1LDcgQEAgc3RhdGljIHUzMiBp
bnRlbF9jb21wdXRlX2FsaWduZWRfb2Zmc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKIAlpZiAoYWxpZ25tZW50KQogCQlhbGlnbm1lbnQtLTsKIAotCWlmICghaXNfc3VyZmFj
ZV9saW5lYXIoZmItPm1vZGlmaWVyLCBjb2xvcl9wbGFuZSkpIHsKKwlpZiAoIWlzX3N1cmZhY2Vf
bGluZWFyKGZiLCBjb2xvcl9wbGFuZSkpIHsKIAkJdW5zaWduZWQgaW50IHRpbGVfc2l6ZSwgdGls
ZV93aWR0aCwgdGlsZV9oZWlnaHQ7CiAJCXVuc2lnbmVkIGludCB0aWxlX3Jvd3MsIHRpbGVzLCBw
aXRjaF90aWxlczsKIApAQCAtMjQ5OSw2ICsyNTI3LDcgQEAgc3RhdGljIHVuc2lnbmVkIGludCBp
bnRlbF9mYl9tb2RpZmllcl90b190aWxpbmcodTY0IGZiX21vZGlmaWVyKQogCQlyZXR1cm4gSTkx
NV9USUxJTkdfWDsKIAljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEOgogCWNhc2UgSTkxNV9G
T1JNQVRfTU9EX1lfVElMRURfQ0NTOgorCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VO
MTJfUkNfQ0NTOgogCQlyZXR1cm4gSTkxNV9USUxJTkdfWTsKIAlkZWZhdWx0OgogCQlyZXR1cm4g
STkxNV9USUxJTkdfTk9ORTsKQEAgLTI1MTksNyArMjU0OCw3IEBAIHN0YXRpYyB1bnNpZ25lZCBp
bnQgaW50ZWxfZmJfbW9kaWZpZXJfdG9fdGlsaW5nKHU2NCBmYl9tb2RpZmllcikKICAqIHVzIGEg
cmF0aW8gb2Ygb25lIGJ5dGUgaW4gdGhlIENDUyBmb3IgZWFjaCA4eDE2IHBpeGVscyBpbiB0aGUK
ICAqIG1haW4gc3VyZmFjZS4KICAqLwotc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0X2lu
Zm8gY2NzX2Zvcm1hdHNbXSA9IHsKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZv
IHNrbF9jY3NfZm9ybWF0c1tdID0gewogCXsgLmZvcm1hdCA9IERSTV9GT1JNQVRfWFJHQjg4ODgs
IC5kZXB0aCA9IDI0LCAubnVtX3BsYW5lcyA9IDIsCiAJICAuY3BwID0geyA0LCAxLCB9LCAuaHN1
YiA9IDgsIC52c3ViID0gMTYsIH0sCiAJeyAuZm9ybWF0ID0gRFJNX0ZPUk1BVF9YQkdSODg4OCwg
LmRlcHRoID0gMjQsIC5udW1fcGxhbmVzID0gMiwKQEAgLTI1MzAsNiArMjU1OSwyOCBAQCBzdGF0
aWMgY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyBjY3NfZm9ybWF0c1tdID0gewogCSAgLmNw
cCA9IHsgNCwgMSwgfSwgLmhzdWIgPSA4LCAudnN1YiA9IDE2LCAuaGFzX2FscGhhID0gdHJ1ZSwg
fSwKIH07CiAKKy8qCisgKiBHZW4tMTIgY29tcHJlc3Npb24gdXNlcyA0IGJpdHMgb2YgQ0NTIGRh
dGEgZm9yIGVhY2ggY2FjaGUgbGluZSBwYWlyIGluIHRoZQorICogbWFpbiBzdXJmYWNlLiBBbmQg
ZWFjaCA2NEIgQ0NTIGNhY2hlIGxpbmUgcmVwcmVzZW50cyBhbiBhcmVhIG9mIDR4MSBZLXRpbGVz
CisgKiBpbiB0aGUgbWFpbiBzdXJmYWNlLiBXaXRoIDQgYnl0ZSBwaXhlbHMgYW5kIGVhY2ggWS10
aWxlIGhhdmluZyBkaW1lbnNpb25zIG9mCisgKiAzMngzMiBwaXhlbHMsIHRoZSByYXRpbyB0dXJu
cyBvdXQgdG8gMUIgaW4gdGhlIENDUyBmb3IgZXZlcnkgMngzMiBwaXhlbHMgaW4KKyAqIHRoZSBt
YWluIHN1cmZhY2UuCisgKi8KK3N0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvIGdl
bjEyX2Njc19mb3JtYXRzW10gPSB7CisJeyAuZm9ybWF0ID0gRFJNX0ZPUk1BVF9YUkdCODg4OCwg
LmRlcHRoID0gMjQsIC5udW1fcGxhbmVzID0gMiwKKwkgIC5jaGFyX3Blcl9ibG9jayA9IHsgNCwg
MSB9LCAuYmxvY2tfdyA9IHsgMSwgMiB9LCAuYmxvY2tfaCA9IHsgMSwgMSB9LAorCSAgLmhzdWIg
PSAxLCAudnN1YiA9IDEsIH0sCisJeyAuZm9ybWF0ID0gRFJNX0ZPUk1BVF9YQkdSODg4OCwgLmRl
cHRoID0gMjQsIC5udW1fcGxhbmVzID0gMiwKKwkgIC5jaGFyX3Blcl9ibG9jayA9IHsgNCwgMSB9
LCAuYmxvY2tfdyA9IHsgMSwgMiB9LCAuYmxvY2tfaCA9IHsgMSwgMSB9LAorCSAgLmhzdWIgPSAx
LCAudnN1YiA9IDEsIH0sCisJeyAuZm9ybWF0ID0gRFJNX0ZPUk1BVF9BUkdCODg4OCwgLmRlcHRo
ID0gMzIsIC5udW1fcGxhbmVzID0gMiwKKwkgIC5jaGFyX3Blcl9ibG9jayA9IHsgNCwgMSB9LCAu
YmxvY2tfdyA9IHsgMSwgMiB9LCAuYmxvY2tfaCA9IHsgMSwgMSB9LAorCSAgLmhzdWIgPSAxLCAu
dnN1YiA9IDEsIC5oYXNfYWxwaGEgPSB0cnVlIH0sCisJeyAuZm9ybWF0ID0gRFJNX0ZPUk1BVF9B
QkdSODg4OCwgLmRlcHRoID0gMzIsIC5udW1fcGxhbmVzID0gMiwKKwkgIC5jaGFyX3Blcl9ibG9j
ayA9IHsgNCwgMSB9LCAuYmxvY2tfdyA9IHsgMSwgMiB9LCAuYmxvY2tfaCA9IHsgMSwgMSB9LAor
CSAgLmhzdWIgPSAxLCAudnN1YiA9IDEsIC5oYXNfYWxwaGEgPSB0cnVlIH0sCit9OworCiBzdGF0
aWMgY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyAqCiBsb29rdXBfZm9ybWF0X2luZm8oY29u
c3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyBmb3JtYXRzW10sCiAJCSAgIGludCBudW1fZm9ybWF0
cywgdTMyIGZvcm1hdCkKQEAgLTI1NTAsOCArMjYwMSwxMiBAQCBpbnRlbF9nZXRfZm9ybWF0X2lu
Zm8oY29uc3Qgc3RydWN0IGRybV9tb2RlX2ZiX2NtZDIgKmNtZCkKIAlzd2l0Y2ggKGNtZC0+bW9k
aWZpZXJbMF0pIHsKIAljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUzoKIAljYXNlIEk5
MTVfRk9STUFUX01PRF9ZZl9USUxFRF9DQ1M6Ci0JCXJldHVybiBsb29rdXBfZm9ybWF0X2luZm8o
Y2NzX2Zvcm1hdHMsCi0JCQkJCSAgQVJSQVlfU0laRShjY3NfZm9ybWF0cyksCisJCXJldHVybiBs
b29rdXBfZm9ybWF0X2luZm8oc2tsX2Njc19mb3JtYXRzLAorCQkJCQkgIEFSUkFZX1NJWkUoc2ts
X2Njc19mb3JtYXRzKSwKKwkJCQkJICBjbWQtPnBpeGVsX2Zvcm1hdCk7CisJY2FzZSBJOTE1X0ZP
Uk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1M6CisJCXJldHVybiBsb29rdXBfZm9ybWF0X2lu
Zm8oZ2VuMTJfY2NzX2Zvcm1hdHMsCisJCQkJCSAgQVJSQVlfU0laRShnZW4xMl9jY3NfZm9ybWF0
cyksCiAJCQkJCSAgY21kLT5waXhlbF9mb3JtYXQpOwogCWRlZmF1bHQ6CiAJCXJldHVybiBOVUxM
OwpAQCAtMjU2MCw3ICsyNjE1LDggQEAgaW50ZWxfZ2V0X2Zvcm1hdF9pbmZvKGNvbnN0IHN0cnVj
dCBkcm1fbW9kZV9mYl9jbWQyICpjbWQpCiAKIGJvb2wgaXNfY2NzX21vZGlmaWVyKHU2NCBtb2Rp
ZmllcikKIHsKLQlyZXR1cm4gbW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfQ0NT
IHx8CisJcmV0dXJuIG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JD
X0NDUyB8fAorCSAgICAgICBtb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1Mg
fHwKIAkgICAgICAgbW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEX0NDUzsKIH0K
IApAQCAtMjYwOCw4ICsyNjY0LDkgQEAgc3RhdGljIHUzMgogaW50ZWxfZmJfc3RyaWRlX2FsaWdu
bWVudChjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNvbG9yX3BsYW5lKQog
ewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZmItPmRldik7
CisJdTMyIHRpbGVfd2lkdGg7CiAKLQlpZiAoZmItPm1vZGlmaWVyID09IERSTV9GT1JNQVRfTU9E
X0xJTkVBUikgeworCWlmIChpc19zdXJmYWNlX2xpbmVhcihmYiwgY29sb3JfcGxhbmUpKSB7CiAJ
CXUzMiBtYXhfc3RyaWRlID0gaW50ZWxfcGxhbmVfZmJfbWF4X3N0cmlkZShkZXZfcHJpdiwKIAkJ
CQkJCQkgICBmYi0+Zm9ybWF0LT5mb3JtYXQsCiAJCQkJCQkJICAgZmItPm1vZGlmaWVyKTsKQEAg
LTI2MTgsMTMgKzI2NzUsMTQgQEAgaW50ZWxfZmJfc3RyaWRlX2FsaWdubWVudChjb25zdCBzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNvbG9yX3BsYW5lKQogCQkgKiBUbyBtYWtlIHJl
bWFwcGluZyB3aXRoIGxpbmVhciBnZW5lcmFsbHkgZmVhc2libGUKIAkJICogd2UgbmVlZCB0aGUg
c3RyaWRlIHRvIGJlIHBhZ2UgYWxpZ25lZC4KIAkJICovCi0JCWlmIChmYi0+cGl0Y2hlc1tjb2xv
cl9wbGFuZV0gPiBtYXhfc3RyaWRlKQorCQlpZiAoZmItPnBpdGNoZXNbY29sb3JfcGxhbmVdID4g
bWF4X3N0cmlkZSAmJiAhaXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikpCiAJCQlyZXR1cm4g
aW50ZWxfdGlsZV9zaXplKGRldl9wcml2KTsKIAkJZWxzZQogCQkJcmV0dXJuIDY0OwotCX0gZWxz
ZSB7Ci0JCXUzMiB0aWxlX3dpZHRoID0gaW50ZWxfdGlsZV93aWR0aF9ieXRlcyhmYiwgY29sb3Jf
cGxhbmUpOworCX0KIAorCXRpbGVfd2lkdGggPSBpbnRlbF90aWxlX3dpZHRoX2J5dGVzKGZiLCBj
b2xvcl9wbGFuZSk7CisJaWYgKGlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpICYmIGNvbG9y
X3BsYW5lID09IDApIHsKIAkJLyoKIAkJICogRGlzcGxheSBXQSAjMDUzMTogc2tsLGJ4dCxrYmws
Z2xrCiAJCSAqCkBAIC0yNjM0LDEyICsyNjkyLDE2IEBAIGludGVsX2ZiX3N0cmlkZV9hbGlnbm1l
bnQoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFuZSkKIAkJ
ICogcmVxdWlyZSB0aGUgZW50aXJlIGZiIHRvIGFjY29tbW9kYXRlIHRoYXQgdG8gYXZvaWQKIAkJ
ICogcG90ZW50aWFsIHJ1bnRpbWUgZXJyb3JzIGF0IHBsYW5lIGNvbmZpZ3VyYXRpb24gdGltZS4K
IAkJICovCi0JCWlmIChJU19HRU4oZGV2X3ByaXYsIDkpICYmIGlzX2Njc19tb2RpZmllcihmYi0+
bW9kaWZpZXIpICYmCi0JCSAgICBjb2xvcl9wbGFuZSA9PSAwICYmIGZiLT53aWR0aCA+IDM4NDAp
CisJCWlmIChJU19HRU4oZGV2X3ByaXYsIDkpICYmIGZiLT53aWR0aCA+IDM4NDApCisJCQl0aWxl
X3dpZHRoICo9IDQ7CisJCS8qCisJCSAqIFRoZSBtYWluIHN1cmZhY2UgcGl0Y2ggbXVzdCBiZSBw
YWRkZWQgdG8gYSBtdWx0aXBsZSBvZiBmb3VyCisJCSAqIHRpbGUgd2lkdGhzLgorCQkgKi8KKwkJ
ZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikKIAkJCXRpbGVfd2lkdGggKj0gNDsK
LQotCQlyZXR1cm4gdGlsZV93aWR0aDsKIAl9CisJcmV0dXJuIHRpbGVfd2lkdGg7CiB9CiAKIGJv
b2wgaW50ZWxfcGxhbmVfY2FuX3JlbWFwKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUpCkBAIC0yNzEwLDI1ICsyNzcyLDc0IEBAIHN0YXRpYyBib29sIGludGVsX3Bs
YW5lX25lZWRzX3JlbWFwKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3Rh
dGUpCiAJcmV0dXJuIHN0cmlkZSA+IG1heF9zdHJpZGU7CiB9CiAKK3N0YXRpYyB2b2lkCitpbnRl
bF9mYl9wbGFuZV9nZXRfc3Vic2FtcGxpbmcoaW50ICpoc3ViLCBpbnQgKnZzdWIsCisJCQkgICAg
ICAgY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCisJCQkgICAgICAgaW50IGNvbG9y
X3BsYW5lKQoreworCWludCBtYWluX3BsYW5lOworCisJaWYgKGNvbG9yX3BsYW5lID09IDApIHsK
KwkJKmhzdWIgPSAxOworCQkqdnN1YiA9IDE7CisKKwkJcmV0dXJuOworCX0KKworCS8qCisJICog
VE9ETzogRGVkdWN0IHRoZSBzdWJzYW1wbGluZyBmcm9tIHRoZSBjaGFyIGJsb2NrIGZvciBhbGwg
Q0NTCisJICogZm9ybWF0cyBhbmQgcGxhbmVzLgorCSAqLworCWlmICghaXNfZ2VuMTJfY2NzX3Bs
YW5lKGZiLCBjb2xvcl9wbGFuZSkpIHsKKwkJKmhzdWIgPSBmYi0+Zm9ybWF0LT5oc3ViOworCQkq
dnN1YiA9IGZiLT5mb3JtYXQtPnZzdWI7CisKKwkJcmV0dXJuOworCX0KKworCW1haW5fcGxhbmUg
PSBjY3NfdG9fbWFpbl9wbGFuZShmYiwgY29sb3JfcGxhbmUpOworCSpoc3ViID0gZHJtX2Zvcm1h
dF9pbmZvX2Jsb2NrX3dpZHRoKGZiLT5mb3JtYXQsIGNvbG9yX3BsYW5lKSAvCisJICAgICAgICBk
cm1fZm9ybWF0X2luZm9fYmxvY2tfd2lkdGgoZmItPmZvcm1hdCwgbWFpbl9wbGFuZSk7CisKKwkv
KgorCSAqIFRoZSBtaW4gc3RyaWRlIGNoZWNrIGluIHRoZSBjb3JlIGZyYW1lYnVmZmVyX2NoZWNr
KCkgZnVuY3Rpb24KKwkgKiBhc3N1bWVzIHRoYXQgZm9ybWF0LT5oc3ViIGFwcGxpZXMgdG8gZXZl
cnkgcGxhbmUgZXhjZXB0IGZvciB0aGUKKwkgKiBmaXJzdCBwbGFuZS4gVGhhdCdzIGluY29ycmVj
dCBmb3IgdGhlIENDUyBBVVggcGxhbmUgb2YgdGhlIGZpcnN0CisJICogcGxhbmUsIGJ1dCBmb3Ig
dGhlIGFib3ZlIGNoZWNrIHRvIHBhc3Mgd2UgbXVzdCBkZWZpbmUgdGhlIGJsb2NrCisJICogd2lk
dGggd2l0aCB0aGF0IHN1YnNhbXBsaW5nIGFwcGxpZWQgdG8gaXQuIEFkanVzdCB0aGUgd2lkdGgg
aGVyZQorCSAqIGFjY29yZGluZ2x5LCBzbyB3ZSBjYW4gY2FsY3VsYXRlIHRoZSBhY3R1YWwgc3Vi
c2FtcGxpbmcgZmFjdG9yLgorCSAqLworCWlmIChtYWluX3BsYW5lID09IDApCisJCSpoc3ViICo9
IGZiLT5mb3JtYXQtPmhzdWI7CisKKwkqdnN1YiA9IDMyOworfQogc3RhdGljIGludAogaW50ZWxf
ZmJfY2hlY2tfY2NzX3h5KHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgeCwgaW50IHkp
CiB7CiAJc3RydWN0IGludGVsX2ZyYW1lYnVmZmVyICppbnRlbF9mYiA9IHRvX2ludGVsX2ZyYW1l
YnVmZmVyKGZiKTsKLQlpbnQgaHN1YiA9IGZiLT5mb3JtYXQtPmhzdWI7Ci0JaW50IHZzdWIgPSBm
Yi0+Zm9ybWF0LT52c3ViOworCWludCBtYWluX3BsYW5lOworCWludCBoc3ViLCB2c3ViOwogCWlu
dCB0aWxlX3dpZHRoLCB0aWxlX2hlaWdodDsKIAlpbnQgY2NzX3gsIGNjc195OwogCWludCBtYWlu
X3gsIG1haW5feTsKKwlpbnQgY2NzX3BsYW5lID0gMTsKIAotCWludGVsX3RpbGVfZGltcyhmYiwg
MSwgJnRpbGVfd2lkdGgsICZ0aWxlX2hlaWdodCk7CisJaWYgKCFpc19jY3NfcGxhbmUoZmIsIGNj
c19wbGFuZSkpCisJCXJldHVybiAwOworCisJaW50ZWxfdGlsZV9kaW1zKGZiLCBjY3NfcGxhbmUs
ICZ0aWxlX3dpZHRoLCAmdGlsZV9oZWlnaHQpOworCWludGVsX2ZiX3BsYW5lX2dldF9zdWJzYW1w
bGluZygmaHN1YiwgJnZzdWIsIGZiLCBjY3NfcGxhbmUpOwogCiAJdGlsZV93aWR0aCAqPSBoc3Vi
OwogCXRpbGVfaGVpZ2h0ICo9IHZzdWI7CiAKIAljY3NfeCA9ICh4ICogaHN1YikgJSB0aWxlX3dp
ZHRoOwogCWNjc195ID0gKHkgKiB2c3ViKSAlIHRpbGVfaGVpZ2h0OwotCW1haW5feCA9IGludGVs
X2ZiLT5ub3JtYWxbMF0ueCAlIHRpbGVfd2lkdGg7Ci0JbWFpbl95ID0gaW50ZWxfZmItPm5vcm1h
bFswXS55ICUgdGlsZV9oZWlnaHQ7CisKKwltYWluX3BsYW5lID0gY2NzX3RvX21haW5fcGxhbmUo
ZmIsIGNjc19wbGFuZSk7CisJbWFpbl94ID0gaW50ZWxfZmItPm5vcm1hbFttYWluX3BsYW5lXS54
ICUgdGlsZV93aWR0aDsKKwltYWluX3kgPSBpbnRlbF9mYi0+bm9ybWFsW21haW5fcGxhbmVdLnkg
JSB0aWxlX2hlaWdodDsKIAogCS8qCiAJICogQ0NTIGRvZXNuJ3QgaGF2ZSBpdHMgb3duIHgveSBv
ZmZzZXQgcmVnaXN0ZXIsIHNvIHRoZSBpbnRyYSBDQ1MgdGlsZQpAQCAtMjczOCw4ICsyODQ5LDgg
QEAgaW50ZWxfZmJfY2hlY2tfY2NzX3h5KHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQg
eCwgaW50IHkpCiAJCURSTV9ERUJVR19LTVMoIkJhZCBDQ1MgeC95IChtYWluICVkLCVkIGNjcyAl
ZCwlZCkgZnVsbCAobWFpbiAlZCwlZCBjY3MgJWQsJWQpXG4iLAogCQkJICAgICAgbWFpbl94LCBt
YWluX3ksCiAJCQkgICAgICBjY3NfeCwgY2NzX3ksCi0JCQkgICAgICBpbnRlbF9mYi0+bm9ybWFs
WzBdLngsCi0JCQkgICAgICBpbnRlbF9mYi0+bm9ybWFsWzBdLnksCisJCQkgICAgICBpbnRlbF9m
Yi0+bm9ybWFsW21haW5fcGxhbmVdLngsCisJCQkgICAgICBpbnRlbF9mYi0+bm9ybWFsW21haW5f
cGxhbmVdLnksCiAJCQkgICAgICB4LCB5KTsKIAkJcmV0dXJuIC1FSU5WQUw7CiAJfQpAQCAtMjgx
MCw3ICsyOTIxLDcgQEAgaW50ZWxfZmlsbF9mYl9pbmZvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIAkJCQkJCSAgICAgIHRpbGVfc2l6ZSk7CiAJCW9mZnNldCAvPSB0aWxlX3Np
emU7CiAKLQkJaWYgKCFpc19zdXJmYWNlX2xpbmVhcihmYi0+bW9kaWZpZXIsIGkpKSB7CisJCWlm
ICghaXNfc3VyZmFjZV9saW5lYXIoZmIsIGkpKSB7CiAJCQl1bnNpZ25lZCBpbnQgdGlsZV93aWR0
aCwgdGlsZV9oZWlnaHQ7CiAJCQl1bnNpZ25lZCBpbnQgcGl0Y2hfdGlsZXM7CiAJCQlzdHJ1Y3Qg
ZHJtX3JlY3QgcjsKQEAgLTM0ODksMTQgKzM2MDAsMTUgQEAgc3RhdGljIGJvb2wgc2tsX2NoZWNr
X21haW5fY2NzX2Nvb3JkaW5hdGVzKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3Rh
dGUKIAkJCQkJICAgaW50IG1haW5feCwgaW50IG1haW5feSwgdTMyIG1haW5fb2Zmc2V0KQogewog
CWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwot
CWludCBoc3ViID0gZmItPmZvcm1hdC0+aHN1YjsKLQlpbnQgdnN1YiA9IGZiLT5mb3JtYXQtPnZz
dWI7CiAJaW50IGNjc19wbGFuZSA9IG1haW5fdG9fY2NzX3BsYW5lKGZiLCAwKTsKIAlpbnQgYXV4
X3ggPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS54OwogCWludCBhdXhfeSA9
IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLnk7CiAJdTMyIGF1eF9vZmZzZXQg
PSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY2NzX3BsYW5lXS5vZmZzZXQ7CiAJdTMyIGFsaWdu
bWVudCA9IGludGVsX3N1cmZfYWxpZ25tZW50KGZiLCBjY3NfcGxhbmUpOworCWludCBoc3ViOwor
CWludCB2c3ViOwogCisJaW50ZWxfZmJfcGxhbmVfZ2V0X3N1YnNhbXBsaW5nKCZoc3ViLCAmdnN1
YiwgZmIsIGNjc19wbGFuZSk7CiAJd2hpbGUgKGF1eF9vZmZzZXQgPj0gbWFpbl9vZmZzZXQgJiYg
YXV4X3kgPD0gbWFpbl95KSB7CiAJCWludCB4LCB5OwogCkBAIC0zNjU3LDEyICszNzY5LDE1IEBA
IHN0YXRpYyBpbnQgc2tsX2NoZWNrX2Njc19hdXhfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVf
c3RhdGUgKnBsYW5lX3N0YXRlKQogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0g
cGxhbmVfc3RhdGUtPmh3LmZiOwogCWludCBzcmNfeCA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy54
MSA+PiAxNjsKIAlpbnQgc3JjX3kgPSBwbGFuZV9zdGF0ZS0+dWFwaS5zcmMueTEgPj4gMTY7Ci0J
aW50IGhzdWIgPSBmYi0+Zm9ybWF0LT5oc3ViOwotCWludCB2c3ViID0gZmItPmZvcm1hdC0+dnN1
YjsKLQlpbnQgeCA9IHNyY194IC8gaHN1YjsKLQlpbnQgeSA9IHNyY195IC8gdnN1YjsKKwlpbnQg
aHN1YjsKKwlpbnQgdnN1YjsKKwlpbnQgeDsKKwlpbnQgeTsKIAl1MzIgb2Zmc2V0OwogCisJaW50
ZWxfZmJfcGxhbmVfZ2V0X3N1YnNhbXBsaW5nKCZoc3ViLCAmdnN1YiwgZmIsIDEpOworCXggPSBz
cmNfeCAvIGhzdWI7CisJeSA9IHNyY195IC8gdnN1YjsKIAlpbnRlbF9hZGRfZmJfb2Zmc2V0cygm
eCwgJnksIHBsYW5lX3N0YXRlLCAxKTsKIAlvZmZzZXQgPSBpbnRlbF9wbGFuZV9jb21wdXRlX2Fs
aWduZWRfb2Zmc2V0KCZ4LCAmeSwgcGxhbmVfc3RhdGUsIDEpOwogCkBAIC00MTU4LDcgKzQyNzMs
NyBAQCBzdGF0aWMgdW5zaWduZWQgaW50IHNrbF9wbGFuZV9zdHJpZGVfbXVsdChjb25zdCBzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKIAkgKiBUaGUgc3RyaWRlIGlzIGVpdGhlciBleHByZXNz
ZWQgYXMgYSBtdWx0aXBsZSBvZiA2NCBieXRlcyBjaHVua3MgZm9yCiAJICogbGluZWFyIGJ1ZmZl
cnMgb3IgaW4gbnVtYmVyIG9mIHRpbGVzIGZvciB0aWxlZCBidWZmZXJzLgogCSAqLwotCWlmIChm
Yi0+bW9kaWZpZXIgPT0gRFJNX0ZPUk1BVF9NT0RfTElORUFSKQorCWlmIChpc19zdXJmYWNlX2xp
bmVhcihmYiwgY29sb3JfcGxhbmUpKQogCQlyZXR1cm4gNjQ7CiAJZWxzZSBpZiAoZHJtX3JvdGF0
aW9uXzkwX29yXzI3MChyb3RhdGlvbikpCiAJCXJldHVybiBpbnRlbF90aWxlX2hlaWdodChmYiwg
Y29sb3JfcGxhbmUpOwpAQCAtNDI4Niw2ICs0NDAxLDEwIEBAIHN0YXRpYyB1MzIgc2tsX3BsYW5l
X2N0bF90aWxpbmcodTY0IGZiX21vZGlmaWVyKQogCQlyZXR1cm4gUExBTkVfQ1RMX1RJTEVEX1k7
CiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1M6CiAJCXJldHVybiBQTEFORV9DVExf
VElMRURfWSB8IFBMQU5FX0NUTF9SRU5ERVJfREVDT01QUkVTU0lPTl9FTkFCTEU7CisJY2FzZSBJ
OTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1M6CisJCXJldHVybiBQTEFORV9DVExf
VElMRURfWSB8CisJCSAgICAgICBQTEFORV9DVExfUkVOREVSX0RFQ09NUFJFU1NJT05fRU5BQkxF
IHwKKwkJICAgICAgIFBMQU5FX0NUTF9DTEVBUl9DT0xPUl9ESVNBQkxFOwogCWNhc2UgSTkxNV9G
T1JNQVRfTU9EX1lmX1RJTEVEOgogCQlyZXR1cm4gUExBTkVfQ1RMX1RJTEVEX1lGOwogCWNhc2Ug
STkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEX0NDUzoKQEAgLTEwMDIxLDcgKzEwMTQwLDkgQEAgc2t5
bGFrZV9nZXRfaW5pdGlhbF9wbGFuZV9jb25maWcoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJ
Y2FzZSBQTEFORV9DVExfVElMRURfWToKIAkJcGxhbmVfY29uZmlnLT50aWxpbmcgPSBJOTE1X1RJ
TElOR19ZOwogCQlpZiAodmFsICYgUExBTkVfQ1RMX1JFTkRFUl9ERUNPTVBSRVNTSU9OX0VOQUJM
RSkKLQkJCWZiLT5tb2RpZmllciA9IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUzsKKwkJCWZi
LT5tb2RpZmllciA9IElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIgPworCQkJCUk5MTVfRk9STUFU
X01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUyA6CisJCQkJSTkxNV9GT1JNQVRfTU9EX1lfVElMRURf
Q0NTOwogCQllbHNlCiAJCQlmYi0+bW9kaWZpZXIgPSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRDsK
IAkJYnJlYWs7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X3Nwcml0ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYwpp
bmRleCA4Mzk0NTAyYjA5MmQuLjY3YTkwMDU5OTAwZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCkBAIC01ODMsNiArNTgzLDcgQEAgc2tsX3Byb2dyYW1f
cGxhbmUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAljb25zdCBzdHJ1Y3QgZHJtX2ludGVs
X3Nwcml0ZV9jb2xvcmtleSAqa2V5ID0gJnBsYW5lX3N0YXRlLT5ja2V5OwogCXUzMiBzdXJmX2Fk
ZHIgPSBwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbY29sb3JfcGxhbmVdLm9mZnNldDsKIAl1MzIg
c3RyaWRlID0gc2tsX3BsYW5lX3N0cmlkZShwbGFuZV9zdGF0ZSwgY29sb3JfcGxhbmUpOworCXUz
MiBhdXhfZGlzdCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVsxXS5vZmZzZXQgLSBzdXJmX2Fk
ZHI7CiAJdTMyIGF1eF9zdHJpZGUgPSBza2xfcGxhbmVfc3RyaWRlKHBsYW5lX3N0YXRlLCAxKTsK
IAlpbnQgY3J0Y194ID0gcGxhbmVfc3RhdGUtPnVhcGkuZHN0LngxOwogCWludCBjcnRjX3kgPSBw
bGFuZV9zdGF0ZS0+dWFwaS5kc3QueTE7CkBAIC02MjQsOCArNjI1LDEwIEBAIHNrbF9wcm9ncmFt
X3BsYW5lKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAJSTkxNV9XUklURV9GVyhQTEFORV9T
VFJJREUocGlwZSwgcGxhbmVfaWQpLCBzdHJpZGUpOwogCUk5MTVfV1JJVEVfRlcoUExBTkVfUE9T
KHBpcGUsIHBsYW5lX2lkKSwgKGNydGNfeSA8PCAxNikgfCBjcnRjX3gpOwogCUk5MTVfV1JJVEVf
RlcoUExBTkVfU0laRShwaXBlLCBwbGFuZV9pZCksIChzcmNfaCA8PCAxNikgfCBzcmNfdyk7Ci0J
STkxNV9XUklURV9GVyhQTEFORV9BVVhfRElTVChwaXBlLCBwbGFuZV9pZCksCi0JCSAgICAgIChw
bGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMV0ub2Zmc2V0IC0gc3VyZl9hZGRyKSB8IGF1eF9zdHJp
ZGUpOworCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMikKKwkJYXV4X2Rpc3QgfD0gYXV4
X3N0cmlkZTsKKwlJOTE1X1dSSVRFX0ZXKFBMQU5FX0FVWF9ESVNUKHBpcGUsIHBsYW5lX2lkKSwg
YXV4X2Rpc3QpOwogCiAJaWYgKGljbF9pc19oZHJfcGxhbmUoZGV2X3ByaXYsIHBsYW5lX2lkKSkK
IAkJSTkxNV9XUklURV9GVyhQTEFORV9DVVNfQ1RMKHBpcGUsIHBsYW5lX2lkKSwgcGxhbmVfc3Rh
dGUtPmN1c19jdGwpOwpAQCAtMjEwMiw3ICsyMTA1LDggQEAgc3RhdGljIGludCBza2xfcGxhbmVf
Y2hlY2tfZmIoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJICAg
IChmYi0+bW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQgfHwKIAkgICAgIGZiLT5t
b2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRUQgfHwKIAkgICAgIGZiLT5tb2RpZmll
ciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1MgfHwKLQkgICAgIGZiLT5tb2RpZmllciA9
PSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRURfQ0NTKSkgeworCSAgICAgZmItPm1vZGlmaWVyID09
IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRF9DQ1MgfHwKKwkgICAgIGZiLT5tb2RpZmllciA9PSBJ
OTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1MpKSB7CiAJCURSTV9ERUJVR19LTVMo
IlkvWWYgdGlsaW5nIG5vdCBzdXBwb3J0ZWQgaW4gSUYtSUQgbW9kZVxuIik7CiAJCXJldHVybiAt
RUlOVkFMOwogCX0KQEAgLTI1NzMsNyArMjU3Nyw4IEBAIHN0YXRpYyBjb25zdCB1NjQgc2tsX3Bs
YW5lX2Zvcm1hdF9tb2RpZmllcnNfY2NzW10gPSB7CiAJRFJNX0ZPUk1BVF9NT0RfSU5WQUxJRAog
fTsKIAotc3RhdGljIGNvbnN0IHU2NCBnZW4xMl9wbGFuZV9mb3JtYXRfbW9kaWZpZXJzX25vY2Nz
W10gPSB7CitzdGF0aWMgY29uc3QgdTY0IGdlbjEyX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfY2Nz
W10gPSB7CisJSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTLAogCUk5MTVfRk9S
TUFUX01PRF9ZX1RJTEVELAogCUk5MTVfRk9STUFUX01PRF9YX1RJTEVELAogCURSTV9GT1JNQVRf
TU9EX0xJTkVBUiwKQEAgLTI3NDQsNiArMjc0OSw3IEBAIHN0YXRpYyBib29sIGdlbjEyX3BsYW5l
X2Zvcm1hdF9tb2Rfc3VwcG9ydGVkKHN0cnVjdCBkcm1fcGxhbmUgKl9wbGFuZSwKIAljYXNlIERS
TV9GT1JNQVRfTU9EX0xJTkVBUjoKIAljYXNlIEk5MTVfRk9STUFUX01PRF9YX1RJTEVEOgogCWNh
c2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQ6CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxF
RF9HRU4xMl9SQ19DQ1M6CiAJCWJyZWFrOwogCWRlZmF1bHQ6CiAJCXJldHVybiBmYWxzZTsKQEAg
LTI3NTQsNiArMjc2MCw5IEBAIHN0YXRpYyBib29sIGdlbjEyX3BsYW5lX2Zvcm1hdF9tb2Rfc3Vw
cG9ydGVkKHN0cnVjdCBkcm1fcGxhbmUgKl9wbGFuZSwKIAljYXNlIERSTV9GT1JNQVRfWEJHUjg4
ODg6CiAJY2FzZSBEUk1fRk9STUFUX0FSR0I4ODg4OgogCWNhc2UgRFJNX0ZPUk1BVF9BQkdSODg4
ODoKKwkJaWYgKGlzX2Njc19tb2RpZmllcihtb2RpZmllcikpCisJCQlyZXR1cm4gdHJ1ZTsKKwkJ
LyogZmFsbCB0aHJvdWdoICovCiAJY2FzZSBEUk1fRk9STUFUX1JHQjU2NToKIAljYXNlIERSTV9G
T1JNQVRfWFJHQjIxMDEwMTA6CiAJY2FzZSBEUk1fRk9STUFUX1hCR1IyMTAxMDEwOgpAQCAtMjk2
MywxMyArMjk3MiwxMSBAQCBza2xfdW5pdmVyc2FsX3BsYW5lX2NyZWF0ZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCWZvcm1hdHMgPSBza2xfZ2V0X3BsYW5lX2Zvcm1hdHMo
ZGV2X3ByaXYsIHBpcGUsCiAJCQkJCQlwbGFuZV9pZCwgJm51bV9mb3JtYXRzKTsKIAorCXBsYW5l
LT5oYXNfY2NzID0gc2tsX3BsYW5lX2hhc19jY3MoZGV2X3ByaXYsIHBpcGUsIHBsYW5lX2lkKTsK
IAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikgewotCQkvKiBUT0RPOiBJbXBsZW1lbnQg
c3VwcG9ydCBmb3IgZ2VuLTEyIENDUyBtb2RpZmllcnMgKi8KLQkJcGxhbmUtPmhhc19jY3MgPSBm
YWxzZTsKLQkJbW9kaWZpZXJzID0gZ2VuMTJfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19ub2NjczsK
KwkJbW9kaWZpZXJzID0gZ2VuMTJfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19jY3M7CiAJCXBsYW5l
X2Z1bmNzID0gJmdlbjEyX3BsYW5lX2Z1bmNzOwogCX0gZWxzZSB7Ci0JCXBsYW5lLT5oYXNfY2Nz
ID0gc2tsX3BsYW5lX2hhc19jY3MoZGV2X3ByaXYsIHBpcGUsIHBsYW5lX2lkKTsKIAkJaWYgKHBs
YW5lLT5oYXNfY2NzKQogCQkJbW9kaWZpZXJzID0gc2tsX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNf
Y2NzOwogCQllbHNlCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5o
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaAppbmRleCBjYmI0Njg5YWY0MzIuLmJi
ZmVkZWIwMGI3ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oCkBAIC02ODAwLDYgKzY4MDAsNyBA
QCBlbnVtIHsKICNkZWZpbmUgICBQTEFORV9DVExfWVVWNDIyX1ZZVVkJCQkoMyA8PCAxNikKICNk
ZWZpbmUgICBQTEFORV9DVExfUkVOREVSX0RFQ09NUFJFU1NJT05fRU5BQkxFCSgxIDw8IDE1KQog
I2RlZmluZSAgIFBMQU5FX0NUTF9UUklDS0xFX0ZFRURfRElTQUJMRQkoMSA8PCAxNCkKKyNkZWZp
bmUgICBQTEFORV9DVExfQ0xFQVJfQ09MT1JfRElTQUJMRQkJKDEgPDwgMTMpIC8qIFRHTCsgKi8K
ICNkZWZpbmUgICBQTEFORV9DVExfUExBTkVfR0FNTUFfRElTQUJMRQkJKDEgPDwgMTMpIC8qIFBy
ZS1HTEsgKi8KICNkZWZpbmUgICBQTEFORV9DVExfVElMRURfTUFTSwkJCSgweDcgPDwgMTApCiAj
ZGVmaW5lICAgUExBTkVfQ1RMX1RJTEVEX0xJTkVBUgkJKDAgPDwgMTApCi0tIAoyLjIyLjAKCl9f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBt
YWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3Rz
LmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

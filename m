Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id AD8B8FB41C
	for <lists+intel-gfx@lfdr.de>; Wed, 13 Nov 2019 16:49:38 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 12CB56ED7B;
	Wed, 13 Nov 2019 15:49:37 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga02.intel.com (mga02.intel.com [134.134.136.20])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4976D6ED70;
 Wed, 13 Nov 2019 15:49:28 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by orsmga101.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 13 Nov 2019 07:49:27 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.68,300,1569308400"; d="scan'208";a="198479716"
Received: from rosetta.fi.intel.com ([10.237.72.194])
 by orsmga008.jf.intel.com with ESMTP; 13 Nov 2019 07:49:25 -0800
Received: by rosetta.fi.intel.com (Postfix, from userid 1000)
 id 7268A8402DE; Wed, 13 Nov 2019 17:49:17 +0200 (EET)
From: Mika Kuoppala <mika.kuoppala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 13 Nov 2019 17:49:08 +0200
Message-Id: <20191113154913.8787-2-mika.kuoppala@linux.intel.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191113154913.8787-1-mika.kuoppala@linux.intel.com>
References: <20191113154913.8787-1-mika.kuoppala@linux.intel.com>
Subject: [Intel-gfx] [PATCH i-g-t 2/7] igt: Use COND_BBEND for busy spinning
 on gen9
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org, Joonas Lahtinen <joonas.lahtinen@intel.com>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogSm9uIEJsb29tZmllbGQgPGpvbi5ibG9vbWZpZWxkQGludGVsLmNvbT4KCmdlbjkrIGlu
dHJvZHVjZXMgYSBjbWRwYXJzZXIgZm9yIHRoZSBCTFQgZW5naW5lIHdoaWNoIGNvcGllcyB0aGUK
aW5jb21pbmcgQkIgdG8gYSBrbWQgb3duZWQgYnVmZmVyIGZvciBzdWJtaXNzaW9uICh0byBwcmV2
ZW50IGNoYW5nZXMKYmVpbmcgbWFkZSBhZnRlciB0aGUgYmIgaGFzIGJlZW4gc2FmZWx5IHNjYW5u
ZWQpLiBUaGlzIGJyZWFrcyB0aGUKc3BpbiBmdW5jdGlvbmFsaXR5IGJlY2F1c2UgaXQgcmVsaWVz
IG9uIGNoYW5naW5nIHRoZSBzdWJtaXR0ZWQgc3BpbgpidWZmZXJzIGluIG9yZGVyIHRvIHRlcm1p
bmF0ZSB0aGVtLgoKSW5zdGVhZCwgZm9yIGdlbjkrLCB3ZSBjaGFuZ2UgdGhlIHNlbWFudGljcyBi
eSBpbnRyb2R1Y2luZyBhIENPTkRfQkJfRU5ECmludG8gdGhlIGluZmluaXRlIGxvb3AsIHRvIHdh
aXQgdW50aWwgYSBtZW1vcnkgZmxhZyAoaW4gYW5vdGhlIGJvKSBpcwpjbGVhcmVkLgoKdjI6IENv
cnJlY3Qgbm9wIGxlbmd0aCB0byBhdm9pZCBvdmVyd3JpdGluZyBiYl9lbmQgaW5zdHIgd2hlbiB1
c2luZwogICAgYSBkZXBlbmRlbmN5IGJvIChjb3JrKQp2MzogZml4IGNvbmZsaWN0cyBvbiBpZ3Rf
ZHVtbXlsb2FkIChNaWthKQp2NDogcy9ib29sIHJ1bm5pbmcvdWludDMyX3QgcnVubmluZywgZml4
IHItPmRlbHRhIChNaWthKQp2NTogcmVtb3ZlIG92ZXJ6ZWFsb3VzIGFzc2VydCAoTWlrYSkKdjY6
IHJlYmFzZSBvbiB0b3Agb2YgbGliIGNoYW5nZXMgKE1pa2EpCnY3OiByZXdvcmsgb24gdG9wIG9m
IHB1YmxpYyBpZ3QgbGliIGNoYW5nZXMgKE1pa2EpCnY4OiByZWJhc2UKClNpZ25lZC1vZmYtYnk6
IEpvbiBCbG9vbWZpZWxkIDxqb24uYmxvb21maWVsZEBpbnRlbC5jb20+ICh2MikKQ2M6IEpvb25h
cyBMYWh0aW5lbiA8am9vbmFzLmxhaHRpbmVuQGludGVsLmNvbT4KQ2M6IFJvZHJpZ28gVml2aSA8
cm9kcmlnby52aXZpQGludGVsLmNvbT4KQ2M6IE1pa2EgS3VvcHBhbGEgPG1pa2Eua3VvcHBhbGFA
aW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBNaWthIEt1b3BwYWxhIDxtaWthLmt1b3BwYWxhQGxp
bnV4LmludGVsLmNvbT4KLS0tCiBsaWIvaTgzMF9yZWcuaCAgICAgICAgICAgICAgICAgICAgICAg
ICAgfCAgMiArLQogbGliL2lndF9kdW1teWxvYWQuYyAgICAgICAgICAgICAgICAgICAgIHwgNDYg
KysrKysrKysrKysrKysrKysrKysrKystLQogbGliL2lndF9kdW1teWxvYWQuaCAgICAgICAgICAg
ICAgICAgICAgIHwgIDMgKysKIGxpYi9pbnRlbF9yZWcuaCAgICAgICAgICAgICAgICAgICAgICAg
ICB8ICAzICsrCiB0ZXN0cy9pOTE1L2dlbV9kb3VibGVfaXJxX2xvb3AuYyAgICAgICAgfCAgMiAt
LQogdGVzdHMvaTkxNS9nZW1fd3JpdGVfcmVhZF9yaW5nX3N3aXRjaC5jIHwgIDIgKy0KIDYgZmls
ZXMgY2hhbmdlZCwgNTIgaW5zZXJ0aW9ucygrKSwgNiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQg
YS9saWIvaTgzMF9yZWcuaCBiL2xpYi9pODMwX3JlZy5oCmluZGV4IGE1NzY5MWM3Li40MTAyMDI1
NiAxMDA2NDQKLS0tIGEvbGliL2k4MzBfcmVnLmgKKysrIGIvbGliL2k4MzBfcmVnLmgKQEAgLTQz
LDcgKzQzLDcgQEAKIC8qIGJyb2Fkd2F0ZXIgZmx1c2ggYml0cyAqLwogI2RlZmluZSBCUldfTUlf
R0xPQkFMX1NOQVBTSE9UX1JFU0VUICAgKDEgPDwgMykKIAotI2RlZmluZSBNSV9DT05EX0JBVENI
X0JVRkZFUl9FTkQJKDB4MzY8PDIzIHwgMSkKKyNkZWZpbmUgTUlfQ09ORF9CQVRDSF9CVUZGRVJf
RU5ECSgweDM2IDw8IDIzKQogI2RlZmluZSBNSV9ET19DT01QQVJFCQkJKDE8PDIxKQogCiAjZGVm
aW5lIE1JX0JBVENIX0JVRkZFUl9FTkQJKDB4QSA8PCAyMykKZGlmZiAtLWdpdCBhL2xpYi9pZ3Rf
ZHVtbXlsb2FkLmMgYi9saWIvaWd0X2R1bW15bG9hZC5jCmluZGV4IGMwNzliZDA0Li5hODhjODU4
MiAxMDA2NDQKLS0tIGEvbGliL2lndF9kdW1teWxvYWQuYworKysgYi9saWIvaWd0X2R1bW15bG9h
ZC5jCkBAIC0xMzAsNyArMTMwLDE1IEBAIGVtaXRfcmVjdXJzaXZlX2JhdGNoKGlndF9zcGluX3Qg
KnNwaW4sCiAJc3Bpbi0+cG9sbF9oYW5kbGUgPSBwb2xsLT5oYW5kbGU7CiAJZXhlY2J1Zi0+YnVm
ZmVyX2NvdW50Kys7CiAKLQlpZiAob3B0cy0+ZmxhZ3MgJiBJR1RfU1BJTl9QT0xMX1JVTikgewor
CS8qCisJICogRm9yIGdlbjkrIHdlIHVzZSBhIGNvbmRpdGlvbmFsIGxvb3AgcmF0aGVyIHRoYW4g
YW4KKwkgKiBpbmZpbml0ZSBsb29wLCBiZWNhdXNlIHdlIGFyZSB1bmFibGUgdG8gbW9kaWZ5IHRo
ZQorCSAqIEJCJ3Mgb25jZSB0aGV5IGhhdmUgYmVlbiBzY2FubmVkIGJ5IHRoZSBjbWRwYXJzZXIK
KwkgKiBXZSBzaGFyZSB0aGUgcG9sbCBidWZmZXIgZm9yIHRoZSBjb25kaXRpb25hbCB0ZXN0CisJ
ICogYW5kIGlzIGFsd2F5cyB0aGUgZmlyc3QgYnVmZmVyIGluIHRoZSBiYXRjaCBsaXN0CisJICov
CisKKwlpZiAoZ2VuID49IDkgfHwgKG9wdHMtPmZsYWdzICYgSUdUX1NQSU5fUE9MTF9SVU4pKSB7
CiAJCXIgPSAmcmVsb2NzW2JhdGNoLT5yZWxvY2F0aW9uX2NvdW50KytdOwogCiAJCWlmIChnZW4g
PT0gNCB8fCBnZW4gPT0gNSkgewpAQCAtMTUwLDYgKzE1OCwxMyBAQCBlbWl0X3JlY3Vyc2l2ZV9i
YXRjaChpZ3Rfc3Bpbl90ICpzcGluLAogCiAJCWlndF9hc3NlcnRfZXEoc3Bpbi0+cG9sbFtTUElO
X1BPTExfU1RBUlRfSURYXSwgMCk7CiAKKwkJLyoKKwkJICogMm5kIHdvcmQgdXNlZCB0byBjb250
cm9sIGNvbmRpdGlvbmFsIGVuZCwgYW5kIGlzIGNsZWFyZWQKKwkJICogdG8gdGVybWluYXRlIGJh
dGNoLiBNdXN0IGJlID49MSB0byBzcGluCisJCSAqLworCQlzcGluLT5wb2xsW1NQSU5fUE9MTF9F
TkRfSURYXSA9IDE7CisJCV9fc3luY19zeW5jaHJvbml6ZSgpOworCiAJCS8qIGJhdGNoIGlzIGZp
cnN0ICovCiAJCXItPnByZXN1bWVkX29mZnNldCA9IEJBVENIX1NJWkU7CiAJCXItPnRhcmdldF9o
YW5kbGUgPSBwb2xsLT5oYW5kbGU7CkBAIC0yMDgsNyArMjIzLDI2IEBAIGVtaXRfcmVjdXJzaXZl
X2JhdGNoKGlndF9zcGluX3QgKnNwaW4sCiAJICogdHJvdWJsZS4gU2VlIGh0dHBzOi8vYnVncy5m
cmVlZGVza3RvcC5vcmcvc2hvd19idWcuY2dpP2lkPTEwMjI2MgogCSAqLwogCWlmICghKG9wdHMt
PmZsYWdzICYgSUdUX1NQSU5fRkFTVCkpCi0JCWNzICs9IDEwMDA7CisJCWNzICs9IDk2MDsKKwor
CWlndF9hc3NlcnRfZXEoc3Bpbi0+dXNpbmdfY29uZF9lbmQsIDApOworCWlmIChnZW4gPj0gOSkg
eworCQlyID0gJnJlbG9jc1tiYXRjaC0+cmVsb2NhdGlvbl9jb3VudCsrXTsKKworCQkvKiBiYXRj
aCBpcyBmaXJzdCwgc28gcG9sbCBpcyBzZWNvbmQgKi8KKwkJci0+cHJlc3VtZWRfb2Zmc2V0ID0g
QkFUQ0hfU0laRTsKKwkJci0+dGFyZ2V0X2hhbmRsZSA9IHBvbGwtPmhhbmRsZTsKKwkJci0+b2Zm
c2V0ID0gKGNzICsgMiAtIGJhdGNoX3N0YXJ0KSAqIHNpemVvZigqY3MpOworCQlyLT5yZWFkX2Rv
bWFpbnMgPSBJOTE1X0dFTV9ET01BSU5fQ09NTUFORDsKKwkJci0+ZGVsdGEgPSBTUElOX1BPTExf
RU5EX0lEWCAqIHNpemVvZigqY3MpOworCisJCSpjcysrID0gTUlfQ09ORF9CQVRDSF9CVUZGRVJf
RU5EIHwgMSA8PCAyMSB8IDI7CisJCSpjcysrID0gMDsgLyogUmVmZXJlbmNlIHZhbHVlICovCisJ
CSpjcysrID0gci0+cHJlc3VtZWRfb2Zmc2V0ICsgci0+ZGVsdGE7CisJCSpjcysrID0gMDsKKwor
CQlzcGluLT51c2luZ19jb25kX2VuZCA9IDE7CisJfQogCiAJLyogcmVjdXJzZSAqLwogCXIgPSAm
cmVsb2NzW2JhdGNoLT5yZWxvY2F0aW9uX2NvdW50KytdOwpAQCAtNDAxLDYgKzQzNSw5IEBAIHZv
aWQgaWd0X3NwaW5fc2V0X3RpbWVvdXQoaWd0X3NwaW5fdCAqc3BpbiwgaW50NjRfdCBucykKICAq
Lwogdm9pZCBpZ3Rfc3Bpbl9yZXNldChpZ3Rfc3Bpbl90ICpzcGluKQogeworCWlmIChzcGluLT51
c2luZ19jb25kX2VuZCkKKwkJc3Bpbi0+cG9sbFtTUElOX1BPTExfRU5EX0lEWF0gPSAxOworCiAJ
aWYgKGlndF9zcGluX2hhc19wb2xsKHNwaW4pKQogCQlzcGluLT5wb2xsW1NQSU5fUE9MTF9TVEFS
VF9JRFhdID0gMDsKIApAQCAtNDE5LDcgKzQ1NiwxMiBAQCB2b2lkIGlndF9zcGluX2VuZChpZ3Rf
c3Bpbl90ICpzcGluKQogCWlmICghc3BpbikKIAkJcmV0dXJuOwogCisJaWYgKHNwaW4tPnVzaW5n
X2NvbmRfZW5kKSB7CisJCXNwaW4tPnBvbGxbU1BJTl9QT0xMX0VORF9JRFhdID0gMDsKKwl9IGVs
c2UgewogCQkqc3Bpbi0+Y29uZGl0aW9uID0gTUlfQkFUQ0hfQlVGRkVSX0VORDsKKwl9CisKIAlf
X3N5bmNfc3luY2hyb25pemUoKTsKIH0KIApkaWZmIC0tZ2l0IGEvbGliL2lndF9kdW1teWxvYWQu
aCBiL2xpYi9pZ3RfZHVtbXlsb2FkLmgKaW5kZXggZGU1NzgxZDcuLmU5MzEwYjRlIDEwMDY0NAot
LS0gYS9saWIvaWd0X2R1bW15bG9hZC5oCisrKyBiL2xpYi9pZ3RfZHVtbXlsb2FkLmgKQEAgLTUx
LDYgKzUxLDkgQEAgdHlwZWRlZiBzdHJ1Y3QgaWd0X3NwaW4gewogCXVpbnQzMl90IHBvbGxfaGFu
ZGxlOwogCXVpbnQzMl90ICpwb2xsOwogI2RlZmluZSBTUElOX1BPTExfU1RBUlRfSURYIDAKKyNk
ZWZpbmUgU1BJTl9QT0xMX0VORF9JRFggMQorCisJYm9vbCB1c2luZ19jb25kX2VuZDsKIH0gaWd0
X3NwaW5fdDsKIAogc3RydWN0IGlndF9zcGluX2ZhY3RvcnkgewpkaWZmIC0tZ2l0IGEvbGliL2lu
dGVsX3JlZy5oIGIvbGliL2ludGVsX3JlZy5oCmluZGV4IDA2OTQ0MGNiLi4xMGNhNzYwYSAxMDA2
NDQKLS0tIGEvbGliL2ludGVsX3JlZy5oCisrKyBiL2xpYi9pbnRlbF9yZWcuaApAQCAtMjU5Myw2
ICsyNTkzLDkgQEAgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUg
U09GVFdBUkUuCiAjZGVmaW5lIE1JX0JBVENIX0JVRkZFUgkJKCgweDMwIDw8IDIzKSB8IDEpCiAj
ZGVmaW5lIE1JX0JBVENIX0JVRkZFUl9TVEFSVAkoMHgzMSA8PCAyMykKICNkZWZpbmUgTUlfQkFU
Q0hfQlVGRkVSX0VORAkoMHhBIDw8IDIzKQorI2RlZmluZSBNSV9DT05EX0JBVENIX0JVRkZFUl9F
TkQJKDB4MzYgPDwgMjMpCisjZGVmaW5lIE1JX0RPX0NPTVBBUkUgICAgICAgICAgICAgICAgICAg
KDE8PDIxKQorCiAjZGVmaW5lIE1JX0JBVENIX05PTl9TRUNVUkUJCSgxKQogI2RlZmluZSBNSV9C
QVRDSF9OT05fU0VDVVJFX0k5NjUJKDEgPDwgOCkKICNkZWZpbmUgTUlfQkFUQ0hfTk9OX1NFQ1VS
RV9IU1cJCSgxPDwxMykgLyogQWRkaXRpb25hbCBiaXQgZm9yIFJDUyAqLwpkaWZmIC0tZ2l0IGEv
dGVzdHMvaTkxNS9nZW1fZG91YmxlX2lycV9sb29wLmMgYi90ZXN0cy9pOTE1L2dlbV9kb3VibGVf
aXJxX2xvb3AuYwppbmRleCBiMzI2ZmM1OC4uZjE3ZjYxYzEgMTAwNjQ0Ci0tLSBhL3Rlc3RzL2k5
MTUvZ2VtX2RvdWJsZV9pcnFfbG9vcC5jCisrKyBiL3Rlc3RzL2k5MTUvZ2VtX2RvdWJsZV9pcnFf
bG9vcC5jCkBAIC01Miw4ICs1Miw2IEBAIHN0YXRpYyBkcm1faW50ZWxfYm8gKnRhcmdldF9idWZm
ZXIsICpibHRfYm87CiBJR1RfVEVTVF9ERVNDUklQVElPTigiQmFzaWMgY2hlY2sgZm9yIG1pc3Nl
ZCBJUlFzIG9uIGJsdCByaW5nLiIpOwogCiAKLSNkZWZpbmUgTUlfQ09ORF9CQVRDSF9CVUZGRVJf
RU5ECSgweDM2PDwyMyB8IDEpCi0jZGVmaW5lIE1JX0RPX0NPTVBBUkUJCQkoMTw8MjEpCiBzdGF0
aWMgdm9pZAogZHVtbXlfcmVsb2NfbG9vcCh2b2lkKQogewpkaWZmIC0tZ2l0IGEvdGVzdHMvaTkx
NS9nZW1fd3JpdGVfcmVhZF9yaW5nX3N3aXRjaC5jIGIvdGVzdHMvaTkxNS9nZW1fd3JpdGVfcmVh
ZF9yaW5nX3N3aXRjaC5jCmluZGV4IGVmMjI5Y2M1Li4wOTVjMTNjMyAxMDA2NDQKLS0tIGEvdGVz
dHMvaTkxNS9nZW1fd3JpdGVfcmVhZF9yaW5nX3N3aXRjaC5jCisrKyBiL3Rlc3RzL2k5MTUvZ2Vt
X3dyaXRlX3JlYWRfcmluZ19zd2l0Y2guYwpAQCAtMTE1LDcgKzExNSw3IEBAIHN0YXRpYyB2b2lk
IHJ1bl90ZXN0KGludCByaW5nKQogCSAqIG90aGVyd2lzZSB0aGUgb2JqLT5sYXN0X3dyaXRlX3Nl
cW5vIHdpbGwgYmUgdXBkYXRlZC4gKi8KIAlpZiAocmluZyA9PSBJOTE1X0VYRUNfUkVOREVSKSB7
CiAJCUJFR0lOX0JBVENIKDQsIDEpOwotCQlPVVRfQkFUQ0goTUlfQ09ORF9CQVRDSF9CVUZGRVJf
RU5EIHwgTUlfRE9fQ09NUEFSRSk7CisJCU9VVF9CQVRDSChNSV9DT05EX0JBVENIX0JVRkZFUl9F
TkQgfCBNSV9ET19DT01QQVJFIHwgMSk7CiAJCU9VVF9CQVRDSCgweGZmZmZmZmZmKTsgLyogY29t
cGFyZSBkd29yZCAqLwogCQlPVVRfUkVMT0ModGFyZ2V0X2JvLCBJOTE1X0dFTV9ET01BSU5fUkVO
REVSLCAwLCAwKTsKIAkJT1VUX0JBVENIKE1JX05PT1ApOwotLSAKMi4xNy4xCgpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBs
aXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

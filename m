Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4564885C65
	for <lists+intel-gfx@lfdr.de>; Thu,  8 Aug 2019 10:03:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4C5D76E7EF;
	Thu,  8 Aug 2019 08:03:19 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 11A486E7EC
 for <intel-gfx@lists.freedesktop.org>; Thu,  8 Aug 2019 08:03:14 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17926051-1500050 
 for multiple; Thu, 08 Aug 2019 08:42:10 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  8 Aug 2019 08:41:56 +0100
Message-Id: <20190808074207.18274-8-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190808074207.18274-1-chris@chris-wilson.co.uk>
References: <20190808074207.18274-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 08/19] drm/i915: Lift timeline into intel_context
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TW92ZSB0aGUgdGltZWxpbmUgZnJvbSBiZWluZyBpbnNpZGUgdGhlIGludGVsX3JpbmcgdG8gaW50
ZWxfY29udGV4dAppdHNlbGYuIFRoaXMgc2F2ZXMgbXVjaCBwb2ludGVyIGRhbmNpbmcgYW5kIG1h
a2VzIHRoZSByZWxhdGlvbnMgb2YgdGhlCmNvbnRleHQgdG8gaXRzIHRpbWVsaW5lIG11Y2ggY2xl
YXJlci4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNv
LnVrPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgICB8
IDM1ICsrKysrKysrLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVy
LmMgICAgfCAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jICAg
ICAgIHwgMjEgKysrKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5o
ICAgICAgIHwgIDggKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0X3R5
cGVzLmggfCAgMSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmUuaCAgICAg
ICAgfCAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMgICAg
IHwgIDEgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmggIHwg
IDggKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyAgICAgICAgICAgfCAz
MyArKysrLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMg
ICAgfCA2MyArKysrKysrKystLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9tb2Nr
X2VuZ2luZS5jICAgICAgICAgfCA2MiArKysrKysrLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYyAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2FjdGl2ZS5jICAgICAgICAgICAgfCAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9yZXF1ZXN0LmMgICAgICAgICAgIHwgMTAgKy0tCiAuLi4vZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5jICAgfCAxOSArKystLS0KIDE1IGZpbGVzIGNoYW5nZWQs
IDE0MCBpbnNlcnRpb25zKCspLCAxMzUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXggNjU4NjA0ZjQ0NjIwLi5lODY4Y2FhZmMy
MjkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwpAQCAt
NDg5LDYgKzQ4OSwyOSBAQCBzdGF0aWMgdm9pZCBfX2Fzc2lnbl9wcGd0dChzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqY3R4LAogCQlpOTE1X3ZtX3B1dCh2bSk7CiB9CiAKK3N0YXRpYyB2b2lkIF9f
c2V0X3RpbWVsaW5lKHN0cnVjdCBpbnRlbF90aW1lbGluZSAqKmRzdCwKKwkJCSAgIHN0cnVjdCBp
bnRlbF90aW1lbGluZSAqc3JjKQoreworCXN0cnVjdCBpbnRlbF90aW1lbGluZSAqb2xkID0gKmRz
dDsKKworCSpkc3QgPSBzcmMgPyBpbnRlbF90aW1lbGluZV9nZXQoc3JjKSA6IE5VTEw7CisKKwlp
ZiAob2xkKQorCQlpbnRlbF90aW1lbGluZV9wdXQob2xkKTsKK30KKworc3RhdGljIHZvaWQgX19h
cHBseV90aW1lbGluZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIHZvaWQgKnRpbWVsaW5lKQor
eworCV9fc2V0X3RpbWVsaW5lKCZjZS0+dGltZWxpbmUsIHRpbWVsaW5lKTsKK30KKworc3RhdGlj
IHZvaWQgX19hc3NpZ25fdGltZWxpbmUoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKKwkJ
CSAgICAgIHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGltZWxpbmUpCit7CisJX19zZXRfdGltZWxp
bmUoJmN0eC0+dGltZWxpbmUsIHRpbWVsaW5lKTsKKwljb250ZXh0X2FwcGx5X2FsbChjdHgsIF9f
YXBwbHlfdGltZWxpbmUsIHRpbWVsaW5lKTsKK30KKwogc3RhdGljIHN0cnVjdCBpOTE1X2dlbV9j
b250ZXh0ICoKIGk5MTVfZ2VtX2NyZWF0ZV9jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwgdW5zaWduZWQgaW50IGZsYWdzKQogewpAQCAtNTMxLDcgKzU1NCw4IEBAIGk5
MTVfZ2VtX2NyZWF0ZV9jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwg
dW5zaWduZWQgaW50IGZsYWdzKQogCQkJcmV0dXJuIEVSUl9DQVNUKHRpbWVsaW5lKTsKIAkJfQog
Ci0JCWN0eC0+dGltZWxpbmUgPSB0aW1lbGluZTsKKwkJX19hc3NpZ25fdGltZWxpbmUoY3R4LCB0
aW1lbGluZSk7CisJCWludGVsX3RpbWVsaW5lX3B1dCh0aW1lbGluZSk7CiAJfQogCiAJdHJhY2Vf
aTkxNV9jb250ZXh0X2NyZWF0ZShjdHgpOwpAQCAtMTk5MCwxMyArMjAxNCw4IEBAIHN0YXRpYyBp
bnQgY2xvbmVfc3NldShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqZHN0LAogc3RhdGljIGludCBj
bG9uZV90aW1lbGluZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqZHN0LAogCQkJICBzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqc3JjKQogewotCWlmIChzcmMtPnRpbWVsaW5lKSB7Ci0JCUdFTV9C
VUdfT04oc3JjLT50aW1lbGluZSA9PSBkc3QtPnRpbWVsaW5lKTsKLQotCQlpZiAoZHN0LT50aW1l
bGluZSkKLQkJCWludGVsX3RpbWVsaW5lX3B1dChkc3QtPnRpbWVsaW5lKTsKLQkJZHN0LT50aW1l
bGluZSA9IGludGVsX3RpbWVsaW5lX2dldChzcmMtPnRpbWVsaW5lKTsKLQl9CisJaWYgKHNyYy0+
dGltZWxpbmUpCisJCV9fYXNzaWduX3RpbWVsaW5lKGRzdCwgc3JjLT50aW1lbGluZSk7CiAKIAly
ZXR1cm4gMDsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9leGVjYnVmZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1
ZmZlci5jCmluZGV4IDU2NmU4YTQ4NDRjZi4uMDM5Nzg4NjZmNjMyIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKQEAgLTIxNzYsNyArMjE3Niw3
IEBAIHN0YXRpYyBpbnQgZWJfcGluX2NvbnRleHQoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIs
IHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIHN0YXRpYyB2b2lkIGViX3VucGluX2NvbnRleHQo
c3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIpCiB7CiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNl
ID0gZWItPmNvbnRleHQ7Ci0Jc3RydWN0IGludGVsX3RpbWVsaW5lICp0bCA9IGNlLT5yaW5nLT50
aW1lbGluZTsKKwlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsID0gY2UtPnRpbWVsaW5lOwogCiAJ
bXV0ZXhfbG9jaygmdGwtPm11dGV4KTsKIAlpbnRlbF9jb250ZXh0X2V4aXQoY2UpOwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCmluZGV4IDZkMWQ0ZThkYmZjOS4uNzc4MzNm
MTU1OGE5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCkBAIC02OCw3
ICs2OCw3IEBAIGludCBfX2ludGVsX2NvbnRleHRfZG9fcGluKHN0cnVjdCBpbnRlbF9jb250ZXh0
ICpjZSkKIAkJCWdvdG8gZXJyOwogCiAJCUdFTV9UUkFDRSgiJXMgY29udGV4dDolbGx4IHBpbiBy
aW5nOntoZWFkOiUwNHgsIHRhaWw6JTA0eH1cbiIsCi0JCQkgIGNlLT5lbmdpbmUtPm5hbWUsIGNl
LT5yaW5nLT50aW1lbGluZS0+ZmVuY2VfY29udGV4dCwKKwkJCSAgY2UtPmVuZ2luZS0+bmFtZSwg
Y2UtPnRpbWVsaW5lLT5mZW5jZV9jb250ZXh0LAogCQkJICBjZS0+cmluZy0+aGVhZCwgY2UtPnJp
bmctPnRhaWwpOwogCiAJCWk5MTVfZ2VtX2NvbnRleHRfZ2V0KGNlLT5nZW1fY29udGV4dCk7IC8q
IGZvciBjdHgtPnBwZ3R0ICovCkBAIC05OCw3ICs5OCw3IEBAIHZvaWQgaW50ZWxfY29udGV4dF91
bnBpbihzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAKIAlpZiAobGlrZWx5KGF0b21pY19kZWNf
YW5kX3Rlc3QoJmNlLT5waW5fY291bnQpKSkgewogCQlHRU1fVFJBQ0UoIiVzIGNvbnRleHQ6JWxs
eCByZXRpcmVcbiIsCi0JCQkgIGNlLT5lbmdpbmUtPm5hbWUsIGNlLT5yaW5nLT50aW1lbGluZS0+
ZmVuY2VfY29udGV4dCk7CisJCQkgIGNlLT5lbmdpbmUtPm5hbWUsIGNlLT50aW1lbGluZS0+ZmVu
Y2VfY29udGV4dCk7CiAKIAkJY2UtPm9wcy0+dW5waW4oY2UpOwogCkBAIC0xNDMsMTEgKzE0Mywx
MiBAQCBzdGF0aWMgdm9pZCBfX2ludGVsX2NvbnRleHRfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2
ZSAqYWN0aXZlKQogCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSA9IGNvbnRhaW5lcl9vZihhY3Rp
dmUsIHR5cGVvZigqY2UpLCBhY3RpdmUpOwogCiAJR0VNX1RSQUNFKCIlcyBjb250ZXh0OiVsbHgg
cmV0aXJlXG4iLAotCQkgIGNlLT5lbmdpbmUtPm5hbWUsIGNlLT5yaW5nLT50aW1lbGluZS0+ZmVu
Y2VfY29udGV4dCk7CisJCSAgY2UtPmVuZ2luZS0+bmFtZSwgY2UtPnRpbWVsaW5lLT5mZW5jZV9j
b250ZXh0KTsKIAogCWlmIChjZS0+c3RhdGUpCiAJCV9fY29udGV4dF91bnBpbl9zdGF0ZShjZS0+
c3RhdGUpOwogCisJaW50ZWxfdGltZWxpbmVfdW5waW4oY2UtPnRpbWVsaW5lKTsKIAlpbnRlbF9y
aW5nX3VucGluKGNlLT5yaW5nKTsKIAlpbnRlbF9jb250ZXh0X3B1dChjZSk7CiB9CkBAIC0xNjMs
MTUgKzE2NCwyMSBAQCBzdGF0aWMgaW50IF9faW50ZWxfY29udGV4dF9hY3RpdmUoc3RydWN0IGk5
MTVfYWN0aXZlICphY3RpdmUpCiAJaWYgKGVycikKIAkJZ290byBlcnJfcHV0OwogCisJZXJyID0g
aW50ZWxfdGltZWxpbmVfcGluKGNlLT50aW1lbGluZSk7CisJaWYgKGVycikKKwkJZ290byBlcnJf
cmluZzsKKwogCWlmICghY2UtPnN0YXRlKQogCQlyZXR1cm4gMDsKIAogCWVyciA9IF9fY29udGV4
dF9waW5fc3RhdGUoY2UtPnN0YXRlKTsKIAlpZiAoZXJyKQotCQlnb3RvIGVycl9yaW5nOworCQln
b3RvIGVycl90aW1lbGluZTsKIAogCXJldHVybiAwOwogCitlcnJfdGltZWxpbmU6CisJaW50ZWxf
dGltZWxpbmVfdW5waW4oY2UtPnRpbWVsaW5lKTsKIGVycl9yaW5nOgogCWludGVsX3JpbmdfdW5w
aW4oY2UtPnJpbmcpOwogZXJyX3B1dDoKQEAgLTIxOCw2ICsyMjUsOCBAQCBpbnRlbF9jb250ZXh0
X2luaXQoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCiAJY2UtPmdlbV9jb250ZXh0ID0gY3R4
OwogCWNlLT52bSA9IGk5MTVfdm1fZ2V0KGN0eC0+dm0gPzogJmVuZ2luZS0+Z3QtPmdndHQtPnZt
KTsKKwlpZiAoY3R4LT50aW1lbGluZSkKKwkJY2UtPnRpbWVsaW5lID0gaW50ZWxfdGltZWxpbmVf
Z2V0KGN0eC0+dGltZWxpbmUpOwogCiAJY2UtPmVuZ2luZSA9IGVuZ2luZTsKIAljZS0+b3BzID0g
ZW5naW5lLT5jb3BzOwpAQCAtMjM1LDYgKzI0NCw4IEBAIGludGVsX2NvbnRleHRfaW5pdChzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAKIHZvaWQgaW50ZWxfY29udGV4dF9maW5pKHN0cnVjdCBp
bnRlbF9jb250ZXh0ICpjZSkKIHsKKwlpZiAoY2UtPnRpbWVsaW5lKQorCQlpbnRlbF90aW1lbGlu
ZV9wdXQoY2UtPnRpbWVsaW5lKTsKIAlpOTE1X3ZtX3B1dChjZS0+dm0pOwogCiAJbXV0ZXhfZGVz
dHJveSgmY2UtPnBpbl9tdXRleCk7CkBAIC0yNzksNyArMjkwLDcgQEAgdm9pZCBpbnRlbF9jb250
ZXh0X2V4aXRfZW5naW5lKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIGludCBpbnRlbF9jb250
ZXh0X3ByZXBhcmVfcmVtb3RlX3JlcXVlc3Qoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCQkJ
CQkgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7Ci0Jc3RydWN0IGludGVsX3RpbWVsaW5lICp0
bCA9IGNlLT5yaW5nLT50aW1lbGluZTsKKwlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsID0gY2Ut
PnRpbWVsaW5lOwogCWludCBlcnI7CiAKIAkvKiBPbmx5IHN1aXRhYmxlIGZvciB1c2UgaW4gcmVt
b3RlbHkgbW9kaWZ5aW5nIHRoaXMgY29udGV4dCAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfY29udGV4dC5oCmluZGV4IDEzZjI4ZGQzMTZiYy4uOWZhOGI1ODhmMThlIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmgKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5oCkBAIC0xMjAsMTUgKzEyMCwxNSBAQCBzdGF0
aWMgaW5saW5lIHZvaWQgaW50ZWxfY29udGV4dF9wdXQoc3RydWN0IGludGVsX2NvbnRleHQgKmNl
KQogCiBzdGF0aWMgaW5saW5lIGludCBfX211c3RfY2hlY2sKIGludGVsX2NvbnRleHRfdGltZWxp
bmVfbG9jayhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCi0JX19hY3F1aXJlcygmY2UtPnJpbmct
PnRpbWVsaW5lLT5tdXRleCkKKwlfX2FjcXVpcmVzKCZjZS0+dGltZWxpbmUtPm11dGV4KQogewot
CXJldHVybiBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmNlLT5yaW5nLT50aW1lbGluZS0+bXV0
ZXgpOworCXJldHVybiBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmNlLT50aW1lbGluZS0+bXV0
ZXgpOwogfQogCiBzdGF0aWMgaW5saW5lIHZvaWQgaW50ZWxfY29udGV4dF90aW1lbGluZV91bmxv
Y2soc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQotCV9fcmVsZWFzZXMoJmNlLT5yaW5nLT50aW1l
bGluZS0+bXV0ZXgpCisJX19yZWxlYXNlcygmY2UtPnRpbWVsaW5lLT5tdXRleCkKIHsKLQltdXRl
eF91bmxvY2soJmNlLT5yaW5nLT50aW1lbGluZS0+bXV0ZXgpOworCW11dGV4X3VubG9jaygmY2Ut
PnRpbWVsaW5lLT5tdXRleCk7CiB9CiAKIGludCBpbnRlbF9jb250ZXh0X3ByZXBhcmVfcmVtb3Rl
X3JlcXVlc3Qoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dF90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfY29udGV4dF90eXBlcy5oCmluZGV4IGNmZjYyMzhjMjEzYS4uYTYzMmIyMGVj
NGQ4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0X3R5
cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dF90eXBlcy5o
CkBAIC01Myw2ICs1Myw3IEBAIHN0cnVjdCBpbnRlbF9jb250ZXh0IHsKIAogCXN0cnVjdCBpOTE1
X3ZtYSAqc3RhdGU7CiAJc3RydWN0IGludGVsX3JpbmcgKnJpbmc7CisJc3RydWN0IGludGVsX3Rp
bWVsaW5lICp0aW1lbGluZTsKIAogCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAjZGVmaW5lIENPTlRF
WFRfQUxMT0NfQklUIDAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2VuZ2luZS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lLmgKaW5kZXgg
MzdjMzkxY2VlNDQxLi5lMTIyOGIwZTU3N2YgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2VuZ2luZS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2VuZ2luZS5oCkBAIC0xOTYsOSArMTk2LDcgQEAgaW50ZWxfd3JpdGVfc3RhdHVzX3BhZ2Uoc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBpbnQgcmVnLCB1MzIgdmFsdWUpCiAjZGVmaW5l
IENOTF9IV1NfQ1NCX1dSSVRFX0lOREVYCQkweDJmCiAKIHN0cnVjdCBpbnRlbF9yaW5nICoKLWlu
dGVsX2VuZ2luZV9jcmVhdGVfcmluZyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCi0J
CQkgc3RydWN0IGludGVsX3RpbWVsaW5lICp0aW1lbGluZSwKLQkJCSBpbnQgc2l6ZSk7CitpbnRl
bF9lbmdpbmVfY3JlYXRlX3Jpbmcoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBpbnQg
c2l6ZSk7CiBpbnQgaW50ZWxfcmluZ19waW4oc3RydWN0IGludGVsX3JpbmcgKnJpbmcpOwogdm9p
ZCBpbnRlbF9yaW5nX3Jlc2V0KHN0cnVjdCBpbnRlbF9yaW5nICpyaW5nLCB1MzIgdGFpbCk7CiB1
bnNpZ25lZCBpbnQgaW50ZWxfcmluZ191cGRhdGVfc3BhY2Uoc3RydWN0IGludGVsX3JpbmcgKnJp
bmcpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2Nz
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYwppbmRleCAyMmU4
OTQzY2YxNjEuLmQ0NmJjYzMzZTg0YyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZW5naW5lX2NzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
ZW5naW5lX2NzLmMKQEAgLTY4MCw3ICs2ODAsNiBAQCBzdGF0aWMgaW50IG1lYXN1cmVfYnJlYWRj
cnVtYl9kdyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJCWdvdG8gb3V0X2ZyYW1l
OwogCiAJSU5JVF9MSVNUX0hFQUQoJmZyYW1lLT5yaW5nLnJlcXVlc3RfbGlzdCk7Ci0JZnJhbWUt
PnJpbmcudGltZWxpbmUgPSAmZnJhbWUtPnRpbWVsaW5lOwogCWZyYW1lLT5yaW5nLnZhZGRyID0g
ZnJhbWUtPmNzOwogCWZyYW1lLT5yaW5nLnNpemUgPSBzaXplb2YoZnJhbWUtPmNzKTsKIAlmcmFt
ZS0+cmluZy5lZmZlY3RpdmVfc2l6ZSA9IGZyYW1lLT5yaW5nLnNpemU7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5oCmluZGV4IGRhY2FhNzA3Yzc5Ny4uZWJh
MzExMTAzOGE5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdp
bmVfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlw
ZXMuaApAQCAtNjksNyArNjksNiBAQCBzdHJ1Y3QgaW50ZWxfcmluZyB7CiAJc3RydWN0IGk5MTVf
dm1hICp2bWE7CiAJdm9pZCAqdmFkZHI7CiAKLQlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRpbWVs
aW5lOwogCXN0cnVjdCBsaXN0X2hlYWQgcmVxdWVzdF9saXN0OwogCXN0cnVjdCBsaXN0X2hlYWQg
YWN0aXZlX2xpbms7CiAKQEAgLTI4Myw4ICsyODIsNiBAQCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
IHsKIAogCXN0cnVjdCBpbnRlbF9zc2V1IHNzZXU7CiAKLQlzdHJ1Y3QgaW50ZWxfcmluZyAqYnVm
ZmVyOwotCiAJc3RydWN0IHsKIAkJc3BpbmxvY2tfdCBsb2NrOwogCQlzdHJ1Y3QgbGlzdF9oZWFk
IHJlcXVlc3RzOwpAQCAtMzAzLDYgKzMwMCwxMSBAQCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzIHsK
IAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqZGVmYXVsdF9zdGF0ZTsKIAl2b2lkICpwaW5u
ZWRfZGVmYXVsdF9zdGF0ZTsKIAorCXN0cnVjdCB7CisJCXN0cnVjdCBpbnRlbF9yaW5nICpyaW5n
OworCQlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRpbWVsaW5lOworCX0gbGVnYWN5OworCiAJLyog
UmF0aGVyIHRoYW4gaGF2ZSBldmVyeSBjbGllbnQgd2FpdCB1cG9uIGFsbCB1c2VyIGludGVycnVw
dHMsCiAJICogd2l0aCB0aGUgaGVyZCB3YWtpbmcgYWZ0ZXIgZXZlcnkgaW50ZXJydXB0IGFuZCBl
YWNoIGRvaW5nIHRoZQogCSAqIGhlYXZ5d2VpZ2h0IHNlcW5vIGRhbmNlLCB3ZSBkZWxlZ2F0ZSB0
aGUgdGFzayAob2YgYmVpbmcgdGhlCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCmluZGV4
IDZhMzAxNTE3NjcxNC4uYjRmOTNhNjVhMjQ5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9s
cmMuYwpAQCAtMjgyMCw5ICsyODIwLDYgQEAgbG9naWNhbF9yaW5nX2RlZmF1bHRfaXJxcyhzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAKIGludCBpbnRlbF9leGVjbGlzdHNfc3VibWlz
c2lvbl9zZXR1cChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7Ci0JLyogSW50ZW50
aW9uYWxseSBsZWZ0IGJsYW5rLiAqLwotCWVuZ2luZS0+YnVmZmVyID0gTlVMTDsKLQogCXRhc2ts
ZXRfaW5pdCgmZW5naW5lLT5leGVjbGlzdHMudGFza2xldCwKIAkJICAgICBleGVjbGlzdHNfc3Vi
bWlzc2lvbl90YXNrbGV0LCAodW5zaWduZWQgbG9uZyllbmdpbmUpOwogCXRpbWVyX3NldHVwKCZl
bmdpbmUtPmV4ZWNsaXN0cy50aW1lciwgZXhlY2xpc3RzX3N1Ym1pc3Npb25fdGltZXIsIDApOwpA
QCAtMzA3MCwyMyArMzA2NywxMyBAQCBwb3B1bGF0ZV9scl9jb250ZXh0KHN0cnVjdCBpbnRlbF9j
b250ZXh0ICpjZSwKIAlyZXR1cm4gcmV0OwogfQogCi1zdGF0aWMgc3RydWN0IGludGVsX3RpbWVs
aW5lICoKLWdldF90aW1lbGluZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LCBzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0KQotewotCWlmIChjdHgtPnRpbWVsaW5lKQotCQlyZXR1cm4gaW50ZWxfdGlt
ZWxpbmVfZ2V0KGN0eC0+dGltZWxpbmUpOwotCWVsc2UKLQkJcmV0dXJuIGludGVsX3RpbWVsaW5l
X2NyZWF0ZShndCwgTlVMTCk7Ci19Ci0KIHN0YXRpYyBpbnQgX19leGVjbGlzdHNfY29udGV4dF9h
bGxvYyhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJCQkJICAgICBzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmUpCiB7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKmN0eF9vYmo7
CisJc3RydWN0IGludGVsX3JpbmcgKnJpbmc7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJdTMy
IGNvbnRleHRfc2l6ZTsKLQlzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZzsKLQlzdHJ1Y3QgaW50ZWxf
dGltZWxpbmUgKnRpbWVsaW5lOwogCWludCByZXQ7CiAKIAlpZiAoY2UtPnN0YXRlKQpAQCAtMzEx
MCwxNSArMzA5NywxOSBAQCBzdGF0aWMgaW50IF9fZXhlY2xpc3RzX2NvbnRleHRfYWxsb2Moc3Ry
dWN0IGludGVsX2NvbnRleHQgKmNlLAogCQlnb3RvIGVycm9yX2RlcmVmX29iajsKIAl9CiAKLQl0
aW1lbGluZSA9IGdldF90aW1lbGluZShjZS0+Z2VtX2NvbnRleHQsIGVuZ2luZS0+Z3QpOwotCWlm
IChJU19FUlIodGltZWxpbmUpKSB7Ci0JCXJldCA9IFBUUl9FUlIodGltZWxpbmUpOwotCQlnb3Rv
IGVycm9yX2RlcmVmX29iajsKKwlpZiAoIWNlLT50aW1lbGluZSkgeworCQlzdHJ1Y3QgaW50ZWxf
dGltZWxpbmUgKnRsOworCisJCXRsID0gaW50ZWxfdGltZWxpbmVfY3JlYXRlKGVuZ2luZS0+Z3Qs
IE5VTEwpOworCQlpZiAoSVNfRVJSKHRsKSkgeworCQkJcmV0ID0gUFRSX0VSUih0bCk7CisJCQln
b3RvIGVycm9yX2RlcmVmX29iajsKKwkJfQorCisJCWNlLT50aW1lbGluZSA9IHRsOwogCX0KIAot
CXJpbmcgPSBpbnRlbF9lbmdpbmVfY3JlYXRlX3JpbmcoZW5naW5lLCB0aW1lbGluZSwKLQkJCQkJ
KHVuc2lnbmVkIGxvbmcpY2UtPnJpbmcpOwotCWludGVsX3RpbWVsaW5lX3B1dCh0aW1lbGluZSk7
CisJcmluZyA9IGludGVsX2VuZ2luZV9jcmVhdGVfcmluZyhlbmdpbmUsICh1bnNpZ25lZCBsb25n
KWNlLT5yaW5nKTsKIAlpZiAoSVNfRVJSKHJpbmcpKSB7CiAJCXJldCA9IFBUUl9FUlIocmluZyk7
CiAJCWdvdG8gZXJyb3JfZGVyZWZfb2JqOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
cmluZ2J1ZmZlci5jCmluZGV4IGJiNjlmNTFjY2JmYS4uZTRmYzQwYzNjNGQ5IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jCkBAIC02MzYsNyArNjM2LDcgQEAg
c3RhdGljIGJvb2wgc3RvcF9yaW5nKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHN0
YXRpYyBpbnQgeGNzX3Jlc3VtZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7CiAJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZW5naW5lLT5pOTE1OwotCXN0cnVj
dCBpbnRlbF9yaW5nICpyaW5nID0gZW5naW5lLT5idWZmZXI7CisJc3RydWN0IGludGVsX3Jpbmcg
KnJpbmcgPSBlbmdpbmUtPmxlZ2FjeS5yaW5nOwogCWludCByZXQgPSAwOwogCiAJR0VNX1RSQUNF
KCIlczogcmluZzp7SEVBRDolMDR4LCBUQUlMOiUwNHh9XG4iLApAQCAtODMyLDEyICs4MzIsMTIg
QEAgc3RhdGljIHZvaWQgcmVzZXRfcmluZyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUs
IGJvb2wgc3RhbGxlZCkKIAkJICovCiAJCV9faTkxNV9yZXF1ZXN0X3Jlc2V0KHJxLCBzdGFsbGVk
KTsKIAotCQlHRU1fQlVHX09OKHJxLT5yaW5nICE9IGVuZ2luZS0+YnVmZmVyKTsKKwkJR0VNX0JV
R19PTihycS0+cmluZyAhPSBlbmdpbmUtPmxlZ2FjeS5yaW5nKTsKIAkJaGVhZCA9IHJxLT5oZWFk
OwogCX0gZWxzZSB7Ci0JCWhlYWQgPSBlbmdpbmUtPmJ1ZmZlci0+dGFpbDsKKwkJaGVhZCA9IGVu
Z2luZS0+bGVnYWN5LnJpbmctPnRhaWw7CiAJfQotCWVuZ2luZS0+YnVmZmVyLT5oZWFkID0gaW50
ZWxfcmluZ193cmFwKGVuZ2luZS0+YnVmZmVyLCBoZWFkKTsKKwllbmdpbmUtPmxlZ2FjeS5yaW5n
LT5oZWFkID0gaW50ZWxfcmluZ193cmFwKGVuZ2luZS0+bGVnYWN5LnJpbmcsIGhlYWQpOwogCiAJ
c3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZW5naW5lLT5hY3RpdmUubG9jaywgZmxhZ3MpOwogfQpA
QCAtMTE5MiwxMCArMTE5Miw2IEBAIGludCBpbnRlbF9yaW5nX3BpbihzdHJ1Y3QgaW50ZWxfcmlu
ZyAqcmluZykKIAlpZiAoYXRvbWljX2ZldGNoX2luYygmcmluZy0+cGluX2NvdW50KSkKIAkJcmV0
dXJuIDA7CiAKLQlyZXQgPSBpbnRlbF90aW1lbGluZV9waW4ocmluZy0+dGltZWxpbmUpOwotCWlm
IChyZXQpCi0JCWdvdG8gZXJyX3VucGluOwotCiAJZmxhZ3MgPSBQSU5fR0xPQkFMOwogCiAJLyog
UmluZyB3cmFwYXJvdW5kIGF0IG9mZnNldCAwIHNvbWV0aW1lcyBoYW5ncy4gTm8gaWRlYSB3aHku
ICovCkBAIC0xMjA4LDcgKzEyMDQsNyBAQCBpbnQgaW50ZWxfcmluZ19waW4oc3RydWN0IGludGVs
X3JpbmcgKnJpbmcpCiAKIAlyZXQgPSBpOTE1X3ZtYV9waW4odm1hLCAwLCAwLCBmbGFncyk7CiAJ
aWYgKHVubGlrZWx5KHJldCkpCi0JCWdvdG8gZXJyX3RpbWVsaW5lOworCQlnb3RvIGVycl91bnBp
bjsKIAogCWlmIChpOTE1X3ZtYV9pc19tYXBfYW5kX2ZlbmNlYWJsZSh2bWEpKQogCQlhZGRyID0g
KHZvaWQgX19mb3JjZSAqKWk5MTVfdm1hX3Bpbl9pb21hcCh2bWEpOwpAQCAtMTIyNSwxMyArMTIy
MSwxMCBAQCBpbnQgaW50ZWxfcmluZ19waW4oc3RydWN0IGludGVsX3JpbmcgKnJpbmcpCiAJR0VN
X0JVR19PTihyaW5nLT52YWRkcik7CiAJcmluZy0+dmFkZHIgPSBhZGRyOwogCi0JR0VNX1RSQUNF
KCJyaW5nOiVsbHggcGluXG4iLCByaW5nLT50aW1lbGluZS0+ZmVuY2VfY29udGV4dCk7CiAJcmV0
dXJuIDA7CiAKIGVycl9yaW5nOgogCWk5MTVfdm1hX3VucGluKHZtYSk7Ci1lcnJfdGltZWxpbmU6
Ci0JaW50ZWxfdGltZWxpbmVfdW5waW4ocmluZy0+dGltZWxpbmUpOwogZXJyX3VucGluOgogCWF0
b21pY19kZWMoJnJpbmctPnBpbl9jb3VudCk7CiAJcmV0dXJuIHJldDsKQEAgLTEyNTQsOCArMTI0
Nyw2IEBAIHZvaWQgaW50ZWxfcmluZ191bnBpbihzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZykKIAlp
ZiAoIWF0b21pY19kZWNfYW5kX3Rlc3QoJnJpbmctPnBpbl9jb3VudCkpCiAJCXJldHVybjsKIAot
CUdFTV9UUkFDRSgicmluZzolbGx4IHVucGluXG4iLCByaW5nLT50aW1lbGluZS0+ZmVuY2VfY29u
dGV4dCk7Ci0KIAkvKiBEaXNjYXJkIGFueSB1bnVzZWQgYnl0ZXMgYmV5b25kIHRoYXQgc3VibWl0
dGVkIHRvIGh3LiAqLwogCWludGVsX3JpbmdfcmVzZXQocmluZywgcmluZy0+dGFpbCk7CiAKQEAg
LTEyNzAsOCArMTI2MSw2IEBAIHZvaWQgaW50ZWxfcmluZ191bnBpbihzdHJ1Y3QgaW50ZWxfcmlu
ZyAqcmluZykKIAogCWk5MTVfdm1hX3VucGluKHZtYSk7CiAJaTkxNV92bWFfbWFrZV9wdXJnZWFi
bGUodm1hKTsKLQotCWludGVsX3RpbWVsaW5lX3VucGluKHJpbmctPnRpbWVsaW5lKTsKIH0KIAog
c3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqY3JlYXRlX3Jpbmdfdm1hKHN0cnVjdCBpOTE1X2dndHQg
KmdndHQsIGludCBzaXplKQpAQCAtMTMwNiw5ICsxMjk1LDcgQEAgc3RhdGljIHN0cnVjdCBpOTE1
X3ZtYSAqY3JlYXRlX3Jpbmdfdm1hKHN0cnVjdCBpOTE1X2dndHQgKmdndHQsIGludCBzaXplKQog
fQogCiBzdHJ1Y3QgaW50ZWxfcmluZyAqCi1pbnRlbF9lbmdpbmVfY3JlYXRlX3Jpbmcoc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAotCQkJIHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGlt
ZWxpbmUsCi0JCQkgaW50IHNpemUpCitpbnRlbF9lbmdpbmVfY3JlYXRlX3Jpbmcoc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqZW5naW5lLCBpbnQgc2l6ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IGVuZ2luZS0+aTkxNTsKIAlzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZzsKQEAg
LTEzMjMsNyArMTMxMCw2IEBAIGludGVsX2VuZ2luZV9jcmVhdGVfcmluZyhzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmUsCiAKIAlrcmVmX2luaXQoJnJpbmctPnJlZik7CiAJSU5JVF9MSVNU
X0hFQUQoJnJpbmctPnJlcXVlc3RfbGlzdCk7Ci0JcmluZy0+dGltZWxpbmUgPSBpbnRlbF90aW1l
bGluZV9nZXQodGltZWxpbmUpOwogCiAJcmluZy0+c2l6ZSA9IHNpemU7CiAJLyogV29ya2Fyb3Vu
ZCBhbiBlcnJhdHVtIG9uIHRoZSBpODMwIHdoaWNoIGNhdXNlcyBhIGhhbmcgaWYKQEAgLTEzNTMs
NyArMTMzOSw2IEBAIHZvaWQgaW50ZWxfcmluZ19mcmVlKHN0cnVjdCBrcmVmICpyZWYpCiAJaTkx
NV92bWFfY2xvc2UocmluZy0+dm1hKTsKIAlpOTE1X3ZtYV9wdXQocmluZy0+dm1hKTsKIAotCWlu
dGVsX3RpbWVsaW5lX3B1dChyaW5nLT50aW1lbGluZSk7CiAJa2ZyZWUocmluZyk7CiB9CiAKQEAg
LTE0ODUsOCArMTQ3MCw5IEBAIHN0YXRpYyBpbnQgcmluZ19jb250ZXh0X2FsbG9jKHN0cnVjdCBp
bnRlbF9jb250ZXh0ICpjZSkKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUgPSBjZS0+
ZW5naW5lOwogCiAJLyogT25lIHJpbmdidWZmZXIgdG8gcnVsZSB0aGVtIGFsbCAqLwotCUdFTV9C
VUdfT04oIWVuZ2luZS0+YnVmZmVyKTsKLQljZS0+cmluZyA9IGVuZ2luZS0+YnVmZmVyOworCUdF
TV9CVUdfT04oIWVuZ2luZS0+bGVnYWN5LnJpbmcpOworCWNlLT5yaW5nID0gZW5naW5lLT5sZWdh
Y3kucmluZzsKKwljZS0+dGltZWxpbmUgPSBpbnRlbF90aW1lbGluZV9nZXQoZW5naW5lLT5sZWdh
Y3kudGltZWxpbmUpOwogCiAJaWYgKGVuZ2luZS0+Y29udGV4dF9zaXplKSB7CiAJCXN0cnVjdCBp
OTE1X3ZtYSAqdm1hOwpAQCAtMjE2NCw4ICsyMTUwLDExIEBAIHN0YXRpYyB2b2lkIHJpbmdfZGVz
dHJveShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAKIAlpbnRlbF9lbmdpbmVfY2xl
YW51cF9jb21tb24oZW5naW5lKTsKIAotCWludGVsX3JpbmdfdW5waW4oZW5naW5lLT5idWZmZXIp
OwotCWludGVsX3JpbmdfcHV0KGVuZ2luZS0+YnVmZmVyKTsKKwlpbnRlbF9yaW5nX3VucGluKGVu
Z2luZS0+bGVnYWN5LnJpbmcpOworCWludGVsX3JpbmdfcHV0KGVuZ2luZS0+bGVnYWN5LnJpbmcp
OworCisJaW50ZWxfdGltZWxpbmVfdW5waW4oZW5naW5lLT5sZWdhY3kudGltZWxpbmUpOworCWlu
dGVsX3RpbWVsaW5lX3B1dChlbmdpbmUtPmxlZ2FjeS50aW1lbGluZSk7CiAKIAlrZnJlZShlbmdp
bmUpOwogfQpAQCAtMjM0OSwzMiArMjMzOCw0MCBAQCBpbnQgaW50ZWxfcmluZ19zdWJtaXNzaW9u
X2luaXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCX0KIAlHRU1fQlVHX09OKHRp
bWVsaW5lLT5oYXNfaW5pdGlhbF9icmVhZGNydW1iKTsKIAotCXJpbmcgPSBpbnRlbF9lbmdpbmVf
Y3JlYXRlX3JpbmcoZW5naW5lLCB0aW1lbGluZSwgU1pfMTZLKTsKLQlpbnRlbF90aW1lbGluZV9w
dXQodGltZWxpbmUpOworCWVyciA9IGludGVsX3RpbWVsaW5lX3Bpbih0aW1lbGluZSk7CisJaWYg
KGVycikKKwkJZ290byBlcnJfdGltZWxpbmU7CisKKwlyaW5nID0gaW50ZWxfZW5naW5lX2NyZWF0
ZV9yaW5nKGVuZ2luZSwgU1pfMTZLKTsKIAlpZiAoSVNfRVJSKHJpbmcpKSB7CiAJCWVyciA9IFBU
Ul9FUlIocmluZyk7Ci0JCWdvdG8gZXJyOworCQlnb3RvIGVycl90aW1lbGluZV91bnBpbjsKIAl9
CiAKIAllcnIgPSBpbnRlbF9yaW5nX3BpbihyaW5nKTsKIAlpZiAoZXJyKQogCQlnb3RvIGVycl9y
aW5nOwogCi0JR0VNX0JVR19PTihlbmdpbmUtPmJ1ZmZlcik7Ci0JZW5naW5lLT5idWZmZXIgPSBy
aW5nOworCUdFTV9CVUdfT04oZW5naW5lLT5sZWdhY3kucmluZyk7CisJZW5naW5lLT5sZWdhY3ku
cmluZyA9IHJpbmc7CisJZW5naW5lLT5sZWdhY3kudGltZWxpbmUgPSB0aW1lbGluZTsKIAogCWVy
ciA9IGludGVsX2VuZ2luZV9pbml0X2NvbW1vbihlbmdpbmUpOwogCWlmIChlcnIpCi0JCWdvdG8g
ZXJyX3VucGluOworCQlnb3RvIGVycl9yaW5nX3VucGluOwogCi0JR0VNX0JVR19PTihyaW5nLT50
aW1lbGluZS0+aHdzcF9nZ3R0ICE9IGVuZ2luZS0+c3RhdHVzX3BhZ2Uudm1hKTsKKwlHRU1fQlVH
X09OKHRpbWVsaW5lLT5od3NwX2dndHQgIT0gZW5naW5lLT5zdGF0dXNfcGFnZS52bWEpOwogCiAJ
cmV0dXJuIDA7CiAKLWVycl91bnBpbjoKK2Vycl9yaW5nX3VucGluOgogCWludGVsX3JpbmdfdW5w
aW4ocmluZyk7CiBlcnJfcmluZzoKIAlpbnRlbF9yaW5nX3B1dChyaW5nKTsKK2Vycl90aW1lbGlu
ZV91bnBpbjoKKwlpbnRlbF90aW1lbGluZV91bnBpbih0aW1lbGluZSk7CitlcnJfdGltZWxpbmU6
CisJaW50ZWxfdGltZWxpbmVfcHV0KHRpbWVsaW5lKTsKIGVycjoKIAlpbnRlbF9lbmdpbmVfY2xl
YW51cF9jb21tb24oZW5naW5lKTsKIAlyZXR1cm4gZXJyOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvbW9ja19lbmdpbmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L21v
Y2tfZW5naW5lLmMKaW5kZXggM2FjYTg4NjA0ZDJkLi4wNjhiY2Y4N2VkOTIgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L21vY2tfZW5naW5lLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvbW9ja19lbmdpbmUuYwpAQCAtMzIsMTEgKzMyLDYgQEAKICNpbmNsdWRlICJt
b2NrX2VuZ2luZS5oIgogI2luY2x1ZGUgInNlbGZ0ZXN0cy9tb2NrX3JlcXVlc3QuaCIKIAotc3Ry
dWN0IG1vY2tfcmluZyB7Ci0Jc3RydWN0IGludGVsX3JpbmcgYmFzZTsKLQlzdHJ1Y3QgaW50ZWxf
dGltZWxpbmUgdGltZWxpbmU7Ci19OwotCiBzdGF0aWMgdm9pZCBtb2NrX3RpbWVsaW5lX3Bpbihz
dHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsKQogewogCXRsLT5waW5fY291bnQrKzsKQEAgLTUxLDM2
ICs0NiwyMiBAQCBzdGF0aWMgdm9pZCBtb2NrX3RpbWVsaW5lX3VucGluKHN0cnVjdCBpbnRlbF90
aW1lbGluZSAqdGwpCiBzdGF0aWMgc3RydWN0IGludGVsX3JpbmcgKm1vY2tfcmluZyhzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7CiAJY29uc3QgdW5zaWduZWQgbG9uZyBzeiA9IFBB
R0VfU0laRSAvIDI7Ci0Jc3RydWN0IG1vY2tfcmluZyAqcmluZzsKKwlzdHJ1Y3QgaW50ZWxfcmlu
ZyAqcmluZzsKIAogCXJpbmcgPSBremFsbG9jKHNpemVvZigqcmluZykgKyBzeiwgR0ZQX0tFUk5F
TCk7CiAJaWYgKCFyaW5nKQogCQlyZXR1cm4gTlVMTDsKIAotCWlmIChpbnRlbF90aW1lbGluZV9p
bml0KCZyaW5nLT50aW1lbGluZSwgZW5naW5lLT5ndCwgTlVMTCkpIHsKLQkJa2ZyZWUocmluZyk7
Ci0JCXJldHVybiBOVUxMOwotCX0KLQotCWtyZWZfaW5pdCgmcmluZy0+YmFzZS5yZWYpOwotCXJp
bmctPmJhc2Uuc2l6ZSA9IHN6OwotCXJpbmctPmJhc2UuZWZmZWN0aXZlX3NpemUgPSBzejsKLQly
aW5nLT5iYXNlLnZhZGRyID0gKHZvaWQgKikocmluZyArIDEpOwotCXJpbmctPmJhc2UudGltZWxp
bmUgPSAmcmluZy0+dGltZWxpbmU7Ci0JYXRvbWljX3NldCgmcmluZy0+YmFzZS5waW5fY291bnQs
IDEpOwotCi0JSU5JVF9MSVNUX0hFQUQoJnJpbmctPmJhc2UucmVxdWVzdF9saXN0KTsKLQlpbnRl
bF9yaW5nX3VwZGF0ZV9zcGFjZSgmcmluZy0+YmFzZSk7Ci0KLQlyZXR1cm4gJnJpbmctPmJhc2U7
Ci19CisJa3JlZl9pbml0KCZyaW5nLT5yZWYpOworCXJpbmctPnNpemUgPSBzejsKKwlyaW5nLT5l
ZmZlY3RpdmVfc2l6ZSA9IHN6OworCXJpbmctPnZhZGRyID0gKHZvaWQgKikocmluZyArIDEpOwor
CWF0b21pY19zZXQoJnJpbmctPnBpbl9jb3VudCwgMSk7CiAKLXN0YXRpYyB2b2lkIG1vY2tfcmlu
Z19mcmVlKHN0cnVjdCBpbnRlbF9yaW5nICpiYXNlKQotewotCXN0cnVjdCBtb2NrX3JpbmcgKnJp
bmcgPSBjb250YWluZXJfb2YoYmFzZSwgdHlwZW9mKCpyaW5nKSwgYmFzZSk7CisJSU5JVF9MSVNU
X0hFQUQoJnJpbmctPnJlcXVlc3RfbGlzdCk7CisJaW50ZWxfcmluZ191cGRhdGVfc3BhY2Uocmlu
Zyk7CiAKLQlpbnRlbF90aW1lbGluZV9maW5pKCZyaW5nLT50aW1lbGluZSk7Ci0Ja2ZyZWUocmlu
Zyk7CisJcmV0dXJuIHJpbmc7CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpmaXJz
dF9yZXF1ZXN0KHN0cnVjdCBtb2NrX2VuZ2luZSAqZW5naW5lKQpAQCAtMTMxLDcgKzExMiw2IEBA
IHN0YXRpYyB2b2lkIGh3X2RlbGF5X2NvbXBsZXRlKHN0cnVjdCB0aW1lcl9saXN0ICp0KQogCiBz
dGF0aWMgdm9pZCBtb2NrX2NvbnRleHRfdW5waW4oc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQog
ewotCW1vY2tfdGltZWxpbmVfdW5waW4oY2UtPnJpbmctPnRpbWVsaW5lKTsKIH0KIAogc3RhdGlj
IHZvaWQgbW9ja19jb250ZXh0X2Rlc3Ryb3koc3RydWN0IGtyZWYgKnJlZikKQEAgLTE0MCw4ICsx
MjAsMTAgQEAgc3RhdGljIHZvaWQgbW9ja19jb250ZXh0X2Rlc3Ryb3koc3RydWN0IGtyZWYgKnJl
ZikKIAogCUdFTV9CVUdfT04oaW50ZWxfY29udGV4dF9pc19waW5uZWQoY2UpKTsKIAotCWlmICh0
ZXN0X2JpdChDT05URVhUX0FMTE9DX0JJVCwgJmNlLT5mbGFncykpCi0JCW1vY2tfcmluZ19mcmVl
KGNlLT5yaW5nKTsKKwlpZiAodGVzdF9iaXQoQ09OVEVYVF9BTExPQ19CSVQsICZjZS0+ZmxhZ3Mp
KSB7CisJCWtmcmVlKGNlLT5yaW5nKTsKKwkJbW9ja190aW1lbGluZV91bnBpbihjZS0+dGltZWxp
bmUpOworCX0KIAogCWludGVsX2NvbnRleHRfZmluaShjZSk7CiAJaW50ZWxfY29udGV4dF9mcmVl
KGNlKTsKQEAgLTE1MywxOSArMTM1LDIxIEBAIHN0YXRpYyBpbnQgbW9ja19jb250ZXh0X2FsbG9j
KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIAlpZiAoIWNlLT5yaW5nKQogCQlyZXR1cm4gLUVO
T01FTTsKIAorCUdFTV9CVUdfT04oY2UtPnRpbWVsaW5lKTsKKwljZS0+dGltZWxpbmUgPSBpbnRl
bF90aW1lbGluZV9jcmVhdGUoY2UtPmVuZ2luZS0+Z3QsIE5VTEwpOworCWlmIChJU19FUlIoY2Ut
PnRpbWVsaW5lKSkgeworCQlrZnJlZShjZS0+ZW5naW5lKTsKKwkJcmV0dXJuIFBUUl9FUlIoY2Ut
PnRpbWVsaW5lKTsKKwl9CisKKwltb2NrX3RpbWVsaW5lX3BpbihjZS0+dGltZWxpbmUpOworCiAJ
cmV0dXJuIDA7CiB9CiAKIHN0YXRpYyBpbnQgbW9ja19jb250ZXh0X3BpbihzdHJ1Y3QgaW50ZWxf
Y29udGV4dCAqY2UpCiB7Ci0JaW50IHJldDsKLQotCXJldCA9IGludGVsX2NvbnRleHRfYWN0aXZl
X2FjcXVpcmUoY2UpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQltb2NrX3RpbWVsaW5l
X3BpbihjZS0+cmluZy0+dGltZWxpbmUpOwotCXJldHVybiAwOworCXJldHVybiBpbnRlbF9jb250
ZXh0X2FjdGl2ZV9hY3F1aXJlKGNlKTsKIH0KIAogc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRlbF9j
b250ZXh0X29wcyBtb2NrX2NvbnRleHRfb3BzID0gewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfY29udGV4dC5jCmluZGV4IDZlN2U5YTZmZDIzNS4uZGE5YzQ5ZTJhZGFmIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jCkBAIC0zMiw3ICszMiw3
IEBAIHN0YXRpYyBpbnQgcmVxdWVzdF9zeW5jKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCiBz
dGF0aWMgaW50IGNvbnRleHRfc3luYyhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiB7Ci0Jc3Ry
dWN0IGludGVsX3RpbWVsaW5lICp0bCA9IGNlLT5yaW5nLT50aW1lbGluZTsKKwlzdHJ1Y3QgaW50
ZWxfdGltZWxpbmUgKnRsID0gY2UtPnRpbWVsaW5lOwogCWludCBlcnIgPSAwOwogCiAJZG8gewpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMKaW5kZXggMWUwOTcyMmI1MzE3Li43Njk4ZmNhYTY0
OGEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYwpAQCAtMjQ2LDcgKzI0Niw3IEBAIHN0
YXRpYyBib29sIF9fYWN0aXZlX2RlbF9iYXJyaWVyKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLAog
CXN0cnVjdCBsbGlzdF9ub2RlICpoZWFkID0gTlVMTCwgKnRhaWwgPSBOVUxMOwogCXN0cnVjdCBs
bGlzdF9ub2RlICpwb3MsICpuZXh0OwogCi0JR0VNX0JVR19PTihub2RlLT50aW1lbGluZSAhPSBl
bmdpbmUtPmtlcm5lbF9jb250ZXh0LT5yaW5nLT50aW1lbGluZS0+ZmVuY2VfY29udGV4dCk7CisJ
R0VNX0JVR19PTihub2RlLT50aW1lbGluZSAhPSBlbmdpbmUtPmtlcm5lbF9jb250ZXh0LT50aW1l
bGluZS0+ZmVuY2VfY29udGV4dCk7CiAKIAkvKgogCSAqIFJlYnVpbGQgdGhlIGxsaXN0IGV4Y2x1
ZGluZyBvdXIgbm9kZS4gV2UgbWF5IHBlcmZvcm0gdGhpcwpAQCAtNTY4LDcgKzU2OCw3IEBAIGlu
dCBpOTE1X2FjdGl2ZV9hY3F1aXJlX3ByZWFsbG9jYXRlX2JhcnJpZXIoc3RydWN0IGk5MTVfYWN0
aXZlICpyZWYsCiAJICogaTkxNV9hY3RpdmVfYWNxdWlyZV9iYXJyaWVyKCkKIAkgKi8KIAlmb3Jf
ZWFjaF9lbmdpbmVfbWFza2VkKGVuZ2luZSwgaTkxNSwgbWFzaywgdG1wKSB7Ci0JCXU2NCBpZHgg
PSBlbmdpbmUtPmtlcm5lbF9jb250ZXh0LT5yaW5nLT50aW1lbGluZS0+ZmVuY2VfY29udGV4dDsK
KwkJdTY0IGlkeCA9IGVuZ2luZS0+a2VybmVsX2NvbnRleHQtPnRpbWVsaW5lLT5mZW5jZV9jb250
ZXh0OwogCQlzdHJ1Y3QgYWN0aXZlX25vZGUgKm5vZGU7CiAKIAkJbm9kZSA9IHJldXNlX2lkbGVf
YmFycmllcihyZWYsIGlkeCk7CkBAIC02NjUsNyArNjY1LDcgQEAgdm9pZCBpOTE1X3JlcXVlc3Rf
YWRkX2FjdGl2ZV9iYXJyaWVycyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAlzdHJ1Y3QgbGxp
c3Rfbm9kZSAqbm9kZSwgKm5leHQ7CiAKIAlHRU1fQlVHX09OKGludGVsX2VuZ2luZV9pc192aXJ0
dWFsKGVuZ2luZSkpOwotCUdFTV9CVUdfT04ocnEtPnRpbWVsaW5lICE9IGVuZ2luZS0+a2VybmVs
X2NvbnRleHQtPnJpbmctPnRpbWVsaW5lKTsKKwlHRU1fQlVHX09OKHJxLT50aW1lbGluZSAhPSBl
bmdpbmUtPmtlcm5lbF9jb250ZXh0LT50aW1lbGluZSk7CiAKIAkvKgogCSAqIEF0dGFjaCB0aGUg
bGlzdCBvZiBwcm90by1mZW5jZXMgdG8gdGhlIGluLWZsaWdodCByZXF1ZXN0IHN1Y2gKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKaW5kZXggOWIyYjE4ZjAxOTZiLi40MzE3NWJhZGEwOWUg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCkBAIC0zMDYsMTIgKzMwNiwxMiBAQCBz
dGF0aWMgYm9vbCBpOTE1X3JlcXVlc3RfcmV0aXJlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQog
CiAJbG9jYWxfaXJxX2VuYWJsZSgpOwogCi0JaW50ZWxfY29udGV4dF9leGl0KHJxLT5od19jb250
ZXh0KTsKLQlpbnRlbF9jb250ZXh0X3VucGluKHJxLT5od19jb250ZXh0KTsKLQogCWk5MTVfcmVx
dWVzdF9yZW1vdmVfZnJvbV9jbGllbnQocnEpOwogCWxpc3RfZGVsKCZycS0+bGluayk7CiAKKwlp
bnRlbF9jb250ZXh0X2V4aXQocnEtPmh3X2NvbnRleHQpOworCWludGVsX2NvbnRleHRfdW5waW4o
cnEtPmh3X2NvbnRleHQpOworCiAJZnJlZV9jYXB0dXJlX2xpc3QocnEpOwogCWk5MTVfc2NoZWRf
bm9kZV9maW5pKCZycS0+c2NoZWQpOwogCWk5MTVfcmVxdWVzdF9wdXQocnEpOwpAQCAtNjA4LDcg
KzYwOCw3IEBAIHJlcXVlc3RfYWxsb2Nfc2xvdyhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIGdm
cF90IGdmcCkKIHN0cnVjdCBpOTE1X3JlcXVlc3QgKgogX19pOTE1X3JlcXVlc3RfY3JlYXRlKHN0
cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgZ2ZwX3QgZ2ZwKQogewotCXN0cnVjdCBpbnRlbF90aW1l
bGluZSAqdGwgPSBjZS0+cmluZy0+dGltZWxpbmU7CisJc3RydWN0IGludGVsX3RpbWVsaW5lICp0
bCA9IGNlLT50aW1lbGluZTsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAl1MzIgc2Vxbm87
CiAJaW50IHJldDsKQEAgLTc2MCw3ICs3NjAsNyBAQCBpOTE1X3JlcXVlc3RfY3JlYXRlKHN0cnVj
dCBpbnRlbF9jb250ZXh0ICpjZSkKIAkJZ290byBlcnJfdW5sb2NrOwogCiAJLyogQ2hlY2sgdGhh
dCB3ZSBkbyBub3QgaW50ZXJydXB0IG91cnNlbHZlcyB3aXRoIGEgbmV3IHJlcXVlc3QgKi8KLQly
cS0+Y29va2llID0gbG9ja2RlcF9waW5fbG9jaygmY2UtPnJpbmctPnRpbWVsaW5lLT5tdXRleCk7
CisJcnEtPmNvb2tpZSA9IGxvY2tkZXBfcGluX2xvY2soJmNlLT50aW1lbGluZS0+bXV0ZXgpOwog
CiAJcmV0dXJuIHJxOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaTkxNV9nZW1fZXZpY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1
X2dlbV9ldmljdC5jCmluZGV4IGI2NDQ5ZDBhOGMxNy4uY2IzMGM2NjliMWI3IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYwpAQCAtNDgsMjYg
KzQ4LDI5IEBAIHN0YXRpYyBpbnQgcG9wdWxhdGVfZ2d0dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIHsKIAl1bnNpZ25lZCBsb25nIHVuYm91bmQsIGJvdW5kLCBjb3VudDsKIAlzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwotCXU2NCBzaXplOwogCiAJY291bnQgPSAwOwot
CWZvciAoc2l6ZSA9IDA7Ci0JICAgICBzaXplICsgSTkxNV9HVFRfUEFHRV9TSVpFIDw9IGk5MTUt
PmdndHQudm0udG90YWw7Ci0JICAgICBzaXplICs9IEk5MTVfR1RUX1BBR0VfU0laRSkgeworCWRv
IHsKIAkJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAKIAkJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2Ny
ZWF0ZV9pbnRlcm5hbChpOTE1LCBJOTE1X0dUVF9QQUdFX1NJWkUpOwogCQlpZiAoSVNfRVJSKG9i
aikpCiAJCQlyZXR1cm4gUFRSX0VSUihvYmopOwogCi0JCXF1aXJrX2FkZChvYmosIG9iamVjdHMp
OwotCiAJCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihvYmosIE5VTEwsIDAsIDAsIDAp
OwotCQlpZiAoSVNfRVJSKHZtYSkpCisJCWlmIChJU19FUlIodm1hKSkgeworCQkJaTkxNV9nZW1f
b2JqZWN0X3B1dChvYmopOworCQkJaWYgKHZtYSA9PSBFUlJfUFRSKC1FTk9TUEMpKQorCQkJCWJy
ZWFrOworCiAJCQlyZXR1cm4gUFRSX0VSUih2bWEpOworCQl9CiAKKwkJcXVpcmtfYWRkKG9iaiwg
b2JqZWN0cyk7CiAJCWNvdW50Kys7Ci0JfQorCX0gd2hpbGUgKDEpOworCXByX2RlYnVnKCJGaWxs
ZWQgR0dUVCB3aXRoICVsdSBwYWdlcyBbJWxsdSB0b3RhbF1cbiIsCisJCSBjb3VudCwgaTkxNS0+
Z2d0dC52bS50b3RhbCAvIFBBR0VfU0laRSk7CiAKIAlib3VuZCA9IDA7CiAJdW5ib3VuZCA9IDA7
Ci0tIAoyLjIzLjAucmMxCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRl
bC1nZng=

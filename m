Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0E9A1C9DFE
	for <lists+intel-gfx@lfdr.de>; Thu,  3 Oct 2019 14:04:57 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 94DC289C96;
	Thu,  3 Oct 2019 12:04:54 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 11C5C89295
 for <intel-gfx@lists.freedesktop.org>; Thu,  3 Oct 2019 12:04:51 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18706434-1500050 
 for multiple; Thu, 03 Oct 2019 13:04:34 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  3 Oct 2019 13:04:31 +0100
Message-Id: <20191003120431.11153-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191003093639.10186-17-chris@chris-wilson.co.uk>
References: <20191003093639.10186-17-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: Move context management under GEM
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

S2VlcCB0cmFjayBvZiB0aGUgR0VNIGNvbnRleHRzIHVuZGVybmVhdGggaTkxNS0+Z2VtLmNvbnRl
eHRzIGFuZCBhc3NpZ24KdGhlbSB0aGVpciBvd24gbG9jayBmb3IgdGhlIHB1cnBvc2VzIG9mIGxp
c3QgbWFuYWdlbWVudC4KCnYyOiBGb2N1cyBvbiBsb2NrIHRyYWNraW5nOyBjdHgtPnZtIGlzIHBy
b3RlY3RlZCBieSBjdHgtPm11dGV4CgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlz
QGNocmlzLXdpbHNvbi5jby51az4KQ2M6IFR2cnRrbyBVcnN1bGluIDx0dnJ0a28udXJzdWxpbkBp
bnRlbC5jb20+Ci0tLQpSZW1vdmVkIHRoZSBsYXN0IHJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQo
dHJ1ZSkgaGFjawotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0
LmMgICB8IDE3MyArKysrKysrKy0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9jb250ZXh0LmggICB8ICAyNyArKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX2NvbnRleHRfdHlwZXMuaCB8ICAgMiArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fZXhlY2J1ZmZlci5jICAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fdXNlcnB0ci5jICAgfCAgIDMgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0
cy9odWdlX3BhZ2VzLmMgICB8ICAzNiArKy0tCiAuLi4vZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9p
OTE1X2dlbV9jb250ZXh0LmMgfCAxNjYgKysrKysrKystLS0tLS0tLS0KIC4uLi9ncHUvZHJtL2k5
MTUvZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQuYyB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jICAgICAgIHwgIDEwICstCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9scmMuYyAgICAgICAgICAgfCAgIDUgKwogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jICAgIHwgIDI0ICstLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMgIHwgIDM5ICsrLS0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2xyYy5jICAgICAgICB8ICAgNiArLQogLi4uL2dwdS9kcm0vaTkxNS9n
dC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jICAgIHwgIDIwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndnQvc2NoZWR1bGVyLmMgICAgICAgICAgfCAgMjQgKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2RlYnVnZnMuYyAgICAgICAgICAgfCAgNTAgKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZHJ2LmMgICAgICAgICAgICAgICB8ICAgMiAtCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2Rydi5oICAgICAgICAgICAgICAgfCAgMjcgKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbS5jICAgICAgICAgICAgICAgfCAgMTAgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ2VtX2d0dC5jICAgICAgICAgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9wZXJmLmMgICAgICAgICAgICAgIHwgIDI0ICsrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9zeXNmcy5jICAgICAgICAgICAgIHwgIDc3ICsrKystLS0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3RyYWNlLmggICAgICAgICAgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbS5jICAgICB8ICAgOCAtCiAuLi4vZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5jICAgfCAgIDMgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2k5MTVfZ2VtX2d0dC5jIHwgIDE1ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMgfCAgMTIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9pOTE1X3ZtYS5jICAgICB8ICAgNyArLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvbW9ja19nZW1fZGV2aWNlLmMgIHwgICA2ICstCiAyOSBmaWxlcyBjaGFuZ2VkLCA0MDEgaW5z
ZXJ0aW9ucygrKSwgMzg3IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fY29udGV4dC5jCmluZGV4IGFlNTg4NTQ0YmYzYS4uNDI3YTlhMjVkNTlhIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKQEAgLTIxOCw5ICsy
MTgsMTIgQEAgc3RhdGljIHN0cnVjdCBpOTE1X2dlbV9lbmdpbmVzICpkZWZhdWx0X2VuZ2luZXMo
c3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIAogc3RhdGljIHZvaWQgaTkxNV9nZW1fY29u
dGV4dF9mcmVlKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCiB7Ci0JbG9ja2RlcF9hc3Nl
cnRfaGVsZCgmY3R4LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlHRU1fQlVHX09OKCFpOTE1
X2dlbV9jb250ZXh0X2lzX2Nsb3NlZChjdHgpKTsKIAorCXNwaW5fbG9jaygmY3R4LT5pOTE1LT5n
ZW0uY29udGV4dHMubG9jayk7CisJbGlzdF9kZWwoJmN0eC0+bGluayk7CisJc3Bpbl91bmxvY2so
JmN0eC0+aTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOworCiAJZnJlZV9lbmdpbmVzKHJjdV9hY2Nl
c3NfcG9pbnRlcihjdHgtPmVuZ2luZXMpKTsKIAltdXRleF9kZXN0cm95KCZjdHgtPmVuZ2luZXNf
bXV0ZXgpOwogCkBAIC0yMzAsNjcgKzIzMyw1NCBAQCBzdGF0aWMgdm9pZCBpOTE1X2dlbV9jb250
ZXh0X2ZyZWUoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIAlrZnJlZShjdHgtPm5hbWUp
OwogCXB1dF9waWQoY3R4LT5waWQpOwogCi0JbGlzdF9kZWwoJmN0eC0+bGluayk7CiAJbXV0ZXhf
ZGVzdHJveSgmY3R4LT5tdXRleCk7CiAKIAlrZnJlZV9yY3UoY3R4LCByY3UpOwogfQogCi1zdGF0
aWMgdm9pZCBjb250ZXh0c19mcmVlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQorc3Rh
dGljIHZvaWQgY29udGV4dHNfZnJlZV9hbGwoc3RydWN0IGxsaXN0X25vZGUgKmxpc3QpCiB7Ci0J
c3RydWN0IGxsaXN0X25vZGUgKmZyZWVkID0gbGxpc3RfZGVsX2FsbCgmaTkxNS0+Y29udGV4dHMu
ZnJlZV9saXN0KTsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LCAqY247CiAKLQlsb2Nr
ZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQotCWxsaXN0X2Zvcl9l
YWNoX2VudHJ5X3NhZmUoY3R4LCBjbiwgZnJlZWQsIGZyZWVfbGluaykKKwlsbGlzdF9mb3JfZWFj
aF9lbnRyeV9zYWZlKGN0eCwgY24sIGxpc3QsIGZyZWVfbGluaykKIAkJaTkxNV9nZW1fY29udGV4
dF9mcmVlKGN0eCk7CiB9CiAKLXN0YXRpYyB2b2lkIGNvbnRleHRzX2ZyZWVfZmlyc3Qoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCitzdGF0aWMgdm9pZCBjb250ZXh0c19mbHVzaF9mcmVl
KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0cyAqZ2MpCiB7Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRl
eHQgKmN0eDsKLQlzdHJ1Y3QgbGxpc3Rfbm9kZSAqZnJlZWQ7Ci0KLQlsb2NrZGVwX2Fzc2VydF9o
ZWxkKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQotCWZyZWVkID0gbGxpc3RfZGVsX2ZpcnN0
KCZpOTE1LT5jb250ZXh0cy5mcmVlX2xpc3QpOwotCWlmICghZnJlZWQpCi0JCXJldHVybjsKLQot
CWN0eCA9IGNvbnRhaW5lcl9vZihmcmVlZCwgdHlwZW9mKCpjdHgpLCBmcmVlX2xpbmspOwotCWk5
MTVfZ2VtX2NvbnRleHRfZnJlZShjdHgpOworCWNvbnRleHRzX2ZyZWVfYWxsKGxsaXN0X2RlbF9h
bGwoJmdjLT5mcmVlX2xpc3QpKTsKIH0KIAogc3RhdGljIHZvaWQgY29udGV4dHNfZnJlZV93b3Jr
ZXIoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0KLQkJY29udGFpbmVyX29mKHdvcmssIHR5cGVvZigqaTkxNSksIGNvbnRleHRzLmZy
ZWVfd29yayk7CisJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHRzICpnYyA9CisJCWNvbnRhaW5lcl9v
Zih3b3JrLCB0eXBlb2YoKmdjKSwgZnJlZV93b3JrKTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwotCWNvbnRleHRzX2ZyZWUoaTkxNSk7Ci0JbXV0ZXhfdW5sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwljb250ZXh0c19mbHVzaF9mcmVlKGdjKTsKIH0KIAog
dm9pZCBpOTE1X2dlbV9jb250ZXh0X3JlbGVhc2Uoc3RydWN0IGtyZWYgKnJlZikKIHsKIAlzdHJ1
Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4ID0gY29udGFpbmVyX29mKHJlZiwgdHlwZW9mKCpjdHgp
LCByZWYpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gY3R4LT5pOTE1OworCXN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0cyAqZ2MgPSAmY3R4LT5pOTE1LT5nZW0uY29udGV4dHM7CiAK
IAl0cmFjZV9pOTE1X2NvbnRleHRfZnJlZShjdHgpOwotCWlmIChsbGlzdF9hZGQoJmN0eC0+ZnJl
ZV9saW5rLCAmaTkxNS0+Y29udGV4dHMuZnJlZV9saXN0KSkKLQkJcXVldWVfd29yayhpOTE1LT53
cSwgJmk5MTUtPmNvbnRleHRzLmZyZWVfd29yayk7CisJaWYgKGxsaXN0X2FkZCgmY3R4LT5mcmVl
X2xpbmssICZnYy0+ZnJlZV9saXN0KSkKKwkJcXVldWVfd29yayhjdHgtPmk5MTUtPndxLCAmZ2Mt
PmZyZWVfd29yayk7CiB9CiAKIHN0YXRpYyB2b2lkIGNvbnRleHRfY2xvc2Uoc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHQgKmN0eCkKIHsKLQlpOTE1X2dlbV9jb250ZXh0X3NldF9jbG9zZWQoY3R4KTsK
KwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKIAotCWlmIChjdHgtPnZtKQotCQlpOTE1
X3ZtX2Nsb3NlKGN0eC0+dm0pOworCWk5MTVfZ2VtX2NvbnRleHRfc2V0X2Nsb3NlZChjdHgpOwog
CiAJbXV0ZXhfbG9jaygmY3R4LT5tdXRleCk7CiAKKwl2bSA9IGk5MTVfZ2VtX2NvbnRleHRfdm0o
Y3R4KTsKKwlpZiAodm0pCisJCWk5MTVfdm1fY2xvc2Uodm0pOworCiAJY3R4LT5maWxlX3ByaXYg
PSBFUlJfUFRSKC1FQkFERik7CiAKIAkvKgpAQCAtMzE3LDcgKzMwNyw2IEBAIF9fY3JlYXRlX2Nv
bnRleHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJCXJldHVybiBFUlJfUFRSKC1F
Tk9NRU0pOwogCiAJa3JlZl9pbml0KCZjdHgtPnJlZik7Ci0JbGlzdF9hZGRfdGFpbCgmY3R4LT5s
aW5rLCAmaTkxNS0+Y29udGV4dHMubGlzdCk7CiAJY3R4LT5pOTE1ID0gaTkxNTsKIAljdHgtPnNj
aGVkLnByaW9yaXR5ID0gSTkxNV9VU0VSX1BSSU9SSVRZKEk5MTVfUFJJT1JJVFlfTk9STUFMKTsK
IAltdXRleF9pbml0KCZjdHgtPm11dGV4KTsKQEAgLTM0Myw2ICszMzIsMTAgQEAgX19jcmVhdGVf
Y29udGV4dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAlmb3IgKGkgPSAwOyBpIDwg
QVJSQVlfU0laRShjdHgtPmhhbmdfdGltZXN0YW1wKTsgaSsrKQogCQljdHgtPmhhbmdfdGltZXN0
YW1wW2ldID0gamlmZmllcyAtIENPTlRFWFRfRkFTVF9IQU5HX0pJRkZJRVM7CiAKKwlzcGluX2xv
Y2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKKwlsaXN0X2FkZF90YWlsKCZjdHgtPmxpbmss
ICZpOTE1LT5nZW0uY29udGV4dHMubGlzdCk7CisJc3Bpbl91bmxvY2soJmk5MTUtPmdlbS5jb250
ZXh0cy5sb2NrKTsKKwogCXJldHVybiBjdHg7CiAKIGVycl9mcmVlOgpAQCAtMzcyLDExICszNjUs
MTEgQEAgc3RhdGljIHZvaWQgX19hcHBseV9wcGd0dChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2Us
IHZvaWQgKnZtKQogc3RhdGljIHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKgogX19zZXRfcHBn
dHQoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZSAqdm0pCiB7Ci0Jc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqb2xkID0gY3R4LT52bTsKKwlz
dHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICpvbGQgPSBpOTE1X2dlbV9jb250ZXh0X3ZtKGN0eCk7
CiAKIAlHRU1fQlVHX09OKG9sZCAmJiBpOTE1X3ZtX2lzXzRsdmwodm0pICE9IGk5MTVfdm1faXNf
NGx2bChvbGQpKTsKIAotCWN0eC0+dm0gPSBpOTE1X3ZtX29wZW4odm0pOworCXJjdV9hc3NpZ25f
cG9pbnRlcihjdHgtPnZtLCBpOTE1X3ZtX29wZW4odm0pKTsKIAljb250ZXh0X2FwcGx5X2FsbChj
dHgsIF9fYXBwbHlfcHBndHQsIHZtKTsKIAogCXJldHVybiBvbGQ7CkBAIC0zODUsNyArMzc4LDcg
QEAgX19zZXRfcHBndHQoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwgc3RydWN0IGk5MTVf
YWRkcmVzc19zcGFjZSAqdm0pCiBzdGF0aWMgdm9pZCBfX2Fzc2lnbl9wcGd0dChzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dCAqY3R4LAogCQkJICAgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0p
CiB7Ci0JaWYgKHZtID09IGN0eC0+dm0pCisJaWYgKHZtID09IHJjdV9hY2Nlc3NfcG9pbnRlcihj
dHgtPnZtKSkKIAkJcmV0dXJuOwogCiAJdm0gPSBfX3NldF9wcGd0dChjdHgsIHZtKTsKQEAgLTQx
NywyNyArNDEwLDI1IEBAIHN0YXRpYyB2b2lkIF9fYXNzaWduX3RpbWVsaW5lKHN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICpjdHgsCiB9CiAKIHN0YXRpYyBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAq
Ci1pOTE1X2dlbV9jcmVhdGVfY29udGV4dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsIHVuc2lnbmVkIGludCBmbGFncykKK2k5MTVfZ2VtX2NyZWF0ZV9jb250ZXh0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LCB1bnNpZ25lZCBpbnQgZmxhZ3MpCiB7CiAJc3RydWN0IGk5
MTVfZ2VtX2NvbnRleHQgKmN0eDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2LT5k
cm0uc3RydWN0X211dGV4KTsKLQogCWlmIChmbGFncyAmIEk5MTVfQ09OVEVYVF9DUkVBVEVfRkxB
R1NfU0lOR0xFX1RJTUVMSU5FICYmCi0JICAgICFIQVNfRVhFQ0xJU1RTKGRldl9wcml2KSkKKwkg
ICAgIUhBU19FWEVDTElTVFMoaTkxNSkpCiAJCXJldHVybiBFUlJfUFRSKC1FSU5WQUwpOwogCi0J
LyogUmVhcCB0aGUgbW9zdCBzdGFsZSBjb250ZXh0ICovCi0JY29udGV4dHNfZnJlZV9maXJzdChk
ZXZfcHJpdik7CisJLyogUmVhcCB0aGUgc3RhbGUgY29udGV4dHMgKi8KKwljb250ZXh0c19mbHVz
aF9mcmVlKCZpOTE1LT5nZW0uY29udGV4dHMpOwogCi0JY3R4ID0gX19jcmVhdGVfY29udGV4dChk
ZXZfcHJpdik7CisJY3R4ID0gX19jcmVhdGVfY29udGV4dChpOTE1KTsKIAlpZiAoSVNfRVJSKGN0
eCkpCiAJCXJldHVybiBjdHg7CiAKLQlpZiAoSEFTX0ZVTExfUFBHVFQoZGV2X3ByaXYpKSB7CisJ
aWYgKEhBU19GVUxMX1BQR1RUKGk5MTUpKSB7CiAJCXN0cnVjdCBpOTE1X3BwZ3R0ICpwcGd0dDsK
IAotCQlwcGd0dCA9IGk5MTVfcHBndHRfY3JlYXRlKGRldl9wcml2KTsKKwkJcHBndHQgPSBpOTE1
X3BwZ3R0X2NyZWF0ZShpOTE1KTsKIAkJaWYgKElTX0VSUihwcGd0dCkpIHsKIAkJCURSTV9ERUJV
R19EUklWRVIoIlBQR1RUIHNldHVwIGZhaWxlZCAoJWxkKVxuIiwKIAkJCQkJIFBUUl9FUlIocHBn
dHQpKTsKQEAgLTQ0NSwxNCArNDM2LDE3IEBAIGk5MTVfZ2VtX2NyZWF0ZV9jb250ZXh0KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdW5zaWduZWQgaW50IGZsYWdzKQogCQkJcmV0
dXJuIEVSUl9DQVNUKHBwZ3R0KTsKIAkJfQogCisJCW11dGV4X2xvY2soJmN0eC0+bXV0ZXgpOwog
CQlfX2Fzc2lnbl9wcGd0dChjdHgsICZwcGd0dC0+dm0pOworCQltdXRleF91bmxvY2soJmN0eC0+
bXV0ZXgpOworCiAJCWk5MTVfdm1fcHV0KCZwcGd0dC0+dm0pOwogCX0KIAogCWlmIChmbGFncyAm
IEk5MTVfQ09OVEVYVF9DUkVBVEVfRkxBR1NfU0lOR0xFX1RJTUVMSU5FKSB7CiAJCXN0cnVjdCBp
bnRlbF90aW1lbGluZSAqdGltZWxpbmU7CiAKLQkJdGltZWxpbmUgPSBpbnRlbF90aW1lbGluZV9j
cmVhdGUoJmRldl9wcml2LT5ndCwgTlVMTCk7CisJCXRpbWVsaW5lID0gaW50ZWxfdGltZWxpbmVf
Y3JlYXRlKCZpOTE1LT5ndCwgTlVMTCk7CiAJCWlmIChJU19FUlIodGltZWxpbmUpKSB7CiAJCQlj
b250ZXh0X2Nsb3NlKGN0eCk7CiAJCQlyZXR1cm4gRVJSX0NBU1QodGltZWxpbmUpOwpAQCAtNDk3
LDQ4ICs0OTEsNDAgQEAgaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LCBpbnQgcHJpbykKIAlyZXR1cm4gY3R4OwogfQogCi1zdGF0aWMg
dm9pZCBpbml0X2NvbnRleHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQorc3RhdGlj
IHZvaWQgaW5pdF9jb250ZXh0cyhzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dHMgKmdjKQogewotCW11
dGV4X2luaXQoJmk5MTUtPmNvbnRleHRzLm11dGV4KTsKLQlJTklUX0xJU1RfSEVBRCgmaTkxNS0+
Y29udGV4dHMubGlzdCk7Ci0KLQkvKiBVc2luZyB0aGUgc2ltcGxlIGlkYSBpbnRlcmZhY2UsIHRo
ZSBtYXggaXMgbGltaXRlZCBieSBzaXplb2YoaW50KSAqLwotCUJVSUxEX0JVR19PTihNQVhfQ09O
VEVYVF9IV19JRCA+IElOVF9NQVgpOwotCUJVSUxEX0JVR19PTihHRU4xMV9NQVhfQ09OVEVYVF9I
V19JRCA+IElOVF9NQVgpOwotCWlkYV9pbml0KCZpOTE1LT5jb250ZXh0cy5od19pZGEpOwotCUlO
SVRfTElTVF9IRUFEKCZpOTE1LT5jb250ZXh0cy5od19pZF9saXN0KTsKKwlzcGluX2xvY2tfaW5p
dCgmZ2MtPmxvY2spOworCUlOSVRfTElTVF9IRUFEKCZnYy0+bGlzdCk7CiAKLQlJTklUX1dPUkso
Jmk5MTUtPmNvbnRleHRzLmZyZWVfd29yaywgY29udGV4dHNfZnJlZV93b3JrZXIpOwotCWluaXRf
bGxpc3RfaGVhZCgmaTkxNS0+Y29udGV4dHMuZnJlZV9saXN0KTsKKwlJTklUX1dPUksoJmdjLT5m
cmVlX3dvcmssIGNvbnRleHRzX2ZyZWVfd29ya2VyKTsKKwlpbml0X2xsaXN0X2hlYWQoJmdjLT5m
cmVlX2xpc3QpOwogfQogCi1pbnQgaTkxNV9nZW1fY29udGV4dHNfaW5pdChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitpbnQgaTkxNV9nZW1faW5pdF9jb250ZXh0cyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4
OwogCiAJLyogUmVhc3N1cmUgb3Vyc2VsdmVzIHdlIGFyZSBvbmx5IGNhbGxlZCBvbmNlICovCi0J
R0VNX0JVR19PTihkZXZfcHJpdi0+a2VybmVsX2NvbnRleHQpOworCUdFTV9CVUdfT04oaTkxNS0+
a2VybmVsX2NvbnRleHQpOwogCi0JaW5pdF9jb250ZXh0cyhkZXZfcHJpdik7CisJaW5pdF9jb250
ZXh0cygmaTkxNS0+Z2VtLmNvbnRleHRzKTsKIAogCS8qIGxvd2VzdCBwcmlvcml0eTsgaWRsZSB0
YXNrICovCi0JY3R4ID0gaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVsKGRldl9wcml2LCBJ
OTE1X1BSSU9SSVRZX01JTik7CisJY3R4ID0gaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfa2VybmVs
KGk5MTUsIEk5MTVfUFJJT1JJVFlfTUlOKTsKIAlpZiAoSVNfRVJSKGN0eCkpIHsKIAkJRFJNX0VS
Uk9SKCJGYWlsZWQgdG8gY3JlYXRlIGRlZmF1bHQgZ2xvYmFsIGNvbnRleHRcbiIpOwogCQlyZXR1
cm4gUFRSX0VSUihjdHgpOwogCX0KLQlkZXZfcHJpdi0+a2VybmVsX2NvbnRleHQgPSBjdHg7CisJ
aTkxNS0+a2VybmVsX2NvbnRleHQgPSBjdHg7CiAKIAlEUk1fREVCVUdfRFJJVkVSKCIlcyBjb250
ZXh0IHN1cHBvcnQgaW5pdGlhbGl6ZWRcbiIsCi0JCQkgRFJJVkVSX0NBUFMoZGV2X3ByaXYpLT5o
YXNfbG9naWNhbF9jb250ZXh0cyA/CisJCQkgRFJJVkVSX0NBUFMoaTkxNSktPmhhc19sb2dpY2Fs
X2NvbnRleHRzID8KIAkJCSAibG9naWNhbCIgOiAiZmFrZSIpOwogCXJldHVybiAwOwogfQogCi12
b2lkIGk5MTVfZ2VtX2NvbnRleHRzX2Zpbmkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
Cit2b2lkIGk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNlX19jb250ZXh0cyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIHsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLQogCWRlc3Ryb3lfa2VybmVsX2NvbnRleHQoJmk5MTUtPmtlcm5lbF9jb250ZXh0
KTsKIH0KIApAQCAtNTU3LDExICs1NDMsMTYgQEAgc3RhdGljIGludCB2bV9pZHJfY2xlYW51cChp
bnQgaWQsIHZvaWQgKnAsIHZvaWQgKmRhdGEpCiBzdGF0aWMgaW50IGdlbV9jb250ZXh0X3JlZ2lz
dGVyKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCQkJc3RydWN0IGRybV9pOTE1X2Zp
bGVfcHJpdmF0ZSAqZnByaXYpCiB7CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CiAJ
aW50IHJldDsKIAogCWN0eC0+ZmlsZV9wcml2ID0gZnByaXY7Ci0JaWYgKGN0eC0+dm0pCi0JCWN0
eC0+dm0tPmZpbGUgPSBmcHJpdjsKKworCW11dGV4X2xvY2soJmN0eC0+bXV0ZXgpOworCXZtID0g
aTkxNV9nZW1fY29udGV4dF92bShjdHgpOworCWlmICh2bSkKKwkJV1JJVEVfT05DRSh2bS0+Zmls
ZSwgZnByaXYpOyAvKiBYWFggKi8KKwltdXRleF91bmxvY2soJmN0eC0+bXV0ZXgpOwogCiAJY3R4
LT5waWQgPSBnZXRfdGFza19waWQoY3VycmVudCwgUElEVFlQRV9QSUQpOwogCWN0eC0+bmFtZSA9
IGthc3ByaW50ZihHRlBfS0VSTkVMLCAiJXNbJWRdIiwKQEAgLTU5OCw5ICs1ODksNyBAQCBpbnQg
aTkxNV9nZW1fY29udGV4dF9vcGVuKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCWlk
cl9pbml0KCZmaWxlX3ByaXYtPmNvbnRleHRfaWRyKTsKIAlpZHJfaW5pdF9iYXNlKCZmaWxlX3By
aXYtPnZtX2lkciwgMSk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
IAljdHggPSBpOTE1X2dlbV9jcmVhdGVfY29udGV4dChpOTE1LCAwKTsKLQltdXRleF91bmxvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChJU19FUlIoY3R4KSkgewogCQllcnIgPSBQ
VFJfRVJSKGN0eCk7CiAJCWdvdG8gZXJyOwpAQCAtNjI4LDYgKzYxNyw3IEBAIGludCBpOTE1X2dl
bV9jb250ZXh0X29wZW4oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiB2b2lkIGk5MTVf
Z2VtX2NvbnRleHRfY2xvc2Uoc3RydWN0IGRybV9maWxlICpmaWxlKQogewogCXN0cnVjdCBkcm1f
aTkxNV9maWxlX3ByaXZhdGUgKmZpbGVfcHJpdiA9IGZpbGUtPmRyaXZlcl9wcml2OworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZmlsZV9wcml2LT5kZXZfcHJpdjsKIAogCWlkcl9m
b3JfZWFjaCgmZmlsZV9wcml2LT5jb250ZXh0X2lkciwgY29udGV4dF9pZHJfY2xlYW51cCwgTlVM
TCk7CiAJaWRyX2Rlc3Ryb3koJmZpbGVfcHJpdi0+Y29udGV4dF9pZHIpOwpAQCAtNjM2LDYgKzYy
Niw4IEBAIHZvaWQgaTkxNV9nZW1fY29udGV4dF9jbG9zZShzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUp
CiAJaWRyX2Zvcl9lYWNoKCZmaWxlX3ByaXYtPnZtX2lkciwgdm1faWRyX2NsZWFudXAsIE5VTEwp
OwogCWlkcl9kZXN0cm95KCZmaWxlX3ByaXYtPnZtX2lkcik7CiAJbXV0ZXhfZGVzdHJveSgmZmls
ZV9wcml2LT52bV9pZHJfbG9jayk7CisKKwljb250ZXh0c19mbHVzaF9mcmVlKCZpOTE1LT5nZW0u
Y29udGV4dHMpOwogfQogCiBpbnQgaTkxNV9nZW1fdm1fY3JlYXRlX2lvY3RsKHN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCkBAIC04MTQsMTYgKzgwNiwxMiBAQCBzdGF0aWMgaW50
IGdldF9wcGd0dChzdHJ1Y3QgZHJtX2k5MTVfZmlsZV9wcml2YXRlICpmaWxlX3ByaXYsCiAJc3Ry
dWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CiAJaW50IHJldDsKIAotCWlmICghY3R4LT52bSkK
KwlpZiAoIXJjdV9hY2Nlc3NfcG9pbnRlcihjdHgtPnZtKSkKIAkJcmV0dXJuIC1FTk9ERVY7CiAK
LQkvKiBYWFggcmN1IGFjcXVpcmU/ICovCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxl
KCZjdHgtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7
Ci0KKwlyY3VfcmVhZF9sb2NrKCk7CiAJdm0gPSBpOTE1X3ZtX2dldChjdHgtPnZtKTsKLQltdXRl
eF91bmxvY2soJmN0eC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJcmN1X3JlYWRfdW5sb2Nr
KCk7CiAKIAlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmZpbGVfcHJpdi0+dm1faWRy
X2xvY2spOwogCWlmIChyZXQpCkBAIC05MzIsNyArOTIwLDcgQEAgc3RhdGljIGludCBzZXRfcHBn
dHQoc3RydWN0IGRybV9pOTE1X2ZpbGVfcHJpdmF0ZSAqZmlsZV9wcml2LAogCWlmIChhcmdzLT5z
aXplKQogCQlyZXR1cm4gLUVJTlZBTDsKIAotCWlmICghY3R4LT52bSkKKwlpZiAoIXJjdV9hY2Nl
c3NfcG9pbnRlcihjdHgtPnZtKSkKIAkJcmV0dXJuIC1FTk9ERVY7CiAKIAlpZiAodXBwZXJfMzJf
Yml0cyhhcmdzLT52YWx1ZSkpCkBAIC05NDYsMTcgKzkzNCwyMCBAQCBzdGF0aWMgaW50IHNldF9w
cGd0dChzdHJ1Y3QgZHJtX2k5MTVfZmlsZV9wcml2YXRlICpmaWxlX3ByaXYsCiAJaWYgKCF2bSkK
IAkJcmV0dXJuIC1FTk9FTlQ7CiAKLQllcnIgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmN0
eC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJZXJyID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRp
YmxlKCZjdHgtPm11dGV4KTsKIAlpZiAoZXJyKQogCQlnb3RvIG91dDsKIAotCWlmICh2bSA9PSBj
dHgtPnZtKQorCWlmIChpOTE1X2dlbV9jb250ZXh0X2lzX2Nsb3NlZChjdHgpKSB7CisJCWVyciA9
IC1FTk9FTlQ7CisJCWdvdG8gb3V0OworCX0KKworCWlmICh2bSA9PSByY3VfYWNjZXNzX3BvaW50
ZXIoY3R4LT52bSkpCiAJCWdvdG8gdW5sb2NrOwogCiAJLyogVGVhcmRvd24gdGhlIGV4aXN0aW5n
IG9iajp2bWEgY2FjaGUsIGl0IHdpbGwgaGF2ZSB0byBiZSByZWJ1aWx0LiAqLwotCW11dGV4X2xv
Y2soJmN0eC0+bXV0ZXgpOwogCWx1dF9jbG9zZShjdHgpOwotCW11dGV4X3VubG9jaygmY3R4LT5t
dXRleCk7CiAKIAlvbGQgPSBfX3NldF9wcGd0dChjdHgsIHZtKTsKIApAQCAtOTc2LDggKzk2Nyw3
IEBAIHN0YXRpYyBpbnQgc2V0X3BwZ3R0KHN0cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGUgKmZp
bGVfcHJpdiwKIAl9CiAKIHVubG9jazoKLQltdXRleF91bmxvY2soJmN0eC0+aTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7Ci0KKwltdXRleF91bmxvY2soJmN0eC0+bXV0ZXgpOwogb3V0OgogCWk5MTVf
dm1fcHV0KHZtKTsKIAlyZXR1cm4gZXJyOwpAQCAtMTgzNiw3ICsxODI2LDcgQEAgc3RhdGljIGlu
dCBjbG9uZV92bShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqZHN0LAogCiAJcmN1X3JlYWRfbG9j
aygpOwogCWRvIHsKLQkJdm0gPSBSRUFEX09OQ0Uoc3JjLT52bSk7CisJCXZtID0gcmN1X2RlcmVm
ZXJlbmNlKHNyYy0+dm0pOwogCQlpZiAoIXZtKQogCQkJYnJlYWs7CiAKQEAgLTE4NTgsNyArMTg0
OCw3IEBAIHN0YXRpYyBpbnQgY2xvbmVfdm0oc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmRzdCwK
IAkJICogaXQgY2Fubm90IGJlIHJlYWxsb2NhdGVkIGVsc2V3aGVyZS4KIAkJICovCiAKLQkJaWYg
KHZtID09IFJFQURfT05DRShzcmMtPnZtKSkKKwkJaWYgKHZtID09IHJjdV9hY2Nlc3NfcG9pbnRl
cihzcmMtPnZtKSkKIAkJCWJyZWFrOwogCiAJCWk5MTVfdm1fcHV0KHZtKTsKQEAgLTE5NjAsMTIg
KzE5NTAsNyBAQCBpbnQgaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfaW9jdGwoc3RydWN0IGRybV9k
ZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJcmV0dXJuIC1FSU87CiAJfQogCi0JcmV0ID0gaTkx
NV9tdXRleF9sb2NrX2ludGVycnVwdGlibGUoZGV2KTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0
OwotCiAJZXh0X2RhdGEuY3R4ID0gaTkxNV9nZW1fY3JlYXRlX2NvbnRleHQoaTkxNSwgYXJncy0+
ZmxhZ3MpOwotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChJU19FUlIo
ZXh0X2RhdGEuY3R4KSkKIAkJcmV0dXJuIFBUUl9FUlIoZXh0X2RhdGEuY3R4KTsKIApAQCAtMjA5
MiwxMCArMjA3NywxMiBAQCBpbnQgaTkxNV9nZW1fY29udGV4dF9nZXRwYXJhbV9pb2N0bChzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCiAJY2FzZSBJOTE1X0NPTlRFWFRfUEFS
QU1fR1RUX1NJWkU6CiAJCWFyZ3MtPnNpemUgPSAwOwotCQlpZiAoY3R4LT52bSkKLQkJCWFyZ3Mt
PnZhbHVlID0gY3R4LT52bS0+dG90YWw7CisJCXJjdV9yZWFkX2xvY2soKTsKKwkJaWYgKHJjdV9h
Y2Nlc3NfcG9pbnRlcihjdHgtPnZtKSkKKwkJCWFyZ3MtPnZhbHVlID0gcmN1X2RlcmVmZXJlbmNl
KGN0eC0+dm0pLT50b3RhbDsKIAkJZWxzZQogCQkJYXJncy0+dmFsdWUgPSB0b19pOTE1KGRldikt
PmdndHQudm0udG90YWw7CisJCXJjdV9yZWFkX3VubG9jaygpOwogCQlicmVhazsKIAogCWNhc2Ug
STkxNV9DT05URVhUX1BBUkFNX05PX0VSUk9SX0NBUFRVUkU6CkBAIC0yMTYxLDcgKzIxNDgsNyBA
QCBpbnQgaTkxNV9nZW1fY29udGV4dF9zZXRwYXJhbV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2LCB2b2lkICpkYXRhLAogaW50IGk5MTVfZ2VtX2NvbnRleHRfcmVzZXRfc3RhdHNfaW9jdGwo
c3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJCQkgICAgICAgdm9pZCAqZGF0YSwgc3RydWN0IGRy
bV9maWxlICpmaWxlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2
KTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcmVzZXRfc3RhdHMgKmFyZ3MgPSBkYXRhOwogCXN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0ICpjdHg7CiAJaW50IHJldDsKQEAgLTIxODMsNyArMjE3MCw3IEBAIGlu
dCBpOTE1X2dlbV9jb250ZXh0X3Jlc2V0X3N0YXRzX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsCiAJICovCiAKIAlpZiAoY2FwYWJsZShDQVBfU1lTX0FETUlOKSkKLQkJYXJncy0+cmVzZXRf
Y291bnQgPSBpOTE1X3Jlc2V0X2NvdW50KCZkZXZfcHJpdi0+Z3B1X2Vycm9yKTsKKwkJYXJncy0+
cmVzZXRfY291bnQgPSBpOTE1X3Jlc2V0X2NvdW50KCZpOTE1LT5ncHVfZXJyb3IpOwogCWVsc2UK
IAkJYXJncy0+cmVzZXRfY291bnQgPSAwOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX2NvbnRleHQuaAppbmRleCA1MGJjMjdkMzBjMDMuLjkyMzQ1ODY4MzBkMSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaAorKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5oCkBAIC0xMSw3ICsxMSw5
IEBACiAKICNpbmNsdWRlICJndC9pbnRlbF9jb250ZXh0LmgiCiAKKyNpbmNsdWRlICJpOTE1X2Ry
di5oIgogI2luY2x1ZGUgImk5MTVfZ2VtLmgiCisjaW5jbHVkZSAiaTkxNV9nZW1fZ3R0LmgiCiAj
aW5jbHVkZSAiaTkxNV9zY2hlZHVsZXIuaCIKICNpbmNsdWRlICJpbnRlbF9kZXZpY2VfaW5mby5o
IgogCkBAIC0xMTgsOCArMTIwLDggQEAgc3RhdGljIGlubGluZSBib29sIGk5MTVfZ2VtX2NvbnRl
eHRfaXNfa2VybmVsKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCiB9CiAKIC8qIGk5MTVf
Z2VtX2NvbnRleHQuYyAqLwotaW50IF9fbXVzdF9jaGVjayBpOTE1X2dlbV9jb250ZXh0c19pbml0
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci12b2lkIGk5MTVfZ2VtX2NvbnRl
eHRzX2Zpbmkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK2ludCBfX211c3Rf
Y2hlY2sgaTkxNV9nZW1faW5pdF9jb250ZXh0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSk7Cit2b2lkIGk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNlX19jb250ZXh0cyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSk7CiAKIGludCBpOTE1X2dlbV9jb250ZXh0X29wZW4oc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSk7CkBAIC0x
NTgsNiArMTYwLDI3IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBpOTE1X2dlbV9jb250ZXh0X3B1dChz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQogCWtyZWZfcHV0KCZjdHgtPnJlZiwgaTkxNV9n
ZW1fY29udGV4dF9yZWxlYXNlKTsKIH0KIAorc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlICoKK2k5MTVfZ2VtX2NvbnRleHRfdm0oc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQg
KmN0eCkKK3sKKwlyZXR1cm4gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChjdHgtPnZtLCBsb2Nr
ZGVwX2lzX2hlbGQoJmN0eC0+bXV0ZXgpKTsKK30KKworc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkx
NV9hZGRyZXNzX3NwYWNlICoKK2k5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dCAqY3R4KQoreworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwor
CisJcmN1X3JlYWRfbG9jaygpOworCXZtID0gcmN1X2RlcmVmZXJlbmNlKGN0eC0+dm0pOworCWlm
ICghdm0pCisJCXZtID0gJmN0eC0+aTkxNS0+Z2d0dC52bTsKKwl2bSA9IGk5MTVfdm1fZ2V0KHZt
KTsKKwlyY3VfcmVhZF91bmxvY2soKTsKKworCXJldHVybiB2bTsKK30KKwogc3RhdGljIGlubGlu
ZSBzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lcyAqCiBpOTE1X2dlbV9jb250ZXh0X2VuZ2luZXMoc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fY29udGV4dF90eXBlcy5oCmluZGV4IDg3YmUyNzg3N2UyMi4uYWI4ZTEz
NjdkZmM4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29u
dGV4dF90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250
ZXh0X3R5cGVzLmgKQEAgLTg4LDcgKzg4LDcgQEAgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgewog
CSAqIEluIG90aGVyIG1vZGVzLCB0aGlzIGlzIGEgTlVMTCBwb2ludGVyIHdpdGggdGhlIGV4cGVj
dGF0aW9uIHRoYXQKIAkgKiB0aGUgY2FsbGVyIHVzZXMgdGhlIHNoYXJlZCBnbG9iYWwgR1RULgog
CSAqLwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOworCXN0cnVjdCBpOTE1X2FkZHJl
c3Nfc3BhY2UgX19yY3UgKnZtOwogCiAJLyoqCiAJICogQHBpZDogcHJvY2VzcyBpZCBvZiBjcmVh
dG9yCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1
ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYwpp
bmRleCA4OGE4ODFiZTEyZWMuLjk4ODE2YzM1ZmZjMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCkBAIC03MjgsNyArNzI4LDcgQEAgc3RhdGlj
IGludCBlYl9zZWxlY3RfY29udGV4dChzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYikKIAkJcmV0
dXJuIC1FTk9FTlQ7CiAKIAllYi0+Z2VtX2NvbnRleHQgPSBjdHg7Ci0JaWYgKGN0eC0+dm0pCisJ
aWYgKHJjdV9hY2Nlc3NfcG9pbnRlcihjdHgtPnZtKSkKIAkJZWItPmludmFsaWRfZmxhZ3MgfD0g
RVhFQ19PQkpFQ1RfTkVFRFNfR1RUOwogCiAJZWItPmNvbnRleHRfZmxhZ3MgPSAwOwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMKaW5kZXggMTczOGExNWViOTEx
Li40Zjk3MDQ3NDAxM2YgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV91c2VycHRyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Vz
ZXJwdHIuYwpAQCAtNzU4LDcgKzc1OCw4IEBAIGk5MTVfZ2VtX3VzZXJwdHJfaW9jdGwoc3RydWN0
IGRybV9kZXZpY2UgKmRldiwKIAkJICogT24gYWxtb3N0IGFsbCBvZiB0aGUgb2xkZXIgaHcsIHdl
IGNhbm5vdCB0ZWxsIHRoZSBHUFUgdGhhdAogCQkgKiBhIHBhZ2UgaXMgcmVhZG9ubHkuCiAJCSAq
LwotCQl2bSA9IGRldl9wcml2LT5rZXJuZWxfY29udGV4dC0+dm07CisJCXZtID0gcmN1X2RlcmVm
ZXJlbmNlX3Byb3RlY3RlZChkZXZfcHJpdi0+a2VybmVsX2NvbnRleHQtPnZtLAorCQkJCQkgICAg
ICAgdHJ1ZSk7IC8qIHN0YXRpYyB2bSAqLwogCQlpZiAoIXZtIHx8ICF2bS0+aGFzX3JlYWRfb25s
eSkKIAkJCXJldHVybiAtRU5PREVWOwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMKaW5kZXggOThiMmE2Y2NmY2MxLi4zMzE0ODU4ZjMwNDYg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdl
cy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5j
CkBAIC0xMzIyLDE1ICsxMzIyLDE1IEBAIHN0YXRpYyBpbnQgaWd0X3BwZ3R0X3Bpbl91cGRhdGUo
dm9pZCAqYXJnKQogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHggPSBhcmc7CiAJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gY3R4LT5pOTE1OwogCXVuc2lnbmVkIGxvbmcg
c3VwcG9ydGVkID0gSU5URUxfSU5GTyhkZXZfcHJpdiktPnBhZ2Vfc2l6ZXM7Ci0Jc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqdm0gPSBjdHgtPnZtOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmo7CiAJc3RydWN0IGk5MTVfZ2VtX2VuZ2luZXNfaXRlciBpdDsKKwlzdHJ1Y3QgaTkx
NV9hZGRyZXNzX3NwYWNlICp2bTsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAJc3RydWN0
IGk5MTVfdm1hICp2bWE7CiAJdW5zaWduZWQgaW50IGZsYWdzID0gUElOX1VTRVIgfCBQSU5fT0ZG
U0VUX0ZJWEVEOwogCXVuc2lnbmVkIGludCBuOwogCWludCBmaXJzdCwgbGFzdDsKLQlpbnQgZXJy
OworCWludCBlcnIgPSAwOwogCiAJLyoKIAkgKiBNYWtlIHN1cmUgdGhlcmUncyBubyBmdW5ueSBi
dXNpbmVzcyB3aGVuIGRvaW5nIGEgUElOX1VQREFURSAtLSBpbiB0aGUKQEAgLTEzNDAsOSArMTM0
MCwxMCBAQCBzdGF0aWMgaW50IGlndF9wcGd0dF9waW5fdXBkYXRlKHZvaWQgKmFyZykKIAkgKiBo
dWdlLWd0dC1wYWdlcy4KIAkgKi8KIAotCWlmICghdm0gfHwgIWk5MTVfdm1faXNfNGx2bCh2bSkp
IHsKKwl2bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOworCWlmICghaTkxNV92
bV9pc180bHZsKHZtKSkgewogCQlwcl9pbmZvKCI0OGIgUFBHVFQgbm90IHN1cHBvcnRlZCwgc2tp
cHBpbmdcbiIpOwotCQlyZXR1cm4gMDsKKwkJZ290byBvdXRfdm07CiAJfQogCiAJZmlyc3QgPSBp
bG9nMihJOTE1X0dUVF9QQUdFX1NJWkVfNjRLKTsKQEAgLTE0NTEsNiArMTQ1Miw4IEBAIHN0YXRp
YyBpbnQgaWd0X3BwZ3R0X3Bpbl91cGRhdGUodm9pZCAqYXJnKQogCWk5MTVfdm1hX2Nsb3NlKHZt
YSk7CiBvdXRfcHV0OgogCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKK291dF92bToKKwlpOTE1
X3ZtX3B1dCh2bSk7CiAKIAlyZXR1cm4gZXJyOwogfQpAQCAtMTQ2MCw3ICsxNDYzLDcgQEAgc3Rh
dGljIGludCBpZ3RfdG1wZnNfZmFsbGJhY2sodm9pZCAqYXJnKQogCXN0cnVjdCBpOTE1X2dlbV9j
b250ZXh0ICpjdHggPSBhcmc7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBjdHgt
Pmk5MTU7CiAJc3RydWN0IHZmc21vdW50ICpnZW1mcyA9IGk5MTUtPm1tLmdlbWZzOwotCXN0cnVj
dCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gY3R4LT52bSA/OiAmaTkxNS0+Z2d0dC52bTsKKwlz
dHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3Jj
dShjdHgpOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJc3RydWN0IGk5MTVf
dm1hICp2bWE7CiAJdTMyICp2YWRkcjsKQEAgLTE1MTAsNiArMTUxMyw3IEBAIHN0YXRpYyBpbnQg
aWd0X3RtcGZzX2ZhbGxiYWNrKHZvaWQgKmFyZykKIG91dF9yZXN0b3JlOgogCWk5MTUtPm1tLmdl
bWZzID0gZ2VtZnM7CiAKKwlpOTE1X3ZtX3B1dCh2bSk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAt
MTUxNywxNCArMTUyMSwxNCBAQCBzdGF0aWMgaW50IGlndF9zaHJpbmtfdGhwKHZvaWQgKmFyZykK
IHsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4ID0gYXJnOwogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gY3R4LT5pOTE1OwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ug
KnZtID0gY3R4LT52bSA/OiAmaTkxNS0+Z2d0dC52bTsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3Nw
YWNlICp2bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOwogCXN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJc3RydWN0IGk5MTVfZ2VtX2VuZ2luZXNfaXRlciBpdDsK
IAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJdW5z
aWduZWQgaW50IGZsYWdzID0gUElOX1VTRVI7CiAJdW5zaWduZWQgaW50IG47Ci0JaW50IGVycjsK
KwlpbnQgZXJyID0gMDsKIAogCS8qCiAJICogU2FuaXR5IGNoZWNrIHNocmlua2luZyBodWdlLXBh
Z2VkIG9iamVjdCAtLSBtYWtlIHN1cmUgbm90aGluZyBibG93cwpAQCAtMTUzMywxMiArMTUzNywx
NCBAQCBzdGF0aWMgaW50IGlndF9zaHJpbmtfdGhwKHZvaWQgKmFyZykKIAogCWlmICghaWd0X2Nh
bl9hbGxvY2F0ZV90aHAoaTkxNSkpIHsKIAkJcHJfaW5mbygibWlzc2luZyBUSFAgc3VwcG9ydCwg
c2tpcHBpbmdcbiIpOwotCQlyZXR1cm4gMDsKKwkJZ290byBvdXRfdm07CiAJfQogCiAJb2JqID0g
aTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zaG1lbShpOTE1LCBTWl8yTSk7Ci0JaWYgKElTX0VSUihv
YmopKQotCQlyZXR1cm4gUFRSX0VSUihvYmopOworCWlmIChJU19FUlIob2JqKSkgeworCQllcnIg
PSBQVFJfRVJSKG9iaik7CisJCWdvdG8gb3V0X3ZtOworCX0KIAogCXZtYSA9IGk5MTVfdm1hX2lu
c3RhbmNlKG9iaiwgdm0sIE5VTEwpOwogCWlmIChJU19FUlIodm1hKSkgewpAQCAtMTYwNyw2ICsx
NjEzLDggQEAgc3RhdGljIGludCBpZ3Rfc2hyaW5rX3RocCh2b2lkICphcmcpCiAJaTkxNV92bWFf
Y2xvc2Uodm1hKTsKIG91dF9wdXQ6CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworb3V0X3Zt
OgorCWk5MTVfdm1fcHV0KHZtKTsKIAogCXJldHVybiBlcnI7CiB9CkBAIC0xNjc1LDYgKzE2ODMs
NyBAQCBpbnQgaTkxNV9nZW1faHVnZV9wYWdlX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogCX07CiAJc3RydWN0IGRybV9maWxlICpmaWxlOwogCXN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0ICpjdHg7CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CiAJ
aW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJaW50IGVycjsKIApAQCAtMTY5OSw4ICsxNzA4LDEx
IEBAIGludCBpOTE1X2dlbV9odWdlX3BhZ2VfbGl2ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiAJCWdvdG8gb3V0X3VubG9jazsKIAl9CiAKLQlpZiAoY3R4LT52bSkK
LQkJY3R4LT52bS0+c2NydWJfNjRLID0gdHJ1ZTsKKwltdXRleF9sb2NrKCZjdHgtPm11dGV4KTsK
Kwl2bSA9IGk5MTVfZ2VtX2NvbnRleHRfdm0oY3R4KTsKKwlpZiAodm0pCisJCVdSSVRFX09OQ0Uo
dm0tPnNjcnViXzY0SywgdHJ1ZSk7CisJbXV0ZXhfdW5sb2NrKCZjdHgtPm11dGV4KTsKIAogCWVy
ciA9IGk5MTVfc3VidGVzdHModGVzdHMsIGN0eCk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXggMmZiMzFhZGEy
ZmE3Li42OWE4NmZjMWUzOWIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9z
ZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCkBAIC01MywxOSArNTMsMTcgQEAgc3RhdGlj
IGludCBsaXZlX25vcF9zd2l0Y2godm9pZCAqYXJnKQogCWlmIChJU19FUlIoZmlsZSkpCiAJCXJl
dHVybiBQVFJfRVJSKGZpbGUpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7Ci0KIAljdHggPSBrY2FsbG9jKG5jdHgsIHNpemVvZigqY3R4KSwgR0ZQX0tFUk5FTCk7CiAJ
aWYgKCFjdHgpIHsKIAkJZXJyID0gLUVOT01FTTsKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3Rv
IG91dF9maWxlOwogCX0KIAogCWZvciAobiA9IDA7IG4gPCBuY3R4OyBuKyspIHsKIAkJY3R4W25d
ID0gbGl2ZV9jb250ZXh0KGk5MTUsIGZpbGUpOwogCQlpZiAoSVNfRVJSKGN0eFtuXSkpIHsKIAkJ
CWVyciA9IFBUUl9FUlIoY3R4W25dKTsKLQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCWdvdG8gb3V0
X2ZpbGU7CiAJCX0KIAl9CiAKQEAgLTc5LDcgKzc3LDcgQEAgc3RhdGljIGludCBsaXZlX25vcF9z
d2l0Y2godm9pZCAqYXJnKQogCQkJcnEgPSBpZ3RfcmVxdWVzdF9hbGxvYyhjdHhbbl0sIGVuZ2lu
ZSk7CiAJCQlpZiAoSVNfRVJSKHJxKSkgewogCQkJCWVyciA9IFBUUl9FUlIocnEpOwotCQkJCWdv
dG8gb3V0X3VubG9jazsKKwkJCQlnb3RvIG91dF9maWxlOwogCQkJfQogCQkJaTkxNV9yZXF1ZXN0
X2FkZChycSk7CiAJCX0KQEAgLTg3LDcgKzg1LDcgQEAgc3RhdGljIGludCBsaXZlX25vcF9zd2l0
Y2godm9pZCAqYXJnKQogCQkJcHJfZXJyKCJGYWlsZWQgdG8gcG9wdWxhdGVkICVkIGNvbnRleHRz
XG4iLCBuY3R4KTsKIAkJCWludGVsX2d0X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKIAkJCWVyciA9
IC1FSU87Ci0JCQlnb3RvIG91dF91bmxvY2s7CisJCQlnb3RvIG91dF9maWxlOwogCQl9CiAKIAkJ
dGltZXNbMV0gPSBrdGltZV9nZXRfcmF3KCk7CkBAIC05Nyw3ICs5NSw3IEBAIHN0YXRpYyBpbnQg
bGl2ZV9ub3Bfc3dpdGNoKHZvaWQgKmFyZykKIAogCQllcnIgPSBpZ3RfbGl2ZV90ZXN0X2JlZ2lu
KCZ0LCBpOTE1LCBfX2Z1bmNfXywgZW5naW5lLT5uYW1lKTsKIAkJaWYgKGVycikKLQkJCWdvdG8g
b3V0X3VubG9jazsKKwkJCWdvdG8gb3V0X2ZpbGU7CiAKIAkJZW5kX3RpbWUgPSBqaWZmaWVzICsg
aTkxNV9zZWxmdGVzdC50aW1lb3V0X2ppZmZpZXM7CiAJCWZvcl9lYWNoX3ByaW1lX251bWJlcl9m
cm9tKHByaW1lLCAyLCA4MTkyKSB7CkBAIC0xMDcsNyArMTA1LDcgQEAgc3RhdGljIGludCBsaXZl
X25vcF9zd2l0Y2godm9pZCAqYXJnKQogCQkJCXJxID0gaWd0X3JlcXVlc3RfYWxsb2MoY3R4W24g
JSBuY3R4XSwgZW5naW5lKTsKIAkJCQlpZiAoSVNfRVJSKHJxKSkgewogCQkJCQllcnIgPSBQVFJf
RVJSKHJxKTsKLQkJCQkJZ290byBvdXRfdW5sb2NrOworCQkJCQlnb3RvIG91dF9maWxlOwogCQkJ
CX0KIAogCQkJCS8qCkBAIC0xNDMsNyArMTQxLDcgQEAgc3RhdGljIGludCBsaXZlX25vcF9zd2l0
Y2godm9pZCAqYXJnKQogCiAJCWVyciA9IGlndF9saXZlX3Rlc3RfZW5kKCZ0KTsKIAkJaWYgKGVy
cikKLQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCWdvdG8gb3V0X2ZpbGU7CiAKIAkJcHJfaW5mbygi
U3dpdGNoIGxhdGVuY2llcyBvbiAlczogMSA9ICVsbHVucywgJWx1ID0gJWxsdW5zXG4iLAogCQkJ
ZW5naW5lLT5uYW1lLApAQCAtMTUxLDggKzE0OSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9ub3Bfc3dp
dGNoKHZvaWQgKmFyZykKIAkJCXByaW1lIC0gMSwgZGl2NjRfdTY0KGt0aW1lX3RvX25zKHRpbWVz
WzFdKSwgcHJpbWUgLSAxKSk7CiAJfQogCi1vdXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7CitvdXRfZmlsZToKIAltb2NrX2ZpbGVfZnJlZShpOTE1LCBm
aWxlKTsKIAlyZXR1cm4gZXJyOwogfQpAQCAtMjUzLDEyICsyNTAsMTAgQEAgc3RhdGljIGludCBs
aXZlX3BhcmFsbGVsX3N3aXRjaCh2b2lkICphcmcpCiAJaWYgKElTX0VSUihmaWxlKSkKIAkJcmV0
dXJuIFBUUl9FUlIoZmlsZSk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKLQogCWN0eCA9IGxpdmVfY29udGV4dChpOTE1LCBmaWxlKTsKIAlpZiAoSVNfRVJSKGN0eCkp
IHsKIAkJZXJyID0gUFRSX0VSUihjdHgpOwotCQlnb3RvIG91dF9sb2NrZWQ7CisJCWdvdG8gb3V0
X2ZpbGU7CiAJfQogCiAJZW5naW5lcyA9IGk5MTVfZ2VtX2NvbnRleHRfbG9ja19lbmdpbmVzKGN0
eCk7CkBAIC0yNjgsNyArMjYzLDcgQEAgc3RhdGljIGludCBsaXZlX3BhcmFsbGVsX3N3aXRjaCh2
b2lkICphcmcpCiAJaWYgKCFkYXRhKSB7CiAJCWk5MTVfZ2VtX2NvbnRleHRfdW5sb2NrX2VuZ2lu
ZXMoY3R4KTsKIAkJZXJyID0gLUVOT01FTTsKLQkJZ290byBvdXRfbG9ja2VkOworCQlnb3RvIG91
dDsKIAl9CiAKIAltID0gMDsgLyogVXNlIHRoZSBmaXJzdCBjb250ZXh0IGFzIG91ciB0ZW1wbGF0
ZSBmb3IgdGhlIGVuZ2luZXMgKi8KQEAgLTI3Niw3ICsyNzEsNyBAQCBzdGF0aWMgaW50IGxpdmVf
cGFyYWxsZWxfc3dpdGNoKHZvaWQgKmFyZykKIAkJZXJyID0gaW50ZWxfY29udGV4dF9waW4oY2Up
OwogCQlpZiAoZXJyKSB7CiAJCQlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19lbmdpbmVzKGN0eCk7
Ci0JCQlnb3RvIG91dF9sb2NrZWQ7CisJCQlnb3RvIG91dDsKIAkJfQogCQlkYXRhW20rK10uY2Vb
MF0gPSBpbnRlbF9jb250ZXh0X2dldChjZSk7CiAJfQpAQCAtMjg3LDcgKzI4Miw3IEBAIHN0YXRp
YyBpbnQgbGl2ZV9wYXJhbGxlbF9zd2l0Y2godm9pZCAqYXJnKQogCQljdHggPSBsaXZlX2NvbnRl
eHQoaTkxNSwgZmlsZSk7CiAJCWlmIChJU19FUlIoY3R4KSkgewogCQkJZXJyID0gUFRSX0VSUihj
dHgpOwotCQkJZ290byBvdXRfbG9ja2VkOworCQkJZ290byBvdXQ7CiAJCX0KIAogCQlmb3IgKG0g
PSAwOyBtIDwgY291bnQ7IG0rKykgewpAQCAtMjk2LDIwICsyOTEsMTggQEAgc3RhdGljIGludCBs
aXZlX3BhcmFsbGVsX3N3aXRjaCh2b2lkICphcmcpCiAKIAkJCWNlID0gaW50ZWxfY29udGV4dF9j
cmVhdGUoY3R4LCBkYXRhW21dLmNlWzBdLT5lbmdpbmUpOwogCQkJaWYgKElTX0VSUihjZSkpCi0J
CQkJZ290byBvdXRfbG9ja2VkOworCQkJCWdvdG8gb3V0OwogCiAJCQllcnIgPSBpbnRlbF9jb250
ZXh0X3BpbihjZSk7CiAJCQlpZiAoZXJyKSB7CiAJCQkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwot
CQkJCWdvdG8gb3V0X2xvY2tlZDsKKwkJCQlnb3RvIG91dDsKIAkJCX0KIAogCQkJZGF0YVttXS5j
ZVtuXSA9IGNlOwogCQl9CiAJfQogCi0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKLQogCWZvciAoZm4gPSBmdW5jOyAhZXJyICYmICpmbjsgZm4rKykgewogCQlzdHJ1Y3Qg
aWd0X2xpdmVfdGVzdCB0OwogCQlpbnQgbjsKQEAgLTM1NCw4ICszNDcsNyBAQCBzdGF0aWMgaW50
IGxpdmVfcGFyYWxsZWxfc3dpdGNoKHZvaWQgKmFyZykKIAkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKIAl9CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKLW91dF9sb2NrZWQ6CitvdXQ6CiAJZm9yIChuID0gMDsgbiA8IGNvdW50OyBuKyspIHsK
IAkJZm9yIChtID0gMDsgbSA8IEFSUkFZX1NJWkUoZGF0YS0+Y2UpOyBtKyspIHsKIAkJCWlmICgh
ZGF0YVtuXS5jZVttXSkKQEAgLTM2NSw4ICszNTcsOCBAQCBzdGF0aWMgaW50IGxpdmVfcGFyYWxs
ZWxfc3dpdGNoKHZvaWQgKmFyZykKIAkJCWludGVsX2NvbnRleHRfcHV0KGRhdGFbbl0uY2VbbV0p
OwogCQl9CiAJfQotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJa2Zy
ZWUoZGF0YSk7CitvdXRfZmlsZToKIAltb2NrX2ZpbGVfZnJlZShpOTE1LCBmaWxlKTsKIAlyZXR1
cm4gZXJyOwogfQpAQCAtNjI2LDExICs2MTgsOSBAQCBzdGF0aWMgaW50IGlndF9jdHhfZXhlYyh2
b2lkICphcmcpCiAJCWlmIChJU19FUlIoZmlsZSkpCiAJCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsK
IAotCQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCQllcnIgPSBpZ3Rf
bGl2ZV90ZXN0X2JlZ2luKCZ0LCBpOTE1LCBfX2Z1bmNfXywgZW5naW5lLT5uYW1lKTsKIAkJaWYg
KGVycikKLQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCWdvdG8gb3V0X2ZpbGU7CiAKIAkJbmNvbnRl
eHRzID0gMDsKIAkJbmR3b3JkcyA9IDA7CkBAIC02NDIsNyArNjMyLDcgQEAgc3RhdGljIGludCBp
Z3RfY3R4X2V4ZWModm9pZCAqYXJnKQogCQkJY3R4ID0ga2VybmVsX2NvbnRleHQoaTkxNSk7CiAJ
CQlpZiAoSVNfRVJSKGN0eCkpIHsKIAkJCQllcnIgPSBQVFJfRVJSKGN0eCk7Ci0JCQkJZ290byBv
dXRfdW5sb2NrOworCQkJCWdvdG8gb3V0X2ZpbGU7CiAJCQl9CiAKIAkJCWNlID0gaTkxNV9nZW1f
Y29udGV4dF9nZXRfZW5naW5lKGN0eCwgZW5naW5lLT5sZWdhY3lfaWR4KTsKQEAgLTY1NCw3ICs2
NDQsNyBAQCBzdGF0aWMgaW50IGlndF9jdHhfZXhlYyh2b2lkICphcmcpCiAJCQkJCWVyciA9IFBU
Ul9FUlIob2JqKTsKIAkJCQkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwogCQkJCQlrZXJuZWxfY29u
dGV4dF9jbG9zZShjdHgpOwotCQkJCQlnb3RvIG91dF91bmxvY2s7CisJCQkJCWdvdG8gb3V0X2Zp
bGU7CiAJCQkJfQogCQkJfQogCkBAIC02NjMsMTcgKzY1MywxOCBAQCBzdGF0aWMgaW50IGlndF9j
dHhfZXhlYyh2b2lkICphcmcpCiAJCQkJcHJfZXJyKCJGYWlsZWQgdG8gZmlsbCBkd29yZCAlbHUg
WyVsdS8lbHVdIHdpdGggZ3B1ICglcykgW2Z1bGwtcHBndHQ/ICVzXSwgZXJyPSVkXG4iLAogCQkJ
CSAgICAgICBuZHdvcmRzLCBkdywgbWF4X2R3b3JkcyhvYmopLAogCQkJCSAgICAgICBlbmdpbmUt
Pm5hbWUsCi0JCQkJICAgICAgIHllc25vKCEhY3R4LT52bSksIGVycik7CisJCQkJICAgICAgIHll
c25vKCEhcmN1X2FjY2Vzc19wb2ludGVyKGN0eC0+dm0pKSwKKwkJCQkgICAgICAgZXJyKTsKIAkJ
CQlpbnRlbF9jb250ZXh0X3B1dChjZSk7CiAJCQkJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsK
LQkJCQlnb3RvIG91dF91bmxvY2s7CisJCQkJZ290byBvdXRfZmlsZTsKIAkJCX0KIAogCQkJZXJy
ID0gdGhyb3R0bGUoY2UsIHRxLCBBUlJBWV9TSVpFKHRxKSk7CiAJCQlpZiAoZXJyKSB7CiAJCQkJ
aW50ZWxfY29udGV4dF9wdXQoY2UpOwogCQkJCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7Ci0J
CQkJZ290byBvdXRfdW5sb2NrOworCQkJCWdvdG8gb3V0X2ZpbGU7CiAJCQl9CiAKIAkJCWlmICgr
K2R3ID09IG1heF9kd29yZHMob2JqKSkgewpAQCAtNzAzLDExICs2OTQsMTAgQEAgc3RhdGljIGlu
dCBpZ3RfY3R4X2V4ZWModm9pZCAqYXJnKQogCQkJZHcgKz0gcmVtOwogCQl9CiAKLW91dF91bmxv
Y2s6CitvdXRfZmlsZToKIAkJdGhyb3R0bGVfcmVsZWFzZSh0cSwgQVJSQVlfU0laRSh0cSkpOwog
CQlpZiAoaWd0X2xpdmVfdGVzdF9lbmQoJnQpKQogCQkJZXJyID0gLUVJTzsKLQkJbXV0ZXhfdW5s
b2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCQltb2NrX2ZpbGVfZnJlZShpOTE1LCBm
aWxlKTsKIAkJaWYgKGVycikKQEAgLTc0MiwyMiArNzMyLDIwIEBAIHN0YXRpYyBpbnQgaWd0X3No
YXJlZF9jdHhfZXhlYyh2b2lkICphcmcpCiAJaWYgKElTX0VSUihmaWxlKSkKIAkJcmV0dXJuIFBU
Ul9FUlIoZmlsZSk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQog
CXBhcmVudCA9IGxpdmVfY29udGV4dChpOTE1LCBmaWxlKTsKIAlpZiAoSVNfRVJSKHBhcmVudCkp
IHsKIAkJZXJyID0gUFRSX0VSUihwYXJlbnQpOwotCQlnb3RvIG91dF91bmxvY2s7CisJCWdvdG8g
b3V0X2ZpbGU7CiAJfQogCiAJaWYgKCFwYXJlbnQtPnZtKSB7IC8qIG5vdCBmdWxsLXBwZ3R0OyBu
b3RoaW5nIHRvIHNoYXJlICovCiAJCWVyciA9IDA7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290
byBvdXRfZmlsZTsKIAl9CiAKIAllcnIgPSBpZ3RfbGl2ZV90ZXN0X2JlZ2luKCZ0LCBpOTE1LCBf
X2Z1bmNfXywgIiIpOwogCWlmIChlcnIpCi0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290byBvdXRf
ZmlsZTsKIAogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7CiAJCXVuc2lnbmVk
IGxvbmcgbmNvbnRleHRzLCBuZHdvcmRzLCBkdzsKQEAgLTgwMSw3ICs3ODksOCBAQCBzdGF0aWMg
aW50IGlndF9zaGFyZWRfY3R4X2V4ZWModm9pZCAqYXJnKQogCQkJCXByX2VycigiRmFpbGVkIHRv
IGZpbGwgZHdvcmQgJWx1IFslbHUvJWx1XSB3aXRoIGdwdSAoJXMpIFtmdWxsLXBwZ3R0PyAlc10s
IGVycj0lZFxuIiwKIAkJCQkgICAgICAgbmR3b3JkcywgZHcsIG1heF9kd29yZHMob2JqKSwKIAkJ
CQkgICAgICAgZW5naW5lLT5uYW1lLAotCQkJCSAgICAgICB5ZXNubyghIWN0eC0+dm0pLCBlcnIp
OworCQkJCSAgICAgICB5ZXNubyghIXJjdV9hY2Nlc3NfcG9pbnRlcihjdHgtPnZtKSksCisJCQkJ
ICAgICAgIGVycik7CiAJCQkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwogCQkJCWtlcm5lbF9jb250
ZXh0X2Nsb3NlKGN0eCk7CiAJCQkJZ290byBvdXRfdGVzdDsKQEAgLTg0MCwxNyArODI5LDEzIEBA
IHN0YXRpYyBpbnQgaWd0X3NoYXJlZF9jdHhfZXhlYyh2b2lkICphcmcpCiAJCQlkdyArPSByZW07
CiAJCX0KIAotCQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQlpOTE1
X2dlbV9kcmFpbl9mcmVlZF9vYmplY3RzKGk5MTUpOwotCQltdXRleF9sb2NrKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIAl9CiBvdXRfdGVzdDoKIAl0aHJvdHRsZV9yZWxlYXNlKHRxLCBBUlJB
WV9TSVpFKHRxKSk7CiAJaWYgKGlndF9saXZlX3Rlc3RfZW5kKCZ0KSkKIAkJZXJyID0gLUVJTzsK
LW91dF91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQor
b3V0X2ZpbGU6CiAJbW9ja19maWxlX2ZyZWUoaTkxNSwgZmlsZSk7CiAJcmV0dXJuIGVycjsKIH0K
QEAgLTEyMjIsOCArMTIwNyw2IEBAIF9faWd0X2N0eF9zc2V1KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAogCWlmIChmbGFncyAmIFRFU1RfUkVTRVQpCiAJCWlndF9nbG9iYWxfcmVzZXRf
bG9jaygmaTkxNS0+Z3QpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
Ci0KIAljdHggPSBsaXZlX2NvbnRleHQoaTkxNSwgZmlsZSk7CiAJaWYgKElTX0VSUihjdHgpKSB7
CiAJCXJldCA9IFBUUl9FUlIoY3R4KTsKQEAgLTEyNzgsOCArMTI2MSw2IEBAIF9faWd0X2N0eF9z
c2V1KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCWk5MTVfZ2VtX29iamVjdF9wdXQo
b2JqKTsKIAogb3V0X3VubG9jazoKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwotCiAJaWYgKGZsYWdzICYgVEVTVF9SRVNFVCkKIAkJaWd0X2dsb2JhbF9yZXNldF91bmxv
Y2soJmk5MTUtPmd0KTsKIApAQCAtMTMzOSwyMyArMTMyMCwyNCBAQCBzdGF0aWMgaW50IGlndF9j
dHhfcmVhZG9ubHkodm9pZCAqYXJnKQogCWlmIChJU19FUlIoZmlsZSkpCiAJCXJldHVybiBQVFJf
RVJSKGZpbGUpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAll
cnIgPSBpZ3RfbGl2ZV90ZXN0X2JlZ2luKCZ0LCBpOTE1LCBfX2Z1bmNfXywgIiIpOwogCWlmIChl
cnIpCi0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290byBvdXRfZmlsZTsKIAogCWN0eCA9IGxpdmVf
Y29udGV4dChpOTE1LCBmaWxlKTsKIAlpZiAoSVNfRVJSKGN0eCkpIHsKIAkJZXJyID0gUFRSX0VS
UihjdHgpOwotCQlnb3RvIG91dF91bmxvY2s7CisJCWdvdG8gb3V0X2ZpbGU7CiAJfQogCi0Jdm0g
PSBjdHgtPnZtID86ICZpOTE1LT5nZ3R0LmFsaWFzLT52bTsKKwlyY3VfcmVhZF9sb2NrKCk7CisJ
dm0gPSByY3VfZGVyZWZlcmVuY2UoY3R4LT52bSkgPzogJmk5MTUtPmdndHQuYWxpYXMtPnZtOwog
CWlmICghdm0gfHwgIXZtLT5oYXNfcmVhZF9vbmx5KSB7CisJCXJjdV9yZWFkX3VubG9jaygpOwog
CQllcnIgPSAwOwotCQlnb3RvIG91dF91bmxvY2s7CisJCWdvdG8gb3V0X2ZpbGU7CiAJfQorCXJj
dV9yZWFkX3VubG9jaygpOwogCiAJbmR3b3JkcyA9IDA7CiAJZHcgPSAwOwpAQCAtMTM3Myw3ICsx
MzU1LDcgQEAgc3RhdGljIGludCBpZ3RfY3R4X3JlYWRvbmx5KHZvaWQgKmFyZykKIAkJCQlpZiAo
SVNfRVJSKG9iaikpIHsKIAkJCQkJZXJyID0gUFRSX0VSUihvYmopOwogCQkJCQlpOTE1X2dlbV9j
b250ZXh0X3VubG9ja19lbmdpbmVzKGN0eCk7Ci0JCQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCQkJ
Z290byBvdXRfZmlsZTsKIAkJCQl9CiAKIAkJCQlpZiAocHJhbmRvbV91MzJfc3RhdGUoJnBybmcp
ICYgMSkKQEAgLTEzODQsMTUgKzEzNjYsMTcgQEAgc3RhdGljIGludCBpZ3RfY3R4X3JlYWRvbmx5
KHZvaWQgKmFyZykKIAkJCWlmIChlcnIpIHsKIAkJCQlwcl9lcnIoIkZhaWxlZCB0byBmaWxsIGR3
b3JkICVsdSBbJWx1LyVsdV0gd2l0aCBncHUgKCVzKSBbZnVsbC1wcGd0dD8gJXNdLCBlcnI9JWRc
biIsCiAJCQkJICAgICAgIG5kd29yZHMsIGR3LCBtYXhfZHdvcmRzKG9iaiksCi0JCQkJICAgICAg
IGNlLT5lbmdpbmUtPm5hbWUsIHllc25vKCEhY3R4LT52bSksIGVycik7CisJCQkJICAgICAgIGNl
LT5lbmdpbmUtPm5hbWUsCisJCQkJICAgICAgIHllc25vKCEhcmN1X2FjY2Vzc19wb2ludGVyKGN0
eC0+dm0pKSwKKwkJCQkgICAgICAgZXJyKTsKIAkJCQlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19l
bmdpbmVzKGN0eCk7Ci0JCQkJZ290byBvdXRfdW5sb2NrOworCQkJCWdvdG8gb3V0X2ZpbGU7CiAJ
CQl9CiAKIAkJCWVyciA9IHRocm90dGxlKGNlLCB0cSwgQVJSQVlfU0laRSh0cSkpOwogCQkJaWYg
KGVycikgewogCQkJCWk5MTVfZ2VtX2NvbnRleHRfdW5sb2NrX2VuZ2luZXMoY3R4KTsKLQkJCQln
b3RvIG91dF91bmxvY2s7CisJCQkJZ290byBvdXRfZmlsZTsKIAkJCX0KIAogCQkJaWYgKCsrZHcg
PT0gbWF4X2R3b3JkcyhvYmopKSB7CkBAIC0xNDI0LDIwICsxNDA4LDE5IEBAIHN0YXRpYyBpbnQg
aWd0X2N0eF9yZWFkb25seSh2b2lkICphcmcpCiAJCWR3ICs9IHJlbTsKIAl9CiAKLW91dF91bmxv
Y2s6CitvdXRfZmlsZToKIAl0aHJvdHRsZV9yZWxlYXNlKHRxLCBBUlJBWV9TSVpFKHRxKSk7CiAJ
aWYgKGlndF9saXZlX3Rlc3RfZW5kKCZ0KSkKIAkJZXJyID0gLUVJTzsKLQltdXRleF91bmxvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJbW9ja19maWxlX2ZyZWUoaTkxNSwgZmlsZSk7
CiAJcmV0dXJuIGVycjsKIH0KIAotc3RhdGljIGludCBjaGVja19zY3JhdGNoKHN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICpjdHgsIHU2NCBvZmZzZXQpCitzdGF0aWMgaW50IGNoZWNrX3NjcmF0Y2go
c3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sIHU2NCBvZmZzZXQpCiB7CiAJc3RydWN0IGRy
bV9tbV9ub2RlICpub2RlID0KLQkJX19kcm1fbW1faW50ZXJ2YWxfZmlyc3QoJmN0eC0+dm0tPm1t
LAorCQlfX2RybV9tbV9pbnRlcnZhbF9maXJzdCgmdm0tPm1tLAogCQkJCQlvZmZzZXQsIG9mZnNl
dCArIHNpemVvZih1MzIpIC0gMSk7CiAJaWYgKCFub2RlIHx8IG5vZGUtPnN0YXJ0ID4gb2Zmc2V0
KQogCQlyZXR1cm4gMDsKQEAgLTE0NTUsNiArMTQzOCw3IEBAIHN0YXRpYyBpbnQgd3JpdGVfdG9f
c2NyYXRjaChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogewogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gY3R4LT5pOTE1OwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmo7CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CiAJc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnE7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJdTMyICpjbWQ7CkBAIC0xNDg3LDE3
ICsxNDcxLDE4IEBAIHN0YXRpYyBpbnQgd3JpdGVfdG9fc2NyYXRjaChzdHJ1Y3QgaTkxNV9nZW1f
Y29udGV4dCAqY3R4LAogCiAJaW50ZWxfZ3RfY2hpcHNldF9mbHVzaChlbmdpbmUtPmd0KTsKIAot
CXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgY3R4LT52bSwgTlVMTCk7CisJdm0gPSBpOTE1
X2dlbV9jb250ZXh0X2dldF92bV9yY3UoY3R4KTsKKwl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShv
YmosIHZtLCBOVUxMKTsKIAlpZiAoSVNfRVJSKHZtYSkpIHsKIAkJZXJyID0gUFRSX0VSUih2bWEp
OwotCQlnb3RvIGVycjsKKwkJZ290byBlcnJfdm07CiAJfQogCiAJZXJyID0gaTkxNV92bWFfcGlu
KHZtYSwgMCwgMCwgUElOX1VTRVIgfCBQSU5fT0ZGU0VUX0ZJWEVEKTsKIAlpZiAoZXJyKQotCQln
b3RvIGVycjsKKwkJZ290byBlcnJfdm07CiAKLQllcnIgPSBjaGVja19zY3JhdGNoKGN0eCwgb2Zm
c2V0KTsKKwllcnIgPSBjaGVja19zY3JhdGNoKHZtLCBvZmZzZXQpOwogCWlmIChlcnIpCiAJCWdv
dG8gZXJyX3VucGluOwogCkBAIC0xNTIzLDYgKzE1MDgsNyBAQCBzdGF0aWMgaW50IHdyaXRlX3Rv
X3NjcmF0Y2goc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAogCWk5MTVfcmVxdWVzdF9h
ZGQocnEpOwogCisJaTkxNV92bV9wdXQodm0pOwogCXJldHVybiAwOwogCiBza2lwX3JlcXVlc3Q6
CkBAIC0xNTMxLDYgKzE1MTcsOCBAQCBzdGF0aWMgaW50IHdyaXRlX3RvX3NjcmF0Y2goc3RydWN0
IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKIGVycl91bnBp
bjoKIAlpOTE1X3ZtYV91bnBpbih2bWEpOworZXJyX3ZtOgorCWk5MTVfdm1fcHV0KHZtKTsKIGVy
cjoKIAlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CiAJcmV0dXJuIGVycjsKQEAgLTE1NDIsNiAr
MTUzMCw3IEBAIHN0YXRpYyBpbnQgcmVhZF9mcm9tX3NjcmF0Y2goc3RydWN0IGk5MTVfZ2VtX2Nv
bnRleHQgKmN0eCwKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGN0eC0+aTkx
NTsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOworCXN0cnVjdCBpOTE1X2FkZHJl
c3Nfc3BhY2UgKnZtOwogCWNvbnN0IHUzMiBSQ1NfR1BSMCA9IDB4MjYwMDsgLyogbm90IGFsbCBl
bmdpbmVzIGhhdmUgdGhlaXIgb3duIEdQUiEgKi8KIAljb25zdCB1MzIgcmVzdWx0ID0gMHgxMDA7
CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CkBAIC0xNTg2LDE3ICsxNTc1LDE4IEBAIHN0YXRp
YyBpbnQgcmVhZF9mcm9tX3NjcmF0Y2goc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAog
CWludGVsX2d0X2NoaXBzZXRfZmx1c2goZW5naW5lLT5ndCk7CiAKLQl2bWEgPSBpOTE1X3ZtYV9p
bnN0YW5jZShvYmosIGN0eC0+dm0sIE5VTEwpOworCXZtID0gaTkxNV9nZW1fY29udGV4dF9nZXRf
dm1fcmN1KGN0eCk7CisJdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCB2bSwgTlVMTCk7CiAJ
aWYgKElTX0VSUih2bWEpKSB7CiAJCWVyciA9IFBUUl9FUlIodm1hKTsKLQkJZ290byBlcnI7CisJ
CWdvdG8gZXJyX3ZtOwogCX0KIAogCWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIFBJTl9V
U0VSIHwgUElOX09GRlNFVF9GSVhFRCk7CiAJaWYgKGVycikKLQkJZ290byBlcnI7CisJCWdvdG8g
ZXJyX3ZtOwogCi0JZXJyID0gY2hlY2tfc2NyYXRjaChjdHgsIG9mZnNldCk7CisJZXJyID0gY2hl
Y2tfc2NyYXRjaCh2bSwgb2Zmc2V0KTsKIAlpZiAoZXJyKQogCQlnb3RvIGVycl91bnBpbjsKIApA
QCAtMTYyNywxMiArMTYxNywxMiBAQCBzdGF0aWMgaW50IHJlYWRfZnJvbV9zY3JhdGNoKHN0cnVj
dCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3NldF90b19j
cHVfZG9tYWluKG9iaiwgZmFsc2UpOwogCWk5MTVfZ2VtX29iamVjdF91bmxvY2sob2JqKTsKIAlp
ZiAoZXJyKQotCQlnb3RvIGVycjsKKwkJZ290byBlcnJfdm07CiAKIAljbWQgPSBpOTE1X2dlbV9v
YmplY3RfcGluX21hcChvYmosIEk5MTVfTUFQX1dCKTsKIAlpZiAoSVNfRVJSKGNtZCkpIHsKIAkJ
ZXJyID0gUFRSX0VSUihjbWQpOwotCQlnb3RvIGVycjsKKwkJZ290byBlcnJfdm07CiAJfQogCiAJ
KnZhbHVlID0gY21kW3Jlc3VsdCAvIHNpemVvZigqY21kKV07CkBAIC0xNjQ3LDYgKzE2MzcsOCBA
QCBzdGF0aWMgaW50IHJlYWRfZnJvbV9zY3JhdGNoKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpj
dHgsCiAJaTkxNV9yZXF1ZXN0X2FkZChycSk7CiBlcnJfdW5waW46CiAJaTkxNV92bWFfdW5waW4o
dm1hKTsKK2Vycl92bToKKwlpOTE1X3ZtX3B1dCh2bSk7CiBlcnI6CiAJaTkxNV9nZW1fb2JqZWN0
X3B1dChvYmopOwogCXJldHVybiBlcnI7CkBAIC0xNjc3LDI3ICsxNjY5LDI1IEBAIHN0YXRpYyBp
bnQgaWd0X3ZtX2lzb2xhdGlvbih2b2lkICphcmcpCiAJaWYgKElTX0VSUihmaWxlKSkKIAkJcmV0
dXJuIFBUUl9FUlIoZmlsZSk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKLQogCWVyciA9IGlndF9saXZlX3Rlc3RfYmVnaW4oJnQsIGk5MTUsIF9fZnVuY19fLCAiIik7
CiAJaWYgKGVycikKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3RvIG91dF9maWxlOwogCiAJY3R4
X2EgPSBsaXZlX2NvbnRleHQoaTkxNSwgZmlsZSk7CiAJaWYgKElTX0VSUihjdHhfYSkpIHsKIAkJ
ZXJyID0gUFRSX0VSUihjdHhfYSk7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290byBvdXRfZmls
ZTsKIAl9CiAKIAljdHhfYiA9IGxpdmVfY29udGV4dChpOTE1LCBmaWxlKTsKIAlpZiAoSVNfRVJS
KGN0eF9iKSkgewogCQllcnIgPSBQVFJfRVJSKGN0eF9iKTsKLQkJZ290byBvdXRfdW5sb2NrOwor
CQlnb3RvIG91dF9maWxlOwogCX0KIAogCS8qIFdlIGNhbiBvbmx5IHRlc3Qgdm0gaXNvbGF0aW9u
LCBpZiB0aGUgdm0gYXJlIGRpc3RpbmN0ICovCiAJaWYgKGN0eF9hLT52bSA9PSBjdHhfYi0+dm0p
Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290byBvdXRfZmlsZTsKIAogCXZtX3RvdGFsID0gY3R4
X2EtPnZtLT50b3RhbDsKIAlHRU1fQlVHX09OKGN0eF9iLT52bS0+dG90YWwgIT0gdm1fdG90YWwp
OwpAQCAtMTcyNiw3ICsxNzE2LDcgQEAgc3RhdGljIGludCBpZ3Rfdm1faXNvbGF0aW9uKHZvaWQg
KmFyZykKIAkJCQllcnIgPSByZWFkX2Zyb21fc2NyYXRjaChjdHhfYiwgZW5naW5lLAogCQkJCQkJ
CW9mZnNldCwgJnZhbHVlKTsKIAkJCWlmIChlcnIpCi0JCQkJZ290byBvdXRfdW5sb2NrOworCQkJ
CWdvdG8gb3V0X2ZpbGU7CiAKIAkJCWlmICh2YWx1ZSkgewogCQkJCXByX2VycigiJXM6IFJlYWQg
JTA4eCBmcm9tIHNjcmF0Y2ggKG9mZnNldCAweCUwOHhfJTA4eCksIGFmdGVyICVsdSByZWFkcyFc
biIsCkBAIC0xNzM1LDcgKzE3MjUsNyBAQCBzdGF0aWMgaW50IGlndF92bV9pc29sYXRpb24odm9p
ZCAqYXJnKQogCQkJCSAgICAgICBsb3dlcl8zMl9iaXRzKG9mZnNldCksCiAJCQkJICAgICAgIHRo
aXMpOwogCQkJCWVyciA9IC1FSU5WQUw7Ci0JCQkJZ290byBvdXRfdW5sb2NrOworCQkJCWdvdG8g
b3V0X2ZpbGU7CiAJCQl9CiAKIAkJCXRoaXMrKzsKQEAgLTE3NDUsMTEgKzE3MzUsOSBAQCBzdGF0
aWMgaW50IGlndF92bV9pc29sYXRpb24odm9pZCAqYXJnKQogCXByX2luZm8oIkNoZWNrZWQgJWx1
IHNjcmF0Y2ggb2Zmc2V0cyBhY3Jvc3MgJWQgZW5naW5lc1xuIiwKIAkJY291bnQsIFJVTlRJTUVf
SU5GTyhpOTE1KS0+bnVtX2VuZ2luZXMpOwogCi1vdXRfdW5sb2NrOgorb3V0X2ZpbGU6CiAJaWYg
KGlndF9saXZlX3Rlc3RfZW5kKCZ0KSkKIAkJZXJyID0gLUVJTzsKLQltdXRleF91bmxvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJbW9ja19maWxlX2ZyZWUoaTkxNSwgZmlsZSk7CiAJ
cmV0dXJuIGVycjsKIH0KQEAgLTE3ODEsMTMgKzE3NjksOSBAQCBzdGF0aWMgaW50IG1vY2tfY29u
dGV4dF9iYXJyaWVyKHZvaWQgKmFyZykKIAkgKiBhIHJlcXVlc3Q7IHVzZWZ1bCBmb3IgcmV0aXJp
bmcgb2xkIHN0YXRlIGFmdGVyIGxvYWRpbmcgbmV3LgogCSAqLwogCi0JbXV0ZXhfbG9jaygmaTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAljdHggPSBtb2NrX2NvbnRleHQoaTkxNSwgIm1vY2si
KTsKLQlpZiAoIWN0eCkgewotCQllcnIgPSAtRU5PTUVNOwotCQlnb3RvIHVubG9jazsKLQl9CisJ
aWYgKCFjdHgpCisJCXJldHVybiAtRU5PTUVNOwogCiAJY291bnRlciA9IDA7CiAJZXJyID0gY29u
dGV4dF9iYXJyaWVyX3Rhc2soY3R4LCAwLApAQCAtMTg2MCw4ICsxODQ0LDYgQEAgc3RhdGljIGlu
dCBtb2NrX2NvbnRleHRfYmFycmllcih2b2lkICphcmcpCiAKIG91dDoKIAltb2NrX2NvbnRleHRf
Y2xvc2UoY3R4KTsKLXVubG9jazoKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwogCXJldHVybiBlcnI7CiAjdW5kZWYgcHJfZm10CiAjZGVmaW5lIHByX2ZtdCh4KSB4CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL21vY2tfY29udGV4
dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQuYwpp
bmRleCAwMTA0ZjE2YjEzMjcuLmZkNzk5ZGVmZDhiZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vc2VsZnRlc3RzL21vY2tfY29udGV4dC5jCkBAIC02NSw3ICs2NSw3IEBAIHZv
aWQgbW9ja19jb250ZXh0X2Nsb3NlKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCiAKIHZv
aWQgbW9ja19pbml0X2NvbnRleHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewot
CWluaXRfY29udGV4dHMoaTkxNSk7CisJaW5pdF9jb250ZXh0cygmaTkxNS0+Z2VtLmNvbnRleHRz
KTsKIH0KIAogc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKgpAQCAtNzQsOCArNzQsNiBAQCBsaXZl
X2NvbnRleHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHN0cnVjdCBkcm1fZmlsZSAq
ZmlsZSkKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwogCWludCBlcnI7CiAKLQlsb2Nr
ZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWN0eCA9IGk5MTVf
Z2VtX2NyZWF0ZV9jb250ZXh0KGk5MTUsIDApOwogCWlmIChJU19FUlIoY3R4KSkKIAkJcmV0dXJu
IGN0eDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYwppbmRleCAzNWE0MGMy
ODIwYTIuLmJlMzRkOTdhYzE4ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRl
eHQuYwpAQCAtMjIxLDEyICsyMjEsMjAgQEAgaW50ZWxfY29udGV4dF9pbml0KHN0cnVjdCBpbnRl
bF9jb250ZXh0ICpjZSwKIAkJICAgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJICAg
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogeworCXN0cnVjdCBpOTE1X2FkZHJlc3Nf
c3BhY2UgKnZtOworCiAJR0VNX0JVR19PTighZW5naW5lLT5jb3BzKTsKIAogCWtyZWZfaW5pdCgm
Y2UtPnJlZik7CiAKIAljZS0+Z2VtX2NvbnRleHQgPSBjdHg7Ci0JY2UtPnZtID0gaTkxNV92bV9n
ZXQoY3R4LT52bSA/OiAmZW5naW5lLT5ndC0+Z2d0dC0+dm0pOworCXJjdV9yZWFkX2xvY2soKTsK
Kwl2bSA9IHJjdV9kZXJlZmVyZW5jZShjdHgtPnZtKTsKKwlpZiAodm0pCisJCWNlLT52bSA9IGk5
MTVfdm1fZ2V0KHZtKTsKKwllbHNlCisJCWNlLT52bSA9IGk5MTVfdm1fZ2V0KCZlbmdpbmUtPmd0
LT5nZ3R0LT52bSk7CisJcmN1X3JlYWRfdW5sb2NrKCk7CiAJaWYgKGN0eC0+dGltZWxpbmUpCiAJ
CWNlLT50aW1lbGluZSA9IGludGVsX3RpbWVsaW5lX2dldChjdHgtPnRpbWVsaW5lKTsKIApkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYwppbmRleCBmYzhjOTNkZjQyMzYuLmQ2MjUzMDM4ODhj
YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKQEAgLTk4MSw2ICs5ODEsMTEgQEAg
X19leGVjbGlzdHNfc2NoZWR1bGVfaW4oc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJCWNlLT5s
cmNfZGVzYyB8PQogCQkJKHU2NCkoZW5naW5lLT5jb250ZXh0X3RhZysrICUgTlVNX0NPTlRFWFRf
VEFHKSA8PAogCQkJR0VOMTFfU1dfQ1RYX0lEX1NISUZUOworCisjZGVmaW5lIEdFTjExX01BWF9D
T05URVhUX0hXX0lEICgxPDwxMSkgLyogZXhjbHVzaXZlICovCisvKiBpbiBHZW4xMiBJRCAweDdG
RiBpcyByZXNlcnZlZCB0byBpbmRpY2F0ZSBpZGxlICovCisjZGVmaW5lIEdFTjEyX01BWF9DT05U
RVhUX0hXX0lEICAgICAgICAoR0VOMTFfTUFYX0NPTlRFWFRfSFdfSUQgLSAxKQorCiAJCUJVSUxE
X0JVR19PTihOVU1fQ09OVEVYVF9UQUcgPiBHRU4xMl9NQVhfQ09OVEVYVF9IV19JRCk7CiAJfQog
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKaW5kZXggODZjZmZi
YjBhOWNiLi43YzgzOGE1N2UxNzQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3NlbGZ0ZXN0X2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVz
dF9jb250ZXh0LmMKQEAgLTE1NSwxMyArMTU1LDkgQEAgc3RhdGljIGludCBsaXZlX2NvbnRleHRf
c2l6ZSh2b2lkICphcmcpCiAJICogSFcgdHJpZXMgdG8gd3JpdGUgcGFzdCB0aGUgZW5kIG9mIG9u
ZS4KIAkgKi8KIAotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQog
CWZpeG1lID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOwotCWlmIChJU19FUlIoZml4bWUpKSB7
Ci0JCWVyciA9IFBUUl9FUlIoZml4bWUpOwotCQlnb3RvIHVubG9jazsKLQl9CisJaWYgKElTX0VS
UihmaXhtZSkpCisJCXJldHVybiBQVFJfRVJSKGZpeG1lKTsKIAogCWZvcl9lYWNoX2VuZ2luZShl
bmdpbmUsIGd0LT5pOTE1LCBpZCkgewogCQlzdHJ1Y3QgewpAQCAtMjAxLDggKzE5Nyw2IEBAIHN0
YXRpYyBpbnQgbGl2ZV9jb250ZXh0X3NpemUodm9pZCAqYXJnKQogCX0KIAogCWtlcm5lbF9jb250
ZXh0X2Nsb3NlKGZpeG1lKTsKLXVubG9jazoKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIAlyZXR1cm4gZXJyOwogfQogCkBAIC0zMDUsMTIgKzI5OSwxMCBAQCBz
dGF0aWMgaW50IGxpdmVfYWN0aXZlX2NvbnRleHQodm9pZCAqYXJnKQogCWlmIChJU19FUlIoZmls
ZSkpCiAJCXJldHVybiBQVFJfRVJSKGZpbGUpOwogCi0JbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwotCiAJZml4bWUgPSBsaXZlX2NvbnRleHQoZ3QtPmk5MTUsIGZpbGUp
OwogCWlmIChJU19FUlIoZml4bWUpKSB7CiAJCWVyciA9IFBUUl9FUlIoZml4bWUpOwotCQlnb3Rv
IHVubG9jazsKKwkJZ290byBvdXRfZmlsZTsKIAl9CiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5l
LCBndC0+aTkxNSwgaWQpIHsKQEAgLTMyMyw4ICszMTUsNyBAQCBzdGF0aWMgaW50IGxpdmVfYWN0
aXZlX2NvbnRleHQodm9pZCAqYXJnKQogCQkJYnJlYWs7CiAJfQogCi11bmxvY2s6Ci0JbXV0ZXhf
dW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CitvdXRfZmlsZToKIAltb2NrX2Zp
bGVfZnJlZShndC0+aTkxNSwgZmlsZSk7CiAJcmV0dXJuIGVycjsKIH0KQEAgLTQxOCwxMiArNDA5
LDEwIEBAIHN0YXRpYyBpbnQgbGl2ZV9yZW1vdGVfY29udGV4dCh2b2lkICphcmcpCiAJaWYgKElT
X0VSUihmaWxlKSkKIAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAKLQltdXRleF9sb2NrKCZndC0+
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlmaXhtZSA9IGxpdmVfY29udGV4dChndC0+aTkx
NSwgZmlsZSk7CiAJaWYgKElTX0VSUihmaXhtZSkpIHsKIAkJZXJyID0gUFRSX0VSUihmaXhtZSk7
Ci0JCWdvdG8gdW5sb2NrOworCQlnb3RvIG91dF9maWxlOwogCX0KIAogCWZvcl9lYWNoX2VuZ2lu
ZShlbmdpbmUsIGd0LT5pOTE1LCBpZCkgewpAQCAtNDM2LDggKzQyNSw3IEBAIHN0YXRpYyBpbnQg
bGl2ZV9yZW1vdGVfY29udGV4dCh2b2lkICphcmcpCiAJCQlicmVhazsKIAl9CiAKLXVubG9jazoK
LQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKK291dF9maWxlOgog
CW1vY2tfZmlsZV9mcmVlKGd0LT5pOTE1LCBmaWxlKTsKIAlyZXR1cm4gZXJyOwogfQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYwppbmRleCBmZmJiM2QyM2I4
ODcuLmU4YTQwZGY3OWJkMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfaGFuZ2NoZWNrLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
aGFuZ2NoZWNrLmMKQEAgLTU4LDkgKzU4LDcgQEAgc3RhdGljIGludCBoYW5nX2luaXQoc3RydWN0
IGhhbmcgKmgsIHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAJbWVtc2V0KGgsIDAsIHNpemVvZigqaCkp
OwogCWgtPmd0ID0gZ3Q7CiAKLQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAJaC0+Y3R4ID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOwotCW11dGV4X3VubG9jaygm
Z3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChJU19FUlIoaC0+Y3R4KSkKIAkJcmV0
dXJuIFBUUl9FUlIoaC0+Y3R4KTsKIApAQCAtMTMzLDcgKzEzMSw3IEBAIHN0YXRpYyBzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICoKIGhhbmdfY3JlYXRlX3JlcXVlc3Qoc3RydWN0IGhhbmcgKmgsIHN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gaC0+
Z3Q7Ci0Jc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSBoLT5jdHgtPnZtID86ICZlbmdp
bmUtPmd0LT5nZ3R0LT52bTsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IGk5MTVf
Z2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShoLT5jdHgpOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmo7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEgPSBOVUxMOwogCXN0cnVjdCBpOTE1
X3ZtYSAqaHdzLCAqdm1hOwpAQCAtMTQzLDEyICsxNDEsMTUgQEAgaGFuZ19jcmVhdGVfcmVxdWVz
dChzdHJ1Y3QgaGFuZyAqaCwgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCWludCBl
cnI7CiAKIAlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGd0LT5pOTE1LCBQ
QUdFX1NJWkUpOwotCWlmIChJU19FUlIob2JqKSkKKwlpZiAoSVNfRVJSKG9iaikpIHsKKwkJaTkx
NV92bV9wdXQodm0pOwogCQlyZXR1cm4gRVJSX0NBU1Qob2JqKTsKKwl9CiAKIAl2YWRkciA9IGk5
MTVfZ2VtX29iamVjdF9waW5fbWFwKG9iaiwgaTkxNV9jb2hlcmVudF9tYXBfdHlwZShndC0+aTkx
NSkpOwogCWlmIChJU19FUlIodmFkZHIpKSB7CiAJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsK
KwkJaTkxNV92bV9wdXQodm0pOwogCQlyZXR1cm4gRVJSX0NBU1QodmFkZHIpOwogCX0KIApAQCAt
MTU5LDE2ICsxNjAsMjIgQEAgaGFuZ19jcmVhdGVfcmVxdWVzdChzdHJ1Y3QgaGFuZyAqaCwgc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCWgtPmJhdGNoID0gdmFkZHI7CiAKIAl2bWEg
PSBpOTE1X3ZtYV9pbnN0YW5jZShoLT5vYmosIHZtLCBOVUxMKTsKLQlpZiAoSVNfRVJSKHZtYSkp
CisJaWYgKElTX0VSUih2bWEpKSB7CisJCWk5MTVfdm1fcHV0KHZtKTsKIAkJcmV0dXJuIEVSUl9D
QVNUKHZtYSk7CisJfQogCiAJaHdzID0gaTkxNV92bWFfaW5zdGFuY2UoaC0+aHdzLCB2bSwgTlVM
TCk7Ci0JaWYgKElTX0VSUihod3MpKQorCWlmIChJU19FUlIoaHdzKSkgeworCQlpOTE1X3ZtX3B1
dCh2bSk7CiAJCXJldHVybiBFUlJfQ0FTVChod3MpOworCX0KIAogCWVyciA9IGk5MTVfdm1hX3Bp
bih2bWEsIDAsIDAsIFBJTl9VU0VSKTsKLQlpZiAoZXJyKQorCWlmIChlcnIpIHsKKwkJaTkxNV92
bV9wdXQodm0pOwogCQlyZXR1cm4gRVJSX1BUUihlcnIpOworCX0KIAogCWVyciA9IGk5MTVfdm1h
X3Bpbihod3MsIDAsIDAsIFBJTl9VU0VSKTsKIAlpZiAoZXJyKQpAQCAtMjY2LDYgKzI3Myw3IEBA
IGhhbmdfY3JlYXRlX3JlcXVlc3Qoc3RydWN0IGhhbmcgKmgsIHN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmVuZ2luZSkKIAlpOTE1X3ZtYV91bnBpbihod3MpOwogdW5waW5fdm1hOgogCWk5MTVfdm1h
X3VucGluKHZtYSk7CisJaTkxNV92bV9wdXQodm0pOwogCXJldHVybiBlcnIgPyBFUlJfUFRSKGVy
cikgOiBycTsKIH0KIApAQCAtMzgyLDkgKzM5MCw3IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X25v
cCh2b2lkICphcmcpCiAJaWYgKElTX0VSUihmaWxlKSkKIAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7
CiAKLQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJY3R4ID0gbGl2
ZV9jb250ZXh0KGd0LT5pOTE1LCBmaWxlKTsKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIAlpZiAoSVNfRVJSKGN0eCkpIHsKIAkJZXJyID0gUFRSX0VSUihjdHgp
OwogCQlnb3RvIG91dDsKQEAgLTQ1OCw5ICs0NjQsNyBAQCBzdGF0aWMgaW50IGlndF9yZXNldF9u
b3BfZW5naW5lKHZvaWQgKmFyZykKIAlpZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRSX0VS
UihmaWxlKTsKIAotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlj
dHggPSBsaXZlX2NvbnRleHQoZ3QtPmk5MTUsIGZpbGUpOwotCW11dGV4X3VubG9jaygmZ3QtPmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChJU19FUlIoY3R4KSkgewogCQllcnIgPSBQVFJf
RVJSKGN0eCk7CiAJCWdvdG8gb3V0OwpAQCAtNzA1LDkgKzcwOSw3IEBAIHN0YXRpYyBpbnQgYWN0
aXZlX2VuZ2luZSh2b2lkICpkYXRhKQogCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKIAogCWZvciAo
Y291bnQgPSAwOyBjb3VudCA8IEFSUkFZX1NJWkUoY3R4KTsgY291bnQrKykgewotCQltdXRleF9s
b2NrKCZlbmdpbmUtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQljdHhbY291bnRdID0gbGl2
ZV9jb250ZXh0KGVuZ2luZS0+aTkxNSwgZmlsZSk7Ci0JCW11dGV4X3VubG9jaygmZW5naW5lLT5p
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJaWYgKElTX0VSUihjdHhbY291bnRdKSkgewogCQkJ
ZXJyID0gUFRSX0VSUihjdHhbY291bnRdKTsKIAkJCXdoaWxlICgtLWNvdW50KQpAQCAtMTI5MSw2
ICsxMjkzLDcgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfZXZpY3RfcHBndHQodm9pZCAqYXJnKQog
ewogCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQg
KmN0eDsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKIAlzdHJ1Y3QgZHJtX2ZpbGUg
KmZpbGU7CiAJaW50IGVycjsKIApAQCAtMTI5OCwxOCArMTMwMSwyMCBAQCBzdGF0aWMgaW50IGln
dF9yZXNldF9ldmljdF9wcGd0dCh2b2lkICphcmcpCiAJaWYgKElTX0VSUihmaWxlKSkKIAkJcmV0
dXJuIFBUUl9FUlIoZmlsZSk7CiAKLQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAJY3R4ID0gbGl2ZV9jb250ZXh0KGd0LT5pOTE1LCBmaWxlKTsKLQltdXRleF91bmxv
Y2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpZiAoSVNfRVJSKGN0eCkpIHsKIAkJ
ZXJyID0gUFRSX0VSUihjdHgpOwogCQlnb3RvIG91dDsKIAl9CiAKIAllcnIgPSAwOwotCWlmIChj
dHgtPnZtKSAvKiBhbGlhc2luZyA9PSBnbG9iYWwgZ3R0IGxvY2tpbmcsIGNvdmVyZWQgYWJvdmUg
Ki8KLQkJZXJyID0gX19pZ3RfcmVzZXRfZXZpY3Rfdm1hKGd0LCBjdHgtPnZtLAorCXZtID0gaTkx
NV9nZW1fY29udGV4dF9nZXRfdm1fcmN1KGN0eCk7CisJaWYgKCFpOTE1X2lzX2dndHQodm0pKSB7
CisJCS8qIGFsaWFzaW5nID09IGdsb2JhbCBndHQgbG9ja2luZywgY292ZXJlZCBhYm92ZSAqLwor
CQllcnIgPSBfX2lndF9yZXNldF9ldmljdF92bWEoZ3QsIHZtLAogCQkJCQkgICAgZXZpY3Rfdm1h
LCBFWEVDX09CSkVDVF9XUklURSk7CisJfQorCWk5MTVfdm1fcHV0KHZtKTsKIAogb3V0OgogCW1v
Y2tfZmlsZV9mcmVlKGd0LT5pOTE1LCBmaWxlKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfbHJjLmMKaW5kZXggMDRjMWNmNTczNjQyLi44ZGM0MmM1Yzc1NjkgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCkBAIC0xNjMxLDcgKzE2MzEsMTEgQEAgc3RhdGljIGlu
dCBzbW9rZV9zdWJtaXQoc3RydWN0IHByZWVtcHRfc21va2UgKnNtb2tlLAogCWludCBlcnIgPSAw
OwogCiAJaWYgKGJhdGNoKSB7Ci0JCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKGJhdGNoLCBjdHgt
PnZtLCBOVUxMKTsKKwkJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CisKKwkJdm0gPSBp
OTE1X2dlbV9jb250ZXh0X2dldF92bV9yY3UoY3R4KTsKKwkJdm1hID0gaTkxNV92bWFfaW5zdGFu
Y2UoYmF0Y2gsIHZtLCBOVUxMKTsKKwkJaTkxNV92bV9wdXQodm0pOwogCQlpZiAoSVNfRVJSKHZt
YSkpCiAJCQlyZXR1cm4gUFRSX0VSUih2bWEpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Qvc2VsZnRlc3Rfd29ya2Fyb3VuZHMuYwppbmRleCA0ZWUyZTJiYWJkMGQuLjk0M2IwMDNiZWJh
NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29ya2Fyb3Vu
ZHMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5j
CkBAIC0zNTUsNiArMzU1LDcgQEAgc3RhdGljIGludCBjaGVja193aGl0ZWxpc3RfYWNyb3NzX3Jl
c2V0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIHN0YXRpYyBzdHJ1Y3QgaTkxNV92
bWEgKmNyZWF0ZV9iYXRjaChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQogewogCXN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAq
dm07CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJaW50IGVycjsKIApAQCAtMzYyLDcgKzM2Myw5
IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKmNyZWF0ZV9iYXRjaChzdHJ1Y3QgaTkxNV9nZW1f
Y29udGV4dCAqY3R4KQogCWlmIChJU19FUlIob2JqKSkKIAkJcmV0dXJuIEVSUl9DQVNUKG9iaik7
CiAKLQl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosIGN0eC0+dm0sIE5VTEwpOworCXZtID0g
aTkxNV9nZW1fY29udGV4dF9nZXRfdm1fcmN1KGN0eCk7CisJdm1hID0gaTkxNV92bWFfaW5zdGFu
Y2Uob2JqLCB2bSwgTlVMTCk7CisJaTkxNV92bV9wdXQodm0pOwogCWlmIChJU19FUlIodm1hKSkg
ewogCQllcnIgPSBQVFJfRVJSKHZtYSk7CiAJCWdvdG8gZXJyX29iajsKQEAgLTQ2MywxMiArNDY2
LDE1IEBAIHN0YXRpYyBpbnQgY2hlY2tfZGlydHlfd2hpdGVsaXN0KHN0cnVjdCBpOTE1X2dlbV9j
b250ZXh0ICpjdHgsCiAJCTB4ZmZmZjAwZmYsCiAJCTB4ZmZmZmZmZmYsCiAJfTsKKwlzdHJ1Y3Qg
aTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKIAlzdHJ1Y3QgaTkxNV92bWEgKnNjcmF0Y2g7CiAJc3Ry
dWN0IGk5MTVfdm1hICpiYXRjaDsKIAlpbnQgZXJyID0gMCwgaSwgdjsKIAl1MzIgKmNzLCAqcmVz
dWx0czsKIAotCXNjcmF0Y2ggPSBjcmVhdGVfc2NyYXRjaChjdHgtPnZtLCAyICogQVJSQVlfU0la
RSh2YWx1ZXMpICsgMSk7CisJdm0gPSBpOTE1X2dlbV9jb250ZXh0X2dldF92bV9yY3UoY3R4KTsK
KwlzY3JhdGNoID0gY3JlYXRlX3NjcmF0Y2godm0sIDIgKiBBUlJBWV9TSVpFKHZhbHVlcykgKyAx
KTsKKwlpOTE1X3ZtX3B1dCh2bSk7CiAJaWYgKElTX0VSUihzY3JhdGNoKSkKIAkJcmV0dXJuIFBU
Ul9FUlIoc2NyYXRjaCk7CiAKQEAgLTEwMTAsNiArMTAxNiw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9p
c29sYXRlZF93aGl0ZWxpc3Qodm9pZCAqYXJnKQogCQlyZXR1cm4gMDsKIAogCWZvciAoaSA9IDA7
IGkgPCBBUlJBWV9TSVpFKGNsaWVudCk7IGkrKykgeworCQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3Nw
YWNlICp2bTsKIAkJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmM7CiAKIAkJYyA9IGtlcm5lbF9j
b250ZXh0KGk5MTUpOwpAQCAtMTAxOCwyMiArMTAyNSwyNyBAQCBzdGF0aWMgaW50IGxpdmVfaXNv
bGF0ZWRfd2hpdGVsaXN0KHZvaWQgKmFyZykKIAkJCWdvdG8gZXJyOwogCQl9CiAKLQkJY2xpZW50
W2ldLnNjcmF0Y2hbMF0gPSBjcmVhdGVfc2NyYXRjaChjLT52bSwgMTAyNCk7CisJCXZtID0gaTkx
NV9nZW1fY29udGV4dF9nZXRfdm1fcmN1KGMpOworCisJCWNsaWVudFtpXS5zY3JhdGNoWzBdID0g
Y3JlYXRlX3NjcmF0Y2godm0sIDEwMjQpOwogCQlpZiAoSVNfRVJSKGNsaWVudFtpXS5zY3JhdGNo
WzBdKSkgewogCQkJZXJyID0gUFRSX0VSUihjbGllbnRbaV0uc2NyYXRjaFswXSk7CisJCQlpOTE1
X3ZtX3B1dCh2bSk7CiAJCQlrZXJuZWxfY29udGV4dF9jbG9zZShjKTsKIAkJCWdvdG8gZXJyOwog
CQl9CiAKLQkJY2xpZW50W2ldLnNjcmF0Y2hbMV0gPSBjcmVhdGVfc2NyYXRjaChjLT52bSwgMTAy
NCk7CisJCWNsaWVudFtpXS5zY3JhdGNoWzFdID0gY3JlYXRlX3NjcmF0Y2godm0sIDEwMjQpOwog
CQlpZiAoSVNfRVJSKGNsaWVudFtpXS5zY3JhdGNoWzFdKSkgewogCQkJZXJyID0gUFRSX0VSUihj
bGllbnRbaV0uc2NyYXRjaFsxXSk7CiAJCQlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmY2xp
ZW50W2ldLnNjcmF0Y2hbMF0sIDApOworCQkJaTkxNV92bV9wdXQodm0pOwogCQkJa2VybmVsX2Nv
bnRleHRfY2xvc2UoYyk7CiAJCQlnb3RvIGVycjsKIAkJfQogCiAJCWNsaWVudFtpXS5jdHggPSBj
OworCQlpOTE1X3ZtX3B1dCh2bSk7CiAJfQogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkx
NSwgaWQpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYwppbmRleCAwM2Y1NjcwODQ1
NDguLjY4NTBmMWY0MDI0MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3Nj
aGVkdWxlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYwpAQCAt
MzY1LDcgKzM2NSw4IEBAIHN0YXRpYyB2b2lkIHNldF9jb250ZXh0X3BwZ3R0X2Zyb21fc2hhZG93
KHN0cnVjdCBpbnRlbF92Z3B1X3dvcmtsb2FkICp3b3JrbG9hZCwKIAkJCQkJICBzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dCAqY3R4KQogewogCXN0cnVjdCBpbnRlbF92Z3B1X21tICptbSA9IHdvcmts
b2FkLT5zaGFkb3dfbW07Ci0Jc3RydWN0IGk5MTVfcHBndHQgKnBwZ3R0ID0gaTkxNV92bV90b19w
cGd0dChjdHgtPnZtKTsKKwlzdHJ1Y3QgaTkxNV9wcGd0dCAqcHBndHQgPQorCQlpOTE1X3ZtX3Rv
X3BwZ3R0KGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpKTsKIAlpbnQgaSA9IDA7CiAK
IAlpZiAobW0tPnBwZ3R0X21tLnJvb3RfZW50cnlfdHlwZSA9PSBHVFRfVFlQRV9QUEdUVF9ST09U
X0w0X0VOVFJZKSB7CkBAIC0zNzgsNiArMzc5LDggQEAgc3RhdGljIHZvaWQgc2V0X2NvbnRleHRf
cHBndHRfZnJvbV9zaGFkb3coc3RydWN0IGludGVsX3ZncHVfd29ya2xvYWQgKndvcmtsb2FkLAog
CQkJcHhfZG1hKHBkKSA9IG1tLT5wcGd0dF9tbS5zaGFkb3dfcGRwc1tpXTsKIAkJfQogCX0KKwor
CWk5MTVfdm1fcHV0KCZwcGd0dC0+dm0pOwogfQogCiBzdGF0aWMgaW50CkBAIC0xMjMwLDIwICsx
MjMzLDE4IEBAIGludCBpbnRlbF92Z3B1X3NldHVwX3N1Ym1pc3Npb24oc3RydWN0IGludGVsX3Zn
cHUgKnZncHUpCiAJc3RydWN0IGludGVsX3ZncHVfc3VibWlzc2lvbiAqcyA9ICZ2Z3B1LT5zdWJt
aXNzaW9uOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAlzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqY3R4OworCXN0cnVjdCBpOTE1X3BwZ3R0ICpwcGd0dDsKIAllbnVtIGludGVs
X2VuZ2luZV9pZCBpOwogCWludCByZXQ7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLQogCWN0eCA9IGk5MTVfZ2VtX2NvbnRleHRfY3JlYXRlX2tlcm5lbChpOTE1LCBJ
OTE1X1BSSU9SSVRZX01BWCk7Ci0JaWYgKElTX0VSUihjdHgpKSB7Ci0JCXJldCA9IFBUUl9FUlIo
Y3R4KTsKLQkJZ290byBvdXRfdW5sb2NrOwotCX0KKwlpZiAoSVNfRVJSKGN0eCkpCisJCXJldHVy
biBQVFJfRVJSKGN0eCk7CiAKIAlpOTE1X2dlbV9jb250ZXh0X3NldF9mb3JjZV9zaW5nbGVfc3Vi
bWlzc2lvbihjdHgpOwogCi0JaTkxNV9jb250ZXh0X3BwZ3R0X3Jvb3Rfc2F2ZShzLCBpOTE1X3Zt
X3RvX3BwZ3R0KGN0eC0+dm0pKTsKKwlwcGd0dCA9IGk5MTVfdm1fdG9fcHBndHQoaTkxNV9nZW1f
Y29udGV4dF9nZXRfdm1fcmN1KGN0eCkpOworCWk5MTVfY29udGV4dF9wcGd0dF9yb290X3NhdmUo
cywgcHBndHQpOwogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaSkgewogCQlzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2U7CkBAIC0xMjg4LDEyICsxMjg5LDEyIEBAIGludCBpbnRlbF92
Z3B1X3NldHVwX3N1Ym1pc3Npb24oc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAJYXRvbWljX3Nl
dCgmcy0+cnVubmluZ193b3JrbG9hZF9udW0sIDApOwogCWJpdG1hcF96ZXJvKHMtPnRsYl9oYW5k
bGVfcGVuZGluZywgSTkxNV9OVU1fRU5HSU5FUyk7CiAKKwlpOTE1X3ZtX3B1dCgmcHBndHQtPnZt
KTsKIAlpOTE1X2dlbV9jb250ZXh0X3B1dChjdHgpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIDA7CiAKIG91dF9zaGFkb3dfY3R4OgotCWk5MTVfY29u
dGV4dF9wcGd0dF9yb290X3Jlc3RvcmUocywgaTkxNV92bV90b19wcGd0dChjdHgtPnZtKSk7CisJ
aTkxNV9jb250ZXh0X3BwZ3R0X3Jvb3RfcmVzdG9yZShzLCBwcGd0dCk7CiAJZm9yX2VhY2hfZW5n
aW5lKGVuZ2luZSwgaTkxNSwgaSkgewogCQlpZiAoSVNfRVJSKHMtPnNoYWRvd1tpXSkpCiAJCQli
cmVhazsKQEAgLTEzMDEsOSArMTMwMiw4IEBAIGludCBpbnRlbF92Z3B1X3NldHVwX3N1Ym1pc3Np
b24oc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAJCWludGVsX2NvbnRleHRfdW5waW4ocy0+c2hh
ZG93W2ldKTsKIAkJaW50ZWxfY29udGV4dF9wdXQocy0+c2hhZG93W2ldKTsKIAl9CisJaTkxNV92
bV9wdXQoJnBwZ3R0LT52bSk7CiAJaTkxNV9nZW1fY29udGV4dF9wdXQoY3R4KTsKLW91dF91bmxv
Y2s6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4gcmV0
OwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCmluZGV4IDBlOTBhYzYwOGUwNy4u
YjA0Y2ViYzI2ZWNhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVn
ZnMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwpAQCAtMzE2LDEy
ICszMTYsMTggQEAgc3RhdGljIHZvaWQgcHJpbnRfY29udGV4dF9zdGF0cyhzdHJ1Y3Qgc2VxX2Zp
bGUgKm0sCiAJCQkJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RydWN0IGZp
bGVfc3RhdHMga3N0YXRzID0ge307Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKKwlz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LCAqY247CiAKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5
KGN0eCwgJmk5MTUtPmNvbnRleHRzLmxpc3QsIGxpbmspIHsKKwlzcGluX2xvY2soJmk5MTUtPmdl
bS5jb250ZXh0cy5sb2NrKTsKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUoY3R4LCBjbiwgJmk5
MTUtPmdlbS5jb250ZXh0cy5saXN0LCBsaW5rKSB7CiAJCXN0cnVjdCBpOTE1X2dlbV9lbmdpbmVz
X2l0ZXIgaXQ7CiAJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAorCQlpZiAoIWtyZWZfZ2V0
X3VubGVzc196ZXJvKCZjdHgtPnJlZikpCisJCQljb250aW51ZTsKKworCQlzcGluX3VubG9jaygm
aTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOworCiAJCWZvcl9lYWNoX2dlbV9lbmdpbmUoY2UsCiAJ
CQkJICAgIGk5MTVfZ2VtX2NvbnRleHRfbG9ja19lbmdpbmVzKGN0eCksIGl0KSB7CiAJCQlpbnRl
bF9jb250ZXh0X2xvY2tfcGlubmVkKGNlKTsKQEAgLTMzOCw3ICszNDQsOSBAQCBzdGF0aWMgdm9p
ZCBwcmludF9jb250ZXh0X3N0YXRzKHN0cnVjdCBzZXFfZmlsZSAqbSwKIAkJaTkxNV9nZW1fY29u
dGV4dF91bmxvY2tfZW5naW5lcyhjdHgpOwogCiAJCWlmICghSVNfRVJSX09SX05VTEwoY3R4LT5m
aWxlX3ByaXYpKSB7Ci0JCQlzdHJ1Y3QgZmlsZV9zdGF0cyBzdGF0cyA9IHsgLnZtID0gY3R4LT52
bSwgfTsKKwkJCXN0cnVjdCBmaWxlX3N0YXRzIHN0YXRzID0geworCQkJCS52bSA9IHJjdV9hY2Nl
c3NfcG9pbnRlcihjdHgtPnZtKSwKKwkJCX07CiAJCQlzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUgPSBj
dHgtPmZpbGVfcHJpdi0+ZmlsZTsKIAkJCXN0cnVjdCB0YXNrX3N0cnVjdCAqdGFzazsKIAkJCWNo
YXIgbmFtZVs4MF07CkBAIC0zNTUsNyArMzYzLDEyIEBAIHN0YXRpYyB2b2lkIHByaW50X2NvbnRl
eHRfc3RhdHMoc3RydWN0IHNlcV9maWxlICptLAogCiAJCQlwcmludF9maWxlX3N0YXRzKG0sIG5h
bWUsIHN0YXRzKTsKIAkJfQorCisJCXNwaW5fbG9jaygmaTkxNS0+Z2VtLmNvbnRleHRzLmxvY2sp
OworCQlsaXN0X3NhZmVfcmVzZXRfbmV4dChjdHgsIGNuLCBsaW5rKTsKKwkJaTkxNV9nZW1fY29u
dGV4dF9wdXQoY3R4KTsKIAl9CisJc3Bpbl91bmxvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2Nr
KTsKIAogCXByaW50X2ZpbGVfc3RhdHMobSwgIltrXWNvbnRleHRzIiwga3N0YXRzKTsKIH0KQEAg
LTM2Myw3ICszNzYsNiBAQCBzdGF0aWMgdm9pZCBwcmludF9jb250ZXh0X3N0YXRzKHN0cnVjdCBz
ZXFfZmlsZSAqbSwKIHN0YXRpYyBpbnQgaTkxNV9nZW1fb2JqZWN0X2luZm8oc3RydWN0IHNlcV9m
aWxlICptLCB2b2lkICpkYXRhKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
bm9kZV90b19pOTE1KG0tPnByaXZhdGUpOwotCWludCByZXQ7CiAKIAlzZXFfcHJpbnRmKG0sICIl
dSBzaHJpbmthYmxlIFsldSBmcmVlXSBvYmplY3RzLCAlbGx1IGJ5dGVzXG4iLAogCQkgICBpOTE1
LT5tbS5zaHJpbmtfY291bnQsCkBAIC0zNzIsMTIgKzM4NCw3IEBAIHN0YXRpYyBpbnQgaTkxNV9n
ZW1fb2JqZWN0X2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCiAJc2VxX3B1
dGMobSwgJ1xuJyk7CiAKLQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KIAlwcmludF9jb250
ZXh0X3N0YXRzKG0sIGk5MTUpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTE1NzksMTkgKzE1ODYsMTkgQEAgc3RhdGljIHZvaWQg
ZGVzY3JpYmVfY3R4X3Jpbmcoc3RydWN0IHNlcV9maWxlICptLCBzdHJ1Y3QgaW50ZWxfcmluZyAq
cmluZykKIAogc3RhdGljIGludCBpOTE1X2NvbnRleHRfc3RhdHVzKHN0cnVjdCBzZXFfZmlsZSAq
bSwgdm9pZCAqdW51c2VkKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmRl
dl9wcml2LT5kcm07Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKLQlpbnQgcmV0Owot
Ci0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZkZXYtPnN0cnVjdF9tdXRleCk7Ci0J
aWYgKHJldCkKLQkJcmV0dXJuIHJldDsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKKwlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4
LCAqY247CiAKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KGN0eCwgJmRldl9wcml2LT5jb250ZXh0cy5s
aXN0LCBsaW5rKSB7CisJc3Bpbl9sb2NrKCZpOTE1LT5nZW0uY29udGV4dHMubG9jayk7CisJbGlz
dF9mb3JfZWFjaF9lbnRyeV9zYWZlKGN0eCwgY24sICZpOTE1LT5nZW0uY29udGV4dHMubGlzdCwg
bGluaykgewogCQlzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lc19pdGVyIGl0OwogCQlzdHJ1Y3QgaW50
ZWxfY29udGV4dCAqY2U7CiAKKwkJaWYgKCFrcmVmX2dldF91bmxlc3NfemVybygmY3R4LT5yZWYp
KQorCQkJY29udGludWU7CisKKwkJc3Bpbl91bmxvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2Nr
KTsKKwogCQlzZXFfcHV0cyhtLCAiSFcgY29udGV4dCAiKTsKIAkJaWYgKGN0eC0+cGlkKSB7CiAJ
CQlzdHJ1Y3QgdGFza19zdHJ1Y3QgKnRhc2s7CkBAIC0xNjI2LDkgKzE2MzMsMTIgQEAgc3RhdGlj
IGludCBpOTE1X2NvbnRleHRfc3RhdHVzKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqdW51c2Vk
KQogCQlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19lbmdpbmVzKGN0eCk7CiAKIAkJc2VxX3B1dGMo
bSwgJ1xuJyk7Ci0JfQogCi0JbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CisJCXNw
aW5fbG9jaygmaTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOworCQlsaXN0X3NhZmVfcmVzZXRfbmV4
dChjdHgsIGNuLCBsaW5rKTsKKwkJaTkxNV9nZW1fY29udGV4dF9wdXQoY3R4KTsKKwl9CisJc3Bp
bl91bmxvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKIAogCXJldHVybiAwOwogfQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZHJ2LmMKaW5kZXggNTMyM2U0ZmE1NWQ5Li4wMjRkYTU4MmJhMGYgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9kcnYuYwpAQCAtMTY2NSwxMCArMTY2NSw4IEBAIHN0YXRpYyB2b2lkIGk5
MTVfZHJpdmVyX3Bvc3RjbG9zZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3QgZHJtX2Zp
bGUgKmZpbGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X2ZpbGVfcHJpdmF0ZSAqZmlsZV9wcml2ID0g
ZmlsZS0+ZHJpdmVyX3ByaXY7CiAKLQltdXRleF9sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CiAJ
aTkxNV9nZW1fY29udGV4dF9jbG9zZShmaWxlKTsKIAlpOTE1X2dlbV9yZWxlYXNlKGRldiwgZmls
ZSk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CiAKIAlrZnJlZV9yY3UoZmls
ZV9wcml2LCByY3UpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Ry
di5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAppbmRleCBjYjYzYjJiZDBjZTgu
LjM1YjYxMGQ1MjM3OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYu
aAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCkBAIC0xNTM2LDI1ICsxNTM2
LDYgQEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgewogCWludCBhdWRpb19wb3dlcl9yZWZjb3Vu
dDsKIAl1MzIgYXVkaW9fZnJlcV9jbnRybDsKIAotCXN0cnVjdCB7Ci0JCXN0cnVjdCBtdXRleCBt
dXRleDsKLQkJc3RydWN0IGxpc3RfaGVhZCBsaXN0OwotCQlzdHJ1Y3QgbGxpc3RfaGVhZCBmcmVl
X2xpc3Q7Ci0JCXN0cnVjdCB3b3JrX3N0cnVjdCBmcmVlX3dvcms7Ci0KLQkJLyogVGhlIGh3IHdh
bnRzIHRvIGhhdmUgYSBzdGFibGUgY29udGV4dCBpZGVudGlmaWVyIGZvciB0aGUKLQkJICogbGlm
ZXRpbWUgb2YgdGhlIGNvbnRleHQgKGZvciBPQSwgUEFTSUQsIGZhdWx0cywgZXRjKS4KLQkJICog
VGhpcyBpcyBsaW1pdGVkIGluIGV4ZWNsaXN0cyB0byAyMSBiaXRzLgotCQkgKi8KLQkJc3RydWN0
IGlkYSBod19pZGE7Ci0jZGVmaW5lIE1BWF9DT05URVhUX0hXX0lEICgxPDwyMSkgLyogZXhjbHVz
aXZlICovCi0jZGVmaW5lIE1BWF9HVUNfQ09OVEVYVF9IV19JRCAoMSA8PCAyMCkgLyogZXhjbHVz
aXZlICovCi0jZGVmaW5lIEdFTjExX01BWF9DT05URVhUX0hXX0lEICgxPDwxMSkgLyogZXhjbHVz
aXZlICovCi0vKiBpbiBHZW4xMiBJRCAweDdGRiBpcyByZXNlcnZlZCB0byBpbmRpY2F0ZSBpZGxl
ICovCi0jZGVmaW5lIEdFTjEyX01BWF9DT05URVhUX0hXX0lECShHRU4xMV9NQVhfQ09OVEVYVF9I
V19JRCAtIDEpCi0JCXN0cnVjdCBsaXN0X2hlYWQgaHdfaWRfbGlzdDsKLQl9IGNvbnRleHRzOwot
CiAJdTMyIGZkaV9yeF9jb25maWc7CiAKIAkvKiBTaGFkb3cgZm9yIERJU1BMQVlfUEhZX0NPTlRS
T0wgd2hpY2ggY2FuJ3QgYmUgc2FmZWx5IHJlYWQgKi8KQEAgLTE3MTAsNiArMTY5MSwxNCBAQCBz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSB7CiAKIAlzdHJ1Y3QgewogCQlzdHJ1Y3Qgbm90aWZpZXJf
YmxvY2sgcG1fbm90aWZpZXI7CisKKwkJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHRzIHsKKwkJCXNw
aW5sb2NrX3QgbG9jazsgLyogbG9ja3MgbGlzdCAqLworCQkJc3RydWN0IGxpc3RfaGVhZCBsaXN0
OworCisJCQlzdHJ1Y3QgbGxpc3RfaGVhZCBmcmVlX2xpc3Q7CisJCQlzdHJ1Y3Qgd29ya19zdHJ1
Y3QgZnJlZV93b3JrOworCQl9IGNvbnRleHRzOwogCX0gZ2VtOwogCiAJLyogRm9yIGk5NDVnbSB2
YmxhbmsgaXJxIHZzLiBDMyB3b3JrYXJvdW5kICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwppbmRl
eCA1YTY2NGJkZWFkOGMuLmY2ZGI0MTU5ODVkNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCkBA
IC0xMjY2LDcgKzEyNjYsNyBAQCBpbnQgaTkxNV9nZW1faW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCiAJCWdvdG8gZXJyX3VubG9jazsKIAl9CiAKLQlyZXQgPSBpOTE1X2dl
bV9jb250ZXh0c19pbml0KGRldl9wcml2KTsKKwlyZXQgPSBpOTE1X2dlbV9pbml0X2NvbnRleHRz
KGRldl9wcml2KTsKIAlpZiAocmV0KSB7CiAJCUdFTV9CVUdfT04ocmV0ID09IC1FSU8pOwogCQln
b3RvIGVycl9zY3JhdGNoOwpAQCAtMTM0OCw3ICsxMzQ4LDcgQEAgaW50IGk5MTVfZ2VtX2luaXQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCX0KIGVycl9jb250ZXh0OgogCWlm
IChyZXQgIT0gLUVJTykKLQkJaTkxNV9nZW1fY29udGV4dHNfZmluaShkZXZfcHJpdik7CisJCWk5
MTVfZ2VtX2RyaXZlcl9yZWxlYXNlX19jb250ZXh0cyhkZXZfcHJpdik7CiBlcnJfc2NyYXRjaDoK
IAlpbnRlbF9ndF9kcml2ZXJfcmVsZWFzZSgmZGV2X3ByaXYtPmd0KTsKIGVycl91bmxvY2s6CkBA
IC0xNDE2LDExICsxNDE2LDkgQEAgdm9pZCBpOTE1X2dlbV9kcml2ZXJfcmVtb3ZlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogdm9pZCBpOTE1X2dlbV9kcml2ZXJfcmVsZWFz
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7Ci0JbXV0ZXhfbG9jaygmZGV2
X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWludGVsX2VuZ2luZXNfY2xlYW51cChkZXZfcHJp
dik7Ci0JaTkxNV9nZW1fY29udGV4dHNfZmluaShkZXZfcHJpdik7CisJaTkxNV9nZW1fZHJpdmVy
X3JlbGVhc2VfX2NvbnRleHRzKGRldl9wcml2KTsKIAlpbnRlbF9ndF9kcml2ZXJfcmVsZWFzZSgm
ZGV2X3ByaXYtPmd0KTsKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4
KTsKIAogCWludGVsX3dhX2xpc3RfZnJlZSgmZGV2X3ByaXYtPmd0X3dhX2xpc3QpOwogCkBAIC0x
NDMwLDcgKzE0MjgsNyBAQCB2b2lkIGk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogCWk5MTVfZ2VtX2RyYWluX2ZyZWVkX29iamVjdHMo
ZGV2X3ByaXYpOwogCi0JV0FSTl9PTighbGlzdF9lbXB0eSgmZGV2X3ByaXYtPmNvbnRleHRzLmxp
c3QpKTsKKwlXQVJOX09OKCFsaXN0X2VtcHR5KCZkZXZfcHJpdi0+Z2VtLmNvbnRleHRzLmxpc3Qp
KTsKIH0KIAogdm9pZCBpOTE1X2dlbV9pbml0X21taW8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCmluZGV4IDFkMjY2MzRjYTU5Ny4u
N2IxNWJiODkxOTcwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9n
dHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwpAQCAtMTM2Niw3
ICsxMzY2LDkgQEAgc3RhdGljIGludCBnZW44X2luaXRfc2NyYXRjaChzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlICp2bSkKIAlpZiAodm0tPmhhc19yZWFkX29ubHkgJiYKIAkgICAgdm0tPmk5MTUt
Pmtlcm5lbF9jb250ZXh0ICYmCiAJICAgIHZtLT5pOTE1LT5rZXJuZWxfY29udGV4dC0+dm0pIHsK
LQkJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqY2xvbmUgPSB2bS0+aTkxNS0+a2VybmVsX2Nv
bnRleHQtPnZtOworCQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICpjbG9uZSA9CisJCQlyY3Vf
ZGVyZWZlcmVuY2VfcHJvdGVjdGVkKHZtLT5pOTE1LT5rZXJuZWxfY29udGV4dC0+dm0sCisJCQkJ
CQkgIHRydWUpOyAvKiBzdGF0aWMgKi8KIAogCQlHRU1fQlVHX09OKCFjbG9uZS0+aGFzX3JlYWRf
b25seSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKaW5kZXggZWNmYmMzN2I3MzhiLi4yMzEz
ODhkMDZjODIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCkBAIC0xODUzLDggKzE4NTMsOCBA
QCBzdGF0aWMgaW50IGdlbjhfY29uZmlndXJlX2FsbF9jb250ZXh0cyhzdHJ1Y3QgaTkxNV9wZXJm
X3N0cmVhbSAqc3RyZWFtLAogCX07CiAjdW5kZWYgY3R4X2ZsZXhldU4KIAlzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmU7Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKLQlpbnQg
aTsKKwlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LCAqY247CisJaW50IGksIGVycjsKIAog
CWZvciAoaSA9IDI7IGkgPCBBUlJBWV9TSVpFKHJlZ3MpOyBpKyspCiAJCXJlZ3NbaV0udmFsdWUg
PSBvYV9jb25maWdfZmxleF9yZWcob2FfY29uZmlnLCByZWdzW2ldLnJlZyk7CkBAIC0xODc3LDE2
ICsxODc3LDI3IEBAIHN0YXRpYyBpbnQgZ2VuOF9jb25maWd1cmVfYWxsX2NvbnRleHRzKHN0cnVj
dCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJICogY29udGV4dC4gQ29udGV4dHMgaWRsZSBh
dCB0aGUgdGltZSBvZiByZWNvbmZpZ3VyYXRpb24gYXJlIG5vdAogCSAqIHRyYXBwZWQgYmVoaW5k
IHRoZSBiYXJyaWVyLgogCSAqLwotCWxpc3RfZm9yX2VhY2hfZW50cnkoY3R4LCAmaTkxNS0+Y29u
dGV4dHMubGlzdCwgbGluaykgewotCQlpbnQgZXJyOwotCisJc3Bpbl9sb2NrKCZpOTE1LT5nZW0u
Y29udGV4dHMubG9jayk7CisJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKGN0eCwgY24sICZpOTE1
LT5nZW0uY29udGV4dHMubGlzdCwgbGluaykgewogCQlpZiAoY3R4ID09IGk5MTUtPmtlcm5lbF9j
b250ZXh0KQogCQkJY29udGludWU7CiAKKwkJaWYgKCFrcmVmX2dldF91bmxlc3NfemVybygmY3R4
LT5yZWYpKQorCQkJY29udGludWU7CisKKwkJc3Bpbl91bmxvY2soJmk5MTUtPmdlbS5jb250ZXh0
cy5sb2NrKTsKKwogCQllcnIgPSBnZW44X2NvbmZpZ3VyZV9jb250ZXh0KGN0eCwgcmVncywgQVJS
QVlfU0laRShyZWdzKSk7Ci0JCWlmIChlcnIpCisJCWlmIChlcnIpIHsKKwkJCWk5MTVfZ2VtX2Nv
bnRleHRfcHV0KGN0eCk7CiAJCQlyZXR1cm4gZXJyOworCQl9CisKKwkJc3Bpbl9sb2NrKCZpOTE1
LT5nZW0uY29udGV4dHMubG9jayk7CisJCWxpc3Rfc2FmZV9yZXNldF9uZXh0KGN0eCwgY24sIGxp
bmspOworCQlpOTE1X2dlbV9jb250ZXh0X3B1dChjdHgpOwogCX0KKwlzcGluX3VubG9jaygmaTkx
NS0+Z2VtLmNvbnRleHRzLmxvY2spOwogCiAJLyoKIAkgKiBBZnRlciB1cGRhdGluZyBhbGwgb3Ro
ZXIgY29udGV4dHMsIHdlIG5lZWQgdG8gbW9kaWZ5IG91cnNlbHZlcy4KQEAgLTE4OTUsNyArMTkw
Niw2IEBAIHN0YXRpYyBpbnQgZ2VuOF9jb25maWd1cmVfYWxsX2NvbnRleHRzKHN0cnVjdCBpOTE1
X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJICovCiAJZm9yX2VhY2hfdWFiaV9lbmdpbmUoZW5naW5l
LCBpOTE1KSB7CiAJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSA9IGVuZ2luZS0+a2VybmVsX2Nv
bnRleHQ7Ci0JCWludCBlcnI7CiAKIAkJaWYgKGVuZ2luZS0+Y2xhc3MgIT0gUkVOREVSX0NMQVNT
KQogCQkJY29udGludWU7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N5
c2ZzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N5c2ZzLmMKaW5kZXggMDM0YjhhYmM1
MDYyLi4yYTcyNDA3YTYzODAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
c3lzZnMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N5c2ZzLmMKQEAgLTE0NCw5
ICsxNDQsOSBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGF0dHJpYnV0ZV9ncm91cCBtZWRpYV9yYzZf
YXR0cl9ncm91cCA9IHsKIH07CiAjZW5kaWYKIAotc3RhdGljIGludCBsM19hY2Nlc3NfdmFsaWQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBsb2ZmX3Qgb2Zmc2V0KQorc3RhdGlj
IGludCBsM19hY2Nlc3NfdmFsaWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGxvZmZf
dCBvZmZzZXQpCiB7Ci0JaWYgKCFIQVNfTDNfRFBGKGRldl9wcml2KSkKKwlpZiAoIUhBU19MM19E
UEYoaTkxNSkpCiAJCXJldHVybiAtRVBFUk07CiAKIAlpZiAob2Zmc2V0ICUgNCAhPSAwKQpAQCAt
MTY0LDMxICsxNjQsMjQgQEAgaTkxNV9sM19yZWFkKHN0cnVjdCBmaWxlICpmaWxwLCBzdHJ1Y3Qg
a29iamVjdCAqa29iaiwKIAkgICAgIGxvZmZfdCBvZmZzZXQsIHNpemVfdCBjb3VudCkKIHsKIAlz
dHJ1Y3QgZGV2aWNlICprZGV2ID0ga29ial90b19kZXYoa29iaik7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0ga2Rldl9taW5vcl90b19pOTE1KGtkZXYpOwotCXN0cnVjdCBk
cm1fZGV2aWNlICpkZXYgPSAmZGV2X3ByaXYtPmRybTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IGtkZXZfbWlub3JfdG9faTkxNShrZGV2KTsKIAlpbnQgc2xpY2UgPSAoaW50KSh1
aW50cHRyX3QpYXR0ci0+cHJpdmF0ZTsKIAlpbnQgcmV0OwogCi0JY291bnQgPSByb3VuZF9kb3du
KGNvdW50LCA0KTsKLQotCXJldCA9IGwzX2FjY2Vzc192YWxpZChkZXZfcHJpdiwgb2Zmc2V0KTsK
KwlyZXQgPSBsM19hY2Nlc3NfdmFsaWQoaTkxNSwgb2Zmc2V0KTsKIAlpZiAocmV0KQogCQlyZXR1
cm4gcmV0OwogCisJY291bnQgPSByb3VuZF9kb3duKGNvdW50LCA0KTsKIAljb3VudCA9IG1pbl90
KHNpemVfdCwgR0VON19MM0xPR19TSVpFIC0gb2Zmc2V0LCBjb3VudCk7CisJbWVtc2V0KGJ1Ziwg
MCwgY291bnQpOwogCi0JcmV0ID0gaTkxNV9tdXRleF9sb2NrX2ludGVycnVwdGlibGUoZGV2KTsK
LQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCi0JaWYgKGRldl9wcml2LT5sM19wYXJpdHkucmVt
YXBfaW5mb1tzbGljZV0pCisJc3Bpbl9sb2NrKCZpOTE1LT5nZW0uY29udGV4dHMubG9jayk7CisJ
aWYgKGk5MTUtPmwzX3Bhcml0eS5yZW1hcF9pbmZvW3NsaWNlXSkKIAkJbWVtY3B5KGJ1ZiwKLQkJ
ICAgICAgIGRldl9wcml2LT5sM19wYXJpdHkucmVtYXBfaW5mb1tzbGljZV0gKyAob2Zmc2V0LzQp
LAorCQkgICAgICAgaTkxNS0+bDNfcGFyaXR5LnJlbWFwX2luZm9bc2xpY2VdICsgb2Zmc2V0IC8g
NCwKIAkJICAgICAgIGNvdW50KTsKLQllbHNlCi0JCW1lbXNldChidWYsIDAsIGNvdW50KTsKLQot
CW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOworCXNwaW5fdW5sb2NrKCZpOTE1LT5n
ZW0uY29udGV4dHMubG9jayk7CiAKIAlyZXR1cm4gY291bnQ7CiB9CkBAIC0xOTksNDYgKzE5Miw0
NiBAQCBpOTE1X2wzX3dyaXRlKHN0cnVjdCBmaWxlICpmaWxwLCBzdHJ1Y3Qga29iamVjdCAqa29i
aiwKIAkgICAgICBsb2ZmX3Qgb2Zmc2V0LCBzaXplX3QgY291bnQpCiB7CiAJc3RydWN0IGRldmlj
ZSAqa2RldiA9IGtvYmpfdG9fZGV2KGtvYmopOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IGtkZXZfbWlub3JfdG9faTkxNShrZGV2KTsKLQlzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2ID0gJmRldl9wcml2LT5kcm07CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBr
ZGV2X21pbm9yX3RvX2k5MTUoa2Rldik7CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsK
IAlpbnQgc2xpY2UgPSAoaW50KSh1aW50cHRyX3QpYXR0ci0+cHJpdmF0ZTsKLQl1MzIgKipyZW1h
cF9pbmZvOworCXUzMiAqcmVtYXBfaW5mbywgKmZyZWVtZSA9IE5VTEw7CiAJaW50IHJldDsKIAot
CXJldCA9IGwzX2FjY2Vzc192YWxpZChkZXZfcHJpdiwgb2Zmc2V0KTsKKwlyZXQgPSBsM19hY2Nl
c3NfdmFsaWQoaTkxNSwgb2Zmc2V0KTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0JcmV0
ID0gaTkxNV9tdXRleF9sb2NrX2ludGVycnVwdGlibGUoZGV2KTsKLQlpZiAocmV0KQotCQlyZXR1
cm4gcmV0OworCXJlbWFwX2luZm8gPSBremFsbG9jKEdFTjdfTDNMT0dfU0laRSwgR0ZQX0tFUk5F
TCk7CisJaWYgKCFyZW1hcF9pbmZvKQorCQlyZXR1cm4gLUVOT01FTTsKIAotCXJlbWFwX2luZm8g
PSAmZGV2X3ByaXYtPmwzX3Bhcml0eS5yZW1hcF9pbmZvW3NsaWNlXTsKLQlpZiAoISpyZW1hcF9p
bmZvKSB7Ci0JCSpyZW1hcF9pbmZvID0ga3phbGxvYyhHRU43X0wzTE9HX1NJWkUsIEdGUF9LRVJO
RUwpOwotCQlpZiAoISpyZW1hcF9pbmZvKSB7Ci0JCQlyZXQgPSAtRU5PTUVNOwotCQkJZ290byBv
dXQ7Ci0JCX0KKwlzcGluX2xvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKKworCWlmIChp
OTE1LT5sM19wYXJpdHkucmVtYXBfaW5mb1tzbGljZV0pIHsKKwkJZnJlZW1lID0gcmVtYXBfaW5m
bzsKKwkJcmVtYXBfaW5mbyA9IGk5MTUtPmwzX3Bhcml0eS5yZW1hcF9pbmZvW3NsaWNlXTsKKwl9
IGVsc2UgeworCQlpOTE1LT5sM19wYXJpdHkucmVtYXBfaW5mb1tzbGljZV0gPSByZW1hcF9pbmZv
OwogCX0KIAotCS8qIFRPRE86IElkZWFsbHkgd2UgcmVhbGx5IHdhbnQgYSBHUFUgcmVzZXQgaGVy
ZSB0byBtYWtlIHN1cmUgZXJyb3JzCi0JICogYXJlbid0IHByb3BhZ2F0ZWQuIFNpbmNlIEkgY2Fu
bm90IGZpbmQgYSBzdGFibGUgd2F5IHRvIHJlc2V0IHRoZSBHUFUKLQkgKiBhdCB0aGlzIHBvaW50
IGl0IGlzIGxlZnQgYXMgYSBUT0RPLgotCSovCi0JbWVtY3B5KCpyZW1hcF9pbmZvICsgKG9mZnNl
dC80KSwgYnVmLCBjb3VudCk7CisJY291bnQgPSByb3VuZF9kb3duKGNvdW50LCA0KTsKKwltZW1j
cHkocmVtYXBfaW5mbyArIG9mZnNldCAvIDQsIGJ1ZiwgY291bnQpOwogCiAJLyogTkI6IFdlIGRl
ZmVyIHRoZSByZW1hcHBpbmcgdW50aWwgd2Ugc3dpdGNoIHRvIHRoZSBjb250ZXh0ICovCi0JbGlz
dF9mb3JfZWFjaF9lbnRyeShjdHgsICZkZXZfcHJpdi0+Y29udGV4dHMubGlzdCwgbGluaykKLQkJ
Y3R4LT5yZW1hcF9zbGljZSB8PSAoMTw8c2xpY2UpOworCWxpc3RfZm9yX2VhY2hfZW50cnkoY3R4
LCAmaTkxNS0+Z2VtLmNvbnRleHRzLmxpc3QsIGxpbmspCisJCWN0eC0+cmVtYXBfc2xpY2UgfD0g
QklUKHNsaWNlKTsKIAotCXJldCA9IGNvdW50OworCXNwaW5fdW5sb2NrKCZpOTE1LT5nZW0uY29u
dGV4dHMubG9jayk7CisJa2ZyZWUoZnJlZW1lKTsKIAotb3V0OgotCW11dGV4X3VubG9jaygmZGV2
LT5zdHJ1Y3RfbXV0ZXgpOworCS8qCisJICogVE9ETzogSWRlYWxseSB3ZSByZWFsbHkgd2FudCBh
IEdQVSByZXNldCBoZXJlIHRvIG1ha2Ugc3VyZSBlcnJvcnMKKwkgKiBhcmVuJ3QgcHJvcGFnYXRl
ZC4gU2luY2UgSSBjYW5ub3QgZmluZCBhIHN0YWJsZSB3YXkgdG8gcmVzZXQgdGhlIEdQVQorCSAq
IGF0IHRoaXMgcG9pbnQgaXQgaXMgbGVmdCBhcyBhIFRPRE8uCisJICovCiAKLQlyZXR1cm4gcmV0
OworCXJldHVybiBjb3VudDsKIH0KIAogc3RhdGljIGNvbnN0IHN0cnVjdCBiaW5fYXR0cmlidXRl
IGRwZl9hdHRycyA9IHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdHJh
Y2UuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdHJhY2UuaAppbmRleCAxZjJjZjZjZmFm
YjUuLjdlZjdhMWUxNjY0YyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV90
cmFjZS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdHJhY2UuaApAQCAtOTUyLDcg
Kzk1Miw3IEBAIERFQ0xBUkVfRVZFTlRfQ0xBU1MoaTkxNV9jb250ZXh0LAogCVRQX2Zhc3RfYXNz
aWduKAogCQkJX19lbnRyeS0+ZGV2ID0gY3R4LT5pOTE1LT5kcm0ucHJpbWFyeS0+aW5kZXg7CiAJ
CQlfX2VudHJ5LT5jdHggPSBjdHg7Ci0JCQlfX2VudHJ5LT52bSA9IGN0eC0+dm07CisJCQlfX2Vu
dHJ5LT52bSA9IHJjdV9hY2Nlc3NfcG9pbnRlcihjdHgtPnZtKTsKIAkpLAogCiAJVFBfcHJpbnRr
KCJkZXY9JXUsIGN0eD0lcCwgY3R4X3ZtPSVwIiwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2k5MTVfZ2VtLmMKaW5kZXggMDM0NmMzZTViNmI2Li5iZmE0MGE1YjZkOTggMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbS5jCkBAIC0xMzgsMTEgKzEzOCw5IEBA
IHN0YXRpYyBpbnQgaWd0X2dlbV9zdXNwZW5kKHZvaWQgKmFyZykKIAkJcmV0dXJuIFBUUl9FUlIo
ZmlsZSk7CiAKIAllcnIgPSAtRU5PTUVNOwotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCWN0eCA9IGxpdmVfY29udGV4dChpOTE1LCBmaWxlKTsKIAlpZiAoIUlTX0VSUihj
dHgpKQogCQllcnIgPSBzd2l0Y2hfdG9fY29udGV4dChpOTE1LCBjdHgpOwotCW11dGV4X3VubG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKGVycikKIAkJZ290byBvdXQ7CiAKQEAg
LTE1Nyw5ICsxNTUsNyBAQCBzdGF0aWMgaW50IGlndF9nZW1fc3VzcGVuZCh2b2lkICphcmcpCiAK
IAlwbV9yZXN1bWUoaTkxNSk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKIAllcnIgPSBzd2l0Y2hfdG9fY29udGV4dChpOTE1LCBjdHgpOwotCW11dGV4X3VubG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiBvdXQ6CiAJbW9ja19maWxlX2ZyZWUoaTkxNSwgZmls
ZSk7CiAJcmV0dXJuIGVycjsKQEAgLTE3NywxMSArMTczLDkgQEAgc3RhdGljIGludCBpZ3RfZ2Vt
X2hpYmVybmF0ZSh2b2lkICphcmcpCiAJCXJldHVybiBQVFJfRVJSKGZpbGUpOwogCiAJZXJyID0g
LUVOT01FTTsKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAljdHggPSBs
aXZlX2NvbnRleHQoaTkxNSwgZmlsZSk7CiAJaWYgKCFJU19FUlIoY3R4KSkKIAkJZXJyID0gc3dp
dGNoX3RvX2NvbnRleHQoaTkxNSwgY3R4KTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCWlmIChlcnIpCiAJCWdvdG8gb3V0OwogCkBAIC0xOTYsOSArMTkwLDcgQEAg
c3RhdGljIGludCBpZ3RfZ2VtX2hpYmVybmF0ZSh2b2lkICphcmcpCiAKIAlwbV9yZXN1bWUoaTkx
NSk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAllcnIgPSBzd2l0
Y2hfdG9fY29udGV4dChpOTE1LCBjdHgpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7CiBvdXQ6CiAJbW9ja19maWxlX2ZyZWUoaTkxNSwgZmlsZSk7CiAJcmV0dXJuIGVy
cjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9l
dmljdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMK
aW5kZXggZjM5ZjAyODJlNzhjLi4wYWY5YTU4ZDAxMWQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5jCkBAIC00NzMsNyArNDczLDYgQEAgc3Rh
dGljIGludCBpZ3RfZXZpY3RfY29udGV4dHModm9pZCAqYXJnKQogCQl9CiAKIAkJY291bnQgPSAw
OwotCQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJb25zdGFja19mZW5j
ZV9pbml0KCZmZW5jZSk7CiAJCWRvIHsKIAkJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwpAQCAt
NTEwLDggKzUwOSw2IEBAIHN0YXRpYyBpbnQgaWd0X2V2aWN0X2NvbnRleHRzKHZvaWQgKmFyZykK
IAkJCWNvdW50Kys7CiAJCQllcnIgPSAwOwogCQl9IHdoaWxlKDEpOwotCQltdXRleF91bmxvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJCW9uc3RhY2tfZmVuY2VfZmluaSgmZmVuY2Up
OwogCQlwcl9pbmZvKCJTdWJtaXR0ZWQgJWx1IGNvbnRleHRzL3JlcXVlc3RzIG9uICVzXG4iLAog
CQkJY291bnQsIGVuZ2luZS0+bmFtZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaTkxNV9nZW1fZ3R0LmMKaW5kZXggZTQwZTZjZmE1MWYxLi44ZDgxMjFjMDIxNjEgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ndHQuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMKQEAgLTEyNDYs
NiArMTI0Niw3IEBAIHN0YXRpYyBpbnQgZXhlcmNpc2VfbW9jayhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwKIAkJCQkgICAgIHVuc2lnbmVkIGxvbmcgZW5kX3RpbWUpKQogewogCWNvbnN0
IHU2NCBsaW1pdCA9IHRvdGFscmFtX3BhZ2VzKCkgPDwgUEFHRV9TSElGVDsKKwlzdHJ1Y3QgaTkx
NV9hZGRyZXNzX3NwYWNlICp2bTsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwogCUlH
VF9USU1FT1VUKGVuZF90aW1lKTsKIAlpbnQgZXJyOwpAQCAtMTI1NCw3ICsxMjU1LDkgQEAgc3Rh
dGljIGludCBleGVyY2lzZV9tb2NrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCWlm
ICghY3R4KQogCQlyZXR1cm4gLUVOT01FTTsKIAotCWVyciA9IGZ1bmMoaTkxNSwgY3R4LT52bSwg
MCwgbWluKGN0eC0+dm0tPnRvdGFsLCBsaW1pdCksIGVuZF90aW1lKTsKKwl2bSA9IGk5MTVfZ2Vt
X2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOworCWVyciA9IGZ1bmMoaTkxNSwgdm0sIDAsIG1pbih2
bS0+dG90YWwsIGxpbWl0KSwgZW5kX3RpbWUpOworCWk5MTVfdm1fcHV0KHZtKTsKIAogCW1vY2tf
Y29udGV4dF9jbG9zZShjdHgpOwogCXJldHVybiBlcnI7CkBAIC0xODAxLDE1ICsxODA0LDE1IEBA
IHN0YXRpYyBpbnQgaWd0X2NzX3RsYih2b2lkICphcmcpCiAJCWdvdG8gb3V0X3VubG9jazsKIAl9
CiAKLQl2bSA9IGN0eC0+dm07Ci0JaWYgKCF2bSkKLQkJZ290byBvdXRfdW5sb2NrOworCXZtID0g
aTkxNV9nZW1fY29udGV4dF9nZXRfdm1fcmN1KGN0eCk7CisJaWYgKGk5MTVfaXNfZ2d0dCh2bSkp
CisJCWdvdG8gb3V0X3ZtOwogCiAJLyogQ3JlYXRlIHR3byBwYWdlczsgZHVtbXkgd2UgcHJlZmls
bCB0aGUgVExCLCBhbmQgaW50ZW5kZWQgKi8KIAliYmUgPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRl
X2ludGVybmFsKGk5MTUsIFBBR0VfU0laRSk7CiAJaWYgKElTX0VSUihiYmUpKSB7CiAJCWVyciA9
IFBUUl9FUlIoYmJlKTsKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3RvIG91dF92bTsKIAl9CiAK
IAliYXRjaCA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKGJiZSwgSTkxNV9NQVBfV0MpOwpAQCAt
MjAxNCw2ICsyMDE3LDggQEAgc3RhdGljIGludCBpZ3RfY3NfdGxiKHZvaWQgKmFyZykKIAlpOTE1
X2dlbV9vYmplY3RfcHV0KGFjdCk7CiBvdXRfcHV0X2JiZToKIAlpOTE1X2dlbV9vYmplY3RfcHV0
KGJiZSk7CitvdXRfdm06CisJaTkxNV92bV9wdXQodm0pOwogb3V0X3VubG9jazoKIAltdXRleF91
bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCW1vY2tfZmlsZV9mcmVlKGk5MTUsIGZp
bGUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcmVx
dWVzdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcmVxdWVzdC5jCmlu
ZGV4IGQ3ZDY4YzZhNmJkNS4uMDg5N2E3YjA0OTQ0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvc2VsZnRlc3RzL2k5MTVfcmVxdWVzdC5jCkBAIC0xODEsOSArMTgxLDcgQEAgc3RhdGljIGlu
dCBpZ3RfcmVxdWVzdF9yZXdpbmQodm9pZCAqYXJnKQogCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpj
ZTsKIAlpbnQgZXJyID0gLUVJTlZBTDsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCWN0eFswXSA9IG1vY2tfY29udGV4dChpOTE1LCAiQSIpOwotCW11dGV4X3VubG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAljZSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0
X2VuZ2luZShjdHhbMF0sIFJDUzApOwogCUdFTV9CVUdfT04oSVNfRVJSKGNlKSk7CkBAIC0xOTcs
OSArMTk1LDcgQEAgc3RhdGljIGludCBpZ3RfcmVxdWVzdF9yZXdpbmQodm9pZCAqYXJnKQogCWk5
MTVfcmVxdWVzdF9nZXQocmVxdWVzdCk7CiAJaTkxNV9yZXF1ZXN0X2FkZChyZXF1ZXN0KTsKIAot
CW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWN0eFsxXSA9IG1vY2tfY29u
dGV4dChpOTE1LCAiQiIpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiAKIAljZSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X2VuZ2luZShjdHhbMV0sIFJDUzApOwogCUdF
TV9CVUdfT04oSVNfRVJSKGNlKSk7CkBAIC00MzgsOSArNDM0LDcgQEAgc3RhdGljIGludCBtb2Nr
X2JyZWFkY3J1bWJzX3Ntb2tldGVzdCh2b2lkICphcmcpCiAJfQogCiAJZm9yIChuID0gMDsgbiA8
IHQubmNvbnRleHRzOyBuKyspIHsKLQkJbXV0ZXhfbG9jaygmdC5lbmdpbmUtPmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCQl0LmNvbnRleHRzW25dID0gbW9ja19jb250ZXh0KHQuZW5naW5lLT5p
OTE1LCAibW9jayIpOwotCQltdXRleF91bmxvY2soJnQuZW5naW5lLT5pOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKIAkJaWYgKCF0LmNvbnRleHRzW25dKSB7CiAJCQlyZXQgPSAtRU5PTUVNOwogCQkJ
Z290byBvdXRfY29udGV4dHM7CkBAIC03MzQsOSArNzI4LDkgQEAgc3RhdGljIGludCBsaXZlX2Vt
cHR5X3JlcXVlc3Qodm9pZCAqYXJnKQogc3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqcmVjdXJzaXZl
X2JhdGNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0cnVjdCBpOTE1X2dl
bV9jb250ZXh0ICpjdHggPSBpOTE1LT5rZXJuZWxfY29udGV4dDsKLQlzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlICp2bSA9IGN0eC0+dm0gPzogJmk5MTUtPmdndHQudm07CiAJc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iajsKIAljb25zdCBpbnQgZ2VuID0gSU5URUxfR0VOKGk5MTUpOwor
CXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwog
CXUzMiAqY21kOwogCWludCBlcnI7CkBAIC03NDUsNyArNzM5LDkgQEAgc3RhdGljIHN0cnVjdCBp
OTE1X3ZtYSAqcmVjdXJzaXZlX2JhdGNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
CWlmIChJU19FUlIob2JqKSkKIAkJcmV0dXJuIEVSUl9DQVNUKG9iaik7CiAKKwl2bSA9IGk5MTVf
Z2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOwogCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9i
aiwgdm0sIE5VTEwpOworCWk5MTVfdm1fcHV0KHZtKTsKIAlpZiAoSVNfRVJSKHZtYSkpIHsKIAkJ
ZXJyID0gUFRSX0VSUih2bWEpOwogCQlnb3RvIGVycjsKQEAgLTEyMjAsOSArMTIxNiw3IEBAIHN0
YXRpYyBpbnQgbGl2ZV9icmVhZGNydW1ic19zbW9rZXRlc3Qodm9pZCAqYXJnKQogCX0KIAogCWZv
ciAobiA9IDA7IG4gPCB0WzBdLm5jb250ZXh0czsgbisrKSB7Ci0JCW11dGV4X2xvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQl0WzBdLmNvbnRleHRzW25dID0gbGl2ZV9jb250ZXh0KGk5
MTUsIGZpbGUpOwotCQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQlp
ZiAoIXRbMF0uY29udGV4dHNbbl0pIHsKIAkJCXJldCA9IC1FTk9NRU07CiAJCQlnb3RvIG91dF9j
b250ZXh0czsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1
X3ZtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfdm1hLmMKaW5kZXgg
YWMxZmY1NThlYjkwLi41OGI1ZjQwYTA3ZGQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9pOTE1X3ZtYS5jCkBAIC0yNCw2ICsyNCw3IEBACiAKICNpbmNsdWRlIDxsaW51eC9wcmlt
ZV9udW1iZXJzLmg+CiAKKyNpbmNsdWRlICJnZW0vaTkxNV9nZW1fY29udGV4dC5oIgogI2luY2x1
ZGUgImdlbS9zZWxmdGVzdHMvbW9ja19jb250ZXh0LmgiCiAKICNpbmNsdWRlICJpOTE1X3NjYXR0
ZXJsaXN0LmgiCkBAIC0zOCw3ICszOSw3IEBAIHN0YXRpYyBib29sIGFzc2VydF92bWEoc3RydWN0
IGk5MTVfdm1hICp2bWEsCiB7CiAJYm9vbCBvayA9IHRydWU7CiAKLQlpZiAodm1hLT52bSAhPSBj
dHgtPnZtKSB7CisJaWYgKHZtYS0+dm0gIT0gcmN1X2FjY2Vzc19wb2ludGVyKGN0eC0+dm0pKSB7
CiAJCXByX2VycigiVk1BIGNyZWF0ZWQgd2l0aCB3cm9uZyBWTVxuIik7CiAJCW9rID0gZmFsc2U7
CiAJfQpAQCAtMTEzLDExICsxMTQsMTMgQEAgc3RhdGljIGludCBjcmVhdGVfdm1hcyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KG9iaiwgb2JqZWN0
cywgc3RfbGluaykgewogCQlmb3IgKHBpbm5lZCA9IDA7IHBpbm5lZCA8PSAxOyBwaW5uZWQrKykg
ewogCQkJbGlzdF9mb3JfZWFjaF9lbnRyeShjdHgsIGNvbnRleHRzLCBsaW5rKSB7Ci0JCQkJc3Ry
dWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSBjdHgtPnZtOworCQkJCXN0cnVjdCBpOTE1X2Fk
ZHJlc3Nfc3BhY2UgKnZtOwogCQkJCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCQkJCWludCBlcnI7
CiAKKwkJCQl2bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOwogCQkJCXZtYSA9
IGNoZWNrZWRfdm1hX2luc3RhbmNlKG9iaiwgdm0sIE5VTEwpOworCQkJCWk5MTVfdm1fcHV0KHZt
KTsKIAkJCQlpZiAoSVNfRVJSKHZtYSkpCiAJCQkJCXJldHVybiBQVFJfRVJSKHZtYSk7CiAKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2Uu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYwppbmRl
eCA0ZTZjZGUwZDQ4NTkuLjMzNWYzN2JhOThkZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYwpAQCAtNTksMTEgKzU5LDkgQEAgc3RhdGlj
IHZvaWQgbW9ja19kZXZpY2VfcmVsZWFzZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCiAJaTkx
NV9nZW1fZHJhaW5fd29ya3F1ZXVlKGk5MTUpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpCiAJCW1vY2tf
ZW5naW5lX2ZyZWUoZW5naW5lKTsKLQlpOTE1X2dlbV9jb250ZXh0c19maW5pKGk5MTUpOwotCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJaTkxNV9nZW1fZHJpdmVyX3Jl
bGVhc2VfX2NvbnRleHRzKGk5MTUpOwogCiAJaW50ZWxfdGltZWxpbmVzX2ZpbmkoaTkxNSk7CiAK
QEAgLTIwNiw3ICsyMDQsNyBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqbW9ja19nZW1fZGV2
aWNlKHZvaWQpCiAJcmV0dXJuIGk5MTU7CiAKIGVycl9jb250ZXh0OgotCWk5MTVfZ2VtX2NvbnRl
eHRzX2ZpbmkoaTkxNSk7CisJaTkxNV9nZW1fZHJpdmVyX3JlbGVhc2VfX2NvbnRleHRzKGk5MTUp
OwogZXJyX2VuZ2luZToKIAltb2NrX2VuZ2luZV9mcmVlKGk5MTUtPmVuZ2luZVtSQ1MwXSk7CiBl
cnJfdW5sb2NrOgotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVl
ZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5m
by9pbnRlbC1nZng=

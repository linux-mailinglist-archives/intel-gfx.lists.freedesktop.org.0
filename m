Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9B2F2C0BFA
	for <lists+intel-gfx@lfdr.de>; Fri, 27 Sep 2019 21:15:10 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 42E266E202;
	Fri, 27 Sep 2019 19:15:08 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id EDFDB6E201
 for <intel-gfx@lists.freedesktop.org>; Fri, 27 Sep 2019 19:15:06 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18644037-1500050 
 for multiple; Fri, 27 Sep 2019 20:14:47 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 27 Sep 2019 20:14:42 +0100
Message-Id: <20190927191443.14126-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 1/2] drm/i915/selftests: Provide a mock GPU
 reset routine
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Rm9yIHRob3NlIG1vY2sgdGVzdHMgdGhhdCBtYXkgd2lzaCB0byBwcmV0ZW5kIHRyaWdnZXJpbmcg
YSBHUFUgcmVzZXQgYW5kCnByb2Nlc3NpbmcgdGhlIGNsZWFudXAuCgpTaWduZWQtb2ZmLWJ5OiBD
aHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IEFuZGkgU2h5dGkgPGFu
ZGkuc2h5dGlAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheS5jICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZXNl
dC5jICAgICAgICAgfCAzMiArKysrKysrKysrKysrLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9yZXNldC5oICAgICAgICAgfCAgNSArKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jICB8IDEyICsrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2xyYy5jICAgICAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF9yZXNldC5jICAgICAgfCAgNCArLS0KIC4uLi9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3Rfd29ya2Fyb3VuZHMuYyAgICB8ICA4ICsrLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dldHBhcmFtLmMgICAgICAgICAgfCAgNCArLS0KIDggZmlsZXMgY2hhbmdlZCwgNDEg
aW5zZXJ0aW9ucygrKSwgMjggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRleCA4ZjEyNWYxNjI0YmQuLjc3NThhMzc0NDYyNiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTQy
NzMsNyArNDI3Myw3IEBAIF9faW50ZWxfZGlzcGxheV9yZXN1bWUoc3RydWN0IGRybV9kZXZpY2Ug
KmRldiwKIHN0YXRpYyBib29sIGdwdV9yZXNldF9jbG9iYmVyc19kaXNwbGF5KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKIAlyZXR1cm4gKElOVEVMX0lORk8oZGV2X3ByaXYp
LT5ncHVfcmVzZXRfY2xvYmJlcnNfZGlzcGxheSAmJgotCQlpbnRlbF9oYXNfZ3B1X3Jlc2V0KGRl
dl9wcml2KSk7CisJCWludGVsX2hhc19ncHVfcmVzZXQoJmRldl9wcml2LT5ndCkpOwogfQogCiB2
b2lkIGludGVsX3ByZXBhcmVfcmVzZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMKaW5kZXggZDA4MjI2ZjViZWE1Li43
NjkzOGZhM2ExYjkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jl
c2V0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYwpAQCAtNTQy
LDEzICs1NDIsMjQgQEAgc3RhdGljIGludCBnZW44X3Jlc2V0X2VuZ2luZXMoc3RydWN0IGludGVs
X2d0ICpndCwKIAlyZXR1cm4gcmV0OwogfQogCitzdGF0aWMgaW50IG1vY2tfcmVzZXQoc3RydWN0
IGludGVsX2d0ICpndCwKKwkJICAgICAgaW50ZWxfZW5naW5lX21hc2tfdCBtYXNrLAorCQkgICAg
ICB1bnNpZ25lZCBpbnQgcmV0cnkpCit7CisJcmV0dXJuIDA7Cit9CisKIHR5cGVkZWYgaW50ICgq
cmVzZXRfZnVuYykoc3RydWN0IGludGVsX2d0ICosCiAJCQkgIGludGVsX2VuZ2luZV9tYXNrX3Qg
ZW5naW5lX21hc2ssCiAJCQkgIHVuc2lnbmVkIGludCByZXRyeSk7CiAKLXN0YXRpYyByZXNldF9m
dW5jIGludGVsX2dldF9ncHVfcmVzZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCitz
dGF0aWMgcmVzZXRfZnVuYyBpbnRlbF9nZXRfZ3B1X3Jlc2V0KGNvbnN0IHN0cnVjdCBpbnRlbF9n
dCAqZ3QpCiB7Ci0JaWYgKElOVEVMX0dFTihpOTE1KSA+PSA4KQorCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gZ3QtPmk5MTU7CisKKwlpZiAoaXNfbW9ja19ndChndCkpCisJCXJldHVy
biBtb2NrX3Jlc2V0OworCWVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+PSA4KQogCQlyZXR1cm4g
Z2VuOF9yZXNldF9lbmdpbmVzOwogCWVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+PSA2KQogCQly
ZXR1cm4gZ2VuNl9yZXNldF9lbmdpbmVzOwpAQCAtNTcxLDcgKzU4Miw3IEBAIGludCBfX2ludGVs
X2d0X3Jlc2V0KHN0cnVjdCBpbnRlbF9ndCAqZ3QsIGludGVsX2VuZ2luZV9tYXNrX3QgZW5naW5l
X21hc2spCiAJaW50IHJldCA9IC1FVElNRURPVVQ7CiAJaW50IHJldHJ5OwogCi0JcmVzZXQgPSBp
bnRlbF9nZXRfZ3B1X3Jlc2V0KGd0LT5pOTE1KTsKKwlyZXNldCA9IGludGVsX2dldF9ncHVfcmVz
ZXQoZ3QpOwogCWlmICghcmVzZXQpCiAJCXJldHVybiAtRU5PREVWOwogCkBAIC01OTEsMTcgKzYw
MiwyMCBAQCBpbnQgX19pbnRlbF9ndF9yZXNldChzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBpbnRlbF9l
bmdpbmVfbWFza190IGVuZ2luZV9tYXNrKQogCXJldHVybiByZXQ7CiB9CiAKLWJvb2wgaW50ZWxf
aGFzX2dwdV9yZXNldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK2Jvb2wgaW50ZWxf
aGFzX2dwdV9yZXNldChjb25zdCBzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogewogCWlmICghaTkxNV9t
b2RwYXJhbXMucmVzZXQpCiAJCXJldHVybiBOVUxMOwogCi0JcmV0dXJuIGludGVsX2dldF9ncHVf
cmVzZXQoaTkxNSk7CisJcmV0dXJuIGludGVsX2dldF9ncHVfcmVzZXQoZ3QpOwogfQogCi1ib29s
IGludGVsX2hhc19yZXNldF9lbmdpbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiti
b29sIGludGVsX2hhc19yZXNldF9lbmdpbmUoY29uc3Qgc3RydWN0IGludGVsX2d0ICpndCkKIHsK
LQlyZXR1cm4gSU5URUxfSU5GTyhpOTE1KS0+aGFzX3Jlc2V0X2VuZ2luZSAmJiBpOTE1X21vZHBh
cmFtcy5yZXNldCA+PSAyOworCWlmIChpOTE1X21vZHBhcmFtcy5yZXNldCA8IDIpCisJCXJldHVy
biBmYWxzZTsKKworCXJldHVybiBJTlRFTF9JTkZPKGd0LT5pOTE1KS0+aGFzX3Jlc2V0X2VuZ2lu
ZTsKIH0KIAogaW50IGludGVsX3Jlc2V0X2d1YyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQpAQCAtOTU4
LDcgKzk3Miw3IEBAIHZvaWQgaW50ZWxfZ3RfcmVzZXQoc3RydWN0IGludGVsX2d0ICpndCwKIAog
CWF3YWtlID0gcmVzZXRfcHJlcGFyZShndCk7CiAKLQlpZiAoIWludGVsX2hhc19ncHVfcmVzZXQo
Z3QtPmk5MTUpKSB7CisJaWYgKCFpbnRlbF9oYXNfZ3B1X3Jlc2V0KGd0KSkgewogCQlpZiAoaTkx
NV9tb2RwYXJhbXMucmVzZXQpCiAJCQlkZXZfZXJyKGd0LT5pOTE1LT5kcm0uZGV2LCAiR1BVIHJl
c2V0IG5vdCBzdXBwb3J0ZWRcbiIpOwogCQllbHNlCkBAIC0xMTc5LDcgKzExOTMsNyBAQCB2b2lk
IGludGVsX2d0X2hhbmRsZV9lcnJvcihzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCSAqIFRyeSBlbmdp
bmUgcmVzZXQgd2hlbiBhdmFpbGFibGUuIFdlIGZhbGwgYmFjayB0byBmdWxsIHJlc2V0IGlmCiAJ
ICogc2luZ2xlIHJlc2V0IGZhaWxzLgogCSAqLwotCWlmIChpbnRlbF9oYXNfcmVzZXRfZW5naW5l
KGd0LT5pOTE1KSAmJiAhaW50ZWxfZ3RfaXNfd2VkZ2VkKGd0KSkgeworCWlmIChpbnRlbF9oYXNf
cmVzZXRfZW5naW5lKGd0KSAmJiAhaW50ZWxfZ3RfaXNfd2VkZ2VkKGd0KSkgewogCQlmb3JfZWFj
aF9lbmdpbmVfbWFza2VkKGVuZ2luZSwgZ3QtPmk5MTUsIGVuZ2luZV9tYXNrLCB0bXApIHsKIAkJ
CUJVSUxEX0JVR19PTihJOTE1X1JFU0VUX01PREVTRVQgPj0gSTkxNV9SRVNFVF9FTkdJTkUpOwog
CQkJaWYgKHRlc3RfYW5kX3NldF9iaXQoSTkxNV9SRVNFVF9FTkdJTkUgKyBlbmdpbmUtPmlkLApk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuaCBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmgKaW5kZXggMGI2ZmYxZWU3ZjA2Li44ZThk
NWY3NjExNjYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0
LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuaApAQCAtMTQsNyAr
MTQsNiBAQAogI2luY2x1ZGUgImludGVsX2VuZ2luZV90eXBlcy5oIgogI2luY2x1ZGUgImludGVs
X3Jlc2V0X3R5cGVzLmgiCiAKLXN0cnVjdCBkcm1faTkxNV9wcml2YXRlOwogc3RydWN0IGk5MTVf
cmVxdWVzdDsKIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3M7CiBzdHJ1Y3QgaW50ZWxfZ3Q7CkBAIC04
MCw3ICs3OSw3IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBfX2ludGVsX3Jlc2V0X2ZhaWxlZChjb25z
dCBzdHJ1Y3QgaW50ZWxfcmVzZXQgKnJlc2V0KQogCXJldHVybiB1bmxpa2VseSh0ZXN0X2JpdChJ
OTE1X1dFREdFRCwgJnJlc2V0LT5mbGFncykpOwogfQogCi1ib29sIGludGVsX2hhc19ncHVfcmVz
ZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwotYm9vbCBpbnRlbF9oYXNfcmVzZXRf
ZW5naW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK2Jvb2wgaW50ZWxfaGFzX2dw
dV9yZXNldChjb25zdCBzdHJ1Y3QgaW50ZWxfZ3QgKmd0KTsKK2Jvb2wgaW50ZWxfaGFzX3Jlc2V0
X2VuZ2luZShjb25zdCBzdHJ1Y3QgaW50ZWxfZ3QgKmd0KTsKIAogI2VuZGlmIC8qIEk5MTVfUkVT
RVRfSCAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFu
Z2NoZWNrLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYwpp
bmRleCBhMDA5OGZjMzU5MjEuLjljMGM4NDQxYzIyYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMKQEAgLTQ1OCw3ICs0NTgsNyBAQCBzdGF0aWMgaW50
IGlndF9yZXNldF9ub3BfZW5naW5lKHZvaWQgKmFyZykKIAogCS8qIENoZWNrIHRoYXQgd2UgY2Fu
IGVuZ2luZS1yZXNldCBkdXJpbmcgbm9uLXVzZXIgcG9ydGlvbnMgKi8KIAotCWlmICghaW50ZWxf
aGFzX3Jlc2V0X2VuZ2luZShndC0+aTkxNSkpCisJaWYgKCFpbnRlbF9oYXNfcmVzZXRfZW5naW5l
KGd0KSkKIAkJcmV0dXJuIDA7CiAKIAlmaWxlID0gbW9ja19maWxlKGd0LT5pOTE1KTsKQEAgLTU1
OSw3ICs1NTksNyBAQCBzdGF0aWMgaW50IF9faWd0X3Jlc2V0X2VuZ2luZShzdHJ1Y3QgaW50ZWxf
Z3QgKmd0LCBib29sIGFjdGl2ZSkKIAogCS8qIENoZWNrIHRoYXQgd2UgY2FuIGlzc3VlIGFuIGVu
Z2luZSByZXNldCBvbiBhbiBpZGxlIGVuZ2luZSAobm8tb3ApICovCiAKLQlpZiAoIWludGVsX2hh
c19yZXNldF9lbmdpbmUoZ3QtPmk5MTUpKQorCWlmICghaW50ZWxfaGFzX3Jlc2V0X2VuZ2luZShn
dCkpCiAJCXJldHVybiAwOwogCiAJaWYgKGFjdGl2ZSkgewpAQCAtNzkxLDcgKzc5MSw3IEBAIHN0
YXRpYyBpbnQgX19pZ3RfcmVzZXRfZW5naW5lcyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCSAqIHdp
dGggYW55IG90aGVyIGVuZ2luZS4KIAkgKi8KIAotCWlmICghaW50ZWxfaGFzX3Jlc2V0X2VuZ2lu
ZShndC0+aTkxNSkpCisJaWYgKCFpbnRlbF9oYXNfcmVzZXRfZW5naW5lKGd0KSkKIAkJcmV0dXJu
IDA7CiAKIAlpZiAoZmxhZ3MgJiBURVNUX0FDVElWRSkgewpAQCAtMTU0Nyw3ICsxNTQ3LDcgQEAg
c3RhdGljIGludCBpZ3RfaGFuZGxlX2Vycm9yKHZvaWQgKmFyZykKIAogCS8qIENoZWNrIHRoYXQg
d2UgY2FuIGlzc3VlIGEgZ2xvYmFsIEdQVSBhbmQgZW5naW5lIHJlc2V0ICovCiAKLQlpZiAoIWlu
dGVsX2hhc19yZXNldF9lbmdpbmUoZ3QtPmk5MTUpKQorCWlmICghaW50ZWxfaGFzX3Jlc2V0X2Vu
Z2luZShndCkpCiAJCXJldHVybiAwOwogCiAJaWYgKCFlbmdpbmUgfHwgIWludGVsX2VuZ2luZV9j
YW5fc3RvcmVfZHdvcmQoZW5naW5lKSkKQEAgLTE2ODksNyArMTY4OSw3IEBAIHN0YXRpYyBpbnQg
aWd0X3Jlc2V0X2VuZ2luZXNfYXRvbWljKHZvaWQgKmFyZykKIAogCS8qIENoZWNrIHRoYXQgdGhl
IGVuZ2luZXMgcmVzZXRzIGFyZSB1c2FibGUgZnJvbSBhdG9taWMgY29udGV4dCAqLwogCi0JaWYg
KCFpbnRlbF9oYXNfcmVzZXRfZW5naW5lKGd0LT5pOTE1KSkKKwlpZiAoIWludGVsX2hhc19yZXNl
dF9lbmdpbmUoZ3QpKQogCQlyZXR1cm4gMDsKIAogCWlmIChVU0VTX0dVQ19TVUJNSVNTSU9OKGd0
LT5pOTE1KSkKQEAgLTE3NDYsNyArMTc0Niw3IEBAIGludCBpbnRlbF9oYW5nY2hlY2tfbGl2ZV9z
ZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJYm9vbCBzYXZlZF9oYW5n
Y2hlY2s7CiAJaW50IGVycjsKIAotCWlmICghaW50ZWxfaGFzX2dwdV9yZXNldChndC0+aTkxNSkp
CisJaWYgKCFpbnRlbF9oYXNfZ3B1X3Jlc2V0KGd0KSkKIAkJcmV0dXJuIDA7CiAKIAlpZiAoaW50
ZWxfZ3RfaXNfd2VkZ2VkKGd0KSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3NlbGZ0ZXN0X2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMK
aW5kZXggMjJlYTJlNzQ3MDY0Li45M2YyZmNkYzQ5YmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3NlbGZ0ZXN0X2xyYy5jCkBAIC0xMzEwLDcgKzEzMTAsNyBAQCBzdGF0aWMgaW50IGxpdmVfcHJl
ZW1wdF9oYW5nKHZvaWQgKmFyZykKIAlpZiAoIUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1QVElPTihp
OTE1KSkKIAkJcmV0dXJuIDA7CiAKLQlpZiAoIWludGVsX2hhc19yZXNldF9lbmdpbmUoaTkxNSkp
CisJaWYgKCFpbnRlbF9oYXNfcmVzZXRfZW5naW5lKCZpOTE1LT5ndCkpCiAJCXJldHVybiAwOwog
CiAJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9yZXNldC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Qvc2VsZnRlc3RfcmVzZXQuYwppbmRleCAwMGE0ZjYwY2RmZDUuLmQ3OTQ4MmRiN2ZlOCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfcmVzZXQuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9yZXNldC5jCkBAIC0xMTIsNyArMTEy
LDcgQEAgc3RhdGljIGludCBpZ3RfYXRvbWljX2VuZ2luZV9yZXNldCh2b2lkICphcmcpCiAKIAkv
KiBDaGVjayB0aGF0IHRoZSByZXNldHMgYXJlIHVzYWJsZSBmcm9tIGF0b21pYyBjb250ZXh0ICov
CiAKLQlpZiAoIWludGVsX2hhc19yZXNldF9lbmdpbmUoZ3QtPmk5MTUpKQorCWlmICghaW50ZWxf
aGFzX3Jlc2V0X2VuZ2luZShndCkpCiAJCXJldHVybiAwOwogCiAJaWYgKFVTRVNfR1VDX1NVQk1J
U1NJT04oZ3QtPmk5MTUpKQpAQCAtMTcwLDcgKzE3MCw3IEBAIGludCBpbnRlbF9yZXNldF9saXZl
X3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAl9OwogCXN0cnVjdCBp
bnRlbF9ndCAqZ3QgPSAmaTkxNS0+Z3Q7CiAKLQlpZiAoIWludGVsX2hhc19ncHVfcmVzZXQoZ3Qt
Pmk5MTUpKQorCWlmICghaW50ZWxfaGFzX2dwdV9yZXNldChndCkpCiAJCXJldHVybiAwOwogCiAJ
aWYgKGludGVsX2d0X2lzX3dlZGdlZChndCkpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3Rfd29ya2Fyb3VuZHMuYwppbmRleCA5OTlhOThmMDA0OTQuLmQ0MGNlMDcwOWJmZiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29ya2Fyb3VuZHMu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jCkBA
IC03NDcsNyArNzQ3LDcgQEAgc3RhdGljIGludCBsaXZlX3Jlc2V0X3doaXRlbGlzdCh2b2lkICph
cmcpCiAKIAlpZ3RfZ2xvYmFsX3Jlc2V0X2xvY2soJmk5MTUtPmd0KTsKIAotCWlmIChpbnRlbF9o
YXNfcmVzZXRfZW5naW5lKGk5MTUpKSB7CisJaWYgKGludGVsX2hhc19yZXNldF9lbmdpbmUoJmk5
MTUtPmd0KSkgewogCQllcnIgPSBjaGVja193aGl0ZWxpc3RfYWNyb3NzX3Jlc2V0KGVuZ2luZSwK
IAkJCQkJCSAgIGRvX2VuZ2luZV9yZXNldCwKIAkJCQkJCSAgICJlbmdpbmUiKTsKQEAgLTc1NSw3
ICs3NTUsNyBAQCBzdGF0aWMgaW50IGxpdmVfcmVzZXRfd2hpdGVsaXN0KHZvaWQgKmFyZykKIAkJ
CWdvdG8gb3V0OwogCX0KIAotCWlmIChpbnRlbF9oYXNfZ3B1X3Jlc2V0KGk5MTUpKSB7CisJaWYg
KGludGVsX2hhc19ncHVfcmVzZXQoJmk5MTUtPmd0KSkgewogCQllcnIgPSBjaGVja193aGl0ZWxp
c3RfYWNyb3NzX3Jlc2V0KGVuZ2luZSwKIAkJCQkJCSAgIGRvX2RldmljZV9yZXNldCwKIAkJCQkJ
CSAgICJkZXZpY2UiKTsKQEAgLTExMzEsNyArMTEzMSw3IEBAIGxpdmVfZ3B1X3Jlc2V0X3dvcmth
cm91bmRzKHZvaWQgKmFyZykKIAlzdHJ1Y3Qgd2FfbGlzdHMgbGlzdHM7CiAJYm9vbCBvazsKIAot
CWlmICghaW50ZWxfaGFzX2dwdV9yZXNldChpOTE1KSkKKwlpZiAoIWludGVsX2hhc19ncHVfcmVz
ZXQoJmk5MTUtPmd0KSkKIAkJcmV0dXJuIDA7CiAKIAljdHggPSBrZXJuZWxfY29udGV4dChpOTE1
KTsKQEAgLTExNzgsNyArMTE3OCw3IEBAIGxpdmVfZW5naW5lX3Jlc2V0X3dvcmthcm91bmRzKHZv
aWQgKmFyZykKIAlzdHJ1Y3Qgd2FfbGlzdHMgbGlzdHM7CiAJaW50IHJldCA9IDA7CiAKLQlpZiAo
IWludGVsX2hhc19yZXNldF9lbmdpbmUoaTkxNSkpCisJaWYgKCFpbnRlbF9oYXNfcmVzZXRfZW5n
aW5lKCZpOTE1LT5ndCkpCiAJCXJldHVybiAwOwogCiAJY3R4ID0ga2VybmVsX2NvbnRleHQoaTkx
NSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dldHBhcmFtLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dldHBhcmFtLmMKaW5kZXggNWQ5MTAxMzc2YTNkLi5m
NGIzY2JiMWFkY2UgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2V0cGFy
YW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dldHBhcmFtLmMKQEAgLTc5LDgg
Kzc5LDggQEAgaW50IGk5MTVfZ2V0cGFyYW1faW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwg
dm9pZCAqZGF0YSwKIAkJYnJlYWs7CiAJY2FzZSBJOTE1X1BBUkFNX0hBU19HUFVfUkVTRVQ6CiAJ
CXZhbHVlID0gaTkxNV9tb2RwYXJhbXMuZW5hYmxlX2hhbmdjaGVjayAmJgotCQkJaW50ZWxfaGFz
X2dwdV9yZXNldChpOTE1KTsKLQkJaWYgKHZhbHVlICYmIGludGVsX2hhc19yZXNldF9lbmdpbmUo
aTkxNSkpCisJCQlpbnRlbF9oYXNfZ3B1X3Jlc2V0KCZpOTE1LT5ndCk7CisJCWlmICh2YWx1ZSAm
JiBpbnRlbF9oYXNfcmVzZXRfZW5naW5lKCZpOTE1LT5ndCkpCiAJCQl2YWx1ZSA9IDI7CiAJCWJy
ZWFrOwogCWNhc2UgSTkxNV9QQVJBTV9IQVNfUkVTT1VSQ0VfU1RSRUFNRVI6Ci0tIAoyLjIzLjAK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdm
eCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xp
c3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

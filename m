Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id EC57B26791
	for <lists+intel-gfx@lfdr.de>; Wed, 22 May 2019 17:58:14 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 14DA889911;
	Wed, 22 May 2019 15:58:13 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3ABE789911
 for <intel-gfx@lists.freedesktop.org>; Wed, 22 May 2019 15:58:04 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16643347-1500050 
 for multiple; Wed, 22 May 2019 16:57:36 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 22 May 2019 16:57:35 +0100
Message-Id: <20190522155735.15597-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t] i915/gem_exec_fence: Replace open-coded
 recursive batch with igt_spin_t
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Matthew Auld <matthew.auld@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIG9ubHkgZGV0YWlsIG9mIG5vdGUgaGVyZSB3YXMgdGhhdCB3ZSB3ZXJlIGNyZWF0aW5nIGEg
ZmVuY2UgZnJvbSB0aGUKcmVjdXJzaXZlIGJhdGNoLCBub3cgc3VwcG9ydGVkIGJ5IGlndF9zcGlu
X3QgKHRoYW5rcyBUdnJ0a28pLgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0Bj
aHJpcy13aWxzb24uY28udWs+CkNjOiBUdnJ0a28gVXJzdWxpbiA8dHZydGtvLnVyc3VsaW5AaW50
ZWwuY29tPgpDYzogTWF0dGhldyBBdWxkIDxtYXR0aGV3LmF1bGRAaW50ZWwuY29tPgotLS0KIHRl
c3RzL2k5MTUvZ2VtX2V4ZWNfZmVuY2UuYyB8IDc0ICsrKysrKy0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAxMiBpbnNlcnRpb25zKCspLCA2MiBkZWxldGlv
bnMoLSkKCmRpZmYgLS1naXQgYS90ZXN0cy9pOTE1L2dlbV9leGVjX2ZlbmNlLmMgYi90ZXN0cy9p
OTE1L2dlbV9leGVjX2ZlbmNlLmMKaW5kZXggODEyMGY4YjU2Li40NTAxNzEwNWMgMTAwNjQ0Ci0t
LSBhL3Rlc3RzL2k5MTUvZ2VtX2V4ZWNfZmVuY2UuYworKysgYi90ZXN0cy9pOTE1L2dlbV9leGVj
X2ZlbmNlLmMKQEAgLTMxNyw2OCArMzE3LDIyIEBAIHN0YXRpYyB2b2lkIHRlc3RfZmVuY2VfYnVz
eV9hbGwoaW50IGZkLCB1bnNpZ25lZCBmbGFncykKIAogc3RhdGljIHZvaWQgdGVzdF9mZW5jZV9h
d2FpdChpbnQgZmQsIHVuc2lnbmVkIHJpbmcsIHVuc2lnbmVkIGZsYWdzKQogewotCWNvbnN0IGlu
dCBnZW4gPSBpbnRlbF9nZW4oaW50ZWxfZ2V0X2RybV9kZXZpZChmZCkpOwotCXN0cnVjdCBkcm1f
aTkxNV9nZW1fZXhlY19vYmplY3QyIG9iajsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX3JlbG9jYXRp
b25fZW50cnkgcmVsb2M7Ci0Jc3RydWN0IGRybV9pOTE1X2dlbV9leGVjYnVmZmVyMiBleGVjYnVm
OwogCXVpbnQzMl90IHNjcmF0Y2ggPSBnZW1fY3JlYXRlKGZkLCA0MDk2KTsKLQl1aW50MzJfdCAq
YmF0Y2gsICpvdXQ7CisJaWd0X3NwaW5fdCAqc3BpbjsKIAl1bnNpZ25lZCBlbmdpbmU7Ci0JaW50
IGZlbmNlLCBpOworCXVpbnQzMl90ICpvdXQ7CisJaW50IGk7CiAKIAlpZ3RfcmVxdWlyZShnZW1f
Y2FuX3N0b3JlX2R3b3JkKGZkLCAwKSk7CiAKLQltZW1zZXQoJmV4ZWNidWYsIDAsIHNpemVvZihl
eGVjYnVmKSk7Ci0JZXhlY2J1Zi5idWZmZXJzX3B0ciA9IHRvX3VzZXJfcG9pbnRlcigmb2JqKTsK
LQlleGVjYnVmLmJ1ZmZlcl9jb3VudCA9IDE7Ci0JZXhlY2J1Zi5mbGFncyA9IHJpbmcgfCBMT0NB
TF9FWEVDX0ZFTkNFX09VVDsKLQotCW1lbXNldCgmb2JqLCAwLCBzaXplb2Yob2JqKSk7Ci0Jb2Jq
LmhhbmRsZSA9IGdlbV9jcmVhdGUoZmQsIDQwOTYpOwotCi0Jb2JqLnJlbG9jc19wdHIgPSB0b191
c2VyX3BvaW50ZXIoJnJlbG9jKTsKLQlvYmoucmVsb2NhdGlvbl9jb3VudCA9IDE7Ci0JbWVtc2V0
KCZyZWxvYywgMCwgc2l6ZW9mKHJlbG9jKSk7Ci0KIAlvdXQgPSBnZW1fbW1hcF9fd2MoZmQsIHNj
cmF0Y2gsIDAsIDQwOTYsIFBST1RfV1JJVEUpOwotCWdlbV9zZXRfZG9tYWluKGZkLCBvYmouaGFu
ZGxlLAotCQkJSTkxNV9HRU1fRE9NQUlOX0dUVCwgSTkxNV9HRU1fRE9NQUlOX0dUVCk7Ci0KLQli
YXRjaCA9IGdlbV9tbWFwX193YyhmZCwgb2JqLmhhbmRsZSwgMCwgNDA5NiwgUFJPVF9XUklURSk7
Ci0JZ2VtX3NldF9kb21haW4oZmQsIG9iai5oYW5kbGUsCisJZ2VtX3NldF9kb21haW4oZmQsIHNj
cmF0Y2gsCiAJCQlJOTE1X0dFTV9ET01BSU5fR1RULCBJOTE1X0dFTV9ET01BSU5fR1RUKTsKIAot
CXJlbG9jLnRhcmdldF9oYW5kbGUgPSBvYmouaGFuZGxlOyAvKiByZWN1cnNlICovCi0JcmVsb2Mu
cHJlc3VtZWRfb2Zmc2V0ID0gMDsKLQlyZWxvYy5vZmZzZXQgPSBzaXplb2YodWludDMyX3QpOwot
CXJlbG9jLmRlbHRhID0gMDsKLQlyZWxvYy5yZWFkX2RvbWFpbnMgPSBJOTE1X0dFTV9ET01BSU5f
Q09NTUFORDsKLQlyZWxvYy53cml0ZV9kb21haW4gPSAwOwotCi0JaSA9IDA7Ci0JYmF0Y2hbaV0g
PSBNSV9CQVRDSF9CVUZGRVJfU1RBUlQ7Ci0JaWYgKGdlbiA+PSA4KSB7Ci0JCWJhdGNoW2ldIHw9
IDEgPDwgOCB8IDE7Ci0JCWJhdGNoWysraV0gPSAwOwotCQliYXRjaFsrK2ldID0gMDsKLQl9IGVs
c2UgaWYgKGdlbiA+PSA2KSB7Ci0JCWJhdGNoW2ldIHw9IDEgPDwgODsKLQkJYmF0Y2hbKytpXSA9
IDA7Ci0JfSBlbHNlIHsKLQkJYmF0Y2hbaV0gfD0gMiA8PCA2OwotCQliYXRjaFsrK2ldID0gMDsK
LQkJaWYgKGdlbiA8IDQpIHsKLQkJCWJhdGNoW2ldIHw9IDE7Ci0JCQlyZWxvYy5kZWx0YSA9IDE7
Ci0JCX0KLQl9Ci0JaSsrOwotCi0JZXhlY2J1Zi5yc3ZkMiA9IC0xOwotCWdlbV9leGVjYnVmX3dy
KGZkLCAmZXhlY2J1Zik7Ci0JZ2VtX2Nsb3NlKGZkLCBvYmouaGFuZGxlKTsKLQlmZW5jZSA9IGV4
ZWNidWYucnN2ZDIgPj4gMzI7Ci0JaWd0X2Fzc2VydChmZW5jZSAhPSAtMSk7CisJc3BpbiA9IGln
dF9zcGluX25ldyhmZCwKKwkJCSAgICAuZW5naW5lID0gcmluZywKKwkJCSAgICAuZmxhZ3MgPSBJ
R1RfU1BJTl9GRU5DRV9PVVQpOworCWlndF9hc3NlcnQoc3Bpbi0+b3V0X2ZlbmNlICE9IC0xKTsK
IAogCWkgPSAwOwogCWZvcl9lYWNoX3BoeXNpY2FsX2VuZ2luZShmZCwgZW5naW5lKSB7CkBAIC0z
ODYsMTUgKzM0MCwxNCBAQCBzdGF0aWMgdm9pZCB0ZXN0X2ZlbmNlX2F3YWl0KGludCBmZCwgdW5z
aWduZWQgcmluZywgdW5zaWduZWQgZmxhZ3MpCiAJCQljb250aW51ZTsKIAogCQlpZiAoZmxhZ3Mg
JiBOT05CTE9DSykgewotCQkJc3RvcmUoZmQsIGVuZ2luZSwgZmVuY2UsIHNjcmF0Y2gsIGkpOwor
CQkJc3RvcmUoZmQsIGVuZ2luZSwgc3Bpbi0+b3V0X2ZlbmNlLCBzY3JhdGNoLCBpKTsKIAkJfSBl
bHNlIHsKIAkJCWlndF9mb3JrKGNoaWxkLCAxKQotCQkJCXN0b3JlKGZkLCBlbmdpbmUsIGZlbmNl
LCBzY3JhdGNoLCBpKTsKKwkJCQlzdG9yZShmZCwgZW5naW5lLCBzcGluLT5vdXRfZmVuY2UsIHNj
cmF0Y2gsIGkpOwogCQl9CiAKIAkJaSsrOwogCX0KLQljbG9zZShmZW5jZSk7CiAKIAlzbGVlcCgx
KTsKIApAQCAtNDAyLDExICszNTUsOCBAQCBzdGF0aWMgdm9pZCB0ZXN0X2ZlbmNlX2F3YWl0KGlu
dCBmZCwgdW5zaWduZWQgcmluZywgdW5zaWduZWQgZmxhZ3MpCiAJZm9yIChpbnQgbiA9IDA7IG4g
PCBpOyBuKyspCiAJCWlndF9hc3NlcnRfZXFfdTMyKG91dFtuXSwgMCk7CiAKLQlpZiAoKGZsYWdz
ICYgSEFORykgPT0gMCkgewotCQkqYmF0Y2ggPSBNSV9CQVRDSF9CVUZGRVJfRU5EOwotCQlfX3N5
bmNfc3luY2hyb25pemUoKTsKLQl9Ci0JbXVubWFwKGJhdGNoLCA0MDk2KTsKKwlpZiAoKGZsYWdz
ICYgSEFORykgPT0gMCkKKwkJaWd0X3NwaW5fZW5kKHNwaW4pOwogCiAJaWd0X3dhaXRjaGlsZHJl
bigpOwogCi0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2lu
dGVsLWdmeA==

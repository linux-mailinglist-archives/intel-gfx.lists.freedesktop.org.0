Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id AE73B350DF
	for <lists+intel-gfx@lfdr.de>; Tue,  4 Jun 2019 22:30:16 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 28E5A89C59;
	Tue,  4 Jun 2019 20:30:14 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7E9B289C59
 for <intel-gfx@lists.freedesktop.org>; Tue,  4 Jun 2019 20:30:12 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga001.fm.intel.com ([10.253.24.23])
 by fmsmga104.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 04 Jun 2019 13:30:12 -0700
X-ExtLoop1: 1
Received: from dceraolo-linux.fm.intel.com ([10.1.27.145])
 by fmsmga001.fm.intel.com with ESMTP; 04 Jun 2019 13:30:12 -0700
From: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue,  4 Jun 2019 13:29:20 -0700
Message-Id: <20190604202921.22196-1-daniele.ceraolospurio@intel.com>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 1/2] drm/i915/guc: always use Command Transport
 Buffers
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Tm93IHRoYXQgd2UndmUgbW92ZWQgdGhlIGdlbjkgZ3VjIGJsb2JzIHRvIHZlcnNpb24gMzIgd2Ug
aGF2ZSBDVEIKc3VwcG9ydCBvbiBhbGwgZ2Vucywgc28gbm8gbmVlZCB0byByZXN0cmljdCB0aGUg
dXNhZ2UgdG8gZ2VuMTErLgpOb3RlIHRoYXQgbW1pbyBjb21tdW5pY2F0aW9uIGlzIHN0aWxsIHJl
cXVpcmVkIGZvciBDVEIgaW5pdGlhbGl6YXRpb24uCgpTaWduZWQtb2ZmLWJ5OiBEYW5pZWxlIENl
cmFvbG8gU3B1cmlvIDxkYW5pZWxlLmNlcmFvbG9zcHVyaW9AaW50ZWwuY29tPgpDYzogTWljaGFs
IFdhamRlY3prbyA8bWljaGFsLndhamRlY3prb0BpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9kcnYuaCAgICAgICAgICB8ICAxIC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfcGNpLmMgICAgICAgICAgfCAgMSAtCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9k
ZXZpY2VfaW5mby5oIHwgIDEgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjLmMgICAg
ICAgICB8IDQ1ICsrKystLS0tLS0tLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aW50ZWxfZ3VjLmggICAgICAgICB8ICAxIC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1
Y19jdC5jICAgICAgfCAxNCAtLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdWMu
YyAgICAgICAgICB8IDE5ICsrLS0tLS0tLS0KIDcgZmlsZXMgY2hhbmdlZCwgMTAgaW5zZXJ0aW9u
cygrKSwgNzIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKaW5kZXggNzZmMmJm
OTBlZDg2Li5lMzI4YTMwMjY5YTUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaApAQCAtMjQ5Nyw3
ICsyNDk3LDYgQEAgSVNfU1VCUExBVEZPUk0oY29uc3Qgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsCiAgKiBwcm9wZXJ0aWVzLCBzbyB3ZSBoYXZlIHNlcGFyYXRlIG1hY3JvcyB0byB0ZXN0
IHRoZW0uCiAgKi8KICNkZWZpbmUgSEFTX0dVQyhkZXZfcHJpdikJKElOVEVMX0lORk8oZGV2X3By
aXYpLT5oYXNfZ3VjKQotI2RlZmluZSBIQVNfR1VDX0NUKGRldl9wcml2KQkoSU5URUxfSU5GTyhk
ZXZfcHJpdiktPmhhc19ndWNfY3QpCiAjZGVmaW5lIEhBU19HVUNfVUNPREUoZGV2X3ByaXYpCShI
QVNfR1VDKGRldl9wcml2KSkKICNkZWZpbmUgSEFTX0dVQ19TQ0hFRChkZXZfcHJpdikJKEhBU19H
VUMoZGV2X3ByaXYpKQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Bj
aS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wY2kuYwppbmRleCBlNzYxZWE4NmI0ODEu
LjQ4MmYxZDBmMTc3MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wY2ku
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BjaS5jCkBAIC03NDYsNyArNzQ2LDYg
QEAgc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRlbF9kZXZpY2VfaW5mbyBpbnRlbF9jYW5ub25sYWtl
X2luZm8gPSB7CiAJfSwgXAogCUdFTigxMSksIFwKIAkuZGRiX3NpemUgPSAyMDQ4LCBcCi0JLmhh
c19ndWNfY3QgPSAxLCBcCiAJLmhhc19sb2dpY2FsX3JpbmdfZWxzcSA9IDEsIFwKIAkuY29sb3Ig
PSB7IC5kZWdhbW1hX2x1dF9zaXplID0gMzMsIC5nYW1tYV9sdXRfc2l6ZSA9IDEwMjQgfQogCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kZXZpY2VfaW5mby5oIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZGV2aWNlX2luZm8uaAppbmRleCBkNjdkZWRmMGNiZDgu
LjFmYjhiNTBkZjdkZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZGV2
aWNlX2luZm8uaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kZXZpY2VfaW5mby5o
CkBAIC0xMTIsNyArMTEyLDYgQEAgZW51bSBpbnRlbF9wcGd0dF90eXBlIHsKIAlmdW5jKGhhc19y
ZXNldF9lbmdpbmUpOyBcCiAJZnVuYyhoYXNfZnBnYV9kYmcpOyBcCiAJZnVuYyhoYXNfZ3VjKTsg
XAotCWZ1bmMoaGFzX2d1Y19jdCk7IFwKIAlmdW5jKGhhc19sM19kcGYpOyBcCiAJZnVuYyhoYXNf
bGxjKTsgXAogCWZ1bmMoaGFzX2xvZ2ljYWxfcmluZ19jb250ZXh0cyk7IFwKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aW50ZWxfZ3VjLmMKaW5kZXggYjg4YzM0OWM0ZmE2Li40MzIzMjI0MmQxNjcgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2ludGVsX2d1Yy5jCkBAIC01Niw3ICs1Niw3IEBAIHZvaWQgaW50ZWxfZ3VjX2luaXRfc2Vu
ZF9yZWdzKHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKIAllbnVtIGZvcmNld2FrZV9kb21haW5zIGZ3
X2RvbWFpbnMgPSAwOwogCXVuc2lnbmVkIGludCBpOwogCi0JaWYgKEhBU19HVUNfQ1QoZGV2X3By
aXYpICYmIElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpIHsKKwlpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA+PSAxMSkgewogCQlndWMtPnNlbmRfcmVncy5iYXNlID0KIAkJCQlpOTE1X21taW9fcmVn
X29mZnNldChHRU4xMV9TT0ZUX1NDUkFUQ0goMCkpOwogCQlndWMtPnNlbmRfcmVncy5jb3VudCA9
IEdFTjExX1NPRlRfU0NSQVRDSF9DT1VOVDsKQEAgLTIzMiwxMSArMjMyLDkgQEAgaW50IGludGVs
X2d1Y19pbml0KHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKIAkJZ290byBlcnJfbG9nOwogCUdFTV9C
VUdfT04oIWd1Yy0+YWRzX3ZtYSk7CiAKLQlpZiAoSEFTX0dVQ19DVChkZXZfcHJpdikpIHsKLQkJ
cmV0ID0gaW50ZWxfZ3VjX2N0X2luaXQoJmd1Yy0+Y3QpOwotCQlpZiAocmV0KQotCQkJZ290byBl
cnJfYWRzOwotCX0KKwlyZXQgPSBpbnRlbF9ndWNfY3RfaW5pdCgmZ3VjLT5jdCk7CisJaWYgKHJl
dCkKKwkJZ290byBlcnJfYWRzOwogCiAJLyogV2UgbmVlZCB0byBub3RpZnkgdGhlIGd1YyB3aGVu
ZXZlciB3ZSBjaGFuZ2UgdGhlIEdHVFQgKi8KIAlpOTE1X2dndHRfZW5hYmxlX2d1YyhkZXZfcHJp
dik7CkBAIC0yNjIsOCArMjYwLDcgQEAgdm9pZCBpbnRlbF9ndWNfZmluaShzdHJ1Y3QgaW50ZWxf
Z3VjICpndWMpCiAKIAlpOTE1X2dndHRfZGlzYWJsZV9ndWMoZGV2X3ByaXYpOwogCi0JaWYgKEhB
U19HVUNfQ1QoZGV2X3ByaXYpKQotCQlpbnRlbF9ndWNfY3RfZmluaSgmZ3VjLT5jdCk7CisJaW50
ZWxfZ3VjX2N0X2ZpbmkoJmd1Yy0+Y3QpOwogCiAJaW50ZWxfZ3VjX2Fkc19kZXN0cm95KGd1Yyk7
CiAJaW50ZWxfZ3VjX2xvZ19kZXN0cm95KCZndWMtPmxvZyk7CkBAIC00MzAsOSArNDI3LDggQEAg
aW50IGludGVsX2d1Y19zZW5kX21taW8oc3RydWN0IGludGVsX2d1YyAqZ3VjLCBjb25zdCB1MzIg
KmFjdGlvbiwgdTMyIGxlbiwKIAlHRU1fQlVHX09OKCphY3Rpb24gJiB+SU5URUxfR1VDX01TR19D
T0RFX01BU0spOwogCiAJLyogSWYgQ1QgaXMgYXZhaWxhYmxlLCB3ZSBleHBlY3QgdG8gdXNlIE1N
SU8gb25seSBkdXJpbmcgaW5pdC9maW5pICovCi0JR0VNX0JVR19PTihIQVNfR1VDX0NUKGRldl9w
cml2KSAmJgotCQkqYWN0aW9uICE9IElOVEVMX0dVQ19BQ1RJT05fUkVHSVNURVJfQ09NTUFORF9U
UkFOU1BPUlRfQlVGRkVSICYmCi0JCSphY3Rpb24gIT0gSU5URUxfR1VDX0FDVElPTl9ERVJFR0lT
VEVSX0NPTU1BTkRfVFJBTlNQT1JUX0JVRkZFUik7CisJR0VNX0JVR19PTigqYWN0aW9uICE9IElO
VEVMX0dVQ19BQ1RJT05fUkVHSVNURVJfQ09NTUFORF9UUkFOU1BPUlRfQlVGRkVSICYmCisJCSAg
ICphY3Rpb24gIT0gSU5URUxfR1VDX0FDVElPTl9ERVJFR0lTVEVSX0NPTU1BTkRfVFJBTlNQT1JU
X0JVRkZFUik7CiAKIAltdXRleF9sb2NrKCZndWMtPnNlbmRfbXV0ZXgpOwogCWludGVsX3VuY29y
ZV9mb3JjZXdha2VfZ2V0KHVuY29yZSwgZ3VjLT5zZW5kX3JlZ3MuZndfZG9tYWlucyk7CkBAIC00
ODEsMzMgKzQ3Nyw2IEBAIGludCBpbnRlbF9ndWNfc2VuZF9tbWlvKHN0cnVjdCBpbnRlbF9ndWMg
Kmd1YywgY29uc3QgdTMyICphY3Rpb24sIHUzMiBsZW4sCiAJcmV0dXJuIHJldDsKIH0KIAotdm9p
ZCBpbnRlbF9ndWNfdG9faG9zdF9ldmVudF9oYW5kbGVyX21taW8oc3RydWN0IGludGVsX2d1YyAq
Z3VjKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGd1Y190b19pOTE1
KGd1Yyk7Ci0JdTMyIG1zZywgdmFsOwotCi0JLyoKLQkgKiBTYW1wbGUgdGhlIGxvZyBidWZmZXIg
Zmx1c2ggcmVsYXRlZCBiaXRzICYgY2xlYXIgdGhlbSBvdXQgbm93Ci0JICogaXRzZWxmIGZyb20g
dGhlIG1lc3NhZ2UgaWRlbnRpdHkgcmVnaXN0ZXIgdG8gbWluaW1pemUgdGhlCi0JICogcHJvYmFi
aWxpdHkgb2YgbG9zaW5nIGEgZmx1c2ggaW50ZXJydXB0LCB3aGVuIHRoZXJlIGFyZSBiYWNrCi0J
ICogdG8gYmFjayBmbHVzaCBpbnRlcnJ1cHRzLgotCSAqIFRoZXJlIGNhbiBiZSBhIG5ldyBmbHVz
aCBpbnRlcnJ1cHQsIGZvciBkaWZmZXJlbnQgbG9nIGJ1ZmZlcgotCSAqIHR5cGUgKGxpa2UgZm9y
IElTUiksIHdoaWxzdCBIb3N0IGlzIGhhbmRsaW5nIG9uZSAoZm9yIERQQykuCi0JICogU2luY2Ug
c2FtZSBiaXQgaXMgdXNlZCBpbiBtZXNzYWdlIHJlZ2lzdGVyIGZvciBJU1IgJiBEUEMsIGl0Ci0J
ICogY291bGQgaGFwcGVuIHRoYXQgR3VDIHNldHMgdGhlIGJpdCBmb3IgMm5kIGludGVycnVwdCBi
dXQgSG9zdAotCSAqIGNsZWFycyBvdXQgdGhlIGJpdCBvbiBoYW5kbGluZyB0aGUgMXN0IGludGVy
cnVwdC4KLQkgKi8KLQlkaXNhYmxlX3JwbV93YWtlcmVmX2Fzc2VydHMoZGV2X3ByaXYpOwotCXNw
aW5fbG9jaygmZ3VjLT5pcnFfbG9jayk7Ci0JdmFsID0gSTkxNV9SRUFEKFNPRlRfU0NSQVRDSCgx
NSkpOwotCW1zZyA9IHZhbCAmIGd1Yy0+bXNnX2VuYWJsZWRfbWFzazsKLQlJOTE1X1dSSVRFKFNP
RlRfU0NSQVRDSCgxNSksIHZhbCAmIH5tc2cpOwotCXNwaW5fdW5sb2NrKCZndWMtPmlycV9sb2Nr
KTsKLQllbmFibGVfcnBtX3dha2VyZWZfYXNzZXJ0cyhkZXZfcHJpdik7Ci0KLQlpbnRlbF9ndWNf
dG9faG9zdF9wcm9jZXNzX3JlY3ZfbXNnKGd1YywgJm1zZywgMSk7Ci19Ci0KIGludCBpbnRlbF9n
dWNfdG9faG9zdF9wcm9jZXNzX3JlY3ZfbXNnKHN0cnVjdCBpbnRlbF9ndWMgKmd1YywKIAkJCQkg
ICAgICAgY29uc3QgdTMyICpwYXlsb2FkLCB1MzIgbGVuKQogewpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9n
dWMuaAppbmRleCBjYmZlZDdhNzdjOGIuLmUwN2U0YzY5Y2YwOCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfZ3VjLmgKQEAgLTE2NSw3ICsxNjUsNiBAQCBpbnQgaW50ZWxfZ3VjX3NlbmRfbW1pbyhzdHJ1
Y3QgaW50ZWxfZ3VjICpndWMsIGNvbnN0IHUzMiAqYWN0aW9uLCB1MzIgbGVuLAogCQkJdTMyICpy
ZXNwb25zZV9idWYsIHUzMiByZXNwb25zZV9idWZfc2l6ZSk7CiB2b2lkIGludGVsX2d1Y190b19o
b3N0X2V2ZW50X2hhbmRsZXIoc3RydWN0IGludGVsX2d1YyAqZ3VjKTsKIHZvaWQgaW50ZWxfZ3Vj
X3RvX2hvc3RfZXZlbnRfaGFuZGxlcl9ub3Aoc3RydWN0IGludGVsX2d1YyAqZ3VjKTsKLXZvaWQg
aW50ZWxfZ3VjX3RvX2hvc3RfZXZlbnRfaGFuZGxlcl9tbWlvKHN0cnVjdCBpbnRlbF9ndWMgKmd1
Yyk7CiBpbnQgaW50ZWxfZ3VjX3RvX2hvc3RfcHJvY2Vzc19yZWN2X21zZyhzdHJ1Y3QgaW50ZWxf
Z3VjICpndWMsCiAJCQkJICAgICAgIGNvbnN0IHUzMiAqcGF5bG9hZCwgdTMyIGxlbik7CiBpbnQg
aW50ZWxfZ3VjX3NhbXBsZV9mb3JjZXdha2Uoc3RydWN0IGludGVsX2d1YyAqZ3VjKTsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Y19jdC5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaW50ZWxfZ3VjX2N0LmMKaW5kZXggMmQ1ZGMyYWEyMmE3Li4zOTIxODA5ZjgxMmIg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Y19jdC5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Y19jdC5jCkBAIC04NDgsOCArODQ4LDYgQEAgc3Rh
dGljIHZvaWQgaW50ZWxfZ3VjX3RvX2hvc3RfZXZlbnRfaGFuZGxlcl9jdChzdHJ1Y3QgaW50ZWxf
Z3VjICpndWMpCiAgKiBBbGxvY2F0ZSBtZW1vcnkgcmVxdWlyZWQgZm9yIGNvbW11bmljYXRpb24g
dmlhCiAgKiB0aGUgQ1QgY2hhbm5lbC4KICAqCi0gKiBTaGFsbCBvbmx5IGJlIGNhbGxlZCBmb3Ig
cGxhdGZvcm1zIHdpdGggSEFTX0dVQ19DVC4KLSAqCiAgKiBSZXR1cm46IDAgb24gc3VjY2Vzcywg
YSBuZWdhdGl2ZSBlcnJubyBjb2RlIG9uIGZhaWx1cmUuCiAgKi8KIGludCBpbnRlbF9ndWNfY3Rf
aW5pdChzdHJ1Y3QgaW50ZWxfZ3VjX2N0ICpjdCkKQEAgLTg3NSw4ICs4NzMsNiBAQCBpbnQgaW50
ZWxfZ3VjX2N0X2luaXQoc3RydWN0IGludGVsX2d1Y19jdCAqY3QpCiAgKgogICogRGVhbGxvY2F0
ZSBtZW1vcnkgcmVxdWlyZWQgZm9yIGNvbW11bmljYXRpb24gdmlhCiAgKiB0aGUgQ1QgY2hhbm5l
bC4KLSAqCi0gKiBTaGFsbCBvbmx5IGJlIGNhbGxlZCBmb3IgcGxhdGZvcm1zIHdpdGggSEFTX0dV
Q19DVC4KICAqLwogdm9pZCBpbnRlbF9ndWNfY3RfZmluaShzdHJ1Y3QgaW50ZWxfZ3VjX2N0ICpj
dCkKIHsKQEAgLTg5MCwxOSArODg2LDE0IEBAIHZvaWQgaW50ZWxfZ3VjX2N0X2Zpbmkoc3RydWN0
IGludGVsX2d1Y19jdCAqY3QpCiAgKiBpbnRlbF9ndWNfY3RfZW5hYmxlIC0gRW5hYmxlIGJ1ZmZl
ciBiYXNlZCBjb21tYW5kIHRyYW5zcG9ydC4KICAqIEBjdDogcG9pbnRlciB0byBDVCBzdHJ1Y3QK
ICAqCi0gKiBTaGFsbCBvbmx5IGJlIGNhbGxlZCBmb3IgcGxhdGZvcm1zIHdpdGggSEFTX0dVQ19D
VC4KLSAqCiAgKiBSZXR1cm46IDAgb24gc3VjY2VzcywgYSBuZWdhdGl2ZSBlcnJubyBjb2RlIG9u
IGZhaWx1cmUuCiAgKi8KIGludCBpbnRlbF9ndWNfY3RfZW5hYmxlKHN0cnVjdCBpbnRlbF9ndWNf
Y3QgKmN0KQogewogCXN0cnVjdCBpbnRlbF9ndWMgKmd1YyA9IGN0X3RvX2d1YyhjdCk7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBndWNfdG9faTkxNShndWMpOwogCXN0cnVjdCBp
bnRlbF9ndWNfY3RfY2hhbm5lbCAqY3RjaCA9ICZjdC0+aG9zdF9jaGFubmVsOwogCWludCBlcnI7
CiAKLQlHRU1fQlVHX09OKCFIQVNfR1VDX0NUKGk5MTUpKTsKLQogCWlmIChjdGNoLT5lbmFibGVk
KQogCQlyZXR1cm4gMDsKIApAQCAtOTIwLDE3ICs5MTEsMTIgQEAgaW50IGludGVsX2d1Y19jdF9l
bmFibGUoc3RydWN0IGludGVsX2d1Y19jdCAqY3QpCiAvKioKICAqIGludGVsX2d1Y19jdF9kaXNh
YmxlIC0gRGlzYWJsZSBidWZmZXIgYmFzZWQgY29tbWFuZCB0cmFuc3BvcnQuCiAgKiBAY3Q6IHBv
aW50ZXIgdG8gQ1Qgc3RydWN0Ci0gKgotICogU2hhbGwgb25seSBiZSBjYWxsZWQgZm9yIHBsYXRm
b3JtcyB3aXRoIEhBU19HVUNfQ1QuCiAgKi8KIHZvaWQgaW50ZWxfZ3VjX2N0X2Rpc2FibGUoc3Ry
dWN0IGludGVsX2d1Y19jdCAqY3QpCiB7CiAJc3RydWN0IGludGVsX2d1YyAqZ3VjID0gY3RfdG9f
Z3VjKGN0KTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGd1Y190b19pOTE1KGd1
Yyk7CiAJc3RydWN0IGludGVsX2d1Y19jdF9jaGFubmVsICpjdGNoID0gJmN0LT5ob3N0X2NoYW5u
ZWw7CiAKLQlHRU1fQlVHX09OKCFIQVNfR1VDX0NUKGk5MTUpKTsKLQogCWlmICghY3RjaC0+ZW5h
YmxlZCkKIAkJcmV0dXJuOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF91Yy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdWMuYwppbmRleCBhNWJhMGYwMDc5
NTkuLmE4ZTdmMGJhN2MzYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
dWMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF91Yy5jCkBAIC0yMzUsMjQgKzIz
NSwxNCBAQCBzdGF0aWMgdm9pZCBndWNfZGlzYWJsZV9pbnRlcnJ1cHRzKHN0cnVjdCBpbnRlbF9n
dWMgKmd1YykKIAogc3RhdGljIGludCBndWNfZW5hYmxlX2NvbW11bmljYXRpb24oc3RydWN0IGlu
dGVsX2d1YyAqZ3VjKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ3VjX3Rv
X2k5MTUoZ3VjKTsKLQogCWd1Y19lbmFibGVfaW50ZXJydXB0cyhndWMpOwogCi0JaWYgKEhBU19H
VUNfQ1QoaTkxNSkpCi0JCXJldHVybiBpbnRlbF9ndWNfY3RfZW5hYmxlKCZndWMtPmN0KTsKLQot
CWd1Yy0+c2VuZCA9IGludGVsX2d1Y19zZW5kX21taW87Ci0JZ3VjLT5oYW5kbGVyID0gaW50ZWxf
Z3VjX3RvX2hvc3RfZXZlbnRfaGFuZGxlcl9tbWlvOwotCXJldHVybiAwOworCXJldHVybiBpbnRl
bF9ndWNfY3RfZW5hYmxlKCZndWMtPmN0KTsKIH0KIAogc3RhdGljIHZvaWQgZ3VjX3N0b3BfY29t
bXVuaWNhdGlvbihzdHJ1Y3QgaW50ZWxfZ3VjICpndWMpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUgPSBndWNfdG9faTkxNShndWMpOwotCi0JaWYgKEhBU19HVUNfQ1QoaTkxNSkp
Ci0JCWludGVsX2d1Y19jdF9zdG9wKCZndWMtPmN0KTsKKwlpbnRlbF9ndWNfY3Rfc3RvcCgmZ3Vj
LT5jdCk7CiAKIAlndWMtPnNlbmQgPSBpbnRlbF9ndWNfc2VuZF9ub3A7CiAJZ3VjLT5oYW5kbGVy
ID0gaW50ZWxfZ3VjX3RvX2hvc3RfZXZlbnRfaGFuZGxlcl9ub3A7CkBAIC0yNjAsMTAgKzI1MCw3
IEBAIHN0YXRpYyB2b2lkIGd1Y19zdG9wX2NvbW11bmljYXRpb24oc3RydWN0IGludGVsX2d1YyAq
Z3VjKQogCiBzdGF0aWMgdm9pZCBndWNfZGlzYWJsZV9jb21tdW5pY2F0aW9uKHN0cnVjdCBpbnRl
bF9ndWMgKmd1YykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGd1Y190b19p
OTE1KGd1Yyk7Ci0KLQlpZiAoSEFTX0dVQ19DVChpOTE1KSkKLQkJaW50ZWxfZ3VjX2N0X2Rpc2Fi
bGUoJmd1Yy0+Y3QpOworCWludGVsX2d1Y19jdF9kaXNhYmxlKCZndWMtPmN0KTsKIAogCWd1Y19k
aXNhYmxlX2ludGVycnVwdHMoZ3VjKTsKIAotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVs
LWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcv
bWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

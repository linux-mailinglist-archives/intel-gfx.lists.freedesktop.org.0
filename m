Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id B0CDB11BEDC
	for <lists+intel-gfx@lfdr.de>; Wed, 11 Dec 2019 22:12:53 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 548AE6EBE3;
	Wed, 11 Dec 2019 21:12:49 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga18.intel.com (mga18.intel.com [134.134.136.126])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9BBE06EBE0
 for <intel-gfx@lists.freedesktop.org>; Wed, 11 Dec 2019 21:12:47 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga006.jf.intel.com ([10.7.209.51])
 by orsmga106.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 11 Dec 2019 13:12:47 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,303,1571727600"; d="scan'208";a="215904977"
Received: from dceraolo-linux.fm.intel.com ([10.1.27.145])
 by orsmga006.jf.intel.com with ESMTP; 11 Dec 2019 13:12:46 -0800
From: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 11 Dec 2019 13:12:43 -0800
Message-Id: <20191211211244.7831-5-daniele.ceraolospurio@intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191211211244.7831-1-daniele.ceraolospurio@intel.com>
References: <20191211211244.7831-1-daniele.ceraolospurio@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [RFC 4/5] drm/i915: move execlists selftests to their
 own file
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RG9uZSBhaGVhZCBvZiBzcGxpdHRpbmcgdGhlIGxyYyBmaWxlIGFzIHdlbGwsIHRvIGtlZXAgdGhh
dCBwYXRjaApzbWFsbGVyLiBKdXN0IGEgc3RyYWlnaHQgY29weSwgd2l0aCB0aGUgZXhjZXB0aW9u
IG9mIGNyZWF0ZV9zY3JhdGNoKCkKdGhhdCBoYXMgYmVlbiBtYWRlIGNvbW1vbiB0byBhdm9pZCBo
YXZpbmcgMyBpbnN0YW5jZXMgb2YgaXQuCgpTaWduZWQtb2ZmLWJ5OiBEYW5pZWxlIENlcmFvbG8g
U3B1cmlvIDxkYW5pZWxlLmNlcmFvbG9zcHVyaW9AaW50ZWwuY29tPgpDYzogQ2hyaXMgV2lsc29u
IDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBUdnJ0a28gVXJzdWxpbiA8dHZydGtvLnVy
c3VsaW5AbGludXguaW50ZWwuY29tPgpDYzogTWF0dGhldyBCcm9zdCA8bWF0dGhldy5icm9zdEBp
bnRlbC5jb20+Ci0tLQogLi4uL2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGlscy5j
ICAgIHwgICAyNyArCiAuLi4vZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pZ3RfZ2VtX3V0aWxzLmgg
ICAgfCAgICAzICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jICAgICAgICAg
ICB8ICAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZXhlY2xpc3RzLmMg
IHwgMzMxNiArKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVz
dF9scmMuYyAgICAgICAgfCAzMzMzICstLS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF9tb2NzLmMgICAgICAgfCAgIDMwICstCiA2IGZpbGVzIGNoYW5nZWQs
IDMzNTEgaW5zZXJ0aW9ucygrKSwgMzM1OSBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0
NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9leGVjbGlzdHMuYwoKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGlscy5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pZ3RfZ2VtX3V0aWxzLmMKaW5kZXgg
NjcxOGRhMjBmMzVkLi44ODEwOTMzM2NiNzkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGlscy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGlscy5jCkBAIC0xNSw2ICsxNSwzMyBAQAogCiAj
aW5jbHVkZSAiaTkxNV9yZXF1ZXN0LmgiCiAKK3N0cnVjdCBpOTE1X3ZtYSAqaWd0X2NyZWF0ZV9z
Y3JhdGNoKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iajsKKwlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKKwlpbnQgZXJyOworCisJb2JqID0gaTkx
NV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChndC0+aTkxNSwgUEFHRV9TSVpFKTsKKwlpZiAo
SVNfRVJSKG9iaikpCisJCXJldHVybiBFUlJfQ0FTVChvYmopOworCisJaTkxNV9nZW1fb2JqZWN0
X3NldF9jYWNoZV9jb2hlcmVuY3kob2JqLCBJOTE1X0NBQ0hJTkdfQ0FDSEVEKTsKKworCXZtYSA9
IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgJmd0LT5nZ3R0LT52bSwgTlVMTCk7CisJaWYgKElTX0VS
Uih2bWEpKSB7CisJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwkJcmV0dXJuIHZtYTsKKwl9
CisKKwllcnIgPSBpOTE1X3ZtYV9waW4odm1hLCAwLCAwLCBQSU5fR0xPQkFMKTsKKwlpZiAoZXJy
KSB7CisJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwkJcmV0dXJuIEVSUl9QVFIoZXJyKTsK
Kwl9CisKKwlyZXR1cm4gdm1hOworfQorCiBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICoKIGlndF9yZXF1
ZXN0X2FsbG9jKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsIHN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZSkKIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9z
ZWxmdGVzdHMvaWd0X2dlbV91dGlscy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0
ZXN0cy9pZ3RfZ2VtX3V0aWxzLmgKaW5kZXggNDIyMWNmODRkMTc1Li5hYWU3ODFmNTljZmMgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGls
cy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGls
cy5oCkBAIC0xNSw2ICsxNSw5IEBAIHN0cnVjdCBpOTE1X3ZtYTsKIAogc3RydWN0IGludGVsX2Nv
bnRleHQ7CiBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzOworc3RydWN0IGludGVsX2d0OworCitzdHJ1
Y3QgaTkxNV92bWEgKmlndF9jcmVhdGVfc2NyYXRjaChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KTsKIAog
c3RydWN0IGk5MTVfcmVxdWVzdCAqCiBpZ3RfcmVxdWVzdF9hbGxvYyhzdHJ1Y3QgaTkxNV9nZW1f
Y29udGV4dCAqY3R4LCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9scmMuYwppbmRleCAzYWZhZTlhNDQ5MTEuLmZiZGQzYmRkMDZmMSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKQEAgLTQ0NDYsNCArNDQ0Niw1IEBAIGludGVs
X2VuZ2luZV9pbl9leGVjbGlzdHNfc3VibWlzc2lvbl9tb2RlKGNvbnN0IHN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZSkKIAogI2lmIElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X1NFTEZU
RVNUKQogI2luY2x1ZGUgInNlbGZ0ZXN0X2xyYy5jIgorI2luY2x1ZGUgInNlbGZ0ZXN0X2V4ZWNs
aXN0cy5jIgogI2VuZGlmCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF9leGVjbGlzdHMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2V4ZWNs
aXN0cy5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uYjU4YTRmZWIy
ZWM0Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
ZXhlY2xpc3RzLmMKQEAgLTAsMCArMSwzMzE2IEBACisvKgorICogU1BEWC1MaWNlbnNlLUlkZW50
aWZpZXI6IE1JVAorICoKKyAqIENvcHlyaWdodCDCqSAyMDE4LTIwMTkgSW50ZWwgQ29ycG9yYXRp
b24KKyAqLworCisjaW5jbHVkZSA8bGludXgvcHJpbWVfbnVtYmVycy5oPgorCisjaW5jbHVkZSAi
Z2VtL2k5MTVfZ2VtX3BtLmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfZW5naW5lX2hlYXJ0YmVhdC5o
IgorI2luY2x1ZGUgImd0L2ludGVsX3Jlc2V0LmgiCisKKyNpbmNsdWRlICJpOTE1X3NlbGZ0ZXN0
LmgiCisjaW5jbHVkZSAic2VsZnRlc3RzL2k5MTVfcmFuZG9tLmgiCisjaW5jbHVkZSAic2VsZnRl
c3RzL2lndF9mbHVzaF90ZXN0LmgiCisjaW5jbHVkZSAic2VsZnRlc3RzL2lndF9saXZlX3Rlc3Qu
aCIKKyNpbmNsdWRlICJzZWxmdGVzdHMvaWd0X3NwaW5uZXIuaCIKKyNpbmNsdWRlICJzZWxmdGVz
dHMvbGliX3N3X2ZlbmNlLmgiCisKKyNpbmNsdWRlICJnZW0vc2VsZnRlc3RzL2lndF9nZW1fdXRp
bHMuaCIKKyNpbmNsdWRlICJnZW0vc2VsZnRlc3RzL21vY2tfY29udGV4dC5oIgorCisjZGVmaW5l
IENTX0dQUihlbmdpbmUsIG4pICgoZW5naW5lKS0+bW1pb19iYXNlICsgMHg2MDAgKyAobikgKiA0
KQorI2RlZmluZSBOVU1fR1BSX0RXICgxNiAqIDIpIC8qIGVhY2ggR1BSIGlzIDIgZHdvcmRzICov
CisKK3N0YXRpYyBpbnQgbGl2ZV9zYW5pdHljaGVjayh2b2lkICphcmcpCit7CisJc3RydWN0IGlu
dGVsX2d0ICpndCA9IGFyZzsKKwlzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lc19pdGVyIGl0OworCXN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CisJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwor
CXN0cnVjdCBpZ3Rfc3Bpbm5lciBzcGluOworCWludCBlcnIgPSAtRU5PTUVNOworCisJaWYgKCFI
QVNfTE9HSUNBTF9SSU5HX0NPTlRFWFRTKGd0LT5pOTE1KSkKKwkJcmV0dXJuIDA7CisKKwlpZiAo
aWd0X3NwaW5uZXJfaW5pdCgmc3BpbiwgZ3QpKQorCQlyZXR1cm4gLUVOT01FTTsKKworCWN0eCA9
IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKKwlpZiAoIWN0eCkKKwkJZ290byBlcnJfc3BpbjsK
KworCWZvcl9lYWNoX2dlbV9lbmdpbmUoY2UsIGk5MTVfZ2VtX2NvbnRleHRfbG9ja19lbmdpbmVz
KGN0eCksIGl0KSB7CisJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCisJCXJxID0gaWd0X3Nw
aW5uZXJfY3JlYXRlX3JlcXVlc3QoJnNwaW4sIGNlLCBNSV9OT09QKTsKKwkJaWYgKElTX0VSUihy
cSkpIHsKKwkJCWVyciA9IFBUUl9FUlIocnEpOworCQkJZ290byBlcnJfY3R4OworCQl9CisKKwkJ
aTkxNV9yZXF1ZXN0X2FkZChycSk7CisJCWlmICghaWd0X3dhaXRfZm9yX3NwaW5uZXIoJnNwaW4s
IHJxKSkgeworCQkJR0VNX1RSQUNFKCJzcGlubmVyIGZhaWxlZCB0byBzdGFydFxuIik7CisJCQlH
RU1fVFJBQ0VfRFVNUCgpOworCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CisJCQllcnIgPSAt
RUlPOworCQkJZ290byBlcnJfY3R4OworCQl9CisKKwkJaWd0X3NwaW5uZXJfZW5kKCZzcGluKTsK
KwkJaWYgKGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KSkgeworCQkJZXJyID0gLUVJTzsKKwkJCWdv
dG8gZXJyX2N0eDsKKwkJfQorCX0KKworCWVyciA9IDA7CitlcnJfY3R4OgorCWk5MTVfZ2VtX2Nv
bnRleHRfdW5sb2NrX2VuZ2luZXMoY3R4KTsKKwlrZXJuZWxfY29udGV4dF9jbG9zZShjdHgpOwor
ZXJyX3NwaW46CisJaWd0X3NwaW5uZXJfZmluaSgmc3Bpbik7CisJcmV0dXJuIGVycjsKK30KKwor
c3RhdGljIGludCBsaXZlX3VubGl0ZV9yZXN0b3JlKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIGludCBw
cmlvKQoreworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKKwlzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqY3R4OworCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOworCXN0cnVjdCBpZ3Rf
c3Bpbm5lciBzcGluOworCWludCBlcnIgPSAtRU5PTUVNOworCisJLyoKKwkgKiBDaGVjayB0aGF0
IHdlIGNhbiBjb3JyZWN0bHkgY29udGV4dCBzd2l0Y2ggYmV0d2VlbiAyIGluc3RhbmNlcworCSAq
IG9uIHRoZSBzYW1lIGVuZ2luZSBmcm9tIHRoZSBzYW1lIHBhcmVudCBjb250ZXh0LgorCSAqLwor
CisJaWYgKGlndF9zcGlubmVyX2luaXQoJnNwaW4sIGd0KSkKKwkJcmV0dXJuIGVycjsKKworCWN0
eCA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKKwlpZiAoIWN0eCkKKwkJZ290byBlcnJfc3Bp
bjsKKworCWVyciA9IDA7CisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7CisJCXN0
cnVjdCBpbnRlbF9jb250ZXh0ICpjZVsyXSA9IHt9OworCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
cVsyXTsKKwkJc3RydWN0IGlndF9saXZlX3Rlc3QgdDsKKwkJaW50IG47CisKKwkJaWYgKHByaW8g
JiYgIWludGVsX2VuZ2luZV9oYXNfcHJlZW1wdGlvbihlbmdpbmUpKQorCQkJY29udGludWU7CisK
KwkJaWYgKCFpbnRlbF9lbmdpbmVfY2FuX3N0b3JlX2R3b3JkKGVuZ2luZSkpCisJCQljb250aW51
ZTsKKworCQlpZiAoaWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgZ3QtPmk5MTUsIF9fZnVuY19fLCBl
bmdpbmUtPm5hbWUpKSB7CisJCQllcnIgPSAtRUlPOworCQkJYnJlYWs7CisJCX0KKworCQlmb3Ig
KG4gPSAwOyBuIDwgQVJSQVlfU0laRShjZSk7IG4rKykgeworCQkJc3RydWN0IGludGVsX2NvbnRl
eHQgKnRtcDsKKworCQkJdG1wID0gaW50ZWxfY29udGV4dF9jcmVhdGUoY3R4LCBlbmdpbmUpOwor
CQkJaWYgKElTX0VSUih0bXApKSB7CisJCQkJZXJyID0gUFRSX0VSUih0bXApOworCQkJCWdvdG8g
ZXJyX2NlOworCQkJfQorCisJCQllcnIgPSBpbnRlbF9jb250ZXh0X3Bpbih0bXApOworCQkJaWYg
KGVycikgeworCQkJCWludGVsX2NvbnRleHRfcHV0KHRtcCk7CisJCQkJZ290byBlcnJfY2U7CisJ
CQl9CisKKwkJCS8qCisJCQkgKiBTZXR1cCB0aGUgcGFpciBvZiBjb250ZXh0cyBzdWNoIHRoYXQg
aWYgd2UKKwkJCSAqIGxpdGUtcmVzdG9yZSB1c2luZyB0aGUgUklOR19UQUlMIGZyb20gY2VbMV0g
aXQKKwkJCSAqIHdpbGwgZXhlY3V0ZSBnYXJiYWdlIGZyb20gY2VbMF0tPnJpbmcuCisJCQkgKi8K
KwkJCW1lbXNldCh0bXAtPnJpbmctPnZhZGRyLAorCQkJICAgICAgIFBPSVNPTl9JTlVTRSwgLyog
SVBFSFI6IDB4NWE1YTVhNWEgW2h1bmchXSAqLworCQkJICAgICAgIHRtcC0+cmluZy0+dm1hLT5z
aXplKTsKKworCQkJY2Vbbl0gPSB0bXA7CisJCX0KKwkJR0VNX0JVR19PTighY2VbMV0tPnJpbmct
PnNpemUpOworCQlpbnRlbF9yaW5nX3Jlc2V0KGNlWzFdLT5yaW5nLCBjZVsxXS0+cmluZy0+c2l6
ZSAvIDIpOworCQlscl9jb250ZXh0X3VwZGF0ZV9yZWdfc3RhdGUoY2VbMV0sIGVuZ2luZSk7CisK
KwkJcnFbMF0gPSBpZ3Rfc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmc3BpbiwgY2VbMF0sIE1JX0FS
Ql9DSEVDSyk7CisJCWlmIChJU19FUlIocnFbMF0pKSB7CisJCQllcnIgPSBQVFJfRVJSKHJxWzBd
KTsKKwkJCWdvdG8gZXJyX2NlOworCQl9CisKKwkJaTkxNV9yZXF1ZXN0X2dldChycVswXSk7CisJ
CWk5MTVfcmVxdWVzdF9hZGQocnFbMF0pOworCQlHRU1fQlVHX09OKHJxWzBdLT5wb3N0Zml4ID4g
Y2VbMV0tPnJpbmctPmVtaXQpOworCisJCWlmICghaWd0X3dhaXRfZm9yX3NwaW5uZXIoJnNwaW4s
IHJxWzBdKSkgeworCQkJaTkxNV9yZXF1ZXN0X3B1dChycVswXSk7CisJCQlnb3RvIGVycl9jZTsK
KwkJfQorCisJCXJxWzFdID0gaTkxNV9yZXF1ZXN0X2NyZWF0ZShjZVsxXSk7CisJCWlmIChJU19F
UlIocnFbMV0pKSB7CisJCQllcnIgPSBQVFJfRVJSKHJxWzFdKTsKKwkJCWk5MTVfcmVxdWVzdF9w
dXQocnFbMF0pOworCQkJZ290byBlcnJfY2U7CisJCX0KKworCQlpZiAoIXByaW8pIHsKKwkJCS8q
CisJCQkgKiBFbnN1cmUgd2UgZG8gdGhlIHN3aXRjaCB0byBjZVsxXSBvbiBjb21wbGV0aW9uLgor
CQkJICoKKwkJCSAqIHJxWzBdIGlzIGFscmVhZHkgc3VibWl0dGVkLCBzbyB0aGlzIHNob3VsZCBy
ZWR1Y2UKKwkJCSAqIHRvIGEgbm8tb3AgKGEgd2FpdCBvbiBhIHJlcXVlc3Qgb24gdGhlIHNhbWUg
ZW5naW5lCisJCQkgKiB1c2VzIHRoZSBzdWJtaXQgZmVuY2UsIG5vdCB0aGUgY29tcGxldGlvbiBm
ZW5jZSksCisJCQkgKiBidXQgaXQgd2lsbCBpbnN0YWxsIGEgZGVwZW5kZW5jeSBvbiBycVsxXSBm
b3IgcnFbMF0KKwkJCSAqIHRoYXQgd2lsbCBwcmV2ZW50IHRoZSBwYWlyIGJlaW5nIHJlb3JkZXJl
ZCBieQorCQkJICogdGltZXNsaWNpbmcuCisJCQkgKi8KKwkJCWk5MTVfcmVxdWVzdF9hd2FpdF9k
bWFfZmVuY2UocnFbMV0sICZycVswXS0+ZmVuY2UpOworCQl9CisKKwkJaTkxNV9yZXF1ZXN0X2dl
dChycVsxXSk7CisJCWk5MTVfcmVxdWVzdF9hZGQocnFbMV0pOworCQlHRU1fQlVHX09OKHJxWzFd
LT5wb3N0Zml4IDw9IHJxWzBdLT5wb3N0Zml4KTsKKwkJaTkxNV9yZXF1ZXN0X3B1dChycVswXSk7
CisKKwkJaWYgKHByaW8pIHsKKwkJCXN0cnVjdCBpOTE1X3NjaGVkX2F0dHIgYXR0ciA9IHsKKwkJ
CQkucHJpb3JpdHkgPSBwcmlvLAorCQkJfTsKKworCQkJLyogQWx0ZXJuYXRpdmVseSBwcmVlbXB0
IHRoZSBzcGlubmVyIHdpdGggY2VbMV0gKi8KKwkJCWVuZ2luZS0+c2NoZWR1bGUocnFbMV0sICZh
dHRyKTsKKwkJfQorCisJCS8qIEFuZCBzd2l0Y2ggYmFjayB0byBjZVswXSBmb3IgZ29vZCBtZWFz
dXJlICovCisJCXJxWzBdID0gaTkxNV9yZXF1ZXN0X2NyZWF0ZShjZVswXSk7CisJCWlmIChJU19F
UlIocnFbMF0pKSB7CisJCQllcnIgPSBQVFJfRVJSKHJxWzBdKTsKKwkJCWk5MTVfcmVxdWVzdF9w
dXQocnFbMV0pOworCQkJZ290byBlcnJfY2U7CisJCX0KKworCQlpOTE1X3JlcXVlc3RfYXdhaXRf
ZG1hX2ZlbmNlKHJxWzBdLCAmcnFbMV0tPmZlbmNlKTsKKwkJaTkxNV9yZXF1ZXN0X2dldChycVsw
XSk7CisJCWk5MTVfcmVxdWVzdF9hZGQocnFbMF0pOworCQlHRU1fQlVHX09OKHJxWzBdLT5wb3N0
Zml4ID4gcnFbMV0tPnBvc3RmaXgpOworCQlpOTE1X3JlcXVlc3RfcHV0KHJxWzFdKTsKKwkJaTkx
NV9yZXF1ZXN0X3B1dChycVswXSk7CisKK2Vycl9jZToKKwkJdGFza2xldF9raWxsKCZlbmdpbmUt
PmV4ZWNsaXN0cy50YXNrbGV0KTsgLyogZmx1c2ggc3VibWlzc2lvbiAqLworCQlpZ3Rfc3Bpbm5l
cl9lbmQoJnNwaW4pOworCQlmb3IgKG4gPSAwOyBuIDwgQVJSQVlfU0laRShjZSk7IG4rKykgewor
CQkJaWYgKElTX0VSUl9PUl9OVUxMKGNlW25dKSkKKwkJCQlicmVhazsKKworCQkJaW50ZWxfY29u
dGV4dF91bnBpbihjZVtuXSk7CisJCQlpbnRlbF9jb250ZXh0X3B1dChjZVtuXSk7CisJCX0KKwor
CQlpZiAoaWd0X2xpdmVfdGVzdF9lbmQoJnQpKQorCQkJZXJyID0gLUVJTzsKKwkJaWYgKGVycikK
KwkJCWJyZWFrOworCX0KKworCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7CitlcnJfc3BpbjoK
KwlpZ3Rfc3Bpbm5lcl9maW5pKCZzcGluKTsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgaW50
IGxpdmVfdW5saXRlX3N3aXRjaCh2b2lkICphcmcpCit7CisJcmV0dXJuIGxpdmVfdW5saXRlX3Jl
c3RvcmUoYXJnLCAwKTsKK30KKworc3RhdGljIGludCBsaXZlX3VubGl0ZV9wcmVlbXB0KHZvaWQg
KmFyZykKK3sKKwlyZXR1cm4gbGl2ZV91bmxpdGVfcmVzdG9yZShhcmcsIEk5MTVfVVNFUl9QUklP
UklUWShJOTE1X1BSSU9SSVRZX01BWCkpOworfQorCitzdGF0aWMgaW50CitlbWl0X3NlbWFwaG9y
ZV9jaGFpbihzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgc3RydWN0IGk5MTVfdm1hICp2bWEsIGlu
dCBpZHgpCit7CisJdTMyICpjczsKKworCWNzID0gaW50ZWxfcmluZ19iZWdpbihycSwgMTApOwor
CWlmIChJU19FUlIoY3MpKQorCQlyZXR1cm4gUFRSX0VSUihjcyk7CisKKwkqY3MrKyA9IE1JX0FS
Ql9PTl9PRkYgfCBNSV9BUkJfRU5BQkxFOworCisJKmNzKysgPSBNSV9TRU1BUEhPUkVfV0FJVCB8
CisJCU1JX1NFTUFQSE9SRV9HTE9CQUxfR1RUIHwKKwkJTUlfU0VNQVBIT1JFX1BPTEwgfAorCQlN
SV9TRU1BUEhPUkVfU0FEX05FUV9TREQ7CisJKmNzKysgPSAwOworCSpjcysrID0gaTkxNV9nZ3R0
X29mZnNldCh2bWEpICsgNCAqIGlkeDsKKwkqY3MrKyA9IDA7CisKKwlpZiAoaWR4ID4gMCkgewor
CQkqY3MrKyA9IE1JX1NUT1JFX0RXT1JEX0lNTV9HRU40IHwgTUlfVVNFX0dHVFQ7CisJCSpjcysr
ID0gaTkxNV9nZ3R0X29mZnNldCh2bWEpICsgNCAqIChpZHggLSAxKTsKKwkJKmNzKysgPSAwOwor
CQkqY3MrKyA9IDE7CisJfSBlbHNlIHsKKwkJKmNzKysgPSBNSV9OT09QOworCQkqY3MrKyA9IE1J
X05PT1A7CisJCSpjcysrID0gTUlfTk9PUDsKKwkJKmNzKysgPSBNSV9OT09QOworCX0KKworCSpj
cysrID0gTUlfQVJCX09OX09GRiB8IE1JX0FSQl9ESVNBQkxFOworCisJaW50ZWxfcmluZ19hZHZh
bmNlKHJxLCBjcyk7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICoKK3NlbWFwaG9yZV9xdWV1ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIHN0cnVj
dCBpOTE1X3ZtYSAqdm1hLCBpbnQgaWR4KQoreworCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpj
dHg7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJaW50IGVycjsKKworCWN0eCA9IGtlcm5l
bF9jb250ZXh0KGVuZ2luZS0+aTkxNSk7CisJaWYgKCFjdHgpCisJCXJldHVybiBFUlJfUFRSKC1F
Tk9NRU0pOworCisJcnEgPSBpZ3RfcmVxdWVzdF9hbGxvYyhjdHgsIGVuZ2luZSk7CisJaWYgKElT
X0VSUihycSkpCisJCWdvdG8gb3V0X2N0eDsKKworCWVyciA9IDA7CisJaWYgKHJxLT5lbmdpbmUt
PmVtaXRfaW5pdF9icmVhZGNydW1iKQorCQllcnIgPSBycS0+ZW5naW5lLT5lbWl0X2luaXRfYnJl
YWRjcnVtYihycSk7CisJaWYgKGVyciA9PSAwKQorCQllcnIgPSBlbWl0X3NlbWFwaG9yZV9jaGFp
bihycSwgdm1hLCBpZHgpOworCWlmIChlcnIgPT0gMCkKKwkJaTkxNV9yZXF1ZXN0X2dldChycSk7
CisJaTkxNV9yZXF1ZXN0X2FkZChycSk7CisJaWYgKGVycikKKwkJcnEgPSBFUlJfUFRSKGVycik7
CisKK291dF9jdHg6CisJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKKwlyZXR1cm4gcnE7Cit9
CisKK3N0YXRpYyBpbnQKK3JlbGVhc2VfcXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lLAorCSAgICAgIHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAorCSAgICAgIGludCBpZHgsIGludCBw
cmlvKQoreworCXN0cnVjdCBpOTE1X3NjaGVkX2F0dHIgYXR0ciA9IHsKKwkJLnByaW9yaXR5ID0g
cHJpbywKKwl9OworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCXUzMiAqY3M7CisKKwlycSA9
IGludGVsX2VuZ2luZV9jcmVhdGVfa2VybmVsX3JlcXVlc3QoZW5naW5lKTsKKwlpZiAoSVNfRVJS
KHJxKSkKKwkJcmV0dXJuIFBUUl9FUlIocnEpOworCisJY3MgPSBpbnRlbF9yaW5nX2JlZ2luKHJx
LCA0KTsKKwlpZiAoSVNfRVJSKGNzKSkgeworCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKwkJcmV0
dXJuIFBUUl9FUlIoY3MpOworCX0KKworCSpjcysrID0gTUlfU1RPUkVfRFdPUkRfSU1NX0dFTjQg
fCBNSV9VU0VfR0dUVDsKKwkqY3MrKyA9IGk5MTVfZ2d0dF9vZmZzZXQodm1hKSArIDQgKiAoaWR4
IC0gMSk7CisJKmNzKysgPSAwOworCSpjcysrID0gMTsKKworCWludGVsX3JpbmdfYWR2YW5jZShy
cSwgY3MpOworCisJaTkxNV9yZXF1ZXN0X2dldChycSk7CisJaTkxNV9yZXF1ZXN0X2FkZChycSk7
CisKKwlsb2NhbF9iaF9kaXNhYmxlKCk7CisJZW5naW5lLT5zY2hlZHVsZShycSwgJmF0dHIpOwor
CWxvY2FsX2JoX2VuYWJsZSgpOyAvKiBraWNrIHRhc2tsZXQgKi8KKworCWk5MTVfcmVxdWVzdF9w
dXQocnEpOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQKK3NsaWNlX3NlbWFwaG9yZV9x
dWV1ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpvdXRlciwKKwkJICAgICAgc3RydWN0IGk5MTVf
dm1hICp2bWEsCisJCSAgICAgIGludCBjb3VudCkKK3sKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmU7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqaGVhZDsKKwllbnVtIGludGVsX2VuZ2lu
ZV9pZCBpZDsKKwlpbnQgZXJyLCBpLCBuID0gMDsKKworCWhlYWQgPSBzZW1hcGhvcmVfcXVldWUo
b3V0ZXIsIHZtYSwgbisrKTsKKwlpZiAoSVNfRVJSKGhlYWQpKQorCQlyZXR1cm4gUFRSX0VSUiho
ZWFkKTsKKworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIG91dGVyLT5ndCwgaWQpIHsKKwkJZm9y
IChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKKwkJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwor
CisJCQlycSA9IHNlbWFwaG9yZV9xdWV1ZShlbmdpbmUsIHZtYSwgbisrKTsKKwkJCWlmIChJU19F
UlIocnEpKSB7CisJCQkJZXJyID0gUFRSX0VSUihycSk7CisJCQkJZ290byBvdXQ7CisJCQl9CisK
KwkJCWk5MTVfcmVxdWVzdF9wdXQocnEpOworCQl9CisJfQorCisJZXJyID0gcmVsZWFzZV9xdWV1
ZShvdXRlciwgdm1hLCBuLCBJTlRfTUFYKTsKKwlpZiAoZXJyKQorCQlnb3RvIG91dDsKKworCWlm
IChpOTE1X3JlcXVlc3Rfd2FpdChoZWFkLCAwLAorCQkJICAgICAgMiAqIFJVTlRJTUVfSU5GTyhv
dXRlci0+aTkxNSktPm51bV9lbmdpbmVzICogKGNvdW50ICsgMikgKiAoY291bnQgKyAzKSkgPCAw
KSB7CisJCXByX2VycigiRmFpbGVkIHRvIHNsaWNlIGFsb25nIHNlbWFwaG9yZSBjaGFpbiBvZiBs
ZW5ndGggKCVkLCAlZCkhXG4iLAorCQkgICAgICAgY291bnQsIG4pOworCQlHRU1fVFJBQ0VfRFVN
UCgpOworCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKG91dGVyLT5ndCk7CisJCWVyciA9IC1FSU87CisJ
fQorCitvdXQ6CisJaTkxNV9yZXF1ZXN0X3B1dChoZWFkKTsKKwlyZXR1cm4gZXJyOworfQorCitz
dGF0aWMgaW50IGxpdmVfdGltZXNsaWNlX3ByZWVtcHQodm9pZCAqYXJnKQoreworCXN0cnVjdCBp
bnRlbF9ndCAqZ3QgPSBhcmc7CisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKKwlz
dHJ1Y3QgaTkxNV92bWEgKnZtYTsKKwl2b2lkICp2YWRkcjsKKwlpbnQgZXJyID0gMDsKKwlpbnQg
Y291bnQ7CisKKwkvKgorCSAqIElmIGEgcmVxdWVzdCB0YWtlcyB0b28gbG9uZywgd2Ugd291bGQg
bGlrZSB0byBnaXZlIG90aGVyIHVzZXJzCisJICogYSBmYWlyIGdvIG9uIHRoZSBHUFUuIEluIHBh
cnRpY3VsYXIsIHVzZXJzIG1heSBjcmVhdGUgYmF0Y2hlcworCSAqIHRoYXQgd2FpdCB1cG9uIGV4
dGVybmFsIGlucHV0LCB3aGVyZSB0aGF0IGlucHV0IG1heSBldmVuIGJlCisJICogc3VwcGxpZWQg
YnkgYW5vdGhlciBHUFUgam9iLiBUbyBhdm9pZCBibG9ja2luZyBmb3JldmVyLCB3ZQorCSAqIG5l
ZWQgdG8gcHJlZW1wdCB0aGUgY3VycmVudCB0YXNrIGFuZCByZXBsYWNlIGl0IHdpdGggYW5vdGhl
cgorCSAqIHJlYWR5IHRhc2suCisJICovCisJaWYgKCFJU19BQ1RJVkUoQ09ORklHX0RSTV9JOTE1
X1RJTUVTTElDRV9EVVJBVElPTikpCisJCXJldHVybiAwOworCisJb2JqID0gaTkxNV9nZW1fb2Jq
ZWN0X2NyZWF0ZV9pbnRlcm5hbChndC0+aTkxNSwgUEFHRV9TSVpFKTsKKwlpZiAoSVNfRVJSKG9i
aikpCisJCXJldHVybiBQVFJfRVJSKG9iaik7CisKKwl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShv
YmosICZndC0+Z2d0dC0+dm0sIE5VTEwpOworCWlmIChJU19FUlIodm1hKSkgeworCQllcnIgPSBQ
VFJfRVJSKHZtYSk7CisJCWdvdG8gZXJyX29iajsKKwl9CisKKwl2YWRkciA9IGk5MTVfZ2VtX29i
amVjdF9waW5fbWFwKG9iaiwgSTkxNV9NQVBfV0MpOworCWlmIChJU19FUlIodmFkZHIpKSB7CisJ
CWVyciA9IFBUUl9FUlIodmFkZHIpOworCQlnb3RvIGVycl9vYmo7CisJfQorCisJZXJyID0gaTkx
NV92bWFfcGluKHZtYSwgMCwgMCwgUElOX0dMT0JBTCk7CisJaWYgKGVycikKKwkJZ290byBlcnJf
bWFwOworCisJZm9yX2VhY2hfcHJpbWVfbnVtYmVyX2Zyb20oY291bnQsIDEsIDE2KSB7CisJCXN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKKwkJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7
CisKKwkJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7CisJCQlpZiAoIWludGVsX2Vu
Z2luZV9oYXNfcHJlZW1wdGlvbihlbmdpbmUpKQorCQkJCWNvbnRpbnVlOworCisJCQltZW1zZXQo
dmFkZHIsIDAsIFBBR0VfU0laRSk7CisKKwkJCWVyciA9IHNsaWNlX3NlbWFwaG9yZV9xdWV1ZShl
bmdpbmUsIHZtYSwgY291bnQpOworCQkJaWYgKGVycikKKwkJCQlnb3RvIGVycl9waW47CisKKwkJ
CWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpIHsKKwkJCQllcnIgPSAtRUlPOworCQkJCWdv
dG8gZXJyX3BpbjsKKwkJCX0KKwkJfQorCX0KKworZXJyX3BpbjoKKwlpOTE1X3ZtYV91bnBpbih2
bWEpOworZXJyX21hcDoKKwlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKG9iaik7CitlcnJfb2Jq
OgorCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMg
c3RydWN0IGk5MTVfcmVxdWVzdCAqbm9wX3JlcXVlc3Qoc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lKQoreworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCisJcnEgPSBpbnRlbF9lbmdp
bmVfY3JlYXRlX2tlcm5lbF9yZXF1ZXN0KGVuZ2luZSk7CisJaWYgKElTX0VSUihycSkpCisJCXJl
dHVybiBycTsKKworCWk5MTVfcmVxdWVzdF9nZXQocnEpOworCWk5MTVfcmVxdWVzdF9hZGQocnEp
OworCisJcmV0dXJuIHJxOworfQorCitzdGF0aWMgdm9pZCB3YWl0X2Zvcl9zdWJtaXQoc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAorCQkJICAgIHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
KQoreworCWRvIHsKKwkJY29uZF9yZXNjaGVkKCk7CisJCWludGVsX2VuZ2luZV9mbHVzaF9zdWJt
aXNzaW9uKGVuZ2luZSk7CisJfSB3aGlsZSAoIWk5MTVfcmVxdWVzdF9pc19hY3RpdmUocnEpKTsK
K30KKworc3RhdGljIGxvbmcgdGltZXNsaWNlX3RocmVzaG9sZChjb25zdCBzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmUpCit7CisJcmV0dXJuIDIgKiBtc2Vjc190b19qaWZmaWVzX3RpbWVv
dXQodGltZXNsaWNlKGVuZ2luZSkpICsgMTsKK30KKworc3RhdGljIGludCBsaXZlX3RpbWVzbGlj
ZV9xdWV1ZSh2b2lkICphcmcpCit7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKKwlzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZTsKKwllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKKwlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsK
Kwl2b2lkICp2YWRkcjsKKwlpbnQgZXJyID0gMDsKKworCS8qCisJICogTWFrZSBzdXJlIHRoYXQg
ZXZlbiBpZiBFTFNQWzBdIGFuZCBFTFNQWzFdIGFyZSBmaWxsZWQgd2l0aAorCSAqIHRpbWVzbGlj
aW5nIGJldHdlZW4gdGhlbSBkaXNhYmxlZCwgd2UgKmRvKiBlbmFibGUgdGltZXNsaWNpbmcKKwkg
KiBpZiB0aGUgcXVldWUgZGVtYW5kcyBpdC4gKE5vcm1hbGx5LCB3ZSBkbyBub3Qgc3VibWl0IGlm
CisJICogRUxTUFsxXSBpcyBhbHJlYWR5IG9jY3VwaWVkLCBzbyBtdXN0IHJlbHkgb24gdGltZXNs
aWNpbmcgdG8KKwkgKiBlamVjdCBFTFNQWzBdIGluIGZhdm91ciBvZiB0aGUgcXVldWUuKQorCSAq
LworCWlmICghSVNfQUNUSVZFKENPTkZJR19EUk1fSTkxNV9USU1FU0xJQ0VfRFVSQVRJT04pKQor
CQlyZXR1cm4gMDsKKworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoZ3Qt
Pmk5MTUsIFBBR0VfU0laRSk7CisJaWYgKElTX0VSUihvYmopKQorCQlyZXR1cm4gUFRSX0VSUihv
YmopOworCisJdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCAmZ3QtPmdndHQtPnZtLCBOVUxM
KTsKKwlpZiAoSVNfRVJSKHZtYSkpIHsKKwkJZXJyID0gUFRSX0VSUih2bWEpOworCQlnb3RvIGVy
cl9vYmo7CisJfQorCisJdmFkZHIgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChvYmosIEk5MTVf
TUFQX1dDKTsKKwlpZiAoSVNfRVJSKHZhZGRyKSkgeworCQllcnIgPSBQVFJfRVJSKHZhZGRyKTsK
KwkJZ290byBlcnJfb2JqOworCX0KKworCWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIFBJ
Tl9HTE9CQUwpOworCWlmIChlcnIpCisJCWdvdG8gZXJyX21hcDsKKworCWZvcl9lYWNoX2VuZ2lu
ZShlbmdpbmUsIGd0LCBpZCkgeworCQlzdHJ1Y3QgaTkxNV9zY2hlZF9hdHRyIGF0dHIgPSB7CisJ
CQkucHJpb3JpdHkgPSBJOTE1X1VTRVJfUFJJT1JJVFkoSTkxNV9QUklPUklUWV9NQVgpLAorCQl9
OworCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgKm5vcDsKKworCQlpZiAoIWludGVsX2VuZ2lu
ZV9oYXNfcHJlZW1wdGlvbihlbmdpbmUpKQorCQkJY29udGludWU7CisKKwkJbWVtc2V0KHZhZGRy
LCAwLCBQQUdFX1NJWkUpOworCisJCS8qIEVMU1BbMF06IHNlbWFwaG9yZSB3YWl0ICovCisJCXJx
ID0gc2VtYXBob3JlX3F1ZXVlKGVuZ2luZSwgdm1hLCAwKTsKKwkJaWYgKElTX0VSUihycSkpIHsK
KwkJCWVyciA9IFBUUl9FUlIocnEpOworCQkJZ290byBlcnJfcGluOworCQl9CisJCWVuZ2luZS0+
c2NoZWR1bGUocnEsICZhdHRyKTsKKwkJd2FpdF9mb3Jfc3VibWl0KGVuZ2luZSwgcnEpOworCisJ
CS8qIEVMU1BbMV06IG5vcCByZXF1ZXN0ICovCisJCW5vcCA9IG5vcF9yZXF1ZXN0KGVuZ2luZSk7
CisJCWlmIChJU19FUlIobm9wKSkgeworCQkJZXJyID0gUFRSX0VSUihub3ApOworCQkJaTkxNV9y
ZXF1ZXN0X3B1dChycSk7CisJCQlnb3RvIGVycl9waW47CisJCX0KKwkJd2FpdF9mb3Jfc3VibWl0
KGVuZ2luZSwgbm9wKTsKKwkJaTkxNV9yZXF1ZXN0X3B1dChub3ApOworCisJCUdFTV9CVUdfT04o
aTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChycSkpOworCQlHRU1fQlVHX09OKGV4ZWNsaXN0c19hY3Rp
dmUoJmVuZ2luZS0+ZXhlY2xpc3RzKSAhPSBycSk7CisKKwkJLyogUXVldWU6IHNlbWFwaG9yZSBz
aWduYWwsIG1hdGNoaW5nIHByaW9yaXR5IGFzIHNlbWFwaG9yZSAqLworCQllcnIgPSByZWxlYXNl
X3F1ZXVlKGVuZ2luZSwgdm1hLCAxLCBlZmZlY3RpdmVfcHJpbyhycSkpOworCQlpZiAoZXJyKSB7
CisJCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKKwkJCWdvdG8gZXJyX3BpbjsKKwkJfQorCisJCWlu
dGVsX2VuZ2luZV9mbHVzaF9zdWJtaXNzaW9uKGVuZ2luZSk7CisJCWlmICghUkVBRF9PTkNFKGVu
Z2luZS0+ZXhlY2xpc3RzLnRpbWVyLmV4cGlyZXMpICYmCisJCSAgICAhaTkxNV9yZXF1ZXN0X2Nv
bXBsZXRlZChycSkpIHsKKwkJCXN0cnVjdCBkcm1fcHJpbnRlciBwID0KKwkJCQlkcm1faW5mb19w
cmludGVyKGd0LT5pOTE1LT5kcm0uZGV2KTsKKworCQkJR0VNX1RSQUNFX0VSUigiJXM6IEZhaWxl
ZCB0byBlbmFibGUgdGltZXNsaWNpbmchXG4iLAorCQkJCSAgICAgIGVuZ2luZS0+bmFtZSk7CisJ
CQlpbnRlbF9lbmdpbmVfZHVtcChlbmdpbmUsICZwLAorCQkJCQkgICIlc1xuIiwgZW5naW5lLT5u
YW1lKTsKKwkJCUdFTV9UUkFDRV9EVU1QKCk7CisKKwkJCW1lbXNldCh2YWRkciwgMHhmZiwgUEFH
RV9TSVpFKTsKKwkJCWVyciA9IC1FSU5WQUw7CisJCX0KKworCQkvKiBUaW1lc2xpY2UgZXZlcnkg
amlmZnksIHNvIHdpdGhpbiAyIHdlIHNob3VsZCBzaWduYWwgKi8KKwkJaWYgKGk5MTVfcmVxdWVz
dF93YWl0KHJxLCAwLCB0aW1lc2xpY2VfdGhyZXNob2xkKGVuZ2luZSkpIDwgMCkgeworCQkJc3Ry
dWN0IGRybV9wcmludGVyIHAgPQorCQkJCWRybV9pbmZvX3ByaW50ZXIoZ3QtPmk5MTUtPmRybS5k
ZXYpOworCisJCQlwcl9lcnIoIiVzOiBGYWlsZWQgdG8gdGltZXNsaWNlIGludG8gcXVldWVcbiIs
CisJCQkgICAgICAgZW5naW5lLT5uYW1lKTsKKwkJCWludGVsX2VuZ2luZV9kdW1wKGVuZ2luZSwg
JnAsCisJCQkJCSAgIiVzXG4iLCBlbmdpbmUtPm5hbWUpOworCisJCQltZW1zZXQodmFkZHIsIDB4
ZmYsIFBBR0VfU0laRSk7CisJCQllcnIgPSAtRUlPOworCQl9CisJCWk5MTVfcmVxdWVzdF9wdXQo
cnEpOworCQlpZiAoZXJyKQorCQkJYnJlYWs7CisJfQorCitlcnJfcGluOgorCWk5MTVfdm1hX3Vu
cGluKHZtYSk7CitlcnJfbWFwOgorCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAob2JqKTsKK2Vy
cl9vYmo6CisJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCXJldHVybiBlcnI7Cit9CisKK3N0
YXRpYyBpbnQgbGl2ZV9idXN5d2FpdF9wcmVlbXB0KHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50
ZWxfZ3QgKmd0ID0gYXJnOworCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHhfaGksICpjdHhf
bG87CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOworCXN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmo7CisJc3RydWN0IGk5MTVfdm1hICp2bWE7CisJZW51bSBpbnRlbF9lbmdp
bmVfaWQgaWQ7CisJaW50IGVyciA9IC1FTk9NRU07CisJdTMyICptYXA7CisKKwkvKgorCSAqIFZl
cmlmeSB0aGF0IGV2ZW4gd2l0aG91dCBIQVNfTE9HSUNBTF9SSU5HX1BSRUVNUFRJT04sIHdlIGNh
bgorCSAqIHByZWVtcHQgdGhlIGJ1c3l3YWl0cyB1c2VkIHRvIHN5bmNocm9uaXNlIGJldHdlZW4g
cmluZ3MuCisJICovCisKKwljdHhfaGkgPSBrZXJuZWxfY29udGV4dChndC0+aTkxNSk7CisJaWYg
KCFjdHhfaGkpCisJCXJldHVybiAtRU5PTUVNOworCWN0eF9oaS0+c2NoZWQucHJpb3JpdHkgPQor
CQlJOTE1X1VTRVJfUFJJT1JJVFkoSTkxNV9DT05URVhUX01BWF9VU0VSX1BSSU9SSVRZKTsKKwor
CWN0eF9sbyA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKKwlpZiAoIWN0eF9sbykKKwkJZ290
byBlcnJfY3R4X2hpOworCWN0eF9sby0+c2NoZWQucHJpb3JpdHkgPQorCQlJOTE1X1VTRVJfUFJJ
T1JJVFkoSTkxNV9DT05URVhUX01JTl9VU0VSX1BSSU9SSVRZKTsKKworCW9iaiA9IGk5MTVfZ2Vt
X29iamVjdF9jcmVhdGVfaW50ZXJuYWwoZ3QtPmk5MTUsIFBBR0VfU0laRSk7CisJaWYgKElTX0VS
UihvYmopKSB7CisJCWVyciA9IFBUUl9FUlIob2JqKTsKKwkJZ290byBlcnJfY3R4X2xvOworCX0K
KworCW1hcCA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKG9iaiwgSTkxNV9NQVBfV0MpOworCWlm
IChJU19FUlIobWFwKSkgeworCQllcnIgPSBQVFJfRVJSKG1hcCk7CisJCWdvdG8gZXJyX29iajsK
Kwl9CisKKwl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosICZndC0+Z2d0dC0+dm0sIE5VTEwp
OworCWlmIChJU19FUlIodm1hKSkgeworCQllcnIgPSBQVFJfRVJSKHZtYSk7CisJCWdvdG8gZXJy
X21hcDsKKwl9CisKKwllcnIgPSBpOTE1X3ZtYV9waW4odm1hLCAwLCAwLCBQSU5fR0xPQkFMKTsK
KwlpZiAoZXJyKQorCQlnb3RvIGVycl9tYXA7CisKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBn
dCwgaWQpIHsKKwkJc3RydWN0IGk5MTVfcmVxdWVzdCAqbG8sICpoaTsKKwkJc3RydWN0IGlndF9s
aXZlX3Rlc3QgdDsKKwkJdTMyICpjczsKKworCQlpZiAoIWludGVsX2VuZ2luZV9oYXNfcHJlZW1w
dGlvbihlbmdpbmUpKQorCQkJY29udGludWU7CisKKwkJaWYgKCFpbnRlbF9lbmdpbmVfY2FuX3N0
b3JlX2R3b3JkKGVuZ2luZSkpCisJCQljb250aW51ZTsKKworCQlpZiAoaWd0X2xpdmVfdGVzdF9i
ZWdpbigmdCwgZ3QtPmk5MTUsIF9fZnVuY19fLCBlbmdpbmUtPm5hbWUpKSB7CisJCQllcnIgPSAt
RUlPOworCQkJZ290byBlcnJfdm1hOworCQl9CisKKwkJLyoKKwkJICogV2UgY3JlYXRlIHR3byBy
ZXF1ZXN0cy4gVGhlIGxvdyBwcmlvcml0eSByZXF1ZXN0CisJCSAqIGJ1c3l3YWl0cyBvbiBhIHNl
bWFwaG9yZSAoaW5zaWRlIHRoZSByaW5nYnVmZmVyIHdoZXJlCisJCSAqIGlzIHNob3VsZCBiZSBw
cmVlbXB0aWJsZSkgYW5kIHRoZSBoaWdoIHByaW9yaXR5IHJlcXVlc3RzCisJCSAqIHVzZXMgYSBN
SV9TVE9SRV9EV09SRF9JTU0gdG8gdXBkYXRlIHRoZSBzZW1hcGhvcmUgdmFsdWUKKwkJICogYWxs
b3dpbmcgdGhlIGZpcnN0IHJlcXVlc3QgdG8gY29tcGxldGUuIElmIHByZWVtcHRpb24KKwkJICog
ZmFpbHMsIHdlIGhhbmcgaW5zdGVhZC4KKwkJICovCisKKwkJbG8gPSBpZ3RfcmVxdWVzdF9hbGxv
YyhjdHhfbG8sIGVuZ2luZSk7CisJCWlmIChJU19FUlIobG8pKSB7CisJCQllcnIgPSBQVFJfRVJS
KGxvKTsKKwkJCWdvdG8gZXJyX3ZtYTsKKwkJfQorCisJCWNzID0gaW50ZWxfcmluZ19iZWdpbihs
bywgOCk7CisJCWlmIChJU19FUlIoY3MpKSB7CisJCQllcnIgPSBQVFJfRVJSKGNzKTsKKwkJCWk5
MTVfcmVxdWVzdF9hZGQobG8pOworCQkJZ290byBlcnJfdm1hOworCQl9CisKKwkJKmNzKysgPSBN
SV9TVE9SRV9EV09SRF9JTU1fR0VONCB8IE1JX1VTRV9HR1RUOworCQkqY3MrKyA9IGk5MTVfZ2d0
dF9vZmZzZXQodm1hKTsKKwkJKmNzKysgPSAwOworCQkqY3MrKyA9IDE7CisKKwkJLyogWFhYIERv
IHdlIG5lZWQgYSBmbHVzaCArIGludmFsaWRhdGUgaGVyZT8gKi8KKworCQkqY3MrKyA9IE1JX1NF
TUFQSE9SRV9XQUlUIHwKKwkJCU1JX1NFTUFQSE9SRV9HTE9CQUxfR1RUIHwKKwkJCU1JX1NFTUFQ
SE9SRV9QT0xMIHwKKwkJCU1JX1NFTUFQSE9SRV9TQURfRVFfU0REOworCQkqY3MrKyA9IDA7CisJ
CSpjcysrID0gaTkxNV9nZ3R0X29mZnNldCh2bWEpOworCQkqY3MrKyA9IDA7CisKKwkJaW50ZWxf
cmluZ19hZHZhbmNlKGxvLCBjcyk7CisKKwkJaTkxNV9yZXF1ZXN0X2dldChsbyk7CisJCWk5MTVf
cmVxdWVzdF9hZGQobG8pOworCisJCWlmICh3YWl0X2ZvcihSRUFEX09OQ0UoKm1hcCksIDEwKSkg
eworCQkJaTkxNV9yZXF1ZXN0X3B1dChsbyk7CisJCQllcnIgPSAtRVRJTUVET1VUOworCQkJZ290
byBlcnJfdm1hOworCQl9CisKKwkJLyogTG93IHByaW9yaXR5IHJlcXVlc3Qgc2hvdWxkIGJlIGJ1
c3l3YWl0aW5nIG5vdyAqLworCQlpZiAoaTkxNV9yZXF1ZXN0X3dhaXQobG8sIDAsIDEpICE9IC1F
VElNRSkgeworCQkJaTkxNV9yZXF1ZXN0X3B1dChsbyk7CisJCQlwcl9lcnIoIiVzOiBCdXN5d2Fp
dGluZyByZXF1ZXN0IGRpZCBub3QhXG4iLAorCQkJICAgICAgIGVuZ2luZS0+bmFtZSk7CisJCQll
cnIgPSAtRUlPOworCQkJZ290byBlcnJfdm1hOworCQl9CisKKwkJaGkgPSBpZ3RfcmVxdWVzdF9h
bGxvYyhjdHhfaGksIGVuZ2luZSk7CisJCWlmIChJU19FUlIoaGkpKSB7CisJCQllcnIgPSBQVFJf
RVJSKGhpKTsKKwkJCWk5MTVfcmVxdWVzdF9wdXQobG8pOworCQkJZ290byBlcnJfdm1hOworCQl9
CisKKwkJY3MgPSBpbnRlbF9yaW5nX2JlZ2luKGhpLCA0KTsKKwkJaWYgKElTX0VSUihjcykpIHsK
KwkJCWVyciA9IFBUUl9FUlIoY3MpOworCQkJaTkxNV9yZXF1ZXN0X2FkZChoaSk7CisJCQlpOTE1
X3JlcXVlc3RfcHV0KGxvKTsKKwkJCWdvdG8gZXJyX3ZtYTsKKwkJfQorCisJCSpjcysrID0gTUlf
U1RPUkVfRFdPUkRfSU1NX0dFTjQgfCBNSV9VU0VfR0dUVDsKKwkJKmNzKysgPSBpOTE1X2dndHRf
b2Zmc2V0KHZtYSk7CisJCSpjcysrID0gMDsKKwkJKmNzKysgPSAwOworCisJCWludGVsX3Jpbmdf
YWR2YW5jZShoaSwgY3MpOworCQlpOTE1X3JlcXVlc3RfYWRkKGhpKTsKKworCQlpZiAoaTkxNV9y
ZXF1ZXN0X3dhaXQobG8sIDAsIEhaIC8gNSkgPCAwKSB7CisJCQlzdHJ1Y3QgZHJtX3ByaW50ZXIg
cCA9IGRybV9pbmZvX3ByaW50ZXIoZ3QtPmk5MTUtPmRybS5kZXYpOworCisJCQlwcl9lcnIoIiVz
OiBGYWlsZWQgdG8gcHJlZW1wdCBzZW1hcGhvcmUgYnVzeXdhaXQhXG4iLAorCQkJICAgICAgIGVu
Z2luZS0+bmFtZSk7CisKKwkJCWludGVsX2VuZ2luZV9kdW1wKGVuZ2luZSwgJnAsICIlc1xuIiwg
ZW5naW5lLT5uYW1lKTsKKwkJCUdFTV9UUkFDRV9EVU1QKCk7CisKKwkJCWk5MTVfcmVxdWVzdF9w
dXQobG8pOworCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CisJCQllcnIgPSAtRUlPOworCQkJ
Z290byBlcnJfdm1hOworCQl9CisJCUdFTV9CVUdfT04oUkVBRF9PTkNFKCptYXApKTsKKwkJaTkx
NV9yZXF1ZXN0X3B1dChsbyk7CisKKwkJaWYgKGlndF9saXZlX3Rlc3RfZW5kKCZ0KSkgeworCQkJ
ZXJyID0gLUVJTzsKKwkJCWdvdG8gZXJyX3ZtYTsKKwkJfQorCX0KKworCWVyciA9IDA7CitlcnJf
dm1hOgorCWk5MTVfdm1hX3VucGluKHZtYSk7CitlcnJfbWFwOgorCWk5MTVfZ2VtX29iamVjdF91
bnBpbl9tYXAob2JqKTsKK2Vycl9vYmo6CisJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworZXJy
X2N0eF9sbzoKKwlrZXJuZWxfY29udGV4dF9jbG9zZShjdHhfbG8pOworZXJyX2N0eF9oaToKKwlr
ZXJuZWxfY29udGV4dF9jbG9zZShjdHhfaGkpOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICoKK3NwaW5uZXJfY3JlYXRlX3JlcXVlc3Qoc3RydWN0IGlndF9z
cGlubmVyICpzcGluLAorCQkgICAgICAgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKKwkJ
ICAgICAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKKwkJICAgICAgIHUzMiBhcmIp
Cit7CisJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
OworCisJY2UgPSBpOTE1X2dlbV9jb250ZXh0X2dldF9lbmdpbmUoY3R4LCBlbmdpbmUtPmxlZ2Fj
eV9pZHgpOworCWlmIChJU19FUlIoY2UpKQorCQlyZXR1cm4gRVJSX0NBU1QoY2UpOworCisJcnEg
PSBpZ3Rfc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdChzcGluLCBjZSwgYXJiKTsKKwlpbnRlbF9jb250
ZXh0X3B1dChjZSk7CisJcmV0dXJuIHJxOworfQorCitzdGF0aWMgaW50IGxpdmVfcHJlZW1wdCh2
b2lkICphcmcpCit7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKKwlzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqY3R4X2hpLCAqY3R4X2xvOworCXN0cnVjdCBpZ3Rfc3Bpbm5lciBzcGluX2hp
LCBzcGluX2xvOworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKKwllbnVtIGludGVs
X2VuZ2luZV9pZCBpZDsKKwlpbnQgZXJyID0gLUVOT01FTTsKKworCWlmICghSEFTX0xPR0lDQUxf
UklOR19QUkVFTVBUSU9OKGd0LT5pOTE1KSkKKwkJcmV0dXJuIDA7CisKKwlpZiAoIShndC0+aTkx
NS0+Y2Fwcy5zY2hlZHVsZXIgJiBJOTE1X1NDSEVEVUxFUl9DQVBfUFJFRU1QVElPTikpCisJCXBy
X2VycigiTG9naWNhbCBwcmVlbXB0aW9uIHN1cHBvcnRlZCwgYnV0IG5vdCBleHBvc2VkXG4iKTsK
KworCWlmIChpZ3Rfc3Bpbm5lcl9pbml0KCZzcGluX2hpLCBndCkpCisJCXJldHVybiAtRU5PTUVN
OworCisJaWYgKGlndF9zcGlubmVyX2luaXQoJnNwaW5fbG8sIGd0KSkKKwkJZ290byBlcnJfc3Bp
bl9oaTsKKworCWN0eF9oaSA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKKwlpZiAoIWN0eF9o
aSkKKwkJZ290byBlcnJfc3Bpbl9sbzsKKwljdHhfaGktPnNjaGVkLnByaW9yaXR5ID0KKwkJSTkx
NV9VU0VSX1BSSU9SSVRZKEk5MTVfQ09OVEVYVF9NQVhfVVNFUl9QUklPUklUWSk7CisKKwljdHhf
bG8gPSBrZXJuZWxfY29udGV4dChndC0+aTkxNSk7CisJaWYgKCFjdHhfbG8pCisJCWdvdG8gZXJy
X2N0eF9oaTsKKwljdHhfbG8tPnNjaGVkLnByaW9yaXR5ID0KKwkJSTkxNV9VU0VSX1BSSU9SSVRZ
KEk5MTVfQ09OVEVYVF9NSU5fVVNFUl9QUklPUklUWSk7CisKKwlmb3JfZWFjaF9lbmdpbmUoZW5n
aW5lLCBndCwgaWQpIHsKKwkJc3RydWN0IGlndF9saXZlX3Rlc3QgdDsKKwkJc3RydWN0IGk5MTVf
cmVxdWVzdCAqcnE7CisKKwkJaWYgKCFpbnRlbF9lbmdpbmVfaGFzX3ByZWVtcHRpb24oZW5naW5l
KSkKKwkJCWNvbnRpbnVlOworCisJCWlmIChpZ3RfbGl2ZV90ZXN0X2JlZ2luKCZ0LCBndC0+aTkx
NSwgX19mdW5jX18sIGVuZ2luZS0+bmFtZSkpIHsKKwkJCWVyciA9IC1FSU87CisJCQlnb3RvIGVy
cl9jdHhfbG87CisJCX0KKworCQlycSA9IHNwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJnNwaW5fbG8s
IGN0eF9sbywgZW5naW5lLAorCQkJCQkgICAgTUlfQVJCX0NIRUNLKTsKKwkJaWYgKElTX0VSUihy
cSkpIHsKKwkJCWVyciA9IFBUUl9FUlIocnEpOworCQkJZ290byBlcnJfY3R4X2xvOworCQl9CisK
KwkJaTkxNV9yZXF1ZXN0X2FkZChycSk7CisJCWlmICghaWd0X3dhaXRfZm9yX3NwaW5uZXIoJnNw
aW5fbG8sIHJxKSkgeworCQkJR0VNX1RSQUNFKCJsbyBzcGlubmVyIGZhaWxlZCB0byBzdGFydFxu
Iik7CisJCQlHRU1fVFJBQ0VfRFVNUCgpOworCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CisJ
CQllcnIgPSAtRUlPOworCQkJZ290byBlcnJfY3R4X2xvOworCQl9CisKKwkJcnEgPSBzcGlubmVy
X2NyZWF0ZV9yZXF1ZXN0KCZzcGluX2hpLCBjdHhfaGksIGVuZ2luZSwKKwkJCQkJICAgIE1JX0FS
Ql9DSEVDSyk7CisJCWlmIChJU19FUlIocnEpKSB7CisJCQlpZ3Rfc3Bpbm5lcl9lbmQoJnNwaW5f
bG8pOworCQkJZXJyID0gUFRSX0VSUihycSk7CisJCQlnb3RvIGVycl9jdHhfbG87CisJCX0KKwor
CQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKwkJaWYgKCFpZ3Rfd2FpdF9mb3Jfc3Bpbm5lcigmc3Bp
bl9oaSwgcnEpKSB7CisJCQlHRU1fVFJBQ0UoImhpIHNwaW5uZXIgZmFpbGVkIHRvIHN0YXJ0XG4i
KTsKKwkJCUdFTV9UUkFDRV9EVU1QKCk7CisJCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKGd0KTsKKwkJ
CWVyciA9IC1FSU87CisJCQlnb3RvIGVycl9jdHhfbG87CisJCX0KKworCQlpZ3Rfc3Bpbm5lcl9l
bmQoJnNwaW5faGkpOworCQlpZ3Rfc3Bpbm5lcl9lbmQoJnNwaW5fbG8pOworCisJCWlmIChpZ3Rf
bGl2ZV90ZXN0X2VuZCgmdCkpIHsKKwkJCWVyciA9IC1FSU87CisJCQlnb3RvIGVycl9jdHhfbG87
CisJCX0KKwl9CisKKwllcnIgPSAwOworZXJyX2N0eF9sbzoKKwlrZXJuZWxfY29udGV4dF9jbG9z
ZShjdHhfbG8pOworZXJyX2N0eF9oaToKKwlrZXJuZWxfY29udGV4dF9jbG9zZShjdHhfaGkpOwor
ZXJyX3NwaW5fbG86CisJaWd0X3NwaW5uZXJfZmluaSgmc3Bpbl9sbyk7CitlcnJfc3Bpbl9oaToK
KwlpZ3Rfc3Bpbm5lcl9maW5pKCZzcGluX2hpKTsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMg
aW50IGxpdmVfbGF0ZV9wcmVlbXB0KHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0
ID0gYXJnOworCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHhfaGksICpjdHhfbG87CisJc3Ry
dWN0IGlndF9zcGlubmVyIHNwaW5faGksIHNwaW5fbG87CisJc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lOworCXN0cnVjdCBpOTE1X3NjaGVkX2F0dHIgYXR0ciA9IHt9OworCWVudW0gaW50
ZWxfZW5naW5lX2lkIGlkOworCWludCBlcnIgPSAtRU5PTUVNOworCisJaWYgKCFIQVNfTE9HSUNB
TF9SSU5HX1BSRUVNUFRJT04oZ3QtPmk5MTUpKQorCQlyZXR1cm4gMDsKKworCWlmIChpZ3Rfc3Bp
bm5lcl9pbml0KCZzcGluX2hpLCBndCkpCisJCXJldHVybiAtRU5PTUVNOworCisJaWYgKGlndF9z
cGlubmVyX2luaXQoJnNwaW5fbG8sIGd0KSkKKwkJZ290byBlcnJfc3Bpbl9oaTsKKworCWN0eF9o
aSA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKKwlpZiAoIWN0eF9oaSkKKwkJZ290byBlcnJf
c3Bpbl9sbzsKKworCWN0eF9sbyA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKKwlpZiAoIWN0
eF9sbykKKwkJZ290byBlcnJfY3R4X2hpOworCisJLyogTWFrZSBzdXJlIGN0eF9sbyBzdGF5cyBi
ZWZvcmUgY3R4X2hpIHVudGlsIHdlIHRyaWdnZXIgcHJlZW1wdGlvbi4gKi8KKwljdHhfbG8tPnNj
aGVkLnByaW9yaXR5ID0gSTkxNV9VU0VSX1BSSU9SSVRZKDEpOworCisJZm9yX2VhY2hfZW5naW5l
KGVuZ2luZSwgZ3QsIGlkKSB7CisJCXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7CisJCXN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxOworCisJCWlmICghaW50ZWxfZW5naW5lX2hhc19wcmVlbXB0aW9uKGVu
Z2luZSkpCisJCQljb250aW51ZTsKKworCQlpZiAoaWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgZ3Qt
Pmk5MTUsIF9fZnVuY19fLCBlbmdpbmUtPm5hbWUpKSB7CisJCQllcnIgPSAtRUlPOworCQkJZ290
byBlcnJfY3R4X2xvOworCQl9CisKKwkJcnEgPSBzcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZzcGlu
X2xvLCBjdHhfbG8sIGVuZ2luZSwKKwkJCQkJICAgIE1JX0FSQl9DSEVDSyk7CisJCWlmIChJU19F
UlIocnEpKSB7CisJCQllcnIgPSBQVFJfRVJSKHJxKTsKKwkJCWdvdG8gZXJyX2N0eF9sbzsKKwkJ
fQorCisJCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCQlpZiAoIWlndF93YWl0X2Zvcl9zcGlubmVy
KCZzcGluX2xvLCBycSkpIHsKKwkJCXByX2VycigiRmlyc3QgY29udGV4dCBmYWlsZWQgdG8gc3Rh
cnRcbiIpOworCQkJZ290byBlcnJfd2VkZ2VkOworCQl9CisKKwkJcnEgPSBzcGlubmVyX2NyZWF0
ZV9yZXF1ZXN0KCZzcGluX2hpLCBjdHhfaGksIGVuZ2luZSwKKwkJCQkJICAgIE1JX05PT1ApOwor
CQlpZiAoSVNfRVJSKHJxKSkgeworCQkJaWd0X3NwaW5uZXJfZW5kKCZzcGluX2xvKTsKKwkJCWVy
ciA9IFBUUl9FUlIocnEpOworCQkJZ290byBlcnJfY3R4X2xvOworCQl9CisKKwkJaTkxNV9yZXF1
ZXN0X2FkZChycSk7CisJCWlmIChpZ3Rfd2FpdF9mb3Jfc3Bpbm5lcigmc3Bpbl9oaSwgcnEpKSB7
CisJCQlwcl9lcnIoIlNlY29uZCBjb250ZXh0IG92ZXJ0b29rIGZpcnN0P1xuIik7CisJCQlnb3Rv
IGVycl93ZWRnZWQ7CisJCX0KKworCQlhdHRyLnByaW9yaXR5ID0gSTkxNV9VU0VSX1BSSU9SSVRZ
KEk5MTVfUFJJT1JJVFlfTUFYKTsKKwkJZW5naW5lLT5zY2hlZHVsZShycSwgJmF0dHIpOworCisJ
CWlmICghaWd0X3dhaXRfZm9yX3NwaW5uZXIoJnNwaW5faGksIHJxKSkgeworCQkJcHJfZXJyKCJI
aWdoIHByaW9yaXR5IGNvbnRleHQgZmFpbGVkIHRvIHByZWVtcHQgdGhlIGxvdyBwcmlvcml0eSBj
b250ZXh0XG4iKTsKKwkJCUdFTV9UUkFDRV9EVU1QKCk7CisJCQlnb3RvIGVycl93ZWRnZWQ7CisJ
CX0KKworCQlpZ3Rfc3Bpbm5lcl9lbmQoJnNwaW5faGkpOworCQlpZ3Rfc3Bpbm5lcl9lbmQoJnNw
aW5fbG8pOworCisJCWlmIChpZ3RfbGl2ZV90ZXN0X2VuZCgmdCkpIHsKKwkJCWVyciA9IC1FSU87
CisJCQlnb3RvIGVycl9jdHhfbG87CisJCX0KKwl9CisKKwllcnIgPSAwOworZXJyX2N0eF9sbzoK
KwlrZXJuZWxfY29udGV4dF9jbG9zZShjdHhfbG8pOworZXJyX2N0eF9oaToKKwlrZXJuZWxfY29u
dGV4dF9jbG9zZShjdHhfaGkpOworZXJyX3NwaW5fbG86CisJaWd0X3NwaW5uZXJfZmluaSgmc3Bp
bl9sbyk7CitlcnJfc3Bpbl9oaToKKwlpZ3Rfc3Bpbm5lcl9maW5pKCZzcGluX2hpKTsKKwlyZXR1
cm4gZXJyOworCitlcnJfd2VkZ2VkOgorCWlndF9zcGlubmVyX2VuZCgmc3Bpbl9oaSk7CisJaWd0
X3NwaW5uZXJfZW5kKCZzcGluX2xvKTsKKwlpbnRlbF9ndF9zZXRfd2VkZ2VkKGd0KTsKKwllcnIg
PSAtRUlPOworCWdvdG8gZXJyX2N0eF9sbzsKK30KKworc3RydWN0IHByZWVtcHRfY2xpZW50IHsK
KwlzdHJ1Y3QgaWd0X3NwaW5uZXIgc3BpbjsKKwlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4
OworfTsKKworc3RhdGljIGludCBwcmVlbXB0X2NsaWVudF9pbml0KHN0cnVjdCBpbnRlbF9ndCAq
Z3QsIHN0cnVjdCBwcmVlbXB0X2NsaWVudCAqYykKK3sKKwljLT5jdHggPSBrZXJuZWxfY29udGV4
dChndC0+aTkxNSk7CisJaWYgKCFjLT5jdHgpCisJCXJldHVybiAtRU5PTUVNOworCisJaWYgKGln
dF9zcGlubmVyX2luaXQoJmMtPnNwaW4sIGd0KSkKKwkJZ290byBlcnJfY3R4OworCisJcmV0dXJu
IDA7CisKK2Vycl9jdHg6CisJa2VybmVsX2NvbnRleHRfY2xvc2UoYy0+Y3R4KTsKKwlyZXR1cm4g
LUVOT01FTTsKK30KKworc3RhdGljIHZvaWQgcHJlZW1wdF9jbGllbnRfZmluaShzdHJ1Y3QgcHJl
ZW1wdF9jbGllbnQgKmMpCit7CisJaWd0X3NwaW5uZXJfZmluaSgmYy0+c3Bpbik7CisJa2VybmVs
X2NvbnRleHRfY2xvc2UoYy0+Y3R4KTsKK30KKworc3RhdGljIGludCBsaXZlX25vcHJlZW1wdCh2
b2lkICphcmcpCit7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKKwlzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmU7CisJc3RydWN0IHByZWVtcHRfY2xpZW50IGEsIGI7CisJZW51bSBp
bnRlbF9lbmdpbmVfaWQgaWQ7CisJaW50IGVyciA9IC1FTk9NRU07CisKKwkvKgorCSAqIFZlcmlm
eSB0aGF0IHdlIGNhbiBkaXNhYmxlIHByZWVtcHRpb24gZm9yIGFuIGluZGl2aWR1YWwgcmVxdWVz
dAorCSAqIHRoYXQgbWF5IGJlIGJlaW5nIG9ic2VydmVkIGFuZCBub3Qgd2FudCB0byBiZSBpbnRl
cnJ1cHRlZC4KKwkgKi8KKworCWlmICghSEFTX0xPR0lDQUxfUklOR19QUkVFTVBUSU9OKGd0LT5p
OTE1KSkKKwkJcmV0dXJuIDA7CisKKwlpZiAocHJlZW1wdF9jbGllbnRfaW5pdChndCwgJmEpKQor
CQlyZXR1cm4gLUVOT01FTTsKKwlpZiAocHJlZW1wdF9jbGllbnRfaW5pdChndCwgJmIpKQorCQln
b3RvIGVycl9jbGllbnRfYTsKKwliLmN0eC0+c2NoZWQucHJpb3JpdHkgPSBJOTE1X1VTRVJfUFJJ
T1JJVFkoSTkxNV9QUklPUklUWV9NQVgpOworCisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3Qs
IGlkKSB7CisJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxX2EsICpycV9iOworCisJCWlmICghaW50
ZWxfZW5naW5lX2hhc19wcmVlbXB0aW9uKGVuZ2luZSkpCisJCQljb250aW51ZTsKKworCQllbmdp
bmUtPmV4ZWNsaXN0cy5wcmVlbXB0X2hhbmcuY291bnQgPSAwOworCisJCXJxX2EgPSBzcGlubmVy
X2NyZWF0ZV9yZXF1ZXN0KCZhLnNwaW4sCisJCQkJCSAgICAgIGEuY3R4LCBlbmdpbmUsCisJCQkJ
CSAgICAgIE1JX0FSQl9DSEVDSyk7CisJCWlmIChJU19FUlIocnFfYSkpIHsKKwkJCWVyciA9IFBU
Ul9FUlIocnFfYSk7CisJCQlnb3RvIGVycl9jbGllbnRfYjsKKwkJfQorCisJCS8qIExvdyBwcmlv
cml0eSBjbGllbnQsIGJ1dCB1bnByZWVtcHRhYmxlISAqLworCQlycV9hLT5mbGFncyB8PSBJOTE1
X1JFUVVFU1RfTk9QUkVFTVBUOworCisJCWk5MTVfcmVxdWVzdF9hZGQocnFfYSk7CisJCWlmICgh
aWd0X3dhaXRfZm9yX3NwaW5uZXIoJmEuc3BpbiwgcnFfYSkpIHsKKwkJCXByX2VycigiRmlyc3Qg
Y2xpZW50IGZhaWxlZCB0byBzdGFydFxuIik7CisJCQlnb3RvIGVycl93ZWRnZWQ7CisJCX0KKwor
CQlycV9iID0gc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmYi5zcGluLAorCQkJCQkgICAgICBiLmN0
eCwgZW5naW5lLAorCQkJCQkgICAgICBNSV9BUkJfQ0hFQ0spOworCQlpZiAoSVNfRVJSKHJxX2Ip
KSB7CisJCQllcnIgPSBQVFJfRVJSKHJxX2IpOworCQkJZ290byBlcnJfY2xpZW50X2I7CisJCX0K
KworCQlpOTE1X3JlcXVlc3RfYWRkKHJxX2IpOworCisJCS8qIEIgaXMgbXVjaCBtb3JlIGltcG9y
dGFudCB0aGFuIEEhIChCdXQgQSBpcyB1bnByZWVtcHRhYmxlLikgKi8KKwkJR0VNX0JVR19PTihy
cV9wcmlvKHJxX2IpIDw9IHJxX3ByaW8ocnFfYSkpOworCisJCS8qIFdhaXQgbG9uZyBlbm91Z2gg
Zm9yIHByZWVtcHRpb24gYW5kIHRpbWVzbGljaW5nICovCisJCWlmIChpZ3Rfd2FpdF9mb3Jfc3Bp
bm5lcigmYi5zcGluLCBycV9iKSkgeworCQkJcHJfZXJyKCJTZWNvbmQgY2xpZW50IHN0YXJ0ZWQg
dG9vIGVhcmx5IVxuIik7CisJCQlnb3RvIGVycl93ZWRnZWQ7CisJCX0KKworCQlpZ3Rfc3Bpbm5l
cl9lbmQoJmEuc3Bpbik7CisKKwkJaWYgKCFpZ3Rfd2FpdF9mb3Jfc3Bpbm5lcigmYi5zcGluLCBy
cV9iKSkgeworCQkJcHJfZXJyKCJTZWNvbmQgY2xpZW50IGZhaWxlZCB0byBzdGFydFxuIik7CisJ
CQlnb3RvIGVycl93ZWRnZWQ7CisJCX0KKworCQlpZ3Rfc3Bpbm5lcl9lbmQoJmIuc3Bpbik7CisK
KwkJaWYgKGVuZ2luZS0+ZXhlY2xpc3RzLnByZWVtcHRfaGFuZy5jb3VudCkgeworCQkJcHJfZXJy
KCJQcmVlbXB0aW9uIHJlY29yZGVkIHglZDsgc2hvdWxkIGhhdmUgYmVlbiBzdXBwcmVzc2VkIVxu
IiwKKwkJCSAgICAgICBlbmdpbmUtPmV4ZWNsaXN0cy5wcmVlbXB0X2hhbmcuY291bnQpOworCQkJ
ZXJyID0gLUVJTlZBTDsKKwkJCWdvdG8gZXJyX3dlZGdlZDsKKwkJfQorCisJCWlmIChpZ3RfZmx1
c2hfdGVzdChndC0+aTkxNSkpCisJCQlnb3RvIGVycl93ZWRnZWQ7CisJfQorCisJZXJyID0gMDsK
K2Vycl9jbGllbnRfYjoKKwlwcmVlbXB0X2NsaWVudF9maW5pKCZiKTsKK2Vycl9jbGllbnRfYToK
KwlwcmVlbXB0X2NsaWVudF9maW5pKCZhKTsKKwlyZXR1cm4gZXJyOworCitlcnJfd2VkZ2VkOgor
CWlndF9zcGlubmVyX2VuZCgmYi5zcGluKTsKKwlpZ3Rfc3Bpbm5lcl9lbmQoJmEuc3Bpbik7CisJ
aW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CisJZXJyID0gLUVJTzsKKwlnb3RvIGVycl9jbGllbnRf
YjsKK30KKworc3RydWN0IGxpdmVfcHJlZW1wdF9jYW5jZWwgeworCXN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZTsKKwlzdHJ1Y3QgcHJlZW1wdF9jbGllbnQgYSwgYjsKK307CisKK3N0YXRp
YyBpbnQgX19jYW5jZWxfYWN0aXZlMChzdHJ1Y3QgbGl2ZV9wcmVlbXB0X2NhbmNlbCAqYXJnKQor
eworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7CisJ
aW50IGVycjsKKworCS8qIFByZWVtcHQgY2FuY2VsIG9mIEVMU1AwICovCisJR0VNX1RSQUNFKCIl
cyglcylcbiIsIF9fZnVuY19fLCBhcmctPmVuZ2luZS0+bmFtZSk7CisJaWYgKGlndF9saXZlX3Rl
c3RfYmVnaW4oJnQsIGFyZy0+ZW5naW5lLT5pOTE1LAorCQkJCV9fZnVuY19fLCBhcmctPmVuZ2lu
ZS0+bmFtZSkpCisJCXJldHVybiAtRUlPOworCisJY2xlYXJfYml0KENPTlRFWFRfQkFOTkVELCAm
YXJnLT5hLmN0eC0+ZmxhZ3MpOworCXJxID0gc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmYXJnLT5h
LnNwaW4sCisJCQkJICAgIGFyZy0+YS5jdHgsIGFyZy0+ZW5naW5lLAorCQkJCSAgICBNSV9BUkJf
Q0hFQ0spOworCWlmIChJU19FUlIocnEpKQorCQlyZXR1cm4gUFRSX0VSUihycSk7CisKKwlpOTE1
X3JlcXVlc3RfZ2V0KHJxKTsKKwlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKwlpZiAoIWlndF93YWl0
X2Zvcl9zcGlubmVyKCZhcmctPmEuc3BpbiwgcnEpKSB7CisJCWVyciA9IC1FSU87CisJCWdvdG8g
b3V0OworCX0KKworCWk5MTVfZ2VtX2NvbnRleHRfc2V0X2Jhbm5lZChhcmctPmEuY3R4KTsKKwll
cnIgPSBpbnRlbF9lbmdpbmVfcHVsc2UoYXJnLT5lbmdpbmUpOworCWlmIChlcnIpCisJCWdvdG8g
b3V0OworCisJaWYgKGk5MTVfcmVxdWVzdF93YWl0KHJxLCAwLCBIWiAvIDUpIDwgMCkgeworCQll
cnIgPSAtRUlPOworCQlnb3RvIG91dDsKKwl9CisKKwlpZiAocnEtPmZlbmNlLmVycm9yICE9IC1F
SU8pIHsKKwkJcHJfZXJyKCJDYW5jZWxsZWQgaW5mbGlnaHQwIHJlcXVlc3QgZGlkIG5vdCByZXBv
cnQgLUVJT1xuIik7CisJCWVyciA9IC1FSU5WQUw7CisJCWdvdG8gb3V0OworCX0KKworb3V0Ogor
CWk5MTVfcmVxdWVzdF9wdXQocnEpOworCWlmIChpZ3RfbGl2ZV90ZXN0X2VuZCgmdCkpCisJCWVy
ciA9IC1FSU87CisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIGludCBfX2NhbmNlbF9hY3RpdmUx
KHN0cnVjdCBsaXZlX3ByZWVtcHRfY2FuY2VsICphcmcpCit7CisJc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnFbMl0gPSB7fTsKKwlzdHJ1Y3QgaWd0X2xpdmVfdGVzdCB0OworCWludCBlcnI7CisKKwkv
KiBQcmVlbXB0IGNhbmNlbCBvZiBFTFNQMSAqLworCUdFTV9UUkFDRSgiJXMoJXMpXG4iLCBfX2Z1
bmNfXywgYXJnLT5lbmdpbmUtPm5hbWUpOworCWlmIChpZ3RfbGl2ZV90ZXN0X2JlZ2luKCZ0LCBh
cmctPmVuZ2luZS0+aTkxNSwKKwkJCQlfX2Z1bmNfXywgYXJnLT5lbmdpbmUtPm5hbWUpKQorCQly
ZXR1cm4gLUVJTzsKKworCWNsZWFyX2JpdChDT05URVhUX0JBTk5FRCwgJmFyZy0+YS5jdHgtPmZs
YWdzKTsKKwlycVswXSA9IHNwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJmFyZy0+YS5zcGluLAorCQkJ
CSAgICAgICBhcmctPmEuY3R4LCBhcmctPmVuZ2luZSwKKwkJCQkgICAgICAgTUlfTk9PUCk7IC8q
IG5vIHByZWVtcHRpb24gKi8KKwlpZiAoSVNfRVJSKHJxWzBdKSkKKwkJcmV0dXJuIFBUUl9FUlIo
cnFbMF0pOworCisJaTkxNV9yZXF1ZXN0X2dldChycVswXSk7CisJaTkxNV9yZXF1ZXN0X2FkZChy
cVswXSk7CisJaWYgKCFpZ3Rfd2FpdF9mb3Jfc3Bpbm5lcigmYXJnLT5hLnNwaW4sIHJxWzBdKSkg
eworCQllcnIgPSAtRUlPOworCQlnb3RvIG91dDsKKwl9CisKKwljbGVhcl9iaXQoQ09OVEVYVF9C
QU5ORUQsICZhcmctPmIuY3R4LT5mbGFncyk7CisJcnFbMV0gPSBzcGlubmVyX2NyZWF0ZV9yZXF1
ZXN0KCZhcmctPmIuc3BpbiwKKwkJCQkgICAgICAgYXJnLT5iLmN0eCwgYXJnLT5lbmdpbmUsCisJ
CQkJICAgICAgIE1JX0FSQl9DSEVDSyk7CisJaWYgKElTX0VSUihycVsxXSkpIHsKKwkJZXJyID0g
UFRSX0VSUihycVsxXSk7CisJCWdvdG8gb3V0OworCX0KKworCWk5MTVfcmVxdWVzdF9nZXQocnFb
MV0pOworCWVyciA9IGk5MTVfcmVxdWVzdF9hd2FpdF9kbWFfZmVuY2UocnFbMV0sICZycVswXS0+
ZmVuY2UpOworCWk5MTVfcmVxdWVzdF9hZGQocnFbMV0pOworCWlmIChlcnIpCisJCWdvdG8gb3V0
OworCisJaTkxNV9nZW1fY29udGV4dF9zZXRfYmFubmVkKGFyZy0+Yi5jdHgpOworCWVyciA9IGlu
dGVsX2VuZ2luZV9wdWxzZShhcmctPmVuZ2luZSk7CisJaWYgKGVycikKKwkJZ290byBvdXQ7CisK
KwlpZ3Rfc3Bpbm5lcl9lbmQoJmFyZy0+YS5zcGluKTsKKwlpZiAoaTkxNV9yZXF1ZXN0X3dhaXQo
cnFbMV0sIDAsIEhaIC8gNSkgPCAwKSB7CisJCWVyciA9IC1FSU87CisJCWdvdG8gb3V0OworCX0K
KworCWlmIChycVswXS0+ZmVuY2UuZXJyb3IgIT0gMCkgeworCQlwcl9lcnIoIk5vcm1hbCBpbmZs
aWdodDAgcmVxdWVzdCBkaWQgbm90IGNvbXBsZXRlXG4iKTsKKwkJZXJyID0gLUVJTlZBTDsKKwkJ
Z290byBvdXQ7CisJfQorCisJaWYgKHJxWzFdLT5mZW5jZS5lcnJvciAhPSAtRUlPKSB7CisJCXBy
X2VycigiQ2FuY2VsbGVkIGluZmxpZ2h0MSByZXF1ZXN0IGRpZCBub3QgcmVwb3J0IC1FSU9cbiIp
OworCQllcnIgPSAtRUlOVkFMOworCQlnb3RvIG91dDsKKwl9CisKK291dDoKKwlpOTE1X3JlcXVl
c3RfcHV0KHJxWzFdKTsKKwlpOTE1X3JlcXVlc3RfcHV0KHJxWzBdKTsKKwlpZiAoaWd0X2xpdmVf
dGVzdF9lbmQoJnQpKQorCQllcnIgPSAtRUlPOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBp
bnQgX19jYW5jZWxfcXVldWVkKHN0cnVjdCBsaXZlX3ByZWVtcHRfY2FuY2VsICphcmcpCit7CisJ
c3RydWN0IGk5MTVfcmVxdWVzdCAqcnFbM10gPSB7fTsKKwlzdHJ1Y3QgaWd0X2xpdmVfdGVzdCB0
OworCWludCBlcnI7CisKKwkvKiBGdWxsIEVMU1AgYW5kIG9uZSBpbiB0aGUgd2luZ3MgKi8KKwlH
RU1fVFJBQ0UoIiVzKCVzKVxuIiwgX19mdW5jX18sIGFyZy0+ZW5naW5lLT5uYW1lKTsKKwlpZiAo
aWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgYXJnLT5lbmdpbmUtPmk5MTUsCisJCQkJX19mdW5jX18s
IGFyZy0+ZW5naW5lLT5uYW1lKSkKKwkJcmV0dXJuIC1FSU87CisKKwljbGVhcl9iaXQoQ09OVEVY
VF9CQU5ORUQsICZhcmctPmEuY3R4LT5mbGFncyk7CisJcnFbMF0gPSBzcGlubmVyX2NyZWF0ZV9y
ZXF1ZXN0KCZhcmctPmEuc3BpbiwKKwkJCQkgICAgICAgYXJnLT5hLmN0eCwgYXJnLT5lbmdpbmUs
CisJCQkJICAgICAgIE1JX0FSQl9DSEVDSyk7CisJaWYgKElTX0VSUihycVswXSkpCisJCXJldHVy
biBQVFJfRVJSKHJxWzBdKTsKKworCWk5MTVfcmVxdWVzdF9nZXQocnFbMF0pOworCWk5MTVfcmVx
dWVzdF9hZGQocnFbMF0pOworCWlmICghaWd0X3dhaXRfZm9yX3NwaW5uZXIoJmFyZy0+YS5zcGlu
LCBycVswXSkpIHsKKwkJZXJyID0gLUVJTzsKKwkJZ290byBvdXQ7CisJfQorCisJY2xlYXJfYml0
KENPTlRFWFRfQkFOTkVELCAmYXJnLT5iLmN0eC0+ZmxhZ3MpOworCXJxWzFdID0gaWd0X3JlcXVl
c3RfYWxsb2MoYXJnLT5iLmN0eCwgYXJnLT5lbmdpbmUpOworCWlmIChJU19FUlIocnFbMV0pKSB7
CisJCWVyciA9IFBUUl9FUlIocnFbMV0pOworCQlnb3RvIG91dDsKKwl9CisKKwlpOTE1X3JlcXVl
c3RfZ2V0KHJxWzFdKTsKKwllcnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfZG1hX2ZlbmNlKHJxWzFd
LCAmcnFbMF0tPmZlbmNlKTsKKwlpOTE1X3JlcXVlc3RfYWRkKHJxWzFdKTsKKwlpZiAoZXJyKQor
CQlnb3RvIG91dDsKKworCXJxWzJdID0gc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmYXJnLT5iLnNw
aW4sCisJCQkJICAgICAgIGFyZy0+YS5jdHgsIGFyZy0+ZW5naW5lLAorCQkJCSAgICAgICBNSV9B
UkJfQ0hFQ0spOworCWlmIChJU19FUlIocnFbMl0pKSB7CisJCWVyciA9IFBUUl9FUlIocnFbMl0p
OworCQlnb3RvIG91dDsKKwl9CisKKwlpOTE1X3JlcXVlc3RfZ2V0KHJxWzJdKTsKKwllcnIgPSBp
OTE1X3JlcXVlc3RfYXdhaXRfZG1hX2ZlbmNlKHJxWzJdLCAmcnFbMV0tPmZlbmNlKTsKKwlpOTE1
X3JlcXVlc3RfYWRkKHJxWzJdKTsKKwlpZiAoZXJyKQorCQlnb3RvIG91dDsKKworCWk5MTVfZ2Vt
X2NvbnRleHRfc2V0X2Jhbm5lZChhcmctPmEuY3R4KTsKKwllcnIgPSBpbnRlbF9lbmdpbmVfcHVs
c2UoYXJnLT5lbmdpbmUpOworCWlmIChlcnIpCisJCWdvdG8gb3V0OworCisJaWYgKGk5MTVfcmVx
dWVzdF93YWl0KHJxWzJdLCAwLCBIWiAvIDUpIDwgMCkgeworCQllcnIgPSAtRUlPOworCQlnb3Rv
IG91dDsKKwl9CisKKwlpZiAocnFbMF0tPmZlbmNlLmVycm9yICE9IC1FSU8pIHsKKwkJcHJfZXJy
KCJDYW5jZWxsZWQgaW5mbGlnaHQwIHJlcXVlc3QgZGlkIG5vdCByZXBvcnQgLUVJT1xuIik7CisJ
CWVyciA9IC1FSU5WQUw7CisJCWdvdG8gb3V0OworCX0KKworCWlmIChycVsxXS0+ZmVuY2UuZXJy
b3IgIT0gMCkgeworCQlwcl9lcnIoIk5vcm1hbCBpbmZsaWdodDEgcmVxdWVzdCBkaWQgbm90IGNv
bXBsZXRlXG4iKTsKKwkJZXJyID0gLUVJTlZBTDsKKwkJZ290byBvdXQ7CisJfQorCisJaWYgKHJx
WzJdLT5mZW5jZS5lcnJvciAhPSAtRUlPKSB7CisJCXByX2VycigiQ2FuY2VsbGVkIHF1ZXVlZCBy
ZXF1ZXN0IGRpZCBub3QgcmVwb3J0IC1FSU9cbiIpOworCQllcnIgPSAtRUlOVkFMOworCQlnb3Rv
IG91dDsKKwl9CisKK291dDoKKwlpOTE1X3JlcXVlc3RfcHV0KHJxWzJdKTsKKwlpOTE1X3JlcXVl
c3RfcHV0KHJxWzFdKTsKKwlpOTE1X3JlcXVlc3RfcHV0KHJxWzBdKTsKKwlpZiAoaWd0X2xpdmVf
dGVzdF9lbmQoJnQpKQorCQllcnIgPSAtRUlPOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBp
bnQgX19jYW5jZWxfaG9zdGlsZShzdHJ1Y3QgbGl2ZV9wcmVlbXB0X2NhbmNlbCAqYXJnKQorewor
CXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCWludCBlcnI7CisKKwkvKiBQcmVlbXB0IGNhbmNl
bCBub24tcHJlZW1wdGlibGUgc3Bpbm5lciBpbiBFTFNQMCAqLworCWlmICghSVNfQUNUSVZFKENP
TkZJR19EUk1fSTkxNV9QUkVFTVBUX1RJTUVPVVQpKQorCQlyZXR1cm4gMDsKKworCUdFTV9UUkFD
RSgiJXMoJXMpXG4iLCBfX2Z1bmNfXywgYXJnLT5lbmdpbmUtPm5hbWUpOworCWNsZWFyX2JpdChD
T05URVhUX0JBTk5FRCwgJmFyZy0+YS5jdHgtPmZsYWdzKTsKKwlycSA9IHNwaW5uZXJfY3JlYXRl
X3JlcXVlc3QoJmFyZy0+YS5zcGluLAorCQkJCSAgICBhcmctPmEuY3R4LCBhcmctPmVuZ2luZSwK
KwkJCQkgICAgTUlfTk9PUCk7IC8qIHByZWVtcHRpb24gZGlzYWJsZWQgKi8KKwlpZiAoSVNfRVJS
KHJxKSkKKwkJcmV0dXJuIFBUUl9FUlIocnEpOworCisJaTkxNV9yZXF1ZXN0X2dldChycSk7CisJ
aTkxNV9yZXF1ZXN0X2FkZChycSk7CisJaWYgKCFpZ3Rfd2FpdF9mb3Jfc3Bpbm5lcigmYXJnLT5h
LnNwaW4sIHJxKSkgeworCQllcnIgPSAtRUlPOworCQlnb3RvIG91dDsKKwl9CisKKwlpOTE1X2dl
bV9jb250ZXh0X3NldF9iYW5uZWQoYXJnLT5hLmN0eCk7CisJZXJyID0gaW50ZWxfZW5naW5lX3B1
bHNlKGFyZy0+ZW5naW5lKTsgLyogZm9yY2UgcmVzZXQgKi8KKwlpZiAoZXJyKQorCQlnb3RvIG91
dDsKKworCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChycSwgMCwgSFogLyA1KSA8IDApIHsKKwkJZXJy
ID0gLUVJTzsKKwkJZ290byBvdXQ7CisJfQorCisJaWYgKHJxLT5mZW5jZS5lcnJvciAhPSAtRUlP
KSB7CisJCXByX2VycigiQ2FuY2VsbGVkIGluZmxpZ2h0MCByZXF1ZXN0IGRpZCBub3QgcmVwb3J0
IC1FSU9cbiIpOworCQllcnIgPSAtRUlOVkFMOworCQlnb3RvIG91dDsKKwl9CisKK291dDoKKwlp
OTE1X3JlcXVlc3RfcHV0KHJxKTsKKwlpZiAoaWd0X2ZsdXNoX3Rlc3QoYXJnLT5lbmdpbmUtPmk5
MTUpKQorCQllcnIgPSAtRUlPOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQgbGl2ZV9w
cmVlbXB0X2NhbmNlbCh2b2lkICphcmcpCit7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsK
KwlzdHJ1Y3QgbGl2ZV9wcmVlbXB0X2NhbmNlbCBkYXRhOworCWVudW0gaW50ZWxfZW5naW5lX2lk
IGlkOworCWludCBlcnIgPSAtRU5PTUVNOworCisJLyoKKwkgKiBUbyBjYW5jZWwgYW4gaW5mbGln
aHQgY29udGV4dCwgd2UgbmVlZCB0byBmaXJzdCByZW1vdmUgaXQgZnJvbSB0aGUKKwkgKiBHUFUu
IFRoYXQgc291bmRzIGxpa2UgcHJlZW1wdGlvbiEgUGx1cyBhIGxpdHRsZSBiaXQgb2YgYm9va2tl
ZXBpbmcuCisJICovCisKKwlpZiAoIUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1QVElPTihndC0+aTkx
NSkpCisJCXJldHVybiAwOworCisJaWYgKHByZWVtcHRfY2xpZW50X2luaXQoZ3QsICZkYXRhLmEp
KQorCQlyZXR1cm4gLUVOT01FTTsKKwlpZiAocHJlZW1wdF9jbGllbnRfaW5pdChndCwgJmRhdGEu
YikpCisJCWdvdG8gZXJyX2NsaWVudF9hOworCisJZm9yX2VhY2hfZW5naW5lKGRhdGEuZW5naW5l
LCBndCwgaWQpIHsKKwkJaWYgKCFpbnRlbF9lbmdpbmVfaGFzX3ByZWVtcHRpb24oZGF0YS5lbmdp
bmUpKQorCQkJY29udGludWU7CisKKwkJZXJyID0gX19jYW5jZWxfYWN0aXZlMCgmZGF0YSk7CisJ
CWlmIChlcnIpCisJCQlnb3RvIGVycl93ZWRnZWQ7CisKKwkJZXJyID0gX19jYW5jZWxfYWN0aXZl
MSgmZGF0YSk7CisJCWlmIChlcnIpCisJCQlnb3RvIGVycl93ZWRnZWQ7CisKKwkJZXJyID0gX19j
YW5jZWxfcXVldWVkKCZkYXRhKTsKKwkJaWYgKGVycikKKwkJCWdvdG8gZXJyX3dlZGdlZDsKKwor
CQllcnIgPSBfX2NhbmNlbF9ob3N0aWxlKCZkYXRhKTsKKwkJaWYgKGVycikKKwkJCWdvdG8gZXJy
X3dlZGdlZDsKKwl9CisKKwllcnIgPSAwOworZXJyX2NsaWVudF9iOgorCXByZWVtcHRfY2xpZW50
X2ZpbmkoJmRhdGEuYik7CitlcnJfY2xpZW50X2E6CisJcHJlZW1wdF9jbGllbnRfZmluaSgmZGF0
YS5hKTsKKwlyZXR1cm4gZXJyOworCitlcnJfd2VkZ2VkOgorCUdFTV9UUkFDRV9EVU1QKCk7CisJ
aWd0X3NwaW5uZXJfZW5kKCZkYXRhLmIuc3Bpbik7CisJaWd0X3NwaW5uZXJfZW5kKCZkYXRhLmEu
c3Bpbik7CisJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CisJZ290byBlcnJfY2xpZW50X2I7Cit9
CisKK3N0YXRpYyBpbnQgbGl2ZV9zdXBwcmVzc19zZWxmX3ByZWVtcHQodm9pZCAqYXJnKQorewor
CXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lOworCXN0cnVjdCBpOTE1X3NjaGVkX2F0dHIgYXR0ciA9IHsKKwkJLnByaW9yaXR5ID0gSTkx
NV9VU0VSX1BSSU9SSVRZKEk5MTVfUFJJT1JJVFlfTUFYKQorCX07CisJc3RydWN0IHByZWVtcHRf
Y2xpZW50IGEsIGI7CisJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisJaW50IGVyciA9IC1FTk9N
RU07CisKKwkvKgorCSAqIFZlcmlmeSB0aGF0IGlmIGEgcHJlZW1wdGlvbiByZXF1ZXN0IGRvZXMg
bm90IGNhdXNlIGEgY2hhbmdlIGluCisJICogdGhlIGN1cnJlbnQgZXhlY3V0aW9uIG9yZGVyLCB0
aGUgcHJlZW1wdC10by1pZGxlIGluamVjdGlvbiBpcworCSAqIHNraXBwZWQgYW5kIHRoYXQgd2Ug
ZG8gbm90IGFjY2lkZW50YWxseSBhcHBseSBpdCBhZnRlciB0aGUgQ1MKKwkgKiBjb21wbGV0aW9u
IGV2ZW50LgorCSAqLworCisJaWYgKCFIQVNfTE9HSUNBTF9SSU5HX1BSRUVNUFRJT04oZ3QtPmk5
MTUpKQorCQlyZXR1cm4gMDsKKworCWlmIChVU0VTX0dVQ19TVUJNSVNTSU9OKGd0LT5pOTE1KSkK
KwkJcmV0dXJuIDA7IC8qIHByZXN1bWUgYmxhY2sgYmxveCAqLworCisJaWYgKGludGVsX3ZncHVf
YWN0aXZlKGd0LT5pOTE1KSkKKwkJcmV0dXJuIDA7IC8qIEdWVCBmb3JjZXMgc2luZ2xlIHBvcnQg
JiByZXF1ZXN0IHN1Ym1pc3Npb24gKi8KKworCWlmIChwcmVlbXB0X2NsaWVudF9pbml0KGd0LCAm
YSkpCisJCXJldHVybiAtRU5PTUVNOworCWlmIChwcmVlbXB0X2NsaWVudF9pbml0KGd0LCAmYikp
CisJCWdvdG8gZXJyX2NsaWVudF9hOworCisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlk
KSB7CisJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxX2EsICpycV9iOworCQlpbnQgZGVwdGg7CisK
KwkJaWYgKCFpbnRlbF9lbmdpbmVfaGFzX3ByZWVtcHRpb24oZW5naW5lKSkKKwkJCWNvbnRpbnVl
OworCisJCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpCisJCQlnb3RvIGVycl93ZWRnZWQ7
CisKKwkJaW50ZWxfZW5naW5lX3BtX2dldChlbmdpbmUpOworCQllbmdpbmUtPmV4ZWNsaXN0cy5w
cmVlbXB0X2hhbmcuY291bnQgPSAwOworCisJCXJxX2EgPSBzcGlubmVyX2NyZWF0ZV9yZXF1ZXN0
KCZhLnNwaW4sCisJCQkJCSAgICAgIGEuY3R4LCBlbmdpbmUsCisJCQkJCSAgICAgIE1JX05PT1Ap
OworCQlpZiAoSVNfRVJSKHJxX2EpKSB7CisJCQllcnIgPSBQVFJfRVJSKHJxX2EpOworCQkJaW50
ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOworCQkJZ290byBlcnJfY2xpZW50X2I7CisJCX0KKwor
CQlpOTE1X3JlcXVlc3RfYWRkKHJxX2EpOworCQlpZiAoIWlndF93YWl0X2Zvcl9zcGlubmVyKCZh
LnNwaW4sIHJxX2EpKSB7CisJCQlwcl9lcnIoIkZpcnN0IGNsaWVudCBmYWlsZWQgdG8gc3RhcnRc
biIpOworCQkJaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOworCQkJZ290byBlcnJfd2VkZ2Vk
OworCQl9CisKKwkJLyogS2VlcCBwb3N0cG9uaW5nIHRoZSB0aW1lciB0byBhdm9pZCBwcmVtYXR1
cmUgc2xpY2luZyAqLworCQltb2RfdGltZXIoJmVuZ2luZS0+ZXhlY2xpc3RzLnRpbWVyLCBqaWZm
aWVzICsgSFopOworCQlmb3IgKGRlcHRoID0gMDsgZGVwdGggPCA4OyBkZXB0aCsrKSB7CisJCQly
cV9iID0gc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmYi5zcGluLAorCQkJCQkJICAgICAgYi5jdHgs
IGVuZ2luZSwKKwkJCQkJCSAgICAgIE1JX05PT1ApOworCQkJaWYgKElTX0VSUihycV9iKSkgewor
CQkJCWVyciA9IFBUUl9FUlIocnFfYik7CisJCQkJaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUp
OworCQkJCWdvdG8gZXJyX2NsaWVudF9iOworCQkJfQorCQkJaTkxNV9yZXF1ZXN0X2FkZChycV9i
KTsKKworCQkJR0VNX0JVR19PTihpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJxX2EpKTsKKwkJCWVu
Z2luZS0+c2NoZWR1bGUocnFfYSwgJmF0dHIpOworCQkJaWd0X3NwaW5uZXJfZW5kKCZhLnNwaW4p
OworCisJCQlpZiAoIWlndF93YWl0X2Zvcl9zcGlubmVyKCZiLnNwaW4sIHJxX2IpKSB7CisJCQkJ
cHJfZXJyKCJTZWNvbmQgY2xpZW50IGZhaWxlZCB0byBzdGFydFxuIik7CisJCQkJaW50ZWxfZW5n
aW5lX3BtX3B1dChlbmdpbmUpOworCQkJCWdvdG8gZXJyX3dlZGdlZDsKKwkJCX0KKworCQkJc3dh
cChhLCBiKTsKKwkJCXJxX2EgPSBycV9iOworCQl9CisJCWlndF9zcGlubmVyX2VuZCgmYS5zcGlu
KTsKKworCQlpZiAoZW5naW5lLT5leGVjbGlzdHMucHJlZW1wdF9oYW5nLmNvdW50KSB7CisJCQlw
cl9lcnIoIlByZWVtcHRpb24gb24gJXMgcmVjb3JkZWQgeCVkLCBkZXB0aCAlZDsgc2hvdWxkIGhh
dmUgYmVlbiBzdXBwcmVzc2VkIVxuIiwKKwkJCSAgICAgICBlbmdpbmUtPm5hbWUsCisJCQkgICAg
ICAgZW5naW5lLT5leGVjbGlzdHMucHJlZW1wdF9oYW5nLmNvdW50LAorCQkJICAgICAgIGRlcHRo
KTsKKwkJCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKKwkJCWVyciA9IC1FSU5WQUw7CisJ
CQlnb3RvIGVycl9jbGllbnRfYjsKKwkJfQorCisJCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5l
KTsKKwkJaWYgKGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KSkKKwkJCWdvdG8gZXJyX3dlZGdlZDsK
Kwl9CisKKwllcnIgPSAwOworZXJyX2NsaWVudF9iOgorCXByZWVtcHRfY2xpZW50X2ZpbmkoJmIp
OworZXJyX2NsaWVudF9hOgorCXByZWVtcHRfY2xpZW50X2ZpbmkoJmEpOworCXJldHVybiBlcnI7
CisKK2Vycl93ZWRnZWQ6CisJaWd0X3NwaW5uZXJfZW5kKCZiLnNwaW4pOworCWlndF9zcGlubmVy
X2VuZCgmYS5zcGluKTsKKwlpbnRlbF9ndF9zZXRfd2VkZ2VkKGd0KTsKKwllcnIgPSAtRUlPOwor
CWdvdG8gZXJyX2NsaWVudF9iOworfQorCitzdGF0aWMgaW50IF9faTkxNV9zd19mZW5jZV9jYWxs
CitkdW1teV9ub3RpZnkoc3RydWN0IGk5MTVfc3dfZmVuY2UgKmZlbmNlLCBlbnVtIGk5MTVfc3df
ZmVuY2Vfbm90aWZ5IHN0YXRlKQoreworCXJldHVybiBOT1RJRllfRE9ORTsKK30KKworc3RhdGlj
IHN0cnVjdCBpOTE1X3JlcXVlc3QgKmR1bW15X3JlcXVlc3Qoc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lKQoreworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCisJcnEgPSBremFsbG9j
KHNpemVvZigqcnEpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIXJxKQorCQlyZXR1cm4gTlVMTDsKKwor
CXJxLT5lbmdpbmUgPSBlbmdpbmU7CisKKwlzcGluX2xvY2tfaW5pdCgmcnEtPmxvY2spOworCUlO
SVRfTElTVF9IRUFEKCZycS0+ZmVuY2UuY2JfbGlzdCk7CisJcnEtPmZlbmNlLmxvY2sgPSAmcnEt
PmxvY2s7CisJcnEtPmZlbmNlLm9wcyA9ICZpOTE1X2ZlbmNlX29wczsKKworCWk5MTVfc2NoZWRf
bm9kZV9pbml0KCZycS0+c2NoZWQpOworCisJLyogbWFyayB0aGlzIHJlcXVlc3QgYXMgcGVybWFu
ZW50bHkgaW5jb21wbGV0ZSAqLworCXJxLT5mZW5jZS5zZXFubyA9IDE7CisJQlVJTERfQlVHX09O
KHNpemVvZihycS0+ZmVuY2Uuc2Vxbm8pICE9IDgpOyAvKiB1cHBlciAzMmIgPT0gMCAqLworCXJx
LT5od3NwX3NlcW5vID0gKHUzMiAqKSZycS0+ZmVuY2Uuc2Vxbm8gKyAxOworCUdFTV9CVUdfT04o
aTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChycSkpOworCisJaTkxNV9zd19mZW5jZV9pbml0KCZycS0+
c3VibWl0LCBkdW1teV9ub3RpZnkpOworCXNldF9iaXQoSTkxNV9GRU5DRV9GTEFHX0FDVElWRSwg
JnJxLT5mZW5jZS5mbGFncyk7CisKKwlzcGluX2xvY2tfaW5pdCgmcnEtPmxvY2spOworCXJxLT5m
ZW5jZS5sb2NrID0gJnJxLT5sb2NrOworCUlOSVRfTElTVF9IRUFEKCZycS0+ZmVuY2UuY2JfbGlz
dCk7CisKKwlyZXR1cm4gcnE7Cit9CisKK3N0YXRpYyB2b2lkIGR1bW15X3JlcXVlc3RfZnJlZShz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpkdW1teSkKK3sKKwkvKiBXZSBoYXZlIHRvIGZha2UgdGhlIENT
IGludGVycnVwdCB0byBraWNrIHRoZSBuZXh0IHJlcXVlc3QgKi8KKwlpOTE1X3N3X2ZlbmNlX2Nv
bW1pdCgmZHVtbXktPnN1Ym1pdCk7CisKKwlpOTE1X3JlcXVlc3RfbWFya19jb21wbGV0ZShkdW1t
eSk7CisJZG1hX2ZlbmNlX3NpZ25hbCgmZHVtbXktPmZlbmNlKTsKKworCWk5MTVfc2NoZWRfbm9k
ZV9maW5pKCZkdW1teS0+c2NoZWQpOworCWk5MTVfc3dfZmVuY2VfZmluaSgmZHVtbXktPnN1Ym1p
dCk7CisKKwlkbWFfZmVuY2VfZnJlZSgmZHVtbXktPmZlbmNlKTsKK30KKworc3RhdGljIGludCBs
aXZlX3N1cHByZXNzX3dhaXRfcHJlZW1wdCh2b2lkICphcmcpCit7CisJc3RydWN0IGludGVsX2d0
ICpndCA9IGFyZzsKKwlzdHJ1Y3QgcHJlZW1wdF9jbGllbnQgY2xpZW50WzRdOworCXN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxW0FSUkFZX1NJWkUoY2xpZW50KV0gPSB7fTsKKwlzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmU7CisJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisJaW50IGVyciA9
IC1FTk9NRU07CisJaW50IGk7CisKKwkvKgorCSAqIFdhaXRlcnMgYXJlIGdpdmVuIGEgbGl0dGxl
IHByaW9yaXR5IG51ZGdlLCBidXQgbm90IGVub3VnaAorCSAqIHRvIGFjdHVhbGx5IGNhdXNlIGFu
eSBwcmVlbXB0aW9uLiBEb3VibGUgY2hlY2sgdGhhdCB3ZSBkbworCSAqIG5vdCBuZWVkbGVzc2x5
IGdlbmVyYXRlIHByZWVtcHQtdG8taWRsZSBjeWNsZXMuCisJICovCisKKwlpZiAoIUhBU19MT0dJ
Q0FMX1JJTkdfUFJFRU1QVElPTihndC0+aTkxNSkpCisJCXJldHVybiAwOworCisJaWYgKHByZWVt
cHRfY2xpZW50X2luaXQoZ3QsICZjbGllbnRbMF0pKSAvKiBFTFNQWzBdICovCisJCXJldHVybiAt
RU5PTUVNOworCWlmIChwcmVlbXB0X2NsaWVudF9pbml0KGd0LCAmY2xpZW50WzFdKSkgLyogRUxT
UFsxXSAqLworCQlnb3RvIGVycl9jbGllbnRfMDsKKwlpZiAocHJlZW1wdF9jbGllbnRfaW5pdChn
dCwgJmNsaWVudFsyXSkpIC8qIGhlYWQgb2YgcXVldWUgKi8KKwkJZ290byBlcnJfY2xpZW50XzE7
CisJaWYgKHByZWVtcHRfY2xpZW50X2luaXQoZ3QsICZjbGllbnRbM10pKSAvKiBieXN0YW5kZXIg
Ki8KKwkJZ290byBlcnJfY2xpZW50XzI7CisKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwg
aWQpIHsKKwkJaW50IGRlcHRoOworCisJCWlmICghaW50ZWxfZW5naW5lX2hhc19wcmVlbXB0aW9u
KGVuZ2luZSkpCisJCQljb250aW51ZTsKKworCQlpZiAoIWVuZ2luZS0+ZW1pdF9pbml0X2JyZWFk
Y3J1bWIpCisJCQljb250aW51ZTsKKworCQlmb3IgKGRlcHRoID0gMDsgZGVwdGggPCBBUlJBWV9T
SVpFKGNsaWVudCk7IGRlcHRoKyspIHsKKwkJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKmR1bW15Owor
CisJCQllbmdpbmUtPmV4ZWNsaXN0cy5wcmVlbXB0X2hhbmcuY291bnQgPSAwOworCisJCQlkdW1t
eSA9IGR1bW15X3JlcXVlc3QoZW5naW5lKTsKKwkJCWlmICghZHVtbXkpCisJCQkJZ290byBlcnJf
Y2xpZW50XzM7CisKKwkJCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGNsaWVudCk7IGkrKykg
eworCQkJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnRoaXM7CisKKwkJCQl0aGlzID0gc3Bpbm5lcl9j
cmVhdGVfcmVxdWVzdCgmY2xpZW50W2ldLnNwaW4sCisJCQkJCQkJICAgICAgY2xpZW50W2ldLmN0
eCwgZW5naW5lLAorCQkJCQkJCSAgICAgIE1JX05PT1ApOworCQkJCWlmIChJU19FUlIodGhpcykp
IHsKKwkJCQkJZXJyID0gUFRSX0VSUih0aGlzKTsKKwkJCQkJZ290byBlcnJfd2VkZ2VkOworCQkJ
CX0KKworCQkJCS8qIERpc2FibGUgTkVXQ0xJRU5UIHByb21vdGlvbiAqLworCQkJCV9faTkxNV9h
Y3RpdmVfZmVuY2Vfc2V0KCZpOTE1X3JlcXVlc3RfdGltZWxpbmUodGhpcyktPmxhc3RfcmVxdWVz
dCwKKwkJCQkJCQkmZHVtbXktPmZlbmNlKTsKKworCQkJCXJxW2ldID0gaTkxNV9yZXF1ZXN0X2dl
dCh0aGlzKTsKKwkJCQlpOTE1X3JlcXVlc3RfYWRkKHRoaXMpOworCQkJfQorCisJCQlkdW1teV9y
ZXF1ZXN0X2ZyZWUoZHVtbXkpOworCisJCQlHRU1fQlVHX09OKGk5MTVfcmVxdWVzdF9jb21wbGV0
ZWQocnFbMF0pKTsKKwkJCWlmICghaWd0X3dhaXRfZm9yX3NwaW5uZXIoJmNsaWVudFswXS5zcGlu
LCBycVswXSkpIHsKKwkJCQlwcl9lcnIoIiVzOiBGaXJzdCBjbGllbnQgZmFpbGVkIHRvIHN0YXJ0
XG4iLAorCQkJCSAgICAgICBlbmdpbmUtPm5hbWUpOworCQkJCWdvdG8gZXJyX3dlZGdlZDsKKwkJ
CX0KKwkJCUdFTV9CVUdfT04oIWk5MTVfcmVxdWVzdF9zdGFydGVkKHJxWzBdKSk7CisKKwkJCWlm
IChpOTE1X3JlcXVlc3Rfd2FpdChycVtkZXB0aF0sCisJCQkJCSAgICAgIEk5MTVfV0FJVF9QUklP
UklUWSwKKwkJCQkJICAgICAgMSkgIT0gLUVUSU1FKSB7CisJCQkJcHJfZXJyKCIlczogV2FpdGVy
IGRlcHRoOiVkIGNvbXBsZXRlZCFcbiIsCisJCQkJICAgICAgIGVuZ2luZS0+bmFtZSwgZGVwdGgp
OworCQkJCWdvdG8gZXJyX3dlZGdlZDsKKwkJCX0KKworCQkJZm9yIChpID0gMDsgaSA8IEFSUkFZ
X1NJWkUoY2xpZW50KTsgaSsrKSB7CisJCQkJaWd0X3NwaW5uZXJfZW5kKCZjbGllbnRbaV0uc3Bp
bik7CisJCQkJaTkxNV9yZXF1ZXN0X3B1dChycVtpXSk7CisJCQkJcnFbaV0gPSBOVUxMOworCQkJ
fQorCisJCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpKQorCQkJCWdvdG8gZXJyX3dlZGdl
ZDsKKworCQkJaWYgKGVuZ2luZS0+ZXhlY2xpc3RzLnByZWVtcHRfaGFuZy5jb3VudCkgeworCQkJ
CXByX2VycigiJXM6IFByZWVtcHRpb24gcmVjb3JkZWQgeCVkLCBkZXB0aCAlZDsgc2hvdWxkIGhh
dmUgYmVlbiBzdXBwcmVzc2VkIVxuIiwKKwkJCQkgICAgICAgZW5naW5lLT5uYW1lLAorCQkJCSAg
ICAgICBlbmdpbmUtPmV4ZWNsaXN0cy5wcmVlbXB0X2hhbmcuY291bnQsCisJCQkJICAgICAgIGRl
cHRoKTsKKwkJCQllcnIgPSAtRUlOVkFMOworCQkJCWdvdG8gZXJyX2NsaWVudF8zOworCQkJfQor
CQl9CisJfQorCisJZXJyID0gMDsKK2Vycl9jbGllbnRfMzoKKwlwcmVlbXB0X2NsaWVudF9maW5p
KCZjbGllbnRbM10pOworZXJyX2NsaWVudF8yOgorCXByZWVtcHRfY2xpZW50X2ZpbmkoJmNsaWVu
dFsyXSk7CitlcnJfY2xpZW50XzE6CisJcHJlZW1wdF9jbGllbnRfZmluaSgmY2xpZW50WzFdKTsK
K2Vycl9jbGllbnRfMDoKKwlwcmVlbXB0X2NsaWVudF9maW5pKCZjbGllbnRbMF0pOworCXJldHVy
biBlcnI7CisKK2Vycl93ZWRnZWQ6CisJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUoY2xpZW50
KTsgaSsrKSB7CisJCWlndF9zcGlubmVyX2VuZCgmY2xpZW50W2ldLnNwaW4pOworCQlpOTE1X3Jl
cXVlc3RfcHV0KHJxW2ldKTsKKwl9CisJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CisJZXJyID0g
LUVJTzsKKwlnb3RvIGVycl9jbGllbnRfMzsKK30KKworc3RhdGljIGludCBsaXZlX2NoYWluX3By
ZWVtcHQodm9pZCAqYXJnKQoreworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CisJc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOworCXN0cnVjdCBwcmVlbXB0X2NsaWVudCBoaSwgbG87
CisJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisJaW50IGVyciA9IC1FTk9NRU07CisKKwkvKgor
CSAqIEJ1aWxkIGEgY2hhaW4gQUIuLi5CQSBiZXR3ZWVuIHR3byBjb250ZXh0cyAoQSwgQikgYW5k
IHJlcXVlc3QKKwkgKiBwcmVlbXB0aW9uIG9mIHRoZSBsYXN0IHJlcXVlc3QuIEl0IHNob3VsZCB0
aGVuIGNvbXBsZXRlIGJlZm9yZQorCSAqIHRoZSBwcmV2aW91c2x5IHN1Ym1pdHRlZCBzcGlubmVy
IGluIEIuCisJICovCisKKwlpZiAoIUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1QVElPTihndC0+aTkx
NSkpCisJCXJldHVybiAwOworCisJaWYgKHByZWVtcHRfY2xpZW50X2luaXQoZ3QsICZoaSkpCisJ
CXJldHVybiAtRU5PTUVNOworCisJaWYgKHByZWVtcHRfY2xpZW50X2luaXQoZ3QsICZsbykpCisJ
CWdvdG8gZXJyX2NsaWVudF9oaTsKKworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkg
eworCQlzdHJ1Y3QgaTkxNV9zY2hlZF9hdHRyIGF0dHIgPSB7CisJCQkucHJpb3JpdHkgPSBJOTE1
X1VTRVJfUFJJT1JJVFkoSTkxNV9QUklPUklUWV9NQVgpLAorCQl9OworCQlzdHJ1Y3QgaWd0X2xp
dmVfdGVzdCB0OworCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKKwkJaW50IHJpbmdfc2l6ZSwg
Y291bnQsIGk7CisKKwkJaWYgKCFpbnRlbF9lbmdpbmVfaGFzX3ByZWVtcHRpb24oZW5naW5lKSkK
KwkJCWNvbnRpbnVlOworCisJCXJxID0gc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmbG8uc3BpbiwK
KwkJCQkJICAgIGxvLmN0eCwgZW5naW5lLAorCQkJCQkgICAgTUlfQVJCX0NIRUNLKTsKKwkJaWYg
KElTX0VSUihycSkpCisJCQlnb3RvIGVycl93ZWRnZWQ7CisKKwkJaTkxNV9yZXF1ZXN0X2dldChy
cSk7CisJCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCisJCXJpbmdfc2l6ZSA9IHJxLT53YV90YWls
IC0gcnEtPmhlYWQ7CisJCWlmIChyaW5nX3NpemUgPCAwKQorCQkJcmluZ19zaXplICs9IHJxLT5y
aW5nLT5zaXplOworCQlyaW5nX3NpemUgPSBycS0+cmluZy0+c2l6ZSAvIHJpbmdfc2l6ZTsKKwkJ
cHJfZGVidWcoIiVzKCVzKTogVXNpbmcgbWF4aW11bSBvZiAlZCByZXF1ZXN0c1xuIiwKKwkJCSBf
X2Z1bmNfXywgZW5naW5lLT5uYW1lLCByaW5nX3NpemUpOworCisJCWlndF9zcGlubmVyX2VuZCgm
bG8uc3Bpbik7CisJCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChycSwgMCwgSFogLyAyKSA8IDApIHsK
KwkJCXByX2VycigiVGltZWQgb3V0IHdhaXRpbmcgdG8gZmx1c2ggJXNcbiIsIGVuZ2luZS0+bmFt
ZSk7CisJCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKKwkJCWdvdG8gZXJyX3dlZGdlZDsKKwkJfQor
CQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKKworCQlpZiAoaWd0X2xpdmVfdGVzdF9iZWdpbigmdCwg
Z3QtPmk5MTUsIF9fZnVuY19fLCBlbmdpbmUtPm5hbWUpKSB7CisJCQllcnIgPSAtRUlPOworCQkJ
Z290byBlcnJfd2VkZ2VkOworCQl9CisKKwkJZm9yX2VhY2hfcHJpbWVfbnVtYmVyX2Zyb20oY291
bnQsIDEsIHJpbmdfc2l6ZSkgeworCQkJcnEgPSBzcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZoaS5z
cGluLAorCQkJCQkJICAgIGhpLmN0eCwgZW5naW5lLAorCQkJCQkJICAgIE1JX0FSQl9DSEVDSyk7
CisJCQlpZiAoSVNfRVJSKHJxKSkKKwkJCQlnb3RvIGVycl93ZWRnZWQ7CisJCQlpOTE1X3JlcXVl
c3RfYWRkKHJxKTsKKwkJCWlmICghaWd0X3dhaXRfZm9yX3NwaW5uZXIoJmhpLnNwaW4sIHJxKSkK
KwkJCQlnb3RvIGVycl93ZWRnZWQ7CisKKwkJCXJxID0gc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgm
bG8uc3BpbiwKKwkJCQkJCSAgICBsby5jdHgsIGVuZ2luZSwKKwkJCQkJCSAgICBNSV9BUkJfQ0hF
Q0spOworCQkJaWYgKElTX0VSUihycSkpCisJCQkJZ290byBlcnJfd2VkZ2VkOworCQkJaTkxNV9y
ZXF1ZXN0X2FkZChycSk7CisKKwkJCWZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CisJCQkJ
cnEgPSBpZ3RfcmVxdWVzdF9hbGxvYyhsby5jdHgsIGVuZ2luZSk7CisJCQkJaWYgKElTX0VSUihy
cSkpCisJCQkJCWdvdG8gZXJyX3dlZGdlZDsKKwkJCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKwkJ
CX0KKworCQkJcnEgPSBpZ3RfcmVxdWVzdF9hbGxvYyhoaS5jdHgsIGVuZ2luZSk7CisJCQlpZiAo
SVNfRVJSKHJxKSkKKwkJCQlnb3RvIGVycl93ZWRnZWQ7CisKKwkJCWk5MTVfcmVxdWVzdF9nZXQo
cnEpOworCQkJaTkxNV9yZXF1ZXN0X2FkZChycSk7CisJCQllbmdpbmUtPnNjaGVkdWxlKHJxLCAm
YXR0cik7CisKKwkJCWlndF9zcGlubmVyX2VuZCgmaGkuc3Bpbik7CisJCQlpZiAoaTkxNV9yZXF1
ZXN0X3dhaXQocnEsIDAsIEhaIC8gNSkgPCAwKSB7CisJCQkJc3RydWN0IGRybV9wcmludGVyIHAg
PQorCQkJCQlkcm1faW5mb19wcmludGVyKGd0LT5pOTE1LT5kcm0uZGV2KTsKKworCQkJCXByX2Vy
cigiRmFpbGVkIHRvIHByZWVtcHQgb3ZlciBjaGFpbiBvZiAlZFxuIiwKKwkJCQkgICAgICAgY291
bnQpOworCQkJCWludGVsX2VuZ2luZV9kdW1wKGVuZ2luZSwgJnAsCisJCQkJCQkgICIlc1xuIiwg
ZW5naW5lLT5uYW1lKTsKKwkJCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKKwkJCQlnb3RvIGVycl93
ZWRnZWQ7CisJCQl9CisJCQlpZ3Rfc3Bpbm5lcl9lbmQoJmxvLnNwaW4pOworCQkJaTkxNV9yZXF1
ZXN0X3B1dChycSk7CisKKwkJCXJxID0gaWd0X3JlcXVlc3RfYWxsb2MobG8uY3R4LCBlbmdpbmUp
OworCQkJaWYgKElTX0VSUihycSkpCisJCQkJZ290byBlcnJfd2VkZ2VkOworCisJCQlpOTE1X3Jl
cXVlc3RfZ2V0KHJxKTsKKwkJCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCisJCQlpZiAoaTkxNV9y
ZXF1ZXN0X3dhaXQocnEsIDAsIEhaIC8gNSkgPCAwKSB7CisJCQkJc3RydWN0IGRybV9wcmludGVy
IHAgPQorCQkJCQlkcm1faW5mb19wcmludGVyKGd0LT5pOTE1LT5kcm0uZGV2KTsKKworCQkJCXBy
X2VycigiRmFpbGVkIHRvIGZsdXNoIGxvdyBwcmlvcml0eSBjaGFpbiBvZiAlZCByZXF1ZXN0c1xu
IiwKKwkJCQkgICAgICAgY291bnQpOworCQkJCWludGVsX2VuZ2luZV9kdW1wKGVuZ2luZSwgJnAs
CisJCQkJCQkgICIlc1xuIiwgZW5naW5lLT5uYW1lKTsKKworCQkJCWk5MTVfcmVxdWVzdF9wdXQo
cnEpOworCQkJCWdvdG8gZXJyX3dlZGdlZDsKKwkJCX0KKwkJCWk5MTVfcmVxdWVzdF9wdXQocnEp
OworCQl9CisKKwkJaWYgKGlndF9saXZlX3Rlc3RfZW5kKCZ0KSkgeworCQkJZXJyID0gLUVJTzsK
KwkJCWdvdG8gZXJyX3dlZGdlZDsKKwkJfQorCX0KKworCWVyciA9IDA7CitlcnJfY2xpZW50X2xv
OgorCXByZWVtcHRfY2xpZW50X2ZpbmkoJmxvKTsKK2Vycl9jbGllbnRfaGk6CisJcHJlZW1wdF9j
bGllbnRfZmluaSgmaGkpOworCXJldHVybiBlcnI7CisKK2Vycl93ZWRnZWQ6CisJaWd0X3NwaW5u
ZXJfZW5kKCZoaS5zcGluKTsKKwlpZ3Rfc3Bpbm5lcl9lbmQoJmxvLnNwaW4pOworCWludGVsX2d0
X3NldF93ZWRnZWQoZ3QpOworCWVyciA9IC1FSU87CisJZ290byBlcnJfY2xpZW50X2xvOworfQor
CitzdGF0aWMgaW50IGNyZWF0ZV9nYW5nKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwK
KwkJICAgICAgIHN0cnVjdCBpOTE1X3JlcXVlc3QgKipwcmV2KQoreworCXN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmo7CisJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOworCXN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxOworCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOworCXUzMiAqY3M7CisJaW50
IGVycjsKKworCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lLT5rZXJuZWxfY29udGV4
dC0+Z2VtX2NvbnRleHQsIGVuZ2luZSk7CisJaWYgKElTX0VSUihjZSkpCisJCXJldHVybiBQVFJf
RVJSKGNlKTsKKworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoZW5naW5l
LT5pOTE1LCA0MDk2KTsKKwlpZiAoSVNfRVJSKG9iaikpIHsKKwkJZXJyID0gUFRSX0VSUihvYmop
OworCQlnb3RvIGVycl9jZTsKKwl9CisKKwl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosIGNl
LT52bSwgTlVMTCk7CisJaWYgKElTX0VSUih2bWEpKSB7CisJCWVyciA9IFBUUl9FUlIodm1hKTsK
KwkJZ290byBlcnJfb2JqOworCX0KKworCWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIFBJ
Tl9VU0VSKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl9vYmo7CisKKwljcyA9IGk5MTVfZ2VtX29i
amVjdF9waW5fbWFwKG9iaiwgSTkxNV9NQVBfV0MpOworCWlmIChJU19FUlIoY3MpKQorCQlnb3Rv
IGVycl9vYmo7CisKKwkvKiBTZW1hcGhvcmUgdGFyZ2V0OiBzcGluIHVudGlsIHplcm8gKi8KKwkq
Y3MrKyA9IE1JX0FSQl9PTl9PRkYgfCBNSV9BUkJfRU5BQkxFOworCisJKmNzKysgPSBNSV9TRU1B
UEhPUkVfV0FJVCB8CisJCU1JX1NFTUFQSE9SRV9QT0xMIHwKKwkJTUlfU0VNQVBIT1JFX1NBRF9F
UV9TREQ7CisJKmNzKysgPSAwOworCSpjcysrID0gbG93ZXJfMzJfYml0cyh2bWEtPm5vZGUuc3Rh
cnQpOworCSpjcysrID0gdXBwZXJfMzJfYml0cyh2bWEtPm5vZGUuc3RhcnQpOworCisJaWYgKCpw
cmV2KSB7CisJCXU2NCBvZmZzZXQgPSAoKnByZXYpLT5iYXRjaC0+bm9kZS5zdGFydDsKKworCQkv
KiBUZXJtaW5hdGUgdGhlIHNwaW5uZXIgaW4gdGhlIG5leHQgbG93ZXIgcHJpb3JpdHkgYmF0Y2gu
ICovCisJCSpjcysrID0gTUlfU1RPUkVfRFdPUkRfSU1NX0dFTjQ7CisJCSpjcysrID0gbG93ZXJf
MzJfYml0cyhvZmZzZXQpOworCQkqY3MrKyA9IHVwcGVyXzMyX2JpdHMob2Zmc2V0KTsKKwkJKmNz
KysgPSAwOworCX0KKworCSpjcysrID0gTUlfQkFUQ0hfQlVGRkVSX0VORDsKKwlpOTE1X2dlbV9v
YmplY3RfZmx1c2hfbWFwKG9iaik7CisJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChvYmopOwor
CisJcnEgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZV9yZXF1ZXN0KGNlKTsKKwlpZiAoSVNfRVJSKHJx
KSkKKwkJZ290byBlcnJfb2JqOworCisJcnEtPmJhdGNoID0gdm1hOworCWk5MTVfcmVxdWVzdF9n
ZXQocnEpOworCisJaTkxNV92bWFfbG9jayh2bWEpOworCWVyciA9IGk5MTVfcmVxdWVzdF9hd2Fp
dF9vYmplY3QocnEsIHZtYS0+b2JqLCBmYWxzZSk7CisJaWYgKCFlcnIpCisJCWVyciA9IGk5MTVf
dm1hX21vdmVfdG9fYWN0aXZlKHZtYSwgcnEsIDApOworCWlmICghZXJyKQorCQllcnIgPSBycS0+
ZW5naW5lLT5lbWl0X2JiX3N0YXJ0KHJxLAorCQkJCQkJdm1hLT5ub2RlLnN0YXJ0LAorCQkJCQkJ
UEFHRV9TSVpFLCAwKTsKKwlpOTE1X3ZtYV91bmxvY2sodm1hKTsKKwlpOTE1X3JlcXVlc3RfYWRk
KHJxKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl9ycTsKKworCWk5MTVfZ2VtX29iamVjdF9wdXQo
b2JqKTsKKwlpbnRlbF9jb250ZXh0X3B1dChjZSk7CisKKwlycS0+Y2xpZW50X2xpbmsubmV4dCA9
ICYoKnByZXYpLT5jbGllbnRfbGluazsKKwkqcHJldiA9IHJxOworCXJldHVybiAwOworCitlcnJf
cnE6CisJaTkxNV9yZXF1ZXN0X3B1dChycSk7CitlcnJfb2JqOgorCWk5MTVfZ2VtX29iamVjdF9w
dXQob2JqKTsKK2Vycl9jZToKKwlpbnRlbF9jb250ZXh0X3B1dChjZSk7CisJcmV0dXJuIGVycjsK
K30KKworc3RhdGljIGludCBsaXZlX3ByZWVtcHRfZ2FuZyh2b2lkICphcmcpCit7CisJc3RydWN0
IGludGVsX2d0ICpndCA9IGFyZzsKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CisJ
ZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisKKwlpZiAoIUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1Q
VElPTihndC0+aTkxNSkpCisJCXJldHVybiAwOworCisJLyoKKwkgKiBCdWlsZCBhcyBsb25nIGEg
Y2hhaW4gb2YgcHJlZW1wdGVycyBhcyB3ZSBjYW4sIHdpdGggZWFjaAorCSAqIHJlcXVlc3QgaGln
aGVyIHByaW9yaXR5IHRoYW4gdGhlIGxhc3QuIE9uY2Ugd2UgYXJlIHJlYWR5LCB3ZSByZWxlYXNl
CisJICogdGhlIGxhc3QgYmF0Y2ggd2hpY2ggdGhlbiBwcmVjb2xhdGVzIGRvd24gdGhlIGNoYWlu
LCBlYWNoIHJlbGVhc2luZworCSAqIHRoZSBuZXh0IG9sZGVzdCBpbiB0dXJuLiBUaGUgaW50ZW50
IGlzIHRvIHNpbXBseSBwdXNoIGFzIGhhcmQgYXMgd2UKKwkgKiBjYW4gd2l0aCB0aGUgbnVtYmVy
IG9mIHByZWVtcHRpb25zLCB0cnlpbmcgdG8gZXhjZWVkIG5hcnJvdyBIVworCSAqIGxpbWl0cy4g
QXQgYSBtaW5pbXVtLCB3ZSBpbnNpc3QgdGhhdCB3ZSBjYW4gc29ydCBhbGwgdGhlIHVzZXIKKwkg
KiBoaWdoIHByaW9yaXR5IGxldmVscyBpbnRvIGV4ZWN1dGlvbiBvcmRlci4KKwkgKi8KKworCWZv
cl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgeworCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
cSA9IE5VTEw7CisJCXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7CisJCUlHVF9USU1FT1VUKGVuZF90
aW1lKTsKKwkJaW50IHByaW8gPSAwOworCQlpbnQgZXJyID0gMDsKKwkJdTMyICpjczsKKworCQlp
ZiAoIWludGVsX2VuZ2luZV9oYXNfcHJlZW1wdGlvbihlbmdpbmUpKQorCQkJY29udGludWU7CisK
KwkJaWYgKGlndF9saXZlX3Rlc3RfYmVnaW4oJnQsIGd0LT5pOTE1LCBfX2Z1bmNfXywgZW5naW5l
LT5uYW1lKSkKKwkJCXJldHVybiAtRUlPOworCisJCWRvIHsKKwkJCXN0cnVjdCBpOTE1X3NjaGVk
X2F0dHIgYXR0ciA9IHsKKwkJCQkucHJpb3JpdHkgPSBJOTE1X1VTRVJfUFJJT1JJVFkocHJpbysr
KSwKKwkJCX07CisKKwkJCWVyciA9IGNyZWF0ZV9nYW5nKGVuZ2luZSwgJnJxKTsKKwkJCWlmIChl
cnIpCisJCQkJYnJlYWs7CisKKwkJCS8qIFN1Ym1pdCBlYWNoIHNwaW5uZXIgYXQgaW5jcmVhc2lu
ZyBwcmlvcml0eSAqLworCQkJZW5naW5lLT5zY2hlZHVsZShycSwgJmF0dHIpOworCisJCQlpZiAo
cHJpbyA8PSBJOTE1X1BSSU9SSVRZX01BWCkKKwkJCQljb250aW51ZTsKKworCQkJaWYgKHByaW8g
PiAoSU5UX01BWCA+PiBJOTE1X1VTRVJfUFJJT1JJVFlfU0hJRlQpKQorCQkJCWJyZWFrOworCisJ
CQlpZiAoX19pZ3RfdGltZW91dChlbmRfdGltZSwgTlVMTCkpCisJCQkJYnJlYWs7CisJCX0gd2hp
bGUgKDEpOworCQlwcl9kZWJ1ZygiJXM6IFByZWVtcHQgY2hhaW4gb2YgJWQgcmVxdWVzdHNcbiIs
CisJCQkgZW5naW5lLT5uYW1lLCBwcmlvKTsKKworCQkvKgorCQkgKiBTdWNoIHRoYXQgdGhlIGxh
c3Qgc3Bpbm5lciBpcyB0aGUgaGlnaGVzdCBwcmlvcml0eSBhbmQKKwkJICogc2hvdWxkIGV4ZWN1
dGUgZmlyc3QuIFdoZW4gdGhhdCBzcGlubmVyIGNvbXBsZXRlcywKKwkJICogaXQgd2lsbCB0ZXJt
aW5hdGUgdGhlIG5leHQgbG93ZXN0IHNwaW5uZXIgdW50aWwgdGhlcmUKKwkJICogYXJlIG5vIG1v
cmUgc3Bpbm5lcnMgYW5kIHRoZSBnYW5nIGlzIGNvbXBsZXRlLgorCQkgKi8KKwkJY3MgPSBpOTE1
X2dlbV9vYmplY3RfcGluX21hcChycS0+YmF0Y2gtPm9iaiwgSTkxNV9NQVBfV0MpOworCQlpZiAo
IUlTX0VSUihjcykpIHsKKwkJCSpjcyA9IDA7CisJCQlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFw
KHJxLT5iYXRjaC0+b2JqKTsKKwkJfSBlbHNlIHsKKwkJCWVyciA9IFBUUl9FUlIoY3MpOworCQkJ
aW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CisJCX0KKworCQl3aGlsZSAocnEpIHsgLyogd2FpdCBm
b3IgZWFjaCBycSBmcm9tIGhpZ2hlc3QgdG8gbG93ZXN0IHByaW8gKi8KKwkJCXN0cnVjdCBpOTE1
X3JlcXVlc3QgKm4gPQorCQkJCWxpc3RfbmV4dF9lbnRyeShycSwgY2xpZW50X2xpbmspOworCisJ
CQlpZiAoZXJyID09IDAgJiYgaTkxNV9yZXF1ZXN0X3dhaXQocnEsIDAsIEhaIC8gNSkgPCAwKSB7
CisJCQkJc3RydWN0IGRybV9wcmludGVyIHAgPQorCQkJCQlkcm1faW5mb19wcmludGVyKGVuZ2lu
ZS0+aTkxNS0+ZHJtLmRldik7CisKKwkJCQlwcl9lcnIoIkZhaWxlZCB0byBmbHVzaCBjaGFpbiBv
ZiAlZCByZXF1ZXN0cywgYXQgJWRcbiIsCisJCQkJICAgICAgIHByaW8sIHJxX3ByaW8ocnEpID4+
IEk5MTVfVVNFUl9QUklPUklUWV9TSElGVCk7CisJCQkJaW50ZWxfZW5naW5lX2R1bXAoZW5naW5l
LCAmcCwKKwkJCQkJCSAgIiVzXG4iLCBlbmdpbmUtPm5hbWUpOworCisJCQkJZXJyID0gLUVUSU1F
OworCQkJfQorCisJCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKKwkJCXJxID0gbjsKKwkJfQorCisJ
CWlmIChpZ3RfbGl2ZV90ZXN0X2VuZCgmdCkpCisJCQllcnIgPSAtRUlPOworCQlpZiAoZXJyKQor
CQkJcmV0dXJuIGVycjsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBsaXZlX3By
ZWVtcHRfaGFuZyh2b2lkICphcmcpCit7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKKwlz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4X2hpLCAqY3R4X2xvOworCXN0cnVjdCBpZ3Rfc3Bp
bm5lciBzcGluX2hpLCBzcGluX2xvOworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsK
KwllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKKwlpbnQgZXJyID0gLUVOT01FTTsKKworCWlmICgh
SEFTX0xPR0lDQUxfUklOR19QUkVFTVBUSU9OKGd0LT5pOTE1KSkKKwkJcmV0dXJuIDA7CisKKwlp
ZiAoIWludGVsX2hhc19yZXNldF9lbmdpbmUoZ3QpKQorCQlyZXR1cm4gMDsKKworCWlmIChpZ3Rf
c3Bpbm5lcl9pbml0KCZzcGluX2hpLCBndCkpCisJCXJldHVybiAtRU5PTUVNOworCisJaWYgKGln
dF9zcGlubmVyX2luaXQoJnNwaW5fbG8sIGd0KSkKKwkJZ290byBlcnJfc3Bpbl9oaTsKKworCWN0
eF9oaSA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKKwlpZiAoIWN0eF9oaSkKKwkJZ290byBl
cnJfc3Bpbl9sbzsKKwljdHhfaGktPnNjaGVkLnByaW9yaXR5ID0KKwkJSTkxNV9VU0VSX1BSSU9S
SVRZKEk5MTVfQ09OVEVYVF9NQVhfVVNFUl9QUklPUklUWSk7CisKKwljdHhfbG8gPSBrZXJuZWxf
Y29udGV4dChndC0+aTkxNSk7CisJaWYgKCFjdHhfbG8pCisJCWdvdG8gZXJyX2N0eF9oaTsKKwlj
dHhfbG8tPnNjaGVkLnByaW9yaXR5ID0KKwkJSTkxNV9VU0VSX1BSSU9SSVRZKEk5MTVfQ09OVEVY
VF9NSU5fVVNFUl9QUklPUklUWSk7CisKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwgaWQp
IHsKKwkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisKKwkJaWYgKCFpbnRlbF9lbmdpbmVfaGFz
X3ByZWVtcHRpb24oZW5naW5lKSkKKwkJCWNvbnRpbnVlOworCisJCXJxID0gc3Bpbm5lcl9jcmVh
dGVfcmVxdWVzdCgmc3Bpbl9sbywgY3R4X2xvLCBlbmdpbmUsCisJCQkJCSAgICBNSV9BUkJfQ0hF
Q0spOworCQlpZiAoSVNfRVJSKHJxKSkgeworCQkJZXJyID0gUFRSX0VSUihycSk7CisJCQlnb3Rv
IGVycl9jdHhfbG87CisJCX0KKworCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKwkJaWYgKCFpZ3Rf
d2FpdF9mb3Jfc3Bpbm5lcigmc3Bpbl9sbywgcnEpKSB7CisJCQlHRU1fVFJBQ0UoImxvIHNwaW5u
ZXIgZmFpbGVkIHRvIHN0YXJ0XG4iKTsKKwkJCUdFTV9UUkFDRV9EVU1QKCk7CisJCQlpbnRlbF9n
dF9zZXRfd2VkZ2VkKGd0KTsKKwkJCWVyciA9IC1FSU87CisJCQlnb3RvIGVycl9jdHhfbG87CisJ
CX0KKworCQlycSA9IHNwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJnNwaW5faGksIGN0eF9oaSwgZW5n
aW5lLAorCQkJCQkgICAgTUlfQVJCX0NIRUNLKTsKKwkJaWYgKElTX0VSUihycSkpIHsKKwkJCWln
dF9zcGlubmVyX2VuZCgmc3Bpbl9sbyk7CisJCQllcnIgPSBQVFJfRVJSKHJxKTsKKwkJCWdvdG8g
ZXJyX2N0eF9sbzsKKwkJfQorCisJCWluaXRfY29tcGxldGlvbigmZW5naW5lLT5leGVjbGlzdHMu
cHJlZW1wdF9oYW5nLmNvbXBsZXRpb24pOworCQllbmdpbmUtPmV4ZWNsaXN0cy5wcmVlbXB0X2hh
bmcuaW5qZWN0X2hhbmcgPSB0cnVlOworCisJCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCisJCWlm
ICghd2FpdF9mb3JfY29tcGxldGlvbl90aW1lb3V0KCZlbmdpbmUtPmV4ZWNsaXN0cy5wcmVlbXB0
X2hhbmcuY29tcGxldGlvbiwKKwkJCQkJCSBIWiAvIDEwKSkgeworCQkJcHJfZXJyKCJQcmVlbXB0
aW9uIGRpZCBub3Qgb2NjdXIgd2l0aGluIHRpbWVvdXQhIik7CisJCQlHRU1fVFJBQ0VfRFVNUCgp
OworCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CisJCQllcnIgPSAtRUlPOworCQkJZ290byBl
cnJfY3R4X2xvOworCQl9CisKKwkJc2V0X2JpdChJOTE1X1JFU0VUX0VOR0lORSArIGlkLCAmZ3Qt
PnJlc2V0LmZsYWdzKTsKKwkJaW50ZWxfZW5naW5lX3Jlc2V0KGVuZ2luZSwgTlVMTCk7CisJCWNs
ZWFyX2JpdChJOTE1X1JFU0VUX0VOR0lORSArIGlkLCAmZ3QtPnJlc2V0LmZsYWdzKTsKKworCQll
bmdpbmUtPmV4ZWNsaXN0cy5wcmVlbXB0X2hhbmcuaW5qZWN0X2hhbmcgPSBmYWxzZTsKKworCQlp
ZiAoIWlndF93YWl0X2Zvcl9zcGlubmVyKCZzcGluX2hpLCBycSkpIHsKKwkJCUdFTV9UUkFDRSgi
aGkgc3Bpbm5lciBmYWlsZWQgdG8gc3RhcnRcbiIpOworCQkJR0VNX1RSQUNFX0RVTVAoKTsKKwkJ
CWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOworCQkJZXJyID0gLUVJTzsKKwkJCWdvdG8gZXJyX2N0
eF9sbzsKKwkJfQorCisJCWlndF9zcGlubmVyX2VuZCgmc3Bpbl9oaSk7CisJCWlndF9zcGlubmVy
X2VuZCgmc3Bpbl9sbyk7CisJCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpIHsKKwkJCWVy
ciA9IC1FSU87CisJCQlnb3RvIGVycl9jdHhfbG87CisJCX0KKwl9CisKKwllcnIgPSAwOworZXJy
X2N0eF9sbzoKKwlrZXJuZWxfY29udGV4dF9jbG9zZShjdHhfbG8pOworZXJyX2N0eF9oaToKKwlr
ZXJuZWxfY29udGV4dF9jbG9zZShjdHhfaGkpOworZXJyX3NwaW5fbG86CisJaWd0X3NwaW5uZXJf
ZmluaSgmc3Bpbl9sbyk7CitlcnJfc3Bpbl9oaToKKwlpZ3Rfc3Bpbm5lcl9maW5pKCZzcGluX2hp
KTsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgaW50IGxpdmVfcHJlZW1wdF90aW1lb3V0KHZv
aWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOworCXN0cnVjdCBpOTE1X2dl
bV9jb250ZXh0ICpjdHhfaGksICpjdHhfbG87CisJc3RydWN0IGlndF9zcGlubmVyIHNwaW5fbG87
CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOworCWVudW0gaW50ZWxfZW5naW5lX2lk
IGlkOworCWludCBlcnIgPSAtRU5PTUVNOworCisJLyoKKwkgKiBDaGVjayB0aGF0IHdlIGZvcmNl
IHByZWVtcHRpb24gdG8gb2NjdXIgYnkgY2FuY2VsbGluZyB0aGUgcHJldmlvdXMKKwkgKiBjb250
ZXh0IGlmIGl0IHJlZnVzZXMgdG8geWllbGQgdGhlIEdQVS4KKwkgKi8KKwlpZiAoIUlTX0FDVElW
RShDT05GSUdfRFJNX0k5MTVfUFJFRU1QVF9USU1FT1VUKSkKKwkJcmV0dXJuIDA7CisKKwlpZiAo
IUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1QVElPTihndC0+aTkxNSkpCisJCXJldHVybiAwOworCisJ
aWYgKCFpbnRlbF9oYXNfcmVzZXRfZW5naW5lKGd0KSkKKwkJcmV0dXJuIDA7CisKKwlpZiAoaWd0
X3NwaW5uZXJfaW5pdCgmc3Bpbl9sbywgZ3QpKQorCQlyZXR1cm4gLUVOT01FTTsKKworCWN0eF9o
aSA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKKwlpZiAoIWN0eF9oaSkKKwkJZ290byBlcnJf
c3Bpbl9sbzsKKwljdHhfaGktPnNjaGVkLnByaW9yaXR5ID0KKwkJSTkxNV9VU0VSX1BSSU9SSVRZ
KEk5MTVfQ09OVEVYVF9NQVhfVVNFUl9QUklPUklUWSk7CisKKwljdHhfbG8gPSBrZXJuZWxfY29u
dGV4dChndC0+aTkxNSk7CisJaWYgKCFjdHhfbG8pCisJCWdvdG8gZXJyX2N0eF9oaTsKKwljdHhf
bG8tPnNjaGVkLnByaW9yaXR5ID0KKwkJSTkxNV9VU0VSX1BSSU9SSVRZKEk5MTVfQ09OVEVYVF9N
SU5fVVNFUl9QUklPUklUWSk7CisKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwgaWQpIHsK
KwkJdW5zaWduZWQgbG9uZyBzYXZlZF90aW1lb3V0OworCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
cTsKKworCQlpZiAoIWludGVsX2VuZ2luZV9oYXNfcHJlZW1wdGlvbihlbmdpbmUpKQorCQkJY29u
dGludWU7CisKKwkJcnEgPSBzcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZzcGluX2xvLCBjdHhfbG8s
IGVuZ2luZSwKKwkJCQkJICAgIE1JX05PT1ApOyAvKiBwcmVlbXB0aW9uIGRpc2FibGVkICovCisJ
CWlmIChJU19FUlIocnEpKSB7CisJCQllcnIgPSBQVFJfRVJSKHJxKTsKKwkJCWdvdG8gZXJyX2N0
eF9sbzsKKwkJfQorCisJCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCQlpZiAoIWlndF93YWl0X2Zv
cl9zcGlubmVyKCZzcGluX2xvLCBycSkpIHsKKwkJCWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOwor
CQkJZXJyID0gLUVJTzsKKwkJCWdvdG8gZXJyX2N0eF9sbzsKKwkJfQorCisJCXJxID0gaWd0X3Jl
cXVlc3RfYWxsb2MoY3R4X2hpLCBlbmdpbmUpOworCQlpZiAoSVNfRVJSKHJxKSkgeworCQkJaWd0
X3NwaW5uZXJfZW5kKCZzcGluX2xvKTsKKwkJCWVyciA9IFBUUl9FUlIocnEpOworCQkJZ290byBl
cnJfY3R4X2xvOworCQl9CisKKwkJLyogRmx1c2ggdGhlIHByZXZpb3VzIENTIGFjayBiZWZvcmUg
Y2hhbmdpbmcgdGltZW91dHMgKi8KKwkJd2hpbGUgKFJFQURfT05DRShlbmdpbmUtPmV4ZWNsaXN0
cy5wZW5kaW5nWzBdKSkKKwkJCWNwdV9yZWxheCgpOworCisJCXNhdmVkX3RpbWVvdXQgPSBlbmdp
bmUtPnByb3BzLnByZWVtcHRfdGltZW91dF9tczsKKwkJZW5naW5lLT5wcm9wcy5wcmVlbXB0X3Rp
bWVvdXRfbXMgPSAxOyAvKiBpbiBtcywgLT4gMSBqaWZmaWUgKi8KKworCQlpOTE1X3JlcXVlc3Rf
Z2V0KHJxKTsKKwkJaTkxNV9yZXF1ZXN0X2FkZChycSk7CisKKwkJaW50ZWxfZW5naW5lX2ZsdXNo
X3N1Ym1pc3Npb24oZW5naW5lKTsKKwkJZW5naW5lLT5wcm9wcy5wcmVlbXB0X3RpbWVvdXRfbXMg
PSBzYXZlZF90aW1lb3V0OworCisJCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChycSwgMCwgSFogLyAx
MCkgPCAwKSB7CisJCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKGd0KTsKKwkJCWk5MTVfcmVxdWVzdF9w
dXQocnEpOworCQkJZXJyID0gLUVUSU1FOworCQkJZ290byBlcnJfY3R4X2xvOworCQl9CisKKwkJ
aWd0X3NwaW5uZXJfZW5kKCZzcGluX2xvKTsKKwkJaTkxNV9yZXF1ZXN0X3B1dChycSk7CisJfQor
CisJZXJyID0gMDsKK2Vycl9jdHhfbG86CisJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4X2xvKTsK
K2Vycl9jdHhfaGk6CisJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4X2hpKTsKK2Vycl9zcGluX2xv
OgorCWlndF9zcGlubmVyX2ZpbmkoJnNwaW5fbG8pOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRp
YyBpbnQgcmFuZG9tX3JhbmdlKHN0cnVjdCBybmRfc3RhdGUgKnJuZCwgaW50IG1pbiwgaW50IG1h
eCkKK3sKKwlyZXR1cm4gaTkxNV9wcmFuZG9tX3UzMl9tYXhfc3RhdGUobWF4IC0gbWluLCBybmQp
ICsgbWluOworfQorCitzdGF0aWMgaW50IHJhbmRvbV9wcmlvcml0eShzdHJ1Y3Qgcm5kX3N0YXRl
ICpybmQpCit7CisJcmV0dXJuIHJhbmRvbV9yYW5nZShybmQsIEk5MTVfUFJJT1JJVFlfTUlOLCBJ
OTE1X1BSSU9SSVRZX01BWCk7Cit9CisKK3N0cnVjdCBwcmVlbXB0X3Ntb2tlIHsKKwlzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0OworCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICoqY29udGV4dHM7CisJc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpiYXRjaDsKKwl1bnNpZ25lZCBpbnQgbmNvbnRleHQ7CisJc3RydWN0IHJuZF9zdGF0ZSBwcm5n
OworCXVuc2lnbmVkIGxvbmcgY291bnQ7Cit9OworCitzdGF0aWMgc3RydWN0IGk5MTVfZ2VtX2Nv
bnRleHQgKnNtb2tlX2NvbnRleHQoc3RydWN0IHByZWVtcHRfc21va2UgKnNtb2tlKQoreworCXJl
dHVybiBzbW9rZS0+Y29udGV4dHNbaTkxNV9wcmFuZG9tX3UzMl9tYXhfc3RhdGUoc21va2UtPm5j
b250ZXh0LAorCQkJCQkJCSAgJnNtb2tlLT5wcm5nKV07Cit9CisKK3N0YXRpYyBpbnQgc21va2Vf
c3VibWl0KHN0cnVjdCBwcmVlbXB0X3Ntb2tlICpzbW9rZSwKKwkJCXN0cnVjdCBpOTE1X2dlbV9j
b250ZXh0ICpjdHgsIGludCBwcmlvLAorCQkJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKmJh
dGNoKQoreworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCXN0cnVjdCBpOTE1X3ZtYSAqdm1h
ID0gTlVMTDsKKwlpbnQgZXJyID0gMDsKKworCWlmIChiYXRjaCkgeworCQlzdHJ1Y3QgaTkxNV9h
ZGRyZXNzX3NwYWNlICp2bTsKKworCQl2bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShj
dHgpOworCQl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShiYXRjaCwgdm0sIE5VTEwpOworCQlpOTE1
X3ZtX3B1dCh2bSk7CisJCWlmIChJU19FUlIodm1hKSkKKwkJCXJldHVybiBQVFJfRVJSKHZtYSk7
CisKKwkJZXJyID0gaTkxNV92bWFfcGluKHZtYSwgMCwgMCwgUElOX1VTRVIpOworCQlpZiAoZXJy
KQorCQkJcmV0dXJuIGVycjsKKwl9CisKKwljdHgtPnNjaGVkLnByaW9yaXR5ID0gcHJpbzsKKwor
CXJxID0gaWd0X3JlcXVlc3RfYWxsb2MoY3R4LCBzbW9rZS0+ZW5naW5lKTsKKwlpZiAoSVNfRVJS
KHJxKSkgeworCQllcnIgPSBQVFJfRVJSKHJxKTsKKwkJZ290byB1bnBpbjsKKwl9CisKKwlpZiAo
dm1hKSB7CisJCWk5MTVfdm1hX2xvY2sodm1hKTsKKwkJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0
X29iamVjdChycSwgdm1hLT5vYmosIGZhbHNlKTsKKwkJaWYgKCFlcnIpCisJCQllcnIgPSBpOTE1
X3ZtYV9tb3ZlX3RvX2FjdGl2ZSh2bWEsIHJxLCAwKTsKKwkJaWYgKCFlcnIpCisJCQllcnIgPSBy
cS0+ZW5naW5lLT5lbWl0X2JiX3N0YXJ0KHJxLAorCQkJCQkJCXZtYS0+bm9kZS5zdGFydCwKKwkJ
CQkJCQlQQUdFX1NJWkUsIDApOworCQlpOTE1X3ZtYV91bmxvY2sodm1hKTsKKwl9CisKKwlpOTE1
X3JlcXVlc3RfYWRkKHJxKTsKKwordW5waW46CisJaWYgKHZtYSkKKwkJaTkxNV92bWFfdW5waW4o
dm1hKTsKKworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQgc21va2VfY3Jlc2NlbmRvX3Ro
cmVhZCh2b2lkICphcmcpCit7CisJc3RydWN0IHByZWVtcHRfc21va2UgKnNtb2tlID0gYXJnOwor
CUlHVF9USU1FT1VUKGVuZF90aW1lKTsKKwl1bnNpZ25lZCBsb25nIGNvdW50OworCisJY291bnQg
PSAwOworCWRvIHsKKwkJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IHNtb2tlX2NvbnRl
eHQoc21va2UpOworCQlpbnQgZXJyOworCisJCWVyciA9IHNtb2tlX3N1Ym1pdChzbW9rZSwKKwkJ
CQkgICBjdHgsIGNvdW50ICUgSTkxNV9QUklPUklUWV9NQVgsCisJCQkJICAgc21va2UtPmJhdGNo
KTsKKwkJaWYgKGVycikKKwkJCXJldHVybiBlcnI7CisKKwkJY291bnQrKzsKKwl9IHdoaWxlICgh
X19pZ3RfdGltZW91dChlbmRfdGltZSwgTlVMTCkpOworCisJc21va2UtPmNvdW50ID0gY291bnQ7
CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgc21va2VfY3Jlc2NlbmRvKHN0cnVjdCBwcmVl
bXB0X3Ntb2tlICpzbW9rZSwgdW5zaWduZWQgaW50IGZsYWdzKQorI2RlZmluZSBCQVRDSCBCSVQo
MCkKK3sKKwlzdHJ1Y3QgdGFza19zdHJ1Y3QgKnRza1tJOTE1X05VTV9FTkdJTkVTXSA9IHt9Owor
CXN0cnVjdCBwcmVlbXB0X3Ntb2tlIGFyZ1tJOTE1X05VTV9FTkdJTkVTXTsKKwlzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmU7CisJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisJdW5zaWdu
ZWQgbG9uZyBjb3VudDsKKwlpbnQgZXJyID0gMDsKKworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUs
IHNtb2tlLT5ndCwgaWQpIHsKKwkJYXJnW2lkXSA9ICpzbW9rZTsKKwkJYXJnW2lkXS5lbmdpbmUg
PSBlbmdpbmU7CisJCWlmICghKGZsYWdzICYgQkFUQ0gpKQorCQkJYXJnW2lkXS5iYXRjaCA9IE5V
TEw7CisJCWFyZ1tpZF0uY291bnQgPSAwOworCisJCXRza1tpZF0gPSBrdGhyZWFkX3J1bihzbW9r
ZV9jcmVzY2VuZG9fdGhyZWFkLCAmYXJnLAorCQkJCSAgICAgICJpZ3Qvc21va2U6JWQiLCBpZCk7
CisJCWlmIChJU19FUlIodHNrW2lkXSkpIHsKKwkJCWVyciA9IFBUUl9FUlIodHNrW2lkXSk7CisJ
CQlicmVhazsKKwkJfQorCQlnZXRfdGFza19zdHJ1Y3QodHNrW2lkXSk7CisJfQorCisJeWllbGQo
KTsgLyogc3RhcnQgYWxsIHRocmVhZHMgYmVmb3JlIHdlIGt0aHJlYWRfc3RvcCgpICovCisKKwlj
b3VudCA9IDA7CisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgc21va2UtPmd0LCBpZCkgeworCQlp
bnQgc3RhdHVzOworCisJCWlmIChJU19FUlJfT1JfTlVMTCh0c2tbaWRdKSkKKwkJCWNvbnRpbnVl
OworCisJCXN0YXR1cyA9IGt0aHJlYWRfc3RvcCh0c2tbaWRdKTsKKwkJaWYgKHN0YXR1cyAmJiAh
ZXJyKQorCQkJZXJyID0gc3RhdHVzOworCisJCWNvdW50ICs9IGFyZ1tpZF0uY291bnQ7CisKKwkJ
cHV0X3Rhc2tfc3RydWN0KHRza1tpZF0pOworCX0KKworCXByX2luZm8oIlN1Ym1pdHRlZCAlbHUg
Y3Jlc2NlbmRvOiV4IHJlcXVlc3RzIGFjcm9zcyAlZCBlbmdpbmVzIGFuZCAlZCBjb250ZXh0c1xu
IiwKKwkJY291bnQsIGZsYWdzLAorCQlSVU5USU1FX0lORk8oc21va2UtPmd0LT5pOTE1KS0+bnVt
X2VuZ2luZXMsIHNtb2tlLT5uY29udGV4dCk7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQg
c21va2VfcmFuZG9tKHN0cnVjdCBwcmVlbXB0X3Ntb2tlICpzbW9rZSwgdW5zaWduZWQgaW50IGZs
YWdzKQoreworCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOworCUlHVF9USU1FT1VUKGVuZF90aW1l
KTsKKwl1bnNpZ25lZCBsb25nIGNvdW50OworCisJY291bnQgPSAwOworCWRvIHsKKwkJZm9yX2Vh
Y2hfZW5naW5lKHNtb2tlLT5lbmdpbmUsIHNtb2tlLT5ndCwgaWQpIHsKKwkJCXN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICpjdHggPSBzbW9rZV9jb250ZXh0KHNtb2tlKTsKKwkJCWludCBlcnI7CisK
KwkJCWVyciA9IHNtb2tlX3N1Ym1pdChzbW9rZSwKKwkJCQkJICAgY3R4LCByYW5kb21fcHJpb3Jp
dHkoJnNtb2tlLT5wcm5nKSwKKwkJCQkJICAgZmxhZ3MgJiBCQVRDSCA/IHNtb2tlLT5iYXRjaCA6
IE5VTEwpOworCQkJaWYgKGVycikKKwkJCQlyZXR1cm4gZXJyOworCisJCQljb3VudCsrOworCQl9
CisJfSB3aGlsZSAoIV9faWd0X3RpbWVvdXQoZW5kX3RpbWUsIE5VTEwpKTsKKworCXByX2luZm8o
IlN1Ym1pdHRlZCAlbHUgcmFuZG9tOiV4IHJlcXVlc3RzIGFjcm9zcyAlZCBlbmdpbmVzIGFuZCAl
ZCBjb250ZXh0c1xuIiwKKwkJY291bnQsIGZsYWdzLAorCQlSVU5USU1FX0lORk8oc21va2UtPmd0
LT5pOTE1KS0+bnVtX2VuZ2luZXMsIHNtb2tlLT5uY29udGV4dCk7CisJcmV0dXJuIDA7Cit9CisK
K3N0YXRpYyBpbnQgbGl2ZV9wcmVlbXB0X3Ntb2tlKHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgcHJl
ZW1wdF9zbW9rZSBzbW9rZSA9IHsKKwkJLmd0ID0gYXJnLAorCQkucHJuZyA9IEk5MTVfUk5EX1NU
QVRFX0lOSVRJQUxJWkVSKGk5MTVfc2VsZnRlc3QucmFuZG9tX3NlZWQpLAorCQkubmNvbnRleHQg
PSAxMDI0LAorCX07CisJY29uc3QgdW5zaWduZWQgaW50IHBoYXNlW10gPSB7IDAsIEJBVENIIH07
CisJc3RydWN0IGlndF9saXZlX3Rlc3QgdDsKKwlpbnQgZXJyID0gLUVOT01FTTsKKwl1MzIgKmNz
OworCWludCBuOworCisJaWYgKCFIQVNfTE9HSUNBTF9SSU5HX1BSRUVNUFRJT04oc21va2UuZ3Qt
Pmk5MTUpKQorCQlyZXR1cm4gMDsKKworCXNtb2tlLmNvbnRleHRzID0ga21hbGxvY19hcnJheShz
bW9rZS5uY29udGV4dCwKKwkJCQkgICAgICAgc2l6ZW9mKCpzbW9rZS5jb250ZXh0cyksCisJCQkJ
ICAgICAgIEdGUF9LRVJORUwpOworCWlmICghc21va2UuY29udGV4dHMpCisJCXJldHVybiAtRU5P
TUVNOworCisJc21va2UuYmF0Y2ggPQorCQlpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFs
KHNtb2tlLmd0LT5pOTE1LCBQQUdFX1NJWkUpOworCWlmIChJU19FUlIoc21va2UuYmF0Y2gpKSB7
CisJCWVyciA9IFBUUl9FUlIoc21va2UuYmF0Y2gpOworCQlnb3RvIGVycl9mcmVlOworCX0KKwor
CWNzID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAoc21va2UuYmF0Y2gsIEk5MTVfTUFQX1dCKTsK
KwlpZiAoSVNfRVJSKGNzKSkgeworCQllcnIgPSBQVFJfRVJSKGNzKTsKKwkJZ290byBlcnJfYmF0
Y2g7CisJfQorCWZvciAobiA9IDA7IG4gPCBQQUdFX1NJWkUgLyBzaXplb2YoKmNzKSAtIDE7IG4r
KykKKwkJY3Nbbl0gPSBNSV9BUkJfQ0hFQ0s7CisJY3Nbbl0gPSBNSV9CQVRDSF9CVUZGRVJfRU5E
OworCWk5MTVfZ2VtX29iamVjdF9mbHVzaF9tYXAoc21va2UuYmF0Y2gpOworCWk5MTVfZ2VtX29i
amVjdF91bnBpbl9tYXAoc21va2UuYmF0Y2gpOworCisJaWYgKGlndF9saXZlX3Rlc3RfYmVnaW4o
JnQsIHNtb2tlLmd0LT5pOTE1LCBfX2Z1bmNfXywgImFsbCIpKSB7CisJCWVyciA9IC1FSU87CisJ
CWdvdG8gZXJyX2JhdGNoOworCX0KKworCWZvciAobiA9IDA7IG4gPCBzbW9rZS5uY29udGV4dDsg
bisrKSB7CisJCXNtb2tlLmNvbnRleHRzW25dID0ga2VybmVsX2NvbnRleHQoc21va2UuZ3QtPmk5
MTUpOworCQlpZiAoIXNtb2tlLmNvbnRleHRzW25dKQorCQkJZ290byBlcnJfY3R4OworCX0KKwor
CWZvciAobiA9IDA7IG4gPCBBUlJBWV9TSVpFKHBoYXNlKTsgbisrKSB7CisJCWVyciA9IHNtb2tl
X2NyZXNjZW5kbygmc21va2UsIHBoYXNlW25dKTsKKwkJaWYgKGVycikKKwkJCWdvdG8gZXJyX2N0
eDsKKworCQllcnIgPSBzbW9rZV9yYW5kb20oJnNtb2tlLCBwaGFzZVtuXSk7CisJCWlmIChlcnIp
CisJCQlnb3RvIGVycl9jdHg7CisJfQorCitlcnJfY3R4OgorCWlmIChpZ3RfbGl2ZV90ZXN0X2Vu
ZCgmdCkpCisJCWVyciA9IC1FSU87CisKKwlmb3IgKG4gPSAwOyBuIDwgc21va2UubmNvbnRleHQ7
IG4rKykgeworCQlpZiAoIXNtb2tlLmNvbnRleHRzW25dKQorCQkJYnJlYWs7CisJCWtlcm5lbF9j
b250ZXh0X2Nsb3NlKHNtb2tlLmNvbnRleHRzW25dKTsKKwl9CisKK2Vycl9iYXRjaDoKKwlpOTE1
X2dlbV9vYmplY3RfcHV0KHNtb2tlLmJhdGNoKTsKK2Vycl9mcmVlOgorCWtmcmVlKHNtb2tlLmNv
bnRleHRzKTsKKworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQgbm9wX3ZpcnR1YWxfZW5n
aW5lKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCisJCQkgICAgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICoqc2libGluZ3MsCisJCQkgICAgICB1bnNpZ25lZCBpbnQgbnNpYmxpbmcsCisJCQkgICAgICB1
bnNpZ25lZCBpbnQgbmN0eCwKKwkJCSAgICAgIHVuc2lnbmVkIGludCBmbGFncykKKyNkZWZpbmUg
Q0hBSU4gQklUKDApCit7CisJSUdUX1RJTUVPVVQoZW5kX3RpbWUpOworCXN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJlcXVlc3RbMTZdID0ge307CisJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eFsx
Nl07CisJc3RydWN0IGludGVsX2NvbnRleHQgKnZlWzE2XTsKKwl1bnNpZ25lZCBsb25nIG4sIHBy
aW1lLCBuYzsKKwlzdHJ1Y3QgaWd0X2xpdmVfdGVzdCB0OworCWt0aW1lX3QgdGltZXNbMl0gPSB7
fTsKKwlpbnQgZXJyOworCisJR0VNX0JVR19PTighbmN0eCB8fCBuY3R4ID4gQVJSQVlfU0laRShj
dHgpKTsKKworCWZvciAobiA9IDA7IG4gPCBuY3R4OyBuKyspIHsKKwkJY3R4W25dID0ga2VybmVs
X2NvbnRleHQoZ3QtPmk5MTUpOworCQlpZiAoIWN0eFtuXSkgeworCQkJZXJyID0gLUVOT01FTTsK
KwkJCW5jdHggPSBuOworCQkJZ290byBvdXQ7CisJCX0KKworCQl2ZVtuXSA9IGludGVsX3ZpcnR1
YWxfZW5naW5lX2NyZWF0ZShjdHhbbl0sIHNpYmxpbmdzLCBuc2libGluZyk7CisJCWlmIChJU19F
UlIodmVbbl0pKSB7CisJCQlrZXJuZWxfY29udGV4dF9jbG9zZShjdHhbbl0pOworCQkJZXJyID0g
UFRSX0VSUih2ZVtuXSk7CisJCQluY3R4ID0gbjsKKwkJCWdvdG8gb3V0OworCQl9CisKKwkJZXJy
ID0gaW50ZWxfY29udGV4dF9waW4odmVbbl0pOworCQlpZiAoZXJyKSB7CisJCQlpbnRlbF9jb250
ZXh0X3B1dCh2ZVtuXSk7CisJCQlrZXJuZWxfY29udGV4dF9jbG9zZShjdHhbbl0pOworCQkJbmN0
eCA9IG47CisJCQlnb3RvIG91dDsKKwkJfQorCX0KKworCWVyciA9IGlndF9saXZlX3Rlc3RfYmVn
aW4oJnQsIGd0LT5pOTE1LCBfX2Z1bmNfXywgdmVbMF0tPmVuZ2luZS0+bmFtZSk7CisJaWYgKGVy
cikKKwkJZ290byBvdXQ7CisKKwlmb3JfZWFjaF9wcmltZV9udW1iZXJfZnJvbShwcmltZSwgMSwg
ODE5MikgeworCQl0aW1lc1sxXSA9IGt0aW1lX2dldF9yYXcoKTsKKworCQlpZiAoZmxhZ3MgJiBD
SEFJTikgeworCQkJZm9yIChuYyA9IDA7IG5jIDwgbmN0eDsgbmMrKykgeworCQkJCWZvciAobiA9
IDA7IG4gPCBwcmltZTsgbisrKSB7CisJCQkJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCisJ
CQkJCXJxID0gaTkxNV9yZXF1ZXN0X2NyZWF0ZSh2ZVtuY10pOworCQkJCQlpZiAoSVNfRVJSKHJx
KSkgeworCQkJCQkJZXJyID0gUFRSX0VSUihycSk7CisJCQkJCQlnb3RvIG91dDsKKwkJCQkJfQor
CisJCQkJCWlmIChyZXF1ZXN0W25jXSkKKwkJCQkJCWk5MTVfcmVxdWVzdF9wdXQocmVxdWVzdFtu
Y10pOworCQkJCQlyZXF1ZXN0W25jXSA9IGk5MTVfcmVxdWVzdF9nZXQocnEpOworCQkJCQlpOTE1
X3JlcXVlc3RfYWRkKHJxKTsKKwkJCQl9CisJCQl9CisJCX0gZWxzZSB7CisJCQlmb3IgKG4gPSAw
OyBuIDwgcHJpbWU7IG4rKykgeworCQkJCWZvciAobmMgPSAwOyBuYyA8IG5jdHg7IG5jKyspIHsK
KwkJCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisKKwkJCQkJcnEgPSBpOTE1X3JlcXVlc3Rf
Y3JlYXRlKHZlW25jXSk7CisJCQkJCWlmIChJU19FUlIocnEpKSB7CisJCQkJCQllcnIgPSBQVFJf
RVJSKHJxKTsKKwkJCQkJCWdvdG8gb3V0OworCQkJCQl9CisKKwkJCQkJaWYgKHJlcXVlc3RbbmNd
KQorCQkJCQkJaTkxNV9yZXF1ZXN0X3B1dChyZXF1ZXN0W25jXSk7CisJCQkJCXJlcXVlc3RbbmNd
ID0gaTkxNV9yZXF1ZXN0X2dldChycSk7CisJCQkJCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCQkJ
CX0KKwkJCX0KKwkJfQorCisJCWZvciAobmMgPSAwOyBuYyA8IG5jdHg7IG5jKyspIHsKKwkJCWlm
IChpOTE1X3JlcXVlc3Rfd2FpdChyZXF1ZXN0W25jXSwgMCwgSFogLyAxMCkgPCAwKSB7CisJCQkJ
cHJfZXJyKCIlcyglcyk6IHdhaXQgZm9yICVsbHg6JWxsZCB0aW1lZCBvdXRcbiIsCisJCQkJICAg
ICAgIF9fZnVuY19fLCB2ZVswXS0+ZW5naW5lLT5uYW1lLAorCQkJCSAgICAgICByZXF1ZXN0W25j
XS0+ZmVuY2UuY29udGV4dCwKKwkJCQkgICAgICAgcmVxdWVzdFtuY10tPmZlbmNlLnNlcW5vKTsK
KworCQkJCUdFTV9UUkFDRSgiJXMoJXMpIGZhaWxlZCBhdCByZXF1ZXN0ICVsbHg6JWxsZFxuIiwK
KwkJCQkJICBfX2Z1bmNfXywgdmVbMF0tPmVuZ2luZS0+bmFtZSwKKwkJCQkJICByZXF1ZXN0W25j
XS0+ZmVuY2UuY29udGV4dCwKKwkJCQkJICByZXF1ZXN0W25jXS0+ZmVuY2Uuc2Vxbm8pOworCQkJ
CUdFTV9UUkFDRV9EVU1QKCk7CisJCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CisJCQkJYnJl
YWs7CisJCQl9CisJCX0KKworCQl0aW1lc1sxXSA9IGt0aW1lX3N1YihrdGltZV9nZXRfcmF3KCks
IHRpbWVzWzFdKTsKKwkJaWYgKHByaW1lID09IDEpCisJCQl0aW1lc1swXSA9IHRpbWVzWzFdOwor
CisJCWZvciAobmMgPSAwOyBuYyA8IG5jdHg7IG5jKyspIHsKKwkJCWk5MTVfcmVxdWVzdF9wdXQo
cmVxdWVzdFtuY10pOworCQkJcmVxdWVzdFtuY10gPSBOVUxMOworCQl9CisKKwkJaWYgKF9faWd0
X3RpbWVvdXQoZW5kX3RpbWUsIE5VTEwpKQorCQkJYnJlYWs7CisJfQorCisJZXJyID0gaWd0X2xp
dmVfdGVzdF9lbmQoJnQpOworCWlmIChlcnIpCisJCWdvdG8gb3V0OworCisJcHJfaW5mbygiUmVx
dWVzdHglZCBsYXRlbmNpZXMgb24gJXM6IDEgPSAlbGx1bnMsICVsdSA9ICVsbHVuc1xuIiwKKwkJ
bmN0eCwgdmVbMF0tPmVuZ2luZS0+bmFtZSwga3RpbWVfdG9fbnModGltZXNbMF0pLAorCQlwcmlt
ZSwgZGl2NjRfdTY0KGt0aW1lX3RvX25zKHRpbWVzWzFdKSwgcHJpbWUpKTsKKworb3V0OgorCWlm
IChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpCisJCWVyciA9IC1FSU87CisKKwlmb3IgKG5jID0g
MDsgbmMgPCBuY3R4OyBuYysrKSB7CisJCWk5MTVfcmVxdWVzdF9wdXQocmVxdWVzdFtuY10pOwor
CQlpbnRlbF9jb250ZXh0X3VucGluKHZlW25jXSk7CisJCWludGVsX2NvbnRleHRfcHV0KHZlW25j
XSk7CisJCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eFtuY10pOworCX0KKwlyZXR1cm4gZXJyOwor
fQorCitzdGF0aWMgaW50IGxpdmVfdmlydHVhbF9lbmdpbmUodm9pZCAqYXJnKQoreworCXN0cnVj
dCBpbnRlbF9ndCAqZ3QgPSBhcmc7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqc2libGluZ3Nb
TUFYX0VOR0lORV9JTlNUQU5DRSArIDFdOworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZTsKKwllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKKwl1bnNpZ25lZCBpbnQgY2xhc3MsIGluc3Q7
CisJaW50IGVycjsKKworCWlmIChVU0VTX0dVQ19TVUJNSVNTSU9OKGd0LT5pOTE1KSkKKwkJcmV0
dXJuIDA7CisKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwgaWQpIHsKKwkJZXJyID0gbm9w
X3ZpcnR1YWxfZW5naW5lKGd0LCAmZW5naW5lLCAxLCAxLCAwKTsKKwkJaWYgKGVycikgeworCQkJ
cHJfZXJyKCJGYWlsZWQgdG8gd3JhcCBlbmdpbmUgJXM6IGVycj0lZFxuIiwKKwkJCSAgICAgICBl
bmdpbmUtPm5hbWUsIGVycik7CisJCQlyZXR1cm4gZXJyOworCQl9CisJfQorCisJZm9yIChjbGFz
cyA9IDA7IGNsYXNzIDw9IE1BWF9FTkdJTkVfQ0xBU1M7IGNsYXNzKyspIHsKKwkJaW50IG5zaWJs
aW5nLCBuOworCisJCW5zaWJsaW5nID0gMDsKKwkJZm9yIChpbnN0ID0gMDsgaW5zdCA8PSBNQVhf
RU5HSU5FX0lOU1RBTkNFOyBpbnN0KyspIHsKKwkJCWlmICghZ3QtPmVuZ2luZV9jbGFzc1tjbGFz
c11baW5zdF0pCisJCQkJY29udGludWU7CisKKwkJCXNpYmxpbmdzW25zaWJsaW5nKytdID0gZ3Qt
PmVuZ2luZV9jbGFzc1tjbGFzc11baW5zdF07CisJCX0KKwkJaWYgKG5zaWJsaW5nIDwgMikKKwkJ
CWNvbnRpbnVlOworCisJCWZvciAobiA9IDE7IG4gPD0gbnNpYmxpbmcgKyAxOyBuKyspIHsKKwkJ
CWVyciA9IG5vcF92aXJ0dWFsX2VuZ2luZShndCwgc2libGluZ3MsIG5zaWJsaW5nLAorCQkJCQkJ
IG4sIDApOworCQkJaWYgKGVycikKKwkJCQlyZXR1cm4gZXJyOworCQl9CisKKwkJZXJyID0gbm9w
X3ZpcnR1YWxfZW5naW5lKGd0LCBzaWJsaW5ncywgbnNpYmxpbmcsIG4sIENIQUlOKTsKKwkJaWYg
KGVycikKKwkJCXJldHVybiBlcnI7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQg
bWFza192aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAorCQkJICAgICAgIHN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKipzaWJsaW5ncywKKwkJCSAgICAgICB1bnNpZ25lZCBpbnQgbnNp
YmxpbmcpCit7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdFtNQVhfRU5HSU5FX0lOU1RB
TkNFICsgMV07CisJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKKwlzdHJ1Y3QgaW50ZWxf
Y29udGV4dCAqdmU7CisJc3RydWN0IGlndF9saXZlX3Rlc3QgdDsKKwl1bnNpZ25lZCBpbnQgbjsK
KwlpbnQgZXJyOworCisJLyoKKwkgKiBDaGVjayB0aGF0IGJ5IHNldHRpbmcgdGhlIGV4ZWN1dGlv
biBtYXNrIG9uIGEgcmVxdWVzdCwgd2UgY2FuCisJICogcmVzdHJpY3QgaXQgdG8gb3VyIGRlc2ly
ZWQgZW5naW5lIHdpdGhpbiB0aGUgdmlydHVhbCBlbmdpbmUuCisJICovCisKKwljdHggPSBrZXJu
ZWxfY29udGV4dChndC0+aTkxNSk7CisJaWYgKCFjdHgpCisJCXJldHVybiAtRU5PTUVNOworCisJ
dmUgPSBpbnRlbF92aXJ0dWFsX2VuZ2luZV9jcmVhdGUoY3R4LCBzaWJsaW5ncywgbnNpYmxpbmcp
OworCWlmIChJU19FUlIodmUpKSB7CisJCWVyciA9IFBUUl9FUlIodmUpOworCQlnb3RvIG91dF9j
bG9zZTsKKwl9CisKKwllcnIgPSBpbnRlbF9jb250ZXh0X3Bpbih2ZSk7CisJaWYgKGVycikKKwkJ
Z290byBvdXRfcHV0OworCisJZXJyID0gaWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgZ3QtPmk5MTUs
IF9fZnVuY19fLCB2ZS0+ZW5naW5lLT5uYW1lKTsKKwlpZiAoZXJyKQorCQlnb3RvIG91dF91bnBp
bjsKKworCWZvciAobiA9IDA7IG4gPCBuc2libGluZzsgbisrKSB7CisJCXJlcXVlc3Rbbl0gPSBp
OTE1X3JlcXVlc3RfY3JlYXRlKHZlKTsKKwkJaWYgKElTX0VSUihyZXF1ZXN0W25dKSkgeworCQkJ
ZXJyID0gUFRSX0VSUihyZXF1ZXN0W25dKTsKKwkJCW5zaWJsaW5nID0gbjsKKwkJCWdvdG8gb3V0
OworCQl9CisKKwkJLyogUmV2ZXJzZSBvcmRlciBhcyBpdCdzIG1vcmUgbGlrZWx5IHRvIGJlIHVu
bmF0dXJhbCAqLworCQlyZXF1ZXN0W25dLT5leGVjdXRpb25fbWFzayA9IHNpYmxpbmdzW25zaWJs
aW5nIC0gbiAtIDFdLT5tYXNrOworCisJCWk5MTVfcmVxdWVzdF9nZXQocmVxdWVzdFtuXSk7CisJ
CWk5MTVfcmVxdWVzdF9hZGQocmVxdWVzdFtuXSk7CisJfQorCisJZm9yIChuID0gMDsgbiA8IG5z
aWJsaW5nOyBuKyspIHsKKwkJaWYgKGk5MTVfcmVxdWVzdF93YWl0KHJlcXVlc3Rbbl0sIDAsIEha
IC8gMTApIDwgMCkgeworCQkJcHJfZXJyKCIlcyglcyk6IHdhaXQgZm9yICVsbHg6JWxsZCB0aW1l
ZCBvdXRcbiIsCisJCQkgICAgICAgX19mdW5jX18sIHZlLT5lbmdpbmUtPm5hbWUsCisJCQkgICAg
ICAgcmVxdWVzdFtuXS0+ZmVuY2UuY29udGV4dCwKKwkJCSAgICAgICByZXF1ZXN0W25dLT5mZW5j
ZS5zZXFubyk7CisKKwkJCUdFTV9UUkFDRSgiJXMoJXMpIGZhaWxlZCBhdCByZXF1ZXN0ICVsbHg6
JWxsZFxuIiwKKwkJCQkgIF9fZnVuY19fLCB2ZS0+ZW5naW5lLT5uYW1lLAorCQkJCSAgcmVxdWVz
dFtuXS0+ZmVuY2UuY29udGV4dCwKKwkJCQkgIHJlcXVlc3Rbbl0tPmZlbmNlLnNlcW5vKTsKKwkJ
CUdFTV9UUkFDRV9EVU1QKCk7CisJCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKGd0KTsKKwkJCWVyciA9
IC1FSU87CisJCQlnb3RvIG91dDsKKwkJfQorCisJCWlmIChyZXF1ZXN0W25dLT5lbmdpbmUgIT0g
c2libGluZ3NbbnNpYmxpbmcgLSBuIC0gMV0pIHsKKwkJCXByX2VycigiRXhlY3V0ZWQgb24gd3Jv
bmcgc2libGluZyAnJXMnLCBleHBlY3RlZCAnJXMnXG4iLAorCQkJICAgICAgIHJlcXVlc3Rbbl0t
PmVuZ2luZS0+bmFtZSwKKwkJCSAgICAgICBzaWJsaW5nc1tuc2libGluZyAtIG4gLSAxXS0+bmFt
ZSk7CisJCQllcnIgPSAtRUlOVkFMOworCQkJZ290byBvdXQ7CisJCX0KKwl9CisKKwllcnIgPSBp
Z3RfbGl2ZV90ZXN0X2VuZCgmdCk7CitvdXQ6CisJaWYgKGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1
KSkKKwkJZXJyID0gLUVJTzsKKworCWZvciAobiA9IDA7IG4gPCBuc2libGluZzsgbisrKQorCQlp
OTE1X3JlcXVlc3RfcHV0KHJlcXVlc3Rbbl0pOworCitvdXRfdW5waW46CisJaW50ZWxfY29udGV4
dF91bnBpbih2ZSk7CitvdXRfcHV0OgorCWludGVsX2NvbnRleHRfcHV0KHZlKTsKK291dF9jbG9z
ZToKKwlrZXJuZWxfY29udGV4dF9jbG9zZShjdHgpOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRp
YyBpbnQgbGl2ZV92aXJ0dWFsX21hc2sodm9pZCAqYXJnKQoreworCXN0cnVjdCBpbnRlbF9ndCAq
Z3QgPSBhcmc7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqc2libGluZ3NbTUFYX0VOR0lORV9J
TlNUQU5DRSArIDFdOworCXVuc2lnbmVkIGludCBjbGFzcywgaW5zdDsKKwlpbnQgZXJyOworCisJ
aWYgKFVTRVNfR1VDX1NVQk1JU1NJT04oZ3QtPmk5MTUpKQorCQlyZXR1cm4gMDsKKworCWZvciAo
Y2xhc3MgPSAwOyBjbGFzcyA8PSBNQVhfRU5HSU5FX0NMQVNTOyBjbGFzcysrKSB7CisJCXVuc2ln
bmVkIGludCBuc2libGluZzsKKworCQluc2libGluZyA9IDA7CisJCWZvciAoaW5zdCA9IDA7IGlu
c3QgPD0gTUFYX0VOR0lORV9JTlNUQU5DRTsgaW5zdCsrKSB7CisJCQlpZiAoIWd0LT5lbmdpbmVf
Y2xhc3NbY2xhc3NdW2luc3RdKQorCQkJCWJyZWFrOworCisJCQlzaWJsaW5nc1tuc2libGluZysr
XSA9IGd0LT5lbmdpbmVfY2xhc3NbY2xhc3NdW2luc3RdOworCQl9CisJCWlmIChuc2libGluZyA8
IDIpCisJCQljb250aW51ZTsKKworCQllcnIgPSBtYXNrX3ZpcnR1YWxfZW5naW5lKGd0LCBzaWJs
aW5ncywgbnNpYmxpbmcpOworCQlpZiAoZXJyKQorCQkJcmV0dXJuIGVycjsKKwl9CisKKwlyZXR1
cm4gMDsKK30KKworc3RhdGljIGludCBwcmVzZXJ2ZWRfdmlydHVhbF9lbmdpbmUoc3RydWN0IGlu
dGVsX2d0ICpndCwKKwkJCQkgICAgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqKnNpYmxpbmdzLAor
CQkJCSAgICB1bnNpZ25lZCBpbnQgbnNpYmxpbmcpCit7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAq
bGFzdCA9IE5VTEw7CisJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKKwlzdHJ1Y3QgaW50
ZWxfY29udGV4dCAqdmU7CisJc3RydWN0IGk5MTVfdm1hICpzY3JhdGNoOworCXN0cnVjdCBpZ3Rf
bGl2ZV90ZXN0IHQ7CisJdW5zaWduZWQgaW50IG47CisJaW50IGVyciA9IDA7CisJdTMyICpjczsK
KworCWN0eCA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKKwlpZiAoIWN0eCkKKwkJcmV0dXJu
IC1FTk9NRU07CisKKwlzY3JhdGNoID0gaWd0X2NyZWF0ZV9zY3JhdGNoKHNpYmxpbmdzWzBdLT5n
dCk7CisJaWYgKElTX0VSUihzY3JhdGNoKSkgeworCQllcnIgPSBQVFJfRVJSKHNjcmF0Y2gpOwor
CQlnb3RvIG91dF9jbG9zZTsKKwl9CisKKwl2ZSA9IGludGVsX3ZpcnR1YWxfZW5naW5lX2NyZWF0
ZShjdHgsIHNpYmxpbmdzLCBuc2libGluZyk7CisJaWYgKElTX0VSUih2ZSkpIHsKKwkJZXJyID0g
UFRSX0VSUih2ZSk7CisJCWdvdG8gb3V0X3NjcmF0Y2g7CisJfQorCisJZXJyID0gaW50ZWxfY29u
dGV4dF9waW4odmUpOworCWlmIChlcnIpCisJCWdvdG8gb3V0X3B1dDsKKworCWVyciA9IGlndF9s
aXZlX3Rlc3RfYmVnaW4oJnQsIGd0LT5pOTE1LCBfX2Z1bmNfXywgdmUtPmVuZ2luZS0+bmFtZSk7
CisJaWYgKGVycikKKwkJZ290byBvdXRfdW5waW47CisKKwlmb3IgKG4gPSAwOyBuIDwgTlVNX0dQ
Ul9EVzsgbisrKSB7CisJCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSA9IHNpYmxpbmdz
W24gJSBuc2libGluZ107CisJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCisJCXJxID0gaTkx
NV9yZXF1ZXN0X2NyZWF0ZSh2ZSk7CisJCWlmIChJU19FUlIocnEpKSB7CisJCQllcnIgPSBQVFJf
RVJSKHJxKTsKKwkJCWdvdG8gb3V0X2VuZDsKKwkJfQorCisJCWk5MTVfcmVxdWVzdF9wdXQobGFz
dCk7CisJCWxhc3QgPSBpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKKworCQljcyA9IGludGVsX3Jpbmdf
YmVnaW4ocnEsIDgpOworCQlpZiAoSVNfRVJSKGNzKSkgeworCQkJaTkxNV9yZXF1ZXN0X2FkZChy
cSk7CisJCQllcnIgPSBQVFJfRVJSKGNzKTsKKwkJCWdvdG8gb3V0X2VuZDsKKwkJfQorCisJCSpj
cysrID0gTUlfU1RPUkVfUkVHSVNURVJfTUVNX0dFTjggfCBNSV9VU0VfR0dUVDsKKwkJKmNzKysg
PSBDU19HUFIoZW5naW5lLCBuKTsKKwkJKmNzKysgPSBpOTE1X2dndHRfb2Zmc2V0KHNjcmF0Y2gp
ICsgbiAqIHNpemVvZih1MzIpOworCQkqY3MrKyA9IDA7CisKKwkJKmNzKysgPSBNSV9MT0FEX1JF
R0lTVEVSX0lNTSgxKTsKKwkJKmNzKysgPSBDU19HUFIoZW5naW5lLCAobiArIDEpICUgTlVNX0dQ
Ul9EVyk7CisJCSpjcysrID0gbiArIDE7CisKKwkJKmNzKysgPSBNSV9OT09QOworCQlpbnRlbF9y
aW5nX2FkdmFuY2UocnEsIGNzKTsKKworCQkvKiBSZXN0cmljdCB0aGlzIHJlcXVlc3QgdG8gcnVu
IG9uIGEgcGFydGljdWxhciBlbmdpbmUgKi8KKwkJcnEtPmV4ZWN1dGlvbl9tYXNrID0gZW5naW5l
LT5tYXNrOworCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKwl9CisKKwlpZiAoaTkxNV9yZXF1ZXN0
X3dhaXQobGFzdCwgMCwgSFogLyA1KSA8IDApIHsKKwkJZXJyID0gLUVUSU1FOworCQlnb3RvIG91
dF9lbmQ7CisJfQorCisJY3MgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChzY3JhdGNoLT5vYmos
IEk5MTVfTUFQX1dCKTsKKwlpZiAoSVNfRVJSKGNzKSkgeworCQllcnIgPSBQVFJfRVJSKGNzKTsK
KwkJZ290byBvdXRfZW5kOworCX0KKworCWZvciAobiA9IDA7IG4gPCBOVU1fR1BSX0RXOyBuKysp
IHsKKwkJaWYgKGNzW25dICE9IG4pIHsKKwkJCXByX2VycigiSW5jb3JyZWN0IHZhbHVlWyVkXSBm
b3VuZCBmb3IgR1BSWyVkXVxuIiwKKwkJCSAgICAgICBjc1tuXSwgbik7CisJCQllcnIgPSAtRUlO
VkFMOworCQkJYnJlYWs7CisJCX0KKwl9CisKKwlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKHNj
cmF0Y2gtPm9iaik7CisKK291dF9lbmQ6CisJaWYgKGlndF9saXZlX3Rlc3RfZW5kKCZ0KSkKKwkJ
ZXJyID0gLUVJTzsKKwlpOTE1X3JlcXVlc3RfcHV0KGxhc3QpOworb3V0X3VucGluOgorCWludGVs
X2NvbnRleHRfdW5waW4odmUpOworb3V0X3B1dDoKKwlpbnRlbF9jb250ZXh0X3B1dCh2ZSk7Citv
dXRfc2NyYXRjaDoKKwlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmc2NyYXRjaCwgMCk7Citv
dXRfY2xvc2U6CisJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKKwlyZXR1cm4gZXJyOworfQor
CitzdGF0aWMgaW50IGxpdmVfdmlydHVhbF9wcmVzZXJ2ZWQodm9pZCAqYXJnKQoreworCXN0cnVj
dCBpbnRlbF9ndCAqZ3QgPSBhcmc7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqc2libGluZ3Nb
TUFYX0VOR0lORV9JTlNUQU5DRSArIDFdOworCXVuc2lnbmVkIGludCBjbGFzcywgaW5zdDsKKwor
CS8qCisJICogQ2hlY2sgdGhhdCB0aGUgY29udGV4dCBpbWFnZSByZXRhaW5zIG5vbi1wcml2aWxl
Z2VkICh1c2VyKSByZWdpc3RlcnMKKwkgKiBmcm9tIG9uZSBlbmdpbmUgdG8gdGhlIG5leHQuIEZv
ciB0aGlzIHdlIGNoZWNrIHRoYXQgdGhlIENTX0dQUgorCSAqIGFyZSBwcmVzZXJ2ZWQuCisJICov
CisKKwlpZiAoVVNFU19HVUNfU1VCTUlTU0lPTihndC0+aTkxNSkpCisJCXJldHVybiAwOworCisJ
LyogQXMgd2UgdXNlIENTX0dQUiB3ZSBjYW5ub3QgcnVuIGJlZm9yZSB0aGV5IGV4aXN0ZWQgb24g
YWxsIGVuZ2luZXMuICovCisJaWYgKElOVEVMX0dFTihndC0+aTkxNSkgPCA5KQorCQlyZXR1cm4g
MDsKKworCWZvciAoY2xhc3MgPSAwOyBjbGFzcyA8PSBNQVhfRU5HSU5FX0NMQVNTOyBjbGFzcysr
KSB7CisJCWludCBuc2libGluZywgZXJyOworCisJCW5zaWJsaW5nID0gMDsKKwkJZm9yIChpbnN0
ID0gMDsgaW5zdCA8PSBNQVhfRU5HSU5FX0lOU1RBTkNFOyBpbnN0KyspIHsKKwkJCWlmICghZ3Qt
PmVuZ2luZV9jbGFzc1tjbGFzc11baW5zdF0pCisJCQkJY29udGludWU7CisKKwkJCXNpYmxpbmdz
W25zaWJsaW5nKytdID0gZ3QtPmVuZ2luZV9jbGFzc1tjbGFzc11baW5zdF07CisJCX0KKwkJaWYg
KG5zaWJsaW5nIDwgMikKKwkJCWNvbnRpbnVlOworCisJCWVyciA9IHByZXNlcnZlZF92aXJ0dWFs
X2VuZ2luZShndCwgc2libGluZ3MsIG5zaWJsaW5nKTsKKwkJaWYgKGVycikKKwkJCXJldHVybiBl
cnI7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgYm9uZF92aXJ0dWFsX2VuZ2lu
ZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAorCQkJICAgICAgIHVuc2lnbmVkIGludCBjbGFzcywKKwkJ
CSAgICAgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICoqc2libGluZ3MsCisJCQkgICAgICAgdW5z
aWduZWQgaW50IG5zaWJsaW5nLAorCQkJICAgICAgIHVuc2lnbmVkIGludCBmbGFncykKKyNkZWZp
bmUgQk9ORF9TQ0hFRFVMRSBCSVQoMCkKK3sKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICptYXN0
ZXI7CisJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKKwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycVsxNl07CisJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisJc3RydWN0IGlndF9zcGlubmVy
IHNwaW47CisJdW5zaWduZWQgbG9uZyBuOworCWludCBlcnI7CisKKwkvKgorCSAqIEEgc2V0IG9m
IGJvbmRlZCByZXF1ZXN0cyBpcyBpbnRlbmRlZCB0byBiZSBydW4gY29uY3VycmVudGx5CisJICog
YWNyb3NzIGEgbnVtYmVyIG9mIGVuZ2luZXMuIFdlIHVzZSBvbmUgcmVxdWVzdCBwZXItZW5naW5l
CisJICogYW5kIGEgbWFnaWMgZmVuY2UgdG8gc2NoZWR1bGUgZWFjaCBvZiB0aGUgYm9uZGVkIHJl
cXVlc3RzCisJICogYXQgdGhlIHNhbWUgdGltZS4gQSBjb25zZXF1ZW5jZSBvZiBvdXIgY3VycmVu
dCBzY2hlZHVsZXIgaXMgdGhhdAorCSAqIHdlIG9ubHkgbW92ZSByZXF1ZXN0cyB0byB0aGUgSFcg
cmVhZHkgcXVldWUgd2hlbiB0aGUgcmVxdWVzdAorCSAqIGJlY29tZXMgcmVhZHksIHRoYXQgaXMg
d2hlbiBhbGwgb2YgaXRzIHByZXJlcXVpc2l0ZSBmZW5jZXMgaGF2ZQorCSAqIGJlZW4gc2lnbmFs
ZWQuIEFzIG9uZSBvZiB0aG9zZSBmZW5jZXMgaXMgdGhlIG1hc3RlciBzdWJtaXQgZmVuY2UsCisJ
ICogdGhlcmUgaXMgYSBkZWxheSBvbiBhbGwgc2Vjb25kYXJ5IGZlbmNlcyBhcyB0aGUgSFcgbWF5
IGJlCisJICogY3VycmVudGx5IGJ1c3kuIEVxdWFsbHksIGFzIGFsbCB0aGUgcmVxdWVzdHMgYXJl
IGluZGVwZW5kZW50LAorCSAqIHRoZXkgbWF5IGhhdmUgb3RoZXIgZmVuY2VzIHRoYXQgZGVsYXkg
aW5kaXZpZHVhbCByZXF1ZXN0CisJICogc3VibWlzc2lvbiB0byBIVy4gRXJnbywgd2UgZG8gbm90
IGd1YXJhbnRlZSB0aGF0IGFsbCByZXF1ZXN0cyBhcmUKKwkgKiBpbW1lZGlhdGVseSBzdWJtaXR0
ZWQgdG8gSFcgYXQgdGhlIHNhbWUgdGltZSwganVzdCB0aGF0IGlmIHRoZQorCSAqIHJ1bGVzIGFy
ZSBhYmlkZWQgYnksIHRoZXkgYXJlIHJlYWR5IGF0IHRoZSBzYW1lIHRpbWUgYXMgdGhlCisJICog
Zmlyc3QgaXMgc3VibWl0dGVkLiBVc2Vyc3BhY2UgY2FuIGVtYmVkIHNlbWFwaG9yZXMgaW4gaXRz
IGJhdGNoCisJICogdG8gZW5zdXJlIHBhcmFsbGVsIGV4ZWN1dGlvbiBvZiBpdHMgcGhhc2VzIGFz
IGl0IHJlcXVpcmVzLgorCSAqIFRob3VnaCBuYXR1cmFsbHkgaXQgZ2V0cyByZXF1ZXN0ZWQgdGhh
dCBwZXJoYXBzIHRoZSBzY2hlZHVsZXIgc2hvdWxkCisJICogdGFrZSBjYXJlIG9mIHBhcmFsbGVs
IGV4ZWN1dGlvbiwgZXZlbiBhY3Jvc3MgcHJlZW1wdGlvbiBldmVudHMgb24KKwkgKiBkaWZmZXJl
bnQgSFcuIChUaGUgcHJvcGVyIGFuc3dlciBpcyBvZiBjb3Vyc2UgImxhbGFsYWxhIi4pCisJICoK
KwkgKiBXaXRoIHRoZSBzdWJtaXQtZmVuY2UsIHdlIGhhdmUgaWRlbnRpZmllZCB0aHJlZSBwb3Nz
aWJsZSBwaGFzZXMKKwkgKiBvZiBzeW5jaHJvbmlzYXRpb24gZGVwZW5kaW5nIG9uIHRoZSBtYXN0
ZXIgZmVuY2U6IHF1ZXVlZCAobm90CisJICogcmVhZHkpLCBleGVjdXRpbmcsIGFuZCBzaWduYWxl
ZC4gVGhlIGZpcnN0IHR3byBhcmUgcXVpdGUgc2ltcGxlCisJICogYW5kIGNoZWNrZWQgYmVsb3cu
IEhvd2V2ZXIsIHRoZSBzaWduYWxlZCBtYXN0ZXIgZmVuY2UgaGFuZGxpbmcgaXMKKwkgKiBjb250
ZW50aW91cy4gQ3VycmVudGx5IHdlIGRvIG5vdCBkaXN0aW5ndWlzaCBiZXR3ZWVuIGEgc2lnbmFs
ZWQKKwkgKiBmZW5jZSBhbmQgYW4gZXhwaXJlZCBmZW5jZSwgYXMgb25jZSBzaWduYWxlZCBpdCBk
b2VzIG5vdCBjb252ZXkKKwkgKiBhbnkgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHByZXZpb3VzIGV4
ZWN1dGlvbi4gSXQgbWF5IGV2ZW4gYmUgZnJlZWQKKwkgKiBhbmQgaGVuY2UgY2hlY2tpbmcgbGF0
ZXIgaXQgbWF5IG5vdCBleGlzdCBhdCBhbGwuIEVyZ28gd2UgY3VycmVudGx5CisJICogZG8gbm90
IGFwcGx5IHRoZSBib25kaW5nIGNvbnN0cmFpbnQgZm9yIGFuIGFscmVhZHkgc2lnbmFsZWQgZmVu
Y2UsCisJICogYXMgb3VyIGV4cGVjdGF0aW9uIGlzIHRoYXQgaXQgc2hvdWxkIG5vdCBjb25zdHJh
aW4gdGhlIHNlY29uZGFyaWVzCisJICogYW5kIGlzIG91dHNpZGUgb2YgdGhlIHNjb3BlIG9mIHRo
ZSBib25kZWQgcmVxdWVzdCBBUEkgKGkuZS4gYWxsCisJICogdXNlcnNwYWNlIHJlcXVlc3RzIGFy
ZSBtZWFudCB0byBiZSBydW5uaW5nIGluIHBhcmFsbGVsKS4gQXMKKwkgKiBpdCBpbXBvc2VzIG5v
IGNvbnN0cmFpbnQsIGFuZCBpcyBlZmZlY3RpdmVseSBhIG5vLW9wLCB3ZSBkbyBub3QKKwkgKiBj
aGVjayBiZWxvdyBhcyBub3JtYWwgZXhlY3V0aW9uIGZsb3dzIGFyZSBjaGVja2VkIGV4dGVuc2l2
ZWx5IGFib3ZlLgorCSAqCisJICogWFhYIElzIHRoZSBkZWdlbmVyYXRlIGhhbmRsaW5nIG9mIHNp
Z25hbGVkIHN1Ym1pdCBmZW5jZXMgdGhlCisJICogZXhwZWN0ZWQgYmVoYXZpb3VyIGZvciB1c2Vy
cGFjZT8KKwkgKi8KKworCUdFTV9CVUdfT04obnNpYmxpbmcgPj0gQVJSQVlfU0laRShycSkgLSAx
KTsKKworCWlmIChpZ3Rfc3Bpbm5lcl9pbml0KCZzcGluLCBndCkpCisJCXJldHVybiAtRU5PTUVN
OworCisJY3R4ID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOworCWlmICghY3R4KSB7CisJCWVy
ciA9IC1FTk9NRU07CisJCWdvdG8gZXJyX3NwaW47CisJfQorCisJZXJyID0gMDsKKwlycVswXSA9
IEVSUl9QVFIoLUVOT01FTSk7CisJZm9yX2VhY2hfZW5naW5lKG1hc3RlciwgZ3QsIGlkKSB7CisJ
CXN0cnVjdCBpOTE1X3N3X2ZlbmNlIGZlbmNlID0ge307CisKKwkJaWYgKG1hc3Rlci0+Y2xhc3Mg
PT0gY2xhc3MpCisJCQljb250aW51ZTsKKworCQltZW1zZXRfcCgodm9pZCAqKXJxLCBFUlJfUFRS
KC1FSU5WQUwpLCBBUlJBWV9TSVpFKHJxKSk7CisKKwkJcnFbMF0gPSBzcGlubmVyX2NyZWF0ZV9y
ZXF1ZXN0KCZzcGluLCBjdHgsIG1hc3RlciwgTUlfTk9PUCk7CisJCWlmIChJU19FUlIocnFbMF0p
KSB7CisJCQllcnIgPSBQVFJfRVJSKHJxWzBdKTsKKwkJCWdvdG8gb3V0OworCQl9CisJCWk5MTVf
cmVxdWVzdF9nZXQocnFbMF0pOworCisJCWlmIChmbGFncyAmIEJPTkRfU0NIRURVTEUpIHsKKwkJ
CW9uc3RhY2tfZmVuY2VfaW5pdCgmZmVuY2UpOworCQkJZXJyID0gaTkxNV9zd19mZW5jZV9hd2Fp
dF9zd19mZW5jZV9nZnAoJnJxWzBdLT5zdWJtaXQsCisJCQkJCQkJICAgICAgICZmZW5jZSwKKwkJ
CQkJCQkgICAgICAgR0ZQX0tFUk5FTCk7CisJCX0KKworCQlpOTE1X3JlcXVlc3RfYWRkKHJxWzBd
KTsKKwkJaWYgKGVyciA8IDApCisJCQlnb3RvIG91dDsKKworCQlpZiAoIShmbGFncyAmIEJPTkRf
U0NIRURVTEUpICYmCisJCSAgICAhaWd0X3dhaXRfZm9yX3NwaW5uZXIoJnNwaW4sIHJxWzBdKSkg
eworCQkJZXJyID0gLUVJTzsKKwkJCWdvdG8gb3V0OworCQl9CisKKwkJZm9yIChuID0gMDsgbiA8
IG5zaWJsaW5nOyBuKyspIHsKKwkJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICp2ZTsKKworCQkJdmUg
PSBpbnRlbF92aXJ0dWFsX2VuZ2luZV9jcmVhdGUoY3R4LAorCQkJCQkJCSBzaWJsaW5ncywKKwkJ
CQkJCQkgbnNpYmxpbmcpOworCQkJaWYgKElTX0VSUih2ZSkpIHsKKwkJCQllcnIgPSBQVFJfRVJS
KHZlKTsKKwkJCQlvbnN0YWNrX2ZlbmNlX2ZpbmkoJmZlbmNlKTsKKwkJCQlnb3RvIG91dDsKKwkJ
CX0KKworCQkJZXJyID0gaW50ZWxfdmlydHVhbF9lbmdpbmVfYXR0YWNoX2JvbmQodmUtPmVuZ2lu
ZSwKKwkJCQkJCQkgICAgICAgbWFzdGVyLAorCQkJCQkJCSAgICAgICBzaWJsaW5nc1tuXSk7CisJ
CQlpZiAoZXJyKSB7CisJCQkJaW50ZWxfY29udGV4dF9wdXQodmUpOworCQkJCW9uc3RhY2tfZmVu
Y2VfZmluaSgmZmVuY2UpOworCQkJCWdvdG8gb3V0OworCQkJfQorCisJCQllcnIgPSBpbnRlbF9j
b250ZXh0X3Bpbih2ZSk7CisJCQlpbnRlbF9jb250ZXh0X3B1dCh2ZSk7CisJCQlpZiAoZXJyKSB7
CisJCQkJb25zdGFja19mZW5jZV9maW5pKCZmZW5jZSk7CisJCQkJZ290byBvdXQ7CisJCQl9CisK
KwkJCXJxW24gKyAxXSA9IGk5MTVfcmVxdWVzdF9jcmVhdGUodmUpOworCQkJaW50ZWxfY29udGV4
dF91bnBpbih2ZSk7CisJCQlpZiAoSVNfRVJSKHJxW24gKyAxXSkpIHsKKwkJCQllcnIgPSBQVFJf
RVJSKHJxW24gKyAxXSk7CisJCQkJb25zdGFja19mZW5jZV9maW5pKCZmZW5jZSk7CisJCQkJZ290
byBvdXQ7CisJCQl9CisJCQlpOTE1X3JlcXVlc3RfZ2V0KHJxW24gKyAxXSk7CisKKwkJCWVyciA9
IGk5MTVfcmVxdWVzdF9hd2FpdF9leGVjdXRpb24ocnFbbiArIDFdLAorCQkJCQkJCSAgICZycVsw
XS0+ZmVuY2UsCisJCQkJCQkJICAgdmUtPmVuZ2luZS0+Ym9uZF9leGVjdXRlKTsKKwkJCWk5MTVf
cmVxdWVzdF9hZGQocnFbbiArIDFdKTsKKwkJCWlmIChlcnIgPCAwKSB7CisJCQkJb25zdGFja19m
ZW5jZV9maW5pKCZmZW5jZSk7CisJCQkJZ290byBvdXQ7CisJCQl9CisJCX0KKwkJb25zdGFja19m
ZW5jZV9maW5pKCZmZW5jZSk7CisJCWludGVsX2VuZ2luZV9mbHVzaF9zdWJtaXNzaW9uKG1hc3Rl
cik7CisJCWlndF9zcGlubmVyX2VuZCgmc3Bpbik7CisKKwkJaWYgKGk5MTVfcmVxdWVzdF93YWl0
KHJxWzBdLCAwLCBIWiAvIDEwKSA8IDApIHsKKwkJCXByX2VycigiTWFzdGVyIHJlcXVlc3QgZGlk
IG5vdCBleGVjdXRlIChvbiAlcykhXG4iLAorCQkJICAgICAgIHJxWzBdLT5lbmdpbmUtPm5hbWUp
OworCQkJZXJyID0gLUVJTzsKKwkJCWdvdG8gb3V0OworCQl9CisKKwkJZm9yIChuID0gMDsgbiA8
IG5zaWJsaW5nOyBuKyspIHsKKwkJCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChycVtuICsgMV0sIDAs
CisJCQkJCSAgICAgIE1BWF9TQ0hFRFVMRV9USU1FT1VUKSA8IDApIHsKKwkJCQllcnIgPSAtRUlP
OworCQkJCWdvdG8gb3V0OworCQkJfQorCisJCQlpZiAocnFbbiArIDFdLT5lbmdpbmUgIT0gc2li
bGluZ3Nbbl0pIHsKKwkJCQlwcl9lcnIoIkJvbmRlZCByZXF1ZXN0IGRpZCBub3QgZXhlY3V0ZSBv
biB0YXJnZXQgZW5naW5lOiBleHBlY3RlZCAlcywgdXNlZCAlczsgbWFzdGVyIHdhcyAlc1xuIiwK
KwkJCQkgICAgICAgc2libGluZ3Nbbl0tPm5hbWUsCisJCQkJICAgICAgIHJxW24gKyAxXS0+ZW5n
aW5lLT5uYW1lLAorCQkJCSAgICAgICBycVswXS0+ZW5naW5lLT5uYW1lKTsKKwkJCQllcnIgPSAt
RUlOVkFMOworCQkJCWdvdG8gb3V0OworCQkJfQorCQl9CisKKwkJZm9yIChuID0gMDsgIUlTX0VS
UihycVtuXSk7IG4rKykKKwkJCWk5MTVfcmVxdWVzdF9wdXQocnFbbl0pOworCQlycVswXSA9IEVS
Ul9QVFIoLUVOT01FTSk7CisJfQorCitvdXQ6CisJZm9yIChuID0gMDsgIUlTX0VSUihycVtuXSk7
IG4rKykKKwkJaTkxNV9yZXF1ZXN0X3B1dChycVtuXSk7CisJaWYgKGlndF9mbHVzaF90ZXN0KGd0
LT5pOTE1KSkKKwkJZXJyID0gLUVJTzsKKworCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7Citl
cnJfc3BpbjoKKwlpZ3Rfc3Bpbm5lcl9maW5pKCZzcGluKTsKKwlyZXR1cm4gZXJyOworfQorCitz
dGF0aWMgaW50IGxpdmVfdmlydHVhbF9ib25kKHZvaWQgKmFyZykKK3sKKwlzdGF0aWMgY29uc3Qg
c3RydWN0IHBoYXNlIHsKKwkJY29uc3QgY2hhciAqbmFtZTsKKwkJdW5zaWduZWQgaW50IGZsYWdz
OworCX0gcGhhc2VzW10gPSB7CisJCXsgIiIsIDAgfSwKKwkJeyAic2NoZWR1bGUiLCBCT05EX1ND
SEVEVUxFIH0sCisJCXsgfSwKKwl9OworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CisJc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqc2libGluZ3NbTUFYX0VOR0lORV9JTlNUQU5DRSArIDFdOwor
CXVuc2lnbmVkIGludCBjbGFzcywgaW5zdDsKKwlpbnQgZXJyOworCisJaWYgKFVTRVNfR1VDX1NV
Qk1JU1NJT04oZ3QtPmk5MTUpKQorCQlyZXR1cm4gMDsKKworCWZvciAoY2xhc3MgPSAwOyBjbGFz
cyA8PSBNQVhfRU5HSU5FX0NMQVNTOyBjbGFzcysrKSB7CisJCWNvbnN0IHN0cnVjdCBwaGFzZSAq
cDsKKwkJaW50IG5zaWJsaW5nOworCisJCW5zaWJsaW5nID0gMDsKKwkJZm9yIChpbnN0ID0gMDsg
aW5zdCA8PSBNQVhfRU5HSU5FX0lOU1RBTkNFOyBpbnN0KyspIHsKKwkJCWlmICghZ3QtPmVuZ2lu
ZV9jbGFzc1tjbGFzc11baW5zdF0pCisJCQkJYnJlYWs7CisKKwkJCUdFTV9CVUdfT04obnNpYmxp
bmcgPT0gQVJSQVlfU0laRShzaWJsaW5ncykpOworCQkJc2libGluZ3NbbnNpYmxpbmcrK10gPSBn
dC0+ZW5naW5lX2NsYXNzW2NsYXNzXVtpbnN0XTsKKwkJfQorCQlpZiAobnNpYmxpbmcgPCAyKQor
CQkJY29udGludWU7CisKKwkJZm9yIChwID0gcGhhc2VzOyBwLT5uYW1lOyBwKyspIHsKKwkJCWVy
ciA9IGJvbmRfdmlydHVhbF9lbmdpbmUoZ3QsCisJCQkJCQkgIGNsYXNzLCBzaWJsaW5ncywgbnNp
YmxpbmcsCisJCQkJCQkgIHAtPmZsYWdzKTsKKwkJCWlmIChlcnIpIHsKKwkJCQlwcl9lcnIoIiVz
KCVzKTogZmFpbGVkIGNsYXNzPSVkLCBuc2libGluZz0lZCwgZXJyPSVkXG4iLAorCQkJCSAgICAg
ICBfX2Z1bmNfXywgcC0+bmFtZSwgY2xhc3MsIG5zaWJsaW5nLCBlcnIpOworCQkJCXJldHVybiBl
cnI7CisJCQl9CisJCX0KKwl9CisKKwlyZXR1cm4gMDsKK30KKworaW50IGludGVsX2V4ZWNsaXN0
c19saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3sKKwlzdGF0
aWMgY29uc3Qgc3RydWN0IGk5MTVfc3VidGVzdCB0ZXN0c1tdID0geworCQlTVUJURVNUKGxpdmVf
c2FuaXR5Y2hlY2spLAorCQlTVUJURVNUKGxpdmVfdW5saXRlX3N3aXRjaCksCisJCVNVQlRFU1Qo
bGl2ZV91bmxpdGVfcHJlZW1wdCksCisJCVNVQlRFU1QobGl2ZV90aW1lc2xpY2VfcHJlZW1wdCks
CisJCVNVQlRFU1QobGl2ZV90aW1lc2xpY2VfcXVldWUpLAorCQlTVUJURVNUKGxpdmVfYnVzeXdh
aXRfcHJlZW1wdCksCisJCVNVQlRFU1QobGl2ZV9wcmVlbXB0KSwKKwkJU1VCVEVTVChsaXZlX2xh
dGVfcHJlZW1wdCksCisJCVNVQlRFU1QobGl2ZV9ub3ByZWVtcHQpLAorCQlTVUJURVNUKGxpdmVf
cHJlZW1wdF9jYW5jZWwpLAorCQlTVUJURVNUKGxpdmVfc3VwcHJlc3Nfc2VsZl9wcmVlbXB0KSwK
KwkJU1VCVEVTVChsaXZlX3N1cHByZXNzX3dhaXRfcHJlZW1wdCksCisJCVNVQlRFU1QobGl2ZV9j
aGFpbl9wcmVlbXB0KSwKKwkJU1VCVEVTVChsaXZlX3ByZWVtcHRfZ2FuZyksCisJCVNVQlRFU1Qo
bGl2ZV9wcmVlbXB0X2hhbmcpLAorCQlTVUJURVNUKGxpdmVfcHJlZW1wdF90aW1lb3V0KSwKKwkJ
U1VCVEVTVChsaXZlX3ByZWVtcHRfc21va2UpLAorCQlTVUJURVNUKGxpdmVfdmlydHVhbF9lbmdp
bmUpLAorCQlTVUJURVNUKGxpdmVfdmlydHVhbF9tYXNrKSwKKwkJU1VCVEVTVChsaXZlX3ZpcnR1
YWxfcHJlc2VydmVkKSwKKwkJU1VCVEVTVChsaXZlX3ZpcnR1YWxfYm9uZCksCisJfTsKKworCWlm
ICghSEFTX0VYRUNMSVNUUyhpOTE1KSkKKwkJcmV0dXJuIDA7CisKKwlpZiAoaW50ZWxfZ3RfaXNf
d2VkZ2VkKCZpOTE1LT5ndCkpCisJCXJldHVybiAwOworCisJcmV0dXJuIGludGVsX2d0X2xpdmVf
c3VidGVzdHModGVzdHMsICZpOTE1LT5ndCk7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X2xyYy5jCmluZGV4IDU3MGM3ODkxYzYyZi4uYzNmNWY0NmZmY2I0IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwpAQCAtNCwxOCArNCw4IEBACiAgKiBDb3B5cmlnaHQg
wqkgMjAxOCBJbnRlbCBDb3Jwb3JhdGlvbgogICovCiAKLSNpbmNsdWRlIDxsaW51eC9wcmltZV9u
dW1iZXJzLmg+Ci0KLSNpbmNsdWRlICJnZW0vaTkxNV9nZW1fcG0uaCIKLSNpbmNsdWRlICJndC9p
bnRlbF9lbmdpbmVfaGVhcnRiZWF0LmgiCi0jaW5jbHVkZSAiZ3QvaW50ZWxfcmVzZXQuaCIKLQog
I2luY2x1ZGUgImk5MTVfc2VsZnRlc3QuaCIKLSNpbmNsdWRlICJzZWxmdGVzdHMvaTkxNV9yYW5k
b20uaCIKICNpbmNsdWRlICJzZWxmdGVzdHMvaWd0X2ZsdXNoX3Rlc3QuaCIKLSNpbmNsdWRlICJz
ZWxmdGVzdHMvaWd0X2xpdmVfdGVzdC5oIgotI2luY2x1ZGUgInNlbGZ0ZXN0cy9pZ3Rfc3Bpbm5l
ci5oIgotI2luY2x1ZGUgInNlbGZ0ZXN0cy9saWJfc3dfZmVuY2UuaCIKIAogI2luY2x1ZGUgImdl
bS9zZWxmdGVzdHMvaWd0X2dlbV91dGlscy5oIgogI2luY2x1ZGUgImdlbS9zZWxmdGVzdHMvbW9j
a19jb250ZXh0LmgiCkBAIC0yMywzMzI1ICsxMyw2IEBACiAjZGVmaW5lIENTX0dQUihlbmdpbmUs
IG4pICgoZW5naW5lKS0+bW1pb19iYXNlICsgMHg2MDAgKyAobikgKiA0KQogI2RlZmluZSBOVU1f
R1BSX0RXICgxNiAqIDIpIC8qIGVhY2ggR1BSIGlzIDIgZHdvcmRzICovCiAKLXN0YXRpYyBzdHJ1
Y3QgaTkxNV92bWEgKmNyZWF0ZV9zY3JhdGNoKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCi17Ci0Jc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKLQlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKLQlp
bnQgZXJyOwotCi0Jb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChndC0+aTkx
NSwgUEFHRV9TSVpFKTsKLQlpZiAoSVNfRVJSKG9iaikpCi0JCXJldHVybiBFUlJfQ0FTVChvYmop
OwotCi0JaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNoZV9jb2hlcmVuY3kob2JqLCBJOTE1X0NBQ0hJ
TkdfQ0FDSEVEKTsKLQotCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgJmd0LT5nZ3R0LT52
bSwgTlVMTCk7Ci0JaWYgKElTX0VSUih2bWEpKSB7Ci0JCWk5MTVfZ2VtX29iamVjdF9wdXQob2Jq
KTsKLQkJcmV0dXJuIHZtYTsKLQl9Ci0KLQllcnIgPSBpOTE1X3ZtYV9waW4odm1hLCAwLCAwLCBQ
SU5fR0xPQkFMKTsKLQlpZiAoZXJyKSB7Ci0JCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKLQkJ
cmV0dXJuIEVSUl9QVFIoZXJyKTsKLQl9Ci0KLQlyZXR1cm4gdm1hOwotfQotCi1zdGF0aWMgaW50
IGxpdmVfc2FuaXR5Y2hlY2sodm9pZCAqYXJnKQotewotCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBh
cmc7Ci0Jc3RydWN0IGk5MTVfZ2VtX2VuZ2luZXNfaXRlciBpdDsKLQlzdHJ1Y3QgaTkxNV9nZW1f
Y29udGV4dCAqY3R4OwotCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKLQlzdHJ1Y3QgaWd0X3Nw
aW5uZXIgc3BpbjsKLQlpbnQgZXJyID0gLUVOT01FTTsKLQotCWlmICghSEFTX0xPR0lDQUxfUklO
R19DT05URVhUUyhndC0+aTkxNSkpCi0JCXJldHVybiAwOwotCi0JaWYgKGlndF9zcGlubmVyX2lu
aXQoJnNwaW4sIGd0KSkKLQkJcmV0dXJuIC1FTk9NRU07Ci0KLQljdHggPSBrZXJuZWxfY29udGV4
dChndC0+aTkxNSk7Ci0JaWYgKCFjdHgpCi0JCWdvdG8gZXJyX3NwaW47Ci0KLQlmb3JfZWFjaF9n
ZW1fZW5naW5lKGNlLCBpOTE1X2dlbV9jb250ZXh0X2xvY2tfZW5naW5lcyhjdHgpLCBpdCkgewot
CQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKLQotCQlycSA9IGlndF9zcGlubmVyX2NyZWF0ZV9y
ZXF1ZXN0KCZzcGluLCBjZSwgTUlfTk9PUCk7Ci0JCWlmIChJU19FUlIocnEpKSB7Ci0JCQllcnIg
PSBQVFJfRVJSKHJxKTsKLQkJCWdvdG8gZXJyX2N0eDsKLQkJfQotCi0JCWk5MTVfcmVxdWVzdF9h
ZGQocnEpOwotCQlpZiAoIWlndF93YWl0X2Zvcl9zcGlubmVyKCZzcGluLCBycSkpIHsKLQkJCUdF
TV9UUkFDRSgic3Bpbm5lciBmYWlsZWQgdG8gc3RhcnRcbiIpOwotCQkJR0VNX1RSQUNFX0RVTVAo
KTsKLQkJCWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOwotCQkJZXJyID0gLUVJTzsKLQkJCWdvdG8g
ZXJyX2N0eDsKLQkJfQotCi0JCWlndF9zcGlubmVyX2VuZCgmc3Bpbik7Ci0JCWlmIChpZ3RfZmx1
c2hfdGVzdChndC0+aTkxNSkpIHsKLQkJCWVyciA9IC1FSU87Ci0JCQlnb3RvIGVycl9jdHg7Ci0J
CX0KLQl9Ci0KLQllcnIgPSAwOwotZXJyX2N0eDoKLQlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19l
bmdpbmVzKGN0eCk7Ci0Ja2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKLWVycl9zcGluOgotCWln
dF9zcGlubmVyX2ZpbmkoJnNwaW4pOwotCXJldHVybiBlcnI7Ci19Ci0KLXN0YXRpYyBpbnQgbGl2
ZV91bmxpdGVfcmVzdG9yZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBpbnQgcHJpbykKLXsKLQlzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0
eDsKLQllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKLQlzdHJ1Y3QgaWd0X3NwaW5uZXIgc3BpbjsK
LQlpbnQgZXJyID0gLUVOT01FTTsKLQotCS8qCi0JICogQ2hlY2sgdGhhdCB3ZSBjYW4gY29ycmVj
dGx5IGNvbnRleHQgc3dpdGNoIGJldHdlZW4gMiBpbnN0YW5jZXMKLQkgKiBvbiB0aGUgc2FtZSBl
bmdpbmUgZnJvbSB0aGUgc2FtZSBwYXJlbnQgY29udGV4dC4KLQkgKi8KLQotCWlmIChpZ3Rfc3Bp
bm5lcl9pbml0KCZzcGluLCBndCkpCi0JCXJldHVybiBlcnI7Ci0KLQljdHggPSBrZXJuZWxfY29u
dGV4dChndC0+aTkxNSk7Ci0JaWYgKCFjdHgpCi0JCWdvdG8gZXJyX3NwaW47Ci0KLQllcnIgPSAw
OwotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgewotCQlzdHJ1Y3QgaW50ZWxfY29u
dGV4dCAqY2VbMl0gPSB7fTsKLQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnFbMl07Ci0JCXN0cnVj
dCBpZ3RfbGl2ZV90ZXN0IHQ7Ci0JCWludCBuOwotCi0JCWlmIChwcmlvICYmICFpbnRlbF9lbmdp
bmVfaGFzX3ByZWVtcHRpb24oZW5naW5lKSkKLQkJCWNvbnRpbnVlOwotCi0JCWlmICghaW50ZWxf
ZW5naW5lX2Nhbl9zdG9yZV9kd29yZChlbmdpbmUpKQotCQkJY29udGludWU7Ci0KLQkJaWYgKGln
dF9saXZlX3Rlc3RfYmVnaW4oJnQsIGd0LT5pOTE1LCBfX2Z1bmNfXywgZW5naW5lLT5uYW1lKSkg
ewotCQkJZXJyID0gLUVJTzsKLQkJCWJyZWFrOwotCQl9Ci0KLQkJZm9yIChuID0gMDsgbiA8IEFS
UkFZX1NJWkUoY2UpOyBuKyspIHsKLQkJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICp0bXA7Ci0KLQkJ
CXRtcCA9IGludGVsX2NvbnRleHRfY3JlYXRlKGN0eCwgZW5naW5lKTsKLQkJCWlmIChJU19FUlIo
dG1wKSkgewotCQkJCWVyciA9IFBUUl9FUlIodG1wKTsKLQkJCQlnb3RvIGVycl9jZTsKLQkJCX0K
LQotCQkJZXJyID0gaW50ZWxfY29udGV4dF9waW4odG1wKTsKLQkJCWlmIChlcnIpIHsKLQkJCQlp
bnRlbF9jb250ZXh0X3B1dCh0bXApOwotCQkJCWdvdG8gZXJyX2NlOwotCQkJfQotCi0JCQkvKgot
CQkJICogU2V0dXAgdGhlIHBhaXIgb2YgY29udGV4dHMgc3VjaCB0aGF0IGlmIHdlCi0JCQkgKiBs
aXRlLXJlc3RvcmUgdXNpbmcgdGhlIFJJTkdfVEFJTCBmcm9tIGNlWzFdIGl0Ci0JCQkgKiB3aWxs
IGV4ZWN1dGUgZ2FyYmFnZSBmcm9tIGNlWzBdLT5yaW5nLgotCQkJICovCi0JCQltZW1zZXQodG1w
LT5yaW5nLT52YWRkciwKLQkJCSAgICAgICBQT0lTT05fSU5VU0UsIC8qIElQRUhSOiAweDVhNWE1
YTVhIFtodW5nIV0gKi8KLQkJCSAgICAgICB0bXAtPnJpbmctPnZtYS0+c2l6ZSk7Ci0KLQkJCWNl
W25dID0gdG1wOwotCQl9Ci0JCUdFTV9CVUdfT04oIWNlWzFdLT5yaW5nLT5zaXplKTsKLQkJaW50
ZWxfcmluZ19yZXNldChjZVsxXS0+cmluZywgY2VbMV0tPnJpbmctPnNpemUgLyAyKTsKLQkJbHJf
Y29udGV4dF91cGRhdGVfcmVnX3N0YXRlKGNlWzFdLCBlbmdpbmUpOwotCi0JCXJxWzBdID0gaWd0
X3NwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJnNwaW4sIGNlWzBdLCBNSV9BUkJfQ0hFQ0spOwotCQlp
ZiAoSVNfRVJSKHJxWzBdKSkgewotCQkJZXJyID0gUFRSX0VSUihycVswXSk7Ci0JCQlnb3RvIGVy
cl9jZTsKLQkJfQotCi0JCWk5MTVfcmVxdWVzdF9nZXQocnFbMF0pOwotCQlpOTE1X3JlcXVlc3Rf
YWRkKHJxWzBdKTsKLQkJR0VNX0JVR19PTihycVswXS0+cG9zdGZpeCA+IGNlWzFdLT5yaW5nLT5l
bWl0KTsKLQotCQlpZiAoIWlndF93YWl0X2Zvcl9zcGlubmVyKCZzcGluLCBycVswXSkpIHsKLQkJ
CWk5MTVfcmVxdWVzdF9wdXQocnFbMF0pOwotCQkJZ290byBlcnJfY2U7Ci0JCX0KLQotCQlycVsx
XSA9IGk5MTVfcmVxdWVzdF9jcmVhdGUoY2VbMV0pOwotCQlpZiAoSVNfRVJSKHJxWzFdKSkgewot
CQkJZXJyID0gUFRSX0VSUihycVsxXSk7Ci0JCQlpOTE1X3JlcXVlc3RfcHV0KHJxWzBdKTsKLQkJ
CWdvdG8gZXJyX2NlOwotCQl9Ci0KLQkJaWYgKCFwcmlvKSB7Ci0JCQkvKgotCQkJICogRW5zdXJl
IHdlIGRvIHRoZSBzd2l0Y2ggdG8gY2VbMV0gb24gY29tcGxldGlvbi4KLQkJCSAqCi0JCQkgKiBy
cVswXSBpcyBhbHJlYWR5IHN1Ym1pdHRlZCwgc28gdGhpcyBzaG91bGQgcmVkdWNlCi0JCQkgKiB0
byBhIG5vLW9wIChhIHdhaXQgb24gYSByZXF1ZXN0IG9uIHRoZSBzYW1lIGVuZ2luZQotCQkJICog
dXNlcyB0aGUgc3VibWl0IGZlbmNlLCBub3QgdGhlIGNvbXBsZXRpb24gZmVuY2UpLAotCQkJICog
YnV0IGl0IHdpbGwgaW5zdGFsbCBhIGRlcGVuZGVuY3kgb24gcnFbMV0gZm9yIHJxWzBdCi0JCQkg
KiB0aGF0IHdpbGwgcHJldmVudCB0aGUgcGFpciBiZWluZyByZW9yZGVyZWQgYnkKLQkJCSAqIHRp
bWVzbGljaW5nLgotCQkJICovCi0JCQlpOTE1X3JlcXVlc3RfYXdhaXRfZG1hX2ZlbmNlKHJxWzFd
LCAmcnFbMF0tPmZlbmNlKTsKLQkJfQotCi0JCWk5MTVfcmVxdWVzdF9nZXQocnFbMV0pOwotCQlp
OTE1X3JlcXVlc3RfYWRkKHJxWzFdKTsKLQkJR0VNX0JVR19PTihycVsxXS0+cG9zdGZpeCA8PSBy
cVswXS0+cG9zdGZpeCk7Ci0JCWk5MTVfcmVxdWVzdF9wdXQocnFbMF0pOwotCi0JCWlmIChwcmlv
KSB7Ci0JCQlzdHJ1Y3QgaTkxNV9zY2hlZF9hdHRyIGF0dHIgPSB7Ci0JCQkJLnByaW9yaXR5ID0g
cHJpbywKLQkJCX07Ci0KLQkJCS8qIEFsdGVybmF0aXZlbHkgcHJlZW1wdCB0aGUgc3Bpbm5lciB3
aXRoIGNlWzFdICovCi0JCQllbmdpbmUtPnNjaGVkdWxlKHJxWzFdLCAmYXR0cik7Ci0JCX0KLQot
CQkvKiBBbmQgc3dpdGNoIGJhY2sgdG8gY2VbMF0gZm9yIGdvb2QgbWVhc3VyZSAqLwotCQlycVsw
XSA9IGk5MTVfcmVxdWVzdF9jcmVhdGUoY2VbMF0pOwotCQlpZiAoSVNfRVJSKHJxWzBdKSkgewot
CQkJZXJyID0gUFRSX0VSUihycVswXSk7Ci0JCQlpOTE1X3JlcXVlc3RfcHV0KHJxWzFdKTsKLQkJ
CWdvdG8gZXJyX2NlOwotCQl9Ci0KLQkJaTkxNV9yZXF1ZXN0X2F3YWl0X2RtYV9mZW5jZShycVsw
XSwgJnJxWzFdLT5mZW5jZSk7Ci0JCWk5MTVfcmVxdWVzdF9nZXQocnFbMF0pOwotCQlpOTE1X3Jl
cXVlc3RfYWRkKHJxWzBdKTsKLQkJR0VNX0JVR19PTihycVswXS0+cG9zdGZpeCA+IHJxWzFdLT5w
b3N0Zml4KTsKLQkJaTkxNV9yZXF1ZXN0X3B1dChycVsxXSk7Ci0JCWk5MTVfcmVxdWVzdF9wdXQo
cnFbMF0pOwotCi1lcnJfY2U6Ci0JCXRhc2tsZXRfa2lsbCgmZW5naW5lLT5leGVjbGlzdHMudGFz
a2xldCk7IC8qIGZsdXNoIHN1Ym1pc3Npb24gKi8KLQkJaWd0X3NwaW5uZXJfZW5kKCZzcGluKTsK
LQkJZm9yIChuID0gMDsgbiA8IEFSUkFZX1NJWkUoY2UpOyBuKyspIHsKLQkJCWlmIChJU19FUlJf
T1JfTlVMTChjZVtuXSkpCi0JCQkJYnJlYWs7Ci0KLQkJCWludGVsX2NvbnRleHRfdW5waW4oY2Vb
bl0pOwotCQkJaW50ZWxfY29udGV4dF9wdXQoY2Vbbl0pOwotCQl9Ci0KLQkJaWYgKGlndF9saXZl
X3Rlc3RfZW5kKCZ0KSkKLQkJCWVyciA9IC1FSU87Ci0JCWlmIChlcnIpCi0JCQlicmVhazsKLQl9
Ci0KLQlrZXJuZWxfY29udGV4dF9jbG9zZShjdHgpOwotZXJyX3NwaW46Ci0JaWd0X3NwaW5uZXJf
ZmluaSgmc3Bpbik7Ci0JcmV0dXJuIGVycjsKLX0KLQotc3RhdGljIGludCBsaXZlX3VubGl0ZV9z
d2l0Y2godm9pZCAqYXJnKQotewotCXJldHVybiBsaXZlX3VubGl0ZV9yZXN0b3JlKGFyZywgMCk7
Ci19Ci0KLXN0YXRpYyBpbnQgbGl2ZV91bmxpdGVfcHJlZW1wdCh2b2lkICphcmcpCi17Ci0JcmV0
dXJuIGxpdmVfdW5saXRlX3Jlc3RvcmUoYXJnLCBJOTE1X1VTRVJfUFJJT1JJVFkoSTkxNV9QUklP
UklUWV9NQVgpKTsKLX0KLQotc3RhdGljIGludAotZW1pdF9zZW1hcGhvcmVfY2hhaW4oc3RydWN0
IGk5MTVfcmVxdWVzdCAqcnEsIHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCBpbnQgaWR4KQotewotCXUz
MiAqY3M7Ci0KLQljcyA9IGludGVsX3JpbmdfYmVnaW4ocnEsIDEwKTsKLQlpZiAoSVNfRVJSKGNz
KSkKLQkJcmV0dXJuIFBUUl9FUlIoY3MpOwotCi0JKmNzKysgPSBNSV9BUkJfT05fT0ZGIHwgTUlf
QVJCX0VOQUJMRTsKLQotCSpjcysrID0gTUlfU0VNQVBIT1JFX1dBSVQgfAotCQlNSV9TRU1BUEhP
UkVfR0xPQkFMX0dUVCB8Ci0JCU1JX1NFTUFQSE9SRV9QT0xMIHwKLQkJTUlfU0VNQVBIT1JFX1NB
RF9ORVFfU0REOwotCSpjcysrID0gMDsKLQkqY3MrKyA9IGk5MTVfZ2d0dF9vZmZzZXQodm1hKSAr
IDQgKiBpZHg7Ci0JKmNzKysgPSAwOwotCi0JaWYgKGlkeCA+IDApIHsKLQkJKmNzKysgPSBNSV9T
VE9SRV9EV09SRF9JTU1fR0VONCB8IE1JX1VTRV9HR1RUOwotCQkqY3MrKyA9IGk5MTVfZ2d0dF9v
ZmZzZXQodm1hKSArIDQgKiAoaWR4IC0gMSk7Ci0JCSpjcysrID0gMDsKLQkJKmNzKysgPSAxOwot
CX0gZWxzZSB7Ci0JCSpjcysrID0gTUlfTk9PUDsKLQkJKmNzKysgPSBNSV9OT09QOwotCQkqY3Mr
KyA9IE1JX05PT1A7Ci0JCSpjcysrID0gTUlfTk9PUDsKLQl9Ci0KLQkqY3MrKyA9IE1JX0FSQl9P
Tl9PRkYgfCBNSV9BUkJfRElTQUJMRTsKLQotCWludGVsX3JpbmdfYWR2YW5jZShycSwgY3MpOwot
CXJldHVybiAwOwotfQotCi1zdGF0aWMgc3RydWN0IGk5MTVfcmVxdWVzdCAqCi1zZW1hcGhvcmVf
cXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBzdHJ1Y3QgaTkxNV92bWEgKnZt
YSwgaW50IGlkeCkKLXsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwotCXN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxOwotCWludCBlcnI7Ci0KLQljdHggPSBrZXJuZWxfY29udGV4dChlbmdp
bmUtPmk5MTUpOwotCWlmICghY3R4KQotCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKLQotCXJx
ID0gaWd0X3JlcXVlc3RfYWxsb2MoY3R4LCBlbmdpbmUpOwotCWlmIChJU19FUlIocnEpKQotCQln
b3RvIG91dF9jdHg7Ci0KLQllcnIgPSAwOwotCWlmIChycS0+ZW5naW5lLT5lbWl0X2luaXRfYnJl
YWRjcnVtYikKLQkJZXJyID0gcnEtPmVuZ2luZS0+ZW1pdF9pbml0X2JyZWFkY3J1bWIocnEpOwot
CWlmIChlcnIgPT0gMCkKLQkJZXJyID0gZW1pdF9zZW1hcGhvcmVfY2hhaW4ocnEsIHZtYSwgaWR4
KTsKLQlpZiAoZXJyID09IDApCi0JCWk5MTVfcmVxdWVzdF9nZXQocnEpOwotCWk5MTVfcmVxdWVz
dF9hZGQocnEpOwotCWlmIChlcnIpCi0JCXJxID0gRVJSX1BUUihlcnIpOwotCi1vdXRfY3R4Ogot
CWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7Ci0JcmV0dXJuIHJxOwotfQotCi1zdGF0aWMgaW50
Ci1yZWxlYXNlX3F1ZXVlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKLQkgICAgICBz
dHJ1Y3QgaTkxNV92bWEgKnZtYSwKLQkgICAgICBpbnQgaWR4LCBpbnQgcHJpbykKLXsKLQlzdHJ1
Y3QgaTkxNV9zY2hlZF9hdHRyIGF0dHIgPSB7Ci0JCS5wcmlvcml0eSA9IHByaW8sCi0JfTsKLQlz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKLQl1MzIgKmNzOwotCi0JcnEgPSBpbnRlbF9lbmdpbmVf
Y3JlYXRlX2tlcm5lbF9yZXF1ZXN0KGVuZ2luZSk7Ci0JaWYgKElTX0VSUihycSkpCi0JCXJldHVy
biBQVFJfRVJSKHJxKTsKLQotCWNzID0gaW50ZWxfcmluZ19iZWdpbihycSwgNCk7Ci0JaWYgKElT
X0VSUihjcykpIHsKLQkJaTkxNV9yZXF1ZXN0X2FkZChycSk7Ci0JCXJldHVybiBQVFJfRVJSKGNz
KTsKLQl9Ci0KLQkqY3MrKyA9IE1JX1NUT1JFX0RXT1JEX0lNTV9HRU40IHwgTUlfVVNFX0dHVFQ7
Ci0JKmNzKysgPSBpOTE1X2dndHRfb2Zmc2V0KHZtYSkgKyA0ICogKGlkeCAtIDEpOwotCSpjcysr
ID0gMDsKLQkqY3MrKyA9IDE7Ci0KLQlpbnRlbF9yaW5nX2FkdmFuY2UocnEsIGNzKTsKLQotCWk5
MTVfcmVxdWVzdF9nZXQocnEpOwotCWk5MTVfcmVxdWVzdF9hZGQocnEpOwotCi0JbG9jYWxfYmhf
ZGlzYWJsZSgpOwotCWVuZ2luZS0+c2NoZWR1bGUocnEsICZhdHRyKTsKLQlsb2NhbF9iaF9lbmFi
bGUoKTsgLyoga2ljayB0YXNrbGV0ICovCi0KLQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKLQotCXJl
dHVybiAwOwotfQotCi1zdGF0aWMgaW50Ci1zbGljZV9zZW1hcGhvcmVfcXVldWUoc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqb3V0ZXIsCi0JCSAgICAgIHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAotCQkg
ICAgICBpbnQgY291bnQpCi17Ci0Jc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCXN0
cnVjdCBpOTE1X3JlcXVlc3QgKmhlYWQ7Ci0JZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7Ci0JaW50
IGVyciwgaSwgbiA9IDA7Ci0KLQloZWFkID0gc2VtYXBob3JlX3F1ZXVlKG91dGVyLCB2bWEsIG4r
Kyk7Ci0JaWYgKElTX0VSUihoZWFkKSkKLQkJcmV0dXJuIFBUUl9FUlIoaGVhZCk7Ci0KLQlmb3Jf
ZWFjaF9lbmdpbmUoZW5naW5lLCBvdXRlci0+Z3QsIGlkKSB7Ci0JCWZvciAoaSA9IDA7IGkgPCBj
b3VudDsgaSsrKSB7Ci0JCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKLQotCQkJcnEgPSBzZW1h
cGhvcmVfcXVldWUoZW5naW5lLCB2bWEsIG4rKyk7Ci0JCQlpZiAoSVNfRVJSKHJxKSkgewotCQkJ
CWVyciA9IFBUUl9FUlIocnEpOwotCQkJCWdvdG8gb3V0OwotCQkJfQotCi0JCQlpOTE1X3JlcXVl
c3RfcHV0KHJxKTsKLQkJfQotCX0KLQotCWVyciA9IHJlbGVhc2VfcXVldWUob3V0ZXIsIHZtYSwg
biwgSU5UX01BWCk7Ci0JaWYgKGVycikKLQkJZ290byBvdXQ7Ci0KLQlpZiAoaTkxNV9yZXF1ZXN0
X3dhaXQoaGVhZCwgMCwKLQkJCSAgICAgIDIgKiBSVU5USU1FX0lORk8ob3V0ZXItPmk5MTUpLT5u
dW1fZW5naW5lcyAqIChjb3VudCArIDIpICogKGNvdW50ICsgMykpIDwgMCkgewotCQlwcl9lcnIo
IkZhaWxlZCB0byBzbGljZSBhbG9uZyBzZW1hcGhvcmUgY2hhaW4gb2YgbGVuZ3RoICglZCwgJWQp
IVxuIiwKLQkJICAgICAgIGNvdW50LCBuKTsKLQkJR0VNX1RSQUNFX0RVTVAoKTsKLQkJaW50ZWxf
Z3Rfc2V0X3dlZGdlZChvdXRlci0+Z3QpOwotCQllcnIgPSAtRUlPOwotCX0KLQotb3V0OgotCWk5
MTVfcmVxdWVzdF9wdXQoaGVhZCk7Ci0JcmV0dXJuIGVycjsKLX0KLQotc3RhdGljIGludCBsaXZl
X3RpbWVzbGljZV9wcmVlbXB0KHZvaWQgKmFyZykKLXsKLQlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0g
YXJnOwotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7Ci0Jc3RydWN0IGk5MTVfdm1h
ICp2bWE7Ci0Jdm9pZCAqdmFkZHI7Ci0JaW50IGVyciA9IDA7Ci0JaW50IGNvdW50OwotCi0JLyoK
LQkgKiBJZiBhIHJlcXVlc3QgdGFrZXMgdG9vIGxvbmcsIHdlIHdvdWxkIGxpa2UgdG8gZ2l2ZSBv
dGhlciB1c2VycwotCSAqIGEgZmFpciBnbyBvbiB0aGUgR1BVLiBJbiBwYXJ0aWN1bGFyLCB1c2Vy
cyBtYXkgY3JlYXRlIGJhdGNoZXMKLQkgKiB0aGF0IHdhaXQgdXBvbiBleHRlcm5hbCBpbnB1dCwg
d2hlcmUgdGhhdCBpbnB1dCBtYXkgZXZlbiBiZQotCSAqIHN1cHBsaWVkIGJ5IGFub3RoZXIgR1BV
IGpvYi4gVG8gYXZvaWQgYmxvY2tpbmcgZm9yZXZlciwgd2UKLQkgKiBuZWVkIHRvIHByZWVtcHQg
dGhlIGN1cnJlbnQgdGFzayBhbmQgcmVwbGFjZSBpdCB3aXRoIGFub3RoZXIKLQkgKiByZWFkeSB0
YXNrLgotCSAqLwotCWlmICghSVNfQUNUSVZFKENPTkZJR19EUk1fSTkxNV9USU1FU0xJQ0VfRFVS
QVRJT04pKQotCQlyZXR1cm4gMDsKLQotCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50
ZXJuYWwoZ3QtPmk5MTUsIFBBR0VfU0laRSk7Ci0JaWYgKElTX0VSUihvYmopKQotCQlyZXR1cm4g
UFRSX0VSUihvYmopOwotCi0Jdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCAmZ3QtPmdndHQt
PnZtLCBOVUxMKTsKLQlpZiAoSVNfRVJSKHZtYSkpIHsKLQkJZXJyID0gUFRSX0VSUih2bWEpOwot
CQlnb3RvIGVycl9vYmo7Ci0JfQotCi0JdmFkZHIgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChv
YmosIEk5MTVfTUFQX1dDKTsKLQlpZiAoSVNfRVJSKHZhZGRyKSkgewotCQllcnIgPSBQVFJfRVJS
KHZhZGRyKTsKLQkJZ290byBlcnJfb2JqOwotCX0KLQotCWVyciA9IGk5MTVfdm1hX3Bpbih2bWEs
IDAsIDAsIFBJTl9HTE9CQUwpOwotCWlmIChlcnIpCi0JCWdvdG8gZXJyX21hcDsKLQotCWZvcl9l
YWNoX3ByaW1lX251bWJlcl9mcm9tKGNvdW50LCAxLCAxNikgewotCQlzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmU7Ci0JCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwotCi0JCWZvcl9lYWNo
X2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgewotCQkJaWYgKCFpbnRlbF9lbmdpbmVfaGFzX3ByZWVt
cHRpb24oZW5naW5lKSkKLQkJCQljb250aW51ZTsKLQotCQkJbWVtc2V0KHZhZGRyLCAwLCBQQUdF
X1NJWkUpOwotCi0JCQllcnIgPSBzbGljZV9zZW1hcGhvcmVfcXVldWUoZW5naW5lLCB2bWEsIGNv
dW50KTsKLQkJCWlmIChlcnIpCi0JCQkJZ290byBlcnJfcGluOwotCi0JCQlpZiAoaWd0X2ZsdXNo
X3Rlc3QoZ3QtPmk5MTUpKSB7Ci0JCQkJZXJyID0gLUVJTzsKLQkJCQlnb3RvIGVycl9waW47Ci0J
CQl9Ci0JCX0KLQl9Ci0KLWVycl9waW46Ci0JaTkxNV92bWFfdW5waW4odm1hKTsKLWVycl9tYXA6
Ci0JaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChvYmopOwotZXJyX29iajoKLQlpOTE1X2dlbV9v
YmplY3RfcHV0KG9iaik7Ci0JcmV0dXJuIGVycjsKLX0KLQotc3RhdGljIHN0cnVjdCBpOTE1X3Jl
cXVlc3QgKm5vcF9yZXF1ZXN0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKLXsKLQlz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKLQotCXJxID0gaW50ZWxfZW5naW5lX2NyZWF0ZV9rZXJu
ZWxfcmVxdWVzdChlbmdpbmUpOwotCWlmIChJU19FUlIocnEpKQotCQlyZXR1cm4gcnE7Ci0KLQlp
OTE1X3JlcXVlc3RfZ2V0KHJxKTsKLQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKLQotCXJldHVybiBy
cTsKLX0KLQotc3RhdGljIHZvaWQgd2FpdF9mb3Jfc3VibWl0KHN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmVuZ2luZSwKLQkJCSAgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKLXsKLQlkbyB7Ci0J
CWNvbmRfcmVzY2hlZCgpOwotCQlpbnRlbF9lbmdpbmVfZmx1c2hfc3VibWlzc2lvbihlbmdpbmUp
OwotCX0gd2hpbGUgKCFpOTE1X3JlcXVlc3RfaXNfYWN0aXZlKHJxKSk7Ci19Ci0KLXN0YXRpYyBs
b25nIHRpbWVzbGljZV90aHJlc2hvbGQoY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lKQotewotCXJldHVybiAyICogbXNlY3NfdG9famlmZmllc190aW1lb3V0KHRpbWVzbGljZShl
bmdpbmUpKSArIDE7Ci19Ci0KLXN0YXRpYyBpbnQgbGl2ZV90aW1lc2xpY2VfcXVldWUodm9pZCAq
YXJnKQotewotCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7Ci0Jc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iajsKLQlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7Ci0JZW51bSBp
bnRlbF9lbmdpbmVfaWQgaWQ7Ci0Jc3RydWN0IGk5MTVfdm1hICp2bWE7Ci0Jdm9pZCAqdmFkZHI7
Ci0JaW50IGVyciA9IDA7Ci0KLQkvKgotCSAqIE1ha2Ugc3VyZSB0aGF0IGV2ZW4gaWYgRUxTUFsw
XSBhbmQgRUxTUFsxXSBhcmUgZmlsbGVkIHdpdGgKLQkgKiB0aW1lc2xpY2luZyBiZXR3ZWVuIHRo
ZW0gZGlzYWJsZWQsIHdlICpkbyogZW5hYmxlIHRpbWVzbGljaW5nCi0JICogaWYgdGhlIHF1ZXVl
IGRlbWFuZHMgaXQuIChOb3JtYWxseSwgd2UgZG8gbm90IHN1Ym1pdCBpZgotCSAqIEVMU1BbMV0g
aXMgYWxyZWFkeSBvY2N1cGllZCwgc28gbXVzdCByZWx5IG9uIHRpbWVzbGljaW5nIHRvCi0JICog
ZWplY3QgRUxTUFswXSBpbiBmYXZvdXIgb2YgdGhlIHF1ZXVlLikKLQkgKi8KLQlpZiAoIUlTX0FD
VElWRShDT05GSUdfRFJNX0k5MTVfVElNRVNMSUNFX0RVUkFUSU9OKSkKLQkJcmV0dXJuIDA7Ci0K
LQlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGd0LT5pOTE1LCBQQUdFX1NJ
WkUpOwotCWlmIChJU19FUlIob2JqKSkKLQkJcmV0dXJuIFBUUl9FUlIob2JqKTsKLQotCXZtYSA9
IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgJmd0LT5nZ3R0LT52bSwgTlVMTCk7Ci0JaWYgKElTX0VS
Uih2bWEpKSB7Ci0JCWVyciA9IFBUUl9FUlIodm1hKTsKLQkJZ290byBlcnJfb2JqOwotCX0KLQot
CXZhZGRyID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAob2JqLCBJOTE1X01BUF9XQyk7Ci0JaWYg
KElTX0VSUih2YWRkcikpIHsKLQkJZXJyID0gUFRSX0VSUih2YWRkcik7Ci0JCWdvdG8gZXJyX29i
ajsKLQl9Ci0KLQllcnIgPSBpOTE1X3ZtYV9waW4odm1hLCAwLCAwLCBQSU5fR0xPQkFMKTsKLQlp
ZiAoZXJyKQotCQlnb3RvIGVycl9tYXA7Ci0KLQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwg
aWQpIHsKLQkJc3RydWN0IGk5MTVfc2NoZWRfYXR0ciBhdHRyID0gewotCQkJLnByaW9yaXR5ID0g
STkxNV9VU0VSX1BSSU9SSVRZKEk5MTVfUFJJT1JJVFlfTUFYKSwKLQkJfTsKLQkJc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnEsICpub3A7Ci0KLQkJaWYgKCFpbnRlbF9lbmdpbmVfaGFzX3ByZWVtcHRp
b24oZW5naW5lKSkKLQkJCWNvbnRpbnVlOwotCi0JCW1lbXNldCh2YWRkciwgMCwgUEFHRV9TSVpF
KTsKLQotCQkvKiBFTFNQWzBdOiBzZW1hcGhvcmUgd2FpdCAqLwotCQlycSA9IHNlbWFwaG9yZV9x
dWV1ZShlbmdpbmUsIHZtYSwgMCk7Ci0JCWlmIChJU19FUlIocnEpKSB7Ci0JCQllcnIgPSBQVFJf
RVJSKHJxKTsKLQkJCWdvdG8gZXJyX3BpbjsKLQkJfQotCQllbmdpbmUtPnNjaGVkdWxlKHJxLCAm
YXR0cik7Ci0JCXdhaXRfZm9yX3N1Ym1pdChlbmdpbmUsIHJxKTsKLQotCQkvKiBFTFNQWzFdOiBu
b3AgcmVxdWVzdCAqLwotCQlub3AgPSBub3BfcmVxdWVzdChlbmdpbmUpOwotCQlpZiAoSVNfRVJS
KG5vcCkpIHsKLQkJCWVyciA9IFBUUl9FUlIobm9wKTsKLQkJCWk5MTVfcmVxdWVzdF9wdXQocnEp
OwotCQkJZ290byBlcnJfcGluOwotCQl9Ci0JCXdhaXRfZm9yX3N1Ym1pdChlbmdpbmUsIG5vcCk7
Ci0JCWk5MTVfcmVxdWVzdF9wdXQobm9wKTsKLQotCQlHRU1fQlVHX09OKGk5MTVfcmVxdWVzdF9j
b21wbGV0ZWQocnEpKTsKLQkJR0VNX0JVR19PTihleGVjbGlzdHNfYWN0aXZlKCZlbmdpbmUtPmV4
ZWNsaXN0cykgIT0gcnEpOwotCi0JCS8qIFF1ZXVlOiBzZW1hcGhvcmUgc2lnbmFsLCBtYXRjaGlu
ZyBwcmlvcml0eSBhcyBzZW1hcGhvcmUgKi8KLQkJZXJyID0gcmVsZWFzZV9xdWV1ZShlbmdpbmUs
IHZtYSwgMSwgZWZmZWN0aXZlX3ByaW8ocnEpKTsKLQkJaWYgKGVycikgewotCQkJaTkxNV9yZXF1
ZXN0X3B1dChycSk7Ci0JCQlnb3RvIGVycl9waW47Ci0JCX0KLQotCQlpbnRlbF9lbmdpbmVfZmx1
c2hfc3VibWlzc2lvbihlbmdpbmUpOwotCQlpZiAoIVJFQURfT05DRShlbmdpbmUtPmV4ZWNsaXN0
cy50aW1lci5leHBpcmVzKSAmJgotCQkgICAgIWk5MTVfcmVxdWVzdF9jb21wbGV0ZWQocnEpKSB7
Ci0JCQlzdHJ1Y3QgZHJtX3ByaW50ZXIgcCA9Ci0JCQkJZHJtX2luZm9fcHJpbnRlcihndC0+aTkx
NS0+ZHJtLmRldik7Ci0KLQkJCUdFTV9UUkFDRV9FUlIoIiVzOiBGYWlsZWQgdG8gZW5hYmxlIHRp
bWVzbGljaW5nIVxuIiwKLQkJCQkgICAgICBlbmdpbmUtPm5hbWUpOwotCQkJaW50ZWxfZW5naW5l
X2R1bXAoZW5naW5lLCAmcCwKLQkJCQkJICAiJXNcbiIsIGVuZ2luZS0+bmFtZSk7Ci0JCQlHRU1f
VFJBQ0VfRFVNUCgpOwotCi0JCQltZW1zZXQodmFkZHIsIDB4ZmYsIFBBR0VfU0laRSk7Ci0JCQll
cnIgPSAtRUlOVkFMOwotCQl9Ci0KLQkJLyogVGltZXNsaWNlIGV2ZXJ5IGppZmZ5LCBzbyB3aXRo
aW4gMiB3ZSBzaG91bGQgc2lnbmFsICovCi0JCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChycSwgMCwg
dGltZXNsaWNlX3RocmVzaG9sZChlbmdpbmUpKSA8IDApIHsKLQkJCXN0cnVjdCBkcm1fcHJpbnRl
ciBwID0KLQkJCQlkcm1faW5mb19wcmludGVyKGd0LT5pOTE1LT5kcm0uZGV2KTsKLQotCQkJcHJf
ZXJyKCIlczogRmFpbGVkIHRvIHRpbWVzbGljZSBpbnRvIHF1ZXVlXG4iLAotCQkJICAgICAgIGVu
Z2luZS0+bmFtZSk7Ci0JCQlpbnRlbF9lbmdpbmVfZHVtcChlbmdpbmUsICZwLAotCQkJCQkgICIl
c1xuIiwgZW5naW5lLT5uYW1lKTsKLQotCQkJbWVtc2V0KHZhZGRyLCAweGZmLCBQQUdFX1NJWkUp
OwotCQkJZXJyID0gLUVJTzsKLQkJfQotCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKLQkJaWYgKGVy
cikKLQkJCWJyZWFrOwotCX0KLQotZXJyX3BpbjoKLQlpOTE1X3ZtYV91bnBpbih2bWEpOwotZXJy
X21hcDoKLQlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKG9iaik7Ci1lcnJfb2JqOgotCWk5MTVf
Z2VtX29iamVjdF9wdXQob2JqKTsKLQlyZXR1cm4gZXJyOwotfQotCi1zdGF0aWMgaW50IGxpdmVf
YnVzeXdhaXRfcHJlZW1wdCh2b2lkICphcmcpCi17Ci0Jc3RydWN0IGludGVsX2d0ICpndCA9IGFy
ZzsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4X2hpLCAqY3R4X2xvOwotCXN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
OwotCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwotCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwotCWlu
dCBlcnIgPSAtRU5PTUVNOwotCXUzMiAqbWFwOwotCi0JLyoKLQkgKiBWZXJpZnkgdGhhdCBldmVu
IHdpdGhvdXQgSEFTX0xPR0lDQUxfUklOR19QUkVFTVBUSU9OLCB3ZSBjYW4KLQkgKiBwcmVlbXB0
IHRoZSBidXN5d2FpdHMgdXNlZCB0byBzeW5jaHJvbmlzZSBiZXR3ZWVuIHJpbmdzLgotCSAqLwot
Ci0JY3R4X2hpID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOwotCWlmICghY3R4X2hpKQotCQly
ZXR1cm4gLUVOT01FTTsKLQljdHhfaGktPnNjaGVkLnByaW9yaXR5ID0KLQkJSTkxNV9VU0VSX1BS
SU9SSVRZKEk5MTVfQ09OVEVYVF9NQVhfVVNFUl9QUklPUklUWSk7Ci0KLQljdHhfbG8gPSBrZXJu
ZWxfY29udGV4dChndC0+aTkxNSk7Ci0JaWYgKCFjdHhfbG8pCi0JCWdvdG8gZXJyX2N0eF9oaTsK
LQljdHhfbG8tPnNjaGVkLnByaW9yaXR5ID0KLQkJSTkxNV9VU0VSX1BSSU9SSVRZKEk5MTVfQ09O
VEVYVF9NSU5fVVNFUl9QUklPUklUWSk7Ci0KLQlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRl
X2ludGVybmFsKGd0LT5pOTE1LCBQQUdFX1NJWkUpOwotCWlmIChJU19FUlIob2JqKSkgewotCQll
cnIgPSBQVFJfRVJSKG9iaik7Ci0JCWdvdG8gZXJyX2N0eF9sbzsKLQl9Ci0KLQltYXAgPSBpOTE1
X2dlbV9vYmplY3RfcGluX21hcChvYmosIEk5MTVfTUFQX1dDKTsKLQlpZiAoSVNfRVJSKG1hcCkp
IHsKLQkJZXJyID0gUFRSX0VSUihtYXApOwotCQlnb3RvIGVycl9vYmo7Ci0JfQotCi0Jdm1hID0g
aTkxNV92bWFfaW5zdGFuY2Uob2JqLCAmZ3QtPmdndHQtPnZtLCBOVUxMKTsKLQlpZiAoSVNfRVJS
KHZtYSkpIHsKLQkJZXJyID0gUFRSX0VSUih2bWEpOwotCQlnb3RvIGVycl9tYXA7Ci0JfQotCi0J
ZXJyID0gaTkxNV92bWFfcGluKHZtYSwgMCwgMCwgUElOX0dMT0JBTCk7Ci0JaWYgKGVycikKLQkJ
Z290byBlcnJfbWFwOwotCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7Ci0JCXN0
cnVjdCBpOTE1X3JlcXVlc3QgKmxvLCAqaGk7Ci0JCXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7Ci0J
CXUzMiAqY3M7Ci0KLQkJaWYgKCFpbnRlbF9lbmdpbmVfaGFzX3ByZWVtcHRpb24oZW5naW5lKSkK
LQkJCWNvbnRpbnVlOwotCi0JCWlmICghaW50ZWxfZW5naW5lX2Nhbl9zdG9yZV9kd29yZChlbmdp
bmUpKQotCQkJY29udGludWU7Ci0KLQkJaWYgKGlndF9saXZlX3Rlc3RfYmVnaW4oJnQsIGd0LT5p
OTE1LCBfX2Z1bmNfXywgZW5naW5lLT5uYW1lKSkgewotCQkJZXJyID0gLUVJTzsKLQkJCWdvdG8g
ZXJyX3ZtYTsKLQkJfQotCi0JCS8qCi0JCSAqIFdlIGNyZWF0ZSB0d28gcmVxdWVzdHMuIFRoZSBs
b3cgcHJpb3JpdHkgcmVxdWVzdAotCQkgKiBidXN5d2FpdHMgb24gYSBzZW1hcGhvcmUgKGluc2lk
ZSB0aGUgcmluZ2J1ZmZlciB3aGVyZQotCQkgKiBpcyBzaG91bGQgYmUgcHJlZW1wdGlibGUpIGFu
ZCB0aGUgaGlnaCBwcmlvcml0eSByZXF1ZXN0cwotCQkgKiB1c2VzIGEgTUlfU1RPUkVfRFdPUkRf
SU1NIHRvIHVwZGF0ZSB0aGUgc2VtYXBob3JlIHZhbHVlCi0JCSAqIGFsbG93aW5nIHRoZSBmaXJz
dCByZXF1ZXN0IHRvIGNvbXBsZXRlLiBJZiBwcmVlbXB0aW9uCi0JCSAqIGZhaWxzLCB3ZSBoYW5n
IGluc3RlYWQuCi0JCSAqLwotCi0JCWxvID0gaWd0X3JlcXVlc3RfYWxsb2MoY3R4X2xvLCBlbmdp
bmUpOwotCQlpZiAoSVNfRVJSKGxvKSkgewotCQkJZXJyID0gUFRSX0VSUihsbyk7Ci0JCQlnb3Rv
IGVycl92bWE7Ci0JCX0KLQotCQljcyA9IGludGVsX3JpbmdfYmVnaW4obG8sIDgpOwotCQlpZiAo
SVNfRVJSKGNzKSkgewotCQkJZXJyID0gUFRSX0VSUihjcyk7Ci0JCQlpOTE1X3JlcXVlc3RfYWRk
KGxvKTsKLQkJCWdvdG8gZXJyX3ZtYTsKLQkJfQotCi0JCSpjcysrID0gTUlfU1RPUkVfRFdPUkRf
SU1NX0dFTjQgfCBNSV9VU0VfR0dUVDsKLQkJKmNzKysgPSBpOTE1X2dndHRfb2Zmc2V0KHZtYSk7
Ci0JCSpjcysrID0gMDsKLQkJKmNzKysgPSAxOwotCi0JCS8qIFhYWCBEbyB3ZSBuZWVkIGEgZmx1
c2ggKyBpbnZhbGlkYXRlIGhlcmU/ICovCi0KLQkJKmNzKysgPSBNSV9TRU1BUEhPUkVfV0FJVCB8
Ci0JCQlNSV9TRU1BUEhPUkVfR0xPQkFMX0dUVCB8Ci0JCQlNSV9TRU1BUEhPUkVfUE9MTCB8Ci0J
CQlNSV9TRU1BUEhPUkVfU0FEX0VRX1NERDsKLQkJKmNzKysgPSAwOwotCQkqY3MrKyA9IGk5MTVf
Z2d0dF9vZmZzZXQodm1hKTsKLQkJKmNzKysgPSAwOwotCi0JCWludGVsX3JpbmdfYWR2YW5jZShs
bywgY3MpOwotCi0JCWk5MTVfcmVxdWVzdF9nZXQobG8pOwotCQlpOTE1X3JlcXVlc3RfYWRkKGxv
KTsKLQotCQlpZiAod2FpdF9mb3IoUkVBRF9PTkNFKCptYXApLCAxMCkpIHsKLQkJCWk5MTVfcmVx
dWVzdF9wdXQobG8pOwotCQkJZXJyID0gLUVUSU1FRE9VVDsKLQkJCWdvdG8gZXJyX3ZtYTsKLQkJ
fQotCi0JCS8qIExvdyBwcmlvcml0eSByZXF1ZXN0IHNob3VsZCBiZSBidXN5d2FpdGluZyBub3cg
Ki8KLQkJaWYgKGk5MTVfcmVxdWVzdF93YWl0KGxvLCAwLCAxKSAhPSAtRVRJTUUpIHsKLQkJCWk5
MTVfcmVxdWVzdF9wdXQobG8pOwotCQkJcHJfZXJyKCIlczogQnVzeXdhaXRpbmcgcmVxdWVzdCBk
aWQgbm90IVxuIiwKLQkJCSAgICAgICBlbmdpbmUtPm5hbWUpOwotCQkJZXJyID0gLUVJTzsKLQkJ
CWdvdG8gZXJyX3ZtYTsKLQkJfQotCi0JCWhpID0gaWd0X3JlcXVlc3RfYWxsb2MoY3R4X2hpLCBl
bmdpbmUpOwotCQlpZiAoSVNfRVJSKGhpKSkgewotCQkJZXJyID0gUFRSX0VSUihoaSk7Ci0JCQlp
OTE1X3JlcXVlc3RfcHV0KGxvKTsKLQkJCWdvdG8gZXJyX3ZtYTsKLQkJfQotCi0JCWNzID0gaW50
ZWxfcmluZ19iZWdpbihoaSwgNCk7Ci0JCWlmIChJU19FUlIoY3MpKSB7Ci0JCQllcnIgPSBQVFJf
RVJSKGNzKTsKLQkJCWk5MTVfcmVxdWVzdF9hZGQoaGkpOwotCQkJaTkxNV9yZXF1ZXN0X3B1dChs
byk7Ci0JCQlnb3RvIGVycl92bWE7Ci0JCX0KLQotCQkqY3MrKyA9IE1JX1NUT1JFX0RXT1JEX0lN
TV9HRU40IHwgTUlfVVNFX0dHVFQ7Ci0JCSpjcysrID0gaTkxNV9nZ3R0X29mZnNldCh2bWEpOwot
CQkqY3MrKyA9IDA7Ci0JCSpjcysrID0gMDsKLQotCQlpbnRlbF9yaW5nX2FkdmFuY2UoaGksIGNz
KTsKLQkJaTkxNV9yZXF1ZXN0X2FkZChoaSk7Ci0KLQkJaWYgKGk5MTVfcmVxdWVzdF93YWl0KGxv
LCAwLCBIWiAvIDUpIDwgMCkgewotCQkJc3RydWN0IGRybV9wcmludGVyIHAgPSBkcm1faW5mb19w
cmludGVyKGd0LT5pOTE1LT5kcm0uZGV2KTsKLQotCQkJcHJfZXJyKCIlczogRmFpbGVkIHRvIHBy
ZWVtcHQgc2VtYXBob3JlIGJ1c3l3YWl0IVxuIiwKLQkJCSAgICAgICBlbmdpbmUtPm5hbWUpOwot
Ci0JCQlpbnRlbF9lbmdpbmVfZHVtcChlbmdpbmUsICZwLCAiJXNcbiIsIGVuZ2luZS0+bmFtZSk7
Ci0JCQlHRU1fVFJBQ0VfRFVNUCgpOwotCi0JCQlpOTE1X3JlcXVlc3RfcHV0KGxvKTsKLQkJCWlu
dGVsX2d0X3NldF93ZWRnZWQoZ3QpOwotCQkJZXJyID0gLUVJTzsKLQkJCWdvdG8gZXJyX3ZtYTsK
LQkJfQotCQlHRU1fQlVHX09OKFJFQURfT05DRSgqbWFwKSk7Ci0JCWk5MTVfcmVxdWVzdF9wdXQo
bG8pOwotCi0JCWlmIChpZ3RfbGl2ZV90ZXN0X2VuZCgmdCkpIHsKLQkJCWVyciA9IC1FSU87Ci0J
CQlnb3RvIGVycl92bWE7Ci0JCX0KLQl9Ci0KLQllcnIgPSAwOwotZXJyX3ZtYToKLQlpOTE1X3Zt
YV91bnBpbih2bWEpOwotZXJyX21hcDoKLQlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKG9iaik7
Ci1lcnJfb2JqOgotCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKLWVycl9jdHhfbG86Ci0Ja2Vy
bmVsX2NvbnRleHRfY2xvc2UoY3R4X2xvKTsKLWVycl9jdHhfaGk6Ci0Ja2VybmVsX2NvbnRleHRf
Y2xvc2UoY3R4X2hpKTsKLQlyZXR1cm4gZXJyOwotfQotCi1zdGF0aWMgc3RydWN0IGk5MTVfcmVx
dWVzdCAqCi1zcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KHN0cnVjdCBpZ3Rfc3Bpbm5lciAqc3BpbiwK
LQkJICAgICAgIHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCi0JCSAgICAgICBzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUsCi0JCSAgICAgICB1MzIgYXJiKQotewotCXN0cnVjdCBp
bnRlbF9jb250ZXh0ICpjZTsKLQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKLQotCWNlID0gaTkx
NV9nZW1fY29udGV4dF9nZXRfZW5naW5lKGN0eCwgZW5naW5lLT5sZWdhY3lfaWR4KTsKLQlpZiAo
SVNfRVJSKGNlKSkKLQkJcmV0dXJuIEVSUl9DQVNUKGNlKTsKLQotCXJxID0gaWd0X3NwaW5uZXJf
Y3JlYXRlX3JlcXVlc3Qoc3BpbiwgY2UsIGFyYik7Ci0JaW50ZWxfY29udGV4dF9wdXQoY2UpOwot
CXJldHVybiBycTsKLX0KLQotc3RhdGljIGludCBsaXZlX3ByZWVtcHQodm9pZCAqYXJnKQotewot
CXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0
eF9oaSwgKmN0eF9sbzsKLQlzdHJ1Y3QgaWd0X3NwaW5uZXIgc3Bpbl9oaSwgc3Bpbl9sbzsKLQlz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7Ci0JZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7
Ci0JaW50IGVyciA9IC1FTk9NRU07Ci0KLQlpZiAoIUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1QVElP
TihndC0+aTkxNSkpCi0JCXJldHVybiAwOwotCi0JaWYgKCEoZ3QtPmk5MTUtPmNhcHMuc2NoZWR1
bGVyICYgSTkxNV9TQ0hFRFVMRVJfQ0FQX1BSRUVNUFRJT04pKQotCQlwcl9lcnIoIkxvZ2ljYWwg
cHJlZW1wdGlvbiBzdXBwb3J0ZWQsIGJ1dCBub3QgZXhwb3NlZFxuIik7Ci0KLQlpZiAoaWd0X3Nw
aW5uZXJfaW5pdCgmc3Bpbl9oaSwgZ3QpKQotCQlyZXR1cm4gLUVOT01FTTsKLQotCWlmIChpZ3Rf
c3Bpbm5lcl9pbml0KCZzcGluX2xvLCBndCkpCi0JCWdvdG8gZXJyX3NwaW5faGk7Ci0KLQljdHhf
aGkgPSBrZXJuZWxfY29udGV4dChndC0+aTkxNSk7Ci0JaWYgKCFjdHhfaGkpCi0JCWdvdG8gZXJy
X3NwaW5fbG87Ci0JY3R4X2hpLT5zY2hlZC5wcmlvcml0eSA9Ci0JCUk5MTVfVVNFUl9QUklPUklU
WShJOTE1X0NPTlRFWFRfTUFYX1VTRVJfUFJJT1JJVFkpOwotCi0JY3R4X2xvID0ga2VybmVsX2Nv
bnRleHQoZ3QtPmk5MTUpOwotCWlmICghY3R4X2xvKQotCQlnb3RvIGVycl9jdHhfaGk7Ci0JY3R4
X2xvLT5zY2hlZC5wcmlvcml0eSA9Ci0JCUk5MTVfVVNFUl9QUklPUklUWShJOTE1X0NPTlRFWFRf
TUlOX1VTRVJfUFJJT1JJVFkpOwotCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7
Ci0JCXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7Ci0JCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwot
Ci0JCWlmICghaW50ZWxfZW5naW5lX2hhc19wcmVlbXB0aW9uKGVuZ2luZSkpCi0JCQljb250aW51
ZTsKLQotCQlpZiAoaWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgZ3QtPmk5MTUsIF9fZnVuY19fLCBl
bmdpbmUtPm5hbWUpKSB7Ci0JCQllcnIgPSAtRUlPOwotCQkJZ290byBlcnJfY3R4X2xvOwotCQl9
Ci0KLQkJcnEgPSBzcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZzcGluX2xvLCBjdHhfbG8sIGVuZ2lu
ZSwKLQkJCQkJICAgIE1JX0FSQl9DSEVDSyk7Ci0JCWlmIChJU19FUlIocnEpKSB7Ci0JCQllcnIg
PSBQVFJfRVJSKHJxKTsKLQkJCWdvdG8gZXJyX2N0eF9sbzsKLQkJfQotCi0JCWk5MTVfcmVxdWVz
dF9hZGQocnEpOwotCQlpZiAoIWlndF93YWl0X2Zvcl9zcGlubmVyKCZzcGluX2xvLCBycSkpIHsK
LQkJCUdFTV9UUkFDRSgibG8gc3Bpbm5lciBmYWlsZWQgdG8gc3RhcnRcbiIpOwotCQkJR0VNX1RS
QUNFX0RVTVAoKTsKLQkJCWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOwotCQkJZXJyID0gLUVJTzsK
LQkJCWdvdG8gZXJyX2N0eF9sbzsKLQkJfQotCi0JCXJxID0gc3Bpbm5lcl9jcmVhdGVfcmVxdWVz
dCgmc3Bpbl9oaSwgY3R4X2hpLCBlbmdpbmUsCi0JCQkJCSAgICBNSV9BUkJfQ0hFQ0spOwotCQlp
ZiAoSVNfRVJSKHJxKSkgewotCQkJaWd0X3NwaW5uZXJfZW5kKCZzcGluX2xvKTsKLQkJCWVyciA9
IFBUUl9FUlIocnEpOwotCQkJZ290byBlcnJfY3R4X2xvOwotCQl9Ci0KLQkJaTkxNV9yZXF1ZXN0
X2FkZChycSk7Ci0JCWlmICghaWd0X3dhaXRfZm9yX3NwaW5uZXIoJnNwaW5faGksIHJxKSkgewot
CQkJR0VNX1RSQUNFKCJoaSBzcGlubmVyIGZhaWxlZCB0byBzdGFydFxuIik7Ci0JCQlHRU1fVFJB
Q0VfRFVNUCgpOwotCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7Ci0JCQllcnIgPSAtRUlPOwot
CQkJZ290byBlcnJfY3R4X2xvOwotCQl9Ci0KLQkJaWd0X3NwaW5uZXJfZW5kKCZzcGluX2hpKTsK
LQkJaWd0X3NwaW5uZXJfZW5kKCZzcGluX2xvKTsKLQotCQlpZiAoaWd0X2xpdmVfdGVzdF9lbmQo
JnQpKSB7Ci0JCQllcnIgPSAtRUlPOwotCQkJZ290byBlcnJfY3R4X2xvOwotCQl9Ci0JfQotCi0J
ZXJyID0gMDsKLWVycl9jdHhfbG86Ci0Ja2VybmVsX2NvbnRleHRfY2xvc2UoY3R4X2xvKTsKLWVy
cl9jdHhfaGk6Ci0Ja2VybmVsX2NvbnRleHRfY2xvc2UoY3R4X2hpKTsKLWVycl9zcGluX2xvOgot
CWlndF9zcGlubmVyX2ZpbmkoJnNwaW5fbG8pOwotZXJyX3NwaW5faGk6Ci0JaWd0X3NwaW5uZXJf
ZmluaSgmc3Bpbl9oaSk7Ci0JcmV0dXJuIGVycjsKLX0KLQotc3RhdGljIGludCBsaXZlX2xhdGVf
cHJlZW1wdCh2b2lkICphcmcpCi17Ci0Jc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKLQlzdHJ1
Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4X2hpLCAqY3R4X2xvOwotCXN0cnVjdCBpZ3Rfc3Bpbm5l
ciBzcGluX2hpLCBzcGluX2xvOwotCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQlz
dHJ1Y3QgaTkxNV9zY2hlZF9hdHRyIGF0dHIgPSB7fTsKLQllbnVtIGludGVsX2VuZ2luZV9pZCBp
ZDsKLQlpbnQgZXJyID0gLUVOT01FTTsKLQotCWlmICghSEFTX0xPR0lDQUxfUklOR19QUkVFTVBU
SU9OKGd0LT5pOTE1KSkKLQkJcmV0dXJuIDA7Ci0KLQlpZiAoaWd0X3NwaW5uZXJfaW5pdCgmc3Bp
bl9oaSwgZ3QpKQotCQlyZXR1cm4gLUVOT01FTTsKLQotCWlmIChpZ3Rfc3Bpbm5lcl9pbml0KCZz
cGluX2xvLCBndCkpCi0JCWdvdG8gZXJyX3NwaW5faGk7Ci0KLQljdHhfaGkgPSBrZXJuZWxfY29u
dGV4dChndC0+aTkxNSk7Ci0JaWYgKCFjdHhfaGkpCi0JCWdvdG8gZXJyX3NwaW5fbG87Ci0KLQlj
dHhfbG8gPSBrZXJuZWxfY29udGV4dChndC0+aTkxNSk7Ci0JaWYgKCFjdHhfbG8pCi0JCWdvdG8g
ZXJyX2N0eF9oaTsKLQotCS8qIE1ha2Ugc3VyZSBjdHhfbG8gc3RheXMgYmVmb3JlIGN0eF9oaSB1
bnRpbCB3ZSB0cmlnZ2VyIHByZWVtcHRpb24uICovCi0JY3R4X2xvLT5zY2hlZC5wcmlvcml0eSA9
IEk5MTVfVVNFUl9QUklPUklUWSgxKTsKLQotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBp
ZCkgewotCQlzdHJ1Y3QgaWd0X2xpdmVfdGVzdCB0OwotCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
cTsKLQotCQlpZiAoIWludGVsX2VuZ2luZV9oYXNfcHJlZW1wdGlvbihlbmdpbmUpKQotCQkJY29u
dGludWU7Ci0KLQkJaWYgKGlndF9saXZlX3Rlc3RfYmVnaW4oJnQsIGd0LT5pOTE1LCBfX2Z1bmNf
XywgZW5naW5lLT5uYW1lKSkgewotCQkJZXJyID0gLUVJTzsKLQkJCWdvdG8gZXJyX2N0eF9sbzsK
LQkJfQotCi0JCXJxID0gc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmc3Bpbl9sbywgY3R4X2xvLCBl
bmdpbmUsCi0JCQkJCSAgICBNSV9BUkJfQ0hFQ0spOwotCQlpZiAoSVNfRVJSKHJxKSkgewotCQkJ
ZXJyID0gUFRSX0VSUihycSk7Ci0JCQlnb3RvIGVycl9jdHhfbG87Ci0JCX0KLQotCQlpOTE1X3Jl
cXVlc3RfYWRkKHJxKTsKLQkJaWYgKCFpZ3Rfd2FpdF9mb3Jfc3Bpbm5lcigmc3Bpbl9sbywgcnEp
KSB7Ci0JCQlwcl9lcnIoIkZpcnN0IGNvbnRleHQgZmFpbGVkIHRvIHN0YXJ0XG4iKTsKLQkJCWdv
dG8gZXJyX3dlZGdlZDsKLQkJfQotCi0JCXJxID0gc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmc3Bp
bl9oaSwgY3R4X2hpLCBlbmdpbmUsCi0JCQkJCSAgICBNSV9OT09QKTsKLQkJaWYgKElTX0VSUihy
cSkpIHsKLQkJCWlndF9zcGlubmVyX2VuZCgmc3Bpbl9sbyk7Ci0JCQllcnIgPSBQVFJfRVJSKHJx
KTsKLQkJCWdvdG8gZXJyX2N0eF9sbzsKLQkJfQotCi0JCWk5MTVfcmVxdWVzdF9hZGQocnEpOwot
CQlpZiAoaWd0X3dhaXRfZm9yX3NwaW5uZXIoJnNwaW5faGksIHJxKSkgewotCQkJcHJfZXJyKCJT
ZWNvbmQgY29udGV4dCBvdmVydG9vayBmaXJzdD9cbiIpOwotCQkJZ290byBlcnJfd2VkZ2VkOwot
CQl9Ci0KLQkJYXR0ci5wcmlvcml0eSA9IEk5MTVfVVNFUl9QUklPUklUWShJOTE1X1BSSU9SSVRZ
X01BWCk7Ci0JCWVuZ2luZS0+c2NoZWR1bGUocnEsICZhdHRyKTsKLQotCQlpZiAoIWlndF93YWl0
X2Zvcl9zcGlubmVyKCZzcGluX2hpLCBycSkpIHsKLQkJCXByX2VycigiSGlnaCBwcmlvcml0eSBj
b250ZXh0IGZhaWxlZCB0byBwcmVlbXB0IHRoZSBsb3cgcHJpb3JpdHkgY29udGV4dFxuIik7Ci0J
CQlHRU1fVFJBQ0VfRFVNUCgpOwotCQkJZ290byBlcnJfd2VkZ2VkOwotCQl9Ci0KLQkJaWd0X3Nw
aW5uZXJfZW5kKCZzcGluX2hpKTsKLQkJaWd0X3NwaW5uZXJfZW5kKCZzcGluX2xvKTsKLQotCQlp
ZiAoaWd0X2xpdmVfdGVzdF9lbmQoJnQpKSB7Ci0JCQllcnIgPSAtRUlPOwotCQkJZ290byBlcnJf
Y3R4X2xvOwotCQl9Ci0JfQotCi0JZXJyID0gMDsKLWVycl9jdHhfbG86Ci0Ja2VybmVsX2NvbnRl
eHRfY2xvc2UoY3R4X2xvKTsKLWVycl9jdHhfaGk6Ci0Ja2VybmVsX2NvbnRleHRfY2xvc2UoY3R4
X2hpKTsKLWVycl9zcGluX2xvOgotCWlndF9zcGlubmVyX2ZpbmkoJnNwaW5fbG8pOwotZXJyX3Nw
aW5faGk6Ci0JaWd0X3NwaW5uZXJfZmluaSgmc3Bpbl9oaSk7Ci0JcmV0dXJuIGVycjsKLQotZXJy
X3dlZGdlZDoKLQlpZ3Rfc3Bpbm5lcl9lbmQoJnNwaW5faGkpOwotCWlndF9zcGlubmVyX2VuZCgm
c3Bpbl9sbyk7Ci0JaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7Ci0JZXJyID0gLUVJTzsKLQlnb3Rv
IGVycl9jdHhfbG87Ci19Ci0KLXN0cnVjdCBwcmVlbXB0X2NsaWVudCB7Ci0Jc3RydWN0IGlndF9z
cGlubmVyIHNwaW47Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKLX07Ci0KLXN0YXRp
YyBpbnQgcHJlZW1wdF9jbGllbnRfaW5pdChzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBzdHJ1Y3QgcHJl
ZW1wdF9jbGllbnQgKmMpCi17Ci0JYy0+Y3R4ID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOwot
CWlmICghYy0+Y3R4KQotCQlyZXR1cm4gLUVOT01FTTsKLQotCWlmIChpZ3Rfc3Bpbm5lcl9pbml0
KCZjLT5zcGluLCBndCkpCi0JCWdvdG8gZXJyX2N0eDsKLQotCXJldHVybiAwOwotCi1lcnJfY3R4
OgotCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGMtPmN0eCk7Ci0JcmV0dXJuIC1FTk9NRU07Ci19Ci0K
LXN0YXRpYyB2b2lkIHByZWVtcHRfY2xpZW50X2Zpbmkoc3RydWN0IHByZWVtcHRfY2xpZW50ICpj
KQotewotCWlndF9zcGlubmVyX2ZpbmkoJmMtPnNwaW4pOwotCWtlcm5lbF9jb250ZXh0X2Nsb3Nl
KGMtPmN0eCk7Ci19Ci0KLXN0YXRpYyBpbnQgbGl2ZV9ub3ByZWVtcHQodm9pZCAqYXJnKQotewot
CXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7Ci0Jc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lOwotCXN0cnVjdCBwcmVlbXB0X2NsaWVudCBhLCBiOwotCWVudW0gaW50ZWxfZW5naW5lX2lk
IGlkOwotCWludCBlcnIgPSAtRU5PTUVNOwotCi0JLyoKLQkgKiBWZXJpZnkgdGhhdCB3ZSBjYW4g
ZGlzYWJsZSBwcmVlbXB0aW9uIGZvciBhbiBpbmRpdmlkdWFsIHJlcXVlc3QKLQkgKiB0aGF0IG1h
eSBiZSBiZWluZyBvYnNlcnZlZCBhbmQgbm90IHdhbnQgdG8gYmUgaW50ZXJydXB0ZWQuCi0JICov
Ci0KLQlpZiAoIUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1QVElPTihndC0+aTkxNSkpCi0JCXJldHVy
biAwOwotCi0JaWYgKHByZWVtcHRfY2xpZW50X2luaXQoZ3QsICZhKSkKLQkJcmV0dXJuIC1FTk9N
RU07Ci0JaWYgKHByZWVtcHRfY2xpZW50X2luaXQoZ3QsICZiKSkKLQkJZ290byBlcnJfY2xpZW50
X2E7Ci0JYi5jdHgtPnNjaGVkLnByaW9yaXR5ID0gSTkxNV9VU0VSX1BSSU9SSVRZKEk5MTVfUFJJ
T1JJVFlfTUFYKTsKLQotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgewotCQlzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycV9hLCAqcnFfYjsKLQotCQlpZiAoIWludGVsX2VuZ2luZV9oYXNf
cHJlZW1wdGlvbihlbmdpbmUpKQotCQkJY29udGludWU7Ci0KLQkJZW5naW5lLT5leGVjbGlzdHMu
cHJlZW1wdF9oYW5nLmNvdW50ID0gMDsKLQotCQlycV9hID0gc3Bpbm5lcl9jcmVhdGVfcmVxdWVz
dCgmYS5zcGluLAotCQkJCQkgICAgICBhLmN0eCwgZW5naW5lLAotCQkJCQkgICAgICBNSV9BUkJf
Q0hFQ0spOwotCQlpZiAoSVNfRVJSKHJxX2EpKSB7Ci0JCQllcnIgPSBQVFJfRVJSKHJxX2EpOwot
CQkJZ290byBlcnJfY2xpZW50X2I7Ci0JCX0KLQotCQkvKiBMb3cgcHJpb3JpdHkgY2xpZW50LCBi
dXQgdW5wcmVlbXB0YWJsZSEgKi8KLQkJcnFfYS0+ZmxhZ3MgfD0gSTkxNV9SRVFVRVNUX05PUFJF
RU1QVDsKLQotCQlpOTE1X3JlcXVlc3RfYWRkKHJxX2EpOwotCQlpZiAoIWlndF93YWl0X2Zvcl9z
cGlubmVyKCZhLnNwaW4sIHJxX2EpKSB7Ci0JCQlwcl9lcnIoIkZpcnN0IGNsaWVudCBmYWlsZWQg
dG8gc3RhcnRcbiIpOwotCQkJZ290byBlcnJfd2VkZ2VkOwotCQl9Ci0KLQkJcnFfYiA9IHNwaW5u
ZXJfY3JlYXRlX3JlcXVlc3QoJmIuc3BpbiwKLQkJCQkJICAgICAgYi5jdHgsIGVuZ2luZSwKLQkJ
CQkJICAgICAgTUlfQVJCX0NIRUNLKTsKLQkJaWYgKElTX0VSUihycV9iKSkgewotCQkJZXJyID0g
UFRSX0VSUihycV9iKTsKLQkJCWdvdG8gZXJyX2NsaWVudF9iOwotCQl9Ci0KLQkJaTkxNV9yZXF1
ZXN0X2FkZChycV9iKTsKLQotCQkvKiBCIGlzIG11Y2ggbW9yZSBpbXBvcnRhbnQgdGhhbiBBISAo
QnV0IEEgaXMgdW5wcmVlbXB0YWJsZS4pICovCi0JCUdFTV9CVUdfT04ocnFfcHJpbyhycV9iKSA8
PSBycV9wcmlvKHJxX2EpKTsKLQotCQkvKiBXYWl0IGxvbmcgZW5vdWdoIGZvciBwcmVlbXB0aW9u
IGFuZCB0aW1lc2xpY2luZyAqLwotCQlpZiAoaWd0X3dhaXRfZm9yX3NwaW5uZXIoJmIuc3Bpbiwg
cnFfYikpIHsKLQkJCXByX2VycigiU2Vjb25kIGNsaWVudCBzdGFydGVkIHRvbyBlYXJseSFcbiIp
OwotCQkJZ290byBlcnJfd2VkZ2VkOwotCQl9Ci0KLQkJaWd0X3NwaW5uZXJfZW5kKCZhLnNwaW4p
OwotCi0JCWlmICghaWd0X3dhaXRfZm9yX3NwaW5uZXIoJmIuc3BpbiwgcnFfYikpIHsKLQkJCXBy
X2VycigiU2Vjb25kIGNsaWVudCBmYWlsZWQgdG8gc3RhcnRcbiIpOwotCQkJZ290byBlcnJfd2Vk
Z2VkOwotCQl9Ci0KLQkJaWd0X3NwaW5uZXJfZW5kKCZiLnNwaW4pOwotCi0JCWlmIChlbmdpbmUt
PmV4ZWNsaXN0cy5wcmVlbXB0X2hhbmcuY291bnQpIHsKLQkJCXByX2VycigiUHJlZW1wdGlvbiBy
ZWNvcmRlZCB4JWQ7IHNob3VsZCBoYXZlIGJlZW4gc3VwcHJlc3NlZCFcbiIsCi0JCQkgICAgICAg
ZW5naW5lLT5leGVjbGlzdHMucHJlZW1wdF9oYW5nLmNvdW50KTsKLQkJCWVyciA9IC1FSU5WQUw7
Ci0JCQlnb3RvIGVycl93ZWRnZWQ7Ci0JCX0KLQotCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5
MTUpKQotCQkJZ290byBlcnJfd2VkZ2VkOwotCX0KLQotCWVyciA9IDA7Ci1lcnJfY2xpZW50X2I6
Ci0JcHJlZW1wdF9jbGllbnRfZmluaSgmYik7Ci1lcnJfY2xpZW50X2E6Ci0JcHJlZW1wdF9jbGll
bnRfZmluaSgmYSk7Ci0JcmV0dXJuIGVycjsKLQotZXJyX3dlZGdlZDoKLQlpZ3Rfc3Bpbm5lcl9l
bmQoJmIuc3Bpbik7Ci0JaWd0X3NwaW5uZXJfZW5kKCZhLnNwaW4pOwotCWludGVsX2d0X3NldF93
ZWRnZWQoZ3QpOwotCWVyciA9IC1FSU87Ci0JZ290byBlcnJfY2xpZW50X2I7Ci19Ci0KLXN0cnVj
dCBsaXZlX3ByZWVtcHRfY2FuY2VsIHsKLQlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7
Ci0Jc3RydWN0IHByZWVtcHRfY2xpZW50IGEsIGI7Ci19OwotCi1zdGF0aWMgaW50IF9fY2FuY2Vs
X2FjdGl2ZTAoc3RydWN0IGxpdmVfcHJlZW1wdF9jYW5jZWwgKmFyZykKLXsKLQlzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpycTsKLQlzdHJ1Y3QgaWd0X2xpdmVfdGVzdCB0OwotCWludCBlcnI7Ci0KLQkv
KiBQcmVlbXB0IGNhbmNlbCBvZiBFTFNQMCAqLwotCUdFTV9UUkFDRSgiJXMoJXMpXG4iLCBfX2Z1
bmNfXywgYXJnLT5lbmdpbmUtPm5hbWUpOwotCWlmIChpZ3RfbGl2ZV90ZXN0X2JlZ2luKCZ0LCBh
cmctPmVuZ2luZS0+aTkxNSwKLQkJCQlfX2Z1bmNfXywgYXJnLT5lbmdpbmUtPm5hbWUpKQotCQly
ZXR1cm4gLUVJTzsKLQotCWNsZWFyX2JpdChDT05URVhUX0JBTk5FRCwgJmFyZy0+YS5jdHgtPmZs
YWdzKTsKLQlycSA9IHNwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJmFyZy0+YS5zcGluLAotCQkJCSAg
ICBhcmctPmEuY3R4LCBhcmctPmVuZ2luZSwKLQkJCQkgICAgTUlfQVJCX0NIRUNLKTsKLQlpZiAo
SVNfRVJSKHJxKSkKLQkJcmV0dXJuIFBUUl9FUlIocnEpOwotCi0JaTkxNV9yZXF1ZXN0X2dldChy
cSk7Ci0JaTkxNV9yZXF1ZXN0X2FkZChycSk7Ci0JaWYgKCFpZ3Rfd2FpdF9mb3Jfc3Bpbm5lcigm
YXJnLT5hLnNwaW4sIHJxKSkgewotCQllcnIgPSAtRUlPOwotCQlnb3RvIG91dDsKLQl9Ci0KLQlp
OTE1X2dlbV9jb250ZXh0X3NldF9iYW5uZWQoYXJnLT5hLmN0eCk7Ci0JZXJyID0gaW50ZWxfZW5n
aW5lX3B1bHNlKGFyZy0+ZW5naW5lKTsKLQlpZiAoZXJyKQotCQlnb3RvIG91dDsKLQotCWlmIChp
OTE1X3JlcXVlc3Rfd2FpdChycSwgMCwgSFogLyA1KSA8IDApIHsKLQkJZXJyID0gLUVJTzsKLQkJ
Z290byBvdXQ7Ci0JfQotCi0JaWYgKHJxLT5mZW5jZS5lcnJvciAhPSAtRUlPKSB7Ci0JCXByX2Vy
cigiQ2FuY2VsbGVkIGluZmxpZ2h0MCByZXF1ZXN0IGRpZCBub3QgcmVwb3J0IC1FSU9cbiIpOwot
CQllcnIgPSAtRUlOVkFMOwotCQlnb3RvIG91dDsKLQl9Ci0KLW91dDoKLQlpOTE1X3JlcXVlc3Rf
cHV0KHJxKTsKLQlpZiAoaWd0X2xpdmVfdGVzdF9lbmQoJnQpKQotCQllcnIgPSAtRUlPOwotCXJl
dHVybiBlcnI7Ci19Ci0KLXN0YXRpYyBpbnQgX19jYW5jZWxfYWN0aXZlMShzdHJ1Y3QgbGl2ZV9w
cmVlbXB0X2NhbmNlbCAqYXJnKQotewotCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxWzJdID0ge307
Ci0Jc3RydWN0IGlndF9saXZlX3Rlc3QgdDsKLQlpbnQgZXJyOwotCi0JLyogUHJlZW1wdCBjYW5j
ZWwgb2YgRUxTUDEgKi8KLQlHRU1fVFJBQ0UoIiVzKCVzKVxuIiwgX19mdW5jX18sIGFyZy0+ZW5n
aW5lLT5uYW1lKTsKLQlpZiAoaWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgYXJnLT5lbmdpbmUtPmk5
MTUsCi0JCQkJX19mdW5jX18sIGFyZy0+ZW5naW5lLT5uYW1lKSkKLQkJcmV0dXJuIC1FSU87Ci0K
LQljbGVhcl9iaXQoQ09OVEVYVF9CQU5ORUQsICZhcmctPmEuY3R4LT5mbGFncyk7Ci0JcnFbMF0g
PSBzcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZhcmctPmEuc3BpbiwKLQkJCQkgICAgICAgYXJnLT5h
LmN0eCwgYXJnLT5lbmdpbmUsCi0JCQkJICAgICAgIE1JX05PT1ApOyAvKiBubyBwcmVlbXB0aW9u
ICovCi0JaWYgKElTX0VSUihycVswXSkpCi0JCXJldHVybiBQVFJfRVJSKHJxWzBdKTsKLQotCWk5
MTVfcmVxdWVzdF9nZXQocnFbMF0pOwotCWk5MTVfcmVxdWVzdF9hZGQocnFbMF0pOwotCWlmICgh
aWd0X3dhaXRfZm9yX3NwaW5uZXIoJmFyZy0+YS5zcGluLCBycVswXSkpIHsKLQkJZXJyID0gLUVJ
TzsKLQkJZ290byBvdXQ7Ci0JfQotCi0JY2xlYXJfYml0KENPTlRFWFRfQkFOTkVELCAmYXJnLT5i
LmN0eC0+ZmxhZ3MpOwotCXJxWzFdID0gc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmYXJnLT5iLnNw
aW4sCi0JCQkJICAgICAgIGFyZy0+Yi5jdHgsIGFyZy0+ZW5naW5lLAotCQkJCSAgICAgICBNSV9B
UkJfQ0hFQ0spOwotCWlmIChJU19FUlIocnFbMV0pKSB7Ci0JCWVyciA9IFBUUl9FUlIocnFbMV0p
OwotCQlnb3RvIG91dDsKLQl9Ci0KLQlpOTE1X3JlcXVlc3RfZ2V0KHJxWzFdKTsKLQllcnIgPSBp
OTE1X3JlcXVlc3RfYXdhaXRfZG1hX2ZlbmNlKHJxWzFdLCAmcnFbMF0tPmZlbmNlKTsKLQlpOTE1
X3JlcXVlc3RfYWRkKHJxWzFdKTsKLQlpZiAoZXJyKQotCQlnb3RvIG91dDsKLQotCWk5MTVfZ2Vt
X2NvbnRleHRfc2V0X2Jhbm5lZChhcmctPmIuY3R4KTsKLQllcnIgPSBpbnRlbF9lbmdpbmVfcHVs
c2UoYXJnLT5lbmdpbmUpOwotCWlmIChlcnIpCi0JCWdvdG8gb3V0OwotCi0JaWd0X3NwaW5uZXJf
ZW5kKCZhcmctPmEuc3Bpbik7Ci0JaWYgKGk5MTVfcmVxdWVzdF93YWl0KHJxWzFdLCAwLCBIWiAv
IDUpIDwgMCkgewotCQllcnIgPSAtRUlPOwotCQlnb3RvIG91dDsKLQl9Ci0KLQlpZiAocnFbMF0t
PmZlbmNlLmVycm9yICE9IDApIHsKLQkJcHJfZXJyKCJOb3JtYWwgaW5mbGlnaHQwIHJlcXVlc3Qg
ZGlkIG5vdCBjb21wbGV0ZVxuIik7Ci0JCWVyciA9IC1FSU5WQUw7Ci0JCWdvdG8gb3V0OwotCX0K
LQotCWlmIChycVsxXS0+ZmVuY2UuZXJyb3IgIT0gLUVJTykgewotCQlwcl9lcnIoIkNhbmNlbGxl
ZCBpbmZsaWdodDEgcmVxdWVzdCBkaWQgbm90IHJlcG9ydCAtRUlPXG4iKTsKLQkJZXJyID0gLUVJ
TlZBTDsKLQkJZ290byBvdXQ7Ci0JfQotCi1vdXQ6Ci0JaTkxNV9yZXF1ZXN0X3B1dChycVsxXSk7
Ci0JaTkxNV9yZXF1ZXN0X3B1dChycVswXSk7Ci0JaWYgKGlndF9saXZlX3Rlc3RfZW5kKCZ0KSkK
LQkJZXJyID0gLUVJTzsKLQlyZXR1cm4gZXJyOwotfQotCi1zdGF0aWMgaW50IF9fY2FuY2VsX3F1
ZXVlZChzdHJ1Y3QgbGl2ZV9wcmVlbXB0X2NhbmNlbCAqYXJnKQotewotCXN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJxWzNdID0ge307Ci0Jc3RydWN0IGlndF9saXZlX3Rlc3QgdDsKLQlpbnQgZXJyOwot
Ci0JLyogRnVsbCBFTFNQIGFuZCBvbmUgaW4gdGhlIHdpbmdzICovCi0JR0VNX1RSQUNFKCIlcygl
cylcbiIsIF9fZnVuY19fLCBhcmctPmVuZ2luZS0+bmFtZSk7Ci0JaWYgKGlndF9saXZlX3Rlc3Rf
YmVnaW4oJnQsIGFyZy0+ZW5naW5lLT5pOTE1LAotCQkJCV9fZnVuY19fLCBhcmctPmVuZ2luZS0+
bmFtZSkpCi0JCXJldHVybiAtRUlPOwotCi0JY2xlYXJfYml0KENPTlRFWFRfQkFOTkVELCAmYXJn
LT5hLmN0eC0+ZmxhZ3MpOwotCXJxWzBdID0gc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmYXJnLT5h
LnNwaW4sCi0JCQkJICAgICAgIGFyZy0+YS5jdHgsIGFyZy0+ZW5naW5lLAotCQkJCSAgICAgICBN
SV9BUkJfQ0hFQ0spOwotCWlmIChJU19FUlIocnFbMF0pKQotCQlyZXR1cm4gUFRSX0VSUihycVsw
XSk7Ci0KLQlpOTE1X3JlcXVlc3RfZ2V0KHJxWzBdKTsKLQlpOTE1X3JlcXVlc3RfYWRkKHJxWzBd
KTsKLQlpZiAoIWlndF93YWl0X2Zvcl9zcGlubmVyKCZhcmctPmEuc3BpbiwgcnFbMF0pKSB7Ci0J
CWVyciA9IC1FSU87Ci0JCWdvdG8gb3V0OwotCX0KLQotCWNsZWFyX2JpdChDT05URVhUX0JBTk5F
RCwgJmFyZy0+Yi5jdHgtPmZsYWdzKTsKLQlycVsxXSA9IGlndF9yZXF1ZXN0X2FsbG9jKGFyZy0+
Yi5jdHgsIGFyZy0+ZW5naW5lKTsKLQlpZiAoSVNfRVJSKHJxWzFdKSkgewotCQllcnIgPSBQVFJf
RVJSKHJxWzFdKTsKLQkJZ290byBvdXQ7Ci0JfQotCi0JaTkxNV9yZXF1ZXN0X2dldChycVsxXSk7
Ci0JZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X2RtYV9mZW5jZShycVsxXSwgJnJxWzBdLT5mZW5j
ZSk7Ci0JaTkxNV9yZXF1ZXN0X2FkZChycVsxXSk7Ci0JaWYgKGVycikKLQkJZ290byBvdXQ7Ci0K
LQlycVsyXSA9IHNwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJmFyZy0+Yi5zcGluLAotCQkJCSAgICAg
ICBhcmctPmEuY3R4LCBhcmctPmVuZ2luZSwKLQkJCQkgICAgICAgTUlfQVJCX0NIRUNLKTsKLQlp
ZiAoSVNfRVJSKHJxWzJdKSkgewotCQllcnIgPSBQVFJfRVJSKHJxWzJdKTsKLQkJZ290byBvdXQ7
Ci0JfQotCi0JaTkxNV9yZXF1ZXN0X2dldChycVsyXSk7Ci0JZXJyID0gaTkxNV9yZXF1ZXN0X2F3
YWl0X2RtYV9mZW5jZShycVsyXSwgJnJxWzFdLT5mZW5jZSk7Ci0JaTkxNV9yZXF1ZXN0X2FkZChy
cVsyXSk7Ci0JaWYgKGVycikKLQkJZ290byBvdXQ7Ci0KLQlpOTE1X2dlbV9jb250ZXh0X3NldF9i
YW5uZWQoYXJnLT5hLmN0eCk7Ci0JZXJyID0gaW50ZWxfZW5naW5lX3B1bHNlKGFyZy0+ZW5naW5l
KTsKLQlpZiAoZXJyKQotCQlnb3RvIG91dDsKLQotCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChycVsy
XSwgMCwgSFogLyA1KSA8IDApIHsKLQkJZXJyID0gLUVJTzsKLQkJZ290byBvdXQ7Ci0JfQotCi0J
aWYgKHJxWzBdLT5mZW5jZS5lcnJvciAhPSAtRUlPKSB7Ci0JCXByX2VycigiQ2FuY2VsbGVkIGlu
ZmxpZ2h0MCByZXF1ZXN0IGRpZCBub3QgcmVwb3J0IC1FSU9cbiIpOwotCQllcnIgPSAtRUlOVkFM
OwotCQlnb3RvIG91dDsKLQl9Ci0KLQlpZiAocnFbMV0tPmZlbmNlLmVycm9yICE9IDApIHsKLQkJ
cHJfZXJyKCJOb3JtYWwgaW5mbGlnaHQxIHJlcXVlc3QgZGlkIG5vdCBjb21wbGV0ZVxuIik7Ci0J
CWVyciA9IC1FSU5WQUw7Ci0JCWdvdG8gb3V0OwotCX0KLQotCWlmIChycVsyXS0+ZmVuY2UuZXJy
b3IgIT0gLUVJTykgewotCQlwcl9lcnIoIkNhbmNlbGxlZCBxdWV1ZWQgcmVxdWVzdCBkaWQgbm90
IHJlcG9ydCAtRUlPXG4iKTsKLQkJZXJyID0gLUVJTlZBTDsKLQkJZ290byBvdXQ7Ci0JfQotCi1v
dXQ6Ci0JaTkxNV9yZXF1ZXN0X3B1dChycVsyXSk7Ci0JaTkxNV9yZXF1ZXN0X3B1dChycVsxXSk7
Ci0JaTkxNV9yZXF1ZXN0X3B1dChycVswXSk7Ci0JaWYgKGlndF9saXZlX3Rlc3RfZW5kKCZ0KSkK
LQkJZXJyID0gLUVJTzsKLQlyZXR1cm4gZXJyOwotfQotCi1zdGF0aWMgaW50IF9fY2FuY2VsX2hv
c3RpbGUoc3RydWN0IGxpdmVfcHJlZW1wdF9jYW5jZWwgKmFyZykKLXsKLQlzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpycTsKLQlpbnQgZXJyOwotCi0JLyogUHJlZW1wdCBjYW5jZWwgbm9uLXByZWVtcHRp
YmxlIHNwaW5uZXIgaW4gRUxTUDAgKi8KLQlpZiAoIUlTX0FDVElWRShDT05GSUdfRFJNX0k5MTVf
UFJFRU1QVF9USU1FT1VUKSkKLQkJcmV0dXJuIDA7Ci0KLQlHRU1fVFJBQ0UoIiVzKCVzKVxuIiwg
X19mdW5jX18sIGFyZy0+ZW5naW5lLT5uYW1lKTsKLQljbGVhcl9iaXQoQ09OVEVYVF9CQU5ORUQs
ICZhcmctPmEuY3R4LT5mbGFncyk7Ci0JcnEgPSBzcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZhcmct
PmEuc3BpbiwKLQkJCQkgICAgYXJnLT5hLmN0eCwgYXJnLT5lbmdpbmUsCi0JCQkJICAgIE1JX05P
T1ApOyAvKiBwcmVlbXB0aW9uIGRpc2FibGVkICovCi0JaWYgKElTX0VSUihycSkpCi0JCXJldHVy
biBQVFJfRVJSKHJxKTsKLQotCWk5MTVfcmVxdWVzdF9nZXQocnEpOwotCWk5MTVfcmVxdWVzdF9h
ZGQocnEpOwotCWlmICghaWd0X3dhaXRfZm9yX3NwaW5uZXIoJmFyZy0+YS5zcGluLCBycSkpIHsK
LQkJZXJyID0gLUVJTzsKLQkJZ290byBvdXQ7Ci0JfQotCi0JaTkxNV9nZW1fY29udGV4dF9zZXRf
YmFubmVkKGFyZy0+YS5jdHgpOwotCWVyciA9IGludGVsX2VuZ2luZV9wdWxzZShhcmctPmVuZ2lu
ZSk7IC8qIGZvcmNlIHJlc2V0ICovCi0JaWYgKGVycikKLQkJZ290byBvdXQ7Ci0KLQlpZiAoaTkx
NV9yZXF1ZXN0X3dhaXQocnEsIDAsIEhaIC8gNSkgPCAwKSB7Ci0JCWVyciA9IC1FSU87Ci0JCWdv
dG8gb3V0OwotCX0KLQotCWlmIChycS0+ZmVuY2UuZXJyb3IgIT0gLUVJTykgewotCQlwcl9lcnIo
IkNhbmNlbGxlZCBpbmZsaWdodDAgcmVxdWVzdCBkaWQgbm90IHJlcG9ydCAtRUlPXG4iKTsKLQkJ
ZXJyID0gLUVJTlZBTDsKLQkJZ290byBvdXQ7Ci0JfQotCi1vdXQ6Ci0JaTkxNV9yZXF1ZXN0X3B1
dChycSk7Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGFyZy0+ZW5naW5lLT5pOTE1KSkKLQkJZXJyID0g
LUVJTzsKLQlyZXR1cm4gZXJyOwotfQotCi1zdGF0aWMgaW50IGxpdmVfcHJlZW1wdF9jYW5jZWwo
dm9pZCAqYXJnKQotewotCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7Ci0Jc3RydWN0IGxpdmVf
cHJlZW1wdF9jYW5jZWwgZGF0YTsKLQllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKLQlpbnQgZXJy
ID0gLUVOT01FTTsKLQotCS8qCi0JICogVG8gY2FuY2VsIGFuIGluZmxpZ2h0IGNvbnRleHQsIHdl
IG5lZWQgdG8gZmlyc3QgcmVtb3ZlIGl0IGZyb20gdGhlCi0JICogR1BVLiBUaGF0IHNvdW5kcyBs
aWtlIHByZWVtcHRpb24hIFBsdXMgYSBsaXR0bGUgYml0IG9mIGJvb2trZWVwaW5nLgotCSAqLwot
Ci0JaWYgKCFIQVNfTE9HSUNBTF9SSU5HX1BSRUVNUFRJT04oZ3QtPmk5MTUpKQotCQlyZXR1cm4g
MDsKLQotCWlmIChwcmVlbXB0X2NsaWVudF9pbml0KGd0LCAmZGF0YS5hKSkKLQkJcmV0dXJuIC1F
Tk9NRU07Ci0JaWYgKHByZWVtcHRfY2xpZW50X2luaXQoZ3QsICZkYXRhLmIpKQotCQlnb3RvIGVy
cl9jbGllbnRfYTsKLQotCWZvcl9lYWNoX2VuZ2luZShkYXRhLmVuZ2luZSwgZ3QsIGlkKSB7Ci0J
CWlmICghaW50ZWxfZW5naW5lX2hhc19wcmVlbXB0aW9uKGRhdGEuZW5naW5lKSkKLQkJCWNvbnRp
bnVlOwotCi0JCWVyciA9IF9fY2FuY2VsX2FjdGl2ZTAoJmRhdGEpOwotCQlpZiAoZXJyKQotCQkJ
Z290byBlcnJfd2VkZ2VkOwotCi0JCWVyciA9IF9fY2FuY2VsX2FjdGl2ZTEoJmRhdGEpOwotCQlp
ZiAoZXJyKQotCQkJZ290byBlcnJfd2VkZ2VkOwotCi0JCWVyciA9IF9fY2FuY2VsX3F1ZXVlZCgm
ZGF0YSk7Ci0JCWlmIChlcnIpCi0JCQlnb3RvIGVycl93ZWRnZWQ7Ci0KLQkJZXJyID0gX19jYW5j
ZWxfaG9zdGlsZSgmZGF0YSk7Ci0JCWlmIChlcnIpCi0JCQlnb3RvIGVycl93ZWRnZWQ7Ci0JfQot
Ci0JZXJyID0gMDsKLWVycl9jbGllbnRfYjoKLQlwcmVlbXB0X2NsaWVudF9maW5pKCZkYXRhLmIp
OwotZXJyX2NsaWVudF9hOgotCXByZWVtcHRfY2xpZW50X2ZpbmkoJmRhdGEuYSk7Ci0JcmV0dXJu
IGVycjsKLQotZXJyX3dlZGdlZDoKLQlHRU1fVFJBQ0VfRFVNUCgpOwotCWlndF9zcGlubmVyX2Vu
ZCgmZGF0YS5iLnNwaW4pOwotCWlndF9zcGlubmVyX2VuZCgmZGF0YS5hLnNwaW4pOwotCWludGVs
X2d0X3NldF93ZWRnZWQoZ3QpOwotCWdvdG8gZXJyX2NsaWVudF9iOwotfQotCi1zdGF0aWMgaW50
IGxpdmVfc3VwcHJlc3Nfc2VsZl9wcmVlbXB0KHZvaWQgKmFyZykKLXsKLQlzdHJ1Y3QgaW50ZWxf
Z3QgKmd0ID0gYXJnOwotCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQlzdHJ1Y3Qg
aTkxNV9zY2hlZF9hdHRyIGF0dHIgPSB7Ci0JCS5wcmlvcml0eSA9IEk5MTVfVVNFUl9QUklPUklU
WShJOTE1X1BSSU9SSVRZX01BWCkKLQl9OwotCXN0cnVjdCBwcmVlbXB0X2NsaWVudCBhLCBiOwot
CWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwotCWludCBlcnIgPSAtRU5PTUVNOwotCi0JLyoKLQkg
KiBWZXJpZnkgdGhhdCBpZiBhIHByZWVtcHRpb24gcmVxdWVzdCBkb2VzIG5vdCBjYXVzZSBhIGNo
YW5nZSBpbgotCSAqIHRoZSBjdXJyZW50IGV4ZWN1dGlvbiBvcmRlciwgdGhlIHByZWVtcHQtdG8t
aWRsZSBpbmplY3Rpb24gaXMKLQkgKiBza2lwcGVkIGFuZCB0aGF0IHdlIGRvIG5vdCBhY2NpZGVu
dGFsbHkgYXBwbHkgaXQgYWZ0ZXIgdGhlIENTCi0JICogY29tcGxldGlvbiBldmVudC4KLQkgKi8K
LQotCWlmICghSEFTX0xPR0lDQUxfUklOR19QUkVFTVBUSU9OKGd0LT5pOTE1KSkKLQkJcmV0dXJu
IDA7Ci0KLQlpZiAoVVNFU19HVUNfU1VCTUlTU0lPTihndC0+aTkxNSkpCi0JCXJldHVybiAwOyAv
KiBwcmVzdW1lIGJsYWNrIGJsb3ggKi8KLQotCWlmIChpbnRlbF92Z3B1X2FjdGl2ZShndC0+aTkx
NSkpCi0JCXJldHVybiAwOyAvKiBHVlQgZm9yY2VzIHNpbmdsZSBwb3J0ICYgcmVxdWVzdCBzdWJt
aXNzaW9uICovCi0KLQlpZiAocHJlZW1wdF9jbGllbnRfaW5pdChndCwgJmEpKQotCQlyZXR1cm4g
LUVOT01FTTsKLQlpZiAocHJlZW1wdF9jbGllbnRfaW5pdChndCwgJmIpKQotCQlnb3RvIGVycl9j
bGllbnRfYTsKLQotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgewotCQlzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycV9hLCAqcnFfYjsKLQkJaW50IGRlcHRoOwotCi0JCWlmICghaW50ZWxf
ZW5naW5lX2hhc19wcmVlbXB0aW9uKGVuZ2luZSkpCi0JCQljb250aW51ZTsKLQotCQlpZiAoaWd0
X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpKQotCQkJZ290byBlcnJfd2VkZ2VkOwotCi0JCWludGVsX2Vu
Z2luZV9wbV9nZXQoZW5naW5lKTsKLQkJZW5naW5lLT5leGVjbGlzdHMucHJlZW1wdF9oYW5nLmNv
dW50ID0gMDsKLQotCQlycV9hID0gc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmYS5zcGluLAotCQkJ
CQkgICAgICBhLmN0eCwgZW5naW5lLAotCQkJCQkgICAgICBNSV9OT09QKTsKLQkJaWYgKElTX0VS
UihycV9hKSkgewotCQkJZXJyID0gUFRSX0VSUihycV9hKTsKLQkJCWludGVsX2VuZ2luZV9wbV9w
dXQoZW5naW5lKTsKLQkJCWdvdG8gZXJyX2NsaWVudF9iOwotCQl9Ci0KLQkJaTkxNV9yZXF1ZXN0
X2FkZChycV9hKTsKLQkJaWYgKCFpZ3Rfd2FpdF9mb3Jfc3Bpbm5lcigmYS5zcGluLCBycV9hKSkg
ewotCQkJcHJfZXJyKCJGaXJzdCBjbGllbnQgZmFpbGVkIHRvIHN0YXJ0XG4iKTsKLQkJCWludGVs
X2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKLQkJCWdvdG8gZXJyX3dlZGdlZDsKLQkJfQotCi0JCS8q
IEtlZXAgcG9zdHBvbmluZyB0aGUgdGltZXIgdG8gYXZvaWQgcHJlbWF0dXJlIHNsaWNpbmcgKi8K
LQkJbW9kX3RpbWVyKCZlbmdpbmUtPmV4ZWNsaXN0cy50aW1lciwgamlmZmllcyArIEhaKTsKLQkJ
Zm9yIChkZXB0aCA9IDA7IGRlcHRoIDwgODsgZGVwdGgrKykgewotCQkJcnFfYiA9IHNwaW5uZXJf
Y3JlYXRlX3JlcXVlc3QoJmIuc3BpbiwKLQkJCQkJCSAgICAgIGIuY3R4LCBlbmdpbmUsCi0JCQkJ
CQkgICAgICBNSV9OT09QKTsKLQkJCWlmIChJU19FUlIocnFfYikpIHsKLQkJCQllcnIgPSBQVFJf
RVJSKHJxX2IpOwotCQkJCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKLQkJCQlnb3RvIGVy
cl9jbGllbnRfYjsKLQkJCX0KLQkJCWk5MTVfcmVxdWVzdF9hZGQocnFfYik7Ci0KLQkJCUdFTV9C
VUdfT04oaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChycV9hKSk7Ci0JCQllbmdpbmUtPnNjaGVkdWxl
KHJxX2EsICZhdHRyKTsKLQkJCWlndF9zcGlubmVyX2VuZCgmYS5zcGluKTsKLQotCQkJaWYgKCFp
Z3Rfd2FpdF9mb3Jfc3Bpbm5lcigmYi5zcGluLCBycV9iKSkgewotCQkJCXByX2VycigiU2Vjb25k
IGNsaWVudCBmYWlsZWQgdG8gc3RhcnRcbiIpOwotCQkJCWludGVsX2VuZ2luZV9wbV9wdXQoZW5n
aW5lKTsKLQkJCQlnb3RvIGVycl93ZWRnZWQ7Ci0JCQl9Ci0KLQkJCXN3YXAoYSwgYik7Ci0JCQly
cV9hID0gcnFfYjsKLQkJfQotCQlpZ3Rfc3Bpbm5lcl9lbmQoJmEuc3Bpbik7Ci0KLQkJaWYgKGVu
Z2luZS0+ZXhlY2xpc3RzLnByZWVtcHRfaGFuZy5jb3VudCkgewotCQkJcHJfZXJyKCJQcmVlbXB0
aW9uIG9uICVzIHJlY29yZGVkIHglZCwgZGVwdGggJWQ7IHNob3VsZCBoYXZlIGJlZW4gc3VwcHJl
c3NlZCFcbiIsCi0JCQkgICAgICAgZW5naW5lLT5uYW1lLAotCQkJICAgICAgIGVuZ2luZS0+ZXhl
Y2xpc3RzLnByZWVtcHRfaGFuZy5jb3VudCwKLQkJCSAgICAgICBkZXB0aCk7Ci0JCQlpbnRlbF9l
bmdpbmVfcG1fcHV0KGVuZ2luZSk7Ci0JCQllcnIgPSAtRUlOVkFMOwotCQkJZ290byBlcnJfY2xp
ZW50X2I7Ci0JCX0KLQotCQlpbnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2luZSk7Ci0JCWlmIChpZ3Rf
Zmx1c2hfdGVzdChndC0+aTkxNSkpCi0JCQlnb3RvIGVycl93ZWRnZWQ7Ci0JfQotCi0JZXJyID0g
MDsKLWVycl9jbGllbnRfYjoKLQlwcmVlbXB0X2NsaWVudF9maW5pKCZiKTsKLWVycl9jbGllbnRf
YToKLQlwcmVlbXB0X2NsaWVudF9maW5pKCZhKTsKLQlyZXR1cm4gZXJyOwotCi1lcnJfd2VkZ2Vk
OgotCWlndF9zcGlubmVyX2VuZCgmYi5zcGluKTsKLQlpZ3Rfc3Bpbm5lcl9lbmQoJmEuc3Bpbik7
Ci0JaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7Ci0JZXJyID0gLUVJTzsKLQlnb3RvIGVycl9jbGll
bnRfYjsKLX0KLQotc3RhdGljIGludCBfX2k5MTVfc3dfZmVuY2VfY2FsbAotZHVtbXlfbm90aWZ5
KHN0cnVjdCBpOTE1X3N3X2ZlbmNlICpmZW5jZSwgZW51bSBpOTE1X3N3X2ZlbmNlX25vdGlmeSBz
dGF0ZSkKLXsKLQlyZXR1cm4gTk9USUZZX0RPTkU7Ci19Ci0KLXN0YXRpYyBzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpkdW1teV9yZXF1ZXN0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKLXsK
LQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKLQotCXJxID0ga3phbGxvYyhzaXplb2YoKnJxKSwg
R0ZQX0tFUk5FTCk7Ci0JaWYgKCFycSkKLQkJcmV0dXJuIE5VTEw7Ci0KLQlycS0+ZW5naW5lID0g
ZW5naW5lOwotCi0Jc3Bpbl9sb2NrX2luaXQoJnJxLT5sb2NrKTsKLQlJTklUX0xJU1RfSEVBRCgm
cnEtPmZlbmNlLmNiX2xpc3QpOwotCXJxLT5mZW5jZS5sb2NrID0gJnJxLT5sb2NrOwotCXJxLT5m
ZW5jZS5vcHMgPSAmaTkxNV9mZW5jZV9vcHM7Ci0KLQlpOTE1X3NjaGVkX25vZGVfaW5pdCgmcnEt
PnNjaGVkKTsKLQotCS8qIG1hcmsgdGhpcyByZXF1ZXN0IGFzIHBlcm1hbmVudGx5IGluY29tcGxl
dGUgKi8KLQlycS0+ZmVuY2Uuc2Vxbm8gPSAxOwotCUJVSUxEX0JVR19PTihzaXplb2YocnEtPmZl
bmNlLnNlcW5vKSAhPSA4KTsgLyogdXBwZXIgMzJiID09IDAgKi8KLQlycS0+aHdzcF9zZXFubyA9
ICh1MzIgKikmcnEtPmZlbmNlLnNlcW5vICsgMTsKLQlHRU1fQlVHX09OKGk5MTVfcmVxdWVzdF9j
b21wbGV0ZWQocnEpKTsKLQotCWk5MTVfc3dfZmVuY2VfaW5pdCgmcnEtPnN1Ym1pdCwgZHVtbXlf
bm90aWZ5KTsKLQlzZXRfYml0KEk5MTVfRkVOQ0VfRkxBR19BQ1RJVkUsICZycS0+ZmVuY2UuZmxh
Z3MpOwotCi0Jc3Bpbl9sb2NrX2luaXQoJnJxLT5sb2NrKTsKLQlycS0+ZmVuY2UubG9jayA9ICZy
cS0+bG9jazsKLQlJTklUX0xJU1RfSEVBRCgmcnEtPmZlbmNlLmNiX2xpc3QpOwotCi0JcmV0dXJu
IHJxOwotfQotCi1zdGF0aWMgdm9pZCBkdW1teV9yZXF1ZXN0X2ZyZWUoc3RydWN0IGk5MTVfcmVx
dWVzdCAqZHVtbXkpCi17Ci0JLyogV2UgaGF2ZSB0byBmYWtlIHRoZSBDUyBpbnRlcnJ1cHQgdG8g
a2ljayB0aGUgbmV4dCByZXF1ZXN0ICovCi0JaTkxNV9zd19mZW5jZV9jb21taXQoJmR1bW15LT5z
dWJtaXQpOwotCi0JaTkxNV9yZXF1ZXN0X21hcmtfY29tcGxldGUoZHVtbXkpOwotCWRtYV9mZW5j
ZV9zaWduYWwoJmR1bW15LT5mZW5jZSk7Ci0KLQlpOTE1X3NjaGVkX25vZGVfZmluaSgmZHVtbXkt
PnNjaGVkKTsKLQlpOTE1X3N3X2ZlbmNlX2ZpbmkoJmR1bW15LT5zdWJtaXQpOwotCi0JZG1hX2Zl
bmNlX2ZyZWUoJmR1bW15LT5mZW5jZSk7Ci19Ci0KLXN0YXRpYyBpbnQgbGl2ZV9zdXBwcmVzc193
YWl0X3ByZWVtcHQodm9pZCAqYXJnKQotewotCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7Ci0J
c3RydWN0IHByZWVtcHRfY2xpZW50IGNsaWVudFs0XTsKLQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
cVtBUlJBWV9TSVpFKGNsaWVudCldID0ge307Ci0Jc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lOwotCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwotCWludCBlcnIgPSAtRU5PTUVNOwotCWlu
dCBpOwotCi0JLyoKLQkgKiBXYWl0ZXJzIGFyZSBnaXZlbiBhIGxpdHRsZSBwcmlvcml0eSBudWRn
ZSwgYnV0IG5vdCBlbm91Z2gKLQkgKiB0byBhY3R1YWxseSBjYXVzZSBhbnkgcHJlZW1wdGlvbi4g
RG91YmxlIGNoZWNrIHRoYXQgd2UgZG8KLQkgKiBub3QgbmVlZGxlc3NseSBnZW5lcmF0ZSBwcmVl
bXB0LXRvLWlkbGUgY3ljbGVzLgotCSAqLwotCi0JaWYgKCFIQVNfTE9HSUNBTF9SSU5HX1BSRUVN
UFRJT04oZ3QtPmk5MTUpKQotCQlyZXR1cm4gMDsKLQotCWlmIChwcmVlbXB0X2NsaWVudF9pbml0
KGd0LCAmY2xpZW50WzBdKSkgLyogRUxTUFswXSAqLwotCQlyZXR1cm4gLUVOT01FTTsKLQlpZiAo
cHJlZW1wdF9jbGllbnRfaW5pdChndCwgJmNsaWVudFsxXSkpIC8qIEVMU1BbMV0gKi8KLQkJZ290
byBlcnJfY2xpZW50XzA7Ci0JaWYgKHByZWVtcHRfY2xpZW50X2luaXQoZ3QsICZjbGllbnRbMl0p
KSAvKiBoZWFkIG9mIHF1ZXVlICovCi0JCWdvdG8gZXJyX2NsaWVudF8xOwotCWlmIChwcmVlbXB0
X2NsaWVudF9pbml0KGd0LCAmY2xpZW50WzNdKSkgLyogYnlzdGFuZGVyICovCi0JCWdvdG8gZXJy
X2NsaWVudF8yOwotCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7Ci0JCWludCBk
ZXB0aDsKLQotCQlpZiAoIWludGVsX2VuZ2luZV9oYXNfcHJlZW1wdGlvbihlbmdpbmUpKQotCQkJ
Y29udGludWU7Ci0KLQkJaWYgKCFlbmdpbmUtPmVtaXRfaW5pdF9icmVhZGNydW1iKQotCQkJY29u
dGludWU7Ci0KLQkJZm9yIChkZXB0aCA9IDA7IGRlcHRoIDwgQVJSQVlfU0laRShjbGllbnQpOyBk
ZXB0aCsrKSB7Ci0JCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpkdW1teTsKLQotCQkJZW5naW5lLT5l
eGVjbGlzdHMucHJlZW1wdF9oYW5nLmNvdW50ID0gMDsKLQotCQkJZHVtbXkgPSBkdW1teV9yZXF1
ZXN0KGVuZ2luZSk7Ci0JCQlpZiAoIWR1bW15KQotCQkJCWdvdG8gZXJyX2NsaWVudF8zOwotCi0J
CQlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShjbGllbnQpOyBpKyspIHsKLQkJCQlzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICp0aGlzOwotCi0JCQkJdGhpcyA9IHNwaW5uZXJfY3JlYXRlX3JlcXVlc3Qo
JmNsaWVudFtpXS5zcGluLAotCQkJCQkJCSAgICAgIGNsaWVudFtpXS5jdHgsIGVuZ2luZSwKLQkJ
CQkJCQkgICAgICBNSV9OT09QKTsKLQkJCQlpZiAoSVNfRVJSKHRoaXMpKSB7Ci0JCQkJCWVyciA9
IFBUUl9FUlIodGhpcyk7Ci0JCQkJCWdvdG8gZXJyX3dlZGdlZDsKLQkJCQl9Ci0KLQkJCQkvKiBE
aXNhYmxlIE5FV0NMSUVOVCBwcm9tb3Rpb24gKi8KLQkJCQlfX2k5MTVfYWN0aXZlX2ZlbmNlX3Nl
dCgmaTkxNV9yZXF1ZXN0X3RpbWVsaW5lKHRoaXMpLT5sYXN0X3JlcXVlc3QsCi0JCQkJCQkJJmR1
bW15LT5mZW5jZSk7Ci0KLQkJCQlycVtpXSA9IGk5MTVfcmVxdWVzdF9nZXQodGhpcyk7Ci0JCQkJ
aTkxNV9yZXF1ZXN0X2FkZCh0aGlzKTsKLQkJCX0KLQotCQkJZHVtbXlfcmVxdWVzdF9mcmVlKGR1
bW15KTsKLQotCQkJR0VNX0JVR19PTihpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJxWzBdKSk7Ci0J
CQlpZiAoIWlndF93YWl0X2Zvcl9zcGlubmVyKCZjbGllbnRbMF0uc3BpbiwgcnFbMF0pKSB7Ci0J
CQkJcHJfZXJyKCIlczogRmlyc3QgY2xpZW50IGZhaWxlZCB0byBzdGFydFxuIiwKLQkJCQkgICAg
ICAgZW5naW5lLT5uYW1lKTsKLQkJCQlnb3RvIGVycl93ZWRnZWQ7Ci0JCQl9Ci0JCQlHRU1fQlVH
X09OKCFpOTE1X3JlcXVlc3Rfc3RhcnRlZChycVswXSkpOwotCi0JCQlpZiAoaTkxNV9yZXF1ZXN0
X3dhaXQocnFbZGVwdGhdLAotCQkJCQkgICAgICBJOTE1X1dBSVRfUFJJT1JJVFksCi0JCQkJCSAg
ICAgIDEpICE9IC1FVElNRSkgewotCQkJCXByX2VycigiJXM6IFdhaXRlciBkZXB0aDolZCBjb21w
bGV0ZWQhXG4iLAotCQkJCSAgICAgICBlbmdpbmUtPm5hbWUsIGRlcHRoKTsKLQkJCQlnb3RvIGVy
cl93ZWRnZWQ7Ci0JCQl9Ci0KLQkJCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGNsaWVudCk7
IGkrKykgewotCQkJCWlndF9zcGlubmVyX2VuZCgmY2xpZW50W2ldLnNwaW4pOwotCQkJCWk5MTVf
cmVxdWVzdF9wdXQocnFbaV0pOwotCQkJCXJxW2ldID0gTlVMTDsKLQkJCX0KLQotCQkJaWYgKGln
dF9mbHVzaF90ZXN0KGd0LT5pOTE1KSkKLQkJCQlnb3RvIGVycl93ZWRnZWQ7Ci0KLQkJCWlmIChl
bmdpbmUtPmV4ZWNsaXN0cy5wcmVlbXB0X2hhbmcuY291bnQpIHsKLQkJCQlwcl9lcnIoIiVzOiBQ
cmVlbXB0aW9uIHJlY29yZGVkIHglZCwgZGVwdGggJWQ7IHNob3VsZCBoYXZlIGJlZW4gc3VwcHJl
c3NlZCFcbiIsCi0JCQkJICAgICAgIGVuZ2luZS0+bmFtZSwKLQkJCQkgICAgICAgZW5naW5lLT5l
eGVjbGlzdHMucHJlZW1wdF9oYW5nLmNvdW50LAotCQkJCSAgICAgICBkZXB0aCk7Ci0JCQkJZXJy
ID0gLUVJTlZBTDsKLQkJCQlnb3RvIGVycl9jbGllbnRfMzsKLQkJCX0KLQkJfQotCX0KLQotCWVy
ciA9IDA7Ci1lcnJfY2xpZW50XzM6Ci0JcHJlZW1wdF9jbGllbnRfZmluaSgmY2xpZW50WzNdKTsK
LWVycl9jbGllbnRfMjoKLQlwcmVlbXB0X2NsaWVudF9maW5pKCZjbGllbnRbMl0pOwotZXJyX2Ns
aWVudF8xOgotCXByZWVtcHRfY2xpZW50X2ZpbmkoJmNsaWVudFsxXSk7Ci1lcnJfY2xpZW50XzA6
Ci0JcHJlZW1wdF9jbGllbnRfZmluaSgmY2xpZW50WzBdKTsKLQlyZXR1cm4gZXJyOwotCi1lcnJf
d2VkZ2VkOgotCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGNsaWVudCk7IGkrKykgewotCQlp
Z3Rfc3Bpbm5lcl9lbmQoJmNsaWVudFtpXS5zcGluKTsKLQkJaTkxNV9yZXF1ZXN0X3B1dChycVtp
XSk7Ci0JfQotCWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOwotCWVyciA9IC1FSU87Ci0JZ290byBl
cnJfY2xpZW50XzM7Ci19Ci0KLXN0YXRpYyBpbnQgbGl2ZV9jaGFpbl9wcmVlbXB0KHZvaWQgKmFy
ZykKLXsKLQlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwotCXN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmVuZ2luZTsKLQlzdHJ1Y3QgcHJlZW1wdF9jbGllbnQgaGksIGxvOwotCWVudW0gaW50ZWxf
ZW5naW5lX2lkIGlkOwotCWludCBlcnIgPSAtRU5PTUVNOwotCi0JLyoKLQkgKiBCdWlsZCBhIGNo
YWluIEFCLi4uQkEgYmV0d2VlbiB0d28gY29udGV4dHMgKEEsIEIpIGFuZCByZXF1ZXN0Ci0JICog
cHJlZW1wdGlvbiBvZiB0aGUgbGFzdCByZXF1ZXN0LiBJdCBzaG91bGQgdGhlbiBjb21wbGV0ZSBi
ZWZvcmUKLQkgKiB0aGUgcHJldmlvdXNseSBzdWJtaXR0ZWQgc3Bpbm5lciBpbiBCLgotCSAqLwot
Ci0JaWYgKCFIQVNfTE9HSUNBTF9SSU5HX1BSRUVNUFRJT04oZ3QtPmk5MTUpKQotCQlyZXR1cm4g
MDsKLQotCWlmIChwcmVlbXB0X2NsaWVudF9pbml0KGd0LCAmaGkpKQotCQlyZXR1cm4gLUVOT01F
TTsKLQotCWlmIChwcmVlbXB0X2NsaWVudF9pbml0KGd0LCAmbG8pKQotCQlnb3RvIGVycl9jbGll
bnRfaGk7Ci0KLQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwgaWQpIHsKLQkJc3RydWN0IGk5
MTVfc2NoZWRfYXR0ciBhdHRyID0gewotCQkJLnByaW9yaXR5ID0gSTkxNV9VU0VSX1BSSU9SSVRZ
KEk5MTVfUFJJT1JJVFlfTUFYKSwKLQkJfTsKLQkJc3RydWN0IGlndF9saXZlX3Rlc3QgdDsKLQkJ
c3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7Ci0JCWludCByaW5nX3NpemUsIGNvdW50LCBpOwotCi0J
CWlmICghaW50ZWxfZW5naW5lX2hhc19wcmVlbXB0aW9uKGVuZ2luZSkpCi0JCQljb250aW51ZTsK
LQotCQlycSA9IHNwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJmxvLnNwaW4sCi0JCQkJCSAgICBsby5j
dHgsIGVuZ2luZSwKLQkJCQkJICAgIE1JX0FSQl9DSEVDSyk7Ci0JCWlmIChJU19FUlIocnEpKQot
CQkJZ290byBlcnJfd2VkZ2VkOwotCi0JCWk5MTVfcmVxdWVzdF9nZXQocnEpOwotCQlpOTE1X3Jl
cXVlc3RfYWRkKHJxKTsKLQotCQlyaW5nX3NpemUgPSBycS0+d2FfdGFpbCAtIHJxLT5oZWFkOwot
CQlpZiAocmluZ19zaXplIDwgMCkKLQkJCXJpbmdfc2l6ZSArPSBycS0+cmluZy0+c2l6ZTsKLQkJ
cmluZ19zaXplID0gcnEtPnJpbmctPnNpemUgLyByaW5nX3NpemU7Ci0JCXByX2RlYnVnKCIlcygl
cyk6IFVzaW5nIG1heGltdW0gb2YgJWQgcmVxdWVzdHNcbiIsCi0JCQkgX19mdW5jX18sIGVuZ2lu
ZS0+bmFtZSwgcmluZ19zaXplKTsKLQotCQlpZ3Rfc3Bpbm5lcl9lbmQoJmxvLnNwaW4pOwotCQlp
ZiAoaTkxNV9yZXF1ZXN0X3dhaXQocnEsIDAsIEhaIC8gMikgPCAwKSB7Ci0JCQlwcl9lcnIoIlRp
bWVkIG91dCB3YWl0aW5nIHRvIGZsdXNoICVzXG4iLCBlbmdpbmUtPm5hbWUpOwotCQkJaTkxNV9y
ZXF1ZXN0X3B1dChycSk7Ci0JCQlnb3RvIGVycl93ZWRnZWQ7Ci0JCX0KLQkJaTkxNV9yZXF1ZXN0
X3B1dChycSk7Ci0KLQkJaWYgKGlndF9saXZlX3Rlc3RfYmVnaW4oJnQsIGd0LT5pOTE1LCBfX2Z1
bmNfXywgZW5naW5lLT5uYW1lKSkgewotCQkJZXJyID0gLUVJTzsKLQkJCWdvdG8gZXJyX3dlZGdl
ZDsKLQkJfQotCi0JCWZvcl9lYWNoX3ByaW1lX251bWJlcl9mcm9tKGNvdW50LCAxLCByaW5nX3Np
emUpIHsKLQkJCXJxID0gc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmaGkuc3BpbiwKLQkJCQkJCSAg
ICBoaS5jdHgsIGVuZ2luZSwKLQkJCQkJCSAgICBNSV9BUkJfQ0hFQ0spOwotCQkJaWYgKElTX0VS
UihycSkpCi0JCQkJZ290byBlcnJfd2VkZ2VkOwotCQkJaTkxNV9yZXF1ZXN0X2FkZChycSk7Ci0J
CQlpZiAoIWlndF93YWl0X2Zvcl9zcGlubmVyKCZoaS5zcGluLCBycSkpCi0JCQkJZ290byBlcnJf
d2VkZ2VkOwotCi0JCQlycSA9IHNwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJmxvLnNwaW4sCi0JCQkJ
CQkgICAgbG8uY3R4LCBlbmdpbmUsCi0JCQkJCQkgICAgTUlfQVJCX0NIRUNLKTsKLQkJCWlmIChJ
U19FUlIocnEpKQotCQkJCWdvdG8gZXJyX3dlZGdlZDsKLQkJCWk5MTVfcmVxdWVzdF9hZGQocnEp
OwotCi0JCQlmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewotCQkJCXJxID0gaWd0X3JlcXVl
c3RfYWxsb2MobG8uY3R4LCBlbmdpbmUpOwotCQkJCWlmIChJU19FUlIocnEpKQotCQkJCQlnb3Rv
IGVycl93ZWRnZWQ7Ci0JCQkJaTkxNV9yZXF1ZXN0X2FkZChycSk7Ci0JCQl9Ci0KLQkJCXJxID0g
aWd0X3JlcXVlc3RfYWxsb2MoaGkuY3R4LCBlbmdpbmUpOwotCQkJaWYgKElTX0VSUihycSkpCi0J
CQkJZ290byBlcnJfd2VkZ2VkOwotCi0JCQlpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKLQkJCWk5MTVf
cmVxdWVzdF9hZGQocnEpOwotCQkJZW5naW5lLT5zY2hlZHVsZShycSwgJmF0dHIpOwotCi0JCQlp
Z3Rfc3Bpbm5lcl9lbmQoJmhpLnNwaW4pOwotCQkJaWYgKGk5MTVfcmVxdWVzdF93YWl0KHJxLCAw
LCBIWiAvIDUpIDwgMCkgewotCQkJCXN0cnVjdCBkcm1fcHJpbnRlciBwID0KLQkJCQkJZHJtX2lu
Zm9fcHJpbnRlcihndC0+aTkxNS0+ZHJtLmRldik7Ci0KLQkJCQlwcl9lcnIoIkZhaWxlZCB0byBw
cmVlbXB0IG92ZXIgY2hhaW4gb2YgJWRcbiIsCi0JCQkJICAgICAgIGNvdW50KTsKLQkJCQlpbnRl
bF9lbmdpbmVfZHVtcChlbmdpbmUsICZwLAotCQkJCQkJICAiJXNcbiIsIGVuZ2luZS0+bmFtZSk7
Ci0JCQkJaTkxNV9yZXF1ZXN0X3B1dChycSk7Ci0JCQkJZ290byBlcnJfd2VkZ2VkOwotCQkJfQot
CQkJaWd0X3NwaW5uZXJfZW5kKCZsby5zcGluKTsKLQkJCWk5MTVfcmVxdWVzdF9wdXQocnEpOwot
Ci0JCQlycSA9IGlndF9yZXF1ZXN0X2FsbG9jKGxvLmN0eCwgZW5naW5lKTsKLQkJCWlmIChJU19F
UlIocnEpKQotCQkJCWdvdG8gZXJyX3dlZGdlZDsKLQotCQkJaTkxNV9yZXF1ZXN0X2dldChycSk7
Ci0JCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKLQotCQkJaWYgKGk5MTVfcmVxdWVzdF93YWl0KHJx
LCAwLCBIWiAvIDUpIDwgMCkgewotCQkJCXN0cnVjdCBkcm1fcHJpbnRlciBwID0KLQkJCQkJZHJt
X2luZm9fcHJpbnRlcihndC0+aTkxNS0+ZHJtLmRldik7Ci0KLQkJCQlwcl9lcnIoIkZhaWxlZCB0
byBmbHVzaCBsb3cgcHJpb3JpdHkgY2hhaW4gb2YgJWQgcmVxdWVzdHNcbiIsCi0JCQkJICAgICAg
IGNvdW50KTsKLQkJCQlpbnRlbF9lbmdpbmVfZHVtcChlbmdpbmUsICZwLAotCQkJCQkJICAiJXNc
biIsIGVuZ2luZS0+bmFtZSk7Ci0KLQkJCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKLQkJCQlnb3Rv
IGVycl93ZWRnZWQ7Ci0JCQl9Ci0JCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKLQkJfQotCi0JCWlm
IChpZ3RfbGl2ZV90ZXN0X2VuZCgmdCkpIHsKLQkJCWVyciA9IC1FSU87Ci0JCQlnb3RvIGVycl93
ZWRnZWQ7Ci0JCX0KLQl9Ci0KLQllcnIgPSAwOwotZXJyX2NsaWVudF9sbzoKLQlwcmVlbXB0X2Ns
aWVudF9maW5pKCZsbyk7Ci1lcnJfY2xpZW50X2hpOgotCXByZWVtcHRfY2xpZW50X2ZpbmkoJmhp
KTsKLQlyZXR1cm4gZXJyOwotCi1lcnJfd2VkZ2VkOgotCWlndF9zcGlubmVyX2VuZCgmaGkuc3Bp
bik7Ci0JaWd0X3NwaW5uZXJfZW5kKCZsby5zcGluKTsKLQlpbnRlbF9ndF9zZXRfd2VkZ2VkKGd0
KTsKLQllcnIgPSAtRUlPOwotCWdvdG8gZXJyX2NsaWVudF9sbzsKLX0KLQotc3RhdGljIGludCBj
cmVhdGVfZ2FuZyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCi0JCSAgICAgICBzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICoqcHJldikKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqOwotCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKLQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
cTsKLQlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKLQl1MzIgKmNzOwotCWludCBlcnI7Ci0KLQljZSA9
IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZS0+a2VybmVsX2NvbnRleHQtPmdlbV9jb250ZXh0
LCBlbmdpbmUpOwotCWlmIChJU19FUlIoY2UpKQotCQlyZXR1cm4gUFRSX0VSUihjZSk7Ci0KLQlv
YmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGVuZ2luZS0+aTkxNSwgNDA5Nik7
Ci0JaWYgKElTX0VSUihvYmopKSB7Ci0JCWVyciA9IFBUUl9FUlIob2JqKTsKLQkJZ290byBlcnJf
Y2U7Ci0JfQotCi0Jdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCBjZS0+dm0sIE5VTEwpOwot
CWlmIChJU19FUlIodm1hKSkgewotCQllcnIgPSBQVFJfRVJSKHZtYSk7Ci0JCWdvdG8gZXJyX29i
ajsKLQl9Ci0KLQllcnIgPSBpOTE1X3ZtYV9waW4odm1hLCAwLCAwLCBQSU5fVVNFUik7Ci0JaWYg
KGVycikKLQkJZ290byBlcnJfb2JqOwotCi0JY3MgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChv
YmosIEk5MTVfTUFQX1dDKTsKLQlpZiAoSVNfRVJSKGNzKSkKLQkJZ290byBlcnJfb2JqOwotCi0J
LyogU2VtYXBob3JlIHRhcmdldDogc3BpbiB1bnRpbCB6ZXJvICovCi0JKmNzKysgPSBNSV9BUkJf
T05fT0ZGIHwgTUlfQVJCX0VOQUJMRTsKLQotCSpjcysrID0gTUlfU0VNQVBIT1JFX1dBSVQgfAot
CQlNSV9TRU1BUEhPUkVfUE9MTCB8Ci0JCU1JX1NFTUFQSE9SRV9TQURfRVFfU0REOwotCSpjcysr
ID0gMDsKLQkqY3MrKyA9IGxvd2VyXzMyX2JpdHModm1hLT5ub2RlLnN0YXJ0KTsKLQkqY3MrKyA9
IHVwcGVyXzMyX2JpdHModm1hLT5ub2RlLnN0YXJ0KTsKLQotCWlmICgqcHJldikgewotCQl1NjQg
b2Zmc2V0ID0gKCpwcmV2KS0+YmF0Y2gtPm5vZGUuc3RhcnQ7Ci0KLQkJLyogVGVybWluYXRlIHRo
ZSBzcGlubmVyIGluIHRoZSBuZXh0IGxvd2VyIHByaW9yaXR5IGJhdGNoLiAqLwotCQkqY3MrKyA9
IE1JX1NUT1JFX0RXT1JEX0lNTV9HRU40OwotCQkqY3MrKyA9IGxvd2VyXzMyX2JpdHMob2Zmc2V0
KTsKLQkJKmNzKysgPSB1cHBlcl8zMl9iaXRzKG9mZnNldCk7Ci0JCSpjcysrID0gMDsKLQl9Ci0K
LQkqY3MrKyA9IE1JX0JBVENIX0JVRkZFUl9FTkQ7Ci0JaTkxNV9nZW1fb2JqZWN0X2ZsdXNoX21h
cChvYmopOwotCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAob2JqKTsKLQotCXJxID0gaW50ZWxf
Y29udGV4dF9jcmVhdGVfcmVxdWVzdChjZSk7Ci0JaWYgKElTX0VSUihycSkpCi0JCWdvdG8gZXJy
X29iajsKLQotCXJxLT5iYXRjaCA9IHZtYTsKLQlpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKLQotCWk5
MTVfdm1hX2xvY2sodm1hKTsKLQllcnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfb2JqZWN0KHJxLCB2
bWEtPm9iaiwgZmFsc2UpOwotCWlmICghZXJyKQotCQllcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2Fj
dGl2ZSh2bWEsIHJxLCAwKTsKLQlpZiAoIWVycikKLQkJZXJyID0gcnEtPmVuZ2luZS0+ZW1pdF9i
Yl9zdGFydChycSwKLQkJCQkJCXZtYS0+bm9kZS5zdGFydCwKLQkJCQkJCVBBR0VfU0laRSwgMCk7
Ci0JaTkxNV92bWFfdW5sb2NrKHZtYSk7Ci0JaTkxNV9yZXF1ZXN0X2FkZChycSk7Ci0JaWYgKGVy
cikKLQkJZ290byBlcnJfcnE7Ci0KLQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7Ci0JaW50ZWxf
Y29udGV4dF9wdXQoY2UpOwotCi0JcnEtPmNsaWVudF9saW5rLm5leHQgPSAmKCpwcmV2KS0+Y2xp
ZW50X2xpbms7Ci0JKnByZXYgPSBycTsKLQlyZXR1cm4gMDsKLQotZXJyX3JxOgotCWk5MTVfcmVx
dWVzdF9wdXQocnEpOwotZXJyX29iajoKLQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7Ci1lcnJf
Y2U6Ci0JaW50ZWxfY29udGV4dF9wdXQoY2UpOwotCXJldHVybiBlcnI7Ci19Ci0KLXN0YXRpYyBp
bnQgbGl2ZV9wcmVlbXB0X2dhbmcodm9pZCAqYXJnKQotewotCXN0cnVjdCBpbnRlbF9ndCAqZ3Qg
PSBhcmc7Ci0Jc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCWVudW0gaW50ZWxfZW5n
aW5lX2lkIGlkOwotCi0JaWYgKCFIQVNfTE9HSUNBTF9SSU5HX1BSRUVNUFRJT04oZ3QtPmk5MTUp
KQotCQlyZXR1cm4gMDsKLQotCS8qCi0JICogQnVpbGQgYXMgbG9uZyBhIGNoYWluIG9mIHByZWVt
cHRlcnMgYXMgd2UgY2FuLCB3aXRoIGVhY2gKLQkgKiByZXF1ZXN0IGhpZ2hlciBwcmlvcml0eSB0
aGFuIHRoZSBsYXN0LiBPbmNlIHdlIGFyZSByZWFkeSwgd2UgcmVsZWFzZQotCSAqIHRoZSBsYXN0
IGJhdGNoIHdoaWNoIHRoZW4gcHJlY29sYXRlcyBkb3duIHRoZSBjaGFpbiwgZWFjaCByZWxlYXNp
bmcKLQkgKiB0aGUgbmV4dCBvbGRlc3QgaW4gdHVybi4gVGhlIGludGVudCBpcyB0byBzaW1wbHkg
cHVzaCBhcyBoYXJkIGFzIHdlCi0JICogY2FuIHdpdGggdGhlIG51bWJlciBvZiBwcmVlbXB0aW9u
cywgdHJ5aW5nIHRvIGV4Y2VlZCBuYXJyb3cgSFcKLQkgKiBsaW1pdHMuIEF0IGEgbWluaW11bSwg
d2UgaW5zaXN0IHRoYXQgd2UgY2FuIHNvcnQgYWxsIHRoZSB1c2VyCi0JICogaGlnaCBwcmlvcml0
eSBsZXZlbHMgaW50byBleGVjdXRpb24gb3JkZXIuCi0JICovCi0KLQlmb3JfZWFjaF9lbmdpbmUo
ZW5naW5lLCBndCwgaWQpIHsKLQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEgPSBOVUxMOwotCQlz
dHJ1Y3QgaWd0X2xpdmVfdGVzdCB0OwotCQlJR1RfVElNRU9VVChlbmRfdGltZSk7Ci0JCWludCBw
cmlvID0gMDsKLQkJaW50IGVyciA9IDA7Ci0JCXUzMiAqY3M7Ci0KLQkJaWYgKCFpbnRlbF9lbmdp
bmVfaGFzX3ByZWVtcHRpb24oZW5naW5lKSkKLQkJCWNvbnRpbnVlOwotCi0JCWlmIChpZ3RfbGl2
ZV90ZXN0X2JlZ2luKCZ0LCBndC0+aTkxNSwgX19mdW5jX18sIGVuZ2luZS0+bmFtZSkpCi0JCQly
ZXR1cm4gLUVJTzsKLQotCQlkbyB7Ci0JCQlzdHJ1Y3QgaTkxNV9zY2hlZF9hdHRyIGF0dHIgPSB7
Ci0JCQkJLnByaW9yaXR5ID0gSTkxNV9VU0VSX1BSSU9SSVRZKHByaW8rKyksCi0JCQl9OwotCi0J
CQllcnIgPSBjcmVhdGVfZ2FuZyhlbmdpbmUsICZycSk7Ci0JCQlpZiAoZXJyKQotCQkJCWJyZWFr
OwotCi0JCQkvKiBTdWJtaXQgZWFjaCBzcGlubmVyIGF0IGluY3JlYXNpbmcgcHJpb3JpdHkgKi8K
LQkJCWVuZ2luZS0+c2NoZWR1bGUocnEsICZhdHRyKTsKLQotCQkJaWYgKHByaW8gPD0gSTkxNV9Q
UklPUklUWV9NQVgpCi0JCQkJY29udGludWU7Ci0KLQkJCWlmIChwcmlvID4gKElOVF9NQVggPj4g
STkxNV9VU0VSX1BSSU9SSVRZX1NISUZUKSkKLQkJCQlicmVhazsKLQotCQkJaWYgKF9faWd0X3Rp
bWVvdXQoZW5kX3RpbWUsIE5VTEwpKQotCQkJCWJyZWFrOwotCQl9IHdoaWxlICgxKTsKLQkJcHJf
ZGVidWcoIiVzOiBQcmVlbXB0IGNoYWluIG9mICVkIHJlcXVlc3RzXG4iLAotCQkJIGVuZ2luZS0+
bmFtZSwgcHJpbyk7Ci0KLQkJLyoKLQkJICogU3VjaCB0aGF0IHRoZSBsYXN0IHNwaW5uZXIgaXMg
dGhlIGhpZ2hlc3QgcHJpb3JpdHkgYW5kCi0JCSAqIHNob3VsZCBleGVjdXRlIGZpcnN0LiBXaGVu
IHRoYXQgc3Bpbm5lciBjb21wbGV0ZXMsCi0JCSAqIGl0IHdpbGwgdGVybWluYXRlIHRoZSBuZXh0
IGxvd2VzdCBzcGlubmVyIHVudGlsIHRoZXJlCi0JCSAqIGFyZSBubyBtb3JlIHNwaW5uZXJzIGFu
ZCB0aGUgZ2FuZyBpcyBjb21wbGV0ZS4KLQkJICovCi0JCWNzID0gaTkxNV9nZW1fb2JqZWN0X3Bp
bl9tYXAocnEtPmJhdGNoLT5vYmosIEk5MTVfTUFQX1dDKTsKLQkJaWYgKCFJU19FUlIoY3MpKSB7
Ci0JCQkqY3MgPSAwOwotCQkJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChycS0+YmF0Y2gtPm9i
aik7Ci0JCX0gZWxzZSB7Ci0JCQllcnIgPSBQVFJfRVJSKGNzKTsKLQkJCWludGVsX2d0X3NldF93
ZWRnZWQoZ3QpOwotCQl9Ci0KLQkJd2hpbGUgKHJxKSB7IC8qIHdhaXQgZm9yIGVhY2ggcnEgZnJv
bSBoaWdoZXN0IHRvIGxvd2VzdCBwcmlvICovCi0JCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpuID0K
LQkJCQlsaXN0X25leHRfZW50cnkocnEsIGNsaWVudF9saW5rKTsKLQotCQkJaWYgKGVyciA9PSAw
ICYmIGk5MTVfcmVxdWVzdF93YWl0KHJxLCAwLCBIWiAvIDUpIDwgMCkgewotCQkJCXN0cnVjdCBk
cm1fcHJpbnRlciBwID0KLQkJCQkJZHJtX2luZm9fcHJpbnRlcihlbmdpbmUtPmk5MTUtPmRybS5k
ZXYpOwotCi0JCQkJcHJfZXJyKCJGYWlsZWQgdG8gZmx1c2ggY2hhaW4gb2YgJWQgcmVxdWVzdHMs
IGF0ICVkXG4iLAotCQkJCSAgICAgICBwcmlvLCBycV9wcmlvKHJxKSA+PiBJOTE1X1VTRVJfUFJJ
T1JJVFlfU0hJRlQpOwotCQkJCWludGVsX2VuZ2luZV9kdW1wKGVuZ2luZSwgJnAsCi0JCQkJCQkg
ICIlc1xuIiwgZW5naW5lLT5uYW1lKTsKLQotCQkJCWVyciA9IC1FVElNRTsKLQkJCX0KLQotCQkJ
aTkxNV9yZXF1ZXN0X3B1dChycSk7Ci0JCQlycSA9IG47Ci0JCX0KLQotCQlpZiAoaWd0X2xpdmVf
dGVzdF9lbmQoJnQpKQotCQkJZXJyID0gLUVJTzsKLQkJaWYgKGVycikKLQkJCXJldHVybiBlcnI7
Ci0JfQotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQgbGl2ZV9wcmVlbXB0X2hhbmcodm9p
ZCAqYXJnKQotewotCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7Ci0Jc3RydWN0IGk5MTVfZ2Vt
X2NvbnRleHQgKmN0eF9oaSwgKmN0eF9sbzsKLQlzdHJ1Y3QgaWd0X3NwaW5uZXIgc3Bpbl9oaSwg
c3Bpbl9sbzsKLQlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7Ci0JZW51bSBpbnRlbF9l
bmdpbmVfaWQgaWQ7Ci0JaW50IGVyciA9IC1FTk9NRU07Ci0KLQlpZiAoIUhBU19MT0dJQ0FMX1JJ
TkdfUFJFRU1QVElPTihndC0+aTkxNSkpCi0JCXJldHVybiAwOwotCi0JaWYgKCFpbnRlbF9oYXNf
cmVzZXRfZW5naW5lKGd0KSkKLQkJcmV0dXJuIDA7Ci0KLQlpZiAoaWd0X3NwaW5uZXJfaW5pdCgm
c3Bpbl9oaSwgZ3QpKQotCQlyZXR1cm4gLUVOT01FTTsKLQotCWlmIChpZ3Rfc3Bpbm5lcl9pbml0
KCZzcGluX2xvLCBndCkpCi0JCWdvdG8gZXJyX3NwaW5faGk7Ci0KLQljdHhfaGkgPSBrZXJuZWxf
Y29udGV4dChndC0+aTkxNSk7Ci0JaWYgKCFjdHhfaGkpCi0JCWdvdG8gZXJyX3NwaW5fbG87Ci0J
Y3R4X2hpLT5zY2hlZC5wcmlvcml0eSA9Ci0JCUk5MTVfVVNFUl9QUklPUklUWShJOTE1X0NPTlRF
WFRfTUFYX1VTRVJfUFJJT1JJVFkpOwotCi0JY3R4X2xvID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5
MTUpOwotCWlmICghY3R4X2xvKQotCQlnb3RvIGVycl9jdHhfaGk7Ci0JY3R4X2xvLT5zY2hlZC5w
cmlvcml0eSA9Ci0JCUk5MTVfVVNFUl9QUklPUklUWShJOTE1X0NPTlRFWFRfTUlOX1VTRVJfUFJJ
T1JJVFkpOwotCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7Ci0JCXN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxOwotCi0JCWlmICghaW50ZWxfZW5naW5lX2hhc19wcmVlbXB0aW9uKGVu
Z2luZSkpCi0JCQljb250aW51ZTsKLQotCQlycSA9IHNwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJnNw
aW5fbG8sIGN0eF9sbywgZW5naW5lLAotCQkJCQkgICAgTUlfQVJCX0NIRUNLKTsKLQkJaWYgKElT
X0VSUihycSkpIHsKLQkJCWVyciA9IFBUUl9FUlIocnEpOwotCQkJZ290byBlcnJfY3R4X2xvOwot
CQl9Ci0KLQkJaTkxNV9yZXF1ZXN0X2FkZChycSk7Ci0JCWlmICghaWd0X3dhaXRfZm9yX3NwaW5u
ZXIoJnNwaW5fbG8sIHJxKSkgewotCQkJR0VNX1RSQUNFKCJsbyBzcGlubmVyIGZhaWxlZCB0byBz
dGFydFxuIik7Ci0JCQlHRU1fVFJBQ0VfRFVNUCgpOwotCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChn
dCk7Ci0JCQllcnIgPSAtRUlPOwotCQkJZ290byBlcnJfY3R4X2xvOwotCQl9Ci0KLQkJcnEgPSBz
cGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZzcGluX2hpLCBjdHhfaGksIGVuZ2luZSwKLQkJCQkJICAg
IE1JX0FSQl9DSEVDSyk7Ci0JCWlmIChJU19FUlIocnEpKSB7Ci0JCQlpZ3Rfc3Bpbm5lcl9lbmQo
JnNwaW5fbG8pOwotCQkJZXJyID0gUFRSX0VSUihycSk7Ci0JCQlnb3RvIGVycl9jdHhfbG87Ci0J
CX0KLQotCQlpbml0X2NvbXBsZXRpb24oJmVuZ2luZS0+ZXhlY2xpc3RzLnByZWVtcHRfaGFuZy5j
b21wbGV0aW9uKTsKLQkJZW5naW5lLT5leGVjbGlzdHMucHJlZW1wdF9oYW5nLmluamVjdF9oYW5n
ID0gdHJ1ZTsKLQotCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKLQotCQlpZiAoIXdhaXRfZm9yX2Nv
bXBsZXRpb25fdGltZW91dCgmZW5naW5lLT5leGVjbGlzdHMucHJlZW1wdF9oYW5nLmNvbXBsZXRp
b24sCi0JCQkJCQkgSFogLyAxMCkpIHsKLQkJCXByX2VycigiUHJlZW1wdGlvbiBkaWQgbm90IG9j
Y3VyIHdpdGhpbiB0aW1lb3V0ISIpOwotCQkJR0VNX1RSQUNFX0RVTVAoKTsKLQkJCWludGVsX2d0
X3NldF93ZWRnZWQoZ3QpOwotCQkJZXJyID0gLUVJTzsKLQkJCWdvdG8gZXJyX2N0eF9sbzsKLQkJ
fQotCi0JCXNldF9iaXQoSTkxNV9SRVNFVF9FTkdJTkUgKyBpZCwgJmd0LT5yZXNldC5mbGFncyk7
Ci0JCWludGVsX2VuZ2luZV9yZXNldChlbmdpbmUsIE5VTEwpOwotCQljbGVhcl9iaXQoSTkxNV9S
RVNFVF9FTkdJTkUgKyBpZCwgJmd0LT5yZXNldC5mbGFncyk7Ci0KLQkJZW5naW5lLT5leGVjbGlz
dHMucHJlZW1wdF9oYW5nLmluamVjdF9oYW5nID0gZmFsc2U7Ci0KLQkJaWYgKCFpZ3Rfd2FpdF9m
b3Jfc3Bpbm5lcigmc3Bpbl9oaSwgcnEpKSB7Ci0JCQlHRU1fVFJBQ0UoImhpIHNwaW5uZXIgZmFp
bGVkIHRvIHN0YXJ0XG4iKTsKLQkJCUdFTV9UUkFDRV9EVU1QKCk7Ci0JCQlpbnRlbF9ndF9zZXRf
d2VkZ2VkKGd0KTsKLQkJCWVyciA9IC1FSU87Ci0JCQlnb3RvIGVycl9jdHhfbG87Ci0JCX0KLQot
CQlpZ3Rfc3Bpbm5lcl9lbmQoJnNwaW5faGkpOwotCQlpZ3Rfc3Bpbm5lcl9lbmQoJnNwaW5fbG8p
OwotCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpKSB7Ci0JCQllcnIgPSAtRUlPOwotCQkJ
Z290byBlcnJfY3R4X2xvOwotCQl9Ci0JfQotCi0JZXJyID0gMDsKLWVycl9jdHhfbG86Ci0Ja2Vy
bmVsX2NvbnRleHRfY2xvc2UoY3R4X2xvKTsKLWVycl9jdHhfaGk6Ci0Ja2VybmVsX2NvbnRleHRf
Y2xvc2UoY3R4X2hpKTsKLWVycl9zcGluX2xvOgotCWlndF9zcGlubmVyX2ZpbmkoJnNwaW5fbG8p
OwotZXJyX3NwaW5faGk6Ci0JaWd0X3NwaW5uZXJfZmluaSgmc3Bpbl9oaSk7Ci0JcmV0dXJuIGVy
cjsKLX0KLQotc3RhdGljIGludCBsaXZlX3ByZWVtcHRfdGltZW91dCh2b2lkICphcmcpCi17Ci0J
c3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4
X2hpLCAqY3R4X2xvOwotCXN0cnVjdCBpZ3Rfc3Bpbm5lciBzcGluX2xvOwotCXN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKmVuZ2luZTsKLQllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKLQlpbnQgZXJy
ID0gLUVOT01FTTsKLQotCS8qCi0JICogQ2hlY2sgdGhhdCB3ZSBmb3JjZSBwcmVlbXB0aW9uIHRv
IG9jY3VyIGJ5IGNhbmNlbGxpbmcgdGhlIHByZXZpb3VzCi0JICogY29udGV4dCBpZiBpdCByZWZ1
c2VzIHRvIHlpZWxkIHRoZSBHUFUuCi0JICovCi0JaWYgKCFJU19BQ1RJVkUoQ09ORklHX0RSTV9J
OTE1X1BSRUVNUFRfVElNRU9VVCkpCi0JCXJldHVybiAwOwotCi0JaWYgKCFIQVNfTE9HSUNBTF9S
SU5HX1BSRUVNUFRJT04oZ3QtPmk5MTUpKQotCQlyZXR1cm4gMDsKLQotCWlmICghaW50ZWxfaGFz
X3Jlc2V0X2VuZ2luZShndCkpCi0JCXJldHVybiAwOwotCi0JaWYgKGlndF9zcGlubmVyX2luaXQo
JnNwaW5fbG8sIGd0KSkKLQkJcmV0dXJuIC1FTk9NRU07Ci0KLQljdHhfaGkgPSBrZXJuZWxfY29u
dGV4dChndC0+aTkxNSk7Ci0JaWYgKCFjdHhfaGkpCi0JCWdvdG8gZXJyX3NwaW5fbG87Ci0JY3R4
X2hpLT5zY2hlZC5wcmlvcml0eSA9Ci0JCUk5MTVfVVNFUl9QUklPUklUWShJOTE1X0NPTlRFWFRf
TUFYX1VTRVJfUFJJT1JJVFkpOwotCi0JY3R4X2xvID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUp
OwotCWlmICghY3R4X2xvKQotCQlnb3RvIGVycl9jdHhfaGk7Ci0JY3R4X2xvLT5zY2hlZC5wcmlv
cml0eSA9Ci0JCUk5MTVfVVNFUl9QUklPUklUWShJOTE1X0NPTlRFWFRfTUlOX1VTRVJfUFJJT1JJ
VFkpOwotCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7Ci0JCXVuc2lnbmVkIGxv
bmcgc2F2ZWRfdGltZW91dDsKLQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7Ci0KLQkJaWYgKCFp
bnRlbF9lbmdpbmVfaGFzX3ByZWVtcHRpb24oZW5naW5lKSkKLQkJCWNvbnRpbnVlOwotCi0JCXJx
ID0gc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmc3Bpbl9sbywgY3R4X2xvLCBlbmdpbmUsCi0JCQkJ
CSAgICBNSV9OT09QKTsgLyogcHJlZW1wdGlvbiBkaXNhYmxlZCAqLwotCQlpZiAoSVNfRVJSKHJx
KSkgewotCQkJZXJyID0gUFRSX0VSUihycSk7Ci0JCQlnb3RvIGVycl9jdHhfbG87Ci0JCX0KLQot
CQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKLQkJaWYgKCFpZ3Rfd2FpdF9mb3Jfc3Bpbm5lcigmc3Bp
bl9sbywgcnEpKSB7Ci0JCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKGd0KTsKLQkJCWVyciA9IC1FSU87
Ci0JCQlnb3RvIGVycl9jdHhfbG87Ci0JCX0KLQotCQlycSA9IGlndF9yZXF1ZXN0X2FsbG9jKGN0
eF9oaSwgZW5naW5lKTsKLQkJaWYgKElTX0VSUihycSkpIHsKLQkJCWlndF9zcGlubmVyX2VuZCgm
c3Bpbl9sbyk7Ci0JCQllcnIgPSBQVFJfRVJSKHJxKTsKLQkJCWdvdG8gZXJyX2N0eF9sbzsKLQkJ
fQotCi0JCS8qIEZsdXNoIHRoZSBwcmV2aW91cyBDUyBhY2sgYmVmb3JlIGNoYW5naW5nIHRpbWVv
dXRzICovCi0JCXdoaWxlIChSRUFEX09OQ0UoZW5naW5lLT5leGVjbGlzdHMucGVuZGluZ1swXSkp
Ci0JCQljcHVfcmVsYXgoKTsKLQotCQlzYXZlZF90aW1lb3V0ID0gZW5naW5lLT5wcm9wcy5wcmVl
bXB0X3RpbWVvdXRfbXM7Ci0JCWVuZ2luZS0+cHJvcHMucHJlZW1wdF90aW1lb3V0X21zID0gMTsg
LyogaW4gbXMsIC0+IDEgamlmZmllICovCi0KLQkJaTkxNV9yZXF1ZXN0X2dldChycSk7Ci0JCWk5
MTVfcmVxdWVzdF9hZGQocnEpOwotCi0JCWludGVsX2VuZ2luZV9mbHVzaF9zdWJtaXNzaW9uKGVu
Z2luZSk7Ci0JCWVuZ2luZS0+cHJvcHMucHJlZW1wdF90aW1lb3V0X21zID0gc2F2ZWRfdGltZW91
dDsKLQotCQlpZiAoaTkxNV9yZXF1ZXN0X3dhaXQocnEsIDAsIEhaIC8gMTApIDwgMCkgewotCQkJ
aW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7Ci0JCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKLQkJCWVy
ciA9IC1FVElNRTsKLQkJCWdvdG8gZXJyX2N0eF9sbzsKLQkJfQotCi0JCWlndF9zcGlubmVyX2Vu
ZCgmc3Bpbl9sbyk7Ci0JCWk5MTVfcmVxdWVzdF9wdXQocnEpOwotCX0KLQotCWVyciA9IDA7Ci1l
cnJfY3R4X2xvOgotCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eF9sbyk7Ci1lcnJfY3R4X2hpOgot
CWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eF9oaSk7Ci1lcnJfc3Bpbl9sbzoKLQlpZ3Rfc3Bpbm5l
cl9maW5pKCZzcGluX2xvKTsKLQlyZXR1cm4gZXJyOwotfQotCi1zdGF0aWMgaW50IHJhbmRvbV9y
YW5nZShzdHJ1Y3Qgcm5kX3N0YXRlICpybmQsIGludCBtaW4sIGludCBtYXgpCi17Ci0JcmV0dXJu
IGk5MTVfcHJhbmRvbV91MzJfbWF4X3N0YXRlKG1heCAtIG1pbiwgcm5kKSArIG1pbjsKLX0KLQot
c3RhdGljIGludCByYW5kb21fcHJpb3JpdHkoc3RydWN0IHJuZF9zdGF0ZSAqcm5kKQotewotCXJl
dHVybiByYW5kb21fcmFuZ2Uocm5kLCBJOTE1X1BSSU9SSVRZX01JTiwgSTkxNV9QUklPUklUWV9N
QVgpOwotfQotCi1zdHJ1Y3QgcHJlZW1wdF9zbW9rZSB7Ci0Jc3RydWN0IGludGVsX2d0ICpndDsK
LQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqKmNvbnRleHRzOwotCXN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZTsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqYmF0Y2g7Ci0JdW5z
aWduZWQgaW50IG5jb250ZXh0OwotCXN0cnVjdCBybmRfc3RhdGUgcHJuZzsKLQl1bnNpZ25lZCBs
b25nIGNvdW50OwotfTsKLQotc3RhdGljIHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpzbW9rZV9j
b250ZXh0KHN0cnVjdCBwcmVlbXB0X3Ntb2tlICpzbW9rZSkKLXsKLQlyZXR1cm4gc21va2UtPmNv
bnRleHRzW2k5MTVfcHJhbmRvbV91MzJfbWF4X3N0YXRlKHNtb2tlLT5uY29udGV4dCwKLQkJCQkJ
CQkgICZzbW9rZS0+cHJuZyldOwotfQotCi1zdGF0aWMgaW50IHNtb2tlX3N1Ym1pdChzdHJ1Y3Qg
cHJlZW1wdF9zbW9rZSAqc21va2UsCi0JCQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LCBp
bnQgcHJpbywKLQkJCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpiYXRjaCkKLXsKLQlzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycTsKLQlzdHJ1Y3QgaTkxNV92bWEgKnZtYSA9IE5VTEw7Ci0JaW50
IGVyciA9IDA7Ci0KLQlpZiAoYmF0Y2gpIHsKLQkJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAq
dm07Ci0KLQkJdm0gPSBpOTE1X2dlbV9jb250ZXh0X2dldF92bV9yY3UoY3R4KTsKLQkJdm1hID0g
aTkxNV92bWFfaW5zdGFuY2UoYmF0Y2gsIHZtLCBOVUxMKTsKLQkJaTkxNV92bV9wdXQodm0pOwot
CQlpZiAoSVNfRVJSKHZtYSkpCi0JCQlyZXR1cm4gUFRSX0VSUih2bWEpOwotCi0JCWVyciA9IGk5
MTVfdm1hX3Bpbih2bWEsIDAsIDAsIFBJTl9VU0VSKTsKLQkJaWYgKGVycikKLQkJCXJldHVybiBl
cnI7Ci0JfQotCi0JY3R4LT5zY2hlZC5wcmlvcml0eSA9IHByaW87Ci0KLQlycSA9IGlndF9yZXF1
ZXN0X2FsbG9jKGN0eCwgc21va2UtPmVuZ2luZSk7Ci0JaWYgKElTX0VSUihycSkpIHsKLQkJZXJy
ID0gUFRSX0VSUihycSk7Ci0JCWdvdG8gdW5waW47Ci0JfQotCi0JaWYgKHZtYSkgewotCQlpOTE1
X3ZtYV9sb2NrKHZtYSk7Ci0JCWVyciA9IGk5MTVfcmVxdWVzdF9hd2FpdF9vYmplY3QocnEsIHZt
YS0+b2JqLCBmYWxzZSk7Ci0JCWlmICghZXJyKQotCQkJZXJyID0gaTkxNV92bWFfbW92ZV90b19h
Y3RpdmUodm1hLCBycSwgMCk7Ci0JCWlmICghZXJyKQotCQkJZXJyID0gcnEtPmVuZ2luZS0+ZW1p
dF9iYl9zdGFydChycSwKLQkJCQkJCQl2bWEtPm5vZGUuc3RhcnQsCi0JCQkJCQkJUEFHRV9TSVpF
LCAwKTsKLQkJaTkxNV92bWFfdW5sb2NrKHZtYSk7Ci0JfQotCi0JaTkxNV9yZXF1ZXN0X2FkZChy
cSk7Ci0KLXVucGluOgotCWlmICh2bWEpCi0JCWk5MTVfdm1hX3VucGluKHZtYSk7Ci0KLQlyZXR1
cm4gZXJyOwotfQotCi1zdGF0aWMgaW50IHNtb2tlX2NyZXNjZW5kb190aHJlYWQodm9pZCAqYXJn
KQotewotCXN0cnVjdCBwcmVlbXB0X3Ntb2tlICpzbW9rZSA9IGFyZzsKLQlJR1RfVElNRU9VVChl
bmRfdGltZSk7Ci0JdW5zaWduZWQgbG9uZyBjb3VudDsKLQotCWNvdW50ID0gMDsKLQlkbyB7Ci0J
CXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHggPSBzbW9rZV9jb250ZXh0KHNtb2tlKTsKLQkJ
aW50IGVycjsKLQotCQllcnIgPSBzbW9rZV9zdWJtaXQoc21va2UsCi0JCQkJICAgY3R4LCBjb3Vu
dCAlIEk5MTVfUFJJT1JJVFlfTUFYLAotCQkJCSAgIHNtb2tlLT5iYXRjaCk7Ci0JCWlmIChlcnIp
Ci0JCQlyZXR1cm4gZXJyOwotCi0JCWNvdW50Kys7Ci0JfSB3aGlsZSAoIV9faWd0X3RpbWVvdXQo
ZW5kX3RpbWUsIE5VTEwpKTsKLQotCXNtb2tlLT5jb3VudCA9IGNvdW50OwotCXJldHVybiAwOwot
fQotCi1zdGF0aWMgaW50IHNtb2tlX2NyZXNjZW5kbyhzdHJ1Y3QgcHJlZW1wdF9zbW9rZSAqc21v
a2UsIHVuc2lnbmVkIGludCBmbGFncykKLSNkZWZpbmUgQkFUQ0ggQklUKDApCi17Ci0Jc3RydWN0
IHRhc2tfc3RydWN0ICp0c2tbSTkxNV9OVU1fRU5HSU5FU10gPSB7fTsKLQlzdHJ1Y3QgcHJlZW1w
dF9zbW9rZSBhcmdbSTkxNV9OVU1fRU5HSU5FU107Ci0Jc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lOwotCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwotCXVuc2lnbmVkIGxvbmcgY291bnQ7
Ci0JaW50IGVyciA9IDA7Ci0KLQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBzbW9rZS0+Z3QsIGlk
KSB7Ci0JCWFyZ1tpZF0gPSAqc21va2U7Ci0JCWFyZ1tpZF0uZW5naW5lID0gZW5naW5lOwotCQlp
ZiAoIShmbGFncyAmIEJBVENIKSkKLQkJCWFyZ1tpZF0uYmF0Y2ggPSBOVUxMOwotCQlhcmdbaWRd
LmNvdW50ID0gMDsKLQotCQl0c2tbaWRdID0ga3RocmVhZF9ydW4oc21va2VfY3Jlc2NlbmRvX3Ro
cmVhZCwgJmFyZywKLQkJCQkgICAgICAiaWd0L3Ntb2tlOiVkIiwgaWQpOwotCQlpZiAoSVNfRVJS
KHRza1tpZF0pKSB7Ci0JCQllcnIgPSBQVFJfRVJSKHRza1tpZF0pOwotCQkJYnJlYWs7Ci0JCX0K
LQkJZ2V0X3Rhc2tfc3RydWN0KHRza1tpZF0pOwotCX0KLQotCXlpZWxkKCk7IC8qIHN0YXJ0IGFs
bCB0aHJlYWRzIGJlZm9yZSB3ZSBrdGhyZWFkX3N0b3AoKSAqLwotCi0JY291bnQgPSAwOwotCWZv
cl9lYWNoX2VuZ2luZShlbmdpbmUsIHNtb2tlLT5ndCwgaWQpIHsKLQkJaW50IHN0YXR1czsKLQot
CQlpZiAoSVNfRVJSX09SX05VTEwodHNrW2lkXSkpCi0JCQljb250aW51ZTsKLQotCQlzdGF0dXMg
PSBrdGhyZWFkX3N0b3AodHNrW2lkXSk7Ci0JCWlmIChzdGF0dXMgJiYgIWVycikKLQkJCWVyciA9
IHN0YXR1czsKLQotCQljb3VudCArPSBhcmdbaWRdLmNvdW50OwotCi0JCXB1dF90YXNrX3N0cnVj
dCh0c2tbaWRdKTsKLQl9Ci0KLQlwcl9pbmZvKCJTdWJtaXR0ZWQgJWx1IGNyZXNjZW5kbzoleCBy
ZXF1ZXN0cyBhY3Jvc3MgJWQgZW5naW5lcyBhbmQgJWQgY29udGV4dHNcbiIsCi0JCWNvdW50LCBm
bGFncywKLQkJUlVOVElNRV9JTkZPKHNtb2tlLT5ndC0+aTkxNSktPm51bV9lbmdpbmVzLCBzbW9r
ZS0+bmNvbnRleHQpOwotCXJldHVybiAwOwotfQotCi1zdGF0aWMgaW50IHNtb2tlX3JhbmRvbShz
dHJ1Y3QgcHJlZW1wdF9zbW9rZSAqc21va2UsIHVuc2lnbmVkIGludCBmbGFncykKLXsKLQllbnVt
IGludGVsX2VuZ2luZV9pZCBpZDsKLQlJR1RfVElNRU9VVChlbmRfdGltZSk7Ci0JdW5zaWduZWQg
bG9uZyBjb3VudDsKLQotCWNvdW50ID0gMDsKLQlkbyB7Ci0JCWZvcl9lYWNoX2VuZ2luZShzbW9r
ZS0+ZW5naW5lLCBzbW9rZS0+Z3QsIGlkKSB7Ci0JCQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAq
Y3R4ID0gc21va2VfY29udGV4dChzbW9rZSk7Ci0JCQlpbnQgZXJyOwotCi0JCQllcnIgPSBzbW9r
ZV9zdWJtaXQoc21va2UsCi0JCQkJCSAgIGN0eCwgcmFuZG9tX3ByaW9yaXR5KCZzbW9rZS0+cHJu
ZyksCi0JCQkJCSAgIGZsYWdzICYgQkFUQ0ggPyBzbW9rZS0+YmF0Y2ggOiBOVUxMKTsKLQkJCWlm
IChlcnIpCi0JCQkJcmV0dXJuIGVycjsKLQotCQkJY291bnQrKzsKLQkJfQotCX0gd2hpbGUgKCFf
X2lndF90aW1lb3V0KGVuZF90aW1lLCBOVUxMKSk7Ci0KLQlwcl9pbmZvKCJTdWJtaXR0ZWQgJWx1
IHJhbmRvbToleCByZXF1ZXN0cyBhY3Jvc3MgJWQgZW5naW5lcyBhbmQgJWQgY29udGV4dHNcbiIs
Ci0JCWNvdW50LCBmbGFncywKLQkJUlVOVElNRV9JTkZPKHNtb2tlLT5ndC0+aTkxNSktPm51bV9l
bmdpbmVzLCBzbW9rZS0+bmNvbnRleHQpOwotCXJldHVybiAwOwotfQotCi1zdGF0aWMgaW50IGxp
dmVfcHJlZW1wdF9zbW9rZSh2b2lkICphcmcpCi17Ci0Jc3RydWN0IHByZWVtcHRfc21va2Ugc21v
a2UgPSB7Ci0JCS5ndCA9IGFyZywKLQkJLnBybmcgPSBJOTE1X1JORF9TVEFURV9JTklUSUFMSVpF
UihpOTE1X3NlbGZ0ZXN0LnJhbmRvbV9zZWVkKSwKLQkJLm5jb250ZXh0ID0gMTAyNCwKLQl9Owot
CWNvbnN0IHVuc2lnbmVkIGludCBwaGFzZVtdID0geyAwLCBCQVRDSCB9OwotCXN0cnVjdCBpZ3Rf
bGl2ZV90ZXN0IHQ7Ci0JaW50IGVyciA9IC1FTk9NRU07Ci0JdTMyICpjczsKLQlpbnQgbjsKLQot
CWlmICghSEFTX0xPR0lDQUxfUklOR19QUkVFTVBUSU9OKHNtb2tlLmd0LT5pOTE1KSkKLQkJcmV0
dXJuIDA7Ci0KLQlzbW9rZS5jb250ZXh0cyA9IGttYWxsb2NfYXJyYXkoc21va2UubmNvbnRleHQs
Ci0JCQkJICAgICAgIHNpemVvZigqc21va2UuY29udGV4dHMpLAotCQkJCSAgICAgICBHRlBfS0VS
TkVMKTsKLQlpZiAoIXNtb2tlLmNvbnRleHRzKQotCQlyZXR1cm4gLUVOT01FTTsKLQotCXNtb2tl
LmJhdGNoID0KLQkJaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChzbW9rZS5ndC0+aTkx
NSwgUEFHRV9TSVpFKTsKLQlpZiAoSVNfRVJSKHNtb2tlLmJhdGNoKSkgewotCQllcnIgPSBQVFJf
RVJSKHNtb2tlLmJhdGNoKTsKLQkJZ290byBlcnJfZnJlZTsKLQl9Ci0KLQljcyA9IGk5MTVfZ2Vt
X29iamVjdF9waW5fbWFwKHNtb2tlLmJhdGNoLCBJOTE1X01BUF9XQik7Ci0JaWYgKElTX0VSUihj
cykpIHsKLQkJZXJyID0gUFRSX0VSUihjcyk7Ci0JCWdvdG8gZXJyX2JhdGNoOwotCX0KLQlmb3Ig
KG4gPSAwOyBuIDwgUEFHRV9TSVpFIC8gc2l6ZW9mKCpjcykgLSAxOyBuKyspCi0JCWNzW25dID0g
TUlfQVJCX0NIRUNLOwotCWNzW25dID0gTUlfQkFUQ0hfQlVGRkVSX0VORDsKLQlpOTE1X2dlbV9v
YmplY3RfZmx1c2hfbWFwKHNtb2tlLmJhdGNoKTsKLQlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFw
KHNtb2tlLmJhdGNoKTsKLQotCWlmIChpZ3RfbGl2ZV90ZXN0X2JlZ2luKCZ0LCBzbW9rZS5ndC0+
aTkxNSwgX19mdW5jX18sICJhbGwiKSkgewotCQllcnIgPSAtRUlPOwotCQlnb3RvIGVycl9iYXRj
aDsKLQl9Ci0KLQlmb3IgKG4gPSAwOyBuIDwgc21va2UubmNvbnRleHQ7IG4rKykgewotCQlzbW9r
ZS5jb250ZXh0c1tuXSA9IGtlcm5lbF9jb250ZXh0KHNtb2tlLmd0LT5pOTE1KTsKLQkJaWYgKCFz
bW9rZS5jb250ZXh0c1tuXSkKLQkJCWdvdG8gZXJyX2N0eDsKLQl9Ci0KLQlmb3IgKG4gPSAwOyBu
IDwgQVJSQVlfU0laRShwaGFzZSk7IG4rKykgewotCQllcnIgPSBzbW9rZV9jcmVzY2VuZG8oJnNt
b2tlLCBwaGFzZVtuXSk7Ci0JCWlmIChlcnIpCi0JCQlnb3RvIGVycl9jdHg7Ci0KLQkJZXJyID0g
c21va2VfcmFuZG9tKCZzbW9rZSwgcGhhc2Vbbl0pOwotCQlpZiAoZXJyKQotCQkJZ290byBlcnJf
Y3R4OwotCX0KLQotZXJyX2N0eDoKLQlpZiAoaWd0X2xpdmVfdGVzdF9lbmQoJnQpKQotCQllcnIg
PSAtRUlPOwotCi0JZm9yIChuID0gMDsgbiA8IHNtb2tlLm5jb250ZXh0OyBuKyspIHsKLQkJaWYg
KCFzbW9rZS5jb250ZXh0c1tuXSkKLQkJCWJyZWFrOwotCQlrZXJuZWxfY29udGV4dF9jbG9zZShz
bW9rZS5jb250ZXh0c1tuXSk7Ci0JfQotCi1lcnJfYmF0Y2g6Ci0JaTkxNV9nZW1fb2JqZWN0X3B1
dChzbW9rZS5iYXRjaCk7Ci1lcnJfZnJlZToKLQlrZnJlZShzbW9rZS5jb250ZXh0cyk7Ci0KLQly
ZXR1cm4gZXJyOwotfQotCi1zdGF0aWMgaW50IG5vcF92aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50
ZWxfZ3QgKmd0LAotCQkJICAgICAgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqKnNpYmxpbmdzLAot
CQkJICAgICAgdW5zaWduZWQgaW50IG5zaWJsaW5nLAotCQkJICAgICAgdW5zaWduZWQgaW50IG5j
dHgsCi0JCQkgICAgICB1bnNpZ25lZCBpbnQgZmxhZ3MpCi0jZGVmaW5lIENIQUlOIEJJVCgwKQot
ewotCUlHVF9USU1FT1VUKGVuZF90aW1lKTsKLQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0
WzE2XSA9IHt9OwotCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHhbMTZdOwotCXN0cnVjdCBp
bnRlbF9jb250ZXh0ICp2ZVsxNl07Ci0JdW5zaWduZWQgbG9uZyBuLCBwcmltZSwgbmM7Ci0Jc3Ry
dWN0IGlndF9saXZlX3Rlc3QgdDsKLQlrdGltZV90IHRpbWVzWzJdID0ge307Ci0JaW50IGVycjsK
LQotCUdFTV9CVUdfT04oIW5jdHggfHwgbmN0eCA+IEFSUkFZX1NJWkUoY3R4KSk7Ci0KLQlmb3Ig
KG4gPSAwOyBuIDwgbmN0eDsgbisrKSB7Ci0JCWN0eFtuXSA9IGtlcm5lbF9jb250ZXh0KGd0LT5p
OTE1KTsKLQkJaWYgKCFjdHhbbl0pIHsKLQkJCWVyciA9IC1FTk9NRU07Ci0JCQluY3R4ID0gbjsK
LQkJCWdvdG8gb3V0OwotCQl9Ci0KLQkJdmVbbl0gPSBpbnRlbF92aXJ0dWFsX2VuZ2luZV9jcmVh
dGUoY3R4W25dLCBzaWJsaW5ncywgbnNpYmxpbmcpOwotCQlpZiAoSVNfRVJSKHZlW25dKSkgewot
CQkJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4W25dKTsKLQkJCWVyciA9IFBUUl9FUlIodmVbbl0p
OwotCQkJbmN0eCA9IG47Ci0JCQlnb3RvIG91dDsKLQkJfQotCi0JCWVyciA9IGludGVsX2NvbnRl
eHRfcGluKHZlW25dKTsKLQkJaWYgKGVycikgewotCQkJaW50ZWxfY29udGV4dF9wdXQodmVbbl0p
OwotCQkJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4W25dKTsKLQkJCW5jdHggPSBuOwotCQkJZ290
byBvdXQ7Ci0JCX0KLQl9Ci0KLQllcnIgPSBpZ3RfbGl2ZV90ZXN0X2JlZ2luKCZ0LCBndC0+aTkx
NSwgX19mdW5jX18sIHZlWzBdLT5lbmdpbmUtPm5hbWUpOwotCWlmIChlcnIpCi0JCWdvdG8gb3V0
OwotCi0JZm9yX2VhY2hfcHJpbWVfbnVtYmVyX2Zyb20ocHJpbWUsIDEsIDgxOTIpIHsKLQkJdGlt
ZXNbMV0gPSBrdGltZV9nZXRfcmF3KCk7Ci0KLQkJaWYgKGZsYWdzICYgQ0hBSU4pIHsKLQkJCWZv
ciAobmMgPSAwOyBuYyA8IG5jdHg7IG5jKyspIHsKLQkJCQlmb3IgKG4gPSAwOyBuIDwgcHJpbWU7
IG4rKykgewotCQkJCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKLQotCQkJCQlycSA9IGk5MTVf
cmVxdWVzdF9jcmVhdGUodmVbbmNdKTsKLQkJCQkJaWYgKElTX0VSUihycSkpIHsKLQkJCQkJCWVy
ciA9IFBUUl9FUlIocnEpOwotCQkJCQkJZ290byBvdXQ7Ci0JCQkJCX0KLQotCQkJCQlpZiAocmVx
dWVzdFtuY10pCi0JCQkJCQlpOTE1X3JlcXVlc3RfcHV0KHJlcXVlc3RbbmNdKTsKLQkJCQkJcmVx
dWVzdFtuY10gPSBpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKLQkJCQkJaTkxNV9yZXF1ZXN0X2FkZChy
cSk7Ci0JCQkJfQotCQkJfQotCQl9IGVsc2UgewotCQkJZm9yIChuID0gMDsgbiA8IHByaW1lOyBu
KyspIHsKLQkJCQlmb3IgKG5jID0gMDsgbmMgPCBuY3R4OyBuYysrKSB7Ci0JCQkJCXN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxOwotCi0JCQkJCXJxID0gaTkxNV9yZXF1ZXN0X2NyZWF0ZSh2ZVtuY10p
OwotCQkJCQlpZiAoSVNfRVJSKHJxKSkgewotCQkJCQkJZXJyID0gUFRSX0VSUihycSk7Ci0JCQkJ
CQlnb3RvIG91dDsKLQkJCQkJfQotCi0JCQkJCWlmIChyZXF1ZXN0W25jXSkKLQkJCQkJCWk5MTVf
cmVxdWVzdF9wdXQocmVxdWVzdFtuY10pOwotCQkJCQlyZXF1ZXN0W25jXSA9IGk5MTVfcmVxdWVz
dF9nZXQocnEpOwotCQkJCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKLQkJCQl9Ci0JCQl9Ci0JCX0K
LQotCQlmb3IgKG5jID0gMDsgbmMgPCBuY3R4OyBuYysrKSB7Ci0JCQlpZiAoaTkxNV9yZXF1ZXN0
X3dhaXQocmVxdWVzdFtuY10sIDAsIEhaIC8gMTApIDwgMCkgewotCQkJCXByX2VycigiJXMoJXMp
OiB3YWl0IGZvciAlbGx4OiVsbGQgdGltZWQgb3V0XG4iLAotCQkJCSAgICAgICBfX2Z1bmNfXywg
dmVbMF0tPmVuZ2luZS0+bmFtZSwKLQkJCQkgICAgICAgcmVxdWVzdFtuY10tPmZlbmNlLmNvbnRl
eHQsCi0JCQkJICAgICAgIHJlcXVlc3RbbmNdLT5mZW5jZS5zZXFubyk7Ci0KLQkJCQlHRU1fVFJB
Q0UoIiVzKCVzKSBmYWlsZWQgYXQgcmVxdWVzdCAlbGx4OiVsbGRcbiIsCi0JCQkJCSAgX19mdW5j
X18sIHZlWzBdLT5lbmdpbmUtPm5hbWUsCi0JCQkJCSAgcmVxdWVzdFtuY10tPmZlbmNlLmNvbnRl
eHQsCi0JCQkJCSAgcmVxdWVzdFtuY10tPmZlbmNlLnNlcW5vKTsKLQkJCQlHRU1fVFJBQ0VfRFVN
UCgpOwotCQkJCWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOwotCQkJCWJyZWFrOwotCQkJfQotCQl9
Ci0KLQkJdGltZXNbMV0gPSBrdGltZV9zdWIoa3RpbWVfZ2V0X3JhdygpLCB0aW1lc1sxXSk7Ci0J
CWlmIChwcmltZSA9PSAxKQotCQkJdGltZXNbMF0gPSB0aW1lc1sxXTsKLQotCQlmb3IgKG5jID0g
MDsgbmMgPCBuY3R4OyBuYysrKSB7Ci0JCQlpOTE1X3JlcXVlc3RfcHV0KHJlcXVlc3RbbmNdKTsK
LQkJCXJlcXVlc3RbbmNdID0gTlVMTDsKLQkJfQotCi0JCWlmIChfX2lndF90aW1lb3V0KGVuZF90
aW1lLCBOVUxMKSkKLQkJCWJyZWFrOwotCX0KLQotCWVyciA9IGlndF9saXZlX3Rlc3RfZW5kKCZ0
KTsKLQlpZiAoZXJyKQotCQlnb3RvIG91dDsKLQotCXByX2luZm8oIlJlcXVlc3R4JWQgbGF0ZW5j
aWVzIG9uICVzOiAxID0gJWxsdW5zLCAlbHUgPSAlbGx1bnNcbiIsCi0JCW5jdHgsIHZlWzBdLT5l
bmdpbmUtPm5hbWUsIGt0aW1lX3RvX25zKHRpbWVzWzBdKSwKLQkJcHJpbWUsIGRpdjY0X3U2NChr
dGltZV90b19ucyh0aW1lc1sxXSksIHByaW1lKSk7Ci0KLW91dDoKLQlpZiAoaWd0X2ZsdXNoX3Rl
c3QoZ3QtPmk5MTUpKQotCQllcnIgPSAtRUlPOwotCi0JZm9yIChuYyA9IDA7IG5jIDwgbmN0eDsg
bmMrKykgewotCQlpOTE1X3JlcXVlc3RfcHV0KHJlcXVlc3RbbmNdKTsKLQkJaW50ZWxfY29udGV4
dF91bnBpbih2ZVtuY10pOwotCQlpbnRlbF9jb250ZXh0X3B1dCh2ZVtuY10pOwotCQlrZXJuZWxf
Y29udGV4dF9jbG9zZShjdHhbbmNdKTsKLQl9Ci0JcmV0dXJuIGVycjsKLX0KLQotc3RhdGljIGlu
dCBsaXZlX3ZpcnR1YWxfZW5naW5lKHZvaWQgKmFyZykKLXsKLQlzdHJ1Y3QgaW50ZWxfZ3QgKmd0
ID0gYXJnOwotCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKnNpYmxpbmdzW01BWF9FTkdJTkVfSU5T
VEFOQ0UgKyAxXTsKLQlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7Ci0JZW51bSBpbnRl
bF9lbmdpbmVfaWQgaWQ7Ci0JdW5zaWduZWQgaW50IGNsYXNzLCBpbnN0OwotCWludCBlcnI7Ci0K
LQlpZiAoVVNFU19HVUNfU1VCTUlTU0lPTihndC0+aTkxNSkpCi0JCXJldHVybiAwOwotCi0JZm9y
X2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7Ci0JCWVyciA9IG5vcF92aXJ0dWFsX2VuZ2lu
ZShndCwgJmVuZ2luZSwgMSwgMSwgMCk7Ci0JCWlmIChlcnIpIHsKLQkJCXByX2VycigiRmFpbGVk
IHRvIHdyYXAgZW5naW5lICVzOiBlcnI9JWRcbiIsCi0JCQkgICAgICAgZW5naW5lLT5uYW1lLCBl
cnIpOwotCQkJcmV0dXJuIGVycjsKLQkJfQotCX0KLQotCWZvciAoY2xhc3MgPSAwOyBjbGFzcyA8
PSBNQVhfRU5HSU5FX0NMQVNTOyBjbGFzcysrKSB7Ci0JCWludCBuc2libGluZywgbjsKLQotCQlu
c2libGluZyA9IDA7Ci0JCWZvciAoaW5zdCA9IDA7IGluc3QgPD0gTUFYX0VOR0lORV9JTlNUQU5D
RTsgaW5zdCsrKSB7Ci0JCQlpZiAoIWd0LT5lbmdpbmVfY2xhc3NbY2xhc3NdW2luc3RdKQotCQkJ
CWNvbnRpbnVlOwotCi0JCQlzaWJsaW5nc1tuc2libGluZysrXSA9IGd0LT5lbmdpbmVfY2xhc3Nb
Y2xhc3NdW2luc3RdOwotCQl9Ci0JCWlmIChuc2libGluZyA8IDIpCi0JCQljb250aW51ZTsKLQot
CQlmb3IgKG4gPSAxOyBuIDw9IG5zaWJsaW5nICsgMTsgbisrKSB7Ci0JCQllcnIgPSBub3Bfdmly
dHVhbF9lbmdpbmUoZ3QsIHNpYmxpbmdzLCBuc2libGluZywKLQkJCQkJCSBuLCAwKTsKLQkJCWlm
IChlcnIpCi0JCQkJcmV0dXJuIGVycjsKLQkJfQotCi0JCWVyciA9IG5vcF92aXJ0dWFsX2VuZ2lu
ZShndCwgc2libGluZ3MsIG5zaWJsaW5nLCBuLCBDSEFJTik7Ci0JCWlmIChlcnIpCi0JCQlyZXR1
cm4gZXJyOwotCX0KLQotCXJldHVybiAwOwotfQotCi1zdGF0aWMgaW50IG1hc2tfdmlydHVhbF9l
bmdpbmUoc3RydWN0IGludGVsX2d0ICpndCwKLQkJCSAgICAgICBzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICoqc2libGluZ3MsCi0JCQkgICAgICAgdW5zaWduZWQgaW50IG5zaWJsaW5nKQotewotCXN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3RbTUFYX0VOR0lORV9JTlNUQU5DRSArIDFdOwotCXN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7Ci0Jc3RydWN0IGludGVsX2NvbnRleHQgKnZlOwot
CXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7Ci0JdW5zaWduZWQgaW50IG47Ci0JaW50IGVycjsKLQot
CS8qCi0JICogQ2hlY2sgdGhhdCBieSBzZXR0aW5nIHRoZSBleGVjdXRpb24gbWFzayBvbiBhIHJl
cXVlc3QsIHdlIGNhbgotCSAqIHJlc3RyaWN0IGl0IHRvIG91ciBkZXNpcmVkIGVuZ2luZSB3aXRo
aW4gdGhlIHZpcnR1YWwgZW5naW5lLgotCSAqLwotCi0JY3R4ID0ga2VybmVsX2NvbnRleHQoZ3Qt
Pmk5MTUpOwotCWlmICghY3R4KQotCQlyZXR1cm4gLUVOT01FTTsKLQotCXZlID0gaW50ZWxfdmly
dHVhbF9lbmdpbmVfY3JlYXRlKGN0eCwgc2libGluZ3MsIG5zaWJsaW5nKTsKLQlpZiAoSVNfRVJS
KHZlKSkgewotCQllcnIgPSBQVFJfRVJSKHZlKTsKLQkJZ290byBvdXRfY2xvc2U7Ci0JfQotCi0J
ZXJyID0gaW50ZWxfY29udGV4dF9waW4odmUpOwotCWlmIChlcnIpCi0JCWdvdG8gb3V0X3B1dDsK
LQotCWVyciA9IGlndF9saXZlX3Rlc3RfYmVnaW4oJnQsIGd0LT5pOTE1LCBfX2Z1bmNfXywgdmUt
PmVuZ2luZS0+bmFtZSk7Ci0JaWYgKGVycikKLQkJZ290byBvdXRfdW5waW47Ci0KLQlmb3IgKG4g
PSAwOyBuIDwgbnNpYmxpbmc7IG4rKykgewotCQlyZXF1ZXN0W25dID0gaTkxNV9yZXF1ZXN0X2Ny
ZWF0ZSh2ZSk7Ci0JCWlmIChJU19FUlIocmVxdWVzdFtuXSkpIHsKLQkJCWVyciA9IFBUUl9FUlIo
cmVxdWVzdFtuXSk7Ci0JCQluc2libGluZyA9IG47Ci0JCQlnb3RvIG91dDsKLQkJfQotCi0JCS8q
IFJldmVyc2Ugb3JkZXIgYXMgaXQncyBtb3JlIGxpa2VseSB0byBiZSB1bm5hdHVyYWwgKi8KLQkJ
cmVxdWVzdFtuXS0+ZXhlY3V0aW9uX21hc2sgPSBzaWJsaW5nc1tuc2libGluZyAtIG4gLSAxXS0+
bWFzazsKLQotCQlpOTE1X3JlcXVlc3RfZ2V0KHJlcXVlc3Rbbl0pOwotCQlpOTE1X3JlcXVlc3Rf
YWRkKHJlcXVlc3Rbbl0pOwotCX0KLQotCWZvciAobiA9IDA7IG4gPCBuc2libGluZzsgbisrKSB7
Ci0JCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChyZXF1ZXN0W25dLCAwLCBIWiAvIDEwKSA8IDApIHsK
LQkJCXByX2VycigiJXMoJXMpOiB3YWl0IGZvciAlbGx4OiVsbGQgdGltZWQgb3V0XG4iLAotCQkJ
ICAgICAgIF9fZnVuY19fLCB2ZS0+ZW5naW5lLT5uYW1lLAotCQkJICAgICAgIHJlcXVlc3Rbbl0t
PmZlbmNlLmNvbnRleHQsCi0JCQkgICAgICAgcmVxdWVzdFtuXS0+ZmVuY2Uuc2Vxbm8pOwotCi0J
CQlHRU1fVFJBQ0UoIiVzKCVzKSBmYWlsZWQgYXQgcmVxdWVzdCAlbGx4OiVsbGRcbiIsCi0JCQkJ
ICBfX2Z1bmNfXywgdmUtPmVuZ2luZS0+bmFtZSwKLQkJCQkgIHJlcXVlc3Rbbl0tPmZlbmNlLmNv
bnRleHQsCi0JCQkJICByZXF1ZXN0W25dLT5mZW5jZS5zZXFubyk7Ci0JCQlHRU1fVFJBQ0VfRFVN
UCgpOwotCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7Ci0JCQllcnIgPSAtRUlPOwotCQkJZ290
byBvdXQ7Ci0JCX0KLQotCQlpZiAocmVxdWVzdFtuXS0+ZW5naW5lICE9IHNpYmxpbmdzW25zaWJs
aW5nIC0gbiAtIDFdKSB7Ci0JCQlwcl9lcnIoIkV4ZWN1dGVkIG9uIHdyb25nIHNpYmxpbmcgJyVz
JywgZXhwZWN0ZWQgJyVzJ1xuIiwKLQkJCSAgICAgICByZXF1ZXN0W25dLT5lbmdpbmUtPm5hbWUs
Ci0JCQkgICAgICAgc2libGluZ3NbbnNpYmxpbmcgLSBuIC0gMV0tPm5hbWUpOwotCQkJZXJyID0g
LUVJTlZBTDsKLQkJCWdvdG8gb3V0OwotCQl9Ci0JfQotCi0JZXJyID0gaWd0X2xpdmVfdGVzdF9l
bmQoJnQpOwotb3V0OgotCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpCi0JCWVyciA9IC1F
SU87Ci0KLQlmb3IgKG4gPSAwOyBuIDwgbnNpYmxpbmc7IG4rKykKLQkJaTkxNV9yZXF1ZXN0X3B1
dChyZXF1ZXN0W25dKTsKLQotb3V0X3VucGluOgotCWludGVsX2NvbnRleHRfdW5waW4odmUpOwot
b3V0X3B1dDoKLQlpbnRlbF9jb250ZXh0X3B1dCh2ZSk7Ci1vdXRfY2xvc2U6Ci0Ja2VybmVsX2Nv
bnRleHRfY2xvc2UoY3R4KTsKLQlyZXR1cm4gZXJyOwotfQotCi1zdGF0aWMgaW50IGxpdmVfdmly
dHVhbF9tYXNrKHZvaWQgKmFyZykKLXsKLQlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwotCXN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKnNpYmxpbmdzW01BWF9FTkdJTkVfSU5TVEFOQ0UgKyAxXTsK
LQl1bnNpZ25lZCBpbnQgY2xhc3MsIGluc3Q7Ci0JaW50IGVycjsKLQotCWlmIChVU0VTX0dVQ19T
VUJNSVNTSU9OKGd0LT5pOTE1KSkKLQkJcmV0dXJuIDA7Ci0KLQlmb3IgKGNsYXNzID0gMDsgY2xh
c3MgPD0gTUFYX0VOR0lORV9DTEFTUzsgY2xhc3MrKykgewotCQl1bnNpZ25lZCBpbnQgbnNpYmxp
bmc7Ci0KLQkJbnNpYmxpbmcgPSAwOwotCQlmb3IgKGluc3QgPSAwOyBpbnN0IDw9IE1BWF9FTkdJ
TkVfSU5TVEFOQ0U7IGluc3QrKykgewotCQkJaWYgKCFndC0+ZW5naW5lX2NsYXNzW2NsYXNzXVtp
bnN0XSkKLQkJCQlicmVhazsKLQotCQkJc2libGluZ3NbbnNpYmxpbmcrK10gPSBndC0+ZW5naW5l
X2NsYXNzW2NsYXNzXVtpbnN0XTsKLQkJfQotCQlpZiAobnNpYmxpbmcgPCAyKQotCQkJY29udGlu
dWU7Ci0KLQkJZXJyID0gbWFza192aXJ0dWFsX2VuZ2luZShndCwgc2libGluZ3MsIG5zaWJsaW5n
KTsKLQkJaWYgKGVycikKLQkJCXJldHVybiBlcnI7Ci0JfQotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0
YXRpYyBpbnQgcHJlc2VydmVkX3ZpcnR1YWxfZW5naW5lKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCi0J
CQkJICAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKipzaWJsaW5ncywKLQkJCQkgICAgdW5zaWdu
ZWQgaW50IG5zaWJsaW5nKQotewotCXN0cnVjdCBpOTE1X3JlcXVlc3QgKmxhc3QgPSBOVUxMOwot
CXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7Ci0Jc3RydWN0IGludGVsX2NvbnRleHQgKnZl
OwotCXN0cnVjdCBpOTE1X3ZtYSAqc2NyYXRjaDsKLQlzdHJ1Y3QgaWd0X2xpdmVfdGVzdCB0Owot
CXVuc2lnbmVkIGludCBuOwotCWludCBlcnIgPSAwOwotCXUzMiAqY3M7Ci0KLQljdHggPSBrZXJu
ZWxfY29udGV4dChndC0+aTkxNSk7Ci0JaWYgKCFjdHgpCi0JCXJldHVybiAtRU5PTUVNOwotCi0J
c2NyYXRjaCA9IGNyZWF0ZV9zY3JhdGNoKHNpYmxpbmdzWzBdLT5ndCk7Ci0JaWYgKElTX0VSUihz
Y3JhdGNoKSkgewotCQllcnIgPSBQVFJfRVJSKHNjcmF0Y2gpOwotCQlnb3RvIG91dF9jbG9zZTsK
LQl9Ci0KLQl2ZSA9IGludGVsX3ZpcnR1YWxfZW5naW5lX2NyZWF0ZShjdHgsIHNpYmxpbmdzLCBu
c2libGluZyk7Ci0JaWYgKElTX0VSUih2ZSkpIHsKLQkJZXJyID0gUFRSX0VSUih2ZSk7Ci0JCWdv
dG8gb3V0X3NjcmF0Y2g7Ci0JfQotCi0JZXJyID0gaW50ZWxfY29udGV4dF9waW4odmUpOwotCWlm
IChlcnIpCi0JCWdvdG8gb3V0X3B1dDsKLQotCWVyciA9IGlndF9saXZlX3Rlc3RfYmVnaW4oJnQs
IGd0LT5pOTE1LCBfX2Z1bmNfXywgdmUtPmVuZ2luZS0+bmFtZSk7Ci0JaWYgKGVycikKLQkJZ290
byBvdXRfdW5waW47Ci0KLQlmb3IgKG4gPSAwOyBuIDwgTlVNX0dQUl9EVzsgbisrKSB7Ci0JCXN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSA9IHNpYmxpbmdzW24gJSBuc2libGluZ107Ci0J
CXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwotCi0JCXJxID0gaTkxNV9yZXF1ZXN0X2NyZWF0ZSh2
ZSk7Ci0JCWlmIChJU19FUlIocnEpKSB7Ci0JCQllcnIgPSBQVFJfRVJSKHJxKTsKLQkJCWdvdG8g
b3V0X2VuZDsKLQkJfQotCi0JCWk5MTVfcmVxdWVzdF9wdXQobGFzdCk7Ci0JCWxhc3QgPSBpOTE1
X3JlcXVlc3RfZ2V0KHJxKTsKLQotCQljcyA9IGludGVsX3JpbmdfYmVnaW4ocnEsIDgpOwotCQlp
ZiAoSVNfRVJSKGNzKSkgewotCQkJaTkxNV9yZXF1ZXN0X2FkZChycSk7Ci0JCQllcnIgPSBQVFJf
RVJSKGNzKTsKLQkJCWdvdG8gb3V0X2VuZDsKLQkJfQotCi0JCSpjcysrID0gTUlfU1RPUkVfUkVH
SVNURVJfTUVNX0dFTjggfCBNSV9VU0VfR0dUVDsKLQkJKmNzKysgPSBDU19HUFIoZW5naW5lLCBu
KTsKLQkJKmNzKysgPSBpOTE1X2dndHRfb2Zmc2V0KHNjcmF0Y2gpICsgbiAqIHNpemVvZih1MzIp
OwotCQkqY3MrKyA9IDA7Ci0KLQkJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX0lNTSgxKTsKLQkJ
KmNzKysgPSBDU19HUFIoZW5naW5lLCAobiArIDEpICUgTlVNX0dQUl9EVyk7Ci0JCSpjcysrID0g
biArIDE7Ci0KLQkJKmNzKysgPSBNSV9OT09QOwotCQlpbnRlbF9yaW5nX2FkdmFuY2UocnEsIGNz
KTsKLQotCQkvKiBSZXN0cmljdCB0aGlzIHJlcXVlc3QgdG8gcnVuIG9uIGEgcGFydGljdWxhciBl
bmdpbmUgKi8KLQkJcnEtPmV4ZWN1dGlvbl9tYXNrID0gZW5naW5lLT5tYXNrOwotCQlpOTE1X3Jl
cXVlc3RfYWRkKHJxKTsKLQl9Ci0KLQlpZiAoaTkxNV9yZXF1ZXN0X3dhaXQobGFzdCwgMCwgSFog
LyA1KSA8IDApIHsKLQkJZXJyID0gLUVUSU1FOwotCQlnb3RvIG91dF9lbmQ7Ci0JfQotCi0JY3Mg
PSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChzY3JhdGNoLT5vYmosIEk5MTVfTUFQX1dCKTsKLQlp
ZiAoSVNfRVJSKGNzKSkgewotCQllcnIgPSBQVFJfRVJSKGNzKTsKLQkJZ290byBvdXRfZW5kOwot
CX0KLQotCWZvciAobiA9IDA7IG4gPCBOVU1fR1BSX0RXOyBuKyspIHsKLQkJaWYgKGNzW25dICE9
IG4pIHsKLQkJCXByX2VycigiSW5jb3JyZWN0IHZhbHVlWyVkXSBmb3VuZCBmb3IgR1BSWyVkXVxu
IiwKLQkJCSAgICAgICBjc1tuXSwgbik7Ci0JCQllcnIgPSAtRUlOVkFMOwotCQkJYnJlYWs7Ci0J
CX0KLQl9Ci0KLQlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKHNjcmF0Y2gtPm9iaik7Ci0KLW91
dF9lbmQ6Ci0JaWYgKGlndF9saXZlX3Rlc3RfZW5kKCZ0KSkKLQkJZXJyID0gLUVJTzsKLQlpOTE1
X3JlcXVlc3RfcHV0KGxhc3QpOwotb3V0X3VucGluOgotCWludGVsX2NvbnRleHRfdW5waW4odmUp
Owotb3V0X3B1dDoKLQlpbnRlbF9jb250ZXh0X3B1dCh2ZSk7Ci1vdXRfc2NyYXRjaDoKLQlpOTE1
X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmc2NyYXRjaCwgMCk7Ci1vdXRfY2xvc2U6Ci0Ja2VybmVs
X2NvbnRleHRfY2xvc2UoY3R4KTsKLQlyZXR1cm4gZXJyOwotfQotCi1zdGF0aWMgaW50IGxpdmVf
dmlydHVhbF9wcmVzZXJ2ZWQodm9pZCAqYXJnKQotewotCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBh
cmc7Ci0Jc3RydWN0IGludGVsX2VuZ2luZV9jcyAqc2libGluZ3NbTUFYX0VOR0lORV9JTlNUQU5D
RSArIDFdOwotCXVuc2lnbmVkIGludCBjbGFzcywgaW5zdDsKLQotCS8qCi0JICogQ2hlY2sgdGhh
dCB0aGUgY29udGV4dCBpbWFnZSByZXRhaW5zIG5vbi1wcml2aWxlZ2VkICh1c2VyKSByZWdpc3Rl
cnMKLQkgKiBmcm9tIG9uZSBlbmdpbmUgdG8gdGhlIG5leHQuIEZvciB0aGlzIHdlIGNoZWNrIHRo
YXQgdGhlIENTX0dQUgotCSAqIGFyZSBwcmVzZXJ2ZWQuCi0JICovCi0KLQlpZiAoVVNFU19HVUNf
U1VCTUlTU0lPTihndC0+aTkxNSkpCi0JCXJldHVybiAwOwotCi0JLyogQXMgd2UgdXNlIENTX0dQ
UiB3ZSBjYW5ub3QgcnVuIGJlZm9yZSB0aGV5IGV4aXN0ZWQgb24gYWxsIGVuZ2luZXMuICovCi0J
aWYgKElOVEVMX0dFTihndC0+aTkxNSkgPCA5KQotCQlyZXR1cm4gMDsKLQotCWZvciAoY2xhc3Mg
PSAwOyBjbGFzcyA8PSBNQVhfRU5HSU5FX0NMQVNTOyBjbGFzcysrKSB7Ci0JCWludCBuc2libGlu
ZywgZXJyOwotCi0JCW5zaWJsaW5nID0gMDsKLQkJZm9yIChpbnN0ID0gMDsgaW5zdCA8PSBNQVhf
RU5HSU5FX0lOU1RBTkNFOyBpbnN0KyspIHsKLQkJCWlmICghZ3QtPmVuZ2luZV9jbGFzc1tjbGFz
c11baW5zdF0pCi0JCQkJY29udGludWU7Ci0KLQkJCXNpYmxpbmdzW25zaWJsaW5nKytdID0gZ3Qt
PmVuZ2luZV9jbGFzc1tjbGFzc11baW5zdF07Ci0JCX0KLQkJaWYgKG5zaWJsaW5nIDwgMikKLQkJ
CWNvbnRpbnVlOwotCi0JCWVyciA9IHByZXNlcnZlZF92aXJ0dWFsX2VuZ2luZShndCwgc2libGlu
Z3MsIG5zaWJsaW5nKTsKLQkJaWYgKGVycikKLQkJCXJldHVybiBlcnI7Ci0JfQotCi0JcmV0dXJu
IDA7Ci19Ci0KLXN0YXRpYyBpbnQgYm9uZF92aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3Qg
Kmd0LAotCQkJICAgICAgIHVuc2lnbmVkIGludCBjbGFzcywKLQkJCSAgICAgICBzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICoqc2libGluZ3MsCi0JCQkgICAgICAgdW5zaWduZWQgaW50IG5zaWJsaW5n
LAotCQkJICAgICAgIHVuc2lnbmVkIGludCBmbGFncykKLSNkZWZpbmUgQk9ORF9TQ0hFRFVMRSBC
SVQoMCkKLXsKLQlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICptYXN0ZXI7Ci0Jc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHQgKmN0eDsKLQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycVsxNl07Ci0JZW51bSBp
bnRlbF9lbmdpbmVfaWQgaWQ7Ci0Jc3RydWN0IGlndF9zcGlubmVyIHNwaW47Ci0JdW5zaWduZWQg
bG9uZyBuOwotCWludCBlcnI7Ci0KLQkvKgotCSAqIEEgc2V0IG9mIGJvbmRlZCByZXF1ZXN0cyBp
cyBpbnRlbmRlZCB0byBiZSBydW4gY29uY3VycmVudGx5Ci0JICogYWNyb3NzIGEgbnVtYmVyIG9m
IGVuZ2luZXMuIFdlIHVzZSBvbmUgcmVxdWVzdCBwZXItZW5naW5lCi0JICogYW5kIGEgbWFnaWMg
ZmVuY2UgdG8gc2NoZWR1bGUgZWFjaCBvZiB0aGUgYm9uZGVkIHJlcXVlc3RzCi0JICogYXQgdGhl
IHNhbWUgdGltZS4gQSBjb25zZXF1ZW5jZSBvZiBvdXIgY3VycmVudCBzY2hlZHVsZXIgaXMgdGhh
dAotCSAqIHdlIG9ubHkgbW92ZSByZXF1ZXN0cyB0byB0aGUgSFcgcmVhZHkgcXVldWUgd2hlbiB0
aGUgcmVxdWVzdAotCSAqIGJlY29tZXMgcmVhZHksIHRoYXQgaXMgd2hlbiBhbGwgb2YgaXRzIHBy
ZXJlcXVpc2l0ZSBmZW5jZXMgaGF2ZQotCSAqIGJlZW4gc2lnbmFsZWQuIEFzIG9uZSBvZiB0aG9z
ZSBmZW5jZXMgaXMgdGhlIG1hc3RlciBzdWJtaXQgZmVuY2UsCi0JICogdGhlcmUgaXMgYSBkZWxh
eSBvbiBhbGwgc2Vjb25kYXJ5IGZlbmNlcyBhcyB0aGUgSFcgbWF5IGJlCi0JICogY3VycmVudGx5
IGJ1c3kuIEVxdWFsbHksIGFzIGFsbCB0aGUgcmVxdWVzdHMgYXJlIGluZGVwZW5kZW50LAotCSAq
IHRoZXkgbWF5IGhhdmUgb3RoZXIgZmVuY2VzIHRoYXQgZGVsYXkgaW5kaXZpZHVhbCByZXF1ZXN0
Ci0JICogc3VibWlzc2lvbiB0byBIVy4gRXJnbywgd2UgZG8gbm90IGd1YXJhbnRlZSB0aGF0IGFs
bCByZXF1ZXN0cyBhcmUKLQkgKiBpbW1lZGlhdGVseSBzdWJtaXR0ZWQgdG8gSFcgYXQgdGhlIHNh
bWUgdGltZSwganVzdCB0aGF0IGlmIHRoZQotCSAqIHJ1bGVzIGFyZSBhYmlkZWQgYnksIHRoZXkg
YXJlIHJlYWR5IGF0IHRoZSBzYW1lIHRpbWUgYXMgdGhlCi0JICogZmlyc3QgaXMgc3VibWl0dGVk
LiBVc2Vyc3BhY2UgY2FuIGVtYmVkIHNlbWFwaG9yZXMgaW4gaXRzIGJhdGNoCi0JICogdG8gZW5z
dXJlIHBhcmFsbGVsIGV4ZWN1dGlvbiBvZiBpdHMgcGhhc2VzIGFzIGl0IHJlcXVpcmVzLgotCSAq
IFRob3VnaCBuYXR1cmFsbHkgaXQgZ2V0cyByZXF1ZXN0ZWQgdGhhdCBwZXJoYXBzIHRoZSBzY2hl
ZHVsZXIgc2hvdWxkCi0JICogdGFrZSBjYXJlIG9mIHBhcmFsbGVsIGV4ZWN1dGlvbiwgZXZlbiBh
Y3Jvc3MgcHJlZW1wdGlvbiBldmVudHMgb24KLQkgKiBkaWZmZXJlbnQgSFcuIChUaGUgcHJvcGVy
IGFuc3dlciBpcyBvZiBjb3Vyc2UgImxhbGFsYWxhIi4pCi0JICoKLQkgKiBXaXRoIHRoZSBzdWJt
aXQtZmVuY2UsIHdlIGhhdmUgaWRlbnRpZmllZCB0aHJlZSBwb3NzaWJsZSBwaGFzZXMKLQkgKiBv
ZiBzeW5jaHJvbmlzYXRpb24gZGVwZW5kaW5nIG9uIHRoZSBtYXN0ZXIgZmVuY2U6IHF1ZXVlZCAo
bm90Ci0JICogcmVhZHkpLCBleGVjdXRpbmcsIGFuZCBzaWduYWxlZC4gVGhlIGZpcnN0IHR3byBh
cmUgcXVpdGUgc2ltcGxlCi0JICogYW5kIGNoZWNrZWQgYmVsb3cuIEhvd2V2ZXIsIHRoZSBzaWdu
YWxlZCBtYXN0ZXIgZmVuY2UgaGFuZGxpbmcgaXMKLQkgKiBjb250ZW50aW91cy4gQ3VycmVudGx5
IHdlIGRvIG5vdCBkaXN0aW5ndWlzaCBiZXR3ZWVuIGEgc2lnbmFsZWQKLQkgKiBmZW5jZSBhbmQg
YW4gZXhwaXJlZCBmZW5jZSwgYXMgb25jZSBzaWduYWxlZCBpdCBkb2VzIG5vdCBjb252ZXkKLQkg
KiBhbnkgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHByZXZpb3VzIGV4ZWN1dGlvbi4gSXQgbWF5IGV2
ZW4gYmUgZnJlZWQKLQkgKiBhbmQgaGVuY2UgY2hlY2tpbmcgbGF0ZXIgaXQgbWF5IG5vdCBleGlz
dCBhdCBhbGwuIEVyZ28gd2UgY3VycmVudGx5Ci0JICogZG8gbm90IGFwcGx5IHRoZSBib25kaW5n
IGNvbnN0cmFpbnQgZm9yIGFuIGFscmVhZHkgc2lnbmFsZWQgZmVuY2UsCi0JICogYXMgb3VyIGV4
cGVjdGF0aW9uIGlzIHRoYXQgaXQgc2hvdWxkIG5vdCBjb25zdHJhaW4gdGhlIHNlY29uZGFyaWVz
Ci0JICogYW5kIGlzIG91dHNpZGUgb2YgdGhlIHNjb3BlIG9mIHRoZSBib25kZWQgcmVxdWVzdCBB
UEkgKGkuZS4gYWxsCi0JICogdXNlcnNwYWNlIHJlcXVlc3RzIGFyZSBtZWFudCB0byBiZSBydW5u
aW5nIGluIHBhcmFsbGVsKS4gQXMKLQkgKiBpdCBpbXBvc2VzIG5vIGNvbnN0cmFpbnQsIGFuZCBp
cyBlZmZlY3RpdmVseSBhIG5vLW9wLCB3ZSBkbyBub3QKLQkgKiBjaGVjayBiZWxvdyBhcyBub3Jt
YWwgZXhlY3V0aW9uIGZsb3dzIGFyZSBjaGVja2VkIGV4dGVuc2l2ZWx5IGFib3ZlLgotCSAqCi0J
ICogWFhYIElzIHRoZSBkZWdlbmVyYXRlIGhhbmRsaW5nIG9mIHNpZ25hbGVkIHN1Ym1pdCBmZW5j
ZXMgdGhlCi0JICogZXhwZWN0ZWQgYmVoYXZpb3VyIGZvciB1c2VycGFjZT8KLQkgKi8KLQotCUdF
TV9CVUdfT04obnNpYmxpbmcgPj0gQVJSQVlfU0laRShycSkgLSAxKTsKLQotCWlmIChpZ3Rfc3Bp
bm5lcl9pbml0KCZzcGluLCBndCkpCi0JCXJldHVybiAtRU5PTUVNOwotCi0JY3R4ID0ga2VybmVs
X2NvbnRleHQoZ3QtPmk5MTUpOwotCWlmICghY3R4KSB7Ci0JCWVyciA9IC1FTk9NRU07Ci0JCWdv
dG8gZXJyX3NwaW47Ci0JfQotCi0JZXJyID0gMDsKLQlycVswXSA9IEVSUl9QVFIoLUVOT01FTSk7
Ci0JZm9yX2VhY2hfZW5naW5lKG1hc3RlciwgZ3QsIGlkKSB7Ci0JCXN0cnVjdCBpOTE1X3N3X2Zl
bmNlIGZlbmNlID0ge307Ci0KLQkJaWYgKG1hc3Rlci0+Y2xhc3MgPT0gY2xhc3MpCi0JCQljb250
aW51ZTsKLQotCQltZW1zZXRfcCgodm9pZCAqKXJxLCBFUlJfUFRSKC1FSU5WQUwpLCBBUlJBWV9T
SVpFKHJxKSk7Ci0KLQkJcnFbMF0gPSBzcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZzcGluLCBjdHgs
IG1hc3RlciwgTUlfTk9PUCk7Ci0JCWlmIChJU19FUlIocnFbMF0pKSB7Ci0JCQllcnIgPSBQVFJf
RVJSKHJxWzBdKTsKLQkJCWdvdG8gb3V0OwotCQl9Ci0JCWk5MTVfcmVxdWVzdF9nZXQocnFbMF0p
OwotCi0JCWlmIChmbGFncyAmIEJPTkRfU0NIRURVTEUpIHsKLQkJCW9uc3RhY2tfZmVuY2VfaW5p
dCgmZmVuY2UpOwotCQkJZXJyID0gaTkxNV9zd19mZW5jZV9hd2FpdF9zd19mZW5jZV9nZnAoJnJx
WzBdLT5zdWJtaXQsCi0JCQkJCQkJICAgICAgICZmZW5jZSwKLQkJCQkJCQkgICAgICAgR0ZQX0tF
Uk5FTCk7Ci0JCX0KLQotCQlpOTE1X3JlcXVlc3RfYWRkKHJxWzBdKTsKLQkJaWYgKGVyciA8IDAp
Ci0JCQlnb3RvIG91dDsKLQotCQlpZiAoIShmbGFncyAmIEJPTkRfU0NIRURVTEUpICYmCi0JCSAg
ICAhaWd0X3dhaXRfZm9yX3NwaW5uZXIoJnNwaW4sIHJxWzBdKSkgewotCQkJZXJyID0gLUVJTzsK
LQkJCWdvdG8gb3V0OwotCQl9Ci0KLQkJZm9yIChuID0gMDsgbiA8IG5zaWJsaW5nOyBuKyspIHsK
LQkJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICp2ZTsKLQotCQkJdmUgPSBpbnRlbF92aXJ0dWFsX2Vu
Z2luZV9jcmVhdGUoY3R4LAotCQkJCQkJCSBzaWJsaW5ncywKLQkJCQkJCQkgbnNpYmxpbmcpOwot
CQkJaWYgKElTX0VSUih2ZSkpIHsKLQkJCQllcnIgPSBQVFJfRVJSKHZlKTsKLQkJCQlvbnN0YWNr
X2ZlbmNlX2ZpbmkoJmZlbmNlKTsKLQkJCQlnb3RvIG91dDsKLQkJCX0KLQotCQkJZXJyID0gaW50
ZWxfdmlydHVhbF9lbmdpbmVfYXR0YWNoX2JvbmQodmUtPmVuZ2luZSwKLQkJCQkJCQkgICAgICAg
bWFzdGVyLAotCQkJCQkJCSAgICAgICBzaWJsaW5nc1tuXSk7Ci0JCQlpZiAoZXJyKSB7Ci0JCQkJ
aW50ZWxfY29udGV4dF9wdXQodmUpOwotCQkJCW9uc3RhY2tfZmVuY2VfZmluaSgmZmVuY2UpOwot
CQkJCWdvdG8gb3V0OwotCQkJfQotCi0JCQllcnIgPSBpbnRlbF9jb250ZXh0X3Bpbih2ZSk7Ci0J
CQlpbnRlbF9jb250ZXh0X3B1dCh2ZSk7Ci0JCQlpZiAoZXJyKSB7Ci0JCQkJb25zdGFja19mZW5j
ZV9maW5pKCZmZW5jZSk7Ci0JCQkJZ290byBvdXQ7Ci0JCQl9Ci0KLQkJCXJxW24gKyAxXSA9IGk5
MTVfcmVxdWVzdF9jcmVhdGUodmUpOwotCQkJaW50ZWxfY29udGV4dF91bnBpbih2ZSk7Ci0JCQlp
ZiAoSVNfRVJSKHJxW24gKyAxXSkpIHsKLQkJCQllcnIgPSBQVFJfRVJSKHJxW24gKyAxXSk7Ci0J
CQkJb25zdGFja19mZW5jZV9maW5pKCZmZW5jZSk7Ci0JCQkJZ290byBvdXQ7Ci0JCQl9Ci0JCQlp
OTE1X3JlcXVlc3RfZ2V0KHJxW24gKyAxXSk7Ci0KLQkJCWVyciA9IGk5MTVfcmVxdWVzdF9hd2Fp
dF9leGVjdXRpb24ocnFbbiArIDFdLAotCQkJCQkJCSAgICZycVswXS0+ZmVuY2UsCi0JCQkJCQkJ
ICAgdmUtPmVuZ2luZS0+Ym9uZF9leGVjdXRlKTsKLQkJCWk5MTVfcmVxdWVzdF9hZGQocnFbbiAr
IDFdKTsKLQkJCWlmIChlcnIgPCAwKSB7Ci0JCQkJb25zdGFja19mZW5jZV9maW5pKCZmZW5jZSk7
Ci0JCQkJZ290byBvdXQ7Ci0JCQl9Ci0JCX0KLQkJb25zdGFja19mZW5jZV9maW5pKCZmZW5jZSk7
Ci0JCWludGVsX2VuZ2luZV9mbHVzaF9zdWJtaXNzaW9uKG1hc3Rlcik7Ci0JCWlndF9zcGlubmVy
X2VuZCgmc3Bpbik7Ci0KLQkJaWYgKGk5MTVfcmVxdWVzdF93YWl0KHJxWzBdLCAwLCBIWiAvIDEw
KSA8IDApIHsKLQkJCXByX2VycigiTWFzdGVyIHJlcXVlc3QgZGlkIG5vdCBleGVjdXRlIChvbiAl
cykhXG4iLAotCQkJICAgICAgIHJxWzBdLT5lbmdpbmUtPm5hbWUpOwotCQkJZXJyID0gLUVJTzsK
LQkJCWdvdG8gb3V0OwotCQl9Ci0KLQkJZm9yIChuID0gMDsgbiA8IG5zaWJsaW5nOyBuKyspIHsK
LQkJCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChycVtuICsgMV0sIDAsCi0JCQkJCSAgICAgIE1BWF9T
Q0hFRFVMRV9USU1FT1VUKSA8IDApIHsKLQkJCQllcnIgPSAtRUlPOwotCQkJCWdvdG8gb3V0Owot
CQkJfQotCi0JCQlpZiAocnFbbiArIDFdLT5lbmdpbmUgIT0gc2libGluZ3Nbbl0pIHsKLQkJCQlw
cl9lcnIoIkJvbmRlZCByZXF1ZXN0IGRpZCBub3QgZXhlY3V0ZSBvbiB0YXJnZXQgZW5naW5lOiBl
eHBlY3RlZCAlcywgdXNlZCAlczsgbWFzdGVyIHdhcyAlc1xuIiwKLQkJCQkgICAgICAgc2libGlu
Z3Nbbl0tPm5hbWUsCi0JCQkJICAgICAgIHJxW24gKyAxXS0+ZW5naW5lLT5uYW1lLAotCQkJCSAg
ICAgICBycVswXS0+ZW5naW5lLT5uYW1lKTsKLQkJCQllcnIgPSAtRUlOVkFMOwotCQkJCWdvdG8g
b3V0OwotCQkJfQotCQl9Ci0KLQkJZm9yIChuID0gMDsgIUlTX0VSUihycVtuXSk7IG4rKykKLQkJ
CWk5MTVfcmVxdWVzdF9wdXQocnFbbl0pOwotCQlycVswXSA9IEVSUl9QVFIoLUVOT01FTSk7Ci0J
fQotCi1vdXQ6Ci0JZm9yIChuID0gMDsgIUlTX0VSUihycVtuXSk7IG4rKykKLQkJaTkxNV9yZXF1
ZXN0X3B1dChycVtuXSk7Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KSkKLQkJZXJyID0g
LUVJTzsKLQotCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7Ci1lcnJfc3BpbjoKLQlpZ3Rfc3Bp
bm5lcl9maW5pKCZzcGluKTsKLQlyZXR1cm4gZXJyOwotfQotCi1zdGF0aWMgaW50IGxpdmVfdmly
dHVhbF9ib25kKHZvaWQgKmFyZykKLXsKLQlzdGF0aWMgY29uc3Qgc3RydWN0IHBoYXNlIHsKLQkJ
Y29uc3QgY2hhciAqbmFtZTsKLQkJdW5zaWduZWQgaW50IGZsYWdzOwotCX0gcGhhc2VzW10gPSB7
Ci0JCXsgIiIsIDAgfSwKLQkJeyAic2NoZWR1bGUiLCBCT05EX1NDSEVEVUxFIH0sCi0JCXsgfSwK
LQl9OwotCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7Ci0Jc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqc2libGluZ3NbTUFYX0VOR0lORV9JTlNUQU5DRSArIDFdOwotCXVuc2lnbmVkIGludCBjbGFz
cywgaW5zdDsKLQlpbnQgZXJyOwotCi0JaWYgKFVTRVNfR1VDX1NVQk1JU1NJT04oZ3QtPmk5MTUp
KQotCQlyZXR1cm4gMDsKLQotCWZvciAoY2xhc3MgPSAwOyBjbGFzcyA8PSBNQVhfRU5HSU5FX0NM
QVNTOyBjbGFzcysrKSB7Ci0JCWNvbnN0IHN0cnVjdCBwaGFzZSAqcDsKLQkJaW50IG5zaWJsaW5n
OwotCi0JCW5zaWJsaW5nID0gMDsKLQkJZm9yIChpbnN0ID0gMDsgaW5zdCA8PSBNQVhfRU5HSU5F
X0lOU1RBTkNFOyBpbnN0KyspIHsKLQkJCWlmICghZ3QtPmVuZ2luZV9jbGFzc1tjbGFzc11baW5z
dF0pCi0JCQkJYnJlYWs7Ci0KLQkJCUdFTV9CVUdfT04obnNpYmxpbmcgPT0gQVJSQVlfU0laRShz
aWJsaW5ncykpOwotCQkJc2libGluZ3NbbnNpYmxpbmcrK10gPSBndC0+ZW5naW5lX2NsYXNzW2Ns
YXNzXVtpbnN0XTsKLQkJfQotCQlpZiAobnNpYmxpbmcgPCAyKQotCQkJY29udGludWU7Ci0KLQkJ
Zm9yIChwID0gcGhhc2VzOyBwLT5uYW1lOyBwKyspIHsKLQkJCWVyciA9IGJvbmRfdmlydHVhbF9l
bmdpbmUoZ3QsCi0JCQkJCQkgIGNsYXNzLCBzaWJsaW5ncywgbnNpYmxpbmcsCi0JCQkJCQkgIHAt
PmZsYWdzKTsKLQkJCWlmIChlcnIpIHsKLQkJCQlwcl9lcnIoIiVzKCVzKTogZmFpbGVkIGNsYXNz
PSVkLCBuc2libGluZz0lZCwgZXJyPSVkXG4iLAotCQkJCSAgICAgICBfX2Z1bmNfXywgcC0+bmFt
ZSwgY2xhc3MsIG5zaWJsaW5nLCBlcnIpOwotCQkJCXJldHVybiBlcnI7Ci0JCQl9Ci0JCX0KLQl9
Ci0KLQlyZXR1cm4gMDsKLX0KLQotaW50IGludGVsX2V4ZWNsaXN0c19saXZlX3NlbGZ0ZXN0cyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKLXsKLQlzdGF0aWMgY29uc3Qgc3RydWN0IGk5
MTVfc3VidGVzdCB0ZXN0c1tdID0gewotCQlTVUJURVNUKGxpdmVfc2FuaXR5Y2hlY2spLAotCQlT
VUJURVNUKGxpdmVfdW5saXRlX3N3aXRjaCksCi0JCVNVQlRFU1QobGl2ZV91bmxpdGVfcHJlZW1w
dCksCi0JCVNVQlRFU1QobGl2ZV90aW1lc2xpY2VfcHJlZW1wdCksCi0JCVNVQlRFU1QobGl2ZV90
aW1lc2xpY2VfcXVldWUpLAotCQlTVUJURVNUKGxpdmVfYnVzeXdhaXRfcHJlZW1wdCksCi0JCVNV
QlRFU1QobGl2ZV9wcmVlbXB0KSwKLQkJU1VCVEVTVChsaXZlX2xhdGVfcHJlZW1wdCksCi0JCVNV
QlRFU1QobGl2ZV9ub3ByZWVtcHQpLAotCQlTVUJURVNUKGxpdmVfcHJlZW1wdF9jYW5jZWwpLAot
CQlTVUJURVNUKGxpdmVfc3VwcHJlc3Nfc2VsZl9wcmVlbXB0KSwKLQkJU1VCVEVTVChsaXZlX3N1
cHByZXNzX3dhaXRfcHJlZW1wdCksCi0JCVNVQlRFU1QobGl2ZV9jaGFpbl9wcmVlbXB0KSwKLQkJ
U1VCVEVTVChsaXZlX3ByZWVtcHRfZ2FuZyksCi0JCVNVQlRFU1QobGl2ZV9wcmVlbXB0X2hhbmcp
LAotCQlTVUJURVNUKGxpdmVfcHJlZW1wdF90aW1lb3V0KSwKLQkJU1VCVEVTVChsaXZlX3ByZWVt
cHRfc21va2UpLAotCQlTVUJURVNUKGxpdmVfdmlydHVhbF9lbmdpbmUpLAotCQlTVUJURVNUKGxp
dmVfdmlydHVhbF9tYXNrKSwKLQkJU1VCVEVTVChsaXZlX3ZpcnR1YWxfcHJlc2VydmVkKSwKLQkJ
U1VCVEVTVChsaXZlX3ZpcnR1YWxfYm9uZCksCi0JfTsKLQotCWlmICghSEFTX0VYRUNMSVNUUyhp
OTE1KSkKLQkJcmV0dXJuIDA7Ci0KLQlpZiAoaW50ZWxfZ3RfaXNfd2VkZ2VkKCZpOTE1LT5ndCkp
Ci0JCXJldHVybiAwOwotCi0JcmV0dXJuIGludGVsX2d0X2xpdmVfc3VidGVzdHModGVzdHMsICZp
OTE1LT5ndCk7Ci19Ci0KIHN0YXRpYyB2b2lkIGhleGR1bXAoY29uc3Qgdm9pZCAqYnVmLCBzaXpl
X3QgbGVuKQogewogCWNvbnN0IHNpemVfdCByb3dzaXplID0gOCAqIHNpemVvZih1MzIpOwpAQCAt
MzY3MCw3ICszNDEsNyBAQCBzdGF0aWMgaW50IGxpdmVfbHJjX3N0YXRlKHZvaWQgKmFyZykKIAlp
ZiAoIWZpeG1lKQogCQlyZXR1cm4gLUVOT01FTTsKIAotCXNjcmF0Y2ggPSBjcmVhdGVfc2NyYXRj
aChndCk7CisJc2NyYXRjaCA9IGlndF9jcmVhdGVfc2NyYXRjaChndCk7CiAJaWYgKElTX0VSUihz
Y3JhdGNoKSkgewogCQllcnIgPSBQVFJfRVJSKHNjcmF0Y2gpOwogCQlnb3RvIG91dF9jbG9zZTsK
QEAgLTM4MTMsNyArNDg0LDcgQEAgc3RhdGljIGludCBsaXZlX2dwcl9jbGVhcih2b2lkICphcmcp
CiAJaWYgKCFmaXhtZSkKIAkJcmV0dXJuIC1FTk9NRU07CiAKLQlzY3JhdGNoID0gY3JlYXRlX3Nj
cmF0Y2goZ3QpOworCXNjcmF0Y2ggPSBpZ3RfY3JlYXRlX3NjcmF0Y2goZ3QpOwogCWlmIChJU19F
UlIoc2NyYXRjaCkpIHsKIAkJZXJyID0gUFRSX0VSUihzY3JhdGNoKTsKIAkJZ290byBvdXRfY2xv
c2U7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9tb2NzLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9tb2NzLmMKaW5kZXggZGUwMTBmNTI3
NzU3Li40ODA1N2E3YjZlNTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Nl
bGZ0ZXN0X21vY3MuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9tb2Nz
LmMKQEAgLTcsNiArNyw3IEBACiAjaW5jbHVkZSAiZ3QvaW50ZWxfZW5naW5lX3BtLmgiCiAjaW5j
bHVkZSAiaTkxNV9zZWxmdGVzdC5oIgogCisjaW5jbHVkZSAiZ2VtL3NlbGZ0ZXN0cy9pZ3RfZ2Vt
X3V0aWxzLmgiCiAjaW5jbHVkZSAiZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQuaCIKICNpbmNs
dWRlICJzZWxmdGVzdHMvaWd0X3Jlc2V0LmgiCiAjaW5jbHVkZSAic2VsZnRlc3RzL2lndF9zcGlu
bmVyLmgiCkBAIC00MSwzMyArNDIsNiBAQCBzdGF0aWMgaW50IHJlcXVlc3RfYWRkX3NwaW4oc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnEsIHN0cnVjdCBpZ3Rfc3Bpbm5lciAqc3BpbikKIAlyZXR1cm4g
ZXJyOwogfQogCi1zdGF0aWMgc3RydWN0IGk5MTVfdm1hICpjcmVhdGVfc2NyYXRjaChzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0KQotewotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7Ci0Jc3Ry
dWN0IGk5MTVfdm1hICp2bWE7Ci0JaW50IGVycjsKLQotCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9j
cmVhdGVfaW50ZXJuYWwoZ3QtPmk5MTUsIFBBR0VfU0laRSk7Ci0JaWYgKElTX0VSUihvYmopKQot
CQlyZXR1cm4gRVJSX0NBU1Qob2JqKTsKLQotCWk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVfY29o
ZXJlbmN5KG9iaiwgSTkxNV9DQUNISU5HX0NBQ0hFRCk7Ci0KLQl2bWEgPSBpOTE1X3ZtYV9pbnN0
YW5jZShvYmosICZndC0+Z2d0dC0+dm0sIE5VTEwpOwotCWlmIChJU19FUlIodm1hKSkgewotCQlp
OTE1X2dlbV9vYmplY3RfcHV0KG9iaik7Ci0JCXJldHVybiB2bWE7Ci0JfQotCi0JZXJyID0gaTkx
NV92bWFfcGluKHZtYSwgMCwgMCwgUElOX0dMT0JBTCk7Ci0JaWYgKGVycikgewotCQlpOTE1X2dl
bV9vYmplY3RfcHV0KG9iaik7Ci0JCXJldHVybiBFUlJfUFRSKGVycik7Ci0JfQotCi0JcmV0dXJu
IHZtYTsKLX0KLQogc3RhdGljIGludCBsaXZlX21vY3NfaW5pdChzdHJ1Y3QgbGl2ZV9tb2NzICph
cmcsIHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiB7CiAJaW50IGVycjsKQEAgLTc1LDcgKzQ5LDcgQEAg
c3RhdGljIGludCBsaXZlX21vY3NfaW5pdChzdHJ1Y3QgbGl2ZV9tb2NzICphcmcsIHN0cnVjdCBp
bnRlbF9ndCAqZ3QpCiAJaWYgKCFnZXRfbW9jc19zZXR0aW5ncyhndC0+aTkxNSwgJmFyZy0+dGFi
bGUpKQogCQlyZXR1cm4gLUVJTlZBTDsKIAotCWFyZy0+c2NyYXRjaCA9IGNyZWF0ZV9zY3JhdGNo
KGd0KTsKKwlhcmctPnNjcmF0Y2ggPSBpZ3RfY3JlYXRlX3NjcmF0Y2goZ3QpOwogCWlmIChJU19F
UlIoYXJnLT5zY3JhdGNoKSkKIAkJcmV0dXJuIFBUUl9FUlIoYXJnLT5zY3JhdGNoKTsKIAotLSAK
Mi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJ
bnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0
cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZngK

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 6F6FC61DC1
	for <lists+intel-gfx@lfdr.de>; Mon,  8 Jul 2019 13:22:36 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3B1D189A9A;
	Mon,  8 Jul 2019 11:22:34 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id DD81689A9A
 for <intel-gfx@lists.freedesktop.org>; Mon,  8 Jul 2019 11:22:32 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17167770-1500050 
 for multiple; Mon, 08 Jul 2019 12:22:24 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  8 Jul 2019 12:22:23 +0100
Message-Id: <20190708112223.24883-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190708111944.20095-2-chris@chris-wilson.co.uk>
References: <20190708111944.20095-2-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2] drm/i915: Add to timeline requires the
 timeline mutex
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TW9kaWZ5aW5nIGEgcmVtb3RlIGNvbnRleHQgcmVxdWlyZXMgY2FyZWZ1bCBzZXJpYWxpc2F0aW9u
IHdpdGggcmVxdWVzdHMKb24gdGhhdCBjb250ZXh0LCBhbmQgdGhhdCBzZXJpYWxpc2F0aW9uIHJl
cXVpcmVzIHVzIHRvIHRha2UgdGhlaXIKdGltZWxpbmUtPm11dGV4LiBNYWtlIGl0IHNvLgoKTm90
ZSB0aGF0IHdoaWxlIHN0cnVjdF9tdXRleCBydWxlcywgd2UgY2FuJ3QgY3JlYXRlIG1vcmUgdGhh
biBvbmUKcmVxdWVzdCBpbiBwYXJhbGxlbCwgYnV0IHRoYXQgYWdlIGlzIHNvb24gY29taW5nIHRv
IGFuIGVuZC4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29u
LmNvLnVrPgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KLS0t
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jIHwgMTYgKystLS0t
LS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jICAgICB8IDMzICsr
KysrKysrKysrKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4
dC5oICAgICB8ICAzICsrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyAgICAgICAg
ICAgIHwgIDcgKy0tLS0KIDQgZmlsZXMgY2hhbmdlZCwgMzkgaW5zZXJ0aW9ucygrKSwgMjAgZGVs
ZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMK
aW5kZXggMWYwZDEwYmI4OGMxLi42MDAwMTc3NDcyZWUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwpAQCAtMTE5MiwyMCArMTE5Miw4IEBAIGdlbjhfbW9k
aWZ5X3JwY3Moc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCBzdHJ1Y3QgaW50ZWxfc3NldSBzc2V1
KQogCWlmIChJU19FUlIocnEpKQogCQlyZXR1cm4gUFRSX0VSUihycSk7CiAKLQkvKiBRdWV1ZSB0
aGlzIHN3aXRjaCBhZnRlciBhbGwgb3RoZXIgYWN0aXZpdHkgYnkgdGhpcyBjb250ZXh0LiAqLwot
CXJldCA9IGk5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KCZjZS0+cmluZy0+dGltZWxpbmUtPmxhc3Rf
cmVxdWVzdCwgcnEpOwotCWlmIChyZXQpCi0JCWdvdG8gb3V0X2FkZDsKLQotCS8qCi0JICogR3Vh
cmFudGVlIGNvbnRleHQgaW1hZ2UgYW5kIHRoZSB0aW1lbGluZSByZW1haW5zIHBpbm5lZCB1bnRp
bCB0aGUKLQkgKiBtb2RpZnlpbmcgcmVxdWVzdCBpcyByZXRpcmVkIGJ5IHNldHRpbmcgdGhlIGNl
IGFjdGl2aXR5IHRyYWNrZXIuCi0JICoKLQkgKiBCdXQgd2Ugb25seSBuZWVkIHRvIHRha2Ugb25l
IHBpbiBvbiB0aGUgYWNjb3VudCBvZiBpdC4gT3IgaW4gb3RoZXIKLQkgKiB3b3JkcyB0cmFuc2Zl
ciB0aGUgcGlubmVkIGNlIG9iamVjdCB0byB0cmFja2VkIGFjdGl2ZSByZXF1ZXN0LgotCSAqLwot
CUdFTV9CVUdfT04oaTkxNV9hY3RpdmVfaXNfaWRsZSgmY2UtPmFjdGl2ZSkpOwotCXJldCA9IGk5
MTVfYWN0aXZlX3JlZigmY2UtPmFjdGl2ZSwgcnEtPmZlbmNlLmNvbnRleHQsIHJxKTsKKwkvKiBT
ZXJpYWxpc2Ugd2l0aCB0aGUgcmVtb3RlIGNvbnRleHQgKi8KKwlyZXQgPSBpbnRlbF9jb250ZXh0
X3ByZXBhcmVfcmVtb3RlX3JlcXVlc3QoY2UsIHJxKTsKIAlpZiAocmV0KQogCQlnb3RvIG91dF9h
ZGQ7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYwppbmRleCAxMTEwZmM4
ZjY1N2EuLmY2ODA1ZjQ0M2U4ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRl
eHQuYwpAQCAtMjM5LDYgKzIzOSwzOSBAQCB2b2lkIGludGVsX2NvbnRleHRfZXhpdF9lbmdpbmUo
c3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogCWludGVsX2VuZ2luZV9wbV9wdXQoY2UtPmVuZ2lu
ZSk7CiB9CiAKK2ludCBpbnRlbF9jb250ZXh0X3ByZXBhcmVfcmVtb3RlX3JlcXVlc3Qoc3RydWN0
IGludGVsX2NvbnRleHQgKmNlLAorCQkJCQkgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCit7CisJ
c3RydWN0IGludGVsX3RpbWVsaW5lICp0bCA9IGNlLT5yaW5nLT50aW1lbGluZTsKKwlpbnQgZXJy
OworCisJLyogT25seSBzdWl0YWJsZSBmb3IgdXNlIGluIHJlbW90ZWx5IG1vZGlmeWluZyB0aGlz
IGNvbnRleHQgKi8KKwlHRU1fQlVHX09OKHJxLT5od19jb250ZXh0ID09IGNlKTsKKworCWVyciA9
IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZV9uZXN0ZWQoJnRsLT5tdXRleCwgU0lOR0xFX0RFUFRI
X05FU1RJTkcpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwkvKiBRdWV1ZSB0aGlzIHN3
aXRjaCBhZnRlciBhbGwgb3RoZXIgYWN0aXZpdHkgYnkgdGhpcyBjb250ZXh0LiAqLworCWVyciA9
IGk5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KCZ0bC0+bGFzdF9yZXF1ZXN0LCBycSk7CisJaWYgKGVy
cikKKwkJZ290byB1bmxvY2s7CisKKwkvKgorCSAqIEd1YXJhbnRlZSBjb250ZXh0IGltYWdlIGFu
ZCB0aGUgdGltZWxpbmUgcmVtYWlucyBwaW5uZWQgdW50aWwgdGhlCisJICogbW9kaWZ5aW5nIHJl
cXVlc3QgaXMgcmV0aXJlZCBieSBzZXR0aW5nIHRoZSBjZSBhY3Rpdml0eSB0cmFja2VyLgorCSAq
CisJICogQnV0IHdlIG9ubHkgbmVlZCB0byB0YWtlIG9uZSBwaW4gb24gdGhlIGFjY291bnQgb2Yg
aXQuIE9yIGluIG90aGVyCisJICogd29yZHMgdHJhbnNmZXIgdGhlIHBpbm5lZCBjZSBvYmplY3Qg
dG8gdHJhY2tlZCBhY3RpdmUgcmVxdWVzdC4KKwkgKi8KKwlHRU1fQlVHX09OKGk5MTVfYWN0aXZl
X2lzX2lkbGUoJmNlLT5hY3RpdmUpKTsKKwllcnIgPSBpOTE1X2FjdGl2ZV9yZWYoJmNlLT5hY3Rp
dmUsIHJxLT5mZW5jZS5jb250ZXh0LCBycSk7CisKK3VubG9jazoKKwltdXRleF91bmxvY2soJnRs
LT5tdXRleCk7CisJcmV0dXJuIGVycjsKK30KKwogc3RydWN0IGk5MTVfcmVxdWVzdCAqaW50ZWxf
Y29udGV4dF9jcmVhdGVfcmVxdWVzdChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiB7CiAJc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnE7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9jb250ZXh0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0
LmgKaW5kZXggNDBjZDgzMjBmY2MzLi5iNDFjNjEwYzJjZTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9jb250ZXh0LmgKQEAgLTEzOSw2ICsxMzksOSBAQCBzdGF0aWMgaW5saW5lIHZv
aWQgaW50ZWxfY29udGV4dF90aW1lbGluZV91bmxvY2soc3RydWN0IGludGVsX2NvbnRleHQgKmNl
KQogCW11dGV4X3VubG9jaygmY2UtPnJpbmctPnRpbWVsaW5lLT5tdXRleCk7CiB9CiAKK2ludCBp
bnRlbF9jb250ZXh0X3ByZXBhcmVfcmVtb3RlX3JlcXVlc3Qoc3RydWN0IGludGVsX2NvbnRleHQg
KmNlLAorCQkJCQkgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpOworCiBzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICppbnRlbF9jb250ZXh0X2NyZWF0ZV9yZXF1ZXN0KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpj
ZSk7CiAKICNlbmRpZiAvKiBfX0lOVEVMX0NPTlRFWFRfSF9fICovCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
cGVyZi5jCmluZGV4IDI1YzM0YTBiNTIxZS4uNmY3NzAxNDY0MGI4IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3BlcmYuYwpAQCAtMTc2MiwxMiArMTc2Miw3IEBAIHN0YXRpYyBpbnQgZ2VuOF9tb2RpZnlf
Y29udGV4dChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJCXJldHVybiBQVFJfRVJSKHJxKTsK
IAogCS8qIFNlcmlhbGlzZSB3aXRoIHRoZSByZW1vdGUgY29udGV4dCAqLwotCWVyciA9IGk5MTVf
YWN0aXZlX3JlcXVlc3Rfc2V0KCZjZS0+cmluZy0+dGltZWxpbmUtPmxhc3RfcmVxdWVzdCwgcnEp
OwotCWlmIChlcnIpCi0JCWdvdG8gb3V0X2FkZDsKLQotCS8qIEtlZXAgdGhlIHJlbW90ZSBjb250
ZXh0IGFsaXZlIHVudGlsIGFmdGVyIHdlIGZpbmlzaCBlZGl0aW5nICovCi0JZXJyID0gaTkxNV9h
Y3RpdmVfcmVmKCZjZS0+YWN0aXZlLCBycS0+ZmVuY2UuY29udGV4dCwgcnEpOworCWVyciA9IGlu
dGVsX2NvbnRleHRfcHJlcGFyZV9yZW1vdGVfcmVxdWVzdChjZSwgcnEpOwogCWlmIChlcnIpCiAJ
CWdvdG8gb3V0X2FkZDsKIAotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0
cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9s
aXN0aW5mby9pbnRlbC1nZng=

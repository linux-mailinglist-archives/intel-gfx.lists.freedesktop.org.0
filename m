Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 5CB4C1C3B26
	for <lists+intel-gfx@lfdr.de>; Mon,  4 May 2020 15:23:17 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B396C6E3F5;
	Mon,  4 May 2020 13:23:15 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6DFE16E3F7
 for <intel-gfx@lists.freedesktop.org>; Mon,  4 May 2020 13:23:13 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from build.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 21107762-1500050 
 for multiple; Mon, 04 May 2020 14:22:42 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  4 May 2020 14:22:39 +0100
Message-Id: <20200504132239.18740-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20200504044903.7626-3-chris@chris-wilson.co.uk>
References: <20200504044903.7626-3-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2] drm/i915/gem: Implement legacy
 MI_STORE_DATA_IMM
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Chris Wilson <chris@chris-wilson.co.uk>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIG9sZGVyIGFyY2hlcyBkaWQgbm90IGNvbnZlcnQgTUlfU1RPUkVfREFUQV9JTU0gdG8gdXNp
bmcgdGhlIEdUVCwgYnV0CmxlZnQgdGhlbSB3cml0aW5nIHRvIGEgcGh5c2ljYWwgYWRkcmVzcy4g
VGhlIG5vdGVzIHN1Z2dlc3QgdGhhdCB0aGUKcHJpbWFyeSByZWFzb24gd291bGQgYmUgc28gdGhh
dCB0aGUgd3JpdGVzIHdlcmUgY2FjaGUgY29oZXJlbnQsIGFzIHRoZQpDUFUgY2FjaGUgdXNlcyBw
aHlzaWNhbCB0YWdnaW5nLiBBcyBzdWNoIHdlIGRpZCBub3QgaW1wbGVtZW50IHRoZQpsZWdhY3kg
dmFyaWFudCBvZiBNSV9TVE9SRV9EQVRBX0lNTSBhbmQgc28gbGVmdCBhbGwgdGhlIHJlbG9jYXRp
b25zCnN5bmNocm9ub3VzIC0tIGJ1dCB3aXRoIGEgc21hbGwgZnVuY3Rpb24gdG8gY29udmVydCBm
cm9tIHRoZSB2bWEgYWRkcmVzcwppbnRvIHRoZSBwaHlzaWNhbCBhZGRyZXNzLCB3ZSBjYW4gaW1w
bGVtZW50IGFzeW5jaHJvbm91cyByZWxvY3Mgb24gdGhlc2UKb2xkZXIgYXJjaGVzLCBmaXhpbmcg
dXAgYSBmZXcgdGVzdHMgdGhhdCByZXF1aXJlIHRoZW0uCgpJbiBvcmRlciB0byBiZSBhYmxlIHRv
IHRlc3QgdGhlIGxlZ2FjeSBwYXRocywgcmVmYWN0b3IgdGhlIGdwdQpyZWxvY2F0aW9ucyBzbyB0
aGF0IHdlIGNhbiBob29rIHRoZW0gdXAgdG8gYSBzZWxmdGVzdC4KCnYyOiBVc2UgYW4gYXJyYXkg
b2Ygb2Zmc2V0cyBub3QgZW51bSBsYWJlbHMgZm9yIHRoZSBzZWxmdGVzdAp2MzogUmVmYWN0b3Ig
dGhlIGNvbW1vbiBpZ3RfaGV4ZHVtcCgpCgpDbG9zZXM6IGh0dHBzOi8vZ2l0bGFiLmZyZWVkZXNr
dG9wLm9yZy9kcm0vaW50ZWwvLS9pc3N1ZXMvNzU3ClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNv
biA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51
cnN1bGluQGludGVsLmNvbT4KLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVj
YnVmZmVyLmMgICAgfCAyMDQgKysrKysrKysrKystLS0tLS0tCiAuLi4vaTkxNS9nZW0vc2VsZnRl
c3RzL2k5MTVfZ2VtX2NsaWVudF9ibHQuYyAgfCAgMzEgKy0tCiAuLi4vaTkxNS9nZW0vc2VsZnRl
c3RzL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyAgfCAxNzEgKysrKysrKysrKysrKysrCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYyAgICAgICAgfCAgMzMgKy0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X3NlbGZ0ZXN0LmggICAgICAgICAgfCAgIDIgKwogLi4uL2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X2xpdmVfc2VsZnRlc3RzLmggIHwgICAxICsKIC4uLi9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL2k5MTVfc2VsZnRlc3QuYyAgICB8ICAyOSArKysKIDcgZmlsZXMgY2hh
bmdlZCwgMzM2IGluc2VydGlvbnMoKyksIDEzNSBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEw
MDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2V4ZWNidWZm
ZXIuYwoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVj
YnVmZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5j
CmluZGV4IDFjMjQ3YWQwOTcxYS4uOTY2NTIzYTg1MDNmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKQEAgLTk1NSw3ICs5NTUsNyBAQCBzdGF0
aWMgdm9pZCByZWxvY19jYWNoZV9pbml0KHN0cnVjdCByZWxvY19jYWNoZSAqY2FjaGUsCiAJY2Fj
aGUtPm5lZWRzX3VuZmVuY2VkID0gSU5URUxfSU5GTyhpOTE1KS0+dW5mZW5jZWRfbmVlZHNfYWxp
Z25tZW50OwogCWNhY2hlLT5ub2RlLmZsYWdzID0gMDsKIAljYWNoZS0+cnEgPSBOVUxMOwotCWNh
Y2hlLT5ycV9zaXplID0gMDsKKwljYWNoZS0+dGFyZ2V0ID0gTlVMTDsKIH0KIAogc3RhdGljIGlu
bGluZSB2b2lkICp1bm1hc2tfcGFnZSh1bnNpZ25lZCBsb25nIHApCkBAIC0xMzI1LDcgKzEzMjUs
NyBAQCBzdGF0aWMgaW50IF9fcmVsb2NfZ3B1X2FsbG9jKHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIg
KmViLAogCiAJCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKIAkJaWYgKElTX0VS
UihjZSkpIHsKLQkJCWVyciA9IFBUUl9FUlIocnEpOworCQkJZXJyID0gUFRSX0VSUihjZSk7CiAJ
CQlnb3RvIGVycl91bnBpbjsKIAkJfQogCkBAIC0xMzc2LDYgKzEzNzYsMTEgQEAgc3RhdGljIGlu
dCBfX3JlbG9jX2dwdV9hbGxvYyhzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYiwKIAlyZXR1cm4g
ZXJyOwogfQogCitzdGF0aWMgYm9vbCByZWxvY19jYW5fdXNlX2VuZ2luZShjb25zdCBzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUpCit7CisJcmV0dXJuIGVuZ2luZS0+Y2xhc3MgIT0gVklE
RU9fREVDT0RFX0NMQVNTIHx8ICFJU19HRU4oZW5naW5lLT5pOTE1LCA2KTsKK30KKwogc3RhdGlj
IHUzMiAqcmVsb2NfZ3B1KHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViLAogCQkgICAgICBzdHJ1
Y3QgaTkxNV92bWEgKnZtYSwKIAkJICAgICAgdW5zaWduZWQgaW50IGxlbikKQEAgLTEzODcsOSAr
MTM5Miw5IEBAIHN0YXRpYyB1MzIgKnJlbG9jX2dwdShzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICpl
YiwKIAlpZiAodW5saWtlbHkoIWNhY2hlLT5ycSkpIHsKIAkJc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lID0gZWItPmVuZ2luZTsKIAotCQlpZiAoIWludGVsX2VuZ2luZV9jYW5fc3RvcmVf
ZHdvcmQoZW5naW5lKSkgeworCQlpZiAoIXJlbG9jX2Nhbl91c2VfZW5naW5lKGVuZ2luZSkpIHsK
IAkJCWVuZ2luZSA9IGVuZ2luZS0+Z3QtPmVuZ2luZV9jbGFzc1tDT1BZX0VOR0lORV9DTEFTU11b
MF07Ci0JCQlpZiAoIWVuZ2luZSB8fCAhaW50ZWxfZW5naW5lX2Nhbl9zdG9yZV9kd29yZChlbmdp
bmUpKQorCQkJaWYgKCFlbmdpbmUpCiAJCQkJcmV0dXJuIEVSUl9QVFIoLUVOT0RFVik7CiAJCX0K
IApAQCAtMTQzNSw5MSArMTQ0MCwxMzggQEAgc3RhdGljIGlubGluZSBib29sIHVzZV9yZWxvY19n
cHUoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJcmV0dXJuICFkbWFfcmVzdl90ZXN0X3NpZ25hbGVk
X3JjdSh2bWEtPnJlc3YsIHRydWUpOwogfQogCi1zdGF0aWMgdTY0Ci1yZWxvY2F0ZV9lbnRyeShz
dHJ1Y3QgaTkxNV92bWEgKnZtYSwKLQkgICAgICAgY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9y
ZWxvY2F0aW9uX2VudHJ5ICpyZWxvYywKLQkgICAgICAgc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAq
ZWIsCi0JICAgICAgIGNvbnN0IHN0cnVjdCBpOTE1X3ZtYSAqdGFyZ2V0KQorc3RhdGljIHVuc2ln
bmVkIGxvbmcgdm1hX3BoeXNfYWRkcihzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTMyIG9mZnNldCkK
IHsKLQl1NjQgb2Zmc2V0ID0gcmVsb2MtPm9mZnNldDsKLQl1NjQgdGFyZ2V0X29mZnNldCA9IHJl
bG9jYXRpb25fdGFyZ2V0KHJlbG9jLCB0YXJnZXQpOwotCWJvb2wgd2lkZSA9IGViLT5yZWxvY19j
YWNoZS51c2VfNjRiaXRfcmVsb2M7Ci0Jdm9pZCAqdmFkZHI7CisJc3RydWN0IHBhZ2UgKnBhZ2U7
CisJdW5zaWduZWQgbG9uZyBhZGRyOwogCi0JaWYgKCFlYi0+cmVsb2NfY2FjaGUudmFkZHIgJiYg
dXNlX3JlbG9jX2dwdSh2bWEpKSB7Ci0JCWNvbnN0IHVuc2lnbmVkIGludCBnZW4gPSBlYi0+cmVs
b2NfY2FjaGUuZ2VuOwotCQl1bnNpZ25lZCBpbnQgbGVuOwotCQl1MzIgKmJhdGNoOwotCQl1NjQg
YWRkcjsKKwlHRU1fQlVHX09OKHZtYS0+cGFnZXMgIT0gdm1hLT5vYmotPm1tLnBhZ2VzKTsKIAot
CQlpZiAod2lkZSkKLQkJCWxlbiA9IG9mZnNldCAmIDcgPyA4IDogNTsKLQkJZWxzZSBpZiAoZ2Vu
ID49IDQpCi0JCQlsZW4gPSA0OwotCQllbHNlCi0JCQlsZW4gPSAzOworCXBhZ2UgPSBpOTE1X2dl
bV9vYmplY3RfZ2V0X3BhZ2Uodm1hLT5vYmosIG9mZnNldCA+PiBQQUdFX1NISUZUKTsKKwlhZGRy
ID0gUEZOX1BIWVMocGFnZV90b19wZm4ocGFnZSkpOworCUdFTV9CVUdfT04ob3ZlcmZsb3dzX3R5
cGUoYWRkciwgdTMyKSk7IC8qIGV4cGVjdGVkIGRtYTMyICovCiAKLQkJYmF0Y2ggPSByZWxvY19n
cHUoZWIsIHZtYSwgbGVuKTsKLQkJaWYgKElTX0VSUihiYXRjaCkpCi0JCQlnb3RvIHJlcGVhdDsK
KwlyZXR1cm4gYWRkciArIG9mZnNldF9pbl9wYWdlKG9mZnNldCk7Cit9CisKK3N0YXRpYyBib29s
IF9fcmVsb2NfZW50cnlfZ3B1KHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViLAorCQkJICAgICAg
c3RydWN0IGk5MTVfdm1hICp2bWEsCisJCQkgICAgICB1NjQgb2Zmc2V0LAorCQkJICAgICAgdTY0
IHRhcmdldF9hZGRyKQoreworCWNvbnN0IHVuc2lnbmVkIGludCBnZW4gPSBlYi0+cmVsb2NfY2Fj
aGUuZ2VuOworCXVuc2lnbmVkIGludCBsZW47CisJdTMyICpiYXRjaDsKKwl1NjQgYWRkcjsKKwor
CWlmIChnZW4gPj0gOCkKKwkJbGVuID0gb2Zmc2V0ICYgNyA/IDggOiA1OworCWVsc2UgaWYgKGdl
biA+PSA0KQorCQlsZW4gPSA0OworCWVsc2UKKwkJbGVuID0gMzsKKworCWJhdGNoID0gcmVsb2Nf
Z3B1KGViLCB2bWEsIGxlbik7CisJaWYgKElTX0VSUihiYXRjaCkpCisJCXJldHVybiBmYWxzZTsK
KworCWFkZHIgPSBnZW44X2Nhbm9uaWNhbF9hZGRyKHZtYS0+bm9kZS5zdGFydCArIG9mZnNldCk7
CisJaWYgKGdlbiA+PSA4KSB7CisJCWlmIChvZmZzZXQgJiA3KSB7CisJCQkqYmF0Y2grKyA9IE1J
X1NUT1JFX0RXT1JEX0lNTV9HRU40OworCQkJKmJhdGNoKysgPSBsb3dlcl8zMl9iaXRzKGFkZHIp
OworCQkJKmJhdGNoKysgPSB1cHBlcl8zMl9iaXRzKGFkZHIpOworCQkJKmJhdGNoKysgPSBsb3dl
cl8zMl9iaXRzKHRhcmdldF9hZGRyKTsKKworCQkJYWRkciA9IGdlbjhfY2Fub25pY2FsX2FkZHIo
YWRkciArIDQpOwogCi0JCWFkZHIgPSBnZW44X2Nhbm9uaWNhbF9hZGRyKHZtYS0+bm9kZS5zdGFy
dCArIG9mZnNldCk7Ci0JCWlmICh3aWRlKSB7Ci0JCQlpZiAob2Zmc2V0ICYgNykgewotCQkJCSpi
YXRjaCsrID0gTUlfU1RPUkVfRFdPUkRfSU1NX0dFTjQ7Ci0JCQkJKmJhdGNoKysgPSBsb3dlcl8z
Ml9iaXRzKGFkZHIpOwotCQkJCSpiYXRjaCsrID0gdXBwZXJfMzJfYml0cyhhZGRyKTsKLQkJCQkq
YmF0Y2grKyA9IGxvd2VyXzMyX2JpdHModGFyZ2V0X29mZnNldCk7Ci0KLQkJCQlhZGRyID0gZ2Vu
OF9jYW5vbmljYWxfYWRkcihhZGRyICsgNCk7Ci0KLQkJCQkqYmF0Y2grKyA9IE1JX1NUT1JFX0RX
T1JEX0lNTV9HRU40OwotCQkJCSpiYXRjaCsrID0gbG93ZXJfMzJfYml0cyhhZGRyKTsKLQkJCQkq
YmF0Y2grKyA9IHVwcGVyXzMyX2JpdHMoYWRkcik7Ci0JCQkJKmJhdGNoKysgPSB1cHBlcl8zMl9i
aXRzKHRhcmdldF9vZmZzZXQpOwotCQkJfSBlbHNlIHsKLQkJCQkqYmF0Y2grKyA9IChNSV9TVE9S
RV9EV09SRF9JTU1fR0VONCB8ICgxIDw8IDIxKSkgKyAxOwotCQkJCSpiYXRjaCsrID0gbG93ZXJf
MzJfYml0cyhhZGRyKTsKLQkJCQkqYmF0Y2grKyA9IHVwcGVyXzMyX2JpdHMoYWRkcik7Ci0JCQkJ
KmJhdGNoKysgPSBsb3dlcl8zMl9iaXRzKHRhcmdldF9vZmZzZXQpOwotCQkJCSpiYXRjaCsrID0g
dXBwZXJfMzJfYml0cyh0YXJnZXRfb2Zmc2V0KTsKLQkJCX0KLQkJfSBlbHNlIGlmIChnZW4gPj0g
NikgewogCQkJKmJhdGNoKysgPSBNSV9TVE9SRV9EV09SRF9JTU1fR0VONDsKLQkJCSpiYXRjaCsr
ID0gMDsKLQkJCSpiYXRjaCsrID0gYWRkcjsKLQkJCSpiYXRjaCsrID0gdGFyZ2V0X29mZnNldDsK
LQkJfSBlbHNlIGlmIChnZW4gPj0gNCkgewotCQkJKmJhdGNoKysgPSBNSV9TVE9SRV9EV09SRF9J
TU1fR0VONCB8IE1JX1VTRV9HR1RUOwotCQkJKmJhdGNoKysgPSAwOwotCQkJKmJhdGNoKysgPSBh
ZGRyOwotCQkJKmJhdGNoKysgPSB0YXJnZXRfb2Zmc2V0OworCQkJKmJhdGNoKysgPSBsb3dlcl8z
Ml9iaXRzKGFkZHIpOworCQkJKmJhdGNoKysgPSB1cHBlcl8zMl9iaXRzKGFkZHIpOworCQkJKmJh
dGNoKysgPSB1cHBlcl8zMl9iaXRzKHRhcmdldF9hZGRyKTsKIAkJfSBlbHNlIHsKLQkJCSpiYXRj
aCsrID0gTUlfU1RPUkVfRFdPUkRfSU1NIHwgTUlfTUVNX1ZJUlRVQUw7Ci0JCQkqYmF0Y2grKyA9
IGFkZHI7Ci0JCQkqYmF0Y2grKyA9IHRhcmdldF9vZmZzZXQ7CisJCQkqYmF0Y2grKyA9IChNSV9T
VE9SRV9EV09SRF9JTU1fR0VONCB8ICgxIDw8IDIxKSkgKyAxOworCQkJKmJhdGNoKysgPSBsb3dl
cl8zMl9iaXRzKGFkZHIpOworCQkJKmJhdGNoKysgPSB1cHBlcl8zMl9iaXRzKGFkZHIpOworCQkJ
KmJhdGNoKysgPSBsb3dlcl8zMl9iaXRzKHRhcmdldF9hZGRyKTsKKwkJCSpiYXRjaCsrID0gdXBw
ZXJfMzJfYml0cyh0YXJnZXRfYWRkcik7CiAJCX0KLQotCQlnb3RvIG91dDsKKwl9IGVsc2UgaWYg
KGdlbiA+PSA2KSB7CisJCSpiYXRjaCsrID0gTUlfU1RPUkVfRFdPUkRfSU1NX0dFTjQ7CisJCSpi
YXRjaCsrID0gMDsKKwkJKmJhdGNoKysgPSBhZGRyOworCQkqYmF0Y2grKyA9IHRhcmdldF9hZGRy
OworCX0gZWxzZSBpZiAoSVNfSTk2NUcoZWItPmk5MTUpKSB7CisJCSpiYXRjaCsrID0gTUlfU1RP
UkVfRFdPUkRfSU1NX0dFTjQ7CisJCSpiYXRjaCsrID0gMDsKKwkJKmJhdGNoKysgPSB2bWFfcGh5
c19hZGRyKHZtYSwgb2Zmc2V0KTsKKwkJKmJhdGNoKysgPSB0YXJnZXRfYWRkcjsKKwl9IGVsc2Ug
aWYgKGdlbiA+PSA0KSB7CisJCSpiYXRjaCsrID0gTUlfU1RPUkVfRFdPUkRfSU1NX0dFTjQgfCBN
SV9VU0VfR0dUVDsKKwkJKmJhdGNoKysgPSAwOworCQkqYmF0Y2grKyA9IGFkZHI7CisJCSpiYXRj
aCsrID0gdGFyZ2V0X2FkZHI7CisJfSBlbHNlIGlmIChnZW4gPj0gMyAmJgorCQkgICAhKElTX0k5
MTVHKGViLT5pOTE1KSB8fCBJU19JOTE1R00oZWItPmk5MTUpKSkgeworCQkqYmF0Y2grKyA9IE1J
X1NUT1JFX0RXT1JEX0lNTSB8IE1JX01FTV9WSVJUVUFMOworCQkqYmF0Y2grKyA9IGFkZHI7CisJ
CSpiYXRjaCsrID0gdGFyZ2V0X2FkZHI7CisJfSBlbHNlIHsKKwkJKmJhdGNoKysgPSBNSV9TVE9S
RV9EV09SRF9JTU07CisJCSpiYXRjaCsrID0gdm1hX3BoeXNfYWRkcih2bWEsIG9mZnNldCk7CisJ
CSpiYXRjaCsrID0gdGFyZ2V0X2FkZHI7CiAJfQogCisJcmV0dXJuIHRydWU7Cit9CisKK3N0YXRp
YyBib29sIHJlbG9jX2VudHJ5X2dwdShzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYiwKKwkJCSAg
ICBzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKKwkJCSAgICB1NjQgb2Zmc2V0LAorCQkJICAgIHU2NCB0
YXJnZXRfYWRkcikKK3sKKwlpZiAoZWItPnJlbG9jX2NhY2hlLnZhZGRyKQorCQlyZXR1cm4gZmFs
c2U7CisKKwlpZiAoIXVzZV9yZWxvY19ncHUodm1hKSkKKwkJcmV0dXJuIGZhbHNlOworCisJcmV0
dXJuIF9fcmVsb2NfZW50cnlfZ3B1KGViLCB2bWEsIG9mZnNldCwgdGFyZ2V0X2FkZHIpOworfQor
CitzdGF0aWMgdTY0CityZWxvY2F0ZV9lbnRyeShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKKwkgICAg
ICAgY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9yZWxvY2F0aW9uX2VudHJ5ICpyZWxvYywKKwkg
ICAgICAgc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsCisJICAgICAgIGNvbnN0IHN0cnVjdCBp
OTE1X3ZtYSAqdGFyZ2V0KQoreworCXU2NCB0YXJnZXRfYWRkciA9IHJlbG9jYXRpb25fdGFyZ2V0
KHJlbG9jLCB0YXJnZXQpOworCXU2NCBvZmZzZXQgPSByZWxvYy0+b2Zmc2V0OworCisJaWYgKCFy
ZWxvY19lbnRyeV9ncHUoZWIsIHZtYSwgb2Zmc2V0LCB0YXJnZXRfYWRkcikpIHsKKwkJYm9vbCB3
aWRlID0gZWItPnJlbG9jX2NhY2hlLnVzZV82NGJpdF9yZWxvYzsKKwkJdm9pZCAqdmFkZHI7CisK
IHJlcGVhdDoKLQl2YWRkciA9IHJlbG9jX3ZhZGRyKHZtYS0+b2JqLCAmZWItPnJlbG9jX2NhY2hl
LCBvZmZzZXQgPj4gUEFHRV9TSElGVCk7Ci0JaWYgKElTX0VSUih2YWRkcikpCi0JCXJldHVybiBQ
VFJfRVJSKHZhZGRyKTsKKwkJdmFkZHIgPSByZWxvY192YWRkcih2bWEtPm9iaiwKKwkJCQkgICAg
JmViLT5yZWxvY19jYWNoZSwKKwkJCQkgICAgb2Zmc2V0ID4+IFBBR0VfU0hJRlQpOworCQlpZiAo
SVNfRVJSKHZhZGRyKSkKKwkJCXJldHVybiBQVFJfRVJSKHZhZGRyKTsKIAotCWNsZmx1c2hfd3Jp
dGUzMih2YWRkciArIG9mZnNldF9pbl9wYWdlKG9mZnNldCksCi0JCQlsb3dlcl8zMl9iaXRzKHRh
cmdldF9vZmZzZXQpLAotCQkJZWItPnJlbG9jX2NhY2hlLnZhZGRyKTsKKwkJR0VNX0JVR19PTigh
SVNfQUxJR05FRChvZmZzZXQsIHNpemVvZih1MzIpKSk7CisJCWNsZmx1c2hfd3JpdGUzMih2YWRk
ciArIG9mZnNldF9pbl9wYWdlKG9mZnNldCksCisJCQkJbG93ZXJfMzJfYml0cyh0YXJnZXRfYWRk
ciksCisJCQkJZWItPnJlbG9jX2NhY2hlLnZhZGRyKTsKIAotCWlmICh3aWRlKSB7Ci0JCW9mZnNl
dCArPSBzaXplb2YodTMyKTsKLQkJdGFyZ2V0X29mZnNldCA+Pj0gMzI7Ci0JCXdpZGUgPSBmYWxz
ZTsKLQkJZ290byByZXBlYXQ7CisJCWlmICh3aWRlKSB7CisJCQlvZmZzZXQgKz0gc2l6ZW9mKHUz
Mik7CisJCQl0YXJnZXRfYWRkciA+Pj0gMzI7CisJCQl3aWRlID0gZmFsc2U7CisJCQlnb3RvIHJl
cGVhdDsKKwkJfQogCX0KIAotb3V0OgogCXJldHVybiB0YXJnZXQtPm5vZGUuc3RhcnQgfCBVUERB
VEU7CiB9CiAKQEAgLTMwMjIsMyArMzA3NCw3IEBAIGVuZDo7CiAJa3ZmcmVlKGV4ZWMyX2xpc3Qp
OwogCXJldHVybiBlcnI7CiB9CisKKyNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9TRUxG
VEVTVCkKKyNpbmNsdWRlICJzZWxmdGVzdHMvaTkxNV9nZW1fZXhlY2J1ZmZlci5jIgorI2VuZGlm
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2Vt
X2NsaWVudF9ibHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9n
ZW1fY2xpZW50X2JsdC5jCmluZGV4IGJlMjY4NTExY2I2ZC4uOGZlM2FkMmVlMzRlIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NsaWVudF9i
bHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2Ns
aWVudF9ibHQuYwpAQCAtMzAyLDM1ICszMDIsNiBAQCBzdGF0aWMgdm9pZCBmaWxsX3NjcmF0Y2go
c3RydWN0IHRpbGVkX2JsaXRzICp0LCB1MzIgKnZhZGRyLCB1MzIgdmFsKQogCWk5MTVfZ2VtX29i
amVjdF9mbHVzaF9tYXAodC0+c2NyYXRjaC52bWEtPm9iaik7CiB9CiAKLXN0YXRpYyB2b2lkIGhl
eGR1bXAoY29uc3Qgdm9pZCAqYnVmLCBzaXplX3QgbGVuKQotewotCWNvbnN0IHNpemVfdCByb3dz
aXplID0gOCAqIHNpemVvZih1MzIpOwotCWNvbnN0IHZvaWQgKnByZXYgPSBOVUxMOwotCWJvb2wg
c2tpcCA9IGZhbHNlOwotCXNpemVfdCBwb3M7Ci0KLQlmb3IgKHBvcyA9IDA7IHBvcyA8IGxlbjsg
cG9zICs9IHJvd3NpemUpIHsKLQkJY2hhciBsaW5lWzEyOF07Ci0KLQkJaWYgKHByZXYgJiYgIW1l
bWNtcChwcmV2LCBidWYgKyBwb3MsIHJvd3NpemUpKSB7Ci0JCQlpZiAoIXNraXApIHsKLQkJCQlw
cl9pbmZvKCIqXG4iKTsKLQkJCQlza2lwID0gdHJ1ZTsKLQkJCX0KLQkJCWNvbnRpbnVlOwotCQl9
Ci0KLQkJV0FSTl9PTl9PTkNFKGhleF9kdW1wX3RvX2J1ZmZlcihidWYgKyBwb3MsIGxlbiAtIHBv
cywKLQkJCQkJCXJvd3NpemUsIHNpemVvZih1MzIpLAotCQkJCQkJbGluZSwgc2l6ZW9mKGxpbmUp
LAotCQkJCQkJZmFsc2UpID49IHNpemVvZihsaW5lKSk7Ci0JCXByX2luZm8oIlslMDR6eF0gJXNc
biIsIHBvcywgbGluZSk7Ci0KLQkJcHJldiA9IGJ1ZiArIHBvczsKLQkJc2tpcCA9IGZhbHNlOwot
CX0KLX0KLQogc3RhdGljIHU2NCBzd2l6emxlX2JpdCh1bnNpZ25lZCBpbnQgYml0LCB1NjQgb2Zm
c2V0KQogewogCXJldHVybiAob2Zmc2V0ICYgQklUX1VMTChiaXQpKSA+PiAoYml0IC0gNik7CkBA
IC00MjYsNyArMzk3LDcgQEAgc3RhdGljIGludCB2ZXJpZnlfYnVmZmVyKGNvbnN0IHN0cnVjdCB0
aWxlZF9ibGl0cyAqdCwKIAkJcHJfZXJyKCJJbnZhbGlkICVzIHRpbGluZyBkZXRlY3RlZCBhdCAo
JWQsICVkKSwgc3RhcnRfdmFsICV4XG4iLAogCQkgICAgICAgcmVwcl90aWxpbmcoYnVmLT50aWxp
bmcpLAogCQkgICAgICAgeCwgeSwgYnVmLT5zdGFydF92YWwpOwotCQloZXhkdW1wKHZhZGRyLCA0
MDk2KTsKKwkJaWd0X2hleGR1bXAodmFkZHIsIDQwOTYpOwogCX0KIAogCWk5MTVfZ2VtX29iamVj
dF91bnBpbl9tYXAoYnVmLT52bWEtPm9iaik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fZXhlY2J1ZmZlci5jCm5ldyBmaWxlIG1vZGUg
MTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uYTQ5MDE2ZjhlZTBkCi0tLSAvZGV2L251bGwKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9leGVjYnVmZmVy
LmMKQEAgLTAsMCArMSwxNzEgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKKy8q
CisgKiBDb3B5cmlnaHQgwqkgMjAyMCBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpbmNsdWRl
ICJpOTE1X3NlbGZ0ZXN0LmgiCisKKyNpbmNsdWRlICJndC9pbnRlbF9lbmdpbmVfcG0uaCIKKyNp
bmNsdWRlICJzZWxmdGVzdHMvaWd0X2ZsdXNoX3Rlc3QuaCIKKworc3RhdGljIHU2NCByZWFkX3Jl
bG9jKGNvbnN0IHUzMiAqbWFwLCBpbnQgeCwgY29uc3QgdTY0IG1hc2spCit7CisJdTY0IHJlbG9j
OworCisJbWVtY3B5KCZyZWxvYywgJm1hcFt4XSwgc2l6ZW9mKHJlbG9jKSk7CisJcmV0dXJuIHJl
bG9jICYgbWFzazsKK30KKworc3RhdGljIGludCBfX2lndF9ncHVfcmVsb2Moc3RydWN0IGk5MTVf
ZXhlY2J1ZmZlciAqZWIsCisJCQkgICBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQor
eworCWNvbnN0IHVuc2lnbmVkIGludCBvZmZzZXRzW10gPSB7IDgsIDMsIDAgfTsKKwljb25zdCB1
NjQgbWFzayA9CisJCUdFTk1BU0tfVUxMKGViLT5yZWxvY19jYWNoZS51c2VfNjRiaXRfcmVsb2Mg
PyA2MyA6IDMxLCAwKTsKKwljb25zdCB1MzIgKm1hcCA9IHBhZ2VfbWFza19iaXRzKG9iai0+bW0u
bWFwcGluZyk7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJc3RydWN0IGk5MTVfdm1hICp2
bWE7CisJaW50IGVycjsKKwlpbnQgaTsKKworCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwg
ZWItPmNvbnRleHQtPnZtLCBOVUxMKTsKKwlpZiAoSVNfRVJSKHZtYSkpCisJCXJldHVybiBQVFJf
RVJSKHZtYSk7CisKKwllcnIgPSBpOTE1X3ZtYV9waW4odm1hLCAwLCAwLCBQSU5fVVNFUiB8IFBJ
Tl9ISUdIKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJLyogOC1CeXRlIGFsaWduZWQg
Ki8KKwlpZiAoIV9fcmVsb2NfZW50cnlfZ3B1KGViLCB2bWEsCisJCQkgICAgICAgb2Zmc2V0c1sw
XSAqIHNpemVvZih1MzIpLAorCQkJICAgICAgIDApKSB7CisJCWVyciA9IC1FSU87CisJCWdvdG8g
dW5waW5fdm1hOworCX0KKworCS8qICE4LUJ5dGUgYWxpZ25lZCAqLworCWlmICghX19yZWxvY19l
bnRyeV9ncHUoZWIsIHZtYSwKKwkJCSAgICAgICBvZmZzZXRzWzFdICogc2l6ZW9mKHUzMiksCisJ
CQkgICAgICAgMSkpIHsKKwkJZXJyID0gLUVJTzsKKwkJZ290byB1bnBpbl92bWE7CisJfQorCisJ
LyogU2tpcCB0byB0aGUgZW5kIG9mIHRoZSBjbWQgcGFnZSAqLworCWkgPSBQQUdFX1NJWkUgLyBz
aXplb2YodTMyKSAtIFJFTE9DX1RBSUwgLSAxOworCWkgLT0gZWItPnJlbG9jX2NhY2hlLnJxX3Np
emU7CisJbWVtc2V0MzIoZWItPnJlbG9jX2NhY2hlLnJxX2NtZCArIGViLT5yZWxvY19jYWNoZS5y
cV9zaXplLAorCQkgTUlfTk9PUCwgaSk7CisJZWItPnJlbG9jX2NhY2hlLnJxX3NpemUgKz0gaTsK
KworCS8qIEZvcmNlIGJhdGNoIGNoYWluaW5nICovCisJaWYgKCFfX3JlbG9jX2VudHJ5X2dwdShl
Yiwgdm1hLAorCQkJICAgICAgIG9mZnNldHNbMl0gKiBzaXplb2YodTMyKSwKKwkJCSAgICAgICAy
KSkgeworCQllcnIgPSAtRUlPOworCQlnb3RvIHVucGluX3ZtYTsKKwl9CisKKwlHRU1fQlVHX09O
KCFlYi0+cmVsb2NfY2FjaGUucnEpOworCXJxID0gaTkxNV9yZXF1ZXN0X2dldChlYi0+cmVsb2Nf
Y2FjaGUucnEpOworCWVyciA9IHJlbG9jX2dwdV9mbHVzaCgmZWItPnJlbG9jX2NhY2hlKTsKKwlp
ZiAoZXJyKQorCQlnb3RvIHB1dF9ycTsKKwlHRU1fQlVHX09OKGViLT5yZWxvY19jYWNoZS5ycSk7
CisKKwllcnIgPSBpOTE1X2dlbV9vYmplY3Rfd2FpdChvYmosIEk5MTVfV0FJVF9JTlRFUlJVUFRJ
QkxFLCBIWiAvIDIpOworCWlmIChlcnIpIHsKKwkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChlYi0+ZW5n
aW5lLT5ndCk7CisJCWdvdG8gcHV0X3JxOworCX0KKworCWlmICghaTkxNV9yZXF1ZXN0X2NvbXBs
ZXRlZChycSkpIHsKKwkJcHJfZXJyKCIlczogZGlkIG5vdCB3YWl0IGZvciByZWxvY2F0aW9ucyFc
biIsIGViLT5lbmdpbmUtPm5hbWUpOworCQllcnIgPSAtRUlOVkFMOworCQlnb3RvIHB1dF9ycTsK
Kwl9CisKKwlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShvZmZzZXRzKTsgaSsrKSB7CisJCXU2
NCByZWxvYyA9IHJlYWRfcmVsb2MobWFwLCBvZmZzZXRzW2ldLCBtYXNrKTsKKworCQlpZiAocmVs
b2MgIT0gaSkgeworCQkJcHJfZXJyKCIlc1slZF06IG1hcFslZF0gJWxseCAhPSAleFxuIiwKKwkJ
CSAgICAgICBlYi0+ZW5naW5lLT5uYW1lLCBpLCBvZmZzZXRzW2ldLCByZWxvYywgaSk7CisJCQll
cnIgPSAtRUlOVkFMOworCQl9CisJfQorCWlmIChlcnIpCisJCWlndF9oZXhkdW1wKG1hcCwgNDA5
Nik7CisKK3B1dF9ycToKKwlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKK3VucGluX3ZtYToKKwlpOTE1
X3ZtYV91bnBpbih2bWEpOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQgaWd0X2dwdV9y
ZWxvYyh2b2lkICphcmcpCit7CisJc3RydWN0IGk5MTVfZXhlY2J1ZmZlciBlYjsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqc2NyYXRjaDsKKwlpbnQgZXJyID0gMDsKKwl1MzIgKm1hcDsK
KworCWViLmk5MTUgPSBhcmc7CisKKwlzY3JhdGNoID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9p
bnRlcm5hbChlYi5pOTE1LCA0MDk2KTsKKwlpZiAoSVNfRVJSKHNjcmF0Y2gpKQorCQlyZXR1cm4g
UFRSX0VSUihzY3JhdGNoKTsKKworCW1hcCA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKHNjcmF0
Y2gsIEk5MTVfTUFQX1dDKTsKKwlpZiAoSVNfRVJSKG1hcCkpIHsKKwkJZXJyID0gUFRSX0VSUiht
YXApOworCQlnb3RvIGVycl9zY3JhdGNoOworCX0KKworCWZvcl9lYWNoX3VhYmlfZW5naW5lKGVi
LmVuZ2luZSwgZWIuaTkxNSkgeworCQlyZWxvY19jYWNoZV9pbml0KCZlYi5yZWxvY19jYWNoZSwg
ZWIuaTkxNSk7CisJCW1lbXNldChtYXAsIFBPSVNPTl9JTlVTRSwgNDA5Nik7CisKKwkJaW50ZWxf
ZW5naW5lX3BtX2dldChlYi5lbmdpbmUpOworCQllYi5jb250ZXh0ID0gaW50ZWxfY29udGV4dF9j
cmVhdGUoZWIuZW5naW5lKTsKKwkJaWYgKElTX0VSUihlYi5jb250ZXh0KSkgeworCQkJZXJyID0g
UFRSX0VSUihlYi5jb250ZXh0KTsKKwkJCWdvdG8gZXJyX3BtOworCQl9CisKKwkJZXJyID0gaW50
ZWxfY29udGV4dF9waW4oZWIuY29udGV4dCk7CisJCWlmIChlcnIpCisJCQlnb3RvIGVycl9wdXQ7
CisKKwkJZXJyID0gX19pZ3RfZ3B1X3JlbG9jKCZlYiwgc2NyYXRjaCk7CisKKwkJaW50ZWxfY29u
dGV4dF91bnBpbihlYi5jb250ZXh0KTsKK2Vycl9wdXQ6CisJCWludGVsX2NvbnRleHRfcHV0KGVi
LmNvbnRleHQpOworZXJyX3BtOgorCQlpbnRlbF9lbmdpbmVfcG1fcHV0KGViLmVuZ2luZSk7CisJ
CWlmIChlcnIpCisJCQlicmVhazsKKwl9CisKKwlpZiAoaWd0X2ZsdXNoX3Rlc3QoZWIuaTkxNSkp
CisJCWVyciA9IC1FSU87CisKK2Vycl9zY3JhdGNoOgorCWk5MTVfZ2VtX29iamVjdF9wdXQoc2Ny
YXRjaCk7CisJcmV0dXJuIGVycjsKK30KKworaW50IGk5MTVfZ2VtX2V4ZWNidWZmZXJfbGl2ZV9z
ZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCit7CisJc3RhdGljIGNvbnN0
IHN0cnVjdCBpOTE1X3N1YnRlc3QgdGVzdHNbXSA9IHsKKwkJU1VCVEVTVChpZ3RfZ3B1X3JlbG9j
KSwKKwl9OworCisJaWYgKGludGVsX2d0X2lzX3dlZGdlZCgmaTkxNS0+Z3QpKQorCQlyZXR1cm4g
MDsKKworCXJldHVybiBpOTE1X2xpdmVfc3VidGVzdHModGVzdHMsIGk5MTUpOworfQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwppbmRleCA3NTI5ZGY5MmY2YTIuLjNjZWQ3MzUz
M2Y2YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKQEAgLTQzNDIsMzUg
KzQzNDIsNiBAQCBpbnQgaW50ZWxfZXhlY2xpc3RzX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1KQogCXJldHVybiBpbnRlbF9ndF9saXZlX3N1YnRlc3RzKHRlc3Rz
LCAmaTkxNS0+Z3QpOwogfQogCi1zdGF0aWMgdm9pZCBoZXhkdW1wKGNvbnN0IHZvaWQgKmJ1Ziwg
c2l6ZV90IGxlbikKLXsKLQljb25zdCBzaXplX3Qgcm93c2l6ZSA9IDggKiBzaXplb2YodTMyKTsK
LQljb25zdCB2b2lkICpwcmV2ID0gTlVMTDsKLQlib29sIHNraXAgPSBmYWxzZTsKLQlzaXplX3Qg
cG9zOwotCi0JZm9yIChwb3MgPSAwOyBwb3MgPCBsZW47IHBvcyArPSByb3dzaXplKSB7Ci0JCWNo
YXIgbGluZVsxMjhdOwotCi0JCWlmIChwcmV2ICYmICFtZW1jbXAocHJldiwgYnVmICsgcG9zLCBy
b3dzaXplKSkgewotCQkJaWYgKCFza2lwKSB7Ci0JCQkJcHJfaW5mbygiKlxuIik7Ci0JCQkJc2tp
cCA9IHRydWU7Ci0JCQl9Ci0JCQljb250aW51ZTsKLQkJfQotCi0JCVdBUk5fT05fT05DRShoZXhf
ZHVtcF90b19idWZmZXIoYnVmICsgcG9zLCBsZW4gLSBwb3MsCi0JCQkJCQlyb3dzaXplLCBzaXpl
b2YodTMyKSwKLQkJCQkJCWxpbmUsIHNpemVvZihsaW5lKSwKLQkJCQkJCWZhbHNlKSA+PSBzaXpl
b2YobGluZSkpOwotCQlwcl9pbmZvKCJbJTA0enhdICVzXG4iLCBwb3MsIGxpbmUpOwotCi0JCXBy
ZXYgPSBidWYgKyBwb3M7Ci0JCXNraXAgPSBmYWxzZTsKLQl9Ci19Ci0KIHN0YXRpYyBpbnQgZW1p
dF9zZW1hcGhvcmVfc2lnbmFsKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgdm9pZCAqc2xvdCkK
IHsKIAljb25zdCB1MzIgb2Zmc2V0ID0KQEAgLTQ1MTgsMTAgKzQ0ODksMTAgQEAgc3RhdGljIGlu
dCBsaXZlX2xyY19sYXlvdXQodm9pZCAqYXJnKQogCiAJCWlmIChlcnIpIHsKIAkJCXByX2luZm8o
IiVzOiBIVyByZWdpc3RlciBpbWFnZTpcbiIsIGVuZ2luZS0+bmFtZSk7Ci0JCQloZXhkdW1wKGh3
LCBQQUdFX1NJWkUpOworCQkJaWd0X2hleGR1bXAoaHcsIFBBR0VfU0laRSk7CiAKIAkJCXByX2lu
Zm8oIiVzOiBTVyByZWdpc3RlciBpbWFnZTpcbiIsIGVuZ2luZS0+bmFtZSk7Ci0JCQloZXhkdW1w
KGxyYywgUEFHRV9TSVpFKTsKKwkJCWlndF9oZXhkdW1wKGxyYywgUEFHRV9TSVpFKTsKIAkJfQog
CiAJCXNobWVtX3VucGluX21hcChlbmdpbmUtPmRlZmF1bHRfc3RhdGUsIGh3KTsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2VsZnRlc3QuaCBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfc2VsZnRlc3QuaAppbmRleCA5OGJjYjZmYTBhYjQuLmQ1M2QyMDdhYjZlYiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zZWxmdGVzdC5oCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2VsZnRlc3QuaApAQCAtMTMzLDQgKzEzMyw2IEBAIGJv
b2wgX19pZ3RfdGltZW91dCh1bnNpZ25lZCBsb25nIHRpbWVvdXQsIGNvbnN0IGNoYXIgKmZtdCwg
Li4uKTsKICNkZWZpbmUgaWd0X3RpbWVvdXQodCwgZm10LCAuLi4pIFwKIAlfX2lndF90aW1lb3V0
KCh0KSwgS0VSTl9ERUJVRyBwcl9mbXQoZm10KSwgIyNfX1ZBX0FSR1NfXykKIAordm9pZCBpZ3Rf
aGV4ZHVtcChjb25zdCB2b2lkICpidWYsIHNpemVfdCBsZW4pOworCiAjZW5kaWYgLyogIV9fSTkx
NV9TRUxGVEVTVF9IX18gKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9pOTE1X2xpdmVfc2VsZnRlc3RzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaTkxNV9saXZlX3NlbGZ0ZXN0cy5oCmluZGV4IDBhOTUzYmZjMDU4NS4uNWRkNWQ4MTY0NmM0
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9saXZlX3Nl
bGZ0ZXN0cy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2xpdmVf
c2VsZnRlc3RzLmgKQEAgLTM3LDYgKzM3LDcgQEAgc2VsZnRlc3QoZ2VtLCBpOTE1X2dlbV9saXZl
X3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KGV2aWN0LCBpOTE1X2dlbV9ldmljdF9saXZlX3NlbGZ0ZXN0
cykKIHNlbGZ0ZXN0KGh1Z2VwYWdlcywgaTkxNV9nZW1faHVnZV9wYWdlX2xpdmVfc2VsZnRlc3Rz
KQogc2VsZnRlc3QoZ2VtX2NvbnRleHRzLCBpOTE1X2dlbV9jb250ZXh0X2xpdmVfc2VsZnRlc3Rz
KQorc2VsZnRlc3QoZ2VtX2V4ZWNidWYsIGk5MTVfZ2VtX2V4ZWNidWZmZXJfbGl2ZV9zZWxmdGVz
dHMpCiBzZWxmdGVzdChibHQsIGk5MTVfZ2VtX29iamVjdF9ibHRfbGl2ZV9zZWxmdGVzdHMpCiBz
ZWxmdGVzdChjbGllbnQsIGk5MTVfZ2VtX2NsaWVudF9ibHRfbGl2ZV9zZWxmdGVzdHMpCiBzZWxm
dGVzdChyZXNldCwgaW50ZWxfcmVzZXRfbGl2ZV9zZWxmdGVzdHMpCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9zZWxmdGVzdC5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfc2VsZnRlc3QuYwppbmRleCBkM2JmOWVlZmI2ODIuLjFi
YzExYzA5ZmFlZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5
MTVfc2VsZnRlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9z
ZWxmdGVzdC5jCkBAIC0zOTYsNiArMzk2LDM1IEBAIGJvb2wgX19pZ3RfdGltZW91dCh1bnNpZ25l
ZCBsb25nIHRpbWVvdXQsIGNvbnN0IGNoYXIgKmZtdCwgLi4uKQogCXJldHVybiB0cnVlOwogfQog
Cit2b2lkIGlndF9oZXhkdW1wKGNvbnN0IHZvaWQgKmJ1Ziwgc2l6ZV90IGxlbikKK3sKKwljb25z
dCBzaXplX3Qgcm93c2l6ZSA9IDggKiBzaXplb2YodTMyKTsKKwljb25zdCB2b2lkICpwcmV2ID0g
TlVMTDsKKwlib29sIHNraXAgPSBmYWxzZTsKKwlzaXplX3QgcG9zOworCisJZm9yIChwb3MgPSAw
OyBwb3MgPCBsZW47IHBvcyArPSByb3dzaXplKSB7CisJCWNoYXIgbGluZVsxMjhdOworCisJCWlm
IChwcmV2ICYmICFtZW1jbXAocHJldiwgYnVmICsgcG9zLCByb3dzaXplKSkgeworCQkJaWYgKCFz
a2lwKSB7CisJCQkJcHJfaW5mbygiKlxuIik7CisJCQkJc2tpcCA9IHRydWU7CisJCQl9CisJCQlj
b250aW51ZTsKKwkJfQorCisJCVdBUk5fT05fT05DRShoZXhfZHVtcF90b19idWZmZXIoYnVmICsg
cG9zLCBsZW4gLSBwb3MsCisJCQkJCQlyb3dzaXplLCBzaXplb2YodTMyKSwKKwkJCQkJCWxpbmUs
IHNpemVvZihsaW5lKSwKKwkJCQkJCWZhbHNlKSA+PSBzaXplb2YobGluZSkpOworCQlwcl9pbmZv
KCJbJTA0enhdICVzXG4iLCBwb3MsIGxpbmUpOworCisJCXByZXYgPSBidWYgKyBwb3M7CisJCXNr
aXAgPSBmYWxzZTsKKwl9Cit9CisKIG1vZHVsZV9wYXJhbV9uYW1lZChzdF9yYW5kb21fc2VlZCwg
aTkxNV9zZWxmdGVzdC5yYW5kb21fc2VlZCwgdWludCwgMDQwMCk7CiBtb2R1bGVfcGFyYW1fbmFt
ZWQoc3RfdGltZW91dCwgaTkxNV9zZWxmdGVzdC50aW1lb3V0X21zLCB1aW50LCAwNDAwKTsKIG1v
ZHVsZV9wYXJhbV9uYW1lZChzdF9maWx0ZXIsIGk5MTVfc2VsZnRlc3QuZmlsdGVyLCBjaGFycCwg
MDQwMCk7Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2lu
dGVsLWdmeAo=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 6CEE6CAF30
	for <lists+intel-gfx@lfdr.de>; Thu,  3 Oct 2019 21:25:22 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9F5F86EA60;
	Thu,  3 Oct 2019 19:25:20 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga17.intel.com (mga17.intel.com [192.55.52.151])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 20A096EA65
 for <intel-gfx@lists.freedesktop.org>; Thu,  3 Oct 2019 19:25:19 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga008.fm.intel.com ([10.253.24.58])
 by fmsmga107.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 03 Oct 2019 12:25:18 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.67,253,1566889200"; d="scan'208";a="191358485"
Received: from bkokkula-mobl1.ger.corp.intel.com (HELO
 mwahaha-bdw.ger.corp.intel.com) ([10.252.7.77])
 by fmsmga008.fm.intel.com with ESMTP; 03 Oct 2019 12:25:18 -0700
From: Matthew Auld <matthew.auld@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  3 Oct 2019 20:24:42 +0100
Message-Id: <20191003192444.10113-21-matthew.auld@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20191003192444.10113-1-matthew.auld@intel.com>
References: <20191003192444.10113-1-matthew.auld@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 20/22] drm/i915/selftests: fallback to using
 the gpu to trash stolen
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SWYgd2UgbGFjayBhIG1hcHBhYmxlIGFwZXJ0dXJlLCBvcHQgZm9yIG51a2luZyBzdG9sZW4gbWVt
b3J5IHdpdGggdGhlCmJsaXR0ZXIgZW5naW5lLgoKU2lnbmVkLW9mZi1ieTogTWF0dGhldyBBdWxk
IDxtYXR0aGV3LmF1bGRAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9pOTE1X2dlbS5jIHwgOTUgKysrKysrKysrKysrKysrKysrKy0tLS0KIDEgZmlsZSBjaGFu
Z2VkLCA4MCBpbnNlcnRpb25zKCspLCAxNSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbS5jCmluZGV4IDM3NTkzODMxYjUzOS4uYzRkNzU5OWFmNGY3
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW0uYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW0uYwpAQCAtNiw2ICs2
LDggQEAKIAogI2luY2x1ZGUgPGxpbnV4L3JhbmRvbS5oPgogCisjaW5jbHVkZSAiZ2VtL2k5MTVf
Z2VtX3JlZ2lvbi5oIgorI2luY2x1ZGUgImdlbS9pOTE1X2dlbV9vYmplY3RfYmx0LmgiCiAjaW5j
bHVkZSAiZ2VtL3NlbGZ0ZXN0cy9pZ3RfZ2VtX3V0aWxzLmgiCiAjaW5jbHVkZSAiZ2VtL3NlbGZ0
ZXN0cy9tb2NrX2NvbnRleHQuaCIKICNpbmNsdWRlICJndC9pbnRlbF9ndC5oIgpAQCAtMzQsMTQg
KzM2LDI1IEBAIHN0YXRpYyBpbnQgc3dpdGNoX3RvX2NvbnRleHQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyB2b2lkIHRyYXNoX3N0b2xlbihz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3N0YXRpYyB2b2lkIHRyYXNoX3N0b2xlbl9j
cHUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RydWN0IGk5MTVfZ2d0dCAq
Z2d0dCA9ICZpOTE1LT5nZ3R0OwogCWNvbnN0IHU2NCBzbG90ID0gZ2d0dC0+ZXJyb3JfY2FwdHVy
ZS5zdGFydDsKIAljb25zdCByZXNvdXJjZV9zaXplX3Qgc2l6ZSA9IHJlc291cmNlX3NpemUoJmk5
MTUtPmRzbSk7CisJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJdW5zaWduZWQgbG9uZyBwYWdl
OwogCXUzMiBwcm5nID0gMHgxMjM0NTY3ODsKIAorCS8qCisJICogQXMgYSBmaW5hbCBzdGluZyBp
biB0aGUgdGFpbCwgaW52YWxpZGF0ZSBzdG9sZW4uIFVuZGVyIGEgcmVhbCBTNCwKKwkgKiBzdG9s
ZW4gaXMgbG9zdCBhbmQgbmVlZHMgdG8gYmUgcmVmaWxsZWQgb24gcmVzdW1lLiBIb3dldmVyLCB1
bmRlcgorCSAqIENJIHdlIG1lcmVseSBkbyBTNC1kZXZpY2UgdGVzdGluZyAoYXMgZnVsbCBTNCBp
cyB0b28gdW5yZWxpYWJsZQorCSAqIGZvciBhdXRvbWF0ZWQgdGVzdGluZyBhY3Jvc3MgYSBjbHVz
dGVyKSwgc28gdG8gc2ltdWxhdGUgdGhlIGVmZmVjdAorCSAqIG9mIHN0b2xlbiBiZWluZyB0cmFz
aGVkIGFjcm9zcyBTNCwgd2UgdHJhc2ggaXQgb3Vyc2VsdmVzLgorCSAqLworCisJd2FrZXJlZiA9
IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKKwogCWZvciAocGFnZSA9
IDA7IHBhZ2UgPCBzaXplOyBwYWdlICs9IFBBR0VfU0laRSkgewogCQljb25zdCBkbWFfYWRkcl90
IGRtYSA9IGk5MTUtPmRzbS5zdGFydCArIHBhZ2U7CiAJCXUzMiBfX2lvbWVtICpzOwpAQCAtNTgs
MjQgKzcxLDUzIEBAIHN0YXRpYyB2b2lkIHRyYXNoX3N0b2xlbihzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSkKIAl9CiAKIAlnZ3R0LT52bS5jbGVhcl9yYW5nZSgmZ2d0dC0+dm0sIHNsb3Qs
IFBBR0VfU0laRSk7CisKKwlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwg
d2FrZXJlZik7CiB9CiAKLXN0YXRpYyB2b2lkIHNpbXVsYXRlX2hpYmVybmF0ZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3N0YXRpYyBpbnQgdHJhc2hfc3RvbGVuX2dwdShzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqY3R4KQogewotCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gY3R4LT52bS0+aTkxNTsKKwljb25zdCByZXNv
dXJjZV9zaXplX3Qgc2l6ZSA9IHJlc291cmNlX3NpemUoJmk5MTUtPmRzbSk7CisJc3RydWN0IGlu
dGVsX21lbW9yeV9yZWdpb24gKmNsb25lOworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
Ymo7CisJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOworCXUzMiBwcm5nID0gMHgxMjM0NTY3ODsK
KwlpbnQgZXJyOwogCi0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50
aW1lX3BtKTsKKwlpZiAoIUhBU19FTkdJTkUoaTkxNSwgQkNTMCkpCisJCXJldHVybiAwOwogCi0J
LyoKLQkgKiBBcyBhIGZpbmFsIHN0aW5nIGluIHRoZSB0YWlsLCBpbnZhbGlkYXRlIHN0b2xlbi4g
VW5kZXIgYSByZWFsIFM0LAotCSAqIHN0b2xlbiBpcyBsb3N0IGFuZCBuZWVkcyB0byBiZSByZWZp
bGxlZCBvbiByZXN1bWUuIEhvd2V2ZXIsIHVuZGVyCi0JICogQ0kgd2UgbWVyZWx5IGRvIFM0LWRl
dmljZSB0ZXN0aW5nIChhcyBmdWxsIFM0IGlzIHRvbyB1bnJlbGlhYmxlCi0JICogZm9yIGF1dG9t
YXRlZCB0ZXN0aW5nIGFjcm9zcyBhIGNsdXN0ZXIpLCBzbyB0byBzaW11bGF0ZSB0aGUgZWZmZWN0
Ci0JICogb2Ygc3RvbGVuIGJlaW5nIHRyYXNoZWQgYWNyb3NzIFM0LCB3ZSB0cmFzaCBpdCBvdXJz
ZWx2ZXMuCi0JICovCi0JdHJhc2hfc3RvbGVuKGk5MTUpOworCWlmICghc2l6ZSkKKwkJcmV0dXJu
IDA7CiAKLQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7
CisJY2xvbmUgPSBtb2NrX3JlZ2lvbl9jcmVhdGUoaTkxNSwgaTkxNS0+ZHNtLnN0YXJ0LCBzaXpl
LCBQQUdFX1NJWkUsIDApOworCWlmIChJU19FUlIoY2xvbmUpKQorCQlyZXR1cm4gUFRSX0VSUihj
bG9uZSk7CisKKwlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3JlZ2lvbihjbG9uZSwgc2l6
ZSwgMCk7CisJaWYgKElTX0VSUihvYmopKSB7CisJCWVyciA9IFBUUl9FUlIob2JqKTsKKwkJZ290
byBvdXRfcmVnaW9uOworCX0KKworCWNlID0gaTkxNV9nZW1fY29udGV4dF9nZXRfZW5naW5lKGN0
eCwgQkNTMCk7CisJaWYgKElTX0VSUihjZSkpIHsKKwkJZXJyID0gUFRSX0VSUihjZSk7CisJCWdv
dG8gb3V0X3B1dDsKKwl9CisKKwltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
KwllcnIgPSBpOTE1X2dlbV9vYmplY3RfZmlsbF9ibHQob2JqLCBjZSwgcHJuZyk7CisJbXV0ZXhf
dW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKworCWludGVsX2NvbnRleHRfcHV0KGNl
KTsKK291dF9wdXQ6CisJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworb3V0X3JlZ2lvbjoKKwlp
bnRlbF9tZW1vcnlfcmVnaW9uX3B1dChjbG9uZSk7CisKKwlyZXR1cm4gZXJyOwogfQogCiBzdGF0
aWMgaW50IHBtX3ByZXBhcmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCkBAIC0xNDgs
NiArMTkwLDIxIEBAIHN0YXRpYyBpbnQgaWd0X2dlbV9zdXNwZW5kKHZvaWQgKmFyZykKIAlpZiAo
ZXJyKQogCQlnb3RvIG91dDsKIAorCS8qCisJICogSWYgd2UgbGFjayB0aGUgbWFwcGFibGUgYXBl
cnR1cmUgd2UgY2FuJ3QgcmVhbGx5IGFjY2VzcyBzdG9sZW4gZnJvbQorCSAqIHRoZSBjcHUsIGJ1
dCB3ZSBjYW4gYWx3YXlzIHRyYXNoIGl0IGZyb20gdGhlIGdwdSwgd2UganVzdCBuZWVkIHRvIGRv
CisJICogc28gZWFybHksIGJlZm9yZSB3ZSBzdGFydCBzdXNwZW5kaW5nIHN0dWZmLiBXZSBzaG91
bGRuJ3Qgc2VlIGFueQorCSAqIGhhbmdzIGRvaW5nIHRoaXMgc28gZWFybHksIHNpbmNlIHRoaW5n
cyBsaWtlIHJpbmcgc3RhdGUgd29uJ3QgYmUKKwkgKiBhbGxvY2F0ZWQgaW4gc3RvbGVuIGlmIHdl
IGNhbid0IGFjY2VzcyBpdCBmcm9tIHRoZSBjcHUuIEFsdGhvdWdoIGlmCisJICogdGhhdCdzIHRo
ZSBjYXNlIG1heWJlIHRoZXJlIGlzIG5vdCBtdWNoIHBvaW50IGluIGJvdGhlcmluZyB3aXRoIHRo
aXMKKwkgKiBhbnl3YXkuLi4KKwkgKi8KKwlpZiAoIUhBU19NQVBQQUJMRV9BUEVSVFVSRShpOTE1
KSkgeworCQllcnIgPSB0cmFzaF9zdG9sZW5fZ3B1KGN0eCk7CisJCWlmIChlcnIpCisJCQlnb3Rv
IG91dDsKKwl9CisKIAllcnIgPSBwbV9wcmVwYXJlKGk5MTUpOwogCWlmIChlcnIpCiAJCWdvdG8g
b3V0OwpAQCAtMTU1LDcgKzIxMiw4IEBAIHN0YXRpYyBpbnQgaWd0X2dlbV9zdXNwZW5kKHZvaWQg
KmFyZykKIAlwbV9zdXNwZW5kKGk5MTUpOwogCiAJLyogSGVyZSBiZSBkcmFnb25zISBOb3RlIHRo
YXQgd2l0aCBTM1JTVCBhbnkgUzMgbWF5IGJlY29tZSBTNCEgKi8KLQlzaW11bGF0ZV9oaWJlcm5h
dGUoaTkxNSk7CisJaWYgKEhBU19NQVBQQUJMRV9BUEVSVFVSRShpOTE1KSkKKwkJdHJhc2hfc3Rv
bGVuX2NwdShpOTE1KTsKIAogCXBtX3Jlc3VtZShpOTE1KTsKIApAQCAtMTg3LDYgKzI0NSwxMiBA
QCBzdGF0aWMgaW50IGlndF9nZW1faGliZXJuYXRlKHZvaWQgKmFyZykKIAlpZiAoZXJyKQogCQln
b3RvIG91dDsKIAorCWlmICghSEFTX01BUFBBQkxFX0FQRVJUVVJFKGk5MTUpKSB7CisJCWVyciA9
IHRyYXNoX3N0b2xlbl9ncHUoY3R4KTsKKwkJaWYgKGVycikKKwkJCWdvdG8gb3V0OworCX0KKwog
CWVyciA9IHBtX3ByZXBhcmUoaTkxNSk7CiAJaWYgKGVycikKIAkJZ290byBvdXQ7CkBAIC0xOTQs
NyArMjU4LDggQEAgc3RhdGljIGludCBpZ3RfZ2VtX2hpYmVybmF0ZSh2b2lkICphcmcpCiAJcG1f
aGliZXJuYXRlKGk5MTUpOwogCiAJLyogSGVyZSBiZSBkcmFnb25zISAqLwotCXNpbXVsYXRlX2hp
YmVybmF0ZShpOTE1KTsKKwlpZiAoSEFTX01BUFBBQkxFX0FQRVJUVVJFKGk5MTUpKQorCQl0cmFz
aF9zdG9sZW5fY3B1KGk5MTUpOwogCiAJcG1fcmVzdW1lKGk5MTUpOwogCi0tIAoyLjIwLjEKCl9f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBt
YWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3Rz
LmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4C1B79A9E1
	for <lists+intel-gfx@lfdr.de>; Fri, 23 Aug 2019 10:13:47 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9FAD46EC02;
	Fri, 23 Aug 2019 08:13:45 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id ABB2E6EC02
 for <intel-gfx@lists.freedesktop.org>; Fri, 23 Aug 2019 08:13:43 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18236105-1500050 
 for <intel-gfx@lists.freedesktop.org>; Fri, 23 Aug 2019 09:13:41 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 23 Aug 2019 09:13:40 +0100
Message-Id: <20190823081340.6684-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [CI] drm/i915: Hold irq-off for the entire fake lock
 period
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U2FkbHkgbG9ja2RlcCByZWNvcmRzIHdoZW4gdGhlIGlycXMgYXJlIHJlLWVuYWJsZWQgYW5kIHRo
ZW4gbWFya3MgdXAgdGhlCmZha2UgbG9jayBhcyBiZWluZyBpcnEtdW5zYWZlLiBPdXIgaGFuZCBp
cyBmb3JjZWQgYW5kIHNvIHdlIG11c3QgbWFyayB1cAp0aGUgZW50aXJlIGZha2UgbG9jayBjcml0
aWNhbCBzZWN0aW9uIGFzIGlycS1vZmYuCgpIb3BlZnVsbHkgdGhpcyBpcyB0aGUgbGFzdCB0d2Vh
ayByZXF1aXJlZCEKCkZpeGVzOiBkNjc3MzkyNjhjZjAgKCJkcm0vaTkxNS9ndDogTWFyayB1cCB0
aGUgbmVzdGVkIGVuZ2luZS1wbSB0aW1lbGluZSBsb2NrIGFzIGlycXNhZmUiKQpTaWduZWQtb2Zm
LWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IFR2cnRrbyBV
cnN1bGluIDx0dnJ0a28udXJzdWxpbkBpbnRlbC5jb20+CkNjOiBNaWthIEt1b3BwYWxhIDxtaWth
Lmt1b3BwYWxhQGxpbnV4LmludGVsLmNvbT4KUmV2aWV3ZWQtYnk6IE1pa2EgS3VvcHBhbGEgPG1p
a2Eua3VvcHBhbGFAbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2VuZ2luZV9wbS5jIHwgNDEgKysrKysrKysrKysrKysrKystLS0tLS0KIDEgZmlsZSBj
aGFuZ2VkLCAzMCBpbnNlcnRpb25zKCspLCAxMSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jCmluZGV4IGEzNzJkNGVhOTM3MC4uN2VlYzg2NzBm
ZjI3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0u
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYwpAQCAtMzks
MzUgKzM5LDUzIEBAIHN0YXRpYyBpbnQgX19lbmdpbmVfdW5wYXJrKHN0cnVjdCBpbnRlbF93YWtl
cmVmICp3ZikKIAogI2lmIElTX0VOQUJMRUQoQ09ORklHX0xPQ0tERVApCiAKLXN0YXRpYyBpbmxp
bmUgdm9pZCBfX3RpbWVsaW5lX21hcmtfbG9jayhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCitz
dGF0aWMgaW5saW5lIHVuc2lnbmVkIGxvbmcgX190aW1lbGluZV9tYXJrX2xvY2soc3RydWN0IGlu
dGVsX2NvbnRleHQgKmNlKQogewogCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAKIAlsb2NhbF9pcnFf
c2F2ZShmbGFncyk7CiAJbXV0ZXhfYWNxdWlyZSgmY2UtPnRpbWVsaW5lLT5tdXRleC5kZXBfbWFw
LCAyLCAwLCBfVEhJU19JUF8pOwotCWxvY2FsX2lycV9yZXN0b3JlKGZsYWdzKTsKKworCXJldHVy
biBmbGFnczsKIH0KIAotc3RhdGljIGlubGluZSB2b2lkIF9fdGltZWxpbmVfbWFya191bmxvY2so
c3RydWN0IGludGVsX2NvbnRleHQgKmNlKQorc3RhdGljIGlubGluZSB2b2lkIF9fdGltZWxpbmVf
bWFya191bmxvY2soc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAorCQkJCQkgIHVuc2lnbmVkIGxv
bmcgZmxhZ3MpCiB7CiAJbXV0ZXhfcmVsZWFzZSgmY2UtPnRpbWVsaW5lLT5tdXRleC5kZXBfbWFw
LCAwLCBfVEhJU19JUF8pOworCWxvY2FsX2lycV9yZXN0b3JlKGZsYWdzKTsKIH0KIAogI2Vsc2UK
IAotc3RhdGljIGlubGluZSB2b2lkIF9fdGltZWxpbmVfbWFya19sb2NrKHN0cnVjdCBpbnRlbF9j
b250ZXh0ICpjZSkKK3N0YXRpYyBpbmxpbmUgdW5zaWduZWQgbG9uZyBfX3RpbWVsaW5lX21hcmtf
bG9jayhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiB7CisJcmV0dXJuIDA7CiB9CiAKLXN0YXRp
YyBpbmxpbmUgdm9pZCBfX3RpbWVsaW5lX21hcmtfdW5sb2NrKHN0cnVjdCBpbnRlbF9jb250ZXh0
ICpjZSkKK3N0YXRpYyBpbmxpbmUgdm9pZCBfX3RpbWVsaW5lX21hcmtfdW5sb2NrKHN0cnVjdCBp
bnRlbF9jb250ZXh0ICpjZSwKKwkJCQkJICB1bnNpZ25lZCBsb25nIGZsYWdzKQogewogfQogCiAj
ZW5kaWYgLyogIUlTX0VOQUJMRUQoQ09ORklHX0xPQ0tERVApICovCiAKK3N0YXRpYyB2b2lkIF9f
dGltZWxpbmVfbWFya19hY3RpdmUoc3RydWN0IGludGVsX3RpbWVsaW5lICp0bCkKK3sKKwlzdHJ1
Y3QgaW50ZWxfZ3RfdGltZWxpbmVzICp0aW1lbGluZXMgPSAmdGwtPmd0LT50aW1lbGluZXM7CisK
KwlHRU1fQlVHX09OKCFsaXN0X2VtcHR5KCZ0aW1lbGluZXMtPmFjdGl2ZV9saXN0KSk7CisJR0VN
X0JVR19PTih0bC0+YWN0aXZlX2NvdW50KTsKKworCWxpc3RfYWRkKCZ0bC0+bGluaywgJnRpbWVs
aW5lcy0+YWN0aXZlX2xpc3QpOworCXRsLT5hY3RpdmVfY291bnQgPSAxOworfQorCiBzdGF0aWMg
Ym9vbCBzd2l0Y2hfdG9fa2VybmVsX2NvbnRleHQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lKQogewogCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCXVuc2lnbmVkIGxvbmcgZmxhZ3M7
CisJYm9vbCByZXN1bHQgPSB0cnVlOwogCiAJLyogQWxyZWFkeSBpbnNpZGUgdGhlIGtlcm5lbCBj
b250ZXh0LCBzYWZlIHRvIHBvd2VyIGRvd24uICovCiAJaWYgKGVuZ2luZS0+d2FrZXJlZl9zZXJp
YWwgPT0gZW5naW5lLT5zZXJpYWwpCkBAIC04OSwxNCArMTA3LDE0IEBAIHN0YXRpYyBib29sIHN3
aXRjaF90b19rZXJuZWxfY29udGV4dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJ
ICogcmV0aXJpbmcgdGhlIGxhc3QgcmVxdWVzdCwgdGh1cyBhbGwgcmluZ3Mgc2hvdWxkIGJlIGVt
cHR5IGFuZAogCSAqIGFsbCB0aW1lbGluZXMgaWRsZS4KIAkgKi8KLQlfX3RpbWVsaW5lX21hcmtf
bG9jayhlbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKKwlmbGFncyA9IF9fdGltZWxpbmVfbWFya19s
b2NrKGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOwogCiAJcnEgPSBfX2k5MTVfcmVxdWVzdF9jcmVh
dGUoZW5naW5lLT5rZXJuZWxfY29udGV4dCwgR0ZQX05PV0FJVCk7CiAJaWYgKElTX0VSUihycSkp
CiAJCS8qIENvbnRleHQgc3dpdGNoIGZhaWxlZCwgaG9wZSBmb3IgdGhlIGJlc3QhIE1heWJlIHJl
c2V0PyAqLwotCQlyZXR1cm4gdHJ1ZTsKKwkJZ290byBvdXRfdW5sb2NrOwogCi0JaW50ZWxfdGlt
ZWxpbmVfZW50ZXIocnEtPnRpbWVsaW5lKTsKKwlfX3RpbWVsaW5lX21hcmtfYWN0aXZlKHJxLT50
aW1lbGluZSk7CiAKIAkvKiBDaGVjayBhZ2FpbiBvbiB0aGUgbmV4dCByZXRpcmVtZW50LiAqLwog
CWVuZ2luZS0+d2FrZXJlZl9zZXJpYWwgPSBlbmdpbmUtPnNlcmlhbCArIDE7CkBAIC0xMTAsOSAr
MTI4LDEwIEBAIHN0YXRpYyBib29sIHN3aXRjaF90b19rZXJuZWxfY29udGV4dChzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJX19pbnRlbF93YWtlcmVmX2RlZmVyX3BhcmsoJmVuZ2lu
ZS0+d2FrZXJlZik7CiAJX19pOTE1X3JlcXVlc3RfcXVldWUocnEsIE5VTEwpOwogCi0JX190aW1l
bGluZV9tYXJrX3VubG9jayhlbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKLQotCXJldHVybiBmYWxz
ZTsKKwlyZXN1bHQgPSBmYWxzZTsKK291dF91bmxvY2s6CisJX190aW1lbGluZV9tYXJrX3VubG9j
ayhlbmdpbmUtPmtlcm5lbF9jb250ZXh0LCBmbGFncyk7CisJcmV0dXJuIHJlc3VsdDsKIH0KIAog
c3RhdGljIGludCBfX2VuZ2luZV9wYXJrKHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZikKLS0gCjIu
MjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50
ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D4FA988AE0
	for <lists+intel-gfx@lfdr.de>; Sat, 10 Aug 2019 12:50:15 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 539076E2E1;
	Sat, 10 Aug 2019 10:50:14 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C96B06E2E1
 for <intel-gfx@lists.freedesktop.org>; Sat, 10 Aug 2019 10:50:11 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17952286-1500050 
 for <intel-gfx@lists.freedesktop.org>; Sat, 10 Aug 2019 11:50:09 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sat, 10 Aug 2019 11:50:08 +0100
Message-Id: <20190810105008.14320-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
MIME-Version: 1.0
Subject: [Intel-gfx] [CI] drm/i915/selftests: move gpu-write-dw into utils
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogTWF0dGhldyBBdWxkIDxtYXR0aGV3LmF1bGRAaW50ZWwuY29tPgoKVXNpbmcgdGhlIGdw
dSB0byB3cml0ZSB0byBzb21lIGR3b3JkIG92ZXIgYSBudW1iZXIgb2YgcGFnZXMgaXMgcmF0aGVy
CnVzZWZ1bCwgYW5kIHdlIGFscmVhZHkgaGF2ZSB0d28gY29waWVzIG9mIHN1Y2ggYSB0aGluZywg
YW5kIHdlIGRvbid0CndhbnQgYSB0aGlyZCBzbyBtb3ZlIGl0IHRvIHV0aWxzLiBUaGVyZSBpcyBw
cm9iYWJseSBzb21lIG90aGVyIHN0dWZmCmFsc28uLi4KClNpZ25lZC1vZmYtYnk6IE1hdHRoZXcg
QXVsZCA8bWF0dGhldy5hdWxkQGludGVsLmNvbT4KUmV2aWV3ZWQtYnk6IENocmlzIFdpbHNvbiA8
Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgotLS0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0
ZXN0cy9odWdlX3BhZ2VzLmMgICB8IDEyMCArKy0tLS0tLS0tLS0tLS0tCiAuLi4vZHJtL2k5MTUv
Z2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMgfCAxMzQgKystLS0tLS0tLS0tLS0tLS0K
IC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2lndF9nZW1fdXRpbHMuYyAgICB8IDEzNSArKysr
KysrKysrKysrKysrKysKIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2lndF9nZW1fdXRpbHMu
aCAgICB8ICAxNiArKysKIDQgZmlsZXMgY2hhbmdlZCwgMTY5IGluc2VydGlvbnMoKyksIDIzNiBk
ZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRl
c3RzL2h1Z2VfcGFnZXMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVn
ZV9wYWdlcy5jCmluZGV4IDZjYmQ0YTY2OGM5YS4uOGRlODNjNmQ4MWY1IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYwpAQCAtODc5LDEyNiAr
ODc5LDIyIEBAIHN0YXRpYyBpbnQgaWd0X21vY2tfcHBndHRfNjRLKHZvaWQgKmFyZykKIAlyZXR1
cm4gZXJyOwogfQogCi1zdGF0aWMgc3RydWN0IGk5MTVfdm1hICoKLWdwdV93cml0ZV9kdyhzdHJ1
Y3QgaTkxNV92bWEgKnZtYSwgdTY0IG9mZnNldCwgdTMyIHZhbCkKLXsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IHZtYS0+dm0tPmk5MTU7Ci0JY29uc3QgaW50IGdlbiA9IElOVEVM
X0dFTihpOTE1KTsKLQl1bnNpZ25lZCBpbnQgY291bnQgPSB2bWEtPnNpemUgPj4gUEFHRV9TSElG
VDsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwotCXN0cnVjdCBpOTE1X3ZtYSAq
YmF0Y2g7Ci0JdW5zaWduZWQgaW50IHNpemU7Ci0JdTMyICpjbWQ7Ci0JaW50IG47Ci0JaW50IGVy
cjsKLQotCXNpemUgPSAoMSArIDQgKiBjb3VudCkgKiBzaXplb2YodTMyKTsKLQlzaXplID0gcm91
bmRfdXAoc2l6ZSwgUEFHRV9TSVpFKTsKLQlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2lu
dGVybmFsKGk5MTUsIHNpemUpOwotCWlmIChJU19FUlIob2JqKSkKLQkJcmV0dXJuIEVSUl9DQVNU
KG9iaik7Ci0KLQljbWQgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChvYmosIEk5MTVfTUFQX1dD
KTsKLQlpZiAoSVNfRVJSKGNtZCkpIHsKLQkJZXJyID0gUFRSX0VSUihjbWQpOwotCQlnb3RvIGVy
cjsKLQl9Ci0KLQlvZmZzZXQgKz0gdm1hLT5ub2RlLnN0YXJ0OwotCi0JZm9yIChuID0gMDsgbiA8
IGNvdW50OyBuKyspIHsKLQkJaWYgKGdlbiA+PSA4KSB7Ci0JCQkqY21kKysgPSBNSV9TVE9SRV9E
V09SRF9JTU1fR0VONDsKLQkJCSpjbWQrKyA9IGxvd2VyXzMyX2JpdHMob2Zmc2V0KTsKLQkJCSpj
bWQrKyA9IHVwcGVyXzMyX2JpdHMob2Zmc2V0KTsKLQkJCSpjbWQrKyA9IHZhbDsKLQkJfSBlbHNl
IGlmIChnZW4gPj0gNCkgewotCQkJKmNtZCsrID0gTUlfU1RPUkVfRFdPUkRfSU1NX0dFTjQgfAot
CQkJCShnZW4gPCA2ID8gTUlfVVNFX0dHVFQgOiAwKTsKLQkJCSpjbWQrKyA9IDA7Ci0JCQkqY21k
KysgPSBvZmZzZXQ7Ci0JCQkqY21kKysgPSB2YWw7Ci0JCX0gZWxzZSB7Ci0JCQkqY21kKysgPSBN
SV9TVE9SRV9EV09SRF9JTU0gfCBNSV9NRU1fVklSVFVBTDsKLQkJCSpjbWQrKyA9IG9mZnNldDsK
LQkJCSpjbWQrKyA9IHZhbDsKLQkJfQotCi0JCW9mZnNldCArPSBQQUdFX1NJWkU7Ci0JfQotCi0J
KmNtZCA9IE1JX0JBVENIX0JVRkZFUl9FTkQ7Ci0JaW50ZWxfZ3RfY2hpcHNldF9mbHVzaCh2bWEt
PnZtLT5ndCk7Ci0KLQlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKG9iaik7Ci0KLQliYXRjaCA9
IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgdm1hLT52bSwgTlVMTCk7Ci0JaWYgKElTX0VSUihiYXRj
aCkpIHsKLQkJZXJyID0gUFRSX0VSUihiYXRjaCk7Ci0JCWdvdG8gZXJyOwotCX0KLQotCWVyciA9
IGk5MTVfdm1hX3BpbihiYXRjaCwgMCwgMCwgUElOX1VTRVIpOwotCWlmIChlcnIpCi0JCWdvdG8g
ZXJyOwotCi0JcmV0dXJuIGJhdGNoOwotCi1lcnI6Ci0JaTkxNV9nZW1fb2JqZWN0X3B1dChvYmop
OwotCi0JcmV0dXJuIEVSUl9QVFIoZXJyKTsKLX0KLQogc3RhdGljIGludCBncHVfd3JpdGUoc3Ry
dWN0IGk5MTVfdm1hICp2bWEsCiAJCSAgICAgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwK
IAkJICAgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCi0JCSAgICAgdTMyIGR3b3Jk
LAotCQkgICAgIHUzMiB2YWx1ZSkKKwkJICAgICB1MzIgZHcsCisJCSAgICAgdTMyIHZhbCkKIHsK
LQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKLQlzdHJ1Y3QgaTkxNV92bWEgKmJhdGNoOwogCWlu
dCBlcnI7CiAKLQlHRU1fQlVHX09OKCFpbnRlbF9lbmdpbmVfY2FuX3N0b3JlX2R3b3JkKGVuZ2lu
ZSkpOwotCi0JYmF0Y2ggPSBncHVfd3JpdGVfZHcodm1hLCBkd29yZCAqIHNpemVvZih1MzIpLCB2
YWx1ZSk7Ci0JaWYgKElTX0VSUihiYXRjaCkpCi0JCXJldHVybiBQVFJfRVJSKGJhdGNoKTsKLQot
CXJxID0gaWd0X3JlcXVlc3RfYWxsb2MoY3R4LCBlbmdpbmUpOwotCWlmIChJU19FUlIocnEpKSB7
Ci0JCWVyciA9IFBUUl9FUlIocnEpOwotCQlnb3RvIGVycl9iYXRjaDsKLQl9Ci0KLQlpOTE1X3Zt
YV9sb2NrKGJhdGNoKTsKLQllcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShiYXRjaCwgcnEs
IDApOwotCWk5MTVfdm1hX3VubG9jayhiYXRjaCk7Ci0JaWYgKGVycikKLQkJZ290byBlcnJfcmVx
dWVzdDsKLQotCWk5MTVfdm1hX2xvY2sodm1hKTsKLQllcnIgPSBpOTE1X2dlbV9vYmplY3Rfc2V0
X3RvX2d0dF9kb21haW4odm1hLT5vYmosIGZhbHNlKTsKLQlpZiAoZXJyID09IDApCi0JCWVyciA9
IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHZtYSwgcnEsIEVYRUNfT0JKRUNUX1dSSVRFKTsKLQlp
OTE1X3ZtYV91bmxvY2sodm1hKTsKKwlpOTE1X2dlbV9vYmplY3RfbG9jayh2bWEtPm9iaik7CisJ
ZXJyID0gaTkxNV9nZW1fb2JqZWN0X3NldF90b19ndHRfZG9tYWluKHZtYS0+b2JqLCB0cnVlKTsK
KwlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKHZtYS0+b2JqKTsKIAlpZiAoZXJyKQotCQlnb3RvIGVy
cl9yZXF1ZXN0OwotCi0JZXJyID0gZW5naW5lLT5lbWl0X2JiX3N0YXJ0KHJxLAotCQkJCSAgICBi
YXRjaC0+bm9kZS5zdGFydCwgYmF0Y2gtPm5vZGUuc2l6ZSwKLQkJCQkgICAgMCk7Ci1lcnJfcmVx
dWVzdDoKLQlpZiAoZXJyKQotCQlpOTE1X3JlcXVlc3Rfc2tpcChycSwgZXJyKTsKLQlpOTE1X3Jl
cXVlc3RfYWRkKHJxKTsKLWVycl9iYXRjaDoKLQlpOTE1X3ZtYV91bnBpbihiYXRjaCk7Ci0JaTkx
NV92bWFfY2xvc2UoYmF0Y2gpOwotCWk5MTVfdm1hX3B1dChiYXRjaCk7CisJCXJldHVybiBlcnI7
CiAKLQlyZXR1cm4gZXJyOworCXJldHVybiBpZ3RfZ3B1X2ZpbGxfZHcodm1hLCBjdHgsIGVuZ2lu
ZSwgZHcgKiBzaXplb2YodTMyKSwKKwkJCSAgICAgICB2bWEtPnNpemUgPj4gUEFHRV9TSElGVCwg
dmFsKTsKIH0KIAogc3RhdGljIGludCBjcHVfY2hlY2soc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iaiwgdTMyIGR3b3JkLCB1MzIgdmFsKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYwppbmRleCBjMjQ0MzAzNTJhMzgu
LmRkODdlNmNkNjEyZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0
ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3Nl
bGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKQEAgLTE1Niw3MCArMTU2LDYgQEAgc3RhdGljIGlu
dCBsaXZlX25vcF9zd2l0Y2godm9pZCAqYXJnKQogCXJldHVybiBlcnI7CiB9CiAKLXN0YXRpYyBz
dHJ1Y3QgaTkxNV92bWEgKgotZ3B1X2ZpbGxfZHcoc3RydWN0IGk5MTVfdm1hICp2bWEsIHU2NCBv
ZmZzZXQsIHVuc2lnbmVkIGxvbmcgY291bnQsIHUzMiB2YWx1ZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqOwotCWNvbnN0IGludCBnZW4gPSBJTlRFTF9HRU4odm1hLT52bS0+
aTkxNSk7Ci0JdW5zaWduZWQgbG9uZyBuLCBzaXplOwotCXUzMiAqY21kOwotCWludCBlcnI7Ci0K
LQlzaXplID0gKDQgKiBjb3VudCArIDEpICogc2l6ZW9mKHUzMik7Ci0Jc2l6ZSA9IHJvdW5kX3Vw
KHNpemUsIFBBR0VfU0laRSk7Ci0Jb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5h
bCh2bWEtPnZtLT5pOTE1LCBzaXplKTsKLQlpZiAoSVNfRVJSKG9iaikpCi0JCXJldHVybiBFUlJf
Q0FTVChvYmopOwotCi0JY21kID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAob2JqLCBJOTE1X01B
UF9XQik7Ci0JaWYgKElTX0VSUihjbWQpKSB7Ci0JCWVyciA9IFBUUl9FUlIoY21kKTsKLQkJZ290
byBlcnI7Ci0JfQotCi0JR0VNX0JVR19PTihvZmZzZXQgKyAoY291bnQgLSAxKSAqIFBBR0VfU0la
RSA+IHZtYS0+bm9kZS5zaXplKTsKLQlvZmZzZXQgKz0gdm1hLT5ub2RlLnN0YXJ0OwotCi0JZm9y
IChuID0gMDsgbiA8IGNvdW50OyBuKyspIHsKLQkJaWYgKGdlbiA+PSA4KSB7Ci0JCQkqY21kKysg
PSBNSV9TVE9SRV9EV09SRF9JTU1fR0VONDsKLQkJCSpjbWQrKyA9IGxvd2VyXzMyX2JpdHMob2Zm
c2V0KTsKLQkJCSpjbWQrKyA9IHVwcGVyXzMyX2JpdHMob2Zmc2V0KTsKLQkJCSpjbWQrKyA9IHZh
bHVlOwotCQl9IGVsc2UgaWYgKGdlbiA+PSA0KSB7Ci0JCQkqY21kKysgPSBNSV9TVE9SRV9EV09S
RF9JTU1fR0VONCB8Ci0JCQkJKGdlbiA8IDYgPyBNSV9VU0VfR0dUVCA6IDApOwotCQkJKmNtZCsr
ID0gMDsKLQkJCSpjbWQrKyA9IG9mZnNldDsKLQkJCSpjbWQrKyA9IHZhbHVlOwotCQl9IGVsc2Ug
ewotCQkJKmNtZCsrID0gTUlfU1RPUkVfRFdPUkRfSU1NIHwgTUlfTUVNX1ZJUlRVQUw7Ci0JCQkq
Y21kKysgPSBvZmZzZXQ7Ci0JCQkqY21kKysgPSB2YWx1ZTsKLQkJfQotCQlvZmZzZXQgKz0gUEFH
RV9TSVpFOwotCX0KLQkqY21kID0gTUlfQkFUQ0hfQlVGRkVSX0VORDsKLQlpOTE1X2dlbV9vYmpl
Y3RfZmx1c2hfbWFwKG9iaik7Ci0JaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChvYmopOwotCi0J
dm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCB2bWEtPnZtLCBOVUxMKTsKLQlpZiAoSVNfRVJS
KHZtYSkpIHsKLQkJZXJyID0gUFRSX0VSUih2bWEpOwotCQlnb3RvIGVycjsKLQl9Ci0KLQllcnIg
PSBpOTE1X3ZtYV9waW4odm1hLCAwLCAwLCBQSU5fVVNFUik7Ci0JaWYgKGVycikKLQkJZ290byBl
cnI7Ci0KLQlyZXR1cm4gdm1hOwotCi1lcnI6Ci0JaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwot
CXJldHVybiBFUlJfUFRSKGVycik7Ci19Ci0KIHN0YXRpYyB1bnNpZ25lZCBsb25nIHJlYWxfcGFn
ZV9jb3VudChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogewogCXJldHVybiBodWdl
X2dlbV9vYmplY3RfcGh5c19zaXplKG9iaikgPj4gUEFHRV9TSElGVDsKQEAgLTIzNiwxMCArMTcy
LDcgQEAgc3RhdGljIGludCBncHVfZmlsbChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
LAogCQkgICAgdW5zaWduZWQgaW50IGR3KQogewogCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ug
KnZtID0gY3R4LT52bSA/OiAmZW5naW5lLT5ndC0+Z2d0dC0+dm07Ci0Jc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnE7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7Ci0Jc3RydWN0IGk5MTVfdm1hICpiYXRj
aDsKLQl1bnNpZ25lZCBpbnQgZmxhZ3M7CiAJaW50IGVycjsKIAogCUdFTV9CVUdfT04ob2JqLT5i
YXNlLnNpemUgPiB2bS0+dG90YWwpOwpAQCAtMjUwLDcgKzE4Myw3IEBAIHN0YXRpYyBpbnQgZ3B1
X2ZpbGwoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJcmV0dXJuIFBUUl9FUlIo
dm1hKTsKIAogCWk5MTVfZ2VtX29iamVjdF9sb2NrKG9iaik7Ci0JZXJyID0gaTkxNV9nZW1fb2Jq
ZWN0X3NldF90b19ndHRfZG9tYWluKG9iaiwgZmFsc2UpOworCWVyciA9IGk5MTVfZ2VtX29iamVj
dF9zZXRfdG9fZ3R0X2RvbWFpbihvYmosIHRydWUpOwogCWk5MTVfZ2VtX29iamVjdF91bmxvY2so
b2JqKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwpAQCAtMjU5LDcwICsxOTIsMjMgQEAgc3Rh
dGljIGludCBncHVfZmlsbChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCWlmIChl
cnIpCiAJCXJldHVybiBlcnI7CiAKLQkvKiBXaXRoaW4gdGhlIEdUVCB0aGUgaHVnZSBvYmplY3Rz
IG1hcHMgZXZlcnkgcGFnZSBvbnRvCisJLyoKKwkgKiBXaXRoaW4gdGhlIEdUVCB0aGUgaHVnZSBv
YmplY3RzIG1hcHMgZXZlcnkgcGFnZSBvbnRvCiAJICogaXRzIDEwMjQgcmVhbCBwYWdlcyAodXNp
bmcgcGh5c19wZm4gPSBkbWFfcGZuICUgMTAyNCkuCiAJICogV2Ugc2V0IHRoZSBudGggZHdvcmQg
d2l0aGluIHRoZSBwYWdlIHVzaW5nIHRoZSBudGgKIAkgKiBtYXBwaW5nIHZpYSB0aGUgR1RUIC0g
dGhpcyBzaG91bGQgZXhlcmNpc2UgdGhlIEdUVCBtYXBwaW5nCiAJICogd2hpbHN0IGNoZWNraW5n
IHRoYXQgZWFjaCBjb250ZXh0IHByb3ZpZGVzIGEgdW5pcXVlIHZpZXcKIAkgKiBpbnRvIHRoZSBv
YmplY3QuCiAJICovCi0JYmF0Y2ggPSBncHVfZmlsbF9kdyh2bWEsCi0JCQkgICAgKGR3ICogcmVh
bF9wYWdlX2NvdW50KG9iaikpIDw8IFBBR0VfU0hJRlQgfAotCQkJICAgIChkdyAqIHNpemVvZih1
MzIpKSwKLQkJCSAgICByZWFsX3BhZ2VfY291bnQob2JqKSwKLQkJCSAgICBkdyk7Ci0JaWYgKElT
X0VSUihiYXRjaCkpIHsKLQkJZXJyID0gUFRSX0VSUihiYXRjaCk7Ci0JCWdvdG8gZXJyX3ZtYTsK
LQl9Ci0KLQlycSA9IGlndF9yZXF1ZXN0X2FsbG9jKGN0eCwgZW5naW5lKTsKLQlpZiAoSVNfRVJS
KHJxKSkgewotCQllcnIgPSBQVFJfRVJSKHJxKTsKLQkJZ290byBlcnJfYmF0Y2g7Ci0JfQotCi0J
ZmxhZ3MgPSAwOwotCWlmIChJTlRFTF9HRU4odm0tPmk5MTUpIDw9IDUpCi0JCWZsYWdzIHw9IEk5
MTVfRElTUEFUQ0hfU0VDVVJFOwotCi0JZXJyID0gZW5naW5lLT5lbWl0X2JiX3N0YXJ0KHJxLAot
CQkJCSAgICBiYXRjaC0+bm9kZS5zdGFydCwgYmF0Y2gtPm5vZGUuc2l6ZSwKLQkJCQkgICAgZmxh
Z3MpOwotCWlmIChlcnIpCi0JCWdvdG8gZXJyX3JlcXVlc3Q7Ci0KLQlpOTE1X3ZtYV9sb2NrKGJh
dGNoKTsKLQllcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShiYXRjaCwgcnEsIDApOwotCWk5
MTVfdm1hX3VubG9jayhiYXRjaCk7Ci0JaWYgKGVycikKLQkJZ290byBza2lwX3JlcXVlc3Q7Ci0K
LQlpOTE1X3ZtYV9sb2NrKHZtYSk7Ci0JZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3RpdmUodm1h
LCBycSwgRVhFQ19PQkpFQ1RfV1JJVEUpOwotCWk5MTVfdm1hX3VubG9jayh2bWEpOwotCWlmIChl
cnIpCi0JCWdvdG8gc2tpcF9yZXF1ZXN0OwotCi0JaTkxNV9yZXF1ZXN0X2FkZChycSk7Ci0KLQlp
OTE1X3ZtYV91bnBpbihiYXRjaCk7Ci0JaTkxNV92bWFfY2xvc2UoYmF0Y2gpOwotCWk5MTVfdm1h
X3B1dChiYXRjaCk7Ci0KKwllcnIgPSBpZ3RfZ3B1X2ZpbGxfZHcodm1hLAorCQkJICAgICAgY3R4
LAorCQkJICAgICAgZW5naW5lLAorCQkJICAgICAgKGR3ICogcmVhbF9wYWdlX2NvdW50KG9iaikp
IDw8IFBBR0VfU0hJRlQgfAorCQkJICAgICAgKGR3ICogc2l6ZW9mKHUzMikpLAorCQkJICAgICAg
cmVhbF9wYWdlX2NvdW50KG9iaiksCisJCQkgICAgICBkdyk7CiAJaTkxNV92bWFfdW5waW4odm1h
KTsKIAotCXJldHVybiAwOwotCi1za2lwX3JlcXVlc3Q6Ci0JaTkxNV9yZXF1ZXN0X3NraXAocnEs
IGVycik7Ci1lcnJfcmVxdWVzdDoKLQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKLWVycl9iYXRjaDoK
LQlpOTE1X3ZtYV91bnBpbihiYXRjaCk7Ci0JaTkxNV92bWFfcHV0KGJhdGNoKTsKLWVycl92bWE6
Ci0JaTkxNV92bWFfdW5waW4odm1hKTsKIAlyZXR1cm4gZXJyOwogfQogCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2lndF9nZW1fdXRpbHMuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGlscy5jCmluZGV4IDkzYzYz
NmFlYWU3My4uNDJlMWU5YzU4ZjYzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vc2VsZnRlc3RzL2lndF9nZW1fdXRpbHMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vc2VsZnRlc3RzL2lndF9nZW1fdXRpbHMuYwpAQCAtOSw2ICs5LDggQEAKICNpbmNsdWRlICJn
ZW0vaTkxNV9nZW1fY29udGV4dC5oIgogI2luY2x1ZGUgImdlbS9pOTE1X2dlbV9wbS5oIgogI2lu
Y2x1ZGUgImd0L2ludGVsX2NvbnRleHQuaCIKKyNpbmNsdWRlICJpOTE1X3ZtYS5oIgorI2luY2x1
ZGUgImk5MTVfZHJ2LmgiCiAKICNpbmNsdWRlICJpOTE1X3JlcXVlc3QuaCIKIApAQCAtMzIsMyAr
MzQsMTM2IEBAIGlndF9yZXF1ZXN0X2FsbG9jKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgs
IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAogCXJldHVybiBycTsKIH0KKworc3Ry
dWN0IGk5MTVfdm1hICoKK2lndF9lbWl0X3N0b3JlX2R3KHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAor
CQkgIHU2NCBvZmZzZXQsCisJCSAgdW5zaWduZWQgbG9uZyBjb3VudCwKKwkJICB1MzIgdmFsKQor
eworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CisJY29uc3QgaW50IGdlbiA9IElO
VEVMX0dFTih2bWEtPnZtLT5pOTE1KTsKKwl1bnNpZ25lZCBsb25nIG4sIHNpemU7CisJdTMyICpj
bWQ7CisJaW50IGVycjsKKworCXNpemUgPSAoNCAqIGNvdW50ICsgMSkgKiBzaXplb2YodTMyKTsK
KwlzaXplID0gcm91bmRfdXAoc2l6ZSwgUEFHRV9TSVpFKTsKKwlvYmogPSBpOTE1X2dlbV9vYmpl
Y3RfY3JlYXRlX2ludGVybmFsKHZtYS0+dm0tPmk5MTUsIHNpemUpOworCWlmIChJU19FUlIob2Jq
KSkKKwkJcmV0dXJuIEVSUl9DQVNUKG9iaik7CisKKwljbWQgPSBpOTE1X2dlbV9vYmplY3RfcGlu
X21hcChvYmosIEk5MTVfTUFQX1dDKTsKKwlpZiAoSVNfRVJSKGNtZCkpIHsKKwkJZXJyID0gUFRS
X0VSUihjbWQpOworCQlnb3RvIGVycjsKKwl9CisKKwlHRU1fQlVHX09OKG9mZnNldCArIChjb3Vu
dCAtIDEpICogUEFHRV9TSVpFID4gdm1hLT5ub2RlLnNpemUpOworCW9mZnNldCArPSB2bWEtPm5v
ZGUuc3RhcnQ7CisKKwlmb3IgKG4gPSAwOyBuIDwgY291bnQ7IG4rKykgeworCQlpZiAoZ2VuID49
IDgpIHsKKwkJCSpjbWQrKyA9IE1JX1NUT1JFX0RXT1JEX0lNTV9HRU40OworCQkJKmNtZCsrID0g
bG93ZXJfMzJfYml0cyhvZmZzZXQpOworCQkJKmNtZCsrID0gdXBwZXJfMzJfYml0cyhvZmZzZXQp
OworCQkJKmNtZCsrID0gdmFsOworCQl9IGVsc2UgaWYgKGdlbiA+PSA0KSB7CisJCQkqY21kKysg
PSBNSV9TVE9SRV9EV09SRF9JTU1fR0VONCB8CisJCQkJKGdlbiA8IDYgPyBNSV9VU0VfR0dUVCA6
IDApOworCQkJKmNtZCsrID0gMDsKKwkJCSpjbWQrKyA9IG9mZnNldDsKKwkJCSpjbWQrKyA9IHZh
bDsKKwkJfSBlbHNlIHsKKwkJCSpjbWQrKyA9IE1JX1NUT1JFX0RXT1JEX0lNTSB8IE1JX01FTV9W
SVJUVUFMOworCQkJKmNtZCsrID0gb2Zmc2V0OworCQkJKmNtZCsrID0gdmFsOworCQl9CisJCW9m
ZnNldCArPSBQQUdFX1NJWkU7CisJfQorCSpjbWQgPSBNSV9CQVRDSF9CVUZGRVJfRU5EOworCWk5
MTVfZ2VtX29iamVjdF91bnBpbl9tYXAob2JqKTsKKworCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNl
KG9iaiwgdm1hLT52bSwgTlVMTCk7CisJaWYgKElTX0VSUih2bWEpKSB7CisJCWVyciA9IFBUUl9F
UlIodm1hKTsKKwkJZ290byBlcnI7CisJfQorCisJZXJyID0gaTkxNV92bWFfcGluKHZtYSwgMCwg
MCwgUElOX1VTRVIpOworCWlmIChlcnIpCisJCWdvdG8gZXJyOworCisJcmV0dXJuIHZtYTsKKwor
ZXJyOgorCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwlyZXR1cm4gRVJSX1BUUihlcnIpOwor
fQorCitpbnQgaWd0X2dwdV9maWxsX2R3KHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAorCQkgICAgc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKKwkJICAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZSwKKwkJICAgIHU2NCBvZmZzZXQsCisJCSAgICB1bnNpZ25lZCBsb25nIGNvdW50LAor
CQkgICAgdTMyIHZhbCkKK3sKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IGN0eC0+
dm0gPzogJmVuZ2luZS0+Z3QtPmdndHQtPnZtOworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwor
CXN0cnVjdCBpOTE1X3ZtYSAqYmF0Y2g7CisJdW5zaWduZWQgaW50IGZsYWdzOworCWludCBlcnI7
CisKKwlHRU1fQlVHX09OKHZtYS0+c2l6ZSA+IHZtLT50b3RhbCk7CisJR0VNX0JVR19PTighaW50
ZWxfZW5naW5lX2Nhbl9zdG9yZV9kd29yZChlbmdpbmUpKTsKKwlHRU1fQlVHX09OKCFpOTE1X3Zt
YV9pc19waW5uZWQodm1hKSk7CisKKwliYXRjaCA9IGlndF9lbWl0X3N0b3JlX2R3KHZtYSwgb2Zm
c2V0LCBjb3VudCwgdmFsKTsKKwlpZiAoSVNfRVJSKGJhdGNoKSkKKwkJcmV0dXJuIFBUUl9FUlIo
YmF0Y2gpOworCisJcnEgPSBpZ3RfcmVxdWVzdF9hbGxvYyhjdHgsIGVuZ2luZSk7CisJaWYgKElT
X0VSUihycSkpIHsKKwkJZXJyID0gUFRSX0VSUihycSk7CisJCWdvdG8gZXJyX2JhdGNoOworCX0K
KworCWZsYWdzID0gMDsKKwlpZiAoSU5URUxfR0VOKHZtLT5pOTE1KSA8PSA1KQorCQlmbGFncyB8
PSBJOTE1X0RJU1BBVENIX1NFQ1VSRTsKKworCWVyciA9IGVuZ2luZS0+ZW1pdF9iYl9zdGFydChy
cSwKKwkJCQkgICAgYmF0Y2gtPm5vZGUuc3RhcnQsIGJhdGNoLT5ub2RlLnNpemUsCisJCQkJICAg
IGZsYWdzKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl9yZXF1ZXN0OworCisJaTkxNV92bWFfbG9j
ayhiYXRjaCk7CisJZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3RpdmUoYmF0Y2gsIHJxLCAwKTsK
KwlpOTE1X3ZtYV91bmxvY2soYmF0Y2gpOworCWlmIChlcnIpCisJCWdvdG8gc2tpcF9yZXF1ZXN0
OworCisJaTkxNV92bWFfbG9jayh2bWEpOworCWVyciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZl
KHZtYSwgcnEsIEVYRUNfT0JKRUNUX1dSSVRFKTsKKwlpOTE1X3ZtYV91bmxvY2sodm1hKTsKKwlp
ZiAoZXJyKQorCQlnb3RvIHNraXBfcmVxdWVzdDsKKworCWk5MTVfcmVxdWVzdF9hZGQocnEpOwor
CisJaTkxNV92bWFfdW5waW4oYmF0Y2gpOworCWk5MTVfdm1hX2Nsb3NlKGJhdGNoKTsKKwlpOTE1
X3ZtYV9wdXQoYmF0Y2gpOworCisJcmV0dXJuIDA7CisKK3NraXBfcmVxdWVzdDoKKwlpOTE1X3Jl
cXVlc3Rfc2tpcChycSwgZXJyKTsKK2Vycl9yZXF1ZXN0OgorCWk5MTVfcmVxdWVzdF9hZGQocnEp
OworZXJyX2JhdGNoOgorCWk5MTVfdm1hX3VucGluKGJhdGNoKTsKKwlpOTE1X3ZtYV9wdXQoYmF0
Y2gpOworCXJldHVybiBlcnI7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vc2VsZnRlc3RzL2lndF9nZW1fdXRpbHMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9z
ZWxmdGVzdHMvaWd0X2dlbV91dGlscy5oCmluZGV4IDBmMTcyNTFjZjc1ZC4uMzYxYTdlZjg2NmIw
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2lndF9nZW1f
dXRpbHMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2lndF9nZW1f
dXRpbHMuaApAQCAtNywxMSArNywyNyBAQAogI2lmbmRlZiBfX0lHVF9HRU1fVVRJTFNfSF9fCiAj
ZGVmaW5lIF9fSUdUX0dFTV9VVElMU19IX18KIAorI2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+CisK
IHN0cnVjdCBpOTE1X3JlcXVlc3Q7CiBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dDsKIHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3M7CitzdHJ1Y3QgaTkxNV92bWE7CiAKIHN0cnVjdCBpOTE1X3JlcXVlc3Qg
KgogaWd0X3JlcXVlc3RfYWxsb2Moc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwgc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKIAorc3RydWN0IGk5MTVfdm1hICoKK2lndF9lbWl0
X3N0b3JlX2R3KHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAorCQkgIHU2NCBvZmZzZXQsCisJCSAgdW5z
aWduZWQgbG9uZyBjb3VudCwKKwkJICB1MzIgdmFsKTsKKworaW50IGlndF9ncHVfZmlsbF9kdyhz
dHJ1Y3QgaTkxNV92bWEgKnZtYSwKKwkJICAgIHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgs
CisJCSAgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCisJCSAgICB1NjQgb2Zmc2V0
LAorCQkgICAgdW5zaWduZWQgbG9uZyBjb3VudCwKKwkJICAgIHUzMiB2YWwpOworCiAjZW5kaWYg
LyogX19JR1RfR0VNX1VUSUxTX0hfXyAqLwotLSAKMi4yMy4wLnJjMQoKX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJ
bnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Au
b3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

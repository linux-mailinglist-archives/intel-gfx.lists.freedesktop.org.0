Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id ABD1A2FCD4B
	for <lists+intel-gfx@lfdr.de>; Wed, 20 Jan 2021 10:14:37 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3019D6E14C;
	Wed, 20 Jan 2021 09:14:34 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga14.intel.com (mga14.intel.com [192.55.52.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 57FC36E14B
 for <intel-gfx@lists.freedesktop.org>; Wed, 20 Jan 2021 09:14:33 +0000 (UTC)
IronPort-SDR: olLoEhMqxrrhLGxWPRAFvPfYRLvXnDvZHnSPVfv4fEBkoRSD8UPmzlsX+YWWcUqLDCRCoZD3vF
 UCMkQfJoo01w==
X-IronPort-AV: E=McAfee;i="6000,8403,9869"; a="178294385"
X-IronPort-AV: E=Sophos;i="5.79,360,1602572400"; d="scan'208";a="178294385"
Received: from orsmga002.jf.intel.com ([10.7.209.21])
 by fmsmga103.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 20 Jan 2021 01:14:32 -0800
IronPort-SDR: xWUWCP+42ZZLLApZV9wv9DRPvlj2M/8kc7TXKWqyCSQvcWDwoKc5JVvk5qSHsjax+fRp8ncjp3
 yFv1/7urFNqg==
X-IronPort-AV: E=Sophos;i="5.79,360,1602572400"; d="scan'208";a="366179536"
Received: from ghallend-mobl3.ger.corp.intel.com (HELO
 helsinki.ger.corp.intel.com) ([10.213.195.85])
 by orsmga002-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 20 Jan 2021 01:14:27 -0800
From: Gwan-gyeong Mun <gwan-gyeong.mun@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 20 Jan 2021 11:14:21 +0200
Message-Id: <20210120091422.905055-1-gwan-gyeong.mun@intel.com>
X-Mailer: git-send-email 2.30.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v12 1/2] drm/i915/display: Support PSR Multiple
 Instances
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SXQgaXMgYSBwcmVsaW1pbmFyeSB3b3JrIGZvciBzdXBwb3J0aW5nIG11bHRpcGxlIEVEUCBQU1Ig
YW5kCkRQIFBhbmVsUmVwbGF5LiBBbmQgaXQgcmVmYWN0b3JzIHNpbmdsZXRvbiBQU1IgdG8gTXVs
dGkgVHJhbnNjb2RlcgpzdXBwb3J0YWJsZSBQU1IuCkFuZCB0aGlzIG1vdmVzIGFuZCByZW5hbWVz
IHRoZSBpOTE1X3BzciBzdHJ1Y3R1cmUgb2YgZHJtX2k5MTVfcHJpdmF0ZSdzIHRvCmludGVsX2Rw
J3MgaW50ZWxfcHNyIHN0cnVjdHVyZS4KSXQgYWxzbyBjYXVzZXMgY2hhbmdlcyBpbiBQU1IgaW50
ZXJydXB0IGhhbmRsaW5nIHJvdXRpbmUgZm9yIHN1cHBvcnRpbmcKbXVsdGlwbGUgdHJhbnNjb2Rl
cnMuIEJ1dCBpdCBkb2VzIG5vdCBjaGFuZ2UgdGhlIHNjZW5hcmlvIGFuZCB0aW1pbmcgb2YKZW5h
YmxpbmcgYW5kIGRpc2FibGluZyBQU1IuIEFuZCBpdCBub3Qgc3VwcG9ydCBtdWx0aXBsZSBwaXBl
cyB3aXRoCmEgc2luZ2xlIHRyYW5zY29kZXIgUFNSIGNhc2UgeWV0LgoKdjI6IEZpeCBpbmRlbnRh
dGlvbiBhbmQgYWRkIGNvbW1lbnRzCnYzOiBSZW1vdmUgQmxhbmsgbGluZQp2NDogUmViYXNlZAp2
NTogUmViYXNlZCBhbmQgQWRkcmVzc2VkIEFuc2h1bWFuJ3MgcmV2aWV3IGNvbW1lbnQuCiAgICAt
IE1vdmUgY2FsbGluZyBvZiBpbnRlbF9wc3JfaW5pdCgpIHRvIGludGVsX2RwX2luaXRfY29ubmVj
dG9yKCkKdjY6IEFkZHJlc3MgQW5zaHVtYW4ncyByZXZpZXcgY29tbWVudHMKICAgLSBSZW1vdmUg
d3JvbmcgY29tbWVudHMgYW5kIGFkZCBjb21tZW50cyBmb3IgYSBsaW1pdCBvZiBzdXBwb3J0aW5n
IG9mCiAgICAgYSBzaW5nbGUgcGlwZSBQU1IKdjc6IFVwZGF0ZSBpbnRlbF9wc3JfY29tcHV0ZV9j
b25maWcoKSBmb3Igc3VwcG9ydGluZyBtdWx0aXBsZSB0cmFuc2NvZGVyCiAgICBQU1Igb24gQkRX
Kwp2ODogQWRkcmVzcyBBbnNodW1hbidzIHJldmlldyBjb21tZW50cwogICAtIFJlcGxhY2UgRFJN
X0RFQlVHX0tNUyB3aXRoIGRybV9kYmdfa21zKCkgLyBEUk1fV0FSTiB3aXRoIGRybV93YXJuKCkK
djk6IEZpeCBjb21taXQgbWVzc2FnZQp2MTA6IFJlYmFzZWQKdjExOiBBZGRyZXNzIEpvc2UncyBy
ZXZpZXcgY29tbWVudC4KICAtIFJlb3JkZXIgY2FsbGluZyBvcmRlciBvZiBpbnRlbF9wc3IyX3By
b2dyYW1fdHJhbnNfbWFuX3Rya19jdGwoKS4KICAtIEluIG9yZGVyIHRvIHJlZHVjZSBjaGFuZ2Vz
IGtlZXAgdGhlIG9sZCBuYW1lIGZvciBkcm1faTkxNV9wcml2YXRlLgogIC0gQ2hhbmdlIHJlc3Ry
aWN0aW9ucyBvZiBtdWx0aXBsZSBpbnN0YW5jZXMgb2YgUFNSLgp2MTI6IEFkZHJlc3MgSm9zZSdz
IHJldmlldyBjb21tZW50LgogIC0gQ2hhbmdlIHRoZSBjYWxsaW5nIG9mIGludGVsX3BzcjJfcHJv
Z3JhbV90cmFuc19tYW5fdHJrX2N0bCgpIGludG8KICAgIGNvbW1pdF9waXBlX2NvbmZpZygpLgog
IC0gQ2hhbmdlIGEgY2hlY2tpbmcgb3JkZXIgb2YgQ0FOX1BTUigpIGFuZCBjb25uZWN0b3Jfc3Rh
dHVzIHRvIG9yaWdpbmFsCiAgICBvbiBpOTE1X3Bzcl9zaW5rX3N0YXR1c19zaG93KCkuCiAgLSBE
cm9wIHVubmVlZGVkIGludGVsX2RwX3VwZGF0ZV9waXBlKCkgZnVuY3Rpb24uCiAgLSBJbiBvcmRl
ciB0byB3YWl0IGEgc3BlY2lmaWMgZW5jb2RlciB3aGljaCBiZWxvbmcgdG8gY3J0Y19zdGF0ZSBv
bgogICAgaW50ZWxfcHNyX3dhaXRfZm9yX2lkbGUoKSwgYWRkIGNoZWNraW5nIG9mIGVuY29kZXIu
CiAgLSBBZGQgYW4gd2hpdGVzcGFjZSB0byBjb21tZW50cy4KClNpZ25lZC1vZmYtYnk6IEd3YW4t
Z3llb25nIE11biA8Z3dhbi1neWVvbmcubXVuQGludGVsLmNvbT4KQ2M6IEpvc8OpIFJvYmVydG8g
ZGUgU291emEgPGpvc2Uuc291emFAaW50ZWwuY29tPgpDYzogSnVoYS1QZWtrYSBIZWlra2lsYSA8
anVoYXBla2thLmhlaWtraWxhQGdtYWlsLmNvbT4KQ2M6IEFuc2h1bWFuIEd1cHRhIDxhbnNodW1h
bi5ndXB0YUBpbnRlbC5jb20+ClJldmlld2VkLWJ5OiBBbnNodW1hbiBHdXB0YSA8YW5zaHVtYW4u
Z3VwdGFAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGlzcGxheS5jICB8ICAgMiAtCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X2Rl
YnVnZnMuYyAgfCAxMDUgKysrLQogLi4uL2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90
eXBlcy5oICAgIHwgIDM4ICsrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rw
LmMgICAgICAgfCAgMTAgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNy
LmMgICAgICB8IDU4NSArKysrKysrKysrLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfcHNyLmggICAgICB8ICAxMSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9zcHJpdGUuYyAgIHwgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2Rydi5oICAgICAgICAgICAgICAgfCAgMzggLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
aXJxLmMgICAgICAgICAgICAgICB8ICA0OSArLQogOSBmaWxlcyBjaGFuZ2VkLCA0NzcgaW5zZXJ0
aW9ucygrKSwgMzY3IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggNzM3M2Y1NGIyMTZlLi43NWMxYzUxMzk5NjUgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBAIC0xNDA1OSw4
ICsxNDA1OSw2IEBAIHN0YXRpYyB2b2lkIGludGVsX3NldHVwX291dHB1dHMoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlpbnRlbF9kdm9faW5pdChkZXZfcHJpdik7CiAJfQog
Ci0JaW50ZWxfcHNyX2luaXQoZGV2X3ByaXYpOwotCiAJZm9yX2VhY2hfaW50ZWxfZW5jb2Rlcigm
ZGV2X3ByaXYtPmRybSwgZW5jb2RlcikgewogCQllbmNvZGVyLT5iYXNlLnBvc3NpYmxlX2NydGNz
ID0KIAkJCWludGVsX2VuY29kZXJfcG9zc2libGVfY3J0Y3MoZW5jb2Rlcik7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfZGVidWdmcy5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X2RlYnVnZnMuYwppbmRl
eCBjZDdlNTUxOWVlN2QuLjJiMTcwOGUxM2NiYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X2RlYnVnZnMuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfZGVidWdmcy5jCkBAIC0yNDksMTIgKzI0OSwx
MSBAQCBzdGF0aWMgaW50IGk5MTVfcHNyX3Npbmtfc3RhdHVzX3Nob3coc3RydWN0IHNlcV9maWxl
ICptLCB2b2lkICpkYXRhKQogCQkic2luayBpbnRlcm5hbCBlcnJvciIsCiAJfTsKIAlzdHJ1Y3Qg
ZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yID0gbS0+cHJpdmF0ZTsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNvbm5lY3Rvci0+ZGV2KTsKIAlzdHJ1Y3QgaW50
ZWxfZHAgKmludGVsX2RwID0KIAkJaW50ZWxfYXR0YWNoZWRfZHAodG9faW50ZWxfY29ubmVjdG9y
KGNvbm5lY3RvcikpOwogCWludCByZXQ7CiAKLQlpZiAoIUNBTl9QU1IoZGV2X3ByaXYpKSB7CisJ
aWYgKCFDQU5fUFNSKGludGVsX2RwKSkgewogCQlzZXFfcHV0cyhtLCAiUFNSIFVuc3VwcG9ydGVk
XG4iKTsKIAkJcmV0dXJuIC1FTk9ERVY7CiAJfQpAQCAtMjgwLDEyICsyNzksMTMgQEAgc3RhdGlj
IGludCBpOTE1X3Bzcl9zaW5rX3N0YXR1c19zaG93KHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAq
ZGF0YSkKIERFRklORV9TSE9XX0FUVFJJQlVURShpOTE1X3Bzcl9zaW5rX3N0YXR1cyk7CiAKIHN0
YXRpYyB2b2lkCi1wc3Jfc291cmNlX3N0YXR1cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsIHN0cnVjdCBzZXFfZmlsZSAqbSkKK3Bzcl9zb3VyY2Vfc3RhdHVzKHN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHAsIHN0cnVjdCBzZXFfZmlsZSAqbSkKIHsKIAl1MzIgdmFsLCBzdGF0dXNf
dmFsOwogCWNvbnN0IGNoYXIgKnN0YXR1cyA9ICJ1bmtub3duIjsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAotCWlmIChkZXZfcHJp
di0+cHNyLnBzcjJfZW5hYmxlZCkgeworCWlmIChpbnRlbF9kcC0+cHNyLnBzcjJfZW5hYmxlZCkg
ewogCQlzdGF0aWMgY29uc3QgY2hhciAqIGNvbnN0IGxpdmVfc3RhdHVzW10gPSB7CiAJCQkiSURM
RSIsCiAJCQkiQ0FQVFVSRSIsCkBAIC0zMDAsNyArMzAwLDcgQEAgcHNyX3NvdXJjZV9zdGF0dXMo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBzdHJ1Y3Qgc2VxX2ZpbGUgKm0pCiAJ
CQkiVEdfT04iCiAJCX07CiAJCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsCi0JCQkJICAg
IEVEUF9QU1IyX1NUQVRVUyhkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpKTsKKwkJCQkgICAgRURQ
X1BTUjJfU1RBVFVTKGludGVsX2RwLT5wc3IudHJhbnNjb2RlcikpOwogCQlzdGF0dXNfdmFsID0g
KHZhbCAmIEVEUF9QU1IyX1NUQVRVU19TVEFURV9NQVNLKSA+PgogCQkJICAgICAgRURQX1BTUjJf
U1RBVFVTX1NUQVRFX1NISUZUOwogCQlpZiAoc3RhdHVzX3ZhbCA8IEFSUkFZX1NJWkUobGl2ZV9z
dGF0dXMpKQpAQCAtMzE3LDcgKzMxNyw3IEBAIHBzcl9zb3VyY2Vfc3RhdHVzKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwgc3RydWN0IHNlcV9maWxlICptKQogCQkJIlNSREVOVF9P
TiIsCiAJCX07CiAJCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsCi0JCQkJICAgIEVEUF9Q
U1JfU1RBVFVTKGRldl9wcml2LT5wc3IudHJhbnNjb2RlcikpOworCQkJCSAgICBFRFBfUFNSX1NU
QVRVUyhpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpKTsKIAkJc3RhdHVzX3ZhbCA9ICh2YWwgJiBF
RFBfUFNSX1NUQVRVU19TVEFURV9NQVNLKSA+PgogCQkJICAgICAgRURQX1BTUl9TVEFUVVNfU1RB
VEVfU0hJRlQ7CiAJCWlmIChzdGF0dXNfdmFsIDwgQVJSQVlfU0laRShsaXZlX3N0YXR1cykpCkBA
IC0zMjcsMjEgKzMyNywxOCBAQCBwc3Jfc291cmNlX3N0YXR1cyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsIHN0cnVjdCBzZXFfZmlsZSAqbSkKIAlzZXFfcHJpbnRmKG0sICJTb3Vy
Y2UgUFNSIHN0YXR1czogJXMgWzB4JTA4eF1cbiIsIHN0YXR1cywgdmFsKTsKIH0KIAotc3RhdGlj
IGludCBpOTE1X2VkcF9wc3Jfc3RhdHVzKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkK
K3N0YXRpYyBpbnQgaW50ZWxfcHNyX3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHN0cnVjdCBp
bnRlbF9kcCAqaW50ZWxfZHApCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOwotCXN0cnVjdCBpOTE1X3BzciAqcHNyID0gJmRl
dl9wcml2LT5wc3I7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9f
aTkxNShpbnRlbF9kcCk7CisJc3RydWN0IGludGVsX3BzciAqcHNyID0gJmludGVsX2RwLT5wc3I7
CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJY29uc3QgY2hhciAqc3RhdHVzOwogCWJvb2wg
ZW5hYmxlZDsKIAl1MzIgdmFsOwogCi0JaWYgKCFIQVNfUFNSKGRldl9wcml2KSkKLQkJcmV0dXJu
IC1FTk9ERVY7Ci0KIAlzZXFfcHJpbnRmKG0sICJTaW5rIHN1cHBvcnQ6ICVzIiwgeWVzbm8ocHNy
LT5zaW5rX3N1cHBvcnQpKTsKLQlpZiAocHNyLT5kcCkKLQkJc2VxX3ByaW50ZihtLCAiIFsweCUw
MnhdIiwgcHNyLT5kcC0+cHNyX2RwY2RbMF0pOworCWlmIChwc3ItPnNpbmtfc3VwcG9ydCkKKwkJ
c2VxX3ByaW50ZihtLCAiIFsweCUwMnhdIiwgaW50ZWxfZHAtPnBzcl9kcGNkWzBdKTsKIAlzZXFf
cHV0cyhtLCAiXG4iKTsKIAogCWlmICghcHNyLT5zaW5rX3N1cHBvcnQpCkBAIC0zNjUsMTYgKzM2
MiwxNiBAQCBzdGF0aWMgaW50IGk5MTVfZWRwX3Bzcl9zdGF0dXMoc3RydWN0IHNlcV9maWxlICpt
LCB2b2lkICpkYXRhKQogCiAJaWYgKHBzci0+cHNyMl9lbmFibGVkKSB7CiAJCXZhbCA9IGludGVs
X2RlX3JlYWQoZGV2X3ByaXYsCi0JCQkJICAgIEVEUF9QU1IyX0NUTChkZXZfcHJpdi0+cHNyLnRy
YW5zY29kZXIpKTsKKwkJCQkgICAgRURQX1BTUjJfQ1RMKGludGVsX2RwLT5wc3IudHJhbnNjb2Rl
cikpOwogCQllbmFibGVkID0gdmFsICYgRURQX1BTUjJfRU5BQkxFOwogCX0gZWxzZSB7CiAJCXZh
bCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsCi0JCQkJICAgIEVEUF9QU1JfQ1RMKGRldl9wcml2
LT5wc3IudHJhbnNjb2RlcikpOworCQkJCSAgICBFRFBfUFNSX0NUTChpbnRlbF9kcC0+cHNyLnRy
YW5zY29kZXIpKTsKIAkJZW5hYmxlZCA9IHZhbCAmIEVEUF9QU1JfRU5BQkxFOwogCX0KIAlzZXFf
cHJpbnRmKG0sICJTb3VyY2UgUFNSIGN0bDogJXMgWzB4JTA4eF1cbiIsCiAJCSAgIGVuYWJsZWRk
aXNhYmxlZChlbmFibGVkKSwgdmFsKTsKLQlwc3Jfc291cmNlX3N0YXR1cyhkZXZfcHJpdiwgbSk7
CisJcHNyX3NvdXJjZV9zdGF0dXMoaW50ZWxfZHAsIG0pOwogCXNlcV9wcmludGYobSwgIkJ1c3kg
ZnJvbnRidWZmZXIgYml0czogMHglMDh4XG4iLAogCQkgICBwc3ItPmJ1c3lfZnJvbnRidWZmZXJf
Yml0cyk7CiAKQEAgLTM4Myw3ICszODAsNyBAQCBzdGF0aWMgaW50IGk5MTVfZWRwX3Bzcl9zdGF0
dXMoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCSAqLwogCWlmIChJU19IQVNXRUxM
KGRldl9wcml2KSB8fCBJU19CUk9BRFdFTEwoZGV2X3ByaXYpKSB7CiAJCXZhbCA9IGludGVsX2Rl
X3JlYWQoZGV2X3ByaXYsCi0JCQkJICAgIEVEUF9QU1JfUEVSRl9DTlQoZGV2X3ByaXYtPnBzci50
cmFuc2NvZGVyKSk7CisJCQkJICAgIEVEUF9QU1JfUEVSRl9DTlQoaW50ZWxfZHAtPnBzci50cmFu
c2NvZGVyKSk7CiAJCXZhbCAmPSBFRFBfUFNSX1BFUkZfQ05UX01BU0s7CiAJCXNlcV9wcmludGYo
bSwgIlBlcmZvcm1hbmNlIGNvdW50ZXI6ICV1XG4iLCB2YWwpOwogCX0KQEAgLTQwNCw3ICs0MDEs
NyBAQCBzdGF0aWMgaW50IGk5MTVfZWRwX3Bzcl9zdGF0dXMoc3RydWN0IHNlcV9maWxlICptLCB2
b2lkICpkYXRhKQogCQkgKi8KIAkJZm9yIChmcmFtZSA9IDA7IGZyYW1lIDwgUFNSMl9TVV9TVEFU
VVNfRlJBTUVTOyBmcmFtZSArPSAzKSB7CiAJCQl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2
LAotCQkJCQkgICAgUFNSMl9TVV9TVEFUVVMoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyLCBmcmFt
ZSkpOworCQkJCQkgICAgUFNSMl9TVV9TVEFUVVMoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyLCBm
cmFtZSkpOwogCQkJc3VfZnJhbWVzX3ZhbFtmcmFtZSAvIDNdID0gdmFsOwogCQl9CiAKQEAgLTQz
MCwyMyArNDI3LDU3IEBAIHN0YXRpYyBpbnQgaTkxNV9lZHBfcHNyX3N0YXR1cyhzdHJ1Y3Qgc2Vx
X2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAJcmV0dXJuIDA7CiB9CiAKK3N0YXRpYyBpbnQgaTkxNV9l
ZHBfcHNyX3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCit7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOwor
CXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyOworCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHAgPSBOVUxMOworCisJaWYgKCFIQVNfUFNSKGRldl9wcml2KSkKKwkJcmV0dXJuIC1FTk9ERVY7
CisKKwkvKiBGaW5kIHRoZSBmaXJzdCBFRFAgKi8KKwlmb3JfZWFjaF9pbnRlbF9kcCgmZGV2X3By
aXYtPmRybSwgZW5jb2RlcikgeworCQlpZiAoZW5jb2Rlci0+dHlwZSA9PSBJTlRFTF9PVVRQVVRf
RURQKSB7CisJCQlpbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcChlbmNvZGVyKTsKKwkJCWJyZWFr
OworCQl9CisJfQorCisJaWYgKCFpbnRlbF9kcCkKKwkJcmV0dXJuIC1FTk9ERVY7CisKKwlyZXR1
cm4gaW50ZWxfcHNyX3N0YXR1cyhtLCBpbnRlbF9kcCk7Cit9CisKIHN0YXRpYyBpbnQKIGk5MTVf
ZWRwX3Bzcl9kZWJ1Z19zZXQodm9pZCAqZGF0YSwgdTY0IHZhbCkKIHsKIAlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkYXRhOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwot
CWludCByZXQ7CisJaW50IHJldCA9IC1FTk9ERVY7CisJc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXI7CiAKLQlpZiAoIUNBTl9QU1IoZGV2X3ByaXYpKQotCQlyZXR1cm4gLUVOT0RFVjsKKwlp
ZiAoIUhBU19QU1IoZGV2X3ByaXYpKQorCQlyZXR1cm4gcmV0OwogCi0JZHJtX2RiZ19rbXMoJmRl
dl9wcml2LT5kcm0sICJTZXR0aW5nIFBTUiBkZWJ1ZyB0byAlbGx4XG4iLCB2YWwpOworCWZvcl9l
YWNoX2ludGVsX2RwKCZkZXZfcHJpdi0+ZHJtLCBlbmNvZGVyKSB7CisJCXN0cnVjdCBpbnRlbF9k
cCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5jb2Rlcik7CiAKLQl3YWtlcmVmID0gaW50
ZWxfcnVudGltZV9wbV9nZXQoJmRldl9wcml2LT5ydW50aW1lX3BtKTsKKwkJaWYgKCFDQU5fUFNS
KGludGVsX2RwKSkKKwkJCWNvbnRpbnVlOwogCi0JcmV0ID0gaW50ZWxfcHNyX2RlYnVnX3NldChk
ZXZfcHJpdiwgdmFsKTsKKwkJaWYgKGVuY29kZXItPnR5cGUgPT0gSU5URUxfT1VUUFVUX0VEUCkg
eworCQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJTZXR0aW5nIFBTUiBkZWJ1ZyB0byAl
bGx4XG4iLCB2YWwpOwogCi0JaW50ZWxfcnVudGltZV9wbV9wdXQoJmRldl9wcml2LT5ydW50aW1l
X3BtLCB3YWtlcmVmKTsKKwkJCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldCgmZGV2X3By
aXYtPnJ1bnRpbWVfcG0pOworCisJCQkvLyBUT0RPOiBzcGxpdCB0byBlYWNoIHRyYW5zY29kZXIn
cyBQU1IgZGVidWcgc3RhdGUKKwkJCXJldCA9IGludGVsX3Bzcl9kZWJ1Z19zZXQoaW50ZWxfZHAs
IHZhbCk7CisKKwkJCWludGVsX3J1bnRpbWVfcG1fcHV0KCZkZXZfcHJpdi0+cnVudGltZV9wbSwg
d2FrZXJlZik7CisJCX0KKwl9CiAKIAlyZXR1cm4gcmV0OwogfQpAQCAtNDU1LDEyICs0ODYsMjUg
QEAgc3RhdGljIGludAogaTkxNV9lZHBfcHNyX2RlYnVnX2dldCh2b2lkICpkYXRhLCB1NjQgKnZh
bCkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkYXRhOworCXN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyOwogCi0JaWYgKCFDQU5fUFNSKGRldl9wcml2KSkKKwlp
ZiAoIUhBU19QU1IoZGV2X3ByaXYpKQogCQlyZXR1cm4gLUVOT0RFVjsKIAotCSp2YWwgPSBSRUFE
X09OQ0UoZGV2X3ByaXYtPnBzci5kZWJ1Zyk7Ci0JcmV0dXJuIDA7CisJZm9yX2VhY2hfaW50ZWxf
ZHAoJmRldl9wcml2LT5kcm0sIGVuY29kZXIpIHsKKwkJc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCA9IGVuY190b19pbnRlbF9kcChlbmNvZGVyKTsKKworCQlpZiAoIUNBTl9QU1IoaW50ZWxfZHAp
KQorCQkJY29udGludWU7CisKKwkJLy8gVE9ETzogc3BsaXQgdG8gZWFjaCB0cmFuc2NvZGVyJ3Mg
UFNSIGRlYnVnIHN0YXRlCisJCWlmIChlbmNvZGVyLT50eXBlID09IElOVEVMX09VVFBVVF9FRFAp
IHsKKwkJCSp2YWwgPSBSRUFEX09OQ0UoaW50ZWxfZHAtPnBzci5kZWJ1Zyk7CisJCQlyZXR1cm4g
MDsKKwkJfQorCX0KKworCXJldHVybiAtRU5PREVWOwogfQogCiBERUZJTkVfU0lNUExFX0FUVFJJ
QlVURShpOTE1X2VkcF9wc3JfZGVidWdfZm9wcywKQEAgLTEyMzQsOSArMTI3OCw2IEBAIHN0YXRp
YyB2b2lkIGRycnNfc3RhdHVzX3Blcl9jcnRjKHN0cnVjdCBzZXFfZmlsZSAqbSwKIAkJLyogZGlz
YWJsZV9kcnJzKCkgd2lsbCBtYWtlIGRycnMtPmRwIE5VTEwgKi8KIAkJaWYgKCFkcnJzLT5kcCkg
ewogCQkJc2VxX3B1dHMobSwgIklkbGVuZXNzIERSUlM6IERpc2FibGVkXG4iKTsKLQkJCWlmIChk
ZXZfcHJpdi0+cHNyLmVuYWJsZWQpCi0JCQkJc2VxX3B1dHMobSwKLQkJCQkiXHRBcyBQU1IgaXMg
ZW5hYmxlZCwgRFJSUyBpcyBub3QgZW5hYmxlZFxuIik7CiAJCQltdXRleF91bmxvY2soJmRycnMt
Pm11dGV4KTsKIAkJCXJldHVybjsKIAkJfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaAppbmRleCBiNjAxZTgwNGY4NTQuLmI2MGY3YmJi
NGU2NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5X3R5cGVzLmgKQEAgLTEzNjksNiArMTM2OSw0MiBAQCBzdHJ1Y3QgaW50ZWxfZHBfcGNvbl9m
cmwgewogCWludCB0cmFpbmVkX3JhdGVfZ2JwczsKIH07CiAKK3N0cnVjdCBpbnRlbF9wc3Igewor
CS8qIE11dGV4IGZvciBQU1Igc3RhdGUgb2YgdGhlIHRyYW5zY29kZXIgKi8KKwlzdHJ1Y3QgbXV0
ZXggbG9jazsKKworI2RlZmluZSBJOTE1X1BTUl9ERUJVR19NT0RFX01BU0sJMHgwZgorI2RlZmlu
ZSBJOTE1X1BTUl9ERUJVR19ERUZBVUxUCQkweDAwCisjZGVmaW5lIEk5MTVfUFNSX0RFQlVHX0RJ
U0FCTEUJCTB4MDEKKyNkZWZpbmUgSTkxNV9QU1JfREVCVUdfRU5BQkxFCQkweDAyCisjZGVmaW5l
IEk5MTVfUFNSX0RFQlVHX0ZPUkNFX1BTUjEJMHgwMworI2RlZmluZSBJOTE1X1BTUl9ERUJVR19J
UlEJCTB4MTAKKworCXUzMiBkZWJ1ZzsKKwlib29sIHNpbmtfc3VwcG9ydDsKKwlib29sIGVuYWJs
ZWQ7CisJZW51bSBwaXBlIHBpcGU7CisJZW51bSB0cmFuc2NvZGVyIHRyYW5zY29kZXI7CisJYm9v
bCBhY3RpdmU7CisJc3RydWN0IHdvcmtfc3RydWN0IHdvcms7CisJdW5zaWduZWQgaW50IGJ1c3lf
ZnJvbnRidWZmZXJfYml0czsKKwlib29sIHNpbmtfcHNyMl9zdXBwb3J0OworCWJvb2wgbGlua19z
dGFuZGJ5OworCWJvb2wgY29sb3JpbWV0cnlfc3VwcG9ydDsKKwlib29sIHBzcjJfZW5hYmxlZDsK
Kwlib29sIHBzcjJfc2VsX2ZldGNoX2VuYWJsZWQ7CisJdTggc2lua19zeW5jX2xhdGVuY3k7CisJ
a3RpbWVfdCBsYXN0X2VudHJ5X2F0dGVtcHQ7CisJa3RpbWVfdCBsYXN0X2V4aXQ7CisJYm9vbCBz
aW5rX25vdF9yZWxpYWJsZTsKKwlib29sIGlycV9hdXhfZXJyb3I7CisJdTE2IHN1X3hfZ3JhbnVs
YXJpdHk7CisJYm9vbCBkYzNjb19lbmFibGVkOworCXUzMiBkYzNjb19leGl0X2RlbGF5OworCXN0
cnVjdCBkZWxheWVkX3dvcmsgZGMzY29fd29yazsKKwlzdHJ1Y3QgZHJtX2RwX3ZzY19zZHAgdnNj
OworfTsKKwogc3RydWN0IGludGVsX2RwIHsKIAlpOTE1X3JlZ190IG91dHB1dF9yZWc7CiAJdTMy
IERQOwpAQCAtMTQ5OCw2ICsxNTM0LDggQEAgc3RydWN0IGludGVsX2RwIHsKIAlib29sIGhvYmxf
YWN0aXZlOwogCiAJc3RydWN0IGludGVsX2RwX3Bjb25fZnJsIGZybDsKKworCXN0cnVjdCBpbnRl
bF9wc3IgcHNyOwogfTsKIAogZW51bSBsc3Bjb25fdmVuZG9yIHsKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZHAuYwppbmRleCA4YjljMjA1NTVmMGUuLjE5NDAwMGQ1N2MxZCAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYwpAQCAtMjM0MCwxMiArMjM0MCwx
MCBAQCB2b2lkIGludGVsX2RwX2NvbXB1dGVfcHNyX3ZzY19zZHAoc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCwKIAkJCQkgIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0
YXRlLAogCQkJCSAgc3RydWN0IGRybV9kcF92c2Nfc2RwICp2c2MpCiB7Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7Ci0KIAl2c2MtPnNk
cF90eXBlID0gRFBfU0RQX1ZTQzsKIAotCWlmIChkZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxlZCkg
ewotCQlpZiAoZGV2X3ByaXYtPnBzci5jb2xvcmltZXRyeV9zdXBwb3J0ICYmCisJaWYgKGludGVs
X2RwLT5wc3IucHNyMl9lbmFibGVkKSB7CisJCWlmIChpbnRlbF9kcC0+cHNyLmNvbG9yaW1ldHJ5
X3N1cHBvcnQgJiYKIAkJICAgIGludGVsX2RwX25lZWRzX3ZzY19zZHAoY3J0Y19zdGF0ZSwgY29u
bl9zdGF0ZSkpIHsKIAkJCS8qIFtQU1IyLCArQ29sb3JpbWV0cnldICovCiAJCQlpbnRlbF9kcF9j
b21wdXRlX3ZzY19jb2xvcmltZXRyeShjcnRjX3N0YXRlLCBjb25uX3N0YXRlLApAQCAtMzAzMiw3
ICszMDMwLDcgQEAgYm9vbCBpbnRlbF9kcF9pbml0aWFsX2Zhc3RzZXRfY2hlY2soc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCXJldHVybiBmYWxzZTsKIAl9CiAKLQlpZiAoQ0FOX1BT
UihpOTE1KSAmJiBpbnRlbF9kcF9pc19lZHAoaW50ZWxfZHApKSB7CisJaWYgKENBTl9QU1IoaW50
ZWxfZHApICYmIGludGVsX2RwX2lzX2VkcChpbnRlbF9kcCkpIHsKIAkJZHJtX2RiZ19rbXMoJmk5
MTUtPmRybSwgIkZvcmNpbmcgZnVsbCBtb2Rlc2V0IHRvIGNvbXB1dGUgUFNSIHN0YXRlXG4iKTsK
IAkJY3J0Y19zdGF0ZS0+dWFwaS5tb2RlX2NoYW5nZWQgPSB0cnVlOwogCQlyZXR1cm4gZmFsc2U7
CkBAIC03MzA3LDYgKzczMDUsOCBAQCBpbnRlbF9kcF9pbml0X2Nvbm5lY3RvcihzdHJ1Y3QgaW50
ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCwKIAlpbnRlbF9kcC0+ZnJsLmlzX3RyYWluZWQgPSBm
YWxzZTsKIAlpbnRlbF9kcC0+ZnJsLnRyYWluZWRfcmF0ZV9nYnBzID0gMDsKIAorCWludGVsX3Bz
cl9pbml0KGludGVsX2RwKTsKKwogCXJldHVybiB0cnVlOwogCiBmYWlsOgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmMKaW5kZXggMWU2YzFmYTU5ZDRhLi5kYjc1MWQ2NzU0
ODggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYwpAQCAtNzksOSAr
NzksMTEgQEAKICAqIHVzZSBwYWdlIGZsaXBzLgogICovCiAKLXN0YXRpYyBib29sIHBzcl9nbG9i
YWxfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3N0YXRpYyBib29sIHBz
cl9nbG9iYWxfZW5hYmxlZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewotCXN3aXRjaCAo
aTkxNS0+cHNyLmRlYnVnICYgSTkxNV9QU1JfREVCVUdfTU9ERV9NQVNLKSB7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKworCXN3aXRjaCAo
aW50ZWxfZHAtPnBzci5kZWJ1ZyAmIEk5MTVfUFNSX0RFQlVHX01PREVfTUFTSykgewogCWNhc2Ug
STkxNV9QU1JfREVCVUdfREVGQVVMVDoKIAkJcmV0dXJuIGk5MTUtPnBhcmFtcy5lbmFibGVfcHNy
OwogCWNhc2UgSTkxNV9QU1JfREVCVUdfRElTQUJMRToKQEAgLTkxLDkgKzkzLDkgQEAgc3RhdGlj
IGJvb2wgcHNyX2dsb2JhbF9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
CX0KIH0KIAotc3RhdGljIGJvb2wgcHNyMl9nbG9iYWxfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgYm9vbCBwc3IyX2dsb2JhbF9lbmFibGVkKHN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7Ci0Jc3dpdGNoIChkZXZfcHJpdi0+cHNyLmRlYnVnICYg
STkxNV9QU1JfREVCVUdfTU9ERV9NQVNLKSB7CisJc3dpdGNoIChpbnRlbF9kcC0+cHNyLmRlYnVn
ICYgSTkxNV9QU1JfREVCVUdfTU9ERV9NQVNLKSB7CiAJY2FzZSBJOTE1X1BTUl9ERUJVR19ESVNB
QkxFOgogCWNhc2UgSTkxNV9QU1JfREVCVUdfRk9SQ0VfUFNSMToKIAkJcmV0dXJuIGZhbHNlOwpA
QCAtMTAyLDExICsxMDQsMTIgQEAgc3RhdGljIGJvb2wgcHNyMl9nbG9iYWxfZW5hYmxlZChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJfQogfQogCi1zdGF0aWMgdm9pZCBwc3Jf
aXJxX2NvbnRyb2woc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZv
aWQgcHNyX2lycV9jb250cm9sKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CiAJZW51bSB0
cmFuc2NvZGVyIHRyYW5zX3NoaWZ0OwogCXUzMiBtYXNrLCB2YWw7CiAJaTkxNV9yZWdfdCBpbXJf
cmVnOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50
ZWxfZHApOwogCiAJLyoKIAkgKiBnZW4xMisgaGFzIHJlZ2lzdGVycyByZWxhdGl2ZSB0byB0cmFu
c2NvZGVyIGFuZCBvbmUgcGVyIHRyYW5zY29kZXIKQEAgLTExNSwxNCArMTE4LDE0IEBAIHN0YXRp
YyB2b2lkIHBzcl9pcnFfY29udHJvbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiAJICovCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpIHsKIAkJdHJhbnNfc2hpZnQg
PSAwOwotCQlpbXJfcmVnID0gVFJBTlNfUFNSX0lNUihkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIp
OworCQlpbXJfcmVnID0gVFJBTlNfUFNSX0lNUihpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpOwog
CX0gZWxzZSB7Ci0JCXRyYW5zX3NoaWZ0ID0gZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyOworCQl0
cmFuc19zaGlmdCA9IGludGVsX2RwLT5wc3IudHJhbnNjb2RlcjsKIAkJaW1yX3JlZyA9IEVEUF9Q
U1JfSU1SOwogCX0KIAogCW1hc2sgPSBFRFBfUFNSX0VSUk9SKHRyYW5zX3NoaWZ0KTsKLQlpZiAo
ZGV2X3ByaXYtPnBzci5kZWJ1ZyAmIEk5MTVfUFNSX0RFQlVHX0lSUSkKKwlpZiAoaW50ZWxfZHAt
PnBzci5kZWJ1ZyAmIEk5MTVfUFNSX0RFQlVHX0lSUSkKIAkJbWFzayB8PSBFRFBfUFNSX1BPU1Rf
RVhJVCh0cmFuc19zaGlmdCkgfAogCQkJRURQX1BTUl9QUkVfRU5UUlkodHJhbnNfc2hpZnQpOwog
CkBAIC0xNzEsMzAgKzE3NCwzMSBAQCBzdGF0aWMgdm9pZCBwc3JfZXZlbnRfcHJpbnQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCWRybV9kYmdfa21zKCZpOTE1LT5kcm0sICJcdFBT
UiBkaXNhYmxlZFxuIik7CiB9CiAKLXZvaWQgaW50ZWxfcHNyX2lycV9oYW5kbGVyKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIHBzcl9paXIpCit2b2lkIGludGVsX3Bzcl9p
cnFfaGFuZGxlcihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCB1MzIgcHNyX2lpcikKIHsKLQll
bnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIgPSBkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXI7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9k
cCk7CisJZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyID0gaW50ZWxfZHAtPnBzci50cmFu
c2NvZGVyOwogCWVudW0gdHJhbnNjb2RlciB0cmFuc19zaGlmdDsKIAlpOTE1X3JlZ190IGltcl9y
ZWc7CiAJa3RpbWVfdCB0aW1lX25zID0gIGt0aW1lX2dldCgpOwogCiAJaWYgKElOVEVMX0dFTihk
ZXZfcHJpdikgPj0gMTIpIHsKIAkJdHJhbnNfc2hpZnQgPSAwOwotCQlpbXJfcmVnID0gVFJBTlNf
UFNSX0lNUihkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpOworCQlpbXJfcmVnID0gVFJBTlNfUFNS
X0lNUihpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpOwogCX0gZWxzZSB7Ci0JCXRyYW5zX3NoaWZ0
ID0gZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyOworCQl0cmFuc19zaGlmdCA9IGludGVsX2RwLT5w
c3IudHJhbnNjb2RlcjsKIAkJaW1yX3JlZyA9IEVEUF9QU1JfSU1SOwogCX0KIAogCWlmIChwc3Jf
aWlyICYgRURQX1BTUl9QUkVfRU5UUlkodHJhbnNfc2hpZnQpKSB7Ci0JCWRldl9wcml2LT5wc3Iu
bGFzdF9lbnRyeV9hdHRlbXB0ID0gdGltZV9uczsKKwkJaW50ZWxfZHAtPnBzci5sYXN0X2VudHJ5
X2F0dGVtcHQgPSB0aW1lX25zOwogCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKIAkJCSAg
ICAiW3RyYW5zY29kZXIgJXNdIFBTUiBlbnRyeSBhdHRlbXB0IGluIDIgdmJsYW5rc1xuIiwKIAkJ
CSAgICB0cmFuc2NvZGVyX25hbWUoY3B1X3RyYW5zY29kZXIpKTsKIAl9CiAKIAlpZiAocHNyX2lp
ciAmIEVEUF9QU1JfUE9TVF9FWElUKHRyYW5zX3NoaWZ0KSkgewotCQlkZXZfcHJpdi0+cHNyLmxh
c3RfZXhpdCA9IHRpbWVfbnM7CisJCWludGVsX2RwLT5wc3IubGFzdF9leGl0ID0gdGltZV9uczsK
IAkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCiAJCQkgICAgIlt0cmFuc2NvZGVyICVzXSBQ
U1IgZXhpdCBjb21wbGV0ZWRcbiIsCiAJCQkgICAgdHJhbnNjb2Rlcl9uYW1lKGNwdV90cmFuc2Nv
ZGVyKSk7CkBAIC0yMDIsNyArMjA2LDcgQEAgdm9pZCBpbnRlbF9wc3JfaXJxX2hhbmRsZXIoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgcHNyX2lpcikKIAkJaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPj0gOSkgewogCQkJdTMyIHZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3By
aXYsCiAJCQkJCQlQU1JfRVZFTlQoY3B1X3RyYW5zY29kZXIpKTsKLQkJCWJvb2wgcHNyMl9lbmFi
bGVkID0gZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQ7CisJCQlib29sIHBzcjJfZW5hYmxlZCA9
IGludGVsX2RwLT5wc3IucHNyMl9lbmFibGVkOwogCiAJCQlpbnRlbF9kZV93cml0ZShkZXZfcHJp
diwgUFNSX0VWRU5UKGNwdV90cmFuc2NvZGVyKSwKIAkJCQkgICAgICAgdmFsKTsKQEAgLTIxNiw3
ICsyMjAsNyBAQCB2b2lkIGludGVsX3Bzcl9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsIHUzMiBwc3JfaWlyKQogCQlkcm1fd2FybigmZGV2X3ByaXYtPmRybSwg
Ilt0cmFuc2NvZGVyICVzXSBQU1IgYXV4IGVycm9yXG4iLAogCQkJIHRyYW5zY29kZXJfbmFtZShj
cHVfdHJhbnNjb2RlcikpOwogCi0JCWRldl9wcml2LT5wc3IuaXJxX2F1eF9lcnJvciA9IHRydWU7
CisJCWludGVsX2RwLT5wc3IuaXJxX2F1eF9lcnJvciA9IHRydWU7CiAKIAkJLyoKIAkJICogSWYg
dGhpcyBpbnRlcnJ1cHRpb24gaXMgbm90IG1hc2tlZCBpdCB3aWxsIGtlZXAKQEAgLTIzMCw3ICsy
MzQsNyBAQCB2b2lkIGludGVsX3Bzcl9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsIHUzMiBwc3JfaWlyKQogCQl2YWwgfD0gRURQX1BTUl9FUlJPUih0cmFuc19z
aGlmdCk7CiAJCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBpbXJfcmVnLCB2YWwpOwogCi0JCXNj
aGVkdWxlX3dvcmsoJmRldl9wcml2LT5wc3Iud29yayk7CisJCXNjaGVkdWxlX3dvcmsoJmludGVs
X2RwLT5wc3Iud29yayk7CiAJfQogfQogCkBAIC0yOTEsMTIgKzI5NSw2IEBAIHZvaWQgaW50ZWxf
cHNyX2luaXRfZHBjZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9CiAJCXRvX2k5MTUoZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHAp
LT5iYXNlLmJhc2UuZGV2KTsKIAotCWlmIChkZXZfcHJpdi0+cHNyLmRwKSB7Ci0JCWRybV93YXJu
KCZkZXZfcHJpdi0+ZHJtLAotCQkJICJNb3JlIHRoYW4gb25lIGVEUCBwYW5lbCBmb3VuZCwgUFNS
IHN1cHBvcnQgc2hvdWxkIGJlIGV4dGVuZGVkXG4iKTsKLQkJcmV0dXJuOwotCX0KLQogCWRybV9k
cF9kcGNkX3JlYWQoJmludGVsX2RwLT5hdXgsIERQX1BTUl9TVVBQT1JULCBpbnRlbF9kcC0+cHNy
X2RwY2QsCiAJCQkgc2l6ZW9mKGludGVsX2RwLT5wc3JfZHBjZCkpOwogCkBAIC0zMTcsMTIgKzMx
NSwxMCBAQCB2b2lkIGludGVsX3Bzcl9pbml0X2RwY2Qoc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCkKIAkJcmV0dXJuOwogCX0KIAotCWRldl9wcml2LT5wc3Iuc2lua19zdXBwb3J0ID0gdHJ1ZTsK
LQlkZXZfcHJpdi0+cHNyLnNpbmtfc3luY19sYXRlbmN5ID0KKwlpbnRlbF9kcC0+cHNyLnNpbmtf
c3VwcG9ydCA9IHRydWU7CisJaW50ZWxfZHAtPnBzci5zaW5rX3N5bmNfbGF0ZW5jeSA9CiAJCWlu
dGVsX2RwX2dldF9zaW5rX3N5bmNfbGF0ZW5jeShpbnRlbF9kcCk7CiAKLQlkZXZfcHJpdi0+cHNy
LmRwID0gaW50ZWxfZHA7Ci0KIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5ICYmCiAJICAg
IChpbnRlbF9kcC0+cHNyX2RwY2RbMF0gPT0gRFBfUFNSMl9XSVRIX1lfQ09PUkRfSVNfU1VQUE9S
VEVEKSkgewogCQlib29sIHlfcmVxID0gaW50ZWxfZHAtPnBzcl9kcGNkWzFdICYKQEAgLTM0MCwx
NCArMzM2LDE0IEBAIHZvaWQgaW50ZWxfcHNyX2luaXRfZHBjZChzdHJ1Y3QgaW50ZWxfZHAgKmlu
dGVsX2RwKQogCQkgKiBZLWNvb3JkaW5hdGUgcmVxdWlyZW1lbnQgcGFuZWxzIHdlIHdvdWxkIG5l
ZWQgdG8gZW5hYmxlCiAJCSAqIEdUQyBmaXJzdC4KIAkJICovCi0JCWRldl9wcml2LT5wc3Iuc2lu
a19wc3IyX3N1cHBvcnQgPSB5X3JlcSAmJiBhbHBtOworCQlpbnRlbF9kcC0+cHNyLnNpbmtfcHNy
Ml9zdXBwb3J0ID0geV9yZXEgJiYgYWxwbTsKIAkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0s
ICJQU1IyICVzc3VwcG9ydGVkXG4iLAotCQkJICAgIGRldl9wcml2LT5wc3Iuc2lua19wc3IyX3N1
cHBvcnQgPyAiIiA6ICJub3QgIik7CisJCQkgICAgaW50ZWxfZHAtPnBzci5zaW5rX3BzcjJfc3Vw
cG9ydCA/ICIiIDogIm5vdCAiKTsKIAotCQlpZiAoZGV2X3ByaXYtPnBzci5zaW5rX3BzcjJfc3Vw
cG9ydCkgewotCQkJZGV2X3ByaXYtPnBzci5jb2xvcmltZXRyeV9zdXBwb3J0ID0KKwkJaWYgKGlu
dGVsX2RwLT5wc3Iuc2lua19wc3IyX3N1cHBvcnQpIHsKKwkJCWludGVsX2RwLT5wc3IuY29sb3Jp
bWV0cnlfc3VwcG9ydCA9CiAJCQkJaW50ZWxfZHBfZ2V0X2NvbG9yaW1ldHJ5X3N0YXR1cyhpbnRl
bF9kcCk7Ci0JCQlkZXZfcHJpdi0+cHNyLnN1X3hfZ3JhbnVsYXJpdHkgPQorCQkJaW50ZWxfZHAt
PnBzci5zdV94X2dyYW51bGFyaXR5ID0KIAkJCQlpbnRlbF9kcF9nZXRfc3VfeF9ncmFudWxhcnRp
eShpbnRlbF9kcCk7CiAJCX0KIAl9CkBAIC0zNzMsNyArMzY5LDcgQEAgc3RhdGljIHZvaWQgaHN3
X3Bzcl9zZXR1cF9hdXgoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAlCVUlMRF9CVUdfT04o
c2l6ZW9mKGF1eF9tc2cpID4gMjApOwogCWZvciAoaSA9IDA7IGkgPCBzaXplb2YoYXV4X21zZyk7
IGkgKz0gNCkKIAkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsCi0JCQkgICAgICAgRURQX1BTUl9B
VVhfREFUQShkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIsIGkgPj4gMiksCisJCQkgICAgICAgRURQ
X1BTUl9BVVhfREFUQShpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIsIGkgPj4gMiksCiAJCQkgICAg
ICAgaW50ZWxfZHBfcGFja19hdXgoJmF1eF9tc2dbaV0sIHNpemVvZihhdXhfbXNnKSAtIGkpKTsK
IAogCWF1eF9jbG9ja19kaXZpZGVyID0gaW50ZWxfZHAtPmdldF9hdXhfY2xvY2tfZGl2aWRlcihp
bnRlbF9kcCwgMCk7CkBAIC0zODQsNyArMzgwLDcgQEAgc3RhdGljIHZvaWQgaHN3X3Bzcl9zZXR1
cF9hdXgoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAogCS8qIFNlbGVjdCBvbmx5IHZhbGlk
IGJpdHMgZm9yIFNSRF9BVVhfQ1RMICovCiAJYXV4X2N0bCAmPSBwc3JfYXV4X21hc2s7Ci0JaW50
ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEVEUF9QU1JfQVVYX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5z
Y29kZXIpLAorCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBFRFBfUFNSX0FVWF9DVEwoaW50ZWxf
ZHAtPnBzci50cmFuc2NvZGVyKSwKIAkJICAgICAgIGF1eF9jdGwpOwogfQogCkBAIC0zOTQsMTQg
KzM5MCwxNCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZW5hYmxlX3Npbmsoc3RydWN0IGludGVs
X2RwICppbnRlbF9kcCkKIAl1OCBkcGNkX3ZhbCA9IERQX1BTUl9FTkFCTEU7CiAKIAkvKiBFbmFi
bGUgQUxQTSBhdCBzaW5rIGZvciBwc3IyICovCi0JaWYgKGRldl9wcml2LT5wc3IucHNyMl9lbmFi
bGVkKSB7CisJaWYgKGludGVsX2RwLT5wc3IucHNyMl9lbmFibGVkKSB7CiAJCWRybV9kcF9kcGNk
X3dyaXRlYigmaW50ZWxfZHAtPmF1eCwgRFBfUkVDRUlWRVJfQUxQTV9DT05GSUcsCiAJCQkJICAg
RFBfQUxQTV9FTkFCTEUgfAogCQkJCSAgIERQX0FMUE1fTE9DS19FUlJPUl9JUlFfSFBEX0VOQUJM
RSk7CiAKIAkJZHBjZF92YWwgfD0gRFBfUFNSX0VOQUJMRV9QU1IyIHwgRFBfUFNSX0lSUV9IUERf
V0lUSF9DUkNfRVJST1JTOwogCX0gZWxzZSB7Ci0JCWlmIChkZXZfcHJpdi0+cHNyLmxpbmtfc3Rh
bmRieSkKKwkJaWYgKGludGVsX2RwLT5wc3IubGlua19zdGFuZGJ5KQogCQkJZHBjZF92YWwgfD0g
RFBfUFNSX01BSU5fTElOS19BQ1RJVkU7CiAKIAkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
OCkKQEAgLTQ2NCw3ICs0NjAsNyBAQCBzdGF0aWMgdTggcHNyX2NvbXB1dGVfaWRsZV9mcmFtZXMo
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAkgKiBvZmYtYnktb25lIGlzc3VlIHRoYXQgSFcg
aGFzIGluIHNvbWUgY2FzZXMuCiAJICovCiAJaWRsZV9mcmFtZXMgPSBtYXgoNiwgZGV2X3ByaXYt
PnZidC5wc3IuaWRsZV9mcmFtZXMpOwotCWlkbGVfZnJhbWVzID0gbWF4KGlkbGVfZnJhbWVzLCBk
ZXZfcHJpdi0+cHNyLnNpbmtfc3luY19sYXRlbmN5ICsgMSk7CisJaWRsZV9mcmFtZXMgPSBtYXgo
aWRsZV9mcmFtZXMsIGludGVsX2RwLT5wc3Iuc2lua19zeW5jX2xhdGVuY3kgKyAxKTsKIAogCWlm
IChkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwgaWRsZV9mcmFtZXMgPiAweGYpKQogCQlpZGxl
X2ZyYW1lcyA9IDB4ZjsKQEAgLTQ4NCw3ICs0ODAsNyBAQCBzdGF0aWMgdm9pZCBoc3dfYWN0aXZh
dGVfcHNyMShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCWlmIChJU19IQVNXRUxMKGRldl9w
cml2KSkKIAkJdmFsIHw9IEVEUF9QU1JfTUlOX0xJTktfRU5UUllfVElNRV84X0xJTkVTOwogCi0J
aWYgKGRldl9wcml2LT5wc3IubGlua19zdGFuZGJ5KQorCWlmIChpbnRlbF9kcC0+cHNyLmxpbmtf
c3RhbmRieSkKIAkJdmFsIHw9IEVEUF9QU1JfTElOS19TVEFOREJZOwogCiAJdmFsIHw9IGludGVs
X3BzcjFfZ2V0X3RwX3RpbWUoaW50ZWxfZHApOwpAQCAtNDkyLDkgKzQ4OCw5IEBAIHN0YXRpYyB2
b2lkIGhzd19hY3RpdmF0ZV9wc3IxKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPj0gOCkKIAkJdmFsIHw9IEVEUF9QU1JfQ1JDX0VOQUJMRTsKIAot
CXZhbCB8PSAoaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgRURQX1BTUl9DVEwoZGV2X3ByaXYtPnBz
ci50cmFuc2NvZGVyKSkgJgorCXZhbCB8PSAoaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgRURQX1BT
Ul9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSkgJgogCQlFRFBfUFNSX1JFU1RPUkVfUFNS
X0FDVElWRV9DVFhfTUFTSyk7Ci0JaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEVEUF9QU1JfQ1RM
KGRldl9wcml2LT5wc3IudHJhbnNjb2RlciksIHZhbCk7CisJaW50ZWxfZGVfd3JpdGUoZGV2X3By
aXYsIEVEUF9QU1JfQ1RMKGludGVsX2RwLT5wc3IudHJhbnNjb2RlciksIHZhbCk7CiB9CiAKIHN0
YXRpYyB1MzIgaW50ZWxfcHNyMl9nZXRfdHBfdGltZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2Rw
KQpAQCAtNTI5LDcgKzUyNSw3IEBAIHN0YXRpYyB2b2lkIGhzd19hY3RpdmF0ZV9wc3IyKHN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwg
SVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCiAJCXZhbCB8PSBFRFBfWV9DT09SRElOQVRFX0VOQUJM
RTsKIAotCXZhbCB8PSBFRFBfUFNSMl9GUkFNRV9CRUZPUkVfU1UoZGV2X3ByaXYtPnBzci5zaW5r
X3N5bmNfbGF0ZW5jeSArIDEpOworCXZhbCB8PSBFRFBfUFNSMl9GUkFNRV9CRUZPUkVfU1UoaW50
ZWxfZHAtPnBzci5zaW5rX3N5bmNfbGF0ZW5jeSArIDEpOwogCXZhbCB8PSBpbnRlbF9wc3IyX2dl
dF90cF90aW1lKGludGVsX2RwKTsKIAogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKSB7
CkBAIC01NDgsNyArNTQ0LDcgQEAgc3RhdGljIHZvaWQgaHN3X2FjdGl2YXRlX3BzcjIoc3RydWN0
IGludGVsX2RwICppbnRlbF9kcCkKIAkJdmFsIHw9IEVEUF9QU1IyX0ZBU1RfV0FLRSg3KTsKIAl9
CiAKLQlpZiAoZGV2X3ByaXYtPnBzci5wc3IyX3NlbF9mZXRjaF9lbmFibGVkKSB7CisJaWYgKGlu
dGVsX2RwLT5wc3IucHNyMl9zZWxfZmV0Y2hfZW5hYmxlZCkgewogCQkvKiBXQSAxNDA4MzMwODQ3
ICovCiAJCWlmIChJU19UR0xfRElTUF9SRVZJRChkZXZfcHJpdiwgVEdMX1JFVklEX0EwLCBUR0xf
UkVWSURfQTApIHx8CiAJCSAgICBJU19SS0xfUkVWSUQoZGV2X3ByaXYsIFJLTF9SRVZJRF9BMCwg
UktMX1JFVklEX0EwKSkKQEAgLTU1NywyMCArNTUzLDIwIEBAIHN0YXRpYyB2b2lkIGhzd19hY3Rp
dmF0ZV9wc3IyKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJCQkJICAgICBESVNfUkFNX0JZ
UEFTU19QU1IyX01BTl9UUkFDSyk7CiAKIAkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsCi0JCQkg
ICAgICAgUFNSMl9NQU5fVFJLX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpLAorCQkJICAg
ICAgIFBTUjJfTUFOX1RSS19DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSwKIAkJCSAgICAg
ICBQU1IyX01BTl9UUktfQ1RMX0VOQUJMRSk7CiAJfSBlbHNlIGlmIChIQVNfUFNSMl9TRUxfRkVU
Q0goZGV2X3ByaXYpKSB7CiAJCWludGVsX2RlX3dyaXRlKGRldl9wcml2LAotCQkJICAgICAgIFBT
UjJfTUFOX1RSS19DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSwgMCk7CisJCQkgICAgICAg
UFNSMl9NQU5fVFJLX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpLCAwKTsKIAl9CiAKIAkv
KgogCSAqIFBTUjIgSFcgaXMgaW5jb3JyZWN0bHkgdXNpbmcgRURQX1BTUl9UUDFfVFAzX1NFTCBh
bmQgQlNwZWMgaXMKIAkgKiByZWNvbW1lbmRpbmcga2VlcCB0aGlzIGJpdCB1bnNldCB3aGlsZSBQ
U1IyIGlzIGVuYWJsZWQuCiAJICovCi0JaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEVEUF9QU1Jf
Q1RMKGRldl9wcml2LT5wc3IudHJhbnNjb2RlciksIDApOworCWludGVsX2RlX3dyaXRlKGRldl9w
cml2LCBFRFBfUFNSX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpLCAwKTsKIAotCWludGVs
X2RlX3dyaXRlKGRldl9wcml2LCBFRFBfUFNSMl9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVy
KSwgdmFsKTsKKwlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRURQX1BTUjJfQ1RMKGludGVsX2Rw
LT5wc3IudHJhbnNjb2RlciksIHZhbCk7CiB9CiAKIHN0YXRpYyBib29sCkBAIC01OTMsNTUgKzU4
OSw1OCBAQCBzdGF0aWMgdTMyIGludGVsX2dldF9mcmFtZV90aW1lX3VzKGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjc3RhdGUpCiAJCQkgICAgZHJtX21vZGVfdnJlZnJlc2goJmNzdGF0
ZS0+aHcuYWRqdXN0ZWRfbW9kZSkpOwogfQogCi1zdGF0aWMgdm9pZCBwc3IyX3Byb2dyYW1faWRs
ZV9mcmFtZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQg
cHNyMl9wcm9ncmFtX2lkbGVfZnJhbWVzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCQkJ
ICAgICB1MzIgaWRsZV9mcmFtZXMpCiB7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJdTMyIHZhbDsKIAogCWlkbGVfZnJhbWVzIDw8
PSAgRURQX1BTUjJfSURMRV9GUkFNRV9TSElGVDsKLQl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9w
cml2LCBFRFBfUFNSMl9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSk7CisJdmFsID0gaW50
ZWxfZGVfcmVhZChkZXZfcHJpdiwgRURQX1BTUjJfQ1RMKGludGVsX2RwLT5wc3IudHJhbnNjb2Rl
cikpOwogCXZhbCAmPSB+RURQX1BTUjJfSURMRV9GUkFNRV9NQVNLOwogCXZhbCB8PSBpZGxlX2Zy
YW1lczsKLQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRURQX1BTUjJfQ1RMKGRldl9wcml2LT5w
c3IudHJhbnNjb2RlciksIHZhbCk7CisJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEVEUF9QU1Iy
X0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpLCB2YWwpOwogfQogCi1zdGF0aWMgdm9pZCB0
Z2xfcHNyMl9lbmFibGVfZGMzY28oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQor
c3RhdGljIHZvaWQgdGdsX3BzcjJfZW5hYmxlX2RjM2NvKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHApCiB7Ci0JcHNyMl9wcm9ncmFtX2lkbGVfZnJhbWVzKGRldl9wcml2LCAwKTsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKworCXBz
cjJfcHJvZ3JhbV9pZGxlX2ZyYW1lcyhpbnRlbF9kcCwgMCk7CiAJaW50ZWxfZGlzcGxheV9wb3dl
cl9zZXRfdGFyZ2V0X2RjX3N0YXRlKGRldl9wcml2LCBEQ19TVEFURV9FTl9EQzNDTyk7CiB9CiAK
LXN0YXRpYyB2b2lkIHRnbF9wc3IyX2Rpc2FibGVfZGMzY28oc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgdGdsX3BzcjJfZGlzYWJsZV9kYzNjbyhzdHJ1Y3Qg
aW50ZWxfZHAgKmludGVsX2RwKQogewotCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBkZXZf
cHJpdi0+cHNyLmRwOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3Rv
X2k5MTUoaW50ZWxfZHApOwogCiAJaW50ZWxfZGlzcGxheV9wb3dlcl9zZXRfdGFyZ2V0X2RjX3N0
YXRlKGRldl9wcml2LCBEQ19TVEFURV9FTl9VUFRPX0RDNik7Ci0JcHNyMl9wcm9ncmFtX2lkbGVf
ZnJhbWVzKGRldl9wcml2LCBwc3JfY29tcHV0ZV9pZGxlX2ZyYW1lcyhpbnRlbF9kcCkpOworCXBz
cjJfcHJvZ3JhbV9pZGxlX2ZyYW1lcyhpbnRlbF9kcCwgcHNyX2NvbXB1dGVfaWRsZV9mcmFtZXMo
aW50ZWxfZHApKTsKIH0KIAogc3RhdGljIHZvaWQgdGdsX2RjM2NvX2Rpc2FibGVfd29yayhzdHJ1
Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0KLQkJY29udGFpbmVyX29mKHdvcmssIHR5cGVvZigqZGV2X3ByaXYpLCBwc3IuZGMzY29f
d29yay53b3JrKTsKKwlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0KKwkJY29udGFpbmVyX29m
KHdvcmssIHR5cGVvZigqaW50ZWxfZHApLCBwc3IuZGMzY29fd29yay53b3JrKTsKIAotCW11dGV4
X2xvY2soJmRldl9wcml2LT5wc3IubG9jayk7CisJbXV0ZXhfbG9jaygmaW50ZWxfZHAtPnBzci5s
b2NrKTsKIAkvKiBJZiBkZWxheWVkIHdvcmsgaXMgcGVuZGluZywgaXQgaXMgbm90IGlkbGUgKi8K
LQlpZiAoZGVsYXllZF93b3JrX3BlbmRpbmcoJmRldl9wcml2LT5wc3IuZGMzY29fd29yaykpCisJ
aWYgKGRlbGF5ZWRfd29ya19wZW5kaW5nKCZpbnRlbF9kcC0+cHNyLmRjM2NvX3dvcmspKQogCQln
b3RvIHVubG9jazsKIAotCXRnbF9wc3IyX2Rpc2FibGVfZGMzY28oZGV2X3ByaXYpOworCXRnbF9w
c3IyX2Rpc2FibGVfZGMzY28oaW50ZWxfZHApOwogdW5sb2NrOgotCW11dGV4X3VubG9jaygmZGV2
X3ByaXYtPnBzci5sb2NrKTsKKwltdXRleF91bmxvY2soJmludGVsX2RwLT5wc3IubG9jayk7CiB9
CiAKLXN0YXRpYyB2b2lkIHRnbF9kaXNhbGxvd19kYzNjb19vbl9wc3IyX2V4aXQoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgdGdsX2Rpc2FsbG93X2RjM2Nv
X29uX3BzcjJfZXhpdChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewotCWlmICghZGV2X3By
aXYtPnBzci5kYzNjb19lbmFibGVkKQorCWlmICghaW50ZWxfZHAtPnBzci5kYzNjb19lbmFibGVk
KQogCQlyZXR1cm47CiAKLQljYW5jZWxfZGVsYXllZF93b3JrKCZkZXZfcHJpdi0+cHNyLmRjM2Nv
X3dvcmspOworCWNhbmNlbF9kZWxheWVkX3dvcmsoJmludGVsX2RwLT5wc3IuZGMzY29fd29yayk7
CiAJLyogQmVmb3JlIFBTUjIgZXhpdCBkaXNhbGxvdyBkYzNjbyovCi0JdGdsX3BzcjJfZGlzYWJs
ZV9kYzNjbyhkZXZfcHJpdik7CisJdGdsX3BzcjJfZGlzYWJsZV9kYzNjbyhpbnRlbF9kcCk7CiB9
CiAKIHN0YXRpYyB2b2lkCkBAIC03MTQsNyArNzEzLDcgQEAgc3RhdGljIGJvb2wgaW50ZWxfcHNy
Ml9jb25maWdfdmFsaWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAlpbnQgY3J0Y192ZGlz
cGxheSA9IGNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUuY3J0Y192ZGlzcGxheTsKIAlpbnQg
cHNyX21heF9oID0gMCwgcHNyX21heF92ID0gMCwgbWF4X2JwcCA9IDA7CiAKLQlpZiAoIWRldl9w
cml2LT5wc3Iuc2lua19wc3IyX3N1cHBvcnQpCisJaWYgKCFpbnRlbF9kcC0+cHNyLnNpbmtfcHNy
Ml9zdXBwb3J0KQogCQlyZXR1cm4gZmFsc2U7CiAKIAlpZiAoIXRyYW5zY29kZXJfaGFzX3BzcjIo
ZGV2X3ByaXYsIGNydGNfc3RhdGUtPmNwdV90cmFuc2NvZGVyKSkgewpAQCAtNzI0LDcgKzcyMyw3
IEBAIHN0YXRpYyBib29sIGludGVsX3BzcjJfY29uZmlnX3ZhbGlkKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHAsCiAJCXJldHVybiBmYWxzZTsKIAl9CiAKLQlpZiAoIXBzcjJfZ2xvYmFsX2VuYWJs
ZWQoZGV2X3ByaXYpKSB7CisJaWYgKCFwc3IyX2dsb2JhbF9lbmFibGVkKGludGVsX2RwKSkgewog
CQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgIlBTUjIgZGlzYWJsZWQgYnkgZmxhZ1xuIik7
CiAJCXJldHVybiBmYWxzZTsKIAl9CkBAIC03NzMsMTAgKzc3MiwxMCBAQCBzdGF0aWMgYm9vbCBp
bnRlbF9wc3IyX2NvbmZpZ192YWxpZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCSAqIG9u
bHkgbmVlZCB0byB2YWxpZGF0ZSB0aGUgU1UgYmxvY2sgd2lkdGggaXMgYSBtdWx0aXBsZSBvZgog
CSAqIHggZ3JhbnVsYXJpdHkuCiAJICovCi0JaWYgKGNydGNfaGRpc3BsYXkgJSBkZXZfcHJpdi0+
cHNyLnN1X3hfZ3JhbnVsYXJpdHkpIHsKKwlpZiAoY3J0Y19oZGlzcGxheSAlIGludGVsX2RwLT5w
c3Iuc3VfeF9ncmFudWxhcml0eSkgewogCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKIAkJ
CSAgICAiUFNSMiBub3QgZW5hYmxlZCwgaGRpc3BsYXkoJWQpIG5vdCBtdWx0aXBsZSBvZiAlZFxu
IiwKLQkJCSAgICBjcnRjX2hkaXNwbGF5LCBkZXZfcHJpdi0+cHNyLnN1X3hfZ3JhbnVsYXJpdHkp
OworCQkJICAgIGNydGNfaGRpc3BsYXksIGludGVsX2RwLT5wc3Iuc3VfeF9ncmFudWxhcml0eSk7
CiAJCXJldHVybiBmYWxzZTsKIAl9CiAKQEAgLTgxMSwxMyArODEwLDEwIEBAIHZvaWQgaW50ZWxf
cHNyX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCSZjcnRjX3N0
YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCWludCBwc3Jfc2V0dXBfdGltZTsKIAotCWlmICghQ0FO
X1BTUihkZXZfcHJpdikpCi0JCXJldHVybjsKLQotCWlmIChpbnRlbF9kcCAhPSBkZXZfcHJpdi0+
cHNyLmRwKQorCWlmICghQ0FOX1BTUihpbnRlbF9kcCkpCiAJCXJldHVybjsKIAotCWlmICghcHNy
X2dsb2JhbF9lbmFibGVkKGRldl9wcml2KSkgeworCWlmICghcHNyX2dsb2JhbF9lbmFibGVkKGlu
dGVsX2RwKSkgewogCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgIlBTUiBkaXNhYmxlZCBi
eSBmbGFnXG4iKTsKIAkJcmV0dXJuOwogCX0KQEAgLTgyNSwxNiArODIxLDE4IEBAIHZvaWQgaW50
ZWxfcHNyX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJLyoKIAkg
KiBIU1cgc3BlYyBleHBsaWNpdGx5IHNheXMgUFNSIGlzIHRpZWQgdG8gcG9ydCBBLgogCSAqIEJE
VysgcGxhdGZvcm1zIGhhdmUgYSBpbnN0YW5jZSBvZiBQU1IgcmVnaXN0ZXJzIHBlciB0cmFuc2Nv
ZGVyIGJ1dAotCSAqIGZvciBub3cgaXQgb25seSBzdXBwb3J0cyBvbmUgaW5zdGFuY2Ugb2YgUFNS
LCBzbyBsZXRzIGtlZXAgaXQKLQkgKiBoYXJkY29kZWQgdG8gUE9SVF9BCisJICogQkRXLCBHRU45
IGFuZCBHRU4xMSBhcmUgbm90IHZhbGlkYXRlZCBieSBIVyB0ZWFtLgorCSAqIEZvciBub3cgaXQg
b25seSBzdXBwb3J0cyBvbmUgaW5zdGFuY2Ugb2YgUFNSIGZvciBCRFcsIEdFTjkgYW5kIEdFTjEx
LgorCSAqIFNvIGxldHMga2VlcCBpdCBoYXJkY29kZWQgdG8gUE9SVF9BIGZvciBCRFcsIEdFTjkg
YW5kIEdFTjExLgorCSAqIEJ1dCBHRU4xMiBzdXBwb3J0cyBhIGluc3RhbmNlIG9mIFBTUiByZWdp
c3RlcnMgcGVyIHRyYW5zY29kZXIuCiAJICovCi0JaWYgKGRpZ19wb3J0LT5iYXNlLnBvcnQgIT0g
UE9SVF9BKSB7CisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCAxMiAmJiBkaWdfcG9ydC0+YmFz
ZS5wb3J0ICE9IFBPUlRfQSkgewogCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKIAkJCSAg
ICAiUFNSIGNvbmRpdGlvbiBmYWlsZWQ6IFBvcnQgbm90IHN1cHBvcnRlZFxuIik7CiAJCXJldHVy
bjsKIAl9CiAKLQlpZiAoZGV2X3ByaXYtPnBzci5zaW5rX25vdF9yZWxpYWJsZSkgeworCWlmIChp
bnRlbF9kcC0+cHNyLnNpbmtfbm90X3JlbGlhYmxlKSB7CiAJCWRybV9kYmdfa21zKCZkZXZfcHJp
di0+ZHJtLAogCQkJICAgICJQU1Igc2luayBpbXBsZW1lbnRhdGlvbiBpcyBub3QgcmVsaWFibGVc
biIpOwogCQlyZXR1cm47CkBAIC04NzAsMjMgKzg2OCwyNCBAQCB2b2lkIGludGVsX3Bzcl9jb21w
dXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogc3RhdGljIHZvaWQgaW50ZWxf
cHNyX2FjdGl2YXRlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CiAJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisJZW51bSB0cmFu
c2NvZGVyIHRyYW5zY29kZXIgPSBpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXI7CiAKLQlpZiAodHJh
bnNjb2Rlcl9oYXNfcHNyMihkZXZfcHJpdiwgZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSkKKwlp
ZiAodHJhbnNjb2Rlcl9oYXNfcHNyMihkZXZfcHJpdiwgdHJhbnNjb2RlcikpCiAJCWRybV9XQVJO
X09OKCZkZXZfcHJpdi0+ZHJtLAotCQkJICAgIGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIEVEUF9Q
U1IyX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpKSAmIEVEUF9QU1IyX0VOQUJMRSk7CisJ
CQkgICAgaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgRURQX1BTUjJfQ1RMKHRyYW5zY29kZXIpKSAm
IEVEUF9QU1IyX0VOQUJMRSk7CiAKIAlkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwKLQkJICAg
IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIEVEUF9QU1JfQ1RMKGRldl9wcml2LT5wc3IudHJhbnNj
b2RlcikpICYgRURQX1BTUl9FTkFCTEUpOwotCWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCBk
ZXZfcHJpdi0+cHNyLmFjdGl2ZSk7Ci0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYtPnBz
ci5sb2NrKTsKKwkJICAgIGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIEVEUF9QU1JfQ1RMKHRyYW5z
Y29kZXIpKSAmIEVEUF9QU1JfRU5BQkxFKTsKKwlkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwg
aW50ZWxfZHAtPnBzci5hY3RpdmUpOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmludGVsX2RwLT5w
c3IubG9jayk7CiAKIAkvKiBwc3IxIGFuZCBwc3IyIGFyZSBtdXR1YWxseSBleGNsdXNpdmUuKi8K
LQlpZiAoZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQpCisJaWYgKGludGVsX2RwLT5wc3IucHNy
Ml9lbmFibGVkKQogCQloc3dfYWN0aXZhdGVfcHNyMihpbnRlbF9kcCk7CiAJZWxzZQogCQloc3df
YWN0aXZhdGVfcHNyMShpbnRlbF9kcCk7CiAKLQlkZXZfcHJpdi0+cHNyLmFjdGl2ZSA9IHRydWU7
CisJaW50ZWxfZHAtPnBzci5hY3RpdmUgPSB0cnVlOwogfQogCiBzdGF0aWMgdm9pZCBpbnRlbF9w
c3JfZW5hYmxlX3NvdXJjZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLApAQCAtOTAyLDcgKzkw
MSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3Bzcl9lbmFibGVfc291cmNlKHN0cnVjdCBpbnRlbF9k
cCAqaW50ZWxfZHAsCiAJaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpIHx8IElTX0JST0FEV0VMTChk
ZXZfcHJpdikpCiAJCWhzd19wc3Jfc2V0dXBfYXV4KGludGVsX2RwKTsKIAotCWlmIChkZXZfcHJp
di0+cHNyLnBzcjJfZW5hYmxlZCAmJiAoSVNfR0VOKGRldl9wcml2LCA5KSAmJgorCWlmIChpbnRl
bF9kcC0+cHNyLnBzcjJfZW5hYmxlZCAmJiAoSVNfR0VOKGRldl9wcml2LCA5KSAmJgogCQkJCQkg
ICAhSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpKSB7CiAJCWk5MTVfcmVnX3QgcmVnID0gQ0hJQ0tF
Tl9UUkFOUyhjcHVfdHJhbnNjb2Rlcik7CiAJCXUzMiBjaGlja2VuID0gaW50ZWxfZGVfcmVhZChk
ZXZfcHJpdiwgcmVnKTsKQEAgLTkyNiwxMCArOTI1LDEwIEBAIHN0YXRpYyB2b2lkIGludGVsX3Bz
cl9lbmFibGVfc291cmNlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPCAxMSkKIAkJbWFzayB8PSBFRFBfUFNSX0RFQlVHX01BU0tfRElTUF9SRUdf
V1JJVEU7CiAKLQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRURQX1BTUl9ERUJVRyhkZXZfcHJp
di0+cHNyLnRyYW5zY29kZXIpLAorCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBFRFBfUFNSX0RF
QlVHKGludGVsX2RwLT5wc3IudHJhbnNjb2RlciksCiAJCSAgICAgICBtYXNrKTsKIAotCXBzcl9p
cnFfY29udHJvbChkZXZfcHJpdik7CisJcHNyX2lycV9jb250cm9sKGludGVsX2RwKTsKIAogCWlm
IChjcnRjX3N0YXRlLT5kYzNjb19leGl0bGluZSkgewogCQl1MzIgdmFsOwpAQCAtOTQ3LDMwICs5
NDYsMzAgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHNyX2VuYWJsZV9zb3VyY2Uoc3RydWN0IGludGVs
X2RwICppbnRlbF9kcCwKIAogCWlmIChIQVNfUFNSX0hXX1RSQUNLSU5HKGRldl9wcml2KSAmJiBI
QVNfUFNSMl9TRUxfRkVUQ0goZGV2X3ByaXYpKQogCQlpbnRlbF9kZV9ybXcoZGV2X3ByaXYsIENI
SUNLRU5fUEFSMV8xLCBJR05PUkVfUFNSMl9IV19UUkFDS0lORywKLQkJCSAgICAgZGV2X3ByaXYt
PnBzci5wc3IyX3NlbF9mZXRjaF9lbmFibGVkID8KKwkJCSAgICAgaW50ZWxfZHAtPnBzci5wc3Iy
X3NlbF9mZXRjaF9lbmFibGVkID8KIAkJCSAgICAgSUdOT1JFX1BTUjJfSFdfVFJBQ0tJTkcgOiAw
KTsKIH0KIAotc3RhdGljIHZvaWQgaW50ZWxfcHNyX2VuYWJsZV9sb2NrZWQoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgaW50ZWxfcHNyX2VuYWJsZV9sb2Nr
ZWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJCQkgICAgY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJICAgIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVj
dG9yX3N0YXRlICpjb25uX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBk
ZXZfcHJpdi0+cHNyLmRwOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRw
X3RvX2k5MTUoaW50ZWxfZHApOwogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0
ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOwogCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyID0gJmRpZ19wb3J0LT5iYXNlOwogCXUzMiB2YWw7CiAKLQlkcm1fV0FSTl9PTigmZGV2X3By
aXYtPmRybSwgZGV2X3ByaXYtPnBzci5lbmFibGVkKTsKKwlkcm1fV0FSTl9PTigmZGV2X3ByaXYt
PmRybSwgaW50ZWxfZHAtPnBzci5lbmFibGVkKTsKIAotCWRldl9wcml2LT5wc3IucHNyMl9lbmFi
bGVkID0gY3J0Y19zdGF0ZS0+aGFzX3BzcjI7Ci0JZGV2X3ByaXYtPnBzci5idXN5X2Zyb250YnVm
ZmVyX2JpdHMgPSAwOwotCWRldl9wcml2LT5wc3IucGlwZSA9IHRvX2ludGVsX2NydGMoY3J0Y19z
dGF0ZS0+dWFwaS5jcnRjKS0+cGlwZTsKLQlkZXZfcHJpdi0+cHNyLmRjM2NvX2VuYWJsZWQgPSAh
IWNydGNfc3RhdGUtPmRjM2NvX2V4aXRsaW5lOwotCWRldl9wcml2LT5wc3IudHJhbnNjb2RlciA9
IGNydGNfc3RhdGUtPmNwdV90cmFuc2NvZGVyOworCWludGVsX2RwLT5wc3IucHNyMl9lbmFibGVk
ID0gY3J0Y19zdGF0ZS0+aGFzX3BzcjI7CisJaW50ZWxfZHAtPnBzci5idXN5X2Zyb250YnVmZmVy
X2JpdHMgPSAwOworCWludGVsX2RwLT5wc3IucGlwZSA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0
ZS0+dWFwaS5jcnRjKS0+cGlwZTsKKwlpbnRlbF9kcC0+cHNyLmRjM2NvX2VuYWJsZWQgPSAhIWNy
dGNfc3RhdGUtPmRjM2NvX2V4aXRsaW5lOworCWludGVsX2RwLT5wc3IudHJhbnNjb2RlciA9IGNy
dGNfc3RhdGUtPmNwdV90cmFuc2NvZGVyOwogCS8qIERDNS9EQzYgcmVxdWlyZXMgYXQgbGVhc3Qg
NiBpZGxlIGZyYW1lcyAqLwogCXZhbCA9IHVzZWNzX3RvX2ppZmZpZXMoaW50ZWxfZ2V0X2ZyYW1l
X3RpbWVfdXMoY3J0Y19zdGF0ZSkgKiA2KTsKLQlkZXZfcHJpdi0+cHNyLmRjM2NvX2V4aXRfZGVs
YXkgPSB2YWw7Ci0JZGV2X3ByaXYtPnBzci5wc3IyX3NlbF9mZXRjaF9lbmFibGVkID0gY3J0Y19z
dGF0ZS0+ZW5hYmxlX3BzcjJfc2VsX2ZldGNoOworCWludGVsX2RwLT5wc3IuZGMzY29fZXhpdF9k
ZWxheSA9IHZhbDsKKwlpbnRlbF9kcC0+cHNyLnBzcjJfc2VsX2ZldGNoX2VuYWJsZWQgPSBjcnRj
X3N0YXRlLT5lbmFibGVfcHNyMl9zZWxfZmV0Y2g7CiAKIAkvKgogCSAqIElmIGEgUFNSIGVycm9y
IGhhcHBlbmVkIGFuZCB0aGUgZHJpdmVyIGlzIHJlbG9hZGVkLCB0aGUgRURQX1BTUl9JSVIKQEAg
LTk4MiwyNyArOTgxLDI3IEBAIHN0YXRpYyB2b2lkIGludGVsX3Bzcl9lbmFibGVfbG9ja2VkKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkgKi8KIAlpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA+PSAxMikgewogCQl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LAotCQkJCSAg
ICBUUkFOU19QU1JfSUlSKGRldl9wcml2LT5wc3IudHJhbnNjb2RlcikpOworCQkJCSAgICBUUkFO
U19QU1JfSUlSKGludGVsX2RwLT5wc3IudHJhbnNjb2RlcikpOwogCQl2YWwgJj0gRURQX1BTUl9F
UlJPUigwKTsKIAl9IGVsc2UgewogCQl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBFRFBf
UFNSX0lJUik7Ci0JCXZhbCAmPSBFRFBfUFNSX0VSUk9SKGRldl9wcml2LT5wc3IudHJhbnNjb2Rl
cik7CisJCXZhbCAmPSBFRFBfUFNSX0VSUk9SKGludGVsX2RwLT5wc3IudHJhbnNjb2Rlcik7CiAJ
fQogCWlmICh2YWwpIHsKLQkJZGV2X3ByaXYtPnBzci5zaW5rX25vdF9yZWxpYWJsZSA9IHRydWU7
CisJCWludGVsX2RwLT5wc3Iuc2lua19ub3RfcmVsaWFibGUgPSB0cnVlOwogCQlkcm1fZGJnX2tt
cygmZGV2X3ByaXYtPmRybSwKIAkJCSAgICAiUFNSIGludGVycnVwdGlvbiBlcnJvciBzZXQsIG5v
dCBlbmFibGluZyBQU1JcbiIpOwogCQlyZXR1cm47CiAJfQogCiAJZHJtX2RiZ19rbXMoJmRldl9w
cml2LT5kcm0sICJFbmFibGluZyBQU1Ilc1xuIiwKLQkJICAgIGRldl9wcml2LT5wc3IucHNyMl9l
bmFibGVkID8gIjIiIDogIjEiKTsKKwkJICAgIGludGVsX2RwLT5wc3IucHNyMl9lbmFibGVkID8g
IjIiIDogIjEiKTsKIAlpbnRlbF9kcF9jb21wdXRlX3Bzcl92c2Nfc2RwKGludGVsX2RwLCBjcnRj
X3N0YXRlLCBjb25uX3N0YXRlLAotCQkJCSAgICAgJmRldl9wcml2LT5wc3IudnNjKTsKLQlpbnRl
bF93cml0ZV9kcF92c2Nfc2RwKGVuY29kZXIsIGNydGNfc3RhdGUsICZkZXZfcHJpdi0+cHNyLnZz
Yyk7CisJCQkJICAgICAmaW50ZWxfZHAtPnBzci52c2MpOworCWludGVsX3dyaXRlX2RwX3ZzY19z
ZHAoZW5jb2RlciwgY3J0Y19zdGF0ZSwgJmludGVsX2RwLT5wc3IudnNjKTsKIAlpbnRlbF9wc3Jf
ZW5hYmxlX3NpbmsoaW50ZWxfZHApOwogCWludGVsX3Bzcl9lbmFibGVfc291cmNlKGludGVsX2Rw
LCBjcnRjX3N0YXRlKTsKLQlkZXZfcHJpdi0+cHNyLmVuYWJsZWQgPSB0cnVlOworCWludGVsX2Rw
LT5wc3IuZW5hYmxlZCA9IHRydWU7CiAKIAlpbnRlbF9wc3JfYWN0aXZhdGUoaW50ZWxfZHApOwog
fQpAQCAtMTAyMSw3ICsxMDIwLDcgQEAgdm9pZCBpbnRlbF9wc3JfZW5hYmxlKHN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHAsCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
ZHBfdG9faTkxNShpbnRlbF9kcCk7CiAKLQlpZiAoIUNBTl9QU1IoZGV2X3ByaXYpIHx8IGRldl9w
cml2LT5wc3IuZHAgIT0gaW50ZWxfZHApCisJaWYgKCFDQU5fUFNSKGludGVsX2RwKSkKIAkJcmV0
dXJuOwogCiAJaWYgKCFjcnRjX3N0YXRlLT5oYXNfcHNyKQpAQCAtMTAyOSw0NiArMTAyOCw0NyBA
QCB2b2lkIGludGVsX3Bzcl9lbmFibGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAogCWRy
bV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCBkZXZfcHJpdi0+ZHJycy5kcCk7CiAKLQltdXRleF9s
b2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOwotCWludGVsX3Bzcl9lbmFibGVfbG9ja2VkKGRldl9w
cml2LCBjcnRjX3N0YXRlLCBjb25uX3N0YXRlKTsKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5w
c3IubG9jayk7CisJbXV0ZXhfbG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKKwlpbnRlbF9wc3Jf
ZW5hYmxlX2xvY2tlZChpbnRlbF9kcCwgY3J0Y19zdGF0ZSwgY29ubl9zdGF0ZSk7CisJbXV0ZXhf
dW5sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOwogfQogCi1zdGF0aWMgdm9pZCBpbnRlbF9wc3Jf
ZXhpdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBpbnRl
bF9wc3JfZXhpdChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogeworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCXUzMiB2YWw7CiAK
LQlpZiAoIWRldl9wcml2LT5wc3IuYWN0aXZlKSB7Ci0JCWlmICh0cmFuc2NvZGVyX2hhc19wc3Iy
KGRldl9wcml2LCBkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpKSB7CisJaWYgKCFpbnRlbF9kcC0+
cHNyLmFjdGl2ZSkgeworCQlpZiAodHJhbnNjb2Rlcl9oYXNfcHNyMihkZXZfcHJpdiwgaW50ZWxf
ZHAtPnBzci50cmFuc2NvZGVyKSkgewogCQkJdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwK
LQkJCQkJICAgIEVEUF9QU1IyX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpKTsKKwkJCQkJ
ICAgIEVEUF9QU1IyX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpKTsKIAkJCWRybV9XQVJO
X09OKCZkZXZfcHJpdi0+ZHJtLCB2YWwgJiBFRFBfUFNSMl9FTkFCTEUpOwogCQl9CiAKIAkJdmFs
ID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwKLQkJCQkgICAgRURQX1BTUl9DVEwoZGV2X3ByaXYt
PnBzci50cmFuc2NvZGVyKSk7CisJCQkJICAgIEVEUF9QU1JfQ1RMKGludGVsX2RwLT5wc3IudHJh
bnNjb2RlcikpOwogCQlkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwgdmFsICYgRURQX1BTUl9F
TkFCTEUpOwogCiAJCXJldHVybjsKIAl9CiAKLQlpZiAoZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJs
ZWQpIHsKLQkJdGdsX2Rpc2FsbG93X2RjM2NvX29uX3BzcjJfZXhpdChkZXZfcHJpdik7CisJaWYg
KGludGVsX2RwLT5wc3IucHNyMl9lbmFibGVkKSB7CisJCXRnbF9kaXNhbGxvd19kYzNjb19vbl9w
c3IyX2V4aXQoaW50ZWxfZHApOwogCQl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LAotCQkJ
CSAgICBFRFBfUFNSMl9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSk7CisJCQkJICAgIEVE
UF9QU1IyX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpKTsKIAkJZHJtX1dBUk5fT04oJmRl
dl9wcml2LT5kcm0sICEodmFsICYgRURQX1BTUjJfRU5BQkxFKSk7CiAJCXZhbCAmPSB+RURQX1BT
UjJfRU5BQkxFOwogCQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwKLQkJCSAgICAgICBFRFBfUFNS
Ml9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSwgdmFsKTsKKwkJCSAgICAgICBFRFBfUFNS
Ml9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSwgdmFsKTsKIAl9IGVsc2UgewogCQl2YWwg
PSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LAotCQkJCSAgICBFRFBfUFNSX0NUTChkZXZfcHJpdi0+
cHNyLnRyYW5zY29kZXIpKTsKKwkJCQkgICAgRURQX1BTUl9DVEwoaW50ZWxfZHAtPnBzci50cmFu
c2NvZGVyKSk7CiAJCWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCAhKHZhbCAmIEVEUF9QU1Jf
RU5BQkxFKSk7CiAJCXZhbCAmPSB+RURQX1BTUl9FTkFCTEU7CiAJCWludGVsX2RlX3dyaXRlKGRl
dl9wcml2LAotCQkJICAgICAgIEVEUF9QU1JfQ1RMKGRldl9wcml2LT5wc3IudHJhbnNjb2Rlciks
IHZhbCk7CisJCQkgICAgICAgRURQX1BTUl9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSwg
dmFsKTsKIAl9Ci0JZGV2X3ByaXYtPnBzci5hY3RpdmUgPSBmYWxzZTsKKwlpbnRlbF9kcC0+cHNy
LmFjdGl2ZSA9IGZhbHNlOwogfQogCiBzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZGlzYWJsZV9sb2Nr
ZWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKQEAgLTEwNzcsMjEgKzEwNzcsMjEgQEAgc3Rh
dGljIHZvaWQgaW50ZWxfcHNyX2Rpc2FibGVfbG9ja2VkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHApCiAJaTkxNV9yZWdfdCBwc3Jfc3RhdHVzOwogCXUzMiBwc3Jfc3RhdHVzX21hc2s7CiAKLQls
b2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCWxvY2tkZXBfYXNzZXJ0
X2hlbGQoJmludGVsX2RwLT5wc3IubG9jayk7CiAKLQlpZiAoIWRldl9wcml2LT5wc3IuZW5hYmxl
ZCkKKwlpZiAoIWludGVsX2RwLT5wc3IuZW5hYmxlZCkKIAkJcmV0dXJuOwogCiAJZHJtX2RiZ19r
bXMoJmRldl9wcml2LT5kcm0sICJEaXNhYmxpbmcgUFNSJXNcbiIsCi0JCSAgICBkZXZfcHJpdi0+
cHNyLnBzcjJfZW5hYmxlZCA/ICIyIiA6ICIxIik7CisJCSAgICBpbnRlbF9kcC0+cHNyLnBzcjJf
ZW5hYmxlZCA/ICIyIiA6ICIxIik7CiAKLQlpbnRlbF9wc3JfZXhpdChkZXZfcHJpdik7CisJaW50
ZWxfcHNyX2V4aXQoaW50ZWxfZHApOwogCi0JaWYgKGRldl9wcml2LT5wc3IucHNyMl9lbmFibGVk
KSB7Ci0JCXBzcl9zdGF0dXMgPSBFRFBfUFNSMl9TVEFUVVMoZGV2X3ByaXYtPnBzci50cmFuc2Nv
ZGVyKTsKKwlpZiAoaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJsZWQpIHsKKwkJcHNyX3N0YXR1cyA9
IEVEUF9QU1IyX1NUQVRVUyhpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpOwogCQlwc3Jfc3RhdHVz
X21hc2sgPSBFRFBfUFNSMl9TVEFUVVNfU1RBVEVfTUFTSzsKIAl9IGVsc2UgewotCQlwc3Jfc3Rh
dHVzID0gRURQX1BTUl9TVEFUVVMoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKTsKKwkJcHNyX3N0
YXR1cyA9IEVEUF9QU1JfU1RBVFVTKGludGVsX2RwLT5wc3IudHJhbnNjb2Rlcik7CiAJCXBzcl9z
dGF0dXNfbWFzayA9IEVEUF9QU1JfU1RBVFVTX1NUQVRFX01BU0s7CiAJfQogCkBAIC0xMTAxLDcg
KzExMDEsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZGlzYWJsZV9sb2NrZWQoc3RydWN0IGlu
dGVsX2RwICppbnRlbF9kcCkKIAkJZHJtX2VycigmZGV2X3ByaXYtPmRybSwgIlRpbWVkIG91dCB3
YWl0aW5nIFBTUiBpZGxlIHN0YXRlXG4iKTsKIAogCS8qIFdBIDE0MDgzMzA4NDcgKi8KLQlpZiAo
ZGV2X3ByaXYtPnBzci5wc3IyX3NlbF9mZXRjaF9lbmFibGVkICYmCisJaWYgKGludGVsX2RwLT5w
c3IucHNyMl9zZWxfZmV0Y2hfZW5hYmxlZCAmJgogCSAgICAoSVNfVEdMX0RJU1BfUkVWSUQoZGV2
X3ByaXYsIFRHTF9SRVZJRF9BMCwgVEdMX1JFVklEX0EwKSB8fAogCSAgICAgSVNfUktMX1JFVklE
KGRldl9wcml2LCBSS0xfUkVWSURfQTAsIFJLTF9SRVZJRF9BMCkpKQogCQlpbnRlbF9kZV9ybXco
ZGV2X3ByaXYsIENISUNLRU5fUEFSMV8xLApAQCAtMTExMCwxMCArMTExMCwxMCBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9wc3JfZGlzYWJsZV9sb2NrZWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkK
IAkvKiBEaXNhYmxlIFBTUiBvbiBTaW5rICovCiAJZHJtX2RwX2RwY2Rfd3JpdGViKCZpbnRlbF9k
cC0+YXV4LCBEUF9QU1JfRU5fQ0ZHLCAwKTsKIAotCWlmIChkZXZfcHJpdi0+cHNyLnBzcjJfZW5h
YmxlZCkKKwlpZiAoaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJsZWQpCiAJCWRybV9kcF9kcGNkX3dy
aXRlYigmaW50ZWxfZHAtPmF1eCwgRFBfUkVDRUlWRVJfQUxQTV9DT05GSUcsIDApOwogCi0JZGV2
X3ByaXYtPnBzci5lbmFibGVkID0gZmFsc2U7CisJaW50ZWxfZHAtPnBzci5lbmFibGVkID0gZmFs
c2U7CiB9CiAKIC8qKgpAQCAtMTEzMSwyMCArMTEzMSwyMiBAQCB2b2lkIGludGVsX3Bzcl9kaXNh
YmxlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJaWYgKCFvbGRfY3J0Y19zdGF0ZS0+aGFz
X3BzcikKIAkJcmV0dXJuOwogCi0JaWYgKGRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCAhQ0FO
X1BTUihkZXZfcHJpdikpKQorCWlmIChkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwgIUNBTl9Q
U1IoaW50ZWxfZHApKSkKIAkJcmV0dXJuOwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPnBzci5s
b2NrKTsKKwltdXRleF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOwogCiAJaW50ZWxfcHNyX2Rp
c2FibGVfbG9ja2VkKGludGVsX2RwKTsKIAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5s
b2NrKTsKLQljYW5jZWxfd29ya19zeW5jKCZkZXZfcHJpdi0+cHNyLndvcmspOwotCWNhbmNlbF9k
ZWxheWVkX3dvcmtfc3luYygmZGV2X3ByaXYtPnBzci5kYzNjb193b3JrKTsKKwltdXRleF91bmxv
Y2soJmludGVsX2RwLT5wc3IubG9jayk7CisJY2FuY2VsX3dvcmtfc3luYygmaW50ZWxfZHAtPnBz
ci53b3JrKTsKKwljYW5jZWxfZGVsYXllZF93b3JrX3N5bmMoJmludGVsX2RwLT5wc3IuZGMzY29f
d29yayk7CiB9CiAKLXN0YXRpYyB2b2lkIHBzcl9mb3JjZV9od190cmFja2luZ19leGl0KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIHBzcl9mb3JjZV9od190
cmFja2luZ19leGl0KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisKIAlpZiAoSVNf
VElHRVJMQUtFKGRldl9wcml2KSkKIAkJLyoKIAkJICogV3JpdGVzIHRvIENVUlNVUkZMSVZFIGlu
IFRHTCBhcmUgY2F1c2luZyBJT01NVSBlcnJvcnMgYW5kCkBAIC0xMTU4LDcgKzExNjAsNyBAQCBz
dGF0aWMgdm9pZCBwc3JfZm9yY2VfaHdfdHJhY2tpbmdfZXhpdChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCiAJCSAqIFNvIHVzaW5nIHRoaXMgd29ya2Fyb3VuZCB1bnRpbCB0aGlz
IGlzc3VlIGlzIHJvb3QgY2F1c2VkCiAJCSAqIGFuZCBhIGJldHRlciBmaXggaXMgZm91bmQuCiAJ
CSAqLwotCQlpbnRlbF9wc3JfZXhpdChkZXZfcHJpdik7CisJCWludGVsX3Bzcl9leGl0KGludGVs
X2RwKTsKIAllbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDkpCiAJCS8qCiAJCSAqIERp
c3BsYXkgV0EgIzA4ODQ6IHNrbCsKQEAgLTExNjksMTMgKzExNzEsMTMgQEAgc3RhdGljIHZvaWQg
cHNyX2ZvcmNlX2h3X3RyYWNraW5nX2V4aXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQogCQkgKiBidXQgaXQgbWFrZXMgbW9yZSBzZW5zZSB3cml0ZSB0byB0aGUgY3VycmVudCBh
Y3RpdmUKIAkJICogcGlwZS4KIAkJICovCi0JCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBDVVJT
VVJGTElWRShkZXZfcHJpdi0+cHNyLnBpcGUpLCAwKTsKKwkJaW50ZWxfZGVfd3JpdGUoZGV2X3By
aXYsIENVUlNVUkZMSVZFKGludGVsX2RwLT5wc3IucGlwZSksIDApOwogCWVsc2UKIAkJLyoKIAkJ
ICogQSB3cml0ZSB0byBDVVJTVVJGTElWRSBkbyBub3QgY2F1c2UgSFcgdHJhY2tpbmcgdG8gZXhp
dCBQU1IKIAkJICogb24gb2xkZXIgZ2VucyBzbyBkb2luZyB0aGUgbWFudWFsIGV4aXQgaW5zdGVh
ZC4KIAkJICovCi0JCWludGVsX3Bzcl9leGl0KGRldl9wcml2KTsKKwkJaW50ZWxfcHNyX2V4aXQo
aW50ZWxfZHApOwogfQogCiB2b2lkIGludGVsX3BzcjJfcHJvZ3JhbV9wbGFuZV9zZWxfZmV0Y2go
c3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKQEAgLTEyMjMsMTYgKzEyMjUsMjQgQEAgdm9pZCBp
bnRlbF9wc3IyX3Byb2dyYW1fcGxhbmVfc2VsX2ZldGNoKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxh
bmUsCiAKIHZvaWQgaW50ZWxfcHNyMl9wcm9ncmFtX3RyYW5zX21hbl90cmtfY3RsKGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwotCXN0
cnVjdCBpOTE1X3BzciAqcHNyID0gJmRldl9wcml2LT5wc3I7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7CisJ
c3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXI7CiAKLQlpZiAoIUhBU19QU1IyX1NFTF9GRVRD
SChkZXZfcHJpdikgfHwKLQkgICAgIWNydGNfc3RhdGUtPmVuYWJsZV9wc3IyX3NlbF9mZXRjaCkK
KwlpZiAoIUhBU19QU1IyX1NFTF9GRVRDSChkZXZfcHJpdikpCiAJCXJldHVybjsKIAotCWludGVs
X2RlX3dyaXRlKGRldl9wcml2LCBQU1IyX01BTl9UUktfQ1RMKHBzci0+dHJhbnNjb2RlciksCi0J
CSAgICAgICBjcnRjX3N0YXRlLT5wc3IyX21hbl90cmFja19jdGwpOworCWZvcl9lYWNoX2ludGVs
X2VuY29kZXJfbWFzaygmZGV2X3ByaXYtPmRybSwgZW5jb2RlciwKKwkJCQkgICAgY3J0Y19zdGF0
ZS0+dWFwaS5lbmNvZGVyX21hc2spIHsKKwkJaWYgKGludGVsX2VuY29kZXJfaXNfZHAoZW5jb2Rl
cikgJiYKKwkJICAgIGNydGNfc3RhdGUtPmVuYWJsZV9wc3IyX3NlbF9mZXRjaCkgeworCQkJc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcChlbmNvZGVyKTsKKwkJCXN0
cnVjdCBpbnRlbF9wc3IgKnBzciA9ICZpbnRlbF9kcC0+cHNyOworCisJCQlpbnRlbF9kZV93cml0
ZShkZXZfcHJpdiwKKwkJCQkgICAgICAgUFNSMl9NQU5fVFJLX0NUTChwc3ItPnRyYW5zY29kZXIp
LAorCQkJCSAgICAgICBjcnRjX3N0YXRlLT5wc3IyX21hbl90cmFja19jdGwpOworCQl9CisJfQog
fQogCiBzdGF0aWMgdm9pZCBwc3IyX21hbl90cmtfY3RsX2NhbGMoc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUsCkBAIC0xNDI3LDEzICsxNDM3LDEzIEBAIHZvaWQgaW50ZWxfcHNy
X3VwZGF0ZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCQkgICAgICBjb25zdCBzdHJ1Y3Qg
ZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKLQlzdHJ1Y3QgaTkxNV9wc3Ig
KnBzciA9ICZkZXZfcHJpdi0+cHNyOworCXN0cnVjdCBpbnRlbF9wc3IgKnBzciA9ICZpbnRlbF9k
cC0+cHNyOwogCWJvb2wgZW5hYmxlLCBwc3IyX2VuYWJsZTsKIAotCWlmICghQ0FOX1BTUihkZXZf
cHJpdikgfHwgUkVBRF9PTkNFKHBzci0+ZHApICE9IGludGVsX2RwKQorCWlmICghQ0FOX1BTUihp
bnRlbF9kcCkpCiAJCXJldHVybjsKIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5wc3IubG9jayk7
CisJbXV0ZXhfbG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKIAogCWVuYWJsZSA9IGNydGNfc3Rh
dGUtPmhhc19wc3I7CiAJcHNyMl9lbmFibGUgPSBjcnRjX3N0YXRlLT5oYXNfcHNyMjsKQEAgLTE0
NDEsMTUgKzE0NTEsMTUgQEAgdm9pZCBpbnRlbF9wc3JfdXBkYXRlKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHAsCiAJaWYgKGVuYWJsZSA9PSBwc3ItPmVuYWJsZWQgJiYgcHNyMl9lbmFibGUgPT0g
cHNyLT5wc3IyX2VuYWJsZWQpIHsKIAkJLyogRm9yY2UgYSBQU1IgZXhpdCB3aGVuIGVuYWJsaW5n
IENSQyB0byBhdm9pZCBDUkMgdGltZW91dHMgKi8KIAkJaWYgKGNydGNfc3RhdGUtPmNyY19lbmFi
bGVkICYmIHBzci0+ZW5hYmxlZCkKLQkJCXBzcl9mb3JjZV9od190cmFja2luZ19leGl0KGRldl9w
cml2KTsKKwkJCXBzcl9mb3JjZV9od190cmFja2luZ19leGl0KGludGVsX2RwKTsKIAkJZWxzZSBp
ZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDkgJiYgcHNyLT5lbmFibGVkKSB7CiAJCQkvKgogCQkJ
ICogQWN0aXZhdGUgUFNSIGFnYWluIGFmdGVyIGEgZm9yY2UgZXhpdCB3aGVuIGVuYWJsaW5nCiAJ
CQkgKiBDUkMgaW4gb2xkZXIgZ2VucwogCQkJICovCi0JCQlpZiAoIWRldl9wcml2LT5wc3IuYWN0
aXZlICYmCi0JCQkgICAgIWRldl9wcml2LT5wc3IuYnVzeV9mcm9udGJ1ZmZlcl9iaXRzKQotCQkJ
CXNjaGVkdWxlX3dvcmsoJmRldl9wcml2LT5wc3Iud29yayk7CisJCQlpZiAoIWludGVsX2RwLT5w
c3IuYWN0aXZlICYmCisJCQkgICAgIWludGVsX2RwLT5wc3IuYnVzeV9mcm9udGJ1ZmZlcl9iaXRz
KQorCQkJCXNjaGVkdWxlX3dvcmsoJmludGVsX2RwLT5wc3Iud29yayk7CiAJCX0KIAogCQlnb3Rv
IHVubG9jazsKQEAgLTE0NTksMzQgKzE0NjksMjMgQEAgdm9pZCBpbnRlbF9wc3JfdXBkYXRlKHN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCWludGVsX3Bzcl9kaXNhYmxlX2xvY2tlZChpbnRl
bF9kcCk7CiAKIAlpZiAoZW5hYmxlKQotCQlpbnRlbF9wc3JfZW5hYmxlX2xvY2tlZChkZXZfcHJp
diwgY3J0Y19zdGF0ZSwgY29ubl9zdGF0ZSk7CisJCWludGVsX3Bzcl9lbmFibGVfbG9ja2VkKGlu
dGVsX2RwLCBjcnRjX3N0YXRlLCBjb25uX3N0YXRlKTsKIAogdW5sb2NrOgotCW11dGV4X3VubG9j
aygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRleF91bmxvY2soJmludGVsX2RwLT5wc3IubG9j
ayk7CiB9CiAKIC8qKgotICogaW50ZWxfcHNyX3dhaXRfZm9yX2lkbGUgLSB3YWl0IGZvciBQU1Ix
IHRvIGlkbGUKLSAqIEBuZXdfY3J0Y19zdGF0ZTogbmV3IENSVEMgc3RhdGUKKyAqIHBzcl93YWl0
X2Zvcl9pZGxlIC0gd2FpdCBmb3IgUFNSMSB0byBpZGxlCisgKiBAaW50ZWxfZHA6IEludGVsIERQ
CiAgKiBAb3V0X3ZhbHVlOiBQU1Igc3RhdHVzIGluIGNhc2Ugb2YgZmFpbHVyZQogICoKLSAqIFRo
aXMgZnVuY3Rpb24gaXMgZXhwZWN0ZWQgdG8gYmUgY2FsbGVkIGZyb20gcGlwZV91cGRhdGVfc3Rh
cnQoKSB3aGVyZSBpdCBpcwotICogbm90IGV4cGVjdGVkIHRvIHJhY2Ugd2l0aCBQU1IgZW5hYmxl
IG9yIGRpc2FibGUuCi0gKgogICogUmV0dXJuczogMCBvbiBzdWNjZXNzIG9yIC1FVElNRU9VVCBp
ZiBQU1Igc3RhdHVzIGRvZXMgbm90IGlkbGUuCisgKgogICovCi1pbnQgaW50ZWxfcHNyX3dhaXRf
Zm9yX2lkbGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlLAot
CQkJICAgIHUzMiAqb3V0X3ZhbHVlKQorc3RhdGljIGludCBwc3Jfd2FpdF9mb3JfaWRsZShzdHJ1
Y3QgaW50ZWxfZHAgKmludGVsX2RwLCB1MzIgKm91dF92YWx1ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMobmV3X2NydGNfc3RhdGUtPnVhcGkuY3J0Yyk7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRl
dik7Ci0KLQlpZiAoIWRldl9wcml2LT5wc3IuZW5hYmxlZCB8fCAhbmV3X2NydGNfc3RhdGUtPmhh
c19wc3IpCi0JCXJldHVybiAwOwotCi0JLyogRklYTUU6IFVwZGF0ZSB0aGlzIGZvciBQU1IyIGlm
IHdlIG5lZWQgdG8gd2FpdCBmb3IgaWRsZSAqLwotCWlmIChSRUFEX09OQ0UoZGV2X3ByaXYtPnBz
ci5wc3IyX2VuYWJsZWQpKQotCQlyZXR1cm4gMDsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAogCS8qCiAJICogRnJvbSBic3BlYzog
UGFuZWwgU2VsZiBSZWZyZXNoIChCRFcrKQpAQCAtMTQ5NCwzMiArMTQ5Myw2NyBAQCBpbnQgaW50
ZWxfcHNyX3dhaXRfZm9yX2lkbGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19j
cnRjX3N0YXRlLAogCSAqIGV4aXQgdHJhaW5pbmcgdGltZSArIDEuNSBtcyBvZiBhdXggY2hhbm5l
bCBoYW5kc2hha2UuIDUwIG1zIGlzCiAJICogZGVmZW5zaXZlIGVub3VnaCB0byBjb3ZlciBldmVy
eXRoaW5nLgogCSAqLwotCiAJcmV0dXJuIF9faW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXIoJmRldl9w
cml2LT51bmNvcmUsCi0JCQkJCSBFRFBfUFNSX1NUQVRVUyhkZXZfcHJpdi0+cHNyLnRyYW5zY29k
ZXIpLAorCQkJCQkgRURQX1BTUl9TVEFUVVMoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSwKIAkJ
CQkJIEVEUF9QU1JfU1RBVFVTX1NUQVRFX01BU0ssCiAJCQkJCSBFRFBfUFNSX1NUQVRVU19TVEFU
RV9JRExFLCAyLCA1MCwKIAkJCQkJIG91dF92YWx1ZSk7CiB9CiAKLXN0YXRpYyBib29sIF9fcHNy
X3dhaXRfZm9yX2lkbGVfbG9ja2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
Ky8qKgorICogaW50ZWxfcHNyX3dhaXRfZm9yX2lkbGUgLSB3YWl0IGZvciBQU1IxIHRvIGlkbGUK
KyAqIEBuZXdfY3J0Y19zdGF0ZTogbmV3IENSVEMgc3RhdGUKKyAqCisgKiBUaGlzIGZ1bmN0aW9u
IGlzIGV4cGVjdGVkIHRvIGJlIGNhbGxlZCBmcm9tIHBpcGVfdXBkYXRlX3N0YXJ0KCkgd2hlcmUg
aXQgaXMKKyAqIG5vdCBleHBlY3RlZCB0byByYWNlIHdpdGggUFNSIGVuYWJsZSBvciBkaXNhYmxl
LgorICovCit2b2lkIGludGVsX3Bzcl93YWl0X2Zvcl9pZGxlKGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KG5ld19jcnRjX3N0YXRlLT51YXBpLmNydGMtPmRldik7CisJc3Ry
dWN0IGludGVsX2VuY29kZXIgKmVuY29kZXI7CisJdTMyIHBzcl9zdGF0dXM7CisKKwlpZiAoIW5l
d19jcnRjX3N0YXRlLT5oYXNfcHNyKQorCQlyZXR1cm47CisKKworCWZvcl9lYWNoX2ludGVsX2Vu
Y29kZXJfbWFzaygmZGV2X3ByaXYtPmRybSwgZW5jb2RlciwKKwkJCQkgICAgbmV3X2NydGNfc3Rh
dGUtPnVhcGkuZW5jb2Rlcl9tYXNrKSB7CisJCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHA7CisK
KwkJaWYgKGVuY29kZXItPnR5cGUgIT0gSU5URUxfT1VUUFVUX0VEUCkKKwkJCWNvbnRpbnVlOwor
CisJCWludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKGVuY29kZXIpOworCQkvKiB3aGVuIHRoZSBQ
U1IxIGlzIGVuYWJsZWQgKi8KKwkJaWYgKGludGVsX2RwLT5wc3IuZW5hYmxlZCAmJiAhaW50ZWxf
ZHAtPnBzci5wc3IyX2VuYWJsZWQpIHsKKwkJCWlmIChwc3Jfd2FpdF9mb3JfaWRsZShpbnRlbF9k
cCwgJnBzcl9zdGF0dXMpKQorCQkJCWRybV9lcnIoJmRldl9wcml2LT5kcm0sCisJCQkJCSJQU1Ig
aWRsZSB0aW1lZCBvdXQgMHgleCwgYXRvbWljIHVwZGF0ZSBtYXkgZmFpbFxuIiwKKwkJCQkJcHNy
X3N0YXR1cyk7CisJCX0KKwl9Cit9CisKK3N0YXRpYyBib29sIF9fcHNyX3dhaXRfZm9yX2lkbGVf
bG9ja2VkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CiAJaTkxNV9yZWdfdCByZWc7CiAJ
dTMyIG1hc2s7CiAJaW50IGVycjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSBkcF90b19pOTE1KGludGVsX2RwKTsKIAotCWlmICghZGV2X3ByaXYtPnBzci5lbmFibGVkKQor
CWlmICghaW50ZWxfZHAtPnBzci5lbmFibGVkKQogCQlyZXR1cm4gZmFsc2U7CiAKLQlpZiAoZGV2
X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQpIHsKLQkJcmVnID0gRURQX1BTUjJfU1RBVFVTKGRldl9w
cml2LT5wc3IudHJhbnNjb2Rlcik7CisJaWYgKGludGVsX2RwLT5wc3IucHNyMl9lbmFibGVkKSB7
CisJCXJlZyA9IEVEUF9QU1IyX1NUQVRVUyhpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpOwogCQlt
YXNrID0gRURQX1BTUjJfU1RBVFVTX1NUQVRFX01BU0s7CiAJfSBlbHNlIHsKLQkJcmVnID0gRURQ
X1BTUl9TVEFUVVMoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKTsKKwkJcmVnID0gRURQX1BTUl9T
VEFUVVMoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKTsKIAkJbWFzayA9IEVEUF9QU1JfU1RBVFVT
X1NUQVRFX01BU0s7CiAJfQogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOwor
CW11dGV4X3VubG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKIAogCWVyciA9IGludGVsX2RlX3dh
aXRfZm9yX2NsZWFyKGRldl9wcml2LCByZWcsIG1hc2ssIDUwKTsKIAlpZiAoZXJyKQpAQCAtMTUy
Nyw4ICsxNTYxLDggQEAgc3RhdGljIGJvb2wgX19wc3Jfd2FpdF9mb3JfaWRsZV9sb2NrZWQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQkJIlRpbWVkIG91dCB3YWl0aW5nIGZv
ciBQU1IgSWRsZSBmb3IgcmUtZW5hYmxlXG4iKTsKIAogCS8qIEFmdGVyIHRoZSB1bmxvY2tlZCB3
YWl0LCB2ZXJpZnkgdGhhdCBQU1IgaXMgc3RpbGwgd2FudGVkISAqLwotCW11dGV4X2xvY2soJmRl
dl9wcml2LT5wc3IubG9jayk7Ci0JcmV0dXJuIGVyciA9PSAwICYmIGRldl9wcml2LT5wc3IuZW5h
YmxlZDsKKwltdXRleF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOworCXJldHVybiBlcnIgPT0g
MCAmJiBpbnRlbF9kcC0+cHNyLmVuYWJsZWQ7CiB9CiAKIHN0YXRpYyBpbnQgaW50ZWxfcHNyX2Zh
c3RzZXRfZm9yY2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQpAQCAtMTU5NCwx
MSArMTYyOCwxMiBAQCBzdGF0aWMgaW50IGludGVsX3Bzcl9mYXN0c2V0X2ZvcmNlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlyZXR1cm4gZXJyOwogfQogCi1pbnQgaW50ZWxf
cHNyX2RlYnVnX3NldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHU2NCB2YWwp
CitpbnQgaW50ZWxfcHNyX2RlYnVnX3NldChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCB1NjQg
dmFsKQogewogCWNvbnN0IHUzMiBtb2RlID0gdmFsICYgSTkxNV9QU1JfREVCVUdfTU9ERV9NQVNL
OwogCXUzMiBvbGRfbW9kZTsKIAlpbnQgcmV0OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCiAJaWYgKHZhbCAmIH4oSTkxNV9QU1Jf
REVCVUdfSVJRIHwgSTkxNV9QU1JfREVCVUdfTU9ERV9NQVNLKSB8fAogCSAgICBtb2RlID4gSTkx
NV9QU1JfREVCVUdfRk9SQ0VfUFNSMSkgewpAQCAtMTYwNiwyMSArMTY0MSwyMSBAQCBpbnQgaW50
ZWxfcHNyX2RlYnVnX3NldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHU2NCB2
YWwpCiAJCXJldHVybiAtRUlOVkFMOwogCX0KIAotCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0
aWJsZSgmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGli
bGUoJmludGVsX2RwLT5wc3IubG9jayk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAotCW9s
ZF9tb2RlID0gZGV2X3ByaXYtPnBzci5kZWJ1ZyAmIEk5MTVfUFNSX0RFQlVHX01PREVfTUFTSzsK
LQlkZXZfcHJpdi0+cHNyLmRlYnVnID0gdmFsOworCW9sZF9tb2RlID0gaW50ZWxfZHAtPnBzci5k
ZWJ1ZyAmIEk5MTVfUFNSX0RFQlVHX01PREVfTUFTSzsKKwlpbnRlbF9kcC0+cHNyLmRlYnVnID0g
dmFsOwogCiAJLyoKIAkgKiBEbyBpdCByaWdodCBhd2F5IGlmIGl0J3MgYWxyZWFkeSBlbmFibGVk
LCBvdGhlcndpc2UgaXQgd2lsbCBiZSBkb25lCiAJICogd2hlbiBlbmFibGluZyB0aGUgc291cmNl
LgogCSAqLwotCWlmIChkZXZfcHJpdi0+cHNyLmVuYWJsZWQpCi0JCXBzcl9pcnFfY29udHJvbChk
ZXZfcHJpdik7CisJaWYgKGludGVsX2RwLT5wc3IuZW5hYmxlZCkKKwkJcHNyX2lycV9jb250cm9s
KGludGVsX2RwKTsKIAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRl
eF91bmxvY2soJmludGVsX2RwLT5wc3IubG9jayk7CiAKIAlpZiAob2xkX21vZGUgIT0gbW9kZSkK
IAkJcmV0ID0gaW50ZWxfcHNyX2Zhc3RzZXRfZm9yY2UoZGV2X3ByaXYpOwpAQCAtMTYyOCwyOCAr
MTY2MywyOCBAQCBpbnQgaW50ZWxfcHNyX2RlYnVnX3NldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsIHU2NCB2YWwpCiAJcmV0dXJuIHJldDsKIH0KIAotc3RhdGljIHZvaWQgaW50
ZWxfcHNyX2hhbmRsZV9pcnEoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3Rh
dGljIHZvaWQgaW50ZWxfcHNyX2hhbmRsZV9pcnEoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkK
IHsKLQlzdHJ1Y3QgaTkxNV9wc3IgKnBzciA9ICZkZXZfcHJpdi0+cHNyOworCXN0cnVjdCBpbnRl
bF9wc3IgKnBzciA9ICZpbnRlbF9kcC0+cHNyOwogCi0JaW50ZWxfcHNyX2Rpc2FibGVfbG9ja2Vk
KHBzci0+ZHApOworCWludGVsX3Bzcl9kaXNhYmxlX2xvY2tlZChpbnRlbF9kcCk7CiAJcHNyLT5z
aW5rX25vdF9yZWxpYWJsZSA9IHRydWU7CiAJLyogbGV0J3MgbWFrZSBzdXJlIHRoYXQgc2luayBp
cyBhd2FrZW4gKi8KLQlkcm1fZHBfZHBjZF93cml0ZWIoJnBzci0+ZHAtPmF1eCwgRFBfU0VUX1BP
V0VSLCBEUF9TRVRfUE9XRVJfRDApOworCWRybV9kcF9kcGNkX3dyaXRlYigmaW50ZWxfZHAtPmF1
eCwgRFBfU0VUX1BPV0VSLCBEUF9TRVRfUE9XRVJfRDApOwogfQogCiBzdGF0aWMgdm9pZCBpbnRl
bF9wc3Jfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiB7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0KLQkJY29udGFpbmVyX29mKHdvcmssIHR5cGVvZigqZGV2X3By
aXYpLCBwc3Iud29yayk7CisJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9CisJCWNvbnRhaW5l
cl9vZih3b3JrLCB0eXBlb2YoKmludGVsX2RwKSwgcHNyLndvcmspOwogCi0JbXV0ZXhfbG9jaygm
ZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRleF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOwog
Ci0JaWYgKCFkZXZfcHJpdi0+cHNyLmVuYWJsZWQpCisJaWYgKCFpbnRlbF9kcC0+cHNyLmVuYWJs
ZWQpCiAJCWdvdG8gdW5sb2NrOwogCi0JaWYgKFJFQURfT05DRShkZXZfcHJpdi0+cHNyLmlycV9h
dXhfZXJyb3IpKQotCQlpbnRlbF9wc3JfaGFuZGxlX2lycShkZXZfcHJpdik7CisJaWYgKFJFQURf
T05DRShpbnRlbF9kcC0+cHNyLmlycV9hdXhfZXJyb3IpKQorCQlpbnRlbF9wc3JfaGFuZGxlX2ly
cShpbnRlbF9kcCk7CiAKIAkvKgogCSAqIFdlIGhhdmUgdG8gbWFrZSBzdXJlIFBTUiBpcyByZWFk
eSBmb3IgcmUtZW5hYmxlCkBAIC0xNjU3LDcgKzE2OTIsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9w
c3Jfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJICogUFNSIG1pZ2h0IHRha2Ugc29t
ZSB0aW1lIHRvIGdldCBmdWxseSBkaXNhYmxlZAogCSAqIGFuZCBiZSByZWFkeSBmb3IgcmUtZW5h
YmxlLgogCSAqLwotCWlmICghX19wc3Jfd2FpdF9mb3JfaWRsZV9sb2NrZWQoZGV2X3ByaXYpKQor
CWlmICghX19wc3Jfd2FpdF9mb3JfaWRsZV9sb2NrZWQoaW50ZWxfZHApKQogCQlnb3RvIHVubG9j
azsKIAogCS8qCkBAIC0xNjY1LDEyICsxNzAwLDEyIEBAIHN0YXRpYyB2b2lkIGludGVsX3Bzcl93
b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAkgKiByZWNoZWNrLiBTaW5jZSBwc3JfZmx1
c2ggZmlyc3QgY2xlYXJzIHRoaXMgYW5kIHRoZW4gcmVzY2hlZHVsZXMgd2UKIAkgKiB3b24ndCBl
dmVyIG1pc3MgYSBmbHVzaCB3aGVuIGJhaWxpbmcgb3V0IGhlcmUuCiAJICovCi0JaWYgKGRldl9w
cml2LT5wc3IuYnVzeV9mcm9udGJ1ZmZlcl9iaXRzIHx8IGRldl9wcml2LT5wc3IuYWN0aXZlKQor
CWlmIChpbnRlbF9kcC0+cHNyLmJ1c3lfZnJvbnRidWZmZXJfYml0cyB8fCBpbnRlbF9kcC0+cHNy
LmFjdGl2ZSkKIAkJZ290byB1bmxvY2s7CiAKLQlpbnRlbF9wc3JfYWN0aXZhdGUoZGV2X3ByaXYt
PnBzci5kcCk7CisJaW50ZWxfcHNyX2FjdGl2YXRlKGludGVsX2RwKTsKIHVubG9jazoKLQltdXRl
eF91bmxvY2soJmRldl9wcml2LT5wc3IubG9jayk7CisJbXV0ZXhfdW5sb2NrKCZpbnRlbF9kcC0+
cHNyLmxvY2spOwogfQogCiAvKioKQEAgLTE2ODksMjcgKzE3MjQsMzUgQEAgc3RhdGljIHZvaWQg
aW50ZWxfcHNyX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogdm9pZCBpbnRlbF9wc3Jf
aW52YWxpZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkgIHVuc2ln
bmVkIGZyb250YnVmZmVyX2JpdHMsIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbikKIHsKLQlpZiAo
IUNBTl9QU1IoZGV2X3ByaXYpKQotCQlyZXR1cm47CisJc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXI7CisJc3RydWN0IGludGVsX2RwICppbnRlbF9kcDsKIAotCWlmIChvcmlnaW4gPT0gT1JJ
R0lOX0ZMSVApCi0JCXJldHVybjsKKwlmb3JfZWFjaF9pbnRlbF9kcCgmZGV2X3ByaXYtPmRybSwg
ZW5jb2RlcikgewogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKLQlpZiAoIWRl
dl9wcml2LT5wc3IuZW5hYmxlZCkgewotCQltdXRleF91bmxvY2soJmRldl9wcml2LT5wc3IubG9j
ayk7Ci0JCXJldHVybjsKLQl9CisJCWludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKGVuY29kZXIp
OworCQlpZiAoZW5jb2Rlci0+dHlwZSAhPSBJTlRFTF9PVVRQVVRfRURQKQorCQkJY29udGludWU7
CisJCWlmICghQ0FOX1BTUihpbnRlbF9kcCkpCisJCQljb250aW51ZTsKIAotCWZyb250YnVmZmVy
X2JpdHMgJj0gSU5URUxfRlJPTlRCVUZGRVJfQUxMX01BU0soZGV2X3ByaXYtPnBzci5waXBlKTsK
LQlkZXZfcHJpdi0+cHNyLmJ1c3lfZnJvbnRidWZmZXJfYml0cyB8PSBmcm9udGJ1ZmZlcl9iaXRz
OworCQlpZiAob3JpZ2luID09IE9SSUdJTl9GTElQKQorCQkJY29udGludWU7CisKKwkJbXV0ZXhf
bG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKKwkJaWYgKCFpbnRlbF9kcC0+cHNyLmVuYWJsZWQp
IHsKKwkJCW11dGV4X3VubG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKKwkJCWNvbnRpbnVlOwor
CQl9CiAKLQlpZiAoZnJvbnRidWZmZXJfYml0cykKLQkJaW50ZWxfcHNyX2V4aXQoZGV2X3ByaXYp
OworCQlmcm9udGJ1ZmZlcl9iaXRzICY9IElOVEVMX0ZST05UQlVGRkVSX0FMTF9NQVNLKGludGVs
X2RwLT5wc3IucGlwZSk7CisJCWludGVsX2RwLT5wc3IuYnVzeV9mcm9udGJ1ZmZlcl9iaXRzIHw9
IGZyb250YnVmZmVyX2JpdHM7CiAKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5wc3IubG9jayk7
Ci19CisJCWlmIChmcm9udGJ1ZmZlcl9iaXRzKQorCQkJaW50ZWxfcHNyX2V4aXQoaW50ZWxfZHAp
OwogCisJCW11dGV4X3VubG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKKwl9Cit9CiAvKgogICog
V2hlbiB3ZSB3aWxsIGJlIGNvbXBsZXRlbHkgcmVseSBvbiBQU1IyIFMvVyB0cmFja2luZyBpbiBm
dXR1cmUsCiAgKiBpbnRlbF9wc3JfZmx1c2goKSB3aWxsIGludmFsaWRhdGUgYW5kIGZsdXNoIHRo
ZSBQU1IgZm9yIE9SSUdJTl9GTElQCkBAIC0xNzE3LDE1ICsxNzYwLDE1IEBAIHZvaWQgaW50ZWxf
cHNyX2ludmFsaWRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogICogYWNj
b3JkaW5nbHkgaW4gZnV0dXJlLgogICovCiBzdGF0aWMgdm9pZAotdGdsX2RjM2NvX2ZsdXNoKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJdW5zaWduZWQgaW50IGZyb250YnVm
ZmVyX2JpdHMsIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbikKK3RnbF9kYzNjb19mbHVzaChzdHJ1
Y3QgaW50ZWxfZHAgKmludGVsX2RwLCB1bnNpZ25lZCBpbnQgZnJvbnRidWZmZXJfYml0cywKKwkJ
ZW51bSBmYl9vcF9vcmlnaW4gb3JpZ2luKQogewotCW11dGV4X2xvY2soJmRldl9wcml2LT5wc3Iu
bG9jayk7CisJbXV0ZXhfbG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKIAotCWlmICghZGV2X3By
aXYtPnBzci5kYzNjb19lbmFibGVkKQorCWlmICghaW50ZWxfZHAtPnBzci5kYzNjb19lbmFibGVk
KQogCQlnb3RvIHVubG9jazsKIAotCWlmICghZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQgfHwg
IWRldl9wcml2LT5wc3IuYWN0aXZlKQorCWlmICghaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJsZWQg
fHwgIWludGVsX2RwLT5wc3IuYWN0aXZlKQogCQlnb3RvIHVubG9jazsKIAogCS8qCkBAIC0xNzMz
LDE1ICsxNzc2LDE1IEBAIHRnbF9kYzNjb19mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYsCiAJICogd2hlbiBkZWxheWVkIHdvcmsgc2NoZWR1bGVzIHRoYXQgbWVhbnMgZGlz
cGxheSBoYXMgYmVlbiBpZGxlLgogCSAqLwogCWlmICghKGZyb250YnVmZmVyX2JpdHMgJgotCSAg
ICBJTlRFTF9GUk9OVEJVRkZFUl9BTExfTUFTSyhkZXZfcHJpdi0+cHNyLnBpcGUpKSkKKwkgICAg
SU5URUxfRlJPTlRCVUZGRVJfQUxMX01BU0soaW50ZWxfZHAtPnBzci5waXBlKSkpCiAJCWdvdG8g
dW5sb2NrOwogCi0JdGdsX3BzcjJfZW5hYmxlX2RjM2NvKGRldl9wcml2KTsKLQltb2RfZGVsYXll
ZF93b3JrKHN5c3RlbV93cSwgJmRldl9wcml2LT5wc3IuZGMzY29fd29yaywKLQkJCSBkZXZfcHJp
di0+cHNyLmRjM2NvX2V4aXRfZGVsYXkpOworCXRnbF9wc3IyX2VuYWJsZV9kYzNjbyhpbnRlbF9k
cCk7CisJbW9kX2RlbGF5ZWRfd29yayhzeXN0ZW1fd3EsICZpbnRlbF9kcC0+cHNyLmRjM2NvX3dv
cmssCisJCQkgaW50ZWxfZHAtPnBzci5kYzNjb19leGl0X2RlbGF5KTsKIAogdW5sb2NrOgotCW11
dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRleF91bmxvY2soJmludGVsX2Rw
LT5wc3IubG9jayk7CiB9CiAKIC8qKgpAQCAtMTc2MCw0NSArMTgwMyw1NCBAQCB0Z2xfZGMzY29f
Zmx1c2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogdm9pZCBpbnRlbF9wc3Jf
Zmx1c2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkgICAgIHVuc2lnbmVk
IGZyb250YnVmZmVyX2JpdHMsIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbikKIHsKLQlpZiAoIUNB
Tl9QU1IoZGV2X3ByaXYpKQotCQlyZXR1cm47CisJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29k
ZXI7CisJc3RydWN0IGludGVsX2RwICppbnRlbF9kcDsKIAotCWlmIChvcmlnaW4gPT0gT1JJR0lO
X0ZMSVApIHsKLQkJdGdsX2RjM2NvX2ZsdXNoKGRldl9wcml2LCBmcm9udGJ1ZmZlcl9iaXRzLCBv
cmlnaW4pOwotCQlyZXR1cm47Ci0JfQorCWZvcl9lYWNoX2ludGVsX2RwKCZkZXZfcHJpdi0+ZHJt
LCBlbmNvZGVyKSB7CisJCWludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKGVuY29kZXIpOwogCi0J
bXV0ZXhfbG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKLQlpZiAoIWRldl9wcml2LT5wc3IuZW5h
YmxlZCkgewotCQltdXRleF91bmxvY2soJmRldl9wcml2LT5wc3IubG9jayk7Ci0JCXJldHVybjsK
LQl9CisJCWlmIChlbmNvZGVyLT50eXBlID09IElOVEVMX09VVFBVVF9FRFAgJiYgQ0FOX1BTUihp
bnRlbF9kcCkpIHsKKwkJCWlmIChvcmlnaW4gPT0gT1JJR0lOX0ZMSVApIHsKKwkJCQl0Z2xfZGMz
Y29fZmx1c2goaW50ZWxfZHAsIGZyb250YnVmZmVyX2JpdHMsIG9yaWdpbik7CisJCQkJY29udGlu
dWU7CisJCQl9CiAKLQlmcm9udGJ1ZmZlcl9iaXRzICY9IElOVEVMX0ZST05UQlVGRkVSX0FMTF9N
QVNLKGRldl9wcml2LT5wc3IucGlwZSk7Ci0JZGV2X3ByaXYtPnBzci5idXN5X2Zyb250YnVmZmVy
X2JpdHMgJj0gfmZyb250YnVmZmVyX2JpdHM7CisJCQltdXRleF9sb2NrKCZpbnRlbF9kcC0+cHNy
LmxvY2spOworCQkJaWYgKCFpbnRlbF9kcC0+cHNyLmVuYWJsZWQpIHsKKwkJCQltdXRleF91bmxv
Y2soJmludGVsX2RwLT5wc3IubG9jayk7CisJCQkJY29udGludWU7CisJCQl9CiAKLQkvKiBCeSBk
ZWZpbml0aW9uIGZsdXNoID0gaW52YWxpZGF0ZSArIGZsdXNoICovCi0JaWYgKGZyb250YnVmZmVy
X2JpdHMpCi0JCXBzcl9mb3JjZV9od190cmFja2luZ19leGl0KGRldl9wcml2KTsKKwkJCWZyb250
YnVmZmVyX2JpdHMgJj0gSU5URUxfRlJPTlRCVUZGRVJfQUxMX01BU0soaW50ZWxfZHAtPnBzci5w
aXBlKTsKKwkJCWludGVsX2RwLT5wc3IuYnVzeV9mcm9udGJ1ZmZlcl9iaXRzICY9IH5mcm9udGJ1
ZmZlcl9iaXRzOwogCi0JaWYgKCFkZXZfcHJpdi0+cHNyLmFjdGl2ZSAmJiAhZGV2X3ByaXYtPnBz
ci5idXN5X2Zyb250YnVmZmVyX2JpdHMpCi0JCXNjaGVkdWxlX3dvcmsoJmRldl9wcml2LT5wc3Iu
d29yayk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCQkJLyogQnkgZGVm
aW5pdGlvbiBmbHVzaCA9IGludmFsaWRhdGUgKyBmbHVzaCAqLworCQkJaWYgKGZyb250YnVmZmVy
X2JpdHMpCisJCQkJcHNyX2ZvcmNlX2h3X3RyYWNraW5nX2V4aXQoaW50ZWxfZHApOworCisJCQlp
ZiAoIWludGVsX2RwLT5wc3IuYWN0aXZlICYmICFpbnRlbF9kcC0+cHNyLmJ1c3lfZnJvbnRidWZm
ZXJfYml0cykKKwkJCQlzY2hlZHVsZV93b3JrKCZpbnRlbF9kcC0+cHNyLndvcmspOworCQkJbXV0
ZXhfdW5sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOworCQl9CisJfQogfQogCiAvKioKICAqIGlu
dGVsX3Bzcl9pbml0IC0gSW5pdCBiYXNpYyBQU1Igd29yayBhbmQgbXV0ZXguCi0gKiBAZGV2X3By
aXY6IGk5MTUgZGV2aWNlIHByaXZhdGUKKyAqIEBpbnRlbF9kcDogSW50ZWwgRFAKICAqCi0gKiBU
aGlzIGZ1bmN0aW9uIGlzICBjYWxsZWQgb25seSBvbmNlIGF0IGRyaXZlciBsb2FkIHRvIGluaXRp
YWxpemUgYmFzaWMKLSAqIFBTUiBzdHVmZi4KKyAqIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIGFm
dGVyIHRoZSBpbml0aWFsaXppbmcgY29ubmVjdG9yLgorICogKHRoZSBpbml0aWFsaXppbmcgb2Yg
Y29ubmVjdG9yIHRyZWF0cyB0aGUgaGFuZGxpbmcgb2YgY29ubmVjdG9yIGNhcGFiaWxpdGllcykK
KyAqIEFuZCBpdCBpbml0aWFsaXplcyBiYXNpYyBQU1Igc3R1ZmYgZm9yIGVhY2ggRFAgRW5jb2Rl
ci4KICAqLwotdm9pZCBpbnRlbF9wc3JfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCit2b2lkIGludGVsX3Bzcl9pbml0KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9k
cCk7CisKIAlpZiAoIUhBU19QU1IoZGV2X3ByaXYpKQogCQlyZXR1cm47CiAKLQlpZiAoIWRldl9w
cml2LT5wc3Iuc2lua19zdXBwb3J0KQorCWlmICghaW50ZWxfZHAtPnBzci5zaW5rX3N1cHBvcnQp
CiAJCXJldHVybjsKIAogCWlmIChJU19IQVNXRUxMKGRldl9wcml2KSkKQEAgLTE4MTYsMTQgKzE4
NjgsMTQgQEAgdm9pZCBpbnRlbF9wc3JfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCiAJLyogU2V0IGxpbmtfc3RhbmRieSB4IGxpbmtfb2ZmIGRlZmF1bHRzICovCiAJaWYg
KElTX0hBU1dFTEwoZGV2X3ByaXYpIHx8IElTX0JST0FEV0VMTChkZXZfcHJpdikpCiAJCS8qIEhT
VyBhbmQgQkRXIHJlcXVpcmUgd29ya2Fyb3VuZHMgdGhhdCB3ZSBkb24ndCBpbXBsZW1lbnQuICov
Ci0JCWRldl9wcml2LT5wc3IubGlua19zdGFuZGJ5ID0gZmFsc2U7CisJCWludGVsX2RwLT5wc3Iu
bGlua19zdGFuZGJ5ID0gZmFsc2U7CiAJZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDEy
KQogCQkvKiBGb3IgbmV3IHBsYXRmb3JtcyB1cCB0byBUR0wgbGV0J3MgcmVzcGVjdCBWQlQgYmFj
ayBhZ2FpbiAqLwotCQlkZXZfcHJpdi0+cHNyLmxpbmtfc3RhbmRieSA9IGRldl9wcml2LT52YnQu
cHNyLmZ1bGxfbGluazsKKwkJaW50ZWxfZHAtPnBzci5saW5rX3N0YW5kYnkgPSBkZXZfcHJpdi0+
dmJ0LnBzci5mdWxsX2xpbms7CiAKLQlJTklUX1dPUksoJmRldl9wcml2LT5wc3Iud29yaywgaW50
ZWxfcHNyX3dvcmspOwotCUlOSVRfREVMQVlFRF9XT1JLKCZkZXZfcHJpdi0+cHNyLmRjM2NvX3dv
cmssIHRnbF9kYzNjb19kaXNhYmxlX3dvcmspOwotCW11dGV4X2luaXQoJmRldl9wcml2LT5wc3Iu
bG9jayk7CisJSU5JVF9XT1JLKCZpbnRlbF9kcC0+cHNyLndvcmssIGludGVsX3Bzcl93b3JrKTsK
KwlJTklUX0RFTEFZRURfV09SSygmaW50ZWxfZHAtPnBzci5kYzNjb193b3JrLCB0Z2xfZGMzY29f
ZGlzYWJsZV93b3JrKTsKKwltdXRleF9pbml0KCZpbnRlbF9kcC0+cHNyLmxvY2spOwogfQogCiBz
dGF0aWMgaW50IHBzcl9nZXRfc3RhdHVzX2FuZF9lcnJvcl9zdGF0dXMoc3RydWN0IGludGVsX2Rw
ICppbnRlbF9kcCwKQEAgLTE4NDksNyArMTkwMSw3IEBAIHN0YXRpYyB2b2lkIHBzcl9hbHBtX2No
ZWNrKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJc3RydWN0IGRybV9kcF9hdXgg
KmF1eCA9ICZpbnRlbF9kcC0+YXV4OwotCXN0cnVjdCBpOTE1X3BzciAqcHNyID0gJmRldl9wcml2
LT5wc3I7CisJc3RydWN0IGludGVsX3BzciAqcHNyID0gJmludGVsX2RwLT5wc3I7CiAJdTggdmFs
OwogCWludCByOwogCkBAIC0xODc2LDcgKzE5MjgsNyBAQCBzdGF0aWMgdm9pZCBwc3JfYWxwbV9j
aGVjayhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogc3RhdGljIHZvaWQgcHNyX2NhcGFiaWxp
dHlfY2hhbmdlZF9jaGVjayhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewogCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwotCXN0cnVj
dCBpOTE1X3BzciAqcHNyID0gJmRldl9wcml2LT5wc3I7CisJc3RydWN0IGludGVsX3BzciAqcHNy
ID0gJmludGVsX2RwLT5wc3I7CiAJdTggdmFsOwogCWludCByOwogCkBAIC0xOTAwLDE4ICsxOTUy
LDE4IEBAIHN0YXRpYyB2b2lkIHBzcl9jYXBhYmlsaXR5X2NoYW5nZWRfY2hlY2soc3RydWN0IGlu
dGVsX2RwICppbnRlbF9kcCkKIHZvaWQgaW50ZWxfcHNyX3Nob3J0X3B1bHNlKHN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHApCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
ZHBfdG9faTkxNShpbnRlbF9kcCk7Ci0Jc3RydWN0IGk5MTVfcHNyICpwc3IgPSAmZGV2X3ByaXYt
PnBzcjsKKwlzdHJ1Y3QgaW50ZWxfcHNyICpwc3IgPSAmaW50ZWxfZHAtPnBzcjsKIAl1OCBzdGF0
dXMsIGVycm9yX3N0YXR1czsKIAljb25zdCB1OCBlcnJvcnMgPSBEUF9QU1JfUkZCX1NUT1JBR0Vf
RVJST1IgfAogCQkJICBEUF9QU1JfVlNDX1NEUF9VTkNPUlJFQ1RBQkxFX0VSUk9SIHwKIAkJCSAg
RFBfUFNSX0xJTktfQ1JDX0VSUk9SOwogCi0JaWYgKCFDQU5fUFNSKGRldl9wcml2KSB8fCAhaW50
ZWxfZHBfaXNfZWRwKGludGVsX2RwKSkKKwlpZiAoIUNBTl9QU1IoaW50ZWxfZHApIHx8ICFpbnRl
bF9kcF9pc19lZHAoaW50ZWxfZHApKQogCQlyZXR1cm47CiAKIAltdXRleF9sb2NrKCZwc3ItPmxv
Y2spOwogCi0JaWYgKCFwc3ItPmVuYWJsZWQgfHwgcHNyLT5kcCAhPSBpbnRlbF9kcCkKKwlpZiAo
IXBzci0+ZW5hYmxlZCkKIAkJZ290byBleGl0OwogCiAJaWYgKHBzcl9nZXRfc3RhdHVzX2FuZF9l
cnJvcl9zdGF0dXMoaW50ZWxfZHAsICZzdGF0dXMsICZlcnJvcl9zdGF0dXMpKSB7CkBAIC0xOTU0
LDE1ICsyMDA2LDE0IEBAIHZvaWQgaW50ZWxfcHNyX3Nob3J0X3B1bHNlKHN0cnVjdCBpbnRlbF9k
cCAqaW50ZWxfZHApCiAKIGJvb2wgaW50ZWxfcHNyX2VuYWJsZWQoc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19p
OTE1KGludGVsX2RwKTsKIAlib29sIHJldDsKIAotCWlmICghQ0FOX1BTUihkZXZfcHJpdikgfHwg
IWludGVsX2RwX2lzX2VkcChpbnRlbF9kcCkpCisJaWYgKCFDQU5fUFNSKGludGVsX2RwKSB8fCAh
aW50ZWxfZHBfaXNfZWRwKGludGVsX2RwKSkKIAkJcmV0dXJuIGZhbHNlOwogCi0JbXV0ZXhfbG9j
aygmZGV2X3ByaXYtPnBzci5sb2NrKTsKLQlyZXQgPSAoZGV2X3ByaXYtPnBzci5kcCA9PSBpbnRl
bF9kcCAmJiBkZXZfcHJpdi0+cHNyLmVuYWJsZWQpOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYt
PnBzci5sb2NrKTsKKwltdXRleF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOworCXJldCA9IGlu
dGVsX2RwLT5wc3IuZW5hYmxlZDsKKwltdXRleF91bmxvY2soJmludGVsX2RwLT5wc3IubG9jayk7
CiAKIAlyZXR1cm4gcmV0OwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9wc3IuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNy
LmgKaW5kZXggMGE1MTc5NzhlOGFmLi4yNzUzOTc2YWNjMjYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9wc3IuaApAQCAtMTgsNyArMTgsNyBAQCBzdHJ1Y3QgaW50ZWxfYXRv
bWljX3N0YXRlOwogc3RydWN0IGludGVsX3BsYW5lX3N0YXRlOwogc3RydWN0IGludGVsX3BsYW5l
OwogCi0jZGVmaW5lIENBTl9QU1IoZGV2X3ByaXYpIChIQVNfUFNSKGRldl9wcml2KSAmJiBkZXZf
cHJpdi0+cHNyLnNpbmtfc3VwcG9ydCkKKyNkZWZpbmUgQ0FOX1BTUihpbnRlbF9kcCkgKEhBU19Q
U1IoZHBfdG9faTkxNShpbnRlbF9kcCkpICYmIGludGVsX2RwLT5wc3Iuc2lua19zdXBwb3J0KQog
dm9pZCBpbnRlbF9wc3JfaW5pdF9kcGNkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApOwogdm9p
ZCBpbnRlbF9wc3JfZW5hYmxlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCSAgICAgIGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLApAQCAtMjgsMjAgKzI4LDE5
IEBAIHZvaWQgaW50ZWxfcHNyX2Rpc2FibGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIHZv
aWQgaW50ZWxfcHNyX3VwZGF0ZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCQkgICAgICBj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJICAgICAgY29uc3Qg
c3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpOwotaW50IGludGVsX3Bzcl9k
ZWJ1Z19zZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1NjQgdmFsdWUpOwor
aW50IGludGVsX3Bzcl9kZWJ1Z19zZXQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwgdTY0IHZh
bHVlKTsKIHZvaWQgaW50ZWxfcHNyX2ludmFsaWRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogCQkJICB1bnNpZ25lZCBmcm9udGJ1ZmZlcl9iaXRzLAogCQkJICBlbnVtIGZi
X29wX29yaWdpbiBvcmlnaW4pOwogdm9pZCBpbnRlbF9wc3JfZmx1c2goc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAogCQkgICAgIHVuc2lnbmVkIGZyb250YnVmZmVyX2JpdHMsCiAJ
CSAgICAgZW51bSBmYl9vcF9vcmlnaW4gb3JpZ2luKTsKLXZvaWQgaW50ZWxfcHNyX2luaXQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK3ZvaWQgaW50ZWxfcHNyX2luaXQoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCk7CiB2b2lkIGludGVsX3Bzcl9jb21wdXRlX2NvbmZpZyhz
dHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCQkJICAgICAgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUpOwotdm9pZCBpbnRlbF9wc3JfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgcHNyX2lpcik7Cit2b2lkIGludGVsX3Bzcl9pcnFf
aGFuZGxlcihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCB1MzIgcHNyX2lpcik7CiB2b2lkIGlu
dGVsX3Bzcl9zaG9ydF9wdWxzZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKTsKLWludCBpbnRl
bF9wc3Jfd2FpdF9mb3JfaWRsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2Ny
dGNfc3RhdGUsCi0JCQkgICAgdTMyICpvdXRfdmFsdWUpOwordm9pZCBpbnRlbF9wc3Jfd2FpdF9m
b3JfaWRsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpOwog
Ym9vbCBpbnRlbF9wc3JfZW5hYmxlZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKTsKIGludCBp
bnRlbF9wc3IyX3NlbF9mZXRjaF91cGRhdGUoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3Rh
dGUsCiAJCQkJc3RydWN0IGludGVsX2NydGMgKmNydGMpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMKaW5kZXggYWRjNWYwODhkNDU4Li42YjI1MDRiZTQ0MjEg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYwpAQCAtODUs
NyArODUsNiBAQCB2b2lkIGludGVsX3BpcGVfdXBkYXRlX3N0YXJ0KGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSkKIAlib29sIG5lZWRfdmx2X2RzaV93YSA9IChJ
U19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRldl9wcml2KSkgJiYKIAkJ
aW50ZWxfY3J0Y19oYXNfdHlwZShuZXdfY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0RTSSk7CiAJ
REVGSU5FX1dBSVQod2FpdCk7Ci0JdTMyIHBzcl9zdGF0dXM7CiAKIAlpZiAobmV3X2NydGNfc3Rh
dGUtPnVhcGkuYXN5bmNfZmxpcCkKIAkJcmV0dXJuOwpAQCAtMTEwLDEwICsxMDksNyBAQCB2b2lk
IGludGVsX3BpcGVfdXBkYXRlX3N0YXJ0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpu
ZXdfY3J0Y19zdGF0ZSkKIAkgKiBWQkwgaW50ZXJydXB0cyB3aWxsIHN0YXJ0IHRoZSBQU1IgZXhp
dCBhbmQgcHJldmVudCBhIFBTUgogCSAqIHJlLWVudHJ5IGFzIHdlbGwuCiAJICovCi0JaWYgKGlu
dGVsX3Bzcl93YWl0X2Zvcl9pZGxlKG5ld19jcnRjX3N0YXRlLCAmcHNyX3N0YXR1cykpCi0JCWRy
bV9lcnIoJmRldl9wcml2LT5kcm0sCi0JCQkiUFNSIGlkbGUgdGltZWQgb3V0IDB4JXgsIGF0b21p
YyB1cGRhdGUgbWF5IGZhaWxcbiIsCi0JCQlwc3Jfc3RhdHVzKTsKKwlpbnRlbF9wc3Jfd2FpdF9m
b3JfaWRsZShuZXdfY3J0Y19zdGF0ZSk7CiAKIAlsb2NhbF9pcnFfZGlzYWJsZSgpOwogCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9kcnYuaAppbmRleCA4Mzc2Y2ZmNWJhODYuLjE4MjRjZWFiYmZkYiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2Rydi5oCkBAIC00NzUsNDIgKzQ3NSw2IEBAIHN0cnVjdCBpOTE1X2RycnMg
ewogCWVudW0gZHJyc19zdXBwb3J0X3R5cGUgdHlwZTsKIH07CiAKLXN0cnVjdCBpOTE1X3BzciB7
Ci0Jc3RydWN0IG11dGV4IGxvY2s7Ci0KLSNkZWZpbmUgSTkxNV9QU1JfREVCVUdfTU9ERV9NQVNL
CTB4MGYKLSNkZWZpbmUgSTkxNV9QU1JfREVCVUdfREVGQVVMVAkJMHgwMAotI2RlZmluZSBJOTE1
X1BTUl9ERUJVR19ESVNBQkxFCQkweDAxCi0jZGVmaW5lIEk5MTVfUFNSX0RFQlVHX0VOQUJMRQkJ
MHgwMgotI2RlZmluZSBJOTE1X1BTUl9ERUJVR19GT1JDRV9QU1IxCTB4MDMKLSNkZWZpbmUgSTkx
NV9QU1JfREVCVUdfSVJRCQkweDEwCi0KLQl1MzIgZGVidWc7Ci0JYm9vbCBzaW5rX3N1cHBvcnQ7
Ci0JYm9vbCBlbmFibGVkOwotCXN0cnVjdCBpbnRlbF9kcCAqZHA7Ci0JZW51bSBwaXBlIHBpcGU7
Ci0JZW51bSB0cmFuc2NvZGVyIHRyYW5zY29kZXI7Ci0JYm9vbCBhY3RpdmU7Ci0Jc3RydWN0IHdv
cmtfc3RydWN0IHdvcms7Ci0JdW5zaWduZWQgYnVzeV9mcm9udGJ1ZmZlcl9iaXRzOwotCWJvb2wg
c2lua19wc3IyX3N1cHBvcnQ7Ci0JYm9vbCBsaW5rX3N0YW5kYnk7Ci0JYm9vbCBjb2xvcmltZXRy
eV9zdXBwb3J0OwotCWJvb2wgcHNyMl9lbmFibGVkOwotCWJvb2wgcHNyMl9zZWxfZmV0Y2hfZW5h
YmxlZDsKLQl1OCBzaW5rX3N5bmNfbGF0ZW5jeTsKLQlrdGltZV90IGxhc3RfZW50cnlfYXR0ZW1w
dDsKLQlrdGltZV90IGxhc3RfZXhpdDsKLQlib29sIHNpbmtfbm90X3JlbGlhYmxlOwotCWJvb2wg
aXJxX2F1eF9lcnJvcjsKLQl1MTYgc3VfeF9ncmFudWxhcml0eTsKLQlib29sIGRjM2NvX2VuYWJs
ZWQ7Ci0JdTMyIGRjM2NvX2V4aXRfZGVsYXk7Ci0Jc3RydWN0IGRlbGF5ZWRfd29yayBkYzNjb193
b3JrOwotCXN0cnVjdCBkcm1fZHBfdnNjX3NkcCB2c2M7Ci19OwotCiAjZGVmaW5lIFFVSVJLX0xW
RFNfU1NDX0RJU0FCTEUgKDE8PDEpCiAjZGVmaW5lIFFVSVJLX0lOVkVSVF9CUklHSFRORVNTICgx
PDwyKQogI2RlZmluZSBRVUlSS19CQUNLTElHSFRfUFJFU0VOVCAoMTw8MykKQEAgLTEwMzgsOCAr
MTAwMiw2IEBAIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlIHsKIAogCXN0cnVjdCBpOTE1X3Bvd2Vy
X2RvbWFpbnMgcG93ZXJfZG9tYWluczsKIAotCXN0cnVjdCBpOTE1X3BzciBwc3I7Ci0KIAlzdHJ1
Y3QgaTkxNV9ncHVfZXJyb3IgZ3B1X2Vycm9yOwogCiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKnZsdl9wY3R4OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfaXJxLmMKaW5kZXggMzMwMTljZjBlNjMwLi4w
YjEwNDQ1MzhjZWEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfaXJxLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuYwpAQCAtMjA2NiwxMCArMjA2Niwy
MiBAQCBzdGF0aWMgdm9pZCBpdmJfZGlzcGxheV9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCiAJCWl2Yl9lcnJfaW50X2hhbmRsZXIoZGV2X3ByaXYpOwogCiAJ
aWYgKGRlX2lpciAmIERFX0VEUF9QU1JfSU5UX0hTVykgewotCQl1MzIgcHNyX2lpciA9IGludGVs
X3VuY29yZV9yZWFkKCZkZXZfcHJpdi0+dW5jb3JlLCBFRFBfUFNSX0lJUik7CisJCXN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyOwogCi0JCWludGVsX3Bzcl9pcnFfaGFuZGxlcihkZXZfcHJp
diwgcHNyX2lpcik7Ci0JCWludGVsX3VuY29yZV93cml0ZSgmZGV2X3ByaXYtPnVuY29yZSwgRURQ
X1BTUl9JSVIsIHBzcl9paXIpOworCQlmb3JfZWFjaF9pbnRlbF9kcCgmZGV2X3ByaXYtPmRybSwg
ZW5jb2RlcikgeworCQkJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9k
cChlbmNvZGVyKTsKKworCQkJaWYgKGVuY29kZXItPnR5cGUgPT0gSU5URUxfT1VUUFVUX0VEUCAm
JgorCQkJICAgIENBTl9QU1IoaW50ZWxfZHApKSB7CisJCQkJdTMyIHBzcl9paXIgPSBpbnRlbF91
bmNvcmVfcmVhZCgmZGV2X3ByaXYtPnVuY29yZSwKKwkJCQkJCQkJRURQX1BTUl9JSVIpOworCisJ
CQkJaW50ZWxfcHNyX2lycV9oYW5kbGVyKGludGVsX2RwLCBwc3JfaWlyKTsKKwkJCQlpbnRlbF91
bmNvcmVfd3JpdGUoJmRldl9wcml2LT51bmNvcmUsCisJCQkJCQkgICBFRFBfUFNSX0lJUiwgcHNy
X2lpcik7CisJCQkJYnJlYWs7CisJCQl9CisJCX0KIAl9CiAKIAlpZiAoZGVfaWlyICYgREVfQVVY
X0NIQU5ORUxfQV9JVkIpCkBAIC0yMjc5LDIxICsyMjkxLDM0IEBAIGdlbjhfZGVfbWlzY19pcnFf
aGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBpaXIpCiAJfQog
CiAJaWYgKGlpciAmIEdFTjhfREVfRURQX1BTUikgeworCQlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAq
ZW5jb2RlcjsKIAkJdTMyIHBzcl9paXI7CiAJCWk5MTVfcmVnX3QgaWlyX3JlZzsKIAotCQlpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikKLQkJCWlpcl9yZWcgPSBUUkFOU19QU1JfSUlSKGRl
dl9wcml2LT5wc3IudHJhbnNjb2Rlcik7Ci0JCWVsc2UKLQkJCWlpcl9yZWcgPSBFRFBfUFNSX0lJ
UjsKKwkJZm9yX2VhY2hfaW50ZWxfZHAoJmRldl9wcml2LT5kcm0sIGVuY29kZXIpIHsKKwkJCXN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5jb2Rlcik7CiAKLQkJ
cHNyX2lpciA9IGludGVsX3VuY29yZV9yZWFkKCZkZXZfcHJpdi0+dW5jb3JlLCBpaXJfcmVnKTsK
LQkJaW50ZWxfdW5jb3JlX3dyaXRlKCZkZXZfcHJpdi0+dW5jb3JlLCBpaXJfcmVnLCBwc3JfaWly
KTsKKwkJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyICYmIENBTl9QU1IoaW50ZWxfZHAp
KSB7CisJCQkJaWlyX3JlZyA9IFRSQU5TX1BTUl9JSVIoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVy
KTsKKwkJCX0gZWxzZSBpZiAoZW5jb2Rlci0+dHlwZSA9PSBJTlRFTF9PVVRQVVRfRURQICYmCisJ
CQkJICAgQ0FOX1BTUihpbnRlbF9kcCkpIHsKKwkJCQlpaXJfcmVnID0gRURQX1BTUl9JSVI7CisJ
CQl9IGVsc2UgeworCQkJCWNvbnRpbnVlOworCQkJfQorCisJCQlwc3JfaWlyID0gaW50ZWxfdW5j
b3JlX3JlYWQoJmRldl9wcml2LT51bmNvcmUsIGlpcl9yZWcpOworCQkJaW50ZWxfdW5jb3JlX3dy
aXRlKCZkZXZfcHJpdi0+dW5jb3JlLCBpaXJfcmVnLCBwc3JfaWlyKTsKKworCQkJaWYgKHBzcl9p
aXIpCisJCQkJZm91bmQgPSB0cnVlOwogCi0JCWlmIChwc3JfaWlyKQotCQkJZm91bmQgPSB0cnVl
OworCQkJaW50ZWxfcHNyX2lycV9oYW5kbGVyKGludGVsX2RwLCBwc3JfaWlyKTsKIAotCQlpbnRl
bF9wc3JfaXJxX2hhbmRsZXIoZGV2X3ByaXYsIHBzcl9paXIpOworCQkJLyogcHJpb3IgR0VOMTIg
b25seSBoYXZlIG9uZSBFRFAgUFNSICovCisJCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDEy
KQorCQkJCWJyZWFrOworCQl9CiAJfQogCiAJaWYgKCFmb3VuZCkKLS0gCjIuMzAuMAoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxp
bmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

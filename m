Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 261BF210683
	for <lists+intel-gfx@lfdr.de>; Wed,  1 Jul 2020 10:41:29 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 530756E867;
	Wed,  1 Jul 2020 08:41:15 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4BD416E432
 for <intel-gfx@lists.freedesktop.org>; Wed,  1 Jul 2020 08:41:13 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from build.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 21671959-1500050 
 for multiple; Wed, 01 Jul 2020 09:41:04 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  1 Jul 2020 09:40:51 +0100
Message-Id: <20200701084053.6086-31-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20200701084053.6086-1-chris@chris-wilson.co.uk>
References: <20200701084053.6086-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 31/33] drm/i915/gt: Infrastructure for ring
 scheduling
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Chris Wilson <chris@chris-wilson.co.uk>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QnVpbGQgYSBiYXJlIGJvbmVzIHNjaGVkdWxlciB0byBzaXQgb24gdG9wIHRoZSBnbG9iYWwgbGVn
YWN5IHJpbmdidWZmZXIKc3VibWlzc2lvbi4gVGhpcyB2aXJ0dWFsIGV4ZWNsaXN0cyBzY2hlbWUg
c2hvdWxkIGJlIGFwcGxpY2FibGUgdG8gYWxsCm9sZGVyIHBsYXRmb3Jtcy4KCkEga2V5IHByb2Js
ZW0gd2UgaGF2ZSB3aXRoIHRoZSBsZWdhY3kgcmluZyBidWZmZXIgc3VibWlzc2lvbiBpcyB0aGF0
IGl0Cm9ubHkgYWxsb3dzIGZvciBGSUZPIHF1ZXVpbmcuIEFsbCBjbGllbnRzIHNoYXJlIHRoZSBn
bG9iYWwgcmVxdWVzdCBxdWV1ZQphbmQgbXVzdCBjb250ZW5kIGZvciBpdHMgbG9jayB3aGVuIHN1
Ym1pdHRpbmcuIEFzIGFueSBjbGllbnQgbWF5IG5lZWQgdG8Kd2FpdCBmb3IgZXh0ZXJuYWwgZXZl
bnRzLCBhbGwgY2xpZW50cyBtdXN0IHRoZW4gd2FpdC4gSG93ZXZlciwgaWYgd2UKc3RhZ2UgZWFj
aCBjbGllbnQgaW50byB0aGVpciBvd24gdmlydHVhbCByaW5nYnVmZmVyIHdpdGggdGhlaXIgb3du
CnRpbWVsaW5lcywgd2UgY2FuIGNvcHkgdGhlIGNsaWVudCByZXF1ZXN0cyBpbnRvIHRoZSBnbG9i
YWwgcmluZ2J1ZmZlcgpvbmx5IHdoZW4gdGhleSBhcmUgcmVhZHksIHJlb3JkZXJpbmcgdGhlIHN1
Ym1pc3Npb24gYXJvdW5kIHN0YWxscy4KRnVydGhlcm1vcmUsIHRoZSBhYmlsaXR5IHRvIHJlb3Jk
ZXIgZ2l2ZXMgdXMgcnVkaW1lbnRhcmlseSBwcmlvcml0eQpzb3J0aW5nIC0tIGFsdGhvdWdoIHdp
dGhvdXQgcHJlZW1wdGlvbiBzdXBwb3J0LCBvbmNlIHNvbWV0aGluZyBpcyBvbiB0aGUKR1BVIGl0
IHN0YXlzIG9uIHRoZSBHUFUsIGFuZCBzbyBpdCBpcyBzdGlsbCBwb3NzaWJsZSBmb3IgYSBob2cg
dG8gZGVsYXkKYSBoaWdoIHByaW9yaXR5IHJlcXVlc3QgKHN1Y2ggYXMgdXBkYXRpbmcgdGhlIGRp
c3BsYXkpLiBIb3dldmVyLCBpdCBkb2VzCm1lYW5zIHRoYXQgaW4ga2VlcGluZyBhIHNob3J0IHN1
Ym1pc3Npb24gcXVldWUsIHRoZSBoaWdoIHByaW9yaXR5CnJlcXVlc3Qgd2lsbCBiZSBuZXh0LiBU
aGlzIGRlc2lnbiByZXNlbWJsZXMgdGhlIG9sZCBndWMgc3VibWlzc2lvbgpzY2hlZHVsZXIsIGZv
ciByZW9yZGVyaW5nIHJlcXVlc3RzIG9udG8gYSBnbG9iYWwgd29ya3F1ZXVlLgoKVGhlIGltcGxl
bWVudGF0aW9uIHVzZXMgdGhlIE1JX1VTRVJfSU5URVJSVVBUIGF0IHRoZSBlbmQgb2YgZXZlcnkK
cmVxdWVzdCB0byB0cmFjayBjb21wbGV0aW9uLCBzbyBpcyBtb3JlIGludGVycnVwdCBoYXBweSB0
aGFuIGV4ZWNsaXN0cwpbd2hpY2ggaGFzIGFuIGludGVycnVwdCBmb3IgZWFjaCBjb250ZXh0IGV2
ZW50LCBhbGJlaXQgdHdvXS4gT3VyCmludGVycnVwdHMgb24gdGhlc2Ugc3lzdGVtIGFyZSByZWxh
dGl2ZWx5IGhlYXZ5LCBhbmQgaW4gdGhlIHBhc3Qgd2UgaGF2ZQpiZWVuIGFibGUgdG8gY29tcGxl
dGVseSBzdGFydmUgU2FuZHlicmlnZSBieSB0aGUgaW50ZXJydXB0IHRyYWZmaWMuIE91cgppbnRl
cnJ1cHQgaGFuZGxlcnMgYXJlIGJlaW5nIG11Y2ggYmV0dGVyIChpbiBwYXJ0IG9mZmxvYWRpbmcg
dGhlIHdvcmsgdG8KYm90dG9tIGhhbHZlcyBsZWF2aW5nIHRoZSBpbnRlcnJ1cHQgaXRzZWxmIG9u
bHkgZGVhbGluZyB3aXRoIGFja2luZyB0aGUKcmVnaXN0ZXJzKSBidXQgd2UgY2FuIHN0aWxsIHNl
ZSB0aGUgaW1wYWN0IG9mIHN0YXJ2YXRpb24gaW4gdGhlIHVuZXZlbgpzdWJtaXNzaW9uIGxhdGVu
Y3kgb24gYSBzYXR1cmF0ZWQgc3lzdGVtLgoKT3ZlcmFsbCB0aG91Z2gsIHRoZSBzaG9ydCBzdW1p
c3Npb24gcXVldWVzIGFuZCBleHRyYSBpbnRlcnJ1cHRzIGRvIG5vdAphcHBlYXIgdG8gYmUgYWZm
ZWN0aW5nIHRocm91Z2hwdXQgKCstMTAlLCBzb21lIHRhc2tzIGV2ZW4gaW1wcm92ZSB0byB0aGUK
cmVkdWNlZCByZXF1ZXN0IG92ZXJoZWFkcykgYW5kIGltcHJvdmUgbGF0ZW5jeS4gW1doaWNoIGlz
IGEgbWFzc2l2ZQppbXByb3ZlbWVudCBzaW5jZSB0aGUgaW50cm9kdWN0aW9uIG9mIFNhbmR5YnJp
ZGdlIV0KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNv
LnVrPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlICAgICAgICAgICAgICAgICB8
ICAgMSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmUuaCAgICAgICAgfCAg
IDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmggIHwgICAx
ICsKIC4uLi9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ19zY2hlZHVsZXIuYyAgICB8IDczNiAr
KysrKysrKysrKysrKysrKysKIC4uLi9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ19zdWJtaXNz
aW9uLmMgICB8ICAxMyArLQogLi4uL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nX3N1Ym1pc3Np
b24uaCAgIHwgIDE2ICsKIDYgZmlsZXMgY2hhbmdlZCwgNzYyIGluc2VydGlvbnMoKyksIDYgZGVs
ZXRpb25zKC0pCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfcmluZ19zY2hlZHVsZXIuYwogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX3Jpbmdfc3VibWlzc2lvbi5oCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvTWFrZWZpbGUgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQppbmRleCA0
MWEyN2ZkNWRiYzcuLjZkOThhNzRkYTQxZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvTWFrZWZpbGUKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKQEAgLTEwOSw2
ICsxMDksNyBAQCBndC15ICs9IFwKIAlndC9pbnRlbF9yZW5kZXJzdGF0ZS5vIFwKIAlndC9pbnRl
bF9yZXNldC5vIFwKIAlndC9pbnRlbF9yaW5nLm8gXAorCWd0L2ludGVsX3Jpbmdfc2NoZWR1bGVy
Lm8gXAogCWd0L2ludGVsX3Jpbmdfc3VibWlzc2lvbi5vIFwKIAlndC9pbnRlbF9ycHMubyBcCiAJ
Z3QvaW50ZWxfc3NldS5vIFwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2VuZ2luZS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lLmgKaW5k
ZXggZGNjMmZjMjJlYTM3Li5iODE2NTgxYjk1ZDMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2VuZ2luZS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2VuZ2luZS5oCkBAIC0yMDksNiArMjA5LDcgQEAgdm9pZCBpbnRlbF9lbmdpbmVfY2xlYW51
cF9jb21tb24oc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKIGludCBpbnRlbF9lbmdp
bmVfcmVzdW1lKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSk7CiAKIGludCBpbnRlbF9y
aW5nX3N1Ym1pc3Npb25fc2V0dXAoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKK2lu
dCBpbnRlbF9yaW5nX3NjaGVkdWxlcl9zZXR1cChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmUpOwogCiBpbnQgaW50ZWxfZW5naW5lX3N0b3BfY3Moc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lKTsKIHZvaWQgaW50ZWxfZW5naW5lX2NhbmNlbF9zdG9wX2NzKHN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9lbmdpbmVfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2lu
ZV90eXBlcy5oCmluZGV4IDUzYTFkZGQ0MzE3Ny4uZTBlMWFiNDE5NzYwIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMuaAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMuaApAQCAtMzM0LDYgKzMzNCw3IEBA
IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgewogCXN0cnVjdCB7CiAJCXN0cnVjdCBpbnRlbF9yaW5n
ICpyaW5nOwogCQlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRpbWVsaW5lOworCQlzdHJ1Y3QgaW50
ZWxfY29udGV4dCAqY29udGV4dDsKIAl9IGxlZ2FjeTsKIAogCS8qCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nX3NjaGVkdWxlci5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ19zY2hlZHVsZXIuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NApp
bmRleCAwMDAwMDAwMDAwMDAuLjZiM2M1MGU2M2JkOQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jpbmdfc2NoZWR1bGVyLmMKQEAgLTAsMCArMSw3MzYg
QEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKKy8qCisgKiBDb3B5cmlnaHQgwqkg
MjAyMCBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpbmNsdWRlIDxsaW51eC9sb2cyLmg+CisK
KyNpbmNsdWRlIDxkcm0vaTkxNV9kcm0uaD4KKworI2luY2x1ZGUgImk5MTVfZHJ2LmgiCisjaW5j
bHVkZSAiaW50ZWxfY29udGV4dC5oIgorI2luY2x1ZGUgImludGVsX2VuZ2luZV9zdGF0cy5oIgor
I2luY2x1ZGUgImludGVsX2d0LmgiCisjaW5jbHVkZSAiaW50ZWxfZ3RfcG0uaCIKKyNpbmNsdWRl
ICJpbnRlbF9ndF9yZXF1ZXN0cy5oIgorI2luY2x1ZGUgImludGVsX3Jlc2V0LmgiCisjaW5jbHVk
ZSAiaW50ZWxfcmluZy5oIgorI2luY2x1ZGUgImludGVsX3Jpbmdfc3VibWlzc2lvbi5oIgorI2lu
Y2x1ZGUgInNobWVtX3V0aWxzLmgiCisKKy8qCisgKiBSb3VnaCBlc3RpbWF0ZSBvZiB0aGUgdHlw
aWNhbCByZXF1ZXN0IHNpemUsIHBlcmZvcm1pbmcgYSBmbHVzaCwKKyAqIHNldC1jb250ZXh0IGFu
ZCB0aGVuIGVtaXR0aW5nIHRoZSBiYXRjaC4KKyAqLworI2RlZmluZSBMRUdBQ1lfUkVRVUVTVF9T
SVpFIDIwMAorCitzdGF0aWMgaW5saW5lIGludCBycV9wcmlvKGNvbnN0IHN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJxKQoreworCXJldHVybiBycS0+c2NoZWQuYXR0ci5wcmlvcml0eTsKK30KKworc3Rh
dGljIGlubGluZSB1NjQgcnFfZGVhZGxpbmUoY29uc3Qgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEp
Cit7CisJcmV0dXJuIHJxLT5zY2hlZC5kZWFkbGluZTsKK30KKworc3RhdGljIGlubGluZSBzdHJ1
Y3QgaTkxNV9wcmlvbGlzdCAqdG9fcHJpb2xpc3Qoc3RydWN0IHJiX25vZGUgKnJiKQoreworCXJl
dHVybiByYl9lbnRyeShyYiwgc3RydWN0IGk5MTVfcHJpb2xpc3QsIG5vZGUpOworfQorCitzdGF0
aWMgaW5saW5lIGludCBxdWV1ZV9kZWFkbGluZShzdHJ1Y3QgcmJfbm9kZSAqcmIpCit7CisJcmV0
dXJuIHJiID8gdG9fcHJpb2xpc3QocmIpLT5kZWFkbGluZSA6IEk5MTVfREVBRExJTkVfTkVWRVI7
Cit9CisKK3N0YXRpYyBpbmxpbmUgYm9vbCByZXNldF9pbl9wcm9ncmVzcyhjb25zdCBzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2V4ZWNsaXN0cyAqZWwpCit7CisJcmV0dXJuIHVubGlrZWx5KCFfX3Rhc2ts
ZXRfaXNfZW5hYmxlZCgmZWwtPnRhc2tsZXQpKTsKK30KKworc3RhdGljIHZvaWQKK3NldF9jdXJy
ZW50X2NvbnRleHQoc3RydWN0IGludGVsX2NvbnRleHQgKipwdHIsIHN0cnVjdCBpbnRlbF9jb250
ZXh0ICpjZSkKK3sKKwlpZiAoY2UpCisJCWludGVsX2NvbnRleHRfZ2V0KGNlKTsKKworCWNlID0g
eGNoZyhwdHIsIGNlKTsKKworCWlmIChjZSkKKwkJaW50ZWxfY29udGV4dF9wdXQoY2UpOworfQor
CitzdGF0aWMgdm9pZCBzY2hlZHVsZV9pbihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUs
IHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQoreworCV9faW50ZWxfZ3RfcG1fZ2V0KGVuZ2luZS0+
Z3QpOworCWludGVsX2VuZ2luZV9jb250ZXh0X2luKGVuZ2luZSk7CisJaTkxNV9yZXF1ZXN0X2dl
dChycSk7Cit9CisKK3N0YXRpYyB2b2lkIHNjaGVkdWxlX2luX25ldyhzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmUsCisJCQkgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqKnBvcnQpCit7CisJ
d2hpbGUgKCpwb3J0KQorCQlzY2hlZHVsZV9pbihlbmdpbmUsICpwb3J0KyspOworfQorCitzdGF0
aWMgdm9pZCBzY2hlZHVsZV9vdXQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCit7CisJc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lID0gcnEtPmVuZ2luZTsKKwlzdHJ1Y3QgaW50ZWxfY29u
dGV4dCAqY2UgPSBycS0+Y29udGV4dDsKKworCWlmIChpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJx
KSkgeworCQlpZiAoIWxpc3RfaXNfbGFzdF9yY3UoJnJxLT5saW5rLCAmY2UtPnRpbWVsaW5lLT5y
ZXF1ZXN0cykpCisJCQlpOTE1X3JlcXVlc3RfdXBkYXRlX2RlYWRsaW5lKGxpc3RfbmV4dF9lbnRy
eShycSwgbGluaykpOworCQllbHNlCisJCQlpbnRlbF9lbmdpbmVfYWRkX3JldGlyZShlbmdpbmUs
IGNlLT50aW1lbGluZSk7CisJfQorCisJaTkxNV9yZXF1ZXN0X3B1dChycSk7CisJaW50ZWxfZW5n
aW5lX2NvbnRleHRfb3V0KGVuZ2luZSk7CisJaW50ZWxfZ3RfcG1fcHV0X2FzeW5jKGVuZ2luZS0+
Z3QpOworfQorCitzdGF0aWMgaW5saW5lIHZvaWQgKmNsZWFyX3BvcnRzKHN0cnVjdCBpOTE1X3Jl
cXVlc3QgKipwb3J0cywgaW50IGNvdW50KQoreworCXJldHVybiBtZW1zZXRfcCgodm9pZCAqKilw
b3J0cywgTlVMTCwgY291bnQpOworfQorCitzdGF0aWMgdTMyICpyaW5nX21hcChzdHJ1Y3QgaW50
ZWxfcmluZyAqcmluZywgdTMyIGxlbikKK3sKKwl1MzIgKnZhOworCisJaWYgKHVubGlrZWx5KHJp
bmctPnRhaWwgKyBsZW4gPiByaW5nLT5lZmZlY3RpdmVfc2l6ZSkpIHsKKwkJbWVtc2V0KHJpbmct
PnZhZGRyICsgcmluZy0+dGFpbCwgMCwgcmluZy0+c2l6ZSAtIHJpbmctPnRhaWwpOworCQlyaW5n
LT50YWlsID0gMDsKKwl9CisKKwl2YSA9IHJpbmctPnZhZGRyICsgcmluZy0+dGFpbDsKKwlyaW5n
LT50YWlsID0gaW50ZWxfcmluZ193cmFwKHJpbmcsIHJpbmctPnRhaWwgKyBsZW4pOworCisJcmV0
dXJuIHZhOworfQorCitzdGF0aWMgaW5saW5lIHUzMiAqcmluZ19tYXBfZHcoc3RydWN0IGludGVs
X3JpbmcgKnJpbmcsIHUzMiBsZW4pCit7CisJcmV0dXJuIHJpbmdfbWFwKHJpbmcsIGxlbiAqIHNp
emVvZih1MzIpKTsKK30KKworc3RhdGljIHZvaWQgcmluZ19jb3B5KHN0cnVjdCBpbnRlbF9yaW5n
ICpkc3QsCisJCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9yaW5nICpzcmMsCisJCSAgICAgIHUz
MiBzdGFydCwgdTMyIGVuZCkKK3sKKwl1bnNpZ25lZCBpbnQgbGVuOworCXZvaWQgKm91dDsKKwor
CWxlbiA9IGVuZCAtIHN0YXJ0OworCWlmIChlbmQgPCBzdGFydCkKKwkJbGVuICs9IHNyYy0+c2l6
ZTsKKwlvdXQgPSByaW5nX21hcChkc3QsIGxlbik7CisKKwlpZiAoZW5kIDwgc3RhcnQpIHsKKwkJ
bGVuID0gc3JjLT5zaXplIC0gc3RhcnQ7CisJCW1lbWNweShvdXQsIHNyYy0+dmFkZHIgKyBzdGFy
dCwgbGVuKTsKKwkJb3V0ICs9IGxlbjsKKwkJc3RhcnQgPSAwOworCX0KKworCW1lbWNweShvdXQs
IHNyYy0+dmFkZHIgKyBzdGFydCwgZW5kIC0gc3RhcnQpOworfQorCitzdGF0aWMgdm9pZCBzd2l0
Y2hfY29udGV4dChzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZywgc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnEpCit7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyaW5nX3N1Ym1pdChzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycSkKK3sKKwlzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZyA9IHJxLT5l
bmdpbmUtPmxlZ2FjeS5yaW5nOworCisJX19pOTE1X3JlcXVlc3Rfc3VibWl0KHJxKTsKKworCWlm
IChycS0+ZW5naW5lLT5sZWdhY3kuY29udGV4dCAhPSBycS0+Y29udGV4dCkgeworCQlzd2l0Y2hf
Y29udGV4dChyaW5nLCBycSk7CisJCXNldF9jdXJyZW50X2NvbnRleHQoJnJxLT5lbmdpbmUtPmxl
Z2FjeS5jb250ZXh0LCBycS0+Y29udGV4dCk7CisJfQorCisJcmluZ19jb3B5KHJpbmcsIHJxLT5y
aW5nLCBycS0+aGVhZCwgcnEtPnRhaWwpOworCXJldHVybiBycTsKK30KKworc3RhdGljIHN0cnVj
dCBpOTE1X3JlcXVlc3QgKioKK2NvcHlfYWN0aXZlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKipwb3J0
LCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICogY29uc3QgKmFjdGl2ZSkKK3sKKwl3aGlsZSAoKmFjdGl2
ZSkKKwkJKnBvcnQrKyA9ICphY3RpdmUrKzsKKworCXJldHVybiBwb3J0OworfQorCitzdGF0aWMg
dm9pZCBkZXF1ZXVlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKK3sKKwlzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2V4ZWNsaXN0cyAqIGNvbnN0IGVsID0gJmVuZ2luZS0+ZXhlY2xpc3RzOwor
CXN0cnVjdCBpOTE1X3JlcXVlc3QgKiogY29uc3QgbGFzdF9wb3J0ID0gZWwtPnBlbmRpbmcgKyBl
bC0+cG9ydF9tYXNrOworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKipwb3J0LCAqKmZpcnN0OworCXVu
c2lnbmVkIGxvbmcgZmxhZ3M7CisJc3RydWN0IHJiX25vZGUgKnJiOworCisJZmlyc3QgPSBjb3B5
X2FjdGl2ZShlbC0+cGVuZGluZywgZWwtPmFjdGl2ZSk7CisJaWYgKGZpcnN0ID4gbGFzdF9wb3J0
KQorCQlyZXR1cm47CisKKwlwb3J0ID0gZmlyc3Q7CisJKnBvcnQgPSBOVUxMOworCXNwaW5fbG9j
a19pcnFzYXZlKCZlbmdpbmUtPmFjdGl2ZS5sb2NrLCBmbGFncyk7CisJd2hpbGUgKChyYiA9IHJi
X2ZpcnN0X2NhY2hlZCgmZWwtPnF1ZXVlKSkpIHsKKwkJc3RydWN0IGk5MTVfcHJpb2xpc3QgKnAg
PSB0b19wcmlvbGlzdChyYik7CisJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCAqcm47CisKKwkJ
cHJpb2xpc3RfZm9yX2VhY2hfcmVxdWVzdF9jb25zdW1lKHJxLCBybiwgcCkgeworCQkJR0VNX0JV
R19PTihycSA9PSAqcG9ydCk7CisJCQlpZiAoKnBvcnQgJiYgcnEtPmNvbnRleHQgIT0gKCpwb3J0
KS0+Y29udGV4dCkgeworCQkJCWlmIChwb3J0ID09IGxhc3RfcG9ydCkKKwkJCQkJZ290byBkb25l
OworCisJCQkJcG9ydCsrOworCQkJfQorCisJCQkqcG9ydCA9IHJpbmdfc3VibWl0KHJxKTsKKwkJ
fQorCisJCXJiX2VyYXNlX2NhY2hlZCgmcC0+bm9kZSwgJmVsLT5xdWV1ZSk7CisJCWk5MTVfcHJp
b2xpc3RfZnJlZShwKTsKKwl9Citkb25lOgorCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmVuZ2lu
ZS0+YWN0aXZlLmxvY2ssIGZsYWdzKTsKKwlpZiAoISpwb3J0KQorCQlyZXR1cm47CisKKwkqKytw
b3J0ID0gTlVMTDsKKwlzY2hlZHVsZV9pbl9uZXcoZW5naW5lLCBmaXJzdCk7CisJV1JJVEVfT05D
RShlbC0+YWN0aXZlLCBlbC0+cGVuZGluZyk7CisKKwl3bWIoKTsgLyogcGFyYW5vaWQgZmx1c2gg
b2YgV0NCIGJlZm9yZSBSSU5HX1RBSUwgd3JpdGUgKi8KKwlFTkdJTkVfV1JJVEUoZW5naW5lLCBS
SU5HX1RBSUwsIGVuZ2luZS0+bGVnYWN5LnJpbmctPnRhaWwpOworCW1lbWNweShlbC0+aW5mbGln
aHQsIGVsLT5wZW5kaW5nLAorCSAgICAgICAocG9ydCAtIGVsLT5wZW5kaW5nICsgMSkgKiBzaXpl
b2YoKnBvcnQpKTsKKworCVdSSVRFX09OQ0UoZWwtPmFjdGl2ZSwgZWwtPmluZmxpZ2h0KTsKKwlH
RU1fQlVHX09OKCEqZWwtPmFjdGl2ZSk7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICoqCitwcm9jZXNzX3Eoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICoqaW5hY3RpdmUpCit7CisJc3RydWN0IGludGVsX2VuZ2luZV9leGVjbGlzdHMg
KiBjb25zdCBlbCA9ICZlbmdpbmUtPmV4ZWNsaXN0czsKKworCXdoaWxlICgqZWwtPmFjdGl2ZSkg
eworCQlpZiAoIWk5MTVfcmVxdWVzdF9jb21wbGV0ZWQoKmVsLT5hY3RpdmUpKQorCQkJYnJlYWs7
CisKKwkJKmluYWN0aXZlKysgPSAqZWwtPmFjdGl2ZSsrOworCX0KKworCXJldHVybiBpbmFjdGl2
ZTsKK30KKworc3RhdGljIHZvaWQgcG9zdF9wcm9jZXNzX3Eoc3RydWN0IGk5MTVfcmVxdWVzdCAq
KnBvcnQsCisJCQkgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICogY29uc3QgKmluYWN0aXZlKQorewor
CXdoaWxlIChwb3J0ICE9IGluYWN0aXZlKQorCQlzY2hlZHVsZV9vdXQoKnBvcnQrKyk7Cit9CisK
K3N0YXRpYyB2b2lkIHN1Ym1pc3Npb25fdGFza2xldCh1bnNpZ25lZCBsb25nIGRhdGEpCit7CisJ
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lID0gKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KilkYXRhOworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnBvc3RbRVhFQ0xJU1RfTUFYX1BPUlRTXTsK
KwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICoqaW5hY3RpdmU7CisKKwlpbmFjdGl2ZSA9IHByb2Nlc3Nf
cShlbmdpbmUsIHBvc3QpOworCUdFTV9CVUdfT04oaW5hY3RpdmUgLSBwb3N0ID4gQVJSQVlfU0la
RShwb3N0KSk7CisKKwlpZiAocmJfZmlyc3RfY2FjaGVkKCZlbmdpbmUtPmV4ZWNsaXN0cy5xdWV1
ZSkpCisJCWRlcXVldWUoZW5naW5lKTsKKworCXBvc3RfcHJvY2Vzc19xKHBvc3QsIGluYWN0aXZl
KTsKK30KKworc3RhdGljIHZvaWQgc3VibWl0X3JlcXVlc3Qoc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnEpCit7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lID0gcnEtPmVuZ2luZTsKKwl1
bnNpZ25lZCBsb25nIGZsYWdzOworCisJc3Bpbl9sb2NrX2lycXNhdmUoJmVuZ2luZS0+YWN0aXZl
LmxvY2ssIGZsYWdzKTsKKwlpZiAoaW50ZWxfZW5naW5lX3F1ZXVlX3JlcXVlc3QoZW5naW5lLCBy
cSkpCisJCXRhc2tsZXRfaGlfc2NoZWR1bGUoJmVuZ2luZS0+ZXhlY2xpc3RzLnRhc2tsZXQpOwor
CXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmVuZ2luZS0+YWN0aXZlLmxvY2ssIGZsYWdzKTsKK30K
Kworc3RhdGljIHZvaWQgcmVzZXRfcHJlcGFyZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmUpCit7CisJc3RydWN0IGludGVsX2VuZ2luZV9leGVjbGlzdHMgKiBjb25zdCBlbCA9ICZlbmdp
bmUtPmV4ZWNsaXN0czsKKworCUdFTV9UUkFDRSgiJXNcbiIsIGVuZ2luZS0+bmFtZSk7CisKKwlf
X3Rhc2tsZXRfZGlzYWJsZV9zeW5jX29uY2UoJmVsLT50YXNrbGV0KTsKKwlHRU1fQlVHX09OKCFy
ZXNldF9pbl9wcm9ncmVzcyhlbCkpOworCisJaW50ZWxfcmluZ19zdWJtaXNzaW9uX3Jlc2V0X3By
ZXBhcmUoZW5naW5lKTsKK30KKworc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3QgKgorX191bndp
bmRfaW5jb21wbGV0ZV9yZXF1ZXN0cyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCit7
CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsICpybiwgKmFjdGl2ZSA9IE5VTEw7CisJc3RydWN0
IGxpc3RfaGVhZCAqdW5pbml0aWFsaXplZF92YXIocGwpOworCXU2NCBkZWFkbGluZSA9IEk5MTVf
REVBRExJTkVfTkVWRVI7CisKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZlbmdpbmUtPmFjdGl2ZS5s
b2NrKTsKKworCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZV9yZXZlcnNlKHJxLCBybiwKKwkJCQkJ
ICZlbmdpbmUtPmFjdGl2ZS5yZXF1ZXN0cywKKwkJCQkJIHNjaGVkLmxpbmspIHsKKwkJaWYgKGk5
MTVfcmVxdWVzdF9jb21wbGV0ZWQocnEpKQorCQkJYnJlYWs7CisKKwkJX19pOTE1X3JlcXVlc3Rf
dW5zdWJtaXQocnEpOworCisJCWlmIChpOTE1X3JlcXVlc3Rfc3RhcnRlZChycSkpIHsKKwkJCXU2
NCBkZWFkbGluZSA9CisJCQkJaTkxNV9zY2hlZHVsZXJfbmV4dF92aXJ0dWFsX2RlYWRsaW5lKHJx
X3ByaW8ocnEpKTsKKwkJCXJxLT5zY2hlZC5kZWFkbGluZSA9IG1pbihycV9kZWFkbGluZShycSks
IGRlYWRsaW5lKTsKKwkJfQorCisJCWlmIChycV9kZWFkbGluZShycSkgIT0gZGVhZGxpbmUpIHsK
KwkJCWRlYWRsaW5lID0gcnFfZGVhZGxpbmUocnEpOworCQkJcGwgPSBpOTE1X3NjaGVkX2xvb2t1
cF9wcmlvbGlzdChlbmdpbmUsIGRlYWRsaW5lKTsKKwkJfQorCQlHRU1fQlVHX09OKFJCX0VNUFRZ
X1JPT1QoJmVuZ2luZS0+ZXhlY2xpc3RzLnF1ZXVlLnJiX3Jvb3QpKTsKKworCQlsaXN0X21vdmUo
JnJxLT5zY2hlZC5saW5rLCBwbCk7CisJCXNldF9iaXQoSTkxNV9GRU5DRV9GTEFHX1BRVUVVRSwg
JnJxLT5mZW5jZS5mbGFncyk7CisKKwkJYWN0aXZlID0gcnE7CisJfQorCisJcmV0dXJuIGFjdGl2
ZTsKK30KKworc3RhdGljIHZvaWQgY2FuY2VsX3BvcnRfcmVxdWVzdHMoc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lKQoreworCXN0cnVjdCBpbnRlbF9lbmdpbmVfZXhlY2xpc3RzICogY29u
c3QgZWwgPSAmZW5naW5lLT5leGVjbGlzdHM7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqIGNvbnN0
ICpwb3J0OworCisJY2xlYXJfcG9ydHMoZWwtPnBlbmRpbmcsIEFSUkFZX1NJWkUoZWwtPnBlbmRp
bmcpKTsKKwlmb3IgKHBvcnQgPSB4Y2hnKCZlbC0+YWN0aXZlLCBlbC0+cGVuZGluZyk7ICpwb3J0
OyBwb3J0KyspCisJCXNjaGVkdWxlX291dCgqcG9ydCk7CisJY2xlYXJfcG9ydHMoZWwtPmluZmxp
Z2h0LCBBUlJBWV9TSVpFKGVsLT5pbmZsaWdodCkpOworCisJc21wX3dtYigpOyAvKiBjb21wbGV0
ZSB0aGUgc2VxbG9jayBmb3IgZXhlY2xpc3RzX2FjdGl2ZSgpICovCisJV1JJVEVfT05DRShlbC0+
YWN0aXZlLCBlbC0+aW5mbGlnaHQpOworfQorCitzdGF0aWMgdm9pZCBfX3JpbmdfcmV3aW5kKHN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgYm9vbCBzdGFsbGVkKQoreworCXN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxOworCisJcnEgPSBfX3Vud2luZF9pbmNvbXBsZXRlX3JlcXVlc3RzKGVu
Z2luZSk7CisJaWYgKHJxICYmIGk5MTVfcmVxdWVzdF9zdGFydGVkKHJxKSkKKwkJX19pOTE1X3Jl
cXVlc3RfcmVzZXQocnEsIHN0YWxsZWQpOworCisJLyogQ2xlYXIgdGhlIGdsb2JhbCBzdWJtaXNz
aW9uIHN0YXRlLCB3ZSB3aWxsIHN1Ym1pdCBmcm9tIHNjcmF0Y2ggKi8KKwlpbnRlbF9yaW5nX3Jl
c2V0KGVuZ2luZS0+bGVnYWN5LnJpbmcsIDApOworCXNldF9jdXJyZW50X2NvbnRleHQoJmVuZ2lu
ZS0+bGVnYWN5LmNvbnRleHQsIE5VTEwpOworfQorCitzdGF0aWMgdm9pZCByaW5nX3Jlc2V0X3Jl
d2luZChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIGJvb2wgc3RhbGxlZCkKK3sKKwl1
bnNpZ25lZCBsb25nIGZsYWdzOworCisJY2FuY2VsX3BvcnRfcmVxdWVzdHMoZW5naW5lKTsKKwor
CXNwaW5fbG9ja19pcnFzYXZlKCZlbmdpbmUtPmFjdGl2ZS5sb2NrLCBmbGFncyk7CisJX19yaW5n
X3Jld2luZChlbmdpbmUsIHN0YWxsZWQpOworCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJmVuZ2lu
ZS0+YWN0aXZlLmxvY2ssIGZsYWdzKTsKK30KKworc3RhdGljIHZvaWQgbm9wX3N1Ym1pc3Npb25f
dGFza2xldCh1bnNpZ25lZCBsb25nIGRhdGEpCit7Cit9CisKK3N0YXRpYyB2b2lkIHJpbmdfcmVz
ZXRfY2FuY2VsKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKK3sKKwlzdHJ1Y3QgaW50
ZWxfZW5naW5lX2V4ZWNsaXN0cyAqIGNvbnN0IGVsID0gJmVuZ2luZS0+ZXhlY2xpc3RzOworCXN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCAqcm47CisJdW5zaWduZWQgbG9uZyBmbGFnczsKKwlzdHJ1
Y3QgcmJfbm9kZSAqcmI7CisKKwljYW5jZWxfcG9ydF9yZXF1ZXN0cyhlbmdpbmUpOworCisJc3Bp
bl9sb2NrX2lycXNhdmUoJmVuZ2luZS0+YWN0aXZlLmxvY2ssIGZsYWdzKTsKKworCV9fcmluZ19y
ZXdpbmQoZW5naW5lLCB0cnVlKTsKKworCS8qIE1hcmsgYWxsIHN1Ym1pdHRlZCByZXF1ZXN0cyBh
cyBza2lwcGVkLiAqLworCWxpc3RfZm9yX2VhY2hfZW50cnkocnEsICZlbmdpbmUtPmFjdGl2ZS5y
ZXF1ZXN0cywgc2NoZWQubGluaykgeworCQlpOTE1X3JlcXVlc3Rfc2V0X2Vycm9yX29uY2UocnEs
IC1FSU8pOworCQlpOTE1X3JlcXVlc3RfbWFya19jb21wbGV0ZShycSk7CisJfQorCisJLyogRmx1
c2ggdGhlIHF1ZXVlZCByZXF1ZXN0cyB0byB0aGUgdGltZWxpbmUgbGlzdCAoZm9yIHJldGlyaW5n
KS4gKi8KKwl3aGlsZSAoKHJiID0gcmJfZmlyc3RfY2FjaGVkKCZlbC0+cXVldWUpKSkgeworCQlz
dHJ1Y3QgaTkxNV9wcmlvbGlzdCAqcCA9IHRvX3ByaW9saXN0KHJiKTsKKworCQlwcmlvbGlzdF9m
b3JfZWFjaF9yZXF1ZXN0X2NvbnN1bWUocnEsIHJuLCBwKSB7CisJCQlpOTE1X3JlcXVlc3Rfc2V0
X2Vycm9yX29uY2UocnEsIC1FSU8pOworCQkJaTkxNV9yZXF1ZXN0X21hcmtfY29tcGxldGUocnEp
OworCQkJX19pOTE1X3JlcXVlc3Rfc3VibWl0KHJxKTsKKwkJfQorCisJCXJiX2VyYXNlX2NhY2hl
ZCgmcC0+bm9kZSwgJmVsLT5xdWV1ZSk7CisJCWk5MTVfcHJpb2xpc3RfZnJlZShwKTsKKwl9CisJ
R0VNX0JVR19PTighUkJfRU1QVFlfUk9PVCgmZWwtPnF1ZXVlLnJiX3Jvb3QpKTsKKworCS8qIFJl
bWFpbmluZyBfdW5yZWFkeV8gcmVxdWVzdHMgd2lsbCBiZSBub3AnZWQgd2hlbiBzdWJtaXR0ZWQg
Ki8KKworCUdFTV9CVUdfT04oX190YXNrbGV0X2lzX2VuYWJsZWQoJmVsLT50YXNrbGV0KSk7CisJ
ZWwtPnRhc2tsZXQuZnVuYyA9IG5vcF9zdWJtaXNzaW9uX3Rhc2tsZXQ7CisKKwlzcGluX3VubG9j
a19pcnFyZXN0b3JlKCZlbmdpbmUtPmFjdGl2ZS5sb2NrLCBmbGFncyk7Cit9CisKK3N0YXRpYyB2
b2lkIHJlc2V0X2ZpbmlzaChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCit7CisJaW50
ZWxfcmluZ19zdWJtaXNzaW9uX3Jlc2V0X2ZpbmlzaChlbmdpbmUpOworCisJaWYgKF9fdGFza2xl
dF9lbmFibGUoJmVuZ2luZS0+ZXhlY2xpc3RzLnRhc2tsZXQpKQorCQl0YXNrbGV0X2hpX3NjaGVk
dWxlKCZlbmdpbmUtPmV4ZWNsaXN0cy50YXNrbGV0KTsKK30KKworc3RhdGljIHZvaWQgc3VibWlz
c2lvbl9wYXJrKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKK3sKKwlpbnRlbF9lbmdp
bmVfdW5waW5fYnJlYWRjcnVtYnNfaXJxKGVuZ2luZSk7CisJLyogZHJhaW4gdGhlIHN1Ym1pdCBx
dWV1ZSAqLworCXRhc2tsZXRfaGlfc2NoZWR1bGUoJmVuZ2luZS0+ZXhlY2xpc3RzLnRhc2tsZXQp
OworfQorCitzdGF0aWMgdm9pZCBzdWJtaXNzaW9uX3VucGFyayhzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmUpCit7CisJaW50ZWxfZW5naW5lX3Bpbl9icmVhZGNydW1ic19pcnEoZW5naW5l
KTsKK30KKworc3RhdGljIHZvaWQgcmluZ19jb250ZXh0X2Rlc3Ryb3koc3RydWN0IGtyZWYgKnJl
ZikKK3sKKwlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UgPSBjb250YWluZXJfb2YocmVmLCB0eXBl
b2YoKmNlKSwgcmVmKTsKKworCUdFTV9CVUdfT04oaW50ZWxfY29udGV4dF9pc19waW5uZWQoY2Up
KTsKKworCWlmIChjZS0+c3RhdGUpCisJCWk5MTVfdm1hX3B1dChjZS0+c3RhdGUpOworCWlmICh0
ZXN0X2JpdChDT05URVhUX0FMTE9DX0JJVCwgJmNlLT5mbGFncykpCisJCWludGVsX3JpbmdfcHV0
KGNlLT5yaW5nKTsKKworCWludGVsX2NvbnRleHRfZmluaShjZSk7CisJaW50ZWxfY29udGV4dF9m
cmVlKGNlKTsKK30KKworc3RhdGljIHZvaWQgcmluZ19jb250ZXh0X3VucGluKHN0cnVjdCBpbnRl
bF9jb250ZXh0ICpjZSkKK3sKK30KKworc3RhdGljIGludCBhbGxvY19jb250ZXh0X3ZtYShzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2UpCisKK3sKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmUgPSBjZS0+ZW5naW5lOworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CisJc3Ry
dWN0IGk5MTVfdm1hICp2bWE7CisJaW50IGVycjsKKworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9j
cmVhdGVfc2htZW0oZW5naW5lLT5pOTE1LCBlbmdpbmUtPmNvbnRleHRfc2l6ZSk7CisJaWYgKElT
X0VSUihvYmopKQorCQlyZXR1cm4gUFRSX0VSUihvYmopOworCisJLyoKKwkgKiBUcnkgdG8gbWFr
ZSB0aGUgY29udGV4dCB1dGlsaXplIEwzIGFzIHdlbGwgYXMgTExDLgorCSAqCisJICogT24gVkxW
IHdlIGRvbid0IGhhdmUgTDMgY29udHJvbHMgaW4gdGhlIFBURXMgc28gd2UKKwkgKiBzaG91bGRu
J3QgdG91Y2ggdGhlIGNhY2hlIGxldmVsLCBlc3BlY2lhbGx5IGFzIHRoYXQKKwkgKiB3b3VsZCBt
YWtlIHRoZSBvYmplY3Qgc25vb3BlZCB3aGljaCBtaWdodCBoYXZlIGEKKwkgKiBuZWdhdGl2ZSBw
ZXJmb3JtYW5jZSBpbXBhY3QuCisJICoKKwkgKiBTbm9vcGluZyBpcyByZXF1aXJlZCBvbiBub24t
bGxjIHBsYXRmb3JtcyBpbiBleGVjbGlzdAorCSAqIG1vZGUsIGJ1dCBzaW5jZSBhbGwgR0dUVCBh
Y2Nlc3NlcyB1c2UgUEFUIGVudHJ5IDAgd2UKKwkgKiBnZXQgc25vb3BpbmcgYW55d2F5IHJlZ2Fy
ZGxlc3Mgb2YgY2FjaGVfbGV2ZWwuCisJICoKKwkgKiBUaGlzIGlzIG9ubHkgYXBwbGljYWJsZSBm
b3IgSXZ5IEJyaWRnZSBkZXZpY2VzIHNpbmNlCisJICogbGF0ZXIgcGxhdGZvcm1zIGRvbid0IGhh
dmUgTDMgY29udHJvbCBiaXRzIGluIHRoZSBQVEUuCisJICovCisJaWYgKElTX0lWWUJSSURHRShl
bmdpbmUtPmk5MTUpKQorCQlpOTE1X2dlbV9vYmplY3Rfc2V0X2NhY2hlX2NvaGVyZW5jeShvYmos
IEk5MTVfQ0FDSEVfTDNfTExDKTsKKworCWlmIChlbmdpbmUtPmRlZmF1bHRfc3RhdGUpIHsKKwkJ
dm9pZCAqdmFkZHI7CisKKwkJdmFkZHIgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChvYmosIEk5
MTVfTUFQX1dCKTsKKwkJaWYgKElTX0VSUih2YWRkcikpIHsKKwkJCWVyciA9IFBUUl9FUlIodmFk
ZHIpOworCQkJZ290byBlcnJfb2JqOworCQl9CisKKwkJc2htZW1fcmVhZChlbmdpbmUtPmRlZmF1
bHRfc3RhdGUsIDAsCisJCQkgICB2YWRkciwgZW5naW5lLT5jb250ZXh0X3NpemUpOworCQlfX3Nl
dF9iaXQoQ09OVEVYVF9WQUxJRF9CSVQsICZjZS0+ZmxhZ3MpOworCisJCWk5MTVfZ2VtX29iamVj
dF9mbHVzaF9tYXAob2JqKTsKKwkJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChvYmopOworCX0K
KworCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgJmVuZ2luZS0+Z3QtPmdndHQtPnZtLCBO
VUxMKTsKKwlpZiAoSVNfRVJSKHZtYSkpIHsKKwkJZXJyID0gUFRSX0VSUih2bWEpOworCQlnb3Rv
IGVycl9vYmo7CisJfQorCisJY2UtPnN0YXRlID0gdm1hOworCXJldHVybiAwOworCitlcnJfb2Jq
OgorCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMg
aW50IGFsbG9jX3RpbWVsaW5lKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKK3sKKwlzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUgPSBjZS0+ZW5naW5lOworCXN0cnVjdCBpbnRlbF90aW1l
bGluZSAqdGw7CisJc3RydWN0IGk5MTVfdm1hICpod3NwOworCisJLyoKKwkgKiBVc2UgdGhlIHN0
YXRpYyBnbG9iYWwgSFdTUCBmb3IgdGhlIGtlcm5lbCBjb250ZXh0LCBhbmQKKwkgKiBhIGR5bmFt
aWNhbGx5IGFsbG9jYXRlZCBjYWNoZWxpbmUgZm9yIGV2ZXJ5b25lIGVsc2UuCisJICovCisJaHdz
cCA9IE5VTEw7CisJaWYgKHVubGlrZWx5KGludGVsX2NvbnRleHRfaXNfYmFycmllcihjZSkpKQor
CQlod3NwID0gZW5naW5lLT5zdGF0dXNfcGFnZS52bWE7CisKKwl0bCA9IGludGVsX3RpbWVsaW5l
X2NyZWF0ZShlbmdpbmUtPmd0LCBod3NwKTsKKwlpZiAoSVNfRVJSKHRsKSkKKwkJcmV0dXJuIFBU
Ul9FUlIodGwpOworCisJY2UtPnRpbWVsaW5lID0gdGw7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRp
YyBpbnQgcmluZ19jb250ZXh0X2FsbG9jKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKK3sKKwlz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUgPSBjZS0+ZW5naW5lOworCXN0cnVjdCBpbnRl
bF9yaW5nICpyaW5nOworCWludCBlcnI7CisKKwlHRU1fQlVHX09OKGNlLT5zdGF0ZSk7CisJaWYg
KGVuZ2luZS0+Y29udGV4dF9zaXplKSB7CisJCWVyciA9IGFsbG9jX2NvbnRleHRfdm1hKGNlKTsK
KwkJaWYgKGVycikKKwkJCXJldHVybiBlcnI7CisJfQorCisJaWYgKCFjZS0+dGltZWxpbmUpIHsK
KwkJZXJyID0gYWxsb2NfdGltZWxpbmUoY2UpOworCQlpZiAoZXJyKQorCQkJZ290byBlcnJfdm1h
OworCX0KKworCXJpbmcgPSBpbnRlbF9lbmdpbmVfY3JlYXRlX3JpbmcoZW5naW5lLAorCQkJCQko
dW5zaWduZWQgbG9uZyljZS0+cmluZyB8CisJCQkJCUlOVEVMX1JJTkdfQ1JFQVRFX0lOVEVSTkFM
KTsKKwlpZiAoSVNfRVJSKHJpbmcpKSB7CisJCWVyciA9IFBUUl9FUlIocmluZyk7CisJCWdvdG8g
ZXJyX3RpbWVsaW5lOworCX0KKwljZS0+cmluZyA9IHJpbmc7CisKKwlyZXR1cm4gMDsKKworZXJy
X3RpbWVsaW5lOgorCWludGVsX3RpbWVsaW5lX3B1dChjZS0+dGltZWxpbmUpOworZXJyX3ZtYToK
KwlpZiAoY2UtPnN0YXRlKSB7CisJCWk5MTVfdm1hX3B1dChjZS0+c3RhdGUpOworCQljZS0+c3Rh
dGUgPSBOVUxMOworCX0KKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgaW50IHJpbmdfY29udGV4
dF9waW4oc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQoreworCXJldHVybiAwOworfQorCitzdGF0
aWMgdm9pZCByaW5nX2NvbnRleHRfcmVzZXQoc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQorewor
CWludGVsX3JpbmdfcmVzZXQoY2UtPnJpbmcsIDApOworCWNsZWFyX2JpdChDT05URVhUX1ZBTElE
X0JJVCwgJmNlLT5mbGFncyk7Cit9CisKK3N0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfY29udGV4
dF9vcHMgcmluZ19jb250ZXh0X29wcyA9IHsKKwkuYWxsb2MgPSByaW5nX2NvbnRleHRfYWxsb2Ms
CisKKwkucGluID0gcmluZ19jb250ZXh0X3BpbiwKKwkudW5waW4gPSByaW5nX2NvbnRleHRfdW5w
aW4sCisKKwkuZW50ZXIgPSBpbnRlbF9jb250ZXh0X2VudGVyX2VuZ2luZSwKKwkuZXhpdCA9IGlu
dGVsX2NvbnRleHRfZXhpdF9lbmdpbmUsCisKKwkucmVzZXQgPSByaW5nX2NvbnRleHRfcmVzZXQs
CisJLmRlc3Ryb3kgPSByaW5nX2NvbnRleHRfZGVzdHJveSwKK307CisKK3N0YXRpYyBpbnQgcmlu
Z19yZXF1ZXN0X2FsbG9jKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQoreworCWludCByZXQ7CisK
KwlHRU1fQlVHX09OKCFpbnRlbF9jb250ZXh0X2lzX3Bpbm5lZChycS0+Y29udGV4dCkpOworCisJ
LyoKKwkgKiBGbHVzaCBlbm91Z2ggc3BhY2UgdG8gcmVkdWNlIHRoZSBsaWtlbGlob29kIG9mIHdh
aXRpbmcgYWZ0ZXIKKwkgKiB3ZSBzdGFydCBidWlsZGluZyB0aGUgcmVxdWVzdCAtIGluIHdoaWNo
IGNhc2Ugd2Ugd2lsbCBqdXN0CisJICogaGF2ZSB0byByZXBlYXQgd29yay4KKwkgKi8KKwlycS0+
cmVzZXJ2ZWRfc3BhY2UgKz0gTEVHQUNZX1JFUVVFU1RfU0laRTsKKworCS8qIFVuY29uZGl0aW9u
YWxseSBpbnZhbGlkYXRlIEdQVSBjYWNoZXMgYW5kIFRMQnMuICovCisJcmV0ID0gcnEtPmVuZ2lu
ZS0+ZW1pdF9mbHVzaChycSwgRU1JVF9JTlZBTElEQVRFKTsKKwlpZiAocmV0KQorCQlyZXR1cm4g
cmV0OworCisJcnEtPnJlc2VydmVkX3NwYWNlIC09IExFR0FDWV9SRVFVRVNUX1NJWkU7CisJcmV0
dXJuIDA7Cit9CisKK3N0YXRpYyB2b2lkIHNldF9kZWZhdWx0X3N1Ym1pc3Npb24oc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqZW5naW5lKQoreworCWVuZ2luZS0+c3VibWl0X3JlcXVlc3QgPSBzdWJt
aXRfcmVxdWVzdDsKKwllbmdpbmUtPmV4ZWNsaXN0cy50YXNrbGV0LmZ1bmMgPSBzdWJtaXNzaW9u
X3Rhc2tsZXQ7Cit9CisKK3N0YXRpYyB2b2lkIHJpbmdfcmVsZWFzZShzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmUpCit7CisJaW50ZWxfZW5naW5lX2NsZWFudXBfY29tbW9uKGVuZ2luZSk7
CisKKwlzZXRfY3VycmVudF9jb250ZXh0KCZlbmdpbmUtPmxlZ2FjeS5jb250ZXh0LCBOVUxMKTsK
KworCWludGVsX3JpbmdfdW5waW4oZW5naW5lLT5sZWdhY3kucmluZyk7CisJaW50ZWxfcmluZ19w
dXQoZW5naW5lLT5sZWdhY3kucmluZyk7Cit9CisKK3N0YXRpYyB2b2lkIHNldHVwX2lycShzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCit7Cit9CisKK3N0YXRpYyB2b2lkIHNldHVwX2Nv
bW1vbihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCit7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSBlbmdpbmUtPmk5MTU7CisKKwkvKiBnZW44KyBhcmUgb25seSBzdXBw
b3J0ZWQgd2l0aCBleGVjbGlzdHMgKi8KKwlHRU1fQlVHX09OKElOVEVMX0dFTihpOTE1KSA+PSA4
KTsKKwlHRU1fQlVHX09OKElOVEVMX0dFTihpOTE1KSA8IDgpOworCisJc2V0dXBfaXJxKGVuZ2lu
ZSk7CisKKwllbmdpbmUtPnBhcmsgPSBzdWJtaXNzaW9uX3Bhcms7CisJZW5naW5lLT51bnBhcmsg
PSBzdWJtaXNzaW9uX3VucGFyazsKKworCWVuZ2luZS0+cmVzdW1lID0gaW50ZWxfcmluZ19zdWJt
aXNzaW9uX3Jlc3VtZTsKKwllbmdpbmUtPnJlc2V0LnByZXBhcmUgPSByZXNldF9wcmVwYXJlOwor
CWVuZ2luZS0+cmVzZXQucmV3aW5kID0gcmluZ19yZXNldF9yZXdpbmQ7CisJZW5naW5lLT5yZXNl
dC5jYW5jZWwgPSByaW5nX3Jlc2V0X2NhbmNlbDsKKwllbmdpbmUtPnJlc2V0LmZpbmlzaCA9IHJl
c2V0X2ZpbmlzaDsKKworCWVuZ2luZS0+Y29wcyA9ICZyaW5nX2NvbnRleHRfb3BzOworCWVuZ2lu
ZS0+cmVxdWVzdF9hbGxvYyA9IHJpbmdfcmVxdWVzdF9hbGxvYzsKKworCWVuZ2luZS0+c2V0X2Rl
ZmF1bHRfc3VibWlzc2lvbiA9IHNldF9kZWZhdWx0X3N1Ym1pc3Npb247Cit9CisKK3N0YXRpYyB2
b2lkIHNldHVwX3JjcyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCit7Cit9CisKK3N0
YXRpYyB2b2lkIHNldHVwX3ZjcyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCit7Cit9
CisKK3N0YXRpYyB2b2lkIHNldHVwX2JjcyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUp
Cit7Cit9CisKK3N0YXRpYyB2b2lkIHNldHVwX3ZlY3Moc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lKQoreworCUdFTV9CVUdfT04oIUlTX0hBU1dFTEwoZW5naW5lLT5pOTE1KSk7Cit9CisK
K3N0YXRpYyB1bnNpZ25lZCBpbnQgZ2xvYmFsX3Jpbmdfc2l6ZSh2b2lkKQoreworCS8qIEVub3Vn
aCBzcGFjZSB0byBob2xkIDIgY2xpZW50cyBhbmQgdGhlIGNvbnRleHQgc3dpdGNoICovCisJcmV0
dXJuIHJvdW5kdXBfcG93X29mX3R3byhFWEVDTElTVF9NQVhfUE9SVFMgKiBTWl8xNksgKyBTWl80
Syk7Cit9CisKK2ludCBpbnRlbF9yaW5nX3NjaGVkdWxlcl9zZXR1cChzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmUpCit7CisJc3RydWN0IGludGVsX3JpbmcgKnJpbmc7CisJaW50IGVycjsK
KworCUdFTV9CVUdfT04oSEFTX0VYRUNMSVNUUyhlbmdpbmUtPmk5MTUpKTsKKworCXRhc2tsZXRf
aW5pdCgmZW5naW5lLT5leGVjbGlzdHMudGFza2xldCwKKwkJICAgICBzdWJtaXNzaW9uX3Rhc2ts
ZXQsICh1bnNpZ25lZCBsb25nKWVuZ2luZSk7CisKKwlzZXR1cF9jb21tb24oZW5naW5lKTsKKwor
CXN3aXRjaCAoZW5naW5lLT5jbGFzcykgeworCWNhc2UgUkVOREVSX0NMQVNTOgorCQlzZXR1cF9y
Y3MoZW5naW5lKTsKKwkJYnJlYWs7CisJY2FzZSBWSURFT19ERUNPREVfQ0xBU1M6CisJCXNldHVw
X3ZjcyhlbmdpbmUpOworCQlicmVhazsKKwljYXNlIENPUFlfRU5HSU5FX0NMQVNTOgorCQlzZXR1
cF9iY3MoZW5naW5lKTsKKwkJYnJlYWs7CisJY2FzZSBWSURFT19FTkhBTkNFTUVOVF9DTEFTUzoK
KwkJc2V0dXBfdmVjcyhlbmdpbmUpOworCQlicmVhazsKKwlkZWZhdWx0OgorCQlNSVNTSU5HX0NB
U0UoZW5naW5lLT5jbGFzcyk7CisJCXJldHVybiAtRU5PREVWOworCX0KKworCXJpbmcgPSBpbnRl
bF9lbmdpbmVfY3JlYXRlX3JpbmcoZW5naW5lLCBnbG9iYWxfcmluZ19zaXplKCkpOworCWlmIChJ
U19FUlIocmluZykpIHsKKwkJZXJyID0gUFRSX0VSUihyaW5nKTsKKwkJZ290byBlcnI7CisJfQor
CisJZXJyID0gaW50ZWxfcmluZ19waW4ocmluZyk7CisJaWYgKGVycikKKwkJZ290byBlcnJfcmlu
ZzsKKworCUdFTV9CVUdfT04oZW5naW5lLT5sZWdhY3kucmluZyk7CisJZW5naW5lLT5sZWdhY3ku
cmluZyA9IHJpbmc7CisKKwllbmdpbmUtPmZsYWdzIHw9IEk5MTVfRU5HSU5FX0hBU19TQ0hFRFVM
RVI7CisJZW5naW5lLT5mbGFncyB8PSBJOTE1X0VOR0lORV9ORUVEU19CUkVBRENSVU1CX1RBU0tM
RVQ7CisJZW5naW5lLT5mbGFncyB8PSBJOTE1X0VOR0lORV9TVVBQT1JUU19TVEFUUzsKKworCS8q
IEZpbmFsbHksIHRha2Ugb3duZXJzaGlwIGFuZCByZXNwb25zaWJpbGl0eSBmb3IgY2xlYW51cCEg
Ki8KKwllbmdpbmUtPnJlbGVhc2UgPSByaW5nX3JlbGVhc2U7CisJcmV0dXJuIDA7CisKK2Vycl9y
aW5nOgorCWludGVsX3JpbmdfcHV0KHJpbmcpOworZXJyOgorCWludGVsX2VuZ2luZV9jbGVhbnVw
X2NvbW1vbihlbmdpbmUpOworCXJldHVybiBlcnI7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nX3N1Ym1pc3Npb24uYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX3Jpbmdfc3VibWlzc2lvbi5jCmluZGV4IDY4YTA4NDg2ZmM4Ny4uNGNmN2M2
NDg2MjIzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nX3N1
Ym1pc3Npb24uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nX3N1Ym1p
c3Npb24uYwpAQCAtMzYsNiArMzYsNyBAQAogI2luY2x1ZGUgImludGVsX2d0LmgiCiAjaW5jbHVk
ZSAiaW50ZWxfcmVzZXQuaCIKICNpbmNsdWRlICJpbnRlbF9yaW5nLmgiCisjaW5jbHVkZSAiaW50
ZWxfcmluZ19zdWJtaXNzaW9uLmgiCiAjaW5jbHVkZSAic2htZW1fdXRpbHMuaCIKIAogLyogUm91
Z2ggZXN0aW1hdGUgb2YgdGhlIHR5cGljYWwgcmVxdWVzdCBzaXplLCBwZXJmb3JtaW5nIGEgZmx1
c2gsCkBAIC0yMTQsNyArMjE1LDcgQEAgc3RhdGljIHZvaWQgc2V0X3BwX2RpcihzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJfQogfQogCi1zdGF0aWMgaW50IHhjc19yZXN1bWUoc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQoraW50IGludGVsX3Jpbmdfc3VibWlzc2lvbl9y
ZXN1bWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IGVuZ2luZS0+aTkxNTsKIAlzdHJ1Y3QgaW50ZWxfcmluZyAq
cmluZyA9IGVuZ2luZS0+bGVnYWN5LnJpbmc7CkBAIC0zMTgsNyArMzE5LDcgQEAgc3RhdGljIGlu
dCB4Y3NfcmVzdW1lKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAlyZXR1cm4gcmV0
OwogfQogCi1zdGF0aWMgdm9pZCByZXNldF9wcmVwYXJlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZSkKK3ZvaWQgaW50ZWxfcmluZ19zdWJtaXNzaW9uX3Jlc2V0X3ByZXBhcmUoc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewogCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29y
ZSA9IGVuZ2luZS0+dW5jb3JlOwogCWNvbnN0IHUzMiBiYXNlID0gZW5naW5lLT5tbWlvX2Jhc2U7
CkBAIC00MjUsNyArNDI2LDcgQEAgc3RhdGljIHZvaWQgcmVzZXRfcmV3aW5kKHN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKmVuZ2luZSwgYm9vbCBzdGFsbGVkKQogCXNwaW5fdW5sb2NrX2lycXJlc3Rv
cmUoJmVuZ2luZS0+YWN0aXZlLmxvY2ssIGZsYWdzKTsKIH0KIAotc3RhdGljIHZvaWQgcmVzZXRf
ZmluaXNoKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKK3ZvaWQgaW50ZWxfcmluZ19z
dWJtaXNzaW9uX3Jlc2V0X2ZpbmlzaChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7
CiB9CiAKQEAgLTEwNTYsMTEgKzEwNTcsMTEgQEAgc3RhdGljIHZvaWQgc2V0dXBfY29tbW9uKHN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAogCXNldHVwX2lycShlbmdpbmUpOwogCi0J
ZW5naW5lLT5yZXN1bWUgPSB4Y3NfcmVzdW1lOwotCWVuZ2luZS0+cmVzZXQucHJlcGFyZSA9IHJl
c2V0X3ByZXBhcmU7CisJZW5naW5lLT5yZXN1bWUgPSBpbnRlbF9yaW5nX3N1Ym1pc3Npb25fcmVz
dW1lOworCWVuZ2luZS0+cmVzZXQucHJlcGFyZSA9IGludGVsX3Jpbmdfc3VibWlzc2lvbl9yZXNl
dF9wcmVwYXJlOwogCWVuZ2luZS0+cmVzZXQucmV3aW5kID0gcmVzZXRfcmV3aW5kOwogCWVuZ2lu
ZS0+cmVzZXQuY2FuY2VsID0gcmVzZXRfY2FuY2VsOwotCWVuZ2luZS0+cmVzZXQuZmluaXNoID0g
cmVzZXRfZmluaXNoOworCWVuZ2luZS0+cmVzZXQuZmluaXNoID0gaW50ZWxfcmluZ19zdWJtaXNz
aW9uX3Jlc2V0X2ZpbmlzaDsKIAogCWVuZ2luZS0+Y29wcyA9ICZyaW5nX2NvbnRleHRfb3BzOwog
CWVuZ2luZS0+cmVxdWVzdF9hbGxvYyA9IHJpbmdfcmVxdWVzdF9hbGxvYzsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jpbmdfc3VibWlzc2lvbi5oIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ19zdWJtaXNzaW9uLmgKbmV3IGZpbGUgbW9kZSAx
MDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi43MDFlYjAzM2UwNTUKLS0tIC9kZXYvbnVsbAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nX3N1Ym1pc3Npb24uaApAQCAtMCww
ICsxLDE2IEBACisvKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUICovCisvKgorICogQ29w
eXJpZ2h0IMKpIDIwMjAgSW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaWZuZGVmIF9fSU5URUxf
UklOR19TVUJNSVNTSU9OX0hfXworI2RlZmluZSBfX0lOVEVMX1JJTkdfU1VCTUlTU0lPTl9IX18K
Kworc3RydWN0IGludGVsX2VuZ2luZV9jczsKKwordm9pZCBpbnRlbF9yaW5nX3N1Ym1pc3Npb25f
cmVzZXRfcHJlcGFyZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOwordm9pZCBpbnRl
bF9yaW5nX3N1Ym1pc3Npb25fcmVzZXRfZmluaXNoKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSk7CisKK2ludCBpbnRlbF9yaW5nX3N1Ym1pc3Npb25fcmVzdW1lKHN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZSk7CisKKyNlbmRpZiAvKiBfX0lOVEVMX1JJTkdfU1VCTUlTU0lPTl9I
X18gKi8KLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50
ZWwtZ2Z4Cg==

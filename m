Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id BECB4114307
	for <lists+intel-gfx@lfdr.de>; Thu,  5 Dec 2019 15:52:50 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 03D866E124;
	Thu,  5 Dec 2019 14:52:49 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 698AC6E136
 for <intel-gfx@lists.freedesktop.org>; Thu,  5 Dec 2019 14:52:47 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19472191-1500050 
 for multiple; Thu, 05 Dec 2019 14:52:40 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  5 Dec 2019 14:52:35 +0000
Message-Id: <20191205145238.635670-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 1/4] drm/i915/selftests: Disable heartbeats
 around long queues
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Rm9yIHNvbWUgZXhlY2xpc3RzIHNjaGVkdWxlciB0ZXN0cyB3ZSBhc3N1bWUgdmVyeSBwcmVjaXNl
IGxheW91dCBvZiB0aGUKaW5mbGlnaHQgcXVldWUgYW5kIGJlY29tZSBhbmdyeSBpZiB0aGUgaGVh
cnRiZWF0IGludGVyZmVyZXMgYnkKcmVwcmlvcml0aXNpbmcgb3VyIGNvbnRleHRzIChiZWNhdXNl
IHdlIGhhcHBlbiB0byBiZSB1c2luZyB0aGUgc2FtZQplbmdpbmUtPmtlcm5lbF9jb250ZXh0IGZv
ciBvdXIgdGVzdCkuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdp
bHNvbi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYyB8
IDQyICsrKysrKysrKysrKysrKysrKysrKy0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgMzQgaW5zZXJ0
aW9ucygrKSwgOCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xy
Yy5jCmluZGV4IGFjOGI5MTE2ZDMwNy4uNTRiY2UyODI3MTdhIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF9scmMuYwpAQCAtNTAsNiArNTAsMjQgQEAgc3RhdGljIHN0cnVjdCBpOTE1
X3ZtYSAqY3JlYXRlX3NjcmF0Y2goc3RydWN0IGludGVsX2d0ICpndCkKIAlyZXR1cm4gdm1hOwog
fQogCitzdGF0aWMgdm9pZCBlbmdpbmVfaGVhcnRiZWF0X2Rpc2FibGUoc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lLAorCQkJCSAgICAgdW5zaWduZWQgbG9uZyAqc2F2ZWQpCit7CisJKnNh
dmVkID0gZW5naW5lLT5wcm9wcy5oZWFydGJlYXRfaW50ZXJ2YWxfbXM7CisJZW5naW5lLT5wcm9w
cy5oZWFydGJlYXRfaW50ZXJ2YWxfbXMgPSAwOworCisJaW50ZWxfZW5naW5lX3BtX2dldChlbmdp
bmUpOworCWludGVsX2VuZ2luZV9wYXJrX2hlYXJ0YmVhdChlbmdpbmUpOworfQorCitzdGF0aWMg
dm9pZCBlbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmUsCisJCQkJICAgIHVuc2lnbmVkIGxvbmcgc2F2ZWQpCit7CisJaW50ZWxfZW5naW5lX3BtX3B1
dChlbmdpbmUpOworCisJZW5naW5lLT5wcm9wcy5oZWFydGJlYXRfaW50ZXJ2YWxfbXMgPSBzYXZl
ZDsKK30KKwogc3RhdGljIGludCBsaXZlX3Nhbml0eWNoZWNrKHZvaWQgKmFyZykKIHsKIAlzdHJ1
Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwpAQCAtMTI4LDYgKzE0Niw3IEBAIHN0YXRpYyBpbnQgbGl2
ZV91bmxpdGVfcmVzdG9yZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBpbnQgcHJpbykKIAkJc3RydWN0
IGludGVsX2NvbnRleHQgKmNlWzJdID0ge307CiAJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxWzJd
OwogCQlzdHJ1Y3QgaWd0X2xpdmVfdGVzdCB0OworCQl1bnNpZ25lZCBsb25nIHNhdmVkOwogCQlp
bnQgbjsKIAogCQlpZiAocHJpbyAmJiAhaW50ZWxfZW5naW5lX2hhc19wcmVlbXB0aW9uKGVuZ2lu
ZSkpCkBAIC0xNDAsNiArMTU5LDcgQEAgc3RhdGljIGludCBsaXZlX3VubGl0ZV9yZXN0b3JlKHN0
cnVjdCBpbnRlbF9ndCAqZ3QsIGludCBwcmlvKQogCQkJZXJyID0gLUVJTzsKIAkJCWJyZWFrOwog
CQl9CisJCWVuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUsICZzYXZlZCk7CiAKIAkJZm9y
IChuID0gMDsgbiA8IEFSUkFZX1NJWkUoY2UpOyBuKyspIHsKIAkJCXN0cnVjdCBpbnRlbF9jb250
ZXh0ICp0bXA7CkBAIC0yNDcsNiArMjY3LDcgQEAgc3RhdGljIGludCBsaXZlX3VubGl0ZV9yZXN0
b3JlKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIGludCBwcmlvKQogCQkJaW50ZWxfY29udGV4dF9wdXQo
Y2Vbbl0pOwogCQl9CiAKKwkJZW5naW5lX2hlYXJ0YmVhdF9lbmFibGUoZW5naW5lLCBzYXZlZCk7
CiAJCWlmIChpZ3RfbGl2ZV90ZXN0X2VuZCgmdCkpCiAJCQllcnIgPSAtRUlPOwogCQlpZiAoZXJy
KQpAQCAtNDY4LDEyICs0ODksMTYgQEAgc3RhdGljIGludCBsaXZlX3RpbWVzbGljZV9wcmVlbXB0
KHZvaWQgKmFyZykKIAkJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAKIAkJZm9yX2VhY2hfZW5n
aW5lKGVuZ2luZSwgZ3QsIGlkKSB7CisJCQl1bnNpZ25lZCBsb25nIHNhdmVkOworCiAJCQlpZiAo
IWludGVsX2VuZ2luZV9oYXNfcHJlZW1wdGlvbihlbmdpbmUpKQogCQkJCWNvbnRpbnVlOwogCiAJ
CQltZW1zZXQodmFkZHIsIDAsIFBBR0VfU0laRSk7CiAKKwkJCWVuZ2luZV9oZWFydGJlYXRfZGlz
YWJsZShlbmdpbmUsICZzYXZlZCk7CiAJCQllcnIgPSBzbGljZV9zZW1hcGhvcmVfcXVldWUoZW5n
aW5lLCB2bWEsIGNvdW50KTsKKwkJCWVuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVuZ2luZSwgc2F2
ZWQpOwogCQkJaWYgKGVycikKIAkJCQlnb3RvIGVycl9waW47CiAKQEAgLTU2NiwxNyArNTkxLDE5
IEBAIHN0YXRpYyBpbnQgbGl2ZV90aW1lc2xpY2VfcXVldWUodm9pZCAqYXJnKQogCQkJLnByaW9y
aXR5ID0gSTkxNV9VU0VSX1BSSU9SSVRZKEk5MTVfUFJJT1JJVFlfTUFYKSwKIAkJfTsKIAkJc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnEsICpub3A7CisJCXVuc2lnbmVkIGxvbmcgc2F2ZWQ7CiAKIAkJ
aWYgKCFpbnRlbF9lbmdpbmVfaGFzX3ByZWVtcHRpb24oZW5naW5lKSkKIAkJCWNvbnRpbnVlOwog
CisJCWVuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUsICZzYXZlZCk7CiAJCW1lbXNldCh2
YWRkciwgMCwgUEFHRV9TSVpFKTsKIAogCQkvKiBFTFNQWzBdOiBzZW1hcGhvcmUgd2FpdCAqLwog
CQlycSA9IHNlbWFwaG9yZV9xdWV1ZShlbmdpbmUsIHZtYSwgMCk7CiAJCWlmIChJU19FUlIocnEp
KSB7CiAJCQllcnIgPSBQVFJfRVJSKHJxKTsKLQkJCWdvdG8gZXJyX3BpbjsKKwkJCWdvdG8gZXJy
X2hlYXJ0YmVhdDsKIAkJfQogCQllbmdpbmUtPnNjaGVkdWxlKHJxLCAmYXR0cik7CiAJCXdhaXRf
Zm9yX3N1Ym1pdChlbmdpbmUsIHJxKTsKQEAgLTU4NSw4ICs2MTIsNyBAQCBzdGF0aWMgaW50IGxp
dmVfdGltZXNsaWNlX3F1ZXVlKHZvaWQgKmFyZykKIAkJbm9wID0gbm9wX3JlcXVlc3QoZW5naW5l
KTsKIAkJaWYgKElTX0VSUihub3ApKSB7CiAJCQllcnIgPSBQVFJfRVJSKG5vcCk7Ci0JCQlpOTE1
X3JlcXVlc3RfcHV0KHJxKTsKLQkJCWdvdG8gZXJyX3BpbjsKKwkJCWdvdG8gZXJyX3JxOwogCQl9
CiAJCXdhaXRfZm9yX3N1Ym1pdChlbmdpbmUsIG5vcCk7CiAJCWk5MTVfcmVxdWVzdF9wdXQobm9w
KTsKQEAgLTU5NiwxMCArNjIyLDggQEAgc3RhdGljIGludCBsaXZlX3RpbWVzbGljZV9xdWV1ZSh2
b2lkICphcmcpCiAKIAkJLyogUXVldWU6IHNlbWFwaG9yZSBzaWduYWwsIG1hdGNoaW5nIHByaW9y
aXR5IGFzIHNlbWFwaG9yZSAqLwogCQllcnIgPSByZWxlYXNlX3F1ZXVlKGVuZ2luZSwgdm1hLCAx
LCBlZmZlY3RpdmVfcHJpbyhycSkpOwotCQlpZiAoZXJyKSB7Ci0JCQlpOTE1X3JlcXVlc3RfcHV0
KHJxKTsKLQkJCWdvdG8gZXJyX3BpbjsKLQkJfQorCQlpZiAoZXJyKQorCQkJZ290byBlcnJfcnE7
CiAKIAkJaW50ZWxfZW5naW5lX2ZsdXNoX3N1Ym1pc3Npb24oZW5naW5lKTsKIAkJaWYgKCFSRUFE
X09OQ0UoZW5naW5lLT5leGVjbGlzdHMudGltZXIuZXhwaXJlcykgJiYKQEAgLTYzMCwxMiArNjU0
LDE0IEBAIHN0YXRpYyBpbnQgbGl2ZV90aW1lc2xpY2VfcXVldWUodm9pZCAqYXJnKQogCQkJbWVt
c2V0KHZhZGRyLCAweGZmLCBQQUdFX1NJWkUpOwogCQkJZXJyID0gLUVJTzsKIAkJfQorZXJyX3Jx
OgogCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKK2Vycl9oZWFydGJlYXQ6CisJCWVuZ2luZV9oZWFy
dGJlYXRfZW5hYmxlKGVuZ2luZSwgc2F2ZWQpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAJfQog
Ci1lcnJfcGluOgogCWk5MTVfdm1hX3VucGluKHZtYSk7CiBlcnJfbWFwOgogCWk5MTVfZ2VtX29i
amVjdF91bnBpbl9tYXAob2JqKTsKLS0gCjIuMjQuMAoKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhA
bGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxt
YW4vbGlzdGluZm8vaW50ZWwtZ2Z4

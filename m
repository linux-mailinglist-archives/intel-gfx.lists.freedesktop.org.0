Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D769B9B0E3
	for <lists+intel-gfx@lfdr.de>; Fri, 23 Aug 2019 15:27:29 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DEBAE6EC94;
	Fri, 23 Aug 2019 13:27:25 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id DAF8C6EC93
 for <intel-gfx@lists.freedesktop.org>; Fri, 23 Aug 2019 13:27:17 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18240597-1500050 
 for multiple; Fri, 23 Aug 2019 14:27:03 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 23 Aug 2019 14:26:48 +0100
Message-Id: <20190823132700.25286-4-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190823132700.25286-1-chris@chris-wilson.co.uk>
References: <20190823132700.25286-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 03/15] drm/i915/selftests: Teach
 igt_gpu_fill_dw() to take intel_context
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Matthew Auld <matthew.auld@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QXZvaWQgaGF2aW5nIHRvIHBhc3MgYXJvdW5kIChjdHgsIGVuZ2luZSkgZXZlcnl3aGVyZSBieSBw
YXNzaW5nIHRoZQphY3R1YWwgaW50ZWxfY29udGV4dCB3ZSBpbnRlbmQgdG8gdXNlLiBUb2RheSB3
ZSBwcmVhY2ggdGhpcyBsZXNzb24gdG8KaWd0X2dwdV9maWxsX2R3IGFuZCBpdHMgY2FsbGVycycg
Y2FsbGVycy4KClRoZSBpbW1lZGlhdGUgYmVuZWZpdCBmb3IgdGhlIEdFTSBzZWxmdGVzdHMgaXMg
dGhhdCB3ZSBhaW0gdG8gdXNlIHRoZQpHRU0gY29udGV4dCBhcyB0aGUgY29udHJvbCwgdGhlIHNv
dXJjZSBvZiB0aGUgZW5naW5lcyBvbiB3aGljaCB0byB0ZXN0CnRoZSBHRU0gY29udGV4dC4KClNp
Z25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzog
TWF0dGhldyBBdWxkIDxtYXR0aGV3LmF1bGRAaW50ZWwuY29tPgpSZXZpZXdlZC1ieTogTWF0dGhl
dyBBdWxkIDxtYXR0aGV3LmF1bGRAaW50ZWwuY29tPgotLS0KIC4uLi9ncHUvZHJtL2k5MTUvZ2Vt
L3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMgICB8IDkyICsrKysrKysrKystLS0tLS0tLS0KIC4uLi9k
cm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyB8IDcwICsrKysrKysrLS0t
LS0tCiAuLi4vZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pZ3RfZ2VtX3V0aWxzLmMgICAgfCAyNiAr
KystLS0KIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2lndF9nZW1fdXRpbHMuaCAgICB8IDEz
ICsrLQogNCBmaWxlcyBjaGFuZ2VkLCAxMDkgaW5zZXJ0aW9ucygrKSwgOTIgZGVsZXRpb25zKC0p
CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3Bh
Z2VzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYwpp
bmRleCA4ZGU4M2M2ZDgxZjUuLmEwYTI3MjU1NjI4OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMKQEAgLTg3OSw5ICs4NzksOCBAQCBzdGF0
aWMgaW50IGlndF9tb2NrX3BwZ3R0XzY0Syh2b2lkICphcmcpCiAJcmV0dXJuIGVycjsKIH0KIAot
c3RhdGljIGludCBncHVfd3JpdGUoc3RydWN0IGk5MTVfdm1hICp2bWEsCi0JCSAgICAgc3RydWN0
IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKLQkJICAgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpl
bmdpbmUsCitzdGF0aWMgaW50IGdwdV93cml0ZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCisJ
CSAgICAgc3RydWN0IGk5MTVfdm1hICp2bWEsCiAJCSAgICAgdTMyIGR3LAogCQkgICAgIHUzMiB2
YWwpCiB7CkBAIC04OTMsNyArODkyLDcgQEAgc3RhdGljIGludCBncHVfd3JpdGUoc3RydWN0IGk5
MTVfdm1hICp2bWEsCiAJaWYgKGVycikKIAkJcmV0dXJuIGVycjsKIAotCXJldHVybiBpZ3RfZ3B1
X2ZpbGxfZHcodm1hLCBjdHgsIGVuZ2luZSwgZHcgKiBzaXplb2YodTMyKSwKKwlyZXR1cm4gaWd0
X2dwdV9maWxsX2R3KGNlLCB2bWEsIGR3ICogc2l6ZW9mKHUzMiksCiAJCQkgICAgICAgdm1hLT5z
aXplID4+IFBBR0VfU0hJRlQsIHZhbCk7CiB9CiAKQEAgLTkyOSwxOCArOTI4LDE2IEBAIHN0YXRp
YyBpbnQgY3B1X2NoZWNrKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosIHUzMiBkd29y
ZCwgdTMyIHZhbCkKIAlyZXR1cm4gZXJyOwogfQogCi1zdGF0aWMgaW50IF9faWd0X3dyaXRlX2h1
Z2Uoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKLQkJCSAgICBzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmUsCitzdGF0aWMgaW50IF9faWd0X3dyaXRlX2h1Z2Uoc3RydWN0IGludGVs
X2NvbnRleHQgKmNlLAogCQkJICAgIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJ
CQkgICAgdTY0IHNpemUsIHU2NCBvZmZzZXQsCiAJCQkgICAgdTMyIGR3b3JkLCB1MzIgdmFsKQog
ewotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gY3R4LT52bSA/OiAmZW5naW5lLT5n
dC0+Z2d0dC0+dm07CiAJdW5zaWduZWQgaW50IGZsYWdzID0gUElOX1VTRVIgfCBQSU5fT0ZGU0VU
X0ZJWEVEOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCWludCBlcnI7CiAKLQl2bWEgPSBpOTE1
X3ZtYV9pbnN0YW5jZShvYmosIHZtLCBOVUxMKTsKKwl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShv
YmosIGNlLT52bSwgTlVMTCk7CiAJaWYgKElTX0VSUih2bWEpKQogCQlyZXR1cm4gUFRSX0VSUih2
bWEpOwogCkBAIC05NTQsNyArOTUxLDcgQEAgc3RhdGljIGludCBfX2lndF93cml0ZV9odWdlKHN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCSAqIFRoZSBnZ3R0IG1heSBoYXZlIHNvbWUg
cGFnZXMgcmVzZXJ2ZWQgc28KIAkJICogcmVmcmFpbiBmcm9tIGVycm9yaW5nIG91dC4KIAkJICov
Ci0JCWlmIChlcnIgPT0gLUVOT1NQQyAmJiBpOTE1X2lzX2dndHQodm0pKQorCQlpZiAoZXJyID09
IC1FTk9TUEMgJiYgaTkxNV9pc19nZ3R0KGNlLT52bSkpCiAJCQllcnIgPSAwOwogCiAJCWdvdG8g
b3V0X3ZtYV9jbG9zZTsKQEAgLTk2NCw3ICs5NjEsNyBAQCBzdGF0aWMgaW50IF9faWd0X3dyaXRl
X2h1Z2Uoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAlpZiAoZXJyKQogCQlnb3RvIG91
dF92bWFfdW5waW47CiAKLQllcnIgPSBncHVfd3JpdGUodm1hLCBjdHgsIGVuZ2luZSwgZHdvcmQs
IHZhbCk7CisJZXJyID0gZ3B1X3dyaXRlKGNlLCB2bWEsIGR3b3JkLCB2YWwpOwogCWlmIChlcnIp
IHsKIAkJcHJfZXJyKCJncHUtd3JpdGUgZmFpbGVkIGF0IG9mZnNldD0lbGx4XG4iLCBvZmZzZXQp
OwogCQlnb3RvIG91dF92bWFfdW5waW47CkBAIC05ODcsMTQgKzk4NCwxMyBAQCBzdGF0aWMgaW50
IF9faWd0X3dyaXRlX2h1Z2Uoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIHN0YXRpYyBp
bnQgaWd0X3dyaXRlX2h1Z2Uoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJCSAgc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7Ci0Jc3RydWN0IGk5MTVfYWRkcmVzc19z
cGFjZSAqdm0gPSBjdHgtPnZtID86ICZpOTE1LT5nZ3R0LnZtOwotCXN0YXRpYyBzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmVzW0k5MTVfTlVNX0VOR0lORVNdOwotCXN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZTsKKwlzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lcyAqZW5naW5lczsKKwlz
dHJ1Y3QgaTkxNV9nZW1fZW5naW5lc19pdGVyIGl0OworCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpj
ZTsKIAlJOTE1X1JORF9TVEFURShwcm5nKTsKIAlJR1RfVElNRU9VVChlbmRfdGltZSk7CiAJdW5z
aWduZWQgaW50IG1heF9wYWdlX3NpemU7Ci0JdW5zaWduZWQgaW50IGlkOworCXVuc2lnbmVkIGlu
dCBjb3VudDsKIAl1NjQgbWF4OwogCXU2NCBudW07CiAJdTY0IHNpemU7CkBAIC0xMDA5LDE4ICsx
MDA1LDE2IEBAIHN0YXRpYyBpbnQgaWd0X3dyaXRlX2h1Z2Uoc3RydWN0IGk5MTVfZ2VtX2NvbnRl
eHQgKmN0eCwKIAkJc2l6ZSA9IHJvdW5kX3VwKHNpemUsIEk5MTVfR1RUX1BBR0VfU0laRV8yTSk7
CiAKIAltYXhfcGFnZV9zaXplID0gcm91bmRkb3duX3Bvd19vZl90d28ob2JqLT5tbS5wYWdlX3Np
emVzLnNnKTsKLQltYXggPSBkaXZfdTY0KCh2bS0+dG90YWwgLSBzaXplKSwgbWF4X3BhZ2Vfc2l6
ZSk7CisJbWF4ID0gZGl2X3U2NCgoY3R4LT52bS0+dG90YWwgLSBzaXplKSwgbWF4X3BhZ2Vfc2l6
ZSk7CiAKIAluID0gMDsKLQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgewotCQlp
ZiAoIWludGVsX2VuZ2luZV9jYW5fc3RvcmVfZHdvcmQoZW5naW5lKSkgewotCQkJcHJfaW5mbygi
c3RvcmUtZHdvcmQtaW1tIG5vdCBzdXBwb3J0ZWQgb24gZW5naW5lPSV1XG4iLAotCQkJCWlkKTsK
Kwlmb3JfZWFjaF9nZW1fZW5naW5lKGNlLCBpOTE1X2dlbV9jb250ZXh0X2xvY2tfZW5naW5lcyhj
dHgpLCBpdCkgeworCQljb3VudCsrOworCQlpZiAoIWludGVsX2VuZ2luZV9jYW5fc3RvcmVfZHdv
cmQoY2UtPmVuZ2luZSkpCiAJCQljb250aW51ZTsKLQkJfQotCQllbmdpbmVzW24rK10gPSBlbmdp
bmU7CisJCW4rKzsKIAl9Ci0KKwlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19lbmdpbmVzKGN0eCk7
CiAJaWYgKCFuKQogCQlyZXR1cm4gMDsKIApAQCAtMTAyOSw3ICsxMDIzLDcgQEAgc3RhdGljIGlu
dCBpZ3Rfd3JpdGVfaHVnZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogCSAqIHJhbmRv
bWl6ZWQgb3JkZXIsIGxldHMgYWxzbyBtYWtlIGZlZWRpbmcgdG8gdGhlIHNhbWUgZW5naW5lIGEg
ZmV3CiAJICogdGltZXMgaW4gc3VjY2Vzc2lvbiBhIHBvc3NpYmlsaXR5IGJ5IGVubGFyZ2luZyB0
aGUgcGVybXV0YXRpb24gYXJyYXkuCiAJICovCi0Jb3JkZXIgPSBpOTE1X3JhbmRvbV9vcmRlcihu
ICogSTkxNV9OVU1fRU5HSU5FUywgJnBybmcpOworCW9yZGVyID0gaTkxNV9yYW5kb21fb3JkZXIo
Y291bnQgKiBjb3VudCwgJnBybmcpOwogCWlmICghb3JkZXIpCiAJCXJldHVybiAtRU5PTUVNOwog
CkBAIC0xMDM5LDEzICsxMDMzLDE3IEBAIHN0YXRpYyBpbnQgaWd0X3dyaXRlX2h1Z2Uoc3RydWN0
IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkgKiBvZmZzZXQgPSAwLgogCSAqLwogCWkgPSAwOwor
CWVuZ2luZXMgPSBpOTE1X2dlbV9jb250ZXh0X2xvY2tfZW5naW5lcyhjdHgpOwogCWZvcl9lYWNo
X3ByaW1lX251bWJlcl9mcm9tKG51bSwgMCwgbWF4KSB7CiAJCXU2NCBvZmZzZXRfbG93ID0gbnVt
ICogbWF4X3BhZ2Vfc2l6ZTsKIAkJdTY0IG9mZnNldF9oaWdoID0gKG1heCAtIG51bSkgKiBtYXhf
cGFnZV9zaXplOwogCQl1MzIgZHdvcmQgPSBvZmZzZXRfaW5fcGFnZShudW0pIC8gNDsKKwkJc3Ry
dWN0IGludGVsX2NvbnRleHQgKmNlOwogCi0JCWVuZ2luZSA9IGVuZ2luZXNbb3JkZXJbaV0gJSBu
XTsKLQkJaSA9IChpICsgMSkgJSAobiAqIEk5MTVfTlVNX0VOR0lORVMpOworCQljZSA9IGVuZ2lu
ZXMtPmVuZ2luZXNbb3JkZXJbaV0gJSBlbmdpbmVzLT5udW1fZW5naW5lc107CisJCWkgPSAoaSAr
IDEpICUgKGNvdW50ICogY291bnQpOworCQlpZiAoIWludGVsX2VuZ2luZV9jYW5fc3RvcmVfZHdv
cmQoY2UtPmVuZ2luZSkpCisJCQljb250aW51ZTsKIAogCQkvKgogCQkgKiBJbiBvcmRlciB0byB1
dGlsaXplIDY0SyBwYWdlcyB3ZSBuZWVkIHRvIGJvdGggcGFkIHRoZSB2bWEKQEAgLTEwNTcsMjIg
KzEwNTUsMjMgQEAgc3RhdGljIGludCBpZ3Rfd3JpdGVfaHVnZShzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqY3R4LAogCQkJb2Zmc2V0X2xvdyA9IHJvdW5kX2Rvd24ob2Zmc2V0X2xvdywKIAkJCQkJ
CUk5MTVfR1RUX1BBR0VfU0laRV8yTSk7CiAKLQkJZXJyID0gX19pZ3Rfd3JpdGVfaHVnZShjdHgs
IGVuZ2luZSwgb2JqLCBzaXplLCBvZmZzZXRfbG93LAorCQllcnIgPSBfX2lndF93cml0ZV9odWdl
KGNlLCBvYmosIHNpemUsIG9mZnNldF9sb3csCiAJCQkJICAgICAgIGR3b3JkLCBudW0gKyAxKTsK
IAkJaWYgKGVycikKIAkJCWJyZWFrOwogCi0JCWVyciA9IF9faWd0X3dyaXRlX2h1Z2UoY3R4LCBl
bmdpbmUsIG9iaiwgc2l6ZSwgb2Zmc2V0X2hpZ2gsCisJCWVyciA9IF9faWd0X3dyaXRlX2h1Z2Uo
Y2UsIG9iaiwgc2l6ZSwgb2Zmc2V0X2hpZ2gsCiAJCQkJICAgICAgIGR3b3JkLCBudW0gKyAxKTsK
IAkJaWYgKGVycikKIAkJCWJyZWFrOwogCiAJCWlmIChpZ3RfdGltZW91dChlbmRfdGltZSwKLQkJ
CQkiJXMgdGltZWQgb3V0IG9uIGVuZ2luZT0ldSwgb2Zmc2V0X2xvdz0lbGx4IG9mZnNldF9oaWdo
PSVsbHgsIG1heF9wYWdlX3NpemU9JXhcbiIsCi0JCQkJX19mdW5jX18sIGVuZ2luZS0+aWQsIG9m
ZnNldF9sb3csIG9mZnNldF9oaWdoLAorCQkJCSIlcyB0aW1lZCBvdXQgb24gJXMsIG9mZnNldF9s
b3c9JWxseCBvZmZzZXRfaGlnaD0lbGx4LCBtYXhfcGFnZV9zaXplPSV4XG4iLAorCQkJCV9fZnVu
Y19fLCBjZS0+ZW5naW5lLT5uYW1lLCBvZmZzZXRfbG93LCBvZmZzZXRfaGlnaCwKIAkJCQltYXhf
cGFnZV9zaXplKSkKIAkJCWJyZWFrOwogCX0KKwlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19lbmdp
bmVzKGN0eCk7CiAKIAlrZnJlZShvcmRlcik7CiAKQEAgLTEzMTYsMTAgKzEzMTUsMTEgQEAgc3Rh
dGljIGludCBpZ3RfcHBndHRfcGluX3VwZGF0ZSh2b2lkICphcmcpCiAJdW5zaWduZWQgbG9uZyBz
dXBwb3J0ZWQgPSBJTlRFTF9JTkZPKGRldl9wcml2KS0+cGFnZV9zaXplczsKIAlzdHJ1Y3QgaTkx
NV9hZGRyZXNzX3NwYWNlICp2bSA9IGN0eC0+dm07CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iajsKKwlzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lc19pdGVyIGl0OworCXN0cnVjdCBpbnRl
bF9jb250ZXh0ICpjZTsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAl1bnNpZ25lZCBpbnQgZmxh
Z3MgPSBQSU5fVVNFUiB8IFBJTl9PRkZTRVRfRklYRUQ7CiAJc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lOwotCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwogCXVuc2lnbmVkIGludCBuOwog
CWludCBmaXJzdCwgbGFzdDsKIAlpbnQgZXJyOwpAQCAtMTQxOSwxNCArMTQxOSwxOCBAQCBzdGF0
aWMgaW50IGlndF9wcGd0dF9waW5fdXBkYXRlKHZvaWQgKmFyZykKIAkgKi8KIAogCW4gPSAwOwot
CWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGRldl9wcml2LCBpZCkgeworCWZvcl9lYWNoX2dlbV9l
bmdpbmUoY2UsIGk5MTVfZ2VtX2NvbnRleHRfbG9ja19lbmdpbmVzKGN0eCksIGl0KSB7CiAJCWlm
ICghaW50ZWxfZW5naW5lX2Nhbl9zdG9yZV9kd29yZChlbmdpbmUpKQogCQkJY29udGludWU7CiAK
LQkJZXJyID0gZ3B1X3dyaXRlKHZtYSwgY3R4LCBlbmdpbmUsIG4rKywgMHhkZWFkYmVhZik7CisJ
CWVyciA9IGdwdV93cml0ZShjZSwgdm1hLCBuKyssIDB4ZGVhZGJlYWYpOwogCQlpZiAoZXJyKQot
CQkJZ290byBvdXRfdW5waW47CisJCQlicmVhazsKIAl9CisJaTkxNV9nZW1fY29udGV4dF91bmxv
Y2tfZW5naW5lcyhjdHgpOworCWlmIChlcnIpCisJCWdvdG8gb3V0X3VucGluOworCiAJd2hpbGUg
KG4tLSkgewogCQllcnIgPSBjcHVfY2hlY2sob2JqLCBuLCAweGRlYWRiZWFmKTsKIAkJaWYgKGVy
cikKQEAgLTE1MDcsOCArMTUxMSw4IEBAIHN0YXRpYyBpbnQgaWd0X3Nocmlua190aHAodm9pZCAq
YXJnKQogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gY3R4LT5pOTE1OwogCXN0cnVj
dCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gY3R4LT52bSA/OiAmaTkxNS0+Z2d0dC52bTsKIAlz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwotCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZTsKLQllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKKwlzdHJ1Y3QgaTkxNV9nZW1fZW5n
aW5lc19pdGVyIGl0OworCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAlzdHJ1Y3QgaTkxNV92
bWEgKnZtYTsKIAl1bnNpZ25lZCBpbnQgZmxhZ3MgPSBQSU5fVVNFUjsKIAl1bnNpZ25lZCBpbnQg
bjsKQEAgLTE1NDgsMTYgKzE1NTIsMTkgQEAgc3RhdGljIGludCBpZ3Rfc2hyaW5rX3RocCh2b2lk
ICphcmcpCiAJCWdvdG8gb3V0X3VucGluOwogCiAJbiA9IDA7Ci0JZm9yX2VhY2hfZW5naW5lKGVu
Z2luZSwgaTkxNSwgaWQpIHsKLQkJaWYgKCFpbnRlbF9lbmdpbmVfY2FuX3N0b3JlX2R3b3JkKGVu
Z2luZSkpCisKKwlmb3JfZWFjaF9nZW1fZW5naW5lKGNlLCBpOTE1X2dlbV9jb250ZXh0X2xvY2tf
ZW5naW5lcyhjdHgpLCBpdCkgeworCQlpZiAoIWludGVsX2VuZ2luZV9jYW5fc3RvcmVfZHdvcmQo
Y2UtPmVuZ2luZSkpCiAJCQljb250aW51ZTsKIAotCQllcnIgPSBncHVfd3JpdGUodm1hLCBjdHgs
IGVuZ2luZSwgbisrLCAweGRlYWRiZWFmKTsKKwkJZXJyID0gZ3B1X3dyaXRlKGNlLCB2bWEsIG4r
KywgMHhkZWFkYmVhZik7CiAJCWlmIChlcnIpCi0JCQlnb3RvIG91dF91bnBpbjsKKwkJCWJyZWFr
OwogCX0KLQorCWk5MTVfZ2VtX2NvbnRleHRfdW5sb2NrX2VuZ2luZXMoY3R4KTsKIAlpOTE1X3Zt
YV91bnBpbih2bWEpOworCWlmIChlcnIpCisJCWdvdG8gb3V0X2Nsb3NlOwogCiAJLyoKIAkgKiBO
b3cgdGhhdCB0aGUgcGFnZXMgYXJlICp1bnBpbm5lZCogc2hyaW5rLWFsbCBzaG91bGQgaW52b2tl
CkBAIC0xNTgzLDEwICsxNTkwLDkgQEAgc3RhdGljIGludCBpZ3Rfc2hyaW5rX3RocCh2b2lkICph
cmcpCiAJd2hpbGUgKG4tLSkgewogCQllcnIgPSBjcHVfY2hlY2sob2JqLCBuLCAweGRlYWRiZWFm
KTsKIAkJaWYgKGVycikKLQkJCWdvdG8gb3V0X3VucGluOworCQkJYnJlYWs7CiAJfQogCi0KIG91
dF91bnBpbjoKIAlpOTE1X3ZtYV91bnBpbih2bWEpOwogb3V0X2Nsb3NlOgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYwppbmRl
eCAzZTZmNGE2NWQzNTYuLjNhZGI2MGMyZmQxZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKQEAgLTE2NiwxOSArMTY2
LDE3IEBAIHN0YXRpYyB1bnNpZ25lZCBsb25nIGZha2VfcGFnZV9jb3VudChzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqKQogCXJldHVybiBodWdlX2dlbV9vYmplY3RfZG1hX3NpemUob2Jq
KSA+PiBQQUdFX1NISUZUOwogfQogCi1zdGF0aWMgaW50IGdwdV9maWxsKHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmosCi0JCSAgICBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAot
CQkgICAgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAorc3RhdGljIGludCBncHVfZmls
bChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCisJCSAgICBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqLAogCQkgICAgdW5zaWduZWQgaW50IGR3KQogewotCXN0cnVjdCBpOTE1X2FkZHJl
c3Nfc3BhY2UgKnZtID0gY3R4LT52bSA/OiAmZW5naW5lLT5ndC0+Z2d0dC0+dm07CiAJc3RydWN0
IGk5MTVfdm1hICp2bWE7CiAJaW50IGVycjsKIAotCUdFTV9CVUdfT04ob2JqLT5iYXNlLnNpemUg
PiB2bS0+dG90YWwpOwotCUdFTV9CVUdfT04oIWludGVsX2VuZ2luZV9jYW5fc3RvcmVfZHdvcmQo
ZW5naW5lKSk7CisJR0VNX0JVR19PTihvYmotPmJhc2Uuc2l6ZSA+IGNlLT52bS0+dG90YWwpOwor
CUdFTV9CVUdfT04oIWludGVsX2VuZ2luZV9jYW5fc3RvcmVfZHdvcmQoY2UtPmVuZ2luZSkpOwog
Ci0Jdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCB2bSwgTlVMTCk7CisJdm1hID0gaTkxNV92
bWFfaW5zdGFuY2Uob2JqLCBjZS0+dm0sIE5VTEwpOwogCWlmIChJU19FUlIodm1hKSkKIAkJcmV0
dXJuIFBUUl9FUlIodm1hKTsKIApAQCAtMjAwLDkgKzE5OCw3IEBAIHN0YXRpYyBpbnQgZ3B1X2Zp
bGwoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkgKiB3aGlsc3QgY2hlY2tpbmcg
dGhhdCBlYWNoIGNvbnRleHQgcHJvdmlkZXMgYSB1bmlxdWUgdmlldwogCSAqIGludG8gdGhlIG9i
amVjdC4KIAkgKi8KLQllcnIgPSBpZ3RfZ3B1X2ZpbGxfZHcodm1hLAotCQkJICAgICAgY3R4LAot
CQkJICAgICAgZW5naW5lLAorCWVyciA9IGlndF9ncHVfZmlsbF9kdyhjZSwgdm1hLAogCQkJICAg
ICAgKGR3ICogcmVhbF9wYWdlX2NvdW50KG9iaikpIDw8IFBBR0VfU0hJRlQgfAogCQkJICAgICAg
KGR3ICogc2l6ZW9mKHUzMikpLAogCQkJICAgICAgcmVhbF9wYWdlX2NvdW50KG9iaiksCkBAIC0z
MDUsMjIgKzMwMSwyMSBAQCBzdGF0aWMgaW50IGZpbGVfYWRkX29iamVjdChzdHJ1Y3QgZHJtX2Zp
bGUgKmZpbGUsCiB9CiAKIHN0YXRpYyBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqCi1jcmVh
dGVfdGVzdF9vYmplY3Qoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKK2NyZWF0ZV90ZXN0
X29iamVjdChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAkJICAgc3RydWN0IGRybV9m
aWxlICpmaWxlLAogCQkgICBzdHJ1Y3QgbGlzdF9oZWFkICpvYmplY3RzKQogewogCXN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7Ci0Jc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0g
PSBjdHgtPnZtID86ICZjdHgtPmk5MTUtPmdndHQudm07CiAJdTY0IHNpemU7CiAJaW50IGVycjsK
IAogCS8qIEtlZXAgaW4gR0VNJ3MgZ29vZCBncmFjZXMgKi8KLQlpOTE1X3JldGlyZV9yZXF1ZXN0
cyhjdHgtPmk5MTUpOworCWk5MTVfcmV0aXJlX3JlcXVlc3RzKHZtLT5pOTE1KTsKIAogCXNpemUg
PSBtaW4odm0tPnRvdGFsIC8gMiwgMTAyNHVsbCAqIERXX1BFUl9QQUdFICogUEFHRV9TSVpFKTsK
IAlzaXplID0gcm91bmRfZG93bihzaXplLCBEV19QRVJfUEFHRSAqIFBBR0VfU0laRSk7CiAKLQlv
YmogPSBodWdlX2dlbV9vYmplY3QoY3R4LT5pOTE1LCBEV19QRVJfUEFHRSAqIFBBR0VfU0laRSwg
c2l6ZSk7CisJb2JqID0gaHVnZV9nZW1fb2JqZWN0KHZtLT5pOTE1LCBEV19QRVJfUEFHRSAqIFBB
R0VfU0laRSwgc2l6ZSk7CiAJaWYgKElTX0VSUihvYmopKQogCQlyZXR1cm4gb2JqOwogCkBAIC0z
OTMsNiArMzg4LDcgQEAgc3RhdGljIGludCBpZ3RfY3R4X2V4ZWModm9pZCAqYXJnKQogCQlkdyA9
IDA7CiAJCXdoaWxlICghdGltZV9hZnRlcihqaWZmaWVzLCBlbmRfdGltZSkpIHsKIAkJCXN0cnVj
dCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CisJCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAK
IAkJCWN0eCA9IGxpdmVfY29udGV4dChpOTE1LCBmaWxlKTsKIAkJCWlmIChJU19FUlIoY3R4KSkg
ewpAQCAtNDAwLDE1ICszOTYsMjAgQEAgc3RhdGljIGludCBpZ3RfY3R4X2V4ZWModm9pZCAqYXJn
KQogCQkJCWdvdG8gb3V0X3VubG9jazsKIAkJCX0KIAorCQkJY2UgPSBpOTE1X2dlbV9jb250ZXh0
X2dldF9lbmdpbmUoY3R4LCBlbmdpbmUtPmxlZ2FjeV9pZHgpOworCiAJCQlpZiAoIW9iaikgewot
CQkJCW9iaiA9IGNyZWF0ZV90ZXN0X29iamVjdChjdHgsIGZpbGUsICZvYmplY3RzKTsKKwkJCQlv
YmogPSBjcmVhdGVfdGVzdF9vYmplY3QoY2UtPnZtLCBmaWxlLCAmb2JqZWN0cyk7CiAJCQkJaWYg
KElTX0VSUihvYmopKSB7CiAJCQkJCWVyciA9IFBUUl9FUlIob2JqKTsKKwkJCQkJaW50ZWxfY29u
dGV4dF9wdXQoY2UpOwogCQkJCQlnb3RvIG91dF91bmxvY2s7CiAJCQkJfQogCQkJfQogCi0JCQll
cnIgPSBncHVfZmlsbChvYmosIGN0eCwgZW5naW5lLCBkdyk7CisJCQllcnIgPSBncHVfZmlsbChj
ZSwgb2JqLCBkdyk7CisJCQlpbnRlbF9jb250ZXh0X3B1dChjZSk7CisKIAkJCWlmIChlcnIpIHsK
IAkJCQlwcl9lcnIoIkZhaWxlZCB0byBmaWxsIGR3b3JkICVsdSBbJWx1LyVsdV0gd2l0aCBncHUg
KCVzKSBpbiBjdHggJXUgW2Z1bGwtcHBndHQ/ICVzXSwgZXJyPSVkXG4iLAogCQkJCSAgICAgICBu
ZHdvcmRzLCBkdywgbWF4X2R3b3JkcyhvYmopLApAQCAtNTA5LDYgKzUxMCw3IEBAIHN0YXRpYyBp
bnQgaWd0X3NoYXJlZF9jdHhfZXhlYyh2b2lkICphcmcpCiAJCW5jb250ZXh0cyA9IDA7CiAJCXdo
aWxlICghdGltZV9hZnRlcihqaWZmaWVzLCBlbmRfdGltZSkpIHsKIAkJCXN0cnVjdCBpOTE1X2dl
bV9jb250ZXh0ICpjdHg7CisJCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAKIAkJCWN0eCA9
IGtlcm5lbF9jb250ZXh0KGk5MTUpOwogCQkJaWYgKElTX0VSUihjdHgpKSB7CkBAIC01MTgsMjIg
KzUyMCwyNiBAQCBzdGF0aWMgaW50IGlndF9zaGFyZWRfY3R4X2V4ZWModm9pZCAqYXJnKQogCiAJ
CQlfX2Fzc2lnbl9wcGd0dChjdHgsIHBhcmVudC0+dm0pOwogCisJCQljZSA9IGk5MTVfZ2VtX2Nv
bnRleHRfZ2V0X2VuZ2luZShjdHgsIGVuZ2luZS0+bGVnYWN5X2lkeCk7CiAJCQlpZiAoIW9iaikg
ewotCQkJCW9iaiA9IGNyZWF0ZV90ZXN0X29iamVjdChwYXJlbnQsIGZpbGUsICZvYmplY3RzKTsK
KwkJCQlvYmogPSBjcmVhdGVfdGVzdF9vYmplY3QocGFyZW50LT52bSwgZmlsZSwgJm9iamVjdHMp
OwogCQkJCWlmIChJU19FUlIob2JqKSkgewogCQkJCQllcnIgPSBQVFJfRVJSKG9iaik7CisJCQkJ
CWludGVsX2NvbnRleHRfcHV0KGNlKTsKIAkJCQkJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsK
IAkJCQkJZ290byBvdXRfdGVzdDsKIAkJCQl9CiAJCQl9CiAKLQkJCWVyciA9IGdwdV9maWxsKG9i
aiwgY3R4LCBlbmdpbmUsIGR3KTsKKwkJCWVyciA9IGdwdV9maWxsKGNlLCBvYmosIGR3KTsKKwkJ
CWludGVsX2NvbnRleHRfcHV0KGNlKTsKKwkJCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7CisK
IAkJCWlmIChlcnIpIHsKIAkJCQlwcl9lcnIoIkZhaWxlZCB0byBmaWxsIGR3b3JkICVsdSBbJWx1
LyVsdV0gd2l0aCBncHUgKCVzKSBpbiBjdHggJXUgW2Z1bGwtcHBndHQ/ICVzXSwgZXJyPSVkXG4i
LAogCQkJCSAgICAgICBuZHdvcmRzLCBkdywgbWF4X2R3b3JkcyhvYmopLAogCQkJCSAgICAgICBl
bmdpbmUtPm5hbWUsIGN0eC0+aHdfaWQsCiAJCQkJICAgICAgIHllc25vKCEhY3R4LT52bSksIGVy
cik7Ci0JCQkJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKIAkJCQlnb3RvIG91dF90ZXN0Owog
CQkJfQogCkBAIC01NDQsOCArNTUwLDYgQEAgc3RhdGljIGludCBpZ3Rfc2hhcmVkX2N0eF9leGVj
KHZvaWQgKmFyZykKIAogCQkJbmR3b3JkcysrOwogCQkJbmNvbnRleHRzKys7Ci0KLQkJCWtlcm5l
bF9jb250ZXh0X2Nsb3NlKGN0eCk7CiAJCX0KIAkJcHJfaW5mbygiU3VibWl0dGVkICVsdSBjb250
ZXh0cyB0byAlcywgZmlsbGluZyAlbHUgZHdvcmRzXG4iLAogCQkJbmNvbnRleHRzLCBlbmdpbmUt
Pm5hbWUsIG5kd29yZHMpOwpAQCAtNjA0LDYgKzYwOCw4IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV92
bWEgKnJwY3NfcXVlcnlfYmF0Y2goc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJX19pOTE1X2dlbV9v
YmplY3RfZmx1c2hfbWFwKG9iaiwgMCwgNjQpOwogCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAo
b2JqKTsKIAorCWludGVsX2d0X2NoaXBzZXRfZmx1c2godm1hLT52bS0+Z3QpOworCiAJdm1hID0g
aTkxNV92bWFfaW5zdGFuY2Uob2JqLCB2bWEtPnZtLCBOVUxMKTsKIAlpZiAoSVNfRVJSKHZtYSkp
IHsKIAkJZXJyID0gUFRSX0VSUih2bWEpOwpAQCAtMTA4MiwxNyArMTA4OCwxOSBAQCBzdGF0aWMg
aW50IGlndF9jdHhfcmVhZG9ubHkodm9pZCAqYXJnKQogCW5kd29yZHMgPSAwOwogCWR3ID0gMDsK
IAl3aGlsZSAoIXRpbWVfYWZ0ZXIoamlmZmllcywgZW5kX3RpbWUpKSB7Ci0JCXN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKmVuZ2luZTsKLQkJdW5zaWduZWQgaW50IGlkOworCQlzdHJ1Y3QgaTkxNV9n
ZW1fZW5naW5lc19pdGVyIGl0OworCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAKLQkJZm9y
X2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKLQkJCWlmICghaW50ZWxfZW5naW5lX2Nh
bl9zdG9yZV9kd29yZChlbmdpbmUpKQorCQlmb3JfZWFjaF9nZW1fZW5naW5lKGNlLAorCQkJCSAg
ICBpOTE1X2dlbV9jb250ZXh0X2xvY2tfZW5naW5lcyhjdHgpLCBpdCkgeworCQkJaWYgKCFpbnRl
bF9lbmdpbmVfY2FuX3N0b3JlX2R3b3JkKGNlLT5lbmdpbmUpKQogCQkJCWNvbnRpbnVlOwogCiAJ
CQlpZiAoIW9iaikgewotCQkJCW9iaiA9IGNyZWF0ZV90ZXN0X29iamVjdChjdHgsIGZpbGUsICZv
YmplY3RzKTsKKwkJCQlvYmogPSBjcmVhdGVfdGVzdF9vYmplY3QoY2UtPnZtLCBmaWxlLCAmb2Jq
ZWN0cyk7CiAJCQkJaWYgKElTX0VSUihvYmopKSB7CiAJCQkJCWVyciA9IFBUUl9FUlIob2JqKTsK
KwkJCQkJaTkxNV9nZW1fY29udGV4dF91bmxvY2tfZW5naW5lcyhjdHgpOwogCQkJCQlnb3RvIG91
dF91bmxvY2s7CiAJCQkJfQogCkBAIC0xMTAwLDEyICsxMTA4LDEzIEBAIHN0YXRpYyBpbnQgaWd0
X2N0eF9yZWFkb25seSh2b2lkICphcmcpCiAJCQkJCWk5MTVfZ2VtX29iamVjdF9zZXRfcmVhZG9u
bHkob2JqKTsKIAkJCX0KIAotCQkJZXJyID0gZ3B1X2ZpbGwob2JqLCBjdHgsIGVuZ2luZSwgZHcp
OworCQkJZXJyID0gZ3B1X2ZpbGwoY2UsIG9iaiwgZHcpOwogCQkJaWYgKGVycikgewogCQkJCXBy
X2VycigiRmFpbGVkIHRvIGZpbGwgZHdvcmQgJWx1IFslbHUvJWx1XSB3aXRoIGdwdSAoJXMpIGlu
IGN0eCAldSBbZnVsbC1wcGd0dD8gJXNdLCBlcnI9JWRcbiIsCiAJCQkJICAgICAgIG5kd29yZHMs
IGR3LCBtYXhfZHdvcmRzKG9iaiksCi0JCQkJICAgICAgIGVuZ2luZS0+bmFtZSwgY3R4LT5od19p
ZCwKKwkJCQkgICAgICAgY2UtPmVuZ2luZS0+bmFtZSwgY3R4LT5od19pZCwKIAkJCQkgICAgICAg
eWVzbm8oISFjdHgtPnZtKSwgZXJyKTsKKwkJCQlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19lbmdp
bmVzKGN0eCk7CiAJCQkJZ290byBvdXRfdW5sb2NrOwogCQkJfQogCkBAIC0xMTE1LDYgKzExMjQs
NyBAQCBzdGF0aWMgaW50IGlndF9jdHhfcmVhZG9ubHkodm9pZCAqYXJnKQogCQkJfQogCQkJbmR3
b3JkcysrOwogCQl9CisJCWk5MTVfZ2VtX2NvbnRleHRfdW5sb2NrX2VuZ2luZXMoY3R4KTsKIAl9
CiAJcHJfaW5mbygiU3VibWl0dGVkICVsdSBkd29yZHMgKGFjcm9zcyAldSBlbmdpbmVzKVxuIiwK
IAkJbmR3b3JkcywgUlVOVElNRV9JTkZPKGk5MTUpLT5udW1fZW5naW5lcyk7CkBAIC0xMTk3LDYg
KzEyMDcsOCBAQCBzdGF0aWMgaW50IHdyaXRlX3RvX3NjcmF0Y2goc3RydWN0IGk5MTVfZ2VtX2Nv
bnRleHQgKmN0eCwKIAlfX2k5MTVfZ2VtX29iamVjdF9mbHVzaF9tYXAob2JqLCAwLCA2NCk7CiAJ
aTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChvYmopOwogCisJaW50ZWxfZ3RfY2hpcHNldF9mbHVz
aChlbmdpbmUtPmd0KTsKKwogCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgY3R4LT52bSwg
TlVMTCk7CiAJaWYgKElTX0VSUih2bWEpKSB7CiAJCWVyciA9IFBUUl9FUlIodm1hKTsKQEAgLTEy
OTYsNiArMTMwOCw4IEBAIHN0YXRpYyBpbnQgcmVhZF9mcm9tX3NjcmF0Y2goc3RydWN0IGk5MTVf
Z2VtX2NvbnRleHQgKmN0eCwKIAlpOTE1X2dlbV9vYmplY3RfZmx1c2hfbWFwKG9iaik7CiAJaTkx
NV9nZW1fb2JqZWN0X3VucGluX21hcChvYmopOwogCisJaW50ZWxfZ3RfY2hpcHNldF9mbHVzaChl
bmdpbmUtPmd0KTsKKwogCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgY3R4LT52bSwgTlVM
TCk7CiAJaWYgKElTX0VSUih2bWEpKSB7CiAJCWVyciA9IFBUUl9FUlIodm1hKTsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGlscy5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pZ3RfZ2VtX3V0aWxzLmMKaW5kZXgg
NTdlY2U1M2MxMDc1Li5lZTVkYzEzYTMwYjMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGlscy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9zZWxmdGVzdHMvaWd0X2dlbV91dGlscy5jCkBAIC05LDYgKzksNyBAQAogI2luY2x1
ZGUgImdlbS9pOTE1X2dlbV9jb250ZXh0LmgiCiAjaW5jbHVkZSAiZ2VtL2k5MTVfZ2VtX3BtLmgi
CiAjaW5jbHVkZSAiZ3QvaW50ZWxfY29udGV4dC5oIgorI2luY2x1ZGUgImd0L2ludGVsX2d0Lmgi
CiAjaW5jbHVkZSAiaTkxNV92bWEuaCIKICNpbmNsdWRlICJpOTE1X2Rydi5oIgogCkBAIC04NCw2
ICs4NSw4IEBAIGlndF9lbWl0X3N0b3JlX2R3KHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCSpjbWQg
PSBNSV9CQVRDSF9CVUZGRVJfRU5EOwogCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAob2JqKTsK
IAorCWludGVsX2d0X2NoaXBzZXRfZmx1c2godm1hLT52bS0+Z3QpOworCiAJdm1hID0gaTkxNV92
bWFfaW5zdGFuY2Uob2JqLCB2bWEtPnZtLCBOVUxMKTsKIAlpZiAoSVNfRVJSKHZtYSkpIHsKIAkJ
ZXJyID0gUFRSX0VSUih2bWEpOwpAQCAtMTAxLDQwICsxMDQsMzUgQEAgaWd0X2VtaXRfc3RvcmVf
ZHcoc3RydWN0IGk5MTVfdm1hICp2bWEsCiAJcmV0dXJuIEVSUl9QVFIoZXJyKTsKIH0KIAotaW50
IGlndF9ncHVfZmlsbF9kdyhzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKLQkJICAgIHN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICpjdHgsCi0JCSAgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUs
Ci0JCSAgICB1NjQgb2Zmc2V0LAotCQkgICAgdW5zaWduZWQgbG9uZyBjb3VudCwKLQkJICAgIHUz
MiB2YWwpCitpbnQgaWd0X2dwdV9maWxsX2R3KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKKwkJ
ICAgIHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1NjQgb2Zmc2V0LAorCQkgICAgdW5zaWduZWQgbG9u
ZyBjb3VudCwgdTMyIHZhbCkKIHsKLQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IGN0
eC0+dm0gPzogJmVuZ2luZS0+Z3QtPmdndHQtPnZtOwogCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
OwogCXN0cnVjdCBpOTE1X3ZtYSAqYmF0Y2g7CiAJdW5zaWduZWQgaW50IGZsYWdzOwogCWludCBl
cnI7CiAKLQlHRU1fQlVHX09OKHZtYS0+c2l6ZSA+IHZtLT50b3RhbCk7Ci0JR0VNX0JVR19PTigh
aW50ZWxfZW5naW5lX2Nhbl9zdG9yZV9kd29yZChlbmdpbmUpKTsKKwlHRU1fQlVHX09OKCFpbnRl
bF9lbmdpbmVfY2FuX3N0b3JlX2R3b3JkKGNlLT5lbmdpbmUpKTsKIAlHRU1fQlVHX09OKCFpOTE1
X3ZtYV9pc19waW5uZWQodm1hKSk7CiAKIAliYXRjaCA9IGlndF9lbWl0X3N0b3JlX2R3KHZtYSwg
b2Zmc2V0LCBjb3VudCwgdmFsKTsKIAlpZiAoSVNfRVJSKGJhdGNoKSkKIAkJcmV0dXJuIFBUUl9F
UlIoYmF0Y2gpOwogCi0JcnEgPSBpZ3RfcmVxdWVzdF9hbGxvYyhjdHgsIGVuZ2luZSk7CisJcnEg
PSBpbnRlbF9jb250ZXh0X2NyZWF0ZV9yZXF1ZXN0KGNlKTsKIAlpZiAoSVNfRVJSKHJxKSkgewog
CQllcnIgPSBQVFJfRVJSKHJxKTsKIAkJZ290byBlcnJfYmF0Y2g7CiAJfQogCiAJZmxhZ3MgPSAw
OwotCWlmIChJTlRFTF9HRU4odm0tPmk5MTUpIDw9IDUpCisJaWYgKElOVEVMX0dFTihjZS0+dm0t
Pmk5MTUpIDw9IDUpCiAJCWZsYWdzIHw9IEk5MTVfRElTUEFUQ0hfU0VDVVJFOwogCi0JZXJyID0g
ZW5naW5lLT5lbWl0X2JiX3N0YXJ0KHJxLAotCQkJCSAgICBiYXRjaC0+bm9kZS5zdGFydCwgYmF0
Y2gtPm5vZGUuc2l6ZSwKLQkJCQkgICAgZmxhZ3MpOworCWVyciA9IHJxLT5lbmdpbmUtPmVtaXRf
YmJfc3RhcnQocnEsCisJCQkJCWJhdGNoLT5ub2RlLnN0YXJ0LCBiYXRjaC0+bm9kZS5zaXplLAor
CQkJCQlmbGFncyk7CiAJaWYgKGVycikKIAkJZ290byBlcnJfcmVxdWVzdDsKIApkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pZ3RfZ2VtX3V0aWxzLmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2lndF9nZW1fdXRpbHMuaAppbmRleCAz
NjFhN2VmODY2YjAuLjQyMjFjZjg0ZDE3NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL3NlbGZ0ZXN0cy9pZ3RfZ2VtX3V0aWxzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL3NlbGZ0ZXN0cy9pZ3RfZ2VtX3V0aWxzLmgKQEAgLTExLDkgKzExLDExIEBACiAKIHN0
cnVjdCBpOTE1X3JlcXVlc3Q7CiBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dDsKLXN0cnVjdCBpbnRl
bF9lbmdpbmVfY3M7CiBzdHJ1Y3QgaTkxNV92bWE7CiAKK3N0cnVjdCBpbnRlbF9jb250ZXh0Owor
c3RydWN0IGludGVsX2VuZ2luZV9jczsKKwogc3RydWN0IGk5MTVfcmVxdWVzdCAqCiBpZ3RfcmVx
dWVzdF9hbGxvYyhzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LCBzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmUpOwogCkBAIC0yMywxMSArMjUsOCBAQCBpZ3RfZW1pdF9zdG9yZV9kdyhz
dHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAkJICB1bnNpZ25lZCBsb25nIGNvdW50LAogCQkgIHUzMiB2
YWwpOwogCi1pbnQgaWd0X2dwdV9maWxsX2R3KHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAotCQkgICAg
c3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKLQkJICAgIHN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmVuZ2luZSwKLQkJICAgIHU2NCBvZmZzZXQsCi0JCSAgICB1bnNpZ25lZCBsb25nIGNvdW50
LAotCQkgICAgdTMyIHZhbCk7CitpbnQgaWd0X2dwdV9maWxsX2R3KHN0cnVjdCBpbnRlbF9jb250
ZXh0ICpjZSwKKwkJICAgIHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1NjQgb2Zmc2V0LAorCQkgICAg
dW5zaWduZWQgbG9uZyBjb3VudCwgdTMyIHZhbCk7CiAKICNlbmRpZiAvKiBfX0lHVF9HRU1fVVRJ
TFNfSF9fICovCi0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVk
ZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZv
L2ludGVsLWdmeA==

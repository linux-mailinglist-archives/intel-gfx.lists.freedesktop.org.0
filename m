Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0EE582CFC7
	for <lists+intel-gfx@lfdr.de>; Tue, 28 May 2019 21:50:52 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 296636E064;
	Tue, 28 May 2019 19:50:50 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D201589F3C
 for <intel-gfx@lists.freedesktop.org>; Tue, 28 May 2019 19:50:45 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16711422-1500050 
 for multiple; Tue, 28 May 2019 20:50:30 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 28 May 2019 20:50:22 +0100
Message-Id: <20190528195022.11531-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190528195022.11531-1-chris@chris-wilson.co.uk>
References: <20190528195022.11531-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 2/2] drm/i915: Report all objects with allocated
 pages to the shrinker
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Matthew Auld <matthew.auld@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q3VycmVudGx5LCB3ZSB0cnkgdG8gcmVwb3J0IHRvIHRoZSBzaHJpbmtlciB0aGUgcHJlY2lzZSBu
dW1iZXIgb2YKb2JqZWN0cyAocGFnZXMpIHRoYXQgYXJlIGF2YWlsYWJsZSB0byBiZSByZWFwZWQg
YXQgdGhpcyBtb21lbnQuIFRoaXMKcmVxdWlyZXMgc2VhcmNoaW5nIGFsbCBvYmplY3RzIHdpdGgg
YWxsb2NhdGVkIHBhZ2VzIHRvIHNlZSBpZiB0aGV5CmZ1bGZpbGwgdGhlIHNlYXJjaCBjcml0ZXJp
YSwgYW5kIHRoaXMgY291bnQgaXMgcGVyZm9ybWVkIHF1aXRlCmZyZXF1ZW50bHkuIChUaGUgc2hy
aW5rZXIgdHJpZXMgdG8gZnJlZSB+MTI4IHBhZ2VzIG9uIGVhY2ggaW52b2NhdGlvbiwKYmVmb3Jl
IHdoaWNoIHdlIGNvdW50IGFsbCB0aGUgb2JqZWN0czsgY291bnRpbmcgdGFrZXMgbG9uZ2VyIHRo
YW4KdW5iaW5kaW5nIHRoZSBvYmplY3RzISkgSWYgd2UgdGFrZSB0aGUgcHJhZ21hdGljIHZpZXcg
dGhhdCB3aXRoCnN1ZmZpY2llbnQgZGVzaXJlLCBhbGwgb2JqZWN0cyBhcmUgZXZlbnR1YWxseSBy
ZWFwYWJsZSAodGhleSBiZWNvbWUKaW5hY3RpdmUsIG9yIG5vIGxvbmdlciB1c2VkIGFzIGZyYW1l
YnVmZmVyIGV0YyksIHdlIGNhbiBzaW1wbHkgcmV0dXJuCnRoZSBjb3VudCBvZiBwaW5uZWQgcGFn
ZXMgbWFpbnRhaW5lZCBkdXJpbmcgZ2V0X3BhZ2VzL3B1dF9wYWdlcyByYXRoZXIKdGhhbiB3YWxr
IHRoZSBsaXN0cyBldmVyeSB0aW1lLgoKVGhlIGRvd25zaWRlIGlzIHRoYXQgd2UgbWF5IChzbGln
aHRseSkgb3Zlci1yZXBvcnQgdGhlIG51bWJlciBvZgpvYmplY3RzL3BhZ2VzIHdlIGNvdWxkIHNo
cmluayBhbmQgc28gcGVuYWxpemUgb3Vyc2VsdmVzIGJ5IHNocmlua2luZwptb3JlIHRoYW4gcmVx
dWlyZWQuIFRoaXMgaXMgbWl0aWdhdGVkIGJ5IGtlZXBpbmcgdGhlIG9yZGVyIGluIHdoaWNoIHdl
CnNocmluayBvYmplY3RzIHN1Y2ggdGhhdCB3ZSBhdm9pZCBwZW5hbGl6aW5nIGFjdGl2ZSBhbmQg
ZnJlcXVlbnRseSB1c2VkCm9iamVjdHMsIGFuZCBpZiBtZW1vcnkgaXMgc28gdGlnaHQgdGhhdCB3
ZSBuZWVkIHRvIGZyZWUgdGhlbSB3ZSB3b3VsZApuZWVkIHRvIGFueXdheS4KCnYyOiBPbmx5IGV4
cG9zZSBzaHJpbmthYmxlIG9iamVjdHMgdG8gdGhlIHNocmlua2VyOyBhIHNtYWxsIHJlZHVjdGlv
biBpbgpub3QgY29uc2lkZXJpbmcgc3RvbGVuIGFuZCBmb3JlaWduIG9iamVjdHMuCgpTaWduZWQt
b2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IEpvb25h
cyBMYWh0aW5lbiA8am9vbmFzLmxhaHRpbmVuQGxpbnV4LmludGVsLmNvbT4KQ2M6IE1hdHRoZXcg
QXVsZCA8bWF0dGhldy5hdWxkQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fZG9tYWluLmMgICB8ICAzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fb2JqZWN0LmMgICB8IDIyIC0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fc2hyaW5rZXIuYyB8IDI4ICsrLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9zdG9sZW4uYyAgIHwgIDMgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZGVidWdmcy5jICAgICAgICAgIHwgNTggKystLS0tLS0tLS0tLS0tLS0tLS0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggICAgICAgICAgICAgIHwgIDcgKy0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jICAgICAgICAgICAgICB8IDIzICsrKystLS0tCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jICAgICAgICAgICAgICB8IDE2ICsrKystLQogOCBm
aWxlcyBjaGFuZ2VkLCA0MSBpbnNlcnRpb25zKCspLCAxMTkgZGVsZXRpb25zKC0pCgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jCmluZGV4IDUyYjczZTkwYzlmNC4u
ZTVkZWFlNjI2ODFmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fZG9tYWluLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFp
bi5jCkBAIC00NzUsNyArNDc1LDggQEAgc3RhdGljIHZvaWQgaTkxNV9nZW1fb2JqZWN0X2J1bXBf
aW5hY3RpdmVfZ2d0dChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCX0KIAltdXRl
eF91bmxvY2soJmk5MTUtPmdndHQudm0ubXV0ZXgpOwogCi0JaWYgKG9iai0+bW0ubWFkdiA9PSBJ
OTE1X01BRFZfV0lMTE5FRUQpIHsKKwlpZiAoaTkxNV9nZW1fb2JqZWN0X2lzX3Nocmlua2FibGUo
b2JqKSAmJgorCSAgICBvYmotPm1tLm1hZHYgPT0gSTkxNV9NQURWX1dJTExORUVEKSB7CiAJCXN0
cnVjdCBsaXN0X2hlYWQgKmxpc3Q7CiAKIAkJc3Bpbl9sb2NrKCZpOTE1LT5tbS5vYmpfbG9jayk7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMKaW5kZXggZjA2NDg3
NmYxMjE0Li4xZmNjYjFkZTU4NTEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9vYmplY3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fb2JqZWN0LmMKQEAgLTQ0LDI1ICs0NCw2IEBAIHZvaWQgaTkxNV9nZW1fb2JqZWN0X2ZyZWUo
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAlyZXR1cm4ga21lbV9jYWNoZV9mcmVl
KGdsb2JhbC5zbGFiX29iamVjdHMsIG9iaik7CiB9CiAKLS8qIHNvbWUgYm9va2tlZXBpbmcgKi8K
LXN0YXRpYyB2b2lkIGk5MTVfZ2VtX2luZm9fYWRkX29iaihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKLQkJCQkgIHU2NCBzaXplKQotewotCXNwaW5fbG9jaygmaTkxNS0+bW0ub2JqZWN0
X3N0YXRfbG9jayk7Ci0JaTkxNS0+bW0ub2JqZWN0X2NvdW50Kys7Ci0JaTkxNS0+bW0ub2JqZWN0
X21lbW9yeSArPSBzaXplOwotCXNwaW5fdW5sb2NrKCZpOTE1LT5tbS5vYmplY3Rfc3RhdF9sb2Nr
KTsKLX0KLQotc3RhdGljIHZvaWQgaTkxNV9nZW1faW5mb19yZW1vdmVfb2JqKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAotCQkJCSAgICAgdTY0IHNpemUpCi17Ci0Jc3Bpbl9sb2NrKCZp
OTE1LT5tbS5vYmplY3Rfc3RhdF9sb2NrKTsKLQlpOTE1LT5tbS5vYmplY3RfY291bnQtLTsKLQlp
OTE1LT5tbS5vYmplY3RfbWVtb3J5IC09IHNpemU7Ci0Jc3Bpbl91bmxvY2soJmk5MTUtPm1tLm9i
amVjdF9zdGF0X2xvY2spOwotfQotCiBzdGF0aWMgdm9pZAogZnJvbnRidWZmZXJfcmV0aXJlKHN0
cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCiAJCSAgIHN0cnVjdCBpOTE1X3JlcXVl
c3QgKnJlcXVlc3QpCkBAIC05OCw4ICs3OSw2IEBAIHZvaWQgaTkxNV9nZW1fb2JqZWN0X2luaXQo
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlvYmotPm1tLm1hZHYgPSBJOTE1X01B
RFZfV0lMTE5FRUQ7CiAJSU5JVF9SQURJWF9UUkVFKCZvYmotPm1tLmdldF9wYWdlLnJhZGl4LCBH
RlBfS0VSTkVMIHwgX19HRlBfTk9XQVJOKTsKIAltdXRleF9pbml0KCZvYmotPm1tLmdldF9wYWdl
LmxvY2spOwotCi0JaTkxNV9nZW1faW5mb19hZGRfb2JqKHRvX2k5MTUob2JqLT5iYXNlLmRldiks
IG9iai0+YmFzZS5zaXplKTsKIH0KIAogLyoqCkBAIC0yNDAsNyArMjE5LDYgQEAgc3RhdGljIHZv
aWQgX19pOTE1X2dlbV9mcmVlX29iamVjdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CiAKIAkJcmVzZXJ2YXRpb25fb2JqZWN0X2ZpbmkoJm9iai0+X19idWlsdGluX3Jlc3YpOwogCQlk
cm1fZ2VtX29iamVjdF9yZWxlYXNlKCZvYmotPmJhc2UpOwotCQlpOTE1X2dlbV9pbmZvX3JlbW92
ZV9vYmooaTkxNSwgb2JqLT5iYXNlLnNpemUpOwogCiAJCWJpdG1hcF9mcmVlKG9iai0+Yml0XzE3
KTsKIAkJaTkxNV9nZW1fb2JqZWN0X2ZyZWUob2JqKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMKaW5kZXggNmE5M2UzMjZhYmYzLi5kNzFlNjMwYzZmYjgg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jCkBAIC0z
MDksMzAgKzMwOSwxNCBAQCBpOTE1X2dlbV9zaHJpbmtlcl9jb3VudChzdHJ1Y3Qgc2hyaW5rZXIg
KnNocmlua2VyLCBzdHJ1Y3Qgc2hyaW5rX2NvbnRyb2wgKnNjKQogewogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0KIAkJY29udGFpbmVyX29mKHNocmlua2VyLCBzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSwgbW0uc2hyaW5rZXIpOwotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
Ymo7Ci0JdW5zaWduZWQgbG9uZyBudW1fb2JqZWN0cyA9IDA7Ci0JdW5zaWduZWQgbG9uZyBjb3Vu
dCA9IDA7CisJdW5zaWduZWQgbG9uZyBudW1fb2JqZWN0czsKKwl1bnNpZ25lZCBsb25nIGNvdW50
OwogCi0Jc3Bpbl9sb2NrKCZpOTE1LT5tbS5vYmpfbG9jayk7Ci0JbGlzdF9mb3JfZWFjaF9lbnRy
eShvYmosICZpOTE1LT5tbS51bmJvdW5kX2xpc3QsIG1tLmxpbmspCi0JCWlmIChjYW5fcmVsZWFz
ZV9wYWdlcyhvYmopKSB7Ci0JCQljb3VudCArPSBvYmotPmJhc2Uuc2l6ZSA+PiBQQUdFX1NISUZU
OwotCQkJbnVtX29iamVjdHMrKzsKLQkJfQorCWNvdW50ID0gUkVBRF9PTkNFKGk5MTUtPm1tLnNo
cmlua19tZW1vcnkpID4+IFBBR0VfU0hJRlQ7CisJbnVtX29iamVjdHMgPSBSRUFEX09OQ0UoaTkx
NS0+bW0uc2hyaW5rX2NvdW50KTsKIAotCWxpc3RfZm9yX2VhY2hfZW50cnkob2JqLCAmaTkxNS0+
bW0uYm91bmRfbGlzdCwgbW0ubGluaykKLQkJaWYgKCFpOTE1X2dlbV9vYmplY3RfaXNfYWN0aXZl
KG9iaikgJiYgY2FuX3JlbGVhc2VfcGFnZXMob2JqKSkgewotCQkJY291bnQgKz0gb2JqLT5iYXNl
LnNpemUgPj4gUEFHRV9TSElGVDsKLQkJCW51bV9vYmplY3RzKys7Ci0JCX0KLQlsaXN0X2Zvcl9l
YWNoX2VudHJ5KG9iaiwgJmk5MTUtPm1tLnB1cmdlX2xpc3QsIG1tLmxpbmspCi0JCWlmICghaTkx
NV9nZW1fb2JqZWN0X2lzX2FjdGl2ZShvYmopICYmIGNhbl9yZWxlYXNlX3BhZ2VzKG9iaikpIHsK
LQkJCWNvdW50ICs9IG9iai0+YmFzZS5zaXplID4+IFBBR0VfU0hJRlQ7Ci0JCQludW1fb2JqZWN0
cysrOwotCQl9Ci0Jc3Bpbl91bmxvY2soJmk5MTUtPm1tLm9ial9sb2NrKTsKLQotCS8qIFVwZGF0
ZSBvdXIgcHJlZmVycmVkIHZtc2NhbiBiYXRjaCBzaXplIGZvciB0aGUgbmV4dCBwYXNzLgorCS8q
CisJICogVXBkYXRlIG91ciBwcmVmZXJyZWQgdm1zY2FuIGJhdGNoIHNpemUgZm9yIHRoZSBuZXh0
IHBhc3MuCiAJICogT3VyIHJvdWdoIGd1ZXNzIGZvciBhbiBlZmZlY3RpdmUgYmF0Y2ggc2l6ZSBp
cyByb3VnaGx5IDIKIAkgKiBhdmFpbGFibGUgR0VNIG9iamVjdHMgd29ydGggb2YgcGFnZXMuIFRo
YXQgaXMgd2UgZG9uJ3Qgd2FudAogCSAqIHRoZSBzaHJpbmtlciB0byBmaXJlLCB1bnRpbCBpdCBp
cyB3b3J0aCB0aGUgY29zdCBvZiBmcmVlaW5nIGFuCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fc3RvbGVuLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fc3RvbGVuLmMKaW5kZXggOTA4MGE3MzY2NjNhLi44YjNhMjNiZmY3ZjYgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zdG9sZW4uYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc3RvbGVuLmMKQEAgLTY5MCw3ICs2OTAs
OCBAQCBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3N0b2xlbl9mb3JfcHJlYWxsb2NhdGVkKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdgogCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0
ZXgpOwogCiAJc3Bpbl9sb2NrKCZkZXZfcHJpdi0+bW0ub2JqX2xvY2spOwotCWxpc3RfbW92ZV90
YWlsKCZvYmotPm1tLmxpbmssICZkZXZfcHJpdi0+bW0uYm91bmRfbGlzdCk7CisJaWYgKGk5MTVf
Z2VtX29iamVjdF9pc19zaHJpbmthYmxlKG9iaikpCisJCWxpc3RfbW92ZV90YWlsKCZvYmotPm1t
LmxpbmssICZkZXZfcHJpdi0+bW0uYm91bmRfbGlzdCk7CiAJb2JqLT5iaW5kX2NvdW50Kys7CiAJ
c3Bpbl91bmxvY2soJmRldl9wcml2LT5tbS5vYmpfbG9jayk7CiAKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kZWJ1Z2ZzLmMKaW5kZXggZTQxNWQ3ZWY5MGYyLi4yMTRkYmQ2OThkOGUgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZGVidWdmcy5jCkBAIC0yNzEsNyArMjcxLDcgQEAgc3RhdGljIGludCBpOTE1
X2dlbV9zdG9sZW5fbGlzdF9pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKIAl1
bnNpZ25lZCBsb25nIHRvdGFsLCBjb3VudCwgbjsKIAlpbnQgcmV0OwogCi0JdG90YWwgPSBSRUFE
X09OQ0UoZGV2X3ByaXYtPm1tLm9iamVjdF9jb3VudCk7CisJdG90YWwgPSBSRUFEX09OQ0UoZGV2
X3ByaXYtPm1tLnNocmlua19jb3VudCk7CiAJb2JqZWN0cyA9IGt2bWFsbG9jX2FycmF5KHRvdGFs
LCBzaXplb2YoKm9iamVjdHMpLCBHRlBfS0VSTkVMKTsKIAlpZiAoIW9iamVjdHMpCiAJCXJldHVy
biAtRU5PTUVNOwpAQCAtNDYwLDkgKzQ2MCw5IEBAIHN0YXRpYyBpbnQgaTkxNV9nZW1fb2JqZWN0
X2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCWNoYXIgYnVmWzgwXTsKIAlp
bnQgcmV0OwogCi0Jc2VxX3ByaW50ZihtLCAiJXUgb2JqZWN0cywgJWxsdSBieXRlc1xuIiwKLQkJ
ICAgZGV2X3ByaXYtPm1tLm9iamVjdF9jb3VudCwKLQkJICAgZGV2X3ByaXYtPm1tLm9iamVjdF9t
ZW1vcnkpOworCXNlcV9wcmludGYobSwgIiV1IHNocmlua2FibGUgb2JqZWN0cywgJWxsdSBieXRl
c1xuIiwKKwkJICAgZGV2X3ByaXYtPm1tLnNocmlua19jb3VudCwKKwkJICAgZGV2X3ByaXYtPm1t
LnNocmlua19tZW1vcnkpOwogCiAJc2l6ZSA9IGNvdW50ID0gMDsKIAltYXBwZWRfc2l6ZSA9IG1h
cHBlZF9jb3VudCA9IDA7CkBAIC01NTIsNTUgKzU1Miw2IEBAIHN0YXRpYyBpbnQgaTkxNV9nZW1f
b2JqZWN0X2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCXJldHVybiAwOwog
fQogCi1zdGF0aWMgaW50IGk5MTVfZ2VtX2d0dF9pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9p
ZCAqZGF0YSkKLXsKLQlzdHJ1Y3QgZHJtX2luZm9fbm9kZSAqbm9kZSA9IG0tPnByaXZhdGU7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19pOTE1KG5vZGUpOwot
CXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmZGV2X3ByaXYtPmRybTsKLQlzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqKm9iamVjdHM7Ci0Jc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9i
ajsKLQl1NjQgdG90YWxfb2JqX3NpemUsIHRvdGFsX2d0dF9zaXplOwotCXVuc2lnbmVkIGxvbmcg
bm9iamVjdCwgbjsKLQlpbnQgY291bnQsIHJldDsKLQotCW5vYmplY3QgPSBSRUFEX09OQ0UoZGV2
X3ByaXYtPm1tLm9iamVjdF9jb3VudCk7Ci0Jb2JqZWN0cyA9IGt2bWFsbG9jX2FycmF5KG5vYmpl
Y3QsIHNpemVvZigqb2JqZWN0cyksIEdGUF9LRVJORUwpOwotCWlmICghb2JqZWN0cykKLQkJcmV0
dXJuIC1FTk9NRU07Ci0KLQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmRldi0+c3Ry
dWN0X211dGV4KTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCi0JY291bnQgPSAwOwotCXNw
aW5fbG9jaygmZGV2X3ByaXYtPm1tLm9ial9sb2NrKTsKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KG9i
aiwgJmRldl9wcml2LT5tbS5ib3VuZF9saXN0LCBtbS5saW5rKSB7Ci0JCW9iamVjdHNbY291bnQr
K10gPSBvYmo7Ci0JCWlmIChjb3VudCA9PSBub2JqZWN0KQotCQkJYnJlYWs7Ci0JfQotCXNwaW5f
dW5sb2NrKCZkZXZfcHJpdi0+bW0ub2JqX2xvY2spOwotCi0JdG90YWxfb2JqX3NpemUgPSB0b3Rh
bF9ndHRfc2l6ZSA9IDA7Ci0JZm9yIChuID0gMDsgIG4gPCBjb3VudDsgbisrKSB7Ci0JCW9iaiA9
IG9iamVjdHNbbl07Ci0KLQkJc2VxX3B1dHMobSwgIiAgICIpOwotCQlkZXNjcmliZV9vYmoobSwg
b2JqKTsKLQkJc2VxX3B1dGMobSwgJ1xuJyk7Ci0JCXRvdGFsX29ial9zaXplICs9IG9iai0+YmFz
ZS5zaXplOwotCQl0b3RhbF9ndHRfc2l6ZSArPSBpOTE1X2dlbV9vYmpfdG90YWxfZ2d0dF9zaXpl
KG9iaik7Ci0JfQotCi0JbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7Ci0KLQlzZXFf
cHJpbnRmKG0sICJUb3RhbCAlZCBvYmplY3RzLCAlbGx1IGJ5dGVzLCAlbGx1IEdUVCBzaXplXG4i
LAotCQkgICBjb3VudCwgdG90YWxfb2JqX3NpemUsIHRvdGFsX2d0dF9zaXplKTsKLQlrdmZyZWUo
b2JqZWN0cyk7Ci0KLQlyZXR1cm4gMDsKLX0KLQogc3RhdGljIGludCBpOTE1X2dlbV9iYXRjaF9w
b29sX2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogewogCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKQEAgLTQ1
ODQsNyArNDUzNSw2IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zIGk5MTVf
Zmlmb191bmRlcnJ1bl9yZXNldF9vcHMgPSB7CiBzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9pbmZv
X2xpc3QgaTkxNV9kZWJ1Z2ZzX2xpc3RbXSA9IHsKIAl7Imk5MTVfY2FwYWJpbGl0aWVzIiwgaTkx
NV9jYXBhYmlsaXRpZXMsIDB9LAogCXsiaTkxNV9nZW1fb2JqZWN0cyIsIGk5MTVfZ2VtX29iamVj
dF9pbmZvLCAwfSwKLQl7Imk5MTVfZ2VtX2d0dCIsIGk5MTVfZ2VtX2d0dF9pbmZvLCAwfSwKIAl7
Imk5MTVfZ2VtX3N0b2xlbiIsIGk5MTVfZ2VtX3N0b2xlbl9saXN0X2luZm8gfSwKIAl7Imk5MTVf
Z2VtX2ZlbmNlX3JlZ3MiLCBpOTE1X2dlbV9mZW5jZV9yZWdzX2luZm8sIDB9LAogCXsiaTkxNV9n
ZW1faW50ZXJydXB0IiwgaTkxNV9pbnRlcnJ1cHRfaW5mbywgMH0sCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9k
cnYuaAppbmRleCBmYjJlODkxMzNlNzguLjc3MGM1NGI4N2RlNiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2Rydi5oCkBAIC05MjYsMTAgKzkyNiw5IEBAIHN0cnVjdCBpOTE1X2dlbV9tbSB7CiAJLyoqIEJp
dCA2IHN3aXp6bGluZyByZXF1aXJlZCBmb3IgWSB0aWxpbmcgKi8KIAl1MzIgYml0XzZfc3dpenps
ZV95OwogCi0JLyogYWNjb3VudGluZywgdXNlZnVsIGZvciB1c2VybGFuZCBkZWJ1Z2dpbmcgKi8K
LQlzcGlubG9ja190IG9iamVjdF9zdGF0X2xvY2s7Ci0JdTY0IG9iamVjdF9tZW1vcnk7Ci0JdTMy
IG9iamVjdF9jb3VudDsKKwkvKiBzaHJpbmtlciBhY2NvdW50aW5nLCBhbHNvIHVzZWZ1bCBmb3Ig
dXNlcmxhbmQgZGVidWdnaW5nICovCisJdTY0IHNocmlua19tZW1vcnk7CisJdTMyIHNocmlua19j
b3VudDsKIH07CiAKICNkZWZpbmUgSTkxNV9JRExFX0VOR0lORVNfVElNRU9VVCAoMjAwKSAvKiBp
biBtcyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKaW5kZXggZDk4Y2NiYmRlNTNjLi4wYTUwNDlh
ZWMxNDQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwpAQCAtMTEzNywxNSArMTEzNywxNyBAQCBp
OTE1X2dlbV9tYWR2aXNlX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEs
CiAJaWYgKGk5MTVfZ2VtX29iamVjdF9oYXNfcGFnZXMob2JqKSkgewogCQlzdHJ1Y3QgbGlzdF9o
ZWFkICpsaXN0OwogCi0JCXNwaW5fbG9jaygmaTkxNS0+bW0ub2JqX2xvY2spOwotCQlpZiAob2Jq
LT5tbS5tYWR2ICE9IEk5MTVfTUFEVl9XSUxMTkVFRCkKLQkJCWxpc3QgPSAmaTkxNS0+bW0ucHVy
Z2VfbGlzdDsKLQkJZWxzZSBpZiAob2JqLT5iaW5kX2NvdW50KQotCQkJbGlzdCA9ICZpOTE1LT5t
bS5ib3VuZF9saXN0OwotCQllbHNlCi0JCQlsaXN0ID0gJmk5MTUtPm1tLnVuYm91bmRfbGlzdDsK
LQkJbGlzdF9tb3ZlX3RhaWwoJm9iai0+bW0ubGluaywgbGlzdCk7Ci0JCXNwaW5fdW5sb2NrKCZp
OTE1LT5tbS5vYmpfbG9jayk7CisJCWlmIChpOTE1X2dlbV9vYmplY3RfaXNfc2hyaW5rYWJsZShv
YmopKSB7CisJCQlzcGluX2xvY2soJmk5MTUtPm1tLm9ial9sb2NrKTsKKwkJCWlmIChvYmotPm1t
Lm1hZHYgIT0gSTkxNV9NQURWX1dJTExORUVEKQorCQkJCWxpc3QgPSAmaTkxNS0+bW0ucHVyZ2Vf
bGlzdDsKKwkJCWVsc2UgaWYgKG9iai0+YmluZF9jb3VudCkKKwkJCQlsaXN0ID0gJmk5MTUtPm1t
LmJvdW5kX2xpc3Q7CisJCQllbHNlCisJCQkJbGlzdCA9ICZpOTE1LT5tbS51bmJvdW5kX2xpc3Q7
CisJCQlsaXN0X21vdmVfdGFpbCgmb2JqLT5tbS5saW5rLCBsaXN0KTsKKwkJCXNwaW5fdW5sb2Nr
KCZpOTE1LT5tbS5vYmpfbG9jayk7CisJCX0KIAl9CiAKIAkvKiBpZiB0aGUgb2JqZWN0IGlzIG5v
IGxvbmdlciBhdHRhY2hlZCwgZGlzY2FyZCBpdHMgYmFja2luZyBzdG9yYWdlICovCkBAIC0xNzUw
LDcgKzE3NTIsNiBAQCBpOTE1X2dlbV9sb2FkX2luaXRfZmVuY2VzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKIAogc3RhdGljIHZvaWQgaTkxNV9nZW1faW5pdF9fbW0oc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3Bpbl9sb2NrX2luaXQoJmk5MTUtPm1tLm9i
amVjdF9zdGF0X2xvY2spOwogCXNwaW5fbG9ja19pbml0KCZpOTE1LT5tbS5vYmpfbG9jayk7CiAJ
c3Bpbl9sb2NrX2luaXQoJmk5MTUtPm1tLmZyZWVfbG9jayk7CiAKQEAgLTE4MDAsNyArMTgwMSw3
IEBAIHZvaWQgaTkxNV9nZW1fY2xlYW51cF9lYXJseShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCiAJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhkZXZfcHJpdik7CiAJR0VN
X0JVR19PTighbGxpc3RfZW1wdHkoJmRldl9wcml2LT5tbS5mcmVlX2xpc3QpKTsKIAlHRU1fQlVH
X09OKGF0b21pY19yZWFkKCZkZXZfcHJpdi0+bW0uZnJlZV9jb3VudCkpOwotCVdBUk5fT04oZGV2
X3ByaXYtPm1tLm9iamVjdF9jb3VudCk7CisJV0FSTl9PTihkZXZfcHJpdi0+bW0uc2hyaW5rX2Nv
dW50KTsKIAogCWNsZWFudXBfc3JjdV9zdHJ1Y3QoJmRldl9wcml2LT5ncHVfZXJyb3IucmVzZXRf
YmFja29mZl9zcmN1KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92
bWEuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKaW5kZXggZjY0MGNhZWM0YmFl
Li5iN2ZiN2QyMTZmNzcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1h
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwpAQCAtMTEwLDcgKzExMCw4
IEBAIHN0YXRpYyB2b2lkIF9faTkxNV92bWFfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVm
KQogCSAqIHNvIHRoYXQgd2UgZG9uJ3Qgc3RlYWwgZnJvbSByZWNlbnRseSB1c2VkIGJ1dCBpbmFj
dGl2ZSBvYmplY3RzCiAJICogKHVubGVzcyB3ZSBhcmUgZm9yY2VkIHRvIG9mYyEpCiAJICovCi0J
b2JqX2J1bXBfbXJ1KG9iaik7CisJaWYgKGk5MTVfZ2VtX29iamVjdF9pc19zaHJpbmthYmxlKG9i
aikpCisJCW9ial9idW1wX21ydShvYmopOwogCiAJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOyAv
KiBhbmQgZHJvcCB0aGUgYWN0aXZlIHJlZmVyZW5jZSAqLwogfQpAQCAtNjc3LDExICs2NzgsMTQg
QEAgaTkxNV92bWFfaW5zZXJ0KHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1NjQgc2l6ZSwgdTY0IGFs
aWdubWVudCwgdTY0IGZsYWdzKQogCQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0g
dm1hLT5vYmo7CiAKIAkJc3Bpbl9sb2NrKCZkZXZfcHJpdi0+bW0ub2JqX2xvY2spOwotCQlsaXN0
X21vdmVfdGFpbCgmb2JqLT5tbS5saW5rLCAmZGV2X3ByaXYtPm1tLmJvdW5kX2xpc3QpOwotCQlv
YmotPmJpbmRfY291bnQrKzsKLQkJc3Bpbl91bmxvY2soJmRldl9wcml2LT5tbS5vYmpfbG9jayk7
CiAKKwkJaWYgKGk5MTVfZ2VtX29iamVjdF9pc19zaHJpbmthYmxlKG9iaikpCisJCQlsaXN0X21v
dmVfdGFpbCgmb2JqLT5tbS5saW5rLCAmZGV2X3ByaXYtPm1tLmJvdW5kX2xpc3QpOworCisJCW9i
ai0+YmluZF9jb3VudCsrOwogCQlhc3NlcnRfYmluZF9jb3VudChvYmopOworCisJCXNwaW5fdW5s
b2NrKCZkZXZfcHJpdi0+bW0ub2JqX2xvY2spOwogCX0KIAogCXJldHVybiAwOwpAQCAtNzE3LDkg
KzcyMSwxMyBAQCBpOTE1X3ZtYV9yZW1vdmUoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJCXN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB2bWEtPm9iajsKIAogCQlzcGluX2xvY2soJmk5
MTUtPm1tLm9ial9sb2NrKTsKKworCQlHRU1fQlVHX09OKG9iai0+YmluZF9jb3VudCA9PSAwKTsK
IAkJaWYgKC0tb2JqLT5iaW5kX2NvdW50ID09IDAgJiYKKwkJICAgIGk5MTVfZ2VtX29iamVjdF9p
c19zaHJpbmthYmxlKG9iaikgJiYKIAkJICAgIG9iai0+bW0ubWFkdiA9PSBJOTE1X01BRFZfV0lM
TE5FRUQpCiAJCQlsaXN0X21vdmVfdGFpbCgmb2JqLT5tbS5saW5rLCAmaTkxNS0+bW0udW5ib3Vu
ZF9saXN0KTsKKwogCQlzcGluX3VubG9jaygmaTkxNS0+bW0ub2JqX2xvY2spOwogCiAJCS8qCi0t
IAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
CkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpo
dHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

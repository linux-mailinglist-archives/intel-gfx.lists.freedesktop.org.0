Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 4EE1CD31B0
	for <lists+intel-gfx@lfdr.de>; Thu, 10 Oct 2019 21:49:12 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E083A6EB7E;
	Thu, 10 Oct 2019 19:49:03 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id DFE126E91E
 for <intel-gfx@lists.freedesktop.org>; Thu, 10 Oct 2019 19:48:59 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18796083-1500050 
 for <intel-gfx@lists.freedesktop.org>; Thu, 10 Oct 2019 20:48:53 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 10 Oct 2019 20:48:47 +0100
Message-Id: <20191010194851.26592-5-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191010194851.26592-1-chris@chris-wilson.co.uk>
References: <20191010194851.26592-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 5/9] drm/i915/perf: implement active wait for noa
 configurations
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwuY29tPgoK
Tk9BIGNvbmZpZ3VyYXRpb24gdGFrZSBzb21lIGFtb3VudCBvZiB0aW1lIHRvIGFwcGx5LiBUaGF0
IGFtb3VudCBvZgp0aW1lIGRlcGVuZHMgb24gdGhlIHNpemUgb2YgdGhlIEdULiBUaGVyZSBpcyBu
byBkb2N1bWVudGVkIHRpbWUgZm9yCnRoaXMuIEZvciBleGFtcGxlLCBwYXN0IGV4cGVyaW1lbnRh
dGlvbnMgd2l0aCBwb3dlcmdhdGluZwpjb25maWd1cmF0aW9uIGNoYW5nZXMgc2VlbSB0byBpbmRp
Y2F0ZSBhIDYwfjcwdXMgZGVsYXkuIFdlIGdvIHdpdGgKNTAwdXMgYXMgZGVmYXVsdCBmb3Igbm93
IHdoaWNoIHNob3VsZCBiZSBvdmVyIHRoZSByZXF1aXJlZCBhbW91bnQgb2YKdGltZSAoYWNjb3Jk
aW5nIHRvIEhXIGFyY2hpdGVjdHMpLgoKdjI6IERvbid0IGZvcmdldCB0byBzYXZlL3Jlc3RvcmUg
cmVnaXN0ZXJzIHVzZWQgZm9yIHRoZSB3YWl0IChDaHJpcykKCnYzOiBOYW1lIHVzZWQgQ1NfR1BS
IHJlZ2lzdGVycyAoQ2hyaXMpCiAgICBGaXggY29tcGlsZSBpc3N1ZSBkdWUgdG8gcmViYXNlIChM
aW9uZWwpCgp2NDogRml4IHNhdmUvcmVzdG9yZSBoZWxwZXJzIChVbWVzaCkKCnY1OiBNb3ZlIG5v
YV93YWl0IGZyb20gZHJtX2k5MTVfcHJpdmF0ZSB0byBpOTE1X3BlcmZfc3RyZWFtIChMaW9uZWwp
Cgp2NjogQWRkIG1pc3Npbmcgc3RydWN0IGRlY2xhcmF0aW9ucyBpbiBpOTE1X3BlcmYuaAoKU2ln
bmVkLW9mZi1ieTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwu
Y29tPgpSZXZpZXdlZC1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+
ICh2NCkKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28u
dWs+ICh2NCkKLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMu
aCAgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmggICAg
ICB8ICAgNSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyAgICAgICAgICAg
fCAgMzIgKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyAgICAgICAgICAgICAg
fCAyMjQgKysrKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmZf
dHlwZXMuaCAgICAgICAgfCAgIDggKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaCAg
ICAgICAgICAgICAgIHwgICA0ICstCiAuLi4vZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9z
ZWxmdGVzdHMuaCAgfCAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVf
cGVyZi5jICAgIHwgMjE2ICsrKysrKysrKysrKysrKysrCiA4IGZpbGVzIGNoYW5nZWQsIDQ5MiBp
bnNlcnRpb25zKCspLCAyIGRlbGV0aW9ucygtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3BlcmYuYwoKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZ3B1X2NvbW1hbmRzLmgKaW5kZXggMDk4NzEwMGM3ODZiLi44ZTYzY2ZmY2Fi
ZTAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5k
cy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5oCkBA
IC0xNjMsNyArMTYzLDggQEAKICNkZWZpbmUgTUlfQkFUQ0hfQlVGRkVSX1NUQVJUCU1JX0lOU1RS
KDB4MzEsIDApCiAjZGVmaW5lICAgTUlfQkFUQ0hfR1RUCQkgICAgKDI8PDYpIC8qIGFsaWFzZWQg
d2l0aCAoMTw8Nykgb24gZ2VuNCAqLwogI2RlZmluZSBNSV9CQVRDSF9CVUZGRVJfU1RBUlRfR0VO
OAlNSV9JTlNUUigweDMxLCAxKQotI2RlZmluZSAgIE1JX0JBVENIX1JFU09VUkNFX1NUUkVBTUVS
ICgxPDwxMCkKKyNkZWZpbmUgICBNSV9CQVRDSF9SRVNPVVJDRV9TVFJFQU1FUiBSRUdfQklUKDEw
KQorI2RlZmluZSAgIE1JX0JBVENIX1BSRURJQ0FURSAgICAgICAgIFJFR19CSVQoMTUpIC8qIEhT
Vysgb24gUkNTIG9ubHkqLwogCiAvKgogICogM0QgaW5zdHJ1Y3Rpb25zIHVzZWQgYnkgdGhlIGtl
cm5lbApAQCAtMjI0LDYgKzIyNSw3IEBACiAjZGVmaW5lICAgUElQRV9DT05UUk9MX0NTX1NUQUxM
CQkJCSgxPDwyMCkKICNkZWZpbmUgICBQSVBFX0NPTlRST0xfVExCX0lOVkFMSURBVEUJCQkoMTw8
MTgpCiAjZGVmaW5lICAgUElQRV9DT05UUk9MX01FRElBX1NUQVRFX0NMRUFSCQkoMTw8MTYpCisj
ZGVmaW5lICAgUElQRV9DT05UUk9MX1dSSVRFX1RJTUVTVEFNUAkJCSgzPDwxNCkKICNkZWZpbmUg
ICBQSVBFX0NPTlRST0xfUVdfV1JJVEUJCQkJKDE8PDE0KQogI2RlZmluZSAgIFBJUEVfQ09OVFJP
TF9QT1NUX1NZTkNfT1BfTUFTSyAgICAgICAgICAgICAgICAoMzw8MTQpCiAjZGVmaW5lICAgUElQ
RV9DT05UUk9MX0RFUFRIX1NUQUxMCQkJKDE8PDEzKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2d0X3R5cGVzLmgKaW5kZXggODAyZjUxNmEzNDMwLi5iZTRiMjYzNjIxYzggMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmgKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaApAQCAtMTA5LDYgKzEwOSwxMSBAQCBl
bnVtIGludGVsX2d0X3NjcmF0Y2hfZmllbGQgewogCS8qIDggYnl0ZXMgKi8KIAlJTlRFTF9HVF9T
Q1JBVENIX0ZJRUxEX0NPSEVSRU5UTDNfV0EgPSAyNTYsCiAKKwkvKiA2ICogOCBieXRlcyAqLwor
CUlOVEVMX0dUX1NDUkFUQ0hfRklFTERfUEVSRl9DU19HUFIgPSAyMDQ4LAorCisJLyogNCBieXRl
cyAqLworCUlOVEVMX0dUX1NDUkFUQ0hfRklFTERfUEVSRl9QUkVESUNBVEVfUkVTVUxUXzEgPSAy
MDk2LAogfTsKIAogI2VuZGlmIC8qIF9fSU5URUxfR1RfVFlQRVNfSF9fICovCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZGVidWdmcy5jCmluZGV4IDI3N2YzMTI5N2YyOS4uZDQ2M2EyOGI3NDc1IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwpAQCAtMzU5MCw2ICszNTkwLDM3IEBAIERFRklO
RV9TSU1QTEVfQVRUUklCVVRFKGk5MTVfd2VkZ2VkX2ZvcHMsCiAJCQlpOTE1X3dlZGdlZF9nZXQs
IGk5MTVfd2VkZ2VkX3NldCwKIAkJCSIlbGx1XG4iKTsKIAorc3RhdGljIGludAoraTkxNV9wZXJm
X25vYV9kZWxheV9zZXQodm9pZCAqZGF0YSwgdTY0IHZhbCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IGRhdGE7CisJY29uc3QgdTMyIGNsayA9IFJVTlRJTUVfSU5GTyhpOTE1
KS0+Y3NfdGltZXN0YW1wX2ZyZXF1ZW5jeV9raHo7CisKKwkvKgorCSAqIFRoaXMgd291bGQgbGVh
ZCB0byBpbmZpbml0ZSB3YWl0cyBhcyB3ZSdyZSBkb2luZyB0aW1lc3RhbXAKKwkgKiBkaWZmZXJl
bmNlIG9uIHRoZSBDUyB3aXRoIG9ubHkgMzJiaXRzLgorCSAqLworCWlmICh2YWwgPiBtdWxfdTMy
X3UzMihVMzJfTUFYLCBjbGspKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWF0b21pYzY0X3NldCgm
aTkxNS0+cGVyZi5ub2FfcHJvZ3JhbW1pbmdfZGVsYXksIHZhbCk7CisJcmV0dXJuIDA7Cit9CisK
K3N0YXRpYyBpbnQKK2k5MTVfcGVyZl9ub2FfZGVsYXlfZ2V0KHZvaWQgKmRhdGEsIHU2NCAqdmFs
KQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZGF0YTsKKworCSp2YWwgPSBh
dG9taWM2NF9yZWFkKCZpOTE1LT5wZXJmLm5vYV9wcm9ncmFtbWluZ19kZWxheSk7CisJcmV0dXJu
IDA7Cit9CisKK0RFRklORV9TSU1QTEVfQVRUUklCVVRFKGk5MTVfcGVyZl9ub2FfZGVsYXlfZm9w
cywKKwkJCWk5MTVfcGVyZl9ub2FfZGVsYXlfZ2V0LAorCQkJaTkxNV9wZXJmX25vYV9kZWxheV9z
ZXQsCisJCQkiJWxsdVxuIik7CisKICNkZWZpbmUgRFJPUF9VTkJPVU5ECUJJVCgwKQogI2RlZmlu
ZSBEUk9QX0JPVU5ECUJJVCgxKQogI2RlZmluZSBEUk9QX1JFVElSRQlCSVQoMikKQEAgLTQzNDAs
NiArNDM3MSw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaTkxNV9kZWJ1Z2ZzX2ZpbGVzIHsKIAlj
b25zdCBjaGFyICpuYW1lOwogCWNvbnN0IHN0cnVjdCBmaWxlX29wZXJhdGlvbnMgKmZvcHM7CiB9
IGk5MTVfZGVidWdmc19maWxlc1tdID0geworCXsiaTkxNV9wZXJmX25vYV9kZWxheSIsICZpOTE1
X3BlcmZfbm9hX2RlbGF5X2ZvcHN9LAogCXsiaTkxNV93ZWRnZWQiLCAmaTkxNV93ZWRnZWRfZm9w
c30sCiAJeyJpOTE1X2NhY2hlX3NoYXJpbmciLCAmaTkxNV9jYWNoZV9zaGFyaW5nX2ZvcHN9LAog
CXsiaTkxNV9nZW1fZHJvcF9jYWNoZXMiLCAmaTkxNV9kcm9wX2NhY2hlc19mb3BzfSwKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9wZXJmLmMKaW5kZXggN2Q3YmFlZTdmZWJlLi5jYWE0YWI2OGNlYTUgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcGVyZi5jCkBAIC0xOTgsNiArMTk4LDcgQEAKICNpbmNsdWRlICJnZW0v
aTkxNV9nZW1fY29udGV4dC5oIgogI2luY2x1ZGUgImd0L2ludGVsX2VuZ2luZV9wbS5oIgogI2lu
Y2x1ZGUgImd0L2ludGVsX2VuZ2luZV91c2VyLmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfZ3QuaCIK
ICNpbmNsdWRlICJndC9pbnRlbF9scmNfcmVnLmgiCiAKICNpbmNsdWRlICJpOTE1X2Rydi5oIgpA
QCAtMTMzNyw2ICsxMzM4LDEyIEBAIGZyZWVfb2FfYnVmZmVyKHN0cnVjdCBpOTE1X3BlcmZfc3Ry
ZWFtICpzdHJlYW0pCiAJc3RyZWFtLT5vYV9idWZmZXIudmFkZHIgPSBOVUxMOwogfQogCitzdGF0
aWMgdm9pZAorZnJlZV9ub2Ffd2FpdChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQor
eworCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZzdHJlYW0tPm5vYV93YWl0LCAwKTsKK30K
Kwogc3RhdGljIHZvaWQKIGZyZWVfb2FfY29uZmlncyhzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAq
c3RyZWFtKQogewpAQCAtMTM2OSw2ICsxMzc2LDcgQEAgc3RhdGljIHZvaWQgaTkxNV9vYV9zdHJl
YW1fZGVzdHJveShzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogCQlvYV9wdXRfcmVu
ZGVyX2N0eF9pZChzdHJlYW0pOwogCiAJZnJlZV9vYV9jb25maWdzKHN0cmVhbSk7CisJZnJlZV9u
b2Ffd2FpdChzdHJlYW0pOwogCiAJaWYgKHBlcmYtPnNwdXJpb3VzX3JlcG9ydF9ycy5taXNzZWQp
IHsKIAkJRFJNX05PVEUoIiVkIHNwdXJpb3VzIE9BIHJlcG9ydCBub3RpY2VzIHN1cHByZXNzZWQg
ZHVlIHRvIHJhdGVsaW1pdGluZ1xuIiwKQEAgLTE1MjksNiArMTUzNywyMDYgQEAgc3RhdGljIGlu
dCBhbGxvY19vYV9idWZmZXIoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIAlyZXR1
cm4gcmV0OwogfQogCitzdGF0aWMgdTMyICpzYXZlX3Jlc3RvcmVfcmVnaXN0ZXIoc3RydWN0IGk5
MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwgdTMyICpjcywKKwkJCQkgIGJvb2wgc2F2ZSwgaTkxNV9y
ZWdfdCByZWcsIHUzMiBvZmZzZXQsCisJCQkJICB1MzIgZHdvcmRfY291bnQpCit7CisJdTMyIGNt
ZDsKKwl1MzIgZDsKKworCWNtZCA9IHNhdmUgPyBNSV9TVE9SRV9SRUdJU1RFUl9NRU0gOiBNSV9M
T0FEX1JFR0lTVEVSX01FTTsKKwlpZiAoSU5URUxfR0VOKHN0cmVhbS0+cGVyZi0+aTkxNSkgPj0g
OCkKKwkJY21kKys7CisKKwlmb3IgKGQgPSAwOyBkIDwgZHdvcmRfY291bnQ7IGQrKykgeworCQkq
Y3MrKyA9IGNtZDsKKwkJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChyZWcpICsgNCAqIGQ7
CisJCSpjcysrID0gaW50ZWxfZ3Rfc2NyYXRjaF9vZmZzZXQoc3RyZWFtLT5lbmdpbmUtPmd0LAor
CQkJCQkgICAgICAgCW9mZnNldCkgKyA0ICogZDsKKwkJKmNzKysgPSAwOworCX0KKworCXJldHVy
biBjczsKK30KKworc3RhdGljIGludCBhbGxvY19ub2Ffd2FpdChzdHJ1Y3QgaTkxNV9wZXJmX3N0
cmVhbSAqc3RyZWFtKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gc3RyZWFt
LT5wZXJmLT5pOTE1OworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpibzsKKwlzdHJ1Y3Qg
aTkxNV92bWEgKnZtYTsKKwljb25zdCB1NjQgZGVsYXlfdGlja3MgPSAweGZmZmZmZmZmZmZmZmZm
ZmYgLQorCQlESVY2NF9VNjRfUk9VTkRfVVAoCisJCQlhdG9taWM2NF9yZWFkKCZzdHJlYW0tPnBl
cmYtPm5vYV9wcm9ncmFtbWluZ19kZWxheSkgKgorCQkJUlVOVElNRV9JTkZPKGk5MTUpLT5jc190
aW1lc3RhbXBfZnJlcXVlbmN5X2toeiwKKwkJCTEwMDAwMDB1bGwpOworCWNvbnN0IHUzMiBiYXNl
ID0gc3RyZWFtLT5lbmdpbmUtPm1taW9fYmFzZTsKKyNkZWZpbmUgQ1NfR1BSKHgpIEdFTjhfUklO
R19DU19HUFIoYmFzZSwgeCkKKwl1MzIgKmJhdGNoLCAqdHMwLCAqY3MsICpqdW1wOworCWludCBy
ZXQsIGk7CisJZW51bSB7CisJCVNUQVJUX1RTLAorCQlOT1dfVFMsCisJCURFTFRBX1RTLAorCQlK
VU1QX1BSRURJQ0FURSwKKwkJREVMVEFfVEFSR0VULAorCQlOX0NTX0dQUgorCX07CisKKwlibyA9
IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoaTkxNSwgNDA5Nik7CisJaWYgKElTX0VS
UihibykpIHsKKwkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gYWxsb2NhdGUgTk9BIHdhaXQgYmF0Y2hi
dWZmZXJcbiIpOworCQlyZXR1cm4gUFRSX0VSUihibyk7CisJfQorCisJLyoKKwkgKiBXZSBwaW4g
aW4gR0dUVCBiZWNhdXNlIHdlIGp1bXAgaW50byB0aGlzIGJ1ZmZlciBub3cgYmVjYXVzZQorCSAq
IG11bHRpcGxlIE9BIGNvbmZpZyBCT3Mgd2lsbCBoYXZlIGEganVtcCB0byB0aGlzIGFkZHJlc3Mg
YW5kIGl0CisJICogbmVlZHMgdG8gYmUgZml4ZWQgZHVyaW5nIHRoZSBsaWZldGltZSBvZiB0aGUg
aTkxNS9wZXJmIHN0cmVhbS4KKwkgKi8KKwl2bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4o
Ym8sIE5VTEwsIDAsIDAsIFBJTl9ISUdIKTsKKwlpZiAoSVNfRVJSKHZtYSkpIHsKKwkJcmV0ID0g
UFRSX0VSUih2bWEpOworCQlnb3RvIGVycl91bnJlZjsKKwl9CisKKwliYXRjaCA9IGNzID0gaTkx
NV9nZW1fb2JqZWN0X3Bpbl9tYXAoYm8sIEk5MTVfTUFQX1dCKTsKKwlpZiAoSVNfRVJSKGJhdGNo
KSkgeworCQlyZXQgPSBQVFJfRVJSKGJhdGNoKTsKKwkJZ290byBlcnJfdW5waW47CisJfQorCisJ
LyogU2F2ZSByZWdpc3RlcnMuICovCisJZm9yIChpID0gMDsgaSA8IE5fQ1NfR1BSOyBpKyspCisJ
CWNzID0gc2F2ZV9yZXN0b3JlX3JlZ2lzdGVyKAorCQkJc3RyZWFtLCBjcywgdHJ1ZSAvKiBzYXZl
ICovLCBDU19HUFIoaSksCisJCQlJTlRFTF9HVF9TQ1JBVENIX0ZJRUxEX1BFUkZfQ1NfR1BSICsg
OCAqIGksIDIpOworCWNzID0gc2F2ZV9yZXN0b3JlX3JlZ2lzdGVyKAorCQlzdHJlYW0sIGNzLCB0
cnVlIC8qIHNhdmUgKi8sIE1JX1BSRURJQ0FURV9SRVNVTFRfMSwKKwkJSU5URUxfR1RfU0NSQVRD
SF9GSUVMRF9QRVJGX1BSRURJQ0FURV9SRVNVTFRfMSwgMSk7CisKKwkvKiBGaXJzdCB0aW1lc3Rh
bXAgc25hcHNob3QgbG9jYXRpb24uICovCisJdHMwID0gY3M7CisKKwkvKgorCSAqIEluaXRpYWwg
c25hcHNob3Qgb2YgdGhlIHRpbWVzdGFtcCByZWdpc3RlciB0byBpbXBsZW1lbnQgdGhlIHdhaXQu
CisJICogV2Ugd29yayB3aXRoIDMyYiB2YWx1ZXMsIHNvIGNsZWFyIG91dCB0aGUgdG9wIDMyYiBi
aXRzIG9mIHRoZQorCSAqIHJlZ2lzdGVyIGJlY2F1c2UgdGhlIEFMVSB3b3JrcyA2NGJpdHMuCisJ
ICovCisJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX0lNTSgxKTsKKwkqY3MrKyA9IGk5MTVfbW1p
b19yZWdfb2Zmc2V0KENTX0dQUihTVEFSVF9UUykpICsgNDsKKwkqY3MrKyA9IDA7CisJKmNzKysg
PSBNSV9MT0FEX1JFR0lTVEVSX1JFRyB8ICgzIC0gMik7CisJKmNzKysgPSBpOTE1X21taW9fcmVn
X29mZnNldChSSU5HX1RJTUVTVEFNUChiYXNlKSk7CisJKmNzKysgPSBpOTE1X21taW9fcmVnX29m
ZnNldChDU19HUFIoU1RBUlRfVFMpKTsKKworCS8qCisJICogVGhpcyBpcyB0aGUgbG9jYXRpb24g
d2UncmUgZ29pbmcgdG8ganVtcCBiYWNrIGludG8gdW50aWwgdGhlCisJICogcmVxdWlyZWQgYW1v
dW50IG9mIHRpbWUgaGFzIHBhc3NlZC4KKwkgKi8KKwlqdW1wID0gY3M7CisKKwkvKgorCSAqIFRh
a2UgYW5vdGhlciBzbmFwc2hvdCBvZiB0aGUgdGltZXN0YW1wIHJlZ2lzdGVyLiBUYWtlIGNhcmUg
dG8gY2xlYXIKKwkgKiB1cCB0aGUgdG9wIDMyYml0cyBvZiBDU19HUFIoMSkgYXMgd2UncmUgdXNp
bmcgaXQgZm9yIG90aGVyCisJICogb3BlcmF0aW9ucyBiZWxvdy4KKwkgKi8KKwkqY3MrKyA9IE1J
X0xPQURfUkVHSVNURVJfSU1NKDEpOworCSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQoQ1Nf
R1BSKE5PV19UUykpICsgNDsKKwkqY3MrKyA9IDA7CisJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVS
X1JFRyB8ICgzIC0gMik7CisJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChSSU5HX1RJTUVT
VEFNUChiYXNlKSk7CisJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChDU19HUFIoTk9XX1RT
KSk7CisKKwkvKgorCSAqIERvIGEgZGlmZiBiZXR3ZWVuIHRoZSAyIHRpbWVzdGFtcHMgYW5kIHN0
b3JlIHRoZSByZXN1bHQgYmFjayBpbnRvCisJICogQ1NfR1BSKDEpLgorCSAqLworCSpjcysrID0g
TUlfTUFUSCg1KTsKKwkqY3MrKyA9IE1JX01BVEhfTE9BRChNSV9NQVRIX1JFR19TUkNBLCBNSV9N
QVRIX1JFRyhOT1dfVFMpKTsKKwkqY3MrKyA9IE1JX01BVEhfTE9BRChNSV9NQVRIX1JFR19TUkNC
LCBNSV9NQVRIX1JFRyhTVEFSVF9UUykpOworCSpjcysrID0gTUlfTUFUSF9TVUI7CisJKmNzKysg
PSBNSV9NQVRIX1NUT1JFKE1JX01BVEhfUkVHKERFTFRBX1RTKSwgTUlfTUFUSF9SRUdfQUNDVSk7
CisJKmNzKysgPSBNSV9NQVRIX1NUT1JFKE1JX01BVEhfUkVHKEpVTVBfUFJFRElDQVRFKSwgTUlf
TUFUSF9SRUdfQ0YpOworCisJLyoKKwkgKiBUcmFuc2ZlciB0aGUgY2FycnkgZmxhZyAoc2V0IHRv
IDEgaWYgdHMxIDwgdHMwLCBtZWFuaW5nIHRoZQorCSAqIHRpbWVzdGFtcCBoYXZlIHJvbGxlZCBv
dmVyIHRoZSAzMmJpdHMpIGludG8gdGhlIHByZWRpY2F0ZSByZWdpc3RlcgorCSAqIHRvIGJlIHVz
ZWQgZm9yIHRoZSBwcmVkaWNhdGVkIGp1bXAuCisJICovCisJKmNzKysgPSBNSV9MT0FEX1JFR0lT
VEVSX1JFRyB8ICgzIC0gMik7CisJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChDU19HUFIo
SlVNUF9QUkVESUNBVEUpKTsKKwkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KE1JX1BSRURJ
Q0FURV9SRVNVTFRfMSk7CisKKwkvKiBSZXN0YXJ0IGZyb20gdGhlIGJlZ2lubmluZyBpZiB3ZSBo
YWQgdGltZXN0YW1wcyByb2xsIG92ZXIuICovCisJKmNzKysgPSAoSU5URUxfR0VOKGk5MTUpIDwg
OCA/CisJCSBNSV9CQVRDSF9CVUZGRVJfU1RBUlQgOgorCQkgTUlfQkFUQ0hfQlVGRkVSX1NUQVJU
X0dFTjgpIHwKKwkJTUlfQkFUQ0hfUFJFRElDQVRFOworCSpjcysrID0gaTkxNV9nZ3R0X29mZnNl
dCh2bWEpICsgKHRzMCAtIGJhdGNoKSAqIDQ7CisJKmNzKysgPSAwOworCisJLyoKKwkgKiBOb3cg
YWRkIHRoZSBkaWZmIGJldHdlZW4gdG8gcHJldmlvdXMgdGltZXN0YW1wcyBhbmQgYWRkIGl0IHRv
IDoKKwkgKiAgICAgICgoKDEgKiA8PCA2NCkgLSAxKSAtIGRlbGF5X25zKQorCSAqCisJICogV2hl
biB0aGUgQ2FycnkgRmxhZyBjb250YWlucyAxIHRoaXMgbWVhbnMgdGhlIGVsYXBzZWQgdGltZSBp
cworCSAqIGxvbmdlciB0aGFuIHRoZSBleHBlY3RlZCBkZWxheSwgYW5kIHdlIGNhbiBleGl0IHRo
ZSB3YWl0IGxvb3AuCisJICovCisJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX0lNTSgyKTsKKwkq
Y3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KENTX0dQUihERUxUQV9UQVJHRVQpKTsKKwkqY3Mr
KyA9IGxvd2VyXzMyX2JpdHMoZGVsYXlfdGlja3MpOworCSpjcysrID0gaTkxNV9tbWlvX3JlZ19v
ZmZzZXQoQ1NfR1BSKERFTFRBX1RBUkdFVCkpICsgNDsKKwkqY3MrKyA9IHVwcGVyXzMyX2JpdHMo
ZGVsYXlfdGlja3MpOworCisJKmNzKysgPSBNSV9NQVRIKDQpOworCSpjcysrID0gTUlfTUFUSF9M
T0FEKE1JX01BVEhfUkVHX1NSQ0EsIE1JX01BVEhfUkVHKERFTFRBX1RTKSk7CisJKmNzKysgPSBN
SV9NQVRIX0xPQUQoTUlfTUFUSF9SRUdfU1JDQiwgTUlfTUFUSF9SRUcoREVMVEFfVEFSR0VUKSk7
CisJKmNzKysgPSBNSV9NQVRIX0FERDsKKwkqY3MrKyA9IE1JX01BVEhfU1RPUkVJTlYoTUlfTUFU
SF9SRUcoSlVNUF9QUkVESUNBVEUpLCBNSV9NQVRIX1JFR19DRik7CisKKwkvKgorCSAqIFRyYW5z
ZmVyIHRoZSByZXN1bHQgaW50byB0aGUgcHJlZGljYXRlIHJlZ2lzdGVyIHRvIGJlIHVzZWQgZm9y
IHRoZQorCSAqIHByZWRpY2F0ZWQganVtcC4KKwkgKi8KKwkqY3MrKyA9IE1JX0xPQURfUkVHSVNU
RVJfUkVHIHwgKDMgLSAyKTsKKwkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KENTX0dQUihK
VU1QX1BSRURJQ0FURSkpOworCSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQoTUlfUFJFRElD
QVRFX1JFU1VMVF8xKTsKKworCS8qIFByZWRpY2F0ZSB0aGUganVtcC4gICovCisJKmNzKysgPSAo
SU5URUxfR0VOKGk5MTUpIDwgOCA/CisJCSBNSV9CQVRDSF9CVUZGRVJfU1RBUlQgOgorCQkgTUlf
QkFUQ0hfQlVGRkVSX1NUQVJUX0dFTjgpIHwKKwkJTUlfQkFUQ0hfUFJFRElDQVRFOworCSpjcysr
ID0gaTkxNV9nZ3R0X29mZnNldCh2bWEpICsgKGp1bXAgLSBiYXRjaCkgKiA0OworCSpjcysrID0g
MDsKKworCS8qIFJlc3RvcmUgcmVnaXN0ZXJzLiAqLworCWZvciAoaSA9IDA7IGkgPCBOX0NTX0dQ
UjsgaSsrKQorCQljcyA9IHNhdmVfcmVzdG9yZV9yZWdpc3RlcigKKwkJCXN0cmVhbSwgY3MsIGZh
bHNlIC8qIHJlc3RvcmUgKi8sIENTX0dQUihpKSwKKwkJCUlOVEVMX0dUX1NDUkFUQ0hfRklFTERf
UEVSRl9DU19HUFIgKyA4ICogaSwgMik7CisJY3MgPSBzYXZlX3Jlc3RvcmVfcmVnaXN0ZXIoCisJ
CXN0cmVhbSwgY3MsIGZhbHNlIC8qIHJlc3RvcmUgKi8sIE1JX1BSRURJQ0FURV9SRVNVTFRfMSwK
KwkJSU5URUxfR1RfU0NSQVRDSF9GSUVMRF9QRVJGX1BSRURJQ0FURV9SRVNVTFRfMSwgMSk7CisK
KwkvKiBBbmQgcmV0dXJuIHRvIHRoZSByaW5nLiAqLworCSpjcysrID0gTUlfQkFUQ0hfQlVGRkVS
X0VORDsKKworCUdFTV9CVUdfT04oY3MgLSBiYXRjaCA+IFBBR0VfU0laRSAvIHNpemVvZigqYmF0
Y2gpKTsKKworCWk5MTVfZ2VtX29iamVjdF9mbHVzaF9tYXAoYm8pOworCWk5MTVfZ2VtX29iamVj
dF91bnBpbl9tYXAoYm8pOworCisJc3RyZWFtLT5ub2Ffd2FpdCA9IHZtYTsKKwlyZXR1cm4gMDsK
KworZXJyX3VucGluOgorCV9faTkxNV92bWFfdW5waW4odm1hKTsKK2Vycl91bnJlZjoKKwlpOTE1
X2dlbV9vYmplY3RfcHV0KGJvKTsKKwlyZXR1cm4gcmV0OworfQorCiBzdGF0aWMgdm9pZCBjb25m
aWdfb2FfcmVncyhzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUsCiAJCQkgICBjb25zdCBzdHJ1
Y3QgaTkxNV9vYV9yZWcgKnJlZ3MsCiAJCQkgICB1MzIgbl9yZWdzKQpAQCAtMjIwNiw2ICsyNDE0
LDEyIEBAIHN0YXRpYyBpbnQgaTkxNV9vYV9zdHJlYW1faW5pdChzdHJ1Y3QgaTkxNV9wZXJmX3N0
cmVhbSAqc3RyZWFtLAogCQl9CiAJfQogCisJcmV0ID0gYWxsb2Nfbm9hX3dhaXQoc3RyZWFtKTsK
KwlpZiAocmV0KSB7CisJCURSTV9ERUJVRygiVW5hYmxlIHRvIGFsbG9jYXRlIE5PQSB3YWl0IGJh
dGNoIGJ1ZmZlclxuIik7CisJCWdvdG8gZXJyX25vYV93YWl0X2FsbG9jOworCX0KKwogCXN0cmVh
bS0+b2FfY29uZmlnID0gaTkxNV9wZXJmX2dldF9vYV9jb25maWcocGVyZiwgcHJvcHMtPm1ldHJp
Y3Nfc2V0KTsKIAlpZiAoIXN0cmVhbS0+b2FfY29uZmlnKSB7CiAJCURSTV9ERUJVRygiSW52YWxp
ZCBPQSBjb25maWcgaWQ9JWlcbiIsIHByb3BzLT5tZXRyaWNzX3NldCk7CkBAIC0yMjY1LDYgKzI0
NzksOSBAQCBzdGF0aWMgaW50IGk5MTVfb2Ffc3RyZWFtX2luaXQoc3RydWN0IGk5MTVfcGVyZl9z
dHJlYW0gKnN0cmVhbSwKIAlpbnRlbF9lbmdpbmVfcG1fcHV0KHN0cmVhbS0+ZW5naW5lKTsKIAog
ZXJyX2NvbmZpZzoKKwlmcmVlX25vYV93YWl0KHN0cmVhbSk7CisKK2Vycl9ub2Ffd2FpdF9hbGxv
YzoKIAlpZiAoc3RyZWFtLT5jdHgpCiAJCW9hX3B1dF9yZW5kZXJfY3R4X2lkKHN0cmVhbSk7CiAK
QEAgLTM2NTAsNiArMzg2Nyw5IEBAIHZvaWQgaTkxNV9wZXJmX2luaXQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiAJCXJhdGVsaW1pdF9zZXRfZmxhZ3MoJnBlcmYtPnNwdXJpb3VzX3Jl
cG9ydF9ycywKIAkJCQkgICAgUkFURUxJTUlUX01TR19PTl9SRUxFQVNFKTsKIAorCQlhdG9taWM2
NF9zZXQoJnBlcmYtPm5vYV9wcm9ncmFtbWluZ19kZWxheSwKKwkJCSAgICAgNTAwICogMTAwMCAv
KiA1MDB1cyAqLyk7CisKIAkJcGVyZi0+aTkxNSA9IGk5MTU7CiAJfQogfQpAQCAtMzY4OSwzICsz
OTA5LDcgQEAgaW50IGk5MTVfcGVyZl9pb2N0bF92ZXJzaW9uKHZvaWQpCiB7CiAJcmV0dXJuIDE7
CiB9CisKKyNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9TRUxGVEVTVCkKKyNpbmNsdWRl
ICJzZWxmdGVzdHMvaTkxNV9wZXJmLmMiCisjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcGVyZl90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9w
ZXJmX3R5cGVzLmgKaW5kZXggMzM3Y2Q3ZDJhZDc3Li5kMzVhM2MxOTQ2YzMgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZl90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcGVyZl90eXBlcy5oCkBAIC0yNjYsNiArMjY2LDEyIEBAIHN0cnVjdCBp
OTE1X3BlcmZfc3RyZWFtIHsKIAkJICovCiAJCXUzMiBoZWFkOwogCX0gb2FfYnVmZmVyOworCisJ
LyoqCisJICogQSBiYXRjaCBidWZmZXIgZG9pbmcgYSB3YWl0IG9uIHRoZSBHUFUgZm9yIHRoZSBO
T0EgbG9naWMgdG8gYmUKKwkgKiByZXByb2dyYW1tZWQuCisJICovCisJc3RydWN0IGk5MTVfdm1h
ICpub2Ffd2FpdDsKIH07CiAKIC8qKgpAQCAtMzg1LDYgKzM5MSw4IEBAIHN0cnVjdCBpOTE1X3Bl
cmYgewogCiAJc3RydWN0IGk5MTVfb2Ffb3BzIG9wczsKIAljb25zdCBzdHJ1Y3QgaTkxNV9vYV9m
b3JtYXQgKm9hX2Zvcm1hdHM7CisKKwlhdG9taWM2NF90IG5vYV9wcm9ncmFtbWluZ19kZWxheTsK
IH07CiAKICNlbmRpZiAvKiBfSTkxNV9QRVJGX1RZUEVTX0hfICovCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9y
ZWcuaAppbmRleCAxZGMwNjdmYzU3YWIuLjk5ZjhhMDhkYzJiMiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3JlZy5oCkBAIC01NDUsNyArNTQ1LDkgQEAgc3RhdGljIGlubGluZSBib29sIGk5MTVfbW1pb19y
ZWdfdmFsaWQoaTkxNV9yZWdfdCByZWcpCiAjZGVmaW5lIE1JX1BSRURJQ0FURV9TUkMwX1VEVwlf
TU1JTygweDI0MDAgKyA0KQogI2RlZmluZSBNSV9QUkVESUNBVEVfU1JDMQlfTU1JTygweDI0MDgp
CiAjZGVmaW5lIE1JX1BSRURJQ0FURV9TUkMxX1VEVwlfTU1JTygweDI0MDggKyA0KQotCisjZGVm
aW5lIE1JX1BSRURJQ0FURV9EQVRBICAgICAgIF9NTUlPKDB4MjQxMCkKKyNkZWZpbmUgTUlfUFJF
RElDQVRFX1JFU1VMVCAgICAgX01NSU8oMHgyNDE4KQorI2RlZmluZSBNSV9QUkVESUNBVEVfUkVT
VUxUXzEgICBfTU1JTygweDI0MWMpCiAjZGVmaW5lIE1JX1BSRURJQ0FURV9SRVNVTFRfMglfTU1J
TygweDIyMTQpCiAjZGVmaW5lICBMT1dFUl9TTElDRV9FTkFCTEVECSgxIDw8IDApCiAjZGVmaW5l
ICBMT1dFUl9TTElDRV9ESVNBQkxFRAkoMCA8PCAwKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxmdGVzdHMuaCBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2xpdmVfc2VsZnRlc3RzLmgKaW5kZXggNjcxM2VmZWEzNTBi
Li42ZGFmNjU5OWVjNzkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pOTE1X2xpdmVfc2VsZnRlc3RzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2k5MTVfbGl2ZV9zZWxmdGVzdHMuaApAQCAtMzUsMyArMzUsNCBAQCBzZWxmdGVzdChyZXNl
dCwgaW50ZWxfcmVzZXRfbGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChoYW5nY2hlY2ssIGludGVs
X2hhbmdjaGVja19saXZlX3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KGV4ZWNsaXN0cywgaW50ZWxfZXhl
Y2xpc3RzX2xpdmVfc2VsZnRlc3RzKQogc2VsZnRlc3QoZ3VjLCBpbnRlbF9ndWNfbGl2ZV9zZWxm
dGVzdCkKK3NlbGZ0ZXN0KHBlcmYsIGk5MTVfcGVyZl9saXZlX3NlbGZ0ZXN0cykKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3BlcmYuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3BlcmYuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NApp
bmRleCAwMDAwMDAwMDAwMDAuLmRjNmQ2ODllNDI1MQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3BlcmYuYwpAQCAtMCwwICsxLDIxNiBAQAor
LyoKKyAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKKyAqCisgKiBDb3B5cmlnaHQgwqkg
MjAxOSBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpbmNsdWRlIDxsaW51eC9rcmVmLmg+CisK
KyNpbmNsdWRlICJnZW0vaTkxNV9nZW1fcG0uaCIKKyNpbmNsdWRlICJndC9pbnRlbF9ndC5oIgor
CisjaW5jbHVkZSAiaTkxNV9zZWxmdGVzdC5oIgorCisjaW5jbHVkZSAiaWd0X2ZsdXNoX3Rlc3Qu
aCIKKyNpbmNsdWRlICJsaWJfc3dfZmVuY2UuaCIKKworc3RhdGljIHN0cnVjdCBpOTE1X3BlcmZf
c3RyZWFtICoKK3Rlc3Rfc3RyZWFtKHN0cnVjdCBpOTE1X3BlcmYgKnBlcmYpCit7CisJc3RydWN0
IGRybV9pOTE1X3BlcmZfb3Blbl9wYXJhbSBwYXJhbSA9IHt9OworCXN0cnVjdCBwZXJmX29wZW5f
cHJvcGVydGllcyBwcm9wcyA9IHsKKwkJLmVuZ2luZSA9IGludGVsX2VuZ2luZV9sb29rdXBfdXNl
cihwZXJmLT5pOTE1LAorCQkJCQkJICAgSTkxNV9FTkdJTkVfQ0xBU1NfUkVOREVSLAorCQkJCQkJ
ICAgMCksCisJCS5zYW1wbGVfZmxhZ3MgPSBTQU1QTEVfT0FfUkVQT1JULAorCQkub2FfZm9ybWF0
ID0gSTkxNV9PQV9GT1JNQVRfQzRfQjgsCisJCS5tZXRyaWNzX3NldCA9IDEsCisJfTsKKwlzdHJ1
Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtOworCisJc3RyZWFtID0ga3phbGxvYyhzaXplb2Yo
KnN0cmVhbSksIEdGUF9LRVJORUwpOworCWlmICghc3RyZWFtKQorCQlyZXR1cm4gTlVMTDsKKwor
CXN0cmVhbS0+cGVyZiA9IHBlcmY7CisKKwltdXRleF9sb2NrKCZwZXJmLT5sb2NrKTsKKwlpZiAo
aTkxNV9vYV9zdHJlYW1faW5pdChzdHJlYW0sICZwYXJhbSwgJnByb3BzKSkgeworCQlrZnJlZShz
dHJlYW0pOworCQlzdHJlYW0gPSAgTlVMTDsKKwl9CisJbXV0ZXhfdW5sb2NrKCZwZXJmLT5sb2Nr
KTsKKworCXJldHVybiBzdHJlYW07Cit9CisKK3N0YXRpYyB2b2lkIHN0cmVhbV9kZXN0cm95KHN0
cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCit7CisJc3RydWN0IGk5MTVfcGVyZiAqcGVy
ZiA9IHN0cmVhbS0+cGVyZjsKKworCW11dGV4X2xvY2soJnBlcmYtPmxvY2spOworCWk5MTVfcGVy
Zl9kZXN0cm95X2xvY2tlZChzdHJlYW0pOworCW11dGV4X3VubG9jaygmcGVyZi0+bG9jayk7Cit9
CisKK3N0YXRpYyBpbnQgbGl2ZV9zYW5pdHljaGVjayh2b2lkICphcmcpCit7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CisJc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0
cmVhbTsKKworCS8qIFF1aWNrIGNoZWNrIHdlIGNhbiBjcmVhdGUgYSBwZXJmIHN0cmVhbSAqLwor
CisJc3RyZWFtID0gdGVzdF9zdHJlYW0oJmk5MTUtPnBlcmYpOworCWlmICghc3RyZWFtKQorCQly
ZXR1cm4gLUVJTlZBTDsKKworCXN0cmVhbV9kZXN0cm95KHN0cmVhbSk7CisJcmV0dXJuIDA7Cit9
CisKK3N0YXRpYyBpbnQgd3JpdGVfdGltZXN0YW1wKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBp
bnQgc2xvdCkKK3sKKwl1MzIgKmNzOworCWludCBsZW47CisKKwljcyA9IGludGVsX3JpbmdfYmVn
aW4ocnEsIDYpOworCWlmIChJU19FUlIoY3MpKQorCQlyZXR1cm4gUFRSX0VSUihjcyk7CisKKwls
ZW4gPSA1OworCWlmIChJTlRFTF9HRU4ocnEtPmk5MTUpID49IDgpCisJCWxlbisrOworCisJKmNz
KysgPSBHRlhfT1BfUElQRV9DT05UUk9MKGxlbik7CisJKmNzKysgPSBQSVBFX0NPTlRST0xfR0xP
QkFMX0dUVF9JVkIgfAorCQlQSVBFX0NPTlRST0xfU1RPUkVfREFUQV9JTkRFWCB8CisJCVBJUEVf
Q09OVFJPTF9XUklURV9USU1FU1RBTVA7CisJKmNzKysgPSBzbG90ICogc2l6ZW9mKHUzMik7CisJ
KmNzKysgPSAwOworCSpjcysrID0gMDsKKwkqY3MrKyA9IDA7CisKKwlpbnRlbF9yaW5nX2FkdmFu
Y2UocnEsIGNzKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMga3RpbWVfdCBwb2xsX3N0YXR1
cyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgaW50IHNsb3QpCit7CisJd2hpbGUgKCFpbnRlbF9y
ZWFkX3N0YXR1c19wYWdlKHJxLT5lbmdpbmUsIHNsb3QpICYmCisJICAgICAgICFpOTE1X3JlcXVl
c3RfY29tcGxldGVkKHJxKSkKKwkJY3B1X3JlbGF4KCk7CisKKwlyZXR1cm4ga3RpbWVfZ2V0KCk7
Cit9CisKK3N0YXRpYyBpbnQgbGl2ZV9ub2FfZGVsYXkodm9pZCAqYXJnKQoreworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnOworCXN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpz
dHJlYW07CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJa3RpbWVfdCB0MCwgdDE7CisJdTY0
IGV4cGVjdGVkOworCXUzMiBkZWxheTsKKwlpbnQgZXJyOworCWludCBpOworCisJLyogQ2hlY2sg
dGhhdCB0aGUgR1BVIGRlbGF5cyBtYXRjaGVzIGV4cGVjdGF0aW9ucyAqLworCisJc3RyZWFtID0g
dGVzdF9zdHJlYW0oJmk5MTUtPnBlcmYpOworCWlmICghc3RyZWFtKQorCQlyZXR1cm4gLUVOT01F
TTsKKworCWV4cGVjdGVkID0gYXRvbWljNjRfcmVhZCgmc3RyZWFtLT5wZXJmLT5ub2FfcHJvZ3Jh
bW1pbmdfZGVsYXkpOworCisJaWYgKHN0cmVhbS0+ZW5naW5lLT5jbGFzcyAhPSBSRU5ERVJfQ0xB
U1MpIHsKKwkJZXJyID0gLUVOT0RFVjsKKwkJZ290byBvdXQ7CisJfQorCisJZm9yIChpID0gMDsg
aSA8IDQ7IGkrKykKKwkJaW50ZWxfd3JpdGVfc3RhdHVzX3BhZ2Uoc3RyZWFtLT5lbmdpbmUsIDB4
MTAwICsgaSwgMCk7CisKKwlycSA9IGk5MTVfcmVxdWVzdF9jcmVhdGUoc3RyZWFtLT5lbmdpbmUt
Pmtlcm5lbF9jb250ZXh0KTsKKwlpZiAoSVNfRVJSKHJxKSkgeworCQllcnIgPSBQVFJfRVJSKHJx
KTsKKwkJZ290byBvdXQ7CisJfQorCisJaWYgKHJxLT5lbmdpbmUtPmVtaXRfaW5pdF9icmVhZGNy
dW1iICYmCisJICAgIGk5MTVfcmVxdWVzdF90aW1lbGluZShycSktPmhhc19pbml0aWFsX2JyZWFk
Y3J1bWIpIHsKKwkJZXJyID0gcnEtPmVuZ2luZS0+ZW1pdF9pbml0X2JyZWFkY3J1bWIocnEpOwor
CQlpZiAoZXJyKSB7CisJCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKwkJCWdvdG8gb3V0OworCQl9
CisJfQorCisJZXJyID0gd3JpdGVfdGltZXN0YW1wKHJxLCAweDEwMCk7CisJaWYgKGVycikgewor
CQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKwkJZ290byBvdXQ7CisJfQorCisJZXJyID0gcnEtPmVu
Z2luZS0+ZW1pdF9iYl9zdGFydChycSwKKwkJCQkJaTkxNV9nZ3R0X29mZnNldChzdHJlYW0tPm5v
YV93YWl0KSwgMCwKKwkJCQkJSTkxNV9ESVNQQVRDSF9TRUNVUkUpOworCWlmIChlcnIpIHsKKwkJ
aTkxNV9yZXF1ZXN0X2FkZChycSk7CisJCWdvdG8gb3V0OworCX0KKworCWVyciA9IHdyaXRlX3Rp
bWVzdGFtcChycSwgMHgxMDIpOworCWlmIChlcnIpIHsKKwkJaTkxNV9yZXF1ZXN0X2FkZChycSk7
CisJCWdvdG8gb3V0OworCX0KKworCWk5MTVfcmVxdWVzdF9nZXQocnEpOworCWk5MTVfcmVxdWVz
dF9hZGQocnEpOworCisJcHJlZW1wdF9kaXNhYmxlKCk7CisJdDAgPSBwb2xsX3N0YXR1cyhycSwg
MHgxMDApOworCXQxID0gcG9sbF9zdGF0dXMocnEsIDB4MTAyKTsKKwlwcmVlbXB0X2VuYWJsZSgp
OworCisJcHJfaW5mbygiQ1BVIGRlbGF5OiAlbGx1bnMsIGV4cGVjdGVkICVsbHVuc1xuIiwKKwkJ
a3RpbWVfc3ViKHQxLCB0MCksIGV4cGVjdGVkKTsKKworCWRlbGF5ID0gaW50ZWxfcmVhZF9zdGF0
dXNfcGFnZShzdHJlYW0tPmVuZ2luZSwgMHgxMDIpOworCWRlbGF5IC09IGludGVsX3JlYWRfc3Rh
dHVzX3BhZ2Uoc3RyZWFtLT5lbmdpbmUsIDB4MTAwKTsKKwlkZWxheSA9IGRpdl91NjQobXVsX3Uz
Ml91MzIoZGVsYXksIDEwMDAgKiAxMDAwKSwKKwkJCVJVTlRJTUVfSU5GTyhpOTE1KS0+Y3NfdGlt
ZXN0YW1wX2ZyZXF1ZW5jeV9raHopOworCXByX2luZm8oIkdQVSBkZWxheTogJXVucywgZXhwZWN0
ZWQgJWxsdW5zXG4iLAorCQlkZWxheSwgZXhwZWN0ZWQpOworCisJaWYgKDQgKiBkZWxheSA8IDMg
KiBleHBlY3RlZCB8fCAyICogZGVsYXkgPiAzICogZXhwZWN0ZWQpIHsKKwkJcHJfZXJyKCJHUFUg
ZGVsYXkgWyV1dXNdIG91dHNpZGUgb2YgZXhwZWN0ZWQgdGhyZXNob2xkISBbJWxsdXVzLCAlbGx1
dXNdXG4iLAorCQkgICAgICAgZGVsYXkgLyAxMDAwLAorCQkgICAgICAgZGl2X3U2NCgzICogZXhw
ZWN0ZWQsIDQwMDApLAorCQkgICAgICAgZGl2X3U2NCgzICogZXhwZWN0ZWQsIDIwMDApKTsKKwkJ
ZXJyID0gLUVJTlZBTDsKKwl9CisKKwlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKK291dDoKKwlzdHJl
YW1fZGVzdHJveShzdHJlYW0pOworCXJldHVybiBlcnI7Cit9CisKK2ludCBpOTE1X3BlcmZfbGl2
ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCit7CisJc3RhdGljIGNv
bnN0IHN0cnVjdCBpOTE1X3N1YnRlc3QgdGVzdHNbXSA9IHsKKwkJU1VCVEVTVChsaXZlX3Nhbml0
eWNoZWNrKSwKKwkJU1VCVEVTVChsaXZlX25vYV9kZWxheSksCisJfTsKKwlzdHJ1Y3QgaTkxNV9w
ZXJmICpwZXJmID0gJmk5MTUtPnBlcmY7CisKKwlpZiAoIXBlcmYtPm1ldHJpY3Nfa29iaiB8fCAh
cGVyZi0+b3BzLmVuYWJsZV9tZXRyaWNfc2V0KQorCQlyZXR1cm4gMDsKKworCWlmIChpbnRlbF9n
dF9pc193ZWRnZWQoJmk5MTUtPmd0KSkKKwkJcmV0dXJuIDA7CisKKwlyZXR1cm4gaTkxNV9zdWJ0
ZXN0cyh0ZXN0cywgaTkxNSk7Cit9Ci0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

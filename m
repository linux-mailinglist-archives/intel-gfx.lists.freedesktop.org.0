Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D4184D69C8
	for <lists+intel-gfx@lfdr.de>; Mon, 14 Oct 2019 20:55:38 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CBEDC8981B;
	Mon, 14 Oct 2019 18:55:34 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga01.intel.com (mga01.intel.com [192.55.52.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 101C98982E
 for <intel-gfx@lists.freedesktop.org>; Mon, 14 Oct 2019 18:55:33 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga005.jf.intel.com ([10.7.209.41])
 by fmsmga101.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 14 Oct 2019 11:55:31 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.67,296,1566889200"; d="scan'208";a="370213910"
Received: from orsosgc001.ra.intel.com ([10.23.184.150])
 by orsmga005.jf.intel.com with ESMTP; 14 Oct 2019 11:55:31 -0700
From: Umesh Nerlige Ramappa <umesh.nerlige.ramappa@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 14 Oct 2019 11:55:31 -0700
Message-Id: <20191014185531.62855-3-umesh.nerlige.ramappa@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20191014185531.62855-1-umesh.nerlige.ramappa@intel.com>
References: <20191014185531.62855-1-umesh.nerlige.ramappa@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 3/3] drm/i915/perf: enable OAR context
 save/restore of performance counters
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Lucas De Marchi <lucas.demarchi@intel.com>,
 Chris Wilson <chris.p.wilson@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwuY29tPgoK
V2Ugd2FudCB0aGlzIHNvIHdlIGNhbiBwcmVlbXB0IHBlcmZvcm1hbmNlIHF1ZXJpZXMgYW5kIGtl
ZXAgdGhlIHN5c3RlbQpyZXNwb25zaXZlIGV2ZW4gd2hlbiBsb25nIHJ1bm5pbmcgcXVlcmllcyBh
cmUgb25nb2luZy4gV2UgYXZvaWQgZG9pbmcKaXQgZm9yIGFsbCBjb250ZXh0cy4KClNpZ25lZC1v
ZmYtYnk6IExpb25lbCBMYW5kd2VybGluIDxsaW9uZWwuZy5sYW5kd2VybGluQGludGVsLmNvbT4K
LS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyB8IDIzICsrKysrLS0tCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuaCB8ICAzICsKIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfcGVyZi5jICAgIHwgODkgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysK
IDMgZmlsZXMgY2hhbmdlZCwgMTA3IGluc2VydGlvbnMoKyksIDggZGVsZXRpb25zKC0pCgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYwppbmRleCA5ZDhlYWY4ZWRhYWIuLjFiYWI2NzFkYzdh
MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKQEAgLTEyMTgsNiArMTIxOCwxOSBA
QCBzdGF0aWMgYm9vbCBjYW5fbWVyZ2VfcnEoY29uc3Qgc3RydWN0IGk5MTVfcmVxdWVzdCAqcHJl
diwKIAlyZXR1cm4gdHJ1ZTsKIH0KIAordTMyIGludGVsX2xyY19tYWtlX2N0eF9jb250cm9sKGNv
bnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKK3sKKwl1MzIgdmFsdWUgPQorCQlf
TUFTS0VEX0JJVF9ESVNBQkxFKENUWF9DVFJMX0VOR0lORV9DVFhfUkVTVE9SRV9JTkhJQklUKSB8
CisJCV9NQVNLRURfQklUX0VOQUJMRShDVFhfQ1RSTF9JTkhJQklUX1NZTl9DVFhfU1dJVENIKTsK
KworCWlmIChJTlRFTF9HRU4oZW5naW5lLT5pOTE1KSA8IDExKQorCQl2YWx1ZSB8PSBfTUFTS0VE
X0JJVF9ESVNBQkxFKENUWF9DVFJMX0VOR0lORV9DVFhfU0FWRV9JTkhJQklUIHwKKwkJCQkJICAg
IENUWF9DVFJMX1JTX0NUWF9FTkFCTEUpOworCisJcmV0dXJuIHZhbHVlOworfQorCiBzdGF0aWMg
dm9pZCB2aXJ0dWFsX3VwZGF0ZV9yZWdpc3Rlcl9vZmZzZXRzKHUzMiAqcmVncywKIAkJCQkJICAg
IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKQEAgLTIxMjQsNiArMjEzNyw3IEBA
IF9fZXhlY2xpc3RzX3VwZGF0ZV9yZWdfc3RhdGUoY29uc3Qgc3RydWN0IGludGVsX2NvbnRleHQg
KmNlLAogCiAJCWk5MTVfb2FfaW5pdF9yZWdfc3RhdGUoY2UsIGVuZ2luZSk7CiAJfQorCXJlZ3Nb
Q1RYX0NPTlRFWFRfQ09OVFJPTF0gfD0gaW50ZWxfbHJjX21ha2VfY3R4X2NvbnRyb2woZW5naW5l
KTsKIH0KIAogc3RhdGljIGludApAQCAtMzYyOCwxNCArMzY0Miw3IEBAIHN0YXRpYyB2b2lkIGlu
aXRfY29tbW9uX3JlZ19zdGF0ZSh1MzIgKiBjb25zdCByZWdzLAogCQkJCSAgY29uc3Qgc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCQkJCSAgY29uc3Qgc3RydWN0IGludGVsX3Jpbmcg
KnJpbmcpCiB7Ci0JcmVnc1tDVFhfQ09OVEVYVF9DT05UUk9MXSA9Ci0JCV9NQVNLRURfQklUX0RJ
U0FCTEUoQ1RYX0NUUkxfRU5HSU5FX0NUWF9SRVNUT1JFX0lOSElCSVQpIHwKLQkJX01BU0tFRF9C
SVRfRU5BQkxFKENUWF9DVFJMX0lOSElCSVRfU1lOX0NUWF9TV0lUQ0gpOwotCWlmIChJTlRFTF9H
RU4oZW5naW5lLT5pOTE1KSA8IDExKQotCQlyZWdzW0NUWF9DT05URVhUX0NPTlRST0xdIHw9Ci0J
CQlfTUFTS0VEX0JJVF9ESVNBQkxFKENUWF9DVFJMX0VOR0lORV9DVFhfU0FWRV9JTkhJQklUIHwK
LQkJCQkJICAgIENUWF9DVFJMX1JTX0NUWF9FTkFCTEUpOwotCisJcmVnc1tDVFhfQ09OVEVYVF9D
T05UUk9MXSA9IGludGVsX2xyY19tYWtlX2N0eF9jb250cm9sKGVuZ2luZSk7CiAJcmVnc1tDVFhf
UklOR19CVUZGRVJfQ09OVFJPTF0gPSBSSU5HX0NUTF9TSVpFKHJpbmctPnNpemUpIHwgUklOR19W
QUxJRDsKIAlyZWdzW0NUWF9CQl9TVEFURV0gPSBSSU5HX0JCX1BQR1RUOwogfQpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmggYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9scmMuaAppbmRleCA5OWRjNTc2YTRlMjUuLjZiMmIxOTZmMDllNyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmgKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmgKQEAgLTQzLDYgKzQzLDcgQEAgc3RydWN0IGlu
dGVsX2VuZ2luZV9jczsKICNkZWZpbmUJICBDVFhfQ1RSTF9FTkdJTkVfQ1RYX1JFU1RPUkVfSU5I
SUJJVAkoMSA8PCAwKQogI2RlZmluZSAgIENUWF9DVFJMX1JTX0NUWF9FTkFCTEUJCSgxIDw8IDEp
CiAjZGVmaW5lCSAgQ1RYX0NUUkxfRU5HSU5FX0NUWF9TQVZFX0lOSElCSVQJKDEgPDwgMikKKyNk
ZWZpbmUJICBHRU4xMl9DVFhfQ1RSTF9PQVJfQ09OVEVYVF9FTkFCTEUJKDEgPDwgOCkKICNkZWZp
bmUgUklOR19DT05URVhUX1NUQVRVU19QVFIoYmFzZSkJCV9NTUlPKChiYXNlKSArIDB4M2EwKQog
I2RlZmluZSBSSU5HX0VYRUNMSVNUX1NRX0NPTlRFTlRTKGJhc2UpCQlfTU1JTygoYmFzZSkgKyAw
eDUxMCkKICNkZWZpbmUgUklOR19FWEVDTElTVF9DT05UUk9MKGJhc2UpCQlfTU1JTygoYmFzZSkg
KyAweDU1MCkKQEAgLTE0NSw0ICsxNDYsNiBAQCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICoKIGlu
dGVsX3ZpcnR1YWxfZW5naW5lX2dldF9zaWJsaW5nKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSwKIAkJCQkgdW5zaWduZWQgaW50IHNpYmxpbmcpOwogCit1MzIgaW50ZWxfbHJjX21ha2Vf
Y3R4X2NvbnRyb2woY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKKwogI2Vu
ZGlmIC8qIF9JTlRFTF9MUkNfSF8gKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfcGVyZi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKaW5kZXggZGYz
YjY5NzZiYTViLi5kMGRkZDM3ZGMwNzggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfcGVyZi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCkBAIC0y
MjA4LDYgKzIyMDgsNzAgQEAgc3RhdGljIGludCBnZW44X2NvbmZpZ3VyZV9jb250ZXh0KHN0cnVj
dCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJcmV0dXJuIGVycjsKIH0KIAorc3RhdGljIGludCBn
ZW4xMl9lbWl0X29hcl9jb25maWcoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCBib29sIGVuYWJs
ZSkKK3sKKwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKKwl1MzIgKmNzLCBvZmZzZXQ7CisJaW50
IGVyciA9IDA7CisKKwlycSA9IGk5MTVfcmVxdWVzdF9jcmVhdGUoY2UpOworCWlmIChJU19FUlIo
cnEpKQorCQlyZXR1cm4gUFRSX0VSUihycSk7CisKKwljcyA9IGludGVsX3JpbmdfYmVnaW4ocnEs
IDQpOworCWlmIChJU19FUlIoY3MpKSB7CisJCWVyciA9IFBUUl9FUlIoY3MpOworCQlnb3RvIG91
dDsKKwl9CisKKwlvZmZzZXQgPSBpOTE1X2dndHRfb2Zmc2V0KGNlLT5zdGF0ZSkgKyBMUkNfU1RB
VEVfUE4gKiBQQUdFX1NJWkU7CisKKwkqY3MrKyA9IE1JX1NUT1JFX0RXT1JEX0lNTV9HRU40IHwg
TUlfVVNFX0dHVFQ7CisJKmNzKysgPSBvZmZzZXQgKyBDVFhfQ09OVEVYVF9DT05UUk9MICogc2l6
ZW9mKHUzMik7CisJKmNzKysgPSAwOworCSpjcysrID0gaW50ZWxfbHJjX21ha2VfY3R4X2NvbnRy
b2woY2UtPmVuZ2luZSkgfAorCQkoZW5hYmxlID8KKwkJIF9NQVNLRURfQklUX0VOQUJMRShHRU4x
Ml9DVFhfQ1RSTF9PQVJfQ09OVEVYVF9FTkFCTEUpIDoKKwkJIF9NQVNLRURfQklUX0RJU0FCTEUo
R0VOMTJfQ1RYX0NUUkxfT0FSX0NPTlRFWFRfRU5BQkxFKSk7CisKKwlpbnRlbF9yaW5nX2FkdmFu
Y2UocnEsIGNzKTsKKworb3V0OgorCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCisJcmV0dXJuIGVy
cjsKK30KKworc3RhdGljIGludCBnZW4xMl9jb25maWd1cmVfY29udGV4dF9vYXIoc3RydWN0IGk5
MTVfZ2VtX2NvbnRleHQgKmN0eCwKKwkJCQkgICAgICAgYm9vbCBlbmFibGUpCit7CisJc3RydWN0
IGk5MTVfZ2VtX2VuZ2luZXNfaXRlciBpdDsKKwlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CisJ
aW50IGVyciA9IDA7CisKKwlmb3JfZWFjaF9nZW1fZW5naW5lKGNlLCBpOTE1X2dlbV9jb250ZXh0
X2xvY2tfZW5naW5lcyhjdHgpLCBpdCkgeworCQlHRU1fQlVHX09OKGNlID09IGNlLT5lbmdpbmUt
Pmtlcm5lbF9jb250ZXh0KTsKKworCQlpZiAoY2UtPmVuZ2luZS0+Y2xhc3MgIT0gUkVOREVSX0NM
QVNTKQorCQkJY29udGludWU7CisKKwkJZXJyID0gaW50ZWxfY29udGV4dF9sb2NrX3Bpbm5lZChj
ZSk7CisJCWlmIChlcnIpCisJCQlicmVhazsKKworCQkvKiBPdGhlcndpc2UgT0Egc2V0dGluZ3Mg
d2lsbCBiZSBzZXQgdXBvbiBmaXJzdCB1c2UgKi8KKwkJaWYgKGludGVsX2NvbnRleHRfaXNfcGlu
bmVkKGNlKSkKKwkJCWVyciA9IGdlbjEyX2VtaXRfb2FyX2NvbmZpZyhjZSwgZW5hYmxlKTsKKwor
CQlpbnRlbF9jb250ZXh0X3VubG9ja19waW5uZWQoY2UpOworCQlpZiAoZXJyKQorCQkJYnJlYWs7
CisJfQorCWk5MTVfZ2VtX2NvbnRleHRfdW5sb2NrX2VuZ2luZXMoY3R4KTsKKworCXJldHVybiBl
cnI7Cit9CisKIC8qCiAgKiBNYW5hZ2VzIHVwZGF0aW5nIHRoZSBwZXItY29udGV4dCBhc3BlY3Rz
IG9mIHRoZSBPQSBzdHJlYW0KICAqIGNvbmZpZ3VyYXRpb24gYWNyb3NzIGFsbCBjb250ZXh0cy4K
QEAgLTIzMTMsNiArMjM3NywxNyBAQCBzdGF0aWMgaW50IGxyY19jb25maWd1cmVfYWxsX2NvbnRl
eHRzKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJCQlyZXR1cm4gZXJyOwogCQl9
CiAKKwkJLyoKKwkJICogRm9yIEdlbjEyLCBwZXJmb3JtYW5jZSBjb3VudGVycyBhcmUgY29udGV4
dAorCQkgKiBzYXZlZC9yZXN0b3JlZC4gT25seSBlbmFibGUgaXQgZm9yIHRoZSBjb250ZXh0IHRo
YXQKKwkJICogcmVxdWVzdGVkIHRoaXMuCisJCSAqLworCQlpZiAoY3R4ID09IHN0cmVhbS0+Y3R4
ICYmIElTX0dFTihpOTE1LCAxMikpIHsKKwkJCWVyciA9IGdlbjEyX2NvbmZpZ3VyZV9jb250ZXh0
X29hcihjdHgsIG9hX2NvbmZpZyAhPSBOVUxMKTsKKwkJCWlmIChlcnIpCisJCQkJcmV0dXJuIGVy
cjsKKwkJfQorCiAJCXNwaW5fbG9jaygmaTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOwogCQlsaXN0
X3NhZmVfcmVzZXRfbmV4dChjdHgsIGNuLCBsaW5rKTsKIAkJaTkxNV9nZW1fY29udGV4dF9wdXQo
Y3R4KTsKQEAgLTI3ODIsNiArMjg1NywyMCBAQCB2b2lkIGk5MTVfb2FfaW5pdF9yZWdfc3RhdGUo
Y29uc3Qgc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCXN0cmVhbSA9IGVuZ2luZS0+aTkxNS0+
cGVyZi5leGNsdXNpdmVfc3RyZWFtOwogCWlmIChzdHJlYW0pCiAJCWdlbjhfdXBkYXRlX3JlZ19z
dGF0ZV91bmxvY2tlZChjZSwgc3RyZWFtKTsKKworCS8qCisJICogRW5hYmxlIGNvbnRleHQgc2F2
ZSAmIHJlc3RvcmUgb2YgcGVyZm9ybWFuY2UgY291bnRlcnMgZm9yCisJICogdGhlIE9BUiB1bml0
IG9ubHkgb24gdGhlIGNvbnRleHQgc2VsZWN0ZWQgZm9yIHBlcmZvcm1hbmNlCisJICogcXVlcmll
cy4KKwkgKi8KKwlpZiAoSVNfR0VOKGVuZ2luZS0+aTkxNSwgMTIpKSB7CisJCXUzMiAqcmVncyA9
IGNlLT5scmNfcmVnX3N0YXRlOworCisJCXJlZ3NbQ1RYX0NPTlRFWFRfQ09OVFJPTF0gfD0KKwkJ
CShzdHJlYW0gJiYgY2UtPmdlbV9jb250ZXh0ID09IHN0cmVhbS0+Y3R4KSAgPworCQkJX01BU0tF
RF9CSVRfRU5BQkxFKEdFTjEyX0NUWF9DVFJMX09BUl9DT05URVhUX0VOQUJMRSkgOgorCQkJX01B
U0tFRF9CSVRfRElTQUJMRShHRU4xMl9DVFhfQ1RSTF9PQVJfQ09OVEVYVF9FTkFCTEUpOworCX0K
IH0KIAogLyoqCi0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVk
ZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZv
L2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id B9F9EE9B25
	for <lists+intel-gfx@lfdr.de>; Wed, 30 Oct 2019 12:51:47 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2374C6E96D;
	Wed, 30 Oct 2019 11:51:46 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 25F2A6E96D
 for <intel-gfx@lists.freedesktop.org>; Wed, 30 Oct 2019 11:51:43 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19018553-1500050 
 for multiple; Wed, 30 Oct 2019 11:51:37 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 30 Oct 2019 11:51:35 +0000
Message-Id: <20191030115135.3923-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0.rc1
In-Reply-To: <20191030095327.23359-3-chris@chris-wilson.co.uk>
References: <20191030095327.23359-3-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: Remove i915->kernel_context
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWxsb2NhdGUgb25seSBhbiBpbnRlcm5hbCBpbnRlbF9jb250ZXh0IGZvciB0aGUga2VybmVsX2Nv
bnRleHQsIGZvcmdvaW5nCmEgZ2xvYmFsIEdFTSBjb250ZXh0IGZvciBpbnRlcm5hbCB1c2UgYXMg
d2Ugb25seSByZXF1aXJlIGEgc2VwYXJhdGUKYWRkcmVzcyBzcGFjZSAoZm9yIG91ciBvd24gcHJv
dGVjdGlvbikuCgpOb3cgaGF2aW5nIHdlYW5lZCBHVCBmcm9tIHJlcXVpcmluZyBjZS0+Z2VtX2Nv
bnRleHQsIHdlIGNhbiBzdG9wCnJlZmVyZW5jaW5nIGl0IGVudGlyZWx5LiBUaGlzIGFsc28gbWVh
bnMgd2Ugbm8gbG9uZ2VyIGhhdmUgdG8gY3JlYXRlIHJhbmRvbQphbmQgdW5uZWNlc3NhcnkgR0VN
IGNvbnRleHRzIGZvciBpbnRlcm5hbCB1c2UuCgpHRU0gY29udGV4dHMgYXJlIG5vdyBlbnRpcmVs
eSBmb3IgdHJhY2tpbmcgR0VNIGNsaWVudHMsIGFuZCBpbnRlbF9jb250ZXh0CnRoZSBleGVjdXRp
b24gZW52aXJvbm1lbnQgb24gdGhlIEdQVS4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8
Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9jb250ZXh0LmMgICB8ICA5MSArKysrKy0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmggICB8ICAgNiArLQogLi4uL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jICAgIHwgICAzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jICAgfCAgIDYgKy0KIC4uLi9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyB8ICAgNSArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0v
c2VsZnRlc3RzL21vY2tfY29udGV4dC5jIHwgIDExICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9jb250ZXh0LmMgICAgICAgfCAgMzIgKy0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfY29udGV4dC5oICAgICAgIHwgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9lbmdpbmVfY3MuYyAgICAgfCAgMjEgKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9ndC5jICAgICAgICAgICAgfCAgMjEgKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9ndF90eXBlcy5oICAgICAgfCAgIDcgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfbHJjLmMgICAgICAgICAgIHwgIDE4ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfbHJjLmggICAgICAgICAgIHwgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9yZXNldC5jICAgICAgICAgfCAgIDYgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
cmluZ19zdWJtaXNzaW9uLmMgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfY29udGV4dC5jICAgIHwgIDU5ICsrKy0tLS0tCiAuLi4vZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfZW5naW5lX2hlYXJ0YmVhdC5jICAgfCAgIDMgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3NlbGZ0ZXN0X2hhbmdjaGVjay5jICB8ICAyOSArKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9zZWxmdGVzdF9scmMuYyAgICAgICAgfCAxMzcgKysrKysrLS0tLS0tLS0tLS0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVyLmMgICAgICAgICAgfCAgMTYgKy0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggICAgICAgICAgICAgICB8ICAgMyAtCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbS5jICAgICAgICAgICAgICAgfCAgMTYgKy0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jICAgICAgICAgICB8ICAgOCArLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3IuYyAgICAgICAgIHwgICA4ICstCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3BlcmYuYyAgICAgICAgICAgICAgfCAgIDMgLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9yZXF1ZXN0LmMgICAgICAgICAgIHwgICA1ICstCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMgfCAgIDYgKy0KIC4uLi9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jICB8ICAgOCArLQogMjggZmlsZXMgY2hhbmdlZCwg
MjExIGluc2VydGlvbnMoKyksIDMzMSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwppbmRleCA0NTU2OTBjODBkNDIuLmZmOWU2NGM1MTNl
NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCkBAIC0x
NzAsNiArMTcwLDI2IEBAIGxvb2t1cF91c2VyX2VuZ2luZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqY3R4LAogCXJldHVybiBpOTE1X2dlbV9jb250ZXh0X2dldF9lbmdpbmUoY3R4LCBpZHgpOwog
fQogCitzdGF0aWMgdm9pZCBpbnRlbF9jb250ZXh0X3NldF9nZW0oc3RydWN0IGludGVsX2NvbnRl
eHQgKmNlLAorCQkJCSAgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKK3sKKwljZS0+Z2Vt
X2NvbnRleHQgPSBjdHg7CisKKwljZS0+cmluZyA9IF9faW50ZWxfY29udGV4dF9yaW5nX3NpemUo
U1pfMTZLKTsKKworCWlmIChjdHgtPnZtKSB7CisJCWk5MTVfdm1fcHV0KGNlLT52bSk7CisJCWNl
LT52bSA9IGk5MTVfdm1fZ2V0KGN0eC0+dm0pOworCX0KKworCWlmIChjdHgtPnRpbWVsaW5lKQor
CQljZS0+dGltZWxpbmUgPSBpbnRlbF90aW1lbGluZV9nZXQoY3R4LT50aW1lbGluZSk7CisKKwlp
ZiAoY3R4LT5zY2hlZC5wcmlvcml0eSA+PSBJOTE1X1BSSU9SSVRZX05PUk1BTCAmJgorCSAgICBp
bnRlbF9lbmdpbmVfaGFzX3NlbWFwaG9yZXMoY2UtPmVuZ2luZSkpCisJCV9fc2V0X2JpdChDT05U
RVhUX1VTRV9TRU1BUEhPUkVTLCAmY2UtPmZsYWdzKTsKK30KKwogc3RhdGljIHZvaWQgX19mcmVl
X2VuZ2luZXMoc3RydWN0IGk5MTVfZ2VtX2VuZ2luZXMgKmUsIHVuc2lnbmVkIGludCBjb3VudCkK
IHsKIAl3aGlsZSAoY291bnQtLSkgewpAQCAtMjEyLDEyICsyMzIsMTQgQEAgc3RhdGljIHN0cnVj
dCBpOTE1X2dlbV9lbmdpbmVzICpkZWZhdWx0X2VuZ2luZXMoc3RydWN0IGk5MTVfZ2VtX2NvbnRl
eHQgKmN0eCkKIAkJR0VNX0JVR19PTihlbmdpbmUtPmxlZ2FjeV9pZHggPj0gSTkxNV9OVU1fRU5H
SU5FUyk7CiAJCUdFTV9CVUdfT04oZS0+ZW5naW5lc1tlbmdpbmUtPmxlZ2FjeV9pZHhdKTsKIAot
CQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGN0eCwgZW5naW5lKTsKKwkJY2UgPSBpbnRlbF9j
b250ZXh0X2NyZWF0ZShlbmdpbmUpOwogCQlpZiAoSVNfRVJSKGNlKSkgewogCQkJX19mcmVlX2Vu
Z2luZXMoZSwgZS0+bnVtX2VuZ2luZXMgKyAxKTsKIAkJCXJldHVybiBFUlJfQ0FTVChjZSk7CiAJ
CX0KIAorCQlpbnRlbF9jb250ZXh0X3NldF9nZW0oY2UsIGN0eCk7CisKIAkJZS0+ZW5naW5lc1tl
bmdpbmUtPmxlZ2FjeV9pZHhdID0gY2U7CiAJCWUtPm51bV9lbmdpbmVzID0gbWF4KGUtPm51bV9l
bmdpbmVzLCBlbmdpbmUtPmxlZ2FjeV9pZHgpOwogCX0KQEAgLTYzNCwzNyArNjU2LDYgQEAgaTkx
NV9nZW1fY3JlYXRlX2NvbnRleHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHVuc2ln
bmVkIGludCBmbGFncykKIAlyZXR1cm4gY3R4OwogfQogCi1zdGF0aWMgdm9pZAotZGVzdHJveV9r
ZXJuZWxfY29udGV4dChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqKmN0eHApCi17Ci0Jc3RydWN0
IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKLQotCS8qIEtlZXAgdGhlIGNvbnRleHQgcmVmIHNvIHRo
YXQgd2UgY2FuIGZyZWUgaXQgaW1tZWRpYXRlbHkgb3Vyc2VsdmVzICovCi0JY3R4ID0gaTkxNV9n
ZW1fY29udGV4dF9nZXQoZmV0Y2hfYW5kX3plcm8oY3R4cCkpOwotCUdFTV9CVUdfT04oIWk5MTVf
Z2VtX2NvbnRleHRfaXNfa2VybmVsKGN0eCkpOwotCi0JY29udGV4dF9jbG9zZShjdHgpOwotCWk5
MTVfZ2VtX2NvbnRleHRfZnJlZShjdHgpOwotfQotCi1zdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAq
Ci1pOTE1X2dlbV9jb250ZXh0X2NyZWF0ZV9rZXJuZWwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsIGludCBwcmlvKQotewotCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7Ci0KLQlj
dHggPSBpOTE1X2dlbV9jcmVhdGVfY29udGV4dChpOTE1LCAwKTsKLQlpZiAoSVNfRVJSKGN0eCkp
Ci0JCXJldHVybiBjdHg7Ci0KLQlpOTE1X2dlbV9jb250ZXh0X2NsZWFyX2Jhbm5hYmxlKGN0eCk7
Ci0JaTkxNV9nZW1fY29udGV4dF9zZXRfcGVyc2lzdGVuY2UoY3R4KTsKLQljdHgtPnNjaGVkLnBy
aW9yaXR5ID0gSTkxNV9VU0VSX1BSSU9SSVRZKHByaW8pOwotCi0JR0VNX0JVR19PTighaTkxNV9n
ZW1fY29udGV4dF9pc19rZXJuZWwoY3R4KSk7Ci0KLQlyZXR1cm4gY3R4OwotfQotCiBzdGF0aWMg
dm9pZCBpbml0X2NvbnRleHRzKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0cyAqZ2MpCiB7CiAJc3Bp
bl9sb2NrX2luaXQoJmdjLT5sb2NrKTsKQEAgLTY3NCwzMiArNjY1LDEyIEBAIHN0YXRpYyB2b2lk
IGluaXRfY29udGV4dHMoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHRzICpnYykKIAlpbml0X2xsaXN0
X2hlYWQoJmdjLT5mcmVlX2xpc3QpOwogfQogCi1pbnQgaTkxNV9nZW1faW5pdF9jb250ZXh0cyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3ZvaWQgaTkxNV9nZW1faW5pdF9jb250ZXh0
cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqY3R4OwotCi0JLyogUmVhc3N1cmUgb3Vyc2VsdmVzIHdlIGFyZSBvbmx5IGNhbGxlZCBv
bmNlICovCi0JR0VNX0JVR19PTihpOTE1LT5rZXJuZWxfY29udGV4dCk7Ci0KIAlpbml0X2NvbnRl
eHRzKCZpOTE1LT5nZW0uY29udGV4dHMpOwotCi0JLyogbG93ZXN0IHByaW9yaXR5OyBpZGxlIHRh
c2sgKi8KLQljdHggPSBpOTE1X2dlbV9jb250ZXh0X2NyZWF0ZV9rZXJuZWwoaTkxNSwgSTkxNV9Q
UklPUklUWV9NSU4pOwotCWlmIChJU19FUlIoY3R4KSkgewotCQlEUk1fRVJST1IoIkZhaWxlZCB0
byBjcmVhdGUgZGVmYXVsdCBnbG9iYWwgY29udGV4dFxuIik7Ci0JCXJldHVybiBQVFJfRVJSKGN0
eCk7Ci0JfQotCWk5MTUtPmtlcm5lbF9jb250ZXh0ID0gY3R4OwotCiAJRFJNX0RFQlVHX0RSSVZF
UigiJXMgY29udGV4dCBzdXBwb3J0IGluaXRpYWxpemVkXG4iLAogCQkJIERSSVZFUl9DQVBTKGk5
MTUpLT5oYXNfbG9naWNhbF9jb250ZXh0cyA/CiAJCQkgImxvZ2ljYWwiIDogImZha2UiKTsKLQly
ZXR1cm4gMDsKLX0KLQotdm9pZCBpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZV9fY29udGV4dHMoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCi17Ci0JZGVzdHJveV9rZXJuZWxfY29udGV4dCgm
aTkxNS0+a2VybmVsX2NvbnRleHQpOwogfQogCiBzdGF0aWMgaW50IGNvbnRleHRfaWRyX2NsZWFu
dXAoaW50IGlkLCB2b2lkICpwLCB2b2lkICpkYXRhKQpAQCAtMTQ1NywxMiArMTQyOCwxNCBAQCBz
ZXRfZW5naW5lc19fbG9hZF9iYWxhbmNlKHN0cnVjdCBpOTE1X3VzZXJfZXh0ZW5zaW9uIF9fdXNl
ciAqYmFzZSwgdm9pZCAqZGF0YSkKIAkJfQogCX0KIAotCWNlID0gaW50ZWxfZXhlY2xpc3RzX2Ny
ZWF0ZV92aXJ0dWFsKHNldC0+Y3R4LCBzaWJsaW5ncywgbik7CisJY2UgPSBpbnRlbF9leGVjbGlz
dHNfY3JlYXRlX3ZpcnR1YWwoc2libGluZ3MsIG4pOwogCWlmIChJU19FUlIoY2UpKSB7CiAJCWVy
ciA9IFBUUl9FUlIoY2UpOwogCQlnb3RvIG91dF9zaWJsaW5nczsKIAl9CiAKKwlpbnRlbF9jb250
ZXh0X3NldF9nZW0oY2UsIHNldC0+Y3R4KTsKKwogCWlmIChjbXB4Y2hnKCZzZXQtPmVuZ2luZXMt
PmVuZ2luZXNbaWR4XSwgTlVMTCwgY2UpKSB7CiAJCWludGVsX2NvbnRleHRfcHV0KGNlKTsKIAkJ
ZXJyID0gLUVFWElTVDsKQEAgLTE2MzIsMTIgKzE2MDUsMTQgQEAgc2V0X2VuZ2luZXMoc3RydWN0
IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJCXJldHVybiAtRU5PRU5UOwogCQl9CiAKLQkJY2Ug
PSBpbnRlbF9jb250ZXh0X2NyZWF0ZShjdHgsIGVuZ2luZSk7CisJCWNlID0gaW50ZWxfY29udGV4
dF9jcmVhdGUoZW5naW5lKTsKIAkJaWYgKElTX0VSUihjZSkpIHsKIAkJCV9fZnJlZV9lbmdpbmVz
KHNldC5lbmdpbmVzLCBuKTsKIAkJCXJldHVybiBQVFJfRVJSKGNlKTsKIAkJfQogCisJCWludGVs
X2NvbnRleHRfc2V0X2dlbShjZSwgY3R4KTsKKwogCQlzZXQuZW5naW5lcy0+ZW5naW5lc1tuXSA9
IGNlOwogCX0KIAlzZXQuZW5naW5lcy0+bnVtX2VuZ2luZXMgPSBudW1fZW5naW5lczsKQEAgLTE5
MzgsMTMgKzE5MTMsMTUgQEAgc3RhdGljIGludCBjbG9uZV9lbmdpbmVzKHN0cnVjdCBpOTE1X2dl
bV9jb250ZXh0ICpkc3QsCiAJCSAqLwogCQlpZiAoaW50ZWxfZW5naW5lX2lzX3ZpcnR1YWwoZW5n
aW5lKSkKIAkJCWNsb25lLT5lbmdpbmVzW25dID0KLQkJCQlpbnRlbF9leGVjbGlzdHNfY2xvbmVf
dmlydHVhbChkc3QsIGVuZ2luZSk7CisJCQkJaW50ZWxfZXhlY2xpc3RzX2Nsb25lX3ZpcnR1YWwo
ZW5naW5lKTsKIAkJZWxzZQotCQkJY2xvbmUtPmVuZ2luZXNbbl0gPSBpbnRlbF9jb250ZXh0X2Ny
ZWF0ZShkc3QsIGVuZ2luZSk7CisJCQljbG9uZS0+ZW5naW5lc1tuXSA9IGludGVsX2NvbnRleHRf
Y3JlYXRlKGVuZ2luZSk7CiAJCWlmIChJU19FUlJfT1JfTlVMTChjbG9uZS0+ZW5naW5lc1tuXSkp
IHsKIAkJCV9fZnJlZV9lbmdpbmVzKGNsb25lLCBuKTsKIAkJCWdvdG8gZXJyX3VubG9jazsKIAkJ
fQorCisJCWludGVsX2NvbnRleHRfc2V0X2dlbShjbG9uZS0+ZW5naW5lc1tuXSwgZHN0KTsKIAl9
CiAJY2xvbmUtPm51bV9lbmdpbmVzID0gbjsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9jb250ZXh0LmgKaW5kZXggNjk5MzI4OTk4MDNlLi5kOTlmZmY0ODFkNTkgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmgKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaApAQCAtMTE1LDggKzEx
NSw3IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBpOTE1X2dlbV9jb250ZXh0X2lzX2tlcm5lbChzdHJ1
Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQogfQogCiAvKiBpOTE1X2dlbV9jb250ZXh0LmMgKi8K
LWludCBfX211c3RfY2hlY2sgaTkxNV9nZW1faW5pdF9jb250ZXh0cyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSk7Ci12b2lkIGk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNlX19jb250ZXh0cyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Cit2b2lkIGk5MTVfZ2VtX2luaXRfY29udGV4
dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwogCiBpbnQgaTkxNV9nZW1fY29udGV4
dF9vcGVuKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICBzdHJ1Y3QgZHJtX2Zp
bGUgKmZpbGUpOwpAQCAtMTQwLDkgKzEzOSw2IEBAIGludCBpOTE1X2dlbV9jb250ZXh0X3NldHBh
cmFtX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiBpbnQgaTkxNV9n
ZW1fY29udGV4dF9yZXNldF9zdGF0c19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lk
ICpkYXRhLAogCQkJCSAgICAgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpOwogCi1zdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dCAqCi1pOTE1X2dlbV9jb250ZXh0X2NyZWF0ZV9rZXJuZWwoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsIGludCBwcmlvKTsKLQogc3RhdGljIGlubGluZSBzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqCiBpOTE1X2dlbV9jb250ZXh0X2dldChzdHJ1Y3QgaTkxNV9nZW1f
Y29udGV4dCAqY3R4KQogewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX2V4ZWNidWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9l
eGVjYnVmZmVyLmMKaW5kZXggNmRjODZjMTI5ZWVlLi40ZjZiODQ3ZWEwMTEgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYwpAQCAtMTI2MSw4ICsx
MjYxLDcgQEAgc3RhdGljIHUzMiAqcmVsb2NfZ3B1KHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmVi
LAogCQkJICogbWVtb3J5IGxvY2F0aW9uLgogCQkJICovCiAJCQlpZiAoY2FjaGUtPmdlbiA+PSAx
MikKLQkJCQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGViLT5jb250ZXh0LT5nZW1fY29udGV4
dCwKLQkJCQkJCQkgIGViLT5lbmdpbmUpOworCQkJCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUo
ZWItPmVuZ2luZSk7CiAJCQllbHNlCiAJCQkJY2UgPSBpbnRlbF9jb250ZXh0X2dldChlYi0+Y29u
dGV4dCk7CiAJCQlpZiAoSVNfRVJSKGNlKSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fdXNlcnB0ci5jCmluZGV4IDFlMDQ1YzMzNzA0NC4uNDMyZjI4MjhiMDkzIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMKQEAgLTc1MywxNSArNzUz
LDExIEBAIGk5MTVfZ2VtX3VzZXJwdHJfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJ
cmV0dXJuIC1FRkFVTFQ7CiAKIAlpZiAoYXJncy0+ZmxhZ3MgJiBJOTE1X1VTRVJQVFJfUkVBRF9P
TkxZKSB7Ci0JCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwotCiAJCS8qCiAJCSAqIE9u
IGFsbW9zdCBhbGwgb2YgdGhlIG9sZGVyIGh3LCB3ZSBjYW5ub3QgdGVsbCB0aGUgR1BVIHRoYXQK
IAkJICogYSBwYWdlIGlzIHJlYWRvbmx5LgogCQkgKi8KLQkJdm0gPSByY3VfZGVyZWZlcmVuY2Vf
cHJvdGVjdGVkKGRldl9wcml2LT5rZXJuZWxfY29udGV4dC0+dm0sCi0JCQkJCSAgICAgICB0cnVl
KTsgLyogc3RhdGljIHZtICovCi0JCWlmICghdm0gfHwgIXZtLT5oYXNfcmVhZF9vbmx5KQorCQlp
ZiAoIWRldl9wcml2LT5ndC52bS0+aGFzX3JlYWRfb25seSkKIAkJCXJldHVybiAtRU5PREVWOwog
CX0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1
X2dlbV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVf
Z2VtX2NvbnRleHQuYwppbmRleCBjNmU2MTU2NGJiNWUuLjZkMTc0Y2FhOGY4YiAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0
LmMKQEAgLTMwOSw3ICszMDksNyBAQCBzdGF0aWMgaW50IGxpdmVfcGFyYWxsZWxfc3dpdGNoKHZv
aWQgKmFyZykKIAkJCWlmICghZGF0YVttXS5jZVswXSkKIAkJCQljb250aW51ZTsKIAotCQkJY2Ug
PSBpbnRlbF9jb250ZXh0X2NyZWF0ZShjdHgsIGRhdGFbbV0uY2VbMF0tPmVuZ2luZSk7CisJCQlj
ZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGRhdGFbbV0uY2VbMF0tPmVuZ2luZSk7CiAJCQlpZiAo
SVNfRVJSKGNlKSkKIAkJCQlnb3RvIG91dDsKIApAQCAtMTIzMCw4ICsxMjMwLDcgQEAgX19pZ3Rf
Y3R4X3NzZXUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQlod2VpZ2h0MzIoZW5n
aW5lLT5zc2V1LnNsaWNlX21hc2spLAogCQkJaHdlaWdodDMyKHBnX3NzZXUuc2xpY2VfbWFzaykp
OwogCi0JCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lLT5rZXJuZWxfY29udGV4dC0+
Z2VtX2NvbnRleHQsCi0JCQkJCSAgZW5naW5lKTsKKwkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0
ZShlbmdpbmUpOwogCQlpZiAoSVNfRVJSKGNlKSkgewogCQkJcmV0ID0gUFRSX0VSUihjZSk7CiAJ
CQlnb3RvIG91dF9wdXQ7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL21vY2tfY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0
cy9tb2NrX2NvbnRleHQuYwppbmRleCAyOWI4OTg0ZjBlNDcuLmY0NzJmYzkyNDBkNSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL21vY2tfY29udGV4dC5jCkBA
IC05Nyw3ICs5NywxNiBAQCBsaXZlX2NvbnRleHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKIHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICoKIGtl
cm5lbF9jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXJldHVybiBp
OTE1X2dlbV9jb250ZXh0X2NyZWF0ZV9rZXJuZWwoaTkxNSwgSTkxNV9QUklPUklUWV9OT1JNQUwp
OworCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CisKKwljdHggPSBpOTE1X2dlbV9jcmVh
dGVfY29udGV4dChpOTE1LCAwKTsKKwlpZiAoSVNfRVJSKGN0eCkpCisJCXJldHVybiBjdHg7CisK
KwlHRU1fQlVHX09OKCFpOTE1X2dlbV9jb250ZXh0X2lzX2tlcm5lbChjdHgpKTsKKwlpOTE1X2dl
bV9jb250ZXh0X2NsZWFyX2Jhbm5hYmxlKGN0eCk7CisKKwlyZXR1cm4gY3R4OwogfQogCiB2b2lk
IGtlcm5lbF9jb250ZXh0X2Nsb3NlKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKaW5kZXggNzA3NWQwM2Y1MDhmLi44Yjcx
YjJjY2JmMjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRl
eHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKQEAgLTMx
LDggKzMxLDcgQEAgdm9pZCBpbnRlbF9jb250ZXh0X2ZyZWUoc3RydWN0IGludGVsX2NvbnRleHQg
KmNlKQogfQogCiBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqCi1pbnRlbF9jb250ZXh0X2NyZWF0ZShz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAotCQkgICAgIHN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmVuZ2luZSkKK2ludGVsX2NvbnRleHRfY3JlYXRlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAKQEAgLTQwLDcgKzM5LDcg
QEAgaW50ZWxfY29udGV4dF9jcmVhdGUoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAlp
ZiAoIWNlKQogCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKIAotCWludGVsX2NvbnRleHRfaW5p
dChjZSwgY3R4LCBlbmdpbmUpOworCWludGVsX2NvbnRleHRfaW5pdChjZSwgZW5naW5lKTsKIAly
ZXR1cm4gY2U7CiB9CiAKQEAgLTcyLDggKzcxLDYgQEAgaW50IF9faW50ZWxfY29udGV4dF9kb19w
aW4oc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogCQkJICBjZS0+ZW5naW5lLT5uYW1lLCBjZS0+
dGltZWxpbmUtPmZlbmNlX2NvbnRleHQsCiAJCQkgIGNlLT5yaW5nLT5oZWFkLCBjZS0+cmluZy0+
dGFpbCk7CiAKLQkJaTkxNV9nZW1fY29udGV4dF9nZXQoY2UtPmdlbV9jb250ZXh0KTsgLyogZm9y
IGN0eC0+cHBndHQgKi8KLQogCQlzbXBfbWJfX2JlZm9yZV9hdG9taWMoKTsgLyogZmx1c2ggcGlu
IGJlZm9yZSBpdCBpcyB2aXNpYmxlICovCiAJfQogCkBAIC0xMDMsNyArMTAwLDYgQEAgdm9pZCBp
bnRlbF9jb250ZXh0X3VucGluKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIAogCQljZS0+b3Bz
LT51bnBpbihjZSk7CiAKLQkJaTkxNV9nZW1fY29udGV4dF9wdXQoY2UtPmdlbV9jb250ZXh0KTsK
IAkJaW50ZWxfY29udGV4dF9hY3RpdmVfcmVsZWFzZShjZSk7CiAJfQogCkBAIC0xOTgsNyArMTk0
LDcgQEAgaW50IGludGVsX2NvbnRleHRfYWN0aXZlX2FjcXVpcmUoc3RydWN0IGludGVsX2NvbnRl
eHQgKmNlKQogCQlyZXR1cm4gZXJyOwogCiAJLyogUHJlYWxsb2NhdGUgdHJhY2tpbmcgbm9kZXMg
Ki8KLQlpZiAoIWk5MTVfZ2VtX2NvbnRleHRfaXNfa2VybmVsKGNlLT5nZW1fY29udGV4dCkpIHsK
KwlpZiAoY2UtPmdlbV9jb250ZXh0KSB7CiAJCWVyciA9IGk5MTVfYWN0aXZlX2FjcXVpcmVfcHJl
YWxsb2NhdGVfYmFycmllcigmY2UtPmFjdGl2ZSwKIAkJCQkJCQkgICAgICBjZS0+ZW5naW5lKTsK
IAkJaWYgKGVycikgewpAQCAtMjE5LDMzICsyMTUsMTkgQEAgdm9pZCBpbnRlbF9jb250ZXh0X2Fj
dGl2ZV9yZWxlYXNlKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIAogdm9pZAogaW50ZWxfY29u
dGV4dF9pbml0KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKLQkJICAgc3RydWN0IGk5MTVfZ2Vt
X2NvbnRleHQgKmN0eCwKIAkJICAgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewot
CXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwotCiAJR0VNX0JVR19PTighZW5naW5lLT5j
b3BzKTsKKwlHRU1fQlVHX09OKCFlbmdpbmUtPmd0LT52bSk7CiAKIAlrcmVmX2luaXQoJmNlLT5y
ZWYpOwogCi0JY2UtPmdlbV9jb250ZXh0ID0gY3R4OwotCXJjdV9yZWFkX2xvY2soKTsKLQl2bSA9
IHJjdV9kZXJlZmVyZW5jZShjdHgtPnZtKTsKLQlpZiAodm0pCi0JCWNlLT52bSA9IGk5MTVfdm1f
Z2V0KHZtKTsKLQllbHNlCi0JCWNlLT52bSA9IGk5MTVfdm1fZ2V0KCZlbmdpbmUtPmd0LT5nZ3R0
LT52bSk7Ci0JcmN1X3JlYWRfdW5sb2NrKCk7Ci0JaWYgKGN0eC0+dGltZWxpbmUpCi0JCWNlLT50
aW1lbGluZSA9IGludGVsX3RpbWVsaW5lX2dldChjdHgtPnRpbWVsaW5lKTsKLQlpZiAoY3R4LT5z
Y2hlZC5wcmlvcml0eSA+PSBJOTE1X1BSSU9SSVRZX05PUk1BTCAmJgotCSAgICBpbnRlbF9lbmdp
bmVfaGFzX3NlbWFwaG9yZXMoZW5naW5lKSkKLQkJX19zZXRfYml0KENPTlRFWFRfVVNFX1NFTUFQ
SE9SRVMsICZjZS0+ZmxhZ3MpOwotCiAJY2UtPmVuZ2luZSA9IGVuZ2luZTsKIAljZS0+b3BzID0g
ZW5naW5lLT5jb3BzOwogCWNlLT5zc2V1ID0gZW5naW5lLT5zc2V1OwotCWNlLT5yaW5nID0gX19p
bnRlbF9jb250ZXh0X3Jpbmdfc2l6ZShTWl8xNkspOworCWNlLT5yaW5nID0gX19pbnRlbF9jb250
ZXh0X3Jpbmdfc2l6ZShTWl80Syk7CisKKwljZS0+dm0gPSBpOTE1X3ZtX2dldChlbmdpbmUtPmd0
LT52bSk7CiAKIAlJTklUX0xJU1RfSEVBRCgmY2UtPnNpZ25hbF9saW5rKTsKIAlJTklUX0xJU1Rf
SEVBRCgmY2UtPnNpZ25hbHMpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfY29udGV4dC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5o
CmluZGV4IGQ3YjY2N2EyNmUwOC4uMTViYzQ2ZTFiMzA4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfY29udGV4dC5oCkBAIC0xOCwxMyArMTgsMTEgQEAKICNpbmNsdWRlICJpbnRlbF90
aW1lbGluZV90eXBlcy5oIgogCiB2b2lkIGludGVsX2NvbnRleHRfaW5pdChzdHJ1Y3QgaW50ZWxf
Y29udGV4dCAqY2UsCi0JCQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogCQkJc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKIHZvaWQgaW50ZWxfY29udGV4dF9maW5pKHN0cnVj
dCBpbnRlbF9jb250ZXh0ICpjZSk7CiAKIHN0cnVjdCBpbnRlbF9jb250ZXh0ICoKLWludGVsX2Nv
bnRleHRfY3JlYXRlKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCi0JCSAgICAgc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKK2ludGVsX2NvbnRleHRfY3JlYXRlKHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSk7CiAKIHZvaWQgaW50ZWxfY29udGV4dF9mcmVlKHN0cnVj
dCBpbnRlbF9jb250ZXh0ICpjZSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2VuZ2luZV9jcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5n
aW5lX2NzLmMKaW5kZXggZWZkZTNmOGUwNTU5Li5iMzhlYTQ0YWI3NjEgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jCkBAIC03NTYsMTIgKzc1NiwxMCBAQCBjcmVh
dGVfa2VybmVsX2NvbnRleHQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCXN0cnVj
dCBpbnRlbF9jb250ZXh0ICpjZTsKIAlpbnQgZXJyOwogCi0JY2UgPSBpbnRlbF9jb250ZXh0X2Ny
ZWF0ZShlbmdpbmUtPmk5MTUtPmtlcm5lbF9jb250ZXh0LCBlbmdpbmUpOworCWNlID0gaW50ZWxf
Y29udGV4dF9jcmVhdGUoZW5naW5lKTsKIAlpZiAoSVNfRVJSKGNlKSkKIAkJcmV0dXJuIGNlOwog
Ci0JY2UtPnJpbmcgPSBfX2ludGVsX2NvbnRleHRfcmluZ19zaXplKFNaXzRLKTsKLQogCWVyciA9
IGludGVsX2NvbnRleHRfcGluKGNlKTsKIAlpZiAoZXJyKSB7CiAJCWludGVsX2NvbnRleHRfcHV0
KGNlKTsKQEAgLTc5Nyw2ICs3OTUsMTIgQEAgaW50IGludGVsX2VuZ2luZV9pbml0X2NvbW1vbihz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAKIAllbmdpbmUtPnNldF9kZWZhdWx0X3N1
Ym1pc3Npb24oZW5naW5lKTsKIAorCXJldCA9IG1lYXN1cmVfYnJlYWRjcnVtYl9kdyhlbmdpbmUp
OworCWlmIChyZXQgPCAwKQorCQlyZXR1cm4gcmV0OworCisJZW5naW5lLT5lbWl0X2ZpbmlfYnJl
YWRjcnVtYl9kdyA9IHJldDsKKwogCS8qCiAJICogV2UgbWF5IG5lZWQgdG8gZG8gdGhpbmdzIHdp
dGggdGhlIHNocmlua2VyIHdoaWNoCiAJICogcmVxdWlyZSB1cyB0byBpbW1lZGlhdGVseSBzd2l0
Y2ggYmFjayB0byB0aGUgZGVmYXVsdApAQCAtODExLDE4ICs4MTUsNyBAQCBpbnQgaW50ZWxfZW5n
aW5lX2luaXRfY29tbW9uKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAogCWVuZ2lu
ZS0+a2VybmVsX2NvbnRleHQgPSBjZTsKIAotCXJldCA9IG1lYXN1cmVfYnJlYWRjcnVtYl9kdyhl
bmdpbmUpOwotCWlmIChyZXQgPCAwKQotCQlnb3RvIGVycl91bnBpbjsKLQotCWVuZ2luZS0+ZW1p
dF9maW5pX2JyZWFkY3J1bWJfZHcgPSByZXQ7Ci0KIAlyZXR1cm4gMDsKLQotZXJyX3VucGluOgot
CWludGVsX2NvbnRleHRfdW5waW4oY2UpOwotCWludGVsX2NvbnRleHRfcHV0KGNlKTsKLQlyZXR1
cm4gcmV0OwogfQogCiAvKioKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2d0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jCmluZGV4IGYyNDQw
MTEzZmRmOC4uODliNjI5NTYxZDUzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9ndC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0LmMKQEAg
LTY5LDcgKzY5LDYgQEAgaW50IGludGVsX2d0X2luaXRfaHcoc3RydWN0IGludGVsX2d0ICpndCkK
IAlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSBndC0+dW5jb3JlOwogCWludCByZXQ7CiAK
LQlCVUdfT04oIWk5MTUtPmtlcm5lbF9jb250ZXh0KTsKIAlyZXQgPSBpbnRlbF9ndF90ZXJtaW5h
bGx5X3dlZGdlZChndCk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKQEAgLTM3MCw3ICszNjks
MjAgQEAgaW50IGludGVsX2d0X2luaXQoc3RydWN0IGludGVsX2d0ICpndCkKIAogCWludGVsX2d0
X3BtX2luaXQoZ3QpOwogCisJaWYgKElOVEVMX1BQR1RUKGd0LT5pOTE1KSA+IElOVEVMX1BQR1RU
X0FMSUFTSU5HKQorCQlndC0+dm0gPSAmaTkxNV9wcGd0dF9jcmVhdGUoZ3QtPmk5MTUpLT52bTsK
KwllbHNlCisJCWd0LT52bSA9IGk5MTVfdm1fZ2V0KCZndC0+Z2d0dC0+dm0pOworCWlmICghZ3Qt
PnZtKSB7CisJCWVyciA9IC1FTk9NRU07CisJCWdvdG8gZXJyX3NjcmF0Y2g7CisJfQorCiAJcmV0
dXJuIDA7CisKK2Vycl9zY3JhdGNoOgorCWludGVsX2d0X2Zpbmlfc2NyYXRjaChndCk7CisJcmV0
dXJuIGVycjsKIH0KIAogdm9pZCBpbnRlbF9ndF9kcml2ZXJfcmVtb3ZlKHN0cnVjdCBpbnRlbF9n
dCAqZ3QpCkBAIC0zODUsNiArMzk3LDEzIEBAIHZvaWQgaW50ZWxfZ3RfZHJpdmVyX3VucmVnaXN0
ZXIoc3RydWN0IGludGVsX2d0ICpndCkKIAogdm9pZCBpbnRlbF9ndF9kcml2ZXJfcmVsZWFzZShz
dHJ1Y3QgaW50ZWxfZ3QgKmd0KQogeworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwor
CisJdm0gPSBmZXRjaF9hbmRfemVybygmZ3QtPnZtKTsKKwlpZiAoIXZtKSAvKiBGSVhNRSBiZWlu
ZyBjYWxsZWQgdHdpY2Ugb24gZXJyb3IgcGF0aHMgOiggKi8KKwkJcmV0dXJuOworCisJaTkxNV92
bV9wdXQodm0pOwogCWludGVsX2d0X3BtX2ZpbmkoZ3QpOwogCWludGVsX2d0X2Zpbmlfc2NyYXRj
aChndCk7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90
eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaAppbmRleCBk
NGUxNGRiZDE3MmUuLjk2ODkwZGQxMmI1ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9ndF90eXBlcy5oCkBAIC05MCw2ICs5MCwxMyBAQCBzdHJ1Y3QgaW50ZWxfZ3QgewogCXN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZVtJOTE1X05VTV9FTkdJTkVTXTsKIAlzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmVfY2xhc3NbTUFYX0VOR0lORV9DTEFTUyArIDFdCiAJCQkJCSAg
ICBbTUFYX0VOR0lORV9JTlNUQU5DRSArIDFdOworCisJLyoKKwkgKiBEZWZhdWx0IGFkZHJlc3Mg
c3BhY2UgKGVpdGhlciBHR1RUIG9yIHBwR1RUIGRlcGVuZGluZyBvbiBhcmNoKS4KKwkgKgorCSAq
IFJlc2VydmVkIGZvciBleGNsdXNpdmUgdXNlIGJ5IHRoZSBrZXJuZWwuCisJICovCisJc3RydWN0
IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CiB9OwogCiBlbnVtIGludGVsX2d0X3NjcmF0Y2hfZmll
bGQgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYwppbmRleCA1YjIzYWViNTAzODUuLjI0
MmU2OTI3Njc1YyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJj
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKQEAgLTEzMywxMiAr
MTMzLDExIEBACiAgKi8KICNpbmNsdWRlIDxsaW51eC9pbnRlcnJ1cHQuaD4KIAotI2luY2x1ZGUg
ImdlbS9pOTE1X2dlbV9jb250ZXh0LmgiCi0KICNpbmNsdWRlICJpOTE1X2Rydi5oIgogI2luY2x1
ZGUgImk5MTVfcGVyZi5oIgogI2luY2x1ZGUgImk5MTVfdHJhY2UuaCIKICNpbmNsdWRlICJpOTE1
X3ZncHUuaCIKKyNpbmNsdWRlICJpbnRlbF9jb250ZXh0LmgiCiAjaW5jbHVkZSAiaW50ZWxfZW5n
aW5lX3BtLmgiCiAjaW5jbHVkZSAiaW50ZWxfZ3QuaCIKICNpbmNsdWRlICJpbnRlbF9ndF9wbS5o
IgpAQCAtNDM5Myw4ICs0MzkyLDcgQEAgdmlydHVhbF9ib25kX2V4ZWN1dGUoc3RydWN0IGk5MTVf
cmVxdWVzdCAqcnEsIHN0cnVjdCBkbWFfZmVuY2UgKnNpZ25hbCkKIH0KIAogc3RydWN0IGludGVs
X2NvbnRleHQgKgotaW50ZWxfZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFsKHN0cnVjdCBpOTE1X2dl
bV9jb250ZXh0ICpjdHgsCi0JCQkgICAgICAgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqKnNpYmxp
bmdzLAoraW50ZWxfZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFsKHN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKipzaWJsaW5ncywKIAkJCSAgICAgICB1bnNpZ25lZCBpbnQgY291bnQpCiB7CiAJc3RydWN0
IHZpcnR1YWxfZW5naW5lICp2ZTsKQEAgLTQ0MDUsMTMgKzQ0MDMsMTMgQEAgaW50ZWxfZXhlY2xp
c3RzX2NyZWF0ZV92aXJ0dWFsKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCXJldHVy
biBFUlJfUFRSKC1FSU5WQUwpOwogCiAJaWYgKGNvdW50ID09IDEpCi0JCXJldHVybiBpbnRlbF9j
b250ZXh0X2NyZWF0ZShjdHgsIHNpYmxpbmdzWzBdKTsKKwkJcmV0dXJuIGludGVsX2NvbnRleHRf
Y3JlYXRlKHNpYmxpbmdzWzBdKTsKIAogCXZlID0ga3phbGxvYyhzdHJ1Y3Rfc2l6ZSh2ZSwgc2li
bGluZ3MsIGNvdW50KSwgR0ZQX0tFUk5FTCk7CiAJaWYgKCF2ZSkKIAkJcmV0dXJuIEVSUl9QVFIo
LUVOT01FTSk7CiAKLQl2ZS0+YmFzZS5pOTE1ID0gY3R4LT5pOTE1OworCXZlLT5iYXNlLmk5MTUg
PSBzaWJsaW5nc1swXS0+aTkxNTsKIAl2ZS0+YmFzZS5ndCA9IHNpYmxpbmdzWzBdLT5ndDsKIAl2
ZS0+YmFzZS51bmNvcmUgPSBzaWJsaW5nc1swXS0+dW5jb3JlOwogCXZlLT5iYXNlLmlkID0gLTE7
CkBAIC00NDU0LDcgKzQ0NTIsNyBAQCBpbnRlbF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1YWwoc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJICAgICB2aXJ0dWFsX3N1Ym1pc3Npb25fdGFz
a2xldCwKIAkJICAgICAodW5zaWduZWQgbG9uZyl2ZSk7CiAKLQlpbnRlbF9jb250ZXh0X2luaXQo
JnZlLT5jb250ZXh0LCBjdHgsICZ2ZS0+YmFzZSk7CisJaW50ZWxfY29udGV4dF9pbml0KCZ2ZS0+
Y29udGV4dCwgJnZlLT5iYXNlKTsKIAogCWZvciAobiA9IDA7IG4gPCBjb3VudDsgbisrKSB7CiAJ
CXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKnNpYmxpbmcgPSBzaWJsaW5nc1tuXTsKQEAgLTQ1MzUs
MTQgKzQ1MzMsMTIgQEAgaW50ZWxfZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFsKHN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICpjdHgsCiB9CiAKIHN0cnVjdCBpbnRlbF9jb250ZXh0ICoKLWludGVsX2V4
ZWNsaXN0c19jbG9uZV92aXJ0dWFsKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCi0JCQkg
ICAgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpzcmMpCitpbnRlbF9leGVjbGlzdHNfY2xvbmVf
dmlydHVhbChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpzcmMpCiB7CiAJc3RydWN0IHZpcnR1YWxf
ZW5naW5lICpzZSA9IHRvX3ZpcnR1YWxfZW5naW5lKHNyYyk7CiAJc3RydWN0IGludGVsX2NvbnRl
eHQgKmRzdDsKIAotCWRzdCA9IGludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChjdHgsCi0J
CQkJCSAgICAgc2UtPnNpYmxpbmdzLAorCWRzdCA9IGludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmly
dHVhbChzZS0+c2libGluZ3MsCiAJCQkJCSAgICAgc2UtPm51bV9zaWJsaW5ncyk7CiAJaWYgKElT
X0VSUihkc3QpKQogCQlyZXR1cm4gZHN0OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfbHJjLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuaApp
bmRleCBmYWEyZDU2YzI3OWIuLmZhYTQ5NmVlNzFiZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfbHJjLmgKQEAgLTEzMCwxMyArMTMwLDExIEBAIHZvaWQgaW50ZWxfZXhlY2xpc3RzX3Nob3df
cmVxdWVzdHMoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCQkJCSAgIHVuc2lnbmVk
IGludCBtYXgpOwogCiBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqCi1pbnRlbF9leGVjbGlzdHNfY3Jl
YXRlX3ZpcnR1YWwoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKLQkJCSAgICAgICBzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICoqc2libGluZ3MsCitpbnRlbF9leGVjbGlzdHNfY3JlYXRlX3Zp
cnR1YWwoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqKnNpYmxpbmdzLAogCQkJICAgICAgIHVuc2ln
bmVkIGludCBjb3VudCk7CiAKIHN0cnVjdCBpbnRlbF9jb250ZXh0ICoKLWludGVsX2V4ZWNsaXN0
c19jbG9uZV92aXJ0dWFsKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCi0JCQkgICAgICBz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpzcmMpOworaW50ZWxfZXhlY2xpc3RzX2Nsb25lX3ZpcnR1
YWwoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqc3JjKTsKIAogaW50IGludGVsX3ZpcnR1YWxfZW5n
aW5lX2F0dGFjaF9ib25kKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAkJCQkgICAg
IGNvbnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKm1hc3RlciwKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9yZXNldC5jCmluZGV4IGI0YzBhZDRhNjA4MS4uOThlN2JiYTU5NzllIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZXNldC5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMKQEAgLTg2LDYgKzg2LDkgQEAgc3RhdGljIGJv
b2wgbWFya19ndWlsdHkoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJYm9vbCBiYW5uZWQ7CiAJ
aW50IGk7CiAKKwlpZiAoIWN0eCkKKwkJcmV0dXJuIGZhbHNlOworCiAJYXRvbWljX2luYygmY3R4
LT5ndWlsdHlfY291bnQpOwogCiAJLyogQ29vbCBjb250ZXh0cyBhcmUgdG9vIGNvb2wgdG8gYmUg
YmFubmVkISAoVXNlZCBmb3IgcmVzZXQgdGVzdGluZy4pICovCkBAIC0xMTUsNyArMTE4LDggQEAg
c3RhdGljIGJvb2wgbWFya19ndWlsdHkoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAKIHN0YXRp
YyB2b2lkIG1hcmtfaW5ub2NlbnQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7Ci0JYXRvbWlj
X2luYygmcnEtPmNvbnRleHQtPmdlbV9jb250ZXh0LT5hY3RpdmVfY291bnQpOworCWlmIChycS0+
Y29udGV4dC0+Z2VtX2NvbnRleHQpCisJCWF0b21pY19pbmMoJnJxLT5jb250ZXh0LT5nZW1fY29u
dGV4dC0+YWN0aXZlX2NvdW50KTsKIH0KIAogdm9pZCBfX2k5MTVfcmVxdWVzdF9yZXNldChzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycSwgYm9vbCBndWlsdHkpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nX3N1Ym1pc3Npb24uYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX3Jpbmdfc3VibWlzc2lvbi5jCmluZGV4IDFjMmYzYzNhODg0MC4uNmRkZmU4
YTg2ZGJlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nX3N1
Ym1pc3Npb24uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nX3N1Ym1p
c3Npb24uYwpAQCAtMTU1OCw3ICsxNTU4LDcgQEAgc3RhdGljIGludCByZW1hcF9sMyhzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycSkKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4ID0gcnEtPmNv
bnRleHQtPmdlbV9jb250ZXh0OwogCWludCBpLCBlcnI7CiAKLQlpZiAoIWN0eC0+cmVtYXBfc2xp
Y2UpCisJaWYgKCFjdHggfHwgIWN0eC0+cmVtYXBfc2xpY2UpCiAJCXJldHVybiAwOwogCiAJZm9y
IChpID0gMDsgaSA8IE1BWF9MM19TTElDRVM7IGkrKykgewpAQCAtMTYwMSw3ICsxNjAxLDcgQEAg
c3RhdGljIGludCBzd2l0Y2hfY29udGV4dChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAkJICog
aXMgcHVyZWx5IHVzZWQgZm9yIGZsdXNoaW5nIHVzZXIgY29udGV4dHMuCiAJCSAqLwogCQlod19m
bGFncyA9IDA7Ci0JCWlmIChpOTE1X2dlbV9jb250ZXh0X2lzX2tlcm5lbChycS0+Y29udGV4dC0+
Z2VtX2NvbnRleHQpKQorCQlpZiAoIXJxLT5jb250ZXh0LT5nZW1fY29udGV4dCkKIAkJCWh3X2Zs
YWdzID0gTUlfUkVTVE9SRV9JTkhJQklUOwogCiAJCXJldCA9IG1pX3NldF9jb250ZXh0KHJxLCBo
d19mbGFncyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9j
b250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKaW5k
ZXggZjYzYTI2YTNlNjIwLi42YjcwNDg2MzZjNDMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9zZWxmdGVzdF9jb250ZXh0LmMKQEAgLTY3LDE1ICs2NywxNCBAQCBzdGF0aWMgaW50IGNvbnRl
eHRfc3luYyhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAJcmV0dXJuIGVycjsKIH0KIAotc3Rh
dGljIGludCBfX2xpdmVfY29udGV4dF9zaXplKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZSwKLQkJCSAgICAgICBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqZml4bWUpCitzdGF0aWMgaW50
IF9fbGl2ZV9jb250ZXh0X3NpemUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewog
CXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAl2
b2lkICp2YWRkcjsKIAlpbnQgZXJyOwogCi0JY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShmaXht
ZSwgZW5naW5lKTsKKwljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CiAJaWYgKElT
X0VSUihjZSkpCiAJCXJldHVybiBQVFJfRVJSKGNlKTsKIApAQCAtMTQ2LDcgKzE0NSw2IEBAIHN0
YXRpYyBpbnQgbGl2ZV9jb250ZXh0X3NpemUodm9pZCAqYXJnKQogewogCXN0cnVjdCBpbnRlbF9n
dCAqZ3QgPSBhcmc7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCXN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0ICpmaXhtZTsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKIAlpbnQg
ZXJyID0gMDsKIApAQCAtMTU1LDEwICsxNTMsNiBAQCBzdGF0aWMgaW50IGxpdmVfY29udGV4dF9z
aXplKHZvaWQgKmFyZykKIAkgKiBIVyB0cmllcyB0byB3cml0ZSBwYXN0IHRoZSBlbmQgb2Ygb25l
LgogCSAqLwogCi0JZml4bWUgPSBrZXJuZWxfY29udGV4dChndC0+aTkxNSk7Ci0JaWYgKElTX0VS
UihmaXhtZSkpCi0JCXJldHVybiBQVFJfRVJSKGZpeG1lKTsKLQogCWZvcl9lYWNoX2VuZ2luZShl
bmdpbmUsIGd0LCBpZCkgewogCQlzdHJ1Y3QgewogCQkJc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKnN0YXRlOwpAQCAtMTgzLDcgKzE3Nyw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9jb250ZXh0X3Np
emUodm9pZCAqYXJnKQogCQkvKiBPdmVybGFwcyB3aXRoIHRoZSBleGVjbGlzdHMgcmVkem9uZSAq
LwogCQllbmdpbmUtPmNvbnRleHRfc2l6ZSArPSBJOTE1X0dUVF9QQUdFX1NJWkU7CiAKLQkJZXJy
ID0gX19saXZlX2NvbnRleHRfc2l6ZShlbmdpbmUsIGZpeG1lKTsKKwkJZXJyID0gX19saXZlX2Nv
bnRleHRfc2l6ZShlbmdpbmUpOwogCiAJCWVuZ2luZS0+Y29udGV4dF9zaXplIC09IEk5MTVfR1RU
X1BBR0VfU0laRTsKIApAQCAtMTk2LDEyICsxOTAsMTAgQEAgc3RhdGljIGludCBsaXZlX2NvbnRl
eHRfc2l6ZSh2b2lkICphcmcpCiAJCQlicmVhazsKIAl9CiAKLQlrZXJuZWxfY29udGV4dF9jbG9z
ZShmaXhtZSk7CiAJcmV0dXJuIGVycjsKIH0KIAotc3RhdGljIGludCBfX2xpdmVfYWN0aXZlX2Nv
bnRleHQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAotCQkJCSBzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqZml4bWUpCitzdGF0aWMgaW50IF9fbGl2ZV9hY3RpdmVfY29udGV4dChzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7CiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNl
OwogCWludCBwYXNzOwpAQCAtMjI2LDEwICsyMTgsMTUgQEAgc3RhdGljIGludCBfX2xpdmVfYWN0
aXZlX2NvbnRleHQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCQlyZXR1cm4gLUVJ
TlZBTDsKIAl9CiAKLQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGZpeG1lLCBlbmdpbmUpOwor
CWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKIAlpZiAoSVNfRVJSKGNlKSkKIAkJ
cmV0dXJuIFBUUl9FUlIoY2UpOwogCisJLyogUHJldGVuZCB0byBiZSBhIHVzZXIgY29udGV4dCB0
byBwYXJ0YWtlIGluIGlkbGUgYmFycmllcnMgKi8KKwljZS0+Z2VtX2NvbnRleHQgPSBrZXJuZWxf
Y29udGV4dChlbmdpbmUtPmk5MTUpOworCWlmIChJU19FUlIoY2UtPmdlbV9jb250ZXh0KSkKKwkJ
Z290byBlcnJfY2U7CisKIAlmb3IgKHBhc3MgPSAwOyBwYXNzIDw9IDI7IHBhc3MrKykgewogCQlz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIApAQCAtMjgyLDYgKzI3OSw4IEBAIHN0YXRpYyBpbnQg
X19saXZlX2FjdGl2ZV9jb250ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAl9
CiAKIGVycjoKKwlrZXJuZWxfY29udGV4dF9jbG9zZShjZS0+Z2VtX2NvbnRleHQpOworZXJyX2Nl
OgogCWludGVsX2NvbnRleHRfcHV0KGNlKTsKIAlyZXR1cm4gZXJyOwogfQpAQCAtMjkwLDcgKzI4
OSw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9hY3RpdmVfY29udGV4dCh2b2lkICphcmcpCiB7CiAJc3Ry
dWN0IGludGVsX2d0ICpndCA9IGFyZzsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7
Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmZpeG1lOwogCWVudW0gaW50ZWxfZW5naW5lX2lk
IGlkOwogCXN0cnVjdCBkcm1fZmlsZSAqZmlsZTsKIAlpbnQgZXJyID0gMDsKQEAgLTI5OSwxNCAr
Mjk3LDggQEAgc3RhdGljIGludCBsaXZlX2FjdGl2ZV9jb250ZXh0KHZvaWQgKmFyZykKIAlpZiAo
SVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKIAotCWZpeG1lID0gbGl2ZV9j
b250ZXh0KGd0LT5pOTE1LCBmaWxlKTsKLQlpZiAoSVNfRVJSKGZpeG1lKSkgewotCQllcnIgPSBQ
VFJfRVJSKGZpeG1lKTsKLQkJZ290byBvdXRfZmlsZTsKLQl9Ci0KIAlmb3JfZWFjaF9lbmdpbmUo
ZW5naW5lLCBndCwgaWQpIHsKLQkJZXJyID0gX19saXZlX2FjdGl2ZV9jb250ZXh0KGVuZ2luZSwg
Zml4bWUpOworCQllcnIgPSBfX2xpdmVfYWN0aXZlX2NvbnRleHQoZW5naW5lKTsKIAkJaWYgKGVy
cikKIAkJCWJyZWFrOwogCkBAIC0zMTUsNyArMzA3LDYgQEAgc3RhdGljIGludCBsaXZlX2FjdGl2
ZV9jb250ZXh0KHZvaWQgKmFyZykKIAkJCWJyZWFrOwogCX0KIAotb3V0X2ZpbGU6CiAJbW9ja19m
aWxlX2ZyZWUoZ3QtPmk5MTUsIGZpbGUpOwogCXJldHVybiBlcnI7CiB9CkBAIC0zNDgsOCArMzM5
LDcgQEAgc3RhdGljIGludCBfX3JlbW90ZV9zeW5jKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwg
c3RydWN0IGludGVsX2NvbnRleHQgKnJlbW90ZSkKIAlyZXR1cm4gZXJyOwogfQogCi1zdGF0aWMg
aW50IF9fbGl2ZV9yZW1vdGVfY29udGV4dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUs
Ci0JCQkJIHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpmaXhtZSkKK3N0YXRpYyBpbnQgX19saXZl
X3JlbW90ZV9jb250ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKIAlzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqbG9jYWwsICpyZW1vdGU7CiAJaW50IHBhc3M7CkBAIC0zNjMsMTEg
KzM1MywxNiBAQCBzdGF0aWMgaW50IF9fbGl2ZV9yZW1vdGVfY29udGV4dChzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmUsCiAJICogY2xvYmJlciB0aGUgaWRsZS1iYXJyaWVyLgogCSAqLwog
Ci0JcmVtb3RlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZml4bWUsIGVuZ2luZSk7CisJcmVtb3Rl
ID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKIAlpZiAoSVNfRVJSKHJlbW90ZSkpCiAJ
CXJldHVybiBQVFJfRVJSKHJlbW90ZSk7CiAKLQlsb2NhbCA9IGludGVsX2NvbnRleHRfY3JlYXRl
KGZpeG1lLCBlbmdpbmUpOworCS8qIFByZXRlbmQgdG8gYmUgYSB1c2VyIGNvbnRleHQgdG8gcGFy
dGFrZSBpbiBpZGxlIGJhcnJpZXJzICovCisJcmVtb3RlLT5nZW1fY29udGV4dCA9IGtlcm5lbF9j
b250ZXh0KGVuZ2luZS0+aTkxNSk7CisJaWYgKElTX0VSUihyZW1vdGUtPmdlbV9jb250ZXh0KSkK
KwkJZ290byBlcnJfcmVtb3RlX2NlOworCisJbG9jYWwgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShl
bmdpbmUpOwogCWlmIChJU19FUlIobG9jYWwpKSB7CiAJCWVyciA9IFBUUl9FUlIobG9jYWwpOwog
CQlnb3RvIGVycl9yZW1vdGU7CkBAIC0zOTIsNiArMzg3LDggQEAgc3RhdGljIGludCBfX2xpdmVf
cmVtb3RlX2NvbnRleHQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCiAJaW50ZWxf
Y29udGV4dF9wdXQobG9jYWwpOwogZXJyX3JlbW90ZToKKwlrZXJuZWxfY29udGV4dF9jbG9zZShy
ZW1vdGUtPmdlbV9jb250ZXh0KTsKK2Vycl9yZW1vdGVfY2U6CiAJaW50ZWxfY29udGV4dF9wdXQo
cmVtb3RlKTsKIAlyZXR1cm4gZXJyOwogfQpAQCAtNDAwLDcgKzM5Nyw2IEBAIHN0YXRpYyBpbnQg
bGl2ZV9yZW1vdGVfY29udGV4dCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGludGVsX2d0ICpndCA9
IGFyZzsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7Ci0Jc3RydWN0IGk5MTVfZ2Vt
X2NvbnRleHQgKmZpeG1lOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwogCXN0cnVjdCBkcm1f
ZmlsZSAqZmlsZTsKIAlpbnQgZXJyID0gMDsKQEAgLTQwOSwxNCArNDA1LDggQEAgc3RhdGljIGlu
dCBsaXZlX3JlbW90ZV9jb250ZXh0KHZvaWQgKmFyZykKIAlpZiAoSVNfRVJSKGZpbGUpKQogCQly
ZXR1cm4gUFRSX0VSUihmaWxlKTsKIAotCWZpeG1lID0gbGl2ZV9jb250ZXh0KGd0LT5pOTE1LCBm
aWxlKTsKLQlpZiAoSVNfRVJSKGZpeG1lKSkgewotCQllcnIgPSBQVFJfRVJSKGZpeG1lKTsKLQkJ
Z290byBvdXRfZmlsZTsKLQl9Ci0KIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwgaWQpIHsK
LQkJZXJyID0gX19saXZlX3JlbW90ZV9jb250ZXh0KGVuZ2luZSwgZml4bWUpOworCQllcnIgPSBf
X2xpdmVfcmVtb3RlX2NvbnRleHQoZW5naW5lKTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCkBA
IC00MjUsNyArNDE1LDYgQEAgc3RhdGljIGludCBsaXZlX3JlbW90ZV9jb250ZXh0KHZvaWQgKmFy
ZykKIAkJCWJyZWFrOwogCX0KIAotb3V0X2ZpbGU6CiAJbW9ja19maWxlX2ZyZWUoZ3QtPmk5MTUs
IGZpbGUpOwogCXJldHVybiBlcnI7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF9lbmdpbmVfaGVhcnRiZWF0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9zZWxmdGVzdF9lbmdpbmVfaGVhcnRiZWF0LmMKaW5kZXggMTU1YzUwODAyNGRmLi45ZTczNzZi
NTkyZTUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2lu
ZV9oZWFydGJlYXQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9lbmdp
bmVfaGVhcnRiZWF0LmMKQEAgLTE2OSw4ICsxNjksNyBAQCBzdGF0aWMgaW50IF9fbGl2ZV9oZWFy
dGJlYXRfZmFzdChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJaW50IGVycjsKIAlp
bnQgaTsKIAotCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lLT5rZXJuZWxfY29udGV4
dC0+Z2VtX2NvbnRleHQsCi0JCQkJICBlbmdpbmUpOworCWNlID0gaW50ZWxfY29udGV4dF9jcmVh
dGUoZW5naW5lKTsKIAlpZiAoSVNfRVJSKGNlKSkKIAkJcmV0dXJuIFBUUl9FUlIoY2UpOwogCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jCmluZGV4IDhhYmMw
YTFkNjkyYi4uNGY4Y2QzY2JiOGJkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9zZWxmdGVzdF9oYW5nY2hlY2suYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF9oYW5nY2hlY2suYwpAQCAtMzc3LDM2ICszNzcsMzAgQEAgc3RhdGljIGludCBpZ3RfcmVz
ZXRfbm9wKHZvaWQgKmFyZykKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwogCXN0cnVjdCBp
OTE1X2dwdV9lcnJvciAqZ2xvYmFsID0gJmd0LT5pOTE1LT5ncHVfZXJyb3I7CiAJc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CiAJ
dW5zaWduZWQgaW50IHJlc2V0X2NvdW50LCBjb3VudDsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBp
ZDsKLQlzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGU7CiAJSUdUX1RJTUVPVVQoZW5kX3RpbWUpOwogCWlu
dCBlcnIgPSAwOwogCiAJLyogQ2hlY2sgdGhhdCB3ZSBjYW4gcmVzZXQgZHVyaW5nIG5vbi11c2Vy
IHBvcnRpb25zIG9mIHJlcXVlc3RzICovCiAKLQlmaWxlID0gbW9ja19maWxlKGd0LT5pOTE1KTsK
LQlpZiAoSVNfRVJSKGZpbGUpKQotCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKLQotCWN0eCA9IGxp
dmVfY29udGV4dChndC0+aTkxNSwgZmlsZSk7Ci0JaWYgKElTX0VSUihjdHgpKSB7Ci0JCWVyciA9
IFBUUl9FUlIoY3R4KTsKLQkJZ290byBvdXQ7Ci0JfQotCi0JaTkxNV9nZW1fY29udGV4dF9jbGVh
cl9iYW5uYWJsZShjdHgpOwogCXJlc2V0X2NvdW50ID0gaTkxNV9yZXNldF9jb3VudChnbG9iYWwp
OwogCWNvdW50ID0gMDsKIAlkbyB7CiAJCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkg
eworCQkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCQkJaW50IGk7CiAKKwkJCWNlID0gaW50
ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKKwkJCWlmIChJU19FUlIoY2UpKSB7CisJCQkJZXJy
ID0gUFRSX0VSUihjZSk7CisJCQkJYnJlYWs7CisJCQl9CisKIAkJCWZvciAoaSA9IDA7IGkgPCAx
NjsgaSsrKSB7CiAJCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CiAKLQkJCQlycSA9IGlndF9y
ZXF1ZXN0X2FsbG9jKGN0eCwgZW5naW5lKTsKKwkJCQlycSA9IGludGVsX2NvbnRleHRfY3JlYXRl
X3JlcXVlc3QoY2UpOwogCQkJCWlmIChJU19FUlIocnEpKSB7CiAJCQkJCWVyciA9IFBUUl9FUlIo
cnEpOwogCQkJCQlicmVhazsKQEAgLTQxNCw2ICs0MDgsOCBAQCBzdGF0aWMgaW50IGlndF9yZXNl
dF9ub3Aodm9pZCAqYXJnKQogCiAJCQkJaTkxNV9yZXF1ZXN0X2FkZChycSk7CiAJCQl9CisKKwkJ
CWludGVsX2NvbnRleHRfcHV0KGNlKTsKIAkJfQogCiAJCWlndF9nbG9iYWxfcmVzZXRfbG9jayhn
dCk7CkBAIC00MzcsMTAgKzQzMyw3IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X25vcCh2b2lkICph
cmcpCiAJfSB3aGlsZSAodGltZV9iZWZvcmUoamlmZmllcywgZW5kX3RpbWUpKTsKIAlwcl9pbmZv
KCIlczogJWQgcmVzZXRzXG4iLCBfX2Z1bmNfXywgY291bnQpOwogCi0JZXJyID0gaWd0X2ZsdXNo
X3Rlc3QoZ3QtPmk5MTUpOwotb3V0OgotCW1vY2tfZmlsZV9mcmVlKGd0LT5pOTE1LCBmaWxlKTsK
LQlpZiAoaW50ZWxfZ3RfaXNfd2VkZ2VkKGd0KSkKKwlpZiAoaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5
MTUpKQogCQllcnIgPSAtRUlPOwogCXJldHVybiBlcnI7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3NlbGZ0ZXN0X2xyYy5jCmluZGV4IDk1NTA0YzQ4Y2Q5OS4uMDRkMGRkNmE5MzhhIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwpAQCAtNTMsMTEgKzUzLDEwIEBAIHN0YXRp
YyBzdHJ1Y3QgaTkxNV92bWEgKmNyZWF0ZV9zY3JhdGNoKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiBz
dGF0aWMgaW50IGxpdmVfc2FuaXR5Y2hlY2sodm9pZCAqYXJnKQogewogCXN0cnVjdCBpbnRlbF9n
dCAqZ3QgPSBhcmc7Ci0Jc3RydWN0IGk5MTVfZ2VtX2VuZ2luZXNfaXRlciBpdDsKLQlzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqY3R4OwotCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKKwlzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CisJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAJ
c3RydWN0IGlndF9zcGlubmVyIHNwaW47Ci0JaW50IGVyciA9IC1FTk9NRU07CisJaW50IGVyciA9
IDA7CiAKIAlpZiAoIUhBU19MT0dJQ0FMX1JJTkdfQ09OVEVYVFMoZ3QtPmk5MTUpKQogCQlyZXR1
cm4gMDsKQEAgLTY1LDE3ICs2NCwyMCBAQCBzdGF0aWMgaW50IGxpdmVfc2FuaXR5Y2hlY2sodm9p
ZCAqYXJnKQogCWlmIChpZ3Rfc3Bpbm5lcl9pbml0KCZzcGluLCBndCkpCiAJCXJldHVybiAtRU5P
TUVNOwogCi0JY3R4ID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOwotCWlmICghY3R4KQotCQln
b3RvIGVycl9zcGluOwotCi0JZm9yX2VhY2hfZ2VtX2VuZ2luZShjZSwgaTkxNV9nZW1fY29udGV4
dF9sb2NrX2VuZ2luZXMoY3R4KSwgaXQpIHsKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwg
aWQpIHsKKwkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycTsKIAorCQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CisJCWlmIChJU19F
UlIoY2UpKSB7CisJCQllcnIgPSBQVFJfRVJSKGNlKTsKKwkJCWJyZWFrOworCQl9CisKIAkJcnEg
PSBpZ3Rfc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmc3BpbiwgY2UsIE1JX05PT1ApOwogCQlpZiAo
SVNfRVJSKHJxKSkgewogCQkJZXJyID0gUFRSX0VSUihycSk7Ci0JCQlnb3RvIGVycl9jdHg7CisJ
CQlnb3RvIG91dF9jdHg7CiAJCX0KIAogCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKQEAgLTg0LDIx
ICs4NiwyMSBAQCBzdGF0aWMgaW50IGxpdmVfc2FuaXR5Y2hlY2sodm9pZCAqYXJnKQogCQkJR0VN
X1RSQUNFX0RVTVAoKTsKIAkJCWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOwogCQkJZXJyID0gLUVJ
TzsKLQkJCWdvdG8gZXJyX2N0eDsKKwkJCWdvdG8gb3V0X2N0eDsKIAkJfQogCiAJCWlndF9zcGlu
bmVyX2VuZCgmc3Bpbik7CiAJCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpIHsKIAkJCWVy
ciA9IC1FSU87Ci0JCQlnb3RvIGVycl9jdHg7CisJCQlnb3RvIG91dF9jdHg7CiAJCX0KKworb3V0
X2N0eDoKKwkJaW50ZWxfY29udGV4dF9wdXQoY2UpOworCQlpZiAoZXJyKQorCQkJYnJlYWs7CiAJ
fQogCi0JZXJyID0gMDsKLWVycl9jdHg6Ci0JaTkxNV9nZW1fY29udGV4dF91bmxvY2tfZW5naW5l
cyhjdHgpOwotCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7Ci1lcnJfc3BpbjoKIAlpZ3Rfc3Bp
bm5lcl9maW5pKCZzcGluKTsKIAlyZXR1cm4gZXJyOwogfQpAQCAtMTQ0LDcgKzE0Niw3IEBAIHN0
YXRpYyBpbnQgbGl2ZV91bmxpdGVfcmVzdG9yZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBpbnQgcHJp
bykKIAkJZm9yIChuID0gMDsgbiA8IEFSUkFZX1NJWkUoY2UpOyBuKyspIHsKIAkJCXN0cnVjdCBp
bnRlbF9jb250ZXh0ICp0bXA7CiAKLQkJCXRtcCA9IGludGVsX2NvbnRleHRfY3JlYXRlKGN0eCwg
ZW5naW5lKTsKKwkJCXRtcCA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CiAJCQlpZiAo
SVNfRVJSKHRtcCkpIHsKIAkJCQllcnIgPSBQVFJfRVJSKHRtcCk7CiAJCQkJZ290byBlcnJfY2U7
CkBAIC0zMDksMTcgKzMxMSwxNyBAQCBlbWl0X3NlbWFwaG9yZV9jaGFpbihzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpycSwgc3RydWN0IGk5MTVfdm1hICp2bWEsIGludCBpZHgpCiBzdGF0aWMgc3RydWN0
IGk5MTVfcmVxdWVzdCAqCiBzZW1hcGhvcmVfcXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lLCBzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgaW50IGlkeCkKIHsKLQlzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqY3R4OworCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAlzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpycTsKIAlpbnQgZXJyOwogCi0JY3R4ID0ga2VybmVsX2NvbnRleHQoZW5naW5l
LT5pOTE1KTsKLQlpZiAoIWN0eCkKLQkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisJY2UgPSBp
bnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUpOworCWlmIChJU19FUlIoY2UpKQorCQlyZXR1cm4g
RVJSX0NBU1QoY2UpOwogCi0JcnEgPSBpZ3RfcmVxdWVzdF9hbGxvYyhjdHgsIGVuZ2luZSk7CisJ
cnEgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZV9yZXF1ZXN0KGNlKTsKIAlpZiAoSVNfRVJSKHJxKSkK
LQkJZ290byBvdXRfY3R4OworCQlnb3RvIG91dF9jZTsKIAogCWVyciA9IDA7CiAJaWYgKHJxLT5l
bmdpbmUtPmVtaXRfaW5pdF9icmVhZGNydW1iKQpAQCAtMzMyLDggKzMzNCw4IEBAIHNlbWFwaG9y
ZV9xdWV1ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIHN0cnVjdCBpOTE1X3ZtYSAq
dm1hLCBpbnQgaWR4KQogCWlmIChlcnIpCiAJCXJxID0gRVJSX1BUUihlcnIpOwogCi1vdXRfY3R4
OgotCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7CitvdXRfY2U6CisJaW50ZWxfY29udGV4dF9w
dXQoY2UpOwogCXJldHVybiBycTsKIH0KIApAQCAtMjM5MCwyNyArMjM5MiwxNyBAQCBzdGF0aWMg
aW50IG5vcF92aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogewogCUlHVF9USU1F
T1VUKGVuZF90aW1lKTsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0WzE2XTsKLQlzdHJ1
Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4WzE2XTsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqdmVb
MTZdOwogCXVuc2lnbmVkIGxvbmcgbiwgcHJpbWUsIG5jOwogCXN0cnVjdCBpZ3RfbGl2ZV90ZXN0
IHQ7CiAJa3RpbWVfdCB0aW1lc1syXSA9IHt9OwogCWludCBlcnI7CiAKLQlHRU1fQlVHX09OKCFu
Y3R4IHx8IG5jdHggPiBBUlJBWV9TSVpFKGN0eCkpOworCUdFTV9CVUdfT04oIW5jdHggfHwgbmN0
eCA+IEFSUkFZX1NJWkUodmUpKTsKIAogCWZvciAobiA9IDA7IG4gPCBuY3R4OyBuKyspIHsKLQkJ
Y3R4W25dID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOwotCQlpZiAoIWN0eFtuXSkgewotCQkJ
ZXJyID0gLUVOT01FTTsKLQkJCW5jdHggPSBuOwotCQkJZ290byBvdXQ7Ci0JCX0KLQotCQl2ZVtu
XSA9IGludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChjdHhbbl0sCi0JCQkJCQkgICAgICAg
c2libGluZ3MsIG5zaWJsaW5nKTsKKwkJdmVbbl0gPSBpbnRlbF9leGVjbGlzdHNfY3JlYXRlX3Zp
cnR1YWwoc2libGluZ3MsIG5zaWJsaW5nKTsKIAkJaWYgKElTX0VSUih2ZVtuXSkpIHsKLQkJCWtl
cm5lbF9jb250ZXh0X2Nsb3NlKGN0eFtuXSk7CiAJCQllcnIgPSBQVFJfRVJSKHZlW25dKTsKIAkJ
CW5jdHggPSBuOwogCQkJZ290byBvdXQ7CkBAIC0yNDE5LDcgKzI0MTEsNiBAQCBzdGF0aWMgaW50
IG5vcF92aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCQllcnIgPSBpbnRlbF9j
b250ZXh0X3Bpbih2ZVtuXSk7CiAJCWlmIChlcnIpIHsKIAkJCWludGVsX2NvbnRleHRfcHV0KHZl
W25dKTsKLQkJCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eFtuXSk7CiAJCQluY3R4ID0gbjsKIAkJ
CWdvdG8gb3V0OwogCQl9CkBAIC0yNTAwLDcgKzI0OTEsNiBAQCBzdGF0aWMgaW50IG5vcF92aXJ0
dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCWZvciAobmMgPSAwOyBuYyA8IG5jdHg7
IG5jKyspIHsKIAkJaW50ZWxfY29udGV4dF91bnBpbih2ZVtuY10pOwogCQlpbnRlbF9jb250ZXh0
X3B1dCh2ZVtuY10pOwotCQlrZXJuZWxfY29udGV4dF9jbG9zZShjdHhbbmNdKTsKIAl9CiAJcmV0
dXJuIGVycjsKIH0KQEAgLTI1NTksNyArMjU0OSw2IEBAIHN0YXRpYyBpbnQgbWFza192aXJ0dWFs
X2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCQkJICAgICAgIHVuc2lnbmVkIGludCBuc2li
bGluZykKIHsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0W01BWF9FTkdJTkVfSU5TVEFO
Q0UgKyAxXTsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwogCXN0cnVjdCBpbnRlbF9j
b250ZXh0ICp2ZTsKIAlzdHJ1Y3QgaWd0X2xpdmVfdGVzdCB0OwogCXVuc2lnbmVkIGludCBuOwpA
QCAtMjU3MCwxMSArMjU1OSw3IEBAIHN0YXRpYyBpbnQgbWFza192aXJ0dWFsX2VuZ2luZShzdHJ1
Y3QgaW50ZWxfZ3QgKmd0LAogCSAqIHJlc3RyaWN0IGl0IHRvIG91ciBkZXNpcmVkIGVuZ2luZSB3
aXRoaW4gdGhlIHZpcnR1YWwgZW5naW5lLgogCSAqLwogCi0JY3R4ID0ga2VybmVsX2NvbnRleHQo
Z3QtPmk5MTUpOwotCWlmICghY3R4KQotCQlyZXR1cm4gLUVOT01FTTsKLQotCXZlID0gaW50ZWxf
ZXhlY2xpc3RzX2NyZWF0ZV92aXJ0dWFsKGN0eCwgc2libGluZ3MsIG5zaWJsaW5nKTsKKwl2ZSA9
IGludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChzaWJsaW5ncywgbnNpYmxpbmcpOwogCWlm
IChJU19FUlIodmUpKSB7CiAJCWVyciA9IFBUUl9FUlIodmUpOwogCQlnb3RvIG91dF9jbG9zZTsK
QEAgLTI2NDIsNyArMjYyNyw2IEBAIHN0YXRpYyBpbnQgbWFza192aXJ0dWFsX2VuZ2luZShzdHJ1
Y3QgaW50ZWxfZ3QgKmd0LAogb3V0X3B1dDoKIAlpbnRlbF9jb250ZXh0X3B1dCh2ZSk7CiBvdXRf
Y2xvc2U6Ci0Ja2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKIAlyZXR1cm4gZXJyOwogfQogCkBA
IC0yNjgyLDcgKzI2NjYsNiBAQCBzdGF0aWMgaW50IHByZXNlcnZlZF92aXJ0dWFsX2VuZ2luZShz
dHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCQkJCSAgICB1bnNpZ25lZCBpbnQgbnNpYmxpbmcpCiB7CiAJ
c3RydWN0IGk5MTVfcmVxdWVzdCAqbGFzdCA9IE5VTEw7Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRl
eHQgKmN0eDsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqdmU7CiAJc3RydWN0IGk5MTVfdm1hICpz
Y3JhdGNoOwogCXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7CkBAIC0yNjkwLDE3ICsyNjczLDExIEBA
IHN0YXRpYyBpbnQgcHJlc2VydmVkX3ZpcnR1YWxfZW5naW5lKHN0cnVjdCBpbnRlbF9ndCAqZ3Qs
CiAJaW50IGVyciA9IDA7CiAJdTMyICpjczsKIAotCWN0eCA9IGtlcm5lbF9jb250ZXh0KGd0LT5p
OTE1KTsKLQlpZiAoIWN0eCkKLQkJcmV0dXJuIC1FTk9NRU07Ci0KIAlzY3JhdGNoID0gY3JlYXRl
X3NjcmF0Y2goc2libGluZ3NbMF0tPmd0KTsKLQlpZiAoSVNfRVJSKHNjcmF0Y2gpKSB7Ci0JCWVy
ciA9IFBUUl9FUlIoc2NyYXRjaCk7Ci0JCWdvdG8gb3V0X2Nsb3NlOwotCX0KKwlpZiAoSVNfRVJS
KHNjcmF0Y2gpKQorCQlyZXR1cm4gUFRSX0VSUihzY3JhdGNoKTsKIAotCXZlID0gaW50ZWxfZXhl
Y2xpc3RzX2NyZWF0ZV92aXJ0dWFsKGN0eCwgc2libGluZ3MsIG5zaWJsaW5nKTsKKwl2ZSA9IGlu
dGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChzaWJsaW5ncywgbnNpYmxpbmcpOwogCWlmIChJ
U19FUlIodmUpKSB7CiAJCWVyciA9IFBUUl9FUlIodmUpOwogCQlnb3RvIG91dF9zY3JhdGNoOwpA
QCAtMjc4Myw4ICsyNzYwLDYgQEAgc3RhdGljIGludCBwcmVzZXJ2ZWRfdmlydHVhbF9lbmdpbmUo
c3RydWN0IGludGVsX2d0ICpndCwKIAlpbnRlbF9jb250ZXh0X3B1dCh2ZSk7CiBvdXRfc2NyYXRj
aDoKIAlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmc2NyYXRjaCwgMCk7Ci1vdXRfY2xvc2U6
Ci0Ja2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKIAlyZXR1cm4gZXJyOwogfQogCkBAIC0yODc4
LDkgKzI4NTMsNyBAQCBzdGF0aWMgaW50IGJvbmRfdmlydHVhbF9lbmdpbmUoc3RydWN0IGludGVs
X2d0ICpndCwKIAkJZm9yIChuID0gMDsgbiA8IG5zaWJsaW5nOyBuKyspIHsKIAkJCXN0cnVjdCBp
bnRlbF9jb250ZXh0ICp2ZTsKIAotCQkJdmUgPSBpbnRlbF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1
YWwoY3R4LAotCQkJCQkJCSAgICBzaWJsaW5ncywKLQkJCQkJCQkgICAgbnNpYmxpbmcpOworCQkJ
dmUgPSBpbnRlbF9leGVjbGlzdHNfY3JlYXRlX3ZpcnR1YWwoc2libGluZ3MsIG5zaWJsaW5nKTsK
IAkJCWlmIChJU19FUlIodmUpKSB7CiAJCQkJZXJyID0gUFRSX0VSUih2ZSk7CiAJCQkJb25zdGFj
a19mZW5jZV9maW5pKCZmZW5jZSk7CkBAIC0zMjY4LDggKzMyNDEsNyBAQCBzdGF0aWMgaW50IGxp
dmVfbHJjX2ZpeGVkKHZvaWQgKmFyZykKIAlyZXR1cm4gZXJyOwogfQogCi1zdGF0aWMgaW50IF9f
bGl2ZV9scmNfc3RhdGUoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmZpeG1lLAotCQkJICAgIHN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKK3N0YXRpYyBpbnQgX19saXZlX2xyY19zdGF0
ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJCQkgICAgc3RydWN0IGk5MTVfdm1h
ICpzY3JhdGNoKQogewogCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKQEAgLTMyODQsNyArMzI1
Niw3IEBAIHN0YXRpYyBpbnQgX19saXZlX2xyY19zdGF0ZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqZml4bWUsCiAJaW50IGVycjsKIAlpbnQgbjsKIAotCWNlID0gaW50ZWxfY29udGV4dF9jcmVh
dGUoZml4bWUsIGVuZ2luZSk7CisJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUpOwog
CWlmIChJU19FUlIoY2UpKQogCQlyZXR1cm4gUFRSX0VSUihjZSk7CiAKQEAgLTMzNTgsNyArMzMz
MCw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9scmNfc3RhdGUodm9pZCAqYXJnKQogewogCXN0cnVjdCBp
bnRlbF9ndCAqZ3QgPSBhcmc7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCXN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpmaXhtZTsKIAlzdHJ1Y3QgaTkxNV92bWEgKnNjcmF0Y2g7
CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAJaW50IGVyciA9IDA7CkBAIC0zMzY4LDE4ICsz
MzM5LDEyIEBAIHN0YXRpYyBpbnQgbGl2ZV9scmNfc3RhdGUodm9pZCAqYXJnKQogCSAqIGludGVs
X2NvbnRleHQuCiAJICovCiAKLQlmaXhtZSA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKLQlp
ZiAoIWZpeG1lKQotCQlyZXR1cm4gLUVOT01FTTsKLQogCXNjcmF0Y2ggPSBjcmVhdGVfc2NyYXRj
aChndCk7Ci0JaWYgKElTX0VSUihzY3JhdGNoKSkgewotCQllcnIgPSBQVFJfRVJSKHNjcmF0Y2gp
OwotCQlnb3RvIG91dF9jbG9zZTsKLQl9CisJaWYgKElTX0VSUihzY3JhdGNoKSkKKwkJcmV0dXJu
IFBUUl9FUlIoc2NyYXRjaCk7CiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwgaWQpIHsK
LQkJZXJyID0gX19saXZlX2xyY19zdGF0ZShmaXhtZSwgZW5naW5lLCBzY3JhdGNoKTsKKwkJZXJy
ID0gX19saXZlX2xyY19zdGF0ZShlbmdpbmUsIHNjcmF0Y2gpOwogCQlpZiAoZXJyKQogCQkJYnJl
YWs7CiAJfQpAQCAtMzM4OCw4ICszMzUzLDYgQEAgc3RhdGljIGludCBsaXZlX2xyY19zdGF0ZSh2
b2lkICphcmcpCiAJCWVyciA9IC1FSU87CiAKIAlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgm
c2NyYXRjaCwgMCk7Ci1vdXRfY2xvc2U6Ci0Ja2VybmVsX2NvbnRleHRfY2xvc2UoZml4bWUpOwog
CXJldHVybiBlcnI7CiB9CiAKQEAgLTM0MjIsOCArMzM4NSw3IEBAIHN0YXRpYyBpbnQgZ3ByX21h
a2VfZGlydHkoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCXJldHVybiAwOwogfQog
Ci1zdGF0aWMgaW50IF9fbGl2ZV9ncHJfY2xlYXIoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmZp
eG1lLAotCQkJICAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKK3N0YXRpYyBpbnQg
X19saXZlX2dwcl9jbGVhcihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJCQkgICAg
c3RydWN0IGk5MTVfdm1hICpzY3JhdGNoKQogewogCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsK
QEAgLTM0MzksNyArMzQwMSw3IEBAIHN0YXRpYyBpbnQgX19saXZlX2dwcl9jbGVhcihzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqZml4bWUsCiAJaWYgKGVycikKIAkJcmV0dXJuIGVycjsKIAotCWNl
ID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZml4bWUsIGVuZ2luZSk7CisJY2UgPSBpbnRlbF9jb250
ZXh0X2NyZWF0ZShlbmdpbmUpOwogCWlmIChJU19FUlIoY2UpKQogCQlyZXR1cm4gUFRSX0VSUihj
ZSk7CiAKQEAgLTM1MDEsNyArMzQ2Myw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9ncHJfY2xlYXIodm9p
ZCAqYXJnKQogewogCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CiAJc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lOwotCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpmaXhtZTsKIAlzdHJ1
Y3QgaTkxNV92bWEgKnNjcmF0Y2g7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAJaW50IGVy
ciA9IDA7CkBAIC0zNTExLDE4ICszNDcyLDEyIEBAIHN0YXRpYyBpbnQgbGl2ZV9ncHJfY2xlYXIo
dm9pZCAqYXJnKQogCSAqIHRvIGF2b2lkIGxlYWtpbmcgYW55IGluZm9ybWF0aW9uIGZyb20gcHJl
dmlvdXMgY29udGV4dHMuCiAJICovCiAKLQlmaXhtZSA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1
KTsKLQlpZiAoIWZpeG1lKQotCQlyZXR1cm4gLUVOT01FTTsKLQogCXNjcmF0Y2ggPSBjcmVhdGVf
c2NyYXRjaChndCk7Ci0JaWYgKElTX0VSUihzY3JhdGNoKSkgewotCQllcnIgPSBQVFJfRVJSKHNj
cmF0Y2gpOwotCQlnb3RvIG91dF9jbG9zZTsKLQl9CisJaWYgKElTX0VSUihzY3JhdGNoKSkKKwkJ
cmV0dXJuIFBUUl9FUlIoc2NyYXRjaCk7CiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwg
aWQpIHsKLQkJZXJyID0gX19saXZlX2dwcl9jbGVhcihmaXhtZSwgZW5naW5lLCBzY3JhdGNoKTsK
KwkJZXJyID0gX19saXZlX2dwcl9jbGVhcihlbmdpbmUsIHNjcmF0Y2gpOwogCQlpZiAoZXJyKQog
CQkJYnJlYWs7CiAJfQpAQCAtMzUzMSw4ICszNDg2LDYgQEAgc3RhdGljIGludCBsaXZlX2dwcl9j
bGVhcih2b2lkICphcmcpCiAJCWVyciA9IC1FSU87CiAKIAlpOTE1X3ZtYV91bnBpbl9hbmRfcmVs
ZWFzZSgmc2NyYXRjaCwgMCk7Ci1vdXRfY2xvc2U6Ci0Ja2VybmVsX2NvbnRleHRfY2xvc2UoZml4
bWUpOwogCXJldHVybiBlcnI7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d2dC9zY2hlZHVsZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYwpp
bmRleCA5NzZkNjk1MDIxOGUuLmYwNzg1YjlmZTAyYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9z
Y2hlZHVsZXIuYwpAQCAtMzUsMTIgKzM1LDEyIEBACiAKICNpbmNsdWRlIDxsaW51eC9rdGhyZWFk
Lmg+CiAKLSNpbmNsdWRlICJnZW0vaTkxNV9nZW1fY29udGV4dC5oIgogI2luY2x1ZGUgImdlbS9p
OTE1X2dlbV9wbS5oIgogI2luY2x1ZGUgImd0L2ludGVsX2NvbnRleHQuaCIKICNpbmNsdWRlICJn
dC9pbnRlbF9yaW5nLmgiCiAKICNpbmNsdWRlICJpOTE1X2Rydi5oIgorI2luY2x1ZGUgImk5MTVf
Z2VtX2d0dC5oIgogI2luY2x1ZGUgImd2dC5oIgogCiAjZGVmaW5lIFJJTkdfQ1RYX09GRih4KSBc
CkBAIC0xMjIwLDE2ICsxMjIwLDE0IEBAIGludCBpbnRlbF92Z3B1X3NldHVwX3N1Ym1pc3Npb24o
c3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSB2Z3B1LT5ndnQtPmRldl9wcml2OwogCXN0cnVjdCBpbnRlbF92Z3B1X3N1Ym1pc3Npb24gKnMg
PSAmdmdwdS0+c3VibWlzc2lvbjsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7Ci0J
c3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKIAlzdHJ1Y3QgaTkxNV9wcGd0dCAqcHBndHQ7
CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaTsKIAlpbnQgcmV0OwogCi0JY3R4ID0gaTkxNV9nZW1f
Y29udGV4dF9jcmVhdGVfa2VybmVsKGk5MTUsIEk5MTVfUFJJT1JJVFlfTUFYKTsKLQlpZiAoSVNf
RVJSKGN0eCkpCi0JCXJldHVybiBQVFJfRVJSKGN0eCk7CisJcHBndHQgPSBpOTE1X3BwZ3R0X2Ny
ZWF0ZShpOTE1KTsKKwlpZiAoSVNfRVJSKHBwZ3R0KSkKKwkJcmV0dXJuIFBUUl9FUlIocHBndHQp
OwogCi0JcHBndHQgPSBpOTE1X3ZtX3RvX3BwZ3R0KGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3Jj
dShjdHgpKTsKIAlpOTE1X2NvbnRleHRfcHBndHRfcm9vdF9zYXZlKHMsIHBwZ3R0KTsKIAogCWZv
cl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGkpIHsKQEAgLTEyMzgsMTIgKzEyMzYsMTQgQEAg
aW50IGludGVsX3ZncHVfc2V0dXBfc3VibWlzc2lvbihzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkK
IAkJSU5JVF9MSVNUX0hFQUQoJnMtPndvcmtsb2FkX3FfaGVhZFtpXSk7CiAJCXMtPnNoYWRvd1tp
XSA9IEVSUl9QVFIoLUVJTlZBTCk7CiAKLQkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShjdHgs
IGVuZ2luZSk7CisJCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKIAkJaWYgKElT
X0VSUihjZSkpIHsKIAkJCXJldCA9IFBUUl9FUlIoY2UpOwogCQkJZ290byBvdXRfc2hhZG93X2N0
eDsKIAkJfQogCisJCWk5MTVfdm1fcHV0KGNlLT52bSk7CisJCWNlLT52bSA9IGk5MTVfdm1fZ2V0
KCZwcGd0dC0+dm0pOwogCQlpbnRlbF9jb250ZXh0X3NldF9zaW5nbGVfc3VibWlzc2lvbihjZSk7
CiAKIAkJaWYgKCFVU0VTX0dVQ19TVUJNSVNTSU9OKGk5MTUpKSB7IC8qIE1heCByaW5nIGJ1ZmZl
ciBzaXplICovCkBAIC0xMjc4LDcgKzEyNzgsNiBAQCBpbnQgaW50ZWxfdmdwdV9zZXR1cF9zdWJt
aXNzaW9uKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQogCWJpdG1hcF96ZXJvKHMtPnRsYl9oYW5k
bGVfcGVuZGluZywgSTkxNV9OVU1fRU5HSU5FUyk7CiAKIAlpOTE1X3ZtX3B1dCgmcHBndHQtPnZt
KTsKLQlpOTE1X2dlbV9jb250ZXh0X3B1dChjdHgpOwogCXJldHVybiAwOwogCiBvdXRfc2hhZG93
X2N0eDoKQEAgLTEyOTEsNyArMTI5MCw2IEBAIGludCBpbnRlbF92Z3B1X3NldHVwX3N1Ym1pc3Np
b24oc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAJCWludGVsX2NvbnRleHRfcHV0KHMtPnNoYWRv
d1tpXSk7CiAJfQogCWk5MTVfdm1fcHV0KCZwcGd0dC0+dm0pOwotCWk5MTVfZ2VtX2NvbnRleHRf
cHV0KGN0eCk7CiAJcmV0dXJuIHJldDsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKaW5kZXgg
YTIyZDk2OWNiMzUyLi5lNWM3MTkwMDc5ZTggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaApAQCAt
OTU2LDkgKzk1Niw2IEBAIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlIHsKIAogCXN0cnVjdCBwY2lf
ZGV2ICpicmlkZ2VfZGV2OwogCi0JLyogQ29udGV4dCB1c2VkIGludGVybmFsbHkgdG8gaWRsZSB0
aGUgR1BVIGFuZCBzZXR1cCBpbml0aWFsIHN0YXRlICovCi0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRl
eHQgKmtlcm5lbF9jb250ZXh0OwotCiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lW0k5
MTVfTlVNX0VOR0lORVNdOwogCXN0cnVjdCByYl9yb290IHVhYmlfZW5naW5lczsKIApkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtLmMKaW5kZXggY2UzMjc5NGVmNjgxLi45NjNkM2NlZTM0M2IgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW0uYwpAQCAtMTA5NSw4ICsxMDk1LDcgQEAgc3RhdGljIGludCBfX2ludGVs
X2VuZ2luZXNfcmVjb3JkX2RlZmF1bHRzKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAJCUdFTV9CVUdf
T04oIWVuZ2luZS0+a2VybmVsX2NvbnRleHQpOwogCQllbmdpbmUtPnNlcmlhbCsrOyAvKiBmb3Jj
ZSB0aGUga2VybmVsIGNvbnRleHQgc3dpdGNoICovCiAKLQkJY2UgPSBpbnRlbF9jb250ZXh0X2Ny
ZWF0ZShlbmdpbmUtPmtlcm5lbF9jb250ZXh0LT5nZW1fY29udGV4dCwKLQkJCQkJICBlbmdpbmUp
OworCQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CiAJCWlmIChJU19FUlIoY2Up
KSB7CiAJCQllcnIgPSBQVFJfRVJSKGNlKTsKIAkJCWdvdG8gb3V0OwpAQCAtMTI1MSw2ICsxMjUw
LDcgQEAgaW50IGk5MTVfZ2VtX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQogCX0KIAogCWludGVsX2d0X2luaXQoJmRldl9wcml2LT5ndCk7CisJaTkxNV9nZW1faW5pdF9j
b250ZXh0cyhkZXZfcHJpdik7CiAKIAlyZXQgPSBpbnRlbF9lbmdpbmVzX3NldHVwKCZkZXZfcHJp
di0+Z3QpOwogCWlmIChyZXQpIHsKQEAgLTEyNTgsMTYgKzEyNTgsMTAgQEAgaW50IGk5MTVfZ2Vt
X2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlnb3RvIGVycl91bmxv
Y2s7CiAJfQogCi0JcmV0ID0gaTkxNV9nZW1faW5pdF9jb250ZXh0cyhkZXZfcHJpdik7Ci0JaWYg
KHJldCkgewotCQlHRU1fQlVHX09OKHJldCA9PSAtRUlPKTsKLQkJZ290byBlcnJfc2NyYXRjaDsK
LQl9Ci0KIAlyZXQgPSBpbnRlbF9lbmdpbmVzX2luaXQoJmRldl9wcml2LT5ndCk7CiAJaWYgKHJl
dCkgewogCQlHRU1fQlVHX09OKHJldCA9PSAtRUlPKTsKLQkJZ290byBlcnJfY29udGV4dDsKKwkJ
Z290byBlcnJfc2NyYXRjaDsKIAl9CiAKIAlpbnRlbF91Y19pbml0KCZkZXZfcHJpdi0+Z3QudWMp
OwpAQCAtMTMzMSw5ICsxMzI1LDYgQEAgaW50IGk5MTVfZ2VtX2luaXQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQogCQlpbnRlbF91Y19maW5pKCZkZXZfcHJpdi0+Z3QudWMpOwog
CQlpbnRlbF9lbmdpbmVzX2NsZWFudXAoJmRldl9wcml2LT5ndCk7CiAJfQotZXJyX2NvbnRleHQ6
Ci0JaWYgKHJldCAhPSAtRUlPKQotCQlpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZV9fY29udGV4dHMo
ZGV2X3ByaXYpOwogZXJyX3NjcmF0Y2g6CiAJaW50ZWxfZ3RfZHJpdmVyX3JlbGVhc2UoJmRldl9w
cml2LT5ndCk7CiBlcnJfdW5sb2NrOgpAQCAtMTM5OSw3ICsxMzkwLDYgQEAgdm9pZCBpOTE1X2dl
bV9kcml2ZXJfcmVtb3ZlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHZvaWQg
aTkxNV9nZW1fZHJpdmVyX3JlbGVhc2Uoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQogewogCWludGVsX2VuZ2luZXNfY2xlYW51cCgmZGV2X3ByaXYtPmd0KTsKLQlpOTE1X2dlbV9k
cml2ZXJfcmVsZWFzZV9fY29udGV4dHMoZGV2X3ByaXYpOwogCWludGVsX2d0X2RyaXZlcl9yZWxl
YXNlKCZkZXZfcHJpdi0+Z3QpOwogCiAJaW50ZWxfd2FfbGlzdF9mcmVlKCZkZXZfcHJpdi0+Z3Rf
d2FfbGlzdCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCmluZGV4IDg4MTc5MjAyYzU1
Ni4uNWUyMDc0MTJhNDU5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dl
bV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwpAQCAtMTM2
MywxMiArMTM2Myw4IEBAIHN0YXRpYyBpbnQgZ2VuOF9pbml0X3NjcmF0Y2goc3RydWN0IGk5MTVf
YWRkcmVzc19zcGFjZSAqdm0pCiAJICogSWYgZXZlcnlib2R5IGFncmVlcyB0byBub3QgdG8gd3Jp
dGUgaW50byB0aGUgc2NyYXRjaCBwYWdlLAogCSAqIHdlIGNhbiByZXVzZSBpdCBmb3IgYWxsIHZt
LCBrZWVwaW5nIGNvbnRleHRzIGFuZCBwcm9jZXNzZXMgc2VwYXJhdGUuCiAJICovCi0JaWYgKHZt
LT5oYXNfcmVhZF9vbmx5ICYmCi0JICAgIHZtLT5pOTE1LT5rZXJuZWxfY29udGV4dCAmJgotCSAg
ICB2bS0+aTkxNS0+a2VybmVsX2NvbnRleHQtPnZtKSB7Ci0JCXN0cnVjdCBpOTE1X2FkZHJlc3Nf
c3BhY2UgKmNsb25lID0KLQkJCXJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0ZWQodm0tPmk5MTUtPmtl
cm5lbF9jb250ZXh0LT52bSwKLQkJCQkJCSAgdHJ1ZSk7IC8qIHN0YXRpYyAqLworCWlmICh2bS0+
aGFzX3JlYWRfb25seSAmJiB2bS0+Z3QtPnZtICYmICFpOTE1X2lzX2dndHQodm0tPmd0LT52bSkp
IHsKKwkJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqY2xvbmUgPSB2bS0+Z3QtPnZtOwogCiAJ
CUdFTV9CVUdfT04oIWNsb25lLT5oYXNfcmVhZF9vbmx5KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ3B1X2Vycm9yLmMKaW5kZXggYjQwMTU3Y2ZhZTE0Li41OTg0MjVhMmJlNjIgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3IuYwpAQCAtMTIzMSw5ICsxMjMxLDExIEBAIHN0YXRp
YyB2b2lkIHJlY29yZF9yZXF1ZXN0KGNvbnN0IHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3Qs
CiAJZXJxLT5oZWFkID0gcmVxdWVzdC0+aGVhZDsKIAllcnEtPnRhaWwgPSByZXF1ZXN0LT50YWls
OwogCi0JcmN1X3JlYWRfbG9jaygpOwotCWVycS0+cGlkID0gY3R4ICYmIGN0eC0+cGlkID8gcGlk
X25yKGN0eC0+cGlkKSA6IDA7Ci0JcmN1X3JlYWRfdW5sb2NrKCk7CisJaWYgKGN0eCkgeworCQly
Y3VfcmVhZF9sb2NrKCk7CisJCWVycS0+cGlkID0gY3R4ICYmIGN0eC0+cGlkID8gcGlkX25yKGN0
eC0+cGlkKSA6IDA7CisJCXJjdV9yZWFkX3VubG9jaygpOworCX0KIH0KIAogc3RhdGljIHZvaWQg
ZW5naW5lX3JlY29yZF9yZXF1ZXN0cyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcGVyZi5jCmluZGV4IDZlMzViOTI1NTg4Mi4uZjExNDdmYmIxZGMwIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYwpAQCAtMjM0MCw5ICsyMzQwLDYgQEAgc3RhdGljIGlu
dCBscmNfY29uZmlndXJlX2FsbF9jb250ZXh0cyhzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3Ry
ZWFtLAogCSAqLwogCXNwaW5fbG9jaygmaTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOwogCWxpc3Rf
Zm9yX2VhY2hfZW50cnlfc2FmZShjdHgsIGNuLCAmaTkxNS0+Z2VtLmNvbnRleHRzLmxpc3QsIGxp
bmspIHsKLQkJaWYgKGN0eCA9PSBpOTE1LT5rZXJuZWxfY29udGV4dCkKLQkJCWNvbnRpbnVlOwot
CiAJCWlmICgha3JlZl9nZXRfdW5sZXNzX3plcm8oJmN0eC0+cmVmKSkKIAkJCWNvbnRpbnVlOwog
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCmluZGV4IGI5YmNjZGI5ZWU2Yy4uM2I5Yzc2
ZGQwOGYwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYwpAQCAtMTIyNyw4ICsxMjI3
LDggQEAgdm9pZCBfX2k5MTVfcmVxdWVzdF9xdWV1ZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwK
IAogdm9pZCBpOTE1X3JlcXVlc3RfYWRkKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogewotCXN0
cnVjdCBpOTE1X3NjaGVkX2F0dHIgYXR0ciA9IHJxLT5jb250ZXh0LT5nZW1fY29udGV4dC0+c2No
ZWQ7CiAJc3RydWN0IGludGVsX3RpbWVsaW5lICogY29uc3QgdGwgPSBpOTE1X3JlcXVlc3RfdGlt
ZWxpbmUocnEpOworCXN0cnVjdCBpOTE1X3NjaGVkX2F0dHIgYXR0ciA9IHt9OwogCXN0cnVjdCBp
OTE1X3JlcXVlc3QgKnByZXY7CiAKIAlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ0bC0+bXV0ZXgpOwpA
QCAtMTIzOCw2ICsxMjM4LDkgQEAgdm9pZCBpOTE1X3JlcXVlc3RfYWRkKHN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJxKQogCiAJcHJldiA9IF9faTkxNV9yZXF1ZXN0X2NvbW1pdChycSk7CiAKKwlpZiAo
cnEtPmNvbnRleHQtPmdlbV9jb250ZXh0KQorCQlhdHRyID0gcnEtPmNvbnRleHQtPmdlbV9jb250
ZXh0LT5zY2hlZDsKKwogCS8qCiAJICogQm9vc3QgYWN0dWFsIHdvcmtsb2FkcyBwYXN0IHNlbWFw
aG9yZXMhCiAJICoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
OTE1X3JlcXVlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVl
c3QuYwppbmRleCAzMGFlMzRmNjIxNzYuLjlkZGFkZTRlYWNmOCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcmVxdWVzdC5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3JlcXVlc3QuYwpAQCAtNzM5LDEwICs3MzksOCBAQCBz
dGF0aWMgaW50IGxpdmVfZW1wdHlfcmVxdWVzdCh2b2lkICphcmcpCiAKIHN0YXRpYyBzdHJ1Y3Qg
aTkxNV92bWEgKnJlY3Vyc2l2ZV9iYXRjaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
IHsKLQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4ID0gaTkxNS0+a2VybmVsX2NvbnRleHQ7
CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKIAljb25zdCBpbnQgZ2VuID0gSU5U
RUxfR0VOKGk5MTUpOwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwogCXN0cnVjdCBp
OTE1X3ZtYSAqdm1hOwogCXUzMiAqY21kOwogCWludCBlcnI7CkBAIC03NTEsOSArNzQ5LDcgQEAg
c3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqcmVjdXJzaXZlX2JhdGNoKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQogCWlmIChJU19FUlIob2JqKSkKIAkJcmV0dXJuIEVSUl9DQVNUKG9iaik7
CiAKLQl2bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOwotCXZtYSA9IGk5MTVf
dm1hX2luc3RhbmNlKG9iaiwgdm0sIE5VTEwpOwotCWk5MTVfdm1fcHV0KHZtKTsKKwl2bWEgPSBp
OTE1X3ZtYV9pbnN0YW5jZShvYmosIGk5MTUtPmd0LnZtLCBOVUxMKTsKIAlpZiAoSVNfRVJSKHZt
YSkpIHsKIAkJZXJyID0gUFRSX0VSUih2bWEpOwogCQlnb3RvIGVycjsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYwppbmRleCBhMGRhNTk0NGRk
MzMuLjg2YWVjYjllMjk0NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL21vY2tfZ2VtX2RldmljZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9tb2NrX2dlbV9kZXZpY2UuYwpAQCAtNjMsNyArNjMsNiBAQCBzdGF0aWMgdm9pZCBtb2NrX2Rl
dmljZV9yZWxlYXNlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAKIAlmb3JfZWFjaF9lbmdpbmUo
ZW5naW5lLCAmaTkxNS0+Z3QsIGlkKQogCQltb2NrX2VuZ2luZV9mcmVlKGVuZ2luZSk7Ci0JaTkx
NV9nZW1fZHJpdmVyX3JlbGVhc2VfX2NvbnRleHRzKGk5MTUpOwogCiAJaW50ZWxfdGltZWxpbmVz
X2ZpbmkoaTkxNSk7CiAKQEAgLTE4NCw2ICsxODMsNyBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqbW9ja19nZW1fZGV2aWNlKHZvaWQpCiAKIAltb2NrX2luaXRfZ2d0dChpOTE1LCAmaTkxNS0+
Z2d0dCk7CiAJaTkxNS0+Z3QuZ2d0dCA9ICZpOTE1LT5nZ3R0OworCWk5MTUtPmd0LnZtID0gaTkx
NV92bV9nZXQoJmk5MTUtPmdndHQudm0pOwogCiAJbWt3cml0ZV9kZXZpY2VfaW5mbyhpOTE1KS0+
ZW5naW5lX21hc2sgPSBCSVQoMCk7CiAKQEAgLTE5MSwxMCArMTkxLDYgQEAgc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKm1vY2tfZ2VtX2RldmljZSh2b2lkKQogCWlmICghaTkxNS0+ZW5naW5lW1JD
UzBdKQogCQlnb3RvIGVycl91bmxvY2s7CiAKLQlpOTE1LT5rZXJuZWxfY29udGV4dCA9IG1vY2tf
Y29udGV4dChpOTE1LCBOVUxMKTsKLQlpZiAoIWk5MTUtPmtlcm5lbF9jb250ZXh0KQotCQlnb3Rv
IGVycl9lbmdpbmU7Ci0KIAlpZiAobW9ja19lbmdpbmVfaW5pdChpOTE1LT5lbmdpbmVbUkNTMF0p
KQogCQlnb3RvIGVycl9jb250ZXh0OwogCkBAIC0yMDMsOCArMTk5LDYgQEAgc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKm1vY2tfZ2VtX2RldmljZSh2b2lkKQogCXJldHVybiBpOTE1OwogCiBlcnJf
Y29udGV4dDoKLQlpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZV9fY29udGV4dHMoaTkxNSk7Ci1lcnJf
ZW5naW5lOgogCW1vY2tfZW5naW5lX2ZyZWUoaTkxNS0+ZW5naW5lW1JDUzBdKTsKIGVycl91bmxv
Y2s6CiAJaW50ZWxfdGltZWxpbmVzX2ZpbmkoaTkxNSk7Ci0tIAoyLjI0LjAucmMxCgpfX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGlu
ZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVl
ZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

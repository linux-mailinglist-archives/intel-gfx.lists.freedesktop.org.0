Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 55FE3D1A06
	for <lists+intel-gfx@lfdr.de>; Wed,  9 Oct 2019 22:47:36 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 72AA66E328;
	Wed,  9 Oct 2019 20:47:34 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 13FCF6E328
 for <intel-gfx@lists.freedesktop.org>; Wed,  9 Oct 2019 20:47:31 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18783027-1500050 
 for multiple; Wed, 09 Oct 2019 21:47:20 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  9 Oct 2019 21:47:18 +0100
Message-Id: <20191009204718.1324-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191009203641.15477-7-chris@chris-wilson.co.uk>
References: <20191009203641.15477-7-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/perf: implement active wait for noa
 configurations
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwuY29tPgoK
Tk9BIGNvbmZpZ3VyYXRpb24gdGFrZSBzb21lIGFtb3VudCBvZiB0aW1lIHRvIGFwcGx5LiBUaGF0
IGFtb3VudCBvZgp0aW1lIGRlcGVuZHMgb24gdGhlIHNpemUgb2YgdGhlIEdULiBUaGVyZSBpcyBu
byBkb2N1bWVudGVkIHRpbWUgZm9yCnRoaXMuIEZvciBleGFtcGxlLCBwYXN0IGV4cGVyaW1lbnRh
dGlvbnMgd2l0aCBwb3dlcmdhdGluZwpjb25maWd1cmF0aW9uIGNoYW5nZXMgc2VlbSB0byBpbmRp
Y2F0ZSBhIDYwfjcwdXMgZGVsYXkuIFdlIGdvIHdpdGgKNTAwdXMgYXMgZGVmYXVsdCBmb3Igbm93
IHdoaWNoIHNob3VsZCBiZSBvdmVyIHRoZSByZXF1aXJlZCBhbW91bnQgb2YKdGltZSAoYWNjb3Jk
aW5nIHRvIEhXIGFyY2hpdGVjdHMpLgoKdjI6IERvbid0IGZvcmdldCB0byBzYXZlL3Jlc3RvcmUg
cmVnaXN0ZXJzIHVzZWQgZm9yIHRoZSB3YWl0IChDaHJpcykKCnYzOiBOYW1lIHVzZWQgQ1NfR1BS
IHJlZ2lzdGVycyAoQ2hyaXMpCiAgICBGaXggY29tcGlsZSBpc3N1ZSBkdWUgdG8gcmViYXNlIChM
aW9uZWwpCgp2NDogRml4IHNhdmUvcmVzdG9yZSBoZWxwZXJzIChVbWVzaCkKCnY1OiBNb3ZlIG5v
YV93YWl0IGZyb20gZHJtX2k5MTVfcHJpdmF0ZSB0byBpOTE1X3BlcmZfc3RyZWFtIChMaW9uZWwp
Cgp2NjogQWRkIG1pc3Npbmcgc3RydWN0IGRlY2xhcmF0aW9ucyBpbiBpOTE1X3BlcmYuaAoKU2ln
bmVkLW9mZi1ieTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwu
Y29tPgpSZXZpZXdlZC1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+
ICh2NCkKLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMuaCAg
fCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmggICAgICB8
ICAgNSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyAgICAgICAgICAgfCAg
MzIgKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyAgICAgICAgICAgICAgfCAy
MjMgKysrKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmZfdHlw
ZXMuaCAgICAgICAgfCAgIDggKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaCAgICAg
ICAgICAgICAgIHwgICA0ICstCiAuLi4vZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxm
dGVzdHMuaCAgfCAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcGVy
Zi5jICAgIHwgMjE3ICsrKysrKysrKysrKysrKysrCiA4IGZpbGVzIGNoYW5nZWQsIDQ5MiBpbnNl
cnRpb25zKCspLCAyIGRlbGV0aW9ucygtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3BlcmYuYwoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZ3B1X2NvbW1hbmRzLmgKaW5kZXggMDk4NzEwMGM3ODZiLi44ZTYzY2ZmY2FiZTAg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5o
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5oCkBAIC0x
NjMsNyArMTYzLDggQEAKICNkZWZpbmUgTUlfQkFUQ0hfQlVGRkVSX1NUQVJUCU1JX0lOU1RSKDB4
MzEsIDApCiAjZGVmaW5lICAgTUlfQkFUQ0hfR1RUCQkgICAgKDI8PDYpIC8qIGFsaWFzZWQgd2l0
aCAoMTw8Nykgb24gZ2VuNCAqLwogI2RlZmluZSBNSV9CQVRDSF9CVUZGRVJfU1RBUlRfR0VOOAlN
SV9JTlNUUigweDMxLCAxKQotI2RlZmluZSAgIE1JX0JBVENIX1JFU09VUkNFX1NUUkVBTUVSICgx
PDwxMCkKKyNkZWZpbmUgICBNSV9CQVRDSF9SRVNPVVJDRV9TVFJFQU1FUiBSRUdfQklUKDEwKQor
I2RlZmluZSAgIE1JX0JBVENIX1BSRURJQ0FURSAgICAgICAgIFJFR19CSVQoMTUpIC8qIEhTVysg
b24gUkNTIG9ubHkqLwogCiAvKgogICogM0QgaW5zdHJ1Y3Rpb25zIHVzZWQgYnkgdGhlIGtlcm5l
bApAQCAtMjI0LDYgKzIyNSw3IEBACiAjZGVmaW5lICAgUElQRV9DT05UUk9MX0NTX1NUQUxMCQkJ
CSgxPDwyMCkKICNkZWZpbmUgICBQSVBFX0NPTlRST0xfVExCX0lOVkFMSURBVEUJCQkoMTw8MTgp
CiAjZGVmaW5lICAgUElQRV9DT05UUk9MX01FRElBX1NUQVRFX0NMRUFSCQkoMTw8MTYpCisjZGVm
aW5lICAgUElQRV9DT05UUk9MX1dSSVRFX1RJTUVTVEFNUAkJCSgzPDwxNCkKICNkZWZpbmUgICBQ
SVBFX0NPTlRST0xfUVdfV1JJVEUJCQkJKDE8PDE0KQogI2RlZmluZSAgIFBJUEVfQ09OVFJPTF9Q
T1NUX1NZTkNfT1BfTUFTSyAgICAgICAgICAgICAgICAoMzw8MTQpCiAjZGVmaW5lICAgUElQRV9D
T05UUk9MX0RFUFRIX1NUQUxMCQkJKDE8PDEzKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2d0X3R5cGVzLmgKaW5kZXggODAyZjUxNmEzNDMwLi5iZTRiMjYzNjIxYzggMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmgKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaApAQCAtMTA5LDYgKzEwOSwxMSBAQCBlbnVt
IGludGVsX2d0X3NjcmF0Y2hfZmllbGQgewogCS8qIDggYnl0ZXMgKi8KIAlJTlRFTF9HVF9TQ1JB
VENIX0ZJRUxEX0NPSEVSRU5UTDNfV0EgPSAyNTYsCiAKKwkvKiA2ICogOCBieXRlcyAqLworCUlO
VEVMX0dUX1NDUkFUQ0hfRklFTERfUEVSRl9DU19HUFIgPSAyMDQ4LAorCisJLyogNCBieXRlcyAq
LworCUlOVEVMX0dUX1NDUkFUQ0hfRklFTERfUEVSRl9QUkVESUNBVEVfUkVTVUxUXzEgPSAyMDk2
LAogfTsKIAogI2VuZGlmIC8qIF9fSU5URUxfR1RfVFlQRVNfSF9fICovCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZGVidWdmcy5jCmluZGV4IDI3N2YzMTI5N2YyOS4uZDQ2M2EyOGI3NDc1IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwpAQCAtMzU5MCw2ICszNTkwLDM3IEBAIERFRklORV9T
SU1QTEVfQVRUUklCVVRFKGk5MTVfd2VkZ2VkX2ZvcHMsCiAJCQlpOTE1X3dlZGdlZF9nZXQsIGk5
MTVfd2VkZ2VkX3NldCwKIAkJCSIlbGx1XG4iKTsKIAorc3RhdGljIGludAoraTkxNV9wZXJmX25v
YV9kZWxheV9zZXQodm9pZCAqZGF0YSwgdTY0IHZhbCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IGRhdGE7CisJY29uc3QgdTMyIGNsayA9IFJVTlRJTUVfSU5GTyhpOTE1KS0+
Y3NfdGltZXN0YW1wX2ZyZXF1ZW5jeV9raHo7CisKKwkvKgorCSAqIFRoaXMgd291bGQgbGVhZCB0
byBpbmZpbml0ZSB3YWl0cyBhcyB3ZSdyZSBkb2luZyB0aW1lc3RhbXAKKwkgKiBkaWZmZXJlbmNl
IG9uIHRoZSBDUyB3aXRoIG9ubHkgMzJiaXRzLgorCSAqLworCWlmICh2YWwgPiBtdWxfdTMyX3Uz
MihVMzJfTUFYLCBjbGspKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWF0b21pYzY0X3NldCgmaTkx
NS0+cGVyZi5ub2FfcHJvZ3JhbW1pbmdfZGVsYXksIHZhbCk7CisJcmV0dXJuIDA7Cit9CisKK3N0
YXRpYyBpbnQKK2k5MTVfcGVyZl9ub2FfZGVsYXlfZ2V0KHZvaWQgKmRhdGEsIHU2NCAqdmFsKQor
eworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZGF0YTsKKworCSp2YWwgPSBhdG9t
aWM2NF9yZWFkKCZpOTE1LT5wZXJmLm5vYV9wcm9ncmFtbWluZ19kZWxheSk7CisJcmV0dXJuIDA7
Cit9CisKK0RFRklORV9TSU1QTEVfQVRUUklCVVRFKGk5MTVfcGVyZl9ub2FfZGVsYXlfZm9wcywK
KwkJCWk5MTVfcGVyZl9ub2FfZGVsYXlfZ2V0LAorCQkJaTkxNV9wZXJmX25vYV9kZWxheV9zZXQs
CisJCQkiJWxsdVxuIik7CisKICNkZWZpbmUgRFJPUF9VTkJPVU5ECUJJVCgwKQogI2RlZmluZSBE
Uk9QX0JPVU5ECUJJVCgxKQogI2RlZmluZSBEUk9QX1JFVElSRQlCSVQoMikKQEAgLTQzNDAsNiAr
NDM3MSw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaTkxNV9kZWJ1Z2ZzX2ZpbGVzIHsKIAljb25z
dCBjaGFyICpuYW1lOwogCWNvbnN0IHN0cnVjdCBmaWxlX29wZXJhdGlvbnMgKmZvcHM7CiB9IGk5
MTVfZGVidWdmc19maWxlc1tdID0geworCXsiaTkxNV9wZXJmX25vYV9kZWxheSIsICZpOTE1X3Bl
cmZfbm9hX2RlbGF5X2ZvcHN9LAogCXsiaTkxNV93ZWRnZWQiLCAmaTkxNV93ZWRnZWRfZm9wc30s
CiAJeyJpOTE1X2NhY2hlX3NoYXJpbmciLCAmaTkxNV9jYWNoZV9zaGFyaW5nX2ZvcHN9LAogCXsi
aTkxNV9nZW1fZHJvcF9jYWNoZXMiLCAmaTkxNV9kcm9wX2NhY2hlc19mb3BzfSwKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9wZXJmLmMKaW5kZXggNWUxNGRkNmM0Yzc4Li42YmYwMmU0YzVmMDkgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfcGVyZi5jCkBAIC0xOTgsNiArMTk4LDcgQEAKICNpbmNsdWRlICJnZW0vaTkx
NV9nZW1fY29udGV4dC5oIgogI2luY2x1ZGUgImdlbS9pOTE1X2dlbV9wbS5oIgogI2luY2x1ZGUg
Imd0L2ludGVsX2VuZ2luZV91c2VyLmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfZ3QuaCIKICNpbmNs
dWRlICJndC9pbnRlbF9scmNfcmVnLmgiCiAKICNpbmNsdWRlICJpOTE1X2Rydi5oIgpAQCAtMTMz
Nyw2ICsxMzM4LDEyIEBAIGZyZWVfb2FfYnVmZmVyKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpz
dHJlYW0pCiAJc3RyZWFtLT5vYV9idWZmZXIudmFkZHIgPSBOVUxMOwogfQogCitzdGF0aWMgdm9p
ZAorZnJlZV9ub2Ffd2FpdChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQoreworCWk5
MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZzdHJlYW0tPm5vYV93YWl0LCAwKTsKK30KKwogc3Rh
dGljIHZvaWQKIGZyZWVfb2FfY29uZmlncyhzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFt
KQogewpAQCAtMTM2NCw2ICsxMzcxLDcgQEAgc3RhdGljIHZvaWQgaTkxNV9vYV9zdHJlYW1fZGVz
dHJveShzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogCXB1dF9vYV9jb250ZXh0KHN0
cmVhbSk7CiAKIAlmcmVlX29hX2NvbmZpZ3Moc3RyZWFtKTsKKwlmcmVlX25vYV93YWl0KHN0cmVh
bSk7CiAKIAlpZiAocGVyZi0+c3B1cmlvdXNfcmVwb3J0X3JzLm1pc3NlZCkgewogCQlEUk1fTk9U
RSgiJWQgc3B1cmlvdXMgT0EgcmVwb3J0IG5vdGljZXMgc3VwcHJlc3NlZCBkdWUgdG8gcmF0ZWxp
bWl0aW5nXG4iLApAQCAtMTUyNCw2ICsxNTMyLDIwNSBAQCBzdGF0aWMgaW50IGFsbG9jX29hX2J1
ZmZlcihzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogCXJldHVybiByZXQ7CiB9CiAK
K3N0YXRpYyB1MzIgKnNhdmVfcmVzdG9yZV9yZWdpc3RlcihzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVh
bSAqc3RyZWFtLCB1MzIgKmNzLAorCQkJCSAgYm9vbCBzYXZlLCBpOTE1X3JlZ190IHJlZywgdTMy
IG9mZnNldCwKKwkJCQkgIHUzMiBkd29yZF9jb3VudCkKK3sKKwl1MzIgY21kOworCXUzMiBkOwor
CisJY21kID0gc2F2ZSA/IE1JX1NUT1JFX1JFR0lTVEVSX01FTSA6IE1JX0xPQURfUkVHSVNURVJf
TUVNOworCWlmIChJTlRFTF9HRU4oc3RyZWFtLT5wZXJmLT5pOTE1KSA+PSA4KQorCQljbWQrKzsK
KworCWZvciAoZCA9IDA7IGQgPCBkd29yZF9jb3VudDsgZCsrKSB7CisJCSpjcysrID0gY21kOwor
CQkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KHJlZykgKyA0ICogZDsKKwkJKmNzKysgPSBp
bnRlbF9ndF9zY3JhdGNoX29mZnNldChzdHJlYW0tPmd0LCBvZmZzZXQpICsgNCAqIGQ7CisJCSpj
cysrID0gMDsKKwl9CisKKwlyZXR1cm4gY3M7Cit9CisKK3N0YXRpYyBpbnQgYWxsb2Nfbm9hX3dh
aXQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHN0cmVhbS0+cGVyZi0+aTkxNTsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqYm87CisJc3RydWN0IGk5MTVfdm1hICp2bWE7CisJY29uc3QgdTY0IGRlbGF5X3Rp
Y2tzID0gMHhmZmZmZmZmZmZmZmZmZmZmIC0KKwkJRElWNjRfVTY0X1JPVU5EX1VQKAorCQkJYXRv
bWljNjRfcmVhZCgmc3RyZWFtLT5wZXJmLT5ub2FfcHJvZ3JhbW1pbmdfZGVsYXkpICoKKwkJCVJV
TlRJTUVfSU5GTyhpOTE1KS0+Y3NfdGltZXN0YW1wX2ZyZXF1ZW5jeV9raHosCisJCQkxMDAwMDAw
dWxsKTsKKwljb25zdCB1MzIgYmFzZSA9IHN0cmVhbS0+ZW5naW5lLT5tbWlvX2Jhc2U7CisjZGVm
aW5lIENTX0dQUih4KSBHRU44X1JJTkdfQ1NfR1BSKGJhc2UsIHgpCisJdTMyICpiYXRjaCwgKnRz
MCwgKmNzLCAqanVtcDsKKwlpbnQgcmV0LCBpOworCWVudW0geworCQlTVEFSVF9UUywKKwkJTk9X
X1RTLAorCQlERUxUQV9UUywKKwkJSlVNUF9QUkVESUNBVEUsCisJCURFTFRBX1RBUkdFVCwKKwkJ
Tl9DU19HUFIKKwl9OworCisJYm8gPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGk5
MTUsIDQwOTYpOworCWlmIChJU19FUlIoYm8pKSB7CisJCURSTV9FUlJPUigiRmFpbGVkIHRvIGFs
bG9jYXRlIE5PQSB3YWl0IGJhdGNoYnVmZmVyXG4iKTsKKwkJcmV0dXJuIFBUUl9FUlIoYm8pOwor
CX0KKworCS8qCisJICogV2UgcGluIGluIEdHVFQgYmVjYXVzZSB3ZSBqdW1wIGludG8gdGhpcyBi
dWZmZXIgbm93IGJlY2F1c2UKKwkgKiBtdWx0aXBsZSBPQSBjb25maWcgQk9zIHdpbGwgaGF2ZSBh
IGp1bXAgdG8gdGhpcyBhZGRyZXNzIGFuZCBpdAorCSAqIG5lZWRzIHRvIGJlIGZpeGVkIGR1cmlu
ZyB0aGUgbGlmZXRpbWUgb2YgdGhlIGk5MTUvcGVyZiBzdHJlYW0uCisJICovCisJdm1hID0gaTkx
NV9nZW1fb2JqZWN0X2dndHRfcGluKGJvLCBOVUxMLCAwLCAwLCBQSU5fSElHSCk7CisJaWYgKElT
X0VSUih2bWEpKSB7CisJCXJldCA9IFBUUl9FUlIodm1hKTsKKwkJZ290byBlcnJfdW5yZWY7CisJ
fQorCisJYmF0Y2ggPSBjcyA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKGJvLCBJOTE1X01BUF9X
Qik7CisJaWYgKElTX0VSUihiYXRjaCkpIHsKKwkJcmV0ID0gUFRSX0VSUihiYXRjaCk7CisJCWdv
dG8gZXJyX3VucGluOworCX0KKworCS8qIFNhdmUgcmVnaXN0ZXJzLiAqLworCWZvciAoaSA9IDA7
IGkgPCBOX0NTX0dQUjsgaSsrKQorCQljcyA9IHNhdmVfcmVzdG9yZV9yZWdpc3RlcigKKwkJCXN0
cmVhbSwgY3MsIHRydWUgLyogc2F2ZSAqLywgQ1NfR1BSKGkpLAorCQkJSU5URUxfR1RfU0NSQVRD
SF9GSUVMRF9QRVJGX0NTX0dQUiArIDggKiBpLCAyKTsKKwljcyA9IHNhdmVfcmVzdG9yZV9yZWdp
c3RlcigKKwkJc3RyZWFtLCBjcywgdHJ1ZSAvKiBzYXZlICovLCBNSV9QUkVESUNBVEVfUkVTVUxU
XzEsCisJCUlOVEVMX0dUX1NDUkFUQ0hfRklFTERfUEVSRl9QUkVESUNBVEVfUkVTVUxUXzEsIDEp
OworCisJLyogRmlyc3QgdGltZXN0YW1wIHNuYXBzaG90IGxvY2F0aW9uLiAqLworCXRzMCA9IGNz
OworCisJLyoKKwkgKiBJbml0aWFsIHNuYXBzaG90IG9mIHRoZSB0aW1lc3RhbXAgcmVnaXN0ZXIg
dG8gaW1wbGVtZW50IHRoZSB3YWl0LgorCSAqIFdlIHdvcmsgd2l0aCAzMmIgdmFsdWVzLCBzbyBj
bGVhciBvdXQgdGhlIHRvcCAzMmIgYml0cyBvZiB0aGUKKwkgKiByZWdpc3RlciBiZWNhdXNlIHRo
ZSBBTFUgd29ya3MgNjRiaXRzLgorCSAqLworCSpjcysrID0gTUlfTE9BRF9SRUdJU1RFUl9JTU0o
MSk7CisJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChDU19HUFIoU1RBUlRfVFMpKSArIDQ7
CisJKmNzKysgPSAwOworCSpjcysrID0gTUlfTE9BRF9SRUdJU1RFUl9SRUcgfCAoMyAtIDIpOwor
CSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQoUklOR19USU1FU1RBTVAoYmFzZSkpOworCSpj
cysrID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQoQ1NfR1BSKFNUQVJUX1RTKSk7CisKKwkvKgorCSAq
IFRoaXMgaXMgdGhlIGxvY2F0aW9uIHdlJ3JlIGdvaW5nIHRvIGp1bXAgYmFjayBpbnRvIHVudGls
IHRoZQorCSAqIHJlcXVpcmVkIGFtb3VudCBvZiB0aW1lIGhhcyBwYXNzZWQuCisJICovCisJanVt
cCA9IGNzOworCisJLyoKKwkgKiBUYWtlIGFub3RoZXIgc25hcHNob3Qgb2YgdGhlIHRpbWVzdGFt
cCByZWdpc3Rlci4gVGFrZSBjYXJlIHRvIGNsZWFyCisJICogdXAgdGhlIHRvcCAzMmJpdHMgb2Yg
Q1NfR1BSKDEpIGFzIHdlJ3JlIHVzaW5nIGl0IGZvciBvdGhlcgorCSAqIG9wZXJhdGlvbnMgYmVs
b3cuCisJICovCisJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX0lNTSgxKTsKKwkqY3MrKyA9IGk5
MTVfbW1pb19yZWdfb2Zmc2V0KENTX0dQUihOT1dfVFMpKSArIDQ7CisJKmNzKysgPSAwOworCSpj
cysrID0gTUlfTE9BRF9SRUdJU1RFUl9SRUcgfCAoMyAtIDIpOworCSpjcysrID0gaTkxNV9tbWlv
X3JlZ19vZmZzZXQoUklOR19USU1FU1RBTVAoYmFzZSkpOworCSpjcysrID0gaTkxNV9tbWlvX3Jl
Z19vZmZzZXQoQ1NfR1BSKE5PV19UUykpOworCisJLyoKKwkgKiBEbyBhIGRpZmYgYmV0d2VlbiB0
aGUgMiB0aW1lc3RhbXBzIGFuZCBzdG9yZSB0aGUgcmVzdWx0IGJhY2sgaW50bworCSAqIENTX0dQ
UigxKS4KKwkgKi8KKwkqY3MrKyA9IE1JX01BVEgoNSk7CisJKmNzKysgPSBNSV9NQVRIX0xPQUQo
TUlfTUFUSF9SRUdfU1JDQSwgTUlfTUFUSF9SRUcoTk9XX1RTKSk7CisJKmNzKysgPSBNSV9NQVRI
X0xPQUQoTUlfTUFUSF9SRUdfU1JDQiwgTUlfTUFUSF9SRUcoU1RBUlRfVFMpKTsKKwkqY3MrKyA9
IE1JX01BVEhfU1VCOworCSpjcysrID0gTUlfTUFUSF9TVE9SRShNSV9NQVRIX1JFRyhERUxUQV9U
UyksIE1JX01BVEhfUkVHX0FDQ1UpOworCSpjcysrID0gTUlfTUFUSF9TVE9SRShNSV9NQVRIX1JF
RyhKVU1QX1BSRURJQ0FURSksIE1JX01BVEhfUkVHX0NGKTsKKworCS8qCisJICogVHJhbnNmZXIg
dGhlIGNhcnJ5IGZsYWcgKHNldCB0byAxIGlmIHRzMSA8IHRzMCwgbWVhbmluZyB0aGUKKwkgKiB0
aW1lc3RhbXAgaGF2ZSByb2xsZWQgb3ZlciB0aGUgMzJiaXRzKSBpbnRvIHRoZSBwcmVkaWNhdGUg
cmVnaXN0ZXIKKwkgKiB0byBiZSB1c2VkIGZvciB0aGUgcHJlZGljYXRlZCBqdW1wLgorCSAqLwor
CSpjcysrID0gTUlfTE9BRF9SRUdJU1RFUl9SRUcgfCAoMyAtIDIpOworCSpjcysrID0gaTkxNV9t
bWlvX3JlZ19vZmZzZXQoQ1NfR1BSKEpVTVBfUFJFRElDQVRFKSk7CisJKmNzKysgPSBpOTE1X21t
aW9fcmVnX29mZnNldChNSV9QUkVESUNBVEVfUkVTVUxUXzEpOworCisJLyogUmVzdGFydCBmcm9t
IHRoZSBiZWdpbm5pbmcgaWYgd2UgaGFkIHRpbWVzdGFtcHMgcm9sbCBvdmVyLiAqLworCSpjcysr
ID0gKElOVEVMX0dFTihpOTE1KSA8IDggPworCQkgTUlfQkFUQ0hfQlVGRkVSX1NUQVJUIDoKKwkJ
IE1JX0JBVENIX0JVRkZFUl9TVEFSVF9HRU44KSB8CisJCU1JX0JBVENIX1BSRURJQ0FURTsKKwkq
Y3MrKyA9IGk5MTVfZ2d0dF9vZmZzZXQodm1hKSArICh0czAgLSBiYXRjaCkgKiA0OworCSpjcysr
ID0gMDsKKworCS8qCisJICogTm93IGFkZCB0aGUgZGlmZiBiZXR3ZWVuIHRvIHByZXZpb3VzIHRp
bWVzdGFtcHMgYW5kIGFkZCBpdCB0byA6CisJICogICAgICAoKCgxICogPDwgNjQpIC0gMSkgLSBk
ZWxheV9ucykKKwkgKgorCSAqIFdoZW4gdGhlIENhcnJ5IEZsYWcgY29udGFpbnMgMSB0aGlzIG1l
YW5zIHRoZSBlbGFwc2VkIHRpbWUgaXMKKwkgKiBsb25nZXIgdGhhbiB0aGUgZXhwZWN0ZWQgZGVs
YXksIGFuZCB3ZSBjYW4gZXhpdCB0aGUgd2FpdCBsb29wLgorCSAqLworCSpjcysrID0gTUlfTE9B
RF9SRUdJU1RFUl9JTU0oMik7CisJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChDU19HUFIo
REVMVEFfVEFSR0VUKSk7CisJKmNzKysgPSBsb3dlcl8zMl9iaXRzKGRlbGF5X3RpY2tzKTsKKwkq
Y3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KENTX0dQUihERUxUQV9UQVJHRVQpKSArIDQ7CisJ
KmNzKysgPSB1cHBlcl8zMl9iaXRzKGRlbGF5X3RpY2tzKTsKKworCSpjcysrID0gTUlfTUFUSCg0
KTsKKwkqY3MrKyA9IE1JX01BVEhfTE9BRChNSV9NQVRIX1JFR19TUkNBLCBNSV9NQVRIX1JFRyhE
RUxUQV9UUykpOworCSpjcysrID0gTUlfTUFUSF9MT0FEKE1JX01BVEhfUkVHX1NSQ0IsIE1JX01B
VEhfUkVHKERFTFRBX1RBUkdFVCkpOworCSpjcysrID0gTUlfTUFUSF9BREQ7CisJKmNzKysgPSBN
SV9NQVRIX1NUT1JFSU5WKE1JX01BVEhfUkVHKEpVTVBfUFJFRElDQVRFKSwgTUlfTUFUSF9SRUdf
Q0YpOworCisJLyoKKwkgKiBUcmFuc2ZlciB0aGUgcmVzdWx0IGludG8gdGhlIHByZWRpY2F0ZSBy
ZWdpc3RlciB0byBiZSB1c2VkIGZvciB0aGUKKwkgKiBwcmVkaWNhdGVkIGp1bXAuCisJICovCisJ
KmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX1JFRyB8ICgzIC0gMik7CisJKmNzKysgPSBpOTE1X21t
aW9fcmVnX29mZnNldChDU19HUFIoSlVNUF9QUkVESUNBVEUpKTsKKwkqY3MrKyA9IGk5MTVfbW1p
b19yZWdfb2Zmc2V0KE1JX1BSRURJQ0FURV9SRVNVTFRfMSk7CisKKwkvKiBQcmVkaWNhdGUgdGhl
IGp1bXAuICAqLworCSpjcysrID0gKElOVEVMX0dFTihpOTE1KSA8IDggPworCQkgTUlfQkFUQ0hf
QlVGRkVSX1NUQVJUIDoKKwkJIE1JX0JBVENIX0JVRkZFUl9TVEFSVF9HRU44KSB8CisJCU1JX0JB
VENIX1BSRURJQ0FURTsKKwkqY3MrKyA9IGk5MTVfZ2d0dF9vZmZzZXQodm1hKSArIChqdW1wIC0g
YmF0Y2gpICogNDsKKwkqY3MrKyA9IDA7CisKKwkvKiBSZXN0b3JlIHJlZ2lzdGVycy4gKi8KKwlm
b3IgKGkgPSAwOyBpIDwgTl9DU19HUFI7IGkrKykKKwkJY3MgPSBzYXZlX3Jlc3RvcmVfcmVnaXN0
ZXIoCisJCQlzdHJlYW0sIGNzLCBmYWxzZSAvKiByZXN0b3JlICovLCBDU19HUFIoaSksCisJCQlJ
TlRFTF9HVF9TQ1JBVENIX0ZJRUxEX1BFUkZfQ1NfR1BSICsgOCAqIGksIDIpOworCWNzID0gc2F2
ZV9yZXN0b3JlX3JlZ2lzdGVyKAorCQlzdHJlYW0sIGNzLCBmYWxzZSAvKiByZXN0b3JlICovLCBN
SV9QUkVESUNBVEVfUkVTVUxUXzEsCisJCUlOVEVMX0dUX1NDUkFUQ0hfRklFTERfUEVSRl9QUkVE
SUNBVEVfUkVTVUxUXzEsIDEpOworCisJLyogQW5kIHJldHVybiB0byB0aGUgcmluZy4gKi8KKwkq
Y3MrKyA9IE1JX0JBVENIX0JVRkZFUl9FTkQ7CisKKwlHRU1fQlVHX09OKGNzIC0gYmF0Y2ggPiBQ
QUdFX1NJWkUgLyBzaXplb2YoKmJhdGNoKSk7CisKKwlpOTE1X2dlbV9vYmplY3RfZmx1c2hfbWFw
KGJvKTsKKwlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKGJvKTsKKworCXN0cmVhbS0+bm9hX3dh
aXQgPSB2bWE7CisJcmV0dXJuIDA7CisKK2Vycl91bnBpbjoKKwlfX2k5MTVfdm1hX3VucGluKHZt
YSk7CitlcnJfdW5yZWY6CisJaTkxNV9nZW1fb2JqZWN0X3B1dChibyk7CisJcmV0dXJuIHJldDsK
K30KKwogc3RhdGljIHZvaWQgY29uZmlnX29hX3JlZ3Moc3RydWN0IGludGVsX3VuY29yZSAqdW5j
b3JlLAogCQkJICAgY29uc3Qgc3RydWN0IGk5MTVfb2FfcmVnICpyZWdzLAogCQkJICAgdTMyIG5f
cmVncykKQEAgLTIyMDAsNiArMjQwNywxMiBAQCBzdGF0aWMgaW50IGk5MTVfb2Ffc3RyZWFtX2lu
aXQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwKIAkJfQogCX0KIAorCXJldCA9IGFs
bG9jX25vYV93YWl0KHN0cmVhbSk7CisJaWYgKHJldCkgeworCQlEUk1fREVCVUcoIlVuYWJsZSB0
byBhbGxvY2F0ZSBOT0Egd2FpdCBiYXRjaCBidWZmZXJcbiIpOworCQlnb3RvIGVycl9ub2Ffd2Fp
dF9hbGxvYzsKKwl9CisKIAlzdHJlYW0tPm9hX2NvbmZpZyA9IGk5MTVfcGVyZl9nZXRfb2FfY29u
ZmlnKHBlcmYsIHByb3BzLT5tZXRyaWNzX3NldCk7CiAJaWYgKCFzdHJlYW0tPm9hX2NvbmZpZykg
ewogCQlEUk1fREVCVUcoIkludmFsaWQgT0EgY29uZmlnIGlkPSVpXG4iLCBwcm9wcy0+bWV0cmlj
c19zZXQpOwpAQCAtMjI0MSw2ICsyNDU0LDkgQEAgc3RhdGljIGludCBpOTE1X29hX3N0cmVhbV9p
bml0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJZnJlZV9vYV9jb25maWdzKHN0
cmVhbSk7CiAKIGVycl9jb25maWc6CisJZnJlZV9ub2Ffd2FpdChzdHJlYW0pOworCitlcnJfbm9h
X3dhaXRfYWxsb2M6CiAJcHV0X29hX2NvbnRleHQoc3RyZWFtKTsKIAogCXJldHVybiByZXQ7CkBA
IC0zNjQyLDYgKzM4NTgsOSBAQCB2b2lkIGk5MTVfcGVyZl9pbml0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQogCQlyYXRlbGltaXRfc2V0X2ZsYWdzKCZwZXJmLT5zcHVyaW91c19yZXBv
cnRfcnMsCiAJCQkJICAgIFJBVEVMSU1JVF9NU0dfT05fUkVMRUFTRSk7CiAKKwkJYXRvbWljNjRf
c2V0KCZwZXJmLT5ub2FfcHJvZ3JhbW1pbmdfZGVsYXksCisJCQkgICAgIDUwMCAqIDEwMDAgLyog
NTAwdXMgKi8pOworCiAJCXBlcmYtPmk5MTUgPSBpOTE1OwogCX0KIH0KQEAgLTM2ODEsMyArMzkw
MCw3IEBAIGludCBpOTE1X3BlcmZfaW9jdGxfdmVyc2lvbih2b2lkKQogewogCXJldHVybiAxOwog
fQorCisjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfU0VMRlRFU1QpCisjaW5jbHVkZSAi
c2VsZnRlc3RzL2k5MTVfcGVyZi5jIgorI2VuZGlmCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3BlcmZfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVy
Zl90eXBlcy5oCmluZGV4IGIxYjdjOGQwNGY1MC4uNTNkYTg2NzZiMDY4IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmZfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3BlcmZfdHlwZXMuaApAQCAtMjY4LDYgKzI2OCwxMiBAQCBzdHJ1Y3QgaTkx
NV9wZXJmX3N0cmVhbSB7CiAJCSAqLwogCQl1MzIgaGVhZDsKIAl9IG9hX2J1ZmZlcjsKKworCS8q
KgorCSAqIEEgYmF0Y2ggYnVmZmVyIGRvaW5nIGEgd2FpdCBvbiB0aGUgR1BVIGZvciB0aGUgTk9B
IGxvZ2ljIHRvIGJlCisJICogcmVwcm9ncmFtbWVkLgorCSAqLworCXN0cnVjdCBpOTE1X3ZtYSAq
bm9hX3dhaXQ7CiB9OwogCiAvKioKQEAgLTM4Nyw2ICszOTMsOCBAQCBzdHJ1Y3QgaTkxNV9wZXJm
IHsKIAogCXN0cnVjdCBpOTE1X29hX29wcyBvcHM7CiAJY29uc3Qgc3RydWN0IGk5MTVfb2FfZm9y
bWF0ICpvYV9mb3JtYXRzOworCisJYXRvbWljNjRfdCBub2FfcHJvZ3JhbW1pbmdfZGVsYXk7CiB9
OwogCiAjZW5kaWYgLyogX0k5MTVfUEVSRl9UWVBFU19IXyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVn
LmgKaW5kZXggMWRjMDY3ZmM1N2FiLi45OWY4YTA4ZGMyYjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfcmVnLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9y
ZWcuaApAQCAtNTQ1LDcgKzU0NSw5IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBpOTE1X21taW9fcmVn
X3ZhbGlkKGk5MTVfcmVnX3QgcmVnKQogI2RlZmluZSBNSV9QUkVESUNBVEVfU1JDMF9VRFcJX01N
SU8oMHgyNDAwICsgNCkKICNkZWZpbmUgTUlfUFJFRElDQVRFX1NSQzEJX01NSU8oMHgyNDA4KQog
I2RlZmluZSBNSV9QUkVESUNBVEVfU1JDMV9VRFcJX01NSU8oMHgyNDA4ICsgNCkKLQorI2RlZmlu
ZSBNSV9QUkVESUNBVEVfREFUQSAgICAgICBfTU1JTygweDI0MTApCisjZGVmaW5lIE1JX1BSRURJ
Q0FURV9SRVNVTFQgICAgIF9NTUlPKDB4MjQxOCkKKyNkZWZpbmUgTUlfUFJFRElDQVRFX1JFU1VM
VF8xICAgX01NSU8oMHgyNDFjKQogI2RlZmluZSBNSV9QUkVESUNBVEVfUkVTVUxUXzIJX01NSU8o
MHgyMjE0KQogI2RlZmluZSAgTE9XRVJfU0xJQ0VfRU5BQkxFRAkoMSA8PCAwKQogI2RlZmluZSAg
TE9XRVJfU0xJQ0VfRElTQUJMRUQJKDAgPDwgMCkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2xpdmVfc2VsZnRlc3RzLmggYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9zZWxmdGVzdHMvaTkxNV9saXZlX3NlbGZ0ZXN0cy5oCmluZGV4IDY3MTNlZmVhMzUwYi4u
NmRhZjY1OTllYzc5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aTkxNV9saXZlX3NlbGZ0ZXN0cy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pOTE1X2xpdmVfc2VsZnRlc3RzLmgKQEAgLTM1LDMgKzM1LDQgQEAgc2VsZnRlc3QocmVzZXQs
IGludGVsX3Jlc2V0X2xpdmVfc2VsZnRlc3RzKQogc2VsZnRlc3QoaGFuZ2NoZWNrLCBpbnRlbF9o
YW5nY2hlY2tfbGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChleGVjbGlzdHMsIGludGVsX2V4ZWNs
aXN0c19saXZlX3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KGd1YywgaW50ZWxfZ3VjX2xpdmVfc2VsZnRl
c3QpCitzZWxmdGVzdChwZXJmLCBpOTE1X3BlcmZfbGl2ZV9zZWxmdGVzdHMpCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9wZXJmLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9wZXJmLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5k
ZXggMDAwMDAwMDAwMDAwLi5hNjI4ODU0ZGRhMDIKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9wZXJmLmMKQEAgLTAsMCArMSwyMTcgQEAKKy8q
CisgKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUCisgKgorICogQ29weXJpZ2h0IMKpIDIw
MTkgSW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaW5jbHVkZSA8bGludXgva3JlZi5oPgorCisj
aW5jbHVkZSAiZ2VtL2k5MTVfZ2VtX3BtLmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfZ3QuaCIKKwor
I2luY2x1ZGUgImk5MTVfc2VsZnRlc3QuaCIKKworI2luY2x1ZGUgImlndF9mbHVzaF90ZXN0Lmgi
CisjaW5jbHVkZSAibGliX3N3X2ZlbmNlLmgiCisKK3N0YXRpYyBzdHJ1Y3QgaTkxNV9wZXJmX3N0
cmVhbSAqCit0ZXN0X3N0cmVhbShzdHJ1Y3QgaTkxNV9wZXJmICpwZXJmKQoreworCXN0cnVjdCBk
cm1faTkxNV9wZXJmX29wZW5fcGFyYW0gcGFyYW0gPSB7fTsKKwlzdHJ1Y3QgcGVyZl9vcGVuX3By
b3BlcnRpZXMgcHJvcHMgPSB7CisJCS5lbmdpbmUgPSBpbnRlbF9lbmdpbmVfbG9va3VwX3VzZXIo
cGVyZi0+aTkxNSwKKwkJCQkJCSAgIEk5MTVfRU5HSU5FX0NMQVNTX1JFTkRFUiwKKwkJCQkJCSAg
IDApLAorCQkuc2FtcGxlX2ZsYWdzID0gU0FNUExFX09BX1JFUE9SVCwKKwkJLm9hX2Zvcm1hdCA9
IEk5MTVfT0FfRk9STUFUX0M0X0I4LAorCQkubWV0cmljc19zZXQgPSAxLAorCX07CisJc3RydWN0
IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbTsKKworCXN0cmVhbSA9IGt6YWxsb2Moc2l6ZW9mKCpz
dHJlYW0pLCBHRlBfS0VSTkVMKTsKKwlpZiAoIXN0cmVhbSkKKwkJcmV0dXJuIE5VTEw7CisKKwlz
dHJlYW0tPnBlcmYgPSBwZXJmOworCXN0cmVhbS0+Z3QgPSAmcGVyZi0+aTkxNS0+Z3Q7CisKKwlt
dXRleF9sb2NrKCZwZXJmLT5sb2NrKTsKKwlpZiAoaTkxNV9vYV9zdHJlYW1faW5pdChzdHJlYW0s
ICZwYXJhbSwgJnByb3BzKSkgeworCQlrZnJlZShzdHJlYW0pOworCQlzdHJlYW0gPSAgTlVMTDsK
Kwl9CisJbXV0ZXhfdW5sb2NrKCZwZXJmLT5sb2NrKTsKKworCXJldHVybiBzdHJlYW07Cit9CisK
K3N0YXRpYyB2b2lkIHN0cmVhbV9kZXN0cm95KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJl
YW0pCit7CisJc3RydWN0IGk5MTVfcGVyZiAqcGVyZiA9IHN0cmVhbS0+cGVyZjsKKworCW11dGV4
X2xvY2soJnBlcmYtPmxvY2spOworCWk5MTVfcGVyZl9kZXN0cm95X2xvY2tlZChzdHJlYW0pOwor
CW11dGV4X3VubG9jaygmcGVyZi0+bG9jayk7Cit9CisKK3N0YXRpYyBpbnQgbGl2ZV9zYW5pdHlj
aGVjayh2b2lkICphcmcpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7
CisJc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbTsKKworCS8qIFF1aWNrIGNoZWNrIHdl
IGNhbiBjcmVhdGUgYSBwZXJmIHN0cmVhbSAqLworCisJc3RyZWFtID0gdGVzdF9zdHJlYW0oJmk5
MTUtPnBlcmYpOworCWlmICghc3RyZWFtKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCXN0cmVhbV9k
ZXN0cm95KHN0cmVhbSk7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgd3JpdGVfdGltZXN0
YW1wKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBpbnQgc2xvdCkKK3sKKwl1MzIgKmNzOworCWlu
dCBsZW47CisKKwljcyA9IGludGVsX3JpbmdfYmVnaW4ocnEsIDYpOworCWlmIChJU19FUlIoY3Mp
KQorCQlyZXR1cm4gUFRSX0VSUihjcyk7CisKKwlsZW4gPSA1OworCWlmIChJTlRFTF9HRU4ocnEt
Pmk5MTUpID49IDgpCisJCWxlbisrOworCisJKmNzKysgPSBHRlhfT1BfUElQRV9DT05UUk9MKGxl
bik7CisJKmNzKysgPSBQSVBFX0NPTlRST0xfR0xPQkFMX0dUVF9JVkIgfAorCQlQSVBFX0NPTlRS
T0xfU1RPUkVfREFUQV9JTkRFWCB8CisJCVBJUEVfQ09OVFJPTF9XUklURV9USU1FU1RBTVA7CisJ
KmNzKysgPSBzbG90ICogc2l6ZW9mKHUzMik7CisJKmNzKysgPSAwOworCSpjcysrID0gMDsKKwkq
Y3MrKyA9IDA7CisKKwlpbnRlbF9yaW5nX2FkdmFuY2UocnEsIGNzKTsKKworCXJldHVybiAwOwor
fQorCitzdGF0aWMga3RpbWVfdCBwb2xsX3N0YXR1cyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwg
aW50IHNsb3QpCit7CisJd2hpbGUgKCFpbnRlbF9yZWFkX3N0YXR1c19wYWdlKHJxLT5lbmdpbmUs
IHNsb3QpICYmCisJICAgICAgICFpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJxKSkKKwkJY3B1X3Jl
bGF4KCk7CisKKwlyZXR1cm4ga3RpbWVfZ2V0KCk7Cit9CisKK3N0YXRpYyBpbnQgbGl2ZV9ub2Ff
ZGVsYXkodm9pZCAqYXJnKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJn
OworCXN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW07CisJc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnE7CisJa3RpbWVfdCB0MCwgdDE7CisJdTY0IGV4cGVjdGVkOworCXUzMiBkZWxheTsKKwlp
bnQgZXJyOworCWludCBpOworCisJLyogQ2hlY2sgdGhhdCB0aGUgR1BVIGRlbGF5cyBtYXRjaGVz
IGV4cGVjdGF0aW9ucyAqLworCisJc3RyZWFtID0gdGVzdF9zdHJlYW0oJmk5MTUtPnBlcmYpOwor
CWlmICghc3RyZWFtKQorCQlyZXR1cm4gLUVOT01FTTsKKworCWV4cGVjdGVkID0gYXRvbWljNjRf
cmVhZCgmc3RyZWFtLT5wZXJmLT5ub2FfcHJvZ3JhbW1pbmdfZGVsYXkpOworCisJaWYgKHN0cmVh
bS0+ZW5naW5lLT5jbGFzcyAhPSBSRU5ERVJfQ0xBU1MpIHsKKwkJZXJyID0gLUVOT0RFVjsKKwkJ
Z290byBvdXQ7CisJfQorCisJZm9yIChpID0gMDsgaSA8IDQ7IGkrKykKKwkJaW50ZWxfd3JpdGVf
c3RhdHVzX3BhZ2Uoc3RyZWFtLT5lbmdpbmUsIDB4MTAwICsgaSwgMCk7CisKKwlycSA9IGk5MTVf
cmVxdWVzdF9jcmVhdGUoc3RyZWFtLT5lbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKKwlpZiAoSVNf
RVJSKHJxKSkgeworCQllcnIgPSBQVFJfRVJSKHJxKTsKKwkJZ290byBvdXQ7CisJfQorCisJaWYg
KHJxLT5lbmdpbmUtPmVtaXRfaW5pdF9icmVhZGNydW1iICYmCisJICAgIGk5MTVfcmVxdWVzdF90
aW1lbGluZShycSktPmhhc19pbml0aWFsX2JyZWFkY3J1bWIpIHsKKwkJZXJyID0gcnEtPmVuZ2lu
ZS0+ZW1pdF9pbml0X2JyZWFkY3J1bWIocnEpOworCQlpZiAoZXJyKSB7CisJCQlpOTE1X3JlcXVl
c3RfYWRkKHJxKTsKKwkJCWdvdG8gb3V0OworCQl9CisJfQorCisJZXJyID0gd3JpdGVfdGltZXN0
YW1wKHJxLCAweDEwMCk7CisJaWYgKGVycikgeworCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKwkJ
Z290byBvdXQ7CisJfQorCisJZXJyID0gcnEtPmVuZ2luZS0+ZW1pdF9iYl9zdGFydChycSwKKwkJ
CQkJaTkxNV9nZ3R0X29mZnNldChzdHJlYW0tPm5vYV93YWl0KSwgMCwKKwkJCQkJSTkxNV9ESVNQ
QVRDSF9TRUNVUkUpOworCWlmIChlcnIpIHsKKwkJaTkxNV9yZXF1ZXN0X2FkZChycSk7CisJCWdv
dG8gb3V0OworCX0KKworCWVyciA9IHdyaXRlX3RpbWVzdGFtcChycSwgMHgxMDIpOworCWlmIChl
cnIpIHsKKwkJaTkxNV9yZXF1ZXN0X2FkZChycSk7CisJCWdvdG8gb3V0OworCX0KKworCWk5MTVf
cmVxdWVzdF9nZXQocnEpOworCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCisJcHJlZW1wdF9kaXNh
YmxlKCk7CisJdDAgPSBwb2xsX3N0YXR1cyhycSwgMHgxMDApOworCXQxID0gcG9sbF9zdGF0dXMo
cnEsIDB4MTAyKTsKKwlwcmVlbXB0X2VuYWJsZSgpOworCisJcHJfaW5mbygiQ1BVIGRlbGF5OiAl
bGx1bnMsIGV4cGVjdGVkICVsbHVuc1xuIiwKKwkJa3RpbWVfc3ViKHQxLCB0MCksIGV4cGVjdGVk
KTsKKworCWRlbGF5ID0gaW50ZWxfcmVhZF9zdGF0dXNfcGFnZShzdHJlYW0tPmVuZ2luZSwgMHgx
MDIpOworCWRlbGF5IC09IGludGVsX3JlYWRfc3RhdHVzX3BhZ2Uoc3RyZWFtLT5lbmdpbmUsIDB4
MTAwKTsKKwlkZWxheSA9IGRpdl91NjQobXVsX3UzMl91MzIoZGVsYXksIDEwMDAgKiAxMDAwKSwK
KwkJCVJVTlRJTUVfSU5GTyhpOTE1KS0+Y3NfdGltZXN0YW1wX2ZyZXF1ZW5jeV9raHopOworCXBy
X2luZm8oIkdQVSBkZWxheTogJXVucywgZXhwZWN0ZWQgJWxsdW5zXG4iLAorCQlkZWxheSwgZXhw
ZWN0ZWQpOworCisJaWYgKDQgKiBkZWxheSA8IDMgKiBleHBlY3RlZCB8fCAyICogZGVsYXkgPiAz
ICogZXhwZWN0ZWQpIHsKKwkJcHJfZXJyKCJHUFUgZGVsYXkgWyV1dXNdIG91dHNpZGUgb2YgZXhw
ZWN0ZWQgdGhyZXNob2xkISBbJWxsdXVzLCAlbGx1dXNdXG4iLAorCQkgICAgICAgZGVsYXkgLyAx
MDAwLAorCQkgICAgICAgZGl2X3U2NCgzICogZXhwZWN0ZWQsIDQwMDApLAorCQkgICAgICAgZGl2
X3U2NCgzICogZXhwZWN0ZWQsIDIwMDApKTsKKwkJZXJyID0gLUVJTlZBTDsKKwl9CisKKwlpOTE1
X3JlcXVlc3RfcHV0KHJxKTsKK291dDoKKwlzdHJlYW1fZGVzdHJveShzdHJlYW0pOworCXJldHVy
biBlcnI7Cit9CisKK2ludCBpOTE1X3BlcmZfbGl2ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCit7CisJc3RhdGljIGNvbnN0IHN0cnVjdCBpOTE1X3N1YnRlc3QgdGVz
dHNbXSA9IHsKKwkJU1VCVEVTVChsaXZlX3Nhbml0eWNoZWNrKSwKKwkJU1VCVEVTVChsaXZlX25v
YV9kZWxheSksCisJfTsKKwlzdHJ1Y3QgaTkxNV9wZXJmICpwZXJmID0gJmk5MTUtPnBlcmY7CisK
KwlpZiAoIXBlcmYtPm1ldHJpY3Nfa29iaiB8fCAhcGVyZi0+b3BzLmVuYWJsZV9tZXRyaWNfc2V0
KQorCQlyZXR1cm4gMDsKKworCWlmIChpbnRlbF9ndF9pc193ZWRnZWQoJmk5MTUtPmd0KSkKKwkJ
cmV0dXJuIDA7CisKKwlyZXR1cm4gaTkxNV9zdWJ0ZXN0cyh0ZXN0cywgaTkxNSk7Cit9Ci0tIAoy
LjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCklu
dGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

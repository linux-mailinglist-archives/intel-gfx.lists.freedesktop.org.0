Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id B3A713CB17
	for <lists+intel-gfx@lfdr.de>; Tue, 11 Jun 2019 14:23:56 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0A574891CC;
	Tue, 11 Jun 2019 12:23:55 +0000 (UTC)
X-Original-To: Intel-gfx@lists.freedesktop.org
Delivered-To: Intel-gfx@lists.freedesktop.org
Received: from mga12.intel.com (mga12.intel.com [192.55.52.136])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 43CF8891CC
 for <Intel-gfx@lists.freedesktop.org>; Tue, 11 Jun 2019 12:23:54 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by fmsmga106.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 11 Jun 2019 05:23:53 -0700
X-ExtLoop1: 1
Received: from nmanovic-mobl.ccr.corp.intel.com (HELO localhost.localdomain)
 ([10.252.13.223])
 by fmsmga007.fm.intel.com with ESMTP; 11 Jun 2019 05:23:52 -0700
From: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>
To: Intel-gfx@lists.freedesktop.org
Date: Tue, 11 Jun 2019 13:23:50 +0100
Message-Id: <20190611122350.15060-1-tvrtko.ursulin@linux.intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190611110044.7742-2-tvrtko.ursulin@linux.intel.com>
References: <20190611110044.7742-2-tvrtko.ursulin@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v4 2/2] drm/i915: Make GuC GGTT reservation work
 on ggtt
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KClRoZXNlIGZ1
bmN0aW9ucyBvcGVyYXRlIG9uIGdndHQgc28gbWFrZSB0aGVtIHRha2UgdGhhdCBkaXJlY3RseSBh
cwpwYXJhbWV0ZXIuCgpBdCB0aGUgc2FtZSB0aW1lIG1vdmUgdGhlIFVTRVNfR1VDIGNvbmRpdGlv
bmFsIGRvd24gdG8KaW50ZWxfZ3VjX3Jlc2VydmVfZ2d0dF90b3AgZm9yIHN5bW1ldHJ5IHdpdGgK
aW50ZWxfZ3VjX3Jlc2VydmVkX2d0dF9zaXplLgoKdjI6CiAqIFJlbmFtZSBhbmQgbW92ZSBmdW5j
dGlvbnMgdG8gYmUgc3RhdGljIGluIGk5MTVfZ2VtX2d0dC5jIChNaWNoYWwpCgp2MzoKICogQWRk
IGNvbW1lbnQgZXhwbGFpbmluZyByZWFzb24gZm9yIHJlc2VydmF0aW9uLCBhZGQgYXNzZXJ0IGFu
ZCBmaXgKICAgZXJyb3IgbWVzc2FnZS4gKE1pY2hhbCkKCnY0OgogKiBGaXggY2hlY2twYXRjaCBl
cnJvci4KClNpZ25lZC1vZmYtYnk6IFR2cnRrbyBVcnN1bGluIDx0dnJ0a28udXJzdWxpbkBpbnRl
bC5jb20+CkNjOiBNaWNoYWwgV2FqZGVjemtvIDxtaWNoYWwud2FqZGVjemtvQGludGVsLmNvbT4K
UmV2aWV3ZWQtYnk6IE1pY2hhbCBXYWpkZWN6a28gPG1pY2hhbC53YWpkZWN6a29AaW50ZWwuY29t
PgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jIHwgNDMgKysrKysrKysr
KysrKysrKysrKysrKysrLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5jICAg
IHwgMjcgLS0tLS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWMu
aCAgICB8ICAyIC0tCiAzIGZpbGVzIGNoYW5nZWQsIDM2IGluc2VydGlvbnMoKyksIDM2IGRlbGV0
aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKaW5kZXggNWI1MTI1ZWU0OWYz
Li5jMTNiNTJiNjZlZjEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2Vt
X2d0dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCkBAIC0yODA3
LDYgKzI4MDcsMzIgQEAgc3RhdGljIHZvaWQgZmluaV9hbGlhc2luZ19wcGd0dChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAlnZ3R0LT52bS52bWFfb3BzLnVuYmluZF92bWEgPSBnZ3R0
X3VuYmluZF92bWE7CiB9CiAKK3N0YXRpYyBpbnQgZ2d0dF9yZXNlcnZlX2d1Y190b3Aoc3RydWN0
IGk5MTVfZ2d0dCAqZ2d0dCkKK3sKKwl1NjQgc2l6ZTsKKwlpbnQgcmV0OworCisJaWYgKCFVU0VT
X0dVQyhnZ3R0LT52bS5pOTE1KSkKKwkJcmV0dXJuIDA7CisKKwlHRU1fQlVHX09OKGdndHQtPnZt
LnRvdGFsIDw9IEdVQ19HR1RUX1RPUCk7CisJc2l6ZSA9IGdndHQtPnZtLnRvdGFsIC0gR1VDX0dH
VFRfVE9QOworCisJcmV0ID0gaTkxNV9nZW1fZ3R0X3Jlc2VydmUoJmdndHQtPnZtLCAmZ2d0dC0+
dWNfZncsIHNpemUsCisJCQkJICAgR1VDX0dHVFRfVE9QLCBJOTE1X0NPTE9SX1VORVZJQ1RBQkxF
LAorCQkJCSAgIFBJTl9OT0VWSUNUKTsKKwlpZiAocmV0KQorCQlEUk1fREVCVUdfRFJJVkVSKCJG
YWlsZWQgdG8gcmVzZXJ2ZSB0b3Agb2YgR0dUVCBmb3IgR3VDXG4iKTsKKworCXJldHVybiByZXQ7
Cit9CisKK3N0YXRpYyB2b2lkIGdndHRfcmVsZWFzZV9ndWNfdG9wKHN0cnVjdCBpOTE1X2dndHQg
KmdndHQpCit7CisJaWYgKGRybV9tbV9ub2RlX2FsbG9jYXRlZCgmZ2d0dC0+dWNfZncpKQorCQlk
cm1fbW1fcmVtb3ZlX25vZGUoJmdndHQtPnVjX2Z3KTsKK30KKwogaW50IGk5MTVfZ2VtX2luaXRf
Z2d0dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7CiAJLyogTGV0IEdFTSBN
YW5hZ2UgYWxsIG9mIHRoZSBhcGVydHVyZS4KQEAgLTI4NDQsMTEgKzI4NzAsMTQgQEAgaW50IGk5
MTVfZ2VtX2luaXRfZ2d0dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJaWYg
KHJldCkKIAkJcmV0dXJuIHJldDsKIAotCWlmIChVU0VTX0dVQyhkZXZfcHJpdikpIHsKLQkJcmV0
ID0gaW50ZWxfZ3VjX3Jlc2VydmVfZ2d0dF90b3AoJmRldl9wcml2LT5ndWMpOwotCQlpZiAocmV0
KQotCQkJZ290byBlcnJfcmVzZXJ2ZTsKLQl9CisJLyoKKwkgKiBUaGUgdXBwZXIgcG9ydGlvbiBv
ZiB0aGUgR3VDIGFkZHJlc3Mgc3BhY2UgaGFzIGEgc2l6ZWFibGUgaG9sZQorCSAqIChzZXZlcmFs
IE1CKSB0aGF0IGlzIGluYWNjZXNzaWJsZSBieSBHdUMuIFJlc2VydmUgdGhpcyByYW5nZSB3aXRo
aW4KKwkgKiBHR1RUIGFzIGl0IGNhbiBjb21mb3J0YWJseSBob2xkIEd1Qy9IdUMgZmlybXdhcmUg
aW1hZ2VzLgorCSAqLworCXJldCA9IGdndHRfcmVzZXJ2ZV9ndWNfdG9wKGdndHQpOworCWlmIChy
ZXQpCisJCWdvdG8gZXJyX3Jlc2VydmU7CiAKIAkvKiBDbGVhciBhbnkgbm9uLXByZWFsbG9jYXRl
ZCBibG9ja3MgKi8KIAlkcm1fbW1fZm9yX2VhY2hfaG9sZShlbnRyeSwgJmdndHQtPnZtLm1tLCBo
b2xlX3N0YXJ0LCBob2xlX2VuZCkgewpAQCAtMjg3MCw3ICsyODk5LDcgQEAgaW50IGk5MTVfZ2Vt
X2luaXRfZ2d0dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJcmV0dXJuIDA7
CiAKIGVycl9hcHBndHQ6Ci0JaW50ZWxfZ3VjX3JlbGVhc2VfZ2d0dF90b3AoJmRldl9wcml2LT5n
dWMpOworCWdndHRfcmVsZWFzZV9ndWNfdG9wKGdndHQpOwogZXJyX3Jlc2VydmU6CiAJZHJtX21t
X3JlbW92ZV9ub2RlKCZnZ3R0LT5lcnJvcl9jYXB0dXJlKTsKIAlyZXR1cm4gcmV0OwpAQCAtMjg5
Nyw3ICsyOTI2LDcgQEAgdm9pZCBpOTE1X2dndHRfY2xlYW51cF9odyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpCiAJaWYgKGRybV9tbV9ub2RlX2FsbG9jYXRlZCgmZ2d0dC0+ZXJy
b3JfY2FwdHVyZSkpCiAJCWRybV9tbV9yZW1vdmVfbm9kZSgmZ2d0dC0+ZXJyb3JfY2FwdHVyZSk7
CiAKLQlpbnRlbF9ndWNfcmVsZWFzZV9nZ3R0X3RvcCgmZGV2X3ByaXYtPmd1Yyk7CisJZ2d0dF9y
ZWxlYXNlX2d1Y190b3AoZ2d0dCk7CiAKIAlpZiAoZHJtX21tX2luaXRpYWxpemVkKCZnZ3R0LT52
bS5tbSkpIHsKIAkJaW50ZWxfdmd0X2RlYmFsbG9vbihkZXZfcHJpdik7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2lu
dGVsX2d1Yy5jCmluZGV4IGQ0NWQ5NzYyNDQwMi4uYzQwYTZlZmRkMzNhIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9ndWMuYwpAQCAtNjg1LDMwICs2ODUsMyBAQCBzdHJ1Y3QgaTkxNV92bWEgKmludGVs
X2d1Y19hbGxvY2F0ZV92bWEoc3RydWN0IGludGVsX2d1YyAqZ3VjLCB1MzIgc2l6ZSkKIAlpOTE1
X2dlbV9vYmplY3RfcHV0KG9iaik7CiAJcmV0dXJuIHZtYTsKIH0KLQotaW50IGludGVsX2d1Y19y
ZXNlcnZlX2dndHRfdG9wKHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKLXsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IGd1Y190b19pOTE1KGd1Yyk7Ci0Jc3RydWN0IGk5MTVfZ2d0dCAq
Z2d0dCA9ICZpOTE1LT5nZ3R0OwotCXU2NCBzaXplOwotCWludCByZXQ7Ci0KLQlzaXplID0gZ2d0
dC0+dm0udG90YWwgLSBHVUNfR0dUVF9UT1A7Ci0KLQlyZXQgPSBpOTE1X2dlbV9ndHRfcmVzZXJ2
ZSgmZ2d0dC0+dm0sICZnZ3R0LT51Y19mdywgc2l6ZSwKLQkJCQkgICBHVUNfR0dUVF9UT1AsIEk5
MTVfQ09MT1JfVU5FVklDVEFCTEUsCi0JCQkJICAgUElOX05PRVZJQ1QpOwotCWlmIChyZXQpCi0J
CURSTV9ERUJVR19EUklWRVIoIkd1QzogZmFpbGVkIHRvIHJlc2VydmUgdG9wIG9mIGdndHRcbiIp
OwotCi0JcmV0dXJuIHJldDsKLX0KLQotdm9pZCBpbnRlbF9ndWNfcmVsZWFzZV9nZ3R0X3RvcChz
dHJ1Y3QgaW50ZWxfZ3VjICpndWMpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSBndWNfdG9faTkxNShndWMpOwotCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSAmaTkxNS0+Z2d0
dDsKLQotCWlmIChkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJmdndHQtPnVjX2Z3KSkKLQkJZHJtX21t
X3JlbW92ZV9ub2RlKCZnZ3R0LT51Y19mdyk7Ci19CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9ndWMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5oCmlu
ZGV4IDg1YzNiMDJhMGMwOC4uMDhjOTA2YWJkZmEyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9ndWMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWMu
aApAQCAtMTcyLDggKzE3Miw2IEBAIGludCBpbnRlbF9ndWNfYXV0aF9odWMoc3RydWN0IGludGVs
X2d1YyAqZ3VjLCB1MzIgcnNhX29mZnNldCk7CiBpbnQgaW50ZWxfZ3VjX3N1c3BlbmQoc3RydWN0
IGludGVsX2d1YyAqZ3VjKTsKIGludCBpbnRlbF9ndWNfcmVzdW1lKHN0cnVjdCBpbnRlbF9ndWMg
Kmd1Yyk7CiBzdHJ1Y3QgaTkxNV92bWEgKmludGVsX2d1Y19hbGxvY2F0ZV92bWEoc3RydWN0IGlu
dGVsX2d1YyAqZ3VjLCB1MzIgc2l6ZSk7Ci1pbnQgaW50ZWxfZ3VjX3Jlc2VydmVfZ2d0dF90b3Ao
c3RydWN0IGludGVsX2d1YyAqZ3VjKTsKLXZvaWQgaW50ZWxfZ3VjX3JlbGVhc2VfZ2d0dF90b3Ao
c3RydWN0IGludGVsX2d1YyAqZ3VjKTsKIAogc3RhdGljIGlubGluZSBib29sIGludGVsX2d1Y19p
c19sb2FkZWQoc3RydWN0IGludGVsX2d1YyAqZ3VjKQogewotLSAKMi4yMC4xCgpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBs
aXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7A906AEEB1
	for <lists+intel-gfx@lfdr.de>; Tue, 10 Sep 2019 17:43:09 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D6DF06E91A;
	Tue, 10 Sep 2019 15:43:07 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga05.intel.com (mga05.intel.com [192.55.52.43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5F07A6E91A
 for <intel-gfx@lists.freedesktop.org>; Tue, 10 Sep 2019 15:43:06 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga002.fm.intel.com ([10.253.24.26])
 by fmsmga105.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 10 Sep 2019 08:43:06 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,489,1559545200"; d="scan'208";a="214345967"
Received: from mdroper-desk.fm.intel.com ([10.105.128.12])
 by fmsmga002.fm.intel.com with ESMTP; 10 Sep 2019 08:43:06 -0700
From: Matt Roper <matthew.d.roper@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 10 Sep 2019 08:42:47 -0700
Message-Id: <20190910154252.30503-4-matthew.d.roper@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190910154252.30503-1-matthew.d.roper@intel.com>
References: <20190910154252.30503-1-matthew.d.roper@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v4 3/8] drm/i915: Combine bxt_set_cdclk and
 cnl_set_cdclk
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UnZCBwcmV2aW91c2x5IGNvbWJpbmVkIElDTC9UR0wgbG9naWMgaW50byB0aGUgY25sX3NldF9j
ZGNsayBmdW5jdGlvbiwKYnV0IEJYVCBpcyBwcmV0dHkgc2ltaWxhciBhcyB3ZWxsLiAgUm9sbCB0
aGUgY25sL2ljbC90Z2wgbG9naWMgYmFjayBpbnRvCnRoZSBieHQgZnVuY3Rpb247IHRoZSBvbmx5
IHRoaW5ncyB3ZSByZWFsbHkgbmVlZCB0byBoYW5kbGUgc2VwYXJhdGVseQphcmUgcHVuaXQgbm90
aWZpY2F0aW9uIGFuZCBjYWxsaW5nIGRpZmZlcmVudCBmdW5jdGlvbnMgdG8gZW5hYmxlL2Rpc2Fi
bGUKdGhlIGNkY2xrIFBMTC4KCkNjOiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFAbGlu
dXguaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBNYXR0IFJvcGVyIDxtYXR0aGV3LmQucm9wZXJA
aW50ZWwuY29tPgpSZXZpZXdlZC1ieTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxp
bnV4LmludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Nk
Y2xrLmMgfCAyNjcgKysrKysrKysrLS0tLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgMTE5IGlu
c2VydGlvbnMoKyksIDE0OCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2NkY2xrLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2NkY2xrLmMKaW5kZXggYzhjZjI4OGI4ZThlLi4xNDIyOWM2OGQ0YmUgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY2RjbGsuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NkY2xrLmMKQEAgLTE0NDAsNiArMTQ0
MCwzOSBAQCBzdGF0aWMgdm9pZCBieHRfZGVfcGxsX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsIGludCB2Y28pCiAJZGV2X3ByaXYtPmNkY2xrLmh3LnZjbyA9IHZjbzsK
IH0KIAorc3RhdGljIHZvaWQgY25sX2NkY2xrX3BsbF9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKK3sKKwl1MzIgdmFsOworCisJdmFsID0gSTkxNV9SRUFEKEJYVF9E
RV9QTExfRU5BQkxFKTsKKwl2YWwgJj0gfkJYVF9ERV9QTExfUExMX0VOQUJMRTsKKwlJOTE1X1dS
SVRFKEJYVF9ERV9QTExfRU5BQkxFLCB2YWwpOworCisJLyogVGltZW91dCAyMDB1cyAqLworCWlm
ICh3YWl0X2ZvcigoSTkxNV9SRUFEKEJYVF9ERV9QTExfRU5BQkxFKSAmIEJYVF9ERV9QTExfTE9D
SykgPT0gMCwgMSkpCisJCURSTV9FUlJPUigidGltZW91dCB3YWl0aW5nIGZvciBDRENMSyBQTEwg
dW5sb2NrXG4iKTsKKworCWRldl9wcml2LT5jZGNsay5ody52Y28gPSAwOworfQorCitzdGF0aWMg
dm9pZCBjbmxfY2RjbGtfcGxsX2VuYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsIGludCB2Y28pCit7CisJaW50IHJhdGlvID0gRElWX1JPVU5EX0NMT1NFU1QodmNvLCBkZXZf
cHJpdi0+Y2RjbGsuaHcucmVmKTsKKwl1MzIgdmFsOworCisJdmFsID0gQ05MX0NEQ0xLX1BMTF9S
QVRJTyhyYXRpbyk7CisJSTkxNV9XUklURShCWFRfREVfUExMX0VOQUJMRSwgdmFsKTsKKworCXZh
bCB8PSBCWFRfREVfUExMX1BMTF9FTkFCTEU7CisJSTkxNV9XUklURShCWFRfREVfUExMX0VOQUJM
RSwgdmFsKTsKKworCS8qIFRpbWVvdXQgMjAwdXMgKi8KKwlpZiAod2FpdF9mb3IoKEk5MTVfUkVB
RChCWFRfREVfUExMX0VOQUJMRSkgJiBCWFRfREVfUExMX0xPQ0spICE9IDAsIDEpKQorCQlEUk1f
RVJST1IoInRpbWVvdXQgd2FpdGluZyBmb3IgQ0RDTEsgUExMIGxvY2tcbiIpOworCisJZGV2X3By
aXYtPmNkY2xrLmh3LnZjbyA9IHZjbzsKK30KKwogc3RhdGljIHZvaWQgYnh0X3NldF9jZGNsayhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkgIGNvbnN0IHN0cnVjdCBpbnRl
bF9jZGNsa19zdGF0ZSAqY2RjbGtfc3RhdGUsCiAJCQkgIGVudW0gcGlwZSBwaXBlKQpAQCAtMTQ0
OSw2ICsxNDgyLDI3IEBAIHN0YXRpYyB2b2lkIGJ4dF9zZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAogCXUzMiB2YWwsIGRpdmlkZXI7CiAJaW50IHJldDsKIAorCS8q
IEluZm9ybSBwb3dlciBjb250cm9sbGVyIG9mIHVwY29taW5nIGZyZXF1ZW5jeSBjaGFuZ2UuICov
CisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTApCisJCXJldCA9IHNrbF9wY29kZV9yZXF1
ZXN0KGRldl9wcml2LCBTS0xfUENPREVfQ0RDTEtfQ09OVFJPTCwKKwkJCQkJU0tMX0NEQ0xLX1BS
RVBBUkVfRk9SX0NIQU5HRSwKKwkJCQkJU0tMX0NEQ0xLX1JFQURZX0ZPUl9DSEFOR0UsCisJCQkJ
CVNLTF9DRENMS19SRUFEWV9GT1JfQ0hBTkdFLCAzKTsKKwllbHNlCisJCS8qCisJCSAqIEJTcGVj
IHJlcXVpcmVzIHVzIHRvIHdhaXQgdXAgdG8gMTUwdXNlYywgYnV0IHRoYXQgbGVhZHMgdG8KKwkJ
ICogdGltZW91dHM7IHRoZSAybXMgdXNlZCBoZXJlIGlzIGJhc2VkIG9uIGV4cGVyaW1lbnQuCisJ
CSAqLworCQlyZXQgPSBzYW5keWJyaWRnZV9wY29kZV93cml0ZV90aW1lb3V0KGRldl9wcml2LAor
CQkJCQkJICAgICAgSFNXX1BDT0RFX0RFX1dSSVRFX0ZSRVFfUkVRLAorCQkJCQkJICAgICAgMHg4
MDAwMDAwMCwgMTUwLCAyKTsKKworCWlmIChyZXQpIHsKKwkJRFJNX0VSUk9SKCJGYWlsZWQgdG8g
aW5mb3JtIFBDVSBhYm91dCBjZGNsayBjaGFuZ2UgKGVyciAlZCwgZnJlcSAlZClcbiIsCisJCQkg
IHJldCwgY2RjbGspOworCQlyZXR1cm47CisJfQorCiAJLyogY2RjbGsgPSB2Y28gLyAyIC8gZGl2
ezEsMS41LDIsNH0gKi8KIAlzd2l0Y2ggKERJVl9ST1VORF9DTE9TRVNUKHZjbywgY2RjbGspKSB7
CiAJZGVmYXVsdDoKQEAgLTE0NTksNjMgKzE1MTMsODIgQEAgc3RhdGljIHZvaWQgYnh0X3NldF9j
ZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCWRpdmlkZXIgPSBCWFRf
Q0RDTEtfQ0QyWF9ESVZfU0VMXzE7CiAJCWJyZWFrOwogCWNhc2UgMzoKLQkJV0FSTihJU19HRU1J
TklMQUtFKGRldl9wcml2KSwgIlVuc3VwcG9ydGVkIGRpdmlkZXJcbiIpOworCQlXQVJOKElTX0dF
TUlOSUxBS0UoZGV2X3ByaXYpIHx8IElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAsCisJCSAgICAg
IlVuc3VwcG9ydGVkIGRpdmlkZXJcbiIpOwogCQlkaXZpZGVyID0gQlhUX0NEQ0xLX0NEMlhfRElW
X1NFTF8xXzU7CiAJCWJyZWFrOwogCWNhc2UgNDoKIAkJZGl2aWRlciA9IEJYVF9DRENMS19DRDJY
X0RJVl9TRUxfMjsKIAkJYnJlYWs7CiAJY2FzZSA4OgorCQlXQVJOKElOVEVMX0dFTihkZXZfcHJp
dikgPj0gMTAsICJVbnN1cHBvcnRlZCBkaXZpZGVyXG4iKTsKIAkJZGl2aWRlciA9IEJYVF9DRENM
S19DRDJYX0RJVl9TRUxfNDsKIAkJYnJlYWs7CiAJfQogCi0JLyoKLQkgKiBJbmZvcm0gcG93ZXIg
Y29udHJvbGxlciBvZiB1cGNvbWluZyBmcmVxdWVuY3kgY2hhbmdlLiBCU3BlYwotCSAqIHJlcXVp
cmVzIHVzIHRvIHdhaXQgdXAgdG8gMTUwdXNlYywgYnV0IHRoYXQgbGVhZHMgdG8gdGltZW91dHM7
Ci0JICogdGhlIDJtcyB1c2VkIGhlcmUgaXMgYmFzZWQgb24gZXhwZXJpbWVudC4KLQkgKi8KLQly
ZXQgPSBzYW5keWJyaWRnZV9wY29kZV93cml0ZV90aW1lb3V0KGRldl9wcml2LAotCQkJCQkgICAg
ICBIU1dfUENPREVfREVfV1JJVEVfRlJFUV9SRVEsCi0JCQkJCSAgICAgIDB4ODAwMDAwMDAsIDE1
MCwgMik7Ci0JaWYgKHJldCkgewotCQlEUk1fRVJST1IoIlBDb2RlIENEQ0xLIGZyZXEgY2hhbmdl
IG5vdGlmeSBmYWlsZWQgKGVyciAlZCwgZnJlcSAlZClcbiIsCi0JCQkgIHJldCwgY2RjbGspOwot
CQlyZXR1cm47Ci0JfQorCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwKSB7CisJCWlmIChk
ZXZfcHJpdi0+Y2RjbGsuaHcudmNvICE9IDAgJiYKKwkJICAgIGRldl9wcml2LT5jZGNsay5ody52
Y28gIT0gdmNvKQorCQkJY25sX2NkY2xrX3BsbF9kaXNhYmxlKGRldl9wcml2KTsKIAotCWlmIChk
ZXZfcHJpdi0+Y2RjbGsuaHcudmNvICE9IDAgJiYKLQkgICAgZGV2X3ByaXYtPmNkY2xrLmh3LnZj
byAhPSB2Y28pCi0JCWJ4dF9kZV9wbGxfZGlzYWJsZShkZXZfcHJpdik7CisJCWlmIChkZXZfcHJp
di0+Y2RjbGsuaHcudmNvICE9IHZjbykKKwkJCWNubF9jZGNsa19wbGxfZW5hYmxlKGRldl9wcml2
LCB2Y28pOwogCi0JaWYgKGRldl9wcml2LT5jZGNsay5ody52Y28gIT0gdmNvKQotCQlieHRfZGVf
cGxsX2VuYWJsZShkZXZfcHJpdiwgdmNvKTsKKwl9IGVsc2UgeworCQlpZiAoZGV2X3ByaXYtPmNk
Y2xrLmh3LnZjbyAhPSAwICYmCisJCSAgICBkZXZfcHJpdi0+Y2RjbGsuaHcudmNvICE9IHZjbykK
KwkJCWJ4dF9kZV9wbGxfZGlzYWJsZShkZXZfcHJpdik7CisKKwkJaWYgKGRldl9wcml2LT5jZGNs
ay5ody52Y28gIT0gdmNvKQorCQkJYnh0X2RlX3BsbF9lbmFibGUoZGV2X3ByaXYsIHZjbyk7CisJ
fQogCiAJdmFsID0gZGl2aWRlciB8IHNrbF9jZGNsa19kZWNpbWFsKGNkY2xrKTsKLQlpZiAocGlw
ZSA9PSBJTlZBTElEX1BJUEUpCi0JCXZhbCB8PSBCWFRfQ0RDTEtfQ0QyWF9QSVBFX05PTkU7Ci0J
ZWxzZQotCQl2YWwgfD0gQlhUX0NEQ0xLX0NEMlhfUElQRShwaXBlKTsKKworCWlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDEyKSB7CisJCWlmIChwaXBlID09IElOVkFMSURfUElQRSkKKwkJCXZh
bCB8PSBUR0xfQ0RDTEtfQ0QyWF9QSVBFX05PTkU7CisJCWVsc2UKKwkJCXZhbCB8PSBUR0xfQ0RD
TEtfQ0QyWF9QSVBFKHBpcGUpOworCX0gZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAx
MSkgeworCQlpZiAocGlwZSA9PSBJTlZBTElEX1BJUEUpCisJCQl2YWwgfD0gSUNMX0NEQ0xLX0NE
MlhfUElQRV9OT05FOworCQllbHNlCisJCQl2YWwgfD0gSUNMX0NEQ0xLX0NEMlhfUElQRShwaXBl
KTsKKwl9IGVsc2UgeworCQlpZiAocGlwZSA9PSBJTlZBTElEX1BJUEUpCisJCQl2YWwgfD0gQlhU
X0NEQ0xLX0NEMlhfUElQRV9OT05FOworCQllbHNlCisJCQl2YWwgfD0gQlhUX0NEQ0xLX0NEMlhf
UElQRShwaXBlKTsKKwl9CisKIAkvKgogCSAqIERpc2FibGUgU1NBIFByZWNoYXJnZSB3aGVuIENE
IGNsb2NrIGZyZXF1ZW5jeSA8IDUwMCBNSHosCiAJICogZW5hYmxlIG90aGVyd2lzZS4KIAkgKi8K
LQlpZiAoY2RjbGsgPj0gNTAwMDAwKQorCWlmIChJU19HRU45X0xQKGRldl9wcml2KSAmJiBjZGNs
ayA+PSA1MDAwMDApCiAJCXZhbCB8PSBCWFRfQ0RDTEtfU1NBX1BSRUNIQVJHRV9FTkFCTEU7CiAJ
STkxNV9XUklURShDRENMS19DVEwsIHZhbCk7CiAKIAlpZiAocGlwZSAhPSBJTlZBTElEX1BJUEUp
CiAJCWludGVsX3dhaXRfZm9yX3ZibGFuayhkZXZfcHJpdiwgcGlwZSk7CiAKLQkvKgotCSAqIFRo
ZSB0aW1lb3V0IGlzbid0IHNwZWNpZmllZCwgdGhlIDJtcyB1c2VkIGhlcmUgaXMgYmFzZWQgb24K
LQkgKiBleHBlcmltZW50LgotCSAqIEZJWE1FOiBXYWl0aW5nIGZvciB0aGUgcmVxdWVzdCBjb21w
bGV0aW9uIGNvdWxkIGJlIGRlbGF5ZWQgdW50aWwKLQkgKiB0aGUgbmV4dCBQQ09ERSByZXF1ZXN0
IGJhc2VkIG9uIEJTcGVjLgotCSAqLwotCXJldCA9IHNhbmR5YnJpZGdlX3Bjb2RlX3dyaXRlX3Rp
bWVvdXQoZGV2X3ByaXYsCi0JCQkJCSAgICAgIEhTV19QQ09ERV9ERV9XUklURV9GUkVRX1JFUSwK
LQkJCQkJICAgICAgY2RjbGtfc3RhdGUtPnZvbHRhZ2VfbGV2ZWwsIDE1MCwgMik7CisJaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPj0gMTApIHsKKwkJcmV0ID0gc2FuZHlicmlkZ2VfcGNvZGVfd3Jp
dGUoZGV2X3ByaXYsIFNLTF9QQ09ERV9DRENMS19DT05UUk9MLAorCQkJCQkgICAgICBjZGNsa19z
dGF0ZS0+dm9sdGFnZV9sZXZlbCk7CisJfSBlbHNlIHsKKwkJLyoKKwkJICogVGhlIHRpbWVvdXQg
aXNuJ3Qgc3BlY2lmaWVkLCB0aGUgMm1zIHVzZWQgaGVyZSBpcyBiYXNlZCBvbgorCQkgKiBleHBl
cmltZW50LgorCQkgKiBGSVhNRTogV2FpdGluZyBmb3IgdGhlIHJlcXVlc3QgY29tcGxldGlvbiBj
b3VsZCBiZSBkZWxheWVkCisJCSAqIHVudGlsIHRoZSBuZXh0IFBDT0RFIHJlcXVlc3QgYmFzZWQg
b24gQlNwZWMuCisJCSAqLworCQlyZXQgPSBzYW5keWJyaWRnZV9wY29kZV93cml0ZV90aW1lb3V0
KGRldl9wcml2LAorCQkJCQkJICAgICAgSFNXX1BDT0RFX0RFX1dSSVRFX0ZSRVFfUkVRLAorCQkJ
CQkJICAgICAgY2RjbGtfc3RhdGUtPnZvbHRhZ2VfbGV2ZWwsCisJCQkJCQkgICAgICAxNTAsIDIp
OworCX0KKwogCWlmIChyZXQpIHsKIAkJRFJNX0VSUk9SKCJQQ29kZSBDRENMSyBmcmVxIHNldCBm
YWlsZWQsIChlcnIgJWQsIGZyZXEgJWQpXG4iLAogCQkJICByZXQsIGNkY2xrKTsKQEAgLTE1MjMs
NiArMTU5NiwxMyBAQCBzdGF0aWMgdm9pZCBieHRfc2V0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKIAl9CiAKIAlpbnRlbF91cGRhdGVfY2RjbGsoZGV2X3ByaXYpOwor
CisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTApCisJCS8qCisJCSAqIENhbid0IHJlYWQg
b3V0IHRoZSB2b2x0YWdlIGxldmVsIDooCisJCSAqIExldCdzIGp1c3QgYXNzdW1lIGV2ZXJ5dGhp
bmcgaXMgYXMgZXhwZWN0ZWQuCisJCSAqLworCQlkZXZfcHJpdi0+Y2RjbGsuaHcudm9sdGFnZV9s
ZXZlbCA9IGNkY2xrX3N0YXRlLT52b2x0YWdlX2xldmVsOwogfQogCiBzdGF0aWMgdm9pZCBieHRf
c2FuaXRpemVfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQpAQCAtMTYw
OCwxMTUgKzE2ODgsNiBAQCBzdGF0aWMgdm9pZCBieHRfdW5pbml0X2NkY2xrKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlieHRfc2V0X2NkY2xrKGRldl9wcml2LCAmY2RjbGtf
c3RhdGUsIElOVkFMSURfUElQRSk7CiB9CiAKLXN0YXRpYyB2b2lkIGNubF9jZGNsa19wbGxfZGlz
YWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCi17Ci0JdTMyIHZhbDsKLQot
CXZhbCA9IEk5MTVfUkVBRChCWFRfREVfUExMX0VOQUJMRSk7Ci0JdmFsICY9IH5CWFRfREVfUExM
X1BMTF9FTkFCTEU7Ci0JSTkxNV9XUklURShCWFRfREVfUExMX0VOQUJMRSwgdmFsKTsKLQotCS8q
IFRpbWVvdXQgMjAwdXMgKi8KLQlpZiAod2FpdF9mb3IoKEk5MTVfUkVBRChCWFRfREVfUExMX0VO
QUJMRSkgJiBCWFRfREVfUExMX0xPQ0spID09IDAsIDEpKQotCQlEUk1fRVJST1IoInRpbWVvdXQg
d2FpdGluZyBmb3IgQ0RDTEsgUExMIHVubG9ja1xuIik7Ci0KLQlkZXZfcHJpdi0+Y2RjbGsuaHcu
dmNvID0gMDsKLX0KLQotc3RhdGljIHZvaWQgY25sX2NkY2xrX3BsbF9lbmFibGUoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBpbnQgdmNvKQotewotCWludCByYXRpbyA9IERJVl9S
T1VORF9DTE9TRVNUKHZjbywgZGV2X3ByaXYtPmNkY2xrLmh3LnJlZik7Ci0JdTMyIHZhbDsKLQot
CXZhbCA9IENOTF9DRENMS19QTExfUkFUSU8ocmF0aW8pOwotCUk5MTVfV1JJVEUoQlhUX0RFX1BM
TF9FTkFCTEUsIHZhbCk7Ci0KLQl2YWwgfD0gQlhUX0RFX1BMTF9QTExfRU5BQkxFOwotCUk5MTVf
V1JJVEUoQlhUX0RFX1BMTF9FTkFCTEUsIHZhbCk7Ci0KLQkvKiBUaW1lb3V0IDIwMHVzICovCi0J
aWYgKHdhaXRfZm9yKChJOTE1X1JFQUQoQlhUX0RFX1BMTF9FTkFCTEUpICYgQlhUX0RFX1BMTF9M
T0NLKSAhPSAwLCAxKSkKLQkJRFJNX0VSUk9SKCJ0aW1lb3V0IHdhaXRpbmcgZm9yIENEQ0xLIFBM
TCBsb2NrXG4iKTsKLQotCWRldl9wcml2LT5jZGNsay5ody52Y28gPSB2Y287Ci19Ci0KLXN0YXRp
YyB2b2lkIGNubF9zZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAot
CQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUgKmNkY2xrX3N0YXRlLAotCQkJICBl
bnVtIHBpcGUgcGlwZSkKLXsKLQlpbnQgY2RjbGsgPSBjZGNsa19zdGF0ZS0+Y2RjbGs7Ci0JaW50
IHZjbyA9IGNkY2xrX3N0YXRlLT52Y287Ci0JdTMyIHZhbCwgZGl2aWRlcjsKLQlpbnQgcmV0Owot
Ci0JcmV0ID0gc2tsX3Bjb2RlX3JlcXVlc3QoZGV2X3ByaXYsIFNLTF9QQ09ERV9DRENMS19DT05U
Uk9MLAotCQkJCVNLTF9DRENMS19QUkVQQVJFX0ZPUl9DSEFOR0UsCi0JCQkJU0tMX0NEQ0xLX1JF
QURZX0ZPUl9DSEFOR0UsCi0JCQkJU0tMX0NEQ0xLX1JFQURZX0ZPUl9DSEFOR0UsIDMpOwotCWlm
IChyZXQpIHsKLQkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gaW5mb3JtIFBDVSBhYm91dCBjZGNsayBj
aGFuZ2UgKCVkKVxuIiwKLQkJCSAgcmV0KTsKLQkJcmV0dXJuOwotCX0KLQotCS8qIGNkY2xrID0g
dmNvIC8gMiAvIGRpdnsxLDJ9ICovCi0Jc3dpdGNoIChESVZfUk9VTkRfQ0xPU0VTVCh2Y28sIGNk
Y2xrKSkgewotCWRlZmF1bHQ6Ci0JCVdBUk5fT04oY2RjbGsgIT0gZGV2X3ByaXYtPmNkY2xrLmh3
LmJ5cGFzcyk7Ci0JCVdBUk5fT04odmNvICE9IDApOwotCQkvKiBmYWxsIHRocm91Z2ggKi8KLQlj
YXNlIDI6Ci0JCWRpdmlkZXIgPSBCWFRfQ0RDTEtfQ0QyWF9ESVZfU0VMXzE7Ci0JCWJyZWFrOwot
CWNhc2UgNDoKLQkJZGl2aWRlciA9IEJYVF9DRENMS19DRDJYX0RJVl9TRUxfMjsKLQkJYnJlYWs7
Ci0JfQotCi0JaWYgKGRldl9wcml2LT5jZGNsay5ody52Y28gIT0gMCAmJgotCSAgICBkZXZfcHJp
di0+Y2RjbGsuaHcudmNvICE9IHZjbykKLQkJY25sX2NkY2xrX3BsbF9kaXNhYmxlKGRldl9wcml2
KTsKLQotCWlmIChkZXZfcHJpdi0+Y2RjbGsuaHcudmNvICE9IHZjbykKLQkJY25sX2NkY2xrX3Bs
bF9lbmFibGUoZGV2X3ByaXYsIHZjbyk7Ci0KLQl2YWwgPSBkaXZpZGVyIHwgc2tsX2NkY2xrX2Rl
Y2ltYWwoY2RjbGspOwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpIHsKLQkJaWYg
KHBpcGUgPT0gSU5WQUxJRF9QSVBFKQotCQkJdmFsIHw9IFRHTF9DRENMS19DRDJYX1BJUEVfTk9O
RTsKLQkJZWxzZQotCQkJdmFsIHw9IFRHTF9DRENMS19DRDJYX1BJUEUocGlwZSk7Ci0JfSBlbHNl
IGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKSB7Ci0JCWlmIChwaXBlID09IElOVkFMSURf
UElQRSkKLQkJCXZhbCB8PSBJQ0xfQ0RDTEtfQ0QyWF9QSVBFX05PTkU7Ci0JCWVsc2UKLQkJCXZh
bCB8PSBJQ0xfQ0RDTEtfQ0QyWF9QSVBFKHBpcGUpOwotCX0gZWxzZSB7Ci0JCWlmIChwaXBlID09
IElOVkFMSURfUElQRSkKLQkJCXZhbCB8PSBCWFRfQ0RDTEtfQ0QyWF9QSVBFX05PTkU7Ci0JCWVs
c2UKLQkJCXZhbCB8PSBCWFRfQ0RDTEtfQ0QyWF9QSVBFKHBpcGUpOwotCX0KLQlJOTE1X1dSSVRF
KENEQ0xLX0NUTCwgdmFsKTsKLQotCWlmIChwaXBlICE9IElOVkFMSURfUElQRSkKLQkJaW50ZWxf
d2FpdF9mb3JfdmJsYW5rKGRldl9wcml2LCBwaXBlKTsKLQotCS8qIGluZm9ybSBQQ1Ugb2YgdGhl
IGNoYW5nZSAqLwotCXNhbmR5YnJpZGdlX3Bjb2RlX3dyaXRlKGRldl9wcml2LCBTS0xfUENPREVf
Q0RDTEtfQ09OVFJPTCwKLQkJCQljZGNsa19zdGF0ZS0+dm9sdGFnZV9sZXZlbCk7Ci0KLQlpbnRl
bF91cGRhdGVfY2RjbGsoZGV2X3ByaXYpOwotCi0JLyoKLQkgKiBDYW4ndCByZWFkIG91dCB0aGUg
dm9sdGFnZSBsZXZlbCA6KAotCSAqIExldCdzIGp1c3QgYXNzdW1lIGV2ZXJ5dGhpbmcgaXMgYXMg
ZXhwZWN0ZWQuCi0JICovCi0JZGV2X3ByaXYtPmNkY2xrLmh3LnZvbHRhZ2VfbGV2ZWwgPSBjZGNs
a19zdGF0ZS0+dm9sdGFnZV9sZXZlbDsKLX0KLQogc3RhdGljIHZvaWQgY25sX3Nhbml0aXplX2Nk
Y2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKIAl1MzIgY2RjdGwsIGV4
cGVjdGVkOwpAQCAtMTc5Nyw3ICsxNzY4LDcgQEAgc3RhdGljIHZvaWQgaWNsX2luaXRfY2RjbGso
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlzYW5pdGl6ZWRfc3RhdGUudm9s
dGFnZV9sZXZlbCA9CiAJCQlpY2xfY2FsY192b2x0YWdlX2xldmVsKHNhbml0aXplZF9zdGF0ZS5j
ZGNsayk7CiAKLQljbmxfc2V0X2NkY2xrKGRldl9wcml2LCAmc2FuaXRpemVkX3N0YXRlLCBJTlZB
TElEX1BJUEUpOworCWJ4dF9zZXRfY2RjbGsoZGV2X3ByaXYsICZzYW5pdGl6ZWRfc3RhdGUsIElO
VkFMSURfUElQRSk7CiB9CiAKIHN0YXRpYyB2b2lkIGljbF91bmluaXRfY2RjbGsoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQpAQCAtMTgxMyw3ICsxNzg0LDcgQEAgc3RhdGljIHZv
aWQgaWNsX3VuaW5pdF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJ
CWNkY2xrX3N0YXRlLnZvbHRhZ2VfbGV2ZWwgPQogCQkJaWNsX2NhbGNfdm9sdGFnZV9sZXZlbChj
ZGNsa19zdGF0ZS5jZGNsayk7CiAKLQljbmxfc2V0X2NkY2xrKGRldl9wcml2LCAmY2RjbGtfc3Rh
dGUsIElOVkFMSURfUElQRSk7CisJYnh0X3NldF9jZGNsayhkZXZfcHJpdiwgJmNkY2xrX3N0YXRl
LCBJTlZBTElEX1BJUEUpOwogfQogCiBzdGF0aWMgdm9pZCBjbmxfaW5pdF9jZGNsayhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCkBAIC0xODMyLDcgKzE4MDMsNyBAQCBzdGF0aWMg
dm9pZCBjbmxfaW5pdF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJ
Y2RjbGtfc3RhdGUudmNvID0gYnh0X2NhbGNfY2RjbGtfcGxsX3ZjbyhkZXZfcHJpdiwgY2RjbGtf
c3RhdGUuY2RjbGspOwogCWNkY2xrX3N0YXRlLnZvbHRhZ2VfbGV2ZWwgPSBjbmxfY2FsY192b2x0
YWdlX2xldmVsKGNkY2xrX3N0YXRlLmNkY2xrKTsKIAotCWNubF9zZXRfY2RjbGsoZGV2X3ByaXYs
ICZjZGNsa19zdGF0ZSwgSU5WQUxJRF9QSVBFKTsKKwlieHRfc2V0X2NkY2xrKGRldl9wcml2LCAm
Y2RjbGtfc3RhdGUsIElOVkFMSURfUElQRSk7CiB9CiAKIHN0YXRpYyB2b2lkIGNubF91bmluaXRf
Y2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQpAQCAtMTg0Myw3ICsxODE0
LDcgQEAgc3RhdGljIHZvaWQgY25sX3VuaW5pdF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCiAJY2RjbGtfc3RhdGUudmNvID0gMDsKIAljZGNsa19zdGF0ZS52b2x0YWdl
X2xldmVsID0gY25sX2NhbGNfdm9sdGFnZV9sZXZlbChjZGNsa19zdGF0ZS5jZGNsayk7CiAKLQlj
bmxfc2V0X2NkY2xrKGRldl9wcml2LCAmY2RjbGtfc3RhdGUsIElOVkFMSURfUElQRSk7CisJYnh0
X3NldF9jZGNsayhkZXZfcHJpdiwgJmNkY2xrX3N0YXRlLCBJTlZBTElEX1BJUEUpOwogfQogCiAv
KioKQEAgLTI2NDYsMTEgKzI2MTcsMTEgQEAgdm9pZCBpbnRlbF91cGRhdGVfcmF3Y2xrKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHZvaWQgaW50ZWxfaW5pdF9jZGNsa19ob29r
cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7CiAJaWYgKElOVEVMX0dFTihk
ZXZfcHJpdikgPj0gMTEpIHsKLQkJZGV2X3ByaXYtPmRpc3BsYXkuc2V0X2NkY2xrID0gY25sX3Nl
dF9jZGNsazsKKwkJZGV2X3ByaXYtPmRpc3BsYXkuc2V0X2NkY2xrID0gYnh0X3NldF9jZGNsazsK
IAkJZGV2X3ByaXYtPmRpc3BsYXkubW9kZXNldF9jYWxjX2NkY2xrID0gaWNsX21vZGVzZXRfY2Fs
Y19jZGNsazsKIAkJZGV2X3ByaXYtPmNkY2xrLnRhYmxlID0gaWNsX2NkY2xrX3RhYmxlOwogCX0g
ZWxzZSBpZiAoSVNfQ0FOTk9OTEFLRShkZXZfcHJpdikpIHsKLQkJZGV2X3ByaXYtPmRpc3BsYXku
c2V0X2NkY2xrID0gY25sX3NldF9jZGNsazsKKwkJZGV2X3ByaXYtPmRpc3BsYXkuc2V0X2NkY2xr
ID0gYnh0X3NldF9jZGNsazsKIAkJZGV2X3ByaXYtPmRpc3BsYXkubW9kZXNldF9jYWxjX2NkY2xr
ID0gY25sX21vZGVzZXRfY2FsY19jZGNsazsKIAkJZGV2X3ByaXYtPmNkY2xrLnRhYmxlID0gY25s
X2NkY2xrX3RhYmxlOwogCX0gZWxzZSBpZiAoSVNfR0VOOV9MUChkZXZfcHJpdikpIHsKLS0gCjIu
MjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50
ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBz
Oi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

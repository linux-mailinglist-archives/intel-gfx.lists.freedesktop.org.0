Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7A83B79D01
	for <lists+intel-gfx@lfdr.de>; Tue, 30 Jul 2019 01:47:56 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 37C6789F6E;
	Mon, 29 Jul 2019 23:47:54 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga06.intel.com (mga06.intel.com [134.134.136.31])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0467A89F8E
 for <intel-gfx@lists.freedesktop.org>; Mon, 29 Jul 2019 23:47:50 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga004.fm.intel.com ([10.253.24.48])
 by orsmga104.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 29 Jul 2019 16:47:50 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,324,1559545200"; d="scan'208";a="195590641"
Received: from dceraolo-linux.fm.intel.com ([10.1.27.145])
 by fmsmga004.fm.intel.com with ESMTP; 29 Jul 2019 16:47:50 -0700
From: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 29 Jul 2019 16:47:22 -0700
Message-Id: <20190729234727.28286-2-daniele.ceraolospurio@intel.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190729234727.28286-1-daniele.ceraolospurio@intel.com>
References: <20190729234727.28286-1-daniele.ceraolospurio@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 1/6] drm/i915/uc: move uC WOPCM setup in
 uc_init_hw
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIHJlZ2lzdGVyIHdlIHdyaXRlIGFyZSBub3QgV09QQ00gcmVncyBidXQgdUMgb25lcyByZWxh
dGVkIHRvIGhvdwpHdUMgYW5kIEh1QyBhcmUgZ29pbmcgdG8gdXNlIHRoZSBXT1BDTSwgc28gaXQg
bWFrZXMgbG9naWNhbCBzZW5zZQpmb3IgdGhlbSB0byBiZSBwcm9ncmFtbWVkIGFzIHBhcnQgb2Yg
dWNfaW5pdF9ody4gVGhlIHdvcGNtIG1hcCBvbiB0aGUKb3RoZXIgc2lkZSBpcyBub3QgdUMtc3Bl
Y2lmaWMgKGFsdGhvdWdoIHRoYXQgaXMgb3VyIG1haW4gdXNlLWNhc2UpLCBzbwprZWVwIHRoYXQg
c2VwYXJhdGUuCgpTaWduZWQtb2ZmLWJ5OiBEYW5pZWxlIENlcmFvbG8gU3B1cmlvIDxkYW5pZWxl
LmNlcmFvbG9zcHVyaW9AaW50ZWwuY29tPgpDYzogTWljaGFsIFdhamRlY3prbyA8bWljaGFsLndh
amRlY3prb0BpbnRlbC5jb20+CkNjOiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5j
by51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF91Yy5jIHwgNjIgKysr
KysrKysrKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jICAg
ICAgIHwgIDggKy0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd29wY20uYyAgICB8IDY4
IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
d29wY20uaCAgICB8ICAzIC0tCiA0IGZpbGVzIGNoYW5nZWQsIDYzIGluc2VydGlvbnMoKyksIDc4
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2lu
dGVsX3VjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF91Yy5jCmluZGV4IGZh
ZmE5YmUxZTEyYS4uMmY3MWYzNzA0YzQ2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC91Yy9pbnRlbF91Yy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVs
X3VjLmMKQEAgLTM5MCw2ICszOTAsNjMgQEAgdm9pZCBpbnRlbF91Y19zYW5pdGl6ZShzdHJ1Y3Qg
aW50ZWxfdWMgKnVjKQogCV9fdWNfc2FuaXRpemUodWMpOwogfQogCitzdGF0aWMgaW50Cit3cml0
ZV9hbmRfdmVyaWZ5KHN0cnVjdCBpbnRlbF9ndCAqZ3QsCisJCSBpOTE1X3JlZ190IHJlZywgdTMy
IHZhbCwgdTMyIG1hc2ssIHUzMiBsb2NrZWRfYml0KQoreworCXN0cnVjdCBpbnRlbF91bmNvcmUg
KnVuY29yZSA9IGd0LT51bmNvcmU7CisJdTMyIHJlZ192YWw7CisKKwlHRU1fQlVHX09OKHZhbCAm
IH5tYXNrKTsKKworCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsIHJlZywgdmFsKTsKKworCXJl
Z192YWwgPSBpbnRlbF91bmNvcmVfcmVhZCh1bmNvcmUsIHJlZyk7CisKKwlyZXR1cm4gKHJlZ192
YWwgJiBtYXNrKSAhPSAodmFsIHwgbG9ja2VkX2JpdCkgPyAtRUlPIDogMDsKK30KKworLyogSW5p
dGlhbGl6ZSBhbmQgdmVyaWZ5IHRoZSB1QyByZWdzIHJlbGF0ZWQgdG8gdUMgcG9zaXRpb25pbmcg
aW4gV09QQ00gKi8KK2ludCB1Y193b3BjbV9pbml0X2h3KHN0cnVjdCBpbnRlbF91YyAqdWMpCit7
CisJc3RydWN0IGludGVsX2d0ICpndCA9IHVjX3RvX2d0KHVjKTsKKwlzdHJ1Y3QgaW50ZWxfd29w
Y20gKndvcGNtID0gJmd0LT5pOTE1LT53b3BjbTsKKwlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNv
cmUgPSBndC0+dW5jb3JlOworCXUzMiBodWNfYWdlbnQ7CisJdTMyIG1hc2s7CisJaW50IGVycjsK
KworCUdFTV9CVUdfT04oIUhBU19HVF9VQyhndC0+aTkxNSkpOworCUdFTV9CVUdfT04oIWludGVs
X3VjX2lzX3VzaW5nX2d1Yyh1YykpOworCUdFTV9CVUdfT04oIXdvcGNtLT5ndWMuc2l6ZSk7CisJ
R0VNX0JVR19PTighd29wY20tPmd1Yy5iYXNlKTsKKworCWVyciA9IHdyaXRlX2FuZF92ZXJpZnko
Z3QsIEdVQ19XT1BDTV9TSVpFLCB3b3BjbS0+Z3VjLnNpemUsCisJCQkgICAgICAgR1VDX1dPUENN
X1NJWkVfTUFTSyB8IEdVQ19XT1BDTV9TSVpFX0xPQ0tFRCwKKwkJCSAgICAgICBHVUNfV09QQ01f
U0laRV9MT0NLRUQpOworCWlmIChlcnIpCisJCWdvdG8gZXJyX291dDsKKworCWh1Y19hZ2VudCA9
IGludGVsX3VjX2lzX3VzaW5nX2h1Yyh1YykgPyBIVUNfTE9BRElOR19BR0VOVF9HVUMgOiAwOwor
CW1hc2sgPSBHVUNfV09QQ01fT0ZGU0VUX01BU0sgfCBHVUNfV09QQ01fT0ZGU0VUX1ZBTElEIHwg
aHVjX2FnZW50OworCWVyciA9IHdyaXRlX2FuZF92ZXJpZnkoZ3QsIERNQV9HVUNfV09QQ01fT0ZG
U0VULAorCQkJICAgICAgIHdvcGNtLT5ndWMuYmFzZSB8IGh1Y19hZ2VudCwgbWFzaywKKwkJCSAg
ICAgICBHVUNfV09QQ01fT0ZGU0VUX1ZBTElEKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl9vdXQ7
CisKKwlyZXR1cm4gMDsKKworZXJyX291dDoKKwlEUk1fRVJST1IoIkZhaWxlZCB0byBpbml0IFdP
UENNIHJlZ2lzdGVyczpcbiIpOworCURSTV9FUlJPUigiRE1BX0dVQ19XT1BDTV9PRkZTRVQ9JSN4
XG4iLAorCQkgIGludGVsX3VuY29yZV9yZWFkKHVuY29yZSwgRE1BX0dVQ19XT1BDTV9PRkZTRVQp
KTsKKwlEUk1fRVJST1IoIkdVQ19XT1BDTV9TSVpFPSUjeFxuIiwKKwkJICBpbnRlbF91bmNvcmVf
cmVhZCh1bmNvcmUsIEdVQ19XT1BDTV9TSVpFKSk7CisKKwlyZXR1cm4gZXJyOworfQorCiBpbnQg
aW50ZWxfdWNfaW5pdF9odyhzdHJ1Y3QgaW50ZWxfdWMgKnVjKQogewogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gdWNfdG9fZ3QodWMpLT5pOTE1OwpAQCAtNDAyLDYgKzQ1OSwxMCBA
QCBpbnQgaW50ZWxfdWNfaW5pdF9odyhzdHJ1Y3QgaW50ZWxfdWMgKnVjKQogCiAJR0VNX0JVR19P
TighaW50ZWxfdWNfZndfc3VwcG9ydGVkKCZndWMtPmZ3KSk7CiAKKwlyZXQgPSB1Y193b3BjbV9p
bml0X2h3KHVjKTsKKwlpZiAocmV0KQorCQlnb3RvIG91dDsKKwogCWd1Y19yZXNldF9pbnRlcnJ1
cHRzKGd1Yyk7CiAKIAkvKiBXYUVuYWJsZXVLZXJuZWxIZWFkZXJWYWxpZEZpeDpza2wgKi8KQEAg
LTQ4Niw2ICs1NDcsNyBAQCBpbnQgaW50ZWxfdWNfaW5pdF9odyhzdHJ1Y3QgaW50ZWxfdWMgKnVj
KQogCWlmIChHRU1fV0FSTl9PTihyZXQgPT0gLUVJTykpCiAJCXJldCA9IC1FSU5WQUw7CiAKK291
dDoKIAlkZXZfZXJyKGk5MTUtPmRybS5kZXYsICJHdUMgaW5pdGlhbGl6YXRpb24gZmFpbGVkICVk
XG4iLCByZXQpOwogCXJldHVybiByZXQ7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwppbmRleCAw
MWRkMGQxZDliZjYuLmFlNGU3Y2MzZTNmOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCkBAIC0x
MjM5LDE0ICsxMjM5LDggQEAgaW50IGk5MTVfZ2VtX2luaXRfaHcoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCiAJCWdvdG8gb3V0OwogCX0KIAotCXJldCA9IGludGVsX3dvcGNtX2luaXRf
aHcoJmk5MTUtPndvcGNtLCBndCk7Ci0JaWYgKHJldCkgewotCQlEUk1fRVJST1IoIkVuYWJsaW5n
IFdPUENNIGZhaWxlZCAoJWQpXG4iLCByZXQpOwotCQlnb3RvIG91dDsKLQl9Ci0KIAkvKiBXZSBj
YW4ndCBlbmFibGUgY29udGV4dHMgdW50aWwgYWxsIGZpcm13YXJlIGlzIGxvYWRlZCAqLwotCXJl
dCA9IGludGVsX3VjX2luaXRfaHcoJmk5MTUtPmd0LnVjKTsKKwlyZXQgPSBpbnRlbF91Y19pbml0
X2h3KCZndC0+dWMpOwogCWlmIChyZXQpIHsKIAkJRFJNX0VSUk9SKCJFbmFibGluZyB1YyBmYWls
ZWQgKCVkKVxuIiwgcmV0KTsKIAkJZ290byBvdXQ7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF93b3BjbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd29wY20u
YwppbmRleCAwZTg2YTllODViNDkuLmQ5OTczYzBiMDM4NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaW50ZWxfd29wY20uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF93b3BjbS5jCkBAIC0yMjQsNzEgKzIyNCwzIEBAIGludCBpbnRlbF93b3BjbV9pbml0KHN0cnVj
dCBpbnRlbF93b3BjbSAqd29wY20pCiAKIAlyZXR1cm4gMDsKIH0KLQotc3RhdGljIGludAotd3Jp
dGVfYW5kX3ZlcmlmeShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAotCQkgaTkxNV9yZWdfdCByZWcsIHUz
MiB2YWwsIHUzMiBtYXNrLCB1MzIgbG9ja2VkX2JpdCkKLXsKLQlzdHJ1Y3QgaW50ZWxfdW5jb3Jl
ICp1bmNvcmUgPSBndC0+dW5jb3JlOwotCXUzMiByZWdfdmFsOwotCi0JR0VNX0JVR19PTih2YWwg
JiB+bWFzayk7Ci0KLQlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCByZWcsIHZhbCk7Ci0KLQly
ZWdfdmFsID0gaW50ZWxfdW5jb3JlX3JlYWQodW5jb3JlLCByZWcpOwotCi0JcmV0dXJuIChyZWdf
dmFsICYgbWFzaykgIT0gKHZhbCB8IGxvY2tlZF9iaXQpID8gLUVJTyA6IDA7Ci19Ci0KLS8qKgot
ICogaW50ZWxfd29wY21faW5pdF9odygpIC0gU2V0dXAgR3VDIFdPUENNIHJlZ2lzdGVycy4KLSAq
IEB3b3BjbTogcG9pbnRlciB0byBpbnRlbF93b3BjbS4KLSAqIEBndDogcG9pbnRlciB0byB0aGUg
Y29udGFpbmluZyBHVAotICoKLSAqIFNldHVwIHRoZSBHdUMgV09QQ00gc2l6ZSBhbmQgb2Zmc2V0
IHJlZ2lzdGVycyB3aXRoIHRoZSBjYWxjdWxhdGVkIHZhbHVlcy4gSXQKLSAqIHdpbGwgdmVyaWZ5
IHRoZSByZWdpc3RlciB2YWx1ZXMgdG8gbWFrZSBzdXJlIHRoZSByZWdpc3RlcnMgYXJlIGxvY2tl
ZCB3aXRoCi0gKiBjb3JyZWN0IHZhbHVlcy4KLSAqCi0gKiBSZXR1cm46IDAgb24gc3VjY2Vzcy4g
LUVJTyBpZiByZWdpc3RlcnMgd2VyZSBsb2NrZWQgd2l0aCBpbmNvcnJlY3QgdmFsdWVzLgotICov
Ci1pbnQgaW50ZWxfd29wY21faW5pdF9odyhzdHJ1Y3QgaW50ZWxfd29wY20gKndvcGNtLCBzdHJ1
Y3QgaW50ZWxfZ3QgKmd0KQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gd29w
Y21fdG9faTkxNSh3b3BjbSk7Ci0Jc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gZ3QtPnVu
Y29yZTsKLQl1MzIgaHVjX2FnZW50OwotCXUzMiBtYXNrOwotCWludCBlcnI7Ci0KLQlpZiAoIVVT
RVNfR1VDKGk5MTUpKQotCQlyZXR1cm4gMDsKLQotCUdFTV9CVUdfT04oIUhBU19HVF9VQyhpOTE1
KSk7Ci0JR0VNX0JVR19PTighd29wY20tPmd1Yy5zaXplKTsKLQlHRU1fQlVHX09OKCF3b3BjbS0+
Z3VjLmJhc2UpOwotCi0JZXJyID0gd3JpdGVfYW5kX3ZlcmlmeShndCwgR1VDX1dPUENNX1NJWkUs
IHdvcGNtLT5ndWMuc2l6ZSwKLQkJCSAgICAgICBHVUNfV09QQ01fU0laRV9NQVNLIHwgR1VDX1dP
UENNX1NJWkVfTE9DS0VELAotCQkJICAgICAgIEdVQ19XT1BDTV9TSVpFX0xPQ0tFRCk7Ci0JaWYg
KGVycikKLQkJZ290byBlcnJfb3V0OwotCi0JaHVjX2FnZW50ID0gVVNFU19IVUMoaTkxNSkgPyBI
VUNfTE9BRElOR19BR0VOVF9HVUMgOiAwOwotCW1hc2sgPSBHVUNfV09QQ01fT0ZGU0VUX01BU0sg
fCBHVUNfV09QQ01fT0ZGU0VUX1ZBTElEIHwgaHVjX2FnZW50OwotCWVyciA9IHdyaXRlX2FuZF92
ZXJpZnkoZ3QsIERNQV9HVUNfV09QQ01fT0ZGU0VULAotCQkJICAgICAgIHdvcGNtLT5ndWMuYmFz
ZSB8IGh1Y19hZ2VudCwgbWFzaywKLQkJCSAgICAgICBHVUNfV09QQ01fT0ZGU0VUX1ZBTElEKTsK
LQlpZiAoZXJyKQotCQlnb3RvIGVycl9vdXQ7Ci0KLQlyZXR1cm4gMDsKLQotZXJyX291dDoKLQlE
Uk1fRVJST1IoIkZhaWxlZCB0byBpbml0IFdPUENNIHJlZ2lzdGVyczpcbiIpOwotCURSTV9FUlJP
UigiRE1BX0dVQ19XT1BDTV9PRkZTRVQ9JSN4XG4iLAotCQkgIGludGVsX3VuY29yZV9yZWFkKHVu
Y29yZSwgRE1BX0dVQ19XT1BDTV9PRkZTRVQpKTsKLQlEUk1fRVJST1IoIkdVQ19XT1BDTV9TSVpF
PSUjeFxuIiwKLQkJICBpbnRlbF91bmNvcmVfcmVhZCh1bmNvcmUsIEdVQ19XT1BDTV9TSVpFKSk7
Ci0KLQlyZXR1cm4gZXJyOwotfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfd29wY20uaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dvcGNtLmgKaW5kZXggNTZh
YWVkNGQ2NGZmLi5lMWYwZjY2YWFhNDQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2ludGVsX3dvcGNtLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd29wY20uaApA
QCAtOSw4ICs5LDYgQEAKIAogI2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+CiAKLXN0cnVjdCBpbnRl
bF9ndDsKLQogLyoqCiAgKiBzdHJ1Y3QgaW50ZWxfd29wY20gLSBPdmVyYWxsIFdPUENNIGluZm8g
YW5kIFdPUENNIHJlZ2lvbnMuCiAgKiBAc2l6ZTogU2l6ZSBvZiBvdmVyYWxsIFdPUENNLgpAQCAt
NDMsNiArNDEsNSBAQCBzdGF0aWMgaW5saW5lIHUzMiBpbnRlbF93b3BjbV9ndWNfc2l6ZShzdHJ1
Y3QgaW50ZWxfd29wY20gKndvcGNtKQogCiB2b2lkIGludGVsX3dvcGNtX2luaXRfZWFybHkoc3Ry
dWN0IGludGVsX3dvcGNtICp3b3BjbSk7CiBpbnQgaW50ZWxfd29wY21faW5pdChzdHJ1Y3QgaW50
ZWxfd29wY20gKndvcGNtKTsKLWludCBpbnRlbF93b3BjbV9pbml0X2h3KHN0cnVjdCBpbnRlbF93
b3BjbSAqd29wY20sIHN0cnVjdCBpbnRlbF9ndCAqZ3QpOwogCiAjZW5kaWYKLS0gCjIuMjIuMAoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4
IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

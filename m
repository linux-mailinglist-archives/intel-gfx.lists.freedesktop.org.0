Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 03CFC181C70
	for <lists+intel-gfx@lfdr.de>; Wed, 11 Mar 2020 16:37:20 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B70976E218;
	Wed, 11 Mar 2020 15:37:17 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga12.intel.com (mga12.intel.com [192.55.52.136])
 by gabe.freedesktop.org (Postfix) with ESMTPS id DEB4B6E218
 for <intel-gfx@lists.freedesktop.org>; Wed, 11 Mar 2020 15:37:16 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga003.jf.intel.com ([10.7.209.27])
 by fmsmga106.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 11 Mar 2020 08:36:59 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.70,541,1574150400"; d="scan'208";a="242715303"
Received: from unknown (HELO slisovsk-Lenovo-ideapad-720S-13IKB.fi.intel.com)
 ([10.237.72.89])
 by orsmga003.jf.intel.com with ESMTP; 11 Mar 2020 08:36:56 -0700
From: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 11 Mar 2020 17:32:55 +0200
Message-Id: <20200311153255.15912-1-stanislav.lisovskiy@intel.com>
X-Mailer: git-send-email 2.24.1.485.gad05a3d8e5
In-Reply-To: <20200309161204.17792-5-stanislav.lisovskiy@intel.com>
References: <20200309161204.17792-5-stanislav.lisovskiy@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v19 4/8] drm/i915: Refactor intel_can_enable_sagv
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q3VycmVudGx5IGludGVsX2Nhbl9lbmFibGVfc2FndiBmdW5jdGlvbiBjb250YWlucwphIG1peCBv
ZiB3b3JrYXJvdW5kcyBmb3IgZGlmZmVyZW50IHBsYXRmb3Jtcwpzb21lIG9mIHRoZW0gYXJlIG5v
dCB2YWxpZCBmb3IgZ2VucyA+PSAxMSBhbHJlYWR5LApzbyBsZXRzIHNwbGl0IGl0IGludG8gc2Vw
YXJhdGUgZnVuY3Rpb25zLgoKdjI6CiAgICAtIFJld29yayB3YXRlcm1hcmsgY2FsY3VsYXRpb24g
YWxnb3JpdGhtIHRvCiAgICAgIGF0dGVtcHQgdG8gY2FsY3VsYXRlIExldmVsIDAgd2F0ZXJtYXJr
CiAgICAgIHdpdGggYWRkZWQgc2FndiBibG9jayB0aW1lIGxhdGVuY3kgYW5kCiAgICAgIGNoZWNr
IGlmIGl0IGZpdHMgaW4gREJ1ZiBpbiBvcmRlciB0bwogICAgICBkZXRlcm1pbmUgaWYgU0FHViBj
YW4gYmUgZW5hYmxlZCBhbHJlYWR5CiAgICAgIGF0IHRoaXMgc3RhZ2UsIGp1c3QgYXMgQlNwZWMg
NDkzMjUgc3RhdGVzLgogICAgICBpZiB0aGF0IGZhaWxzIHJvbGxiYWNrIHRvIHVzdWFsIExldmVs
IDAKICAgICAgbGF0ZW5jeSBhbmQgZGlzYWJsZSBTQUdWLgogICAgLSBSZW1vdmUgdW5uZWVkZWQg
dGFicyhKYW1lcyBBdXNtdXMpCgp2MzogUmViYXNlZCB0aGUgcGF0Y2gKCnY0OiAtIEFkZGVkIGJh
Y2sgaW50ZXJsYWNlZCBjaGVjayBmb3IgR2VuMTIgYW5kCiAgICAgIGFkZGVkIHNlcGFyYXRlIGZ1
bmN0aW9uIGZvciBUR0wgU0FHViBjaGVjawogICAgICAodGhhbmtzIHRvIEphbWVzIEF1c211cyBm
b3Igc3BvdHRpbmcpCiAgICAtIFJlbW92ZWQgdW5uZWVkZWQgZ2VuIGNoZWNrCiAgICAtIEV4dHJh
Y3RlZCBHZW4xMiBTQUdWIGRlY2lzaW9uIG1ha2luZyBjb2RlCiAgICAgIHRvIGEgc2VwYXJhdGUg
ZnVuY3Rpb24gZnJvbSBza2xfY29tcHV0ZV93bQoKdjU6IC0gQWRkZWQgU0FHViBnbG9iYWwgc3Rh
dGUgdG8gZGV2X3ByaXYsIGJlY2F1c2UKICAgICAgd2UgbmVlZCB0byB0cmFjayBhbGwgcGlwZXMs
IG5vdCBvbmx5IHRob3NlCiAgICAgIGluIGF0b21pYyBzdGF0ZS4gRWFjaCBwaXBlIGhhcyBub3cg
Y29ycmVzcG9uZGVudAogICAgICBiaXQgbWFzayByZWZsZWN0aW5nLCB3aGV0aGVyIGl0IGNhbiB0
b2xlcmF0ZQogICAgICBTQUdWIG9yIG5vdCh0aGFua3MgdG8gVmlsbGUgU3lyamFsYSBmb3Igc3Vn
Z2VzdGlvbnMpLgogICAgLSBOb3cgdXNpbmcgYWN0aXZlIGZsYWcgaW5zdGVhZCBvZiBlbmFibGUg
aW4gY3JjCiAgICAgIHVzYWdlIGNoZWNrLgoKdjY6IC0gRml4ZWQgcmViYXNlIGNvbmZsaWN0cwoK
djc6IC0ga21zX2N1cnNvcl9sZWdhY3kgc2VlbXMgdG8gZ2V0IGJyb2tlbiBiZWNhdXNlIG9mIG11
bHRpcGxlIG1lbWNweQogICAgICBjYWxscyB3aGVuIGNvcHlpbmcgbGV2ZWwgMCB3YXRlciBtYXJr
cyBmb3IgZW5hYmxlZCBTQUdWLCB0bwogICAgICBmaXggdGhpcyBub3cgc2ltcGx5IHVzaW5nIHRo
YXQgZmllbGQgcmlnaHQgYXdheSwgd2l0aG91dCBjb3B5aW5nLAogICAgICBmb3IgdGhhdCBpbnRy
b2R1Y2VkIGEgbmV3IHdtX2xldmVsIGFjY2Vzc29yIHdoaWNoIGRlY2lkZXMgd2hpY2gKICAgICAg
d21fbGV2ZWwgdG8gcmV0dXJuIGJhc2VkIG9uIFNBR1Ygc3RhdGUuCgp2ODogLSBQcm90ZWN0IGNy
dGNfc2Fndl9tYXNrIHNhbWUgd2F5IGFzIHdlIGRvIGZvciBvdGhlciBnbG9iYWwgc3RhdGUKICAg
ICAgY2hhbmdlczogaS5lIGNoZWNrIGlmIGNoYW5nZXMgYXJlIG5lZWRlZCwgdGhlbiBncmFiIGFs
bCBjcnRjIGxvY2tzCiAgICAgIHRvIHNlcmlhbGl6ZSB0aGUgY2hhbmdlcyhWaWxsZSBTeXJqw6Rs
w6QpCiAgICAtIEFkZCBjcnRjX3NhZ3ZfbWFzayBjYWNoaW5nIGluIG9yZGVyIHRvIGF2b2lkIG5l
ZWRsZXNzIHJlY2FsY3VsYXRpb25zCiAgICAgIChNYXR0aGV3IFJvcGVyKQogICAgLSBQdXQgYmFj
ayBHZW4xMiBTQUdWIHN3aXRjaCBpbiBvcmRlciB0byBnZXQgaXQgZW5hYmxlZCBpbiBzZXBhcmF0
ZQogICAgICBwYXRjaChNYXR0aGV3IFJvcGVyKQogICAgLSBSZW5hbWUgKl9zZXRfc2Fndl9tYXNr
IHRvICpfY29tcHV0ZV9zYWd2X21hc2soTWF0dGhldyBSb3BlcikKICAgIC0gQ2hlY2sgaWYgdGhl
cmUgYXJlIG5vIGFjdGl2ZSBwaXBlcyBpbiBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YKICAgICAgaW5z
dGVhZCBvZiBwbGF0Zm9ybSBzcGVjaWZpYyBmdW5jdGlvbnMoTWF0dGhldyBSb3BlciksIHNhbWUK
ICAgICAgZm9yIGludGVsX2hhc19zYWd2IGNoZWNrLgoKdjkgIC0gU3dpdGNoZWQgdG8gdTggZm9y
IGNydGNfc2Fndl9tYXNrKFZpbGxlIFN5cmrDpGzDpCkKICAgIC0gY3J0Y19zYWd2X21hc2sgbm93
IGlzIHBpcGVfc2Fndl9tYXNrKFZpbGxlIFN5cmrDpGzDpCkKICAgIC0gRXh0cmFjdGVkIHNhZ3Yg
Y2hlY2tpbmcgbG9naWMgZnJvbSBza2wvaWNsL3RnbF9jb21wdXRlX3NhZ3ZfbWFzawogICAgLSBF
eHRyYWN0ZWQgc2tsX3BsYW5lX3dtX2xldmVsIGZ1bmN0aW9uIGFuZCBwYXNzaW5nIGxhdGVuY3kg
dG8KICAgICAgc2VwYXJhdGUgcGF0Y2hlcyhWaWxsZSBTeXJqw6Rsw6QpCiAgICAtIFJlbW92ZWQg
cGFydCBvZiB1bm5lZWRlZCBjb3B5LXBhc3RlIGZyb20gdGdsX2NoZWNrX3BpcGVfZml0c19zYWd2
X3dtCiAgICAgIChWaWxsZSBTeXJqw6Rsw6QpCiAgICAtIE5vdyB1c2luZyBzaW1wbGUgYXNzaWdu
bWVudCBmb3Igc2Fndl93bTAgYXMgaXQgY29udGFpbnMgb25seQogICAgICBwb2QgdHlwZXMgYW5k
IG5vIHBvaW50ZXJzKFZpbGxlIFN5cmrDpGzDpCkKICAgIC0gRml4ZWQgaW50ZWxfY2FuX2VuYWJs
ZV9zYWd2IG5vdCB0byBkbyBkb3VibGUgZHV0eSwgbm93IGl0IG9ubHkKICAgICAgY2hlY2sgU0FH
ViBiaXRzIGJ5IEFORGluZyB0aG9zZSBiZXR3ZWVuIGxvY2FsIGFuZCBnbG9iYWwgc3RhdGUuCiAg
ICAgIFRoZSBTQUdWIG1hc2tzIGFyZSBub3cgY29tcHV0ZWQgYWZ0ZXIgd2F0ZXJtYXJrcyBhcmUg
YXZhaWxhYmxlLAogICAgICBpbiBvcmRlciB0byBiZSBhYmxlIHRvIGZpZ3VyZSBvdXQgaWYgZGRi
IHJhbmdlcyBhcmUgZml0dGluZyBuaWNlbHkuCiAgICAgIChWaWxsZSBTeXJqw6Rsw6QpCiAgICAt
IE5vdyBoYXZpbmcgdXZfc2Fndl93bTAgYW5kIHNhZ3Zfd20wLCBvdGhlcndpc2Ugd2UgaGF2ZSB3
cm9uZyBsb2dpYwogICAgICB3aGVuIHVzaW5nIHNrbF9wbGFuZV93bV9sZXZlbCBhY2Nlc3Nvciwg
YXMgd2UgaGFkIHByZXZpb3VzbHkgZm9yCiAgICAgIEdlbjExKyBjb2xvciBwbGFuZSBhbmQgcmVn
dWxhciB3bSBsZXZlbHMsIHNvIHByb2JhYmx5IGJvdGgKICAgICAgaGFzIHRvIGJlIHJlY2FsY3Vs
YXRlZCB3aXRoIGFkZGl0aW9uYWwgU0FHViBibG9jayB0aW1lIGZvciBMZXZlbCAwLgoKdjEwOiAt
IFN0YXJ0aW5nIHRvIHVzZSBuZXcgZ2xvYmFsIHN0YXRlIGZvciBzdG9yaW5nIHBpcGVfc2Fndl9t
YXNrCgp2MTE6IC0gRml4ZWQgcmViYXNlIGNvbmZsaWN0IHdpdGggcmVjZW50IGRybS10aXAKICAg
ICAtIENoZWNrIGlmIHdlIHJlYWxseSBuZWVkIHRvIHJlY2FsY3VsYXRlIFNBR1YgbWFzaywgb3Ro
ZXJ3aXNlCiAgICAgICBiYWlsIG91dCB3aXRob3V0IG1ha2luZyBhbnkgY2hhbmdlcy4KICAgICAt
IFVzZSBjYWNoZWQgU0FHViByZXN1bHQsIGluc3RlYWQgb2YgcmVjYWxjdWxhdGluZyBpdCBldmVy
eXRpbWUsCiAgICAgICBpZiBid19zdGF0ZSBoYXNuJ3QgY2hhbmdlZC4KCnYxMjogLSBSZW1vdmVk
IFdBUk4gZnJvbSBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YsIGluIHNvbWUgb2YgdGhlIGNvbW1pdHMK
ICAgICAgIGlmIHdlIGRvbid0IHJlY2FsY3VsYXRlZCB3YXRlcm1hcmtzLCBid19zdGF0ZSBpcyBu
b3QgcmVjYWxjdWxhdGVkLAogICAgICAgdGh1cyBsZWFkaW5nIHRvIFNBR1Ygc3RhdGUgbm90IHJl
Y2FsY3VsYXRlZCBieSB0aGUgY29tbWl0IHN0YXRlLAogICAgICAgd2hpY2ggaXMgc3RpbGwgY2Fs
bGluZyBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YgZnVuY3Rpb24uIEZpeCB0aGF0CiAgICAgICBieSBq
dXN0IGFuYWx5emluZyB0aGUgY3VycmVudCBnbG9iYWwgYndfc3RhdGUgb2JqZWN0IC0gYmVjYXVz
ZQogICAgICAgd2Ugc2ltcGx5IGhhdmUgbm8gb3RoZXIgb2JqZWN0cyByZWxhdGVkIHRvIHRoYXQu
Cgp2MTM6IC0gUmViYXNlZCwgZml4ZWQgd2FybmluZ3MgcmVnYXJkaW5nIGxvbmcgbGluZXMKICAg
ICAtIENoYW5nZWQgZnVuY3Rpb24gY2FsbCBzaXRlcyBmcm9tIGludGVsX2F0b21pY19idyogdG8K
ICAgICAgIGludGVsX3diXyogYXMgd2FzIHN1Z2dlc3RlZC4oSmFuaSBOaWt1bGEpCiAgICAgLSBU
YWtlbiBkZGJfc3RhdGVfY2hhbmdlZCBhbmQgYndfc3RhdGVfY2hhbmdlZCBpbnRvIHVzZS4KCnYx
NDogLSB0b3RhbF9hZmZlY3RlZF9wbGFuZXMgaXMgbm8gbG9uZ2VyIG5lZWRlZCB0byBjaGVjayBm
b3IgZGRiIGNoYW5nZXMsCiAgICAgICBqdXN0IGFzIGFjdGl2ZV9waXBlX2NoYW5nZXMuCgp2MTU6
IC0gRml4ZWQgc3R1cGlkIG1pc3Rha2Ugd2l0aCB1bmluaXRpYWxpemVkIGNydGMgaW4KICAgICAg
IHNrbF9jb21wdXRlX3NhZ3ZfbWFzay4KCnYxNjogLSBDb252ZXJ0IHBpcGVfc2Fndl9tYXNrIHRv
IHBpcGVfc2Fndl9yZWplY3QgYW5kIG5vdyB1c2luZyBpbnZlcnRlZAogICAgICAgZmxhZyB0byBp
bmRpY2F0ZSBTQUdWIHJlYWRpbmVzcyBmb3IgdGhlIHBpcGUoVmlsbGUgU3lyasOkbMOkKQogICAg
IC0gQWRkZWQgcmV0dXJuIHZhbHVlIHRvIGludGVsX2NvbXB1dGVfc2Fndl9tYXNrIHdoaWNoIGNh
bGwKICAgICAgIGludGVsX2F0b21pY19zZXJpYWxpemVfZ2xvYmFsX3N0YXRlIGluIG9yZGVyIHRv
IHByb3Blcmx5CiAgICAgICBwcm9wYWdhdGUgRURFQURMQ0sgdG8gZHJtLgogICAgIC0gQmFzZWQg
b24gdGhlIGRpc2N1c3Npb24gd2l0aCBWaWxsZSwgcmVtb3ZlZCBhY3RpdmVfcGlwZV9jaGFuZ2Vz
CiAgICAgICBjaGVjayBhbmQgYWxzbyB0aGVyZSBzZWVtcyB0byBiZSBubyBuZWVkIGZvciBjaGVj
a2luZwogICAgICAgZGRiX3N0YXRlX2NoYW5nZXMgYXMgd2VsbC4KICAgICAgIEluc3RlYWQgd2Ug
anVzdCBpdGVyYXRlIHRocm91Z2ggY3J0Y3MgaW4gc3RhdGUgLSBoYXZpbmcKICAgICAgIGNydGMg
aW4gYSBzdGF0ZSBhbHJlYWR5IGd1YXJhbnRlZXMgdGhhdCBpdCBpcyBhdCBsZWFzdCByZWFkLWxv
Y2tlZAogICAgICAgSGF2aW5nIGFkZGl0aW9uYWwgZmxhZyB0byBjaGVjayBpZiB0aGVyZSBhY3R1
YWxseSB3ZXJlIHNvbWUgcGxhbmUKICAgICAgIHdtL2RkYiBjaGFuZ2VzIHdvdWxkIGJlIHByb2Jh
Ymx5IGFkZGVkIGxhdGVyIGFzIGFuIG9wdGltaXphdGlvbi4KICAgICAtIFdlIGNhbid0IGdldCBw
YXJlbnQgYXRvbWljIHN0YXRlIGZyb20gY3J0Y19zdGF0ZSBhdCBjb21taXQgc3RhZ2UKICAgICAg
IChuaWNlIGRybSBmZWF0dXJlKSwgYWxzbyBwcm9wYWdhdGluZyBzdGF0ZSB0aHJvdWdoIGZ1bmN0
aW9uIGNhbGwKICAgICAgIGNoYWluIHNlZW1zIHRvIGJlIG92ZXJraWxsIGFuZCBub3QgcG9zc2li
bGUoY3Vyc29yIGxlZ2FjeSB1cGRhdGVzKQogICAgICAgUXVlcnlpbmcgZm9yIGJ3X3N0YXRlIG9i
amVjdCBmcm9tIGdsb2JhbCBzdGF0ZSBpcyBub3QgcG9zc2libGUgYXMKICAgICAgIGl0IG1pZ2h0
IGdldCBzd2FwcGVkIHdpdGggb3RoZXIgZ2xvYmFsIHN0YXRlLgogICAgICAgU28uLi4ganVzdCBz
dGlja2VkIGNhbl9zYWd2IGJvb2xlYW4gaW50byB3bSBjcnRjIHN0YXRlLgoKdjE3OiAtIFNraXAg
aW5hY3RpdmUgY3J0Y3MsIHdoZW4gY2hlY2tpbmcgZm9yIFNBR1YtcmVhZGluZXNzLgoKdjE4OiAt
IFN3aXRjaCB0byB1c2UgaW50ZWxfYXRvbWljX2NydGNfc3RhdGVfZm9yX2VhY2hfcGxhbmVfc3Rh
dGUKICAgICAgIGluc3RlYWQgb2YgZm9yX2VhY2hfaW50ZWxfcGxhbmVfb25fY3J0YyBhbmQgZml4
ZWQgcHJldmlvdXMKICAgICAgIGNvZGUsIHdoaWNoIHdhcyB1c2luZyBvbGQgcGxhbmUgc3RhdGUs
IHdoaWNoIGNhdXNlZCBOVUxMIHB0cgogICAgICAgZGVyZWZlcmVuY2UsIGJhY2F1c2UgdGhhdCBj
b2RlIGlzIG5vdyBjYWxsZWQgYmVmb3JlIHdlIHN3YXAgdGhlCiAgICAgICBzdGF0ZS4KClNpZ25l
ZC1vZmYtYnk6IFN0YW5pc2xhdiBMaXNvdnNraXkgPHN0YW5pc2xhdi5saXNvdnNraXlAaW50ZWwu
Y29tPgpDYzogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGludGVsLmNvbT4KQ2M6IEph
bWVzIEF1c211cyA8amFtZXMuYXVzbXVzQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2J3LmggICAgICAgfCAgMTggKwogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgIHwgIDIzICstCiAuLi4vZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggICAgfCAgIDMgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUv
aW50ZWxfcG0uYyAgICAgICAgICAgICAgIHwgMzIyICsrKysrKysrKysrKysrKystLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uaCAgICAgICAgICAgICAgIHwgICAxICsKIDUgZmlsZXMg
Y2hhbmdlZCwgMzI0IGluc2VydGlvbnMoKyksIDQzIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYncuaCBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfYncuaAppbmRleCBiNWY2MTQ2MzkyMmYuLjQwODNhZGY0YjQz
MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9idy5oCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYncuaApAQCAtMTgsNiArMTgs
MjQgQEAgc3RydWN0IGludGVsX2NydGNfc3RhdGU7CiBzdHJ1Y3QgaW50ZWxfYndfc3RhdGUgewog
CXN0cnVjdCBpbnRlbF9nbG9iYWxfc3RhdGUgYmFzZTsKIAorCS8qCisJICogQ29udGFpbnMgYSBi
aXQgbWFzaywgdXNlZCB0byBkZXRlcm1pbmUsIHdoZXRoZXIgY29ycmVzcG9uZGVudAorCSAqIHBp
cGUgYWxsb3dzIFNBR1Ygb3Igbm90LgorCSAqLworCXU4IHBpcGVfc2Fndl9yZWplY3Q7CisKKwkv
KgorCSAqIFVzZWQgdG8gZGV0ZXJtaW5lIGlmIHdlIGFscmVhZHkgaGFkIGNhbGN1bGF0ZWQKKwkg
KiBTQUdWIG1hc2sgZm9yIHRoaXMgc3RhdGUgb25jZS4KKwkgKi8KKwlib29sIHNhZ3ZfY2FsY3Vs
YXRlZDsKKworCS8qCisJICogQ29udGFpbnMgZmluYWwgU0FHViBkZWNpc2lvbiBiYXNlZCBvbiBj
dXJyZW50IG1hc2ssCisJICogdG8gcHJldmVudCBkb2luZyB0aGUgc2FtZSBqb2Igb3ZlciBhbmQg
b3ZlciBhZ2Fpbi4KKwkgKi8KKwlib29sIGNhbl9zYWd2OworCiAJdW5zaWduZWQgaW50IGRhdGFf
cmF0ZVtJOTE1X01BWF9QSVBFU107CiAJdTggbnVtX2FjdGl2ZV9wbGFuZXNbSTkxNV9NQVhfUElQ
RVNdOwogfTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMK
aW5kZXggOGYyM2M0ZDUxYzMzLi45ZTAwNThhNzhlYTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBAIC0xNDAxMCw3ICsxNDAxMCwxMCBAQCBzdGF0
aWMgdm9pZCB2ZXJpZnlfd21fc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCS8qIFdh
dGVybWFya3MgKi8KIAkJZm9yIChsZXZlbCA9IDA7IGxldmVsIDw9IG1heF9sZXZlbDsgbGV2ZWwr
KykgewogCQkJaWYgKHNrbF93bV9sZXZlbF9lcXVhbHMoJmh3X3BsYW5lX3dtLT53bVtsZXZlbF0s
Ci0JCQkJCQkmc3dfcGxhbmVfd20tPndtW2xldmVsXSkpCisJCQkJCQkmc3dfcGxhbmVfd20tPndt
W2xldmVsXSkgfHwKKwkJCSAgIChza2xfd21fbGV2ZWxfZXF1YWxzKCZod19wbGFuZV93bS0+d21b
bGV2ZWxdLAorCQkJCQkJJnN3X3BsYW5lX3dtLT5zYWd2X3dtMCkgJiYKKwkJCSAgIChsZXZlbCA9
PSAwKSkpCiAJCQkJY29udGludWU7CiAKIAkJCWRybV9lcnIoJmRldl9wcml2LT5kcm0sCkBAIC0x
NDA2NSw3ICsxNDA2OCwxMCBAQCBzdGF0aWMgdm9pZCB2ZXJpZnlfd21fc3RhdGUoc3RydWN0IGlu
dGVsX2NydGMgKmNydGMsCiAJCS8qIFdhdGVybWFya3MgKi8KIAkJZm9yIChsZXZlbCA9IDA7IGxl
dmVsIDw9IG1heF9sZXZlbDsgbGV2ZWwrKykgewogCQkJaWYgKHNrbF93bV9sZXZlbF9lcXVhbHMo
Jmh3X3BsYW5lX3dtLT53bVtsZXZlbF0sCi0JCQkJCQkmc3dfcGxhbmVfd20tPndtW2xldmVsXSkp
CisJCQkJCQkmc3dfcGxhbmVfd20tPndtW2xldmVsXSkgfHwKKwkJCSAgIChza2xfd21fbGV2ZWxf
ZXF1YWxzKCZod19wbGFuZV93bS0+d21bbGV2ZWxdLAorCQkJCQkJJnN3X3BsYW5lX3dtLT5zYWd2
X3dtMCkgJiYKKwkJCSAgIChsZXZlbCA9PSAwKSkpCiAJCQkJY29udGludWU7CiAKIAkJCWRybV9l
cnIoJmRldl9wcml2LT5kcm0sCkBAIC0xNTU0NCw4ICsxNTU1MCwxMCBAQCBzdGF0aWMgdm9pZCBp
bnRlbF9hdG9taWNfY29tbWl0X3RhaWwoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUp
CiAJCSAqIFNLTCB3b3JrYXJvdW5kOiBic3BlYyByZWNvbW1lbmRzIHdlIGRpc2FibGUgdGhlIFNB
R1Ygd2hlbiB3ZQogCQkgKiBoYXZlIG1vcmUgdGhlbiBvbmUgcGlwZSBlbmFibGVkCiAJCSAqLwot
CQlpZiAoIWludGVsX2Nhbl9lbmFibGVfc2FndihzdGF0ZSkpCi0JCQlpbnRlbF9kaXNhYmxlX3Nh
Z3YoZGV2X3ByaXYpOworCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDExKSB7CisJCQlpZiAo
IWludGVsX2Nhbl9lbmFibGVfc2FndihzdGF0ZSkpCisJCQkJaW50ZWxfZGlzYWJsZV9zYWd2KGRl
dl9wcml2KTsKKwkJfQogCiAJCWludGVsX21vZGVzZXRfdmVyaWZ5X2Rpc2FibGVkKGRldl9wcml2
LCBzdGF0ZSk7CiAJfQpAQCAtMTU2NDUsOCArMTU2NTMsMTAgQEAgc3RhdGljIHZvaWQgaW50ZWxf
YXRvbWljX2NvbW1pdF90YWlsKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCWlm
IChzdGF0ZS0+bW9kZXNldCkKIAkJaW50ZWxfdmVyaWZ5X3BsYW5lcyhzdGF0ZSk7CiAKLQlpZiAo
c3RhdGUtPm1vZGVzZXQgJiYgaW50ZWxfY2FuX2VuYWJsZV9zYWd2KHN0YXRlKSkKLQkJaW50ZWxf
ZW5hYmxlX3NhZ3YoZGV2X3ByaXYpOworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTEpIHsK
KwkJaWYgKHN0YXRlLT5tb2Rlc2V0ICYmIGludGVsX2Nhbl9lbmFibGVfc2FndihzdGF0ZSkpCisJ
CQlpbnRlbF9lbmFibGVfc2FndihkZXZfcHJpdik7CisJfQogCiAJZHJtX2F0b21pY19oZWxwZXJf
Y29tbWl0X2h3X2RvbmUoJnN0YXRlLT5iYXNlKTsKIApAQCAtMTU3OTgsNyArMTU4MDgsNiBAQCBz
dGF0aWMgaW50IGludGVsX2F0b21pY19jb21taXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAog
CWlmIChzdGF0ZS0+Z2xvYmFsX3N0YXRlX2NoYW5nZWQpIHsKIAkJYXNzZXJ0X2dsb2JhbF9zdGF0
ZV9sb2NrZWQoZGV2X3ByaXYpOwotCiAJCWRldl9wcml2LT5hY3RpdmVfcGlwZXMgPSBzdGF0ZS0+
YWN0aXZlX3BpcGVzOwogCX0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXlfdHlwZXMuaAppbmRleCA1ZTAwZTYxMWYwNzcuLmRhMDMwOGI4N2RhZCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5
cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5
cGVzLmgKQEAgLTY2OSwxMSArNjY5LDE0IEBAIHN0cnVjdCBza2xfcGxhbmVfd20gewogCXN0cnVj
dCBza2xfd21fbGV2ZWwgd21bOF07CiAJc3RydWN0IHNrbF93bV9sZXZlbCB1dl93bVs4XTsKIAlz
dHJ1Y3Qgc2tsX3dtX2xldmVsIHRyYW5zX3dtOworCXN0cnVjdCBza2xfd21fbGV2ZWwgc2Fndl93
bTA7CisJc3RydWN0IHNrbF93bV9sZXZlbCB1dl9zYWd2X3dtMDsKIAlib29sIGlzX3BsYW5hcjsK
IH07CiAKIHN0cnVjdCBza2xfcGlwZV93bSB7CiAJc3RydWN0IHNrbF9wbGFuZV93bSBwbGFuZXNb
STkxNV9NQVhfUExBTkVTXTsKKwlib29sIGNhbl9zYWd2OwogfTsKIAogZW51bSB2bHZfd21fbGV2
ZWwgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKaW5kZXggZmVjODk3MjJiZTc1Li5mODBiYzc5MWY2
MjYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwpAQCAtNDMsNiArNDMsNyBAQAogI2luY2x1ZGUg
Imk5MTVfZml4ZWQuaCIKICNpbmNsdWRlICJpOTE1X2lycS5oIgogI2luY2x1ZGUgImk5MTVfdHJh
Y2UuaCIKKyNpbmNsdWRlICJkaXNwbGF5L2ludGVsX2J3LmgiCiAjaW5jbHVkZSAiaW50ZWxfcG0u
aCIKICNpbmNsdWRlICJpbnRlbF9zaWRlYmFuZC5oIgogI2luY2x1ZGUgIi4uLy4uLy4uL3BsYXRm
b3JtL3g4Ni9pbnRlbF9pcHMuaCIKQEAgLTM2MzQsNyArMzYzNSw3IEBAIHN0YXRpYyBib29sIHNr
bF9uZWVkc19tZW1vcnlfYndfd2Eoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQog
CXJldHVybiBJU19HRU45X0JDKGRldl9wcml2KSB8fCBJU19CUk9YVE9OKGRldl9wcml2KTsKIH0K
IAotc3RhdGljIGJvb2wKK2Jvb2wKIGludGVsX2hhc19zYWd2KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKIHsKIAkvKiBIQUNLISAqLwpAQCAtMzc1Nyw0MSArMzc1OCwyOCBAQCBp
bnRlbF9kaXNhYmxlX3NhZ3Yoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXJl
dHVybiAwOwogfQogCi1ib29sIGludGVsX2Nhbl9lbmFibGVfc2FndihzdHJ1Y3QgaW50ZWxfYXRv
bWljX3N0YXRlICpzdGF0ZSkKK3N0YXRpYyBib29sIHNrbF9jYW5fZW5hYmxlX3NhZ3Zfb25fcGlw
ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2ID0gc3RhdGUtPmJhc2UuZGV2OworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBj
cnRjX3N0YXRlLT51YXBpLmNydGMtPmRldjsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUg
PSB0b19pbnRlbF9hdG9taWNfc3RhdGUoY3J0Y19zdGF0ZS0+dWFwaS5zdGF0ZSk7CiAJc3RydWN0
IGludGVsX2NydGMgKmNydGM7CiAJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZTsKLQlzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKLQllbnVtIHBpcGUgcGlwZTsKKwlzdHJ1Y3Qg
aW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlOwogCWludCBsZXZlbCwgbGF0ZW5jeTsKIAot
CWlmICghaW50ZWxfaGFzX3NhZ3YoZGV2X3ByaXYpKQotCQlyZXR1cm4gZmFsc2U7Ci0KLQkvKgot
CSAqIElmIHRoZXJlIGFyZSBubyBhY3RpdmUgQ1JUQ3MsIG5vIGFkZGl0aW9uYWwgY2hlY2tzIG5l
ZWQgYmUgcGVyZm9ybWVkCi0JICovCi0JaWYgKGh3ZWlnaHQ4KHN0YXRlLT5hY3RpdmVfcGlwZXMp
ID09IDApCi0JCXJldHVybiB0cnVlOworCWNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUt
PnVhcGkuY3J0Yyk7CiAKLQkvKgotCSAqIFNLTCsgd29ya2Fyb3VuZDogYnNwZWMgcmVjb21tZW5k
cyB3ZSBkaXNhYmxlIFNBR1Ygd2hlbiB3ZSBoYXZlCi0JICogbW9yZSB0aGVuIG9uZSBwaXBlIGVu
YWJsZWQKLQkgKi8KLQlpZiAoaHdlaWdodDgoc3RhdGUtPmFjdGl2ZV9waXBlcykgPiAxKQorCWlm
ICgoSU5URUxfR0VOKGRldl9wcml2KSA8PSA5KSAmJiAoaHdlaWdodDgoc3RhdGUtPmFjdGl2ZV9w
aXBlcykgPiAxKSkKIAkJcmV0dXJuIGZhbHNlOwogCi0JLyogU2luY2Ugd2UncmUgbm93IGd1YXJh
bnRlZWQgdG8gb25seSBoYXZlIG9uZSBhY3RpdmUgQ1JUQy4uLiAqLwotCXBpcGUgPSBmZnMoc3Rh
dGUtPmFjdGl2ZV9waXBlcykgLSAxOwotCWNydGMgPSBpbnRlbF9nZXRfY3J0Y19mb3JfcGlwZShk
ZXZfcHJpdiwgcGlwZSk7Ci0JY3J0Y19zdGF0ZSA9IHRvX2ludGVsX2NydGNfc3RhdGUoY3J0Yy0+
YmFzZS5zdGF0ZSk7Ci0KLQlpZiAoY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFncyAm
IERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFKQorCWlmIChjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9t
b2RlLmZsYWdzICYgRFJNX01PREVfRkxBR19JTlRFUkxBQ0UpIHsKKwkJRFJNX0RFQlVHX0tNUygi
Tm8gU0FHViBmb3IgaW50ZXJsYWNlZCBtb2RlIG9uIHBpcGUgJWNcbiIsCisJCQkgICAgICBwaXBl
X25hbWUoY3J0Yy0+cGlwZSkpOwogCQlyZXR1cm4gZmFsc2U7CisJfQogCi0JZm9yX2VhY2hfaW50
ZWxfcGxhbmVfb25fY3J0YyhkZXYsIGNydGMsIHBsYW5lKSB7CisJaW50ZWxfYXRvbWljX2NydGNf
c3RhdGVfZm9yX2VhY2hfcGxhbmVfc3RhdGUocGxhbmUsIHBsYW5lX3N0YXRlLCBjcnRjX3N0YXRl
KSB7CiAJCXN0cnVjdCBza2xfcGxhbmVfd20gKndtID0KIAkJCSZjcnRjX3N0YXRlLT53bS5za2wu
b3B0aW1hbC5wbGFuZXNbcGxhbmUtPmlkXTsKIApAQCAtMzgwNyw3ICszNzk1LDcgQEAgYm9vbCBp
bnRlbF9jYW5fZW5hYmxlX3NhZ3Yoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJ
CWxhdGVuY3kgPSBkZXZfcHJpdi0+d20uc2tsX2xhdGVuY3lbbGV2ZWxdOwogCiAJCWlmIChza2xf
bmVlZHNfbWVtb3J5X2J3X3dhKGRldl9wcml2KSAmJgotCQkgICAgcGxhbmUtPmJhc2Uuc3RhdGUt
PmZiLT5tb2RpZmllciA9PQorCQkgICAgcGxhbmVfc3RhdGUtPnVhcGkuZmItPm1vZGlmaWVyID09
CiAJCSAgICBJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRCkKIAkJCWxhdGVuY3kgKz0gMTU7CiAKQEAg
LTM4MTYsMTMgKzM4MDQsMTQ4IEBAIGJvb2wgaW50ZWxfY2FuX2VuYWJsZV9zYWd2KHN0cnVjdCBp
bnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQkgKiBpbmN1ciBtZW1vcnkgbGF0ZW5jaWVzIGhp
Z2hlciB0aGFuIHNhZ3ZfYmxvY2tfdGltZV91cyB3ZQogCQkgKiBjYW4ndCBlbmFibGUgU0FHVi4K
IAkJICovCi0JCWlmIChsYXRlbmN5IDwgZGV2X3ByaXYtPnNhZ3ZfYmxvY2tfdGltZV91cykKKwkJ
aWYgKGxhdGVuY3kgPCBkZXZfcHJpdi0+c2Fndl9ibG9ja190aW1lX3VzKSB7CisJCQlEUk1fREVC
VUdfS01TKCJMYXRlbmN5ICVkIDwgc2FndiBibG9jayB0aW1lICVkLCBubyBTQUdWIGZvciBwaXBl
ICVjXG4iLAorCQkJCSAgICAgIGxhdGVuY3ksIGRldl9wcml2LT5zYWd2X2Jsb2NrX3RpbWVfdXMs
IHBpcGVfbmFtZShjcnRjLT5waXBlKSk7CiAJCQlyZXR1cm4gZmFsc2U7CisJCX0KIAl9CiAKIAly
ZXR1cm4gdHJ1ZTsKIH0KIAorc3RhdGljIGJvb2wKK3RnbF9jYW5fZW5hYmxlX3NhZ3Zfb25fcGlw
ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7CisKK3N0YXRpYyBib29sIGlu
dGVsX2NhbGN1bGF0ZV9zYWd2X3Jlc3VsdChzdHJ1Y3QgaW50ZWxfYndfc3RhdGUgKmJ3X3N0YXRl
KQoreworCXJldHVybiBid19zdGF0ZS0+cGlwZV9zYWd2X3JlamVjdCA9PSAwOworfQorCitzdGF0
aWMgaW50IGludGVsX2NvbXB1dGVfc2Fndl9tYXNrKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUg
KnN0YXRlKQoreworCWludCByZXQ7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IHN0YXRlLT5i
YXNlLmRldjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRl
dik7CisJc3RydWN0IGludGVsX2NydGMgKmNydGM7CisJc3RydWN0IGludGVsX2NydGNfc3RhdGUg
Km5ld19jcnRjX3N0YXRlOworCXN0cnVjdCBpbnRlbF9id19zdGF0ZSAqbmV3X2J3X3N0YXRlID0g
TlVMTDsKKwlzdHJ1Y3QgaW50ZWxfYndfc3RhdGUgKm9sZF9id19zdGF0ZSA9IE5VTEw7CisJaW50
IGk7CisKKwkvKgorCSAqIElmIFNBR1YgaXMgbm90IHN1cHBvcnRlZCB3ZSBqdXN0IGNhbid0IGRv
IGFueXRoaW5nCisJICogbm90IGV2ZW4gc2V0IG9yIHJlamVjdCBTQUdWIHBvaW50cyAtIGp1c3Qg
YmFpbCBvdXQuCisJICogVGh1cyBhdm9pZCBuZWVkbGVzcyBjYWxjdWxhdGlvbnMuCisJICovCisJ
aWYgKCFpbnRlbF9oYXNfc2FndihkZXZfcHJpdikpCisJCXJldHVybiAwOworCisJZm9yX2VhY2hf
bmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsCisJCQkJCSBuZXdfY3J0Y19zdGF0
ZSwgaSkgeworCQlib29sIHBpcGVfc2Fndl9lbmFibGU7CisKKwkJbmV3X2J3X3N0YXRlID0gaW50
ZWxfYndfZ2V0X3N0YXRlKHN0YXRlKTsKKwkJb2xkX2J3X3N0YXRlID0gaW50ZWxfYndfZ2V0X29s
ZF9zdGF0ZShzdGF0ZSk7CisKKwkJaWYgKElTX0VSUl9PUl9OVUxMKG5ld19id19zdGF0ZSkgfHwg
SVNfRVJSX09SX05VTEwob2xkX2J3X3N0YXRlKSkgeworCQkJV0FSTigxLCAiQ291bGQgbm90IGdl
dCBid19zdGF0ZVxuIik7CisJCQlyZXR1cm4gLUVJTlZBTDsKKwkJfQorCisJCW5ld19id19zdGF0
ZS0+c2Fndl9jYWxjdWxhdGVkID0gZmFsc2U7CisKKwkJaWYgKCFuZXdfY3J0Y19zdGF0ZS0+aHcu
YWN0aXZlKQorCQkJY29udGludWU7CisKKwkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIp
CisJCQlwaXBlX3NhZ3ZfZW5hYmxlID0gdGdsX2Nhbl9lbmFibGVfc2Fndl9vbl9waXBlKG5ld19j
cnRjX3N0YXRlKTsKKwkJZWxzZQorCQkJcGlwZV9zYWd2X2VuYWJsZSA9IHNrbF9jYW5fZW5hYmxl
X3NhZ3Zfb25fcGlwZShuZXdfY3J0Y19zdGF0ZSk7CisKKwkJaWYgKHBpcGVfc2Fndl9lbmFibGUp
CisJCQluZXdfYndfc3RhdGUtPnBpcGVfc2Fndl9yZWplY3QgJj0gfkJJVChjcnRjLT5waXBlKTsK
KwkJZWxzZQorCQkJbmV3X2J3X3N0YXRlLT5waXBlX3NhZ3ZfcmVqZWN0IHw9IEJJVChjcnRjLT5w
aXBlKTsKKwl9CisKKwlpZiAoIW5ld19id19zdGF0ZSB8fCAhb2xkX2J3X3N0YXRlKQorCQlyZXR1
cm4gMDsKKworCW5ld19id19zdGF0ZS0+Y2FuX3NhZ3YgPSBpbnRlbF9jYWxjdWxhdGVfc2Fndl9y
ZXN1bHQobmV3X2J3X3N0YXRlKTsKKwluZXdfYndfc3RhdGUtPnNhZ3ZfY2FsY3VsYXRlZCA9IHRy
dWU7CisKKwlmb3JfZWFjaF9uZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0YywKKwkJ
CQkJIG5ld19jcnRjX3N0YXRlLCBpKSB7CisJCXN0cnVjdCBza2xfcGlwZV93bSAqcGlwZV93bSA9
ICZuZXdfY3J0Y19zdGF0ZS0+d20uc2tsLm9wdGltYWw7CisKKwkJLyoKKwkJICogRHVlIHRvIGRy
bSBsaW1pdGF0aW9uIGF0IGNvbW1pdCBzdGF0ZSwgd2hlbgorCQkgKiBjaGFuZ2VzIGFyZSB3cml0
dGVuIHRoZSB3aG9sZSBhdG9taWMgc3RhdGUgaXMKKwkJICogemVyb2VkIGF3YXkgPT4gd2hpY2gg
cHJldmVudHMgZnJvbSB1c2luZyBpdCwKKwkJICogc28ganVzdCBzdGlja2luZyBpdCBpbnRvIHBp
cGUgd20gc3RhdGUgZm9yCisJCSAqIGtlZXBpbmcgaXQgc2ltcGxlIC0gYW55d2F5IHRoaXMgaXMg
cmVsYXRlZCB0byB3bS4KKwkJICogUHJvcGVyIHdheSBpbiBpZGVhbCB1bml2ZXJzZSB3b3VsZCBi
ZSBvZiBjb3Vyc2Ugbm90CisJCSAqIHRvIGxvc2UgcGFyZW50IGF0b21pYyBzdGF0ZSBvYmplY3Qg
ZnJvbSBjaGlsZCBjcnRjX3N0YXRlLAorCQkgKiBhbmQgc3RpY2sgdG8gT09QIHByb2dyYW1taW5n
IHByaW5jaXBsZXMsIHdoaWNoIGhhZCBiZWVuCisJCSAqIHNjaWVudGlmaWNhbGx5IHByb3ZlbiB0
byB3b3JrLgorCQkgKi8KKwkJcGlwZV93bS0+Y2FuX3NhZ3YgPSBuZXdfYndfc3RhdGUtPmNhbl9z
YWd2OworCX0KKworCS8qCisJICogRm9yIFNBR1Ygd2UgbmVlZCB0byBhY2NvdW50IGFsbCB0aGUg
cGlwZXMsCisJICogbm90IG9ubHkgdGhlIG9uZXMgd2hpY2ggYXJlIGluIHN0YXRlIGN1cnJlbnRs
eS4KKwkgKiBHcmFiIGFsbCBsb2NrcyBpZiB3ZSBkZXRlY3QgdGhhdCB3ZSBhcmUgYWN0dWFsbHkK
KwkgKiBnb2luZyB0byBkbyBzb21ldGhpbmcuCisJICovCisJaWYgKG5ld19id19zdGF0ZS0+cGlw
ZV9zYWd2X3JlamVjdCAhPSBvbGRfYndfc3RhdGUtPnBpcGVfc2Fndl9yZWplY3QpIHsKKwkJRFJN
X0RFQlVHX0tNUygiU3RhdGUgJXA6IG9sZCBzYWd2IG1hc2sgMHgleCwgbmV3IHNhZ3YgbWFzayAw
eCV4XG4iLAorCQkJICAgICAgc3RhdGUsCisJCQkgICAgICBvbGRfYndfc3RhdGUtPnBpcGVfc2Fn
dl9yZWplY3QsCisJCQkgICAgICBuZXdfYndfc3RhdGUtPnBpcGVfc2Fndl9yZWplY3QpOworCisJ
CXJldCA9IGludGVsX2F0b21pY19zZXJpYWxpemVfZ2xvYmFsX3N0YXRlKCZuZXdfYndfc3RhdGUt
PmJhc2UpOworCQlpZiAocmV0KSB7CisJCQlEUk1fREVCVUdfS01TKCJDb3VsZCBub3Qgc2VyaWFs
aXplIGdsb2JhbCBzdGF0ZVxuIik7CisJCQlyZXR1cm4gcmV0OworCQl9CisJfQorCisJcmV0dXJu
IDA7Cit9CisKKy8qCisgKiBUaGlzIGZ1bmN0aW9uIHRvIGJlIHVzZWQgYmVmb3JlIHN3YXAgc3Rh
dGUKKyAqLworYm9vbCBpbnRlbF9jYW5fZW5hYmxlX3NhZ3Yoc3RydWN0IGludGVsX2F0b21pY19z
dGF0ZSAqc3RhdGUpCit7CisJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IHN0YXRlLT5iYXNlLmRl
djsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJ
c3RydWN0IGludGVsX2J3X3N0YXRlICpid19zdGF0ZTsKKworCWlmICghaW50ZWxfaGFzX3NhZ3Yo
ZGV2X3ByaXYpKSB7CisJCURSTV9ERUJVR19LTVMoIk5vIFNBR1Ygc3VwcG9ydCBkZXRlY3RlZFxu
Iik7CisJCXJldHVybiBmYWxzZTsKKwl9CisKKwlid19zdGF0ZSA9IGludGVsX2J3X2dldF9zdGF0
ZShzdGF0ZSk7CisKKwlpZiAoSVNfRVJSX09SX05VTEwoYndfc3RhdGUpKSB7CisJCVdBUk4oMSwg
IkNvdWxkIG5vdCBnZXQgYndfc3RhdGVcbiIpOworCQlyZXR1cm4gZmFsc2U7CisJfQorCisJaWYg
KGJ3X3N0YXRlLT5zYWd2X2NhbGN1bGF0ZWQpCisJCWdvdG8gb3V0OworCisJYndfc3RhdGUtPmNh
bl9zYWd2ID0gaW50ZWxfY2FsY3VsYXRlX3NhZ3ZfcmVzdWx0KGJ3X3N0YXRlKTsKKwlid19zdGF0
ZS0+c2Fndl9jYWxjdWxhdGVkID0gdHJ1ZTsKKworb3V0OgorCXJldHVybiBid19zdGF0ZS0+Y2Fu
X3NhZ3Y7Cit9CisKIC8qCiAgKiBDYWxjdWxhdGUgaW5pdGlhbCBEQnVmIHNsaWNlIG9mZnNldCwg
YmFzZWQgb24gc2xpY2Ugc2l6ZQogICogYW5kIG1hc2soaS5lIGlmIHNsaWNlIHNpemUgaXMgMTAy
NCBhbmQgc2Vjb25kIHNsaWNlIGlzIGVuYWJsZWQKQEAgLTQwNDIsNiArNDE2NSw3IEBAIHNrbF9j
dXJzb3JfYWxsb2NhdGlvbihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSwKIAkJdW5zaWduZWQgaW50IGxhdGVuY3kgPSBkZXZfcHJpdi0+d20uc2tsX2xhdGVuY3lbbGV2
ZWxdOwogCiAJCXNrbF9jb21wdXRlX3BsYW5lX3dtKGNydGNfc3RhdGUsIGxldmVsLCBsYXRlbmN5
LCAmd3AsICZ3bSwgJndtKTsKKwogCQlpZiAod20ubWluX2RkYl9hbGxvYyA9PSBVMTZfTUFYKQog
CQkJYnJlYWs7CiAKQEAgLTQ1NTYsOSArNDY4MCw4MyBAQCBza2xfcGxhbmVfd21fbGV2ZWwoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJY29uc3Qgc3RydWN0IHNr
bF9wbGFuZV93bSAqd20gPQogCQkmY3J0Y19zdGF0ZS0+d20uc2tsLm9wdGltYWwucGxhbmVzW3Bs
YW5lX2lkXTsKIAorCWlmICghbGV2ZWwpIHsKKwkJY29uc3Qgc3RydWN0IHNrbF9waXBlX3dtICpw
aXBlX3dtID0gJmNydGNfc3RhdGUtPndtLnNrbC5vcHRpbWFsOworCisJCWlmIChwaXBlX3dtLT5j
YW5fc2FndikKKwkJCXJldHVybiBjb2xvcl9wbGFuZSA9PSAwID8gJndtLT5zYWd2X3dtMCA6ICZ3
bS0+dXZfc2Fndl93bTA7CisJfQorCiAJcmV0dXJuIGNvbG9yX3BsYW5lID09IDAgPyAmd20tPndt
W2xldmVsXSA6ICZ3bS0+dXZfd21bbGV2ZWxdOwogfQogCitzdGF0aWMgYm9vbAordGdsX2Nhbl9l
bmFibGVfc2Fndl9vbl9waXBlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQor
eworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IGNydGNfc3RhdGUtPnVhcGkuY3J0YzsKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmRldik7CisJc3Ry
dWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGMpOworCXN0cnVj
dCBza2xfZGRiX2VudHJ5ICphbGxvYyA9ICZjcnRjX3N0YXRlLT53bS5za2wuZGRiOworCXUxNiBh
bGxvY19zaXplOworCXU2NCB0b3RhbF9kYXRhX3JhdGU7CisJZW51bSBwbGFuZV9pZCBwbGFuZV9p
ZDsKKwlpbnQgbnVtX2FjdGl2ZTsKKwl1NjQgcGxhbmVfZGF0YV9yYXRlW0k5MTVfTUFYX1BMQU5F
U10gPSB7fTsKKwl1MzIgYmxvY2tzOworCisJLyoKKwkgKiBJZiBwaXBlIGlzIG5vdCBhY3RpdmUg
aXQgY2FuJ3QgYWZmZWN0IFNBR1YgcmVqZWN0aW9uCisJICogQ2hlY2tpbmcgaXQgaGVyZSBpcyBu
ZWVkZWQgdG8gbGVhdmUgb25seSBjYXNlcyB3aGVuCisJICogYWxsb2Nfc2l6ZSBpcyAwIGZvciBh
bnkgb3RoZXIgcmVhc29ucywgZXhjZXB0IGluYWN0aXZlCisJICogcGlwZS4gQXMgaW5hY3RpdmUg
cGlwZSBpcyBmaW5lLCBob3dldmVyIGhhdmluZyBubyBkZGIKKwkgKiBzcGFjZSBhdmFpbGFibGUg
aXMgYWxyZWFkeSBwcm9ibGVtYXRpYyAtIHNvIG5lZWQgdG8KKwkgKiB0byBzZXBhcmF0ZSB0aG9z
ZS4KKwkgKi8KKwlpZiAoIWNydGNfc3RhdGUtPmh3LmFjdGl2ZSkKKwkJcmV0dXJuIHRydWU7CisK
KwkvKgorCSAqIE5vIG5lZWQgdG8gY2hlY2sgZ2VuIGhlcmUsIHdlIGNhbGwgdGhpcyBvbmx5IGZv
ciBnZW4xMgorCSAqLworCXRvdGFsX2RhdGFfcmF0ZSA9CisJCWljbF9nZXRfdG90YWxfcmVsYXRp
dmVfZGF0YV9yYXRlKGNydGNfc3RhdGUsCisJCQkJCQkgcGxhbmVfZGF0YV9yYXRlKTsKKworCXNr
bF9kZGJfZ2V0X3BpcGVfYWxsb2NhdGlvbl9saW1pdHMoZGV2X3ByaXYsIGNydGNfc3RhdGUsCisJ
CQkJCSAgIHRvdGFsX2RhdGFfcmF0ZSwKKwkJCQkJICAgYWxsb2MsICZudW1fYWN0aXZlKTsKKwlh
bGxvY19zaXplID0gc2tsX2RkYl9lbnRyeV9zaXplKGFsbG9jKTsKKwlpZiAoYWxsb2Nfc2l6ZSA9
PSAwKQorCQlyZXR1cm4gZmFsc2U7CisKKwkvKgorCSAqIERvIGNoZWNrIGlmIHdlIGNhbiBmaXQg
TDAgKyBzYWd2X2Jsb2NrX3RpbWUgYW5kCisJICogZGlzYWJsZSBTQUdWIGlmIHdlIGNhbid0Lgor
CSAqLworCWJsb2NrcyA9IDA7CisJZm9yX2VhY2hfcGxhbmVfaWRfb25fY3J0YyhpbnRlbF9jcnRj
LCBwbGFuZV9pZCkgeworCQkvKgorCQkgKiBUaGUgb25seSBwbGFjZSwgd2hlcmUgd2UgY2FuJ3Qg
dXNlIHNrbF9wbGFuZV93bV9sZXZlbAorCQkgKiBhY2Nlc3NvciwgYmVjYXVzZSBpZiBhY3R1YWxs
eSBjYWxscyBpbnRlbF9jYW5fZW5hYmxlX3NhZ3YKKwkJICogd2hpY2ggZGVwZW5kcyBvbiB0aGF0
IGZ1bmN0aW9uLgorCQkgKi8KKwkJY29uc3Qgc3RydWN0IHNrbF9wbGFuZV93bSAqd20gPQorCQkJ
JmNydGNfc3RhdGUtPndtLnNrbC5vcHRpbWFsLnBsYW5lc1twbGFuZV9pZF07CisKKwkJYmxvY2tz
ICs9IHdtLT5zYWd2X3dtMC5taW5fZGRiX2FsbG9jOworCQlibG9ja3MgKz0gd20tPnV2X3NhZ3Zf
d20wLm1pbl9kZGJfYWxsb2M7CisKKwkJaWYgKGJsb2NrcyA+IGFsbG9jX3NpemUpIHsKKwkJCURS
TV9ERUJVR19LTVMoIk5vdCBlbm91Z2ggZGRiIGJsb2NrcyglZDwlZCkgZm9yIFNBR1Ygb24gcGlw
ZSAlY1xuIiwKKwkJCQkgICAgICBhbGxvY19zaXplLCBibG9ja3MsIHBpcGVfbmFtZShpbnRlbF9j
cnRjLT5waXBlKSk7CisJCQlyZXR1cm4gZmFsc2U7CisJCX0KKwl9CisJRFJNX0RFQlVHX0tNUygi
JWQgdG90YWwgYmxvY2tzIHJlcXVpcmVkIGZvciBTQUdWLCBkZGIgZW50cnkgc2l6ZSAlZFxuIiwK
KwkJICAgICAgYmxvY2tzLCBhbGxvY19zaXplKTsKKwlyZXR1cm4gdHJ1ZTsKK30KKwogc3RhdGlj
IGludAogc2tsX2FsbG9jYXRlX3BpcGVfZGRiKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogewpAQCAtNTE0MCwxMSArNTMzOCwxOSBAQCBzdGF0aWMgdm9pZCBza2xfY29tcHV0
ZV9wbGFuZV93bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIHN0
YXRpYyB2b2lkCiBza2xfY29tcHV0ZV93bV9sZXZlbHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUsCiAJCSAgICAgIGNvbnN0IHN0cnVjdCBza2xfd21fcGFyYW1zICp3
bV9wYXJhbXMsCi0JCSAgICAgIHN0cnVjdCBza2xfd21fbGV2ZWwgKmxldmVscykKKwkJICAgICAg
c3RydWN0IHNrbF9wbGFuZV93bSAqcGxhbmVfd20sCisJCSAgICAgIGJvb2wgeXV2KQogewogCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+dWFw
aS5jcnRjLT5kZXYpOwogCWludCBsZXZlbCwgbWF4X2xldmVsID0gaWxrX3dtX21heF9sZXZlbChk
ZXZfcHJpdik7CisJLyoKKwkgKiBDaGVjayB3aGljaCBraW5kIG9mIHBsYW5lIGlzIGl0IGFuZCBi
YXNlZCBvbiB0aGF0IGNhbGN1bGF0ZQorCSAqIGNvcnJlc3BvbmRlbnQgV00gbGV2ZWxzLgorCSAq
LworCXN0cnVjdCBza2xfd21fbGV2ZWwgKmxldmVscyA9IHl1diA/IHBsYW5lX3dtLT51dl93bSA6
IHBsYW5lX3dtLT53bTsKIAlzdHJ1Y3Qgc2tsX3dtX2xldmVsICpyZXN1bHRfcHJldiA9ICZsZXZl
bHNbMF07CisJc3RydWN0IHNrbF93bV9sZXZlbCAqc2Fndl93bSA9IHl1diA/CisJCQkJJnBsYW5l
X3dtLT51dl9zYWd2X3dtMCA6ICZwbGFuZV93bS0+c2Fndl93bTA7CiAKIAlmb3IgKGxldmVsID0g
MDsgbGV2ZWwgPD0gbWF4X2xldmVsOyBsZXZlbCsrKSB7CiAJCXN0cnVjdCBza2xfd21fbGV2ZWwg
KnJlc3VsdCA9ICZsZXZlbHNbbGV2ZWxdOwpAQCAtNTE1NSw2ICs1MzYxLDI3IEBAIHNrbF9jb21w
dXRlX3dtX2xldmVscyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwK
IAogCQlyZXN1bHRfcHJldiA9IHJlc3VsdDsKIAl9CisJLyoKKwkgKiBGb3IgR2VuMTIgaWYgaXQg
aXMgYW4gTDAgd2UgbmVlZCB0byBhbHNvCisJICogY29uc2lkZXIgc2Fndl9ibG9ja190aW1lIHdo
ZW4gY2FsY3VsYXRpbmcKKwkgKiBMMCB3YXRlcm1hcmsgLSB3ZSB3aWxsIG5lZWQgdGhhdCB3aGVu
IG1ha2luZworCSAqIGEgZGVjaXNpb24gd2hldGhlciBlbmFibGUgU0FHViBvciBub3QuCisJICog
Rm9yIG9sZGVyIGdlbnMgd2UgYWdyZWVkIHRvIGNvcHkgTDAgdmFsdWUgZm9yCisJICogY29tcGF0
aWJpbGl0eS4KKwkgKi8KKwlpZiAoKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpKSB7CisJCXUz
MiBsYXRlbmN5ID0gZGV2X3ByaXYtPndtLnNrbF9sYXRlbmN5WzBdOworCisJCWxhdGVuY3kgKz0g
ZGV2X3ByaXYtPnNhZ3ZfYmxvY2tfdGltZV91czsKKwkJc2tsX2NvbXB1dGVfcGxhbmVfd20oY3J0
Y19zdGF0ZSwgMCwgbGF0ZW5jeSwKKwkJCQkgICAgIHdtX3BhcmFtcywgJmxldmVsc1swXSwKKwkJ
CQkgICAgIHNhZ3Zfd20pOworCQlEUk1fREVCVUdfS01TKCIlZCBMMCBibG9ja3MgcmVxdWlyZWQg
Zm9yIFNBR1YgdnMgJWQgZm9yIG5vbi1TQUdWXG4iLAorCQkJICAgICAgc2Fndl93bS0+bWluX2Rk
Yl9hbGxvYywgbGV2ZWxzWzBdLm1pbl9kZGJfYWxsb2MpOworCX0gZWxzZSB7CisJCS8qIFNpbmNl
IGFsbCBtZW1iZXJzIGFyZSBQT0QgKi8KKwkJKnNhZ3Zfd20gPSBsZXZlbHNbMF07CisJfQogfQog
CiBzdGF0aWMgdm9pZCBza2xfY29tcHV0ZV90cmFuc2l0aW9uX3dtKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLApAQCAtNTIzNyw3ICs1NDY0LDcgQEAgc3RhdGljIGlu
dCBza2xfYnVpbGRfcGxhbmVfd21fc2luZ2xlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlLAogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlza2xfY29tcHV0ZV93bV9sZXZl
bHMoY3J0Y19zdGF0ZSwgJndtX3BhcmFtcywgd20tPndtKTsKKwlza2xfY29tcHV0ZV93bV9sZXZl
bHMoY3J0Y19zdGF0ZSwgJndtX3BhcmFtcywgd20sIGZhbHNlKTsKIAlza2xfY29tcHV0ZV90cmFu
c2l0aW9uX3dtKGNydGNfc3RhdGUsICZ3bV9wYXJhbXMsIHdtKTsKIAogCXJldHVybiAwOwpAQCAt
NTI1OSw3ICs1NDg2LDcgQEAgc3RhdGljIGludCBza2xfYnVpbGRfcGxhbmVfd21fdXYoc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsK
IAotCXNrbF9jb21wdXRlX3dtX2xldmVscyhjcnRjX3N0YXRlLCAmd21fcGFyYW1zLCB3bS0+dXZf
d20pOworCXNrbF9jb21wdXRlX3dtX2xldmVscyhjcnRjX3N0YXRlLCAmd21fcGFyYW1zLCB3bSwg
dHJ1ZSk7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTU1OTgsOSArNTgyNSwyNSBAQCBza2xfcHJpbnRf
d21fY2hhbmdlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJZm9yX2VhY2hf
aW50ZWxfcGxhbmVfb25fY3J0YygmZGV2X3ByaXYtPmRybSwgY3J0YywgcGxhbmUpIHsKIAkJCWVu
dW0gcGxhbmVfaWQgcGxhbmVfaWQgPSBwbGFuZS0+aWQ7CiAJCQljb25zdCBzdHJ1Y3Qgc2tsX3Bs
YW5lX3dtICpvbGRfd20sICpuZXdfd207CisJCQljb25zdCBzdHJ1Y3Qgc2tsX3dtX2xldmVsICpv
bGRfd21fbGV2ZWwsICpuZXdfd21fbGV2ZWw7CisJCQl1MTYgb2xkX3BsYW5lX3Jlc19sLCBuZXdf
cGxhbmVfcmVzX2w7CisJCQl1OCAgb2xkX3BsYW5lX3Jlc19iLCBuZXdfcGxhbmVfcmVzX2I7CisJ
CQl1MTYgb2xkX21pbl9kZGJfYWxsb2MsIG5ld19taW5fZGRiX2FsbG9jOworCQkJaW50IGNvbG9y
X3BsYW5lID0gMDsKIAogCQkJb2xkX3dtID0gJm9sZF9waXBlX3dtLT5wbGFuZXNbcGxhbmVfaWRd
OwogCQkJbmV3X3dtID0gJm5ld19waXBlX3dtLT5wbGFuZXNbcGxhbmVfaWRdOworCQkJb2xkX3dt
X2xldmVsID0gc2tsX3BsYW5lX3dtX2xldmVsKG9sZF9jcnRjX3N0YXRlLCBwbGFuZV9pZCwgMCwg
Y29sb3JfcGxhbmUpOworCQkJbmV3X3dtX2xldmVsID0gc2tsX3BsYW5lX3dtX2xldmVsKG5ld19j
cnRjX3N0YXRlLCBwbGFuZV9pZCwgMCwgY29sb3JfcGxhbmUpOworCisJCQlvbGRfcGxhbmVfcmVz
X2wgPSBvbGRfd21fbGV2ZWwtPnBsYW5lX3Jlc19sOworCQkJb2xkX3BsYW5lX3Jlc19iID0gb2xk
X3dtX2xldmVsLT5wbGFuZV9yZXNfYjsKKworCQkJbmV3X3BsYW5lX3Jlc19sID0gbmV3X3dtX2xl
dmVsLT5wbGFuZV9yZXNfbDsKKwkJCW5ld19wbGFuZV9yZXNfYiA9IG5ld193bV9sZXZlbC0+cGxh
bmVfcmVzX2I7CisKKwkJCW9sZF9taW5fZGRiX2FsbG9jID0gb2xkX3dtX2xldmVsLT5taW5fZGRi
X2FsbG9jOworCQkJbmV3X21pbl9kZGJfYWxsb2MgPSBuZXdfd21fbGV2ZWwtPm1pbl9kZGJfYWxs
b2M7CiAKIAkJCWlmIChza2xfcGxhbmVfd21fZXF1YWxzKGRldl9wcml2LCBvbGRfd20sIG5ld193
bSkpCiAJCQkJY29udGludWU7CkBAIC01NjI0LDcgKzU4NjcsNyBAQCBza2xfcHJpbnRfd21fY2hh
bmdlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJCQkgICAgIltQTEFORTol
ZDolc10gICBsaW5lcyAlYyUzZCwlYyUzZCwlYyUzZCwlYyUzZCwlYyUzZCwlYyUzZCwlYyUzZCwl
YyUzZCwlYyUzZCIKIAkJCQkgICAgICAiIC0+ICVjJTNkLCVjJTNkLCVjJTNkLCVjJTNkLCVjJTNk
LCVjJTNkLCVjJTNkLCVjJTNkLCVjJTNkXG4iLAogCQkJCSAgICBwbGFuZS0+YmFzZS5iYXNlLmlk
LCBwbGFuZS0+YmFzZS5uYW1lLAotCQkJCSAgICBlbmFzdChvbGRfd20tPndtWzBdLmlnbm9yZV9s
aW5lcyksIG9sZF93bS0+d21bMF0ucGxhbmVfcmVzX2wsCisJCQkJICAgIGVuYXN0KG9sZF93bS0+
d21bMF0uaWdub3JlX2xpbmVzKSwgb2xkX3BsYW5lX3Jlc19sLAogCQkJCSAgICBlbmFzdChvbGRf
d20tPndtWzFdLmlnbm9yZV9saW5lcyksIG9sZF93bS0+d21bMV0ucGxhbmVfcmVzX2wsCiAJCQkJ
ICAgIGVuYXN0KG9sZF93bS0+d21bMl0uaWdub3JlX2xpbmVzKSwgb2xkX3dtLT53bVsyXS5wbGFu
ZV9yZXNfbCwKIAkJCQkgICAgZW5hc3Qob2xkX3dtLT53bVszXS5pZ25vcmVfbGluZXMpLCBvbGRf
d20tPndtWzNdLnBsYW5lX3Jlc19sLApAQCAtNTYzNCw3ICs1ODc3LDcgQEAgc2tsX3ByaW50X3dt
X2NoYW5nZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCQkJICAgIGVuYXN0
KG9sZF93bS0+d21bN10uaWdub3JlX2xpbmVzKSwgb2xkX3dtLT53bVs3XS5wbGFuZV9yZXNfbCwK
IAkJCQkgICAgZW5hc3Qob2xkX3dtLT50cmFuc193bS5pZ25vcmVfbGluZXMpLCBvbGRfd20tPnRy
YW5zX3dtLnBsYW5lX3Jlc19sLAogCi0JCQkJICAgIGVuYXN0KG5ld193bS0+d21bMF0uaWdub3Jl
X2xpbmVzKSwgbmV3X3dtLT53bVswXS5wbGFuZV9yZXNfbCwKKwkJCQkgICAgZW5hc3QobmV3X3dt
LT53bVswXS5pZ25vcmVfbGluZXMpLCBuZXdfcGxhbmVfcmVzX2wsCiAJCQkJICAgIGVuYXN0KG5l
d193bS0+d21bMV0uaWdub3JlX2xpbmVzKSwgbmV3X3dtLT53bVsxXS5wbGFuZV9yZXNfbCwKIAkJ
CQkgICAgZW5hc3QobmV3X3dtLT53bVsyXS5pZ25vcmVfbGluZXMpLCBuZXdfd20tPndtWzJdLnBs
YW5lX3Jlc19sLAogCQkJCSAgICBlbmFzdChuZXdfd20tPndtWzNdLmlnbm9yZV9saW5lcyksIG5l
d193bS0+d21bM10ucGxhbmVfcmVzX2wsCkBAIC01NjQ4LDEyICs1ODkxLDEyIEBAIHNrbF9wcmlu
dF93bV9jaGFuZ2VzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCQkJCSAgICAi
W1BMQU5FOiVkOiVzXSAgYmxvY2tzICU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRk
IgogCQkJCSAgICAiIC0+ICU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkXG4iLAog
CQkJCSAgICBwbGFuZS0+YmFzZS5iYXNlLmlkLCBwbGFuZS0+YmFzZS5uYW1lLAotCQkJCSAgICBv
bGRfd20tPndtWzBdLnBsYW5lX3Jlc19iLCBvbGRfd20tPndtWzFdLnBsYW5lX3Jlc19iLAorCQkJ
CSAgICBvbGRfcGxhbmVfcmVzX2IsIG9sZF93bS0+d21bMV0ucGxhbmVfcmVzX2IsCiAJCQkJICAg
IG9sZF93bS0+d21bMl0ucGxhbmVfcmVzX2IsIG9sZF93bS0+d21bM10ucGxhbmVfcmVzX2IsCiAJ
CQkJICAgIG9sZF93bS0+d21bNF0ucGxhbmVfcmVzX2IsIG9sZF93bS0+d21bNV0ucGxhbmVfcmVz
X2IsCiAJCQkJICAgIG9sZF93bS0+d21bNl0ucGxhbmVfcmVzX2IsIG9sZF93bS0+d21bN10ucGxh
bmVfcmVzX2IsCiAJCQkJICAgIG9sZF93bS0+dHJhbnNfd20ucGxhbmVfcmVzX2IsCi0JCQkJICAg
IG5ld193bS0+d21bMF0ucGxhbmVfcmVzX2IsIG5ld193bS0+d21bMV0ucGxhbmVfcmVzX2IsCisJ
CQkJICAgIG5ld19wbGFuZV9yZXNfYiwgbmV3X3dtLT53bVsxXS5wbGFuZV9yZXNfYiwKIAkJCQkg
ICAgbmV3X3dtLT53bVsyXS5wbGFuZV9yZXNfYiwgbmV3X3dtLT53bVszXS5wbGFuZV9yZXNfYiwK
IAkJCQkgICAgbmV3X3dtLT53bVs0XS5wbGFuZV9yZXNfYiwgbmV3X3dtLT53bVs1XS5wbGFuZV9y
ZXNfYiwKIAkJCQkgICAgbmV3X3dtLT53bVs2XS5wbGFuZV9yZXNfYiwgbmV3X3dtLT53bVs3XS5w
bGFuZV9yZXNfYiwKQEAgLTU2NjMsMTIgKzU5MDYsMTIgQEAgc2tsX3ByaW50X3dtX2NoYW5nZXMo
c3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCQkJICAgICJbUExBTkU6JWQ6JXNd
IG1pbl9kZGIgJTRkLCU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkLCU0ZCwlNGQiCiAJCQkJICAgICIg
LT4gJTRkLCU0ZCwlNGQsJTRkLCU0ZCwlNGQsJTRkLCU0ZCwlNGRcbiIsCiAJCQkJICAgIHBsYW5l
LT5iYXNlLmJhc2UuaWQsIHBsYW5lLT5iYXNlLm5hbWUsCi0JCQkJICAgIG9sZF93bS0+d21bMF0u
bWluX2RkYl9hbGxvYywgb2xkX3dtLT53bVsxXS5taW5fZGRiX2FsbG9jLAorCQkJCSAgICBvbGRf
bWluX2RkYl9hbGxvYywgb2xkX3dtLT53bVsxXS5taW5fZGRiX2FsbG9jLAogCQkJCSAgICBvbGRf
d20tPndtWzJdLm1pbl9kZGJfYWxsb2MsIG9sZF93bS0+d21bM10ubWluX2RkYl9hbGxvYywKIAkJ
CQkgICAgb2xkX3dtLT53bVs0XS5taW5fZGRiX2FsbG9jLCBvbGRfd20tPndtWzVdLm1pbl9kZGJf
YWxsb2MsCiAJCQkJICAgIG9sZF93bS0+d21bNl0ubWluX2RkYl9hbGxvYywgb2xkX3dtLT53bVs3
XS5taW5fZGRiX2FsbG9jLAogCQkJCSAgICBvbGRfd20tPnRyYW5zX3dtLm1pbl9kZGJfYWxsb2Ms
Ci0JCQkJICAgIG5ld193bS0+d21bMF0ubWluX2RkYl9hbGxvYywgbmV3X3dtLT53bVsxXS5taW5f
ZGRiX2FsbG9jLAorCQkJCSAgICBuZXdfbWluX2RkYl9hbGxvYywgbmV3X3dtLT53bVsxXS5taW5f
ZGRiX2FsbG9jLAogCQkJCSAgICBuZXdfd20tPndtWzJdLm1pbl9kZGJfYWxsb2MsIG5ld193bS0+
d21bM10ubWluX2RkYl9hbGxvYywKIAkJCQkgICAgbmV3X3dtLT53bVs0XS5taW5fZGRiX2FsbG9j
LCBuZXdfd20tPndtWzVdLm1pbl9kZGJfYWxsb2MsCiAJCQkJICAgIG5ld193bS0+d21bNl0ubWlu
X2RkYl9hbGxvYywgbmV3X3dtLT53bVs3XS5taW5fZGRiX2FsbG9jLApAQCAtNTgyOSw2ICs2MDcy
LDEwIEBAIHNrbF9jb21wdXRlX3dtKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQog
CQkJcmV0dXJuIHJldDsKIAl9CiAKKwlyZXQgPSBpbnRlbF9jb21wdXRlX3NhZ3ZfbWFzayhzdGF0
ZSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKwogCXJldCA9IHNrbF9jb21wdXRlX2RkYihz
dGF0ZSk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKQEAgLTU5NjAsNiArNjIwNyw5IEBAIHZv
aWQgc2tsX3BpcGVfd21fZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJ
CXZhbCA9IEk5MTVfUkVBRChDVVJfV00ocGlwZSwgbGV2ZWwpKTsKIAogCQkJc2tsX3dtX2xldmVs
X2Zyb21fcmVnX3ZhbCh2YWwsICZ3bS0+d21bbGV2ZWxdKTsKKwkJCWlmIChsZXZlbCA9PSAwKQor
CQkJCW1lbWNweSgmd20tPnNhZ3Zfd20wLCAmd20tPndtW2xldmVsXSwKKwkJCQkgICAgICAgc2l6
ZW9mKHN0cnVjdCBza2xfd21fbGV2ZWwpKTsKIAkJfQogCiAJCWlmIChwbGFuZV9pZCAhPSBQTEFO
RV9DVVJTT1IpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5oIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uaAppbmRleCBkNjBhODU0MjFjNWEuLjY1NzQz
YTRjYmNmNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uaAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5oCkBAIC00Miw2ICs0Miw3IEBAIHZvaWQg
c2tsX3BpcGVfd21fZ2V0X2h3X3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogdm9pZCBn
NHhfd21fc2FuaXRpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIHZvaWQg
dmx2X3dtX3Nhbml0aXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiBib29s
IGludGVsX2Nhbl9lbmFibGVfc2FndihzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSk7
Citib29sIGludGVsX2hhc19zYWd2KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7
CiBpbnQgaW50ZWxfZW5hYmxlX3NhZ3Yoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KTsKIGludCBpbnRlbF9kaXNhYmxlX3NhZ3Yoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KTsKIGJvb2wgc2tsX3dtX2xldmVsX2VxdWFscyhjb25zdCBzdHJ1Y3Qgc2tsX3dtX2xldmVs
ICpsMSwKLS0gCjIuMjQuMS40ODUuZ2FkMDVhM2Q4ZTUKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

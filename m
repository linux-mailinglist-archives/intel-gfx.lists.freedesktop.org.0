Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D21F049AE5
	for <lists+intel-gfx@lfdr.de>; Tue, 18 Jun 2019 09:43:05 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id F15826E10B;
	Tue, 18 Jun 2019 07:43:03 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3BDB66E10D
 for <intel-gfx@lists.freedesktop.org>; Tue, 18 Jun 2019 07:43:02 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16935666-1500050 
 for multiple; Tue, 18 Jun 2019 08:42:39 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 18 Jun 2019 08:41:52 +0100
Message-Id: <20190618074153.16055-25-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190618074153.16055-1-chris@chris-wilson.co.uk>
References: <20190618074153.16055-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 25/26] drm/i915: Replace struct_mutex for batch
 pool serialisation
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U3dpdGNoIHRvIHRyYWNraW5nIGFjdGl2aXR5IHZpYSBpOTE1X2FjdGl2ZSBvbiBpbmRpdmlkdWFs
IG5vZGVzLCBvbmx5CmtlZXBpbmcgYSBsaXN0IG9mIHJldGlyZWQgb2JqZWN0cyBpbiB0aGUgY2Fj
aGUsIGFuZCByZWFwaW5nIHRoZSBjYWNoZQp3aGVuIHRoZSBlbmdpbmUgaXRzZWxmIGlkbGVzLgoK
U2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0t
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgICAgICAgICAgICAgICAgIHwgICAyICst
CiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMgICAgfCAgNTggKysr
Ky0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jICAgIHwgICAx
IC0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oICB8ICAgMSAt
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYyAgICAgICAgfCAgIDQgKy0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZS5oICAgICAgICB8ICAgMSAtCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYyAgICAgfCAgMTEgKy0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jICAgICB8ICAgMiArCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG9vbC5jICAgfCAxNjMgKysrKysrKysr
KysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG9vbC5oICAg
fCAgMzMgKysrKwogLi4uL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG9vbF90eXBlcy5o
IHwgIDI5ICsrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5o
ICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvbW9ja19lbmdpbmUuYyAgICAgICAg
IHwgICAzICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jICAgICAgICAgICB8
ICA2OCAtLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fYmF0Y2hfcG9vbC5j
ICAgIHwgMTMyIC0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9i
YXRjaF9wb29sLmggICAgfCAgMjYgLS0tCiAxNiBmaWxlcyBjaGFuZ2VkLCAyNzQgaW5zZXJ0aW9u
cygrKSwgMjY0IGRlbGV0aW9ucygtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sLmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG9vbC5oCiBjcmVhdGUgbW9kZSAxMDA2NDQg
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3Bvb2xfdHlwZXMuaAogZGVsZXRl
IG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2JhdGNoX3Bvb2wuYwog
ZGVsZXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2JhdGNoX3Bv
b2wuaAoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKaW5kZXggOTEzNTVjMmVhOGE1Li42ODkzNmQ1ZDgwOTYg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L01ha2VmaWxlCkBAIC03Miw2ICs3Miw3IEBAIG9iai15ICs9IGd0LwogZ3Qt
eSArPSBcCiAJZ3QvaW50ZWxfYnJlYWRjcnVtYnMubyBcCiAJZ3QvaW50ZWxfY29udGV4dC5vIFwK
KwlndC9pbnRlbF9lbmdpbmVfcG9vbC5vIFwKIAlndC9pbnRlbF9lbmdpbmVfY3MubyBcCiAJZ3Qv
aW50ZWxfZW5naW5lX3BtLm8gXAogCWd0L2ludGVsX2d0X3BtLm8gXApAQCAtMTE2LDcgKzExNyw2
IEBAIGk5MTUteSArPSBcCiAJICAkKGdlbS15KSBcCiAJICBpOTE1X2FjdGl2ZS5vIFwKIAkgIGk5
MTVfY21kX3BhcnNlci5vIFwKLQkgIGk5MTVfZ2VtX2JhdGNoX3Bvb2wubyBcCiAJICBpOTE1X2dl
bV9ldmljdC5vIFwKIAkgIGk5MTVfZ2VtX2ZlbmNlX3JlZy5vIFwKIAkgIGk5MTVfZ2VtX2d0dC5v
IFwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVm
ZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCmlu
ZGV4IDhmYjg2MTNhMTU1NS4uNzBlNDQzNmRjMmE4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKQEAgLTE2LDYgKzE2LDcgQEAKIAogI2luY2x1
ZGUgImdlbS9pOTE1X2dlbV9pb2N0bHMuaCIKICNpbmNsdWRlICJndC9pbnRlbF9jb250ZXh0Lmgi
CisjaW5jbHVkZSAiZ3QvaW50ZWxfZW5naW5lX3Bvb2wuaCIKICNpbmNsdWRlICJndC9pbnRlbF9n
dF9wbS5oIgogCiAjaW5jbHVkZSAiaTkxNV9nZW1faW9jdGxzLmgiCkBAIC0xMjAxLDI1ICsxMjAy
LDI2IEBAIHN0YXRpYyBpbnQgX19yZWxvY19ncHVfYWxsb2Moc3RydWN0IGk5MTVfZXhlY2J1ZmZl
ciAqZWIsCiAJCQkgICAgIHVuc2lnbmVkIGludCBsZW4pCiB7CiAJc3RydWN0IHJlbG9jX2NhY2hl
ICpjYWNoZSA9ICZlYi0+cmVsb2NfY2FjaGU7Ci0Jc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iajsKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX3Bvb2xfbm9kZSAqcG9vbDsKIAlzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpycTsKIAlzdHJ1Y3QgaTkxNV92bWEgKmJhdGNoOwogCXUzMiAqY21kOwogCWlu
dCBlcnI7CiAKLQlvYmogPSBpOTE1X2dlbV9iYXRjaF9wb29sX2dldCgmZWItPmVuZ2luZS0+YmF0
Y2hfcG9vbCwgUEFHRV9TSVpFKTsKLQlpZiAoSVNfRVJSKG9iaikpCi0JCXJldHVybiBQVFJfRVJS
KG9iaik7CisJcG9vbCA9IGludGVsX2VuZ2luZV9wb29sX2dldCgmZWItPmVuZ2luZS0+cG9vbCwg
UEFHRV9TSVpFKTsKKwlpZiAoSVNfRVJSKHBvb2wpKQorCQlyZXR1cm4gUFRSX0VSUihwb29sKTsK
IAotCWNtZCA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKG9iaiwKKwljbWQgPSBpOTE1X2dlbV9v
YmplY3RfcGluX21hcChwb29sLT5vYmosCiAJCQkJICAgICAgY2FjaGUtPmhhc19sbGMgPwogCQkJ
CSAgICAgIEk5MTVfTUFQX0ZPUkNFX1dCIDoKIAkJCQkgICAgICBJOTE1X01BUF9GT1JDRV9XQyk7
Ci0JaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKG9iaik7Ci0JaWYgKElTX0VSUihjbWQpKQot
CQlyZXR1cm4gUFRSX0VSUihjbWQpOworCWlmIChJU19FUlIoY21kKSkgeworCQllcnIgPSBQVFJf
RVJSKGNtZCk7CisJCWdvdG8gb3V0X3Bvb2w7CisJfQogCi0JYmF0Y2ggPSBpOTE1X3ZtYV9pbnN0
YW5jZShvYmosIHZtYS0+dm0sIE5VTEwpOworCWJhdGNoID0gaTkxNV92bWFfaW5zdGFuY2UocG9v
bC0+b2JqLCB2bWEtPnZtLCBOVUxMKTsKIAlpZiAoSVNfRVJSKGJhdGNoKSkgewogCQllcnIgPSBQ
VFJfRVJSKGJhdGNoKTsKIAkJZ290byBlcnJfdW5tYXA7CkBAIC0xMjM1LDYgKzEyMzcsMTAgQEAg
c3RhdGljIGludCBfX3JlbG9jX2dwdV9hbGxvYyhzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYiwK
IAkJZ290byBlcnJfdW5waW47CiAJfQogCisJZXJyID0gaW50ZWxfZW5naW5lX3Bvb2xfbWFya19h
Y3RpdmUocG9vbCwgcnEpOworCWlmIChlcnIpCisJCWdvdG8gZXJyX3JlcXVlc3Q7CisKIAllcnIg
PSByZWxvY19tb3ZlX3RvX2dwdShycSwgdm1hKTsKIAlpZiAoZXJyKQogCQlnb3RvIGVycl9yZXF1
ZXN0OwpAQCAtMTI2MCw3ICsxMjY2LDcgQEAgc3RhdGljIGludCBfX3JlbG9jX2dwdV9hbGxvYyhz
dHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYiwKIAljYWNoZS0+cnFfc2l6ZSA9IDA7CiAKIAkvKiBS
ZXR1cm4gd2l0aCBiYXRjaCBtYXBwaW5nIChjbWQpIHN0aWxsIHBpbm5lZCAqLwotCXJldHVybiAw
OworCWdvdG8gb3V0X3Bvb2w7CiAKIHNraXBfcmVxdWVzdDoKIAlpOTE1X3JlcXVlc3Rfc2tpcChy
cSwgZXJyKTsKQEAgLTEyNjksNyArMTI3NSw5IEBAIHN0YXRpYyBpbnQgX19yZWxvY19ncHVfYWxs
b2Moc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsCiBlcnJfdW5waW46CiAJaTkxNV92bWFfdW5w
aW4oYmF0Y2gpOwogZXJyX3VubWFwOgotCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAob2JqKTsK
KwlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKHBvb2wtPm9iaik7CitvdXRfcG9vbDoKKwlpbnRl
bF9lbmdpbmVfcG9vbF9wdXQocG9vbCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMjAxMywxOCAr
MjAyMSwxNyBAQCBzdGF0aWMgaW50IGk5MTVfcmVzZXRfZ2VuN19zb2xfb2Zmc2V0cyhzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycSkKIAogc3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqZWJfcGFyc2Uoc3Ry
dWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsIGJvb2wgaXNfbWFzdGVyKQogewotCXN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpzaGFkb3dfYmF0Y2hfb2JqOworCXN0cnVjdCBpbnRlbF9lbmdpbmVf
cG9vbF9ub2RlICpwb29sOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCWludCBlcnI7CiAKLQlz
aGFkb3dfYmF0Y2hfb2JqID0gaTkxNV9nZW1fYmF0Y2hfcG9vbF9nZXQoJmViLT5lbmdpbmUtPmJh
dGNoX3Bvb2wsCi0JCQkJCQkgICBQQUdFX0FMSUdOKGViLT5iYXRjaF9sZW4pKTsKLQlpZiAoSVNf
RVJSKHNoYWRvd19iYXRjaF9vYmopKQotCQlyZXR1cm4gRVJSX0NBU1Qoc2hhZG93X2JhdGNoX29i
aik7CisJcG9vbCA9IGludGVsX2VuZ2luZV9wb29sX2dldCgmZWItPmVuZ2luZS0+cG9vbCwgZWIt
PmJhdGNoX2xlbik7CisJaWYgKElTX0VSUihwb29sKSkKKwkJcmV0dXJuIEVSUl9DQVNUKHBvb2wp
OwogCiAJZXJyID0gaW50ZWxfZW5naW5lX2NtZF9wYXJzZXIoZWItPmVuZ2luZSwKIAkJCQkgICAg
ICBlYi0+YmF0Y2gtPm9iaiwKLQkJCQkgICAgICBzaGFkb3dfYmF0Y2hfb2JqLAorCQkJCSAgICAg
IHBvb2wtPm9iaiwKIAkJCQkgICAgICBlYi0+YmF0Y2hfc3RhcnRfb2Zmc2V0LAogCQkJCSAgICAg
IGViLT5iYXRjaF9sZW4sCiAJCQkJICAgICAgaXNfbWFzdGVyKTsKQEAgLTIwMzMsMTIgKzIwNDAs
MTIgQEAgc3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqZWJfcGFyc2Uoc3RydWN0IGk5MTVfZXhlY2J1
ZmZlciAqZWIsIGJvb2wgaXNfbWFzdGVyKQogCQkJdm1hID0gTlVMTDsKIAkJZWxzZQogCQkJdm1h
ID0gRVJSX1BUUihlcnIpOwotCQlnb3RvIG91dDsKKwkJZ290byBlcnI7CiAJfQogCi0Jdm1hID0g
aTkxNV9nZW1fb2JqZWN0X2dndHRfcGluKHNoYWRvd19iYXRjaF9vYmosIE5VTEwsIDAsIDAsIDAp
OworCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3Bpbihwb29sLT5vYmosIE5VTEwsIDAsIDAs
IDApOwogCWlmIChJU19FUlIodm1hKSkKLQkJZ290byBvdXQ7CisJCWdvdG8gZXJyOwogCiAJZWIt
PnZtYVtlYi0+YnVmZmVyX2NvdW50XSA9IGk5MTVfdm1hX2dldCh2bWEpOwogCWViLT5mbGFnc1tl
Yi0+YnVmZmVyX2NvdW50XSA9CkBAIC0yMDQ2LDggKzIwNTMsMTEgQEAgc3RhdGljIHN0cnVjdCBp
OTE1X3ZtYSAqZWJfcGFyc2Uoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsIGJvb2wgaXNfbWFz
dGVyKQogCXZtYS0+ZXhlY19mbGFncyA9ICZlYi0+ZmxhZ3NbZWItPmJ1ZmZlcl9jb3VudF07CiAJ
ZWItPmJ1ZmZlcl9jb3VudCsrOwogCi1vdXQ6Ci0JaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2Vz
KHNoYWRvd19iYXRjaF9vYmopOworCXZtYS0+cHJpdmF0ZSA9IHBvb2w7CisJcmV0dXJuIHZtYTsK
KworZXJyOgorCWludGVsX2VuZ2luZV9wb29sX3B1dChwb29sKTsKIAlyZXR1cm4gdm1hOwogfQog
CkBAIC0yNTg3LDYgKzI1OTcsOCBAQCBpOTE1X2dlbV9kb19leGVjYnVmZmVyKHN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYsCiAJICogdG8gZXhwbGljaXRseSBob2xkIGFub3RoZXIgcmVmZXJlbmNlIGhl
cmUuCiAJICovCiAJZWIucmVxdWVzdC0+YmF0Y2ggPSBlYi5iYXRjaDsKKwlpZiAoZWIuYmF0Y2gt
PnByaXZhdGUpCisJCWludGVsX2VuZ2luZV9wb29sX21hcmtfYWN0aXZlKGViLmJhdGNoLT5wcml2
YXRlLCBlYi5yZXF1ZXN0KTsKIAogCXRyYWNlX2k5MTVfcmVxdWVzdF9xdWV1ZShlYi5yZXF1ZXN0
LCBlYi5iYXRjaF9mbGFncyk7CiAJZXJyID0gZWJfc3VibWl0KCZlYik7CkBAIC0yNjExLDYgKzI2
MjMsOCBAQCBpOTE1X2dlbV9kb19leGVjYnVmZmVyKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiBl
cnJfYmF0Y2hfdW5waW46CiAJaWYgKGViLmJhdGNoX2ZsYWdzICYgSTkxNV9ESVNQQVRDSF9TRUNV
UkUpCiAJCWk5MTVfdm1hX3VucGluKGViLmJhdGNoKTsKKwlpZiAoZWIuYmF0Y2gtPnByaXZhdGUp
CisJCWludGVsX2VuZ2luZV9wb29sX3B1dChlYi5iYXRjaC0+cHJpdmF0ZSk7CiBlcnJfdm1hOgog
CWlmIChlYi5leGVjKQogCQllYl9yZWxlYXNlX3ZtYXMoJmViKTsKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYwppbmRleCA4YjI3ZjE5M2Q1ZjkuLmNkN2M0MzM2ZGEy
NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYwpAQCAtNTQs
NyArNTQsNiBAQCB2b2lkIGk5MTVfZ2VtX29iamVjdF9pbml0KHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmosCiAJSU5JVF9MSVNUX0hFQUQoJm9iai0+dm1hLmxpc3QpOwogCiAJSU5JVF9M
SVNUX0hFQUQoJm9iai0+bHV0X2xpc3QpOwotCUlOSVRfTElTVF9IRUFEKCZvYmotPmJhdGNoX3Bv
b2xfbGluayk7CiAKIAlpbml0X3JjdV9oZWFkKCZvYmotPnJjdSk7CiAKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaCBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaAppbmRleCBlODdmY2E0ZDgx
OTQuLmUzYjNmYTA3NDQwNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX29iamVjdF90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9vYmplY3RfdHlwZXMuaApAQCAtMTE5LDcgKzExOSw2IEBAIHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0IHsKIAl1bnNpZ25lZCBpbnQgdXNlcmZhdWx0X2NvdW50OwogCXN0cnVjdCBsaXN0
X2hlYWQgdXNlcmZhdWx0X2xpbms7CiAKLQlzdHJ1Y3QgbGlzdF9oZWFkIGJhdGNoX3Bvb2xfbGlu
azsKIAlJOTE1X1NFTEZURVNUX0RFQ0xBUkUoc3RydWN0IGxpc3RfaGVhZCBzdF9saW5rKTsKIAog
CS8qCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCmluZGV4IDg1NzBlMmE2NDcz
Ny4uMWY1M2ZlYWMyYjIyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYwpA
QCAtMzAsMTAgKzMwLDggQEAgc3RhdGljIHZvaWQgaTkxNV9nZW1fcGFyayhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIAogCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKKwlmb3Jf
ZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkKIAkJY2FsbF9pZGxlX2JhcnJpZXJzKGVuZ2lu
ZSk7IC8qIGNsZWFudXAgYWZ0ZXIgd2VkZ2luZyAqLwotCQlpOTE1X2dlbV9iYXRjaF9wb29sX2Zp
bmkoJmVuZ2luZS0+YmF0Y2hfcG9vbCk7Ci0JfQogCiAJaTkxNV90aW1lbGluZXNfcGFyayhpOTE1
KTsKIAlpOTE1X3ZtYV9wYXJrZWQoaTkxNSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9lbmdpbmUuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Vu
Z2luZS5oCmluZGV4IDVjM2IxNTgzNWFmNi4uY2NhMDg5NTIwODE4IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmUuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9lbmdpbmUuaApAQCAtOSw3ICs5LDYgQEAKICNpbmNsdWRlIDxsaW51eC9y
YW5kb20uaD4KICNpbmNsdWRlIDxsaW51eC9zZXFsb2NrLmg+CiAKLSNpbmNsdWRlICJpOTE1X2dl
bV9iYXRjaF9wb29sLmgiCiAjaW5jbHVkZSAiaTkxNV9wbXUuaCIKICNpbmNsdWRlICJpOTE1X3Jl
Zy5oIgogI2luY2x1ZGUgImk5MTVfcmVxdWVzdC5oIgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9lbmdpbmVfY3MuYwppbmRleCA2NTQyNGVlZDhmOTkuLmY3OGYxMDk2ZmUyYiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKQEAgLTMwLDYgKzMwLDcgQEAK
IAogI2luY2x1ZGUgImludGVsX2VuZ2luZS5oIgogI2luY2x1ZGUgImludGVsX2VuZ2luZV9wbS5o
IgorI2luY2x1ZGUgImludGVsX2VuZ2luZV9wb29sLmgiCiAjaW5jbHVkZSAiaW50ZWxfY29udGV4
dC5oIgogI2luY2x1ZGUgImludGVsX2xyYy5oIgogI2luY2x1ZGUgImludGVsX3Jlc2V0LmgiCkBA
IC00OTUsMTEgKzQ5Niw2IEBAIGludCBpbnRlbF9lbmdpbmVzX2luaXQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiAJcmV0dXJuIGVycjsKIH0KIAotc3RhdGljIHZvaWQgaW50ZWxfZW5n
aW5lX2luaXRfYmF0Y2hfcG9vbChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCi17Ci0J
aTkxNV9nZW1fYmF0Y2hfcG9vbF9pbml0KCZlbmdpbmUtPmJhdGNoX3Bvb2wsIGVuZ2luZSk7Ci19
Ci0KIHZvaWQgaW50ZWxfZW5naW5lX2luaXRfZXhlY2xpc3RzKHN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmVuZ2luZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2V4ZWNsaXN0cyAqIGNvbnN0IGV4
ZWNsaXN0cyA9ICZlbmdpbmUtPmV4ZWNsaXN0czsKQEAgLTYyNSwxMCArNjIxLDExIEBAIHN0YXRp
YyBpbnQgaW50ZWxfZW5naW5lX3NldHVwX2NvbW1vbihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpl
bmdpbmUpCiAJaW50ZWxfZW5naW5lX2luaXRfYnJlYWRjcnVtYnMoZW5naW5lKTsKIAlpbnRlbF9l
bmdpbmVfaW5pdF9leGVjbGlzdHMoZW5naW5lKTsKIAlpbnRlbF9lbmdpbmVfaW5pdF9oYW5nY2hl
Y2soZW5naW5lKTsKLQlpbnRlbF9lbmdpbmVfaW5pdF9iYXRjaF9wb29sKGVuZ2luZSk7CiAJaW50
ZWxfZW5naW5lX2luaXRfY21kX3BhcnNlcihlbmdpbmUpOwogCWludGVsX2VuZ2luZV9pbml0X19w
bShlbmdpbmUpOwogCisJaW50ZWxfZW5naW5lX3Bvb2xfaW5pdCgmZW5naW5lLT5wb29sKTsKKwog
CS8qIFVzZSB0aGUgd2hvbGUgZGV2aWNlIGJ5IGRlZmF1bHQgKi8KIAllbmdpbmUtPnNzZXUgPQog
CQlpbnRlbF9zc2V1X2Zyb21fZGV2aWNlX2luZm8oJlJVTlRJTUVfSU5GTyhlbmdpbmUtPmk5MTUp
LT5zc2V1KTsKQEAgLTg3OCw5ICs4NzUsOSBAQCB2b2lkIGludGVsX2VuZ2luZV9jbGVhbnVwX2Nv
bW1vbihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAKIAljbGVhbnVwX3N0YXR1c19w
YWdlKGVuZ2luZSk7CiAKKwlpbnRlbF9lbmdpbmVfcG9vbF9maW5pKCZlbmdpbmUtPnBvb2wpOwog
CWludGVsX2VuZ2luZV9maW5pX2JyZWFkY3J1bWJzKGVuZ2luZSk7CiAJaW50ZWxfZW5naW5lX2Ns
ZWFudXBfY21kX3BhcnNlcihlbmdpbmUpOwotCWk5MTVfZ2VtX2JhdGNoX3Bvb2xfZmluaSgmZW5n
aW5lLT5iYXRjaF9wb29sKTsKIAogCWlmIChlbmdpbmUtPmRlZmF1bHRfc3RhdGUpCiAJCWk5MTVf
Z2VtX29iamVjdF9wdXQoZW5naW5lLT5kZWZhdWx0X3N0YXRlKTsKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMKaW5kZXggMmNlMDBkM2RjNDJhLi5kNWQzYWFjNWMyNjgg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jCkBAIC03LDYgKzcs
NyBAQAogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAKICNpbmNsdWRlICJpbnRlbF9lbmdpbmUuaCIK
KyNpbmNsdWRlICJpbnRlbF9lbmdpbmVfcG9vbC5oIgogI2luY2x1ZGUgImludGVsX2VuZ2luZV9w
bS5oIgogI2luY2x1ZGUgImludGVsX2d0X3BtLmgiCiAKQEAgLTExNSw2ICsxMTYsNyBAQCBzdGF0
aWMgaW50IF9fZW5naW5lX3Bhcmsoc3RydWN0IGludGVsX3dha2VyZWYgKndmKQogCUdFTV9UUkFD
RSgiJXNcbiIsIGVuZ2luZS0+bmFtZSk7CiAKIAlpbnRlbF9lbmdpbmVfZGlzYXJtX2JyZWFkY3J1
bWJzKGVuZ2luZSk7CisJaW50ZWxfZW5naW5lX3Bvb2xfcGFyaygmZW5naW5lLT5wb29sKTsKIAog
CS8qIE11c3QgYmUgcmVzZXQgdXBvbiBpZGxpbmcsIG9yIHdlIG1heSBtaXNzIHRoZSBidXN5IHdh
a2V1cC4gKi8KIAlHRU1fQlVHX09OKGVuZ2luZS0+ZXhlY2xpc3RzLnF1ZXVlX3ByaW9yaXR5X2hp
bnQgIT0gSU5UX01JTik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9lbmdpbmVfcG9vbC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3Bv
b2wuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjBiNzI1Y2VkZmVj
ZAotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2lu
ZV9wb29sLmMKQEAgLTAsMCArMSwxNjMgQEAKKy8qCisgKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmll
cjogTUlUCisgKgorICogQ29weXJpZ2h0IMKpIDIwMTQtMjAxOCBJbnRlbCBDb3Jwb3JhdGlvbgor
ICovCisKKyNpbmNsdWRlICJnZW0vaTkxNV9nZW1fb2JqZWN0LmgiCisKKyNpbmNsdWRlICJpOTE1
X2Rydi5oIgorI2luY2x1ZGUgImludGVsX2VuZ2luZV9wb29sLmgiCisKK3N0YXRpYyBzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICp0b19lbmdpbmUoc3RydWN0IGludGVsX2VuZ2luZV9wb29sICpwb29s
KQoreworCXJldHVybiBjb250YWluZXJfb2YocG9vbCwgc3RydWN0IGludGVsX2VuZ2luZV9jcywg
cG9vbCk7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgbGlzdF9oZWFkICoKK2J1Y2tldF9mb3Jfc2l6ZShz
dHJ1Y3QgaW50ZWxfZW5naW5lX3Bvb2wgKnBvb2wsIHNpemVfdCBzeikKK3sKKwlpbnQgbjsKKwor
CS8qCisJICogQ29tcHV0ZSBhIHBvd2VyLW9mLXR3byBidWNrZXQsIGJ1dCB0aHJvdyBldmVyeXRo
aW5nIGdyZWF0ZXIgdGhhbgorCSAqIDE2S2lCIGludG8gdGhlIHNhbWUgYnVja2V0OiBpLmUuIHRo
ZSB0aGUgYnVja2V0cyBob2xkIG9iamVjdHMgb2YKKwkgKiAoMSBwYWdlLCAyIHBhZ2VzLCA0IHBh
Z2VzLCA4KyBwYWdlcykuCisJICovCisJbiA9IGZscyhzeiA+PiBQQUdFX1NISUZUKSAtIDE7CisJ
aWYgKG4gPj0gQVJSQVlfU0laRShwb29sLT5jYWNoZV9saXN0KSkKKwkJbiA9IEFSUkFZX1NJWkUo
cG9vbC0+Y2FjaGVfbGlzdCkgLSAxOworCisJcmV0dXJuICZwb29sLT5jYWNoZV9saXN0W25dOwor
fQorCitzdGF0aWMgdm9pZCBub2RlX2ZyZWUoc3RydWN0IGludGVsX2VuZ2luZV9wb29sX25vZGUg
Km5vZGUpCit7CisJaTkxNV9nZW1fb2JqZWN0X3B1dChub2RlLT5vYmopOworCWtmcmVlKG5vZGUp
OworfQorCitzdGF0aWMgaW50IHBvb2xfYWN0aXZlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQor
eworCXN0cnVjdCBpbnRlbF9lbmdpbmVfcG9vbF9ub2RlICpub2RlID0KKwkJY29udGFpbmVyX29m
KHJlZiwgdHlwZW9mKCpub2RlKSwgYWN0aXZlKTsKKworCWlmIChyZXNlcnZhdGlvbl9vYmplY3Rf
dHJ5bG9jayhub2RlLT5vYmotPnJlc3YpKSB7CisJCXJlc2VydmF0aW9uX29iamVjdF9hZGRfZXhj
bF9mZW5jZShub2RlLT5vYmotPnJlc3YsIE5VTEwpOworCQlyZXNlcnZhdGlvbl9vYmplY3RfdW5s
b2NrKG5vZGUtPm9iai0+cmVzdik7CisJfQorCisJcmV0dXJuIGk5MTVfZ2VtX29iamVjdF9waW5f
cGFnZXMobm9kZS0+b2JqKTsKK30KKworX19pOTE1X2FjdGl2ZV9jYWxsCitzdGF0aWMgdm9pZCBw
b29sX3JldGlyZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKK3sKKwlzdHJ1Y3QgaW50ZWxfZW5n
aW5lX3Bvb2xfbm9kZSAqbm9kZSA9CisJCWNvbnRhaW5lcl9vZihyZWYsIHR5cGVvZigqbm9kZSks
IGFjdGl2ZSk7CisJc3RydWN0IGludGVsX2VuZ2luZV9wb29sICpwb29sID0gbm9kZS0+cG9vbDsK
KwlzdHJ1Y3QgbGlzdF9oZWFkICpsaXN0ID0gYnVja2V0X2Zvcl9zaXplKHBvb2wsIG5vZGUtPm9i
ai0+YmFzZS5zaXplKTsKKwl1bnNpZ25lZCBsb25nIGZsYWdzOworCisJR0VNX0JVR19PTighaW50
ZWxfZW5naW5lX2lzX2FjdGl2ZSh0b19lbmdpbmUocG9vbCkpKTsKKworCWk5MTVfZ2VtX29iamVj
dF91bnBpbl9wYWdlcyhub2RlLT5vYmopOworCisJc3Bpbl9sb2NrX2lycXNhdmUoJnBvb2wtPmxv
Y2ssIGZsYWdzKTsKKwlsaXN0X2FkZCgmbm9kZS0+bGluaywgbGlzdCk7CisJc3Bpbl91bmxvY2tf
aXJxcmVzdG9yZSgmcG9vbC0+bG9jaywgZmxhZ3MpOworfQorCitzdGF0aWMgc3RydWN0IGludGVs
X2VuZ2luZV9wb29sX25vZGUgKgorbm9kZV9jcmVhdGUoc3RydWN0IGludGVsX2VuZ2luZV9wb29s
ICpwb29sLCBzaXplX3Qgc3opCit7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lID0g
dG9fZW5naW5lKHBvb2wpOworCXN0cnVjdCBpbnRlbF9lbmdpbmVfcG9vbF9ub2RlICpub2RlOwor
CXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CisKKwlub2RlID0ga21hbGxvYyhzaXpl
b2YoKm5vZGUpLAorCQkgICAgICAgR0ZQX0tFUk5FTCB8IF9fR0ZQX1JFVFJZX01BWUZBSUwgfCBf
X0dGUF9OT1dBUk4pOworCWlmICghbm9kZSkKKwkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisK
Kwlub2RlLT5wb29sID0gcG9vbDsKKwlpOTE1X2FjdGl2ZV9pbml0KCZub2RlLT5hY3RpdmUsIHBv
b2xfYWN0aXZlLCBwb29sX3JldGlyZSk7CisKKwlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRl
X2ludGVybmFsKGVuZ2luZS0+aTkxNSwgc3opOworCWlmIChJU19FUlIob2JqKSkgeworCQlrZnJl
ZShub2RlKTsKKwkJcmV0dXJuIEVSUl9DQVNUKG9iaik7CisJfQorCisJbm9kZS0+b2JqID0gb2Jq
OworCXJldHVybiBub2RlOworfQorCitzdHJ1Y3QgaW50ZWxfZW5naW5lX3Bvb2xfbm9kZSAqCitp
bnRlbF9lbmdpbmVfcG9vbF9nZXQoc3RydWN0IGludGVsX2VuZ2luZV9wb29sICpwb29sLCBzaXpl
X3Qgc2l6ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX3Bvb2xfbm9kZSAqbm9kZTsKKwlzdHJ1
Y3QgbGlzdF9oZWFkICpsaXN0OworCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisJaW50IHJldDsKKwor
CUdFTV9CVUdfT04oIWludGVsX2VuZ2luZV9pc19hY3RpdmUodG9fZW5naW5lKHBvb2wpKSk7CisK
KwlzaXplID0gUEFHRV9BTElHTihzaXplKTsKKwlsaXN0ID0gYnVja2V0X2Zvcl9zaXplKHBvb2ws
IHNpemUpOworCisJc3Bpbl9sb2NrX2lycXNhdmUoJnBvb2wtPmxvY2ssIGZsYWdzKTsKKwlsaXN0
X2Zvcl9lYWNoX2VudHJ5KG5vZGUsIGxpc3QsIGxpbmspIHsKKwkJaWYgKG5vZGUtPm9iai0+YmFz
ZS5zaXplIDwgc2l6ZSkKKwkJCWNvbnRpbnVlOworCQlsaXN0X2RlbCgmbm9kZS0+bGluayk7CisJ
CWJyZWFrOworCX0KKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZwb29sLT5sb2NrLCBmbGFncyk7
CisKKwlpZiAoJm5vZGUtPmxpbmsgPT0gbGlzdCkgeworCQlub2RlID0gbm9kZV9jcmVhdGUocG9v
bCwgc2l6ZSk7CisJCWlmIChJU19FUlIobm9kZSkpCisJCQlyZXR1cm4gbm9kZTsKKwl9CisKKwly
ZXQgPSBpOTE1X2FjdGl2ZV9hY3F1aXJlKCZub2RlLT5hY3RpdmUpOworCWlmIChyZXQpIHsKKwkJ
bm9kZV9mcmVlKG5vZGUpOworCQlyZXR1cm4gRVJSX1BUUihyZXQpOworCX0KKworCXJldHVybiBu
b2RlOworfQorCit2b2lkIGludGVsX2VuZ2luZV9wb29sX2luaXQoc3RydWN0IGludGVsX2VuZ2lu
ZV9wb29sICpwb29sKQoreworCWludCBuOworCisJc3Bpbl9sb2NrX2luaXQoJnBvb2wtPmxvY2sp
OworCWZvciAobiA9IDA7IG4gPCBBUlJBWV9TSVpFKHBvb2wtPmNhY2hlX2xpc3QpOyBuKyspCisJ
CUlOSVRfTElTVF9IRUFEKCZwb29sLT5jYWNoZV9saXN0W25dKTsKK30KKwordm9pZCBpbnRlbF9l
bmdpbmVfcG9vbF9wYXJrKHN0cnVjdCBpbnRlbF9lbmdpbmVfcG9vbCAqcG9vbCkKK3sKKwlpbnQg
bjsKKworCWZvciAobiA9IDA7IG4gPCBBUlJBWV9TSVpFKHBvb2wtPmNhY2hlX2xpc3QpOyBuKysp
IHsKKwkJc3RydWN0IGxpc3RfaGVhZCAqbGlzdCA9ICZwb29sLT5jYWNoZV9saXN0W25dOworCQlz
dHJ1Y3QgaW50ZWxfZW5naW5lX3Bvb2xfbm9kZSAqbm9kZSwgKm5uOworCisJCWxpc3RfZm9yX2Vh
Y2hfZW50cnlfc2FmZShub2RlLCBubiwgbGlzdCwgbGluaykKKwkJCW5vZGVfZnJlZShub2RlKTsK
KworCQlJTklUX0xJU1RfSEVBRChsaXN0KTsKKwl9Cit9CisKK3ZvaWQgaW50ZWxfZW5naW5lX3Bv
b2xfZmluaShzdHJ1Y3QgaW50ZWxfZW5naW5lX3Bvb2wgKnBvb2wpCit7CisJaW50IG47CisKKwlm
b3IgKG4gPSAwOyBuIDwgQVJSQVlfU0laRShwb29sLT5jYWNoZV9saXN0KTsgbisrKQorCQlHRU1f
QlVHX09OKCFsaXN0X2VtcHR5KCZwb29sLT5jYWNoZV9saXN0W25dKSk7Cit9CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG9vbC5oIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3Bvb2wuaApuZXcgZmlsZSBtb2RlIDEwMDY0NApp
bmRleCAwMDAwMDAwMDAwMDAuLjZiYzY0YmYxOTQ4NQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sLmgKQEAgLTAsMCArMSwzMyBAQAor
LyoKKyAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKKyAqCisgKiBDb3B5cmlnaHQgwqkg
MjAxNC0yMDE4IEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2lmbmRlZiBJTlRFTF9FTkdJTkVf
UE9PTF9ICisjZGVmaW5lIElOVEVMX0VOR0lORV9QT09MX0gKKworI2luY2x1ZGUgImludGVsX2Vu
Z2luZV9wb29sX3R5cGVzLmgiCisjaW5jbHVkZSAiaTkxNV9yZXF1ZXN0LmgiCisKK3N0cnVjdCBp
bnRlbF9lbmdpbmVfcG9vbF9ub2RlICoKK2ludGVsX2VuZ2luZV9wb29sX2dldChzdHJ1Y3QgaW50
ZWxfZW5naW5lX3Bvb2wgKnBvb2wsIHNpemVfdCBzaXplKTsKKworc3RhdGljIGlubGluZSBpbnQK
K2ludGVsX2VuZ2luZV9wb29sX21hcmtfYWN0aXZlKHN0cnVjdCBpbnRlbF9lbmdpbmVfcG9vbF9u
b2RlICpub2RlLAorCQkJICAgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCit7CisJcmV0dXJu
IGk5MTVfYWN0aXZlX3JlZigmbm9kZS0+YWN0aXZlLCBycS0+ZmVuY2UuY29udGV4dCwgJnJxLT5m
ZW5jZSk7Cit9CisKK3N0YXRpYyBpbmxpbmUgdm9pZAoraW50ZWxfZW5naW5lX3Bvb2xfcHV0KHN0
cnVjdCBpbnRlbF9lbmdpbmVfcG9vbF9ub2RlICpub2RlKQoreworCWk5MTVfYWN0aXZlX3JlbGVh
c2UoJm5vZGUtPmFjdGl2ZSk7Cit9CisKK3ZvaWQgaW50ZWxfZW5naW5lX3Bvb2xfaW5pdChzdHJ1
Y3QgaW50ZWxfZW5naW5lX3Bvb2wgKnBvb2wpOwordm9pZCBpbnRlbF9lbmdpbmVfcG9vbF9wYXJr
KHN0cnVjdCBpbnRlbF9lbmdpbmVfcG9vbCAqcG9vbCk7Cit2b2lkIGludGVsX2VuZ2luZV9wb29s
X2Zpbmkoc3RydWN0IGludGVsX2VuZ2luZV9wb29sICpwb29sKTsKKworI2VuZGlmIC8qIElOVEVM
X0VOR0lORV9QT09MX0ggKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2VuZ2luZV9wb29sX3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9l
bmdpbmVfcG9vbF90eXBlcy5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAw
MC4uOTllNGU1ZDU0ZmU2Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZW5naW5lX3Bvb2xfdHlwZXMuaApAQCAtMCwwICsxLDI5IEBACisvKgorICogU1BE
WC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAorICoKKyAqIENvcHlyaWdodCDCqSAyMDE0LTIwMTgg
SW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaWZuZGVmIElOVEVMX0VOR0lORV9QT09MX1RZUEVT
X0gKKyNkZWZpbmUgSU5URUxfRU5HSU5FX1BPT0xfVFlQRVNfSAorCisjaW5jbHVkZSA8bGludXgv
bGlzdC5oPgorI2luY2x1ZGUgPGxpbnV4L3NwaW5sb2NrLmg+CisKKyNpbmNsdWRlICJpOTE1X2Fj
dGl2ZS5oIgorCitzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdDsKKworc3RydWN0IGludGVsX2Vu
Z2luZV9wb29sIHsKKwlzcGlubG9ja190IGxvY2s7CisJc3RydWN0IGxpc3RfaGVhZCBjYWNoZV9s
aXN0WzRdOworfTsKKworc3RydWN0IGludGVsX2VuZ2luZV9wb29sX25vZGUgeworCXN0cnVjdCBp
OTE1X2FjdGl2ZSBhY3RpdmU7CisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKKwlz
dHJ1Y3QgbGlzdF9oZWFkIGxpbms7CisJc3RydWN0IGludGVsX2VuZ2luZV9wb29sICpwb29sOwor
fTsKKworI2VuZGlmIC8qIElOVEVMX0VOR0lORV9QT09MX1RZUEVTX0ggKi8KZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5oIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmgKaW5kZXggMWNiZTEwYTBmZWM3Li4z
MWRhOTY2ZDA2NjkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Vu
Z2luZV90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV90
eXBlcy5oCkBAIC0xNiwxMSArMTYsMTEgQEAKICNpbmNsdWRlIDxsaW51eC90eXBlcy5oPgogCiAj
aW5jbHVkZSAiaTkxNV9nZW0uaCIKLSNpbmNsdWRlICJpOTE1X2dlbV9iYXRjaF9wb29sLmgiCiAj
aW5jbHVkZSAiaTkxNV9wbXUuaCIKICNpbmNsdWRlICJpOTE1X3ByaW9saXN0X3R5cGVzLmgiCiAj
aW5jbHVkZSAiaTkxNV9zZWxmdGVzdC5oIgogI2luY2x1ZGUgImk5MTVfdGltZWxpbmVfdHlwZXMu
aCIKKyNpbmNsdWRlICJpbnRlbF9lbmdpbmVfcG9vbF90eXBlcy5oIgogI2luY2x1ZGUgImludGVs
X3NzZXUuaCIKICNpbmNsdWRlICJpbnRlbF93YWtlcmVmLmgiCiAjaW5jbHVkZSAiaW50ZWxfd29y
a2Fyb3VuZHNfdHlwZXMuaCIKQEAgLTMyMyw3ICszMjMsNyBAQCBzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzIHsKIAkgKiB3aGVuIHRoZSBjb21tYW5kIHBhcnNlciBpcyBlbmFibGVkLiBQcmV2ZW50cyB0
aGUgY2xpZW50IGZyb20KIAkgKiBtb2RpZnlpbmcgdGhlIGJhdGNoIGNvbnRlbnRzIGFmdGVyIHNv
ZnR3YXJlIHBhcnNpbmcuCiAJICovCi0Jc3RydWN0IGk5MTVfZ2VtX2JhdGNoX3Bvb2wgYmF0Y2hf
cG9vbDsKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX3Bvb2wgcG9vbDsKIAogCXN0cnVjdCBpbnRlbF9o
d19zdGF0dXNfcGFnZSBzdGF0dXNfcGFnZTsKIAlzdHJ1Y3QgaTkxNV9jdHhfd29ya2Fyb3VuZHMg
d2FfY3R4OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvbW9ja19lbmdpbmUu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L21vY2tfZW5naW5lLmMKaW5kZXggYjljMjc2NGJl
Y2EzLi44ZDAwYzU0MTg4MjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L21v
Y2tfZW5naW5lLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvbW9ja19lbmdpbmUuYwpA
QCAtMjcsNiArMjcsNyBAQAogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAjaW5jbHVkZSAiaW50ZWxf
Y29udGV4dC5oIgogI2luY2x1ZGUgImludGVsX2VuZ2luZV9wbS5oIgorI2luY2x1ZGUgImludGVs
X2VuZ2luZV9wb29sLmgiCiAKICNpbmNsdWRlICJtb2NrX2VuZ2luZS5oIgogI2luY2x1ZGUgInNl
bGZ0ZXN0cy9tb2NrX3JlcXVlc3QuaCIKQEAgLTI5MCw2ICsyOTEsOCBAQCBpbnQgbW9ja19lbmdp
bmVfaW5pdChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJaW50ZWxfZW5naW5lX2lu
aXRfZXhlY2xpc3RzKGVuZ2luZSk7CiAJaW50ZWxfZW5naW5lX2luaXRfX3BtKGVuZ2luZSk7CiAK
KwlpbnRlbF9lbmdpbmVfcG9vbF9pbml0KCZlbmdpbmUtPnBvb2wpOworCiAJZW5naW5lLT5rZXJu
ZWxfY29udGV4dCA9CiAJCWk5MTVfZ2VtX2NvbnRleHRfZ2V0X2VuZ2luZShpOTE1LT5rZXJuZWxf
Y29udGV4dCwgZW5naW5lLT5pZCk7CiAJaWYgKElTX0VSUihlbmdpbmUtPmtlcm5lbF9jb250ZXh0
KSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKaW5kZXggMDZiMzE0N2Q4MWY3Li5kN2M5
OGU0NzRkNTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCkBAIC0yODgsMjcgKzI4
OCw2IEBAIHN0YXRpYyBpbnQgcGVyX2ZpbGVfc3RhdHMoaW50IGlkLCB2b2lkICpwdHIsIHZvaWQg
KmRhdGEpCiAJCQkgICBzdGF0cy5jbG9zZWQpOyBcCiB9IHdoaWxlICgwKQogCi1zdGF0aWMgdm9p
ZCBwcmludF9iYXRjaF9wb29sX3N0YXRzKHN0cnVjdCBzZXFfZmlsZSAqbSwKLQkJCQkgICBzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCi17Ci0Jc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iajsKLQlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7Ci0Jc3RydWN0IGZp
bGVfc3RhdHMgc3RhdHMgPSB7fTsKLQllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKLQlpbnQgajsK
LQotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGRldl9wcml2LCBpZCkgewotCQlmb3IgKGogPSAw
OyBqIDwgQVJSQVlfU0laRShlbmdpbmUtPmJhdGNoX3Bvb2wuY2FjaGVfbGlzdCk7IGorKykgewot
CQkJbGlzdF9mb3JfZWFjaF9lbnRyeShvYmosCi0JCQkJCSAgICAmZW5naW5lLT5iYXRjaF9wb29s
LmNhY2hlX2xpc3Rbal0sCi0JCQkJCSAgICBiYXRjaF9wb29sX2xpbmspCi0JCQkJcGVyX2ZpbGVf
c3RhdHMoMCwgb2JqLCAmc3RhdHMpOwotCQl9Ci0JfQotCi0JcHJpbnRfZmlsZV9zdGF0cyhtLCAi
W2tdYmF0Y2ggcG9vbCIsIHN0YXRzKTsKLX0KLQogc3RhdGljIHZvaWQgcHJpbnRfY29udGV4dF9z
dGF0cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sCiAJCQkJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCiB7CkBAIC0zNjYsNTggKzM0NSwxMiBAQCBzdGF0aWMgaW50IGk5MTVfZ2VtX29iamVjdF9p
bmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKIAlpZiAocmV0KQogCQlyZXR1cm4g
cmV0OwogCi0JcHJpbnRfYmF0Y2hfcG9vbF9zdGF0cyhtLCBpOTE1KTsKIAlwcmludF9jb250ZXh0
X3N0YXRzKG0sIGk5MTUpOwogCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiAKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGludCBpOTE1X2dlbV9iYXRjaF9wb29sX2luZm8o
c3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9faTkxNShtLT5wcml2YXRlKTsKLQlzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2ID0gJmRldl9wcml2LT5kcm07Ci0Jc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iajsKLQlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7Ci0JZW51bSBpbnRlbF9lbmdp
bmVfaWQgaWQ7Ci0JaW50IHRvdGFsID0gMDsKLQlpbnQgcmV0LCBqOwotCi0JcmV0ID0gbXV0ZXhf
bG9ja19pbnRlcnJ1cHRpYmxlKCZkZXYtPnN0cnVjdF9tdXRleCk7Ci0JaWYgKHJldCkKLQkJcmV0
dXJuIHJldDsKLQotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGRldl9wcml2LCBpZCkgewotCQlm
b3IgKGogPSAwOyBqIDwgQVJSQVlfU0laRShlbmdpbmUtPmJhdGNoX3Bvb2wuY2FjaGVfbGlzdCk7
IGorKykgewotCQkJaW50IGNvdW50OwotCi0JCQljb3VudCA9IDA7Ci0JCQlsaXN0X2Zvcl9lYWNo
X2VudHJ5KG9iaiwKLQkJCQkJICAgICZlbmdpbmUtPmJhdGNoX3Bvb2wuY2FjaGVfbGlzdFtqXSwK
LQkJCQkJICAgIGJhdGNoX3Bvb2xfbGluaykKLQkJCQljb3VudCsrOwotCQkJc2VxX3ByaW50Ziht
LCAiJXMgY2FjaGVbJWRdOiAlZCBvYmplY3RzXG4iLAotCQkJCSAgIGVuZ2luZS0+bmFtZSwgaiwg
Y291bnQpOwotCi0JCQlsaXN0X2Zvcl9lYWNoX2VudHJ5KG9iaiwKLQkJCQkJICAgICZlbmdpbmUt
PmJhdGNoX3Bvb2wuY2FjaGVfbGlzdFtqXSwKLQkJCQkJICAgIGJhdGNoX3Bvb2xfbGluaykgewot
CQkJCXNlcV9wdXRzKG0sICIgICAiKTsKLQkJCQlkZXNjcmliZV9vYmoobSwgb2JqKTsKLQkJCQlz
ZXFfcHV0YyhtLCAnXG4nKTsKLQkJCX0KLQotCQkJdG90YWwgKz0gY291bnQ7Ci0JCX0KLQl9Ci0K
LQlzZXFfcHJpbnRmKG0sICJ0b3RhbDogJWRcbiIsIHRvdGFsKTsKLQotCW11dGV4X3VubG9jaygm
ZGV2LT5zdHJ1Y3RfbXV0ZXgpOwotCi0JcmV0dXJuIDA7Ci19Ci0KIHN0YXRpYyB2b2lkIGdlbjhf
ZGlzcGxheV9pbnRlcnJ1cHRfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0pCiB7CiAJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOwpAQCAt
NDM1Nyw3ICs0MjkwLDYgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1faW5mb19saXN0IGk5MTVf
ZGVidWdmc19saXN0W10gPSB7CiAJeyJpOTE1X2dlbV9vYmplY3RzIiwgaTkxNV9nZW1fb2JqZWN0
X2luZm8sIDB9LAogCXsiaTkxNV9nZW1fZmVuY2VfcmVncyIsIGk5MTVfZ2VtX2ZlbmNlX3JlZ3Nf
aW5mbywgMH0sCiAJeyJpOTE1X2dlbV9pbnRlcnJ1cHQiLCBpOTE1X2ludGVycnVwdF9pbmZvLCAw
fSwKLQl7Imk5MTVfZ2VtX2JhdGNoX3Bvb2wiLCBpOTE1X2dlbV9iYXRjaF9wb29sX2luZm8sIDB9
LAogCXsiaTkxNV9ndWNfaW5mbyIsIGk5MTVfZ3VjX2luZm8sIDB9LAogCXsiaTkxNV9ndWNfbG9h
ZF9zdGF0dXMiLCBpOTE1X2d1Y19sb2FkX3N0YXR1c19pbmZvLCAwfSwKIAl7Imk5MTVfZ3VjX2xv
Z19kdW1wIiwgaTkxNV9ndWNfbG9nX2R1bXAsIDB9LApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9nZW1fYmF0Y2hfcG9vbC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9nZW1fYmF0Y2hfcG9vbC5jCmRlbGV0ZWQgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAxYjc1OTVl
MmFjMjEuLjAwMDAwMDAwMDAwMAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9i
YXRjaF9wb29sLmMKKysrIC9kZXYvbnVsbApAQCAtMSwxMzIgKzAsMCBAQAotLyoKLSAqIFNQRFgt
TGljZW5zZS1JZGVudGlmaWVyOiBNSVQKLSAqCi0gKiBDb3B5cmlnaHQgwqkgMjAxNC0yMDE4IElu
dGVsIENvcnBvcmF0aW9uCi0gKi8KLQotI2luY2x1ZGUgImk5MTVfZ2VtX2JhdGNoX3Bvb2wuaCIK
LSNpbmNsdWRlICJpOTE1X2Rydi5oIgotCi0vKioKLSAqIERPQzogYmF0Y2ggcG9vbAotICoKLSAq
IEluIG9yZGVyIHRvIHN1Ym1pdCBiYXRjaCBidWZmZXJzIGFzICdzZWN1cmUnLCB0aGUgc29mdHdh
cmUgY29tbWFuZCBwYXJzZXIKLSAqIG11c3QgZW5zdXJlIHRoYXQgYSBiYXRjaCBidWZmZXIgY2Fu
bm90IGJlIG1vZGlmaWVkIGFmdGVyIHBhcnNpbmcuIEl0IGRvZXMKLSAqIHRoaXMgYnkgY29weWlu
ZyB0aGUgdXNlciBwcm92aWRlZCBiYXRjaCBidWZmZXIgY29udGVudHMgdG8gYSBrZXJuZWwgb3du
ZWQKLSAqIGJ1ZmZlciBmcm9tIHdoaWNoIHRoZSBoYXJkd2FyZSB3aWxsIGFjdHVhbGx5IGV4ZWN1
dGUsIGFuZCBieSBjYXJlZnVsbHkKLSAqIG1hbmFnaW5nIHRoZSBhZGRyZXNzIHNwYWNlIGJpbmRp
bmdzIGZvciBzdWNoIGJ1ZmZlcnMuCi0gKgotICogVGhlIGJhdGNoIHBvb2wgZnJhbWV3b3JrIHBy
b3ZpZGVzIGEgbWVjaGFuaXNtIGZvciB0aGUgZHJpdmVyIHRvIG1hbmFnZSBhCi0gKiBzZXQgb2Yg
c2NyYXRjaCBidWZmZXJzIHRvIHVzZSBmb3IgdGhpcyBwdXJwb3NlLiBUaGUgZnJhbWV3b3JrIGNh
biBiZQotICogZXh0ZW5kZWQgdG8gc3VwcG9ydCBvdGhlciB1c2VzIGNhc2VzIHNob3VsZCB0aGV5
IGFyaXNlLgotICovCi0KLS8qKgotICogaTkxNV9nZW1fYmF0Y2hfcG9vbF9pbml0KCkgLSBpbml0
aWFsaXplIGEgYmF0Y2ggYnVmZmVyIHBvb2wKLSAqIEBwb29sOiB0aGUgYmF0Y2ggYnVmZmVyIHBv
b2wKLSAqIEBlbmdpbmU6IHRoZSBhc3NvY2lhdGVkIHJlcXVlc3Qgc3VibWlzc2lvbiBlbmdpbmUK
LSAqLwotdm9pZCBpOTE1X2dlbV9iYXRjaF9wb29sX2luaXQoc3RydWN0IGk5MTVfZ2VtX2JhdGNo
X3Bvb2wgKnBvb2wsCi0JCQkgICAgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCi17
Ci0JaW50IG47Ci0KLQlwb29sLT5lbmdpbmUgPSBlbmdpbmU7Ci0KLQlmb3IgKG4gPSAwOyBuIDwg
QVJSQVlfU0laRShwb29sLT5jYWNoZV9saXN0KTsgbisrKQotCQlJTklUX0xJU1RfSEVBRCgmcG9v
bC0+Y2FjaGVfbGlzdFtuXSk7Ci19Ci0KLS8qKgotICogaTkxNV9nZW1fYmF0Y2hfcG9vbF9maW5p
KCkgLSBjbGVhbiB1cCBhIGJhdGNoIGJ1ZmZlciBwb29sCi0gKiBAcG9vbDogdGhlIHBvb2wgdG8g
Y2xlYW4gdXAKLSAqCi0gKiBOb3RlOiBDYWxsZXJzIG11c3QgaG9sZCB0aGUgc3RydWN0X211dGV4
LgotICovCi12b2lkIGk5MTVfZ2VtX2JhdGNoX3Bvb2xfZmluaShzdHJ1Y3QgaTkxNV9nZW1fYmF0
Y2hfcG9vbCAqcG9vbCkKLXsKLQlpbnQgbjsKLQotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnBvb2wt
PmVuZ2luZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQlmb3IgKG4gPSAwOyBuIDwgQVJS
QVlfU0laRShwb29sLT5jYWNoZV9saXN0KTsgbisrKSB7Ci0JCXN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmosICpuZXh0OwotCi0JCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShvYmosIG5l
eHQsCi0JCQkJCSAmcG9vbC0+Y2FjaGVfbGlzdFtuXSwKLQkJCQkJIGJhdGNoX3Bvb2xfbGluaykK
LQkJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKLQotCQlJTklUX0xJU1RfSEVBRCgmcG9vbC0+
Y2FjaGVfbGlzdFtuXSk7Ci0JfQotfQotCi0vKioKLSAqIGk5MTVfZ2VtX2JhdGNoX3Bvb2xfZ2V0
KCkgLSBhbGxvY2F0ZSBhIGJ1ZmZlciBmcm9tIHRoZSBwb29sCi0gKiBAcG9vbDogdGhlIGJhdGNo
IGJ1ZmZlciBwb29sCi0gKiBAc2l6ZTogdGhlIG1pbmltdW0gZGVzaXJlZCBzaXplIG9mIHRoZSBy
ZXR1cm5lZCBidWZmZXIKLSAqCi0gKiBSZXR1cm5zIGFuIGluYWN0aXZlIGJ1ZmZlciBmcm9tIEBw
b29sIHdpdGggYXQgbGVhc3QgQHNpemUgYnl0ZXMsCi0gKiB3aXRoIHRoZSBwYWdlcyBwaW5uZWQu
IFRoZSBjYWxsZXIgbXVzdCBpOTE1X2dlbV9vYmplY3RfdW5waW5fcGFnZXMoKQotICogb24gdGhl
IHJldHVybmVkIG9iamVjdC4KLSAqCi0gKiBOb3RlOiBDYWxsZXJzIG11c3QgaG9sZCB0aGUgc3Ry
dWN0X211dGV4Ci0gKgotICogUmV0dXJuOiB0aGUgYnVmZmVyIG9iamVjdCBvciBhbiBlcnJvciBw
b2ludGVyCi0gKi8KLXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICoKLWk5MTVfZ2VtX2JhdGNo
X3Bvb2xfZ2V0KHN0cnVjdCBpOTE1X2dlbV9iYXRjaF9wb29sICpwb29sLAotCQkJc2l6ZV90IHNp
emUpCi17Ci0Jc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKLQlzdHJ1Y3QgbGlzdF9o
ZWFkICpsaXN0OwotCWludCBuLCByZXQ7Ci0KLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZwb29sLT5l
bmdpbmUtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCi0JLyogQ29tcHV0ZSBhIHBvd2VyLW9m
LXR3byBidWNrZXQsIGJ1dCB0aHJvdyBldmVyeXRoaW5nIGdyZWF0ZXIgdGhhbgotCSAqIDE2S2lC
IGludG8gdGhlIHNhbWUgYnVja2V0OiBpLmUuIHRoZSB0aGUgYnVja2V0cyBob2xkIG9iamVjdHMg
b2YKLQkgKiAoMSBwYWdlLCAyIHBhZ2VzLCA0IHBhZ2VzLCA4KyBwYWdlcykuCi0JICovCi0JbiA9
IGZscyhzaXplID4+IFBBR0VfU0hJRlQpIC0gMTsKLQlpZiAobiA+PSBBUlJBWV9TSVpFKHBvb2wt
PmNhY2hlX2xpc3QpKQotCQluID0gQVJSQVlfU0laRShwb29sLT5jYWNoZV9saXN0KSAtIDE7Ci0J
bGlzdCA9ICZwb29sLT5jYWNoZV9saXN0W25dOwotCi0JbGlzdF9mb3JfZWFjaF9lbnRyeShvYmos
IGxpc3QsIGJhdGNoX3Bvb2xfbGluaykgewotCQlzdHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0ICpy
ZXN2ID0gb2JqLT5yZXN2OwotCi0JCS8qIFRoZSBiYXRjaGVzIGFyZSBzdHJpY3RseSBMUlUgb3Jk
ZXJlZCAqLwotCQlpZiAoIXJlc2VydmF0aW9uX29iamVjdF90ZXN0X3NpZ25hbGVkX3JjdShyZXN2
LCB0cnVlKSkKLQkJCWJyZWFrOwotCi0JCS8qCi0JCSAqIFRoZSBvYmplY3QgaXMgbm93IGlkbGUs
IGNsZWFyIHRoZSBhcnJheSBvZiBzaGFyZWQKLQkJICogZmVuY2VzIGJlZm9yZSB3ZSBhZGQgYSBu
ZXcgcmVxdWVzdC4gQWx0aG91Z2gsIHdlCi0JCSAqIHJlbWFpbiBvbiB0aGUgc2FtZSBlbmdpbmUs
IHdlIG1heSBiZSBvbiBhIGRpZmZlcmVudAotCQkgKiB0aW1lbGluZSBhbmQgc28gbWF5IGNvbnRp
bnVhbGx5IGdyb3cgdGhlIGFycmF5LAotCQkgKiB0cmFwcGluZyBhIHJlZmVyZW5jZSB0byBhbGwg
dGhlIG9sZCBmZW5jZXMsIHJhdGhlcgotCQkgKiB0aGFuIHJlcGxhY2UgdGhlIGV4aXN0aW5nIGZl
bmNlLgotCQkgKi8KLQkJaWYgKHJjdV9hY2Nlc3NfcG9pbnRlcihyZXN2LT5mZW5jZSkpIHsKLQkJ
CXJlc2VydmF0aW9uX29iamVjdF9sb2NrKHJlc3YsIE5VTEwpOwotCQkJcmVzZXJ2YXRpb25fb2Jq
ZWN0X2FkZF9leGNsX2ZlbmNlKHJlc3YsIE5VTEwpOwotCQkJcmVzZXJ2YXRpb25fb2JqZWN0X3Vu
bG9jayhyZXN2KTsKLQkJfQotCi0JCWlmIChvYmotPmJhc2Uuc2l6ZSA+PSBzaXplKQotCQkJZ290
byBmb3VuZDsKLQl9Ci0KLQlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKHBv
b2wtPmVuZ2luZS0+aTkxNSwgc2l6ZSk7Ci0JaWYgKElTX0VSUihvYmopKQotCQlyZXR1cm4gb2Jq
OwotCi1mb3VuZDoKLQlyZXQgPSBpOTE1X2dlbV9vYmplY3RfcGluX3BhZ2VzKG9iaik7Ci0JaWYg
KHJldCkKLQkJcmV0dXJuIEVSUl9QVFIocmV0KTsKLQotCWxpc3RfbW92ZV90YWlsKCZvYmotPmJh
dGNoX3Bvb2xfbGluaywgbGlzdCk7Ci0JcmV0dXJuIG9iajsKLX0KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2JhdGNoX3Bvb2wuaCBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtX2JhdGNoX3Bvb2wuaApkZWxldGVkIGZpbGUgbW9kZSAxMDA2NDQKaW5kZXgg
ZmVlZWVlYWE1NGQ4Li4wMDAwMDAwMDAwMDAKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9nZW1fYmF0Y2hfcG9vbC5oCisrKyAvZGV2L251bGwKQEAgLTEsMjYgKzAsMCBAQAotLyoKLSAq
IFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKLSAqCi0gKiBDb3B5cmlnaHQgwqkgMjAxNC0y
MDE4IEludGVsIENvcnBvcmF0aW9uCi0gKi8KLQotI2lmbmRlZiBJOTE1X0dFTV9CQVRDSF9QT09M
X0gKLSNkZWZpbmUgSTkxNV9HRU1fQkFUQ0hfUE9PTF9ICi0KLSNpbmNsdWRlIDxsaW51eC90eXBl
cy5oPgotCi1zdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdDsKLXN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3M7Ci0KLXN0cnVjdCBpOTE1X2dlbV9iYXRjaF9wb29sIHsKLQlzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmU7Ci0Jc3RydWN0IGxpc3RfaGVhZCBjYWNoZV9saXN0WzRdOwotfTsKLQotdm9p
ZCBpOTE1X2dlbV9iYXRjaF9wb29sX2luaXQoc3RydWN0IGk5MTVfZ2VtX2JhdGNoX3Bvb2wgKnBv
b2wsCi0JCQkgICAgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOwotdm9pZCBpOTE1
X2dlbV9iYXRjaF9wb29sX2Zpbmkoc3RydWN0IGk5MTVfZ2VtX2JhdGNoX3Bvb2wgKnBvb2wpOwot
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKgotaTkxNV9nZW1fYmF0Y2hfcG9vbF9nZXQoc3Ry
dWN0IGk5MTVfZ2VtX2JhdGNoX3Bvb2wgKnBvb2wsIHNpemVfdCBzaXplKTsKLQotI2VuZGlmIC8q
IEk5MTVfR0VNX0JBVENIX1BPT0xfSCAqLwotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVs
LWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcv
bWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 065C93A1F12
	for <lists+intel-gfx@lfdr.de>; Wed,  9 Jun 2021 23:30:27 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3C7486EB8D;
	Wed,  9 Jun 2021 21:30:19 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mail-pl1-x629.google.com (mail-pl1-x629.google.com
 [IPv6:2607:f8b0:4864:20::629])
 by gabe.freedesktop.org (Postfix) with ESMTPS id EFB806EB8B
 for <intel-gfx@lists.freedesktop.org>; Wed,  9 Jun 2021 21:30:14 +0000 (UTC)
Received: by mail-pl1-x629.google.com with SMTP id c13so13457638plz.0
 for <intel-gfx@lists.freedesktop.org>; Wed, 09 Jun 2021 14:30:14 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=jlekstrand-net.20150623.gappssmtp.com; s=20150623;
 h=from:to:cc:subject:date:message-id:in-reply-to:references
 :mime-version:content-transfer-encoding;
 bh=TVM6IqkVxgF758A5cge42oRP8xpTXQAuAHmNBA0fFv0=;
 b=vgD4miESEhiOO5Ipfy3sfslWwzjyKiWCpZSzZlqy1cwgg/0zWGow0db1bcdXr3B5ia
 rtDv6xX9JPJYEWQ5kysiQSLrXXhR019g1tJ4DntjjzxJRSaa+Ao3f0QnSFUBAiwtw6sv
 Rr7n13Nn+zxAzb4t19CvQnBOQZOSGJ3R0HORQNdlCHufvfgBh7jCgEQpmcLKLOM/PJcH
 1pr5Uq66suhIxO7xa9XqwmzQV7wrx4MjhKBRPm0bPItaH8aEWWjLUBv3Fobfwg0lqGWg
 gNEp+5aQCRpHlaoNF5MP6jw7cIl7gYtcsl4ofbCPEdStThOpD2VI80+zSxoXdM+i8G39
 /scQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20161025;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:in-reply-to
 :references:mime-version:content-transfer-encoding;
 bh=TVM6IqkVxgF758A5cge42oRP8xpTXQAuAHmNBA0fFv0=;
 b=bup27XW7EDJSHbPydE90RyCMHV1DPWX3xXRgxA959LIXwWloZ/LCr2NFb336Gao+LL
 z2DgRVQSFk7qOXYS1aMyVOxUGeYP4A9T4r2pRV3pZGIyd13fT1iGGtkT4IlNlEpyOjLC
 vTeSE1PXXmX6OISbOx7Kd5sploGVqoFCMZUb3sVNuQ0UO48k4HINUI131Bjc2tcGhZoO
 evdB+R658EAwZmuXUQAvtuDOnW4bwTk/qPvT0hdPRz6vwCZHxIOOX3/fEntmMLbT89Pq
 lV+jjH4/9HSqoVRKKdoFqRqbtyPd+7/6F9QrH7qjFrFVbnhKtBJBZsuDvppyZUjVZyr7
 rhlA==
X-Gm-Message-State: AOAM531t80kd/x9EwmgLU5ZHx2DOhezA3Hc3nHVJt9u7JB3zqDZ+JUFa
 CVT00j+wq//GMV9/Giz+7hPCNQ==
X-Google-Smtp-Source: ABdhPJxA7otZafFMLRTV6Q2ddhPEa1XgHZ6ZhrzXeSXf6tntPEcgFP6S38N9qoUqvaOPomgnSMqFzg==
X-Received: by 2002:a17:90a:bd18:: with SMTP id
 y24mr6503097pjr.83.1623274214438; 
 Wed, 09 Jun 2021 14:30:14 -0700 (PDT)
Received: from omlet.lan (jfdmzpr04-ext.jf.intel.com. [134.134.137.73])
 by smtp.gmail.com with ESMTPSA id u14sm519133pjx.14.2021.06.09.14.30.12
 (version=TLS1_3 cipher=TLS_AES_256_GCM_SHA384 bits=256/256);
 Wed, 09 Jun 2021 14:30:14 -0700 (PDT)
From: Jason Ekstrand <jason@jlekstrand.net>
To: dri-devel@lists.freedesktop.org,
	intel-gfx@lists.freedesktop.org
Date: Wed,  9 Jun 2021 16:29:59 -0500
Message-Id: <20210609212959.471209-6-jason@jlekstrand.net>
X-Mailer: git-send-email 2.31.1
In-Reply-To: <20210609212959.471209-1-jason@jlekstrand.net>
References: <20210609212959.471209-1-jason@jlekstrand.net>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 5/5] DONOTMERGE: dma-buf: Get rid of
 dma_fence_get_rcu_safe
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Daniel Vetter <daniel.vetter@ffwll.ch>,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>,
 Matthew Auld <matthew.auld@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhpcyBoZWxwZXIgZXhpc3RlZCB0byBoYW5kbGUgdGhlIHdlaXJkIGNvcm5lci1jYXNlcyBjYXVz
ZWQgYnkgdXNpbmcKU0xBQl9UWVBFU0FGRV9CWV9SQ1UgZm9yIGJhY2tpbmcgZG1hX2ZlbmNlLiAg
Tm93IHRoYXQgbm8gb25lIGlzIHVzaW5nCnRoYXQgYW55bW9yZSAoaTkxNSB3YXMgdGhlIG9ubHkg
cmVhbCB1c2VyKSwgZG1hX2ZlbmNlX2dldF9yY3UgaXMKc3VmZmljaWVudC4gIFRoZSBvbmUgc2xp
Z2h0bHkgYW5ub3lpbmcgdGhpbmcgd2UgaGF2ZSB0byBkZWFsIHdpdGggaGVyZQppcyB0aGF0IGRt
YV9mZW5jZV9nZXRfcmN1X3NhZmUgZGlkIGFuIHJjdV9kZXJlZmVyZW5jZSBhcyB3ZWxsIGFzIGEK
U0xBQl9UWVBFU0FGRV9CWV9SQ1Utc2FmZSBkbWFfZmVuY2VfZ2V0X3JjdS4gIFRoaXMgbWVhbnMg
ZWFjaCBjYWxsIHNpdGUKZW5kcyB1cCBiZWluZyAzIGxpbmVzIGluc3RlYWQgb2YgMS4KClNpZ25l
ZC1vZmYtYnk6IEphc29uIEVrc3RyYW5kIDxqYXNvbkBqbGVrc3RyYW5kLm5ldD4KQ2M6IERhbmll
bCBWZXR0ZXIgPGRhbmllbC52ZXR0ZXJAZmZ3bGwuY2g+CkNjOiBDaHJpc3RpYW4gS8O2bmlnIDxj
aHJpc3RpYW4ua29lbmlnQGFtZC5jb20+CkNjOiBNYXR0aGV3IEF1bGQgPG1hdHRoZXcuYXVsZEBp
bnRlbC5jb20+CkNjOiBNYWFydGVuIExhbmtob3JzdCA8bWFhcnRlbi5sYW5raG9yc3RAbGludXgu
aW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZG1hLWJ1Zi9kbWEtZmVuY2UtY2hhaW4uYyAgICAgICAg
IHwgIDggKystLQogZHJpdmVycy9kbWEtYnVmL2RtYS1yZXN2LmMgICAgICAgICAgICAgICAgfCAg
NCArLQogZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2ZlbmNlLmMgfCAgNCArLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaCAgICAgICAgfCAgNCArLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYyAgICAgICAgICAgfCAgNCArLQogaW5jbHVkZS9kcm0v
ZHJtX3N5bmNvYmouaCAgICAgICAgICAgICAgICAgfCAgNCArLQogaW5jbHVkZS9saW51eC9kbWEt
ZmVuY2UuaCAgICAgICAgICAgICAgICAgfCA1MCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQogaW5j
bHVkZS9saW51eC9kbWEtcmVzdi5oICAgICAgICAgICAgICAgICAgfCAgNCArLQogOCBmaWxlcyBj
aGFuZ2VkLCAyMyBpbnNlcnRpb25zKCspLCA1OSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2RtYS1idWYvZG1hLWZlbmNlLWNoYWluLmMgYi9kcml2ZXJzL2RtYS1idWYvZG1hLWZl
bmNlLWNoYWluLmMKaW5kZXggN2QxMjllNjhhYzcwMS4uNDZkZmM3ZDk0ZDhlZCAxMDA2NDQKLS0t
IGEvZHJpdmVycy9kbWEtYnVmL2RtYS1mZW5jZS1jaGFpbi5jCisrKyBiL2RyaXZlcnMvZG1hLWJ1
Zi9kbWEtZmVuY2UtY2hhaW4uYwpAQCAtMTUsMTUgKzE1LDE3IEBAIHN0YXRpYyBib29sIGRtYV9m
ZW5jZV9jaGFpbl9lbmFibGVfc2lnbmFsaW5nKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlKTsKICAq
IGRtYV9mZW5jZV9jaGFpbl9nZXRfcHJldiAtIHVzZSBSQ1UgdG8gZ2V0IGEgcmVmZXJlbmNlIHRv
IHRoZSBwcmV2aW91cyBmZW5jZQogICogQGNoYWluOiBjaGFpbiBub2RlIHRvIGdldCB0aGUgcHJl
dmlvdXMgbm9kZSBmcm9tCiAgKgotICogVXNlIGRtYV9mZW5jZV9nZXRfcmN1X3NhZmUgdG8gZ2V0
IGEgcmVmZXJlbmNlIHRvIHRoZSBwcmV2aW91cyBmZW5jZSBvZiB0aGUKLSAqIGNoYWluIG5vZGUu
CisgKiBVc2UgcmN1X2RlcmVmZXJlbmNlIGFuZCBkbWFfZmVuY2VfZ2V0X3JjdSB0byBnZXQgYSBy
ZWZlcmVuY2UgdG8gdGhlCisgKiBwcmV2aW91cyBmZW5jZSBvZiB0aGUgY2hhaW4gbm9kZS4KICAq
Lwogc3RhdGljIHN0cnVjdCBkbWFfZmVuY2UgKmRtYV9mZW5jZV9jaGFpbl9nZXRfcHJldihzdHJ1
Y3QgZG1hX2ZlbmNlX2NoYWluICpjaGFpbikKIHsKIAlzdHJ1Y3QgZG1hX2ZlbmNlICpwcmV2Owog
CiAJcmN1X3JlYWRfbG9jaygpOwotCXByZXYgPSBkbWFfZmVuY2VfZ2V0X3JjdV9zYWZlKCZjaGFp
bi0+cHJldik7CisJcHJldiA9IHJjdV9kZXJlZmVyZW5jZShjaGFpbi0+cHJldik7CisJaWYgKHBy
ZXYpCisJCXByZXYgPSBkbWFfZmVuY2VfZ2V0X3JjdShwcmV2KTsKIAlyY3VfcmVhZF91bmxvY2so
KTsKIAlyZXR1cm4gcHJldjsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZG1hLWJ1Zi9kbWEtcmVz
di5jIGIvZHJpdmVycy9kbWEtYnVmL2RtYS1yZXN2LmMKaW5kZXggZjI2YzcxNzQ3ZDQzYS4uY2Zl
MGRiM2NjYTI5MiAxMDA2NDQKLS0tIGEvZHJpdmVycy9kbWEtYnVmL2RtYS1yZXN2LmMKKysrIGIv
ZHJpdmVycy9kbWEtYnVmL2RtYS1yZXN2LmMKQEAgLTM3Niw3ICszNzYsOSBAQCBpbnQgZG1hX3Jl
c3ZfY29weV9mZW5jZXMoc3RydWN0IGRtYV9yZXN2ICpkc3QsIHN0cnVjdCBkbWFfcmVzdiAqc3Jj
KQogCQlkc3RfbGlzdCA9IE5VTEw7CiAJfQogCi0JbmV3ID0gZG1hX2ZlbmNlX2dldF9yY3Vfc2Fm
ZSgmc3JjLT5mZW5jZV9leGNsKTsKKwluZXcgPSByY3VfZGVyZWZlcmVuY2Uoc3JjLT5mZW5jZV9l
eGNsKTsKKwlpZiAobmV3KQorCQluZXcgPSBkbWFfZmVuY2VfZ2V0X3JjdShuZXcpOwogCXJjdV9y
ZWFkX3VubG9jaygpOwogCiAJc3JjX2xpc3QgPSBkbWFfcmVzdl9zaGFyZWRfbGlzdChkc3QpOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2FtZC9hbWRncHUvYW1kZ3B1X2ZlbmNlLmMgYi9k
cml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVfZmVuY2UuYwppbmRleCA3MmQ5YjkyYjE3
NTQ3Li4wYWViNjExN2YzODkzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdw
dS9hbWRncHVfZmVuY2UuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vYW1kL2FtZGdwdS9hbWRncHVf
ZmVuY2UuYwpAQCAtMTYxLDcgKzE2MSw5IEBAIGludCBhbWRncHVfZmVuY2VfZW1pdChzdHJ1Y3Qg
YW1kZ3B1X3JpbmcgKnJpbmcsIHN0cnVjdCBkbWFfZmVuY2UgKipmLAogCQlzdHJ1Y3QgZG1hX2Zl
bmNlICpvbGQ7CiAKIAkJcmN1X3JlYWRfbG9jaygpOwotCQlvbGQgPSBkbWFfZmVuY2VfZ2V0X3Jj
dV9zYWZlKHB0cik7CisJCW9sZCA9IHJjdV9kZXJlZmVyZW5jZSgqcHRyKTsKKwkJaWYgKG9sZCkK
KwkJCW9sZCA9IGRtYV9mZW5jZV9nZXRfcmN1KG9sZCk7CiAJCXJjdV9yZWFkX3VubG9jaygpOwog
CiAJCWlmIChvbGQpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0
aXZlLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5oCmluZGV4IGQwZmVkYTY4
Yjg3NGYuLmJkODljZmM4MDZjYTUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfYWN0aXZlLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaApAQCAt
MTAzLDcgKzEwMyw5IEBAIGk5MTVfYWN0aXZlX2ZlbmNlX2dldChzdHJ1Y3QgaTkxNV9hY3RpdmVf
ZmVuY2UgKmFjdGl2ZSkKIAlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKIAogCXJjdV9yZWFkX2xv
Y2soKTsKLQlmZW5jZSA9IGRtYV9mZW5jZV9nZXRfcmN1X3NhZmUoJmFjdGl2ZS0+ZmVuY2UpOwor
CWZlbmNlID0gcmN1X2RlcmVmZXJlbmNlKGFjdGl2ZS0+ZmVuY2UpOworCWlmIChmZW5jZSkKKwkJ
ZmVuY2UgPSBkbWFfZmVuY2VfZ2V0X3JjdShmZW5jZSk7CiAJcmN1X3JlYWRfdW5sb2NrKCk7CiAK
IAlyZXR1cm4gZmVuY2U7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Zt
YS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwppbmRleCAwZjIyN2YyOGIyODAy
Li5lZDAzODhkOTkxOTdlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Zt
YS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKQEAgLTM1MSw3ICszNTEs
OSBAQCBpbnQgaTkxNV92bWFfd2FpdF9mb3JfYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAkJ
c3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CiAKIAkJcmN1X3JlYWRfbG9jaygpOwotCQlmZW5jZSA9
IGRtYV9mZW5jZV9nZXRfcmN1X3NhZmUoJnZtYS0+YWN0aXZlLmV4Y2wuZmVuY2UpOworCQlmZW5j
ZSA9IHJjdV9kZXJlZmVyZW5jZSh2bWEtPmFjdGl2ZS5leGNsLmZlbmNlKTsKKwkJaWYgKGZlbmNl
KQorCQkJZmVuY2UgPSBkbWFfZmVuY2VfZ2V0X3JjdShmZW5jZSk7CiAJCXJjdV9yZWFkX3VubG9j
aygpOwogCQlpZiAoZmVuY2UpIHsKIAkJCWVyciA9IGRtYV9mZW5jZV93YWl0KGZlbmNlLCBNQVhf
U0NIRURVTEVfVElNRU9VVCk7CmRpZmYgLS1naXQgYS9pbmNsdWRlL2RybS9kcm1fc3luY29iai5o
IGIvaW5jbHVkZS9kcm0vZHJtX3N5bmNvYmouaAppbmRleCA2Y2Y3MjQzYTFkYzVlLi42YzQ1ZDUy
OTg4YmNjIDEwMDY0NAotLS0gYS9pbmNsdWRlL2RybS9kcm1fc3luY29iai5oCisrKyBiL2luY2x1
ZGUvZHJtL2RybV9zeW5jb2JqLmgKQEAgLTEwNSw3ICsxMDUsOSBAQCBkcm1fc3luY29ial9mZW5j
ZV9nZXQoc3RydWN0IGRybV9zeW5jb2JqICpzeW5jb2JqKQogCXN0cnVjdCBkbWFfZmVuY2UgKmZl
bmNlOwogCiAJcmN1X3JlYWRfbG9jaygpOwotCWZlbmNlID0gZG1hX2ZlbmNlX2dldF9yY3Vfc2Fm
ZSgmc3luY29iai0+ZmVuY2UpOworCWZlbmNlID0gcmN1X2RlcmVmZXJlbmNlKHN5bmNvYmotPmZl
bmNlKTsKKwlpZiAoZmVuY2UpCisJCWZlbmNlID0gZG1hX2ZlbmNlX2dldF9yY3Uoc3luY29iai0+
ZmVuY2UpOwogCXJjdV9yZWFkX3VubG9jaygpOwogCiAJcmV0dXJuIGZlbmNlOwpkaWZmIC0tZ2l0
IGEvaW5jbHVkZS9saW51eC9kbWEtZmVuY2UuaCBiL2luY2x1ZGUvbGludXgvZG1hLWZlbmNlLmgK
aW5kZXggNmZmYjRiMmM2MzcxNS4uZjRhMmFiMmIxYWU0NiAxMDA2NDQKLS0tIGEvaW5jbHVkZS9s
aW51eC9kbWEtZmVuY2UuaAorKysgYi9pbmNsdWRlL2xpbnV4L2RtYS1mZW5jZS5oCkBAIC0zMDcs
NTYgKzMwNyw2IEBAIHN0YXRpYyBpbmxpbmUgc3RydWN0IGRtYV9mZW5jZSAqZG1hX2ZlbmNlX2dl
dF9yY3Uoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCiAJCXJldHVybiBOVUxMOwogfQogCi0vKioK
LSAqIGRtYV9mZW5jZV9nZXRfcmN1X3NhZmUgIC0gYWNxdWlyZSBhIHJlZmVyZW5jZSB0byBhbiBS
Q1UgdHJhY2tlZCBmZW5jZQotICogQGZlbmNlcDogcG9pbnRlciB0byBmZW5jZSB0byBpbmNyZWFz
ZSByZWZjb3VudCBvZgotICoKLSAqIEZ1bmN0aW9uIHJldHVybnMgTlVMTCBpZiBubyByZWZjb3Vu
dCBjb3VsZCBiZSBvYnRhaW5lZCwgb3IgdGhlIGZlbmNlLgotICogVGhpcyBmdW5jdGlvbiBoYW5k
bGVzIGFjcXVpcmluZyBhIHJlZmVyZW5jZSB0byBhIGZlbmNlIHRoYXQgbWF5IGJlCi0gKiByZWFs
bG9jYXRlZCB3aXRoaW4gdGhlIFJDVSBncmFjZSBwZXJpb2QgKHN1Y2ggYXMgd2l0aCBTTEFCX1RZ
UEVTQUZFX0JZX1JDVSksCi0gKiBzbyBsb25nIGFzIHRoZSBjYWxsZXIgaXMgdXNpbmcgUkNVIG9u
IHRoZSBwb2ludGVyIHRvIHRoZSBmZW5jZS4KLSAqCi0gKiBBbiBhbHRlcm5hdGl2ZSBtZWNoYW5p
c20gaXMgdG8gZW1wbG95IGEgc2VxbG9jayB0byBwcm90ZWN0IGEgYnVuY2ggb2YKLSAqIGZlbmNl
cywgc3VjaCBhcyB1c2VkIGJ5IHN0cnVjdCBkbWFfcmVzdi4gV2hlbiB1c2luZyBhIHNlcWxvY2ss
Ci0gKiB0aGUgc2VxbG9jayBtdXN0IGJlIHRha2VuIGJlZm9yZSBhbmQgY2hlY2tlZCBhZnRlciBh
IHJlZmVyZW5jZSB0byB0aGUKLSAqIGZlbmNlIGlzIGFjcXVpcmVkIChhcyBzaG93biBoZXJlKS4K
LSAqCi0gKiBUaGUgY2FsbGVyIGlzIHJlcXVpcmVkIHRvIGhvbGQgdGhlIFJDVSByZWFkIGxvY2su
Ci0gKi8KLXN0YXRpYyBpbmxpbmUgc3RydWN0IGRtYV9mZW5jZSAqCi1kbWFfZmVuY2VfZ2V0X3Jj
dV9zYWZlKHN0cnVjdCBkbWFfZmVuY2UgX19yY3UgKipmZW5jZXApCi17Ci0JZG8gewotCQlzdHJ1
Y3QgZG1hX2ZlbmNlICpmZW5jZTsKLQotCQlmZW5jZSA9IHJjdV9kZXJlZmVyZW5jZSgqZmVuY2Vw
KTsKLQkJaWYgKCFmZW5jZSkKLQkJCXJldHVybiBOVUxMOwotCi0JCWlmICghZG1hX2ZlbmNlX2dl
dF9yY3UoZmVuY2UpKQotCQkJY29udGludWU7Ci0KLQkJLyogVGhlIGF0b21pY19pbmNfbm90X3pl
cm8oKSBpbnNpZGUgZG1hX2ZlbmNlX2dldF9yY3UoKQotCQkgKiBwcm92aWRlcyBhIGZ1bGwgbWVt
b3J5IGJhcnJpZXIgdXBvbiBzdWNjZXNzIChzdWNoIGFzIG5vdykuCi0JCSAqIFRoaXMgaXMgcGFp
cmVkIHdpdGggdGhlIHdyaXRlIGJhcnJpZXIgZnJvbSBhc3NpZ25pbmcKLQkJICogdG8gdGhlIF9f
cmN1IHByb3RlY3RlZCBmZW5jZSBwb2ludGVyIHNvIHRoYXQgaWYgdGhhdAotCQkgKiBwb2ludGVy
IHN0aWxsIG1hdGNoZXMgdGhlIGN1cnJlbnQgZmVuY2UsIHdlIGtub3cgd2UKLQkJICogaGF2ZSBz
dWNjZXNzZnVsbHkgYWNxdWlyZSBhIHJlZmVyZW5jZSB0byBpdC4gSWYgaXQgbm8KLQkJICogbG9u
Z2VyIG1hdGNoZXMsIHdlIGFyZSBob2xkaW5nIGEgcmVmZXJlbmNlIHRvIHNvbWUgb3RoZXIKLQkJ
ICogcmVhbGxvY2F0ZWQgcG9pbnRlci4gVGhpcyBpcyBwb3NzaWJsZSBpZiB0aGUgYWxsb2NhdG9y
Ci0JCSAqIGlzIHVzaW5nIGEgZnJlZWxpc3QgbGlrZSBTTEFCX1RZUEVTQUZFX0JZX1JDVSB3aGVy
ZSB0aGUKLQkJICogZmVuY2UgcmVtYWlucyB2YWxpZCBmb3IgdGhlIFJDVSBncmFjZSBwZXJpb2Qs
IGJ1dCBpdAotCQkgKiBtYXkgYmUgcmVhbGxvY2F0ZWQuIFdoZW4gdXNpbmcgc3VjaCBhbGxvY2F0
b3JzLCB3ZSBhcmUKLQkJICogcmVzcG9uc2libGUgZm9yIGVuc3VyaW5nIHRoZSByZWZlcmVuY2Ug
d2UgZ2V0IGlzIHRvCi0JCSAqIHRoZSByaWdodCBmZW5jZSwgYXMgYmVsb3cuCi0JCSAqLwotCQlp
ZiAoZmVuY2UgPT0gcmN1X2FjY2Vzc19wb2ludGVyKCpmZW5jZXApKQotCQkJcmV0dXJuIHJjdV9w
b2ludGVyX2hhbmRvZmYoZmVuY2UpOwotCi0JCWRtYV9mZW5jZV9wdXQoZmVuY2UpOwotCX0gd2hp
bGUgKDEpOwotfQotCiAjaWZkZWYgQ09ORklHX0xPQ0tERVAKIGJvb2wgZG1hX2ZlbmNlX2JlZ2lu
X3NpZ25hbGxpbmcodm9pZCk7CiB2b2lkIGRtYV9mZW5jZV9lbmRfc2lnbmFsbGluZyhib29sIGNv
b2tpZSk7CmRpZmYgLS1naXQgYS9pbmNsdWRlL2xpbnV4L2RtYS1yZXN2LmggYi9pbmNsdWRlL2xp
bnV4L2RtYS1yZXN2LmgKaW5kZXggNTYyYjg4NWNmOWMzZC4uYTM4YzAyMWYzNzlhZiAxMDA2NDQK
LS0tIGEvaW5jbHVkZS9saW51eC9kbWEtcmVzdi5oCisrKyBiL2luY2x1ZGUvbGludXgvZG1hLXJl
c3YuaApAQCAtMjQ4LDcgKzI0OCw5IEBAIGRtYV9yZXN2X2dldF9leGNsX3VubG9ja2VkKHN0cnVj
dCBkbWFfcmVzdiAqb2JqKQogCQlyZXR1cm4gTlVMTDsKIAogCXJjdV9yZWFkX2xvY2soKTsKLQlm
ZW5jZSA9IGRtYV9mZW5jZV9nZXRfcmN1X3NhZmUoJm9iai0+ZmVuY2VfZXhjbCk7CisJZmVuY2Ug
PSByY3VfZGVyZWZlcmVuY2Uob2JqLT5mZW5jZV9leGNsKTsKKwlpZiAoZmVuY2UpCisJCWZlbmNl
ID0gZG1hX2ZlbmNlX2dldF9yY3UoZmVuY2UpOwogCXJjdV9yZWFkX3VubG9jaygpOwogCiAJcmV0
dXJuIGZlbmNlOwotLSAKMi4zMS4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVl
ZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5m
by9pbnRlbC1nZngK

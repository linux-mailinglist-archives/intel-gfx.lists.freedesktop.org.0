Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id E5491DB2B9
	for <lists+intel-gfx@lfdr.de>; Thu, 17 Oct 2019 18:46:32 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 326156E9ED;
	Thu, 17 Oct 2019 16:46:31 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D2E336E9ED
 for <intel-gfx@lists.freedesktop.org>; Thu, 17 Oct 2019 16:46:28 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18872698-1500050 
 for <intel-gfx@lists.freedesktop.org>; Thu, 17 Oct 2019 17:46:24 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 17 Oct 2019 17:46:23 +0100
Message-Id: <20191017164623.29994-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [CI] drm/i915/execlists: Don't merely skip submission
 if maybe timeslicing
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Tm9ybWFsbHksIHdlIHRyeSBhbmQgc2tpcCBzdWJtaXNzaW9uIGlmIEVMU1BbMV0gaXMgZmlsbGVk
LiBIb3dldmVyLCB3ZQptYXkgZGVzaXJlIHRvIGVuYWJsZSB0aW1lc2xpY2luZyBkdWUgdG8gdGhl
IHF1ZXVlIHByaW9yaXR5LCBldmVuIGlmCkVMU1BbMV0gaXRzZWxmIGRvZXMgbm90IHJlcXVpcmUg
dGltZXNsaWNpbmcuIFRoYXQgaXMgdGhlIHF1ZXVlIGlzIGVxdWFsCnByaW9yaXR5IHRvIEVMU1Bb
MF0gYW5kIGhpZ2hlciBwcmlvcml0eSB0aGVuIEVMU1BbMV0uIFByZXZpb3VzbHksIHdlCndvdWxk
IHdhaXQgdW50aWwgdGhlIGNvbnRleHQgc3dpdGNoIHRvIHByZWVtcHQgdGhlIGN1cnJlbnQgRUxT
UFsxXSwgYnV0CndpdGggdGltZXNsaWNpbmcsIHdlIHdhbnQgdG8gcHJlZW1wdCBFTFNQWzBdIGFu
ZCByZXBsYWNlIGl0IHdpdGggdGhlCnF1ZXVlLgoKSW4gd3JpdGluZyB0aGUgdGVzdCBjYXNlLCBp
dCBiZWNvbWUgcXVpY2tseSBhcHBhcmVudCB0aGF0IHdlIHdlcmUgYWxzbwpzdXBwcmVzc2luZyB0
aGUgdGFza2xldCBkdXJpbmcgcHJvbW90aW9uIGFuZCBzbyBmYWlsaW5nIHRvIG5vdGljZSB3aGVu
CnRoZSBxdWV1ZSBzdGFydGVkIHJlcXVpcmluZyB0aW1lc2xpY2luZy4KCkZpeGVzOiAyMjI5YWRj
ODEzODAgKCJkcm0vaTkxNS9leGVjbGlzdDogVHJpbSBpbW1lZGlhdGUgdGltZXNsaWNlIGV4cGly
eSIpClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVr
PgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KLS0tCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyAgICB8ICAyMiArKystCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYyB8IDE2NSArKysrKysrKysrKysrKysrKysrKysr
KystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5jICB8ICAxNyArKy0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmggIHwgIDE4IC0tLQogNCBmaWxlcyBj
aGFuZ2VkLCAxOTMgaW5zZXJ0aW9ucygrKSwgMjkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9scmMuYwppbmRleCBlOWZlOWY3OWNlZGQuLmQwMDg4ZDAyMDIyMCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKQEAgLTM1MiwxMCArMzUyLDE1IEBAIHN0YXRpYyBp
bmxpbmUgYm9vbCBuZWVkX3ByZWVtcHQoY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lLAogCSAqIEhvd2V2ZXIsIHRoZSBwcmlvcml0eSBoaW50IGlzIGEgbWVyZSBoaW50IHRoYXQg
d2UgbWF5IG5lZWQgdG8KIAkgKiBwcmVlbXB0LiBJZiB0aGF0IGhpbnQgaXMgc3RhbGUgb3Igd2Ug
bWF5IGJlIHRyeWluZyB0byBwcmVlbXB0CiAJICogb3Vyc2VsdmVzLCBpZ25vcmUgdGhlIHJlcXVl
c3QuCisJICoKKwkgKiBNb3JlIG5hdHVyYWxseSB3ZSB3b3VsZCB3cml0ZQorCSAqICAgICAgcHJp
byA+PSBtYXgoMCwgbGFzdCk7CisJICogZXhjZXB0IHRoYXQgd2Ugd2lzaCB0byBwcmV2ZW50IHRy
aWdnZXJpbmcgcHJlZW1wdGlvbiBhdCB0aGUgc2FtZQorCSAqIHByaW9yaXR5IGxldmVsOiB0aGUg
dGFzayB0aGF0IGlzIHJ1bm5pbmcgc2hvdWxkIHJlbWFpbiBydW5uaW5nCisJICogdG8gcHJlc2Vy
dmUgRklGTyBvcmRlcmluZyBvZiBkZXBlbmRlbmNpZXMuCiAJICovCi0JbGFzdF9wcmlvID0gZWZm
ZWN0aXZlX3ByaW8ocnEpOwotCWlmICghaTkxNV9zY2hlZHVsZXJfbmVlZF9wcmVlbXB0KGVuZ2lu
ZS0+ZXhlY2xpc3RzLnF1ZXVlX3ByaW9yaXR5X2hpbnQsCi0JCQkJCSBsYXN0X3ByaW8pKQorCWxh
c3RfcHJpbyA9IG1heChlZmZlY3RpdmVfcHJpbyhycSksIEk5MTVfUFJJT1JJVFlfTk9STUFMIC0g
MSk7CisJaWYgKGVuZ2luZS0+ZXhlY2xpc3RzLnF1ZXVlX3ByaW9yaXR5X2hpbnQgPD0gbGFzdF9w
cmlvKQogCQlyZXR1cm4gZmFsc2U7CiAKIAkvKgpAQCAtMTUwOSw4ICsxNTE0LDE3IEBAIHN0YXRp
YyB2b2lkIGV4ZWNsaXN0c19kZXF1ZXVlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkK
IAkJCSAqIHN1Ym1pc3Npb24uCiAJCQkgKi8KIAkJCWlmICghbGlzdF9pc19sYXN0KCZsYXN0LT5z
Y2hlZC5saW5rLAotCQkJCQkgICZlbmdpbmUtPmFjdGl2ZS5yZXF1ZXN0cykpCisJCQkJCSAgJmVu
Z2luZS0+YWN0aXZlLnJlcXVlc3RzKSkgeworCQkJCS8qCisJCQkJICogRXZlbiBpZiBFTFNQWzFd
IGlzIG9jY3VwaWVkIGFuZCBub3Qgd29ydGh5CisJCQkJICogb2YgdGltZXNsaWNlcywgb3VyIHF1
ZXVlIG1pZ2h0IGJlLgorCQkJCSAqLworCQkJCWlmICghZXhlY2xpc3RzLT50aW1lci5leHBpcmVz
ICYmCisJCQkJICAgIG5lZWRfdGltZXNsaWNlKGVuZ2luZSwgbGFzdCkpCisJCQkJCW1vZF90aW1l
cigmZXhlY2xpc3RzLT50aW1lciwKKwkJCQkJCSAgamlmZmllcyArIDEpOwogCQkJCXJldHVybjsK
KwkJCX0KIAogCQkJLyoKIAkJCSAqIFdhSWRsZUxpdGVSZXN0b3JlOmJkdyxza2wKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKaW5kZXggMjg2ODM3MWM2MDllLi43ZTc5YTA1ZTY1
M2YgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCkBAIC0zMjUsNyArMzI1
LDEzIEBAIHNlbWFwaG9yZV9xdWV1ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIHN0
cnVjdCBpOTE1X3ZtYSAqdm1hLCBpbnQgaWR4KQogCWlmIChJU19FUlIocnEpKQogCQlnb3RvIG91
dF9jdHg7CiAKLQllcnIgPSBlbWl0X3NlbWFwaG9yZV9jaGFpbihycSwgdm1hLCBpZHgpOworCWVy
ciA9IDA7CisJaWYgKHJxLT5lbmdpbmUtPmVtaXRfaW5pdF9icmVhZGNydW1iKQorCQllcnIgPSBy
cS0+ZW5naW5lLT5lbWl0X2luaXRfYnJlYWRjcnVtYihycSk7CisJaWYgKGVyciA9PSAwKQorCQll
cnIgPSBlbWl0X3NlbWFwaG9yZV9jaGFpbihycSwgdm1hLCBpZHgpOworCWlmIChlcnIgPT0gMCkK
KwkJaTkxNV9yZXF1ZXN0X2dldChycSk7CiAJaTkxNV9yZXF1ZXN0X2FkZChycSk7CiAJaWYgKGVy
cikKIAkJcnEgPSBFUlJfUFRSKGVycik7CkBAIC0zMzgsMTAgKzM0NCwxMCBAQCBzZW1hcGhvcmVf
cXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBzdHJ1Y3QgaTkxNV92bWEgKnZt
YSwgaW50IGlkeCkKIHN0YXRpYyBpbnQKIHJlbGVhc2VfcXVldWUoc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lLAogCSAgICAgIHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAotCSAgICAgIGludCBp
ZHgpCisJICAgICAgaW50IGlkeCwgaW50IHByaW8pCiB7CiAJc3RydWN0IGk5MTVfc2NoZWRfYXR0
ciBhdHRyID0gewotCQkucHJpb3JpdHkgPSBJOTE1X1VTRVJfUFJJT1JJVFkoSTkxNV9QUklPUklU
WV9NQVgpLAorCQkucHJpb3JpdHkgPSBwcmlvLAogCX07CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnE7CiAJdTMyICpjczsKQEAgLTM2Miw5ICszNjgsMTUgQEAgcmVsZWFzZV9xdWV1ZShzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJKmNzKysgPSAxOwogCiAJaW50ZWxfcmluZ19hZHZh
bmNlKHJxLCBjcyk7CisKKwlpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKIAlpOTE1X3JlcXVlc3RfYWRk
KHJxKTsKIAorCWxvY2FsX2JoX2Rpc2FibGUoKTsKIAllbmdpbmUtPnNjaGVkdWxlKHJxLCAmYXR0
cik7CisJbG9jYWxfYmhfZW5hYmxlKCk7IC8qIGtpY2sgdGFza2xldCAqLworCisJaTkxNV9yZXF1
ZXN0X3B1dChycSk7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTM4Myw3ICszOTUsNiBAQCBzbGljZV9z
ZW1hcGhvcmVfcXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqb3V0ZXIsCiAJaWYgKElTX0VS
UihoZWFkKSkKIAkJcmV0dXJuIFBUUl9FUlIoaGVhZCk7CiAKLQlpOTE1X3JlcXVlc3RfZ2V0KGhl
YWQpOwogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIG91dGVyLT5pOTE1LCBpZCkgewogCQlmb3Ig
KGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CkBA
IC0zOTMsMTAgKzQwNCwxMiBAQCBzbGljZV9zZW1hcGhvcmVfcXVldWUoc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqb3V0ZXIsCiAJCQkJZXJyID0gUFRSX0VSUihycSk7CiAJCQkJZ290byBvdXQ7CiAJ
CQl9CisKKwkJCWk5MTVfcmVxdWVzdF9wdXQocnEpOwogCQl9CiAJfQogCi0JZXJyID0gcmVsZWFz
ZV9xdWV1ZShvdXRlciwgdm1hLCBuKTsKKwllcnIgPSByZWxlYXNlX3F1ZXVlKG91dGVyLCB2bWEs
IG4sIElOVF9NQVgpOwogCWlmIChlcnIpCiAJCWdvdG8gb3V0OwogCkBAIC00ODIsNiArNDk1LDE0
NyBAQCBzdGF0aWMgaW50IGxpdmVfdGltZXNsaWNlX3ByZWVtcHQodm9pZCAqYXJnKQogCXJldHVy
biBlcnI7CiB9CiAKK3N0YXRpYyBpbnQgbm9wX3JlcXVlc3Qoc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lKQoreworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCisJcnEgPSBpOTE1X3Jl
cXVlc3RfY3JlYXRlKGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOworCWlmIChJU19FUlIocnEpKQor
CQlyZXR1cm4gUFRSX0VSUihycSk7CisKKwlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKwlyZXR1cm4g
MDsKK30KKworc3RhdGljIHZvaWQgd2FpdF9mb3Jfc3VibWl0KHN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmVuZ2luZSkKK3sKKwlkbyB7CisJCWNvbmRfcmVzY2hlZCgpOworCQlpbnRlbF9lbmdpbmVf
Zmx1c2hfc3VibWlzc2lvbihlbmdpbmUpOworCX0gd2hpbGUgKFJFQURfT05DRShlbmdpbmUtPmV4
ZWNsaXN0cy5wZW5kaW5nWzBdKSB8fAorCQkgX190YXNrbGV0X2lzX3NjaGVkdWxlZCgmZW5naW5l
LT5leGVjbGlzdHMudGFza2xldCkpOworfQorCitzdGF0aWMgaW50IGxpdmVfdGltZXNsaWNlX3F1
ZXVlKHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOworCXN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5l
OworCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOworCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOworCXZv
aWQgKnZhZGRyOworCWludCBlcnIgPSAwOworCisJLyoKKwkgKiBNYWtlIHN1cmUgdGhhdCBldmVu
IGlmIEVMU1BbMF0gYW5kIEVMU1BbMV0gYXJlIGZpbGxlZCB3aXRoCisJICogdGltZXNsaWNpbmcg
YmV0d2VlbiB0aGVtIGRpc2FibGVkLCB3ZSAqZG8qIGVuYWJsZSB0aW1lc2xpY2luZworCSAqIGlm
IHRoZSBxdWV1ZSBkZW1hbmRzIGl0LiAoTm9ybWFsbHksIHdlIGRvIG5vdCBzdWJtaXQgaWYKKwkg
KiBFTFNQWzFdIGlzIGFscmVhZHkgb2NjdXBpZWQsIHNvIG11c3QgcmVseSBvbiB0aW1lc2xpY2lu
ZyB0bworCSAqIGVqZWN0IEVMU1BbMF0gaW4gZmF2b3VyIG9mIHRoZSBxdWV1ZS4pCisJICovCisK
KwlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGd0LT5pOTE1LCBQQUdFX1NJ
WkUpOworCWlmIChJU19FUlIob2JqKSkKKwkJcmV0dXJuIFBUUl9FUlIob2JqKTsKKworCXZtYSA9
IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgJmd0LT5nZ3R0LT52bSwgTlVMTCk7CisJaWYgKElTX0VS
Uih2bWEpKSB7CisJCWVyciA9IFBUUl9FUlIodm1hKTsKKwkJZ290byBlcnJfb2JqOworCX0KKwor
CXZhZGRyID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAob2JqLCBJOTE1X01BUF9XQyk7CisJaWYg
KElTX0VSUih2YWRkcikpIHsKKwkJZXJyID0gUFRSX0VSUih2YWRkcik7CisJCWdvdG8gZXJyX29i
ajsKKwl9CisKKwllcnIgPSBpOTE1X3ZtYV9waW4odm1hLCAwLCAwLCBQSU5fR0xPQkFMKTsKKwlp
ZiAoZXJyKQorCQlnb3RvIGVycl9tYXA7CisKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndC0+
aTkxNSwgaWQpIHsKKwkJc3RydWN0IGk5MTVfc2NoZWRfYXR0ciBhdHRyID0geworCQkJLnByaW9y
aXR5ID0gSTkxNV9VU0VSX1BSSU9SSVRZKEk5MTVfUFJJT1JJVFlfTUFYKSwKKwkJfTsKKwkJc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnE7CisKKwkJaWYgKCFpbnRlbF9lbmdpbmVfaGFzX3ByZWVtcHRp
b24oZW5naW5lKSkKKwkJCWNvbnRpbnVlOworCisJCW1lbXNldCh2YWRkciwgMCwgUEFHRV9TSVpF
KTsKKworCQkvKiBFTFNQWzBdOiBzZW1hcGhvcmUgd2FpdCAqLworCQlycSA9IHNlbWFwaG9yZV9x
dWV1ZShlbmdpbmUsIHZtYSwgMCk7CisJCWlmIChJU19FUlIocnEpKSB7CisJCQllcnIgPSBQVFJf
RVJSKHJxKTsKKwkJCWdvdG8gZXJyX3BpbjsKKwkJfQorCQllbmdpbmUtPnNjaGVkdWxlKHJxLCAm
YXR0cik7CisJCXdhaXRfZm9yX3N1Ym1pdChlbmdpbmUpOworCisJCS8qIEVMU1BbMV06IG5vcCBy
ZXF1ZXN0ICovCisJCWVyciA9IG5vcF9yZXF1ZXN0KGVuZ2luZSk7CisJCWlmIChlcnIpIHsKKwkJ
CWk5MTVfcmVxdWVzdF9wdXQocnEpOworCQkJZ290byBlcnJfcGluOworCQl9CisJCXdhaXRfZm9y
X3N1Ym1pdChlbmdpbmUpOworCisJCUdFTV9CVUdfT04oaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChy
cSkpOworCQlHRU1fQlVHX09OKGV4ZWNsaXN0c19hY3RpdmUoJmVuZ2luZS0+ZXhlY2xpc3RzKSAh
PSBycSk7CisKKwkJLyogUXVldWU6IHNlbWFwaG9yZSBzaWduYWwsIG1hdGNoaW5nIHByaW9yaXR5
IGFzIHNlbWFwaG9yZSAqLworCQllcnIgPSByZWxlYXNlX3F1ZXVlKGVuZ2luZSwgdm1hLCAxLCBl
ZmZlY3RpdmVfcHJpbyhycSkpOworCQlpZiAoZXJyKSB7CisJCQlpOTE1X3JlcXVlc3RfcHV0KHJx
KTsKKwkJCWdvdG8gZXJyX3BpbjsKKwkJfQorCisJCWludGVsX2VuZ2luZV9mbHVzaF9zdWJtaXNz
aW9uKGVuZ2luZSk7CisJCWlmICghUkVBRF9PTkNFKGVuZ2luZS0+ZXhlY2xpc3RzLnRpbWVyLmV4
cGlyZXMpICYmCisJCSAgICAhaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChycSkpIHsKKwkJCXN0cnVj
dCBkcm1fcHJpbnRlciBwID0KKwkJCQlkcm1faW5mb19wcmludGVyKGd0LT5pOTE1LT5kcm0uZGV2
KTsKKworCQkJR0VNX1RSQUNFX0VSUigiJXM6IEZhaWxlZCB0byBlbmFibGUgdGltZXNsaWNpbmch
XG4iLAorCQkJCSAgICAgIGVuZ2luZS0+bmFtZSk7CisJCQlpbnRlbF9lbmdpbmVfZHVtcChlbmdp
bmUsICZwLAorCQkJCQkgICIlc1xuIiwgZW5naW5lLT5uYW1lKTsKKwkJCUdFTV9UUkFDRV9EVU1Q
KCk7CisKKwkJCW1lbXNldCh2YWRkciwgMHhmZiwgUEFHRV9TSVpFKTsKKwkJCWVyciA9IC1FSU5W
QUw7CisJCX0KKworCQkvKiBUaW1lc2xpY2UgZXZlcnkgamlmZmllLCBzbyB3aXRoaW4gMiB3ZSBz
aG91bGQgc2lnbmFsICovCisJCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChycSwgMCwgMykgPCAwKSB7
CisJCQlzdHJ1Y3QgZHJtX3ByaW50ZXIgcCA9CisJCQkJZHJtX2luZm9fcHJpbnRlcihndC0+aTkx
NS0+ZHJtLmRldik7CisKKwkJCXByX2VycigiJXM6IEZhaWxlZCB0byB0aW1lc2xpY2UgaW50byBx
dWV1ZVxuIiwKKwkJCSAgICAgICBlbmdpbmUtPm5hbWUpOworCQkJaW50ZWxfZW5naW5lX2R1bXAo
ZW5naW5lLCAmcCwKKwkJCQkJICAiJXNcbiIsIGVuZ2luZS0+bmFtZSk7CisKKwkJCW1lbXNldCh2
YWRkciwgMHhmZiwgUEFHRV9TSVpFKTsKKwkJCWVyciA9IC1FSU87CisJCX0KKwkJaTkxNV9yZXF1
ZXN0X3B1dChycSk7CisJCWlmIChlcnIpCisJCQlicmVhazsKKwl9CisKKworZXJyX3BpbjoKKwlp
OTE1X3ZtYV91bnBpbih2bWEpOworZXJyX21hcDoKKwlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFw
KG9iaik7CitlcnJfb2JqOgorCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwlyZXR1cm4gZXJy
OworfQorCiBzdGF0aWMgaW50IGxpdmVfYnVzeXdhaXRfcHJlZW1wdCh2b2lkICphcmcpCiB7CiAJ
c3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKQEAgLTI0MzcsNiArMjU5MSw3IEBAIGludCBpbnRl
bF9leGVjbGlzdHNfbGl2ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
CiAJCVNVQlRFU1QobGl2ZV91bmxpdGVfc3dpdGNoKSwKIAkJU1VCVEVTVChsaXZlX3VubGl0ZV9w
cmVlbXB0KSwKIAkJU1VCVEVTVChsaXZlX3RpbWVzbGljZV9wcmVlbXB0KSwKKwkJU1VCVEVTVChs
aXZlX3RpbWVzbGljZV9xdWV1ZSksCiAJCVNVQlRFU1QobGl2ZV9idXN5d2FpdF9wcmVlbXB0KSwK
IAkJU1VCVEVTVChsaXZlX3ByZWVtcHQpLAogCQlTVUJURVNUKGxpdmVfbGF0ZV9wcmVlbXB0KSwK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5jCmluZGV4IDdiODRlYmNhMjkwMS4uMGNh
NDBmNmJmMDhjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxl
ci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmMKQEAgLTE3Nyw5
ICsxNzcsMjIgQEAgc3RhdGljIGlubGluZSBpbnQgcnFfcHJpbyhjb25zdCBzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpycSkKIAlyZXR1cm4gcnEtPnNjaGVkLmF0dHIucHJpb3JpdHkgfCBfX05PX1BSRUVN
UFRJT047CiB9CiAKK3N0YXRpYyBpbmxpbmUgYm9vbCBuZWVkX3ByZWVtcHQoaW50IHByaW8sIGlu
dCBhY3RpdmUpCit7CisJLyoKKwkgKiBBbGxvdyBwcmVlbXB0aW9uIG9mIGxvdyAtPiBub3JtYWwg
LT4gaGlnaCwgYnV0IHdlIGRvCisJICogbm90IGFsbG93IGxvdyBwcmlvcml0eSB0YXNrcyB0byBw
cmVlbXB0IG90aGVyIGxvdyBwcmlvcml0eQorCSAqIHRhc2tzIHVuZGVyIHRoZSBpbXByZXNzaW9u
IHRoYXQgbGF0ZW5jeSBmb3IgbG93IHByaW9yaXR5CisJICogdGFza3MgZG9lcyBub3QgbWF0dGVy
IChhcyBtdWNoIGFzIGJhY2tncm91bmQgdGhyb3VnaHB1dCksCisJICogc28ga2lzcy4KKwkgKi8K
KwlyZXR1cm4gcHJpbyA+PSBtYXgoSTkxNV9QUklPUklUWV9OT1JNQUwsIGFjdGl2ZSk7Cit9CisK
IHN0YXRpYyB2b2lkIGtpY2tfc3VibWlzc2lvbihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmUsIGludCBwcmlvKQogewotCWNvbnN0IHN0cnVjdCBpOTE1X3JlcXVlc3QgKmluZmxpZ2h0ID0g
KmVuZ2luZS0+ZXhlY2xpc3RzLmFjdGl2ZTsKKwljb25zdCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpp
bmZsaWdodCA9CisJCWV4ZWNsaXN0c19hY3RpdmUoJmVuZ2luZS0+ZXhlY2xpc3RzKTsKIAogCS8q
CiAJICogSWYgd2UgYXJlIGFscmVhZHkgdGhlIGN1cnJlbnRseSBleGVjdXRpbmcgY29udGV4dCwg
ZG9uJ3QKQEAgLTE4OCw3ICsyMDEsNyBAQCBzdGF0aWMgdm9pZCBraWNrX3N1Ym1pc3Npb24oc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBpbnQgcHJpbykKIAkgKiB0YXNrbGV0LCBpLmUu
IHdlIGhhdmUgbm90IGNoYW5nZSB0aGUgcHJpb3JpdHkgcXVldWUKIAkgKiBzdWZmaWNpZW50bHkg
dG8gb3VzdCB0aGUgcnVubmluZyBjb250ZXh0LgogCSAqLwotCWlmICghaW5mbGlnaHQgfHwgIWk5
MTVfc2NoZWR1bGVyX25lZWRfcHJlZW1wdChwcmlvLCBycV9wcmlvKGluZmxpZ2h0KSkpCisJaWYg
KCFpbmZsaWdodCB8fCAhbmVlZF9wcmVlbXB0KHByaW8sIHJxX3ByaW8oaW5mbGlnaHQpKSkKIAkJ
cmV0dXJuOwogCiAJdGFza2xldF9oaV9zY2hlZHVsZSgmZW5naW5lLT5leGVjbGlzdHMudGFza2xl
dCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5oIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIuaAppbmRleCA3ZWVmY2NmZjM5YmYu
LjA3ZDI0M2FjZjU1MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hl
ZHVsZXIuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5oCkBAIC01
MiwyMiArNTIsNCBAQCBzdGF0aWMgaW5saW5lIHZvaWQgaTkxNV9wcmlvbGlzdF9mcmVlKHN0cnVj
dCBpOTE1X3ByaW9saXN0ICpwKQogCQlfX2k5MTVfcHJpb2xpc3RfZnJlZShwKTsKIH0KIAotc3Rh
dGljIGlubGluZSBib29sIGk5MTVfc2NoZWR1bGVyX25lZWRfcHJlZW1wdChpbnQgcHJpbywgaW50
IGFjdGl2ZSkKLXsKLQkvKgotCSAqIEFsbG93IHByZWVtcHRpb24gb2YgbG93IC0+IG5vcm1hbCAt
PiBoaWdoLCBidXQgd2UgZG8KLQkgKiBub3QgYWxsb3cgbG93IHByaW9yaXR5IHRhc2tzIHRvIHBy
ZWVtcHQgb3RoZXIgbG93IHByaW9yaXR5Ci0JICogdGFza3MgdW5kZXIgdGhlIGltcHJlc3Npb24g
dGhhdCBsYXRlbmN5IGZvciBsb3cgcHJpb3JpdHkKLQkgKiB0YXNrcyBkb2VzIG5vdCBtYXR0ZXIg
KGFzIG11Y2ggYXMgYmFja2dyb3VuZCB0aHJvdWdocHV0KSwKLQkgKiBzbyBraXNzLgotCSAqCi0J
ICogTW9yZSBuYXR1cmFsbHkgd2Ugd291bGQgd3JpdGUKLQkgKglwcmlvID49IG1heCgwLCBsYXN0
KTsKLQkgKiBleGNlcHQgdGhhdCB3ZSB3aXNoIHRvIHByZXZlbnQgdHJpZ2dlcmluZyBwcmVlbXB0
aW9uIGF0IHRoZSBzYW1lCi0JICogcHJpb3JpdHkgbGV2ZWw6IHRoZSB0YXNrIHRoYXQgaXMgcnVu
bmluZyBzaG91bGQgcmVtYWluIHJ1bm5pbmcKLQkgKiB0byBwcmVzZXJ2ZSBGSUZPIG9yZGVyaW5n
IG9mIGRlcGVuZGVuY2llcy4KLQkgKi8KLQlyZXR1cm4gcHJpbyA+IG1heChJOTE1X1BSSU9SSVRZ
X05PUk1BTCAtIDEsIGFjdGl2ZSk7Ci19Ci0KICNlbmRpZiAvKiBfSTkxNV9TQ0hFRFVMRVJfSF8g
Ki8KLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Au
b3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwt
Z2Z4

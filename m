Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7EA5E10C52F
	for <lists+intel-gfx@lfdr.de>; Thu, 28 Nov 2019 09:35:04 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5E22C6E750;
	Thu, 28 Nov 2019 08:35:01 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 34BB96E750;
 Thu, 28 Nov 2019 08:34:59 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19370925-1500050 
 for multiple; Thu, 28 Nov 2019 08:34:53 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: igt-dev@lists.freedesktop.org
Date: Thu, 28 Nov 2019 08:34:50 +0000
Message-Id: <20191128083451.3782143-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t 1/2] Remove i915/gem_cpu_reloc
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: intel-gfx@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIHRlc3QgZG9lcyBub3QgZG8gd2hhdCBpcyBvbiB0aGUgdGluIHNpbmNlIHRoZSBrZXJuZWwg
c21hcnRseQpyZXBsYWNlcyB0aGUgc3RhbGxzIHdpdGggZ3B1IHJlbG9jYXRpb25zLCBhbmQgYWxs
IHRoZSB0ZXN0IGlzIHByb3ZpZGluZwppcyBhIHRyaXZpYWwgYW1vdW50IG9mIHN0cmVzcyBiZXlv
bmQgZ2VtX2V4ZWNfcmVsb2MuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNo
cmlzLXdpbHNvbi5jby51az4KLS0tCiB0ZXN0cy9NYWtlZmlsZS5zb3VyY2VzICAgICB8ICAgMyAt
CiB0ZXN0cy9pOTE1L2dlbV9jcHVfcmVsb2MuYyB8IDMwOSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tCiB0ZXN0cy9tZXNvbi5idWlsZCAgICAgICAgICB8ICAgMSAtCiAzIGZp
bGVzIGNoYW5nZWQsIDMxMyBkZWxldGlvbnMoLSkKIGRlbGV0ZSBtb2RlIDEwMDY0NCB0ZXN0cy9p
OTE1L2dlbV9jcHVfcmVsb2MuYwoKZGlmZiAtLWdpdCBhL3Rlc3RzL01ha2VmaWxlLnNvdXJjZXMg
Yi90ZXN0cy9NYWtlZmlsZS5zb3VyY2VzCmluZGV4IGQ4NmY5YzI2My4uYmYxYjk2NzI1IDEwMDY0
NAotLS0gYS90ZXN0cy9NYWtlZmlsZS5zb3VyY2VzCisrKyBiL3Rlc3RzL01ha2VmaWxlLnNvdXJj
ZXMKQEAgLTEyNSw5ICsxMjUsNiBAQCBnZW1fY2xvc2VfcmFjZV9TT1VSQ0VTID0gaTkxNS9nZW1f
Y2xvc2VfcmFjZS5jCiBURVNUU19wcm9ncyArPSBnZW1fY29uY3VycmVudF9ibGl0CiBnZW1fY29u
Y3VycmVudF9ibGl0X1NPVVJDRVMgPSBpOTE1L2dlbV9jb25jdXJyZW50X2JsaXQuYwogCi1URVNU
U19wcm9ncyArPSBnZW1fY3B1X3JlbG9jCi1nZW1fY3B1X3JlbG9jX1NPVVJDRVMgPSBpOTE1L2dl
bV9jcHVfcmVsb2MuYwotCiBURVNUU19wcm9ncyArPSBnZW1fY3JlYXRlCiBnZW1fY3JlYXRlX1NP
VVJDRVMgPSBpOTE1L2dlbV9jcmVhdGUuYwogCmRpZmYgLS1naXQgYS90ZXN0cy9pOTE1L2dlbV9j
cHVfcmVsb2MuYyBiL3Rlc3RzL2k5MTUvZ2VtX2NwdV9yZWxvYy5jCmRlbGV0ZWQgZmlsZSBtb2Rl
IDEwMDY0NAppbmRleCA0NzA5OTg2MjguLjAwMDAwMDAwMAotLS0gYS90ZXN0cy9pOTE1L2dlbV9j
cHVfcmVsb2MuYworKysgL2Rldi9udWxsCkBAIC0xLDMwOSArMCwwIEBACi0vKgotICogQ29weXJp
Z2h0IMKpIDIwMTIgSW50ZWwgQ29ycG9yYXRpb24KLSAqCi0gKiBQZXJtaXNzaW9uIGlzIGhlcmVi
eSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYQotICog
Y29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMg
KHRoZSAiU29mdHdhcmUiKSwKLSAqIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVz
dHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24KLSAqIHRoZSByaWdodHMgdG8g
dXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNl
LAotICogYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBw
ZXJzb25zIHRvIHdob20gdGhlCi0gKiBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1
YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgotICoKLSAqIFRoZSBhYm92ZSBjb3B5
cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIChpbmNsdWRpbmcgdGhlIG5l
eHQKLSAqIHBhcmFncmFwaCkgc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJz
dGFudGlhbCBwb3J0aW9ucyBvZiB0aGUKLSAqIFNvZnR3YXJlLgotICoKLSAqIFRIRSBTT0ZUV0FS
RSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBS
RVNTIE9SCi0gKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJS
QU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKLSAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQ
VVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuICBJTiBOTyBFVkVOVCBTSEFMTAotICogVEhFIEFV
VEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFH
RVMgT1IgT1RIRVIKLSAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJB
Q1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HCi0gKiBGUk9NLCBPVVQgT0YgT1IgSU4gQ09O
TkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTCi0g
KiBJTiBUSEUgU09GVFdBUkUuCi0gKgotICogQXV0aG9yczoKLSAqICAgIENocmlzIFdpbHNvbiA8
Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgotICoKLSAqLwotCi0vKgotICogVGVzdGNhc2U6IFRl
c3QgdGhlIHJlbG9jYXRpb25zIHRocm91Z2ggdGhlIENQVSBkb21haW4KLSAqCi0gKiBBdHRlbXB0
IHRvIHN0cmVzcyB0ZXN0IHBlcmZvcm1pbmcgcmVsb2NhdGlvbnMgd2hpbHN0IHRoZSBiYXRjaCBp
cyBpbiB0aGUKLSAqIENQVSBkb21haW4uCi0gKgotICogQSBmcmVzaGx5IGFsbG9jYXRlZCBidWZm
ZXIgc3RhcnRzIGluIHRoZSBDUFUgZG9tYWluLCBhbmQgdGhlIHB3cml0ZQotICogc2hvdWxkIGFs
c28gYmUgcGVyZm9ybWVkIHdoaWxzdCBpbiB0aGUgQ1BVIGRvbWFpbiBhbmQgc28gd2Ugc2hvdWxk
Ci0gKiBleGVjdXRlIHRoZSByZWxvY2F0aW9ucyB3aXRoaW4gdGhlIENQVSBkb21haW4uIElmIGZv
ciBhbnkgcmVhc29uIG9uZSBvZgotICogdGhvc2Ugc3RlcHMgc2hvdWxkIGxhbmQgaXQgaW4gdGhl
IEdUVCBkb21haW4sIHdlIHRha2UgdGhlIHNlY29uZGFyeQotICogcHJlY2F1dGlvbiBvZiBmaWxs
aW5nIHRoZSBtYXBwYWJsZSBwb3J0aW9uIG9mIHRoZSBHQVRULgotICoKLSAqIEluIG9yZGVyIHRv
IGRldGVjdCB3aGV0aGVyIGEgcmVsb2NhdGlvbiBmYWlscywgd2UgZmlyc3QgZmlsbCBhIHRhcmdl
dAotICogYnVmZmVyIHdpdGggYSBzZXF1ZW5jZSBvZiBpbnZhbGlkIGNvbW1hbmRzIHRoYXQgd291
bGQgY2F1c2UgdGhlIEdQVSB0bwotICogaW1tZWRpYXRlIGhhbmcsIGFuZCB0aGVuIGF0dGVtcHQg
dG8gb3ZlcndyaXRlIHRoZW0gd2l0aCBhIGxlZ2FsLCBpZgotICogc2hvcnQsIGJhdGNoYnVmZmVy
IHVzaW5nIGEgQkxULiBUaGVuIHdlIGNvbWUgdG8gZXhlY3V0ZSB0aGUgYm8sIGlmIHRoZQotICog
cmVsb2NhdGlvbiBmYWlsIGFuZCB3ZSBlaXRoZXIgY29weSBhY3Jvc3MgYWxsIHplcm9zIG9yIGdh
cmJhZ2UsIHRoZW4gdGhlCi0gKiBHUFUgd2lsbCBoYW5nLgotICovCi0KLSNpbmNsdWRlICJpZ3Qu
aCIKLSNpbmNsdWRlIDxzdGRsaWIuaD4KLSNpbmNsdWRlIDxzdGRpby5oPgotI2luY2x1ZGUgPHN0
cmluZy5oPgotI2luY2x1ZGUgPGZjbnRsLmg+Ci0jaW5jbHVkZSA8aW50dHlwZXMuaD4KLSNpbmNs
dWRlIDxlcnJuby5oPgotI2luY2x1ZGUgPHN5cy9zdGF0Lmg+Ci0jaW5jbHVkZSA8c3lzL3RpbWUu
aD4KLQotI2luY2x1ZGUgPGRybS5oPgotCi0jaW5jbHVkZSAiaW50ZWxfYnVmbWdyLmgiCi0KLSNk
ZWZpbmUgTUlfSU5TVFIob3Bjb2RlLCBmbGFncykgKChvcGNvZGUpIDw8IDIzIHwgKGZsYWdzKSkK
LQotSUdUX1RFU1RfREVTQ1JJUFRJT04oIlRlc3QgdGhlIHJlbG9jYXRpb25zIHRocm91Z2ggdGhl
IENQVSBkb21haW4uIik7Ci0KLXN0YXRpYyB1aW50MzJfdCAqCi1nZW4yX2VtaXRfc3RvcmVfYWRk
cih1aW50MzJfdCAqY3MsIHN0cnVjdCBkcm1faTkxNV9nZW1fcmVsb2NhdGlvbl9lbnRyeSAqYWRk
cikKLXsKLQkqY3MrKyA9IE1JX1NUT1JFX0RXT1JEX0lNTSAtIDE7Ci0JYWRkci0+b2Zmc2V0ICs9
IHNpemVvZigqY3MpOwotCWNzICs9IDE7IC8qIGFkZHIgKi8KLQljcyArPSAxOyAvKiB2YWx1ZTog
aW1wbGljaXQgMHhmZmZmZmZmZiAqLwotCXJldHVybiBjczsKLX0KLQotc3RhdGljIHVpbnQzMl90
ICoKLWdlbjRfZW1pdF9zdG9yZV9hZGRyKHVpbnQzMl90ICpjcywgc3RydWN0IGRybV9pOTE1X2dl
bV9yZWxvY2F0aW9uX2VudHJ5ICphZGRyKQotewotCSpjcysrID0gTUlfU1RPUkVfRFdPUkRfSU1N
OwotCSpjcysrID0gMDsKLQlhZGRyLT5vZmZzZXQgKz0gMiAqIHNpemVvZigqY3MpOwotCWNzICs9
IDE7IC8qIGFkZHIgKi8KLQljcyArPSAxOyAvKiB2YWx1ZTogaW1wbGljaXQgMHhmZmZmZmZmZiAq
LwotCXJldHVybiBjczsKLX0KLQotc3RhdGljIHVpbnQzMl90ICoKLWdlbjhfZW1pdF9zdG9yZV9h
ZGRyKHVpbnQzMl90ICpjcywgc3RydWN0IGRybV9pOTE1X2dlbV9yZWxvY2F0aW9uX2VudHJ5ICph
ZGRyKQotewotCSpjcysrID0gKE1JX1NUT1JFX0RXT1JEX0lNTSB8IDEgPDwgMjEpICsgMTsKLQlh
ZGRyLT5vZmZzZXQgKz0gc2l6ZW9mKCpjcyk7Ci0JaWd0X2Fzc2VydCgoYWRkci0+ZGVsdGEgJiA3
KSA9PSAwKTsKLQljcyArPSAyOyAvKiBhZGRyICovCi0JY3MgKz0gMjsgLyogdmFsdWU6IGltcGxp
Y2l0IDB4ZmZmZmZmZmZmZmZmZmZmZiAqLwotCXJldHVybiBjczsKLX0KLQotc3RhdGljIHVpbnQz
Ml90ICoKLWdlbjJfZW1pdF9iYl9zdGFydCh1aW50MzJfdCAqY3MsIHN0cnVjdCBkcm1faTkxNV9n
ZW1fcmVsb2NhdGlvbl9lbnRyeSAqYWRkcikKLXsKLQkqY3MrKyA9IE1JX0JBVENIX0JVRkZFUl9T
VEFSVCB8IDIgPDwgNjsKLQlhZGRyLT5vZmZzZXQgKz0gc2l6ZW9mKCpjcyk7Ci0JYWRkci0+ZGVs
dGEgKz0gMTsKLQljcyArPSAxOyAvKiBhZGRyICovCi0JcmV0dXJuIGNzOwotfQotCi1zdGF0aWMg
dWludDMyX3QgKgotZ2VuNF9lbWl0X2JiX3N0YXJ0KHVpbnQzMl90ICpjcywgc3RydWN0IGRybV9p
OTE1X2dlbV9yZWxvY2F0aW9uX2VudHJ5ICphZGRyKQotewotCSpjcysrID0gTUlfQkFUQ0hfQlVG
RkVSX1NUQVJUIHwgMiA8PCA2IHwgMSA8PCA4OwotCWFkZHItPm9mZnNldCArPSBzaXplb2YoKmNz
KTsKLQljcyArPSAxOyAvKiBhZGRyICovCi0JcmV0dXJuIGNzOwotfQotCi1zdGF0aWMgdWludDMy
X3QgKgotZ2VuNl9lbWl0X2JiX3N0YXJ0KHVpbnQzMl90ICpjcywgc3RydWN0IGRybV9pOTE1X2dl
bV9yZWxvY2F0aW9uX2VudHJ5ICphZGRyKQotewotCSpjcysrID0gTUlfQkFUQ0hfQlVGRkVSX1NU
QVJUIHwgMSA8PCA4OwotCWFkZHItPm9mZnNldCArPSBzaXplb2YoKmNzKTsKLQljcyArPSAxOyAv
KiBhZGRyICovCi0JcmV0dXJuIGNzOwotfQotCi1zdGF0aWMgdWludDMyX3QgKgotaHN3X2VtaXRf
YmJfc3RhcnQodWludDMyX3QgKmNzLCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX3JlbG9jYXRpb25fZW50
cnkgKmFkZHIpCi17Ci0JKmNzKysgPSBNSV9CQVRDSF9CVUZGRVJfU1RBUlQgfCAyIDw8IDYgfCAx
IDw8IDggfCAxIDw8IDEzOwotCWFkZHItPm9mZnNldCArPSBzaXplb2YoKmNzKTsKLQljcyArPSAx
OyAvKiBhZGRyICovCi0JcmV0dXJuIGNzOwotfQotCi1zdGF0aWMgdWludDMyX3QgKgotZ2VuOF9l
bWl0X2JiX3N0YXJ0KHVpbnQzMl90ICpjcywgc3RydWN0IGRybV9pOTE1X2dlbV9yZWxvY2F0aW9u
X2VudHJ5ICphZGRyKQotewotCWlmICgoKHVpbnRwdHJfdCljcyAmIDcpID09IDApIHsKLQkJKmNz
KysgPSBNSV9OT09QOyAvKiBhbGlnbiBhZGRyIGZvciBNSV9TVE9SRV9EV09SRF9JTU0gKi8KLQkJ
YWRkci0+b2Zmc2V0ICs9IHNpemVvZigqY3MpOwotCX0KLQotCSpjcysrID0gTUlfQkFUQ0hfQlVG
RkVSX1NUQVJUICsgMTsKLQlhZGRyLT5vZmZzZXQgKz0gc2l6ZW9mKCpjcyk7Ci0JY3MgKz0gMjsg
LyogYWRkciAqLwotCi0JcmV0dXJuIGNzOwotfQotCi1zdGF0aWMgdm9pZCAqCi1jcmVhdGVfdG1w
bChpbnQgaTkxNSwgc3RydWN0IGRybV9pOTE1X2dlbV9yZWxvY2F0aW9uX2VudHJ5ICpyZWxvYykK
LXsKLQljb25zdCB1aW50MzJfdCBkZXZpZCA9IGludGVsX2dldF9kcm1fZGV2aWQoaTkxNSk7Ci0J
Y29uc3QgaW50IGdlbiA9IGludGVsX2dlbihkZXZpZCk7Ci0JdWludDMyX3QgKigqZW1pdF9zdG9y
ZV9hZGRyKSh1aW50MzJfdCAqY3MsCi0JCQkJICAgc3RydWN0IGRybV9pOTE1X2dlbV9yZWxvY2F0
aW9uX2VudHJ5ICphZGRyKTsKLQl1aW50MzJfdCAqKCplbWl0X2JiX3N0YXJ0KSh1aW50MzJfdCAq
Y3MsCi0JCQkJICAgc3RydWN0IGRybV9pOTE1X2dlbV9yZWxvY2F0aW9uX2VudHJ5ICpyZWxvYyk7
Ci0Jdm9pZCAqdG1wbDsKLQotCWlmIChnZW4gPj0gOCkKLQkJZW1pdF9zdG9yZV9hZGRyID0gZ2Vu
OF9lbWl0X3N0b3JlX2FkZHI7Ci0JZWxzZSBpZiAoZ2VuID49IDQpCi0JCWVtaXRfc3RvcmVfYWRk
ciA9IGdlbjRfZW1pdF9zdG9yZV9hZGRyOwotCWVsc2UKLQkJZW1pdF9zdG9yZV9hZGRyID0gZ2Vu
Ml9lbWl0X3N0b3JlX2FkZHI7Ci0KLQlpZiAoZ2VuID49IDgpCi0JCWVtaXRfYmJfc3RhcnQgPSBn
ZW44X2VtaXRfYmJfc3RhcnQ7Ci0JZWxzZSBpZiAoSVNfSEFTV0VMTChkZXZpZCkpCi0JCWVtaXRf
YmJfc3RhcnQgPSBoc3dfZW1pdF9iYl9zdGFydDsKLQllbHNlIGlmIChnZW4gPj0gNikKLQkJZW1p
dF9iYl9zdGFydCA9IGdlbjZfZW1pdF9iYl9zdGFydDsKLQllbHNlIGlmIChnZW4gPj0gNCkKLQkJ
ZW1pdF9iYl9zdGFydCA9IGdlbjRfZW1pdF9iYl9zdGFydDsKLQllbHNlCi0JCWVtaXRfYmJfc3Rh
cnQgPSBnZW4yX2VtaXRfYmJfc3RhcnQ7Ci0KLQl0bXBsID0gbWFsbG9jKDQwOTYpOwotCWlndF9h
c3NlcnQodG1wbCk7Ci0JbWVtc2V0KHRtcGwsIDB4ZmYsIDQwOTYpOwotCi0JLyogSnVtcCBvdmVy
IHRoZSBib29ieSB0cmFwcyB0byB0aGUgZW5kICovCi0JcmVsb2NbMF0uZGVsdGEgPSA2NDsKLQll
bWl0X2JiX3N0YXJ0KHRtcGwsICZyZWxvY1swXSk7Ci0KLQkvKiBSZXN0b3JlIHRoZSBiYWQgYWRk
cmVzcyB0byBjYXRjaCBtaXNzaW5nIHJlbG9jcyAqLwotCXJlbG9jWzFdLm9mZnNldCA9IDY0Owot
CXJlbG9jWzFdLmRlbHRhID0gcmVsb2NbMF0ub2Zmc2V0OwotCSplbWl0X3N0b3JlX2FkZHIodG1w
bCArIDY0LCAmcmVsb2NbMV0pID0gTUlfQkFUQ0hfQlVGRkVSX0VORDsKLQotCXJldHVybiB0bXBs
OwotfQotCi1zdGF0aWMgdm9pZCBydW5fdGVzdChpbnQgaTkxNSwgaW50IGNvdW50KQotewotCXN0
cnVjdCBkcm1faTkxNV9nZW1fZXhlY2J1ZmZlcjIgZXhlY2J1ZjsKLQlzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX3JlbG9jYXRpb25fZW50cnkgcmVsb2NbMl07Ci0Jc3RydWN0IGRybV9pOTE1X2dlbV9leGVj
X29iamVjdDIgb2JqOwotCi0JdWludDMyX3QgKmhhbmRsZXM7Ci0JdWludDMyX3QgKnRtcGw7Ci0K
LQloYW5kbGVzID0gbWFsbG9jKGNvdW50ICogc2l6ZW9mKHVpbnQzMl90KSk7Ci0JaWd0X2Fzc2Vy
dChoYW5kbGVzKTsKLQotCW1lbXNldChyZWxvYywgMCwgc2l6ZW9mKHJlbG9jKSk7Ci0JdG1wbCA9
IGNyZWF0ZV90bXBsKGk5MTUsIHJlbG9jKTsKLQlmb3IgKGludCBpID0gMDsgaSA8IGNvdW50OyBp
KyspIHsKLQkJaGFuZGxlc1tpXSA9IGdlbV9jcmVhdGUoaTkxNSwgNDA5Nik7Ci0JCWdlbV93cml0
ZShpOTE1LCBoYW5kbGVzW2ldLCAwLCB0bXBsLCA0MDk2KTsKLQl9Ci0JZnJlZSh0bXBsKTsKLQot
CW1lbXNldCgmb2JqLCAwLCBzaXplb2Yob2JqKSk7Ci0Jb2JqLnJlbG9jc19wdHIgPSB0b191c2Vy
X3BvaW50ZXIocmVsb2MpOwotCW9iai5yZWxvY2F0aW9uX2NvdW50ID0gQVJSQVlfU0laRShyZWxv
Yyk7Ci0KLQltZW1zZXQoJmV4ZWNidWYsIDAsIHNpemVvZihleGVjYnVmKSk7Ci0JZXhlY2J1Zi5i
dWZmZXJzX3B0ciA9IHRvX3VzZXJfcG9pbnRlcigmb2JqKTsKLQlleGVjYnVmLmJ1ZmZlcl9jb3Vu
dCA9IDE7Ci0KLQkvKiBmaWxsIHRoZSBlbnRpcmUgZ2FydCB3aXRoIGJhdGNoZXMgYW5kIHJ1biB0
aGVtICovCi0JZm9yIChpbnQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7Ci0JCW9iai5oYW5kbGUg
PSBoYW5kbGVzW2ldOwotCi0JCXJlbG9jWzBdLnRhcmdldF9oYW5kbGUgPSBvYmouaGFuZGxlOwot
CQlyZWxvY1swXS5wcmVzdW1lZF9vZmZzZXQgPSAtMTsKLQkJcmVsb2NbMV0udGFyZ2V0X2hhbmRs
ZSA9IG9iai5oYW5kbGU7Ci0JCXJlbG9jWzFdLnByZXN1bWVkX29mZnNldCA9IC0xOwotCi0JCWdl
bV9leGVjYnVmKGk5MTUsICZleGVjYnVmKTsKLQl9Ci0KLQkvKiBBbmQgYWdhaW4gaW4gcmV2ZXJz
ZSB0byB0cnkgYW5kIGNhdGNoIHRoZSByZWxvY2F0aW9uIGNvZGUgb3V0ICovCi0JZm9yIChpbnQg
aSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7Ci0JCW9iai5oYW5kbGUgPSBoYW5kbGVzW2NvdW50IC0g
aSAtIDFdOwotCi0JCXJlbG9jWzBdLnRhcmdldF9oYW5kbGUgPSBvYmouaGFuZGxlOwotCQlyZWxv
Y1swXS5wcmVzdW1lZF9vZmZzZXQgPSAtMTsKLQkJcmVsb2NbMV0udGFyZ2V0X2hhbmRsZSA9IG9i
ai5oYW5kbGU7Ci0JCXJlbG9jWzFdLnByZXN1bWVkX29mZnNldCA9IC0xOwotCi0JCWdlbV9leGVj
YnVmKGk5MTUsICZleGVjYnVmKTsKLQl9Ci0KLQkvKiBUaGlyZCB0aW1lIHVubHVja3k/ICovCi0J
Zm9yIChpbnQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7Ci0JCW9iai5oYW5kbGUgPSBoYW5kbGVz
W2ldOwotCi0JCXJlbG9jWzBdLnRhcmdldF9oYW5kbGUgPSBvYmouaGFuZGxlOwotCQlyZWxvY1sw
XS5wcmVzdW1lZF9vZmZzZXQgPSAtMTsKLQkJcmVsb2NbMV0udGFyZ2V0X2hhbmRsZSA9IG9iai5o
YW5kbGU7Ci0JCXJlbG9jWzFdLnByZXN1bWVkX29mZnNldCA9IC0xOwotCi0JCWdlbV9zZXRfZG9t
YWluKGk5MTUsIG9iai5oYW5kbGUsCi0JCQkgICAgICAgSTkxNV9HRU1fRE9NQUlOX0NQVSwKLQkJ
CSAgICAgICBJOTE1X0dFTV9ET01BSU5fQ1BVKTsKLQotCQlnZW1fZXhlY2J1ZihpOTE1LCAmZXhl
Y2J1Zik7Ci0JfQotCi0JZm9yIChpbnQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKQotCQlnZW1fY2xv
c2UoaTkxNSwgaGFuZGxlc1tpXSk7Ci0JZnJlZShoYW5kbGVzKTsKLX0KLQotaWd0X21haW4KLXsK
LQlpbnQgaTkxNTsKLQotCWlndF9maXh0dXJlIHsKLQkJaTkxNSA9IGRybV9vcGVuX2RyaXZlcihE
UklWRVJfSU5URUwpOwotCQlpZ3RfcmVxdWlyZV9nZW0oaTkxNSk7Ci0KLQkJLyogY291bGQgdXNl
IEJMVF9GSUxMIGluc3RlYWQgZm9yIGdlbjIgKi8KLQkJaWd0X3JlcXVpcmUoZ2VtX2Nhbl9zdG9y
ZV9kd29yZChpOTE1LCAwKSk7Ci0KLQkJaWd0X2ZvcmtfaGFuZ19kZXRlY3RvcihpOTE1KTsKLQl9
Ci0KLQlpZ3Rfc3VidGVzdCgiYmFzaWMiKQotCQlydW5fdGVzdChpOTE1LCAxKTsKLQotCWlndF9z
dWJ0ZXN0KCJmdWxsIikgewotCQl1aW50NjRfdCBhcGVyX3NpemUgPSBnZW1fbWFwcGFibGVfYXBl
cnR1cmVfc2l6ZSgpOwotCQl1bnNpZ25lZCBsb25nIGNvdW50ID0gYXBlcl9zaXplIC8gNDA5NiAr
IDE7Ci0KLQkJaW50ZWxfcmVxdWlyZV9tZW1vcnkoY291bnQsIDQwOTYsIENIRUNLX1JBTSk7Ci0K
LQkJcnVuX3Rlc3QoaTkxNSwgY291bnQpOwotCX0KLQotCWlndF9zdWJ0ZXN0KCJmb3JrZWQiKSB7
Ci0JCXVpbnQ2NF90IGFwZXJfc2l6ZSA9IGdlbV9tYXBwYWJsZV9hcGVydHVyZV9zaXplKCk7Ci0J
CXVuc2lnbmVkIGxvbmcgY291bnQgPSBhcGVyX3NpemUgLyA0MDk2ICsgMTsKLQkJaW50IG5jcHVz
ID0gc3lzY29uZihfU0NfTlBST0NFU1NPUlNfT05MTik7Ci0KLQkJaW50ZWxfcmVxdWlyZV9tZW1v
cnkoY291bnQsIDQwOTYsIENIRUNLX1JBTSk7Ci0KLQkJaWd0X2ZvcmsoY2hpbGQsIG5jcHVzKQot
CQkJcnVuX3Rlc3QoaTkxNSwgY291bnQgLyBuY3B1cyArIDEpOwotCQlpZ3Rfd2FpdGNoaWxkcmVu
KCk7Ci0JfQotCi0JaWd0X2ZpeHR1cmUgewotCQlpZ3Rfc3RvcF9oYW5nX2RldGVjdG9yKCk7Ci0J
fQotfQpkaWZmIC0tZ2l0IGEvdGVzdHMvbWVzb24uYnVpbGQgYi90ZXN0cy9tZXNvbi5idWlsZApp
bmRleCBhOTA5ZDI3MWUuLjlkZmNmMjA3ZSAxMDA2NDQKLS0tIGEvdGVzdHMvbWVzb24uYnVpbGQK
KysrIGIvdGVzdHMvbWVzb24uYnVpbGQKQEAgLTExMyw3ICsxMTMsNiBAQCBpOTE1X3Byb2dzID0g
WwogCSdnZW1fY2xvc2UnLAogCSdnZW1fY2xvc2VfcmFjZScsCiAJJ2dlbV9jb25jdXJyZW50X2Js
aXQnLAotCSdnZW1fY3B1X3JlbG9jJywKIAknZ2VtX2NzX3ByZWZldGNoJywKIAknZ2VtX2NzX3Rs
YicsCiAJJ2dlbV9jdHhfYmFkX2Rlc3Ryb3knLAotLSAKMi4yNC4wCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0Cklu
dGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

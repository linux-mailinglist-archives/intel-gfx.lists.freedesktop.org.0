Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 54DD8A1354
	for <lists+intel-gfx@lfdr.de>; Thu, 29 Aug 2019 10:12:26 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2D1986E03D;
	Thu, 29 Aug 2019 08:12:19 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4981E89FA0
 for <intel-gfx@lists.freedesktop.org>; Thu, 29 Aug 2019 08:12:03 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18299895-1500050 
 for multiple; Thu, 29 Aug 2019 09:12:00 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 29 Aug 2019 09:11:49 +0100
Message-Id: <20190829081150.10271-36-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190829081150.10271-1-chris@chris-wilson.co.uk>
References: <20190829081150.10271-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 35/36] drm/i915/selftest: Drop vestigal
 struct_mutex guards
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2Ugbm8gbG9uZ2VyIG5lZWQgc3RydWN0X211dGV4IHRvIHNlcmlhbGlzZSByZXF1ZXN0IGVtaXNz
aW9uLCBzbyByZW1vdmUKaXQgZnJvbSB0aGUgZ3Qgc2VsZnRlc3RzLgoKU2lnbmVkLW9mZi1ieTog
Q2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0tLQogLi4uL2dwdS9kcm0v
aTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYyAgIHwgIDE1ICstCiAuLi4vZHJtL2k5MTUv
Z2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMgICAgfCAgIDIgLQogLi4uL2RybS9pOTE1L2dl
bS9zZWxmdGVzdHMvaTkxNV9nZW1fcGh5cy5jICAgIHwgICAyIC0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2xyYy5jICAgICAgICB8IDE0OCArKystLS0tLS0tLS0tLS0tLS0KIC4u
Li9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29ya2Fyb3VuZHMuYyAgICB8ICAxMSArLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvc2VsZnRlc3RfZ3VjLmMgICAgIHwgICA0IC0KIDYgZmls
ZXMgY2hhbmdlZCwgMjcgaW5zZXJ0aW9ucygrKSwgMTU1IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMKaW5kZXggZTA0ZTY3
YjljNTI3Li42MjBiYzU1ZjI2ZGIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9z
ZWxmdGVzdHMvaHVnZV9wYWdlcy5jCkBAIC0xNjQzLDcgKzE2NDMsNiBAQCBpbnQgaTkxNV9nZW1f
aHVnZV9wYWdlX21vY2tfc2VsZnRlc3RzKHZvaWQpCiAJbWt3cml0ZV9kZXZpY2VfaW5mbyhkZXZf
cHJpdiktPnBwZ3R0X3R5cGUgPSBJTlRFTF9QUEdUVF9GVUxMOwogCW1rd3JpdGVfZGV2aWNlX2lu
Zm8oZGV2X3ByaXYpLT5wcGd0dF9zaXplID0gNDg7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAJcHBndHQgPSBpOTE1X3BwZ3R0X2NyZWF0ZShkZXZfcHJpdik7
CiAJaWYgKElTX0VSUihwcGd0dCkpIHsKIAkJZXJyID0gUFRSX0VSUihwcGd0dCk7CkBAIC0xNjY5
LDkgKzE2NjgsNyBAQCBpbnQgaTkxNV9nZW1faHVnZV9wYWdlX21vY2tfc2VsZnRlc3RzKHZvaWQp
CiAJaTkxNV92bV9wdXQoJnBwZ3R0LT52bSk7CiAKIG91dF91bmxvY2s6Ci0JbXV0ZXhfdW5sb2Nr
KCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJZHJtX2Rldl9wdXQoJmRldl9wcml2LT5k
cm0pOwotCiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMTY4Nyw3ICsxNjg0LDYgQEAgaW50IGk5MTVf
Z2VtX2h1Z2VfcGFnZV9saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKIAl9OwogCXN0cnVjdCBkcm1fZmlsZSAqZmlsZTsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqY3R4OwotCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCWludCBlcnI7CiAKIAlpZiAoIUhB
U19QUEdUVChpOTE1KSkgewpAQCAtMTcwMiwxMyArMTY5OCwxMCBAQCBpbnQgaTkxNV9nZW1faHVn
ZV9wYWdlX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCWlm
IChJU19FUlIoZmlsZSkpCiAJCXJldHVybiBQVFJfRVJSKGZpbGUpOwogCi0JbXV0ZXhfbG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0
KCZpOTE1LT5ydW50aW1lX3BtKTsKLQogCWN0eCA9IGxpdmVfY29udGV4dChpOTE1LCBmaWxlKTsK
IAlpZiAoSVNfRVJSKGN0eCkpIHsKIAkJZXJyID0gUFRSX0VSUihjdHgpOwotCQlnb3RvIG91dF91
bmxvY2s7CisJCWdvdG8gb3V0X2ZpbGU7CiAJfQogCiAJaWYgKHJjdV9hY2Nlc3NfcG9pbnRlcihj
dHgtPnZtKSkKQEAgLTE3MTYsMTEgKzE3MDksNyBAQCBpbnQgaTkxNV9nZW1faHVnZV9wYWdlX2xp
dmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCiAJZXJyID0gaTkx
NV9zdWJ0ZXN0cyh0ZXN0cywgY3R4KTsKIAotb3V0X3VubG9jazoKLQlpbnRlbF9ydW50aW1lX3Bt
X3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKLQorb3V0X2ZpbGU6CiAJbW9ja19maWxlX2ZyZWUoaTkxNSwgZmls
ZSk7Ci0KIAlyZXR1cm4gZXJyOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
c2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYwppbmRleCAzODJiNmFlZmVmZWMuLmJhZmZiYzQ4NTY3
OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dl
bV9tbWFuLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dl
bV9tbWFuLmMKQEAgLTQ4MSw5ICs0ODEsNyBAQCBzdGF0aWMgaW50IGlndF9tbWFwX29mZnNldF9l
eGhhdXN0aW9uKHZvaWQgKmFyZykKIAkJCWdvdG8gb3V0OwogCQl9CiAKLQkJbXV0ZXhfbG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWVyciA9IG1ha2Vfb2JqX2J1c3kob2JqKTsKLQkJ
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJaWYgKGVycikgewogCQkJ
cHJfZXJyKCJbbG9vcCAlZF0gRmFpbGVkIHRvIGJ1c3kgdGhlIG9iamVjdFxuIiwgbG9vcCk7CiAJ
CQlnb3RvIGVycl9vYmo7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL2k5MTVfZ2VtX3BoeXMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVz
dHMvaTkxNV9nZW1fcGh5cy5jCmluZGV4IDk0YTE1ZTNmNmRiOC4uMzQ5MzI4NzFiM2E1IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX3BoeXMu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX3BoeXMu
YwpAQCAtMjUsOSArMjUsNyBAQCBzdGF0aWMgaW50IG1vY2tfcGh5c19vYmplY3Qodm9pZCAqYXJn
KQogCQlnb3RvIG91dDsKIAl9CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKIAllcnIgPSBpOTE1X2dlbV9vYmplY3RfYXR0YWNoX3BoeXMob2JqLCBQQUdFX1NJWkUpOwot
CW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKGVycikgewogCQlw
cl9lcnIoImk5MTVfZ2VtX29iamVjdF9hdHRhY2hfcGh5cyBmYWlsZWQsIGVycj0lZFxuIiwgZXJy
KTsKIAkJZ290byBvdXRfb2JqOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwpp
bmRleCBhZTFlZWY2MWRmYmUuLjUwYWUwYWVmNjcyNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfbHJjLmMKQEAgLTI2LDE3ICsyNiwxMyBAQCBzdGF0aWMgaW50IGxpdmVfc2FuaXR5
Y2hlY2sodm9pZCAqYXJnKQogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CiAJc3RydWN0
IGludGVsX2NvbnRleHQgKmNlOwogCXN0cnVjdCBpZ3Rfc3Bpbm5lciBzcGluOwotCWludGVsX3dh
a2VyZWZfdCB3YWtlcmVmOwogCWludCBlcnIgPSAtRU5PTUVNOwogCiAJaWYgKCFIQVNfTE9HSUNB
TF9SSU5HX0NPTlRFWFRTKGk5MTUpKQogCQlyZXR1cm4gMDsKIAotCW11dGV4X2xvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwotCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldCgmaTkx
NS0+cnVudGltZV9wbSk7Ci0KIAlpZiAoaWd0X3NwaW5uZXJfaW5pdCgmc3BpbiwgJmk5MTUtPmd0
KSkKLQkJZ290byBlcnJfdW5sb2NrOworCQlyZXR1cm4gLUVOT01FTTsKIAogCWN0eCA9IGtlcm5l
bF9jb250ZXh0KGk5MTUpOwogCWlmICghY3R4KQpAQCAtNzMsOSArNjksNiBAQCBzdGF0aWMgaW50
IGxpdmVfc2FuaXR5Y2hlY2sodm9pZCAqYXJnKQogCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7
CiBlcnJfc3BpbjoKIAlpZ3Rfc3Bpbm5lcl9maW5pKCZzcGluKTsKLWVycl91bmxvY2s6Ci0JaW50
ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4X3Vu
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMjI0
LDcgKzIxNyw2IEBAIHN0YXRpYyBpbnQgbGl2ZV90aW1lc2xpY2VfcHJlZW1wdCh2b2lkICphcmcp
CiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CiAJc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iajsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAlzdHJ1Y3Qg
aTkxNV92bWEgKnZtYTsKIAl2b2lkICp2YWRkcjsKIAlpbnQgZXJyID0gMDsKQEAgLTIzOSwxNCAr
MjMxLDkgQEAgc3RhdGljIGludCBsaXZlX3RpbWVzbGljZV9wcmVlbXB0KHZvaWQgKmFyZykKIAkg
KiByZWFkeSB0YXNrLgogCSAqLwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsK
LQogCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoaTkxNSwgUEFHRV9TSVpF
KTsKLQlpZiAoSVNfRVJSKG9iaikpIHsKLQkJZXJyID0gUFRSX0VSUihvYmopOwotCQlnb3RvIGVy
cl91bmxvY2s7Ci0JfQorCWlmIChJU19FUlIob2JqKSkKKwkJcmV0dXJuIFBUUl9FUlIob2JqKTsK
IAogCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgJmk5MTUtPmdndHQudm0sIE5VTEwpOwog
CWlmIChJU19FUlIodm1hKSkgewpAQCAtMjkxLDEwICsyNzgsNiBAQCBzdGF0aWMgaW50IGxpdmVf
dGltZXNsaWNlX3ByZWVtcHQodm9pZCAqYXJnKQogCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAo
b2JqKTsKIGVycl9vYmo6CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwotZXJyX3VubG9jazoK
LQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0
ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCXJldHVybiBlcnI7CiB9CiAK
QEAgLTMwNiw3ICsyODksNiBAQCBzdGF0aWMgaW50IGxpdmVfYnVzeXdhaXRfcHJlZW1wdCh2b2lk
ICphcmcpCiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKIAlzdHJ1Y3QgaTkxNV92
bWEgKnZtYTsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKLQlpbnRlbF93YWtlcmVmX3Qgd2Fr
ZXJlZjsKIAlpbnQgZXJyID0gLUVOT01FTTsKIAl1MzIgKm1hcDsKIApAQCAtMzE1LDEyICsyOTcs
OSBAQCBzdGF0aWMgaW50IGxpdmVfYnVzeXdhaXRfcHJlZW1wdCh2b2lkICphcmcpCiAJICogcHJl
ZW1wdCB0aGUgYnVzeXdhaXRzIHVzZWQgdG8gc3luY2hyb25pc2UgYmV0d2VlbiByaW5ncy4KIAkg
Ki8KIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCXdha2VyZWYgPSBp
bnRlbF9ydW50aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7Ci0KIAljdHhfaGkgPSBrZXJu
ZWxfY29udGV4dChpOTE1KTsKIAlpZiAoIWN0eF9oaSkKLQkJZ290byBlcnJfdW5sb2NrOworCQly
ZXR1cm4gLUVOT01FTTsKIAljdHhfaGktPnNjaGVkLnByaW9yaXR5ID0KIAkJSTkxNV9VU0VSX1BS
SU9SSVRZKEk5MTVfQ09OVEVYVF9NQVhfVVNFUl9QUklPUklUWSk7CiAKQEAgLTQ3NCw5ICs0NTMs
NiBAQCBzdGF0aWMgaW50IGxpdmVfYnVzeXdhaXRfcHJlZW1wdCh2b2lkICphcmcpCiAJa2VybmVs
X2NvbnRleHRfY2xvc2UoY3R4X2xvKTsKIGVycl9jdHhfaGk6CiAJa2VybmVsX2NvbnRleHRfY2xv
c2UoY3R4X2hpKTsKLWVycl91bmxvY2s6Ci0JaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1
bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtNTA1LDcgKzQ4MSw2IEBAIHN0YXRpYyBpbnQgbGl2
ZV9wcmVlbXB0KHZvaWQgKmFyZykKIAlzdHJ1Y3QgaWd0X3NwaW5uZXIgc3Bpbl9oaSwgc3Bpbl9s
bzsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJZW51bSBpbnRlbF9lbmdpbmVf
aWQgaWQ7Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJaW50IGVyciA9IC1FTk9NRU07CiAK
IAlpZiAoIUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1QVElPTihpOTE1KSkKQEAgLTUxNCwxMSArNDg5
LDggQEAgc3RhdGljIGludCBsaXZlX3ByZWVtcHQodm9pZCAqYXJnKQogCWlmICghKGk5MTUtPmNh
cHMuc2NoZWR1bGVyICYgSTkxNV9TQ0hFRFVMRVJfQ0FQX1BSRUVNUFRJT04pKQogCQlwcl9lcnIo
IkxvZ2ljYWwgcHJlZW1wdGlvbiBzdXBwb3J0ZWQsIGJ1dCBub3QgZXhwb3NlZFxuIik7CiAKLQlt
dXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVu
dGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCiAJaWYgKGlndF9zcGlubmVyX2luaXQo
JnNwaW5faGksICZpOTE1LT5ndCkpCi0JCWdvdG8gZXJyX3VubG9jazsKKwkJcmV0dXJuIC1FTk9N
RU07CiAKIAlpZiAoaWd0X3NwaW5uZXJfaW5pdCgmc3Bpbl9sbywgJmk5MTUtPmd0KSkKIAkJZ290
byBlcnJfc3Bpbl9oaTsKQEAgLTU5OCw5ICs1NzAsNiBAQCBzdGF0aWMgaW50IGxpdmVfcHJlZW1w
dCh2b2lkICphcmcpCiAJaWd0X3NwaW5uZXJfZmluaSgmc3Bpbl9sbyk7CiBlcnJfc3Bpbl9oaToK
IAlpZ3Rfc3Bpbm5lcl9maW5pKCZzcGluX2hpKTsKLWVycl91bmxvY2s6Ci0JaW50ZWxfcnVudGlt
ZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4X3VubG9jaygmaTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtNjEyLDE3ICs1ODEs
MTMgQEAgc3RhdGljIGludCBsaXZlX2xhdGVfcHJlZW1wdCh2b2lkICphcmcpCiAJc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCXN0cnVjdCBpOTE1X3NjaGVkX2F0dHIgYXR0ciA9IHt9
OwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwotCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwog
CWludCBlcnIgPSAtRU5PTUVNOwogCiAJaWYgKCFIQVNfTE9HSUNBTF9SSU5HX1BSRUVNUFRJT04o
aTkxNSkpCiAJCXJldHVybiAwOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsK
LQogCWlmIChpZ3Rfc3Bpbm5lcl9pbml0KCZzcGluX2hpLCAmaTkxNS0+Z3QpKQotCQlnb3RvIGVy
cl91bmxvY2s7CisJCXJldHVybiAtRU5PTUVNOwogCiAJaWYgKGlndF9zcGlubmVyX2luaXQoJnNw
aW5fbG8sICZpOTE1LT5ndCkpCiAJCWdvdG8gZXJyX3NwaW5faGk7CkBAIC03MDQsOSArNjY5LDYg
QEAgc3RhdGljIGludCBsaXZlX2xhdGVfcHJlZW1wdCh2b2lkICphcmcpCiAJaWd0X3NwaW5uZXJf
ZmluaSgmc3Bpbl9sbyk7CiBlcnJfc3Bpbl9oaToKIAlpZ3Rfc3Bpbm5lcl9maW5pKCZzcGluX2hp
KTsKLWVycl91bmxvY2s6Ci0JaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0s
IHdha2VyZWYpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0
dXJuIGVycjsKIAogZXJyX3dlZGdlZDoKQEAgLTc1MSw3ICs3MTMsNiBAQCBzdGF0aWMgaW50IGxp
dmVfbm9wcmVlbXB0KHZvaWQgKmFyZykKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7
CiAJc3RydWN0IHByZWVtcHRfY2xpZW50IGEsIGI7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7
Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJaW50IGVyciA9IC1FTk9NRU07CiAKIAkvKgpA
QCAtNzYyLDExICs3MjMsOCBAQCBzdGF0aWMgaW50IGxpdmVfbm9wcmVlbXB0KHZvaWQgKmFyZykK
IAlpZiAoIUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1QVElPTihpOTE1KSkKIAkJcmV0dXJuIDA7CiAK
LQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxf
cnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCiAJaWYgKHByZWVtcHRfY2xpZW50
X2luaXQoaTkxNSwgJmEpKQotCQlnb3RvIGVycl91bmxvY2s7CisJCXJldHVybiAtRU5PTUVNOwog
CWlmIChwcmVlbXB0X2NsaWVudF9pbml0KGk5MTUsICZiKSkKIAkJZ290byBlcnJfY2xpZW50X2E7
CiAJYi5jdHgtPnNjaGVkLnByaW9yaXR5ID0gSTkxNV9VU0VSX1BSSU9SSVRZKEk5MTVfUFJJT1JJ
VFlfTUFYKTsKQEAgLTg0MCw5ICs3OTgsNiBAQCBzdGF0aWMgaW50IGxpdmVfbm9wcmVlbXB0KHZv
aWQgKmFyZykKIAlwcmVlbXB0X2NsaWVudF9maW5pKCZiKTsKIGVycl9jbGllbnRfYToKIAlwcmVl
bXB0X2NsaWVudF9maW5pKCZhKTsKLWVycl91bmxvY2s6Ci0JaW50ZWxfcnVudGltZV9wbV9wdXQo
Jmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKIAogZXJyX3dlZGdlZDoKQEAgLTg2Miw3ICs4MTcs
NiBAQCBzdGF0aWMgaW50IGxpdmVfc3VwcHJlc3Nfc2VsZl9wcmVlbXB0KHZvaWQgKmFyZykKIAl9
OwogCXN0cnVjdCBwcmVlbXB0X2NsaWVudCBhLCBiOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlk
OwotCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCWludCBlcnIgPSAtRU5PTUVNOwogCiAJLyoK
QEAgLTg4MSwxMSArODM1LDggQEAgc3RhdGljIGludCBsaXZlX3N1cHByZXNzX3NlbGZfcHJlZW1w
dCh2b2lkICphcmcpCiAJaWYgKGludGVsX3ZncHVfYWN0aXZlKGk5MTUpKQogCQlyZXR1cm4gMDsg
LyogR1ZUIGZvcmNlcyBzaW5nbGUgcG9ydCAmIHJlcXVlc3Qgc3VibWlzc2lvbiAqLwogCi0JbXV0
ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRp
bWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKLQogCWlmIChwcmVlbXB0X2NsaWVudF9pbml0
KGk5MTUsICZhKSkKLQkJZ290byBlcnJfdW5sb2NrOworCQlyZXR1cm4gLUVOT01FTTsKIAlpZiAo
cHJlZW1wdF9jbGllbnRfaW5pdChpOTE1LCAmYikpCiAJCWdvdG8gZXJyX2NsaWVudF9hOwogCkBA
IC05NTYsOSArOTA3LDYgQEAgc3RhdGljIGludCBsaXZlX3N1cHByZXNzX3NlbGZfcHJlZW1wdCh2
b2lkICphcmcpCiAJcHJlZW1wdF9jbGllbnRfZmluaSgmYik7CiBlcnJfY2xpZW50X2E6CiAJcHJl
ZW1wdF9jbGllbnRfZmluaSgmYSk7Ci1lcnJfdW5sb2NrOgotCWludGVsX3J1bnRpbWVfcG1fcHV0
KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CiAKIGVycl93ZWRnZWQ6CkBAIC0xMDI4LDcgKzk3
Niw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9zdXBwcmVzc193YWl0X3ByZWVtcHQodm9pZCAqYXJnKQog
CXN0cnVjdCBwcmVlbXB0X2NsaWVudCBjbGllbnRbNF07CiAJc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwotCWludGVsX3dha2VyZWZfdCB3
YWtlcmVmOwogCWludCBlcnIgPSAtRU5PTUVNOwogCWludCBpOwogCkBAIC0xMDQxLDExICs5ODgs
OCBAQCBzdGF0aWMgaW50IGxpdmVfc3VwcHJlc3Nfd2FpdF9wcmVlbXB0KHZvaWQgKmFyZykKIAlp
ZiAoIUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1QVElPTihpOTE1KSkKIAkJcmV0dXJuIDA7CiAKLQlt
dXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVu
dGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCiAJaWYgKHByZWVtcHRfY2xpZW50X2lu
aXQoaTkxNSwgJmNsaWVudFswXSkpIC8qIEVMU1BbMF0gKi8KLQkJZ290byBlcnJfdW5sb2NrOwor
CQlyZXR1cm4gLUVOT01FTTsKIAlpZiAocHJlZW1wdF9jbGllbnRfaW5pdChpOTE1LCAmY2xpZW50
WzFdKSkgLyogRUxTUFsxXSAqLwogCQlnb3RvIGVycl9jbGllbnRfMDsKIAlpZiAocHJlZW1wdF9j
bGllbnRfaW5pdChpOTE1LCAmY2xpZW50WzJdKSkgLyogaGVhZCBvZiBxdWV1ZSAqLwpAQCAtMTEz
MSw5ICsxMDc1LDYgQEAgc3RhdGljIGludCBsaXZlX3N1cHByZXNzX3dhaXRfcHJlZW1wdCh2b2lk
ICphcmcpCiAJcHJlZW1wdF9jbGllbnRfZmluaSgmY2xpZW50WzFdKTsKIGVycl9jbGllbnRfMDoK
IAlwcmVlbXB0X2NsaWVudF9maW5pKCZjbGllbnRbMF0pOwotZXJyX3VubG9jazoKLQlpbnRlbF9y
dW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4gZXJyOwogCiBlcnJfd2VkZ2VkOgpA
QCAtMTE1MCw3ICsxMDkxLDYgQEAgc3RhdGljIGludCBsaXZlX2NoYWluX3ByZWVtcHQodm9pZCAq
YXJnKQogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAlzdHJ1Y3QgcHJlZW1wdF9j
bGllbnQgaGksIGxvOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwotCWludGVsX3dha2VyZWZf
dCB3YWtlcmVmOwogCWludCBlcnIgPSAtRU5PTUVNOwogCiAJLyoKQEAgLTExNjIsMTEgKzExMDIs
OCBAQCBzdGF0aWMgaW50IGxpdmVfY2hhaW5fcHJlZW1wdCh2b2lkICphcmcpCiAJaWYgKCFIQVNf
TE9HSUNBTF9SSU5HX1BSRUVNUFRJT04oaTkxNSkpCiAJCXJldHVybiAwOwogCi0JbXV0ZXhfbG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1f
Z2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKLQogCWlmIChwcmVlbXB0X2NsaWVudF9pbml0KGk5MTUs
ICZoaSkpCi0JCWdvdG8gZXJyX3VubG9jazsKKwkJcmV0dXJuIC1FTk9NRU07CiAKIAlpZiAocHJl
ZW1wdF9jbGllbnRfaW5pdChpOTE1LCAmbG8pKQogCQlnb3RvIGVycl9jbGllbnRfaGk7CkBAIC0x
Mjc3LDkgKzEyMTQsNiBAQCBzdGF0aWMgaW50IGxpdmVfY2hhaW5fcHJlZW1wdCh2b2lkICphcmcp
CiAJcHJlZW1wdF9jbGllbnRfZmluaSgmbG8pOwogZXJyX2NsaWVudF9oaToKIAlwcmVlbXB0X2Ns
aWVudF9maW5pKCZoaSk7Ci1lcnJfdW5sb2NrOgotCWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1
LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCXJldHVybiBlcnI7CiAKIGVycl93ZWRnZWQ6CkBAIC0xMjk3LDcgKzEyMzEsNiBA
QCBzdGF0aWMgaW50IGxpdmVfcHJlZW1wdF9oYW5nKHZvaWQgKmFyZykKIAlzdHJ1Y3QgaWd0X3Nw
aW5uZXIgc3Bpbl9oaSwgc3Bpbl9sbzsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7
CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJ
aW50IGVyciA9IC1FTk9NRU07CiAKIAlpZiAoIUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1QVElPTihp
OTE1KSkKQEAgLTEzMDYsMTEgKzEyMzksOCBAQCBzdGF0aWMgaW50IGxpdmVfcHJlZW1wdF9oYW5n
KHZvaWQgKmFyZykKIAlpZiAoIWludGVsX2hhc19yZXNldF9lbmdpbmUoaTkxNSkpCiAJCXJldHVy
biAwOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9
IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKLQogCWlmIChpZ3Rfc3Bp
bm5lcl9pbml0KCZzcGluX2hpLCAmaTkxNS0+Z3QpKQotCQlnb3RvIGVycl91bmxvY2s7CisJCXJl
dHVybiAtRU5PTUVNOwogCiAJaWYgKGlndF9zcGlubmVyX2luaXQoJnNwaW5fbG8sICZpOTE1LT5n
dCkpCiAJCWdvdG8gZXJyX3NwaW5faGk7CkBAIC0xNDAyLDkgKzEzMzIsNiBAQCBzdGF0aWMgaW50
IGxpdmVfcHJlZW1wdF9oYW5nKHZvaWQgKmFyZykKIAlpZ3Rfc3Bpbm5lcl9maW5pKCZzcGluX2xv
KTsKIGVycl9zcGluX2hpOgogCWlndF9zcGlubmVyX2ZpbmkoJnNwaW5faGkpOwotZXJyX3VubG9j
azoKLQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0J
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4gZXJyOwogfQog
CkBAIC0xNDk0LDExICsxNDIxLDkgQEAgc3RhdGljIGludCBzbW9rZV9jcmVzY2VuZG9fdGhyZWFk
KHZvaWQgKmFyZykKIAkJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IHNtb2tlX2NvbnRl
eHQoc21va2UpOwogCQlpbnQgZXJyOwogCi0JCW11dGV4X2xvY2soJnNtb2tlLT5pOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIAkJZXJyID0gc21va2Vfc3VibWl0KHNtb2tlLAogCQkJCSAgIGN0eCwg
Y291bnQgJSBJOTE1X1BSSU9SSVRZX01BWCwKIAkJCQkgICBzbW9rZS0+YmF0Y2gpOwotCQltdXRl
eF91bmxvY2soJnNtb2tlLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJaWYgKGVycikKIAkJ
CXJldHVybiBlcnI7CiAKQEAgLTE1MTksOCArMTQ0NCw2IEBAIHN0YXRpYyBpbnQgc21va2VfY3Jl
c2NlbmRvKHN0cnVjdCBwcmVlbXB0X3Ntb2tlICpzbW9rZSwgdW5zaWduZWQgaW50IGZsYWdzKQog
CXVuc2lnbmVkIGxvbmcgY291bnQ7CiAJaW50IGVyciA9IDA7CiAKLQltdXRleF91bmxvY2soJnNt
b2tlLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUs
IHNtb2tlLT5pOTE1LCBpZCkgewogCQlhcmdbaWRdID0gKnNtb2tlOwogCQlhcmdbaWRdLmVuZ2lu
ZSA9IGVuZ2luZTsKQEAgLTE1NTMsOCArMTQ3Niw2IEBAIHN0YXRpYyBpbnQgc21va2VfY3Jlc2Nl
bmRvKHN0cnVjdCBwcmVlbXB0X3Ntb2tlICpzbW9rZSwgdW5zaWduZWQgaW50IGZsYWdzKQogCQlw
dXRfdGFza19zdHJ1Y3QodHNrW2lkXSk7CiAJfQogCi0JbXV0ZXhfbG9jaygmc21va2UtPmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJcHJfaW5mbygiU3VibWl0dGVkICVsdSBjcmVzY2VuZG86
JXggcmVxdWVzdHMgYWNyb3NzICVkIGVuZ2luZXMgYW5kICVkIGNvbnRleHRzXG4iLAogCQljb3Vu
dCwgZmxhZ3MsCiAJCVJVTlRJTUVfSU5GTyhzbW9rZS0+aTkxNSktPm51bV9lbmdpbmVzLCBzbW9r
ZS0+bmNvbnRleHQpOwpAQCAtMTU5Nyw3ICsxNTE4LDYgQEAgc3RhdGljIGludCBsaXZlX3ByZWVt
cHRfc21va2Uodm9pZCAqYXJnKQogCQkubmNvbnRleHQgPSAxMDI0LAogCX07CiAJY29uc3QgdW5z
aWduZWQgaW50IHBoYXNlW10gPSB7IDAsIEJBVENIIH07Ci0JaW50ZWxfd2FrZXJlZl90IHdha2Vy
ZWY7CiAJc3RydWN0IGlndF9saXZlX3Rlc3QgdDsKIAlpbnQgZXJyID0gLUVOT01FTTsKIAl1MzIg
KmNzOwpAQCAtMTYxMiwxMyArMTUzMiwxMCBAQCBzdGF0aWMgaW50IGxpdmVfcHJlZW1wdF9zbW9r
ZSh2b2lkICphcmcpCiAJaWYgKCFzbW9rZS5jb250ZXh0cykKIAkJcmV0dXJuIC1FTk9NRU07CiAK
LQltdXRleF9sb2NrKCZzbW9rZS5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0g
aW50ZWxfcnVudGltZV9wbV9nZXQoJnNtb2tlLmk5MTUtPnJ1bnRpbWVfcG0pOwotCiAJc21va2Uu
YmF0Y2ggPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKHNtb2tlLmk5MTUsIFBBR0Vf
U0laRSk7CiAJaWYgKElTX0VSUihzbW9rZS5iYXRjaCkpIHsKIAkJZXJyID0gUFRSX0VSUihzbW9r
ZS5iYXRjaCk7Ci0JCWdvdG8gZXJyX3VubG9jazsKKwkJZ290byBlcnJfZnJlZTsKIAl9CiAKIAlj
cyA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKHNtb2tlLmJhdGNoLCBJOTE1X01BUF9XQik7CkBA
IC0xNjY1LDkgKzE1ODIsNyBAQCBzdGF0aWMgaW50IGxpdmVfcHJlZW1wdF9zbW9rZSh2b2lkICph
cmcpCiAKIGVycl9iYXRjaDoKIAlpOTE1X2dlbV9vYmplY3RfcHV0KHNtb2tlLmJhdGNoKTsKLWVy
cl91bmxvY2s6Ci0JaW50ZWxfcnVudGltZV9wbV9wdXQoJnNtb2tlLmk5MTUtPnJ1bnRpbWVfcG0s
IHdha2VyZWYpOwotCW11dGV4X3VubG9jaygmc21va2UuaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CitlcnJfZnJlZToKIAlrZnJlZShzbW9rZS5jb250ZXh0cyk7CiAKIAlyZXR1cm4gZXJyOwpAQCAt
MTgwNSwxOSArMTcyMCwxNyBAQCBzdGF0aWMgaW50IGxpdmVfdmlydHVhbF9lbmdpbmUodm9pZCAq
YXJnKQogCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSAmaTkxNS0+Z3Q7CiAJZW51bSBpbnRlbF9lbmdp
bmVfaWQgaWQ7CiAJdW5zaWduZWQgaW50IGNsYXNzLCBpbnN0OwotCWludCBlcnIgPSAtRU5PREVW
OworCWludCBlcnI7CiAKIAlpZiAoVVNFU19HVUNfU1VCTUlTU0lPTihpOTE1KSkKIAkJcmV0dXJu
IDA7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWZvcl9lYWNo
X2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7CiAJCWVyciA9IG5vcF92aXJ0dWFsX2VuZ2luZShp
OTE1LCAmZW5naW5lLCAxLCAxLCAwKTsKIAkJaWYgKGVycikgewogCQkJcHJfZXJyKCJGYWlsZWQg
dG8gd3JhcCBlbmdpbmUgJXM6IGVycj0lZFxuIiwKIAkJCSAgICAgICBlbmdpbmUtPm5hbWUsIGVy
cik7Ci0JCQlnb3RvIG91dF91bmxvY2s7CisJCQlyZXR1cm4gZXJyOwogCQl9CiAJfQogCkBAIC0x
ODM4LDE3ICsxNzUxLDE1IEBAIHN0YXRpYyBpbnQgbGl2ZV92aXJ0dWFsX2VuZ2luZSh2b2lkICph
cmcpCiAJCQllcnIgPSBub3BfdmlydHVhbF9lbmdpbmUoaTkxNSwgc2libGluZ3MsIG5zaWJsaW5n
LAogCQkJCQkJIG4sIDApOwogCQkJaWYgKGVycikKLQkJCQlnb3RvIG91dF91bmxvY2s7CisJCQkJ
cmV0dXJuIGVycjsKIAkJfQogCiAJCWVyciA9IG5vcF92aXJ0dWFsX2VuZ2luZShpOTE1LCBzaWJs
aW5ncywgbnNpYmxpbmcsIG4sIENIQUlOKTsKIAkJaWYgKGVycikKLQkJCWdvdG8gb3V0X3VubG9j
azsKKwkJCXJldHVybiBlcnI7CiAJfQogCi1vdXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JcmV0dXJuIGVycjsKKwlyZXR1cm4gMDsKIH0KIAogc3Rh
dGljIGludCBtYXNrX3ZpcnR1YWxfZW5naW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LApAQCAtMTkyNyw5ICsxODM4LDYgQEAgc3RhdGljIGludCBtYXNrX3ZpcnR1YWxfZW5naW5lKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCX0KIAogCWVyciA9IGlndF9saXZlX3Rlc3Rf
ZW5kKCZ0KTsKLQlpZiAoZXJyKQotCQlnb3RvIG91dDsKLQogb3V0OgogCWlmIChpZ3RfZmx1c2hf
dGVzdChpOTE1KSkKIAkJZXJyID0gLUVJTzsKQEAgLTE5NTIsMTMgKzE4NjAsMTEgQEAgc3RhdGlj
IGludCBsaXZlX3ZpcnR1YWxfbWFzayh2b2lkICphcmcpCiAJc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqc2libGluZ3NbTUFYX0VOR0lORV9JTlNUQU5DRSArIDFdOwogCXN0cnVjdCBpbnRlbF9ndCAq
Z3QgPSAmaTkxNS0+Z3Q7CiAJdW5zaWduZWQgaW50IGNsYXNzLCBpbnN0OwotCWludCBlcnIgPSAw
OworCWludCBlcnI7CiAKIAlpZiAoVVNFU19HVUNfU1VCTUlTU0lPTihpOTE1KSkKIAkJcmV0dXJu
IDA7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWZvciAoY2xh
c3MgPSAwOyBjbGFzcyA8PSBNQVhfRU5HSU5FX0NMQVNTOyBjbGFzcysrKSB7CiAJCXVuc2lnbmVk
IGludCBuc2libGluZzsKIApAQCAtMTk3NCwxMiArMTg4MCwxMCBAQCBzdGF0aWMgaW50IGxpdmVf
dmlydHVhbF9tYXNrKHZvaWQgKmFyZykKIAogCQllcnIgPSBtYXNrX3ZpcnR1YWxfZW5naW5lKGk5
MTUsIHNpYmxpbmdzLCBuc2libGluZyk7CiAJCWlmIChlcnIpCi0JCQlnb3RvIG91dF91bmxvY2s7
CisJCQlyZXR1cm4gZXJyOwogCX0KIAotb3V0X3VubG9jazoKLQltdXRleF91bmxvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwotCXJldHVybiBlcnI7CisJcmV0dXJuIDA7CiB9CiAKIHN0YXRp
YyBpbnQgYm9uZF92aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
QEAgLTIxMzAsMTMgKzIwMzQsMTEgQEAgc3RhdGljIGludCBsaXZlX3ZpcnR1YWxfYm9uZCh2b2lk
ICphcmcpCiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqc2libGluZ3NbTUFYX0VOR0lORV9JTlNU
QU5DRSArIDFdOwogCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSAmaTkxNS0+Z3Q7CiAJdW5zaWduZWQg
aW50IGNsYXNzLCBpbnN0OwotCWludCBlcnIgPSAwOworCWludCBlcnI7CiAKIAlpZiAoVVNFU19H
VUNfU1VCTUlTU0lPTihpOTE1KSkKIAkJcmV0dXJuIDA7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKLQogCWZvciAoY2xhc3MgPSAwOyBjbGFzcyA8PSBNQVhfRU5HSU5F
X0NMQVNTOyBjbGFzcysrKSB7CiAJCWNvbnN0IHN0cnVjdCBwaGFzZSAqcDsKIAkJaW50IG5zaWJs
aW5nOwpAQCAtMjE1OSwxNCArMjA2MSwxMiBAQCBzdGF0aWMgaW50IGxpdmVfdmlydHVhbF9ib25k
KHZvaWQgKmFyZykKIAkJCWlmIChlcnIpIHsKIAkJCQlwcl9lcnIoIiVzKCVzKTogZmFpbGVkIGNs
YXNzPSVkLCBuc2libGluZz0lZCwgZXJyPSVkXG4iLAogCQkJCSAgICAgICBfX2Z1bmNfXywgcC0+
bmFtZSwgY2xhc3MsIG5zaWJsaW5nLCBlcnIpOwotCQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCQly
ZXR1cm4gZXJyOwogCQkJfQogCQl9CiAJfQogCi1vdXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JcmV0dXJuIGVycjsKKwlyZXR1cm4gMDsKIH0KIAog
aW50IGludGVsX2V4ZWNsaXN0c19saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dv
cmthcm91bmRzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5k
cy5jCmluZGV4IDkzOGNhMjA0NzI1ZS4uNWRjM2NiMzc2YTdhIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMKQEAgLTcwNSw5ICs3MDUsNyBAQCBz
dGF0aWMgaW50IGxpdmVfZGlydHlfd2hpdGVsaXN0KHZvaWQgKmFyZykKIAogCXdha2VyZWYgPSBp
bnRlbF9ydW50aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7CiAKLQltdXRleF91bmxvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWZpbGUgPSBtb2NrX2ZpbGUoaTkxNSk7Ci0JbXV0
ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKElTX0VSUihmaWxlKSkgewog
CQllcnIgPSBQVFJfRVJSKGZpbGUpOwogCQlnb3RvIG91dF9ycG07CkBAIC03MjksOSArNzI3LDcg
QEAgc3RhdGljIGludCBsaXZlX2RpcnR5X3doaXRlbGlzdCh2b2lkICphcmcpCiAJfQogCiBvdXRf
ZmlsZToKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCW1vY2tfZmls
ZV9mcmVlKGk5MTUsIGZpbGUpOwotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
Owogb3V0X3JwbToKIAlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2Fr
ZXJlZik7CiAJcmV0dXJuIGVycjsKQEAgLTEyNjUsMTQgKzEyNjEsOSBAQCBpbnQgaW50ZWxfd29y
a2Fyb3VuZHNfbGl2ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJ
CVNVQlRFU1QobGl2ZV9ncHVfcmVzZXRfd29ya2Fyb3VuZHMpLAogCQlTVUJURVNUKGxpdmVfZW5n
aW5lX3Jlc2V0X3dvcmthcm91bmRzKSwKIAl9OwotCWludCBlcnI7CiAKIAlpZiAoaW50ZWxfZ3Rf
aXNfd2VkZ2VkKCZpOTE1LT5ndCkpCiAJCXJldHVybiAwOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7Ci0JZXJyID0gaTkxNV9zdWJ0ZXN0cyh0ZXN0cywgaTkxNSk7Ci0J
bXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQotCXJldHVybiBlcnI7CisJ
cmV0dXJuIGk5MTVfc3VidGVzdHModGVzdHMsIGk5MTUpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvdWMvc2VsZnRlc3RfZ3VjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC91Yy9zZWxmdGVzdF9ndWMuYwppbmRleCBiYmEwZWFmZTFjZGIuLmY5MjdmODUxYWFkZiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvc2VsZnRlc3RfZ3VjLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvc2VsZnRlc3RfZ3VjLmMKQEAgLTExNiw3ICsx
MTYsNiBAQCBzdGF0aWMgaW50IGlndF9ndWNfY2xpZW50cyh2b2lkICphcmdzKQogCWludCBlcnIg
PSAwOwogCiAJR0VNX0JVR19PTighSEFTX0dUX1VDKGRldl9wcml2KSk7Ci0JbXV0ZXhfbG9jaygm
ZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3Bt
X2dldCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0pOwogCiAJZ3VjID0gJmRldl9wcml2LT5ndC51Yy5n
dWM7CkBAIC0xOTAsNyArMTg5LDYgQEAgc3RhdGljIGludCBpZ3RfZ3VjX2NsaWVudHModm9pZCAq
YXJncykKIAlndWNfY2xpZW50c19lbmFibGUoZ3VjKTsKIHVubG9jazoKIAlpbnRlbF9ydW50aW1l
X3BtX3B1dCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4X3VubG9jaygm
ZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CiB9CiAKQEAgLTIwOCw3
ICsyMDYsNiBAQCBzdGF0aWMgaW50IGlndF9ndWNfZG9vcmJlbGxzKHZvaWQgKmFyZykKIAl1MTYg
ZGJfaWQ7CiAKIAlHRU1fQlVHX09OKCFIQVNfR1RfVUMoZGV2X3ByaXYpKTsKLQltdXRleF9sb2Nr
KCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVf
cG1fZ2V0KCZkZXZfcHJpdi0+cnVudGltZV9wbSk7CiAKIAlndWMgPSAmZGV2X3ByaXYtPmd0LnVj
Lmd1YzsKQEAgLTI5OSw3ICsyOTYsNiBAQCBzdGF0aWMgaW50IGlndF9ndWNfZG9vcmJlbGxzKHZv
aWQgKmFyZykKIAkJfQogdW5sb2NrOgogCWludGVsX3J1bnRpbWVfcG1fcHV0KCZkZXZfcHJpdi0+
cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVj
dF9tdXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIAotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0Cklu
dGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

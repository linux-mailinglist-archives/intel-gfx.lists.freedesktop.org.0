Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 418C22D502D
	for <lists+intel-gfx@lfdr.de>; Thu, 10 Dec 2020 02:17:35 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 151F36E21D;
	Thu, 10 Dec 2020 01:17:32 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (unknown [77.68.26.236])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6049A6E1D6
 for <intel-gfx@lists.freedesktop.org>; Thu, 10 Dec 2020 01:17:29 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from build.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 23273762-1500050 
 for multiple; Thu, 10 Dec 2020 01:17:20 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 10 Dec 2020 01:17:20 +0000
Message-Id: <20201210011720.26649-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/gt: Split logical ring contexts from
 execlist submission
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Chris Wilson <chris@chris-wilson.co.uk>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U3BsaXQgdGhlIGRlZmluaXRpb24sIGNvbnN0cnVjdGlvbiBhbmQgdXBkYXRpbmcgb2YgdGhlIExv
Z2ljYWwgUmluZwpDb250ZXh0IGZyb20gdGhlIGV4ZWNsaXN0IHN1Ym1pc3Npb24gaW50ZXJmYWNl
LiBUaGUgTFJDIGlzIHVzZWQgYnkgdGhlCkhXLCBpcnJlc3BlY3RpdmUgb2Ygb3VyIGRpZmZlcmVu
dCBzdWJtaXNzaW9uIGJhY2tlbmRzLgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJp
c0BjaHJpcy13aWxzb24uY28udWs+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUg
ICAgICAgICAgICAgICAgIHwgICAgMSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9nZW44X2Vu
Z2luZV9jcy5jICAgICAgfCAgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9j
b250ZXh0X3NzZXUuYyAgfCAgICAzICstCiAuLi4vZHJtL2k5MTUvZ3QvaW50ZWxfZXhlY2xpc3Rz
X3N1Ym1pc3Npb24uYyAgfCAxNTE0ICstLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2xyYy5jICAgICAgICAgICB8IDE0NDggKysrKysrKysrKysrKwogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmggICAgICAgICAgIHwgIDExNCArCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9leGVjbGlzdHMuYyAgfCAxNzc2ICstLS0tLS0tLS0tLS0t
LS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jICAgICAgICB8IDE4NjUg
KysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX2d1Y19h
ZHMuYyAgICB8ICAgIDIgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfZ3VjX3N1Ym1p
c3Npb24uYyB8ICAgIDQgKy0KIDEwIGZpbGVzIGNoYW5nZWQsIDM0NTUgaW5zZXJ0aW9ucygrKSwg
MzI3NCBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9scmMuYwogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2xyYy5oCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Qvc2VsZnRlc3RfbHJjLmMKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtl
ZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCmluZGV4IGY5ZWY1MTk5YjEyNC4u
ODQ5YzdiM2ZjOTQxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQpAQCAtMTA0LDYgKzEwNCw3IEBAIGd0
LXkgKz0gXAogCWd0L2ludGVsX2d0X3JlcXVlc3RzLm8gXAogCWd0L2ludGVsX2d0dC5vIFwKIAln
dC9pbnRlbF9sbGMubyBcCisJZ3QvaW50ZWxfbHJjLm8gXAogCWd0L2ludGVsX21vY3MubyBcCiAJ
Z3QvaW50ZWxfcHBndHQubyBcCiAJZ3QvaW50ZWxfcmM2Lm8gXApkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvZ2VuOF9lbmdpbmVfY3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2dlbjhfZW5naW5lX2NzLmMKaW5kZXggOWM2ZjBlYmZhM2NmLi4xOTcyZGQ1ZGNhMDAgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2dlbjhfZW5naW5lX2NzLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvZ2VuOF9lbmdpbmVfY3MuYwpAQCAtNSw3ICs1LDcgQEAK
IAogI2luY2x1ZGUgImdlbjhfZW5naW5lX2NzLmgiCiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIKLSNp
bmNsdWRlICJpbnRlbF9leGVjbGlzdHNfc3VibWlzc2lvbi5oIiAvKiBYWFggKi8KKyNpbmNsdWRl
ICJpbnRlbF9scmMuaCIKICNpbmNsdWRlICJpbnRlbF9ncHVfY29tbWFuZHMuaCIKICNpbmNsdWRl
ICJpbnRlbF9yaW5nLmgiCiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2NvbnRleHRfc3NldS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4
dF9zc2V1LmMKaW5kZXggNWY5NGI0NDAyMmRjLi44ZGZkOGY2NTZhYWEgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHRfc3NldS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHRfc3NldS5jCkBAIC04LDggKzgsNyBAQAogI2lu
Y2x1ZGUgImludGVsX2NvbnRleHQuaCIKICNpbmNsdWRlICJpbnRlbF9lbmdpbmVfcG0uaCIKICNp
bmNsdWRlICJpbnRlbF9ncHVfY29tbWFuZHMuaCIKLSNpbmNsdWRlICJpbnRlbF9leGVjbGlzdHNf
c3VibWlzc2lvbi5oIgotI2luY2x1ZGUgImludGVsX2xyY19yZWcuaCIKKyNpbmNsdWRlICJpbnRl
bF9scmMuaCIKICNpbmNsdWRlICJpbnRlbF9yaW5nLmgiCiAjaW5jbHVkZSAiaW50ZWxfc3NldS5o
IgogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9leGVjbGlzdHNf
c3VibWlzc2lvbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZXhlY2xpc3RzX3N1
Ym1pc3Npb24uYwppbmRleCBkY2VjYzI4ODc4OTEuLjNlOTkxODI5YmI5MCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZXhlY2xpc3RzX3N1Ym1pc3Npb24uYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9leGVjbGlzdHNfc3VibWlzc2lvbi5jCkBA
IC0xMDksNyArMTA5LDYgQEAKICNpbmNsdWRlIDxsaW51eC9pbnRlcnJ1cHQuaD4KIAogI2luY2x1
ZGUgImk5MTVfZHJ2LmgiCi0jaW5jbHVkZSAiaTkxNV9wZXJmLmgiCiAjaW5jbHVkZSAiaTkxNV90
cmFjZS5oIgogI2luY2x1ZGUgImk5MTVfdmdwdS5oIgogI2luY2x1ZGUgImdlbjhfZW5naW5lX2Nz
LmgiCkBAIC0xMjAsNiArMTE5LDcgQEAKICNpbmNsdWRlICJpbnRlbF9ndC5oIgogI2luY2x1ZGUg
ImludGVsX2d0X3BtLmgiCiAjaW5jbHVkZSAiaW50ZWxfZ3RfcmVxdWVzdHMuaCIKKyNpbmNsdWRl
ICJpbnRlbF9scmMuaCIKICNpbmNsdWRlICJpbnRlbF9scmNfcmVnLmgiCiAjaW5jbHVkZSAiaW50
ZWxfbW9jcy5oIgogI2luY2x1ZGUgImludGVsX3Jlc2V0LmgiCkBAIC0yMDgsMTMzICsyMDgsNiBA
QCBzdGF0aWMgc3RydWN0IHZpcnR1YWxfZW5naW5lICp0b192aXJ0dWFsX2VuZ2luZShzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiBzdGF0aWMgaW50IF9fZXhlY2xpc3RzX2NvbnRleHRf
YWxsb2Moc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCQkJCSAgICAgc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lKTsKIAotc3RhdGljIHZvaWQgZXhlY2xpc3RzX2luaXRfcmVnX3N0YXRl
KHUzMiAqcmVnX3N0YXRlLAotCQkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX2NvbnRleHQgKmNl
LAotCQkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAotCQkJCSAg
ICAgY29uc3Qgc3RydWN0IGludGVsX3JpbmcgKnJpbmcsCi0JCQkJICAgICBib29sIGNsb3NlKTsK
LXN0YXRpYyB2b2lkCi1fX2V4ZWNsaXN0c191cGRhdGVfcmVnX3N0YXRlKGNvbnN0IHN0cnVjdCBp
bnRlbF9jb250ZXh0ICpjZSwKLQkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lLAotCQkJICAgICB1MzIgaGVhZCk7Ci0KLXN0YXRpYyBpbnQgbHJjX3JpbmdfbWlfbW9k
ZShjb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCi17Ci0JaWYgKElOVEVMX0dF
TihlbmdpbmUtPmk5MTUpID49IDEyKQotCQlyZXR1cm4gMHg2MDsKLQllbHNlIGlmIChJTlRFTF9H
RU4oZW5naW5lLT5pOTE1KSA+PSA5KQotCQlyZXR1cm4gMHg1NDsKLQllbHNlIGlmIChlbmdpbmUt
PmNsYXNzID09IFJFTkRFUl9DTEFTUykKLQkJcmV0dXJuIDB4NTg7Ci0JZWxzZQotCQlyZXR1cm4g
LTE7Ci19Ci0KLXN0YXRpYyBpbnQgbHJjX3JpbmdfZ3ByMChjb25zdCBzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmUpCi17Ci0JaWYgKElOVEVMX0dFTihlbmdpbmUtPmk5MTUpID49IDEyKQot
CQlyZXR1cm4gMHg3NDsKLQllbHNlIGlmIChJTlRFTF9HRU4oZW5naW5lLT5pOTE1KSA+PSA5KQot
CQlyZXR1cm4gMHg2ODsKLQllbHNlIGlmIChlbmdpbmUtPmNsYXNzID09IFJFTkRFUl9DTEFTUykK
LQkJcmV0dXJuIDB4ZDg7Ci0JZWxzZQotCQlyZXR1cm4gLTE7Ci19Ci0KLXN0YXRpYyBpbnQgbHJj
X3Jpbmdfd2FfYmJfcGVyX2N0eChjb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUp
Ci17Ci0JaWYgKElOVEVMX0dFTihlbmdpbmUtPmk5MTUpID49IDEyKQotCQlyZXR1cm4gMHgxMjsK
LQllbHNlIGlmIChJTlRFTF9HRU4oZW5naW5lLT5pOTE1KSA+PSA5IHx8IGVuZ2luZS0+Y2xhc3Mg
PT0gUkVOREVSX0NMQVNTKQotCQlyZXR1cm4gMHgxODsKLQllbHNlCi0JCXJldHVybiAtMTsKLX0K
LQotc3RhdGljIGludCBscmNfcmluZ19pbmRpcmVjdF9wdHIoY29uc3Qgc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lKQotewotCWludCB4OwotCi0JeCA9IGxyY19yaW5nX3dhX2JiX3Blcl9j
dHgoZW5naW5lKTsKLQlpZiAoeCA8IDApCi0JCXJldHVybiB4OwotCi0JcmV0dXJuIHggKyAyOwot
fQotCi1zdGF0aWMgaW50IGxyY19yaW5nX2luZGlyZWN0X29mZnNldChjb25zdCBzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUpCi17Ci0JaW50IHg7Ci0KLQl4ID0gbHJjX3JpbmdfaW5kaXJl
Y3RfcHRyKGVuZ2luZSk7Ci0JaWYgKHggPCAwKQotCQlyZXR1cm4geDsKLQotCXJldHVybiB4ICsg
MjsKLX0KLQotc3RhdGljIGludCBscmNfcmluZ19jbWRfYnVmX2NjdGwoY29uc3Qgc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqZW5naW5lKQotewotCWlmIChlbmdpbmUtPmNsYXNzICE9IFJFTkRFUl9D
TEFTUykKLQkJcmV0dXJuIC0xOwotCi0JaWYgKElOVEVMX0dFTihlbmdpbmUtPmk5MTUpID49IDEy
KQotCQlyZXR1cm4gMHhiNjsKLQllbHNlIGlmIChJTlRFTF9HRU4oZW5naW5lLT5pOTE1KSA+PSAx
MSkKLQkJcmV0dXJuIDB4YWE7Ci0JZWxzZQotCQlyZXR1cm4gLTE7Ci19Ci0KLXN0YXRpYyB1MzIK
LWxyY19yaW5nX2luZGlyZWN0X29mZnNldF9kZWZhdWx0KGNvbnN0IHN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZSkKLXsKLQlzd2l0Y2ggKElOVEVMX0dFTihlbmdpbmUtPmk5MTUpKSB7Ci0J
ZGVmYXVsdDoKLQkJTUlTU0lOR19DQVNFKElOVEVMX0dFTihlbmdpbmUtPmk5MTUpKTsKLQkJZmFs
bHRocm91Z2g7Ci0JY2FzZSAxMjoKLQkJcmV0dXJuIEdFTjEyX0NUWF9SQ1NfSU5ESVJFQ1RfQ1RY
X09GRlNFVF9ERUZBVUxUOwotCWNhc2UgMTE6Ci0JCXJldHVybiBHRU4xMV9DVFhfUkNTX0lORElS
RUNUX0NUWF9PRkZTRVRfREVGQVVMVDsKLQljYXNlIDEwOgotCQlyZXR1cm4gR0VOMTBfQ1RYX1JD
U19JTkRJUkVDVF9DVFhfT0ZGU0VUX0RFRkFVTFQ7Ci0JY2FzZSA5OgotCQlyZXR1cm4gR0VOOV9D
VFhfUkNTX0lORElSRUNUX0NUWF9PRkZTRVRfREVGQVVMVDsKLQljYXNlIDg6Ci0JCXJldHVybiBH
RU44X0NUWF9SQ1NfSU5ESVJFQ1RfQ1RYX09GRlNFVF9ERUZBVUxUOwotCX0KLX0KLQotc3RhdGlj
IHZvaWQKLWxyY19yaW5nX3NldHVwX2luZGlyZWN0X2N0eCh1MzIgKnJlZ3MsCi0JCQkgICAgY29u
c3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAotCQkJICAgIHUzMiBjdHhfYmJfZ2d0
dF9hZGRyLAotCQkJICAgIHUzMiBzaXplKQotewotCUdFTV9CVUdfT04oIXNpemUpOwotCUdFTV9C
VUdfT04oIUlTX0FMSUdORUQoc2l6ZSwgQ0FDSEVMSU5FX0JZVEVTKSk7Ci0JR0VNX0JVR19PTihs
cmNfcmluZ19pbmRpcmVjdF9wdHIoZW5naW5lKSA9PSAtMSk7Ci0JcmVnc1tscmNfcmluZ19pbmRp
cmVjdF9wdHIoZW5naW5lKSArIDFdID0KLQkJY3R4X2JiX2dndHRfYWRkciB8IChzaXplIC8gQ0FD
SEVMSU5FX0JZVEVTKTsKLQotCUdFTV9CVUdfT04obHJjX3JpbmdfaW5kaXJlY3Rfb2Zmc2V0KGVu
Z2luZSkgPT0gLTEpOwotCXJlZ3NbbHJjX3JpbmdfaW5kaXJlY3Rfb2Zmc2V0KGVuZ2luZSkgKyAx
XSA9Ci0JCWxyY19yaW5nX2luZGlyZWN0X29mZnNldF9kZWZhdWx0KGVuZ2luZSkgPDwgNjsKLX0K
LQotc3RhdGljIHUzMiBpbnRlbF9jb250ZXh0X2dldF9ydW50aW1lKGNvbnN0IHN0cnVjdCBpbnRl
bF9jb250ZXh0ICpjZSkKLXsKLQkvKgotCSAqIFdlIGNhbiB1c2UgZWl0aGVyIHBwSFdTUFsxNl0g
d2hpY2ggaXMgcmVjb3JkZWQgYmVmb3JlIHRoZSBjb250ZXh0Ci0JICogc3dpdGNoIChhbmQgc28g
ZXhjbHVkZXMgdGhlIGNvc3Qgb2YgY29udGV4dCBzd2l0Y2hlcykgb3IgdXNlIHRoZQotCSAqIHZh
bHVlIGZyb20gdGhlIGNvbnRleHQgaW1hZ2UgaXRzZWxmLCB3aGljaCBpcyBzYXZlZC9yZXN0b3Jl
ZCBlYXJsaWVyCi0JICogYW5kIHNvIGluY2x1ZGVzIHRoZSBjb3N0IG9mIHRoZSBzYXZlLgotCSAq
LwotCXJldHVybiBSRUFEX09OQ0UoY2UtPmxyY19yZWdfc3RhdGVbQ1RYX1RJTUVTVEFNUF0pOwot
fQotCiBzdGF0aWMgdm9pZCBtYXJrX2VpbyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKIAlp
ZiAoaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChycSkpCkBAIC01MTMsNTY4ICszODYsNiBAQCBhc3Nl
cnRfcHJpb3JpdHlfcXVldWUoY29uc3Qgc3RydWN0IGk5MTVfcmVxdWVzdCAqcHJldiwKIAlyZXR1
cm4gcnFfcHJpbyhwcmV2KSA+PSBycV9wcmlvKG5leHQpOwogfQogCi0vKgotICogVGhlIGNvbnRl
eHQgZGVzY3JpcHRvciBlbmNvZGVzIHZhcmlvdXMgYXR0cmlidXRlcyBvZiBhIGNvbnRleHQsCi0g
KiBpbmNsdWRpbmcgaXRzIEdUVCBhZGRyZXNzIGFuZCBzb21lIGZsYWdzLiBCZWNhdXNlIGl0J3Mg
ZmFpcmx5Ci0gKiBleHBlbnNpdmUgdG8gY2FsY3VsYXRlLCB3ZSdsbCBqdXN0IGRvIGl0IG9uY2Ug
YW5kIGNhY2hlIHRoZSByZXN1bHQsCi0gKiB3aGljaCByZW1haW5zIHZhbGlkIHVudGlsIHRoZSBj
b250ZXh0IGlzIHVucGlubmVkLgotICoKLSAqIFRoaXMgaXMgd2hhdCBhIGRlc2NyaXB0b3IgbG9v
a3MgbGlrZSwgZnJvbSBMU0IgdG8gTVNCOjoKLSAqCi0gKiAgICAgIGJpdHMgIDAtMTE6ICAgIGZs
YWdzLCBHRU44X0NUWF8qIChjYWNoZWQgaW4gY3R4LT5kZXNjX3RlbXBsYXRlKQotICogICAgICBi
aXRzIDEyLTMxOiAgICBMUkNBLCBHVFQgYWRkcmVzcyBvZiAodGhlIEhXU1Agb2YpIHRoaXMgY29u
dGV4dAotICogICAgICBiaXRzIDMyLTUyOiAgICBjdHggSUQsIGEgZ2xvYmFsbHkgdW5pcXVlIHRh
ZyAoaGlnaGVzdCBiaXQgdXNlZCBieSBHdUMpCi0gKiAgICAgIGJpdHMgNTMtNTQ6ICAgIG1ieiwg
cmVzZXJ2ZWQgZm9yIHVzZSBieSBoYXJkd2FyZQotICogICAgICBiaXRzIDU1LTYzOiAgICBncm91
cCBJRCwgY3VycmVudGx5IHVudXNlZCBhbmQgc2V0IHRvIDAKLSAqCi0gKiBTdGFydGluZyBmcm9t
IEdlbjExLCB0aGUgdXBwZXIgZHdvcmQgb2YgdGhlIGRlc2NyaXB0b3IgaGFzIGEgbmV3IGZvcm1h
dDoKLSAqCi0gKiAgICAgIGJpdHMgMzItMzY6ICAgIHJlc2VydmVkCi0gKiAgICAgIGJpdHMgMzct
NDc6ICAgIFNXIGNvbnRleHQgSUQKLSAqICAgICAgYml0cyA0ODo1MzogICAgZW5naW5lIGluc3Rh
bmNlCi0gKiAgICAgIGJpdCA1NDogICAgICAgIG1ieiwgcmVzZXJ2ZWQgZm9yIHVzZSBieSBoYXJk
d2FyZQotICogICAgICBiaXRzIDU1LTYwOiAgICBTVyBjb3VudGVyCi0gKiAgICAgIGJpdHMgNjEt
NjM6ICAgIGVuZ2luZSBjbGFzcwotICoKLSAqIGVuZ2luZSBpbmZvLCBTVyBjb250ZXh0IElEIGFu
ZCBTVyBjb3VudGVyIG5lZWQgdG8gZm9ybSBhIHVuaXF1ZSBudW1iZXIKLSAqIChDb250ZXh0IElE
KSBwZXIgbHJjLgotICovCi1zdGF0aWMgdTMyCi1scmNfZGVzY3JpcHRvcihzdHJ1Y3QgaW50ZWxf
Y29udGV4dCAqY2UsIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKLXsKLQl1MzIgZGVz
YzsKLQotCWRlc2MgPSBJTlRFTF9MRUdBQ1lfMzJCX0NPTlRFWFQ7Ci0JaWYgKGk5MTVfdm1faXNf
NGx2bChjZS0+dm0pKQotCQlkZXNjID0gSU5URUxfTEVHQUNZXzY0Ql9DT05URVhUOwotCWRlc2Mg
PDw9IEdFTjhfQ1RYX0FERFJFU1NJTkdfTU9ERV9TSElGVDsKLQotCWRlc2MgfD0gR0VOOF9DVFhf
VkFMSUQgfCBHRU44X0NUWF9QUklWSUxFR0U7Ci0JaWYgKElTX0dFTihlbmdpbmUtPmk5MTUsIDgp
KQotCQlkZXNjIHw9IEdFTjhfQ1RYX0wzTExDX0NPSEVSRU5UOwotCi0JcmV0dXJuIGk5MTVfZ2d0
dF9vZmZzZXQoY2UtPnN0YXRlKSB8IGRlc2M7Ci19Ci0KLXN0YXRpYyBpbmxpbmUgdW5zaWduZWQg
aW50IGR3b3JkX2luX3BhZ2Uodm9pZCAqYWRkcikKLXsKLQlyZXR1cm4gb2Zmc2V0X2luX3BhZ2Uo
YWRkcikgLyBzaXplb2YodTMyKTsKLX0KLQotc3RhdGljIHZvaWQgc2V0X29mZnNldHModTMyICpy
ZWdzLAotCQkJY29uc3QgdTggKmRhdGEsCi0JCQljb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmUsCi0JCQlib29sIGNsZWFyKQotI2RlZmluZSBOT1AoeCkgKEJJVCg3KSB8ICh4KSkK
LSNkZWZpbmUgTFJJKGNvdW50LCBmbGFncykgKChmbGFncykgPDwgNiB8IChjb3VudCkgfCBCVUlM
RF9CVUdfT05fWkVSTyhjb3VudCA+PSBCSVQoNikpKQotI2RlZmluZSBQT1NURUQgQklUKDApCi0j
ZGVmaW5lIFJFRyh4KSAoKCh4KSA+PiAyKSB8IEJVSUxEX0JVR19PTl9aRVJPKHggPj0gMHgyMDAp
KQotI2RlZmluZSBSRUcxNih4KSBcCi0JKCgoeCkgPj4gOSkgfCBCSVQoNykgfCBCVUlMRF9CVUdf
T05fWkVSTyh4ID49IDB4MTAwMDApKSwgXAotCSgoKHgpID4+IDIpICYgMHg3ZikKLSNkZWZpbmUg
RU5EKHRvdGFsX3N0YXRlX3NpemUpIDAsICh0b3RhbF9zdGF0ZV9zaXplKQotewotCWNvbnN0IHUz
MiBiYXNlID0gZW5naW5lLT5tbWlvX2Jhc2U7Ci0KLQl3aGlsZSAoKmRhdGEpIHsKLQkJdTggY291
bnQsIGZsYWdzOwotCi0JCWlmICgqZGF0YSAmIEJJVCg3KSkgeyAvKiBza2lwICovCi0JCQljb3Vu
dCA9ICpkYXRhKysgJiB+QklUKDcpOwotCQkJaWYgKGNsZWFyKQotCQkJCW1lbXNldDMyKHJlZ3Ms
IE1JX05PT1AsIGNvdW50KTsKLQkJCXJlZ3MgKz0gY291bnQ7Ci0JCQljb250aW51ZTsKLQkJfQot
Ci0JCWNvdW50ID0gKmRhdGEgJiAweDNmOwotCQlmbGFncyA9ICpkYXRhID4+IDY7Ci0JCWRhdGEr
KzsKLQotCQkqcmVncyA9IE1JX0xPQURfUkVHSVNURVJfSU1NKGNvdW50KTsKLQkJaWYgKGZsYWdz
ICYgUE9TVEVEKQotCQkJKnJlZ3MgfD0gTUlfTFJJX0ZPUkNFX1BPU1RFRDsKLQkJaWYgKElOVEVM
X0dFTihlbmdpbmUtPmk5MTUpID49IDExKQotCQkJKnJlZ3MgfD0gTUlfTFJJX0xSTV9DU19NTUlP
OwotCQlyZWdzKys7Ci0KLQkJR0VNX0JVR19PTighY291bnQpOwotCQlkbyB7Ci0JCQl1MzIgb2Zm
c2V0ID0gMDsKLQkJCXU4IHY7Ci0KLQkJCWRvIHsKLQkJCQl2ID0gKmRhdGErKzsKLQkJCQlvZmZz
ZXQgPDw9IDc7Ci0JCQkJb2Zmc2V0IHw9IHYgJiB+QklUKDcpOwotCQkJfSB3aGlsZSAodiAmIEJJ
VCg3KSk7Ci0KLQkJCXJlZ3NbMF0gPSBiYXNlICsgKG9mZnNldCA8PCAyKTsKLQkJCWlmIChjbGVh
cikKLQkJCQlyZWdzWzFdID0gMDsKLQkJCXJlZ3MgKz0gMjsKLQkJfSB3aGlsZSAoLS1jb3VudCk7
Ci0JfQotCi0JaWYgKGNsZWFyKSB7Ci0JCXU4IGNvdW50ID0gKisrZGF0YTsKLQotCQkvKiBDbGVh
ciBwYXN0IHRoZSB0YWlsIGZvciBIVyBhY2Nlc3MgKi8KLQkJR0VNX0JVR19PTihkd29yZF9pbl9w
YWdlKHJlZ3MpID4gY291bnQpOwotCQltZW1zZXQzMihyZWdzLCBNSV9OT09QLCBjb3VudCAtIGR3
b3JkX2luX3BhZ2UocmVncykpOwotCi0JCS8qIENsb3NlIHRoZSBiYXRjaDsgdXNlZCBtYWlubHkg
YnkgbGl2ZV9scmNfbGF5b3V0KCkgKi8KLQkJKnJlZ3MgPSBNSV9CQVRDSF9CVUZGRVJfRU5EOwot
CQlpZiAoSU5URUxfR0VOKGVuZ2luZS0+aTkxNSkgPj0gMTApCi0JCQkqcmVncyB8PSBCSVQoMCk7
Ci0JfQotfQotCi1zdGF0aWMgY29uc3QgdTggZ2VuOF94Y3Nfb2Zmc2V0c1tdID0gewotCU5PUCgx
KSwKLQlMUkkoMTEsIDApLAotCVJFRzE2KDB4MjQ0KSwKLQlSRUcoMHgwMzQpLAotCVJFRygweDAz
MCksCi0JUkVHKDB4MDM4KSwKLQlSRUcoMHgwM2MpLAotCVJFRygweDE2OCksCi0JUkVHKDB4MTQw
KSwKLQlSRUcoMHgxMTApLAotCVJFRygweDExYyksCi0JUkVHKDB4MTE0KSwKLQlSRUcoMHgxMTgp
LAotCi0JTk9QKDkpLAotCUxSSSg5LCAwKSwKLQlSRUcxNigweDNhOCksCi0JUkVHMTYoMHgyOGMp
LAotCVJFRzE2KDB4Mjg4KSwKLQlSRUcxNigweDI4NCksCi0JUkVHMTYoMHgyODApLAotCVJFRzE2
KDB4MjdjKSwKLQlSRUcxNigweDI3OCksCi0JUkVHMTYoMHgyNzQpLAotCVJFRzE2KDB4MjcwKSwK
LQotCU5PUCgxMyksCi0JTFJJKDIsIDApLAotCVJFRzE2KDB4MjAwKSwKLQlSRUcoMHgwMjgpLAot
Ci0JRU5EKDgwKQotfTsKLQotc3RhdGljIGNvbnN0IHU4IGdlbjlfeGNzX29mZnNldHNbXSA9IHsK
LQlOT1AoMSksCi0JTFJJKDE0LCBQT1NURUQpLAotCVJFRzE2KDB4MjQ0KSwKLQlSRUcoMHgwMzQp
LAotCVJFRygweDAzMCksCi0JUkVHKDB4MDM4KSwKLQlSRUcoMHgwM2MpLAotCVJFRygweDE2OCks
Ci0JUkVHKDB4MTQwKSwKLQlSRUcoMHgxMTApLAotCVJFRygweDExYyksCi0JUkVHKDB4MTE0KSwK
LQlSRUcoMHgxMTgpLAotCVJFRygweDFjMCksCi0JUkVHKDB4MWM0KSwKLQlSRUcoMHgxYzgpLAot
Ci0JTk9QKDMpLAotCUxSSSg5LCBQT1NURUQpLAotCVJFRzE2KDB4M2E4KSwKLQlSRUcxNigweDI4
YyksCi0JUkVHMTYoMHgyODgpLAotCVJFRzE2KDB4Mjg0KSwKLQlSRUcxNigweDI4MCksCi0JUkVH
MTYoMHgyN2MpLAotCVJFRzE2KDB4Mjc4KSwKLQlSRUcxNigweDI3NCksCi0JUkVHMTYoMHgyNzAp
LAotCi0JTk9QKDEzKSwKLQlMUkkoMSwgUE9TVEVEKSwKLQlSRUcxNigweDIwMCksCi0KLQlOT1Ao
MTMpLAotCUxSSSg0NCwgUE9TVEVEKSwKLQlSRUcoMHgwMjgpLAotCVJFRygweDA5YyksCi0JUkVH
KDB4MGMwKSwKLQlSRUcoMHgxNzgpLAotCVJFRygweDE3YyksCi0JUkVHMTYoMHgzNTgpLAotCVJF
RygweDE3MCksCi0JUkVHKDB4MTUwKSwKLQlSRUcoMHgxNTQpLAotCVJFRygweDE1OCksCi0JUkVH
MTYoMHg0MWMpLAotCVJFRzE2KDB4NjAwKSwKLQlSRUcxNigweDYwNCksCi0JUkVHMTYoMHg2MDgp
LAotCVJFRzE2KDB4NjBjKSwKLQlSRUcxNigweDYxMCksCi0JUkVHMTYoMHg2MTQpLAotCVJFRzE2
KDB4NjE4KSwKLQlSRUcxNigweDYxYyksCi0JUkVHMTYoMHg2MjApLAotCVJFRzE2KDB4NjI0KSwK
LQlSRUcxNigweDYyOCksCi0JUkVHMTYoMHg2MmMpLAotCVJFRzE2KDB4NjMwKSwKLQlSRUcxNigw
eDYzNCksCi0JUkVHMTYoMHg2MzgpLAotCVJFRzE2KDB4NjNjKSwKLQlSRUcxNigweDY0MCksCi0J
UkVHMTYoMHg2NDQpLAotCVJFRzE2KDB4NjQ4KSwKLQlSRUcxNigweDY0YyksCi0JUkVHMTYoMHg2
NTApLAotCVJFRzE2KDB4NjU0KSwKLQlSRUcxNigweDY1OCksCi0JUkVHMTYoMHg2NWMpLAotCVJF
RzE2KDB4NjYwKSwKLQlSRUcxNigweDY2NCksCi0JUkVHMTYoMHg2NjgpLAotCVJFRzE2KDB4NjZj
KSwKLQlSRUcxNigweDY3MCksCi0JUkVHMTYoMHg2NzQpLAotCVJFRzE2KDB4Njc4KSwKLQlSRUcx
NigweDY3YyksCi0JUkVHKDB4MDY4KSwKLQotCUVORCgxNzYpCi19OwotCi1zdGF0aWMgY29uc3Qg
dTggZ2VuMTJfeGNzX29mZnNldHNbXSA9IHsKLQlOT1AoMSksCi0JTFJJKDEzLCBQT1NURUQpLAot
CVJFRzE2KDB4MjQ0KSwKLQlSRUcoMHgwMzQpLAotCVJFRygweDAzMCksCi0JUkVHKDB4MDM4KSwK
LQlSRUcoMHgwM2MpLAotCVJFRygweDE2OCksCi0JUkVHKDB4MTQwKSwKLQlSRUcoMHgxMTApLAot
CVJFRygweDFjMCksCi0JUkVHKDB4MWM0KSwKLQlSRUcoMHgxYzgpLAotCVJFRygweDE4MCksCi0J
UkVHMTYoMHgyYjQpLAotCi0JTk9QKDUpLAotCUxSSSg5LCBQT1NURUQpLAotCVJFRzE2KDB4M2E4
KSwKLQlSRUcxNigweDI4YyksCi0JUkVHMTYoMHgyODgpLAotCVJFRzE2KDB4Mjg0KSwKLQlSRUcx
NigweDI4MCksCi0JUkVHMTYoMHgyN2MpLAotCVJFRzE2KDB4Mjc4KSwKLQlSRUcxNigweDI3NCks
Ci0JUkVHMTYoMHgyNzApLAotCi0JRU5EKDgwKQotfTsKLQotc3RhdGljIGNvbnN0IHU4IGdlbjhf
cmNzX29mZnNldHNbXSA9IHsKLQlOT1AoMSksCi0JTFJJKDE0LCBQT1NURUQpLAotCVJFRzE2KDB4
MjQ0KSwKLQlSRUcoMHgwMzQpLAotCVJFRygweDAzMCksCi0JUkVHKDB4MDM4KSwKLQlSRUcoMHgw
M2MpLAotCVJFRygweDE2OCksCi0JUkVHKDB4MTQwKSwKLQlSRUcoMHgxMTApLAotCVJFRygweDEx
YyksCi0JUkVHKDB4MTE0KSwKLQlSRUcoMHgxMTgpLAotCVJFRygweDFjMCksCi0JUkVHKDB4MWM0
KSwKLQlSRUcoMHgxYzgpLAotCi0JTk9QKDMpLAotCUxSSSg5LCBQT1NURUQpLAotCVJFRzE2KDB4
M2E4KSwKLQlSRUcxNigweDI4YyksCi0JUkVHMTYoMHgyODgpLAotCVJFRzE2KDB4Mjg0KSwKLQlS
RUcxNigweDI4MCksCi0JUkVHMTYoMHgyN2MpLAotCVJFRzE2KDB4Mjc4KSwKLQlSRUcxNigweDI3
NCksCi0JUkVHMTYoMHgyNzApLAotCi0JTk9QKDEzKSwKLQlMUkkoMSwgMCksCi0JUkVHKDB4MGM4
KSwKLQotCUVORCg4MCkKLX07Ci0KLXN0YXRpYyBjb25zdCB1OCBnZW45X3Jjc19vZmZzZXRzW10g
PSB7Ci0JTk9QKDEpLAotCUxSSSgxNCwgUE9TVEVEKSwKLQlSRUcxNigweDI0NCksCi0JUkVHKDB4
MzQpLAotCVJFRygweDMwKSwKLQlSRUcoMHgzOCksCi0JUkVHKDB4M2MpLAotCVJFRygweDE2OCks
Ci0JUkVHKDB4MTQwKSwKLQlSRUcoMHgxMTApLAotCVJFRygweDExYyksCi0JUkVHKDB4MTE0KSwK
LQlSRUcoMHgxMTgpLAotCVJFRygweDFjMCksCi0JUkVHKDB4MWM0KSwKLQlSRUcoMHgxYzgpLAot
Ci0JTk9QKDMpLAotCUxSSSg5LCBQT1NURUQpLAotCVJFRzE2KDB4M2E4KSwKLQlSRUcxNigweDI4
YyksCi0JUkVHMTYoMHgyODgpLAotCVJFRzE2KDB4Mjg0KSwKLQlSRUcxNigweDI4MCksCi0JUkVH
MTYoMHgyN2MpLAotCVJFRzE2KDB4Mjc4KSwKLQlSRUcxNigweDI3NCksCi0JUkVHMTYoMHgyNzAp
LAotCi0JTk9QKDEzKSwKLQlMUkkoMSwgMCksCi0JUkVHKDB4YzgpLAotCi0JTk9QKDEzKSwKLQlM
UkkoNDQsIFBPU1RFRCksCi0JUkVHKDB4MjgpLAotCVJFRygweDljKSwKLQlSRUcoMHhjMCksCi0J
UkVHKDB4MTc4KSwKLQlSRUcoMHgxN2MpLAotCVJFRzE2KDB4MzU4KSwKLQlSRUcoMHgxNzApLAot
CVJFRygweDE1MCksCi0JUkVHKDB4MTU0KSwKLQlSRUcoMHgxNTgpLAotCVJFRzE2KDB4NDFjKSwK
LQlSRUcxNigweDYwMCksCi0JUkVHMTYoMHg2MDQpLAotCVJFRzE2KDB4NjA4KSwKLQlSRUcxNigw
eDYwYyksCi0JUkVHMTYoMHg2MTApLAotCVJFRzE2KDB4NjE0KSwKLQlSRUcxNigweDYxOCksCi0J
UkVHMTYoMHg2MWMpLAotCVJFRzE2KDB4NjIwKSwKLQlSRUcxNigweDYyNCksCi0JUkVHMTYoMHg2
MjgpLAotCVJFRzE2KDB4NjJjKSwKLQlSRUcxNigweDYzMCksCi0JUkVHMTYoMHg2MzQpLAotCVJF
RzE2KDB4NjM4KSwKLQlSRUcxNigweDYzYyksCi0JUkVHMTYoMHg2NDApLAotCVJFRzE2KDB4NjQ0
KSwKLQlSRUcxNigweDY0OCksCi0JUkVHMTYoMHg2NGMpLAotCVJFRzE2KDB4NjUwKSwKLQlSRUcx
NigweDY1NCksCi0JUkVHMTYoMHg2NTgpLAotCVJFRzE2KDB4NjVjKSwKLQlSRUcxNigweDY2MCks
Ci0JUkVHMTYoMHg2NjQpLAotCVJFRzE2KDB4NjY4KSwKLQlSRUcxNigweDY2YyksCi0JUkVHMTYo
MHg2NzApLAotCVJFRzE2KDB4Njc0KSwKLQlSRUcxNigweDY3OCksCi0JUkVHMTYoMHg2N2MpLAot
CVJFRygweDY4KSwKLQotCUVORCgxNzYpCi19OwotCi1zdGF0aWMgY29uc3QgdTggZ2VuMTFfcmNz
X29mZnNldHNbXSA9IHsKLQlOT1AoMSksCi0JTFJJKDE1LCBQT1NURUQpLAotCVJFRzE2KDB4MjQ0
KSwKLQlSRUcoMHgwMzQpLAotCVJFRygweDAzMCksCi0JUkVHKDB4MDM4KSwKLQlSRUcoMHgwM2Mp
LAotCVJFRygweDE2OCksCi0JUkVHKDB4MTQwKSwKLQlSRUcoMHgxMTApLAotCVJFRygweDExYyks
Ci0JUkVHKDB4MTE0KSwKLQlSRUcoMHgxMTgpLAotCVJFRygweDFjMCksCi0JUkVHKDB4MWM0KSwK
LQlSRUcoMHgxYzgpLAotCVJFRygweDE4MCksCi0KLQlOT1AoMSksCi0JTFJJKDksIFBPU1RFRCks
Ci0JUkVHMTYoMHgzYTgpLAotCVJFRzE2KDB4MjhjKSwKLQlSRUcxNigweDI4OCksCi0JUkVHMTYo
MHgyODQpLAotCVJFRzE2KDB4MjgwKSwKLQlSRUcxNigweDI3YyksCi0JUkVHMTYoMHgyNzgpLAot
CVJFRzE2KDB4Mjc0KSwKLQlSRUcxNigweDI3MCksCi0KLQlMUkkoMSwgUE9TVEVEKSwKLQlSRUco
MHgxYjApLAotCi0JTk9QKDEwKSwKLQlMUkkoMSwgMCksCi0JUkVHKDB4MGM4KSwKLQotCUVORCg4
MCkKLX07Ci0KLXN0YXRpYyBjb25zdCB1OCBnZW4xMl9yY3Nfb2Zmc2V0c1tdID0gewotCU5PUCgx
KSwKLQlMUkkoMTMsIFBPU1RFRCksCi0JUkVHMTYoMHgyNDQpLAotCVJFRygweDAzNCksCi0JUkVH
KDB4MDMwKSwKLQlSRUcoMHgwMzgpLAotCVJFRygweDAzYyksCi0JUkVHKDB4MTY4KSwKLQlSRUco
MHgxNDApLAotCVJFRygweDExMCksCi0JUkVHKDB4MWMwKSwKLQlSRUcoMHgxYzQpLAotCVJFRygw
eDFjOCksCi0JUkVHKDB4MTgwKSwKLQlSRUcxNigweDJiNCksCi0KLQlOT1AoNSksCi0JTFJJKDks
IFBPU1RFRCksCi0JUkVHMTYoMHgzYTgpLAotCVJFRzE2KDB4MjhjKSwKLQlSRUcxNigweDI4OCks
Ci0JUkVHMTYoMHgyODQpLAotCVJFRzE2KDB4MjgwKSwKLQlSRUcxNigweDI3YyksCi0JUkVHMTYo
MHgyNzgpLAotCVJFRzE2KDB4Mjc0KSwKLQlSRUcxNigweDI3MCksCi0KLQlMUkkoMywgUE9TVEVE
KSwKLQlSRUcoMHgxYjApLAotCVJFRzE2KDB4NWE4KSwKLQlSRUcxNigweDVhYyksCi0KLQlOT1Ao
NiksCi0JTFJJKDEsIDApLAotCVJFRygweDBjOCksCi0JTk9QKDMgKyA5ICsgMSksCi0KLQlMUkko
NTEsIFBPU1RFRCksCi0JUkVHMTYoMHg1ODgpLAotCVJFRzE2KDB4NTg4KSwKLQlSRUcxNigweDU4
OCksCi0JUkVHMTYoMHg1ODgpLAotCVJFRzE2KDB4NTg4KSwKLQlSRUcxNigweDU4OCksCi0JUkVH
KDB4MDI4KSwKLQlSRUcoMHgwOWMpLAotCVJFRygweDBjMCksCi0JUkVHKDB4MTc4KSwKLQlSRUco
MHgxN2MpLAotCVJFRzE2KDB4MzU4KSwKLQlSRUcoMHgxNzApLAotCVJFRygweDE1MCksCi0JUkVH
KDB4MTU0KSwKLQlSRUcoMHgxNTgpLAotCVJFRzE2KDB4NDFjKSwKLQlSRUcxNigweDYwMCksCi0J
UkVHMTYoMHg2MDQpLAotCVJFRzE2KDB4NjA4KSwKLQlSRUcxNigweDYwYyksCi0JUkVHMTYoMHg2
MTApLAotCVJFRzE2KDB4NjE0KSwKLQlSRUcxNigweDYxOCksCi0JUkVHMTYoMHg2MWMpLAotCVJF
RzE2KDB4NjIwKSwKLQlSRUcxNigweDYyNCksCi0JUkVHMTYoMHg2MjgpLAotCVJFRzE2KDB4NjJj
KSwKLQlSRUcxNigweDYzMCksCi0JUkVHMTYoMHg2MzQpLAotCVJFRzE2KDB4NjM4KSwKLQlSRUcx
NigweDYzYyksCi0JUkVHMTYoMHg2NDApLAotCVJFRzE2KDB4NjQ0KSwKLQlSRUcxNigweDY0OCks
Ci0JUkVHMTYoMHg2NGMpLAotCVJFRzE2KDB4NjUwKSwKLQlSRUcxNigweDY1NCksCi0JUkVHMTYo
MHg2NTgpLAotCVJFRzE2KDB4NjVjKSwKLQlSRUcxNigweDY2MCksCi0JUkVHMTYoMHg2NjQpLAot
CVJFRzE2KDB4NjY4KSwKLQlSRUcxNigweDY2YyksCi0JUkVHMTYoMHg2NzApLAotCVJFRzE2KDB4
Njc0KSwKLQlSRUcxNigweDY3OCksCi0JUkVHMTYoMHg2N2MpLAotCVJFRygweDA2OCksCi0JUkVH
KDB4MDg0KSwKLQlOT1AoMSksCi0KLQlFTkQoMTkyKQotfTsKLQotI3VuZGVmIEVORAotI3VuZGVm
IFJFRzE2Ci0jdW5kZWYgUkVHCi0jdW5kZWYgTFJJCi0jdW5kZWYgTk9QCi0KLXN0YXRpYyBjb25z
dCB1OCAqcmVnX29mZnNldHMoY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQot
ewotCS8qCi0JICogVGhlIGdlbjEyKyBsaXN0cyBvbmx5IGhhdmUgdGhlIHJlZ2lzdGVycyB3ZSBw
cm9ncmFtIGluIHRoZSBiYXNpYwotCSAqIGRlZmF1bHQgc3RhdGUuIFdlIHJlbHkgb24gdGhlIGNv
bnRleHQgaW1hZ2UgdXNpbmcgcmVsYXRpdmUKLQkgKiBhZGRyZXNzaW5nIHRvIGF1dG9tYXRpYyBm
aXh1cCB0aGUgcmVnaXN0ZXIgc3RhdGUgYmV0d2VlbiB0aGUKLQkgKiBwaHlzaWNhbCBlbmdpbmVz
IGZvciB2aXJ0dWFsIGVuZ2luZS4KLQkgKi8KLQlHRU1fQlVHX09OKElOVEVMX0dFTihlbmdpbmUt
Pmk5MTUpID49IDEyICYmCi0JCSAgICFpbnRlbF9lbmdpbmVfaGFzX3JlbGF0aXZlX21taW8oZW5n
aW5lKSk7Ci0KLQlpZiAoZW5naW5lLT5jbGFzcyA9PSBSRU5ERVJfQ0xBU1MpIHsKLQkJaWYgKElO
VEVMX0dFTihlbmdpbmUtPmk5MTUpID49IDEyKQotCQkJcmV0dXJuIGdlbjEyX3Jjc19vZmZzZXRz
OwotCQllbHNlIGlmIChJTlRFTF9HRU4oZW5naW5lLT5pOTE1KSA+PSAxMSkKLQkJCXJldHVybiBn
ZW4xMV9yY3Nfb2Zmc2V0czsKLQkJZWxzZSBpZiAoSU5URUxfR0VOKGVuZ2luZS0+aTkxNSkgPj0g
OSkKLQkJCXJldHVybiBnZW45X3Jjc19vZmZzZXRzOwotCQllbHNlCi0JCQlyZXR1cm4gZ2VuOF9y
Y3Nfb2Zmc2V0czsKLQl9IGVsc2UgewotCQlpZiAoSU5URUxfR0VOKGVuZ2luZS0+aTkxNSkgPj0g
MTIpCi0JCQlyZXR1cm4gZ2VuMTJfeGNzX29mZnNldHM7Ci0JCWVsc2UgaWYgKElOVEVMX0dFTihl
bmdpbmUtPmk5MTUpID49IDkpCi0JCQlyZXR1cm4gZ2VuOV94Y3Nfb2Zmc2V0czsKLQkJZWxzZQot
CQkJcmV0dXJuIGdlbjhfeGNzX29mZnNldHM7Ci0JfQotfQotCiBzdGF0aWMgc3RydWN0IGk5MTVf
cmVxdWVzdCAqCiBfX3Vud2luZF9pbmNvbXBsZXRlX3JlcXVlc3RzKHN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZSkKIHsKQEAgLTExODcsNTggKzQ5OCw2IEBAIHN0YXRpYyB2b2lkIGludGVs
X2VuZ2luZV9jb250ZXh0X291dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJd3Jp
dGVfc2VxdW5sb2NrX2lycXJlc3RvcmUoJmVuZ2luZS0+c3RhdHMubG9jaywgZmxhZ3MpOwogfQog
Ci1zdGF0aWMgdm9pZAotZXhlY2xpc3RzX2NoZWNrX2NvbnRleHQoY29uc3Qgc3RydWN0IGludGVs
X2NvbnRleHQgKmNlLAotCQkJY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAot
CQkJY29uc3QgY2hhciAqd2hlbikKLXsKLQljb25zdCBzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZyA9
IGNlLT5yaW5nOwotCXUzMiAqcmVncyA9IGNlLT5scmNfcmVnX3N0YXRlOwotCWJvb2wgdmFsaWQg
PSB0cnVlOwotCWludCB4OwotCi0JaWYgKHJlZ3NbQ1RYX1JJTkdfU1RBUlRdICE9IGk5MTVfZ2d0
dF9vZmZzZXQocmluZy0+dm1hKSkgewotCQlwcl9lcnIoIiVzOiBjb250ZXh0IHN1Ym1pdHRlZCB3
aXRoIGluY29ycmVjdCBSSU5HX1NUQVJUIFslMDh4XSwgZXhwZWN0ZWQgJTA4eFxuIiwKLQkJICAg
ICAgIGVuZ2luZS0+bmFtZSwKLQkJICAgICAgIHJlZ3NbQ1RYX1JJTkdfU1RBUlRdLAotCQkgICAg
ICAgaTkxNV9nZ3R0X29mZnNldChyaW5nLT52bWEpKTsKLQkJcmVnc1tDVFhfUklOR19TVEFSVF0g
PSBpOTE1X2dndHRfb2Zmc2V0KHJpbmctPnZtYSk7Ci0JCXZhbGlkID0gZmFsc2U7Ci0JfQotCi0J
aWYgKChyZWdzW0NUWF9SSU5HX0NUTF0gJiB+KFJJTkdfV0FJVCB8IFJJTkdfV0FJVF9TRU1BUEhP
UkUpKSAhPQotCSAgICAoUklOR19DVExfU0laRShyaW5nLT5zaXplKSB8IFJJTkdfVkFMSUQpKSB7
Ci0JCXByX2VycigiJXM6IGNvbnRleHQgc3VibWl0dGVkIHdpdGggaW5jb3JyZWN0IFJJTkdfQ1RM
IFslMDh4XSwgZXhwZWN0ZWQgJTA4eFxuIiwKLQkJICAgICAgIGVuZ2luZS0+bmFtZSwKLQkJICAg
ICAgIHJlZ3NbQ1RYX1JJTkdfQ1RMXSwKLQkJICAgICAgICh1MzIpKFJJTkdfQ1RMX1NJWkUocmlu
Zy0+c2l6ZSkgfCBSSU5HX1ZBTElEKSk7Ci0JCXJlZ3NbQ1RYX1JJTkdfQ1RMXSA9IFJJTkdfQ1RM
X1NJWkUocmluZy0+c2l6ZSkgfCBSSU5HX1ZBTElEOwotCQl2YWxpZCA9IGZhbHNlOwotCX0KLQot
CXggPSBscmNfcmluZ19taV9tb2RlKGVuZ2luZSk7Ci0JaWYgKHggIT0gLTEgJiYgcmVnc1t4ICsg
MV0gJiAocmVnc1t4ICsgMV0gPj4gMTYpICYgU1RPUF9SSU5HKSB7Ci0JCXByX2VycigiJXM6IGNv
bnRleHQgc3VibWl0dGVkIHdpdGggU1RPUF9SSU5HIFslMDh4XSBpbiBSSU5HX01JX01PREVcbiIs
Ci0JCSAgICAgICBlbmdpbmUtPm5hbWUsIHJlZ3NbeCArIDFdKTsKLQkJcmVnc1t4ICsgMV0gJj0g
flNUT1BfUklORzsKLQkJcmVnc1t4ICsgMV0gfD0gU1RPUF9SSU5HIDw8IDE2OwotCQl2YWxpZCA9
IGZhbHNlOwotCX0KLQotCVdBUk5fT05DRSghdmFsaWQsICJJbnZhbGlkIGxyYyBzdGF0ZSBmb3Vu
ZCAlcyBzdWJtaXNzaW9uXG4iLCB3aGVuKTsKLX0KLQotc3RhdGljIHZvaWQgcmVzdG9yZV9kZWZh
dWx0X3N0YXRlKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKLQkJCQkgIHN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZSkKLXsKLQl1MzIgKnJlZ3M7Ci0KLQlyZWdzID0gbWVtc2V0KGNlLT5s
cmNfcmVnX3N0YXRlLCAwLCBlbmdpbmUtPmNvbnRleHRfc2l6ZSAtIFBBR0VfU0laRSk7Ci0JZXhl
Y2xpc3RzX2luaXRfcmVnX3N0YXRlKHJlZ3MsIGNlLCBlbmdpbmUsIGNlLT5yaW5nLCB0cnVlKTsK
LQotCWNlLT5ydW50aW1lLmxhc3QgPSBpbnRlbF9jb250ZXh0X2dldF9ydW50aW1lKGNlKTsKLX0K
LQogc3RhdGljIHZvaWQgcmVzZXRfYWN0aXZlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAogCQkJ
IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKQEAgLTEyNzEsOCArNTMwLDggQEAg
c3RhdGljIHZvaWQgcmVzZXRfYWN0aXZlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAogCWhlYWQg
PSBpbnRlbF9yaW5nX3dyYXAoY2UtPnJpbmcsIGhlYWQpOwogCiAJLyogU2NydWIgdGhlIGNvbnRl
eHQgaW1hZ2UgdG8gcHJldmVudCByZXBsYXlpbmcgdGhlIHByZXZpb3VzIGJhdGNoICovCi0JcmVz
dG9yZV9kZWZhdWx0X3N0YXRlKGNlLCBlbmdpbmUpOwotCV9fZXhlY2xpc3RzX3VwZGF0ZV9yZWdf
c3RhdGUoY2UsIGVuZ2luZSwgaGVhZCk7CisJbHJjX3Jlc3RvcmVfZGVmYXVsdHMoY2UsIGVuZ2lu
ZSk7CisJbHJjX3VwZGF0ZV9yZWdzKGNlLCBlbmdpbmUsIGhlYWQpOwogCiAJLyogV2UndmUgc3dp
dGNoZWQgYXdheSwgc28gdGhpcyBzaG91bGQgYmUgYSBuby1vcCwgYnV0IGludGVudCBtYXR0ZXJz
ICovCiAJY2UtPmxyYy5kZXNjIHw9IENUWF9ERVNDX0ZPUkNFX1JFU1RPUkU7CkBAIC0xMjk1LDcg
KzU1NCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2NvbnRleHRfdXBkYXRlX3J1bnRpbWUoc3RydWN0
IGludGVsX2NvbnRleHQgKmNlKQogCQlyZXR1cm47CiAKIAlvbGQgPSBjZS0+cnVudGltZS5sYXN0
OwotCWNlLT5ydW50aW1lLmxhc3QgPSBpbnRlbF9jb250ZXh0X2dldF9ydW50aW1lKGNlKTsKKwlj
ZS0+cnVudGltZS5sYXN0ID0gbHJjX2dldF9ydW50aW1lKGNlKTsKIAlkdCA9IGNlLT5ydW50aW1l
Lmxhc3QgLSBvbGQ7CiAKIAlpZiAodW5saWtlbHkoZHQgPCAwKSkgewpAQCAtMTMyMSw3ICs1ODAs
NyBAQCBfX2V4ZWNsaXN0c19zY2hlZHVsZV9pbihzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAkJ
cmVzZXRfYWN0aXZlKHJxLCBlbmdpbmUpOwogCiAJaWYgKElTX0VOQUJMRUQoQ09ORklHX0RSTV9J
OTE1X0RFQlVHX0dFTSkpCi0JCWV4ZWNsaXN0c19jaGVja19jb250ZXh0KGNlLCBlbmdpbmUsICJi
ZWZvcmUiKTsKKwkJbHJjX2NoZWNrX3JlZ3MoY2UsIGVuZ2luZSwgImJlZm9yZSIpOwogCiAJaWYg
KGNlLT50YWcpIHsKIAkJLyogVXNlIGEgZml4ZWQgdGFnIGZvciBPQSBhbmQgZnJpZW5kcyAqLwpA
QCAtMTM5Myw3ICs2NTIsNyBAQCBfX2V4ZWNsaXN0c19zY2hlZHVsZV9vdXQoc3RydWN0IGk5MTVf
cmVxdWVzdCAqcnEsCiAJICovCiAKIAlpZiAoSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfREVC
VUdfR0VNKSkKLQkJZXhlY2xpc3RzX2NoZWNrX2NvbnRleHQoY2UsIGVuZ2luZSwgImFmdGVyIik7
CisJCWxyY19jaGVja19yZWdzKGNlLCBlbmdpbmUsICJhZnRlciIpOwogCiAJLyoKIAkgKiBJZiB3
ZSBoYXZlIGp1c3QgY29tcGxldGVkIHRoaXMgY29udGV4dCwgdGhlIGVuZ2luZSBtYXkgbm93IGJl
CkBAIC0xNzUyLDEyICsxMDExLDYgQEAgc3RhdGljIGJvb2wgY2FuX21lcmdlX3JxKGNvbnN0IHN0
cnVjdCBpOTE1X3JlcXVlc3QgKnByZXYsCiAJcmV0dXJuIHRydWU7CiB9CiAKLXN0YXRpYyB2b2lk
IHZpcnR1YWxfdXBkYXRlX3JlZ2lzdGVyX29mZnNldHModTMyICpyZWdzLAotCQkJCQkgICAgc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQotewotCXNldF9vZmZzZXRzKHJlZ3MsIHJlZ19v
ZmZzZXRzKGVuZ2luZSksIGVuZ2luZSwgZmFsc2UpOwotfQotCiBzdGF0aWMgYm9vbCB2aXJ0dWFs
X21hdGNoZXMoY29uc3Qgc3RydWN0IHZpcnR1YWxfZW5naW5lICp2ZSwKIAkJCSAgICBjb25zdCBz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKIAkJCSAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmUpCkBAIC0xNzkzLDggKzEwNDYsNyBAQCBzdGF0aWMgdm9pZCB2aXJ0dWFsX3hm
ZXJfY29udGV4dChzdHJ1Y3QgdmlydHVhbF9lbmdpbmUgKnZlLAogCiAJR0VNX0JVR19PTihSRUFE
X09OQ0UodmUtPmNvbnRleHQuaW5mbGlnaHQpKTsKIAlpZiAoIWludGVsX2VuZ2luZV9oYXNfcmVs
YXRpdmVfbW1pbyhlbmdpbmUpKQotCQl2aXJ0dWFsX3VwZGF0ZV9yZWdpc3Rlcl9vZmZzZXRzKHZl
LT5jb250ZXh0LmxyY19yZWdfc3RhdGUsCi0JCQkJCQllbmdpbmUpOworCQlscmNfdXBkYXRlX29m
ZnNldHMoJnZlLT5jb250ZXh0LCBlbmdpbmUpOwogCiAJLyoKIAkgKiBNb3ZlIHRoZSBib3VuZCBl
bmdpbmUgdG8gdGhlIHRvcCBvZiB0aGUgbGlzdCBmb3IKQEAgLTMzMDcsMzUgKzI1NTksOSBAQCBz
dGF0aWMgdm9pZCBleGVjbGlzdHNfY29udGV4dF9kZXN0cm95KHN0cnVjdCBrcmVmICprcmVmKQog
CWludGVsX2NvbnRleHRfZnJlZShjZSk7CiB9CiAKLXN0YXRpYyB2b2lkCi1zZXRfcmVkem9uZSh2
b2lkICp2YWRkciwgY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQotewotCWlm
ICghSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfREVCVUdfR0VNKSkKLQkJcmV0dXJuOwotCi0J
dmFkZHIgKz0gZW5naW5lLT5jb250ZXh0X3NpemU7Ci0KLQltZW1zZXQodmFkZHIsIENPTlRFWFRf
UkVEWk9ORSwgSTkxNV9HVFRfUEFHRV9TSVpFKTsKLX0KLQotc3RhdGljIHZvaWQKLWNoZWNrX3Jl
ZHpvbmUoY29uc3Qgdm9pZCAqdmFkZHIsIGNvbnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSkKLXsKLQlpZiAoIUlTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X0RFQlVHX0dFTSkpCi0J
CXJldHVybjsKLQotCXZhZGRyICs9IGVuZ2luZS0+Y29udGV4dF9zaXplOwotCi0JaWYgKG1lbWNo
cl9pbnYodmFkZHIsIENPTlRFWFRfUkVEWk9ORSwgSTkxNV9HVFRfUEFHRV9TSVpFKSkKLQkJZHJt
X2Vycl9vbmNlKCZlbmdpbmUtPmk5MTUtPmRybSwKLQkJCSAgICAgIiVzIGNvbnRleHQgcmVkem9u
ZSBvdmVyd3JpdHRlbiFcbiIsCi0JCQkgICAgIGVuZ2luZS0+bmFtZSk7Ci19Ci0KIHN0YXRpYyB2
b2lkIGV4ZWNsaXN0c19jb250ZXh0X3VucGluKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIHsK
LQljaGVja19yZWR6b25lKCh2b2lkICopY2UtPmxyY19yZWdfc3RhdGUgLSBMUkNfU1RBVEVfT0ZG
U0VULAotCQkgICAgICBjZS0+ZW5naW5lKTsKKwlscmNfY2hlY2tfcmVkem9uZShjZSk7CiB9CiAK
IHN0YXRpYyB2b2lkIGV4ZWNsaXN0c19jb250ZXh0X3Bvc3RfdW5waW4oc3RydWN0IGludGVsX2Nv
bnRleHQgKmNlKQpAQCAtMzM0MywxNjMgKzI1NjksNiBAQCBzdGF0aWMgdm9pZCBleGVjbGlzdHNf
Y29udGV4dF9wb3N0X3VucGluKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIAlpOTE1X2dlbV9v
YmplY3RfdW5waW5fbWFwKGNlLT5zdGF0ZS0+b2JqKTsKIH0KIAotc3RhdGljIHUzMiAqCi1nZW4x
Ml9lbWl0X3RpbWVzdGFtcF93YShjb25zdCBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIHUzMiAq
Y3MpCi17Ci0JKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX01FTV9HRU44IHwKLQkJTUlfU1JNX0xS
TV9HTE9CQUxfR1RUIHwKLQkJTUlfTFJJX0xSTV9DU19NTUlPOwotCSpjcysrID0gaTkxNV9tbWlv
X3JlZ19vZmZzZXQoR0VOOF9SSU5HX0NTX0dQUigwLCAwKSk7Ci0JKmNzKysgPSBpOTE1X2dndHRf
b2Zmc2V0KGNlLT5zdGF0ZSkgKyBMUkNfU1RBVEVfT0ZGU0VUICsKLQkJQ1RYX1RJTUVTVEFNUCAq
IHNpemVvZih1MzIpOwotCSpjcysrID0gMDsKLQotCSpjcysrID0gTUlfTE9BRF9SRUdJU1RFUl9S
RUcgfAotCQlNSV9MUlJfU09VUkNFX0NTX01NSU8gfAotCQlNSV9MUklfTFJNX0NTX01NSU87Ci0J
KmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChHRU44X1JJTkdfQ1NfR1BSKDAsIDApKTsKLQkq
Y3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KFJJTkdfQ1RYX1RJTUVTVEFNUCgwKSk7Ci0KLQkq
Y3MrKyA9IE1JX0xPQURfUkVHSVNURVJfUkVHIHwKLQkJTUlfTFJSX1NPVVJDRV9DU19NTUlPIHwK
LQkJTUlfTFJJX0xSTV9DU19NTUlPOwotCSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQoR0VO
OF9SSU5HX0NTX0dQUigwLCAwKSk7Ci0JKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChSSU5H
X0NUWF9USU1FU1RBTVAoMCkpOwotCi0JcmV0dXJuIGNzOwotfQotCi1zdGF0aWMgdTMyICoKLWdl
bjEyX2VtaXRfcmVzdG9yZV9zY3JhdGNoKGNvbnN0IHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwg
dTMyICpjcykKLXsKLQlHRU1fQlVHX09OKGxyY19yaW5nX2dwcjAoY2UtPmVuZ2luZSkgPT0gLTEp
OwotCi0JKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX01FTV9HRU44IHwKLQkJTUlfU1JNX0xSTV9H
TE9CQUxfR1RUIHwKLQkJTUlfTFJJX0xSTV9DU19NTUlPOwotCSpjcysrID0gaTkxNV9tbWlvX3Jl
Z19vZmZzZXQoR0VOOF9SSU5HX0NTX0dQUigwLCAwKSk7Ci0JKmNzKysgPSBpOTE1X2dndHRfb2Zm
c2V0KGNlLT5zdGF0ZSkgKyBMUkNfU1RBVEVfT0ZGU0VUICsKLQkJKGxyY19yaW5nX2dwcjAoY2Ut
PmVuZ2luZSkgKyAxKSAqIHNpemVvZih1MzIpOwotCSpjcysrID0gMDsKLQotCXJldHVybiBjczsK
LX0KLQotc3RhdGljIHUzMiAqCi1nZW4xMl9lbWl0X2NtZF9idWZfd2EoY29uc3Qgc3RydWN0IGlu
dGVsX2NvbnRleHQgKmNlLCB1MzIgKmNzKQotewotCUdFTV9CVUdfT04obHJjX3JpbmdfY21kX2J1
Zl9jY3RsKGNlLT5lbmdpbmUpID09IC0xKTsKLQotCSpjcysrID0gTUlfTE9BRF9SRUdJU1RFUl9N
RU1fR0VOOCB8Ci0JCU1JX1NSTV9MUk1fR0xPQkFMX0dUVCB8Ci0JCU1JX0xSSV9MUk1fQ1NfTU1J
TzsKLQkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KEdFTjhfUklOR19DU19HUFIoMCwgMCkp
OwotCSpjcysrID0gaTkxNV9nZ3R0X29mZnNldChjZS0+c3RhdGUpICsgTFJDX1NUQVRFX09GRlNF
VCArCi0JCShscmNfcmluZ19jbWRfYnVmX2NjdGwoY2UtPmVuZ2luZSkgKyAxKSAqIHNpemVvZih1
MzIpOwotCSpjcysrID0gMDsKLQotCSpjcysrID0gTUlfTE9BRF9SRUdJU1RFUl9SRUcgfAotCQlN
SV9MUlJfU09VUkNFX0NTX01NSU8gfAotCQlNSV9MUklfTFJNX0NTX01NSU87Ci0JKmNzKysgPSBp
OTE1X21taW9fcmVnX29mZnNldChHRU44X1JJTkdfQ1NfR1BSKDAsIDApKTsKLQkqY3MrKyA9IGk5
MTVfbW1pb19yZWdfb2Zmc2V0KFJJTkdfQ01EX0JVRl9DQ1RMKDApKTsKLQotCXJldHVybiBjczsK
LX0KLQotc3RhdGljIHUzMiAqCi1nZW4xMl9lbWl0X2luZGlyZWN0X2N0eF9yY3MoY29uc3Qgc3Ry
dWN0IGludGVsX2NvbnRleHQgKmNlLCB1MzIgKmNzKQotewotCWNzID0gZ2VuMTJfZW1pdF90aW1l
c3RhbXBfd2EoY2UsIGNzKTsKLQljcyA9IGdlbjEyX2VtaXRfY21kX2J1Zl93YShjZSwgY3MpOwot
CWNzID0gZ2VuMTJfZW1pdF9yZXN0b3JlX3NjcmF0Y2goY2UsIGNzKTsKLQotCXJldHVybiBjczsK
LX0KLQotc3RhdGljIHUzMiAqCi1nZW4xMl9lbWl0X2luZGlyZWN0X2N0eF94Y3MoY29uc3Qgc3Ry
dWN0IGludGVsX2NvbnRleHQgKmNlLCB1MzIgKmNzKQotewotCWNzID0gZ2VuMTJfZW1pdF90aW1l
c3RhbXBfd2EoY2UsIGNzKTsKLQljcyA9IGdlbjEyX2VtaXRfcmVzdG9yZV9zY3JhdGNoKGNlLCBj
cyk7Ci0KLQlyZXR1cm4gY3M7Ci19Ci0KLXN0YXRpYyBpbmxpbmUgdTMyIGNvbnRleHRfd2FfYmJf
b2Zmc2V0KGNvbnN0IHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKLXsKLQlyZXR1cm4gUEFHRV9T
SVpFICogY2UtPndhX2JiX3BhZ2U7Ci19Ci0KLXN0YXRpYyB1MzIgKmNvbnRleHRfaW5kaXJlY3Rf
YmIoY29uc3Qgc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQotewotCXZvaWQgKnB0cjsKLQotCUdF
TV9CVUdfT04oIWNlLT53YV9iYl9wYWdlKTsKLQotCXB0ciA9IGNlLT5scmNfcmVnX3N0YXRlOwot
CXB0ciAtPSBMUkNfU1RBVEVfT0ZGU0VUOyAvKiBiYWNrIHRvIHN0YXJ0IG9mIGNvbnRleHQgaW1h
Z2UgKi8KLQlwdHIgKz0gY29udGV4dF93YV9iYl9vZmZzZXQoY2UpOwotCi0JcmV0dXJuIHB0cjsK
LX0KLQotc3RhdGljIHZvaWQKLXNldHVwX2luZGlyZWN0X2N0eF9iYihjb25zdCBzdHJ1Y3QgaW50
ZWxfY29udGV4dCAqY2UsCi0JCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSwKLQkJICAgICAgdTMyICooKmVtaXQpKGNvbnN0IHN0cnVjdCBpbnRlbF9jb250ZXh0ICos
IHUzMiAqKSkKLXsKLQl1MzIgKiBjb25zdCBzdGFydCA9IGNvbnRleHRfaW5kaXJlY3RfYmIoY2Up
OwotCXUzMiAqY3M7Ci0KLQljcyA9IGVtaXQoY2UsIHN0YXJ0KTsKLQlHRU1fQlVHX09OKGNzIC0g
c3RhcnQgPiBJOTE1X0dUVF9QQUdFX1NJWkUgLyBzaXplb2YoKmNzKSk7Ci0Jd2hpbGUgKCh1bnNp
Z25lZCBsb25nKWNzICUgQ0FDSEVMSU5FX0JZVEVTKQotCQkqY3MrKyA9IE1JX05PT1A7Ci0KLQls
cmNfcmluZ19zZXR1cF9pbmRpcmVjdF9jdHgoY2UtPmxyY19yZWdfc3RhdGUsIGVuZ2luZSwKLQkJ
CQkgICAgaTkxNV9nZ3R0X29mZnNldChjZS0+c3RhdGUpICsKLQkJCQkgICAgY29udGV4dF93YV9i
Yl9vZmZzZXQoY2UpLAotCQkJCSAgICAoY3MgLSBzdGFydCkgKiBzaXplb2YoKmNzKSk7Ci19Ci0K
LXN0YXRpYyB2b2lkCi1fX2V4ZWNsaXN0c191cGRhdGVfcmVnX3N0YXRlKGNvbnN0IHN0cnVjdCBp
bnRlbF9jb250ZXh0ICpjZSwKLQkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lLAotCQkJICAgICB1MzIgaGVhZCkKLXsKLQlzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZyA9
IGNlLT5yaW5nOwotCXUzMiAqcmVncyA9IGNlLT5scmNfcmVnX3N0YXRlOwotCi0JR0VNX0JVR19P
TighaW50ZWxfcmluZ19vZmZzZXRfdmFsaWQocmluZywgaGVhZCkpOwotCUdFTV9CVUdfT04oIWlu
dGVsX3Jpbmdfb2Zmc2V0X3ZhbGlkKHJpbmcsIHJpbmctPnRhaWwpKTsKLQotCXJlZ3NbQ1RYX1JJ
TkdfU1RBUlRdID0gaTkxNV9nZ3R0X29mZnNldChyaW5nLT52bWEpOwotCXJlZ3NbQ1RYX1JJTkdf
SEVBRF0gPSBoZWFkOwotCXJlZ3NbQ1RYX1JJTkdfVEFJTF0gPSByaW5nLT50YWlsOwotCXJlZ3Nb
Q1RYX1JJTkdfQ1RMXSA9IFJJTkdfQ1RMX1NJWkUocmluZy0+c2l6ZSkgfCBSSU5HX1ZBTElEOwot
Ci0JLyogUlBDUyAqLwotCWlmIChlbmdpbmUtPmNsYXNzID09IFJFTkRFUl9DTEFTUykgewotCQly
ZWdzW0NUWF9SX1BXUl9DTEtfU1RBVEVdID0KLQkJCWludGVsX3NzZXVfbWFrZV9ycGNzKGVuZ2lu
ZS0+Z3QsICZjZS0+c3NldSk7Ci0KLQkJaTkxNV9vYV9pbml0X3JlZ19zdGF0ZShjZSwgZW5naW5l
KTsKLQl9Ci0KLQlpZiAoY2UtPndhX2JiX3BhZ2UpIHsKLQkJdTMyICooKmZuKShjb25zdCBzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2UsIHUzMiAqY3MpOwotCi0JCWZuID0gZ2VuMTJfZW1pdF9pbmRp
cmVjdF9jdHhfeGNzOwotCQlpZiAoY2UtPmVuZ2luZS0+Y2xhc3MgPT0gUkVOREVSX0NMQVNTKQot
CQkJZm4gPSBnZW4xMl9lbWl0X2luZGlyZWN0X2N0eF9yY3M7Ci0KLQkJLyogTXV0dWFsbHkgZXhj
bHVzaXZlIHdydCB0byBnbG9iYWwgaW5kaXJlY3QgYmIgKi8KLQkJR0VNX0JVR19PTihlbmdpbmUt
PndhX2N0eC5pbmRpcmVjdF9jdHguc2l6ZSk7Ci0JCXNldHVwX2luZGlyZWN0X2N0eF9iYihjZSwg
ZW5naW5lLCBmbik7Ci0JfQotfQotCiBzdGF0aWMgaW50CiBleGVjbGlzdHNfY29udGV4dF9wcmVf
cGluKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKIAkJCSAgc3RydWN0IGk5MTVfZ2VtX3d3X2N0
eCAqd3csIHZvaWQgKip2YWRkcikKQEAgLTM1MjEsNyArMjU5MCw3IEBAIF9fZXhlY2xpc3RzX2Nv
bnRleHRfcGluKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKIHsKIAljZS0+bHJjLmxyY2EgPSBs
cmNfZGVzY3JpcHRvcihjZSwgZW5naW5lKSB8IENUWF9ERVNDX0ZPUkNFX1JFU1RPUkU7CiAJY2Ut
PmxyY19yZWdfc3RhdGUgPSB2YWRkciArIExSQ19TVEFURV9PRkZTRVQ7Ci0JX19leGVjbGlzdHNf
dXBkYXRlX3JlZ19zdGF0ZShjZSwgZW5naW5lLCBjZS0+cmluZy0+dGFpbCk7CisJbHJjX3VwZGF0
ZV9yZWdzKGNlLCBlbmdpbmUsIGNlLT5yaW5nLT50YWlsKTsKIAogCXJldHVybiAwOwogfQpAQCAt
MzU0NCw5ICsyNjEzLDggQEAgc3RhdGljIHZvaWQgZXhlY2xpc3RzX2NvbnRleHRfcmVzZXQoc3Ry
dWN0IGludGVsX2NvbnRleHQgKmNlKQogCWludGVsX3JpbmdfcmVzZXQoY2UtPnJpbmcsIGNlLT5y
aW5nLT5lbWl0KTsKIAogCS8qIFNjcnViIGF3YXkgdGhlIGdhcmJhZ2UgKi8KLQlleGVjbGlzdHNf
aW5pdF9yZWdfc3RhdGUoY2UtPmxyY19yZWdfc3RhdGUsCi0JCQkJIGNlLCBjZS0+ZW5naW5lLCBj
ZS0+cmluZywgdHJ1ZSk7Ci0JX19leGVjbGlzdHNfdXBkYXRlX3JlZ19zdGF0ZShjZSwgY2UtPmVu
Z2luZSwgY2UtPnJpbmctPnRhaWwpOworCWxyY19pbml0X3JlZ3MoY2UsIGNlLT5lbmdpbmUsIGNl
LT5yaW5nLCB0cnVlKTsKKwlscmNfdXBkYXRlX3JlZ3MoY2UsIGNlLT5lbmdpbmUsIGNlLT5yaW5n
LT50YWlsKTsKIAogCWNlLT5scmMuZGVzYyB8PSBDVFhfREVTQ19GT1JDRV9SRVNUT1JFOwogfQpA
QCAtMzY1MCwzMzAgKzI3MTgsNiBAQCBzdGF0aWMgaW50IGV4ZWNsaXN0c19yZXF1ZXN0X2FsbG9j
KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QpCiAJcmV0dXJuIDA7CiB9CiAKLS8qCi0gKiBJ
biB0aGlzIFdBIHdlIG5lZWQgdG8gc2V0IEdFTjhfTDNTUUNSRUc0WzIxOjIxXSBhbmQgcmVzZXQg
aXQgYWZ0ZXIKLSAqIFBJUEVfQ09OVFJPTCBpbnN0cnVjdGlvbi4gVGhpcyBpcyByZXF1aXJlZCBm
b3IgdGhlIGZsdXNoIHRvIGhhcHBlbiBjb3JyZWN0bHkKLSAqIGJ1dCB0aGVyZSBpcyBhIHNsaWdo
dCBjb21wbGljYXRpb24gYXMgdGhpcyBpcyBhcHBsaWVkIGluIFdBIGJhdGNoIHdoZXJlIHRoZQot
ICogdmFsdWVzIGFyZSBvbmx5IGluaXRpYWxpemVkIG9uY2Ugc28gd2UgY2Fubm90IHRha2UgcmVn
aXN0ZXIgdmFsdWUgYXQgdGhlCi0gKiBiZWdpbm5pbmcgYW5kIHJldXNlIGl0IGZ1cnRoZXI7IGhl
bmNlIHdlIHNhdmUgaXRzIHZhbHVlIHRvIG1lbW9yeSwgdXBsb2FkIGEKLSAqIGNvbnN0YW50IHZh
bHVlIHdpdGggYml0MjEgc2V0IGFuZCB0aGVuIHdlIHJlc3RvcmUgaXQgYmFjayB3aXRoIHRoZSBz
YXZlZCB2YWx1ZS4KLSAqIFRvIHNpbXBsaWZ5IHRoZSBXQSwgYSBjb25zdGFudCB2YWx1ZSBpcyBm
b3JtZWQgYnkgdXNpbmcgdGhlIGRlZmF1bHQgdmFsdWUKLSAqIG9mIHRoaXMgcmVnaXN0ZXIuIFRo
aXMgc2hvdWxkbid0IGJlIGEgcHJvYmxlbSBiZWNhdXNlIHdlIGFyZSBvbmx5IG1vZGlmeWluZwot
ICogaXQgZm9yIGEgc2hvcnQgcGVyaW9kIGFuZCB0aGlzIGJhdGNoIGluIG5vbi1wcmVtcHRpYmxl
LiBXZSBjYW4gb2Zjb3Vyc2UKLSAqIHVzZSBhZGRpdGlvbmFsIGluc3RydWN0aW9ucyB0aGF0IHJl
YWQgdGhlIGFjdHVhbCB2YWx1ZSBvZiB0aGUgcmVnaXN0ZXIKLSAqIGF0IHRoYXQgdGltZSBhbmQg
c2V0IG91ciBiaXQgb2YgaW50ZXJlc3QgYnV0IGl0IG1ha2VzIHRoZSBXQSBjb21wbGljYXRlZC4K
LSAqCi0gKiBUaGlzIFdBIGlzIGFsc28gcmVxdWlyZWQgZm9yIEdlbjkgc28gZXh0cmFjdGluZyBh
cyBhIGZ1bmN0aW9uIGF2b2lkcwotICogY29kZSBkdXBsaWNhdGlvbi4KLSAqLwotc3RhdGljIHUz
MiAqCi1nZW44X2VtaXRfZmx1c2hfY29oZXJlbnRsM193YShzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmUsIHUzMiAqYmF0Y2gpCi17Ci0JLyogTkIgbm8gb25lIGVsc2UgaXMgYWxsb3dlZCB0
byBzY3JpYmJsZSBvdmVyIHNjcmF0Y2ggKyAyNTYhICovCi0JKmJhdGNoKysgPSBNSV9TVE9SRV9S
RUdJU1RFUl9NRU1fR0VOOCB8IE1JX1NSTV9MUk1fR0xPQkFMX0dUVDsKLQkqYmF0Y2grKyA9IGk5
MTVfbW1pb19yZWdfb2Zmc2V0KEdFTjhfTDNTUUNSRUc0KTsKLQkqYmF0Y2grKyA9IGludGVsX2d0
X3NjcmF0Y2hfb2Zmc2V0KGVuZ2luZS0+Z3QsCi0JCQkJCSAgIElOVEVMX0dUX1NDUkFUQ0hfRklF
TERfQ09IRVJFTlRMM19XQSk7Ci0JKmJhdGNoKysgPSAwOwotCi0JKmJhdGNoKysgPSBNSV9MT0FE
X1JFR0lTVEVSX0lNTSgxKTsKLQkqYmF0Y2grKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KEdFTjhf
TDNTUUNSRUc0KTsKLQkqYmF0Y2grKyA9IDB4NDA0MDAwMDAgfCBHRU44X0xRU0NfRkxVU0hfQ09I
RVJFTlRfTElORVM7Ci0KLQliYXRjaCA9IGdlbjhfZW1pdF9waXBlX2NvbnRyb2woYmF0Y2gsCi0J
CQkJICAgICAgIFBJUEVfQ09OVFJPTF9DU19TVEFMTCB8Ci0JCQkJICAgICAgIFBJUEVfQ09OVFJP
TF9EQ19GTFVTSF9FTkFCTEUsCi0JCQkJICAgICAgIDApOwotCi0JKmJhdGNoKysgPSBNSV9MT0FE
X1JFR0lTVEVSX01FTV9HRU44IHwgTUlfU1JNX0xSTV9HTE9CQUxfR1RUOwotCSpiYXRjaCsrID0g
aTkxNV9tbWlvX3JlZ19vZmZzZXQoR0VOOF9MM1NRQ1JFRzQpOwotCSpiYXRjaCsrID0gaW50ZWxf
Z3Rfc2NyYXRjaF9vZmZzZXQoZW5naW5lLT5ndCwKLQkJCQkJICAgSU5URUxfR1RfU0NSQVRDSF9G
SUVMRF9DT0hFUkVOVEwzX1dBKTsKLQkqYmF0Y2grKyA9IDA7Ci0KLQlyZXR1cm4gYmF0Y2g7Ci19
Ci0KLS8qCi0gKiBUeXBpY2FsbHkgd2Ugb25seSBoYXZlIG9uZSBpbmRpcmVjdF9jdHggYW5kIHBl
cl9jdHggYmF0Y2ggYnVmZmVyIHdoaWNoIGFyZQotICogaW5pdGlhbGl6ZWQgYXQgdGhlIGJlZ2lu
bmluZyBhbmQgc2hhcmVkIGFjcm9zcyBhbGwgY29udGV4dHMgYnV0IHRoaXMgZmllbGQKLSAqIGhl
bHBzIHVzIHRvIGhhdmUgbXVsdGlwbGUgYmF0Y2hlcyBhdCBkaWZmZXJlbnQgb2Zmc2V0cyBhbmQg
c2VsZWN0IHRoZW0gYmFzZWQKLSAqIG9uIGEgY3JpdGVyaWEuIEF0IHRoZSBtb21lbnQgdGhpcyBi
YXRjaCBhbHdheXMgc3RhcnQgYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgcGFnZQotICogYW5kIGF0
IHRoaXMgcG9pbnQgd2UgZG9uJ3QgaGF2ZSBtdWx0aXBsZSB3YV9jdHggYmF0Y2ggYnVmZmVycy4K
LSAqCi0gKiBUaGUgbnVtYmVyIG9mIFdBIGFwcGxpZWQgYXJlIG5vdCBrbm93biBhdCB0aGUgYmVn
aW5uaW5nOyB3ZSB1c2UgdGhpcyBmaWVsZAotICogdG8gcmV0dXJuIHRoZSBubyBvZiBEV09SRFMg
d3JpdHRlbi4KLSAqCi0gKiBJdCBpcyB0byBiZSBub3RlZCB0aGF0IHRoaXMgYmF0Y2ggZG9lcyBu
b3QgY29udGFpbiBNSV9CQVRDSF9CVUZGRVJfRU5ECi0gKiBzbyBpdCBhZGRzIE5PT1BzIGFzIHBh
ZGRpbmcgdG8gbWFrZSBpdCBjYWNoZWxpbmUgYWxpZ25lZC4KLSAqIE1JX0JBVENIX0JVRkZFUl9F
TkQgd2lsbCBiZSBhZGRlZCB0byBwZXJjdHggYmF0Y2ggYW5kIGJvdGggb2YgdGhlbSB0b2dldGhl
cgotICogbWFrZXMgYSBjb21wbGV0ZSBiYXRjaCBidWZmZXIuCi0gKi8KLXN0YXRpYyB1MzIgKmdl
bjhfaW5pdF9pbmRpcmVjdGN0eF9iYihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIHUz
MiAqYmF0Y2gpCi17Ci0JLyogV2FEaXNhYmxlQ3R4UmVzdG9yZUFyYml0cmF0aW9uOmJkdyxjaHYg
Ki8KLQkqYmF0Y2grKyA9IE1JX0FSQl9PTl9PRkYgfCBNSV9BUkJfRElTQUJMRTsKLQotCS8qIFdh
Rmx1c2hDb2hlcmVudEwzQ2FjaGVMaW5lc0F0Q29udGV4dFN3aXRjaDpiZHcgKi8KLQlpZiAoSVNf
QlJPQURXRUxMKGVuZ2luZS0+aTkxNSkpCi0JCWJhdGNoID0gZ2VuOF9lbWl0X2ZsdXNoX2NvaGVy
ZW50bDNfd2EoZW5naW5lLCBiYXRjaCk7Ci0KLQkvKiBXYUNsZWFyU2xtU3BhY2VBdENvbnRleHRT
d2l0Y2g6YmR3LGNodiAqLwotCS8qIEFjdHVhbCBzY3JhdGNoIGxvY2F0aW9uIGlzIGF0IDEyOCBi
eXRlcyBvZmZzZXQgKi8KLQliYXRjaCA9IGdlbjhfZW1pdF9waXBlX2NvbnRyb2woYmF0Y2gsCi0J
CQkJICAgICAgIFBJUEVfQ09OVFJPTF9GTFVTSF9MMyB8Ci0JCQkJICAgICAgIFBJUEVfQ09OVFJP
TF9TVE9SRV9EQVRBX0lOREVYIHwKLQkJCQkgICAgICAgUElQRV9DT05UUk9MX0NTX1NUQUxMIHwK
LQkJCQkgICAgICAgUElQRV9DT05UUk9MX1FXX1dSSVRFLAotCQkJCSAgICAgICBMUkNfUFBIV1NQ
X1NDUkFUQ0hfQUREUik7Ci0KLQkqYmF0Y2grKyA9IE1JX0FSQl9PTl9PRkYgfCBNSV9BUkJfRU5B
QkxFOwotCi0JLyogUGFkIHRvIGVuZCBvZiBjYWNoZWxpbmUgKi8KLQl3aGlsZSAoKHVuc2lnbmVk
IGxvbmcpYmF0Y2ggJSBDQUNIRUxJTkVfQllURVMpCi0JCSpiYXRjaCsrID0gTUlfTk9PUDsKLQot
CS8qCi0JICogTUlfQkFUQ0hfQlVGRkVSX0VORCBpcyBub3QgcmVxdWlyZWQgaW4gSW5kaXJlY3Qg
Y3R4IEJCIGJlY2F1c2UKLQkgKiBleGVjdXRpb24gZGVwZW5kcyBvbiB0aGUgbGVuZ3RoIHNwZWNp
ZmllZCBpbiB0ZXJtcyBvZiBjYWNoZSBsaW5lcwotCSAqIGluIHRoZSByZWdpc3RlciBDVFhfUkNT
X0lORElSRUNUX0NUWAotCSAqLwotCi0JcmV0dXJuIGJhdGNoOwotfQotCi1zdHJ1Y3QgbHJpIHsK
LQlpOTE1X3JlZ190IHJlZzsKLQl1MzIgdmFsdWU7Ci19OwotCi1zdGF0aWMgdTMyICplbWl0X2xy
aSh1MzIgKmJhdGNoLCBjb25zdCBzdHJ1Y3QgbHJpICpscmksIHVuc2lnbmVkIGludCBjb3VudCkK
LXsKLQlHRU1fQlVHX09OKCFjb3VudCB8fCBjb3VudCA+IDYzKTsKLQotCSpiYXRjaCsrID0gTUlf
TE9BRF9SRUdJU1RFUl9JTU0oY291bnQpOwotCWRvIHsKLQkJKmJhdGNoKysgPSBpOTE1X21taW9f
cmVnX29mZnNldChscmktPnJlZyk7Ci0JCSpiYXRjaCsrID0gbHJpLT52YWx1ZTsKLQl9IHdoaWxl
IChscmkrKywgLS1jb3VudCk7Ci0JKmJhdGNoKysgPSBNSV9OT09QOwotCi0JcmV0dXJuIGJhdGNo
OwotfQotCi1zdGF0aWMgdTMyICpnZW45X2luaXRfaW5kaXJlY3RjdHhfYmIoc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lLCB1MzIgKmJhdGNoKQotewotCXN0YXRpYyBjb25zdCBzdHJ1Y3Qg
bHJpIGxyaVtdID0gewotCQkvKiBXYURpc2FibGVHYXRoZXJBdFNldFNoYWRlckNvbW1vblNsaWNl
OnNrbCxieHQsa2JsLGdsayAqLwotCQl7Ci0JCQlDT01NT05fU0xJQ0VfQ0hJQ0tFTjIsCi0JCQlf
X01BU0tFRF9GSUVMRChHRU45X0RJU0FCTEVfR0FUSEVSX0FUX1NFVF9TSEFERVJfQ09NTU9OX1NM
SUNFLAotCQkJCSAgICAgICAwKSwKLQkJfSwKLQotCQkvKiBCU3BlYzogMTEzOTEgKi8KLQkJewot
CQkJRkZfU0xJQ0VfQ0hJQ0tFTiwKLQkJCV9fTUFTS0VEX0ZJRUxEKEZGX1NMSUNFX0NISUNLRU5f
Q0xfUFJPVk9LSU5HX1ZFUlRFWF9GSVgsCi0JCQkJICAgICAgIEZGX1NMSUNFX0NISUNLRU5fQ0xf
UFJPVk9LSU5HX1ZFUlRFWF9GSVgpLAotCQl9LAotCi0JCS8qIEJTcGVjOiAxMTI5OSAqLwotCQl7
Ci0JCQlfM0RfQ0hJQ0tFTjMsCi0JCQlfX01BU0tFRF9GSUVMRChfM0RfQ0hJQ0tFTl9TRl9QUk9W
T0tJTkdfVkVSVEVYX0ZJWCwKLQkJCQkgICAgICAgXzNEX0NISUNLRU5fU0ZfUFJPVk9LSU5HX1ZF
UlRFWF9GSVgpLAotCQl9Ci0JfTsKLQotCSpiYXRjaCsrID0gTUlfQVJCX09OX09GRiB8IE1JX0FS
Ql9ESVNBQkxFOwotCi0JLyogV2FGbHVzaENvaGVyZW50TDNDYWNoZUxpbmVzQXRDb250ZXh0U3dp
dGNoOnNrbCxieHQsZ2xrICovCi0JYmF0Y2ggPSBnZW44X2VtaXRfZmx1c2hfY29oZXJlbnRsM193
YShlbmdpbmUsIGJhdGNoKTsKLQotCS8qIFdhQ2xlYXJTbG1TcGFjZUF0Q29udGV4dFN3aXRjaDpz
a2wsYnh0LGtibCxnbGssY2ZsICovCi0JYmF0Y2ggPSBnZW44X2VtaXRfcGlwZV9jb250cm9sKGJh
dGNoLAotCQkJCSAgICAgICBQSVBFX0NPTlRST0xfRkxVU0hfTDMgfAotCQkJCSAgICAgICBQSVBF
X0NPTlRST0xfU1RPUkVfREFUQV9JTkRFWCB8Ci0JCQkJICAgICAgIFBJUEVfQ09OVFJPTF9DU19T
VEFMTCB8Ci0JCQkJICAgICAgIFBJUEVfQ09OVFJPTF9RV19XUklURSwKLQkJCQkgICAgICAgTFJD
X1BQSFdTUF9TQ1JBVENIX0FERFIpOwotCi0JYmF0Y2ggPSBlbWl0X2xyaShiYXRjaCwgbHJpLCBB
UlJBWV9TSVpFKGxyaSkpOwotCi0JLyogV2FNZWRpYVBvb2xTdGF0ZUNtZEluV0FCQjpieHQsZ2xr
ICovCi0JaWYgKEhBU19QT09MRURfRVUoZW5naW5lLT5pOTE1KSkgewotCQkvKgotCQkgKiBFVSBw
b29sIGNvbmZpZ3VyYXRpb24gaXMgc2V0dXAgYWxvbmcgd2l0aCBnb2xkZW4gY29udGV4dAotCQkg
KiBkdXJpbmcgY29udGV4dCBpbml0aWFsaXphdGlvbi4gVGhpcyB2YWx1ZSBkZXBlbmRzIG9uCi0J
CSAqIGRldmljZSB0eXBlICgyeDYgb3IgM3g2KSBhbmQgbmVlZHMgdG8gYmUgdXBkYXRlZCBiYXNl
ZAotCQkgKiBvbiB3aGljaCBzdWJzbGljZSBpcyBkaXNhYmxlZCBlc3BlY2lhbGx5IGZvciAyeDYK
LQkJICogZGV2aWNlcywgaG93ZXZlciBpdCBpcyBzYWZlIHRvIGxvYWQgZGVmYXVsdAotCQkgKiBj
b25maWd1cmF0aW9uIG9mIDN4NiBkZXZpY2UgaW5zdGVhZCBvZiBtYXNraW5nIG9mZgotCQkgKiBj
b3JyZXNwb25kaW5nIGJpdHMgYmVjYXVzZSBIVyBpZ25vcmVzIGJpdHMgb2YgYSBkaXNhYmxlZAot
CQkgKiBzdWJzbGljZSBhbmQgZHJvcHMgZG93biB0byBhcHByb3ByaWF0ZSBjb25maWcuIFBsZWFz
ZQotCQkgKiBzZWUgcmVuZGVyX3N0YXRlX3NldHVwKCkgaW4gaTkxNV9nZW1fcmVuZGVyX3N0YXRl
LmMgZm9yCi0JCSAqIHBvc3NpYmxlIGNvbmZpZ3VyYXRpb25zLCB0byBhdm9pZCBkdXBsaWNhdGlv
biB0aGV5IGFyZQotCQkgKiBub3Qgc2hvd24gaGVyZSBhZ2Fpbi4KLQkJICovCi0JCSpiYXRjaCsr
ID0gR0VOOV9NRURJQV9QT09MX1NUQVRFOwotCQkqYmF0Y2grKyA9IEdFTjlfTUVESUFfUE9PTF9F
TkFCTEU7Ci0JCSpiYXRjaCsrID0gMHgwMDc3NzAwMDsKLQkJKmJhdGNoKysgPSAwOwotCQkqYmF0
Y2grKyA9IDA7Ci0JCSpiYXRjaCsrID0gMDsKLQl9Ci0KLQkqYmF0Y2grKyA9IE1JX0FSQl9PTl9P
RkYgfCBNSV9BUkJfRU5BQkxFOwotCi0JLyogUGFkIHRvIGVuZCBvZiBjYWNoZWxpbmUgKi8KLQl3
aGlsZSAoKHVuc2lnbmVkIGxvbmcpYmF0Y2ggJSBDQUNIRUxJTkVfQllURVMpCi0JCSpiYXRjaCsr
ID0gTUlfTk9PUDsKLQotCXJldHVybiBiYXRjaDsKLX0KLQotc3RhdGljIHUzMiAqCi1nZW4xMF9p
bml0X2luZGlyZWN0Y3R4X2JiKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgdTMyICpi
YXRjaCkKLXsKLQlpbnQgaTsKLQotCS8qCi0JICogV2FQaXBlQ29udHJvbEJlZm9yZTNEU3RhdGVT
YW1wbGVQYXR0ZXJuOiBjbmwKLQkgKgotCSAqIEVuc3VyZSB0aGUgZW5naW5lIGlzIGlkbGUgcHJp
b3IgdG8gcHJvZ3JhbW1pbmcgYQotCSAqIDNEU1RBVEVfU0FNUExFX1BBVFRFUk4gZHVyaW5nIGEg
Y29udGV4dCByZXN0b3JlLgotCSAqLwotCWJhdGNoID0gZ2VuOF9lbWl0X3BpcGVfY29udHJvbChi
YXRjaCwKLQkJCQkgICAgICAgUElQRV9DT05UUk9MX0NTX1NUQUxMLAotCQkJCSAgICAgICAwKTsK
LQkvKgotCSAqIFdhUGlwZUNvbnRyb2xCZWZvcmUzRFN0YXRlU2FtcGxlUGF0dGVybiBzYXlzIHdl
IG5lZWQgNCBkd29yZHMgZm9yCi0JICogdGhlIFBJUEVfQ09OVFJPTCBmb2xsb3dlZCBieSAxMiBk
d29yZHMgb2YgMHgwLCBzbyAxNiBkd29yZHMgaW4KLQkgKiB0b3RhbC4gSG93ZXZlciwgYSBQSVBF
X0NPTlRST0wgaXMgNiBkd29yZHMgbG9uZywgbm90IDQsIHdoaWNoIGlzCi0JICogY29uZnVzaW5n
LiBTaW5jZSBnZW44X2VtaXRfcGlwZV9jb250cm9sKCkgYWxyZWFkeSBhZHZhbmNlcyB0aGUKLQkg
KiBiYXRjaCBieSA2IGR3b3Jkcywgd2UgYWR2YW5jZSB0aGUgb3RoZXIgMTAgaGVyZSwgY29tcGxl
dGluZyBhCi0JICogY2FjaGVsaW5lLiBJdCdzIG5vdCBjbGVhciBpZiB0aGUgd29ya2Fyb3VuZCBy
ZXF1aXJlcyB0aGlzIHBhZGRpbmcKLQkgKiBiZWZvcmUgb3RoZXIgY29tbWFuZHMsIG9yIGlmIGl0
J3MganVzdCB0aGUgcmVndWxhciBwYWRkaW5nIHdlIHdvdWxkCi0JICogYWxyZWFkeSBoYXZlIGZv
ciB0aGUgd29ya2Fyb3VuZCBiYiwgc28gbGVhdmUgaXQgaGVyZSBmb3Igbm93LgotCSAqLwotCWZv
ciAoaSA9IDA7IGkgPCAxMDsgaSsrKQotCQkqYmF0Y2grKyA9IE1JX05PT1A7Ci0KLQkvKiBQYWQg
dG8gZW5kIG9mIGNhY2hlbGluZSAqLwotCXdoaWxlICgodW5zaWduZWQgbG9uZyliYXRjaCAlIENB
Q0hFTElORV9CWVRFUykKLQkJKmJhdGNoKysgPSBNSV9OT09QOwotCi0JcmV0dXJuIGJhdGNoOwot
fQotCi0jZGVmaW5lIENUWF9XQV9CQl9PQkpfU0laRSAoUEFHRV9TSVpFKQotCi1zdGF0aWMgaW50
IGxyY19zZXR1cF93YV9jdHgoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQotewotCXN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7Ci0Jc3RydWN0IGk5MTVfdm1hICp2bWE7Ci0J
aW50IGVycjsKLQotCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc2htZW0oZW5naW5lLT5p
OTE1LCBDVFhfV0FfQkJfT0JKX1NJWkUpOwotCWlmIChJU19FUlIob2JqKSkKLQkJcmV0dXJuIFBU
Ul9FUlIob2JqKTsKLQotCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgJmVuZ2luZS0+Z3Qt
PmdndHQtPnZtLCBOVUxMKTsKLQlpZiAoSVNfRVJSKHZtYSkpIHsKLQkJZXJyID0gUFRSX0VSUih2
bWEpOwotCQlnb3RvIGVycjsKLQl9Ci0KLQllcnIgPSBpOTE1X2dndHRfcGluKHZtYSwgTlVMTCwg
MCwgUElOX0hJR0gpOwotCWlmIChlcnIpCi0JCWdvdG8gZXJyOwotCi0JZW5naW5lLT53YV9jdHgu
dm1hID0gdm1hOwotCXJldHVybiAwOwotCi1lcnI6Ci0JaTkxNV9nZW1fb2JqZWN0X3B1dChvYmop
OwotCXJldHVybiBlcnI7Ci19Ci0KLXN0YXRpYyB2b2lkIGxyY19kZXN0cm95X3dhX2N0eChzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCi17Ci0JaTkxNV92bWFfdW5waW5fYW5kX3JlbGVh
c2UoJmVuZ2luZS0+d2FfY3R4LnZtYSwgMCk7Ci19Ci0KLXR5cGVkZWYgdTMyICooKndhX2JiX2Z1
bmNfdCkoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCB1MzIgKmJhdGNoKTsKLQotc3Rh
dGljIGludCBpbnRlbF9pbml0X3dvcmthcm91bmRfYmIoc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lKQotewotCXN0cnVjdCBpOTE1X2N0eF93b3JrYXJvdW5kcyAqd2FfY3R4ID0gJmVuZ2lu
ZS0+d2FfY3R4OwotCXN0cnVjdCBpOTE1X3dhX2N0eF9iYiAqd2FfYmJbMl0gPSB7ICZ3YV9jdHgt
PmluZGlyZWN0X2N0eCwKLQkJCQkJICAgICZ3YV9jdHgtPnBlcl9jdHggfTsKLQl3YV9iYl9mdW5j
X3Qgd2FfYmJfZm5bMl07Ci0Jdm9pZCAqYmF0Y2gsICpiYXRjaF9wdHI7Ci0JdW5zaWduZWQgaW50
IGk7Ci0JaW50IHJldDsKLQotCWlmIChlbmdpbmUtPmNsYXNzICE9IFJFTkRFUl9DTEFTUykKLQkJ
cmV0dXJuIDA7Ci0KLQlzd2l0Y2ggKElOVEVMX0dFTihlbmdpbmUtPmk5MTUpKSB7Ci0JY2FzZSAx
MjoKLQljYXNlIDExOgotCQlyZXR1cm4gMDsKLQljYXNlIDEwOgotCQl3YV9iYl9mblswXSA9IGdl
bjEwX2luaXRfaW5kaXJlY3RjdHhfYmI7Ci0JCXdhX2JiX2ZuWzFdID0gTlVMTDsKLQkJYnJlYWs7
Ci0JY2FzZSA5OgotCQl3YV9iYl9mblswXSA9IGdlbjlfaW5pdF9pbmRpcmVjdGN0eF9iYjsKLQkJ
d2FfYmJfZm5bMV0gPSBOVUxMOwotCQlicmVhazsKLQljYXNlIDg6Ci0JCXdhX2JiX2ZuWzBdID0g
Z2VuOF9pbml0X2luZGlyZWN0Y3R4X2JiOwotCQl3YV9iYl9mblsxXSA9IE5VTEw7Ci0JCWJyZWFr
OwotCWRlZmF1bHQ6Ci0JCU1JU1NJTkdfQ0FTRShJTlRFTF9HRU4oZW5naW5lLT5pOTE1KSk7Ci0J
CXJldHVybiAwOwotCX0KLQotCXJldCA9IGxyY19zZXR1cF93YV9jdHgoZW5naW5lKTsKLQlpZiAo
cmV0KSB7Ci0JCWRybV9kYmcoJmVuZ2luZS0+aTkxNS0+ZHJtLAotCQkJIkZhaWxlZCB0byBzZXR1
cCBjb250ZXh0IFdBIHBhZ2U6ICVkXG4iLCByZXQpOwotCQlyZXR1cm4gcmV0OwotCX0KLQotCWJh
dGNoID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAod2FfY3R4LT52bWEtPm9iaiwgSTkxNV9NQVBf
V0IpOwotCi0JLyoKLQkgKiBFbWl0IHRoZSB0d28gd29ya2Fyb3VuZCBiYXRjaCBidWZmZXJzLCBy
ZWNvcmRpbmcgdGhlIG9mZnNldCBmcm9tIHRoZQotCSAqIHN0YXJ0IG9mIHRoZSB3b3JrYXJvdW5k
IGJhdGNoIGJ1ZmZlciBvYmplY3QgZm9yIGVhY2ggYW5kIHRoZWlyCi0JICogcmVzcGVjdGl2ZSBz
aXplcy4KLQkgKi8KLQliYXRjaF9wdHIgPSBiYXRjaDsKLQlmb3IgKGkgPSAwOyBpIDwgQVJSQVlf
U0laRSh3YV9iYl9mbik7IGkrKykgewotCQl3YV9iYltpXS0+b2Zmc2V0ID0gYmF0Y2hfcHRyIC0g
YmF0Y2g7Ci0JCWlmIChHRU1fREVCVUdfV0FSTl9PTighSVNfQUxJR05FRCh3YV9iYltpXS0+b2Zm
c2V0LAotCQkJCQkJICBDQUNIRUxJTkVfQllURVMpKSkgewotCQkJcmV0ID0gLUVJTlZBTDsKLQkJ
CWJyZWFrOwotCQl9Ci0JCWlmICh3YV9iYl9mbltpXSkKLQkJCWJhdGNoX3B0ciA9IHdhX2JiX2Zu
W2ldKGVuZ2luZSwgYmF0Y2hfcHRyKTsKLQkJd2FfYmJbaV0tPnNpemUgPSBiYXRjaF9wdHIgLSAo
YmF0Y2ggKyB3YV9iYltpXS0+b2Zmc2V0KTsKLQl9Ci0JR0VNX0JVR19PTihiYXRjaF9wdHIgLSBi
YXRjaCA+IENUWF9XQV9CQl9PQkpfU0laRSk7Ci0KLQlfX2k5MTVfZ2VtX29iamVjdF9mbHVzaF9t
YXAod2FfY3R4LT52bWEtPm9iaiwgMCwgYmF0Y2hfcHRyIC0gYmF0Y2gpOwotCV9faTkxNV9nZW1f
b2JqZWN0X3JlbGVhc2VfbWFwKHdhX2N0eC0+dm1hLT5vYmopOwotCWlmIChyZXQpCi0JCWxyY19k
ZXN0cm95X3dhX2N0eChlbmdpbmUpOwotCi0JcmV0dXJuIHJldDsKLX0KLQogc3RhdGljIHZvaWQg
cmVzZXRfY3NiX3BvaW50ZXJzKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKIAlz
dHJ1Y3QgaW50ZWxfZW5naW5lX2V4ZWNsaXN0cyAqIGNvbnN0IGV4ZWNsaXN0cyA9ICZlbmdpbmUt
PmV4ZWNsaXN0czsKQEAgLTQxODUsMjUgKzI5MjksNiBAQCBzdGF0aWMgdm9pZCBleGVjbGlzdHNf
cmVzZXRfcHJlcGFyZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJZW5naW5lLT5l
eGVjbGlzdHMucmVzZXRfY2NpZCA9IGFjdGl2ZV9jY2lkKGVuZ2luZSk7CiB9CiAKLXN0YXRpYyB2
b2lkIF9fcmVzZXRfc3RvcF9yaW5nKHUzMiAqcmVncywgY29uc3Qgc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lKQotewotCWludCB4OwotCi0JeCA9IGxyY19yaW5nX21pX21vZGUoZW5naW5l
KTsKLQlpZiAoeCAhPSAtMSkgewotCQlyZWdzW3ggKyAxXSAmPSB+U1RPUF9SSU5HOwotCQlyZWdz
W3ggKyAxXSB8PSBTVE9QX1JJTkcgPDwgMTY7Ci0JfQotfQotCi1zdGF0aWMgdm9pZCBfX2V4ZWNs
aXN0c19yZXNldF9yZWdfc3RhdGUoY29uc3Qgc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAotCQkJ
CQljb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCi17Ci0JdTMyICpyZWdzID0g
Y2UtPmxyY19yZWdfc3RhdGU7Ci0KLQlfX3Jlc2V0X3N0b3BfcmluZyhyZWdzLCBlbmdpbmUpOwot
fQotCiBzdGF0aWMgdm9pZCBfX2V4ZWNsaXN0c19yZXNldChzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmUsIGJvb2wgc3RhbGxlZCkKIHsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2V4ZWNsaXN0
cyAqIGNvbnN0IGV4ZWNsaXN0cyA9ICZlbmdpbmUtPmV4ZWNsaXN0czsKQEAgLTQyODcsOCArMzAx
Miw4IEBAIHN0YXRpYyB2b2lkIF9fZXhlY2xpc3RzX3Jlc2V0KHN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmVuZ2luZSwgYm9vbCBzdGFsbGVkKQogb3V0X3JlcGxheToKIAlFTkdJTkVfVFJBQ0UoZW5n
aW5lLCAicmVwbGF5IHtoZWFkOiUwNHgsIHRhaWw6JTA0eH1cbiIsCiAJCSAgICAgaGVhZCwgY2Ut
PnJpbmctPnRhaWwpOwotCV9fZXhlY2xpc3RzX3Jlc2V0X3JlZ19zdGF0ZShjZSwgZW5naW5lKTsK
LQlfX2V4ZWNsaXN0c191cGRhdGVfcmVnX3N0YXRlKGNlLCBlbmdpbmUsIGhlYWQpOworCWxyY19y
ZXNldF9yZWdzKGNlLCBlbmdpbmUpOworCWxyY191cGRhdGVfcmVncyhjZSwgZW5naW5lLCBoZWFk
KTsKIAljZS0+bHJjLmRlc2MgfD0gQ1RYX0RFU0NfRk9SQ0VfUkVTVE9SRTsgLyogcGFyYW5vaWQ6
IEdQVSB3YXMgcmVzZXQhICovCiAKIHVud2luZDoKQEAgLTQ0ODcsNyArMzIxMiw3IEBAIHN0YXRp
YyB2b2lkIGV4ZWNsaXN0c19yZWxlYXNlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkK
IAlleGVjbGlzdHNfc2h1dGRvd24oZW5naW5lKTsKIAogCWludGVsX2VuZ2luZV9jbGVhbnVwX2Nv
bW1vbihlbmdpbmUpOwotCWxyY19kZXN0cm95X3dhX2N0eChlbmdpbmUpOworCWxyY19maW5pX3dh
X2N0eChlbmdpbmUpOwogfQogCiBzdGF0aWMgdm9pZApAQCAtNDU4MSw3ICszMzA2LDcgQEAgaW50
IGludGVsX2V4ZWNsaXN0c19zdWJtaXNzaW9uX3NldHVwKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZSkKIAlpZiAoZW5naW5lLT5jbGFzcyA9PSBSRU5ERVJfQ0xBU1MpCiAJCXJjc19zdWJt
aXNzaW9uX292ZXJyaWRlKGVuZ2luZSk7CiAKLQlpZiAoaW50ZWxfaW5pdF93b3JrYXJvdW5kX2Ji
KGVuZ2luZSkpCisJaWYgKGxyY19pbml0X3dhX2N0eChlbmdpbmUpKQogCQkvKgogCQkgKiBXZSBj
b250aW51ZSBldmVuIGlmIHdlIGZhaWwgdG8gaW5pdGlhbGl6ZSBXQSBiYXRjaAogCQkgKiBiZWNh
dXNlIHdlIG9ubHkgZXhwZWN0IHJhcmUgZ2xpdGNoZXMgYnV0IG5vdGhpbmcKQEAgLTQ2MjIsMTM2
ICszMzQ3LDYgQEAgaW50IGludGVsX2V4ZWNsaXN0c19zdWJtaXNzaW9uX3NldHVwKHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHZvaWQgaW5p
dF9jb21tb25fcmVnX3N0YXRlKHUzMiAqIGNvbnN0IHJlZ3MsCi0JCQkJICBjb25zdCBzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUsCi0JCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfcmluZyAq
cmluZywKLQkJCQkgIGJvb2wgaW5oaWJpdCkKLXsKLQl1MzIgY3RsOwotCi0JY3RsID0gX01BU0tF
RF9CSVRfRU5BQkxFKENUWF9DVFJMX0lOSElCSVRfU1lOX0NUWF9TV0lUQ0gpOwotCWN0bCB8PSBf
TUFTS0VEX0JJVF9ESVNBQkxFKENUWF9DVFJMX0VOR0lORV9DVFhfUkVTVE9SRV9JTkhJQklUKTsK
LQlpZiAoaW5oaWJpdCkKLQkJY3RsIHw9IENUWF9DVFJMX0VOR0lORV9DVFhfUkVTVE9SRV9JTkhJ
QklUOwotCWlmIChJTlRFTF9HRU4oZW5naW5lLT5pOTE1KSA8IDExKQotCQljdGwgfD0gX01BU0tF
RF9CSVRfRElTQUJMRShDVFhfQ1RSTF9FTkdJTkVfQ1RYX1NBVkVfSU5ISUJJVCB8Ci0JCQkJCSAg
IENUWF9DVFJMX1JTX0NUWF9FTkFCTEUpOwotCXJlZ3NbQ1RYX0NPTlRFWFRfQ09OVFJPTF0gPSBj
dGw7Ci0KLQlyZWdzW0NUWF9SSU5HX0NUTF0gPSBSSU5HX0NUTF9TSVpFKHJpbmctPnNpemUpIHwg
UklOR19WQUxJRDsKLQlyZWdzW0NUWF9USU1FU1RBTVBdID0gMDsKLX0KLQotc3RhdGljIHZvaWQg
aW5pdF93YV9iYl9yZWdfc3RhdGUodTMyICogY29uc3QgcmVncywKLQkJCQkgY29uc3Qgc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQotewotCWNvbnN0IHN0cnVjdCBpOTE1X2N0eF93b3Jr
YXJvdW5kcyAqIGNvbnN0IHdhX2N0eCA9ICZlbmdpbmUtPndhX2N0eDsKLQotCWlmICh3YV9jdHgt
PnBlcl9jdHguc2l6ZSkgewotCQljb25zdCB1MzIgZ2d0dF9vZmZzZXQgPSBpOTE1X2dndHRfb2Zm
c2V0KHdhX2N0eC0+dm1hKTsKLQotCQlHRU1fQlVHX09OKGxyY19yaW5nX3dhX2JiX3Blcl9jdHgo
ZW5naW5lKSA9PSAtMSk7Ci0JCXJlZ3NbbHJjX3Jpbmdfd2FfYmJfcGVyX2N0eChlbmdpbmUpICsg
MV0gPQotCQkJKGdndHRfb2Zmc2V0ICsgd2FfY3R4LT5wZXJfY3R4Lm9mZnNldCkgfCAweDAxOwot
CX0KLQotCWlmICh3YV9jdHgtPmluZGlyZWN0X2N0eC5zaXplKSB7Ci0JCWxyY19yaW5nX3NldHVw
X2luZGlyZWN0X2N0eChyZWdzLCBlbmdpbmUsCi0JCQkJCSAgICBpOTE1X2dndHRfb2Zmc2V0KHdh
X2N0eC0+dm1hKSArCi0JCQkJCSAgICB3YV9jdHgtPmluZGlyZWN0X2N0eC5vZmZzZXQsCi0JCQkJ
CSAgICB3YV9jdHgtPmluZGlyZWN0X2N0eC5zaXplKTsKLQl9Ci19Ci0KLXN0YXRpYyB2b2lkIGlu
aXRfcHBndHRfcmVnX3N0YXRlKHUzMiAqcmVncywgY29uc3Qgc3RydWN0IGk5MTVfcHBndHQgKnBw
Z3R0KQotewotCWlmIChpOTE1X3ZtX2lzXzRsdmwoJnBwZ3R0LT52bSkpIHsKLQkJLyogNjRiIFBQ
R1RUICg0OGJpdCBjYW5vbmljYWwpCi0JCSAqIFBEUDBfREVTQ1JJUFRPUiBjb250YWlucyB0aGUg
YmFzZSBhZGRyZXNzIHRvIFBNTDQgYW5kCi0JCSAqIG90aGVyIFBEUCBEZXNjcmlwdG9ycyBhcmUg
aWdub3JlZC4KLQkJICovCi0JCUFTU0lHTl9DVFhfUE1MNChwcGd0dCwgcmVncyk7Ci0JfSBlbHNl
IHsKLQkJQVNTSUdOX0NUWF9QRFAocHBndHQsIHJlZ3MsIDMpOwotCQlBU1NJR05fQ1RYX1BEUChw
cGd0dCwgcmVncywgMik7Ci0JCUFTU0lHTl9DVFhfUERQKHBwZ3R0LCByZWdzLCAxKTsKLQkJQVNT
SUdOX0NUWF9QRFAocHBndHQsIHJlZ3MsIDApOwotCX0KLX0KLQotc3RhdGljIHN0cnVjdCBpOTE1
X3BwZ3R0ICp2bV9hbGlhcyhzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKLXsKLQlpZiAo
aTkxNV9pc19nZ3R0KHZtKSkKLQkJcmV0dXJuIGk5MTVfdm1fdG9fZ2d0dCh2bSktPmFsaWFzOwot
CWVsc2UKLQkJcmV0dXJuIGk5MTVfdm1fdG9fcHBndHQodm0pOwotfQotCi1zdGF0aWMgdm9pZCBl
eGVjbGlzdHNfaW5pdF9yZWdfc3RhdGUodTMyICpyZWdzLAotCQkJCSAgICAgY29uc3Qgc3RydWN0
IGludGVsX2NvbnRleHQgKmNlLAotCQkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lLAotCQkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX3JpbmcgKnJpbmcsCi0JCQkJ
ICAgICBib29sIGluaGliaXQpCi17Ci0JLyoKLQkgKiBBIGNvbnRleHQgaXMgYWN0dWFsbHkgYSBi
aWcgYmF0Y2ggYnVmZmVyIHdpdGggc2V2ZXJhbAotCSAqIE1JX0xPQURfUkVHSVNURVJfSU1NIGNv
bW1hbmRzIGZvbGxvd2VkIGJ5IChyZWcsIHZhbHVlKSBwYWlycy4gVGhlCi0JICogdmFsdWVzIHdl
IGFyZSBzZXR0aW5nIGhlcmUgYXJlIG9ubHkgZm9yIHRoZSBmaXJzdCBjb250ZXh0IHJlc3RvcmU6
Ci0JICogb24gYSBzdWJzZXF1ZW50IHNhdmUsIHRoZSBHUFUgd2lsbCByZWNyZWF0ZSB0aGlzIGJh
dGNoYnVmZmVyIHdpdGggbmV3Ci0JICogdmFsdWVzIChpbmNsdWRpbmcgYWxsIHRoZSBtaXNzaW5n
IE1JX0xPQURfUkVHSVNURVJfSU1NIGNvbW1hbmRzIHRoYXQKLQkgKiB3ZSBhcmUgbm90IGluaXRp
YWxpemluZyBoZXJlKS4KLQkgKgotCSAqIE11c3Qga2VlcCBjb25zaXN0ZW50IHdpdGggdmlydHVh
bF91cGRhdGVfcmVnaXN0ZXJfb2Zmc2V0cygpLgotCSAqLwotCXNldF9vZmZzZXRzKHJlZ3MsIHJl
Z19vZmZzZXRzKGVuZ2luZSksIGVuZ2luZSwgaW5oaWJpdCk7Ci0KLQlpbml0X2NvbW1vbl9yZWdf
c3RhdGUocmVncywgZW5naW5lLCByaW5nLCBpbmhpYml0KTsKLQlpbml0X3BwZ3R0X3JlZ19zdGF0
ZShyZWdzLCB2bV9hbGlhcyhjZS0+dm0pKTsKLQotCWluaXRfd2FfYmJfcmVnX3N0YXRlKHJlZ3Ms
IGVuZ2luZSk7Ci0KLQlfX3Jlc2V0X3N0b3BfcmluZyhyZWdzLCBlbmdpbmUpOwotfQotCi1zdGF0
aWMgaW50Ci1wb3B1bGF0ZV9scl9jb250ZXh0KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKLQkJ
ICAgIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpjdHhfb2JqLAotCQkgICAgc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqZW5naW5lLAotCQkgICAgc3RydWN0IGludGVsX3JpbmcgKnJpbmcpCi17
Ci0JYm9vbCBpbmhpYml0ID0gdHJ1ZTsKLQl2b2lkICp2YWRkcjsKLQotCXZhZGRyID0gaTkxNV9n
ZW1fb2JqZWN0X3Bpbl9tYXAoY3R4X29iaiwgSTkxNV9NQVBfV0IpOwotCWlmIChJU19FUlIodmFk
ZHIpKSB7Ci0JCWRybV9kYmcoJmVuZ2luZS0+aTkxNS0+ZHJtLCAiQ291bGQgbm90IG1hcCBvYmpl
Y3QgcGFnZXMhXG4iKTsKLQkJcmV0dXJuIFBUUl9FUlIodmFkZHIpOwotCX0KLQotCXNldF9yZWR6
b25lKHZhZGRyLCBlbmdpbmUpOwotCi0JaWYgKGVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSkgewotCQlz
aG1lbV9yZWFkKGVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSwgMCwKLQkJCSAgIHZhZGRyLCBlbmdpbmUt
PmNvbnRleHRfc2l6ZSk7Ci0JCV9fc2V0X2JpdChDT05URVhUX1ZBTElEX0JJVCwgJmNlLT5mbGFn
cyk7Ci0JCWluaGliaXQgPSBmYWxzZTsKLQl9Ci0KLQkvKiBDbGVhciB0aGUgcHBIV1NQIChpbmMu
IHBlci1jb250ZXh0IGNvdW50ZXJzKSAqLwotCW1lbXNldCh2YWRkciwgMCwgUEFHRV9TSVpFKTsK
LQotCS8qCi0JICogVGhlIHNlY29uZCBwYWdlIG9mIHRoZSBjb250ZXh0IG9iamVjdCBjb250YWlu
cyBzb21lIHJlZ2lzdGVycyB3aGljaAotCSAqIG11c3QgYmUgc2V0IHVwIHByaW9yIHRvIHRoZSBm
aXJzdCBleGVjdXRpb24uCi0JICovCi0JZXhlY2xpc3RzX2luaXRfcmVnX3N0YXRlKHZhZGRyICsg
TFJDX1NUQVRFX09GRlNFVCwKLQkJCQkgY2UsIGVuZ2luZSwgcmluZywgaW5oaWJpdCk7Ci0KLQlf
X2k5MTVfZ2VtX29iamVjdF9mbHVzaF9tYXAoY3R4X29iaiwgMCwgZW5naW5lLT5jb250ZXh0X3Np
emUpOwotCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAoY3R4X29iaik7Ci0JcmV0dXJuIDA7Ci19
Ci0KIHN0YXRpYyBzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnBpbm5lZF90aW1lbGluZShzdHJ1Y3Qg
aW50ZWxfY29udGV4dCAqY2UpCiB7CiAJc3RydWN0IGludGVsX3RpbWVsaW5lICp0bCA9IGZldGNo
X2FuZF96ZXJvKCZjZS0+dGltZWxpbmUpOwpAQCAtNDc2MywzMiArMzM1OCwxMSBAQCBzdGF0aWMg
c3RydWN0IGludGVsX3RpbWVsaW5lICpwaW5uZWRfdGltZWxpbmUoc3RydWN0IGludGVsX2NvbnRl
eHQgKmNlKQogc3RhdGljIGludCBfX2V4ZWNsaXN0c19jb250ZXh0X2FsbG9jKHN0cnVjdCBpbnRl
bF9jb250ZXh0ICpjZSwKIAkJCQkgICAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkK
IHsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqY3R4X29iajsKLQlzdHJ1Y3QgaW50ZWxf
cmluZyAqcmluZzsKLQlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKLQl1MzIgY29udGV4dF9zaXplOwot
CWludCByZXQ7Ci0KLQlHRU1fQlVHX09OKGNlLT5zdGF0ZSk7Ci0JY29udGV4dF9zaXplID0gcm91
bmRfdXAoZW5naW5lLT5jb250ZXh0X3NpemUsIEk5MTVfR1RUX1BBR0VfU0laRSk7Ci0KLQlpZiAo
SVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfREVCVUdfR0VNKSkKLQkJY29udGV4dF9zaXplICs9
IEk5MTVfR1RUX1BBR0VfU0laRTsgLyogZm9yIHJlZHpvbmUgKi8KLQotCWlmIChJTlRFTF9HRU4o
ZW5naW5lLT5pOTE1KSA9PSAxMikgewotCQljZS0+d2FfYmJfcGFnZSA9IGNvbnRleHRfc2l6ZSAv
IFBBR0VfU0laRTsKLQkJY29udGV4dF9zaXplICs9IFBBR0VfU0laRTsKLQl9Ci0KLQljdHhfb2Jq
ID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zaG1lbShlbmdpbmUtPmk5MTUsIGNvbnRleHRfc2l6
ZSk7Ci0JaWYgKElTX0VSUihjdHhfb2JqKSkKLQkJcmV0dXJuIFBUUl9FUlIoY3R4X29iaik7CisJ
aW50IGVycjsKIAotCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKGN0eF9vYmosICZlbmdpbmUtPmd0
LT5nZ3R0LT52bSwgTlVMTCk7Ci0JaWYgKElTX0VSUih2bWEpKSB7Ci0JCXJldCA9IFBUUl9FUlIo
dm1hKTsKLQkJZ290byBlcnJvcl9kZXJlZl9vYmo7Ci0JfQorCWVyciA9IGxyY19hbGxvYyhjZSwg
ZW5naW5lKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOwogCiAJaWYgKCFwYWdlX21hc2tfYml0
cyhjZS0+dGltZWxpbmUpKSB7CiAJCXN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGw7CkBAIC00ODAx
LDM3ICszMzc1LDEzIEBAIHN0YXRpYyBpbnQgX19leGVjbGlzdHNfY29udGV4dF9hbGxvYyhzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJCQl0bCA9IHBpbm5lZF90aW1lbGluZShjZSk7CiAJCWVs
c2UKIAkJCXRsID0gaW50ZWxfdGltZWxpbmVfY3JlYXRlKGVuZ2luZS0+Z3QpOwotCQlpZiAoSVNf
RVJSKHRsKSkgewotCQkJcmV0ID0gUFRSX0VSUih0bCk7Ci0JCQlnb3RvIGVycm9yX2RlcmVmX29i
ajsKLQkJfQorCQlpZiAoSVNfRVJSKHRsKSkKKwkJCXJldHVybiBQVFJfRVJSKHRsKTsKIAogCQlj
ZS0+dGltZWxpbmUgPSB0bDsKIAl9CiAKLQlyaW5nID0gaW50ZWxfZW5naW5lX2NyZWF0ZV9yaW5n
KGVuZ2luZSwgKHVuc2lnbmVkIGxvbmcpY2UtPnJpbmcpOwotCWlmIChJU19FUlIocmluZykpIHsK
LQkJcmV0ID0gUFRSX0VSUihyaW5nKTsKLQkJZ290byBlcnJvcl9kZXJlZl9vYmo7Ci0JfQotCi0J
cmV0ID0gcG9wdWxhdGVfbHJfY29udGV4dChjZSwgY3R4X29iaiwgZW5naW5lLCByaW5nKTsKLQlp
ZiAocmV0KSB7Ci0JCWRybV9kYmcoJmVuZ2luZS0+aTkxNS0+ZHJtLAotCQkJIkZhaWxlZCB0byBw
b3B1bGF0ZSBMUkM6ICVkXG4iLCByZXQpOwotCQlnb3RvIGVycm9yX3JpbmdfZnJlZTsKLQl9Ci0K
LQljZS0+cmluZyA9IHJpbmc7Ci0JY2UtPnN0YXRlID0gdm1hOwotCiAJcmV0dXJuIDA7Ci0KLWVy
cm9yX3JpbmdfZnJlZToKLQlpbnRlbF9yaW5nX3B1dChyaW5nKTsKLWVycm9yX2RlcmVmX29iajoK
LQlpOTE1X2dlbV9vYmplY3RfcHV0KGN0eF9vYmopOwotCXJldHVybiByZXQ7CiB9CiAKIHN0YXRp
YyBzdHJ1Y3QgbGlzdF9oZWFkICp2aXJ0dWFsX3F1ZXVlKHN0cnVjdCB2aXJ0dWFsX2VuZ2luZSAq
dmUpCkBAIC01NDcwLDI4ICs0MDIwLDYgQEAgdm9pZCBpbnRlbF9leGVjbGlzdHNfc2hvd19yZXF1
ZXN0cyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJc3Bpbl91bmxvY2tfaXJxcmVz
dG9yZSgmZW5naW5lLT5hY3RpdmUubG9jaywgZmxhZ3MpOwogfQogCi12b2lkIGludGVsX2xyX2Nv
bnRleHRfcmVzZXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAotCQkJICAgIHN0cnVj
dCBpbnRlbF9jb250ZXh0ICpjZSwKLQkJCSAgICB1MzIgaGVhZCwKLQkJCSAgICBib29sIHNjcnVi
KQotewotCUdFTV9CVUdfT04oIWludGVsX2NvbnRleHRfaXNfcGlubmVkKGNlKSk7Ci0KLQkvKgot
CSAqIFdlIHdhbnQgYSBzaW1wbGUgY29udGV4dCArIHJpbmcgdG8gZXhlY3V0ZSB0aGUgYnJlYWRj
cnVtYiB1cGRhdGUuCi0JICogV2UgY2Fubm90IHJlbHkgb24gdGhlIGNvbnRleHQgYmVpbmcgaW50
YWN0IGFjcm9zcyB0aGUgR1BVIGhhbmcsCi0JICogc28gY2xlYXIgaXQgYW5kIHJlYnVpbGQganVz
dCB3aGF0IHdlIG5lZWQgZm9yIHRoZSBicmVhZGNydW1iLgotCSAqIEFsbCBwZW5kaW5nIHJlcXVl
c3RzIGZvciB0aGlzIGNvbnRleHQgd2lsbCBiZSB6YXBwZWQsIGFuZCBhbnkKLQkgKiBmdXR1cmUg
cmVxdWVzdCB3aWxsIGJlIGFmdGVyIHVzZXJzcGFjZSBoYXMgaGFkIHRoZSBvcHBvcnR1bml0eQot
CSAqIHRvIHJlY3JlYXRlIGl0cyBvd24gc3RhdGUuCi0JICovCi0JaWYgKHNjcnViKQotCQlyZXN0
b3JlX2RlZmF1bHRfc3RhdGUoY2UsIGVuZ2luZSk7Ci0KLQkvKiBSZXJ1biB0aGUgcmVxdWVzdDsg
aXRzIHBheWxvYWQgaGFzIGJlZW4gbmV1dGVyZWQgKGlmIGd1aWx0eSkuICovCi0JX19leGVjbGlz
dHNfdXBkYXRlX3JlZ19zdGF0ZShjZSwgZW5naW5lLCBoZWFkKTsKLX0KLQogYm9vbAogaW50ZWxf
ZW5naW5lX2luX2V4ZWNsaXN0c19zdWJtaXNzaW9uX21vZGUoY29uc3Qgc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lKQogewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYwpuZXcgZmls
ZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjUyNGEzMDU0MWZkNQotLS0gL2Rldi9u
dWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCkBAIC0wLDAgKzEs
MTQ0OCBAQAorLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAorLyoKKyAqIENvcHlyaWdo
dCDCqSAyMDE0IEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2luY2x1ZGUgImk5MTVfZHJ2Lmgi
CisjaW5jbHVkZSAiaTkxNV9wZXJmLmgiCisjaW5jbHVkZSAiaW50ZWxfZW5naW5lLmgiCisjaW5j
bHVkZSAiaW50ZWxfZ3QuaCIKKyNpbmNsdWRlICJpbnRlbF9scmMuaCIKKyNpbmNsdWRlICJpbnRl
bF9scmNfcmVnLmgiCisjaW5jbHVkZSAiaW50ZWxfcmluZy5oIgorI2luY2x1ZGUgInNobWVtX3V0
aWxzLmgiCisKK3N0YXRpYyBpbmxpbmUgdW5zaWduZWQgaW50IGR3b3JkX2luX3BhZ2Uodm9pZCAq
YWRkcikKK3sKKwlyZXR1cm4gb2Zmc2V0X2luX3BhZ2UoYWRkcikgLyBzaXplb2YodTMyKTsKK30K
Kworc3RhdGljIHZvaWQgc2V0X29mZnNldHModTMyICpyZWdzLAorCQkJY29uc3QgdTggKmRhdGEs
CisJCQljb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCisJCQlib29sIGNsZWFy
KQorI2RlZmluZSBOT1AoeCkgKEJJVCg3KSB8ICh4KSkKKyNkZWZpbmUgTFJJKGNvdW50LCBmbGFn
cykgKChmbGFncykgPDwgNiB8IChjb3VudCkgfCBCVUlMRF9CVUdfT05fWkVSTyhjb3VudCA+PSBC
SVQoNikpKQorI2RlZmluZSBQT1NURUQgQklUKDApCisjZGVmaW5lIFJFRyh4KSAoKCh4KSA+PiAy
KSB8IEJVSUxEX0JVR19PTl9aRVJPKHggPj0gMHgyMDApKQorI2RlZmluZSBSRUcxNih4KSBcCisJ
KCgoeCkgPj4gOSkgfCBCSVQoNykgfCBCVUlMRF9CVUdfT05fWkVSTyh4ID49IDB4MTAwMDApKSwg
XAorCSgoKHgpID4+IDIpICYgMHg3ZikKKyNkZWZpbmUgRU5EKHRvdGFsX3N0YXRlX3NpemUpIDAs
ICh0b3RhbF9zdGF0ZV9zaXplKQoreworCWNvbnN0IHUzMiBiYXNlID0gZW5naW5lLT5tbWlvX2Jh
c2U7CisKKwl3aGlsZSAoKmRhdGEpIHsKKwkJdTggY291bnQsIGZsYWdzOworCisJCWlmICgqZGF0
YSAmIEJJVCg3KSkgeyAvKiBza2lwICovCisJCQljb3VudCA9ICpkYXRhKysgJiB+QklUKDcpOwor
CQkJaWYgKGNsZWFyKQorCQkJCW1lbXNldDMyKHJlZ3MsIE1JX05PT1AsIGNvdW50KTsKKwkJCXJl
Z3MgKz0gY291bnQ7CisJCQljb250aW51ZTsKKwkJfQorCisJCWNvdW50ID0gKmRhdGEgJiAweDNm
OworCQlmbGFncyA9ICpkYXRhID4+IDY7CisJCWRhdGErKzsKKworCQkqcmVncyA9IE1JX0xPQURf
UkVHSVNURVJfSU1NKGNvdW50KTsKKwkJaWYgKGZsYWdzICYgUE9TVEVEKQorCQkJKnJlZ3MgfD0g
TUlfTFJJX0ZPUkNFX1BPU1RFRDsKKwkJaWYgKElOVEVMX0dFTihlbmdpbmUtPmk5MTUpID49IDEx
KQorCQkJKnJlZ3MgfD0gTUlfTFJJX0xSTV9DU19NTUlPOworCQlyZWdzKys7CisKKwkJR0VNX0JV
R19PTighY291bnQpOworCQlkbyB7CisJCQl1MzIgb2Zmc2V0ID0gMDsKKwkJCXU4IHY7CisKKwkJ
CWRvIHsKKwkJCQl2ID0gKmRhdGErKzsKKwkJCQlvZmZzZXQgPDw9IDc7CisJCQkJb2Zmc2V0IHw9
IHYgJiB+QklUKDcpOworCQkJfSB3aGlsZSAodiAmIEJJVCg3KSk7CisKKwkJCXJlZ3NbMF0gPSBi
YXNlICsgKG9mZnNldCA8PCAyKTsKKwkJCWlmIChjbGVhcikKKwkJCQlyZWdzWzFdID0gMDsKKwkJ
CXJlZ3MgKz0gMjsKKwkJfSB3aGlsZSAoLS1jb3VudCk7CisJfQorCisJaWYgKGNsZWFyKSB7CisJ
CXU4IGNvdW50ID0gKisrZGF0YTsKKworCQkvKiBDbGVhciBwYXN0IHRoZSB0YWlsIGZvciBIVyBh
Y2Nlc3MgKi8KKwkJR0VNX0JVR19PTihkd29yZF9pbl9wYWdlKHJlZ3MpID4gY291bnQpOworCQlt
ZW1zZXQzMihyZWdzLCBNSV9OT09QLCBjb3VudCAtIGR3b3JkX2luX3BhZ2UocmVncykpOworCisJ
CS8qIENsb3NlIHRoZSBiYXRjaDsgdXNlZCBtYWlubHkgYnkgbGl2ZV9scmNfbGF5b3V0KCkgKi8K
KwkJKnJlZ3MgPSBNSV9CQVRDSF9CVUZGRVJfRU5EOworCQlpZiAoSU5URUxfR0VOKGVuZ2luZS0+
aTkxNSkgPj0gMTApCisJCQkqcmVncyB8PSBCSVQoMCk7CisJfQorfQorCitzdGF0aWMgY29uc3Qg
dTggZ2VuOF94Y3Nfb2Zmc2V0c1tdID0geworCU5PUCgxKSwKKwlMUkkoMTEsIDApLAorCVJFRzE2
KDB4MjQ0KSwKKwlSRUcoMHgwMzQpLAorCVJFRygweDAzMCksCisJUkVHKDB4MDM4KSwKKwlSRUco
MHgwM2MpLAorCVJFRygweDE2OCksCisJUkVHKDB4MTQwKSwKKwlSRUcoMHgxMTApLAorCVJFRygw
eDExYyksCisJUkVHKDB4MTE0KSwKKwlSRUcoMHgxMTgpLAorCisJTk9QKDkpLAorCUxSSSg5LCAw
KSwKKwlSRUcxNigweDNhOCksCisJUkVHMTYoMHgyOGMpLAorCVJFRzE2KDB4Mjg4KSwKKwlSRUcx
NigweDI4NCksCisJUkVHMTYoMHgyODApLAorCVJFRzE2KDB4MjdjKSwKKwlSRUcxNigweDI3OCks
CisJUkVHMTYoMHgyNzQpLAorCVJFRzE2KDB4MjcwKSwKKworCU5PUCgxMyksCisJTFJJKDIsIDAp
LAorCVJFRzE2KDB4MjAwKSwKKwlSRUcoMHgwMjgpLAorCisJRU5EKDgwKQorfTsKKworc3RhdGlj
IGNvbnN0IHU4IGdlbjlfeGNzX29mZnNldHNbXSA9IHsKKwlOT1AoMSksCisJTFJJKDE0LCBQT1NU
RUQpLAorCVJFRzE2KDB4MjQ0KSwKKwlSRUcoMHgwMzQpLAorCVJFRygweDAzMCksCisJUkVHKDB4
MDM4KSwKKwlSRUcoMHgwM2MpLAorCVJFRygweDE2OCksCisJUkVHKDB4MTQwKSwKKwlSRUcoMHgx
MTApLAorCVJFRygweDExYyksCisJUkVHKDB4MTE0KSwKKwlSRUcoMHgxMTgpLAorCVJFRygweDFj
MCksCisJUkVHKDB4MWM0KSwKKwlSRUcoMHgxYzgpLAorCisJTk9QKDMpLAorCUxSSSg5LCBQT1NU
RUQpLAorCVJFRzE2KDB4M2E4KSwKKwlSRUcxNigweDI4YyksCisJUkVHMTYoMHgyODgpLAorCVJF
RzE2KDB4Mjg0KSwKKwlSRUcxNigweDI4MCksCisJUkVHMTYoMHgyN2MpLAorCVJFRzE2KDB4Mjc4
KSwKKwlSRUcxNigweDI3NCksCisJUkVHMTYoMHgyNzApLAorCisJTk9QKDEzKSwKKwlMUkkoMSwg
UE9TVEVEKSwKKwlSRUcxNigweDIwMCksCisKKwlOT1AoMTMpLAorCUxSSSg0NCwgUE9TVEVEKSwK
KwlSRUcoMHgwMjgpLAorCVJFRygweDA5YyksCisJUkVHKDB4MGMwKSwKKwlSRUcoMHgxNzgpLAor
CVJFRygweDE3YyksCisJUkVHMTYoMHgzNTgpLAorCVJFRygweDE3MCksCisJUkVHKDB4MTUwKSwK
KwlSRUcoMHgxNTQpLAorCVJFRygweDE1OCksCisJUkVHMTYoMHg0MWMpLAorCVJFRzE2KDB4NjAw
KSwKKwlSRUcxNigweDYwNCksCisJUkVHMTYoMHg2MDgpLAorCVJFRzE2KDB4NjBjKSwKKwlSRUcx
NigweDYxMCksCisJUkVHMTYoMHg2MTQpLAorCVJFRzE2KDB4NjE4KSwKKwlSRUcxNigweDYxYyks
CisJUkVHMTYoMHg2MjApLAorCVJFRzE2KDB4NjI0KSwKKwlSRUcxNigweDYyOCksCisJUkVHMTYo
MHg2MmMpLAorCVJFRzE2KDB4NjMwKSwKKwlSRUcxNigweDYzNCksCisJUkVHMTYoMHg2MzgpLAor
CVJFRzE2KDB4NjNjKSwKKwlSRUcxNigweDY0MCksCisJUkVHMTYoMHg2NDQpLAorCVJFRzE2KDB4
NjQ4KSwKKwlSRUcxNigweDY0YyksCisJUkVHMTYoMHg2NTApLAorCVJFRzE2KDB4NjU0KSwKKwlS
RUcxNigweDY1OCksCisJUkVHMTYoMHg2NWMpLAorCVJFRzE2KDB4NjYwKSwKKwlSRUcxNigweDY2
NCksCisJUkVHMTYoMHg2NjgpLAorCVJFRzE2KDB4NjZjKSwKKwlSRUcxNigweDY3MCksCisJUkVH
MTYoMHg2NzQpLAorCVJFRzE2KDB4Njc4KSwKKwlSRUcxNigweDY3YyksCisJUkVHKDB4MDY4KSwK
KworCUVORCgxNzYpCit9OworCitzdGF0aWMgY29uc3QgdTggZ2VuMTJfeGNzX29mZnNldHNbXSA9
IHsKKwlOT1AoMSksCisJTFJJKDEzLCBQT1NURUQpLAorCVJFRzE2KDB4MjQ0KSwKKwlSRUcoMHgw
MzQpLAorCVJFRygweDAzMCksCisJUkVHKDB4MDM4KSwKKwlSRUcoMHgwM2MpLAorCVJFRygweDE2
OCksCisJUkVHKDB4MTQwKSwKKwlSRUcoMHgxMTApLAorCVJFRygweDFjMCksCisJUkVHKDB4MWM0
KSwKKwlSRUcoMHgxYzgpLAorCVJFRygweDE4MCksCisJUkVHMTYoMHgyYjQpLAorCisJTk9QKDUp
LAorCUxSSSg5LCBQT1NURUQpLAorCVJFRzE2KDB4M2E4KSwKKwlSRUcxNigweDI4YyksCisJUkVH
MTYoMHgyODgpLAorCVJFRzE2KDB4Mjg0KSwKKwlSRUcxNigweDI4MCksCisJUkVHMTYoMHgyN2Mp
LAorCVJFRzE2KDB4Mjc4KSwKKwlSRUcxNigweDI3NCksCisJUkVHMTYoMHgyNzApLAorCisJRU5E
KDgwKQorfTsKKworc3RhdGljIGNvbnN0IHU4IGdlbjhfcmNzX29mZnNldHNbXSA9IHsKKwlOT1Ao
MSksCisJTFJJKDE0LCBQT1NURUQpLAorCVJFRzE2KDB4MjQ0KSwKKwlSRUcoMHgwMzQpLAorCVJF
RygweDAzMCksCisJUkVHKDB4MDM4KSwKKwlSRUcoMHgwM2MpLAorCVJFRygweDE2OCksCisJUkVH
KDB4MTQwKSwKKwlSRUcoMHgxMTApLAorCVJFRygweDExYyksCisJUkVHKDB4MTE0KSwKKwlSRUco
MHgxMTgpLAorCVJFRygweDFjMCksCisJUkVHKDB4MWM0KSwKKwlSRUcoMHgxYzgpLAorCisJTk9Q
KDMpLAorCUxSSSg5LCBQT1NURUQpLAorCVJFRzE2KDB4M2E4KSwKKwlSRUcxNigweDI4YyksCisJ
UkVHMTYoMHgyODgpLAorCVJFRzE2KDB4Mjg0KSwKKwlSRUcxNigweDI4MCksCisJUkVHMTYoMHgy
N2MpLAorCVJFRzE2KDB4Mjc4KSwKKwlSRUcxNigweDI3NCksCisJUkVHMTYoMHgyNzApLAorCisJ
Tk9QKDEzKSwKKwlMUkkoMSwgMCksCisJUkVHKDB4MGM4KSwKKworCUVORCg4MCkKK307CisKK3N0
YXRpYyBjb25zdCB1OCBnZW45X3Jjc19vZmZzZXRzW10gPSB7CisJTk9QKDEpLAorCUxSSSgxNCwg
UE9TVEVEKSwKKwlSRUcxNigweDI0NCksCisJUkVHKDB4MzQpLAorCVJFRygweDMwKSwKKwlSRUco
MHgzOCksCisJUkVHKDB4M2MpLAorCVJFRygweDE2OCksCisJUkVHKDB4MTQwKSwKKwlSRUcoMHgx
MTApLAorCVJFRygweDExYyksCisJUkVHKDB4MTE0KSwKKwlSRUcoMHgxMTgpLAorCVJFRygweDFj
MCksCisJUkVHKDB4MWM0KSwKKwlSRUcoMHgxYzgpLAorCisJTk9QKDMpLAorCUxSSSg5LCBQT1NU
RUQpLAorCVJFRzE2KDB4M2E4KSwKKwlSRUcxNigweDI4YyksCisJUkVHMTYoMHgyODgpLAorCVJF
RzE2KDB4Mjg0KSwKKwlSRUcxNigweDI4MCksCisJUkVHMTYoMHgyN2MpLAorCVJFRzE2KDB4Mjc4
KSwKKwlSRUcxNigweDI3NCksCisJUkVHMTYoMHgyNzApLAorCisJTk9QKDEzKSwKKwlMUkkoMSwg
MCksCisJUkVHKDB4YzgpLAorCisJTk9QKDEzKSwKKwlMUkkoNDQsIFBPU1RFRCksCisJUkVHKDB4
MjgpLAorCVJFRygweDljKSwKKwlSRUcoMHhjMCksCisJUkVHKDB4MTc4KSwKKwlSRUcoMHgxN2Mp
LAorCVJFRzE2KDB4MzU4KSwKKwlSRUcoMHgxNzApLAorCVJFRygweDE1MCksCisJUkVHKDB4MTU0
KSwKKwlSRUcoMHgxNTgpLAorCVJFRzE2KDB4NDFjKSwKKwlSRUcxNigweDYwMCksCisJUkVHMTYo
MHg2MDQpLAorCVJFRzE2KDB4NjA4KSwKKwlSRUcxNigweDYwYyksCisJUkVHMTYoMHg2MTApLAor
CVJFRzE2KDB4NjE0KSwKKwlSRUcxNigweDYxOCksCisJUkVHMTYoMHg2MWMpLAorCVJFRzE2KDB4
NjIwKSwKKwlSRUcxNigweDYyNCksCisJUkVHMTYoMHg2MjgpLAorCVJFRzE2KDB4NjJjKSwKKwlS
RUcxNigweDYzMCksCisJUkVHMTYoMHg2MzQpLAorCVJFRzE2KDB4NjM4KSwKKwlSRUcxNigweDYz
YyksCisJUkVHMTYoMHg2NDApLAorCVJFRzE2KDB4NjQ0KSwKKwlSRUcxNigweDY0OCksCisJUkVH
MTYoMHg2NGMpLAorCVJFRzE2KDB4NjUwKSwKKwlSRUcxNigweDY1NCksCisJUkVHMTYoMHg2NTgp
LAorCVJFRzE2KDB4NjVjKSwKKwlSRUcxNigweDY2MCksCisJUkVHMTYoMHg2NjQpLAorCVJFRzE2
KDB4NjY4KSwKKwlSRUcxNigweDY2YyksCisJUkVHMTYoMHg2NzApLAorCVJFRzE2KDB4Njc0KSwK
KwlSRUcxNigweDY3OCksCisJUkVHMTYoMHg2N2MpLAorCVJFRygweDY4KSwKKworCUVORCgxNzYp
Cit9OworCitzdGF0aWMgY29uc3QgdTggZ2VuMTFfcmNzX29mZnNldHNbXSA9IHsKKwlOT1AoMSks
CisJTFJJKDE1LCBQT1NURUQpLAorCVJFRzE2KDB4MjQ0KSwKKwlSRUcoMHgwMzQpLAorCVJFRygw
eDAzMCksCisJUkVHKDB4MDM4KSwKKwlSRUcoMHgwM2MpLAorCVJFRygweDE2OCksCisJUkVHKDB4
MTQwKSwKKwlSRUcoMHgxMTApLAorCVJFRygweDExYyksCisJUkVHKDB4MTE0KSwKKwlSRUcoMHgx
MTgpLAorCVJFRygweDFjMCksCisJUkVHKDB4MWM0KSwKKwlSRUcoMHgxYzgpLAorCVJFRygweDE4
MCksCisKKwlOT1AoMSksCisJTFJJKDksIFBPU1RFRCksCisJUkVHMTYoMHgzYTgpLAorCVJFRzE2
KDB4MjhjKSwKKwlSRUcxNigweDI4OCksCisJUkVHMTYoMHgyODQpLAorCVJFRzE2KDB4MjgwKSwK
KwlSRUcxNigweDI3YyksCisJUkVHMTYoMHgyNzgpLAorCVJFRzE2KDB4Mjc0KSwKKwlSRUcxNigw
eDI3MCksCisKKwlMUkkoMSwgUE9TVEVEKSwKKwlSRUcoMHgxYjApLAorCisJTk9QKDEwKSwKKwlM
UkkoMSwgMCksCisJUkVHKDB4MGM4KSwKKworCUVORCg4MCkKK307CisKK3N0YXRpYyBjb25zdCB1
OCBnZW4xMl9yY3Nfb2Zmc2V0c1tdID0geworCU5PUCgxKSwKKwlMUkkoMTMsIFBPU1RFRCksCisJ
UkVHMTYoMHgyNDQpLAorCVJFRygweDAzNCksCisJUkVHKDB4MDMwKSwKKwlSRUcoMHgwMzgpLAor
CVJFRygweDAzYyksCisJUkVHKDB4MTY4KSwKKwlSRUcoMHgxNDApLAorCVJFRygweDExMCksCisJ
UkVHKDB4MWMwKSwKKwlSRUcoMHgxYzQpLAorCVJFRygweDFjOCksCisJUkVHKDB4MTgwKSwKKwlS
RUcxNigweDJiNCksCisKKwlOT1AoNSksCisJTFJJKDksIFBPU1RFRCksCisJUkVHMTYoMHgzYTgp
LAorCVJFRzE2KDB4MjhjKSwKKwlSRUcxNigweDI4OCksCisJUkVHMTYoMHgyODQpLAorCVJFRzE2
KDB4MjgwKSwKKwlSRUcxNigweDI3YyksCisJUkVHMTYoMHgyNzgpLAorCVJFRzE2KDB4Mjc0KSwK
KwlSRUcxNigweDI3MCksCisKKwlMUkkoMywgUE9TVEVEKSwKKwlSRUcoMHgxYjApLAorCVJFRzE2
KDB4NWE4KSwKKwlSRUcxNigweDVhYyksCisKKwlOT1AoNiksCisJTFJJKDEsIDApLAorCVJFRygw
eDBjOCksCisJTk9QKDMgKyA5ICsgMSksCisKKwlMUkkoNTEsIFBPU1RFRCksCisJUkVHMTYoMHg1
ODgpLAorCVJFRzE2KDB4NTg4KSwKKwlSRUcxNigweDU4OCksCisJUkVHMTYoMHg1ODgpLAorCVJF
RzE2KDB4NTg4KSwKKwlSRUcxNigweDU4OCksCisJUkVHKDB4MDI4KSwKKwlSRUcoMHgwOWMpLAor
CVJFRygweDBjMCksCisJUkVHKDB4MTc4KSwKKwlSRUcoMHgxN2MpLAorCVJFRzE2KDB4MzU4KSwK
KwlSRUcoMHgxNzApLAorCVJFRygweDE1MCksCisJUkVHKDB4MTU0KSwKKwlSRUcoMHgxNTgpLAor
CVJFRzE2KDB4NDFjKSwKKwlSRUcxNigweDYwMCksCisJUkVHMTYoMHg2MDQpLAorCVJFRzE2KDB4
NjA4KSwKKwlSRUcxNigweDYwYyksCisJUkVHMTYoMHg2MTApLAorCVJFRzE2KDB4NjE0KSwKKwlS
RUcxNigweDYxOCksCisJUkVHMTYoMHg2MWMpLAorCVJFRzE2KDB4NjIwKSwKKwlSRUcxNigweDYy
NCksCisJUkVHMTYoMHg2MjgpLAorCVJFRzE2KDB4NjJjKSwKKwlSRUcxNigweDYzMCksCisJUkVH
MTYoMHg2MzQpLAorCVJFRzE2KDB4NjM4KSwKKwlSRUcxNigweDYzYyksCisJUkVHMTYoMHg2NDAp
LAorCVJFRzE2KDB4NjQ0KSwKKwlSRUcxNigweDY0OCksCisJUkVHMTYoMHg2NGMpLAorCVJFRzE2
KDB4NjUwKSwKKwlSRUcxNigweDY1NCksCisJUkVHMTYoMHg2NTgpLAorCVJFRzE2KDB4NjVjKSwK
KwlSRUcxNigweDY2MCksCisJUkVHMTYoMHg2NjQpLAorCVJFRzE2KDB4NjY4KSwKKwlSRUcxNigw
eDY2YyksCisJUkVHMTYoMHg2NzApLAorCVJFRzE2KDB4Njc0KSwKKwlSRUcxNigweDY3OCksCisJ
UkVHMTYoMHg2N2MpLAorCVJFRygweDA2OCksCisJUkVHKDB4MDg0KSwKKwlOT1AoMSksCisKKwlF
TkQoMTkyKQorfTsKKworI3VuZGVmIEVORAorI3VuZGVmIFJFRzE2CisjdW5kZWYgUkVHCisjdW5k
ZWYgTFJJCisjdW5kZWYgTk9QCisKK3N0YXRpYyBjb25zdCB1OCAqcmVnX29mZnNldHMoY29uc3Qg
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQoreworCS8qCisJICogVGhlIGdlbjEyKyBs
aXN0cyBvbmx5IGhhdmUgdGhlIHJlZ2lzdGVycyB3ZSBwcm9ncmFtIGluIHRoZSBiYXNpYworCSAq
IGRlZmF1bHQgc3RhdGUuIFdlIHJlbHkgb24gdGhlIGNvbnRleHQgaW1hZ2UgdXNpbmcgcmVsYXRp
dmUKKwkgKiBhZGRyZXNzaW5nIHRvIGF1dG9tYXRpYyBmaXh1cCB0aGUgcmVnaXN0ZXIgc3RhdGUg
YmV0d2VlbiB0aGUKKwkgKiBwaHlzaWNhbCBlbmdpbmVzIGZvciB2aXJ0dWFsIGVuZ2luZS4KKwkg
Ki8KKwlHRU1fQlVHX09OKElOVEVMX0dFTihlbmdpbmUtPmk5MTUpID49IDEyICYmCisJCSAgICFp
bnRlbF9lbmdpbmVfaGFzX3JlbGF0aXZlX21taW8oZW5naW5lKSk7CisKKwlpZiAoZW5naW5lLT5j
bGFzcyA9PSBSRU5ERVJfQ0xBU1MpIHsKKwkJaWYgKElOVEVMX0dFTihlbmdpbmUtPmk5MTUpID49
IDEyKQorCQkJcmV0dXJuIGdlbjEyX3Jjc19vZmZzZXRzOworCQllbHNlIGlmIChJTlRFTF9HRU4o
ZW5naW5lLT5pOTE1KSA+PSAxMSkKKwkJCXJldHVybiBnZW4xMV9yY3Nfb2Zmc2V0czsKKwkJZWxz
ZSBpZiAoSU5URUxfR0VOKGVuZ2luZS0+aTkxNSkgPj0gOSkKKwkJCXJldHVybiBnZW45X3Jjc19v
ZmZzZXRzOworCQllbHNlCisJCQlyZXR1cm4gZ2VuOF9yY3Nfb2Zmc2V0czsKKwl9IGVsc2Ugewor
CQlpZiAoSU5URUxfR0VOKGVuZ2luZS0+aTkxNSkgPj0gMTIpCisJCQlyZXR1cm4gZ2VuMTJfeGNz
X29mZnNldHM7CisJCWVsc2UgaWYgKElOVEVMX0dFTihlbmdpbmUtPmk5MTUpID49IDkpCisJCQly
ZXR1cm4gZ2VuOV94Y3Nfb2Zmc2V0czsKKwkJZWxzZQorCQkJcmV0dXJuIGdlbjhfeGNzX29mZnNl
dHM7CisJfQorfQorCitzdGF0aWMgaW50IGxyY19yaW5nX21pX21vZGUoY29uc3Qgc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqZW5naW5lKQoreworCWlmIChJTlRFTF9HRU4oZW5naW5lLT5pOTE1KSA+
PSAxMikKKwkJcmV0dXJuIDB4NjA7CisJZWxzZSBpZiAoSU5URUxfR0VOKGVuZ2luZS0+aTkxNSkg
Pj0gOSkKKwkJcmV0dXJuIDB4NTQ7CisJZWxzZSBpZiAoZW5naW5lLT5jbGFzcyA9PSBSRU5ERVJf
Q0xBU1MpCisJCXJldHVybiAweDU4OworCWVsc2UKKwkJcmV0dXJuIC0xOworfQorCitzdGF0aWMg
aW50IGxyY19yaW5nX2dwcjAoY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQor
eworCWlmIChJTlRFTF9HRU4oZW5naW5lLT5pOTE1KSA+PSAxMikKKwkJcmV0dXJuIDB4NzQ7CisJ
ZWxzZSBpZiAoSU5URUxfR0VOKGVuZ2luZS0+aTkxNSkgPj0gOSkKKwkJcmV0dXJuIDB4Njg7CisJ
ZWxzZSBpZiAoZW5naW5lLT5jbGFzcyA9PSBSRU5ERVJfQ0xBU1MpCisJCXJldHVybiAweGQ4Owor
CWVsc2UKKwkJcmV0dXJuIC0xOworfQorCitzdGF0aWMgaW50IGxyY19yaW5nX3dhX2JiX3Blcl9j
dHgoY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQoreworCWlmIChJTlRFTF9H
RU4oZW5naW5lLT5pOTE1KSA+PSAxMikKKwkJcmV0dXJuIDB4MTI7CisJZWxzZSBpZiAoSU5URUxf
R0VOKGVuZ2luZS0+aTkxNSkgPj0gOSB8fCBlbmdpbmUtPmNsYXNzID09IFJFTkRFUl9DTEFTUykK
KwkJcmV0dXJuIDB4MTg7CisJZWxzZQorCQlyZXR1cm4gLTE7Cit9CisKK3N0YXRpYyBpbnQgbHJj
X3JpbmdfaW5kaXJlY3RfcHRyKGNvbnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkK
K3sKKwlpbnQgeDsKKworCXggPSBscmNfcmluZ193YV9iYl9wZXJfY3R4KGVuZ2luZSk7CisJaWYg
KHggPCAwKQorCQlyZXR1cm4geDsKKworCXJldHVybiB4ICsgMjsKK30KKworc3RhdGljIGludCBs
cmNfcmluZ19pbmRpcmVjdF9vZmZzZXQoY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lKQoreworCWludCB4OworCisJeCA9IGxyY19yaW5nX2luZGlyZWN0X3B0cihlbmdpbmUpOwor
CWlmICh4IDwgMCkKKwkJcmV0dXJuIHg7CisKKwlyZXR1cm4geCArIDI7Cit9CisKK3N0YXRpYyBp
bnQgbHJjX3JpbmdfY21kX2J1Zl9jY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSkKK3sKKwlpZiAoZW5naW5lLT5jbGFzcyAhPSBSRU5ERVJfQ0xBU1MpCisJCXJldHVybiAt
MTsKKworCWlmIChJTlRFTF9HRU4oZW5naW5lLT5pOTE1KSA+PSAxMikKKwkJcmV0dXJuIDB4YjY7
CisJZWxzZSBpZiAoSU5URUxfR0VOKGVuZ2luZS0+aTkxNSkgPj0gMTEpCisJCXJldHVybiAweGFh
OworCWVsc2UKKwkJcmV0dXJuIC0xOworfQorCitzdGF0aWMgdTMyCitscmNfcmluZ19pbmRpcmVj
dF9vZmZzZXRfZGVmYXVsdChjb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCit7
CisJc3dpdGNoIChJTlRFTF9HRU4oZW5naW5lLT5pOTE1KSkgeworCWRlZmF1bHQ6CisJCU1JU1NJ
TkdfQ0FTRShJTlRFTF9HRU4oZW5naW5lLT5pOTE1KSk7CisJCWZhbGx0aHJvdWdoOworCWNhc2Ug
MTI6CisJCXJldHVybiBHRU4xMl9DVFhfUkNTX0lORElSRUNUX0NUWF9PRkZTRVRfREVGQVVMVDsK
KwljYXNlIDExOgorCQlyZXR1cm4gR0VOMTFfQ1RYX1JDU19JTkRJUkVDVF9DVFhfT0ZGU0VUX0RF
RkFVTFQ7CisJY2FzZSAxMDoKKwkJcmV0dXJuIEdFTjEwX0NUWF9SQ1NfSU5ESVJFQ1RfQ1RYX09G
RlNFVF9ERUZBVUxUOworCWNhc2UgOToKKwkJcmV0dXJuIEdFTjlfQ1RYX1JDU19JTkRJUkVDVF9D
VFhfT0ZGU0VUX0RFRkFVTFQ7CisJY2FzZSA4OgorCQlyZXR1cm4gR0VOOF9DVFhfUkNTX0lORElS
RUNUX0NUWF9PRkZTRVRfREVGQVVMVDsKKwl9Cit9CisKK3N0YXRpYyB2b2lkCitscmNfc2V0dXBf
aW5kaXJlY3RfY3R4KHUzMiAqcmVncywKKwkJICAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZSwKKwkJICAgICAgIHUzMiBjdHhfYmJfZ2d0dF9hZGRyLAorCQkgICAgICAg
dTMyIHNpemUpCit7CisJR0VNX0JVR19PTighc2l6ZSk7CisJR0VNX0JVR19PTighSVNfQUxJR05F
RChzaXplLCBDQUNIRUxJTkVfQllURVMpKTsKKwlHRU1fQlVHX09OKGxyY19yaW5nX2luZGlyZWN0
X3B0cihlbmdpbmUpID09IC0xKTsKKwlyZWdzW2xyY19yaW5nX2luZGlyZWN0X3B0cihlbmdpbmUp
ICsgMV0gPQorCQljdHhfYmJfZ2d0dF9hZGRyIHwgKHNpemUgLyBDQUNIRUxJTkVfQllURVMpOwor
CisJR0VNX0JVR19PTihscmNfcmluZ19pbmRpcmVjdF9vZmZzZXQoZW5naW5lKSA9PSAtMSk7CisJ
cmVnc1tscmNfcmluZ19pbmRpcmVjdF9vZmZzZXQoZW5naW5lKSArIDFdID0KKwkJbHJjX3Jpbmdf
aW5kaXJlY3Rfb2Zmc2V0X2RlZmF1bHQoZW5naW5lKSA8PCA2OworfQorCitzdGF0aWMgdm9pZCBp
bml0X2NvbW1vbl9yZWdzKHUzMiAqIGNvbnN0IHJlZ3MsCisJCQkgICAgIGNvbnN0IHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKKwkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX3Jpbmcg
KnJpbmcsCisJCQkgICAgIGJvb2wgaW5oaWJpdCkKK3sKKwl1MzIgY3RsOworCisJY3RsID0gX01B
U0tFRF9CSVRfRU5BQkxFKENUWF9DVFJMX0lOSElCSVRfU1lOX0NUWF9TV0lUQ0gpOworCWN0bCB8
PSBfTUFTS0VEX0JJVF9ESVNBQkxFKENUWF9DVFJMX0VOR0lORV9DVFhfUkVTVE9SRV9JTkhJQklU
KTsKKwlpZiAoaW5oaWJpdCkKKwkJY3RsIHw9IENUWF9DVFJMX0VOR0lORV9DVFhfUkVTVE9SRV9J
TkhJQklUOworCWlmIChJTlRFTF9HRU4oZW5naW5lLT5pOTE1KSA8IDExKQorCQljdGwgfD0gX01B
U0tFRF9CSVRfRElTQUJMRShDVFhfQ1RSTF9FTkdJTkVfQ1RYX1NBVkVfSU5ISUJJVCB8CisJCQkJ
CSAgIENUWF9DVFJMX1JTX0NUWF9FTkFCTEUpOworCXJlZ3NbQ1RYX0NPTlRFWFRfQ09OVFJPTF0g
PSBjdGw7CisKKwlyZWdzW0NUWF9SSU5HX0NUTF0gPSBSSU5HX0NUTF9TSVpFKHJpbmctPnNpemUp
IHwgUklOR19WQUxJRDsKKwlyZWdzW0NUWF9USU1FU1RBTVBdID0gMDsKK30KKworc3RhdGljIHZv
aWQgaW5pdF93YV9iYl9yZWdzKHUzMiAqIGNvbnN0IHJlZ3MsCisJCQkgICAgY29uc3Qgc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQoreworCWNvbnN0IHN0cnVjdCBpOTE1X2N0eF93b3Jr
YXJvdW5kcyAqIGNvbnN0IHdhX2N0eCA9ICZlbmdpbmUtPndhX2N0eDsKKworCWlmICh3YV9jdHgt
PnBlcl9jdHguc2l6ZSkgeworCQljb25zdCB1MzIgZ2d0dF9vZmZzZXQgPSBpOTE1X2dndHRfb2Zm
c2V0KHdhX2N0eC0+dm1hKTsKKworCQlHRU1fQlVHX09OKGxyY19yaW5nX3dhX2JiX3Blcl9jdHgo
ZW5naW5lKSA9PSAtMSk7CisJCXJlZ3NbbHJjX3Jpbmdfd2FfYmJfcGVyX2N0eChlbmdpbmUpICsg
MV0gPQorCQkJKGdndHRfb2Zmc2V0ICsgd2FfY3R4LT5wZXJfY3R4Lm9mZnNldCkgfCAweDAxOwor
CX0KKworCWlmICh3YV9jdHgtPmluZGlyZWN0X2N0eC5zaXplKSB7CisJCWxyY19zZXR1cF9pbmRp
cmVjdF9jdHgocmVncywgZW5naW5lLAorCQkJCQkgICAgaTkxNV9nZ3R0X29mZnNldCh3YV9jdHgt
PnZtYSkgKworCQkJCQkgICAgd2FfY3R4LT5pbmRpcmVjdF9jdHgub2Zmc2V0LAorCQkJCQkgICAg
d2FfY3R4LT5pbmRpcmVjdF9jdHguc2l6ZSk7CisJfQorfQorCitzdGF0aWMgdm9pZCBpbml0X3Bw
Z3R0X3JlZ3ModTMyICpyZWdzLCBjb25zdCBzdHJ1Y3QgaTkxNV9wcGd0dCAqcHBndHQpCit7CisJ
aWYgKGk5MTVfdm1faXNfNGx2bCgmcHBndHQtPnZtKSkgeworCQkvKiA2NGIgUFBHVFQgKDQ4Yml0
IGNhbm9uaWNhbCkKKwkJICogUERQMF9ERVNDUklQVE9SIGNvbnRhaW5zIHRoZSBiYXNlIGFkZHJl
c3MgdG8gUE1MNCBhbmQKKwkJICogb3RoZXIgUERQIERlc2NyaXB0b3JzIGFyZSBpZ25vcmVkLgor
CQkgKi8KKwkJQVNTSUdOX0NUWF9QTUw0KHBwZ3R0LCByZWdzKTsKKwl9IGVsc2UgeworCQlBU1NJ
R05fQ1RYX1BEUChwcGd0dCwgcmVncywgMyk7CisJCUFTU0lHTl9DVFhfUERQKHBwZ3R0LCByZWdz
LCAyKTsKKwkJQVNTSUdOX0NUWF9QRFAocHBndHQsIHJlZ3MsIDEpOworCQlBU1NJR05fQ1RYX1BE
UChwcGd0dCwgcmVncywgMCk7CisJfQorfQorCitzdGF0aWMgc3RydWN0IGk5MTVfcHBndHQgKnZt
X2FsaWFzKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQoreworCWlmIChpOTE1X2lzX2dn
dHQodm0pKQorCQlyZXR1cm4gaTkxNV92bV90b19nZ3R0KHZtKS0+YWxpYXM7CisJZWxzZQorCQly
ZXR1cm4gaTkxNV92bV90b19wcGd0dCh2bSk7Cit9CisKK3N0YXRpYyB2b2lkIF9fcmVzZXRfc3Rv
cF9yaW5nKHUzMiAqcmVncywgY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQor
eworCWludCB4OworCisJeCA9IGxyY19yaW5nX21pX21vZGUoZW5naW5lKTsKKwlpZiAoeCAhPSAt
MSkgeworCQlyZWdzW3ggKyAxXSAmPSB+U1RPUF9SSU5HOworCQlyZWdzW3ggKyAxXSB8PSBTVE9Q
X1JJTkcgPDwgMTY7CisJfQorfQorCitzdGF0aWMgdm9pZCBfX2xyY19pbml0X3JlZ3ModTMyICpy
ZWdzLAorCQkJICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKKwkJCSAgICBjb25z
dCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCisJCQkgICAgY29uc3Qgc3RydWN0IGlu
dGVsX3JpbmcgKnJpbmcsCisJCQkgICAgYm9vbCBpbmhpYml0KQoreworCS8qCisJICogQSBjb250
ZXh0IGlzIGFjdHVhbGx5IGEgYmlnIGJhdGNoIGJ1ZmZlciB3aXRoIHNldmVyYWwKKwkgKiBNSV9M
T0FEX1JFR0lTVEVSX0lNTSBjb21tYW5kcyBmb2xsb3dlZCBieSAocmVnLCB2YWx1ZSkgcGFpcnMu
IFRoZQorCSAqIHZhbHVlcyB3ZSBhcmUgc2V0dGluZyBoZXJlIGFyZSBvbmx5IGZvciB0aGUgZmly
c3QgY29udGV4dCByZXN0b3JlOgorCSAqIG9uIGEgc3Vic2VxdWVudCBzYXZlLCB0aGUgR1BVIHdp
bGwgcmVjcmVhdGUgdGhpcyBiYXRjaGJ1ZmZlciB3aXRoIG5ldworCSAqIHZhbHVlcyAoaW5jbHVk
aW5nIGFsbCB0aGUgbWlzc2luZyBNSV9MT0FEX1JFR0lTVEVSX0lNTSBjb21tYW5kcyB0aGF0CisJ
ICogd2UgYXJlIG5vdCBpbml0aWFsaXppbmcgaGVyZSkuCisJICoKKwkgKiBNdXN0IGtlZXAgY29u
c2lzdGVudCB3aXRoIHZpcnR1YWxfdXBkYXRlX3JlZ2lzdGVyX29mZnNldHMoKS4KKwkgKi8KKwlz
ZXRfb2Zmc2V0cyhyZWdzLCByZWdfb2Zmc2V0cyhlbmdpbmUpLCBlbmdpbmUsIGluaGliaXQpOwor
CisJaW5pdF9jb21tb25fcmVncyhyZWdzLCBlbmdpbmUsIHJpbmcsIGluaGliaXQpOworCWluaXRf
cHBndHRfcmVncyhyZWdzLCB2bV9hbGlhcyhjZS0+dm0pKTsKKworCWluaXRfd2FfYmJfcmVncyhy
ZWdzLCBlbmdpbmUpOworCisJX19yZXNldF9zdG9wX3JpbmcocmVncywgZW5naW5lKTsKK30KKwor
dm9pZCBscmNfaW5pdF9yZWdzKGNvbnN0IHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKKwkJICAg
Y29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAorCQkgICBjb25zdCBzdHJ1Y3Qg
aW50ZWxfcmluZyAqcmluZywKKwkJICAgYm9vbCBpbmhpYml0KQoreworCV9fbHJjX2luaXRfcmVn
cyhjZS0+bHJjX3JlZ19zdGF0ZSwgY2UsIGVuZ2luZSwgcmluZywgaW5oaWJpdCk7Cit9CisKK3Zv
aWQgbHJjX3Jlc2V0X3JlZ3MoY29uc3Qgc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAorCQkgICAg
Y29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQoreworCV9fcmVzZXRfc3RvcF9y
aW5nKGNlLT5scmNfcmVnX3N0YXRlLCBlbmdpbmUpOworfQorCit2b2lkIGxyY19yZXN0b3JlX2Rl
ZmF1bHRzKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKKwkJCSAgc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lKQoreworCXUzMiAqcmVnczsKKworCXJlZ3MgPSBtZW1zZXQoY2UtPmxyY19y
ZWdfc3RhdGUsIDAsIGVuZ2luZS0+Y29udGV4dF9zaXplIC0gUEFHRV9TSVpFKTsKKwlfX2xyY19p
bml0X3JlZ3MocmVncywgY2UsIGVuZ2luZSwgY2UtPnJpbmcsIHRydWUpOworCisJY2UtPnJ1bnRp
bWUubGFzdCA9IGxyY19nZXRfcnVudGltZShjZSk7Cit9CisKK3N0YXRpYyB2b2lkCitzZXRfcmVk
em9uZSh2b2lkICp2YWRkciwgY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQor
eworCWlmICghSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfREVCVUdfR0VNKSkKKwkJcmV0dXJu
OworCisJdmFkZHIgKz0gZW5naW5lLT5jb250ZXh0X3NpemU7CisKKwltZW1zZXQodmFkZHIsIENP
TlRFWFRfUkVEWk9ORSwgSTkxNV9HVFRfUEFHRV9TSVpFKTsKK30KKworc3RhdGljIHZvaWQKK2No
ZWNrX3JlZHpvbmUoY29uc3Qgdm9pZCAqdmFkZHIsIGNvbnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmVuZ2luZSkKK3sKKwlpZiAoIUlTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X0RFQlVHX0dF
TSkpCisJCXJldHVybjsKKworCXZhZGRyICs9IGVuZ2luZS0+Y29udGV4dF9zaXplOworCisJaWYg
KG1lbWNocl9pbnYodmFkZHIsIENPTlRFWFRfUkVEWk9ORSwgSTkxNV9HVFRfUEFHRV9TSVpFKSkK
KwkJZHJtX2Vycl9vbmNlKCZlbmdpbmUtPmk5MTUtPmRybSwKKwkJCSAgICAgIiVzIGNvbnRleHQg
cmVkem9uZSBvdmVyd3JpdHRlbiFcbiIsCisJCQkgICAgIGVuZ2luZS0+bmFtZSk7Cit9CisKK3Zv
aWQgbHJjX2NoZWNrX3JlZHpvbmUoc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQoreworCWNoZWNr
X3JlZHpvbmUoKHZvaWQgKiljZS0+bHJjX3JlZ19zdGF0ZSAtIExSQ19TVEFURV9PRkZTRVQsIGNl
LT5lbmdpbmUpOworfQorCitzdGF0aWMgaW50IF9fbHJjX3NldHVwKHN0cnVjdCBpbnRlbF9jb250
ZXh0ICpjZSwKKwkJICAgICAgIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCisJCSAg
ICAgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCisJCSAgICAgICBzdHJ1Y3QgaW50
ZWxfcmluZyAqcmluZykKK3sKKwlib29sIGluaGliaXQgPSB0cnVlOworCXZvaWQgKnZhZGRyOwor
CisJdmFkZHIgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChvYmosIEk5MTVfTUFQX1dCKTsKKwlp
ZiAoSVNfRVJSKHZhZGRyKSkgeworCQlkcm1fZGJnKCZlbmdpbmUtPmk5MTUtPmRybSwgIkNvdWxk
IG5vdCBtYXAgb2JqZWN0IHBhZ2VzIVxuIik7CisJCXJldHVybiBQVFJfRVJSKHZhZGRyKTsKKwl9
CisKKwlzZXRfcmVkem9uZSh2YWRkciwgZW5naW5lKTsKKworCWlmIChlbmdpbmUtPmRlZmF1bHRf
c3RhdGUpIHsKKwkJc2htZW1fcmVhZChlbmdpbmUtPmRlZmF1bHRfc3RhdGUsIDAsCisJCQkgICB2
YWRkciwgZW5naW5lLT5jb250ZXh0X3NpemUpOworCQlfX3NldF9iaXQoQ09OVEVYVF9WQUxJRF9C
SVQsICZjZS0+ZmxhZ3MpOworCQlpbmhpYml0ID0gZmFsc2U7CisJfQorCisJLyogQ2xlYXIgdGhl
IHBwSFdTUCAoaW5jLiBwZXItY29udGV4dCBjb3VudGVycykgKi8KKwltZW1zZXQodmFkZHIsIDAs
IFBBR0VfU0laRSk7CisKKwkvKgorCSAqIFRoZSBzZWNvbmQgcGFnZSBvZiB0aGUgY29udGV4dCBv
YmplY3QgY29udGFpbnMgc29tZSByZWdpc3RlcnMgd2hpY2gKKwkgKiBtdXN0IGJlIHNldCB1cCBw
cmlvciB0byB0aGUgZmlyc3QgZXhlY3V0aW9uLgorCSAqLworCV9fbHJjX2luaXRfcmVncyh2YWRk
ciArIExSQ19TVEFURV9PRkZTRVQsIGNlLCBlbmdpbmUsIHJpbmcsIGluaGliaXQpOworCisJX19p
OTE1X2dlbV9vYmplY3RfZmx1c2hfbWFwKG9iaiwgMCwgZW5naW5lLT5jb250ZXh0X3NpemUpOwor
CWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAob2JqKTsKKwlyZXR1cm4gMDsKK30KKworc3RhdGlj
IHN0cnVjdCBpOTE1X3ZtYSAqCitfX2xyY19hbGxvY19zdGF0ZShzdHJ1Y3QgaW50ZWxfY29udGV4
dCAqY2UsIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqOworCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOworCXUzMiBjb250ZXh0
X3NpemU7CisKKwljb250ZXh0X3NpemUgPSByb3VuZF91cChlbmdpbmUtPmNvbnRleHRfc2l6ZSwg
STkxNV9HVFRfUEFHRV9TSVpFKTsKKworCWlmIChJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9E
RUJVR19HRU0pKQorCQljb250ZXh0X3NpemUgKz0gSTkxNV9HVFRfUEFHRV9TSVpFOyAvKiBmb3Ig
cmVkem9uZSAqLworCisJaWYgKElOVEVMX0dFTihlbmdpbmUtPmk5MTUpID09IDEyKSB7CisJCWNl
LT53YV9iYl9wYWdlID0gY29udGV4dF9zaXplIC8gUEFHRV9TSVpFOworCQljb250ZXh0X3NpemUg
Kz0gUEFHRV9TSVpFOworCX0KKworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc2htZW0o
ZW5naW5lLT5pOTE1LCBjb250ZXh0X3NpemUpOworCWlmIChJU19FUlIob2JqKSkKKwkJcmV0dXJu
IEVSUl9DQVNUKG9iaik7CisKKwl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosICZlbmdpbmUt
Pmd0LT5nZ3R0LT52bSwgTlVMTCk7CisJaWYgKElTX0VSUih2bWEpKSB7CisJCWk5MTVfZ2VtX29i
amVjdF9wdXQob2JqKTsKKwkJcmV0dXJuIHZtYTsKKwl9CisKKwlyZXR1cm4gdm1hOworfQorCitp
bnQgbHJjX2FsbG9jKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lKQoreworCXN0cnVjdCBpbnRlbF9yaW5nICpyaW5nOworCXN0cnVjdCBpOTE1
X3ZtYSAqdm1hOworCWludCBlcnI7CisKKwlHRU1fQlVHX09OKGNlLT5zdGF0ZSk7CisKKwl2bWEg
PSBfX2xyY19hbGxvY19zdGF0ZShjZSwgZW5naW5lKTsKKwlpZiAoSVNfRVJSKHZtYSkpCisJCXJl
dHVybiBQVFJfRVJSKHZtYSk7CisKKwlyaW5nID0gaW50ZWxfZW5naW5lX2NyZWF0ZV9yaW5nKGVu
Z2luZSwgKHVuc2lnbmVkIGxvbmcpY2UtPnJpbmcpOworCWlmIChJU19FUlIocmluZykpIHsKKwkJ
ZXJyID0gUFRSX0VSUihyaW5nKTsKKwkJZ290byBlcnJfdm1hOworCX0KKworCWVyciA9IF9fbHJj
X3NldHVwKGNlLCB2bWEtPm9iaiwgZW5naW5lLCByaW5nKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVy
cl9yaW5nOworCisJY2UtPnJpbmcgPSByaW5nOworCWNlLT5zdGF0ZSA9IHZtYTsKKwlyZXR1cm4g
MDsKKworZXJyX3Jpbmc6CisJaW50ZWxfcmluZ19wdXQocmluZyk7CitlcnJfdm1hOgorCWk5MTVf
dm1hX3B1dCh2bWEpOworCXJldHVybiBlcnI7Cit9CisKK3ZvaWQgbHJjX3Jlc2V0KHN0cnVjdCBp
bnRlbF9jb250ZXh0ICpjZSwKKwkgICAgICAgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5l
LAorCSAgICAgICB1MzIgaGVhZCwKKwkgICAgICAgYm9vbCBzY3J1YikKK3sKKwlHRU1fQlVHX09O
KCFpbnRlbF9jb250ZXh0X2lzX3Bpbm5lZChjZSkpOworCisJLyoKKwkgKiBXZSB3YW50IGEgc2lt
cGxlIGNvbnRleHQgKyByaW5nIHRvIGV4ZWN1dGUgdGhlIGJyZWFkY3J1bWIgdXBkYXRlLgorCSAq
IFdlIGNhbm5vdCByZWx5IG9uIHRoZSBjb250ZXh0IGJlaW5nIGludGFjdCBhY3Jvc3MgdGhlIEdQ
VSBoYW5nLAorCSAqIHNvIGNsZWFyIGl0IGFuZCByZWJ1aWxkIGp1c3Qgd2hhdCB3ZSBuZWVkIGZv
ciB0aGUgYnJlYWRjcnVtYi4KKwkgKiBBbGwgcGVuZGluZyByZXF1ZXN0cyBmb3IgdGhpcyBjb250
ZXh0IHdpbGwgYmUgemFwcGVkLCBhbmQgYW55CisJICogZnV0dXJlIHJlcXVlc3Qgd2lsbCBiZSBh
ZnRlciB1c2Vyc3BhY2UgaGFzIGhhZCB0aGUgb3Bwb3J0dW5pdHkKKwkgKiB0byByZWNyZWF0ZSBp
dHMgb3duIHN0YXRlLgorCSAqLworCWlmIChzY3J1YikKKwkJbHJjX3Jlc3RvcmVfZGVmYXVsdHMo
Y2UsIGVuZ2luZSk7CisKKwkvKiBSZXJ1biB0aGUgcmVxdWVzdDsgaXRzIHBheWxvYWQgaGFzIGJl
ZW4gbmV1dGVyZWQgKGlmIGd1aWx0eSkuICovCisJbHJjX3VwZGF0ZV9yZWdzKGNlLCBlbmdpbmUs
IGhlYWQpOworfQorCitzdGF0aWMgdTMyICoKK2dlbjEyX2VtaXRfdGltZXN0YW1wX3dhKGNvbnN0
IHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgdTMyICpjcykKK3sKKwkqY3MrKyA9IE1JX0xPQURf
UkVHSVNURVJfTUVNX0dFTjggfAorCQlNSV9TUk1fTFJNX0dMT0JBTF9HVFQgfAorCQlNSV9MUklf
TFJNX0NTX01NSU87CisJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChHRU44X1JJTkdfQ1Nf
R1BSKDAsIDApKTsKKwkqY3MrKyA9IGk5MTVfZ2d0dF9vZmZzZXQoY2UtPnN0YXRlKSArIExSQ19T
VEFURV9PRkZTRVQgKworCQlDVFhfVElNRVNUQU1QICogc2l6ZW9mKHUzMik7CisJKmNzKysgPSAw
OworCisJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX1JFRyB8CisJCU1JX0xSUl9TT1VSQ0VfQ1Nf
TU1JTyB8CisJCU1JX0xSSV9MUk1fQ1NfTU1JTzsKKwkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zm
c2V0KEdFTjhfUklOR19DU19HUFIoMCwgMCkpOworCSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZz
ZXQoUklOR19DVFhfVElNRVNUQU1QKDApKTsKKworCSpjcysrID0gTUlfTE9BRF9SRUdJU1RFUl9S
RUcgfAorCQlNSV9MUlJfU09VUkNFX0NTX01NSU8gfAorCQlNSV9MUklfTFJNX0NTX01NSU87CisJ
KmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChHRU44X1JJTkdfQ1NfR1BSKDAsIDApKTsKKwkq
Y3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KFJJTkdfQ1RYX1RJTUVTVEFNUCgwKSk7CisKKwly
ZXR1cm4gY3M7Cit9CisKK3N0YXRpYyB1MzIgKgorZ2VuMTJfZW1pdF9yZXN0b3JlX3NjcmF0Y2go
Y29uc3Qgc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCB1MzIgKmNzKQoreworCUdFTV9CVUdfT04o
bHJjX3JpbmdfZ3ByMChjZS0+ZW5naW5lKSA9PSAtMSk7CisKKwkqY3MrKyA9IE1JX0xPQURfUkVH
SVNURVJfTUVNX0dFTjggfAorCQlNSV9TUk1fTFJNX0dMT0JBTF9HVFQgfAorCQlNSV9MUklfTFJN
X0NTX01NSU87CisJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChHRU44X1JJTkdfQ1NfR1BS
KDAsIDApKTsKKwkqY3MrKyA9IGk5MTVfZ2d0dF9vZmZzZXQoY2UtPnN0YXRlKSArIExSQ19TVEFU
RV9PRkZTRVQgKworCQkobHJjX3JpbmdfZ3ByMChjZS0+ZW5naW5lKSArIDEpICogc2l6ZW9mKHUz
Mik7CisJKmNzKysgPSAwOworCisJcmV0dXJuIGNzOworfQorCitzdGF0aWMgdTMyICoKK2dlbjEy
X2VtaXRfY21kX2J1Zl93YShjb25zdCBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIHUzMiAqY3Mp
Cit7CisJR0VNX0JVR19PTihscmNfcmluZ19jbWRfYnVmX2NjdGwoY2UtPmVuZ2luZSkgPT0gLTEp
OworCisJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX01FTV9HRU44IHwKKwkJTUlfU1JNX0xSTV9H
TE9CQUxfR1RUIHwKKwkJTUlfTFJJX0xSTV9DU19NTUlPOworCSpjcysrID0gaTkxNV9tbWlvX3Jl
Z19vZmZzZXQoR0VOOF9SSU5HX0NTX0dQUigwLCAwKSk7CisJKmNzKysgPSBpOTE1X2dndHRfb2Zm
c2V0KGNlLT5zdGF0ZSkgKyBMUkNfU1RBVEVfT0ZGU0VUICsKKwkJKGxyY19yaW5nX2NtZF9idWZf
Y2N0bChjZS0+ZW5naW5lKSArIDEpICogc2l6ZW9mKHUzMik7CisJKmNzKysgPSAwOworCisJKmNz
KysgPSBNSV9MT0FEX1JFR0lTVEVSX1JFRyB8CisJCU1JX0xSUl9TT1VSQ0VfQ1NfTU1JTyB8CisJ
CU1JX0xSSV9MUk1fQ1NfTU1JTzsKKwkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KEdFTjhf
UklOR19DU19HUFIoMCwgMCkpOworCSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQoUklOR19D
TURfQlVGX0NDVEwoMCkpOworCisJcmV0dXJuIGNzOworfQorCitzdGF0aWMgdTMyICoKK2dlbjEy
X2VtaXRfaW5kaXJlY3RfY3R4X3Jjcyhjb25zdCBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIHUz
MiAqY3MpCit7CisJY3MgPSBnZW4xMl9lbWl0X3RpbWVzdGFtcF93YShjZSwgY3MpOworCWNzID0g
Z2VuMTJfZW1pdF9jbWRfYnVmX3dhKGNlLCBjcyk7CisJY3MgPSBnZW4xMl9lbWl0X3Jlc3RvcmVf
c2NyYXRjaChjZSwgY3MpOworCisJcmV0dXJuIGNzOworfQorCitzdGF0aWMgdTMyICoKK2dlbjEy
X2VtaXRfaW5kaXJlY3RfY3R4X3hjcyhjb25zdCBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIHUz
MiAqY3MpCit7CisJY3MgPSBnZW4xMl9lbWl0X3RpbWVzdGFtcF93YShjZSwgY3MpOworCWNzID0g
Z2VuMTJfZW1pdF9yZXN0b3JlX3NjcmF0Y2goY2UsIGNzKTsKKworCXJldHVybiBjczsKK30KKwor
c3RhdGljIGlubGluZSB1MzIgY29udGV4dF93YV9iYl9vZmZzZXQoY29uc3Qgc3RydWN0IGludGVs
X2NvbnRleHQgKmNlKQoreworCXJldHVybiBQQUdFX1NJWkUgKiBjZS0+d2FfYmJfcGFnZTsKK30K
Kworc3RhdGljIHUzMiAqY29udGV4dF9pbmRpcmVjdF9iYihjb25zdCBzdHJ1Y3QgaW50ZWxfY29u
dGV4dCAqY2UpCit7CisJdm9pZCAqcHRyOworCisJR0VNX0JVR19PTighY2UtPndhX2JiX3BhZ2Up
OworCisJcHRyID0gY2UtPmxyY19yZWdfc3RhdGU7CisJcHRyIC09IExSQ19TVEFURV9PRkZTRVQ7
IC8qIGJhY2sgdG8gc3RhcnQgb2YgY29udGV4dCBpbWFnZSAqLworCXB0ciArPSBjb250ZXh0X3dh
X2JiX29mZnNldChjZSk7CisKKwlyZXR1cm4gcHRyOworfQorCitzdGF0aWMgdm9pZAorc2V0dXBf
aW5kaXJlY3RfY3R4X2JiKGNvbnN0IHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKKwkJICAgICAg
Y29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAorCQkgICAgICB1MzIgKigqZW1p
dCkoY29uc3Qgc3RydWN0IGludGVsX2NvbnRleHQgKiwgdTMyICopKQoreworCXUzMiAqIGNvbnN0
IHN0YXJ0ID0gY29udGV4dF9pbmRpcmVjdF9iYihjZSk7CisJdTMyICpjczsKKworCWNzID0gZW1p
dChjZSwgc3RhcnQpOworCUdFTV9CVUdfT04oY3MgLSBzdGFydCA+IEk5MTVfR1RUX1BBR0VfU0la
RSAvIHNpemVvZigqY3MpKTsKKwl3aGlsZSAoKHVuc2lnbmVkIGxvbmcpY3MgJSBDQUNIRUxJTkVf
QllURVMpCisJCSpjcysrID0gTUlfTk9PUDsKKworCWxyY19zZXR1cF9pbmRpcmVjdF9jdHgoY2Ut
PmxyY19yZWdfc3RhdGUsIGVuZ2luZSwKKwkJCSAgICAgICBpOTE1X2dndHRfb2Zmc2V0KGNlLT5z
dGF0ZSkgKworCQkJICAgICAgIGNvbnRleHRfd2FfYmJfb2Zmc2V0KGNlKSwKKwkJCSAgICAgICAo
Y3MgLSBzdGFydCkgKiBzaXplb2YoKmNzKSk7Cit9CisKK3ZvaWQgbHJjX3VwZGF0ZV9yZWdzKGNv
bnN0IHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKKwkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmUsCisJCSAgICAgdTMyIGhlYWQpCit7CisJc3RydWN0IGludGVsX3Jp
bmcgKnJpbmcgPSBjZS0+cmluZzsKKwl1MzIgKnJlZ3MgPSBjZS0+bHJjX3JlZ19zdGF0ZTsKKwor
CUdFTV9CVUdfT04oIWludGVsX3Jpbmdfb2Zmc2V0X3ZhbGlkKHJpbmcsIGhlYWQpKTsKKwlHRU1f
QlVHX09OKCFpbnRlbF9yaW5nX29mZnNldF92YWxpZChyaW5nLCByaW5nLT50YWlsKSk7CisKKwly
ZWdzW0NUWF9SSU5HX1NUQVJUXSA9IGk5MTVfZ2d0dF9vZmZzZXQocmluZy0+dm1hKTsKKwlyZWdz
W0NUWF9SSU5HX0hFQURdID0gaGVhZDsKKwlyZWdzW0NUWF9SSU5HX1RBSUxdID0gcmluZy0+dGFp
bDsKKwlyZWdzW0NUWF9SSU5HX0NUTF0gPSBSSU5HX0NUTF9TSVpFKHJpbmctPnNpemUpIHwgUklO
R19WQUxJRDsKKworCS8qIFJQQ1MgKi8KKwlpZiAoZW5naW5lLT5jbGFzcyA9PSBSRU5ERVJfQ0xB
U1MpIHsKKwkJcmVnc1tDVFhfUl9QV1JfQ0xLX1NUQVRFXSA9CisJCQlpbnRlbF9zc2V1X21ha2Vf
cnBjcyhlbmdpbmUtPmd0LCAmY2UtPnNzZXUpOworCisJCWk5MTVfb2FfaW5pdF9yZWdfc3RhdGUo
Y2UsIGVuZ2luZSk7CisJfQorCisJaWYgKGNlLT53YV9iYl9wYWdlKSB7CisJCXUzMiAqKCpmbiko
Y29uc3Qgc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCB1MzIgKmNzKTsKKworCQlmbiA9IGdlbjEy
X2VtaXRfaW5kaXJlY3RfY3R4X3hjczsKKwkJaWYgKGNlLT5lbmdpbmUtPmNsYXNzID09IFJFTkRF
Ul9DTEFTUykKKwkJCWZuID0gZ2VuMTJfZW1pdF9pbmRpcmVjdF9jdHhfcmNzOworCisJCS8qIE11
dHVhbGx5IGV4Y2x1c2l2ZSB3cnQgdG8gZ2xvYmFsIGluZGlyZWN0IGJiICovCisJCUdFTV9CVUdf
T04oZW5naW5lLT53YV9jdHguaW5kaXJlY3RfY3R4LnNpemUpOworCQlzZXR1cF9pbmRpcmVjdF9j
dHhfYmIoY2UsIGVuZ2luZSwgZm4pOworCX0KK30KKwordm9pZCBscmNfdXBkYXRlX29mZnNldHMo
c3RydWN0IGludGVsX2NvbnRleHQgKmNlLAorCQkJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lKQoreworCXNldF9vZmZzZXRzKGNlLT5scmNfcmVnX3N0YXRlLCByZWdfb2Zmc2V0cyhlbmdp
bmUpLCBlbmdpbmUsIGZhbHNlKTsKK30KKwordm9pZCBscmNfY2hlY2tfcmVncyhjb25zdCBzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2UsCisJCSAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmUsCisJCSAgICBjb25zdCBjaGFyICp3aGVuKQoreworCWNvbnN0IHN0cnVjdCBpbnRl
bF9yaW5nICpyaW5nID0gY2UtPnJpbmc7CisJdTMyICpyZWdzID0gY2UtPmxyY19yZWdfc3RhdGU7
CisJYm9vbCB2YWxpZCA9IHRydWU7CisJaW50IHg7CisKKwlpZiAocmVnc1tDVFhfUklOR19TVEFS
VF0gIT0gaTkxNV9nZ3R0X29mZnNldChyaW5nLT52bWEpKSB7CisJCXByX2VycigiJXM6IGNvbnRl
eHQgc3VibWl0dGVkIHdpdGggaW5jb3JyZWN0IFJJTkdfU1RBUlQgWyUwOHhdLCBleHBlY3RlZCAl
MDh4XG4iLAorCQkgICAgICAgZW5naW5lLT5uYW1lLAorCQkgICAgICAgcmVnc1tDVFhfUklOR19T
VEFSVF0sCisJCSAgICAgICBpOTE1X2dndHRfb2Zmc2V0KHJpbmctPnZtYSkpOworCQlyZWdzW0NU
WF9SSU5HX1NUQVJUXSA9IGk5MTVfZ2d0dF9vZmZzZXQocmluZy0+dm1hKTsKKwkJdmFsaWQgPSBm
YWxzZTsKKwl9CisKKwlpZiAoKHJlZ3NbQ1RYX1JJTkdfQ1RMXSAmIH4oUklOR19XQUlUIHwgUklO
R19XQUlUX1NFTUFQSE9SRSkpICE9CisJICAgIChSSU5HX0NUTF9TSVpFKHJpbmctPnNpemUpIHwg
UklOR19WQUxJRCkpIHsKKwkJcHJfZXJyKCIlczogY29udGV4dCBzdWJtaXR0ZWQgd2l0aCBpbmNv
cnJlY3QgUklOR19DVEwgWyUwOHhdLCBleHBlY3RlZCAlMDh4XG4iLAorCQkgICAgICAgZW5naW5l
LT5uYW1lLAorCQkgICAgICAgcmVnc1tDVFhfUklOR19DVExdLAorCQkgICAgICAgKHUzMikoUklO
R19DVExfU0laRShyaW5nLT5zaXplKSB8IFJJTkdfVkFMSUQpKTsKKwkJcmVnc1tDVFhfUklOR19D
VExdID0gUklOR19DVExfU0laRShyaW5nLT5zaXplKSB8IFJJTkdfVkFMSUQ7CisJCXZhbGlkID0g
ZmFsc2U7CisJfQorCisJeCA9IGxyY19yaW5nX21pX21vZGUoZW5naW5lKTsKKwlpZiAoeCAhPSAt
MSAmJiByZWdzW3ggKyAxXSAmIChyZWdzW3ggKyAxXSA+PiAxNikgJiBTVE9QX1JJTkcpIHsKKwkJ
cHJfZXJyKCIlczogY29udGV4dCBzdWJtaXR0ZWQgd2l0aCBTVE9QX1JJTkcgWyUwOHhdIGluIFJJ
TkdfTUlfTU9ERVxuIiwKKwkJICAgICAgIGVuZ2luZS0+bmFtZSwgcmVnc1t4ICsgMV0pOworCQly
ZWdzW3ggKyAxXSAmPSB+U1RPUF9SSU5HOworCQlyZWdzW3ggKyAxXSB8PSBTVE9QX1JJTkcgPDwg
MTY7CisJCXZhbGlkID0gZmFsc2U7CisJfQorCisJV0FSTl9PTkNFKCF2YWxpZCwgIkludmFsaWQg
bHJjIHN0YXRlIGZvdW5kICVzIHN1Ym1pc3Npb25cbiIsIHdoZW4pOworfQorCisvKgorICogSW4g
dGhpcyBXQSB3ZSBuZWVkIHRvIHNldCBHRU44X0wzU1FDUkVHNFsyMToyMV0gYW5kIHJlc2V0IGl0
IGFmdGVyCisgKiBQSVBFX0NPTlRST0wgaW5zdHJ1Y3Rpb24uIFRoaXMgaXMgcmVxdWlyZWQgZm9y
IHRoZSBmbHVzaCB0byBoYXBwZW4gY29ycmVjdGx5CisgKiBidXQgdGhlcmUgaXMgYSBzbGlnaHQg
Y29tcGxpY2F0aW9uIGFzIHRoaXMgaXMgYXBwbGllZCBpbiBXQSBiYXRjaCB3aGVyZSB0aGUKKyAq
IHZhbHVlcyBhcmUgb25seSBpbml0aWFsaXplZCBvbmNlIHNvIHdlIGNhbm5vdCB0YWtlIHJlZ2lz
dGVyIHZhbHVlIGF0IHRoZQorICogYmVnaW5uaW5nIGFuZCByZXVzZSBpdCBmdXJ0aGVyOyBoZW5j
ZSB3ZSBzYXZlIGl0cyB2YWx1ZSB0byBtZW1vcnksIHVwbG9hZCBhCisgKiBjb25zdGFudCB2YWx1
ZSB3aXRoIGJpdDIxIHNldCBhbmQgdGhlbiB3ZSByZXN0b3JlIGl0IGJhY2sgd2l0aCB0aGUgc2F2
ZWQgdmFsdWUuCisgKiBUbyBzaW1wbGlmeSB0aGUgV0EsIGEgY29uc3RhbnQgdmFsdWUgaXMgZm9y
bWVkIGJ5IHVzaW5nIHRoZSBkZWZhdWx0IHZhbHVlCisgKiBvZiB0aGlzIHJlZ2lzdGVyLiBUaGlz
IHNob3VsZG4ndCBiZSBhIHByb2JsZW0gYmVjYXVzZSB3ZSBhcmUgb25seSBtb2RpZnlpbmcKKyAq
IGl0IGZvciBhIHNob3J0IHBlcmlvZCBhbmQgdGhpcyBiYXRjaCBpbiBub24tcHJlbXB0aWJsZS4g
V2UgY2FuIG9mY291cnNlCisgKiB1c2UgYWRkaXRpb25hbCBpbnN0cnVjdGlvbnMgdGhhdCByZWFk
IHRoZSBhY3R1YWwgdmFsdWUgb2YgdGhlIHJlZ2lzdGVyCisgKiBhdCB0aGF0IHRpbWUgYW5kIHNl
dCBvdXIgYml0IG9mIGludGVyZXN0IGJ1dCBpdCBtYWtlcyB0aGUgV0EgY29tcGxpY2F0ZWQuCisg
KgorICogVGhpcyBXQSBpcyBhbHNvIHJlcXVpcmVkIGZvciBHZW45IHNvIGV4dHJhY3RpbmcgYXMg
YSBmdW5jdGlvbiBhdm9pZHMKKyAqIGNvZGUgZHVwbGljYXRpb24uCisgKi8KK3N0YXRpYyB1MzIg
KgorZ2VuOF9lbWl0X2ZsdXNoX2NvaGVyZW50bDNfd2Eoc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lLCB1MzIgKmJhdGNoKQoreworCS8qIE5CIG5vIG9uZSBlbHNlIGlzIGFsbG93ZWQgdG8g
c2NyaWJibGUgb3ZlciBzY3JhdGNoICsgMjU2ISAqLworCSpiYXRjaCsrID0gTUlfU1RPUkVfUkVH
SVNURVJfTUVNX0dFTjggfCBNSV9TUk1fTFJNX0dMT0JBTF9HVFQ7CisJKmJhdGNoKysgPSBpOTE1
X21taW9fcmVnX29mZnNldChHRU44X0wzU1FDUkVHNCk7CisJKmJhdGNoKysgPSBpbnRlbF9ndF9z
Y3JhdGNoX29mZnNldChlbmdpbmUtPmd0LAorCQkJCQkgICBJTlRFTF9HVF9TQ1JBVENIX0ZJRUxE
X0NPSEVSRU5UTDNfV0EpOworCSpiYXRjaCsrID0gMDsKKworCSpiYXRjaCsrID0gTUlfTE9BRF9S
RUdJU1RFUl9JTU0oMSk7CisJKmJhdGNoKysgPSBpOTE1X21taW9fcmVnX29mZnNldChHRU44X0wz
U1FDUkVHNCk7CisJKmJhdGNoKysgPSAweDQwNDAwMDAwIHwgR0VOOF9MUVNDX0ZMVVNIX0NPSEVS
RU5UX0xJTkVTOworCisJYmF0Y2ggPSBnZW44X2VtaXRfcGlwZV9jb250cm9sKGJhdGNoLAorCQkJ
CSAgICAgICBQSVBFX0NPTlRST0xfQ1NfU1RBTEwgfAorCQkJCSAgICAgICBQSVBFX0NPTlRST0xf
RENfRkxVU0hfRU5BQkxFLAorCQkJCSAgICAgICAwKTsKKworCSpiYXRjaCsrID0gTUlfTE9BRF9S
RUdJU1RFUl9NRU1fR0VOOCB8IE1JX1NSTV9MUk1fR0xPQkFMX0dUVDsKKwkqYmF0Y2grKyA9IGk5
MTVfbW1pb19yZWdfb2Zmc2V0KEdFTjhfTDNTUUNSRUc0KTsKKwkqYmF0Y2grKyA9IGludGVsX2d0
X3NjcmF0Y2hfb2Zmc2V0KGVuZ2luZS0+Z3QsCisJCQkJCSAgIElOVEVMX0dUX1NDUkFUQ0hfRklF
TERfQ09IRVJFTlRMM19XQSk7CisJKmJhdGNoKysgPSAwOworCisJcmV0dXJuIGJhdGNoOworfQor
CisvKgorICogVHlwaWNhbGx5IHdlIG9ubHkgaGF2ZSBvbmUgaW5kaXJlY3RfY3R4IGFuZCBwZXJf
Y3R4IGJhdGNoIGJ1ZmZlciB3aGljaCBhcmUKKyAqIGluaXRpYWxpemVkIGF0IHRoZSBiZWdpbm5p
bmcgYW5kIHNoYXJlZCBhY3Jvc3MgYWxsIGNvbnRleHRzIGJ1dCB0aGlzIGZpZWxkCisgKiBoZWxw
cyB1cyB0byBoYXZlIG11bHRpcGxlIGJhdGNoZXMgYXQgZGlmZmVyZW50IG9mZnNldHMgYW5kIHNl
bGVjdCB0aGVtIGJhc2VkCisgKiBvbiBhIGNyaXRlcmlhLiBBdCB0aGUgbW9tZW50IHRoaXMgYmF0
Y2ggYWx3YXlzIHN0YXJ0IGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIHBhZ2UKKyAqIGFuZCBhdCB0
aGlzIHBvaW50IHdlIGRvbid0IGhhdmUgbXVsdGlwbGUgd2FfY3R4IGJhdGNoIGJ1ZmZlcnMuCisg
KgorICogVGhlIG51bWJlciBvZiBXQSBhcHBsaWVkIGFyZSBub3Qga25vd24gYXQgdGhlIGJlZ2lu
bmluZzsgd2UgdXNlIHRoaXMgZmllbGQKKyAqIHRvIHJldHVybiB0aGUgbm8gb2YgRFdPUkRTIHdy
aXR0ZW4uCisgKgorICogSXQgaXMgdG8gYmUgbm90ZWQgdGhhdCB0aGlzIGJhdGNoIGRvZXMgbm90
IGNvbnRhaW4gTUlfQkFUQ0hfQlVGRkVSX0VORAorICogc28gaXQgYWRkcyBOT09QcyBhcyBwYWRk
aW5nIHRvIG1ha2UgaXQgY2FjaGVsaW5lIGFsaWduZWQuCisgKiBNSV9CQVRDSF9CVUZGRVJfRU5E
IHdpbGwgYmUgYWRkZWQgdG8gcGVyY3R4IGJhdGNoIGFuZCBib3RoIG9mIHRoZW0gdG9nZXRoZXIK
KyAqIG1ha2VzIGEgY29tcGxldGUgYmF0Y2ggYnVmZmVyLgorICovCitzdGF0aWMgdTMyICpnZW44
X2luaXRfaW5kaXJlY3RjdHhfYmIoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCB1MzIg
KmJhdGNoKQoreworCS8qIFdhRGlzYWJsZUN0eFJlc3RvcmVBcmJpdHJhdGlvbjpiZHcsY2h2ICov
CisJKmJhdGNoKysgPSBNSV9BUkJfT05fT0ZGIHwgTUlfQVJCX0RJU0FCTEU7CisKKwkvKiBXYUZs
dXNoQ29oZXJlbnRMM0NhY2hlTGluZXNBdENvbnRleHRTd2l0Y2g6YmR3ICovCisJaWYgKElTX0JS
T0FEV0VMTChlbmdpbmUtPmk5MTUpKQorCQliYXRjaCA9IGdlbjhfZW1pdF9mbHVzaF9jb2hlcmVu
dGwzX3dhKGVuZ2luZSwgYmF0Y2gpOworCisJLyogV2FDbGVhclNsbVNwYWNlQXRDb250ZXh0U3dp
dGNoOmJkdyxjaHYgKi8KKwkvKiBBY3R1YWwgc2NyYXRjaCBsb2NhdGlvbiBpcyBhdCAxMjggYnl0
ZXMgb2Zmc2V0ICovCisJYmF0Y2ggPSBnZW44X2VtaXRfcGlwZV9jb250cm9sKGJhdGNoLAorCQkJ
CSAgICAgICBQSVBFX0NPTlRST0xfRkxVU0hfTDMgfAorCQkJCSAgICAgICBQSVBFX0NPTlRST0xf
U1RPUkVfREFUQV9JTkRFWCB8CisJCQkJICAgICAgIFBJUEVfQ09OVFJPTF9DU19TVEFMTCB8CisJ
CQkJICAgICAgIFBJUEVfQ09OVFJPTF9RV19XUklURSwKKwkJCQkgICAgICAgTFJDX1BQSFdTUF9T
Q1JBVENIX0FERFIpOworCisJKmJhdGNoKysgPSBNSV9BUkJfT05fT0ZGIHwgTUlfQVJCX0VOQUJM
RTsKKworCS8qIFBhZCB0byBlbmQgb2YgY2FjaGVsaW5lICovCisJd2hpbGUgKCh1bnNpZ25lZCBs
b25nKWJhdGNoICUgQ0FDSEVMSU5FX0JZVEVTKQorCQkqYmF0Y2grKyA9IE1JX05PT1A7CisKKwkv
KgorCSAqIE1JX0JBVENIX0JVRkZFUl9FTkQgaXMgbm90IHJlcXVpcmVkIGluIEluZGlyZWN0IGN0
eCBCQiBiZWNhdXNlCisJICogZXhlY3V0aW9uIGRlcGVuZHMgb24gdGhlIGxlbmd0aCBzcGVjaWZp
ZWQgaW4gdGVybXMgb2YgY2FjaGUgbGluZXMKKwkgKiBpbiB0aGUgcmVnaXN0ZXIgQ1RYX1JDU19J
TkRJUkVDVF9DVFgKKwkgKi8KKworCXJldHVybiBiYXRjaDsKK30KKworc3RydWN0IGxyaSB7CisJ
aTkxNV9yZWdfdCByZWc7CisJdTMyIHZhbHVlOworfTsKKworc3RhdGljIHUzMiAqZW1pdF9scmko
dTMyICpiYXRjaCwgY29uc3Qgc3RydWN0IGxyaSAqbHJpLCB1bnNpZ25lZCBpbnQgY291bnQpCit7
CisJR0VNX0JVR19PTighY291bnQgfHwgY291bnQgPiA2Myk7CisKKwkqYmF0Y2grKyA9IE1JX0xP
QURfUkVHSVNURVJfSU1NKGNvdW50KTsKKwlkbyB7CisJCSpiYXRjaCsrID0gaTkxNV9tbWlvX3Jl
Z19vZmZzZXQobHJpLT5yZWcpOworCQkqYmF0Y2grKyA9IGxyaS0+dmFsdWU7CisJfSB3aGlsZSAo
bHJpKyssIC0tY291bnQpOworCSpiYXRjaCsrID0gTUlfTk9PUDsKKworCXJldHVybiBiYXRjaDsK
K30KKworc3RhdGljIHUzMiAqZ2VuOV9pbml0X2luZGlyZWN0Y3R4X2JiKHN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZSwgdTMyICpiYXRjaCkKK3sKKwlzdGF0aWMgY29uc3Qgc3RydWN0IGxy
aSBscmlbXSA9IHsKKwkJLyogV2FEaXNhYmxlR2F0aGVyQXRTZXRTaGFkZXJDb21tb25TbGljZTpz
a2wsYnh0LGtibCxnbGsgKi8KKwkJeworCQkJQ09NTU9OX1NMSUNFX0NISUNLRU4yLAorCQkJX19N
QVNLRURfRklFTEQoR0VOOV9ESVNBQkxFX0dBVEhFUl9BVF9TRVRfU0hBREVSX0NPTU1PTl9TTElD
RSwKKwkJCQkgICAgICAgMCksCisJCX0sCisKKwkJLyogQlNwZWM6IDExMzkxICovCisJCXsKKwkJ
CUZGX1NMSUNFX0NISUNLRU4sCisJCQlfX01BU0tFRF9GSUVMRChGRl9TTElDRV9DSElDS0VOX0NM
X1BST1ZPS0lOR19WRVJURVhfRklYLAorCQkJCSAgICAgICBGRl9TTElDRV9DSElDS0VOX0NMX1BS
T1ZPS0lOR19WRVJURVhfRklYKSwKKwkJfSwKKworCQkvKiBCU3BlYzogMTEyOTkgKi8KKwkJewor
CQkJXzNEX0NISUNLRU4zLAorCQkJX19NQVNLRURfRklFTEQoXzNEX0NISUNLRU5fU0ZfUFJPVk9L
SU5HX1ZFUlRFWF9GSVgsCisJCQkJICAgICAgIF8zRF9DSElDS0VOX1NGX1BST1ZPS0lOR19WRVJU
RVhfRklYKSwKKwkJfQorCX07CisKKwkqYmF0Y2grKyA9IE1JX0FSQl9PTl9PRkYgfCBNSV9BUkJf
RElTQUJMRTsKKworCS8qIFdhRmx1c2hDb2hlcmVudEwzQ2FjaGVMaW5lc0F0Q29udGV4dFN3aXRj
aDpza2wsYnh0LGdsayAqLworCWJhdGNoID0gZ2VuOF9lbWl0X2ZsdXNoX2NvaGVyZW50bDNfd2Eo
ZW5naW5lLCBiYXRjaCk7CisKKwkvKiBXYUNsZWFyU2xtU3BhY2VBdENvbnRleHRTd2l0Y2g6c2ts
LGJ4dCxrYmwsZ2xrLGNmbCAqLworCWJhdGNoID0gZ2VuOF9lbWl0X3BpcGVfY29udHJvbChiYXRj
aCwKKwkJCQkgICAgICAgUElQRV9DT05UUk9MX0ZMVVNIX0wzIHwKKwkJCQkgICAgICAgUElQRV9D
T05UUk9MX1NUT1JFX0RBVEFfSU5ERVggfAorCQkJCSAgICAgICBQSVBFX0NPTlRST0xfQ1NfU1RB
TEwgfAorCQkJCSAgICAgICBQSVBFX0NPTlRST0xfUVdfV1JJVEUsCisJCQkJICAgICAgIExSQ19Q
UEhXU1BfU0NSQVRDSF9BRERSKTsKKworCWJhdGNoID0gZW1pdF9scmkoYmF0Y2gsIGxyaSwgQVJS
QVlfU0laRShscmkpKTsKKworCS8qIFdhTWVkaWFQb29sU3RhdGVDbWRJbldBQkI6Ynh0LGdsayAq
LworCWlmIChIQVNfUE9PTEVEX0VVKGVuZ2luZS0+aTkxNSkpIHsKKwkJLyoKKwkJICogRVUgcG9v
bCBjb25maWd1cmF0aW9uIGlzIHNldHVwIGFsb25nIHdpdGggZ29sZGVuIGNvbnRleHQKKwkJICog
ZHVyaW5nIGNvbnRleHQgaW5pdGlhbGl6YXRpb24uIFRoaXMgdmFsdWUgZGVwZW5kcyBvbgorCQkg
KiBkZXZpY2UgdHlwZSAoMng2IG9yIDN4NikgYW5kIG5lZWRzIHRvIGJlIHVwZGF0ZWQgYmFzZWQK
KwkJICogb24gd2hpY2ggc3Vic2xpY2UgaXMgZGlzYWJsZWQgZXNwZWNpYWxseSBmb3IgMng2CisJ
CSAqIGRldmljZXMsIGhvd2V2ZXIgaXQgaXMgc2FmZSB0byBsb2FkIGRlZmF1bHQKKwkJICogY29u
ZmlndXJhdGlvbiBvZiAzeDYgZGV2aWNlIGluc3RlYWQgb2YgbWFza2luZyBvZmYKKwkJICogY29y
cmVzcG9uZGluZyBiaXRzIGJlY2F1c2UgSFcgaWdub3JlcyBiaXRzIG9mIGEgZGlzYWJsZWQKKwkJ
ICogc3Vic2xpY2UgYW5kIGRyb3BzIGRvd24gdG8gYXBwcm9wcmlhdGUgY29uZmlnLiBQbGVhc2UK
KwkJICogc2VlIHJlbmRlcl9zdGF0ZV9zZXR1cCgpIGluIGk5MTVfZ2VtX3JlbmRlcl9zdGF0ZS5j
IGZvcgorCQkgKiBwb3NzaWJsZSBjb25maWd1cmF0aW9ucywgdG8gYXZvaWQgZHVwbGljYXRpb24g
dGhleSBhcmUKKwkJICogbm90IHNob3duIGhlcmUgYWdhaW4uCisJCSAqLworCQkqYmF0Y2grKyA9
IEdFTjlfTUVESUFfUE9PTF9TVEFURTsKKwkJKmJhdGNoKysgPSBHRU45X01FRElBX1BPT0xfRU5B
QkxFOworCQkqYmF0Y2grKyA9IDB4MDA3NzcwMDA7CisJCSpiYXRjaCsrID0gMDsKKwkJKmJhdGNo
KysgPSAwOworCQkqYmF0Y2grKyA9IDA7CisJfQorCisJKmJhdGNoKysgPSBNSV9BUkJfT05fT0ZG
IHwgTUlfQVJCX0VOQUJMRTsKKworCS8qIFBhZCB0byBlbmQgb2YgY2FjaGVsaW5lICovCisJd2hp
bGUgKCh1bnNpZ25lZCBsb25nKWJhdGNoICUgQ0FDSEVMSU5FX0JZVEVTKQorCQkqYmF0Y2grKyA9
IE1JX05PT1A7CisKKwlyZXR1cm4gYmF0Y2g7Cit9CisKK3N0YXRpYyB1MzIgKgorZ2VuMTBfaW5p
dF9pbmRpcmVjdGN0eF9iYihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIHUzMiAqYmF0
Y2gpCit7CisJaW50IGk7CisKKwkvKgorCSAqIFdhUGlwZUNvbnRyb2xCZWZvcmUzRFN0YXRlU2Ft
cGxlUGF0dGVybjogY25sCisJICoKKwkgKiBFbnN1cmUgdGhlIGVuZ2luZSBpcyBpZGxlIHByaW9y
IHRvIHByb2dyYW1taW5nIGEKKwkgKiAzRFNUQVRFX1NBTVBMRV9QQVRURVJOIGR1cmluZyBhIGNv
bnRleHQgcmVzdG9yZS4KKwkgKi8KKwliYXRjaCA9IGdlbjhfZW1pdF9waXBlX2NvbnRyb2woYmF0
Y2gsCisJCQkJICAgICAgIFBJUEVfQ09OVFJPTF9DU19TVEFMTCwKKwkJCQkgICAgICAgMCk7CisJ
LyoKKwkgKiBXYVBpcGVDb250cm9sQmVmb3JlM0RTdGF0ZVNhbXBsZVBhdHRlcm4gc2F5cyB3ZSBu
ZWVkIDQgZHdvcmRzIGZvcgorCSAqIHRoZSBQSVBFX0NPTlRST0wgZm9sbG93ZWQgYnkgMTIgZHdv
cmRzIG9mIDB4MCwgc28gMTYgZHdvcmRzIGluCisJICogdG90YWwuIEhvd2V2ZXIsIGEgUElQRV9D
T05UUk9MIGlzIDYgZHdvcmRzIGxvbmcsIG5vdCA0LCB3aGljaCBpcworCSAqIGNvbmZ1c2luZy4g
U2luY2UgZ2VuOF9lbWl0X3BpcGVfY29udHJvbCgpIGFscmVhZHkgYWR2YW5jZXMgdGhlCisJICog
YmF0Y2ggYnkgNiBkd29yZHMsIHdlIGFkdmFuY2UgdGhlIG90aGVyIDEwIGhlcmUsIGNvbXBsZXRp
bmcgYQorCSAqIGNhY2hlbGluZS4gSXQncyBub3QgY2xlYXIgaWYgdGhlIHdvcmthcm91bmQgcmVx
dWlyZXMgdGhpcyBwYWRkaW5nCisJICogYmVmb3JlIG90aGVyIGNvbW1hbmRzLCBvciBpZiBpdCdz
IGp1c3QgdGhlIHJlZ3VsYXIgcGFkZGluZyB3ZSB3b3VsZAorCSAqIGFscmVhZHkgaGF2ZSBmb3Ig
dGhlIHdvcmthcm91bmQgYmIsIHNvIGxlYXZlIGl0IGhlcmUgZm9yIG5vdy4KKwkgKi8KKwlmb3Ig
KGkgPSAwOyBpIDwgMTA7IGkrKykKKwkJKmJhdGNoKysgPSBNSV9OT09QOworCisJLyogUGFkIHRv
IGVuZCBvZiBjYWNoZWxpbmUgKi8KKwl3aGlsZSAoKHVuc2lnbmVkIGxvbmcpYmF0Y2ggJSBDQUNI
RUxJTkVfQllURVMpCisJCSpiYXRjaCsrID0gTUlfTk9PUDsKKworCXJldHVybiBiYXRjaDsKK30K
KworI2RlZmluZSBDVFhfV0FfQkJfU0laRSAoUEFHRV9TSVpFKQorCitzdGF0aWMgaW50IGxyY19z
ZXR1cF93YV9jdHgoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQoreworCXN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CisJc3RydWN0IGk5MTVfdm1hICp2bWE7CisJaW50IGVy
cjsKKworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc2htZW0oZW5naW5lLT5pOTE1LCBD
VFhfV0FfQkJfU0laRSk7CisJaWYgKElTX0VSUihvYmopKQorCQlyZXR1cm4gUFRSX0VSUihvYmop
OworCisJdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCAmZW5naW5lLT5ndC0+Z2d0dC0+dm0s
IE5VTEwpOworCWlmIChJU19FUlIodm1hKSkgeworCQllcnIgPSBQVFJfRVJSKHZtYSk7CisJCWdv
dG8gZXJyOworCX0KKworCWVyciA9IGk5MTVfZ2d0dF9waW4odm1hLCBOVUxMLCAwLCBQSU5fSElH
SCk7CisJaWYgKGVycikKKwkJZ290byBlcnI7CisKKwllbmdpbmUtPndhX2N0eC52bWEgPSB2bWE7
CisJcmV0dXJuIDA7CisKK2VycjoKKwlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CisJcmV0dXJu
IGVycjsKK30KKwordm9pZCBscmNfZmluaV93YV9jdHgoc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lKQoreworCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZlbmdpbmUtPndhX2N0eC52
bWEsIDApOworfQorCit0eXBlZGVmIHUzMiAqKCp3YV9iYl9mdW5jX3QpKHN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZSwgdTMyICpiYXRjaCk7CisKK2ludCBscmNfaW5pdF93YV9jdHgoc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQoreworCXN0cnVjdCBpOTE1X2N0eF93b3JrYXJv
dW5kcyAqd2FfY3R4ID0gJmVuZ2luZS0+d2FfY3R4OworCXN0cnVjdCBpOTE1X3dhX2N0eF9iYiAq
d2FfYmJbXSA9IHsKKwkJJndhX2N0eC0+aW5kaXJlY3RfY3R4LCAmd2FfY3R4LT5wZXJfY3R4CisJ
fTsKKwl3YV9iYl9mdW5jX3Qgd2FfYmJfZm5bQVJSQVlfU0laRSh3YV9iYildOworCXZvaWQgKmJh
dGNoLCAqYmF0Y2hfcHRyOworCXVuc2lnbmVkIGludCBpOworCWludCByZXQ7CisKKwlpZiAoZW5n
aW5lLT5jbGFzcyAhPSBSRU5ERVJfQ0xBU1MpCisJCXJldHVybiAwOworCisJc3dpdGNoIChJTlRF
TF9HRU4oZW5naW5lLT5pOTE1KSkgeworCWNhc2UgMTI6CisJY2FzZSAxMToKKwkJcmV0dXJuIDA7
CisJY2FzZSAxMDoKKwkJd2FfYmJfZm5bMF0gPSBnZW4xMF9pbml0X2luZGlyZWN0Y3R4X2JiOwor
CQl3YV9iYl9mblsxXSA9IE5VTEw7CisJCWJyZWFrOworCWNhc2UgOToKKwkJd2FfYmJfZm5bMF0g
PSBnZW45X2luaXRfaW5kaXJlY3RjdHhfYmI7CisJCXdhX2JiX2ZuWzFdID0gTlVMTDsKKwkJYnJl
YWs7CisJY2FzZSA4OgorCQl3YV9iYl9mblswXSA9IGdlbjhfaW5pdF9pbmRpcmVjdGN0eF9iYjsK
KwkJd2FfYmJfZm5bMV0gPSBOVUxMOworCQlicmVhazsKKwlkZWZhdWx0OgorCQlNSVNTSU5HX0NB
U0UoSU5URUxfR0VOKGVuZ2luZS0+aTkxNSkpOworCQlyZXR1cm4gMDsKKwl9CisKKwlyZXQgPSBs
cmNfc2V0dXBfd2FfY3R4KGVuZ2luZSk7CisJaWYgKHJldCkgeworCQlkcm1fZGJnKCZlbmdpbmUt
Pmk5MTUtPmRybSwKKwkJCSJGYWlsZWQgdG8gc2V0dXAgY29udGV4dCBXQSBwYWdlOiAlZFxuIiwg
cmV0KTsKKwkJcmV0dXJuIHJldDsKKwl9CisKKwliYXRjaCA9IGk5MTVfZ2VtX29iamVjdF9waW5f
bWFwKHdhX2N0eC0+dm1hLT5vYmosIEk5MTVfTUFQX1dCKTsKKworCS8qCisJICogRW1pdCB0aGUg
dHdvIHdvcmthcm91bmQgYmF0Y2ggYnVmZmVycywgcmVjb3JkaW5nIHRoZSBvZmZzZXQgZnJvbSB0
aGUKKwkgKiBzdGFydCBvZiB0aGUgd29ya2Fyb3VuZCBiYXRjaCBidWZmZXIgb2JqZWN0IGZvciBl
YWNoIGFuZCB0aGVpcgorCSAqIHJlc3BlY3RpdmUgc2l6ZXMuCisJICovCisJYmF0Y2hfcHRyID0g
YmF0Y2g7CisJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUod2FfYmJfZm4pOyBpKyspIHsKKwkJ
d2FfYmJbaV0tPm9mZnNldCA9IGJhdGNoX3B0ciAtIGJhdGNoOworCQlpZiAoR0VNX0RFQlVHX1dB
Uk5fT04oIUlTX0FMSUdORUQod2FfYmJbaV0tPm9mZnNldCwKKwkJCQkJCSAgQ0FDSEVMSU5FX0JZ
VEVTKSkpIHsKKwkJCXJldCA9IC1FSU5WQUw7CisJCQlicmVhazsKKwkJfQorCQlpZiAod2FfYmJf
Zm5baV0pCisJCQliYXRjaF9wdHIgPSB3YV9iYl9mbltpXShlbmdpbmUsIGJhdGNoX3B0cik7CisJ
CXdhX2JiW2ldLT5zaXplID0gYmF0Y2hfcHRyIC0gKGJhdGNoICsgd2FfYmJbaV0tPm9mZnNldCk7
CisJfQorCUdFTV9CVUdfT04oYmF0Y2hfcHRyIC0gYmF0Y2ggPiBDVFhfV0FfQkJfU0laRSk7CisK
KwlfX2k5MTVfZ2VtX29iamVjdF9mbHVzaF9tYXAod2FfY3R4LT52bWEtPm9iaiwgMCwgYmF0Y2hf
cHRyIC0gYmF0Y2gpOworCV9faTkxNV9nZW1fb2JqZWN0X3JlbGVhc2VfbWFwKHdhX2N0eC0+dm1h
LT5vYmopOworCWlmIChyZXQpCisJCWxyY19maW5pX3dhX2N0eChlbmdpbmUpOworCisJcmV0dXJu
IHJldDsKK30KKworI2lmIElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X1NFTEZURVNUKQorI2lu
Y2x1ZGUgInNlbGZ0ZXN0X2xyYy5jIgorI2VuZGlmCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9scmMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xy
Yy5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uM2QzZTQwOGE4N2E5
Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmgK
QEAgLTAsMCArMSwxMTQgQEAKKy8qIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQgKi8KKy8q
CisgKiBDb3B5cmlnaHQgwqkgMjAxNCBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpZm5kZWYg
X19JTlRFTF9MUkNfSF9fCisjZGVmaW5lIF9fSU5URUxfTFJDX0hfXworCisjaW5jbHVkZSA8bGlu
dXgvdHlwZXMuaD4KKworI2luY2x1ZGUgImludGVsX2NvbnRleHQuaCIKKyNpbmNsdWRlICJpbnRl
bF9scmNfcmVnLmgiCisKK3N0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0Oworc3RydWN0IGludGVs
X2VuZ2luZV9jczsKK3N0cnVjdCBpbnRlbF9yaW5nOworCisvKiBBdCB0aGUgc3RhcnQgb2YgdGhl
IGNvbnRleHQgaW1hZ2UgaXMgaXRzIHBlci1wcm9jZXNzIEhXUyBwYWdlICovCisjZGVmaW5lIExS
Q19QUEhXU1BfUE4JKDApCisjZGVmaW5lIExSQ19QUEhXU1BfU1oJKDEpCisvKiBBZnRlciB0aGUg
UFBIV1NQIHdlIGhhdmUgdGhlIGxvZ2ljYWwgc3RhdGUgZm9yIHRoZSBjb250ZXh0ICovCisjZGVm
aW5lIExSQ19TVEFURV9QTgkoTFJDX1BQSFdTUF9QTiArIExSQ19QUEhXU1BfU1opCisjZGVmaW5l
IExSQ19TVEFURV9PRkZTRVQgKExSQ19TVEFURV9QTiAqIFBBR0VfU0laRSkKKworLyogU3BhY2Ug
d2l0aGluIFBQSFdTUCByZXNlcnZlZCB0byBiZSB1c2VkIGFzIHNjcmF0Y2ggKi8KKyNkZWZpbmUg
TFJDX1BQSFdTUF9TQ1JBVENICQkweDM0CisjZGVmaW5lIExSQ19QUEhXU1BfU0NSQVRDSF9BRERS
CQkoTFJDX1BQSFdTUF9TQ1JBVENIICogc2l6ZW9mKHUzMikpCisKK2ludCBscmNfaW5pdF93YV9j
dHgoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKK3ZvaWQgbHJjX2Zpbmlfd2FfY3R4
KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSk7CisKK2ludCBscmNfYWxsb2Moc3RydWN0
IGludGVsX2NvbnRleHQgKmNlLAorCSAgICAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZSk7Cit2b2lkIGxyY19yZXNldChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCisJICAgICAgIHN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKKwkgICAgICAgdTMyIGhlYWQsCisJICAgICAg
IGJvb2wgc2NydWIpOworCit2b2lkIGxyY19pbml0X3JlZ3MoY29uc3Qgc3RydWN0IGludGVsX2Nv
bnRleHQgKmNlLAorCQkgICBjb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCisJ
CSAgIGNvbnN0IHN0cnVjdCBpbnRlbF9yaW5nICpyaW5nLAorCQkgICBib29sIGNsb3NlKTsKK3Zv
aWQgbHJjX3VwZGF0ZV9yZWdzKGNvbnN0IHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKKwkJICAg
ICBjb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCisJCSAgICAgdTMyIGhlYWQp
Owordm9pZCBscmNfcmVzZXRfcmVncyhjb25zdCBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCisJ
CSAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpOworCit2b2lkIGxyY19y
ZXN0b3JlX2RlZmF1bHRzKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKKwkJCSAgc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKKwordm9pZCBscmNfdXBkYXRlX29mZnNldHMoc3RydWN0
IGludGVsX2NvbnRleHQgKmNlLAorCQkJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsK
Kwordm9pZCBscmNfY2hlY2tfcmVncyhjb25zdCBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCisJ
CSAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsCisJCSAgICBjb25zdCBj
aGFyICp3aGVuKTsKK3ZvaWQgbHJjX2NoZWNrX3JlZHpvbmUoc3RydWN0IGludGVsX2NvbnRleHQg
KmNlKTsKKworc3RhdGljIGlubGluZSB1MzIgbHJjX2dldF9ydW50aW1lKGNvbnN0IHN0cnVjdCBp
bnRlbF9jb250ZXh0ICpjZSkKK3sKKwkvKgorCSAqIFdlIGNhbiB1c2UgZWl0aGVyIHBwSFdTUFsx
Nl0gd2hpY2ggaXMgcmVjb3JkZWQgYmVmb3JlIHRoZSBjb250ZXh0CisJICogc3dpdGNoIChhbmQg
c28gZXhjbHVkZXMgdGhlIGNvc3Qgb2YgY29udGV4dCBzd2l0Y2hlcykgb3IgdXNlIHRoZQorCSAq
IHZhbHVlIGZyb20gdGhlIGNvbnRleHQgaW1hZ2UgaXRzZWxmLCB3aGljaCBpcyBzYXZlZC9yZXN0
b3JlZCBlYXJsaWVyCisJICogYW5kIHNvIGluY2x1ZGVzIHRoZSBjb3N0IG9mIHRoZSBzYXZlLgor
CSAqLworCXJldHVybiBSRUFEX09OQ0UoY2UtPmxyY19yZWdfc3RhdGVbQ1RYX1RJTUVTVEFNUF0p
OworfQorCisvKgorICogVGhlIGNvbnRleHQgZGVzY3JpcHRvciBlbmNvZGVzIHZhcmlvdXMgYXR0
cmlidXRlcyBvZiBhIGNvbnRleHQsCisgKiBpbmNsdWRpbmcgaXRzIEdUVCBhZGRyZXNzIGFuZCBz
b21lIGZsYWdzLiBCZWNhdXNlIGl0J3MgZmFpcmx5CisgKiBleHBlbnNpdmUgdG8gY2FsY3VsYXRl
LCB3ZSdsbCBqdXN0IGRvIGl0IG9uY2UgYW5kIGNhY2hlIHRoZSByZXN1bHQsCisgKiB3aGljaCBy
ZW1haW5zIHZhbGlkIHVudGlsIHRoZSBjb250ZXh0IGlzIHVucGlubmVkLgorICoKKyAqIFRoaXMg
aXMgd2hhdCBhIGRlc2NyaXB0b3IgbG9va3MgbGlrZSwgZnJvbSBMU0IgdG8gTVNCOjoKKyAqCisg
KiAgICAgIGJpdHMgIDAtMTE6ICAgIGZsYWdzLCBHRU44X0NUWF8qIChjYWNoZWQgaW4gY3R4LT5k
ZXNjX3RlbXBsYXRlKQorICogICAgICBiaXRzIDEyLTMxOiAgICBMUkNBLCBHVFQgYWRkcmVzcyBv
ZiAodGhlIEhXU1Agb2YpIHRoaXMgY29udGV4dAorICogICAgICBiaXRzIDMyLTUyOiAgICBjdHgg
SUQsIGEgZ2xvYmFsbHkgdW5pcXVlIHRhZyAoaGlnaGVzdCBiaXQgdXNlZCBieSBHdUMpCisgKiAg
ICAgIGJpdHMgNTMtNTQ6ICAgIG1ieiwgcmVzZXJ2ZWQgZm9yIHVzZSBieSBoYXJkd2FyZQorICog
ICAgICBiaXRzIDU1LTYzOiAgICBncm91cCBJRCwgY3VycmVudGx5IHVudXNlZCBhbmQgc2V0IHRv
IDAKKyAqCisgKiBTdGFydGluZyBmcm9tIEdlbjExLCB0aGUgdXBwZXIgZHdvcmQgb2YgdGhlIGRl
c2NyaXB0b3IgaGFzIGEgbmV3IGZvcm1hdDoKKyAqCisgKiAgICAgIGJpdHMgMzItMzY6ICAgIHJl
c2VydmVkCisgKiAgICAgIGJpdHMgMzctNDc6ICAgIFNXIGNvbnRleHQgSUQKKyAqICAgICAgYml0
cyA0ODo1MzogICAgZW5naW5lIGluc3RhbmNlCisgKiAgICAgIGJpdCA1NDogICAgICAgIG1ieiwg
cmVzZXJ2ZWQgZm9yIHVzZSBieSBoYXJkd2FyZQorICogICAgICBiaXRzIDU1LTYwOiAgICBTVyBj
b3VudGVyCisgKiAgICAgIGJpdHMgNjEtNjM6ICAgIGVuZ2luZSBjbGFzcworICoKKyAqIGVuZ2lu
ZSBpbmZvLCBTVyBjb250ZXh0IElEIGFuZCBTVyBjb3VudGVyIG5lZWQgdG8gZm9ybSBhIHVuaXF1
ZSBudW1iZXIKKyAqIChDb250ZXh0IElEKSBwZXIgbHJjLgorICovCitzdGF0aWMgaW5saW5lIHUz
MgorbHJjX2Rlc2NyaXB0b3Ioc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCBzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmUpCit7CisJdTMyIGRlc2M7CisKKwlkZXNjID0gSU5URUxfTEVHQUNZ
XzMyQl9DT05URVhUOworCWlmIChpOTE1X3ZtX2lzXzRsdmwoY2UtPnZtKSkKKwkJZGVzYyA9IElO
VEVMX0xFR0FDWV82NEJfQ09OVEVYVDsKKwlkZXNjIDw8PSBHRU44X0NUWF9BRERSRVNTSU5HX01P
REVfU0hJRlQ7CisKKwlkZXNjIHw9IEdFTjhfQ1RYX1ZBTElEIHwgR0VOOF9DVFhfUFJJVklMRUdF
OworCWlmIChJU19HRU4oZW5naW5lLT5pOTE1LCA4KSkKKwkJZGVzYyB8PSBHRU44X0NUWF9MM0xM
Q19DT0hFUkVOVDsKKworCXJldHVybiBpOTE1X2dndHRfb2Zmc2V0KGNlLT5zdGF0ZSkgfCBkZXNj
OworfQorCisjZW5kaWYgLyogX19JTlRFTF9MUkNfSF9fICovCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9leGVjbGlzdHMuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2V4ZWNsaXN0cy5jCmluZGV4IDk1ZDQxYzAxZDBlMC4uMzRjMmJiODMx
M2ViIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9leGVjbGlz
dHMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9leGVjbGlzdHMuYwpA
QCAtMjQ5LDcgKzI0OSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV91bmxpdGVfcmVzdG9yZShzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0LCBpbnQgcHJpbykKIAkJfQogCQlHRU1fQlVHX09OKCFjZVsxXS0+cmluZy0+
c2l6ZSk7CiAJCWludGVsX3JpbmdfcmVzZXQoY2VbMV0tPnJpbmcsIGNlWzFdLT5yaW5nLT5zaXpl
IC8gMik7Ci0JCV9fZXhlY2xpc3RzX3VwZGF0ZV9yZWdfc3RhdGUoY2VbMV0sIGVuZ2luZSwgY2Vb
MV0tPnJpbmctPmhlYWQpOworCQlscmNfdXBkYXRlX3JlZ3MoY2VbMV0sIGVuZ2luZSwgY2VbMV0t
PnJpbmctPmhlYWQpOwogCiAJCXJxWzBdID0gaWd0X3NwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJnNw
aW4sIGNlWzBdLCBNSV9BUkJfQ0hFQ0spOwogCQlpZiAoSVNfRVJSKHJxWzBdKSkgewpAQCAtNDcw
NSwxNzc3ICs0NzA1LDMgQEAgaW50IGludGVsX2V4ZWNsaXN0c19saXZlX3NlbGZ0ZXN0cyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAogCXJldHVybiBpbnRlbF9ndF9saXZlX3N1YnRl
c3RzKHRlc3RzLCAmaTkxNS0+Z3QpOwogfQotCi1zdGF0aWMgaW50IGVtaXRfc2VtYXBob3JlX3Np
Z25hbChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIHZvaWQgKnNsb3QpCi17Ci0JY29uc3QgdTMy
IG9mZnNldCA9Ci0JCWk5MTVfZ2d0dF9vZmZzZXQoY2UtPmVuZ2luZS0+c3RhdHVzX3BhZ2Uudm1h
KSArCi0JCW9mZnNldF9pbl9wYWdlKHNsb3QpOwotCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwot
CXUzMiAqY3M7Ci0KLQlycSA9IGludGVsX2NvbnRleHRfY3JlYXRlX3JlcXVlc3QoY2UpOwotCWlm
IChJU19FUlIocnEpKQotCQlyZXR1cm4gUFRSX0VSUihycSk7Ci0KLQljcyA9IGludGVsX3Jpbmdf
YmVnaW4ocnEsIDQpOwotCWlmIChJU19FUlIoY3MpKSB7Ci0JCWk5MTVfcmVxdWVzdF9hZGQocnEp
OwotCQlyZXR1cm4gUFRSX0VSUihjcyk7Ci0JfQotCi0JKmNzKysgPSBNSV9TVE9SRV9EV09SRF9J
TU1fR0VONCB8IE1JX1VTRV9HR1RUOwotCSpjcysrID0gb2Zmc2V0OwotCSpjcysrID0gMDsKLQkq
Y3MrKyA9IDE7Ci0KLQlpbnRlbF9yaW5nX2FkdmFuY2UocnEsIGNzKTsKLQotCXJxLT5zY2hlZC5h
dHRyLnByaW9yaXR5ID0gSTkxNV9QUklPUklUWV9CQVJSSUVSOwotCWk5MTVfcmVxdWVzdF9hZGQo
cnEpOwotCXJldHVybiAwOwotfQotCi1zdGF0aWMgaW50IGNvbnRleHRfZmx1c2goc3RydWN0IGlu
dGVsX2NvbnRleHQgKmNlLCBsb25nIHRpbWVvdXQpCi17Ci0Jc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnE7Ci0Jc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7Ci0JaW50IGVyciA9IDA7Ci0KLQlycSA9IGlu
dGVsX2VuZ2luZV9jcmVhdGVfa2VybmVsX3JlcXVlc3QoY2UtPmVuZ2luZSk7Ci0JaWYgKElTX0VS
UihycSkpCi0JCXJldHVybiBQVFJfRVJSKHJxKTsKLQotCWZlbmNlID0gaTkxNV9hY3RpdmVfZmVu
Y2VfZ2V0KCZjZS0+dGltZWxpbmUtPmxhc3RfcmVxdWVzdCk7Ci0JaWYgKGZlbmNlKSB7Ci0JCWk5
MTVfcmVxdWVzdF9hd2FpdF9kbWFfZmVuY2UocnEsIGZlbmNlKTsKLQkJZG1hX2ZlbmNlX3B1dChm
ZW5jZSk7Ci0JfQotCi0JcnEgPSBpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKLQlpOTE1X3JlcXVlc3Rf
YWRkKHJxKTsKLQlpZiAoaTkxNV9yZXF1ZXN0X3dhaXQocnEsIDAsIHRpbWVvdXQpIDwgMCkKLQkJ
ZXJyID0gLUVUSU1FOwotCWk5MTVfcmVxdWVzdF9wdXQocnEpOwotCi0Jcm1iKCk7IC8qIFdlIGtu
b3cgdGhlIHJlcXVlc3QgaXMgd3JpdHRlbiwgbWFrZSBzdXJlIGFsbCBzdGF0ZSBpcyB0b28hICov
Ci0JcmV0dXJuIGVycjsKLX0KLQotc3RhdGljIGludCBsaXZlX2xyY19sYXlvdXQodm9pZCAqYXJn
KQotewotCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7Ci0Jc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lOwotCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwotCXUzMiAqbHJjOwotCWludCBl
cnI7Ci0KLQkvKgotCSAqIENoZWNrIHRoZSByZWdpc3RlcnMgb2Zmc2V0cyB3ZSB1c2UgdG8gY3Jl
YXRlIHRoZSBpbml0aWFsIHJlZyBzdGF0ZQotCSAqIG1hdGNoIHRoZSBsYXlvdXQgc2F2ZWQgYnkg
SFcuCi0JICovCi0KLQlscmMgPSBrbWFsbG9jKFBBR0VfU0laRSwgR0ZQX0tFUk5FTCk7Ci0JaWYg
KCFscmMpCi0JCXJldHVybiAtRU5PTUVNOwotCi0JZXJyID0gMDsKLQlmb3JfZWFjaF9lbmdpbmUo
ZW5naW5lLCBndCwgaWQpIHsKLQkJdTMyICpodzsKLQkJaW50IGR3OwotCi0JCWlmICghZW5naW5l
LT5kZWZhdWx0X3N0YXRlKQotCQkJY29udGludWU7Ci0KLQkJaHcgPSBzaG1lbV9waW5fbWFwKGVu
Z2luZS0+ZGVmYXVsdF9zdGF0ZSk7Ci0JCWlmIChJU19FUlIoaHcpKSB7Ci0JCQllcnIgPSBQVFJf
RVJSKGh3KTsKLQkJCWJyZWFrOwotCQl9Ci0JCWh3ICs9IExSQ19TVEFURV9PRkZTRVQgLyBzaXpl
b2YoKmh3KTsKLQotCQlleGVjbGlzdHNfaW5pdF9yZWdfc3RhdGUobWVtc2V0KGxyYywgUE9JU09O
X0lOVVNFLCBQQUdFX1NJWkUpLAotCQkJCQkgZW5naW5lLT5rZXJuZWxfY29udGV4dCwKLQkJCQkJ
IGVuZ2luZSwKLQkJCQkJIGVuZ2luZS0+a2VybmVsX2NvbnRleHQtPnJpbmcsCi0JCQkJCSB0cnVl
KTsKLQotCQlkdyA9IDA7Ci0JCWRvIHsKLQkJCXUzMiBscmkgPSBod1tkd107Ci0KLQkJCWlmIChs
cmkgPT0gMCkgewotCQkJCWR3Kys7Ci0JCQkJY29udGludWU7Ci0JCQl9Ci0KLQkJCWlmIChscmNb
ZHddID09IDApIHsKLQkJCQlwcl9kZWJ1ZygiJXM6IHNraXBwZWQgaW5zdHJ1Y3Rpb24gJXggYXQg
ZHdvcmQgJWRcbiIsCi0JCQkJCSBlbmdpbmUtPm5hbWUsIGxyaSwgZHcpOwotCQkJCWR3Kys7Ci0J
CQkJY29udGludWU7Ci0JCQl9Ci0KLQkJCWlmICgobHJpICYgR0VOTUFTSygzMSwgMjMpKSAhPSBN
SV9JTlNUUigweDIyLCAwKSkgewotCQkJCXByX2VycigiJXM6IEV4cGVjdGVkIExSSSBjb21tYW5k
IGF0IGR3b3JkICVkLCBmb3VuZCAlMDh4XG4iLAotCQkJCSAgICAgICBlbmdpbmUtPm5hbWUsIGR3
LCBscmkpOwotCQkJCWVyciA9IC1FSU5WQUw7Ci0JCQkJYnJlYWs7Ci0JCQl9Ci0KLQkJCWlmIChs
cmNbZHddICE9IGxyaSkgewotCQkJCXByX2VycigiJXM6IExSSSBjb21tYW5kIG1pc21hdGNoIGF0
IGR3b3JkICVkLCBleHBlY3RlZCAlMDh4IGZvdW5kICUwOHhcbiIsCi0JCQkJICAgICAgIGVuZ2lu
ZS0+bmFtZSwgZHcsIGxyaSwgbHJjW2R3XSk7Ci0JCQkJZXJyID0gLUVJTlZBTDsKLQkJCQlicmVh
azsKLQkJCX0KLQotCQkJbHJpICY9IDB4N2Y7Ci0JCQlscmkrKzsKLQkJCWR3Kys7Ci0KLQkJCXdo
aWxlIChscmkpIHsKLQkJCQlpZiAoaHdbZHddICE9IGxyY1tkd10pIHsKLQkJCQkJcHJfZXJyKCIl
czogRGlmZmVyZW50IHJlZ2lzdGVycyBmb3VuZCBhdCBkd29yZCAlZCwgZXhwZWN0ZWQgJXgsIGZv
dW5kICV4XG4iLAotCQkJCQkgICAgICAgZW5naW5lLT5uYW1lLCBkdywgaHdbZHddLCBscmNbZHdd
KTsKLQkJCQkJZXJyID0gLUVJTlZBTDsKLQkJCQkJYnJlYWs7Ci0JCQkJfQotCi0JCQkJLyoKLQkJ
CQkgKiBTa2lwIG92ZXIgdGhlIGFjdHVhbCByZWdpc3RlciB2YWx1ZSBhcyB3ZQotCQkJCSAqIGV4
cGVjdCB0aGF0IHRvIGRpZmZlci4KLQkJCQkgKi8KLQkJCQlkdyArPSAyOwotCQkJCWxyaSAtPSAy
OwotCQkJfQotCQl9IHdoaWxlICgobHJjW2R3XSAmIH5CSVQoMCkpICE9IE1JX0JBVENIX0JVRkZF
Ul9FTkQpOwotCi0JCWlmIChlcnIpIHsKLQkJCXByX2luZm8oIiVzOiBIVyByZWdpc3RlciBpbWFn
ZTpcbiIsIGVuZ2luZS0+bmFtZSk7Ci0JCQlpZ3RfaGV4ZHVtcChodywgUEFHRV9TSVpFKTsKLQot
CQkJcHJfaW5mbygiJXM6IFNXIHJlZ2lzdGVyIGltYWdlOlxuIiwgZW5naW5lLT5uYW1lKTsKLQkJ
CWlndF9oZXhkdW1wKGxyYywgUEFHRV9TSVpFKTsKLQkJfQotCi0JCXNobWVtX3VucGluX21hcChl
bmdpbmUtPmRlZmF1bHRfc3RhdGUsIGh3KTsKLQkJaWYgKGVycikKLQkJCWJyZWFrOwotCX0KLQot
CWtmcmVlKGxyYyk7Ci0JcmV0dXJuIGVycjsKLX0KLQotc3RhdGljIGludCBmaW5kX29mZnNldChj
b25zdCB1MzIgKmxyaSwgdTMyIG9mZnNldCkKLXsKLQlpbnQgaTsKLQotCWZvciAoaSA9IDA7IGkg
PCBQQUdFX1NJWkUgLyBzaXplb2YodTMyKTsgaSsrKQotCQlpZiAobHJpW2ldID09IG9mZnNldCkK
LQkJCXJldHVybiBpOwotCi0JcmV0dXJuIC0xOwotfQotCi1zdGF0aWMgaW50IGxpdmVfbHJjX2Zp
eGVkKHZvaWQgKmFyZykKLXsKLQlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwotCXN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKLQlpbnQg
ZXJyID0gMDsKLQotCS8qCi0JICogQ2hlY2sgdGhlIGFzc3VtZWQgcmVnaXN0ZXIgb2Zmc2V0cyBt
YXRjaCB0aGUgYWN0dWFsIGxvY2F0aW9ucyBpbgotCSAqIHRoZSBjb250ZXh0IGltYWdlLgotCSAq
LwotCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7Ci0JCWNvbnN0IHN0cnVjdCB7
Ci0JCQl1MzIgcmVnOwotCQkJdTMyIG9mZnNldDsKLQkJCWNvbnN0IGNoYXIgKm5hbWU7Ci0JCX0g
dGJsW10gPSB7Ci0JCQl7Ci0JCQkJaTkxNV9tbWlvX3JlZ19vZmZzZXQoUklOR19TVEFSVChlbmdp
bmUtPm1taW9fYmFzZSkpLAotCQkJCUNUWF9SSU5HX1NUQVJUIC0gMSwKLQkJCQkiUklOR19TVEFS
VCIKLQkJCX0sCi0JCQl7Ci0JCQkJaTkxNV9tbWlvX3JlZ19vZmZzZXQoUklOR19DVEwoZW5naW5l
LT5tbWlvX2Jhc2UpKSwKLQkJCQlDVFhfUklOR19DVEwgLSAxLAotCQkJCSJSSU5HX0NUTCIKLQkJ
CX0sCi0JCQl7Ci0JCQkJaTkxNV9tbWlvX3JlZ19vZmZzZXQoUklOR19IRUFEKGVuZ2luZS0+bW1p
b19iYXNlKSksCi0JCQkJQ1RYX1JJTkdfSEVBRCAtIDEsCi0JCQkJIlJJTkdfSEVBRCIKLQkJCX0s
Ci0JCQl7Ci0JCQkJaTkxNV9tbWlvX3JlZ19vZmZzZXQoUklOR19UQUlMKGVuZ2luZS0+bW1pb19i
YXNlKSksCi0JCQkJQ1RYX1JJTkdfVEFJTCAtIDEsCi0JCQkJIlJJTkdfVEFJTCIKLQkJCX0sCi0J
CQl7Ci0JCQkJaTkxNV9tbWlvX3JlZ19vZmZzZXQoUklOR19NSV9NT0RFKGVuZ2luZS0+bW1pb19i
YXNlKSksCi0JCQkJbHJjX3JpbmdfbWlfbW9kZShlbmdpbmUpLAotCQkJCSJSSU5HX01JX01PREUi
Ci0JCQl9LAotCQkJewotCQkJCWk5MTVfbW1pb19yZWdfb2Zmc2V0KFJJTkdfQkJTVEFURShlbmdp
bmUtPm1taW9fYmFzZSkpLAotCQkJCUNUWF9CQl9TVEFURSAtIDEsCi0JCQkJIkJCX1NUQVRFIgot
CQkJfSwKLQkJCXsKLQkJCQlpOTE1X21taW9fcmVnX29mZnNldChSSU5HX0JCX1BFUl9DVFhfUFRS
KGVuZ2luZS0+bW1pb19iYXNlKSksCi0JCQkJbHJjX3Jpbmdfd2FfYmJfcGVyX2N0eChlbmdpbmUp
LAotCQkJCSJSSU5HX0JCX1BFUl9DVFhfUFRSIgotCQkJfSwKLQkJCXsKLQkJCQlpOTE1X21taW9f
cmVnX29mZnNldChSSU5HX0lORElSRUNUX0NUWChlbmdpbmUtPm1taW9fYmFzZSkpLAotCQkJCWxy
Y19yaW5nX2luZGlyZWN0X3B0cihlbmdpbmUpLAotCQkJCSJSSU5HX0lORElSRUNUX0NUWF9QVFIi
Ci0JCQl9LAotCQkJewotCQkJCWk5MTVfbW1pb19yZWdfb2Zmc2V0KFJJTkdfSU5ESVJFQ1RfQ1RY
X09GRlNFVChlbmdpbmUtPm1taW9fYmFzZSkpLAotCQkJCWxyY19yaW5nX2luZGlyZWN0X29mZnNl
dChlbmdpbmUpLAotCQkJCSJSSU5HX0lORElSRUNUX0NUWF9PRkZTRVQiCi0JCQl9LAotCQkJewot
CQkJCWk5MTVfbW1pb19yZWdfb2Zmc2V0KFJJTkdfQ1RYX1RJTUVTVEFNUChlbmdpbmUtPm1taW9f
YmFzZSkpLAotCQkJCUNUWF9USU1FU1RBTVAgLSAxLAotCQkJCSJSSU5HX0NUWF9USU1FU1RBTVAi
Ci0JCQl9LAotCQkJewotCQkJCWk5MTVfbW1pb19yZWdfb2Zmc2V0KEdFTjhfUklOR19DU19HUFIo
ZW5naW5lLT5tbWlvX2Jhc2UsIDApKSwKLQkJCQlscmNfcmluZ19ncHIwKGVuZ2luZSksCi0JCQkJ
IlJJTkdfQ1NfR1BSMCIKLQkJCX0sCi0JCQl7Ci0JCQkJaTkxNV9tbWlvX3JlZ19vZmZzZXQoUklO
R19DTURfQlVGX0NDVEwoZW5naW5lLT5tbWlvX2Jhc2UpKSwKLQkJCQlscmNfcmluZ19jbWRfYnVm
X2NjdGwoZW5naW5lKSwKLQkJCQkiUklOR19DTURfQlVGX0NDVEwiCi0JCQl9LAotCQkJeyB9LAot
CQl9LCAqdDsKLQkJdTMyICpodzsKLQotCQlpZiAoIWVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSkKLQkJ
CWNvbnRpbnVlOwotCi0JCWh3ID0gc2htZW1fcGluX21hcChlbmdpbmUtPmRlZmF1bHRfc3RhdGUp
OwotCQlpZiAoSVNfRVJSKGh3KSkgewotCQkJZXJyID0gUFRSX0VSUihodyk7Ci0JCQlicmVhazsK
LQkJfQotCQlodyArPSBMUkNfU1RBVEVfT0ZGU0VUIC8gc2l6ZW9mKCpodyk7Ci0KLQkJZm9yICh0
ID0gdGJsOyB0LT5uYW1lOyB0KyspIHsKLQkJCWludCBkdyA9IGZpbmRfb2Zmc2V0KGh3LCB0LT5y
ZWcpOwotCi0JCQlpZiAoZHcgIT0gdC0+b2Zmc2V0KSB7Ci0JCQkJcHJfZXJyKCIlczogT2Zmc2V0
IGZvciAlcyBbMHgleF0gbWlzbWF0Y2gsIGZvdW5kICV4LCBleHBlY3RlZCAleFxuIiwKLQkJCQkg
ICAgICAgZW5naW5lLT5uYW1lLAotCQkJCSAgICAgICB0LT5uYW1lLAotCQkJCSAgICAgICB0LT5y
ZWcsCi0JCQkJICAgICAgIGR3LAotCQkJCSAgICAgICB0LT5vZmZzZXQpOwotCQkJCWVyciA9IC1F
SU5WQUw7Ci0JCQl9Ci0JCX0KLQotCQlzaG1lbV91bnBpbl9tYXAoZW5naW5lLT5kZWZhdWx0X3N0
YXRlLCBodyk7Ci0JfQotCi0JcmV0dXJuIGVycjsKLX0KLQotc3RhdGljIGludCBfX2xpdmVfbHJj
X3N0YXRlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKLQkJCSAgICBzdHJ1Y3QgaTkx
NV92bWEgKnNjcmF0Y2gpCi17Ci0Jc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwotCXN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxOwotCXN0cnVjdCBpOTE1X2dlbV93d19jdHggd3c7Ci0JZW51bSB7Ci0J
CVJJTkdfU1RBUlRfSURYID0gMCwKLQkJUklOR19UQUlMX0lEWCwKLQkJTUFYX0lEWAotCX07Ci0J
dTMyIGV4cGVjdGVkW01BWF9JRFhdOwotCXUzMiAqY3M7Ci0JaW50IGVycjsKLQlpbnQgbjsKLQot
CWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKLQlpZiAoSVNfRVJSKGNlKSkKLQkJ
cmV0dXJuIFBUUl9FUlIoY2UpOwotCi0JaTkxNV9nZW1fd3dfY3R4X2luaXQoJnd3LCBmYWxzZSk7
Ci1yZXRyeToKLQllcnIgPSBpOTE1X2dlbV9vYmplY3RfbG9jayhzY3JhdGNoLT5vYmosICZ3dyk7
Ci0JaWYgKCFlcnIpCi0JCWVyciA9IGludGVsX2NvbnRleHRfcGluX3d3KGNlLCAmd3cpOwotCWlm
IChlcnIpCi0JCWdvdG8gZXJyX3B1dDsKLQotCXJxID0gaTkxNV9yZXF1ZXN0X2NyZWF0ZShjZSk7
Ci0JaWYgKElTX0VSUihycSkpIHsKLQkJZXJyID0gUFRSX0VSUihycSk7Ci0JCWdvdG8gZXJyX3Vu
cGluOwotCX0KLQotCWNzID0gaW50ZWxfcmluZ19iZWdpbihycSwgNCAqIE1BWF9JRFgpOwotCWlm
IChJU19FUlIoY3MpKSB7Ci0JCWVyciA9IFBUUl9FUlIoY3MpOwotCQlpOTE1X3JlcXVlc3RfYWRk
KHJxKTsKLQkJZ290byBlcnJfdW5waW47Ci0JfQotCi0JKmNzKysgPSBNSV9TVE9SRV9SRUdJU1RF
Ul9NRU1fR0VOOCB8IE1JX1VTRV9HR1RUOwotCSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQo
UklOR19TVEFSVChlbmdpbmUtPm1taW9fYmFzZSkpOwotCSpjcysrID0gaTkxNV9nZ3R0X29mZnNl
dChzY3JhdGNoKSArIFJJTkdfU1RBUlRfSURYICogc2l6ZW9mKHUzMik7Ci0JKmNzKysgPSAwOwot
Ci0JZXhwZWN0ZWRbUklOR19TVEFSVF9JRFhdID0gaTkxNV9nZ3R0X29mZnNldChjZS0+cmluZy0+
dm1hKTsKLQotCSpjcysrID0gTUlfU1RPUkVfUkVHSVNURVJfTUVNX0dFTjggfCBNSV9VU0VfR0dU
VDsKLQkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KFJJTkdfVEFJTChlbmdpbmUtPm1taW9f
YmFzZSkpOwotCSpjcysrID0gaTkxNV9nZ3R0X29mZnNldChzY3JhdGNoKSArIFJJTkdfVEFJTF9J
RFggKiBzaXplb2YodTMyKTsKLQkqY3MrKyA9IDA7Ci0KLQllcnIgPSBpOTE1X3JlcXVlc3RfYXdh
aXRfb2JqZWN0KHJxLCBzY3JhdGNoLT5vYmosIHRydWUpOwotCWlmICghZXJyKQotCQllcnIgPSBp
OTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShzY3JhdGNoLCBycSwgRVhFQ19PQkpFQ1RfV1JJVEUpOwot
Ci0JaTkxNV9yZXF1ZXN0X2dldChycSk7Ci0JaTkxNV9yZXF1ZXN0X2FkZChycSk7Ci0JaWYgKGVy
cikKLQkJZ290byBlcnJfcnE7Ci0KLQlpbnRlbF9lbmdpbmVfZmx1c2hfc3VibWlzc2lvbihlbmdp
bmUpOwotCWV4cGVjdGVkW1JJTkdfVEFJTF9JRFhdID0gY2UtPnJpbmctPnRhaWw7Ci0KLQlpZiAo
aTkxNV9yZXF1ZXN0X3dhaXQocnEsIDAsIEhaIC8gNSkgPCAwKSB7Ci0JCWVyciA9IC1FVElNRTsK
LQkJZ290byBlcnJfcnE7Ci0JfQotCi0JY3MgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChzY3Jh
dGNoLT5vYmosIEk5MTVfTUFQX1dCKTsKLQlpZiAoSVNfRVJSKGNzKSkgewotCQllcnIgPSBQVFJf
RVJSKGNzKTsKLQkJZ290byBlcnJfcnE7Ci0JfQotCi0JZm9yIChuID0gMDsgbiA8IE1BWF9JRFg7
IG4rKykgewotCQlpZiAoY3Nbbl0gIT0gZXhwZWN0ZWRbbl0pIHsKLQkJCXByX2VycigiJXM6IFN0
b3JlZCByZWdpc3RlclslZF0gdmFsdWVbMHgleF0gZGlkIG5vdCBtYXRjaCBleHBlY3RlZFsweCV4
XVxuIiwKLQkJCSAgICAgICBlbmdpbmUtPm5hbWUsIG4sIGNzW25dLCBleHBlY3RlZFtuXSk7Ci0J
CQllcnIgPSAtRUlOVkFMOwotCQkJYnJlYWs7Ci0JCX0KLQl9Ci0KLQlpOTE1X2dlbV9vYmplY3Rf
dW5waW5fbWFwKHNjcmF0Y2gtPm9iaik7Ci0KLWVycl9ycToKLQlpOTE1X3JlcXVlc3RfcHV0KHJx
KTsKLWVycl91bnBpbjoKLQlpbnRlbF9jb250ZXh0X3VucGluKGNlKTsKLWVycl9wdXQ6Ci0JaWYg
KGVyciA9PSAtRURFQURMSykgewotCQllcnIgPSBpOTE1X2dlbV93d19jdHhfYmFja29mZigmd3cp
OwotCQlpZiAoIWVycikKLQkJCWdvdG8gcmV0cnk7Ci0JfQotCWk5MTVfZ2VtX3d3X2N0eF9maW5p
KCZ3dyk7Ci0JaW50ZWxfY29udGV4dF9wdXQoY2UpOwotCXJldHVybiBlcnI7Ci19Ci0KLXN0YXRp
YyBpbnQgbGl2ZV9scmNfc3RhdGUodm9pZCAqYXJnKQotewotCXN0cnVjdCBpbnRlbF9ndCAqZ3Qg
PSBhcmc7Ci0Jc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCXN0cnVjdCBpOTE1X3Zt
YSAqc2NyYXRjaDsKLQllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKLQlpbnQgZXJyID0gMDsKLQot
CS8qCi0JICogQ2hlY2sgdGhlIGxpdmUgcmVnaXN0ZXIgc3RhdGUgbWF0Y2hlcyB3aGF0IHdlIGV4
cGVjdCBmb3IgdGhpcwotCSAqIGludGVsX2NvbnRleHQuCi0JICovCi0KLQlzY3JhdGNoID0gY3Jl
YXRlX3NjcmF0Y2goZ3QpOwotCWlmIChJU19FUlIoc2NyYXRjaCkpCi0JCXJldHVybiBQVFJfRVJS
KHNjcmF0Y2gpOwotCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7Ci0JCWVyciA9
IF9fbGl2ZV9scmNfc3RhdGUoZW5naW5lLCBzY3JhdGNoKTsKLQkJaWYgKGVycikKLQkJCWJyZWFr
OwotCX0KLQotCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpCi0JCWVyciA9IC1FSU87Ci0K
LQlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmc2NyYXRjaCwgMCk7Ci0JcmV0dXJuIGVycjsK
LX0KLQotc3RhdGljIGludCBncHJfbWFrZV9kaXJ0eShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2Up
Ci17Ci0Jc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7Ci0JdTMyICpjczsKLQlpbnQgbjsKLQotCXJx
ID0gaW50ZWxfY29udGV4dF9jcmVhdGVfcmVxdWVzdChjZSk7Ci0JaWYgKElTX0VSUihycSkpCi0J
CXJldHVybiBQVFJfRVJSKHJxKTsKLQotCWNzID0gaW50ZWxfcmluZ19iZWdpbihycSwgMiAqIE5V
TV9HUFJfRFcgKyAyKTsKLQlpZiAoSVNfRVJSKGNzKSkgewotCQlpOTE1X3JlcXVlc3RfYWRkKHJx
KTsKLQkJcmV0dXJuIFBUUl9FUlIoY3MpOwotCX0KLQotCSpjcysrID0gTUlfTE9BRF9SRUdJU1RF
Ul9JTU0oTlVNX0dQUl9EVyk7Ci0JZm9yIChuID0gMDsgbiA8IE5VTV9HUFJfRFc7IG4rKykgewot
CQkqY3MrKyA9IENTX0dQUihjZS0+ZW5naW5lLCBuKTsKLQkJKmNzKysgPSBTVEFDS19NQUdJQzsK
LQl9Ci0JKmNzKysgPSBNSV9OT09QOwotCi0JaW50ZWxfcmluZ19hZHZhbmNlKHJxLCBjcyk7Ci0K
LQlycS0+c2NoZWQuYXR0ci5wcmlvcml0eSA9IEk5MTVfUFJJT1JJVFlfQkFSUklFUjsKLQlpOTE1
X3JlcXVlc3RfYWRkKHJxKTsKLQotCXJldHVybiAwOwotfQotCi1zdGF0aWMgc3RydWN0IGk5MTVf
cmVxdWVzdCAqCi1fX2dwcl9yZWFkKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgc3RydWN0IGk5
MTVfdm1hICpzY3JhdGNoLCB1MzIgKnNsb3QpCi17Ci0JY29uc3QgdTMyIG9mZnNldCA9Ci0JCWk5
MTVfZ2d0dF9vZmZzZXQoY2UtPmVuZ2luZS0+c3RhdHVzX3BhZ2Uudm1hKSArCi0JCW9mZnNldF9p
bl9wYWdlKHNsb3QpOwotCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwotCXUzMiAqY3M7Ci0JaW50
IGVycjsKLQlpbnQgbjsKLQotCXJxID0gaW50ZWxfY29udGV4dF9jcmVhdGVfcmVxdWVzdChjZSk7
Ci0JaWYgKElTX0VSUihycSkpCi0JCXJldHVybiBycTsKLQotCWNzID0gaW50ZWxfcmluZ19iZWdp
bihycSwgNiArIDQgKiBOVU1fR1BSX0RXKTsKLQlpZiAoSVNfRVJSKGNzKSkgewotCQlpOTE1X3Jl
cXVlc3RfYWRkKHJxKTsKLQkJcmV0dXJuIEVSUl9DQVNUKGNzKTsKLQl9Ci0KLQkqY3MrKyA9IE1J
X0FSQl9PTl9PRkYgfCBNSV9BUkJfRU5BQkxFOwotCSpjcysrID0gTUlfTk9PUDsKLQotCSpjcysr
ID0gTUlfU0VNQVBIT1JFX1dBSVQgfAotCQlNSV9TRU1BUEhPUkVfR0xPQkFMX0dUVCB8Ci0JCU1J
X1NFTUFQSE9SRV9QT0xMIHwKLQkJTUlfU0VNQVBIT1JFX1NBRF9ORVFfU0REOwotCSpjcysrID0g
MDsKLQkqY3MrKyA9IG9mZnNldDsKLQkqY3MrKyA9IDA7Ci0KLQlmb3IgKG4gPSAwOyBuIDwgTlVN
X0dQUl9EVzsgbisrKSB7Ci0JCSpjcysrID0gTUlfU1RPUkVfUkVHSVNURVJfTUVNX0dFTjggfCBN
SV9VU0VfR0dUVDsKLQkJKmNzKysgPSBDU19HUFIoY2UtPmVuZ2luZSwgbik7Ci0JCSpjcysrID0g
aTkxNV9nZ3R0X29mZnNldChzY3JhdGNoKSArIG4gKiBzaXplb2YodTMyKTsKLQkJKmNzKysgPSAw
OwotCX0KLQotCWk5MTVfdm1hX2xvY2soc2NyYXRjaCk7Ci0JZXJyID0gaTkxNV9yZXF1ZXN0X2F3
YWl0X29iamVjdChycSwgc2NyYXRjaC0+b2JqLCB0cnVlKTsKLQlpZiAoIWVycikKLQkJZXJyID0g
aTkxNV92bWFfbW92ZV90b19hY3RpdmUoc2NyYXRjaCwgcnEsIEVYRUNfT0JKRUNUX1dSSVRFKTsK
LQlpOTE1X3ZtYV91bmxvY2soc2NyYXRjaCk7Ci0KLQlpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKLQlp
OTE1X3JlcXVlc3RfYWRkKHJxKTsKLQlpZiAoZXJyKSB7Ci0JCWk5MTVfcmVxdWVzdF9wdXQocnEp
OwotCQlycSA9IEVSUl9QVFIoZXJyKTsKLQl9Ci0KLQlyZXR1cm4gcnE7Ci19Ci0KLXN0YXRpYyBp
bnQgX19saXZlX2xyY19ncHIoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAotCQkJICBz
dHJ1Y3QgaTkxNV92bWEgKnNjcmF0Y2gsCi0JCQkgIGJvb2wgcHJlZW1wdCkKLXsKLQl1MzIgKnNs
b3QgPSBtZW1zZXQzMihlbmdpbmUtPnN0YXR1c19wYWdlLmFkZHIgKyAxMDAwLCAwLCA0KTsKLQlz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7Ci0Jc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7Ci0JdTMy
ICpjczsKLQlpbnQgZXJyOwotCWludCBuOwotCi0JaWYgKElOVEVMX0dFTihlbmdpbmUtPmk5MTUp
IDwgOSAmJiBlbmdpbmUtPmNsYXNzICE9IFJFTkRFUl9DTEFTUykKLQkJcmV0dXJuIDA7IC8qIEdQ
UiBvbmx5IG9uIHJjczAgZm9yIGdlbjggKi8KLQotCWVyciA9IGdwcl9tYWtlX2RpcnR5KGVuZ2lu
ZS0+a2VybmVsX2NvbnRleHQpOwotCWlmIChlcnIpCi0JCXJldHVybiBlcnI7Ci0KLQljZSA9IGlu
dGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7Ci0JaWYgKElTX0VSUihjZSkpCi0JCXJldHVybiBQ
VFJfRVJSKGNlKTsKLQotCXJxID0gX19ncHJfcmVhZChjZSwgc2NyYXRjaCwgc2xvdCk7Ci0JaWYg
KElTX0VSUihycSkpIHsKLQkJZXJyID0gUFRSX0VSUihycSk7Ci0JCWdvdG8gZXJyX3B1dDsKLQl9
Ci0KLQllcnIgPSB3YWl0X2Zvcl9zdWJtaXQoZW5naW5lLCBycSwgSFogLyAyKTsKLQlpZiAoZXJy
KQotCQlnb3RvIGVycl9ycTsKLQotCWlmIChwcmVlbXB0KSB7Ci0JCWVyciA9IGdwcl9tYWtlX2Rp
cnR5KGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOwotCQlpZiAoZXJyKQotCQkJZ290byBlcnJfcnE7
Ci0KLQkJZXJyID0gZW1pdF9zZW1hcGhvcmVfc2lnbmFsKGVuZ2luZS0+a2VybmVsX2NvbnRleHQs
IHNsb3QpOwotCQlpZiAoZXJyKQotCQkJZ290byBlcnJfcnE7Ci0JfSBlbHNlIHsKLQkJc2xvdFsw
XSA9IDE7Ci0JCXdtYigpOwotCX0KLQotCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChycSwgMCwgSFog
LyA1KSA8IDApIHsKLQkJZXJyID0gLUVUSU1FOwotCQlnb3RvIGVycl9ycTsKLQl9Ci0KLQljcyA9
IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKHNjcmF0Y2gtPm9iaiwgSTkxNV9NQVBfV0IpOwotCWlm
IChJU19FUlIoY3MpKSB7Ci0JCWVyciA9IFBUUl9FUlIoY3MpOwotCQlnb3RvIGVycl9ycTsKLQl9
Ci0KLQlmb3IgKG4gPSAwOyBuIDwgTlVNX0dQUl9EVzsgbisrKSB7Ci0JCWlmIChjc1tuXSkgewot
CQkJcHJfZXJyKCIlczogR1BSWyVkXS4lcyB3YXMgbm90IHplcm8sIGZvdW5kIDB4JTA4eCFcbiIs
Ci0JCQkgICAgICAgZW5naW5lLT5uYW1lLAotCQkJICAgICAgIG4gLyAyLCBuICYgMSA/ICJ1ZHci
IDogImxkdyIsCi0JCQkgICAgICAgY3Nbbl0pOwotCQkJZXJyID0gLUVJTlZBTDsKLQkJCWJyZWFr
OwotCQl9Ci0JfQotCi0JaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChzY3JhdGNoLT5vYmopOwot
Ci1lcnJfcnE6Ci0JbWVtc2V0MzIoJnNsb3RbMF0sIC0xLCA0KTsKLQl3bWIoKTsKLQlpOTE1X3Jl
cXVlc3RfcHV0KHJxKTsKLWVycl9wdXQ6Ci0JaW50ZWxfY29udGV4dF9wdXQoY2UpOwotCXJldHVy
biBlcnI7Ci19Ci0KLXN0YXRpYyBpbnQgbGl2ZV9scmNfZ3ByKHZvaWQgKmFyZykKLXsKLQlzdHJ1
Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwotCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsK
LQlzdHJ1Y3QgaTkxNV92bWEgKnNjcmF0Y2g7Ci0JZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7Ci0J
aW50IGVyciA9IDA7Ci0KLQkvKgotCSAqIENoZWNrIHRoYXQgR1BSIHJlZ2lzdGVycyBhcmUgY2xl
YXJlZCBpbiBuZXcgY29udGV4dHMgYXMgd2UgbmVlZAotCSAqIHRvIGF2b2lkIGxlYWtpbmcgYW55
IGluZm9ybWF0aW9uIGZyb20gcHJldmlvdXMgY29udGV4dHMuCi0JICovCi0KLQlzY3JhdGNoID0g
Y3JlYXRlX3NjcmF0Y2goZ3QpOwotCWlmIChJU19FUlIoc2NyYXRjaCkpCi0JCXJldHVybiBQVFJf
RVJSKHNjcmF0Y2gpOwotCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7Ci0JCXN0
X2VuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUpOwotCi0JCWVyciA9IF9fbGl2ZV9scmNf
Z3ByKGVuZ2luZSwgc2NyYXRjaCwgZmFsc2UpOwotCQlpZiAoZXJyKQotCQkJZ290byBlcnI7Ci0K
LQkJZXJyID0gX19saXZlX2xyY19ncHIoZW5naW5lLCBzY3JhdGNoLCB0cnVlKTsKLQkJaWYgKGVy
cikKLQkJCWdvdG8gZXJyOwotCi1lcnI6Ci0JCXN0X2VuZ2luZV9oZWFydGJlYXRfZW5hYmxlKGVu
Z2luZSk7Ci0JCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpCi0JCQllcnIgPSAtRUlPOwot
CQlpZiAoZXJyKQotCQkJYnJlYWs7Ci0JfQotCi0JaTkxNV92bWFfdW5waW5fYW5kX3JlbGVhc2Uo
JnNjcmF0Y2gsIDApOwotCXJldHVybiBlcnI7Ci19Ci0KLXN0YXRpYyBzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICoKLWNyZWF0ZV90aW1lc3RhbXAoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCB2b2lkICpz
bG90LCBpbnQgaWR4KQotewotCWNvbnN0IHUzMiBvZmZzZXQgPQotCQlpOTE1X2dndHRfb2Zmc2V0
KGNlLT5lbmdpbmUtPnN0YXR1c19wYWdlLnZtYSkgKwotCQlvZmZzZXRfaW5fcGFnZShzbG90KTsK
LQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKLQl1MzIgKmNzOwotCWludCBlcnI7Ci0KLQlycSA9
IGludGVsX2NvbnRleHRfY3JlYXRlX3JlcXVlc3QoY2UpOwotCWlmIChJU19FUlIocnEpKQotCQly
ZXR1cm4gcnE7Ci0KLQljcyA9IGludGVsX3JpbmdfYmVnaW4ocnEsIDEwKTsKLQlpZiAoSVNfRVJS
KGNzKSkgewotCQllcnIgPSBQVFJfRVJSKGNzKTsKLQkJZ290byBlcnI7Ci0JfQotCi0JKmNzKysg
PSBNSV9BUkJfT05fT0ZGIHwgTUlfQVJCX0VOQUJMRTsKLQkqY3MrKyA9IE1JX05PT1A7Ci0KLQkq
Y3MrKyA9IE1JX1NFTUFQSE9SRV9XQUlUIHwKLQkJTUlfU0VNQVBIT1JFX0dMT0JBTF9HVFQgfAot
CQlNSV9TRU1BUEhPUkVfUE9MTCB8Ci0JCU1JX1NFTUFQSE9SRV9TQURfTkVRX1NERDsKLQkqY3Mr
KyA9IDA7Ci0JKmNzKysgPSBvZmZzZXQ7Ci0JKmNzKysgPSAwOwotCi0JKmNzKysgPSBNSV9TVE9S
RV9SRUdJU1RFUl9NRU1fR0VOOCB8IE1JX1VTRV9HR1RUOwotCSpjcysrID0gaTkxNV9tbWlvX3Jl
Z19vZmZzZXQoUklOR19DVFhfVElNRVNUQU1QKHJxLT5lbmdpbmUtPm1taW9fYmFzZSkpOwotCSpj
cysrID0gb2Zmc2V0ICsgaWR4ICogc2l6ZW9mKHUzMik7Ci0JKmNzKysgPSAwOwotCi0JaW50ZWxf
cmluZ19hZHZhbmNlKHJxLCBjcyk7Ci0KLQlycS0+c2NoZWQuYXR0ci5wcmlvcml0eSA9IEk5MTVf
UFJJT1JJVFlfTUFTSzsKLQllcnIgPSAwOwotZXJyOgotCWk5MTVfcmVxdWVzdF9nZXQocnEpOwot
CWk5MTVfcmVxdWVzdF9hZGQocnEpOwotCWlmIChlcnIpIHsKLQkJaTkxNV9yZXF1ZXN0X3B1dChy
cSk7Ci0JCXJldHVybiBFUlJfUFRSKGVycik7Ci0JfQotCi0JcmV0dXJuIHJxOwotfQotCi1zdHJ1
Y3QgbHJjX3RpbWVzdGFtcCB7Ci0Jc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCXN0
cnVjdCBpbnRlbF9jb250ZXh0ICpjZVsyXTsKLQl1MzIgcG9pc29uOwotfTsKLQotc3RhdGljIGJv
b2wgdGltZXN0YW1wX2FkdmFuY2VkKHUzMiBzdGFydCwgdTMyIGVuZCkKLXsKLQlyZXR1cm4gKHMz
MikoZW5kIC0gc3RhcnQpID4gMDsKLX0KLQotc3RhdGljIGludCBfX2xyY190aW1lc3RhbXAoY29u
c3Qgc3RydWN0IGxyY190aW1lc3RhbXAgKmFyZywgYm9vbCBwcmVlbXB0KQotewotCXUzMiAqc2xv
dCA9IG1lbXNldDMyKGFyZy0+ZW5naW5lLT5zdGF0dXNfcGFnZS5hZGRyICsgMTAwMCwgMCwgNCk7
Ci0Jc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7Ci0JdTMyIHRpbWVzdGFtcDsKLQlpbnQgZXJyID0g
MDsKLQotCWFyZy0+Y2VbMF0tPmxyY19yZWdfc3RhdGVbQ1RYX1RJTUVTVEFNUF0gPSBhcmctPnBv
aXNvbjsKLQlycSA9IGNyZWF0ZV90aW1lc3RhbXAoYXJnLT5jZVswXSwgc2xvdCwgMSk7Ci0JaWYg
KElTX0VSUihycSkpCi0JCXJldHVybiBQVFJfRVJSKHJxKTsKLQotCWVyciA9IHdhaXRfZm9yX3N1
Ym1pdChycS0+ZW5naW5lLCBycSwgSFogLyAyKTsKLQlpZiAoZXJyKQotCQlnb3RvIGVycjsKLQot
CWlmIChwcmVlbXB0KSB7Ci0JCWFyZy0+Y2VbMV0tPmxyY19yZWdfc3RhdGVbQ1RYX1RJTUVTVEFN
UF0gPSAweGRlYWRiZWVmOwotCQllcnIgPSBlbWl0X3NlbWFwaG9yZV9zaWduYWwoYXJnLT5jZVsx
XSwgc2xvdCk7Ci0JCWlmIChlcnIpCi0JCQlnb3RvIGVycjsKLQl9IGVsc2UgewotCQlzbG90WzBd
ID0gMTsKLQkJd21iKCk7Ci0JfQotCi0JLyogQW5kIHdhaXQgZm9yIHN3aXRjaCB0byBrZXJuZWwg
KHRvIHNhdmUgb3VyIGNvbnRleHQgdG8gbWVtb3J5KSAqLwotCWVyciA9IGNvbnRleHRfZmx1c2go
YXJnLT5jZVswXSwgSFogLyAyKTsKLQlpZiAoZXJyKQotCQlnb3RvIGVycjsKLQotCWlmICghdGlt
ZXN0YW1wX2FkdmFuY2VkKGFyZy0+cG9pc29uLCBzbG90WzFdKSkgewotCQlwcl9lcnIoIiVzKCVz
KTogaW52YWxpZCB0aW1lc3RhbXAgb24gcmVzdG9yZSwgY29udGV4dDoleCwgcmVxdWVzdDoleFxu
IiwKLQkJICAgICAgIGFyZy0+ZW5naW5lLT5uYW1lLCBwcmVlbXB0ID8gInByZWVtcHQiIDogInNp
bXBsZSIsCi0JCSAgICAgICBhcmctPnBvaXNvbiwgc2xvdFsxXSk7Ci0JCWVyciA9IC1FSU5WQUw7
Ci0JfQotCi0JdGltZXN0YW1wID0gUkVBRF9PTkNFKGFyZy0+Y2VbMF0tPmxyY19yZWdfc3RhdGVb
Q1RYX1RJTUVTVEFNUF0pOwotCWlmICghdGltZXN0YW1wX2FkdmFuY2VkKHNsb3RbMV0sIHRpbWVz
dGFtcCkpIHsKLQkJcHJfZXJyKCIlcyglcyk6IGludmFsaWQgdGltZXN0YW1wIG9uIHNhdmUsIHJl
cXVlc3Q6JXgsIGNvbnRleHQ6JXhcbiIsCi0JCSAgICAgICBhcmctPmVuZ2luZS0+bmFtZSwgcHJl
ZW1wdCA/ICJwcmVlbXB0IiA6ICJzaW1wbGUiLAotCQkgICAgICAgc2xvdFsxXSwgdGltZXN0YW1w
KTsKLQkJZXJyID0gLUVJTlZBTDsKLQl9Ci0KLWVycjoKLQltZW1zZXQzMihzbG90LCAtMSwgNCk7
Ci0JaTkxNV9yZXF1ZXN0X3B1dChycSk7Ci0JcmV0dXJuIGVycjsKLX0KLQotc3RhdGljIGludCBs
aXZlX2xyY190aW1lc3RhbXAodm9pZCAqYXJnKQotewotCXN0cnVjdCBscmNfdGltZXN0YW1wIGRh
dGEgPSB7fTsKLQlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwotCWVudW0gaW50ZWxfZW5naW5l
X2lkIGlkOwotCWNvbnN0IHUzMiBwb2lzb25bXSA9IHsKLQkJMCwKLQkJUzMyX01BWCwKLQkJKHUz
MilTMzJfTUFYICsgMSwKLQkJVTMyX01BWCwKLQl9OwotCi0JLyoKLQkgKiBXZSB3YW50IHRvIHZl
cmlmeSB0aGF0IHRoZSB0aW1lc3RhbXAgaXMgc2F2ZWQgYW5kIHJlc3RvcmUgYWNyb3NzCi0JICog
Y29udGV4dCBzd2l0Y2hlcyBhbmQgaXMgbW9ub3RvbmljLgotCSAqCi0JICogU28gd2UgZG8gdGhp
cyB3aXRoIGEgbGl0dGxlIGJpdCBvZiBMUkMgcG9pc29uaW5nIHRvIGNoZWNrIHZhcmlvdXMKLQkg
KiBib3VuZGFyeSBjb25kaXRpb25zLCBhbmQgc2VlIHdoYXQgaGFwcGVucyBpZiB3ZSBwcmVlbXB0
IHRoZSBjb250ZXh0Ci0JICogd2l0aCBhIHNlY29uZCByZXF1ZXN0IChjYXJyeWluZyBtb3JlIHBv
aXNvbiBpbnRvIHRoZSB0aW1lc3RhbXApLgotCSAqLwotCi0JZm9yX2VhY2hfZW5naW5lKGRhdGEu
ZW5naW5lLCBndCwgaWQpIHsKLQkJaW50IGksIGVyciA9IDA7Ci0KLQkJc3RfZW5naW5lX2hlYXJ0
YmVhdF9kaXNhYmxlKGRhdGEuZW5naW5lKTsKLQotCQlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0la
RShkYXRhLmNlKTsgaSsrKSB7Ci0JCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqdG1wOwotCi0JCQl0
bXAgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShkYXRhLmVuZ2luZSk7Ci0JCQlpZiAoSVNfRVJSKHRt
cCkpIHsKLQkJCQllcnIgPSBQVFJfRVJSKHRtcCk7Ci0JCQkJZ290byBlcnI7Ci0JCQl9Ci0KLQkJ
CWVyciA9IGludGVsX2NvbnRleHRfcGluKHRtcCk7Ci0JCQlpZiAoZXJyKSB7Ci0JCQkJaW50ZWxf
Y29udGV4dF9wdXQodG1wKTsKLQkJCQlnb3RvIGVycjsKLQkJCX0KLQotCQkJZGF0YS5jZVtpXSA9
IHRtcDsKLQkJfQotCi0JCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKHBvaXNvbik7IGkrKykg
ewotCQkJZGF0YS5wb2lzb24gPSBwb2lzb25baV07Ci0KLQkJCWVyciA9IF9fbHJjX3RpbWVzdGFt
cCgmZGF0YSwgZmFsc2UpOwotCQkJaWYgKGVycikKLQkJCQlicmVhazsKLQotCQkJZXJyID0gX19s
cmNfdGltZXN0YW1wKCZkYXRhLCB0cnVlKTsKLQkJCWlmIChlcnIpCi0JCQkJYnJlYWs7Ci0JCX0K
LQotZXJyOgotCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShkYXRhLmVuZ2luZSk7Ci0JCWZv
ciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGRhdGEuY2UpOyBpKyspIHsKLQkJCWlmICghZGF0YS5j
ZVtpXSkKLQkJCQlicmVhazsKLQotCQkJaW50ZWxfY29udGV4dF91bnBpbihkYXRhLmNlW2ldKTsK
LQkJCWludGVsX2NvbnRleHRfcHV0KGRhdGEuY2VbaV0pOwotCQl9Ci0KLQkJaWYgKGlndF9mbHVz
aF90ZXN0KGd0LT5pOTE1KSkKLQkJCWVyciA9IC1FSU87Ci0JCWlmIChlcnIpCi0JCQlyZXR1cm4g
ZXJyOwotCX0KLQotCXJldHVybiAwOwotfQotCi1zdGF0aWMgc3RydWN0IGk5MTVfdm1hICoKLWNy
ZWF0ZV91c2VyX3ZtYShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwgdW5zaWduZWQgbG9u
ZyBzaXplKQotewotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7Ci0Jc3RydWN0IGk5
MTVfdm1hICp2bWE7Ci0JaW50IGVycjsKLQotCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVf
aW50ZXJuYWwodm0tPmk5MTUsIHNpemUpOwotCWlmIChJU19FUlIob2JqKSkKLQkJcmV0dXJuIEVS
Ul9DQVNUKG9iaik7Ci0KLQl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosIHZtLCBOVUxMKTsK
LQlpZiAoSVNfRVJSKHZtYSkpIHsKLQkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwotCQlyZXR1
cm4gdm1hOwotCX0KLQotCWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIFBJTl9VU0VSKTsK
LQlpZiAoZXJyKSB7Ci0JCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKLQkJcmV0dXJuIEVSUl9Q
VFIoZXJyKTsKLQl9Ci0KLQlyZXR1cm4gdm1hOwotfQotCi1zdGF0aWMgc3RydWN0IGk5MTVfdm1h
ICoKLXN0b3JlX2NvbnRleHQoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCBzdHJ1Y3QgaTkxNV92
bWEgKnNjcmF0Y2gpCi17Ci0Jc3RydWN0IGk5MTVfdm1hICpiYXRjaDsKLQl1MzIgZHcsIHgsICpj
cywgKmh3OwotCXUzMiAqZGVmYXVsdHM7Ci0KLQliYXRjaCA9IGNyZWF0ZV91c2VyX3ZtYShjZS0+
dm0sIFNaXzY0Syk7Ci0JaWYgKElTX0VSUihiYXRjaCkpCi0JCXJldHVybiBiYXRjaDsKLQotCWNz
ID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAoYmF0Y2gtPm9iaiwgSTkxNV9NQVBfV0MpOwotCWlm
IChJU19FUlIoY3MpKSB7Ci0JCWk5MTVfdm1hX3B1dChiYXRjaCk7Ci0JCXJldHVybiBFUlJfQ0FT
VChjcyk7Ci0JfQotCi0JZGVmYXVsdHMgPSBzaG1lbV9waW5fbWFwKGNlLT5lbmdpbmUtPmRlZmF1
bHRfc3RhdGUpOwotCWlmICghZGVmYXVsdHMpIHsKLQkJaTkxNV9nZW1fb2JqZWN0X3VucGluX21h
cChiYXRjaC0+b2JqKTsKLQkJaTkxNV92bWFfcHV0KGJhdGNoKTsKLQkJcmV0dXJuIEVSUl9QVFIo
LUVOT01FTSk7Ci0JfQotCi0JeCA9IDA7Ci0JZHcgPSAwOwotCWh3ID0gZGVmYXVsdHM7Ci0JaHcg
Kz0gTFJDX1NUQVRFX09GRlNFVCAvIHNpemVvZigqaHcpOwotCWRvIHsKLQkJdTMyIGxlbiA9IGh3
W2R3XSAmIDB4N2Y7Ci0KLQkJaWYgKGh3W2R3XSA9PSAwKSB7Ci0JCQlkdysrOwotCQkJY29udGlu
dWU7Ci0JCX0KLQotCQlpZiAoKGh3W2R3XSAmIEdFTk1BU0soMzEsIDIzKSkgIT0gTUlfSU5TVFIo
MHgyMiwgMCkpIHsKLQkJCWR3ICs9IGxlbiArIDI7Ci0JCQljb250aW51ZTsKLQkJfQotCi0JCWR3
Kys7Ci0JCWxlbiA9IChsZW4gKyAxKSAvIDI7Ci0JCXdoaWxlIChsZW4tLSkgewotCQkJKmNzKysg
PSBNSV9TVE9SRV9SRUdJU1RFUl9NRU1fR0VOODsKLQkJCSpjcysrID0gaHdbZHddOwotCQkJKmNz
KysgPSBsb3dlcl8zMl9iaXRzKHNjcmF0Y2gtPm5vZGUuc3RhcnQgKyB4KTsKLQkJCSpjcysrID0g
dXBwZXJfMzJfYml0cyhzY3JhdGNoLT5ub2RlLnN0YXJ0ICsgeCk7Ci0KLQkJCWR3ICs9IDI7Ci0J
CQl4ICs9IDQ7Ci0JCX0KLQl9IHdoaWxlIChkdyA8IFBBR0VfU0laRSAvIHNpemVvZih1MzIpICYm
Ci0JCSAoaHdbZHddICYgfkJJVCgwKSkgIT0gTUlfQkFUQ0hfQlVGRkVSX0VORCk7Ci0KLQkqY3Mr
KyA9IE1JX0JBVENIX0JVRkZFUl9FTkQ7Ci0KLQlzaG1lbV91bnBpbl9tYXAoY2UtPmVuZ2luZS0+
ZGVmYXVsdF9zdGF0ZSwgZGVmYXVsdHMpOwotCi0JaTkxNV9nZW1fb2JqZWN0X2ZsdXNoX21hcChi
YXRjaC0+b2JqKTsKLQlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKGJhdGNoLT5vYmopOwotCi0J
cmV0dXJuIGJhdGNoOwotfQotCi1zdGF0aWMgaW50IG1vdmVfdG9fYWN0aXZlKHN0cnVjdCBpOTE1
X3JlcXVlc3QgKnJxLAotCQkJICBzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKLQkJCSAgdW5zaWduZWQg
aW50IGZsYWdzKQotewotCWludCBlcnI7Ci0KLQlpOTE1X3ZtYV9sb2NrKHZtYSk7Ci0JZXJyID0g
aTkxNV9yZXF1ZXN0X2F3YWl0X29iamVjdChycSwgdm1hLT5vYmosIGZsYWdzKTsKLQlpZiAoIWVy
cikKLQkJZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3RpdmUodm1hLCBycSwgZmxhZ3MpOwotCWk5
MTVfdm1hX3VubG9jayh2bWEpOwotCi0JcmV0dXJuIGVycjsKLX0KLQotc3RhdGljIHN0cnVjdCBp
OTE1X3JlcXVlc3QgKgotcmVjb3JkX3JlZ2lzdGVycyhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2Us
Ci0JCSBzdHJ1Y3QgaTkxNV92bWEgKmJlZm9yZSwKLQkJIHN0cnVjdCBpOTE1X3ZtYSAqYWZ0ZXIs
Ci0JCSB1MzIgKnNlbWEpCi17Ci0Jc3RydWN0IGk5MTVfdm1hICpiX2JlZm9yZSwgKmJfYWZ0ZXI7
Ci0Jc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7Ci0JdTMyICpjczsKLQlpbnQgZXJyOwotCi0JYl9i
ZWZvcmUgPSBzdG9yZV9jb250ZXh0KGNlLCBiZWZvcmUpOwotCWlmIChJU19FUlIoYl9iZWZvcmUp
KQotCQlyZXR1cm4gRVJSX0NBU1QoYl9iZWZvcmUpOwotCi0JYl9hZnRlciA9IHN0b3JlX2NvbnRl
eHQoY2UsIGFmdGVyKTsKLQlpZiAoSVNfRVJSKGJfYWZ0ZXIpKSB7Ci0JCXJxID0gRVJSX0NBU1Qo
Yl9hZnRlcik7Ci0JCWdvdG8gZXJyX2JlZm9yZTsKLQl9Ci0KLQlycSA9IGludGVsX2NvbnRleHRf
Y3JlYXRlX3JlcXVlc3QoY2UpOwotCWlmIChJU19FUlIocnEpKQotCQlnb3RvIGVycl9hZnRlcjsK
LQotCWVyciA9IG1vdmVfdG9fYWN0aXZlKHJxLCBiZWZvcmUsIEVYRUNfT0JKRUNUX1dSSVRFKTsK
LQlpZiAoZXJyKQotCQlnb3RvIGVycl9ycTsKLQotCWVyciA9IG1vdmVfdG9fYWN0aXZlKHJxLCBi
X2JlZm9yZSwgMCk7Ci0JaWYgKGVycikKLQkJZ290byBlcnJfcnE7Ci0KLQllcnIgPSBtb3ZlX3Rv
X2FjdGl2ZShycSwgYWZ0ZXIsIEVYRUNfT0JKRUNUX1dSSVRFKTsKLQlpZiAoZXJyKQotCQlnb3Rv
IGVycl9ycTsKLQotCWVyciA9IG1vdmVfdG9fYWN0aXZlKHJxLCBiX2FmdGVyLCAwKTsKLQlpZiAo
ZXJyKQotCQlnb3RvIGVycl9ycTsKLQotCWNzID0gaW50ZWxfcmluZ19iZWdpbihycSwgMTQpOwot
CWlmIChJU19FUlIoY3MpKSB7Ci0JCWVyciA9IFBUUl9FUlIoY3MpOwotCQlnb3RvIGVycl9ycTsK
LQl9Ci0KLQkqY3MrKyA9IE1JX0FSQl9PTl9PRkYgfCBNSV9BUkJfRElTQUJMRTsKLQkqY3MrKyA9
IE1JX0JBVENIX0JVRkZFUl9TVEFSVF9HRU44IHwgQklUKDgpOwotCSpjcysrID0gbG93ZXJfMzJf
Yml0cyhiX2JlZm9yZS0+bm9kZS5zdGFydCk7Ci0JKmNzKysgPSB1cHBlcl8zMl9iaXRzKGJfYmVm
b3JlLT5ub2RlLnN0YXJ0KTsKLQotCSpjcysrID0gTUlfQVJCX09OX09GRiB8IE1JX0FSQl9FTkFC
TEU7Ci0JKmNzKysgPSBNSV9TRU1BUEhPUkVfV0FJVCB8Ci0JCU1JX1NFTUFQSE9SRV9HTE9CQUxf
R1RUIHwKLQkJTUlfU0VNQVBIT1JFX1BPTEwgfAotCQlNSV9TRU1BUEhPUkVfU0FEX05FUV9TREQ7
Ci0JKmNzKysgPSAwOwotCSpjcysrID0gaTkxNV9nZ3R0X29mZnNldChjZS0+ZW5naW5lLT5zdGF0
dXNfcGFnZS52bWEpICsKLQkJb2Zmc2V0X2luX3BhZ2Uoc2VtYSk7Ci0JKmNzKysgPSAwOwotCSpj
cysrID0gTUlfTk9PUDsKLQotCSpjcysrID0gTUlfQVJCX09OX09GRiB8IE1JX0FSQl9ESVNBQkxF
OwotCSpjcysrID0gTUlfQkFUQ0hfQlVGRkVSX1NUQVJUX0dFTjggfCBCSVQoOCk7Ci0JKmNzKysg
PSBsb3dlcl8zMl9iaXRzKGJfYWZ0ZXItPm5vZGUuc3RhcnQpOwotCSpjcysrID0gdXBwZXJfMzJf
Yml0cyhiX2FmdGVyLT5ub2RlLnN0YXJ0KTsKLQotCWludGVsX3JpbmdfYWR2YW5jZShycSwgY3Mp
OwotCi0JV1JJVEVfT05DRSgqc2VtYSwgMCk7Ci0JaTkxNV9yZXF1ZXN0X2dldChycSk7Ci0JaTkx
NV9yZXF1ZXN0X2FkZChycSk7Ci1lcnJfYWZ0ZXI6Ci0JaTkxNV92bWFfcHV0KGJfYWZ0ZXIpOwot
ZXJyX2JlZm9yZToKLQlpOTE1X3ZtYV9wdXQoYl9iZWZvcmUpOwotCXJldHVybiBycTsKLQotZXJy
X3JxOgotCWk5MTVfcmVxdWVzdF9hZGQocnEpOwotCXJxID0gRVJSX1BUUihlcnIpOwotCWdvdG8g
ZXJyX2FmdGVyOwotfQotCi1zdGF0aWMgc3RydWN0IGk5MTVfdm1hICpsb2FkX2NvbnRleHQoc3Ry
dWN0IGludGVsX2NvbnRleHQgKmNlLCB1MzIgcG9pc29uKQotewotCXN0cnVjdCBpOTE1X3ZtYSAq
YmF0Y2g7Ci0JdTMyIGR3LCAqY3MsICpodzsKLQl1MzIgKmRlZmF1bHRzOwotCi0JYmF0Y2ggPSBj
cmVhdGVfdXNlcl92bWEoY2UtPnZtLCBTWl82NEspOwotCWlmIChJU19FUlIoYmF0Y2gpKQotCQly
ZXR1cm4gYmF0Y2g7Ci0KLQljcyA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKGJhdGNoLT5vYmos
IEk5MTVfTUFQX1dDKTsKLQlpZiAoSVNfRVJSKGNzKSkgewotCQlpOTE1X3ZtYV9wdXQoYmF0Y2gp
OwotCQlyZXR1cm4gRVJSX0NBU1QoY3MpOwotCX0KLQotCWRlZmF1bHRzID0gc2htZW1fcGluX21h
cChjZS0+ZW5naW5lLT5kZWZhdWx0X3N0YXRlKTsKLQlpZiAoIWRlZmF1bHRzKSB7Ci0JCWk5MTVf
Z2VtX29iamVjdF91bnBpbl9tYXAoYmF0Y2gtPm9iaik7Ci0JCWk5MTVfdm1hX3B1dChiYXRjaCk7
Ci0JCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwotCX0KLQotCWR3ID0gMDsKLQlodyA9IGRlZmF1
bHRzOwotCWh3ICs9IExSQ19TVEFURV9PRkZTRVQgLyBzaXplb2YoKmh3KTsKLQlkbyB7Ci0JCXUz
MiBsZW4gPSBod1tkd10gJiAweDdmOwotCi0JCWlmIChod1tkd10gPT0gMCkgewotCQkJZHcrKzsK
LQkJCWNvbnRpbnVlOwotCQl9Ci0KLQkJaWYgKChod1tkd10gJiBHRU5NQVNLKDMxLCAyMykpICE9
IE1JX0lOU1RSKDB4MjIsIDApKSB7Ci0JCQlkdyArPSBsZW4gKyAyOwotCQkJY29udGludWU7Ci0J
CX0KLQotCQlkdysrOwotCQlsZW4gPSAobGVuICsgMSkgLyAyOwotCQkqY3MrKyA9IE1JX0xPQURf
UkVHSVNURVJfSU1NKGxlbik7Ci0JCXdoaWxlIChsZW4tLSkgewotCQkJKmNzKysgPSBod1tkd107
Ci0JCQkqY3MrKyA9IHBvaXNvbjsKLQkJCWR3ICs9IDI7Ci0JCX0KLQl9IHdoaWxlIChkdyA8IFBB
R0VfU0laRSAvIHNpemVvZih1MzIpICYmCi0JCSAoaHdbZHddICYgfkJJVCgwKSkgIT0gTUlfQkFU
Q0hfQlVGRkVSX0VORCk7Ci0KLQkqY3MrKyA9IE1JX0JBVENIX0JVRkZFUl9FTkQ7Ci0KLQlzaG1l
bV91bnBpbl9tYXAoY2UtPmVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSwgZGVmYXVsdHMpOwotCi0JaTkx
NV9nZW1fb2JqZWN0X2ZsdXNoX21hcChiYXRjaC0+b2JqKTsKLQlpOTE1X2dlbV9vYmplY3RfdW5w
aW5fbWFwKGJhdGNoLT5vYmopOwotCi0JcmV0dXJuIGJhdGNoOwotfQotCi1zdGF0aWMgaW50IHBv
aXNvbl9yZWdpc3RlcnMoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCB1MzIgcG9pc29uLCB1MzIg
KnNlbWEpCi17Ci0Jc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7Ci0Jc3RydWN0IGk5MTVfdm1hICpi
YXRjaDsKLQl1MzIgKmNzOwotCWludCBlcnI7Ci0KLQliYXRjaCA9IGxvYWRfY29udGV4dChjZSwg
cG9pc29uKTsKLQlpZiAoSVNfRVJSKGJhdGNoKSkKLQkJcmV0dXJuIFBUUl9FUlIoYmF0Y2gpOwot
Ci0JcnEgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZV9yZXF1ZXN0KGNlKTsKLQlpZiAoSVNfRVJSKHJx
KSkgewotCQllcnIgPSBQVFJfRVJSKHJxKTsKLQkJZ290byBlcnJfYmF0Y2g7Ci0JfQotCi0JZXJy
ID0gbW92ZV90b19hY3RpdmUocnEsIGJhdGNoLCAwKTsKLQlpZiAoZXJyKQotCQlnb3RvIGVycl9y
cTsKLQotCWNzID0gaW50ZWxfcmluZ19iZWdpbihycSwgOCk7Ci0JaWYgKElTX0VSUihjcykpIHsK
LQkJZXJyID0gUFRSX0VSUihjcyk7Ci0JCWdvdG8gZXJyX3JxOwotCX0KLQotCSpjcysrID0gTUlf
QVJCX09OX09GRiB8IE1JX0FSQl9ESVNBQkxFOwotCSpjcysrID0gTUlfQkFUQ0hfQlVGRkVSX1NU
QVJUX0dFTjggfCBCSVQoOCk7Ci0JKmNzKysgPSBsb3dlcl8zMl9iaXRzKGJhdGNoLT5ub2RlLnN0
YXJ0KTsKLQkqY3MrKyA9IHVwcGVyXzMyX2JpdHMoYmF0Y2gtPm5vZGUuc3RhcnQpOwotCi0JKmNz
KysgPSBNSV9TVE9SRV9EV09SRF9JTU1fR0VONCB8IE1JX1VTRV9HR1RUOwotCSpjcysrID0gaTkx
NV9nZ3R0X29mZnNldChjZS0+ZW5naW5lLT5zdGF0dXNfcGFnZS52bWEpICsKLQkJb2Zmc2V0X2lu
X3BhZ2Uoc2VtYSk7Ci0JKmNzKysgPSAwOwotCSpjcysrID0gMTsKLQotCWludGVsX3JpbmdfYWR2
YW5jZShycSwgY3MpOwotCi0JcnEtPnNjaGVkLmF0dHIucHJpb3JpdHkgPSBJOTE1X1BSSU9SSVRZ
X0JBUlJJRVI7Ci1lcnJfcnE6Ci0JaTkxNV9yZXF1ZXN0X2FkZChycSk7Ci1lcnJfYmF0Y2g6Ci0J
aTkxNV92bWFfcHV0KGJhdGNoKTsKLQlyZXR1cm4gZXJyOwotfQotCi1zdGF0aWMgYm9vbCBpc19t
b3ZpbmcodTMyIGEsIHUzMiBiKQotewotCXJldHVybiBhICE9IGI7Ci19Ci0KLXN0YXRpYyBpbnQg
Y29tcGFyZV9pc29sYXRpb24oc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAotCQkJICAg
ICBzdHJ1Y3QgaTkxNV92bWEgKnJlZlsyXSwKLQkJCSAgICAgc3RydWN0IGk5MTVfdm1hICpyZXN1
bHRbMl0sCi0JCQkgICAgIHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKLQkJCSAgICAgdTMyIHBv
aXNvbikKLXsKLQl1MzIgeCwgZHcsICpodywgKmxyYzsKLQl1MzIgKkFbMl0sICpCWzJdOwotCXUz
MiAqZGVmYXVsdHM7Ci0JaW50IGVyciA9IDA7Ci0KLQlBWzBdID0gaTkxNV9nZW1fb2JqZWN0X3Bp
bl9tYXAocmVmWzBdLT5vYmosIEk5MTVfTUFQX1dDKTsKLQlpZiAoSVNfRVJSKEFbMF0pKQotCQly
ZXR1cm4gUFRSX0VSUihBWzBdKTsKLQotCUFbMV0gPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChy
ZWZbMV0tPm9iaiwgSTkxNV9NQVBfV0MpOwotCWlmIChJU19FUlIoQVsxXSkpIHsKLQkJZXJyID0g
UFRSX0VSUihBWzFdKTsKLQkJZ290byBlcnJfQTA7Ci0JfQotCi0JQlswXSA9IGk5MTVfZ2VtX29i
amVjdF9waW5fbWFwKHJlc3VsdFswXS0+b2JqLCBJOTE1X01BUF9XQyk7Ci0JaWYgKElTX0VSUihC
WzBdKSkgewotCQllcnIgPSBQVFJfRVJSKEJbMF0pOwotCQlnb3RvIGVycl9BMTsKLQl9Ci0KLQlC
WzFdID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAocmVzdWx0WzFdLT5vYmosIEk5MTVfTUFQX1dD
KTsKLQlpZiAoSVNfRVJSKEJbMV0pKSB7Ci0JCWVyciA9IFBUUl9FUlIoQlsxXSk7Ci0JCWdvdG8g
ZXJyX0IwOwotCX0KLQotCWxyYyA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKGNlLT5zdGF0ZS0+
b2JqLAotCQkJCSAgICAgIGk5MTVfY29oZXJlbnRfbWFwX3R5cGUoZW5naW5lLT5pOTE1KSk7Ci0J
aWYgKElTX0VSUihscmMpKSB7Ci0JCWVyciA9IFBUUl9FUlIobHJjKTsKLQkJZ290byBlcnJfQjE7
Ci0JfQotCWxyYyArPSBMUkNfU1RBVEVfT0ZGU0VUIC8gc2l6ZW9mKCpodyk7Ci0KLQlkZWZhdWx0
cyA9IHNobWVtX3Bpbl9tYXAoY2UtPmVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSk7Ci0JaWYgKCFkZWZh
dWx0cykgewotCQllcnIgPSAtRU5PTUVNOwotCQlnb3RvIGVycl9scmM7Ci0JfQotCi0JeCA9IDA7
Ci0JZHcgPSAwOwotCWh3ID0gZGVmYXVsdHM7Ci0JaHcgKz0gTFJDX1NUQVRFX09GRlNFVCAvIHNp
emVvZigqaHcpOwotCWRvIHsKLQkJdTMyIGxlbiA9IGh3W2R3XSAmIDB4N2Y7Ci0KLQkJaWYgKGh3
W2R3XSA9PSAwKSB7Ci0JCQlkdysrOwotCQkJY29udGludWU7Ci0JCX0KLQotCQlpZiAoKGh3W2R3
XSAmIEdFTk1BU0soMzEsIDIzKSkgIT0gTUlfSU5TVFIoMHgyMiwgMCkpIHsKLQkJCWR3ICs9IGxl
biArIDI7Ci0JCQljb250aW51ZTsKLQkJfQotCi0JCWR3Kys7Ci0JCWxlbiA9IChsZW4gKyAxKSAv
IDI7Ci0JCXdoaWxlIChsZW4tLSkgewotCQkJaWYgKCFpc19tb3ZpbmcoQVswXVt4XSwgQVsxXVt4
XSkgJiYKLQkJCSAgICAoQVswXVt4XSAhPSBCWzBdW3hdIHx8IEFbMV1beF0gIT0gQlsxXVt4XSkp
IHsKLQkJCQlzd2l0Y2ggKGh3W2R3XSAmIDQwOTUpIHsKLQkJCQljYXNlIDB4MzA6IC8qIFJJTkdf
SEVBRCAqLwotCQkJCWNhc2UgMHgzNDogLyogUklOR19UQUlMICovCi0JCQkJCWJyZWFrOwotCi0J
CQkJZGVmYXVsdDoKLQkJCQkJcHJfZXJyKCIlc1slZF06IE1pc21hdGNoIGZvciByZWdpc3RlciAl
NHgsIGRlZmF1bHQgJTA4eCwgcmVmZXJlbmNlICUwOHgsIHJlc3VsdCAoJTA4eCwgJTA4eCksIHBv
aXNvbiAlMDh4LCBjb250ZXh0ICUwOHhcbiIsCi0JCQkJCSAgICAgICBlbmdpbmUtPm5hbWUsIGR3
LAotCQkJCQkgICAgICAgaHdbZHddLCBod1tkdyArIDFdLAotCQkJCQkgICAgICAgQVswXVt4XSwg
QlswXVt4XSwgQlsxXVt4XSwKLQkJCQkJICAgICAgIHBvaXNvbiwgbHJjW2R3ICsgMV0pOwotCQkJ
CQllcnIgPSAtRUlOVkFMOwotCQkJCX0KLQkJCX0KLQkJCWR3ICs9IDI7Ci0JCQl4Kys7Ci0JCX0K
LQl9IHdoaWxlIChkdyA8IFBBR0VfU0laRSAvIHNpemVvZih1MzIpICYmCi0JCSAoaHdbZHddICYg
fkJJVCgwKSkgIT0gTUlfQkFUQ0hfQlVGRkVSX0VORCk7Ci0KLQlzaG1lbV91bnBpbl9tYXAoY2Ut
PmVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSwgZGVmYXVsdHMpOwotZXJyX2xyYzoKLQlpOTE1X2dlbV9v
YmplY3RfdW5waW5fbWFwKGNlLT5zdGF0ZS0+b2JqKTsKLWVycl9CMToKLQlpOTE1X2dlbV9vYmpl
Y3RfdW5waW5fbWFwKHJlc3VsdFsxXS0+b2JqKTsKLWVycl9CMDoKLQlpOTE1X2dlbV9vYmplY3Rf
dW5waW5fbWFwKHJlc3VsdFswXS0+b2JqKTsKLWVycl9BMToKLQlpOTE1X2dlbV9vYmplY3RfdW5w
aW5fbWFwKHJlZlsxXS0+b2JqKTsKLWVycl9BMDoKLQlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFw
KHJlZlswXS0+b2JqKTsKLQlyZXR1cm4gZXJyOwotfQotCi1zdGF0aWMgaW50IF9fbHJjX2lzb2xh
dGlvbihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIHUzMiBwb2lzb24pCi17Ci0JdTMy
ICpzZW1hID0gbWVtc2V0MzIoZW5naW5lLT5zdGF0dXNfcGFnZS5hZGRyICsgMTAwMCwgMCwgMSk7
Ci0Jc3RydWN0IGk5MTVfdm1hICpyZWZbMl0sICpyZXN1bHRbMl07Ci0Jc3RydWN0IGludGVsX2Nv
bnRleHQgKkEsICpCOwotCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwotCWludCBlcnI7Ci0KLQlB
ID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKLQlpZiAoSVNfRVJSKEEpKQotCQlyZXR1
cm4gUFRSX0VSUihBKTsKLQotCUIgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUpOwotCWlm
IChJU19FUlIoQikpIHsKLQkJZXJyID0gUFRSX0VSUihCKTsKLQkJZ290byBlcnJfQTsKLQl9Ci0K
LQlyZWZbMF0gPSBjcmVhdGVfdXNlcl92bWEoQS0+dm0sIFNaXzY0Syk7Ci0JaWYgKElTX0VSUihy
ZWZbMF0pKSB7Ci0JCWVyciA9IFBUUl9FUlIocmVmWzBdKTsKLQkJZ290byBlcnJfQjsKLQl9Ci0K
LQlyZWZbMV0gPSBjcmVhdGVfdXNlcl92bWEoQS0+dm0sIFNaXzY0Syk7Ci0JaWYgKElTX0VSUihy
ZWZbMV0pKSB7Ci0JCWVyciA9IFBUUl9FUlIocmVmWzFdKTsKLQkJZ290byBlcnJfcmVmMDsKLQl9
Ci0KLQlycSA9IHJlY29yZF9yZWdpc3RlcnMoQSwgcmVmWzBdLCByZWZbMV0sIHNlbWEpOwotCWlm
IChJU19FUlIocnEpKSB7Ci0JCWVyciA9IFBUUl9FUlIocnEpOwotCQlnb3RvIGVycl9yZWYxOwot
CX0KLQotCVdSSVRFX09OQ0UoKnNlbWEsIDEpOwotCXdtYigpOwotCi0JaWYgKGk5MTVfcmVxdWVz
dF93YWl0KHJxLCAwLCBIWiAvIDIpIDwgMCkgewotCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKLQkJ
ZXJyID0gLUVUSU1FOwotCQlnb3RvIGVycl9yZWYxOwotCX0KLQlpOTE1X3JlcXVlc3RfcHV0KHJx
KTsKLQotCXJlc3VsdFswXSA9IGNyZWF0ZV91c2VyX3ZtYShBLT52bSwgU1pfNjRLKTsKLQlpZiAo
SVNfRVJSKHJlc3VsdFswXSkpIHsKLQkJZXJyID0gUFRSX0VSUihyZXN1bHRbMF0pOwotCQlnb3Rv
IGVycl9yZWYxOwotCX0KLQotCXJlc3VsdFsxXSA9IGNyZWF0ZV91c2VyX3ZtYShBLT52bSwgU1pf
NjRLKTsKLQlpZiAoSVNfRVJSKHJlc3VsdFsxXSkpIHsKLQkJZXJyID0gUFRSX0VSUihyZXN1bHRb
MV0pOwotCQlnb3RvIGVycl9yZXN1bHQwOwotCX0KLQotCXJxID0gcmVjb3JkX3JlZ2lzdGVycyhB
LCByZXN1bHRbMF0sIHJlc3VsdFsxXSwgc2VtYSk7Ci0JaWYgKElTX0VSUihycSkpIHsKLQkJZXJy
ID0gUFRSX0VSUihycSk7Ci0JCWdvdG8gZXJyX3Jlc3VsdDE7Ci0JfQotCi0JZXJyID0gcG9pc29u
X3JlZ2lzdGVycyhCLCBwb2lzb24sIHNlbWEpOwotCWlmIChlcnIpIHsKLQkJV1JJVEVfT05DRSgq
c2VtYSwgLTEpOwotCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKLQkJZ290byBlcnJfcmVzdWx0MTsK
LQl9Ci0KLQlpZiAoaTkxNV9yZXF1ZXN0X3dhaXQocnEsIDAsIEhaIC8gMikgPCAwKSB7Ci0JCWk5
MTVfcmVxdWVzdF9wdXQocnEpOwotCQllcnIgPSAtRVRJTUU7Ci0JCWdvdG8gZXJyX3Jlc3VsdDE7
Ci0JfQotCWk5MTVfcmVxdWVzdF9wdXQocnEpOwotCi0JZXJyID0gY29tcGFyZV9pc29sYXRpb24o
ZW5naW5lLCByZWYsIHJlc3VsdCwgQSwgcG9pc29uKTsKLQotZXJyX3Jlc3VsdDE6Ci0JaTkxNV92
bWFfcHV0KHJlc3VsdFsxXSk7Ci1lcnJfcmVzdWx0MDoKLQlpOTE1X3ZtYV9wdXQocmVzdWx0WzBd
KTsKLWVycl9yZWYxOgotCWk5MTVfdm1hX3B1dChyZWZbMV0pOwotZXJyX3JlZjA6Ci0JaTkxNV92
bWFfcHV0KHJlZlswXSk7Ci1lcnJfQjoKLQlpbnRlbF9jb250ZXh0X3B1dChCKTsKLWVycl9BOgot
CWludGVsX2NvbnRleHRfcHV0KEEpOwotCXJldHVybiBlcnI7Ci19Ci0KLXN0YXRpYyBib29sIHNr
aXBfaXNvbGF0aW9uKGNvbnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKLXsKLQlp
ZiAoZW5naW5lLT5jbGFzcyA9PSBDT1BZX0VOR0lORV9DTEFTUyAmJiBJTlRFTF9HRU4oZW5naW5l
LT5pOTE1KSA9PSA5KQotCQlyZXR1cm4gdHJ1ZTsKLQotCWlmIChlbmdpbmUtPmNsYXNzID09IFJF
TkRFUl9DTEFTUyAmJiBJTlRFTF9HRU4oZW5naW5lLT5pOTE1KSA9PSAxMSkKLQkJcmV0dXJuIHRy
dWU7Ci0KLQlyZXR1cm4gZmFsc2U7Ci19Ci0KLXN0YXRpYyBpbnQgbGl2ZV9scmNfaXNvbGF0aW9u
KHZvaWQgKmFyZykKLXsKLQlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwotCXN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKmVuZ2luZTsKLQllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKLQljb25zdCB1
MzIgcG9pc29uW10gPSB7Ci0JCVNUQUNLX01BR0lDLAotCQkweDNhM2EzYTNhLAotCQkweDVjNWM1
YzVjLAotCQkweGZmZmZmZmZmLAotCQkweGZmZmYwMDAwLAotCX07Ci0JaW50IGVyciA9IDA7Ci0K
LQkvKgotCSAqIE91ciBnb2FsIGlzIHRyeSBhbmQgdmVyaWZ5IHRoYXQgcGVyLWNvbnRleHQgc3Rh
dGUgY2Fubm90IGJlCi0JICogdGFtcGVyZWQgd2l0aCBieSBhbm90aGVyIG5vbi1wcml2aWxlZ2Vk
IGNsaWVudC4KLQkgKgotCSAqIFdlIHRha2UgdGhlIGxpc3Qgb2YgY29udGV4dCByZWdpc3RlcnMg
ZnJvbSB0aGUgTFJJIGluIHRoZSBkZWZhdWx0Ci0JICogY29udGV4dCBpbWFnZSBhbmQgYXR0ZW1w
dCB0byBtb2RpZnkgdGhhdCBsaXN0IGZyb20gYSByZW1vdGUgY29udGV4dC4KLQkgKi8KLQotCWZv
cl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgewotCQlpbnQgaTsKLQotCQkvKiBKdXN0IGRv
bid0IGV2ZW4gYXNrICovCi0JCWlmICghSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfU0VMRlRF
U1RfQlJPS0VOKSAmJgotCQkgICAgc2tpcF9pc29sYXRpb24oZW5naW5lKSkKLQkJCWNvbnRpbnVl
OwotCi0JCWludGVsX2VuZ2luZV9wbV9nZXQoZW5naW5lKTsKLQkJZm9yIChpID0gMDsgaSA8IEFS
UkFZX1NJWkUocG9pc29uKTsgaSsrKSB7Ci0JCQlpbnQgcmVzdWx0OwotCi0JCQlyZXN1bHQgPSBf
X2xyY19pc29sYXRpb24oZW5naW5lLCBwb2lzb25baV0pOwotCQkJaWYgKHJlc3VsdCAmJiAhZXJy
KQotCQkJCWVyciA9IHJlc3VsdDsKLQotCQkJcmVzdWx0ID0gX19scmNfaXNvbGF0aW9uKGVuZ2lu
ZSwgfnBvaXNvbltpXSk7Ci0JCQlpZiAocmVzdWx0ICYmICFlcnIpCi0JCQkJZXJyID0gcmVzdWx0
OwotCQl9Ci0JCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKLQkJaWYgKGlndF9mbHVzaF90
ZXN0KGd0LT5pOTE1KSkgewotCQkJZXJyID0gLUVJTzsKLQkJCWJyZWFrOwotCQl9Ci0JfQotCi0J
cmV0dXJuIGVycjsKLX0KLQotc3RhdGljIGludCBpbmRpcmVjdF9jdHhfc3VibWl0X3JlcShzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2UpCi17Ci0Jc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7Ci0JaW50
IGVyciA9IDA7Ci0KLQlycSA9IGludGVsX2NvbnRleHRfY3JlYXRlX3JlcXVlc3QoY2UpOwotCWlm
IChJU19FUlIocnEpKQotCQlyZXR1cm4gUFRSX0VSUihycSk7Ci0KLQlpOTE1X3JlcXVlc3RfZ2V0
KHJxKTsKLQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKLQotCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChy
cSwgMCwgSFogLyA1KSA8IDApCi0JCWVyciA9IC1FVElNRTsKLQotCWk5MTVfcmVxdWVzdF9wdXQo
cnEpOwotCi0JcmV0dXJuIGVycjsKLX0KLQotI2RlZmluZSBDVFhfQkJfQ0FOQVJZX09GRlNFVCAo
MyAqIDEwMjQpCi0jZGVmaW5lIENUWF9CQl9DQU5BUllfSU5ERVggIChDVFhfQkJfQ0FOQVJZX09G
RlNFVCAvIHNpemVvZih1MzIpKQotCi1zdGF0aWMgdTMyICoKLWVtaXRfaW5kaXJlY3RfY3R4X2Ji
X2NhbmFyeShjb25zdCBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIHUzMiAqY3MpCi17Ci0JKmNz
KysgPSBNSV9TVE9SRV9SRUdJU1RFUl9NRU1fR0VOOCB8Ci0JCU1JX1NSTV9MUk1fR0xPQkFMX0dU
VCB8Ci0JCU1JX0xSSV9MUk1fQ1NfTU1JTzsKLQkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0
KFJJTkdfU1RBUlQoMCkpOwotCSpjcysrID0gaTkxNV9nZ3R0X29mZnNldChjZS0+c3RhdGUpICsK
LQkJY29udGV4dF93YV9iYl9vZmZzZXQoY2UpICsKLQkJQ1RYX0JCX0NBTkFSWV9PRkZTRVQ7Ci0J
KmNzKysgPSAwOwotCi0JcmV0dXJuIGNzOwotfQotCi1zdGF0aWMgdm9pZAotaW5kaXJlY3RfY3R4
X2JiX3NldHVwKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKLXsKLQl1MzIgKmNzID0gY29udGV4
dF9pbmRpcmVjdF9iYihjZSk7Ci0KLQljc1tDVFhfQkJfQ0FOQVJZX0lOREVYXSA9IDB4ZGVhZGYw
MGQ7Ci0KLQlzZXR1cF9pbmRpcmVjdF9jdHhfYmIoY2UsIGNlLT5lbmdpbmUsIGVtaXRfaW5kaXJl
Y3RfY3R4X2JiX2NhbmFyeSk7Ci19Ci0KLXN0YXRpYyBib29sIGNoZWNrX3Jpbmdfc3RhcnQoc3Ry
dWN0IGludGVsX2NvbnRleHQgKmNlKQotewotCWNvbnN0IHUzMiAqIGNvbnN0IGN0eF9iYiA9ICh2
b2lkICopKGNlLT5scmNfcmVnX3N0YXRlKSAtCi0JCUxSQ19TVEFURV9PRkZTRVQgKyBjb250ZXh0
X3dhX2JiX29mZnNldChjZSk7Ci0KLQlpZiAoY3R4X2JiW0NUWF9CQl9DQU5BUllfSU5ERVhdID09
IGNlLT5scmNfcmVnX3N0YXRlW0NUWF9SSU5HX1NUQVJUXSkKLQkJcmV0dXJuIHRydWU7Ci0KLQlw
cl9lcnIoInJpbmcgc3RhcnQgbWlzbWF0Y2g6IGNhbmFyeSAweCUwOHggdnMgc3RhdGUgMHglMDh4
XG4iLAotCSAgICAgICBjdHhfYmJbQ1RYX0JCX0NBTkFSWV9JTkRFWF0sCi0JICAgICAgIGNlLT5s
cmNfcmVnX3N0YXRlW0NUWF9SSU5HX1NUQVJUXSk7Ci0KLQlyZXR1cm4gZmFsc2U7Ci19Ci0KLXN0
YXRpYyBpbnQgaW5kaXJlY3RfY3R4X2JiX2NoZWNrKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkK
LXsKLQlpbnQgZXJyOwotCi0JZXJyID0gaW5kaXJlY3RfY3R4X3N1Ym1pdF9yZXEoY2UpOwotCWlm
IChlcnIpCi0JCXJldHVybiBlcnI7Ci0KLQlpZiAoIWNoZWNrX3Jpbmdfc3RhcnQoY2UpKQotCQly
ZXR1cm4gLUVJTlZBTDsKLQotCXJldHVybiAwOwotfQotCi1zdGF0aWMgaW50IF9fbGl2ZV9scmNf
aW5kaXJlY3RfY3R4X2JiKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKLXsKLQlzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqYSwgKmI7Ci0JaW50IGVycjsKLQotCWEgPSBpbnRlbF9jb250ZXh0
X2NyZWF0ZShlbmdpbmUpOwotCWlmIChJU19FUlIoYSkpCi0JCXJldHVybiBQVFJfRVJSKGEpOwot
CWVyciA9IGludGVsX2NvbnRleHRfcGluKGEpOwotCWlmIChlcnIpCi0JCWdvdG8gcHV0X2E7Ci0K
LQliID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKLQlpZiAoSVNfRVJSKGIpKSB7Ci0J
CWVyciA9IFBUUl9FUlIoYik7Ci0JCWdvdG8gdW5waW5fYTsKLQl9Ci0JZXJyID0gaW50ZWxfY29u
dGV4dF9waW4oYik7Ci0JaWYgKGVycikKLQkJZ290byBwdXRfYjsKLQotCS8qIFdlIHVzZSB0aGUg
YWxyZWFkeSByZXNlcnZlZCBleHRyYSBwYWdlIGluIGNvbnRleHQgc3RhdGUgKi8KLQlpZiAoIWEt
PndhX2JiX3BhZ2UpIHsKLQkJR0VNX0JVR19PTihiLT53YV9iYl9wYWdlKTsKLQkJR0VNX0JVR19P
TihJTlRFTF9HRU4oZW5naW5lLT5pOTE1KSA9PSAxMik7Ci0JCWdvdG8gdW5waW5fYjsKLQl9Ci0K
LQkvKgotCSAqIEluIG9yZGVyIHRvIHRlc3QgdGhhdCBvdXIgcGVyIGNvbnRleHQgYmIgaXMgdHJ1
bHkgcGVyIGNvbnRleHQsCi0JICogYW5kIGV4ZWN1dGVzIGF0IHRoZSBpbnRlbmRlZCBzcG90IG9u
IGNvbnRleHQgcmVzdG9yaW5nIHByb2Nlc3MsCi0JICogbWFrZSB0aGUgYmF0Y2ggc3RvcmUgdGhl
IHJpbmcgc3RhcnQgdmFsdWUgdG8gbWVtb3J5LgotCSAqIEFzIHJpbmcgc3RhcnQgaXMgcmVzdG9y
ZWQgYXByaW9yaSBvZiBzdGFydGluZyB0aGUgaW5kaXJlY3QgY3R4IGJiIGFuZAotCSAqIGFzIGl0
IHdpbGwgYmUgZGlmZmVyZW50IGZvciBlYWNoIGNvbnRleHQsIGl0IGZpdHMgdG8gdGhpcyBwdXJw
b3NlLgotCSAqLwotCWluZGlyZWN0X2N0eF9iYl9zZXR1cChhKTsKLQlpbmRpcmVjdF9jdHhfYmJf
c2V0dXAoYik7Ci0KLQllcnIgPSBpbmRpcmVjdF9jdHhfYmJfY2hlY2soYSk7Ci0JaWYgKGVycikK
LQkJZ290byB1bnBpbl9iOwotCi0JZXJyID0gaW5kaXJlY3RfY3R4X2JiX2NoZWNrKGIpOwotCi11
bnBpbl9iOgotCWludGVsX2NvbnRleHRfdW5waW4oYik7Ci1wdXRfYjoKLQlpbnRlbF9jb250ZXh0
X3B1dChiKTsKLXVucGluX2E6Ci0JaW50ZWxfY29udGV4dF91bnBpbihhKTsKLXB1dF9hOgotCWlu
dGVsX2NvbnRleHRfcHV0KGEpOwotCi0JcmV0dXJuIGVycjsKLX0KLQotc3RhdGljIGludCBsaXZl
X2xyY19pbmRpcmVjdF9jdHhfYmIodm9pZCAqYXJnKQotewotCXN0cnVjdCBpbnRlbF9ndCAqZ3Qg
PSBhcmc7Ci0Jc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCWVudW0gaW50ZWxfZW5n
aW5lX2lkIGlkOwotCWludCBlcnIgPSAwOwotCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3Qs
IGlkKSB7Ci0JCWludGVsX2VuZ2luZV9wbV9nZXQoZW5naW5lKTsKLQkJZXJyID0gX19saXZlX2xy
Y19pbmRpcmVjdF9jdHhfYmIoZW5naW5lKTsKLQkJaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUp
OwotCi0JCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpCi0JCQllcnIgPSAtRUlPOwotCi0J
CWlmIChlcnIpCi0JCQlicmVhazsKLQl9Ci0KLQlyZXR1cm4gZXJyOwotfQotCi1zdGF0aWMgdm9p
ZCBnYXJiYWdlX3Jlc2V0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKLQkJCSAgc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnEpCi17Ci0JY29uc3QgdW5zaWduZWQgaW50IGJpdCA9IEk5MTVf
UkVTRVRfRU5HSU5FICsgZW5naW5lLT5pZDsKLQl1bnNpZ25lZCBsb25nICpsb2NrID0gJmVuZ2lu
ZS0+Z3QtPnJlc2V0LmZsYWdzOwotCi0JaWYgKHRlc3RfYW5kX3NldF9iaXQoYml0LCBsb2NrKSkK
LQkJcmV0dXJuOwotCi0JdGFza2xldF9kaXNhYmxlKCZlbmdpbmUtPmV4ZWNsaXN0cy50YXNrbGV0
KTsKLQotCWlmICghcnEtPmZlbmNlLmVycm9yKQotCQlpbnRlbF9lbmdpbmVfcmVzZXQoZW5naW5l
LCBOVUxMKTsKLQotCXRhc2tsZXRfZW5hYmxlKCZlbmdpbmUtPmV4ZWNsaXN0cy50YXNrbGV0KTsK
LQljbGVhcl9hbmRfd2FrZV91cF9iaXQoYml0LCBsb2NrKTsKLX0KLQotc3RhdGljIHN0cnVjdCBp
OTE1X3JlcXVlc3QgKmdhcmJhZ2Uoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAotCQkJCSAgICBz
dHJ1Y3Qgcm5kX3N0YXRlICpwcm5nKQotewotCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwotCWlu
dCBlcnI7Ci0KLQllcnIgPSBpbnRlbF9jb250ZXh0X3BpbihjZSk7Ci0JaWYgKGVycikKLQkJcmV0
dXJuIEVSUl9QVFIoZXJyKTsKLQotCXByYW5kb21fYnl0ZXNfc3RhdGUocHJuZywKLQkJCSAgICBj
ZS0+bHJjX3JlZ19zdGF0ZSwKLQkJCSAgICBjZS0+ZW5naW5lLT5jb250ZXh0X3NpemUgLQotCQkJ
ICAgIExSQ19TVEFURV9PRkZTRVQpOwotCi0JcnEgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZV9yZXF1
ZXN0KGNlKTsKLQlpZiAoSVNfRVJSKHJxKSkgewotCQllcnIgPSBQVFJfRVJSKHJxKTsKLQkJZ290
byBlcnJfdW5waW47Ci0JfQotCi0JaTkxNV9yZXF1ZXN0X2dldChycSk7Ci0JaTkxNV9yZXF1ZXN0
X2FkZChycSk7Ci0JcmV0dXJuIHJxOwotCi1lcnJfdW5waW46Ci0JaW50ZWxfY29udGV4dF91bnBp
bihjZSk7Ci0JcmV0dXJuIEVSUl9QVFIoZXJyKTsKLX0KLQotc3RhdGljIGludCBfX2xyY19nYXJi
YWdlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgc3RydWN0IHJuZF9zdGF0ZSAqcHJu
ZykKLXsKLQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7Ci0Jc3RydWN0IGk5MTVfcmVxdWVzdCAq
aGFuZzsKLQlpbnQgZXJyID0gMDsKLQotCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5l
KTsKLQlpZiAoSVNfRVJSKGNlKSkKLQkJcmV0dXJuIFBUUl9FUlIoY2UpOwotCi0JaGFuZyA9IGdh
cmJhZ2UoY2UsIHBybmcpOwotCWlmIChJU19FUlIoaGFuZykpIHsKLQkJZXJyID0gUFRSX0VSUiho
YW5nKTsKLQkJZ290byBlcnJfY2U7Ci0JfQotCi0JaWYgKHdhaXRfZm9yX3N1Ym1pdChlbmdpbmUs
IGhhbmcsIEhaIC8gMikpIHsKLQkJaTkxNV9yZXF1ZXN0X3B1dChoYW5nKTsKLQkJZXJyID0gLUVU
SU1FOwotCQlnb3RvIGVycl9jZTsKLQl9Ci0KLQlpbnRlbF9jb250ZXh0X3NldF9iYW5uZWQoY2Up
OwotCWdhcmJhZ2VfcmVzZXQoZW5naW5lLCBoYW5nKTsKLQotCWludGVsX2VuZ2luZV9mbHVzaF9z
dWJtaXNzaW9uKGVuZ2luZSk7Ci0JaWYgKCFoYW5nLT5mZW5jZS5lcnJvcikgewotCQlpOTE1X3Jl
cXVlc3RfcHV0KGhhbmcpOwotCQlwcl9lcnIoIiVzOiBjb3JydXB0ZWQgY29udGV4dCB3YXMgbm90
IHJlc2V0XG4iLAotCQkgICAgICAgZW5naW5lLT5uYW1lKTsKLQkJZXJyID0gLUVJTlZBTDsKLQkJ
Z290byBlcnJfY2U7Ci0JfQotCi0JaWYgKGk5MTVfcmVxdWVzdF93YWl0KGhhbmcsIDAsIEhaIC8g
MikgPCAwKSB7Ci0JCXByX2VycigiJXM6IGNvcnJ1cHRlZCBjb250ZXh0IGRpZCBub3QgcmVjb3Zl
clxuIiwKLQkJICAgICAgIGVuZ2luZS0+bmFtZSk7Ci0JCWk5MTVfcmVxdWVzdF9wdXQoaGFuZyk7
Ci0JCWVyciA9IC1FSU87Ci0JCWdvdG8gZXJyX2NlOwotCX0KLQlpOTE1X3JlcXVlc3RfcHV0KGhh
bmcpOwotCi1lcnJfY2U6Ci0JaW50ZWxfY29udGV4dF9wdXQoY2UpOwotCXJldHVybiBlcnI7Ci19
Ci0KLXN0YXRpYyBpbnQgbGl2ZV9scmNfZ2FyYmFnZSh2b2lkICphcmcpCi17Ci0Jc3RydWN0IGlu
dGVsX2d0ICpndCA9IGFyZzsKLQlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7Ci0JZW51
bSBpbnRlbF9lbmdpbmVfaWQgaWQ7Ci0KLQkvKgotCSAqIFZlcmlmeSB0aGF0IHdlIGNhbiByZWNv
dmVyIGlmIG9uZSBjb250ZXh0IHN0YXRlIGlzIGNvbXBsZXRlbHkKLQkgKiBjb3JydXB0ZWQuCi0J
ICovCi0KLQlpZiAoIUlTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X1NFTEZURVNUX0JST0tFTikp
Ci0JCXJldHVybiAwOwotCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7Ci0JCUk5
MTVfUk5EX1NUQVRFKHBybmcpOwotCQlpbnQgZXJyID0gMCwgaTsKLQotCQlpZiAoIWludGVsX2hh
c19yZXNldF9lbmdpbmUoZW5naW5lLT5ndCkpCi0JCQljb250aW51ZTsKLQotCQlpbnRlbF9lbmdp
bmVfcG1fZ2V0KGVuZ2luZSk7Ci0JCWZvciAoaSA9IDA7IGkgPCAzOyBpKyspIHsKLQkJCWVyciA9
IF9fbHJjX2dhcmJhZ2UoZW5naW5lLCAmcHJuZyk7Ci0JCQlpZiAoZXJyKQotCQkJCWJyZWFrOwot
CQl9Ci0JCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKLQotCQlpZiAoaWd0X2ZsdXNoX3Rl
c3QoZ3QtPmk5MTUpKQotCQkJZXJyID0gLUVJTzsKLQkJaWYgKGVycikKLQkJCXJldHVybiBlcnI7
Ci0JfQotCi0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQgX19saXZlX3BwaHdzcF9ydW50aW1l
KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKLXsKLQlzdHJ1Y3QgaW50ZWxfY29udGV4
dCAqY2U7Ci0Jc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7Ci0JSUdUX1RJTUVPVVQoZW5kX3RpbWUp
OwotCWludCBlcnI7Ci0KLQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7Ci0JaWYg
KElTX0VSUihjZSkpCi0JCXJldHVybiBQVFJfRVJSKGNlKTsKLQotCWNlLT5ydW50aW1lLm51bV91
bmRlcmZsb3cgPSAwOwotCWNlLT5ydW50aW1lLm1heF91bmRlcmZsb3cgPSAwOwotCi0JZG8gewot
CQl1bnNpZ25lZCBpbnQgbG9vcCA9IDEwMjQ7Ci0KLQkJd2hpbGUgKGxvb3ApIHsKLQkJCXJxID0g
aW50ZWxfY29udGV4dF9jcmVhdGVfcmVxdWVzdChjZSk7Ci0JCQlpZiAoSVNfRVJSKHJxKSkgewot
CQkJCWVyciA9IFBUUl9FUlIocnEpOwotCQkJCWdvdG8gZXJyX3JxOwotCQkJfQotCi0JCQlpZiAo
LS1sb29wID09IDApCi0JCQkJaTkxNV9yZXF1ZXN0X2dldChycSk7Ci0KLQkJCWk5MTVfcmVxdWVz
dF9hZGQocnEpOwotCQl9Ci0KLQkJaWYgKF9faWd0X3RpbWVvdXQoZW5kX3RpbWUsIE5VTEwpKQot
CQkJYnJlYWs7Ci0KLQkJaTkxNV9yZXF1ZXN0X3B1dChycSk7Ci0JfSB3aGlsZSAoMSk7Ci0KLQll
cnIgPSBpOTE1X3JlcXVlc3Rfd2FpdChycSwgMCwgSFogLyA1KTsKLQlpZiAoZXJyIDwgMCkgewot
CQlwcl9lcnIoIiVzOiByZXF1ZXN0IG5vdCBjb21wbGV0ZWQhXG4iLCBlbmdpbmUtPm5hbWUpOwot
CQlnb3RvIGVycl93YWl0OwotCX0KLQotCWlndF9mbHVzaF90ZXN0KGVuZ2luZS0+aTkxNSk7Ci0K
LQlwcl9pbmZvKCIlczogcHBod3NwIHJ1bnRpbWUgJWxsdW5zLCBhdmVyYWdlICVsbHVuc1xuIiwK
LQkJZW5naW5lLT5uYW1lLAotCQlpbnRlbF9jb250ZXh0X2dldF90b3RhbF9ydW50aW1lX25zKGNl
KSwKLQkJaW50ZWxfY29udGV4dF9nZXRfYXZnX3J1bnRpbWVfbnMoY2UpKTsKLQotCWVyciA9IDA7
Ci0JaWYgKGNlLT5ydW50aW1lLm51bV91bmRlcmZsb3cpIHsKLQkJcHJfZXJyKCIlczogcHBod3Nw
IHVuZGVyZmxvdyAldSB0aW1lKHMpLCBtYXggJXUgY3ljbGVzIVxuIiwKLQkJICAgICAgIGVuZ2lu
ZS0+bmFtZSwKLQkJICAgICAgIGNlLT5ydW50aW1lLm51bV91bmRlcmZsb3csCi0JCSAgICAgICBj
ZS0+cnVudGltZS5tYXhfdW5kZXJmbG93KTsKLQkJR0VNX1RSQUNFX0RVTVAoKTsKLQkJZXJyID0g
LUVPVkVSRkxPVzsKLQl9Ci0KLWVycl93YWl0OgotCWk5MTVfcmVxdWVzdF9wdXQocnEpOwotZXJy
X3JxOgotCWludGVsX2NvbnRleHRfcHV0KGNlKTsKLQlyZXR1cm4gZXJyOwotfQotCi1zdGF0aWMg
aW50IGxpdmVfcHBod3NwX3J1bnRpbWUodm9pZCAqYXJnKQotewotCXN0cnVjdCBpbnRlbF9ndCAq
Z3QgPSBhcmc7Ci0Jc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotCWVudW0gaW50ZWxf
ZW5naW5lX2lkIGlkOwotCWludCBlcnIgPSAwOwotCi0JLyoKLQkgKiBDaGVjayB0aGF0IGN1bXVs
YXRpdmUgY29udGV4dCBydW50aW1lIGFzIHN0b3JlZCBpbiB0aGUgcHBod3NwWzE2XQotCSAqIGlz
IG1vbm90b25pYy4KLQkgKi8KLQotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgewot
CQllcnIgPSBfX2xpdmVfcHBod3NwX3J1bnRpbWUoZW5naW5lKTsKLQkJaWYgKGVycikKLQkJCWJy
ZWFrOwotCX0KLQotCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpCi0JCWVyciA9IC1FSU87
Ci0KLQlyZXR1cm4gZXJyOwotfQotCi1pbnQgaW50ZWxfbHJjX2xpdmVfc2VsZnRlc3RzKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KQotewotCXN0YXRpYyBjb25zdCBzdHJ1Y3QgaTkxNV9z
dWJ0ZXN0IHRlc3RzW10gPSB7Ci0JCVNVQlRFU1QobGl2ZV9scmNfbGF5b3V0KSwKLQkJU1VCVEVT
VChsaXZlX2xyY19maXhlZCksCi0JCVNVQlRFU1QobGl2ZV9scmNfc3RhdGUpLAotCQlTVUJURVNU
KGxpdmVfbHJjX2dwciksCi0JCVNVQlRFU1QobGl2ZV9scmNfaXNvbGF0aW9uKSwKLQkJU1VCVEVT
VChsaXZlX2xyY190aW1lc3RhbXApLAotCQlTVUJURVNUKGxpdmVfbHJjX2dhcmJhZ2UpLAotCQlT
VUJURVNUKGxpdmVfcHBod3NwX3J1bnRpbWUpLAotCQlTVUJURVNUKGxpdmVfbHJjX2luZGlyZWN0
X2N0eF9iYiksCi0JfTsKLQotCWlmICghSEFTX0xPR0lDQUxfUklOR19DT05URVhUUyhpOTE1KSkK
LQkJcmV0dXJuIDA7Ci0KLQlyZXR1cm4gaW50ZWxfZ3RfbGl2ZV9zdWJ0ZXN0cyh0ZXN0cywgJmk5
MTUtPmd0KTsKLX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0
X2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKbmV3IGZpbGUg
bW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi41Nzc0NjI2ZDNkMzQKLS0tIC9kZXYvbnVs
bAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwpAQCAtMCwwICsx
LDE4NjUgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKKy8qCisgKiBDb3B5cmln
aHQgwqkgMjAxOCBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpbmNsdWRlIDxsaW51eC9wcmlt
ZV9udW1iZXJzLmg+CisKKyNpbmNsdWRlICJndC9pbnRlbF9lbmdpbmVfaGVhcnRiZWF0LmgiCisj
aW5jbHVkZSAiZ3QvaW50ZWxfZW5naW5lX3BtLmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfcmVzZXQu
aCIKKyNpbmNsdWRlICJndC9pbnRlbF9yaW5nLmgiCisjaW5jbHVkZSAiZ3Qvc2VsZnRlc3RfZW5n
aW5lX2hlYXJ0YmVhdC5oIgorI2luY2x1ZGUgImd0L3NobWVtX3V0aWxzLmgiCisKKyNpbmNsdWRl
ICJpOTE1X3NlbGZ0ZXN0LmgiCisjaW5jbHVkZSAic2VsZnRlc3RzL2k5MTVfcmFuZG9tLmgiCisj
aW5jbHVkZSAic2VsZnRlc3RzL2lndF9mbHVzaF90ZXN0LmgiCisjaW5jbHVkZSAic2VsZnRlc3Rz
L2lndF9saXZlX3Rlc3QuaCIKKyNpbmNsdWRlICJzZWxmdGVzdHMvaWd0X3NwaW5uZXIuaCIKKyNp
bmNsdWRlICJzZWxmdGVzdHMvbGliX3N3X2ZlbmNlLmgiCisKKyNpbmNsdWRlICJnZW0vc2VsZnRl
c3RzL2lndF9nZW1fdXRpbHMuaCIKKyNpbmNsdWRlICJnZW0vc2VsZnRlc3RzL21vY2tfY29udGV4
dC5oIgorCisjZGVmaW5lIENTX0dQUihlbmdpbmUsIG4pICgoZW5naW5lKS0+bW1pb19iYXNlICsg
MHg2MDAgKyAobikgKiA0KQorI2RlZmluZSBOVU1fR1BSIDE2CisjZGVmaW5lIE5VTV9HUFJfRFcg
KE5VTV9HUFIgKiAyKSAvKiBlYWNoIEdQUiBpcyAyIGR3b3JkcyAqLworCitzdGF0aWMgc3RydWN0
IGk5MTVfdm1hICpjcmVhdGVfc2NyYXRjaChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQoreworCXN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CisJc3RydWN0IGk5MTVfdm1hICp2bWE7CisJaW50
IGVycjsKKworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoZ3QtPmk5MTUs
IFBBR0VfU0laRSk7CisJaWYgKElTX0VSUihvYmopKQorCQlyZXR1cm4gRVJSX0NBU1Qob2JqKTsK
KworCWk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVfY29oZXJlbmN5KG9iaiwgSTkxNV9DQUNISU5H
X0NBQ0hFRCk7CisKKwl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosICZndC0+Z2d0dC0+dm0s
IE5VTEwpOworCWlmIChJU19FUlIodm1hKSkgeworCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7
CisJCXJldHVybiB2bWE7CisJfQorCisJZXJyID0gaTkxNV92bWFfcGluKHZtYSwgMCwgMCwgUElO
X0dMT0JBTCk7CisJaWYgKGVycikgeworCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CisJCXJl
dHVybiBFUlJfUFRSKGVycik7CisJfQorCisJcmV0dXJuIHZtYTsKK30KKworc3RhdGljIGJvb2wg
aXNfYWN0aXZlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQoreworCWlmIChpOTE1X3JlcXVlc3Rf
aXNfYWN0aXZlKHJxKSkKKwkJcmV0dXJuIHRydWU7CisKKwlpZiAoaTkxNV9yZXF1ZXN0X29uX2hv
bGQocnEpKQorCQlyZXR1cm4gdHJ1ZTsKKworCWlmIChpOTE1X3JlcXVlc3RfaGFzX2luaXRpYWxf
YnJlYWRjcnVtYihycSkgJiYgaTkxNV9yZXF1ZXN0X3N0YXJ0ZWQocnEpKQorCQlyZXR1cm4gdHJ1
ZTsKKworCXJldHVybiBmYWxzZTsKK30KKworc3RhdGljIGludCB3YWl0X2Zvcl9zdWJtaXQoc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAorCQkJICAgc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnEsCisJCQkgICB1bnNpZ25lZCBsb25nIHRpbWVvdXQpCit7CisJdGltZW91dCArPSBqaWZmaWVz
OworCWRvIHsKKwkJYm9vbCBkb25lID0gdGltZV9hZnRlcihqaWZmaWVzLCB0aW1lb3V0KTsKKwor
CQlpZiAoaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChycSkpIC8qIHRoYXQgd2FzIHF1aWNrISAqLwor
CQkJcmV0dXJuIDA7CisKKwkJLyogV2FpdCB1bnRpbCB0aGUgSFcgaGFzIGFja25vd2xlZ2VkIHRo
ZSBzdWJtaXNzaW9uIChvciBlcnIpICovCisJCWludGVsX2VuZ2luZV9mbHVzaF9zdWJtaXNzaW9u
KGVuZ2luZSk7CisJCWlmICghUkVBRF9PTkNFKGVuZ2luZS0+ZXhlY2xpc3RzLnBlbmRpbmdbMF0p
ICYmIGlzX2FjdGl2ZShycSkpCisJCQlyZXR1cm4gMDsKKworCQlpZiAoZG9uZSkKKwkJCXJldHVy
biAtRVRJTUU7CisKKwkJY29uZF9yZXNjaGVkKCk7CisJfSB3aGlsZSAoMSk7Cit9CisKK3N0YXRp
YyBpbnQgZW1pdF9zZW1hcGhvcmVfc2lnbmFsKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgdm9p
ZCAqc2xvdCkKK3sKKwljb25zdCB1MzIgb2Zmc2V0ID0KKwkJaTkxNV9nZ3R0X29mZnNldChjZS0+
ZW5naW5lLT5zdGF0dXNfcGFnZS52bWEpICsKKwkJb2Zmc2V0X2luX3BhZ2Uoc2xvdCk7CisJc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJdTMyICpjczsKKworCXJxID0gaW50ZWxfY29udGV4dF9j
cmVhdGVfcmVxdWVzdChjZSk7CisJaWYgKElTX0VSUihycSkpCisJCXJldHVybiBQVFJfRVJSKHJx
KTsKKworCWNzID0gaW50ZWxfcmluZ19iZWdpbihycSwgNCk7CisJaWYgKElTX0VSUihjcykpIHsK
KwkJaTkxNV9yZXF1ZXN0X2FkZChycSk7CisJCXJldHVybiBQVFJfRVJSKGNzKTsKKwl9CisKKwkq
Y3MrKyA9IE1JX1NUT1JFX0RXT1JEX0lNTV9HRU40IHwgTUlfVVNFX0dHVFQ7CisJKmNzKysgPSBv
ZmZzZXQ7CisJKmNzKysgPSAwOworCSpjcysrID0gMTsKKworCWludGVsX3JpbmdfYWR2YW5jZShy
cSwgY3MpOworCisJcnEtPnNjaGVkLmF0dHIucHJpb3JpdHkgPSBJOTE1X1BSSU9SSVRZX0JBUlJJ
RVI7CisJaTkxNV9yZXF1ZXN0X2FkZChycSk7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQg
Y29udGV4dF9mbHVzaChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIGxvbmcgdGltZW91dCkKK3sK
KwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKKwlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKKwlp
bnQgZXJyID0gMDsKKworCXJxID0gaW50ZWxfZW5naW5lX2NyZWF0ZV9rZXJuZWxfcmVxdWVzdChj
ZS0+ZW5naW5lKTsKKwlpZiAoSVNfRVJSKHJxKSkKKwkJcmV0dXJuIFBUUl9FUlIocnEpOworCisJ
ZmVuY2UgPSBpOTE1X2FjdGl2ZV9mZW5jZV9nZXQoJmNlLT50aW1lbGluZS0+bGFzdF9yZXF1ZXN0
KTsKKwlpZiAoZmVuY2UpIHsKKwkJaTkxNV9yZXF1ZXN0X2F3YWl0X2RtYV9mZW5jZShycSwgZmVu
Y2UpOworCQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKKwl9CisKKwlycSA9IGk5MTVfcmVxdWVzdF9n
ZXQocnEpOworCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChy
cSwgMCwgdGltZW91dCkgPCAwKQorCQllcnIgPSAtRVRJTUU7CisJaTkxNV9yZXF1ZXN0X3B1dChy
cSk7CisKKwlybWIoKTsgLyogV2Uga25vdyB0aGUgcmVxdWVzdCBpcyB3cml0dGVuLCBtYWtlIHN1
cmUgYWxsIHN0YXRlIGlzIHRvbyEgKi8KKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgaW50IGxp
dmVfbHJjX2xheW91dCh2b2lkICphcmcpCit7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsK
KwlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CisJZW51bSBpbnRlbF9lbmdpbmVfaWQg
aWQ7CisJdTMyICpscmM7CisJaW50IGVycjsKKworCS8qCisJICogQ2hlY2sgdGhlIHJlZ2lzdGVy
cyBvZmZzZXRzIHdlIHVzZSB0byBjcmVhdGUgdGhlIGluaXRpYWwgcmVnIHN0YXRlCisJICogbWF0
Y2ggdGhlIGxheW91dCBzYXZlZCBieSBIVy4KKwkgKi8KKworCWxyYyA9IGttYWxsb2MoUEFHRV9T
SVpFLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWxyYykKKwkJcmV0dXJuIC1FTk9NRU07CisKKwllcnIg
PSAwOworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgeworCQl1MzIgKmh3OworCQlp
bnQgZHc7CisKKwkJaWYgKCFlbmdpbmUtPmRlZmF1bHRfc3RhdGUpCisJCQljb250aW51ZTsKKwor
CQlodyA9IHNobWVtX3Bpbl9tYXAoZW5naW5lLT5kZWZhdWx0X3N0YXRlKTsKKwkJaWYgKElTX0VS
UihodykpIHsKKwkJCWVyciA9IFBUUl9FUlIoaHcpOworCQkJYnJlYWs7CisJCX0KKwkJaHcgKz0g
TFJDX1NUQVRFX09GRlNFVCAvIHNpemVvZigqaHcpOworCisJCV9fbHJjX2luaXRfcmVncyhtZW1z
ZXQobHJjLCBQT0lTT05fSU5VU0UsIFBBR0VfU0laRSksCisJCQkJZW5naW5lLT5rZXJuZWxfY29u
dGV4dCwKKwkJCQllbmdpbmUsCisJCQkJZW5naW5lLT5rZXJuZWxfY29udGV4dC0+cmluZywKKwkJ
CQl0cnVlKTsKKworCQlkdyA9IDA7CisJCWRvIHsKKwkJCXUzMiBscmkgPSBod1tkd107CisKKwkJ
CWlmIChscmkgPT0gMCkgeworCQkJCWR3Kys7CisJCQkJY29udGludWU7CisJCQl9CisKKwkJCWlm
IChscmNbZHddID09IDApIHsKKwkJCQlwcl9kZWJ1ZygiJXM6IHNraXBwZWQgaW5zdHJ1Y3Rpb24g
JXggYXQgZHdvcmQgJWRcbiIsCisJCQkJCSBlbmdpbmUtPm5hbWUsIGxyaSwgZHcpOworCQkJCWR3
Kys7CisJCQkJY29udGludWU7CisJCQl9CisKKwkJCWlmICgobHJpICYgR0VOTUFTSygzMSwgMjMp
KSAhPSBNSV9JTlNUUigweDIyLCAwKSkgeworCQkJCXByX2VycigiJXM6IEV4cGVjdGVkIExSSSBj
b21tYW5kIGF0IGR3b3JkICVkLCBmb3VuZCAlMDh4XG4iLAorCQkJCSAgICAgICBlbmdpbmUtPm5h
bWUsIGR3LCBscmkpOworCQkJCWVyciA9IC1FSU5WQUw7CisJCQkJYnJlYWs7CisJCQl9CisKKwkJ
CWlmIChscmNbZHddICE9IGxyaSkgeworCQkJCXByX2VycigiJXM6IExSSSBjb21tYW5kIG1pc21h
dGNoIGF0IGR3b3JkICVkLCBleHBlY3RlZCAlMDh4IGZvdW5kICUwOHhcbiIsCisJCQkJICAgICAg
IGVuZ2luZS0+bmFtZSwgZHcsIGxyaSwgbHJjW2R3XSk7CisJCQkJZXJyID0gLUVJTlZBTDsKKwkJ
CQlicmVhazsKKwkJCX0KKworCQkJbHJpICY9IDB4N2Y7CisJCQlscmkrKzsKKwkJCWR3Kys7CisK
KwkJCXdoaWxlIChscmkpIHsKKwkJCQlpZiAoaHdbZHddICE9IGxyY1tkd10pIHsKKwkJCQkJcHJf
ZXJyKCIlczogRGlmZmVyZW50IHJlZ2lzdGVycyBmb3VuZCBhdCBkd29yZCAlZCwgZXhwZWN0ZWQg
JXgsIGZvdW5kICV4XG4iLAorCQkJCQkgICAgICAgZW5naW5lLT5uYW1lLCBkdywgaHdbZHddLCBs
cmNbZHddKTsKKwkJCQkJZXJyID0gLUVJTlZBTDsKKwkJCQkJYnJlYWs7CisJCQkJfQorCisJCQkJ
LyoKKwkJCQkgKiBTa2lwIG92ZXIgdGhlIGFjdHVhbCByZWdpc3RlciB2YWx1ZSBhcyB3ZQorCQkJ
CSAqIGV4cGVjdCB0aGF0IHRvIGRpZmZlci4KKwkJCQkgKi8KKwkJCQlkdyArPSAyOworCQkJCWxy
aSAtPSAyOworCQkJfQorCQl9IHdoaWxlICgobHJjW2R3XSAmIH5CSVQoMCkpICE9IE1JX0JBVENI
X0JVRkZFUl9FTkQpOworCisJCWlmIChlcnIpIHsKKwkJCXByX2luZm8oIiVzOiBIVyByZWdpc3Rl
ciBpbWFnZTpcbiIsIGVuZ2luZS0+bmFtZSk7CisJCQlpZ3RfaGV4ZHVtcChodywgUEFHRV9TSVpF
KTsKKworCQkJcHJfaW5mbygiJXM6IFNXIHJlZ2lzdGVyIGltYWdlOlxuIiwgZW5naW5lLT5uYW1l
KTsKKwkJCWlndF9oZXhkdW1wKGxyYywgUEFHRV9TSVpFKTsKKwkJfQorCisJCXNobWVtX3VucGlu
X21hcChlbmdpbmUtPmRlZmF1bHRfc3RhdGUsIGh3KTsKKwkJaWYgKGVycikKKwkJCWJyZWFrOwor
CX0KKworCWtmcmVlKGxyYyk7CisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIGludCBmaW5kX29m
ZnNldChjb25zdCB1MzIgKmxyaSwgdTMyIG9mZnNldCkKK3sKKwlpbnQgaTsKKworCWZvciAoaSA9
IDA7IGkgPCBQQUdFX1NJWkUgLyBzaXplb2YodTMyKTsgaSsrKQorCQlpZiAobHJpW2ldID09IG9m
ZnNldCkKKwkJCXJldHVybiBpOworCisJcmV0dXJuIC0xOworfQorCitzdGF0aWMgaW50IGxpdmVf
bHJjX2ZpeGVkKHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOworCXN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKKwllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsK
KwlpbnQgZXJyID0gMDsKKworCS8qCisJICogQ2hlY2sgdGhlIGFzc3VtZWQgcmVnaXN0ZXIgb2Zm
c2V0cyBtYXRjaCB0aGUgYWN0dWFsIGxvY2F0aW9ucyBpbgorCSAqIHRoZSBjb250ZXh0IGltYWdl
LgorCSAqLworCisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7CisJCWNvbnN0IHN0
cnVjdCB7CisJCQl1MzIgcmVnOworCQkJdTMyIG9mZnNldDsKKwkJCWNvbnN0IGNoYXIgKm5hbWU7
CisJCX0gdGJsW10gPSB7CisJCQl7CisJCQkJaTkxNV9tbWlvX3JlZ19vZmZzZXQoUklOR19TVEFS
VChlbmdpbmUtPm1taW9fYmFzZSkpLAorCQkJCUNUWF9SSU5HX1NUQVJUIC0gMSwKKwkJCQkiUklO
R19TVEFSVCIKKwkJCX0sCisJCQl7CisJCQkJaTkxNV9tbWlvX3JlZ19vZmZzZXQoUklOR19DVEwo
ZW5naW5lLT5tbWlvX2Jhc2UpKSwKKwkJCQlDVFhfUklOR19DVEwgLSAxLAorCQkJCSJSSU5HX0NU
TCIKKwkJCX0sCisJCQl7CisJCQkJaTkxNV9tbWlvX3JlZ19vZmZzZXQoUklOR19IRUFEKGVuZ2lu
ZS0+bW1pb19iYXNlKSksCisJCQkJQ1RYX1JJTkdfSEVBRCAtIDEsCisJCQkJIlJJTkdfSEVBRCIK
KwkJCX0sCisJCQl7CisJCQkJaTkxNV9tbWlvX3JlZ19vZmZzZXQoUklOR19UQUlMKGVuZ2luZS0+
bW1pb19iYXNlKSksCisJCQkJQ1RYX1JJTkdfVEFJTCAtIDEsCisJCQkJIlJJTkdfVEFJTCIKKwkJ
CX0sCisJCQl7CisJCQkJaTkxNV9tbWlvX3JlZ19vZmZzZXQoUklOR19NSV9NT0RFKGVuZ2luZS0+
bW1pb19iYXNlKSksCisJCQkJbHJjX3JpbmdfbWlfbW9kZShlbmdpbmUpLAorCQkJCSJSSU5HX01J
X01PREUiCisJCQl9LAorCQkJeworCQkJCWk5MTVfbW1pb19yZWdfb2Zmc2V0KFJJTkdfQkJTVEFU
RShlbmdpbmUtPm1taW9fYmFzZSkpLAorCQkJCUNUWF9CQl9TVEFURSAtIDEsCisJCQkJIkJCX1NU
QVRFIgorCQkJfSwKKwkJCXsKKwkJCQlpOTE1X21taW9fcmVnX29mZnNldChSSU5HX0JCX1BFUl9D
VFhfUFRSKGVuZ2luZS0+bW1pb19iYXNlKSksCisJCQkJbHJjX3Jpbmdfd2FfYmJfcGVyX2N0eChl
bmdpbmUpLAorCQkJCSJSSU5HX0JCX1BFUl9DVFhfUFRSIgorCQkJfSwKKwkJCXsKKwkJCQlpOTE1
X21taW9fcmVnX29mZnNldChSSU5HX0lORElSRUNUX0NUWChlbmdpbmUtPm1taW9fYmFzZSkpLAor
CQkJCWxyY19yaW5nX2luZGlyZWN0X3B0cihlbmdpbmUpLAorCQkJCSJSSU5HX0lORElSRUNUX0NU
WF9QVFIiCisJCQl9LAorCQkJeworCQkJCWk5MTVfbW1pb19yZWdfb2Zmc2V0KFJJTkdfSU5ESVJF
Q1RfQ1RYX09GRlNFVChlbmdpbmUtPm1taW9fYmFzZSkpLAorCQkJCWxyY19yaW5nX2luZGlyZWN0
X29mZnNldChlbmdpbmUpLAorCQkJCSJSSU5HX0lORElSRUNUX0NUWF9PRkZTRVQiCisJCQl9LAor
CQkJeworCQkJCWk5MTVfbW1pb19yZWdfb2Zmc2V0KFJJTkdfQ1RYX1RJTUVTVEFNUChlbmdpbmUt
Pm1taW9fYmFzZSkpLAorCQkJCUNUWF9USU1FU1RBTVAgLSAxLAorCQkJCSJSSU5HX0NUWF9USU1F
U1RBTVAiCisJCQl9LAorCQkJeworCQkJCWk5MTVfbW1pb19yZWdfb2Zmc2V0KEdFTjhfUklOR19D
U19HUFIoZW5naW5lLT5tbWlvX2Jhc2UsIDApKSwKKwkJCQlscmNfcmluZ19ncHIwKGVuZ2luZSks
CisJCQkJIlJJTkdfQ1NfR1BSMCIKKwkJCX0sCisJCQl7CisJCQkJaTkxNV9tbWlvX3JlZ19vZmZz
ZXQoUklOR19DTURfQlVGX0NDVEwoZW5naW5lLT5tbWlvX2Jhc2UpKSwKKwkJCQlscmNfcmluZ19j
bWRfYnVmX2NjdGwoZW5naW5lKSwKKwkJCQkiUklOR19DTURfQlVGX0NDVEwiCisJCQl9LAorCQkJ
eyB9LAorCQl9LCAqdDsKKwkJdTMyICpodzsKKworCQlpZiAoIWVuZ2luZS0+ZGVmYXVsdF9zdGF0
ZSkKKwkJCWNvbnRpbnVlOworCisJCWh3ID0gc2htZW1fcGluX21hcChlbmdpbmUtPmRlZmF1bHRf
c3RhdGUpOworCQlpZiAoSVNfRVJSKGh3KSkgeworCQkJZXJyID0gUFRSX0VSUihodyk7CisJCQli
cmVhazsKKwkJfQorCQlodyArPSBMUkNfU1RBVEVfT0ZGU0VUIC8gc2l6ZW9mKCpodyk7CisKKwkJ
Zm9yICh0ID0gdGJsOyB0LT5uYW1lOyB0KyspIHsKKwkJCWludCBkdyA9IGZpbmRfb2Zmc2V0KGh3
LCB0LT5yZWcpOworCisJCQlpZiAoZHcgIT0gdC0+b2Zmc2V0KSB7CisJCQkJcHJfZXJyKCIlczog
T2Zmc2V0IGZvciAlcyBbMHgleF0gbWlzbWF0Y2gsIGZvdW5kICV4LCBleHBlY3RlZCAleFxuIiwK
KwkJCQkgICAgICAgZW5naW5lLT5uYW1lLAorCQkJCSAgICAgICB0LT5uYW1lLAorCQkJCSAgICAg
ICB0LT5yZWcsCisJCQkJICAgICAgIGR3LAorCQkJCSAgICAgICB0LT5vZmZzZXQpOworCQkJCWVy
ciA9IC1FSU5WQUw7CisJCQl9CisJCX0KKworCQlzaG1lbV91bnBpbl9tYXAoZW5naW5lLT5kZWZh
dWx0X3N0YXRlLCBodyk7CisJfQorCisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIGludCBfX2xp
dmVfbHJjX3N0YXRlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKKwkJCSAgICBzdHJ1
Y3QgaTkxNV92bWEgKnNjcmF0Y2gpCit7CisJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOworCXN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCXN0cnVjdCBpOTE1X2dlbV93d19jdHggd3c7CisJZW51
bSB7CisJCVJJTkdfU1RBUlRfSURYID0gMCwKKwkJUklOR19UQUlMX0lEWCwKKwkJTUFYX0lEWAor
CX07CisJdTMyIGV4cGVjdGVkW01BWF9JRFhdOworCXUzMiAqY3M7CisJaW50IGVycjsKKwlpbnQg
bjsKKworCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKKwlpZiAoSVNfRVJSKGNl
KSkKKwkJcmV0dXJuIFBUUl9FUlIoY2UpOworCisJaTkxNV9nZW1fd3dfY3R4X2luaXQoJnd3LCBm
YWxzZSk7CityZXRyeToKKwllcnIgPSBpOTE1X2dlbV9vYmplY3RfbG9jayhzY3JhdGNoLT5vYmos
ICZ3dyk7CisJaWYgKCFlcnIpCisJCWVyciA9IGludGVsX2NvbnRleHRfcGluX3d3KGNlLCAmd3cp
OworCWlmIChlcnIpCisJCWdvdG8gZXJyX3B1dDsKKworCXJxID0gaTkxNV9yZXF1ZXN0X2NyZWF0
ZShjZSk7CisJaWYgKElTX0VSUihycSkpIHsKKwkJZXJyID0gUFRSX0VSUihycSk7CisJCWdvdG8g
ZXJyX3VucGluOworCX0KKworCWNzID0gaW50ZWxfcmluZ19iZWdpbihycSwgNCAqIE1BWF9JRFgp
OworCWlmIChJU19FUlIoY3MpKSB7CisJCWVyciA9IFBUUl9FUlIoY3MpOworCQlpOTE1X3JlcXVl
c3RfYWRkKHJxKTsKKwkJZ290byBlcnJfdW5waW47CisJfQorCisJKmNzKysgPSBNSV9TVE9SRV9S
RUdJU1RFUl9NRU1fR0VOOCB8IE1JX1VTRV9HR1RUOworCSpjcysrID0gaTkxNV9tbWlvX3JlZ19v
ZmZzZXQoUklOR19TVEFSVChlbmdpbmUtPm1taW9fYmFzZSkpOworCSpjcysrID0gaTkxNV9nZ3R0
X29mZnNldChzY3JhdGNoKSArIFJJTkdfU1RBUlRfSURYICogc2l6ZW9mKHUzMik7CisJKmNzKysg
PSAwOworCisJZXhwZWN0ZWRbUklOR19TVEFSVF9JRFhdID0gaTkxNV9nZ3R0X29mZnNldChjZS0+
cmluZy0+dm1hKTsKKworCSpjcysrID0gTUlfU1RPUkVfUkVHSVNURVJfTUVNX0dFTjggfCBNSV9V
U0VfR0dUVDsKKwkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KFJJTkdfVEFJTChlbmdpbmUt
Pm1taW9fYmFzZSkpOworCSpjcysrID0gaTkxNV9nZ3R0X29mZnNldChzY3JhdGNoKSArIFJJTkdf
VEFJTF9JRFggKiBzaXplb2YodTMyKTsKKwkqY3MrKyA9IDA7CisKKwllcnIgPSBpOTE1X3JlcXVl
c3RfYXdhaXRfb2JqZWN0KHJxLCBzY3JhdGNoLT5vYmosIHRydWUpOworCWlmICghZXJyKQorCQll
cnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShzY3JhdGNoLCBycSwgRVhFQ19PQkpFQ1RfV1JJ
VEUpOworCisJaTkxNV9yZXF1ZXN0X2dldChycSk7CisJaTkxNV9yZXF1ZXN0X2FkZChycSk7CisJ
aWYgKGVycikKKwkJZ290byBlcnJfcnE7CisKKwlpbnRlbF9lbmdpbmVfZmx1c2hfc3VibWlzc2lv
bihlbmdpbmUpOworCWV4cGVjdGVkW1JJTkdfVEFJTF9JRFhdID0gY2UtPnJpbmctPnRhaWw7CisK
KwlpZiAoaTkxNV9yZXF1ZXN0X3dhaXQocnEsIDAsIEhaIC8gNSkgPCAwKSB7CisJCWVyciA9IC1F
VElNRTsKKwkJZ290byBlcnJfcnE7CisJfQorCisJY3MgPSBpOTE1X2dlbV9vYmplY3RfcGluX21h
cChzY3JhdGNoLT5vYmosIEk5MTVfTUFQX1dCKTsKKwlpZiAoSVNfRVJSKGNzKSkgeworCQllcnIg
PSBQVFJfRVJSKGNzKTsKKwkJZ290byBlcnJfcnE7CisJfQorCisJZm9yIChuID0gMDsgbiA8IE1B
WF9JRFg7IG4rKykgeworCQlpZiAoY3Nbbl0gIT0gZXhwZWN0ZWRbbl0pIHsKKwkJCXByX2Vycigi
JXM6IFN0b3JlZCByZWdpc3RlclslZF0gdmFsdWVbMHgleF0gZGlkIG5vdCBtYXRjaCBleHBlY3Rl
ZFsweCV4XVxuIiwKKwkJCSAgICAgICBlbmdpbmUtPm5hbWUsIG4sIGNzW25dLCBleHBlY3RlZFtu
XSk7CisJCQllcnIgPSAtRUlOVkFMOworCQkJYnJlYWs7CisJCX0KKwl9CisKKwlpOTE1X2dlbV9v
YmplY3RfdW5waW5fbWFwKHNjcmF0Y2gtPm9iaik7CisKK2Vycl9ycToKKwlpOTE1X3JlcXVlc3Rf
cHV0KHJxKTsKK2Vycl91bnBpbjoKKwlpbnRlbF9jb250ZXh0X3VucGluKGNlKTsKK2Vycl9wdXQ6
CisJaWYgKGVyciA9PSAtRURFQURMSykgeworCQllcnIgPSBpOTE1X2dlbV93d19jdHhfYmFja29m
Zigmd3cpOworCQlpZiAoIWVycikKKwkJCWdvdG8gcmV0cnk7CisJfQorCWk5MTVfZ2VtX3d3X2N0
eF9maW5pKCZ3dyk7CisJaW50ZWxfY29udGV4dF9wdXQoY2UpOworCXJldHVybiBlcnI7Cit9CisK
K3N0YXRpYyBpbnQgbGl2ZV9scmNfc3RhdGUodm9pZCAqYXJnKQoreworCXN0cnVjdCBpbnRlbF9n
dCAqZ3QgPSBhcmc7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOworCXN0cnVjdCBp
OTE1X3ZtYSAqc2NyYXRjaDsKKwllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKKwlpbnQgZXJyID0g
MDsKKworCS8qCisJICogQ2hlY2sgdGhlIGxpdmUgcmVnaXN0ZXIgc3RhdGUgbWF0Y2hlcyB3aGF0
IHdlIGV4cGVjdCBmb3IgdGhpcworCSAqIGludGVsX2NvbnRleHQuCisJICovCisKKwlzY3JhdGNo
ID0gY3JlYXRlX3NjcmF0Y2goZ3QpOworCWlmIChJU19FUlIoc2NyYXRjaCkpCisJCXJldHVybiBQ
VFJfRVJSKHNjcmF0Y2gpOworCisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7CisJ
CWVyciA9IF9fbGl2ZV9scmNfc3RhdGUoZW5naW5lLCBzY3JhdGNoKTsKKwkJaWYgKGVycikKKwkJ
CWJyZWFrOworCX0KKworCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpCisJCWVyciA9IC1F
SU87CisKKwlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmc2NyYXRjaCwgMCk7CisJcmV0dXJu
IGVycjsKK30KKworc3RhdGljIGludCBncHJfbWFrZV9kaXJ0eShzdHJ1Y3QgaW50ZWxfY29udGV4
dCAqY2UpCit7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJdTMyICpjczsKKwlpbnQgbjsK
KworCXJxID0gaW50ZWxfY29udGV4dF9jcmVhdGVfcmVxdWVzdChjZSk7CisJaWYgKElTX0VSUihy
cSkpCisJCXJldHVybiBQVFJfRVJSKHJxKTsKKworCWNzID0gaW50ZWxfcmluZ19iZWdpbihycSwg
MiAqIE5VTV9HUFJfRFcgKyAyKTsKKwlpZiAoSVNfRVJSKGNzKSkgeworCQlpOTE1X3JlcXVlc3Rf
YWRkKHJxKTsKKwkJcmV0dXJuIFBUUl9FUlIoY3MpOworCX0KKworCSpjcysrID0gTUlfTE9BRF9S
RUdJU1RFUl9JTU0oTlVNX0dQUl9EVyk7CisJZm9yIChuID0gMDsgbiA8IE5VTV9HUFJfRFc7IG4r
KykgeworCQkqY3MrKyA9IENTX0dQUihjZS0+ZW5naW5lLCBuKTsKKwkJKmNzKysgPSBTVEFDS19N
QUdJQzsKKwl9CisJKmNzKysgPSBNSV9OT09QOworCisJaW50ZWxfcmluZ19hZHZhbmNlKHJxLCBj
cyk7CisKKwlycS0+c2NoZWQuYXR0ci5wcmlvcml0eSA9IEk5MTVfUFJJT1JJVFlfQkFSUklFUjsK
KwlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgc3RydWN0
IGk5MTVfcmVxdWVzdCAqCitfX2dwcl9yZWFkKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgc3Ry
dWN0IGk5MTVfdm1hICpzY3JhdGNoLCB1MzIgKnNsb3QpCit7CisJY29uc3QgdTMyIG9mZnNldCA9
CisJCWk5MTVfZ2d0dF9vZmZzZXQoY2UtPmVuZ2luZS0+c3RhdHVzX3BhZ2Uudm1hKSArCisJCW9m
ZnNldF9pbl9wYWdlKHNsb3QpOworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCXUzMiAqY3M7
CisJaW50IGVycjsKKwlpbnQgbjsKKworCXJxID0gaW50ZWxfY29udGV4dF9jcmVhdGVfcmVxdWVz
dChjZSk7CisJaWYgKElTX0VSUihycSkpCisJCXJldHVybiBycTsKKworCWNzID0gaW50ZWxfcmlu
Z19iZWdpbihycSwgNiArIDQgKiBOVU1fR1BSX0RXKTsKKwlpZiAoSVNfRVJSKGNzKSkgeworCQlp
OTE1X3JlcXVlc3RfYWRkKHJxKTsKKwkJcmV0dXJuIEVSUl9DQVNUKGNzKTsKKwl9CisKKwkqY3Mr
KyA9IE1JX0FSQl9PTl9PRkYgfCBNSV9BUkJfRU5BQkxFOworCSpjcysrID0gTUlfTk9PUDsKKwor
CSpjcysrID0gTUlfU0VNQVBIT1JFX1dBSVQgfAorCQlNSV9TRU1BUEhPUkVfR0xPQkFMX0dUVCB8
CisJCU1JX1NFTUFQSE9SRV9QT0xMIHwKKwkJTUlfU0VNQVBIT1JFX1NBRF9ORVFfU0REOworCSpj
cysrID0gMDsKKwkqY3MrKyA9IG9mZnNldDsKKwkqY3MrKyA9IDA7CisKKwlmb3IgKG4gPSAwOyBu
IDwgTlVNX0dQUl9EVzsgbisrKSB7CisJCSpjcysrID0gTUlfU1RPUkVfUkVHSVNURVJfTUVNX0dF
TjggfCBNSV9VU0VfR0dUVDsKKwkJKmNzKysgPSBDU19HUFIoY2UtPmVuZ2luZSwgbik7CisJCSpj
cysrID0gaTkxNV9nZ3R0X29mZnNldChzY3JhdGNoKSArIG4gKiBzaXplb2YodTMyKTsKKwkJKmNz
KysgPSAwOworCX0KKworCWk5MTVfdm1hX2xvY2soc2NyYXRjaCk7CisJZXJyID0gaTkxNV9yZXF1
ZXN0X2F3YWl0X29iamVjdChycSwgc2NyYXRjaC0+b2JqLCB0cnVlKTsKKwlpZiAoIWVycikKKwkJ
ZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3RpdmUoc2NyYXRjaCwgcnEsIEVYRUNfT0JKRUNUX1dS
SVRFKTsKKwlpOTE1X3ZtYV91bmxvY2soc2NyYXRjaCk7CisKKwlpOTE1X3JlcXVlc3RfZ2V0KHJx
KTsKKwlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKwlpZiAoZXJyKSB7CisJCWk5MTVfcmVxdWVzdF9w
dXQocnEpOworCQlycSA9IEVSUl9QVFIoZXJyKTsKKwl9CisKKwlyZXR1cm4gcnE7Cit9CisKK3N0
YXRpYyBpbnQgX19saXZlX2xyY19ncHIoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAor
CQkJICBzdHJ1Y3QgaTkxNV92bWEgKnNjcmF0Y2gsCisJCQkgIGJvb2wgcHJlZW1wdCkKK3sKKwl1
MzIgKnNsb3QgPSBtZW1zZXQzMihlbmdpbmUtPnN0YXR1c19wYWdlLmFkZHIgKyAxMDAwLCAwLCA0
KTsKKwlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7
CisJdTMyICpjczsKKwlpbnQgZXJyOworCWludCBuOworCisJaWYgKElOVEVMX0dFTihlbmdpbmUt
Pmk5MTUpIDwgOSAmJiBlbmdpbmUtPmNsYXNzICE9IFJFTkRFUl9DTEFTUykKKwkJcmV0dXJuIDA7
IC8qIEdQUiBvbmx5IG9uIHJjczAgZm9yIGdlbjggKi8KKworCWVyciA9IGdwcl9tYWtlX2RpcnR5
KGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwlj
ZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7CisJaWYgKElTX0VSUihjZSkpCisJCXJl
dHVybiBQVFJfRVJSKGNlKTsKKworCXJxID0gX19ncHJfcmVhZChjZSwgc2NyYXRjaCwgc2xvdCk7
CisJaWYgKElTX0VSUihycSkpIHsKKwkJZXJyID0gUFRSX0VSUihycSk7CisJCWdvdG8gZXJyX3B1
dDsKKwl9CisKKwllcnIgPSB3YWl0X2Zvcl9zdWJtaXQoZW5naW5lLCBycSwgSFogLyAyKTsKKwlp
ZiAoZXJyKQorCQlnb3RvIGVycl9ycTsKKworCWlmIChwcmVlbXB0KSB7CisJCWVyciA9IGdwcl9t
YWtlX2RpcnR5KGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOworCQlpZiAoZXJyKQorCQkJZ290byBl
cnJfcnE7CisKKwkJZXJyID0gZW1pdF9zZW1hcGhvcmVfc2lnbmFsKGVuZ2luZS0+a2VybmVsX2Nv
bnRleHQsIHNsb3QpOworCQlpZiAoZXJyKQorCQkJZ290byBlcnJfcnE7CisJfSBlbHNlIHsKKwkJ
c2xvdFswXSA9IDE7CisJCXdtYigpOworCX0KKworCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChycSwg
MCwgSFogLyA1KSA8IDApIHsKKwkJZXJyID0gLUVUSU1FOworCQlnb3RvIGVycl9ycTsKKwl9CisK
KwljcyA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKHNjcmF0Y2gtPm9iaiwgSTkxNV9NQVBfV0Ip
OworCWlmIChJU19FUlIoY3MpKSB7CisJCWVyciA9IFBUUl9FUlIoY3MpOworCQlnb3RvIGVycl9y
cTsKKwl9CisKKwlmb3IgKG4gPSAwOyBuIDwgTlVNX0dQUl9EVzsgbisrKSB7CisJCWlmIChjc1tu
XSkgeworCQkJcHJfZXJyKCIlczogR1BSWyVkXS4lcyB3YXMgbm90IHplcm8sIGZvdW5kIDB4JTA4
eCFcbiIsCisJCQkgICAgICAgZW5naW5lLT5uYW1lLAorCQkJICAgICAgIG4gLyAyLCBuICYgMSA/
ICJ1ZHciIDogImxkdyIsCisJCQkgICAgICAgY3Nbbl0pOworCQkJZXJyID0gLUVJTlZBTDsKKwkJ
CWJyZWFrOworCQl9CisJfQorCisJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChzY3JhdGNoLT5v
YmopOworCitlcnJfcnE6CisJbWVtc2V0MzIoJnNsb3RbMF0sIC0xLCA0KTsKKwl3bWIoKTsKKwlp
OTE1X3JlcXVlc3RfcHV0KHJxKTsKK2Vycl9wdXQ6CisJaW50ZWxfY29udGV4dF9wdXQoY2UpOwor
CXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQgbGl2ZV9scmNfZ3ByKHZvaWQgKmFyZykKK3sK
KwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZTsKKwlzdHJ1Y3QgaTkxNV92bWEgKnNjcmF0Y2g7CisJZW51bSBpbnRlbF9lbmdpbmVfaWQg
aWQ7CisJaW50IGVyciA9IDA7CisKKwkvKgorCSAqIENoZWNrIHRoYXQgR1BSIHJlZ2lzdGVycyBh
cmUgY2xlYXJlZCBpbiBuZXcgY29udGV4dHMgYXMgd2UgbmVlZAorCSAqIHRvIGF2b2lkIGxlYWtp
bmcgYW55IGluZm9ybWF0aW9uIGZyb20gcHJldmlvdXMgY29udGV4dHMuCisJICovCisKKwlzY3Jh
dGNoID0gY3JlYXRlX3NjcmF0Y2goZ3QpOworCWlmIChJU19FUlIoc2NyYXRjaCkpCisJCXJldHVy
biBQVFJfRVJSKHNjcmF0Y2gpOworCisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7
CisJCXN0X2VuZ2luZV9oZWFydGJlYXRfZGlzYWJsZShlbmdpbmUpOworCisJCWVyciA9IF9fbGl2
ZV9scmNfZ3ByKGVuZ2luZSwgc2NyYXRjaCwgZmFsc2UpOworCQlpZiAoZXJyKQorCQkJZ290byBl
cnI7CisKKwkJZXJyID0gX19saXZlX2xyY19ncHIoZW5naW5lLCBzY3JhdGNoLCB0cnVlKTsKKwkJ
aWYgKGVycikKKwkJCWdvdG8gZXJyOworCitlcnI6CisJCXN0X2VuZ2luZV9oZWFydGJlYXRfZW5h
YmxlKGVuZ2luZSk7CisJCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpCisJCQllcnIgPSAt
RUlPOworCQlpZiAoZXJyKQorCQkJYnJlYWs7CisJfQorCisJaTkxNV92bWFfdW5waW5fYW5kX3Jl
bGVhc2UoJnNjcmF0Y2gsIDApOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICoKK2NyZWF0ZV90aW1lc3RhbXAoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCB2
b2lkICpzbG90LCBpbnQgaWR4KQoreworCWNvbnN0IHUzMiBvZmZzZXQgPQorCQlpOTE1X2dndHRf
b2Zmc2V0KGNlLT5lbmdpbmUtPnN0YXR1c19wYWdlLnZtYSkgKworCQlvZmZzZXRfaW5fcGFnZShz
bG90KTsKKwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKKwl1MzIgKmNzOworCWludCBlcnI7CisK
KwlycSA9IGludGVsX2NvbnRleHRfY3JlYXRlX3JlcXVlc3QoY2UpOworCWlmIChJU19FUlIocnEp
KQorCQlyZXR1cm4gcnE7CisKKwljcyA9IGludGVsX3JpbmdfYmVnaW4ocnEsIDEwKTsKKwlpZiAo
SVNfRVJSKGNzKSkgeworCQllcnIgPSBQVFJfRVJSKGNzKTsKKwkJZ290byBlcnI7CisJfQorCisJ
KmNzKysgPSBNSV9BUkJfT05fT0ZGIHwgTUlfQVJCX0VOQUJMRTsKKwkqY3MrKyA9IE1JX05PT1A7
CisKKwkqY3MrKyA9IE1JX1NFTUFQSE9SRV9XQUlUIHwKKwkJTUlfU0VNQVBIT1JFX0dMT0JBTF9H
VFQgfAorCQlNSV9TRU1BUEhPUkVfUE9MTCB8CisJCU1JX1NFTUFQSE9SRV9TQURfTkVRX1NERDsK
KwkqY3MrKyA9IDA7CisJKmNzKysgPSBvZmZzZXQ7CisJKmNzKysgPSAwOworCisJKmNzKysgPSBN
SV9TVE9SRV9SRUdJU1RFUl9NRU1fR0VOOCB8IE1JX1VTRV9HR1RUOworCSpjcysrID0gaTkxNV9t
bWlvX3JlZ19vZmZzZXQoUklOR19DVFhfVElNRVNUQU1QKHJxLT5lbmdpbmUtPm1taW9fYmFzZSkp
OworCSpjcysrID0gb2Zmc2V0ICsgaWR4ICogc2l6ZW9mKHUzMik7CisJKmNzKysgPSAwOworCisJ
aW50ZWxfcmluZ19hZHZhbmNlKHJxLCBjcyk7CisKKwlycS0+c2NoZWQuYXR0ci5wcmlvcml0eSA9
IEk5MTVfUFJJT1JJVFlfTUFTSzsKKwllcnIgPSAwOworZXJyOgorCWk5MTVfcmVxdWVzdF9nZXQo
cnEpOworCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCWlmIChlcnIpIHsKKwkJaTkxNV9yZXF1ZXN0
X3B1dChycSk7CisJCXJldHVybiBFUlJfUFRSKGVycik7CisJfQorCisJcmV0dXJuIHJxOworfQor
CitzdHJ1Y3QgbHJjX3RpbWVzdGFtcCB7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5l
OworCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZVsyXTsKKwl1MzIgcG9pc29uOworfTsKKworc3Rh
dGljIGJvb2wgdGltZXN0YW1wX2FkdmFuY2VkKHUzMiBzdGFydCwgdTMyIGVuZCkKK3sKKwlyZXR1
cm4gKHMzMikoZW5kIC0gc3RhcnQpID4gMDsKK30KKworc3RhdGljIGludCBfX2xyY190aW1lc3Rh
bXAoY29uc3Qgc3RydWN0IGxyY190aW1lc3RhbXAgKmFyZywgYm9vbCBwcmVlbXB0KQoreworCXUz
MiAqc2xvdCA9IG1lbXNldDMyKGFyZy0+ZW5naW5lLT5zdGF0dXNfcGFnZS5hZGRyICsgMTAwMCwg
MCwgNCk7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJdTMyIHRpbWVzdGFtcDsKKwlpbnQg
ZXJyID0gMDsKKworCWFyZy0+Y2VbMF0tPmxyY19yZWdfc3RhdGVbQ1RYX1RJTUVTVEFNUF0gPSBh
cmctPnBvaXNvbjsKKwlycSA9IGNyZWF0ZV90aW1lc3RhbXAoYXJnLT5jZVswXSwgc2xvdCwgMSk7
CisJaWYgKElTX0VSUihycSkpCisJCXJldHVybiBQVFJfRVJSKHJxKTsKKworCWVyciA9IHdhaXRf
Zm9yX3N1Ym1pdChycS0+ZW5naW5lLCBycSwgSFogLyAyKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVy
cjsKKworCWlmIChwcmVlbXB0KSB7CisJCWFyZy0+Y2VbMV0tPmxyY19yZWdfc3RhdGVbQ1RYX1RJ
TUVTVEFNUF0gPSAweGRlYWRiZWVmOworCQllcnIgPSBlbWl0X3NlbWFwaG9yZV9zaWduYWwoYXJn
LT5jZVsxXSwgc2xvdCk7CisJCWlmIChlcnIpCisJCQlnb3RvIGVycjsKKwl9IGVsc2UgeworCQlz
bG90WzBdID0gMTsKKwkJd21iKCk7CisJfQorCisJLyogQW5kIHdhaXQgZm9yIHN3aXRjaCB0byBr
ZXJuZWwgKHRvIHNhdmUgb3VyIGNvbnRleHQgdG8gbWVtb3J5KSAqLworCWVyciA9IGNvbnRleHRf
Zmx1c2goYXJnLT5jZVswXSwgSFogLyAyKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycjsKKworCWlm
ICghdGltZXN0YW1wX2FkdmFuY2VkKGFyZy0+cG9pc29uLCBzbG90WzFdKSkgeworCQlwcl9lcnIo
IiVzKCVzKTogaW52YWxpZCB0aW1lc3RhbXAgb24gcmVzdG9yZSwgY29udGV4dDoleCwgcmVxdWVz
dDoleFxuIiwKKwkJICAgICAgIGFyZy0+ZW5naW5lLT5uYW1lLCBwcmVlbXB0ID8gInByZWVtcHQi
IDogInNpbXBsZSIsCisJCSAgICAgICBhcmctPnBvaXNvbiwgc2xvdFsxXSk7CisJCWVyciA9IC1F
SU5WQUw7CisJfQorCisJdGltZXN0YW1wID0gUkVBRF9PTkNFKGFyZy0+Y2VbMF0tPmxyY19yZWdf
c3RhdGVbQ1RYX1RJTUVTVEFNUF0pOworCWlmICghdGltZXN0YW1wX2FkdmFuY2VkKHNsb3RbMV0s
IHRpbWVzdGFtcCkpIHsKKwkJcHJfZXJyKCIlcyglcyk6IGludmFsaWQgdGltZXN0YW1wIG9uIHNh
dmUsIHJlcXVlc3Q6JXgsIGNvbnRleHQ6JXhcbiIsCisJCSAgICAgICBhcmctPmVuZ2luZS0+bmFt
ZSwgcHJlZW1wdCA/ICJwcmVlbXB0IiA6ICJzaW1wbGUiLAorCQkgICAgICAgc2xvdFsxXSwgdGlt
ZXN0YW1wKTsKKwkJZXJyID0gLUVJTlZBTDsKKwl9CisKK2VycjoKKwltZW1zZXQzMihzbG90LCAt
MSwgNCk7CisJaTkxNV9yZXF1ZXN0X3B1dChycSk7CisJcmV0dXJuIGVycjsKK30KKworc3RhdGlj
IGludCBsaXZlX2xyY190aW1lc3RhbXAodm9pZCAqYXJnKQoreworCXN0cnVjdCBscmNfdGltZXN0
YW1wIGRhdGEgPSB7fTsKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOworCWVudW0gaW50ZWxf
ZW5naW5lX2lkIGlkOworCWNvbnN0IHUzMiBwb2lzb25bXSA9IHsKKwkJMCwKKwkJUzMyX01BWCwK
KwkJKHUzMilTMzJfTUFYICsgMSwKKwkJVTMyX01BWCwKKwl9OworCisJLyoKKwkgKiBXZSB3YW50
IHRvIHZlcmlmeSB0aGF0IHRoZSB0aW1lc3RhbXAgaXMgc2F2ZWQgYW5kIHJlc3RvcmUgYWNyb3Nz
CisJICogY29udGV4dCBzd2l0Y2hlcyBhbmQgaXMgbW9ub3RvbmljLgorCSAqCisJICogU28gd2Ug
ZG8gdGhpcyB3aXRoIGEgbGl0dGxlIGJpdCBvZiBMUkMgcG9pc29uaW5nIHRvIGNoZWNrIHZhcmlv
dXMKKwkgKiBib3VuZGFyeSBjb25kaXRpb25zLCBhbmQgc2VlIHdoYXQgaGFwcGVucyBpZiB3ZSBw
cmVlbXB0IHRoZSBjb250ZXh0CisJICogd2l0aCBhIHNlY29uZCByZXF1ZXN0IChjYXJyeWluZyBt
b3JlIHBvaXNvbiBpbnRvIHRoZSB0aW1lc3RhbXApLgorCSAqLworCisJZm9yX2VhY2hfZW5naW5l
KGRhdGEuZW5naW5lLCBndCwgaWQpIHsKKwkJaW50IGksIGVyciA9IDA7CisKKwkJc3RfZW5naW5l
X2hlYXJ0YmVhdF9kaXNhYmxlKGRhdGEuZW5naW5lKTsKKworCQlmb3IgKGkgPSAwOyBpIDwgQVJS
QVlfU0laRShkYXRhLmNlKTsgaSsrKSB7CisJCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqdG1wOwor
CisJCQl0bXAgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShkYXRhLmVuZ2luZSk7CisJCQlpZiAoSVNf
RVJSKHRtcCkpIHsKKwkJCQllcnIgPSBQVFJfRVJSKHRtcCk7CisJCQkJZ290byBlcnI7CisJCQl9
CisKKwkJCWVyciA9IGludGVsX2NvbnRleHRfcGluKHRtcCk7CisJCQlpZiAoZXJyKSB7CisJCQkJ
aW50ZWxfY29udGV4dF9wdXQodG1wKTsKKwkJCQlnb3RvIGVycjsKKwkJCX0KKworCQkJZGF0YS5j
ZVtpXSA9IHRtcDsKKwkJfQorCisJCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKHBvaXNvbik7
IGkrKykgeworCQkJZGF0YS5wb2lzb24gPSBwb2lzb25baV07CisKKwkJCWVyciA9IF9fbHJjX3Rp
bWVzdGFtcCgmZGF0YSwgZmFsc2UpOworCQkJaWYgKGVycikKKwkJCQlicmVhazsKKworCQkJZXJy
ID0gX19scmNfdGltZXN0YW1wKCZkYXRhLCB0cnVlKTsKKwkJCWlmIChlcnIpCisJCQkJYnJlYWs7
CisJCX0KKworZXJyOgorCQlzdF9lbmdpbmVfaGVhcnRiZWF0X2VuYWJsZShkYXRhLmVuZ2luZSk7
CisJCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGRhdGEuY2UpOyBpKyspIHsKKwkJCWlmICgh
ZGF0YS5jZVtpXSkKKwkJCQlicmVhazsKKworCQkJaW50ZWxfY29udGV4dF91bnBpbihkYXRhLmNl
W2ldKTsKKwkJCWludGVsX2NvbnRleHRfcHV0KGRhdGEuY2VbaV0pOworCQl9CisKKwkJaWYgKGln
dF9mbHVzaF90ZXN0KGd0LT5pOTE1KSkKKwkJCWVyciA9IC1FSU87CisJCWlmIChlcnIpCisJCQly
ZXR1cm4gZXJyOworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgc3RydWN0IGk5MTVfdm1h
ICoKK2NyZWF0ZV91c2VyX3ZtYShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwgdW5zaWdu
ZWQgbG9uZyBzaXplKQoreworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CisJc3Ry
dWN0IGk5MTVfdm1hICp2bWE7CisJaW50IGVycjsKKworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9j
cmVhdGVfaW50ZXJuYWwodm0tPmk5MTUsIHNpemUpOworCWlmIChJU19FUlIob2JqKSkKKwkJcmV0
dXJuIEVSUl9DQVNUKG9iaik7CisKKwl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosIHZtLCBO
VUxMKTsKKwlpZiAoSVNfRVJSKHZtYSkpIHsKKwkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwor
CQlyZXR1cm4gdm1hOworCX0KKworCWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIFBJTl9V
U0VSKTsKKwlpZiAoZXJyKSB7CisJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwkJcmV0dXJu
IEVSUl9QVFIoZXJyKTsKKwl9CisKKwlyZXR1cm4gdm1hOworfQorCitzdGF0aWMgc3RydWN0IGk5
MTVfdm1hICoKK3N0b3JlX2NvbnRleHQoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCBzdHJ1Y3Qg
aTkxNV92bWEgKnNjcmF0Y2gpCit7CisJc3RydWN0IGk5MTVfdm1hICpiYXRjaDsKKwl1MzIgZHcs
IHgsICpjcywgKmh3OworCXUzMiAqZGVmYXVsdHM7CisKKwliYXRjaCA9IGNyZWF0ZV91c2VyX3Zt
YShjZS0+dm0sIFNaXzY0Syk7CisJaWYgKElTX0VSUihiYXRjaCkpCisJCXJldHVybiBiYXRjaDsK
KworCWNzID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAoYmF0Y2gtPm9iaiwgSTkxNV9NQVBfV0Mp
OworCWlmIChJU19FUlIoY3MpKSB7CisJCWk5MTVfdm1hX3B1dChiYXRjaCk7CisJCXJldHVybiBF
UlJfQ0FTVChjcyk7CisJfQorCisJZGVmYXVsdHMgPSBzaG1lbV9waW5fbWFwKGNlLT5lbmdpbmUt
PmRlZmF1bHRfc3RhdGUpOworCWlmICghZGVmYXVsdHMpIHsKKwkJaTkxNV9nZW1fb2JqZWN0X3Vu
cGluX21hcChiYXRjaC0+b2JqKTsKKwkJaTkxNV92bWFfcHV0KGJhdGNoKTsKKwkJcmV0dXJuIEVS
Ul9QVFIoLUVOT01FTSk7CisJfQorCisJeCA9IDA7CisJZHcgPSAwOworCWh3ID0gZGVmYXVsdHM7
CisJaHcgKz0gTFJDX1NUQVRFX09GRlNFVCAvIHNpemVvZigqaHcpOworCWRvIHsKKwkJdTMyIGxl
biA9IGh3W2R3XSAmIDB4N2Y7CisKKwkJaWYgKGh3W2R3XSA9PSAwKSB7CisJCQlkdysrOworCQkJ
Y29udGludWU7CisJCX0KKworCQlpZiAoKGh3W2R3XSAmIEdFTk1BU0soMzEsIDIzKSkgIT0gTUlf
SU5TVFIoMHgyMiwgMCkpIHsKKwkJCWR3ICs9IGxlbiArIDI7CisJCQljb250aW51ZTsKKwkJfQor
CisJCWR3Kys7CisJCWxlbiA9IChsZW4gKyAxKSAvIDI7CisJCXdoaWxlIChsZW4tLSkgeworCQkJ
KmNzKysgPSBNSV9TVE9SRV9SRUdJU1RFUl9NRU1fR0VOODsKKwkJCSpjcysrID0gaHdbZHddOwor
CQkJKmNzKysgPSBsb3dlcl8zMl9iaXRzKHNjcmF0Y2gtPm5vZGUuc3RhcnQgKyB4KTsKKwkJCSpj
cysrID0gdXBwZXJfMzJfYml0cyhzY3JhdGNoLT5ub2RlLnN0YXJ0ICsgeCk7CisKKwkJCWR3ICs9
IDI7CisJCQl4ICs9IDQ7CisJCX0KKwl9IHdoaWxlIChkdyA8IFBBR0VfU0laRSAvIHNpemVvZih1
MzIpICYmCisJCSAoaHdbZHddICYgfkJJVCgwKSkgIT0gTUlfQkFUQ0hfQlVGRkVSX0VORCk7CisK
KwkqY3MrKyA9IE1JX0JBVENIX0JVRkZFUl9FTkQ7CisKKwlzaG1lbV91bnBpbl9tYXAoY2UtPmVu
Z2luZS0+ZGVmYXVsdF9zdGF0ZSwgZGVmYXVsdHMpOworCisJaTkxNV9nZW1fb2JqZWN0X2ZsdXNo
X21hcChiYXRjaC0+b2JqKTsKKwlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKGJhdGNoLT5vYmop
OworCisJcmV0dXJuIGJhdGNoOworfQorCitzdGF0aWMgaW50IG1vdmVfdG9fYWN0aXZlKHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxLAorCQkJICBzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKKwkJCSAgdW5z
aWduZWQgaW50IGZsYWdzKQoreworCWludCBlcnI7CisKKwlpOTE1X3ZtYV9sb2NrKHZtYSk7CisJ
ZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X29iamVjdChycSwgdm1hLT5vYmosIGZsYWdzKTsKKwlp
ZiAoIWVycikKKwkJZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3RpdmUodm1hLCBycSwgZmxhZ3Mp
OworCWk5MTVfdm1hX3VubG9jayh2bWEpOworCisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIHN0
cnVjdCBpOTE1X3JlcXVlc3QgKgorcmVjb3JkX3JlZ2lzdGVycyhzdHJ1Y3QgaW50ZWxfY29udGV4
dCAqY2UsCisJCSBzdHJ1Y3QgaTkxNV92bWEgKmJlZm9yZSwKKwkJIHN0cnVjdCBpOTE1X3ZtYSAq
YWZ0ZXIsCisJCSB1MzIgKnNlbWEpCit7CisJc3RydWN0IGk5MTVfdm1hICpiX2JlZm9yZSwgKmJf
YWZ0ZXI7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJdTMyICpjczsKKwlpbnQgZXJyOwor
CisJYl9iZWZvcmUgPSBzdG9yZV9jb250ZXh0KGNlLCBiZWZvcmUpOworCWlmIChJU19FUlIoYl9i
ZWZvcmUpKQorCQlyZXR1cm4gRVJSX0NBU1QoYl9iZWZvcmUpOworCisJYl9hZnRlciA9IHN0b3Jl
X2NvbnRleHQoY2UsIGFmdGVyKTsKKwlpZiAoSVNfRVJSKGJfYWZ0ZXIpKSB7CisJCXJxID0gRVJS
X0NBU1QoYl9hZnRlcik7CisJCWdvdG8gZXJyX2JlZm9yZTsKKwl9CisKKwlycSA9IGludGVsX2Nv
bnRleHRfY3JlYXRlX3JlcXVlc3QoY2UpOworCWlmIChJU19FUlIocnEpKQorCQlnb3RvIGVycl9h
ZnRlcjsKKworCWVyciA9IG1vdmVfdG9fYWN0aXZlKHJxLCBiZWZvcmUsIEVYRUNfT0JKRUNUX1dS
SVRFKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl9ycTsKKworCWVyciA9IG1vdmVfdG9fYWN0aXZl
KHJxLCBiX2JlZm9yZSwgMCk7CisJaWYgKGVycikKKwkJZ290byBlcnJfcnE7CisKKwllcnIgPSBt
b3ZlX3RvX2FjdGl2ZShycSwgYWZ0ZXIsIEVYRUNfT0JKRUNUX1dSSVRFKTsKKwlpZiAoZXJyKQor
CQlnb3RvIGVycl9ycTsKKworCWVyciA9IG1vdmVfdG9fYWN0aXZlKHJxLCBiX2FmdGVyLCAwKTsK
KwlpZiAoZXJyKQorCQlnb3RvIGVycl9ycTsKKworCWNzID0gaW50ZWxfcmluZ19iZWdpbihycSwg
MTQpOworCWlmIChJU19FUlIoY3MpKSB7CisJCWVyciA9IFBUUl9FUlIoY3MpOworCQlnb3RvIGVy
cl9ycTsKKwl9CisKKwkqY3MrKyA9IE1JX0FSQl9PTl9PRkYgfCBNSV9BUkJfRElTQUJMRTsKKwkq
Y3MrKyA9IE1JX0JBVENIX0JVRkZFUl9TVEFSVF9HRU44IHwgQklUKDgpOworCSpjcysrID0gbG93
ZXJfMzJfYml0cyhiX2JlZm9yZS0+bm9kZS5zdGFydCk7CisJKmNzKysgPSB1cHBlcl8zMl9iaXRz
KGJfYmVmb3JlLT5ub2RlLnN0YXJ0KTsKKworCSpjcysrID0gTUlfQVJCX09OX09GRiB8IE1JX0FS
Ql9FTkFCTEU7CisJKmNzKysgPSBNSV9TRU1BUEhPUkVfV0FJVCB8CisJCU1JX1NFTUFQSE9SRV9H
TE9CQUxfR1RUIHwKKwkJTUlfU0VNQVBIT1JFX1BPTEwgfAorCQlNSV9TRU1BUEhPUkVfU0FEX05F
UV9TREQ7CisJKmNzKysgPSAwOworCSpjcysrID0gaTkxNV9nZ3R0X29mZnNldChjZS0+ZW5naW5l
LT5zdGF0dXNfcGFnZS52bWEpICsKKwkJb2Zmc2V0X2luX3BhZ2Uoc2VtYSk7CisJKmNzKysgPSAw
OworCSpjcysrID0gTUlfTk9PUDsKKworCSpjcysrID0gTUlfQVJCX09OX09GRiB8IE1JX0FSQl9E
SVNBQkxFOworCSpjcysrID0gTUlfQkFUQ0hfQlVGRkVSX1NUQVJUX0dFTjggfCBCSVQoOCk7CisJ
KmNzKysgPSBsb3dlcl8zMl9iaXRzKGJfYWZ0ZXItPm5vZGUuc3RhcnQpOworCSpjcysrID0gdXBw
ZXJfMzJfYml0cyhiX2FmdGVyLT5ub2RlLnN0YXJ0KTsKKworCWludGVsX3JpbmdfYWR2YW5jZShy
cSwgY3MpOworCisJV1JJVEVfT05DRSgqc2VtYSwgMCk7CisJaTkxNV9yZXF1ZXN0X2dldChycSk7
CisJaTkxNV9yZXF1ZXN0X2FkZChycSk7CitlcnJfYWZ0ZXI6CisJaTkxNV92bWFfcHV0KGJfYWZ0
ZXIpOworZXJyX2JlZm9yZToKKwlpOTE1X3ZtYV9wdXQoYl9iZWZvcmUpOworCXJldHVybiBycTsK
KworZXJyX3JxOgorCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCXJxID0gRVJSX1BUUihlcnIpOwor
CWdvdG8gZXJyX2FmdGVyOworfQorCitzdGF0aWMgc3RydWN0IGk5MTVfdm1hICpsb2FkX2NvbnRl
eHQoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCB1MzIgcG9pc29uKQoreworCXN0cnVjdCBpOTE1
X3ZtYSAqYmF0Y2g7CisJdTMyIGR3LCAqY3MsICpodzsKKwl1MzIgKmRlZmF1bHRzOworCisJYmF0
Y2ggPSBjcmVhdGVfdXNlcl92bWEoY2UtPnZtLCBTWl82NEspOworCWlmIChJU19FUlIoYmF0Y2gp
KQorCQlyZXR1cm4gYmF0Y2g7CisKKwljcyA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKGJhdGNo
LT5vYmosIEk5MTVfTUFQX1dDKTsKKwlpZiAoSVNfRVJSKGNzKSkgeworCQlpOTE1X3ZtYV9wdXQo
YmF0Y2gpOworCQlyZXR1cm4gRVJSX0NBU1QoY3MpOworCX0KKworCWRlZmF1bHRzID0gc2htZW1f
cGluX21hcChjZS0+ZW5naW5lLT5kZWZhdWx0X3N0YXRlKTsKKwlpZiAoIWRlZmF1bHRzKSB7CisJ
CWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAoYmF0Y2gtPm9iaik7CisJCWk5MTVfdm1hX3B1dChi
YXRjaCk7CisJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOworCX0KKworCWR3ID0gMDsKKwlodyA9
IGRlZmF1bHRzOworCWh3ICs9IExSQ19TVEFURV9PRkZTRVQgLyBzaXplb2YoKmh3KTsKKwlkbyB7
CisJCXUzMiBsZW4gPSBod1tkd10gJiAweDdmOworCisJCWlmIChod1tkd10gPT0gMCkgeworCQkJ
ZHcrKzsKKwkJCWNvbnRpbnVlOworCQl9CisKKwkJaWYgKChod1tkd10gJiBHRU5NQVNLKDMxLCAy
MykpICE9IE1JX0lOU1RSKDB4MjIsIDApKSB7CisJCQlkdyArPSBsZW4gKyAyOworCQkJY29udGlu
dWU7CisJCX0KKworCQlkdysrOworCQlsZW4gPSAobGVuICsgMSkgLyAyOworCQkqY3MrKyA9IE1J
X0xPQURfUkVHSVNURVJfSU1NKGxlbik7CisJCXdoaWxlIChsZW4tLSkgeworCQkJKmNzKysgPSBo
d1tkd107CisJCQkqY3MrKyA9IHBvaXNvbjsKKwkJCWR3ICs9IDI7CisJCX0KKwl9IHdoaWxlIChk
dyA8IFBBR0VfU0laRSAvIHNpemVvZih1MzIpICYmCisJCSAoaHdbZHddICYgfkJJVCgwKSkgIT0g
TUlfQkFUQ0hfQlVGRkVSX0VORCk7CisKKwkqY3MrKyA9IE1JX0JBVENIX0JVRkZFUl9FTkQ7CisK
KwlzaG1lbV91bnBpbl9tYXAoY2UtPmVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSwgZGVmYXVsdHMpOwor
CisJaTkxNV9nZW1fb2JqZWN0X2ZsdXNoX21hcChiYXRjaC0+b2JqKTsKKwlpOTE1X2dlbV9vYmpl
Y3RfdW5waW5fbWFwKGJhdGNoLT5vYmopOworCisJcmV0dXJuIGJhdGNoOworfQorCitzdGF0aWMg
aW50IHBvaXNvbl9yZWdpc3RlcnMoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCB1MzIgcG9pc29u
LCB1MzIgKnNlbWEpCit7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJc3RydWN0IGk5MTVf
dm1hICpiYXRjaDsKKwl1MzIgKmNzOworCWludCBlcnI7CisKKwliYXRjaCA9IGxvYWRfY29udGV4
dChjZSwgcG9pc29uKTsKKwlpZiAoSVNfRVJSKGJhdGNoKSkKKwkJcmV0dXJuIFBUUl9FUlIoYmF0
Y2gpOworCisJcnEgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZV9yZXF1ZXN0KGNlKTsKKwlpZiAoSVNf
RVJSKHJxKSkgeworCQllcnIgPSBQVFJfRVJSKHJxKTsKKwkJZ290byBlcnJfYmF0Y2g7CisJfQor
CisJZXJyID0gbW92ZV90b19hY3RpdmUocnEsIGJhdGNoLCAwKTsKKwlpZiAoZXJyKQorCQlnb3Rv
IGVycl9ycTsKKworCWNzID0gaW50ZWxfcmluZ19iZWdpbihycSwgOCk7CisJaWYgKElTX0VSUihj
cykpIHsKKwkJZXJyID0gUFRSX0VSUihjcyk7CisJCWdvdG8gZXJyX3JxOworCX0KKworCSpjcysr
ID0gTUlfQVJCX09OX09GRiB8IE1JX0FSQl9ESVNBQkxFOworCSpjcysrID0gTUlfQkFUQ0hfQlVG
RkVSX1NUQVJUX0dFTjggfCBCSVQoOCk7CisJKmNzKysgPSBsb3dlcl8zMl9iaXRzKGJhdGNoLT5u
b2RlLnN0YXJ0KTsKKwkqY3MrKyA9IHVwcGVyXzMyX2JpdHMoYmF0Y2gtPm5vZGUuc3RhcnQpOwor
CisJKmNzKysgPSBNSV9TVE9SRV9EV09SRF9JTU1fR0VONCB8IE1JX1VTRV9HR1RUOworCSpjcysr
ID0gaTkxNV9nZ3R0X29mZnNldChjZS0+ZW5naW5lLT5zdGF0dXNfcGFnZS52bWEpICsKKwkJb2Zm
c2V0X2luX3BhZ2Uoc2VtYSk7CisJKmNzKysgPSAwOworCSpjcysrID0gMTsKKworCWludGVsX3Jp
bmdfYWR2YW5jZShycSwgY3MpOworCisJcnEtPnNjaGVkLmF0dHIucHJpb3JpdHkgPSBJOTE1X1BS
SU9SSVRZX0JBUlJJRVI7CitlcnJfcnE6CisJaTkxNV9yZXF1ZXN0X2FkZChycSk7CitlcnJfYmF0
Y2g6CisJaTkxNV92bWFfcHV0KGJhdGNoKTsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgYm9v
bCBpc19tb3ZpbmcodTMyIGEsIHUzMiBiKQoreworCXJldHVybiBhICE9IGI7Cit9CisKK3N0YXRp
YyBpbnQgY29tcGFyZV9pc29sYXRpb24oc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAor
CQkJICAgICBzdHJ1Y3QgaTkxNV92bWEgKnJlZlsyXSwKKwkJCSAgICAgc3RydWN0IGk5MTVfdm1h
ICpyZXN1bHRbMl0sCisJCQkgICAgIHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKKwkJCSAgICAg
dTMyIHBvaXNvbikKK3sKKwl1MzIgeCwgZHcsICpodywgKmxyYzsKKwl1MzIgKkFbMl0sICpCWzJd
OworCXUzMiAqZGVmYXVsdHM7CisJaW50IGVyciA9IDA7CisKKwlBWzBdID0gaTkxNV9nZW1fb2Jq
ZWN0X3Bpbl9tYXAocmVmWzBdLT5vYmosIEk5MTVfTUFQX1dDKTsKKwlpZiAoSVNfRVJSKEFbMF0p
KQorCQlyZXR1cm4gUFRSX0VSUihBWzBdKTsKKworCUFbMV0gPSBpOTE1X2dlbV9vYmplY3RfcGlu
X21hcChyZWZbMV0tPm9iaiwgSTkxNV9NQVBfV0MpOworCWlmIChJU19FUlIoQVsxXSkpIHsKKwkJ
ZXJyID0gUFRSX0VSUihBWzFdKTsKKwkJZ290byBlcnJfQTA7CisJfQorCisJQlswXSA9IGk5MTVf
Z2VtX29iamVjdF9waW5fbWFwKHJlc3VsdFswXS0+b2JqLCBJOTE1X01BUF9XQyk7CisJaWYgKElT
X0VSUihCWzBdKSkgeworCQllcnIgPSBQVFJfRVJSKEJbMF0pOworCQlnb3RvIGVycl9BMTsKKwl9
CisKKwlCWzFdID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAocmVzdWx0WzFdLT5vYmosIEk5MTVf
TUFQX1dDKTsKKwlpZiAoSVNfRVJSKEJbMV0pKSB7CisJCWVyciA9IFBUUl9FUlIoQlsxXSk7CisJ
CWdvdG8gZXJyX0IwOworCX0KKworCWxyYyA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKGNlLT5z
dGF0ZS0+b2JqLAorCQkJCSAgICAgIGk5MTVfY29oZXJlbnRfbWFwX3R5cGUoZW5naW5lLT5pOTE1
KSk7CisJaWYgKElTX0VSUihscmMpKSB7CisJCWVyciA9IFBUUl9FUlIobHJjKTsKKwkJZ290byBl
cnJfQjE7CisJfQorCWxyYyArPSBMUkNfU1RBVEVfT0ZGU0VUIC8gc2l6ZW9mKCpodyk7CisKKwlk
ZWZhdWx0cyA9IHNobWVtX3Bpbl9tYXAoY2UtPmVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSk7CisJaWYg
KCFkZWZhdWx0cykgeworCQllcnIgPSAtRU5PTUVNOworCQlnb3RvIGVycl9scmM7CisJfQorCisJ
eCA9IDA7CisJZHcgPSAwOworCWh3ID0gZGVmYXVsdHM7CisJaHcgKz0gTFJDX1NUQVRFX09GRlNF
VCAvIHNpemVvZigqaHcpOworCWRvIHsKKwkJdTMyIGxlbiA9IGh3W2R3XSAmIDB4N2Y7CisKKwkJ
aWYgKGh3W2R3XSA9PSAwKSB7CisJCQlkdysrOworCQkJY29udGludWU7CisJCX0KKworCQlpZiAo
KGh3W2R3XSAmIEdFTk1BU0soMzEsIDIzKSkgIT0gTUlfSU5TVFIoMHgyMiwgMCkpIHsKKwkJCWR3
ICs9IGxlbiArIDI7CisJCQljb250aW51ZTsKKwkJfQorCisJCWR3Kys7CisJCWxlbiA9IChsZW4g
KyAxKSAvIDI7CisJCXdoaWxlIChsZW4tLSkgeworCQkJaWYgKCFpc19tb3ZpbmcoQVswXVt4XSwg
QVsxXVt4XSkgJiYKKwkJCSAgICAoQVswXVt4XSAhPSBCWzBdW3hdIHx8IEFbMV1beF0gIT0gQlsx
XVt4XSkpIHsKKwkJCQlzd2l0Y2ggKGh3W2R3XSAmIDQwOTUpIHsKKwkJCQljYXNlIDB4MzA6IC8q
IFJJTkdfSEVBRCAqLworCQkJCWNhc2UgMHgzNDogLyogUklOR19UQUlMICovCisJCQkJCWJyZWFr
OworCisJCQkJZGVmYXVsdDoKKwkJCQkJcHJfZXJyKCIlc1slZF06IE1pc21hdGNoIGZvciByZWdp
c3RlciAlNHgsIGRlZmF1bHQgJTA4eCwgcmVmZXJlbmNlICUwOHgsIHJlc3VsdCAoJTA4eCwgJTA4
eCksIHBvaXNvbiAlMDh4LCBjb250ZXh0ICUwOHhcbiIsCisJCQkJCSAgICAgICBlbmdpbmUtPm5h
bWUsIGR3LAorCQkJCQkgICAgICAgaHdbZHddLCBod1tkdyArIDFdLAorCQkJCQkgICAgICAgQVsw
XVt4XSwgQlswXVt4XSwgQlsxXVt4XSwKKwkJCQkJICAgICAgIHBvaXNvbiwgbHJjW2R3ICsgMV0p
OworCQkJCQllcnIgPSAtRUlOVkFMOworCQkJCX0KKwkJCX0KKwkJCWR3ICs9IDI7CisJCQl4Kys7
CisJCX0KKwl9IHdoaWxlIChkdyA8IFBBR0VfU0laRSAvIHNpemVvZih1MzIpICYmCisJCSAoaHdb
ZHddICYgfkJJVCgwKSkgIT0gTUlfQkFUQ0hfQlVGRkVSX0VORCk7CisKKwlzaG1lbV91bnBpbl9t
YXAoY2UtPmVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSwgZGVmYXVsdHMpOworZXJyX2xyYzoKKwlpOTE1
X2dlbV9vYmplY3RfdW5waW5fbWFwKGNlLT5zdGF0ZS0+b2JqKTsKK2Vycl9CMToKKwlpOTE1X2dl
bV9vYmplY3RfdW5waW5fbWFwKHJlc3VsdFsxXS0+b2JqKTsKK2Vycl9CMDoKKwlpOTE1X2dlbV9v
YmplY3RfdW5waW5fbWFwKHJlc3VsdFswXS0+b2JqKTsKK2Vycl9BMToKKwlpOTE1X2dlbV9vYmpl
Y3RfdW5waW5fbWFwKHJlZlsxXS0+b2JqKTsKK2Vycl9BMDoKKwlpOTE1X2dlbV9vYmplY3RfdW5w
aW5fbWFwKHJlZlswXS0+b2JqKTsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgaW50IF9fbHJj
X2lzb2xhdGlvbihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIHUzMiBwb2lzb24pCit7
CisJdTMyICpzZW1hID0gbWVtc2V0MzIoZW5naW5lLT5zdGF0dXNfcGFnZS5hZGRyICsgMTAwMCwg
MCwgMSk7CisJc3RydWN0IGk5MTVfdm1hICpyZWZbMl0sICpyZXN1bHRbMl07CisJc3RydWN0IGlu
dGVsX2NvbnRleHQgKkEsICpCOworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCWludCBlcnI7
CisKKwlBID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKKwlpZiAoSVNfRVJSKEEpKQor
CQlyZXR1cm4gUFRSX0VSUihBKTsKKworCUIgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUp
OworCWlmIChJU19FUlIoQikpIHsKKwkJZXJyID0gUFRSX0VSUihCKTsKKwkJZ290byBlcnJfQTsK
Kwl9CisKKwlyZWZbMF0gPSBjcmVhdGVfdXNlcl92bWEoQS0+dm0sIFNaXzY0Syk7CisJaWYgKElT
X0VSUihyZWZbMF0pKSB7CisJCWVyciA9IFBUUl9FUlIocmVmWzBdKTsKKwkJZ290byBlcnJfQjsK
Kwl9CisKKwlyZWZbMV0gPSBjcmVhdGVfdXNlcl92bWEoQS0+dm0sIFNaXzY0Syk7CisJaWYgKElT
X0VSUihyZWZbMV0pKSB7CisJCWVyciA9IFBUUl9FUlIocmVmWzFdKTsKKwkJZ290byBlcnJfcmVm
MDsKKwl9CisKKwlycSA9IHJlY29yZF9yZWdpc3RlcnMoQSwgcmVmWzBdLCByZWZbMV0sIHNlbWEp
OworCWlmIChJU19FUlIocnEpKSB7CisJCWVyciA9IFBUUl9FUlIocnEpOworCQlnb3RvIGVycl9y
ZWYxOworCX0KKworCVdSSVRFX09OQ0UoKnNlbWEsIDEpOworCXdtYigpOworCisJaWYgKGk5MTVf
cmVxdWVzdF93YWl0KHJxLCAwLCBIWiAvIDIpIDwgMCkgeworCQlpOTE1X3JlcXVlc3RfcHV0KHJx
KTsKKwkJZXJyID0gLUVUSU1FOworCQlnb3RvIGVycl9yZWYxOworCX0KKwlpOTE1X3JlcXVlc3Rf
cHV0KHJxKTsKKworCXJlc3VsdFswXSA9IGNyZWF0ZV91c2VyX3ZtYShBLT52bSwgU1pfNjRLKTsK
KwlpZiAoSVNfRVJSKHJlc3VsdFswXSkpIHsKKwkJZXJyID0gUFRSX0VSUihyZXN1bHRbMF0pOwor
CQlnb3RvIGVycl9yZWYxOworCX0KKworCXJlc3VsdFsxXSA9IGNyZWF0ZV91c2VyX3ZtYShBLT52
bSwgU1pfNjRLKTsKKwlpZiAoSVNfRVJSKHJlc3VsdFsxXSkpIHsKKwkJZXJyID0gUFRSX0VSUihy
ZXN1bHRbMV0pOworCQlnb3RvIGVycl9yZXN1bHQwOworCX0KKworCXJxID0gcmVjb3JkX3JlZ2lz
dGVycyhBLCByZXN1bHRbMF0sIHJlc3VsdFsxXSwgc2VtYSk7CisJaWYgKElTX0VSUihycSkpIHsK
KwkJZXJyID0gUFRSX0VSUihycSk7CisJCWdvdG8gZXJyX3Jlc3VsdDE7CisJfQorCisJZXJyID0g
cG9pc29uX3JlZ2lzdGVycyhCLCBwb2lzb24sIHNlbWEpOworCWlmIChlcnIpIHsKKwkJV1JJVEVf
T05DRSgqc2VtYSwgLTEpOworCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKKwkJZ290byBlcnJfcmVz
dWx0MTsKKwl9CisKKwlpZiAoaTkxNV9yZXF1ZXN0X3dhaXQocnEsIDAsIEhaIC8gMikgPCAwKSB7
CisJCWk5MTVfcmVxdWVzdF9wdXQocnEpOworCQllcnIgPSAtRVRJTUU7CisJCWdvdG8gZXJyX3Jl
c3VsdDE7CisJfQorCWk5MTVfcmVxdWVzdF9wdXQocnEpOworCisJZXJyID0gY29tcGFyZV9pc29s
YXRpb24oZW5naW5lLCByZWYsIHJlc3VsdCwgQSwgcG9pc29uKTsKKworZXJyX3Jlc3VsdDE6CisJ
aTkxNV92bWFfcHV0KHJlc3VsdFsxXSk7CitlcnJfcmVzdWx0MDoKKwlpOTE1X3ZtYV9wdXQocmVz
dWx0WzBdKTsKK2Vycl9yZWYxOgorCWk5MTVfdm1hX3B1dChyZWZbMV0pOworZXJyX3JlZjA6CisJ
aTkxNV92bWFfcHV0KHJlZlswXSk7CitlcnJfQjoKKwlpbnRlbF9jb250ZXh0X3B1dChCKTsKK2Vy
cl9BOgorCWludGVsX2NvbnRleHRfcHV0KEEpOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBi
b29sIHNraXBfaXNvbGF0aW9uKGNvbnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkK
K3sKKwlpZiAoZW5naW5lLT5jbGFzcyA9PSBDT1BZX0VOR0lORV9DTEFTUyAmJiBJTlRFTF9HRU4o
ZW5naW5lLT5pOTE1KSA9PSA5KQorCQlyZXR1cm4gdHJ1ZTsKKworCWlmIChlbmdpbmUtPmNsYXNz
ID09IFJFTkRFUl9DTEFTUyAmJiBJTlRFTF9HRU4oZW5naW5lLT5pOTE1KSA9PSAxMSkKKwkJcmV0
dXJuIHRydWU7CisKKwlyZXR1cm4gZmFsc2U7Cit9CisKK3N0YXRpYyBpbnQgbGl2ZV9scmNfaXNv
bGF0aW9uKHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOworCXN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKKwllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKKwlj
b25zdCB1MzIgcG9pc29uW10gPSB7CisJCVNUQUNLX01BR0lDLAorCQkweDNhM2EzYTNhLAorCQkw
eDVjNWM1YzVjLAorCQkweGZmZmZmZmZmLAorCQkweGZmZmYwMDAwLAorCX07CisJaW50IGVyciA9
IDA7CisKKwkvKgorCSAqIE91ciBnb2FsIGlzIHRyeSBhbmQgdmVyaWZ5IHRoYXQgcGVyLWNvbnRl
eHQgc3RhdGUgY2Fubm90IGJlCisJICogdGFtcGVyZWQgd2l0aCBieSBhbm90aGVyIG5vbi1wcml2
aWxlZ2VkIGNsaWVudC4KKwkgKgorCSAqIFdlIHRha2UgdGhlIGxpc3Qgb2YgY29udGV4dCByZWdp
c3RlcnMgZnJvbSB0aGUgTFJJIGluIHRoZSBkZWZhdWx0CisJICogY29udGV4dCBpbWFnZSBhbmQg
YXR0ZW1wdCB0byBtb2RpZnkgdGhhdCBsaXN0IGZyb20gYSByZW1vdGUgY29udGV4dC4KKwkgKi8K
KworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgeworCQlpbnQgaTsKKworCQkvKiBK
dXN0IGRvbid0IGV2ZW4gYXNrICovCisJCWlmICghSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVf
U0VMRlRFU1RfQlJPS0VOKSAmJgorCQkgICAgc2tpcF9pc29sYXRpb24oZW5naW5lKSkKKwkJCWNv
bnRpbnVlOworCisJCWludGVsX2VuZ2luZV9wbV9nZXQoZW5naW5lKTsKKwkJZm9yIChpID0gMDsg
aSA8IEFSUkFZX1NJWkUocG9pc29uKTsgaSsrKSB7CisJCQlpbnQgcmVzdWx0OworCisJCQlyZXN1
bHQgPSBfX2xyY19pc29sYXRpb24oZW5naW5lLCBwb2lzb25baV0pOworCQkJaWYgKHJlc3VsdCAm
JiAhZXJyKQorCQkJCWVyciA9IHJlc3VsdDsKKworCQkJcmVzdWx0ID0gX19scmNfaXNvbGF0aW9u
KGVuZ2luZSwgfnBvaXNvbltpXSk7CisJCQlpZiAocmVzdWx0ICYmICFlcnIpCisJCQkJZXJyID0g
cmVzdWx0OworCQl9CisJCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKKwkJaWYgKGlndF9m
bHVzaF90ZXN0KGd0LT5pOTE1KSkgeworCQkJZXJyID0gLUVJTzsKKwkJCWJyZWFrOworCQl9CisJ
fQorCisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIGludCBpbmRpcmVjdF9jdHhfc3VibWl0X3Jl
cShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCit7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7
CisJaW50IGVyciA9IDA7CisKKwlycSA9IGludGVsX2NvbnRleHRfY3JlYXRlX3JlcXVlc3QoY2Up
OworCWlmIChJU19FUlIocnEpKQorCQlyZXR1cm4gUFRSX0VSUihycSk7CisKKwlpOTE1X3JlcXVl
c3RfZ2V0KHJxKTsKKwlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKworCWlmIChpOTE1X3JlcXVlc3Rf
d2FpdChycSwgMCwgSFogLyA1KSA8IDApCisJCWVyciA9IC1FVElNRTsKKworCWk5MTVfcmVxdWVz
dF9wdXQocnEpOworCisJcmV0dXJuIGVycjsKK30KKworI2RlZmluZSBDVFhfQkJfQ0FOQVJZX09G
RlNFVCAoMyAqIDEwMjQpCisjZGVmaW5lIENUWF9CQl9DQU5BUllfSU5ERVggIChDVFhfQkJfQ0FO
QVJZX09GRlNFVCAvIHNpemVvZih1MzIpKQorCitzdGF0aWMgdTMyICoKK2VtaXRfaW5kaXJlY3Rf
Y3R4X2JiX2NhbmFyeShjb25zdCBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIHUzMiAqY3MpCit7
CisJKmNzKysgPSBNSV9TVE9SRV9SRUdJU1RFUl9NRU1fR0VOOCB8CisJCU1JX1NSTV9MUk1fR0xP
QkFMX0dUVCB8CisJCU1JX0xSSV9MUk1fQ1NfTU1JTzsKKwkqY3MrKyA9IGk5MTVfbW1pb19yZWdf
b2Zmc2V0KFJJTkdfU1RBUlQoMCkpOworCSpjcysrID0gaTkxNV9nZ3R0X29mZnNldChjZS0+c3Rh
dGUpICsKKwkJY29udGV4dF93YV9iYl9vZmZzZXQoY2UpICsKKwkJQ1RYX0JCX0NBTkFSWV9PRkZT
RVQ7CisJKmNzKysgPSAwOworCisJcmV0dXJuIGNzOworfQorCitzdGF0aWMgdm9pZAoraW5kaXJl
Y3RfY3R4X2JiX3NldHVwKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKK3sKKwl1MzIgKmNzID0g
Y29udGV4dF9pbmRpcmVjdF9iYihjZSk7CisKKwljc1tDVFhfQkJfQ0FOQVJZX0lOREVYXSA9IDB4
ZGVhZGYwMGQ7CisKKwlzZXR1cF9pbmRpcmVjdF9jdHhfYmIoY2UsIGNlLT5lbmdpbmUsIGVtaXRf
aW5kaXJlY3RfY3R4X2JiX2NhbmFyeSk7Cit9CisKK3N0YXRpYyBib29sIGNoZWNrX3Jpbmdfc3Rh
cnQoc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQoreworCWNvbnN0IHUzMiAqIGNvbnN0IGN0eF9i
YiA9ICh2b2lkICopKGNlLT5scmNfcmVnX3N0YXRlKSAtCisJCUxSQ19TVEFURV9PRkZTRVQgKyBj
b250ZXh0X3dhX2JiX29mZnNldChjZSk7CisKKwlpZiAoY3R4X2JiW0NUWF9CQl9DQU5BUllfSU5E
RVhdID09IGNlLT5scmNfcmVnX3N0YXRlW0NUWF9SSU5HX1NUQVJUXSkKKwkJcmV0dXJuIHRydWU7
CisKKwlwcl9lcnIoInJpbmcgc3RhcnQgbWlzbWF0Y2g6IGNhbmFyeSAweCUwOHggdnMgc3RhdGUg
MHglMDh4XG4iLAorCSAgICAgICBjdHhfYmJbQ1RYX0JCX0NBTkFSWV9JTkRFWF0sCisJICAgICAg
IGNlLT5scmNfcmVnX3N0YXRlW0NUWF9SSU5HX1NUQVJUXSk7CisKKwlyZXR1cm4gZmFsc2U7Cit9
CisKK3N0YXRpYyBpbnQgaW5kaXJlY3RfY3R4X2JiX2NoZWNrKHN0cnVjdCBpbnRlbF9jb250ZXh0
ICpjZSkKK3sKKwlpbnQgZXJyOworCisJZXJyID0gaW5kaXJlY3RfY3R4X3N1Ym1pdF9yZXEoY2Up
OworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwlpZiAoIWNoZWNrX3Jpbmdfc3RhcnQoY2Up
KQorCQlyZXR1cm4gLUVJTlZBTDsKKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IF9fbGl2
ZV9scmNfaW5kaXJlY3RfY3R4X2JiKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKK3sK
KwlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqYSwgKmI7CisJaW50IGVycjsKKworCWEgPSBpbnRlbF9j
b250ZXh0X2NyZWF0ZShlbmdpbmUpOworCWlmIChJU19FUlIoYSkpCisJCXJldHVybiBQVFJfRVJS
KGEpOworCWVyciA9IGludGVsX2NvbnRleHRfcGluKGEpOworCWlmIChlcnIpCisJCWdvdG8gcHV0
X2E7CisKKwliID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKKwlpZiAoSVNfRVJSKGIp
KSB7CisJCWVyciA9IFBUUl9FUlIoYik7CisJCWdvdG8gdW5waW5fYTsKKwl9CisJZXJyID0gaW50
ZWxfY29udGV4dF9waW4oYik7CisJaWYgKGVycikKKwkJZ290byBwdXRfYjsKKworCS8qIFdlIHVz
ZSB0aGUgYWxyZWFkeSByZXNlcnZlZCBleHRyYSBwYWdlIGluIGNvbnRleHQgc3RhdGUgKi8KKwlp
ZiAoIWEtPndhX2JiX3BhZ2UpIHsKKwkJR0VNX0JVR19PTihiLT53YV9iYl9wYWdlKTsKKwkJR0VN
X0JVR19PTihJTlRFTF9HRU4oZW5naW5lLT5pOTE1KSA9PSAxMik7CisJCWdvdG8gdW5waW5fYjsK
Kwl9CisKKwkvKgorCSAqIEluIG9yZGVyIHRvIHRlc3QgdGhhdCBvdXIgcGVyIGNvbnRleHQgYmIg
aXMgdHJ1bHkgcGVyIGNvbnRleHQsCisJICogYW5kIGV4ZWN1dGVzIGF0IHRoZSBpbnRlbmRlZCBz
cG90IG9uIGNvbnRleHQgcmVzdG9yaW5nIHByb2Nlc3MsCisJICogbWFrZSB0aGUgYmF0Y2ggc3Rv
cmUgdGhlIHJpbmcgc3RhcnQgdmFsdWUgdG8gbWVtb3J5LgorCSAqIEFzIHJpbmcgc3RhcnQgaXMg
cmVzdG9yZWQgYXByaW9yaSBvZiBzdGFydGluZyB0aGUgaW5kaXJlY3QgY3R4IGJiIGFuZAorCSAq
IGFzIGl0IHdpbGwgYmUgZGlmZmVyZW50IGZvciBlYWNoIGNvbnRleHQsIGl0IGZpdHMgdG8gdGhp
cyBwdXJwb3NlLgorCSAqLworCWluZGlyZWN0X2N0eF9iYl9zZXR1cChhKTsKKwlpbmRpcmVjdF9j
dHhfYmJfc2V0dXAoYik7CisKKwllcnIgPSBpbmRpcmVjdF9jdHhfYmJfY2hlY2soYSk7CisJaWYg
KGVycikKKwkJZ290byB1bnBpbl9iOworCisJZXJyID0gaW5kaXJlY3RfY3R4X2JiX2NoZWNrKGIp
OworCit1bnBpbl9iOgorCWludGVsX2NvbnRleHRfdW5waW4oYik7CitwdXRfYjoKKwlpbnRlbF9j
b250ZXh0X3B1dChiKTsKK3VucGluX2E6CisJaW50ZWxfY29udGV4dF91bnBpbihhKTsKK3B1dF9h
OgorCWludGVsX2NvbnRleHRfcHV0KGEpOworCisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIGlu
dCBsaXZlX2xyY19pbmRpcmVjdF9jdHhfYmIodm9pZCAqYXJnKQoreworCXN0cnVjdCBpbnRlbF9n
dCAqZ3QgPSBhcmc7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOworCWVudW0gaW50
ZWxfZW5naW5lX2lkIGlkOworCWludCBlcnIgPSAwOworCisJZm9yX2VhY2hfZW5naW5lKGVuZ2lu
ZSwgZ3QsIGlkKSB7CisJCWludGVsX2VuZ2luZV9wbV9nZXQoZW5naW5lKTsKKwkJZXJyID0gX19s
aXZlX2xyY19pbmRpcmVjdF9jdHhfYmIoZW5naW5lKTsKKwkJaW50ZWxfZW5naW5lX3BtX3B1dChl
bmdpbmUpOworCisJCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpCisJCQllcnIgPSAtRUlP
OworCisJCWlmIChlcnIpCisJCQlicmVhazsKKwl9CisKKwlyZXR1cm4gZXJyOworfQorCitzdGF0
aWMgdm9pZCBnYXJiYWdlX3Jlc2V0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKKwkJ
CSAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCit7CisJY29uc3QgdW5zaWduZWQgaW50IGJpdCA9
IEk5MTVfUkVTRVRfRU5HSU5FICsgZW5naW5lLT5pZDsKKwl1bnNpZ25lZCBsb25nICpsb2NrID0g
JmVuZ2luZS0+Z3QtPnJlc2V0LmZsYWdzOworCisJaWYgKHRlc3RfYW5kX3NldF9iaXQoYml0LCBs
b2NrKSkKKwkJcmV0dXJuOworCisJdGFza2xldF9kaXNhYmxlKCZlbmdpbmUtPmV4ZWNsaXN0cy50
YXNrbGV0KTsKKworCWlmICghcnEtPmZlbmNlLmVycm9yKQorCQlpbnRlbF9lbmdpbmVfcmVzZXQo
ZW5naW5lLCBOVUxMKTsKKworCXRhc2tsZXRfZW5hYmxlKCZlbmdpbmUtPmV4ZWNsaXN0cy50YXNr
bGV0KTsKKwljbGVhcl9hbmRfd2FrZV91cF9iaXQoYml0LCBsb2NrKTsKK30KKworc3RhdGljIHN0
cnVjdCBpOTE1X3JlcXVlc3QgKmdhcmJhZ2Uoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAorCQkJ
CSAgICBzdHJ1Y3Qgcm5kX3N0YXRlICpwcm5nKQoreworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
OworCWludCBlcnI7CisKKwllcnIgPSBpbnRlbF9jb250ZXh0X3BpbihjZSk7CisJaWYgKGVycikK
KwkJcmV0dXJuIEVSUl9QVFIoZXJyKTsKKworCXByYW5kb21fYnl0ZXNfc3RhdGUocHJuZywKKwkJ
CSAgICBjZS0+bHJjX3JlZ19zdGF0ZSwKKwkJCSAgICBjZS0+ZW5naW5lLT5jb250ZXh0X3NpemUg
LQorCQkJICAgIExSQ19TVEFURV9PRkZTRVQpOworCisJcnEgPSBpbnRlbF9jb250ZXh0X2NyZWF0
ZV9yZXF1ZXN0KGNlKTsKKwlpZiAoSVNfRVJSKHJxKSkgeworCQllcnIgPSBQVFJfRVJSKHJxKTsK
KwkJZ290byBlcnJfdW5waW47CisJfQorCisJaTkxNV9yZXF1ZXN0X2dldChycSk7CisJaTkxNV9y
ZXF1ZXN0X2FkZChycSk7CisJcmV0dXJuIHJxOworCitlcnJfdW5waW46CisJaW50ZWxfY29udGV4
dF91bnBpbihjZSk7CisJcmV0dXJuIEVSUl9QVFIoZXJyKTsKK30KKworc3RhdGljIGludCBfX2xy
Y19nYXJiYWdlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgc3RydWN0IHJuZF9zdGF0
ZSAqcHJuZykKK3sKKwlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CisJc3RydWN0IGk5MTVfcmVx
dWVzdCAqaGFuZzsKKwlpbnQgZXJyID0gMDsKKworCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUo
ZW5naW5lKTsKKwlpZiAoSVNfRVJSKGNlKSkKKwkJcmV0dXJuIFBUUl9FUlIoY2UpOworCisJaGFu
ZyA9IGdhcmJhZ2UoY2UsIHBybmcpOworCWlmIChJU19FUlIoaGFuZykpIHsKKwkJZXJyID0gUFRS
X0VSUihoYW5nKTsKKwkJZ290byBlcnJfY2U7CisJfQorCisJaWYgKHdhaXRfZm9yX3N1Ym1pdChl
bmdpbmUsIGhhbmcsIEhaIC8gMikpIHsKKwkJaTkxNV9yZXF1ZXN0X3B1dChoYW5nKTsKKwkJZXJy
ID0gLUVUSU1FOworCQlnb3RvIGVycl9jZTsKKwl9CisKKwlpbnRlbF9jb250ZXh0X3NldF9iYW5u
ZWQoY2UpOworCWdhcmJhZ2VfcmVzZXQoZW5naW5lLCBoYW5nKTsKKworCWludGVsX2VuZ2luZV9m
bHVzaF9zdWJtaXNzaW9uKGVuZ2luZSk7CisJaWYgKCFoYW5nLT5mZW5jZS5lcnJvcikgeworCQlp
OTE1X3JlcXVlc3RfcHV0KGhhbmcpOworCQlwcl9lcnIoIiVzOiBjb3JydXB0ZWQgY29udGV4dCB3
YXMgbm90IHJlc2V0XG4iLAorCQkgICAgICAgZW5naW5lLT5uYW1lKTsKKwkJZXJyID0gLUVJTlZB
TDsKKwkJZ290byBlcnJfY2U7CisJfQorCisJaWYgKGk5MTVfcmVxdWVzdF93YWl0KGhhbmcsIDAs
IEhaIC8gMikgPCAwKSB7CisJCXByX2VycigiJXM6IGNvcnJ1cHRlZCBjb250ZXh0IGRpZCBub3Qg
cmVjb3ZlclxuIiwKKwkJICAgICAgIGVuZ2luZS0+bmFtZSk7CisJCWk5MTVfcmVxdWVzdF9wdXQo
aGFuZyk7CisJCWVyciA9IC1FSU87CisJCWdvdG8gZXJyX2NlOworCX0KKwlpOTE1X3JlcXVlc3Rf
cHV0KGhhbmcpOworCitlcnJfY2U6CisJaW50ZWxfY29udGV4dF9wdXQoY2UpOworCXJldHVybiBl
cnI7Cit9CisKK3N0YXRpYyBpbnQgbGl2ZV9scmNfZ2FyYmFnZSh2b2lkICphcmcpCit7CisJc3Ry
dWN0IGludGVsX2d0ICpndCA9IGFyZzsKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7
CisJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisKKwkvKgorCSAqIFZlcmlmeSB0aGF0IHdlIGNh
biByZWNvdmVyIGlmIG9uZSBjb250ZXh0IHN0YXRlIGlzIGNvbXBsZXRlbHkKKwkgKiBjb3JydXB0
ZWQuCisJICovCisKKwlpZiAoIUlTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X1NFTEZURVNUX0JS
T0tFTikpCisJCXJldHVybiAwOworCisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7
CisJCUk5MTVfUk5EX1NUQVRFKHBybmcpOworCQlpbnQgZXJyID0gMCwgaTsKKworCQlpZiAoIWlu
dGVsX2hhc19yZXNldF9lbmdpbmUoZW5naW5lLT5ndCkpCisJCQljb250aW51ZTsKKworCQlpbnRl
bF9lbmdpbmVfcG1fZ2V0KGVuZ2luZSk7CisJCWZvciAoaSA9IDA7IGkgPCAzOyBpKyspIHsKKwkJ
CWVyciA9IF9fbHJjX2dhcmJhZ2UoZW5naW5lLCAmcHJuZyk7CisJCQlpZiAoZXJyKQorCQkJCWJy
ZWFrOworCQl9CisJCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKKworCQlpZiAoaWd0X2Zs
dXNoX3Rlc3QoZ3QtPmk5MTUpKQorCQkJZXJyID0gLUVJTzsKKwkJaWYgKGVycikKKwkJCXJldHVy
biBlcnI7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgX19saXZlX3BwaHdzcF9y
dW50aW1lKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKK3sKKwlzdHJ1Y3QgaW50ZWxf
Y29udGV4dCAqY2U7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJSUdUX1RJTUVPVVQoZW5k
X3RpbWUpOworCWludCBlcnI7CisKKwljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZSk7
CisJaWYgKElTX0VSUihjZSkpCisJCXJldHVybiBQVFJfRVJSKGNlKTsKKworCWNlLT5ydW50aW1l
Lm51bV91bmRlcmZsb3cgPSAwOworCWNlLT5ydW50aW1lLm1heF91bmRlcmZsb3cgPSAwOworCisJ
ZG8geworCQl1bnNpZ25lZCBpbnQgbG9vcCA9IDEwMjQ7CisKKwkJd2hpbGUgKGxvb3ApIHsKKwkJ
CXJxID0gaW50ZWxfY29udGV4dF9jcmVhdGVfcmVxdWVzdChjZSk7CisJCQlpZiAoSVNfRVJSKHJx
KSkgeworCQkJCWVyciA9IFBUUl9FUlIocnEpOworCQkJCWdvdG8gZXJyX3JxOworCQkJfQorCisJ
CQlpZiAoLS1sb29wID09IDApCisJCQkJaTkxNV9yZXF1ZXN0X2dldChycSk7CisKKwkJCWk5MTVf
cmVxdWVzdF9hZGQocnEpOworCQl9CisKKwkJaWYgKF9faWd0X3RpbWVvdXQoZW5kX3RpbWUsIE5V
TEwpKQorCQkJYnJlYWs7CisKKwkJaTkxNV9yZXF1ZXN0X3B1dChycSk7CisJfSB3aGlsZSAoMSk7
CisKKwllcnIgPSBpOTE1X3JlcXVlc3Rfd2FpdChycSwgMCwgSFogLyA1KTsKKwlpZiAoZXJyIDwg
MCkgeworCQlwcl9lcnIoIiVzOiByZXF1ZXN0IG5vdCBjb21wbGV0ZWQhXG4iLCBlbmdpbmUtPm5h
bWUpOworCQlnb3RvIGVycl93YWl0OworCX0KKworCWlndF9mbHVzaF90ZXN0KGVuZ2luZS0+aTkx
NSk7CisKKwlwcl9pbmZvKCIlczogcHBod3NwIHJ1bnRpbWUgJWxsdW5zLCBhdmVyYWdlICVsbHVu
c1xuIiwKKwkJZW5naW5lLT5uYW1lLAorCQlpbnRlbF9jb250ZXh0X2dldF90b3RhbF9ydW50aW1l
X25zKGNlKSwKKwkJaW50ZWxfY29udGV4dF9nZXRfYXZnX3J1bnRpbWVfbnMoY2UpKTsKKworCWVy
ciA9IDA7CisJaWYgKGNlLT5ydW50aW1lLm51bV91bmRlcmZsb3cpIHsKKwkJcHJfZXJyKCIlczog
cHBod3NwIHVuZGVyZmxvdyAldSB0aW1lKHMpLCBtYXggJXUgY3ljbGVzIVxuIiwKKwkJICAgICAg
IGVuZ2luZS0+bmFtZSwKKwkJICAgICAgIGNlLT5ydW50aW1lLm51bV91bmRlcmZsb3csCisJCSAg
ICAgICBjZS0+cnVudGltZS5tYXhfdW5kZXJmbG93KTsKKwkJR0VNX1RSQUNFX0RVTVAoKTsKKwkJ
ZXJyID0gLUVPVkVSRkxPVzsKKwl9CisKK2Vycl93YWl0OgorCWk5MTVfcmVxdWVzdF9wdXQocnEp
OworZXJyX3JxOgorCWludGVsX2NvbnRleHRfcHV0KGNlKTsKKwlyZXR1cm4gZXJyOworfQorCitz
dGF0aWMgaW50IGxpdmVfcHBod3NwX3J1bnRpbWUodm9pZCAqYXJnKQoreworCXN0cnVjdCBpbnRl
bF9ndCAqZ3QgPSBhcmc7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOworCWVudW0g
aW50ZWxfZW5naW5lX2lkIGlkOworCWludCBlcnIgPSAwOworCisJLyoKKwkgKiBDaGVjayB0aGF0
IGN1bXVsYXRpdmUgY29udGV4dCBydW50aW1lIGFzIHN0b3JlZCBpbiB0aGUgcHBod3NwWzE2XQor
CSAqIGlzIG1vbm90b25pYy4KKwkgKi8KKworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBp
ZCkgeworCQllcnIgPSBfX2xpdmVfcHBod3NwX3J1bnRpbWUoZW5naW5lKTsKKwkJaWYgKGVycikK
KwkJCWJyZWFrOworCX0KKworCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpCisJCWVyciA9
IC1FSU87CisKKwlyZXR1cm4gZXJyOworfQorCitpbnQgaW50ZWxfbHJjX2xpdmVfc2VsZnRlc3Rz
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQoreworCXN0YXRpYyBjb25zdCBzdHJ1Y3Qg
aTkxNV9zdWJ0ZXN0IHRlc3RzW10gPSB7CisJCVNVQlRFU1QobGl2ZV9scmNfbGF5b3V0KSwKKwkJ
U1VCVEVTVChsaXZlX2xyY19maXhlZCksCisJCVNVQlRFU1QobGl2ZV9scmNfc3RhdGUpLAorCQlT
VUJURVNUKGxpdmVfbHJjX2dwciksCisJCVNVQlRFU1QobGl2ZV9scmNfaXNvbGF0aW9uKSwKKwkJ
U1VCVEVTVChsaXZlX2xyY190aW1lc3RhbXApLAorCQlTVUJURVNUKGxpdmVfbHJjX2dhcmJhZ2Up
LAorCQlTVUJURVNUKGxpdmVfcHBod3NwX3J1bnRpbWUpLAorCQlTVUJURVNUKGxpdmVfbHJjX2lu
ZGlyZWN0X2N0eF9iYiksCisJfTsKKworCWlmICghSEFTX0xPR0lDQUxfUklOR19DT05URVhUUyhp
OTE1KSkKKwkJcmV0dXJuIDA7CisKKwlyZXR1cm4gaW50ZWxfZ3RfbGl2ZV9zdWJ0ZXN0cyh0ZXN0
cywgJmk5MTUtPmd0KTsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Vj
L2ludGVsX2d1Y19hZHMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX2d1Y19h
ZHMuYwppbmRleCAxYTJlNGY2MzE3NjMuLjE3NTI2NzE3MzY4YyAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfZ3VjX2Fkcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3VjL2ludGVsX2d1Y19hZHMuYwpAQCAtMyw4ICszLDggQEAKICAqIENvcHlyaWdo
dCDCqSAyMDE0LTIwMTkgSW50ZWwgQ29ycG9yYXRpb24KICAqLwogCi0jaW5jbHVkZSAiZ3QvaW50
ZWxfZXhlY2xpc3RzX3N1Ym1pc3Npb24uaCIgLyogbHJjIGxheW91dCAqLwogI2luY2x1ZGUgImd0
L2ludGVsX2d0LmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfbHJjLmgiCiAjaW5jbHVkZSAiaW50ZWxf
Z3VjX2Fkcy5oIgogI2luY2x1ZGUgImludGVsX3VjLmgiCiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX2d1Y19zdWJtaXNz
aW9uLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF9ndWNfc3VibWlzc2lvbi5j
CmluZGV4IDg1MjhhYjU3NGRiZS4uYjA3YzI4ZmE5MDFmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC91Yy9pbnRlbF9ndWNfc3VibWlzc2lvbi5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3VjL2ludGVsX2d1Y19zdWJtaXNzaW9uLmMKQEAgLTExLDcgKzExLDcgQEAK
ICNpbmNsdWRlICJndC9pbnRlbF9leGVjbGlzdHNfc3VibWlzc2lvbi5oIiAvKiBYWFggKi8KICNp
bmNsdWRlICJndC9pbnRlbF9ndC5oIgogI2luY2x1ZGUgImd0L2ludGVsX2d0X3BtLmgiCi0jaW5j
bHVkZSAiZ3QvaW50ZWxfbHJjX3JlZy5oIgorI2luY2x1ZGUgImd0L2ludGVsX2xyYy5oIgogI2lu
Y2x1ZGUgImd0L2ludGVsX3JpbmcuaCIKIAogI2luY2x1ZGUgImludGVsX2d1Y19zdWJtaXNzaW9u
LmgiCkBAIC00MjEsNyArNDIxLDcgQEAgc3RhdGljIHZvaWQgZ3VjX3Jlc2V0X3Jld2luZChzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIGJvb2wgc3RhbGxlZCkKIAkJc3RhbGxlZCA9IGZh
bHNlOwogCiAJX19pOTE1X3JlcXVlc3RfcmVzZXQocnEsIHN0YWxsZWQpOwotCWludGVsX2xyX2Nv
bnRleHRfcmVzZXQoZW5naW5lLCBycS0+Y29udGV4dCwgcnEtPmhlYWQsIHN0YWxsZWQpOworCWxy
Y19yZXNldChycS0+Y29udGV4dCwgZW5naW5lLCBycS0+aGVhZCwgc3RhbGxlZCk7CiAKIG91dF91
bmxvY2s6CiAJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmZW5naW5lLT5hY3RpdmUubG9jaywgZmxh
Z3MpOwotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRl
bC1nZngK

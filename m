Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4D3CD90754
	for <lists+intel-gfx@lfdr.de>; Fri, 16 Aug 2019 19:58:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 23E666E968;
	Fri, 16 Aug 2019 17:58:21 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id EFEFD6E968
 for <intel-gfx@lists.freedesktop.org>; Fri, 16 Aug 2019 17:58:19 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18166575-1500050 
 for multiple; Fri, 16 Aug 2019 18:58:03 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 16 Aug 2019 18:58:01 +0100
Message-Id: <20190816175801.8215-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/selftests: Check the context size
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWRkIGEgcmVkem9uZSB0byBvdXIgY29udGV4dCBpbWFnZSBhbmQgY2hlY2sgdGhlIEhXIGRvZXMg
bm90IHdyaXRlIGludG8KYWZ0ZXIgYSBjb250ZXh0IHNhdmUsIHRvIHZlcmlmeSB0aGF0IHdlIGhh
dmUgdGhlIGNvcnJlY3QgY29udGV4dCBzaXplLgooVGhpcyBkb2VzIHZhcnkgd2l0aCBmZWF0dXJl
IGJpdHMsIHNvIHRlc3Qgd2l0aCBhIGxpdmUgc2V0dXAgdGhhdCBzaG91bGQKbWF0Y2ggaG93IHdl
IHJ1biB1c2Vyc3BhY2UuKQoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJp
cy13aWxzb24uY28udWs+CkNjOiBEYW5pZWxlIENlcmFvbG8gU3B1cmlvIDxkYW5pZWxlLmNlcmFv
bG9zcHVyaW9AaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0
X2NvbnRleHQuYyB8IDEzMyArKysrKysrKysrKysrKysrKysrKysKIDEgZmlsZSBjaGFuZ2VkLCAx
MzMgaW5zZXJ0aW9ucygrKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Nl
bGZ0ZXN0X2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRl
eHQuYwppbmRleCA2ZmJjNzJiYzI5MGUuLjY5ZjIyMzMxMDRmMSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYwpAQCAtNSw2ICs1LDcgQEAKICAqLwogCiAjaW5j
bHVkZSAiaTkxNV9zZWxmdGVzdC5oIgorI2luY2x1ZGUgImludGVsX2VuZ2luZV9wbS5oIgogI2lu
Y2x1ZGUgImludGVsX2d0LmgiCiAKICNpbmNsdWRlICJnZW0vc2VsZnRlc3RzL21vY2tfY29udGV4
dC5oIgpAQCAtNjQsNiArNjUsMTM3IEBAIHN0YXRpYyBpbnQgY29udGV4dF9zeW5jKHN0cnVjdCBp
bnRlbF9jb250ZXh0ICpjZSkKIAlyZXR1cm4gZXJyOwogfQogCitzdGF0aWMgaW50IF9fbGl2ZV9j
b250ZXh0X3NpemUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAorCQkJICAgICAgIHN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpmaXhtZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfY29udGV4dCAq
Y2U7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJdm9pZCAqdmFkZHI7CisJaW50IGVycjsK
KworCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZml4bWUsIGVuZ2luZSk7CisJaWYgKElTX0VS
UihjZSkpCisJCXJldHVybiBQVFJfRVJSKGNlKTsKKworCWVyciA9IGludGVsX2NvbnRleHRfcGlu
KGNlKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycjsKKworCXZhZGRyID0gaTkxNV9nZW1fb2JqZWN0
X3Bpbl9tYXAoY2UtPnN0YXRlLT5vYmosCisJCQkJCWk5MTVfY29oZXJlbnRfbWFwX3R5cGUoZW5n
aW5lLT5pOTE1KSk7CisJaWYgKElTX0VSUih2YWRkcikpIHsKKwkJZXJyID0gUFRSX0VSUih2YWRk
cik7CisJCWludGVsX2NvbnRleHRfdW5waW4oY2UpOworCQlnb3RvIGVycjsKKwl9CisKKwlpZiAo
SEFTX0VYRUNMSVNUUyhlbmdpbmUtPmk5MTUpKQorCQl2YWRkciArPSBMUkNfSEVBREVSX1BBR0VT
ICogUEFHRV9TSVpFOworCisJdmFkZHIgKz0gZW5naW5lLT5jb250ZXh0X3NpemUgLSBJOTE1X0dU
VF9QQUdFX1NJWkU7CisJbWVtc2V0KHZhZGRyLCBQT0lTT05fSU5VU0UsIEk5MTVfR1RUX1BBR0Vf
U0laRSk7CisKKwlycSA9IGludGVsX2NvbnRleHRfY3JlYXRlX3JlcXVlc3QoY2UpOworCWludGVs
X2NvbnRleHRfdW5waW4oY2UpOworCWlmIChJU19FUlIocnEpKSB7CisJCWVyciA9IFBUUl9FUlIo
cnEpOworCQlnb3RvIGVycl91bnBpbjsKKwl9CisKKwllcnIgPSByZXF1ZXN0X3N5bmMocnEpOwor
CWlmIChlcnIpCisJCWdvdG8gZXJyX3VucGluOworCisJLyogRm9yY2UgdGhlIGNvbnRleHQgc3dp
dGNoICovCisJcnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKGVuZ2luZS0+a2VybmVsX2NvbnRleHQp
OworCWlmIChJU19FUlIocnEpKSB7CisJCWVyciA9IFBUUl9FUlIocnEpOworCQlnb3RvIGVycl91
bnBpbjsKKwl9CisJZXJyID0gcmVxdWVzdF9zeW5jKHJxKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVy
cl91bnBpbjsKKworCWlmIChtZW1jaHJfaW52KHZhZGRyLCBQT0lTT05fSU5VU0UsIEk5MTVfR1RU
X1BBR0VfU0laRSkpIHsKKwkJcHJfZXJyKCIlcyBjb250ZXh0IG92ZXJ3cm90ZSB0cmFpbGluZyBy
ZWQtem9uZSEiLCBlbmdpbmUtPm5hbWUpOworCQllcnIgPSAtRUlOVkFMOworCX0KKworZXJyX3Vu
cGluOgorCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAoY2UtPnN0YXRlLT5vYmopOworZXJyOgor
CWludGVsX2NvbnRleHRfcHV0KGNlKTsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgaW50IGxp
dmVfY29udGV4dF9zaXplKHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJn
OworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKKwlzdHJ1Y3QgaTkxNV9nZW1fY29u
dGV4dCAqZml4bWU7CisJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisJc3RydWN0IGRybV9maWxl
ICpmaWxlOworCWludCBlcnIgPSAwOworCisJLyoKKwkgKiBDaGVjayB0aGF0IGFyZSBjb250ZXh0
IHNpemVzIGFyZSBjb3JyZWN0IGJ5IHNlZWluZyBpZiB0aGUKKwkgKiBIVyB0cmllcyB0byB3cml0
ZSBwYXN0IHRoZSBlbmQgb2Ygb25lLgorCSAqLworCisJZmlsZSA9IG1vY2tfZmlsZShndC0+aTkx
NSk7CisJaWYgKElTX0VSUihmaWxlKSkKKwkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CisKKwltdXRl
eF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisKKwlmaXhtZSA9IGxpdmVfY29u
dGV4dChndC0+aTkxNSwgZmlsZSk7CisJaWYgKElTX0VSUihmaXhtZSkpIHsKKwkJZXJyID0gUFRS
X0VSUihmaXhtZSk7CisJCWdvdG8gdW5sb2NrOworCX0KKworCWZvcl9lYWNoX2VuZ2luZShlbmdp
bmUsIGd0LT5pOTE1LCBpZCkgeworCQlzdHJ1Y3QgeworCQkJc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKnN0YXRlOworCQkJdm9pZCAqcGlubmVkOworCQl9IHNhdmVkOworCisJCWlmICghZW5n
aW5lLT5jb250ZXh0X3NpemUpCisJCQljb250aW51ZTsKKworCQlpbnRlbF9lbmdpbmVfcG1fZ2V0
KGVuZ2luZSk7CisKKwkJLyoKKwkJICogSGlkZSB0aGUgb2xkIGRlZmF1bHQgc3RhdGUgLS0gd2Ug
bGllIGFib3V0IHRoZSBjb250ZXh0IHNpemUKKwkJICogYW5kIGdldCBjb25mdXNlZCB3aGVuIHRo
ZSBkZWZhdWx0IHN0YXRlIGlzIHNtYWxsZXIgdGhhbgorCQkgKiBleHBlY3RlZC4gRm9yIG91ciBk
byBub3RoaW5nIHJlcXVlc3QsIGluaGVyaXRpbmcgdGhlCisJCSAqIGFjdGl2ZSBzdGF0ZSBpcyBz
dWZmaWNpZW50LCB3ZSBhcmUgb25seSBjaGVja2luZyB0aGF0IHdlCisJCSAqIGRvbid0IHVzZSBt
b3JlIHRoYW4gd2UgcGxhbm5lZC4KKwkJICovCisJCXNhdmVkLnN0YXRlID0gZmV0Y2hfYW5kX3pl
cm8oJmVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSk7CisJCXNhdmVkLnBpbm5lZCA9IGZldGNoX2FuZF96
ZXJvKCZlbmdpbmUtPnBpbm5lZF9kZWZhdWx0X3N0YXRlKTsKKworCQllbmdpbmUtPmNvbnRleHRf
c2l6ZSArPSBJOTE1X0dUVF9QQUdFX1NJWkU7CisKKwkJZXJyID0gX19saXZlX2NvbnRleHRfc2l6
ZShlbmdpbmUsIGZpeG1lKTsKKworCQllbmdpbmUtPmNvbnRleHRfc2l6ZSAtPSBJOTE1X0dUVF9Q
QUdFX1NJWkU7CisKKwkJZW5naW5lLT5waW5uZWRfZGVmYXVsdF9zdGF0ZSA9IHNhdmVkLnBpbm5l
ZDsKKwkJZW5naW5lLT5kZWZhdWx0X3N0YXRlID0gc2F2ZWQuc3RhdGU7CisKKwkJaW50ZWxfZW5n
aW5lX3BtX3B1dChlbmdpbmUpOworCisJCWlmIChlcnIpCisJCQlicmVhazsKKwl9CisKK3VubG9j
azoKKwltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwltb2NrX2Zp
bGVfZnJlZShndC0+aTkxNSwgZmlsZSk7CisJcmV0dXJuIGVycjsKK30KKwogc3RhdGljIGludCBf
X2xpdmVfYWN0aXZlX2NvbnRleHQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCQkJ
CSBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqZml4bWUpCiB7CkBAIC0zMDMsNiArNDM1LDcgQEAg
c3RhdGljIGludCBsaXZlX3JlbW90ZV9jb250ZXh0KHZvaWQgKmFyZykKIGludCBpbnRlbF9jb250
ZXh0X2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0
YXRpYyBjb25zdCBzdHJ1Y3QgaTkxNV9zdWJ0ZXN0IHRlc3RzW10gPSB7CisJCVNVQlRFU1QobGl2
ZV9jb250ZXh0X3NpemUpLAogCQlTVUJURVNUKGxpdmVfYWN0aXZlX2NvbnRleHQpLAogCQlTVUJU
RVNUKGxpdmVfcmVtb3RlX2NvbnRleHQpLAogCX07Ci0tIAoyLjIzLjAucmMxCgpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBs
aXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4ABBBDA973
	for <lists+intel-gfx@lfdr.de>; Thu, 17 Oct 2019 11:57:29 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 721966EA3E;
	Thu, 17 Oct 2019 09:57:27 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E7F0F6EA44
 for <intel-gfx@lists.freedesktop.org>; Thu, 17 Oct 2019 09:57:25 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18867117-1500050 
 for multiple; Thu, 17 Oct 2019 10:57:11 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 17 Oct 2019 10:57:10 +0100
Message-Id: <20191017095710.4272-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191017094500.21831-1-tvrtko.ursulin@linux.intel.com>
References: <20191017094500.21831-1-tvrtko.ursulin@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2] drm/i915: Make for_each_engine_masked work
 on intel_gt
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KCk1lZGl1bSB0
ZXJtIGdvYWwgaXMgdG8gZWxpbWluYXRlIHRoZSBpOTE1LT5lbmdpbmVbXSBhcnJheSBhbmQgdG8g
Z2V0IHRoZXJlCndlIGhhdmUgcmVjZW50bHkgaW50cm9kdWNlZCBlcXVpdmFsZW50IGFycmF5IGlu
IGludGVsX2d0LiBOb3cgd2UgbmVlZCB0bwptaWdyYXRlIHRoZSBjb2RlIGZ1cnRoZXIgdG93YXJk
cyB0aGlzIHN0YXRlLgoKVGhpcyBuZXh0IHN0ZXAgaXMgdG8gZWxpbWluYXRlIHVzYWdlIG9mIGk5
MTUtPmVuZ2luZXNbXSBmcm9tIHRoZQpmb3JfZWFjaF9lbmdpbmVfbWFza2VkIGl0ZXJhdG9yLgoK
Rm9yIHRoaXMgdG8gd29yayB3ZSBhbHNvIG5lZWQgdG8gdXNlIGVuZ2luZS0+aWQgYXMgaW5kZXgg
d2hlbiBwb3B1bGF0aW5nCnRoZSBndC0+ZW5naW5lW10gYXJyYXkgYW5kIGFkanVzdCB0aGUgZGVm
YXVsdCBlbmdpbmUgc2V0IGluZGV4aW5nIHRvIHVzZQplbmdpbmUtPmxlZ2FjeV9pZHggaW5zdGVh
ZCBvZiBhc3N1bWluZyBndC0+ZW5naW5lc1tdIGluZGV4aW5nLgoKdjI6CiAgKiBQb3B1bGF0ZSBn
dC0+ZW5naW5lW10gZWFybGllci4KICAqIENoZWNrIHRoYXQgd2UgZG9uJ3QgZHVwbGljYXRlIGVu
Z2luZS0+bGVnYWN5X2lkeAoKU2lnbmVkLW9mZi1ieTogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51
cnN1bGluQGludGVsLmNvbT4KQ2M6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNv
LnVrPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgIHwg
MTMgKysrKysrKysrKy0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2Nz
LmMgICAgfCAgNCArKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlw
ZXMuaCB8ICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV91c2VyLmMg
IHwgMTQgKysrLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0LmMg
ICAgICAgICAgIHwgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2hhbmdjaGVj
ay5jICAgIHwgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMgICAg
ICAgIHwgMTIgKysrKysrLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZXhlY2xpc3Qu
YyAgICAgICAgICB8ICA0ICsrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIu
YyAgICAgICAgIHwgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMgICAg
ICAgICAgIHwgIDQgKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAgICAgICAg
ICAgICAgfCAgNiArKystLS0KIDExIGZpbGVzIGNoYW5nZWQsIDM0IGluc2VydGlvbnMoKyksIDMw
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4
dC5jCmluZGV4IDVkODIyMWM3YmE4My4uNWUxZDg5YTU3MjFiIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKQEAgLTIwMywxNSArMjAzLDIyIEBAIHN0YXRp
YyBzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lcyAqZGVmYXVsdF9lbmdpbmVzKHN0cnVjdCBpOTE1X2dl
bV9jb250ZXh0ICpjdHgpCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7CiAJCXN0
cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAorCQlpZiAoZW5naW5lLT5sZWdhY3lfaWR4ID09IElO
VkFMSURfRU5HSU5FKQorCQkJY29udGludWU7CisKKwkJR0VNX0JVR19PTihlbmdpbmUtPmxlZ2Fj
eV9pZHggPiBJOTE1X05VTV9FTkdJTkVTKTsKKwkJR0VNX0JVR19PTihlLT5lbmdpbmVzW2VuZ2lu
ZS0+bGVnYWN5X2lkeF0pOworCiAJCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoY3R4LCBlbmdp
bmUpOwogCQlpZiAoSVNfRVJSKGNlKSkgewotCQkJX19mcmVlX2VuZ2luZXMoZSwgaWQpOworCQkJ
X19mcmVlX2VuZ2luZXMoZSwgZS0+bnVtX2VuZ2luZXMgKyAxKTsKIAkJCXJldHVybiBFUlJfQ0FT
VChjZSk7CiAJCX0KIAotCQllLT5lbmdpbmVzW2lkXSA9IGNlOwotCQllLT5udW1fZW5naW5lcyA9
IGlkICsgMTsKKwkJZS0+ZW5naW5lc1tlbmdpbmUtPmxlZ2FjeV9pZHhdID0gY2U7CisJCWUtPm51
bV9lbmdpbmVzID0gbWF4KGUtPm51bV9lbmdpbmVzLCBlbmdpbmUtPmxlZ2FjeV9pZHgpOwogCX0K
KwllLT5udW1fZW5naW5lcysrOwogCiAJcmV0dXJuIGU7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2VuZ2luZV9jcy5jCmluZGV4IDUwNTFhMWZkMjU2NS4uNGRjZGI5MDliNjJkIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYwpAQCAtMjc3LDYgKzI3
Nyw5IEBAIHN0YXRpYyBpbnQgaW50ZWxfZW5naW5lX3NldHVwKHN0cnVjdCBpbnRlbF9ndCAqZ3Qs
IGVudW0gaW50ZWxfZW5naW5lX2lkIGlkKQogCUJVSUxEX0JVR19PTihNQVhfRU5HSU5FX0NMQVNT
ID49IEJJVChHRU4xMV9FTkdJTkVfQ0xBU1NfV0lEVEgpKTsKIAlCVUlMRF9CVUdfT04oTUFYX0VO
R0lORV9JTlNUQU5DRSA+PSBCSVQoR0VOMTFfRU5HSU5FX0lOU1RBTkNFX1dJRFRIKSk7CiAKKwlp
ZiAoR0VNX0RFQlVHX1dBUk5fT04oaWQgPj0gQVJSQVlfU0laRShndC0+ZW5naW5lKSkpCisJCXJl
dHVybiAtRUlOVkFMOworCiAJaWYgKEdFTV9ERUJVR19XQVJOX09OKGluZm8tPmNsYXNzID4gTUFY
X0VOR0lORV9DTEFTUykpCiAJCXJldHVybiAtRUlOVkFMOwogCkBAIC0zMjgsNiArMzMxLDcgQEAg
c3RhdGljIGludCBpbnRlbF9lbmdpbmVfc2V0dXAoc3RydWN0IGludGVsX2d0ICpndCwgZW51bSBp
bnRlbF9lbmdpbmVfaWQgaWQpCiAJaW50ZWxfZW5naW5lX3Nhbml0aXplX21taW8oZW5naW5lKTsK
IAogCWd0LT5lbmdpbmVfY2xhc3NbaW5mby0+Y2xhc3NdW2luZm8tPmluc3RhbmNlXSA9IGVuZ2lu
ZTsKKwlndC0+ZW5naW5lW2lkXSA9IGVuZ2luZTsKIAogCWludGVsX2VuZ2luZV9hZGRfdXNlcihl
bmdpbmUpOwogCWd0LT5pOTE1LT5lbmdpbmVbaWRdID0gZW5naW5lOwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmggYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMuaAppbmRleCA2MTk5MDY0ZjMzMmIuLjM0NTFi
ZTAzNGNhZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5l
X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVz
LmgKQEAgLTE0OCw2ICsxNDgsNyBAQCBlbnVtIGludGVsX2VuZ2luZV9pZCB7CiAJVkVDUzEsCiAj
ZGVmaW5lIF9WRUNTKG4pIChWRUNTMCArIChuKSkKIAlJOTE1X05VTV9FTkdJTkVTCisjZGVmaW5l
IElOVkFMSURfRU5HSU5FICgoZW51bSBpbnRlbF9lbmdpbmVfaWQpLTEpCiB9OwogCiBzdHJ1Y3Qg
c3RfcHJlZW1wdF9oYW5nIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2VuZ2luZV91c2VyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVf
dXNlci5jCmluZGV4IDc3Y2Q1ZGU4MzkzMC4uMWUyOGJmZWFiNTE5IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdXNlci5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV91c2VyLmMKQEAgLTE3MSwyMyArMTcxLDE1IEBAIHN0
YXRpYyBpbnQgbGVnYWN5X3JpbmdfaWR4KGNvbnN0IHN0cnVjdCBsZWdhY3lfcmluZyAqcmluZykK
IHN0YXRpYyB2b2lkIGFkZF9sZWdhY3lfcmluZyhzdHJ1Y3QgbGVnYWN5X3JpbmcgKnJpbmcsCiAJ
CQkgICAgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewotCWludCBpZHg7Ci0KIAlp
ZiAoZW5naW5lLT5ndCAhPSByaW5nLT5ndCB8fCBlbmdpbmUtPmNsYXNzICE9IHJpbmctPmNsYXNz
KSB7CiAJCXJpbmctPmd0ID0gZW5naW5lLT5ndDsKIAkJcmluZy0+Y2xhc3MgPSBlbmdpbmUtPmNs
YXNzOwogCQlyaW5nLT5pbnN0YW5jZSA9IDA7CiAJfQogCi0JaWR4ID0gbGVnYWN5X3JpbmdfaWR4
KHJpbmcpOwotCWlmICh1bmxpa2VseShpZHggPT0gLTEpKQotCQlyZXR1cm47Ci0KLQlHRU1fQlVH
X09OKGlkeCA+PSBBUlJBWV9TSVpFKHJpbmctPmd0LT5lbmdpbmUpKTsKLQlyaW5nLT5ndC0+ZW5n
aW5lW2lkeF0gPSBlbmdpbmU7Ci0JcmluZy0+aW5zdGFuY2UrKzsKLQotCWVuZ2luZS0+bGVnYWN5
X2lkeCA9IGlkeDsKKwllbmdpbmUtPmxlZ2FjeV9pZHggPSBsZWdhY3lfcmluZ19pZHgocmluZyk7
CisJaWYgKGVuZ2luZS0+bGVnYWN5X2lkeCAhPSBJTlZBTElEX0VOR0lORSkKKwkJcmluZy0+aW5z
dGFuY2UrKzsKIH0KIAogdm9pZCBpbnRlbF9lbmdpbmVzX2RyaXZlcl9yZWdpc3RlcihzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2d0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jCmluZGV4
IGIzNjE5YTJhNWQwZS4uYzk5YjZiMmYzOGMyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9ndC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0
LmMKQEAgLTE4Niw3ICsxODYsNyBAQCBpbnRlbF9ndF9jbGVhcl9lcnJvcl9yZWdpc3RlcnMoc3Ry
dWN0IGludGVsX2d0ICpndCwKIAkJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCQll
bnVtIGludGVsX2VuZ2luZV9pZCBpZDsKIAotCQlmb3JfZWFjaF9lbmdpbmVfbWFza2VkKGVuZ2lu
ZSwgaTkxNSwgZW5naW5lX21hc2ssIGlkKQorCQlmb3JfZWFjaF9lbmdpbmVfbWFza2VkKGVuZ2lu
ZSwgZ3QsIGVuZ2luZV9tYXNrLCBpZCkKIAkJCWdlbjhfY2xlYXJfZW5naW5lX2Vycm9yX3JlZ2lz
dGVyKGVuZ2luZSk7CiAJfQogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfaGFuZ2NoZWNrLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9oYW5nY2hl
Y2suYwppbmRleCBjMTRkYmViM2NjYzMuLmIyYWY3Mzk4NGY5MyAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfaGFuZ2NoZWNrLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfaGFuZ2NoZWNrLmMKQEAgLTIzNyw3ICsyMzcsNyBAQCBzdGF0aWMgdm9p
ZCBoYW5nY2hlY2tfZGVjbGFyZV9oYW5nKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCiAJCWh1bmcgJj0g
fnN0dWNrOwogCWxlbiA9IHNjbnByaW50Zihtc2csIHNpemVvZihtc2cpLAogCQkJIiVzIG9uICIs
IHN0dWNrID09IGh1bmcgPyAibm8gcHJvZ3Jlc3MiIDogImhhbmciKTsKLQlmb3JfZWFjaF9lbmdp
bmVfbWFza2VkKGVuZ2luZSwgZ3QtPmk5MTUsIGh1bmcsIHRtcCkKKwlmb3JfZWFjaF9lbmdpbmVf
bWFza2VkKGVuZ2luZSwgZ3QsIGh1bmcsIHRtcCkKIAkJbGVuICs9IHNjbnByaW50Zihtc2cgKyBs
ZW4sIHNpemVvZihtc2cpIC0gbGVuLAogCQkJCSAiJXMsICIsIGVuZ2luZS0+bmFtZSk7CiAJbXNn
W2xlbi0yXSA9ICdcMCc7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9yZXNldC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYwppbmRleCA0
NzdiZmFmZGIxMDMuLmIxOTFiMDc0NTcwMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfcmVzZXQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9y
ZXNldC5jCkBAIC0yOTgsNyArMjk4LDcgQEAgc3RhdGljIGludCBnZW42X3Jlc2V0X2VuZ2luZXMo
c3RydWN0IGludGVsX2d0ICpndCwKIAkJaW50ZWxfZW5naW5lX21hc2tfdCB0bXA7CiAKIAkJaHdf
bWFzayA9IDA7Ci0JCWZvcl9lYWNoX2VuZ2luZV9tYXNrZWQoZW5naW5lLCBndC0+aTkxNSwgZW5n
aW5lX21hc2ssIHRtcCkgeworCQlmb3JfZWFjaF9lbmdpbmVfbWFza2VkKGVuZ2luZSwgZ3QsIGVu
Z2luZV9tYXNrLCB0bXApIHsKIAkJCUdFTV9CVUdfT04oZW5naW5lLT5pZCA+PSBBUlJBWV9TSVpF
KGh3X2VuZ2luZV9tYXNrKSk7CiAJCQlod19tYXNrIHw9IGh3X2VuZ2luZV9tYXNrW2VuZ2luZS0+
aWRdOwogCQl9CkBAIC00MzIsNyArNDMyLDcgQEAgc3RhdGljIGludCBnZW4xMV9yZXNldF9lbmdp
bmVzKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCiAJCWh3X21hc2sgPSBHRU4xMV9HUkRPTV9GVUxMOwog
CX0gZWxzZSB7CiAJCWh3X21hc2sgPSAwOwotCQlmb3JfZWFjaF9lbmdpbmVfbWFza2VkKGVuZ2lu
ZSwgZ3QtPmk5MTUsIGVuZ2luZV9tYXNrLCB0bXApIHsKKwkJZm9yX2VhY2hfZW5naW5lX21hc2tl
ZChlbmdpbmUsIGd0LCBlbmdpbmVfbWFzaywgdG1wKSB7CiAJCQlHRU1fQlVHX09OKGVuZ2luZS0+
aWQgPj0gQVJSQVlfU0laRShod19lbmdpbmVfbWFzaykpOwogCQkJaHdfbWFzayB8PSBod19lbmdp
bmVfbWFza1tlbmdpbmUtPmlkXTsKIAkJCXJldCA9IGdlbjExX2xvY2tfc2ZjKGVuZ2luZSwgJmh3
X21hc2spOwpAQCAtNDUxLDcgKzQ1MSw3IEBAIHN0YXRpYyBpbnQgZ2VuMTFfcmVzZXRfZW5naW5l
cyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCSAqIGV4cGlyYXRpb24pLgogCSAqLwogCWlmIChlbmdp
bmVfbWFzayAhPSBBTExfRU5HSU5FUykKLQkJZm9yX2VhY2hfZW5naW5lX21hc2tlZChlbmdpbmUs
IGd0LT5pOTE1LCBlbmdpbmVfbWFzaywgdG1wKQorCQlmb3JfZWFjaF9lbmdpbmVfbWFza2VkKGVu
Z2luZSwgZ3QsIGVuZ2luZV9tYXNrLCB0bXApCiAJCQlnZW4xMV91bmxvY2tfc2ZjKGVuZ2luZSk7
CiAKIAlyZXR1cm4gcmV0OwpAQCAtNTEwLDcgKzUxMCw3IEBAIHN0YXRpYyBpbnQgZ2VuOF9yZXNl
dF9lbmdpbmVzKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCiAJaW50ZWxfZW5naW5lX21hc2tfdCB0bXA7
CiAJaW50IHJldDsKIAotCWZvcl9lYWNoX2VuZ2luZV9tYXNrZWQoZW5naW5lLCBndC0+aTkxNSwg
ZW5naW5lX21hc2ssIHRtcCkgeworCWZvcl9lYWNoX2VuZ2luZV9tYXNrZWQoZW5naW5lLCBndCwg
ZW5naW5lX21hc2ssIHRtcCkgewogCQlyZXQgPSBnZW44X2VuZ2luZV9yZXNldF9wcmVwYXJlKGVu
Z2luZSk7CiAJCWlmIChyZXQgJiYgIXJlc2V0X25vbl9yZWFkeSkKIAkJCWdvdG8gc2tpcF9yZXNl
dDsKQEAgLTUzNiw3ICs1MzYsNyBAQCBzdGF0aWMgaW50IGdlbjhfcmVzZXRfZW5naW5lcyhzdHJ1
Y3QgaW50ZWxfZ3QgKmd0LAogCQlyZXQgPSBnZW42X3Jlc2V0X2VuZ2luZXMoZ3QsIGVuZ2luZV9t
YXNrLCByZXRyeSk7CiAKIHNraXBfcmVzZXQ6Ci0JZm9yX2VhY2hfZW5naW5lX21hc2tlZChlbmdp
bmUsIGd0LT5pOTE1LCBlbmdpbmVfbWFzaywgdG1wKQorCWZvcl9lYWNoX2VuZ2luZV9tYXNrZWQo
ZW5naW5lLCBndCwgZW5naW5lX21hc2ssIHRtcCkKIAkJZ2VuOF9lbmdpbmVfcmVzZXRfY2FuY2Vs
KGVuZ2luZSk7CiAKIAlyZXR1cm4gcmV0OwpAQCAtMTIwNiw3ICsxMjA2LDcgQEAgdm9pZCBpbnRl
bF9ndF9oYW5kbGVfZXJyb3Ioc3RydWN0IGludGVsX2d0ICpndCwKIAkgKiBzaW5nbGUgcmVzZXQg
ZmFpbHMuCiAJICovCiAJaWYgKGludGVsX2hhc19yZXNldF9lbmdpbmUoZ3QpICYmICFpbnRlbF9n
dF9pc193ZWRnZWQoZ3QpKSB7Ci0JCWZvcl9lYWNoX2VuZ2luZV9tYXNrZWQoZW5naW5lLCBndC0+
aTkxNSwgZW5naW5lX21hc2ssIHRtcCkgeworCQlmb3JfZWFjaF9lbmdpbmVfbWFza2VkKGVuZ2lu
ZSwgZ3QsIGVuZ2luZV9tYXNrLCB0bXApIHsKIAkJCUJVSUxEX0JVR19PTihJOTE1X1JFU0VUX01P
REVTRVQgPj0gSTkxNV9SRVNFVF9FTkdJTkUpOwogCQkJaWYgKHRlc3RfYW5kX3NldF9iaXQoSTkx
NV9SRVNFVF9FTkdJTkUgKyBlbmdpbmUtPmlkLAogCQkJCQkgICAgICZndC0+cmVzZXQuZmxhZ3Mp
KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2V4ZWNsaXN0LmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndnQvZXhlY2xpc3QuYwppbmRleCBmMjFiOGZiNWIzN2UuLmQ2ZTdh
MTE4OWJhZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2V4ZWNsaXN0LmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2V4ZWNsaXN0LmMKQEAgLTUzNCw3ICs1MzQs
NyBAQCBzdGF0aWMgdm9pZCBjbGVhbl9leGVjbGlzdChzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSwK
IAlzdHJ1Y3QgaW50ZWxfdmdwdV9zdWJtaXNzaW9uICpzID0gJnZncHUtPnN1Ym1pc3Npb247CiAJ
aW50ZWxfZW5naW5lX21hc2tfdCB0bXA7CiAKLQlmb3JfZWFjaF9lbmdpbmVfbWFza2VkKGVuZ2lu
ZSwgZGV2X3ByaXYsIGVuZ2luZV9tYXNrLCB0bXApIHsKKwlmb3JfZWFjaF9lbmdpbmVfbWFza2Vk
KGVuZ2luZSwgJmRldl9wcml2LT5ndCwgZW5naW5lX21hc2ssIHRtcCkgewogCQlrZnJlZShzLT5y
aW5nX3NjYW5fYnVmZmVyW2VuZ2luZS0+aWRdKTsKIAkJcy0+cmluZ19zY2FuX2J1ZmZlcltlbmdp
bmUtPmlkXSA9IE5VTEw7CiAJCXMtPnJpbmdfc2Nhbl9idWZmZXJfc2l6ZVtlbmdpbmUtPmlkXSA9
IDA7CkBAIC01NDgsNyArNTQ4LDcgQEAgc3RhdGljIHZvaWQgcmVzZXRfZXhlY2xpc3Qoc3RydWN0
IGludGVsX3ZncHUgKnZncHUsCiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCWlu
dGVsX2VuZ2luZV9tYXNrX3QgdG1wOwogCi0JZm9yX2VhY2hfZW5naW5lX21hc2tlZChlbmdpbmUs
IGRldl9wcml2LCBlbmdpbmVfbWFzaywgdG1wKQorCWZvcl9lYWNoX2VuZ2luZV9tYXNrZWQoZW5n
aW5lLCAmZGV2X3ByaXYtPmd0LCBlbmdpbmVfbWFzaywgdG1wKQogCQlpbml0X3ZncHVfZXhlY2xp
c3QodmdwdSwgZW5naW5lLT5pZCk7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d2dC9zY2hlZHVsZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIu
YwppbmRleCA2ODUwZjFmNDAyNDEuLjllYmIyNTM0NTU4YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2
dC9zY2hlZHVsZXIuYwpAQCAtODg3LDcgKzg4Nyw3IEBAIHZvaWQgaW50ZWxfdmdwdV9jbGVhbl93
b3JrbG9hZHMoc3RydWN0IGludGVsX3ZncHUgKnZncHUsCiAJaW50ZWxfZW5naW5lX21hc2tfdCB0
bXA7CiAKIAkvKiBmcmVlIHRoZSB1bnN1Ym1pdGVkIHdvcmtsb2FkcyBpbiB0aGUgcXVldWVzLiAq
LwotCWZvcl9lYWNoX2VuZ2luZV9tYXNrZWQoZW5naW5lLCBkZXZfcHJpdiwgZW5naW5lX21hc2ss
IHRtcCkgeworCWZvcl9lYWNoX2VuZ2luZV9tYXNrZWQoZW5naW5lLCAmZGV2X3ByaXYtPmd0LCBl
bmdpbmVfbWFzaywgdG1wKSB7CiAJCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShwb3MsIG4sCiAJ
CQkmcy0+d29ya2xvYWRfcV9oZWFkW2VuZ2luZS0+aWRdLCBsaXN0KSB7CiAJCQlsaXN0X2RlbF9p
bml0KCZwb3MtPmxpc3QpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9h
Y3RpdmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMKaW5kZXggYWEzN2Mw
NzAwNGI5Li43OTI3YjFhMGM3YTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfYWN0aXZlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYwpAQCAt
NTkwLDggKzU5MCw4IEBAIHN0YXRpYyBzdHJ1Y3QgYWN0aXZlX25vZGUgKnJldXNlX2lkbGVfYmFy
cmllcihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgdTY0IGlkeCkKIGludCBpOTE1X2FjdGl2ZV9h
Y3F1aXJlX3ByZWFsbG9jYXRlX2JhcnJpZXIoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCiAJCQkJ
CSAgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSBlbmdpbmUtPmk5MTU7CiAJaW50ZWxfZW5naW5lX21hc2tfdCB0bXAs
IG1hc2sgPSBlbmdpbmUtPm1hc2s7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGVuZ2luZS0+Z3Q7
CiAJc3RydWN0IGxsaXN0X25vZGUgKnBvcywgKm5leHQ7CiAJaW50IGVycjsKIApAQCAtNjAzLDcg
KzYwMyw3IEBAIGludCBpOTE1X2FjdGl2ZV9hY3F1aXJlX3ByZWFsbG9jYXRlX2JhcnJpZXIoc3Ry
dWN0IGk5MTVfYWN0aXZlICpyZWYsCiAJICogV2UgY2FuIHRoZW4gdXNlIHRoZSBwcmVhbGxvY2F0
ZWQgbm9kZXMgaW4KIAkgKiBpOTE1X2FjdGl2ZV9hY3F1aXJlX2JhcnJpZXIoKQogCSAqLwotCWZv
cl9lYWNoX2VuZ2luZV9tYXNrZWQoZW5naW5lLCBpOTE1LCBtYXNrLCB0bXApIHsKKwlmb3JfZWFj
aF9lbmdpbmVfbWFza2VkKGVuZ2luZSwgZ3QsIG1hc2ssIHRtcCkgewogCQl1NjQgaWR4ID0gZW5n
aW5lLT5rZXJuZWxfY29udGV4dC0+dGltZWxpbmUtPmZlbmNlX2NvbnRleHQ7CiAJCXN0cnVjdCBh
Y3RpdmVfbm9kZSAqbm9kZTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKaW5kZXggODg5NTZmMzdk
OTZjLi40MGU5MjNiMGMyYzggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaApAQCAtMTQxNSwxMCAr
MTQxNSwxMCBAQCBzdGF0aWMgaW5saW5lIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpwZGV2X3Rv
X2k5MTUoc3RydWN0IHBjaV9kZXYgKnBkZXYpCiAJCWZvcl9lYWNoX2lmICgoZW5naW5lX18pID0g
KGRldl9wcml2X18pLT5lbmdpbmVbKGlkX18pXSkKIAogLyogSXRlcmF0b3Igb3ZlciBzdWJzZXQg
b2YgZW5naW5lcyBzZWxlY3RlZCBieSBtYXNrICovCi0jZGVmaW5lIGZvcl9lYWNoX2VuZ2luZV9t
YXNrZWQoZW5naW5lX18sIGRldl9wcml2X18sIG1hc2tfXywgdG1wX18pIFwKLQlmb3IgKCh0bXBf
XykgPSAobWFza19fKSAmIElOVEVMX0lORk8oZGV2X3ByaXZfXyktPmVuZ2luZV9tYXNrOyBcCisj
ZGVmaW5lIGZvcl9lYWNoX2VuZ2luZV9tYXNrZWQoZW5naW5lX18sIGd0X18sIG1hc2tfXywgdG1w
X18pIFwKKwlmb3IgKCh0bXBfXykgPSAobWFza19fKSAmIElOVEVMX0lORk8oKGd0X18pLT5pOTE1
KS0+ZW5naW5lX21hc2s7IFwKIAkgICAgICh0bXBfXykgPyBcCi0JICAgICAoKGVuZ2luZV9fKSA9
IChkZXZfcHJpdl9fKS0+ZW5naW5lW19fbWFza19uZXh0X2JpdCh0bXBfXyldKSwgMSA6IFwKKwkg
ICAgICgoZW5naW5lX18pID0gKGd0X18pLT5lbmdpbmVbX19tYXNrX25leHRfYml0KHRtcF9fKV0p
LCAxIDogXAogCSAgICAgMDspCiAKICNkZWZpbmUgcmJfdG9fdWFiaV9lbmdpbmUocmIpIFwKLS0g
CjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
SW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0
dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 1CBE1E858A
	for <lists+intel-gfx@lfdr.de>; Tue, 29 Oct 2019 11:29:03 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E6CE66EB48;
	Tue, 29 Oct 2019 10:29:00 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga09.intel.com (mga09.intel.com [134.134.136.24])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6C7B96EB3D
 for <intel-gfx@lists.freedesktop.org>; Tue, 29 Oct 2019 10:28:59 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga005.jf.intel.com ([10.7.209.41])
 by orsmga102.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 29 Oct 2019 03:28:59 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.68,243,1569308400"; d="scan'208";a="374503843"
Received: from sslose-mobl1.ger.corp.intel.com (HELO
 mwahaha-bdw.ger.corp.intel.com) ([10.252.3.112])
 by orsmga005.jf.intel.com with ESMTP; 29 Oct 2019 03:28:57 -0700
From: Matthew Auld <matthew.auld@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 29 Oct 2019 10:28:48 +0000
Message-Id: <20191029102851.7497-4-matthew.auld@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20191029102851.7497-1-matthew.auld@intel.com>
References: <20191029102851.7497-1-matthew.auld@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 4/7] drm/i915: error capture with no ggtt slot
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogRGFuaWVsZSBDZXJhb2xvIFNwdXJpbyA8ZGFuaWVsZS5jZXJhb2xvc3B1cmlvQGludGVs
LmNvbT4KCklmIHRoZSBhcGVydHVyZSBpcyBub3QgYXZhaWxhYmxlIGluIEhXIHdlIGNhbid0IHVz
ZSBhIGdndHQgc2xvdCBhbmQgd2MKY29weSwgc28gZmFsbCBiYWNrIHRvIHJlZ3VsYXIga21hcC4K
ClNpZ25lZC1vZmYtYnk6IERhbmllbGUgQ2VyYW9sbyBTcHVyaW8gPGRhbmllbGUuY2VyYW9sb3Nw
dXJpb0BpbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6IEFiZGllbCBKYW51bGd1ZSA8YWJkaWVsLmph
bnVsZ3VlQGxpbnV4LmludGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogTWF0dGhldyBBdWxkIDxtYXR0
aGV3LmF1bGRAaW50ZWwuY29tPgpSZXZpZXdlZC1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJp
cy13aWxzb24uY28udWs+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMg
ICB8IDE5ICsrKystLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5jIHwg
NjYgKysrKysrKysrKysrKysrKysrKysrKy0tLS0tCiAyIGZpbGVzIGNoYW5nZWQsIDY1IGluc2Vy
dGlvbnMoKyksIDIwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtX2d0dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMK
aW5kZXggNzNkYWQ4YzZhY2MyLi5iYTA0N2UzMjkwMjggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
Z2VtX2d0dC5jCkBAIC0yNjYxLDcgKzI2NjEsOCBAQCBzdGF0aWMgdm9pZCBnZ3R0X3JlbGVhc2Vf
Z3VjX3RvcChzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogc3RhdGljIHZvaWQgY2xlYW51cF9pbml0
X2dndHQoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCkKIHsKIAlnZ3R0X3JlbGVhc2VfZ3VjX3RvcChn
Z3R0KTsKLQlkcm1fbW1fcmVtb3ZlX25vZGUoJmdndHQtPmVycm9yX2NhcHR1cmUpOworCWlmIChk
cm1fbW1fbm9kZV9hbGxvY2F0ZWQoJmdndHQtPmVycm9yX2NhcHR1cmUpKQorCQlkcm1fbW1fcmVt
b3ZlX25vZGUoJmdndHQtPmVycm9yX2NhcHR1cmUpOwogfQogCiBzdGF0aWMgaW50IGluaXRfZ2d0
dChzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQpAQCAtMjY5MiwxMyArMjY5MywxNSBAQCBzdGF0aWMg
aW50IGluaXRfZ2d0dChzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogCWlmIChyZXQpCiAJCXJldHVy
biByZXQ7CiAKLQkvKiBSZXNlcnZlIGEgbWFwcGFibGUgc2xvdCBmb3Igb3VyIGxvY2tsZXNzIGVy
cm9yIGNhcHR1cmUgKi8KLQlyZXQgPSBkcm1fbW1faW5zZXJ0X25vZGVfaW5fcmFuZ2UoJmdndHQt
PnZtLm1tLCAmZ2d0dC0+ZXJyb3JfY2FwdHVyZSwKLQkJCQkJICBQQUdFX1NJWkUsIDAsIEk5MTVf
Q09MT1JfVU5FVklDVEFCTEUsCi0JCQkJCSAgMCwgZ2d0dC0+bWFwcGFibGVfZW5kLAotCQkJCQkg
IERSTV9NTV9JTlNFUlRfTE9XKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OworCWlmIChnZ3R0
LT5tYXBwYWJsZV9lbmQpIHsKKwkJLyogUmVzZXJ2ZSBhIG1hcHBhYmxlIHNsb3QgZm9yIG91ciBs
b2NrbGVzcyBlcnJvciBjYXB0dXJlICovCisJCXJldCA9IGRybV9tbV9pbnNlcnRfbm9kZV9pbl9y
YW5nZSgmZ2d0dC0+dm0ubW0sICZnZ3R0LT5lcnJvcl9jYXB0dXJlLAorCQkJCQkJICBQQUdFX1NJ
WkUsIDAsIEk5MTVfQ09MT1JfVU5FVklDVEFCTEUsCisJCQkJCQkgIDAsIGdndHQtPm1hcHBhYmxl
X2VuZCwKKwkJCQkJCSAgRFJNX01NX0lOU0VSVF9MT1cpOworCQlpZiAocmV0KQorCQkJcmV0dXJu
IHJldDsKKwl9CiAKIAkvKgogCSAqIFRoZSB1cHBlciBwb3J0aW9uIG9mIHRoZSBHdUMgYWRkcmVz
cyBzcGFjZSBoYXMgYSBzaXplYWJsZSBob2xlCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dwdV9lcnJvci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJy
b3IuYwppbmRleCA5YmNkY2ViZDI5NDguLjc2NzJkNGM0NTUyZiAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3IuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dwdV9lcnJvci5jCkBAIC00MCw2ICs0MCw3IEBACiAjaW5jbHVkZSAiZGlzcGxheS9p
bnRlbF9vdmVybGF5LmgiCiAKICNpbmNsdWRlICJnZW0vaTkxNV9nZW1fY29udGV4dC5oIgorI2lu
Y2x1ZGUgImdlbS9pOTE1X2dlbV9sbWVtLmgiCiAKICNpbmNsdWRlICJpOTE1X2Rydi5oIgogI2lu
Y2x1ZGUgImk5MTVfZ3B1X2Vycm9yLmgiCkBAIC0yMzUsNiArMjM2LDcgQEAgc3RydWN0IGNvbXBy
ZXNzIHsKIAlzdHJ1Y3QgcGFnZXZlYyBwb29sOwogCXN0cnVjdCB6X3N0cmVhbV9zIHpzdHJlYW07
CiAJdm9pZCAqdG1wOworCWJvb2wgd2M7CiB9OwogCiBzdGF0aWMgYm9vbCBjb21wcmVzc19pbml0
KHN0cnVjdCBjb21wcmVzcyAqYykKQEAgLTI5Miw3ICsyOTQsNyBAQCBzdGF0aWMgaW50IGNvbXBy
ZXNzX3BhZ2Uoc3RydWN0IGNvbXByZXNzICpjLAogCXN0cnVjdCB6X3N0cmVhbV9zICp6c3RyZWFt
ID0gJmMtPnpzdHJlYW07CiAKIAl6c3RyZWFtLT5uZXh0X2luID0gc3JjOwotCWlmIChjLT50bXAg
JiYgaTkxNV9tZW1jcHlfZnJvbV93YyhjLT50bXAsIHNyYywgUEFHRV9TSVpFKSkKKwlpZiAoYy0+
d2MgJiYgYy0+dG1wICYmIGk5MTVfbWVtY3B5X2Zyb21fd2MoYy0+dG1wLCBzcmMsIFBBR0VfU0la
RSkpCiAJCXpzdHJlYW0tPm5leHRfaW4gPSBjLT50bXA7CiAJenN0cmVhbS0+YXZhaWxfaW4gPSBQ
QUdFX1NJWkU7CiAKQEAgLTM2Nyw2ICszNjksNyBAQCBzdGF0aWMgdm9pZCBlcnJfY29tcHJlc3Np
b25fbWFya2VyKHN0cnVjdCBkcm1faTkxNV9lcnJvcl9zdGF0ZV9idWYgKm0pCiAKIHN0cnVjdCBj
b21wcmVzcyB7CiAJc3RydWN0IHBhZ2V2ZWMgcG9vbDsKKwlib29sIHdjOwogfTsKIAogc3RhdGlj
IGJvb2wgY29tcHJlc3NfaW5pdChzdHJ1Y3QgY29tcHJlc3MgKmMpCkBAIC0zODksNyArMzkyLDcg
QEAgc3RhdGljIGludCBjb21wcmVzc19wYWdlKHN0cnVjdCBjb21wcmVzcyAqYywKIAlpZiAoIXB0
cikKIAkJcmV0dXJuIC1FTk9NRU07CiAKLQlpZiAoIWk5MTVfbWVtY3B5X2Zyb21fd2MocHRyLCBz
cmMsIFBBR0VfU0laRSkpCisJaWYgKCEoYy0+d2MgJiYgaTkxNV9tZW1jcHlfZnJvbV93YyhwdHIs
IHNyYywgUEFHRV9TSVpFKSkpCiAJCW1lbWNweShwdHIsIHNyYywgUEFHRV9TSVpFKTsKIAlkc3Qt
PnBhZ2VzW2RzdC0+cGFnZV9jb3VudCsrXSA9IHB0cjsKIApAQCAtOTY2LDcgKzk2OSw2IEBAIGk5
MTVfZXJyb3Jfb2JqZWN0X2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlz
dHJ1Y3QgZHJtX2k5MTVfZXJyb3Jfb2JqZWN0ICpkc3Q7CiAJdW5zaWduZWQgbG9uZyBudW1fcGFn
ZXM7CiAJc3RydWN0IHNndF9pdGVyIGl0ZXI7Ci0JZG1hX2FkZHJfdCBkbWE7CiAJaW50IHJldDsK
IAogCW1pZ2h0X3NsZWVwKCk7CkBAIC05OTIsMTcgKzk5NCw1NCBAQCBpOTE1X2Vycm9yX29iamVj
dF9jcmVhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJZHN0LT5wYWdlX2NvdW50
ID0gMDsKIAlkc3QtPnVudXNlZCA9IDA7CiAKKwljb21wcmVzcy0+d2MgPSBpOTE1X2dlbV9vYmpl
Y3RfaXNfbG1lbSh2bWEtPm9iaikgfHwKKwkJICAgICAgIGRybV9tbV9ub2RlX2FsbG9jYXRlZCgm
Z2d0dC0+ZXJyb3JfY2FwdHVyZSk7CisKIAlyZXQgPSAtRUlOVkFMOwotCWZvcl9lYWNoX3NndF9k
YWRkcihkbWEsIGl0ZXIsIHZtYS0+cGFnZXMpIHsKKwlpZiAoZHJtX21tX25vZGVfYWxsb2NhdGVk
KCZnZ3R0LT5lcnJvcl9jYXB0dXJlKSkgewogCQl2b2lkIF9faW9tZW0gKnM7CisJCWRtYV9hZGRy
X3QgZG1hOwogCi0JCWdndHQtPnZtLmluc2VydF9wYWdlKCZnZ3R0LT52bSwgZG1hLCBzbG90LCBJ
OTE1X0NBQ0hFX05PTkUsIDApOworCQlmb3JfZWFjaF9zZ3RfZGFkZHIoZG1hLCBpdGVyLCB2bWEt
PnBhZ2VzKSB7CisJCQlnZ3R0LT52bS5pbnNlcnRfcGFnZSgmZ2d0dC0+dm0sIGRtYSwgc2xvdCwK
KwkJCQkJICAgICBJOTE1X0NBQ0hFX05PTkUsIDApOwogCi0JCXMgPSBpb19tYXBwaW5nX21hcF93
YygmZ2d0dC0+aW9tYXAsIHNsb3QsIFBBR0VfU0laRSk7Ci0JCXJldCA9IGNvbXByZXNzX3BhZ2Uo
Y29tcHJlc3MsICh2b2lkICBfX2ZvcmNlICopcywgZHN0KTsKLQkJaW9fbWFwcGluZ191bm1hcChz
KTsKLQkJaWYgKHJldCkKLQkJCWJyZWFrOworCQkJcyA9IGlvX21hcHBpbmdfbWFwX3djKCZnZ3R0
LT5pb21hcCwgc2xvdCwgUEFHRV9TSVpFKTsKKwkJCXJldCA9IGNvbXByZXNzX3BhZ2UoY29tcHJl
c3MsICh2b2lkICBfX2ZvcmNlICopcywgZHN0KTsKKwkJCWlvX21hcHBpbmdfdW5tYXAocyk7CisJ
CQlpZiAocmV0KQorCQkJCWJyZWFrOworCQl9CisJfSBlbHNlIGlmIChpOTE1X2dlbV9vYmplY3Rf
aXNfbG1lbSh2bWEtPm9iaikpIHsKKwkJc3RydWN0IGludGVsX21lbW9yeV9yZWdpb24gKm1lbSA9
IHZtYS0+b2JqLT5tbS5yZWdpb247CisJCWRtYV9hZGRyX3QgZG1hOworCisJCWZvcl9lYWNoX3Nn
dF9kYWRkcihkbWEsIGl0ZXIsIHZtYS0+cGFnZXMpIHsKKwkJCXZvaWQgX19pb21lbSAqczsKKwor
CQkJcyA9IGlvX21hcHBpbmdfbWFwX2F0b21pY193YygmbWVtLT5pb21hcCwgZG1hKTsKKwkJCXJl
dCA9IGNvbXByZXNzX3BhZ2UoY29tcHJlc3MsICh2b2lkIF9fZm9yY2UgKilzLCBkc3QpOworCQkJ
aW9fbWFwcGluZ191bm1hcF9hdG9taWMocyk7CisJCQlpZiAocmV0KQorCQkJCWJyZWFrOworCQl9
CisJfSBlbHNlIHsKKwkJc3RydWN0IHBhZ2UgKnBhZ2U7CisKKwkJZm9yX2VhY2hfc2d0X3BhZ2Uo
cGFnZSwgaXRlciwgdm1hLT5wYWdlcykgeworCQkJdm9pZCAqczsKKworCQkJZHJtX2NsZmx1c2hf
cGFnZXMoJnBhZ2UsIDEpOworCisJCQlzID0ga21hcF9hdG9taWMocGFnZSk7CisJCQlyZXQgPSBj
b21wcmVzc19wYWdlKGNvbXByZXNzLCBzLCBkc3QpOworCQkJa3VubWFwX2F0b21pYyhzKTsKKwor
CQkJZHJtX2NsZmx1c2hfcGFnZXMoJnBhZ2UsIDEpOworCisJCQlpZiAocmV0KQorCQkJCWJyZWFr
OworCQl9CiAJfQogCiAJaWYgKHJldCB8fCBjb21wcmVzc19mbHVzaChjb21wcmVzcywgZHN0KSkg
ewpAQCAtMTY1Nyw5ICsxNjk2LDEyIEBAIHN0YXRpYyB2b2lkIGNhcHR1cmVfcGFyYW1zKHN0cnVj
dCBpOTE1X2dwdV9zdGF0ZSAqZXJyb3IpCiBzdGF0aWMgdm9pZCBjYXB0dXJlX2ZpbmlzaChzdHJ1
Y3QgaTkxNV9ncHVfc3RhdGUgKmVycm9yKQogewogCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSAm
ZXJyb3ItPmk5MTUtPmdndHQ7Ci0JY29uc3QgdTY0IHNsb3QgPSBnZ3R0LT5lcnJvcl9jYXB0dXJl
LnN0YXJ0OwogCi0JZ2d0dC0+dm0uY2xlYXJfcmFuZ2UoJmdndHQtPnZtLCBzbG90LCBQQUdFX1NJ
WkUpOworCWlmIChkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJmdndHQtPmVycm9yX2NhcHR1cmUpKSB7
CisJCWNvbnN0IHU2NCBzbG90ID0gZ2d0dC0+ZXJyb3JfY2FwdHVyZS5zdGFydDsKKworCQlnZ3R0
LT52bS5jbGVhcl9yYW5nZSgmZ2d0dC0+dm0sIHNsb3QsIFBBR0VfU0laRSk7CisJfQogfQogCiAj
ZGVmaW5lIERBWV9BU19TRUNPTkRTKHgpICgyNCAqIDYwICogNjAgKiAoeCkpCi0tIAoyLjIwLjEK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdm
eCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xp
c3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

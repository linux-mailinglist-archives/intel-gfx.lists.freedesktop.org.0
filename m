Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 34CF570D43
	for <lists+intel-gfx@lfdr.de>; Tue, 23 Jul 2019 01:21:35 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 46DEE89F55;
	Mon, 22 Jul 2019 23:21:31 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga02.intel.com (mga02.intel.com [134.134.136.20])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 227DA89F4F
 for <intel-gfx@lists.freedesktop.org>; Mon, 22 Jul 2019 23:21:27 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga001.fm.intel.com ([10.253.24.23])
 by orsmga101.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 22 Jul 2019 16:21:26 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,296,1559545200"; d="scan'208";a="188709329"
Received: from dceraolo-linux.fm.intel.com ([10.1.27.145])
 by fmsmga001.fm.intel.com with ESMTP; 22 Jul 2019 16:21:26 -0700
From: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 22 Jul 2019 16:20:48 -0700
Message-Id: <20190722232048.9970-10-daniele.ceraolospurio@intel.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190722232048.9970-1-daniele.ceraolospurio@intel.com>
References: <20190722232048.9970-1-daniele.ceraolospurio@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 9/9] drm/i915/uc: Unify uC firmware upload
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIHdheSB3ZSBsb2FkIHRoZSBmaXJtd2FyZXMgaXMgdGhlIHNhbWUgZm9yIGJvdGggR3VDIGFu
ZCBIdUMsIHRoZSBvbmx5CmRpZmZlcmVuY2UgaXMgaW4gdGhlIHdvcGNtIGRlc3RpbmF0aW9uIGFk
ZHJlc3MgYW5kIHRoZSBkbWEgZmxhZ3MsIHNvIHdlCmVhc2lseSBjYW4gbW92ZSB0aGUgbG9naWMg
dG8gYSBjb21tb24gZnVuY3Rpb24gYW5kIHBhc3MgaW4gb2Zmc2V0IGFuZApmbGFncy4gVGhlIG9u
bHkgb3RoZXIgZGlmZmVyZW5jZSBpbiB0aGUgdXBsYW9kIHBhdGggYXJlIHNvbWUgdGhlIGV4dHJh
CnN0ZXBzIHRoYXQgZ3VjIGRvZXMgYmVmb3JlIGFuZCBhZnRlciB0aGUgeGZlciwgYnV0IHRob3Nl
IGRvbid0IHJlcXVpcmUKdGhlIGd1YyBmdyB0byBiZSBwaW5uZWQgaW4gZ2d0dCBhbmQgY2FuIHNh
ZmVseSBiZSBwZXJmb3JtZWQgYmVmb3JlCmNhbGxpbmcgdGhlIHVjX3VwbG9hZCBmdW5jdGlvbi4K
Ck5vdGUgdGhhdCB0aGlzIHBhdGNoIHJlLWludHJvZHVjZXMgdGhlIGRtYSB4ZmVyIHdhaXQgZm9y
IGd1YyBsb2FkaW5nIHRoYXQKd2FzIHJlbW92ZWQgd2l0aCAiZHJtL2k5MTUvZ3VjOiBQcm9wYWdh
dGUgdGhlIGZ3IHhmZXIgdGltZW91dCIuIFRoaXMgaXMKbm90IGdvaW5nIHRvIHNsb3cgdXMgZG93
biBvbiBhIHN1Y2Nlc3NmdWwgbG9hZCAodGhlIGRtYSBoYXMgdG8gY29tcGxldGUKYmVmb3JlIGZ3
IGluaXQgY2FuIHN0YXJ0KSwgYnV0IGNvdWxkIHNsaWdodGx5IGluY3JlYXNlIHRoZSB0aW1lb3V0
IGluIGNhc2UKb2YgYSBmdyBpbml0IGVycm9yLgoKU2lnbmVkLW9mZi1ieTogRGFuaWVsZSBDZXJh
b2xvIFNwdXJpbyA8ZGFuaWVsZS5jZXJhb2xvc3B1cmlvQGludGVsLmNvbT4KQ2M6IE1pY2hhbCBX
YWpkZWN6a28gPG1pY2hhbC53YWpkZWN6a29AaW50ZWwuY29tPgpDYzogQ2hyaXMgV2lsc29uIDxj
aHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMv
aW50ZWxfZ3VjX2Z3LmMgfCAxMDAgKysrKystLS0tLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvdWMvaW50ZWxfaHVjX2Z3LmMgfCAgNTcgKy0tLS0tLS0tLS0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF91Y19mdy5jICB8ICA3OSArKysrKysrKysrKysrLS0t
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfdWNfZncuaCAgfCAgIDQgKy0KIDQg
ZmlsZXMgY2hhbmdlZCwgODYgaW5zZXJ0aW9ucygrKSwgMTU0IGRlbGV0aW9ucygtKQoKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX2d1Y19mdy5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfZ3VjX2Z3LmMKaW5kZXggYzliZDU1ZTIzZWVjLi5h
MWUwNzE5NTg4MjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVs
X2d1Y19mdy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX2d1Y19mdy5j
CkBAIC0xMTMsMTMgKzExMyw2IEBAIHN0YXRpYyB2b2lkIGd1Y194ZmVyX3JzYShzdHJ1Y3QgaW50
ZWxfdWNfZncgKmd1Y19mdywKIAkJaW50ZWxfdW5jb3JlX3dyaXRlKHVuY29yZSwgVU9TX1JTQV9T
Q1JBVENIKGkpLCByc2FbaV0pOwogfQogCi1zdGF0aWMgYm9vbCBndWNfeGZlcl9jb21wbGV0ZWQo
c3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlLCB1MzIgKnN0YXR1cykKLXsKLQkvKiBEaWQgd2Ug
Y29tcGxldGUgdGhlIHhmZXI/ICovCi0JKnN0YXR1cyA9IGludGVsX3VuY29yZV9yZWFkKHVuY29y
ZSwgRE1BX0NUUkwpOwotCXJldHVybiAhKCpzdGF0dXMgJiBTVEFSVF9ETUEpOwotfQotCiAvKgog
ICogUmVhZCB0aGUgR3VDIHN0YXR1cyByZWdpc3RlciAoR1VDX1NUQVRVUykgYW5kIHN0b3JlIGl0
IGluIHRoZQogICogc3BlY2lmaWVkIGxvY2F0aW9uOyB0aGVuIHJldHVybiBhIGJvb2xlYW4gaW5k
aWNhdGluZyB3aGV0aGVyCkBAIC0xNjYsNjUgKzE1OSwyNyBAQCBzdGF0aWMgaW50IGd1Y193YWl0
X3Vjb2RlKHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSkKIAkJcmV0ID0gLUVOWElPOwogCX0K
IAotCWlmIChyZXQgPT0gMCAmJiAhZ3VjX3hmZXJfY29tcGxldGVkKHVuY29yZSwgJnN0YXR1cykp
IHsKLQkJRFJNX0VSUk9SKCJHdUMgaXMgcmVhZHksIGJ1dCB0aGUgeGZlciAlMDh4IGlzIGluY29t
cGxldGVcbiIsCi0JCQkgIHN0YXR1cyk7Ci0JCXJldCA9IC1FTlhJTzsKLQl9Ci0KIAlyZXR1cm4g
cmV0OwogfQogCi0vKgotICogVHJhbnNmZXIgdGhlIGZpcm13YXJlIGltYWdlIHRvIFJBTSBmb3Ig
ZXhlY3V0aW9uIGJ5IHRoZSBtaWNyb2NvbnRyb2xsZXIuCisvKioKKyAqIGludGVsX2d1Y19md191
cGxvYWQoKSAtIGxvYWQgR3VDIHVDb2RlIHRvIGRldmljZQorICogQGd1YzogaW50ZWxfZ3VjIHN0
cnVjdHVyZQogICoKLSAqIEFyY2hpdGVjdHVyYWxseSwgdGhlIERNQSBlbmdpbmUgaXMgYmlkaXJl
Y3Rpb25hbCwgYW5kIGNhbiBwb3RlbnRpYWxseSBldmVuCi0gKiB0cmFuc2ZlciBiZXR3ZWVuIEdU
VCBsb2NhdGlvbnMuIFRoaXMgZnVuY3Rpb25hbGl0eSBpcyBsZWZ0IG91dCBvZiB0aGUgQVBJCi0g
KiBmb3Igbm93IGFzIHRoZXJlIGlzIG5vIG5lZWQgZm9yIGl0LgotICovCi1zdGF0aWMgaW50IGd1
Y194ZmVyX3Vjb2RlKHN0cnVjdCBpbnRlbF91Y19mdyAqZ3VjX2Z3LAotCQkJICBzdHJ1Y3QgaW50
ZWxfZ3QgKmd0KQotewotCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9IGd0LT51bmNvcmU7
Ci0JdW5zaWduZWQgbG9uZyBvZmZzZXQ7Ci0KLQkvKgotCSAqIFRoZSBoZWFkZXIgcGx1cyB1Q29k
ZSB3aWxsIGJlIGNvcGllZCB0byBXT1BDTSB2aWEgRE1BLCBleGNsdWRpbmcgYW55Ci0JICogb3Ro
ZXIgY29tcG9uZW50cwotCSAqLwotCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsIERNQV9DT1BZ
X1NJWkUsCi0JCQkgICBndWNfZnctPmhlYWRlcl9zaXplICsgZ3VjX2Z3LT51Y29kZV9zaXplKTsK
LQotCS8qIFNldCB0aGUgc291cmNlIGFkZHJlc3MgZm9yIHRoZSBuZXcgYmxvYiAqLwotCW9mZnNl
dCA9IGludGVsX3VjX2Z3X2dndHRfb2Zmc2V0KGd1Y19mdywgZ3QtPmdndHQpICsgZ3VjX2Z3LT5o
ZWFkZXJfb2Zmc2V0OwotCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsIERNQV9BRERSXzBfTE9X
LCBsb3dlcl8zMl9iaXRzKG9mZnNldCkpOwotCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsIERN
QV9BRERSXzBfSElHSCwgdXBwZXJfMzJfYml0cyhvZmZzZXQpICYgMHhGRkZGKTsKLQotCS8qCi0J
ICogU2V0IHRoZSBETUEgZGVzdGluYXRpb24uIEN1cnJlbnQgdUNvZGUgZXhwZWN0cyB0aGUgY29k
ZSB0byBiZQotCSAqIGxvYWRlZCBhdCA4azsgbG9jYXRpb25zIGJlbG93IHRoaXMgYXJlIHVzZWQg
Zm9yIHRoZSBzdGFjay4KLQkgKi8KLQlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBETUFfQURE
Ul8xX0xPVywgMHgyMDAwKTsKLQlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBETUFfQUREUl8x
X0hJR0gsIERNQV9BRERSRVNTX1NQQUNFX1dPUENNKTsKLQotCS8qIEZpbmFsbHkgc3RhcnQgdGhl
IERNQSAqLwotCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsIERNQV9DVFJMLAotCQkJICAgX01B
U0tFRF9CSVRfRU5BQkxFKFVPU19NT1ZFIHwgU1RBUlRfRE1BKSk7Ci0KLQlyZXR1cm4gZ3VjX3dh
aXRfdWNvZGUodW5jb3JlKTsKLX0KLS8qCi0gKiBMb2FkIHRoZSBHdUMgZmlybXdhcmUgYmxvYiBp
bnRvIHRoZSBNaW51dGVJQS4KKyAqIENhbGxlZCBmcm9tIGludGVsX3VjX2luaXRfaHcoKSBkdXJp
bmcgZHJpdmVyIGxvYWQsIHJlc3VtZSBmcm9tIHNsZWVwIGFuZAorICogYWZ0ZXIgYSBHUFUgcmVz
ZXQuCisgKgorICogVGhlIGZpcm13YXJlIGltYWdlIHNob3VsZCBoYXZlIGFscmVhZHkgYmVlbiBm
ZXRjaGVkIGludG8gbWVtb3J5LCBzbyBvbmx5CisgKiBjaGVjayB0aGF0IGZldGNoIHN1Y2NlZWRl
ZCwgYW5kIHRoZW4gdHJhbnNmZXIgdGhlIGltYWdlIHRvIHRoZSBoL3cuCisgKgorICogUmV0dXJu
Oglub24temVybyBjb2RlIG9uIGVycm9yCiAgKi8KLXN0YXRpYyBpbnQgZ3VjX2Z3X3hmZXIoc3Ry
dWN0IGludGVsX3VjX2Z3ICpndWNfZncsIHN0cnVjdCBpbnRlbF9ndCAqZ3QpCitpbnQgaW50ZWxf
Z3VjX2Z3X3VwbG9hZChzdHJ1Y3QgaW50ZWxfZ3VjICpndWMpCiB7CisJc3RydWN0IGludGVsX2d0
ICpndCA9IGd1Y190b19ndChndWMpOwogCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9IGd0
LT51bmNvcmU7CiAJaW50IHJldDsKIAotCUdFTV9CVUdfT04oZ3VjX2Z3LT50eXBlICE9IElOVEVM
X1VDX0ZXX1RZUEVfR1VDKTsKLQotCWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0KHVuY29yZSwg
Rk9SQ0VXQUtFX0FMTCk7Ci0KIAlndWNfcHJlcGFyZV94ZmVyKHVuY29yZSk7CiAKIAkvKgpAQCAt
MjMyLDI4ICsxODcsMTUgQEAgc3RhdGljIGludCBndWNfZndfeGZlcihzdHJ1Y3QgaW50ZWxfdWNf
ZncgKmd1Y19mdywgc3RydWN0IGludGVsX2d0ICpndCkKIAkgKiBieSB0aGUgRE1BIGVuZ2luZSBp
biBvbmUgb3BlcmF0aW9uLCB3aGVyZWFzIHRoZSBSU0Egc2lnbmF0dXJlIGlzCiAJICogbG9hZGVk
IHZpYSBNTUlPLgogCSAqLwotCWd1Y194ZmVyX3JzYShndWNfZncsIHVuY29yZSk7CisJZ3VjX3hm
ZXJfcnNhKCZndWMtPmZ3LCB1bmNvcmUpOwogCi0JcmV0ID0gZ3VjX3hmZXJfdWNvZGUoZ3VjX2Z3
LCBndCk7Ci0KLQlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX3B1dCh1bmNvcmUsIEZPUkNFV0FLRV9B
TEwpOwotCi0JcmV0dXJuIHJldDsKLX0KKwkvKgorCSAqIEN1cnJlbnQgdUNvZGUgZXhwZWN0cyB0
aGUgY29kZSB0byBiZSBsb2FkZWQgYXQgOGs7IGxvY2F0aW9ucyBiZWxvdworCSAqIHRoaXMgYXJl
IHVzZWQgZm9yIHRoZSBzdGFjay4KKwkgKi8KKwlyZXQgPSBpbnRlbF91Y19md191cGxvYWQoJmd1
Yy0+ZncsIGd0LCAweDIwMDAsIFVPU19NT1ZFKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0Owog
Ci0vKioKLSAqIGludGVsX2d1Y19md191cGxvYWQoKSAtIGxvYWQgR3VDIHVDb2RlIHRvIGRldmlj
ZQotICogQGd1YzogaW50ZWxfZ3VjIHN0cnVjdHVyZQotICoKLSAqIENhbGxlZCBmcm9tIGludGVs
X3VjX2luaXRfaHcoKSBkdXJpbmcgZHJpdmVyIGxvYWQsIHJlc3VtZSBmcm9tIHNsZWVwIGFuZAot
ICogYWZ0ZXIgYSBHUFUgcmVzZXQuCi0gKgotICogVGhlIGZpcm13YXJlIGltYWdlIHNob3VsZCBo
YXZlIGFscmVhZHkgYmVlbiBmZXRjaGVkIGludG8gbWVtb3J5LCBzbyBvbmx5Ci0gKiBjaGVjayB0
aGF0IGZldGNoIHN1Y2NlZWRlZCwgYW5kIHRoZW4gdHJhbnNmZXIgdGhlIGltYWdlIHRvIHRoZSBo
L3cuCi0gKgotICogUmV0dXJuOglub24temVybyBjb2RlIG9uIGVycm9yCi0gKi8KLWludCBpbnRl
bF9ndWNfZndfdXBsb2FkKHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKLXsKLQlyZXR1cm4gaW50ZWxf
dWNfZndfdXBsb2FkKCZndWMtPmZ3LCBndWNfdG9fZ3QoZ3VjKSwgZ3VjX2Z3X3hmZXIpOworCXJl
dHVybiBndWNfd2FpdF91Y29kZSh1bmNvcmUpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvdWMvaW50ZWxfaHVjX2Z3LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91
Yy9pbnRlbF9odWNfZncuYwppbmRleCA0MWUwMzIxNDlmN2UuLjQ0ZDJiN2U3ZTg0NSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfaHVjX2Z3LmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfaHVjX2Z3LmMKQEAgLTYyLDYwICs2Miw2IEBA
IHZvaWQgaW50ZWxfaHVjX2Z3X2luaXRfZWFybHkoc3RydWN0IGludGVsX2h1YyAqaHVjKQogCQkJ
ICAgaHVjX2Z3X2Jsb2JzLCBBUlJBWV9TSVpFKGh1Y19md19ibG9icykpOwogfQogCi0vKioKLSAq
IGh1Y19md194ZmVyKCkgLSBETUEncyB0aGUgZmlybXdhcmUKLSAqIEBodWNfZnc6IHRoZSBmaXJt
d2FyZSBkZXNjcmlwdG9yCi0gKgotICogVHJhbnNmZXIgdGhlIGZpcm13YXJlIGltYWdlIHRvIFJB
TSBmb3IgZXhlY3V0aW9uIGJ5IHRoZSBtaWNyb2NvbnRyb2xsZXIuCi0gKgotICogUmV0dXJuOiAw
IG9uIHN1Y2Nlc3MsIG5vbi16ZXJvIG9uIGZhaWx1cmUKLSAqLwotc3RhdGljIGludCBodWNfZndf
eGZlcihzdHJ1Y3QgaW50ZWxfdWNfZncgKmh1Y19mdywgc3RydWN0IGludGVsX2d0ICpndCkKLXsK
LQlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSBndC0+dW5jb3JlOwotCXVuc2lnbmVkIGxv
bmcgb2Zmc2V0ID0gMDsKLQl1MzIgc2l6ZTsKLQlpbnQgcmV0OwotCi0JR0VNX0JVR19PTihodWNf
ZnctPnR5cGUgIT0gSU5URUxfVUNfRldfVFlQRV9IVUMpOwotCi0JaW50ZWxfdW5jb3JlX2ZvcmNl
d2FrZV9nZXQodW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKLQotCS8qIFNldCB0aGUgc291cmNlIGFk
ZHJlc3MgZm9yIHRoZSB1Q29kZSAqLwotCW9mZnNldCA9IGludGVsX3VjX2Z3X2dndHRfb2Zmc2V0
KGh1Y19mdywgZ3QtPmdndHQpICsKLQkJIGh1Y19mdy0+aGVhZGVyX29mZnNldDsKLQlpbnRlbF91
bmNvcmVfd3JpdGUodW5jb3JlLCBETUFfQUREUl8wX0xPVywKLQkJCSAgIGxvd2VyXzMyX2JpdHMo
b2Zmc2V0KSk7Ci0JaW50ZWxfdW5jb3JlX3dyaXRlKHVuY29yZSwgRE1BX0FERFJfMF9ISUdILAot
CQkJICAgdXBwZXJfMzJfYml0cyhvZmZzZXQpICYgMHhGRkZGKTsKLQotCS8qCi0JICogSGFyZHdh
cmUgZG9lc24ndCBsb29rIGF0IGRlc3RpbmF0aW9uIGFkZHJlc3MgZm9yIEh1Qy4gU2V0IGl0IHRv
IDAsCi0JICogYnV0IHN0aWxsIHByb2dyYW0gdGhlIGNvcnJlY3QgYWRkcmVzcyBzcGFjZS4KLQkg
Ki8KLQlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBETUFfQUREUl8xX0xPVywgMCk7Ci0JaW50
ZWxfdW5jb3JlX3dyaXRlKHVuY29yZSwgRE1BX0FERFJfMV9ISUdILCBETUFfQUREUkVTU19TUEFD
RV9XT1BDTSk7Ci0KLQlzaXplID0gaHVjX2Z3LT5oZWFkZXJfc2l6ZSArIGh1Y19mdy0+dWNvZGVf
c2l6ZTsKLQlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBETUFfQ09QWV9TSVpFLCBzaXplKTsK
LQotCS8qIFN0YXJ0IHRoZSBETUEgKi8KLQlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBETUFf
Q1RSTCwKLQkJCSAgIF9NQVNLRURfQklUX0VOQUJMRShIVUNfVUtFUk5FTCB8IFNUQVJUX0RNQSkp
OwotCi0JLyogV2FpdCBmb3IgRE1BIHRvIGZpbmlzaCAqLwotCXJldCA9IGludGVsX3dhaXRfZm9y
X3JlZ2lzdGVyX2Z3KHVuY29yZSwgRE1BX0NUUkwsIFNUQVJUX0RNQSwgMCwgMTAwKTsKLQotCURS
TV9ERUJVR19EUklWRVIoIkh1QyBETUEgdHJhbnNmZXIgd2FpdCBvdmVyIHdpdGggcmV0ICVkXG4i
LCByZXQpOwotCi0JLyogRGlzYWJsZSB0aGUgYml0cyBvbmNlIERNQSBpcyBvdmVyICovCi0JaW50
ZWxfdW5jb3JlX3dyaXRlKHVuY29yZSwgRE1BX0NUUkwsIF9NQVNLRURfQklUX0RJU0FCTEUoSFVD
X1VLRVJORUwpKTsKLQotCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KHVuY29yZSwgRk9SQ0VX
QUtFX0FMTCk7Ci0KLQlyZXR1cm4gcmV0OwotfQotCiAvKioKICAqIGludGVsX2h1Y19md191cGxv
YWQoKSAtIGxvYWQgSHVDIHVDb2RlIHRvIGRldmljZQogICogQGh1YzogaW50ZWxfaHVjIHN0cnVj
dHVyZQpAQCAtMTMwLDUgKzc2LDYgQEAgc3RhdGljIGludCBodWNfZndfeGZlcihzdHJ1Y3QgaW50
ZWxfdWNfZncgKmh1Y19mdywgc3RydWN0IGludGVsX2d0ICpndCkKICAqLwogaW50IGludGVsX2h1
Y19md191cGxvYWQoc3RydWN0IGludGVsX2h1YyAqaHVjKQogewotCXJldHVybiBpbnRlbF91Y19m
d191cGxvYWQoJmh1Yy0+ZncsIGh1Y190b19ndChodWMpLCBodWNfZndfeGZlcik7CisJLyogSFcg
ZG9lc24ndCBsb29rIGF0IGRlc3RpbmF0aW9uIGFkZHJlc3MgZm9yIEh1Qywgc28gc2V0IGl0IHRv
IDAgKi8KKwlyZXR1cm4gaW50ZWxfdWNfZndfdXBsb2FkKCZodWMtPmZ3LCBodWNfdG9fZ3QoaHVj
KSwgMCwgSFVDX1VLRVJORUwpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvdWMvaW50ZWxfdWNfZncuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX3Vj
X2Z3LmMKaW5kZXggYmI2ZmI2NGMzOTM2Li41YTZlMjM5NDk4ZDIgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX3VjX2Z3LmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvdWMvaW50ZWxfdWNfZncuYwpAQCAtMjI3LDEzICsyMjcsMjQgQEAgdm9pZCBpbnRl
bF91Y19md19mZXRjaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJcmVsZWFz
ZV9maXJtd2FyZShmdyk7CQkvKiBPSyBldmVuIGlmIGZ3IGlzIE5VTEwgKi8KIH0KIAorc3RhdGlj
IHUzMiB1Y19md19nZ3R0X29mZnNldChzdHJ1Y3QgaW50ZWxfdWNfZncgKnVjX2Z3LCBzdHJ1Y3Qg
aTkxNV9nZ3R0ICpnZ3R0KQoreworCXN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZSA9ICZnZ3R0LT51
Y19mdzsKKworCUdFTV9CVUdfT04oIW5vZGUtPmFsbG9jYXRlZCk7CisJR0VNX0JVR19PTih1cHBl
cl8zMl9iaXRzKG5vZGUtPnN0YXJ0KSk7CisJR0VNX0JVR19PTih1cHBlcl8zMl9iaXRzKG5vZGUt
PnN0YXJ0ICsgbm9kZS0+c2l6ZSAtIDEpKTsKKworCXJldHVybiBsb3dlcl8zMl9iaXRzKG5vZGUt
PnN0YXJ0KTsKK30KKwogc3RhdGljIHZvaWQgaW50ZWxfdWNfZndfZ2d0dF9iaW5kKHN0cnVjdCBp
bnRlbF91Y19mdyAqdWNfZncsCiAJCQkJICBzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogewogCXN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB1Y19mdy0+b2JqOwogCXN0cnVjdCBpOTE1X2dn
dHQgKmdndHQgPSBndC0+Z2d0dDsKIAlzdHJ1Y3QgaTkxNV92bWEgZHVtbXkgPSB7Ci0JCS5ub2Rl
LnN0YXJ0ID0gaW50ZWxfdWNfZndfZ2d0dF9vZmZzZXQodWNfZncsIGdndHQpLAorCQkubm9kZS5z
dGFydCA9IHVjX2Z3X2dndHRfb2Zmc2V0KHVjX2Z3LCBnZ3R0KSwKIAkJLm5vZGUuc2l6ZSA9IG9i
ai0+YmFzZS5zaXplLAogCQkucGFnZXMgPSBvYmotPm1tLnBhZ2VzLAogCQkudm0gPSAmZ2d0dC0+
dm0sCkBAIC0yNTMsMjMgKzI2NCw2OCBAQCBzdGF0aWMgdm9pZCBpbnRlbF91Y19md19nZ3R0X3Vu
YmluZChzdHJ1Y3QgaW50ZWxfdWNfZncgKnVjX2Z3LAogewogCXN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmogPSB1Y19mdy0+b2JqOwogCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSBndC0+
Z2d0dDsKLQl1NjQgc3RhcnQgPSBpbnRlbF91Y19md19nZ3R0X29mZnNldCh1Y19mdywgZ2d0dCk7
CisJdTY0IHN0YXJ0ID0gdWNfZndfZ2d0dF9vZmZzZXQodWNfZncsIGdndHQpOwogCiAJZ2d0dC0+
dm0uY2xlYXJfcmFuZ2UoJmdndHQtPnZtLCBzdGFydCwgb2JqLT5iYXNlLnNpemUpOwogfQogCitz
dGF0aWMgaW50IHVjX2Z3X3hmZXIoc3RydWN0IGludGVsX3VjX2Z3ICp1Y19mdywgc3RydWN0IGlu
dGVsX2d0ICpndCwKKwkJICAgICAgdTMyIHdvcGNtX29mZnNldCwgdTMyIGRtYV9mbGFncykKK3sK
KwlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSBndC0+dW5jb3JlOworCXU2NCBvZmZzZXQ7
CisJaW50IHJldDsKKworCWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0KHVuY29yZSwgRk9SQ0VX
QUtFX0FMTCk7CisKKwkvKiBTZXQgdGhlIHNvdXJjZSBhZGRyZXNzIGZvciB0aGUgdUNvZGUgKi8K
KwlvZmZzZXQgPSB1Y19md19nZ3R0X29mZnNldCh1Y19mdywgZ3QtPmdndHQpICsgdWNfZnctPmhl
YWRlcl9vZmZzZXQ7CisJR0VNX0JVR19PTih1cHBlcl8zMl9iaXRzKG9mZnNldCkgJiAweEZGRkYw
MDAwKTsKKwlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBETUFfQUREUl8wX0xPVywgbG93ZXJf
MzJfYml0cyhvZmZzZXQpKTsKKwlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBETUFfQUREUl8w
X0hJR0gsIHVwcGVyXzMyX2JpdHMob2Zmc2V0KSk7CisKKwkvKiBTZXQgdGhlIERNQSBkZXN0aW5h
dGlvbiAqLworCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsIERNQV9BRERSXzFfTE9XLCB3b3Bj
bV9vZmZzZXQpOworCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsIERNQV9BRERSXzFfSElHSCwg
RE1BX0FERFJFU1NfU1BBQ0VfV09QQ00pOworCisJLyoKKwkgKiBTZXQgdGhlIHRyYXNmZXIgc2l6
ZS4gVGhlIGhlYWRlciBwbHVzIHVDb2RlIHdpbGwgYmUgY29waWVkIHRvIFdPUENNCisJICogdmlh
IERNQSwgZXhjbHVkaW5nIGFueSBvdGhlciBjb21wb25lbnRzCisJICovCisJaW50ZWxfdW5jb3Jl
X3dyaXRlKHVuY29yZSwgRE1BX0NPUFlfU0laRSwKKwkJCSAgIHVjX2Z3LT5oZWFkZXJfc2l6ZSAr
IHVjX2Z3LT51Y29kZV9zaXplKTsKKworCS8qIFN0YXJ0IHRoZSBETUEgKi8KKwlpbnRlbF91bmNv
cmVfd3JpdGUodW5jb3JlLCBETUFfQ1RSTCwKKwkJCSAgIF9NQVNLRURfQklUX0VOQUJMRShkbWFf
ZmxhZ3MgfCBTVEFSVF9ETUEpKTsKKworCS8qIFdhaXQgZm9yIERNQSB0byBmaW5pc2ggKi8KKwly
ZXQgPSBpbnRlbF93YWl0X2Zvcl9yZWdpc3Rlcl9mdyh1bmNvcmUsIERNQV9DVFJMLCBTVEFSVF9E
TUEsIDAsIDEwMCk7CisJaWYgKHJldCkKKwkJRFJNX0VSUk9SKCJETUEgZm9yICVzIGZ3IGZhaWxl
ZCwgZXJyPSVkXG4iLAorCQkJICBpbnRlbF91Y19md190eXBlX3JlcHIodWNfZnctPnR5cGUpLCBy
ZXQpOworCisJLyogRGlzYWJsZSB0aGUgYml0cyBvbmNlIERNQSBpcyBvdmVyICovCisJaW50ZWxf
dW5jb3JlX3dyaXRlKHVuY29yZSwgRE1BX0NUUkwsIF9NQVNLRURfQklUX0RJU0FCTEUoZG1hX2Zs
YWdzKSk7CisKKwlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX3B1dCh1bmNvcmUsIEZPUkNFV0FLRV9B
TEwpOworCisJcmV0dXJuIHJldDsKK30KKwogLyoqCiAgKiBpbnRlbF91Y19md191cGxvYWQgLSBs
b2FkIHVDIGZpcm13YXJlIHVzaW5nIGN1c3RvbSBsb2FkZXIKICAqIEB1Y19mdzogdUMgZmlybXdh
cmUKICAqIEBndDogdGhlIGludGVsX2d0IHN0cnVjdHVyZQotICogQHhmZXI6IGN1c3RvbSB1QyBm
aXJtd2FyZSBsb2FkZXIgZnVuY3Rpb24KKyAqIEB3b3BjbV9vZmZzZXQ6IGRlc3RpbmF0aW9uIG9m
ZnNldCBpbiB3b3BjbQorICogQGRtYV9mbGFnczogZmxhZ3MgZm9yIGZsYWdzIGZvciBkbWEgY3Ry
bAogICoKLSAqIExvYWRzIHVDIGZpcm13YXJlIHVzaW5nIGN1c3RvbSBsb2FkZXIgYW5kIHVwZGF0
ZXMgaW50ZXJuYWwgZmxhZ3MuCisgKiBMb2FkcyB1QyBmaXJtd2FyZSBhbmQgdXBkYXRlcyBpbnRl
cm5hbCBmbGFncy4KICAqCiAgKiBSZXR1cm46IDAgb24gc3VjY2Vzcywgbm9uLXplcm8gb24gZmFp
bHVyZS4KICAqLwogaW50IGludGVsX3VjX2Z3X3VwbG9hZChzdHJ1Y3QgaW50ZWxfdWNfZncgKnVj
X2Z3LCBzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAotCQkgICAgICAgaW50ICgqeGZlcikoc3RydWN0IGlu
dGVsX3VjX2Z3ICp1Y19mdywgc3RydWN0IGludGVsX2d0ICpndCkpCisJCSAgICAgICB1MzIgd29w
Y21fb2Zmc2V0LCB1MzIgZG1hX2ZsYWdzKQogewogCWludCBlcnI7CiAKQEAgLTI4NCw3ICszNDAs
NyBAQCBpbnQgaW50ZWxfdWNfZndfdXBsb2FkKHN0cnVjdCBpbnRlbF91Y19mdyAqdWNfZncsIHN0
cnVjdCBpbnRlbF9ndCAqZ3QsCiAKIAkvKiBDYWxsIGN1c3RvbSBsb2FkZXIgKi8KIAlpbnRlbF91
Y19md19nZ3R0X2JpbmQodWNfZncsIGd0KTsKLQllcnIgPSB4ZmVyKHVjX2Z3LCBndCk7CisJZXJy
ID0gdWNfZndfeGZlcih1Y19mdywgZ3QsIHdvcGNtX29mZnNldCwgZG1hX2ZsYWdzKTsKIAlpbnRl
bF91Y19md19nZ3R0X3VuYmluZCh1Y19mdywgZ3QpOwogCWlmIChlcnIpCiAJCWdvdG8gZmFpbDsK
QEAgLTMzNywxNyArMzkzLDYgQEAgdm9pZCBpbnRlbF91Y19md19maW5pKHN0cnVjdCBpbnRlbF91
Y19mdyAqdWNfZncpCiAJaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKHVjX2Z3LT5vYmopOwog
fQogCi11MzIgaW50ZWxfdWNfZndfZ2d0dF9vZmZzZXQoc3RydWN0IGludGVsX3VjX2Z3ICp1Y19m
dywgc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCkKLXsKLQlzdHJ1Y3QgZHJtX21tX25vZGUgKm5vZGUg
PSAmZ2d0dC0+dWNfZnc7Ci0KLQlHRU1fQlVHX09OKCFub2RlLT5hbGxvY2F0ZWQpOwotCUdFTV9C
VUdfT04odXBwZXJfMzJfYml0cyhub2RlLT5zdGFydCkpOwotCUdFTV9CVUdfT04odXBwZXJfMzJf
Yml0cyhub2RlLT5zdGFydCArIG5vZGUtPnNpemUgLSAxKSk7Ci0KLQlyZXR1cm4gbG93ZXJfMzJf
Yml0cyhub2RlLT5zdGFydCk7Ci19Ci0KIC8qKgogICogaW50ZWxfdWNfZndfY2xlYW51cF9mZXRj
aCAtIGNsZWFudXAgdUMgZmlybXdhcmUKICAqCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC91Yy9pbnRlbF91Y19mdy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50
ZWxfdWNfZncuaAppbmRleCA0MDQzZGE2OWRiNjAuLmQ1ZGI4ZDEyYTJjMiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfdWNfZncuaAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC91Yy9pbnRlbF91Y19mdy5oCkBAIC0zMiw3ICszMiw2IEBACiBzdHJ1Y3Qg
ZHJtX3ByaW50ZXI7CiBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZTsKIHN0cnVjdCBpbnRlbF9ndDsK
LXN0cnVjdCBpOTE1X2dndHQ7CiAKIC8qIEhvbWUgb2YgR3VDLCBIdUMgYW5kIERNQyBmaXJtd2Fy
ZXMgKi8KICNkZWZpbmUgSU5URUxfVUNfRklSTVdBUkVfVVJMICJodHRwczovL2dpdC5rZXJuZWwu
b3JnL3B1Yi9zY20vbGludXgva2VybmVsL2dpdC9maXJtd2FyZS9saW51eC1maXJtd2FyZS5naXQv
dHJlZS9pOTE1IgpAQCAtMTk3LDEwICsxOTYsOSBAQCB2b2lkIGludGVsX3VjX2Z3X2ZldGNoKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkgICAgICAgc3RydWN0IGludGVsX3VjX2Z3
ICp1Y19mdyk7CiB2b2lkIGludGVsX3VjX2Z3X2NsZWFudXBfZmV0Y2goc3RydWN0IGludGVsX3Vj
X2Z3ICp1Y19mdyk7CiBpbnQgaW50ZWxfdWNfZndfdXBsb2FkKHN0cnVjdCBpbnRlbF91Y19mdyAq
dWNfZncsIHN0cnVjdCBpbnRlbF9ndCAqZ3QsCi0JCSAgICAgICBpbnQgKCp4ZmVyKShzdHJ1Y3Qg
aW50ZWxfdWNfZncgKnVjX2Z3LCBzdHJ1Y3QgaW50ZWxfZ3QgKmd0KSk7CisJCSAgICAgICB1MzIg
d29wY21fb2Zmc2V0LCB1MzIgZG1hX2ZsYWdzKTsKIGludCBpbnRlbF91Y19md19pbml0KHN0cnVj
dCBpbnRlbF91Y19mdyAqdWNfZncpOwogdm9pZCBpbnRlbF91Y19md19maW5pKHN0cnVjdCBpbnRl
bF91Y19mdyAqdWNfZncpOwotdTMyIGludGVsX3VjX2Z3X2dndHRfb2Zmc2V0KHN0cnVjdCBpbnRl
bF91Y19mdyAqdWNfZncsIHN0cnVjdCBpOTE1X2dndHQgKmdndHQpOwogdm9pZCBpbnRlbF91Y19m
d19jb3B5X3JzYShzdHJ1Y3QgaW50ZWxfdWNfZncgKnVjX2Z3LCB2b2lkICpkc3QsIHUzMiBtYXhf
bGVuKTsKIHZvaWQgaW50ZWxfdWNfZndfZHVtcChjb25zdCBzdHJ1Y3QgaW50ZWxfdWNfZncgKnVj
X2Z3LCBzdHJ1Y3QgZHJtX3ByaW50ZXIgKnApOwogCi0tIAoyLjIyLjAKCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QK
SW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9w
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

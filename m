Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 43ED5C38E6
	for <lists+intel-gfx@lfdr.de>; Tue,  1 Oct 2019 17:25:18 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A869D6E06D;
	Tue,  1 Oct 2019 15:25:16 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga06.intel.com (mga06.intel.com [134.134.136.31])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6DA036E06D
 for <intel-gfx@lists.freedesktop.org>; Tue,  1 Oct 2019 15:25:15 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by orsmga104.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 01 Oct 2019 08:25:14 -0700
X-IronPort-AV: E=Sophos;i="5.64,571,1559545200"; d="scan'208";a="185211180"
Received: from jnikula-mobl3.fi.intel.com (HELO localhost) ([10.237.66.161])
 by orsmga008-auth.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 01 Oct 2019 08:25:12 -0700
From: Jani Nikula <jani.nikula@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue,  1 Oct 2019 18:25:06 +0300
Message-Id: <20191001152506.7854-1-jani.nikula@intel.com>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Organization: Intel Finland Oy - BIC 0357606-4 - Westendinkatu 7, 02160 Espoo
Subject: [Intel-gfx] [PATCH] drm/i915/display: abstract all vgaarb access to
 intel_vga.[ch]
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U3BsaXQgb3V0IHRoZSBjb2RlIHJlbGF0ZWQgdG8gdmdhIGNsaWVudCBhbmQgdmdhYXJiIGFsbCBv
dmVyIHRoZSBwbGFjZQppbnRvIG5ldyBpbnRlbF92Z2EuW2NoXS4gTm8gZnVuY3Rpb25hbCBjaGFu
Z2VzLgoKQ2M6IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBsaW51eC5pbnRlbC5jb20+
CkNjOiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KU2lnbmVkLW9mZi1i
eTogSmFuaSBOaWt1bGEgPGphbmkubmlrdWxhQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9NYWtlZmlsZSAgICAgICAgICAgICAgICAgfCAgIDMgKy0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jICB8ICA5NyArLS0tLS0tLS0tLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmggIHwgICAzIC0KIC4uLi9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfcG93ZXIuYyAgICB8ICAyNCArLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfdmdhLmMgICAgICB8IDE2MCArKysrKysrKysrKysr
KysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfdmdhLmggICAgICB8ICAx
OCArKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYyAgICAgICAgICAgICAgIHwgIDMw
ICstLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNpLmMgICAgICAgICAgICAgICB8ICAg
MSAtCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N1c3BlbmQuYyAgICAgICAgICAgfCAgIDMg
Ky0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3J1bnRpbWVfcG0uYyAgICAgICB8ICAgMSAt
CiAxMCBmaWxlcyBjaGFuZ2VkLCAxOTQgaW5zZXJ0aW9ucygrKSwgMTQ2IGRlbGV0aW9ucygtKQog
Y3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfdmdh
LmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X3ZnYS5oCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQppbmRleCBlMDQ0NjNkODU0MDEuLmQyYjUzYjVhZGQ4
MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKQEAgLTE4NCw3ICsxODQsOCBAQCBpOTE1LXkgKz0gXAog
CWRpc3BsYXkvaW50ZWxfcHNyLm8gXAogCWRpc3BsYXkvaW50ZWxfcXVpcmtzLm8gXAogCWRpc3Bs
YXkvaW50ZWxfc3ByaXRlLm8gXAotCWRpc3BsYXkvaW50ZWxfdGMubworCWRpc3BsYXkvaW50ZWxf
dGMubyBcCisJZGlzcGxheS9pbnRlbF92Z2EubwogaTkxNS0kKENPTkZJR19BQ1BJKSArPSBcCiAJ
ZGlzcGxheS9pbnRlbF9hY3BpLm8gXAogCWRpc3BsYXkvaW50ZWxfb3ByZWdpb24ubwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRleCBmMTMyOGMwOGY0
YWQuLmQ5OWM1OWU5NzU2OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kaXNwbGF5LmMKQEAgLTMxLDcgKzMxLDYgQEAKICNpbmNsdWRlIDxsaW51eC9tb2R1bGUuaD4K
ICNpbmNsdWRlIDxsaW51eC9kbWEtcmVzdi5oPgogI2luY2x1ZGUgPGxpbnV4L3NsYWIuaD4KLSNp
bmNsdWRlIDxsaW51eC92Z2FhcmIuaD4KIAogI2luY2x1ZGUgPGRybS9kcm1fYXRvbWljLmg+CiAj
aW5jbHVkZSA8ZHJtL2RybV9hdG9taWNfaGVscGVyLmg+CkBAIC03OSw2ICs3OCw3IEBACiAjaW5j
bHVkZSAiaW50ZWxfc2lkZWJhbmQuaCIKICNpbmNsdWRlICJpbnRlbF9zcHJpdGUuaCIKICNpbmNs
dWRlICJpbnRlbF90Yy5oIgorI2luY2x1ZGUgImludGVsX3ZnYS5oIgogCiAvKiBQcmltYXJ5IHBs
YW5lIGZvcm1hdHMgZm9yIGdlbiA8PSAzICovCiBzdGF0aWMgY29uc3QgdTMyIGk4eHhfcHJpbWFy
eV9mb3JtYXRzW10gPSB7CkBAIC00MjQxLDcgKzQyNDEsNyBAQCBfX2ludGVsX2Rpc3BsYXlfcmVz
dW1lKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJaW50IGksIHJldDsKIAogCWludGVsX21vZGVz
ZXRfc2V0dXBfaHdfc3RhdGUoZGV2LCBjdHgpOwotCWk5MTVfcmVkaXNhYmxlX3ZnYSh0b19pOTE1
KGRldikpOworCWludGVsX3ZnYV9yZWRpc2FibGUodG9faTkxNShkZXYpKTsKIAogCWlmICghc3Rh
dGUpCiAJCXJldHVybiAwOwpAQCAtMTU5OTQsMzUgKzE1OTk0LDYgQEAgdm9pZCBpbnRlbF9pbml0
X2Rpc3BsYXlfaG9va3Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCiB9CiAK
LXN0YXRpYyBpOTE1X3JlZ190IGk5MTVfdmdhY250cmxfcmVnKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKLXsKLQlpZiAoSVNfVkFMTEVZVklFVyhkZXZfcHJpdikgfHwgSVNfQ0hF
UlJZVklFVyhkZXZfcHJpdikpCi0JCXJldHVybiBWTFZfVkdBQ05UUkw7Ci0JZWxzZSBpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA+PSA1KQotCQlyZXR1cm4gQ1BVX1ZHQUNOVFJMOwotCWVsc2UKLQkJ
cmV0dXJuIFZHQUNOVFJMOwotfQotCi0vKiBEaXNhYmxlIHRoZSBWR0EgcGxhbmUgdGhhdCB3ZSBu
ZXZlciB1c2UgKi8KLXN0YXRpYyB2b2lkIGk5MTVfZGlzYWJsZV92Z2Eoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KQotewotCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gZGV2X3ByaXYt
PmRybS5wZGV2OwotCXU4IHNyMTsKLQlpOTE1X3JlZ190IHZnYV9yZWcgPSBpOTE1X3ZnYWNudHJs
X3JlZyhkZXZfcHJpdik7Ci0KLQkvKiBXYUVuYWJsZVZHQUFjY2Vzc1Rocm91Z2hJT1BvcnQ6Y3Rn
LGVsayxpbGssc25iLGl2Yix2bHYsaHN3ICovCi0JdmdhX2dldF91bmludGVycnVwdGlibGUocGRl
diwgVkdBX1JTUkNfTEVHQUNZX0lPKTsKLQlvdXRiKFNSMDEsIFZHQV9TUl9JTkRFWCk7Ci0Jc3Ix
ID0gaW5iKFZHQV9TUl9EQVRBKTsKLQlvdXRiKHNyMSB8IDE8PDUsIFZHQV9TUl9EQVRBKTsKLQl2
Z2FfcHV0KHBkZXYsIFZHQV9SU1JDX0xFR0FDWV9JTyk7Ci0JdWRlbGF5KDMwMCk7Ci0KLQlJOTE1
X1dSSVRFKHZnYV9yZWcsIFZHQV9ESVNQX0RJU0FCTEUpOwotCVBPU1RJTkdfUkVBRCh2Z2FfcmVn
KTsKLX0KLQogdm9pZCBpbnRlbF9tb2Rlc2V0X2luaXRfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpCiB7CiAJaW50ZWxfdXBkYXRlX2NkY2xrKGk5MTUpOwpAQCAtMTYyODgsNyArMTYy
NTksNyBAQCBpbnQgaW50ZWxfbW9kZXNldF9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQogCQlpbnRlbF91cGRhdGVfbWF4X2NkY2xrKGk5MTUpOwogCiAJLyogSnVzdCBkaXNhYmxl
IGl0IG9uY2UgYXQgc3RhcnR1cCAqLwotCWk5MTVfZGlzYWJsZV92Z2EoaTkxNSk7CisJaW50ZWxf
dmdhX2Rpc2FibGUoaTkxNSk7CiAJaW50ZWxfc2V0dXBfb3V0cHV0cyhpOTE1KTsKIAogCWRybV9t
b2Rlc2V0X2xvY2tfYWxsKGRldik7CkBAIC0xNjY0NywzOSArMTY2MTgsNiBAQCBzdGF0aWMgdm9p
ZCBpbnRlbF9zYW5pdGl6ZV9lbmNvZGVyKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQog
CQlpY2xfc2FuaXRpemVfZW5jb2Rlcl9wbGxfbWFwcGluZyhlbmNvZGVyKTsKIH0KIAotdm9pZCBp
OTE1X3JlZGlzYWJsZV92Z2FfcG93ZXJfb24oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQotewotCWk5MTVfcmVnX3QgdmdhX3JlZyA9IGk5MTVfdmdhY250cmxfcmVnKGRldl9wcml2
KTsKLQotCWlmICghKEk5MTVfUkVBRCh2Z2FfcmVnKSAmIFZHQV9ESVNQX0RJU0FCTEUpKSB7Ci0J
CURSTV9ERUJVR19LTVMoIlNvbWV0aGluZyBlbmFibGVkIFZHQSBwbGFuZSwgZGlzYWJsaW5nIGl0
XG4iKTsKLQkJaTkxNV9kaXNhYmxlX3ZnYShkZXZfcHJpdik7Ci0JfQotfQotCi12b2lkIGk5MTVf
cmVkaXNhYmxlX3ZnYShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCi17Ci0JaW50
ZWxfd2FrZXJlZl90IHdha2VyZWY7Ci0KLQkvKgotCSAqIFRoaXMgZnVuY3Rpb24gY2FuIGJlIGNh
bGxlZCBib3RoIGZyb20gaW50ZWxfbW9kZXNldF9zZXR1cF9od19zdGF0ZSBvcgotCSAqIGF0IGEg
dmVyeSBlYXJseSBwb2ludCBpbiBvdXIgcmVzdW1lIHNlcXVlbmNlLCB3aGVyZSB0aGUgcG93ZXIg
d2VsbAotCSAqIHN0cnVjdHVyZXMgYXJlIG5vdCB5ZXQgcmVzdG9yZWQuIFNpbmNlIHRoaXMgZnVu
Y3Rpb24gaXMgYXQgYSB2ZXJ5Ci0JICogcGFyYW5vaWQgInNvbWVvbmUgbWlnaHQgaGF2ZSBlbmFi
bGVkIFZHQSB3aGlsZSB3ZSB3ZXJlIG5vdCBsb29raW5nIgotCSAqIGxldmVsLCBqdXN0IGNoZWNr
IGlmIHRoZSBwb3dlciB3ZWxsIGlzIGVuYWJsZWQgaW5zdGVhZCBvZiB0cnlpbmcgdG8KLQkgKiBm
b2xsb3cgdGhlICJkb24ndCB0b3VjaCB0aGUgcG93ZXIgd2VsbCBpZiB3ZSBkb24ndCBuZWVkIGl0
IiBwb2xpY3kKLQkgKiB0aGUgcmVzdCBvZiB0aGUgZHJpdmVyIHVzZXMuCi0JICovCi0Jd2FrZXJl
ZiA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0X2lmX2VuYWJsZWQoZGV2X3ByaXYsCi0JCQkJCQkg
ICAgIFBPV0VSX0RPTUFJTl9WR0EpOwotCWlmICghd2FrZXJlZikKLQkJcmV0dXJuOwotCi0JaTkx
NV9yZWRpc2FibGVfdmdhX3Bvd2VyX29uKGRldl9wcml2KTsKLQotCWludGVsX2Rpc3BsYXlfcG93
ZXJfcHV0KGRldl9wcml2LCBQT1dFUl9ET01BSU5fVkdBLCB3YWtlcmVmKTsKLX0KLQogLyogRklY
TUUgcmVhZCBvdXQgZnVsbCBwbGFuZSBzdGF0ZSBmb3IgYWxsIHBsYW5lcyAqLwogc3RhdGljIHZv
aWQgcmVhZG91dF9wbGFuZV9zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiB7CkBAIC0xNzE4OCwzNSArMTcxMjYsNiBAQCB2b2lkIGludGVsX21vZGVzZXRfZHJpdmVyX3Jl
bW92ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAlpbnRlbF9mYmNfY2xlYW51cF9j
ZmIoaTkxNSk7CiB9CiAKLS8qCi0gKiBzZXQgdmdhIGRlY29kZSBzdGF0ZSAtIHRydWUgPT0gZW5h
YmxlIFZHQSBkZWNvZGUKLSAqLwotaW50IGludGVsX21vZGVzZXRfdmdhX3NldF9zdGF0ZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGJvb2wgc3RhdGUpCi17Ci0JdW5zaWduZWQg
cmVnID0gSU5URUxfR0VOKGRldl9wcml2KSA+PSA2ID8gU05CX0dNQ0hfQ1RSTCA6IElOVEVMX0dN
Q0hfQ1RSTDsKLQl1MTYgZ21jaF9jdHJsOwotCi0JaWYgKHBjaV9yZWFkX2NvbmZpZ193b3JkKGRl
dl9wcml2LT5icmlkZ2VfZGV2LCByZWcsICZnbWNoX2N0cmwpKSB7Ci0JCURSTV9FUlJPUigiZmFp
bGVkIHRvIHJlYWQgY29udHJvbCB3b3JkXG4iKTsKLQkJcmV0dXJuIC1FSU87Ci0JfQotCi0JaWYg
KCEhKGdtY2hfY3RybCAmIElOVEVMX0dNQ0hfVkdBX0RJU0FCTEUpID09ICFzdGF0ZSkKLQkJcmV0
dXJuIDA7Ci0KLQlpZiAoc3RhdGUpCi0JCWdtY2hfY3RybCAmPSB+SU5URUxfR01DSF9WR0FfRElT
QUJMRTsKLQllbHNlCi0JCWdtY2hfY3RybCB8PSBJTlRFTF9HTUNIX1ZHQV9ESVNBQkxFOwotCi0J
aWYgKHBjaV93cml0ZV9jb25maWdfd29yZChkZXZfcHJpdi0+YnJpZGdlX2RldiwgcmVnLCBnbWNo
X2N0cmwpKSB7Ci0JCURSTV9FUlJPUigiZmFpbGVkIHRvIHdyaXRlIGNvbnRyb2wgd29yZFxuIik7
Ci0JCXJldHVybiAtRUlPOwotCX0KLQotCXJldHVybiAwOwotfQotCiAjaWYgSVNfRU5BQkxFRChD
T05GSUdfRFJNX0k5MTVfQ0FQVFVSRV9FUlJPUikKIAogc3RydWN0IGludGVsX2Rpc3BsYXlfZXJy
b3Jfc3RhdGUgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kaXNwbGF5LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXku
aAppbmRleCA0YjllMThlNWEyNjMuLjI3ODJmMjNlZTg4NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmgKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmgKQEAgLTU3OSwxMCArNTc5LDcgQEAgdm9pZCBp
bnRlbF9kaXNwbGF5X3ByaW50X2Vycm9yX3N0YXRlKHN0cnVjdCBkcm1faTkxNV9lcnJvcl9zdGF0
ZV9idWYgKmUsCiB2b2lkIGludGVsX21vZGVzZXRfaW5pdF9odyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSk7CiBpbnQgaW50ZWxfbW9kZXNldF9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KTsKIHZvaWQgaW50ZWxfbW9kZXNldF9kcml2ZXJfcmVtb3ZlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1KTsKLWludCBpbnRlbF9tb2Rlc2V0X3ZnYV9zZXRfc3RhdGUoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBib29sIHN0YXRlKTsKIHZvaWQgaW50ZWxf
ZGlzcGxheV9yZXN1bWUoc3RydWN0IGRybV9kZXZpY2UgKmRldik7Ci12b2lkIGk5MTVfcmVkaXNh
YmxlX3ZnYShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwotdm9pZCBpOTE1X3Jl
ZGlzYWJsZV92Z2FfcG93ZXJfb24oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsK
IHZvaWQgaW50ZWxfaW5pdF9wY2hfcmVmY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdik7CiAKIC8qIG1vZGVzZXR0aW5nIGFzc2VydHMgKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmMKaW5kZXggZjExODZiYzIzNTQy
Li5iYjY0MmExYTBkZDQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGlzcGxheV9wb3dlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGlzcGxheV9wb3dlci5jCkBAIC0zLDggKzMsNiBAQAogICogQ29weXJpZ2h0IMKpIDIw
MTkgSW50ZWwgQ29ycG9yYXRpb24KICAqLwogCi0jaW5jbHVkZSA8bGludXgvdmdhYXJiLmg+Ci0K
ICNpbmNsdWRlICJkaXNwbGF5L2ludGVsX2NydC5oIgogI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxf
ZHAuaCIKIApAQCAtMTksNiArMTcsNyBAQAogI2luY2x1ZGUgImludGVsX2hvdHBsdWcuaCIKICNp
bmNsdWRlICJpbnRlbF9zaWRlYmFuZC5oIgogI2luY2x1ZGUgImludGVsX3RjLmgiCisjaW5jbHVk
ZSAiaW50ZWxfdmdhLmgiCiAKIGJvb2wgaW50ZWxfZGlzcGxheV9wb3dlcl93ZWxsX2lzX2VuYWJs
ZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkJCQkgZW51bSBpOTE1X3Bv
d2VyX3dlbGxfaWQgcG93ZXJfd2VsbF9pZCk7CkBAIC0yNjcsMjMgKzI2Niw4IEBAIGJvb2wgaW50
ZWxfZGlzcGxheV9wb3dlcl9pc19lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKIHN0YXRpYyB2b2lkIGhzd19wb3dlcl93ZWxsX3Bvc3RfZW5hYmxlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCQkgICAgICAgdTggaXJxX3BpcGVfbWFzaywgYm9v
bCBoYXNfdmdhKQogewotCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gZGV2X3ByaXYtPmRybS5wZGV2
OwotCi0JLyoKLQkgKiBBZnRlciB3ZSByZS1lbmFibGUgdGhlIHBvd2VyIHdlbGwsIGlmIHdlIHRv
dWNoIFZHQSByZWdpc3RlciAweDNkNQotCSAqIHdlJ2xsIGdldCB1bmNsYWltZWQgcmVnaXN0ZXIg
aW50ZXJydXB0cy4gVGhpcyBzdG9wcyBhZnRlciB3ZSB3cml0ZQotCSAqIGFueXRoaW5nIHRvIHRo
ZSBWR0EgTVNSIHJlZ2lzdGVyLiBUaGUgdmdhY29uIG1vZHVsZSB1c2VzIHRoaXMKLQkgKiByZWdp
c3RlciBhbGwgdGhlIHRpbWUsIHNvIGlmIHdlIHVuYmluZCBvdXIgZHJpdmVyIGFuZCwgYXMgYQot
CSAqIGNvbnNlcXVlbmNlLCBiaW5kIHZnYWNvbiwgd2UnbGwgZ2V0IHN0dWNrIGluIGFuIGluZmlu
aXRlIGxvb3AgYXQKLQkgKiBjb25zb2xlX3VubG9jaygpLiBTbyBtYWtlIGhlcmUgd2UgdG91Y2gg
dGhlIFZHQSBNU1IgcmVnaXN0ZXIsIG1ha2luZwotCSAqIHN1cmUgdmdhY29uIGNhbiBrZWVwIHdv
cmtpbmcgbm9ybWFsbHkgd2l0aG91dCB0cmlnZ2VyaW5nIGludGVycnVwdHMKLQkgKiBhbmQgZXJy
b3IgbWVzc2FnZXMuCi0JICovCi0JaWYgKGhhc192Z2EpIHsKLQkJdmdhX2dldF91bmludGVycnVw
dGlibGUocGRldiwgVkdBX1JTUkNfTEVHQUNZX0lPKTsKLQkJb3V0YihpbmIoVkdBX01TUl9SRUFE
KSwgVkdBX01TUl9XUklURSk7Ci0JCXZnYV9wdXQocGRldiwgVkdBX1JTUkNfTEVHQUNZX0lPKTsK
LQl9CisJaWYgKGhhc192Z2EpCisJCWludGVsX3ZnYV9tc3Jfd3JpdGUoZGV2X3ByaXYpOwogCiAJ
aWYgKGlycV9waXBlX21hc2spCiAJCWdlbjhfaXJxX3Bvd2VyX3dlbGxfcG9zdF9lbmFibGUoZGV2
X3ByaXYsIGlycV9waXBlX21hc2spOwpAQCAtMTIwNSw3ICsxMTg5LDcgQEAgc3RhdGljIHZvaWQg
dmx2X2Rpc3BsYXlfcG93ZXJfd2VsbF9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIAkJCWludGVsX2NydF9yZXNldCgmZW5jb2Rlci0+YmFzZSk7CiAJfQogCi0JaTkxNV9y
ZWRpc2FibGVfdmdhX3Bvd2VyX29uKGRldl9wcml2KTsKKwlpbnRlbF92Z2FfcmVkaXNhYmxlX3Bv
d2VyX29uKGRldl9wcml2KTsKIAogCWludGVsX3Bwc191bmxvY2tfcmVnc193YShkZXZfcHJpdik7
CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3ZnYS5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF92Z2EuYwpuZXcgZmlsZSBtb2Rl
IDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjczMjU2OGVhYTk4OAotLS0gL2Rldi9udWxsCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfdmdhLmMKQEAgLTAsMCArMSwx
NjAgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKKy8qCisgKiBDb3B5cmlnaHQg
wqkgMjAxOSBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpbmNsdWRlIDxsaW51eC9wY2kuaD4K
KyNpbmNsdWRlIDxsaW51eC92Z2FhcmIuaD4KKworI2luY2x1ZGUgPGRybS9pOTE1X2RybS5oPgor
CisjaW5jbHVkZSAiaTkxNV9kcnYuaCIKKyNpbmNsdWRlICJpbnRlbF92Z2EuaCIKKworc3RhdGlj
IGk5MTVfcmVnX3QgaW50ZWxfdmdhX2NudHJsX3JlZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKK3sKKwlpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSB8fCBJU19DSEVSUllWSUVXKGk5MTUp
KQorCQlyZXR1cm4gVkxWX1ZHQUNOVFJMOworCWVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+PSA1
KQorCQlyZXR1cm4gQ1BVX1ZHQUNOVFJMOworCWVsc2UKKwkJcmV0dXJuIFZHQUNOVFJMOworfQor
CisvKiBEaXNhYmxlIHRoZSBWR0EgcGxhbmUgdGhhdCB3ZSBuZXZlciB1c2UgKi8KK3ZvaWQgaW50
ZWxfdmdhX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoreworCXN0
cnVjdCBwY2lfZGV2ICpwZGV2ID0gZGV2X3ByaXYtPmRybS5wZGV2OworCWk5MTVfcmVnX3Qgdmdh
X3JlZyA9IGludGVsX3ZnYV9jbnRybF9yZWcoZGV2X3ByaXYpOworCXU4IHNyMTsKKworCS8qIFdh
RW5hYmxlVkdBQWNjZXNzVGhyb3VnaElPUG9ydDpjdGcsZWxrLGlsayxzbmIsaXZiLHZsdixoc3cg
Ki8KKwl2Z2FfZ2V0X3VuaW50ZXJydXB0aWJsZShwZGV2LCBWR0FfUlNSQ19MRUdBQ1lfSU8pOwor
CW91dGIoU1IwMSwgVkdBX1NSX0lOREVYKTsKKwlzcjEgPSBpbmIoVkdBX1NSX0RBVEEpOworCW91
dGIoc3IxIHwgMSA8PCA1LCBWR0FfU1JfREFUQSk7CisJdmdhX3B1dChwZGV2LCBWR0FfUlNSQ19M
RUdBQ1lfSU8pOworCXVkZWxheSgzMDApOworCisJSTkxNV9XUklURSh2Z2FfcmVnLCBWR0FfRElT
UF9ESVNBQkxFKTsKKwlQT1NUSU5HX1JFQUQodmdhX3JlZyk7Cit9CisKK3ZvaWQgaW50ZWxfdmdh
X3JlZGlzYWJsZV9wb3dlcl9vbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit7
CisJaTkxNV9yZWdfdCB2Z2FfcmVnID0gaW50ZWxfdmdhX2NudHJsX3JlZyhkZXZfcHJpdik7CisK
KwlpZiAoIShJOTE1X1JFQUQodmdhX3JlZykgJiBWR0FfRElTUF9ESVNBQkxFKSkgeworCQlEUk1f
REVCVUdfS01TKCJTb21ldGhpbmcgZW5hYmxlZCBWR0EgcGxhbmUsIGRpc2FibGluZyBpdFxuIik7
CisJCWludGVsX3ZnYV9kaXNhYmxlKGRldl9wcml2KTsKKwl9Cit9CisKK3ZvaWQgaW50ZWxfdmdh
X3JlZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3sKKwlpbnRlbF93YWtl
cmVmX3Qgd2FrZXJlZjsKKworCS8qCisJICogVGhpcyBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIGJv
dGggZnJvbSBpbnRlbF9tb2Rlc2V0X3NldHVwX2h3X3N0YXRlIG9yCisJICogYXQgYSB2ZXJ5IGVh
cmx5IHBvaW50IGluIG91ciByZXN1bWUgc2VxdWVuY2UsIHdoZXJlIHRoZSBwb3dlciB3ZWxsCisJ
ICogc3RydWN0dXJlcyBhcmUgbm90IHlldCByZXN0b3JlZC4gU2luY2UgdGhpcyBmdW5jdGlvbiBp
cyBhdCBhIHZlcnkKKwkgKiBwYXJhbm9pZCAic29tZW9uZSBtaWdodCBoYXZlIGVuYWJsZWQgVkdB
IHdoaWxlIHdlIHdlcmUgbm90IGxvb2tpbmciCisJICogbGV2ZWwsIGp1c3QgY2hlY2sgaWYgdGhl
IHBvd2VyIHdlbGwgaXMgZW5hYmxlZCBpbnN0ZWFkIG9mIHRyeWluZyB0bworCSAqIGZvbGxvdyB0
aGUgImRvbid0IHRvdWNoIHRoZSBwb3dlciB3ZWxsIGlmIHdlIGRvbid0IG5lZWQgaXQiIHBvbGlj
eQorCSAqIHRoZSByZXN0IG9mIHRoZSBkcml2ZXIgdXNlcy4KKwkgKi8KKwl3YWtlcmVmID0gaW50
ZWxfZGlzcGxheV9wb3dlcl9nZXRfaWZfZW5hYmxlZChpOTE1LCBQT1dFUl9ET01BSU5fVkdBKTsK
KwlpZiAoIXdha2VyZWYpCisJCXJldHVybjsKKworCWludGVsX3ZnYV9yZWRpc2FibGVfcG93ZXJf
b24oaTkxNSk7CisKKwlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChpOTE1LCBQT1dFUl9ET01BSU5f
VkdBLCB3YWtlcmVmKTsKK30KKwordm9pZCBpbnRlbF92Z2FfbXNyX3dyaXRlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1KQoreworCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gaTkxNS0+ZHJt
LnBkZXY7CisKKwkvKgorCSAqIEFmdGVyIHdlIHJlLWVuYWJsZSB0aGUgcG93ZXIgd2VsbCwgaWYg
d2UgdG91Y2ggVkdBIHJlZ2lzdGVyIDB4M2Q1CisJICogd2UnbGwgZ2V0IHVuY2xhaW1lZCByZWdp
c3RlciBpbnRlcnJ1cHRzLiBUaGlzIHN0b3BzIGFmdGVyIHdlIHdyaXRlCisJICogYW55dGhpbmcg
dG8gdGhlIFZHQSBNU1IgcmVnaXN0ZXIuIFRoZSB2Z2Fjb24gbW9kdWxlIHVzZXMgdGhpcworCSAq
IHJlZ2lzdGVyIGFsbCB0aGUgdGltZSwgc28gaWYgd2UgdW5iaW5kIG91ciBkcml2ZXIgYW5kLCBh
cyBhCisJICogY29uc2VxdWVuY2UsIGJpbmQgdmdhY29uLCB3ZSdsbCBnZXQgc3R1Y2sgaW4gYW4g
aW5maW5pdGUgbG9vcCBhdAorCSAqIGNvbnNvbGVfdW5sb2NrKCkuIFNvIG1ha2UgaGVyZSB3ZSB0
b3VjaCB0aGUgVkdBIE1TUiByZWdpc3RlciwgbWFraW5nCisJICogc3VyZSB2Z2Fjb24gY2FuIGtl
ZXAgd29ya2luZyBub3JtYWxseSB3aXRob3V0IHRyaWdnZXJpbmcgaW50ZXJydXB0cworCSAqIGFu
ZCBlcnJvciBtZXNzYWdlcy4KKwkgKi8KKwl2Z2FfZ2V0X3VuaW50ZXJydXB0aWJsZShwZGV2LCBW
R0FfUlNSQ19MRUdBQ1lfSU8pOworCW91dGIoaW5iKFZHQV9NU1JfUkVBRCksIFZHQV9NU1JfV1JJ
VEUpOworCXZnYV9wdXQocGRldiwgVkdBX1JTUkNfTEVHQUNZX0lPKTsKK30KKworc3RhdGljIGlu
dAoraW50ZWxfdmdhX3NldF9zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgYm9v
bCBlbmFibGVfZGVjb2RlKQoreworCXVuc2lnbmVkIGludCByZWcgPSBJTlRFTF9HRU4oaTkxNSkg
Pj0gNiA/IFNOQl9HTUNIX0NUUkwgOiBJTlRFTF9HTUNIX0NUUkw7CisJdTE2IGdtY2hfY3RybDsK
KworCWlmIChwY2lfcmVhZF9jb25maWdfd29yZChpOTE1LT5icmlkZ2VfZGV2LCByZWcsICZnbWNo
X2N0cmwpKSB7CisJCURSTV9FUlJPUigiZmFpbGVkIHRvIHJlYWQgY29udHJvbCB3b3JkXG4iKTsK
KwkJcmV0dXJuIC1FSU87CisJfQorCisJaWYgKCEhKGdtY2hfY3RybCAmIElOVEVMX0dNQ0hfVkdB
X0RJU0FCTEUpID09ICFlbmFibGVfZGVjb2RlKQorCQlyZXR1cm4gMDsKKworCWlmIChlbmFibGVf
ZGVjb2RlKQorCQlnbWNoX2N0cmwgJj0gfklOVEVMX0dNQ0hfVkdBX0RJU0FCTEU7CisJZWxzZQor
CQlnbWNoX2N0cmwgfD0gSU5URUxfR01DSF9WR0FfRElTQUJMRTsKKworCWlmIChwY2lfd3JpdGVf
Y29uZmlnX3dvcmQoaTkxNS0+YnJpZGdlX2RldiwgcmVnLCBnbWNoX2N0cmwpKSB7CisJCURSTV9F
UlJPUigiZmFpbGVkIHRvIHdyaXRlIGNvbnRyb2wgd29yZFxuIik7CisJCXJldHVybiAtRUlPOwor
CX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgdW5zaWduZWQgaW50CitpbnRlbF92Z2Ffc2V0
X2RlY29kZSh2b2lkICpjb29raWUsIGJvb2wgZW5hYmxlX2RlY29kZSkKK3sKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGNvb2tpZTsKKworCWludGVsX3ZnYV9zZXRfc3RhdGUoaTkx
NSwgZW5hYmxlX2RlY29kZSk7CisKKwlpZiAoZW5hYmxlX2RlY29kZSkKKwkJcmV0dXJuIFZHQV9S
U1JDX0xFR0FDWV9JTyB8IFZHQV9SU1JDX0xFR0FDWV9NRU0gfAorCQkgICAgICAgVkdBX1JTUkNf
Tk9STUFMX0lPIHwgVkdBX1JTUkNfTk9STUFMX01FTTsKKwllbHNlCisJCXJldHVybiBWR0FfUlNS
Q19OT1JNQUxfSU8gfCBWR0FfUlNSQ19OT1JNQUxfTUVNOworfQorCitpbnQgaW50ZWxfdmdhX3Jl
Z2lzdGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQoreworCXN0cnVjdCBwY2lfZGV2
ICpwZGV2ID0gaTkxNS0+ZHJtLnBkZXY7CisJaW50IHJldDsKKworCS8qCisJICogSWYgd2UgaGF2
ZSA+IDEgVkdBIGNhcmRzLCB0aGVuIHdlIG5lZWQgdG8gYXJiaXRyYXRlIGFjY2VzcyB0byB0aGUK
KwkgKiBjb21tb24gVkdBIHJlc291cmNlcy4KKwkgKgorCSAqIElmIHdlIGFyZSBhIHNlY29uZGFy
eSBkaXNwbGF5IGNvbnRyb2xsZXIgKCFQQ0lfRElTUExBWV9DTEFTU19WR0EpLAorCSAqIHRoZW4g
d2UgZG8gbm90IHRha2UgcGFydCBpbiBWR0EgYXJiaXRyYXRpb24gYW5kIHRoZQorCSAqIHZnYV9j
bGllbnRfcmVnaXN0ZXIoKSBmYWlscyB3aXRoIC1FTk9ERVYuCisJICovCisJcmV0ID0gdmdhX2Ns
aWVudF9yZWdpc3RlcihwZGV2LCBpOTE1LCBOVUxMLCBpbnRlbF92Z2Ffc2V0X2RlY29kZSk7CisJ
aWYgKHJldCAmJiByZXQgIT0gLUVOT0RFVikKKwkJcmV0dXJuIHJldDsKKworCXJldHVybiAwOwor
fQorCit2b2lkIGludGVsX3ZnYV91bnJlZ2lzdGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQoreworCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gaTkxNS0+ZHJtLnBkZXY7CisKKwl2Z2Ff
Y2xpZW50X3JlZ2lzdGVyKHBkZXYsIE5VTEwsIE5VTEwsIE5VTEwpOworfQpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF92Z2EuaCBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfdmdhLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAw
MDAwMDAwMDAwLi4zNTE3ODcyZTYyYWMKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX3ZnYS5oCkBAIC0wLDAgKzEsMTggQEAKKy8qIFNQRFgtTGlj
ZW5zZS1JZGVudGlmaWVyOiBNSVQgKi8KKy8qCisgKiBDb3B5cmlnaHQgwqkgMjAxOSBJbnRlbCBD
b3Jwb3JhdGlvbgorICovCisKKyNpZm5kZWYgX19JTlRFTF9WR0FfSF9fCisjZGVmaW5lIF9fSU5U
RUxfVkdBX0hfXworCitzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZTsKKwordm9pZCBpbnRlbF92Z2Ff
bXNyX3dyaXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgaW50ZWxfdmdh
X2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwordm9pZCBpbnRlbF92Z2Ff
cmVkaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQgaW50ZWxfdmdh
X3JlZGlzYWJsZV9wb3dlcl9vbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CitpbnQg
aW50ZWxfdmdhX3JlZ2lzdGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKK3ZvaWQg
aW50ZWxfdmdhX3VucmVnaXN0ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOworCisj
ZW5kaWYgLyogX19JTlRFTF9WR0FfSF9fICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2Rydi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYwppbmRleCA5
MWFhZTU2YjQyODAuLjMzMDZjNmJiNTE1YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9kcnYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jCkBAIC0z
Niw3ICszNiw2IEBACiAjaW5jbHVkZSA8bGludXgvcG1fcnVudGltZS5oPgogI2luY2x1ZGUgPGxp
bnV4L3BucC5oPgogI2luY2x1ZGUgPGxpbnV4L3NsYWIuaD4KLSNpbmNsdWRlIDxsaW51eC92Z2Fh
cmIuaD4KICNpbmNsdWRlIDxsaW51eC92Z2Ffc3dpdGNoZXJvby5oPgogI2luY2x1ZGUgPGxpbnV4
L3Z0Lmg+CiAjaW5jbHVkZSA8YWNwaS92aWRlby5oPgpAQCAtNTksNiArNTgsNyBAQAogI2luY2x1
ZGUgImRpc3BsYXkvaW50ZWxfb3ZlcmxheS5oIgogI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfcGlw
ZV9jcmMuaCIKICNpbmNsdWRlICJkaXNwbGF5L2ludGVsX3Nwcml0ZS5oIgorI2luY2x1ZGUgImRp
c3BsYXkvaW50ZWxfdmdhLmgiCiAKICNpbmNsdWRlICJnZW0vaTkxNV9nZW1fY29udGV4dC5oIgog
I2luY2x1ZGUgImdlbS9pOTE1X2dlbV9pb2N0bHMuaCIKQEAgLTI2OSwxOSArMjY5LDYgQEAgaW50
ZWxfdGVhcmRvd25fbWNoYmFyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJ
cmVsZWFzZV9yZXNvdXJjZSgmZGV2X3ByaXYtPm1jaF9yZXMpOwogfQogCi0vKiB0cnVlID0gZW5h
YmxlIGRlY29kZSwgZmFsc2UgPSBkaXNhYmxlIGRlY29kZXIgKi8KLXN0YXRpYyB1bnNpZ25lZCBp
bnQgaTkxNV92Z2Ffc2V0X2RlY29kZSh2b2lkICpjb29raWUsIGJvb2wgc3RhdGUpCi17Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gY29va2llOwotCi0JaW50ZWxfbW9kZXNl
dF92Z2Ffc2V0X3N0YXRlKGRldl9wcml2LCBzdGF0ZSk7Ci0JaWYgKHN0YXRlKQotCQlyZXR1cm4g
VkdBX1JTUkNfTEVHQUNZX0lPIHwgVkdBX1JTUkNfTEVHQUNZX01FTSB8Ci0JCSAgICAgICBWR0Ff
UlNSQ19OT1JNQUxfSU8gfCBWR0FfUlNSQ19OT1JNQUxfTUVNOwotCWVsc2UKLQkJcmV0dXJuIFZH
QV9SU1JDX05PUk1BTF9JTyB8IFZHQV9SU1JDX05PUk1BTF9NRU07Ci19Ci0KIHN0YXRpYyBpbnQg
aTkxNV9yZXN1bWVfc3dpdGNoZXJvbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CiBz
dGF0aWMgaW50IGk5MTVfc3VzcGVuZF9zd2l0Y2hlcm9vKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAogCQkJCSAgIHBtX21lc3NhZ2VfdCBzdGF0ZSk7CkBAIC0zNDYsMTUgKzMzMyw4IEBA
IHN0YXRpYyBpbnQgaTkxNV9kcml2ZXJfbW9kZXNldF9wcm9iZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSkKIAogCWludGVsX2Jpb3NfaW5pdChpOTE1KTsKIAotCS8qIElmIHdlIGhhdmUg
PiAxIFZHQSBjYXJkcywgdGhlbiB3ZSBuZWVkIHRvIGFyYml0cmF0ZSBhY2Nlc3MKLQkgKiB0byB0
aGUgY29tbW9uIFZHQSByZXNvdXJjZXMuCi0JICoKLQkgKiBJZiB3ZSBhcmUgYSBzZWNvbmRhcnkg
ZGlzcGxheSBjb250cm9sbGVyICghUENJX0RJU1BMQVlfQ0xBU1NfVkdBKSwKLQkgKiB0aGVuIHdl
IGRvIG5vdCB0YWtlIHBhcnQgaW4gVkdBIGFyYml0cmF0aW9uIGFuZCB0aGUKLQkgKiB2Z2FfY2xp
ZW50X3JlZ2lzdGVyKCkgZmFpbHMgd2l0aCAtRU5PREVWLgotCSAqLwotCXJldCA9IHZnYV9jbGll
bnRfcmVnaXN0ZXIocGRldiwgaTkxNSwgTlVMTCwgaTkxNV92Z2Ffc2V0X2RlY29kZSk7Ci0JaWYg
KHJldCAmJiByZXQgIT0gLUVOT0RFVikKKwlyZXQgPSBpbnRlbF92Z2FfcmVnaXN0ZXIoaTkxNSk7
CisJaWYgKHJldCkKIAkJZ290byBvdXQ7CiAKIAlpbnRlbF9yZWdpc3Rlcl9kc21faGFuZGxlcigp
OwpAQCAtNDE2LDcgKzM5Niw3IEBAIHN0YXRpYyBpbnQgaTkxNV9kcml2ZXJfbW9kZXNldF9wcm9i
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAlpbnRlbF9wb3dlcl9kb21haW5zX2Ry
aXZlcl9yZW1vdmUoaTkxNSk7CiAJdmdhX3N3aXRjaGVyb29fdW5yZWdpc3Rlcl9jbGllbnQocGRl
dik7CiBjbGVhbnVwX3ZnYV9jbGllbnQ6Ci0JdmdhX2NsaWVudF9yZWdpc3RlcihwZGV2LCBOVUxM
LCBOVUxMLCBOVUxMKTsKKwlpbnRlbF92Z2FfdW5yZWdpc3RlcihpOTE1KTsKIG91dDoKIAlyZXR1
cm4gcmV0OwogfQpAQCAtNDMwLDcgKzQxMCw3IEBAIHN0YXRpYyB2b2lkIGk5MTVfZHJpdmVyX21v
ZGVzZXRfcmVtb3ZlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCWludGVsX2Jpb3Nf
ZHJpdmVyX3JlbW92ZShpOTE1KTsKIAogCXZnYV9zd2l0Y2hlcm9vX3VucmVnaXN0ZXJfY2xpZW50
KHBkZXYpOwotCXZnYV9jbGllbnRfcmVnaXN0ZXIocGRldiwgTlVMTCwgTlVMTCwgTlVMTCk7CisJ
aW50ZWxfdmdhX3VucmVnaXN0ZXIoaTkxNSk7CiAKIAlpbnRlbF9jc3JfdWNvZGVfZmluaShpOTE1
KTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNpLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BjaS5jCmluZGV4IGVhNTNkZmUyZmJhMC4uMWNiZjM5OThi
MzYxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BjaS5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNpLmMKQEAgLTIzLDcgKzIzLDYgQEAKICAqLwogCiAj
aW5jbHVkZSA8bGludXgvY29uc29sZS5oPgotI2luY2x1ZGUgPGxpbnV4L3ZnYWFyYi5oPgogI2lu
Y2x1ZGUgPGxpbnV4L3ZnYV9zd2l0Y2hlcm9vLmg+CiAKICNpbmNsdWRlIDxkcm0vZHJtX2Rydi5o
PgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zdXNwZW5kLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N1c3BlbmQuYwppbmRleCA4NTA4YTAxYWQ4YjkuLjJiMjA4
NmRlZjBmMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zdXNwZW5kLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zdXNwZW5kLmMKQEAgLTI4LDYgKzI4LDcg
QEAKIAogI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfZmJjLmgiCiAjaW5jbHVkZSAiZGlzcGxheS9p
bnRlbF9nbWJ1cy5oIgorI2luY2x1ZGUgImRpc3BsYXkvaW50ZWxfdmdhLmgiCiAKICNpbmNsdWRl
ICJpOTE1X2Rydi5oIgogI2luY2x1ZGUgImk5MTVfcmVnLmgiCkBAIC01Nyw3ICs1OCw3IEBAIHN0
YXRpYyB2b2lkIGk5MTVfcmVzdG9yZV9kaXNwbGF5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKIAlpZiAoSEFTX0ZCQyhkZXZfcHJpdikgJiYgSU5URUxfR0VOKGRldl9wcml2KSA8
PSA0ICYmICFJU19HNFgoZGV2X3ByaXYpKQogCQlJOTE1X1dSSVRFKEZCQ19DT05UUk9MLCBkZXZf
cHJpdi0+cmVnZmlsZS5zYXZlRkJDX0NPTlRST0wpOwogCi0JaTkxNV9yZWRpc2FibGVfdmdhKGRl
dl9wcml2KTsKKwlpbnRlbF92Z2FfcmVkaXNhYmxlKGRldl9wcml2KTsKIH0KIAogaW50IGk5MTVf
c2F2ZV9zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ydW50aW1lX3BtLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9ydW50aW1lX3BtLmMKaW5kZXggMmZkM2MwOTdlMWY1Li5hZDcxOWM5NjAy
YWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3J1bnRpbWVfcG0uYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ydW50aW1lX3BtLmMKQEAgLTI3LDcgKzI3
LDYgQEAKICAqLwogCiAjaW5jbHVkZSA8bGludXgvcG1fcnVudGltZS5oPgotI2luY2x1ZGUgPGxp
bnV4L3ZnYWFyYi5oPgogCiAjaW5jbHVkZSA8ZHJtL2RybV9wcmludC5oPgogCi0tIAoyLjIwLjEK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdm
eCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xp
c3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7CA0F900F2
	for <lists+intel-gfx@lfdr.de>; Fri, 16 Aug 2019 13:49:19 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 61FC96E32A;
	Fri, 16 Aug 2019 11:49:17 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 834DC6E32A
 for <intel-gfx@lists.freedesktop.org>; Fri, 16 Aug 2019 11:49:16 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by orsmga105.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 16 Aug 2019 04:49:15 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,393,1559545200"; d="scan'208";a="178741718"
Received: from gaia.fi.intel.com ([10.237.72.192])
 by fmsmga007.fm.intel.com with ESMTP; 16 Aug 2019 04:49:14 -0700
Received: by gaia.fi.intel.com (Postfix, from userid 1000)
 id A01825C1EC6; Fri, 16 Aug 2019 14:48:31 +0300 (EEST)
From: Mika Kuoppala <mika.kuoppala@linux.intel.com>
To: Chris Wilson <chris@chris-wilson.co.uk>, intel-gfx@lists.freedesktop.org
In-Reply-To: <20190816092424.31386-2-chris@chris-wilson.co.uk>
References: <20190816092424.31386-1-chris@chris-wilson.co.uk>
 <20190816092424.31386-2-chris@chris-wilson.co.uk>
Date: Fri, 16 Aug 2019 14:48:31 +0300
Message-ID: <87sgq15o1c.fsf@gaia.fi.intel.com>
MIME-Version: 1.0
Subject: Re: [Intel-gfx] [PATCH 2/3] drm/i915/gt: Mark context->active_count
 as protected by timeline->mutex
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+IHdyaXRlczoKCj4gV2UgdXNl
IHRpbWVsaW5lLT5tdXRleCB0byBwcm90ZWN0IG1vZGlmaWNhdGlvbnMgdG8KPiBjb250ZXh0LT5h
Y3RpdmVfY291bnQsIGFuZCB0aGUgYXNzb2NpYXRlZCBlbmFibGUvZGlzYWJsZSBjYWxsYmFja3Mu
Cj4gRHVlIHRvIGNvbXBsaWNhdGlvbnMgd2l0aCBlbmdpbmUtcG0gYmFycmllciB0aGVyZSBpcyBh
IHBhdGggd2hlcmUgd2UgdXNlZAo+IGEgInN1cGVybG9jayIgdG8gcHJvdmlkZSBzZXJpYWxpc2Vk
IHByb3RlY3QgYW5kIHNvIGNvdWxkIG5vdAo+IHVuY29uZGl0aW9uYWxseSBhc3NlcnQgd2l0aCBs
b2NrZGVwIHRoYXQgaXQgd2FzIGFsd2F5cyBoZWxkLiBIb3dldmVyLAo+IHdlIGNhbiBtYXJrIHRo
ZSBtdXRleCBhcyB0YWtlbiAobm90aW5nIHRoYXQgd2UgbWF5IGJlIG5lc3RlZCB1bmRlcm5lYXRo
Cj4gb3Vyc2VsdmVzKSB3aGljaCBtZWFucyB3ZSBjYW4gYmUgcmVhc3N1cmVkIHRoZSByaWdodCB0
aW1lbGluZS0+bXV0ZXggaXMKPiBhbHdheXMgdHJlYXRlZCBhcyBoZWxkIGFuZCBsZXQgbG9ja2Rl
cCByb2FtIGZyZWUuCj4KPiBTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlz
LXdpbHNvbi5jby51az4KPiBDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVs
LmNvbT4KClJldmlld2VkLWJ5OiBNaWthIEt1b3BwYWxhIDxtaWthLmt1b3BwYWxhQGxpbnV4Lmlu
dGVsLmNvbT4KCj4gLS0tCj4gIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQu
aCAgICAgICB8ICAzICsrKwo+ICBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0
X3R5cGVzLmggfCAgMiArLQo+ICBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVf
cG0uYyAgICAgfCAxNCArKysrKysrKysrKysrKwo+ICBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF90aW1lbGluZS5jICAgICAgfCAgNCArKysrCj4gIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfcmVxdWVzdC5jICAgICAgICAgICB8ICAzICsrLQo+ICA1IGZpbGVzIGNoYW5nZWQsIDI0IGlu
c2VydGlvbnMoKyksIDIgZGVsZXRpb25zKC0pCj4KPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfY29udGV4dC5oCj4gaW5kZXggMDUzYTEzMDdlY2I0Li5kZDc0MmFjMmZiZGIgMTAwNjQ0Cj4g
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5oCj4gKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5oCj4gQEAgLTg5LDE3ICs4OSwyMCBA
QCB2b2lkIGludGVsX2NvbnRleHRfZXhpdF9lbmdpbmUoc3RydWN0IGludGVsX2NvbnRleHQgKmNl
KTsKPiAgCj4gIHN0YXRpYyBpbmxpbmUgdm9pZCBpbnRlbF9jb250ZXh0X2VudGVyKHN0cnVjdCBp
bnRlbF9jb250ZXh0ICpjZSkKPiAgewo+ICsJbG9ja2RlcF9hc3NlcnRfaGVsZCgmY2UtPnRpbWVs
aW5lLT5tdXRleCk7Cj4gIAlpZiAoIWNlLT5hY3RpdmVfY291bnQrKykKPiAgCQljZS0+b3BzLT5l
bnRlcihjZSk7Cj4gIH0KPiAgCj4gIHN0YXRpYyBpbmxpbmUgdm9pZCBpbnRlbF9jb250ZXh0X21h
cmtfYWN0aXZlKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKPiAgewo+ICsJbG9ja2RlcF9hc3Nl
cnRfaGVsZCgmY2UtPnRpbWVsaW5lLT5tdXRleCk7Cj4gIAkrK2NlLT5hY3RpdmVfY291bnQ7Cj4g
IH0KPiAgCj4gIHN0YXRpYyBpbmxpbmUgdm9pZCBpbnRlbF9jb250ZXh0X2V4aXQoc3RydWN0IGlu
dGVsX2NvbnRleHQgKmNlKQo+ICB7Cj4gKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZjZS0+dGltZWxp
bmUtPm11dGV4KTsKPiAgCUdFTV9CVUdfT04oIWNlLT5hY3RpdmVfY291bnQpOwo+ICAJaWYgKCEt
LWNlLT5hY3RpdmVfY291bnQpCj4gIAkJY2UtPm9wcy0+ZXhpdChjZSk7Cj4gZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHRfdHlwZXMuaCBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHRfdHlwZXMuaAo+IGluZGV4IGQ4Y2UyNjZjMDQ5
Zi4uYmY5Y2VkZmNjYmYwIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2NvbnRleHRfdHlwZXMuaAo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2NvbnRleHRfdHlwZXMuaAo+IEBAIC01OSw3ICs1OSw3IEBAIHN0cnVjdCBpbnRlbF9jb250ZXh0
IHsKPiAgCXUzMiAqbHJjX3JlZ19zdGF0ZTsKPiAgCXU2NCBscmNfZGVzYzsKPiAgCj4gLQl1bnNp
Z25lZCBpbnQgYWN0aXZlX2NvdW50OyAvKiBub3Rpb25hbGx5IHByb3RlY3RlZCBieSB0aW1lbGlu
ZS0+bXV0ZXggKi8KPiArCXVuc2lnbmVkIGludCBhY3RpdmVfY291bnQ7IC8qIHByb3RlY3RlZCBi
eSB0aW1lbGluZS0+bXV0ZXggKi8KPiAgCj4gIAlhdG9taWNfdCBwaW5fY291bnQ7Cj4gIAlzdHJ1
Y3QgbXV0ZXggcGluX211dGV4OyAvKiBndWFyZHMgcGlubmluZyBhbmQgYXNzb2NpYXRlZCBvbi1n
cHVpbmcgKi8KPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5n
aW5lX3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYwo+IGlu
ZGV4IGYzZjAxMDlmOWUyMi4uNWYwM2Y3ZGNhZDcyIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMKPiBAQCAtMzcsNiArMzcsMTYgQEAgc3RhdGljIGludCBf
X2VuZ2luZV91bnBhcmsoc3RydWN0IGludGVsX3dha2VyZWYgKndmKQo+ICAJcmV0dXJuIDA7Cj4g
IH0KPiAgCj4gK3N0YXRpYyBpbmxpbmUgdm9pZCBfX3RpbWVsaW5lX21hcmtfbG9jayhzdHJ1Y3Qg
aW50ZWxfY29udGV4dCAqY2UpCj4gK3sKPiArCW11dGV4X2FjcXVpcmUoJmNlLT50aW1lbGluZS0+
bXV0ZXguZGVwX21hcCwgMiwgMCwgX1RISVNfSVBfKTsKPiArfQo+ICsKPiArc3RhdGljIGlubGlu
ZSB2b2lkIF9fdGltZWxpbmVfbWFya191bmxvY2soc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQo+
ICt7Cj4gKwltdXRleF9yZWxlYXNlKCZjZS0+dGltZWxpbmUtPm11dGV4LmRlcF9tYXAsIDAsIF9U
SElTX0lQXyk7Cj4gK30KPiArCj4gIHN0YXRpYyBib29sIHN3aXRjaF90b19rZXJuZWxfY29udGV4
dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCj4gIHsKPiAgCXN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJxOwo+IEBAIC02MSw2ICs3MSw4IEBAIHN0YXRpYyBib29sIHN3aXRjaF90b19rZXJu
ZWxfY29udGV4dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCj4gIAkgKiByZXRpcmlu
ZyB0aGUgbGFzdCByZXF1ZXN0LCB0aHVzIGFsbCByaW5ncyBzaG91bGQgYmUgZW1wdHkgYW5kCj4g
IAkgKiBhbGwgdGltZWxpbmVzIGlkbGUuCj4gIAkgKi8KPiArCV9fdGltZWxpbmVfbWFya19sb2Nr
KGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOwo+ICsKPiAgCXJxID0gX19pOTE1X3JlcXVlc3RfY3Jl
YXRlKGVuZ2luZS0+a2VybmVsX2NvbnRleHQsIEdGUF9OT1dBSVQpOwo+ICAJaWYgKElTX0VSUihy
cSkpCj4gIAkJLyogQ29udGV4dCBzd2l0Y2ggZmFpbGVkLCBob3BlIGZvciB0aGUgYmVzdCEgTWF5
YmUgcmVzZXQ/ICovCj4gQEAgLTgwLDYgKzkyLDggQEAgc3RhdGljIGJvb2wgc3dpdGNoX3RvX2tl
cm5lbF9jb250ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKPiAgCV9faW50ZWxf
d2FrZXJlZl9kZWZlcl9wYXJrKCZlbmdpbmUtPndha2VyZWYpOwo+ICAJX19pOTE1X3JlcXVlc3Rf
cXVldWUocnEsIE5VTEwpOwo+ICAKPiArCV9fdGltZWxpbmVfbWFya191bmxvY2soZW5naW5lLT5r
ZXJuZWxfY29udGV4dCk7Cj4gKwo+ICAJcmV0dXJuIGZhbHNlOwo+ICB9Cj4gIAo+IGRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF90aW1lbGluZS5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmUuYwo+IGluZGV4IDdiNDc2Y2Q1NWRhYy4uZWFm
ZDk0ZDVlMjExIDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Rp
bWVsaW5lLmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF90aW1lbGluZS5j
Cj4gQEAgLTMzOCw2ICszMzgsOCBAQCB2b2lkIGludGVsX3RpbWVsaW5lX2VudGVyKHN0cnVjdCBp
bnRlbF90aW1lbGluZSAqdGwpCj4gIHsKPiAgCXN0cnVjdCBpbnRlbF9ndF90aW1lbGluZXMgKnRp
bWVsaW5lcyA9ICZ0bC0+Z3QtPnRpbWVsaW5lczsKPiAgCj4gKwlsb2NrZGVwX2Fzc2VydF9oZWxk
KCZ0bC0+bXV0ZXgpOwo+ICsKPiAgCUdFTV9CVUdfT04oIWF0b21pY19yZWFkKCZ0bC0+cGluX2Nv
dW50KSk7Cj4gIAlpZiAodGwtPmFjdGl2ZV9jb3VudCsrKQo+ICAJCXJldHVybjsKPiBAQCAtMzUy
LDYgKzM1NCw4IEBAIHZvaWQgaW50ZWxfdGltZWxpbmVfZXhpdChzdHJ1Y3QgaW50ZWxfdGltZWxp
bmUgKnRsKQo+ICB7Cj4gIAlzdHJ1Y3QgaW50ZWxfZ3RfdGltZWxpbmVzICp0aW1lbGluZXMgPSAm
dGwtPmd0LT50aW1lbGluZXM7Cj4gIAo+ICsJbG9ja2RlcF9hc3NlcnRfaGVsZCgmdGwtPm11dGV4
KTsKPiArCj4gIAlHRU1fQlVHX09OKCF0bC0+YWN0aXZlX2NvdW50KTsKPiAgCWlmICgtLXRsLT5h
Y3RpdmVfY291bnQpCj4gIAkJcmV0dXJuOwo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3JlcXVlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5j
Cj4gaW5kZXggMTc0YzdmZGQwMmZmLi43ZWRjZDBmZWY1YzYgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3JlcXVlc3QuYwo+IEBAIC0xMDg3LDcgKzEwODcsOCBAQCBfX2k5MTVfcmVxdWVzdF9h
ZGRfdG9fdGltZWxpbmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCj4gIAkgKiBwcmVjbHVkZXMg
b3B0aW1pc2luZyB0byB1c2Ugc2VtYXBob3JlcyBzZXJpYWxpc2F0aW9uIG9mIGEgc2luZ2xlCj4g
IAkgKiB0aW1lbGluZSBhY3Jvc3MgZW5naW5lcy4KPiAgCSAqLwo+IC0JcHJldiA9IHJjdV9kZXJl
ZmVyZW5jZV9wcm90ZWN0ZWQodGltZWxpbmUtPmxhc3RfcmVxdWVzdC5yZXF1ZXN0LCAxKTsKPiAr
CXByZXYgPSByY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKHRpbWVsaW5lLT5sYXN0X3JlcXVlc3Qu
cmVxdWVzdCwKPiArCQkJCQkgbG9ja2RlcF9pc19oZWxkKCZ0aW1lbGluZS0+bXV0ZXgpKTsKPiAg
CWlmIChwcmV2ICYmICFpOTE1X3JlcXVlc3RfY29tcGxldGVkKHByZXYpKSB7Cj4gIAkJaWYgKGlz
X3Bvd2VyX29mXzIocHJldi0+ZW5naW5lLT5tYXNrIHwgcnEtPmVuZ2luZS0+bWFzaykpCj4gIAkJ
CWk5MTVfc3dfZmVuY2VfYXdhaXRfc3dfZmVuY2UoJnJxLT5zdWJtaXQsCj4gLS0gCj4gMi4yMy4w
LnJjMQpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRl
bC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6
Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

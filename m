Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4A752CBC63
	for <lists+intel-gfx@lfdr.de>; Fri,  4 Oct 2019 15:58:21 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 329BF6EB9E;
	Fri,  4 Oct 2019 13:58:17 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 062F06EB9B
 for <intel-gfx@lists.freedesktop.org>; Fri,  4 Oct 2019 13:58:14 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18723955-1500050 
 for multiple; Fri, 04 Oct 2019 14:40:18 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  4 Oct 2019 14:40:00 +0100
Message-Id: <20191004134015.13204-6-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191004134015.13204-1-chris@chris-wilson.co.uk>
References: <20191004134015.13204-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 05/20] drm/i915: Coordinate i915_active with its
 own mutex
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Rm9yZ28gdGhlIHN0cnVjdF9tdXRleCBzZXJpYWxpc2F0aW9uIGZvciBpOTE1X2FjdGl2ZSwgYW5k
IGludGVycG9zZSBpdHMKb3duIG11dGV4IGhhbmRsaW5nIGZvciBhY3RpdmUvcmV0aXJlLgoKVGhp
cyBpcyBhIG11bHRpLWxheWVyZWQgc2xlaWdodC1vZi1oYW5kLiBGaXJzdCwgd2UgaGFkIHRvIGVu
c3VyZSB0aGF0IG5vCmFjdGl2ZS9yZXRpcmUgY2FsbGJhY2tzIGFjY2lkZW50YWxseSBpbnZlcnRl
ZCB0aGUgbXV0ZXggb3JkZXJpbmcgcnVsZXMsCm5vciBhc3N1bWVkIHRoYXQgdGhleSB3ZXJlIHRo
ZW1zZWx2ZXMgc2VyaWFsaXNlZCBieSBzdHJ1Y3RfbXV0ZXguIE1vcmUKY2hhbGxlbmdpbmcgdGhv
dWdoLCBpcyB0aGUgcnVsZSBvdmVyIHVwZGF0aW5nIGVsZW1lbnRzIG9mIHRoZSBhY3RpdmUKcmJ0
cmVlLiBJbnN0ZWFkIG9mIHRoZSB3aG9sZSBpOTE1X2FjdGl2ZSBub3cgYmVpbmcgc2VyaWFsaXNl
ZCBieQpzdHJ1Y3RfbXV0ZXgsIGFsbG9jYXRpb25zL3JvdGF0aW9ucyBvZiB0aGUgdHJlZSBhcmUg
c2VyaWFsaXNlZCBieSB0aGUKaTkxNV9hY3RpdmUubXV0ZXggYW5kIGluZGl2aWR1YWwgbm9kZXMg
YXJlIHNlcmlhbGlzZWQgYnkgdGhlIGNhbGxlcgp1c2luZyB0aGUgaTkxNV90aW1lbGluZS5tdXRl
eCAod2UgbmVlZCB0byB1c2UgbmVzdGVkIHNwaW5sb2NrcyB0bwppbnRlcmFjdCB3aXRoIHRoZSBk
bWFfZmVuY2UgY2FsbGJhY2sgbGlzdHMpLgoKVGhlIHBhaW4gcG9pbnQgaGVyZSBpcyB0aGF0IGlu
c3RlYWQgb2YgYSBzaW5nbGUgbXV0ZXggYXJvdW5kIGV4ZWNidWYsIHdlCm5vdyBoYXZlIHRvIHRh
a2UgYSBtdXRleCBmb3IgYWN0aXZlIHRyYWNrZXIgKG9uZSBmb3IgZWFjaCB2bWEsIGNvbnRleHQs
CmV0YykgYW5kIGEgY291cGxlIG9mIHNwaW5sb2NrcyBmb3IgZWFjaCBmZW5jZSB1cGRhdGUuIFRo
ZSBpbXByb3ZlbWVudCBpbgpmaW5lIGdyYWluZWQgbG9ja2luZyBhbGxvd2luZyBmb3IgbXVsdGlw
bGUgY29uY3VycmVudCBjbGllbnRzCihldmVudHVhbGx5ISkgc2hvdWxkIGJlIHdvcnRoIGl0IGlu
IHR5cGljYWwgbG9hZHMuCgp2MjogQWRkIHNvbWUgY29tbWVudHMgdGhhdCBiYXJlbHkgZWx1Y2lk
YXRlIGFueXRoaW5nIDooCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlz
LXdpbHNvbi5jby51az4KUmV2aWV3ZWQtYnk6IFR2cnRrbyBVcnN1bGluIDx0dnJ0a28udXJzdWxp
bkBpbnRlbC5jb20+Ci0tLQogLi4uL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Zyb250YnVm
ZmVyLmMgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJs
YXkuYyAgfCAgIDMgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0
LmMgICB8ICAgNCArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVz
LmggIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jICAgICAg
ICB8ICAgOSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jICAgICAg
IHwgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG9vbC5jICAg
fCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMgICAgICAgICB8
ICAxMCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmUuYyAgICAgIHwg
ICA3ICstCiAuLi4vZ3B1L2RybS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lX3R5cGVzLmggICAgfCAg
IDkgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYyAgICB8ICAx
NiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgICAgICAgIHwgIDEw
ICstCiAuLi4vZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0cy9tb2NrX3RpbWVsaW5lLmMgfCAgIDIg
Ky0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYyAgICAgICAgICB8ICAgMyAt
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jICAgICAgICAgICAgfCAzMjIgKysr
KysrKysrLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5oICAgICAg
ICAgICAgfCAzMTkgKysrKy0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
YWN0aXZlX3R5cGVzLmggICAgICB8ICAyMyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
ZW0uYyAgICAgICAgICAgICAgIHwgIDQyICsrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
ZW1fZ3R0LmMgICAgICAgICAgIHwgICAzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dw
dV9lcnJvci5jICAgICAgICAgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVx
dWVzdC5jICAgICAgICAgICB8ICAzOCArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVx
dWVzdC5oICAgICAgICAgICB8ICAgMSAtCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5j
ICAgICAgICAgICAgICAgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
OTE1X2FjdGl2ZS5jICB8ICAzMiArLQogMjQgZmlsZXMgY2hhbmdlZCwgMjk4IGluc2VydGlvbnMo
KyksIDU3MiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Zyb250YnVmZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Zyb250YnVmZmVyLmMKaW5kZXggNjQyOGI4ZGQ3MGQzLi44NGIxNjRmMzE4OTUgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZnJvbnRidWZmZXIu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Zyb250YnVmZmVyLmMK
QEAgLTI1Nyw3ICsyNTcsNyBAQCBpbnRlbF9mcm9udGJ1ZmZlcl9nZXQoc3RydWN0IGRybV9pOTE1
X2dlbV9vYmplY3QgKm9iaikKIAlmcm9udC0+b2JqID0gb2JqOwogCWtyZWZfaW5pdCgmZnJvbnQt
PnJlZik7CiAJYXRvbWljX3NldCgmZnJvbnQtPmJpdHMsIDApOwotCWk5MTVfYWN0aXZlX2luaXQo
aTkxNSwgJmZyb250LT53cml0ZSwKKwlpOTE1X2FjdGl2ZV9pbml0KCZmcm9udC0+d3JpdGUsCiAJ
CQkgZnJvbnRidWZmZXJfYWN0aXZlLAogCQkJIGk5MTVfYWN0aXZlX21heV9zbGVlcChmcm9udGJ1
ZmZlcl9yZXRpcmUpKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9vdmVybGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292
ZXJsYXkuYwppbmRleCAzZjRhYzFlZTc2NjguLmUxMmUxYTc1M2FmMCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMKQEAgLTEzNjAsOCArMTM2MCw3IEBA
IHZvaWQgaW50ZWxfb3ZlcmxheV9zZXR1cChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCiAJb3ZlcmxheS0+Y29udHJhc3QgPSA3NTsKIAlvdmVybGF5LT5zYXR1cmF0aW9uID0gMTQ2
OwogCi0JaTkxNV9hY3RpdmVfaW5pdChkZXZfcHJpdiwKLQkJCSAmb3ZlcmxheS0+bGFzdF9mbGlw
LAorCWk5MTVfYWN0aXZlX2luaXQoJm92ZXJsYXktPmxhc3RfZmxpcCwKIAkJCSBOVUxMLCBpbnRl
bF9vdmVybGF5X2xhc3RfZmxpcF9yZXRpcmUpOwogCiAJcmV0ID0gZ2V0X3JlZ2lzdGVycyhvdmVy
bGF5LCBPVkVSTEFZX05FRURTX1BIWVNJQ0FMKGRldl9wcml2KSk7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwppbmRleCA0Y2Q3ZDJlY2YxZDUuLjlkODVhYWI2
OGQzNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRl
eHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCkBA
IC04NjgsMjAgKzg2OCwxOCBAQCBzdGF0aWMgaW50IGNvbnRleHRfYmFycmllcl90YXNrKHN0cnVj
dCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCQkJdm9pZCAoKnRhc2spKHZvaWQgKmRhdGEpLAog
CQkJCXZvaWQgKmRhdGEpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBjdHgt
Pmk5MTU7CiAJc3RydWN0IGNvbnRleHRfYmFycmllcl90YXNrICpjYjsKIAlzdHJ1Y3QgaTkxNV9n
ZW1fZW5naW5lc19pdGVyIGl0OwogCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAlpbnQgZXJy
ID0gMDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
CUdFTV9CVUdfT04oIXRhc2spOwogCiAJY2IgPSBrbWFsbG9jKHNpemVvZigqY2IpLCBHRlBfS0VS
TkVMKTsKIAlpZiAoIWNiKQogCQlyZXR1cm4gLUVOT01FTTsKIAotCWk5MTVfYWN0aXZlX2luaXQo
aTkxNSwgJmNiLT5iYXNlLCBOVUxMLCBjYl9yZXRpcmUpOworCWk5MTVfYWN0aXZlX2luaXQoJmNi
LT5iYXNlLCBOVUxMLCBjYl9yZXRpcmUpOwogCWVyciA9IGk5MTVfYWN0aXZlX2FjcXVpcmUoJmNi
LT5iYXNlKTsKIAlpZiAoZXJyKSB7CiAJCWtmcmVlKGNiKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaAppbmRleCBlMWFhYjJmZDFjZDkuLmMw
MGI0ZjA3N2Y5ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X29iamVjdF90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9v
YmplY3RfdHlwZXMuaApAQCAtOCw2ICs4LDcgQEAKICNkZWZpbmUgX19JOTE1X0dFTV9PQkpFQ1Rf
VFlQRVNfSF9fCiAKICNpbmNsdWRlIDxkcm0vZHJtX2dlbS5oPgorI2luY2x1ZGUgPHVhcGkvZHJt
L2k5MTVfZHJtLmg+CiAKICNpbmNsdWRlICJpOTE1X2FjdGl2ZS5oIgogI2luY2x1ZGUgImk5MTVf
c2VsZnRlc3QuaCIKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKaW5kZXggY2Nh
MTkyZWNmZjhiLi4wYTQxMTVjNmMyNzUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9wbS5jCkBAIC0xNiwxNCArMTYsMTEgQEAgc3RhdGljIHZvaWQgY2FsbF9pZGxlX2JhcnJpZXJz
KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAlzdHJ1Y3QgbGxpc3Rfbm9kZSAqbm9k
ZSwgKm5leHQ7CiAKIAlsbGlzdF9mb3JfZWFjaF9zYWZlKG5vZGUsIG5leHQsIGxsaXN0X2RlbF9h
bGwoJmVuZ2luZS0+YmFycmllcl90YXNrcykpIHsKLQkJc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVl
c3QgKmFjdGl2ZSA9CisJCXN0cnVjdCBkbWFfZmVuY2VfY2IgKmNiID0KIAkJCWNvbnRhaW5lcl9v
Zigoc3RydWN0IGxpc3RfaGVhZCAqKW5vZGUsCi0JCQkJICAgICB0eXBlb2YoKmFjdGl2ZSksIGxp
bmspOworCQkJCSAgICAgdHlwZW9mKCpjYiksIG5vZGUpOwogCi0JCUlOSVRfTElTVF9IRUFEKCZh
Y3RpdmUtPmxpbmspOwotCQlSQ1VfSU5JVF9QT0lOVEVSKGFjdGl2ZS0+cmVxdWVzdCwgTlVMTCk7
Ci0KLQkJYWN0aXZlLT5yZXRpcmUoYWN0aXZlLCBOVUxMKTsKKwkJY2ItPmZ1bmMoTlVMTCwgY2Ip
OwogCX0KIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29u
dGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCmluZGV4IDA2
ZmFiZGYyMDVjZi4uMzVhNDBjMjgyMGEyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
Y29udGV4dC5jCkBAIC0yNDAsNyArMjQwLDcgQEAgaW50ZWxfY29udGV4dF9pbml0KHN0cnVjdCBp
bnRlbF9jb250ZXh0ICpjZSwKIAogCW11dGV4X2luaXQoJmNlLT5waW5fbXV0ZXgpOwogCi0JaTkx
NV9hY3RpdmVfaW5pdChjdHgtPmk5MTUsICZjZS0+YWN0aXZlLAorCWk5MTVfYWN0aXZlX2luaXQo
JmNlLT5hY3RpdmUsCiAJCQkgX19pbnRlbF9jb250ZXh0X2FjdGl2ZSwgX19pbnRlbF9jb250ZXh0
X3JldGlyZSk7CiB9CiAKQEAgLTMwNyw3ICszMDcsNyBAQCBpbnQgaW50ZWxfY29udGV4dF9wcmVw
YXJlX3JlbW90ZV9yZXF1ZXN0KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKIAkJCXJldHVybiBl
cnI7CiAKIAkJLyogUXVldWUgdGhpcyBzd2l0Y2ggYWZ0ZXIgY3VycmVudCBhY3Rpdml0eSBieSB0
aGlzIGNvbnRleHQuICovCi0JCWVyciA9IGk5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KCZ0bC0+bGFz
dF9yZXF1ZXN0LCBycSk7CisJCWVyciA9IGk5MTVfYWN0aXZlX2ZlbmNlX3NldCgmdGwtPmxhc3Rf
cmVxdWVzdCwgcnEpOwogCQltdXRleF91bmxvY2soJnRsLT5tdXRleCk7CiAJCWlmIChlcnIpCiAJ
CQlyZXR1cm4gZXJyOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
ZW5naW5lX3Bvb2wuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29s
LmMKaW5kZXggODFmYWIxMDFmZGI0Li4zY2RiZDVmOGI1YmUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfZW5naW5lX3Bvb2wuYwpAQCAtOTUsNyArOTUsNyBAQCBub2RlX2NyZWF0
ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX3Bvb2wgKnBvb2wsIHNpemVfdCBzeikKIAkJcmV0dXJuIEVS
Ul9QVFIoLUVOT01FTSk7CiAKIAlub2RlLT5wb29sID0gcG9vbDsKLQlpOTE1X2FjdGl2ZV9pbml0
KGVuZ2luZS0+aTkxNSwgJm5vZGUtPmFjdGl2ZSwgcG9vbF9hY3RpdmUsIHBvb2xfcmV0aXJlKTsK
KwlpOTE1X2FjdGl2ZV9pbml0KCZub2RlLT5hY3RpdmUsIHBvb2xfYWN0aXZlLCBwb29sX3JldGly
ZSk7CiAKIAlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGVuZ2luZS0+aTkx
NSwgc3opOwogCWlmIChJU19FUlIob2JqKSkgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfcmVzZXQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jl
c2V0LmMKaW5kZXggZTE4OTg5N2U4Nzk3Li4wNTU0OTZmMDgyNWYgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfcmVzZXQuYwpAQCAtODQ0LDEwICs4NDQsMTAgQEAgc3RhdGljIGJvb2wgX19p
bnRlbF9ndF91bnNldF93ZWRnZWQoc3RydWN0IGludGVsX2d0ICpndCkKIAkgKi8KIAlzcGluX2xv
Y2tfaXJxc2F2ZSgmdGltZWxpbmVzLT5sb2NrLCBmbGFncyk7CiAJbGlzdF9mb3JfZWFjaF9lbnRy
eSh0bCwgJnRpbWVsaW5lcy0+YWN0aXZlX2xpc3QsIGxpbmspIHsKLQkJc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnE7CisJCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlOwogCi0JCXJxID0gaTkxNV9hY3Rp
dmVfcmVxdWVzdF9nZXRfdW5sb2NrZWQoJnRsLT5sYXN0X3JlcXVlc3QpOwotCQlpZiAoIXJxKQor
CQlmZW5jZSA9IGk5MTVfYWN0aXZlX2ZlbmNlX2dldCgmdGwtPmxhc3RfcmVxdWVzdCk7CisJCWlm
ICghZmVuY2UpCiAJCQljb250aW51ZTsKIAogCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZ0aW1l
bGluZXMtPmxvY2ssIGZsYWdzKTsKQEAgLTg1OSw4ICs4NTksOCBAQCBzdGF0aWMgYm9vbCBfX2lu
dGVsX2d0X3Vuc2V0X3dlZGdlZChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogCQkgKiAoSTkxNV9GRU5D
RV9USU1FT1VUKSBzbyB0aGlzIHdhaXQgc2hvdWxkIG5vdCBiZSB1bmJvdW5kZWQKIAkJICogaW4g
dGhlIHdvcnN0IGNhc2UuCiAJCSAqLwotCQlkbWFfZmVuY2VfZGVmYXVsdF93YWl0KCZycS0+ZmVu
Y2UsIGZhbHNlLCBNQVhfU0NIRURVTEVfVElNRU9VVCk7Ci0JCWk5MTVfcmVxdWVzdF9wdXQocnEp
OworCQlkbWFfZmVuY2VfZGVmYXVsdF93YWl0KGZlbmNlLCBmYWxzZSwgTUFYX1NDSEVEVUxFX1RJ
TUVPVVQpOworCQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKIAogCQkvKiBSZXN0YXJ0IGl0ZXJhdGlv
biBhZnRlciBkcm9waW5nIGxvY2sgKi8KIAkJc3Bpbl9sb2NrX2lycXNhdmUoJnRpbWVsaW5lcy0+
bG9jaywgZmxhZ3MpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
dGltZWxpbmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lLmMKaW5k
ZXggNjUzZjYwZTc4MzkyLi4wZjk1OTY5NDMwM2MgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfdGltZWxpbmUuYwpAQCAtMTc4LDggKzE3OCw3IEBAIGNhY2hlbGluZV9hbGxvYyhzdHJ1
Y3QgaW50ZWxfdGltZWxpbmVfaHdzcCAqaHdzcCwgdW5zaWduZWQgaW50IGNhY2hlbGluZSkKIAlj
bC0+aHdzcCA9IGh3c3A7CiAJY2wtPnZhZGRyID0gcGFnZV9wYWNrX2JpdHModmFkZHIsIGNhY2hl
bGluZSk7CiAKLQlpOTE1X2FjdGl2ZV9pbml0KGh3c3AtPmd0LT5pOTE1LCAmY2wtPmFjdGl2ZSwK
LQkJCSBfX2NhY2hlbGluZV9hY3RpdmUsIF9fY2FjaGVsaW5lX3JldGlyZSk7CisJaTkxNV9hY3Rp
dmVfaW5pdCgmY2wtPmFjdGl2ZSwgX19jYWNoZWxpbmVfYWN0aXZlLCBfX2NhY2hlbGluZV9yZXRp
cmUpOwogCiAJcmV0dXJuIGNsOwogfQpAQCAtMjU1LDcgKzI1NCw3IEBAIGludCBpbnRlbF90aW1l
bGluZV9pbml0KHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGltZWxpbmUsCiAKIAltdXRleF9pbml0
KCZ0aW1lbGluZS0+bXV0ZXgpOwogCi0JSU5JVF9BQ1RJVkVfUkVRVUVTVCgmdGltZWxpbmUtPmxh
c3RfcmVxdWVzdCwgJnRpbWVsaW5lLT5tdXRleCk7CisJSU5JVF9BQ1RJVkVfRkVOQ0UoJnRpbWVs
aW5lLT5sYXN0X3JlcXVlc3QsICZ0aW1lbGluZS0+bXV0ZXgpOwogCUlOSVRfTElTVF9IRUFEKCZ0
aW1lbGluZS0+cmVxdWVzdHMpOwogCiAJaTkxNV9zeW5jbWFwX2luaXQoJnRpbWVsaW5lLT5zeW5j
KTsKQEAgLTQ0Myw3ICs0NDIsNyBAQCBfX2ludGVsX3RpbWVsaW5lX2dldF9zZXFubyhzdHJ1Y3Qg
aW50ZWxfdGltZWxpbmUgKnRsLAogCSAqIGZyZWUgaXQgYWZ0ZXIgdGhlIGN1cnJlbnQgcmVxdWVz
dCBpcyByZXRpcmVkLCB3aGljaCBlbnN1cmVzIHRoYXQKIAkgKiBhbGwgd3JpdGVzIGludG8gdGhl
IGNhY2hlbGluZSBmcm9tIHByZXZpb3VzIHJlcXVlc3RzIGFyZSBjb21wbGV0ZS4KIAkgKi8KLQll
cnIgPSBpOTE1X2FjdGl2ZV9yZWYoJnRsLT5od3NwX2NhY2hlbGluZS0+YWN0aXZlLCB0bCwgcnEp
OworCWVyciA9IGk5MTVfYWN0aXZlX3JlZigmdGwtPmh3c3BfY2FjaGVsaW5lLT5hY3RpdmUsIHRs
LCAmcnEtPmZlbmNlKTsKIAlpZiAoZXJyKQogCQlnb3RvIGVycl9jYWNoZWxpbmU7CiAKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lX3R5cGVzLmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF90aW1lbGluZV90eXBlcy5oCmluZGV4IGM2Njhj
NGM1MGU3NS4uOThkOWVlMTY2Mzc5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF90aW1lbGluZV90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX3RpbWVsaW5lX3R5cGVzLmgKQEAgLTU4LDEyICs1OCwxMyBAQCBzdHJ1Y3QgaW50ZWxfdGlt
ZWxpbmUgewogCSAqLwogCXN0cnVjdCBsaXN0X2hlYWQgcmVxdWVzdHM7CiAKLQkvKiBDb250YWlu
cyBhbiBSQ1UgZ3VhcmRlZCBwb2ludGVyIHRvIHRoZSBsYXN0IHJlcXVlc3QuIE5vIHJlZmVyZW5j
ZSBpcworCS8qCisJICogQ29udGFpbnMgYW4gUkNVIGd1YXJkZWQgcG9pbnRlciB0byB0aGUgbGFz
dCByZXF1ZXN0LiBObyByZWZlcmVuY2UgaXMKIAkgKiBoZWxkIHRvIHRoZSByZXF1ZXN0LCB1c2Vy
cyBtdXN0IGNhcmVmdWxseSBhY3F1aXJlIGEgcmVmZXJlbmNlIHRvCi0JICogdGhlIHJlcXVlc3Qg
dXNpbmcgaTkxNV9hY3RpdmVfcmVxdWVzdF9nZXRfcmVxdWVzdF9yY3UoKSwgb3IgaG9sZCB0aGUK
LQkgKiBzdHJ1Y3RfbXV0ZXguCisJICogdGhlIHJlcXVlc3QgdXNpbmcgaTkxNV9hY3RpdmVfZmVu
Y2VfZ2V0KCksIG9yIG1hbmFnZSB0aGUgUkNVCisJICogcHJvdGVjdGlvbiB0aGVtc2VsdmVzIChj
ZiB0aGUgaTkxNV9hY3RpdmVfZmVuY2UgQVBJKS4KIAkgKi8KLQlzdHJ1Y3QgaTkxNV9hY3RpdmVf
cmVxdWVzdCBsYXN0X3JlcXVlc3Q7CisJc3RydWN0IGk5MTVfYWN0aXZlX2ZlbmNlIGxhc3RfcmVx
dWVzdDsKIAogCS8qKgogCSAqIFdlIHRyYWNrIHRoZSBtb3N0IHJlY2VudCBzZXFubyB0aGF0IHdl
IHdhaXQgb24gaW4gZXZlcnkgY29udGV4dCBzbwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfY29udGV4dC5jCmluZGV4IDRjZTFlMjU0MzNkMi4uZTZiY2JlN2FiNWUxIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jCkBAIC00NywyNCArNDcsMjAg
QEAgc3RhdGljIGludCBjb250ZXh0X3N5bmMoc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogCiAJ
bXV0ZXhfbG9jaygmdGwtPm11dGV4KTsKIAlkbyB7Ci0JCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
OworCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKIAkJbG9uZyB0aW1lb3V0OwogCi0JCXJjdV9y
ZWFkX2xvY2soKTsKLQkJcnEgPSByY3VfZGVyZWZlcmVuY2UodGwtPmxhc3RfcmVxdWVzdC5yZXF1
ZXN0KTsKLQkJaWYgKHJxKQotCQkJcnEgPSBpOTE1X3JlcXVlc3RfZ2V0X3JjdShycSk7Ci0JCXJj
dV9yZWFkX3VubG9jaygpOwotCQlpZiAoIXJxKQorCQlmZW5jZSA9IGk5MTVfYWN0aXZlX2ZlbmNl
X2dldCgmdGwtPmxhc3RfcmVxdWVzdCk7CisJCWlmICghZmVuY2UpCiAJCQlicmVhazsKIAotCQl0
aW1lb3V0ID0gaTkxNV9yZXF1ZXN0X3dhaXQocnEsIDAsIEhaIC8gMTApOworCQl0aW1lb3V0ID0g
ZG1hX2ZlbmNlX3dhaXRfdGltZW91dChmZW5jZSwgZmFsc2UsIEhaIC8gMTApOwogCQlpZiAodGlt
ZW91dCA8IDApCiAJCQllcnIgPSB0aW1lb3V0OwogCQllbHNlCi0JCQlpOTE1X3JlcXVlc3RfcmV0
aXJlX3VwdG8ocnEpOworCQkJaTkxNV9yZXF1ZXN0X3JldGlyZV91cHRvKHRvX3JlcXVlc3QoZmVu
Y2UpKTsKIAotCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKKwkJZG1hX2ZlbmNlX3B1dChmZW5jZSk7
CiAJfSB3aGlsZSAoIWVycik7CiAJbXV0ZXhfdW5sb2NrKCZ0bC0+bXV0ZXgpOwogCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCmluZGV4IGU3YmMyZGJiYjJhNS4uZGQyNTYzNmFi
YzViIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwpAQCAtMTE3Miw5ICsx
MTcyLDEzIEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpkdW1teV9yZXF1ZXN0KHN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAlpZiAoIXJxKQogCQlyZXR1cm4gTlVMTDsKIAot
CUlOSVRfTElTVF9IRUFEKCZycS0+YWN0aXZlX2xpc3QpOwogCXJxLT5lbmdpbmUgPSBlbmdpbmU7
CiAKKwlzcGluX2xvY2tfaW5pdCgmcnEtPmxvY2spOworCUlOSVRfTElTVF9IRUFEKCZycS0+ZmVu
Y2UuY2JfbGlzdCk7CisJcnEtPmZlbmNlLmxvY2sgPSAmcnEtPmxvY2s7CisJcnEtPmZlbmNlLm9w
cyA9ICZpOTE1X2ZlbmNlX29wczsKKwogCWk5MTVfc2NoZWRfbm9kZV9pbml0KCZycS0+c2NoZWQp
OwogCiAJLyogbWFyayB0aGlzIHJlcXVlc3QgYXMgcGVybWFuZW50bHkgaW5jb21wbGV0ZSAqLwpA
QCAtMTI2Nyw4ICsxMjcxLDggQEAgc3RhdGljIGludCBsaXZlX3N1cHByZXNzX3dhaXRfcHJlZW1w
dCh2b2lkICphcmcpCiAJCQkJfQogCiAJCQkJLyogRGlzYWJsZSBORVdDTElFTlQgcHJvbW90aW9u
ICovCi0JCQkJX19pOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldCgmaTkxNV9yZXF1ZXN0X3RpbWVsaW5l
KHJxW2ldKS0+bGFzdF9yZXF1ZXN0LAotCQkJCQkJCSAgZHVtbXkpOworCQkJCV9faTkxNV9hY3Rp
dmVfZmVuY2Vfc2V0KCZpOTE1X3JlcXVlc3RfdGltZWxpbmUocnFbaV0pLT5sYXN0X3JlcXVlc3Qs
CisJCQkJCQkJJmR1bW15LT5mZW5jZSk7CiAJCQkJaTkxNV9yZXF1ZXN0X2FkZChycVtpXSk7CiAJ
CQl9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0cy9tb2Nr
X3RpbWVsaW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdHMvbW9ja190aW1l
bGluZS5jCmluZGV4IDU5ODE3MGVmY2FmNi4uMmE3N2MwNTFmMzZhIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdHMvbW9ja190aW1lbGluZS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0cy9tb2NrX3RpbWVsaW5lLmMKQEAgLTE1LDcgKzE1
LDcgQEAgdm9pZCBtb2NrX3RpbWVsaW5lX2luaXQoc3RydWN0IGludGVsX3RpbWVsaW5lICp0aW1l
bGluZSwgdTY0IGNvbnRleHQpCiAKIAltdXRleF9pbml0KCZ0aW1lbGluZS0+bXV0ZXgpOwogCi0J
SU5JVF9BQ1RJVkVfUkVRVUVTVCgmdGltZWxpbmUtPmxhc3RfcmVxdWVzdCwgJnRpbWVsaW5lLT5t
dXRleCk7CisJSU5JVF9BQ1RJVkVfRkVOQ0UoJnRpbWVsaW5lLT5sYXN0X3JlcXVlc3QsICZ0aW1l
bGluZS0+bXV0ZXgpOwogCUlOSVRfTElTVF9IRUFEKCZ0aW1lbGluZS0+cmVxdWVzdHMpOwogCiAJ
aTkxNV9zeW5jbWFwX2luaXQoJnRpbWVsaW5lLT5zeW5jKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9z
Y2hlZHVsZXIuYwppbmRleCA2Yzc5ZDE2YjM4MWUuLjAzZjU2NzA4NDU0OCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d2dC9zY2hlZHVsZXIuYwpAQCAtMzg1LDExICszODUsOCBAQCBpbnRlbF9ndnRfd29y
a2xvYWRfcmVxX2FsbG9jKHN0cnVjdCBpbnRlbF92Z3B1X3dvcmtsb2FkICp3b3JrbG9hZCkKIHsK
IAlzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSA9IHdvcmtsb2FkLT52Z3B1OwogCXN0cnVjdCBpbnRl
bF92Z3B1X3N1Ym1pc3Npb24gKnMgPSAmdmdwdS0+c3VibWlzc2lvbjsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB2Z3B1LT5ndnQtPmRldl9wcml2OwogCXN0cnVjdCBpOTE1
X3JlcXVlc3QgKnJxOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwotCiAJaWYgKHdvcmtsb2FkLT5yZXEpCiAJCXJldHVybiAwOwogCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9hY3RpdmUuYwppbmRleCA3Y2EwNjY2ODhiOTguLjAyMzY1MmRlZDRiZSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jCkBAIC0xMiw4ICsxMiw2IEBACiAjaW5jbHVkZSAi
aTkxNV9hY3RpdmUuaCIKICNpbmNsdWRlICJpOTE1X2dsb2JhbHMuaCIKIAotI2RlZmluZSBCS0wo
cmVmKSAoJihyZWYpLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KQotCiAvKgogICogQWN0aXZlIHJl
ZnMgbWVtb3J5IG1hbmFnZW1lbnQKICAqCkBAIC0yNywzNSArMjUsMzUgQEAgc3RhdGljIHN0cnVj
dCBpOTE1X2dsb2JhbF9hY3RpdmUgewogfSBnbG9iYWw7CiAKIHN0cnVjdCBhY3RpdmVfbm9kZSB7
Ci0Jc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgYmFzZTsKKwlzdHJ1Y3QgaTkxNV9hY3RpdmVf
ZmVuY2UgYmFzZTsKIAlzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZjsKIAlzdHJ1Y3QgcmJfbm9kZSBu
b2RlOwogCXU2NCB0aW1lbGluZTsKIH07CiAKIHN0YXRpYyBpbmxpbmUgc3RydWN0IGFjdGl2ZV9u
b2RlICoKLW5vZGVfZnJvbV9hY3RpdmUoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2
ZSkKK25vZGVfZnJvbV9hY3RpdmUoc3RydWN0IGk5MTVfYWN0aXZlX2ZlbmNlICphY3RpdmUpCiB7
CiAJcmV0dXJuIGNvbnRhaW5lcl9vZihhY3RpdmUsIHN0cnVjdCBhY3RpdmVfbm9kZSwgYmFzZSk7
CiB9CiAKICNkZWZpbmUgdGFrZV9wcmVhbGxvY2F0ZWRfYmFycmllcnMoeCkgbGxpc3RfZGVsX2Fs
bCgmKHgpLT5wcmVhbGxvY2F0ZWRfYmFycmllcnMpCiAKLXN0YXRpYyBpbmxpbmUgYm9vbCBpc19i
YXJyaWVyKGNvbnN0IHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUpCitzdGF0aWMg
aW5saW5lIGJvb2wgaXNfYmFycmllcihjb25zdCBzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFj
dGl2ZSkKIHsKLQlyZXR1cm4gSVNfRVJSKHJjdV9hY2Nlc3NfcG9pbnRlcihhY3RpdmUtPnJlcXVl
c3QpKTsKKwlyZXR1cm4gSVNfRVJSKHJjdV9hY2Nlc3NfcG9pbnRlcihhY3RpdmUtPmZlbmNlKSk7
CiB9CiAKIHN0YXRpYyBpbmxpbmUgc3RydWN0IGxsaXN0X25vZGUgKmJhcnJpZXJfdG9fbGwoc3Ry
dWN0IGFjdGl2ZV9ub2RlICpub2RlKQogewogCUdFTV9CVUdfT04oIWlzX2JhcnJpZXIoJm5vZGUt
PmJhc2UpKTsKLQlyZXR1cm4gKHN0cnVjdCBsbGlzdF9ub2RlICopJm5vZGUtPmJhc2UubGluazsK
KwlyZXR1cm4gKHN0cnVjdCBsbGlzdF9ub2RlICopJm5vZGUtPmJhc2UuY2Iubm9kZTsKIH0KIAog
c3RhdGljIGlubGluZSBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICoKIF9fYmFycmllcl90b19lbmdp
bmUoc3RydWN0IGFjdGl2ZV9ub2RlICpub2RlKQogewotCXJldHVybiAoc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqKVJFQURfT05DRShub2RlLT5iYXNlLmxpbmsucHJldik7CisJcmV0dXJuIChzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICopUkVBRF9PTkNFKG5vZGUtPmJhc2UuY2Iubm9kZS5wcmV2KTsK
IH0KIAogc3RhdGljIGlubGluZSBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICoKQEAgLTY4LDcgKzY2
LDcgQEAgYmFycmllcl90b19lbmdpbmUoc3RydWN0IGFjdGl2ZV9ub2RlICpub2RlKQogc3RhdGlj
IGlubGluZSBzdHJ1Y3QgYWN0aXZlX25vZGUgKmJhcnJpZXJfZnJvbV9sbChzdHJ1Y3QgbGxpc3Rf
bm9kZSAqeCkKIHsKIAlyZXR1cm4gY29udGFpbmVyX29mKChzdHJ1Y3QgbGlzdF9oZWFkICopeCwK
LQkJCSAgICBzdHJ1Y3QgYWN0aXZlX25vZGUsIGJhc2UubGluayk7CisJCQkgICAgc3RydWN0IGFj
dGl2ZV9ub2RlLCBiYXNlLmNiLm5vZGUpOwogfQogCiAjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJN
X0k5MTVfREVCVUdfR0VNKSAmJiBJU19FTkFCTEVEKENPTkZJR19ERUJVR19PQkpFQ1RTKQpAQCAt
MTQ3LDE1ICsxNDUsMTggQEAgX19hY3RpdmVfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVm
KQogCWlmICghcmV0aXJlKQogCQlyZXR1cm47CiAKLQlHRU1fQlVHX09OKHJjdV9hY2Nlc3NfcG9p
bnRlcihyZWYtPmV4Y2wpKTsKKwlHRU1fQlVHX09OKHJjdV9hY2Nlc3NfcG9pbnRlcihyZWYtPmV4
Y2wuZmVuY2UpKTsKIAlyYnRyZWVfcG9zdG9yZGVyX2Zvcl9lYWNoX2VudHJ5X3NhZmUoaXQsIG4s
ICZyb290LCBub2RlKSB7Ci0JCUdFTV9CVUdfT04oaTkxNV9hY3RpdmVfcmVxdWVzdF9pc3NldCgm
aXQtPmJhc2UpKTsKKwkJR0VNX0JVR19PTihpOTE1X2FjdGl2ZV9mZW5jZV9pc3NldCgmaXQtPmJh
c2UpKTsKIAkJa21lbV9jYWNoZV9mcmVlKGdsb2JhbC5zbGFiX2NhY2hlLCBpdCk7CiAJfQogCiAJ
LyogQWZ0ZXIgdGhlIGZpbmFsIHJldGlyZSwgdGhlIGVudGlyZSBzdHJ1Y3QgbWF5IGJlIGZyZWVk
ICovCiAJaWYgKHJlZi0+cmV0aXJlKQogCQlyZWYtPnJldGlyZShyZWYpOworCisJLyogLi4uIGV4
Y2VwdCBpZiB5b3Ugd2FpdCBvbiBpdCwgeW91IG11c3QgbWFuYWdlIHlvdXIgb3duIHJlZmVyZW5j
ZXMhICovCisJd2FrZV91cF92YXIocmVmKTsKIH0KIAogc3RhdGljIHZvaWQKQEAgLTE4OSwxMiAr
MTkwLDIwIEBAIGFjdGl2ZV9yZXRpcmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiB9CiAKIHN0
YXRpYyB2b2lkCi1ub2RlX3JldGlyZShzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYmFzZSwg
c3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCitub2RlX3JldGlyZShzdHJ1Y3QgZG1hX2ZlbmNlICpm
ZW5jZSwgc3RydWN0IGRtYV9mZW5jZV9jYiAqY2IpCiB7Ci0JYWN0aXZlX3JldGlyZShub2RlX2Zy
b21fYWN0aXZlKGJhc2UpLT5yZWYpOworCWk5MTVfYWN0aXZlX2ZlbmNlX2NiKGZlbmNlLCBjYik7
CisJYWN0aXZlX3JldGlyZShjb250YWluZXJfb2YoY2IsIHN0cnVjdCBhY3RpdmVfbm9kZSwgYmFz
ZS5jYiktPnJlZik7CiB9CiAKLXN0YXRpYyBzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqCitz
dGF0aWMgdm9pZAorZXhjbF9yZXRpcmUoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsIHN0cnVjdCBk
bWFfZmVuY2VfY2IgKmNiKQoreworCWk5MTVfYWN0aXZlX2ZlbmNlX2NiKGZlbmNlLCBjYik7CisJ
YWN0aXZlX3JldGlyZShjb250YWluZXJfb2YoY2IsIHN0cnVjdCBpOTE1X2FjdGl2ZSwgZXhjbC5j
YikpOworfQorCitzdGF0aWMgc3RydWN0IGk5MTVfYWN0aXZlX2ZlbmNlICoKIGFjdGl2ZV9pbnN0
YW5jZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgc3RydWN0IGludGVsX3RpbWVsaW5lICp0bCkK
IHsKIAlzdHJ1Y3QgYWN0aXZlX25vZGUgKm5vZGUsICpwcmVhbGxvYzsKQEAgLTIzOCw3ICsyNDcs
NyBAQCBhY3RpdmVfaW5zdGFuY2Uoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsIHN0cnVjdCBpbnRl
bF90aW1lbGluZSAqdGwpCiAJfQogCiAJbm9kZSA9IHByZWFsbG9jOwotCWk5MTVfYWN0aXZlX3Jl
cXVlc3RfaW5pdCgmbm9kZS0+YmFzZSwgJnRsLT5tdXRleCwgTlVMTCwgbm9kZV9yZXRpcmUpOwor
CV9faTkxNV9hY3RpdmVfZmVuY2VfaW5pdCgmbm9kZS0+YmFzZSwgJnRsLT5tdXRleCwgTlVMTCwg
bm9kZV9yZXRpcmUpOwogCW5vZGUtPnJlZiA9IHJlZjsKIAlub2RlLT50aW1lbGluZSA9IGlkeDsK
IApAQCAtMjUzLDggKzI2Miw3IEBAIGFjdGl2ZV9pbnN0YW5jZShzdHJ1Y3QgaTkxNV9hY3RpdmUg
KnJlZiwgc3RydWN0IGludGVsX3RpbWVsaW5lICp0bCkKIAlyZXR1cm4gJm5vZGUtPmJhc2U7CiB9
CiAKLXZvaWQgX19pOTE1X2FjdGl2ZV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LAotCQkJc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCit2b2lkIF9faTkxNV9hY3RpdmVfaW5pdChz
dHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKIAkJCWludCAoKmFjdGl2ZSkoc3RydWN0IGk5MTVfYWN0
aXZlICpyZWYpLAogCQkJdm9pZCAoKnJldGlyZSkoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpLAog
CQkJc3RydWN0IGxvY2tfY2xhc3Nfa2V5ICprZXkpCkBAIC0yNjMsMTkgKzI3MSwxOCBAQCB2b2lk
IF9faTkxNV9hY3RpdmVfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAogCWRl
YnVnX2FjdGl2ZV9pbml0KHJlZik7CiAKLQlyZWYtPmk5MTUgPSBpOTE1OwogCXJlZi0+ZmxhZ3Mg
PSAwOwogCXJlZi0+YWN0aXZlID0gYWN0aXZlOwogCXJlZi0+cmV0aXJlID0gcHRyX3VucGFja19i
aXRzKHJldGlyZSwgJmJpdHMsIDIpOwogCWlmIChiaXRzICYgSTkxNV9BQ1RJVkVfTUFZX1NMRUVQ
KQogCQlyZWYtPmZsYWdzIHw9IEk5MTVfQUNUSVZFX1JFVElSRV9TTEVFUFM7CiAKLQlyZWYtPmV4
Y2wgPSBOVUxMOwogCXJlZi0+dHJlZSA9IFJCX1JPT1Q7CiAJcmVmLT5jYWNoZSA9IE5VTEw7CiAJ
aW5pdF9sbGlzdF9oZWFkKCZyZWYtPnByZWFsbG9jYXRlZF9iYXJyaWVycyk7CiAJYXRvbWljX3Nl
dCgmcmVmLT5jb3VudCwgMCk7CiAJX19tdXRleF9pbml0KCZyZWYtPm11dGV4LCAiaTkxNV9hY3Rp
dmUiLCBrZXkpOworCV9faTkxNV9hY3RpdmVfZmVuY2VfaW5pdCgmcmVmLT5leGNsLCAmcmVmLT5t
dXRleCwgTlVMTCwgZXhjbF9yZXRpcmUpOwogCUlOSVRfV09SSygmcmVmLT53b3JrLCBhY3RpdmVf
d29yayk7CiB9CiAKQEAgLTMyOSw5ICszMzYsOSBAQCBfX2FjdGl2ZV9kZWxfYmFycmllcihzdHJ1
Y3QgaTkxNV9hY3RpdmUgKnJlZiwgc3RydWN0IGFjdGl2ZV9ub2RlICpub2RlKQogCiBpbnQgaTkx
NV9hY3RpdmVfcmVmKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLAogCQkgICAgc3RydWN0IGludGVs
X3RpbWVsaW5lICp0bCwKLQkJICAgIHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQorCQkgICAgc3Ry
dWN0IGRtYV9mZW5jZSAqZmVuY2UpCiB7Ci0Jc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFj
dGl2ZTsKKwlzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2ZTsKIAlpbnQgZXJyOwogCiAJ
bG9ja2RlcF9hc3NlcnRfaGVsZCgmdGwtPm11dGV4KTsKQEAgLTM1NCw2NiArMzYxLDQ0IEBAIGlu
dCBpOTE1X2FjdGl2ZV9yZWYoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCiAJCSAqIHJlcXVlc3Qg
dGhhdCB3ZSB3YW50IHRvIGVtaXQgb24gdGhlIGtlcm5lbF9jb250ZXh0LgogCQkgKi8KIAkJX19h
Y3RpdmVfZGVsX2JhcnJpZXIocmVmLCBub2RlX2Zyb21fYWN0aXZlKGFjdGl2ZSkpOwotCQlSQ1Vf
SU5JVF9QT0lOVEVSKGFjdGl2ZS0+cmVxdWVzdCwgTlVMTCk7Ci0JCUlOSVRfTElTVF9IRUFEKCZh
Y3RpdmUtPmxpbmspOwotCX0gZWxzZSB7Ci0JCWlmICghaTkxNV9hY3RpdmVfcmVxdWVzdF9pc3Nl
dChhY3RpdmUpKQotCQkJYXRvbWljX2luYygmcmVmLT5jb3VudCk7CisJCVJDVV9JTklUX1BPSU5U
RVIoYWN0aXZlLT5mZW5jZSwgTlVMTCk7CisJCWF0b21pY19kZWMoJnJlZi0+Y291bnQpOwogCX0K
LQlHRU1fQlVHX09OKCFhdG9taWNfcmVhZCgmcmVmLT5jb3VudCkpOwotCV9faTkxNV9hY3RpdmVf
cmVxdWVzdF9zZXQoYWN0aXZlLCBycSk7CisJaWYgKCFfX2k5MTVfYWN0aXZlX2ZlbmNlX3NldChh
Y3RpdmUsIGZlbmNlKSkKKwkJYXRvbWljX2luYygmcmVmLT5jb3VudCk7CiAKIG91dDoKIAlpOTE1
X2FjdGl2ZV9yZWxlYXNlKHJlZik7CiAJcmV0dXJuIGVycjsKIH0KIAotc3RhdGljIHZvaWQgZXhj
bF9jYihzdHJ1Y3QgZG1hX2ZlbmNlICpmLCBzdHJ1Y3QgZG1hX2ZlbmNlX2NiICpjYikKLXsKLQlz
dHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiA9IGNvbnRhaW5lcl9vZihjYiwgdHlwZW9mKCpyZWYpLCBl
eGNsX2NiKTsKLQotCVJDVV9JTklUX1BPSU5URVIocmVmLT5leGNsLCBOVUxMKTsKLQlkbWFfZmVu
Y2VfcHV0KGYpOwotCi0JYWN0aXZlX3JldGlyZShyZWYpOwotfQotCiB2b2lkIGk5MTVfYWN0aXZl
X3NldF9leGNsdXNpdmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsIHN0cnVjdCBkbWFfZmVuY2Ug
KmYpCiB7CiAJLyogV2UgZXhwZWN0IHRoZSBjYWxsZXIgdG8gbWFuYWdlIHRoZSBleGNsdXNpdmUg
dGltZWxpbmUgb3JkZXJpbmcgKi8KIAlHRU1fQlVHX09OKGk5MTVfYWN0aXZlX2lzX2lkbGUocmVm
KSk7CiAKLQlkbWFfZmVuY2VfZ2V0KGYpOwotCi0JcmN1X3JlYWRfbG9jaygpOwotCWlmIChyY3Vf
YWNjZXNzX3BvaW50ZXIocmVmLT5leGNsKSkgewotCQlzdHJ1Y3QgZG1hX2ZlbmNlICpvbGQ7Ci0K
LQkJb2xkID0gZG1hX2ZlbmNlX2dldF9yY3Vfc2FmZSgmcmVmLT5leGNsKTsKLQkJaWYgKG9sZCkg
ewotCQkJaWYgKGRtYV9mZW5jZV9yZW1vdmVfY2FsbGJhY2sob2xkLCAmcmVmLT5leGNsX2NiKSkK
LQkJCQlhdG9taWNfZGVjKCZyZWYtPmNvdW50KTsKLQkJCWRtYV9mZW5jZV9wdXQob2xkKTsKLQkJ
fQotCX0KLQlyY3VfcmVhZF91bmxvY2soKTsKLQotCWF0b21pY19pbmMoJnJlZi0+Y291bnQpOwot
CXJjdV9hc3NpZ25fcG9pbnRlcihyZWYtPmV4Y2wsIGYpOworCS8qCisJICogQXMgd2UgZG9uJ3Qg
a25vdyB3aGljaCBtdXRleCB0aGUgY2FsbGVyIGlzIHVzaW5nLCB3ZSB0b2xkIGEgc21hbGwKKwkg
KiBsaWUgdG8gdGhlIGRlYnVnIGNvZGUgdGhhdCBpdCBpcyB1c2luZyB0aGUgaTkxNV9hY3RpdmUu
bXV0ZXg7CisJICogYW5kIG5vdyB3ZSBtdXN0IHN0aWNrIHRvIHRoYXQgbGllLgorCSAqLworCW11
dGV4X2FjcXVpcmUoJnJlZi0+bXV0ZXguZGVwX21hcCwgMCwgMCwgX1RISVNfSVBfKTsKKwlpZiAo
IV9faTkxNV9hY3RpdmVfZmVuY2Vfc2V0KCZyZWYtPmV4Y2wsIGYpKQorCQlhdG9taWNfaW5jKCZy
ZWYtPmNvdW50KTsKKwltdXRleF9yZWxlYXNlKCZyZWYtPm11dGV4LmRlcF9tYXAsIDAsIF9USElT
X0lQXyk7Cit9CiAKLQlpZiAoZG1hX2ZlbmNlX2FkZF9jYWxsYmFjayhmLCAmcmVmLT5leGNsX2Ni
LCBleGNsX2NiKSkgewotCQlSQ1VfSU5JVF9QT0lOVEVSKHJlZi0+ZXhjbCwgTlVMTCk7Ci0JCWF0
b21pY19kZWMoJnJlZi0+Y291bnQpOwotCQlkbWFfZmVuY2VfcHV0KGYpOwotCX0KK2Jvb2wgaTkx
NV9hY3RpdmVfYWNxdWlyZV9pZl9idXN5KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQoreworCWRl
YnVnX2FjdGl2ZV9hc3NlcnQocmVmKTsKKwlyZXR1cm4gYXRvbWljX2FkZF91bmxlc3MoJnJlZi0+
Y291bnQsIDEsIDApOwogfQogCiBpbnQgaTkxNV9hY3RpdmVfYWNxdWlyZShzdHJ1Y3QgaTkxNV9h
Y3RpdmUgKnJlZikKIHsKIAlpbnQgZXJyOwogCi0JZGVidWdfYWN0aXZlX2Fzc2VydChyZWYpOwot
CWlmIChhdG9taWNfYWRkX3VubGVzcygmcmVmLT5jb3VudCwgMSwgMCkpCisJaWYgKGk5MTVfYWN0
aXZlX2FjcXVpcmVfaWZfYnVzeShyZWYpKQogCQlyZXR1cm4gMDsKIAogCWVyciA9IG11dGV4X2xv
Y2tfaW50ZXJydXB0aWJsZSgmcmVmLT5tdXRleCk7CkBAIC00MzgsMTIxICs0MjMsNTcgQEAgdm9p
ZCBpOTE1X2FjdGl2ZV9yZWxlYXNlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQogCWFjdGl2ZV9y
ZXRpcmUocmVmKTsKIH0KIAotc3RhdGljIHZvaWQgX19hY3RpdmVfdW5ncmFiKHN0cnVjdCBpOTE1
X2FjdGl2ZSAqcmVmKQotewotCWNsZWFyX2FuZF93YWtlX3VwX2JpdChJOTE1X0FDVElWRV9HUkFC
X0JJVCwgJnJlZi0+ZmxhZ3MpOwotfQotCi1ib29sIGk5MTVfYWN0aXZlX3RyeWdyYWIoc3RydWN0
IGk5MTVfYWN0aXZlICpyZWYpCitzdGF0aWMgdm9pZCBlbmFibGVfc2lnbmFsaW5nKHN0cnVjdCBp
OTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlKQogewotCWRlYnVnX2FjdGl2ZV9hc3NlcnQocmVmKTsK
LQotCWlmICh0ZXN0X2FuZF9zZXRfYml0KEk5MTVfQUNUSVZFX0dSQUJfQklULCAmcmVmLT5mbGFn
cykpCi0JCXJldHVybiBmYWxzZTsKLQotCWlmICghYXRvbWljX2FkZF91bmxlc3MoJnJlZi0+Y291
bnQsIDEsIDApKSB7Ci0JCV9fYWN0aXZlX3VuZ3JhYihyZWYpOwotCQlyZXR1cm4gZmFsc2U7Ci0J
fQorCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlOwogCi0JcmV0dXJuIHRydWU7Ci19Ci0KLXZvaWQg
aTkxNV9hY3RpdmVfdW5ncmFiKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQotewotCUdFTV9CVUdf
T04oIXRlc3RfYml0KEk5MTVfQUNUSVZFX0dSQUJfQklULCAmcmVmLT5mbGFncykpOwotCi0JYWN0
aXZlX3JldGlyZShyZWYpOwotCV9fYWN0aXZlX3VuZ3JhYihyZWYpOwotfQotCi1zdGF0aWMgaW50
IGV4Y2xfd2FpdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKLXsKLQlzdHJ1Y3QgZG1hX2ZlbmNl
ICpvbGQ7Ci0JaW50IGVyciA9IDA7Ci0KLQlpZiAoIXJjdV9hY2Nlc3NfcG9pbnRlcihyZWYtPmV4
Y2wpKQotCQlyZXR1cm4gMDsKLQotCXJjdV9yZWFkX2xvY2soKTsKLQlvbGQgPSBkbWFfZmVuY2Vf
Z2V0X3JjdV9zYWZlKCZyZWYtPmV4Y2wpOwotCXJjdV9yZWFkX3VubG9jaygpOwotCWlmIChvbGQp
IHsKLQkJZXJyID0gZG1hX2ZlbmNlX3dhaXQob2xkLCB0cnVlKTsKLQkJZG1hX2ZlbmNlX3B1dChv
bGQpOwotCX0KKwlmZW5jZSA9IGk5MTVfYWN0aXZlX2ZlbmNlX2dldChhY3RpdmUpOworCWlmICgh
ZmVuY2UpCisJCXJldHVybjsKIAotCXJldHVybiBlcnI7CisJZG1hX2ZlbmNlX2VuYWJsZV9zd19z
aWduYWxpbmcoZmVuY2UpOworCWRtYV9mZW5jZV9wdXQoZmVuY2UpOwogfQogCiBpbnQgaTkxNV9h
Y3RpdmVfd2FpdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIHsKIAlzdHJ1Y3QgYWN0aXZlX25v
ZGUgKml0LCAqbjsKLQlpbnQgZXJyOworCWludCBlcnIgPSAwOwogCiAJbWlnaHRfc2xlZXAoKTsK
LQltaWdodF9sb2NrKCZyZWYtPm11dGV4KTsKLQotCWlmIChpOTE1X2FjdGl2ZV9pc19pZGxlKHJl
ZikpCi0JCXJldHVybiAwOwotCi0JZXJyID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZyZWYt
Pm11dGV4KTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gZXJyOwogCi0JaWYgKCFhdG9taWNfYWRkX3Vu
bGVzcygmcmVmLT5jb3VudCwgMSwgMCkpIHsKLQkJbXV0ZXhfdW5sb2NrKCZyZWYtPm11dGV4KTsK
KwlpZiAoIWk5MTVfYWN0aXZlX2FjcXVpcmVfaWZfYnVzeShyZWYpKQogCQlyZXR1cm4gMDsKLQl9
Ci0KLQllcnIgPSBleGNsX3dhaXQocmVmKTsKLQlpZiAoZXJyKQotCQlnb3RvIG91dDsKIAorCS8q
IEZsdXNoIGxhenkgc2lnbmFscyAqLworCWVuYWJsZV9zaWduYWxpbmcoJnJlZi0+ZXhjbCk7CiAJ
cmJ0cmVlX3Bvc3RvcmRlcl9mb3JfZWFjaF9lbnRyeV9zYWZlKGl0LCBuLCAmcmVmLT50cmVlLCBu
b2RlKSB7Ci0JCWlmIChpc19iYXJyaWVyKCZpdC0+YmFzZSkpIHsgLyogdW5jb25uZWN0ZWQgaWRs
ZS1iYXJyaWVyICovCi0JCQllcnIgPSAtRUJVU1k7Ci0JCQlicmVhazsKLQkJfQorCQlpZiAoaXNf
YmFycmllcigmaXQtPmJhc2UpKSAvKiB1bmNvbm5lY3RlZCBpZGxlIGJhcnJpZXIgKi8KKwkJCWNv
bnRpbnVlOwogCi0JCWVyciA9IGk5MTVfYWN0aXZlX3JlcXVlc3RfcmV0aXJlKCZpdC0+YmFzZSwg
QktMKHJlZikpOwotCQlpZiAoZXJyKQotCQkJYnJlYWs7CisJCWVuYWJsZV9zaWduYWxpbmcoJml0
LT5iYXNlKTsKIAl9CisJLyogQW55IGZlbmNlIGFkZGVkIGFmdGVyIHRoZSB3YWl0IGJlZ2lucyB3
aWxsIG5vdCBiZSBhdXRvLXNpZ25hbGVkICovCiAKLW91dDoKLQlfX2FjdGl2ZV9yZXRpcmUocmVm
KTsKKwlpOTE1X2FjdGl2ZV9yZWxlYXNlKHJlZik7CiAJaWYgKGVycikKIAkJcmV0dXJuIGVycjsK
IAotCWlmICh3YWl0X29uX2JpdCgmcmVmLT5mbGFncywgSTkxNV9BQ1RJVkVfR1JBQl9CSVQsIFRB
U0tfS0lMTEFCTEUpKQorCWlmICh3YWl0X3Zhcl9ldmVudF9pbnRlcnJ1cHRpYmxlKHJlZiwgaTkx
NV9hY3RpdmVfaXNfaWRsZShyZWYpKSkKIAkJcmV0dXJuIC1FSU5UUjsKIAotCWZsdXNoX3dvcmso
JnJlZi0+d29yayk7Ci0JaWYgKCFpOTE1X2FjdGl2ZV9pc19pZGxlKHJlZikpCi0JCXJldHVybiAt
RUJVU1k7Ci0KIAlyZXR1cm4gMDsKIH0KIAotaW50IGk5MTVfcmVxdWVzdF9hd2FpdF9hY3RpdmVf
cmVxdWVzdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKLQkJCQkgICAgICBzdHJ1Y3QgaTkxNV9h
Y3RpdmVfcmVxdWVzdCAqYWN0aXZlKQotewotCXN0cnVjdCBpOTE1X3JlcXVlc3QgKmJhcnJpZXIg
PQotCQlpOTE1X2FjdGl2ZV9yZXF1ZXN0X3JhdyhhY3RpdmUsICZycS0+aTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7Ci0KLQlyZXR1cm4gYmFycmllciA/IGk5MTVfcmVxdWVzdF9hd2FpdF9kbWFfZmVu
Y2UocnEsICZiYXJyaWVyLT5mZW5jZSkgOiAwOwotfQotCiBpbnQgaTkxNV9yZXF1ZXN0X2F3YWl0
X2FjdGl2ZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgc3RydWN0IGk5MTVfYWN0aXZlICpyZWYp
CiB7CiAJaW50IGVyciA9IDA7CiAKLQlpZiAocmN1X2FjY2Vzc19wb2ludGVyKHJlZi0+ZXhjbCkp
IHsKKwlpZiAocmN1X2FjY2Vzc19wb2ludGVyKHJlZi0+ZXhjbC5mZW5jZSkpIHsKIAkJc3RydWN0
IGRtYV9mZW5jZSAqZmVuY2U7CiAKIAkJcmN1X3JlYWRfbG9jaygpOwotCQlmZW5jZSA9IGRtYV9m
ZW5jZV9nZXRfcmN1X3NhZmUoJnJlZi0+ZXhjbCk7CisJCWZlbmNlID0gZG1hX2ZlbmNlX2dldF9y
Y3Vfc2FmZSgmcmVmLT5leGNsLmZlbmNlKTsKIAkJcmN1X3JlYWRfdW5sb2NrKCk7CiAJCWlmIChm
ZW5jZSkgewogCQkJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X2RtYV9mZW5jZShycSwgZmVuY2Up
OwpAQCAtNTc4LDcgKzQ5OSw3IEBAIHZvaWQgaTkxNV9hY3RpdmVfZmluaShzdHJ1Y3QgaTkxNV9h
Y3RpdmUgKnJlZikKIAogc3RhdGljIGlubGluZSBib29sIGlzX2lkbGVfYmFycmllcihzdHJ1Y3Qg
YWN0aXZlX25vZGUgKm5vZGUsIHU2NCBpZHgpCiB7Ci0JcmV0dXJuIG5vZGUtPnRpbWVsaW5lID09
IGlkeCAmJiAhaTkxNV9hY3RpdmVfcmVxdWVzdF9pc3NldCgmbm9kZS0+YmFzZSk7CisJcmV0dXJu
IG5vZGUtPnRpbWVsaW5lID09IGlkeCAmJiAhaTkxNV9hY3RpdmVfZmVuY2VfaXNzZXQoJm5vZGUt
PmJhc2UpOwogfQogCiBzdGF0aWMgc3RydWN0IGFjdGl2ZV9ub2RlICpyZXVzZV9pZGxlX2JhcnJp
ZXIoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsIHU2NCBpZHgpCkBAIC02OTgsMTMgKzYxOSwxMyBA
QCBpbnQgaTkxNV9hY3RpdmVfYWNxdWlyZV9wcmVhbGxvY2F0ZV9iYXJyaWVyKHN0cnVjdCBpOTE1
X2FjdGl2ZSAqcmVmLAogCQkJbm9kZS0+YmFzZS5sb2NrID0KIAkJCQkmZW5naW5lLT5rZXJuZWxf
Y29udGV4dC0+dGltZWxpbmUtPm11dGV4OwogI2VuZGlmCi0JCQlSQ1VfSU5JVF9QT0lOVEVSKG5v
ZGUtPmJhc2UucmVxdWVzdCwgTlVMTCk7Ci0JCQlub2RlLT5iYXNlLnJldGlyZSA9IG5vZGVfcmV0
aXJlOworCQkJUkNVX0lOSVRfUE9JTlRFUihub2RlLT5iYXNlLmZlbmNlLCBOVUxMKTsKKwkJCW5v
ZGUtPmJhc2UuY2IuZnVuYyA9IG5vZGVfcmV0aXJlOwogCQkJbm9kZS0+dGltZWxpbmUgPSBpZHg7
CiAJCQlub2RlLT5yZWYgPSByZWY7CiAJCX0KIAotCQlpZiAoIWk5MTVfYWN0aXZlX3JlcXVlc3Rf
aXNzZXQoJm5vZGUtPmJhc2UpKSB7CisJCWlmICghaTkxNV9hY3RpdmVfZmVuY2VfaXNzZXQoJm5v
ZGUtPmJhc2UpKSB7CiAJCQkvKgogCQkJICogTWFyayB0aGlzIGFzIGJlaW5nICpvdXIqIHVuY29u
bmVjdGVkIHByb3RvLW5vZGUuCiAJCQkgKgpAQCAtNzE0LDggKzYzNSw4IEBAIGludCBpOTE1X2Fj
dGl2ZV9hY3F1aXJlX3ByZWFsbG9jYXRlX2JhcnJpZXIoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYs
CiAJCQkgKiBhbmQgdGhlbiB3ZSBjYW4gdXNlIHRoZSByYl9ub2RlIGFuZCBsaXN0IHBvaW50ZXJz
CiAJCQkgKiBmb3Igb3VyIHRyYWNraW5nIG9mIHRoZSBwZW5kaW5nIGJhcnJpZXIuCiAJCQkgKi8K
LQkJCVJDVV9JTklUX1BPSU5URVIobm9kZS0+YmFzZS5yZXF1ZXN0LCBFUlJfUFRSKC1FQUdBSU4p
KTsKLQkJCW5vZGUtPmJhc2UubGluay5wcmV2ID0gKHZvaWQgKillbmdpbmU7CisJCQlSQ1VfSU5J
VF9QT0lOVEVSKG5vZGUtPmJhc2UuZmVuY2UsIEVSUl9QVFIoLUVBR0FJTikpOworCQkJbm9kZS0+
YmFzZS5jYi5ub2RlLnByZXYgPSAodm9pZCAqKWVuZ2luZTsKIAkJCWF0b21pY19pbmMoJnJlZi0+
Y291bnQpOwogCQl9CiAKQEAgLTc4Miw0NCArNzAzLDExMyBAQCB2b2lkIGk5MTVfcmVxdWVzdF9h
ZGRfYWN0aXZlX2JhcnJpZXJzKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogewogCXN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSA9IHJxLT5lbmdpbmU7CiAJc3RydWN0IGxsaXN0X25vZGUg
Km5vZGUsICpuZXh0OworCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAKIAlHRU1fQlVHX09OKGludGVs
X2VuZ2luZV9pc192aXJ0dWFsKGVuZ2luZSkpOwogCUdFTV9CVUdfT04oaTkxNV9yZXF1ZXN0X3Rp
bWVsaW5lKHJxKSAhPSBlbmdpbmUtPmtlcm5lbF9jb250ZXh0LT50aW1lbGluZSk7CiAKKwlub2Rl
ID0gbGxpc3RfZGVsX2FsbCgmZW5naW5lLT5iYXJyaWVyX3Rhc2tzKTsKKwlpZiAoIW5vZGUpCisJ
CXJldHVybjsKIAkvKgogCSAqIEF0dGFjaCB0aGUgbGlzdCBvZiBwcm90by1mZW5jZXMgdG8gdGhl
IGluLWZsaWdodCByZXF1ZXN0IHN1Y2gKIAkgKiB0aGF0IHRoZSBwYXJlbnQgaTkxNV9hY3RpdmUg
d2lsbCBiZSByZWxlYXNlZCB3aGVuIHRoaXMgcmVxdWVzdAogCSAqIGlzIHJldGlyZWQuCiAJICov
Ci0JbGxpc3RfZm9yX2VhY2hfc2FmZShub2RlLCBuZXh0LCBsbGlzdF9kZWxfYWxsKCZlbmdpbmUt
PmJhcnJpZXJfdGFza3MpKSB7Ci0JCVJDVV9JTklUX1BPSU5URVIoYmFycmllcl9mcm9tX2xsKG5v
ZGUpLT5iYXNlLnJlcXVlc3QsIHJxKTsKKwlzcGluX2xvY2tfaXJxc2F2ZSgmcnEtPmxvY2ssIGZs
YWdzKTsKKwlsbGlzdF9mb3JfZWFjaF9zYWZlKG5vZGUsIG5leHQsIG5vZGUpIHsKKwkJUkNVX0lO
SVRfUE9JTlRFUihiYXJyaWVyX2Zyb21fbGwobm9kZSktPmJhc2UuZmVuY2UsICZycS0+ZmVuY2Up
OwogCQlzbXBfd21iKCk7IC8qIHNlcmlhbGlzZSB3aXRoIHJldXNlX2lkbGVfYmFycmllciAqLwot
CQlsaXN0X2FkZF90YWlsKChzdHJ1Y3QgbGlzdF9oZWFkICopbm9kZSwgJnJxLT5hY3RpdmVfbGlz
dCk7CisJCWxpc3RfYWRkX3RhaWwoKHN0cnVjdCBsaXN0X2hlYWQgKilub2RlLCAmcnEtPmZlbmNl
LmNiX2xpc3QpOworCX0KKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZycS0+bG9jaywgZmxhZ3Mp
OworfQorCisjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfREVCVUdfR0VNKQorI2RlZmlu
ZSBhY3RpdmVfaXNfaGVsZChhY3RpdmUpIGxvY2tkZXBfaXNfaGVsZCgoYWN0aXZlKS0+bG9jaykK
KyNlbHNlCisjZGVmaW5lIGFjdGl2ZV9pc19oZWxkKGFjdGl2ZSkgdHJ1ZQorI2VuZGlmCisKKy8q
CisgKiBfX2k5MTVfYWN0aXZlX2ZlbmNlX3NldDogVXBkYXRlIHRoZSBsYXN0IGFjdGl2ZSBmZW5j
ZSBhbG9uZyBpdHMgdGltZWxpbmUKKyAqIEBhY3RpdmU6IHRoZSBhY3RpdmUgdHJhY2tlcgorICog
QGZlbmNlOiB0aGUgbmV3IGZlbmNlICh1bmRlciBjb25zdHJ1Y3Rpb24pCisgKgorICogUmVjb3Jk
cyB0aGUgbmV3IEBmZW5jZSBhcyB0aGUgbGFzdCBhY3RpdmUgZmVuY2UgYWxvbmcgaXRzIHRpbWVs
aW5lIGluCisgKiB0aGlzIGFjdGl2ZSB0cmFja2VyLCBtb3ZpbmcgdGhlIHRyYWNraW5nIGNhbGxi
YWNrcyBmcm9tIHRoZSBwcmV2aW91cworICogZmVuY2Ugb250byB0aGlzIG9uZS4gUmV0dXJucyB0
aGUgcHJldmlvdXMgZmVuY2UgKGlmIG5vdCBhbHJlYWR5IGNvbXBsZXRlZCksCisgKiB3aGljaCB0
aGUgY2FsbGVyIG11c3QgZW5zdXJlIGlzIGV4ZWN1dGVkIGJlZm9yZSB0aGUgbmV3IGZlbmNlLiBU
byBlbnN1cmUKKyAqIHRoYXQgdGhlIG9yZGVyIG9mIGZlbmNlcyB3aXRoaW4gdGhlIHRpbWVsaW5l
IG9mIHRoZSBpOTE1X2FjdGl2ZV9mZW5jZSBpcworICogbWFpbnRhaW5lZCwgaXQgbXVzdCBiZSBs
b2NrZWQgYnkgdGhlIGNhbGxlci4KKyAqLworc3RydWN0IGRtYV9mZW5jZSAqCitfX2k5MTVfYWN0
aXZlX2ZlbmNlX3NldChzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2ZSwKKwkJCXN0cnVj
dCBkbWFfZmVuY2UgKmZlbmNlKQoreworCXN0cnVjdCBkbWFfZmVuY2UgKnByZXY7CisJdW5zaWdu
ZWQgbG9uZyBmbGFnczsKKworCS8qIE5COiBtdXN0IGJlIHNlcmlhbGlzZWQgYnkgYW4gb3V0ZXIg
dGltZWxpbmUgbXV0ZXggKGFjdGl2ZS0+bG9jaykgKi8KKwlzcGluX2xvY2tfaXJxc2F2ZShmZW5j
ZS0+bG9jaywgZmxhZ3MpOworCUdFTV9CVUdfT04odGVzdF9iaXQoRE1BX0ZFTkNFX0ZMQUdfU0lH
TkFMRURfQklULCAmZmVuY2UtPmZsYWdzKSk7CisKKwlwcmV2ID0gcmN1X2RlcmVmZXJlbmNlX3By
b3RlY3RlZChhY3RpdmUtPmZlbmNlLCBhY3RpdmVfaXNfaGVsZChhY3RpdmUpKTsKKwlpZiAocHJl
dikgeworCQlHRU1fQlVHX09OKHByZXYgPT0gZmVuY2UpOworCQlzcGluX2xvY2tfbmVzdGVkKHBy
ZXYtPmxvY2ssIFNJTkdMRV9ERVBUSF9ORVNUSU5HKTsKKwkJX19saXN0X2RlbF9lbnRyeSgmYWN0
aXZlLT5jYi5ub2RlKTsKKwkJc3Bpbl91bmxvY2socHJldi0+bG9jayk7IC8qIHNlcmlhbGlzZSB3
aXRoIHByZXYtPmNiX2xpc3QgKi8KKworCQkvKgorCQkgKiBhY3RpdmUtPmZlbmNlIGlzIHJlc2V0
IGJ5IHRoZSBjYWxsYmFjayBmcm9tIGluc2lkZQorCQkgKiBpbnRlcnJ1cHQgY29udGV4dC4gV2Ug
bmVlZCB0byBzZXJpYWxpc2Ugb3VyIGxpc3QKKwkJICogbWFuaXB1bGF0aW9uIHdpdGggdGhlIGZl
bmNlLT5sb2NrIHRvIHByZXZlbnQgdGhlIHByZXYKKwkJICogYmVpbmcgbG9zdCBpbnNpZGUgYW4g
aW50ZXJydXB0IChpdCBjYW4ndCBiZSByZXBsYWNlZCBhcworCQkgKiBubyBvdGhlciBjYWxsZXIg
aXMgYWxsb3dlZCB0byBlbnRlciBfX2k5MTVfYWN0aXZlX2ZlbmNlX3NldAorCQkgKiBhcyB3ZSBo
b2xkIHRoZSB0aW1lbGluZSBsb2NrKS4gQWZ0ZXIgc2VyaWFsaXNpbmcgd2l0aAorCQkgKiB0aGUg
Y2FsbGJhY2ssIHdlIG5lZWQgdG8gZG91YmxlIGNoZWNrIHdoaWNoIHJhbiBmaXJzdCwKKwkJICog
b3VyIGxpc3RfZGVsKCkgW2RlY291cGxpbmcgcHJldiBmcm9tIHRoZSBjYWxsYmFja10gb3IKKwkJ
ICogdGhlIGNhbGxiYWNrLi4uCisJCSAqLworCQlwcmV2ID0gcmN1X2FjY2Vzc19wb2ludGVyKGFj
dGl2ZS0+ZmVuY2UpOwogCX0KKworCXJjdV9hc3NpZ25fcG9pbnRlcihhY3RpdmUtPmZlbmNlLCBm
ZW5jZSk7CisJbGlzdF9hZGRfdGFpbCgmYWN0aXZlLT5jYi5ub2RlLCAmZmVuY2UtPmNiX2xpc3Qp
OworCisJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZShmZW5jZS0+bG9jaywgZmxhZ3MpOworCisJcmV0
dXJuIHByZXY7CiB9CiAKLWludCBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldChzdHJ1Y3QgaTkxNV9h
Y3RpdmVfcmVxdWVzdCAqYWN0aXZlLAotCQkJICAgIHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQor
aW50IGk5MTVfYWN0aXZlX2ZlbmNlX3NldChzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2
ZSwKKwkJCSAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7Ci0JaW50IGVycjsKKwlzdHJ1Y3Qg
ZG1hX2ZlbmNlICpmZW5jZTsKKwlpbnQgZXJyID0gMDsKIAogI2lmIElTX0VOQUJMRUQoQ09ORklH
X0RSTV9JOTE1X0RFQlVHX0dFTSkKIAlsb2NrZGVwX2Fzc2VydF9oZWxkKGFjdGl2ZS0+bG9jayk7
CiAjZW5kaWYKIAotCS8qIE11c3QgbWFpbnRhaW4gb3JkZXJpbmcgd3J0IHByZXZpb3VzIGFjdGl2
ZSByZXF1ZXN0cyAqLwotCWVyciA9IGk5MTVfcmVxdWVzdF9hd2FpdF9hY3RpdmVfcmVxdWVzdChy
cSwgYWN0aXZlKTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gZXJyOworCS8qIE11c3QgbWFpbnRhaW4g
dGltZWxpbmUgb3JkZXJpbmcgd3J0IHByZXZpb3VzIGFjdGl2ZSByZXF1ZXN0cyAqLworCXJjdV9y
ZWFkX2xvY2soKTsKKwlmZW5jZSA9IF9faTkxNV9hY3RpdmVfZmVuY2Vfc2V0KGFjdGl2ZSwgJnJx
LT5mZW5jZSk7CisJaWYgKGZlbmNlKSAvKiBidXQgdGhlIHByZXZpb3VzIGZlbmNlIG1heSBub3Qg
YmVsb25nIHRvIHRoYXQgdGltZWxpbmUhICovCisJCWZlbmNlID0gZG1hX2ZlbmNlX2dldF9yY3Uo
ZmVuY2UpOworCXJjdV9yZWFkX3VubG9jaygpOworCWlmIChmZW5jZSkgeworCQllcnIgPSBpOTE1
X3JlcXVlc3RfYXdhaXRfZG1hX2ZlbmNlKHJxLCBmZW5jZSk7CisJCWRtYV9mZW5jZV9wdXQoZmVu
Y2UpOworCX0KIAotCV9faTkxNV9hY3RpdmVfcmVxdWVzdF9zZXQoYWN0aXZlLCBycSk7Ci0JcmV0
dXJuIDA7CisJcmV0dXJuIGVycjsKIH0KIAotdm9pZCBpOTE1X2FjdGl2ZV9yZXRpcmVfbm9vcChz
dHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLAotCQkJICAgICBzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpyZXF1ZXN0KQordm9pZCBpOTE1X2FjdGl2ZV9ub29wKHN0cnVjdCBkbWFfZmVuY2Ug
KmZlbmNlLCBzdHJ1Y3QgZG1hX2ZlbmNlX2NiICpjYikKIHsKLQkvKiBTcGFjZSBsZWZ0IGludGVu
dGlvbmFsbHkgYmxhbmsgKi8KKwlpOTE1X2FjdGl2ZV9mZW5jZV9jYihmZW5jZSwgY2IpOwogfQog
CiAjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfU0VMRlRFU1QpCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9hY3RpdmUuaAppbmRleCA5MDAzNGY2MWI3YzIuLjRmNTJmZTYxNDZkMiAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2FjdGl2ZS5oCkBAIC0xMiw2ICsxMiwxMCBAQAogI2luY2x1ZGUgImk5MTVf
YWN0aXZlX3R5cGVzLmgiCiAjaW5jbHVkZSAiaTkxNV9yZXF1ZXN0LmgiCiAKK3N0cnVjdCBpOTE1
X3JlcXVlc3Q7CitzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzOworc3RydWN0IGludGVsX3RpbWVsaW5l
OworCiAvKgogICogV2UgdHJlYXQgcmVxdWVzdHMgYXMgZmVuY2VzLiBUaGlzIGlzIG5vdCBiZSB0
byBjb25mdXNlZCB3aXRoIG91cgogICogImZlbmNlIHJlZ2lzdGVycyIgYnV0IHBpcGVsaW5lIHN5
bmNocm9uaXNhdGlvbiBvYmplY3RzIGFsYSBHTF9BUkJfc3luYy4KQEAgLTI4LDMwOCArMzIsMTA4
IEBACiAgKiB3cml0ZSBhY2Nlc3Mgc28gdGhhdCB3ZSBjYW4gcGVyZm9ybSBjb25jdXJyZW50IHJl
YWQgb3BlcmF0aW9ucyBiZXR3ZWVuCiAgKiB0aGUgQ1BVIGFuZCBHUFUgZW5naW5lcywgYXMgd2Vs
bCBhcyB3YWl0aW5nIGZvciBhbGwgcmVuZGVyaW5nIHRvCiAgKiBjb21wbGV0ZSwgb3Igd2FpdGlu
ZyBmb3IgdGhlIGxhc3QgR1BVIHVzZXIgb2YgYSAiZmVuY2UgcmVnaXN0ZXIiLiBUaGUKLSAqIG9i
amVjdCB0aGVuIGVtYmVkcyBhICNpOTE1X2FjdGl2ZV9yZXF1ZXN0IHRvIHRyYWNrIHRoZSBtb3N0
IHJlY2VudCAoaW4KKyAqIG9iamVjdCB0aGVuIGVtYmVkcyBhICNpOTE1X2FjdGl2ZV9mZW5jZSB0
byB0cmFjayB0aGUgbW9zdCByZWNlbnQgKGluCiAgKiByZXRpcmVtZW50IG9yZGVyKSByZXF1ZXN0
IHJlbGV2YW50IGZvciB0aGUgZGVzaXJlZCBtb2RlIG9mIGFjY2Vzcy4KLSAqIFRoZSAjaTkxNV9h
Y3RpdmVfcmVxdWVzdCBpcyB1cGRhdGVkIHdpdGggaTkxNV9hY3RpdmVfcmVxdWVzdF9zZXQoKSB0
bworICogVGhlICNpOTE1X2FjdGl2ZV9mZW5jZSBpcyB1cGRhdGVkIHdpdGggaTkxNV9hY3RpdmVf
ZmVuY2Vfc2V0KCkgdG8KICAqIHRyYWNrIHRoZSBtb3N0IHJlY2VudCBmZW5jZSByZXF1ZXN0LCB0
eXBpY2FsbHkgdGhpcyBpcyBkb25lIGFzIHBhcnQgb2YKICAqIGk5MTVfdm1hX21vdmVfdG9fYWN0
aXZlKCkuCiAgKgotICogV2hlbiB0aGUgI2k5MTVfYWN0aXZlX3JlcXVlc3QgY29tcGxldGVzIChp
cyByZXRpcmVkKSwgaXQgd2lsbAorICogV2hlbiB0aGUgI2k5MTVfYWN0aXZlX2ZlbmNlIGNvbXBs
ZXRlcyAoaXMgcmV0aXJlZCksIGl0IHdpbGwKICAqIHNpZ25hbCBpdHMgY29tcGxldGlvbiB0byB0
aGUgb3duZXIgdGhyb3VnaCBhIGNhbGxiYWNrIGFzIHdlbGwgYXMgbWFyawotICogaXRzZWxmIGFz
IGlkbGUgKGk5MTVfYWN0aXZlX3JlcXVlc3QucmVxdWVzdCA9PSBOVUxMKS4gVGhlIG93bmVyCisg
KiBpdHNlbGYgYXMgaWRsZSAoaTkxNV9hY3RpdmVfZmVuY2UucmVxdWVzdCA9PSBOVUxMKS4gVGhl
IG93bmVyCiAgKiBjYW4gdGhlbiBwZXJmb3JtIGFueSBhY3Rpb24sIHN1Y2ggYXMgZGVsYXllZCBm
cmVlaW5nIG9mIGFuIGFjdGl2ZQogICogcmVzb3VyY2UgaW5jbHVkaW5nIGl0c2VsZi4KICAqLwog
Ci12b2lkIGk5MTVfYWN0aXZlX3JldGlyZV9ub29wKHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0
ICphY3RpdmUsCi0JCQkgICAgIHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QpOwordm9pZCBp
OTE1X2FjdGl2ZV9ub29wKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLCBzdHJ1Y3QgZG1hX2ZlbmNl
X2NiICpjYik7CiAKIC8qKgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9pbml0IC0gcHJlcGFyZXMg
dGhlIGFjdGl2aXR5IHRyYWNrZXIgZm9yIHVzZQorICogX19pOTE1X2FjdGl2ZV9mZW5jZV9pbml0
IC0gcHJlcGFyZXMgdGhlIGFjdGl2aXR5IHRyYWNrZXIgZm9yIHVzZQogICogQGFjdGl2ZSAtIHRo
ZSBhY3RpdmUgdHJhY2tlcgotICogQHJxIC0gaW5pdGlhbCByZXF1ZXN0IHRvIHRyYWNrLCBjYW4g
YmUgTlVMTAorICogQGZlbmNlIC0gaW5pdGlhbCBmZW5jZSB0byB0cmFjaywgY2FuIGJlIE5VTEwK
ICAqIEBmdW5jIC0gYSBjYWxsYmFjayB3aGVuIHRoZW4gdGhlIHRyYWNrZXIgaXMgcmV0aXJlZCAo
YmVjb21lcyBpZGxlKSwKICAqICAgICAgICAgY2FuIGJlIE5VTEwKICAqCi0gKiBpOTE1X2FjdGl2
ZV9yZXF1ZXN0X2luaXQoKSBwcmVwYXJlcyB0aGUgZW1iZWRkZWQgQGFjdGl2ZSBzdHJ1Y3QgZm9y
IHVzZSBhcwotICogYW4gYWN0aXZpdHkgdHJhY2tlciwgdGhhdCBpcyBmb3IgdHJhY2tpbmcgdGhl
IGxhc3Qga25vd24gYWN0aXZlIHJlcXVlc3QKLSAqIGFzc29jaWF0ZWQgd2l0aCBpdC4gV2hlbiB0
aGUgbGFzdCByZXF1ZXN0IGJlY29tZXMgaWRsZSwgd2hlbiBpdCBpcyByZXRpcmVkCisgKiBpOTE1
X2FjdGl2ZV9mZW5jZV9pbml0KCkgcHJlcGFyZXMgdGhlIGVtYmVkZGVkIEBhY3RpdmUgc3RydWN0
IGZvciB1c2UgYXMKKyAqIGFuIGFjdGl2aXR5IHRyYWNrZXIsIHRoYXQgaXMgZm9yIHRyYWNraW5n
IHRoZSBsYXN0IGtub3duIGFjdGl2ZSBmZW5jZQorICogYXNzb2NpYXRlZCB3aXRoIGl0LiBXaGVu
IHRoZSBsYXN0IGZlbmNlIGJlY29tZXMgaWRsZSwgd2hlbiBpdCBpcyByZXRpcmVkCiAgKiBhZnRl
ciBjb21wbGV0aW9uLCB0aGUgb3B0aW9uYWwgY2FsbGJhY2sgQGZ1bmMgaXMgaW52b2tlZC4KICAq
Lwogc3RhdGljIGlubGluZSB2b2lkCi1pOTE1X2FjdGl2ZV9yZXF1ZXN0X2luaXQoc3RydWN0IGk5
MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSwKK19faTkxNV9hY3RpdmVfZmVuY2VfaW5pdChzdHJ1
Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2ZSwKIAkJCSBzdHJ1Y3QgbXV0ZXggKmxvY2ssCi0J
CQkgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCi0JCQkgaTkxNV9hY3RpdmVfcmV0aXJlX2ZuIHJl
dGlyZSkKKwkJCSB2b2lkICpmZW5jZSwKKwkJCSBkbWFfZmVuY2VfZnVuY190IGZuKQogewotCVJD
VV9JTklUX1BPSU5URVIoYWN0aXZlLT5yZXF1ZXN0LCBycSk7Ci0JSU5JVF9MSVNUX0hFQUQoJmFj
dGl2ZS0+bGluayk7Ci0JYWN0aXZlLT5yZXRpcmUgPSByZXRpcmUgPzogaTkxNV9hY3RpdmVfcmV0
aXJlX25vb3A7CisJUkNVX0lOSVRfUE9JTlRFUihhY3RpdmUtPmZlbmNlLCBmZW5jZSk7CisJYWN0
aXZlLT5jYi5mdW5jID0gZm4gPzogaTkxNV9hY3RpdmVfbm9vcDsKICNpZiBJU19FTkFCTEVEKENP
TkZJR19EUk1fSTkxNV9ERUJVR19HRU0pCiAJYWN0aXZlLT5sb2NrID0gbG9jazsKICNlbmRpZgog
fQogCi0jZGVmaW5lIElOSVRfQUNUSVZFX1JFUVVFU1QobmFtZSwgbG9jaykgXAotCWk5MTVfYWN0
aXZlX3JlcXVlc3RfaW5pdCgobmFtZSksIChsb2NrKSwgTlVMTCwgTlVMTCkKLQotLyoqCi0gKiBp
OTE1X2FjdGl2ZV9yZXF1ZXN0X3NldCAtIHVwZGF0ZXMgdGhlIHRyYWNrZXIgdG8gd2F0Y2ggdGhl
IGN1cnJlbnQgcmVxdWVzdAotICogQGFjdGl2ZSAtIHRoZSBhY3RpdmUgdHJhY2tlcgotICogQHJl
cXVlc3QgLSB0aGUgcmVxdWVzdCB0byB3YXRjaAotICoKLSAqIF9faTkxNV9hY3RpdmVfcmVxdWVz
dF9zZXQoKSB3YXRjaGVzIHRoZSBnaXZlbiBAcmVxdWVzdCBmb3IgY29tcGxldGlvbi4gV2hpbHN0
Ci0gKiB0aGF0IEByZXF1ZXN0IGlzIGJ1c3ksIHRoZSBAYWN0aXZlIHJlcG9ydHMgYnVzeS4gV2hl
biB0aGF0IEByZXF1ZXN0IGlzCi0gKiByZXRpcmVkLCB0aGUgQGFjdGl2ZSB0cmFja2VyIGlzIHVw
ZGF0ZWQgdG8gcmVwb3J0IGlkbGUuCi0gKi8KLXN0YXRpYyBpbmxpbmUgdm9pZAotX19pOTE1X2Fj
dGl2ZV9yZXF1ZXN0X3NldChzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLAotCQkJ
ICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0KQotewotI2lmIElTX0VOQUJMRUQoQ09ORklH
X0RSTV9JOTE1X0RFQlVHX0dFTSkKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKGFjdGl2ZS0+bG9jayk7
Ci0jZW5kaWYKLQlsaXN0X21vdmUoJmFjdGl2ZS0+bGluaywgJnJlcXVlc3QtPmFjdGl2ZV9saXN0
KTsKLQlyY3VfYXNzaWduX3BvaW50ZXIoYWN0aXZlLT5yZXF1ZXN0LCByZXF1ZXN0KTsKLX0KKyNk
ZWZpbmUgSU5JVF9BQ1RJVkVfRkVOQ0UoQSwgTE9DSykgXAorCV9faTkxNV9hY3RpdmVfZmVuY2Vf
aW5pdCgoQSksIChMT0NLKSwgTlVMTCwgTlVMTCkKIAotaW50IF9fbXVzdF9jaGVjawotaTkxNV9h
Y3RpdmVfcmVxdWVzdF9zZXQoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSwKLQkJ
CXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKTsKK3N0cnVjdCBkbWFfZmVuY2UgKgorX19pOTE1X2Fj
dGl2ZV9mZW5jZV9zZXQoc3RydWN0IGk5MTVfYWN0aXZlX2ZlbmNlICphY3RpdmUsCisJCQlzdHJ1
Y3QgZG1hX2ZlbmNlICpmZW5jZSk7CiAKIC8qKgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9yYXcg
LSByZXR1cm4gdGhlIGFjdGl2ZSByZXF1ZXN0CisgKiBpOTE1X2FjdGl2ZV9mZW5jZV9zZXQgLSB1
cGRhdGVzIHRoZSB0cmFja2VyIHRvIHdhdGNoIHRoZSBjdXJyZW50IGZlbmNlCiAgKiBAYWN0aXZl
IC0gdGhlIGFjdGl2ZSB0cmFja2VyCisgKiBAcnEgLSB0aGUgcmVxdWVzdCB0byB3YXRjaAogICoK
LSAqIGk5MTVfYWN0aXZlX3JlcXVlc3RfcmF3KCkgcmV0dXJucyB0aGUgY3VycmVudCByZXF1ZXN0
IGJlaW5nIHRyYWNrZWQsIG9yIE5VTEwuCi0gKiBJdCBkb2VzIG5vdCBvYnRhaW4gYSByZWZlcmVu
Y2Ugb24gdGhlIHJlcXVlc3QgZm9yIHRoZSBjYWxsZXIsIHNvIHRoZSBjYWxsZXIKLSAqIG11c3Qg
aG9sZCBzdHJ1Y3RfbXV0ZXguCisgKiBpOTE1X2FjdGl2ZV9mZW5jZV9zZXQoKSB3YXRjaGVzIHRo
ZSBnaXZlbiBAcnEgZm9yIGNvbXBsZXRpb24uIFdoaWxlCisgKiB0aGF0IEBycSBpcyBidXN5LCB0
aGUgQGFjdGl2ZSByZXBvcnRzIGJ1c3kuIFdoZW4gdGhhdCBAcnEgaXMgc2lnbmFsZWQKKyAqIChv
ciBlbHNlIHJldGlyZWQpIHRoZSBAYWN0aXZlIHRyYWNrZXIgaXMgdXBkYXRlZCB0byByZXBvcnQg
aWRsZS4KICAqLwotc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICoKLWk5MTVfYWN0
aXZlX3JlcXVlc3RfcmF3KGNvbnN0IHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUs
Ci0JCQlzdHJ1Y3QgbXV0ZXggKm11dGV4KQotewotCXJldHVybiByY3VfZGVyZWZlcmVuY2VfcHJv
dGVjdGVkKGFjdGl2ZS0+cmVxdWVzdCwKLQkJCQkJIGxvY2tkZXBfaXNfaGVsZChtdXRleCkpOwot
fQotCi0vKioKLSAqIGk5MTVfYWN0aXZlX3JlcXVlc3RfcGVlayAtIHJlcG9ydCB0aGUgYWN0aXZl
IHJlcXVlc3QgYmVpbmcgbW9uaXRvcmVkCi0gKiBAYWN0aXZlIC0gdGhlIGFjdGl2ZSB0cmFja2Vy
Ci0gKgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9wZWVrKCkgcmV0dXJucyB0aGUgY3VycmVudCBy
ZXF1ZXN0IGJlaW5nIHRyYWNrZWQgaWYKLSAqIHN0aWxsIGFjdGl2ZSwgb3IgTlVMTC4gSXQgZG9l
cyBub3Qgb2J0YWluIGEgcmVmZXJlbmNlIG9uIHRoZSByZXF1ZXN0Ci0gKiBmb3IgdGhlIGNhbGxl
ciwgc28gdGhlIGNhbGxlciBtdXN0IGhvbGQgc3RydWN0X211dGV4LgotICovCi1zdGF0aWMgaW5s
aW5lIHN0cnVjdCBpOTE1X3JlcXVlc3QgKgotaTkxNV9hY3RpdmVfcmVxdWVzdF9wZWVrKGNvbnN0
IHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCi0JCQkgc3RydWN0IG11dGV4ICpt
dXRleCkKLXsKLQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0OwotCi0JcmVxdWVzdCA9IGk5
MTVfYWN0aXZlX3JlcXVlc3RfcmF3KGFjdGl2ZSwgbXV0ZXgpOwotCWlmICghcmVxdWVzdCB8fCBp
OTE1X3JlcXVlc3RfY29tcGxldGVkKHJlcXVlc3QpKQotCQlyZXR1cm4gTlVMTDsKLQotCXJldHVy
biByZXF1ZXN0OwotfQotCi0vKioKLSAqIGk5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0IC0gcmV0dXJu
IGEgcmVmZXJlbmNlIHRvIHRoZSBhY3RpdmUgcmVxdWVzdAotICogQGFjdGl2ZSAtIHRoZSBhY3Rp
dmUgdHJhY2tlcgotICoKLSAqIGk5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0KCkgcmV0dXJucyBhIHJl
ZmVyZW5jZSB0byB0aGUgYWN0aXZlIHJlcXVlc3QsIG9yIE5VTEwKLSAqIGlmIHRoZSBhY3RpdmUg
dHJhY2tlciBpcyBpZGxlLiBUaGUgY2FsbGVyIG11c3QgaG9sZCBzdHJ1Y3RfbXV0ZXguCi0gKi8K
LXN0YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVfcmVxdWVzdCAqCi1pOTE1X2FjdGl2ZV9yZXF1ZXN0
X2dldChjb25zdCBzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLAotCQkJc3RydWN0
IG11dGV4ICptdXRleCkKLXsKLQlyZXR1cm4gaTkxNV9yZXF1ZXN0X2dldChpOTE1X2FjdGl2ZV9y
ZXF1ZXN0X3BlZWsoYWN0aXZlLCBtdXRleCkpOwotfQotCi0vKioKLSAqIF9faTkxNV9hY3RpdmVf
cmVxdWVzdF9nZXRfcmN1IC0gcmV0dXJuIGEgcmVmZXJlbmNlIHRvIHRoZSBhY3RpdmUgcmVxdWVz
dAotICogQGFjdGl2ZSAtIHRoZSBhY3RpdmUgdHJhY2tlcgotICoKLSAqIF9faTkxNV9hY3RpdmVf
cmVxdWVzdF9nZXQoKSByZXR1cm5zIGEgcmVmZXJlbmNlIHRvIHRoZSBhY3RpdmUgcmVxdWVzdCwK
LSAqIG9yIE5VTEwgaWYgdGhlIGFjdGl2ZSB0cmFja2VyIGlzIGlkbGUuIFRoZSBjYWxsZXIgbXVz
dCBob2xkIHRoZSBSQ1UgcmVhZAotICogbG9jaywgYnV0IHRoZSByZXR1cm5lZCBwb2ludGVyIGlz
IHNhZmUgdG8gdXNlIG91dHNpZGUgb2YgUkNVLgotICovCi1zdGF0aWMgaW5saW5lIHN0cnVjdCBp
OTE1X3JlcXVlc3QgKgotX19pOTE1X2FjdGl2ZV9yZXF1ZXN0X2dldF9yY3UoY29uc3Qgc3RydWN0
IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSkKLXsKLQkvKgotCSAqIFBlcmZvcm1pbmcgYSBs
b2NrbGVzcyByZXRyaWV2YWwgb2YgdGhlIGFjdGl2ZSByZXF1ZXN0IGlzIHN1cGVyCi0JICogdHJp
Y2t5LiBTTEFCX1RZUEVTQUZFX0JZX1JDVSBtZXJlbHkgZ3VhcmFudGVlcyB0aGF0IHRoZSBiYWNr
aW5nCi0JICogc2xhYiBvZiByZXF1ZXN0IG9iamVjdHMgd2lsbCBub3QgYmUgZnJlZWQgd2hpbHN0
IHdlIGhvbGQgdGhlCi0JICogUkNVIHJlYWQgbG9jay4gSXQgZG9lcyBub3QgZ3VhcmFudGVlIHRo
YXQgdGhlIHJlcXVlc3QgaXRzZWxmCi0JICogd2lsbCBub3QgYmUgZnJlZWQgYW5kIHRoZW4gKnJl
dXNlZCouIFZpeiwKLQkgKgotCSAqIFRocmVhZCBBCQkJVGhyZWFkIEIKLQkgKgotCSAqIHJxID0g
YWN0aXZlLnJlcXVlc3QKLQkgKgkJCQlyZXRpcmUocnEpIC0+IGZyZWUocnEpOwotCSAqCQkJCShy
cSBpcyBub3cgZmlyc3Qgb24gdGhlIHNsYWIgZnJlZWxpc3QpCi0JICoJCQkJYWN0aXZlLnJlcXVl
c3QgPSBOVUxMCi0JICoKLQkgKgkJCQlycSA9IG5ldyBzdWJtaXNzaW9uIG9uIGEgbmV3IG9iamVj
dAotCSAqIHJlZihycSkKLQkgKgotCSAqIFRvIHByZXZlbnQgdGhlIHJlcXVlc3QgZnJvbSBiZWlu
ZyByZXVzZWQgd2hpbHN0IHRoZSBjYWxsZXIKLQkgKiB1c2VzIGl0LCB3ZSB0YWtlIGEgcmVmZXJl
bmNlIGxpa2Ugbm9ybWFsLiBXaGlsc3QgYWNxdWlyaW5nCi0JICogdGhlIHJlZmVyZW5jZSB3ZSBj
aGVjayB0aGF0IGl0IGlzIG5vdCBpbiBhIGRlc3Ryb3llZCBzdGF0ZQotCSAqIChyZWZjbnQgPT0g
MCkuIFRoYXQgcHJldmVudHMgdGhlIHJlcXVlc3QgYmVpbmcgcmVhbGxvY2F0ZWQKLQkgKiB3aGls
c3QgdGhlIGNhbGxlciBob2xkcyBvbiB0byBpdC4gVG8gY2hlY2sgdGhhdCB0aGUgcmVxdWVzdAot
CSAqIHdhcyBub3QgcmVhbGxvY2F0ZWQgYXMgd2UgYWNxdWlyZWQgdGhlIHJlZmVyZW5jZSB3ZSBo
YXZlIHRvCi0JICogY2hlY2sgdGhhdCBvdXIgcmVxdWVzdCByZW1haW5zIHRoZSBhY3RpdmUgcmVx
dWVzdCBhY3Jvc3MKLQkgKiB0aGUgbG9va3VwLCBpbiB0aGUgc2FtZSBtYW5uZXIgYXMgYSBzZXFs
b2NrLiBUaGUgdmlzaWJpbGl0eQotCSAqIG9mIHRoZSBwb2ludGVyIHZlcnN1cyB0aGUgcmVmZXJl
bmNlIGNvdW50aW5nIGlzIGNvbnRyb2xsZWQKLQkgKiBieSB1c2luZyBSQ1UgYmFycmllcnMgKHJj
dV9kZXJlZmVyZW5jZSBhbmQgcmN1X2Fzc2lnbl9wb2ludGVyKS4KLQkgKgotCSAqIEluIHRoZSBt
aWRkbGUgb2YgYWxsIHRoYXQsIHdlIGluc3BlY3Qgd2hldGhlciB0aGUgcmVxdWVzdCBpcwotCSAq
IGNvbXBsZXRlLiBSZXRpcmluZyBpcyBsYXp5IHNvIHRoZSByZXF1ZXN0IG1heSBiZSBjb21wbGV0
ZWQgbG9uZwotCSAqIGJlZm9yZSB0aGUgYWN0aXZlIHRyYWNrZXIgaXMgdXBkYXRlZC4gUXVlcnlp
bmcgd2hldGhlciB0aGUKLQkgKiByZXF1ZXN0IGlzIGNvbXBsZXRlIGlzIGZhciBjaGVhcGVyIChh
cyBpdCBpbnZvbHZlcyBubyBsb2NrZWQKLQkgKiBpbnN0cnVjdGlvbnMgc2V0dGluZyBjYWNoZWxp
bmVzIHRvIGV4Y2x1c2l2ZSkgdGhhbiBhY3F1aXJpbmcKLQkgKiB0aGUgcmVmZXJlbmNlLCBzbyB3
ZSBkbyBpdCBmaXJzdC4gVGhlIFJDVSByZWFkIGxvY2sgZW5zdXJlcyB0aGUKLQkgKiBwb2ludGVy
IGRlcmVmZXJlbmNlIGlzIHZhbGlkLCBidXQgZG9lcyBub3QgZW5zdXJlIHRoYXQgdGhlCi0JICog
c2Vxbm8gbm9yIEhXUyBpcyB0aGUgcmlnaHQgb25lISBIb3dldmVyLCBpZiB0aGUgcmVxdWVzdCB3
YXMKLQkgKiByZWFsbG9jYXRlZCwgdGhhdCBtZWFucyB0aGUgYWN0aXZlIHRyYWNrZXIncyByZXF1
ZXN0IHdhcyBjb21wbGV0ZS4KLQkgKiBJZiB0aGUgbmV3IHJlcXVlc3QgaXMgYWxzbyBjb21wbGV0
ZSwgdGhlbiBib3RoIGFyZSBhbmQgd2UgY2FuCi0JICoganVzdCByZXBvcnQgdGhlIGFjdGl2ZSB0
cmFja2VyIGlzIGlkbGUuIElmIHRoZSBuZXcgcmVxdWVzdCBpcwotCSAqIGluY29tcGxldGUsIHRo
ZW4gd2UgYWNxdWlyZSBhIHJlZmVyZW5jZSBvbiBpdCBhbmQgY2hlY2sgdGhhdAotCSAqIGl0IHJl
bWFpbmVkIHRoZSBhY3RpdmUgcmVxdWVzdC4KLQkgKgotCSAqIEl0IGlzIHRoZW4gaW1wZXJhdGl2
ZSB0aGF0IHdlIGRvIG5vdCB6ZXJvIHRoZSByZXF1ZXN0IG9uCi0JICogcmVhbGxvY2F0aW9uLCBz
byB0aGF0IHdlIGNhbiBjaGFzZSB0aGUgZGFuZ2xpbmcgcG9pbnRlcnMhCi0JICogU2VlIGk5MTVf
cmVxdWVzdF9hbGxvYygpLgotCSAqLwotCWRvIHsKLQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVx
dWVzdDsKLQotCQlyZXF1ZXN0ID0gcmN1X2RlcmVmZXJlbmNlKGFjdGl2ZS0+cmVxdWVzdCk7Ci0J
CWlmICghcmVxdWVzdCB8fCBpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJlcXVlc3QpKQotCQkJcmV0
dXJuIE5VTEw7Ci0KLQkJLyoKLQkJICogQW4gZXNwZWNpYWxseSBzaWxseSBjb21waWxlciBjb3Vs
ZCBkZWNpZGUgdG8gcmVjb21wdXRlIHRoZQotCQkgKiByZXN1bHQgb2YgaTkxNV9yZXF1ZXN0X2Nv
bXBsZXRlZCwgbW9yZSBzcGVjaWZpY2FsbHkKLQkJICogcmUtZW1pdCB0aGUgbG9hZCBmb3IgcmVx
dWVzdC0+ZmVuY2Uuc2Vxbm8uIEEgcmFjZSB3b3VsZCBjYXRjaAotCQkgKiBhIGxhdGVyIHNlcW5v
IHZhbHVlLCB3aGljaCBjb3VsZCBmbGlwIHRoZSByZXN1bHQgZnJvbSB0cnVlIHRvCi0JCSAqIGZh
bHNlLiBXaGljaCBtZWFucyBwYXJ0IG9mIHRoZSBpbnN0cnVjdGlvbnMgYmVsb3cgbWlnaHQgbm90
Ci0JCSAqIGJlIGV4ZWN1dGVkLCB3aGlsZSBsYXRlciBvbiBpbnN0cnVjdGlvbnMgYXJlIGV4ZWN1
dGVkLiBEdWUgdG8KLQkJICogYmFycmllcnMgd2l0aGluIHRoZSByZWZjb3VudGluZyB0aGUgaW5j
b25zaXN0ZW5jeSBjYW4ndCByZWFjaAotCQkgKiBwYXN0IHRoZSBjYWxsIHRvIGk5MTVfcmVxdWVz
dF9nZXRfcmN1LCBidXQgbm90IGV4ZWN1dGluZwotCQkgKiB0aGF0IHdoaWxlIHN0aWxsIGV4ZWN1
dGluZyBpOTE1X3JlcXVlc3RfcHV0KCkgY3JlYXRlcwotCQkgKiBoYXZvYyBlbm91Z2guICBQcmV2
ZW50IHRoaXMgd2l0aCBhIGNvbXBpbGVyIGJhcnJpZXIuCi0JCSAqLwotCQliYXJyaWVyKCk7Ci0K
LQkJcmVxdWVzdCA9IGk5MTVfcmVxdWVzdF9nZXRfcmN1KHJlcXVlc3QpOwotCi0JCS8qCi0JCSAq
IFdoYXQgc3RvcHMgdGhlIGZvbGxvd2luZyByY3VfYWNjZXNzX3BvaW50ZXIoKSBmcm9tIG9jY3Vy
cmluZwotCQkgKiBiZWZvcmUgdGhlIGFib3ZlIGk5MTVfcmVxdWVzdF9nZXRfcmN1KCk/IElmIHdl
IHdlcmUKLQkJICogdG8gcmVhZCB0aGUgdmFsdWUgYmVmb3JlIHBhdXNpbmcgdG8gZ2V0IHRoZSBy
ZWZlcmVuY2UgdG8KLQkJICogdGhlIHJlcXVlc3QsIHdlIG1heSBub3Qgbm90aWNlIGEgY2hhbmdl
IGluIHRoZSBhY3RpdmUKLQkJICogdHJhY2tlci4KLQkJICoKLQkJICogVGhlIHJjdV9hY2Nlc3Nf
cG9pbnRlcigpIGlzIGEgbWVyZSBjb21waWxlciBiYXJyaWVyLCB3aGljaAotCQkgKiBtZWFucyBi
b3RoIHRoZSBDUFUgYW5kIGNvbXBpbGVyIGFyZSBmcmVlIHRvIHBlcmZvcm0gdGhlCi0JCSAqIG1l
bW9yeSByZWFkIHdpdGhvdXQgY29uc3RyYWludC4gVGhlIGNvbXBpbGVyIG9ubHkgaGFzIHRvCi0J
CSAqIGVuc3VyZSB0aGF0IGFueSBvcGVyYXRpb25zIGFmdGVyIHRoZSByY3VfYWNjZXNzX3BvaW50
ZXIoKQotCQkgKiBvY2N1ciBhZnRlcndhcmRzIGluIHByb2dyYW0gb3JkZXIuIFRoaXMgbWVhbnMg
dGhlIHJlYWQgbWF5Ci0JCSAqIGJlIHBlcmZvcm1lZCBlYXJsaWVyIGJ5IGFuIG91dC1vZi1vcmRl
ciBDUFUsIG9yIGFkdmVudHVyb3VzCi0JCSAqIGNvbXBpbGVyLgotCQkgKgotCQkgKiBUaGUgYXRv
bWljIG9wZXJhdGlvbiBhdCB0aGUgaGVhcnQgb2YKLQkJICogaTkxNV9yZXF1ZXN0X2dldF9yY3Uo
KSwgc2VlIGRtYV9mZW5jZV9nZXRfcmN1KCksIGlzCi0JCSAqIGF0b21pY19pbmNfbm90X3plcm8o
KSB3aGljaCBpcyBvbmx5IGEgZnVsbCBtZW1vcnkgYmFycmllcgotCQkgKiB3aGVuIHN1Y2Nlc3Nm
dWwuIFRoYXQgaXMsIGlmIGk5MTVfcmVxdWVzdF9nZXRfcmN1KCkKLQkJICogcmV0dXJucyB0aGUg
cmVxdWVzdCAoYW5kIHNvIHdpdGggdGhlIHJlZmVyZW5jZSBjb3VudGVkCi0JCSAqIGluY3JlbWVu
dGVkKSB0aGVuIHRoZSBmb2xsb3dpbmcgcmVhZCBmb3IgcmN1X2FjY2Vzc19wb2ludGVyKCkKLQkJ
ICogbXVzdCBvY2N1ciBhZnRlciB0aGUgYXRvbWljIG9wZXJhdGlvbiBhbmQgc28gY29uZmlybQot
CQkgKiB0aGF0IHRoaXMgcmVxdWVzdCBpcyB0aGUgb25lIGN1cnJlbnRseSBiZWluZyB0cmFja2Vk
LgotCQkgKgotCQkgKiBUaGUgY29ycmVzcG9uZGluZyB3cml0ZSBiYXJyaWVyIGlzIHBhcnQgb2YK
LQkJICogcmN1X2Fzc2lnbl9wb2ludGVyKCkuCi0JCSAqLwotCQlpZiAoIXJlcXVlc3QgfHwgcmVx
dWVzdCA9PSByY3VfYWNjZXNzX3BvaW50ZXIoYWN0aXZlLT5yZXF1ZXN0KSkKLQkJCXJldHVybiBy
Y3VfcG9pbnRlcl9oYW5kb2ZmKHJlcXVlc3QpOwotCi0JCWk5MTVfcmVxdWVzdF9wdXQocmVxdWVz
dCk7Ci0JfSB3aGlsZSAoMSk7Ci19Ci0KK2ludCBfX211c3RfY2hlY2sKK2k5MTVfYWN0aXZlX2Zl
bmNlX3NldChzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2ZSwKKwkJICAgICAgc3RydWN0
IGk5MTVfcmVxdWVzdCAqcnEpOwogLyoqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X2dldF91bmxv
Y2tlZCAtIHJldHVybiBhIHJlZmVyZW5jZSB0byB0aGUgYWN0aXZlIHJlcXVlc3QKKyAqIGk5MTVf
YWN0aXZlX2ZlbmNlX2dldCAtIHJldHVybiBhIHJlZmVyZW5jZSB0byB0aGUgYWN0aXZlIGZlbmNl
CiAgKiBAYWN0aXZlIC0gdGhlIGFjdGl2ZSB0cmFja2VyCiAgKgotICogaTkxNV9hY3RpdmVfcmVx
dWVzdF9nZXRfdW5sb2NrZWQoKSByZXR1cm5zIGEgcmVmZXJlbmNlIHRvIHRoZSBhY3RpdmUgcmVx
dWVzdCwKKyAqIGk5MTVfYWN0aXZlX2ZlbmNlX2dldCgpIHJldHVybnMgYSByZWZlcmVuY2UgdG8g
dGhlIGFjdGl2ZSBmZW5jZSwKICAqIG9yIE5VTEwgaWYgdGhlIGFjdGl2ZSB0cmFja2VyIGlzIGlk
bGUuIFRoZSByZWZlcmVuY2UgaXMgb2J0YWluZWQgdW5kZXIgUkNVLAogICogc28gbm8gbG9ja2lu
ZyBpcyByZXF1aXJlZCBieSB0aGUgY2FsbGVyLgogICoKLSAqIFRoZSByZWZlcmVuY2Ugc2hvdWxk
IGJlIGZyZWVkIHdpdGggaTkxNV9yZXF1ZXN0X3B1dCgpLgorICogVGhlIHJlZmVyZW5jZSBzaG91
bGQgYmUgZnJlZWQgd2l0aCBkbWFfZmVuY2VfcHV0KCkuCiAgKi8KLXN0YXRpYyBpbmxpbmUgc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqCi1pOTE1X2FjdGl2ZV9yZXF1ZXN0X2dldF91bmxvY2tlZChjb25z
dCBzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlKQorc3RhdGljIGlubGluZSBzdHJ1
Y3QgZG1hX2ZlbmNlICoKK2k5MTVfYWN0aXZlX2ZlbmNlX2dldChzdHJ1Y3QgaTkxNV9hY3RpdmVf
ZmVuY2UgKmFjdGl2ZSkKIHsKLQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0OworCXN0cnVj
dCBkbWFfZmVuY2UgKmZlbmNlOwogCiAJcmN1X3JlYWRfbG9jaygpOwotCXJlcXVlc3QgPSBfX2k5
MTVfYWN0aXZlX3JlcXVlc3RfZ2V0X3JjdShhY3RpdmUpOworCWZlbmNlID0gZG1hX2ZlbmNlX2dl
dF9yY3Vfc2FmZSgmYWN0aXZlLT5mZW5jZSk7CiAJcmN1X3JlYWRfdW5sb2NrKCk7CiAKLQlyZXR1
cm4gcmVxdWVzdDsKKwlyZXR1cm4gZmVuY2U7CiB9CiAKIC8qKgotICogaTkxNV9hY3RpdmVfcmVx
dWVzdF9pc3NldCAtIHJlcG9ydCB3aGV0aGVyIHRoZSBhY3RpdmUgdHJhY2tlciBpcyBhc3NpZ25l
ZAorICogaTkxNV9hY3RpdmVfZmVuY2VfaXNzZXQgLSByZXBvcnQgd2hldGhlciB0aGUgYWN0aXZl
IHRyYWNrZXIgaXMgYXNzaWduZWQKICAqIEBhY3RpdmUgLSB0aGUgYWN0aXZlIHRyYWNrZXIKICAq
Ci0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X2lzc2V0KCkgcmV0dXJucyB0cnVlIGlmIHRoZSBhY3Rp
dmUgdHJhY2tlciBpcyBjdXJyZW50bHkKLSAqIGFzc2lnbmVkIHRvIGEgcmVxdWVzdC4gRHVlIHRv
IHRoZSBsYXp5IHJldGlyaW5nLCB0aGF0IHJlcXVlc3QgbWF5IGJlIGlkbGUKKyAqIGk5MTVfYWN0
aXZlX2ZlbmNlX2lzc2V0KCkgcmV0dXJucyB0cnVlIGlmIHRoZSBhY3RpdmUgdHJhY2tlciBpcyBj
dXJyZW50bHkKKyAqIGFzc2lnbmVkIHRvIGEgZmVuY2UuIER1ZSB0byB0aGUgbGF6eSByZXRpcmlu
ZywgdGhhdCBmZW5jZSBtYXkgYmUgaWRsZQogICogYW5kIHRoaXMgbWF5IHJlcG9ydCBzdGFsZSBp
bmZvcm1hdGlvbi4KICAqLwogc3RhdGljIGlubGluZSBib29sCi1pOTE1X2FjdGl2ZV9yZXF1ZXN0
X2lzc2V0KGNvbnN0IHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUpCitpOTE1X2Fj
dGl2ZV9mZW5jZV9pc3NldChjb25zdCBzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2ZSkK
IHsKLQlyZXR1cm4gcmN1X2FjY2Vzc19wb2ludGVyKGFjdGl2ZS0+cmVxdWVzdCk7CisJcmV0dXJu
IHJjdV9hY2Nlc3NfcG9pbnRlcihhY3RpdmUtPmZlbmNlKTsKIH0KIAotLyoqCi0gKiBpOTE1X2Fj
dGl2ZV9yZXF1ZXN0X3JldGlyZSAtIHdhaXRzIHVudGlsIHRoZSByZXF1ZXN0IGlzIHJldGlyZWQK
LSAqIEBhY3RpdmUgLSB0aGUgYWN0aXZlIHJlcXVlc3Qgb24gd2hpY2ggdG8gd2FpdAotICoKLSAq
IGk5MTVfYWN0aXZlX3JlcXVlc3RfcmV0aXJlKCkgd2FpdHMgdW50aWwgdGhlIHJlcXVlc3QgaXMg
Y29tcGxldGVkLAotICogYW5kIHRoZW4gZW5zdXJlcyB0aGF0IGF0IGxlYXN0IHRoZSByZXRpcmVt
ZW50IGhhbmRsZXIgZm9yIHRoaXMKLSAqIEBhY3RpdmUgdHJhY2tlciBpcyBjYWxsZWQgYmVmb3Jl
IHJldHVybmluZy4gSWYgdGhlIEBhY3RpdmUKLSAqIHRyYWNrZXIgaXMgaWRsZSwgdGhlIGZ1bmN0
aW9uIHJldHVybnMgaW1tZWRpYXRlbHkuCi0gKi8KLXN0YXRpYyBpbmxpbmUgaW50IF9fbXVzdF9j
aGVjawotaTkxNV9hY3RpdmVfcmVxdWVzdF9yZXRpcmUoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVl
c3QgKmFjdGl2ZSwKLQkJCSAgIHN0cnVjdCBtdXRleCAqbXV0ZXgpCitzdGF0aWMgaW5saW5lIHZv
aWQKK2k5MTVfYWN0aXZlX2ZlbmNlX2NiKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLCBzdHJ1Y3Qg
ZG1hX2ZlbmNlX2NiICpjYikKIHsKLQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0OwotCWxv
bmcgcmV0OwotCi0JcmVxdWVzdCA9IGk5MTVfYWN0aXZlX3JlcXVlc3RfcmF3KGFjdGl2ZSwgbXV0
ZXgpOwotCWlmICghcmVxdWVzdCkKLQkJcmV0dXJuIDA7Ci0KLQlyZXQgPSBpOTE1X3JlcXVlc3Rf
d2FpdChyZXF1ZXN0LAotCQkJCUk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFLAotCQkJCU1BWF9TQ0hF
RFVMRV9USU1FT1VUKTsKLQlpZiAocmV0IDwgMCkKLQkJcmV0dXJuIHJldDsKKwlzdHJ1Y3QgaTkx
NV9hY3RpdmVfZmVuY2UgKmFjdGl2ZSA9CisJCWNvbnRhaW5lcl9vZihjYiwgdHlwZW9mKCphY3Rp
dmUpLCBjYik7CiAKLQlsaXN0X2RlbF9pbml0KCZhY3RpdmUtPmxpbmspOwotCVJDVV9JTklUX1BP
SU5URVIoYWN0aXZlLT5yZXF1ZXN0LCBOVUxMKTsKLQotCWFjdGl2ZS0+cmV0aXJlKGFjdGl2ZSwg
cmVxdWVzdCk7Ci0KLQlyZXR1cm4gMDsKKwlSQ1VfSU5JVF9QT0lOVEVSKGFjdGl2ZS0+ZmVuY2Us
IE5VTEwpOwogfQogCiAvKgpAQCAtMzU4LDQ3ICsxNjIsNDAgQEAgaTkxNV9hY3RpdmVfcmVxdWVz
dF9yZXRpcmUoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSwKICAqIHN5bmNocm9u
aXNhdGlvbi4KICAqLwogCi12b2lkIF9faTkxNV9hY3RpdmVfaW5pdChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKLQkJCXN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLAordm9pZCBfX2k5MTVf
YWN0aXZlX2luaXQoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCiAJCQlpbnQgKCphY3RpdmUpKHN0
cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKSwKIAkJCXZvaWQgKCpyZXRpcmUpKHN0cnVjdCBpOTE1X2Fj
dGl2ZSAqcmVmKSwKIAkJCXN0cnVjdCBsb2NrX2NsYXNzX2tleSAqa2V5KTsKLSNkZWZpbmUgaTkx
NV9hY3RpdmVfaW5pdChpOTE1LCByZWYsIGFjdGl2ZSwgcmV0aXJlKSBkbyB7CQlcCisjZGVmaW5l
IGk5MTVfYWN0aXZlX2luaXQocmVmLCBhY3RpdmUsIHJldGlyZSkgZG8gewkJXAogCXN0YXRpYyBz
dHJ1Y3QgbG9ja19jbGFzc19rZXkgX19rZXk7CQkJCVwKIAkJCQkJCQkJCVwKLQlfX2k5MTVfYWN0
aXZlX2luaXQoaTkxNSwgcmVmLCBhY3RpdmUsIHJldGlyZSwgJl9fa2V5KTsJCVwKKwlfX2k5MTVf
YWN0aXZlX2luaXQocmVmLCBhY3RpdmUsIHJldGlyZSwgJl9fa2V5KTsJCVwKIH0gd2hpbGUgKDAp
CiAKIGludCBpOTE1X2FjdGl2ZV9yZWYoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCiAJCSAgICBz
dHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsLAotCQkgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEp
OworCQkgICAgc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpOwogCiBzdGF0aWMgaW5saW5lIGludAog
aTkxNV9hY3RpdmVfYWRkX3JlcXVlc3Qoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsIHN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxKQogewotCXJldHVybiBpOTE1X2FjdGl2ZV9yZWYocmVmLCBpOTE1X3Jl
cXVlc3RfdGltZWxpbmUocnEpLCBycSk7CisJcmV0dXJuIGk5MTVfYWN0aXZlX3JlZihyZWYsIGk5
MTVfcmVxdWVzdF90aW1lbGluZShycSksICZycS0+ZmVuY2UpOwogfQogCiB2b2lkIGk5MTVfYWN0
aXZlX3NldF9leGNsdXNpdmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsIHN0cnVjdCBkbWFfZmVu
Y2UgKmYpOwogCiBzdGF0aWMgaW5saW5lIGJvb2wgaTkxNV9hY3RpdmVfaGFzX2V4Y2x1c2l2ZShz
dHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIHsKLQlyZXR1cm4gcmN1X2FjY2Vzc19wb2ludGVyKHJl
Zi0+ZXhjbCk7CisJcmV0dXJuIHJjdV9hY2Nlc3NfcG9pbnRlcihyZWYtPmV4Y2wuZmVuY2UpOwog
fQogCiBpbnQgaTkxNV9hY3RpdmVfd2FpdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7CiAKLWlu
dCBpOTE1X3JlcXVlc3RfYXdhaXRfYWN0aXZlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAotCQkJ
ICAgICAgc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpOwotaW50IGk5MTVfcmVxdWVzdF9hd2FpdF9h
Y3RpdmVfcmVxdWVzdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKLQkJCQkgICAgICBzdHJ1Y3Qg
aTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlKTsKK2ludCBpOTE1X3JlcXVlc3RfYXdhaXRfYWN0
aXZlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7CiAK
IGludCBpOTE1X2FjdGl2ZV9hY3F1aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsKK2Jvb2wg
aTkxNV9hY3RpdmVfYWNxdWlyZV9pZl9idXN5KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsKIHZv
aWQgaTkxNV9hY3RpdmVfcmVsZWFzZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7Ci12b2lkIF9f
aTkxNV9hY3RpdmVfcmVsZWFzZV9uZXN0ZWQoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsIGludCBz
dWJjbGFzcyk7Ci0KLWJvb2wgaTkxNV9hY3RpdmVfdHJ5Z3JhYihzdHJ1Y3QgaTkxNV9hY3RpdmUg
KnJlZik7Ci12b2lkIGk5MTVfYWN0aXZlX3VuZ3JhYihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7
CiAKIHN0YXRpYyBpbmxpbmUgYm9vbAogaTkxNV9hY3RpdmVfaXNfaWRsZShjb25zdCBzdHJ1Y3Qg
aTkxNV9hY3RpdmUgKnJlZikKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
YWN0aXZlX3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZV90eXBlcy5o
CmluZGV4IDAyMTE2N2YwMDA0ZC4uZDg5YTc0YzE0MmM2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2FjdGl2ZV90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfYWN0aXZlX3R5cGVzLmgKQEAgLTE3LDE3ICsxNyw5IEBACiAKICNpbmNsdWRlICJpOTE1
X3V0aWxzLmgiCiAKLXN0cnVjdCBkcm1faTkxNV9wcml2YXRlOwotc3RydWN0IGk5MTVfYWN0aXZl
X3JlcXVlc3Q7Ci1zdHJ1Y3QgaTkxNV9yZXF1ZXN0OwotCi10eXBlZGVmIHZvaWQgKCppOTE1X2Fj
dGl2ZV9yZXRpcmVfZm4pKHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICosCi0JCQkJICAgICAg
c3RydWN0IGk5MTVfcmVxdWVzdCAqKTsKLQotc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3Qgewot
CXN0cnVjdCBpOTE1X3JlcXVlc3QgX19yY3UgKnJlcXVlc3Q7Ci0Jc3RydWN0IGxpc3RfaGVhZCBs
aW5rOwotCWk5MTVfYWN0aXZlX3JldGlyZV9mbiByZXRpcmU7CitzdHJ1Y3QgaTkxNV9hY3RpdmVf
ZmVuY2UgeworCXN0cnVjdCBkbWFfZmVuY2UgX19yY3UgKmZlbmNlOworCXN0cnVjdCBkbWFfZmVu
Y2VfY2IgY2I7CiAjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfREVCVUdfR0VNKQogCS8q
CiAJICogSW5jb3Jwb3JlYWwhCkBAIC01MywyMCArNDUsMTcgQEAgc3RydWN0IGFjdGl2ZV9ub2Rl
OwogI2RlZmluZSBpOTE1X2FjdGl2ZV9tYXlfc2xlZXAoZm4pIHB0cl9wYWNrX2JpdHMoJihmbiks
IEk5MTVfQUNUSVZFX01BWV9TTEVFUCwgMikKIAogc3RydWN0IGk5MTVfYWN0aXZlIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNTsKKwlhdG9taWNfdCBjb3VudDsKKwlzdHJ1Y3QgbXV0
ZXggbXV0ZXg7CiAKIAlzdHJ1Y3QgYWN0aXZlX25vZGUgKmNhY2hlOwogCXN0cnVjdCByYl9yb290
IHRyZWU7Ci0Jc3RydWN0IG11dGV4IG11dGV4OwotCWF0b21pY190IGNvdW50OwogCiAJLyogUHJl
YWxsb2NhdGVkICJleGNsdXNpdmUiIG5vZGUgKi8KLQlzdHJ1Y3QgZG1hX2ZlbmNlIF9fcmN1ICpl
eGNsOwotCXN0cnVjdCBkbWFfZmVuY2VfY2IgZXhjbF9jYjsKKwlzdHJ1Y3QgaTkxNV9hY3RpdmVf
ZmVuY2UgZXhjbDsKIAogCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CiAjZGVmaW5lIEk5MTVfQUNUSVZF
X1JFVElSRV9TTEVFUFMgQklUKDApCi0jZGVmaW5lIEk5MTVfQUNUSVZFX0dSQUJfQklUIDEKIAog
CWludCAoKmFjdGl2ZSkoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpOwogCXZvaWQgKCpyZXRpcmUp
KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IGY1
MDA1OGNmOGFiOC4uNjQ4OTA2MjdkNjM4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTg5
MiwyOCArODkyLDM4IEBAIHdhaXRfZm9yX3RpbWVsaW5lcyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCB1
bnNpZ25lZCBpbnQgd2FpdCwgbG9uZyB0aW1lb3V0KQogCiAJc3Bpbl9sb2NrX2lycXNhdmUoJnRp
bWVsaW5lcy0+bG9jaywgZmxhZ3MpOwogCWxpc3RfZm9yX2VhY2hfZW50cnkodGwsICZ0aW1lbGlu
ZXMtPmFjdGl2ZV9saXN0LCBsaW5rKSB7Ci0JCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCQlz
dHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKIAotCQlycSA9IGk5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0
X3VubG9ja2VkKCZ0bC0+bGFzdF9yZXF1ZXN0KTsKLQkJaWYgKCFycSkKKwkJZmVuY2UgPSBpOTE1
X2FjdGl2ZV9mZW5jZV9nZXQoJnRsLT5sYXN0X3JlcXVlc3QpOworCQlpZiAoIWZlbmNlKQogCQkJ
Y29udGludWU7CiAKIAkJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgmdGltZWxpbmVzLT5sb2NrLCBm
bGFncyk7CiAKLQkJLyoKLQkJICogIlJhY2UtdG8taWRsZSIuCi0JCSAqCi0JCSAqIFN3aXRjaGlu
ZyB0byB0aGUga2VybmVsIGNvbnRleHQgaXMgb2Z0ZW4gdXNlZCBhIHN5bmNocm9ub3VzCi0JCSAq
IHN0ZXAgcHJpb3IgdG8gaWRsaW5nLCBlLmcuIGluIHN1c3BlbmQgZm9yIGZsdXNoaW5nIGFsbAot
CQkgKiBjdXJyZW50IG9wZXJhdGlvbnMgdG8gbWVtb3J5IGJlZm9yZSBzbGVlcGluZy4gVGhlc2Ug
d2UKLQkJICogd2FudCB0byBjb21wbGV0ZSBhcyBxdWlja2x5IGFzIHBvc3NpYmxlIHRvIGF2b2lk
IHByb2xvbmdlZAotCQkgKiBzdGFsbHMsIHNvIGFsbG93IHRoZSBncHUgdG8gYm9vc3QgdG8gbWF4
aW11bSBjbG9ja3MuCi0JCSAqLwotCQlpZiAod2FpdCAmIEk5MTVfV0FJVF9GT1JfSURMRV9CT09T
VCkKLQkJCWdlbjZfcnBzX2Jvb3N0KHJxKTsKKwkJaWYgKCFkbWFfZmVuY2VfaXNfaTkxNShmZW5j
ZSkpIHsKKwkJCXRpbWVvdXQgPSBkbWFfZmVuY2Vfd2FpdF90aW1lb3V0KGZlbmNlLAorCQkJCQkJ
CSBmbGFncyAmIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFLAorCQkJCQkJCSB0aW1lb3V0KTsKKwkJ
fSBlbHNlIHsKKwkJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxID0gdG9fcmVxdWVzdChmZW5jZSk7
CisKKwkJCS8qCisJCQkgKiAiUmFjZS10by1pZGxlIi4KKwkJCSAqCisJCQkgKiBTd2l0Y2hpbmcg
dG8gdGhlIGtlcm5lbCBjb250ZXh0IGlzIG9mdGVuIHVzZWQgYXMKKwkJCSAqIGEgc3luY2hyb25v
dXMgc3RlcCBwcmlvciB0byBpZGxpbmcsIGUuZy4gaW4gc3VzcGVuZAorCQkJICogZm9yIGZsdXNo
aW5nIGFsbCBjdXJyZW50IG9wZXJhdGlvbnMgdG8gbWVtb3J5IGJlZm9yZQorCQkJICogc2xlZXBp
bmcuIFRoZXNlIHdlIHdhbnQgdG8gY29tcGxldGUgYXMgcXVpY2tseSBhcworCQkJICogcG9zc2li
bGUgdG8gYXZvaWQgcHJvbG9uZ2VkIHN0YWxscywgc28gYWxsb3cgdGhlIGdwdQorCQkJICogdG8g
Ym9vc3QgdG8gbWF4aW11bSBjbG9ja3MuCisJCQkgKi8KKwkJCWlmIChmbGFncyAmIEk5MTVfV0FJ
VF9GT1JfSURMRV9CT09TVCkKKwkJCQlnZW42X3Jwc19ib29zdChycSk7CisKKwkJCXRpbWVvdXQg
PSBpOTE1X3JlcXVlc3Rfd2FpdChycSwgZmxhZ3MsIHRpbWVvdXQpOworCQl9CiAKLQkJdGltZW91
dCA9IGk5MTVfcmVxdWVzdF93YWl0KHJxLCB3YWl0LCB0aW1lb3V0KTsKLQkJaTkxNV9yZXF1ZXN0
X3B1dChycSk7CisJCWRtYV9mZW5jZV9wdXQoZmVuY2UpOwogCQlpZiAodGltZW91dCA8IDApCiAJ
CQlyZXR1cm4gdGltZW91dDsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwppbmRleCA1
NWNlYmYyNTZkMDMuLjc0NjJkODdmN2E0OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW1fZ3R0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0
LmMKQEAgLTE4NjEsNyArMTg2MSw2IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaTkxNV92bWFfb3Bz
IHBkX3ZtYV9vcHMgPSB7CiAKIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKnBkX3ZtYV9jcmVhdGUo
c3RydWN0IGdlbjZfcHBndHQgKnBwZ3R0LCBpbnQgc2l6ZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHBwZ3R0LT5iYXNlLnZtLmk5MTU7CiAJc3RydWN0IGk5MTVfZ2d0dCAq
Z2d0dCA9IHBwZ3R0LT5iYXNlLnZtLmd0LT5nZ3R0OwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwog
CkBAIC0xODcyLDcgKzE4NzEsNyBAQCBzdGF0aWMgc3RydWN0IGk5MTVfdm1hICpwZF92bWFfY3Jl
YXRlKHN0cnVjdCBnZW42X3BwZ3R0ICpwcGd0dCwgaW50IHNpemUpCiAJaWYgKCF2bWEpCiAJCXJl
dHVybiBFUlJfUFRSKC1FTk9NRU0pOwogCi0JaTkxNV9hY3RpdmVfaW5pdChpOTE1LCAmdm1hLT5h
Y3RpdmUsIE5VTEwsIE5VTEwpOworCWk5MTVfYWN0aXZlX2luaXQoJnZtYS0+YWN0aXZlLCBOVUxM
LCBOVUxMKTsKIAogCW11dGV4X2luaXQoJnZtYS0+cGFnZXNfbXV0ZXgpOwogCXZtYS0+dm0gPSBp
OTE1X3ZtX2dldCgmZ2d0dC0+dm0pOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9ncHVfZXJyb3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMK
aW5kZXggNjM4NGEwNmFhNWJmLi5hMjhlZTc1NGI3YjQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9ncHVfZXJyb3IuYwpAQCAtMTI5OSw3ICsxMjk5LDcgQEAgY2FwdHVyZV92bWEoc3RydWN0IGNh
cHR1cmVfdm1hICpuZXh0LAogCWlmICghYykKIAkJcmV0dXJuIG5leHQ7CiAKLQlpZiAoIWk5MTVf
YWN0aXZlX3RyeWdyYWIoJnZtYS0+YWN0aXZlKSkgeworCWlmICghaTkxNV9hY3RpdmVfYWNxdWly
ZV9pZl9idXN5KCZ2bWEtPmFjdGl2ZSkpIHsKIAkJa2ZyZWUoYyk7CiAJCXJldHVybiBuZXh0Owog
CX0KQEAgLTE0MzksNyArMTQzOSw3IEBAIGdlbV9yZWNvcmRfcmluZ3Moc3RydWN0IGk5MTVfZ3B1
X3N0YXRlICplcnJvciwgc3RydWN0IGNvbXByZXNzICpjb21wcmVzcykKIAkJCSp0aGlzLT5zbG90
ID0KIAkJCQlpOTE1X2Vycm9yX29iamVjdF9jcmVhdGUoaTkxNSwgdm1hLCBjb21wcmVzcyk7CiAK
LQkJCWk5MTVfYWN0aXZlX3VuZ3JhYigmdm1hLT5hY3RpdmUpOworCQkJaTkxNV9hY3RpdmVfcmVs
ZWFzZSgmdm1hLT5hY3RpdmUpOwogCQkJaTkxNV92bWFfcHV0KHZtYSk7CiAKIAkJCWNhcHR1cmUg
PSB0aGlzLT5uZXh0OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1
ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYwppbmRleCBhODkxNjQx
Mjc1OWIuLjRmZmU2MmE0MjE4NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9yZXF1ZXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKQEAg
LTIxOCw4ICsyMTgsNiBAQCBzdGF0aWMgdm9pZCByZW1vdmVfZnJvbV9lbmdpbmUoc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnEpCiAKIHN0YXRpYyBib29sIGk5MTVfcmVxdWVzdF9yZXRpcmUoc3RydWN0
IGk5MTVfcmVxdWVzdCAqcnEpCiB7Ci0Jc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2
ZSwgKm5leHQ7Ci0KIAlpZiAoIWk5MTVfcmVxdWVzdF9jb21wbGV0ZWQocnEpKQogCQlyZXR1cm4g
ZmFsc2U7CiAKQEAgLTI0NCwzNSArMjQyLDYgQEAgc3RhdGljIGJvb2wgaTkxNV9yZXF1ZXN0X3Jl
dGlyZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAkJCQkgICZpOTE1X3JlcXVlc3RfdGltZWxp
bmUocnEpLT5yZXF1ZXN0cykpOwogCXJxLT5yaW5nLT5oZWFkID0gcnEtPnBvc3RmaXg7CiAKLQkv
KgotCSAqIFdhbGsgdGhyb3VnaCB0aGUgYWN0aXZlIGxpc3QsIGNhbGxpbmcgcmV0aXJlIG9uIGVh
Y2guIFRoaXMgYWxsb3dzCi0JICogb2JqZWN0cyB0byB0cmFjayB0aGVpciBHUFUgYWN0aXZpdHkg
YW5kIG1hcmsgdGhlbXNlbHZlcyBhcyBpZGxlCi0JICogd2hlbiB0aGVpciAqbGFzdCogYWN0aXZl
IHJlcXVlc3QgaXMgY29tcGxldGVkICh1cGRhdGluZyBzdGF0ZQotCSAqIHRyYWNraW5nIGxpc3Rz
IGZvciBldmljdGlvbiwgYWN0aXZlIHJlZmVyZW5jZXMgZm9yIEdFTSwgZXRjKS4KLQkgKgotCSAq
IEFzIHRoZSAtPnJldGlyZSgpIG1heSBmcmVlIHRoZSBub2RlLCB3ZSBkZWNvdXBsZSBpdCBmaXJz
dCBhbmQKLQkgKiBwYXNzIGFsb25nIHRoZSBhdXhpbGlhcnkgaW5mb3JtYXRpb24gKHRvIGF2b2lk
IGRlcmVmZXJlbmNpbmcKLQkgKiB0aGUgbm9kZSBhZnRlciB0aGUgY2FsbGJhY2spLgotCSAqLwot
CWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShhY3RpdmUsIG5leHQsICZycS0+YWN0aXZlX2xpc3Qs
IGxpbmspIHsKLQkJLyoKLQkJICogSW4gbWljcm9iZW5jaG1hcmtzIG9yIGZvY3VzaW5nIHVwb24g
dGltZSBpbnNpZGUgdGhlIGtlcm5lbCwKLQkJICogd2UgbWF5IHNwZW5kIGFuIGlub3JkaW5hdGUg
YW1vdW50IG9mIHRpbWUgc2ltcGx5IGhhbmRsaW5nCi0JCSAqIHRoZSByZXRpcmVtZW50IG9mIHJl
cXVlc3RzIGFuZCBwcm9jZXNzaW5nIHRoZWlyIGNhbGxiYWNrcy4KLQkJICogT2Ygd2hpY2gsIHRo
aXMgbG9vcCBpdHNlbGYgaXMgcGFydGljdWxhcmx5IGhvdCBkdWUgdG8gdGhlCi0JCSAqIGNhY2hl
IG1pc3NlcyB3aGVuIGp1bXBpbmcgYXJvdW5kIHRoZSBsaXN0IG9mCi0JCSAqIGk5MTVfYWN0aXZl
X3JlcXVlc3QuICBTbyB3ZSB0cnkgdG8ga2VlcCB0aGlzIGxvb3AgYXMKLQkJICogc3RyZWFtbGlu
ZWQgYXMgcG9zc2libGUgYW5kIGFsc28gcHJlZmV0Y2ggdGhlIG5leHQKLQkJICogaTkxNV9hY3Rp
dmVfcmVxdWVzdCB0byB0cnkgYW5kIGhpZGUgdGhlIGxpa2VseSBjYWNoZSBtaXNzLgotCQkgKi8K
LQkJcHJlZmV0Y2h3KG5leHQpOwotCi0JCUlOSVRfTElTVF9IRUFEKCZhY3RpdmUtPmxpbmspOwot
CQlSQ1VfSU5JVF9QT0lOVEVSKGFjdGl2ZS0+cmVxdWVzdCwgTlVMTCk7Ci0KLQkJYWN0aXZlLT5y
ZXRpcmUoYWN0aXZlLCBycSk7Ci0JfQotCiAJbG9jYWxfaXJxX2Rpc2FibGUoKTsKIAogCS8qCkBA
IC03MDQsNyArNjczLDYgQEAgX19pOTE1X3JlcXVlc3RfY3JlYXRlKHN0cnVjdCBpbnRlbF9jb250
ZXh0ICpjZSwgZ2ZwX3QgZ2ZwKQogCXJxLT5mbGFncyA9IDA7CiAJcnEtPmV4ZWN1dGlvbl9tYXNr
ID0gQUxMX0VOR0lORVM7CiAKLQlJTklUX0xJU1RfSEVBRCgmcnEtPmFjdGl2ZV9saXN0KTsKIAlJ
TklUX0xJU1RfSEVBRCgmcnEtPmV4ZWN1dGVfY2IpOwogCiAJLyoKQEAgLTc0Myw3ICs3MTEsNiBA
QCBfX2k5MTVfcmVxdWVzdF9jcmVhdGUoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCBnZnBfdCBn
ZnApCiAJY2UtPnJpbmctPmVtaXQgPSBycS0+aGVhZDsKIAogCS8qIE1ha2Ugc3VyZSB3ZSBkaWRu
J3QgYWRkIG91cnNlbHZlcyB0byBleHRlcm5hbCBzdGF0ZSBiZWZvcmUgZnJlZWluZyAqLwotCUdF
TV9CVUdfT04oIWxpc3RfZW1wdHkoJnJxLT5hY3RpdmVfbGlzdCkpOwogCUdFTV9CVUdfT04oIWxp
c3RfZW1wdHkoJnJxLT5zY2hlZC5zaWduYWxlcnNfbGlzdCkpOwogCUdFTV9CVUdfT04oIWxpc3Rf
ZW1wdHkoJnJxLT5zY2hlZC53YWl0ZXJzX2xpc3QpKTsKIApAQCAtMTE3NCw4ICsxMTQxLDggQEAg
X19pOTE1X3JlcXVlc3RfYWRkX3RvX3RpbWVsaW5lKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQog
CSAqIHByZWNsdWRlcyBvcHRpbWlzaW5nIHRvIHVzZSBzZW1hcGhvcmVzIHNlcmlhbGlzYXRpb24g
b2YgYSBzaW5nbGUKIAkgKiB0aW1lbGluZSBhY3Jvc3MgZW5naW5lcy4KIAkgKi8KLQlwcmV2ID0g
cmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZCh0aW1lbGluZS0+bGFzdF9yZXF1ZXN0LnJlcXVlc3Qs
Ci0JCQkJCSBsb2NrZGVwX2lzX2hlbGQoJnRpbWVsaW5lLT5tdXRleCkpOworCXByZXYgPSB0b19y
ZXF1ZXN0KF9faTkxNV9hY3RpdmVfZmVuY2Vfc2V0KCZ0aW1lbGluZS0+bGFzdF9yZXF1ZXN0LAor
CQkJCQkJICAmcnEtPmZlbmNlKSk7CiAJaWYgKHByZXYgJiYgIWk5MTVfcmVxdWVzdF9jb21wbGV0
ZWQocHJldikpIHsKIAkJaWYgKGlzX3Bvd2VyX29mXzIocHJldi0+ZW5naW5lLT5tYXNrIHwgcnEt
PmVuZ2luZS0+bWFzaykpCiAJCQlpOTE1X3N3X2ZlbmNlX2F3YWl0X3N3X2ZlbmNlKCZycS0+c3Vi
bWl0LApAQCAtMTIwMCw3ICsxMTY3LDYgQEAgX19pOTE1X3JlcXVlc3RfYWRkX3RvX3RpbWVsaW5l
KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCSAqIHVzLCB0aGUgdGltZWxpbmUgd2lsbCBob2xk
IGl0cyBzZXFubyB3aGljaCBpcyBsYXRlciB0aGFuIG91cnMuCiAJICovCiAJR0VNX0JVR19PTih0
aW1lbGluZS0+c2Vxbm8gIT0gcnEtPmZlbmNlLnNlcW5vKTsKLQlfX2k5MTVfYWN0aXZlX3JlcXVl
c3Rfc2V0KCZ0aW1lbGluZS0+bGFzdF9yZXF1ZXN0LCBycSk7CiAKIAlyZXR1cm4gcHJldjsKIH0K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5oIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmgKaW5kZXggZWM1YmI0YzJlNWFlLi45MWE4ODVj
MzZjNmIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5oCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5oCkBAIC0yMTEsNyArMjExLDYg
QEAgc3RydWN0IGk5MTVfcmVxdWVzdCB7CiAJICogb24gdGhlIGFjdGl2ZV9saXN0IChvZiB0aGVp
ciBmaW5hbCByZXF1ZXN0KS4KIAkgKi8KIAlzdHJ1Y3QgaTkxNV9jYXB0dXJlX2xpc3QgKmNhcHR1
cmVfbGlzdDsKLQlzdHJ1Y3QgbGlzdF9oZWFkIGFjdGl2ZV9saXN0OwogCiAJLyoqIFRpbWUgYXQg
d2hpY2ggdGhpcyByZXF1ZXN0IHdhcyBlbWl0dGVkLCBpbiBqaWZmaWVzLiAqLwogCXVuc2lnbmVk
IGxvbmcgZW1pdHRlZF9qaWZmaWVzOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV92bWEuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKaW5kZXggZTE5MTI0
N2M3YzVmLi45ZmRjZDRlMmM3OTkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfdm1hLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwpAQCAtMTIwLDgg
KzEyMCw3IEBAIHZtYV9jcmVhdGUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAl2
bWEtPnNpemUgPSBvYmotPmJhc2Uuc2l6ZTsKIAl2bWEtPmRpc3BsYXlfYWxpZ25tZW50ID0gSTkx
NV9HVFRfTUlOX0FMSUdOTUVOVDsKIAotCWk5MTVfYWN0aXZlX2luaXQodm0tPmk5MTUsICZ2bWEt
PmFjdGl2ZSwKLQkJCSBfX2k5MTVfdm1hX2FjdGl2ZSwgX19pOTE1X3ZtYV9yZXRpcmUpOworCWk5
MTVfYWN0aXZlX2luaXQoJnZtYS0+YWN0aXZlLCBfX2k5MTVfdm1hX2FjdGl2ZSwgX19pOTE1X3Zt
YV9yZXRpcmUpOwogCiAJLyogRGVjbGFyZSBvdXJzZWx2ZXMgc2FmZSBmb3IgdXNlIGluc2lkZSBz
aHJpbmtlcnMgKi8KIAlpZiAoSVNfRU5BQkxFRChDT05GSUdfTE9DS0RFUCkpIHsKQEAgLTExNDgs
NiArMTE0Nyw3IEBAIGludCBfX2k5MTVfdm1hX3VuYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkK
IAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCisJR0VNX0JVR19PTihpOTE1X3ZtYV9pc19hY3Rp
dmUodm1hKSk7CiAJaWYgKGk5MTVfdm1hX2lzX3Bpbm5lZCh2bWEpKSB7CiAJCXZtYV9wcmludF9h
bGxvY2F0b3Iodm1hLCAiaXMgcGlubmVkIik7CiAJCXJldHVybiAtRUJVU1k7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9hY3RpdmUuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jCmluZGV4IGE0MTc4NTgyMmVkOS4u
MmNjNzFiY2Y4ODRmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aTkxNV9hY3RpdmUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9h
Y3RpdmUuYwpAQCAtNjgsNyArNjgsNyBAQCBzdGF0aWMgc3RydWN0IGxpdmVfYWN0aXZlICpfX2xp
dmVfYWxsb2Moc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJCXJldHVybiBOVUxMOwog
CiAJa3JlZl9pbml0KCZhY3RpdmUtPnJlZik7Ci0JaTkxNV9hY3RpdmVfaW5pdChpOTE1LCAmYWN0
aXZlLT5iYXNlLCBfX2xpdmVfYWN0aXZlLCBfX2xpdmVfcmV0aXJlKTsKKwlpOTE1X2FjdGl2ZV9p
bml0KCZhY3RpdmUtPmJhc2UsIF9fbGl2ZV9hY3RpdmUsIF9fbGl2ZV9yZXRpcmUpOwogCiAJcmV0
dXJuIGFjdGl2ZTsKIH0KQEAgLTE0NiwxOSArMTQ2LDEzIEBAIHN0YXRpYyBpbnQgbGl2ZV9hY3Rp
dmVfd2FpdCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBh
cmc7CiAJc3RydWN0IGxpdmVfYWN0aXZlICphY3RpdmU7Ci0JaW50ZWxfd2FrZXJlZl90IHdha2Vy
ZWY7CiAJaW50IGVyciA9IDA7CiAKIAkvKiBDaGVjayB0aGF0IHdlIGdldCBhIGNhbGxiYWNrIHdo
ZW4gcmVxdWVzdHMgcmV0aXJlIHVwb24gd2FpdGluZyAqLwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1
LT5ydW50aW1lX3BtKTsKLQogCWFjdGl2ZSA9IF9fbGl2ZV9hY3RpdmVfc2V0dXAoaTkxNSk7Ci0J
aWYgKElTX0VSUihhY3RpdmUpKSB7Ci0JCWVyciA9IFBUUl9FUlIoYWN0aXZlKTsKLQkJZ290byBl
cnI7Ci0JfQorCWlmIChJU19FUlIoYWN0aXZlKSkKKwkJcmV0dXJuIFBUUl9FUlIoYWN0aXZlKTsK
IAogCWk5MTVfYWN0aXZlX3dhaXQoJmFjdGl2ZS0+YmFzZSk7CiAJaWYgKCFSRUFEX09OQ0UoYWN0
aXZlLT5yZXRpcmVkKSkgewpAQCAtMTY4LDExICsxNjIsOSBAQCBzdGF0aWMgaW50IGxpdmVfYWN0
aXZlX3dhaXQodm9pZCAqYXJnKQogCiAJX19saXZlX3B1dChhY3RpdmUpOwogCisJbXV0ZXhfbG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5
MTVfV0FJVF9MT0NLRUQpKQogCQllcnIgPSAtRUlPOwotCi1lcnI6Ci0JaW50ZWxfcnVudGltZV9w
bV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwogCW11dGV4X3VubG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlyZXR1cm4gZXJyOwpAQCAtMTgyLDIzICsxNzQsMTkgQEAg
c3RhdGljIGludCBsaXZlX2FjdGl2ZV9yZXRpcmUodm9pZCAqYXJnKQogewogCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gYXJnOwogCXN0cnVjdCBsaXZlX2FjdGl2ZSAqYWN0aXZlOwot
CWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCWludCBlcnIgPSAwOwogCiAJLyogQ2hlY2sgdGhh
dCB3ZSBnZXQgYSBjYWxsYmFjayB3aGVuIHJlcXVlc3RzIGFyZSBpbmRpcmVjdGx5IHJldGlyZWQg
Ki8KIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCXdha2VyZWYgPSBp
bnRlbF9ydW50aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7Ci0KIAlhY3RpdmUgPSBfX2xp
dmVfYWN0aXZlX3NldHVwKGk5MTUpOwotCWlmIChJU19FUlIoYWN0aXZlKSkgewotCQllcnIgPSBQ
VFJfRVJSKGFjdGl2ZSk7Ci0JCWdvdG8gZXJyOwotCX0KKwlpZiAoSVNfRVJSKGFjdGl2ZSkpCisJ
CXJldHVybiBQVFJfRVJSKGFjdGl2ZSk7CiAKIAkvKiB3YWl0cyBmb3IgJiByZXRpcmVzIGFsbCBy
ZXF1ZXN0cyAqLworCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChp
Z3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKIAkJZXJyID0gLUVJTzsKKwlt
dXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJaWYgKCFSRUFEX09OQ0Uo
YWN0aXZlLT5yZXRpcmVkKSkgewogCQlwcl9lcnIoImk5MTVfYWN0aXZlIG5vdCByZXRpcmVkIGFm
dGVyIGZsdXNoaW5nIVxuIik7CkBAIC0yMDcsMTAgKzE5NSw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9h
Y3RpdmVfcmV0aXJlKHZvaWQgKmFyZykKIAogCV9fbGl2ZV9wdXQoYWN0aXZlKTsKIAotZXJyOgot
CWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRl
eF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJcmV0dXJuIGVycjsKIH0KIAot
LSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
XwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcK
aHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

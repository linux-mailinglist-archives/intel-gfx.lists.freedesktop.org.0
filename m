Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D9D464A148
	for <lists+intel-gfx@lfdr.de>; Tue, 18 Jun 2019 14:59:19 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4AE766E161;
	Tue, 18 Jun 2019 12:59:18 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 09A756E161
 for <intel-gfx@lists.freedesktop.org>; Tue, 18 Jun 2019 12:59:16 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16940402-1500050 
 for multiple; Tue, 18 Jun 2019 13:58:58 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 18 Jun 2019 13:58:58 +0100
Message-Id: <20190618125858.7295-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: Use drm_gem_object.resv
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Mika Kuoppala <mika.kuoppala@intel.com>,
 Matthew Auld <matthew.auld@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U2luY2UgY29tbWl0IDFiYTYyNzE0OGVmNSAoImRybTogQWRkIHJlc2VydmF0aW9uX29iamVjdCB0
bwpkcm1fZ2VtX29iamVjdCIpLCBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgZ3JldyBpdHMgb3duIGJ1
aWx0aW4KcmVzZXJ2YXRpb25fb2JqZWN0IHJlbmRlcmluZyBvdXIgb3duIHByaXZhdGUgb3duIGJs
b2F0LiBSZW1vdmUgb3VyCnJlZHVuZGFudCByZXNlcnZhdGlvbl9vYmplY3QgYW5kIHBvaW50IGlu
dG8gb2JqLT5iYXNlLnJlc3YgaW5zdGVhZC4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8
Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1
bGluQGludGVsLmNvbT4KQ2M6IE1hdHRoZXcgQXVsZCA8bWF0dGhldy5hdWxkQGludGVsLmNvbT4K
Q2M6IE1pa2EgS3VvcHBhbGEgPG1pa2Eua3VvcHBhbGFAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jICAgICB8ICA2ICsrKy0tLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2J1c3kuYyAgICAgICAgIHwgIDkgKysrKyst
LS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xmbHVzaC5jICAgICAgfCAg
NSArKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsaWVudF9ibHQuYyAg
IHwgIDQgKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RtYWJ1Zi5jICAg
ICAgIHwgIDQgKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2ZlbmNlLmMg
ICAgICAgIHwgIDQgKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVj
dC5jICAgICAgIHwgIDQgLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29i
amVjdC5oICAgICAgIHwgMTAgKysrKystLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX29iamVjdF90eXBlcy5oIHwgMTYgLS0tLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3dhaXQuYyAgICAgICAgIHwgIDcgKysrKy0tLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fYmF0Y2hfcG9vbC5jICAgICAgIHwgIDQgKystLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMgICAgICAgICAgICAgIHwgIDQgKystLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYyAgICAgICAgICAgICAgICAgIHwgMTAgKysr
KystLS0tLQogMTMgZmlsZXMgY2hhbmdlZCwgMzUgaW5zZXJ0aW9ucygrKSwgNTIgZGVsZXRpb25z
KC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRl
eCA4ZDdlNGM4YjYwYmMuLmFkNWNjY2Y0NDEzZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTE0MjU2LDcgKzE0MjU2LDcgQEAgaW50ZWxfcHJl
cGFyZV9wbGFuZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAkJICovCiAJCWlmIChuZWVk
c19tb2Rlc2V0KGNydGNfc3RhdGUpKSB7CiAJCQlyZXQgPSBpOTE1X3N3X2ZlbmNlX2F3YWl0X3Jl
c2VydmF0aW9uKCZpbnRlbF9zdGF0ZS0+Y29tbWl0X3JlYWR5LAotCQkJCQkJCSAgICAgIG9sZF9v
YmotPnJlc3YsIE5VTEwsCisJCQkJCQkJICAgICAgb2xkX29iai0+YmFzZS5yZXN2LCBOVUxMLAog
CQkJCQkJCSAgICAgIGZhbHNlLCAwLAogCQkJCQkJCSAgICAgIEdGUF9LRVJORUwpOwogCQkJaWYg
KHJldCA8IDApCkBAIC0xNDMwMCwxMyArMTQzMDAsMTMgQEAgaW50ZWxfcHJlcGFyZV9wbGFuZV9m
YihzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CiAK
IAkJcmV0ID0gaTkxNV9zd19mZW5jZV9hd2FpdF9yZXNlcnZhdGlvbigmaW50ZWxfc3RhdGUtPmNv
bW1pdF9yZWFkeSwKLQkJCQkJCSAgICAgIG9iai0+cmVzdiwgTlVMTCwKKwkJCQkJCSAgICAgIG9i
ai0+YmFzZS5yZXN2LCBOVUxMLAogCQkJCQkJICAgICAgZmFsc2UsIEk5MTVfRkVOQ0VfVElNRU9V
VCwKIAkJCQkJCSAgICAgIEdGUF9LRVJORUwpOwogCQlpZiAocmV0IDwgMCkKIAkJCXJldHVybiBy
ZXQ7CiAKLQkJZmVuY2UgPSByZXNlcnZhdGlvbl9vYmplY3RfZ2V0X2V4Y2xfcmN1KG9iai0+cmVz
dik7CisJCWZlbmNlID0gcmVzZXJ2YXRpb25fb2JqZWN0X2dldF9leGNsX3JjdShvYmotPmJhc2Uu
cmVzdik7CiAJCWlmIChmZW5jZSkgewogCQkJYWRkX3Jwc19ib29zdF9hZnRlcl92YmxhbmsobmV3
X3N0YXRlLT5jcnRjLCBmZW5jZSk7CiAJCQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9idXN5LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fYnVzeS5jCmluZGV4IDVhNWVkYTMwMDNlOS4uNmFkOTNh
MDk5NjhjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fYnVz
eS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9idXN5LmMKQEAgLTEx
MCwxMyArMTEwLDE0IEBAIGk5MTVfZ2VtX2J1c3lfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRl
diwgdm9pZCAqZGF0YSwKIAkgKgogCSAqLwogcmV0cnk6Ci0Jc2VxID0gcmF3X3JlYWRfc2VxY291
bnQoJm9iai0+cmVzdi0+c2VxKTsKKwlzZXEgPSByYXdfcmVhZF9zZXFjb3VudCgmb2JqLT5iYXNl
LnJlc3YtPnNlcSk7CiAKIAkvKiBUcmFuc2xhdGUgdGhlIGV4Y2x1c2l2ZSBmZW5jZSB0byB0aGUg
UkVBRCAqYW5kKiBXUklURSBlbmdpbmUgKi8KLQlhcmdzLT5idXN5ID0gYnVzeV9jaGVja193cml0
ZXIocmN1X2RlcmVmZXJlbmNlKG9iai0+cmVzdi0+ZmVuY2VfZXhjbCkpOworCWFyZ3MtPmJ1c3kg
PQorCQlidXN5X2NoZWNrX3dyaXRlcihyY3VfZGVyZWZlcmVuY2Uob2JqLT5iYXNlLnJlc3YtPmZl
bmNlX2V4Y2wpKTsKIAogCS8qIFRyYW5zbGF0ZSBzaGFyZWQgZmVuY2VzIHRvIFJFQUQgc2V0IG9m
IGVuZ2luZXMgKi8KLQlsaXN0ID0gcmN1X2RlcmVmZXJlbmNlKG9iai0+cmVzdi0+ZmVuY2UpOwor
CWxpc3QgPSByY3VfZGVyZWZlcmVuY2Uob2JqLT5iYXNlLnJlc3YtPmZlbmNlKTsKIAlpZiAobGlz
dCkgewogCQl1bnNpZ25lZCBpbnQgc2hhcmVkX2NvdW50ID0gbGlzdC0+c2hhcmVkX2NvdW50LCBp
OwogCkBAIC0xMjgsNyArMTI5LDcgQEAgaTkxNV9nZW1fYnVzeV9pb2N0bChzdHJ1Y3QgZHJtX2Rl
dmljZSAqZGV2LCB2b2lkICpkYXRhLAogCQl9CiAJfQogCi0JaWYgKGFyZ3MtPmJ1c3kgJiYgcmVh
ZF9zZXFjb3VudF9yZXRyeSgmb2JqLT5yZXN2LT5zZXEsIHNlcSkpCisJaWYgKGFyZ3MtPmJ1c3kg
JiYgcmVhZF9zZXFjb3VudF9yZXRyeSgmb2JqLT5iYXNlLnJlc3YtPnNlcSwgc2VxKSkKIAkJZ290
byByZXRyeTsKIAogCWVyciA9IDA7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fY2xmbHVzaC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X2NsZmx1c2guYwppbmRleCA5MDE4ZTEyYjUzNmIuLjUyOTUyODVkNTg0MyAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsZmx1c2guYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xmbHVzaC5jCkBAIC0xNDMsMTEgKzE0MywxMiBA
QCBib29sIGk5MTVfZ2VtX2NsZmx1c2hfb2JqZWN0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmosCiAJCWRtYV9mZW5jZV9nZXQoJmNsZmx1c2gtPmRtYSk7CiAKIAkJaTkxNV9zd19mZW5j
ZV9hd2FpdF9yZXNlcnZhdGlvbigmY2xmbHVzaC0+d2FpdCwKLQkJCQkJCW9iai0+cmVzdiwgTlVM
TCwKKwkJCQkJCW9iai0+YmFzZS5yZXN2LCBOVUxMLAogCQkJCQkJdHJ1ZSwgSTkxNV9GRU5DRV9U
SU1FT1VULAogCQkJCQkJSTkxNV9GRU5DRV9HRlApOwogCi0JCXJlc2VydmF0aW9uX29iamVjdF9h
ZGRfZXhjbF9mZW5jZShvYmotPnJlc3YsICZjbGZsdXNoLT5kbWEpOworCQlyZXNlcnZhdGlvbl9v
YmplY3RfYWRkX2V4Y2xfZmVuY2Uob2JqLT5iYXNlLnJlc3YsCisJCQkJCQkgICZjbGZsdXNoLT5k
bWEpOwogCiAJCWk5MTVfc3dfZmVuY2VfY29tbWl0KCZjbGZsdXNoLT53YWl0KTsKIAl9IGVsc2Ug
aWYgKG9iai0+bW0ucGFnZXMpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9jbGllbnRfYmx0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fY2xpZW50X2JsdC5jCmluZGV4IGYyNTNlYzU3NjVhZC4uMWZkYWIwNzY3YTQ3IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2JsdC5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMKQEAgLTI4Miwx
MyArMjgyLDEzIEBAIGludCBpOTE1X2dlbV9zY2hlZHVsZV9maWxsX3BhZ2VzX2JsdChzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCiAJaTkxNV9nZW1fb2JqZWN0X2xvY2sob2JqKTsK
IAllcnIgPSBpOTE1X3N3X2ZlbmNlX2F3YWl0X3Jlc2VydmF0aW9uKCZ3b3JrLT53YWl0LAotCQkJ
CQkgICAgICBvYmotPnJlc3YsIE5VTEwsCisJCQkJCSAgICAgIG9iai0+YmFzZS5yZXN2LCBOVUxM
LAogCQkJCQkgICAgICB0cnVlLCBJOTE1X0ZFTkNFX1RJTUVPVVQsCiAJCQkJCSAgICAgIEk5MTVf
RkVOQ0VfR0ZQKTsKIAlpZiAoZXJyIDwgMCkgewogCQlkbWFfZmVuY2Vfc2V0X2Vycm9yKCZ3b3Jr
LT5kbWEsIGVycik7CiAJfSBlbHNlIHsKLQkJcmVzZXJ2YXRpb25fb2JqZWN0X2FkZF9leGNsX2Zl
bmNlKG9iai0+cmVzdiwgJndvcmstPmRtYSk7CisJCXJlc2VydmF0aW9uX29iamVjdF9hZGRfZXhj
bF9mZW5jZShvYmotPmJhc2UucmVzdiwgJndvcmstPmRtYSk7CiAJCWVyciA9IDA7CiAJfQogCWk5
MTVfZ2VtX29iamVjdF91bmxvY2sob2JqKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9kbWFidWYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9kbWFidWYuYwppbmRleCBhOTNlMjMzY2ZhYTkuLmNiZjE3MDFkM2FjYyAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RtYWJ1Zi5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kbWFidWYuYwpAQCAtMjE0LDcgKzIxNCw3IEBA
IHN0cnVjdCBkbWFfYnVmICppOTE1X2dlbV9wcmltZV9leHBvcnQoc3RydWN0IGRybV9kZXZpY2Ug
KmRldiwKIAlleHBfaW5mby5zaXplID0gZ2VtX29iai0+c2l6ZTsKIAlleHBfaW5mby5mbGFncyA9
IGZsYWdzOwogCWV4cF9pbmZvLnByaXYgPSBnZW1fb2JqOwotCWV4cF9pbmZvLnJlc3YgPSBvYmot
PnJlc3Y7CisJZXhwX2luZm8ucmVzdiA9IG9iai0+YmFzZS5yZXN2OwogCiAJaWYgKG9iai0+b3Bz
LT5kbWFidWZfZXhwb3J0KSB7CiAJCWludCByZXQgPSBvYmotPm9wcy0+ZG1hYnVmX2V4cG9ydChv
YmopOwpAQCAtMjkwLDcgKzI5MCw3IEBAIHN0cnVjdCBkcm1fZ2VtX29iamVjdCAqaTkxNV9nZW1f
cHJpbWVfaW1wb3J0KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAJZHJtX2dlbV9wcml2YXRlX29i
amVjdF9pbml0KGRldiwgJm9iai0+YmFzZSwgZG1hX2J1Zi0+c2l6ZSk7CiAJaTkxNV9nZW1fb2Jq
ZWN0X2luaXQob2JqLCAmaTkxNV9nZW1fb2JqZWN0X2RtYWJ1Zl9vcHMpOwogCW9iai0+YmFzZS5p
bXBvcnRfYXR0YWNoID0gYXR0YWNoOwotCW9iai0+cmVzdiA9IGRtYV9idWYtPnJlc3Y7CisJb2Jq
LT5iYXNlLnJlc3YgPSBkbWFfYnVmLT5yZXN2OwogCiAJLyogV2UgdXNlIEdUVCBhcyBzaG9ydGhh
bmQgZm9yIGEgY29oZXJlbnQgZG9tYWluLCBvbmUgdGhhdCBpcwogCSAqIG5laXRoZXIgaW4gdGhl
IEdQVSBjYWNoZSBub3IgaW4gdGhlIENQVSBjYWNoZSwgd2hlcmUgYWxsCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZmVuY2UuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9mZW5jZS5jCmluZGV4IDU3ZGJjMDg2MjcxMy4uY2YwNDM5ZTZi
ZTgzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZmVuY2Uu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZmVuY2UuYwpAQCAtNzMs
MTIgKzczLDEyIEBAIGk5MTVfZ2VtX29iamVjdF9sb2NrX2ZlbmNlKHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmopCiAJCSAgICAgICAwKTsKIAogCWlmIChpOTE1X3N3X2ZlbmNlX2F3YWl0
X3Jlc2VydmF0aW9uKCZzdHViLT5jaGFpbiwKLQkJCQkJICAgIG9iai0+cmVzdiwgTlVMTCwKKwkJ
CQkJICAgIG9iai0+YmFzZS5yZXN2LCBOVUxMLAogCQkJCQkgICAgdHJ1ZSwgSTkxNV9GRU5DRV9U
SU1FT1VULAogCQkJCQkgICAgSTkxNV9GRU5DRV9HRlApIDwgMCkKIAkJZ290byBlcnI7CiAKLQly
ZXNlcnZhdGlvbl9vYmplY3RfYWRkX2V4Y2xfZmVuY2Uob2JqLT5yZXN2LCAmc3R1Yi0+ZG1hKTsK
KwlyZXNlcnZhdGlvbl9vYmplY3RfYWRkX2V4Y2xfZmVuY2Uob2JqLT5iYXNlLnJlc3YsICZzdHVi
LT5kbWEpOwogCiAJcmV0dXJuICZzdHViLT5kbWE7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9vYmplY3QuYwppbmRleCAyNzJjZTMwY2UxZDMuLmE4Yzc3ZjU3MTNjNiAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYwpAQCAtNzAsOSArNzAs
NiBAQCB2b2lkIGk5MTVfZ2VtX29iamVjdF9pbml0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmosCiAKIAlvYmotPm9wcyA9IG9wczsKIAotCXJlc2VydmF0aW9uX29iamVjdF9pbml0KCZv
YmotPl9fYnVpbHRpbl9yZXN2KTsKLQlvYmotPnJlc3YgPSAmb2JqLT5fX2J1aWx0aW5fcmVzdjsK
LQogCW9iai0+ZnJvbnRidWZmZXJfZ2d0dF9vcmlnaW4gPSBPUklHSU5fR1RUOwogCWk5MTVfYWN0
aXZlX3JlcXVlc3RfaW5pdCgmb2JqLT5mcm9udGJ1ZmZlcl93cml0ZSwKIAkJCQkgTlVMTCwgZnJv
bnRidWZmZXJfcmV0aXJlKTsKQEAgLTIzMyw3ICsyMzAsNiBAQCBzdGF0aWMgdm9pZCBfX2k5MTVf
Z2VtX2ZyZWVfb2JqZWN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJaWYgKG9i
ai0+YmFzZS5pbXBvcnRfYXR0YWNoKQogCQkJZHJtX3ByaW1lX2dlbV9kZXN0cm95KCZvYmotPmJh
c2UsIE5VTEwpOwogCi0JCXJlc2VydmF0aW9uX29iamVjdF9maW5pKCZvYmotPl9fYnVpbHRpbl9y
ZXN2KTsKIAkJZHJtX2dlbV9vYmplY3RfcmVsZWFzZSgmb2JqLT5iYXNlKTsKIAogCQliaXRtYXBf
ZnJlZShvYmotPmJpdF8xNyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fb2JqZWN0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2Jq
ZWN0LmgKaW5kZXggN2NiMTg3MWQ3MTI4Li5kZmViZDU3MDZmMTYgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKQEAgLTk5LDIyICs5OSwyMiBAQCBpOTE1X2dl
bV9vYmplY3RfcHV0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiAJX19kcm1fZ2Vt
X29iamVjdF9wdXQoJm9iai0+YmFzZSk7CiB9CiAKLSNkZWZpbmUgYXNzZXJ0X29iamVjdF9oZWxk
KG9iaikgcmVzZXJ2YXRpb25fb2JqZWN0X2Fzc2VydF9oZWxkKChvYmopLT5yZXN2KQorI2RlZmlu
ZSBhc3NlcnRfb2JqZWN0X2hlbGQob2JqKSByZXNlcnZhdGlvbl9vYmplY3RfYXNzZXJ0X2hlbGQo
KG9iaiktPmJhc2UucmVzdikKIAogc3RhdGljIGlubGluZSB2b2lkIGk5MTVfZ2VtX29iamVjdF9s
b2NrKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiB7Ci0JcmVzZXJ2YXRpb25fb2Jq
ZWN0X2xvY2sob2JqLT5yZXN2LCBOVUxMKTsKKwlyZXNlcnZhdGlvbl9vYmplY3RfbG9jayhvYmot
PmJhc2UucmVzdiwgTlVMTCk7CiB9CiAKIHN0YXRpYyBpbmxpbmUgaW50CiBpOTE1X2dlbV9vYmpl
Y3RfbG9ja19pbnRlcnJ1cHRpYmxlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiB7
Ci0JcmV0dXJuIHJlc2VydmF0aW9uX29iamVjdF9sb2NrX2ludGVycnVwdGlibGUob2JqLT5yZXN2
LCBOVUxMKTsKKwlyZXR1cm4gcmVzZXJ2YXRpb25fb2JqZWN0X2xvY2tfaW50ZXJydXB0aWJsZShv
YmotPmJhc2UucmVzdiwgTlVMTCk7CiB9CiAKIHN0YXRpYyBpbmxpbmUgdm9pZCBpOTE1X2dlbV9v
YmplY3RfdW5sb2NrKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiB7Ci0JcmVzZXJ2
YXRpb25fb2JqZWN0X3VubG9jayhvYmotPnJlc3YpOworCXJlc2VydmF0aW9uX29iamVjdF91bmxv
Y2sob2JqLT5iYXNlLnJlc3YpOwogfQogCiBzdHJ1Y3QgZG1hX2ZlbmNlICoKQEAgLTM3Myw3ICsz
NzMsNyBAQCBpOTE1X2dlbV9vYmplY3RfbGFzdF93cml0ZV9lbmdpbmUoc3RydWN0IGRybV9pOTE1
X2dlbV9vYmplY3QgKm9iaikKIAlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKIAogCXJjdV9yZWFk
X2xvY2soKTsKLQlmZW5jZSA9IHJlc2VydmF0aW9uX29iamVjdF9nZXRfZXhjbF9yY3Uob2JqLT5y
ZXN2KTsKKwlmZW5jZSA9IHJlc2VydmF0aW9uX29iamVjdF9nZXRfZXhjbF9yY3Uob2JqLT5iYXNl
LnJlc3YpOwogCXJjdV9yZWFkX3VubG9jaygpOwogCiAJaWYgKGZlbmNlICYmIGRtYV9mZW5jZV9p
c19pOTE1KGZlbmNlKSAmJiAhZG1hX2ZlbmNlX2lzX3NpZ25hbGVkKGZlbmNlKSkKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaCBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaAppbmRleCA1YjA1
Njk4NjE5Y2UuLjE4YmY0ZjhkNmQ4MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaApAQCAtNyw4ICs3LDYgQEAKICNpZm5kZWYgX19JOTE1
X0dFTV9PQkpFQ1RfVFlQRVNfSF9fCiAjZGVmaW5lIF9fSTkxNV9HRU1fT0JKRUNUX1RZUEVTX0hf
XwogCi0jaW5jbHVkZSA8bGludXgvcmVzZXJ2YXRpb24uaD4KLQogI2luY2x1ZGUgPGRybS9kcm1f
Z2VtLmg+CiAKICNpbmNsdWRlICJpOTE1X2FjdGl2ZS5oIgpAQCAtMjI4LDE4ICsyMjYsNiBAQCBz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCB7CiAJCWJvb2wgcXVpcmtlZDoxOwogCX0gbW07CiAK
LQkvKiogQnJlYWRjcnVtYiBvZiBsYXN0IHJlbmRlcmluZyB0byB0aGUgYnVmZmVyLgotCSAqIFRo
ZXJlIGNhbiBvbmx5IGJlIG9uZSB3cml0ZXIsIGJ1dCB3ZSBhbGxvdyBmb3IgbXVsdGlwbGUgcmVh
ZGVycy4KLQkgKiBJZiB0aGVyZSBpcyBhIHdyaXRlciB0aGF0IG5lY2Vzc2FyaWx5IGltcGxpZXMg
dGhhdCBhbGwgb3RoZXIKLQkgKiByZWFkIHJlcXVlc3RzIGFyZSBjb21wbGV0ZSAtIGJ1dCB3ZSBt
YXkgb25seSBiZSBsYXppbHkgY2xlYXJpbmcKLQkgKiB0aGUgcmVhZCByZXF1ZXN0cy4gQSByZWFk
IHJlcXVlc3QgaXMgbmF0dXJhbGx5IHRoZSBtb3N0IHJlY2VudAotCSAqIHJlcXVlc3Qgb24gYSBy
aW5nLCBzbyB3ZSBtYXkgaGF2ZSB0d28gZGlmZmVyZW50IHdyaXRlIGFuZCByZWFkCi0JICogcmVx
dWVzdHMgb24gb25lIHJpbmcgd2hlcmUgdGhlIHdyaXRlIHJlcXVlc3QgaXMgb2xkZXIgdGhhbiB0
aGUKLQkgKiByZWFkIHJlcXVlc3QuIFRoaXMgYWxsb3dzIGZvciB0aGUgQ1BVIHRvIHJlYWQgZnJv
bSBhbiBhY3RpdmUKLQkgKiBidWZmZXIgYnkgb25seSB3YWl0aW5nIGZvciB0aGUgd3JpdGUgdG8g
Y29tcGxldGUuCi0JICovCi0Jc3RydWN0IHJlc2VydmF0aW9uX29iamVjdCAqcmVzdjsKLQogCS8q
KiBSZWZlcmVuY2VzIGZyb20gZnJhbWVidWZmZXJzLCBsb2NrcyBvdXQgdGlsaW5nIGNoYW5nZXMu
ICovCiAJdW5zaWduZWQgaW50IGZyYW1lYnVmZmVyX3JlZmVyZW5jZXM7CiAKQEAgLTI2Miw4ICsy
NDgsNiBAQCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCB7CiAKIAkvKiogZm9yIHBoeXMgYWxs
b2NhdGVkIG9iamVjdHMgKi8KIAlzdHJ1Y3QgZHJtX2RtYV9oYW5kbGUgKnBoeXNfaGFuZGxlOwot
Ci0Jc3RydWN0IHJlc2VydmF0aW9uX29iamVjdCBfX2J1aWx0aW5fcmVzdjsKIH07CiAKIHN0YXRp
YyBpbmxpbmUgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3dhaXQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV93YWl0LmMKaW5kZXggZmVkNWM3NTFlZjM3Li4yNmVjNjU3OWI3Y2QgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV93YWl0LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3dhaXQuYwpAQCAtMTQ0LDcgKzE0NCw3
IEBAIGk5MTVfZ2VtX29iamVjdF93YWl0X3ByaW9yaXR5KHN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmosCiAJCXVuc2lnbmVkIGludCBjb3VudCwgaTsKIAkJaW50IHJldDsKIAotCQlyZXQg
PSByZXNlcnZhdGlvbl9vYmplY3RfZ2V0X2ZlbmNlc19yY3Uob2JqLT5yZXN2LAorCQlyZXQgPSBy
ZXNlcnZhdGlvbl9vYmplY3RfZ2V0X2ZlbmNlc19yY3Uob2JqLT5iYXNlLnJlc3YsCiAJCQkJCQkJ
JmV4Y2wsICZjb3VudCwgJnNoYXJlZCk7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0OwpAQCAt
MTU2LDcgKzE1Niw3IEBAIGk5MTVfZ2VtX29iamVjdF93YWl0X3ByaW9yaXR5KHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmosCiAKIAkJa2ZyZWUoc2hhcmVkKTsKIAl9IGVsc2UgewotCQll
eGNsID0gcmVzZXJ2YXRpb25fb2JqZWN0X2dldF9leGNsX3JjdShvYmotPnJlc3YpOworCQlleGNs
ID0gcmVzZXJ2YXRpb25fb2JqZWN0X2dldF9leGNsX3JjdShvYmotPmJhc2UucmVzdik7CiAJfQog
CiAJaWYgKGV4Y2wpIHsKQEAgLTE4MCw3ICsxODAsOCBAQCBpOTE1X2dlbV9vYmplY3Rfd2FpdChz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCW1pZ2h0X3NsZWVwKCk7CiAJR0VNX0JV
R19PTih0aW1lb3V0IDwgMCk7CiAKLQl0aW1lb3V0ID0gaTkxNV9nZW1fb2JqZWN0X3dhaXRfcmVz
ZXJ2YXRpb24ob2JqLT5yZXN2LCBmbGFncywgdGltZW91dCk7CisJdGltZW91dCA9IGk5MTVfZ2Vt
X29iamVjdF93YWl0X3Jlc2VydmF0aW9uKG9iai0+YmFzZS5yZXN2LAorCQkJCQkJICAgZmxhZ3Ms
IHRpbWVvdXQpOwogCXJldHVybiB0aW1lb3V0IDwgMCA/IHRpbWVvdXQgOiAwOwogfQogCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9iYXRjaF9wb29sLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9iYXRjaF9wb29sLmMKaW5kZXggNTZhZGZkY2FlZDNl
Li4yNWEzZTRkMDlhMmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2Vt
X2JhdGNoX3Bvb2wuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9iYXRjaF9w
b29sLmMKQEAgLTk2LDcgKzk2LDcgQEAgaTkxNV9nZW1fYmF0Y2hfcG9vbF9nZXQoc3RydWN0IGk5
MTVfZ2VtX2JhdGNoX3Bvb2wgKnBvb2wsCiAJbGlzdF9mb3JfZWFjaF9lbnRyeShvYmosIGxpc3Qs
IGJhdGNoX3Bvb2xfbGluaykgewogCQkvKiBUaGUgYmF0Y2hlcyBhcmUgc3RyaWN0bHkgTFJVIG9y
ZGVyZWQgKi8KIAkJaWYgKGk5MTVfZ2VtX29iamVjdF9pc19hY3RpdmUob2JqKSkgewotCQkJc3Ry
dWN0IHJlc2VydmF0aW9uX29iamVjdCAqcmVzdiA9IG9iai0+cmVzdjsKKwkJCXN0cnVjdCByZXNl
cnZhdGlvbl9vYmplY3QgKnJlc3YgPSBvYmotPmJhc2UucmVzdjsKIAogCQkJaWYgKCFyZXNlcnZh
dGlvbl9vYmplY3RfdGVzdF9zaWduYWxlZF9yY3UocmVzdiwgdHJ1ZSkpCiAJCQkJYnJlYWs7CkBA
IC0xMTksNyArMTE5LDcgQEAgaTkxNV9nZW1fYmF0Y2hfcG9vbF9nZXQoc3RydWN0IGk5MTVfZ2Vt
X2JhdGNoX3Bvb2wgKnBvb2wsCiAJCQl9CiAJCX0KIAotCQlHRU1fQlVHX09OKCFyZXNlcnZhdGlv
bl9vYmplY3RfdGVzdF9zaWduYWxlZF9yY3Uob2JqLT5yZXN2LAorCQlHRU1fQlVHX09OKCFyZXNl
cnZhdGlvbl9vYmplY3RfdGVzdF9zaWduYWxlZF9yY3Uob2JqLT5iYXNlLnJlc3YsCiAJCQkJCQkJ
CSB0cnVlKSk7CiAKIAkJaWYgKG9iai0+YmFzZS5zaXplID49IHNpemUpCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfcmVxdWVzdC5jCmluZGV4IDk4MTk0ODNkMWI1ZC4uNzQxOGU4ZjFlZDZhIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYwpAQCAtMTAyNyw3ICsxMDI3LDcgQEAgaTkxNV9yZXF1
ZXN0X2F3YWl0X29iamVjdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICp0bywKIAkJc3RydWN0IGRtYV9m
ZW5jZSAqKnNoYXJlZDsKIAkJdW5zaWduZWQgaW50IGNvdW50LCBpOwogCi0JCXJldCA9IHJlc2Vy
dmF0aW9uX29iamVjdF9nZXRfZmVuY2VzX3JjdShvYmotPnJlc3YsCisJCXJldCA9IHJlc2VydmF0
aW9uX29iamVjdF9nZXRfZmVuY2VzX3JjdShvYmotPmJhc2UucmVzdiwKIAkJCQkJCQkmZXhjbCwg
JmNvdW50LCAmc2hhcmVkKTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiByZXQ7CkBAIC0xMDQ0LDcg
KzEwNDQsNyBAQCBpOTE1X3JlcXVlc3RfYXdhaXRfb2JqZWN0KHN0cnVjdCBpOTE1X3JlcXVlc3Qg
KnRvLAogCQkJZG1hX2ZlbmNlX3B1dChzaGFyZWRbaV0pOwogCQlrZnJlZShzaGFyZWQpOwogCX0g
ZWxzZSB7Ci0JCWV4Y2wgPSByZXNlcnZhdGlvbl9vYmplY3RfZ2V0X2V4Y2xfcmN1KG9iai0+cmVz
dik7CisJCWV4Y2wgPSByZXNlcnZhdGlvbl9vYmplY3RfZ2V0X2V4Y2xfcmN1KG9iai0+YmFzZS5y
ZXN2KTsKIAl9CiAKIAlpZiAoZXhjbCkgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV92bWEuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKaW5kZXggNWZj
MGZkYTMyZTJhLi5hNTc3MjliZTgzMTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfdm1hLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwpAQCAtOTks
MTAgKzk5LDEwIEBAIHN0YXRpYyB2b2lkIF9faTkxNV92bWFfcmV0aXJlKHN0cnVjdCBpOTE1X2Fj
dGl2ZSAqcmVmKQogCQlyZXR1cm47CiAKIAkvKiBQcnVuZSB0aGUgc2hhcmVkIGZlbmNlIGFycmF5
cyBpZmYgY29tcGxldGVseSBpZGxlIChpbmMuIGV4dGVybmFsKSAqLwotCWlmIChyZXNlcnZhdGlv
bl9vYmplY3RfdHJ5bG9jayhvYmotPnJlc3YpKSB7Ci0JCWlmIChyZXNlcnZhdGlvbl9vYmplY3Rf
dGVzdF9zaWduYWxlZF9yY3Uob2JqLT5yZXN2LCB0cnVlKSkKLQkJCXJlc2VydmF0aW9uX29iamVj
dF9hZGRfZXhjbF9mZW5jZShvYmotPnJlc3YsIE5VTEwpOwotCQlyZXNlcnZhdGlvbl9vYmplY3Rf
dW5sb2NrKG9iai0+cmVzdik7CisJaWYgKHJlc2VydmF0aW9uX29iamVjdF90cnlsb2NrKG9iai0+
YmFzZS5yZXN2KSkgeworCQlpZiAocmVzZXJ2YXRpb25fb2JqZWN0X3Rlc3Rfc2lnbmFsZWRfcmN1
KG9iai0+YmFzZS5yZXN2LCB0cnVlKSkKKwkJCXJlc2VydmF0aW9uX29iamVjdF9hZGRfZXhjbF9m
ZW5jZShvYmotPmJhc2UucmVzdiwgTlVMTCk7CisJCXJlc2VydmF0aW9uX29iamVjdF91bmxvY2so
b2JqLT5iYXNlLnJlc3YpOwogCX0KIAogCS8qCkBAIC0xMzQsNyArMTM0LDcgQEAgdm1hX2NyZWF0
ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCXZtYS0+dm0gPSB2bTsKIAl2bWEt
Pm9wcyA9ICZ2bS0+dm1hX29wczsKIAl2bWEtPm9iaiA9IG9iajsKLQl2bWEtPnJlc3YgPSBvYmot
PnJlc3Y7CisJdm1hLT5yZXN2ID0gb2JqLT5iYXNlLnJlc3Y7CiAJdm1hLT5zaXplID0gb2JqLT5i
YXNlLnNpemU7CiAJdm1hLT5kaXNwbGF5X2FsaWdubWVudCA9IEk5MTVfR1RUX01JTl9BTElHTk1F
TlQ7CiAKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50
ZWwtZ2Z4

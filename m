Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 35AB5B0CB9
	for <lists+intel-gfx@lfdr.de>; Thu, 12 Sep 2019 12:19:53 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A26C26ECAC;
	Thu, 12 Sep 2019 10:19:50 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga06.intel.com (mga06.intel.com [134.134.136.31])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B2BF0896B0
 for <intel-gfx@lists.freedesktop.org>; Thu, 12 Sep 2019 10:19:44 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by orsmga104.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 12 Sep 2019 03:19:43 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,495,1559545200"; d="scan'208";a="186088715"
Received: from avrahamr-mobl1.ger.corp.intel.com (HELO [10.252.3.203])
 ([10.252.3.203])
 by fmsmga007.fm.intel.com with ESMTP; 12 Sep 2019 03:19:42 -0700
To: Chris Wilson <chris@chris-wilson.co.uk>, intel-gfx@lists.freedesktop.org
References: <20190911163815.11430-1-chris@chris-wilson.co.uk>
From: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>
Organization: Intel Corporation UK Plc
Message-ID: <c14ac3d6-aad3-3d7e-70f8-9713b67f5e4d@linux.intel.com>
Date: Thu, 12 Sep 2019 11:19:42 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <20190911163815.11430-1-chris@chris-wilson.co.uk>
Content-Language: en-US
Subject: Re: [Intel-gfx] [PATCH] drm/i915/pmu: Use GT parked for estimating
 RC6 while asleep
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Ck9uIDExLzA5LzIwMTkgMTc6MzgsIENocmlzIFdpbHNvbiB3cm90ZToKPiBBcyB3ZSB0cmFjayB3
aGVuIHdlIHB1dCB0aGUgR1QgZGV2aWNlIHRvIHNsZWVwIHVwb24gaWRsaW5nLCB3ZSBjYW4gdXNl
Cj4gdGhhdCBjYWxsYmFjayB0byBzYW1wbGUgdGhlIGN1cnJlbnQgcmM2IGNvdW50ZXJzIGFuZCBy
ZWNvcmQgdGhlCj4gdGltZXN0YW1wIGZvciBlc3RpbWF0aW5nIHNhbXBsZXMgYWZ0ZXIgdGhhdCBw
b2ludCB3aGlsZSBhc2xlZXAuCj4gCj4gdjI6IFN0aWNrIHRvIHVzaW5nIGt0aW1lX3QKPiB2Mzog
VHJhY2sgdXNlcl93YWtlcmVmcyB0aGF0IGludGVyZmVyZSB3aXRoIHRoZSBuZXcKPiBpbnRlbF9n
dF9wbV93YWl0X2Zvcl9pZGxlCj4gCj4gQnVnemlsbGE6IGh0dHBzOi8vYnVncy5mcmVlZGVza3Rv
cC5vcmcvc2hvd19idWcuY2dpP2lkPTEwNTAxMAo+IFNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNv
biA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgo+IENjOiBUdnJ0a28gVXJzdWxpbiA8dHZydGtv
LnVyc3VsaW5AaW50ZWwuY29tPgo+IC0tLQo+ICAgZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX3BtLmMgICB8ICAxOSArKysrCj4gICBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9ndF90eXBlcy5oIHwgICAxICsKPiAgIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdm
cy5jICAgICAgfCAgMjIgKystLS0KPiAgIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcG11LmMg
ICAgICAgICAgfCAxMjAgKysrKysrKysrKystLS0tLS0tLS0tLS0KPiAgIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfcG11LmggICAgICAgICAgfCAgIDQgKy0KPiAgIDUgZmlsZXMgY2hhbmdlZCwg
OTAgaW5zZXJ0aW9ucygrKSwgNzYgZGVsZXRpb25zKC0pCj4gCj4gZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX3BtLmMKPiBpbmRleCAzYmQ3NjQxMDRkNDEuLjQ1YTcyY2I2OThkYiAxMDA2
NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYwo+ICsrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCj4gQEAgLTE0MSw2ICsxNDEs
MjEgQEAgYm9vbCBpOTE1X2dlbV9sb2FkX3Bvd2VyX2NvbnRleHQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCj4gICAJcmV0dXJuIHN3aXRjaF90b19rZXJuZWxfY29udGV4dF9zeW5jKCZp
OTE1LT5ndCk7Cj4gICB9Cj4gICAKPiArc3RhdGljIHZvaWQgdXNlcl9mb3JjZXdha2Uoc3RydWN0
IGludGVsX2d0ICpndCwgYm9vbCBzdXNwZW5kKQo+ICt7Cj4gKwlpbnQgY291bnQgPSBhdG9taWNf
cmVhZCgmZ3QtPnVzZXJfd2FrZXJlZik7Cj4gKwo+ICsJaWYgKGxpa2VseSghY291bnQpKQo+ICsJ
CXJldHVybjsKPiArCj4gKwlpbnRlbF9ndF9wbV9nZXQoZ3QpOwo+ICsJaWYgKHN1c3BlbmQpCj4g
KwkJYXRvbWljX3N1Yihjb3VudCwgJmd0LT53YWtlcmVmLmNvdW50KTsKPiArCWVsc2UKPiArCQlh
dG9taWNfYWRkKGNvdW50LCAmZ3QtPndha2VyZWYuY291bnQpOwo+ICsJaW50ZWxfZ3RfcG1fcHV0
KGd0KTsKPiArfQo+ICsKPiAgIHZvaWQgaTkxNV9nZW1fc3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKPiAgIHsKPiAgIAlHRU1fVFJBQ0UoIlxuIik7Cj4gQEAgLTE0OCw2ICsx
NjMsOCBAQCB2b2lkIGk5MTVfZ2VtX3N1c3BlbmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCj4gICAJaW50ZWxfd2FrZXJlZl9hdXRvKCZpOTE1LT5nZ3R0LnVzZXJmYXVsdF93YWtlcmVm
LCAwKTsKPiAgIAlmbHVzaF93b3JrcXVldWUoaTkxNS0+d3EpOwo+ICAgCj4gKwl1c2VyX2ZvcmNl
d2FrZSgmaTkxNS0+Z3QsIHRydWUpOwo+ICsKPiAgIAltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKPiAgIAo+ICAgCS8qCj4gQEAgLTI1OSw2ICsyNzYsOCBAQCB2b2lkIGk5MTVf
Z2VtX3Jlc3VtZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKPiAgIAlpZiAoIWk5MTVf
Z2VtX2xvYWRfcG93ZXJfY29udGV4dChpOTE1KSkKPiAgIAkJZ290byBlcnJfd2VkZ2VkOwo+ICAg
Cj4gKwl1c2VyX2ZvcmNld2FrZSgmaTkxNS0+Z3QsIGZhbHNlKTsKPiArCj4gICBvdXRfdW5sb2Nr
Ogo+ICAgCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KCZpOTE1LT51bmNvcmUsIEZPUkNFV0FL
RV9BTEwpOwo+ICAgCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Cj4gZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmggYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90eXBlcy5oCj4gaW5kZXggZGMyOTVjMTk2ZDEx
Li4zMDM5Y2VmNjRiMTEgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfZ3RfdHlwZXMuaAo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5
cGVzLmgKPiBAQCAtNTAsNiArNTAsNyBAQCBzdHJ1Y3QgaW50ZWxfZ3Qgewo+ICAgCX0gdGltZWxp
bmVzOwo+ICAgCj4gICAJc3RydWN0IGludGVsX3dha2VyZWYgd2FrZXJlZjsKPiArCWF0b21pY190
IHVzZXJfd2FrZXJlZjsKPiAgIAo+ICAgCXN0cnVjdCBsaXN0X2hlYWQgY2xvc2VkX3ZtYTsKPiAg
IAlzcGlubG9ja190IGNsb3NlZF9sb2NrOyAvKiBndWFyZHMgdGhlIGxpc3Qgb2YgY2xvc2VkX3Zt
YSAqLwo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCj4gaW5kZXggNzA4ODU1ZTA1MWI1
Li5mMDBjMGRjNGY1N2UgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9k
ZWJ1Z2ZzLmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwo+IEBA
IC0zOTg4LDEzICszOTg4LDEyIEBAIHN0YXRpYyBpbnQgaTkxNV9zc2V1X3N0YXR1cyhzdHJ1Y3Qg
c2VxX2ZpbGUgKm0sIHZvaWQgKnVudXNlZCkKPiAgIHN0YXRpYyBpbnQgaTkxNV9mb3JjZXdha2Vf
b3BlbihzdHJ1Y3QgaW5vZGUgKmlub2RlLCBzdHJ1Y3QgZmlsZSAqZmlsZSkKPiAgIHsKPiAgIAlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGlub2RlLT5pX3ByaXZhdGU7Cj4gKwlzdHJ1
Y3QgaW50ZWxfZ3QgKmd0ID0gJmk5MTUtPmd0Owo+ICAgCj4gLQlpZiAoSU5URUxfR0VOKGk5MTUp
IDwgNikKPiAtCQlyZXR1cm4gMDsKPiAtCj4gLQlmaWxlLT5wcml2YXRlX2RhdGEgPQo+IC0JCSh2
b2lkICopKHVpbnRwdHJfdClpbnRlbF9ydW50aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7
Cj4gLQlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX3VzZXJfZ2V0KCZpOTE1LT51bmNvcmUpOwo+ICsJ
YXRvbWljX2luYygmZ3QtPnVzZXJfd2FrZXJlZik7Cj4gKwlpbnRlbF9ndF9wbV9nZXQoZ3QpOwo+
ICsJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA2KQo+ICsJCWludGVsX3VuY29yZV9mb3JjZXdha2Vf
dXNlcl9nZXQoZ3QtPnVuY29yZSk7Cj4gICAKPiAgIAlyZXR1cm4gMDsKPiAgIH0KPiBAQCAtNDAw
MiwxMyArNDAwMSwxMiBAQCBzdGF0aWMgaW50IGk5MTVfZm9yY2V3YWtlX29wZW4oc3RydWN0IGlu
b2RlICppbm9kZSwgc3RydWN0IGZpbGUgKmZpbGUpCj4gICBzdGF0aWMgaW50IGk5MTVfZm9yY2V3
YWtlX3JlbGVhc2Uoc3RydWN0IGlub2RlICppbm9kZSwgc3RydWN0IGZpbGUgKmZpbGUpCj4gICB7
Cj4gICAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBpbm9kZS0+aV9wcml2YXRlOwo+
ICsJc3RydWN0IGludGVsX2d0ICpndCA9ICZpOTE1LT5ndDsKPiAgIAo+IC0JaWYgKElOVEVMX0dF
TihpOTE1KSA8IDYpCj4gLQkJcmV0dXJuIDA7Cj4gLQo+IC0JaW50ZWxfdW5jb3JlX2ZvcmNld2Fr
ZV91c2VyX3B1dCgmaTkxNS0+dW5jb3JlKTsKPiAtCWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1
LT5ydW50aW1lX3BtLAo+IC0JCQkgICAgIChpbnRlbF93YWtlcmVmX3QpKHVpbnRwdHJfdClmaWxl
LT5wcml2YXRlX2RhdGEpOwo+ICsJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA2KQo+ICsJCWludGVs
X3VuY29yZV9mb3JjZXdha2VfdXNlcl9wdXQoJmk5MTUtPnVuY29yZSk7Cj4gKwlpbnRlbF9ndF9w
bV9wdXQoZ3QpOwo+ICsJYXRvbWljX2RlYygmZ3QtPnVzZXJfd2FrZXJlZik7Cj4gICAKPiAgIAly
ZXR1cm4gMDsKPiAgIH0KPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9w
bXUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcG11LmMKPiBpbmRleCA4ZTI1MWU3MTkz
OTAuLmEzZDNkM2UzOWMxNSAxMDA2NDQKPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3BtdS5jCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wbXUuYwo+IEBAIC0xMTYs
MTkgKzExNiw1MSBAQCBzdGF0aWMgYm9vbCBwbXVfbmVlZHNfdGltZXIoc3RydWN0IGk5MTVfcG11
ICpwbXUsIGJvb2wgZ3B1X2FjdGl2ZSkKPiAgIAlyZXR1cm4gZW5hYmxlOwo+ICAgfQo+ICAgCj4g
K3N0YXRpYyB1NjQgX19nZXRfcmM2KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCj4gK3sKPiArCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ3QtPmk5MTU7Cj4gKwl1NjQgdmFsOwo+ICsKPiAr
CXZhbCA9IGludGVsX3JjNl9yZXNpZGVuY3lfbnMoaTkxNSwKPiArCQkJCSAgICAgSVNfVkFMTEVZ
VklFVyhpOTE1KSA/Cj4gKwkJCQkgICAgIFZMVl9HVF9SRU5ERVJfUkM2IDoKPiArCQkJCSAgICAg
R0VONl9HVF9HRlhfUkM2KTsKPiArCj4gKwlpZiAoSEFTX1JDNnAoaTkxNSkpCj4gKwkJdmFsICs9
IGludGVsX3JjNl9yZXNpZGVuY3lfbnMoaTkxNSwgR0VONl9HVF9HRlhfUkM2cCk7Cj4gKwo+ICsJ
aWYgKEhBU19SQzZwcChpOTE1KSkKPiArCQl2YWwgKz0gaW50ZWxfcmM2X3Jlc2lkZW5jeV9ucyhp
OTE1LCBHRU42X0dUX0dGWF9SQzZwcCk7Cj4gKwo+ICsJcmV0dXJuIHZhbDsKPiArfQo+ICsKPiAg
IHZvaWQgaTkxNV9wbXVfZ3RfcGFya2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQo+
ICAgewo+ICAgCXN0cnVjdCBpOTE1X3BtdSAqcG11ID0gJmk5MTUtPnBtdTsKPiArCXU2NCB2YWw7
Cj4gICAKPiAgIAlpZiAoIXBtdS0+YmFzZS5ldmVudF9pbml0KQo+ICAgCQlyZXR1cm47Cj4gICAK
PiAgIAlzcGluX2xvY2tfaXJxKCZwbXUtPmxvY2spOwo+ICsKPiArCXZhbCA9IDA7Cj4gKwlpZiAo
cG11LT5zYW1wbGVbX19JOTE1X1NBTVBMRV9SQzZdLmN1cikKCkFyZSB5b3UgdXNpbmcgdGhpcyBj
aGVjayBoZXJlIGFuZCBpbiB1bnBhcmsgZWZmZWN0aXZlbHkgYXMgcHJveHkgZm9yIApldmVudCBi
ZWluZyBlbmFibGVkPyBNaWdodCBiZSBjbGVhcmVyIHRvIHdyaXRlIGl0IGxpa2UgdGhhdC4KCj4g
KwkJdmFsID0gX19nZXRfcmM2KCZpOTE1LT5ndCk7Cj4gKwo+ICsJaWYgKHZhbCA+PSBwbXUtPnNh
bXBsZVtfX0k5MTVfU0FNUExFX1JDNl9FU1RJTUFURURdLmN1cikgewo+ICsJCXBtdS0+c2FtcGxl
W19fSTkxNV9TQU1QTEVfUkM2X0VTVElNQVRFRF0uY3VyID0gMDsKPiArCQlwbXUtPnNhbXBsZVtf
X0k5MTVfU0FNUExFX1JDNl0uY3VyID0gdmFsOwo+ICsJfQoKQW5kIHRoZW4gdGhpcyBibG9jayBp
cyB0aGUgc2FtZSBjb3VudGVyIHVwZGF0ZSBhcyBpbiBnZXRfcmM2IHNvIGl0IHdvdWxkIApiZSBn
b29kIHRvIGNvbnNvbGlkYXRlIGZvciByZWFkYWJpbGl0eS4gX19wbXVfdXBkYXRlX3JjNihwbXUs
IHZhbCk/IApBY3R1YWxseSB3b3VsZCBhIHNpbmdsZSBibG9jayBvZjoKCmlmIChwbXUtPmVuYWJs
ZSAmIGNvbmZpZ19lbmFibGVkX21hc2soSTkxNV9QTVVfUkM2X1JFU0lERU5DWSkpCiAgIF9fcG11
X3VwZGF0ZV9yYzYocG11LCBfX2dldF9yYzYoJmk5MTUtPmd0KSk7CgpCZSBhbGwgdGhhdCBpcyBu
ZWVkZWQgYW5kIGNsZWFyPwoKPiArCXBtdS0+c2xlZXBfbGFzdCA9IGt0aW1lX2dldCgpOwo+ICsK
PiAgIAkvKgo+ICAgCSAqIFNpZ25hbCBzYW1wbGluZyB0aW1lciB0byBzdG9wIGlmIG9ubHkgZW5n
aW5lIGV2ZW50cyBhcmUgZW5hYmxlZCBhbmQKPiAgIAkgKiBHUFUgd2VudCBpZGxlLgo+ICAgCSAq
Lwo+ICAgCXBtdS0+dGltZXJfZW5hYmxlZCA9IHBtdV9uZWVkc190aW1lcihwbXUsIGZhbHNlKTsK
PiArCj4gICAJc3Bpbl91bmxvY2tfaXJxKCZwbXUtPmxvY2spOwo+ICAgfQo+ICAgCj4gQEAgLTE0
Myw2ICsxNzUsMTEgQEAgc3RhdGljIHZvaWQgX19pOTE1X3BtdV9tYXliZV9zdGFydF90aW1lcihz
dHJ1Y3QgaTkxNV9wbXUgKnBtdSkKPiAgIAl9Cj4gICB9Cj4gICAKPiArc3RhdGljIGlubGluZSBz
NjQga3RpbWVfc2luY2UoY29uc3Qga3RpbWVfdCBrdCkKPiArewo+ICsJcmV0dXJuIGt0aW1lX3Rv
X25zKGt0aW1lX3N1YihrdGltZV9nZXQoKSwga3QpKTsKPiArfQo+ICsKPiAgIHZvaWQgaTkxNV9w
bXVfZ3RfdW5wYXJrZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCj4gICB7Cj4gICAJ
c3RydWN0IGk5MTVfcG11ICpwbXUgPSAmaTkxNS0+cG11Owo+IEBAIC0xNTEsMTAgKzE4OCwyMiBA
QCB2b2lkIGk5MTVfcG11X2d0X3VucGFya2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQo+ICAgCQlyZXR1cm47Cj4gICAKPiAgIAlzcGluX2xvY2tfaXJxKCZwbXUtPmxvY2spOwo+ICsK
PiAgIAkvKgo+ICAgCSAqIFJlLWVuYWJsZSBzYW1wbGluZyB0aW1lciB3aGVuIEdQVSBnb2VzIGFj
dGl2ZS4KPiAgIAkgKi8KPiAgIAlfX2k5MTVfcG11X21heWJlX3N0YXJ0X3RpbWVyKHBtdSk7Cj4g
Kwo+ICsJLyogRXN0aW1hdGUgaG93IGxvbmcgd2Ugc2xlcHQgYW5kIGFjY3VtdWxhdGUgdGhhdCBp
bnRvIHJjNiBjb3VudGVycyAqLwo+ICsJaWYgKHBtdS0+c2FtcGxlW19fSTkxNV9TQU1QTEVfUkM2
XS5jdXIpIHsKPiArCQl1NjQgdmFsOwo+ICsKPiArCQl2YWwgPSBrdGltZV9zaW5jZShwbXUtPnNs
ZWVwX2xhc3QpOwo+ICsJCXZhbCArPSBwbXUtPnNhbXBsZVtfX0k5MTVfU0FNUExFX1JDNl0uY3Vy
Owo+ICsKPiArCQlwbXUtPnNhbXBsZVtfX0k5MTVfU0FNUExFX1JDNl9FU1RJTUFURURdLmN1ciA9
IHZhbDsKClNhbWUgdHJlYXRtZW50IGZvciB0aGlzIGJsb2NrPyBIb3cgd291bGQgaXQgbG9vay4u
CgppZiAocG11LT5lbmFibGUgJiBjb25maWdfZW5hYmxlZF9tYXNrKEk5MTVfUE1VX1JDNl9SRVNJ
REVOQ1kpKQoJX19wbXVfdXBkYXRlX2VzdGltYXRlZF9yYzYocG11KTsKCmdldF9yYzYoKSBjb3Vs
ZCB1c2UgdGhlIHNhbWUgInZhbCA9IF9fcG11X3VwZGF0ZV9lc3RpbWF0ZWRfcmM2KHBtdSk7IiBp
biAKdGhlIGVzdGltYXRpb24gYnJhbmNoLgoKSG9wZSBJIGhhdmVuJ3QgbWlzc2VkIHNvbWV0aGlu
Zy4uCgpSZWdhcmRzLAoKVHZydGtvCgo+ICsJfQo+ICsKPiAgIAlzcGluX3VubG9ja19pcnEoJnBt
dS0+bG9jayk7Cj4gICB9Cj4gICAKPiBAQCAtNDI2LDM5ICs0NzUsMTggQEAgc3RhdGljIGludCBp
OTE1X3BtdV9ldmVudF9pbml0KHN0cnVjdCBwZXJmX2V2ZW50ICpldmVudCkKPiAgIAlyZXR1cm4g
MDsKPiAgIH0KPiAgIAo+IC1zdGF0aWMgdTY0IF9fZ2V0X3JjNihzdHJ1Y3QgaW50ZWxfZ3QgKmd0
KQo+IC17Cj4gLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGd0LT5pOTE1Owo+IC0J
dTY0IHZhbDsKPiAtCj4gLQl2YWwgPSBpbnRlbF9yYzZfcmVzaWRlbmN5X25zKGk5MTUsCj4gLQkJ
CQkgICAgIElTX1ZBTExFWVZJRVcoaTkxNSkgPwo+IC0JCQkJICAgICBWTFZfR1RfUkVOREVSX1JD
NiA6Cj4gLQkJCQkgICAgIEdFTjZfR1RfR0ZYX1JDNik7Cj4gLQo+IC0JaWYgKEhBU19SQzZwKGk5
MTUpKQo+IC0JCXZhbCArPSBpbnRlbF9yYzZfcmVzaWRlbmN5X25zKGk5MTUsIEdFTjZfR1RfR0ZY
X1JDNnApOwo+IC0KPiAtCWlmIChIQVNfUkM2cHAoaTkxNSkpCj4gLQkJdmFsICs9IGludGVsX3Jj
Nl9yZXNpZGVuY3lfbnMoaTkxNSwgR0VONl9HVF9HRlhfUkM2cHApOwo+IC0KPiAtCXJldHVybiB2
YWw7Cj4gLX0KPiAtCj4gICBzdGF0aWMgdTY0IGdldF9yYzYoc3RydWN0IGludGVsX2d0ICpndCkK
PiAgIHsKPiAtI2lmIElTX0VOQUJMRUQoQ09ORklHX1BNKQo+ICAgCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gZ3QtPmk5MTU7Cj4gLQlzdHJ1Y3QgaW50ZWxfcnVudGltZV9wbSAqcnBt
ID0gJmk5MTUtPnJ1bnRpbWVfcG07Cj4gICAJc3RydWN0IGk5MTVfcG11ICpwbXUgPSAmaTkxNS0+
cG11Owo+IC0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7Cj4gICAJdW5zaWduZWQgbG9uZyBmbGFn
czsKPiAgIAl1NjQgdmFsOwo+ICAgCj4gLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXRf
aWZfaW5fdXNlKHJwbSk7Cj4gLQlpZiAod2FrZXJlZikgewo+ICsJc3Bpbl9sb2NrX2lycXNhdmUo
JnBtdS0+bG9jaywgZmxhZ3MpOwo+ICsKPiArCWlmIChpbnRlbF9ndF9wbV9nZXRfaWZfYXdha2Uo
Z3QpKSB7Cj4gICAJCXZhbCA9IF9fZ2V0X3JjNihndCk7Cj4gLQkJaW50ZWxfcnVudGltZV9wbV9w
dXQocnBtLCB3YWtlcmVmKTsKPiArCQlpbnRlbF9ndF9wbV9wdXQoZ3QpOwo+ICAgCj4gICAJCS8q
Cj4gICAJCSAqIElmIHdlIGFyZSBjb21pbmcgYmFjayBmcm9tIGJlaW5nIHJ1bnRpbWUgc3VzcGVu
ZGVkIHdlIG11c3QKPiBAQCAtNDY2LDE5ICs0OTQsMTMgQEAgc3RhdGljIHU2NCBnZXRfcmM2KHN0
cnVjdCBpbnRlbF9ndCAqZ3QpCj4gICAJCSAqIHByZXZpb3VzbHkuCj4gICAJCSAqLwo+ICAgCj4g
LQkJc3Bpbl9sb2NrX2lycXNhdmUoJnBtdS0+bG9jaywgZmxhZ3MpOwo+IC0KPiAgIAkJaWYgKHZh
bCA+PSBwbXUtPnNhbXBsZVtfX0k5MTVfU0FNUExFX1JDNl9FU1RJTUFURURdLmN1cikgewo+ICAg
CQkJcG11LT5zYW1wbGVbX19JOTE1X1NBTVBMRV9SQzZfRVNUSU1BVEVEXS5jdXIgPSAwOwo+ICAg
CQkJcG11LT5zYW1wbGVbX19JOTE1X1NBTVBMRV9SQzZdLmN1ciA9IHZhbDsKPiAgIAkJfSBlbHNl
IHsKPiAgIAkJCXZhbCA9IHBtdS0+c2FtcGxlW19fSTkxNV9TQU1QTEVfUkM2X0VTVElNQVRFRF0u
Y3VyOwo+ICAgCQl9Cj4gLQo+IC0JCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnBtdS0+bG9jaywg
ZmxhZ3MpOwo+ICAgCX0gZWxzZSB7Cj4gLQkJc3RydWN0IGRldmljZSAqa2RldiA9IHJwbS0+a2Rl
djsKPiAtCj4gICAJCS8qCj4gICAJCSAqIFdlIGFyZSBydW50aW1lIHN1c3BlbmRlZC4KPiAgIAkJ
ICoKPiBAQCAtNDg2LDQyICs1MDgsMTYgQEAgc3RhdGljIHU2NCBnZXRfcmM2KHN0cnVjdCBpbnRl
bF9ndCAqZ3QpCj4gICAJCSAqIG9uIHRvcCBvZiB0aGUgbGFzdCBrbm93biByZWFsIHZhbHVlLCBh
cyB0aGUgYXBwcm94aW1hdGVkIFJDNgo+ICAgCQkgKiBjb3VudGVyIHZhbHVlLgo+ICAgCQkgKi8K
PiAtCQlzcGluX2xvY2tfaXJxc2F2ZSgmcG11LT5sb2NrLCBmbGFncyk7Cj4gICAKPiAtCQkvKgo+
IC0JCSAqIEFmdGVyIHRoZSBhYm92ZSBicmFuY2ggaW50ZWxfcnVudGltZV9wbV9nZXRfaWZfaW5f
dXNlIGZhaWxlZAo+IC0JCSAqIHRvIGdldCB0aGUgcnVudGltZSBQTSByZWZlcmVuY2Ugd2UgY2Fu
bm90IGFzc3VtZSB3ZSBhcmUgaW4KPiAtCQkgKiBydW50aW1lIHN1c3BlbmQgc2luY2Ugd2UgY2Fu
IGVpdGhlcjogYSkgcmFjZSB3aXRoIGNvbWluZyBvdXQKPiAtCQkgKiBvZiBpdCBiZWZvcmUgd2Ug
dG9vayB0aGUgcG93ZXIubG9jaywgb3IgYikgdGhlcmUgYXJlIG90aGVyCj4gLQkJICogc3RhdGVz
IHRoYW4gc3VzcGVuZGVkIHdoaWNoIGNhbiBicmluZyB1cyBoZXJlLgo+IC0JCSAqCj4gLQkJICog
V2UgbmVlZCB0byBkb3VibGUtY2hlY2sgdGhhdCB3ZSBhcmUgaW5kZWVkIGN1cnJlbnRseSBydW50
aW1lCj4gLQkJICogc3VzcGVuZGVkIGFuZCBpZiBub3Qgd2UgY2Fubm90IGRvIGJldHRlciB0aGFu
IHJlcG9ydCB0aGUgbGFzdAo+IC0JCSAqIGtub3duIFJDNiB2YWx1ZS4KPiAtCQkgKi8KPiAtCQlp
ZiAocG1fcnVudGltZV9zdGF0dXNfc3VzcGVuZGVkKGtkZXYpKSB7Cj4gLQkJCXZhbCA9IHBtX3J1
bnRpbWVfc3VzcGVuZGVkX3RpbWUoa2Rldik7Cj4gKwkJdmFsID0ga3RpbWVfc2luY2UocG11LT5z
bGVlcF9sYXN0KTsKPiArCQl2YWwgKz0gcG11LT5zYW1wbGVbX19JOTE1X1NBTVBMRV9SQzZdLmN1
cjsKPiAgIAo+IC0JCQlpZiAoIXBtdS0+c2FtcGxlW19fSTkxNV9TQU1QTEVfUkM2X0VTVElNQVRF
RF0uY3VyKQo+IC0JCQkJcG11LT5zdXNwZW5kZWRfdGltZV9sYXN0ID0gdmFsOwo+IC0KPiAtCQkJ
dmFsIC09IHBtdS0+c3VzcGVuZGVkX3RpbWVfbGFzdDsKPiAtCQkJdmFsICs9IHBtdS0+c2FtcGxl
W19fSTkxNV9TQU1QTEVfUkM2XS5jdXI7Cj4gLQo+IC0JCQlwbXUtPnNhbXBsZVtfX0k5MTVfU0FN
UExFX1JDNl9FU1RJTUFURURdLmN1ciA9IHZhbDsKPiAtCQl9IGVsc2UgaWYgKHBtdS0+c2FtcGxl
W19fSTkxNV9TQU1QTEVfUkM2X0VTVElNQVRFRF0uY3VyKSB7Cj4gLQkJCXZhbCA9IHBtdS0+c2Ft
cGxlW19fSTkxNV9TQU1QTEVfUkM2X0VTVElNQVRFRF0uY3VyOwo+IC0JCX0gZWxzZSB7Cj4gLQkJ
CXZhbCA9IHBtdS0+c2FtcGxlW19fSTkxNV9TQU1QTEVfUkM2XS5jdXI7Cj4gLQkJfQo+IC0KPiAt
CQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZwbXUtPmxvY2ssIGZsYWdzKTsKPiArCQlwbXUtPnNh
bXBsZVtfX0k5MTVfU0FNUExFX1JDNl9FU1RJTUFURURdLmN1ciA9IHZhbDsKPiAgIAl9Cj4gICAK
PiArCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnBtdS0+bG9jaywgZmxhZ3MpOwo+ICsKPiAgIAly
ZXR1cm4gdmFsOwo+IC0jZWxzZQo+IC0JcmV0dXJuIF9fZ2V0X3JjNihndCk7Cj4gLSNlbmRpZgo+
ICAgfQo+ICAgCj4gICBzdGF0aWMgdTY0IF9faTkxNV9wbXVfZXZlbnRfcmVhZChzdHJ1Y3QgcGVy
Zl9ldmVudCAqZXZlbnQpCj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
cG11LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BtdS5oCj4gaW5kZXggNGZjNGYyNDc4
MzAxLi4wNjdkYmJmM2JkZmYgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9wbXUuaAo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcG11LmgKPiBAQCAtOTcs
OSArOTcsOSBAQCBzdHJ1Y3QgaTkxNV9wbXUgewo+ICAgCSAqLwo+ICAgCXN0cnVjdCBpOTE1X3Bt
dV9zYW1wbGUgc2FtcGxlW19fSTkxNV9OVU1fUE1VX1NBTVBMRVJTXTsKPiAgIAkvKioKPiAtCSAq
IEBzdXNwZW5kZWRfdGltZV9sYXN0OiBDYWNoZWQgc3VzcGVuZCB0aW1lIGZyb20gUE0gY29yZS4K
PiArCSAqIEBzbGVlcF9sYXN0OiBMYXN0IHRpbWUgR1QgcGFya2VkIGZvciBSQzYgZXN0aW1hdGlv
bi4KPiAgIAkgKi8KPiAtCXU2NCBzdXNwZW5kZWRfdGltZV9sYXN0Owo+ICsJa3RpbWVfdCBzbGVl
cF9sYXN0Owo+ICAgCS8qKgo+ICAgCSAqIEBpOTE1X2F0dHI6IE1lbW9yeSBibG9jayBob2xkaW5n
IGRldmljZSBhdHRyaWJ1dGVzLgo+ICAgCSAqLwo+IApfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBs
aXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1h
bi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 6ADC65D7F8
	for <lists+intel-gfx@lfdr.de>; Tue,  2 Jul 2019 23:59:08 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 204446E094;
	Tue,  2 Jul 2019 21:59:06 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4C4C46E094
 for <intel-gfx@lists.freedesktop.org>; Tue,  2 Jul 2019 21:59:04 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17106029-1500050 
 for multiple; Tue, 02 Jul 2019 22:58:44 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue,  2 Jul 2019 22:58:42 +0100
Message-Id: <20190702215842.32483-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/selftests: Common live setup/teardown
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgZnJlcXVlbnRseSwgYW5kIG5vdCBmcmVxdWVudGx5IGVub3VnaCwgcmVtZW1iZXIgdG8gZmx1
c2ggcmVzaWR1YWwKb3BlbmF0aW9ucyBhbmQgb2JqZWN0cyBhdCB0aGUgZW5kIG9mIGEgbGl2ZSBz
dWJ0ZXN0LiBUaGUgcHVycG9zZSBpcyB0bwpjbGVhbnVwIGFmdGVyIGV2ZXJ5IHN1YnRlc3QsIGxl
YXZpbmcgYSBjbGVhbiBzbGF0ZSBmb3IgdGhlIG5leHQgc3VidGVzdCwKYW5kIHBlcmZvcm0gZWFy
bHkgZGV0ZWN0aW9uIG9mIGxlYWt5IHN0YXRlLgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29u
IDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBUdnJ0a28gVXJzdWxpbiA8dHZydGtvLnVy
c3VsaW5AaW50ZWwuY29tPgotLS0KIC4uLi9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY2xp
ZW50X2JsdC5jICB8IDExICsrLS0tCiAuLi4vZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dl
bV9jb250ZXh0LmMgfCAgMiArLQogLi4uL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmpl
Y3RfYmx0LmMgIHwgMTEgKystLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hh
bmdjaGVjay5jICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMu
YyAgICAgICAgfCAxNiArLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF90
aW1lbGluZS5jICAgfCAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zZWxmdGVzdC5o
ICAgICAgICAgIHwgMTggKysrKysrKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
OTE1X2dlbS5jICAgICB8ICA2ICstLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9z
ZWxmdGVzdC5jICAgIHwgNDQgKysrKysrKysrKysrKysrKysrLQogOSBmaWxlcyBjaGFuZ2VkLCA3
MSBpbnNlcnRpb25zKCspLCA0MyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NsaWVudF9ibHQuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY2xpZW50X2JsdC5jCmluZGV4IDg1
NTQ4MTI1MmJkYS4uZmE3OTIzMzA5M2ViIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NsaWVudF9ibHQuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NsaWVudF9ibHQuYwpAQCAtMTEsOCArMTEs
OCBAQAogCiBzdGF0aWMgaW50IGlndF9jbGllbnRfZmlsbCh2b2lkICphcmcpCiB7Ci0Jc3RydWN0
IGludGVsX2NvbnRleHQgKmNlID0gYXJnOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0gY2UtPmdlbV9jb250ZXh0LT5pOTE1OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0gYXJnOworCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSA9IGk5MTUtPmVuZ2luZVtCQ1MwXS0+
a2VybmVsX2NvbnRleHQ7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKIAlzdHJ1
Y3Qgcm5kX3N0YXRlIHBybmc7CiAJSUdUX1RJTUVPVVQoZW5kKTsKQEAgLTg5LDExICs4OSw2IEBA
IHN0YXRpYyBpbnQgaWd0X2NsaWVudF9maWxsKHZvaWQgKmFyZykKIGVycl9wdXQ6CiAJaTkxNV9n
ZW1fb2JqZWN0X3B1dChvYmopOwogZXJyX2ZsdXNoOgotCW11dGV4X2xvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwotCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VE
KSkKLQkJZXJyID0gLUVJTzsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwotCiAJaWYgKGVyciA9PSAtRU5PTUVNKQogCQllcnIgPSAwOwogCkBAIC0xMTIsNSArMTA3LDUg
QEAgaW50IGk5MTVfZ2VtX2NsaWVudF9ibHRfbGl2ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiAJaWYgKCFIQVNfRU5HSU5FKGk5MTUsIEJDUzApKQogCQlyZXR1cm4g
MDsKIAotCXJldHVybiBpOTE1X3N1YnRlc3RzKHRlc3RzLCBpOTE1LT5lbmdpbmVbQkNTMF0tPmtl
cm5lbF9jb250ZXh0KTsKKwlyZXR1cm4gaTkxNV9saXZlX3N1YnRlc3RzKHRlc3RzLCBpOTE1KTsK
IH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9n
ZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dl
bV9jb250ZXh0LmMKaW5kZXggNTNjODFiNWRmZDY5Li5hMjNjNmRmOWI5ZjQgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5j
CkBAIC0xNzMxLDUgKzE3MzEsNSBAQCBpbnQgaTkxNV9nZW1fY29udGV4dF9saXZlX3NlbGZ0ZXN0
cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJaWYgKGk5MTVfdGVybWluYWxs
eV93ZWRnZWQoZGV2X3ByaXYpKQogCQlyZXR1cm4gMDsKIAotCXJldHVybiBpOTE1X3N1YnRlc3Rz
KHRlc3RzLCBkZXZfcHJpdik7CisJcmV0dXJuIGk5MTVfbGl2ZV9zdWJ0ZXN0cyh0ZXN0cywgZGV2
X3ByaXYpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0
cy9pOTE1X2dlbV9vYmplY3RfYmx0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRl
c3RzL2k5MTVfZ2VtX29iamVjdF9ibHQuYwppbmRleCBlMjNkOGM5ZTkyOTguLjExZDM3MjM4YzYy
YyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dl
bV9vYmplY3RfYmx0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9p
OTE1X2dlbV9vYmplY3RfYmx0LmMKQEAgLTExLDggKzExLDggQEAKIAogc3RhdGljIGludCBpZ3Rf
ZmlsbF9ibHQodm9pZCAqYXJnKQogewotCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSA9IGFyZzsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGNlLT5nZW1fY29udGV4dC0+aTkxNTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKKwlzdHJ1Y3QgaW50ZWxfY29u
dGV4dCAqY2UgPSBpOTE1LT5lbmdpbmVbQkNTMF0tPmtlcm5lbF9jb250ZXh0OwogCXN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJc3RydWN0IHJuZF9zdGF0ZSBwcm5nOwogCUlHVF9U
SU1FT1VUKGVuZCk7CkBAIC04MywxMSArODMsNiBAQCBzdGF0aWMgaW50IGlndF9maWxsX2JsdCh2
b2lkICphcmcpCiBlcnJfcHV0OgogCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKIGVycl9mbHVz
aDoKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAoaWd0X2ZsdXNo
X3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCi0JCWVyciA9IC1FSU87Ci0JbXV0ZXhfdW5s
b2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWlmIChlcnIgPT0gLUVOT01FTSkKIAkJ
ZXJyID0gMDsKIApAQCAtMTA2LDUgKzEwMSw1IEBAIGludCBpOTE1X2dlbV9vYmplY3RfYmx0X2xp
dmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCWlmICghSEFTX0VO
R0lORShpOTE1LCBCQ1MwKSkKIAkJcmV0dXJuIDA7CiAKLQlyZXR1cm4gaTkxNV9zdWJ0ZXN0cyh0
ZXN0cywgaTkxNS0+ZW5naW5lW0JDUzBdLT5rZXJuZWxfY29udGV4dCk7CisJcmV0dXJuIGk5MTVf
bGl2ZV9zdWJ0ZXN0cyh0ZXN0cywgaTkxNSk7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3NlbGZ0ZXN0X2hhbmdjaGVjay5jCmluZGV4IGNmNTkyYTA0OWE3MS4uMmQ5Y2MzY2QxZjI3IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYwpAQCAtMTc0
NCw3ICsxNzQ0LDcgQEAgaW50IGludGVsX2hhbmdjaGVja19saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAlzYXZlZF9oYW5nY2hlY2sgPSBmZXRjaF9hbmRfemVy
bygmaTkxNV9tb2RwYXJhbXMuZW5hYmxlX2hhbmdjaGVjayk7CiAJZHJhaW5fZGVsYXllZF93b3Jr
KCZpOTE1LT5ncHVfZXJyb3IuaGFuZ2NoZWNrX3dvcmspOyAvKiBmbHVzaCBwYXJhbSAqLwogCi0J
ZXJyID0gaTkxNV9zdWJ0ZXN0cyh0ZXN0cywgaTkxNSk7CisJZXJyID0gaTkxNV9saXZlX3N1YnRl
c3RzKHRlc3RzLCBpOTE1KTsKIAogCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwogCWlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpOwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF9scmMuYwppbmRleCAwYzk3Zjk1M2U5MDguLjExZjQ5MDUwMmNhNiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKQEAgLTczLDcgKzczLDYgQEAg
c3RhdGljIGludCBsaXZlX3Nhbml0eWNoZWNrKHZvaWQgKmFyZykKIGVycl9zcGluOgogCWlndF9z
cGlubmVyX2ZpbmkoJnNwaW4pOwogZXJyX3VubG9jazoKLQlpZ3RfZmx1c2hfdGVzdChpOTE1LCBJ
OTE1X1dBSVRfTE9DS0VEKTsKIAlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9w
bSwgd2FrZXJlZik7CiAJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAly
ZXR1cm4gZXJyOwpAQCAtMjkwLDggKzI4OSw2IEBAIHN0YXRpYyBpbnQgbGl2ZV90aW1lc2xpY2Vf
cHJlZW1wdCh2b2lkICphcmcpCiBlcnJfb2JqOgogCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsK
IGVycl91bmxvY2s6Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQp
KQotCQllcnIgPSAtRUlPOwogCWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3Bt
LCB3YWtlcmVmKTsKIAltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCkBA
IC00NzIsOCArNDY5LDYgQEAgc3RhdGljIGludCBsaXZlX2J1c3l3YWl0X3ByZWVtcHQodm9pZCAq
YXJnKQogZXJyX2N0eF9oaToKIAlrZXJuZWxfY29udGV4dF9jbG9zZShjdHhfaGkpOwogZXJyX3Vu
bG9jazoKLQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCi0JCWVy
ciA9IC1FSU87CiAJaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2Vy
ZWYpOwogCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVy
cjsKQEAgLTU4MCw3ICs1NzUsNiBAQCBzdGF0aWMgaW50IGxpdmVfcHJlZW1wdCh2b2lkICphcmcp
CiBlcnJfc3Bpbl9oaToKIAlpZ3Rfc3Bpbm5lcl9maW5pKCZzcGluX2hpKTsKIGVycl91bmxvY2s6
Ci0JaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCk7CiAJaW50ZWxfcnVudGlt
ZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwogCW11dGV4X3VubG9jaygmaTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKQEAgLTY4Nyw3ICs2ODEsNiBAQCBz
dGF0aWMgaW50IGxpdmVfbGF0ZV9wcmVlbXB0KHZvaWQgKmFyZykKIGVycl9zcGluX2hpOgogCWln
dF9zcGlubmVyX2ZpbmkoJnNwaW5faGkpOwogZXJyX3VubG9jazoKLQlpZ3RfZmx1c2hfdGVzdChp
OTE1LCBJOTE1X1dBSVRfTE9DS0VEKTsKIAlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVu
dGltZV9wbSwgd2FrZXJlZik7CiAJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKIAlyZXR1cm4gZXJyOwpAQCAtODI2LDggKzgxOSw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9zdXBw
cmVzc19zZWxmX3ByZWVtcHQodm9pZCAqYXJnKQogZXJyX2NsaWVudF9hOgogCXByZWVtcHRfY2xp
ZW50X2ZpbmkoJmEpOwogZXJyX3VubG9jazoKLQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkx
NV9XQUlUX0xPQ0tFRCkpCi0JCWVyciA9IC1FSU87CiAJaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5
MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwogCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7CiAJcmV0dXJuIGVycjsKQEAgLTk5NSw4ICs5ODYsNiBAQCBzdGF0aWMgaW50IGxp
dmVfc3VwcHJlc3Nfd2FpdF9wcmVlbXB0KHZvaWQgKmFyZykKIGVycl9jbGllbnRfMDoKIAlwcmVl
bXB0X2NsaWVudF9maW5pKCZjbGllbnRbMF0pOwogZXJyX3VubG9jazoKLQlpZiAoaWd0X2ZsdXNo
X3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCi0JCWVyciA9IC1FSU87CiAJaW50ZWxfcnVu
dGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwogCW11dGV4X3VubG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKQEAgLTExNDMsOCArMTEzMiw2
IEBAIHN0YXRpYyBpbnQgbGl2ZV9jaGFpbl9wcmVlbXB0KHZvaWQgKmFyZykKIGVycl9jbGllbnRf
aGk6CiAJcHJlZW1wdF9jbGllbnRfZmluaSgmaGkpOwogZXJyX3VubG9jazoKLQlpZiAoaWd0X2Zs
dXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCi0JCWVyciA9IC1FSU87CiAJaW50ZWxf
cnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwogCW11dGV4X3VubG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKQEAgLTEyNzAsNyArMTI1
Nyw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9wcmVlbXB0X2hhbmcodm9pZCAqYXJnKQogZXJyX3NwaW5f
aGk6CiAJaWd0X3NwaW5uZXJfZmluaSgmc3Bpbl9oaSk7CiBlcnJfdW5sb2NrOgotCWlndF9mbHVz
aF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpOwogCWludGVsX3J1bnRpbWVfcG1fcHV0KCZp
OTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKIAltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CkBAIC0yMDU0LDUgKzIwNDAsNSBAQCBpbnQgaW50ZWxf
ZXhlY2xpc3RzX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
CWlmIChpOTE1X3Rlcm1pbmFsbHlfd2VkZ2VkKGk5MTUpKQogCQlyZXR1cm4gMDsKIAotCXJldHVy
biBpOTE1X3N1YnRlc3RzKHRlc3RzLCBpOTE1KTsKKwlyZXR1cm4gaTkxNV9saXZlX3N1YnRlc3Rz
KHRlc3RzLCBpOTE1KTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Nl
bGZ0ZXN0X3RpbWVsaW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF90aW1l
bGluZS5jCmluZGV4IDE5M2NjNTY0YWRlMi4uZWFlM2IxOTYzYmY3IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF90aW1lbGluZS5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3RpbWVsaW5lLmMKQEAgLTgyMSw4ICs4MjEsNiBAQCBzdGF0
aWMgaW50IGxpdmVfaHdzcF9yZWN5Y2xlKHZvaWQgKmFyZykKIAl9CiAKIG91dDoKLQlpZiAoaWd0
X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCi0JCWVyciA9IC1FSU87CiAJaW50
ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwogCW11dGV4X3Vu
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKQEAgLTg0MSw1ICs4MzksNSBAQCBpbnQg
aW50ZWxfdGltZWxpbmVfbGl2ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpCiAJaWYgKGk5MTVfdGVybWluYWxseV93ZWRnZWQoaTkxNSkpCiAJCXJldHVybiAwOwogCi0J
cmV0dXJuIGk5MTVfc3VidGVzdHModGVzdHMsIGk5MTUpOworCXJldHVybiBpOTE1X2xpdmVfc3Vi
dGVzdHModGVzdHMsIGk5MTUpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9zZWxmdGVzdC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zZWxmdGVzdC5oCmlu
ZGV4IDIwN2UyMWI0NzhmMi4uZDliMTdiOWU2OTkzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3NlbGZ0ZXN0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9z
ZWxmdGVzdC5oCkBAIC02NiwxMiArNjYsMjggQEAgc3RydWN0IGk5MTVfc3VidGVzdCB7CiAJY29u
c3QgY2hhciAqbmFtZTsKIH07CiAKK2ludCBfX2k5MTVfbm9wX3NldHVwKHZvaWQgKmRhdGEpOwor
aW50IF9faTkxNV9ub3BfdGVhcmRvd24oaW50IGVyciwgdm9pZCAqZGF0YSk7CisKK2ludCBfX2k5
MTVfbGl2ZV9zZXR1cCh2b2lkICpkYXRhKTsKK2ludCBfX2k5MTVfbGl2ZV90ZWFyZG93bihpbnQg
ZXJyLCB2b2lkICpkYXRhKTsKKwogaW50IF9faTkxNV9zdWJ0ZXN0cyhjb25zdCBjaGFyICpjYWxs
ZXIsCisJCSAgICBpbnQgKCpzZXR1cCkodm9pZCAqZGF0YSksCisJCSAgICBpbnQgKCp0ZWFyZG93
bikoaW50IGVyciwgdm9pZCAqZGF0YSksCiAJCSAgICBjb25zdCBzdHJ1Y3QgaTkxNV9zdWJ0ZXN0
ICpzdCwKIAkJICAgIHVuc2lnbmVkIGludCBjb3VudCwKIAkJICAgIHZvaWQgKmRhdGEpOwogI2Rl
ZmluZSBpOTE1X3N1YnRlc3RzKFQsIGRhdGEpIFwKLQlfX2k5MTVfc3VidGVzdHMoX19mdW5jX18s
IFQsIEFSUkFZX1NJWkUoVCksIGRhdGEpCisJX19pOTE1X3N1YnRlc3RzKF9fZnVuY19fLCBcCisJ
CQlfX2k5MTVfbm9wX3NldHVwLCBfX2k5MTVfbm9wX3RlYXJkb3duLCBcCisJCQlULCBBUlJBWV9T
SVpFKFQpLCBkYXRhKQorI2RlZmluZSBpOTE1X2xpdmVfc3VidGVzdHMoVCwgZGF0YSkgKHsgXAor
CXR5cGVjaGVjayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqLCBkYXRhKTsgXAorCV9faTkxNV9z
dWJ0ZXN0cyhfX2Z1bmNfXywgXAorCQkJX19pOTE1X2xpdmVfc2V0dXAsIF9faTkxNV9saXZlX3Rl
YXJkb3duLCBcCisJCQlULCBBUlJBWV9TSVpFKFQpLCBkYXRhKTsgXAorfSkKIAogI2RlZmluZSBT
VUJURVNUKHgpIHsgeCwgI3ggfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1
X2dlbS5jCmluZGV4IGVkMGMxN2JmNjYxMy4uYjhmZmFlNDgxNzMwIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW0uYwpAQCAtMTU0LDggKzE1NCw2IEBAIHN0YXRpYyBp
bnQgaWd0X2dlbV9zdXNwZW5kKHZvaWQgKmFyZykKIAogCW11dGV4X2xvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCWVyciA9IHN3aXRjaF90b19jb250ZXh0KGk5MTUsIGN0eCk7Ci0JaWYg
KGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQotCQllcnIgPSAtRUlPOwog
CW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiBvdXQ6CiAJbW9ja19maWxl
X2ZyZWUoaTkxNSwgZmlsZSk7CkBAIC0xOTUsOCArMTkzLDYgQEAgc3RhdGljIGludCBpZ3RfZ2Vt
X2hpYmVybmF0ZSh2b2lkICphcmcpCiAKIAltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKIAllcnIgPSBzd2l0Y2hfdG9fY29udGV4dChpOTE1LCBjdHgpOwotCWlmIChpZ3RfZmx1
c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKLQkJZXJyID0gLUVJTzsKIAltdXRleF91
bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogb3V0OgogCW1vY2tfZmlsZV9mcmVlKGk5
MTUsIGZpbGUpOwpAQCAtMjEzLDUgKzIwOSw1IEBAIGludCBpOTE1X2dlbV9saXZlX3NlbGZ0ZXN0
cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAlpZiAoaTkxNV90ZXJtaW5hbGx5X3dl
ZGdlZChpOTE1KSkKIAkJcmV0dXJuIDA7CiAKLQlyZXR1cm4gaTkxNV9zdWJ0ZXN0cyh0ZXN0cywg
aTkxNSk7CisJcmV0dXJuIGk5MTVfbGl2ZV9zdWJ0ZXN0cyh0ZXN0cywgaTkxNSk7CiB9CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9zZWxmdGVzdC5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfc2VsZnRlc3QuYwppbmRleCBiMThl
YWVmZWY3OTguLmY0NmNjZjgxN2FkNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2k5MTVfc2VsZnRlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaTkxNV9zZWxmdGVzdC5jCkBAIC0yNiw2ICsyNiw4IEBACiAjaW5jbHVkZSAiLi4vaTkx
NV9kcnYuaCIKICNpbmNsdWRlICIuLi9pOTE1X3NlbGZ0ZXN0LmgiCiAKKyNpbmNsdWRlICJpZ3Rf
Zmx1c2hfdGVzdC5oIgorCiBzdHJ1Y3QgaTkxNV9zZWxmdGVzdCBpOTE1X3NlbGZ0ZXN0IF9fcmVh
ZF9tb3N0bHkgPSB7CiAJLnRpbWVvdXRfbXMgPSAxMDAwLAogfTsKQEAgLTI0MCw3ICsyNDIsNDAg
QEAgc3RhdGljIGJvb2wgYXBwbHlfc3VidGVzdF9maWx0ZXIoY29uc3QgY2hhciAqY2FsbGVyLCBj
b25zdCBjaGFyICpuYW1lKQogCXJldHVybiByZXN1bHQ7CiB9CiAKK2ludCBfX2k5MTVfbm9wX3Nl
dHVwKHZvaWQgKmRhdGEpCit7CisJcmV0dXJuIDA7Cit9CisKK2ludCBfX2k5MTVfbm9wX3RlYXJk
b3duKGludCBlcnIsIHZvaWQgKmRhdGEpCit7CisJcmV0dXJuIGVycjsKK30KKworaW50IF9faTkx
NV9saXZlX3NldHVwKHZvaWQgKmRhdGEpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSBkYXRhOworCisJcmV0dXJuIGk5MTVfdGVybWluYWxseV93ZWRnZWQoaTkxNSk7Cit9CisK
K2ludCBfX2k5MTVfbGl2ZV90ZWFyZG93bihpbnQgZXJyLCB2b2lkICpkYXRhKQoreworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZGF0YTsKKworCW11dGV4X2xvY2soJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOworCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9D
S0VEKSkKKwkJZXJyID0gLUVJTzsKKwltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOworCisJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhpOTE1KTsKKworCXJldHVybiBl
cnI7Cit9CisKIGludCBfX2k5MTVfc3VidGVzdHMoY29uc3QgY2hhciAqY2FsbGVyLAorCQkgICAg
aW50ICgqc2V0dXApKHZvaWQgKmRhdGEpLAorCQkgICAgaW50ICgqdGVhcmRvd24pKGludCBlcnIs
IHZvaWQgKmRhdGEpLAogCQkgICAgY29uc3Qgc3RydWN0IGk5MTVfc3VidGVzdCAqc3QsCiAJCSAg
ICB1bnNpZ25lZCBpbnQgY291bnQsCiAJCSAgICB2b2lkICpkYXRhKQpAQCAtMjU1LDEwICsyOTAs
MTcgQEAgaW50IF9faTkxNV9zdWJ0ZXN0cyhjb25zdCBjaGFyICpjYWxsZXIsCiAJCWlmICghYXBw
bHlfc3VidGVzdF9maWx0ZXIoY2FsbGVyLCBzdC0+bmFtZSkpCiAJCQljb250aW51ZTsKIAorCQll
cnIgPSBzZXR1cChkYXRhKTsKKwkJaWYgKGVycikgeworCQkJcHJfZXJyKERSSVZFUl9OQU1FICIv
JXM6IHNldHVwIGZhaWxlZCBmb3IgJXNcbiIsCisJCQkgICAgICAgY2FsbGVyLCBzdC0+bmFtZSk7
CisJCQlyZXR1cm4gZXJyOworCQl9CisKIAkJcHJfaW5mbyhEUklWRVJfTkFNRSAiOiBSdW5uaW5n
ICVzLyVzXG4iLCBjYWxsZXIsIHN0LT5uYW1lKTsKIAkJR0VNX1RSQUNFKCJSdW5uaW5nICVzLyVz
XG4iLCBjYWxsZXIsIHN0LT5uYW1lKTsKIAotCQllcnIgPSBzdC0+ZnVuYyhkYXRhKTsKKwkJZXJy
ID0gdGVhcmRvd24oc3QtPmZ1bmMoZGF0YSksIGRhdGEpOwogCQlpZiAoZXJyICYmIGVyciAhPSAt
RUlOVFIpIHsKIAkJCXByX2VycihEUklWRVJfTkFNRSAiLyVzOiAlcyBmYWlsZWQgd2l0aCBlcnJv
ciAlZFxuIiwKIAkJCSAgICAgICBjYWxsZXIsIHN0LT5uYW1lLCBlcnIpOwotLSAKMi4yMC4xCgpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZngg
bWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0
cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

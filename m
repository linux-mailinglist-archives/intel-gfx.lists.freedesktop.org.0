Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 5713A87E4D
	for <lists+intel-gfx@lfdr.de>; Fri,  9 Aug 2019 17:42:03 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 99A706EE34;
	Fri,  9 Aug 2019 15:42:01 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E29AC6EE33
 for <intel-gfx@lists.freedesktop.org>; Fri,  9 Aug 2019 15:42:00 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17945318-1500050 
 for multiple; Fri, 09 Aug 2019 16:41:48 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  9 Aug 2019 16:41:45 +0100
Message-Id: <20190809154146.16397-3-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190809154146.16397-1-chris@chris-wilson.co.uk>
References: <20190809154146.16397-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 3/4] drm/i915: Push the ring creation flags to
 the backend
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UHVzaCB0aGUgcmluZyBjcmVhdGlvbiBmbGFncyBmcm9tIHRoZSBvdXRlciBHRU0gY29udGV4dCB0
byB0aGUgaW5uZXIKaW50ZWxfY29udGV4dCB0byBhdm9pZCBhbiB1bnNpZ2h0bHkgYmFjay1yZWZl
cmVuY2UgZnJvbSBpbnNpZGUgdGhlCmJhY2tlbmQuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxz
b24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KUmV2aWV3ZWQtYnk6IEFuZGkgU2h5dGkgPGFu
ZGkuc2h5dGlAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9jb250ZXh0LmMgICB8IDM4ICsrKysrKysrKysrKy0tLS0tLS0KIC4uLi9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX2NvbnRleHRfdHlwZXMuaCB8ICAzIC0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9jb250ZXh0LmMgICAgICAgfCAgMSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9jb250ZXh0LmggICAgICAgfCAgNSArKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2VuZ2luZV9jcy5jICAgICB8ICAyICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2xyYy5jICAgICAgICAgICB8ICA1ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfcmluZ2J1ZmZlci5jICAgIHwgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L21vY2tf
ZW5naW5lLmMgICAgICAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1
bGVyLmMgICAgICAgICAgfCAgOCArKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVn
ZnMuYyAgICAgICAgICAgfCAyMyArKysrKysrLS0tLQogMTAgZmlsZXMgY2hhbmdlZCwgNTggaW5z
ZXJ0aW9ucygrKSwgMzEgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9jb250ZXh0LmMKaW5kZXggYWZkOTk0MzkxYWQ3Li42MjhkNjlhNGQzNjggMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwpAQCAtNDM2LDggKzQz
Niw2IEBAIF9fY3JlYXRlX2NvbnRleHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJ
aTkxNV9nZW1fY29udGV4dF9zZXRfYmFubmFibGUoY3R4KTsKIAlpOTE1X2dlbV9jb250ZXh0X3Nl
dF9yZWNvdmVyYWJsZShjdHgpOwogCi0JY3R4LT5yaW5nX3NpemUgPSA0ICogUEFHRV9TSVpFOwot
CiAJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUoY3R4LT5oYW5nX3RpbWVzdGFtcCk7IGkrKykK
IAkJY3R4LT5oYW5nX3RpbWVzdGFtcFtpXSA9IGppZmZpZXMgLSBDT05URVhUX0ZBU1RfSEFOR19K
SUZGSUVTOwogCkBAIC00NDgsMjIgKzQ0NiwzNCBAQCBfX2NyZWF0ZV9jb250ZXh0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogCXJldHVybiBFUlJfUFRSKGVycik7CiB9CiAKK3N0YXRp
YyB2b2lkCitjb250ZXh0X2FwcGx5X2FsbChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAor
CQkgIHZvaWQgKCpmbikoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCB2b2lkICpkYXRhKSwKKwkJ
ICB2b2lkICpkYXRhKQoreworCXN0cnVjdCBpOTE1X2dlbV9lbmdpbmVzX2l0ZXIgaXQ7CisJc3Ry
dWN0IGludGVsX2NvbnRleHQgKmNlOworCisJZm9yX2VhY2hfZ2VtX2VuZ2luZShjZSwgaTkxNV9n
ZW1fY29udGV4dF9sb2NrX2VuZ2luZXMoY3R4KSwgaXQpCisJCWZuKGNlLCBkYXRhKTsKKwlpOTE1
X2dlbV9jb250ZXh0X3VubG9ja19lbmdpbmVzKGN0eCk7Cit9CisKK3N0YXRpYyB2b2lkIF9fYXBw
bHlfcHBndHQoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCB2b2lkICp2bSkKK3sKKwlpOTE1X3Zt
X3B1dChjZS0+dm0pOworCWNlLT52bSA9IGk5MTVfdm1fZ2V0KHZtKTsKK30KKwogc3RhdGljIHN0
cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKgogX19zZXRfcHBndHQoc3RydWN0IGk5MTVfZ2VtX2Nv
bnRleHQgKmN0eCwgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiB7CiAJc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqb2xkID0gY3R4LT52bTsKLQlzdHJ1Y3QgaTkxNV9nZW1fZW5naW5l
c19pdGVyIGl0OwotCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAogCUdFTV9CVUdfT04ob2xk
ICYmIGk5MTVfdm1faXNfNGx2bCh2bSkgIT0gaTkxNV92bV9pc180bHZsKG9sZCkpOwogCiAJY3R4
LT52bSA9IGk5MTVfdm1fZ2V0KHZtKTsKLQotCWZvcl9lYWNoX2dlbV9lbmdpbmUoY2UsIGk5MTVf
Z2VtX2NvbnRleHRfbG9ja19lbmdpbmVzKGN0eCksIGl0KSB7Ci0JCWk5MTVfdm1fcHV0KGNlLT52
bSk7Ci0JCWNlLT52bSA9IGk5MTVfdm1fZ2V0KHZtKTsKLQl9Ci0JaTkxNV9nZW1fY29udGV4dF91
bmxvY2tfZW5naW5lcyhjdHgpOworCWNvbnRleHRfYXBwbHlfYWxsKGN0eCwgX19hcHBseV9wcGd0
dCwgdm0pOwogCiAJcmV0dXJuIG9sZDsKIH0KQEAgLTU2MCw3ICs1NzAsNiBAQCBpOTE1X2dlbV9j
b250ZXh0X2NyZWF0ZV9rZXJuZWwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGludCBw
cmlvKQogCiAJaTkxNV9nZW1fY29udGV4dF9jbGVhcl9iYW5uYWJsZShjdHgpOwogCWN0eC0+c2No
ZWQucHJpb3JpdHkgPSBJOTE1X1VTRVJfUFJJT1JJVFkocHJpbyk7Ci0JY3R4LT5yaW5nX3NpemUg
PSBQQUdFX1NJWkU7CiAKIAlHRU1fQlVHX09OKCFpOTE1X2dlbV9jb250ZXh0X2lzX2tlcm5lbChj
dHgpKTsKIApAQCAtMTU0NCw2ICsxNTUzLDcgQEAgc2V0X2VuZ2luZXMoc3RydWN0IGk5MTVfZ2Vt
X2NvbnRleHQgKmN0eCwKIAlmb3IgKG4gPSAwOyBuIDwgbnVtX2VuZ2luZXM7IG4rKykgewogCQlz
dHJ1Y3QgaTkxNV9lbmdpbmVfY2xhc3NfaW5zdGFuY2UgY2k7CiAJCXN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZTsKKwkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCiAJCWlmIChjb3B5
X2Zyb21fdXNlcigmY2ksICZ1c2VyLT5lbmdpbmVzW25dLCBzaXplb2YoY2kpKSkgewogCQkJX19m
cmVlX2VuZ2luZXMoc2V0LmVuZ2luZXMsIG4pOwpAQCAtMTU2NiwxMSArMTU3NiwxMyBAQCBzZXRf
ZW5naW5lcyhzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogCQkJcmV0dXJuIC1FTk9FTlQ7
CiAJCX0KIAotCQlzZXQuZW5naW5lcy0+ZW5naW5lc1tuXSA9IGludGVsX2NvbnRleHRfY3JlYXRl
KGN0eCwgZW5naW5lKTsKLQkJaWYgKCFzZXQuZW5naW5lcy0+ZW5naW5lc1tuXSkgeworCQljZSA9
IGludGVsX2NvbnRleHRfY3JlYXRlKGN0eCwgZW5naW5lKTsKKwkJaWYgKCFjZSkgewogCQkJX19m
cmVlX2VuZ2luZXMoc2V0LmVuZ2luZXMsIG4pOwogCQkJcmV0dXJuIC1FTk9NRU07CiAJCX0KKwor
CQlzZXQuZW5naW5lcy0+ZW5naW5lc1tuXSA9IGNlOwogCX0KIAlzZXQuZW5naW5lcy0+bnVtX2Vu
Z2luZXMgPSBudW1fZW5naW5lczsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX2NvbnRleHRfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9jb250ZXh0X3R5cGVzLmgKaW5kZXggYTAyZDk4NDk0MDc4Li4yNjBkNTljYzNkZTgg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0X3R5
cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHRfdHlw
ZXMuaApAQCAtMTY5LDkgKzE2OSw2IEBAIHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0IHsKIAogCXN0
cnVjdCBpOTE1X3NjaGVkX2F0dHIgc2NoZWQ7CiAKLQkvKiogcmluZ19zaXplOiBzaXplIGZvciBh
bGxvY2F0aW5nIHRoZSBwZXItZW5naW5lIHJpbmcgYnVmZmVyICovCi0JdTMyIHJpbmdfc2l6ZTsK
LQogCS8qKiBndWlsdHlfY291bnQ6IEhvdyBtYW55IHRpbWVzIHRoaXMgY29udGV4dCBoYXMgY2F1
c2VkIGEgR1BVIGhhbmcuICovCiAJYXRvbWljX3QgZ3VpbHR5X2NvdW50OwogCS8qKgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCmluZGV4IDQxZDM4ZTY2MWRlNy4uNmQxZDRl
OGRiZmM5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCkBAIC0yMjIs
NiArMjIyLDcgQEAgaW50ZWxfY29udGV4dF9pbml0KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwK
IAljZS0+ZW5naW5lID0gZW5naW5lOwogCWNlLT5vcHMgPSBlbmdpbmUtPmNvcHM7CiAJY2UtPnNz
ZXUgPSBlbmdpbmUtPnNzZXU7CisJY2UtPnJpbmcgPSBfX2ludGVsX2NvbnRleHRfcmluZ19zaXpl
KFNaXzE2Syk7CiAKIAlJTklUX0xJU1RfSEVBRCgmY2UtPnNpZ25hbF9saW5rKTsKIAlJTklUX0xJ
U1RfSEVBRCgmY2UtPnNpZ25hbHMpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfY29udGV4dC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4
dC5oCmluZGV4IDA3Zjk5MjRkZTQ4Zi4uMTNmMjhkZDMxNmJjIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfY29udGV4dC5oCkBAIC0xMzYsNCArMTM2LDkgQEAgaW50IGludGVsX2NvbnRl
eHRfcHJlcGFyZV9yZW1vdGVfcmVxdWVzdChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAKIHN0
cnVjdCBpOTE1X3JlcXVlc3QgKmludGVsX2NvbnRleHRfY3JlYXRlX3JlcXVlc3Qoc3RydWN0IGlu
dGVsX2NvbnRleHQgKmNlKTsKIAorc3RhdGljIGlubGluZSBzdHJ1Y3QgaW50ZWxfcmluZyAqX19p
bnRlbF9jb250ZXh0X3Jpbmdfc2l6ZSh1NjQgc3opCit7CisJcmV0dXJuIHU2NF90b19wdHIoc3Ry
dWN0IGludGVsX3JpbmcsIHN6KTsKK30KKwogI2VuZGlmIC8qIF9fSU5URUxfQ09OVEVYVF9IX18g
Ki8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKaW5kZXggNjM0ZWY0
NWI3N2RhLi5lY2U3MzFhYjdiM2EgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2VuZ2luZV9jcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Vu
Z2luZV9jcy5jCkBAIC03MzgsNiArNzM4LDggQEAgY3JlYXRlX2tlcm5lbF9jb250ZXh0KHN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAlpZiAoSVNfRVJSKGNlKSkKIAkJcmV0dXJuIGNl
OwogCisJY2UtPnJpbmcgPSBfX2ludGVsX2NvbnRleHRfcmluZ19zaXplKFNaXzRLKTsKKwogCWVy
ciA9IGludGVsX2NvbnRleHRfcGluKGNlKTsKIAlpZiAoZXJyKSB7CiAJCWludGVsX2NvbnRleHRf
cHV0KGNlKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKaW5kZXggMTcyY2UzZTA3N2Zj
Li45YTlhOGY4NmMwNjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCkBAIC0zMTE1
LDkgKzMxMTUsOCBAQCBzdGF0aWMgaW50IF9fZXhlY2xpc3RzX2NvbnRleHRfYWxsb2Moc3RydWN0
IGludGVsX2NvbnRleHQgKmNlLAogCQlnb3RvIGVycm9yX2RlcmVmX29iajsKIAl9CiAKLQlyaW5n
ID0gaW50ZWxfZW5naW5lX2NyZWF0ZV9yaW5nKGVuZ2luZSwKLQkJCQkJdGltZWxpbmUsCi0JCQkJ
CWNlLT5nZW1fY29udGV4dC0+cmluZ19zaXplKTsKKwlyaW5nID0gaW50ZWxfZW5naW5lX2NyZWF0
ZV9yaW5nKGVuZ2luZSwgdGltZWxpbmUsCisJCQkJCSh1bnNpZ25lZCBsb25nKWNlLT5yaW5nKTsK
IAlpbnRlbF90aW1lbGluZV9wdXQodGltZWxpbmUpOwogCWlmIChJU19FUlIocmluZykpIHsKIAkJ
cmV0ID0gUFRSX0VSUihyaW5nKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX3JpbmdidWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jpbmdi
dWZmZXIuYwppbmRleCA3ZGI1NjFlMDYzMTIuLjU5Mjk5ZjI4NDliYiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYwpAQCAtMjM1MCw3ICsyMzUwLDcgQEAgaW50
IGludGVsX3Jpbmdfc3VibWlzc2lvbl9pbml0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZSkKIAl9CiAJR0VNX0JVR19PTih0aW1lbGluZS0+aGFzX2luaXRpYWxfYnJlYWRjcnVtYik7CiAK
LQlyaW5nID0gaW50ZWxfZW5naW5lX2NyZWF0ZV9yaW5nKGVuZ2luZSwgdGltZWxpbmUsIDMyICog
UEFHRV9TSVpFKTsKKwlyaW5nID0gaW50ZWxfZW5naW5lX2NyZWF0ZV9yaW5nKGVuZ2luZSwgdGlt
ZWxpbmUsIFNaXzE2Syk7CiAJaW50ZWxfdGltZWxpbmVfcHV0KHRpbWVsaW5lKTsKIAlpZiAoSVNf
RVJSKHJpbmcpKSB7CiAJCWVyciA9IFBUUl9FUlIocmluZyk7CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9tb2NrX2VuZ2luZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
bW9ja19lbmdpbmUuYwppbmRleCA4NDhhODNhMzhiMDguLjc5YmFlZDFhYWYzOCAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvbW9ja19lbmdpbmUuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9tb2NrX2VuZ2luZS5jCkBAIC0xNDAsNyArMTQwLDcgQEAgc3RhdGljIHZv
aWQgbW9ja19jb250ZXh0X2Rlc3Ryb3koc3RydWN0IGtyZWYgKnJlZikKIAogCUdFTV9CVUdfT04o
aW50ZWxfY29udGV4dF9pc19waW5uZWQoY2UpKTsKIAotCWlmIChjZS0+cmluZykKKwlpZiAodGVz
dF9iaXQoQ09OVEVYVF9BTExPQ19CSVQsICZjZS0+ZmxhZ3MpKQogCQltb2NrX3JpbmdfZnJlZShj
ZS0+cmluZyk7CiAKIAlpbnRlbF9jb250ZXh0X2ZpbmkoY2UpOwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0
L3NjaGVkdWxlci5jCmluZGV4IGEzOGRkYjU3ZTc4Ni4uMWEyOGUzNjY2OTUxIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVyLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jCkBAIC0xMjI4LDggKzEyMjgsNiBAQCBpbnQgaW50ZWxf
dmdwdV9zZXR1cF9zdWJtaXNzaW9uKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQogCX0KIAogCWk5
MTVfZ2VtX2NvbnRleHRfc2V0X2ZvcmNlX3NpbmdsZV9zdWJtaXNzaW9uKGN0eCk7Ci0JaWYgKCFV
U0VTX0dVQ19TVUJNSVNTSU9OKGk5MTUpKQotCQljdHgtPnJpbmdfc2l6ZSA9IDUxMiAqIFBBR0Vf
U0laRTsgLyogTWF4IHJpbmcgYnVmZmVyIHNpemUgKi8KIAogCWk5MTVfY29udGV4dF9wcGd0dF9y
b290X3NhdmUocywgaTkxNV92bV90b19wcGd0dChjdHgtPnZtKSk7CiAKQEAgLTEyNDUsNiArMTI0
MywxMiBAQCBpbnQgaW50ZWxfdmdwdV9zZXR1cF9zdWJtaXNzaW9uKHN0cnVjdCBpbnRlbF92Z3B1
ICp2Z3B1KQogCQkJZ290byBvdXRfc2hhZG93X2N0eDsKIAkJfQogCisJCWlmICghVVNFU19HVUNf
U1VCTUlTU0lPTihpOTE1KSkgeyAvKiBNYXggcmluZyBidWZmZXIgc2l6ZSAqLworCQkJY29uc3Qg
dW5zaWduZWQgaW50IHJpbmdfc2l6ZSA9IDUxMiAqIFNaXzRLOworCisJCQljZS0+cmluZyA9IF9f
aW50ZWxfY29udGV4dF9yaW5nX3NpemUocmluZ19zaXplKTsKKwkJfQorCiAJCXJldCA9IGludGVs
X2NvbnRleHRfcGluKGNlKTsKIAkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwogCQlpZiAocmV0KQpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwppbmRleCBiZGRiYmQ5NTlkMWIuLmU0ZjE3M2Yy
ZjNjMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKQEAgLTMyNCwxMCArMzI0LDE0
IEBAIHN0YXRpYyB2b2lkIHByaW50X2NvbnRleHRfc3RhdHMoc3RydWN0IHNlcV9maWxlICptLAog
CiAJCWZvcl9lYWNoX2dlbV9lbmdpbmUoY2UsCiAJCQkJICAgIGk5MTVfZ2VtX2NvbnRleHRfbG9j
a19lbmdpbmVzKGN0eCksIGl0KSB7Ci0JCQlpZiAoY2UtPnN0YXRlKQotCQkJCXBlcl9maWxlX3N0
YXRzKDAsIGNlLT5zdGF0ZS0+b2JqLCAma3N0YXRzKTsKLQkJCWlmIChjZS0+cmluZykKKwkJCWlu
dGVsX2NvbnRleHRfbG9ja19waW5uZWQoY2UpOworCQkJaWYgKGludGVsX2NvbnRleHRfaXNfcGlu
bmVkKGNlKSkgeworCQkJCWlmIChjZS0+c3RhdGUpCisJCQkJCXBlcl9maWxlX3N0YXRzKDAsCisJ
CQkJCQkgICAgICAgY2UtPnN0YXRlLT5vYmosICZrc3RhdHMpOwogCQkJCXBlcl9maWxlX3N0YXRz
KDAsIGNlLT5yaW5nLT52bWEtPm9iaiwgJmtzdGF0cyk7CisJCQl9CisJCQlpbnRlbF9jb250ZXh0
X3VubG9ja19waW5uZWQoY2UpOwogCQl9CiAJCWk5MTVfZ2VtX2NvbnRleHRfdW5sb2NrX2VuZ2lu
ZXMoY3R4KTsKIApAQCAtMTYyNywxMiArMTYzMSwxNSBAQCBzdGF0aWMgaW50IGk5MTVfY29udGV4
dF9zdGF0dXMoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICp1bnVzZWQpCiAKIAkJZm9yX2VhY2hf
Z2VtX2VuZ2luZShjZSwKIAkJCQkgICAgaTkxNV9nZW1fY29udGV4dF9sb2NrX2VuZ2luZXMoY3R4
KSwgaXQpIHsKLQkJCXNlcV9wcmludGYobSwgIiVzOiAiLCBjZS0+ZW5naW5lLT5uYW1lKTsKLQkJ
CWlmIChjZS0+c3RhdGUpCi0JCQkJZGVzY3JpYmVfb2JqKG0sIGNlLT5zdGF0ZS0+b2JqKTsKLQkJ
CWlmIChjZS0+cmluZykKKwkJCWludGVsX2NvbnRleHRfbG9ja19waW5uZWQoY2UpOworCQkJaWYg
KGludGVsX2NvbnRleHRfaXNfcGlubmVkKGNlKSkgeworCQkJCXNlcV9wcmludGYobSwgIiVzOiAi
LCBjZS0+ZW5naW5lLT5uYW1lKTsKKwkJCQlpZiAoY2UtPnN0YXRlKQorCQkJCQlkZXNjcmliZV9v
YmoobSwgY2UtPnN0YXRlLT5vYmopOwogCQkJCWRlc2NyaWJlX2N0eF9yaW5nKG0sIGNlLT5yaW5n
KTsKLQkJCXNlcV9wdXRjKG0sICdcbicpOworCQkJCXNlcV9wdXRjKG0sICdcbicpOworCQkJfQor
CQkJaW50ZWxfY29udGV4dF91bmxvY2tfcGlubmVkKGNlKTsKIAkJfQogCQlpOTE1X2dlbV9jb250
ZXh0X3VubG9ja19lbmdpbmVzKGN0eCk7CiAKLS0gCjIuMjMuMC5yYzEKCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QK
SW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9w
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

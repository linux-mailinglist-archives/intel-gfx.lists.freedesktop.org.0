Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id CC66A3086AD
	for <lists+intel-gfx@lfdr.de>; Fri, 29 Jan 2021 08:45:57 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 36FEE6EA81;
	Fri, 29 Jan 2021 07:45:56 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga06.intel.com (mga06.intel.com [134.134.136.31])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4F6596EA80
 for <intel-gfx@lists.freedesktop.org>; Fri, 29 Jan 2021 07:45:55 +0000 (UTC)
IronPort-SDR: xZXHNdgSp09ldZGfxigk9RrjnQMwKpADmdu+7Q9yJFa8fKVpS0OgZaWBN707MsyzQ20ABYyNb9
 IT558PnSUyxw==
X-IronPort-AV: E=McAfee;i="6000,8403,9878"; a="241905490"
X-IronPort-AV: E=Sophos;i="5.79,384,1602572400"; d="scan'208";a="241905490"
Received: from orsmga001.jf.intel.com ([10.7.209.18])
 by orsmga104.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 28 Jan 2021 23:45:54 -0800
IronPort-SDR: MhgJ1UdnuZ6hRmblFugX2LF1UU7bO73TA+IdNWytctvCqSE4BwdkB81Evj5QM4pDNe+scKW+P/
 GMXKY4rfMn1g==
X-IronPort-AV: E=Sophos;i="5.79,384,1602572400"; d="scan'208";a="430895428"
Received: from jjrevuel-mobl1.amr.corp.intel.com (HELO
 helsinki.ger.corp.intel.com) ([10.213.197.104])
 by orsmga001-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 28 Jan 2021 23:45:52 -0800
From: Gwan-gyeong Mun <gwan-gyeong.mun@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 29 Jan 2021 09:45:46 +0200
Message-Id: <20210129074547.1721344-1-gwan-gyeong.mun@intel.com>
X-Mailer: git-send-email 2.30.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v14 1/2] drm/i915/display: Support PSR Multiple
 Instances
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SXQgaXMgYSBwcmVsaW1pbmFyeSB3b3JrIGZvciBzdXBwb3J0aW5nIG11bHRpcGxlIEVEUCBQU1Ig
YW5kCkRQIFBhbmVsUmVwbGF5LiBBbmQgaXQgcmVmYWN0b3JzIHNpbmdsZXRvbiBQU1IgdG8gTXVs
dGkgVHJhbnNjb2RlcgpzdXBwb3J0YWJsZSBQU1IuCkFuZCB0aGlzIG1vdmVzIGFuZCByZW5hbWVz
IHRoZSBpOTE1X3BzciBzdHJ1Y3R1cmUgb2YgZHJtX2k5MTVfcHJpdmF0ZSdzIHRvCmludGVsX2Rw
J3MgaW50ZWxfcHNyIHN0cnVjdHVyZS4KSXQgYWxzbyBjYXVzZXMgY2hhbmdlcyBpbiBQU1IgaW50
ZXJydXB0IGhhbmRsaW5nIHJvdXRpbmUgZm9yIHN1cHBvcnRpbmcKbXVsdGlwbGUgdHJhbnNjb2Rl
cnMuIEJ1dCBpdCBkb2VzIG5vdCBjaGFuZ2UgdGhlIHNjZW5hcmlvIGFuZCB0aW1pbmcgb2YKZW5h
YmxpbmcgYW5kIGRpc2FibGluZyBQU1IuIEFuZCBpdCBub3Qgc3VwcG9ydCBtdWx0aXBsZSBwaXBl
cyB3aXRoCmEgc2luZ2xlIHRyYW5zY29kZXIgUFNSIGNhc2UgeWV0LgoKdjI6IEZpeCBpbmRlbnRh
dGlvbiBhbmQgYWRkIGNvbW1lbnRzCnYzOiBSZW1vdmUgQmxhbmsgbGluZQp2NDogUmViYXNlZAp2
NTogUmViYXNlZCBhbmQgQWRkcmVzc2VkIEFuc2h1bWFuJ3MgcmV2aWV3IGNvbW1lbnQuCiAgICAt
IE1vdmUgY2FsbGluZyBvZiBpbnRlbF9wc3JfaW5pdCgpIHRvIGludGVsX2RwX2luaXRfY29ubmVj
dG9yKCkKdjY6IEFkZHJlc3MgQW5zaHVtYW4ncyByZXZpZXcgY29tbWVudHMKICAgLSBSZW1vdmUg
d3JvbmcgY29tbWVudHMgYW5kIGFkZCBjb21tZW50cyBmb3IgYSBsaW1pdCBvZiBzdXBwb3J0aW5n
IG9mCiAgICAgYSBzaW5nbGUgcGlwZSBQU1IKdjc6IFVwZGF0ZSBpbnRlbF9wc3JfY29tcHV0ZV9j
b25maWcoKSBmb3Igc3VwcG9ydGluZyBtdWx0aXBsZSB0cmFuc2NvZGVyCiAgICBQU1Igb24gQkRX
Kwp2ODogQWRkcmVzcyBBbnNodW1hbidzIHJldmlldyBjb21tZW50cwogICAtIFJlcGxhY2UgRFJN
X0RFQlVHX0tNUyB3aXRoIGRybV9kYmdfa21zKCkgLyBEUk1fV0FSTiB3aXRoIGRybV93YXJuKCkK
djk6IEZpeCBjb21taXQgbWVzc2FnZQp2MTA6IFJlYmFzZWQKdjExOiBBZGRyZXNzIEpvc2UncyBy
ZXZpZXcgY29tbWVudC4KICAtIFJlb3JkZXIgY2FsbGluZyBvcmRlciBvZiBpbnRlbF9wc3IyX3By
b2dyYW1fdHJhbnNfbWFuX3Rya19jdGwoKS4KICAtIEluIG9yZGVyIHRvIHJlZHVjZSBjaGFuZ2Vz
IGtlZXAgdGhlIG9sZCBuYW1lIGZvciBkcm1faTkxNV9wcml2YXRlLgogIC0gQ2hhbmdlIHJlc3Ry
aWN0aW9ucyBvZiBtdWx0aXBsZSBpbnN0YW5jZXMgb2YgUFNSLgp2MTI6IEFkZHJlc3MgSm9zZSdz
IHJldmlldyBjb21tZW50LgogIC0gQ2hhbmdlIHRoZSBjYWxsaW5nIG9mIGludGVsX3BzcjJfcHJv
Z3JhbV90cmFuc19tYW5fdHJrX2N0bCgpIGludG8KICAgIGNvbW1pdF9waXBlX2NvbmZpZygpLgog
IC0gQ2hhbmdlIGEgY2hlY2tpbmcgb3JkZXIgb2YgQ0FOX1BTUigpIGFuZCBjb25uZWN0b3Jfc3Rh
dHVzIHRvIG9yaWdpbmFsCiAgICBvbiBpOTE1X3Bzcl9zaW5rX3N0YXR1c19zaG93KCkuCiAgLSBE
cm9wIHVubmVlZGVkIGludGVsX2RwX3VwZGF0ZV9waXBlKCkgZnVuY3Rpb24uCiAgLSBJbiBvcmRl
ciB0byB3YWl0IGEgc3BlY2lmaWMgZW5jb2RlciB3aGljaCBiZWxvbmcgdG8gY3J0Y19zdGF0ZSBv
bgogICAgaW50ZWxfcHNyX3dhaXRfZm9yX2lkbGUoKSwgYWRkIGNoZWNraW5nIG9mIGVuY29kZXIu
CiAgLSBBZGQgYW4gd2hpdGVzcGFjZSB0byBjb21tZW50cy4KdjEzOiBSZWJhc2VkIGFuZCBBZGRy
ZXNzIEpvc2UncyByZXZpZXcgY29tbWVudC4KICAtIEFkZCBhbmQgdXNlIGZvcl9lYWNoX2ludGVs
X3Bzcl9lbmFibGVkX2VuY29kZXIoKSBtYWNyby4KICAtIEluIG9yZGVyIHRvIHVzZSBjb3JyZWN0
IGZyb250YnVmZmVyX2JpdCBmb3IgZWFjaCBwaXBlLAogICAgZml4IGludGVsX3Bzcl9pbnZhbGlk
YXRlKCkgYW5kIGludGVsX3Bzcl9mbHVzaCgpLgogIC0gUmVtb3ZlIHJlZHVuZGFudCBvciB1bm5l
ZWRlZCBjb2Rlcy4KICAtIFVwZGF0ZSBjb21tZW50cy4KdjE0OiBBZGRyZXNzIEpvc2UncyByZXZp
ZXcgY29tbWVudAogIC0gQWRkIGFuZCB1c2UgZm9yX2VhY2hfaW50ZWxfZW5jb2Rlcl9jYW5fcHNy
KCkgbWFjcm8gYW5kCiAgICBmb3JfZWFjaF9pbnRlbF9lbmNvZGVyX21hc2tfY2FuX3BzcigpIG1h
Y3JvLgogIC0gQWRkIHNvdXJjZV9zdXBwb3J0IG1lbWJlciB2YXJpYWJsZSBpbnRvIGludGVsX3Bz
ciBzdHJ1Y3R1cmUuCiAgLSBVcGRhdGUgQ0FOX1BTUigpIG1hY3JvIHRoYXQgY2hlY2tzIHNvdXJj
ZV9zdXBwb3J0LgogIC0gTW92ZSBlbmNvZGVyJ3MgUFNSIGF2YWlsaXR5IGNoZWNrIHRvIHBzcl9p
bml0KCkgZnJvbQogICAgcHNyX2NvbXB1dGVfY29uZmlnKCkuCiAgLSBSZW1vdmUgcmVkdW5kYW50
IG9yIHVubmVlZGVkIGNvZGVzLgoKU2lnbmVkLW9mZi1ieTogR3dhbi1neWVvbmcgTXVuIDxnd2Fu
LWd5ZW9uZy5tdW5AaW50ZWwuY29tPgpDYzogSm9zw6kgUm9iZXJ0byBkZSBTb3V6YSA8am9zZS5z
b3V6YUBpbnRlbC5jb20+CkNjOiBKdWhhLVBla2thIEhlaWtraWxhIDxqdWhhcGVra2EuaGVpa2tp
bGFAZ21haWwuY29tPgpDYzogQW5zaHVtYW4gR3VwdGEgPGFuc2h1bWFuLmd1cHRhQGludGVsLmNv
bT4KUmV2aWV3ZWQtYnk6IEFuc2h1bWFuIEd1cHRhIDxhbnNodW1hbi5ndXB0YUBpbnRlbC5jb20+
Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgIHwgICAy
IC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5oICB8ICAgOSAr
CiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X2RlYnVnZnMuYyAgfCAgOTUgKyst
CiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggICAgfCAgNTEgKysK
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYyAgICAgICB8ICAxMCArLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYyAgICAgIHwgNjA1ICsrKysr
KysrKystLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuaCAg
ICAgIHwgIDEwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5j
ICAgfCAgIDYgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggICAgICAgICAgICAg
ICB8ICAzOCAtLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuYyAgICAgICAgICAgICAg
IHwgIDQyICstCiAxMCBmaWxlcyBjaGFuZ2VkLCA0OTIgaW5zZXJ0aW9ucygrKSwgMzc2IGRlbGV0
aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMK
aW5kZXggZDAxM2IwZmFiMTI4Li4xNjNhMmM0ZWIzMTMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBAIC0xNDE0MSw4ICsxNDE0MSw2IEBAIHN0YXRp
YyB2b2lkIGludGVsX3NldHVwX291dHB1dHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2KQogCQlpbnRlbF9kdm9faW5pdChkZXZfcHJpdik7CiAJfQogCi0JaW50ZWxfcHNyX2luaXQo
ZGV2X3ByaXYpOwotCiAJZm9yX2VhY2hfaW50ZWxfZW5jb2RlcigmZGV2X3ByaXYtPmRybSwgZW5j
b2RlcikgewogCQllbmNvZGVyLT5iYXNlLnBvc3NpYmxlX2NydGNzID0KIAkJCWludGVsX2VuY29k
ZXJfcG9zc2libGVfY3J0Y3MoZW5jb2Rlcik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGlzcGxheS5oCmluZGV4IDY0ZmZhMzQ1NDRhNy4uYzcyZTQxYjYxMzQ5IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuaAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuaApAQCAtNDE3LDEw
ICs0MTcsMTkgQEAgZW51bSBwaHlfZmlhIHsKIAkJZm9yX2VhY2hfaWYoKGVuY29kZXJfbWFzaykg
JgkJCQlcCiAJCQkgICAgZHJtX2VuY29kZXJfbWFzaygmaW50ZWxfZW5jb2Rlci0+YmFzZSkpCiAK
KyNkZWZpbmUgZm9yX2VhY2hfaW50ZWxfZW5jb2Rlcl9tYXNrX2Nhbl9wc3IoZGV2LCBpbnRlbF9l
bmNvZGVyLCBlbmNvZGVyX21hc2spIFwKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5KChpbnRlbF9lbmNv
ZGVyKSwgJihkZXYpLT5tb2RlX2NvbmZpZy5lbmNvZGVyX2xpc3QsIGJhc2UuaGVhZCkgXAorCQlm
b3JfZWFjaF9pZigoKGVuY29kZXJfbWFzaykgJiBkcm1fZW5jb2Rlcl9tYXNrKCYoaW50ZWxfZW5j
b2RlciktPmJhc2UpKSAmJiBcCisJCQkgICAgaW50ZWxfZW5jb2Rlcl9jYW5fcHNyKGludGVsX2Vu
Y29kZXIpKQorCiAjZGVmaW5lIGZvcl9lYWNoX2ludGVsX2RwKGRldiwgaW50ZWxfZW5jb2RlcikJ
CQlcCiAJZm9yX2VhY2hfaW50ZWxfZW5jb2RlcihkZXYsIGludGVsX2VuY29kZXIpCQlcCiAJCWZv
cl9lYWNoX2lmKGludGVsX2VuY29kZXJfaXNfZHAoaW50ZWxfZW5jb2RlcikpCiAKKyNkZWZpbmUg
Zm9yX2VhY2hfaW50ZWxfZW5jb2Rlcl9jYW5fcHNyKGRldiwgaW50ZWxfZW5jb2RlcikgXAorCWZv
cl9lYWNoX2ludGVsX2VuY29kZXIoKGRldiksIChpbnRlbF9lbmNvZGVyKSkgXAorCQlmb3JfZWFj
aF9pZihpbnRlbF9lbmNvZGVyX2Nhbl9wc3IoaW50ZWxfZW5jb2RlcikpCisKICNkZWZpbmUgZm9y
X2VhY2hfaW50ZWxfY29ubmVjdG9yX2l0ZXIoaW50ZWxfY29ubmVjdG9yLCBpdGVyKSBcCiAJd2hp
bGUgKChpbnRlbF9jb25uZWN0b3IgPSB0b19pbnRlbF9jb25uZWN0b3IoZHJtX2Nvbm5lY3Rvcl9s
aXN0X2l0ZXJfbmV4dChpdGVyKSkpKQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfZGVidWdmcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kaXNwbGF5X2RlYnVnZnMuYwppbmRleCBkNjJiMThkNWVjZDguLmIxYmRh
MWY1ZWYxNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
aXNwbGF5X2RlYnVnZnMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2Rpc3BsYXlfZGVidWdmcy5jCkBAIC0yNDksMTIgKzI0OSwxMSBAQCBzdGF0aWMgaW50IGk5MTVf
cHNyX3Npbmtfc3RhdHVzX3Nob3coc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCQki
c2luayBpbnRlcm5hbCBlcnJvciIsCiAJfTsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVj
dG9yID0gbS0+cHJpdmF0ZTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGNvbm5lY3Rvci0+ZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0KIAkJ
aW50ZWxfYXR0YWNoZWRfZHAodG9faW50ZWxfY29ubmVjdG9yKGNvbm5lY3RvcikpOwogCWludCBy
ZXQ7CiAKLQlpZiAoIUNBTl9QU1IoZGV2X3ByaXYpKSB7CisJaWYgKCFDQU5fUFNSKGludGVsX2Rw
KSkgewogCQlzZXFfcHV0cyhtLCAiUFNSIFVuc3VwcG9ydGVkXG4iKTsKIAkJcmV0dXJuIC1FTk9E
RVY7CiAJfQpAQCAtMjgwLDEyICsyNzksMTMgQEAgc3RhdGljIGludCBpOTE1X3Bzcl9zaW5rX3N0
YXR1c19zaG93KHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKIERFRklORV9TSE9XX0FU
VFJJQlVURShpOTE1X3Bzcl9zaW5rX3N0YXR1cyk7CiAKIHN0YXRpYyB2b2lkCi1wc3Jfc291cmNl
X3N0YXR1cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHN0cnVjdCBzZXFfZmls
ZSAqbSkKK3Bzcl9zb3VyY2Vfc3RhdHVzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIHN0cnVj
dCBzZXFfZmlsZSAqbSkKIHsKLQl1MzIgdmFsLCBzdGF0dXNfdmFsOworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCWNvbnN0IGNoYXIg
KnN0YXR1cyA9ICJ1bmtub3duIjsKKwl1MzIgdmFsLCBzdGF0dXNfdmFsOwogCi0JaWYgKGRldl9w
cml2LT5wc3IucHNyMl9lbmFibGVkKSB7CisJaWYgKGludGVsX2RwLT5wc3IucHNyMl9lbmFibGVk
KSB7CiAJCXN0YXRpYyBjb25zdCBjaGFyICogY29uc3QgbGl2ZV9zdGF0dXNbXSA9IHsKIAkJCSJJ
RExFIiwKIAkJCSJDQVBUVVJFIiwKQEAgLTMwMCw3ICszMDAsNyBAQCBwc3Jfc291cmNlX3N0YXR1
cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHN0cnVjdCBzZXFfZmlsZSAqbSkK
IAkJCSJUR19PTiIKIAkJfTsKIAkJdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwKLQkJCQkg
ICAgRURQX1BTUjJfU1RBVFVTKGRldl9wcml2LT5wc3IudHJhbnNjb2RlcikpOworCQkJCSAgICBF
RFBfUFNSMl9TVEFUVVMoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSk7CiAJCXN0YXR1c192YWwg
PSAodmFsICYgRURQX1BTUjJfU1RBVFVTX1NUQVRFX01BU0spID4+CiAJCQkgICAgICBFRFBfUFNS
Ml9TVEFUVVNfU1RBVEVfU0hJRlQ7CiAJCWlmIChzdGF0dXNfdmFsIDwgQVJSQVlfU0laRShsaXZl
X3N0YXR1cykpCkBAIC0zMTcsNyArMzE3LDcgQEAgcHNyX3NvdXJjZV9zdGF0dXMoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBzdHJ1Y3Qgc2VxX2ZpbGUgKm0pCiAJCQkiU1JERU5U
X09OIiwKIAkJfTsKIAkJdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwKLQkJCQkgICAgRURQ
X1BTUl9TVEFUVVMoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSk7CisJCQkJICAgIEVEUF9QU1Jf
U1RBVFVTKGludGVsX2RwLT5wc3IudHJhbnNjb2RlcikpOwogCQlzdGF0dXNfdmFsID0gKHZhbCAm
IEVEUF9QU1JfU1RBVFVTX1NUQVRFX01BU0spID4+CiAJCQkgICAgICBFRFBfUFNSX1NUQVRVU19T
VEFURV9TSElGVDsKIAkJaWYgKHN0YXR1c192YWwgPCBBUlJBWV9TSVpFKGxpdmVfc3RhdHVzKSkK
QEAgLTMyNywyMSArMzI3LDE4IEBAIHBzcl9zb3VyY2Vfc3RhdHVzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwgc3RydWN0IHNlcV9maWxlICptKQogCXNlcV9wcmludGYobSwgIlNv
dXJjZSBQU1Igc3RhdHVzOiAlcyBbMHglMDh4XVxuIiwgc3RhdHVzLCB2YWwpOwogfQogCi1zdGF0
aWMgaW50IGk5MTVfZWRwX3Bzcl9zdGF0dXMoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRh
KQorc3RhdGljIGludCBpbnRlbF9wc3Jfc3RhdHVzKHN0cnVjdCBzZXFfZmlsZSAqbSwgc3RydWN0
IGludGVsX2RwICppbnRlbF9kcCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7Ci0Jc3RydWN0IGk5MTVfcHNyICpwc3IgPSAm
ZGV2X3ByaXYtPnBzcjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90
b19pOTE1KGludGVsX2RwKTsKKwlzdHJ1Y3QgaW50ZWxfcHNyICpwc3IgPSAmaW50ZWxfZHAtPnBz
cjsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAljb25zdCBjaGFyICpzdGF0dXM7CiAJYm9v
bCBlbmFibGVkOwogCXUzMiB2YWw7CiAKLQlpZiAoIUhBU19QU1IoZGV2X3ByaXYpKQotCQlyZXR1
cm4gLUVOT0RFVjsKLQogCXNlcV9wcmludGYobSwgIlNpbmsgc3VwcG9ydDogJXMiLCB5ZXNubyhw
c3ItPnNpbmtfc3VwcG9ydCkpOwotCWlmIChwc3ItPmRwKQotCQlzZXFfcHJpbnRmKG0sICIgWzB4
JTAyeF0iLCBwc3ItPmRwLT5wc3JfZHBjZFswXSk7CisJaWYgKHBzci0+c2lua19zdXBwb3J0KQor
CQlzZXFfcHJpbnRmKG0sICIgWzB4JTAyeF0iLCBpbnRlbF9kcC0+cHNyX2RwY2RbMF0pOwogCXNl
cV9wdXRzKG0sICJcbiIpOwogCiAJaWYgKCFwc3ItPnNpbmtfc3VwcG9ydCkKQEAgLTM2NSwxNiAr
MzYyLDE2IEBAIHN0YXRpYyBpbnQgaTkxNV9lZHBfcHNyX3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUg
Km0sIHZvaWQgKmRhdGEpCiAKIAlpZiAocHNyLT5wc3IyX2VuYWJsZWQpIHsKIAkJdmFsID0gaW50
ZWxfZGVfcmVhZChkZXZfcHJpdiwKLQkJCQkgICAgRURQX1BTUjJfQ1RMKGRldl9wcml2LT5wc3Iu
dHJhbnNjb2RlcikpOworCQkJCSAgICBFRFBfUFNSMl9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2Nv
ZGVyKSk7CiAJCWVuYWJsZWQgPSB2YWwgJiBFRFBfUFNSMl9FTkFCTEU7CiAJfSBlbHNlIHsKIAkJ
dmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwKLQkJCQkgICAgRURQX1BTUl9DVEwoZGV2X3By
aXYtPnBzci50cmFuc2NvZGVyKSk7CisJCQkJICAgIEVEUF9QU1JfQ1RMKGludGVsX2RwLT5wc3Iu
dHJhbnNjb2RlcikpOwogCQllbmFibGVkID0gdmFsICYgRURQX1BTUl9FTkFCTEU7CiAJfQogCXNl
cV9wcmludGYobSwgIlNvdXJjZSBQU1IgY3RsOiAlcyBbMHglMDh4XVxuIiwKIAkJICAgZW5hYmxl
ZGRpc2FibGVkKGVuYWJsZWQpLCB2YWwpOwotCXBzcl9zb3VyY2Vfc3RhdHVzKGRldl9wcml2LCBt
KTsKKwlwc3Jfc291cmNlX3N0YXR1cyhpbnRlbF9kcCwgbSk7CiAJc2VxX3ByaW50ZihtLCAiQnVz
eSBmcm9udGJ1ZmZlciBiaXRzOiAweCUwOHhcbiIsCiAJCSAgIHBzci0+YnVzeV9mcm9udGJ1ZmZl
cl9iaXRzKTsKIApAQCAtMzgzLDcgKzM4MCw3IEBAIHN0YXRpYyBpbnQgaTkxNV9lZHBfcHNyX3N0
YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAJICovCiAJaWYgKElTX0hBU1dF
TEwoZGV2X3ByaXYpIHx8IElTX0JST0FEV0VMTChkZXZfcHJpdikpIHsKIAkJdmFsID0gaW50ZWxf
ZGVfcmVhZChkZXZfcHJpdiwKLQkJCQkgICAgRURQX1BTUl9QRVJGX0NOVChkZXZfcHJpdi0+cHNy
LnRyYW5zY29kZXIpKTsKKwkJCQkgICAgRURQX1BTUl9QRVJGX0NOVChpbnRlbF9kcC0+cHNyLnRy
YW5zY29kZXIpKTsKIAkJdmFsICY9IEVEUF9QU1JfUEVSRl9DTlRfTUFTSzsKIAkJc2VxX3ByaW50
ZihtLCAiUGVyZm9ybWFuY2UgY291bnRlcjogJXVcbiIsIHZhbCk7CiAJfQpAQCAtNDA0LDcgKzQw
MSw3IEBAIHN0YXRpYyBpbnQgaTkxNV9lZHBfcHNyX3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0s
IHZvaWQgKmRhdGEpCiAJCSAqLwogCQlmb3IgKGZyYW1lID0gMDsgZnJhbWUgPCBQU1IyX1NVX1NU
QVRVU19GUkFNRVM7IGZyYW1lICs9IDMpIHsKIAkJCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3By
aXYsCi0JCQkJCSAgICBQU1IyX1NVX1NUQVRVUyhkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIsIGZy
YW1lKSk7CisJCQkJCSAgICBQU1IyX1NVX1NUQVRVUyhpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIs
IGZyYW1lKSk7CiAJCQlzdV9mcmFtZXNfdmFsW2ZyYW1lIC8gM10gPSB2YWw7CiAJCX0KIApAQCAt
NDMwLDIzICs0MjcsNTAgQEAgc3RhdGljIGludCBpOTE1X2VkcF9wc3Jfc3RhdHVzKHN0cnVjdCBz
ZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKIAlyZXR1cm4gMDsKIH0KIAorc3RhdGljIGludCBpOTE1
X2VkcF9wc3Jfc3RhdHVzKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKK3sKKwlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7
CisJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IE5VTEw7CisJc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXI7CisKKwlpZiAoIUhBU19QU1IoZGV2X3ByaXYpKQorCQlyZXR1cm4gLUVOT0RF
VjsKKworCS8qIEZpbmQgdGhlIGZpcnN0IEVEUCB3aGljaCBzdXBwb3J0cyBQU1IgKi8KKwlmb3Jf
ZWFjaF9pbnRlbF9lbmNvZGVyX2Nhbl9wc3IoJmRldl9wcml2LT5kcm0sIGVuY29kZXIpIHsKKwkJ
aW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5jb2Rlcik7CisJCWJyZWFrOworCX0KKworCWlm
ICghaW50ZWxfZHApCisJCXJldHVybiAtRU5PREVWOworCisJcmV0dXJuIGludGVsX3Bzcl9zdGF0
dXMobSwgaW50ZWxfZHApOworfQorCiBzdGF0aWMgaW50CiBpOTE1X2VkcF9wc3JfZGVidWdfc2V0
KHZvaWQgKmRhdGEsIHU2NCB2YWwpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gZGF0YTsKKwlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKIAlpbnRlbF93YWtl
cmVmX3Qgd2FrZXJlZjsKLQlpbnQgcmV0OworCWludCByZXQgPSAtRU5PREVWOwogCi0JaWYgKCFD
QU5fUFNSKGRldl9wcml2KSkKLQkJcmV0dXJuIC1FTk9ERVY7CisJaWYgKCFIQVNfUFNSKGRldl9w
cml2KSkKKwkJcmV0dXJuIHJldDsKIAotCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLCAiU2V0
dGluZyBQU1IgZGVidWcgdG8gJWxseFxuIiwgdmFsKTsKKwlmb3JfZWFjaF9pbnRlbF9lbmNvZGVy
X2Nhbl9wc3IoJmRldl9wcml2LT5kcm0sIGVuY29kZXIpIHsKKwkJc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCA9IGVuY190b19pbnRlbF9kcChlbmNvZGVyKTsKIAotCXdha2VyZWYgPSBpbnRlbF9y
dW50aW1lX3BtX2dldCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0pOworCQlkcm1fZGJnX2ttcygmZGV2
X3ByaXYtPmRybSwgIlNldHRpbmcgUFNSIGRlYnVnIHRvICVsbHhcbiIsIHZhbCk7CiAKLQlyZXQg
PSBpbnRlbF9wc3JfZGVidWdfc2V0KGRldl9wcml2LCB2YWwpOworCQl3YWtlcmVmID0gaW50ZWxf
cnVudGltZV9wbV9nZXQoJmRldl9wcml2LT5ydW50aW1lX3BtKTsKIAotCWludGVsX3J1bnRpbWVf
cG1fcHV0KCZkZXZfcHJpdi0+cnVudGltZV9wbSwgd2FrZXJlZik7CisJCS8vIFRPRE86IHNwbGl0
IHRvIGVhY2ggdHJhbnNjb2RlcidzIFBTUiBkZWJ1ZyBzdGF0ZQorCQlyZXQgPSBpbnRlbF9wc3Jf
ZGVidWdfc2V0KGludGVsX2RwLCB2YWwpOworCisJCWludGVsX3J1bnRpbWVfcG1fcHV0KCZkZXZf
cHJpdi0+cnVudGltZV9wbSwgd2FrZXJlZik7CisJfQogCiAJcmV0dXJuIHJldDsKIH0KQEAgLTQ1
NSwxMiArNDc5LDIwIEBAIHN0YXRpYyBpbnQKIGk5MTVfZWRwX3Bzcl9kZWJ1Z19nZXQodm9pZCAq
ZGF0YSwgdTY0ICp2YWwpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
ZGF0YTsKKwlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKIAotCWlmICghQ0FOX1BTUihk
ZXZfcHJpdikpCisJaWYgKCFIQVNfUFNSKGRldl9wcml2KSkKIAkJcmV0dXJuIC1FTk9ERVY7CiAK
LQkqdmFsID0gUkVBRF9PTkNFKGRldl9wcml2LT5wc3IuZGVidWcpOwotCXJldHVybiAwOworCWZv
cl9lYWNoX2ludGVsX2VuY29kZXJfY2FuX3BzcigmZGV2X3ByaXYtPmRybSwgZW5jb2Rlcikgewor
CQlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKGVuY29kZXIpOwor
CisJCS8vIFRPRE86IHNwbGl0IHRvIGVhY2ggdHJhbnNjb2RlcidzIFBTUiBkZWJ1ZyBzdGF0ZQor
CQkqdmFsID0gUkVBRF9PTkNFKGludGVsX2RwLT5wc3IuZGVidWcpOworCQlyZXR1cm4gMDsKKwl9
CisKKwlyZXR1cm4gLUVOT0RFVjsKIH0KIAogREVGSU5FX1NJTVBMRV9BVFRSSUJVVEUoaTkxNV9l
ZHBfcHNyX2RlYnVnX2ZvcHMsCkBAIC0xMjMzLDkgKzEyNjUsNiBAQCBzdGF0aWMgdm9pZCBkcnJz
X3N0YXR1c19wZXJfY3J0YyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sCiAJCS8qIGRpc2FibGVfZHJycygp
IHdpbGwgbWFrZSBkcnJzLT5kcCBOVUxMICovCiAJCWlmICghZHJycy0+ZHApIHsKIAkJCXNlcV9w
dXRzKG0sICJJZGxlbmVzcyBEUlJTOiBEaXNhYmxlZFxuIik7Ci0JCQlpZiAoZGV2X3ByaXYtPnBz
ci5lbmFibGVkKQotCQkJCXNlcV9wdXRzKG0sCi0JCQkJIlx0QXMgUFNSIGlzIGVuYWJsZWQsIERS
UlMgaXMgbm90IGVuYWJsZWRcbiIpOwogCQkJbXV0ZXhfdW5sb2NrKCZkcnJzLT5tdXRleCk7CiAJ
CQlyZXR1cm47CiAJCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGlzcGxheV90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kaXNwbGF5X3R5cGVzLmgKaW5kZXggMzkzOTc3NDhiNGIwLi4zMDdmZjRiNzcxZjQgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5o
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5o
CkBAIC0xNDE1LDYgKzE0MTUsNDMgQEAgc3RydWN0IGludGVsX3BwcyB7CiAJc3RydWN0IGVkcF9w
b3dlcl9zZXEgcHBzX2RlbGF5czsKIH07CiAKK3N0cnVjdCBpbnRlbF9wc3IgeworCS8qIE11dGV4
IGZvciBQU1Igc3RhdGUgb2YgdGhlIHRyYW5zY29kZXIgKi8KKwlzdHJ1Y3QgbXV0ZXggbG9jazsK
KworI2RlZmluZSBJOTE1X1BTUl9ERUJVR19NT0RFX01BU0sJMHgwZgorI2RlZmluZSBJOTE1X1BT
Ul9ERUJVR19ERUZBVUxUCQkweDAwCisjZGVmaW5lIEk5MTVfUFNSX0RFQlVHX0RJU0FCTEUJCTB4
MDEKKyNkZWZpbmUgSTkxNV9QU1JfREVCVUdfRU5BQkxFCQkweDAyCisjZGVmaW5lIEk5MTVfUFNS
X0RFQlVHX0ZPUkNFX1BTUjEJMHgwMworI2RlZmluZSBJOTE1X1BTUl9ERUJVR19JUlEJCTB4MTAK
KworCXUzMiBkZWJ1ZzsKKwlib29sIHNpbmtfc3VwcG9ydDsKKwlib29sIHNvdXJjZV9zdXBwb3J0
OworCWJvb2wgZW5hYmxlZDsKKwllbnVtIHBpcGUgcGlwZTsKKwllbnVtIHRyYW5zY29kZXIgdHJh
bnNjb2RlcjsKKwlib29sIGFjdGl2ZTsKKwlzdHJ1Y3Qgd29ya19zdHJ1Y3Qgd29yazsKKwl1bnNp
Z25lZCBpbnQgYnVzeV9mcm9udGJ1ZmZlcl9iaXRzOworCWJvb2wgc2lua19wc3IyX3N1cHBvcnQ7
CisJYm9vbCBsaW5rX3N0YW5kYnk7CisJYm9vbCBjb2xvcmltZXRyeV9zdXBwb3J0OworCWJvb2wg
cHNyMl9lbmFibGVkOworCWJvb2wgcHNyMl9zZWxfZmV0Y2hfZW5hYmxlZDsKKwl1OCBzaW5rX3N5
bmNfbGF0ZW5jeTsKKwlrdGltZV90IGxhc3RfZW50cnlfYXR0ZW1wdDsKKwlrdGltZV90IGxhc3Rf
ZXhpdDsKKwlib29sIHNpbmtfbm90X3JlbGlhYmxlOworCWJvb2wgaXJxX2F1eF9lcnJvcjsKKwl1
MTYgc3VfeF9ncmFudWxhcml0eTsKKwlib29sIGRjM2NvX2VuYWJsZWQ7CisJdTMyIGRjM2NvX2V4
aXRfZGVsYXk7CisJc3RydWN0IGRlbGF5ZWRfd29yayBkYzNjb193b3JrOworCXN0cnVjdCBkcm1f
ZHBfdnNjX3NkcCB2c2M7Cit9OworCiBzdHJ1Y3QgaW50ZWxfZHAgewogCWk5MTVfcmVnX3Qgb3V0
cHV0X3JlZzsKIAl1MzIgRFA7CkBAIC0xNTE3LDYgKzE1NTQsOCBAQCBzdHJ1Y3QgaW50ZWxfZHAg
ewogCWJvb2wgaG9ibF9hY3RpdmU7CiAKIAlzdHJ1Y3QgaW50ZWxfZHBfcGNvbl9mcmwgZnJsOwor
CisJc3RydWN0IGludGVsX3BzciBwc3I7CiB9OwogCiBlbnVtIGxzcGNvbl92ZW5kb3IgewpAQCAt
MTc1Myw2ICsxNzkyLDE4IEBAIGRwX3RvX2k5MTUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkK
IAlyZXR1cm4gdG9faTkxNShkcF90b19kaWdfcG9ydChpbnRlbF9kcCktPmJhc2UuYmFzZS5kZXYp
OwogfQogCisjZGVmaW5lIENBTl9QU1IoaW50ZWxfZHApCShIQVNfUFNSKGRwX3RvX2k5MTUoaW50
ZWxfZHApKSAmJiBcCisJCQkJIChpbnRlbF9kcCktPnBzci5zaW5rX3N1cHBvcnQgJiYgXAorCQkJ
CSAoaW50ZWxfZHApLT5wc3Iuc291cmNlX3N1cHBvcnQpCisKK3N0YXRpYyBpbmxpbmUgYm9vbCBp
bnRlbF9lbmNvZGVyX2Nhbl9wc3Ioc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIpCit7CisJ
aWYgKCFpbnRlbF9lbmNvZGVyX2lzX2RwKGVuY29kZXIpKQorCQlyZXR1cm4gZmFsc2U7CisKKwly
ZXR1cm4gQ0FOX1BTUihlbmNfdG9faW50ZWxfZHAoZW5jb2RlcikpOworfQorCiBzdGF0aWMgaW5s
aW5lIHN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKgogaGRtaV90b19kaWdfcG9ydChzdHJ1Y3Qg
aW50ZWxfaGRtaSAqaW50ZWxfaGRtaSkKIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZHAuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZHAuYwppbmRleCA4YzEyZDUzNzU2MDcuLmQ1MzJiZDU2MjUwZiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYwpAQCAtMTY2MywxMiArMTY2MywxMCBAQCB2b2lkIGlu
dGVsX2RwX2NvbXB1dGVfcHNyX3ZzY19zZHAoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJ
CQkgIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlLAogCQkJCSAg
c3RydWN0IGRybV9kcF92c2Nfc2RwICp2c2MpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7Ci0KIAl2c2MtPnNkcF90eXBlID0gRFBf
U0RQX1ZTQzsKIAotCWlmIChkZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxlZCkgewotCQlpZiAoZGV2
X3ByaXYtPnBzci5jb2xvcmltZXRyeV9zdXBwb3J0ICYmCisJaWYgKGludGVsX2RwLT5wc3IucHNy
Ml9lbmFibGVkKSB7CisJCWlmIChpbnRlbF9kcC0+cHNyLmNvbG9yaW1ldHJ5X3N1cHBvcnQgJiYK
IAkJICAgIGludGVsX2RwX25lZWRzX3ZzY19zZHAoY3J0Y19zdGF0ZSwgY29ubl9zdGF0ZSkpIHsK
IAkJCS8qIFtQU1IyLCArQ29sb3JpbWV0cnldICovCiAJCQlpbnRlbF9kcF9jb21wdXRlX3ZzY19j
b2xvcmltZXRyeShjcnRjX3N0YXRlLCBjb25uX3N0YXRlLApAQCAtMjM1OSw3ICsyMzU3LDcgQEAg
Ym9vbCBpbnRlbF9kcF9pbml0aWFsX2Zhc3RzZXRfY2hlY2soc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIsCiAJCXJldHVybiBmYWxzZTsKIAl9CiAKLQlpZiAoQ0FOX1BTUihpOTE1KSAmJiBp
bnRlbF9kcF9pc19lZHAoaW50ZWxfZHApKSB7CisJaWYgKENBTl9QU1IoaW50ZWxfZHApICYmIGlu
dGVsX2RwX2lzX2VkcChpbnRlbF9kcCkpIHsKIAkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwgIkZv
cmNpbmcgZnVsbCBtb2Rlc2V0IHRvIGNvbXB1dGUgUFNSIHN0YXRlXG4iKTsKIAkJY3J0Y19zdGF0
ZS0+dWFwaS5tb2RlX2NoYW5nZWQgPSB0cnVlOwogCQlyZXR1cm4gZmFsc2U7CkBAIC02NjQxLDYg
KzY2MzksOCBAQCBpbnRlbF9kcF9pbml0X2Nvbm5lY3RvcihzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9w
b3J0ICpkaWdfcG9ydCwKIAlpbnRlbF9kcC0+ZnJsLmlzX3RyYWluZWQgPSBmYWxzZTsKIAlpbnRl
bF9kcC0+ZnJsLnRyYWluZWRfcmF0ZV9nYnBzID0gMDsKIAorCWludGVsX3Bzcl9pbml0KGludGVs
X2RwKTsKKwogCXJldHVybiB0cnVlOwogCiBmYWlsOgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfcHNyLmMKaW5kZXggMmMzNjViNzc4Zjc0Li4wZTk4MjQwNWFiMzIgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYwpAQCAtODAsOSArODAsMTEgQEAKICAq
IHVzZSBwYWdlIGZsaXBzLgogICovCiAKLXN0YXRpYyBib29sIHBzcl9nbG9iYWxfZW5hYmxlZChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3N0YXRpYyBib29sIHBzcl9nbG9iYWxfZW5h
YmxlZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewotCXN3aXRjaCAoaTkxNS0+cHNyLmRl
YnVnICYgSTkxNV9QU1JfREVCVUdfTU9ERV9NQVNLKSB7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKworCXN3aXRjaCAoaW50ZWxfZHAtPnBz
ci5kZWJ1ZyAmIEk5MTVfUFNSX0RFQlVHX01PREVfTUFTSykgewogCWNhc2UgSTkxNV9QU1JfREVC
VUdfREVGQVVMVDoKIAkJcmV0dXJuIGk5MTUtPnBhcmFtcy5lbmFibGVfcHNyOwogCWNhc2UgSTkx
NV9QU1JfREVCVUdfRElTQUJMRToKQEAgLTkyLDkgKzk0LDkgQEAgc3RhdGljIGJvb2wgcHNyX2ds
b2JhbF9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCX0KIH0KIAotc3Rh
dGljIGJvb2wgcHNyMl9nbG9iYWxfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCitzdGF0aWMgYm9vbCBwc3IyX2dsb2JhbF9lbmFibGVkKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHApCiB7Ci0Jc3dpdGNoIChkZXZfcHJpdi0+cHNyLmRlYnVnICYgSTkxNV9QU1JfREVC
VUdfTU9ERV9NQVNLKSB7CisJc3dpdGNoIChpbnRlbF9kcC0+cHNyLmRlYnVnICYgSTkxNV9QU1Jf
REVCVUdfTU9ERV9NQVNLKSB7CiAJY2FzZSBJOTE1X1BTUl9ERUJVR19ESVNBQkxFOgogCWNhc2Ug
STkxNV9QU1JfREVCVUdfRk9SQ0VfUFNSMToKIAkJcmV0dXJuIGZhbHNlOwpAQCAtMTAzLDExICsx
MDUsMTIgQEAgc3RhdGljIGJvb2wgcHNyMl9nbG9iYWxfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpCiAJfQogfQogCi1zdGF0aWMgdm9pZCBwc3JfaXJxX2NvbnRyb2wo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgcHNyX2lycV9j
b250cm9sKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJZW51bSB0cmFuc2NvZGVy
IHRyYW5zX3NoaWZ0OwotCXUzMiBtYXNrLCB2YWw7CiAJaTkxNV9yZWdfdCBpbXJfcmVnOworCXUz
MiBtYXNrLCB2YWw7CiAKIAkvKgogCSAqIGdlbjEyKyBoYXMgcmVnaXN0ZXJzIHJlbGF0aXZlIHRv
IHRyYW5zY29kZXIgYW5kIG9uZSBwZXIgdHJhbnNjb2RlcgpAQCAtMTE2LDE0ICsxMTksMTQgQEAg
c3RhdGljIHZvaWQgcHNyX2lycV9jb250cm9sKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIAkgKi8KIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikgewogCQl0cmFuc19z
aGlmdCA9IDA7Ci0JCWltcl9yZWcgPSBUUkFOU19QU1JfSU1SKGRldl9wcml2LT5wc3IudHJhbnNj
b2Rlcik7CisJCWltcl9yZWcgPSBUUkFOU19QU1JfSU1SKGludGVsX2RwLT5wc3IudHJhbnNjb2Rl
cik7CiAJfSBlbHNlIHsKLQkJdHJhbnNfc2hpZnQgPSBkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXI7
CisJCXRyYW5zX3NoaWZ0ID0gaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyOwogCQlpbXJfcmVnID0g
RURQX1BTUl9JTVI7CiAJfQogCiAJbWFzayA9IEVEUF9QU1JfRVJST1IodHJhbnNfc2hpZnQpOwot
CWlmIChkZXZfcHJpdi0+cHNyLmRlYnVnICYgSTkxNV9QU1JfREVCVUdfSVJRKQorCWlmIChpbnRl
bF9kcC0+cHNyLmRlYnVnICYgSTkxNV9QU1JfREVCVUdfSVJRKQogCQltYXNrIHw9IEVEUF9QU1Jf
UE9TVF9FWElUKHRyYW5zX3NoaWZ0KSB8CiAJCQlFRFBfUFNSX1BSRV9FTlRSWSh0cmFuc19zaGlm
dCk7CiAKQEAgLTE3MiwzMCArMTc1LDMxIEBAIHN0YXRpYyB2b2lkIHBzcl9ldmVudF9wcmludChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwg
Ilx0UFNSIGRpc2FibGVkXG4iKTsKIH0KIAotdm9pZCBpbnRlbF9wc3JfaXJxX2hhbmRsZXIoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgcHNyX2lpcikKK3ZvaWQgaW50ZWxf
cHNyX2lycV9oYW5kbGVyKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIHUzMiBwc3JfaWlyKQog
ewotCWVudW0gdHJhbnNjb2RlciBjcHVfdHJhbnNjb2RlciA9IGRldl9wcml2LT5wc3IudHJhbnNj
b2RlcjsKKwllbnVtIHRyYW5zY29kZXIgY3B1X3RyYW5zY29kZXIgPSBpbnRlbF9kcC0+cHNyLnRy
YW5zY29kZXI7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkx
NShpbnRlbF9kcCk7CisJa3RpbWVfdCB0aW1lX25zID0gIGt0aW1lX2dldCgpOwogCWVudW0gdHJh
bnNjb2RlciB0cmFuc19zaGlmdDsKIAlpOTE1X3JlZ190IGltcl9yZWc7Ci0Ja3RpbWVfdCB0aW1l
X25zID0gIGt0aW1lX2dldCgpOwogCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpIHsK
IAkJdHJhbnNfc2hpZnQgPSAwOwotCQlpbXJfcmVnID0gVFJBTlNfUFNSX0lNUihkZXZfcHJpdi0+
cHNyLnRyYW5zY29kZXIpOworCQlpbXJfcmVnID0gVFJBTlNfUFNSX0lNUihpbnRlbF9kcC0+cHNy
LnRyYW5zY29kZXIpOwogCX0gZWxzZSB7Ci0JCXRyYW5zX3NoaWZ0ID0gZGV2X3ByaXYtPnBzci50
cmFuc2NvZGVyOworCQl0cmFuc19zaGlmdCA9IGludGVsX2RwLT5wc3IudHJhbnNjb2RlcjsKIAkJ
aW1yX3JlZyA9IEVEUF9QU1JfSU1SOwogCX0KIAogCWlmIChwc3JfaWlyICYgRURQX1BTUl9QUkVf
RU5UUlkodHJhbnNfc2hpZnQpKSB7Ci0JCWRldl9wcml2LT5wc3IubGFzdF9lbnRyeV9hdHRlbXB0
ID0gdGltZV9uczsKKwkJaW50ZWxfZHAtPnBzci5sYXN0X2VudHJ5X2F0dGVtcHQgPSB0aW1lX25z
OwogCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKIAkJCSAgICAiW3RyYW5zY29kZXIgJXNd
IFBTUiBlbnRyeSBhdHRlbXB0IGluIDIgdmJsYW5rc1xuIiwKIAkJCSAgICB0cmFuc2NvZGVyX25h
bWUoY3B1X3RyYW5zY29kZXIpKTsKIAl9CiAKIAlpZiAocHNyX2lpciAmIEVEUF9QU1JfUE9TVF9F
WElUKHRyYW5zX3NoaWZ0KSkgewotCQlkZXZfcHJpdi0+cHNyLmxhc3RfZXhpdCA9IHRpbWVfbnM7
CisJCWludGVsX2RwLT5wc3IubGFzdF9leGl0ID0gdGltZV9uczsKIAkJZHJtX2RiZ19rbXMoJmRl
dl9wcml2LT5kcm0sCiAJCQkgICAgIlt0cmFuc2NvZGVyICVzXSBQU1IgZXhpdCBjb21wbGV0ZWRc
biIsCiAJCQkgICAgdHJhbnNjb2Rlcl9uYW1lKGNwdV90cmFuc2NvZGVyKSk7CkBAIC0yMDMsNyAr
MjA3LDcgQEAgdm9pZCBpbnRlbF9wc3JfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LCB1MzIgcHNyX2lpcikKIAkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
OSkgewogCQkJdTMyIHZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsCiAJCQkJCQlQU1JfRVZF
TlQoY3B1X3RyYW5zY29kZXIpKTsKLQkJCWJvb2wgcHNyMl9lbmFibGVkID0gZGV2X3ByaXYtPnBz
ci5wc3IyX2VuYWJsZWQ7CisJCQlib29sIHBzcjJfZW5hYmxlZCA9IGludGVsX2RwLT5wc3IucHNy
Ml9lbmFibGVkOwogCiAJCQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgUFNSX0VWRU5UKGNwdV90
cmFuc2NvZGVyKSwKIAkJCQkgICAgICAgdmFsKTsKQEAgLTIxNyw3ICsyMjEsNyBAQCB2b2lkIGlu
dGVsX3Bzcl9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUz
MiBwc3JfaWlyKQogCQlkcm1fd2FybigmZGV2X3ByaXYtPmRybSwgIlt0cmFuc2NvZGVyICVzXSBQ
U1IgYXV4IGVycm9yXG4iLAogCQkJIHRyYW5zY29kZXJfbmFtZShjcHVfdHJhbnNjb2RlcikpOwog
Ci0JCWRldl9wcml2LT5wc3IuaXJxX2F1eF9lcnJvciA9IHRydWU7CisJCWludGVsX2RwLT5wc3Iu
aXJxX2F1eF9lcnJvciA9IHRydWU7CiAKIAkJLyoKIAkJICogSWYgdGhpcyBpbnRlcnJ1cHRpb24g
aXMgbm90IG1hc2tlZCBpdCB3aWxsIGtlZXAKQEAgLTIzMSw3ICsyMzUsNyBAQCB2b2lkIGludGVs
X3Bzcl9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBw
c3JfaWlyKQogCQl2YWwgfD0gRURQX1BTUl9FUlJPUih0cmFuc19zaGlmdCk7CiAJCWludGVsX2Rl
X3dyaXRlKGRldl9wcml2LCBpbXJfcmVnLCB2YWwpOwogCi0JCXNjaGVkdWxlX3dvcmsoJmRldl9w
cml2LT5wc3Iud29yayk7CisJCXNjaGVkdWxlX3dvcmsoJmludGVsX2RwLT5wc3Iud29yayk7CiAJ
fQogfQogCkBAIC0yOTIsMTIgKzI5Niw2IEBAIHZvaWQgaW50ZWxfcHNyX2luaXRfZHBjZChzdHJ1
Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9CiAJCXRvX2k5MTUoZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApLT5iYXNlLmJhc2UuZGV2KTsK
IAotCWlmIChkZXZfcHJpdi0+cHNyLmRwKSB7Ci0JCWRybV93YXJuKCZkZXZfcHJpdi0+ZHJtLAot
CQkJICJNb3JlIHRoYW4gb25lIGVEUCBwYW5lbCBmb3VuZCwgUFNSIHN1cHBvcnQgc2hvdWxkIGJl
IGV4dGVuZGVkXG4iKTsKLQkJcmV0dXJuOwotCX0KLQogCWRybV9kcF9kcGNkX3JlYWQoJmludGVs
X2RwLT5hdXgsIERQX1BTUl9TVVBQT1JULCBpbnRlbF9kcC0+cHNyX2RwY2QsCiAJCQkgc2l6ZW9m
KGludGVsX2RwLT5wc3JfZHBjZCkpOwogCkBAIC0zMTgsMTIgKzMxNiwxMCBAQCB2b2lkIGludGVs
X3Bzcl9pbml0X2RwY2Qoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAkJcmV0dXJuOwogCX0K
IAotCWRldl9wcml2LT5wc3Iuc2lua19zdXBwb3J0ID0gdHJ1ZTsKLQlkZXZfcHJpdi0+cHNyLnNp
bmtfc3luY19sYXRlbmN5ID0KKwlpbnRlbF9kcC0+cHNyLnNpbmtfc3VwcG9ydCA9IHRydWU7CisJ
aW50ZWxfZHAtPnBzci5zaW5rX3N5bmNfbGF0ZW5jeSA9CiAJCWludGVsX2RwX2dldF9zaW5rX3N5
bmNfbGF0ZW5jeShpbnRlbF9kcCk7CiAKLQlkZXZfcHJpdi0+cHNyLmRwID0gaW50ZWxfZHA7Ci0K
IAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5ICYmCiAJICAgIChpbnRlbF9kcC0+cHNyX2Rw
Y2RbMF0gPT0gRFBfUFNSMl9XSVRIX1lfQ09PUkRfSVNfU1VQUE9SVEVEKSkgewogCQlib29sIHlf
cmVxID0gaW50ZWxfZHAtPnBzcl9kcGNkWzFdICYKQEAgLTM0MSwxNCArMzM3LDE0IEBAIHZvaWQg
aW50ZWxfcHNyX2luaXRfZHBjZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCQkgKiBZLWNv
b3JkaW5hdGUgcmVxdWlyZW1lbnQgcGFuZWxzIHdlIHdvdWxkIG5lZWQgdG8gZW5hYmxlCiAJCSAq
IEdUQyBmaXJzdC4KIAkJICovCi0JCWRldl9wcml2LT5wc3Iuc2lua19wc3IyX3N1cHBvcnQgPSB5
X3JlcSAmJiBhbHBtOworCQlpbnRlbF9kcC0+cHNyLnNpbmtfcHNyMl9zdXBwb3J0ID0geV9yZXEg
JiYgYWxwbTsKIAkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJQU1IyICVzc3VwcG9ydGVk
XG4iLAotCQkJICAgIGRldl9wcml2LT5wc3Iuc2lua19wc3IyX3N1cHBvcnQgPyAiIiA6ICJub3Qg
Iik7CisJCQkgICAgaW50ZWxfZHAtPnBzci5zaW5rX3BzcjJfc3VwcG9ydCA/ICIiIDogIm5vdCAi
KTsKIAotCQlpZiAoZGV2X3ByaXYtPnBzci5zaW5rX3BzcjJfc3VwcG9ydCkgewotCQkJZGV2X3By
aXYtPnBzci5jb2xvcmltZXRyeV9zdXBwb3J0ID0KKwkJaWYgKGludGVsX2RwLT5wc3Iuc2lua19w
c3IyX3N1cHBvcnQpIHsKKwkJCWludGVsX2RwLT5wc3IuY29sb3JpbWV0cnlfc3VwcG9ydCA9CiAJ
CQkJaW50ZWxfZHBfZ2V0X2NvbG9yaW1ldHJ5X3N0YXR1cyhpbnRlbF9kcCk7Ci0JCQlkZXZfcHJp
di0+cHNyLnN1X3hfZ3JhbnVsYXJpdHkgPQorCQkJaW50ZWxfZHAtPnBzci5zdV94X2dyYW51bGFy
aXR5ID0KIAkJCQlpbnRlbF9kcF9nZXRfc3VfeF9ncmFudWxhcnRpeShpbnRlbF9kcCk7CiAJCX0K
IAl9CkBAIC0zNzQsNyArMzcwLDcgQEAgc3RhdGljIHZvaWQgaHN3X3Bzcl9zZXR1cF9hdXgoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCkKIAlCVUlMRF9CVUdfT04oc2l6ZW9mKGF1eF9tc2cpID4g
MjApOwogCWZvciAoaSA9IDA7IGkgPCBzaXplb2YoYXV4X21zZyk7IGkgKz0gNCkKIAkJaW50ZWxf
ZGVfd3JpdGUoZGV2X3ByaXYsCi0JCQkgICAgICAgRURQX1BTUl9BVVhfREFUQShkZXZfcHJpdi0+
cHNyLnRyYW5zY29kZXIsIGkgPj4gMiksCisJCQkgICAgICAgRURQX1BTUl9BVVhfREFUQShpbnRl
bF9kcC0+cHNyLnRyYW5zY29kZXIsIGkgPj4gMiksCiAJCQkgICAgICAgaW50ZWxfZHBfcGFja19h
dXgoJmF1eF9tc2dbaV0sIHNpemVvZihhdXhfbXNnKSAtIGkpKTsKIAogCWF1eF9jbG9ja19kaXZp
ZGVyID0gaW50ZWxfZHAtPmdldF9hdXhfY2xvY2tfZGl2aWRlcihpbnRlbF9kcCwgMCk7CkBAIC0z
ODUsNyArMzgxLDcgQEAgc3RhdGljIHZvaWQgaHN3X3Bzcl9zZXR1cF9hdXgoc3RydWN0IGludGVs
X2RwICppbnRlbF9kcCkKIAogCS8qIFNlbGVjdCBvbmx5IHZhbGlkIGJpdHMgZm9yIFNSRF9BVVhf
Q1RMICovCiAJYXV4X2N0bCAmPSBwc3JfYXV4X21hc2s7Ci0JaW50ZWxfZGVfd3JpdGUoZGV2X3By
aXYsIEVEUF9QU1JfQVVYX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpLAorCWludGVsX2Rl
X3dyaXRlKGRldl9wcml2LCBFRFBfUFNSX0FVWF9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVy
KSwKIAkJICAgICAgIGF1eF9jdGwpOwogfQogCkBAIC0zOTUsMTQgKzM5MSwxNCBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9wc3JfZW5hYmxlX3Npbmsoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAl1
OCBkcGNkX3ZhbCA9IERQX1BTUl9FTkFCTEU7CiAKIAkvKiBFbmFibGUgQUxQTSBhdCBzaW5rIGZv
ciBwc3IyICovCi0JaWYgKGRldl9wcml2LT5wc3IucHNyMl9lbmFibGVkKSB7CisJaWYgKGludGVs
X2RwLT5wc3IucHNyMl9lbmFibGVkKSB7CiAJCWRybV9kcF9kcGNkX3dyaXRlYigmaW50ZWxfZHAt
PmF1eCwgRFBfUkVDRUlWRVJfQUxQTV9DT05GSUcsCiAJCQkJICAgRFBfQUxQTV9FTkFCTEUgfAog
CQkJCSAgIERQX0FMUE1fTE9DS19FUlJPUl9JUlFfSFBEX0VOQUJMRSk7CiAKIAkJZHBjZF92YWwg
fD0gRFBfUFNSX0VOQUJMRV9QU1IyIHwgRFBfUFNSX0lSUV9IUERfV0lUSF9DUkNfRVJST1JTOwog
CX0gZWxzZSB7Ci0JCWlmIChkZXZfcHJpdi0+cHNyLmxpbmtfc3RhbmRieSkKKwkJaWYgKGludGVs
X2RwLT5wc3IubGlua19zdGFuZGJ5KQogCQkJZHBjZF92YWwgfD0gRFBfUFNSX01BSU5fTElOS19B
Q1RJVkU7CiAKIAkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOCkKQEAgLTQ2NSw3ICs0NjEs
NyBAQCBzdGF0aWMgdTggcHNyX2NvbXB1dGVfaWRsZV9mcmFtZXMoc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCkKIAkgKiBvZmYtYnktb25lIGlzc3VlIHRoYXQgSFcgaGFzIGluIHNvbWUgY2FzZXMu
CiAJICovCiAJaWRsZV9mcmFtZXMgPSBtYXgoNiwgZGV2X3ByaXYtPnZidC5wc3IuaWRsZV9mcmFt
ZXMpOwotCWlkbGVfZnJhbWVzID0gbWF4KGlkbGVfZnJhbWVzLCBkZXZfcHJpdi0+cHNyLnNpbmtf
c3luY19sYXRlbmN5ICsgMSk7CisJaWRsZV9mcmFtZXMgPSBtYXgoaWRsZV9mcmFtZXMsIGludGVs
X2RwLT5wc3Iuc2lua19zeW5jX2xhdGVuY3kgKyAxKTsKIAogCWlmIChkcm1fV0FSTl9PTigmZGV2
X3ByaXYtPmRybSwgaWRsZV9mcmFtZXMgPiAweGYpKQogCQlpZGxlX2ZyYW1lcyA9IDB4ZjsKQEAg
LTQ4NSw3ICs0ODEsNyBAQCBzdGF0aWMgdm9pZCBoc3dfYWN0aXZhdGVfcHNyMShzdHJ1Y3QgaW50
ZWxfZHAgKmludGVsX2RwKQogCWlmIChJU19IQVNXRUxMKGRldl9wcml2KSkKIAkJdmFsIHw9IEVE
UF9QU1JfTUlOX0xJTktfRU5UUllfVElNRV84X0xJTkVTOwogCi0JaWYgKGRldl9wcml2LT5wc3Iu
bGlua19zdGFuZGJ5KQorCWlmIChpbnRlbF9kcC0+cHNyLmxpbmtfc3RhbmRieSkKIAkJdmFsIHw9
IEVEUF9QU1JfTElOS19TVEFOREJZOwogCiAJdmFsIHw9IGludGVsX3BzcjFfZ2V0X3RwX3RpbWUo
aW50ZWxfZHApOwpAQCAtNDkzLDkgKzQ4OSw5IEBAIHN0YXRpYyB2b2lkIGhzd19hY3RpdmF0ZV9w
c3IxKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikg
Pj0gOCkKIAkJdmFsIHw9IEVEUF9QU1JfQ1JDX0VOQUJMRTsKIAotCXZhbCB8PSAoaW50ZWxfZGVf
cmVhZChkZXZfcHJpdiwgRURQX1BTUl9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSkgJgor
CXZhbCB8PSAoaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgRURQX1BTUl9DVEwoaW50ZWxfZHAtPnBz
ci50cmFuc2NvZGVyKSkgJgogCQlFRFBfUFNSX1JFU1RPUkVfUFNSX0FDVElWRV9DVFhfTUFTSyk7
Ci0JaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEVEUF9QU1JfQ1RMKGRldl9wcml2LT5wc3IudHJh
bnNjb2RlciksIHZhbCk7CisJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEVEUF9QU1JfQ1RMKGlu
dGVsX2RwLT5wc3IudHJhbnNjb2RlciksIHZhbCk7CiB9CiAKIHN0YXRpYyB1MzIgaW50ZWxfcHNy
Ml9nZXRfdHBfdGltZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQpAQCAtNTMwLDcgKzUyNiw3
IEBAIHN0YXRpYyB2b2lkIGhzd19hY3RpdmF0ZV9wc3IyKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHApCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZf
cHJpdikpCiAJCXZhbCB8PSBFRFBfWV9DT09SRElOQVRFX0VOQUJMRTsKIAotCXZhbCB8PSBFRFBf
UFNSMl9GUkFNRV9CRUZPUkVfU1UoZGV2X3ByaXYtPnBzci5zaW5rX3N5bmNfbGF0ZW5jeSArIDEp
OworCXZhbCB8PSBFRFBfUFNSMl9GUkFNRV9CRUZPUkVfU1UoaW50ZWxfZHAtPnBzci5zaW5rX3N5
bmNfbGF0ZW5jeSArIDEpOwogCXZhbCB8PSBpbnRlbF9wc3IyX2dldF90cF90aW1lKGludGVsX2Rw
KTsKIAogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKSB7CkBAIC01NDksNyArNTQ1LDcg
QEAgc3RhdGljIHZvaWQgaHN3X2FjdGl2YXRlX3BzcjIoc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCkKIAkJdmFsIHw9IEVEUF9QU1IyX0ZBU1RfV0FLRSg3KTsKIAl9CiAKLQlpZiAoZGV2X3ByaXYt
PnBzci5wc3IyX3NlbF9mZXRjaF9lbmFibGVkKSB7CisJaWYgKGludGVsX2RwLT5wc3IucHNyMl9z
ZWxfZmV0Y2hfZW5hYmxlZCkgewogCQkvKiBXQSAxNDA4MzMwODQ3ICovCiAJCWlmIChJU19UR0xf
RElTUF9TVEVQUElORyhkZXZfcHJpdiwgU1RFUF9BMCwgU1RFUF9BMCkgfHwKIAkJICAgIElTX1JL
TF9SRVZJRChkZXZfcHJpdiwgUktMX1JFVklEX0EwLCBSS0xfUkVWSURfQTApKQpAQCAtNTU4LDIw
ICs1NTQsMjAgQEAgc3RhdGljIHZvaWQgaHN3X2FjdGl2YXRlX3BzcjIoc3RydWN0IGludGVsX2Rw
ICppbnRlbF9kcCkKIAkJCQkgICAgIERJU19SQU1fQllQQVNTX1BTUjJfTUFOX1RSQUNLKTsKIAog
CQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwKLQkJCSAgICAgICBQU1IyX01BTl9UUktfQ1RMKGRl
dl9wcml2LT5wc3IudHJhbnNjb2RlciksCisJCQkgICAgICAgUFNSMl9NQU5fVFJLX0NUTChpbnRl
bF9kcC0+cHNyLnRyYW5zY29kZXIpLAogCQkJICAgICAgIFBTUjJfTUFOX1RSS19DVExfRU5BQkxF
KTsKIAl9IGVsc2UgaWYgKEhBU19QU1IyX1NFTF9GRVRDSChkZXZfcHJpdikpIHsKIAkJaW50ZWxf
ZGVfd3JpdGUoZGV2X3ByaXYsCi0JCQkgICAgICAgUFNSMl9NQU5fVFJLX0NUTChkZXZfcHJpdi0+
cHNyLnRyYW5zY29kZXIpLCAwKTsKKwkJCSAgICAgICBQU1IyX01BTl9UUktfQ1RMKGludGVsX2Rw
LT5wc3IudHJhbnNjb2RlciksIDApOwogCX0KIAogCS8qCiAJICogUFNSMiBIVyBpcyBpbmNvcnJl
Y3RseSB1c2luZyBFRFBfUFNSX1RQMV9UUDNfU0VMIGFuZCBCU3BlYyBpcwogCSAqIHJlY29tbWVu
ZGluZyBrZWVwIHRoaXMgYml0IHVuc2V0IHdoaWxlIFBTUjIgaXMgZW5hYmxlZC4KIAkgKi8KLQlp
bnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRURQX1BTUl9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2Nv
ZGVyKSwgMCk7CisJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEVEUF9QU1JfQ1RMKGludGVsX2Rw
LT5wc3IudHJhbnNjb2RlciksIDApOwogCi0JaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEVEUF9Q
U1IyX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpLCB2YWwpOworCWludGVsX2RlX3dyaXRl
KGRldl9wcml2LCBFRFBfUFNSMl9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSwgdmFsKTsK
IH0KIAogc3RhdGljIGJvb2wKQEAgLTU5NCw1NSArNTkwLDU4IEBAIHN0YXRpYyB1MzIgaW50ZWxf
Z2V0X2ZyYW1lX3RpbWVfdXMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNzdGF0ZSkK
IAkJCSAgICBkcm1fbW9kZV92cmVmcmVzaCgmY3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlKSk7CiB9
CiAKLXN0YXRpYyB2b2lkIHBzcjJfcHJvZ3JhbV9pZGxlX2ZyYW1lcyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCitzdGF0aWMgdm9pZCBwc3IyX3Byb2dyYW1faWRsZV9mcmFtZXMo
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJCQkgICAgIHUzMiBpZGxlX2ZyYW1lcykKIHsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2Rw
KTsKIAl1MzIgdmFsOwogCiAJaWRsZV9mcmFtZXMgPDw9ICBFRFBfUFNSMl9JRExFX0ZSQU1FX1NI
SUZUOwotCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIEVEUF9QU1IyX0NUTChkZXZfcHJp
di0+cHNyLnRyYW5zY29kZXIpKTsKKwl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBFRFBf
UFNSMl9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSk7CiAJdmFsICY9IH5FRFBfUFNSMl9J
RExFX0ZSQU1FX01BU0s7CiAJdmFsIHw9IGlkbGVfZnJhbWVzOwotCWludGVsX2RlX3dyaXRlKGRl
dl9wcml2LCBFRFBfUFNSMl9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSwgdmFsKTsKKwlp
bnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRURQX1BTUjJfQ1RMKGludGVsX2RwLT5wc3IudHJhbnNj
b2RlciksIHZhbCk7CiB9CiAKLXN0YXRpYyB2b2lkIHRnbF9wc3IyX2VuYWJsZV9kYzNjbyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCB0Z2xfcHNyMl9lbmFi
bGVfZGMzY28oc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKLQlwc3IyX3Byb2dyYW1faWRs
ZV9mcmFtZXMoZGV2X3ByaXYsIDApOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCisJcHNyMl9wcm9ncmFtX2lkbGVfZnJhbWVzKGlu
dGVsX2RwLCAwKTsKIAlpbnRlbF9kaXNwbGF5X3Bvd2VyX3NldF90YXJnZXRfZGNfc3RhdGUoZGV2
X3ByaXYsIERDX1NUQVRFX0VOX0RDM0NPKTsKIH0KIAotc3RhdGljIHZvaWQgdGdsX3BzcjJfZGlz
YWJsZV9kYzNjbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9p
ZCB0Z2xfcHNyMl9kaXNhYmxlX2RjM2NvKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7Ci0J
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGRldl9wcml2LT5wc3IuZHA7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAKIAlpbnRl
bF9kaXNwbGF5X3Bvd2VyX3NldF90YXJnZXRfZGNfc3RhdGUoZGV2X3ByaXYsIERDX1NUQVRFX0VO
X1VQVE9fREM2KTsKLQlwc3IyX3Byb2dyYW1faWRsZV9mcmFtZXMoZGV2X3ByaXYsIHBzcl9jb21w
dXRlX2lkbGVfZnJhbWVzKGludGVsX2RwKSk7CisJcHNyMl9wcm9ncmFtX2lkbGVfZnJhbWVzKGlu
dGVsX2RwLCBwc3JfY29tcHV0ZV9pZGxlX2ZyYW1lcyhpbnRlbF9kcCkpOwogfQogCiBzdGF0aWMg
dm9pZCB0Z2xfZGMzY29fZGlzYWJsZV93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQotCQljb250YWluZXJfb2Yod29y
aywgdHlwZW9mKCpkZXZfcHJpdiksIHBzci5kYzNjb193b3JrLndvcmspOworCXN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHAgPQorCQljb250YWluZXJfb2Yod29yaywgdHlwZW9mKCppbnRlbF9kcCks
IHBzci5kYzNjb193b3JrLndvcmspOwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPnBzci5sb2Nr
KTsKKwltdXRleF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOwogCS8qIElmIGRlbGF5ZWQgd29y
ayBpcyBwZW5kaW5nLCBpdCBpcyBub3QgaWRsZSAqLwotCWlmIChkZWxheWVkX3dvcmtfcGVuZGlu
ZygmZGV2X3ByaXYtPnBzci5kYzNjb193b3JrKSkKKwlpZiAoZGVsYXllZF93b3JrX3BlbmRpbmco
JmludGVsX2RwLT5wc3IuZGMzY29fd29yaykpCiAJCWdvdG8gdW5sb2NrOwogCi0JdGdsX3BzcjJf
ZGlzYWJsZV9kYzNjbyhkZXZfcHJpdik7CisJdGdsX3BzcjJfZGlzYWJsZV9kYzNjbyhpbnRlbF9k
cCk7CiB1bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCW11dGV4
X3VubG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKIH0KIAotc3RhdGljIHZvaWQgdGdsX2Rpc2Fs
bG93X2RjM2NvX29uX3BzcjJfZXhpdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CitzdGF0aWMgdm9pZCB0Z2xfZGlzYWxsb3dfZGMzY29fb25fcHNyMl9leGl0KHN0cnVjdCBpbnRl
bF9kcCAqaW50ZWxfZHApCiB7Ci0JaWYgKCFkZXZfcHJpdi0+cHNyLmRjM2NvX2VuYWJsZWQpCisJ
aWYgKCFpbnRlbF9kcC0+cHNyLmRjM2NvX2VuYWJsZWQpCiAJCXJldHVybjsKIAotCWNhbmNlbF9k
ZWxheWVkX3dvcmsoJmRldl9wcml2LT5wc3IuZGMzY29fd29yayk7CisJY2FuY2VsX2RlbGF5ZWRf
d29yaygmaW50ZWxfZHAtPnBzci5kYzNjb193b3JrKTsKIAkvKiBCZWZvcmUgUFNSMiBleGl0IGRp
c2FsbG93IGRjM2NvKi8KLQl0Z2xfcHNyMl9kaXNhYmxlX2RjM2NvKGRldl9wcml2KTsKKwl0Z2xf
cHNyMl9kaXNhYmxlX2RjM2NvKGludGVsX2RwKTsKIH0KIAogc3RhdGljIHZvaWQKQEAgLTcxNSw3
ICs3MTQsNyBAQCBzdGF0aWMgYm9vbCBpbnRlbF9wc3IyX2NvbmZpZ192YWxpZChzdHJ1Y3QgaW50
ZWxfZHAgKmludGVsX2RwLAogCWludCBjcnRjX3ZkaXNwbGF5ID0gY3J0Y19zdGF0ZS0+aHcuYWRq
dXN0ZWRfbW9kZS5jcnRjX3ZkaXNwbGF5OwogCWludCBwc3JfbWF4X2ggPSAwLCBwc3JfbWF4X3Yg
PSAwLCBtYXhfYnBwID0gMDsKIAotCWlmICghZGV2X3ByaXYtPnBzci5zaW5rX3BzcjJfc3VwcG9y
dCkKKwlpZiAoIWludGVsX2RwLT5wc3Iuc2lua19wc3IyX3N1cHBvcnQpCiAJCXJldHVybiBmYWxz
ZTsKIAogCWlmICghdHJhbnNjb2Rlcl9oYXNfcHNyMihkZXZfcHJpdiwgY3J0Y19zdGF0ZS0+Y3B1
X3RyYW5zY29kZXIpKSB7CkBAIC03MjUsNyArNzI0LDcgQEAgc3RhdGljIGJvb2wgaW50ZWxfcHNy
Ml9jb25maWdfdmFsaWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJcmV0dXJuIGZhbHNl
OwogCX0KIAotCWlmICghcHNyMl9nbG9iYWxfZW5hYmxlZChkZXZfcHJpdikpIHsKKwlpZiAoIXBz
cjJfZ2xvYmFsX2VuYWJsZWQoaW50ZWxfZHApKSB7CiAJCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+
ZHJtLCAiUFNSMiBkaXNhYmxlZCBieSBmbGFnXG4iKTsKIAkJcmV0dXJuIGZhbHNlOwogCX0KQEAg
LTc3NCwxMCArNzczLDEwIEBAIHN0YXRpYyBib29sIGludGVsX3BzcjJfY29uZmlnX3ZhbGlkKHN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJICogb25seSBuZWVkIHRvIHZhbGlkYXRlIHRoZSBT
VSBibG9jayB3aWR0aCBpcyBhIG11bHRpcGxlIG9mCiAJICogeCBncmFudWxhcml0eS4KIAkgKi8K
LQlpZiAoY3J0Y19oZGlzcGxheSAlIGRldl9wcml2LT5wc3Iuc3VfeF9ncmFudWxhcml0eSkgewor
CWlmIChjcnRjX2hkaXNwbGF5ICUgaW50ZWxfZHAtPnBzci5zdV94X2dyYW51bGFyaXR5KSB7CiAJ
CWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLAogCQkJICAgICJQU1IyIG5vdCBlbmFibGVkLCBo
ZGlzcGxheSglZCkgbm90IG11bHRpcGxlIG9mICVkXG4iLAotCQkJICAgIGNydGNfaGRpc3BsYXks
IGRldl9wcml2LT5wc3Iuc3VfeF9ncmFudWxhcml0eSk7CisJCQkgICAgY3J0Y19oZGlzcGxheSwg
aW50ZWxfZHAtPnBzci5zdV94X2dyYW51bGFyaXR5KTsKIAkJcmV0dXJuIGZhbHNlOwogCX0KIApA
QCAtODA2LDcgKzgwNSw2IEBAIHN0YXRpYyBib29sIGludGVsX3BzcjJfY29uZmlnX3ZhbGlkKHN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiB2b2lkIGludGVsX3Bzcl9jb21wdXRlX2NvbmZpZyhz
dHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCQkJICAgICAgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQg
PSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5
X21vZGUgKmFkanVzdGVkX21vZGUgPQogCQkmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZTsK
QEAgLTgxOSwzMCArODE3LDE1IEBAIHZvaWQgaW50ZWxfcHNyX2NvbXB1dGVfY29uZmlnKHN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJaWYgKGNydGNfc3RhdGUtPnZyci5lbmFibGUpCiAJCXJl
dHVybjsKIAotCWlmICghQ0FOX1BTUihkZXZfcHJpdikpCisJaWYgKCFDQU5fUFNSKGludGVsX2Rw
KSkKIAkJcmV0dXJuOwogCi0JaWYgKGludGVsX2RwICE9IGRldl9wcml2LT5wc3IuZHApCi0JCXJl
dHVybjsKLQotCWlmICghcHNyX2dsb2JhbF9lbmFibGVkKGRldl9wcml2KSkgeworCWlmICghcHNy
X2dsb2JhbF9lbmFibGVkKGludGVsX2RwKSkgewogCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRy
bSwgIlBTUiBkaXNhYmxlZCBieSBmbGFnXG4iKTsKIAkJcmV0dXJuOwogCX0KIAotCS8qCi0JICog
SFNXIHNwZWMgZXhwbGljaXRseSBzYXlzIFBTUiBpcyB0aWVkIHRvIHBvcnQgQS4KLQkgKiBCRFcr
IHBsYXRmb3JtcyBoYXZlIGEgaW5zdGFuY2Ugb2YgUFNSIHJlZ2lzdGVycyBwZXIgdHJhbnNjb2Rl
ciBidXQKLQkgKiBmb3Igbm93IGl0IG9ubHkgc3VwcG9ydHMgb25lIGluc3RhbmNlIG9mIFBTUiwg
c28gbGV0cyBrZWVwIGl0Ci0JICogaGFyZGNvZGVkIHRvIFBPUlRfQQotCSAqLwotCWlmIChkaWdf
cG9ydC0+YmFzZS5wb3J0ICE9IFBPUlRfQSkgewotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRy
bSwKLQkJCSAgICAiUFNSIGNvbmRpdGlvbiBmYWlsZWQ6IFBvcnQgbm90IHN1cHBvcnRlZFxuIik7
Ci0JCXJldHVybjsKLQl9Ci0KLQlpZiAoZGV2X3ByaXYtPnBzci5zaW5rX25vdF9yZWxpYWJsZSkg
eworCWlmIChpbnRlbF9kcC0+cHNyLnNpbmtfbm90X3JlbGlhYmxlKSB7CiAJCWRybV9kYmdfa21z
KCZkZXZfcHJpdi0+ZHJtLAogCQkJICAgICJQU1Igc2luayBpbXBsZW1lbnRhdGlvbiBpcyBub3Qg
cmVsaWFibGVcbiIpOwogCQlyZXR1cm47CkBAIC04NzgsMjMgKzg2MSwyNCBAQCB2b2lkIGludGVs
X3Bzcl9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogc3RhdGljIHZv
aWQgaW50ZWxfcHNyX2FjdGl2YXRlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisJ
ZW51bSB0cmFuc2NvZGVyIHRyYW5zY29kZXIgPSBpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXI7CiAK
LQlpZiAodHJhbnNjb2Rlcl9oYXNfcHNyMihkZXZfcHJpdiwgZGV2X3ByaXYtPnBzci50cmFuc2Nv
ZGVyKSkKKwlpZiAodHJhbnNjb2Rlcl9oYXNfcHNyMihkZXZfcHJpdiwgdHJhbnNjb2RlcikpCiAJ
CWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLAotCQkJICAgIGludGVsX2RlX3JlYWQoZGV2X3By
aXYsIEVEUF9QU1IyX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpKSAmIEVEUF9QU1IyX0VO
QUJMRSk7CisJCQkgICAgaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgRURQX1BTUjJfQ1RMKHRyYW5z
Y29kZXIpKSAmIEVEUF9QU1IyX0VOQUJMRSk7CiAKIAlkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRy
bSwKLQkJICAgIGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIEVEUF9QU1JfQ1RMKGRldl9wcml2LT5w
c3IudHJhbnNjb2RlcikpICYgRURQX1BTUl9FTkFCTEUpOwotCWRybV9XQVJOX09OKCZkZXZfcHJp
di0+ZHJtLCBkZXZfcHJpdi0+cHNyLmFjdGl2ZSk7Ci0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2
X3ByaXYtPnBzci5sb2NrKTsKKwkJICAgIGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIEVEUF9QU1Jf
Q1RMKHRyYW5zY29kZXIpKSAmIEVEUF9QU1JfRU5BQkxFKTsKKwlkcm1fV0FSTl9PTigmZGV2X3By
aXYtPmRybSwgaW50ZWxfZHAtPnBzci5hY3RpdmUpOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmlu
dGVsX2RwLT5wc3IubG9jayk7CiAKIAkvKiBwc3IxIGFuZCBwc3IyIGFyZSBtdXR1YWxseSBleGNs
dXNpdmUuKi8KLQlpZiAoZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQpCisJaWYgKGludGVsX2Rw
LT5wc3IucHNyMl9lbmFibGVkKQogCQloc3dfYWN0aXZhdGVfcHNyMihpbnRlbF9kcCk7CiAJZWxz
ZQogCQloc3dfYWN0aXZhdGVfcHNyMShpbnRlbF9kcCk7CiAKLQlkZXZfcHJpdi0+cHNyLmFjdGl2
ZSA9IHRydWU7CisJaW50ZWxfZHAtPnBzci5hY3RpdmUgPSB0cnVlOwogfQogCiBzdGF0aWMgdm9p
ZCBpbnRlbF9wc3JfZW5hYmxlX3NvdXJjZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLApAQCAt
OTEwLDcgKzg5NCw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3Bzcl9lbmFibGVfc291cmNlKHN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpIHx8IElTX0JS
T0FEV0VMTChkZXZfcHJpdikpCiAJCWhzd19wc3Jfc2V0dXBfYXV4KGludGVsX2RwKTsKIAotCWlm
IChkZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxlZCAmJiAoSVNfR0VOKGRldl9wcml2LCA5KSAmJgor
CWlmIChpbnRlbF9kcC0+cHNyLnBzcjJfZW5hYmxlZCAmJiAoSVNfR0VOKGRldl9wcml2LCA5KSAm
JgogCQkJCQkgICAhSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpKSB7CiAJCWk5MTVfcmVnX3QgcmVn
ID0gQ0hJQ0tFTl9UUkFOUyhjcHVfdHJhbnNjb2Rlcik7CiAJCXUzMiBjaGlja2VuID0gaW50ZWxf
ZGVfcmVhZChkZXZfcHJpdiwgcmVnKTsKQEAgLTkzNCwxMCArOTE4LDEwIEBAIHN0YXRpYyB2b2lk
IGludGVsX3Bzcl9lbmFibGVfc291cmNlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPCAxMSkKIAkJbWFzayB8PSBFRFBfUFNSX0RFQlVHX01BU0tf
RElTUF9SRUdfV1JJVEU7CiAKLQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRURQX1BTUl9ERUJV
RyhkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpLAorCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBF
RFBfUFNSX0RFQlVHKGludGVsX2RwLT5wc3IudHJhbnNjb2RlciksCiAJCSAgICAgICBtYXNrKTsK
IAotCXBzcl9pcnFfY29udHJvbChkZXZfcHJpdik7CisJcHNyX2lycV9jb250cm9sKGludGVsX2Rw
KTsKIAogCWlmIChjcnRjX3N0YXRlLT5kYzNjb19leGl0bGluZSkgewogCQl1MzIgdmFsOwpAQCAt
OTU1LDMwICs5MzksMzAgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHNyX2VuYWJsZV9zb3VyY2Uoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCwKIAogCWlmIChIQVNfUFNSX0hXX1RSQUNLSU5HKGRldl9w
cml2KSAmJiBIQVNfUFNSMl9TRUxfRkVUQ0goZGV2X3ByaXYpKQogCQlpbnRlbF9kZV9ybXcoZGV2
X3ByaXYsIENISUNLRU5fUEFSMV8xLCBJR05PUkVfUFNSMl9IV19UUkFDS0lORywKLQkJCSAgICAg
ZGV2X3ByaXYtPnBzci5wc3IyX3NlbF9mZXRjaF9lbmFibGVkID8KKwkJCSAgICAgaW50ZWxfZHAt
PnBzci5wc3IyX3NlbF9mZXRjaF9lbmFibGVkID8KIAkJCSAgICAgSUdOT1JFX1BTUjJfSFdfVFJB
Q0tJTkcgOiAwKTsKIH0KIAotc3RhdGljIHZvaWQgaW50ZWxfcHNyX2VuYWJsZV9sb2NrZWQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorc3RhdGljIHZvaWQgaW50ZWxfcHNyX2Vu
YWJsZV9sb2NrZWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJCQkgICAgY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJICAgIGNvbnN0IHN0cnVjdCBk
cm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQogewotCXN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHAgPSBkZXZfcHJpdi0+cHNyLmRwOwogCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRp
Z19wb3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOworCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCXN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyID0gJmRpZ19wb3J0LT5iYXNlOwogCXUzMiB2YWw7CiAKLQlkcm1fV0FSTl9P
TigmZGV2X3ByaXYtPmRybSwgZGV2X3ByaXYtPnBzci5lbmFibGVkKTsKKwlkcm1fV0FSTl9PTigm
ZGV2X3ByaXYtPmRybSwgaW50ZWxfZHAtPnBzci5lbmFibGVkKTsKIAotCWRldl9wcml2LT5wc3Iu
cHNyMl9lbmFibGVkID0gY3J0Y19zdGF0ZS0+aGFzX3BzcjI7Ci0JZGV2X3ByaXYtPnBzci5idXN5
X2Zyb250YnVmZmVyX2JpdHMgPSAwOwotCWRldl9wcml2LT5wc3IucGlwZSA9IHRvX2ludGVsX2Ny
dGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKS0+cGlwZTsKLQlkZXZfcHJpdi0+cHNyLmRjM2NvX2Vu
YWJsZWQgPSAhIWNydGNfc3RhdGUtPmRjM2NvX2V4aXRsaW5lOwotCWRldl9wcml2LT5wc3IudHJh
bnNjb2RlciA9IGNydGNfc3RhdGUtPmNwdV90cmFuc2NvZGVyOworCWludGVsX2RwLT5wc3IucHNy
Ml9lbmFibGVkID0gY3J0Y19zdGF0ZS0+aGFzX3BzcjI7CisJaW50ZWxfZHAtPnBzci5idXN5X2Zy
b250YnVmZmVyX2JpdHMgPSAwOworCWludGVsX2RwLT5wc3IucGlwZSA9IHRvX2ludGVsX2NydGMo
Y3J0Y19zdGF0ZS0+dWFwaS5jcnRjKS0+cGlwZTsKKwlpbnRlbF9kcC0+cHNyLmRjM2NvX2VuYWJs
ZWQgPSAhIWNydGNfc3RhdGUtPmRjM2NvX2V4aXRsaW5lOworCWludGVsX2RwLT5wc3IudHJhbnNj
b2RlciA9IGNydGNfc3RhdGUtPmNwdV90cmFuc2NvZGVyOwogCS8qIERDNS9EQzYgcmVxdWlyZXMg
YXQgbGVhc3QgNiBpZGxlIGZyYW1lcyAqLwogCXZhbCA9IHVzZWNzX3RvX2ppZmZpZXMoaW50ZWxf
Z2V0X2ZyYW1lX3RpbWVfdXMoY3J0Y19zdGF0ZSkgKiA2KTsKLQlkZXZfcHJpdi0+cHNyLmRjM2Nv
X2V4aXRfZGVsYXkgPSB2YWw7Ci0JZGV2X3ByaXYtPnBzci5wc3IyX3NlbF9mZXRjaF9lbmFibGVk
ID0gY3J0Y19zdGF0ZS0+ZW5hYmxlX3BzcjJfc2VsX2ZldGNoOworCWludGVsX2RwLT5wc3IuZGMz
Y29fZXhpdF9kZWxheSA9IHZhbDsKKwlpbnRlbF9kcC0+cHNyLnBzcjJfc2VsX2ZldGNoX2VuYWJs
ZWQgPSBjcnRjX3N0YXRlLT5lbmFibGVfcHNyMl9zZWxfZmV0Y2g7CiAKIAkvKgogCSAqIElmIGEg
UFNSIGVycm9yIGhhcHBlbmVkIGFuZCB0aGUgZHJpdmVyIGlzIHJlbG9hZGVkLCB0aGUgRURQX1BT
Ul9JSVIKQEAgLTk5MCwyNyArOTc0LDI3IEBAIHN0YXRpYyB2b2lkIGludGVsX3Bzcl9lbmFibGVf
bG9ja2VkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkgKi8KIAlpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA+PSAxMikgewogCQl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2
LAotCQkJCSAgICBUUkFOU19QU1JfSUlSKGRldl9wcml2LT5wc3IudHJhbnNjb2RlcikpOworCQkJ
CSAgICBUUkFOU19QU1JfSUlSKGludGVsX2RwLT5wc3IudHJhbnNjb2RlcikpOwogCQl2YWwgJj0g
RURQX1BTUl9FUlJPUigwKTsKIAl9IGVsc2UgewogCQl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9w
cml2LCBFRFBfUFNSX0lJUik7Ci0JCXZhbCAmPSBFRFBfUFNSX0VSUk9SKGRldl9wcml2LT5wc3Iu
dHJhbnNjb2Rlcik7CisJCXZhbCAmPSBFRFBfUFNSX0VSUk9SKGludGVsX2RwLT5wc3IudHJhbnNj
b2Rlcik7CiAJfQogCWlmICh2YWwpIHsKLQkJZGV2X3ByaXYtPnBzci5zaW5rX25vdF9yZWxpYWJs
ZSA9IHRydWU7CisJCWludGVsX2RwLT5wc3Iuc2lua19ub3RfcmVsaWFibGUgPSB0cnVlOwogCQlk
cm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwKIAkJCSAgICAiUFNSIGludGVycnVwdGlvbiBlcnJv
ciBzZXQsIG5vdCBlbmFibGluZyBQU1JcbiIpOwogCQlyZXR1cm47CiAJfQogCiAJZHJtX2RiZ19r
bXMoJmRldl9wcml2LT5kcm0sICJFbmFibGluZyBQU1Ilc1xuIiwKLQkJICAgIGRldl9wcml2LT5w
c3IucHNyMl9lbmFibGVkID8gIjIiIDogIjEiKTsKKwkJICAgIGludGVsX2RwLT5wc3IucHNyMl9l
bmFibGVkID8gIjIiIDogIjEiKTsKIAlpbnRlbF9kcF9jb21wdXRlX3Bzcl92c2Nfc2RwKGludGVs
X2RwLCBjcnRjX3N0YXRlLCBjb25uX3N0YXRlLAotCQkJCSAgICAgJmRldl9wcml2LT5wc3IudnNj
KTsKLQlpbnRlbF93cml0ZV9kcF92c2Nfc2RwKGVuY29kZXIsIGNydGNfc3RhdGUsICZkZXZfcHJp
di0+cHNyLnZzYyk7CisJCQkJICAgICAmaW50ZWxfZHAtPnBzci52c2MpOworCWludGVsX3dyaXRl
X2RwX3ZzY19zZHAoZW5jb2RlciwgY3J0Y19zdGF0ZSwgJmludGVsX2RwLT5wc3IudnNjKTsKIAlp
bnRlbF9wc3JfZW5hYmxlX3NpbmsoaW50ZWxfZHApOwogCWludGVsX3Bzcl9lbmFibGVfc291cmNl
KGludGVsX2RwLCBjcnRjX3N0YXRlKTsKLQlkZXZfcHJpdi0+cHNyLmVuYWJsZWQgPSB0cnVlOwor
CWludGVsX2RwLT5wc3IuZW5hYmxlZCA9IHRydWU7CiAKIAlpbnRlbF9wc3JfYWN0aXZhdGUoaW50
ZWxfZHApOwogfQpAQCAtMTAyOSw3ICsxMDEzLDcgQEAgdm9pZCBpbnRlbF9wc3JfZW5hYmxlKHN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAKLQlpZiAoIUNBTl9QU1IoZGV2X3ByaXYp
IHx8IGRldl9wcml2LT5wc3IuZHAgIT0gaW50ZWxfZHApCisJaWYgKCFDQU5fUFNSKGludGVsX2Rw
KSkKIAkJcmV0dXJuOwogCiAJaWYgKCFjcnRjX3N0YXRlLT5oYXNfcHNyKQpAQCAtMTAzNyw0NiAr
MTAyMSw0NyBAQCB2b2lkIGludGVsX3Bzcl9lbmFibGUoc3RydWN0IGludGVsX2RwICppbnRlbF9k
cCwKIAogCWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCBkZXZfcHJpdi0+ZHJycy5kcCk7CiAK
LQltdXRleF9sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOwotCWludGVsX3Bzcl9lbmFibGVfbG9j
a2VkKGRldl9wcml2LCBjcnRjX3N0YXRlLCBjb25uX3N0YXRlKTsKLQltdXRleF91bmxvY2soJmRl
dl9wcml2LT5wc3IubG9jayk7CisJbXV0ZXhfbG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKKwlp
bnRlbF9wc3JfZW5hYmxlX2xvY2tlZChpbnRlbF9kcCwgY3J0Y19zdGF0ZSwgY29ubl9zdGF0ZSk7
CisJbXV0ZXhfdW5sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOwogfQogCi1zdGF0aWMgdm9pZCBp
bnRlbF9wc3JfZXhpdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMg
dm9pZCBpbnRlbF9wc3JfZXhpdChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogeworCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCXUz
MiB2YWw7CiAKLQlpZiAoIWRldl9wcml2LT5wc3IuYWN0aXZlKSB7Ci0JCWlmICh0cmFuc2NvZGVy
X2hhc19wc3IyKGRldl9wcml2LCBkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpKSB7CisJaWYgKCFp
bnRlbF9kcC0+cHNyLmFjdGl2ZSkgeworCQlpZiAodHJhbnNjb2Rlcl9oYXNfcHNyMihkZXZfcHJp
diwgaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSkgewogCQkJdmFsID0gaW50ZWxfZGVfcmVhZChk
ZXZfcHJpdiwKLQkJCQkJICAgIEVEUF9QU1IyX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIp
KTsKKwkJCQkJICAgIEVEUF9QU1IyX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpKTsKIAkJ
CWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCB2YWwgJiBFRFBfUFNSMl9FTkFCTEUpOwogCQl9
CiAKIAkJdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwKLQkJCQkgICAgRURQX1BTUl9DVEwo
ZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSk7CisJCQkJICAgIEVEUF9QU1JfQ1RMKGludGVsX2Rw
LT5wc3IudHJhbnNjb2RlcikpOwogCQlkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwgdmFsICYg
RURQX1BTUl9FTkFCTEUpOwogCiAJCXJldHVybjsKIAl9CiAKLQlpZiAoZGV2X3ByaXYtPnBzci5w
c3IyX2VuYWJsZWQpIHsKLQkJdGdsX2Rpc2FsbG93X2RjM2NvX29uX3BzcjJfZXhpdChkZXZfcHJp
dik7CisJaWYgKGludGVsX2RwLT5wc3IucHNyMl9lbmFibGVkKSB7CisJCXRnbF9kaXNhbGxvd19k
YzNjb19vbl9wc3IyX2V4aXQoaW50ZWxfZHApOwogCQl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9w
cml2LAotCQkJCSAgICBFRFBfUFNSMl9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSk7CisJ
CQkJICAgIEVEUF9QU1IyX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpKTsKIAkJZHJtX1dB
Uk5fT04oJmRldl9wcml2LT5kcm0sICEodmFsICYgRURQX1BTUjJfRU5BQkxFKSk7CiAJCXZhbCAm
PSB+RURQX1BTUjJfRU5BQkxFOwogCQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwKLQkJCSAgICAg
ICBFRFBfUFNSMl9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSwgdmFsKTsKKwkJCSAgICAg
ICBFRFBfUFNSMl9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSwgdmFsKTsKIAl9IGVsc2Ug
ewogCQl2YWwgPSBpbnRlbF9kZV9yZWFkKGRldl9wcml2LAotCQkJCSAgICBFRFBfUFNSX0NUTChk
ZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpKTsKKwkJCQkgICAgRURQX1BTUl9DVEwoaW50ZWxfZHAt
PnBzci50cmFuc2NvZGVyKSk7CiAJCWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCAhKHZhbCAm
IEVEUF9QU1JfRU5BQkxFKSk7CiAJCXZhbCAmPSB+RURQX1BTUl9FTkFCTEU7CiAJCWludGVsX2Rl
X3dyaXRlKGRldl9wcml2LAotCQkJICAgICAgIEVEUF9QU1JfQ1RMKGRldl9wcml2LT5wc3IudHJh
bnNjb2RlciksIHZhbCk7CisJCQkgICAgICAgRURQX1BTUl9DVEwoaW50ZWxfZHAtPnBzci50cmFu
c2NvZGVyKSwgdmFsKTsKIAl9Ci0JZGV2X3ByaXYtPnBzci5hY3RpdmUgPSBmYWxzZTsKKwlpbnRl
bF9kcC0+cHNyLmFjdGl2ZSA9IGZhbHNlOwogfQogCiBzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZGlz
YWJsZV9sb2NrZWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKQEAgLTEwODUsMjEgKzEwNzAs
MjEgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHNyX2Rpc2FibGVfbG9ja2VkKHN0cnVjdCBpbnRlbF9k
cCAqaW50ZWxfZHApCiAJaTkxNV9yZWdfdCBwc3Jfc3RhdHVzOwogCXUzMiBwc3Jfc3RhdHVzX21h
c2s7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCWxvY2tk
ZXBfYXNzZXJ0X2hlbGQoJmludGVsX2RwLT5wc3IubG9jayk7CiAKLQlpZiAoIWRldl9wcml2LT5w
c3IuZW5hYmxlZCkKKwlpZiAoIWludGVsX2RwLT5wc3IuZW5hYmxlZCkKIAkJcmV0dXJuOwogCiAJ
ZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJEaXNhYmxpbmcgUFNSJXNcbiIsCi0JCSAgICBk
ZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxlZCA/ICIyIiA6ICIxIik7CisJCSAgICBpbnRlbF9kcC0+
cHNyLnBzcjJfZW5hYmxlZCA/ICIyIiA6ICIxIik7CiAKLQlpbnRlbF9wc3JfZXhpdChkZXZfcHJp
dik7CisJaW50ZWxfcHNyX2V4aXQoaW50ZWxfZHApOwogCi0JaWYgKGRldl9wcml2LT5wc3IucHNy
Ml9lbmFibGVkKSB7Ci0JCXBzcl9zdGF0dXMgPSBFRFBfUFNSMl9TVEFUVVMoZGV2X3ByaXYtPnBz
ci50cmFuc2NvZGVyKTsKKwlpZiAoaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJsZWQpIHsKKwkJcHNy
X3N0YXR1cyA9IEVEUF9QU1IyX1NUQVRVUyhpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpOwogCQlw
c3Jfc3RhdHVzX21hc2sgPSBFRFBfUFNSMl9TVEFUVVNfU1RBVEVfTUFTSzsKIAl9IGVsc2Ugewot
CQlwc3Jfc3RhdHVzID0gRURQX1BTUl9TVEFUVVMoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKTsK
KwkJcHNyX3N0YXR1cyA9IEVEUF9QU1JfU1RBVFVTKGludGVsX2RwLT5wc3IudHJhbnNjb2Rlcik7
CiAJCXBzcl9zdGF0dXNfbWFzayA9IEVEUF9QU1JfU1RBVFVTX1NUQVRFX01BU0s7CiAJfQogCkBA
IC0xMTA5LDcgKzEwOTQsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZGlzYWJsZV9sb2NrZWQo
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAkJZHJtX2VycigmZGV2X3ByaXYtPmRybSwgIlRp
bWVkIG91dCB3YWl0aW5nIFBTUiBpZGxlIHN0YXRlXG4iKTsKIAogCS8qIFdBIDE0MDgzMzA4NDcg
Ki8KLQlpZiAoZGV2X3ByaXYtPnBzci5wc3IyX3NlbF9mZXRjaF9lbmFibGVkICYmCisJaWYgKGlu
dGVsX2RwLT5wc3IucHNyMl9zZWxfZmV0Y2hfZW5hYmxlZCAmJgogCSAgICAoSVNfVEdMX0RJU1Bf
U1RFUFBJTkcoZGV2X3ByaXYsIFNURVBfQTAsIFNURVBfQTApIHx8CiAJICAgICBJU19SS0xfUkVW
SUQoZGV2X3ByaXYsIFJLTF9SRVZJRF9BMCwgUktMX1JFVklEX0EwKSkpCiAJCWludGVsX2RlX3Jt
dyhkZXZfcHJpdiwgQ0hJQ0tFTl9QQVIxXzEsCkBAIC0xMTE4LDEwICsxMTAzLDEwIEBAIHN0YXRp
YyB2b2lkIGludGVsX3Bzcl9kaXNhYmxlX2xvY2tlZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2Rw
KQogCS8qIERpc2FibGUgUFNSIG9uIFNpbmsgKi8KIAlkcm1fZHBfZHBjZF93cml0ZWIoJmludGVs
X2RwLT5hdXgsIERQX1BTUl9FTl9DRkcsIDApOwogCi0JaWYgKGRldl9wcml2LT5wc3IucHNyMl9l
bmFibGVkKQorCWlmIChpbnRlbF9kcC0+cHNyLnBzcjJfZW5hYmxlZCkKIAkJZHJtX2RwX2RwY2Rf
d3JpdGViKCZpbnRlbF9kcC0+YXV4LCBEUF9SRUNFSVZFUl9BTFBNX0NPTkZJRywgMCk7CiAKLQlk
ZXZfcHJpdi0+cHNyLmVuYWJsZWQgPSBmYWxzZTsKKwlpbnRlbF9kcC0+cHNyLmVuYWJsZWQgPSBm
YWxzZTsKIH0KIAogLyoqCkBAIC0xMTM5LDIwICsxMTI0LDIyIEBAIHZvaWQgaW50ZWxfcHNyX2Rp
c2FibGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAlpZiAoIW9sZF9jcnRjX3N0YXRlLT5o
YXNfcHNyKQogCQlyZXR1cm47CiAKLQlpZiAoZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sICFD
QU5fUFNSKGRldl9wcml2KSkpCisJaWYgKGRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCAhQ0FO
X1BTUihpbnRlbF9kcCkpKQogCQlyZXR1cm47CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+cHNy
LmxvY2spOworCW11dGV4X2xvY2soJmludGVsX2RwLT5wc3IubG9jayk7CiAKIAlpbnRlbF9wc3Jf
ZGlzYWJsZV9sb2NrZWQoaW50ZWxfZHApOwogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cHNy
LmxvY2spOwotCWNhbmNlbF93b3JrX3N5bmMoJmRldl9wcml2LT5wc3Iud29yayk7Ci0JY2FuY2Vs
X2RlbGF5ZWRfd29ya19zeW5jKCZkZXZfcHJpdi0+cHNyLmRjM2NvX3dvcmspOworCW11dGV4X3Vu
bG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKKwljYW5jZWxfd29ya19zeW5jKCZpbnRlbF9kcC0+
cHNyLndvcmspOworCWNhbmNlbF9kZWxheWVkX3dvcmtfc3luYygmaW50ZWxfZHAtPnBzci5kYzNj
b193b3JrKTsKIH0KIAotc3RhdGljIHZvaWQgcHNyX2ZvcmNlX2h3X3RyYWNraW5nX2V4aXQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgcHNyX2ZvcmNlX2h3
X3RyYWNraW5nX2V4aXQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwogCWlmIChJ
U19USUdFUkxBS0UoZGV2X3ByaXYpKQogCQkvKgogCQkgKiBXcml0ZXMgdG8gQ1VSU1VSRkxJVkUg
aW4gVEdMIGFyZSBjYXVzaW5nIElPTU1VIGVycm9ycyBhbmQKQEAgLTExNjYsNyArMTE1Myw3IEBA
IHN0YXRpYyB2b2lkIHBzcl9mb3JjZV9od190cmFja2luZ19leGl0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKIAkJICogU28gdXNpbmcgdGhpcyB3b3JrYXJvdW5kIHVudGlsIHRo
aXMgaXNzdWUgaXMgcm9vdCBjYXVzZWQKIAkJICogYW5kIGEgYmV0dGVyIGZpeCBpcyBmb3VuZC4K
IAkJICovCi0JCWludGVsX3Bzcl9leGl0KGRldl9wcml2KTsKKwkJaW50ZWxfcHNyX2V4aXQoaW50
ZWxfZHApOwogCWVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkKIAkJLyoKIAkJICog
RGlzcGxheSBXQSAjMDg4NDogc2tsKwpAQCAtMTE3NywxMyArMTE2NCwxMyBAQCBzdGF0aWMgdm9p
ZCBwc3JfZm9yY2VfaHdfdHJhY2tpbmdfZXhpdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYpCiAJCSAqIGJ1dCBpdCBtYWtlcyBtb3JlIHNlbnNlIHdyaXRlIHRvIHRoZSBjdXJyZW50
IGFjdGl2ZQogCQkgKiBwaXBlLgogCQkgKi8KLQkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIENV
UlNVUkZMSVZFKGRldl9wcml2LT5wc3IucGlwZSksIDApOworCQlpbnRlbF9kZV93cml0ZShkZXZf
cHJpdiwgQ1VSU1VSRkxJVkUoaW50ZWxfZHAtPnBzci5waXBlKSwgMCk7CiAJZWxzZQogCQkvKgog
CQkgKiBBIHdyaXRlIHRvIENVUlNVUkZMSVZFIGRvIG5vdCBjYXVzZSBIVyB0cmFja2luZyB0byBl
eGl0IFBTUgogCQkgKiBvbiBvbGRlciBnZW5zIHNvIGRvaW5nIHRoZSBtYW51YWwgZXhpdCBpbnN0
ZWFkLgogCQkgKi8KLQkJaW50ZWxfcHNyX2V4aXQoZGV2X3ByaXYpOworCQlpbnRlbF9wc3JfZXhp
dChpbnRlbF9kcCk7CiB9CiAKIHZvaWQgaW50ZWxfcHNyMl9wcm9ncmFtX3BsYW5lX3NlbF9mZXRj
aChzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLApAQCAtMTIzMSwxNiArMTIxOCwyOSBAQCB2b2lk
IGludGVsX3BzcjJfcHJvZ3JhbV9wbGFuZV9zZWxfZmV0Y2goc3RydWN0IGludGVsX3BsYW5lICpw
bGFuZSwKIAogdm9pZCBpbnRlbF9wc3IyX3Byb2dyYW1fdHJhbnNfbWFuX3Rya19jdGwoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2Ny
dGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7Ci0J
c3RydWN0IGk5MTVfcHNyICpwc3IgPSAmZGV2X3ByaXYtPnBzcjsKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+ZGV2KTsK
KwlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKIAogCWlmICghSEFTX1BTUjJfU0VMX0ZF
VENIKGRldl9wcml2KSB8fAogCSAgICAhY3J0Y19zdGF0ZS0+ZW5hYmxlX3BzcjJfc2VsX2ZldGNo
KQogCQlyZXR1cm47CiAKLQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgUFNSMl9NQU5fVFJLX0NU
TChwc3ItPnRyYW5zY29kZXIpLAotCQkgICAgICAgY3J0Y19zdGF0ZS0+cHNyMl9tYW5fdHJhY2tf
Y3RsKTsKKwlmb3JfZWFjaF9pbnRlbF9lbmNvZGVyX21hc2tfY2FuX3BzcigmZGV2X3ByaXYtPmRy
bSwgZW5jb2RlciwKKwkJCQkJICAgIGNydGNfc3RhdGUtPnVhcGkuZW5jb2Rlcl9tYXNrKSB7CisK
KwkJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcChlbmNvZGVyKTsK
KworCQltdXRleF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOworCQlpZiAoIWludGVsX2RwLT5w
c3IuZW5hYmxlZCkgeworCQkJbXV0ZXhfdW5sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOworCQkJ
Y29udGludWU7CisJCX0KKworCQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwKKwkJCSAgICAgICBQ
U1IyX01BTl9UUktfQ1RMKGNydGNfc3RhdGUtPmNwdV90cmFuc2NvZGVyKSwKKwkJCSAgICAgICBj
cnRjX3N0YXRlLT5wc3IyX21hbl90cmFja19jdGwpOworCQltdXRleF91bmxvY2soJmludGVsX2Rw
LT5wc3IubG9jayk7CisJfQogfQogCiBzdGF0aWMgdm9pZCBwc3IyX21hbl90cmtfY3RsX2NhbGMo
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCkBAIC0xNDM1LDEzICsxNDM1LDEz
IEBAIHZvaWQgaW50ZWxfcHNyX3VwZGF0ZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCQkg
ICAgICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKIAlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsK
LQlzdHJ1Y3QgaTkxNV9wc3IgKnBzciA9ICZkZXZfcHJpdi0+cHNyOworCXN0cnVjdCBpbnRlbF9w
c3IgKnBzciA9ICZpbnRlbF9kcC0+cHNyOwogCWJvb2wgZW5hYmxlLCBwc3IyX2VuYWJsZTsKIAot
CWlmICghQ0FOX1BTUihkZXZfcHJpdikgfHwgUkVBRF9PTkNFKHBzci0+ZHApICE9IGludGVsX2Rw
KQorCWlmICghQ0FOX1BTUihpbnRlbF9kcCkpCiAJCXJldHVybjsKIAotCW11dGV4X2xvY2soJmRl
dl9wcml2LT5wc3IubG9jayk7CisJbXV0ZXhfbG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKIAog
CWVuYWJsZSA9IGNydGNfc3RhdGUtPmhhc19wc3I7CiAJcHNyMl9lbmFibGUgPSBjcnRjX3N0YXRl
LT5oYXNfcHNyMjsKQEAgLTE0NDksMTUgKzE0NDksMTUgQEAgdm9pZCBpbnRlbF9wc3JfdXBkYXRl
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJaWYgKGVuYWJsZSA9PSBwc3ItPmVuYWJsZWQg
JiYgcHNyMl9lbmFibGUgPT0gcHNyLT5wc3IyX2VuYWJsZWQpIHsKIAkJLyogRm9yY2UgYSBQU1Ig
ZXhpdCB3aGVuIGVuYWJsaW5nIENSQyB0byBhdm9pZCBDUkMgdGltZW91dHMgKi8KIAkJaWYgKGNy
dGNfc3RhdGUtPmNyY19lbmFibGVkICYmIHBzci0+ZW5hYmxlZCkKLQkJCXBzcl9mb3JjZV9od190
cmFja2luZ19leGl0KGRldl9wcml2KTsKKwkJCXBzcl9mb3JjZV9od190cmFja2luZ19leGl0KGlu
dGVsX2RwKTsKIAkJZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDkgJiYgcHNyLT5lbmFi
bGVkKSB7CiAJCQkvKgogCQkJICogQWN0aXZhdGUgUFNSIGFnYWluIGFmdGVyIGEgZm9yY2UgZXhp
dCB3aGVuIGVuYWJsaW5nCiAJCQkgKiBDUkMgaW4gb2xkZXIgZ2VucwogCQkJICovCi0JCQlpZiAo
IWRldl9wcml2LT5wc3IuYWN0aXZlICYmCi0JCQkgICAgIWRldl9wcml2LT5wc3IuYnVzeV9mcm9u
dGJ1ZmZlcl9iaXRzKQotCQkJCXNjaGVkdWxlX3dvcmsoJmRldl9wcml2LT5wc3Iud29yayk7CisJ
CQlpZiAoIWludGVsX2RwLT5wc3IuYWN0aXZlICYmCisJCQkgICAgIWludGVsX2RwLT5wc3IuYnVz
eV9mcm9udGJ1ZmZlcl9iaXRzKQorCQkJCXNjaGVkdWxlX3dvcmsoJmludGVsX2RwLT5wc3Iud29y
ayk7CiAJCX0KIAogCQlnb3RvIHVubG9jazsKQEAgLTE0NjcsMzQgKzE0NjcsMjMgQEAgdm9pZCBp
bnRlbF9wc3JfdXBkYXRlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCWludGVsX3Bzcl9k
aXNhYmxlX2xvY2tlZChpbnRlbF9kcCk7CiAKIAlpZiAoZW5hYmxlKQotCQlpbnRlbF9wc3JfZW5h
YmxlX2xvY2tlZChkZXZfcHJpdiwgY3J0Y19zdGF0ZSwgY29ubl9zdGF0ZSk7CisJCWludGVsX3Bz
cl9lbmFibGVfbG9ja2VkKGludGVsX2RwLCBjcnRjX3N0YXRlLCBjb25uX3N0YXRlKTsKIAogdW5s
b2NrOgotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRleF91bmxvY2so
JmludGVsX2RwLT5wc3IubG9jayk7CiB9CiAKIC8qKgotICogaW50ZWxfcHNyX3dhaXRfZm9yX2lk
bGUgLSB3YWl0IGZvciBQU1IxIHRvIGlkbGUKLSAqIEBuZXdfY3J0Y19zdGF0ZTogbmV3IENSVEMg
c3RhdGUKKyAqIHBzcl93YWl0X2Zvcl9pZGxlIC0gd2FpdCBmb3IgUFNSMSB0byBpZGxlCisgKiBA
aW50ZWxfZHA6IEludGVsIERQCiAgKiBAb3V0X3ZhbHVlOiBQU1Igc3RhdHVzIGluIGNhc2Ugb2Yg
ZmFpbHVyZQogICoKLSAqIFRoaXMgZnVuY3Rpb24gaXMgZXhwZWN0ZWQgdG8gYmUgY2FsbGVkIGZy
b20gcGlwZV91cGRhdGVfc3RhcnQoKSB3aGVyZSBpdCBpcwotICogbm90IGV4cGVjdGVkIHRvIHJh
Y2Ugd2l0aCBQU1IgZW5hYmxlIG9yIGRpc2FibGUuCi0gKgogICogUmV0dXJuczogMCBvbiBzdWNj
ZXNzIG9yIC1FVElNRU9VVCBpZiBQU1Igc3RhdHVzIGRvZXMgbm90IGlkbGUuCisgKgogICovCi1p
bnQgaW50ZWxfcHNyX3dhaXRfZm9yX2lkbGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
Km5ld19jcnRjX3N0YXRlLAotCQkJICAgIHUzMiAqb3V0X3ZhbHVlKQorc3RhdGljIGludCBwc3Jf
d2FpdF9mb3JfaWRsZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCB1MzIgKm91dF92YWx1ZSkK
IHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMobmV3X2NydGNfc3Rh
dGUtPnVhcGkuY3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShjcnRjLT5iYXNlLmRldik7Ci0KLQlpZiAoIWRldl9wcml2LT5wc3IuZW5hYmxlZCB8fCAh
bmV3X2NydGNfc3RhdGUtPmhhc19wc3IpCi0JCXJldHVybiAwOwotCi0JLyogRklYTUU6IFVwZGF0
ZSB0aGlzIGZvciBQU1IyIGlmIHdlIG5lZWQgdG8gd2FpdCBmb3IgaWRsZSAqLwotCWlmIChSRUFE
X09OQ0UoZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQpKQotCQlyZXR1cm4gMDsKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAogCS8q
CiAJICogRnJvbSBic3BlYzogUGFuZWwgU2VsZiBSZWZyZXNoIChCRFcrKQpAQCAtMTUwMiwzMiAr
MTQ5MSw2OCBAQCBpbnQgaW50ZWxfcHNyX3dhaXRfZm9yX2lkbGUoY29uc3Qgc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlLAogCSAqIGV4aXQgdHJhaW5pbmcgdGltZSArIDEu
NSBtcyBvZiBhdXggY2hhbm5lbCBoYW5kc2hha2UuIDUwIG1zIGlzCiAJICogZGVmZW5zaXZlIGVu
b3VnaCB0byBjb3ZlciBldmVyeXRoaW5nLgogCSAqLwotCiAJcmV0dXJuIF9faW50ZWxfd2FpdF9m
b3JfcmVnaXN0ZXIoJmRldl9wcml2LT51bmNvcmUsCi0JCQkJCSBFRFBfUFNSX1NUQVRVUyhkZXZf
cHJpdi0+cHNyLnRyYW5zY29kZXIpLAorCQkJCQkgRURQX1BTUl9TVEFUVVMoaW50ZWxfZHAtPnBz
ci50cmFuc2NvZGVyKSwKIAkJCQkJIEVEUF9QU1JfU1RBVFVTX1NUQVRFX01BU0ssCiAJCQkJCSBF
RFBfUFNSX1NUQVRVU19TVEFURV9JRExFLCAyLCA1MCwKIAkJCQkJIG91dF92YWx1ZSk7CiB9CiAK
LXN0YXRpYyBib29sIF9fcHNyX3dhaXRfZm9yX2lkbGVfbG9ja2VkKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKKy8qKgorICogaW50ZWxfcHNyX3dhaXRfZm9yX2lkbGUgLSB3YWl0
IGZvciBQU1IxIHRvIGlkbGUKKyAqIEBuZXdfY3J0Y19zdGF0ZTogbmV3IENSVEMgc3RhdGUKKyAq
CisgKiBUaGlzIGZ1bmN0aW9uIGlzIGV4cGVjdGVkIHRvIGJlIGNhbGxlZCBmcm9tIHBpcGVfdXBk
YXRlX3N0YXJ0KCkgd2hlcmUgaXQgaXMKKyAqIG5vdCBleHBlY3RlZCB0byByYWNlIHdpdGggUFNS
IGVuYWJsZSBvciBkaXNhYmxlLgorICovCit2b2lkIGludGVsX3Bzcl93YWl0X2Zvcl9pZGxlKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSkKK3sKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KG5ld19jcnRjX3N0YXRlLT51YXBp
LmNydGMtPmRldik7CisJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXI7CisKKwlpZiAoIW5l
d19jcnRjX3N0YXRlLT5oYXNfcHNyKQorCQlyZXR1cm47CisKKwlmb3JfZWFjaF9pbnRlbF9lbmNv
ZGVyX21hc2tfY2FuX3BzcigmZGV2X3ByaXYtPmRybSwgZW5jb2RlciwKKwkJCQkJICAgIG5ld19j
cnRjX3N0YXRlLT51YXBpLmVuY29kZXJfbWFzaykgeworCQlzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwID0gZW5jX3RvX2ludGVsX2RwKGVuY29kZXIpOworCQl1MzIgcHNyX3N0YXR1czsKKworCQlt
dXRleF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOworCQlpZiAoIWludGVsX2RwLT5wc3IuZW5h
YmxlZCB8fAorCQkgICAgIChpbnRlbF9kcC0+cHNyLmVuYWJsZWQgJiYgaW50ZWxfZHAtPnBzci5w
c3IyX2VuYWJsZWQpKSB7CisJCQltdXRleF91bmxvY2soJmludGVsX2RwLT5wc3IubG9jayk7CisJ
CQljb250aW51ZTsKKwkJfQorCisJCS8qIHdoZW4gdGhlIFBTUjEgaXMgZW5hYmxlZCAqLworCQlp
ZiAocHNyX3dhaXRfZm9yX2lkbGUoaW50ZWxfZHAsICZwc3Jfc3RhdHVzKSkKKwkJCWRybV9lcnIo
JmRldl9wcml2LT5kcm0sCisJCQkJIlBTUiBpZGxlIHRpbWVkIG91dCAweCV4LCBhdG9taWMgdXBk
YXRlIG1heSBmYWlsXG4iLAorCQkJCXBzcl9zdGF0dXMpOworCQltdXRleF91bmxvY2soJmludGVs
X2RwLT5wc3IubG9jayk7CisJfQorfQorCitzdGF0aWMgYm9vbCBfX3Bzcl93YWl0X2Zvcl9pZGxl
X2xvY2tlZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogeworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCWk5MTVfcmVnX3QgcmVn
OwogCXUzMiBtYXNrOwogCWludCBlcnI7CiAKLQlpZiAoIWRldl9wcml2LT5wc3IuZW5hYmxlZCkK
KwlpZiAoIWludGVsX2RwLT5wc3IuZW5hYmxlZCkKIAkJcmV0dXJuIGZhbHNlOwogCi0JaWYgKGRl
dl9wcml2LT5wc3IucHNyMl9lbmFibGVkKSB7Ci0JCXJlZyA9IEVEUF9QU1IyX1NUQVRVUyhkZXZf
cHJpdi0+cHNyLnRyYW5zY29kZXIpOworCWlmIChpbnRlbF9kcC0+cHNyLnBzcjJfZW5hYmxlZCkg
eworCQlyZWcgPSBFRFBfUFNSMl9TVEFUVVMoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKTsKIAkJ
bWFzayA9IEVEUF9QU1IyX1NUQVRVU19TVEFURV9NQVNLOwogCX0gZWxzZSB7Ci0JCXJlZyA9IEVE
UF9QU1JfU1RBVFVTKGRldl9wcml2LT5wc3IudHJhbnNjb2Rlcik7CisJCXJlZyA9IEVEUF9QU1Jf
U1RBVFVTKGludGVsX2RwLT5wc3IudHJhbnNjb2Rlcik7CiAJCW1hc2sgPSBFRFBfUFNSX1NUQVRV
U19TVEFURV9NQVNLOwogCX0KIAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsK
KwltdXRleF91bmxvY2soJmludGVsX2RwLT5wc3IubG9jayk7CiAKIAllcnIgPSBpbnRlbF9kZV93
YWl0X2Zvcl9jbGVhcihkZXZfcHJpdiwgcmVnLCBtYXNrLCA1MCk7CiAJaWYgKGVycikKQEAgLTE1
MzUsOCArMTU2MCw4IEBAIHN0YXRpYyBib29sIF9fcHNyX3dhaXRfZm9yX2lkbGVfbG9ja2VkKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJCSJUaW1lZCBvdXQgd2FpdGluZyBm
b3IgUFNSIElkbGUgZm9yIHJlLWVuYWJsZVxuIik7CiAKIAkvKiBBZnRlciB0aGUgdW5sb2NrZWQg
d2FpdCwgdmVyaWZ5IHRoYXQgUFNSIGlzIHN0aWxsIHdhbnRlZCEgKi8KLQltdXRleF9sb2NrKCZk
ZXZfcHJpdi0+cHNyLmxvY2spOwotCXJldHVybiBlcnIgPT0gMCAmJiBkZXZfcHJpdi0+cHNyLmVu
YWJsZWQ7CisJbXV0ZXhfbG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKKwlyZXR1cm4gZXJyID09
IDAgJiYgaW50ZWxfZHAtPnBzci5lbmFibGVkOwogfQogCiBzdGF0aWMgaW50IGludGVsX3Bzcl9m
YXN0c2V0X2ZvcmNlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKQEAgLTE2MDIs
OCArMTYyNyw5IEBAIHN0YXRpYyBpbnQgaW50ZWxfcHNyX2Zhc3RzZXRfZm9yY2Uoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXJldHVybiBlcnI7CiB9CiAKLWludCBpbnRlbF9w
c3JfZGVidWdfc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTY0IHZhbCkK
K2ludCBpbnRlbF9wc3JfZGVidWdfc2V0KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIHU2NCB2
YWwpCiB7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShp
bnRlbF9kcCk7CiAJY29uc3QgdTMyIG1vZGUgPSB2YWwgJiBJOTE1X1BTUl9ERUJVR19NT0RFX01B
U0s7CiAJdTMyIG9sZF9tb2RlOwogCWludCByZXQ7CkBAIC0xNjE0LDIxICsxNjQwLDIxIEBAIGlu
dCBpbnRlbF9wc3JfZGVidWdfc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwg
dTY0IHZhbCkKIAkJcmV0dXJuIC1FSU5WQUw7CiAJfQogCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRl
cnJ1cHRpYmxlKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCXJldCA9IG11dGV4X2xvY2tfaW50ZXJy
dXB0aWJsZSgmaW50ZWxfZHAtPnBzci5sb2NrKTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0Owog
Ci0Jb2xkX21vZGUgPSBkZXZfcHJpdi0+cHNyLmRlYnVnICYgSTkxNV9QU1JfREVCVUdfTU9ERV9N
QVNLOwotCWRldl9wcml2LT5wc3IuZGVidWcgPSB2YWw7CisJb2xkX21vZGUgPSBpbnRlbF9kcC0+
cHNyLmRlYnVnICYgSTkxNV9QU1JfREVCVUdfTU9ERV9NQVNLOworCWludGVsX2RwLT5wc3IuZGVi
dWcgPSB2YWw7CiAKIAkvKgogCSAqIERvIGl0IHJpZ2h0IGF3YXkgaWYgaXQncyBhbHJlYWR5IGVu
YWJsZWQsIG90aGVyd2lzZSBpdCB3aWxsIGJlIGRvbmUKIAkgKiB3aGVuIGVuYWJsaW5nIHRoZSBz
b3VyY2UuCiAJICovCi0JaWYgKGRldl9wcml2LT5wc3IuZW5hYmxlZCkKLQkJcHNyX2lycV9jb250
cm9sKGRldl9wcml2KTsKKwlpZiAoaW50ZWxfZHAtPnBzci5lbmFibGVkKQorCQlwc3JfaXJxX2Nv
bnRyb2woaW50ZWxfZHApOwogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOwor
CW11dGV4X3VubG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKIAogCWlmIChvbGRfbW9kZSAhPSBt
b2RlKQogCQlyZXQgPSBpbnRlbF9wc3JfZmFzdHNldF9mb3JjZShkZXZfcHJpdik7CkBAIC0xNjM2
LDI4ICsxNjYyLDI4IEBAIGludCBpbnRlbF9wc3JfZGVidWdfc2V0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwgdTY0IHZhbCkKIAlyZXR1cm4gcmV0OwogfQogCi1zdGF0aWMgdm9p
ZCBpbnRlbF9wc3JfaGFuZGxlX2lycShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CitzdGF0aWMgdm9pZCBpbnRlbF9wc3JfaGFuZGxlX2lycShzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwKQogewotCXN0cnVjdCBpOTE1X3BzciAqcHNyID0gJmRldl9wcml2LT5wc3I7CisJc3RydWN0
IGludGVsX3BzciAqcHNyID0gJmludGVsX2RwLT5wc3I7CiAKLQlpbnRlbF9wc3JfZGlzYWJsZV9s
b2NrZWQocHNyLT5kcCk7CisJaW50ZWxfcHNyX2Rpc2FibGVfbG9ja2VkKGludGVsX2RwKTsKIAlw
c3ItPnNpbmtfbm90X3JlbGlhYmxlID0gdHJ1ZTsKIAkvKiBsZXQncyBtYWtlIHN1cmUgdGhhdCBz
aW5rIGlzIGF3YWtlbiAqLwotCWRybV9kcF9kcGNkX3dyaXRlYigmcHNyLT5kcC0+YXV4LCBEUF9T
RVRfUE9XRVIsIERQX1NFVF9QT1dFUl9EMCk7CisJZHJtX2RwX2RwY2Rfd3JpdGViKCZpbnRlbF9k
cC0+YXV4LCBEUF9TRVRfUE9XRVIsIERQX1NFVF9QT1dFUl9EMCk7CiB9CiAKIHN0YXRpYyB2b2lk
IGludGVsX3Bzcl93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQotCQljb250YWluZXJfb2Yod29yaywgdHlwZW9mKCpk
ZXZfcHJpdiksIHBzci53b3JrKTsKKwlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0KKwkJY29u
dGFpbmVyX29mKHdvcmssIHR5cGVvZigqaW50ZWxfZHApLCBwc3Iud29yayk7CiAKLQltdXRleF9s
b2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCW11dGV4X2xvY2soJmludGVsX2RwLT5wc3IubG9j
ayk7CiAKLQlpZiAoIWRldl9wcml2LT5wc3IuZW5hYmxlZCkKKwlpZiAoIWludGVsX2RwLT5wc3Iu
ZW5hYmxlZCkKIAkJZ290byB1bmxvY2s7CiAKLQlpZiAoUkVBRF9PTkNFKGRldl9wcml2LT5wc3Iu
aXJxX2F1eF9lcnJvcikpCi0JCWludGVsX3Bzcl9oYW5kbGVfaXJxKGRldl9wcml2KTsKKwlpZiAo
UkVBRF9PTkNFKGludGVsX2RwLT5wc3IuaXJxX2F1eF9lcnJvcikpCisJCWludGVsX3Bzcl9oYW5k
bGVfaXJxKGludGVsX2RwKTsKIAogCS8qCiAJICogV2UgaGF2ZSB0byBtYWtlIHN1cmUgUFNSIGlz
IHJlYWR5IGZvciByZS1lbmFibGUKQEAgLTE2NjUsNyArMTY5MSw3IEBAIHN0YXRpYyB2b2lkIGlu
dGVsX3Bzcl93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAkgKiBQU1IgbWlnaHQgdGFr
ZSBzb21lIHRpbWUgdG8gZ2V0IGZ1bGx5IGRpc2FibGVkCiAJICogYW5kIGJlIHJlYWR5IGZvciBy
ZS1lbmFibGUuCiAJICovCi0JaWYgKCFfX3Bzcl93YWl0X2Zvcl9pZGxlX2xvY2tlZChkZXZfcHJp
dikpCisJaWYgKCFfX3Bzcl93YWl0X2Zvcl9pZGxlX2xvY2tlZChpbnRlbF9kcCkpCiAJCWdvdG8g
dW5sb2NrOwogCiAJLyoKQEAgLTE2NzMsMTIgKzE2OTksMTIgQEAgc3RhdGljIHZvaWQgaW50ZWxf
cHNyX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCSAqIHJlY2hlY2suIFNpbmNlIHBz
cl9mbHVzaCBmaXJzdCBjbGVhcnMgdGhpcyBhbmQgdGhlbiByZXNjaGVkdWxlcyB3ZQogCSAqIHdv
bid0IGV2ZXIgbWlzcyBhIGZsdXNoIHdoZW4gYmFpbGluZyBvdXQgaGVyZS4KIAkgKi8KLQlpZiAo
ZGV2X3ByaXYtPnBzci5idXN5X2Zyb250YnVmZmVyX2JpdHMgfHwgZGV2X3ByaXYtPnBzci5hY3Rp
dmUpCisJaWYgKGludGVsX2RwLT5wc3IuYnVzeV9mcm9udGJ1ZmZlcl9iaXRzIHx8IGludGVsX2Rw
LT5wc3IuYWN0aXZlKQogCQlnb3RvIHVubG9jazsKIAotCWludGVsX3Bzcl9hY3RpdmF0ZShkZXZf
cHJpdi0+cHNyLmRwKTsKKwlpbnRlbF9wc3JfYWN0aXZhdGUoaW50ZWxfZHApOwogdW5sb2NrOgot
CW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRleF91bmxvY2soJmludGVs
X2RwLT5wc3IubG9jayk7CiB9CiAKIC8qKgpAQCAtMTY5NywyNyArMTcyMywzMSBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9wc3Jfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiB2b2lkIGludGVs
X3Bzcl9pbnZhbGlkYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCSAg
dW5zaWduZWQgZnJvbnRidWZmZXJfYml0cywgZW51bSBmYl9vcF9vcmlnaW4gb3JpZ2luKQogewot
CWlmICghQ0FOX1BTUihkZXZfcHJpdikpCi0JCXJldHVybjsKKwlzdHJ1Y3QgaW50ZWxfZW5jb2Rl
ciAqZW5jb2RlcjsKIAogCWlmIChvcmlnaW4gPT0gT1JJR0lOX0ZMSVApCiAJCXJldHVybjsKIAot
CW11dGV4X2xvY2soJmRldl9wcml2LT5wc3IubG9jayk7Ci0JaWYgKCFkZXZfcHJpdi0+cHNyLmVu
YWJsZWQpIHsKLQkJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOwotCQlyZXR1cm47
Ci0JfQorCWZvcl9lYWNoX2ludGVsX2VuY29kZXJfY2FuX3BzcigmZGV2X3ByaXYtPmRybSwgZW5j
b2RlcikgeworCQl1bnNpZ25lZCBpbnQgcGlwZV9mcm9udGJ1ZmZlcl9iaXRzID0gZnJvbnRidWZm
ZXJfYml0czsKKwkJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcChl
bmNvZGVyKTsKIAotCWZyb250YnVmZmVyX2JpdHMgJj0gSU5URUxfRlJPTlRCVUZGRVJfQUxMX01B
U0soZGV2X3ByaXYtPnBzci5waXBlKTsKLQlkZXZfcHJpdi0+cHNyLmJ1c3lfZnJvbnRidWZmZXJf
Yml0cyB8PSBmcm9udGJ1ZmZlcl9iaXRzOworCQltdXRleF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxv
Y2spOworCQlpZiAoIWludGVsX2RwLT5wc3IuZW5hYmxlZCkgeworCQkJbXV0ZXhfdW5sb2NrKCZp
bnRlbF9kcC0+cHNyLmxvY2spOworCQkJY29udGludWU7CisJCX0KIAotCWlmIChmcm9udGJ1ZmZl
cl9iaXRzKQotCQlpbnRlbF9wc3JfZXhpdChkZXZfcHJpdik7CisJCXBpcGVfZnJvbnRidWZmZXJf
Yml0cyAmPQorCQkJSU5URUxfRlJPTlRCVUZGRVJfQUxMX01BU0soaW50ZWxfZHAtPnBzci5waXBl
KTsKKwkJaW50ZWxfZHAtPnBzci5idXN5X2Zyb250YnVmZmVyX2JpdHMgfD0gcGlwZV9mcm9udGJ1
ZmZlcl9iaXRzOwogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOwotfQorCQlp
ZiAocGlwZV9mcm9udGJ1ZmZlcl9iaXRzKQorCQkJaW50ZWxfcHNyX2V4aXQoaW50ZWxfZHApOwog
CisJCW11dGV4X3VubG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKKwl9Cit9CiAvKgogICogV2hl
biB3ZSB3aWxsIGJlIGNvbXBsZXRlbHkgcmVseSBvbiBQU1IyIFMvVyB0cmFja2luZyBpbiBmdXR1
cmUsCiAgKiBpbnRlbF9wc3JfZmx1c2goKSB3aWxsIGludmFsaWRhdGUgYW5kIGZsdXNoIHRoZSBQ
U1IgZm9yIE9SSUdJTl9GTElQCkBAIC0xNzI1LDE1ICsxNzU1LDE1IEBAIHZvaWQgaW50ZWxfcHNy
X2ludmFsaWRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogICogYWNjb3Jk
aW5nbHkgaW4gZnV0dXJlLgogICovCiBzdGF0aWMgdm9pZAotdGdsX2RjM2NvX2ZsdXNoKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJdW5zaWduZWQgaW50IGZyb250YnVmZmVy
X2JpdHMsIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbikKK3RnbF9kYzNjb19mbHVzaChzdHJ1Y3Qg
aW50ZWxfZHAgKmludGVsX2RwLCB1bnNpZ25lZCBpbnQgZnJvbnRidWZmZXJfYml0cywKKwkJZW51
bSBmYl9vcF9vcmlnaW4gb3JpZ2luKQogewotCW11dGV4X2xvY2soJmRldl9wcml2LT5wc3IubG9j
ayk7CisJbXV0ZXhfbG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKIAotCWlmICghZGV2X3ByaXYt
PnBzci5kYzNjb19lbmFibGVkKQorCWlmICghaW50ZWxfZHAtPnBzci5kYzNjb19lbmFibGVkKQog
CQlnb3RvIHVubG9jazsKIAotCWlmICghZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQgfHwgIWRl
dl9wcml2LT5wc3IuYWN0aXZlKQorCWlmICghaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJsZWQgfHwg
IWludGVsX2RwLT5wc3IuYWN0aXZlKQogCQlnb3RvIHVubG9jazsKIAogCS8qCkBAIC0xNzQxLDE1
ICsxNzcxLDE1IEBAIHRnbF9kYzNjb19mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCiAJICogd2hlbiBkZWxheWVkIHdvcmsgc2NoZWR1bGVzIHRoYXQgbWVhbnMgZGlzcGxh
eSBoYXMgYmVlbiBpZGxlLgogCSAqLwogCWlmICghKGZyb250YnVmZmVyX2JpdHMgJgotCSAgICBJ
TlRFTF9GUk9OVEJVRkZFUl9BTExfTUFTSyhkZXZfcHJpdi0+cHNyLnBpcGUpKSkKKwkgICAgSU5U
RUxfRlJPTlRCVUZGRVJfQUxMX01BU0soaW50ZWxfZHAtPnBzci5waXBlKSkpCiAJCWdvdG8gdW5s
b2NrOwogCi0JdGdsX3BzcjJfZW5hYmxlX2RjM2NvKGRldl9wcml2KTsKLQltb2RfZGVsYXllZF93
b3JrKHN5c3RlbV93cSwgJmRldl9wcml2LT5wc3IuZGMzY29fd29yaywKLQkJCSBkZXZfcHJpdi0+
cHNyLmRjM2NvX2V4aXRfZGVsYXkpOworCXRnbF9wc3IyX2VuYWJsZV9kYzNjbyhpbnRlbF9kcCk7
CisJbW9kX2RlbGF5ZWRfd29yayhzeXN0ZW1fd3EsICZpbnRlbF9kcC0+cHNyLmRjM2NvX3dvcmss
CisJCQkgaW50ZWxfZHAtPnBzci5kYzNjb19leGl0X2RlbGF5KTsKIAogdW5sb2NrOgotCW11dGV4
X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRleF91bmxvY2soJmludGVsX2RwLT5w
c3IubG9jayk7CiB9CiAKIC8qKgpAQCAtMTc2OCw0NyArMTc5OCw3MyBAQCB0Z2xfZGMzY29fZmx1
c2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogdm9pZCBpbnRlbF9wc3JfZmx1
c2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkgICAgIHVuc2lnbmVkIGZy
b250YnVmZmVyX2JpdHMsIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbikKIHsKLQlpZiAoIUNBTl9Q
U1IoZGV2X3ByaXYpKQotCQlyZXR1cm47CisJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXI7
CiAKLQlpZiAob3JpZ2luID09IE9SSUdJTl9GTElQKSB7Ci0JCXRnbF9kYzNjb19mbHVzaChkZXZf
cHJpdiwgZnJvbnRidWZmZXJfYml0cywgb3JpZ2luKTsKLQkJcmV0dXJuOwotCX0KKwlmb3JfZWFj
aF9pbnRlbF9lbmNvZGVyX2Nhbl9wc3IoJmRldl9wcml2LT5kcm0sIGVuY29kZXIpIHsKKwkJdW5z
aWduZWQgaW50IHBpcGVfZnJvbnRidWZmZXJfYml0cyA9IGZyb250YnVmZmVyX2JpdHM7CisJCXN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5jb2Rlcik7CiAKLQlt
dXRleF9sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOwotCWlmICghZGV2X3ByaXYtPnBzci5lbmFi
bGVkKSB7Ci0JCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKLQkJcmV0dXJuOwot
CX0KKwkJaWYgKG9yaWdpbiA9PSBPUklHSU5fRkxJUCkgeworCQkJdGdsX2RjM2NvX2ZsdXNoKGlu
dGVsX2RwLCBmcm9udGJ1ZmZlcl9iaXRzLCBvcmlnaW4pOworCQkJY29udGludWU7CisJCX0KKwor
CQltdXRleF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOworCQlpZiAoIWludGVsX2RwLT5wc3Iu
ZW5hYmxlZCkgeworCQkJbXV0ZXhfdW5sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOworCQkJY29u
dGludWU7CisJCX0KIAotCWZyb250YnVmZmVyX2JpdHMgJj0gSU5URUxfRlJPTlRCVUZGRVJfQUxM
X01BU0soZGV2X3ByaXYtPnBzci5waXBlKTsKLQlkZXZfcHJpdi0+cHNyLmJ1c3lfZnJvbnRidWZm
ZXJfYml0cyAmPSB+ZnJvbnRidWZmZXJfYml0czsKKwkJcGlwZV9mcm9udGJ1ZmZlcl9iaXRzICY9
CisJCQlJTlRFTF9GUk9OVEJVRkZFUl9BTExfTUFTSyhpbnRlbF9kcC0+cHNyLnBpcGUpOworCQlp
bnRlbF9kcC0+cHNyLmJ1c3lfZnJvbnRidWZmZXJfYml0cyAmPSB+cGlwZV9mcm9udGJ1ZmZlcl9i
aXRzOwogCi0JLyogQnkgZGVmaW5pdGlvbiBmbHVzaCA9IGludmFsaWRhdGUgKyBmbHVzaCAqLwot
CWlmIChmcm9udGJ1ZmZlcl9iaXRzKQotCQlwc3JfZm9yY2VfaHdfdHJhY2tpbmdfZXhpdChkZXZf
cHJpdik7CisJCS8qIEJ5IGRlZmluaXRpb24gZmx1c2ggPSBpbnZhbGlkYXRlICsgZmx1c2ggKi8K
KwkJaWYgKHBpcGVfZnJvbnRidWZmZXJfYml0cykKKwkJCXBzcl9mb3JjZV9od190cmFja2luZ19l
eGl0KGludGVsX2RwKTsKIAotCWlmICghZGV2X3ByaXYtPnBzci5hY3RpdmUgJiYgIWRldl9wcml2
LT5wc3IuYnVzeV9mcm9udGJ1ZmZlcl9iaXRzKQotCQlzY2hlZHVsZV93b3JrKCZkZXZfcHJpdi0+
cHNyLndvcmspOwotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwkJaWYgKCFp
bnRlbF9kcC0+cHNyLmFjdGl2ZSAmJiAhaW50ZWxfZHAtPnBzci5idXN5X2Zyb250YnVmZmVyX2Jp
dHMpCisJCQlzY2hlZHVsZV93b3JrKCZpbnRlbF9kcC0+cHNyLndvcmspOworCQltdXRleF91bmxv
Y2soJmludGVsX2RwLT5wc3IubG9jayk7CisJfQogfQogCiAvKioKICAqIGludGVsX3Bzcl9pbml0
IC0gSW5pdCBiYXNpYyBQU1Igd29yayBhbmQgbXV0ZXguCi0gKiBAZGV2X3ByaXY6IGk5MTUgZGV2
aWNlIHByaXZhdGUKKyAqIEBpbnRlbF9kcDogSW50ZWwgRFAKICAqCi0gKiBUaGlzIGZ1bmN0aW9u
IGlzICBjYWxsZWQgb25seSBvbmNlIGF0IGRyaXZlciBsb2FkIHRvIGluaXRpYWxpemUgYmFzaWMK
LSAqIFBTUiBzdHVmZi4KKyAqIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIGFmdGVyIHRoZSBpbml0
aWFsaXppbmcgY29ubmVjdG9yLgorICogKHRoZSBpbml0aWFsaXppbmcgb2YgY29ubmVjdG9yIHRy
ZWF0cyB0aGUgaGFuZGxpbmcgb2YgY29ubmVjdG9yIGNhcGFiaWxpdGllcykKKyAqIEFuZCBpdCBp
bml0aWFsaXplcyBiYXNpYyBQU1Igc3R1ZmYgZm9yIGVhY2ggRFAgRW5jb2Rlci4KICAqLwotdm9p
ZCBpbnRlbF9wc3JfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit2b2lk
IGludGVsX3Bzcl9pbml0KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CisJc3RydWN0IGlu
dGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7
CisKIAlpZiAoIUhBU19QU1IoZGV2X3ByaXYpKQogCQlyZXR1cm47CiAKLQlpZiAoIWRldl9wcml2
LT5wc3Iuc2lua19zdXBwb3J0KQorCWlmICghaW50ZWxfZHAtPnBzci5zaW5rX3N1cHBvcnQpCiAJ
CXJldHVybjsKIAorCS8qCisJICogSFNXIHNwZWMgZXhwbGljaXRseSBzYXlzIFBTUiBpcyB0aWVk
IHRvIHBvcnQgQS4KKwkgKiBCRFcrIHBsYXRmb3JtcyBoYXZlIGEgaW5zdGFuY2Ugb2YgUFNSIHJl
Z2lzdGVycyBwZXIgdHJhbnNjb2RlciBidXQKKwkgKiBCRFcsIEdFTjkgYW5kIEdFTjExIGFyZSBu
b3QgdmFsaWRhdGVkIGJ5IEhXIHRlYW0gaW4gb3RoZXIgdHJhbnNjb2RlcgorCSAqIHRoYW4gZURQ
IG9uZS4KKwkgKiBGb3Igbm93IGl0IG9ubHkgc3VwcG9ydHMgb25lIGluc3RhbmNlIG9mIFBTUiBm
b3IgQkRXLCBHRU45IGFuZCBHRU4xMS4KKwkgKiBTbyBsZXRzIGtlZXAgaXQgaGFyZGNvZGVkIHRv
IFBPUlRfQSBmb3IgQkRXLCBHRU45IGFuZCBHRU4xMS4KKwkgKiBCdXQgR0VOMTIgc3VwcG9ydHMg
YSBpbnN0YW5jZSBvZiBQU1IgcmVnaXN0ZXJzIHBlciB0cmFuc2NvZGVyLgorCSAqLworCWlmIChJ
TlRFTF9HRU4oZGV2X3ByaXYpIDwgMTIgJiYgZGlnX3BvcnQtPmJhc2UucG9ydCAhPSBQT1JUX0Ep
IHsKKwkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCisJCQkgICAgIlBTUiBjb25kaXRpb24g
ZmFpbGVkOiBQb3J0IG5vdCBzdXBwb3J0ZWRcbiIpOworCQlyZXR1cm47CisJfQorCisJaW50ZWxf
ZHAtPnBzci5zb3VyY2Vfc3VwcG9ydCA9IHRydWU7CisKIAlpZiAoSVNfSEFTV0VMTChkZXZfcHJp
dikpCiAJCS8qCiAJCSAqIEhTVyBkb24ndCBoYXZlIFBTUiByZWdpc3RlcnMgb24gdGhlIHNhbWUg
c3BhY2UgYXMgdHJhbnNjb2RlcgpAQCAtMTgyNCwxNCArMTg4MCwxNCBAQCB2b2lkIGludGVsX3Bz
cl9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkvKiBTZXQgbGlua19z
dGFuZGJ5IHggbGlua19vZmYgZGVmYXVsdHMgKi8KIAlpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikg
fHwgSVNfQlJPQURXRUxMKGRldl9wcml2KSkKIAkJLyogSFNXIGFuZCBCRFcgcmVxdWlyZSB3b3Jr
YXJvdW5kcyB0aGF0IHdlIGRvbid0IGltcGxlbWVudC4gKi8KLQkJZGV2X3ByaXYtPnBzci5saW5r
X3N0YW5kYnkgPSBmYWxzZTsKKwkJaW50ZWxfZHAtPnBzci5saW5rX3N0YW5kYnkgPSBmYWxzZTsK
IAllbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTIpCiAJCS8qIEZvciBuZXcgcGxhdGZv
cm1zIHVwIHRvIFRHTCBsZXQncyByZXNwZWN0IFZCVCBiYWNrIGFnYWluICovCi0JCWRldl9wcml2
LT5wc3IubGlua19zdGFuZGJ5ID0gZGV2X3ByaXYtPnZidC5wc3IuZnVsbF9saW5rOworCQlpbnRl
bF9kcC0+cHNyLmxpbmtfc3RhbmRieSA9IGRldl9wcml2LT52YnQucHNyLmZ1bGxfbGluazsKIAot
CUlOSVRfV09SSygmZGV2X3ByaXYtPnBzci53b3JrLCBpbnRlbF9wc3Jfd29yayk7Ci0JSU5JVF9E
RUxBWUVEX1dPUksoJmRldl9wcml2LT5wc3IuZGMzY29fd29yaywgdGdsX2RjM2NvX2Rpc2FibGVf
d29yayk7Ci0JbXV0ZXhfaW5pdCgmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwlJTklUX1dPUksoJmlu
dGVsX2RwLT5wc3Iud29yaywgaW50ZWxfcHNyX3dvcmspOworCUlOSVRfREVMQVlFRF9XT1JLKCZp
bnRlbF9kcC0+cHNyLmRjM2NvX3dvcmssIHRnbF9kYzNjb19kaXNhYmxlX3dvcmspOworCW11dGV4
X2luaXQoJmludGVsX2RwLT5wc3IubG9jayk7CiB9CiAKIHN0YXRpYyBpbnQgcHNyX2dldF9zdGF0
dXNfYW5kX2Vycm9yX3N0YXR1cyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLApAQCAtMTg1Nyw3
ICsxOTEzLDcgQEAgc3RhdGljIHZvaWQgcHNyX2FscG1fY2hlY2soc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19p
OTE1KGludGVsX2RwKTsKIAlzdHJ1Y3QgZHJtX2RwX2F1eCAqYXV4ID0gJmludGVsX2RwLT5hdXg7
Ci0Jc3RydWN0IGk5MTVfcHNyICpwc3IgPSAmZGV2X3ByaXYtPnBzcjsKKwlzdHJ1Y3QgaW50ZWxf
cHNyICpwc3IgPSAmaW50ZWxfZHAtPnBzcjsKIAl1OCB2YWw7CiAJaW50IHI7CiAKQEAgLTE4ODQs
NyArMTk0MCw3IEBAIHN0YXRpYyB2b2lkIHBzcl9hbHBtX2NoZWNrKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHApCiBzdGF0aWMgdm9pZCBwc3JfY2FwYWJpbGl0eV9jaGFuZ2VkX2NoZWNrKHN0cnVj
dCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7Ci0Jc3RydWN0IGk5MTVfcHNyICpwc3IgPSAmZGV2
X3ByaXYtPnBzcjsKKwlzdHJ1Y3QgaW50ZWxfcHNyICpwc3IgPSAmaW50ZWxfZHAtPnBzcjsKIAl1
OCB2YWw7CiAJaW50IHI7CiAKQEAgLTE5MDgsMTggKzE5NjQsMTggQEAgc3RhdGljIHZvaWQgcHNy
X2NhcGFiaWxpdHlfY2hhbmdlZF9jaGVjayhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogdm9p
ZCBpbnRlbF9wc3Jfc2hvcnRfcHVsc2Uoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKIAlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsK
LQlzdHJ1Y3QgaTkxNV9wc3IgKnBzciA9ICZkZXZfcHJpdi0+cHNyOworCXN0cnVjdCBpbnRlbF9w
c3IgKnBzciA9ICZpbnRlbF9kcC0+cHNyOwogCXU4IHN0YXR1cywgZXJyb3Jfc3RhdHVzOwogCWNv
bnN0IHU4IGVycm9ycyA9IERQX1BTUl9SRkJfU1RPUkFHRV9FUlJPUiB8CiAJCQkgIERQX1BTUl9W
U0NfU0RQX1VOQ09SUkVDVEFCTEVfRVJST1IgfAogCQkJICBEUF9QU1JfTElOS19DUkNfRVJST1I7
CiAKLQlpZiAoIUNBTl9QU1IoZGV2X3ByaXYpIHx8ICFpbnRlbF9kcF9pc19lZHAoaW50ZWxfZHAp
KQorCWlmICghQ0FOX1BTUihpbnRlbF9kcCkgfHwgIWludGVsX2RwX2lzX2VkcChpbnRlbF9kcCkp
CiAJCXJldHVybjsKIAogCW11dGV4X2xvY2soJnBzci0+bG9jayk7CiAKLQlpZiAoIXBzci0+ZW5h
YmxlZCB8fCBwc3ItPmRwICE9IGludGVsX2RwKQorCWlmICghcHNyLT5lbmFibGVkKQogCQlnb3Rv
IGV4aXQ7CiAKIAlpZiAocHNyX2dldF9zdGF0dXNfYW5kX2Vycm9yX3N0YXR1cyhpbnRlbF9kcCwg
JnN0YXR1cywgJmVycm9yX3N0YXR1cykpIHsKQEAgLTE5NjIsMTUgKzIwMTgsMTQgQEAgdm9pZCBp
bnRlbF9wc3Jfc2hvcnRfcHVsc2Uoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAogYm9vbCBp
bnRlbF9wc3JfZW5hYmxlZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCWJvb2wg
cmV0OwogCi0JaWYgKCFDQU5fUFNSKGRldl9wcml2KSB8fCAhaW50ZWxfZHBfaXNfZWRwKGludGVs
X2RwKSkKKwlpZiAoIUNBTl9QU1IoaW50ZWxfZHApIHx8ICFpbnRlbF9kcF9pc19lZHAoaW50ZWxf
ZHApKQogCQlyZXR1cm4gZmFsc2U7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2sp
OwotCXJldCA9IChkZXZfcHJpdi0+cHNyLmRwID09IGludGVsX2RwICYmIGRldl9wcml2LT5wc3Iu
ZW5hYmxlZCk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCW11dGV4X2xv
Y2soJmludGVsX2RwLT5wc3IubG9jayk7CisJcmV0ID0gaW50ZWxfZHAtPnBzci5lbmFibGVkOwor
CW11dGV4X3VubG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKIAogCXJldHVybiByZXQ7CiB9CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5oIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuaAppbmRleCAwYTUxNzk3OGU4YWYu
LjA0OTFhNDlmZmQ1MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9wc3IuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5o
CkBAIC0xOCw3ICsxOCw2IEBAIHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGU7CiBzdHJ1Y3QgaW50
ZWxfcGxhbmVfc3RhdGU7CiBzdHJ1Y3QgaW50ZWxfcGxhbmU7CiAKLSNkZWZpbmUgQ0FOX1BTUihk
ZXZfcHJpdikgKEhBU19QU1IoZGV2X3ByaXYpICYmIGRldl9wcml2LT5wc3Iuc2lua19zdXBwb3J0
KQogdm9pZCBpbnRlbF9wc3JfaW5pdF9kcGNkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApOwog
dm9pZCBpbnRlbF9wc3JfZW5hYmxlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCSAgICAg
IGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLApAQCAtMjgsMjAgKzI3
LDE5IEBAIHZvaWQgaW50ZWxfcHNyX2Rpc2FibGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwK
IHZvaWQgaW50ZWxfcHNyX3VwZGF0ZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCQkgICAg
ICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJICAgICAgY29u
c3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpOwotaW50IGludGVsX3Bz
cl9kZWJ1Z19zZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1NjQgdmFsdWUp
OworaW50IGludGVsX3Bzcl9kZWJ1Z19zZXQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwgdTY0
IHZhbHVlKTsKIHZvaWQgaW50ZWxfcHNyX2ludmFsaWRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAogCQkJICB1bnNpZ25lZCBmcm9udGJ1ZmZlcl9iaXRzLAogCQkJICBlbnVt
IGZiX29wX29yaWdpbiBvcmlnaW4pOwogdm9pZCBpbnRlbF9wc3JfZmx1c2goc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkgICAgIHVuc2lnbmVkIGZyb250YnVmZmVyX2JpdHMs
CiAJCSAgICAgZW51bSBmYl9vcF9vcmlnaW4gb3JpZ2luKTsKLXZvaWQgaW50ZWxfcHNyX2luaXQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK3ZvaWQgaW50ZWxfcHNyX2luaXQo
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCk7CiB2b2lkIGludGVsX3Bzcl9jb21wdXRlX2NvbmZp
ZyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCQkJICAgICAgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUpOwotdm9pZCBpbnRlbF9wc3JfaXJxX2hhbmRsZXIoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgcHNyX2lpcik7Cit2b2lkIGludGVsX3Bzcl9p
cnFfaGFuZGxlcihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCB1MzIgcHNyX2lpcik7CiB2b2lk
IGludGVsX3Bzcl9zaG9ydF9wdWxzZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKTsKLWludCBp
bnRlbF9wc3Jfd2FpdF9mb3JfaWRsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3
X2NydGNfc3RhdGUsCi0JCQkgICAgdTMyICpvdXRfdmFsdWUpOwordm9pZCBpbnRlbF9wc3Jfd2Fp
dF9mb3JfaWRsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUp
OwogYm9vbCBpbnRlbF9wc3JfZW5hYmxlZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKTsKIGlu
dCBpbnRlbF9wc3IyX3NlbF9mZXRjaF91cGRhdGUoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAq
c3RhdGUsCiAJCQkJc3RydWN0IGludGVsX2NydGMgKmNydGMpOwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMKaW5kZXggZTgzYzg3OGFjN2IwLi4yMTM0ZTc3NmUy
YWEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRl
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYwpAQCAt
OTYsNyArOTYsNiBAQCB2b2lkIGludGVsX3BpcGVfdXBkYXRlX3N0YXJ0KGNvbnN0IHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSkKIAlib29sIG5lZWRfdmx2X2RzaV93YSA9
IChJU19WQUxMRVlWSUVXKGRldl9wcml2KSB8fCBJU19DSEVSUllWSUVXKGRldl9wcml2KSkgJiYK
IAkJaW50ZWxfY3J0Y19oYXNfdHlwZShuZXdfY3J0Y19zdGF0ZSwgSU5URUxfT1VUUFVUX0RTSSk7
CiAJREVGSU5FX1dBSVQod2FpdCk7Ci0JdTMyIHBzcl9zdGF0dXM7CiAKIAlpZiAobmV3X2NydGNf
c3RhdGUtPnVhcGkuYXN5bmNfZmxpcCkKIAkJcmV0dXJuOwpAQCAtMTIyLDEwICsxMjEsNyBAQCB2
b2lkIGludGVsX3BpcGVfdXBkYXRlX3N0YXJ0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpuZXdfY3J0Y19zdGF0ZSkKIAkgKiBWQkwgaW50ZXJydXB0cyB3aWxsIHN0YXJ0IHRoZSBQU1Ig
ZXhpdCBhbmQgcHJldmVudCBhIFBTUgogCSAqIHJlLWVudHJ5IGFzIHdlbGwuCiAJICovCi0JaWYg
KGludGVsX3Bzcl93YWl0X2Zvcl9pZGxlKG5ld19jcnRjX3N0YXRlLCAmcHNyX3N0YXR1cykpCi0J
CWRybV9lcnIoJmRldl9wcml2LT5kcm0sCi0JCQkiUFNSIGlkbGUgdGltZWQgb3V0IDB4JXgsIGF0
b21pYyB1cGRhdGUgbWF5IGZhaWxcbiIsCi0JCQlwc3Jfc3RhdHVzKTsKKwlpbnRlbF9wc3Jfd2Fp
dF9mb3JfaWRsZShuZXdfY3J0Y19zdGF0ZSk7CiAKIAlsb2NhbF9pcnFfZGlzYWJsZSgpOwogCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9kcnYuaAppbmRleCAzZWRjOWM0ZjJkMjEuLjM4MTZiMTJhYWMwYyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2Rydi5oCkBAIC00NzgsNDIgKzQ3OCw2IEBAIHN0cnVjdCBpOTE1X2Ry
cnMgewogCWVudW0gZHJyc19zdXBwb3J0X3R5cGUgdHlwZTsKIH07CiAKLXN0cnVjdCBpOTE1X3Bz
ciB7Ci0Jc3RydWN0IG11dGV4IGxvY2s7Ci0KLSNkZWZpbmUgSTkxNV9QU1JfREVCVUdfTU9ERV9N
QVNLCTB4MGYKLSNkZWZpbmUgSTkxNV9QU1JfREVCVUdfREVGQVVMVAkJMHgwMAotI2RlZmluZSBJ
OTE1X1BTUl9ERUJVR19ESVNBQkxFCQkweDAxCi0jZGVmaW5lIEk5MTVfUFNSX0RFQlVHX0VOQUJM
RQkJMHgwMgotI2RlZmluZSBJOTE1X1BTUl9ERUJVR19GT1JDRV9QU1IxCTB4MDMKLSNkZWZpbmUg
STkxNV9QU1JfREVCVUdfSVJRCQkweDEwCi0KLQl1MzIgZGVidWc7Ci0JYm9vbCBzaW5rX3N1cHBv
cnQ7Ci0JYm9vbCBlbmFibGVkOwotCXN0cnVjdCBpbnRlbF9kcCAqZHA7Ci0JZW51bSBwaXBlIHBp
cGU7Ci0JZW51bSB0cmFuc2NvZGVyIHRyYW5zY29kZXI7Ci0JYm9vbCBhY3RpdmU7Ci0Jc3RydWN0
IHdvcmtfc3RydWN0IHdvcms7Ci0JdW5zaWduZWQgYnVzeV9mcm9udGJ1ZmZlcl9iaXRzOwotCWJv
b2wgc2lua19wc3IyX3N1cHBvcnQ7Ci0JYm9vbCBsaW5rX3N0YW5kYnk7Ci0JYm9vbCBjb2xvcmlt
ZXRyeV9zdXBwb3J0OwotCWJvb2wgcHNyMl9lbmFibGVkOwotCWJvb2wgcHNyMl9zZWxfZmV0Y2hf
ZW5hYmxlZDsKLQl1OCBzaW5rX3N5bmNfbGF0ZW5jeTsKLQlrdGltZV90IGxhc3RfZW50cnlfYXR0
ZW1wdDsKLQlrdGltZV90IGxhc3RfZXhpdDsKLQlib29sIHNpbmtfbm90X3JlbGlhYmxlOwotCWJv
b2wgaXJxX2F1eF9lcnJvcjsKLQl1MTYgc3VfeF9ncmFudWxhcml0eTsKLQlib29sIGRjM2NvX2Vu
YWJsZWQ7Ci0JdTMyIGRjM2NvX2V4aXRfZGVsYXk7Ci0Jc3RydWN0IGRlbGF5ZWRfd29yayBkYzNj
b193b3JrOwotCXN0cnVjdCBkcm1fZHBfdnNjX3NkcCB2c2M7Ci19OwotCiAjZGVmaW5lIFFVSVJL
X0xWRFNfU1NDX0RJU0FCTEUgKDE8PDEpCiAjZGVmaW5lIFFVSVJLX0lOVkVSVF9CUklHSFRORVNT
ICgxPDwyKQogI2RlZmluZSBRVUlSS19CQUNLTElHSFRfUFJFU0VOVCAoMTw8MykKQEAgLTEwNDEs
OCArMTAwNSw2IEBAIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlIHsKIAogCXN0cnVjdCBpOTE1X3Bv
d2VyX2RvbWFpbnMgcG93ZXJfZG9tYWluczsKIAotCXN0cnVjdCBpOTE1X3BzciBwc3I7Ci0KIAlz
dHJ1Y3QgaTkxNV9ncHVfZXJyb3IgZ3B1X2Vycm9yOwogCiAJc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKnZsdl9wY3R4OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9p
cnEuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfaXJxLmMKaW5kZXggYTMxOTgwZjY5MTIw
Li5mNjBhMTcyMTM3MjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfaXJx
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuYwpAQCAtMjA4OCwxMCArMjA4
OCwxOSBAQCBzdGF0aWMgdm9pZCBpdmJfZGlzcGxheV9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCWl2Yl9lcnJfaW50X2hhbmRsZXIoZGV2X3ByaXYpOwog
CiAJaWYgKGRlX2lpciAmIERFX0VEUF9QU1JfSU5UX0hTVykgewotCQl1MzIgcHNyX2lpciA9IGlu
dGVsX3VuY29yZV9yZWFkKCZkZXZfcHJpdi0+dW5jb3JlLCBFRFBfUFNSX0lJUik7CisJCXN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyOwogCi0JCWludGVsX3Bzcl9pcnFfaGFuZGxlcihkZXZf
cHJpdiwgcHNyX2lpcik7Ci0JCWludGVsX3VuY29yZV93cml0ZSgmZGV2X3ByaXYtPnVuY29yZSwg
RURQX1BTUl9JSVIsIHBzcl9paXIpOworCQlmb3JfZWFjaF9pbnRlbF9lbmNvZGVyX2Nhbl9wc3Io
JmRldl9wcml2LT5kcm0sIGVuY29kZXIpIHsKKwkJCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAg
PSBlbmNfdG9faW50ZWxfZHAoZW5jb2Rlcik7CisKKwkJCXUzMiBwc3JfaWlyID0gaW50ZWxfdW5j
b3JlX3JlYWQoJmRldl9wcml2LT51bmNvcmUsCisJCQkJCQkJRURQX1BTUl9JSVIpOworCisJCQlp
bnRlbF9wc3JfaXJxX2hhbmRsZXIoaW50ZWxfZHAsIHBzcl9paXIpOworCQkJaW50ZWxfdW5jb3Jl
X3dyaXRlKCZkZXZfcHJpdi0+dW5jb3JlLAorCQkJCQkgICBFRFBfUFNSX0lJUiwgcHNyX2lpcik7
CisJCQlicmVhazsKKwkJfQogCX0KIAogCWlmIChkZV9paXIgJiBERV9BVVhfQ0hBTk5FTF9BX0lW
QikKQEAgLTIzMDEsMjEgKzIzMTAsMzAgQEAgZ2VuOF9kZV9taXNjX2lycV9oYW5kbGVyKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTMyIGlpcikKIAl9CiAKIAlpZiAoaWlyICYg
R0VOOF9ERV9FRFBfUFNSKSB7CisJCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyOwogCQl1
MzIgcHNyX2lpcjsKIAkJaTkxNV9yZWdfdCBpaXJfcmVnOwogCi0JCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDEyKQotCQkJaWlyX3JlZyA9IFRSQU5TX1BTUl9JSVIoZGV2X3ByaXYtPnBzci50
cmFuc2NvZGVyKTsKLQkJZWxzZQotCQkJaWlyX3JlZyA9IEVEUF9QU1JfSUlSOworCQlmb3JfZWFj
aF9pbnRlbF9lbmNvZGVyX2Nhbl9wc3IoJmRldl9wcml2LT5kcm0sIGVuY29kZXIpIHsKKwkJCXN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5jb2Rlcik7CiAKLQkJ
cHNyX2lpciA9IGludGVsX3VuY29yZV9yZWFkKCZkZXZfcHJpdi0+dW5jb3JlLCBpaXJfcmVnKTsK
LQkJaW50ZWxfdW5jb3JlX3dyaXRlKCZkZXZfcHJpdi0+dW5jb3JlLCBpaXJfcmVnLCBwc3JfaWly
KTsKKwkJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKQorCQkJCWlpcl9yZWcgPSBUUkFO
U19QU1JfSUlSKGludGVsX2RwLT5wc3IudHJhbnNjb2Rlcik7CisJCQllbHNlCisJCQkJaWlyX3Jl
ZyA9IEVEUF9QU1JfSUlSOwogCi0JCWlmIChwc3JfaWlyKQotCQkJZm91bmQgPSB0cnVlOworCQkJ
cHNyX2lpciA9IGludGVsX3VuY29yZV9yZWFkKCZkZXZfcHJpdi0+dW5jb3JlLCBpaXJfcmVnKTsK
KwkJCWludGVsX3VuY29yZV93cml0ZSgmZGV2X3ByaXYtPnVuY29yZSwgaWlyX3JlZywgcHNyX2lp
cik7CiAKLQkJaW50ZWxfcHNyX2lycV9oYW5kbGVyKGRldl9wcml2LCBwc3JfaWlyKTsKKwkJCWlm
IChwc3JfaWlyKQorCQkJCWZvdW5kID0gdHJ1ZTsKKworCQkJaW50ZWxfcHNyX2lycV9oYW5kbGVy
KGludGVsX2RwLCBwc3JfaWlyKTsKKworCQkJLyogcHJpb3IgR0VOMTIgb25seSBoYXZlIG9uZSBF
RFAgUFNSICovCisJCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDEyKQorCQkJCWJyZWFrOwor
CQl9CiAJfQogCiAJaWYgKCFmb3VuZCkKLS0gCjIuMzAuMAoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1n
ZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21h
aWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

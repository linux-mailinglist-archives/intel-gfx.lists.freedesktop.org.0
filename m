Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7854E129665
	for <lists+intel-gfx@lfdr.de>; Mon, 23 Dec 2019 14:17:36 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B864F6E0F5;
	Mon, 23 Dec 2019 13:17:34 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga03.intel.com (mga03.intel.com [134.134.136.65])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6D22A89FC5
 for <intel-gfx@lists.freedesktop.org>; Mon, 23 Dec 2019 13:17:29 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga001.fm.intel.com ([10.253.24.23])
 by orsmga103.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 23 Dec 2019 05:17:29 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,347,1571727600"; d="scan'208";a="223020233"
Received: from slisovsk-lenovo-ideapad-720s-13ikb.fi.intel.com ([10.237.72.89])
 by fmsmga001.fm.intel.com with ESMTP; 23 Dec 2019 05:17:27 -0800
From: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 23 Dec 2019 15:14:43 +0200
Message-Id: <20191223131444.20259-4-stanislav.lisovskiy@intel.com>
X-Mailer: git-send-email 2.24.1.485.gad05a3d8e5
In-Reply-To: <20191223131444.20259-1-stanislav.lisovskiy@intel.com>
References: <20191223131444.20259-1-stanislav.lisovskiy@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v10 3/4] drm/i915: Manipulate DBuf slices
 properly
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U3RhcnQgbWFuaXB1bGF0aW5nIERCdWYgc2xpY2VzIGFzIGEgbWFzaywKYnV0IG5vdCBhcyBhIHRv
dGFsIG51bWJlciwgYXMgY3VycmVudCBhcHByb2FjaApkb2Vzbid0IGdpdmUgdXMgZnVsbCBjb250
cm9sIG9uIGFsbCBjb21iaW5hdGlvbnMKb2Ygc2xpY2VzLCB3aGljaCB3ZSBtaWdodCBuZWVkKGxp
a2UgZW5hYmxpbmcgUzIKb25seSBjYW4ndCBlbmFibGVkIGJ5IHNldHRpbmcgZW5hYmxlZF9zbGlj
ZXM9MSkuCgpSZW1vdmVkIHdyb25nIGNvZGUgZnJvbSBpbnRlbF9nZXRfZGRiX3NpemUgYXMKaXQg
ZG9lc24ndCBtYXRjaCB0byBCU3BlYy4gRm9yIG5vdyBzdGlsbCBqdXN0CnVzZSBEQnVmIHNsaWNl
IHVudGlsIHByb3BlciBhbGdvcml0aG0gaXMgaW1wbGVtZW50ZWQuCgpPdGhlciBtaW5vciBjb2Rl
IHJlZmFjdG9yaW5nIHRvIGdldCBwcmVwYXJlZApmb3IgbWFqb3IgREJ1ZiBhc3NpZ25tZW50IGNo
YW5nZXMgbGFuZGVkOgotIEFzIG5vdyBlbmFibGVkIHNsaWNlcyBjb250YWluIGEgbWFzawogIHdl
IHN0aWxsIG5lZWQgc29tZSB2YWx1ZSB3aGljaCBzaG91bGQKICByZWZsZWN0IGhvdyBtdWNoIERC
dWYgc2xpY2VzIGFyZSBzdXBwb3J0ZWQKICBieSB0aGUgcGxhdGZvcm0sIG5vdyBkZXZpY2UgaW5m
byBjb250YWlucwogIG51bV9zdXBwb3J0ZWRfZGJ1Zl9zbGljZXMuCi0gUmVtb3ZlZCB1bm5lZWRl
ZCBhc3NlcnRpb24gYXMgd2UgYXJlIG5vdwogIG1hbmlwdWxhdGluZyBzbGljZXMgaW4gYSBtb3Jl
IHByb3BlciB3YXkuCgp2MjogU3RhcnQgdXNpbmcgZW5hYmxlZF9zbGljZXMgaW4gZGV2X3ByaXYK
CnYzOiAiZW5hYmxlZF9zbGljZXMiIGlzIG5vdyAiZW5hYmxlZF9kYnVmX3NsaWNlc19tYXNrIiwK
ICAgIGFzIHRoaXMgbm93IHNpdHMgaW4gZGV2X3ByaXYgaW5kZXBlbmRlbnRseS4KCnY0OiAtIEZp
eGVkIGRlYnVnIHByaW50IGZvcm1hdHRpbmcgdG8gaGV4KE1hdHQgUm9wZXIpCiAgICAtIE9wdGlt
aXplZCBkYnVmIHNsaWNlIHVwZGF0ZXMgdG8gYmUgdXNlZCBvbmx5CiAgICAgIGlmIHNsaWNlIHVu
aW9uIGlzIGRpZmZlcmVudCBmcm9tIGN1cnJlbnQgY29uZihNYXR0IFJvcGVyKQogICAgLSBGaXhl
ZCBzb21lIGZ1bmN0aW9ucyB0byBiZSBzdGF0aWMoTWF0dCBSb3BlcikKICAgIC0gQ3JlYXRlZCBh
IHBhcmFtZXRlcml6ZWQgdmVyc2lvbiBmb3IgREJVRl9DVEwgdG8KICAgICAgc2ltcGxpZnkgREJ1
ZiBwcm9ncmFtbWluZyBjeWNsZShNYXR0IFJvcGVyKQogICAgLSBSZW1vdmVkIHVucmVxdXJlZCBm
aWVsZCBmcm9tIEdFTjEwX0ZFQVRVUkVTKE1hdHQgUm9wZXIpCgp2NTogLSBSZW1vdmVkIHJlZHVu
ZGFudCBwcm9ncmFtbWluZyBkYnVmIHNsaWNlcyBoZWxwZXIoVmlsbGUgU3lyasOkbMOkKQogICAg
LSBTdGFydGVkIHRvIHVzZSBwYXJhbWV0ZXJpemVkIGxvb3AgZm9yIGh3IHJlYWRvdXQgdG8gZ2V0
IHNsaWNlcwogICAgICAoVmlsbGUgU3lyasOkbMOkKQogICAgLSBBZGRlZCBiYWNrIGFzc2VydGlv
biBjaGVja2luZyBhbW91bnQgb2YgREJVRiBzbGljZXMgZW5hYmxlZAogICAgICBhZnRlciBEQyBz
dGF0ZXMgNS82IHRyYW5zaXRpb24sIGFsc28gYWRkZWQgbmV3IGFzc2VydGlvbgogICAgICBhcyBz
dGFydGluZyBmcm9tIElDTCBETUMgc2VlbXMgdG8gcmVzdG9yZSB0aGUgbGFzdCBEQnVmCiAgICAg
IHBvd2VyIHN0YXRlIHNldCwgcmF0aGVyIHRoYW4gcG93ZXIgdXAgYWxsIGRidWYgc2xpY2VzCiAg
ICAgIGFzIGFzc2VydGlvbiB3YXMgcHJldmlvdXNseSBleHBlY3RpbmcoVmlsbGUgU3lyasOkbMOk
KQoKU2lnbmVkLW9mZi1ieTogU3RhbmlzbGF2IExpc292c2tpeSA8c3RhbmlzbGF2Lmxpc292c2tp
eUBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5LmMgIHwgMjMgKystLS0KIC4uLi9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfcG93
ZXIuYyAgICB8IDk0ICsrKysrKysrKy0tLS0tLS0tLS0KIC4uLi9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2Rpc3BsYXlfcG93ZXIuaCAgICB8ICA0ICsKIC4uLi9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2Rpc3BsYXlfdHlwZXMuaCAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Ry
di5oICAgICAgICAgICAgICAgfCAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wY2ku
YyAgICAgICAgICAgICAgIHwgIDUgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmgg
ICAgICAgICAgICAgICB8ICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2RldmljZV9p
bmZvLmggICAgICB8ICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMgICAgICAg
ICAgICAgICB8IDUxICsrKy0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmgg
ICAgICAgICAgICAgICB8ICAyICstCiAxMCBmaWxlcyBjaGFuZ2VkLCA4MyBpbnNlcnRpb25zKCsp
LCAxMDIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2Rpc3BsYXkuYwppbmRleCBiYmE3ODk3ZDA1ZDguLjc1N2U5MGNjYmFiNSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTEzMzMyLDEyICsxMzMz
MiwxMiBAQCBzdGF0aWMgdm9pZCB2ZXJpZnlfd21fc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNy
dGMsCiAKIAlza2xfcGlwZV9kZGJfZ2V0X2h3X3N0YXRlKGNydGMsIGh3LT5kZGJfeSwgaHctPmRk
Yl91dik7CiAKLQlod19lbmFibGVkX3NsaWNlcyA9IGludGVsX2VuYWJsZWRfZGJ1Zl9zbGljZXNf
bnVtKGRldl9wcml2KTsKKwlod19lbmFibGVkX3NsaWNlcyA9IGludGVsX2VuYWJsZWRfZGJ1Zl9z
bGljZXNfbWFzayhkZXZfcHJpdik7CiAKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSAm
JgotCSAgICBod19lbmFibGVkX3NsaWNlcyAhPSBkZXZfcHJpdi0+ZW5hYmxlZF9kYnVmX3NsaWNl
c19udW0pCi0JCURSTV9FUlJPUigibWlzbWF0Y2ggaW4gREJVRiBTbGljZXMgKGV4cGVjdGVkICV1
LCBnb3QgJXUpXG4iLAotCQkJICBkZXZfcHJpdi0+ZW5hYmxlZF9kYnVmX3NsaWNlc19udW0sCisJ
ICAgIGh3X2VuYWJsZWRfc2xpY2VzICE9IGRldl9wcml2LT5lbmFibGVkX2RidWZfc2xpY2VzX21h
c2spCisJCURSTV9FUlJPUigibWlzbWF0Y2ggaW4gREJVRiBTbGljZXMgKGV4cGVjdGVkIDB4JXgs
IGdvdCAweCV4KVxuIiwKKwkJCSAgZGV2X3ByaXYtPmVuYWJsZWRfZGJ1Zl9zbGljZXNfbWFzaywK
IAkJCSAgaHdfZW5hYmxlZF9zbGljZXMpOwogCiAJLyogcGxhbmVzICovCkBAIC0xNDUxOCwyMiAr
MTQ1MTgsMjMgQEAgc3RhdGljIHZvaWQgaW50ZWxfdXBkYXRlX3RyYW5zX3BvcnRfc3luY19jcnRj
cyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIHN0YXRpYyB2b2lkIGljbF9kYnVmX3NsaWNlX3By
ZV91cGRhdGUoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7CiAJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5kZXYpOwotCXU4
IGh3X2VuYWJsZWRfc2xpY2VzID0gZGV2X3ByaXYtPmVuYWJsZWRfZGJ1Zl9zbGljZXNfbnVtOwot
CXU4IHJlcXVpcmVkX3NsaWNlcyA9IHN0YXRlLT5lbmFibGVkX2RidWZfc2xpY2VzX251bTsKKwl1
OCBod19lbmFibGVkX3NsaWNlcyA9IGRldl9wcml2LT5lbmFibGVkX2RidWZfc2xpY2VzX21hc2s7
CisJdTggcmVxdWlyZWRfc2xpY2VzID0gc3RhdGUtPmVuYWJsZWRfZGJ1Zl9zbGljZXNfbWFzazsK
Kwl1OCBzbGljZXNfdW5pb24gPSBod19lbmFibGVkX3NsaWNlcyB8IHJlcXVpcmVkX3NsaWNlczsK
IAogCS8qIElmIDJuZCBEQnVmIHNsaWNlIHJlcXVpcmVkLCBlbmFibGUgaXQgaGVyZSAqLwotCWlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExICYmIHJlcXVpcmVkX3NsaWNlcyA+IGh3X2VuYWJs
ZWRfc2xpY2VzKQotCQlpY2xfZGJ1Zl9zbGljZXNfdXBkYXRlKGRldl9wcml2LCByZXF1aXJlZF9z
bGljZXMpOworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExICYmIHNsaWNlc191bmlvbiAh
PSBod19lbmFibGVkX3NsaWNlcykKKwkJaWNsX2RidWZfc2xpY2VzX3VwZGF0ZShkZXZfcHJpdiwg
c2xpY2VzX3VuaW9uKTsKIH0KIAogc3RhdGljIHZvaWQgaWNsX2RidWZfc2xpY2VfcG9zdF91cGRh
dGUoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7CiAJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5kZXYpOwotCXU4IGh3X2Vu
YWJsZWRfc2xpY2VzID0gZGV2X3ByaXYtPmVuYWJsZWRfZGJ1Zl9zbGljZXNfbnVtOwotCXU4IHJl
cXVpcmVkX3NsaWNlcyA9IHN0YXRlLT5lbmFibGVkX2RidWZfc2xpY2VzX251bTsKKwl1OCBod19l
bmFibGVkX3NsaWNlcyA9IGRldl9wcml2LT5lbmFibGVkX2RidWZfc2xpY2VzX21hc2s7CisJdTgg
cmVxdWlyZWRfc2xpY2VzID0gc3RhdGUtPmVuYWJsZWRfZGJ1Zl9zbGljZXNfbWFzazsKIAogCS8q
IElmIDJuZCBEQnVmIHNsaWNlIGlzIG5vIG1vcmUgcmVxdWlyZWQgZGlzYWJsZSBpdCAqLwotCWlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExICYmIHJlcXVpcmVkX3NsaWNlcyA8IGh3X2VuYWJs
ZWRfc2xpY2VzKQorCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExICYmIHJlcXVpcmVkX3Ns
aWNlcyAhPSBod19lbmFibGVkX3NsaWNlcykKIAkJaWNsX2RidWZfc2xpY2VzX3VwZGF0ZShkZXZf
cHJpdiwgcmVxdWlyZWRfc2xpY2VzKTsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfcG93ZXIuYwppbmRleCBkODA1OGNjNjFlNDUuLmIzMDcz
OGQyZDQ2YyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
aXNwbGF5X3Bvd2VyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
aXNwbGF5X3Bvd2VyLmMKQEAgLTE1LDYgKzE1LDcgQEAKICNpbmNsdWRlICJpbnRlbF9kaXNwbGF5
X3R5cGVzLmgiCiAjaW5jbHVkZSAiaW50ZWxfZHBpb19waHkuaCIKICNpbmNsdWRlICJpbnRlbF9o
b3RwbHVnLmgiCisjaW5jbHVkZSAiaW50ZWxfcG0uaCIKICNpbmNsdWRlICJpbnRlbF9zaWRlYmFu
ZC5oIgogI2luY2x1ZGUgImludGVsX3RjLmgiCiAjaW5jbHVkZSAiaW50ZWxfdmdhLmgiCkBAIC0x
MDMxLDggKzEwMzIsMTkgQEAgc3RhdGljIHZvaWQgZ2VuOV9hc3NlcnRfZGJ1Zl9lbmFibGVkKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAl1MzIgdG1wID0gSTkxNV9SRUFEKERC
VUZfQ1RMKTsKIAogCVdBUk4oKHRtcCAmIChEQlVGX1BPV0VSX1NUQVRFIHwgREJVRl9QT1dFUl9S
RVFVRVNUKSkgIT0KLQkgICAgIChEQlVGX1BPV0VSX1NUQVRFIHwgREJVRl9QT1dFUl9SRVFVRVNU
KSwKLQkgICAgICJVbmV4cGVjdGVkIERCdWYgcG93ZXIgcG93ZXIgc3RhdGUgKDB4JTA4eClcbiIs
IHRtcCk7CisJICAgIChEQlVGX1BPV0VSX1NUQVRFIHwgREJVRl9QT1dFUl9SRVFVRVNUKSwKKwkg
ICAgIlVuZXhwZWN0ZWQgREJ1ZiBwb3dlciBwb3dlciBzdGF0ZSAoMHglMDh4LCBleHBlY3RlZCAw
eCUwOHgpXG4iLAorCSAgICB0bXAsIChEQlVGX1BPV0VSX1NUQVRFIHwgREJVRl9QT1dFUl9SRVFV
RVNUKSk7Cit9CisKK3N0YXRpYyB2b2lkIGdlbjExX2Fzc2VydF9kYnVmX3N0YXR1cyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit7CisJdTggZW5hYmxlZF9kYnVmX3NsaWNlcyA9
IGludGVsX2VuYWJsZWRfZGJ1Zl9zbGljZXNfbWFzayhkZXZfcHJpdik7CisKKwlXQVJOKGVuYWJs
ZWRfZGJ1Zl9zbGljZXMgIT0gZGV2X3ByaXYtPmVuYWJsZWRfZGJ1Zl9zbGljZXNfbWFzaywKKwkg
ICAgICJVbmV4cGVjdGVkIERCdWYgcG93ZXIgcG93ZXIgc3RhdGUgKDB4JTA4eCwgZXhwZWN0ZWQg
MHglMDh4KVxuIiwKKwkgICAgIGVuYWJsZWRfZGJ1Zl9zbGljZXMsCisJICAgICBkZXZfcHJpdi0+
ZW5hYmxlZF9kYnVmX3NsaWNlc19tYXNrKTsKIH0KIAogc3RhdGljIHZvaWQgZ2VuOV9kaXNhYmxl
X2RjX3N0YXRlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCkBAIC0xMDUwLDcg
KzEwNjIsMTEgQEAgc3RhdGljIHZvaWQgZ2VuOV9kaXNhYmxlX2RjX3N0YXRlcyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJLyogQ2FuJ3QgcmVhZCBvdXQgdm9sdGFnZV9sZXZl
bCBzbyBjYW4ndCB1c2UgaW50ZWxfY2RjbGtfY2hhbmdlZCgpICovCiAJV0FSTl9PTihpbnRlbF9j
ZGNsa19uZWVkc19tb2Rlc2V0KCZkZXZfcHJpdi0+Y2RjbGsuaHcsICZjZGNsa19zdGF0ZSkpOwog
Ci0JZ2VuOV9hc3NlcnRfZGJ1Zl9lbmFibGVkKGRldl9wcml2KTsKKwkvKiBTdGFydGluZyBmcm9t
IElDTCwgRE1DIHJlc3RvcmVzIHRoZSBsYXN0IHN0YXRlLCBiZWluZyBzZXQgKi8KKwlpZiAoSU5U
RUxfR0VOKGRldl9wcml2KSA+PSAxMSkKKwkJZ2VuMTFfYXNzZXJ0X2RidWZfc3RhdHVzKGRldl9w
cml2KTsKKwllbHNlCisJCWdlbjlfYXNzZXJ0X2RidWZfZW5hYmxlZChkZXZfcHJpdik7CiAKIAlp
ZiAoSVNfR0VOOV9MUChkZXZfcHJpdikpCiAJCWJ4dF92ZXJpZnlfZGRpX3BoeV9wb3dlcl93ZWxs
cyhkZXZfcHJpdik7CkBAIC00Mzk2LDcyICs0NDEyLDQ4IEBAIHN0YXRpYyB2b2lkIGdlbjlfZGJ1
Zl9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlpbnRlbF9kYnVm
X3NsaWNlX3NldChkZXZfcHJpdiwgREJVRl9DVEwsIGZhbHNlKTsKIH0KIAotc3RhdGljIHU4IGlu
dGVsX2RidWZfbWF4X3NsaWNlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitp
bnQgaW50ZWxfZGJ1Zl9tYXhfc2xpY2VzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dikKIHsKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDExKQotCQlyZXR1cm4gMTsKLQlyZXR1
cm4gMjsKKwlyZXR1cm4gSU5URUxfSU5GTyhkZXZfcHJpdiktPm51bV9zdXBwb3J0ZWRfZGJ1Zl9z
bGljZXM7CiB9CiAKIHZvaWQgaWNsX2RidWZfc2xpY2VzX3VwZGF0ZShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkgICAgdTggcmVxX3NsaWNlcykKIHsKLQljb25zdCB1OCBo
d19lbmFibGVkX3NsaWNlcyA9IGRldl9wcml2LT5lbmFibGVkX2RidWZfc2xpY2VzX251bTsKLQli
b29sIHJldDsKKwlpbnQgaTsKKwlpbnQgbWF4X3NsaWNlcyA9IGludGVsX2RidWZfbWF4X3NsaWNl
cyhkZXZfcHJpdik7CiAKLQlpZiAocmVxX3NsaWNlcyA+IGludGVsX2RidWZfbWF4X3NsaWNlcyhk
ZXZfcHJpdikpIHsKLQkJRFJNX0VSUk9SKCJJbnZhbGlkIG51bWJlciBvZiBkYnVmIHNsaWNlcyBy
ZXF1ZXN0ZWRcbiIpOwotCQlyZXR1cm47Ci0JfQorCVdBUk4oaHdlaWdodDgocmVxX3NsaWNlcykg
PiBtYXhfc2xpY2VzLAorCSAgICAgIkludmFsaWQgbnVtYmVyIG9mIGRidWYgc2xpY2VzIHJlcXVl
c3RlZFxuIik7CiAKLQlpZiAocmVxX3NsaWNlcyA9PSBod19lbmFibGVkX3NsaWNlcyB8fCByZXFf
c2xpY2VzID09IDApCi0JCXJldHVybjsKKwlEUk1fREVCVUdfS01TKCJVcGRhdGluZyBkYnVmIHNs
aWNlcyB0byAweCV4XG4iLCByZXFfc2xpY2VzKTsKIAotCWlmIChyZXFfc2xpY2VzID4gaHdfZW5h
YmxlZF9zbGljZXMpCi0JCXJldCA9IGludGVsX2RidWZfc2xpY2Vfc2V0KGRldl9wcml2LCBEQlVG
X0NUTF9TMiwgdHJ1ZSk7Ci0JZWxzZQotCQlyZXQgPSBpbnRlbF9kYnVmX3NsaWNlX3NldChkZXZf
cHJpdiwgREJVRl9DVExfUzIsIGZhbHNlKTsKKwlmb3IgKGkgPSAwOyBpIDwgbWF4X3NsaWNlczsg
aSsrKSB7CisJCWludGVsX2RidWZfc2xpY2Vfc2V0KGRldl9wcml2LAorCQkJCSAgICAgREJVRl9D
VExfUyhCSVQoaSkpLAorCQkJCSAgICAgcmVxX3NsaWNlcyAmIEJJVChpKSk7CisJfQogCi0JaWYg
KHJldCkKLQkJZGV2X3ByaXYtPmVuYWJsZWRfZGJ1Zl9zbGljZXNfbnVtID0gcmVxX3NsaWNlczsK
KwlkZXZfcHJpdi0+ZW5hYmxlZF9kYnVmX3NsaWNlc19tYXNrID0gcmVxX3NsaWNlczsKIH0KIAog
c3RhdGljIHZvaWQgaWNsX2RidWZfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIHsKLQlJOTE1X1dSSVRFKERCVUZfQ1RMX1MxLCBJOTE1X1JFQUQoREJVRl9DVExfUzEp
IHwgREJVRl9QT1dFUl9SRVFVRVNUKTsKLQlJOTE1X1dSSVRFKERCVUZfQ1RMX1MyLCBJOTE1X1JF
QUQoREJVRl9DVExfUzIpIHwgREJVRl9QT1dFUl9SRVFVRVNUKTsKLQlQT1NUSU5HX1JFQUQoREJV
Rl9DVExfUzIpOwotCi0JdWRlbGF5KDEwKTsKLQotCWlmICghKEk5MTVfUkVBRChEQlVGX0NUTF9T
MSkgJiBEQlVGX1BPV0VSX1NUQVRFKSB8fAotCSAgICAhKEk5MTVfUkVBRChEQlVGX0NUTF9TMikg
JiBEQlVGX1BPV0VSX1NUQVRFKSkKLQkJRFJNX0VSUk9SKCJEQnVmIHBvd2VyIGVuYWJsZSB0aW1l
b3V0XG4iKTsKLQllbHNlCi0JCS8qCi0JCSAqIEZJWE1FOiBmb3Igbm93IHByZXRlbmQgdGhhdCB3
ZSBvbmx5IGhhdmUgMSBzbGljZSwgc2VlCi0JCSAqIGludGVsX2VuYWJsZWRfZGJ1Zl9zbGljZXNf
bnVtKCkuCi0JCSAqLwotCQlkZXZfcHJpdi0+ZW5hYmxlZF9kYnVmX3NsaWNlc19udW0gPSAxOwor
CS8qCisJICogSnVzdCBwb3dlciB1cCAxIHNsaWNlLCB3ZSB3aWxsCisJICogZmlndXJlIG91dCBs
YXRlciB3aGljaCBzbGljZXMgd2UgaGF2ZSBhbmQgd2hhdCB3ZSBuZWVkLgorCSAqLworCWRldl9w
cml2LT5lbmFibGVkX2RidWZfc2xpY2VzX21hc2sgPSBEQlVGX1MxX0JJVDsKKwlpY2xfZGJ1Zl9z
bGljZXNfdXBkYXRlKGRldl9wcml2LCBkZXZfcHJpdi0+ZW5hYmxlZF9kYnVmX3NsaWNlc19tYXNr
KTsKIH0KIAogc3RhdGljIHZvaWQgaWNsX2RidWZfZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCiB7Ci0JSTkxNV9XUklURShEQlVGX0NUTF9TMSwgSTkxNV9SRUFEKERC
VUZfQ1RMX1MxKSAmIH5EQlVGX1BPV0VSX1JFUVVFU1QpOwotCUk5MTVfV1JJVEUoREJVRl9DVExf
UzIsIEk5MTVfUkVBRChEQlVGX0NUTF9TMikgJiB+REJVRl9QT1dFUl9SRVFVRVNUKTsKLQlQT1NU
SU5HX1JFQUQoREJVRl9DVExfUzIpOwotCi0JdWRlbGF5KDEwKTsKLQotCWlmICgoSTkxNV9SRUFE
KERCVUZfQ1RMX1MxKSAmIERCVUZfUE9XRVJfU1RBVEUpIHx8Ci0JICAgIChJOTE1X1JFQUQoREJV
Rl9DVExfUzIpICYgREJVRl9QT1dFUl9TVEFURSkpCi0JCURSTV9FUlJPUigiREJ1ZiBwb3dlciBk
aXNhYmxlIHRpbWVvdXQhXG4iKTsKLQllbHNlCi0JCS8qCi0JCSAqIEZJWE1FOiBmb3Igbm93IHBy
ZXRlbmQgdGhhdCB0aGUgZmlyc3Qgc2xpY2UgaXMgYWx3YXlzCi0JCSAqIGVuYWJsZWQsIHNlZSBp
bnRlbF9lbmFibGVkX2RidWZfc2xpY2VzX251bSgpLgotCQkgKi8KLQkJZGV2X3ByaXYtPmVuYWJs
ZWRfZGJ1Zl9zbGljZXNfbnVtID0gMTsKKwkvKgorCSAqIERpc2FibGUgYWxsIHNsaWNlcworCSAq
LworCWRldl9wcml2LT5lbmFibGVkX2RidWZfc2xpY2VzX21hc2sgPSAwOworCWljbF9kYnVmX3Ns
aWNlc191cGRhdGUoZGV2X3ByaXYsIGRldl9wcml2LT5lbmFibGVkX2RidWZfc2xpY2VzX21hc2sp
OwogfQogCiBzdGF0aWMgdm9pZCBpY2xfbWJ1c19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheV9wb3dlci5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
aXNwbGF5X3Bvd2VyLmgKaW5kZXggMWRhMDRmM2UwZmIzLi5mNTI1OTRlY2Y1NzcgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5oCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5oCkBA
IC0zMTEsOCArMzExLDEyIEBAIGludGVsX2Rpc3BsYXlfcG93ZXJfcHV0X2FzeW5jKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCWZvciAoKHdmKSA9IGludGVsX2Rpc3BsYXlfcG93ZXJf
Z2V0KChpOTE1KSwgKGRvbWFpbikpOyAod2YpOyBcCiAJICAgICBpbnRlbF9kaXNwbGF5X3Bvd2Vy
X3B1dF9hc3luYygoaTkxNSksIChkb21haW4pLCAod2YpKSwgKHdmKSA9IDApCiAKKyNkZWZpbmUg
REJVRl9TMV9CSVQJCQlCSVQoMCkKKyNkZWZpbmUgREJVRl9TMl9CSVQJCQlCSVQoMSkKKwogdm9p
ZCBpY2xfZGJ1Zl9zbGljZXNfdXBkYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diwKIAkJCSAgICB1OCByZXFfc2xpY2VzKTsKK2ludCBpbnRlbF9kYnVmX21heF9zbGljZXMoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIAogdm9pZCBjaHZfcGh5X3Bvd2VyZ2F0
ZV9sYW5lcyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCSAgICAgYm9vbCBvdmVy
cmlkZSwgdW5zaWduZWQgaW50IG1hc2spOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaAppbmRleCA3MGU2NWMyZDUyNWQuLmJhMmU0MWEw
MzA1MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5X3R5cGVzLmgKQEAgLTUxOCw3ICs1MTgsNyBAQCBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
IHsKIAlzdHJ1Y3Qgc2tsX2RkYl92YWx1ZXMgd21fcmVzdWx0czsKIAogCS8qIE51bWJlciBvZiBl
bmFibGVkIERCdWYgc2xpY2VzICovCi0JdTggZW5hYmxlZF9kYnVmX3NsaWNlc19udW07CisJdTgg
ZW5hYmxlZF9kYnVmX3NsaWNlc19tYXNrOwogCiAJc3RydWN0IGk5MTVfc3dfZmVuY2UgY29tbWl0
X3JlYWR5OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAppbmRleCA3YTJkOWZhNWE5YTYuLmVjNGI5
ZTNjZWY3OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCkBAIC0xMjEwLDcgKzEyMTAsNyBAQCBz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSB7CiAJCWJvb2wgZGlzdHJ1c3RfYmlvc193bTsKIAl9IHdt
OwogCi0JdTggZW5hYmxlZF9kYnVmX3NsaWNlc19udW07IC8qIEdFTjExIGhhcyBjb25maWd1cmFi
bGUgMiBzbGljZXMgKi8KKwl1OCBlbmFibGVkX2RidWZfc2xpY2VzX21hc2s7IC8qIEdFTjExIGhh
cyBjb25maWd1cmFibGUgMiBzbGljZXMgKi8KIAogCXN0cnVjdCBkcmFtX2luZm8gewogCQlib29s
IHZhbGlkOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wY2kuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNpLmMKaW5kZXggOTU3MTYxMWI0YjE2Li42Mjk5OGNm
MWNlMGEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNpLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wY2kuYwpAQCAtNjE1LDcgKzYxNSw4IEBAIHN0YXRp
YyBjb25zdCBzdHJ1Y3QgaW50ZWxfZGV2aWNlX2luZm8gaW50ZWxfY2hlcnJ5dmlld19pbmZvID0g
ewogCS5oYXNfZ3RfdWMgPSAxLCBcCiAJLmRpc3BsYXkuaGFzX2hkY3AgPSAxLCBcCiAJLmRpc3Bs
YXkuaGFzX2lwYyA9IDEsIFwKLQkuZGRiX3NpemUgPSA4OTYKKwkuZGRiX3NpemUgPSA4OTYsIFwK
KwkubnVtX3N1cHBvcnRlZF9kYnVmX3NsaWNlcyA9IDEKIAogI2RlZmluZSBTS0xfUExBVEZPUk0g
XAogCUdFTjlfRkVBVFVSRVMsIFwKQEAgLTY1MCw2ICs2NTEsNyBAQCBzdGF0aWMgY29uc3Qgc3Ry
dWN0IGludGVsX2RldmljZV9pbmZvIGludGVsX3NreWxha2VfZ3Q0X2luZm8gPSB7CiAjZGVmaW5l
IEdFTjlfTFBfRkVBVFVSRVMgXAogCUdFTig5KSwgXAogCS5pc19scCA9IDEsIFwKKwkubnVtX3N1
cHBvcnRlZF9kYnVmX3NsaWNlcyA9IDEsIFwKIAkuZGlzcGxheS5oYXNfaG90cGx1ZyA9IDEsIFwK
IAkuZW5naW5lX21hc2sgPSBCSVQoUkNTMCkgfCBCSVQoVkNTMCkgfCBCSVQoQkNTMCkgfCBCSVQo
VkVDUzApLCBcCiAJLnBpcGVfbWFzayA9IEJJVChQSVBFX0EpIHwgQklUKFBJUEVfQikgfCBCSVQo
UElQRV9DKSwgXApAQCAtNzc0LDYgKzc3Niw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxf
ZGV2aWNlX2luZm8gaW50ZWxfY2Fubm9ubGFrZV9pbmZvID0gewogCX0sIFwKIAlHRU4oMTEpLCBc
CiAJLmRkYl9zaXplID0gMjA0OCwgXAorCS5udW1fc3VwcG9ydGVkX2RidWZfc2xpY2VzID0gMiwg
XAogCS5oYXNfbG9naWNhbF9yaW5nX2Vsc3EgPSAxLCBcCiAJLmNvbG9yID0geyAuZGVnYW1tYV9s
dXRfc2l6ZSA9IDMzLCAuZ2FtbWFfbHV0X3NpemUgPSAyNjIxNDUgfQogCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9yZWcuaAppbmRleCBjYmI0Njg5YWY0MzIuLjYyZWZkNWFkMDdhNyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3JlZy5oCkBAIC03NzYwLDYgKzc3NjAsNyBAQCBlbnVtIHsKICNkZWZpbmUgREJVRl9DVEwJ
X01NSU8oMHg0NTAwOCkKICNkZWZpbmUgREJVRl9DVExfUzEJX01NSU8oMHg0NTAwOCkKICNkZWZp
bmUgREJVRl9DVExfUzIJX01NSU8oMHg0NEZFOCkKKyNkZWZpbmUgREJVRl9DVExfUyhYKQkoKFgp
ID09IDEgPyBEQlVGX0NUTF9TMSA6IERCVUZfQ1RMX1MyKQogI2RlZmluZSAgREJVRl9QT1dFUl9S
RVFVRVNUCQkoMSA8PCAzMSkKICNkZWZpbmUgIERCVUZfUE9XRVJfU1RBVEUJCSgxIDw8IDMwKQog
I2RlZmluZSBHRU43X01TR19DVEwJX01NSU8oMHg0NTAxMCkKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX2RldmljZV9pbmZvLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF9kZXZpY2VfaW5mby5oCmluZGV4IDI3MjVjYjdmYzE2OS4uN2Q0ZDEyMmQyMTgyIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kZXZpY2VfaW5mby5oCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2RldmljZV9pbmZvLmgKQEAgLTE4MCw2ICsxODAsNyBA
QCBzdHJ1Y3QgaW50ZWxfZGV2aWNlX2luZm8gewogCX0gZGlzcGxheTsKIAogCXUxNiBkZGJfc2l6
ZTsgLyogaW4gYmxvY2tzICovCisJdTggbnVtX3N1cHBvcnRlZF9kYnVmX3NsaWNlczsgLyogbnVt
YmVyIG9mIERCdWYgc2xpY2VzICovCiAKIAkvKiBSZWdpc3RlciBvZmZzZXRzIGZvciB0aGUgdmFy
aW91cyBkaXNwbGF5IHBpcGVzIGFuZCB0cmFuc2NvZGVycyAqLwogCWludCBwaXBlX29mZnNldHNb
STkxNV9NQVhfVFJBTlNDT0RFUlNdOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aW50ZWxfcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKaW5kZXggMzVlYWVh
YWMwYmI1Li5kYzZiNjlmNWI2ZDcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2lu
dGVsX3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwpAQCAtMzYxNiwy
NiArMzYxNiwyMiBAQCBib29sIGlsa19kaXNhYmxlX2xwX3dtKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKIAlyZXR1cm4gX2lsa19kaXNhYmxlX2xwX3dtKGRldl9wcml2LCBXTV9E
SVJUWV9MUF9BTEwpOwogfQogCi11OCBpbnRlbF9lbmFibGVkX2RidWZfc2xpY2VzX251bShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCit1OCBpbnRlbF9lbmFibGVkX2RidWZfc2xp
Y2VzX21hc2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogewotCXU4IGVuYWJs
ZWRfZGJ1Zl9zbGljZXNfbnVtOwotCi0JLyogU2xpY2UgMSB3aWxsIGFsd2F5cyBiZSBlbmFibGVk
ICovCi0JZW5hYmxlZF9kYnVmX3NsaWNlc19udW0gPSAxOworCWludCBpOworCWludCBtYXhfc2xp
Y2VzID0gaW50ZWxfZGJ1Zl9tYXhfc2xpY2VzKGRldl9wcml2KTsKKwl1OCBlbmFibGVkX3NsaWNl
c19tYXNrID0gMDsKIAogCS8qIEdlbiBwcmlvciB0byBHRU4xMSBoYXZlIG9ubHkgb25lIERCdWYg
c2xpY2UgKi8KIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDExKQotCQlyZXR1cm4gZW5hYmxl
ZF9kYnVmX3NsaWNlc19udW07CisJCXJldHVybiBEQlVGX1MxX0JJVDsKIAotCS8qCi0JICogRklY
TUU6IGZvciBub3cgd2UnbGwgb25seSBldmVyIHVzZSAxIHNsaWNlOyBwcmV0ZW5kIHRoYXQgd2Ug
aGF2ZQotCSAqIG9ubHkgdGhhdCAxIHNsaWNlIGVuYWJsZWQgdW50aWwgd2UgaGF2ZSBhIHByb3Bl
ciB3YXkgZm9yIG9uLWRlbWFuZAotCSAqIHRvZ2dsaW5nIG9mIHRoZSBzZWNvbmQgc2xpY2UuCi0J
ICovCi0JaWYgKDAgJiYgSTkxNV9SRUFEKERCVUZfQ1RMX1MyKSAmIERCVUZfUE9XRVJfU1RBVEUp
Ci0JCWVuYWJsZWRfZGJ1Zl9zbGljZXNfbnVtKys7CisJZm9yIChpID0gMDsgaSA8IG1heF9zbGlj
ZXM7IGkrKykgeworCQlpZiAoSTkxNV9SRUFEKERCVUZfQ1RMX1MoQklUKGkpKSkgJiBEQlVGX1BP
V0VSX1NUQVRFKQorCQkJZW5hYmxlZF9zbGljZXNfbWFzayB8PSBCSVQoaSk7CisJfQogCi0JcmV0
dXJuIGVuYWJsZWRfZGJ1Zl9zbGljZXNfbnVtOworCXJldHVybiBlbmFibGVkX3NsaWNlc19tYXNr
OwogfQogCiAvKgpAQCAtMzg0Myw4ICszODM5LDYgQEAgc3RhdGljIHUxNiBpbnRlbF9nZXRfZGRi
X3NpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogewogCXN0cnVjdCBkcm1f
YXRvbWljX3N0YXRlICpzdGF0ZSA9IGNydGNfc3RhdGUtPnVhcGkuc3RhdGU7CiAJc3RydWN0IGlu
dGVsX2F0b21pY19zdGF0ZSAqaW50ZWxfc3RhdGUgPSB0b19pbnRlbF9hdG9taWNfc3RhdGUoc3Rh
dGUpOwotCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlOwotCXU2
NCB0b3RhbF9kYXRhX2J3OwogCXUxNiBkZGJfc2l6ZSA9IElOVEVMX0lORk8oZGV2X3ByaXYpLT5k
ZGJfc2l6ZTsKIAogCVdBUk5fT04oZGRiX3NpemUgPT0gMCk7CkBAIC0zODUyLDIzICszODQ2LDgg
QEAgc3RhdGljIHUxNiBpbnRlbF9nZXRfZGRiX3NpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTEpCiAJCXJldHVybiBkZGJf
c2l6ZSAtIDQ7IC8qIDQgYmxvY2tzIGZvciBieXBhc3MgcGF0aCBhbGxvY2F0aW9uICovCiAKLQlh
ZGp1c3RlZF9tb2RlID0gJmNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7Ci0JdG90YWxfZGF0
YV9idyA9IHRvdGFsX2RhdGFfcmF0ZSAqIGRybV9tb2RlX3ZyZWZyZXNoKGFkanVzdGVkX21vZGUp
OwotCi0JLyoKLQkgKiAxMkdCL3MgaXMgbWF4aW11bSBCVyBzdXBwb3J0ZWQgYnkgc2luZ2xlIERC
dWYgc2xpY2UuCi0JICoKLQkgKiBGSVhNRSBkYnVmIHNsaWNlIGNvZGUgaXMgYnJva2VuOgotCSAq
IC0gbXVzdCB3YWl0IGZvciBwbGFuZXMgdG8gc3RvcCB1c2luZyB0aGUgc2xpY2UgYmVmb3JlIHBv
d2VyaW5nIGl0IG9mZgotCSAqIC0gcGxhbmUgc3RyYWRkbGluZyBib3RoIHNsaWNlcyBpcyBpbGxl
Z2FsIGluIG11bHRpLXBpcGUgc2NlbmFyaW9zCi0JICogLSBzaG91bGQgdmFsaWRhdGUgd2Ugc3Rh
eSB3aXRoaW4gdGhlIGh3IGJhbmR3aWR0aCBsaW1pdHMKLQkgKi8KLQlpZiAoMCAmJiAobnVtX2Fj
dGl2ZSA+IDEgfHwgdG90YWxfZGF0YV9idyA+PSBHQnBzKDEyKSkpIHsKLQkJaW50ZWxfc3RhdGUt
PmVuYWJsZWRfZGJ1Zl9zbGljZXNfbnVtID0gMjsKLQl9IGVsc2UgewotCQlpbnRlbF9zdGF0ZS0+
ZW5hYmxlZF9kYnVmX3NsaWNlc19udW0gPSAxOwotCQlkZGJfc2l6ZSAvPSAyOwotCX0KKwlpbnRl
bF9zdGF0ZS0+ZW5hYmxlZF9kYnVmX3NsaWNlc19tYXNrID0gREJVRl9TMV9CSVQ7CisJZGRiX3Np
emUgLz0gMjsKIAogCXJldHVybiBkZGJfc2l6ZTsKIH0KQEAgLTQwNjUsOCArNDA0NCw4IEBAIHZv
aWQgc2tsX3BpcGVfZGRiX2dldF9od19zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAog
dm9pZCBza2xfZGRiX2dldF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCiB7Ci0JZGV2X3ByaXYtPmVuYWJsZWRfZGJ1Zl9zbGljZXNfbnVtID0KLQkJCQlpbnRlbF9l
bmFibGVkX2RidWZfc2xpY2VzX251bShkZXZfcHJpdik7CisJZGV2X3ByaXYtPmVuYWJsZWRfZGJ1
Zl9zbGljZXNfbWFzayA9CisJCQkJaW50ZWxfZW5hYmxlZF9kYnVmX3NsaWNlc19tYXNrKGRldl9w
cml2KTsKIH0KIAogLyoKQEAgLTUyMDUsNyArNTE4NCw3IEBAIHNrbF9jb21wdXRlX2RkYihzdHJ1
Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsK
IAlpbnQgcmV0LCBpOwogCi0Jc3RhdGUtPmVuYWJsZWRfZGJ1Zl9zbGljZXNfbnVtID0gZGV2X3By
aXYtPmVuYWJsZWRfZGJ1Zl9zbGljZXNfbnVtOworCXN0YXRlLT5lbmFibGVkX2RidWZfc2xpY2Vz
X21hc2sgPSBkZXZfcHJpdi0+ZW5hYmxlZF9kYnVmX3NsaWNlc19tYXNrOwogCiAJZm9yX2VhY2hf
b2xkbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsIG9sZF9jcnRjX3N0YXRlLAog
CQkJCQkgICAgbmV3X2NydGNfc3RhdGUsIGkpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX3BtLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5oCmluZGV4
IDIyZmQyZGFmNjA4ZS4uZDYwYTg1NDIxYzVhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9wbS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmgKQEAg
LTMyLDcgKzMyLDcgQEAgdm9pZCBnNHhfd21fZ2V0X2h3X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdik7CiB2b2lkIHZsdl93bV9nZXRfaHdfc3RhdGUoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIHZvaWQgaWxrX3dtX2dldF9od19zdGF0ZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogdm9pZCBza2xfd21fZ2V0X2h3X3N0YXRlKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci11OCBpbnRlbF9lbmFibGVkX2RidWZf
c2xpY2VzX251bShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwordTggaW50ZWxf
ZW5hYmxlZF9kYnVmX3NsaWNlc19tYXNrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dik7CiB2b2lkIHNrbF9waXBlX2RkYl9nZXRfaHdfc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNy
dGMsCiAJCQkgICAgICAgc3RydWN0IHNrbF9kZGJfZW50cnkgKmRkYl95LAogCQkJICAgICAgIHN0
cnVjdCBza2xfZGRiX2VudHJ5ICpkZGJfdXYpOwotLSAKMi4yNC4xLjQ4NS5nYWQwNWEzZDhlNQoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4
IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

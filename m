Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 32C9A68534
	for <lists+intel-gfx@lfdr.de>; Mon, 15 Jul 2019 10:29:32 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9DC2D893EF;
	Mon, 15 Jul 2019 08:29:30 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C1FD9893AB
 for <intel-gfx@lists.freedesktop.org>; Mon, 15 Jul 2019 08:29:25 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17303244-1500050 
 for multiple; Mon, 15 Jul 2019 09:09:52 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 15 Jul 2019 09:09:29 +0100
Message-Id: <20190715080946.15593-7-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190715080946.15593-1-chris@chris-wilson.co.uk>
References: <20190715080946.15593-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 07/24] drm/i915: Rely on spinlock protection for
 GPU error capture
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VHJ1c3QgdGhhdCB3ZSBub3cgaGF2ZSBhZGVxdWF0ZSBwcm90ZWN0aW9uIG92ZXIgdGhlIGxvdyBs
ZXZlbCBzdHJ1Y3R1cmVzCnZpYSB0aGUgZW5naW5lLT5hY3RpdmUubG9jayB0byBhbGxvdyBvdXJz
ZWx2ZXMgdG8gY2FwdHVyZSB0aGUgR1BVIGVycm9yCnN0YXRlIHdpdGhvdXQgdGhlIGhlYXZ5IGhh
bW1lciBvZiBzdG9wX21hY2hpbmUoKS4gU2FkbHkgdGhpcyBkb2VzIG1lYW4KdGhhdCB3ZSBoYXZl
IHRvIGZvcmdvIHNvbWUgb2YgdGhlIGxlc3NlciB1c2VkIGluZm9ybWF0aW9uIChub3QgZGVyaXZl
ZApmcm9tIHRoZSBhY3RpdmUgc3RhdGUpIHRoYXQgaXMgbm90IGNvbnRyb2xsZWQgYnkgdGhlIGFj
dGl2ZSBsb2Nrcy4KCkEgdXNlZnVsIHNpZGUtZWZmZWN0IGlzIHRoYXQgdGhpcyBhbGxvd3MgdXMg
dG8gcmVzdG9yZSBlcnJvciBjYXB0dXJpbmcKZm9yIEJyYXN3ZWxsIGFuZCBCcm94dG9uLgoKU2ln
bmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0tLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMgICB8ICAgNSAtCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5jIHwgNTAzICsrKysrKysrKysrLS0tLS0tLS0tLS0t
LS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5oIHwgIDE3IC0KIDMgZmls
ZXMgY2hhbmdlZCwgMjA3IGluc2VydGlvbnMoKyksIDMxOCBkZWxldGlvbnMoLSkKCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtX2d0dC5jCmluZGV4IDIyMGFiYTVhOTRkMi4uNWM5YzdjYWU0ODE3IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwpAQCAtMjk2NiwxMSArMjk2Niw2IEBAIHN0
YXRpYyBpbnQgZ2VuOF9nbWNoX3Byb2JlKHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiAJCWdndHQt
PnZtLmluc2VydF9wYWdlICAgID0gYnh0X3Z0ZF9nZ3R0X2luc2VydF9wYWdlX19CS0w7CiAJCWlm
IChnZ3R0LT52bS5jbGVhcl9yYW5nZSAhPSBub3BfY2xlYXJfcmFuZ2UpCiAJCQlnZ3R0LT52bS5j
bGVhcl9yYW5nZSA9IGJ4dF92dGRfZ2d0dF9jbGVhcl9yYW5nZV9fQktMOwotCi0JCS8qIFByZXZl
bnQgcmVjdXJzaXZlbHkgY2FsbGluZyBzdG9wX21hY2hpbmUoKSBhbmQgZGVhZGxvY2tzLiAqLwot
CQlkZXZfaW5mbyhkZXZfcHJpdi0+ZHJtLmRldiwKLQkJCSAiRGlzYWJsaW5nIGVycm9yIGNhcHR1
cmUgZm9yIFZULWQgd29ya2Fyb3VuZFxuIik7Ci0JCWk5MTVfZGlzYWJsZV9lcnJvcl9zdGF0ZShk
ZXZfcHJpdiwgLUVOT0RFVik7CiAJfQogCiAJZ2d0dC0+aW52YWxpZGF0ZSA9IGdlbjZfZ2d0dF9p
bnZhbGlkYXRlOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJy
b3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMKaW5kZXggYzViODli
ZjRkNjE2Li4wMjZlZTFmNTUzNmQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ3B1X2Vycm9yLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3Iu
YwpAQCAtMzAsNyArMzAsNiBAQAogI2luY2x1ZGUgPGxpbnV4L2FzY2lpODUuaD4KICNpbmNsdWRl
IDxsaW51eC9ubWkuaD4KICNpbmNsdWRlIDxsaW51eC9zY2F0dGVybGlzdC5oPgotI2luY2x1ZGUg
PGxpbnV4L3N0b3BfbWFjaGluZS5oPgogI2luY2x1ZGUgPGxpbnV4L3V0c25hbWUuaD4KICNpbmNs
dWRlIDxsaW51eC96bGliLmg+CiAKQEAgLTQ2LDYgKzQ1LDkgQEAKICNpbmNsdWRlICJpOTE1X3Nj
YXR0ZXJsaXN0LmgiCiAjaW5jbHVkZSAiaW50ZWxfY3NyLmgiCiAKKyNkZWZpbmUgQUxMT1dfRkFJ
TCAoR0ZQX0tFUk5FTCB8IF9fR0ZQX1JFVFJZX01BWUZBSUwgfCBfX0dGUF9OT1dBUk4pCisjZGVm
aW5lIEFUT01JQ19NQVlGQUlMIChHRlBfQVRPTUlDIHwgX19HRlBfTk9XQVJOKQorCiBzdGF0aWMg
aW5saW5lIGNvbnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKgogZW5naW5lX2xvb2t1cChjb25z
dCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdW5zaWduZWQgaW50IGlkKQogewpAQCAt
NjcsMjYgKzY5LDYgQEAgZW5naW5lX25hbWUoY29uc3Qgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsIHVuc2lnbmVkIGludCBpZCkKIAlyZXR1cm4gX19lbmdpbmVfbmFtZShlbmdpbmVfbG9v
a3VwKGk5MTUsIGlkKSk7CiB9CiAKLXN0YXRpYyBjb25zdCBjaGFyICp0aWxpbmdfZmxhZyhpbnQg
dGlsaW5nKQotewotCXN3aXRjaCAodGlsaW5nKSB7Ci0JZGVmYXVsdDoKLQljYXNlIEk5MTVfVElM
SU5HX05PTkU6IHJldHVybiAiIjsKLQljYXNlIEk5MTVfVElMSU5HX1g6IHJldHVybiAiIFgiOwot
CWNhc2UgSTkxNV9USUxJTkdfWTogcmV0dXJuICIgWSI7Ci0JfQotfQotCi1zdGF0aWMgY29uc3Qg
Y2hhciAqZGlydHlfZmxhZyhpbnQgZGlydHkpCi17Ci0JcmV0dXJuIGRpcnR5ID8gIiBkaXJ0eSIg
OiAiIjsKLX0KLQotc3RhdGljIGNvbnN0IGNoYXIgKnB1cmdlYWJsZV9mbGFnKGludCBwdXJnZWFi
bGUpCi17Ci0JcmV0dXJuIHB1cmdlYWJsZSA/ICIgcHVyZ2VhYmxlIiA6ICIiOwotfQotCiBzdGF0
aWMgdm9pZCBfX3NnX3NldF9idWYoc3RydWN0IHNjYXR0ZXJsaXN0ICpzZywKIAkJCSB2b2lkICph
ZGRyLCB1bnNpZ25lZCBpbnQgbGVuLCBsb2ZmX3QgaXQpCiB7CkBAIC0xMTQsNyArOTYsNyBAQCBz
dGF0aWMgYm9vbCBfX2k5MTVfZXJyb3JfZ3JvdyhzdHJ1Y3QgZHJtX2k5MTVfZXJyb3Jfc3RhdGVf
YnVmICplLCBzaXplX3QgbGVuKQogCWlmIChlLT5jdXIgPT0gZS0+ZW5kKSB7CiAJCXN0cnVjdCBz
Y2F0dGVybGlzdCAqc2dsOwogCi0JCXNnbCA9ICh0eXBlb2Yoc2dsKSlfX2dldF9mcmVlX3BhZ2Uo
R0ZQX0tFUk5FTCk7CisJCXNnbCA9ICh0eXBlb2Yoc2dsKSlfX2dldF9mcmVlX3BhZ2UoQUxMT1df
RkFJTCk7CiAJCWlmICghc2dsKSB7CiAJCQllLT5lcnIgPSAtRU5PTUVNOwogCQkJcmV0dXJuIGZh
bHNlOwpAQCAtMTM0LDcgKzExNiw3IEBAIHN0YXRpYyBib29sIF9faTkxNV9lcnJvcl9ncm93KHN0
cnVjdCBkcm1faTkxNV9lcnJvcl9zdGF0ZV9idWYgKmUsIHNpemVfdCBsZW4pCiAJfQogCiAJZS0+
c2l6ZSA9IEFMSUdOKGxlbiArIDEsIFNaXzY0Syk7Ci0JZS0+YnVmID0ga21hbGxvYyhlLT5zaXpl
LCBHRlBfS0VSTkVMIHwgX19HRlBfTk9XQVJOIHwgX19HRlBfTk9SRVRSWSk7CisJZS0+YnVmID0g
a21hbGxvYyhlLT5zaXplLCBBTExPV19GQUlMKTsKIAlpZiAoIWUtPmJ1ZikgewogCQllLT5zaXpl
ID0gUEFHRV9BTElHTihsZW4gKyAxKTsKIAkJZS0+YnVmID0ga21hbGxvYyhlLT5zaXplLCBHRlBf
S0VSTkVMKTsKQEAgLTIxMSw0NyArMTkzLDEyNyBAQCBpOTE1X2Vycm9yX3ByaW50ZXIoc3RydWN0
IGRybV9pOTE1X2Vycm9yX3N0YXRlX2J1ZiAqZSkKIAlyZXR1cm4gcDsKIH0KIAorLyogc2luZ2xl
IHRocmVhZGVkIHBhZ2UgYWxsb2NhdG9yIHdpdGggYSByZXNlcnZlZCBzdGFzaCBmb3IgZW1lcmdl
bmNpZXMgKi8KK3N0cnVjdCBwb29sIHsKKwl2b2lkICpzdGFzaFszMV07CisJdW5zaWduZWQgaW50
IGNvdW50OworfTsKKworc3RhdGljIHZvaWQgKl9fYWxsb2NfcGFnZShnZnBfdCBnZnApCit7CisJ
cmV0dXJuICh2b2lkICopX19nZXRfZnJlZV9wYWdlKGdmcCk7Cit9CisKK3N0YXRpYyB2b2lkIHBv
b2xfZmluaShzdHJ1Y3QgcG9vbCAqcCkKK3sKKwl3aGlsZSAocC0+Y291bnQtLSkKKwkJZnJlZV9w
YWdlKCh1bnNpZ25lZCBsb25nKXAtPnN0YXNoW3AtPmNvdW50XSk7Cit9CisKK3N0YXRpYyBpbnQg
cG9vbF9yZWZpbGwoc3RydWN0IHBvb2wgKnAsIGdmcF90IGdmcCkKK3sKKwl3aGlsZSAocC0+Y291
bnQgPCBBUlJBWV9TSVpFKHAtPnN0YXNoKSkgeworCQlwLT5zdGFzaFtwLT5jb3VudF0gPSBfX2Fs
bG9jX3BhZ2UoZ2ZwKTsKKwkJaWYgKCFwLT5zdGFzaFtwLT5jb3VudF0pCisJCQlyZXR1cm4gLUVO
T01FTTsKKworCQlwLT5jb3VudCsrOworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50
IHBvb2xfaW5pdChzdHJ1Y3QgcG9vbCAqcCwgZ2ZwX3QgZ2ZwKQoreworCWludCBlcnI7CisKKwlw
LT5jb3VudCA9IDA7CisKKwllcnIgPSBwb29sX3JlZmlsbChwLCBnZnApOworCWlmIChlcnIpCisJ
CXBvb2xfZmluaShwKTsKKworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyB2b2lkICpwb29sX2Fs
bG9jKHN0cnVjdCBwb29sICpwLCBnZnBfdCBnZnApCit7CisJdm9pZCAqcHRyOworCisJcHRyID0g
X19hbGxvY19wYWdlKGdmcCk7CisJaWYgKHB0cikKKwkJcmV0dXJuIHB0cjsKKworCWlmIChwLT5j
b3VudCkKKwkJcmV0dXJuIHAtPnN0YXNoWy0tcC0+Y291bnRdOworCisJcmV0dXJuIE5VTEw7Cit9
CisKK3N0YXRpYyB2b2lkIHBvb2xfZnJlZShzdHJ1Y3QgcG9vbCAqcCwgdm9pZCAqcGFnZSkKK3sK
KwlpZiAocC0+Y291bnQgPCBBUlJBWV9TSVpFKHAtPnN0YXNoKSkgeworCQlwLT5zdGFzaFtwLT5j
b3VudCsrXSA9IHBhZ2U7CisJCXJldHVybjsKKwl9CisKKwlmcmVlX3BhZ2UoKHVuc2lnbmVkIGxv
bmcpcGFnZSk7Cit9CisKICNpZmRlZiBDT05GSUdfRFJNX0k5MTVfQ09NUFJFU1NfRVJST1IKIAog
c3RydWN0IGNvbXByZXNzIHsKKwlzdHJ1Y3QgcG9vbCBwb29sOwogCXN0cnVjdCB6X3N0cmVhbV9z
IHpzdHJlYW07CiAJdm9pZCAqdG1wOwogfTsKIAogc3RhdGljIGJvb2wgY29tcHJlc3NfaW5pdChz
dHJ1Y3QgY29tcHJlc3MgKmMpCiB7Ci0Jc3RydWN0IHpfc3RyZWFtX3MgKnpzdHJlYW0gPSBtZW1z
ZXQoJmMtPnpzdHJlYW0sIDAsIHNpemVvZihjLT56c3RyZWFtKSk7CisJc3RydWN0IHpfc3RyZWFt
X3MgKnpzdHJlYW0gPSAmYy0+enN0cmVhbTsKIAotCXpzdHJlYW0tPndvcmtzcGFjZSA9Ci0JCWtt
YWxsb2MoemxpYl9kZWZsYXRlX3dvcmtzcGFjZXNpemUoTUFYX1dCSVRTLCBNQVhfTUVNX0xFVkVM
KSwKLQkJCUdGUF9BVE9NSUMgfCBfX0dGUF9OT1dBUk4pOwotCWlmICghenN0cmVhbS0+d29ya3Nw
YWNlKQorCWlmIChwb29sX2luaXQoJmMtPnBvb2wsIEFMTE9XX0ZBSUwpKQogCQlyZXR1cm4gZmFs
c2U7CiAKLQlpZiAoemxpYl9kZWZsYXRlSW5pdCh6c3RyZWFtLCBaX0RFRkFVTFRfQ09NUFJFU1NJ
T04pICE9IFpfT0spIHsKLQkJa2ZyZWUoenN0cmVhbS0+d29ya3NwYWNlKTsKKwl6c3RyZWFtLT53
b3Jrc3BhY2UgPQorCQlrbWFsbG9jKHpsaWJfZGVmbGF0ZV93b3Jrc3BhY2VzaXplKE1BWF9XQklU
UywgTUFYX01FTV9MRVZFTCksCisJCQlBTExPV19GQUlMKTsKKwlpZiAoIXpzdHJlYW0tPndvcmtz
cGFjZSkgeworCQlwb29sX2ZpbmkoJmMtPnBvb2wpOwogCQlyZXR1cm4gZmFsc2U7CiAJfQogCiAJ
Yy0+dG1wID0gTlVMTDsKIAlpZiAoaTkxNV9oYXNfbWVtY3B5X2Zyb21fd2MoKSkKLQkJYy0+dG1w
ID0gKHZvaWQgKilfX2dldF9mcmVlX3BhZ2UoR0ZQX0FUT01JQyB8IF9fR0ZQX05PV0FSTik7CisJ
CWMtPnRtcCA9IHBvb2xfYWxsb2MoJmMtPnBvb2wsIEFMTE9XX0ZBSUwpOwogCiAJcmV0dXJuIHRy
dWU7CiB9CiAKLXN0YXRpYyB2b2lkICpjb21wcmVzc19uZXh0X3BhZ2Uoc3RydWN0IGRybV9pOTE1
X2Vycm9yX29iamVjdCAqZHN0KQorc3RhdGljIGJvb2wgY29tcHJlc3Nfc3RhcnQoc3RydWN0IGNv
bXByZXNzICpjKQoreworCXN0cnVjdCB6X3N0cmVhbV9zICp6c3RyZWFtID0gJmMtPnpzdHJlYW07
CisJdm9pZCAqd29ya3NwYWNlID0genN0cmVhbS0+d29ya3NwYWNlOworCisJbWVtc2V0KHpzdHJl
YW0sIDAsIHNpemVvZigqenN0cmVhbSkpOworCXpzdHJlYW0tPndvcmtzcGFjZSA9IHdvcmtzcGFj
ZTsKKworCXJldHVybiB6bGliX2RlZmxhdGVJbml0KHpzdHJlYW0sIFpfREVGQVVMVF9DT01QUkVT
U0lPTikgPT0gWl9PSzsKK30KKworc3RhdGljIHZvaWQgKmNvbXByZXNzX25leHRfcGFnZShzdHJ1
Y3QgY29tcHJlc3MgKmMsCisJCQkJc3RydWN0IGRybV9pOTE1X2Vycm9yX29iamVjdCAqZHN0KQog
ewotCXVuc2lnbmVkIGxvbmcgcGFnZTsKKwl2b2lkICpwYWdlOwogCiAJaWYgKGRzdC0+cGFnZV9j
b3VudCA+PSBkc3QtPm51bV9wYWdlcykKIAkJcmV0dXJuIEVSUl9QVFIoLUVOT1NQQyk7CiAKLQlw
YWdlID0gX19nZXRfZnJlZV9wYWdlKEdGUF9BVE9NSUMgfCBfX0dGUF9OT1dBUk4pOworCXBhZ2Ug
PSBwb29sX2FsbG9jKCZjLT5wb29sLCBBVE9NSUNfTUFZRkFJTCk7CiAJaWYgKCFwYWdlKQogCQly
ZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKIAotCXJldHVybiBkc3QtPnBhZ2VzW2RzdC0+cGFnZV9j
b3VudCsrXSA9ICh2b2lkICopcGFnZTsKKwlyZXR1cm4gZHN0LT5wYWdlc1tkc3QtPnBhZ2VfY291
bnQrK10gPSBwYWdlOwogfQogCiBzdGF0aWMgaW50IGNvbXByZXNzX3BhZ2Uoc3RydWN0IGNvbXBy
ZXNzICpjLApAQCAtMjY3LDcgKzMyOSw3IEBAIHN0YXRpYyBpbnQgY29tcHJlc3NfcGFnZShzdHJ1
Y3QgY29tcHJlc3MgKmMsCiAKIAlkbyB7CiAJCWlmICh6c3RyZWFtLT5hdmFpbF9vdXQgPT0gMCkg
ewotCQkJenN0cmVhbS0+bmV4dF9vdXQgPSBjb21wcmVzc19uZXh0X3BhZ2UoZHN0KTsKKwkJCXpz
dHJlYW0tPm5leHRfb3V0ID0gY29tcHJlc3NfbmV4dF9wYWdlKGMsIGRzdCk7CiAJCQlpZiAoSVNf
RVJSKHpzdHJlYW0tPm5leHRfb3V0KSkKIAkJCQlyZXR1cm4gUFRSX0VSUih6c3RyZWFtLT5uZXh0
X291dCk7CiAKQEAgLTI5NSw3ICszNTcsNyBAQCBzdGF0aWMgaW50IGNvbXByZXNzX2ZsdXNoKHN0
cnVjdCBjb21wcmVzcyAqYywKIAlkbyB7CiAJCXN3aXRjaCAoemxpYl9kZWZsYXRlKHpzdHJlYW0s
IFpfRklOSVNIKSkgewogCQljYXNlIFpfT0s6IC8qIG1vcmUgc3BhY2UgcmVxdWVzdGVkICovCi0J
CQl6c3RyZWFtLT5uZXh0X291dCA9IGNvbXByZXNzX25leHRfcGFnZShkc3QpOworCQkJenN0cmVh
bS0+bmV4dF9vdXQgPSBjb21wcmVzc19uZXh0X3BhZ2UoYywgZHN0KTsKIAkJCWlmIChJU19FUlIo
enN0cmVhbS0+bmV4dF9vdXQpKQogCQkJCXJldHVybiBQVFJfRVJSKHpzdHJlYW0tPm5leHRfb3V0
KTsKIApAQCAtMzE2LDE1ICszNzgsMTcgQEAgc3RhdGljIGludCBjb21wcmVzc19mbHVzaChzdHJ1
Y3QgY29tcHJlc3MgKmMsCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyB2b2lkIGNvbXByZXNzX2Zp
bmkoc3RydWN0IGNvbXByZXNzICpjLAotCQkJICBzdHJ1Y3QgZHJtX2k5MTVfZXJyb3Jfb2JqZWN0
ICpkc3QpCitzdGF0aWMgdm9pZCBjb21wcmVzc19maW5pc2goc3RydWN0IGNvbXByZXNzICpjKQog
ewotCXN0cnVjdCB6X3N0cmVhbV9zICp6c3RyZWFtID0gJmMtPnpzdHJlYW07CisJemxpYl9kZWZs
YXRlRW5kKCZjLT56c3RyZWFtKTsKK30KIAotCXpsaWJfZGVmbGF0ZUVuZCh6c3RyZWFtKTsKLQlr
ZnJlZSh6c3RyZWFtLT53b3Jrc3BhY2UpOworc3RhdGljIHZvaWQgY29tcHJlc3NfZmluaShzdHJ1
Y3QgY29tcHJlc3MgKmMpCit7CisJa2ZyZWUoYy0+enN0cmVhbS53b3Jrc3BhY2UpOwogCWlmIChj
LT50bXApCi0JCWZyZWVfcGFnZSgodW5zaWduZWQgbG9uZyljLT50bXApOworCQlwb29sX2ZyZWUo
JmMtPnBvb2wsIGMtPnRtcCk7CisJcG9vbF9maW5pKCZjLT5wb29sKTsKIH0KIAogc3RhdGljIHZv
aWQgZXJyX2NvbXByZXNzaW9uX21hcmtlcihzdHJ1Y3QgZHJtX2k5MTVfZXJyb3Jfc3RhdGVfYnVm
ICptKQpAQCAtMzM1LDkgKzM5OSwxOCBAQCBzdGF0aWMgdm9pZCBlcnJfY29tcHJlc3Npb25fbWFy
a2VyKHN0cnVjdCBkcm1faTkxNV9lcnJvcl9zdGF0ZV9idWYgKm0pCiAjZWxzZQogCiBzdHJ1Y3Qg
Y29tcHJlc3MgeworCXN0cnVjdCBwb29sIHBvb2w7CiB9OwogCiBzdGF0aWMgYm9vbCBjb21wcmVz
c19pbml0KHN0cnVjdCBjb21wcmVzcyAqYykKK3sKKwlpZiAocG9vbF9pbml0KCZjLT5wb29sLCBB
TExPV19GQUlMKSkKKwkJcmV0dXJuIGZhbHNlOworCisJcmV0dXJuIHRydWU7Cit9CisKK3N0YXRp
YyBib29sIGNvbXByZXNzX3N0YXJ0KHN0cnVjdCBjb21wcmVzcyAqYykKIHsKIAlyZXR1cm4gdHJ1
ZTsKIH0KQEAgLTM0NiwxNCArNDE5LDEyIEBAIHN0YXRpYyBpbnQgY29tcHJlc3NfcGFnZShzdHJ1
Y3QgY29tcHJlc3MgKmMsCiAJCQkgdm9pZCAqc3JjLAogCQkJIHN0cnVjdCBkcm1faTkxNV9lcnJv
cl9vYmplY3QgKmRzdCkKIHsKLQl1bnNpZ25lZCBsb25nIHBhZ2U7CiAJdm9pZCAqcHRyOwogCi0J
cGFnZSA9IF9fZ2V0X2ZyZWVfcGFnZShHRlBfQVRPTUlDIHwgX19HRlBfTk9XQVJOKTsKLQlpZiAo
IXBhZ2UpCisJcHRyID0gcG9vbF9hbGxvYygmYy0+cG9vbCwgQVRPTUlDX01BWUZBSUwpOworCWlm
ICghcHRyKQogCQlyZXR1cm4gLUVOT01FTTsKIAotCXB0ciA9ICh2b2lkICopcGFnZTsKIAlpZiAo
IWk5MTVfbWVtY3B5X2Zyb21fd2MocHRyLCBzcmMsIFBBR0VfU0laRSkpCiAJCW1lbWNweShwdHIs
IHNyYywgUEFHRV9TSVpFKTsKIAlkc3QtPnBhZ2VzW2RzdC0+cGFnZV9jb3VudCsrXSA9IHB0cjsK
QEAgLTM2NywxMSArNDM4LDE1IEBAIHN0YXRpYyBpbnQgY29tcHJlc3NfZmx1c2goc3RydWN0IGNv
bXByZXNzICpjLAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgdm9pZCBjb21wcmVzc19maW5pKHN0
cnVjdCBjb21wcmVzcyAqYywKLQkJCSAgc3RydWN0IGRybV9pOTE1X2Vycm9yX29iamVjdCAqZHN0
KQorc3RhdGljIHZvaWQgY29tcHJlc3NfZmluaXNoKHN0cnVjdCBjb21wcmVzcyAqYykKIHsKIH0K
IAorc3RhdGljIHZvaWQgY29tcHJlc3NfZmluaShzdHJ1Y3QgY29tcHJlc3MgKmMpCit7CisJcG9v
bF9maW5pKCZjLT5wb29sKTsKK30KKwogc3RhdGljIHZvaWQgZXJyX2NvbXByZXNzaW9uX21hcmtl
cihzdHJ1Y3QgZHJtX2k5MTVfZXJyb3Jfc3RhdGVfYnVmICptKQogewogCWVycl9wdXRzKG0sICJ+
Iik7CkBAIC0zNzksMzYgKzQ1NCw2IEBAIHN0YXRpYyB2b2lkIGVycl9jb21wcmVzc2lvbl9tYXJr
ZXIoc3RydWN0IGRybV9pOTE1X2Vycm9yX3N0YXRlX2J1ZiAqbSkKIAogI2VuZGlmCiAKLXN0YXRp
YyB2b2lkIHByaW50X2Vycm9yX2J1ZmZlcnMoc3RydWN0IGRybV9pOTE1X2Vycm9yX3N0YXRlX2J1
ZiAqbSwKLQkJCQljb25zdCBjaGFyICpuYW1lLAotCQkJCXN0cnVjdCBkcm1faTkxNV9lcnJvcl9i
dWZmZXIgKmVyciwKLQkJCQlpbnQgY291bnQpCi17Ci0JZXJyX3ByaW50ZihtLCAiJXMgWyVkXTpc
biIsIG5hbWUsIGNvdW50KTsKLQotCXdoaWxlIChjb3VudC0tKSB7Ci0JCWVycl9wcmludGYobSwg
IiAgICAlMDh4XyUwOHggJTh1ICUwMnggJTAyeCIsCi0JCQkgICB1cHBlcl8zMl9iaXRzKGVyci0+
Z3R0X29mZnNldCksCi0JCQkgICBsb3dlcl8zMl9iaXRzKGVyci0+Z3R0X29mZnNldCksCi0JCQkg
ICBlcnItPnNpemUsCi0JCQkgICBlcnItPnJlYWRfZG9tYWlucywKLQkJCSAgIGVyci0+d3JpdGVf
ZG9tYWluKTsKLQkJZXJyX3B1dHMobSwgdGlsaW5nX2ZsYWcoZXJyLT50aWxpbmcpKTsKLQkJZXJy
X3B1dHMobSwgZGlydHlfZmxhZyhlcnItPmRpcnR5KSk7Ci0JCWVycl9wdXRzKG0sIHB1cmdlYWJs
ZV9mbGFnKGVyci0+cHVyZ2VhYmxlKSk7Ci0JCWVycl9wdXRzKG0sIGVyci0+dXNlcnB0ciA/ICIg
dXNlcnB0ciIgOiAiIik7Ci0JCWVycl9wdXRzKG0sIGk5MTVfY2FjaGVfbGV2ZWxfc3RyKG0tPmk5
MTUsIGVyci0+Y2FjaGVfbGV2ZWwpKTsKLQotCQlpZiAoZXJyLT5uYW1lKQotCQkJZXJyX3ByaW50
ZihtLCAiIChuYW1lOiAlZCkiLCBlcnItPm5hbWUpOwotCQlpZiAoZXJyLT5mZW5jZV9yZWcgIT0g
STkxNV9GRU5DRV9SRUdfTk9ORSkKLQkJCWVycl9wcmludGYobSwgIiAoZmVuY2U6ICVkKSIsIGVy
ci0+ZmVuY2VfcmVnKTsKLQotCQllcnJfcHV0cyhtLCAiXG4iKTsKLQkJZXJyKys7Ci0JfQotfQot
CiBzdGF0aWMgdm9pZCBlcnJvcl9wcmludF9pbnN0ZG9uZShzdHJ1Y3QgZHJtX2k5MTVfZXJyb3Jf
c3RhdGVfYnVmICptLAogCQkJCSBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZXJyb3JfZW5naW5lICpl
ZSkKIHsKQEAgLTczNCwzMyArNzc5LDYgQEAgc3RhdGljIHZvaWQgX19lcnJfcHJpbnRfdG9fc2ds
KHN0cnVjdCBkcm1faTkxNV9lcnJvcl9zdGF0ZV9idWYgKm0sCiAJCQllcnJvcl9wcmludF9lbmdp
bmUobSwgJmVycm9yLT5lbmdpbmVbaV0sIGVycm9yLT5lcG9jaCk7CiAJfQogCi0JZm9yIChpID0g
MDsgaSA8IEFSUkFZX1NJWkUoZXJyb3ItPmFjdGl2ZV92bSk7IGkrKykgewotCQljaGFyIGJ1Zlsx
MjhdOwotCQlpbnQgbGVuLCBmaXJzdCA9IDE7Ci0KLQkJaWYgKCFlcnJvci0+YWN0aXZlX3ZtW2ld
KQotCQkJYnJlYWs7Ci0KLQkJbGVuID0gc2NucHJpbnRmKGJ1Ziwgc2l6ZW9mKGJ1ZiksICJBY3Rp
dmUgKCIpOwotCQlmb3IgKGogPSAwOyBqIDwgQVJSQVlfU0laRShlcnJvci0+ZW5naW5lKTsgaisr
KSB7Ci0JCQlpZiAoZXJyb3ItPmVuZ2luZVtqXS52bSAhPSBlcnJvci0+YWN0aXZlX3ZtW2ldKQot
CQkJCWNvbnRpbnVlOwotCi0JCQlsZW4gKz0gc2NucHJpbnRmKGJ1ZiArIGxlbiwgc2l6ZW9mKGJ1
ZiksICIlcyVzIiwKLQkJCQkJIGZpcnN0ID8gIiIgOiAiLCAiLAotCQkJCQkgbS0+aTkxNS0+ZW5n
aW5lW2pdLT5uYW1lKTsKLQkJCWZpcnN0ID0gMDsKLQkJfQotCQlzY25wcmludGYoYnVmICsgbGVu
LCBzaXplb2YoYnVmKSwgIikiKTsKLQkJcHJpbnRfZXJyb3JfYnVmZmVycyhtLCBidWYsCi0JCQkJ
ICAgIGVycm9yLT5hY3RpdmVfYm9baV0sCi0JCQkJICAgIGVycm9yLT5hY3RpdmVfYm9fY291bnRb
aV0pOwotCX0KLQotCXByaW50X2Vycm9yX2J1ZmZlcnMobSwgIlBpbm5lZCAoZ2xvYmFsKSIsCi0J
CQkgICAgZXJyb3ItPnBpbm5lZF9ibywKLQkJCSAgICBlcnJvci0+cGlubmVkX2JvX2NvdW50KTsK
LQogCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGVycm9yLT5lbmdpbmUpOyBpKyspIHsKIAkJ
Y29uc3Qgc3RydWN0IGRybV9pOTE1X2Vycm9yX2VuZ2luZSAqZWUgPSAmZXJyb3ItPmVuZ2luZVtp
XTsKIApAQCAtOTc0LDEwICs5OTIsNiBAQCB2b2lkIF9faTkxNV9ncHVfc3RhdGVfZnJlZShzdHJ1
Y3Qga3JlZiAqZXJyb3JfcmVmKQogCQlrZnJlZShlZS0+cmVxdWVzdHMpOwogCX0KIAotCWZvciAo
aSA9IDA7IGkgPCBBUlJBWV9TSVpFKGVycm9yLT5hY3RpdmVfYm8pOyBpKyspCi0JCWtmcmVlKGVy
cm9yLT5hY3RpdmVfYm9baV0pOwotCWtmcmVlKGVycm9yLT5waW5uZWRfYm8pOwotCiAJa2ZyZWUo
ZXJyb3ItPm92ZXJsYXkpOwogCWtmcmVlKGVycm9yLT5kaXNwbGF5KTsKIApAQCAtOTkwLDEyICsx
MDA0LDEyIEBAIHZvaWQgX19pOTE1X2dwdV9zdGF0ZV9mcmVlKHN0cnVjdCBrcmVmICplcnJvcl9y
ZWYpCiAKIHN0YXRpYyBzdHJ1Y3QgZHJtX2k5MTVfZXJyb3Jfb2JqZWN0ICoKIGk5MTVfZXJyb3Jf
b2JqZWN0X2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKLQkJCSBzdHJ1Y3Qg
aTkxNV92bWEgKnZtYSkKKwkJCSBzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKKwkJCSBzdHJ1Y3QgY29t
cHJlc3MgKmNvbXByZXNzKQogewogCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSAmaTkxNS0+Z2d0
dDsKIAljb25zdCB1NjQgc2xvdCA9IGdndHQtPmVycm9yX2NhcHR1cmUuc3RhcnQ7CiAJc3RydWN0
IGRybV9pOTE1X2Vycm9yX29iamVjdCAqZHN0OwotCXN0cnVjdCBjb21wcmVzcyBjb21wcmVzczsK
IAl1bnNpZ25lZCBsb25nIG51bV9wYWdlczsKIAlzdHJ1Y3Qgc2d0X2l0ZXIgaXRlcjsKIAlkbWFf
YWRkcl90IGRtYTsKQEAgLTEwMDYsMjIgKzEwMjAsMjEgQEAgaTkxNV9lcnJvcl9vYmplY3RfY3Jl
YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCiAJbnVtX3BhZ2VzID0gbWluX3Qo
dTY0LCB2bWEtPnNpemUsIHZtYS0+b2JqLT5iYXNlLnNpemUpID4+IFBBR0VfU0hJRlQ7CiAJbnVt
X3BhZ2VzID0gRElWX1JPVU5EX1VQKDEwICogbnVtX3BhZ2VzLCA4KTsgLyogd29yc3RjYXNlIHps
aWIgZ3Jvd3RoICovCi0JZHN0ID0ga21hbGxvYyhzaXplb2YoKmRzdCkgKyBudW1fcGFnZXMgKiBz
aXplb2YodTMyICopLAotCQkgICAgICBHRlBfQVRPTUlDIHwgX19HRlBfTk9XQVJOKTsKKwlkc3Qg
PSBrbWFsbG9jKHNpemVvZigqZHN0KSArIG51bV9wYWdlcyAqIHNpemVvZih1MzIgKiksIEFUT01J
Q19NQVlGQUlMKTsKIAlpZiAoIWRzdCkKIAkJcmV0dXJuIE5VTEw7CiAKKwlpZiAoIWNvbXByZXNz
X3N0YXJ0KGNvbXByZXNzKSkgeworCQlrZnJlZShkc3QpOworCQlyZXR1cm4gTlVMTDsKKwl9CisK
IAlkc3QtPmd0dF9vZmZzZXQgPSB2bWEtPm5vZGUuc3RhcnQ7CiAJZHN0LT5ndHRfc2l6ZSA9IHZt
YS0+bm9kZS5zaXplOwogCWRzdC0+bnVtX3BhZ2VzID0gbnVtX3BhZ2VzOwogCWRzdC0+cGFnZV9j
b3VudCA9IDA7CiAJZHN0LT51bnVzZWQgPSAwOwogCi0JaWYgKCFjb21wcmVzc19pbml0KCZjb21w
cmVzcykpIHsKLQkJa2ZyZWUoZHN0KTsKLQkJcmV0dXJuIE5VTEw7Ci0JfQotCiAJcmV0ID0gLUVJ
TlZBTDsKIAlmb3JfZWFjaF9zZ3RfZG1hKGRtYSwgaXRlciwgdm1hLT5wYWdlcykgewogCQl2b2lk
IF9faW9tZW0gKnM7CkBAIC0xMDI5LDY5ICsxMDQyLDIzIEBAIGk5MTVfZXJyb3Jfb2JqZWN0X2Ny
ZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJZ2d0dC0+dm0uaW5zZXJ0X3Bh
Z2UoJmdndHQtPnZtLCBkbWEsIHNsb3QsIEk5MTVfQ0FDSEVfTk9ORSwgMCk7CiAKIAkJcyA9IGlv
X21hcHBpbmdfbWFwX2F0b21pY193YygmZ2d0dC0+aW9tYXAsIHNsb3QpOwotCQlyZXQgPSBjb21w
cmVzc19wYWdlKCZjb21wcmVzcywgKHZvaWQgIF9fZm9yY2UgKilzLCBkc3QpOworCQlyZXQgPSBj
b21wcmVzc19wYWdlKGNvbXByZXNzLCAodm9pZCAgX19mb3JjZSAqKXMsIGRzdCk7CiAJCWlvX21h
cHBpbmdfdW5tYXBfYXRvbWljKHMpOwogCQlpZiAocmV0KQogCQkJYnJlYWs7CiAJfQogCi0JaWYg
KHJldCB8fCBjb21wcmVzc19mbHVzaCgmY29tcHJlc3MsIGRzdCkpIHsKKwlpZiAocmV0IHx8IGNv
bXByZXNzX2ZsdXNoKGNvbXByZXNzLCBkc3QpKSB7CiAJCXdoaWxlIChkc3QtPnBhZ2VfY291bnQt
LSkKLQkJCWZyZWVfcGFnZSgodW5zaWduZWQgbG9uZylkc3QtPnBhZ2VzW2RzdC0+cGFnZV9jb3Vu
dF0pOworCQkJcG9vbF9mcmVlKCZjb21wcmVzcy0+cG9vbCwgZHN0LT5wYWdlc1tkc3QtPnBhZ2Vf
Y291bnRdKTsKIAkJa2ZyZWUoZHN0KTsKIAkJZHN0ID0gTlVMTDsKIAl9CisJY29tcHJlc3NfZmlu
aXNoKGNvbXByZXNzKTsKIAotCWNvbXByZXNzX2ZpbmkoJmNvbXByZXNzLCBkc3QpOwogCXJldHVy
biBkc3Q7CiB9CiAKLXN0YXRpYyB2b2lkIGNhcHR1cmVfYm8oc3RydWN0IGRybV9pOTE1X2Vycm9y
X2J1ZmZlciAqZXJyLAotCQkgICAgICAgc3RydWN0IGk5MTVfdm1hICp2bWEpCi17Ci0Jc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IHZtYS0+b2JqOwotCi0JZXJyLT5zaXplID0gb2Jq
LT5iYXNlLnNpemU7Ci0JZXJyLT5uYW1lID0gb2JqLT5iYXNlLm5hbWU7Ci0KLQllcnItPmd0dF9v
ZmZzZXQgPSB2bWEtPm5vZGUuc3RhcnQ7Ci0JZXJyLT5yZWFkX2RvbWFpbnMgPSBvYmotPnJlYWRf
ZG9tYWluczsKLQllcnItPndyaXRlX2RvbWFpbiA9IG9iai0+d3JpdGVfZG9tYWluOwotCWVyci0+
ZmVuY2VfcmVnID0gdm1hLT5mZW5jZSA/IHZtYS0+ZmVuY2UtPmlkIDogLTE7Ci0JZXJyLT50aWxp
bmcgPSBpOTE1X2dlbV9vYmplY3RfZ2V0X3RpbGluZyhvYmopOwotCWVyci0+ZGlydHkgPSBvYmot
Pm1tLmRpcnR5OwotCWVyci0+cHVyZ2VhYmxlID0gb2JqLT5tbS5tYWR2ICE9IEk5MTVfTUFEVl9X
SUxMTkVFRDsKLQllcnItPnVzZXJwdHIgPSBvYmotPnVzZXJwdHIubW0gIT0gTlVMTDsKLQllcnIt
PmNhY2hlX2xldmVsID0gb2JqLT5jYWNoZV9sZXZlbDsKLX0KLQotc3RhdGljIHUzMiBjYXB0dXJl
X2Vycm9yX2JvKHN0cnVjdCBkcm1faTkxNV9lcnJvcl9idWZmZXIgKmVyciwKLQkJCSAgICBpbnQg
Y291bnQsIHN0cnVjdCBsaXN0X2hlYWQgKmhlYWQsCi0JCQkgICAgdW5zaWduZWQgaW50IGZsYWdz
KQotI2RlZmluZSBBQ1RJVkVfT05MWSBCSVQoMCkKLSNkZWZpbmUgUElOTkVEX09OTFkgQklUKDEp
Ci17Ci0Jc3RydWN0IGk5MTVfdm1hICp2bWE7Ci0JaW50IGkgPSAwOwotCi0JbGlzdF9mb3JfZWFj
aF9lbnRyeSh2bWEsIGhlYWQsIHZtX2xpbmspIHsKLQkJaWYgKCF2bWEtPm9iaikKLQkJCWNvbnRp
bnVlOwotCi0JCWlmIChmbGFncyAmIEFDVElWRV9PTkxZICYmICFpOTE1X3ZtYV9pc19hY3RpdmUo
dm1hKSkKLQkJCWNvbnRpbnVlOwotCi0JCWlmIChmbGFncyAmIFBJTk5FRF9PTkxZICYmICFpOTE1
X3ZtYV9pc19waW5uZWQodm1hKSkKLQkJCWNvbnRpbnVlOwotCi0JCWNhcHR1cmVfYm8oZXJyKyss
IHZtYSk7Ci0JCWlmICgrK2kgPT0gY291bnQpCi0JCQlicmVhazsKLQl9Ci0KLQlyZXR1cm4gaTsK
LX0KLQogLyoKICAqIEdlbmVyYXRlIGEgc2VtaS11bmlxdWUgZXJyb3IgY29kZS4gVGhlIGNvZGUg
aXMgbm90IG1lYW50IHRvIGhhdmUgbWVhbmluZywgVGhlCiAgKiBjb2RlJ3Mgb25seSBwdXJwb3Nl
IGlzIHRvIHRyeSB0byBwcmV2ZW50IGZhbHNlIGR1cGxpY2F0ZWQgYnVnIHJlcG9ydHMgYnkKQEAg
LTEyODEsNyArMTI0OCw3IEBAIHN0YXRpYyB2b2lkIGVuZ2luZV9yZWNvcmRfcmVxdWVzdHMoc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCWlmICghY291bnQpCiAJCXJldHVybjsKIAot
CWVlLT5yZXF1ZXN0cyA9IGtjYWxsb2MoY291bnQsIHNpemVvZigqZWUtPnJlcXVlc3RzKSwgR0ZQ
X0FUT01JQyk7CisJZWUtPnJlcXVlc3RzID0ga2NhbGxvYyhjb3VudCwgc2l6ZW9mKCplZS0+cmVx
dWVzdHMpLCBBVE9NSUNfTUFZRkFJTCk7CiAJaWYgKCFlZS0+cmVxdWVzdHMpCiAJCXJldHVybjsK
IApAQCAtMTM0OSw4ICsxMzE2LDEwIEBAIHN0YXRpYyB2b2lkIHJlY29yZF9jb250ZXh0KHN0cnVj
dCBkcm1faTkxNV9lcnJvcl9jb250ZXh0ICplLAogCWUtPmFjdGl2ZSA9IGF0b21pY19yZWFkKCZj
dHgtPmFjdGl2ZV9jb3VudCk7CiB9CiAKLXN0YXRpYyB2b2lkIHJlcXVlc3RfcmVjb3JkX3VzZXJf
Ym8oc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdCwKLQkJCQkgICBzdHJ1Y3QgZHJtX2k5MTVf
ZXJyb3JfZW5naW5lICplZSkKK3N0YXRpYyB2b2lkCityZXF1ZXN0X3JlY29yZF91c2VyX2JvKHN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QsCisJCSAgICAgICBzdHJ1Y3QgZHJtX2k5MTVfZXJy
b3JfZW5naW5lICplZSwKKwkJICAgICAgIHN0cnVjdCBjb21wcmVzcyAqY29tcHJlc3MpCiB7CiAJ
c3RydWN0IGk5MTVfY2FwdHVyZV9saXN0ICpjOwogCXN0cnVjdCBkcm1faTkxNV9lcnJvcl9vYmpl
Y3QgKipibzsKQEAgLTEzNjIsMTggKzEzMzEsMjAgQEAgc3RhdGljIHZvaWQgcmVxdWVzdF9yZWNv
cmRfdXNlcl9ibyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0LAogCWlmICghbWF4KQogCQly
ZXR1cm47CiAKLQlibyA9IGttYWxsb2NfYXJyYXkobWF4LCBzaXplb2YoKmJvKSwgR0ZQX0FUT01J
Qyk7CisJYm8gPSBrbWFsbG9jX2FycmF5KG1heCwgc2l6ZW9mKCpibyksIEFUT01JQ19NQVlGQUlM
KTsKIAlpZiAoIWJvKSB7CiAJCS8qIElmIHdlIGNhbid0IGNhcHR1cmUgZXZlcnl0aGluZywgdHJ5
IHRvIGNhcHR1cmUgc29tZXRoaW5nLiAqLwogCQltYXggPSBtaW5fdChsb25nLCBtYXgsIFBBR0Vf
U0laRSAvIHNpemVvZigqYm8pKTsKLQkJYm8gPSBrbWFsbG9jX2FycmF5KG1heCwgc2l6ZW9mKCpi
byksIEdGUF9BVE9NSUMpOworCQlibyA9IGttYWxsb2NfYXJyYXkobWF4LCBzaXplb2YoKmJvKSwg
QVRPTUlDX01BWUZBSUwpOwogCX0KIAlpZiAoIWJvKQogCQlyZXR1cm47CiAKIAljb3VudCA9IDA7
CiAJZm9yIChjID0gcmVxdWVzdC0+Y2FwdHVyZV9saXN0OyBjOyBjID0gYy0+bmV4dCkgewotCQli
b1tjb3VudF0gPSBpOTE1X2Vycm9yX29iamVjdF9jcmVhdGUocmVxdWVzdC0+aTkxNSwgYy0+dm1h
KTsKKwkJYm9bY291bnRdID0gaTkxNV9lcnJvcl9vYmplY3RfY3JlYXRlKHJlcXVlc3QtPmk5MTUs
CisJCQkJCQkgICAgIGMtPnZtYSwKKwkJCQkJCSAgICAgY29tcHJlc3MpOwogCQlpZiAoIWJvW2Nv
dW50XSkKIAkJCWJyZWFrOwogCQlpZiAoKytjb3VudCA9PSBtYXgpCkBAIC0xMzg2LDcgKzEzNTcs
OCBAQCBzdGF0aWMgdm9pZCByZXF1ZXN0X3JlY29yZF91c2VyX2JvKHN0cnVjdCBpOTE1X3JlcXVl
c3QgKnJlcXVlc3QsCiAKIHN0YXRpYyBzdHJ1Y3QgZHJtX2k5MTVfZXJyb3Jfb2JqZWN0ICoKIGNh
cHR1cmVfb2JqZWN0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkgICAgICAg
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKKwkgICAgICAgc3RydWN0IGRybV9pOTE1
X2dlbV9vYmplY3QgKm9iaiwKKwkgICAgICAgc3RydWN0IGNvbXByZXNzICpjb21wcmVzcykKIHsK
IAlpZiAob2JqICYmIGk5MTVfZ2VtX29iamVjdF9oYXNfcGFnZXMob2JqKSkgewogCQlzdHJ1Y3Qg
aTkxNV92bWEgZmFrZSA9IHsKQEAgLTEzOTYsMTMgKzEzNjgsMTQgQEAgY2FwdHVyZV9vYmplY3Qo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQkJLm9iaiA9IG9iaiwKIAkJfTsK
IAotCQlyZXR1cm4gaTkxNV9lcnJvcl9vYmplY3RfY3JlYXRlKGRldl9wcml2LCAmZmFrZSk7CisJ
CXJldHVybiBpOTE1X2Vycm9yX29iamVjdF9jcmVhdGUoZGV2X3ByaXYsICZmYWtlLCBjb21wcmVz
cyk7CiAJfSBlbHNlIHsKIAkJcmV0dXJuIE5VTEw7CiAJfQogfQogCi1zdGF0aWMgdm9pZCBnZW1f
cmVjb3JkX3JpbmdzKHN0cnVjdCBpOTE1X2dwdV9zdGF0ZSAqZXJyb3IpCitzdGF0aWMgdm9pZAor
Z2VtX3JlY29yZF9yaW5ncyhzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKmVycm9yLCBzdHJ1Y3QgY29t
cHJlc3MgKmNvbXByZXNzKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZXJy
b3ItPmk5MTU7CiAJaW50IGk7CkBAIC0xNDIwLDYgKzEzOTMsOSBAQCBzdGF0aWMgdm9pZCBnZW1f
cmVjb3JkX3JpbmdzKHN0cnVjdCBpOTE1X2dwdV9zdGF0ZSAqZXJyb3IpCiAKIAkJZWUtPmVuZ2lu
ZV9pZCA9IGk7CiAKKwkJLyogUmVmaWxsIG91ciBwYWdlIHBvb2wgYmVmb3JlIGVudGVyaW5nIGF0
b21pYyBzZWN0aW9uICovCisJCXBvb2xfcmVmaWxsKCZjb21wcmVzcy0+cG9vbCwgQUxMT1dfRkFJ
TCk7CisKIAkJZXJyb3JfcmVjb3JkX2VuZ2luZV9yZWdpc3RlcnMoZXJyb3IsIGVuZ2luZSwgZWUp
OwogCQllcnJvcl9yZWNvcmRfZW5naW5lX2V4ZWNsaXN0cyhlbmdpbmUsIGVlKTsKIApAQCAtMTQy
OSw4ICsxNDA1LDYgQEAgc3RhdGljIHZvaWQgZ2VtX3JlY29yZF9yaW5ncyhzdHJ1Y3QgaTkxNV9n
cHVfc3RhdGUgKmVycm9yKQogCQkJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IHJlcXVl
c3QtPmdlbV9jb250ZXh0OwogCQkJc3RydWN0IGludGVsX3JpbmcgKnJpbmcgPSByZXF1ZXN0LT5y
aW5nOwogCi0JCQllZS0+dm0gPSBjdHgtPnZtID86ICZlbmdpbmUtPmd0LT5nZ3R0LT52bTsKLQog
CQkJcmVjb3JkX2NvbnRleHQoJmVlLT5jb250ZXh0LCBjdHgpOwogCiAJCQkvKiBXZSBuZWVkIHRv
IGNvcHkgdGhlc2UgdG8gYW4gYW5vbnltb3VzIGJ1ZmZlcgpAQCAtMTQzOCwxNyArMTQxMiwyMSBA
QCBzdGF0aWMgdm9pZCBnZW1fcmVjb3JkX3JpbmdzKHN0cnVjdCBpOTE1X2dwdV9zdGF0ZSAqZXJy
b3IpCiAJCQkgKiBieSB1c2Vyc3BhY2UuCiAJCQkgKi8KIAkJCWVlLT5iYXRjaGJ1ZmZlciA9Ci0J
CQkJaTkxNV9lcnJvcl9vYmplY3RfY3JlYXRlKGk5MTUsIHJlcXVlc3QtPmJhdGNoKTsKKwkJCQlp
OTE1X2Vycm9yX29iamVjdF9jcmVhdGUoaTkxNSwKKwkJCQkJCQkgcmVxdWVzdC0+YmF0Y2gsCisJ
CQkJCQkJIGNvbXByZXNzKTsKIAogCQkJaWYgKEhBU19CUk9LRU5fQ1NfVExCKGk5MTUpKQogCQkJ
CWVlLT53YV9iYXRjaGJ1ZmZlciA9CiAJCQkJICBpOTE1X2Vycm9yX29iamVjdF9jcmVhdGUoaTkx
NSwKLQkJCQkJCQkgICBlbmdpbmUtPmd0LT5zY3JhdGNoKTsKLQkJCXJlcXVlc3RfcmVjb3JkX3Vz
ZXJfYm8ocmVxdWVzdCwgZWUpOworCQkJCQkJCSAgIGVuZ2luZS0+Z3QtPnNjcmF0Y2gsCisJCQkJ
CQkJICAgY29tcHJlc3MpOworCQkJcmVxdWVzdF9yZWNvcmRfdXNlcl9ibyhyZXF1ZXN0LCBlZSwg
Y29tcHJlc3MpOwogCiAJCQllZS0+Y3R4ID0KIAkJCQlpOTE1X2Vycm9yX29iamVjdF9jcmVhdGUo
aTkxNSwKLQkJCQkJCQkgcmVxdWVzdC0+aHdfY29udGV4dC0+c3RhdGUpOworCQkJCQkJCSByZXF1
ZXN0LT5od19jb250ZXh0LT5zdGF0ZSwKKwkJCQkJCQkgY29tcHJlc3MpOwogCiAJCQllcnJvci0+
c2ltdWxhdGVkIHw9CiAJCQkJaTkxNV9nZW1fY29udGV4dF9ub19lcnJvcl9jYXB0dXJlKGN0eCk7
CkBAIC0xNDYwLDcgKzE0MzgsOSBAQCBzdGF0aWMgdm9pZCBnZW1fcmVjb3JkX3JpbmdzKHN0cnVj
dCBpOTE1X2dwdV9zdGF0ZSAqZXJyb3IpCiAJCQllZS0+Y3B1X3JpbmdfaGVhZCA9IHJpbmctPmhl
YWQ7CiAJCQllZS0+Y3B1X3JpbmdfdGFpbCA9IHJpbmctPnRhaWw7CiAJCQllZS0+cmluZ2J1ZmZl
ciA9Ci0JCQkJaTkxNV9lcnJvcl9vYmplY3RfY3JlYXRlKGk5MTUsIHJpbmctPnZtYSk7CisJCQkJ
aTkxNV9lcnJvcl9vYmplY3RfY3JlYXRlKGk5MTUsCisJCQkJCQkJIHJpbmctPnZtYSwKKwkJCQkJ
CQkgY29tcHJlc3MpOwogCiAJCQllbmdpbmVfcmVjb3JkX3JlcXVlc3RzKGVuZ2luZSwgcmVxdWVz
dCwgZWUpOwogCQl9CkBAIC0xNDY4LDg5ICsxNDQ4LDIxIEBAIHN0YXRpYyB2b2lkIGdlbV9yZWNv
cmRfcmluZ3Moc3RydWN0IGk5MTVfZ3B1X3N0YXRlICplcnJvcikKIAogCQllZS0+aHdzX3BhZ2Ug
PQogCQkJaTkxNV9lcnJvcl9vYmplY3RfY3JlYXRlKGk5MTUsCi0JCQkJCQkgZW5naW5lLT5zdGF0
dXNfcGFnZS52bWEpOwotCi0JCWVlLT53YV9jdHggPSBpOTE1X2Vycm9yX29iamVjdF9jcmVhdGUo
aTkxNSwgZW5naW5lLT53YV9jdHgudm1hKTsKLQotCQllZS0+ZGVmYXVsdF9zdGF0ZSA9IGNhcHR1
cmVfb2JqZWN0KGk5MTUsIGVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSk7Ci0JfQotfQotCi1zdGF0aWMg
dm9pZCBnZW1fY2FwdHVyZV92bShzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKmVycm9yLAotCQkJICAg
c3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCi0JCQkgICBpbnQgaWR4KQotewotCXN0cnVj
dCBkcm1faTkxNV9lcnJvcl9idWZmZXIgKmFjdGl2ZV9ibzsKLQlzdHJ1Y3QgaTkxNV92bWEgKnZt
YTsKLQlpbnQgY291bnQ7Ci0KLQljb3VudCA9IDA7Ci0JbGlzdF9mb3JfZWFjaF9lbnRyeSh2bWEs
ICZ2bS0+Ym91bmRfbGlzdCwgdm1fbGluaykKLQkJaWYgKGk5MTVfdm1hX2lzX2FjdGl2ZSh2bWEp
KQotCQkJY291bnQrKzsKLQotCWFjdGl2ZV9ibyA9IE5VTEw7Ci0JaWYgKGNvdW50KQotCQlhY3Rp
dmVfYm8gPSBrY2FsbG9jKGNvdW50LCBzaXplb2YoKmFjdGl2ZV9ibyksIEdGUF9BVE9NSUMpOwot
CWlmIChhY3RpdmVfYm8pCi0JCWNvdW50ID0gY2FwdHVyZV9lcnJvcl9ibyhhY3RpdmVfYm8sCi0J
CQkJCSBjb3VudCwgJnZtLT5ib3VuZF9saXN0LAotCQkJCQkgQUNUSVZFX09OTFkpOwotCWVsc2UK
LQkJY291bnQgPSAwOworCQkJCQkJIGVuZ2luZS0+c3RhdHVzX3BhZ2Uudm1hLAorCQkJCQkJIGNv
bXByZXNzKTsKIAotCWVycm9yLT5hY3RpdmVfdm1baWR4XSA9IHZtOwotCWVycm9yLT5hY3RpdmVf
Ym9baWR4XSA9IGFjdGl2ZV9ibzsKLQllcnJvci0+YWN0aXZlX2JvX2NvdW50W2lkeF0gPSBjb3Vu
dDsKLX0KLQotc3RhdGljIHZvaWQgY2FwdHVyZV9hY3RpdmVfYnVmZmVycyhzdHJ1Y3QgaTkxNV9n
cHVfc3RhdGUgKmVycm9yKQotewotCWludCBjbnQgPSAwLCBpLCBqOwotCi0JQlVJTERfQlVHX09O
KEFSUkFZX1NJWkUoZXJyb3ItPmVuZ2luZSkgPiBBUlJBWV9TSVpFKGVycm9yLT5hY3RpdmVfYm8p
KTsKLQlCVUlMRF9CVUdfT04oQVJSQVlfU0laRShlcnJvci0+YWN0aXZlX2JvKSAhPSBBUlJBWV9T
SVpFKGVycm9yLT5hY3RpdmVfdm0pKTsKLQlCVUlMRF9CVUdfT04oQVJSQVlfU0laRShlcnJvci0+
YWN0aXZlX2JvKSAhPSBBUlJBWV9TSVpFKGVycm9yLT5hY3RpdmVfYm9fY291bnQpKTsKLQotCS8q
IFNjYW4gZWFjaCBlbmdpbmUgbG9va2luZyBmb3IgdW5pcXVlIGFjdGl2ZSBjb250ZXh0cy92bSAq
LwotCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGVycm9yLT5lbmdpbmUpOyBpKyspIHsKLQkJ
c3RydWN0IGRybV9pOTE1X2Vycm9yX2VuZ2luZSAqZWUgPSAmZXJyb3ItPmVuZ2luZVtpXTsKLQkJ
Ym9vbCBmb3VuZDsKLQotCQlpZiAoIWVlLT52bSkKLQkJCWNvbnRpbnVlOworCQllZS0+d2FfY3R4
ID0KKwkJCWk5MTVfZXJyb3Jfb2JqZWN0X2NyZWF0ZShpOTE1LAorCQkJCQkJIGVuZ2luZS0+d2Ff
Y3R4LnZtYSwKKwkJCQkJCSBjb21wcmVzcyk7CiAKLQkJZm91bmQgPSBmYWxzZTsKLQkJZm9yIChq
ID0gMDsgaiA8IGkgJiYgIWZvdW5kOyBqKyspCi0JCQlmb3VuZCA9IGVycm9yLT5lbmdpbmVbal0u
dm0gPT0gZWUtPnZtOwotCQlpZiAoIWZvdW5kKQotCQkJZ2VtX2NhcHR1cmVfdm0oZXJyb3IsIGVl
LT52bSwgY250KyspOworCQllZS0+ZGVmYXVsdF9zdGF0ZSA9CisJCQljYXB0dXJlX29iamVjdChp
OTE1LCBlbmdpbmUtPmRlZmF1bHRfc3RhdGUsIGNvbXByZXNzKTsKIAl9CiB9CiAKLXN0YXRpYyB2
b2lkIGNhcHR1cmVfcGlubmVkX2J1ZmZlcnMoc3RydWN0IGk5MTVfZ3B1X3N0YXRlICplcnJvcikK
LXsKLQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9ICZlcnJvci0+aTkxNS0+Z2d0dC52
bTsKLQlzdHJ1Y3QgZHJtX2k5MTVfZXJyb3JfYnVmZmVyICpibzsKLQlzdHJ1Y3QgaTkxNV92bWEg
KnZtYTsKLQlpbnQgY291bnQ7Ci0KLQljb3VudCA9IDA7Ci0JbGlzdF9mb3JfZWFjaF9lbnRyeSh2
bWEsICZ2bS0+Ym91bmRfbGlzdCwgdm1fbGluaykKLQkJY291bnQrKzsKLQotCWJvID0gTlVMTDsK
LQlpZiAoY291bnQpCi0JCWJvID0ga2NhbGxvYyhjb3VudCwgc2l6ZW9mKCpibyksIEdGUF9BVE9N
SUMpOwotCWlmICghYm8pCi0JCXJldHVybjsKLQotCWVycm9yLT5waW5uZWRfYm9fY291bnQgPQot
CQljYXB0dXJlX2Vycm9yX2JvKGJvLCBjb3VudCwgJnZtLT5ib3VuZF9saXN0LCBQSU5ORURfT05M
WSk7Ci0JZXJyb3ItPnBpbm5lZF9ibyA9IGJvOwotfQotCi1zdGF0aWMgdm9pZCBjYXB0dXJlX3Vj
X3N0YXRlKHN0cnVjdCBpOTE1X2dwdV9zdGF0ZSAqZXJyb3IpCitzdGF0aWMgdm9pZAorY2FwdHVy
ZV91Y19zdGF0ZShzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKmVycm9yLCBzdHJ1Y3QgY29tcHJlc3Mg
KmNvbXByZXNzKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZXJyb3ItPmk5
MTU7CiAJc3RydWN0IGk5MTVfZXJyb3JfdWMgKmVycm9yX3VjID0gJmVycm9yLT51YzsKQEAgLTE1
NjcsOSArMTQ3OSwxMSBAQCBzdGF0aWMgdm9pZCBjYXB0dXJlX3VjX3N0YXRlKHN0cnVjdCBpOTE1
X2dwdV9zdGF0ZSAqZXJyb3IpCiAJICogQXMgbW9kcGFyYW1zIGFyZSBnZW5lcmFsbHkgYWNjZXNp
YmxlIGZyb20gdGhlIHVzZXJzcGFjZSBtYWtlCiAJICogZXhwbGljaXQgY29waWVzIG9mIHRoZSBm
aXJtd2FyZSBwYXRocy4KIAkgKi8KLQllcnJvcl91Yy0+Z3VjX2Z3LnBhdGggPSBrc3RyZHVwKHVj
LT5ndWMuZncucGF0aCwgR0ZQX0FUT01JQyk7Ci0JZXJyb3JfdWMtPmh1Y19mdy5wYXRoID0ga3N0
cmR1cCh1Yy0+aHVjLmZ3LnBhdGgsIEdGUF9BVE9NSUMpOwotCWVycm9yX3VjLT5ndWNfbG9nID0g
aTkxNV9lcnJvcl9vYmplY3RfY3JlYXRlKGk5MTUsIHVjLT5ndWMubG9nLnZtYSk7CisJZXJyb3Jf
dWMtPmd1Y19mdy5wYXRoID0ga3N0cmR1cCh1Yy0+Z3VjLmZ3LnBhdGgsIEFMTE9XX0ZBSUwpOwor
CWVycm9yX3VjLT5odWNfZncucGF0aCA9IGtzdHJkdXAodWMtPmh1Yy5mdy5wYXRoLCBBTExPV19G
QUlMKTsKKwllcnJvcl91Yy0+Z3VjX2xvZyA9IGk5MTVfZXJyb3Jfb2JqZWN0X2NyZWF0ZShpOTE1
LAorCQkJCQkJICAgICB1Yy0+Z3VjLmxvZy52bWEsCisJCQkJCQkgICAgIGNvbXByZXNzKTsKIH0K
IAogLyogQ2FwdHVyZSBhbGwgcmVnaXN0ZXJzIHdoaWNoIGRvbid0IGZpdCBpbnRvIGFub3RoZXIg
Y2F0ZWdvcnkuICovCkBAIC0xNzUzLDU2ICsxNjY3LDUzIEBAIHN0YXRpYyB2b2lkIGNhcHR1cmVf
ZmluaXNoKHN0cnVjdCBpOTE1X2dwdV9zdGF0ZSAqZXJyb3IpCiAJZ2d0dC0+dm0uY2xlYXJfcmFu
Z2UoJmdndHQtPnZtLCBzbG90LCBQQUdFX1NJWkUpOwogfQogCi1zdGF0aWMgaW50IGNhcHR1cmUo
dm9pZCAqZGF0YSkKLXsKLQlzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKmVycm9yID0gZGF0YTsKLQot
CWVycm9yLT50aW1lID0ga3RpbWVfZ2V0X3JlYWwoKTsKLQllcnJvci0+Ym9vdHRpbWUgPSBrdGlt
ZV9nZXRfYm9vdHRpbWUoKTsKLQllcnJvci0+dXB0aW1lID0ga3RpbWVfc3ViKGt0aW1lX2dldCgp
LAotCQkJCSAgZXJyb3ItPmk5MTUtPmd0Lmxhc3RfaW5pdF90aW1lKTsKLQllcnJvci0+Y2FwdHVy
ZSA9IGppZmZpZXM7Ci0KLQljYXB0dXJlX3BhcmFtcyhlcnJvcik7Ci0JY2FwdHVyZV9nZW5fc3Rh
dGUoZXJyb3IpOwotCWNhcHR1cmVfdWNfc3RhdGUoZXJyb3IpOwotCWNhcHR1cmVfcmVnX3N0YXRl
KGVycm9yKTsKLQlnZW1fcmVjb3JkX2ZlbmNlcyhlcnJvcik7Ci0JZ2VtX3JlY29yZF9yaW5ncyhl
cnJvcik7Ci0JY2FwdHVyZV9hY3RpdmVfYnVmZmVycyhlcnJvcik7Ci0JY2FwdHVyZV9waW5uZWRf
YnVmZmVycyhlcnJvcik7Ci0KLQllcnJvci0+b3ZlcmxheSA9IGludGVsX292ZXJsYXlfY2FwdHVy
ZV9lcnJvcl9zdGF0ZShlcnJvci0+aTkxNSk7Ci0JZXJyb3ItPmRpc3BsYXkgPSBpbnRlbF9kaXNw
bGF5X2NhcHR1cmVfZXJyb3Jfc3RhdGUoZXJyb3ItPmk5MTUpOwotCi0JZXJyb3ItPmVwb2NoID0g
Y2FwdHVyZV9maW5kX2Vwb2NoKGVycm9yKTsKLQotCWNhcHR1cmVfZmluaXNoKGVycm9yKTsKLQly
ZXR1cm4gMDsKLX0KLQogI2RlZmluZSBEQVlfQVNfU0VDT05EUyh4KSAoMjQgKiA2MCAqIDYwICog
KHgpKQogCiBzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUgKgogaTkxNV9jYXB0dXJlX2dwdV9zdGF0ZShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgaTkxNV9ncHVfc3RhdGUg
KmVycm9yOworCXN0cnVjdCBjb21wcmVzcyBjb21wcmVzczsKIAogCS8qIENoZWNrIGlmIEdQVSBj
YXB0dXJlIGhhcyBiZWVuIGRpc2FibGVkICovCiAJZXJyb3IgPSBSRUFEX09OQ0UoaTkxNS0+Z3B1
X2Vycm9yLmZpcnN0X2Vycm9yKTsKIAlpZiAoSVNfRVJSKGVycm9yKSkKIAkJcmV0dXJuIGVycm9y
OwogCi0JZXJyb3IgPSBremFsbG9jKHNpemVvZigqZXJyb3IpLCBHRlBfQVRPTUlDKTsKKwllcnJv
ciA9IGt6YWxsb2Moc2l6ZW9mKCplcnJvciksIEFMTE9XX0ZBSUwpOwogCWlmICghZXJyb3IpIHsK
IAkJaTkxNV9kaXNhYmxlX2Vycm9yX3N0YXRlKGk5MTUsIC1FTk9NRU0pOwogCQlyZXR1cm4gRVJS
X1BUUigtRU5PTUVNKTsKIAl9CiAKKwlpZiAoIWNvbXByZXNzX2luaXQoJmNvbXByZXNzKSkgewor
CQlrZnJlZShlcnJvcik7CisJCWk5MTVfZGlzYWJsZV9lcnJvcl9zdGF0ZShpOTE1LCAtRU5PTUVN
KTsKKwkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisJfQorCiAJa3JlZl9pbml0KCZlcnJvci0+
cmVmKTsKIAllcnJvci0+aTkxNSA9IGk5MTU7CiAKLQlzdG9wX21hY2hpbmUoY2FwdHVyZSwgZXJy
b3IsIE5VTEwpOworCWVycm9yLT50aW1lID0ga3RpbWVfZ2V0X3JlYWwoKTsKKwllcnJvci0+Ym9v
dHRpbWUgPSBrdGltZV9nZXRfYm9vdHRpbWUoKTsKKwllcnJvci0+dXB0aW1lID0ga3RpbWVfc3Vi
KGt0aW1lX2dldCgpLCBpOTE1LT5ndC5sYXN0X2luaXRfdGltZSk7CisJZXJyb3ItPmNhcHR1cmUg
PSBqaWZmaWVzOworCisJY2FwdHVyZV9wYXJhbXMoZXJyb3IpOworCWNhcHR1cmVfZ2VuX3N0YXRl
KGVycm9yKTsKKwljYXB0dXJlX3VjX3N0YXRlKGVycm9yLCAmY29tcHJlc3MpOworCWNhcHR1cmVf
cmVnX3N0YXRlKGVycm9yKTsKKwlnZW1fcmVjb3JkX2ZlbmNlcyhlcnJvcik7CisJZ2VtX3JlY29y
ZF9yaW5ncyhlcnJvciwgJmNvbXByZXNzKTsKKworCWVycm9yLT5vdmVybGF5ID0gaW50ZWxfb3Zl
cmxheV9jYXB0dXJlX2Vycm9yX3N0YXRlKGk5MTUpOworCWVycm9yLT5kaXNwbGF5ID0gaW50ZWxf
ZGlzcGxheV9jYXB0dXJlX2Vycm9yX3N0YXRlKGk5MTUpOworCisJZXJyb3ItPmVwb2NoID0gY2Fw
dHVyZV9maW5kX2Vwb2NoKGVycm9yKTsKKworCWNhcHR1cmVfZmluaXNoKGVycm9yKTsKKwljb21w
cmVzc19maW5pKCZjb21wcmVzcyk7CiAKIAlyZXR1cm4gZXJyb3I7CiB9CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5oIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9ncHVfZXJyb3IuaAppbmRleCA4NWYwNmJjNWRhMDUuLmEyNGMzNTEwN2QxNiAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3IuaAorKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5oCkBAIC04NSw3ICs4NSw2IEBAIHN0cnVj
dCBpOTE1X2dwdV9zdGF0ZSB7CiAJCS8qIFNvZnR3YXJlIHRyYWNrZWQgc3RhdGUgKi8KIAkJYm9v
bCBpZGxlOwogCQl1bnNpZ25lZCBsb25nIGhhbmdjaGVja190aW1lc3RhbXA7Ci0JCXN0cnVjdCBp
OTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwogCQlpbnQgbnVtX3JlcXVlc3RzOwogCQl1MzIgcmVzZXRf
Y291bnQ7CiAKQEAgLTE2MSwyMiArMTYwLDYgQEAgc3RydWN0IGk5MTVfZ3B1X3N0YXRlIHsKIAkJ
fSB2bV9pbmZvOwogCX0gZW5naW5lW0k5MTVfTlVNX0VOR0lORVNdOwogCi0Jc3RydWN0IGRybV9p
OTE1X2Vycm9yX2J1ZmZlciB7Ci0JCXUzMiBzaXplOwotCQl1MzIgbmFtZTsKLQkJdTY0IGd0dF9v
ZmZzZXQ7Ci0JCXUzMiByZWFkX2RvbWFpbnM7Ci0JCXUzMiB3cml0ZV9kb21haW47Ci0JCXMzMiBm
ZW5jZV9yZWc6STkxNV9NQVhfTlVNX0ZFTkNFX0JJVFM7Ci0JCXUzMiB0aWxpbmc6MjsKLQkJdTMy
IGRpcnR5OjE7Ci0JCXUzMiBwdXJnZWFibGU6MTsKLQkJdTMyIHVzZXJwdHI6MTsKLQkJdTMyIGNh
Y2hlX2xldmVsOjM7Ci0JfSAqYWN0aXZlX2JvW0k5MTVfTlVNX0VOR0lORVNdLCAqcGlubmVkX2Jv
OwotCXUzMiBhY3RpdmVfYm9fY291bnRbSTkxNV9OVU1fRU5HSU5FU10sIHBpbm5lZF9ib19jb3Vu
dDsKLQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICphY3RpdmVfdm1bSTkxNV9OVU1fRU5HSU5F
U107Ci0KIAlzdHJ1Y3Qgc2NhdHRlcmxpc3QgKnNnbCwgKmZpdDsKIH07CiAKLS0gCjIuMjIuMAoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4
IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

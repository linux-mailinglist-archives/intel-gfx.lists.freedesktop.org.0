Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 70EA3D65AD
	for <lists+intel-gfx@lfdr.de>; Mon, 14 Oct 2019 16:56:25 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 913EB6E303;
	Mon, 14 Oct 2019 14:56:23 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga17.intel.com (mga17.intel.com [192.55.52.151])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6252B6E303
 for <intel-gfx@lists.freedesktop.org>; Mon, 14 Oct 2019 14:56:22 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga001.fm.intel.com ([10.253.24.23])
 by fmsmga107.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 14 Oct 2019 07:56:22 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.67,296,1566889200"; d="scan'208";a="207980572"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by fmsmga001.fm.intel.com with SMTP; 14 Oct 2019 07:56:20 -0700
Received: by stinkbox (sSMTP sendmail emulation);
 Mon, 14 Oct 2019 17:56:19 +0300
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 14 Oct 2019 17:56:19 +0300
Message-Id: <20191014145619.32395-1-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20191011200949.7839-7-ville.syrjala@linux.intel.com>
References: <20191011200949.7839-7-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 6/8] drm/i915: Polish WM_LINETIME register
 stuff
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KCkxl
dCdzIHN0b3JlIHRoZSBub3JtYWwgYW5kIElQUyBsaW5ldGltZSB3YXRlcm1hcmtzIGluZGl2aWR1
YWxseSwKYW5kIHdoaWxlIGF0IGl0IHdlJ2xsIHBpbXAgdGhlIHJlZ2lzdGVyIGRlZmluaXRpb25z
IGFzIHdlbGwuCgp2MjogRGVhbCB3aXRoIGd2dAoKU2lnbmVkLW9mZi1ieTogVmlsbGUgU3lyasOk
bMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KLS0tCiAuLi4vZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggICAgfCAgMyArLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Z0L2hhbmRsZXJzLmMgICAgICAgICAgIHwgIDYgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfcmVnLmggICAgICAgICAgICAgICB8IDE0ICsrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2ludGVsX3BtLmMgICAgICAgICAgICAgICB8IDcyICsrKysrKysrKystLS0tLS0tLS0KIDQgZmls
ZXMgY2hhbmdlZCwgNTIgaW5zZXJ0aW9ucygrKSwgNDMgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaAppbmRleCA0
MDM5MGQ4NTU4MTUuLjg0MTk1MjMzMmM3ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKQEAgLTYzMSw3ICs2MzEsOCBAQCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zY2FsZXJfc3RhdGUgewogCiBzdHJ1Y3QgaW50ZWxfcGlwZV93bSB7CiAJ
c3RydWN0IGludGVsX3dtX2xldmVsIHdtWzVdOwotCXUzMiBsaW5ldGltZTsKKwl1MTYgbGluZXRp
bWU7CisJdTE2IGlwc19saW5ldGltZTsKIAlib29sIGZiY193bV9lbmFibGVkOwogCWJvb2wgcGlw
ZV9lbmFibGVkOwogCWJvb2wgc3ByaXRlc19lbmFibGVkOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3Z0L2hhbmRsZXJzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvaGFu
ZGxlcnMuYwppbmRleCA0NWE5MTI0ZTUzYjYuLmYyYWQ0NzdlZGU2YiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2hhbmRsZXJzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Z0L2hhbmRsZXJzLmMKQEAgLTIzOTcsOSArMjM5Nyw5IEBAIHN0YXRpYyBpbnQgaW5pdF9n
ZW5lcmljX21taW9faW5mbyhzdHJ1Y3QgaW50ZWxfZ3Z0ICpndnQpCiAJTU1JT19GKF9NTUlPKDB4
NzE0NGMpLCAweGMsIDAsIDAsIDAsIERfUFJFX1NLTCwgTlVMTCwgTlVMTCk7CiAJTU1JT19GKF9N
TUlPKDB4NzI0NGMpLCAweGMsIDAsIDAsIDAsIERfUFJFX1NLTCwgTlVMTCwgTlVMTCk7CiAKLQlN
TUlPX0QoUElQRV9XTV9MSU5FVElNRShQSVBFX0EpLCBEX0FMTCk7Ci0JTU1JT19EKFBJUEVfV01f
TElORVRJTUUoUElQRV9CKSwgRF9BTEwpOwotCU1NSU9fRChQSVBFX1dNX0xJTkVUSU1FKFBJUEVf
QyksIERfQUxMKTsKKwlNTUlPX0QoV01fTElORVRJTUUoUElQRV9BKSwgRF9BTEwpOworCU1NSU9f
RChXTV9MSU5FVElNRShQSVBFX0IpLCBEX0FMTCk7CisJTU1JT19EKFdNX0xJTkVUSU1FKFBJUEVf
QyksIERfQUxMKTsKIAlNTUlPX0QoU1BMTF9DVEwsIERfQUxMKTsKIAlNTUlPX0QoX01NSU8oX1dS
UExMX0NUTDEpLCBEX0FMTCk7CiAJTU1JT19EKF9NTUlPKF9XUlBMTF9DVEwyKSwgRF9BTEwpOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaCBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcmVnLmgKaW5kZXggMGZiOTAzMGI4OWYxLi5lMWRiODU3NjgwODQgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmgKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9yZWcuaApAQCAtMTAzOTQsMTMgKzEwMzk0LDEzIEBAIGVudW0gc2ts
X3Bvd2VyX2dhdGUgewogI2RlZmluZSAgRF9DT01QX0NPTVBfRElTQUJMRQkJKDEgPDwgMCkKIAog
LyogUGlwZSBXTV9MSU5FVElNRSAtIHdhdGVybWFyayBsaW5lIHRpbWUgKi8KLSNkZWZpbmUgX1BJ
UEVfV01fTElORVRJTUVfQQkJMHg0NTI3MAotI2RlZmluZSBfUElQRV9XTV9MSU5FVElNRV9CCQkw
eDQ1Mjc0Ci0jZGVmaW5lIFBJUEVfV01fTElORVRJTUUocGlwZSkgX01NSU9fUElQRShwaXBlLCBf
UElQRV9XTV9MSU5FVElNRV9BLCBfUElQRV9XTV9MSU5FVElNRV9CKQotI2RlZmluZSAgIFBJUEVf
V01fTElORVRJTUVfTUFTSwkJCSgweDFmZikKLSNkZWZpbmUgICBQSVBFX1dNX0xJTkVUSU1FX1RJ
TUUoeCkJCSgoeCkpCi0jZGVmaW5lICAgUElQRV9XTV9MSU5FVElNRV9JUFNfTElORVRJTUVfTUFT
SwkoMHgxZmYgPDwgMTYpCi0jZGVmaW5lICAgUElQRV9XTV9MSU5FVElNRV9JUFNfTElORVRJTUUo
eCkJKCh4KSA8PCAxNikKKyNkZWZpbmUgX1dNX0xJTkVUSU1FX0EJCTB4NDUyNzAKKyNkZWZpbmUg
X1dNX0xJTkVUSU1FX0IJCTB4NDUyNzQKKyNkZWZpbmUgV01fTElORVRJTUUocGlwZSkgX01NSU9f
UElQRShwaXBlLCBfV01fTElORVRJTUVfQSwgX1dNX0xJTkVUSU1FX0IpCisjZGVmaW5lICBIU1df
TElORVRJTUVfTUFTSwlSRUdfR0VOTUFTSyg4LCAwKQorI2RlZmluZSAgSFNXX0xJTkVUSU1FKHgp
CVJFR19GSUVMRF9QUkVQKEhTV19MSU5FVElNRV9NQVNLLCAoeCkpCisjZGVmaW5lICBIU1dfSVBT
X0xJTkVUSU1FX01BU0sJUkVHX0dFTk1BU0soMjQsIDE2KQorI2RlZmluZSAgSFNXX0lQU19MSU5F
VElNRSh4KQlSRUdfRklFTERfUFJFUChIU1dfSVBTX0xJTkVUSU1FX01BU0ssICh4KSkKIAogLyog
U0ZVU0VfU1RSQVAgKi8KICNkZWZpbmUgU0ZVU0VfU1RSQVAJCQlfTU1JTygweGMyMDE0KQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX3BtLmMKaW5kZXggZjIxZWI5MjUwZDIzLi5mNjg5M2I3NzEwNzggMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaW50ZWxfcG0uYwpAQCAtMjc2NCwzMSArMjc2NCwzMSBAQCBzdGF0aWMgdm9pZCBp
bGtfY29tcHV0ZV93bV9sZXZlbChjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCiB9CiAKIHN0YXRpYyB1MzIKLWhzd19jb21wdXRlX2xpbmV0aW1lX3dtKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQoraHN3X2xpbmV0aW1lX3dtKGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewotCWNvbnN0IHN0cnVjdCBpbnRl
bF9hdG9taWNfc3RhdGUgKmludGVsX3N0YXRlID0KLQkJdG9faW50ZWxfYXRvbWljX3N0YXRlKGNy
dGNfc3RhdGUtPmJhc2Uuc3RhdGUpOwogCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICph
ZGp1c3RlZF9tb2RlID0KIAkJJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRfbW9kZTsKLQl1MzIg
bGluZXRpbWUsIGlwc19saW5ldGltZTsKIAogCWlmICghY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUp
CiAJCXJldHVybiAwOwotCWlmIChXQVJOX09OKGFkanVzdGVkX21vZGUtPmNydGNfY2xvY2sgPT0g
MCkpCi0JCXJldHVybiAwOwotCWlmIChXQVJOX09OKGludGVsX3N0YXRlLT5jZGNsay5sb2dpY2Fs
LmNkY2xrID09IDApKQotCQlyZXR1cm4gMDsKIAotCS8qIFRoZSBXTSBhcmUgY29tcHV0ZWQgd2l0
aCBiYXNlIG9uIGhvdyBsb25nIGl0IHRha2VzIHRvIGZpbGwgYSBzaW5nbGUKLQkgKiByb3cgYXQg
dGhlIGdpdmVuIGNsb2NrIHJhdGUsIG11bHRpcGxpZWQgYnkgOC4KLQkgKiAqLwotCWxpbmV0aW1l
ID0gRElWX1JPVU5EX0NMT1NFU1QoYWRqdXN0ZWRfbW9kZS0+Y3J0Y19odG90YWwgKiAxMDAwICog
OCwKLQkJCQkgICAgIGFkanVzdGVkX21vZGUtPmNydGNfY2xvY2spOwotCWlwc19saW5ldGltZSA9
IERJVl9ST1VORF9DTE9TRVNUKGFkanVzdGVkX21vZGUtPmNydGNfaHRvdGFsICogMTAwMCAqIDgs
Ci0JCQkJCSBpbnRlbF9zdGF0ZS0+Y2RjbGsubG9naWNhbC5jZGNsayk7CisJcmV0dXJuIERJVl9S
T1VORF9DTE9TRVNUKGFkanVzdGVkX21vZGUtPmNydGNfaHRvdGFsICogMTAwMCAqIDgsCisJCQkJ
IGFkanVzdGVkX21vZGUtPmNydGNfY2xvY2spOworfQorCitzdGF0aWMgdTMyCitoc3dfaXBzX2xp
bmV0aW1lX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQorewor
CWNvbnN0IHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlID0KKwkJdG9faW50ZWxfYXRv
bWljX3N0YXRlKGNydGNfc3RhdGUtPmJhc2Uuc3RhdGUpOworCWNvbnN0IHN0cnVjdCBkcm1fZGlz
cGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0KKwkJJmNydGNfc3RhdGUtPmJhc2UuYWRqdXN0ZWRf
bW9kZTsKIAotCXJldHVybiBQSVBFX1dNX0xJTkVUSU1FX0lQU19MSU5FVElNRShpcHNfbGluZXRp
bWUpIHwKLQkgICAgICAgUElQRV9XTV9MSU5FVElNRV9USU1FKGxpbmV0aW1lKTsKKwlpZiAoIWNy
dGNfc3RhdGUtPmJhc2UuYWN0aXZlKQorCQlyZXR1cm4gMDsKKworCXJldHVybiBESVZfUk9VTkRf
Q0xPU0VTVChhZGp1c3RlZF9tb2RlLT5jcnRjX2h0b3RhbCAqIDEwMDAgKiA4LAorCQkJCSBzdGF0
ZS0+Y2RjbGsubG9naWNhbC5jZGNsayk7CiB9CiAKIHN0YXRpYyB2b2lkIGludGVsX3JlYWRfd21f
bGF0ZW5jeShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCkBAIC0zMTI4LDggKzMx
MjgsMTAgQEAgc3RhdGljIGludCBpbGtfY29tcHV0ZV9waXBlX3dtKHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjcnRjX3N0YXRlKQogCWlsa19jb21wdXRlX3dtX2xldmVsKGRldl9wcml2LCBpbnRl
bF9jcnRjLCAwLCBjcnRjX3N0YXRlLAogCQkJICAgICBwcmlzdGF0ZSwgc3Byc3RhdGUsIGN1cnN0
YXRlLCAmcGlwZV93bS0+d21bMF0pOwogCi0JaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpIHx8IElT
X0JST0FEV0VMTChkZXZfcHJpdikpCi0JCXBpcGVfd20tPmxpbmV0aW1lID0gaHN3X2NvbXB1dGVf
bGluZXRpbWVfd20oY3J0Y19zdGF0ZSk7CisJaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpIHx8IElT
X0JST0FEV0VMTChkZXZfcHJpdikpIHsKKwkJcGlwZV93bS0+bGluZXRpbWUgPSBoc3dfbGluZXRp
bWVfd20oY3J0Y19zdGF0ZSk7CisJCXBpcGVfd20tPmlwc19saW5ldGltZSA9IGhzd19pcHNfbGlu
ZXRpbWVfd20oY3J0Y19zdGF0ZSk7CisJfQogCiAJaWYgKCFpbGtfdmFsaWRhdGVfcGlwZV93bShk
ZXZfcHJpdiwgcGlwZV93bSkpCiAJCXJldHVybiAtRUlOVkFMOwpAQCAtMzMyOSw3ICszMzMxLDcg
QEAgc3RhdGljIHZvaWQgaWxrX2NvbXB1dGVfd21fcmVzdWx0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCiAJCQkJICAgZW51bSBpbnRlbF9kZGJfcGFydGl0aW9uaW5nIHBhcnRp
dGlvbmluZywKIAkJCQkgICBzdHJ1Y3QgaWxrX3dtX3ZhbHVlcyAqcmVzdWx0cykKIHsKLQlzdHJ1
Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YzsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKIAlp
bnQgbGV2ZWwsIHdtX2xwOwogCiAJcmVzdWx0cy0+ZW5hYmxlX2ZiY193bSA9IG1lcmdlZC0+ZmJj
X3dtX2VuYWJsZWQ7CkBAIC0zMzc0LDE1ICszMzc2LDE3IEBAIHN0YXRpYyB2b2lkIGlsa19jb21w
dXRlX3dtX3Jlc3VsdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCX0KIAog
CS8qIExQMCByZWdpc3RlciB2YWx1ZXMgKi8KLQlmb3JfZWFjaF9pbnRlbF9jcnRjKCZkZXZfcHJp
di0+ZHJtLCBpbnRlbF9jcnRjKSB7Ci0JCWVudW0gcGlwZSBwaXBlID0gaW50ZWxfY3J0Yy0+cGlw
ZTsKLQkJY29uc3Qgc3RydWN0IGludGVsX3dtX2xldmVsICpyID0KLQkJCSZpbnRlbF9jcnRjLT53
bS5hY3RpdmUuaWxrLndtWzBdOworCWZvcl9lYWNoX2ludGVsX2NydGMoJmRldl9wcml2LT5kcm0s
IGNydGMpIHsKKwkJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOworCQljb25zdCBzdHJ1Y3Qg
aW50ZWxfcGlwZV93bSAqcGlwZV93bSA9ICZjcnRjLT53bS5hY3RpdmUuaWxrOworCQljb25zdCBz
dHJ1Y3QgaW50ZWxfd21fbGV2ZWwgKnIgPSAmcGlwZV93bS0+d21bMF07CiAKIAkJaWYgKFdBUk5f
T04oIXItPmVuYWJsZSkpCiAJCQljb250aW51ZTsKIAotCQlyZXN1bHRzLT53bV9saW5ldGltZVtw
aXBlXSA9IGludGVsX2NydGMtPndtLmFjdGl2ZS5pbGsubGluZXRpbWU7CisJCXJlc3VsdHMtPndt
X2xpbmV0aW1lW3BpcGVdID0KKwkJCUhTV19MSU5FVElNRShwaXBlX3dtLT5saW5ldGltZSkgfAor
CQkJSFNXX0lQU19MSU5FVElNRShwaXBlX3dtLT5pcHNfbGluZXRpbWUpOwogCiAJCXJlc3VsdHMt
PndtX3BpcGVbcGlwZV0gPQogCQkJKHItPnByaV92YWwgPDwgV00wX1BJUEVfUExBTkVfU0hJRlQp
IHwKQEAgLTM1MzUsMTEgKzM1MzksMTEgQEAgc3RhdGljIHZvaWQgaWxrX3dyaXRlX3dtX3ZhbHVl
cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCUk5MTVfV1JJVEUoV00wX1BJ
UEVDX0lWQiwgcmVzdWx0cy0+d21fcGlwZVsyXSk7CiAKIAlpZiAoZGlydHkgJiBXTV9ESVJUWV9M
SU5FVElNRShQSVBFX0EpKQotCQlJOTE1X1dSSVRFKFBJUEVfV01fTElORVRJTUUoUElQRV9BKSwg
cmVzdWx0cy0+d21fbGluZXRpbWVbMF0pOworCQlJOTE1X1dSSVRFKFdNX0xJTkVUSU1FKFBJUEVf
QSksIHJlc3VsdHMtPndtX2xpbmV0aW1lWzBdKTsKIAlpZiAoZGlydHkgJiBXTV9ESVJUWV9MSU5F
VElNRShQSVBFX0IpKQotCQlJOTE1X1dSSVRFKFBJUEVfV01fTElORVRJTUUoUElQRV9CKSwgcmVz
dWx0cy0+d21fbGluZXRpbWVbMV0pOworCQlJOTE1X1dSSVRFKFdNX0xJTkVUSU1FKFBJUEVfQiks
IHJlc3VsdHMtPndtX2xpbmV0aW1lWzFdKTsKIAlpZiAoZGlydHkgJiBXTV9ESVJUWV9MSU5FVElN
RShQSVBFX0MpKQotCQlJOTE1X1dSSVRFKFBJUEVfV01fTElORVRJTUUoUElQRV9DKSwgcmVzdWx0
cy0+d21fbGluZXRpbWVbMl0pOworCQlJOTE1X1dSSVRFKFdNX0xJTkVUSU1FKFBJUEVfQyksIHJl
c3VsdHMtPndtX2xpbmV0aW1lWzJdKTsKIAogCWlmIChkaXJ0eSAmIFdNX0RJUlRZX0REQikgewog
CQlpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikgfHwgSVNfQlJPQURXRUxMKGRldl9wcml2KSkgewpA
QCAtNTU5OCw3ICs1NjAyLDcgQEAgc3RhdGljIHZvaWQgc2tsX2F0b21pY191cGRhdGVfY3J0Y193
bShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAlpZiAoKHN0YXRlLT53bV9yZXN1
bHRzLmRpcnR5X3BpcGVzICYgQklUKGNydGMtPnBpcGUpKSA9PSAwKQogCQlyZXR1cm47CiAKLQlJ
OTE1X1dSSVRFKFBJUEVfV01fTElORVRJTUUocGlwZSksIHBpcGVfd20tPmxpbmV0aW1lKTsKKwlJ
OTE1X1dSSVRFKFdNX0xJTkVUSU1FKHBpcGUpLCBIU1dfTElORVRJTUUocGlwZV93bS0+bGluZXRp
bWUpKTsKIH0KIAogc3RhdGljIHZvaWQgc2tsX2luaXRpYWxfd20oc3RydWN0IGludGVsX2F0b21p
Y19zdGF0ZSAqc3RhdGUsCkBAIC01NzQwLDcgKzU3NDQsOCBAQCB2b2lkIHNrbF9waXBlX3dtX2dl
dF9od19zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAlpZiAoIWNydGMtPmFjdGl2ZSkK
IAkJcmV0dXJuOwogCi0Jb3V0LT5saW5ldGltZSA9IEk5MTVfUkVBRChQSVBFX1dNX0xJTkVUSU1F
KHBpcGUpKTsKKwl2YWwgPSBJOTE1X1JFQUQoV01fTElORVRJTUUocGlwZSkpOworCW91dC0+bGlu
ZXRpbWUgPSBSRUdfRklFTERfR0VUKEhTV19MSU5FVElNRV9NQVNLLCB2YWwpOwogfQogCiB2b2lk
IHNrbF93bV9nZXRfaHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQpA
QCAtNTc4Miw3ICs1Nzg3LDcgQEAgc3RhdGljIHZvaWQgaWxrX3BpcGVfd21fZ2V0X2h3X3N0YXRl
KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQogCiAJaHctPndtX3BpcGVbcGlwZV0gPSBJOTE1X1JF
QUQod20wX3BpcGVfcmVnW3BpcGVdKTsKIAlpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikgfHwgSVNf
QlJPQURXRUxMKGRldl9wcml2KSkKLQkJaHctPndtX2xpbmV0aW1lW3BpcGVdID0gSTkxNV9SRUFE
KFBJUEVfV01fTElORVRJTUUocGlwZSkpOworCQlody0+d21fbGluZXRpbWVbcGlwZV0gPSBJOTE1
X1JFQUQoV01fTElORVRJTUUocGlwZSkpOwogCiAJbWVtc2V0KGFjdGl2ZSwgMCwgc2l6ZW9mKCph
Y3RpdmUpKTsKIApAQCAtNTgwMSw3ICs1ODA2LDEwIEBAIHN0YXRpYyB2b2lkIGlsa19waXBlX3dt
X2dldF9od19zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKIAkJYWN0aXZlLT53bVswXS5w
cmlfdmFsID0gKHRtcCAmIFdNMF9QSVBFX1BMQU5FX01BU0spID4+IFdNMF9QSVBFX1BMQU5FX1NI
SUZUOwogCQlhY3RpdmUtPndtWzBdLnNwcl92YWwgPSAodG1wICYgV00wX1BJUEVfU1BSSVRFX01B
U0spID4+IFdNMF9QSVBFX1NQUklURV9TSElGVDsKIAkJYWN0aXZlLT53bVswXS5jdXJfdmFsID0g
dG1wICYgV00wX1BJUEVfQ1VSU09SX01BU0s7Ci0JCWFjdGl2ZS0+bGluZXRpbWUgPSBody0+d21f
bGluZXRpbWVbcGlwZV07CisJCWFjdGl2ZS0+bGluZXRpbWUgPSBSRUdfRklFTERfR0VUKEhTV19M
SU5FVElNRV9NQVNLLAorCQkJCQkJIGh3LT53bV9saW5ldGltZVtwaXBlXSk7CisJCWFjdGl2ZS0+
aXBzX2xpbmV0aW1lID0gUkVHX0ZJRUxEX0dFVChIU1dfSVBTX0xJTkVUSU1FX01BU0ssCisJCQkJ
CQkgICAgIGh3LT53bV9saW5ldGltZVtwaXBlXSk7CiAJfSBlbHNlIHsKIAkJaW50IGxldmVsLCBt
YXhfbGV2ZWwgPSBpbGtfd21fbWF4X2xldmVsKGRldl9wcml2KTsKIAotLSAKMi4yMS4wCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFp
bGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5m
cmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id DBC6AB8F28
	for <lists+intel-gfx@lfdr.de>; Fri, 20 Sep 2019 13:43:07 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A44C46FCA8;
	Fri, 20 Sep 2019 11:43:02 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 998446FC9B
 for <intel-gfx@lists.freedesktop.org>; Fri, 20 Sep 2019 11:42:43 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 20 Sep 2019 13:42:31 +0200
Message-Id: <20190920114235.22411-19-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190920114235.22411-1-maarten.lankhorst@linux.intel.com>
References: <20190920114235.22411-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 19/23] drm/i915: Prepare atomic plane check for
 bigjoiner planes
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QSBsb3Qgb2YgZGVsdGEsIHRoZSBtYWluIGRpZmZlcmVuY2UgaXMgdGhhdCB0aGUgbWFzdGVyX3Bs
YW5lX3N0YXRlIGlzCm5vdCB0aGUgc2FtZSBwbGFuZV9zdGF0ZSBhcyBiZWluZyB3cml0dGVuIHRv
LgoKV2UgcmVhZCBhbGwgcHJvcGVydGllcyBsaWtlIGNvbG9yIGtleSwgY3J0YywgZmIsIHJvdGF0
aW9uIGZyb20gdGhlCm1hc3Rlcl9wbGFuZV9zdGF0ZSBhbmQgY29vcmRpbmF0ZSBwcm9wZXJ0aWVz
LgoKVGhlIGNvb3JkaW5hdGUgcHJvcGVydGllcyBhcmUgZGlmZmVyZW50IGJldHdlZW4gdGhlIDIg
Ymlnam9pbmVyIHBsYW5lcywKYXMgb25lIGdldHMgdGhlIGxlZnQgYW5kIHRoZSBvdGhlciBnZXRz
IHRoZSByaWdodCBzaWRlLgoKRm9ydHVuYXRlbHkgdGhlIGRybSBjb3JlIGFscmVhZHkgaGFzIGEg
c3JjIGFuZCBkc3QgcmVjdCwgc28gd2Ugd3JpdGUKdGhvc2UgZm9yIGVhY2ggcGxhbmUgc2VwYXJh
dGVseS4KCkluIGNhc2Ugb2YgY3Vyc29yLCB3ZSBkb24ndCB1c2UgdGhlIGNsaXBwZWQgY29vcmRp
bmF0ZXMsIGJ1dCB0aGUgcmF3CnNvdXJjZSBjb29yZGluYXRlcyBmcm9tIHRoZSBtYXN0ZXJfcGxh
bmVfc3RhdGUgaW5zdGVhZC4KClNpZ25lZC1vZmYtYnk6IE1hYXJ0ZW4gTGFua2hvcnN0IDxtYWFy
dGVuLmxhbmtob3JzdEBsaW51eC5pbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9hdG9taWMuYyAgIHwgICA3ICstCiAuLi4vZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfYXRvbWljX3BsYW5lLmMgfCAgODggKysrKysrKy0KIC4uLi9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9hdG9taWNfcGxhbmUuaCB8ICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgIHwgMjEzICsrKysrKysrKystLS0tLS0tLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmggIHwgICA1ICstCiAuLi4v
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggICAgfCAgIDEgKwogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYyAgIHwgIDcxICsrKy0tLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuaCAgIHwgICA2ICstCiA4IGZp
bGVzIGNoYW5nZWQsIDI1OCBpbnNlcnRpb25zKCspLCAxNDEgZGVsZXRpb25zKC0pCgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljLmMKaW5kZXggMGRiMDQwNjRjODZl
Li5hOGYzNDI1NGNkMmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfYXRvbWljLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9h
dG9taWMuYwpAQCAtMjk3LDkgKzI5NywxMCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9hdG9taWNfc2V0
dXBfc2NhbGVyKHN0cnVjdCBpbnRlbF9jcnRjX3NjYWxlcl9zdGF0ZSAqc2NhbGVyX3N0YQogCQly
ZXR1cm47CiAKIAkvKiBzZXQgc2NhbGVyIG1vZGUgKi8KLQlpZiAocGxhbmVfc3RhdGUgJiYgcGxh
bmVfc3RhdGUtPmJhc2UuZmIgJiYKLQkgICAgcGxhbmVfc3RhdGUtPmJhc2UuZmItPmZvcm1hdC0+
aXNfeXV2ICYmCi0JICAgIHBsYW5lX3N0YXRlLT5iYXNlLmZiLT5mb3JtYXQtPm51bV9wbGFuZXMg
PiAxKSB7CisJaWYgKHBsYW5lX3N0YXRlICYmIChwbGFuZV9zdGF0ZS0+bGlua2VkX3BsYW5lIHx8
CisJICAgICAoIXBsYW5lX3N0YXRlLT5iaWdqb2luZXJfc2xhdmUgJiYgcGxhbmVfc3RhdGUtPmJh
c2UuZmIgJiYKKwkgICAgICBwbGFuZV9zdGF0ZS0+YmFzZS5mYi0+Zm9ybWF0LT5pc195dXYgJiYK
KwkgICAgICBwbGFuZV9zdGF0ZS0+YmFzZS5mYi0+Zm9ybWF0LT5udW1fcGxhbmVzID4gMSkpKSB7
CiAJCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0
ZS0+YmFzZS5wbGFuZSk7CiAJCWlmIChJU19HRU4oZGV2X3ByaXYsIDkpICYmCiAJCSAgICAhSVNf
R0VNSU5JTEFLRShkZXZfcHJpdikpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfYXRvbWljX3BsYW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2F0b21pY19wbGFuZS5jCmluZGV4IDVkYjA5MWU0YWQ2YS4uYTBjMWQxNjk2Yzhj
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19w
bGFuZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljX3Bs
YW5lLmMKQEAgLTExNSwxMCArMTE1LDExIEBAIGludGVsX3BsYW5lX2Rlc3Ryb3lfc3RhdGUoc3Ry
dWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJZHJtX2F0b21pY19oZWxwZXJfcGxhbmVfZGVzdHJveV9z
dGF0ZShwbGFuZSwgc3RhdGUpOwogfQogCi11bnNpZ25lZCBpbnQgaW50ZWxfcGxhbmVfZGF0YV9y
YXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAotCQkJCSAgIGNv
bnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCitzdGF0aWMgdW5zaWdu
ZWQgaW50IGludGVsX3BsYW5lX2RhdGFfcmF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKKwkJCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm1h
c3Rlcl9wbGFuZV9zdGF0ZSwKKwkJCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUg
KnBsYW5lX3N0YXRlKQogewotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxh
bmVfc3RhdGUtPmJhc2UuZmI7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBt
YXN0ZXJfcGxhbmVfc3RhdGUtPmJhc2UuZmI7CiAJdW5zaWduZWQgaW50IGNwcDsKIAogCWlmICgh
cGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkKQEAgLTE0Myw4ICsxNDQsMTIgQEAgaW50IGludGVs
X3BsYW5lX2F0b21pY19jaGVja193aXRoX3N0YXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpvbGRfY3J0Y18KIAkJCQkJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpvbGRf
cGxhbmVfc3RhdGUsCiAJCQkJCXN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqbmV3X3BsYW5lX3N0
YXRlKQogeworCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqbmV3X21hc3Rlcl9wbGFu
ZV9zdGF0ZSA9IG5ld19wbGFuZV9zdGF0ZTsKKwljb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3Rh
dGUgKm9sZF9tYXN0ZXJfcGxhbmVfc3RhdGUgPSBvbGRfcGxhbmVfc3RhdGU7CiAJc3RydWN0IGlu
dGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKG5ld19wbGFuZV9zdGF0ZS0+YmFzZS5w
bGFuZSk7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBuZXdfcGxhbmVfc3Rh
dGUtPmJhc2UuZmI7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmI7CisJc3RydWN0
IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUgPQorCQl0b19pbnRlbF9hdG9taWNfc3RhdGUobmV3
X3BsYW5lX3N0YXRlLT5iYXNlLnN0YXRlKTsKIAlpbnQgcmV0OwogCiAJbmV3X2NydGNfc3RhdGUt
PmFjdGl2ZV9wbGFuZXMgJj0gfkJJVChwbGFuZS0+aWQpOwpAQCAtMTUzLDEwICsxNTgsMjEgQEAg
aW50IGludGVsX3BsYW5lX2F0b21pY19jaGVja193aXRoX3N0YXRlKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpvbGRfY3J0Y18KIAluZXdfY3J0Y19zdGF0ZS0+ZGF0YV9yYXRlW3BsYW5l
LT5pZF0gPSAwOwogCW5ld19wbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlID0gZmFsc2U7CiAKLQlp
ZiAoIW5ld19wbGFuZV9zdGF0ZS0+YmFzZS5jcnRjICYmICFvbGRfcGxhbmVfc3RhdGUtPmJhc2Uu
Y3J0YykKKwlpZiAob2xkX3BsYW5lX3N0YXRlLT5iaWdqb2luZXJfc2xhdmUpCisJCW9sZF9tYXN0
ZXJfcGxhbmVfc3RhdGUgPQorCQkJaW50ZWxfYXRvbWljX2dldF9vbGRfcGxhbmVfc3RhdGUoc3Rh
dGUsCisJCQkJCW9sZF9wbGFuZV9zdGF0ZS0+Ymlnam9pbmVyX3BsYW5lKTsKKworCWlmIChuZXdf
cGxhbmVfc3RhdGUtPmJpZ2pvaW5lcl9zbGF2ZSkKKwkJbmV3X21hc3Rlcl9wbGFuZV9zdGF0ZSA9
CisJCQlpbnRlbF9hdG9taWNfZ2V0X25ld19wbGFuZV9zdGF0ZShzdGF0ZSwKKwkJCQkJbmV3X3Bs
YW5lX3N0YXRlLT5iaWdqb2luZXJfcGxhbmUpOworCisJaWYgKCFuZXdfbWFzdGVyX3BsYW5lX3N0
YXRlLT5iYXNlLmNydGMgJiYgIW9sZF9tYXN0ZXJfcGxhbmVfc3RhdGUtPmJhc2UuY3J0YykKIAkJ
cmV0dXJuIDA7CiAKLQlyZXQgPSBwbGFuZS0+Y2hlY2tfcGxhbmUobmV3X2NydGNfc3RhdGUsIG5l
d19wbGFuZV9zdGF0ZSk7CisJcmV0ID0gcGxhbmUtPmNoZWNrX3BsYW5lKG5ld19jcnRjX3N0YXRl
LAorCQkJCSBuZXdfbWFzdGVyX3BsYW5lX3N0YXRlLCBuZXdfcGxhbmVfc3RhdGUpOwogCWlmIChy
ZXQpCiAJCXJldHVybiByZXQ7CiAKQEAgLTE2NCw2ICsxODAsNyBAQCBpbnQgaW50ZWxfcGxhbmVf
YXRvbWljX2NoZWNrX3dpdGhfc3RhdGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9s
ZF9jcnRjXwogCWlmIChuZXdfcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkKIAkJbmV3X2NydGNf
c3RhdGUtPmFjdGl2ZV9wbGFuZXMgfD0gQklUKHBsYW5lLT5pZCk7CiAKKwlmYiA9IG5ld19tYXN0
ZXJfcGxhbmVfc3RhdGUtPmJhc2UuZmI7CiAJaWYgKG5ld19wbGFuZV9zdGF0ZS0+YmFzZS52aXNp
YmxlICYmCiAJICAgIGRybV9mb3JtYXRfaW5mb19pc195dXZfc2VtaXBsYW5hcihmYi0+Zm9ybWF0
KSkKIAkJbmV3X2NydGNfc3RhdGUtPm52MTJfcGxhbmVzIHw9IEJJVChwbGFuZS0+aWQpOwpAQCAt
MTc2LDEwICsxOTMsMTEgQEAgaW50IGludGVsX3BsYW5lX2F0b21pY19jaGVja193aXRoX3N0YXRl
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y18KIAkJbmV3X2NydGNfc3Rh
dGUtPnVwZGF0ZV9wbGFuZXMgfD0gQklUKHBsYW5lLT5pZCk7CiAKIAluZXdfY3J0Y19zdGF0ZS0+
ZGF0YV9yYXRlW3BsYW5lLT5pZF0gPQotCQlpbnRlbF9wbGFuZV9kYXRhX3JhdGUobmV3X2NydGNf
c3RhdGUsIG5ld19wbGFuZV9zdGF0ZSk7CisJCWludGVsX3BsYW5lX2RhdGFfcmF0ZShuZXdfY3J0
Y19zdGF0ZSwgbmV3X21hc3Rlcl9wbGFuZV9zdGF0ZSwgbmV3X3BsYW5lX3N0YXRlKTsKIAogCXJl
dHVybiBpbnRlbF9wbGFuZV9hdG9taWNfY2FsY19jaGFuZ2VzKG9sZF9jcnRjX3N0YXRlLCBuZXdf
Y3J0Y19zdGF0ZSwKLQkJCQkJICAgICAgIG9sZF9wbGFuZV9zdGF0ZSwgbmV3X3BsYW5lX3N0YXRl
KTsKKwkJCQkJICAgICAgIG9sZF9wbGFuZV9zdGF0ZSwgbmV3X21hc3Rlcl9wbGFuZV9zdGF0ZSwK
KwkJCQkJICAgICAgIG5ld19wbGFuZV9zdGF0ZSk7CiB9CiAKIHN0cnVjdCBpbnRlbF9jcnRjICoK
QEAgLTQ0MSw2ICs0NTksNjAgQEAgdm9pZCBpOXh4X3VwZGF0ZV9wbGFuZXNfb25fY3J0YyhzdHJ1
Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAl9CiB9CiAKKworaW50IGludGVsX2F0b21p
Y19wbGFuZV9jaGVja19zY2FsaW5nKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LAorCQkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICptYXN0ZXJfcGxhbmVf
c3RhdGUsCisJCQkJICAgICBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAor
CQkJCSAgICAgaW50IG1pbl9zY2FsZSwgaW50IG1heF9zY2FsZSkKK3sKKwlzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiA9IG1hc3Rlcl9wbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwlzdHJ1Y3QgZHJt
X3JlY3QgKnNyYyA9ICZwbGFuZV9zdGF0ZS0+YmFzZS5zcmM7CisJc3RydWN0IGRybV9yZWN0ICpk
c3QgPSAmcGxhbmVfc3RhdGUtPmJhc2UuZHN0OworCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IG1h
c3Rlcl9wbGFuZV9zdGF0ZS0+YmFzZS5yb3RhdGlvbjsKKwlzdHJ1Y3QgZHJtX3JlY3QgY2xpcCA9
IHt9OworCWludCBoc2NhbGUsIHZzY2FsZTsKKworCSpzcmMgPSBkcm1fcGxhbmVfc3RhdGVfc3Jj
KCZtYXN0ZXJfcGxhbmVfc3RhdGUtPmJhc2UpOworCSpkc3QgPSBkcm1fcGxhbmVfc3RhdGVfZGVz
dCgmbWFzdGVyX3BsYW5lX3N0YXRlLT5iYXNlKTsKKworCWlmICghZmIpIHsKKwkJcGxhbmVfc3Rh
dGUtPmJhc2UudmlzaWJsZSA9IGZhbHNlOworCQlyZXR1cm4gMDsKKwl9CisKKwlkcm1fcmVjdF9y
b3RhdGUoc3JjLCBmYi0+d2lkdGggPDwgMTYsIGZiLT5oZWlnaHQgPDwgMTYsIHJvdGF0aW9uKTsK
KworCS8qIENoZWNrIHNjYWxpbmcgKi8KKwloc2NhbGUgPSBkcm1fcmVjdF9jYWxjX2hzY2FsZShz
cmMsIGRzdCwgbWluX3NjYWxlLCBtYXhfc2NhbGUpOworCXZzY2FsZSA9IGRybV9yZWN0X2NhbGNf
dnNjYWxlKHNyYywgZHN0LCBtaW5fc2NhbGUsIG1heF9zY2FsZSk7CisJaWYgKGhzY2FsZSA8IDAg
fHwgdnNjYWxlIDwgMCkgeworCQlEUk1fREVCVUdfS01TKCJJbnZhbGlkIHNjYWxpbmcgb2YgcGxh
bmVcbiIpOworCQlkcm1fcmVjdF9kZWJ1Z19wcmludCgic3JjOiAiLCBzcmMsIHRydWUpOworCQlk
cm1fcmVjdF9kZWJ1Z19wcmludCgiZHN0OiAiLCBkc3QsIGZhbHNlKTsKKwkJcmV0dXJuIC1FUkFO
R0U7CisJfQorCisJaWYgKGNydGNfc3RhdGUtPmh3LmVuYWJsZSkgeworCQljbGlwLngyID0gY3J0
Y19zdGF0ZS0+cGlwZV9zcmNfdzsKKwkJY2xpcC55MiA9IGNydGNfc3RhdGUtPnBpcGVfc3JjX2g7
CisJfQorCisJLyogcmlnaHQgc2lkZSBvZiB0aGUgaW1hZ2UgaXMgb24gdGhlIHNsYXZlIGNydGMs
IGFkanVzdCBkc3QgdG8gbWF0Y2ggKi8KKwlpZiAoY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX3NsYXZl
KQorCQlkcm1fcmVjdF90cmFuc2xhdGUoZHN0LCAtY3J0Y19zdGF0ZS0+cGlwZV9zcmNfdywgMCk7
CisKKwkvKgorCSAqIEZJWE1FOiBUaGlzIG1pZ2h0IG5lZWQgZnVydGhlciBhZGp1c3RtZW50IGZv
ciBzZWFtbGVzcyBzY2FsaW5nCisJICogd2l0aCBwaGFzZSBpbmZvcm1hdGlvbiwgZm9yIHRoZSAy
cDIgYW5kIDJwMSBzY2VuYXJpb3MuCisJICovCisKKwlwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxl
ID0gZHJtX3JlY3RfY2xpcF9zY2FsZWQoc3JjLCBkc3QsICZjbGlwKTsKKworCWRybV9yZWN0X3Jv
dGF0ZV9pbnYoc3JjLCBmYi0+d2lkdGggPDwgMTYsIGZiLT5oZWlnaHQgPDwgMTYsIHJvdGF0aW9u
KTsKKworCXJldHVybiAwOworfQorCiBjb25zdCBzdHJ1Y3QgZHJtX3BsYW5lX2hlbHBlcl9mdW5j
cyBpbnRlbF9wbGFuZV9oZWxwZXJfZnVuY3MgPSB7CiAJLnByZXBhcmVfZmIgPSBpbnRlbF9wcmVw
YXJlX3BsYW5lX2ZiLAogCS5jbGVhbnVwX2ZiID0gaW50ZWxfY2xlYW51cF9wbGFuZV9mYiwKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljX3BsYW5l
LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19wbGFuZS5oCmlu
ZGV4IDFjZmZkYTJiNTBiNS4uYzk4Y2NmODExNGMzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19wbGFuZS5oCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljX3BsYW5lLmgKQEAgLTE4LDggKzE4LDYgQEAgc3Ry
dWN0IGludGVsX3BsYW5lX3N0YXRlOwogCiBleHRlcm4gY29uc3Qgc3RydWN0IGRybV9wbGFuZV9o
ZWxwZXJfZnVuY3MgaW50ZWxfcGxhbmVfaGVscGVyX2Z1bmNzOwogCi11bnNpZ25lZCBpbnQgaW50
ZWxfcGxhbmVfZGF0YV9yYXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAotCQkJCSAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUp
Owogdm9pZCBpbnRlbF91cGRhdGVfcGxhbmUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAkJ
CWNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJY29uc3Qgc3Ry
dWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSk7CkBAIC00MywxMCArNDEsMTYgQEAg
aW50IGludGVsX3BsYW5lX2F0b21pY19jaGVja193aXRoX3N0YXRlKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpvbGRfY3J0Y18KIGludCBpbnRlbF9wbGFuZV9hdG9taWNfY2FsY19jaGFu
Z2VzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0ZSwKIAkJCQkg
ICAgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkJICAgIGNvbnN0IHN0
cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqb2xkX3BsYW5lX3N0YXRlLAorCQkJCSAgICBjb25zdCBz
dHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm1hc3Rlcl9wbGFuZV9zdGF0ZSwKIAkJCQkgICAgc3Ry
dWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSk7CiBzdHJ1Y3QgaW50ZWxfY3J0YyAq
CiBpbnRlbF9wbGFuZV9nZXRfY3J0Y19mcm9tX3N0YXRlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0
YXRlICpzdGF0ZSwKIAkJCQkgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpvbGRfcGxh
bmVfc3RhdGUsCiAJCQkJIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqbmV3X3BsYW5l
X3N0YXRlKTsKIAoraW50IGludGVsX2F0b21pY19wbGFuZV9jaGVja19zY2FsaW5nKHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJCSAgICAgY29uc3Qgc3RydWN0IGludGVs
X3BsYW5lX3N0YXRlICptYXN0ZXJfcGxhbmVfc3RhdGUsCisJCQkJICAgICBzdHJ1Y3QgaW50ZWxf
cGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAorCQkJCSAgICAgaW50IG1pbl9zY2FsZSwgaW50IG1h
eF9zY2FsZSk7CisKICNlbmRpZiAvKiBfX0lOVEVMX0FUT01JQ19QTEFORV9IX18gKi8KZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggN2Y4NmMzNThj
ZjQ1Li42OTBjM2QxMGNlNDQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheS5jCkBAIC0yMjg5LDEyICsyMjg5LDEzIEBAIHN0YXRpYyB1MzIgaW50ZWxfYWRq
dXN0X2FsaWduZWRfb2Zmc2V0KGludCAqeCwgaW50ICp5LAogICogdGhlIHgveSBvZmZzZXRzLgog
ICovCiBzdGF0aWMgdTMyIGludGVsX3BsYW5lX2FkanVzdF9hbGlnbmVkX29mZnNldChpbnQgKngs
IGludCAqeSwKKwkJCQkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm1hc3Rl
cl9wbGFuZV9zdGF0ZSwKIAkJCQkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUg
KnN0YXRlLAogCQkJCQkgICAgIGludCBjb2xvcl9wbGFuZSwKIAkJCQkJICAgICB1MzIgb2xkX29m
ZnNldCwgdTMyIG5ld19vZmZzZXQpCiB7Ci0JcmV0dXJuIGludGVsX2FkanVzdF9hbGlnbmVkX29m
ZnNldCh4LCB5LCBzdGF0ZS0+YmFzZS5mYiwgY29sb3JfcGxhbmUsCi0JCQkJCSAgIHN0YXRlLT5i
YXNlLnJvdGF0aW9uLAorCXJldHVybiBpbnRlbF9hZGp1c3RfYWxpZ25lZF9vZmZzZXQoeCwgeSwg
bWFzdGVyX3BsYW5lX3N0YXRlLT5iYXNlLmZiLCBjb2xvcl9wbGFuZSwKKwkJCQkJICAgbWFzdGVy
X3BsYW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9uLAogCQkJCQkgICBzdGF0ZS0+Y29sb3JfcGxhbmVb
Y29sb3JfcGxhbmVdLnN0cmlkZSwKIAkJCQkJICAgb2xkX29mZnNldCwgbmV3X29mZnNldCk7CiB9
CkBAIC0yMzY1LDE0ICsyMzY2LDE1IEBAIHN0YXRpYyB1MzIgaW50ZWxfY29tcHV0ZV9hbGlnbmVk
X29mZnNldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiB9CiAKIHN0YXRpYyB1
MzIgaW50ZWxfcGxhbmVfY29tcHV0ZV9hbGlnbmVkX29mZnNldChpbnQgKngsIGludCAqeSwKLQkJ
CQkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpzdGF0ZSwKKwkJCQkJICAg
ICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICptYXN0ZXJfcGxhbmVfc3RhdGUsCisJ
CQkJCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCiAJ
CQkJCSAgICAgIGludCBjb2xvcl9wbGFuZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfcGxhbmUgKmludGVs
X3BsYW5lID0gdG9faW50ZWxfcGxhbmUoc3RhdGUtPmJhc2UucGxhbmUpOworCXN0cnVjdCBpbnRl
bF9wbGFuZSAqaW50ZWxfcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5w
bGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShpbnRl
bF9wbGFuZS0+YmFzZS5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0g
c3RhdGUtPmJhc2UuZmI7Ci0JdW5zaWduZWQgaW50IHJvdGF0aW9uID0gc3RhdGUtPmJhc2Uucm90
YXRpb247Ci0JaW50IHBpdGNoID0gc3RhdGUtPmNvbG9yX3BsYW5lW2NvbG9yX3BsYW5lXS5zdHJp
ZGU7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBtYXN0ZXJfcGxhbmVfc3Rh
dGUtPmJhc2UuZmI7CisJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gbWFzdGVyX3BsYW5lX3N0YXRl
LT5iYXNlLnJvdGF0aW9uOworCWludCBwaXRjaCA9IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtj
b2xvcl9wbGFuZV0uc3RyaWRlOwogCXUzMiBhbGlnbm1lbnQ7CiAKIAlpZiAoaW50ZWxfcGxhbmUt
PmlkID09IFBMQU5FX0NVUlNPUikKQEAgLTI1OTQsMTEgKzI1OTYsMTIgQEAgYm9vbCBpbnRlbF9w
bGFuZV9jYW5fcmVtYXAoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0
ZSkKIAlyZXR1cm4gdHJ1ZTsKIH0KIAotc3RhdGljIGJvb2wgaW50ZWxfcGxhbmVfbmVlZHNfcmVt
YXAoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKK3N0YXRpYyBi
b29sIGludGVsX3BsYW5lX25lZWRzX3JlbWFwKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0
ZSAqbWFzdGVyX3BsYW5lX3N0YXRlLAorCQkJCSAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVf
c3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19p
bnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7Ci0JY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKLQl1bnNpZ25lZCBpbnQgcm90
YXRpb24gPSBwbGFuZV9zdGF0ZS0+YmFzZS5yb3RhdGlvbjsKKwljb25zdCBzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiA9IG1hc3Rlcl9wbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwl1bnNpZ25lZCBp
bnQgcm90YXRpb24gPSBtYXN0ZXJfcGxhbmVfc3RhdGUtPmJhc2Uucm90YXRpb247CiAJdTMyIHN0
cmlkZSwgbWF4X3N0cmlkZTsKIAogCS8qCkBAIC0yNjA4LDcgKzI2MTEsNyBAQCBzdGF0aWMgYm9v
bCBpbnRlbF9wbGFuZV9uZWVkc19yZW1hcChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUg
KnBsYW5lX3N0YXRlKQogCWlmICghcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkKIAkJcmV0dXJu
IGZhbHNlOwogCi0JaWYgKCFpbnRlbF9wbGFuZV9jYW5fcmVtYXAocGxhbmVfc3RhdGUpKQorCWlm
ICghaW50ZWxfcGxhbmVfY2FuX3JlbWFwKG1hc3Rlcl9wbGFuZV9zdGF0ZSkpCiAJCXJldHVybiBm
YWxzZTsKIAogCS8qCkBAIC0yNzg4LDE0ICsyNzkxLDE1IEBAIGludGVsX2ZpbGxfZmJfaW5mbyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiB9CiAKIHN0YXRpYyB2b2lkCi1pbnRl
bF9wbGFuZV9yZW1hcF9ndHQoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkK
K2ludGVsX3BsYW5lX3JlbWFwX2d0dChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm1h
c3Rlcl9wbGFuZV9zdGF0ZSwKKwkJICAgICAgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFu
ZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQogCQl0b19p
OTE1KHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lLT5kZXYpOwotCXN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7CisJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAq
ZmIgPSBtYXN0ZXJfcGxhbmVfc3RhdGUtPmJhc2UuZmI7CiAJc3RydWN0IGludGVsX2ZyYW1lYnVm
ZmVyICppbnRlbF9mYiA9IHRvX2ludGVsX2ZyYW1lYnVmZmVyKGZiKTsKIAlzdHJ1Y3QgaW50ZWxf
cm90YXRpb25faW5mbyAqaW5mbyA9ICZwbGFuZV9zdGF0ZS0+dmlldy5yb3RhdGVkOwotCXVuc2ln
bmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9uOworCXVuc2lnbmVk
IGludCByb3RhdGlvbiA9IG1hc3Rlcl9wbGFuZV9zdGF0ZS0+YmFzZS5yb3RhdGlvbjsKIAlpbnQg
aSwgbnVtX3BsYW5lcyA9IGZiLT5mb3JtYXQtPm51bV9wbGFuZXM7CiAJdW5zaWduZWQgaW50IHRp
bGVfc2l6ZSA9IGludGVsX3RpbGVfc2l6ZShkZXZfcHJpdik7CiAJdW5zaWduZWQgaW50IHNyY194
LCBzcmNfeTsKQEAgLTI5MDEsMTEgKzI5MDUsMTIgQEAgaW50ZWxfcGxhbmVfcmVtYXBfZ3R0KHN0
cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB9CiAKIHN0YXRpYyBpbnQKLWlu
dGVsX3BsYW5lX2NvbXB1dGVfZ3R0KHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3Rh
dGUpCitpbnRlbF9wbGFuZV9jb21wdXRlX2d0dChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3Rh
dGUgKm1hc3Rlcl9wbGFuZV9zdGF0ZSwKKwkJCXN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxh
bmVfc3RhdGUpCiB7CiAJY29uc3Qgc3RydWN0IGludGVsX2ZyYW1lYnVmZmVyICpmYiA9Ci0JCXRv
X2ludGVsX2ZyYW1lYnVmZmVyKHBsYW5lX3N0YXRlLT5iYXNlLmZiKTsKLQl1bnNpZ25lZCBpbnQg
cm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+YmFzZS5yb3RhdGlvbjsKKwkJdG9faW50ZWxfZnJhbWVi
dWZmZXIobWFzdGVyX3BsYW5lX3N0YXRlLT5iYXNlLmZiKTsKKwl1bnNpZ25lZCBpbnQgcm90YXRp
b24gPSBtYXN0ZXJfcGxhbmVfc3RhdGUtPmJhc2Uucm90YXRpb247CiAJaW50IGksIG51bV9wbGFu
ZXM7CiAKIAlpZiAoIWZiKQpAQCAtMjkxMyw4ICsyOTE4LDggQEAgaW50ZWxfcGxhbmVfY29tcHV0
ZV9ndHQoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAogCW51bV9wbGFu
ZXMgPSBmYi0+YmFzZS5mb3JtYXQtPm51bV9wbGFuZXM7CiAKLQlpZiAoaW50ZWxfcGxhbmVfbmVl
ZHNfcmVtYXAocGxhbmVfc3RhdGUpKSB7Ci0JCWludGVsX3BsYW5lX3JlbWFwX2d0dChwbGFuZV9z
dGF0ZSk7CisJaWYgKGludGVsX3BsYW5lX25lZWRzX3JlbWFwKG1hc3Rlcl9wbGFuZV9zdGF0ZSwg
cGxhbmVfc3RhdGUpKSB7CisJCWludGVsX3BsYW5lX3JlbWFwX2d0dChtYXN0ZXJfcGxhbmVfc3Rh
dGUsIHBsYW5lX3N0YXRlKTsKIAogCQkvKgogCQkgKiBTb21ldGltZXMgZXZlbiByZW1hcHBpbmcg
Y2FuJ3Qgb3ZlcmNvbWUKQEAgLTI5MjIsNyArMjkyNyw3IEBAIGludGVsX3BsYW5lX2NvbXB1dGVf
Z3R0KHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJCSAqIGJpZyBwbGFu
ZSBzaXplcyBhbmQgc3VpdGFibHkgbWlzYWxpZ25lZAogCQkgKiBvZmZzZXRzLgogCQkgKi8KLQkJ
cmV0dXJuIGludGVsX3BsYW5lX2NoZWNrX3N0cmlkZShwbGFuZV9zdGF0ZSk7CisJCXJldHVybiBp
bnRlbF9wbGFuZV9jaGVja19zdHJpZGUobWFzdGVyX3BsYW5lX3N0YXRlLCBwbGFuZV9zdGF0ZSk7
CiAJfQogCiAJaW50ZWxfZmlsbF9mYl9nZ3R0X3ZpZXcoJnBsYW5lX3N0YXRlLT52aWV3LCAmZmIt
PmJhc2UsIHJvdGF0aW9uKTsKQEAgLTI5NDYsNyArMjk1MSw3IEBAIGludGVsX3BsYW5lX2NvbXB1
dGVfZ3R0KHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJCQkJZmItPmJh
c2Uud2lkdGggPDwgMTYsIGZiLT5iYXNlLmhlaWdodCA8PCAxNiwKIAkJCQlEUk1fTU9ERV9ST1RB
VEVfMjcwKTsKIAotCXJldHVybiBpbnRlbF9wbGFuZV9jaGVja19zdHJpZGUocGxhbmVfc3RhdGUp
OworCXJldHVybiBpbnRlbF9wbGFuZV9jaGVja19zdHJpZGUobWFzdGVyX3BsYW5lX3N0YXRlLCBw
bGFuZV9zdGF0ZSk7CiB9CiAKIHN0YXRpYyBpbnQgaTl4eF9mb3JtYXRfdG9fZm91cmNjKGludCBm
b3JtYXQpCkBAIC0zMzYzLDEwICszMzY4LDExIEBAIHN0YXRpYyBpbnQgaWNsX21heF9wbGFuZV9o
ZWlnaHQodm9pZCkKIAlyZXR1cm4gNDMyMDsKIH0KIAotc3RhdGljIGJvb2wgc2tsX2NoZWNrX21h
aW5fY2NzX2Nvb3JkaW5hdGVzKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUs
CitzdGF0aWMgYm9vbCBza2xfY2hlY2tfbWFpbl9jY3NfY29vcmRpbmF0ZXMoY29uc3Qgc3RydWN0
IGludGVsX3BsYW5lX3N0YXRlICptYXN0ZXJfcGxhbmVfc3RhdGUsCisJCQkJCSAgIHN0cnVjdCBp
bnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCiAJCQkJCSAgIGludCBtYWluX3gsIGludCBt
YWluX3ksIHUzMiBtYWluX29mZnNldCkKIHsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVy
ICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiID0gbWFzdGVyX3BsYW5lX3N0YXRlLT5iYXNlLmZiOwogCWludCBoc3ViID0gZmItPmZv
cm1hdC0+aHN1YjsKIAlpbnQgdnN1YiA9IGZiLT5mb3JtYXQtPnZzdWI7CiAJaW50IGF1eF94ID0g
cGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzFdLng7CkBAIC0zMzg1LDcgKzMzOTEsNyBAQCBzdGF0
aWMgYm9vbCBza2xfY2hlY2tfbWFpbl9jY3NfY29vcmRpbmF0ZXMoc3RydWN0IGludGVsX3BsYW5l
X3N0YXRlICpwbGFuZV9zdGF0ZQogCiAJCXggPSBhdXhfeCAvIGhzdWI7CiAJCXkgPSBhdXhfeSAv
IHZzdWI7Ci0JCWF1eF9vZmZzZXQgPSBpbnRlbF9wbGFuZV9hZGp1c3RfYWxpZ25lZF9vZmZzZXQo
JngsICZ5LCBwbGFuZV9zdGF0ZSwgMSwKKwkJYXV4X29mZnNldCA9IGludGVsX3BsYW5lX2FkanVz
dF9hbGlnbmVkX29mZnNldCgmeCwgJnksIG1hc3Rlcl9wbGFuZV9zdGF0ZSwgcGxhbmVfc3RhdGUs
IDEsCiAJCQkJCQkJICAgICAgIGF1eF9vZmZzZXQsIGF1eF9vZmZzZXQgLSBhbGlnbm1lbnQpOwog
CQlhdXhfeCA9IHggKiBoc3ViICsgYXV4X3ggJSBoc3ViOwogCQlhdXhfeSA9IHkgKiB2c3ViICsg
YXV4X3kgJSB2c3ViOwpAQCAtMzQwMSwxMSArMzQwNywxMiBAQCBzdGF0aWMgYm9vbCBza2xfY2hl
Y2tfbWFpbl9jY3NfY29vcmRpbmF0ZXMoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9z
dGF0ZQogCXJldHVybiB0cnVlOwogfQogCi1zdGF0aWMgaW50IHNrbF9jaGVja19tYWluX3N1cmZh
Y2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKK3N0YXRpYyBpbnQgc2ts
X2NoZWNrX21haW5fc3VyZmFjZShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm1hc3Rl
cl9wbGFuZV9zdGF0ZSwKKwkJCQkgIHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3Rh
dGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFu
ZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2KTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVy
ICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOwotCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBs
YW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9uOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIg
KmZiID0gbWFzdGVyX3BsYW5lX3N0YXRlLT5iYXNlLmZiOworCXVuc2lnbmVkIGludCByb3RhdGlv
biA9IG1hc3Rlcl9wbGFuZV9zdGF0ZS0+YmFzZS5yb3RhdGlvbjsKIAlpbnQgeCA9IHBsYW5lX3N0
YXRlLT5iYXNlLnNyYy54MSA+PiAxNjsKIAlpbnQgeSA9IHBsYW5lX3N0YXRlLT5iYXNlLnNyYy55
MSA+PiAxNjsKIAlpbnQgdyA9IGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMp
ID4+IDE2OwpAQCAtMzQzMyw3ICszNDQwLDcgQEAgc3RhdGljIGludCBza2xfY2hlY2tfbWFpbl9z
dXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJfQogCiAJaW50
ZWxfYWRkX2ZiX29mZnNldHMoJngsICZ5LCBwbGFuZV9zdGF0ZSwgMCk7Ci0Jb2Zmc2V0ID0gaW50
ZWxfcGxhbmVfY29tcHV0ZV9hbGlnbmVkX29mZnNldCgmeCwgJnksIHBsYW5lX3N0YXRlLCAwKTsK
KwlvZmZzZXQgPSBpbnRlbF9wbGFuZV9jb21wdXRlX2FsaWduZWRfb2Zmc2V0KCZ4LCAmeSwgbWFz
dGVyX3BsYW5lX3N0YXRlLCBwbGFuZV9zdGF0ZSwgMCk7CiAJYWxpZ25tZW50ID0gaW50ZWxfc3Vy
Zl9hbGlnbm1lbnQoZmIsIDApOwogCiAJLyoKQEAgLTM0NDIsNyArMzQ0OSw3IEBAIHN0YXRpYyBp
bnQgc2tsX2NoZWNrX21haW5fc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5l
X3N0YXRlKQogCSAqIHN1cmUgdGhhdCBpcyB3aGF0IHdlIHdpbGwgZ2V0LgogCSAqLwogCWlmIChv
ZmZzZXQgPiBhdXhfb2Zmc2V0KQotCQlvZmZzZXQgPSBpbnRlbF9wbGFuZV9hZGp1c3RfYWxpZ25l
ZF9vZmZzZXQoJngsICZ5LCBwbGFuZV9zdGF0ZSwgMCwKKwkJb2Zmc2V0ID0gaW50ZWxfcGxhbmVf
YWRqdXN0X2FsaWduZWRfb2Zmc2V0KCZ4LCAmeSwgbWFzdGVyX3BsYW5lX3N0YXRlLCBwbGFuZV9z
dGF0ZSwgMCwKIAkJCQkJCQkgICBvZmZzZXQsIGF1eF9vZmZzZXQgJiB+KGFsaWdubWVudCAtIDEp
KTsKIAogCS8qCkBAIC0zNDYwLDcgKzM0NjcsNyBAQCBzdGF0aWMgaW50IHNrbF9jaGVja19tYWlu
X3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAkJCQlyZXR1
cm4gLUVJTlZBTDsKIAkJCX0KIAotCQkJb2Zmc2V0ID0gaW50ZWxfcGxhbmVfYWRqdXN0X2FsaWdu
ZWRfb2Zmc2V0KCZ4LCAmeSwgcGxhbmVfc3RhdGUsIDAsCisJCQlvZmZzZXQgPSBpbnRlbF9wbGFu
ZV9hZGp1c3RfYWxpZ25lZF9vZmZzZXQoJngsICZ5LCBtYXN0ZXJfcGxhbmVfc3RhdGUsIHBsYW5l
X3N0YXRlLCAwLAogCQkJCQkJCQkgICBvZmZzZXQsIG9mZnNldCAtIGFsaWdubWVudCk7CiAJCX0K
IAl9CkBAIC0zNDcwLDExICszNDc3LDExIEBAIHN0YXRpYyBpbnQgc2tsX2NoZWNrX21haW5fc3Vy
ZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCSAqIHRoZXkgbWF0
Y2ggd2l0aCB0aGUgbWFpbiBzdXJmYWNlIHgveSBvZmZzZXRzLgogCSAqLwogCWlmIChpc19jY3Nf
bW9kaWZpZXIoZmItPm1vZGlmaWVyKSkgewotCQl3aGlsZSAoIXNrbF9jaGVja19tYWluX2Njc19j
b29yZGluYXRlcyhwbGFuZV9zdGF0ZSwgeCwgeSwgb2Zmc2V0KSkgeworCQl3aGlsZSAoIXNrbF9j
aGVja19tYWluX2Njc19jb29yZGluYXRlcyhtYXN0ZXJfcGxhbmVfc3RhdGUsIHBsYW5lX3N0YXRl
LCB4LCB5LCBvZmZzZXQpKSB7CiAJCQlpZiAob2Zmc2V0ID09IDApCiAJCQkJYnJlYWs7CiAKLQkJ
CW9mZnNldCA9IGludGVsX3BsYW5lX2FkanVzdF9hbGlnbmVkX29mZnNldCgmeCwgJnksIHBsYW5l
X3N0YXRlLCAwLAorCQkJb2Zmc2V0ID0gaW50ZWxfcGxhbmVfYWRqdXN0X2FsaWduZWRfb2Zmc2V0
KCZ4LCAmeSwgbWFzdGVyX3BsYW5lX3N0YXRlLCBwbGFuZV9zdGF0ZSwgMCwKIAkJCQkJCQkJICAg
b2Zmc2V0LCBvZmZzZXQgLSBhbGlnbm1lbnQpOwogCQl9CiAKQEAgLTM0OTksMTAgKzM1MDYsMTEg
QEAgc3RhdGljIGludCBza2xfY2hlY2tfbWFpbl9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9z
dGF0ZSAqcGxhbmVfc3RhdGUpCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgc2tsX2NoZWNr
X252MTJfYXV4X3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkK
K3N0YXRpYyBpbnQgc2tsX2NoZWNrX252MTJfYXV4X3N1cmZhY2UoY29uc3Qgc3RydWN0IGludGVs
X3BsYW5lX3N0YXRlICptYXN0ZXJfcGxhbmVfc3RhdGUsCisJCQkJICAgICAgc3RydWN0IGludGVs
X3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOwotCXVuc2lnbmVkIGludCByb3RhdGlvbiA9
IHBsYW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9uOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiID0gbWFzdGVyX3BsYW5lX3N0YXRlLT5iYXNlLmZiOworCXVuc2lnbmVkIGludCByb3Rh
dGlvbiA9IG1hc3Rlcl9wbGFuZV9zdGF0ZS0+YmFzZS5yb3RhdGlvbjsKIAlpbnQgbWF4X3dpZHRo
ID0gc2tsX21heF9wbGFuZV93aWR0aChmYiwgMSwgcm90YXRpb24pOwogCWludCBtYXhfaGVpZ2h0
ID0gNDA5NjsKIAlpbnQgeCA9IHBsYW5lX3N0YXRlLT5iYXNlLnNyYy54MSA+PiAxNzsKQEAgLTM1
MTIsNyArMzUyMCw3IEBAIHN0YXRpYyBpbnQgc2tsX2NoZWNrX252MTJfYXV4X3N1cmZhY2Uoc3Ry
dWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAl1MzIgb2Zmc2V0OwogCiAJaW50
ZWxfYWRkX2ZiX29mZnNldHMoJngsICZ5LCBwbGFuZV9zdGF0ZSwgMSk7Ci0Jb2Zmc2V0ID0gaW50
ZWxfcGxhbmVfY29tcHV0ZV9hbGlnbmVkX29mZnNldCgmeCwgJnksIHBsYW5lX3N0YXRlLCAxKTsK
KwlvZmZzZXQgPSBpbnRlbF9wbGFuZV9jb21wdXRlX2FsaWduZWRfb2Zmc2V0KCZ4LCAmeSwgbWFz
dGVyX3BsYW5lX3N0YXRlLCBwbGFuZV9zdGF0ZSwgMSk7CiAKIAkvKiBGSVhNRSBub3QgcXVpdGUg
c3VyZSBob3cvaWYgdGhlc2UgYXBwbHkgdG8gdGhlIGNocm9tYSBwbGFuZSAqLwogCWlmICh3ID4g
bWF4X3dpZHRoIHx8IGggPiBtYXhfaGVpZ2h0KSB7CkBAIC0zNTI4LDcgKzM1MzYsOCBAQCBzdGF0
aWMgaW50IHNrbF9jaGVja19udjEyX2F1eF9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0
ZSAqcGxhbmVfc3RhdGUpCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgc2tsX2NoZWNrX2Nj
c19hdXhfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQorc3Rh
dGljIGludCBza2xfY2hlY2tfY2NzX2F1eF9zdXJmYWNlKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFu
ZV9zdGF0ZSAqbWFzdGVyX3BsYW5lX3N0YXRlLAorCQkJCSAgICAgc3RydWN0IGludGVsX3BsYW5l
X3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpm
YiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOwogCWludCBzcmNfeCA9IHBsYW5lX3N0YXRlLT5iYXNl
LnNyYy54MSA+PiAxNjsKQEAgLTM1NDAsNyArMzU0OSw3IEBAIHN0YXRpYyBpbnQgc2tsX2NoZWNr
X2Njc19hdXhfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQog
CXUzMiBvZmZzZXQ7CiAKIAlpbnRlbF9hZGRfZmJfb2Zmc2V0cygmeCwgJnksIHBsYW5lX3N0YXRl
LCAxKTsKLQlvZmZzZXQgPSBpbnRlbF9wbGFuZV9jb21wdXRlX2FsaWduZWRfb2Zmc2V0KCZ4LCAm
eSwgcGxhbmVfc3RhdGUsIDEpOworCW9mZnNldCA9IGludGVsX3BsYW5lX2NvbXB1dGVfYWxpZ25l
ZF9vZmZzZXQoJngsICZ5LCBtYXN0ZXJfcGxhbmVfc3RhdGUsIHBsYW5lX3N0YXRlLCAxKTsKIAog
CXBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVsxXS5vZmZzZXQgPSBvZmZzZXQ7CiAJcGxhbmVfc3Rh
dGUtPmNvbG9yX3BsYW5lWzFdLnggPSB4ICogaHN1YiArIHNyY194ICUgaHN1YjsKQEAgLTM1NDks
MTIgKzM1NTgsMTMgQEAgc3RhdGljIGludCBza2xfY2hlY2tfY2NzX2F1eF9zdXJmYWNlKHN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJcmV0dXJuIDA7CiB9CiAKLWludCBz
a2xfY2hlY2tfcGxhbmVfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0
YXRlKQoraW50IHNrbF9jaGVja19wbGFuZV9zdXJmYWNlKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFu
ZV9zdGF0ZSAqbWFzdGVyX3BsYW5lX3N0YXRlLAorCQkJICAgIHN0cnVjdCBpbnRlbF9wbGFuZV9z
dGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIg
PSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpm
YiA9IG1hc3Rlcl9wbGFuZV9zdGF0ZS0+YmFzZS5mYjsKIAlpbnQgcmV0OwogCi0JcmV0ID0gaW50
ZWxfcGxhbmVfY29tcHV0ZV9ndHQocGxhbmVfc3RhdGUpOworCXJldCA9IGludGVsX3BsYW5lX2Nv
bXB1dGVfZ3R0KG1hc3Rlcl9wbGFuZV9zdGF0ZSwgcGxhbmVfc3RhdGUpOwogCWlmIChyZXQpCiAJ
CXJldHVybiByZXQ7CiAKQEAgLTM1NjYsMTEgKzM1NzYsMTEgQEAgaW50IHNrbF9jaGVja19wbGFu
ZV9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJICogdGhl
IG1haW4gc3VyZmFjZSBzZXR1cCBkZXBlbmRzIG9uIGl0LgogCSAqLwogCWlmIChkcm1fZm9ybWF0
X2luZm9faXNfeXV2X3NlbWlwbGFuYXIoZmItPmZvcm1hdCkpIHsKLQkJcmV0ID0gc2tsX2NoZWNr
X252MTJfYXV4X3N1cmZhY2UocGxhbmVfc3RhdGUpOworCQlyZXQgPSBza2xfY2hlY2tfbnYxMl9h
dXhfc3VyZmFjZShtYXN0ZXJfcGxhbmVfc3RhdGUsIHBsYW5lX3N0YXRlKTsKIAkJaWYgKHJldCkK
IAkJCXJldHVybiByZXQ7CiAJfSBlbHNlIGlmIChpc19jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVy
KSkgewotCQlyZXQgPSBza2xfY2hlY2tfY2NzX2F1eF9zdXJmYWNlKHBsYW5lX3N0YXRlKTsKKwkJ
cmV0ID0gc2tsX2NoZWNrX2Njc19hdXhfc3VyZmFjZShtYXN0ZXJfcGxhbmVfc3RhdGUsIHBsYW5l
X3N0YXRlKTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiByZXQ7CiAJfSBlbHNlIHsKQEAgLTM1Nzks
MTEgKzM1ODksNyBAQCBpbnQgc2tsX2NoZWNrX3BsYW5lX3N1cmZhY2Uoc3RydWN0IGludGVsX3Bs
YW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAkJcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzFdLnkg
PSAwOwogCX0KIAotCXJldCA9IHNrbF9jaGVja19tYWluX3N1cmZhY2UocGxhbmVfc3RhdGUpOwot
CWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KLQlyZXR1cm4gMDsKKwlyZXR1cm4gc2tsX2NoZWNr
X21haW5fc3VyZmFjZShtYXN0ZXJfcGxhbmVfc3RhdGUsIHBsYW5lX3N0YXRlKTsKIH0KIAogdW5z
aWduZWQgaW50CkBAIC0zNjk0LDcgKzM3MDAsNyBAQCBpbnQgaTl4eF9jaGVja19wbGFuZV9zdXJm
YWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJdTMyIG9mZnNldDsK
IAlpbnQgcmV0OwogCi0JcmV0ID0gaW50ZWxfcGxhbmVfY29tcHV0ZV9ndHQocGxhbmVfc3RhdGUp
OworCXJldCA9IGludGVsX3BsYW5lX2NvbXB1dGVfZ3R0KHBsYW5lX3N0YXRlLCBwbGFuZV9zdGF0
ZSk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIApAQCAtMzcwOCw2ICszNzE0LDcgQEAgaW50
IGk5eHhfY2hlY2tfcGxhbmVfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5l
X3N0YXRlKQogCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gNCkKIAkJb2Zmc2V0ID0gaW50
ZWxfcGxhbmVfY29tcHV0ZV9hbGlnbmVkX29mZnNldCgmc3JjX3gsICZzcmNfeSwKKwkJCQkJCQkg
ICAgcGxhbmVfc3RhdGUsCiAJCQkJCQkJICAgIHBsYW5lX3N0YXRlLCAwKTsKIAllbHNlCiAJCW9m
ZnNldCA9IDA7CkBAIC0zNzU5LDYgKzM3NjYsNyBAQCBzdGF0aWMgYm9vbCBpOXh4X3BsYW5lX2hh
c193aW5kb3dpbmcoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSkKIAogc3RhdGljIGludAogaTl4
eF9wbGFuZV9jaGVjayhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJIGNv
bnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqbWFzdGVyX3BsYW5lX3N0YXRlLAogCQkgc3Ry
dWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfcGxh
bmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOwpAQCAt
Mzc4NCw3ICszNzkyLDcgQEAgaTl4eF9wbGFuZV9jaGVjayhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKIAlpZiAoIXBsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUpCiAJCXJldHVy
biAwOwogCi0JcmV0ID0gaW50ZWxfcGxhbmVfY2hlY2tfc3JjX2Nvb3JkaW5hdGVzKHBsYW5lX3N0
YXRlKTsKKwlyZXQgPSBpbnRlbF9wbGFuZV9jaGVja19zcmNfY29vcmRpbmF0ZXMobWFzdGVyX3Bs
YW5lX3N0YXRlLCBwbGFuZV9zdGF0ZSk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIApAQCAt
NTU0OSwxMiArNTU1NywxMyBAQCBpbnQgc2tsX3VwZGF0ZV9zY2FsZXJfY3J0YyhzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqc3RhdGUpCiAgKiAgICBlcnJvciAtIHJlcXVlc3RlZCBzY2FsaW5nIGNh
bm5vdCBiZSBzdXBwb3J0ZWQgb3Igb3RoZXIgZXJyb3IgY29uZGl0aW9uCiAgKi8KIHN0YXRpYyBp
bnQgc2tsX3VwZGF0ZV9zY2FsZXJfcGxhbmUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCisJCQkJICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICptYXN0ZXJfcGxh
bmVfc3RhdGUsCiAJCQkJICAgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkK
IHsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKmludGVsX3BsYW5lID0KIAkJdG9faW50ZWxfcGxhbmUo
cGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoaW50ZWxfcGxhbmUtPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCXN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiID0gbWFzdGVyX3BsYW5lX3N0YXRlLT5iYXNlLmZiOwogCWludCByZXQ7CiAJYm9vbCBm
b3JjZV9kZXRhY2ggPSAhZmIgfHwgIXBsYW5lX3N0YXRlLT5iYXNlLnZpc2libGU7CiAJYm9vbCBu
ZWVkX3NjYWxlciA9IGZhbHNlOwpAQCAtNTU3Nyw3ICs1NTg2LDcgQEAgc3RhdGljIGludCBza2xf
dXBkYXRlX3NjYWxlcl9wbGFuZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwK
IAkJcmV0dXJuIHJldDsKIAogCS8qIGNoZWNrIGNvbG9ya2V5ICovCi0JaWYgKHBsYW5lX3N0YXRl
LT5ja2V5LmZsYWdzKSB7CisJaWYgKG1hc3Rlcl9wbGFuZV9zdGF0ZS0+Y2tleS5mbGFncykgewog
CQlEUk1fREVCVUdfS01TKCJbUExBTkU6JWQ6JXNdIHNjYWxpbmcgd2l0aCBjb2xvciBrZXkgbm90
IGFsbG93ZWQiLAogCQkJICAgICAgaW50ZWxfcGxhbmUtPmJhc2UuYmFzZS5pZCwKIAkJCSAgICAg
IGludGVsX3BsYW5lLT5iYXNlLm5hbWUpOwpAQCAtMTA2NjIsMTEgKzEwNjcxLDEyIEBAIHN0YXRp
YyBib29sIGhhc3dlbGxfZ2V0X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAog
CXJldHVybiBhY3RpdmU7CiB9CiAKLXN0YXRpYyB1MzIgaW50ZWxfY3Vyc29yX2Jhc2UoY29uc3Qg
c3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKK3N0YXRpYyB1MzIgaW50ZWxf
Y3Vyc29yX2Jhc2UoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICptYXN0ZXJfcGxhbmVf
c3RhdGUsCisJCQkgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3Rh
dGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KIAkJdG9faTkxNShw
bGFuZV9zdGF0ZS0+YmFzZS5wbGFuZS0+ZGV2KTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVi
dWZmZXIgKmZiID0gbWFzdGVyX3BsYW5lX3N0YXRlLT5iYXNlLmZiOwogCWNvbnN0IHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSBpbnRlbF9mYl9vYmooZmIpOwogCXUzMiBiYXNlOwog
CkBAIC0xMDY3OSwxOSArMTA2ODksMjQgQEAgc3RhdGljIHUzMiBpbnRlbF9jdXJzb3JfYmFzZShj
b25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCiAJLyogSUxLKyBk
byB0aGlzIGF1dG9tYWdpY2FsbHkgKi8KIAlpZiAoSEFTX0dNQ0goZGV2X3ByaXYpICYmCi0JICAg
IHBsYW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9uICYgRFJNX01PREVfUk9UQVRFXzE4MCkKLQkJYmFz
ZSArPSAocGxhbmVfc3RhdGUtPmJhc2UuY3J0Y19oICoKLQkJCSBwbGFuZV9zdGF0ZS0+YmFzZS5j
cnRjX3cgLSAxKSAqIGZiLT5mb3JtYXQtPmNwcFswXTsKKwkgICAgbWFzdGVyX3BsYW5lX3N0YXRl
LT5iYXNlLnJvdGF0aW9uICYgRFJNX01PREVfUk9UQVRFXzE4MCkKKwkJYmFzZSArPSAobWFzdGVy
X3BsYW5lX3N0YXRlLT5iYXNlLmNydGNfaCAqCisJCQkgbWFzdGVyX3BsYW5lX3N0YXRlLT5iYXNl
LmNydGNfdyAtIDEpICogZmItPmZvcm1hdC0+Y3BwWzBdOwogCiAJcmV0dXJuIGJhc2U7CiB9CiAK
LXN0YXRpYyB1MzIgaW50ZWxfY3Vyc29yX3Bvc2l0aW9uKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFu
ZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCitzdGF0aWMgdTMyIGludGVsX2N1cnNvcl9wb3NpdGlvbihj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCQkgY29uc3Qgc3Ry
dWN0IGludGVsX3BsYW5lX3N0YXRlICptYXN0ZXJfcGxhbmVfc3RhdGUsCisJCQkJIGNvbnN0IHN0
cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0JaW50IHggPSBwbGFuZV9z
dGF0ZS0+YmFzZS5jcnRjX3g7Ci0JaW50IHkgPSBwbGFuZV9zdGF0ZS0+YmFzZS5jcnRjX3k7CisJ
aW50IHggPSBtYXN0ZXJfcGxhbmVfc3RhdGUtPmJhc2UuY3J0Y194OworCWludCB5ID0gbWFzdGVy
X3BsYW5lX3N0YXRlLT5iYXNlLmNydGNfeTsKIAl1MzIgcG9zID0gMDsKIAorCWlmIChwbGFuZV9z
dGF0ZS0+Ymlnam9pbmVyX3NsYXZlKQorCQl4IC09IGNydGNfc3RhdGUtPnBpcGVfc3JjX3c7CisK
IAlpZiAoeCA8IDApIHsKIAkJcG9zIHw9IENVUlNPUl9QT1NfU0lHTiA8PCBDVVJTT1JfWF9TSElG
VDsKIAkJeCA9IC14OwpAQCAtMTA3MTgsMTMgKzEwNzMzLDE0IEBAIHN0YXRpYyBib29sIGludGVs
X2N1cnNvcl9zaXplX29rKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3Rh
dGUpCiAJCWhlaWdodCA+IDAgJiYgaGVpZ2h0IDw9IGNvbmZpZy0+Y3Vyc29yX2hlaWdodDsKIH0K
IAotc3RhdGljIGludCBpbnRlbF9jdXJzb3JfY2hlY2tfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGUgKnBsYW5lX3N0YXRlKQorc3RhdGljIGludCBpbnRlbF9jdXJzb3JfY2hlY2tfc3Vy
ZmFjZShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm1hc3Rlcl9wbGFuZV9zdGF0ZSwK
KwkJCQkgICAgICBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCWlu
dCBzcmNfeCwgc3JjX3k7CiAJdTMyIG9mZnNldDsKIAlpbnQgcmV0OwogCi0JcmV0ID0gaW50ZWxf
cGxhbmVfY29tcHV0ZV9ndHQocGxhbmVfc3RhdGUpOworCXJldCA9IGludGVsX3BsYW5lX2NvbXB1
dGVfZ3R0KG1hc3Rlcl9wbGFuZV9zdGF0ZSwgcGxhbmVfc3RhdGUpOwogCWlmIChyZXQpCiAJCXJl
dHVybiByZXQ7CiAKQEAgLTEwNzM2LDYgKzEwNzUyLDcgQEAgc3RhdGljIGludCBpbnRlbF9jdXJz
b3JfY2hlY2tfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQog
CiAJaW50ZWxfYWRkX2ZiX29mZnNldHMoJnNyY194LCAmc3JjX3ksIHBsYW5lX3N0YXRlLCAwKTsK
IAlvZmZzZXQgPSBpbnRlbF9wbGFuZV9jb21wdXRlX2FsaWduZWRfb2Zmc2V0KCZzcmNfeCwgJnNy
Y195LAorCQkJCQkJICAgIG1hc3Rlcl9wbGFuZV9zdGF0ZSwKIAkJCQkJCSAgICBwbGFuZV9zdGF0
ZSwgMCk7CiAKIAlpZiAoc3JjX3ggIT0gMCB8fCBzcmNfeSAhPSAwKSB7CkBAIC0xMDc0OSw2ICsx
MDc2Niw3IEBAIHN0YXRpYyBpbnQgaW50ZWxfY3Vyc29yX2NoZWNrX3N1cmZhY2Uoc3RydWN0IGlu
dGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIH0KIAogc3RhdGljIGludCBpbnRlbF9jaGVj
a19jdXJzb3Ioc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkgICAgICBj
b25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm1hc3Rlcl9wbGFuZV9zdGF0ZSwKIAkJCSAg
ICAgIHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJY29uc3Qgc3Ry
dWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKQEAgLTEwNzU5
LDIyICsxMDc3NywyMSBAQCBzdGF0aWMgaW50IGludGVsX2NoZWNrX2N1cnNvcihzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJcmV0dXJuIC1FSU5WQUw7CiAJfQogCi0JcmV0
ID0gZHJtX2F0b21pY19oZWxwZXJfY2hlY2tfcGxhbmVfc3RhdGUoJnBsYW5lX3N0YXRlLT5iYXNl
LAotCQkJCQkJICAmY3J0Y19zdGF0ZS0+dWFwaSwKLQkJCQkJCSAgRFJNX1BMQU5FX0hFTFBFUl9O
T19TQ0FMSU5HLAotCQkJCQkJICBEUk1fUExBTkVfSEVMUEVSX05PX1NDQUxJTkcsCi0JCQkJCQkg
IHRydWUsIHRydWUpOworCXJldCA9IGludGVsX2F0b21pY19wbGFuZV9jaGVja19zY2FsaW5nKGNy
dGNfc3RhdGUsIG1hc3Rlcl9wbGFuZV9zdGF0ZSwKKwkJCQkJICAgICAgIHBsYW5lX3N0YXRlLAor
CQkJCQkgICAgICAgRFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FMSU5HLAorCQkJCQkgICAgICAgRFJN
X1BMQU5FX0hFTFBFUl9OT19TQ0FMSU5HKTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0J
cmV0ID0gaW50ZWxfY3Vyc29yX2NoZWNrX3N1cmZhY2UocGxhbmVfc3RhdGUpOworCXJldCA9IGlu
dGVsX2N1cnNvcl9jaGVja19zdXJmYWNlKG1hc3Rlcl9wbGFuZV9zdGF0ZSwgcGxhbmVfc3RhdGUp
OwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKIAlpZiAoIXBsYW5lX3N0YXRlLT5iYXNlLnZp
c2libGUpCiAJCXJldHVybiAwOwogCi0JcmV0ID0gaW50ZWxfcGxhbmVfY2hlY2tfc3JjX2Nvb3Jk
aW5hdGVzKHBsYW5lX3N0YXRlKTsKKwlyZXQgPSBpbnRlbF9wbGFuZV9jaGVja19zcmNfY29vcmRp
bmF0ZXMobWFzdGVyX3BsYW5lX3N0YXRlLCBwbGFuZV9zdGF0ZSk7CiAJaWYgKHJldCkKIAkJcmV0
dXJuIHJldDsKIApAQCAtMTA4MTksMTIgKzEwODM2LDEzIEBAIHN0YXRpYyBib29sIGk4NDVfY3Vy
c29yX3NpemVfb2soY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkK
IH0KIAogc3RhdGljIGludCBpODQ1X2NoZWNrX2N1cnNvcihzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKKwkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpt
YXN0ZXJfcGxhbmVfc3RhdGUsCiAJCQkgICAgIHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxh
bmVfc3RhdGUpCiB7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9z
dGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IG1hc3Rl
cl9wbGFuZV9zdGF0ZS0+YmFzZS5mYjsKIAlpbnQgcmV0OwogCi0JcmV0ID0gaW50ZWxfY2hlY2tf
Y3Vyc29yKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKTsKKwlyZXQgPSBpbnRlbF9jaGVja19jdXJz
b3IoY3J0Y19zdGF0ZSwgbWFzdGVyX3BsYW5lX3N0YXRlLCBwbGFuZV9zdGF0ZSk7CiAJaWYgKHJl
dCkKIAkJcmV0dXJuIHJldDsKIApAQCAtMTA4NzcsOCArMTA4OTUsOCBAQCBzdGF0aWMgdm9pZCBp
ODQ1X3VwZGF0ZV9jdXJzb3Ioc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAogCQlzaXplID0g
KGhlaWdodCA8PCAxMikgfCB3aWR0aDsKIAotCQliYXNlID0gaW50ZWxfY3Vyc29yX2Jhc2UocGxh
bmVfc3RhdGUpOwotCQlwb3MgPSBpbnRlbF9jdXJzb3JfcG9zaXRpb24ocGxhbmVfc3RhdGUpOwor
CQliYXNlID0gaW50ZWxfY3Vyc29yX2Jhc2UocGxhbmVfc3RhdGUsIHBsYW5lX3N0YXRlKTsKKwkJ
cG9zID0gaW50ZWxfY3Vyc29yX3Bvc2l0aW9uKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlLCBwbGFu
ZV9zdGF0ZSk7CiAJfQogCiAJc3Bpbl9sb2NrX2lycXNhdmUoJmRldl9wcml2LT51bmNvcmUubG9j
aywgaXJxZmxhZ3MpOwpAQCAtMTEwMzIsMTUgKzExMDUwLDE2IEBAIHN0YXRpYyBib29sIGk5eHhf
Y3Vyc29yX3NpemVfb2soY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0
ZSkKIH0KIAogc3RhdGljIGludCBpOXh4X2NoZWNrX2N1cnNvcihzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICptYXN0ZXJfcGxhbmVfc3RhdGUsCiAJCQkgICAgIHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3Bs
YW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJt
X2ZyYW1lYnVmZmVyICpmYiA9IG1hc3Rlcl9wbGFuZV9zdGF0ZS0+YmFzZS5mYjsKIAllbnVtIHBp
cGUgcGlwZSA9IHBsYW5lLT5waXBlOwogCWludCByZXQ7CiAKLQlyZXQgPSBpbnRlbF9jaGVja19j
dXJzb3IoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOworCXJldCA9IGludGVsX2NoZWNrX2N1cnNv
cihjcnRjX3N0YXRlLCBtYXN0ZXJfcGxhbmVfc3RhdGUsIHBsYW5lX3N0YXRlKTsKIAlpZiAocmV0
KQogCQlyZXR1cm4gcmV0OwogCkBAIC0xMTA0OSwxNyArMTEwNjgsMTcgQEAgc3RhdGljIGludCBp
OXh4X2NoZWNrX2N1cnNvcihzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJ
cmV0dXJuIDA7CiAKIAkvKiBDaGVjayBmb3Igd2hpY2ggY3Vyc29yIHR5cGVzIHdlIHN1cHBvcnQg
Ki8KLQlpZiAoIWk5eHhfY3Vyc29yX3NpemVfb2socGxhbmVfc3RhdGUpKSB7CisJaWYgKCFpOXh4
X2N1cnNvcl9zaXplX29rKG1hc3Rlcl9wbGFuZV9zdGF0ZSkpIHsKIAkJRFJNX0RFQlVHKCJDdXJz
b3IgZGltZW5zaW9uICVkeCVkIG5vdCBzdXBwb3J0ZWRcbiIsCi0JCQkgIHBsYW5lX3N0YXRlLT5i
YXNlLmNydGNfdywKLQkJCSAgcGxhbmVfc3RhdGUtPmJhc2UuY3J0Y19oKTsKKwkJCSAgbWFzdGVy
X3BsYW5lX3N0YXRlLT5iYXNlLmNydGNfdywKKwkJCSAgbWFzdGVyX3BsYW5lX3N0YXRlLT5iYXNl
LmNydGNfaCk7CiAJCXJldHVybiAtRUlOVkFMOwogCX0KIAogCVdBUk5fT04ocGxhbmVfc3RhdGUt
PmJhc2UudmlzaWJsZSAmJgotCQlwbGFuZV9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0uc3RyaWRlICE9
IGZiLT5waXRjaGVzWzBdKTsKKwkJbWFzdGVyX3BsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVswXS5z
dHJpZGUgIT0gZmItPnBpdGNoZXNbMF0pOwogCi0JaWYgKGZiLT5waXRjaGVzWzBdICE9IHBsYW5l
X3N0YXRlLT5iYXNlLmNydGNfdyAqIGZiLT5mb3JtYXQtPmNwcFswXSkgeworCWlmIChmYi0+cGl0
Y2hlc1swXSAhPSBtYXN0ZXJfcGxhbmVfc3RhdGUtPmJhc2UuY3J0Y193ICogZmItPmZvcm1hdC0+
Y3BwWzBdKSB7CiAJCURSTV9ERUJVR19LTVMoIkludmFsaWQgY3Vyc29yIHN0cmlkZSAoJXUpIChj
dXJzb3Igd2lkdGggJWQpXG4iLAogCQkJICAgICAgZmItPnBpdGNoZXNbMF0sIHBsYW5lX3N0YXRl
LT5iYXNlLmNydGNfdyk7CiAJCXJldHVybiAtRUlOVkFMOwpAQCAtMTEwNzYsMTkgKzExMDk1LDIw
IEBAIHN0YXRpYyBpbnQgaTl4eF9jaGVja19jdXJzb3Ioc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUsCiAJICogUmVmdXNlIHRoZSBwdXQgdGhlIGN1cnNvciBpbnRvIHRoYXQgY29t
cHJvbWlzZWQgcG9zaXRpb24uCiAJICovCiAJaWYgKElTX0NIRVJSWVZJRVcoZGV2X3ByaXYpICYm
IHBpcGUgPT0gUElQRV9DICYmCi0JICAgIHBsYW5lX3N0YXRlLT5iYXNlLnZpc2libGUgJiYgcGxh
bmVfc3RhdGUtPmJhc2UuY3J0Y194IDwgMCkgeworCSAgICBwbGFuZV9zdGF0ZS0+YmFzZS52aXNp
YmxlICYmIG1hc3Rlcl9wbGFuZV9zdGF0ZS0+YmFzZS5jcnRjX3ggPCAwKSB7CiAJCURSTV9ERUJV
R19LTVMoIkNIViBjdXJzb3IgQyBub3QgYWxsb3dlZCB0byBzdHJhZGRsZSB0aGUgbGVmdCBzY3Jl
ZW4gZWRnZVxuIik7CiAJCXJldHVybiAtRUlOVkFMOwogCX0KIAotCXBsYW5lX3N0YXRlLT5jdGwg
PSBpOXh4X2N1cnNvcl9jdGwoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOworCXBsYW5lX3N0YXRl
LT5jdGwgPSBpOXh4X2N1cnNvcl9jdGwoY3J0Y19zdGF0ZSwgbWFzdGVyX3BsYW5lX3N0YXRlKTsK
IAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgdm9pZCBpOXh4X3VwZGF0ZV9jdXJzb3Ioc3RydWN0
IGludGVsX3BsYW5lICpwbGFuZSwKLQkJCSAgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSwKLQkJCSAgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3Rh
dGUgKnBsYW5lX3N0YXRlKQorc3RhdGljIHZvaWQgaTl4eF91cGRhdGVfY3Vyc29yX3NsYXZlKHN0
cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCisJCQkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCQkgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9z
dGF0ZSAqbWFzdGVyX3BsYW5lX3N0YXRlLAorCQkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX3Bs
YW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBwbGFu
ZS0+cGlwZTsKQEAgLTExMDk5LDExICsxMTExOSwxMSBAQCBzdGF0aWMgdm9pZCBpOXh4X3VwZGF0
ZV9jdXJzb3Ioc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAkJY250bCA9IHBsYW5lX3N0YXRl
LT5jdGwgfAogCQkJaTl4eF9jdXJzb3JfY3RsX2NydGMoY3J0Y19zdGF0ZSk7CiAKLQkJaWYgKHBs
YW5lX3N0YXRlLT5iYXNlLmNydGNfaCAhPSBwbGFuZV9zdGF0ZS0+YmFzZS5jcnRjX3cpCi0JCQlm
YmNfY3RsID0gQ1VSX0ZCQ19DVExfRU4gfCAocGxhbmVfc3RhdGUtPmJhc2UuY3J0Y19oIC0gMSk7
CisJCWlmIChtYXN0ZXJfcGxhbmVfc3RhdGUtPmJhc2UuY3J0Y19oICE9IG1hc3Rlcl9wbGFuZV9z
dGF0ZS0+YmFzZS5jcnRjX3cpCisJCQlmYmNfY3RsID0gQ1VSX0ZCQ19DVExfRU4gfCAobWFzdGVy
X3BsYW5lX3N0YXRlLT5iYXNlLmNydGNfaCAtIDEpOwogCi0JCWJhc2UgPSBpbnRlbF9jdXJzb3Jf
YmFzZShwbGFuZV9zdGF0ZSk7Ci0JCXBvcyA9IGludGVsX2N1cnNvcl9wb3NpdGlvbihwbGFuZV9z
dGF0ZSk7CisJCWJhc2UgPSBpbnRlbF9jdXJzb3JfYmFzZShtYXN0ZXJfcGxhbmVfc3RhdGUsIHBs
YW5lX3N0YXRlKTsKKwkJcG9zID0gaW50ZWxfY3Vyc29yX3Bvc2l0aW9uKGNydGNfc3RhdGUsIG1h
c3Rlcl9wbGFuZV9zdGF0ZSwgcGxhbmVfc3RhdGUpOwogCX0KIAogCXNwaW5fbG9ja19pcnFzYXZl
KCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGlycWZsYWdzKTsKQEAgLTExMTUxLDEwICsxMTE3MSwx
NyBAQCBzdGF0aWMgdm9pZCBpOXh4X3VwZGF0ZV9jdXJzb3Ioc3RydWN0IGludGVsX3BsYW5lICpw
bGFuZSwKIAlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZkZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGly
cWZsYWdzKTsKIH0KIAorc3RhdGljIHZvaWQgaTl4eF91cGRhdGVfY3Vyc29yKHN0cnVjdCBpbnRl
bF9wbGFuZSAqcGxhbmUsCisJCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUsCisJCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpw
bGFuZV9zdGF0ZSkKK3sKKwlpOXh4X3VwZGF0ZV9jdXJzb3Jfc2xhdmUocGxhbmUsIGNydGNfc3Rh
dGUsIHBsYW5lX3N0YXRlLCBwbGFuZV9zdGF0ZSk7Cit9CisKIHN0YXRpYyB2b2lkIGk5eHhfZGlz
YWJsZV9jdXJzb3Ioc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAkJCQljb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlpOXh4X3VwZGF0ZV9jdXJzb3IocGxh
bmUsIGNydGNfc3RhdGUsIE5VTEwpOworCWk5eHhfdXBkYXRlX2N1cnNvcl9zbGF2ZShwbGFuZSwg
Y3J0Y19zdGF0ZSwgTlVMTCwgTlVMTCk7CiB9CiAKIHN0YXRpYyBib29sIGk5eHhfY3Vyc29yX2dl
dF9od19zdGF0ZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLApAQCAtMTE2NjIsNiArMTE2ODks
NyBAQCBzdGF0aWMgYm9vbCBuZWVkc19zY2FsaW5nKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9z
dGF0ZSAqc3RhdGUpCiBpbnQgaW50ZWxfcGxhbmVfYXRvbWljX2NhbGNfY2hhbmdlcyhjb25zdCBz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUsCiAJCQkJICAgIHN0cnVjdCBp
bnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCSAgICBjb25zdCBzdHJ1Y3QgaW50ZWxf
cGxhbmVfc3RhdGUgKm9sZF9wbGFuZV9zdGF0ZSwKKwkJCQkgICAgY29uc3Qgc3RydWN0IGludGVs
X3BsYW5lX3N0YXRlICptYXN0ZXJfcGxhbmVfc3RhdGUsCiAJCQkJICAgIHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0
b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CkBAIC0xMTY3NCw3ICsxMTcwMiw3
IEBAIGludCBpbnRlbF9wbGFuZV9hdG9taWNfY2FsY19jaGFuZ2VzKGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpvbGRfY3J0Y19zdGF0CiAJaW50IHJldDsKIAogCWlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDkgJiYgcGxhbmUtPmlkICE9IFBMQU5FX0NVUlNPUikgewotCQlyZXQgPSBz
a2xfdXBkYXRlX3NjYWxlcl9wbGFuZShjcnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7CisJCXJldCA9
IHNrbF91cGRhdGVfc2NhbGVyX3BsYW5lKGNydGNfc3RhdGUsIG1hc3Rlcl9wbGFuZV9zdGF0ZSwg
cGxhbmVfc3RhdGUpOwogCQlpZiAocmV0KQogCQkJcmV0dXJuIHJldDsKIAl9CkBAIC0xNTI2OSw3
ICsxNTI5Nyw3IEBAIGludGVsX2xlZ2FjeV9jdXJzb3JfdXBkYXRlKHN0cnVjdCBkcm1fcGxhbmUg
KnBsYW5lLAogCSAqIHdhaXQgZm9yIGl0IHRvIGNvbXBsZXRlIGluIHRoZSBzbG93cGF0aAogCSAq
LwogCWlmICghY3J0Y19zdGF0ZS0+aHcuYWN0aXZlIHx8IG5lZWRzX21vZGVzZXQoY3J0Y19zdGF0
ZSkgfHwKLQkgICAgY3J0Y19zdGF0ZS0+dXBkYXRlX3BpcGUpCisJICAgIGNydGNfc3RhdGUtPnVw
ZGF0ZV9waXBlIHx8IGNydGNfc3RhdGUtPmJpZ2pvaW5lcikKIAkJZ290byBzbG93OwogCiAJb2xk
X3BsYW5lX3N0YXRlID0gcGxhbmUtPnN0YXRlOwpAQCAtMTU1MzksNiArMTU1NjcsNyBAQCBpbnRl
bF9jdXJzb3JfcGxhbmVfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
IAl9IGVsc2UgewogCQljdXJzb3ItPm1heF9zdHJpZGUgPSBpOXh4X2N1cnNvcl9tYXhfc3RyaWRl
OwogCQljdXJzb3ItPnVwZGF0ZV9wbGFuZSA9IGk5eHhfdXBkYXRlX2N1cnNvcjsKKwkJY3Vyc29y
LT51cGRhdGVfc2xhdmUgPSBpOXh4X3VwZGF0ZV9jdXJzb3Jfc2xhdmU7CiAJCWN1cnNvci0+ZGlz
YWJsZV9wbGFuZSA9IGk5eHhfZGlzYWJsZV9jdXJzb3I7CiAJCWN1cnNvci0+Z2V0X2h3X3N0YXRl
ID0gaTl4eF9jdXJzb3JfZ2V0X2h3X3N0YXRlOwogCQljdXJzb3ItPmNoZWNrX3BsYW5lID0gaTl4
eF9jaGVja19jdXJzb3I7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXkuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlz
cGxheS5oCmluZGV4IDc2NGQwNWQxM2I5ZS4uYThiMjE5OGZjZWYxIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuaAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuaApAQCAtNTYyLDggKzU2Miw5IEBAIHUz
MiBza2xfcGxhbmVfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
LAogdTMyIHNrbF9wbGFuZV9jdGxfY3J0Yyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSk7CiB1MzIgc2tsX3BsYW5lX3N0cmlkZShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGUgKm1hc3Rlcl9wbGFuZV9zdGF0ZSwKIAkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxf
cGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAotCQkgICAgIGludCBwbGFuZSk7Ci1pbnQgc2tsX2No
ZWNrX3BsYW5lX3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSk7
CisJCSAgICAgaW50IGNvbG9yX3BsYW5lKTsKK2ludCBza2xfY2hlY2tfcGxhbmVfc3VyZmFjZShj
b25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm1hc3Rlcl9wbGFuZV9zdGF0ZSwKKwkJCSAg
ICBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKTsKIGludCBpOXh4X2NoZWNr
X3BsYW5lX3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSk7CiBp
bnQgc2tsX2Zvcm1hdF90b19mb3VyY2MoaW50IGZvcm1hdCwgYm9vbCByZ2Jfb3JkZXIsIGJvb2wg
YWxwaGEpOwogdW5zaWduZWQgaW50IGk5eHhfcGxhbmVfbWF4X3N0cmlkZShzdHJ1Y3QgaW50ZWxf
cGxhbmUgKnBsYW5lLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kaXNwbGF5X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2Rpc3BsYXlfdHlwZXMuaAppbmRleCBmMDVmNDgzMGE1MjkuLjE1NGZiMDdhNjJlYiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgK
QEAgLTExMTcsNiArMTExNyw3IEBAIHN0cnVjdCBpbnRlbF9wbGFuZSB7CiAJCQkgICAgICBjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7CiAJYm9vbCAoKmdldF9od19z
dGF0ZSkoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwgZW51bSBwaXBlICpwaXBlKTsKIAlpbnQg
KCpjaGVja19wbGFuZSkoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkg
ICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm1hc3Rlcl9wbGFuZV9zdGF0ZSwKIAkJ
CSAgIHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpOwogfTsKIApkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMKaW5kZXggOTMzN2Y1YThkY2Uw
Li4wMGQ1ZjdlYjBjMjkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfc3ByaXRlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9z
cHJpdGUuYwpAQCAtMjUwLDExICsyNTAsMTIgQEAgdm9pZCBpbnRlbF9waXBlX3VwZGF0ZV9lbmQo
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlLAogI2VuZGlmCiB9CiAKLWlu
dCBpbnRlbF9wbGFuZV9jaGVja19zdHJpZGUoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICpwbGFuZV9zdGF0ZSkKK2ludCBpbnRlbF9wbGFuZV9jaGVja19zdHJpZGUoY29uc3Qgc3RydWN0
IGludGVsX3BsYW5lX3N0YXRlICptYXN0ZXJfcGxhbmVfc3RhdGUsCisJCQkgICAgIGNvbnN0IHN0
cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX3Bs
YW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKLQlj
b25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOwot
CXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9uOworCWNv
bnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gbWFzdGVyX3BsYW5lX3N0YXRlLT5iYXNl
LmZiOworCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IG1hc3Rlcl9wbGFuZV9zdGF0ZS0+YmFzZS5y
b3RhdGlvbjsKIAl1MzIgc3RyaWRlLCBtYXhfc3RyaWRlOwogCiAJLyoKQEAgLTI2Myw3ICsyNjQs
NyBAQCBpbnQgaW50ZWxfcGxhbmVfY2hlY2tfc3RyaWRlKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFu
ZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJICogd2l0aCBhIGZhbHNlIHBvc2l0aXZlIHdoZW4gdGhl
IHJlbWFwcGluZyBkaWRuJ3QKIAkgKiBraWNrIGluIGR1ZSB0aGUgcGxhbmUgYmVpbmcgaW52aXNp
YmxlLgogCSAqLwotCWlmIChpbnRlbF9wbGFuZV9jYW5fcmVtYXAocGxhbmVfc3RhdGUpICYmCisJ
aWYgKGludGVsX3BsYW5lX2Nhbl9yZW1hcChtYXN0ZXJfcGxhbmVfc3RhdGUpICYmCiAJICAgICFw
bGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKQogCQlyZXR1cm4gMDsKIApAQCAtMjgyLDEyICsyODMs
MTMgQEAgaW50IGludGVsX3BsYW5lX2NoZWNrX3N0cmlkZShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCXJldHVybiAwOwogfQogCi1pbnQgaW50ZWxfcGxhbmVf
Y2hlY2tfc3JjX2Nvb3JkaW5hdGVzKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3Rh
dGUpCitpbnQgaW50ZWxfcGxhbmVfY2hlY2tfc3JjX2Nvb3JkaW5hdGVzKGNvbnN0IHN0cnVjdCBp
bnRlbF9wbGFuZV9zdGF0ZSAqbWFzdGVyX3BsYW5lX3N0YXRlLAorCQkJCSAgICAgIHN0cnVjdCBp
bnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFt
ZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiA9IG1hc3Rlcl9wbGFuZV9zdGF0ZS0+YmFzZS5mYjsKIAlzdHJ1Y3QgZHJt
X3JlY3QgKnNyYyA9ICZwbGFuZV9zdGF0ZS0+YmFzZS5zcmM7CiAJdTMyIHNyY194LCBzcmNfeSwg
c3JjX3csIHNyY19oLCBoc3ViLCB2c3ViOwotCWJvb2wgcm90YXRlZCA9IGRybV9yb3RhdGlvbl85
MF9vcl8yNzAocGxhbmVfc3RhdGUtPmJhc2Uucm90YXRpb24pOworCWJvb2wgcm90YXRlZCA9IGRy
bV9yb3RhdGlvbl85MF9vcl8yNzAobWFzdGVyX3BsYW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9uKTsK
IAogCS8qCiAJICogSGFyZHdhcmUgZG9lc24ndCBoYW5kbGUgc3VicGl4ZWwgY29vcmRpbmF0ZXMu
CkBAIC0xNTc0LDYgKzE1NzYsNyBAQCBnNHhfc3ByaXRlX2NoZWNrX3NjYWxpbmcoc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAKIHN0YXRpYyBpbnQKIGc0eF9zcHJpdGVfY2hl
Y2soc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCSBjb25zdCBzdHJ1Y3Qg
aW50ZWxfcGxhbmVfc3RhdGUgKm1hc3Rlcl9wbGFuZV9zdGF0ZSwKIAkJIHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9
IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKQEAgLTE1OTIsMTAgKzE1
OTUsOSBAQCBnNHhfc3ByaXRlX2NoZWNrKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAogCQl9CiAJfQogCi0JcmV0ID0gZHJtX2F0b21pY19oZWxwZXJfY2hlY2tfcGxhbmVfc3Rh
dGUoJnBsYW5lX3N0YXRlLT5iYXNlLAotCQkJCQkJICAmY3J0Y19zdGF0ZS0+dWFwaSwKLQkJCQkJ
CSAgbWluX3NjYWxlLCBtYXhfc2NhbGUsCi0JCQkJCQkgIHRydWUsIHRydWUpOworCXJldCA9IGlu
dGVsX2F0b21pY19wbGFuZV9jaGVja19zY2FsaW5nKGNydGNfc3RhdGUsCisJCQkJCSAgICAgICBt
YXN0ZXJfcGxhbmVfc3RhdGUsIHBsYW5lX3N0YXRlLAorCQkJCQkgICAgICAgbWluX3NjYWxlLCBt
YXhfc2NhbGUpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKQEAgLTE2MDYsNyArMTYwOCw3
IEBAIGc0eF9zcHJpdGVfY2hlY2soc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUs
CiAJaWYgKCFwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKQogCQlyZXR1cm4gMDsKIAotCXJldCA9
IGludGVsX3BsYW5lX2NoZWNrX3NyY19jb29yZGluYXRlcyhwbGFuZV9zdGF0ZSk7CisJcmV0ID0g
aW50ZWxfcGxhbmVfY2hlY2tfc3JjX2Nvb3JkaW5hdGVzKG1hc3Rlcl9wbGFuZV9zdGF0ZSwgcGxh
bmVfc3RhdGUpOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKQEAgLTE2NDEsNiArMTY0Myw3
IEBAIGludCBjaHZfcGxhbmVfY2hlY2tfcm90YXRpb24oY29uc3Qgc3RydWN0IGludGVsX3BsYW5l
X3N0YXRlICpwbGFuZV9zdGF0ZSkKIAogc3RhdGljIGludAogdmx2X3Nwcml0ZV9jaGVjayhzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJIGNvbnN0IHN0cnVjdCBpbnRlbF9w
bGFuZV9zdGF0ZSAqbWFzdGVyX3BsYW5lX3N0YXRlLAogCQkgc3RydWN0IGludGVsX3BsYW5lX3N0
YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlpbnQgcmV0OwpAQCAtMTY0OSwxMSArMTY1MiwxMCBAQCB2
bHZfc3ByaXRlX2NoZWNrKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCWlm
IChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlyZXQgPSBkcm1fYXRvbWljX2hlbHBlcl9jaGVja19w
bGFuZV9zdGF0ZSgmcGxhbmVfc3RhdGUtPmJhc2UsCi0JCQkJCQkgICZjcnRjX3N0YXRlLT51YXBp
LAotCQkJCQkJICBEUk1fUExBTkVfSEVMUEVSX05PX1NDQUxJTkcsCi0JCQkJCQkgIERSTV9QTEFO
RV9IRUxQRVJfTk9fU0NBTElORywKLQkJCQkJCSAgdHJ1ZSwgdHJ1ZSk7CisJcmV0ID0gaW50ZWxf
YXRvbWljX3BsYW5lX2NoZWNrX3NjYWxpbmcoY3J0Y19zdGF0ZSwKKwkJCQkJICAgICAgIG1hc3Rl
cl9wbGFuZV9zdGF0ZSwgcGxhbmVfc3RhdGUsCisJCQkJCSAgICAgICBEUk1fUExBTkVfSEVMUEVS
X05PX1NDQUxJTkcsCisJCQkJCSAgICAgICBEUk1fUExBTkVfSEVMUEVSX05PX1NDQUxJTkcpOwog
CWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKQEAgLTE2NjQsNyArMTY2Niw3IEBAIHZsdl9zcHJp
dGVfY2hlY2soc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJaWYgKCFwbGFu
ZV9zdGF0ZS0+YmFzZS52aXNpYmxlKQogCQlyZXR1cm4gMDsKIAotCXJldCA9IGludGVsX3BsYW5l
X2NoZWNrX3NyY19jb29yZGluYXRlcyhwbGFuZV9zdGF0ZSk7CisJcmV0ID0gaW50ZWxfcGxhbmVf
Y2hlY2tfc3JjX2Nvb3JkaW5hdGVzKG1hc3Rlcl9wbGFuZV9zdGF0ZSwgcGxhbmVfc3RhdGUpOwog
CWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKQEAgLTE3NzcsMTAgKzE3NzksMTEgQEAgc3RhdGlj
IGludCBza2xfcGxhbmVfY2hlY2tfZHN0X2Nvb3JkaW5hdGVzKGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3MKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGludCBza2xfcGxhbmVf
Y2hlY2tfbnYxMl9yb3RhdGlvbihjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5l
X3N0YXRlKQorc3RhdGljIGludCBza2xfcGxhbmVfY2hlY2tfbnYxMl9yb3RhdGlvbihjb25zdCBz
dHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm1hc3Rlcl9wbGFuZV9zdGF0ZSwKKwkJCQkJIGNvbnN0
IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0JY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKLQl1bnNpZ25lZCBp
bnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+YmFzZS5yb3RhdGlvbjsKKwljb25zdCBzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiA9IG1hc3Rlcl9wbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwl1bnNp
Z25lZCBpbnQgcm90YXRpb24gPSBtYXN0ZXJfcGxhbmVfc3RhdGUtPmJhc2Uucm90YXRpb247CiAJ
aW50IHNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7
CiAKIAkvKiBEaXNwbGF5IFdBICMxMTA2ICovCkBAIC0xNzk1LDMzICsxNzk4LDM3IEBAIHN0YXRp
YyBpbnQgc2tsX3BsYW5lX2NoZWNrX252MTJfcm90YXRpb24oY29uc3Qgc3RydWN0IGludGVsX3Bs
YW5lX3N0YXRlICpwbGFuZV9zCiB9CiAKIHN0YXRpYyBpbnQgc2tsX3BsYW5lX2NoZWNrKHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkJICAgY29uc3Qgc3RydWN0IGludGVs
X3BsYW5lX3N0YXRlICptYXN0ZXJfcGxhbmVfc3RhdGUsCiAJCQkgICBzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0
b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwotCWNvbnN0IHN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7CisJY29uc3Qg
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBtYXN0ZXJfcGxhbmVfc3RhdGUtPmJhc2UuZmI7
CiAJaW50IG1pbl9zY2FsZSA9IERSTV9QTEFORV9IRUxQRVJfTk9fU0NBTElORzsKIAlpbnQgbWF4
X3NjYWxlID0gRFJNX1BMQU5FX0hFTFBFUl9OT19TQ0FMSU5HOwogCWludCByZXQ7CiAKKwkvKgor
CSAqIGl0J3Mgb2sgdG8gY2hlY2sgc2xhdmUgcGxhbmVfc3RhdGUgaGVyZSwgbWFzdGVyX3BsYW5l
X3N0YXRlIGlzIGFscmVhZHkgY2hlY2tlZAorCSAqIGluIGl0cyBvd24gc2tsX3BsYW5lX2NoZWNr
IGNhbGwuCisJICovCiAJcmV0ID0gc2tsX3BsYW5lX2NoZWNrX2ZiKGNydGNfc3RhdGUsIHBsYW5l
X3N0YXRlKTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCiAJLyogdXNlIHNjYWxlciB3aGVu
IGNvbG9ya2V5IGlzIG5vdCByZXF1aXJlZCAqLwotCWlmICghcGxhbmVfc3RhdGUtPmNrZXkuZmxh
Z3MgJiYgaW50ZWxfZmJfc2NhbGFibGUoZmIpKSB7CisJaWYgKCFtYXN0ZXJfcGxhbmVfc3RhdGUt
PmNrZXkuZmxhZ3MgJiYgaW50ZWxfZmJfc2NhbGFibGUoZmIpKSB7CiAJCW1pbl9zY2FsZSA9IDE7
CiAJCW1heF9zY2FsZSA9IHNrbF9tYXhfc2NhbGUoY3J0Y19zdGF0ZSwgZmItPmZvcm1hdCk7CiAJ
fQogCi0JcmV0ID0gZHJtX2F0b21pY19oZWxwZXJfY2hlY2tfcGxhbmVfc3RhdGUoJnBsYW5lX3N0
YXRlLT5iYXNlLAotCQkJCQkJICAmY3J0Y19zdGF0ZS0+dWFwaSwKLQkJCQkJCSAgbWluX3NjYWxl
LCBtYXhfc2NhbGUsCi0JCQkJCQkgIHRydWUsIHRydWUpOworCXJldCA9IGludGVsX2F0b21pY19w
bGFuZV9jaGVja19zY2FsaW5nKGNydGNfc3RhdGUsCisJCQkJCSAgICAgICBtYXN0ZXJfcGxhbmVf
c3RhdGUsIHBsYW5lX3N0YXRlLAorCQkJCQkgICAgICAgbWluX3NjYWxlLCBtYXhfc2NhbGUpOwog
CWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlyZXQgPSBza2xfY2hlY2tfcGxhbmVfc3VyZmFj
ZShwbGFuZV9zdGF0ZSk7CisJcmV0ID0gc2tsX2NoZWNrX3BsYW5lX3N1cmZhY2UobWFzdGVyX3Bs
YW5lX3N0YXRlLCBwbGFuZV9zdGF0ZSk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIApAQCAt
MTgzMiwxMSArMTgzOSwxMSBAQCBzdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVjayhzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0J
cmV0ID0gaW50ZWxfcGxhbmVfY2hlY2tfc3JjX2Nvb3JkaW5hdGVzKHBsYW5lX3N0YXRlKTsKKwly
ZXQgPSBpbnRlbF9wbGFuZV9jaGVja19zcmNfY29vcmRpbmF0ZXMobWFzdGVyX3BsYW5lX3N0YXRl
LCBwbGFuZV9zdGF0ZSk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAotCXJldCA9IHNrbF9w
bGFuZV9jaGVja19udjEyX3JvdGF0aW9uKHBsYW5lX3N0YXRlKTsKKwlyZXQgPSBza2xfcGxhbmVf
Y2hlY2tfbnYxMl9yb3RhdGlvbihtYXN0ZXJfcGxhbmVfc3RhdGUsIHBsYW5lX3N0YXRlKTsKIAlp
ZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCkBAIC0xODQ0LDExICsxODUxLDExIEBAIHN0YXRpYyBp
bnQgc2tsX3BsYW5lX2NoZWNrKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAog
CWlmICghKHBsYW5lX3N0YXRlLT5iYXNlLmFscGhhID4+IDgpKQogCQlwbGFuZV9zdGF0ZS0+YmFz
ZS52aXNpYmxlID0gZmFsc2U7CiAKLQlwbGFuZV9zdGF0ZS0+Y3RsID0gc2tsX3BsYW5lX2N0bChj
cnRjX3N0YXRlLCBwbGFuZV9zdGF0ZSk7CisJcGxhbmVfc3RhdGUtPmN0bCA9IHNrbF9wbGFuZV9j
dGwoY3J0Y19zdGF0ZSwgbWFzdGVyX3BsYW5lX3N0YXRlKTsKIAogCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDEwIHx8IElTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKQogCQlwbGFuZV9zdGF0ZS0+
Y29sb3JfY3RsID0gZ2xrX3BsYW5lX2NvbG9yX2N0bChjcnRjX3N0YXRlLAotCQkJCQkJCSAgICAg
cGxhbmVfc3RhdGUpOworCQkJCQkJCSAgICAgbWFzdGVyX3BsYW5lX3N0YXRlKTsKIAogCWlmIChp
Y2xfaXNfaGRyX3BsYW5lKGRldl9wcml2LCBwbGFuZS0+aWQpICYmIGZiLT5mb3JtYXQtPmlzX3l1
dikKIAkJLyogRW5hYmxlIGFuZCB1c2UgTVBFRy0yIGNocm9tYSBzaXRpbmcgKi8KZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmggYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5oCmluZGV4IDZkZjYyZmFlOTM2OC4u
NDUzYjE1M2IzMDNlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX3Nwcml0ZS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3By
aXRlLmgKQEAgLTI2LDggKzI2LDEwIEBAIGludCBpbnRlbF9zcHJpdGVfc2V0X2NvbG9ya2V5X2lv
Y3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiB2b2lkIGludGVsX3BpcGVf
dXBkYXRlX3N0YXJ0KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0
ZSk7CiB2b2lkIGludGVsX3BpcGVfdXBkYXRlX2VuZChzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
bmV3X2NydGNfc3RhdGUsCiAJCQkgICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqc2xhdmVfY3J0
Y19zdGF0ZSk7Ci1pbnQgaW50ZWxfcGxhbmVfY2hlY2tfc3RyaWRlKGNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpOwotaW50IGludGVsX3BsYW5lX2NoZWNrX3NyY19j
b29yZGluYXRlcyhzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKTsKK2ludCBp
bnRlbF9wbGFuZV9jaGVja19zdHJpZGUoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpt
YXN0ZXJfcGxhbmVfc3RhdGUsCisJCQkgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0
ZSAqcGxhbmVfc3RhdGUpOworaW50IGludGVsX3BsYW5lX2NoZWNrX3NyY19jb29yZGluYXRlcyhj
b25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm1hc3Rlcl9wbGFuZV9zdGF0ZSwKKwkJCQkg
ICAgICBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKTsKIGludCBjaHZfcGxh
bmVfY2hlY2tfcm90YXRpb24oY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9z
dGF0ZSk7CiBzdHJ1Y3QgaW50ZWxfcGxhbmUgKgogc2tsX3VuaXZlcnNhbF9wbGFuZV9jcmVhdGUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAotLSAKMi4yMC4xCgpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBs
aXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

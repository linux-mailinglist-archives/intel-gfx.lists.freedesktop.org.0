Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 894A891E65
	for <lists+intel-gfx@lfdr.de>; Mon, 19 Aug 2019 09:58:46 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A81436E0B6;
	Mon, 19 Aug 2019 07:58:44 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 090046E0AF
 for <intel-gfx@lists.freedesktop.org>; Mon, 19 Aug 2019 07:58:41 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18185111-1500050 
 for multiple; Mon, 19 Aug 2019 08:58:40 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 19 Aug 2019 08:58:35 +0100
Message-Id: <20190819075835.20065-19-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190819075835.20065-1-chris@chris-wilson.co.uk>
References: <20190819075835.20065-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 18/18] drm/i915: Drop struct_mutex from around
 i915_retire_requests()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgZG9uJ3QgbmVlZCB0byBob2xkIHN0cnVjdF9tdXRleCBub3cgZm9yIHJldGlyaW5nIHJlcXVl
c3RzLCBzbyBkcm9wIGl0CmZyb20gaTkxNV9yZXRpcmVfcmVxdWVzdHMoKSBhbmQgaTkxNV9nZW1f
d2FpdF9mb3JfaWRsZSgpLCBmaW5hbGx5CnJlbW92aW5nIEk5MTVfV0FJVF9MT0NLRUQgZm9yIGdv
b2QuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51
az4KLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMgICAgfCAg
NyArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgICB8IDIw
ICstLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMgICAgICAg
IHwgNDUgKysrKysrKy0tLS0tLS0tLS0tLQogLi4uL2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkx
NV9nZW1fY29udGV4dC5jIHwgIDQgKy0KIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVf
Z2VtX21tYW4uYyAgICB8ICA2ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
Y29udGV4dC5jICAgIHwgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hh
bmdjaGVjay5jICB8IDI4ICsrKystLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfbHJjLmMgICAgICAgIHwgMjEgKysrKystLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9zZWxmdGVzdF90aW1lbGluZS5jICAgfCAgNiArLS0KIC4uLi9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3Rfd29ya2Fyb3VuZHMuYyAgICB8ICA2ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kZWJ1Z2ZzLmMgICAgICAgICAgIHwgNDIgKysrKystLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ2VtLmMgICAgICAgICAgICAgICB8IDE5ICsrKystLS0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaCAgICAgICAgICAgfCAgNyArKy0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jICB8ICA4ICstLS0KIC4uLi9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMgICB8ICAyICstCiAuLi4vZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3NlbGZ0ZXN0LmMgICAgfCAgOCArLS0tCiAuLi4vZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5jICAgfCAzMCArKysrKy0tLS0tLS0tCiAu
Li4vZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5oICAgfCAgMiArLQogLi4u
L2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2xpdmVfdGVzdC5jICAgIHwgIDUgKy0tCiAuLi4v
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYyAgfCAgNCAtLQogMjAgZmls
ZXMgY2hhbmdlZCwgOTEgaW5zZXJ0aW9ucygrKSwgMTgzIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2JsdC5jCmluZGV4IGMzNDVkM2Q2
MmRmMS4uMzUwMjA3MWUxMzkxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fY2xpZW50X2JsdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9jbGllbnRfYmx0LmMKQEAgLTE1NSw3ICsxNTUsNiBAQCBzdGF0aWMgdm9pZCBjbGVhcl9w
YWdlc19kbWFfZmVuY2VfY2Ioc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsCiBzdGF0aWMgdm9pZCBj
bGVhcl9wYWdlc193b3JrZXIoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogewogCXN0cnVjdCBj
bGVhcl9wYWdlc193b3JrICp3ID0gY29udGFpbmVyX29mKHdvcmssIHR5cGVvZigqdyksIHdvcmsp
OwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdy0+Y2UtPmVuZ2luZS0+aTkxNTsK
IAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gdy0+c2xlZXZlLT52bWEtPm9iajsK
IAlzdHJ1Y3QgaTkxNV92bWEgKnZtYSA9IHctPnNsZWV2ZS0+dm1hOwogCXN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJxOwpAQCAtMTczLDExICsxNzIsOSBAQCBzdGF0aWMgdm9pZCBjbGVhcl9wYWdlc193
b3JrZXIoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCW9iai0+cmVhZF9kb21haW5zID0gSTkx
NV9HRU1fR1BVX0RPTUFJTlM7CiAJb2JqLT53cml0ZV9kb21haW4gPSAwOwogCi0JLyogWFhYOiB3
ZSBuZWVkIHRvIGtpbGwgdGhpcyAqLwotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwogCWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIFBJTl9VU0VSKTsKIAlpZiAodW5s
aWtlbHkoZXJyKSkKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3RvIG91dF9zaWduYWw7CiAKIAli
YXRjaCA9IGludGVsX2VtaXRfdm1hX2ZpbGxfYmx0KHctPmNlLCB2bWEsIHctPnZhbHVlKTsKIAlp
ZiAoSVNfRVJSKGJhdGNoKSkgewpAQCAtMjI5LDggKzIyNiw2IEBAIHN0YXRpYyB2b2lkIGNsZWFy
X3BhZ2VzX3dvcmtlcihzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJaW50ZWxfZW1pdF92bWFf
cmVsZWFzZSh3LT5jZSwgYmF0Y2gpOwogb3V0X3VucGluOgogCWk5MTVfdm1hX3VucGluKHZtYSk7
Ci1vdXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiBv
dXRfc2lnbmFsOgogCWlmICh1bmxpa2VseShlcnIpKSB7CiAJCWRtYV9mZW5jZV9zZXRfZXJyb3Io
JnctPmRtYSwgZXJyKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4
dC5jCmluZGV4IDY1OTdkOTg0NThkYi4uMjc2NTRkZDM4MDlkIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKQEAgLTExNTQsOCArMTE1NCw3IEBAIGdlbjhf
bW9kaWZ5X3JwY3Moc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCBzdHJ1Y3QgaW50ZWxfc3NldSBz
c2V1KQogfQogCiBzdGF0aWMgaW50Ci1fX2ludGVsX2NvbnRleHRfcmVjb25maWd1cmVfc3NldShz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCi0JCQkJIHN0cnVjdCBpbnRlbF9zc2V1IHNzZXUpCitp
bnRlbF9jb250ZXh0X3JlY29uZmlndXJlX3NzZXUoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCBz
dHJ1Y3QgaW50ZWxfc3NldSBzc2V1KQogewogCWludCByZXQ7CiAKQEAgLTExNzgsMjMgKzExNzcs
NiBAQCBfX2ludGVsX2NvbnRleHRfcmVjb25maWd1cmVfc3NldShzdHJ1Y3QgaW50ZWxfY29udGV4
dCAqY2UsCiAJcmV0dXJuIHJldDsKIH0KIAotc3RhdGljIGludAotaW50ZWxfY29udGV4dF9yZWNv
bmZpZ3VyZV9zc2V1KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgc3RydWN0IGludGVsX3NzZXUg
c3NldSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGNlLT5lbmdpbmUtPmk5
MTU7Ci0JaW50IHJldDsKLQotCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKLQotCXJldCA9IF9f
aW50ZWxfY29udGV4dF9yZWNvbmZpZ3VyZV9zc2V1KGNlLCBzc2V1KTsKLQotCW11dGV4X3VubG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQlyZXR1cm4gcmV0OwotfQotCiBzdGF0aWMg
aW50CiB1c2VyX3RvX2NvbnRleHRfc3NldShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAkJICAgICBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2NvbnRleHRfcGFyYW1fc3NldSAqdXNl
ciwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKaW5kZXggNmU0Y2MxNzdjYzdh
Li5mZWMwYjQxMGQxZDkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCkBA
IC00OCwxMSArNDgsNyBAQCBzdGF0aWMgdm9pZCByZXRpcmVfd29ya19oYW5kbGVyKHN0cnVjdCB3
b3JrX3N0cnVjdCAqd29yaykKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9CiAJCWNv
bnRhaW5lcl9vZih3b3JrLCB0eXBlb2YoKmk5MTUpLCBnZW0ucmV0aXJlX3dvcmsud29yayk7CiAK
LQkvKiBDb21lIGJhY2sgbGF0ZXIgaWYgdGhlIGRldmljZSBpcyBidXN5Li4uICovCi0JaWYgKG11
dGV4X3RyeWxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpKSB7Ci0JCWk5MTVfcmV0aXJlX3Jl
cXVlc3RzKGk5MTUpOwotCQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwot
CX0KKwlpOTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1KTsKIAogCXF1ZXVlX2RlbGF5ZWRfd29yayhp
OTE1LT53cSwKIAkJCSAgICZpOTE1LT5nZW0ucmV0aXJlX3dvcmssCkBAIC04NiwyNiArODIsMjMg
QEAgc3RhdGljIGJvb2wgc3dpdGNoX3RvX2tlcm5lbF9jb250ZXh0X3N5bmMoc3RydWN0IGludGVs
X2d0ICpndCkKIHsKIAlib29sIHJlc3VsdCA9ICFpbnRlbF9ndF9pc193ZWRnZWQoZ3QpOwogCi0J
ZG8gewotCQlpZiAoaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShndC0+aTkxNSwKLQkJCQkJICAgSTkx
NV9XQUlUX0xPQ0tFRCB8Ci0JCQkJCSAgIEk5MTVfV0FJVF9GT1JfSURMRV9CT09TVCwKLQkJCQkJ
ICAgSTkxNV9HRU1fSURMRV9USU1FT1VUKSA9PSAtRVRJTUUpIHsKLQkJCS8qIFhYWCBoaWRlIHdh
cm5pbmcgZnJvbSBnZW1fZWlvICovCi0JCQlpZiAoaTkxNV9tb2RwYXJhbXMucmVzZXQpIHsKLQkJ
CQlkZXZfZXJyKGd0LT5pOTE1LT5kcm0uZGV2LAotCQkJCQkiRmFpbGVkIHRvIGlkbGUgZW5naW5l
cywgZGVjbGFyaW5nIHdlZGdlZCFcbiIpOwotCQkJCUdFTV9UUkFDRV9EVU1QKCk7Ci0JCQl9Ci0K
LQkJCS8qCi0JCQkgKiBGb3JjaWJseSBjYW5jZWwgb3V0c3RhbmRpbmcgd29yayBhbmQgbGVhdmUK
LQkJCSAqIHRoZSBncHUgcXVpZXQuCi0JCQkgKi8KLQkJCWludGVsX2d0X3NldF93ZWRnZWQoZ3Qp
OwotCQkJcmVzdWx0ID0gZmFsc2U7CisJaWYgKGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoZ3QtPmk5
MTUsCisJCQkJICAgSTkxNV9XQUlUX0ZPUl9JRExFX0JPT1NULAorCQkJCSAgIEk5MTVfR0VNX0lE
TEVfVElNRU9VVCkgPT0gLUVUSU1FKSB7CisJCS8qIFhYWCBoaWRlIHdhcm5pbmcgZnJvbSBnZW1f
ZWlvICovCisJCWlmIChpOTE1X21vZHBhcmFtcy5yZXNldCkgeworCQkJZGV2X2VycihndC0+aTkx
NS0+ZHJtLmRldiwKKwkJCQkiRmFpbGVkIHRvIGlkbGUgZW5naW5lcywgZGVjbGFyaW5nIHdlZGdl
ZCFcbiIpOworCQkJR0VNX1RSQUNFX0RVTVAoKTsKIAkJfQotCX0gd2hpbGUgKGk5MTVfcmV0aXJl
X3JlcXVlc3RzKGd0LT5pOTE1KSAmJiByZXN1bHQpOworCisJCS8qCisJCSAqIEZvcmNpYmx5IGNh
bmNlbCBvdXRzdGFuZGluZyB3b3JrIGFuZCBsZWF2ZQorCQkgKiB0aGUgZ3B1IHF1aWV0LgorCQkg
Ki8KKwkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CisJCXJlc3VsdCA9IGZhbHNlOworCX0KIAog
CWlmIChpbnRlbF9ndF9wbV93YWl0X2Zvcl9pZGxlKGd0KSkKIAkJcmVzdWx0ID0gZmFsc2U7CkBA
IC0xMjUsOCArMTE4LDYgQEAgdm9pZCBpOTE1X2dlbV9zdXNwZW5kKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQogCWludGVsX3dha2VyZWZfYXV0bygmaTkxNS0+Z2d0dC51c2VyZmF1bHRf
d2FrZXJlZiwgMCk7CiAJZmx1c2hfd29ya3F1ZXVlKGk5MTUtPndxKTsKIAotCW11dGV4X2xvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJLyoKIAkgKiBXZSBoYXZlIHRvIGZsdXNoIGFs
bCB0aGUgZXhlY3V0aW5nIGNvbnRleHRzIHRvIG1haW4gbWVtb3J5IHNvCiAJICogdGhhdCB0aGV5
IGNhbiBzYXZlZCBpbiB0aGUgaGliZXJuYXRpb24gaW1hZ2UuIFRvIGVuc3VyZSB0aGUgbGFzdApA
QCAtMTM4LDggKzEyOSw2IEBAIHZvaWQgaTkxNV9nZW1fc3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIAkgKi8KIAlzd2l0Y2hfdG9fa2VybmVsX2NvbnRleHRfc3luYygmaTkx
NS0+Z3QpOwogCi0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWNh
bmNlbF9kZWxheWVkX3dvcmtfc3luYygmaTkxNS0+Z3QuaGFuZ2NoZWNrLndvcmspOwogCiAJaTkx
NV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhpOTE1KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXggZGQ4N2U2Y2Q2
MTJlLi4zMzg4OWU3YmUwNWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9z
ZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCkBAIC04ODMsNyArODgzLDcgQEAgX19zc2V1
X3Rlc3QoY29uc3QgY2hhciAqbmFtZSwKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0JcmV0
ID0gX19pbnRlbF9jb250ZXh0X3JlY29uZmlndXJlX3NzZXUoY2UsIHNzZXUpOworCXJldCA9IGlu
dGVsX2NvbnRleHRfcmVjb25maWd1cmVfc3NldShjZSwgc3NldSk7CiAJaWYgKHJldCkKIAkJZ290
byBvdXRfc3BpbjsKIApAQCAtOTg3LDcgKzk4Nyw3IEBAIF9faWd0X2N0eF9zc2V1KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCQlnb3RvIG91dF9mYWlsOwogCiBvdXRfZmFpbDoKLQlp
ZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJaWYgKGlndF9mbHVz
aF90ZXN0KGk5MTUpKQogCQlyZXQgPSAtRUlPOwogCiAJaW50ZWxfY29udGV4dF91bnBpbihjZSk7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2Vt
X21tYW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1h
bi5jCmluZGV4IDUwYWE3ZTk1MTI0ZC4uNTNkMzY1MTVmZmVhIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYwpAQCAtMzkyLDEyICsz
OTIsOCBAQCBzdGF0aWMgdm9pZCBkaXNhYmxlX3JldGlyZV93b3JrZXIoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiAKIHN0YXRpYyB2b2lkIHJlc3RvcmVfcmV0aXJlX3dvcmtlcihzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKKwlpZ3RfZmx1c2hfdGVzdChpOTE1KTsKIAlp
bnRlbF9ndF9wbV9wdXQoJmk5MTUtPmd0KTsKLQotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwotCWlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpOwotCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlpOTE1X2dlbV9kcml2ZXJf
cmVnaXN0ZXJfX3Nocmlua2VyKGk5MTUpOwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9z
ZWxmdGVzdF9jb250ZXh0LmMKaW5kZXggMTQyMDUzM2U4ZmQ1Li44ODM3MzkzNTRiMDcgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKQEAgLTMxMiw3ICszMTIs
NyBAQCBzdGF0aWMgaW50IGxpdmVfYWN0aXZlX2NvbnRleHQodm9pZCAqYXJnKQogCQlpZiAoZXJy
KQogCQkJYnJlYWs7CiAKLQkJZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUsIEk5MTVfV0FJ
VF9MT0NLRUQpOworCQllcnIgPSBpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSk7CiAJCWlmIChlcnIp
CiAJCQlicmVhazsKIAl9CkBAIC00MjUsNyArNDI1LDcgQEAgc3RhdGljIGludCBsaXZlX3JlbW90
ZV9jb250ZXh0KHZvaWQgKmFyZykKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCi0JCWVyciA9IGln
dF9mbHVzaF90ZXN0KGd0LT5pOTE1LCBJOTE1X1dBSVRfTE9DS0VEKTsKKwkJZXJyID0gaWd0X2Zs
dXNoX3Rlc3QoZ3QtPmk5MTUpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAJfQpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYwppbmRleCA3OWEyNjIwNDYyNDku
LmY3YjdkNzlkZTY0ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfaGFuZ2NoZWNrLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFu
Z2NoZWNrLmMKQEAgLTI4Miw3ICsyODIsNyBAQCBzdGF0aWMgdm9pZCBoYW5nX2Zpbmkoc3RydWN0
IGhhbmcgKmgpCiAKIAlrZXJuZWxfY29udGV4dF9jbG9zZShoLT5jdHgpOwogCi0JaWd0X2ZsdXNo
X3Rlc3QoaC0+Z3QtPmk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpOworCWlndF9mbHVzaF90ZXN0KGgt
Pmd0LT5pOTE1KTsKIH0KIAogc3RhdGljIGJvb2wgd2FpdF91bnRpbF9ydW5uaW5nKHN0cnVjdCBo
YW5nICpoLCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKQEAgLTQyNiwxNiArNDI2LDEzIEBAIHN0
YXRpYyBpbnQgaWd0X3Jlc2V0X25vcCh2b2lkICphcmcpCiAJCQlicmVhazsKIAkJfQogCi0JCWVy
ciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1LCAwKTsKKwkJZXJyID0gaWd0X2ZsdXNoX3Rlc3Qo
Z3QtPmk5MTUpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAJfSB3aGlsZSAodGltZV9iZWZvcmUo
amlmZmllcywgZW5kX3RpbWUpKTsKIAlwcl9pbmZvKCIlczogJWQgcmVzZXRzXG4iLCBfX2Z1bmNf
XywgY291bnQpOwogCi0JbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwot
CWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1LCBJOTE1X1dBSVRfTE9DS0VEKTsKLQltdXRl
eF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQorCWVyciA9IGlndF9mbHVz
aF90ZXN0KGd0LT5pOTE1KTsKIG91dDoKIAltb2NrX2ZpbGVfZnJlZShndC0+aTkxNSwgZmlsZSk7
CiAJaWYgKGludGVsX2d0X2lzX3dlZGdlZChndCkpCkBAIC01MzAsMTUgKzUyNywxMiBAQCBzdGF0
aWMgaW50IGlndF9yZXNldF9ub3BfZW5naW5lKHZvaWQgKmFyZykKIAkJaWYgKGVycikKIAkJCWJy
ZWFrOwogCi0JCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1LCAwKTsKKwkJZXJyID0gaWd0
X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAJfQogCi0JbXV0
ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWVyciA9IGlndF9mbHVzaF90
ZXN0KGd0LT5pOTE1LCBJOTE1X1dBSVRfTE9DS0VEKTsKLQltdXRleF91bmxvY2soJmd0LT5pOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKLQorCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KTsK
IG91dDoKIAltb2NrX2ZpbGVfZnJlZShndC0+aTkxNSwgZmlsZSk7CiAJaWYgKGludGVsX2d0X2lz
X3dlZGdlZChndCkpCkBAIC02NDQsNyArNjM4LDcgQEAgc3RhdGljIGludCBfX2lndF9yZXNldF9l
bmdpbmUoc3RydWN0IGludGVsX2d0ICpndCwgYm9vbCBhY3RpdmUpCiAJCWlmIChlcnIpCiAJCQli
cmVhazsKIAotCQllcnIgPSBpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSwgMCk7CisJCWVyciA9IGln
dF9mbHVzaF90ZXN0KGd0LT5pOTE1KTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCX0KQEAgLTk3
NCw5ICs5NjgsNyBAQCBzdGF0aWMgaW50IF9faWd0X3Jlc2V0X2VuZ2luZXMoc3RydWN0IGludGVs
X2d0ICpndCwKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCi0JCW11dGV4X2xvY2soJmd0LT5pOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKLQkJZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUsIEk5
MTVfV0FJVF9MT0NLRUQpOwotCQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKKwkJZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpOwogCQlpZiAoZXJyKQogCQkJ
YnJlYWs7CiAJfQpAQCAtMTUwNSw3ICsxNDk3LDcgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfcXVl
dWUodm9pZCAqYXJnKQogCiAJCWk5MTVfcmVxdWVzdF9wdXQocHJldik7CiAKLQkJZXJyID0gaWd0
X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpOworCQllcnIgPSBpZ3RfZmx1
c2hfdGVzdChndC0+aTkxNSk7CiAJCWlmIChlcnIpCiAJCQlicmVhazsKIAl9CkBAIC0xNzQ1LDEw
ICsxNzM3LDYgQEAgaW50IGludGVsX2hhbmdjaGVja19saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAogCWVyciA9IGludGVsX2d0X2xpdmVfc3VidGVzdHModGVz
dHMsIGd0KTsKIAotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlp
Z3RfZmx1c2hfdGVzdChndC0+aTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCk7Ci0JbXV0ZXhfdW5sb2Nr
KCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlpOTE1X21vZHBhcmFtcy5lbmFibGVf
aGFuZ2NoZWNrID0gc2F2ZWRfaGFuZ2NoZWNrOwogCWludGVsX3J1bnRpbWVfcG1fcHV0KCZndC0+
aTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfbHJjLmMKaW5kZXggMWFlZmY1MjljYzAzLi5hNzI4MGRkZWEyMDkgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCkBAIC02MSw3ICs2MSw3IEBAIHN0YXRpYyBpbnQgbGl2
ZV9zYW5pdHljaGVjayh2b2lkICphcmcpCiAJCX0KIAogCQlpZ3Rfc3Bpbm5lcl9lbmQoJnNwaW4p
OwotCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpIHsKKwkJaWYg
KGlndF9mbHVzaF90ZXN0KGk5MTUpKSB7CiAJCQllcnIgPSAtRUlPOwogCQkJZ290byBlcnJfY3R4
OwogCQl9CkBAIC0yMDYsOCArMjA2LDcgQEAgc2xpY2Vfc2VtYXBob3JlX3F1ZXVlKHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKm91dGVyLAogCWlmIChlcnIpCiAJCWdvdG8gb3V0OwogCi0JaWYgKGk5
MTVfcmVxdWVzdF93YWl0KGhlYWQsCi0JCQkgICAgICBJOTE1X1dBSVRfTE9DS0VELAorCWlmIChp
OTE1X3JlcXVlc3Rfd2FpdChoZWFkLCAwLAogCQkJICAgICAgMiAqIFJVTlRJTUVfSU5GTyhvdXRl
ci0+aTkxNSktPm51bV9lbmdpbmVzICogKGNvdW50ICsgMikgKiAoY291bnQgKyAzKSkgPCAwKSB7
CiAJCXByX2VycigiRmFpbGVkIHRvIHNsaWNlIGFsb25nIHNlbWFwaG9yZSBjaGFpbiBvZiBsZW5n
dGggKCVkLCAlZCkhXG4iLAogCQkgICAgICAgY291bnQsIG4pOwpAQCAtMjc5LDcgKzI3OCw3IEBA
IHN0YXRpYyBpbnQgbGl2ZV90aW1lc2xpY2VfcHJlZW1wdCh2b2lkICphcmcpCiAJCQlpZiAoZXJy
KQogCQkJCWdvdG8gZXJyX3BpbjsKIAotCQkJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVf
V0FJVF9MT0NLRUQpKSB7CisJCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpIHsKIAkJCQllcnIg
PSAtRUlPOwogCQkJCWdvdG8gZXJyX3BpbjsKIAkJCX0KQEAgLTgzMiw3ICs4MzEsNyBAQCBzdGF0
aWMgaW50IGxpdmVfbm9wcmVlbXB0KHZvaWQgKmFyZykKIAkJCWdvdG8gZXJyX3dlZGdlZDsKIAkJ
fQogCi0JCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwkJaWYg
KGlndF9mbHVzaF90ZXN0KGk5MTUpKQogCQkJZ290byBlcnJfd2VkZ2VkOwogCX0KIApAQCAtOTQ4
LDcgKzk0Nyw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9zdXBwcmVzc19zZWxmX3ByZWVtcHQodm9pZCAq
YXJnKQogCQkJZ290byBlcnJfY2xpZW50X2I7CiAJCX0KIAotCQlpZiAoaWd0X2ZsdXNoX3Rlc3Qo
aTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJ
CWdvdG8gZXJyX3dlZGdlZDsKIAl9CiAKQEAgLTExMDksNyArMTEwOCw3IEBAIHN0YXRpYyBpbnQg
bGl2ZV9zdXBwcmVzc193YWl0X3ByZWVtcHQodm9pZCAqYXJnKQogCQkJZm9yIChpID0gMDsgaSA8
IEFSUkFZX1NJWkUoY2xpZW50KTsgaSsrKQogCQkJCWlndF9zcGlubmVyX2VuZCgmY2xpZW50W2ld
LnNwaW4pOwogCi0JCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkp
CisJCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJCQkJZ290byBlcnJfd2VkZ2VkOwogCiAJ
CQlpZiAoZW5naW5lLT5leGVjbGlzdHMucHJlZW1wdF9oYW5nLmNvdW50KSB7CkBAIC0xMzg4LDcg
KzEzODcsNyBAQCBzdGF0aWMgaW50IGxpdmVfcHJlZW1wdF9oYW5nKHZvaWQgKmFyZykKIAogCQlp
Z3Rfc3Bpbm5lcl9lbmQoJnNwaW5faGkpOwogCQlpZ3Rfc3Bpbm5lcl9lbmQoJnNwaW5fbG8pOwot
CQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpIHsKKwkJaWYgKGln
dF9mbHVzaF90ZXN0KGk5MTUpKSB7CiAJCQllcnIgPSAtRUlPOwogCQkJZ290byBlcnJfY3R4X2xv
OwogCQl9CkBAIC0xNzgzLDcgKzE3ODIsNyBAQCBzdGF0aWMgaW50IG5vcF92aXJ0dWFsX2VuZ2lu
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJcHJpbWUsIGRpdjY0X3U2NChrdGlt
ZV90b19ucyh0aW1lc1sxXSksIHByaW1lKSk7CiAKIG91dDoKLQlpZiAoaWd0X2ZsdXNoX3Rlc3Qo
aTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUpKQogCQll
cnIgPSAtRUlPOwogCiAJZm9yIChuYyA9IDA7IG5jIDwgbmN0eDsgbmMrKykgewpAQCAtMTkyOCw3
ICsxOTI3LDcgQEAgc3RhdGljIGludCBtYXNrX3ZpcnR1YWxfZW5naW5lKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1LAogCQlnb3RvIG91dDsKIAogb3V0OgotCWlmIChpZ3RfZmx1c2hfdGVz
dChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJ
CWVyciA9IC1FSU87CiAKIAlmb3IgKG4gPSAwOyBuIDwgbnNpYmxpbmc7IG4rKykKQEAgLTIxMDYs
NyArMjEwNSw3IEBAIHN0YXRpYyBpbnQgYm9uZF92aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKIG91dDoKIAlmb3IgKG4gPSAwOyAhSVNfRVJSKHJxW25dKTsgbisr
KQogCQlpOTE1X3JlcXVlc3RfcHV0KHJxW25dKTsKLQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwg
STkxNV9XQUlUX0xPQ0tFRCkpCisJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUpKQogCQllcnIgPSAt
RUlPOwogCiAJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3RpbWVsaW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF90aW1lbGluZS5jCmluZGV4IDMyMTQ4MTQwMzE2NS4uNDJkMGJiYmJjN2Vh
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF90aW1lbGluZS5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3RpbWVsaW5lLmMKQEAgLTU0
NSw3ICs1NDUsNyBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF9lbmdpbmUodm9pZCAqYXJnKQogCX0K
IAogb3V0OgotCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwlp
ZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJCWVyciA9IC1FSU87CiAKIAlmb3IgKG4gPSAwOyBu
IDwgY291bnQ7IG4rKykgewpAQCAtNjIxLDcgKzYyMSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3Nw
X2FsdGVybmF0ZSh2b2lkICphcmcpCiAJfQogCiBvdXQ6Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5
MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQorCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJZXJy
ID0gLUVJTzsKIAogCWZvciAobiA9IDA7IG4gPCBjb3VudDsgbisrKSB7CkBAIC03NDcsNyArNzQ3
LDcgQEAgc3RhdGljIGludCBsaXZlX2h3c3Bfd3JhcCh2b2lkICphcmcpCiAJfQogCiBvdXQ6Ci0J
aWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQorCWlmIChpZ3RfZmx1
c2hfdGVzdChpOTE1KSkKIAkJZXJyID0gLUVJTzsKIAogCWludGVsX3RpbWVsaW5lX3VucGluKHRs
KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91
bmRzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jCmlu
ZGV4IGViNWRhMDFkMGEwOC4uMjRlNDI5YmQzNWU5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMKQEAgLTY2Niw3ICs2NjYsNyBAQCBzdGF0aWMg
aW50IGNoZWNrX2RpcnR5X3doaXRlbGlzdChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAog
CQkJYnJlYWs7CiAJfQogCi0JaWYgKGlndF9mbHVzaF90ZXN0KGN0eC0+aTkxNSwgSTkxNV9XQUlU
X0xPQ0tFRCkpCisJaWYgKGlndF9mbHVzaF90ZXN0KGN0eC0+aTkxNSkpCiAJCWVyciA9IC1FSU87
CiBvdXRfYmF0Y2g6CiAJaTkxNV92bWFfdW5waW5fYW5kX3JlbGVhc2UoJmJhdGNoLCAwKTsKQEAg
LTEwNzIsNyArMTA3Miw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9pc29sYXRlZF93aGl0ZWxpc3Qodm9p
ZCAqYXJnKQogCQlrZXJuZWxfY29udGV4dF9jbG9zZShjbGllbnRbaV0uY3R4KTsKIAl9CiAKLQlp
ZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJaWYgKGlndF9mbHVz
aF90ZXN0KGk5MTUpKQogCQllcnIgPSAtRUlPOwogCiAJcmV0dXJuIGVycjsKQEAgLTEyMzAsNyAr
MTIzMCw3IEBAIGxpdmVfZW5naW5lX3Jlc2V0X3dvcmthcm91bmRzKHZvaWQgKmFyZykKIAlpZ3Rf
Z2xvYmFsX3Jlc2V0X3VubG9jaygmaTkxNS0+Z3QpOwogCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0
eCk7CiAKLQlpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKTsKKwlpZ3RfZmx1
c2hfdGVzdChpOTE1KTsKIAogCXJldHVybiByZXQ7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVi
dWdmcy5jCmluZGV4IGIwZjUxNTkxZjJlNC4uMDJmMWRkNmE1NDQ4IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2RlYnVnZnMuYwpAQCAtMzYwMyw2ICszNjAzLDcgQEAgc3RhdGljIGludAogaTkxNV9k
cm9wX2NhY2hlc19zZXQodm9pZCAqZGF0YSwgdTY0IHZhbCkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IGRhdGE7CisJaW50IHJldDsKIAogCURSTV9ERUJVRygiRHJvcHBpbmcg
Y2FjaGVzOiAweCUwOGxseCBbMHglMDhsbHhdXG4iLAogCQkgIHZhbCwgdmFsICYgRFJPUF9BTEwp
OwpAQCAtMzYxMiw0MCArMzYxMywyMSBAQCBpOTE1X2Ryb3BfY2FjaGVzX3NldCh2b2lkICpkYXRh
LCB1NjQgdmFsKQogCQkgICAgIEk5MTVfSURMRV9FTkdJTkVTX1RJTUVPVVQpKQogCQlpbnRlbF9n
dF9zZXRfd2VkZ2VkKCZpOTE1LT5ndCk7CiAKLQkvKiBObyBuZWVkIHRvIGNoZWNrIGFuZCB3YWl0
IGZvciBncHUgcmVzZXRzLCBvbmx5IGxpYmRybSBhdXRvLXJlc3RhcnRzCi0JICogb24gaW9jdGxz
IG9uIC1FQUdBSU4uICovCi0JaWYgKHZhbCAmIChEUk9QX0FDVElWRSB8IERST1BfSURMRSB8IERS
T1BfUkVUSVJFIHwgRFJPUF9SRVNFVF9TRVFOTykpIHsKLQkJaW50IHJldDsKKwlpZiAodmFsICYg
RFJPUF9SRVRJUkUpCisJCWk5MTVfcmV0aXJlX3JlcXVlc3RzKGk5MTUpOwogCi0JCXJldCA9IG11
dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJaWYgKHZh
bCAmIChEUk9QX0lETEUgfCBEUk9QX0FDVElWRSkpIHsKKwkJcmV0ID0gaTkxNV9nZW1fd2FpdF9m
b3JfaWRsZShpOTE1LAorCQkJCQkgICAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFLAorCQkJCQkg
ICAgIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiByZXQ7CisJ
fQogCi0JCS8qCi0JCSAqIFRvIGZpbmlzaCB0aGUgZmx1c2ggb2YgdGhlIGlkbGVfd29ya2VyLCB3
ZSBtdXN0IGNvbXBsZXRlCi0JCSAqIHRoZSBzd2l0Y2gtdG8ta2VybmVsLWNvbnRleHQsIHdoaWNo
IHJlcXVpcmVzIGEgZG91YmxlCi0JCSAqIHBhc3MgdGhyb3VnaCB3YWl0X2Zvcl9pZGxlOiBmaXJz
dCBxdWV1ZXMgdGhlIHN3aXRjaCwKLQkJICogc2Vjb25kIHdhaXRzIGZvciB0aGUgc3dpdGNoLgot
CQkgKi8KLQkJaWYgKHJldCA9PSAwICYmIHZhbCAmIChEUk9QX0lETEUgfCBEUk9QX0FDVElWRSkp
Ci0JCQlyZXQgPSBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGk5MTUsCi0JCQkJCQkgICAgIEk5MTVf
V0FJVF9JTlRFUlJVUFRJQkxFIHwKLQkJCQkJCSAgICAgSTkxNV9XQUlUX0xPQ0tFRCwKLQkJCQkJ
CSAgICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwotCi0JCWlmIChyZXQgPT0gMCAmJiB2YWwgJiBE
Uk9QX0lETEUpCi0JCQlyZXQgPSBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGk5MTUsCi0JCQkJCQkg
ICAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFIHwKLQkJCQkJCSAgICAgSTkxNV9XQUlUX0xPQ0tF
RCwKLQkJCQkJCSAgICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwotCi0JCWlmICh2YWwgJiBEUk9Q
X1JFVElSRSkKLQkJCWk5MTVfcmV0aXJlX3JlcXVlc3RzKGk5MTUpOwotCi0JCW11dGV4X3VubG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQkJaWYgKHJldCA9PSAwICYmIHZhbCAmIERS
T1BfSURMRSkKLQkJCXJldCA9IGludGVsX2d0X3BtX3dhaXRfZm9yX2lkbGUoJmk5MTUtPmd0KTsK
KwlpZiAodmFsICYgRFJPUF9JRExFKSB7CisJCXJldCA9IGludGVsX2d0X3BtX3dhaXRfZm9yX2lk
bGUoJmk5MTUtPmd0KTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiByZXQ7CiAJfQogCiAJaWYgKHZh
bCAmIERST1BfUkVTRVRfQUNUSVZFICYmIGludGVsX2d0X3Rlcm1pbmFsbHlfd2VkZ2VkKCZpOTE1
LT5ndCkpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwppbmRleCBhZjY0OWVjZTc5ZmEuLjM1NGU0ZmRk
ZjMwNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCkBAIC05NDIsMTkgKzk0MiwxNiBAQCBpbnQg
aTkxNV9nZW1fd2FpdF9mb3JfaWRsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlp
ZiAoIWludGVsX2d0X3BtX2lzX2F3YWtlKCZpOTE1LT5ndCkpCiAJCXJldHVybiAwOwogCi0JR0VN
X1RSQUNFKCJmbGFncz0leCAoJXMpLCB0aW1lb3V0PSVsZCVzXG4iLAotCQkgIGZsYWdzLCBmbGFn
cyAmIEk5MTVfV0FJVF9MT0NLRUQgPyAibG9ja2VkIiA6ICJ1bmxvY2tlZCIsCi0JCSAgdGltZW91
dCwgdGltZW91dCA9PSBNQVhfU0NIRURVTEVfVElNRU9VVCA/ICIgKGZvcmV2ZXIpIiA6ICIiKTsK
LQotCXRpbWVvdXQgPSB3YWl0X2Zvcl90aW1lbGluZXMoaTkxNSwgZmxhZ3MsIHRpbWVvdXQpOwot
CWlmICh0aW1lb3V0IDwgMCkKLQkJcmV0dXJuIHRpbWVvdXQ7CisJZG8geworCQl0aW1lb3V0ID0g
d2FpdF9mb3JfdGltZWxpbmVzKGk5MTUsIGZsYWdzLCB0aW1lb3V0KTsKKwkJaWYgKHRpbWVvdXQg
PCAwKQorCQkJcmV0dXJuIHRpbWVvdXQ7CiAKLQlpZiAoZmxhZ3MgJiBJOTE1X1dBSVRfTE9DS0VE
KSB7Ci0JCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCQlj
b25kX3Jlc2NoZWQoKTsKKwkJaWYgKHNpZ25hbF9wZW5kaW5nKGN1cnJlbnQpKQorCQkJcmV0dXJu
IC1FSU5UUjsKIAotCQlpOTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1KTsKLQl9CisJfSB3aGlsZSAo
aTkxNV9yZXRpcmVfcmVxdWVzdHMoaTkxNSkpOwogCiAJcmV0dXJuIDA7CiB9CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaCBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfcmVxdWVzdC5oCmluZGV4IDMyNTFkMmJkYmVlYS4uNTdhMjE5M2M2NGQxIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaApAQCAtMzA4LDEwICszMDgsOSBAQCBsb25nIGk5
MTVfcmVxdWVzdF93YWl0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAogCQkgICAgICAgbG9uZyB0
aW1lb3V0KQogCV9fYXR0cmlidXRlX18oKG5vbm51bGwoMSkpKTsKICNkZWZpbmUgSTkxNV9XQUlU
X0lOVEVSUlVQVElCTEUJQklUKDApCi0jZGVmaW5lIEk5MTVfV0FJVF9MT0NLRUQJQklUKDEpIC8q
IHN0cnVjdF9tdXRleCBoZWxkLCBoYW5kbGUgR1BVIHJlc2V0ICovCi0jZGVmaW5lIEk5MTVfV0FJ
VF9QUklPUklUWQlCSVQoMikgLyogc21hbGwgcHJpb3JpdHkgYnVtcCBmb3IgdGhlIHJlcXVlc3Qg
Ki8KLSNkZWZpbmUgSTkxNV9XQUlUX0FMTAkJQklUKDMpIC8qIHVzZWQgYnkgaTkxNV9nZW1fb2Jq
ZWN0X3dhaXQoKSAqLwotI2RlZmluZSBJOTE1X1dBSVRfRk9SX0lETEVfQk9PU1QgQklUKDQpCisj
ZGVmaW5lIEk5MTVfV0FJVF9QUklPUklUWQlCSVQoMSkgLyogc21hbGwgcHJpb3JpdHkgYnVtcCBm
b3IgdGhlIHJlcXVlc3QgKi8KKyNkZWZpbmUgSTkxNV9XQUlUX0FMTAkJQklUKDIpIC8qIHVzZWQg
YnkgaTkxNV9nZW1fb2JqZWN0X3dhaXQoKSAqLworI2RlZmluZSBJOTE1X1dBSVRfRk9SX0lETEVf
Qk9PU1QgQklUKDMpCiAKIHN0YXRpYyBpbmxpbmUgYm9vbCBpOTE1X3JlcXVlc3Rfc2lnbmFsZWQo
Y29uc3Qgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9hY3RpdmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jCmluZGV4IGQxZGQ1ZTI5MzZiOS4uMWRkYWVjMGNjNjkx
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9hY3RpdmUu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9hY3RpdmUuYwpAQCAt
MTY0LDEwICsxNjQsOCBAQCBzdGF0aWMgaW50IGxpdmVfYWN0aXZlX3dhaXQodm9pZCAqYXJnKQog
CiAJX19saXZlX3B1dChhY3RpdmUpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQorCWlm
IChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJZXJyID0gLUVJTzsKLQltdXRleF91bmxvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJcmV0dXJuIGVycjsKIH0KQEAgLTE4NSwxMCArMTgz
LDggQEAgc3RhdGljIGludCBsaXZlX2FjdGl2ZV9yZXRpcmUodm9pZCAqYXJnKQogCQlyZXR1cm4g
UFRSX0VSUihhY3RpdmUpOwogCiAJLyogd2FpdHMgZm9yICYgcmV0aXJlcyBhbGwgcmVxdWVzdHMg
Ki8KLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAoaWd0X2ZsdXNo
X3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUp
KQogCQllcnIgPSAtRUlPOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiAKIAlpZiAoIWFjdGl2ZS0+cmV0aXJlZCkgewogCQlwcl9lcnIoImk5MTVfYWN0aXZlIG5vdCBy
ZXRpcmVkIGFmdGVyIGZsdXNoaW5nIVxuIik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5jCmluZGV4IDI5YTdkZTkxODFkNC4uOGM3ZjA2ZDE3ZWZl
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZp
Y3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3Qu
YwpAQCAtNTEwLDcgKzUxMCw3IEBAIHN0YXRpYyBpbnQgaWd0X2V2aWN0X2NvbnRleHRzKHZvaWQg
KmFyZykKIAogCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogb3V0X2xvY2tl
ZDoKLQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJaWYgKGln
dF9mbHVzaF90ZXN0KGk5MTUpKQogCQllcnIgPSAtRUlPOwogCXdoaWxlIChyZXNlcnZlZCkgewog
CQlzdHJ1Y3QgcmVzZXJ2ZWQgKm5leHQgPSByZXNlcnZlZC0+bmV4dDsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3NlbGZ0ZXN0LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9zZWxmdGVzdC5jCmluZGV4IDQzOGVhMGVhYTQxNi4u
ODI1YTgyODZjYmU4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aTkxNV9zZWxmdGVzdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1
X3NlbGZ0ZXN0LmMKQEAgLTI2MywxMCArMjYzLDggQEAgaW50IF9faTkxNV9saXZlX3RlYXJkb3du
KGludCBlcnIsIHZvaWQgKmRhdGEpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSBkYXRhOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKGln
dF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQorCWlmIChpZ3RfZmx1c2hfdGVz
dChpOTE1KSkKIAkJZXJyID0gLUVJTzsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCiAJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhpOTE1KTsKIApAQCAtMjg0
LDEwICsyODIsOCBAQCBpbnQgX19pbnRlbF9ndF9saXZlX3RlYXJkb3duKGludCBlcnIsIHZvaWQg
KmRhdGEpCiB7CiAJc3RydWN0IGludGVsX2d0ICpndCA9IGRhdGE7CiAKLQltdXRleF9sb2NrKCZn
dC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1
LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwlpZiAoaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpKQogCQll
cnIgPSAtRUlPOwotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
CiAJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhndC0+aTkxNSk7CiAKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9mbHVzaF90ZXN0LmMKaW5kZXggZDNiNWViNDAy
ZDMzLi4yYTVmYmU0NmVhOWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9pZ3RfZmx1c2hfdGVzdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pZ3RfZmx1c2hfdGVzdC5jCkBAIC0xMiwzMSArMTIsMjUgQEAKIAogI2luY2x1ZGUgImlndF9m
bHVzaF90ZXN0LmgiCiAKLWludCBpZ3RfZmx1c2hfdGVzdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwgdW5zaWduZWQgaW50IGZsYWdzKQoraW50IGlndF9mbHVzaF90ZXN0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogewogCWludCByZXQgPSBpbnRlbF9ndF9pc193ZWRnZWQo
Jmk5MTUtPmd0KSA/IC1FSU8gOiAwOwotCWludCByZXBlYXQgPSAhIShmbGFncyAmIEk5MTVfV0FJ
VF9MT0NLRUQpOwogCiAJY29uZF9yZXNjaGVkKCk7CiAKLQlkbyB7Ci0JCWlmIChpOTE1X2dlbV93
YWl0X2Zvcl9pZGxlKGk5MTUsIGZsYWdzLCBIWiAvIDUpID09IC1FVElNRSkgewotCQkJcHJfZXJy
KCIlcFMgdGltZWQgb3V0LCBjYW5jZWxsaW5nIGFsbCBmdXJ0aGVyIHRlc3RpbmcuXG4iLAotCQkJ
ICAgICAgIF9fYnVpbHRpbl9yZXR1cm5fYWRkcmVzcygwKSk7CisJaTkxNV9yZXRpcmVfcmVxdWVz
dHMoaTkxNSk7CisJaWYgKGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoaTkxNSwgMCwgSFogLyA1KSA9
PSAtRVRJTUUpIHsKKwkJcHJfZXJyKCIlcFMgdGltZWQgb3V0LCBjYW5jZWxsaW5nIGFsbCBmdXJ0
aGVyIHRlc3RpbmcuXG4iLAorCQkgICAgICAgX19idWlsdGluX3JldHVybl9hZGRyZXNzKDApKTsK
IAotCQkJR0VNX1RSQUNFKCIlcFMgdGltZWQgb3V0LlxuIiwKLQkJCQkgIF9fYnVpbHRpbl9yZXR1
cm5fYWRkcmVzcygwKSk7Ci0JCQlHRU1fVFJBQ0VfRFVNUCgpOworCQlHRU1fVFJBQ0UoIiVwUyB0
aW1lZCBvdXQuXG4iLAorCQkJICBfX2J1aWx0aW5fcmV0dXJuX2FkZHJlc3MoMCkpOworCQlHRU1f
VFJBQ0VfRFVNUCgpOwogCi0JCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZpOTE1LT5ndCk7Ci0JCQly
ZXBlYXQgPSAwOwotCQkJcmV0ID0gLUVJTzsKLQkJfQotCi0JCS8qIEVuc3VyZSB3ZSBhbHNvIGZs
dXNoIGFmdGVyIHdlZGdpbmcuICovCi0JCWlmIChmbGFncyAmIEk5MTVfV0FJVF9MT0NLRUQpCi0J
CQlpOTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1KTsKLQl9IHdoaWxlIChyZXBlYXQtLSk7CisJCWlu
dGVsX2d0X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKKwkJcmV0ID0gLUVJTzsKKwl9CisJaTkxNV9y
ZXRpcmVfcmVxdWVzdHMoaTkxNSk7CiAKIAlyZXR1cm4gcmV0OwogfQpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9mbHVzaF90ZXN0LmggYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2ZsdXNoX3Rlc3QuaAppbmRleCA2M2UwMDk5MjdjNDMu
Ljc1NDFmYTc0ZTY0MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3Rz
L2lndF9mbHVzaF90ZXN0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2ln
dF9mbHVzaF90ZXN0LmgKQEAgLTksNiArOSw2IEBACiAKIHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
OwogCi1pbnQgaWd0X2ZsdXNoX3Rlc3Qoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHVu
c2lnbmVkIGludCBmbGFncyk7CitpbnQgaWd0X2ZsdXNoX3Rlc3Qoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpOwogCiAjZW5kaWYgLyogSUdUX0ZMVVNIX1RFU1RfSCAqLwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9saXZlX3Rlc3QuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfbGl2ZV90ZXN0LmMKaW5kZXggM2U5MDI3NjFj
ZDE2Li5iMjZlZmYyMWUxNmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9pZ3RfbGl2ZV90ZXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3Rz
L2lndF9saXZlX3Rlc3QuYwpAQCAtMjYsOCArMjYsNyBAQCBpbnQgaWd0X2xpdmVfdGVzdF9iZWdp
bihzdHJ1Y3QgaWd0X2xpdmVfdGVzdCAqdCwKIAl0LT5uYW1lID0gbmFtZTsKIAogCWVyciA9IGk5
MTVfZ2VtX3dhaXRfZm9yX2lkbGUoaTkxNSwKLQkJCQkgICAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJ
QkxFIHwKLQkJCQkgICAgIEk5MTVfV0FJVF9MT0NLRUQsCisJCQkJICAgICBJOTE1X1dBSVRfSU5U
RVJSVVBUSUJMRSwKIAkJCQkgICAgIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKIAlpZiAoZXJyKSB7
CiAJCXByX2VycigiJXMoJXMpOiBmYWlsZWQgdG8gaWRsZSBiZWZvcmUsIHdpdGggZXJyPSVkISIs
CkBAIC01Miw3ICs1MSw3IEBAIGludCBpZ3RfbGl2ZV90ZXN0X2VuZChzdHJ1Y3QgaWd0X2xpdmVf
dGVzdCAqdCkKIAogCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwogCi0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQorCWlmIChp
Z3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJcmV0dXJuIC1FSU87CiAKIAlpZiAodC0+cmVzZXRfZ2xv
YmFsICE9IGk5MTVfcmVzZXRfY291bnQoJmk5MTUtPmdwdV9lcnJvcikpIHsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYwppbmRleCAwMWE4OWMw
NzFiZjUuLjE5NTYwMDZhMGQ1YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2Vs
ZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYwpAQCAtNDEsOCArNDEsNiBAQCB2b2lkIG1vY2tfZGV2aWNl
X2ZsdXNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCXN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZTsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKIAotCWxvY2tkZXBfYXNz
ZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJZG8gewogCQlmb3JfZWFjaF9l
bmdpbmUoZW5naW5lLCBpOTE1LCBpZCkKIAkJCW1vY2tfZW5naW5lX2ZsdXNoKGVuZ2luZSk7CkBA
IC01NSw5ICs1Myw3IEBAIHN0YXRpYyB2b2lkIG1vY2tfZGV2aWNlX3JlbGVhc2Uoc3RydWN0IGRy
bV9kZXZpY2UgKmRldikKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJZW51bSBp
bnRlbF9lbmdpbmVfaWQgaWQ7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKIAltb2NrX2RldmljZV9mbHVzaChpOTE1KTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCiAJZmx1c2hfd29yaygmaTkxNS0+Z2VtLmlkbGVfd29yayk7CiAJaTkx
NV9nZW1fZHJhaW5fd29ya3F1ZXVlKGk5MTUpOwotLSAKMi4yMy4wLnJjMQoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlz
dApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

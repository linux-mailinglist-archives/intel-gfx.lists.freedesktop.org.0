Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3925E2B9AF6
	for <lists+intel-gfx@lfdr.de>; Thu, 19 Nov 2020 19:54:27 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 75C2889286;
	Thu, 19 Nov 2020 18:54:25 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3B5CA6E7D3
 for <intel-gfx@lists.freedesktop.org>; Thu, 19 Nov 2020 18:54:24 +0000 (UTC)
IronPort-SDR: PtL+7TawdOGNL/5rUTtBI+c1dThR/4OMXng10PKT6PudV9KUKNK7PK4/ADjevT3t9g6/r+AsL8
 4syiKKQyrVTg==
X-IronPort-AV: E=McAfee;i="6000,8403,9810"; a="168771186"
X-IronPort-AV: E=Sophos;i="5.78,354,1599548400"; d="scan'208";a="168771186"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by fmsmga104.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 19 Nov 2020 10:54:23 -0800
IronPort-SDR: ajrdivZYSQ+K4+vvNIbVqRnn1qeLBdf4F8conAasXXQ+GwVXRoQFUx0gycN9R1/NQaODUJycGL
 rfSN80jCCysQ==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.78,354,1599548400"; d="scan'208";a="311728444"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by fmsmga007.fm.intel.com with SMTP; 19 Nov 2020 10:54:22 -0800
Received: by stinkbox (sSMTP sendmail emulation);
 Thu, 19 Nov 2020 20:54:21 +0200
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 19 Nov 2020 20:53:55 +0200
Message-Id: <20201119185401.31883-8-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.26.2
In-Reply-To: <20201119185401.31883-1-ville.syrjala@linux.intel.com>
References: <20201119185401.31883-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 07/13] drm/i915: Tweak plane ddb allocation
 tracking
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KCkxl
dCdzIHN0b3JlIHRoZSBwbGFuZSBhbGxvY2F0aW9uIGluIGEgbWFubmVyIHdoaWNoIG1vcmUgY2xv
c2VseQptYXRjaGVzIGhvdyB0aGUgaHcgb3BlcmF0ZXMuIFRoYXQgaXMsIHdlIHN0b3JlIHRoZSBw
YWNrZWQvQ2JDcgpkZGIgaW4gb25lIHN0cnVjdCwgYW5kIHRoZSBZIGRkYiBpbiBhbm90aGVyLiBD
dXJyZW50bHkgd2UncmUKc3RvcmluZyBwYWNrZWQvWSBpbiBvbmUgc3RydWN0LCBDYkNyIGluIHRo
ZSBvdGhlci4KClRoaXMgYWxzbyB3b3JrcyBwcmV0dHkgd2VsbCBmb3IgaWNsKyB3aGVyZSB0aGUg
VVYgcGxhbmUgaXMKdGhlIG1haW4gcGxhbmUgYW5kIHRoZSBZIHBsYW5lIGlzIHN1YnNlcnZpZW50
IHRvIGl0LiBBbHRob3VnaAppbiB0aGlzIGNhc2Ugd2UgZG8gbm90IGV2ZW4gdXNlIGRkYl95IGFz
IHdlIGRvIHRoZSBkZGIgYWxsb2NhdGlvbgppbiB0ZXJtcyBvZiBodyBwbGFuZXMuCgpTaWduZWQt
b2ZmLWJ5OiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29tPgot
LS0KIC4uLi9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWNfcGxhbmUuYyB8IDMyICsr
Ky0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9idy5jICAgICAgIHwgIDYg
Ky0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jICB8IDEyICst
LQogLi4uL2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9kZWJ1Z2ZzLmMgIHwgIDQgKy0K
IC4uLi9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaCAgICB8ICA3ICstCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jICAgICAgICAgICAgICAgfCA5NyArKysrKysr
Ky0tLS0tLS0tLS0tCiA2IGZpbGVzIGNoYW5nZWQsIDcxIGluc2VydGlvbnMoKyksIDg3IGRlbGV0
aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
YXRvbWljX3BsYW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21p
Y19wbGFuZS5jCmluZGV4IDdlOWY4NGIwMDg1OS4uZWFhMWU4M2I2ZmRkIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19wbGFuZS5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljX3BsYW5lLmMKQEAgLTM5OSw4
ICszOTksOCBAQCBpbnQgaW50ZWxfcGxhbmVfYXRvbWljX2NoZWNrKHN0cnVjdCBpbnRlbF9hdG9t
aWNfc3RhdGUgKnN0YXRlLAogc3RhdGljIHN0cnVjdCBpbnRlbF9wbGFuZSAqCiBza2xfbmV4dF9w
bGFuZV90b19jb21taXQoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJCQkgc3Ry
dWN0IGludGVsX2NydGMgKmNydGMsCi0JCQkgc3RydWN0IHNrbF9kZGJfZW50cnkgZW50cmllc195
W0k5MTVfTUFYX1BMQU5FU10sCi0JCQkgc3RydWN0IHNrbF9kZGJfZW50cnkgZW50cmllc191dltJ
OTE1X01BWF9QTEFORVNdLAorCQkJIHN0cnVjdCBza2xfZGRiX2VudHJ5IGRkYltJOTE1X01BWF9Q
TEFORVNdLAorCQkJIHN0cnVjdCBza2xfZGRiX2VudHJ5IGRkYl95W0k5MTVfTUFYX1BMQU5FU10s
CiAJCQkgdW5zaWduZWQgaW50ICp1cGRhdGVfbWFzaykKIHsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSA9CkBAIC00MTksMTcgKzQxOSwxNSBAQCBza2xfbmV4dF9wbGFuZV90
b19jb21taXQoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJCSAgICAhKCp1cGRh
dGVfbWFzayAmIEJJVChwbGFuZV9pZCkpKQogCQkJY29udGludWU7CiAKLQkJaWYgKHNrbF9kZGJf
YWxsb2NhdGlvbl9vdmVybGFwcygmY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYl95W3BsYW5l
X2lkXSwKLQkJCQkJCWVudHJpZXNfeSwKLQkJCQkJCUk5MTVfTUFYX1BMQU5FUywgcGxhbmVfaWQp
IHx8Ci0JCSAgICBza2xfZGRiX2FsbG9jYXRpb25fb3ZlcmxhcHMoJmNydGNfc3RhdGUtPndtLnNr
bC5wbGFuZV9kZGJfdXZbcGxhbmVfaWRdLAotCQkJCQkJZW50cmllc191diwKLQkJCQkJCUk5MTVf
TUFYX1BMQU5FUywgcGxhbmVfaWQpKQorCQlpZiAoc2tsX2RkYl9hbGxvY2F0aW9uX292ZXJsYXBz
KCZjcnRjX3N0YXRlLT53bS5za2wucGxhbmVfZGRiW3BsYW5lX2lkXSwKKwkJCQkJCWRkYiwgSTkx
NV9NQVhfUExBTkVTLCBwbGFuZV9pZCkgfHwKKwkJICAgIHNrbF9kZGJfYWxsb2NhdGlvbl9vdmVy
bGFwcygmY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYl95W3BsYW5lX2lkXSwKKwkJCQkJCWRk
Yl95LCBJOTE1X01BWF9QTEFORVMsIHBsYW5lX2lkKSkKIAkJCWNvbnRpbnVlOwogCiAJCSp1cGRh
dGVfbWFzayAmPSB+QklUKHBsYW5lX2lkKTsKLQkJZW50cmllc195W3BsYW5lX2lkXSA9IGNydGNf
c3RhdGUtPndtLnNrbC5wbGFuZV9kZGJfeVtwbGFuZV9pZF07Ci0JCWVudHJpZXNfdXZbcGxhbmVf
aWRdID0gY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYl91dltwbGFuZV9pZF07CisJCWRkYltw
bGFuZV9pZF0gPSBjcnRjX3N0YXRlLT53bS5za2wucGxhbmVfZGRiW3BsYW5lX2lkXTsKKwkJZGRi
X3lbcGxhbmVfaWRdID0gY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYl95W3BsYW5lX2lkXTsK
IAogCQlyZXR1cm4gcGxhbmU7CiAJfQpAQCAtNDcwLDE5ICs0NjgsMTcgQEAgdm9pZCBza2xfdXBk
YXRlX3BsYW5lc19vbl9jcnRjKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQlp
bnRlbF9hdG9taWNfZ2V0X29sZF9jcnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsKIAlzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUgPQogCQlpbnRlbF9hdG9taWNfZ2V0X25ld19j
cnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsKLQlzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSBlbnRyaWVzX3lb
STkxNV9NQVhfUExBTkVTXTsKLQlzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSBlbnRyaWVzX3V2W0k5MTVf
TUFYX1BMQU5FU107CisJc3RydWN0IHNrbF9kZGJfZW50cnkgZGRiW0k5MTVfTUFYX1BMQU5FU107
CisJc3RydWN0IHNrbF9kZGJfZW50cnkgZGRiX3lbSTkxNV9NQVhfUExBTkVTXTsKIAl1MzIgdXBk
YXRlX21hc2sgPSBuZXdfY3J0Y19zdGF0ZS0+dXBkYXRlX3BsYW5lczsKIAlzdHJ1Y3QgaW50ZWxf
cGxhbmUgKnBsYW5lOwogCi0JbWVtY3B5KGVudHJpZXNfeSwgb2xkX2NydGNfc3RhdGUtPndtLnNr
bC5wbGFuZV9kZGJfeSwKKwltZW1jcHkoZGRiLCBvbGRfY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5l
X2RkYiwKKwkgICAgICAgc2l6ZW9mKG9sZF9jcnRjX3N0YXRlLT53bS5za2wucGxhbmVfZGRiKSk7
CisJbWVtY3B5KGRkYl95LCBvbGRfY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYl95LAogCSAg
ICAgICBzaXplb2Yob2xkX2NydGNfc3RhdGUtPndtLnNrbC5wbGFuZV9kZGJfeSkpOwotCW1lbWNw
eShlbnRyaWVzX3V2LCBvbGRfY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYl91diwKLQkgICAg
ICAgc2l6ZW9mKG9sZF9jcnRjX3N0YXRlLT53bS5za2wucGxhbmVfZGRiX3V2KSk7CiAKLQl3aGls
ZSAoKHBsYW5lID0gc2tsX25leHRfcGxhbmVfdG9fY29tbWl0KHN0YXRlLCBjcnRjLAotCQkJCQkJ
IGVudHJpZXNfeSwgZW50cmllc191diwKLQkJCQkJCSAmdXBkYXRlX21hc2spKSkgeworCXdoaWxl
ICgocGxhbmUgPSBza2xfbmV4dF9wbGFuZV90b19jb21taXQoc3RhdGUsIGNydGMsIGRkYiwgZGRi
X3ksICZ1cGRhdGVfbWFzaykpKSB7CiAJCXN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqbmV3X3Bs
YW5lX3N0YXRlID0KIAkJCWludGVsX2F0b21pY19nZXRfbmV3X3BsYW5lX3N0YXRlKHN0YXRlLCBw
bGFuZSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
YncuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYncuYwppbmRleCBmNmRl
MGI5YmNhOTAuLmEzM2E4YTI3ODRlOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9idy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfYncuYwpAQCAtNDQyLDE2ICs0NDIsMTYgQEAgc3RhdGljIHZvaWQgc2tsX2NydGNfY2FsY19k
YnVmX2J3KHN0cnVjdCBpbnRlbF9id19zdGF0ZSAqYndfc3RhdGUsCiAJCXJldHVybjsKIAogCWZv
cl9lYWNoX3BsYW5lX2lkX29uX2NydGMoY3J0YywgcGxhbmVfaWQpIHsKKwkJY29uc3Qgc3RydWN0
IHNrbF9kZGJfZW50cnkgKmRkYiA9CisJCQkmY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYltw
bGFuZV9pZF07CiAJCWNvbnN0IHN0cnVjdCBza2xfZGRiX2VudHJ5ICpkZGJfeSA9CiAJCQkmY3J0
Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYl95W3BsYW5lX2lkXTsKLQkJY29uc3Qgc3RydWN0IHNr
bF9kZGJfZW50cnkgKmRkYl91diA9Ci0JCQkmY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYl91
dltwbGFuZV9pZF07CiAJCXVuc2lnbmVkIGludCBkYXRhX3JhdGUgPSBjcnRjX3N0YXRlLT5kYXRh
X3JhdGVbcGxhbmVfaWRdOwogCQl1bnNpZ25lZCBpbnQgZGJ1Zl9tYXNrID0gMDsKIAkJaW50IHNs
aWNlX2lkOwogCisJCWRidWZfbWFzayB8PSBza2xfZGRiX2RidWZfc2xpY2VfbWFzayhpOTE1LCBk
ZGIpOwogCQlkYnVmX21hc2sgfD0gc2tsX2RkYl9kYnVmX3NsaWNlX21hc2soaTkxNSwgZGRiX3kp
OwotCQlkYnVmX21hc2sgfD0gc2tsX2RkYl9kYnVmX3NsaWNlX21hc2soaTkxNSwgZGRiX3V2KTsK
IAogCQkvKgogCQkgKiBGSVhNRTogVG8gY2FsY3VsYXRlIHRoYXQgbW9yZSBwcm9wZXJseSB3ZSBw
cm9iYWJseQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
aXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpp
bmRleCA1YzA3Yzc0ZDQzOTcuLjA5Zjc0ZTg3YTMwMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTE0NDYwLDggKzE0NDYwLDggQEAgc3RhdGlj
IHZvaWQgdmVyaWZ5X3dtX3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogewogCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwog
CXN0cnVjdCBza2xfaHdfc3RhdGUgeworCQlzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSBkZGJbSTkxNV9N
QVhfUExBTkVTXTsKIAkJc3RydWN0IHNrbF9kZGJfZW50cnkgZGRiX3lbSTkxNV9NQVhfUExBTkVT
XTsKLQkJc3RydWN0IHNrbF9kZGJfZW50cnkgZGRiX3V2W0k5MTVfTUFYX1BMQU5FU107CiAJCXN0
cnVjdCBza2xfcGlwZV93bSB3bTsKIAl9ICpodzsKIAlzdHJ1Y3Qgc2tsX3BpcGVfd20gKnN3X3dt
OwpAQCAtMTQ0ODAsNyArMTQ0ODAsNyBAQCBzdGF0aWMgdm9pZCB2ZXJpZnlfd21fc3RhdGUoc3Ry
dWN0IGludGVsX2NydGMgKmNydGMsCiAJc2tsX3BpcGVfd21fZ2V0X2h3X3N0YXRlKGNydGMsICZo
dy0+d20pOwogCXN3X3dtID0gJm5ld19jcnRjX3N0YXRlLT53bS5za2wub3B0aW1hbDsKIAotCXNr
bF9waXBlX2RkYl9nZXRfaHdfc3RhdGUoY3J0YywgaHctPmRkYl95LCBody0+ZGRiX3V2KTsKKwlz
a2xfcGlwZV9kZGJfZ2V0X2h3X3N0YXRlKGNydGMsIGh3LT5kZGIsIGh3LT5kZGJfeSk7CiAKIAlo
d19lbmFibGVkX3NsaWNlcyA9IGludGVsX2VuYWJsZWRfZGJ1Zl9zbGljZXNfbWFzayhkZXZfcHJp
dik7CiAKQEAgLTE0NTMxLDggKzE0NTMxLDggQEAgc3RhdGljIHZvaWQgdmVyaWZ5X3dtX3N0YXRl
KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQl9CiAKIAkJLyogRERCICovCi0JCWh3X2RkYl9l
bnRyeSA9ICZody0+ZGRiX3lbcGxhbmVdOwotCQlzd19kZGJfZW50cnkgPSAmbmV3X2NydGNfc3Rh
dGUtPndtLnNrbC5wbGFuZV9kZGJfeVtwbGFuZV07CisJCWh3X2RkYl9lbnRyeSA9ICZody0+ZGRi
W3BsYW5lXTsKKwkJc3dfZGRiX2VudHJ5ID0gJm5ld19jcnRjX3N0YXRlLT53bS5za2wucGxhbmVf
ZGRiW3BsYW5lXTsKIAogCQlpZiAoIXNrbF9kZGJfZW50cnlfZXF1YWwoaHdfZGRiX2VudHJ5LCBz
d19kZGJfZW50cnkpKSB7CiAJCQlkcm1fZXJyKCZkZXZfcHJpdi0+ZHJtLApAQCAtMTQ1ODgsOCAr
MTQ1ODgsOCBAQCBzdGF0aWMgdm9pZCB2ZXJpZnlfd21fc3RhdGUoc3RydWN0IGludGVsX2NydGMg
KmNydGMsCiAJCX0KIAogCQkvKiBEREIgKi8KLQkJaHdfZGRiX2VudHJ5ID0gJmh3LT5kZGJfeVtQ
TEFORV9DVVJTT1JdOwotCQlzd19kZGJfZW50cnkgPSAmbmV3X2NydGNfc3RhdGUtPndtLnNrbC5w
bGFuZV9kZGJfeVtQTEFORV9DVVJTT1JdOworCQlod19kZGJfZW50cnkgPSAmaHctPmRkYltQTEFO
RV9DVVJTT1JdOworCQlzd19kZGJfZW50cnkgPSAmbmV3X2NydGNfc3RhdGUtPndtLnNrbC5wbGFu
ZV9kZGJbUExBTkVfQ1VSU09SXTsKIAogCQlpZiAoIXNrbF9kZGJfZW50cnlfZXF1YWwoaHdfZGRi
X2VudHJ5LCBzd19kZGJfZW50cnkpKSB7CiAJCQlkcm1fZXJyKCZkZXZfcHJpdi0+ZHJtLApkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X2RlYnVn
ZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9kZWJ1Z2Zz
LmMKaW5kZXggY2E0MWU4YzAwYWQ3Li40MmU5MTc5ZjJlMDIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9kZWJ1Z2ZzLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X2RlYnVnZnMuYwpAQCAtMTA3Miwx
MyArMTA3MiwxMyBAQCBzdGF0aWMgaW50IGk5MTVfZGRiX2luZm8oc3RydWN0IHNlcV9maWxlICpt
LCB2b2lkICp1bnVzZWQpCiAJCXNlcV9wcmludGYobSwgIlBpcGUgJWNcbiIsIHBpcGVfbmFtZShw
aXBlKSk7CiAKIAkJZm9yX2VhY2hfcGxhbmVfaWRfb25fY3J0YyhjcnRjLCBwbGFuZV9pZCkgewot
CQkJZW50cnkgPSAmY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYl95W3BsYW5lX2lkXTsKKwkJ
CWVudHJ5ID0gJmNydGNfc3RhdGUtPndtLnNrbC5wbGFuZV9kZGJbcGxhbmVfaWRdOwogCQkJc2Vx
X3ByaW50ZihtLCAiICBQbGFuZSUtOGQlOHUlOHUlOHVcbiIsIHBsYW5lX2lkICsgMSwKIAkJCQkg
ICBlbnRyeS0+c3RhcnQsIGVudHJ5LT5lbmQsCiAJCQkJICAgc2tsX2RkYl9lbnRyeV9zaXplKGVu
dHJ5KSk7CiAJCX0KIAotCQllbnRyeSA9ICZjcnRjX3N0YXRlLT53bS5za2wucGxhbmVfZGRiX3lb
UExBTkVfQ1VSU09SXTsKKwkJZW50cnkgPSAmY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYltQ
TEFORV9DVVJTT1JdOwogCQlzZXFfcHJpbnRmKG0sICIgICUtMTNzJTh1JTh1JTh1XG4iLCAiQ3Vy
c29yIiwgZW50cnktPnN0YXJ0LAogCQkJICAgZW50cnktPmVuZCwgc2tsX2RkYl9lbnRyeV9zaXpl
KGVudHJ5KSk7CiAJfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kaXNwbGF5X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2Rpc3BsYXlfdHlwZXMuaAppbmRleCBjZTgyZDY1NGQwZjIuLjJmMDczODY0NmNmZCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgK
QEAgLTc3MCw4ICs3NzAsMTMgQEAgc3RydWN0IGludGVsX2NydGNfd21fc3RhdGUgewogCQkJLyog
Z2VuOSsgb25seSBuZWVkcyAxLXN0ZXAgd20gcHJvZ3JhbW1pbmcgKi8KIAkJCXN0cnVjdCBza2xf
cGlwZV93bSBvcHRpbWFsOwogCQkJc3RydWN0IHNrbF9kZGJfZW50cnkgZGRiOworCQkJLyoKKwkJ
CSAqIHByZS1pY2w6IGZvciBwYWNrZWQvcGxhbmFyIENiQ3IKKwkJCSAqIGljbCs6IGZvciBldmVy
eXRoaW5nCisJCQkgKi8KKwkJCXN0cnVjdCBza2xfZGRiX2VudHJ5IHBsYW5lX2RkYltJOTE1X01B
WF9QTEFORVNdOworCQkJLyogcHJlLWljbDogZm9yIHBsYW5hciBZICovCiAJCQlzdHJ1Y3Qgc2ts
X2RkYl9lbnRyeSBwbGFuZV9kZGJfeVtJOTE1X01BWF9QTEFORVNdOwotCQkJc3RydWN0IHNrbF9k
ZGJfZW50cnkgcGxhbmVfZGRiX3V2W0k5MTVfTUFYX1BMQU5FU107CiAJCX0gc2tsOwogCiAJCXN0
cnVjdCB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwppbmRleCBjMjg1MWJiMTk3NWQuLjU2MDhhZTVk
Yzk3NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCkBAIC0zOTIxLDcgKzM5MjEsNyBAQCBzdGF0
aWMgYm9vbCB0Z2xfY3J0Y19jYW5fZW5hYmxlX3NhZ3YoY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUpCiAKIAlmb3JfZWFjaF9wbGFuZV9pZF9vbl9jcnRjKGNydGMsIHBs
YW5lX2lkKSB7CiAJCWNvbnN0IHN0cnVjdCBza2xfZGRiX2VudHJ5ICpwbGFuZV9hbGxvYyA9Ci0J
CQkmY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYl95W3BsYW5lX2lkXTsKKwkJCSZjcnRjX3N0
YXRlLT53bS5za2wucGxhbmVfZGRiW3BsYW5lX2lkXTsKIAkJY29uc3Qgc3RydWN0IHNrbF9wbGFu
ZV93bSAqd20gPQogCQkJJmNydGNfc3RhdGUtPndtLnNrbC5vcHRpbWFsLnBsYW5lc1twbGFuZV9p
ZF07CiAKQEAgLTQyOTYsNDYgKzQyOTYsMzEgQEAgc3RhdGljIHZvaWQKIHNrbF9kZGJfZ2V0X2h3
X3BsYW5lX3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCSAgIGNv
bnN0IGVudW0gcGlwZSBwaXBlLAogCQkJICAgY29uc3QgZW51bSBwbGFuZV9pZCBwbGFuZV9pZCwK
LQkJCSAgIHN0cnVjdCBza2xfZGRiX2VudHJ5ICpkZGJfeSwKLQkJCSAgIHN0cnVjdCBza2xfZGRi
X2VudHJ5ICpkZGJfdXYpCisJCQkgICBzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSAqZGRiLAorCQkJICAg
c3RydWN0IHNrbF9kZGJfZW50cnkgKmRkYl95KQogewotCXUzMiB2YWwsIHZhbDI7Ci0JdTMyIGZv
dXJjYyA9IDA7CisJdTMyIHZhbDsKIAogCS8qIEN1cnNvciBkb2Vzbid0IHN1cHBvcnQgTlYxMi9w
bGFuYXIsIHNvIG5vIGV4dHJhIGNhbGN1bGF0aW9uIG5lZWRlZCAqLwogCWlmIChwbGFuZV9pZCA9
PSBQTEFORV9DVVJTT1IpIHsKIAkJdmFsID0gSTkxNV9SRUFEKENVUl9CVUZfQ0ZHKHBpcGUpKTsK
LQkJc2tsX2RkYl9lbnRyeV9pbml0X2Zyb21faHcoZGRiX3ksIHZhbCk7CisJCXNrbF9kZGJfZW50
cnlfaW5pdF9mcm9tX2h3KGRkYiwgdmFsKTsKIAkJcmV0dXJuOwogCX0KIAotCXZhbCA9IEk5MTVf
UkVBRChQTEFORV9DVEwocGlwZSwgcGxhbmVfaWQpKTsKKwl2YWwgPSBJOTE1X1JFQUQoUExBTkVf
QlVGX0NGRyhwaXBlLCBwbGFuZV9pZCkpOworCXNrbF9kZGJfZW50cnlfaW5pdF9mcm9tX2h3KGRk
YiwgdmFsKTsKIAotCS8qIE5vIEREQiBhbGxvY2F0ZWQgZm9yIGRpc2FibGVkIHBsYW5lcyAqLwot
CWlmICh2YWwgJiBQTEFORV9DVExfRU5BQkxFKQotCQlmb3VyY2MgPSBza2xfZm9ybWF0X3RvX2Zv
dXJjYyh2YWwgJiBQTEFORV9DVExfRk9STUFUX01BU0ssCi0JCQkJCSAgICAgIHZhbCAmIFBMQU5F
X0NUTF9PUkRFUl9SR0JYLAotCQkJCQkgICAgICB2YWwgJiBQTEFORV9DVExfQUxQSEFfTUFTSyk7
Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkgewotCQl2YWwgPSBJOTE1X1JFQUQo
UExBTkVfQlVGX0NGRyhwaXBlLCBwbGFuZV9pZCkpOwotCQlza2xfZGRiX2VudHJ5X2luaXRfZnJv
bV9odyhkZGJfeSwgdmFsKTsKLQl9IGVsc2UgewotCQl2YWwgPSBJOTE1X1JFQUQoUExBTkVfQlVG
X0NGRyhwaXBlLCBwbGFuZV9pZCkpOwotCQl2YWwyID0gSTkxNV9SRUFEKFBMQU5FX05WMTJfQlVG
X0NGRyhwaXBlLCBwbGFuZV9pZCkpOwotCi0JCWlmIChmb3VyY2MgJiYKLQkJICAgIGRybV9mb3Jt
YXRfaW5mb19pc195dXZfc2VtaXBsYW5hcihkcm1fZm9ybWF0X2luZm8oZm91cmNjKSkpCi0JCQlz
d2FwKHZhbCwgdmFsMik7CisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCisJCXJldHVy
bjsKIAotCQlza2xfZGRiX2VudHJ5X2luaXRfZnJvbV9odyhkZGJfeSwgdmFsKTsKLQkJc2tsX2Rk
Yl9lbnRyeV9pbml0X2Zyb21faHcoZGRiX3V2LCB2YWwyKTsKLQl9CisJdmFsID0gSTkxNV9SRUFE
KFBMQU5FX05WMTJfQlVGX0NGRyhwaXBlLCBwbGFuZV9pZCkpOworCXNrbF9kZGJfZW50cnlfaW5p
dF9mcm9tX2h3KGRkYl95LCB2YWwpOwogfQogCiB2b2lkIHNrbF9waXBlX2RkYl9nZXRfaHdfc3Rh
dGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCi0JCQkgICAgICAgc3RydWN0IHNrbF9kZGJfZW50
cnkgKmRkYl95LAotCQkJICAgICAgIHN0cnVjdCBza2xfZGRiX2VudHJ5ICpkZGJfdXYpCisJCQkg
ICAgICAgc3RydWN0IHNrbF9kZGJfZW50cnkgKmRkYiwKKwkJCSAgICAgICBzdHJ1Y3Qgc2tsX2Rk
Yl9lbnRyeSAqZGRiX3kpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJZW51bSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2RvbWFp
biBwb3dlcl9kb21haW47CkBAIC00MzUxLDggKzQzMzYsOCBAQCB2b2lkIHNrbF9waXBlX2RkYl9n
ZXRfaHdfc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJZm9yX2VhY2hfcGxhbmVfaWRf
b25fY3J0YyhjcnRjLCBwbGFuZV9pZCkKIAkJc2tsX2RkYl9nZXRfaHdfcGxhbmVfc3RhdGUoZGV2
X3ByaXYsIHBpcGUsCiAJCQkJCSAgIHBsYW5lX2lkLAotCQkJCQkgICAmZGRiX3lbcGxhbmVfaWRd
LAotCQkJCQkgICAmZGRiX3V2W3BsYW5lX2lkXSk7CisJCQkJCSAgICZkZGJbcGxhbmVfaWRdLAor
CQkJCQkgICAmZGRiX3lbcGxhbmVfaWRdKTsKIAogCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0KGRl
dl9wcml2LCBwb3dlcl9kb21haW4sIHdha2VyZWYpOwogfQpAQCAtNDgzOSw4ICs0ODI0LDggQEAg
c2tsX2FsbG9jYXRlX3BpcGVfZGRiKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAog
CWludCByZXQ7CiAKIAkvKiBDbGVhciB0aGUgcGFydGl0aW9uaW5nIGZvciBkaXNhYmxlZCBwbGFu
ZXMuICovCisJbWVtc2V0KGNydGNfc3RhdGUtPndtLnNrbC5wbGFuZV9kZGIsIDAsIHNpemVvZihj
cnRjX3N0YXRlLT53bS5za2wucGxhbmVfZGRiKSk7CiAJbWVtc2V0KGNydGNfc3RhdGUtPndtLnNr
bC5wbGFuZV9kZGJfeSwgMCwgc2l6ZW9mKGNydGNfc3RhdGUtPndtLnNrbC5wbGFuZV9kZGJfeSkp
OwotCW1lbXNldChjcnRjX3N0YXRlLT53bS5za2wucGxhbmVfZGRiX3V2LCAwLCBzaXplb2YoY3J0
Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYl91dikpOwogCiAJaWYgKCFjcnRjX3N0YXRlLT5ody5h
Y3RpdmUpIHsKIAkJc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUgPQpAQCAtNDg4OSw3
ICs0ODc0LDcgQEAgc2tsX2FsbG9jYXRlX3BpcGVfZGRiKHN0cnVjdCBpbnRlbF9hdG9taWNfc3Rh
dGUgKnN0YXRlLAogCS8qIEFsbG9jYXRlIGZpeGVkIG51bWJlciBvZiBibG9ja3MgZm9yIGN1cnNv
ci4gKi8KIAlpdGVyLnRvdGFsW1BMQU5FX0NVUlNPUl0gPSBza2xfY3Vyc29yX2FsbG9jYXRpb24o
Y3J0Y19zdGF0ZSwgbnVtX2FjdGl2ZSk7CiAJaXRlci5zaXplIC09IGl0ZXIudG90YWxbUExBTkVf
Q1VSU09SXTsKLQlza2xfZGRiX2VudHJ5X2luaXQoJmNydGNfc3RhdGUtPndtLnNrbC5wbGFuZV9k
ZGJfeVtQTEFORV9DVVJTT1JdLAorCXNrbF9kZGJfZW50cnlfaW5pdCgmY3J0Y19zdGF0ZS0+d20u
c2tsLnBsYW5lX2RkYltQTEFORV9DVVJTT1JdLAogCQkJICAgYWxsb2MtPmVuZCAtIGl0ZXIudG90
YWxbUExBTkVfQ1VSU09SXSwgYWxsb2MtPmVuZCk7CiAKIAlpZiAoaXRlci5kYXRhX3JhdGUgPT0g
MCkKQEAgLTQ5NjgsMTAgKzQ5NTMsMTAgQEAgc2tsX2FsbG9jYXRlX3BpcGVfZGRiKHN0cnVjdCBp
bnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCS8qIFNldCB0aGUgYWN0dWFsIEREQiBzdGFydC9l
bmQgcG9pbnRzIGZvciBlYWNoIHBsYW5lICovCiAJaXRlci5zdGFydCA9IGFsbG9jLT5zdGFydDsK
IAlmb3JfZWFjaF9wbGFuZV9pZF9vbl9jcnRjKGNydGMsIHBsYW5lX2lkKSB7Ci0JCXN0cnVjdCBz
a2xfZGRiX2VudHJ5ICpwbGFuZV9hbGxvYyA9CisJCXN0cnVjdCBza2xfZGRiX2VudHJ5ICpkZGIg
PQorCQkJJmNydGNfc3RhdGUtPndtLnNrbC5wbGFuZV9kZGJbcGxhbmVfaWRdOworCQlzdHJ1Y3Qg
c2tsX2RkYl9lbnRyeSAqZGRiX3kgPQogCQkJJmNydGNfc3RhdGUtPndtLnNrbC5wbGFuZV9kZGJf
eVtwbGFuZV9pZF07Ci0JCXN0cnVjdCBza2xfZGRiX2VudHJ5ICp1dl9wbGFuZV9hbGxvYyA9Ci0J
CQkmY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYl91dltwbGFuZV9pZF07CiAKIAkJaWYgKHBs
YW5lX2lkID09IFBMQU5FX0NVUlNPUikKIAkJCWNvbnRpbnVlOwpAQCAtNDk4MiwxMiArNDk2Nywx
NSBAQCBza2xfYWxsb2NhdGVfcGlwZV9kZGIoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3Rh
dGUsCiAKIAkJLyogTGVhdmUgZGlzYWJsZWQgcGxhbmVzIGF0ICgwLDApICovCiAJCWlmIChpdGVy
LnRvdGFsW3BsYW5lX2lkXSkKLQkJCWl0ZXIuc3RhcnQgPSBza2xfZGRiX2VudHJ5X2luaXQocGxh
bmVfYWxsb2MsIGl0ZXIuc3RhcnQsCisJCQlpdGVyLnN0YXJ0ID0gc2tsX2RkYl9lbnRyeV9pbml0
KGRkYiwgaXRlci5zdGFydCwKIAkJCQkJCQlpdGVyLnN0YXJ0ICsgaXRlci50b3RhbFtwbGFuZV9p
ZF0pOwogCi0JCWlmIChpdGVyLnV2X3RvdGFsW3BsYW5lX2lkXSkKLQkJCWl0ZXIuc3RhcnQgPSBz
a2xfZGRiX2VudHJ5X2luaXQodXZfcGxhbmVfYWxsb2MsIGl0ZXIuc3RhcnQsCisJCWlmIChpdGVy
LnV2X3RvdGFsW3BsYW5lX2lkXSkgeworCQkJLyogaGFyZHdhcmUgd2FudHMgdGhlc2Ugc3dhcHBl
ZCAqLworCQkJKmRkYl95ID0gKmRkYjsKKwkJCWl0ZXIuc3RhcnQgPSBza2xfZGRiX2VudHJ5X2lu
aXQoZGRiLCBpdGVyLnN0YXJ0LAogCQkJCQkJCWl0ZXIuc3RhcnQgKyBpdGVyLnV2X3RvdGFsW3Bs
YW5lX2lkXSk7CisJCX0KIAl9CiAKIAkvKgpAQCAtNTY0NywxMCArNTYzNSwxMCBAQCB2b2lkIHNr
bF93cml0ZV9wbGFuZV93bShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCWVudW0gcGlwZSBw
aXBlID0gcGxhbmUtPnBpcGU7CiAJY29uc3Qgc3RydWN0IHNrbF9wbGFuZV93bSAqd20gPQogCQkm
Y3J0Y19zdGF0ZS0+d20uc2tsLm9wdGltYWwucGxhbmVzW3BsYW5lX2lkXTsKKwljb25zdCBzdHJ1
Y3Qgc2tsX2RkYl9lbnRyeSAqZGRiID0KKwkJJmNydGNfc3RhdGUtPndtLnNrbC5wbGFuZV9kZGJb
cGxhbmVfaWRdOwogCWNvbnN0IHN0cnVjdCBza2xfZGRiX2VudHJ5ICpkZGJfeSA9CiAJCSZjcnRj
X3N0YXRlLT53bS5za2wucGxhbmVfZGRiX3lbcGxhbmVfaWRdOwotCWNvbnN0IHN0cnVjdCBza2xf
ZGRiX2VudHJ5ICpkZGJfdXYgPQotCQkmY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYl91dltw
bGFuZV9pZF07CiAKIAlmb3IgKGxldmVsID0gMDsgbGV2ZWwgPD0gbWF4X2xldmVsOyBsZXZlbCsr
KSB7CiAJCWNvbnN0IHN0cnVjdCBza2xfd21fbGV2ZWwgKndtX2xldmVsOwpAQCAtNTY2MywxOSAr
NTY1MSwxNCBAQCB2b2lkIHNrbF93cml0ZV9wbGFuZV93bShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBs
YW5lLAogCXNrbF93cml0ZV93bV9sZXZlbChkZXZfcHJpdiwgUExBTkVfV01fVFJBTlMocGlwZSwg
cGxhbmVfaWQpLAogCQkJICAgJndtLT50cmFuc193bSk7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA+PSAxMSkgewotCQlza2xfZGRiX2VudHJ5X3dyaXRlKGRldl9wcml2LAotCQkJCSAgICBQ
TEFORV9CVUZfQ0ZHKHBpcGUsIHBsYW5lX2lkKSwgZGRiX3kpOworCXNrbF9kZGJfZW50cnlfd3Jp
dGUoZGV2X3ByaXYsCisJCQkgICAgUExBTkVfQlVGX0NGRyhwaXBlLCBwbGFuZV9pZCksIGRkYik7
CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKIAkJcmV0dXJuOwotCX0KIAotCWlm
ICh3bS0+aXNfcGxhbmFyKQotCQlzd2FwKGRkYl95LCBkZGJfdXYpOwotCi0Jc2tsX2RkYl9lbnRy
eV93cml0ZShkZXZfcHJpdiwKLQkJCSAgICBQTEFORV9CVUZfQ0ZHKHBpcGUsIHBsYW5lX2lkKSwg
ZGRiX3kpOwogCXNrbF9kZGJfZW50cnlfd3JpdGUoZGV2X3ByaXYsCi0JCQkgICAgUExBTkVfTlYx
Ml9CVUZfQ0ZHKHBpcGUsIHBsYW5lX2lkKSwgZGRiX3V2KTsKKwkJCSAgICBQTEFORV9OVjEyX0JV
Rl9DRkcocGlwZSwgcGxhbmVfaWQpLCBkZGJfeSk7CiB9CiAKIHZvaWQgc2tsX3dyaXRlX2N1cnNv
cl93bShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLApAQCAtNTY4OCw3ICs1NjcxLDcgQEAgdm9p
ZCBza2xfd3JpdGVfY3Vyc29yX3dtKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCiAJY29uc3Qg
c3RydWN0IHNrbF9wbGFuZV93bSAqd20gPQogCQkmY3J0Y19zdGF0ZS0+d20uc2tsLm9wdGltYWwu
cGxhbmVzW3BsYW5lX2lkXTsKIAljb25zdCBzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSAqZGRiID0KLQkJ
JmNydGNfc3RhdGUtPndtLnNrbC5wbGFuZV9kZGJfeVtwbGFuZV9pZF07CisJCSZjcnRjX3N0YXRl
LT53bS5za2wucGxhbmVfZGRiW3BsYW5lX2lkXTsKIAogCWZvciAobGV2ZWwgPSAwOyBsZXZlbCA8
PSBtYXhfbGV2ZWw7IGxldmVsKyspIHsKIAkJY29uc3Qgc3RydWN0IHNrbF93bV9sZXZlbCAqd21f
bGV2ZWw7CkBAIC01NzY1LDEwICs1NzQ4LDEwIEBAIHNrbF9kZGJfYWRkX2FmZmVjdGVkX3BsYW5l
cyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUsCiAJCXN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGU7CiAJCWVudW0gcGxhbmVfaWQgcGxhbmVf
aWQgPSBwbGFuZS0+aWQ7CiAKLQkJaWYgKHNrbF9kZGJfZW50cnlfZXF1YWwoJm9sZF9jcnRjX3N0
YXRlLT53bS5za2wucGxhbmVfZGRiX3lbcGxhbmVfaWRdLAotCQkJCQkmbmV3X2NydGNfc3RhdGUt
PndtLnNrbC5wbGFuZV9kZGJfeVtwbGFuZV9pZF0pICYmCi0JCSAgICBza2xfZGRiX2VudHJ5X2Vx
dWFsKCZvbGRfY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYl91dltwbGFuZV9pZF0sCi0JCQkJ
CSZuZXdfY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYl91dltwbGFuZV9pZF0pKQorCQlpZiAo
c2tsX2RkYl9lbnRyeV9lcXVhbCgmb2xkX2NydGNfc3RhdGUtPndtLnNrbC5wbGFuZV9kZGJbcGxh
bmVfaWRdLAorCQkJCQkmbmV3X2NydGNfc3RhdGUtPndtLnNrbC5wbGFuZV9kZGJbcGxhbmVfaWRd
KSAmJgorCQkgICAgc2tsX2RkYl9lbnRyeV9lcXVhbCgmb2xkX2NydGNfc3RhdGUtPndtLnNrbC5w
bGFuZV9kZGJfeVtwbGFuZV9pZF0sCisJCQkJCSZuZXdfY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5l
X2RkYl95W3BsYW5lX2lkXSkpCiAJCQljb250aW51ZTsKIAogCQlwbGFuZV9zdGF0ZSA9IGludGVs
X2F0b21pY19nZXRfcGxhbmVfc3RhdGUoc3RhdGUsIHBsYW5lKTsKQEAgLTU4NDcsOCArNTgzMCw4
IEBAIHNrbF9wcmludF93bV9jaGFuZ2VzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRl
KQogCQkJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKIAkJCWNvbnN0IHN0cnVj
dCBza2xfZGRiX2VudHJ5ICpvbGQsICpuZXc7CiAKLQkJCW9sZCA9ICZvbGRfY3J0Y19zdGF0ZS0+
d20uc2tsLnBsYW5lX2RkYl95W3BsYW5lX2lkXTsKLQkJCW5ldyA9ICZuZXdfY3J0Y19zdGF0ZS0+
d20uc2tsLnBsYW5lX2RkYl95W3BsYW5lX2lkXTsKKwkJCW9sZCA9ICZvbGRfY3J0Y19zdGF0ZS0+
d20uc2tsLnBsYW5lX2RkYltwbGFuZV9pZF07CisJCQluZXcgPSAmbmV3X2NydGNfc3RhdGUtPndt
LnNrbC5wbGFuZV9kZGJbcGxhbmVfaWRdOwogCiAJCQlpZiAoc2tsX2RkYl9lbnRyeV9lcXVhbChv
bGQsIG5ldykpCiAJCQkJY29udGludWU7Ci0tIAoyLjI2LjIKCl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwt
Z2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9t
YWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7DEA2B3924
	for <lists+intel-gfx@lfdr.de>; Mon, 16 Sep 2019 13:10:28 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id AEC826E21E;
	Mon, 16 Sep 2019 11:10:25 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 84C726E21E
 for <intel-gfx@lists.freedesktop.org>; Mon, 16 Sep 2019 11:10:23 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from localhost (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP (TLS) id
 18505438-1500050 for multiple; Mon, 16 Sep 2019 12:10:20 +0100
MIME-Version: 1.0
From: Chris Wilson <chris@chris-wilson.co.uk>
User-Agent: alot/0.6
To: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>,
 intel-gfx@lists.freedesktop.org
References: <20190902040303.14195-1-chris@chris-wilson.co.uk>
 <20190902040303.14195-13-chris@chris-wilson.co.uk>
 <5ced7c80-b410-1f86-68da-c19b8e1798ec@linux.intel.com>
In-Reply-To: <5ced7c80-b410-1f86-68da-c19b8e1798ec@linux.intel.com>
Message-ID: <156863221755.4154.16731210394321488180@skylake-alporthouse-com>
Date: Mon, 16 Sep 2019 12:10:17 +0100
Subject: Re: [Intel-gfx] [PATCH 13/21] drm/i915: Pull i915_vma_pin under the
 vm->mutex
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UXVvdGluZyBUdnJ0a28gVXJzdWxpbiAoMjAxOS0wOS0xNiAxMToxMzoyMykKPiAKPiBPbiAwMi8w
OS8yMDE5IDA1OjAyLCBDaHJpcyBXaWxzb24gd3JvdGU6Cj4gPiBSZXBsYWNlIHRoZSBzdHJ1Y3Rf
bXV0ZXggcmVxdWlyZW1lbnQgZm9yIHBpbm5pbmcgdGhlIGk5MTVfdm1hIHdpdGggdGhlCj4gPiBs
b2NhbCB2bS0+bXV0ZXggaW5zdGVhZC4gTm90ZSB0aGF0IHRoZSB2bS0+bXV0ZXggaXMgdGFpbnRl
ZCBieSB0aGUKPiA+IHNocmlua2VyICh3ZSByZXF1aXJlIHVuYmluZGluZyBmcm9tIGluc2lkZSBm
cy1yZWNsYWltKSBhbmQgc28gd2UgY2Fubm90Cj4gPiBhbGxvY2F0ZSB3aGlsZSBob2xkaW5nIHRo
YXQgbXV0ZXguIEluc3RlYWQgd2UgaGF2ZSB0byBwcmVhbGxvY2F0ZQo+ID4gd29ya2VycyB0byBk
byBhbGxvY2F0ZSBhbmQgYXBwbHkgdGhlIFBURSB1cGRhdGVzIGFmdGVyIHdlIGhhdmUgd2UKPiA+
IHJlc2VydmVkIHRoZWlyIHNsb3QgaW4gdGhlIGRybV9tbSAodXNpbmcgZmVuY2VzIHRvIG9yZGVy
IHRoZSBQVEUgd3JpdGVzCj4gPiB3aXRoIHRoZSBHUFUgd29yayBhbmQgd2l0aCBsYXRlciB1bmJp
bmQpLgo+IAo+IENhbiB5b3UgcHV0IHNvbWUgcGFyYWdyYXBocyBpbnRvIHRoZSBjb21taXQgZGVz
Y3JpYmluZyB0aGUgCj4gaW5mcmFzdHJ1Y3R1cmUgY2hhbmdlcz8gTGlrZSBjaGFuZ2VzIHRvIGFj
dGl2ZSB0cmFja2VyIGF0IGxlYXN0LgoKWW91IG1lYW4gdGhlIGFkZGl0aW9uIG9mIHRoZSBwcmVh
bGxvY2F0ZWQgbm9kZT8KCj4gVGhlbiBjb21tZW50YXJ5IG9uIGVmZmVjdHMgb24gc2hyaW5rZXIs
IGZlbmNlcywgb2JqZWN0IG1hbmFnZW1lbnQsIAo+IGV4ZWNidWYsIGJhc2ljYWxseSBhbGwgbWFq
b3IgcGFydHMgb2YgdGhlIGNvZGUgd2hpY2ggaGF2ZSBub3cgYmVlbiAKPiBmdW5kYW1lbnRhbGx5
IGltcHJvdmVkIG9yIGNoYW5nZWQuIEl0IHdvdWxkIGhlbHAgd2l0aCByZXZpZXcuIEl0J3MgYSAK
PiBjaHVua3kgcGF0Y2gvY2hhbmdlIGFuZCBJIHRoaW5rIGl0IG5lZWRzIHNvbWUgdGhlb3J5IG9m
IG9wZXJhdGlvbiB0ZXh0LgoKT2ZmIHRoZSB0b3Agb2YgbXkgaGVsZCwgdGhleSBhcmUgYWxsIGp1
c3QgbG9jayBzd2l0Y2hlcy4gVGhlIGZ1bmt5IHN0dWZmCmxpZXMgYXJvdW5kIGF2b2lkaW5nIGlu
dHJvZHVjaW5nIGEga3JlZiBmb3IgaTkxNV92bWEgYW5kIHRoYXQgcmVxdWlyZXMgYQp3aG9sZSBi
dW5jaCBvZiB0cnlsb2NrcyB0byBhdm9pZCBkb3VibGUtZnJlZXMuIChJIGRpZCBwbGFuIG9uIGhh
dmluZyBhCmtyZWYgaGVyZSwgYnV0IHRoYXQgbGVhZHMgdG8gcmV3cml0aW5nIG9iamVjdCBwYWdl
IHRyYWNraW5nIHdoaWNoIGlzIGluCml0cyBvd24gcXVhZ21pcmUuKQoKPiA+IGRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2JsdC5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsaWVudF9ibHQuYwo+ID4gaW5kZXggZjk5OTIw
NjUyNzUxLi45ZTcyYjQyYTg2ZjUgMTAwNjQ0Cj4gPiAtLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fY2xpZW50X2JsdC5jCj4gPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fY2xpZW50X2JsdC5jCj4gPiBAQCAtMTUyLDYgKzE1MiwxNyBAQCBzdGF0
aWMgdm9pZCBjbGVhcl9wYWdlc19kbWFfZmVuY2VfY2Ioc3RydWN0IGRtYV9mZW5jZSAqZmVuY2Us
Cj4gPiAgICAgICBpcnFfd29ya19xdWV1ZSgmdy0+aXJxX3dvcmspOwo+ID4gICB9Cj4gPiAgIAo+
ID4gK3N0YXRpYyBpbnQgbW92ZV90b19hY3RpdmUoc3RydWN0IGk5MTVfdm1hICp2bWEsIHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxKQo+ID4gK3sKPiA+ICsgICAgIGludCBlcnI7Cj4gPiArCj4gPiAr
ICAgICBlcnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfYWN0aXZlKHJxLCAmdm1hLT5hY3RpdmUpOwo+
ID4gKyAgICAgaWYgKGVycikKPiA+ICsgICAgICAgICAgICAgcmV0dXJuIGVycjsKPiA+ICsKPiA+
ICsgICAgIHJldHVybiBpOTE1X2FjdGl2ZV9yZWYoJnZtYS0+YWN0aXZlLCBycS0+dGltZWxpbmUs
IHJxKTsKPiA+ICt9Cj4gPiArCj4gPiAgIHN0YXRpYyB2b2lkIGNsZWFyX3BhZ2VzX3dvcmtlcihz
dHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCj4gPiAgIHsKPiA+ICAgICAgIHN0cnVjdCBjbGVhcl9w
YWdlc193b3JrICp3ID0gY29udGFpbmVyX29mKHdvcmssIHR5cGVvZigqdyksIHdvcmspOwo+ID4g
QEAgLTIxMSw3ICsyMjIsNyBAQCBzdGF0aWMgdm9pZCBjbGVhcl9wYWdlc193b3JrZXIoc3RydWN0
IHdvcmtfc3RydWN0ICp3b3JrKQo+ID4gICAgICAgICoga2VlcCB0cmFjayBvZiB0aGUgR1BVIGFj
dGl2aXR5IHdpdGhpbiB0aGlzIHZtYS9yZXF1ZXN0LCBhbmQKPiA+ICAgICAgICAqIHByb3BhZ2F0
ZSB0aGUgc2lnbmFsIGZyb20gdGhlIHJlcXVlc3QgdG8gdy0+ZG1hLgo+ID4gICAgICAgICovCj4g
PiAtICAgICBlcnIgPSBpOTE1X2FjdGl2ZV9yZWYoJnZtYS0+YWN0aXZlLCBycS0+dGltZWxpbmUs
IHJxKTsKPiA+ICsgICAgIGVyciA9IG1vdmVfdG9fYWN0aXZlKHZtYSwgcnEpOwo+IAo+IFdoYXQg
aXMgaGFwcGVuaW5nIGhlcmU/IEl0IHdhc24ndCBzdWZmaWNpZW50bHkgb3JkZXJlZCBiZWZvcmUg
b3IgCj4gc29tZXRoaW5nIGNoYW5nZXMgd2l0aCB0aGlzIHBhdGNoPwoKV2UgYXJlIGludHJvZHVj
aW5nIGFuIGluZGVwZW5kZW50IG9yZGVyaW5nIGNvbnN0cmFpbnRzLiBUaGUgY2xlYXIgcGFnZQp3
b3JrZXIgaXMgaXRzZWxmIGludGVyd2luZWQgd2l0aCB0aGUgb2JqLT5yZXN2IGJ1dCBvbmUgcGFy
dCBvZiB0aGUKb3BlcmF0aW9uIG11c3QgYmUgc2VyaWFsaXNlZCB3aXRoIHRoZSBhc3luY2hyb25v
dXMgYmluZGluZywgYW5kIHdlIGRvbid0CndhbnQgdGhhdCBhc3luYyBiaW5kaW5nIHRvIGFmZmVj
dCB0aGUgb2JqZWN0IGdsb2JhbGx5LiBTbyB0aGUgY2xlYXItcGFnZQp3b3JrZXJzIG9wZW5jb2Rl
cyB0aGUgYXdhaXRzIGZyb20gaTkxNV92bWFfbW92ZV90b19hY3RpdmUsIGJ1dCBkb2VzIG5vdAp3
YW50IHRvIHBhcnRha2UgaW4gdGhlIGZlbmNlIGV4cG9ydCAoYXMgdGhlIG9wZXJhdGlvbnMgaXMg
YWxyZWFkeSBpbiB0aGUKb2JqLT5yZXN2KS4KCj4gPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9jb250ZXh0LmMKPiA+IGluZGV4IGYxYzBlNWQ5NThmMy4uNjUzZjcyNzUzMDZh
IDEwMDY0NAo+ID4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRl
eHQuYwo+ID4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQu
Ywo+ID4gQEAgLTMxMyw4ICszMTMsNiBAQCBzdGF0aWMgdm9pZCBpOTE1X2dlbV9jb250ZXh0X2Zy
ZWUoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKPiA+ICAgICAgIEdFTV9CVUdfT04oIWk5
MTVfZ2VtX2NvbnRleHRfaXNfY2xvc2VkKGN0eCkpOwo+ID4gICAKPiA+ICAgICAgIHJlbGVhc2Vf
aHdfaWQoY3R4KTsKPiA+IC0gICAgIGlmIChjdHgtPnZtKQo+ID4gLSAgICAgICAgICAgICBpOTE1
X3ZtX3B1dChjdHgtPnZtKTsKPiAKPiBDb250ZXh0cyBubyBsb25nZXIgaG9sZCBhIHJlZmVyZW5j
ZSB0byB2bT8gT25seSB2bWFzPwoKRHJvcHBlZCBlYXJsaWVyIG9uIGNsb3NlIHJhdGhlciB0aGFu
IGZpbmFsIHB1dC4uLgoKPiA+IEBAIC0zNzksOSArMzc3LDEzIEBAIHZvaWQgaTkxNV9nZW1fY29u
dGV4dF9yZWxlYXNlKHN0cnVjdCBrcmVmICpyZWYpCj4gPiAgIAo+ID4gICBzdGF0aWMgdm9pZCBj
b250ZXh0X2Nsb3NlKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCj4gPiAgIHsKPiA+ICsg
ICAgIGk5MTVfZ2VtX2NvbnRleHRfc2V0X2Nsb3NlZChjdHgpOwo+ID4gKwo+ID4gKyAgICAgaWYg
KGN0eC0+dm0pCj4gPiArICAgICAgICAgICAgIGk5MTVfdm1fY2xvc2UoY3R4LT52bSk7Cj4gCj4g
QnV0IG5vdyBjbG9zZWQgY29udGV4dCBtZWFuIGNsb3NlZCB2bSwgYnV0IHdoYXQgYWJvdXQgc2hh
cmVkIHZtcz8gSXMgCj4gb3Blbi9jbG9zZV92bSBub3cgY291bnRlZD8KClllcy4gdm0tPm9wZW5f
Y291bnQuIFRoaXMgaXMgYWxsIHRvIGF2b2lkIGRvdWJsZS1mcmVlIG9mIHRoZSB2bWEgZnJvbQpv
YmplY3QtY2xvc2UgYW5kIHZtLWNsb3NlLiBCdXQgY2xvc2luZyBlYXJsaWVyIHRpZGllcyB1cCB0
aGUgdm0gcmVsZWFzZQphbmQgcmVzdG9yZXMgc29tZSBlYXJsaWVyIGJlaGF2aW91ciB0byBhdm9p
ZCB1bmJpbmRpbmcgZnJvbSBhIGRlYWQgdm0uCgo+ID4gLSAgICAgICAgICAgICAgICAgICAgIHJl
dCA9IGk5MTVfdm1hX2JpbmQodm1hLCBjYWNoZV9sZXZlbCwgUElOX1VQREFURSk7Cj4gPiArICAg
ICAgICAgICAgICAgICAgICAgLyogV2FpdCBmb3IgYW4gZWFybGllciBhc3luYyBiaW5kICovCj4g
PiArICAgICAgICAgICAgICAgICAgICAgcmV0ID0gaTkxNV9hY3RpdmVfd2FpdCgmdm1hLT5hY3Rp
dmUpOwo+ID4gKyAgICAgICAgICAgICAgICAgICAgIGlmIChyZXQpCj4gPiArICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICByZXR1cm4gcmV0Owo+ID4gKwo+ID4gKyAgICAgICAgICAgICAgICAg
ICAgIHJldCA9IGk5MTVfdm1hX2JpbmQodm1hLCBjYWNoZV9sZXZlbCwgUElOX1VQREFURSwgTlVM
TCk7Cj4gCj4gV2FpdGluZyBzaG91bGQgbm90IGJlIGltcGxpZWQgaW4gdGhlIGJpbmQ/IEkgYW0g
YXNzdW1pbmcgYXQgbGVhc3QgdGhlcmUgCj4gd2lsbCBiZSBtYW55IGNhbGxlcnMgdG8gYmluZCBh
bmQgbGlrZSB0aGlzIGFsbCBvZiB0aGVtIHdpbGwgaGF2ZSB0byBrbm93IAo+IHRvIGRvIGk5MTVf
YWN0aXZlX3dhaXQgZmlyc3Q/CgpOb3QgcmVhbGx5LCBpbW8sIGk5MTVfdm1hX2JpbmQoKSBpcyBh
IHNwZWNpYWwgY2FzZSBhcyBpdCBpcyB0aGUKbG93LWxldmVsIG9wZXJhdGlvbi4gQW5kIHdlIG9u
bHkgbmVlZCB0aGUgc3luYyBoZXJlIGFzIHdlIHBsYW4gdG8KcmV3cml0ZSB0aG9zZSBvbmdvaW5n
IG9wZXJhdGlvbnM7IGluIHRoZSBvdGhlciAobm9uLVVQREFURSkgY2FsbGVyLCB3ZQphcmUgYWRk
aW5nIGEgc2VwYXJhdGUgYmluZGluZyByYXRoZXIgdGhhbiBvdmVyd3JpdGluZyBleGlzdGluZy4K
Cj4gPiBAQCAtNDgzLDYgKzQ4Nyw3IEBAIHN0YXRpYyB2b2lkIGk5MTVfZ2VtX29iamVjdF9idW1w
X2luYWN0aXZlX2dndHQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKPiA+ICAgICAg
ICAgICAgICAgaWYgKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpCj4gPiAgICAg
ICAgICAgICAgICAgICAgICAgY29udGludWU7Cj4gPiAgIAo+ID4gKyAgICAgICAgICAgICBHRU1f
QlVHX09OKHZtYS0+dm0gIT0gJmk5MTUtPmdndHQudm0pOwo+ID4gICAgICAgICAgICAgICBsaXN0
X21vdmVfdGFpbCgmdm1hLT52bV9saW5rLCAmdm1hLT52bS0+Ym91bmRfbGlzdCk7Cj4gPiAgICAg
ICB9Cj4gPiAgICAgICBtdXRleF91bmxvY2soJmk5MTUtPmdndHQudm0ubXV0ZXgpOwo+ID4gZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCj4gPiBpbmRl
eCBjMDQ5MTk5YTFkZjUuLmMzZGQ4Y2U3ZTJiNyAxMDA2NDQKPiA+IC0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKPiA+ICsrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKPiA+IEBAIC01NTAsOCArNTUwLDEx
IEBAIGViX2FkZF92bWEoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsCj4gPiAgICAgICAgICAg
ICAgIGViX3VucmVzZXJ2ZV92bWEodm1hLCB2bWEtPmV4ZWNfZmxhZ3MpOwo+ID4gICAKPiA+ICAg
ICAgICAgICAgICAgbGlzdF9hZGRfdGFpbCgmdm1hLT5leGVjX2xpbmssICZlYi0+dW5ib3VuZCk7
Cj4gPiAtICAgICAgICAgICAgIGlmIChkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkp
Cj4gPiArICAgICAgICAgICAgIGlmIChkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkp
IHsKPiA+ICsgICAgICAgICAgICAgICAgICAgICBtdXRleF9sb2NrKCZ2bWEtPnZtLT5tdXRleCk7
Cj4gPiAgICAgICAgICAgICAgICAgICAgICAgZXJyID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7Cj4g
PiArICAgICAgICAgICAgICAgICAgICAgbXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7Cj4g
Cj4gU2hvdWxkIHRoZXJlIGJlIF9faTkxNV92bWFfdW5iaW5kIHdoaWNoIGFzc2VydHMgdGhlIGxv
Y2sgYW5kIAo+IGk5MTVfdm1hX3VuYmluZCB3aGljaCB0YWtlcyBpdD8KCkNvdWxkIGRvLCBpdCBz
ZWVtcyB0byBiZSBhbiBldmVuIHNwbGl0LiBJIGhhZCBhIGdvYWwgdGhhdAppOTE1X3ZtYV91bmJp
bmQoKSBzaG91bGQgZXZhcG9yYXRlOyBpdCBzaG91bGQgYmVjb21lIGEgcGlwZWxpbmVkCm9wZXJh
dGlvbiBmb3IgdGhlIG1vc3QgcGFydCwganVzdCB0aGUgc2hyaW5rZXIgYmVpbmcgYWx3YXlzIGFu
IGV4Y2VwdGlvbgphcyBvdXIgaW50ZXJmYWNlIHRoZXJlIGlzIGV4dGVybmFsLgoKPiA+ICt2b2lk
IGk5MTVfYWN0aXZlX3NldF9leGNsdXNpdmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsIHN0cnVj
dCBkbWFfZmVuY2UgKmYpCj4gPiArewo+ID4gKyAgICAgR0VNX0JVR19PTihpOTE1X2FjdGl2ZV9p
c19pZGxlKHJlZikpOwo+ID4gKwo+ID4gKyAgICAgZG1hX2ZlbmNlX2dldChmKTsKPiA+ICsKPiA+
ICsgICAgIHJjdV9yZWFkX2xvY2soKTsKPiA+ICsgICAgIGlmIChyY3VfYWNjZXNzX3BvaW50ZXIo
cmVmLT5leGNsKSkgewo+ID4gKyAgICAgICAgICAgICBzdHJ1Y3QgZG1hX2ZlbmNlICpvbGQ7Cj4g
PiArCj4gPiArICAgICAgICAgICAgIG9sZCA9IGRtYV9mZW5jZV9nZXRfcmN1X3NhZmUoJnJlZi0+
ZXhjbCk7Cj4gPiArICAgICAgICAgICAgIGlmIChvbGQpIHsKPiA+ICsgICAgICAgICAgICAgICAg
ICAgICBpZiAoZG1hX2ZlbmNlX3JlbW92ZV9jYWxsYmFjayhvbGQsICZyZWYtPmV4Y2xfY2IpKQo+
ID4gKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXRvbWljX2RlYygmcmVmLT5jb3VudCk7
Cj4gPiArICAgICAgICAgICAgICAgICAgICAgZG1hX2ZlbmNlX3B1dChvbGQpOwo+ID4gKyAgICAg
ICAgICAgICB9Cj4gPiArICAgICB9Cj4gPiArICAgICByY3VfcmVhZF91bmxvY2soKTsKPiA+ICsK
PiA+ICsgICAgIGF0b21pY19pbmMoJnJlZi0+Y291bnQpOwo+ID4gKyAgICAgcmN1X2Fzc2lnbl9w
b2ludGVyKHJlZi0+ZXhjbCwgZik7Cj4gPiArCj4gPiArICAgICBpZiAoZG1hX2ZlbmNlX2FkZF9j
YWxsYmFjayhmLCAmcmVmLT5leGNsX2NiLCBleGNsX2NiKSkgewo+ID4gKyAgICAgICAgICAgICBS
Q1VfSU5JVF9QT0lOVEVSKHJlZi0+ZXhjbCwgTlVMTCk7Cj4gPiArICAgICAgICAgICAgIGF0b21p
Y19kZWMoJnJlZi0+Y291bnQpOwo+ID4gKyAgICAgICAgICAgICBkbWFfZmVuY2VfcHV0KGYpOwo+
IAo+IElzIHRoaXMgc29tZSBzaWxlbnQgZmFpbHVyZSBwYXRoPwoKTm8sIGl0J3MganVzdCBhIHdl
aXJkIGluZGljYXRpb24gYnkgZG1hLWZlbmNlIHRoYXQgdGhlIGZlbmNlIHdhcyBhbHJlYWR5CnNp
Z25hbGVkLgoKPiA+ICAgaW50IGk5MTVfcmVxdWVzdF9hd2FpdF9hY3RpdmUoc3RydWN0IGk5MTVf
cmVxdWVzdCAqcnEsIHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQo+ID4gICB7Cj4gPiAtICAgICBz
dHJ1Y3QgYWN0aXZlX25vZGUgKml0LCAqbjsKPiA+IC0gICAgIGludCBlcnI7Cj4gPiAtCj4gPiAt
ICAgICBpZiAoUkJfRU1QVFlfUk9PVCgmcmVmLT50cmVlKSkKPiA+IC0gICAgICAgICAgICAgcmV0
dXJuIDA7Cj4gPiArICAgICBpbnQgZXJyID0gMDsKPiA+ICAgCj4gPiAtICAgICAvKiBhd2FpdCBh
bGxvY2F0ZXMgYW5kIHNvIHdlIG5lZWQgdG8gYXZvaWQgaGl0dGluZyB0aGUgc2hyaW5rZXIgKi8K
PiA+IC0gICAgIGVyciA9IGk5MTVfYWN0aXZlX2FjcXVpcmUocmVmKTsKPiA+IC0gICAgIGlmIChl
cnIpCj4gPiAtICAgICAgICAgICAgIHJldHVybiBlcnI7Cj4gPiArICAgICBpZiAocmN1X2FjY2Vz
c19wb2ludGVyKHJlZi0+ZXhjbCkpIHsKPiA+ICsgICAgICAgICAgICAgc3RydWN0IGRtYV9mZW5j
ZSAqZmVuY2U7Cj4gPiAgIAo+ID4gLSAgICAgbXV0ZXhfbG9jaygmcmVmLT5tdXRleCk7Cj4gPiAt
ICAgICByYnRyZWVfcG9zdG9yZGVyX2Zvcl9lYWNoX2VudHJ5X3NhZmUoaXQsIG4sICZyZWYtPnRy
ZWUsIG5vZGUpIHsKPiA+IC0gICAgICAgICAgICAgZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X2Fj
dGl2ZV9yZXF1ZXN0KHJxLCAmaXQtPmJhc2UpOwo+ID4gLSAgICAgICAgICAgICBpZiAoZXJyKQo+
ID4gLSAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwo+ID4gKyAgICAgICAgICAgICByY3VfcmVh
ZF9sb2NrKCk7Cj4gPiArICAgICAgICAgICAgIGZlbmNlID0gZG1hX2ZlbmNlX2dldF9yY3Vfc2Fm
ZSgmcmVmLT5leGNsKTsKPiA+ICsgICAgICAgICAgICAgcmN1X3JlYWRfdW5sb2NrKCk7Cj4gPiAr
ICAgICAgICAgICAgIGlmIChmZW5jZSkgewo+ID4gKyAgICAgICAgICAgICAgICAgICAgIGVyciA9
IGk5MTVfcmVxdWVzdF9hd2FpdF9kbWFfZmVuY2UocnEsIGZlbmNlKTsKPiA+ICsgICAgICAgICAg
ICAgICAgICAgICBkbWFfZmVuY2VfcHV0KGZlbmNlKTsKPiA+ICsgICAgICAgICAgICAgfQo+ID4g
ICAgICAgfQo+ID4gLSAgICAgbXV0ZXhfdW5sb2NrKCZyZWYtPm11dGV4KTsKPiA+ICAgCj4gPiAt
ICAgICBpOTE1X2FjdGl2ZV9yZWxlYXNlKHJlZik7Cj4gPiArICAgICAvKiBJbiB0aGUgZnV0dXJl
IHdlIG1heSBjaG9vc2UgdG8gYXdhaXQgb24gYWxsIGZlbmNlcyAqLwo+ID4gKwo+IAo+IFRoaXMg
aXMgY29tcGxldGVseSBjaGFuZ2VkIHRvIGp1c3Qgd2FpdCBvbiB0aGUgImV4Y2x1c2l2ZSIgZmVu
Y2U/IFdoYXQgCj4gYWJvdXQgdGhlIHRyZWUgb2Ygbm9kZXM/IEl0J3Mgc3RpbGwgaW4gdGhlIGRh
dGEgc3RydWN0dXJlIGFuZCBtYW5hZ2VkIAo+IGVsc2V3aGVyZS4gTm90IG5lZWRlZCBhbnkgbW9y
ZSB1bnRpbCAiZnV0dXJlIiBmcm9tIHRoZSBjb21tZW50PwoKSXQgd2FzIGFsbCBkZWFkIGNvZGUu
IFRoZSB1c2UgY2FzZSBJIGhhdmUgZm9yIGl0IGF0bSBpcyBwdXJlbHkgYWJvdXQKbWFuYWdpbmcg
dGhhdCBleGNsdXNpdmUgdGltZWxpbmUuCi1DaHJpcwpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBs
aXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1h
bi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id E6166CBC02
	for <lists+intel-gfx@lfdr.de>; Fri,  4 Oct 2019 15:40:58 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 13E236EB9C;
	Fri,  4 Oct 2019 13:40:52 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 463356EB87
 for <intel-gfx@lists.freedesktop.org>; Fri,  4 Oct 2019 13:40:41 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18723964-1500050 
 for multiple; Fri, 04 Oct 2019 14:40:20 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  4 Oct 2019 14:40:09 +0100
Message-Id: <20191004134015.13204-15-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191004134015.13204-1-chris@chris-wilson.co.uk>
References: <20191004134015.13204-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 14/20] drm/i915: Move context management under
 GEM
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

S2VlcCB0cmFjayBvZiB0aGUgR0VNIGNvbnRleHRzIHVuZGVybmVhdGggaTkxNS0+Z2VtLmNvbnRl
eHRzIGFuZCBhc3NpZ24KdGhlbSB0aGVpciBvd24gbG9jayBmb3IgdGhlIHB1cnBvc2VzIG9mIGxp
c3QgbWFuYWdlbWVudC4KCnYyOiBGb2N1cyBvbiBsb2NrIHRyYWNraW5nOyBjdHgtPnZtIGlzIHBy
b3RlY3RlZCBieSBjdHgtPm11dGV4CnYzOiBDb3JyZWN0IHNwbGl0IHdpdGggcmVtb3ZhbCBvZiBs
b2dpY2FsIEhXIElECgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdp
bHNvbi5jby51az4KQ2M6IFR2cnRrbyBVcnN1bGluIDx0dnJ0a28udXJzdWxpbkBpbnRlbC5jb20+
Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYyAgIHwgMTc3
ICsrKysrKysrKy0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2Nv
bnRleHQuaCAgIHwgIDI3ICsrLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4
dF90eXBlcy5oIHwgICAyICstCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVm
ZmVyLmMgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91c2Vy
cHRyLmMgICB8ICAgMyArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFn
ZXMuYyAgIHwgIDM2ICsrLS0KIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2Nv
bnRleHQuYyB8IDE2OCArKysrKysrKy0tLS0tLS0tLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL21vY2tfY29udGV4dC5jIHwgICA3ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9jb250ZXh0LmMgICAgICAgfCAgMTAgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Nl
bGZ0ZXN0X2NvbnRleHQuYyAgICB8ICAyNCArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Nl
bGZ0ZXN0X2hhbmdjaGVjay5jICB8ICAzOSArKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9z
ZWxmdGVzdF9scmMuYyAgICAgICAgfCAgIDYgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3Rfd29ya2Fyb3VuZHMuYyAgICB8ICAyMiArKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9z
Y2hlZHVsZXIuYyAgICAgICAgICB8ICAyNCArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZGVidWdmcy5jICAgICAgICAgICB8ICA1MCArKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kcnYuYyAgICAgICAgICAgICAgIHwgICAyIC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZHJ2LmggICAgICAgICAgICAgICB8ICAxNSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
ZW0uYyAgICAgICAgICAgICAgIHwgIDEwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dl
bV9ndHQuYyAgICAgICAgICAgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVy
Zi5jICAgICAgICAgICAgICB8ICAyNCArKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3lz
ZnMuYyAgICAgICAgICAgICB8ICA0MyArKy0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV90
cmFjZS5oICAgICAgICAgICAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaTkxNV9nZW0uYyAgICAgfCAgIDggLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV9nZW1fZXZpY3QuYyAgIHwgICAzIC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
OTE1X2dlbV9ndHQuYyB8ICAxNSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5
MTVfcmVxdWVzdC5jIHwgIDEyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV92bWEuYyAgICAgfCAgIDcgKy0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2Vt
X2RldmljZS5jICB8ICAgNiArLQogMjggZmlsZXMgY2hhbmdlZCwgMzk0IGluc2VydGlvbnMoKyks
IDM1NCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2Nv
bnRleHQuYwppbmRleCBjZDRmMzI3YjIzYmQuLjVkODIyMWM3YmE4MyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCkBAIC0yMTgsOSArMjE4LDEyIEBAIHN0
YXRpYyBzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lcyAqZGVmYXVsdF9lbmdpbmVzKHN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICpjdHgpCiAKIHN0YXRpYyB2b2lkIGk5MTVfZ2VtX2NvbnRleHRfZnJlZShz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQogewotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmN0
eC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJR0VNX0JVR19PTighaTkxNV9nZW1fY29udGV4
dF9pc19jbG9zZWQoY3R4KSk7CiAKKwlzcGluX2xvY2soJmN0eC0+aTkxNS0+Z2VtLmNvbnRleHRz
LmxvY2spOworCWxpc3RfZGVsKCZjdHgtPmxpbmspOworCXNwaW5fdW5sb2NrKCZjdHgtPmk5MTUt
PmdlbS5jb250ZXh0cy5sb2NrKTsKKwogCWZyZWVfZW5naW5lcyhyY3VfYWNjZXNzX3BvaW50ZXIo
Y3R4LT5lbmdpbmVzKSk7CiAJbXV0ZXhfZGVzdHJveSgmY3R4LT5lbmdpbmVzX211dGV4KTsKIApA
QCAtMjMwLDY3ICsyMzMsNTQgQEAgc3RhdGljIHZvaWQgaTkxNV9nZW1fY29udGV4dF9mcmVlKHN0
cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCiAJa2ZyZWUoY3R4LT5uYW1lKTsKIAlwdXRfcGlk
KGN0eC0+cGlkKTsKIAotCWxpc3RfZGVsKCZjdHgtPmxpbmspOwogCW11dGV4X2Rlc3Ryb3koJmN0
eC0+bXV0ZXgpOwogCiAJa2ZyZWVfcmN1KGN0eCwgcmN1KTsKIH0KIAotc3RhdGljIHZvaWQgY29u
dGV4dHNfZnJlZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3N0YXRpYyB2b2lkIGNv
bnRleHRzX2ZyZWVfYWxsKHN0cnVjdCBsbGlzdF9ub2RlICpsaXN0KQogewotCXN0cnVjdCBsbGlz
dF9ub2RlICpmcmVlZCA9IGxsaXN0X2RlbF9hbGwoJmk5MTUtPmNvbnRleHRzLmZyZWVfbGlzdCk7
CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwgKmNuOwogCi0JbG9ja2RlcF9hc3NlcnRf
aGVsZCgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQlsbGlzdF9mb3JfZWFjaF9lbnRyeV9z
YWZlKGN0eCwgY24sIGZyZWVkLCBmcmVlX2xpbmspCisJbGxpc3RfZm9yX2VhY2hfZW50cnlfc2Fm
ZShjdHgsIGNuLCBsaXN0LCBmcmVlX2xpbmspCiAJCWk5MTVfZ2VtX2NvbnRleHRfZnJlZShjdHgp
OwogfQogCi1zdGF0aWMgdm9pZCBjb250ZXh0c19mcmVlX2ZpcnN0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQorc3RhdGljIHZvaWQgY29udGV4dHNfZmx1c2hfZnJlZShzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dHMgKmdjKQogewotCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7Ci0J
c3RydWN0IGxsaXN0X25vZGUgKmZyZWVkOwotCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQlmcmVlZCA9IGxsaXN0X2RlbF9maXJzdCgmaTkxNS0+Y29u
dGV4dHMuZnJlZV9saXN0KTsKLQlpZiAoIWZyZWVkKQotCQlyZXR1cm47Ci0KLQljdHggPSBjb250
YWluZXJfb2YoZnJlZWQsIHR5cGVvZigqY3R4KSwgZnJlZV9saW5rKTsKLQlpOTE1X2dlbV9jb250
ZXh0X2ZyZWUoY3R4KTsKKwljb250ZXh0c19mcmVlX2FsbChsbGlzdF9kZWxfYWxsKCZnYy0+ZnJl
ZV9saXN0KSk7CiB9CiAKIHN0YXRpYyB2b2lkIGNvbnRleHRzX2ZyZWVfd29ya2VyKHN0cnVjdCB3
b3JrX3N0cnVjdCAqd29yaykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9Ci0J
CWNvbnRhaW5lcl9vZih3b3JrLCB0eXBlb2YoKmk5MTUpLCBjb250ZXh0cy5mcmVlX3dvcmspOwor
CXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0cyAqZ2MgPQorCQljb250YWluZXJfb2Yod29yaywgdHlw
ZW9mKCpnYyksIGZyZWVfd29yayk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKLQljb250ZXh0c19mcmVlKGk5MTUpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CisJY29udGV4dHNfZmx1c2hfZnJlZShnYyk7CiB9CiAKIHZvaWQgaTkxNV9n
ZW1fY29udGV4dF9yZWxlYXNlKHN0cnVjdCBrcmVmICpyZWYpCiB7CiAJc3RydWN0IGk5MTVfZ2Vt
X2NvbnRleHQgKmN0eCA9IGNvbnRhaW5lcl9vZihyZWYsIHR5cGVvZigqY3R4KSwgcmVmKTsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGN0eC0+aTkxNTsKKwlzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dHMgKmdjID0gJmN0eC0+aTkxNS0+Z2VtLmNvbnRleHRzOwogCiAJdHJhY2VfaTkx
NV9jb250ZXh0X2ZyZWUoY3R4KTsKLQlpZiAobGxpc3RfYWRkKCZjdHgtPmZyZWVfbGluaywgJmk5
MTUtPmNvbnRleHRzLmZyZWVfbGlzdCkpCi0JCXF1ZXVlX3dvcmsoaTkxNS0+d3EsICZpOTE1LT5j
b250ZXh0cy5mcmVlX3dvcmspOworCWlmIChsbGlzdF9hZGQoJmN0eC0+ZnJlZV9saW5rLCAmZ2Mt
PmZyZWVfbGlzdCkpCisJCXNjaGVkdWxlX3dvcmsoJmdjLT5mcmVlX3dvcmspOwogfQogCiBzdGF0
aWMgdm9pZCBjb250ZXh0X2Nsb3NlKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCiB7Ci0J
aTkxNV9nZW1fY29udGV4dF9zZXRfY2xvc2VkKGN0eCk7CisJc3RydWN0IGk5MTVfYWRkcmVzc19z
cGFjZSAqdm07CiAKLQlpZiAoY3R4LT52bSkKLQkJaTkxNV92bV9jbG9zZShjdHgtPnZtKTsKKwlp
OTE1X2dlbV9jb250ZXh0X3NldF9jbG9zZWQoY3R4KTsKIAogCW11dGV4X2xvY2soJmN0eC0+bXV0
ZXgpOwogCisJdm0gPSBpOTE1X2dlbV9jb250ZXh0X3ZtKGN0eCk7CisJaWYgKHZtKQorCQlpOTE1
X3ZtX2Nsb3NlKHZtKTsKKwogCWN0eC0+ZmlsZV9wcml2ID0gRVJSX1BUUigtRUJBREYpOwogCiAJ
LyoKQEAgLTMxNyw3ICszMDcsNiBAQCBfX2NyZWF0ZV9jb250ZXh0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1KQogCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKIAogCWtyZWZfaW5pdCgm
Y3R4LT5yZWYpOwotCWxpc3RfYWRkX3RhaWwoJmN0eC0+bGluaywgJmk5MTUtPmNvbnRleHRzLmxp
c3QpOwogCWN0eC0+aTkxNSA9IGk5MTU7CiAJY3R4LT5zY2hlZC5wcmlvcml0eSA9IEk5MTVfVVNF
Ul9QUklPUklUWShJOTE1X1BSSU9SSVRZX05PUk1BTCk7CiAJbXV0ZXhfaW5pdCgmY3R4LT5tdXRl
eCk7CkBAIC0zNDMsNiArMzMyLDEwIEBAIF9fY3JlYXRlX2NvbnRleHQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiAJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUoY3R4LT5oYW5nX3Rp
bWVzdGFtcCk7IGkrKykKIAkJY3R4LT5oYW5nX3RpbWVzdGFtcFtpXSA9IGppZmZpZXMgLSBDT05U
RVhUX0ZBU1RfSEFOR19KSUZGSUVTOwogCisJc3Bpbl9sb2NrKCZpOTE1LT5nZW0uY29udGV4dHMu
bG9jayk7CisJbGlzdF9hZGRfdGFpbCgmY3R4LT5saW5rLCAmaTkxNS0+Z2VtLmNvbnRleHRzLmxp
c3QpOworCXNwaW5fdW5sb2NrKCZpOTE1LT5nZW0uY29udGV4dHMubG9jayk7CisKIAlyZXR1cm4g
Y3R4OwogCiBlcnJfZnJlZToKQEAgLTM3MiwxMSArMzY1LDExIEBAIHN0YXRpYyB2b2lkIF9fYXBw
bHlfcHBndHQoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLCB2b2lkICp2bSkKIHN0YXRpYyBzdHJ1
Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICoKIF9fc2V0X3BwZ3R0KHN0cnVjdCBpOTE1X2dlbV9jb250
ZXh0ICpjdHgsIHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogewotCXN0cnVjdCBpOTE1
X2FkZHJlc3Nfc3BhY2UgKm9sZCA9IGN0eC0+dm07CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZSAqb2xkID0gaTkxNV9nZW1fY29udGV4dF92bShjdHgpOwogCiAJR0VNX0JVR19PTihvbGQgJiYg
aTkxNV92bV9pc180bHZsKHZtKSAhPSBpOTE1X3ZtX2lzXzRsdmwob2xkKSk7CiAKLQljdHgtPnZt
ID0gaTkxNV92bV9vcGVuKHZtKTsKKwlyY3VfYXNzaWduX3BvaW50ZXIoY3R4LT52bSwgaTkxNV92
bV9vcGVuKHZtKSk7CiAJY29udGV4dF9hcHBseV9hbGwoY3R4LCBfX2FwcGx5X3BwZ3R0LCB2bSk7
CiAKIAlyZXR1cm4gb2xkOwpAQCAtMzg1LDcgKzM3OCw3IEBAIF9fc2V0X3BwZ3R0KHN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0ICpjdHgsIHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogc3Rh
dGljIHZvaWQgX19hc3NpZ25fcHBndHQoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJ
CSAgIHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogewotCWlmICh2bSA9PSBjdHgtPnZt
KQorCWlmICh2bSA9PSByY3VfYWNjZXNzX3BvaW50ZXIoY3R4LT52bSkpCiAJCXJldHVybjsKIAog
CXZtID0gX19zZXRfcHBndHQoY3R4LCB2bSk7CkBAIC00MTcsMjcgKzQxMCwyNSBAQCBzdGF0aWMg
dm9pZCBfX2Fzc2lnbl90aW1lbGluZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAogfQog
CiBzdGF0aWMgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKgotaTkxNV9nZW1fY3JlYXRlX2NvbnRl
eHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1bnNpZ25lZCBpbnQgZmxhZ3Mp
CitpOTE1X2dlbV9jcmVhdGVfY29udGV4dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwg
dW5zaWduZWQgaW50IGZsYWdzKQogewogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CiAK
LQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlp
ZiAoZmxhZ3MgJiBJOTE1X0NPTlRFWFRfQ1JFQVRFX0ZMQUdTX1NJTkdMRV9USU1FTElORSAmJgot
CSAgICAhSEFTX0VYRUNMSVNUUyhkZXZfcHJpdikpCisJICAgICFIQVNfRVhFQ0xJU1RTKGk5MTUp
KQogCQlyZXR1cm4gRVJSX1BUUigtRUlOVkFMKTsKIAotCS8qIFJlYXAgdGhlIG1vc3Qgc3RhbGUg
Y29udGV4dCAqLwotCWNvbnRleHRzX2ZyZWVfZmlyc3QoZGV2X3ByaXYpOworCS8qIFJlYXAgdGhl
IHN0YWxlIGNvbnRleHRzICovCisJY29udGV4dHNfZmx1c2hfZnJlZSgmaTkxNS0+Z2VtLmNvbnRl
eHRzKTsKIAotCWN0eCA9IF9fY3JlYXRlX2NvbnRleHQoZGV2X3ByaXYpOworCWN0eCA9IF9fY3Jl
YXRlX2NvbnRleHQoaTkxNSk7CiAJaWYgKElTX0VSUihjdHgpKQogCQlyZXR1cm4gY3R4OwogCi0J
aWYgKEhBU19GVUxMX1BQR1RUKGRldl9wcml2KSkgeworCWlmIChIQVNfRlVMTF9QUEdUVChpOTE1
KSkgewogCQlzdHJ1Y3QgaTkxNV9wcGd0dCAqcHBndHQ7CiAKLQkJcHBndHQgPSBpOTE1X3BwZ3R0
X2NyZWF0ZShkZXZfcHJpdik7CisJCXBwZ3R0ID0gaTkxNV9wcGd0dF9jcmVhdGUoaTkxNSk7CiAJ
CWlmIChJU19FUlIocHBndHQpKSB7CiAJCQlEUk1fREVCVUdfRFJJVkVSKCJQUEdUVCBzZXR1cCBm
YWlsZWQgKCVsZClcbiIsCiAJCQkJCSBQVFJfRVJSKHBwZ3R0KSk7CkBAIC00NDUsMTQgKzQzNiwx
NyBAQCBpOTE1X2dlbV9jcmVhdGVfY29udGV4dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsIHVuc2lnbmVkIGludCBmbGFncykKIAkJCXJldHVybiBFUlJfQ0FTVChwcGd0dCk7CiAJ
CX0KIAorCQltdXRleF9sb2NrKCZjdHgtPm11dGV4KTsKIAkJX19hc3NpZ25fcHBndHQoY3R4LCAm
cHBndHQtPnZtKTsKKwkJbXV0ZXhfdW5sb2NrKCZjdHgtPm11dGV4KTsKKwogCQlpOTE1X3ZtX3B1
dCgmcHBndHQtPnZtKTsKIAl9CiAKIAlpZiAoZmxhZ3MgJiBJOTE1X0NPTlRFWFRfQ1JFQVRFX0ZM
QUdTX1NJTkdMRV9USU1FTElORSkgewogCQlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRpbWVsaW5l
OwogCi0JCXRpbWVsaW5lID0gaW50ZWxfdGltZWxpbmVfY3JlYXRlKCZkZXZfcHJpdi0+Z3QsIE5V
TEwpOworCQl0aW1lbGluZSA9IGludGVsX3RpbWVsaW5lX2NyZWF0ZSgmaTkxNS0+Z3QsIE5VTEwp
OwogCQlpZiAoSVNfRVJSKHRpbWVsaW5lKSkgewogCQkJY29udGV4dF9jbG9zZShjdHgpOwogCQkJ
cmV0dXJuIEVSUl9DQVNUKHRpbWVsaW5lKTsKQEAgLTQ5Nyw0MiArNDkxLDQwIEBAIGk5MTVfZ2Vt
X2NvbnRleHRfY3JlYXRlX2tlcm5lbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgaW50
IHByaW8pCiAJcmV0dXJuIGN0eDsKIH0KIAotc3RhdGljIHZvaWQgaW5pdF9jb250ZXh0cyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3N0YXRpYyB2b2lkIGluaXRfY29udGV4dHMoc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHRzICpnYykKIHsKLQltdXRleF9pbml0KCZpOTE1LT5jb250ZXh0
cy5tdXRleCk7Ci0JSU5JVF9MSVNUX0hFQUQoJmk5MTUtPmNvbnRleHRzLmxpc3QpOworCXNwaW5f
bG9ja19pbml0KCZnYy0+bG9jayk7CisJSU5JVF9MSVNUX0hFQUQoJmdjLT5saXN0KTsKIAotCUlO
SVRfV09SSygmaTkxNS0+Y29udGV4dHMuZnJlZV93b3JrLCBjb250ZXh0c19mcmVlX3dvcmtlcik7
Ci0JaW5pdF9sbGlzdF9oZWFkKCZpOTE1LT5jb250ZXh0cy5mcmVlX2xpc3QpOworCUlOSVRfV09S
SygmZ2MtPmZyZWVfd29yaywgY29udGV4dHNfZnJlZV93b3JrZXIpOworCWluaXRfbGxpc3RfaGVh
ZCgmZ2MtPmZyZWVfbGlzdCk7CiB9CiAKLWludCBpOTE1X2dlbV9jb250ZXh0c19pbml0KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK2ludCBpOTE1X2dlbV9pbml0X2NvbnRleHRz
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0cnVjdCBpOTE1X2dlbV9jb250
ZXh0ICpjdHg7CiAKIAkvKiBSZWFzc3VyZSBvdXJzZWx2ZXMgd2UgYXJlIG9ubHkgY2FsbGVkIG9u
Y2UgKi8KLQlHRU1fQlVHX09OKGRldl9wcml2LT5rZXJuZWxfY29udGV4dCk7CisJR0VNX0JVR19P
TihpOTE1LT5rZXJuZWxfY29udGV4dCk7CiAKLQlpbml0X2NvbnRleHRzKGRldl9wcml2KTsKKwlp
bml0X2NvbnRleHRzKCZpOTE1LT5nZW0uY29udGV4dHMpOwogCiAJLyogbG93ZXN0IHByaW9yaXR5
OyBpZGxlIHRhc2sgKi8KLQljdHggPSBpOTE1X2dlbV9jb250ZXh0X2NyZWF0ZV9rZXJuZWwoZGV2
X3ByaXYsIEk5MTVfUFJJT1JJVFlfTUlOKTsKKwljdHggPSBpOTE1X2dlbV9jb250ZXh0X2NyZWF0
ZV9rZXJuZWwoaTkxNSwgSTkxNV9QUklPUklUWV9NSU4pOwogCWlmIChJU19FUlIoY3R4KSkgewog
CQlEUk1fRVJST1IoIkZhaWxlZCB0byBjcmVhdGUgZGVmYXVsdCBnbG9iYWwgY29udGV4dFxuIik7
CiAJCXJldHVybiBQVFJfRVJSKGN0eCk7CiAJfQotCWRldl9wcml2LT5rZXJuZWxfY29udGV4dCA9
IGN0eDsKKwlpOTE1LT5rZXJuZWxfY29udGV4dCA9IGN0eDsKIAogCURSTV9ERUJVR19EUklWRVIo
IiVzIGNvbnRleHQgc3VwcG9ydCBpbml0aWFsaXplZFxuIiwKLQkJCSBEUklWRVJfQ0FQUyhkZXZf
cHJpdiktPmhhc19sb2dpY2FsX2NvbnRleHRzID8KKwkJCSBEUklWRVJfQ0FQUyhpOTE1KS0+aGFz
X2xvZ2ljYWxfY29udGV4dHMgPwogCQkJICJsb2dpY2FsIiA6ICJmYWtlIik7CiAJcmV0dXJuIDA7
CiB9CiAKLXZvaWQgaTkxNV9nZW1fY29udGV4dHNfZmluaShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKK3ZvaWQgaTkxNV9nZW1fZHJpdmVyX3JlbGVhc2VfX2NvbnRleHRzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogewotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwotCiAJZGVzdHJveV9rZXJuZWxfY29udGV4dCgmaTkxNS0+a2VybmVs
X2NvbnRleHQpOwogfQogCkBAIC01NTEsMTEgKzU0MywxNiBAQCBzdGF0aWMgaW50IHZtX2lkcl9j
bGVhbnVwKGludCBpZCwgdm9pZCAqcCwgdm9pZCAqZGF0YSkKIHN0YXRpYyBpbnQgZ2VtX2NvbnRl
eHRfcmVnaXN0ZXIoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJCQlzdHJ1Y3QgZHJt
X2k5MTVfZmlsZV9wcml2YXRlICpmcHJpdikKIHsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNl
ICp2bTsKIAlpbnQgcmV0OwogCiAJY3R4LT5maWxlX3ByaXYgPSBmcHJpdjsKLQlpZiAoY3R4LT52
bSkKLQkJY3R4LT52bS0+ZmlsZSA9IGZwcml2OworCisJbXV0ZXhfbG9jaygmY3R4LT5tdXRleCk7
CisJdm0gPSBpOTE1X2dlbV9jb250ZXh0X3ZtKGN0eCk7CisJaWYgKHZtKQorCQlXUklURV9PTkNF
KHZtLT5maWxlLCBmcHJpdik7IC8qIFhYWCAqLworCW11dGV4X3VubG9jaygmY3R4LT5tdXRleCk7
CiAKIAljdHgtPnBpZCA9IGdldF90YXNrX3BpZChjdXJyZW50LCBQSURUWVBFX1BJRCk7CiAJY3R4
LT5uYW1lID0ga2FzcHJpbnRmKEdGUF9LRVJORUwsICIlc1slZF0iLApAQCAtNTkyLDkgKzU4OSw3
IEBAIGludCBpOTE1X2dlbV9jb250ZXh0X29wZW4oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJaWRyX2luaXQoJmZpbGVfcHJpdi0+Y29udGV4dF9pZHIpOwogCWlkcl9pbml0X2Jhc2Uo
JmZpbGVfcHJpdi0+dm1faWRyLCAxKTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCWN0eCA9IGk5MTVfZ2VtX2NyZWF0ZV9jb250ZXh0KGk5MTUsIDApOwotCW11dGV4
X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKElTX0VSUihjdHgpKSB7CiAJ
CWVyciA9IFBUUl9FUlIoY3R4KTsKIAkJZ290byBlcnI7CkBAIC02MjIsNiArNjE3LDcgQEAgaW50
IGk5MTVfZ2VtX2NvbnRleHRfb3BlbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIHZv
aWQgaTkxNV9nZW1fY29udGV4dF9jbG9zZShzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCiB7CiAJc3Ry
dWN0IGRybV9pOTE1X2ZpbGVfcHJpdmF0ZSAqZmlsZV9wcml2ID0gZmlsZS0+ZHJpdmVyX3ByaXY7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBmaWxlX3ByaXYtPmRldl9wcml2Owog
CiAJaWRyX2Zvcl9lYWNoKCZmaWxlX3ByaXYtPmNvbnRleHRfaWRyLCBjb250ZXh0X2lkcl9jbGVh
bnVwLCBOVUxMKTsKIAlpZHJfZGVzdHJveSgmZmlsZV9wcml2LT5jb250ZXh0X2lkcik7CkBAIC02
MzAsNiArNjI2LDggQEAgdm9pZCBpOTE1X2dlbV9jb250ZXh0X2Nsb3NlKHN0cnVjdCBkcm1fZmls
ZSAqZmlsZSkKIAlpZHJfZm9yX2VhY2goJmZpbGVfcHJpdi0+dm1faWRyLCB2bV9pZHJfY2xlYW51
cCwgTlVMTCk7CiAJaWRyX2Rlc3Ryb3koJmZpbGVfcHJpdi0+dm1faWRyKTsKIAltdXRleF9kZXN0
cm95KCZmaWxlX3ByaXYtPnZtX2lkcl9sb2NrKTsKKworCWNvbnRleHRzX2ZsdXNoX2ZyZWUoJmk5
MTUtPmdlbS5jb250ZXh0cyk7CiB9CiAKIGludCBpOTE1X2dlbV92bV9jcmVhdGVfaW9jdGwoc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKQEAgLTgwOCwxNiArODA2LDEyIEBAIHN0
YXRpYyBpbnQgZ2V0X3BwZ3R0KHN0cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGUgKmZpbGVfcHJp
diwKIAlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKIAlpbnQgcmV0OwogCi0JaWYgKCFj
dHgtPnZtKQorCWlmICghcmN1X2FjY2Vzc19wb2ludGVyKGN0eC0+dm0pKQogCQlyZXR1cm4gLUVO
T0RFVjsKIAotCS8qIFhYWCByY3UgYWNxdWlyZT8gKi8KLQlyZXQgPSBtdXRleF9sb2NrX2ludGVy
cnVwdGlibGUoJmN0eC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JaWYgKHJldCkKLQkJcmV0
dXJuIHJldDsKLQorCXJjdV9yZWFkX2xvY2soKTsKIAl2bSA9IGk5MTVfdm1fZ2V0KGN0eC0+dm0p
OwotCW11dGV4X3VubG9jaygmY3R4LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlyY3VfcmVh
ZF91bmxvY2soKTsKIAogCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmZmlsZV9wcml2
LT52bV9pZHJfbG9jayk7CiAJaWYgKHJldCkKQEAgLTkyNiw3ICs5MjAsNyBAQCBzdGF0aWMgaW50
IHNldF9wcGd0dChzdHJ1Y3QgZHJtX2k5MTVfZmlsZV9wcml2YXRlICpmaWxlX3ByaXYsCiAJaWYg
KGFyZ3MtPnNpemUpCiAJCXJldHVybiAtRUlOVkFMOwogCi0JaWYgKCFjdHgtPnZtKQorCWlmICgh
cmN1X2FjY2Vzc19wb2ludGVyKGN0eC0+dm0pKQogCQlyZXR1cm4gLUVOT0RFVjsKIAogCWlmICh1
cHBlcl8zMl9iaXRzKGFyZ3MtPnZhbHVlKSkKQEAgLTk0MCwxNyArOTM0LDIwIEBAIHN0YXRpYyBp
bnQgc2V0X3BwZ3R0KHN0cnVjdCBkcm1faTkxNV9maWxlX3ByaXZhdGUgKmZpbGVfcHJpdiwKIAlp
ZiAoIXZtKQogCQlyZXR1cm4gLUVOT0VOVDsKIAotCWVyciA9IG11dGV4X2xvY2tfaW50ZXJydXB0
aWJsZSgmY3R4LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwllcnIgPSBtdXRleF9sb2NrX2lu
dGVycnVwdGlibGUoJmN0eC0+bXV0ZXgpOwogCWlmIChlcnIpCiAJCWdvdG8gb3V0OwogCi0JaWYg
KHZtID09IGN0eC0+dm0pCisJaWYgKGk5MTVfZ2VtX2NvbnRleHRfaXNfY2xvc2VkKGN0eCkpIHsK
KwkJZXJyID0gLUVOT0VOVDsKKwkJZ290byBvdXQ7CisJfQorCisJaWYgKHZtID09IHJjdV9hY2Nl
c3NfcG9pbnRlcihjdHgtPnZtKSkKIAkJZ290byB1bmxvY2s7CiAKIAkvKiBUZWFyZG93biB0aGUg
ZXhpc3Rpbmcgb2JqOnZtYSBjYWNoZSwgaXQgd2lsbCBoYXZlIHRvIGJlIHJlYnVpbHQuICovCi0J
bXV0ZXhfbG9jaygmY3R4LT5tdXRleCk7CiAJbHV0X2Nsb3NlKGN0eCk7Ci0JbXV0ZXhfdW5sb2Nr
KCZjdHgtPm11dGV4KTsKIAogCW9sZCA9IF9fc2V0X3BwZ3R0KGN0eCwgdm0pOwogCkBAIC05NzAs
OCArOTY3LDcgQEAgc3RhdGljIGludCBzZXRfcHBndHQoc3RydWN0IGRybV9pOTE1X2ZpbGVfcHJp
dmF0ZSAqZmlsZV9wcml2LAogCX0KIAogdW5sb2NrOgotCW11dGV4X3VubG9jaygmY3R4LT5pOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKLQorCW11dGV4X3VubG9jaygmY3R4LT5tdXRleCk7CiBvdXQ6
CiAJaTkxNV92bV9wdXQodm0pOwogCXJldHVybiBlcnI7CkBAIC0xODI3LDEwICsxODIzLDExIEBA
IHN0YXRpYyBpbnQgY2xvbmVfdm0oc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmRzdCwKIAkJICAg
IHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpzcmMpCiB7CiAJc3RydWN0IGk5MTVfYWRkcmVzc19z
cGFjZSAqdm07CisJaW50IGVyciA9IDA7CiAKIAlyY3VfcmVhZF9sb2NrKCk7CiAJZG8gewotCQl2
bSA9IFJFQURfT05DRShzcmMtPnZtKTsKKwkJdm0gPSByY3VfZGVyZWZlcmVuY2Uoc3JjLT52bSk7
CiAJCWlmICghdm0pCiAJCQlicmVhazsKIApAQCAtMTg1Miw3ICsxODQ5LDcgQEAgc3RhdGljIGlu
dCBjbG9uZV92bShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqZHN0LAogCQkgKiBpdCBjYW5ub3Qg
YmUgcmVhbGxvY2F0ZWQgZWxzZXdoZXJlLgogCQkgKi8KIAotCQlpZiAodm0gPT0gUkVBRF9PTkNF
KHNyYy0+dm0pKQorCQlpZiAodm0gPT0gcmN1X2FjY2Vzc19wb2ludGVyKHNyYy0+dm0pKQogCQkJ
YnJlYWs7CiAKIAkJaTkxNV92bV9wdXQodm0pOwpAQCAtMTg2MCwxMSArMTg1NywxNiBAQCBzdGF0
aWMgaW50IGNsb25lX3ZtKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpkc3QsCiAJcmN1X3JlYWRf
dW5sb2NrKCk7CiAKIAlpZiAodm0pIHsKLQkJX19hc3NpZ25fcHBndHQoZHN0LCB2bSk7CisJCWlm
ICghbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZkc3QtPm11dGV4KSkgeworCQkJX19hc3NpZ25f
cHBndHQoZHN0LCB2bSk7CisJCQltdXRleF91bmxvY2soJmRzdC0+bXV0ZXgpOworCQl9IGVsc2Ug
eworCQkJZXJyID0gLUVJTlRSOworCQl9CiAJCWk5MTVfdm1fcHV0KHZtKTsKIAl9CiAKLQlyZXR1
cm4gMDsKKwlyZXR1cm4gZXJyOwogfQogCiBzdGF0aWMgaW50IGNyZWF0ZV9jbG9uZShzdHJ1Y3Qg
aTkxNV91c2VyX2V4dGVuc2lvbiBfX3VzZXIgKmV4dCwgdm9pZCAqZGF0YSkKQEAgLTE5NTQsMTIg
KzE5NTYsNyBAQCBpbnQgaTkxNV9nZW1fY29udGV4dF9jcmVhdGVfaW9jdGwoc3RydWN0IGRybV9k
ZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJcmV0dXJuIC1FSU87CiAJfQogCi0JcmV0ID0gaTkx
NV9tdXRleF9sb2NrX2ludGVycnVwdGlibGUoZGV2KTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0
OwotCiAJZXh0X2RhdGEuY3R4ID0gaTkxNV9nZW1fY3JlYXRlX2NvbnRleHQoaTkxNSwgYXJncy0+
ZmxhZ3MpOwotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChJU19FUlIo
ZXh0X2RhdGEuY3R4KSkKIAkJcmV0dXJuIFBUUl9FUlIoZXh0X2RhdGEuY3R4KTsKIApAQCAtMjA4
NiwxMCArMjA4MywxMiBAQCBpbnQgaTkxNV9nZW1fY29udGV4dF9nZXRwYXJhbV9pb2N0bChzdHJ1
Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCiAJY2FzZSBJOTE1X0NPTlRFWFRfUEFS
QU1fR1RUX1NJWkU6CiAJCWFyZ3MtPnNpemUgPSAwOwotCQlpZiAoY3R4LT52bSkKLQkJCWFyZ3Mt
PnZhbHVlID0gY3R4LT52bS0+dG90YWw7CisJCXJjdV9yZWFkX2xvY2soKTsKKwkJaWYgKHJjdV9h
Y2Nlc3NfcG9pbnRlcihjdHgtPnZtKSkKKwkJCWFyZ3MtPnZhbHVlID0gcmN1X2RlcmVmZXJlbmNl
KGN0eC0+dm0pLT50b3RhbDsKIAkJZWxzZQogCQkJYXJncy0+dmFsdWUgPSB0b19pOTE1KGRldikt
PmdndHQudm0udG90YWw7CisJCXJjdV9yZWFkX3VubG9jaygpOwogCQlicmVhazsKIAogCWNhc2Ug
STkxNV9DT05URVhUX1BBUkFNX05PX0VSUk9SX0NBUFRVUkU6CkBAIC0yMTU1LDcgKzIxNTQsNyBA
QCBpbnQgaTkxNV9nZW1fY29udGV4dF9zZXRwYXJhbV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2LCB2b2lkICpkYXRhLAogaW50IGk5MTVfZ2VtX2NvbnRleHRfcmVzZXRfc3RhdHNfaW9jdGwo
c3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJCQkgICAgICAgdm9pZCAqZGF0YSwgc3RydWN0IGRy
bV9maWxlICpmaWxlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRv
X2k5MTUoZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2
KTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcmVzZXRfc3RhdHMgKmFyZ3MgPSBkYXRhOwogCXN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0ICpjdHg7CiAJaW50IHJldDsKQEAgLTIxNzcsNyArMjE3Niw3IEBAIGlu
dCBpOTE1X2dlbV9jb250ZXh0X3Jlc2V0X3N0YXRzX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYsCiAJICovCiAKIAlpZiAoY2FwYWJsZShDQVBfU1lTX0FETUlOKSkKLQkJYXJncy0+cmVzZXRf
Y291bnQgPSBpOTE1X3Jlc2V0X2NvdW50KCZkZXZfcHJpdi0+Z3B1X2Vycm9yKTsKKwkJYXJncy0+
cmVzZXRfY291bnQgPSBpOTE1X3Jlc2V0X2NvdW50KCZpOTE1LT5ncHVfZXJyb3IpOwogCWVsc2UK
IAkJYXJncy0+cmVzZXRfY291bnQgPSAwOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX2NvbnRleHQuaAppbmRleCA1MGJjMjdkMzBjMDMuLjkyMzQ1ODY4MzBkMSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaAorKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5oCkBAIC0xMSw3ICsxMSw5
IEBACiAKICNpbmNsdWRlICJndC9pbnRlbF9jb250ZXh0LmgiCiAKKyNpbmNsdWRlICJpOTE1X2Ry
di5oIgogI2luY2x1ZGUgImk5MTVfZ2VtLmgiCisjaW5jbHVkZSAiaTkxNV9nZW1fZ3R0LmgiCiAj
aW5jbHVkZSAiaTkxNV9zY2hlZHVsZXIuaCIKICNpbmNsdWRlICJpbnRlbF9kZXZpY2VfaW5mby5o
IgogCkBAIC0xMTgsOCArMTIwLDggQEAgc3RhdGljIGlubGluZSBib29sIGk5MTVfZ2VtX2NvbnRl
eHRfaXNfa2VybmVsKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgpCiB9CiAKIC8qIGk5MTVf
Z2VtX2NvbnRleHQuYyAqLwotaW50IF9fbXVzdF9jaGVjayBpOTE1X2dlbV9jb250ZXh0c19pbml0
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci12b2lkIGk5MTVfZ2VtX2NvbnRl
eHRzX2Zpbmkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK2ludCBfX211c3Rf
Y2hlY2sgaTkxNV9nZW1faW5pdF9jb250ZXh0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSk7Cit2b2lkIGk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNlX19jb250ZXh0cyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSk7CiAKIGludCBpOTE1X2dlbV9jb250ZXh0X29wZW4oc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSk7CkBAIC0x
NTgsNiArMTYwLDI3IEBAIHN0YXRpYyBpbmxpbmUgdm9pZCBpOTE1X2dlbV9jb250ZXh0X3B1dChz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQogCWtyZWZfcHV0KCZjdHgtPnJlZiwgaTkxNV9n
ZW1fY29udGV4dF9yZWxlYXNlKTsKIH0KIAorc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlICoKK2k5MTVfZ2VtX2NvbnRleHRfdm0oc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQg
KmN0eCkKK3sKKwlyZXR1cm4gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChjdHgtPnZtLCBsb2Nr
ZGVwX2lzX2hlbGQoJmN0eC0+bXV0ZXgpKTsKK30KKworc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkx
NV9hZGRyZXNzX3NwYWNlICoKK2k5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dCAqY3R4KQoreworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwor
CisJcmN1X3JlYWRfbG9jaygpOworCXZtID0gcmN1X2RlcmVmZXJlbmNlKGN0eC0+dm0pOworCWlm
ICghdm0pCisJCXZtID0gJmN0eC0+aTkxNS0+Z2d0dC52bTsKKwl2bSA9IGk5MTVfdm1fZ2V0KHZt
KTsKKwlyY3VfcmVhZF91bmxvY2soKTsKKworCXJldHVybiB2bTsKK30KKwogc3RhdGljIGlubGlu
ZSBzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lcyAqCiBpOTE1X2dlbV9jb250ZXh0X2VuZ2luZXMoc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fY29udGV4dF90eXBlcy5oCmluZGV4IDg3YmUyNzg3N2UyMi4uYWI4ZTEz
NjdkZmM4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29u
dGV4dF90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250
ZXh0X3R5cGVzLmgKQEAgLTg4LDcgKzg4LDcgQEAgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgewog
CSAqIEluIG90aGVyIG1vZGVzLCB0aGlzIGlzIGEgTlVMTCBwb2ludGVyIHdpdGggdGhlIGV4cGVj
dGF0aW9uIHRoYXQKIAkgKiB0aGUgY2FsbGVyIHVzZXMgdGhlIHNoYXJlZCBnbG9iYWwgR1RULgog
CSAqLwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOworCXN0cnVjdCBpOTE1X2FkZHJl
c3Nfc3BhY2UgX19yY3UgKnZtOwogCiAJLyoqCiAJICogQHBpZDogcHJvY2VzcyBpZCBvZiBjcmVh
dG9yCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1
ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYwpp
bmRleCA4OGE4ODFiZTEyZWMuLjk4ODE2YzM1ZmZjMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCkBAIC03MjgsNyArNzI4LDcgQEAgc3RhdGlj
IGludCBlYl9zZWxlY3RfY29udGV4dChzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYikKIAkJcmV0
dXJuIC1FTk9FTlQ7CiAKIAllYi0+Z2VtX2NvbnRleHQgPSBjdHg7Ci0JaWYgKGN0eC0+dm0pCisJ
aWYgKHJjdV9hY2Nlc3NfcG9pbnRlcihjdHgtPnZtKSkKIAkJZWItPmludmFsaWRfZmxhZ3MgfD0g
RVhFQ19PQkpFQ1RfTkVFRFNfR1RUOwogCiAJZWItPmNvbnRleHRfZmxhZ3MgPSAwOwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMKaW5kZXggMTczOGExNWViOTEx
Li40Zjk3MDQ3NDAxM2YgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV91c2VycHRyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Vz
ZXJwdHIuYwpAQCAtNzU4LDcgKzc1OCw4IEBAIGk5MTVfZ2VtX3VzZXJwdHJfaW9jdGwoc3RydWN0
IGRybV9kZXZpY2UgKmRldiwKIAkJICogT24gYWxtb3N0IGFsbCBvZiB0aGUgb2xkZXIgaHcsIHdl
IGNhbm5vdCB0ZWxsIHRoZSBHUFUgdGhhdAogCQkgKiBhIHBhZ2UgaXMgcmVhZG9ubHkuCiAJCSAq
LwotCQl2bSA9IGRldl9wcml2LT5rZXJuZWxfY29udGV4dC0+dm07CisJCXZtID0gcmN1X2RlcmVm
ZXJlbmNlX3Byb3RlY3RlZChkZXZfcHJpdi0+a2VybmVsX2NvbnRleHQtPnZtLAorCQkJCQkgICAg
ICAgdHJ1ZSk7IC8qIHN0YXRpYyB2bSAqLwogCQlpZiAoIXZtIHx8ICF2bS0+aGFzX3JlYWRfb25s
eSkKIAkJCXJldHVybiAtRU5PREVWOwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMKaW5kZXggOThiMmE2Y2NmY2MxLi4zMzE0ODU4ZjMwNDYg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdl
cy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5j
CkBAIC0xMzIyLDE1ICsxMzIyLDE1IEBAIHN0YXRpYyBpbnQgaWd0X3BwZ3R0X3Bpbl91cGRhdGUo
dm9pZCAqYXJnKQogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHggPSBhcmc7CiAJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gY3R4LT5pOTE1OwogCXVuc2lnbmVkIGxvbmcg
c3VwcG9ydGVkID0gSU5URUxfSU5GTyhkZXZfcHJpdiktPnBhZ2Vfc2l6ZXM7Ci0Jc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqdm0gPSBjdHgtPnZtOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmo7CiAJc3RydWN0IGk5MTVfZ2VtX2VuZ2luZXNfaXRlciBpdDsKKwlzdHJ1Y3QgaTkx
NV9hZGRyZXNzX3NwYWNlICp2bTsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAJc3RydWN0
IGk5MTVfdm1hICp2bWE7CiAJdW5zaWduZWQgaW50IGZsYWdzID0gUElOX1VTRVIgfCBQSU5fT0ZG
U0VUX0ZJWEVEOwogCXVuc2lnbmVkIGludCBuOwogCWludCBmaXJzdCwgbGFzdDsKLQlpbnQgZXJy
OworCWludCBlcnIgPSAwOwogCiAJLyoKIAkgKiBNYWtlIHN1cmUgdGhlcmUncyBubyBmdW5ueSBi
dXNpbmVzcyB3aGVuIGRvaW5nIGEgUElOX1VQREFURSAtLSBpbiB0aGUKQEAgLTEzNDAsOSArMTM0
MCwxMCBAQCBzdGF0aWMgaW50IGlndF9wcGd0dF9waW5fdXBkYXRlKHZvaWQgKmFyZykKIAkgKiBo
dWdlLWd0dC1wYWdlcy4KIAkgKi8KIAotCWlmICghdm0gfHwgIWk5MTVfdm1faXNfNGx2bCh2bSkp
IHsKKwl2bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOworCWlmICghaTkxNV92
bV9pc180bHZsKHZtKSkgewogCQlwcl9pbmZvKCI0OGIgUFBHVFQgbm90IHN1cHBvcnRlZCwgc2tp
cHBpbmdcbiIpOwotCQlyZXR1cm4gMDsKKwkJZ290byBvdXRfdm07CiAJfQogCiAJZmlyc3QgPSBp
bG9nMihJOTE1X0dUVF9QQUdFX1NJWkVfNjRLKTsKQEAgLTE0NTEsNiArMTQ1Miw4IEBAIHN0YXRp
YyBpbnQgaWd0X3BwZ3R0X3Bpbl91cGRhdGUodm9pZCAqYXJnKQogCWk5MTVfdm1hX2Nsb3NlKHZt
YSk7CiBvdXRfcHV0OgogCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKK291dF92bToKKwlpOTE1
X3ZtX3B1dCh2bSk7CiAKIAlyZXR1cm4gZXJyOwogfQpAQCAtMTQ2MCw3ICsxNDYzLDcgQEAgc3Rh
dGljIGludCBpZ3RfdG1wZnNfZmFsbGJhY2sodm9pZCAqYXJnKQogCXN0cnVjdCBpOTE1X2dlbV9j
b250ZXh0ICpjdHggPSBhcmc7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBjdHgt
Pmk5MTU7CiAJc3RydWN0IHZmc21vdW50ICpnZW1mcyA9IGk5MTUtPm1tLmdlbWZzOwotCXN0cnVj
dCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gY3R4LT52bSA/OiAmaTkxNS0+Z2d0dC52bTsKKwlz
dHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3Jj
dShjdHgpOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJc3RydWN0IGk5MTVf
dm1hICp2bWE7CiAJdTMyICp2YWRkcjsKQEAgLTE1MTAsNiArMTUxMyw3IEBAIHN0YXRpYyBpbnQg
aWd0X3RtcGZzX2ZhbGxiYWNrKHZvaWQgKmFyZykKIG91dF9yZXN0b3JlOgogCWk5MTUtPm1tLmdl
bWZzID0gZ2VtZnM7CiAKKwlpOTE1X3ZtX3B1dCh2bSk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAt
MTUxNywxNCArMTUyMSwxNCBAQCBzdGF0aWMgaW50IGlndF9zaHJpbmtfdGhwKHZvaWQgKmFyZykK
IHsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4ID0gYXJnOwogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gY3R4LT5pOTE1OwotCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ug
KnZtID0gY3R4LT52bSA/OiAmaTkxNS0+Z2d0dC52bTsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3Nw
YWNlICp2bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOwogCXN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJc3RydWN0IGk5MTVfZ2VtX2VuZ2luZXNfaXRlciBpdDsK
IAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJdW5z
aWduZWQgaW50IGZsYWdzID0gUElOX1VTRVI7CiAJdW5zaWduZWQgaW50IG47Ci0JaW50IGVycjsK
KwlpbnQgZXJyID0gMDsKIAogCS8qCiAJICogU2FuaXR5IGNoZWNrIHNocmlua2luZyBodWdlLXBh
Z2VkIG9iamVjdCAtLSBtYWtlIHN1cmUgbm90aGluZyBibG93cwpAQCAtMTUzMywxMiArMTUzNywx
NCBAQCBzdGF0aWMgaW50IGlndF9zaHJpbmtfdGhwKHZvaWQgKmFyZykKIAogCWlmICghaWd0X2Nh
bl9hbGxvY2F0ZV90aHAoaTkxNSkpIHsKIAkJcHJfaW5mbygibWlzc2luZyBUSFAgc3VwcG9ydCwg
c2tpcHBpbmdcbiIpOwotCQlyZXR1cm4gMDsKKwkJZ290byBvdXRfdm07CiAJfQogCiAJb2JqID0g
aTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zaG1lbShpOTE1LCBTWl8yTSk7Ci0JaWYgKElTX0VSUihv
YmopKQotCQlyZXR1cm4gUFRSX0VSUihvYmopOworCWlmIChJU19FUlIob2JqKSkgeworCQllcnIg
PSBQVFJfRVJSKG9iaik7CisJCWdvdG8gb3V0X3ZtOworCX0KIAogCXZtYSA9IGk5MTVfdm1hX2lu
c3RhbmNlKG9iaiwgdm0sIE5VTEwpOwogCWlmIChJU19FUlIodm1hKSkgewpAQCAtMTYwNyw2ICsx
NjEzLDggQEAgc3RhdGljIGludCBpZ3Rfc2hyaW5rX3RocCh2b2lkICphcmcpCiAJaTkxNV92bWFf
Y2xvc2Uodm1hKTsKIG91dF9wdXQ6CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworb3V0X3Zt
OgorCWk5MTVfdm1fcHV0KHZtKTsKIAogCXJldHVybiBlcnI7CiB9CkBAIC0xNjc1LDYgKzE2ODMs
NyBAQCBpbnQgaTkxNV9nZW1faHVnZV9wYWdlX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogCX07CiAJc3RydWN0IGRybV9maWxlICpmaWxlOwogCXN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0ICpjdHg7CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CiAJ
aW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJaW50IGVycjsKIApAQCAtMTY5OSw4ICsxNzA4LDEx
IEBAIGludCBpOTE1X2dlbV9odWdlX3BhZ2VfbGl2ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiAJCWdvdG8gb3V0X3VubG9jazsKIAl9CiAKLQlpZiAoY3R4LT52bSkK
LQkJY3R4LT52bS0+c2NydWJfNjRLID0gdHJ1ZTsKKwltdXRleF9sb2NrKCZjdHgtPm11dGV4KTsK
Kwl2bSA9IGk5MTVfZ2VtX2NvbnRleHRfdm0oY3R4KTsKKwlpZiAodm0pCisJCVdSSVRFX09OQ0Uo
dm0tPnNjcnViXzY0SywgdHJ1ZSk7CisJbXV0ZXhfdW5sb2NrKCZjdHgtPm11dGV4KTsKIAogCWVy
ciA9IGk5MTVfc3VidGVzdHModGVzdHMsIGN0eCk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXggMmZiMzFhZGEy
ZmE3Li5kNDRmYTlkMzU2ZjEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9z
ZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCkBAIC01MywxOSArNTMsMTcgQEAgc3RhdGlj
IGludCBsaXZlX25vcF9zd2l0Y2godm9pZCAqYXJnKQogCWlmIChJU19FUlIoZmlsZSkpCiAJCXJl
dHVybiBQVFJfRVJSKGZpbGUpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7Ci0KIAljdHggPSBrY2FsbG9jKG5jdHgsIHNpemVvZigqY3R4KSwgR0ZQX0tFUk5FTCk7CiAJ
aWYgKCFjdHgpIHsKIAkJZXJyID0gLUVOT01FTTsKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3Rv
IG91dF9maWxlOwogCX0KIAogCWZvciAobiA9IDA7IG4gPCBuY3R4OyBuKyspIHsKIAkJY3R4W25d
ID0gbGl2ZV9jb250ZXh0KGk5MTUsIGZpbGUpOwogCQlpZiAoSVNfRVJSKGN0eFtuXSkpIHsKIAkJ
CWVyciA9IFBUUl9FUlIoY3R4W25dKTsKLQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCWdvdG8gb3V0
X2ZpbGU7CiAJCX0KIAl9CiAKQEAgLTc5LDcgKzc3LDcgQEAgc3RhdGljIGludCBsaXZlX25vcF9z
d2l0Y2godm9pZCAqYXJnKQogCQkJcnEgPSBpZ3RfcmVxdWVzdF9hbGxvYyhjdHhbbl0sIGVuZ2lu
ZSk7CiAJCQlpZiAoSVNfRVJSKHJxKSkgewogCQkJCWVyciA9IFBUUl9FUlIocnEpOwotCQkJCWdv
dG8gb3V0X3VubG9jazsKKwkJCQlnb3RvIG91dF9maWxlOwogCQkJfQogCQkJaTkxNV9yZXF1ZXN0
X2FkZChycSk7CiAJCX0KQEAgLTg3LDcgKzg1LDcgQEAgc3RhdGljIGludCBsaXZlX25vcF9zd2l0
Y2godm9pZCAqYXJnKQogCQkJcHJfZXJyKCJGYWlsZWQgdG8gcG9wdWxhdGVkICVkIGNvbnRleHRz
XG4iLCBuY3R4KTsKIAkJCWludGVsX2d0X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKIAkJCWVyciA9
IC1FSU87Ci0JCQlnb3RvIG91dF91bmxvY2s7CisJCQlnb3RvIG91dF9maWxlOwogCQl9CiAKIAkJ
dGltZXNbMV0gPSBrdGltZV9nZXRfcmF3KCk7CkBAIC05Nyw3ICs5NSw3IEBAIHN0YXRpYyBpbnQg
bGl2ZV9ub3Bfc3dpdGNoKHZvaWQgKmFyZykKIAogCQllcnIgPSBpZ3RfbGl2ZV90ZXN0X2JlZ2lu
KCZ0LCBpOTE1LCBfX2Z1bmNfXywgZW5naW5lLT5uYW1lKTsKIAkJaWYgKGVycikKLQkJCWdvdG8g
b3V0X3VubG9jazsKKwkJCWdvdG8gb3V0X2ZpbGU7CiAKIAkJZW5kX3RpbWUgPSBqaWZmaWVzICsg
aTkxNV9zZWxmdGVzdC50aW1lb3V0X2ppZmZpZXM7CiAJCWZvcl9lYWNoX3ByaW1lX251bWJlcl9m
cm9tKHByaW1lLCAyLCA4MTkyKSB7CkBAIC0xMDcsNyArMTA1LDcgQEAgc3RhdGljIGludCBsaXZl
X25vcF9zd2l0Y2godm9pZCAqYXJnKQogCQkJCXJxID0gaWd0X3JlcXVlc3RfYWxsb2MoY3R4W24g
JSBuY3R4XSwgZW5naW5lKTsKIAkJCQlpZiAoSVNfRVJSKHJxKSkgewogCQkJCQllcnIgPSBQVFJf
RVJSKHJxKTsKLQkJCQkJZ290byBvdXRfdW5sb2NrOworCQkJCQlnb3RvIG91dF9maWxlOwogCQkJ
CX0KIAogCQkJCS8qCkBAIC0xNDMsNyArMTQxLDcgQEAgc3RhdGljIGludCBsaXZlX25vcF9zd2l0
Y2godm9pZCAqYXJnKQogCiAJCWVyciA9IGlndF9saXZlX3Rlc3RfZW5kKCZ0KTsKIAkJaWYgKGVy
cikKLQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCWdvdG8gb3V0X2ZpbGU7CiAKIAkJcHJfaW5mbygi
U3dpdGNoIGxhdGVuY2llcyBvbiAlczogMSA9ICVsbHVucywgJWx1ID0gJWxsdW5zXG4iLAogCQkJ
ZW5naW5lLT5uYW1lLApAQCAtMTUxLDggKzE0OSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9ub3Bfc3dp
dGNoKHZvaWQgKmFyZykKIAkJCXByaW1lIC0gMSwgZGl2NjRfdTY0KGt0aW1lX3RvX25zKHRpbWVz
WzFdKSwgcHJpbWUgLSAxKSk7CiAJfQogCi1vdXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7CitvdXRfZmlsZToKIAltb2NrX2ZpbGVfZnJlZShpOTE1LCBm
aWxlKTsKIAlyZXR1cm4gZXJyOwogfQpAQCAtMjUzLDEyICsyNTAsMTAgQEAgc3RhdGljIGludCBs
aXZlX3BhcmFsbGVsX3N3aXRjaCh2b2lkICphcmcpCiAJaWYgKElTX0VSUihmaWxlKSkKIAkJcmV0
dXJuIFBUUl9FUlIoZmlsZSk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKLQogCWN0eCA9IGxpdmVfY29udGV4dChpOTE1LCBmaWxlKTsKIAlpZiAoSVNfRVJSKGN0eCkp
IHsKIAkJZXJyID0gUFRSX0VSUihjdHgpOwotCQlnb3RvIG91dF9sb2NrZWQ7CisJCWdvdG8gb3V0
X2ZpbGU7CiAJfQogCiAJZW5naW5lcyA9IGk5MTVfZ2VtX2NvbnRleHRfbG9ja19lbmdpbmVzKGN0
eCk7CkBAIC0yNjgsNyArMjYzLDcgQEAgc3RhdGljIGludCBsaXZlX3BhcmFsbGVsX3N3aXRjaCh2
b2lkICphcmcpCiAJaWYgKCFkYXRhKSB7CiAJCWk5MTVfZ2VtX2NvbnRleHRfdW5sb2NrX2VuZ2lu
ZXMoY3R4KTsKIAkJZXJyID0gLUVOT01FTTsKLQkJZ290byBvdXRfbG9ja2VkOworCQlnb3RvIG91
dDsKIAl9CiAKIAltID0gMDsgLyogVXNlIHRoZSBmaXJzdCBjb250ZXh0IGFzIG91ciB0ZW1wbGF0
ZSBmb3IgdGhlIGVuZ2luZXMgKi8KQEAgLTI3Niw3ICsyNzEsNyBAQCBzdGF0aWMgaW50IGxpdmVf
cGFyYWxsZWxfc3dpdGNoKHZvaWQgKmFyZykKIAkJZXJyID0gaW50ZWxfY29udGV4dF9waW4oY2Up
OwogCQlpZiAoZXJyKSB7CiAJCQlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19lbmdpbmVzKGN0eCk7
Ci0JCQlnb3RvIG91dF9sb2NrZWQ7CisJCQlnb3RvIG91dDsKIAkJfQogCQlkYXRhW20rK10uY2Vb
MF0gPSBpbnRlbF9jb250ZXh0X2dldChjZSk7CiAJfQpAQCAtMjg3LDcgKzI4Miw3IEBAIHN0YXRp
YyBpbnQgbGl2ZV9wYXJhbGxlbF9zd2l0Y2godm9pZCAqYXJnKQogCQljdHggPSBsaXZlX2NvbnRl
eHQoaTkxNSwgZmlsZSk7CiAJCWlmIChJU19FUlIoY3R4KSkgewogCQkJZXJyID0gUFRSX0VSUihj
dHgpOwotCQkJZ290byBvdXRfbG9ja2VkOworCQkJZ290byBvdXQ7CiAJCX0KIAogCQlmb3IgKG0g
PSAwOyBtIDwgY291bnQ7IG0rKykgewpAQCAtMjk2LDIwICsyOTEsMTggQEAgc3RhdGljIGludCBs
aXZlX3BhcmFsbGVsX3N3aXRjaCh2b2lkICphcmcpCiAKIAkJCWNlID0gaW50ZWxfY29udGV4dF9j
cmVhdGUoY3R4LCBkYXRhW21dLmNlWzBdLT5lbmdpbmUpOwogCQkJaWYgKElTX0VSUihjZSkpCi0J
CQkJZ290byBvdXRfbG9ja2VkOworCQkJCWdvdG8gb3V0OwogCiAJCQllcnIgPSBpbnRlbF9jb250
ZXh0X3BpbihjZSk7CiAJCQlpZiAoZXJyKSB7CiAJCQkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwot
CQkJCWdvdG8gb3V0X2xvY2tlZDsKKwkJCQlnb3RvIG91dDsKIAkJCX0KIAogCQkJZGF0YVttXS5j
ZVtuXSA9IGNlOwogCQl9CiAJfQogCi0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKLQogCWZvciAoZm4gPSBmdW5jOyAhZXJyICYmICpmbjsgZm4rKykgewogCQlzdHJ1Y3Qg
aWd0X2xpdmVfdGVzdCB0OwogCQlpbnQgbjsKQEAgLTM1NCw4ICszNDcsNyBAQCBzdGF0aWMgaW50
IGxpdmVfcGFyYWxsZWxfc3dpdGNoKHZvaWQgKmFyZykKIAkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKIAl9CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKLW91dF9sb2NrZWQ6CitvdXQ6CiAJZm9yIChuID0gMDsgbiA8IGNvdW50OyBuKyspIHsK
IAkJZm9yIChtID0gMDsgbSA8IEFSUkFZX1NJWkUoZGF0YS0+Y2UpOyBtKyspIHsKIAkJCWlmICgh
ZGF0YVtuXS5jZVttXSkKQEAgLTM2NSw4ICszNTcsOCBAQCBzdGF0aWMgaW50IGxpdmVfcGFyYWxs
ZWxfc3dpdGNoKHZvaWQgKmFyZykKIAkJCWludGVsX2NvbnRleHRfcHV0KGRhdGFbbl0uY2VbbV0p
OwogCQl9CiAJfQotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJa2Zy
ZWUoZGF0YSk7CitvdXRfZmlsZToKIAltb2NrX2ZpbGVfZnJlZShpOTE1LCBmaWxlKTsKIAlyZXR1
cm4gZXJyOwogfQpAQCAtNjI2LDExICs2MTgsOSBAQCBzdGF0aWMgaW50IGlndF9jdHhfZXhlYyh2
b2lkICphcmcpCiAJCWlmIChJU19FUlIoZmlsZSkpCiAJCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsK
IAotCQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCQllcnIgPSBpZ3Rf
bGl2ZV90ZXN0X2JlZ2luKCZ0LCBpOTE1LCBfX2Z1bmNfXywgZW5naW5lLT5uYW1lKTsKIAkJaWYg
KGVycikKLQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCWdvdG8gb3V0X2ZpbGU7CiAKIAkJbmNvbnRl
eHRzID0gMDsKIAkJbmR3b3JkcyA9IDA7CkBAIC02NDIsNyArNjMyLDcgQEAgc3RhdGljIGludCBp
Z3RfY3R4X2V4ZWModm9pZCAqYXJnKQogCQkJY3R4ID0ga2VybmVsX2NvbnRleHQoaTkxNSk7CiAJ
CQlpZiAoSVNfRVJSKGN0eCkpIHsKIAkJCQllcnIgPSBQVFJfRVJSKGN0eCk7Ci0JCQkJZ290byBv
dXRfdW5sb2NrOworCQkJCWdvdG8gb3V0X2ZpbGU7CiAJCQl9CiAKIAkJCWNlID0gaTkxNV9nZW1f
Y29udGV4dF9nZXRfZW5naW5lKGN0eCwgZW5naW5lLT5sZWdhY3lfaWR4KTsKQEAgLTY1NCw3ICs2
NDQsNyBAQCBzdGF0aWMgaW50IGlndF9jdHhfZXhlYyh2b2lkICphcmcpCiAJCQkJCWVyciA9IFBU
Ul9FUlIob2JqKTsKIAkJCQkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwogCQkJCQlrZXJuZWxfY29u
dGV4dF9jbG9zZShjdHgpOwotCQkJCQlnb3RvIG91dF91bmxvY2s7CisJCQkJCWdvdG8gb3V0X2Zp
bGU7CiAJCQkJfQogCQkJfQogCkBAIC02NjMsMTcgKzY1MywxOCBAQCBzdGF0aWMgaW50IGlndF9j
dHhfZXhlYyh2b2lkICphcmcpCiAJCQkJcHJfZXJyKCJGYWlsZWQgdG8gZmlsbCBkd29yZCAlbHUg
WyVsdS8lbHVdIHdpdGggZ3B1ICglcykgW2Z1bGwtcHBndHQ/ICVzXSwgZXJyPSVkXG4iLAogCQkJ
CSAgICAgICBuZHdvcmRzLCBkdywgbWF4X2R3b3JkcyhvYmopLAogCQkJCSAgICAgICBlbmdpbmUt
Pm5hbWUsCi0JCQkJICAgICAgIHllc25vKCEhY3R4LT52bSksIGVycik7CisJCQkJICAgICAgIHll
c25vKCEhcmN1X2FjY2Vzc19wb2ludGVyKGN0eC0+dm0pKSwKKwkJCQkgICAgICAgZXJyKTsKIAkJ
CQlpbnRlbF9jb250ZXh0X3B1dChjZSk7CiAJCQkJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsK
LQkJCQlnb3RvIG91dF91bmxvY2s7CisJCQkJZ290byBvdXRfZmlsZTsKIAkJCX0KIAogCQkJZXJy
ID0gdGhyb3R0bGUoY2UsIHRxLCBBUlJBWV9TSVpFKHRxKSk7CiAJCQlpZiAoZXJyKSB7CiAJCQkJ
aW50ZWxfY29udGV4dF9wdXQoY2UpOwogCQkJCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7Ci0J
CQkJZ290byBvdXRfdW5sb2NrOworCQkJCWdvdG8gb3V0X2ZpbGU7CiAJCQl9CiAKIAkJCWlmICgr
K2R3ID09IG1heF9kd29yZHMob2JqKSkgewpAQCAtNzAzLDExICs2OTQsMTAgQEAgc3RhdGljIGlu
dCBpZ3RfY3R4X2V4ZWModm9pZCAqYXJnKQogCQkJZHcgKz0gcmVtOwogCQl9CiAKLW91dF91bmxv
Y2s6CitvdXRfZmlsZToKIAkJdGhyb3R0bGVfcmVsZWFzZSh0cSwgQVJSQVlfU0laRSh0cSkpOwog
CQlpZiAoaWd0X2xpdmVfdGVzdF9lbmQoJnQpKQogCQkJZXJyID0gLUVJTzsKLQkJbXV0ZXhfdW5s
b2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCQltb2NrX2ZpbGVfZnJlZShpOTE1LCBm
aWxlKTsKIAkJaWYgKGVycikKQEAgLTc0MiwyMiArNzMyLDIwIEBAIHN0YXRpYyBpbnQgaWd0X3No
YXJlZF9jdHhfZXhlYyh2b2lkICphcmcpCiAJaWYgKElTX0VSUihmaWxlKSkKIAkJcmV0dXJuIFBU
Ul9FUlIoZmlsZSk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQog
CXBhcmVudCA9IGxpdmVfY29udGV4dChpOTE1LCBmaWxlKTsKIAlpZiAoSVNfRVJSKHBhcmVudCkp
IHsKIAkJZXJyID0gUFRSX0VSUihwYXJlbnQpOwotCQlnb3RvIG91dF91bmxvY2s7CisJCWdvdG8g
b3V0X2ZpbGU7CiAJfQogCiAJaWYgKCFwYXJlbnQtPnZtKSB7IC8qIG5vdCBmdWxsLXBwZ3R0OyBu
b3RoaW5nIHRvIHNoYXJlICovCiAJCWVyciA9IDA7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290
byBvdXRfZmlsZTsKIAl9CiAKIAllcnIgPSBpZ3RfbGl2ZV90ZXN0X2JlZ2luKCZ0LCBpOTE1LCBf
X2Z1bmNfXywgIiIpOwogCWlmIChlcnIpCi0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290byBvdXRf
ZmlsZTsKIAogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7CiAJCXVuc2lnbmVk
IGxvbmcgbmNvbnRleHRzLCBuZHdvcmRzLCBkdzsKQEAgLTc4MSw3ICs3NjksOSBAQCBzdGF0aWMg
aW50IGlndF9zaGFyZWRfY3R4X2V4ZWModm9pZCAqYXJnKQogCQkJCWdvdG8gb3V0X3Rlc3Q7CiAJ
CQl9CiAKKwkJCW11dGV4X2xvY2soJmN0eC0+bXV0ZXgpOwogCQkJX19hc3NpZ25fcHBndHQoY3R4
LCBwYXJlbnQtPnZtKTsKKwkJCW11dGV4X3VubG9jaygmY3R4LT5tdXRleCk7CiAKIAkJCWNlID0g
aTkxNV9nZW1fY29udGV4dF9nZXRfZW5naW5lKGN0eCwgZW5naW5lLT5sZWdhY3lfaWR4KTsKIAkJ
CUdFTV9CVUdfT04oSVNfRVJSKGNlKSk7CkBAIC04MDEsNyArNzkxLDggQEAgc3RhdGljIGludCBp
Z3Rfc2hhcmVkX2N0eF9leGVjKHZvaWQgKmFyZykKIAkJCQlwcl9lcnIoIkZhaWxlZCB0byBmaWxs
IGR3b3JkICVsdSBbJWx1LyVsdV0gd2l0aCBncHUgKCVzKSBbZnVsbC1wcGd0dD8gJXNdLCBlcnI9
JWRcbiIsCiAJCQkJICAgICAgIG5kd29yZHMsIGR3LCBtYXhfZHdvcmRzKG9iaiksCiAJCQkJICAg
ICAgIGVuZ2luZS0+bmFtZSwKLQkJCQkgICAgICAgeWVzbm8oISFjdHgtPnZtKSwgZXJyKTsKKwkJ
CQkgICAgICAgeWVzbm8oISFyY3VfYWNjZXNzX3BvaW50ZXIoY3R4LT52bSkpLAorCQkJCSAgICAg
ICBlcnIpOwogCQkJCWludGVsX2NvbnRleHRfcHV0KGNlKTsKIAkJCQlrZXJuZWxfY29udGV4dF9j
bG9zZShjdHgpOwogCQkJCWdvdG8gb3V0X3Rlc3Q7CkBAIC04NDAsMTcgKzgzMSwxMyBAQCBzdGF0
aWMgaW50IGlndF9zaGFyZWRfY3R4X2V4ZWModm9pZCAqYXJnKQogCQkJZHcgKz0gcmVtOwogCQl9
CiAKLQkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJaTkxNV9nZW1f
ZHJhaW5fZnJlZWRfb2JqZWN0cyhpOTE1KTsKLQkJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7CiAJfQogb3V0X3Rlc3Q6CiAJdGhyb3R0bGVfcmVsZWFzZSh0cSwgQVJSQVlfU0la
RSh0cSkpOwogCWlmIChpZ3RfbGl2ZV90ZXN0X2VuZCgmdCkpCiAJCWVyciA9IC1FSU87Ci1vdXRf
dW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KK291dF9m
aWxlOgogCW1vY2tfZmlsZV9mcmVlKGk5MTUsIGZpbGUpOwogCXJldHVybiBlcnI7CiB9CkBAIC0x
MjIyLDggKzEyMDksNiBAQCBfX2lndF9jdHhfc3NldShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwKIAlpZiAoZmxhZ3MgJiBURVNUX1JFU0VUKQogCQlpZ3RfZ2xvYmFsX3Jlc2V0X2xvY2so
Jmk5MTUtPmd0KTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJ
Y3R4ID0gbGl2ZV9jb250ZXh0KGk5MTUsIGZpbGUpOwogCWlmIChJU19FUlIoY3R4KSkgewogCQly
ZXQgPSBQVFJfRVJSKGN0eCk7CkBAIC0xMjc4LDggKzEyNjMsNiBAQCBfX2lndF9jdHhfc3NldShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7
CiAKIG91dF91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
LQogCWlmIChmbGFncyAmIFRFU1RfUkVTRVQpCiAJCWlndF9nbG9iYWxfcmVzZXRfdW5sb2NrKCZp
OTE1LT5ndCk7CiAKQEAgLTEzMzksMjMgKzEzMjIsMjQgQEAgc3RhdGljIGludCBpZ3RfY3R4X3Jl
YWRvbmx5KHZvaWQgKmFyZykKIAlpZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRSX0VSUihm
aWxlKTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJZXJyID0g
aWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgaTkxNSwgX19mdW5jX18sICIiKTsKIAlpZiAoZXJyKQot
CQlnb3RvIG91dF91bmxvY2s7CisJCWdvdG8gb3V0X2ZpbGU7CiAKIAljdHggPSBsaXZlX2NvbnRl
eHQoaTkxNSwgZmlsZSk7CiAJaWYgKElTX0VSUihjdHgpKSB7CiAJCWVyciA9IFBUUl9FUlIoY3R4
KTsKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3RvIG91dF9maWxlOwogCX0KIAotCXZtID0gY3R4
LT52bSA/OiAmaTkxNS0+Z2d0dC5hbGlhcy0+dm07CisJcmN1X3JlYWRfbG9jaygpOworCXZtID0g
cmN1X2RlcmVmZXJlbmNlKGN0eC0+dm0pID86ICZpOTE1LT5nZ3R0LmFsaWFzLT52bTsKIAlpZiAo
IXZtIHx8ICF2bS0+aGFzX3JlYWRfb25seSkgeworCQlyY3VfcmVhZF91bmxvY2soKTsKIAkJZXJy
ID0gMDsKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3RvIG91dF9maWxlOwogCX0KKwlyY3VfcmVh
ZF91bmxvY2soKTsKIAogCW5kd29yZHMgPSAwOwogCWR3ID0gMDsKQEAgLTEzNzMsNyArMTM1Nyw3
IEBAIHN0YXRpYyBpbnQgaWd0X2N0eF9yZWFkb25seSh2b2lkICphcmcpCiAJCQkJaWYgKElTX0VS
UihvYmopKSB7CiAJCQkJCWVyciA9IFBUUl9FUlIob2JqKTsKIAkJCQkJaTkxNV9nZW1fY29udGV4
dF91bmxvY2tfZW5naW5lcyhjdHgpOwotCQkJCQlnb3RvIG91dF91bmxvY2s7CisJCQkJCWdvdG8g
b3V0X2ZpbGU7CiAJCQkJfQogCiAJCQkJaWYgKHByYW5kb21fdTMyX3N0YXRlKCZwcm5nKSAmIDEp
CkBAIC0xMzg0LDE1ICsxMzY4LDE3IEBAIHN0YXRpYyBpbnQgaWd0X2N0eF9yZWFkb25seSh2b2lk
ICphcmcpCiAJCQlpZiAoZXJyKSB7CiAJCQkJcHJfZXJyKCJGYWlsZWQgdG8gZmlsbCBkd29yZCAl
bHUgWyVsdS8lbHVdIHdpdGggZ3B1ICglcykgW2Z1bGwtcHBndHQ/ICVzXSwgZXJyPSVkXG4iLAog
CQkJCSAgICAgICBuZHdvcmRzLCBkdywgbWF4X2R3b3JkcyhvYmopLAotCQkJCSAgICAgICBjZS0+
ZW5naW5lLT5uYW1lLCB5ZXNubyghIWN0eC0+dm0pLCBlcnIpOworCQkJCSAgICAgICBjZS0+ZW5n
aW5lLT5uYW1lLAorCQkJCSAgICAgICB5ZXNubyghIXJjdV9hY2Nlc3NfcG9pbnRlcihjdHgtPnZt
KSksCisJCQkJICAgICAgIGVycik7CiAJCQkJaTkxNV9nZW1fY29udGV4dF91bmxvY2tfZW5naW5l
cyhjdHgpOwotCQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCQlnb3RvIG91dF9maWxlOwogCQkJfQog
CiAJCQllcnIgPSB0aHJvdHRsZShjZSwgdHEsIEFSUkFZX1NJWkUodHEpKTsKIAkJCWlmIChlcnIp
IHsKIAkJCQlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19lbmdpbmVzKGN0eCk7Ci0JCQkJZ290byBv
dXRfdW5sb2NrOworCQkJCWdvdG8gb3V0X2ZpbGU7CiAJCQl9CiAKIAkJCWlmICgrK2R3ID09IG1h
eF9kd29yZHMob2JqKSkgewpAQCAtMTQyNCwyMCArMTQxMCwxOSBAQCBzdGF0aWMgaW50IGlndF9j
dHhfcmVhZG9ubHkodm9pZCAqYXJnKQogCQlkdyArPSByZW07CiAJfQogCi1vdXRfdW5sb2NrOgor
b3V0X2ZpbGU6CiAJdGhyb3R0bGVfcmVsZWFzZSh0cSwgQVJSQVlfU0laRSh0cSkpOwogCWlmIChp
Z3RfbGl2ZV90ZXN0X2VuZCgmdCkpCiAJCWVyciA9IC1FSU87Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKIAogCW1vY2tfZmlsZV9mcmVlKGk5MTUsIGZpbGUpOwogCXJl
dHVybiBlcnI7CiB9CiAKLXN0YXRpYyBpbnQgY2hlY2tfc2NyYXRjaChzdHJ1Y3QgaTkxNV9nZW1f
Y29udGV4dCAqY3R4LCB1NjQgb2Zmc2V0KQorc3RhdGljIGludCBjaGVja19zY3JhdGNoKHN0cnVj
dCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLCB1NjQgb2Zmc2V0KQogewogCXN0cnVjdCBkcm1fbW1f
bm9kZSAqbm9kZSA9Ci0JCV9fZHJtX21tX2ludGVydmFsX2ZpcnN0KCZjdHgtPnZtLT5tbSwKKwkJ
X19kcm1fbW1faW50ZXJ2YWxfZmlyc3QoJnZtLT5tbSwKIAkJCQkJb2Zmc2V0LCBvZmZzZXQgKyBz
aXplb2YodTMyKSAtIDEpOwogCWlmICghbm9kZSB8fCBub2RlLT5zdGFydCA+IG9mZnNldCkKIAkJ
cmV0dXJuIDA7CkBAIC0xNDU1LDYgKzE0NDAsNyBAQCBzdGF0aWMgaW50IHdyaXRlX3RvX3NjcmF0
Y2goc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IGN0eC0+aTkxNTsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
OworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwogCXN0cnVjdCBpOTE1X3JlcXVlc3Qg
KnJxOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCXUzMiAqY21kOwpAQCAtMTQ4NywxNyArMTQ3
MywxOCBAQCBzdGF0aWMgaW50IHdyaXRlX3RvX3NjcmF0Y2goc3RydWN0IGk5MTVfZ2VtX2NvbnRl
eHQgKmN0eCwKIAogCWludGVsX2d0X2NoaXBzZXRfZmx1c2goZW5naW5lLT5ndCk7CiAKLQl2bWEg
PSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosIGN0eC0+dm0sIE5VTEwpOworCXZtID0gaTkxNV9nZW1f
Y29udGV4dF9nZXRfdm1fcmN1KGN0eCk7CisJdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCB2
bSwgTlVMTCk7CiAJaWYgKElTX0VSUih2bWEpKSB7CiAJCWVyciA9IFBUUl9FUlIodm1hKTsKLQkJ
Z290byBlcnI7CisJCWdvdG8gZXJyX3ZtOwogCX0KIAogCWVyciA9IGk5MTVfdm1hX3Bpbih2bWEs
IDAsIDAsIFBJTl9VU0VSIHwgUElOX09GRlNFVF9GSVhFRCk7CiAJaWYgKGVycikKLQkJZ290byBl
cnI7CisJCWdvdG8gZXJyX3ZtOwogCi0JZXJyID0gY2hlY2tfc2NyYXRjaChjdHgsIG9mZnNldCk7
CisJZXJyID0gY2hlY2tfc2NyYXRjaCh2bSwgb2Zmc2V0KTsKIAlpZiAoZXJyKQogCQlnb3RvIGVy
cl91bnBpbjsKIApAQCAtMTUyMyw2ICsxNTEwLDcgQEAgc3RhdGljIGludCB3cml0ZV90b19zY3Jh
dGNoKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAKIAlpOTE1X3JlcXVlc3RfYWRkKHJx
KTsKIAorCWk5MTVfdm1fcHV0KHZtKTsKIAlyZXR1cm4gMDsKIAogc2tpcF9yZXF1ZXN0OgpAQCAt
MTUzMSw2ICsxNTE5LDggQEAgc3RhdGljIGludCB3cml0ZV90b19zY3JhdGNoKHN0cnVjdCBpOTE1
X2dlbV9jb250ZXh0ICpjdHgsCiAJaTkxNV9yZXF1ZXN0X2FkZChycSk7CiBlcnJfdW5waW46CiAJ
aTkxNV92bWFfdW5waW4odm1hKTsKK2Vycl92bToKKwlpOTE1X3ZtX3B1dCh2bSk7CiBlcnI6CiAJ
aTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwogCXJldHVybiBlcnI7CkBAIC0xNTQyLDYgKzE1MzIs
NyBAQCBzdGF0aWMgaW50IHJlYWRfZnJvbV9zY3JhdGNoKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0
ICpjdHgsCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBjdHgtPmk5MTU7CiAJ
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3Nw
YWNlICp2bTsKIAljb25zdCB1MzIgUkNTX0dQUjAgPSAweDI2MDA7IC8qIG5vdCBhbGwgZW5naW5l
cyBoYXZlIHRoZWlyIG93biBHUFIhICovCiAJY29uc3QgdTMyIHJlc3VsdCA9IDB4MTAwOwogCXN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwpAQCAtMTU4NiwxNyArMTU3NywxOCBAQCBzdGF0aWMgaW50
IHJlYWRfZnJvbV9zY3JhdGNoKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAKIAlpbnRl
bF9ndF9jaGlwc2V0X2ZsdXNoKGVuZ2luZS0+Z3QpOwogCi0Jdm1hID0gaTkxNV92bWFfaW5zdGFu
Y2Uob2JqLCBjdHgtPnZtLCBOVUxMKTsKKwl2bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3Jj
dShjdHgpOworCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgdm0sIE5VTEwpOwogCWlmIChJ
U19FUlIodm1hKSkgewogCQllcnIgPSBQVFJfRVJSKHZtYSk7Ci0JCWdvdG8gZXJyOworCQlnb3Rv
IGVycl92bTsKIAl9CiAKIAllcnIgPSBpOTE1X3ZtYV9waW4odm1hLCAwLCAwLCBQSU5fVVNFUiB8
IFBJTl9PRkZTRVRfRklYRUQpOwogCWlmIChlcnIpCi0JCWdvdG8gZXJyOworCQlnb3RvIGVycl92
bTsKIAotCWVyciA9IGNoZWNrX3NjcmF0Y2goY3R4LCBvZmZzZXQpOworCWVyciA9IGNoZWNrX3Nj
cmF0Y2godm0sIG9mZnNldCk7CiAJaWYgKGVycikKIAkJZ290byBlcnJfdW5waW47CiAKQEAgLTE2
MjcsMTIgKzE2MTksMTIgQEAgc3RhdGljIGludCByZWFkX2Zyb21fc2NyYXRjaChzdHJ1Y3QgaTkx
NV9nZW1fY29udGV4dCAqY3R4LAogCWVyciA9IGk5MTVfZ2VtX29iamVjdF9zZXRfdG9fY3B1X2Rv
bWFpbihvYmosIGZhbHNlKTsKIAlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKG9iaik7CiAJaWYgKGVy
cikKLQkJZ290byBlcnI7CisJCWdvdG8gZXJyX3ZtOwogCiAJY21kID0gaTkxNV9nZW1fb2JqZWN0
X3Bpbl9tYXAob2JqLCBJOTE1X01BUF9XQik7CiAJaWYgKElTX0VSUihjbWQpKSB7CiAJCWVyciA9
IFBUUl9FUlIoY21kKTsKLQkJZ290byBlcnI7CisJCWdvdG8gZXJyX3ZtOwogCX0KIAogCSp2YWx1
ZSA9IGNtZFtyZXN1bHQgLyBzaXplb2YoKmNtZCldOwpAQCAtMTY0Nyw2ICsxNjM5LDggQEAgc3Rh
dGljIGludCByZWFkX2Zyb21fc2NyYXRjaChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAog
CWk5MTVfcmVxdWVzdF9hZGQocnEpOwogZXJyX3VucGluOgogCWk5MTVfdm1hX3VucGluKHZtYSk7
CitlcnJfdm06CisJaTkxNV92bV9wdXQodm0pOwogZXJyOgogCWk5MTVfZ2VtX29iamVjdF9wdXQo
b2JqKTsKIAlyZXR1cm4gZXJyOwpAQCAtMTY3NywyNyArMTY3MSwyNSBAQCBzdGF0aWMgaW50IGln
dF92bV9pc29sYXRpb24odm9pZCAqYXJnKQogCWlmIChJU19FUlIoZmlsZSkpCiAJCXJldHVybiBQ
VFJfRVJSKGZpbGUpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0K
IAllcnIgPSBpZ3RfbGl2ZV90ZXN0X2JlZ2luKCZ0LCBpOTE1LCBfX2Z1bmNfXywgIiIpOwogCWlm
IChlcnIpCi0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290byBvdXRfZmlsZTsKIAogCWN0eF9hID0g
bGl2ZV9jb250ZXh0KGk5MTUsIGZpbGUpOwogCWlmIChJU19FUlIoY3R4X2EpKSB7CiAJCWVyciA9
IFBUUl9FUlIoY3R4X2EpOwotCQlnb3RvIG91dF91bmxvY2s7CisJCWdvdG8gb3V0X2ZpbGU7CiAJ
fQogCiAJY3R4X2IgPSBsaXZlX2NvbnRleHQoaTkxNSwgZmlsZSk7CiAJaWYgKElTX0VSUihjdHhf
YikpIHsKIAkJZXJyID0gUFRSX0VSUihjdHhfYik7Ci0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290
byBvdXRfZmlsZTsKIAl9CiAKIAkvKiBXZSBjYW4gb25seSB0ZXN0IHZtIGlzb2xhdGlvbiwgaWYg
dGhlIHZtIGFyZSBkaXN0aW5jdCAqLwogCWlmIChjdHhfYS0+dm0gPT0gY3R4X2ItPnZtKQotCQln
b3RvIG91dF91bmxvY2s7CisJCWdvdG8gb3V0X2ZpbGU7CiAKIAl2bV90b3RhbCA9IGN0eF9hLT52
bS0+dG90YWw7CiAJR0VNX0JVR19PTihjdHhfYi0+dm0tPnRvdGFsICE9IHZtX3RvdGFsKTsKQEAg
LTE3MjYsNyArMTcxOCw3IEBAIHN0YXRpYyBpbnQgaWd0X3ZtX2lzb2xhdGlvbih2b2lkICphcmcp
CiAJCQkJZXJyID0gcmVhZF9mcm9tX3NjcmF0Y2goY3R4X2IsIGVuZ2luZSwKIAkJCQkJCQlvZmZz
ZXQsICZ2YWx1ZSk7CiAJCQlpZiAoZXJyKQotCQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCQlnb3Rv
IG91dF9maWxlOwogCiAJCQlpZiAodmFsdWUpIHsKIAkJCQlwcl9lcnIoIiVzOiBSZWFkICUwOHgg
ZnJvbSBzY3JhdGNoIChvZmZzZXQgMHglMDh4XyUwOHgpLCBhZnRlciAlbHUgcmVhZHMhXG4iLApA
QCAtMTczNSw3ICsxNzI3LDcgQEAgc3RhdGljIGludCBpZ3Rfdm1faXNvbGF0aW9uKHZvaWQgKmFy
ZykKIAkJCQkgICAgICAgbG93ZXJfMzJfYml0cyhvZmZzZXQpLAogCQkJCSAgICAgICB0aGlzKTsK
IAkJCQllcnIgPSAtRUlOVkFMOwotCQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCQlnb3RvIG91dF9m
aWxlOwogCQkJfQogCiAJCQl0aGlzKys7CkBAIC0xNzQ1LDExICsxNzM3LDkgQEAgc3RhdGljIGlu
dCBpZ3Rfdm1faXNvbGF0aW9uKHZvaWQgKmFyZykKIAlwcl9pbmZvKCJDaGVja2VkICVsdSBzY3Jh
dGNoIG9mZnNldHMgYWNyb3NzICVkIGVuZ2luZXNcbiIsCiAJCWNvdW50LCBSVU5USU1FX0lORk8o
aTkxNSktPm51bV9lbmdpbmVzKTsKIAotb3V0X3VubG9jazoKK291dF9maWxlOgogCWlmIChpZ3Rf
bGl2ZV90ZXN0X2VuZCgmdCkpCiAJCWVyciA9IC1FSU87Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKLQogCW1vY2tfZmlsZV9mcmVlKGk5MTUsIGZpbGUpOwogCXJldHVy
biBlcnI7CiB9CkBAIC0xNzgxLDEzICsxNzcxLDkgQEAgc3RhdGljIGludCBtb2NrX2NvbnRleHRf
YmFycmllcih2b2lkICphcmcpCiAJICogYSByZXF1ZXN0OyB1c2VmdWwgZm9yIHJldGlyaW5nIG9s
ZCBzdGF0ZSBhZnRlciBsb2FkaW5nIG5ldy4KIAkgKi8KIAotCW11dGV4X2xvY2soJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwotCiAJY3R4ID0gbW9ja19jb250ZXh0KGk5MTUsICJtb2NrIik7Ci0J
aWYgKCFjdHgpIHsKLQkJZXJyID0gLUVOT01FTTsKLQkJZ290byB1bmxvY2s7Ci0JfQorCWlmICgh
Y3R4KQorCQlyZXR1cm4gLUVOT01FTTsKIAogCWNvdW50ZXIgPSAwOwogCWVyciA9IGNvbnRleHRf
YmFycmllcl90YXNrKGN0eCwgMCwKQEAgLTE4NjAsOCArMTg0Niw2IEBAIHN0YXRpYyBpbnQgbW9j
a19jb250ZXh0X2JhcnJpZXIodm9pZCAqYXJnKQogCiBvdXQ6CiAJbW9ja19jb250ZXh0X2Nsb3Nl
KGN0eCk7Ci11bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
IAlyZXR1cm4gZXJyOwogI3VuZGVmIHByX2ZtdAogI2RlZmluZSBwcl9mbXQoeCkgeApkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvbW9ja19jb250ZXh0LmMKaW5kZXgg
MDEwNGYxNmIxMzI3Li43NGRkZDY4MmM5Y2QgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9zZWxmdGVzdHMvbW9ja19jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQuYwpAQCAtNDIsNyArNDIsMTAgQEAgbW9ja19j
b250ZXh0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQlpZiAoIXBwZ3R0KQogCQkJ
Z290byBlcnJfcHV0OwogCisJCW11dGV4X2xvY2soJmN0eC0+bXV0ZXgpOwogCQlfX3NldF9wcGd0
dChjdHgsICZwcGd0dC0+dm0pOworCQltdXRleF91bmxvY2soJmN0eC0+bXV0ZXgpOworCiAJCWk5
MTVfdm1fcHV0KCZwcGd0dC0+dm0pOwogCX0KIApAQCAtNjUsNyArNjgsNyBAQCB2b2lkIG1vY2tf
Y29udGV4dF9jbG9zZShzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQogCiB2b2lkIG1vY2tf
aW5pdF9jb250ZXh0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlpbml0X2Nv
bnRleHRzKGk5MTUpOworCWluaXRfY29udGV4dHMoJmk5MTUtPmdlbS5jb250ZXh0cyk7CiB9CiAK
IHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICoKQEAgLTc0LDggKzc3LDYgQEAgbGl2ZV9jb250ZXh0
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCiAJ
c3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKIAlpbnQgZXJyOwogCi0JbG9ja2RlcF9hc3Nl
cnRfaGVsZCgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAljdHggPSBpOTE1X2dlbV9jcmVh
dGVfY29udGV4dChpOTE1LCAwKTsKIAlpZiAoSVNfRVJSKGN0eCkpCiAJCXJldHVybiBjdHg7CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKaW5kZXggMzVhNDBjMjgyMGEyLi5i
ZTM0ZDk3YWMxOGYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Nv
bnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKQEAg
LTIyMSwxMiArMjIxLDIwIEBAIGludGVsX2NvbnRleHRfaW5pdChzdHJ1Y3QgaW50ZWxfY29udGV4
dCAqY2UsCiAJCSAgIHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCSAgIHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2
bTsKKwogCUdFTV9CVUdfT04oIWVuZ2luZS0+Y29wcyk7CiAKIAlrcmVmX2luaXQoJmNlLT5yZWYp
OwogCiAJY2UtPmdlbV9jb250ZXh0ID0gY3R4OwotCWNlLT52bSA9IGk5MTVfdm1fZ2V0KGN0eC0+
dm0gPzogJmVuZ2luZS0+Z3QtPmdndHQtPnZtKTsKKwlyY3VfcmVhZF9sb2NrKCk7CisJdm0gPSBy
Y3VfZGVyZWZlcmVuY2UoY3R4LT52bSk7CisJaWYgKHZtKQorCQljZS0+dm0gPSBpOTE1X3ZtX2dl
dCh2bSk7CisJZWxzZQorCQljZS0+dm0gPSBpOTE1X3ZtX2dldCgmZW5naW5lLT5ndC0+Z2d0dC0+
dm0pOworCXJjdV9yZWFkX3VubG9jaygpOwogCWlmIChjdHgtPnRpbWVsaW5lKQogCQljZS0+dGlt
ZWxpbmUgPSBpbnRlbF90aW1lbGluZV9nZXQoY3R4LT50aW1lbGluZSk7CiAKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYwppbmRleCA4NmNmZmJiMGE5Y2IuLjdjODM4
YTU3ZTE3NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29u
dGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYwpA
QCAtMTU1LDEzICsxNTUsOSBAQCBzdGF0aWMgaW50IGxpdmVfY29udGV4dF9zaXplKHZvaWQgKmFy
ZykKIAkgKiBIVyB0cmllcyB0byB3cml0ZSBwYXN0IHRoZSBlbmQgb2Ygb25lLgogCSAqLwogCi0J
bXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJZml4bWUgPSBrZXJu
ZWxfY29udGV4dChndC0+aTkxNSk7Ci0JaWYgKElTX0VSUihmaXhtZSkpIHsKLQkJZXJyID0gUFRS
X0VSUihmaXhtZSk7Ci0JCWdvdG8gdW5sb2NrOwotCX0KKwlpZiAoSVNfRVJSKGZpeG1lKSkKKwkJ
cmV0dXJuIFBUUl9FUlIoZml4bWUpOwogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5
MTUsIGlkKSB7CiAJCXN0cnVjdCB7CkBAIC0yMDEsOCArMTk3LDYgQEAgc3RhdGljIGludCBsaXZl
X2NvbnRleHRfc2l6ZSh2b2lkICphcmcpCiAJfQogCiAJa2VybmVsX2NvbnRleHRfY2xvc2UoZml4
bWUpOwotdW5sb2NrOgotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwogCXJldHVybiBlcnI7CiB9CiAKQEAgLTMwNSwxMiArMjk5LDEwIEBAIHN0YXRpYyBpbnQgbGl2
ZV9hY3RpdmVfY29udGV4dCh2b2lkICphcmcpCiAJaWYgKElTX0VSUihmaWxlKSkKIAkJcmV0dXJu
IFBUUl9FUlIoZmlsZSk7CiAKLQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7Ci0KIAlmaXhtZSA9IGxpdmVfY29udGV4dChndC0+aTkxNSwgZmlsZSk7CiAJaWYgKElTX0VS
UihmaXhtZSkpIHsKIAkJZXJyID0gUFRSX0VSUihmaXhtZSk7Ci0JCWdvdG8gdW5sb2NrOworCQln
b3RvIG91dF9maWxlOwogCX0KIAogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LT5pOTE1LCBp
ZCkgewpAQCAtMzIzLDggKzMxNSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9hY3RpdmVfY29udGV4dCh2
b2lkICphcmcpCiAJCQlicmVhazsKIAl9CiAKLXVubG9jazoKLQltdXRleF91bmxvY2soJmd0LT5p
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKK291dF9maWxlOgogCW1vY2tfZmlsZV9mcmVlKGd0LT5p
OTE1LCBmaWxlKTsKIAlyZXR1cm4gZXJyOwogfQpAQCAtNDE4LDEyICs0MDksMTAgQEAgc3RhdGlj
IGludCBsaXZlX3JlbW90ZV9jb250ZXh0KHZvaWQgKmFyZykKIAlpZiAoSVNfRVJSKGZpbGUpKQog
CQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKIAotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKLQogCWZpeG1lID0gbGl2ZV9jb250ZXh0KGd0LT5pOTE1LCBmaWxlKTsKIAlp
ZiAoSVNfRVJSKGZpeG1lKSkgewogCQllcnIgPSBQVFJfRVJSKGZpeG1lKTsKLQkJZ290byB1bmxv
Y2s7CisJCWdvdG8gb3V0X2ZpbGU7CiAJfQogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3Qt
Pmk5MTUsIGlkKSB7CkBAIC00MzYsOCArNDI1LDcgQEAgc3RhdGljIGludCBsaXZlX3JlbW90ZV9j
b250ZXh0KHZvaWQgKmFyZykKIAkJCWJyZWFrOwogCX0KIAotdW5sb2NrOgotCW11dGV4X3VubG9j
aygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworb3V0X2ZpbGU6CiAJbW9ja19maWxlX2Zy
ZWUoZ3QtPmk5MTUsIGZpbGUpOwogCXJldHVybiBlcnI7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jCmluZGV4IGZmYmIzZDIzYjg4Ny4uZThhNDBkZjc5
YmQwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hl
Y2suYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYwpA
QCAtNTgsOSArNTgsNyBAQCBzdGF0aWMgaW50IGhhbmdfaW5pdChzdHJ1Y3QgaGFuZyAqaCwgc3Ry
dWN0IGludGVsX2d0ICpndCkKIAltZW1zZXQoaCwgMCwgc2l6ZW9mKCpoKSk7CiAJaC0+Z3QgPSBn
dDsKIAotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAloLT5jdHgg
PSBrZXJuZWxfY29udGV4dChndC0+aTkxNSk7Ci0JbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CiAJaWYgKElTX0VSUihoLT5jdHgpKQogCQlyZXR1cm4gUFRSX0VSUiho
LT5jdHgpOwogCkBAIC0xMzMsNyArMTMxLDcgQEAgc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3Qg
KgogaGFuZ19jcmVhdGVfcmVxdWVzdChzdHJ1Y3QgaGFuZyAqaCwgc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lKQogewogCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBoLT5ndDsKLQlzdHJ1Y3Qg
aTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9IGgtPmN0eC0+dm0gPzogJmVuZ2luZS0+Z3QtPmdndHQt
PnZtOworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gaTkxNV9nZW1fY29udGV4dF9n
ZXRfdm1fcmN1KGgtPmN0eCk7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKIAlz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSA9IE5VTEw7CiAJc3RydWN0IGk5MTVfdm1hICpod3MsICp2
bWE7CkBAIC0xNDMsMTIgKzE0MSwxNSBAQCBoYW5nX2NyZWF0ZV9yZXF1ZXN0KHN0cnVjdCBoYW5n
ICpoLCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJaW50IGVycjsKIAogCW9iaiA9
IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoZ3QtPmk5MTUsIFBBR0VfU0laRSk7Ci0J
aWYgKElTX0VSUihvYmopKQorCWlmIChJU19FUlIob2JqKSkgeworCQlpOTE1X3ZtX3B1dCh2bSk7
CiAJCXJldHVybiBFUlJfQ0FTVChvYmopOworCX0KIAogCXZhZGRyID0gaTkxNV9nZW1fb2JqZWN0
X3Bpbl9tYXAob2JqLCBpOTE1X2NvaGVyZW50X21hcF90eXBlKGd0LT5pOTE1KSk7CiAJaWYgKElT
X0VSUih2YWRkcikpIHsKIAkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCQlpOTE1X3ZtX3B1
dCh2bSk7CiAJCXJldHVybiBFUlJfQ0FTVCh2YWRkcik7CiAJfQogCkBAIC0xNTksMTYgKzE2MCwy
MiBAQCBoYW5nX2NyZWF0ZV9yZXF1ZXN0KHN0cnVjdCBoYW5nICpoLCBzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmUpCiAJaC0+YmF0Y2ggPSB2YWRkcjsKIAogCXZtYSA9IGk5MTVfdm1hX2lu
c3RhbmNlKGgtPm9iaiwgdm0sIE5VTEwpOwotCWlmIChJU19FUlIodm1hKSkKKwlpZiAoSVNfRVJS
KHZtYSkpIHsKKwkJaTkxNV92bV9wdXQodm0pOwogCQlyZXR1cm4gRVJSX0NBU1Qodm1hKTsKKwl9
CiAKIAlod3MgPSBpOTE1X3ZtYV9pbnN0YW5jZShoLT5od3MsIHZtLCBOVUxMKTsKLQlpZiAoSVNf
RVJSKGh3cykpCisJaWYgKElTX0VSUihod3MpKSB7CisJCWk5MTVfdm1fcHV0KHZtKTsKIAkJcmV0
dXJuIEVSUl9DQVNUKGh3cyk7CisJfQogCiAJZXJyID0gaTkxNV92bWFfcGluKHZtYSwgMCwgMCwg
UElOX1VTRVIpOwotCWlmIChlcnIpCisJaWYgKGVycikgeworCQlpOTE1X3ZtX3B1dCh2bSk7CiAJ
CXJldHVybiBFUlJfUFRSKGVycik7CisJfQogCiAJZXJyID0gaTkxNV92bWFfcGluKGh3cywgMCwg
MCwgUElOX1VTRVIpOwogCWlmIChlcnIpCkBAIC0yNjYsNiArMjczLDcgQEAgaGFuZ19jcmVhdGVf
cmVxdWVzdChzdHJ1Y3QgaGFuZyAqaCwgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQog
CWk5MTVfdm1hX3VucGluKGh3cyk7CiB1bnBpbl92bWE6CiAJaTkxNV92bWFfdW5waW4odm1hKTsK
KwlpOTE1X3ZtX3B1dCh2bSk7CiAJcmV0dXJuIGVyciA/IEVSUl9QVFIoZXJyKSA6IHJxOwogfQog
CkBAIC0zODIsOSArMzkwLDcgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfbm9wKHZvaWQgKmFyZykK
IAlpZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRSX0VSUihmaWxlKTsKIAotCW11dGV4X2xv
Y2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAljdHggPSBsaXZlX2NvbnRleHQoZ3Qt
Pmk5MTUsIGZpbGUpOwotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwogCWlmIChJU19FUlIoY3R4KSkgewogCQllcnIgPSBQVFJfRVJSKGN0eCk7CiAJCWdvdG8gb3V0
OwpAQCAtNDU4LDkgKzQ2NCw3IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X25vcF9lbmdpbmUodm9p
ZCAqYXJnKQogCWlmIChJU19FUlIoZmlsZSkpCiAJCXJldHVybiBQVFJfRVJSKGZpbGUpOwogCi0J
bXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWN0eCA9IGxpdmVfY29u
dGV4dChndC0+aTkxNSwgZmlsZSk7Ci0JbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7CiAJaWYgKElTX0VSUihjdHgpKSB7CiAJCWVyciA9IFBUUl9FUlIoY3R4KTsKIAkJ
Z290byBvdXQ7CkBAIC03MDUsOSArNzA5LDcgQEAgc3RhdGljIGludCBhY3RpdmVfZW5naW5lKHZv
aWQgKmRhdGEpCiAJCXJldHVybiBQVFJfRVJSKGZpbGUpOwogCiAJZm9yIChjb3VudCA9IDA7IGNv
dW50IDwgQVJSQVlfU0laRShjdHgpOyBjb3VudCsrKSB7Ci0JCW11dGV4X2xvY2soJmVuZ2luZS0+
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWN0eFtjb3VudF0gPSBsaXZlX2NvbnRleHQoZW5n
aW5lLT5pOTE1LCBmaWxlKTsKLQkJbXV0ZXhfdW5sb2NrKCZlbmdpbmUtPmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCQlpZiAoSVNfRVJSKGN0eFtjb3VudF0pKSB7CiAJCQllcnIgPSBQVFJfRVJS
KGN0eFtjb3VudF0pOwogCQkJd2hpbGUgKC0tY291bnQpCkBAIC0xMjkxLDYgKzEyOTMsNyBAQCBz
dGF0aWMgaW50IGlndF9yZXNldF9ldmljdF9wcGd0dCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGlu
dGVsX2d0ICpndCA9IGFyZzsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OworCXN0cnVj
dCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwogCXN0cnVjdCBkcm1fZmlsZSAqZmlsZTsKIAlpbnQg
ZXJyOwogCkBAIC0xMjk4LDE4ICsxMzAxLDIwIEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X2V2aWN0
X3BwZ3R0KHZvaWQgKmFyZykKIAlpZiAoSVNfRVJSKGZpbGUpKQogCQlyZXR1cm4gUFRSX0VSUihm
aWxlKTsKIAotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAljdHgg
PSBsaXZlX2NvbnRleHQoZ3QtPmk5MTUsIGZpbGUpOwotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChJU19FUlIoY3R4KSkgewogCQllcnIgPSBQVFJfRVJS
KGN0eCk7CiAJCWdvdG8gb3V0OwogCX0KIAogCWVyciA9IDA7Ci0JaWYgKGN0eC0+dm0pIC8qIGFs
aWFzaW5nID09IGdsb2JhbCBndHQgbG9ja2luZywgY292ZXJlZCBhYm92ZSAqLwotCQllcnIgPSBf
X2lndF9yZXNldF9ldmljdF92bWEoZ3QsIGN0eC0+dm0sCisJdm0gPSBpOTE1X2dlbV9jb250ZXh0
X2dldF92bV9yY3UoY3R4KTsKKwlpZiAoIWk5MTVfaXNfZ2d0dCh2bSkpIHsKKwkJLyogYWxpYXNp
bmcgPT0gZ2xvYmFsIGd0dCBsb2NraW5nLCBjb3ZlcmVkIGFib3ZlICovCisJCWVyciA9IF9faWd0
X3Jlc2V0X2V2aWN0X3ZtYShndCwgdm0sCiAJCQkJCSAgICBldmljdF92bWEsIEVYRUNfT0JKRUNU
X1dSSVRFKTsKKwl9CisJaTkxNV92bV9wdXQodm0pOwogCiBvdXQ6CiAJbW9ja19maWxlX2ZyZWUo
Z3QtPmk5MTUsIGZpbGUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwppbmRl
eCAwNGMxY2Y1NzM2NDIuLjhkYzQyYzVjNzU2OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfbHJjLmMKQEAgLTE2MzEsNyArMTYzMSwxMSBAQCBzdGF0aWMgaW50IHNtb2tlX3N1Ym1p
dChzdHJ1Y3QgcHJlZW1wdF9zbW9rZSAqc21va2UsCiAJaW50IGVyciA9IDA7CiAKIAlpZiAoYmF0
Y2gpIHsKLQkJdm1hID0gaTkxNV92bWFfaW5zdGFuY2UoYmF0Y2gsIGN0eC0+dm0sIE5VTEwpOwor
CQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKKworCQl2bSA9IGk5MTVfZ2VtX2NvbnRl
eHRfZ2V0X3ZtX3JjdShjdHgpOworCQl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShiYXRjaCwgdm0s
IE5VTEwpOworCQlpOTE1X3ZtX3B1dCh2bSk7CiAJCWlmIChJU19FUlIodm1hKSkKIAkJCXJldHVy
biBQVFJfRVJSKHZtYSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Nl
bGZ0ZXN0X3dvcmthcm91bmRzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93
b3JrYXJvdW5kcy5jCmluZGV4IDRlZTJlMmJhYmQwZC4uN2M3YWNlYjg1YTc0IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMKQEAgLTI2MCw3ICsy
NjAsNiBAQCBzd2l0Y2hfdG9fc2NyYXRjaF9jb250ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZSwKIAkJcnEgPSBpZ3Rfc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdChzcGluLCBjZSwgTUlf
Tk9PUCk7CiAKIAlpbnRlbF9jb250ZXh0X3B1dChjZSk7Ci0Ja2VybmVsX2NvbnRleHRfY2xvc2Uo
Y3R4KTsKIAogCWlmIChJU19FUlIocnEpKSB7CiAJCXNwaW4gPSBOVUxMOwpAQCAtMjc5LDYgKzI3
OCw3IEBAIHN3aXRjaF90b19zY3JhdGNoX2NvbnRleHQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lLAogCWlmIChlcnIgJiYgc3BpbikKIAkJaWd0X3NwaW5uZXJfZW5kKHNwaW4pOwogCisJ
a2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKIAlyZXR1cm4gZXJyOwogfQogCkBAIC0zNTUsNiAr
MzU1LDcgQEAgc3RhdGljIGludCBjaGVja193aGl0ZWxpc3RfYWNyb3NzX3Jlc2V0KHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKmNyZWF0ZV9i
YXRjaChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4KQogewogCXN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmo7CisJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CiAJc3RydWN0
IGk5MTVfdm1hICp2bWE7CiAJaW50IGVycjsKIApAQCAtMzYyLDcgKzM2Myw5IEBAIHN0YXRpYyBz
dHJ1Y3QgaTkxNV92bWEgKmNyZWF0ZV9iYXRjaChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4
KQogCWlmIChJU19FUlIob2JqKSkKIAkJcmV0dXJuIEVSUl9DQVNUKG9iaik7CiAKLQl2bWEgPSBp
OTE1X3ZtYV9pbnN0YW5jZShvYmosIGN0eC0+dm0sIE5VTEwpOworCXZtID0gaTkxNV9nZW1fY29u
dGV4dF9nZXRfdm1fcmN1KGN0eCk7CisJdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCB2bSwg
TlVMTCk7CisJaTkxNV92bV9wdXQodm0pOwogCWlmIChJU19FUlIodm1hKSkgewogCQllcnIgPSBQ
VFJfRVJSKHZtYSk7CiAJCWdvdG8gZXJyX29iajsKQEAgLTQ2MywxMiArNDY2LDE1IEBAIHN0YXRp
YyBpbnQgY2hlY2tfZGlydHlfd2hpdGVsaXN0KHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgs
CiAJCTB4ZmZmZjAwZmYsCiAJCTB4ZmZmZmZmZmYsCiAJfTsKKwlzdHJ1Y3QgaTkxNV9hZGRyZXNz
X3NwYWNlICp2bTsKIAlzdHJ1Y3QgaTkxNV92bWEgKnNjcmF0Y2g7CiAJc3RydWN0IGk5MTVfdm1h
ICpiYXRjaDsKIAlpbnQgZXJyID0gMCwgaSwgdjsKIAl1MzIgKmNzLCAqcmVzdWx0czsKIAotCXNj
cmF0Y2ggPSBjcmVhdGVfc2NyYXRjaChjdHgtPnZtLCAyICogQVJSQVlfU0laRSh2YWx1ZXMpICsg
MSk7CisJdm0gPSBpOTE1X2dlbV9jb250ZXh0X2dldF92bV9yY3UoY3R4KTsKKwlzY3JhdGNoID0g
Y3JlYXRlX3NjcmF0Y2godm0sIDIgKiBBUlJBWV9TSVpFKHZhbHVlcykgKyAxKTsKKwlpOTE1X3Zt
X3B1dCh2bSk7CiAJaWYgKElTX0VSUihzY3JhdGNoKSkKIAkJcmV0dXJuIFBUUl9FUlIoc2NyYXRj
aCk7CiAKQEAgLTEwMTAsNiArMTAxNiw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9pc29sYXRlZF93aGl0
ZWxpc3Qodm9pZCAqYXJnKQogCQlyZXR1cm4gMDsKIAogCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9T
SVpFKGNsaWVudCk7IGkrKykgeworCQlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKIAkJ
c3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmM7CiAKIAkJYyA9IGtlcm5lbF9jb250ZXh0KGk5MTUp
OwpAQCAtMTAxOCwyMiArMTAyNSwyNyBAQCBzdGF0aWMgaW50IGxpdmVfaXNvbGF0ZWRfd2hpdGVs
aXN0KHZvaWQgKmFyZykKIAkJCWdvdG8gZXJyOwogCQl9CiAKLQkJY2xpZW50W2ldLnNjcmF0Y2hb
MF0gPSBjcmVhdGVfc2NyYXRjaChjLT52bSwgMTAyNCk7CisJCXZtID0gaTkxNV9nZW1fY29udGV4
dF9nZXRfdm1fcmN1KGMpOworCisJCWNsaWVudFtpXS5zY3JhdGNoWzBdID0gY3JlYXRlX3NjcmF0
Y2godm0sIDEwMjQpOwogCQlpZiAoSVNfRVJSKGNsaWVudFtpXS5zY3JhdGNoWzBdKSkgewogCQkJ
ZXJyID0gUFRSX0VSUihjbGllbnRbaV0uc2NyYXRjaFswXSk7CisJCQlpOTE1X3ZtX3B1dCh2bSk7
CiAJCQlrZXJuZWxfY29udGV4dF9jbG9zZShjKTsKIAkJCWdvdG8gZXJyOwogCQl9CiAKLQkJY2xp
ZW50W2ldLnNjcmF0Y2hbMV0gPSBjcmVhdGVfc2NyYXRjaChjLT52bSwgMTAyNCk7CisJCWNsaWVu
dFtpXS5zY3JhdGNoWzFdID0gY3JlYXRlX3NjcmF0Y2godm0sIDEwMjQpOwogCQlpZiAoSVNfRVJS
KGNsaWVudFtpXS5zY3JhdGNoWzFdKSkgewogCQkJZXJyID0gUFRSX0VSUihjbGllbnRbaV0uc2Ny
YXRjaFsxXSk7CiAJCQlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmY2xpZW50W2ldLnNjcmF0
Y2hbMF0sIDApOworCQkJaTkxNV92bV9wdXQodm0pOwogCQkJa2VybmVsX2NvbnRleHRfY2xvc2Uo
Yyk7CiAJCQlnb3RvIGVycjsKIAkJfQogCiAJCWNsaWVudFtpXS5jdHggPSBjOworCQlpOTE1X3Zt
X3B1dCh2bSk7CiAJfQogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYwppbmRleCAwM2Y1NjcwODQ1NDguLjY4NTBmMWY0
MDI0MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9zY2hlZHVsZXIuYwpAQCAtMzY1LDcgKzM2NSw4
IEBAIHN0YXRpYyB2b2lkIHNldF9jb250ZXh0X3BwZ3R0X2Zyb21fc2hhZG93KHN0cnVjdCBpbnRl
bF92Z3B1X3dvcmtsb2FkICp3b3JrbG9hZCwKIAkJCQkJICBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqY3R4KQogewogCXN0cnVjdCBpbnRlbF92Z3B1X21tICptbSA9IHdvcmtsb2FkLT5zaGFkb3df
bW07Ci0Jc3RydWN0IGk5MTVfcHBndHQgKnBwZ3R0ID0gaTkxNV92bV90b19wcGd0dChjdHgtPnZt
KTsKKwlzdHJ1Y3QgaTkxNV9wcGd0dCAqcHBndHQgPQorCQlpOTE1X3ZtX3RvX3BwZ3R0KGk5MTVf
Z2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpKTsKIAlpbnQgaSA9IDA7CiAKIAlpZiAobW0tPnBw
Z3R0X21tLnJvb3RfZW50cnlfdHlwZSA9PSBHVFRfVFlQRV9QUEdUVF9ST09UX0w0X0VOVFJZKSB7
CkBAIC0zNzgsNiArMzc5LDggQEAgc3RhdGljIHZvaWQgc2V0X2NvbnRleHRfcHBndHRfZnJvbV9z
aGFkb3coc3RydWN0IGludGVsX3ZncHVfd29ya2xvYWQgKndvcmtsb2FkLAogCQkJcHhfZG1hKHBk
KSA9IG1tLT5wcGd0dF9tbS5zaGFkb3dfcGRwc1tpXTsKIAkJfQogCX0KKworCWk5MTVfdm1fcHV0
KCZwcGd0dC0+dm0pOwogfQogCiBzdGF0aWMgaW50CkBAIC0xMjMwLDIwICsxMjMzLDE4IEBAIGlu
dCBpbnRlbF92Z3B1X3NldHVwX3N1Ym1pc3Npb24oc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAJ
c3RydWN0IGludGVsX3ZncHVfc3VibWlzc2lvbiAqcyA9ICZ2Z3B1LT5zdWJtaXNzaW9uOwogCXN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAq
Y3R4OworCXN0cnVjdCBpOTE1X3BwZ3R0ICpwcGd0dDsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBp
OwogCWludCByZXQ7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQog
CWN0eCA9IGk5MTVfZ2VtX2NvbnRleHRfY3JlYXRlX2tlcm5lbChpOTE1LCBJOTE1X1BSSU9SSVRZ
X01BWCk7Ci0JaWYgKElTX0VSUihjdHgpKSB7Ci0JCXJldCA9IFBUUl9FUlIoY3R4KTsKLQkJZ290
byBvdXRfdW5sb2NrOwotCX0KKwlpZiAoSVNfRVJSKGN0eCkpCisJCXJldHVybiBQVFJfRVJSKGN0
eCk7CiAKIAlpOTE1X2dlbV9jb250ZXh0X3NldF9mb3JjZV9zaW5nbGVfc3VibWlzc2lvbihjdHgp
OwogCi0JaTkxNV9jb250ZXh0X3BwZ3R0X3Jvb3Rfc2F2ZShzLCBpOTE1X3ZtX3RvX3BwZ3R0KGN0
eC0+dm0pKTsKKwlwcGd0dCA9IGk5MTVfdm1fdG9fcHBndHQoaTkxNV9nZW1fY29udGV4dF9nZXRf
dm1fcmN1KGN0eCkpOworCWk5MTVfY29udGV4dF9wcGd0dF9yb290X3NhdmUocywgcHBndHQpOwog
CiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaSkgewogCQlzdHJ1Y3QgaW50ZWxfY29u
dGV4dCAqY2U7CkBAIC0xMjg4LDEyICsxMjg5LDEyIEBAIGludCBpbnRlbF92Z3B1X3NldHVwX3N1
Ym1pc3Npb24oc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAJYXRvbWljX3NldCgmcy0+cnVubmlu
Z193b3JrbG9hZF9udW0sIDApOwogCWJpdG1hcF96ZXJvKHMtPnRsYl9oYW5kbGVfcGVuZGluZywg
STkxNV9OVU1fRU5HSU5FUyk7CiAKKwlpOTE1X3ZtX3B1dCgmcHBndHQtPnZtKTsKIAlpOTE1X2dl
bV9jb250ZXh0X3B1dChjdHgpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAJcmV0dXJuIDA7CiAKIG91dF9zaGFkb3dfY3R4OgotCWk5MTVfY29udGV4dF9wcGd0dF9y
b290X3Jlc3RvcmUocywgaTkxNV92bV90b19wcGd0dChjdHgtPnZtKSk7CisJaTkxNV9jb250ZXh0
X3BwZ3R0X3Jvb3RfcmVzdG9yZShzLCBwcGd0dCk7CiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwg
aTkxNSwgaSkgewogCQlpZiAoSVNfRVJSKHMtPnNoYWRvd1tpXSkpCiAJCQlicmVhazsKQEAgLTEz
MDEsOSArMTMwMiw4IEBAIGludCBpbnRlbF92Z3B1X3NldHVwX3N1Ym1pc3Npb24oc3RydWN0IGlu
dGVsX3ZncHUgKnZncHUpCiAJCWludGVsX2NvbnRleHRfdW5waW4ocy0+c2hhZG93W2ldKTsKIAkJ
aW50ZWxfY29udGV4dF9wdXQocy0+c2hhZG93W2ldKTsKIAl9CisJaTkxNV92bV9wdXQoJnBwZ3R0
LT52bSk7CiAJaTkxNV9nZW1fY29udGV4dF9wdXQoY3R4KTsKLW91dF91bmxvY2s6Ci0JbXV0ZXhf
dW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4gcmV0OwogfQogCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCmluZGV4IDBlOTBhYzYwOGUwNy4uYjA0Y2ViYzI2ZWNh
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwpAQCAtMzE2LDEyICszMTYsMTggQEAg
c3RhdGljIHZvaWQgcHJpbnRfY29udGV4dF9zdGF0cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sCiAJCQkJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RydWN0IGZpbGVfc3RhdHMga3N0
YXRzID0ge307Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKKwlzdHJ1Y3QgaTkxNV9n
ZW1fY29udGV4dCAqY3R4LCAqY247CiAKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KGN0eCwgJmk5MTUt
PmNvbnRleHRzLmxpc3QsIGxpbmspIHsKKwlzcGluX2xvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5s
b2NrKTsKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUoY3R4LCBjbiwgJmk5MTUtPmdlbS5jb250
ZXh0cy5saXN0LCBsaW5rKSB7CiAJCXN0cnVjdCBpOTE1X2dlbV9lbmdpbmVzX2l0ZXIgaXQ7CiAJ
CXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAorCQlpZiAoIWtyZWZfZ2V0X3VubGVzc196ZXJv
KCZjdHgtPnJlZikpCisJCQljb250aW51ZTsKKworCQlzcGluX3VubG9jaygmaTkxNS0+Z2VtLmNv
bnRleHRzLmxvY2spOworCiAJCWZvcl9lYWNoX2dlbV9lbmdpbmUoY2UsCiAJCQkJICAgIGk5MTVf
Z2VtX2NvbnRleHRfbG9ja19lbmdpbmVzKGN0eCksIGl0KSB7CiAJCQlpbnRlbF9jb250ZXh0X2xv
Y2tfcGlubmVkKGNlKTsKQEAgLTMzOCw3ICszNDQsOSBAQCBzdGF0aWMgdm9pZCBwcmludF9jb250
ZXh0X3N0YXRzKHN0cnVjdCBzZXFfZmlsZSAqbSwKIAkJaTkxNV9nZW1fY29udGV4dF91bmxvY2tf
ZW5naW5lcyhjdHgpOwogCiAJCWlmICghSVNfRVJSX09SX05VTEwoY3R4LT5maWxlX3ByaXYpKSB7
Ci0JCQlzdHJ1Y3QgZmlsZV9zdGF0cyBzdGF0cyA9IHsgLnZtID0gY3R4LT52bSwgfTsKKwkJCXN0
cnVjdCBmaWxlX3N0YXRzIHN0YXRzID0geworCQkJCS52bSA9IHJjdV9hY2Nlc3NfcG9pbnRlcihj
dHgtPnZtKSwKKwkJCX07CiAJCQlzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUgPSBjdHgtPmZpbGVfcHJp
di0+ZmlsZTsKIAkJCXN0cnVjdCB0YXNrX3N0cnVjdCAqdGFzazsKIAkJCWNoYXIgbmFtZVs4MF07
CkBAIC0zNTUsNyArMzYzLDEyIEBAIHN0YXRpYyB2b2lkIHByaW50X2NvbnRleHRfc3RhdHMoc3Ry
dWN0IHNlcV9maWxlICptLAogCiAJCQlwcmludF9maWxlX3N0YXRzKG0sIG5hbWUsIHN0YXRzKTsK
IAkJfQorCisJCXNwaW5fbG9jaygmaTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOworCQlsaXN0X3Nh
ZmVfcmVzZXRfbmV4dChjdHgsIGNuLCBsaW5rKTsKKwkJaTkxNV9nZW1fY29udGV4dF9wdXQoY3R4
KTsKIAl9CisJc3Bpbl91bmxvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKIAogCXByaW50
X2ZpbGVfc3RhdHMobSwgIltrXWNvbnRleHRzIiwga3N0YXRzKTsKIH0KQEAgLTM2Myw3ICszNzYs
NiBAQCBzdGF0aWMgdm9pZCBwcmludF9jb250ZXh0X3N0YXRzKHN0cnVjdCBzZXFfZmlsZSAqbSwK
IHN0YXRpYyBpbnQgaTkxNV9nZW1fb2JqZWN0X2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lk
ICpkYXRhKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gbm9kZV90b19pOTE1
KG0tPnByaXZhdGUpOwotCWludCByZXQ7CiAKIAlzZXFfcHJpbnRmKG0sICIldSBzaHJpbmthYmxl
IFsldSBmcmVlXSBvYmplY3RzLCAlbGx1IGJ5dGVzXG4iLAogCQkgICBpOTE1LT5tbS5zaHJpbmtf
Y291bnQsCkBAIC0zNzIsMTIgKzM4NCw3IEBAIHN0YXRpYyBpbnQgaTkxNV9nZW1fb2JqZWN0X2lu
Zm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCiAJc2VxX3B1dGMobSwgJ1xuJyk7
CiAKLQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KIAlwcmludF9jb250ZXh0X3N0YXRzKG0s
IGk5MTUpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlyZXR1
cm4gMDsKIH0KQEAgLTE1NzksMTkgKzE1ODYsMTkgQEAgc3RhdGljIHZvaWQgZGVzY3JpYmVfY3R4
X3Jpbmcoc3RydWN0IHNlcV9maWxlICptLCBzdHJ1Y3QgaW50ZWxfcmluZyAqcmluZykKIAogc3Rh
dGljIGludCBpOTE1X2NvbnRleHRfc3RhdHVzKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqdW51
c2VkKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IG5vZGVfdG9faTkx
NShtLT5wcml2YXRlKTsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmRldl9wcml2LT5kcm07
Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKLQlpbnQgcmV0OwotCi0JcmV0ID0gbXV0
ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZkZXYtPnN0cnVjdF9tdXRleCk7Ci0JaWYgKHJldCkKLQkJ
cmV0dXJuIHJldDsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IG5vZGVfdG9faTkx
NShtLT5wcml2YXRlKTsKKwlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LCAqY247CiAKLQls
aXN0X2Zvcl9lYWNoX2VudHJ5KGN0eCwgJmRldl9wcml2LT5jb250ZXh0cy5saXN0LCBsaW5rKSB7
CisJc3Bpbl9sb2NrKCZpOTE1LT5nZW0uY29udGV4dHMubG9jayk7CisJbGlzdF9mb3JfZWFjaF9l
bnRyeV9zYWZlKGN0eCwgY24sICZpOTE1LT5nZW0uY29udGV4dHMubGlzdCwgbGluaykgewogCQlz
dHJ1Y3QgaTkxNV9nZW1fZW5naW5lc19pdGVyIGl0OwogCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAq
Y2U7CiAKKwkJaWYgKCFrcmVmX2dldF91bmxlc3NfemVybygmY3R4LT5yZWYpKQorCQkJY29udGlu
dWU7CisKKwkJc3Bpbl91bmxvY2soJmk5MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKKwogCQlzZXFf
cHV0cyhtLCAiSFcgY29udGV4dCAiKTsKIAkJaWYgKGN0eC0+cGlkKSB7CiAJCQlzdHJ1Y3QgdGFz
a19zdHJ1Y3QgKnRhc2s7CkBAIC0xNjI2LDkgKzE2MzMsMTIgQEAgc3RhdGljIGludCBpOTE1X2Nv
bnRleHRfc3RhdHVzKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqdW51c2VkKQogCQlpOTE1X2dl
bV9jb250ZXh0X3VubG9ja19lbmdpbmVzKGN0eCk7CiAKIAkJc2VxX3B1dGMobSwgJ1xuJyk7Ci0J
fQogCi0JbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CisJCXNwaW5fbG9jaygmaTkx
NS0+Z2VtLmNvbnRleHRzLmxvY2spOworCQlsaXN0X3NhZmVfcmVzZXRfbmV4dChjdHgsIGNuLCBs
aW5rKTsKKwkJaTkxNV9nZW1fY29udGV4dF9wdXQoY3R4KTsKKwl9CisJc3Bpbl91bmxvY2soJmk5
MTUtPmdlbS5jb250ZXh0cy5sb2NrKTsKIAogCXJldHVybiAwOwogfQpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZHJ2LmMKaW5kZXggNTMyM2U0ZmE1NWQ5Li4wMjRkYTU4MmJhMGYgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kcnYuYwpAQCAtMTY2NSwxMCArMTY2NSw4IEBAIHN0YXRpYyB2b2lkIGk5MTVfZHJpdmVyX3Bv
c3RjbG9zZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpCiB7
CiAJc3RydWN0IGRybV9pOTE1X2ZpbGVfcHJpdmF0ZSAqZmlsZV9wcml2ID0gZmlsZS0+ZHJpdmVy
X3ByaXY7CiAKLQltdXRleF9sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CiAJaTkxNV9nZW1fY29u
dGV4dF9jbG9zZShmaWxlKTsKIAlpOTE1X2dlbV9yZWxlYXNlKGRldiwgZmlsZSk7Ci0JbXV0ZXhf
dW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CiAKIAlrZnJlZV9yY3UoZmlsZV9wcml2LCByY3Up
OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAppbmRleCA2YmRjZmZiZjFiOWIuLjM1YjYxMGQ1MjM3
OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAorKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCkBAIC0xNTM2LDEzICsxNTM2LDYgQEAgc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgewogCWludCBhdWRpb19wb3dlcl9yZWZjb3VudDsKIAl1MzIgYXVk
aW9fZnJlcV9jbnRybDsKIAotCXN0cnVjdCB7Ci0JCXN0cnVjdCBtdXRleCBtdXRleDsKLQkJc3Ry
dWN0IGxpc3RfaGVhZCBsaXN0OwotCQlzdHJ1Y3QgbGxpc3RfaGVhZCBmcmVlX2xpc3Q7Ci0JCXN0
cnVjdCB3b3JrX3N0cnVjdCBmcmVlX3dvcms7Ci0JfSBjb250ZXh0czsKLQogCXUzMiBmZGlfcnhf
Y29uZmlnOwogCiAJLyogU2hhZG93IGZvciBESVNQTEFZX1BIWV9DT05UUk9MIHdoaWNoIGNhbid0
IGJlIHNhZmVseSByZWFkICovCkBAIC0xNjk4LDYgKzE2OTEsMTQgQEAgc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgewogCiAJc3RydWN0IHsKIAkJc3RydWN0IG5vdGlmaWVyX2Jsb2NrIHBtX25vdGlm
aWVyOworCisJCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0cyB7CisJCQlzcGlubG9ja190IGxvY2s7
IC8qIGxvY2tzIGxpc3QgKi8KKwkJCXN0cnVjdCBsaXN0X2hlYWQgbGlzdDsKKworCQkJc3RydWN0
IGxsaXN0X2hlYWQgZnJlZV9saXN0OworCQkJc3RydWN0IHdvcmtfc3RydWN0IGZyZWVfd29yazsK
KwkJfSBjb250ZXh0czsKIAl9IGdlbTsKIAogCS8qIEZvciBpOTQ1Z20gdmJsYW5rIGlycSB2cy4g
QzMgd29ya2Fyb3VuZCAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
ZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKaW5kZXggNWE2NjRiZGVhZDhj
Li5mNmRiNDE1OTg1ZDUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2Vt
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwpAQCAtMTI2Niw3ICsxMjY2
LDcgQEAgaW50IGk5MTVfZ2VtX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KQogCQlnb3RvIGVycl91bmxvY2s7CiAJfQogCi0JcmV0ID0gaTkxNV9nZW1fY29udGV4dHNfaW5p
dChkZXZfcHJpdik7CisJcmV0ID0gaTkxNV9nZW1faW5pdF9jb250ZXh0cyhkZXZfcHJpdik7CiAJ
aWYgKHJldCkgewogCQlHRU1fQlVHX09OKHJldCA9PSAtRUlPKTsKIAkJZ290byBlcnJfc2NyYXRj
aDsKQEAgLTEzNDgsNyArMTM0OCw3IEBAIGludCBpOTE1X2dlbV9pbml0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKIAl9CiBlcnJfY29udGV4dDoKIAlpZiAocmV0ICE9IC1FSU8p
Ci0JCWk5MTVfZ2VtX2NvbnRleHRzX2ZpbmkoZGV2X3ByaXYpOworCQlpOTE1X2dlbV9kcml2ZXJf
cmVsZWFzZV9fY29udGV4dHMoZGV2X3ByaXYpOwogZXJyX3NjcmF0Y2g6CiAJaW50ZWxfZ3RfZHJp
dmVyX3JlbGVhc2UoJmRldl9wcml2LT5ndCk7CiBlcnJfdW5sb2NrOgpAQCAtMTQxNiwxMSArMTQx
Niw5IEBAIHZvaWQgaTkxNV9nZW1fZHJpdmVyX3JlbW92ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCiAKIHZvaWQgaTkxNV9nZW1fZHJpdmVyX3JlbGVhc2Uoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQogewotCW11dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3Ry
dWN0X211dGV4KTsKIAlpbnRlbF9lbmdpbmVzX2NsZWFudXAoZGV2X3ByaXYpOwotCWk5MTVfZ2Vt
X2NvbnRleHRzX2ZpbmkoZGV2X3ByaXYpOworCWk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNlX19jb250
ZXh0cyhkZXZfcHJpdik7CiAJaW50ZWxfZ3RfZHJpdmVyX3JlbGVhc2UoJmRldl9wcml2LT5ndCk7
Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlpbnRlbF93
YV9saXN0X2ZyZWUoJmRldl9wcml2LT5ndF93YV9saXN0KTsKIApAQCAtMTQzMCw3ICsxNDI4LDcg
QEAgdm9pZCBpOTE1X2dlbV9kcml2ZXJfcmVsZWFzZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCiAKIAlpOTE1X2dlbV9kcmFpbl9mcmVlZF9vYmplY3RzKGRldl9wcml2KTsKIAot
CVdBUk5fT04oIWxpc3RfZW1wdHkoJmRldl9wcml2LT5jb250ZXh0cy5saXN0KSk7CisJV0FSTl9P
TighbGlzdF9lbXB0eSgmZGV2X3ByaXYtPmdlbS5jb250ZXh0cy5saXN0KSk7CiB9CiAKIHZvaWQg
aTkxNV9nZW1faW5pdF9tbWlvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbV9ndHQuYwppbmRleCAxZDI2NjM0Y2E1OTcuLjdiMTViYjg5MTk3MCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKQEAgLTEzNjYsNyArMTM2Niw5IEBAIHN0
YXRpYyBpbnQgZ2VuOF9pbml0X3NjcmF0Y2goc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0p
CiAJaWYgKHZtLT5oYXNfcmVhZF9vbmx5ICYmCiAJICAgIHZtLT5pOTE1LT5rZXJuZWxfY29udGV4
dCAmJgogCSAgICB2bS0+aTkxNS0+a2VybmVsX2NvbnRleHQtPnZtKSB7Ci0JCXN0cnVjdCBpOTE1
X2FkZHJlc3Nfc3BhY2UgKmNsb25lID0gdm0tPmk5MTUtPmtlcm5lbF9jb250ZXh0LT52bTsKKwkJ
c3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqY2xvbmUgPQorCQkJcmN1X2RlcmVmZXJlbmNlX3By
b3RlY3RlZCh2bS0+aTkxNS0+a2VybmVsX2NvbnRleHQtPnZtLAorCQkJCQkJICB0cnVlKTsgLyog
c3RhdGljICovCiAKIAkJR0VNX0JVR19PTighY2xvbmUtPmhhc19yZWFkX29ubHkpOwogCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfcGVyZi5jCmluZGV4IGVjZmJjMzdiNzM4Yi4uMjMxMzg4ZDA2YzgyIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3BlcmYuYwpAQCAtMTg1Myw4ICsxODUzLDggQEAgc3RhdGljIGludCBn
ZW44X2NvbmZpZ3VyZV9hbGxfY29udGV4dHMoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVh
bSwKIAl9OwogI3VuZGVmIGN0eF9mbGV4ZXVOCiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lOwotCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7Ci0JaW50IGk7CisJc3RydWN0IGk5
MTVfZ2VtX2NvbnRleHQgKmN0eCwgKmNuOworCWludCBpLCBlcnI7CiAKIAlmb3IgKGkgPSAyOyBp
IDwgQVJSQVlfU0laRShyZWdzKTsgaSsrKQogCQlyZWdzW2ldLnZhbHVlID0gb2FfY29uZmlnX2Zs
ZXhfcmVnKG9hX2NvbmZpZywgcmVnc1tpXS5yZWcpOwpAQCAtMTg3NywxNiArMTg3NywyNyBAQCBz
dGF0aWMgaW50IGdlbjhfY29uZmlndXJlX2FsbF9jb250ZXh0cyhzdHJ1Y3QgaTkxNV9wZXJmX3N0
cmVhbSAqc3RyZWFtLAogCSAqIGNvbnRleHQuIENvbnRleHRzIGlkbGUgYXQgdGhlIHRpbWUgb2Yg
cmVjb25maWd1cmF0aW9uIGFyZSBub3QKIAkgKiB0cmFwcGVkIGJlaGluZCB0aGUgYmFycmllci4K
IAkgKi8KLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KGN0eCwgJmk5MTUtPmNvbnRleHRzLmxpc3QsIGxp
bmspIHsKLQkJaW50IGVycjsKLQorCXNwaW5fbG9jaygmaTkxNS0+Z2VtLmNvbnRleHRzLmxvY2sp
OworCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShjdHgsIGNuLCAmaTkxNS0+Z2VtLmNvbnRleHRz
Lmxpc3QsIGxpbmspIHsKIAkJaWYgKGN0eCA9PSBpOTE1LT5rZXJuZWxfY29udGV4dCkKIAkJCWNv
bnRpbnVlOwogCisJCWlmICgha3JlZl9nZXRfdW5sZXNzX3plcm8oJmN0eC0+cmVmKSkKKwkJCWNv
bnRpbnVlOworCisJCXNwaW5fdW5sb2NrKCZpOTE1LT5nZW0uY29udGV4dHMubG9jayk7CisKIAkJ
ZXJyID0gZ2VuOF9jb25maWd1cmVfY29udGV4dChjdHgsIHJlZ3MsIEFSUkFZX1NJWkUocmVncykp
OwotCQlpZiAoZXJyKQorCQlpZiAoZXJyKSB7CisJCQlpOTE1X2dlbV9jb250ZXh0X3B1dChjdHgp
OwogCQkJcmV0dXJuIGVycjsKKwkJfQorCisJCXNwaW5fbG9jaygmaTkxNS0+Z2VtLmNvbnRleHRz
LmxvY2spOworCQlsaXN0X3NhZmVfcmVzZXRfbmV4dChjdHgsIGNuLCBsaW5rKTsKKwkJaTkxNV9n
ZW1fY29udGV4dF9wdXQoY3R4KTsKIAl9CisJc3Bpbl91bmxvY2soJmk5MTUtPmdlbS5jb250ZXh0
cy5sb2NrKTsKIAogCS8qCiAJICogQWZ0ZXIgdXBkYXRpbmcgYWxsIG90aGVyIGNvbnRleHRzLCB3
ZSBuZWVkIHRvIG1vZGlmeSBvdXJzZWx2ZXMuCkBAIC0xODk1LDcgKzE5MDYsNiBAQCBzdGF0aWMg
aW50IGdlbjhfY29uZmlndXJlX2FsbF9jb250ZXh0cyhzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAq
c3RyZWFtLAogCSAqLwogCWZvcl9lYWNoX3VhYmlfZW5naW5lKGVuZ2luZSwgaTkxNSkgewogCQlz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UgPSBlbmdpbmUtPmtlcm5lbF9jb250ZXh0OwotCQlpbnQg
ZXJyOwogCiAJCWlmIChlbmdpbmUtPmNsYXNzICE9IFJFTkRFUl9DTEFTUykKIAkJCWNvbnRpbnVl
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zeXNmcy5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9zeXNmcy5jCmluZGV4IDFlMDhjNTk2MTUzNS4uYmYwMzliOGJh
NTkzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N5c2ZzLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zeXNmcy5jCkBAIC0xNzYsMTYgKzE3NiwxMiBAQCBp
OTE1X2wzX3JlYWQoc3RydWN0IGZpbGUgKmZpbHAsIHN0cnVjdCBrb2JqZWN0ICprb2JqLAogCWNv
dW50ID0gbWluX3Qoc2l6ZV90LCBHRU43X0wzTE9HX1NJWkUgLSBvZmZzZXQsIGNvdW50KTsKIAlt
ZW1zZXQoYnVmLCAwLCBjb3VudCk7CiAKLQlyZXQgPSBpOTE1X211dGV4X2xvY2tfaW50ZXJydXB0
aWJsZSgmaTkxNS0+ZHJtKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCisJc3Bpbl9sb2Nr
KCZpOTE1LT5nZW0uY29udGV4dHMubG9jayk7CiAJaWYgKGk5MTUtPmwzX3Bhcml0eS5yZW1hcF9p
bmZvW3NsaWNlXSkKIAkJbWVtY3B5KGJ1ZiwKIAkJICAgICAgIGk5MTUtPmwzX3Bhcml0eS5yZW1h
cF9pbmZvW3NsaWNlXSArIG9mZnNldCAvIHNpemVvZih1MzIpLAogCQkgICAgICAgY291bnQpOwot
Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlzcGluX3VubG9jaygm
aTkxNS0+Z2VtLmNvbnRleHRzLmxvY2spOwogCiAJcmV0dXJuIGNvdW50OwogfQpAQCAtMTk4LDgg
KzE5NCw4IEBAIGk5MTVfbDNfd3JpdGUoc3RydWN0IGZpbGUgKmZpbHAsIHN0cnVjdCBrb2JqZWN0
ICprb2JqLAogCXN0cnVjdCBkZXZpY2UgKmtkZXYgPSBrb2JqX3RvX2Rldihrb2JqKTsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGtkZXZfbWlub3JfdG9faTkxNShrZGV2KTsKIAlp
bnQgc2xpY2UgPSAoaW50KSh1aW50cHRyX3QpYXR0ci0+cHJpdmF0ZTsKKwl1MzIgKnJlbWFwX2lu
Zm8sICpmcmVlbWUgPSBOVUxMOwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7Ci0JdTMy
ICoqcmVtYXBfaW5mbzsKIAlpbnQgcmV0OwogCiAJcmV0ID0gbDNfYWNjZXNzX3ZhbGlkKGk5MTUs
IG9mZnNldCk7CkBAIC0yMDksMzcgKzIwNSwzNiBAQCBpOTE1X2wzX3dyaXRlKHN0cnVjdCBmaWxl
ICpmaWxwLCBzdHJ1Y3Qga29iamVjdCAqa29iaiwKIAlpZiAoY291bnQgPCBzaXplb2YodTMyKSkK
IAkJcmV0dXJuIC1FSU5WQUw7CiAKLQlyZXQgPSBpOTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJs
ZSgmaTkxNS0+ZHJtKTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OworCXJlbWFwX2luZm8gPSBr
emFsbG9jKEdFTjdfTDNMT0dfU0laRSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFyZW1hcF9pbmZvKQor
CQlyZXR1cm4gLUVOT01FTTsKIAotCXJlbWFwX2luZm8gPSAmaTkxNS0+bDNfcGFyaXR5LnJlbWFw
X2luZm9bc2xpY2VdOwotCWlmICghKnJlbWFwX2luZm8pIHsKLQkJKnJlbWFwX2luZm8gPSBremFs
bG9jKEdFTjdfTDNMT0dfU0laRSwgR0ZQX0tFUk5FTCk7Ci0JCWlmICghKnJlbWFwX2luZm8pIHsK
LQkJCXJldCA9IC1FTk9NRU07Ci0JCQlnb3RvIG91dDsKLQkJfQorCXNwaW5fbG9jaygmaTkxNS0+
Z2VtLmNvbnRleHRzLmxvY2spOworCisJaWYgKGk5MTUtPmwzX3Bhcml0eS5yZW1hcF9pbmZvW3Ns
aWNlXSkgeworCQlmcmVlbWUgPSByZW1hcF9pbmZvOworCQlyZW1hcF9pbmZvID0gaTkxNS0+bDNf
cGFyaXR5LnJlbWFwX2luZm9bc2xpY2VdOworCX0gZWxzZSB7CisJCWk5MTUtPmwzX3Bhcml0eS5y
ZW1hcF9pbmZvW3NsaWNlXSA9IHJlbWFwX2luZm87CiAJfQogCiAJY291bnQgPSByb3VuZF9kb3du
KGNvdW50LCBzaXplb2YodTMyKSk7Ci0JbWVtY3B5KCpyZW1hcF9pbmZvICsgb2Zmc2V0IC8gc2l6
ZW9mKHUzMiksIGJ1ZiwgY291bnQpOworCW1lbWNweShyZW1hcF9pbmZvICsgb2Zmc2V0IC8gc2l6
ZW9mKHUzMiksIGJ1ZiwgY291bnQpOwogCiAJLyogTkI6IFdlIGRlZmVyIHRoZSByZW1hcHBpbmcg
dW50aWwgd2Ugc3dpdGNoIHRvIHRoZSBjb250ZXh0ICovCi0JbGlzdF9mb3JfZWFjaF9lbnRyeShj
dHgsICZpOTE1LT5jb250ZXh0cy5saXN0LCBsaW5rKQorCWxpc3RfZm9yX2VhY2hfZW50cnkoY3R4
LCAmaTkxNS0+Z2VtLmNvbnRleHRzLmxpc3QsIGxpbmspCiAJCWN0eC0+cmVtYXBfc2xpY2UgfD0g
QklUKHNsaWNlKTsKIAorCXNwaW5fdW5sb2NrKCZpOTE1LT5nZW0uY29udGV4dHMubG9jayk7CisJ
a2ZyZWUoZnJlZW1lKTsKKwogCS8qCiAJICogVE9ETzogSWRlYWxseSB3ZSByZWFsbHkgd2FudCBh
IEdQVSByZXNldCBoZXJlIHRvIG1ha2Ugc3VyZSBlcnJvcnMKIAkgKiBhcmVuJ3QgcHJvcGFnYXRl
ZC4gU2luY2UgSSBjYW5ub3QgZmluZCBhIHN0YWJsZSB3YXkgdG8gcmVzZXQgdGhlIEdQVQogCSAq
IGF0IHRoaXMgcG9pbnQgaXQgaXMgbGVmdCBhcyBhIFRPRE8uCiAJKi8KIAotCXJldCA9IGNvdW50
Owotb3V0OgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQlyZXR1
cm4gcmV0OworCXJldHVybiBjb3VudDsKIH0KIAogc3RhdGljIGNvbnN0IHN0cnVjdCBiaW5fYXR0
cmlidXRlIGRwZl9hdHRycyA9IHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfdHJhY2UuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdHJhY2UuaAppbmRleCAxZjJj
ZjZjZmFmYjUuLjdlZjdhMWUxNjY0YyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV90cmFjZS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdHJhY2UuaApAQCAt
OTUyLDcgKzk1Miw3IEBAIERFQ0xBUkVfRVZFTlRfQ0xBU1MoaTkxNV9jb250ZXh0LAogCVRQX2Zh
c3RfYXNzaWduKAogCQkJX19lbnRyeS0+ZGV2ID0gY3R4LT5pOTE1LT5kcm0ucHJpbWFyeS0+aW5k
ZXg7CiAJCQlfX2VudHJ5LT5jdHggPSBjdHg7Ci0JCQlfX2VudHJ5LT52bSA9IGN0eC0+dm07CisJ
CQlfX2VudHJ5LT52bSA9IHJjdV9hY2Nlc3NfcG9pbnRlcihjdHgtPnZtKTsKIAkpLAogCiAJVFBf
cHJpbnRrKCJkZXY9JXUsIGN0eD0lcCwgY3R4X3ZtPSVwIiwKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2k5MTVfZ2VtLmMKaW5kZXggMDM0NmMzZTViNmI2Li5iZmE0MGE1YjZkOTggMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbS5jCkBAIC0xMzgsMTEgKzEz
OCw5IEBAIHN0YXRpYyBpbnQgaWd0X2dlbV9zdXNwZW5kKHZvaWQgKmFyZykKIAkJcmV0dXJuIFBU
Ul9FUlIoZmlsZSk7CiAKIAllcnIgPSAtRU5PTUVNOwotCW11dGV4X2xvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCWN0eCA9IGxpdmVfY29udGV4dChpOTE1LCBmaWxlKTsKIAlpZiAoIUlT
X0VSUihjdHgpKQogCQllcnIgPSBzd2l0Y2hfdG9fY29udGV4dChpOTE1LCBjdHgpOwotCW11dGV4
X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKGVycikKIAkJZ290byBvdXQ7
CiAKQEAgLTE1Nyw5ICsxNTUsNyBAQCBzdGF0aWMgaW50IGlndF9nZW1fc3VzcGVuZCh2b2lkICph
cmcpCiAKIAlwbV9yZXN1bWUoaTkxNSk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKIAllcnIgPSBzd2l0Y2hfdG9fY29udGV4dChpOTE1LCBjdHgpOwotCW11dGV4X3Vu
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiBvdXQ6CiAJbW9ja19maWxlX2ZyZWUoaTkx
NSwgZmlsZSk7CiAJcmV0dXJuIGVycjsKQEAgLTE3NywxMSArMTczLDkgQEAgc3RhdGljIGludCBp
Z3RfZ2VtX2hpYmVybmF0ZSh2b2lkICphcmcpCiAJCXJldHVybiBQVFJfRVJSKGZpbGUpOwogCiAJ
ZXJyID0gLUVOT01FTTsKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlj
dHggPSBsaXZlX2NvbnRleHQoaTkxNSwgZmlsZSk7CiAJaWYgKCFJU19FUlIoY3R4KSkKIAkJZXJy
ID0gc3dpdGNoX3RvX2NvbnRleHQoaTkxNSwgY3R4KTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChlcnIpCiAJCWdvdG8gb3V0OwogCkBAIC0xOTYsOSArMTkw
LDcgQEAgc3RhdGljIGludCBpZ3RfZ2VtX2hpYmVybmF0ZSh2b2lkICphcmcpCiAKIAlwbV9yZXN1
bWUoaTkxNSk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAllcnIg
PSBzd2l0Y2hfdG9fY29udGV4dChpOTE1LCBjdHgpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CiBvdXQ6CiAJbW9ja19maWxlX2ZyZWUoaTkxNSwgZmlsZSk7CiAJcmV0
dXJuIGVycjsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1
X2dlbV9ldmljdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2V2
aWN0LmMKaW5kZXggZjM5ZjAyODJlNzhjLi4wYWY5YTU4ZDAxMWQgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5jCkBAIC00NzMsNyArNDczLDYg
QEAgc3RhdGljIGludCBpZ3RfZXZpY3RfY29udGV4dHModm9pZCAqYXJnKQogCQl9CiAKIAkJY291
bnQgPSAwOwotCQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJb25zdGFj
a19mZW5jZV9pbml0KCZmZW5jZSk7CiAJCWRvIHsKIAkJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
OwpAQCAtNTEwLDggKzUwOSw2IEBAIHN0YXRpYyBpbnQgaWd0X2V2aWN0X2NvbnRleHRzKHZvaWQg
KmFyZykKIAkJCWNvdW50Kys7CiAJCQllcnIgPSAwOwogCQl9IHdoaWxlKDEpOwotCQltdXRleF91
bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJCW9uc3RhY2tfZmVuY2VfZmluaSgm
ZmVuY2UpOwogCQlwcl9pbmZvKCJTdWJtaXR0ZWQgJWx1IGNvbnRleHRzL3JlcXVlc3RzIG9uICVz
XG4iLAogCQkJY291bnQsIGVuZ2luZS0+bmFtZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMKaW5kZXggZTQwZTZjZmE1MWYxLi44ZDgxMjFjMDIxNjEg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ndHQu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMKQEAg
LTEyNDYsNiArMTI0Niw3IEBAIHN0YXRpYyBpbnQgZXhlcmNpc2VfbW9jayhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgIHVuc2lnbmVkIGxvbmcgZW5kX3RpbWUpKQogewog
CWNvbnN0IHU2NCBsaW1pdCA9IHRvdGFscmFtX3BhZ2VzKCkgPDwgUEFHRV9TSElGVDsKKwlzdHJ1
Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bTsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4
OwogCUlHVF9USU1FT1VUKGVuZF90aW1lKTsKIAlpbnQgZXJyOwpAQCAtMTI1NCw3ICsxMjU1LDkg
QEAgc3RhdGljIGludCBleGVyY2lzZV9tb2NrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LAogCWlmICghY3R4KQogCQlyZXR1cm4gLUVOT01FTTsKIAotCWVyciA9IGZ1bmMoaTkxNSwgY3R4
LT52bSwgMCwgbWluKGN0eC0+dm0tPnRvdGFsLCBsaW1pdCksIGVuZF90aW1lKTsKKwl2bSA9IGk5
MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOworCWVyciA9IGZ1bmMoaTkxNSwgdm0sIDAs
IG1pbih2bS0+dG90YWwsIGxpbWl0KSwgZW5kX3RpbWUpOworCWk5MTVfdm1fcHV0KHZtKTsKIAog
CW1vY2tfY29udGV4dF9jbG9zZShjdHgpOwogCXJldHVybiBlcnI7CkBAIC0xODAxLDE1ICsxODA0
LDE1IEBAIHN0YXRpYyBpbnQgaWd0X2NzX3RsYih2b2lkICphcmcpCiAJCWdvdG8gb3V0X3VubG9j
azsKIAl9CiAKLQl2bSA9IGN0eC0+dm07Ci0JaWYgKCF2bSkKLQkJZ290byBvdXRfdW5sb2NrOwor
CXZtID0gaTkxNV9nZW1fY29udGV4dF9nZXRfdm1fcmN1KGN0eCk7CisJaWYgKGk5MTVfaXNfZ2d0
dCh2bSkpCisJCWdvdG8gb3V0X3ZtOwogCiAJLyogQ3JlYXRlIHR3byBwYWdlczsgZHVtbXkgd2Ug
cHJlZmlsbCB0aGUgVExCLCBhbmQgaW50ZW5kZWQgKi8KIAliYmUgPSBpOTE1X2dlbV9vYmplY3Rf
Y3JlYXRlX2ludGVybmFsKGk5MTUsIFBBR0VfU0laRSk7CiAJaWYgKElTX0VSUihiYmUpKSB7CiAJ
CWVyciA9IFBUUl9FUlIoYmJlKTsKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3RvIG91dF92bTsK
IAl9CiAKIAliYXRjaCA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKGJiZSwgSTkxNV9NQVBfV0Mp
OwpAQCAtMjAxNCw2ICsyMDE3LDggQEAgc3RhdGljIGludCBpZ3RfY3NfdGxiKHZvaWQgKmFyZykK
IAlpOTE1X2dlbV9vYmplY3RfcHV0KGFjdCk7CiBvdXRfcHV0X2JiZToKIAlpOTE1X2dlbV9vYmpl
Y3RfcHV0KGJiZSk7CitvdXRfdm06CisJaTkxNV92bV9wdXQodm0pOwogb3V0X3VubG9jazoKIAlt
dXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCW1vY2tfZmlsZV9mcmVlKGk5
MTUsIGZpbGUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5
MTVfcmVxdWVzdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcmVxdWVz
dC5jCmluZGV4IGQ3ZDY4YzZhNmJkNS4uMDg5N2E3YjA0OTQ0IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcmVxdWVzdC5jCkBAIC0xODEsOSArMTgxLDcgQEAgc3Rh
dGljIGludCBpZ3RfcmVxdWVzdF9yZXdpbmQodm9pZCAqYXJnKQogCXN0cnVjdCBpbnRlbF9jb250
ZXh0ICpjZTsKIAlpbnQgZXJyID0gLUVJTlZBTDsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCWN0eFswXSA9IG1vY2tfY29udGV4dChpOTE1LCAiQSIpOwotCW11dGV4
X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAljZSA9IGk5MTVfZ2VtX2NvbnRl
eHRfZ2V0X2VuZ2luZShjdHhbMF0sIFJDUzApOwogCUdFTV9CVUdfT04oSVNfRVJSKGNlKSk7CkBA
IC0xOTcsOSArMTk1LDcgQEAgc3RhdGljIGludCBpZ3RfcmVxdWVzdF9yZXdpbmQodm9pZCAqYXJn
KQogCWk5MTVfcmVxdWVzdF9nZXQocmVxdWVzdCk7CiAJaTkxNV9yZXF1ZXN0X2FkZChyZXF1ZXN0
KTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWN0eFsxXSA9IG1v
Y2tfY29udGV4dChpOTE1LCAiQiIpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAKIAljZSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X2VuZ2luZShjdHhbMV0sIFJDUzAp
OwogCUdFTV9CVUdfT04oSVNfRVJSKGNlKSk7CkBAIC00MzgsOSArNDM0LDcgQEAgc3RhdGljIGlu
dCBtb2NrX2JyZWFkY3J1bWJzX3Ntb2tldGVzdCh2b2lkICphcmcpCiAJfQogCiAJZm9yIChuID0g
MDsgbiA8IHQubmNvbnRleHRzOyBuKyspIHsKLQkJbXV0ZXhfbG9jaygmdC5lbmdpbmUtPmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQl0LmNvbnRleHRzW25dID0gbW9ja19jb250ZXh0KHQuZW5n
aW5lLT5pOTE1LCAibW9jayIpOwotCQltdXRleF91bmxvY2soJnQuZW5naW5lLT5pOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIAkJaWYgKCF0LmNvbnRleHRzW25dKSB7CiAJCQlyZXQgPSAtRU5PTUVN
OwogCQkJZ290byBvdXRfY29udGV4dHM7CkBAIC03MzQsOSArNzI4LDkgQEAgc3RhdGljIGludCBs
aXZlX2VtcHR5X3JlcXVlc3Qodm9pZCAqYXJnKQogc3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqcmVj
dXJzaXZlX2JhdGNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0cnVjdCBp
OTE1X2dlbV9jb250ZXh0ICpjdHggPSBpOTE1LT5rZXJuZWxfY29udGV4dDsKLQlzdHJ1Y3QgaTkx
NV9hZGRyZXNzX3NwYWNlICp2bSA9IGN0eC0+dm0gPzogJmk5MTUtPmdndHQudm07CiAJc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKIAljb25zdCBpbnQgZ2VuID0gSU5URUxfR0VOKGk5
MTUpOworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwogCXN0cnVjdCBpOTE1X3ZtYSAq
dm1hOwogCXUzMiAqY21kOwogCWludCBlcnI7CkBAIC03NDUsNyArNzM5LDkgQEAgc3RhdGljIHN0
cnVjdCBpOTE1X3ZtYSAqcmVjdXJzaXZlX2JhdGNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQogCWlmIChJU19FUlIob2JqKSkKIAkJcmV0dXJuIEVSUl9DQVNUKG9iaik7CiAKKwl2bSA9
IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOwogCXZtYSA9IGk5MTVfdm1hX2luc3Rh
bmNlKG9iaiwgdm0sIE5VTEwpOworCWk5MTVfdm1fcHV0KHZtKTsKIAlpZiAoSVNfRVJSKHZtYSkp
IHsKIAkJZXJyID0gUFRSX0VSUih2bWEpOwogCQlnb3RvIGVycjsKQEAgLTEyMjAsOSArMTIxNiw3
IEBAIHN0YXRpYyBpbnQgbGl2ZV9icmVhZGNydW1ic19zbW9rZXRlc3Qodm9pZCAqYXJnKQogCX0K
IAogCWZvciAobiA9IDA7IG4gPCB0WzBdLm5jb250ZXh0czsgbisrKSB7Ci0JCW11dGV4X2xvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQl0WzBdLmNvbnRleHRzW25dID0gbGl2ZV9jb250
ZXh0KGk5MTUsIGZpbGUpOwotCQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwogCQlpZiAoIXRbMF0uY29udGV4dHNbbl0pIHsKIAkJCXJldCA9IC1FTk9NRU07CiAJCQlnb3Rv
IG91dF9jb250ZXh0czsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pOTE1X3ZtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfdm1hLmMK
aW5kZXggYWMxZmY1NThlYjkwLi41OGI1ZjQwYTA3ZGQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5jCkBAIC0yNCw2ICsyNCw3IEBACiAKICNpbmNsdWRlIDxsaW51
eC9wcmltZV9udW1iZXJzLmg+CiAKKyNpbmNsdWRlICJnZW0vaTkxNV9nZW1fY29udGV4dC5oIgog
I2luY2x1ZGUgImdlbS9zZWxmdGVzdHMvbW9ja19jb250ZXh0LmgiCiAKICNpbmNsdWRlICJpOTE1
X3NjYXR0ZXJsaXN0LmgiCkBAIC0zOCw3ICszOSw3IEBAIHN0YXRpYyBib29sIGFzc2VydF92bWEo
c3RydWN0IGk5MTVfdm1hICp2bWEsCiB7CiAJYm9vbCBvayA9IHRydWU7CiAKLQlpZiAodm1hLT52
bSAhPSBjdHgtPnZtKSB7CisJaWYgKHZtYS0+dm0gIT0gcmN1X2FjY2Vzc19wb2ludGVyKGN0eC0+
dm0pKSB7CiAJCXByX2VycigiVk1BIGNyZWF0ZWQgd2l0aCB3cm9uZyBWTVxuIik7CiAJCW9rID0g
ZmFsc2U7CiAJfQpAQCAtMTEzLDExICsxMTQsMTMgQEAgc3RhdGljIGludCBjcmVhdGVfdm1hcyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KG9iaiwg
b2JqZWN0cywgc3RfbGluaykgewogCQlmb3IgKHBpbm5lZCA9IDA7IHBpbm5lZCA8PSAxOyBwaW5u
ZWQrKykgewogCQkJbGlzdF9mb3JfZWFjaF9lbnRyeShjdHgsIGNvbnRleHRzLCBsaW5rKSB7Ci0J
CQkJc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSBjdHgtPnZtOworCQkJCXN0cnVjdCBp
OTE1X2FkZHJlc3Nfc3BhY2UgKnZtOwogCQkJCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCQkJCWlu
dCBlcnI7CiAKKwkJCQl2bSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X3ZtX3JjdShjdHgpOwogCQkJ
CXZtYSA9IGNoZWNrZWRfdm1hX2luc3RhbmNlKG9iaiwgdm0sIE5VTEwpOworCQkJCWk5MTVfdm1f
cHV0KHZtKTsKIAkJCQlpZiAoSVNfRVJSKHZtYSkpCiAJCQkJCXJldHVybiBQVFJfRVJSKHZtYSk7
CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9k
ZXZpY2UuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2Uu
YwppbmRleCA0ZTZjZGUwZDQ4NTkuLjMzNWYzN2JhOThkZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYwpAQCAtNTksMTEgKzU5LDkgQEAg
c3RhdGljIHZvaWQgbW9ja19kZXZpY2VfcmVsZWFzZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQog
CiAJaTkxNV9nZW1fZHJhaW5fd29ya3F1ZXVlKGk5MTUpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpCiAJ
CW1vY2tfZW5naW5lX2ZyZWUoZW5naW5lKTsKLQlpOTE1X2dlbV9jb250ZXh0c19maW5pKGk5MTUp
OwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJaTkxNV9nZW1fZHJp
dmVyX3JlbGVhc2VfX2NvbnRleHRzKGk5MTUpOwogCiAJaW50ZWxfdGltZWxpbmVzX2ZpbmkoaTkx
NSk7CiAKQEAgLTIwNiw3ICsyMDQsNyBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqbW9ja19n
ZW1fZGV2aWNlKHZvaWQpCiAJcmV0dXJuIGk5MTU7CiAKIGVycl9jb250ZXh0OgotCWk5MTVfZ2Vt
X2NvbnRleHRzX2ZpbmkoaTkxNSk7CisJaTkxNV9nZW1fZHJpdmVyX3JlbGVhc2VfX2NvbnRleHRz
KGk5MTUpOwogZXJyX2VuZ2luZToKIAltb2NrX2VuZ2luZV9mcmVlKGk5MTUtPmVuZ2luZVtSQ1Mw
XSk7CiBlcnJfdW5sb2NrOgotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0
cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9s
aXN0aW5mby9pbnRlbC1nZng=

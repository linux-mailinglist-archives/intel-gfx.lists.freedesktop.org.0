Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 4230F45562
	for <lists+intel-gfx@lfdr.de>; Fri, 14 Jun 2019 09:11:11 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BA54F89394;
	Fri, 14 Jun 2019 07:10:58 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6F5E48934F
 for <intel-gfx@lists.freedesktop.org>; Fri, 14 Jun 2019 07:10:43 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16897545-1500050 
 for multiple; Fri, 14 Jun 2019 08:10:42 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 14 Jun 2019 08:10:18 +0100
Message-Id: <20190614071023.17929-35-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190614071023.17929-1-chris@chris-wilson.co.uk>
References: <20190614071023.17929-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 34/39] drm/i915: Use vm->mutex for serialising
 GTT insertion
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U2VyaWFsaXNpbmcgaW5zZXJ0aW9uIGludG8gZWFjaCBvZiB0aGUgZ2xvYmFsIEdUVCBhbmQgcHBH
VFQgYWNjb3VudHMgZm9yCmEgbGFyZ2UgY2h1bmsgb2YgdGhlIGN1cnJlbnQgc3RydWN0X211dGV4
IHNlcmlhbGlzYXRpb24gcmVxdWlyZWVtbnRzLgooTm90ZSB0aGF0IGl0IGlzIG5vdCBqdXN0IHRo
ZSBkcm1fbW0gLyBndHQgbWFuYWdlbWVudCBpdHNlbGYgYmVpbmcKc2VyaWFsaXNlZCwgYnV0IHRo
ZSBwaW4gY291bnQgYW5kIHZhcmlvdXMgZmxhZ3MuKSBQcmV2aW91c2x5LCB0aGUgbWFpbgpibG9j
a2VyIGZvciByZXBsYWNpbmcgdGhpcyBtdXRleCB3YXMgdGhlIHJlc2V0IGhhbmRpbmcsIGJ1dCB3
aXRoIHRoZQphZHZlbnQgb2YgImxvY2tsZXNzIiByZXNldHMsIHdlIGNhbiBmcmVlbHkgdGFrZSB0
aGUgdm0tPm11dGV4IGFuZCBibG9jawp3YWl0aW5nIGZvciB0aGUgR1BVICh3aXRob3V0IGZlYXIg
b2YgZGVhZGxvY2sgaWYgdGhlIEdQVSBoYW5ncykuIFdlIGFsc28KcHJvc2NyaWJlIGFsbG9jYXRp
b25zIHVuZGVybmVhdGggdm0tPm11dGV4LCBhbGxvd2luZyB1cyB0byB0YWtlIHRoZQptdXRleCBp
bnNpZGUgdGhlIHNocmlua2VyLCBhdm9pZGluZyB0aGUgcmVjdXJzaXZlIHN0cnVjdF9tdXRleCB3
ZQpwcmV2aW91c2x5IHVzZWQuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNo
cmlzLXdpbHNvbi5jby51az4KLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGll
bnRfYmx0LmMgICAgfCAgIDcgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9j
b250ZXh0LmMgICB8ICAgNSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2Rv
bWFpbi5jICAgIHwgIDMzICsrKy0tLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhl
Y2J1ZmZlci5jICAgIHwgICA1ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
bW1hbi5jICAgICAgfCAgMjcgKystLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9vYmplY3QuaCAgICB8ICAgMyArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2Jq
ZWN0X3R5cGVzLmggIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
c2hyaW5rZXIuYyAgfCAgOTMgKy0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fdGlsaW5nLmMgICAgfCAgNjAgKysrKystLS0tLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYyAgIHwgIDI4ICstLS0tCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMgICAgICAgfCAgIDUgKy0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYyAgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Z0L2FwZXJ0dXJlX2dtLmMgICAgICAgIHwgIDEyICstCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2RlYnVnZnMuYyAgICAgICAgICAgfCAgMTAgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtLmMgICAgICAgICAgICAgICB8IDEwNiArKysrKysrKysrLS0tLS0tLS0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2V2aWN0LmMgICAgICAgICB8ICAyOCArLS0tLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZmVuY2VfcmVnLmMgICAgIHwgICAyICstCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYyAgICAgICAgICAgfCAgNzYgKy0tLS0t
LS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmggICAgICAgICAgIHwg
ICAzIC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jICAgICAgICAgICAgICB8ICAy
MCArLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jICAgICAgICAgICAgICAgfCAg
ODMgKysrKysrKystLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmggICAgICAg
ICAgICAgICB8ICA2MSArKystLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kaXNw
bGF5LmMgICAgICAgICAgfCAgNDIgKy0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
ZmJkZXYuYyAgICAgICAgICAgIHwgICA4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9n
dWMuYyAgICAgICAgICAgICAgfCAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfb3Zl
cmxheS5jICAgICAgICAgIHwgIDE4ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3Rz
L2k5MTVfdm1hLmMgICAgIHwgICAyICsKIDI3IGZpbGVzIGNoYW5nZWQsIDIzOSBpbnNlcnRpb25z
KCspLCA1MDUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX2NsaWVudF9ibHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9jbGllbnRfYmx0LmMKaW5kZXggMjJhMjYyZGZkMDdiLi43YzZmZDMxMDI3NmUgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsaWVudF9ibHQuYwpAQCAtMTUy
LDcgKzE1Miw2IEBAIHN0YXRpYyB2b2lkIGNsZWFyX3BhZ2VzX2RtYV9mZW5jZV9jYihzdHJ1Y3Qg
ZG1hX2ZlbmNlICpmZW5jZSwKIHN0YXRpYyB2b2lkIGNsZWFyX3BhZ2VzX3dvcmtlcihzdHJ1Y3Qg
d29ya19zdHJ1Y3QgKndvcmspCiB7CiAJc3RydWN0IGNsZWFyX3BhZ2VzX3dvcmsgKncgPSBjb250
YWluZXJfb2Yod29yaywgdHlwZW9mKCp3KSwgd29yayk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSB3LT5jZS0+Z2VtX2NvbnRleHQtPmk5MTU7CiAJc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaiA9IHctPnNsZWV2ZS0+dm1hLT5vYmo7CiAJc3RydWN0IGk5MTVfdm1hICp2
bWEgPSB3LT5zbGVldmUtPnZtYTsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKQEAgLTE2OCwx
MSArMTY3LDkgQEAgc3RhdGljIHZvaWQgY2xlYXJfcGFnZXNfd29ya2VyKHN0cnVjdCB3b3JrX3N0
cnVjdCAqd29yaykKIAkJb2JqLT5jYWNoZV9kaXJ0eSA9IGZhbHNlOwogCX0KIAotCS8qIFhYWDog
d2UgbmVlZCB0byBraWxsIHRoaXMgKi8KLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKIAllcnIgPSBpOTE1X3ZtYV9waW4odm1hLCAwLCAwLCBQSU5fVVNFUik7CiAJaWYgKHVu
bGlrZWx5KGVycikpCi0JCWdvdG8gb3V0X3VubG9jazsKKwkJZ290byBvdXRfc2lnbmFsOwogCiAJ
cnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKHctPmNlKTsKIAlpZiAoSVNfRVJSKHJxKSkgewpAQCAt
MjA4LDggKzIwNSw2IEBAIHN0YXRpYyB2b2lkIGNsZWFyX3BhZ2VzX3dvcmtlcihzdHJ1Y3Qgd29y
a19zdHJ1Y3QgKndvcmspCiAJaTkxNV9yZXF1ZXN0X2FkZChycSk7CiBvdXRfdW5waW46CiAJaTkx
NV92bWFfdW5waW4odm1hKTsKLW91dF91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIG91dF9zaWduYWw6CiAJaWYgKHVubGlrZWx5KGVycikpIHsKIAkJZG1h
X2ZlbmNlX3NldF9lcnJvcigmdy0+ZG1hLCBlcnIpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXggMjRhNzE0ODUzZjg1Li5kYTZiZjI3Njk3ZTQgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwpAQCAtOTksNiAr
OTksNyBAQCBzdGF0aWMgdm9pZCBsdXRfY2xvc2Uoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0
eCkKIAl2b2lkIF9fcmN1ICoqc2xvdDsKIAogCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmN0eC0+bXV0
ZXgpOworCW11dGV4X2xvY2soJmN0eC0+dm0tPm11dGV4KTsKIAogCXJjdV9yZWFkX2xvY2soKTsK
IAlyYWRpeF90cmVlX2Zvcl9lYWNoX3Nsb3Qoc2xvdCwgJmN0eC0+aGFuZGxlc192bWEsICZpdGVy
LCAwKSB7CkBAIC0xMjksMTMgKzEzMCwxNSBAQCBzdGF0aWMgdm9pZCBsdXRfY2xvc2Uoc3RydWN0
IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIAkJCXJhZGl4X3RyZWVfaXRlcl9kZWxldGUoJmN0eC0+
aGFuZGxlc192bWEsICZpdGVyLCBzbG90KTsKIAkJCUdFTV9CVUdfT04oIWF0b21pY19yZWFkKCZ2
bWEtPm9wZW5fY291bnQpKTsKIAkJCWlmIChhdG9taWNfZGVjX2FuZF90ZXN0KCZ2bWEtPm9wZW5f
Y291bnQpKQotCQkJCWk5MTVfdm1hX2Nsb3NlKHZtYSk7CisJCQkJaTkxNV92bWFfdW5iaW5kKHZt
YSk7CiAJCQlpOTE1X3ZtYV9wdXQodm1hKTsKIAkJfQogCiAJCWk5MTVfZ2VtX29iamVjdF9wdXQo
b2JqKTsKIAl9CiAJcmN1X3JlYWRfdW5sb2NrKCk7CisKKwltdXRleF91bmxvY2soJmN0eC0+dm0t
Pm11dGV4KTsKIH0KIAogc3RhdGljIHN0cnVjdCBpbnRlbF9jb250ZXh0ICoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYwppbmRleCBhNjJmN2YwZTI5NDcuLmY5MDQ0
YmJkZDQyOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2Rv
bWFpbi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYwpA
QCAtMjYsNyArMjYsNyBAQCBzdGF0aWMgdm9pZCBfX2k5MTVfZ2VtX29iamVjdF9mbHVzaF9mb3Jf
ZGlzcGxheShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCiB2b2lkIGk5MTVfZ2Vt
X29iamVjdF9mbHVzaF9pZl9kaXNwbGF5KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmop
CiB7Ci0JaWYgKCFSRUFEX09OQ0Uob2JqLT5waW5fZ2xvYmFsKSkKKwlpZiAoIWF0b21pY19yZWFk
KCZvYmotPnBpbl9nbG9iYWwpKQogCQlyZXR1cm47CiAKIAlpOTE1X2dlbV9vYmplY3RfbG9jayhv
YmopOwpAQCAtMzc3LDE2ICszNzcsMTEgQEAgaW50IGk5MTVfZ2VtX3NldF9jYWNoaW5nX2lvY3Rs
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJaWYgKHJldCkKIAkJZ290byBv
dXQ7CiAKLQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwotCWlmIChyZXQpCi0JCWdvdG8gb3V0OwotCiAJcmV0ID0gaTkxNV9nZW1fb2JqZWN0
X2xvY2tfaW50ZXJydXB0aWJsZShvYmopOwogCWlmIChyZXQgPT0gMCkgewogCQlyZXQgPSBpOTE1
X2dlbV9vYmplY3Rfc2V0X2NhY2hlX2xldmVsKG9iaiwgbGV2ZWwpOwogCQlpOTE1X2dlbV9vYmpl
Y3RfdW5sb2NrKG9iaik7CiAJfQotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAKIG91dDoKIAlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CkBAIC00MTMsNyArNDA4LDcg
QEAgaTkxNV9nZW1fb2JqZWN0X3Bpbl90b19kaXNwbGF5X3BsYW5lKHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmosCiAJLyogTWFyayB0aGUgZ2xvYmFsIHBpbiBlYXJseSBzbyB0aGF0IHdl
IGFjY291bnQgZm9yIHRoZQogCSAqIGRpc3BsYXkgY29oZXJlbmN5IHdoaWxzdCBzZXR0aW5nIHVw
IHRoZSBjYWNoZSBkb21haW5zLgogCSAqLwotCW9iai0+cGluX2dsb2JhbCsrOworCWF0b21pY19p
bmMoJm9iai0+cGluX2dsb2JhbCk7CiAKIAkvKiBUaGUgZGlzcGxheSBlbmdpbmUgaXMgbm90IGNv
aGVyZW50IHdpdGggdGhlIExMQyBjYWNoZSBvbiBnZW42LiAgQXMKIAkgKiBhIHJlc3VsdCwgd2Ug
bWFrZSBzdXJlIHRoYXQgdGhlIHBpbm5pbmcgdGhhdCBpcyBhYm91dCB0byBvY2N1ciBpcwpAQCAt
NDYzLDI1ICs0NTgsMjcgQEAgaTkxNV9nZW1fb2JqZWN0X3Bpbl90b19kaXNwbGF5X3BsYW5lKHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJcmV0dXJuIHZtYTsKIAogZXJyX3VucGlu
X2dsb2JhbDoKLQlvYmotPnBpbl9nbG9iYWwtLTsKKwlhdG9taWNfZGVjKCZvYmotPnBpbl9nbG9i
YWwpOwogCXJldHVybiB2bWE7CiB9CiAKIHN0YXRpYyB2b2lkIGk5MTVfZ2VtX29iamVjdF9idW1w
X2luYWN0aXZlX2dndHQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7Ci0Jc3Ry
dWN0IGk5MTVfdm1hICp2bWE7CiAKIAlHRU1fQlVHX09OKCFpOTE1X2dlbV9vYmplY3RfaGFzX3Bp
bm5lZF9wYWdlcyhvYmopKTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmdndHQudm0ubXV0ZXgpOwot
CWZvcl9lYWNoX2dndHRfdm1hKHZtYSwgb2JqKSB7Ci0JCWlmICghZHJtX21tX25vZGVfYWxsb2Nh
dGVkKCZ2bWEtPm5vZGUpKQotCQkJY29udGludWU7CisJaWYgKG11dGV4X3RyeWxvY2soJmk5MTUt
PmdndHQudm0ubXV0ZXgpKSB7CisJCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCi0JCWxpc3RfbW92
ZV90YWlsKCZ2bWEtPnZtX2xpbmssICZ2bWEtPnZtLT5ib3VuZF9saXN0KTsKKwkJZm9yX2VhY2hf
Z2d0dF92bWEodm1hLCBvYmopIHsKKwkJCWlmICghZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEt
Pm5vZGUpKQorCQkJCWNvbnRpbnVlOworCisJCQlsaXN0X21vdmVfdGFpbCgmdm1hLT52bV9saW5r
LCAmdm1hLT52bS0+Ym91bmRfbGlzdCk7CisJCX0KKwkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5nZ3R0
LnZtLm11dGV4KTsKIAl9Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIAog
CWlmIChpOTE1X2dlbV9vYmplY3RfaXNfc2hyaW5rYWJsZShvYmopKSB7CiAJCXVuc2lnbmVkIGxv
bmcgZmxhZ3M7CkBAIC01MDAsMTIgKzQ5NywxMCBAQCBpOTE1X2dlbV9vYmplY3RfdW5waW5fZnJv
bV9kaXNwbGF5X3BsYW5lKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewogCXN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmogPSB2bWEtPm9iajsKIAotCWFzc2VydF9vYmplY3RfaGVsZChvYmop
OwotCi0JaWYgKFdBUk5fT04ob2JqLT5waW5fZ2xvYmFsID09IDApKQorCWlmIChHRU1fV0FSTl9P
TighYXRvbWljX3JlYWQoJm9iai0+cGluX2dsb2JhbCkpKQogCQlyZXR1cm47CiAKLQlpZiAoLS1v
YmotPnBpbl9nbG9iYWwgPT0gMCkKKwlpZiAoYXRvbWljX2RlY19hbmRfdGVzdCgmb2JqLT5waW5f
Z2xvYmFsKSkKIAkJdm1hLT5kaXNwbGF5X2FsaWdubWVudCA9IEk5MTVfR1RUX01JTl9BTElHTk1F
TlQ7CiAKIAkvKiBCdW1wIHRoZSBMUlUgdG8gdHJ5IGFuZCBhdm9pZCBwcmVtYXR1cmUgZXZpY3Rp
b24gd2hpbHN0IGZsaXBwaW5nICAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9leGVjYnVmZmVyLmMKaW5kZXggZjEyZGMwZjUyMWM5Li40NGJjYjY4MWMxNjggMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYwpAQCAtNTQ3
LDggKzU0NywxMSBAQCBlYl9hZGRfdm1hKHN0cnVjdCBpOTE1X2V4ZWNidWZmZXIgKmViLAogCQll
Yl91bnJlc2VydmVfdm1hKHZtYSwgdm1hLT5leGVjX2ZsYWdzKTsKIAogCQlsaXN0X2FkZF90YWls
KCZ2bWEtPmV4ZWNfbGluaywgJmViLT51bmJvdW5kKTsKLQkJaWYgKGRybV9tbV9ub2RlX2FsbG9j
YXRlZCgmdm1hLT5ub2RlKSkKKwkJaWYgKGRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5ub2Rl
KSkgeworCQkJbXV0ZXhfbG9jaygmdm1hLT52bS0+bXV0ZXgpOwogCQkJZXJyID0gaTkxNV92bWFf
dW5iaW5kKHZtYSk7CisJCQltdXRleF91bmxvY2soJnZtYS0+dm0tPm11dGV4KTsKKwkJfQogCQlp
ZiAodW5saWtlbHkoZXJyKSkKIAkJCXZtYS0+ZXhlY19mbGFncyA9IE5VTEw7CiAJfQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMKaW5kZXggNDljZjlhZDk3YmZjLi45ZmEw
NTY5YWZiNTAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9t
bWFuLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYwpAQCAt
MjQ4LDE2ICsyNDgsNiBAQCB2bV9mYXVsdF90IGk5MTVfZ2VtX2ZhdWx0KHN0cnVjdCB2bV9mYXVs
dCAqdm1mKQogCQlnb3RvIGVycl9ycG07CiAJfQogCi0JcmV0ID0gaTkxNV9tdXRleF9sb2NrX2lu
dGVycnVwdGlibGUoZGV2KTsKLQlpZiAocmV0KQotCQlnb3RvIGVycl9yZXNldDsKLQotCS8qIEFj
Y2VzcyB0byBzbm9vcGFibGUgcGFnZXMgdGhyb3VnaCB0aGUgR1RUIGlzIGluY29oZXJlbnQuICov
Ci0JaWYgKG9iai0+Y2FjaGVfbGV2ZWwgIT0gSTkxNV9DQUNIRV9OT05FICYmICFIQVNfTExDKGk5
MTUpKSB7Ci0JCXJldCA9IC1FRkFVTFQ7Ci0JCWdvdG8gZXJyX3VubG9jazsKLQl9Ci0KIAkvKiBO
b3cgcGluIGl0IGludG8gdGhlIEdUVCBhcyBuZWVkZWQgKi8KIAl2bWEgPSBpOTE1X2dlbV9vYmpl
Y3RfZ2d0dF9waW4ob2JqLCBOVUxMLCAwLCAwLAogCQkJCSAgICAgICBQSU5fTUFQUEFCTEUgfApA
QCAtMjg3LDEzICsyNzcsMTkgQEAgdm1fZmF1bHRfdCBpOTE1X2dlbV9mYXVsdChzdHJ1Y3Qgdm1f
ZmF1bHQgKnZtZikKIAl9CiAJaWYgKElTX0VSUih2bWEpKSB7CiAJCXJldCA9IFBUUl9FUlIodm1h
KTsKLQkJZ290byBlcnJfdW5sb2NrOworCQlnb3RvIGVycl9yZXNldDsKIAl9CiAKLQlyZXQgPSBp
OTE1X3ZtYV9waW5fZmVuY2Uodm1hKTsKKwlhc3NlcnRfcnBtX3dha2Vsb2NrX2hlbGQoaTkxNSk7
CisKKwlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJnZtYS0+dm0tPm11dGV4KTsKIAlp
ZiAocmV0KQogCQlnb3RvIGVycl91bnBpbjsKIAorCXJldCA9IF9faTkxNV92bWFfcGluX2ZlbmNl
KHZtYSk7CisJaWYgKHJldCkKKwkJZ290byBlcnJfdW5sb2NrOworCiAJLyogRmluYWxseSwgcmVt
YXAgaXQgdXNpbmcgdGhlIG5ldyBHVFQgb2Zmc2V0ICovCiAJcmV0ID0gcmVtYXBfaW9fbWFwcGlu
ZyhhcmVhLAogCQkJICAgICAgIGFyZWEtPnZtX3N0YXJ0ICsgKHZtYS0+Z2d0dF92aWV3LnBhcnRp
YWwub2Zmc2V0IDw8IFBBR0VfU0hJRlQpLApAQCAtMzA0LDcgKzMwMCw2IEBAIHZtX2ZhdWx0X3Qg
aTkxNV9nZW1fZmF1bHQoc3RydWN0IHZtX2ZhdWx0ICp2bWYpCiAJCWdvdG8gZXJyX2ZlbmNlOwog
CiAJLyogTWFyayBhcyBiZWluZyBtbWFwcGVkIGludG8gdXNlcnNwYWNlIGZvciBsYXRlciByZXZv
Y2F0aW9uICovCi0JYXNzZXJ0X3JwbV93YWtlbG9ja19oZWxkKGk5MTUpOwogCWlmICghaTkxNV92
bWFfc2V0X3VzZXJmYXVsdCh2bWEpICYmICFvYmotPnVzZXJmYXVsdF9jb3VudCsrKQogCQlsaXN0
X2FkZCgmb2JqLT51c2VyZmF1bHRfbGluaywgJmk5MTUtPmdndHQudXNlcmZhdWx0X2xpc3QpOwog
CWlmIChDT05GSUdfRFJNX0k5MTVfVVNFUkZBVUxUX0FVVE9TVVNQRU5EKQpAQCAtMzE2LDEwICsz
MTEsMTAgQEAgdm1fZmF1bHRfdCBpOTE1X2dlbV9mYXVsdChzdHJ1Y3Qgdm1fZmF1bHQgKnZtZikK
IAogZXJyX2ZlbmNlOgogCWk5MTVfdm1hX3VucGluX2ZlbmNlKHZtYSk7CitlcnJfdW5sb2NrOgor
CW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOwogZXJyX3VucGluOgogCV9faTkxNV92bWFf
dW5waW4odm1hKTsKLWVycl91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRl
eCk7CiBlcnJfcmVzZXQ6CiAJaTkxNV9yZXNldF91bmxvY2soaTkxNSwgc3JjdSk7CiBlcnJfcnBt
OgpAQCAtNDA1LDcgKzQwMCw3IEBAIHZvaWQgaTkxNV9nZW1fb2JqZWN0X3JlbGVhc2VfbW1hcChz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCSAqIHJlcXVpcmVtZW50IHRoYXQgb3Bl
cmF0aW9ucyB0byB0aGUgR0dUVCBiZSBtYWRlIGhvbGRpbmcgdGhlIFJQTQogCSAqIHdha2VyZWYu
CiAJICovCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJ
bG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+Z2d0dC52bS5tdXRleCk7CiAJd2FrZXJlZiA9IGlu
dGVsX3J1bnRpbWVfcG1fZ2V0KGk5MTUpOwogCiAJaWYgKCFvYmotPnVzZXJmYXVsdF9jb3VudCkK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaCBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaAppbmRleCA3ZWE4MDEz
ZDEwOGYuLjBmYzU0OTI0YjMzYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX29iamVjdC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9vYmplY3QuaApAQCAtNDAzLDcgKzQwMyw4IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBjcHVfd3Jp
dGVfbmVlZHNfY2xmbHVzaChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCWlmICgh
KG9iai0+Y2FjaGVfY29oZXJlbnQgJiBJOTE1X0JPX0NBQ0hFX0NPSEVSRU5UX0ZPUl9XUklURSkp
CiAJCXJldHVybiB0cnVlOwogCi0JcmV0dXJuIG9iai0+cGluX2dsb2JhbDsgLyogY3VycmVudGx5
IGluIHVzZSBieSBIVywga2VlcCBmbHVzaGVkICovCisJLyogQ3VycmVudGx5IGluIHVzZSBieSBI
Vz8gS2VlcCBmbHVzaGVkLiAqLworCXJldHVybiBhdG9taWNfcmVhZCgmb2JqLT5waW5fZ2xvYmFs
KTsKIH0KIAogc3RhdGljIGlubGluZSB2b2lkIF9fc3RhcnRfY3B1X3dyaXRlKHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmopCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fb2JqZWN0X3R5cGVzLmgKaW5kZXggOGY2MWQ3YTkzMDc4Li5mNzkyOTUzYjhhNzEgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMu
aAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmgK
QEAgLTE1OSw3ICsxNTksNyBAQCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCB7CiAJLyoqIENv
dW50IG9mIFZNQSBhY3R1YWxseSBib3VuZCBieSB0aGlzIG9iamVjdCAqLwogCWF0b21pY190IGJp
bmRfY291bnQ7CiAJLyoqIENvdW50IG9mIGhvdyBtYW55IGdsb2JhbCBWTUEgYXJlIGN1cnJlbnRs
eSBwaW5uZWQgZm9yIHVzZSBieSBIVyAqLwotCXVuc2lnbmVkIGludCBwaW5fZ2xvYmFsOworCWF0
b21pY190IHBpbl9nbG9iYWw7CiAKIAlzdHJ1Y3QgewogCQlzdHJ1Y3QgbXV0ZXggbG9jazsgLyog
cHJvdGVjdHMgdGhlIHBhZ2VzIGFuZCB0aGVpciB1c2UgKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMKaW5kZXggNzQ0NWU2ZjY2MmFjLi5mODMzZTFiZDdj
MmYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtl
ci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jCkBA
IC0xNiw0MCArMTYsNiBAQAogCiAjaW5jbHVkZSAiaTkxNV90cmFjZS5oIgogCi1zdGF0aWMgYm9v
bCBzaHJpbmtlcl9sb2NrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAotCQkJICB1bnNp
Z25lZCBpbnQgZmxhZ3MsCi0JCQkgIGJvb2wgKnVubG9jaykKLXsKLQlzdHJ1Y3QgbXV0ZXggKm0g
PSAmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleDsKLQotCXN3aXRjaCAobXV0ZXhfdHJ5bG9ja19yZWN1
cnNpdmUobSkpIHsKLQljYXNlIE1VVEVYX1RSWUxPQ0tfUkVDVVJTSVZFOgotCQkqdW5sb2NrID0g
ZmFsc2U7Ci0JCXJldHVybiB0cnVlOwotCi0JY2FzZSBNVVRFWF9UUllMT0NLX0ZBSUxFRDoKLQkJ
KnVubG9jayA9IGZhbHNlOwotCQlpZiAoZmxhZ3MgJiBJOTE1X1NIUklOS19BQ1RJVkUgJiYKLQkJ
ICAgIG11dGV4X2xvY2tfa2lsbGFibGVfbmVzdGVkKG0sIEk5MTVfTU1fU0hSSU5LRVIpID09IDAp
Ci0JCQkqdW5sb2NrID0gdHJ1ZTsKLQkJcmV0dXJuICp1bmxvY2s7Ci0KLQljYXNlIE1VVEVYX1RS
WUxPQ0tfU1VDQ0VTUzoKLQkJKnVubG9jayA9IHRydWU7Ci0JCXJldHVybiB0cnVlOwotCX0KLQot
CUJVRygpOwotfQotCi1zdGF0aWMgdm9pZCBzaHJpbmtlcl91bmxvY2soc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsIGJvb2wgdW5sb2NrKQotewotCWlmICghdW5sb2NrKQotCQlyZXR1cm47
Ci0KLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotfQotCiBzdGF0aWMg
Ym9vbCBzd2FwX2F2YWlsYWJsZSh2b2lkKQogewogCXJldHVybiBnZXRfbnJfc3dhcF9wYWdlcygp
ID4gMDsKQEAgLTc4LDcgKzQ0LDcgQEAgc3RhdGljIGJvb2wgY2FuX3JlbGVhc2VfcGFnZXMoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAkgKiBUbyBzaW1wbGlmeSB0aGUgc2Nhbiwg
YW5kIHRvIGF2b2lkIHdhbGtpbmcgdGhlIGxpc3Qgb2Ygdm1hIHVuZGVyIHRoZQogCSAqIG9iamVj
dCwgd2UganVzdCBjaGVjayB0aGUgY291bnQgb2YgaXRzIHBlcm1hbmVudGx5IHBpbm5lZC4KIAkg
Ki8KLQlpZiAoUkVBRF9PTkNFKG9iai0+cGluX2dsb2JhbCkpCisJaWYgKGF0b21pY19yZWFkKCZv
YmotPnBpbl9nbG9iYWwpKQogCQlyZXR1cm4gZmFsc2U7CiAKIAkvKiBXZSBjYW4gb25seSByZXR1
cm4gcGh5c2ljYWwgcGFnZXMgdG8gdGhlIHN5c3RlbSBpZiB3ZSBjYW4gZWl0aGVyCkBAIC0xNTQs
MTAgKzEyMCw2IEBAIGk5MTVfZ2VtX3NocmluayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZiA9IDA7CiAJdW5zaWduZWQgbG9uZyBjb3VudCA9
IDA7CiAJdW5zaWduZWQgbG9uZyBzY2FubmVkID0gMDsKLQlib29sIHVubG9jazsKLQotCWlmICgh
c2hyaW5rZXJfbG9jayhpOTE1LCBzaHJpbmssICZ1bmxvY2spKQotCQlyZXR1cm4gMDsKIAogCS8q
CiAJICogV2hlbiBzaHJpbmtpbmcgdGhlIGFjdGl2ZSBsaXN0LCBhbHNvIGNvbnNpZGVyIGFjdGl2
ZSBjb250ZXh0cy4KQEAgLTE3NCw3ICsxMzYsNiBAQCBpOTE1X2dlbV9zaHJpbmsoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJICAgICAgIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsK
IAogCXRyYWNlX2k5MTVfZ2VtX3NocmluayhpOTE1LCB0YXJnZXQsIHNocmluayk7Ci0JaTkxNV9y
ZXRpcmVfcmVxdWVzdHMoaTkxNSk7CiAKIAkvKgogCSAqIFVuYmluZGluZyBvZiBvYmplY3RzIHdp
bGwgcmVxdWlyZSBIVyBhY2Nlc3M7IExldCB1cyBub3Qgd2FrZSB0aGUKQEAgLTIxNiwxMyArMTc3
LDYgQEAgaTkxNV9nZW1fc2hyaW5rKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCiAJ
CUlOSVRfTElTVF9IRUFEKCZzdGlsbF9pbl9saXN0KTsKIAotCQkvKgotCQkgKiBXZSBzZXJpYWxp
emUgb3VyIGFjY2VzcyB0byB1bnJlZmVyZW5jZWQgb2JqZWN0cyB0aHJvdWdoCi0JCSAqIHRoZSB1
c2Ugb2YgdGhlIHN0cnVjdF9tdXRleC4gV2hpbGUgdGhlIG9iamVjdHMgYXJlIG5vdAotCQkgKiB5
ZXQgZnJlZWQgKGR1ZSB0byBSQ1UgdGhlbiBhIHdvcmtxdWV1ZSkgd2Ugc3RpbGwgd2FudAotCQkg
KiB0byBiZSBhYmxlIHRvIHNocmluayB0aGVpciBwYWdlcywgc28gdGhleSByZW1haW4gb24KLQkJ
ICogdGhlIHVuYm91bmQvYm91bmQgbGlzdCB1bnRpbCBhY3R1YWxseSBmcmVlZC4KLQkJICovCiAJ
CXNwaW5fbG9ja19pcnFzYXZlKCZpOTE1LT5tbS5vYmpfbG9jaywgZmxhZ3MpOwogCQl3aGlsZSAo
Y291bnQgPCB0YXJnZXQgJiYKIAkJICAgICAgIChvYmogPSBsaXN0X2ZpcnN0X2VudHJ5X29yX251
bGwocGhhc2UtPmxpc3QsCkBAIC0yNzAsMTAgKzIyNCw2IEBAIGk5MTVfZ2VtX3NocmluayhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlpZiAoc2hyaW5rICYgSTkxNV9TSFJJTktfQk9V
TkQpCiAJCWludGVsX3J1bnRpbWVfcG1fcHV0KGk5MTUsIHdha2VyZWYpOwogCi0JaTkxNV9yZXRp
cmVfcmVxdWVzdHMoaTkxNSk7Ci0KLQlzaHJpbmtlcl91bmxvY2soaTkxNSwgdW5sb2NrKTsKLQog
CWlmIChucl9zY2FubmVkKQogCQkqbnJfc2Nhbm5lZCArPSBzY2FubmVkOwogCXJldHVybiBjb3Vu
dDsKQEAgLTM0MywxMyArMjkzLDkgQEAgaTkxNV9nZW1fc2hyaW5rZXJfc2NhbihzdHJ1Y3Qgc2hy
aW5rZXIgKnNocmlua2VyLCBzdHJ1Y3Qgc2hyaW5rX2NvbnRyb2wgKnNjKQogCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0KIAkJY29udGFpbmVyX29mKHNocmlua2VyLCBzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSwgbW0uc2hyaW5rZXIpOwogCXVuc2lnbmVkIGxvbmcgZnJlZWQ7Ci0JYm9v
bCB1bmxvY2s7CiAKIAlzYy0+bnJfc2Nhbm5lZCA9IDA7CiAKLQlpZiAoIXNocmlua2VyX2xvY2so
aTkxNSwgMCwgJnVubG9jaykpCi0JCXJldHVybiBTSFJJTktfU1RPUDsKLQogCWZyZWVkID0gaTkx
NV9nZW1fc2hyaW5rKGk5MTUsCiAJCQkJc2MtPm5yX3RvX3NjYW4sCiAJCQkJJnNjLT5ucl9zY2Fu
bmVkLApAQCAtMzcwLDggKzMxNiw2IEBAIGk5MTVfZ2VtX3Nocmlua2VyX3NjYW4oc3RydWN0IHNo
cmlua2VyICpzaHJpbmtlciwgc3RydWN0IHNocmlua19jb250cm9sICpzYykKIAkJfQogCX0KIAot
CXNocmlua2VyX3VubG9jayhpOTE1LCB1bmxvY2spOwotCiAJcmV0dXJuIHNjLT5ucl9zY2FubmVk
ID8gZnJlZWQgOiBTSFJJTktfU1RPUDsKIH0KIApAQCAtNDIzLDE2ICszNjcsMTIgQEAgaTkxNV9n
ZW1fc2hyaW5rZXJfdm1hcChzdHJ1Y3Qgbm90aWZpZXJfYmxvY2sgKm5iLCB1bnNpZ25lZCBsb25n
IGV2ZW50LCB2b2lkICpwdHIKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgKm5leHQ7CiAJdW5zaWdu
ZWQgbG9uZyBmcmVlZF9wYWdlcyA9IDA7CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7Ci0JYm9v
bCB1bmxvY2s7Ci0KLQlpZiAoIXNocmlua2VyX2xvY2soaTkxNSwgMCwgJnVubG9jaykpCi0JCXJl
dHVybiBOT1RJRllfRE9ORTsKIAogCS8qIEZvcmNlIGV2ZXJ5dGhpbmcgb250byB0aGUgaW5hY3Rp
dmUgbGlzdHMgKi8KIAlpZiAoaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShpOTE1LAogCQkJCSAgIEk5
MTVfV0FJVF9MT0NLRUQsCiAJCQkJICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpKQotCQlnb3RvIG91
dDsKKwkJcmV0dXJuIE5PVElGWV9ET05FOwogCiAJd2l0aF9pbnRlbF9ydW50aW1lX3BtKGk5MTUs
IHdha2VyZWYpCiAJCWZyZWVkX3BhZ2VzICs9IGk5MTVfZ2VtX3NocmluayhpOTE1LCAtMVVMLCBO
VUxMLApAQCAtNDQ5LDE2ICszODksMTEgQEAgaTkxNV9nZW1fc2hyaW5rZXJfdm1hcChzdHJ1Y3Qg
bm90aWZpZXJfYmxvY2sgKm5iLCB1bnNpZ25lZCBsb25nIGV2ZW50LCB2b2lkICpwdHIKIAkJaWYg
KCF2bWEtPmlvbWFwIHx8IGk5MTVfdm1hX2lzX2FjdGl2ZSh2bWEpKQogCQkJY29udGludWU7CiAK
LQkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIAkJaWYgKGk5MTVfdm1hX3Vu
YmluZCh2bWEpID09IDApCiAJCQlmcmVlZF9wYWdlcyArPSBjb3VudDsKLQkJbXV0ZXhfbG9jaygm
aTkxNS0+Z2d0dC52bS5tdXRleCk7CiAJfQogCW11dGV4X3VubG9jaygmaTkxNS0+Z2d0dC52bS5t
dXRleCk7CiAKLW91dDoKLQlzaHJpbmtlcl91bmxvY2soaTkxNSwgdW5sb2NrKTsKLQogCSoodW5z
aWduZWQgbG9uZyAqKXB0ciArPSBmcmVlZF9wYWdlczsKIAlyZXR1cm4gTk9USUZZX0RPTkU7CiB9
CkBAIC01MDAsMzcgKzQzNSwxMyBAQCB2b2lkIGk5MTVfZ2VtX3Nocmlua2VyX3VucmVnaXN0ZXIo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB2b2lkIGk5MTVfZ2VtX3Nocmlua2VyX3Rh
aW50c19tdXRleChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgc3RydWN0
IG11dGV4ICptdXRleCkKIHsKLQlib29sIHVubG9jayA9IGZhbHNlOwotCiAJaWYgKCFJU19FTkFC
TEVEKENPTkZJR19MT0NLREVQKSkKIAkJcmV0dXJuOwogCi0JaWYgKCFsb2NrZGVwX2lzX2hlbGRf
dHlwZSgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCwgLTEpKSB7Ci0JCW11dGV4X2FjcXVpcmUoJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXguZGVwX21hcCwKLQkJCSAgICAgIEk5MTVfTU1fTk9STUFMLCAw
LCBfUkVUX0lQXyk7Ci0JCXVubG9jayA9IHRydWU7Ci0JfQotCiAJZnNfcmVjbGFpbV9hY3F1aXJl
KEdGUF9LRVJORUwpOwogCi0JLyoKLQkgKiBBcyB3ZSBpbnZhcmlhYmx5IHJlbHkgb24gdGhlIHN0
cnVjdF9tdXRleCB3aXRoaW4gdGhlIHNocmlua2VyLAotCSAqIGJ1dCBoYXZlIGEgY29tcGxpY2F0
ZWQgcmVjdXJzaW9uIGRhbmNlLCB0YWludCBhbGwgdGhlIG11dGV4ZXMgdXNlZAotCSAqIHdpdGhp
biB0aGUgc2hyaW5rZXIgd2l0aCB0aGUgc3RydWN0X211dGV4LiBGb3IgY29tcGxldGVuZXNzLCB3
ZQotCSAqIHRhaW50IHdpdGggYWxsIHN1YmNsYXNzIG9mIHN0cnVjdF9tdXRleCwgZXZlbiB0aG91
Z2ggd2Ugc2hvdWxkCi0JICogb25seSBuZWVkIHRhaW50aW5nIGJ5IEk5MTVfTU1fTk9STUFMIHRv
IGNhdGNoIHBvc3NpYmxlIEFCQkEKLQkgKiBkZWFkbG9ja3MgZnJvbSB1c2luZyBzdHJ1Y3RfbXV0
ZXggaW5zaWRlIEBtdXRleC4KLQkgKi8KLQltdXRleF9hY3F1aXJlKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4LmRlcF9tYXAsCi0JCSAgICAgIEk5MTVfTU1fU0hSSU5LRVIsIDAsIF9SRVRfSVBfKTsK
LQogCW11dGV4X2FjcXVpcmUoJm11dGV4LT5kZXBfbWFwLCAwLCAwLCBfUkVUX0lQXyk7CiAJbXV0
ZXhfcmVsZWFzZSgmbXV0ZXgtPmRlcF9tYXAsIDAsIF9SRVRfSVBfKTsKIAotCW11dGV4X3JlbGVh
c2UoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXguZGVwX21hcCwgMCwgX1JFVF9JUF8pOwotCiAJZnNf
cmVjbGFpbV9yZWxlYXNlKEdGUF9LRVJORUwpOwotCi0JaWYgKHVubG9jaykKLQkJbXV0ZXhfcmVs
ZWFzZSgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleC5kZXBfbWFwLCAwLCBfUkVUX0lQXyk7CiB9CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdGlsaW5nLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdGlsaW5nLmMKaW5kZXggY2EwYzJmNDUx
NzQyLi5mOTE5ZGJiMzZlZGIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV90aWxpbmcuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
dGlsaW5nLmMKQEAgLTIxMiwxNSArMjEyLDE4IEBAIGk5MTVfZ2VtX29iamVjdF9zZXRfdGlsaW5n
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAKIAlHRU1fQlVHX09OKCFpOTE1X3Rp
bGluZ19vayhvYmosIHRpbGluZywgc3RyaWRlKSk7CiAJR0VNX0JVR19PTighc3RyaWRlIF4gKHRp
bGluZyA9PSBJOTE1X1RJTElOR19OT05FKSk7Ci0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlpZiAoKHRpbGluZyB8IHN0cmlkZSkgPT0gb2JqLT50aWxp
bmdfYW5kX3N0cmlkZSkKIAkJcmV0dXJuIDA7CiAKLQlpZiAoaTkxNV9nZW1fb2JqZWN0X2lzX2Zy
YW1lYnVmZmVyKG9iaikpCisJaTkxNV9nZW1fb2JqZWN0X2xvY2sob2JqKTsKKwlpZiAoaTkxNV9n
ZW1fb2JqZWN0X2lzX2ZyYW1lYnVmZmVyKG9iaikpIHsKKwkJaTkxNV9nZW1fb2JqZWN0X3VubG9j
ayhvYmopOwogCQlyZXR1cm4gLUVCVVNZOworCX0KIAotCS8qIFdlIG5lZWQgdG8gcmViaW5kIHRo
ZSBvYmplY3QgaWYgaXRzIGN1cnJlbnQgYWxsb2NhdGlvbgorCS8qCisJICogV2UgbmVlZCB0byBy
ZWJpbmQgdGhlIG9iamVjdCBpZiBpdHMgY3VycmVudCBhbGxvY2F0aW9uCiAJICogbm8gbG9uZ2Vy
IG1lZXRzIHRoZSBhbGlnbm1lbnQgcmVzdHJpY3Rpb25zIGZvciBpdHMgbmV3CiAJICogdGlsaW5n
IG1vZGUuIE90aGVyd2lzZSB3ZSBjYW4ganVzdCBsZWF2ZSBpdCBhbG9uZSwgYnV0CiAJICogbmVl
ZCB0byBlbnN1cmUgdGhhdCBhbnkgZmVuY2UgcmVnaXN0ZXIgaXMgdXBkYXRlZCBiZWZvcmUKQEAg
LTIzMywxNyArMjM2LDM3IEBAIGk5MTVfZ2VtX29iamVjdF9zZXRfdGlsaW5nKHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJICogd2hpbHN0IGV4ZWN1dGluZyBhIGZlbmNlZCBjb21t
YW5kIGZvciBhbiB1bnRpbGVkIG9iamVjdC4KIAkgKi8KIAotCWVyciA9IGk5MTVfZ2VtX29iamVj
dF9mZW5jZV9wcmVwYXJlKG9iaiwgdGlsaW5nLCBzdHJpZGUpOwotCWlmIChlcnIpCisJZXJyID0g
bXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKKwlpZiAoZXJy
KSB7CisJCWk5MTVfZ2VtX29iamVjdF91bmxvY2sob2JqKTsKIAkJcmV0dXJuIGVycjsKKwl9CiAK
LQlpOTE1X2dlbV9vYmplY3RfbG9jayhvYmopOwotCWlmIChpOTE1X2dlbV9vYmplY3RfaXNfZnJh
bWVidWZmZXIob2JqKSkgeworCWVyciA9IGk5MTVfZ2VtX29iamVjdF9mZW5jZV9wcmVwYXJlKG9i
aiwgdGlsaW5nLCBzdHJpZGUpOworCWlmIChlcnIpIHsKKwkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5n
Z3R0LnZtLm11dGV4KTsKIAkJaTkxNV9nZW1fb2JqZWN0X3VubG9jayhvYmopOwotCQlyZXR1cm4g
LUVCVVNZOworCQlyZXR1cm4gZXJyOwogCX0KIAotCS8qIElmIHRoZSBtZW1vcnkgaGFzIHVua25v
d24gKGkuZS4gdmFyeWluZykgc3dpenpsaW5nLCB3ZSBwaW4gdGhlCisJZm9yX2VhY2hfZ2d0dF92
bWEodm1hLCBvYmopIHsKKwkJdm1hLT5mZW5jZV9zaXplID0KKwkJCWk5MTVfZ2VtX2ZlbmNlX3Np
emUoaTkxNSwgdm1hLT5zaXplLCB0aWxpbmcsIHN0cmlkZSk7CisJCXZtYS0+ZmVuY2VfYWxpZ25t
ZW50ID0KKwkJCWk5MTVfZ2VtX2ZlbmNlX2FsaWdubWVudChpOTE1LAorCQkJCQkJIHZtYS0+c2l6
ZSwgdGlsaW5nLCBzdHJpZGUpOworCisJCWlmICh2bWEtPmZlbmNlKQorCQkJdm1hLT5mZW5jZS0+
ZGlydHkgPSB0cnVlOworCX0KKworCS8qIEZvcmNlIHRoZSBmZW5jZSB0byBiZSByZWFjcXVpcmVk
IGZvciBHVFQgYWNjZXNzICovCisJaTkxNV9nZW1fb2JqZWN0X3JlbGVhc2VfbW1hcChvYmopOwor
CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKKworCS8qCisJICogSWYgdGhl
IG1lbW9yeSBoYXMgdW5rbm93biAoaS5lLiB2YXJ5aW5nKSBzd2l6emxpbmcsIHdlIHBpbiB0aGUK
IAkgKiBwYWdlcyB0byBwcmV2ZW50IHRoZW0gYmVpbmcgc3dhcHBlZCBvdXQgYW5kIGNhdXNpbmcg
Y29ycnVwdGlvbgogCSAqIGR1ZSB0byB0aGUgY2hhbmdlIGluIHN3aXp6bGluZy4KIAkgKi8KQEAg
LTI2NCwyMyArMjg3LDkgQEAgaTkxNV9nZW1fb2JqZWN0X3NldF90aWxpbmcoc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaiwKIAl9CiAJbXV0ZXhfdW5sb2NrKCZvYmotPm1tLmxvY2spOwog
Ci0JZm9yX2VhY2hfZ2d0dF92bWEodm1hLCBvYmopIHsKLQkJdm1hLT5mZW5jZV9zaXplID0KLQkJ
CWk5MTVfZ2VtX2ZlbmNlX3NpemUoaTkxNSwgdm1hLT5zaXplLCB0aWxpbmcsIHN0cmlkZSk7Ci0J
CXZtYS0+ZmVuY2VfYWxpZ25tZW50ID0KLQkJCWk5MTVfZ2VtX2ZlbmNlX2FsaWdubWVudChpOTE1
LAotCQkJCQkJIHZtYS0+c2l6ZSwgdGlsaW5nLCBzdHJpZGUpOwotCi0JCWlmICh2bWEtPmZlbmNl
KQotCQkJdm1hLT5mZW5jZS0+ZGlydHkgPSB0cnVlOwotCX0KLQogCW9iai0+dGlsaW5nX2FuZF9z
dHJpZGUgPSB0aWxpbmcgfCBzdHJpZGU7CiAJaTkxNV9nZW1fb2JqZWN0X3VubG9jayhvYmopOwog
Ci0JLyogRm9yY2UgdGhlIGZlbmNlIHRvIGJlIHJlYWNxdWlyZWQgZm9yIEdUVCBhY2Nlc3MgKi8K
LQlpOTE1X2dlbV9vYmplY3RfcmVsZWFzZV9tbWFwKG9iaik7Ci0KIAkvKiBUcnkgdG8gcHJlYWxs
b2NhdGUgbWVtb3J5IHJlcXVpcmVkIHRvIHNhdmUgc3dpenpsaW5nIG9uIHB1dC1wYWdlcyAqLwog
CWlmIChpOTE1X2dlbV9vYmplY3RfbmVlZHNfYml0MTdfc3dpenpsZShvYmopKSB7CiAJCWlmICgh
b2JqLT5iaXRfMTcpIHsKQEAgLTM2NCwxMiArMzczLDcgQEAgaTkxNV9nZW1fc2V0X3RpbGluZ19p
b2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCQl9CiAJfQogCi0JZXJy
ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZkZXYtPnN0cnVjdF9tdXRleCk7Ci0JaWYgKGVy
cikKLQkJZ290byBlcnI7Ci0KIAllcnIgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X3RpbGluZyhvYmos
IGFyZ3MtPnRpbGluZ19tb2RlLCBhcmdzLT5zdHJpZGUpOwotCW11dGV4X3VubG9jaygmZGV2LT5z
dHJ1Y3RfbXV0ZXgpOwogCiAJLyogV2UgaGF2ZSB0byBtYWludGFpbiB0aGlzIGV4aXN0aW5nIEFC
SS4uLiAqLwogCWFyZ3MtPnN0cmlkZSA9IGk5MTVfZ2VtX29iamVjdF9nZXRfc3RyaWRlKG9iaik7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3VzZXJwdHIuYwppbmRleCA1Mjhi
NjE2NzgzMzQuLmYwOTNkZWFlYjVjMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX3VzZXJwdHIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fdXNlcnB0ci5jCkBAIC05Myw3ICs5Myw2IEBAIHVzZXJwdHJfbW5faW52YWxpZGF0ZV9y
YW5nZV9zdGFydChzdHJ1Y3QgbW11X25vdGlmaWVyICpfbW4sCiAJc3RydWN0IGk5MTVfbW11X25v
dGlmaWVyICptbiA9CiAJCWNvbnRhaW5lcl9vZihfbW4sIHN0cnVjdCBpOTE1X21tdV9ub3RpZmll
ciwgbW4pOwogCXN0cnVjdCBpbnRlcnZhbF90cmVlX25vZGUgKml0OwotCXN0cnVjdCBtdXRleCAq
dW5sb2NrID0gTlVMTDsKIAl1bnNpZ25lZCBsb25nIGVuZDsKIAlpbnQgcmV0ID0gMDsKIApAQCAt
MTMwLDMyICsxMjksMTIgQEAgdXNlcnB0cl9tbl9pbnZhbGlkYXRlX3JhbmdlX3N0YXJ0KHN0cnVj
dCBtbXVfbm90aWZpZXIgKl9tbiwKIAkJfQogCQlzcGluX3VubG9jaygmbW4tPmxvY2spOwogCi0J
CWlmICghdW5sb2NrKSB7Ci0JCQl1bmxvY2sgPSAmbW4tPm1tLT5pOTE1LT5kcm0uc3RydWN0X211
dGV4OwotCi0JCQlzd2l0Y2ggKG11dGV4X3RyeWxvY2tfcmVjdXJzaXZlKHVubG9jaykpIHsKLQkJ
CWRlZmF1bHQ6Ci0JCQljYXNlIE1VVEVYX1RSWUxPQ0tfRkFJTEVEOgotCQkJCWlmIChtdXRleF9s
b2NrX2tpbGxhYmxlX25lc3RlZCh1bmxvY2ssIEk5MTVfTU1fU0hSSU5LRVIpKSB7Ci0JCQkJCWk5
MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKLQkJCQkJcmV0dXJuIC1FSU5UUjsKLQkJCQl9Ci0JCQkJ
LyogZmFsbCB0aHJvdWdoICovCi0JCQljYXNlIE1VVEVYX1RSWUxPQ0tfU1VDQ0VTUzoKLQkJCQli
cmVhazsKLQotCQkJY2FzZSBNVVRFWF9UUllMT0NLX1JFQ1VSU0lWRToKLQkJCQl1bmxvY2sgPSBF
UlJfUFRSKC1FRVhJU1QpOwotCQkJCWJyZWFrOwotCQkJfQotCQl9Ci0KIAkJcmV0ID0gaTkxNV9n
ZW1fb2JqZWN0X3VuYmluZChvYmopOwogCQlpZiAocmV0ID09IDApCiAJCQlyZXQgPSBfX2k5MTVf
Z2VtX29iamVjdF9wdXRfcGFnZXMob2JqLCBJOTE1X01NX1NIUklOS0VSKTsKIAkJaTkxNV9nZW1f
b2JqZWN0X3B1dChvYmopOwogCQlpZiAocmV0KQotCQkJZ290byB1bmxvY2s7CisJCQlyZXR1cm4g
cmV0OwogCiAJCXNwaW5fbG9jaygmbW4tPmxvY2spOwogCkBAIC0xNjgsMTIgKzE0Nyw3IEBAIHVz
ZXJwdHJfbW5faW52YWxpZGF0ZV9yYW5nZV9zdGFydChzdHJ1Y3QgbW11X25vdGlmaWVyICpfbW4s
CiAJfQogCXNwaW5fdW5sb2NrKCZtbi0+bG9jayk7CiAKLXVubG9jazoKLQlpZiAoIUlTX0VSUl9P
Ul9OVUxMKHVubG9jaykpCi0JCW11dGV4X3VubG9jayh1bmxvY2spOwotCiAJcmV0dXJuIHJldDsK
LQogfQogCiBzdGF0aWMgY29uc3Qgc3RydWN0IG1tdV9ub3RpZmllcl9vcHMgaTkxNV9nZW1fdXNl
cnB0cl9ub3RpZmllciA9IHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYwpp
bmRleCBhMTA5OTA0ZmFhNTcuLjk2NzI1NmQ3ZThhNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2NvbnRleHQuYwpAQCAtMTEwLDcgKzExMCw3IEBAIHN0YXRpYyBpbnQgX19jb250ZXh0
X3Bpbl9zdGF0ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAkgKiBBbmQgbWFyayBpdCBhcyBhIGds
b2JhbGx5IHBpbm5lZCBvYmplY3QgdG8gbGV0IHRoZSBzaHJpbmtlciBrbm93CiAJICogaXQgY2Fu
bm90IHJlY2xhaW0gdGhlIG9iamVjdCB1bnRpbCB3ZSByZWxlYXNlIGl0LgogCSAqLwotCXZtYS0+
b2JqLT5waW5fZ2xvYmFsKys7CisJYXRvbWljX2luYygmdm1hLT5vYmotPnBpbl9nbG9iYWwpOwog
CXZtYS0+b2JqLT5tbS5kaXJ0eSA9IHRydWU7CiAKIAlyZXR1cm4gMDsKQEAgLTExOCw3ICsxMTgs
OCBAQCBzdGF0aWMgaW50IF9fY29udGV4dF9waW5fc3RhdGUoc3RydWN0IGk5MTVfdm1hICp2bWEp
CiAKIHN0YXRpYyB2b2lkIF9fY29udGV4dF91bnBpbl9zdGF0ZShzdHJ1Y3QgaTkxNV92bWEgKnZt
YSkKIHsKLQl2bWEtPm9iai0+cGluX2dsb2JhbC0tOworCUdFTV9CVUdfT04oIWF0b21pY19yZWFk
KCZ2bWEtPm9iai0+cGluX2dsb2JhbCkpOworCWF0b21pY19kZWMoJnZtYS0+b2JqLT5waW5fZ2xv
YmFsKTsKIAlfX2k5MTVfdm1hX3VucGluKHZtYSk7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX3JpbmdidWZmZXIuYwppbmRleCBkMzc4M2JlYWYxMzIuLjk1ZDlhZGM3ZTJlOSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYwpAQCAtMTE4Myw3
ICsxMTgzLDcgQEAgaW50IGludGVsX3JpbmdfcGluKHN0cnVjdCBpbnRlbF9yaW5nICpyaW5nKQog
CQlnb3RvIHVucGluX3Jpbmc7CiAJfQogCi0Jdm1hLT5vYmotPnBpbl9nbG9iYWwrKzsKKwlhdG9t
aWNfcmVhZCgmdm1hLT5vYmotPnBpbl9nbG9iYWwpOwogCiAJcmluZy0+dmFkZHIgPSBhZGRyOwog
CXJldHVybiAwOwpAQCAtMTIxOSw3ICsxMjE5LDcgQEAgdm9pZCBpbnRlbF9yaW5nX3VucGluKHN0
cnVjdCBpbnRlbF9yaW5nICpyaW5nKQogCQlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKHJpbmct
PnZtYS0+b2JqKTsKIAlyaW5nLT52YWRkciA9IE5VTEw7CiAKLQlyaW5nLT52bWEtPm9iai0+cGlu
X2dsb2JhbC0tOworCWF0b21pY19kZWMoJnJpbmctPnZtYS0+b2JqLT5waW5fZ2xvYmFsKTsKIAlp
OTE1X3ZtYV91bnBpbihyaW5nLT52bWEpOwogCiAJaTkxNV90aW1lbGluZV91bnBpbihyaW5nLT50
aW1lbGluZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvYXBlcnR1cmVf
Z20uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d2dC9hcGVydHVyZV9nbS5jCmluZGV4IDJiZDlk
Y2ViZDQ4Yy4uYTJkN2ExZGY4MjBmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dnQvYXBlcnR1cmVfZ20uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvYXBlcnR1cmVf
Z20uYwpAQCAtNjEsMTQgKzYxLDE0IEBAIHN0YXRpYyBpbnQgYWxsb2NfZ20oc3RydWN0IGludGVs
X3ZncHUgKnZncHUsIGJvb2wgaGlnaF9nbSkKIAkJZmxhZ3MgPSBQSU5fTUFQUEFCTEU7CiAJfQog
Ci0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X2xvY2so
JmRldl9wcml2LT5nZ3R0LnZtLm11dGV4KTsKIAltbWlvX2h3X2FjY2Vzc19wcmUoZGV2X3ByaXYp
OwogCXJldCA9IGk5MTVfZ2VtX2d0dF9pbnNlcnQoJmRldl9wcml2LT5nZ3R0LnZtLCBub2RlLAog
CQkJCSAgc2l6ZSwgSTkxNV9HVFRfUEFHRV9TSVpFLAogCQkJCSAgSTkxNV9DT0xPUl9VTkVWSUNU
QUJMRSwKIAkJCQkgIHN0YXJ0LCBlbmQsIGZsYWdzKTsKIAltbWlvX2h3X2FjY2Vzc19wb3N0KGRl
dl9wcml2KTsKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwlt
dXRleF91bmxvY2soJmRldl9wcml2LT5nZ3R0LnZtLm11dGV4KTsKIAlpZiAocmV0KQogCQlndnRf
ZXJyKCJmYWlsIHRvIGFsbG9jICVzIGdtIHNwYWNlIGZyb20gaG9zdFxuIiwKIAkJCWhpZ2hfZ20g
PyAiaGlnaCIgOiAibG93Iik7CkBAIC05OCw5ICs5OCw5IEBAIHN0YXRpYyBpbnQgYWxsb2Nfdmdw
dV9nbShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAogCXJldHVybiAwOwogb3V0X2ZyZWVfYXBl
cnR1cmU6Ci0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4
X2xvY2soJmRldl9wcml2LT5nZ3R0LnZtLm11dGV4KTsKIAlkcm1fbW1fcmVtb3ZlX25vZGUoJnZn
cHUtPmdtLmxvd19nbV9ub2RlKTsKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0
X211dGV4KTsKKwltdXRleF91bmxvY2soJmRldl9wcml2LT5nZ3R0LnZtLm11dGV4KTsKIAlyZXR1
cm4gcmV0OwogfQogCkBAIC0xMDgsMTAgKzEwOCwxMCBAQCBzdGF0aWMgdm9pZCBmcmVlX3ZncHVf
Z20oc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdmdwdS0+Z3Z0LT5kZXZfcHJpdjsKIAotCW11dGV4X2xvY2soJmRldl9wcml2
LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF9sb2NrKCZkZXZfcHJpdi0+Z2d0dC52bS5tdXRl
eCk7CiAJZHJtX21tX3JlbW92ZV9ub2RlKCZ2Z3B1LT5nbS5sb3dfZ21fbm9kZSk7CiAJZHJtX21t
X3JlbW92ZV9ub2RlKCZ2Z3B1LT5nbS5oaWdoX2dtX25vZGUpOwotCW11dGV4X3VubG9jaygmZGV2
X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmdndHQu
dm0ubXV0ZXgpOwogfQogCiAvKioKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZGVidWdmcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKaW5kZXgg
YjU0ZjdiNzlhNTNjLi5jYmVhYTUzMTE3YWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZGVidWdmcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdm
cy5jCkBAIC03Niw3ICs3Niw3IEBAIHN0YXRpYyBpbnQgaTkxNV9jYXBhYmlsaXRpZXMoc3RydWN0
IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCiBzdGF0aWMgY2hhciBnZXRfcGluX2ZsYWcoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHsKLQlyZXR1cm4gb2JqLT5waW5fZ2xvYmFs
ID8gJ3AnIDogJyAnOworCXJldHVybiBhdG9taWNfcmVhZCgmb2JqLT5waW5fZ2xvYmFsKSA/ICdw
JyA6ICcgJzsKIH0KIAogc3RhdGljIGNoYXIgZ2V0X3RpbGluZ19mbGFnKHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmopCkBAIC0yMTgsNyArMjE4LDcgQEAgZGVzY3JpYmVfb2JqKHN0cnVj
dCBzZXFfZmlsZSAqbSwgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAlzZXFfcHJp
bnRmKG0sICIgKHBpbm5lZCB4ICVkKSIsIHBpbl9jb3VudCk7CiAJaWYgKG9iai0+c3RvbGVuKQog
CQlzZXFfcHJpbnRmKG0sICIgKHN0b2xlbjogJTA4bGx4KSIsIG9iai0+c3RvbGVuLT5zdGFydCk7
Ci0JaWYgKG9iai0+cGluX2dsb2JhbCkKKwlpZiAoYXRvbWljX3JlYWQoJm9iai0+cGluX2dsb2Jh
bCkpCiAJCXNlcV9wcmludGYobSwgIiAoZ2xvYmFsKSIpOwogCiAJZW5naW5lID0gaTkxNV9nZW1f
b2JqZWN0X2xhc3Rfd3JpdGVfZW5naW5lKG9iaik7CkBAIC0xNjA0LDExICsxNjA0LDYgQEAgc3Rh
dGljIGludCBpOTE1X2dlbV9mcmFtZWJ1ZmZlcl9pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9p
ZCAqZGF0YSkKIAlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gJmRldl9wcml2LT5kcm07CiAJc3Ry
dWN0IGludGVsX2ZyYW1lYnVmZmVyICpmYmRldl9mYiA9IE5VTEw7CiAJc3RydWN0IGRybV9mcmFt
ZWJ1ZmZlciAqZHJtX2ZiOwotCWludCByZXQ7Ci0KLQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVw
dGlibGUoJmRldi0+c3RydWN0X211dGV4KTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwogCiAj
aWZkZWYgQ09ORklHX0RSTV9GQkRFVl9FTVVMQVRJT04KIAlpZiAoZGV2X3ByaXYtPmZiZGV2ICYm
IGRldl9wcml2LT5mYmRldi0+aGVscGVyLmZiKSB7CkBAIC0xNjQzLDcgKzE2MzgsNiBAQCBzdGF0
aWMgaW50IGk5MTVfZ2VtX2ZyYW1lYnVmZmVyX2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lk
ICpkYXRhKQogCQlzZXFfcHV0YyhtLCAnXG4nKTsKIAl9CiAJbXV0ZXhfdW5sb2NrKCZkZXYtPm1v
ZGVfY29uZmlnLmZiX2xvY2spOwotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwog
CiAJcmV0dXJuIDA7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dl
bS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwppbmRleCBmZDQ0OGFmYWU0OTIu
LjllODM1MzU1ZWI5MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0u
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCkBAIC02MCwyMCArNjAsMzEg
QEAKICNpbmNsdWRlICJpbnRlbF9wbS5oIgogCiBzdGF0aWMgaW50Ci1pbnNlcnRfbWFwcGFibGVf
bm9kZShzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0LAotICAgICAgICAgICAgICAgICAgICAgc3RydWN0
IGRybV9tbV9ub2RlICpub2RlLCB1MzIgc2l6ZSkKK2luc2VydF9tYXBwYWJsZV9ub2RlKHN0cnVj
dCBpOTE1X2dndHQgKmdndHQsIHN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZSwgdTMyIHNpemUpCiB7
CisJaW50IHJldDsKKwogCW1lbXNldChub2RlLCAwLCBzaXplb2YoKm5vZGUpKTsKLQlyZXR1cm4g
ZHJtX21tX2luc2VydF9ub2RlX2luX3JhbmdlKCZnZ3R0LT52bS5tbSwgbm9kZSwKLQkJCQkJICAg
c2l6ZSwgMCwgSTkxNV9DT0xPUl9VTkVWSUNUQUJMRSwKLQkJCQkJICAgMCwgZ2d0dC0+bWFwcGFi
bGVfZW5kLAotCQkJCQkgICBEUk1fTU1fSU5TRVJUX0xPVyk7CisKKwlyZXQgPSBtdXRleF9sb2Nr
X2ludGVycnVwdGlibGUoJmdndHQtPnZtLm11dGV4KTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0
OworCisJcmV0ID0gZHJtX21tX2luc2VydF9ub2RlX2luX3JhbmdlKCZnZ3R0LT52bS5tbSwgbm9k
ZSwKKwkJCQkJICBzaXplLCAwLCBJOTE1X0NPTE9SX1VORVZJQ1RBQkxFLAorCQkJCQkgIDAsIGdn
dHQtPm1hcHBhYmxlX2VuZCwKKwkJCQkJICBEUk1fTU1fSU5TRVJUX0xPVyk7CisJbXV0ZXhfdW5s
b2NrKCZnZ3R0LT52bS5tdXRleCk7CisKKwlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgdm9pZAot
cmVtb3ZlX21hcHBhYmxlX25vZGUoc3RydWN0IGRybV9tbV9ub2RlICpub2RlKQorcmVtb3ZlX21h
cHBhYmxlX25vZGUoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCwgc3RydWN0IGRybV9tbV9ub2RlICpu
b2RlKQogeworCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAlkcm1fbW1fcmVtb3ZlX25v
ZGUobm9kZSk7CisJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiB9CiAKIGludApAQCAt
ODQsOCArOTUsMTEgQEAgaTkxNV9nZW1fZ2V0X2FwZXJ0dXJlX2lvY3RsKHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJc3RydWN0IGRybV9pOTE1X2dlbV9nZXRfYXBlcnR1cmUg
KmFyZ3MgPSBkYXRhOwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCXU2NCBwaW5uZWQ7CisJaW50
IHJldDsKIAotCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKKwlyZXQgPSBtdXRleF9sb2Nr
X2ludGVycnVwdGlibGUoJmdndHQtPnZtLm11dGV4KTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0
OwogCiAJcGlubmVkID0gZ2d0dC0+dm0ucmVzZXJ2ZWQ7CiAJbGlzdF9mb3JfZWFjaF9lbnRyeSh2
bWEsICZnZ3R0LT52bS5ib3VuZF9saXN0LCB2bV9saW5rKQpAQCAtMTA2LDggKzEyMCw2IEBAIGlu
dCBpOTE1X2dlbV9vYmplY3RfdW5iaW5kKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmop
CiAJTElTVF9IRUFEKHN0aWxsX2luX2xpc3QpOwogCWludCByZXQgPSAwOwogCi0JbG9ja2RlcF9h
c3NlcnRfaGVsZCgmb2JqLT5iYXNlLmRldi0+c3RydWN0X211dGV4KTsKLQogCXNwaW5fbG9jaygm
b2JqLT52bWEubG9jayk7CiAJd2hpbGUgKCFyZXQgJiYgKHZtYSA9IGxpc3RfZmlyc3RfZW50cnlf
b3JfbnVsbCgmb2JqLT52bWEubGlzdCwKIAkJCQkJCSAgICAgICBzdHJ1Y3QgaTkxNV92bWEsCkBA
IC0xMTcsNyArMTI5LDExIEBAIGludCBpOTE1X2dlbV9vYmplY3RfdW5iaW5kKHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmopCiAJCWxpc3RfbW92ZV90YWlsKCZ2bWEtPm9ial9saW5rLCAm
c3RpbGxfaW5fbGlzdCk7CiAJCXNwaW5fdW5sb2NrKCZvYmotPnZtYS5sb2NrKTsKIAotCQlyZXQg
PSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxl
KCZ2bWEtPnZtLT5tdXRleCk7CisJCWlmICghcmV0KSB7CisJCQlyZXQgPSBpOTE1X3ZtYV91bmJp
bmQodm1hKTsKKwkJCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOworCQl9CiAKIAkJaTkx
NV92bWFfcHV0KHZtYSk7CiAJCXNwaW5fbG9jaygmb2JqLT52bWEubG9jayk7CkBAIC0zNzUsMTAg
KzM5MSw2IEBAIGk5MTVfZ2VtX2d0dF9wcmVhZChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqLAogCXU2NCByZW1haW4sIG9mZnNldDsKIAlpbnQgcmV0OwogCi0JcmV0ID0gbXV0ZXhfbG9j
a19pbnRlcnJ1cHRpYmxlKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAocmV0KQotCQly
ZXR1cm4gcmV0OwotCiAJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KGk5MTUpOwogCXZt
YSA9IEVSUl9QVFIoLUVOT0RFVik7CiAJaWYgKCFpOTE1X2dlbV9vYmplY3RfaXNfdGlsZWQob2Jq
KSkgewpAQCAtMzkzLDEyICs0MDUsMTAgQEAgaTkxNV9nZW1fZ3R0X3ByZWFkKHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJfSBlbHNlIHsKIAkJcmV0ID0gaW5zZXJ0X21hcHBhYmxl
X25vZGUoZ2d0dCwgJm5vZGUsIFBBR0VfU0laRSk7CiAJCWlmIChyZXQpCi0JCQlnb3RvIG91dF91
bmxvY2s7CisJCQlnb3RvIG91dF9ycG07CiAJCUdFTV9CVUdfT04oIW5vZGUuYWxsb2NhdGVkKTsK
IAl9CiAKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJcmV0ID0g
aTkxNV9nZW1fb2JqZWN0X2xvY2tfaW50ZXJydXB0aWJsZShvYmopOwogCWlmIChyZXQpCiAJCWdv
dG8gb3V0X3VucGluOwpAQCAtNDU0LDE3ICs0NjQsMTUgQEAgaTkxNV9nZW1fZ3R0X3ByZWFkKHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAKIAlpOTE1X2dlbV9vYmplY3RfdW5sb2Nr
X2ZlbmNlKG9iaiwgZmVuY2UpOwogb3V0X3VucGluOgotCW11dGV4X2xvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCWlmIChub2RlLmFsbG9jYXRlZCkgewogCQl3bWIoKTsKIAkJZ2d0dC0+
dm0uY2xlYXJfcmFuZ2UoJmdndHQtPnZtLCBub2RlLnN0YXJ0LCBub2RlLnNpemUpOwotCQlyZW1v
dmVfbWFwcGFibGVfbm9kZSgmbm9kZSk7CisJCXJlbW92ZV9tYXBwYWJsZV9ub2RlKGdndHQsICZu
b2RlKTsKIAl9IGVsc2UgewogCQlpOTE1X3ZtYV91bnBpbih2bWEpOwogCX0KLW91dF91bmxvY2s6
CitvdXRfcnBtOgogCWludGVsX3J1bnRpbWVfcG1fcHV0KGk5MTUsIHdha2VyZWYpOwotCW11dGV4
X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlyZXR1cm4gcmV0OwogfQpAQCAt
NTcxLDEwICs1NzksNiBAQCBpOTE1X2dlbV9ndHRfcHdyaXRlX2Zhc3Qoc3RydWN0IGRybV9pOTE1
X2dlbV9vYmplY3QgKm9iaiwKIAl2b2lkIF9fdXNlciAqdXNlcl9kYXRhOwogCWludCByZXQ7CiAK
LQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KIAlpZiAoaTkxNV9nZW1fb2JqZWN0X2hhc19z
dHJ1Y3RfcGFnZShvYmopKSB7CiAJCS8qCiAJCSAqIEF2b2lkIHdha2luZyB0aGUgZGV2aWNlIHVw
IGlmIHdlIGNhbiBmYWxsYmFjaywgYXMKQEAgLTU4NCwxMCArNTg4LDggQEAgaTkxNV9nZW1fZ3R0
X3B3cml0ZV9mYXN0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCSAqIHVzaW5n
IHRoZSBjYWNoZSBieXBhc3Mgb2YgaW5kaXJlY3QgR0dUVCBhY2Nlc3MuCiAJCSAqLwogCQl3YWtl
cmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXRfaWZfaW5fdXNlKGk5MTUpOwotCQlpZiAoIXdha2Vy
ZWYpIHsKLQkJCXJldCA9IC1FRkFVTFQ7Ci0JCQlnb3RvIG91dF91bmxvY2s7Ci0JCX0KKwkJaWYg
KCF3YWtlcmVmKQorCQkJcmV0dXJuIC1FRkFVTFQ7CiAJfSBlbHNlIHsKIAkJLyogTm8gYmFja2lu
ZyBwYWdlcywgbm8gZmFsbGJhY2ssIHdlIG11c3QgZm9yY2UgR0dUVCBhY2Nlc3MgKi8KIAkJd2Fr
ZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KGk5MTUpOwpAQCAtNjEwLDggKzYxMiw2IEBAIGk5
MTVfZ2VtX2d0dF9wd3JpdGVfZmFzdChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAog
CQlHRU1fQlVHX09OKCFub2RlLmFsbG9jYXRlZCk7CiAJfQogCi0JbXV0ZXhfdW5sb2NrKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKLQogCXJldCA9IGk5MTVfZ2VtX29iamVjdF9sb2NrX2ludGVy
cnVwdGlibGUob2JqKTsKIAlpZiAocmV0KQogCQlnb3RvIG91dF91bnBpbjsKQEAgLTY3NCwxOCAr
Njc0LDE1IEBAIGk5MTVfZ2VtX2d0dF9wd3JpdGVfZmFzdChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqLAogCiAJaTkxNV9nZW1fb2JqZWN0X3VubG9ja19mZW5jZShvYmosIGZlbmNlKTsK
IG91dF91bnBpbjoKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpZiAo
bm9kZS5hbGxvY2F0ZWQpIHsKIAkJd21iKCk7CiAJCWdndHQtPnZtLmNsZWFyX3JhbmdlKCZnZ3R0
LT52bSwgbm9kZS5zdGFydCwgbm9kZS5zaXplKTsKLQkJcmVtb3ZlX21hcHBhYmxlX25vZGUoJm5v
ZGUpOworCQlyZW1vdmVfbWFwcGFibGVfbm9kZShnZ3R0LCAmbm9kZSk7CiAJfSBlbHNlIHsKIAkJ
aTkxNV92bWFfdW5waW4odm1hKTsKIAl9CiBvdXRfcnBtOgogCWludGVsX3J1bnRpbWVfcG1fcHV0
KGk5MTUsIHdha2VyZWYpOwotb3V0X3VubG9jazoKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCXJldHVybiByZXQ7CiB9CiAKQEAgLTEwMzYsOCArMTAzMyw2IEBAIGk5
MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAog
CXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCWludCByZXQ7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxk
KCZvYmotPmJhc2UuZGV2LT5zdHJ1Y3RfbXV0ZXgpOwotCiAJaWYgKGZsYWdzICYgUElOX01BUFBB
QkxFICYmCiAJICAgICghdmlldyB8fCB2aWV3LT50eXBlID09IEk5MTVfR0dUVF9WSUVXX05PUk1B
TCkpIHsKIAkJLyogSWYgdGhlIHJlcXVpcmVkIHNwYWNlIGlzIGxhcmdlciB0aGFuIHRoZSBhdmFp
bGFibGUKQEAgLTEwNzQsMTQgKzEwNjksMjggQEAgaTkxNV9nZW1fb2JqZWN0X2dndHRfcGluKHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJaWYgKElTX0VSUih2bWEpKQogCQlyZXR1
cm4gdm1hOwogCisJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9wYWdlcyhvYmopOworCWlmIChy
ZXQpCisJCXJldHVybiBFUlJfUFRSKHJldCk7CisKKwlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVw
dGlibGUoJnZtLT5tdXRleCk7CisJaWYgKHJldCkgeworCQl2bWEgPSBFUlJfUFRSKHJldCk7CisJ
CWdvdG8gdW5waW47CisJfQorCiAJaWYgKGk5MTVfdm1hX21pc3BsYWNlZCh2bWEsIHNpemUsIGFs
aWdubWVudCwgZmxhZ3MpKSB7CiAJCWlmIChmbGFncyAmIFBJTl9OT05CTE9DSykgewotCQkJaWYg
KGk5MTVfdm1hX2lzX3Bpbm5lZCh2bWEpIHx8IGk5MTVfdm1hX2lzX2FjdGl2ZSh2bWEpKQotCQkJ
CXJldHVybiBFUlJfUFRSKC1FTk9TUEMpOworCQkJaWYgKGk5MTVfdm1hX2lzX3Bpbm5lZCh2bWEp
IHx8IGk5MTVfdm1hX2lzX2FjdGl2ZSh2bWEpKSB7CisJCQkJdm1hID0gRVJSX1BUUigtRU5PU1BD
KTsKKwkJCQlnb3RvIHVubG9jazsKKwkJCX0KIAogCQkJaWYgKGZsYWdzICYgUElOX01BUFBBQkxF
ICYmCi0JCQkgICAgdm1hLT5mZW5jZV9zaXplID4gZGV2X3ByaXYtPmdndHQubWFwcGFibGVfZW5k
IC8gMikKLQkJCQlyZXR1cm4gRVJSX1BUUigtRU5PU1BDKTsKKwkJCSAgICB2bWEtPmZlbmNlX3Np
emUgPiBkZXZfcHJpdi0+Z2d0dC5tYXBwYWJsZV9lbmQgLyAyKSB7CisJCQkJdm1hID0gRVJSX1BU
UigtRU5PU1BDKTsKKwkJCQlnb3RvIHVubG9jazsKKwkJCX0KIAkJfQogCiAJCVdBUk4oaTkxNV92
bWFfaXNfcGlubmVkKHZtYSksCkBAIC0xMDk0LDE1ICsxMTAzLDIwIEBAIGk5MTVfZ2VtX29iamVj
dF9nZ3R0X3BpbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQlyZXQgPSBpOTE1
X3ZtYV91bmJpbmQodm1hKTsKIAkJaWYgKHJldCkgewogCQkJaTkxNV92bWFfcHV0KHZtYSk7Ci0J
CQlyZXR1cm4gRVJSX1BUUihyZXQpOworCQkJdm1hID0gRVJSX1BUUihyZXQpOworCQkJZ290byB1
bmxvY2s7CiAJCX0KIAl9CiAKLQlyZXQgPSBpOTE1X3ZtYV9waW4odm1hLCBzaXplLCBhbGlnbm1l
bnQsIGZsYWdzIHwgUElOX0dMT0JBTCk7CisJcmV0ID0gX19pOTE1X3ZtYV9kb19waW4odm1hLCBz
aXplLCBhbGlnbm1lbnQsIGZsYWdzIHwgUElOX0dMT0JBTCk7CiAJaTkxNV92bWFfcHV0KHZtYSk7
CiAJaWYgKHJldCkKLQkJcmV0dXJuIEVSUl9QVFIocmV0KTsKKwkJdm1hID0gRVJSX1BUUihyZXQp
OwogCit1bmxvY2s6CisJbXV0ZXhfdW5sb2NrKCZ2bS0+bXV0ZXgpOwordW5waW46CisJaTkxNV9n
ZW1fb2JqZWN0X3VucGluX3BhZ2VzKG9iaik7CiAJcmV0dXJuIHZtYTsKIH0KIApAQCAtMTQwMSw3
ICsxNDE1LDkgQEAgc3RhdGljIGludCBfX2ludGVsX2VuZ2luZXNfcmVjb3JkX2RlZmF1bHRzKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCQkgKiBmcm9tIHRoZSBHVFQgdG8gcHJldmVu
dCBzdWNoIGFjY2lkZW50cyBhbmQgcmVjbGFpbSB0aGUKIAkJICogc3BhY2UuCiAJCSAqLworCQlt
dXRleF9sb2NrKCZzdGF0ZS0+dm0tPm11dGV4KTsKIAkJZXJyID0gaTkxNV92bWFfdW5iaW5kKHN0
YXRlKTsKKwkJbXV0ZXhfdW5sb2NrKCZzdGF0ZS0+dm0tPm11dGV4KTsKIAkJaWYgKGVycikKIAkJ
CWdvdG8gZXJyX2FjdGl2ZTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9nZW1fZXZpY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2V2aWN0LmMKaW5k
ZXggYTU3ODNjNGNiOThiLi4wMjAyZjU4ZDhiYjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtX2V2aWN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
ZW1fZXZpY3QuYwpAQCAtNDgsOCArNDgsNyBAQCBzdGF0aWMgaW50IGdndHRfZmx1c2goc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJICogYm91bmQgYnkgdGhlaXIgYWN0aXZlIHJlZmVy
ZW5jZS4KIAkgKi8KIAlyZXR1cm4gaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShpOTE1LAotCQkJCSAg
ICAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFIHwKLQkJCQkgICAgICBJOTE1X1dBSVRfTE9DS0VE
LAorCQkJCSAgICAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFLAogCQkJCSAgICAgIE1BWF9TQ0hF
RFVMRV9USU1FT1VUKTsKIH0KIApAQCAtMTA4LDcgKzEwNyw3IEBAIGk5MTVfZ2VtX2V2aWN0X3Nv
bWV0aGluZyhzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAlzdHJ1Y3QgaTkxNV92bWEg
KmFjdGl2ZTsKIAlpbnQgcmV0OwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm0tPmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5tdXRleCk7CiAJdHJh
Y2VfaTkxNV9nZW1fZXZpY3Qodm0sIG1pbl9zaXplLCBhbGlnbm1lbnQsIGZsYWdzKTsKIAogCS8q
CkBAIC0xMzEsMTUgKzEzMCw2IEBAIGk5MTVfZ2VtX2V2aWN0X3NvbWV0aGluZyhzdHJ1Y3QgaTkx
NV9hZGRyZXNzX3NwYWNlICp2bSwKIAkJCQkgICAgbWluX3NpemUsIGFsaWdubWVudCwgY2FjaGVf
bGV2ZWwsCiAJCQkJICAgIHN0YXJ0LCBlbmQsIG1vZGUpOwogCi0JLyoKLQkgKiBSZXRpcmUgYmVm
b3JlIHdlIHNlYXJjaCB0aGUgYWN0aXZlIGxpc3QuIEFsdGhvdWdoIHdlIGhhdmUKLQkgKiByZWFz
b25hYmxlIGFjY3VyYWN5IGluIG91ciByZXRpcmVtZW50IGxpc3RzLCB3ZSBtYXkgaGF2ZQotCSAq
IGEgc3RyYXkgcGluIChwcmV2ZW50aW5nIGV2aWN0aW9uKSB0aGF0IGNhbiBvbmx5IGJlIHJlc29s
dmVkIGJ5Ci0JICogcmV0aXJpbmcuCi0JICovCi0JaWYgKCEoZmxhZ3MgJiBQSU5fTk9OQkxPQ0sp
KQotCQlpOTE1X3JldGlyZV9yZXF1ZXN0cyhkZXZfcHJpdik7Ci0KIHNlYXJjaF9hZ2FpbjoKIAlh
Y3RpdmUgPSBOVUxMOwogCUlOSVRfTElTVF9IRUFEKCZldmljdGlvbl9saXN0KTsKQEAgLTI3Mywy
MCArMjYzLDEyIEBAIGludCBpOTE1X2dlbV9ldmljdF9mb3Jfbm9kZShzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlICp2bSwKIAlib29sIGNoZWNrX2NvbG9yOwogCWludCByZXQgPSAwOwogCi0JbG9j
a2RlcF9hc3NlcnRfaGVsZCgmdm0tPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWxvY2tkZXBf
YXNzZXJ0X2hlbGQoJnZtLT5tdXRleCk7CiAJR0VNX0JVR19PTighSVNfQUxJR05FRChzdGFydCwg
STkxNV9HVFRfUEFHRV9TSVpFKSk7CiAJR0VNX0JVR19PTighSVNfQUxJR05FRChlbmQsIEk5MTVf
R1RUX1BBR0VfU0laRSkpOwogCiAJdHJhY2VfaTkxNV9nZW1fZXZpY3Rfbm9kZSh2bSwgdGFyZ2V0
LCBmbGFncyk7CiAKLQkvKiBSZXRpcmUgYmVmb3JlIHdlIHNlYXJjaCB0aGUgYWN0aXZlIGxpc3Qu
IEFsdGhvdWdoIHdlIGhhdmUKLQkgKiByZWFzb25hYmxlIGFjY3VyYWN5IGluIG91ciByZXRpcmVt
ZW50IGxpc3RzLCB3ZSBtYXkgaGF2ZQotCSAqIGEgc3RyYXkgcGluIChwcmV2ZW50aW5nIGV2aWN0
aW9uKSB0aGF0IGNhbiBvbmx5IGJlIHJlc29sdmVkIGJ5Ci0JICogcmV0aXJpbmcuCi0JICovCi0J
aWYgKCEoZmxhZ3MgJiBQSU5fTk9OQkxPQ0spKQotCQlpOTE1X3JldGlyZV9yZXF1ZXN0cyh2bS0+
aTkxNSk7Ci0KIAljaGVja19jb2xvciA9IHZtLT5tbS5jb2xvcl9hZGp1c3Q7CiAJaWYgKGNoZWNr
X2NvbG9yKSB7CiAJCS8qIEV4cGFuZCBzZWFyY2ggdG8gY292ZXIgbmVpZ2hib3VyaW5nIGd1YXJk
IHBhZ2VzIChvciBsYWNrISkgKi8KQEAgLTM4NCw3ICszNjYsNyBAQCBpbnQgaTkxNV9nZW1fZXZp
Y3Rfdm0oc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiAJc3RydWN0IGk5MTVfdm1hICp2
bWEsICpuZXh0OwogCWludCByZXQ7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bS0+aTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm0tPm11dGV4KTsKIAl0
cmFjZV9pOTE1X2dlbV9ldmljdF92bSh2bSk7CiAKIAkvKiBTd2l0Y2ggYmFjayB0byB0aGUgZGVm
YXVsdCBjb250ZXh0IGluIG9yZGVyIHRvIHVucGluCkBAIC0zOTksNyArMzgxLDYgQEAgaW50IGk5
MTVfZ2VtX2V2aWN0X3ZtKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogCX0KIAogCUlO
SVRfTElTVF9IRUFEKCZldmljdGlvbl9saXN0KTsKLQltdXRleF9sb2NrKCZ2bS0+bXV0ZXgpOwog
CWxpc3RfZm9yX2VhY2hfZW50cnkodm1hLCAmdm0tPmJvdW5kX2xpc3QsIHZtX2xpbmspIHsKIAkJ
aWYgKGk5MTVfdm1hX2lzX3Bpbm5lZCh2bWEpKQogCQkJY29udGludWU7CkBAIC00MDcsNyArMzg4
LDYgQEAgaW50IGk5MTVfZ2VtX2V2aWN0X3ZtKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZt
KQogCQlfX2k5MTVfdm1hX3Bpbih2bWEpOwogCQlsaXN0X2FkZCgmdm1hLT5ldmljdF9saW5rLCAm
ZXZpY3Rpb25fbGlzdCk7CiAJfQotCW11dGV4X3VubG9jaygmdm0tPm11dGV4KTsKIAogCXJldCA9
IDA7CiAJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHZtYSwgbmV4dCwgJmV2aWN0aW9uX2xpc3Qs
IGV2aWN0X2xpbmspIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2Vt
X2ZlbmNlX3JlZy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZmVuY2VfcmVnLmMK
aW5kZXggZTU5NmRkNWFlMWUyLi4xNzIxNWRlMmE4YjggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ2VtX2ZlbmNlX3JlZy5jCkBAIC0zMzEsNyArMzMxLDcgQEAgc3RhdGljIHN0cnVjdCBp
OTE1X2ZlbmNlX3JlZyAqZmVuY2VfZmluZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
IAlyZXR1cm4gRVJSX1BUUigtRURFQURMSyk7CiB9CiAKLXN0YXRpYyBpbnQgX19pOTE1X3ZtYV9w
aW5fZmVuY2Uoc3RydWN0IGk5MTVfdm1hICp2bWEpCitpbnQgX19pOTE1X3ZtYV9waW5fZmVuY2Uo
c3RydWN0IGk5MTVfdm1hICp2bWEpCiB7CiAJc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCA9IGk5MTVf
dm1fdG9fZ2d0dCh2bWEtPnZtKTsKIAlzdHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmZlbmNlOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwppbmRleCBmYjQ4NDY4NWZmMWIuLmM3ZDc5NTlmNzYx
ZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKQEAgLTE5MjksNTkgKzE5MjksMTEg
QEAgc3RhdGljIHZvaWQgZ2VuNl9wcGd0dF9mcmVlX3BkKHN0cnVjdCBnZW42X3BwZ3R0ICpwcGd0
dCkKIAkJCWZyZWVfcHQoJnBwZ3R0LT5iYXNlLnZtLCBwdCk7CiB9CiAKLXN0cnVjdCBnZW42X3Bw
Z3R0X2NsZWFudXBfd29yayB7Ci0Jc3RydWN0IHdvcmtfc3RydWN0IGJhc2U7Ci0Jc3RydWN0IGk5
MTVfdm1hICp2bWE7Ci19OwotCi1zdGF0aWMgdm9pZCBnZW42X3BwZ3R0X2NsZWFudXBfd29yayhz
dHJ1Y3Qgd29ya19zdHJ1Y3QgKndyaykKLXsKLQlzdHJ1Y3QgZ2VuNl9wcGd0dF9jbGVhbnVwX3dv
cmsgKndvcmsgPQotCQljb250YWluZXJfb2Yod3JrLCB0eXBlb2YoKndvcmspLCBiYXNlKTsKLQot
CS8qIFNpZGUgbm90ZSwgdm1hLT52bSBpcyB0aGUgR0dUVCBub3QgdGhlIHBwZ3R0IHdlIGp1c3Qg
ZGVzdHJveWVkISAqLwotCWk5MTVfdm1hX2Rlc3Ryb3kod29yay0+dm1hKTsKLQotCWtmcmVlKHdv
cmspOwotfQotCi1zdGF0aWMgaW50IG5vcF9zZXRfcGFnZXMoc3RydWN0IGk5MTVfdm1hICp2bWEp
Ci17Ci0JcmV0dXJuIC1FTk9ERVY7Ci19Ci0KLXN0YXRpYyB2b2lkIG5vcF9jbGVhcl9wYWdlcyhz
dHJ1Y3QgaTkxNV92bWEgKnZtYSkKLXsKLX0KLQotc3RhdGljIGludCBub3BfYmluZChzdHJ1Y3Qg
aTkxNV92bWEgKnZtYSwKLQkJICAgIGVudW0gaTkxNV9jYWNoZV9sZXZlbCBjYWNoZV9sZXZlbCwK
LQkJICAgIHUzMiB1bnVzZWQpCi17Ci0JcmV0dXJuIC1FTk9ERVY7Ci19Ci0KLXN0YXRpYyB2b2lk
IG5vcF91bmJpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEpCi17Ci19Ci0KLXN0YXRpYyBjb25zdCBz
dHJ1Y3QgaTkxNV92bWFfb3BzIG5vcF92bWFfb3BzID0gewotCS5zZXRfcGFnZXMgPSBub3Bfc2V0
X3BhZ2VzLAotCS5jbGVhcl9wYWdlcyA9IG5vcF9jbGVhcl9wYWdlcywKLQkuYmluZF92bWEgPSBu
b3BfYmluZCwKLQkudW5iaW5kX3ZtYSA9IG5vcF91bmJpbmQsCi19OwotCiBzdGF0aWMgdm9pZCBn
ZW42X3BwZ3R0X2NsZWFudXAoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiB7CiAJc3Ry
dWN0IGdlbjZfcHBndHQgKnBwZ3R0ID0gdG9fZ2VuNl9wcGd0dChpOTE1X3ZtX3RvX3BwZ3R0KHZt
KSk7Ci0Jc3RydWN0IGdlbjZfcHBndHRfY2xlYW51cF93b3JrICp3b3JrID0gcHBndHQtPndvcms7
CiAKLQkvKiBGSVhNRSByZW1vdmUgdGhlIHN0cnVjdF9tdXRleCB0byBicmluZyB0aGUgbG9ja2lu
ZyB1bmRlciBjb250cm9sICovCi0JSU5JVF9XT1JLKCZ3b3JrLT5iYXNlLCBnZW42X3BwZ3R0X2Ns
ZWFudXBfd29yayk7Ci0Jd29yay0+dm1hID0gcHBndHQtPnZtYTsKLQl3b3JrLT52bWEtPm9wcyA9
ICZub3Bfdm1hX29wczsKLQlzY2hlZHVsZV93b3JrKCZ3b3JrLT5iYXNlKTsKKwlpOTE1X3ZtYV9k
ZXN0cm95KHBwZ3R0LT52bWEpOwogCiAJZ2VuNl9wcGd0dF9mcmVlX3BkKHBwZ3R0KTsKIAlnZW42
X3BwZ3R0X2ZyZWVfc2NyYXRjaCh2bSk7CkBAIC0yMTU3LDE1ICsyMTA5LDkgQEAgc3RhdGljIHN0
cnVjdCBpOTE1X3BwZ3R0ICpnZW42X3BwZ3R0X2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKIAogCXBwZ3R0LT5iYXNlLnZtLnB0ZV9lbmNvZGUgPSBnZ3R0LT52bS5wdGVfZW5j
b2RlOwogCi0JcHBndHQtPndvcmsgPSBrbWFsbG9jKHNpemVvZigqcHBndHQtPndvcmspLCBHRlBf
S0VSTkVMKTsKLQlpZiAoIXBwZ3R0LT53b3JrKSB7Ci0JCWVyciA9IC1FTk9NRU07Ci0JCWdvdG8g
ZXJyX2ZyZWU7Ci0JfQotCiAJZXJyID0gZ2VuNl9wcGd0dF9pbml0X3NjcmF0Y2gocHBndHQpOwog
CWlmIChlcnIpCi0JCWdvdG8gZXJyX3dvcms7CisJCWdvdG8gZXJyX2ZyZWU7CiAKIAlwcGd0dC0+
dm1hID0gcGRfdm1hX2NyZWF0ZShwcGd0dCwgR0VONl9QRF9TSVpFKTsKIAlpZiAoSVNfRVJSKHBw
Z3R0LT52bWEpKSB7CkBAIC0yMTc3LDggKzIxMjMsNiBAQCBzdGF0aWMgc3RydWN0IGk5MTVfcHBn
dHQgKmdlbjZfcHBndHRfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCiBl
cnJfc2NyYXRjaDoKIAlnZW42X3BwZ3R0X2ZyZWVfc2NyYXRjaCgmcHBndHQtPmJhc2Uudm0pOwot
ZXJyX3dvcms6Ci0Ja2ZyZWUocHBndHQtPndvcmspOwogZXJyX2ZyZWU6CiAJa2ZyZWUocHBndHQp
OwogCXJldHVybiBFUlJfUFRSKGVycik7CkBAIC0yODk1LDExICsyODM5LDEyIEBAIHZvaWQgaTkx
NV9nZ3R0X2NsZWFudXBfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCiAJ
Z2d0dC0+dm0uY2xvc2VkID0gdHJ1ZTsKIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3Ry
dWN0X211dGV4KTsKIAlmaW5pX2FsaWFzaW5nX3BwZ3R0KGRldl9wcml2KTsKIAorCW11dGV4X2xv
Y2soJmdndHQtPnZtLm11dGV4KTsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUodm1hLCB2biwg
JmdndHQtPnZtLmJvdW5kX2xpc3QsIHZtX2xpbmspCiAJCVdBUk5fT04oaTkxNV92bWFfdW5iaW5k
KHZtYSkpOworCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCiAJaWYgKGRybV9tbV9u
b2RlX2FsbG9jYXRlZCgmZ2d0dC0+ZXJyb3JfY2FwdHVyZSkpCiAJCWRybV9tbV9yZW1vdmVfbm9k
ZSgmZ2d0dC0+ZXJyb3JfY2FwdHVyZSk7CkBAIC0yOTE5LDggKzI4NjQsNiBAQCB2b2lkIGk5MTVf
Z2d0dF9jbGVhbnVwX2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkJX19w
YWdldmVjX3JlbGVhc2UocHZlYyk7CiAJfQogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJt
LnN0cnVjdF9tdXRleCk7Ci0KIAlhcmNoX3BoeXNfd2NfZGVsKGdndHQtPm10cnIpOwogCWlvX21h
cHBpbmdfZmluaSgmZ2d0dC0+aW9tYXApOwogCkBAIC0zNTIzLDcgKzM0NjYsNiBAQCBpbnQgaTkx
NV9nZ3R0X2luaXRfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCSAqIGJl
eW9uZCB0aGUgZW5kIG9mIHRoZSBiYXRjaCBidWZmZXIsIGFjcm9zcyB0aGUgcGFnZSBib3VuZGFy
eSwKIAkgKiBhbmQgYmV5b25kIHRoZSBlbmQgb2YgdGhlIEdUVCBpZiB3ZSBkbyBub3QgcHJvdmlk
ZSBhIGd1YXJkLgogCSAqLwotCW11dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4
KTsKIAlpOTE1X2FkZHJlc3Nfc3BhY2VfaW5pdCgmZ2d0dC0+dm0sIFZNX0NMQVNTX0dHVFQpOwog
CiAJZ2d0dC0+dm0uaXNfZ2d0dCA9IHRydWU7CkBAIC0zNTMzLDcgKzM0NzUsNiBAQCBpbnQgaTkx
NV9nZ3R0X2luaXRfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCiAJaWYg
KCFIQVNfTExDKGRldl9wcml2KSAmJiAhSEFTX1BQR1RUKGRldl9wcml2KSkKIAkJZ2d0dC0+dm0u
bW0uY29sb3JfYWRqdXN0ID0gaTkxNV9ndHRfY29sb3JfYWRqdXN0OwotCW11dGV4X3VubG9jaygm
ZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJaWYgKCFpb19tYXBwaW5nX2luaXRfd2Mo
JmRldl9wcml2LT5nZ3R0LmlvbWFwLAogCQkJCWRldl9wcml2LT5nZ3R0LmdtYWRyLnN0YXJ0LApA
QCAtMzYxMiwxMCArMzU1Myw4IEBAIHZvaWQgaTkxNV9nZW1fcmVzdG9yZV9ndHRfbWFwcGluZ3Mo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQlpZiAoISh2bWEtPmZsYWdzICYg
STkxNV9WTUFfR0xPQkFMX0JJTkQpKQogCQkJY29udGludWU7CiAKLQkJbXV0ZXhfdW5sb2NrKCZn
Z3R0LT52bS5tdXRleCk7Ci0KIAkJaWYgKCFpOTE1X3ZtYV91bmJpbmQodm1hKSkKLQkJCWdvdG8g
bG9jazsKKwkJCWNvbnRpbnVlOwogCiAJCVdBUk5fT04oaTkxNV92bWFfYmluZCh2bWEsCiAJCQkJ
ICAgICAgb2JqID8gb2JqLT5jYWNoZV9sZXZlbCA6IDAsCkBAIC0zNjI1LDkgKzM1NjQsNiBAQCB2
b2lkIGk5MTVfZ2VtX3Jlc3RvcmVfZ3R0X21hcHBpbmdzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKIAkJCVdBUk5fT04oaTkxNV9nZW1fb2JqZWN0X3NldF90b19ndHRfZG9tYWlu
KG9iaiwgZmFsc2UpKTsKIAkJCWk5MTVfZ2VtX29iamVjdF91bmxvY2sob2JqKTsKIAkJfQotCi1s
b2NrOgotCQltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJfQogCiAJZ2d0dC0+dm0uY2xv
c2VkID0gZmFsc2U7CkBAIC00MDI0LDcgKzM5NjAsNyBAQCBpbnQgaTkxNV9nZW1fZ3R0X2luc2Vy
dChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAl1NjQgb2Zmc2V0OwogCWludCBlcnI7
CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJ
bG9ja2RlcF9hc3NlcnRfaGVsZCgmdm0tPm11dGV4KTsKIAlHRU1fQlVHX09OKCFzaXplKTsKIAlH
RU1fQlVHX09OKCFJU19BTElHTkVEKHNpemUsIEk5MTVfR1RUX1BBR0VfU0laRSkpOwogCUdFTV9C
VUdfT04oYWxpZ25tZW50ICYmICFpc19wb3dlcl9vZl8yKGFsaWdubWVudCkpOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmggYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbV9ndHQuaAppbmRleCA4ODljNGU4OGM1OTguLmQ5NTdmMWE1YjZhMyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmgKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmgKQEAgLTQzOCw4ICs0MzgsNiBAQCBzdHJ1Y3Qg
Z2VuNl9wcGd0dCB7CiAKIAl1bnNpZ25lZCBpbnQgcGluX2NvdW50OwogCWJvb2wgc2Nhbl9mb3Jf
dW51c2VkX3B0OwotCi0Jc3RydWN0IGdlbjZfcHBndHRfY2xlYW51cF93b3JrICp3b3JrOwogfTsK
IAogI2RlZmluZSBfX3RvX2dlbjZfcHBndHQoYmFzZSkgY29udGFpbmVyX29mKGJhc2UsIHN0cnVj
dCBnZW42X3BwZ3R0LCBiYXNlKQpAQCAtNjkyLDcgKzY5MCw2IEBAIGludCBpOTE1X2dlbV9ndHRf
aW5zZXJ0KHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogI2RlZmluZSBQSU5fT0ZGU0VU
X0JJQVMJCUJJVF9VTEwoNikKICNkZWZpbmUgUElOX09GRlNFVF9GSVhFRAlCSVRfVUxMKDcpCiAK
LSNkZWZpbmUgUElOX01CWgkJCUJJVF9VTEwoOCkgLyogSTkxNV9WTUFfUElOX09WRVJGTE9XICov
CiAjZGVmaW5lIFBJTl9HTE9CQUwJCUJJVF9VTEwoOSkgLyogSTkxNV9WTUFfR0xPQkFMX0JJTkQg
Ki8KICNkZWZpbmUgUElOX1VTRVIJCUJJVF9VTEwoMTApIC8qIEk5MTVfVk1BX0xPQ0FMX0JJTkQg
Ki8KICNkZWZpbmUgUElOX1VQREFURQkJQklUX1VMTCgxMSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJm
LmMKaW5kZXggZDkyZGRmYWRhMjYyLi44OTFiNjBmNDk4NDMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
cGVyZi5jCkBAIC0xMzQ3LDEzICsxMzQ3LDkgQEAgc3RhdGljIHZvaWQgb2FfcHV0X3JlbmRlcl9j
dHhfaWQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIHN0YXRpYyB2b2lkCiBmcmVl
X29hX2J1ZmZlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQltdXRleF9sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNl
KCZpOTE1LT5wZXJmLm9hLm9hX2J1ZmZlci52bWEsCiAJCQkJICAgSTkxNV9WTUFfUkVMRUFTRV9N
QVApOwogCi0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWk5MTUt
PnBlcmYub2Eub2FfYnVmZmVyLnZhZGRyID0gTlVMTDsKIH0KIApAQCAtMTUwNSwxOSArMTUwMSwx
MiBAQCBzdGF0aWMgaW50IGFsbG9jX29hX2J1ZmZlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCiAJaWYgKFdBUk5fT04oZGV2X3ByaXYtPnBlcmYub2Eub2FfYnVmZmVyLnZtYSkp
CiAJCXJldHVybiAtRU5PREVWOwogCi0JcmV0ID0gaTkxNV9tdXRleF9sb2NrX2ludGVycnVwdGli
bGUoJmRldl9wcml2LT5kcm0pOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KIAlCVUlMRF9C
VUdfT05fTk9UX1BPV0VSX09GXzIoT0FfQlVGRkVSX1NJWkUpOwogCUJVSUxEX0JVR19PTihPQV9C
VUZGRVJfU0laRSA8IFNaXzEyOEsgfHwgT0FfQlVGRkVSX1NJWkUgPiBTWl8xNk0pOwogCiAJYm8g
PSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtKGRldl9wcml2LCBPQV9CVUZGRVJfU0laRSk7
Ci0JaWYgKElTX0VSUihibykpIHsKLQkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gYWxsb2NhdGUgT0Eg
YnVmZmVyXG4iKTsKLQkJcmV0ID0gUFRSX0VSUihibyk7Ci0JCWdvdG8gdW5sb2NrOwotCX0KKwlp
ZiAoSVNfRVJSKGJvKSkKKwkJcmV0dXJuIFBUUl9FUlIoYm8pOwogCiAJaTkxNV9nZW1fb2JqZWN0
X3NldF9jYWNoZV9jb2hlcmVuY3koYm8sIEk5MTVfQ0FDSEVfTExDKTsKIApAQCAtMTUzOSw4ICsx
NTI4LDcgQEAgc3RhdGljIGludCBhbGxvY19vYV9idWZmZXIoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQogCURSTV9ERUJVR19EUklWRVIoIk9BIEJ1ZmZlciBpbml0aWFsaXplZCwg
Z3R0IG9mZnNldCA9IDB4JXgsIHZhZGRyID0gJXBcbiIsCiAJCQkgaTkxNV9nZ3R0X29mZnNldChk
ZXZfcHJpdi0+cGVyZi5vYS5vYV9idWZmZXIudm1hKSwKIAkJCSBkZXZfcHJpdi0+cGVyZi5vYS5v
YV9idWZmZXIudmFkZHIpOwotCi0JZ290byB1bmxvY2s7CisJcmV0dXJuIDA7CiAKIGVycl91bnBp
bjoKIAlfX2k5MTVfdm1hX3VucGluKHZtYSk7CkBAIC0xNTUxLDggKzE1MzksNiBAQCBzdGF0aWMg
aW50IGFsbG9jX29hX2J1ZmZlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJ
ZGV2X3ByaXYtPnBlcmYub2Eub2FfYnVmZmVyLnZhZGRyID0gTlVMTDsKIAlkZXZfcHJpdi0+cGVy
Zi5vYS5vYV9idWZmZXIudm1hID0gTlVMTDsKIAotdW5sb2NrOgotCW11dGV4X3VubG9jaygmZGV2
X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiByZXQ7CiB9CiAKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3ZtYS5jCmluZGV4IGI1ODc1ZGI2ZjJjMC4uYjA2ZTRmNWRiNmE4IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfdm1hLmMKQEAgLTMxOCw4ICszMTgsNiBAQCB2bWFfbG9va3VwKHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmosCiAgKiBPbmNlIGNyZWF0ZWQsIHRoZSBWTUEgaXMga2VwdCB1bnRp
bCBlaXRoZXIgdGhlIG9iamVjdCBpcyBmcmVlZCwgb3IgdGhlCiAgKiBhZGRyZXNzIHNwYWNlIGlz
IGNsb3NlZC4KICAqCi0gKiBNdXN0IGJlIGNhbGxlZCB3aXRoIHN0cnVjdF9tdXRleCBoZWxkLgot
ICoKICAqIFJldHVybnMgdGhlIHZtYSwgb3IgYW4gZXJyb3IgcG9pbnRlci4KICAqLwogc3RydWN0
IGk5MTVfdm1hICoKQEAgLTQ1OCw3ICs0NTYsOCBAQCB2b2lkIF9faW9tZW0gKmk5MTVfdm1hX3Bp
bl9pb21hcChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAkvKiBBY2Nlc3MgdGhyb3VnaCB0aGUgR1RU
IHJlcXVpcmVzIHRoZSBkZXZpY2UgdG8gYmUgYXdha2UuICovCiAJYXNzZXJ0X3JwbV93YWtlbG9j
a19oZWxkKHZtYS0+dm0tPmk5MTUpOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm1hLT52bS0+
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfbG9jaygmdm1hLT52bS0+bXV0ZXgpOwor
CiAJaWYgKFdBUk5fT04oIWk5MTVfdm1hX2lzX21hcF9hbmRfZmVuY2VhYmxlKHZtYSkpKSB7CiAJ
CWVyciA9IC1FTk9ERVY7CiAJCWdvdG8gZXJyOwpAQCAtNDgyLDE2ICs0ODEsMTkgQEAgdm9pZCBf
X2lvbWVtICppOTE1X3ZtYV9waW5faW9tYXAoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAKIAlfX2k5
MTVfdm1hX3Bpbih2bWEpOwogCi0JZXJyID0gaTkxNV92bWFfcGluX2ZlbmNlKHZtYSk7CisJZXJy
ID0gX19pOTE1X3ZtYV9waW5fZmVuY2Uodm1hKTsKIAlpZiAoZXJyKQogCQlnb3RvIGVycl91bnBp
bjsKIAogCWk5MTVfdm1hX3NldF9nZ3R0X3dyaXRlKHZtYSk7CisJbXV0ZXhfdW5sb2NrKCZ2bWEt
PnZtLT5tdXRleCk7CisKIAlyZXR1cm4gcHRyOwogCiBlcnJfdW5waW46CiAJX19pOTE1X3ZtYV91
bnBpbih2bWEpOwogZXJyOgorCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOwogCXJldHVy
biBJT19FUlJfUFRSKGVycik7CiB9CiAKQEAgLTUwNyw4ICs1MDksNiBAQCB2b2lkIGk5MTVfdm1h
X2ZsdXNoX3dyaXRlcyhzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAogdm9pZCBpOTE1X3ZtYV91bnBp
bl9pb21hcChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2
bWEtPnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCUdFTV9CVUdfT04odm1hLT5pb21h
cCA9PSBOVUxMKTsKIAogCWk5MTVfdm1hX2ZsdXNoX3dyaXRlcyh2bWEpOwpAQCAtNjg0LDEwICs2
ODQsNyBAQCBpOTE1X3ZtYV9pbnNlcnQoc3RydWN0IGk5MTVfdm1hICp2bWEsIHU2NCBzaXplLCB1
NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3MpCiAJfQogCiAJaWYgKHZtYS0+b2JqKSB7Ci0JCXJldCA9
IGk5MTVfZ2VtX29iamVjdF9waW5fcGFnZXNfYXN5bmModm1hLT5vYmopOwotCQlpZiAocmV0KQot
CQkJcmV0dXJuIHJldDsKLQorCQlfX2k5MTVfZ2VtX29iamVjdF9waW5fcGFnZXModm1hLT5vYmop
OwogCQljYWNoZV9sZXZlbCA9IHZtYS0+b2JqLT5jYWNoZV9sZXZlbDsKIAl9IGVsc2UgewogCQlj
YWNoZV9sZXZlbCA9IDA7CkBAIC03NTIsOSArNzQ5LDcgQEAgaTkxNV92bWFfaW5zZXJ0KHN0cnVj
dCBpOTE1X3ZtYSAqdm1hLCB1NjQgc2l6ZSwgdTY0IGFsaWdubWVudCwgdTY0IGZsYWdzKQogCUdF
TV9CVUdfT04oIWRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5ub2RlKSk7CiAJR0VNX0JVR19P
TighaTkxNV9nZW1fdmFsaWRfZ3R0X3NwYWNlKHZtYSwgY2FjaGVfbGV2ZWwpKTsKIAotCW11dGV4
X2xvY2soJnZtYS0+dm0tPm11dGV4KTsKIAlsaXN0X2FkZF90YWlsKCZ2bWEtPnZtX2xpbmssICZ2
bWEtPnZtLT5ib3VuZF9saXN0KTsKLQltdXRleF91bmxvY2soJnZtYS0+dm0tPm11dGV4KTsKIAog
CWlmICh2bWEtPm9iaikgewogCQlhdG9taWNfaW5jKCZ2bWEtPm9iai0+YmluZF9jb3VudCk7CkBA
IC03NzcsMTAgKzc3Miw4IEBAIGk5MTVfdm1hX3JlbW92ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkK
IAogCXZtYS0+b3BzLT5jbGVhcl9wYWdlcyh2bWEpOwogCi0JbXV0ZXhfbG9jaygmdm1hLT52bS0+
bXV0ZXgpOwogCWRybV9tbV9yZW1vdmVfbm9kZSgmdm1hLT5ub2RlKTsKIAlsaXN0X2RlbCgmdm1h
LT52bV9saW5rKTsKLQltdXRleF91bmxvY2soJnZtYS0+dm0tPm11dGV4KTsKIAogCS8qCiAJICog
U2luY2UgdGhlIHVuYm91bmQgbGlzdCBpcyBnbG9iYWwsIG9ubHkgbW92ZSB0byB0aGF0IGxpc3Qg
aWYKQEAgLTgwMSwyNSArNzk0LDIwIEBAIGk5MTVfdm1hX3JlbW92ZShzdHJ1Y3QgaTkxNV92bWEg
KnZtYSkKIAl9CiB9CiAKLWludCBfX2k5MTVfdm1hX2RvX3BpbihzdHJ1Y3QgaTkxNV92bWEgKnZt
YSwKLQkJICAgICAgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncykKK2ludCBfX2k5
MTVfdm1hX2RvX3BpbihzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1l
bnQsIHU2NCBmbGFncykKIHsKIAljb25zdCB1bnNpZ25lZCBpbnQgYm91bmQgPSB2bWEtPmZsYWdz
OwogCWludCByZXQ7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bWEtPnZtLT5pOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKLQlHRU1fQlVHX09OKChmbGFncyAmIChQSU5fR0xPQkFMIHwgUElOX1VT
RVIpKSA9PSAwKTsKLQlHRU1fQlVHX09OKChmbGFncyAmIFBJTl9HTE9CQUwpICYmICFpOTE1X3Zt
YV9pc19nZ3R0KHZtYSkpOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0tPm11dGV4KTsK
IAotCWlmIChXQVJOX09OKGJvdW5kICYgSTkxNV9WTUFfUElOX09WRVJGTE9XKSkgewotCQlyZXQg
PSAtRUJVU1k7Ci0JCWdvdG8gZXJyX3VucGluOwotCX0KKwlpZiAoYXRvbWljX3JlYWQoJnZtYS0+
cGluX2NvdW50KSkKKwkJZ290byBvdXQ7CiAKIAlpZiAoKGJvdW5kICYgSTkxNV9WTUFfQklORF9N
QVNLKSA9PSAwKSB7CiAJCXJldCA9IGk5MTVfdm1hX2luc2VydCh2bWEsIHNpemUsIGFsaWdubWVu
dCwgZmxhZ3MpOwogCQlpZiAocmV0KQotCQkJZ290byBlcnJfdW5waW47CisJCQlyZXR1cm4gcmV0
OwogCX0KIAlHRU1fQlVHX09OKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpOwog
CkBAIC04MzMsNiArODIxLDkgQEAgaW50IF9faTkxNV92bWFfZG9fcGluKHN0cnVjdCBpOTE1X3Zt
YSAqdm1hLAogCQlfX2k5MTVfdm1hX3NldF9tYXBfYW5kX2ZlbmNlYWJsZSh2bWEpOwogCiAJR0VN
X0JVR19PTihpOTE1X3ZtYV9taXNwbGFjZWQodm1hLCBzaXplLCBhbGlnbm1lbnQsIGZsYWdzKSk7
CisKK291dDoKKwlhdG9taWNfaW5jKCZ2bWEtPnBpbl9jb3VudCk7CiAJcmV0dXJuIDA7CiAKIGVy
cl9yZW1vdmU6CkBAIC04NDEsMTEgKzgzMiwzNCBAQCBpbnQgX19pOTE1X3ZtYV9kb19waW4oc3Ry
dWN0IGk5MTVfdm1hICp2bWEsCiAJCUdFTV9CVUdfT04odm1hLT5wYWdlcyk7CiAJCUdFTV9CVUdf
T04odm1hLT5mbGFncyAmIEk5MTVfVk1BX0JJTkRfTUFTSyk7CiAJfQotZXJyX3VucGluOgotCV9f
aTkxNV92bWFfdW5waW4odm1hKTsKIAlyZXR1cm4gcmV0OwogfQogCitpbnQgaTkxNV92bWFfZG9f
cGluKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1NjQgc2l6ZSwgdTY0IGFsaWdubWVudCwgdTY0IGZs
YWdzKQoreworCWludCBlcnI7CisKKwlHRU1fQlVHX09OKChmbGFncyAmIChQSU5fR0xPQkFMIHwg
UElOX1VTRVIpKSA9PSAwKTsKKwlHRU1fQlVHX09OKChmbGFncyAmIFBJTl9HTE9CQUwpICYmICFp
OTE1X3ZtYV9pc19nZ3R0KHZtYSkpOworCisJaWYgKHZtYS0+b2JqKSB7CisJCWVyciA9IGk5MTVf
Z2VtX29iamVjdF9waW5fcGFnZXNfYXN5bmModm1hLT5vYmopOworCQlpZiAoZXJyKQorCQkJcmV0
dXJuIGVycjsKKwl9CisKKwllcnIgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJnZtYS0+dm0t
Pm11dGV4KTsKKwlpZiAoIWVycikgeworCQllcnIgPSBfX2k5MTVfdm1hX2RvX3Bpbih2bWEsIHNp
emUsIGFsaWdubWVudCwgZmxhZ3MpOworCQltdXRleF91bmxvY2soJnZtYS0+dm0tPm11dGV4KTsK
Kwl9CisKKwlpZiAodm1hLT5vYmopCisJCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyh2bWEt
Pm9iaik7CisKKwlyZXR1cm4gZXJyOworfQorCiB2b2lkIGk5MTVfdm1hX2Nsb3NlKHN0cnVjdCBp
OTE1X3ZtYSAqdm1hKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdm1hLT52
bS0+aTkxNTsKQEAgLTg4NiwxMCArOTAwLDEwIEBAIHZvaWQgaTkxNV92bWFfcmVvcGVuKHN0cnVj
dCBpOTE1X3ZtYSAqdm1hKQogCiB2b2lkIGk5MTVfdm1hX2Rlc3Ryb3koc3RydWN0IGk5MTVfdm1h
ICp2bWEpCiB7Ci0JbXV0ZXhfbG9jaygmdm1hLT52bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
Ci0Jdm1hLT5mbGFncyAmPSB+STkxNV9WTUFfUElOX01BU0s7CisJbXV0ZXhfbG9jaygmdm1hLT52
bS0+bXV0ZXgpOworCWF0b21pY19zZXQoJnZtYS0+cGluX2NvdW50LCAwKTsKIAlXQVJOX09OKGk5
MTVfdm1hX3VuYmluZCh2bWEpKTsKLQltdXRleF91bmxvY2soJnZtYS0+dm0tPmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOworCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOwogCiAJaTkxNV92
bWFfcHV0KHZtYSk7CiB9CkBAIC05MjUsMTEgKzkzOSwxNSBAQCB2b2lkIGk5MTVfdm1hX3Bhcmtl
ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAogCXNwaW5fbG9ja19pcnEoJmk5MTUt
Pmd0LmNsb3NlZF9sb2NrKTsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUodm1hLCBuZXh0LCAm
aTkxNS0+Z3QuY2xvc2VkX3ZtYSwgY2xvc2VkX2xpbmspIHsKKwkJaTkxNV92bWFfZ2V0KHZtYSk7
CiAJCWxpc3RfZGVsX2luaXQoJnZtYS0+Y2xvc2VkX2xpbmspOwogCQlzcGluX3VubG9ja19pcnEo
Jmk5MTUtPmd0LmNsb3NlZF9sb2NrKTsKIAorCQltdXRleF9sb2NrKCZ2bWEtPnZtLT5tdXRleCk7
CiAJCWk5MTVfdm1hX3VuYmluZCh2bWEpOworCQltdXRleF91bmxvY2soJnZtYS0+dm0tPm11dGV4
KTsKIAorCQlpOTE1X3ZtYV9wdXQodm1hKTsKIAkJc3Bpbl9sb2NrX2lycSgmaTkxNS0+Z3QuY2xv
c2VkX2xvY2spOwogCX0KIAlzcGluX3VubG9ja19pcnEoJmk5MTUtPmd0LmNsb3NlZF9sb2NrKTsK
QEAgLTk1MSw3ICs5NjksOCBAQCB2b2lkIGk5MTVfdm1hX3Jldm9rZV9tbWFwKHN0cnVjdCBpOTE1
X3ZtYSAqdm1hKQogCXN0cnVjdCBkcm1fdm1hX29mZnNldF9ub2RlICpub2RlID0gJnZtYS0+b2Jq
LT5iYXNlLnZtYV9ub2RlOwogCXU2NCB2bWFfb2Zmc2V0OwogCi0JbG9ja2RlcF9hc3NlcnRfaGVs
ZCgmdm1hLT52bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbG9ja2RlcF9hc3NlcnRfaGVs
ZCgmdm1hLT52bS0+bXV0ZXgpOworCUdFTV9CVUdfT04oIWk5MTVfdm1hX2lzX2dndHQodm1hKSk7
CiAKIAlpZiAoIWk5MTVfdm1hX2hhc191c2VyZmF1bHQodm1hKSkKIAkJcmV0dXJuOwpAQCAtMTAz
NCw3ICsxMDUzLDcgQEAgaW50IGk5MTVfdm1hX3VuYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkK
IHsKIAlpbnQgcmV0OwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm1hLT52bS0+aTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm1hLT52bS0+bXV0ZXgpOwog
CiAJaWYgKHZtYS0+YXN5bmMuZG1hICYmCiAJICAgIGRtYV9mZW5jZV93YWl0X3RpbWVvdXQodm1h
LT5hc3luYy5kbWEsIHRydWUsCkBAIC0xMDY1LDkgKzEwODQsNyBAQCBpbnQgaTkxNV92bWFfdW5i
aW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCQlHRU1fQlVHX09OKGk5MTVfdm1hX2hhc19nZ3R0
X3dyaXRlKHZtYSkpOwogCiAJCS8qIHJlbGVhc2UgdGhlIGZlbmNlIHJlZyBfYWZ0ZXJfIGZsdXNo
aW5nICovCi0JCW11dGV4X2xvY2soJnZtYS0+dm0tPm11dGV4KTsKIAkJcmV0ID0gaTkxNV92bWFf
cmV2b2tlX2ZlbmNlKHZtYSk7Ci0JCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOwogCQlp
ZiAocmV0KQogCQkJcmV0dXJuIHJldDsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV92bWEuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmgKaW5kZXggZjlm
NGNiYjk5ZTYyLi4xNDBkMTJmNjdjZjggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfdm1hLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaApAQCAtNzEs
MzkgKzcxLDE1IEBAIHN0cnVjdCBpOTE1X3ZtYSB7CiAJdTMyIGZlbmNlX3NpemU7CiAJdTMyIGZl
bmNlX2FsaWdubWVudDsKIAorCWF0b21pY190IHBpbl9jb3VudDsKIAlhdG9taWNfdCBvcGVuX2Nv
dW50OwogCXVuc2lnbmVkIGxvbmcgZmxhZ3M7Ci0JLyoqCi0JICogSG93IG1hbnkgdXNlcnMgaGF2
ZSBwaW5uZWQgdGhpcyBvYmplY3QgaW4gR1RUIHNwYWNlLgotCSAqCi0JICogVGhpcyBpcyBhIHRp
Z2h0bHkgYm91bmQsIGZhaXJseSBzbWFsbCBudW1iZXIgb2YgdXNlcnMsIHNvIHdlCi0JICogc3R1
ZmYgaW5zaWRlIHRoZSBmbGFncyBmaWVsZCBzbyB0aGF0IHdlIGNhbiBib3RoIGNoZWNrIGZvciBv
dmVyZmxvdwotCSAqIGFuZCBkZXRlY3QgYSBuby1vcCBpOTE1X3ZtYV9waW4oKSBpbiBhIHNpbmds
ZSBjaGVjaywgd2hpbGUgYWxzbwotCSAqIHBpbm5pbmcgdGhlIHZtYS4KLQkgKgotCSAqIFRoZSB3
b3JzdCBjYXNlIGRpc3BsYXkgc2V0dXAgd291bGQgaGF2ZSB0aGUgc2FtZSB2bWEgcGlubmVkIGZv
cgotCSAqIHVzZSBvbiBlYWNoIHBsYW5lIG9uIGVhY2ggY3J0Yywgd2hpbGUgYWxzbyBidWlsZGlu
ZyB0aGUgbmV4dCBhdG9taWMKLQkgKiBzdGF0ZSBhbmQgaG9sZGluZyBhIHBpbiBmb3IgdGhlIGxl
bmd0aCBvZiB0aGUgY2xlYW51cCBxdWV1ZS4gSW4gdGhlCi0JICogZnV0dXJlLCB0aGUgZmxpcCBx
dWV1ZSBtYXkgYmUgaW5jcmVhc2VkIGZyb20gMS4KLQkgKiBFc3RpbWF0ZWQgd29yc3QgY2FzZTog
MyBbcWxlbl0gKiA0IFttYXggY3J0Y3NdICogNyBbbWF4IHBsYW5lc10gPSA4NAotCSAqCi0JICog
Rm9yIEdFTSwgdGhlIG51bWJlciBvZiBjb25jdXJyZW50IHVzZXJzIGZvciBwd3JpdGUvcHJlYWQg
aXMKLQkgKiB1bmJvdW5kZWQuIEZvciBleGVjYnVmZmVyLCBpdCBpcyBjdXJyZW50bHkgb25lIGJ1
dCB3aWxsIGluIGZ1dHVyZQotCSAqIGJlIGV4dGVuZGVkIHRvIGFsbG93IG11bHRpcGxlIGNsaWVu
dHMgdG8gcGluIHZtYSBjb25jdXJyZW50bHkuCi0JICoKLQkgKiBXZSBhbHNvIHVzZSBzdWJhbGxv
Y2F0ZWQgcGFnZXMsIHdpdGggZWFjaCBzdWJhbGxvY2F0aW9uIGNsYWltaW5nCi0JICogaXRzIG93
biBwaW4gb24gdGhlIHNoYXJlZCB2bWEuIEF0IHByZXNlbnQsIHRoaXMgaXMgbGltaXRlZCB0bwot
CSAqIGV4Y2x1c2l2ZSBjYWNoZWxpbmVzIG9mIGEgc2luZ2xlIHBhZ2UsIHNvIGEgbWF4aW11bSBv
ZiA2NCBwb3NzaWJsZQotCSAqIHVzZXJzLgotCSAqLwotI2RlZmluZSBJOTE1X1ZNQV9QSU5fTUFT
SyAweGZmCi0jZGVmaW5lIEk5MTVfVk1BX1BJTl9PVkVSRkxPVwlCSVQoOCkKIAogCS8qKiBGbGFn
cyBhbmQgYWRkcmVzcyBzcGFjZSB0aGlzIFZNQSBpcyBib3VuZCB0byAqLwogI2RlZmluZSBJOTE1
X1ZNQV9HTE9CQUxfQklORAlCSVQoOSkKICNkZWZpbmUgSTkxNV9WTUFfTE9DQUxfQklORAlCSVQo
MTApCi0jZGVmaW5lIEk5MTVfVk1BX0JJTkRfTUFTSyAoSTkxNV9WTUFfR0xPQkFMX0JJTkQgfCBJ
OTE1X1ZNQV9MT0NBTF9CSU5EIHwgSTkxNV9WTUFfUElOX09WRVJGTE9XKQotI2RlZmluZSBJOTE1
X1ZNQV9BTExPQ19CSU5ECUk5MTVfVk1BX1BJTl9PVkVSRkxPVyAvKiBub3Qgc3RvcmVkICovCisj
ZGVmaW5lIEk5MTVfVk1BX0JJTkRfTUFTSwkoSTkxNV9WTUFfR0xPQkFMX0JJTkQgfCBJOTE1X1ZN
QV9MT0NBTF9CSU5EKQorI2RlZmluZSBJOTE1X1ZNQV9BTExPQ19CSU5ECUJJVCgwKSAvKiBub3Qg
c3RvcmVkICovCiAKICNkZWZpbmUgSTkxNV9WTUFfR0dUVAkJQklUKDExKQogI2RlZmluZSBJOTE1
X1ZNQV9DQU5fRkVOQ0UJQklUKDEyKQpAQCAtMzI4LDMwICszMDQsMjcgQEAgc3RhdGljIGlubGlu
ZSB2b2lkIGk5MTVfdm1hX3VubG9jayhzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAlyZXNlcnZhdGlv
bl9vYmplY3RfdW5sb2NrKHZtYS0+cmVzdik7CiB9CiAKLWludCBfX2k5MTVfdm1hX2RvX3Bpbihz
dHJ1Y3QgaTkxNV92bWEgKnZtYSwKLQkJICAgICAgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2
NCBmbGFncyk7CitpbnQgX19pOTE1X3ZtYV9kb19waW4oc3RydWN0IGk5MTVfdm1hICp2bWEsIHU2
NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3MpOworaW50IGk5MTVfdm1hX2RvX3Bpbihz
dHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncyk7
CisKIHN0YXRpYyBpbmxpbmUgaW50IF9fbXVzdF9jaGVjawogaTkxNV92bWFfcGluKHN0cnVjdCBp
OTE1X3ZtYSAqdm1hLCB1NjQgc2l6ZSwgdTY0IGFsaWdubWVudCwgdTY0IGZsYWdzKQogewotCUJV
SUxEX0JVR19PTihQSU5fTUJaICE9IEk5MTVfVk1BX1BJTl9PVkVSRkxPVyk7CiAJQlVJTERfQlVH
X09OKFBJTl9HTE9CQUwgIT0gSTkxNV9WTUFfR0xPQkFMX0JJTkQpOwogCUJVSUxEX0JVR19PTihQ
SU5fVVNFUiAhPSBJOTE1X1ZNQV9MT0NBTF9CSU5EKTsKIAotCS8qIFBpbiBlYXJseSB0byBwcmV2
ZW50IHRoZSBzaHJpbmtlci9ldmljdGlvbiBsb2dpYyBmcm9tIGRlc3Ryb3lpbmcKLQkgKiBvdXIg
dm1hIGFzIHdlIGluc2VydCBhbmQgYmluZC4KLQkgKi8KLQlpZiAobGlrZWx5KCgoKyt2bWEtPmZs
YWdzIF4gZmxhZ3MpICYgSTkxNV9WTUFfQklORF9NQVNLKSA9PSAwKSkgeworCWlmIChhdG9taWNf
YWRkX3VubGVzcygmdm1hLT5waW5fY291bnQsIDEsIDApKSB7CiAJCUdFTV9CVUdfT04oIWRybV9t
bV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5ub2RlKSk7CiAJCUdFTV9CVUdfT04oaTkxNV92bWFfbWlz
cGxhY2VkKHZtYSwgc2l6ZSwgYWxpZ25tZW50LCBmbGFncykpOwogCQlyZXR1cm4gMDsKIAl9CiAK
LQlyZXR1cm4gX19pOTE1X3ZtYV9kb19waW4odm1hLCBzaXplLCBhbGlnbm1lbnQsIGZsYWdzKTsK
KwlyZXR1cm4gaTkxNV92bWFfZG9fcGluKHZtYSwgc2l6ZSwgYWxpZ25tZW50LCBmbGFncyk7CiB9
CiAKIHN0YXRpYyBpbmxpbmUgaW50IGk5MTVfdm1hX3Bpbl9jb3VudChjb25zdCBzdHJ1Y3QgaTkx
NV92bWEgKnZtYSkKIHsKLQlyZXR1cm4gdm1hLT5mbGFncyAmIEk5MTVfVk1BX1BJTl9NQVNLOwor
CXJldHVybiBhdG9taWNfcmVhZCgmdm1hLT5waW5fY291bnQpOwogfQogCiBzdGF0aWMgaW5saW5l
IGJvb2wgaTkxNV92bWFfaXNfcGlubmVkKGNvbnN0IHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQpAQCAt
MzYxLDE5ICszMzQsMTggQEAgc3RhdGljIGlubGluZSBib29sIGk5MTVfdm1hX2lzX3Bpbm5lZChj
b25zdCBzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAogc3RhdGljIGlubGluZSB2b2lkIF9faTkxNV92
bWFfcGluKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewotCXZtYS0+ZmxhZ3MrKzsKLQlHRU1fQlVH
X09OKHZtYS0+ZmxhZ3MgJiBJOTE1X1ZNQV9QSU5fT1ZFUkZMT1cpOworCWF0b21pY19pbmMoJnZt
YS0+cGluX2NvdW50KTsKIH0KIAogc3RhdGljIGlubGluZSB2b2lkIF9faTkxNV92bWFfdW5waW4o
c3RydWN0IGk5MTVfdm1hICp2bWEpCiB7Ci0Jdm1hLT5mbGFncy0tOworCWF0b21pY19kZWMoJnZt
YS0+cGluX2NvdW50KTsKIH0KIAogc3RhdGljIGlubGluZSB2b2lkIGk5MTVfdm1hX3VucGluKHN0
cnVjdCBpOTE1X3ZtYSAqdm1hKQogewotCUdFTV9CVUdfT04oIWk5MTVfdm1hX2lzX3Bpbm5lZCh2
bWEpKTsKIAlHRU1fQlVHX09OKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpOwor
CUdFTV9CVUdfT04oIWF0b21pY19yZWFkKCZ2bWEtPnBpbl9jb3VudCkpOwogCV9faTkxNV92bWFf
dW5waW4odm1hKTsKIH0KIApAQCAtMzkyLDggKzM2NCw2IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBp
OTE1X3ZtYV9pc19ib3VuZChjb25zdCBzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKICAqIHRoZSBjYWxs
ZXIgbXVzdCBjYWxsIGk5MTVfdm1hX3VucGluX2lvbWFwIHRvIHJlbGlucXVpc2ggdGhlIHBpbm5p
bmcKICAqIGFmdGVyIHRoZSBpb21hcHBpbmcgaXMgbm8gbG9uZ2VyIHJlcXVpcmVkLgogICoKLSAq
IENhbGxlcnMgbXVzdCBob2xkIHRoZSBzdHJ1Y3RfbXV0ZXguCi0gKgogICogUmV0dXJucyBhIHZh
bGlkIGlvbWFwcGVkIHBvaW50ZXIgb3IgRVJSX1BUUi4KICAqLwogdm9pZCBfX2lvbWVtICppOTE1
X3ZtYV9waW5faW9tYXAoc3RydWN0IGk5MTVfdm1hICp2bWEpOwpAQCAtNDA1LDggKzM3NSw4IEBA
IHZvaWQgX19pb21lbSAqaTkxNV92bWFfcGluX2lvbWFwKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKTsK
ICAqCiAgKiBVbnBpbnMgdGhlIHByZXZpb3VzbHkgaW9tYXBwZWQgVk1BIGZyb20gaTkxNV92bWFf
cGluX2lvbWFwKCkuCiAgKgotICogQ2FsbGVycyBtdXN0IGhvbGQgdGhlIHN0cnVjdF9tdXRleC4g
VGhpcyBmdW5jdGlvbiBpcyBvbmx5IHZhbGlkIHRvIGJlCi0gKiBjYWxsZWQgb24gYSBWTUEgcHJl
dmlvdXNseSBpb21hcHBlZCBieSB0aGUgY2FsbGVyIHdpdGggaTkxNV92bWFfcGluX2lvbWFwKCku
CisgKiBUaGlzIGZ1bmN0aW9uIGlzIG9ubHkgdmFsaWQgdG8gYmUgY2FsbGVkIG9uIGEgVk1BIHBy
ZXZpb3VzbHkgaW9tYXBwZWQKKyAqIGJ5IHRoZSBjYWxsZXIgd2l0aCBpOTE1X3ZtYV9waW5faW9t
YXAoKS4KICAqLwogdm9pZCBpOTE1X3ZtYV91bnBpbl9pb21hcChzdHJ1Y3QgaTkxNV92bWEgKnZt
YSk7CiAKQEAgLTQxNiw2ICszODYsOCBAQCBzdGF0aWMgaW5saW5lIHN0cnVjdCBwYWdlICppOTE1
X3ZtYV9maXJzdF9wYWdlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCXJldHVybiBzZ19wYWdlKHZt
YS0+cGFnZXMtPnNnbCk7CiB9CiAKK2ludCBfX2k5MTVfdm1hX3Bpbl9mZW5jZShzdHJ1Y3QgaTkx
NV92bWEgKnZtYSk7CisKIC8qKgogICogaTkxNV92bWFfcGluX2ZlbmNlIC0gcGluIGZlbmNpbmcg
c3RhdGUKICAqIEB2bWE6IHZtYSB0byBwaW4gZmVuY2luZyBmb3IKQEAgLTQ1MSw3ICs0MjMsNiBA
QCBzdGF0aWMgaW5saW5lIHZvaWQgX19pOTE1X3ZtYV91bnBpbl9mZW5jZShzdHJ1Y3QgaTkxNV92
bWEgKnZtYSkKIHN0YXRpYyBpbmxpbmUgdm9pZAogaTkxNV92bWFfdW5waW5fZmVuY2Uoc3RydWN0
IGk5MTVfdm1hICp2bWEpCiB7Ci0JLyogbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm1hLT52bS0+aTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7ICovCiAJaWYgKHZtYS0+ZmVuY2UpCiAJCV9faTkxNV92bWFf
dW5waW5fZmVuY2Uodm1hKTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2lu
dGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Rpc3BsYXkuYwppbmRl
eCBjM2Y0NGNiZGI4MTUuLjczOWM4ZGYzZjg5ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Rp
c3BsYXkuYwpAQCAtMjA5Myw4ICsyMDkzLDYgQEAgaW50ZWxfcGluX2FuZF9mZW5jZV9mYl9vYmoo
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCiAJdW5zaWduZWQgaW50IHBpbmN0bDsKIAl1MzIg
YWxpZ25tZW50OwogCi0JV0FSTl9PTighbXV0ZXhfaXNfbG9ja2VkKCZkZXYtPnN0cnVjdF9tdXRl
eCkpOwotCiAJYWxpZ25tZW50ID0gaW50ZWxfc3VyZl9hbGlnbm1lbnQoZmIsIDApOwogCiAJLyog
Tm90ZSB0aGF0IHRoZSB3L2EgYWxzbyByZXF1aXJlcyA2NCBQVEUgb2YgcGFkZGluZyBmb2xsb3dp
bmcgdGhlCkBAIC0yMTc1LDEzICsyMTczLDkgQEAgaW50ZWxfcGluX2FuZF9mZW5jZV9mYl9vYmoo
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCiAKIHZvaWQgaW50ZWxfdW5waW5fZmJfdm1hKHN0
cnVjdCBpOTE1X3ZtYSAqdm1hLCB1bnNpZ25lZCBsb25nIGZsYWdzKQogewotCWxvY2tkZXBfYXNz
ZXJ0X2hlbGQoJnZtYS0+dm0tPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCi0JaTkxNV9nZW1f
b2JqZWN0X2xvY2sodm1hLT5vYmopOwogCWlmIChmbGFncyAmIFBMQU5FX0hBU19GRU5DRSkKIAkJ
aTkxNV92bWFfdW5waW5fZmVuY2Uodm1hKTsKIAlpOTE1X2dlbV9vYmplY3RfdW5waW5fZnJvbV9k
aXNwbGF5X3BsYW5lKHZtYSk7Ci0JaTkxNV9nZW1fb2JqZWN0X3VubG9jayh2bWEtPm9iaik7CiAK
IAlpOTE1X3ZtYV9wdXQodm1hKTsKIH0KQEAgLTMwNDgsNyArMzA0Miw2IEBAIGluaXRpYWxfcGxh
bmVfdm1hKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCXN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmo7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJdTMyIGJhc2UsIHNpemU7
Ci0JaW50IGVycjsKIAogCWlmIChwbGFuZV9jb25maWctPnNpemUgPT0gMCkKIAkJcmV0dXJuIE5V
TEw7CkBAIC0zMDg5LDEyICszMDgyLDkgQEAgaW5pdGlhbF9wbGFuZV92bWEoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsCiAJaWYgKElTX0VSUih2bWEpKQogCQlyZXR1cm4gTlVMTDsKIAot
CW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWVyciA9IGk5MTVfdm1hX3Bp
bih2bWEsIDAsIDAsCi0JCQkgICBQSU5fR0xPQkFMIHwgUElOX01BUFBBQkxFIHwKLQkJCSAgIGJh
c2UgfCBQSU5fT0ZGU0VUX0ZJWEVEKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwotCWlmIChlcnIpCisJaWYgKGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsCisJCQkgUElO
X0dMT0JBTCB8IFBJTl9NQVBQQUJMRSB8CisJCQkgYmFzZSB8IFBJTl9PRkZTRVRfRklYRUQpKQog
CQlnb3RvIGVycl92bWE7CiAKIAlpZiAoaTkxNV9nZW1fb2JqZWN0X2lzX3RpbGVkKHZtYS0+b2Jq
KSAmJgpAQCAtMzI4MCwxNCArMzI3MCwxMiBAQCBpbnRlbF9maW5kX2luaXRpYWxfcGxhbmVfb2Jq
KHN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjLAogCWludGVsX3N0YXRlLT5jb2xvcl9wbGFu
ZVswXS5zdHJpZGUgPQogCQlpbnRlbF9mYl9waXRjaChmYiwgMCwgaW50ZWxfc3RhdGUtPmJhc2Uu
cm90YXRpb24pOwogCi0JbXV0ZXhfbG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogCWludGVsX3N0
YXRlLT52bWEgPSBpOTE1X3ZtYV9nZXQocGxhbmVfY29uZmlnLT52bWEpOwogCV9faTkxNV92bWFf
cGluKGludGVsX3N0YXRlLT52bWEpOwogCWlmIChpbnRlbF9wbGFuZV91c2VzX2ZlbmNlKGludGVs
X3N0YXRlKSAmJgogCSAgICBpOTE1X3ZtYV9waW5fZmVuY2UoaW50ZWxfc3RhdGUtPnZtYSkgPT0g
MCkKIAkJaW50ZWxfc3RhdGUtPmZsYWdzIHw9IFBMQU5FX0hBU19GRU5DRTsKLQl2bWEtPm9iai0+
cGluX2dsb2JhbCsrOwotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOworCWF0b21p
Y19pbmMoJnZtYS0+b2JqLT5waW5fZ2xvYmFsKTsKIAogCXBsYW5lX3N0YXRlLT5zcmNfeCA9IDA7
CiAJcGxhbmVfc3RhdGUtPnNyY195ID0gMDsKQEAgLTE0MjU1LDggKzE0MjQzLDYgQEAgc3RhdGlj
IHZvaWQgZmJfb2JqX2J1bXBfcmVuZGVyX3ByaW9yaXR5KHN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmopCiAgKiBiaXRzLiAgU29tZSBvbGRlciBwbGF0Zm9ybXMgbmVlZCBzcGVjaWFsIHBo
eXNpY2FsIGFkZHJlc3MgaGFuZGxpbmcgZm9yCiAgKiBjdXJzb3IgcGxhbmVzLgogICoKLSAqIE11
c3QgYmUgY2FsbGVkIHdpdGggc3RydWN0X211dGV4IGhlbGQuCi0gKgogICogUmV0dXJucyAwIG9u
IHN1Y2Nlc3MsIG5lZ2F0aXZlIGVycm9yIGNvZGUgb24gZmFpbHVyZS4KICAqLwogaW50CkBAIC0x
NDMxMywxNSArMTQyOTksOCBAQCBpbnRlbF9wcmVwYXJlX3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxh
bmUgKnBsYW5lLAogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlyZXQgPSBtdXRleF9sb2Nr
X2ludGVycnVwdGlibGUoJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAocmV0KSB7
Ci0JCWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmopOwotCQlyZXR1cm4gcmV0OwotCX0K
LQogCXJldCA9IGludGVsX3BsYW5lX3Bpbl9mYih0b19pbnRlbF9wbGFuZV9zdGF0ZShuZXdfc3Rh
dGUpKTsKIAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWk5
MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmopOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7
CkBAIC0xNDM3MCw4ICsxNDM0OSw2IEBAIGludGVsX3ByZXBhcmVfcGxhbmVfZmIoc3RydWN0IGRy
bV9wbGFuZSAqcGxhbmUsCiAgKiBAb2xkX3N0YXRlOiB0aGUgc3RhdGUgZnJvbSB0aGUgcHJldmlv
dXMgbW9kZXNldAogICoKICAqIENsZWFucyB1cCBhIGZyYW1lYnVmZmVyIHRoYXQgaGFzIGp1c3Qg
YmVlbiByZW1vdmVkIGZyb20gYSBwbGFuZS4KLSAqCi0gKiBNdXN0IGJlIGNhbGxlZCB3aXRoIHN0
cnVjdF9tdXRleCBoZWxkLgogICovCiB2b2lkCiBpbnRlbF9jbGVhbnVwX3BsYW5lX2ZiKHN0cnVj
dCBkcm1fcGxhbmUgKnBsYW5lLApAQCAtMTQzODcsOSArMTQzNjQsNyBAQCBpbnRlbF9jbGVhbnVw
X3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCX0KIAogCS8qIFNob3VsZCBvbmx5
IGJlIGNhbGxlZCBhZnRlciBhIHN1Y2Nlc3NmdWwgaW50ZWxfcHJlcGFyZV9wbGFuZV9mYigpISAq
LwotCW11dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIAlpbnRlbF9wbGFu
ZV91bnBpbl9mYih0b19pbnRlbF9wbGFuZV9zdGF0ZShvbGRfc3RhdGUpKTsKLQltdXRleF91bmxv
Y2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIH0KIAogaW50CkBAIC0xNDU5Myw3ICsx
NDU2OCw2IEBAIGludGVsX2xlZ2FjeV9jdXJzb3JfdXBkYXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBs
YW5lLAogCQkJICAgdTMyIHNyY193LCB1MzIgc3JjX2gsCiAJCQkgICBzdHJ1Y3QgZHJtX21vZGVz
ZXRfYWNxdWlyZV9jdHggKmN0eCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGNydGMtPmRldik7CiAJc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqb2xkX3Bs
YW5lX3N0YXRlLCAqbmV3X3BsYW5lX3N0YXRlOwogCXN0cnVjdCBpbnRlbF9wbGFuZSAqaW50ZWxf
cGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZSk7CiAJc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUgPQpAQCAtMTQ2NTksMTMgKzE0NjMzLDkgQEAgaW50ZWxfbGVnYWN5X2N1cnNv
cl91cGRhdGUoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJaWYgKHJldCkKIAkJZ290byBvdXRf
ZnJlZTsKIAotCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmZGV2X3ByaXYtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwotCWlmIChyZXQpCi0JCWdvdG8gb3V0X2ZyZWU7Ci0KIAlyZXQgPSBpbnRl
bF9wbGFuZV9waW5fZmIodG9faW50ZWxfcGxhbmVfc3RhdGUobmV3X3BsYW5lX3N0YXRlKSk7CiAJ
aWYgKHJldCkKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3RvIG91dF9mcmVlOwogCiAJaW50ZWxf
ZnJvbnRidWZmZXJfZmx1c2godG9faW50ZWxfZnJvbnRidWZmZXIoZmIpLCBPUklHSU5fRkxJUCk7
CiAJaW50ZWxfZnJvbnRidWZmZXJfdHJhY2sodG9faW50ZWxfZnJvbnRidWZmZXIob2xkX3BsYW5l
X3N0YXRlLT5mYiksCkBAIC0xNDY5NSw4ICsxNDY2NSw2IEBAIGludGVsX2xlZ2FjeV9jdXJzb3Jf
dXBkYXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCiAJaW50ZWxfcGxhbmVfdW5waW5fZmIo
dG9faW50ZWxfcGxhbmVfc3RhdGUob2xkX3BsYW5lX3N0YXRlKSk7CiAKLW91dF91bmxvY2s6Ci0J
bXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiBvdXRfZnJlZToKIAlp
ZiAobmV3X2NydGNfc3RhdGUpCiAJCWludGVsX2NydGNfZGVzdHJveV9zdGF0ZShjcnRjLCAmbmV3
X2NydGNfc3RhdGUtPmJhc2UpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfZmJkZXYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2ZiZGV2LmMKaW5kZXggYzdj
MTFkMTg0MmFmLi4xNDY0MTU3ZDBmZmUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2ludGVsX2ZiZGV2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZmJkZXYuYwpA
QCAtMjEyLDcgKzIxMiw2IEBAIHN0YXRpYyBpbnQgaW50ZWxmYl9jcmVhdGUoc3RydWN0IGRybV9m
Yl9oZWxwZXIgKmhlbHBlciwKIAkJc2l6ZXMtPmZiX2hlaWdodCA9IGludGVsX2ZiLT5iYXNlLmhl
aWdodDsKIAl9CiAKLQltdXRleF9sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CiAJd2FrZXJlZiA9
IGludGVsX3J1bnRpbWVfcG1fZ2V0KGRldl9wcml2KTsKIAogCS8qIFBpbiB0aGUgR0dUVCB2bWEg
Zm9yIG91ciBhY2Nlc3MgdmlhIGluZm8tPnNjcmVlbl9iYXNlLgpAQCAtMjczLDcgKzI3Miw2IEBA
IHN0YXRpYyBpbnQgaW50ZWxmYl9jcmVhdGUoc3RydWN0IGRybV9mYl9oZWxwZXIgKmhlbHBlciwK
IAlpZmJkZXYtPnZtYV9mbGFncyA9IGZsYWdzOwogCiAJaW50ZWxfcnVudGltZV9wbV9wdXQoZGV2
X3ByaXYsIHdha2VyZWYpOwotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogCXZn
YV9zd2l0Y2hlcm9vX2NsaWVudF9mYl9zZXQocGRldiwgaW5mbyk7CiAJcmV0dXJuIDA7CiAKQEAg
LTI4MSw3ICsyNzksNiBAQCBzdGF0aWMgaW50IGludGVsZmJfY3JlYXRlKHN0cnVjdCBkcm1fZmJf
aGVscGVyICpoZWxwZXIsCiAJaW50ZWxfdW5waW5fZmJfdm1hKHZtYSwgZmxhZ3MpOwogb3V0X3Vu
bG9jazoKIAlpbnRlbF9ydW50aW1lX3BtX3B1dChkZXZfcHJpdiwgd2FrZXJlZik7Ci0JbXV0ZXhf
dW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIHJldDsKIH0KIApAQCAtMjk4LDEx
ICsyOTUsOCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9mYmRldl9kZXN0cm95KHN0cnVjdCBpbnRlbF9m
YmRldiAqaWZiZGV2KQogCiAJZHJtX2ZiX2hlbHBlcl9maW5pKCZpZmJkZXYtPmhlbHBlcik7CiAK
LQlpZiAoaWZiZGV2LT52bWEpIHsKLQkJbXV0ZXhfbG9jaygmaWZiZGV2LT5oZWxwZXIuZGV2LT5z
dHJ1Y3RfbXV0ZXgpOworCWlmIChpZmJkZXYtPnZtYSkKIAkJaW50ZWxfdW5waW5fZmJfdm1hKGlm
YmRldi0+dm1hLCBpZmJkZXYtPnZtYV9mbGFncyk7Ci0JCW11dGV4X3VubG9jaygmaWZiZGV2LT5o
ZWxwZXIuZGV2LT5zdHJ1Y3RfbXV0ZXgpOwotCX0KIAogCWlmIChpZmJkZXYtPmZiKQogCQlkcm1f
ZnJhbWVidWZmZXJfcmVtb3ZlKCZpZmJkZXYtPmZiLT5iYXNlKTsKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
Z3VjLmMKaW5kZXggM2I0ZTc2ODZjZDZjLi4xODRkZTE4OTk1ZTcgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2ludGVsX2d1Yy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2lu
dGVsX2d1Yy5jCkBAIC02NzQsNiArNjc0LDcgQEAgc3RydWN0IGk5MTVfdm1hICppbnRlbF9ndWNf
YWxsb2NhdGVfdm1hKHN0cnVjdCBpbnRlbF9ndWMgKmd1YywgdTMyIHNpemUpCiAJCXJldHVybiB2
bWE7CiAKIAlmbGFncyA9IFBJTl9HTE9CQUwgfCBQSU5fT0ZGU0VUX0JJQVMgfCBpOTE1X2dndHRf
cGluX2JpYXModm1hKTsKKwogCXJldCA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIGZsYWdzKTsK
IAlpZiAocmV0KSB7CiAJCWk5MTVfdm1hX3B1dCh2bWEpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaW50ZWxfb3ZlcmxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
b3ZlcmxheS5jCmluZGV4IGNkYzAyODIyMDg0OC4uYjk2OWVlZjMzMzFiIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9vdmVybGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaW50ZWxfb3ZlcmxheS5jCkBAIC03NTIsNyArNzUyLDYgQEAgc3RhdGljIGludCBpbnRl
bF9vdmVybGF5X2RvX3B1dF9pbWFnZShzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3ZlcmxheSwKIAlz
dHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAlpbnQgcmV0LCB0bXBfd2lkdGg7CiAKLQlsb2NrZGVwX2Fz
c2VydF9oZWxkKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJV0FSTl9PTighZHJtX21v
ZGVzZXRfaXNfbG9ja2VkKCZkZXZfcHJpdi0+ZHJtLm1vZGVfY29uZmlnLmNvbm5lY3Rpb25fbXV0
ZXgpKTsKIAogCXJldCA9IGludGVsX292ZXJsYXlfcmVsZWFzZV9vbGRfdmlkKG92ZXJsYXkpOwpA
QCAtMTMwNCwyMiArMTMwMywxNiBAQCBzdGF0aWMgaW50IGdldF9yZWdpc3RlcnMoc3RydWN0IGlu
dGVsX292ZXJsYXkgKm92ZXJsYXksIGJvb2wgdXNlX3BoeXMpCiAJc3RydWN0IGk5MTVfdm1hICp2
bWE7CiAJaW50IGVycjsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwot
CiAJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zdG9sZW4oaTkxNSwgUEFHRV9TSVpFKTsK
IAlpZiAob2JqID09IE5VTEwpCiAJCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJu
YWwoaTkxNSwgUEFHRV9TSVpFKTsKLQlpZiAoSVNfRVJSKG9iaikpIHsKLQkJZXJyID0gUFRSX0VS
UihvYmopOwotCQlnb3RvIGVycl91bmxvY2s7Ci0JfQorCWlmIChJU19FUlIob2JqKSkKKwkJcmV0
dXJuIFBUUl9FUlIob2JqKTsKIAogCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihvYmos
IE5VTEwsIDAsIDAsIFBJTl9NQVBQQUJMRSk7CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwot
CWlmIChJU19FUlIodm1hKSkgewotCQllcnIgPSBQVFJfRVJSKHZtYSk7Ci0JCWdvdG8gZXJyX3Vu
bG9jazsKLQl9CisJaWYgKElTX0VSUih2bWEpKQorCQlyZXR1cm4gUFRSX0VSUih2bWEpOwogCiAJ
aWYgKHVzZV9waHlzKQogCQlvdmVybGF5LT5mbGlwX2FkZHIgPSBzZ19kbWFfYWRkcmVzcyh2bWEt
Pm9iai0+bW0ucGFnZXMtPnNnbCk7CkBAIC0xMzM0LDEzICsxMzI3LDEwIEBAIHN0YXRpYyBpbnQg
Z2V0X3JlZ2lzdGVycyhzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3ZlcmxheSwgYm9vbCB1c2VfcGh5
cykKIAl9CiAKIAlvdmVybGF5LT5yZWdfdm1hID0gdm1hOwotCW11dGV4X3VubG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIDA7CiAKIGVycl92bWE6CiAJaTkxNV92bWFfZGVz
dHJveSh2bWEpOwotZXJyX3VubG9jazoKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCXJldHVybiBlcnI7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3Rz
L2k5MTVfdm1hLmMKaW5kZXggMzBiODMxNDA4YjdiLi4zMzJlZTVjYjkxMjAgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5jCkBAIC0zMzgsNyArMzM4LDkgQEAgc3Rh
dGljIGludCBpZ3Rfdm1hX3BpbjEodm9pZCAqYXJnKQogCiAJCWlmICghZXJyKSB7CiAJCQlpOTE1
X3ZtYV91bnBpbih2bWEpOworCQkJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQkJZXJy
ID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CisJCQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4
KTsKIAkJCWlmIChlcnIpIHsKIAkJCQlwcl9lcnIoIkZhaWxlZCB0byB1bmJpbmQgc2luZ2xlIHBh
Z2UgZnJvbSBHR1RULCBlcnI9JWRcbiIsIGVycik7CiAJCQkJZ290byBvdXQ7Ci0tIAoyLjIwLjEK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdm
eCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xp
c3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

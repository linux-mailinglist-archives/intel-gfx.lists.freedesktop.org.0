Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3EE10D1ABC
	for <lists+intel-gfx@lfdr.de>; Wed,  9 Oct 2019 23:20:10 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 356616E896;
	Wed,  9 Oct 2019 21:20:08 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1CB526E953
 for <intel-gfx@lists.freedesktop.org>; Wed,  9 Oct 2019 21:20:01 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18783196-1500050 
 for multiple; Wed, 09 Oct 2019 22:19:52 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  9 Oct 2019 22:19:43 +0100
Message-Id: <20191009211947.6815-5-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191009211947.6815-1-chris@chris-wilson.co.uk>
References: <20191009211947.6815-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 5/9] drm/i915/perf: implement active wait for
 noa configurations
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwuY29tPgoK
Tk9BIGNvbmZpZ3VyYXRpb24gdGFrZSBzb21lIGFtb3VudCBvZiB0aW1lIHRvIGFwcGx5LiBUaGF0
IGFtb3VudCBvZgp0aW1lIGRlcGVuZHMgb24gdGhlIHNpemUgb2YgdGhlIEdULiBUaGVyZSBpcyBu
byBkb2N1bWVudGVkIHRpbWUgZm9yCnRoaXMuIEZvciBleGFtcGxlLCBwYXN0IGV4cGVyaW1lbnRh
dGlvbnMgd2l0aCBwb3dlcmdhdGluZwpjb25maWd1cmF0aW9uIGNoYW5nZXMgc2VlbSB0byBpbmRp
Y2F0ZSBhIDYwfjcwdXMgZGVsYXkuIFdlIGdvIHdpdGgKNTAwdXMgYXMgZGVmYXVsdCBmb3Igbm93
IHdoaWNoIHNob3VsZCBiZSBvdmVyIHRoZSByZXF1aXJlZCBhbW91bnQgb2YKdGltZSAoYWNjb3Jk
aW5nIHRvIEhXIGFyY2hpdGVjdHMpLgoKdjI6IERvbid0IGZvcmdldCB0byBzYXZlL3Jlc3RvcmUg
cmVnaXN0ZXJzIHVzZWQgZm9yIHRoZSB3YWl0IChDaHJpcykKCnYzOiBOYW1lIHVzZWQgQ1NfR1BS
IHJlZ2lzdGVycyAoQ2hyaXMpCiAgICBGaXggY29tcGlsZSBpc3N1ZSBkdWUgdG8gcmViYXNlIChM
aW9uZWwpCgp2NDogRml4IHNhdmUvcmVzdG9yZSBoZWxwZXJzIChVbWVzaCkKCnY1OiBNb3ZlIG5v
YV93YWl0IGZyb20gZHJtX2k5MTVfcHJpdmF0ZSB0byBpOTE1X3BlcmZfc3RyZWFtIChMaW9uZWwp
Cgp2NjogQWRkIG1pc3Npbmcgc3RydWN0IGRlY2xhcmF0aW9ucyBpbiBpOTE1X3BlcmYuaAoKU2ln
bmVkLW9mZi1ieTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwu
Y29tPgpSZXZpZXdlZC1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+
ICh2NCkKLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMuaCAg
fCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmggICAgICB8
ICAgNSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyAgICAgICAgICAgfCAg
MzIgKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyAgICAgICAgICAgICAgfCAy
MjMgKysrKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmZfdHlw
ZXMuaCAgICAgICAgfCAgIDggKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaCAgICAg
ICAgICAgICAgIHwgICA0ICstCiAuLi4vZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxm
dGVzdHMuaCAgfCAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcGVy
Zi5jICAgIHwgMjE3ICsrKysrKysrKysrKysrKysrCiA4IGZpbGVzIGNoYW5nZWQsIDQ5MiBpbnNl
cnRpb25zKCspLCAyIGRlbGV0aW9ucygtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3BlcmYuYwoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZ3B1X2NvbW1hbmRzLmgKaW5kZXggMDk4NzEwMGM3ODZiLi44ZTYzY2ZmY2FiZTAg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5o
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5oCkBAIC0x
NjMsNyArMTYzLDggQEAKICNkZWZpbmUgTUlfQkFUQ0hfQlVGRkVSX1NUQVJUCU1JX0lOU1RSKDB4
MzEsIDApCiAjZGVmaW5lICAgTUlfQkFUQ0hfR1RUCQkgICAgKDI8PDYpIC8qIGFsaWFzZWQgd2l0
aCAoMTw8Nykgb24gZ2VuNCAqLwogI2RlZmluZSBNSV9CQVRDSF9CVUZGRVJfU1RBUlRfR0VOOAlN
SV9JTlNUUigweDMxLCAxKQotI2RlZmluZSAgIE1JX0JBVENIX1JFU09VUkNFX1NUUkVBTUVSICgx
PDwxMCkKKyNkZWZpbmUgICBNSV9CQVRDSF9SRVNPVVJDRV9TVFJFQU1FUiBSRUdfQklUKDEwKQor
I2RlZmluZSAgIE1JX0JBVENIX1BSRURJQ0FURSAgICAgICAgIFJFR19CSVQoMTUpIC8qIEhTVysg
b24gUkNTIG9ubHkqLwogCiAvKgogICogM0QgaW5zdHJ1Y3Rpb25zIHVzZWQgYnkgdGhlIGtlcm5l
bApAQCAtMjI0LDYgKzIyNSw3IEBACiAjZGVmaW5lICAgUElQRV9DT05UUk9MX0NTX1NUQUxMCQkJ
CSgxPDwyMCkKICNkZWZpbmUgICBQSVBFX0NPTlRST0xfVExCX0lOVkFMSURBVEUJCQkoMTw8MTgp
CiAjZGVmaW5lICAgUElQRV9DT05UUk9MX01FRElBX1NUQVRFX0NMRUFSCQkoMTw8MTYpCisjZGVm
aW5lICAgUElQRV9DT05UUk9MX1dSSVRFX1RJTUVTVEFNUAkJCSgzPDwxNCkKICNkZWZpbmUgICBQ
SVBFX0NPTlRST0xfUVdfV1JJVEUJCQkJKDE8PDE0KQogI2RlZmluZSAgIFBJUEVfQ09OVFJPTF9Q
T1NUX1NZTkNfT1BfTUFTSyAgICAgICAgICAgICAgICAoMzw8MTQpCiAjZGVmaW5lICAgUElQRV9D
T05UUk9MX0RFUFRIX1NUQUxMCQkJKDE8PDEzKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2d0X3R5cGVzLmgKaW5kZXggODAyZjUxNmEzNDMwLi5iZTRiMjYzNjIxYzggMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmgKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaApAQCAtMTA5LDYgKzEwOSwxMSBAQCBlbnVt
IGludGVsX2d0X3NjcmF0Y2hfZmllbGQgewogCS8qIDggYnl0ZXMgKi8KIAlJTlRFTF9HVF9TQ1JB
VENIX0ZJRUxEX0NPSEVSRU5UTDNfV0EgPSAyNTYsCiAKKwkvKiA2ICogOCBieXRlcyAqLworCUlO
VEVMX0dUX1NDUkFUQ0hfRklFTERfUEVSRl9DU19HUFIgPSAyMDQ4LAorCisJLyogNCBieXRlcyAq
LworCUlOVEVMX0dUX1NDUkFUQ0hfRklFTERfUEVSRl9QUkVESUNBVEVfUkVTVUxUXzEgPSAyMDk2
LAogfTsKIAogI2VuZGlmIC8qIF9fSU5URUxfR1RfVFlQRVNfSF9fICovCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZGVidWdmcy5jCmluZGV4IDI3N2YzMTI5N2YyOS4uZDQ2M2EyOGI3NDc1IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwpAQCAtMzU5MCw2ICszNTkwLDM3IEBAIERFRklORV9T
SU1QTEVfQVRUUklCVVRFKGk5MTVfd2VkZ2VkX2ZvcHMsCiAJCQlpOTE1X3dlZGdlZF9nZXQsIGk5
MTVfd2VkZ2VkX3NldCwKIAkJCSIlbGx1XG4iKTsKIAorc3RhdGljIGludAoraTkxNV9wZXJmX25v
YV9kZWxheV9zZXQodm9pZCAqZGF0YSwgdTY0IHZhbCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IGRhdGE7CisJY29uc3QgdTMyIGNsayA9IFJVTlRJTUVfSU5GTyhpOTE1KS0+
Y3NfdGltZXN0YW1wX2ZyZXF1ZW5jeV9raHo7CisKKwkvKgorCSAqIFRoaXMgd291bGQgbGVhZCB0
byBpbmZpbml0ZSB3YWl0cyBhcyB3ZSdyZSBkb2luZyB0aW1lc3RhbXAKKwkgKiBkaWZmZXJlbmNl
IG9uIHRoZSBDUyB3aXRoIG9ubHkgMzJiaXRzLgorCSAqLworCWlmICh2YWwgPiBtdWxfdTMyX3Uz
MihVMzJfTUFYLCBjbGspKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWF0b21pYzY0X3NldCgmaTkx
NS0+cGVyZi5ub2FfcHJvZ3JhbW1pbmdfZGVsYXksIHZhbCk7CisJcmV0dXJuIDA7Cit9CisKK3N0
YXRpYyBpbnQKK2k5MTVfcGVyZl9ub2FfZGVsYXlfZ2V0KHZvaWQgKmRhdGEsIHU2NCAqdmFsKQor
eworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZGF0YTsKKworCSp2YWwgPSBhdG9t
aWM2NF9yZWFkKCZpOTE1LT5wZXJmLm5vYV9wcm9ncmFtbWluZ19kZWxheSk7CisJcmV0dXJuIDA7
Cit9CisKK0RFRklORV9TSU1QTEVfQVRUUklCVVRFKGk5MTVfcGVyZl9ub2FfZGVsYXlfZm9wcywK
KwkJCWk5MTVfcGVyZl9ub2FfZGVsYXlfZ2V0LAorCQkJaTkxNV9wZXJmX25vYV9kZWxheV9zZXQs
CisJCQkiJWxsdVxuIik7CisKICNkZWZpbmUgRFJPUF9VTkJPVU5ECUJJVCgwKQogI2RlZmluZSBE
Uk9QX0JPVU5ECUJJVCgxKQogI2RlZmluZSBEUk9QX1JFVElSRQlCSVQoMikKQEAgLTQzNDAsNiAr
NDM3MSw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaTkxNV9kZWJ1Z2ZzX2ZpbGVzIHsKIAljb25z
dCBjaGFyICpuYW1lOwogCWNvbnN0IHN0cnVjdCBmaWxlX29wZXJhdGlvbnMgKmZvcHM7CiB9IGk5
MTVfZGVidWdmc19maWxlc1tdID0geworCXsiaTkxNV9wZXJmX25vYV9kZWxheSIsICZpOTE1X3Bl
cmZfbm9hX2RlbGF5X2ZvcHN9LAogCXsiaTkxNV93ZWRnZWQiLCAmaTkxNV93ZWRnZWRfZm9wc30s
CiAJeyJpOTE1X2NhY2hlX3NoYXJpbmciLCAmaTkxNV9jYWNoZV9zaGFyaW5nX2ZvcHN9LAogCXsi
aTkxNV9nZW1fZHJvcF9jYWNoZXMiLCAmaTkxNV9kcm9wX2NhY2hlc19mb3BzfSwKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9wZXJmLmMKaW5kZXggZDc5ZGExNjdiNmYwLi42YmMzZmQzN2EyZWMgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfcGVyZi5jCkBAIC0xOTgsNiArMTk4LDcgQEAKICNpbmNsdWRlICJnZW0vaTkx
NV9nZW1fY29udGV4dC5oIgogI2luY2x1ZGUgImdlbS9pOTE1X2dlbV9wbS5oIgogI2luY2x1ZGUg
Imd0L2ludGVsX2VuZ2luZV91c2VyLmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfZ3QuaCIKICNpbmNs
dWRlICJndC9pbnRlbF9scmNfcmVnLmgiCiAKICNpbmNsdWRlICJpOTE1X2Rydi5oIgpAQCAtMTMz
Nyw2ICsxMzM4LDEyIEBAIGZyZWVfb2FfYnVmZmVyKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpz
dHJlYW0pCiAJc3RyZWFtLT5vYV9idWZmZXIudmFkZHIgPSBOVUxMOwogfQogCitzdGF0aWMgdm9p
ZAorZnJlZV9ub2Ffd2FpdChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQoreworCWk5
MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZzdHJlYW0tPm5vYV93YWl0LCAwKTsKK30KKwogc3Rh
dGljIHZvaWQKIGZyZWVfb2FfY29uZmlncyhzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFt
KQogewpAQCAtMTM2OSw2ICsxMzc2LDcgQEAgc3RhdGljIHZvaWQgaTkxNV9vYV9zdHJlYW1fZGVz
dHJveShzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogCQlvYV9wdXRfcmVuZGVyX2N0
eF9pZChzdHJlYW0pOwogCiAJZnJlZV9vYV9jb25maWdzKHN0cmVhbSk7CisJZnJlZV9ub2Ffd2Fp
dChzdHJlYW0pOwogCiAJaWYgKHBlcmYtPnNwdXJpb3VzX3JlcG9ydF9ycy5taXNzZWQpIHsKIAkJ
RFJNX05PVEUoIiVkIHNwdXJpb3VzIE9BIHJlcG9ydCBub3RpY2VzIHN1cHByZXNzZWQgZHVlIHRv
IHJhdGVsaW1pdGluZ1xuIiwKQEAgLTE1MjksNiArMTUzNywyMDUgQEAgc3RhdGljIGludCBhbGxv
Y19vYV9idWZmZXIoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIAlyZXR1cm4gcmV0
OwogfQogCitzdGF0aWMgdTMyICpzYXZlX3Jlc3RvcmVfcmVnaXN0ZXIoc3RydWN0IGk5MTVfcGVy
Zl9zdHJlYW0gKnN0cmVhbSwgdTMyICpjcywKKwkJCQkgIGJvb2wgc2F2ZSwgaTkxNV9yZWdfdCBy
ZWcsIHUzMiBvZmZzZXQsCisJCQkJICB1MzIgZHdvcmRfY291bnQpCit7CisJdTMyIGNtZDsKKwl1
MzIgZDsKKworCWNtZCA9IHNhdmUgPyBNSV9TVE9SRV9SRUdJU1RFUl9NRU0gOiBNSV9MT0FEX1JF
R0lTVEVSX01FTTsKKwlpZiAoSU5URUxfR0VOKHN0cmVhbS0+cGVyZi0+aTkxNSkgPj0gOCkKKwkJ
Y21kKys7CisKKwlmb3IgKGQgPSAwOyBkIDwgZHdvcmRfY291bnQ7IGQrKykgeworCQkqY3MrKyA9
IGNtZDsKKwkJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChyZWcpICsgNCAqIGQ7CisJCSpj
cysrID0gaW50ZWxfZ3Rfc2NyYXRjaF9vZmZzZXQoc3RyZWFtLT5ndCwgb2Zmc2V0KSArIDQgKiBk
OworCQkqY3MrKyA9IDA7CisJfQorCisJcmV0dXJuIGNzOworfQorCitzdGF0aWMgaW50IGFsbG9j
X25vYV93YWl0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCit7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBzdHJlYW0tPnBlcmYtPmk5MTU7CisJc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKmJvOworCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOworCWNvbnN0IHU2NCBk
ZWxheV90aWNrcyA9IDB4ZmZmZmZmZmZmZmZmZmZmZiAtCisJCURJVjY0X1U2NF9ST1VORF9VUCgK
KwkJCWF0b21pYzY0X3JlYWQoJnN0cmVhbS0+cGVyZi0+bm9hX3Byb2dyYW1taW5nX2RlbGF5KSAq
CisJCQlSVU5USU1FX0lORk8oaTkxNSktPmNzX3RpbWVzdGFtcF9mcmVxdWVuY3lfa2h6LAorCQkJ
MTAwMDAwMHVsbCk7CisJY29uc3QgdTMyIGJhc2UgPSBzdHJlYW0tPmVuZ2luZS0+bW1pb19iYXNl
OworI2RlZmluZSBDU19HUFIoeCkgR0VOOF9SSU5HX0NTX0dQUihiYXNlLCB4KQorCXUzMiAqYmF0
Y2gsICp0czAsICpjcywgKmp1bXA7CisJaW50IHJldCwgaTsKKwllbnVtIHsKKwkJU1RBUlRfVFMs
CisJCU5PV19UUywKKwkJREVMVEFfVFMsCisJCUpVTVBfUFJFRElDQVRFLAorCQlERUxUQV9UQVJH
RVQsCisJCU5fQ1NfR1BSCisJfTsKKworCWJvID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRl
cm5hbChpOTE1LCA0MDk2KTsKKwlpZiAoSVNfRVJSKGJvKSkgeworCQlEUk1fRVJST1IoIkZhaWxl
ZCB0byBhbGxvY2F0ZSBOT0Egd2FpdCBiYXRjaGJ1ZmZlclxuIik7CisJCXJldHVybiBQVFJfRVJS
KGJvKTsKKwl9CisKKwkvKgorCSAqIFdlIHBpbiBpbiBHR1RUIGJlY2F1c2Ugd2UganVtcCBpbnRv
IHRoaXMgYnVmZmVyIG5vdyBiZWNhdXNlCisJICogbXVsdGlwbGUgT0EgY29uZmlnIEJPcyB3aWxs
IGhhdmUgYSBqdW1wIHRvIHRoaXMgYWRkcmVzcyBhbmQgaXQKKwkgKiBuZWVkcyB0byBiZSBmaXhl
ZCBkdXJpbmcgdGhlIGxpZmV0aW1lIG9mIHRoZSBpOTE1L3BlcmYgc3RyZWFtLgorCSAqLworCXZt
YSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihibywgTlVMTCwgMCwgMCwgUElOX0hJR0gpOwor
CWlmIChJU19FUlIodm1hKSkgeworCQlyZXQgPSBQVFJfRVJSKHZtYSk7CisJCWdvdG8gZXJyX3Vu
cmVmOworCX0KKworCWJhdGNoID0gY3MgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChibywgSTkx
NV9NQVBfV0IpOworCWlmIChJU19FUlIoYmF0Y2gpKSB7CisJCXJldCA9IFBUUl9FUlIoYmF0Y2gp
OworCQlnb3RvIGVycl91bnBpbjsKKwl9CisKKwkvKiBTYXZlIHJlZ2lzdGVycy4gKi8KKwlmb3Ig
KGkgPSAwOyBpIDwgTl9DU19HUFI7IGkrKykKKwkJY3MgPSBzYXZlX3Jlc3RvcmVfcmVnaXN0ZXIo
CisJCQlzdHJlYW0sIGNzLCB0cnVlIC8qIHNhdmUgKi8sIENTX0dQUihpKSwKKwkJCUlOVEVMX0dU
X1NDUkFUQ0hfRklFTERfUEVSRl9DU19HUFIgKyA4ICogaSwgMik7CisJY3MgPSBzYXZlX3Jlc3Rv
cmVfcmVnaXN0ZXIoCisJCXN0cmVhbSwgY3MsIHRydWUgLyogc2F2ZSAqLywgTUlfUFJFRElDQVRF
X1JFU1VMVF8xLAorCQlJTlRFTF9HVF9TQ1JBVENIX0ZJRUxEX1BFUkZfUFJFRElDQVRFX1JFU1VM
VF8xLCAxKTsKKworCS8qIEZpcnN0IHRpbWVzdGFtcCBzbmFwc2hvdCBsb2NhdGlvbi4gKi8KKwl0
czAgPSBjczsKKworCS8qCisJICogSW5pdGlhbCBzbmFwc2hvdCBvZiB0aGUgdGltZXN0YW1wIHJl
Z2lzdGVyIHRvIGltcGxlbWVudCB0aGUgd2FpdC4KKwkgKiBXZSB3b3JrIHdpdGggMzJiIHZhbHVl
cywgc28gY2xlYXIgb3V0IHRoZSB0b3AgMzJiIGJpdHMgb2YgdGhlCisJICogcmVnaXN0ZXIgYmVj
YXVzZSB0aGUgQUxVIHdvcmtzIDY0Yml0cy4KKwkgKi8KKwkqY3MrKyA9IE1JX0xPQURfUkVHSVNU
RVJfSU1NKDEpOworCSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQoQ1NfR1BSKFNUQVJUX1RT
KSkgKyA0OworCSpjcysrID0gMDsKKwkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJfUkVHIHwgKDMg
LSAyKTsKKwkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KFJJTkdfVElNRVNUQU1QKGJhc2Up
KTsKKwkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KENTX0dQUihTVEFSVF9UUykpOworCisJ
LyoKKwkgKiBUaGlzIGlzIHRoZSBsb2NhdGlvbiB3ZSdyZSBnb2luZyB0byBqdW1wIGJhY2sgaW50
byB1bnRpbCB0aGUKKwkgKiByZXF1aXJlZCBhbW91bnQgb2YgdGltZSBoYXMgcGFzc2VkLgorCSAq
LworCWp1bXAgPSBjczsKKworCS8qCisJICogVGFrZSBhbm90aGVyIHNuYXBzaG90IG9mIHRoZSB0
aW1lc3RhbXAgcmVnaXN0ZXIuIFRha2UgY2FyZSB0byBjbGVhcgorCSAqIHVwIHRoZSB0b3AgMzJi
aXRzIG9mIENTX0dQUigxKSBhcyB3ZSdyZSB1c2luZyBpdCBmb3Igb3RoZXIKKwkgKiBvcGVyYXRp
b25zIGJlbG93LgorCSAqLworCSpjcysrID0gTUlfTE9BRF9SRUdJU1RFUl9JTU0oMSk7CisJKmNz
KysgPSBpOTE1X21taW9fcmVnX29mZnNldChDU19HUFIoTk9XX1RTKSkgKyA0OworCSpjcysrID0g
MDsKKwkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJfUkVHIHwgKDMgLSAyKTsKKwkqY3MrKyA9IGk5
MTVfbW1pb19yZWdfb2Zmc2V0KFJJTkdfVElNRVNUQU1QKGJhc2UpKTsKKwkqY3MrKyA9IGk5MTVf
bW1pb19yZWdfb2Zmc2V0KENTX0dQUihOT1dfVFMpKTsKKworCS8qCisJICogRG8gYSBkaWZmIGJl
dHdlZW4gdGhlIDIgdGltZXN0YW1wcyBhbmQgc3RvcmUgdGhlIHJlc3VsdCBiYWNrIGludG8KKwkg
KiBDU19HUFIoMSkuCisJICovCisJKmNzKysgPSBNSV9NQVRIKDUpOworCSpjcysrID0gTUlfTUFU
SF9MT0FEKE1JX01BVEhfUkVHX1NSQ0EsIE1JX01BVEhfUkVHKE5PV19UUykpOworCSpjcysrID0g
TUlfTUFUSF9MT0FEKE1JX01BVEhfUkVHX1NSQ0IsIE1JX01BVEhfUkVHKFNUQVJUX1RTKSk7CisJ
KmNzKysgPSBNSV9NQVRIX1NVQjsKKwkqY3MrKyA9IE1JX01BVEhfU1RPUkUoTUlfTUFUSF9SRUco
REVMVEFfVFMpLCBNSV9NQVRIX1JFR19BQ0NVKTsKKwkqY3MrKyA9IE1JX01BVEhfU1RPUkUoTUlf
TUFUSF9SRUcoSlVNUF9QUkVESUNBVEUpLCBNSV9NQVRIX1JFR19DRik7CisKKwkvKgorCSAqIFRy
YW5zZmVyIHRoZSBjYXJyeSBmbGFnIChzZXQgdG8gMSBpZiB0czEgPCB0czAsIG1lYW5pbmcgdGhl
CisJICogdGltZXN0YW1wIGhhdmUgcm9sbGVkIG92ZXIgdGhlIDMyYml0cykgaW50byB0aGUgcHJl
ZGljYXRlIHJlZ2lzdGVyCisJICogdG8gYmUgdXNlZCBmb3IgdGhlIHByZWRpY2F0ZWQganVtcC4K
KwkgKi8KKwkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJfUkVHIHwgKDMgLSAyKTsKKwkqY3MrKyA9
IGk5MTVfbW1pb19yZWdfb2Zmc2V0KENTX0dQUihKVU1QX1BSRURJQ0FURSkpOworCSpjcysrID0g
aTkxNV9tbWlvX3JlZ19vZmZzZXQoTUlfUFJFRElDQVRFX1JFU1VMVF8xKTsKKworCS8qIFJlc3Rh
cnQgZnJvbSB0aGUgYmVnaW5uaW5nIGlmIHdlIGhhZCB0aW1lc3RhbXBzIHJvbGwgb3Zlci4gKi8K
KwkqY3MrKyA9IChJTlRFTF9HRU4oaTkxNSkgPCA4ID8KKwkJIE1JX0JBVENIX0JVRkZFUl9TVEFS
VCA6CisJCSBNSV9CQVRDSF9CVUZGRVJfU1RBUlRfR0VOOCkgfAorCQlNSV9CQVRDSF9QUkVESUNB
VEU7CisJKmNzKysgPSBpOTE1X2dndHRfb2Zmc2V0KHZtYSkgKyAodHMwIC0gYmF0Y2gpICogNDsK
KwkqY3MrKyA9IDA7CisKKwkvKgorCSAqIE5vdyBhZGQgdGhlIGRpZmYgYmV0d2VlbiB0byBwcmV2
aW91cyB0aW1lc3RhbXBzIGFuZCBhZGQgaXQgdG8gOgorCSAqICAgICAgKCgoMSAqIDw8IDY0KSAt
IDEpIC0gZGVsYXlfbnMpCisJICoKKwkgKiBXaGVuIHRoZSBDYXJyeSBGbGFnIGNvbnRhaW5zIDEg
dGhpcyBtZWFucyB0aGUgZWxhcHNlZCB0aW1lIGlzCisJICogbG9uZ2VyIHRoYW4gdGhlIGV4cGVj
dGVkIGRlbGF5LCBhbmQgd2UgY2FuIGV4aXQgdGhlIHdhaXQgbG9vcC4KKwkgKi8KKwkqY3MrKyA9
IE1JX0xPQURfUkVHSVNURVJfSU1NKDIpOworCSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQo
Q1NfR1BSKERFTFRBX1RBUkdFVCkpOworCSpjcysrID0gbG93ZXJfMzJfYml0cyhkZWxheV90aWNr
cyk7CisJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChDU19HUFIoREVMVEFfVEFSR0VUKSkg
KyA0OworCSpjcysrID0gdXBwZXJfMzJfYml0cyhkZWxheV90aWNrcyk7CisKKwkqY3MrKyA9IE1J
X01BVEgoNCk7CisJKmNzKysgPSBNSV9NQVRIX0xPQUQoTUlfTUFUSF9SRUdfU1JDQSwgTUlfTUFU
SF9SRUcoREVMVEFfVFMpKTsKKwkqY3MrKyA9IE1JX01BVEhfTE9BRChNSV9NQVRIX1JFR19TUkNC
LCBNSV9NQVRIX1JFRyhERUxUQV9UQVJHRVQpKTsKKwkqY3MrKyA9IE1JX01BVEhfQUREOworCSpj
cysrID0gTUlfTUFUSF9TVE9SRUlOVihNSV9NQVRIX1JFRyhKVU1QX1BSRURJQ0FURSksIE1JX01B
VEhfUkVHX0NGKTsKKworCS8qCisJICogVHJhbnNmZXIgdGhlIHJlc3VsdCBpbnRvIHRoZSBwcmVk
aWNhdGUgcmVnaXN0ZXIgdG8gYmUgdXNlZCBmb3IgdGhlCisJICogcHJlZGljYXRlZCBqdW1wLgor
CSAqLworCSpjcysrID0gTUlfTE9BRF9SRUdJU1RFUl9SRUcgfCAoMyAtIDIpOworCSpjcysrID0g
aTkxNV9tbWlvX3JlZ19vZmZzZXQoQ1NfR1BSKEpVTVBfUFJFRElDQVRFKSk7CisJKmNzKysgPSBp
OTE1X21taW9fcmVnX29mZnNldChNSV9QUkVESUNBVEVfUkVTVUxUXzEpOworCisJLyogUHJlZGlj
YXRlIHRoZSBqdW1wLiAgKi8KKwkqY3MrKyA9IChJTlRFTF9HRU4oaTkxNSkgPCA4ID8KKwkJIE1J
X0JBVENIX0JVRkZFUl9TVEFSVCA6CisJCSBNSV9CQVRDSF9CVUZGRVJfU1RBUlRfR0VOOCkgfAor
CQlNSV9CQVRDSF9QUkVESUNBVEU7CisJKmNzKysgPSBpOTE1X2dndHRfb2Zmc2V0KHZtYSkgKyAo
anVtcCAtIGJhdGNoKSAqIDQ7CisJKmNzKysgPSAwOworCisJLyogUmVzdG9yZSByZWdpc3RlcnMu
ICovCisJZm9yIChpID0gMDsgaSA8IE5fQ1NfR1BSOyBpKyspCisJCWNzID0gc2F2ZV9yZXN0b3Jl
X3JlZ2lzdGVyKAorCQkJc3RyZWFtLCBjcywgZmFsc2UgLyogcmVzdG9yZSAqLywgQ1NfR1BSKGkp
LAorCQkJSU5URUxfR1RfU0NSQVRDSF9GSUVMRF9QRVJGX0NTX0dQUiArIDggKiBpLCAyKTsKKwlj
cyA9IHNhdmVfcmVzdG9yZV9yZWdpc3RlcigKKwkJc3RyZWFtLCBjcywgZmFsc2UgLyogcmVzdG9y
ZSAqLywgTUlfUFJFRElDQVRFX1JFU1VMVF8xLAorCQlJTlRFTF9HVF9TQ1JBVENIX0ZJRUxEX1BF
UkZfUFJFRElDQVRFX1JFU1VMVF8xLCAxKTsKKworCS8qIEFuZCByZXR1cm4gdG8gdGhlIHJpbmcu
ICovCisJKmNzKysgPSBNSV9CQVRDSF9CVUZGRVJfRU5EOworCisJR0VNX0JVR19PTihjcyAtIGJh
dGNoID4gUEFHRV9TSVpFIC8gc2l6ZW9mKCpiYXRjaCkpOworCisJaTkxNV9nZW1fb2JqZWN0X2Zs
dXNoX21hcChibyk7CisJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChibyk7CisKKwlzdHJlYW0t
Pm5vYV93YWl0ID0gdm1hOworCXJldHVybiAwOworCitlcnJfdW5waW46CisJX19pOTE1X3ZtYV91
bnBpbih2bWEpOworZXJyX3VucmVmOgorCWk5MTVfZ2VtX29iamVjdF9wdXQoYm8pOworCXJldHVy
biByZXQ7Cit9CisKIHN0YXRpYyB2b2lkIGNvbmZpZ19vYV9yZWdzKHN0cnVjdCBpbnRlbF91bmNv
cmUgKnVuY29yZSwKIAkJCSAgIGNvbnN0IHN0cnVjdCBpOTE1X29hX3JlZyAqcmVncywKIAkJCSAg
IHUzMiBuX3JlZ3MpCkBAIC0yMjA1LDYgKzI0MTIsMTIgQEAgc3RhdGljIGludCBpOTE1X29hX3N0
cmVhbV9pbml0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJCX0KIAl9CiAKKwly
ZXQgPSBhbGxvY19ub2Ffd2FpdChzdHJlYW0pOworCWlmIChyZXQpIHsKKwkJRFJNX0RFQlVHKCJV
bmFibGUgdG8gYWxsb2NhdGUgTk9BIHdhaXQgYmF0Y2ggYnVmZmVyXG4iKTsKKwkJZ290byBlcnJf
bm9hX3dhaXRfYWxsb2M7CisJfQorCiAJc3RyZWFtLT5vYV9jb25maWcgPSBpOTE1X3BlcmZfZ2V0
X29hX2NvbmZpZyhwZXJmLCBwcm9wcy0+bWV0cmljc19zZXQpOwogCWlmICghc3RyZWFtLT5vYV9j
b25maWcpIHsKIAkJRFJNX0RFQlVHKCJJbnZhbGlkIE9BIGNvbmZpZyBpZD0laVxuIiwgcHJvcHMt
Pm1ldHJpY3Nfc2V0KTsKQEAgLTIyNjQsNiArMjQ3Nyw5IEBAIHN0YXRpYyBpbnQgaTkxNV9vYV9z
dHJlYW1faW5pdChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtLAogCWludGVsX3J1bnRp
bWVfcG1fcHV0KHN0cmVhbS0+Z3QtPnVuY29yZS0+cnBtLCBzdHJlYW0tPndha2VyZWYpOwogCiBl
cnJfY29uZmlnOgorCWZyZWVfbm9hX3dhaXQoc3RyZWFtKTsKKworZXJyX25vYV93YWl0X2FsbG9j
OgogCWlmIChzdHJlYW0tPmN0eCkKIAkJb2FfcHV0X3JlbmRlcl9jdHhfaWQoc3RyZWFtKTsKIApA
QCAtMzY1MCw2ICszODY2LDkgQEAgdm9pZCBpOTE1X3BlcmZfaW5pdChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIAkJcmF0ZWxpbWl0X3NldF9mbGFncygmcGVyZi0+c3B1cmlvdXNfcmVw
b3J0X3JzLAogCQkJCSAgICBSQVRFTElNSVRfTVNHX09OX1JFTEVBU0UpOwogCisJCWF0b21pYzY0
X3NldCgmcGVyZi0+bm9hX3Byb2dyYW1taW5nX2RlbGF5LAorCQkJICAgICA1MDAgKiAxMDAwIC8q
IDUwMHVzICovKTsKKwogCQlwZXJmLT5pOTE1ID0gaTkxNTsKIAl9CiB9CkBAIC0zNjg5LDMgKzM5
MDgsNyBAQCBpbnQgaTkxNV9wZXJmX2lvY3RsX3ZlcnNpb24odm9pZCkKIHsKIAlyZXR1cm4gMTsK
IH0KKworI2lmIElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X1NFTEZURVNUKQorI2luY2x1ZGUg
InNlbGZ0ZXN0cy9pOTE1X3BlcmYuYyIKKyNlbmRpZgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9wZXJmX3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Bl
cmZfdHlwZXMuaAppbmRleCA3YWZlYTI2N2ZmM2YuLmViNTA2NTAyM2M5MyAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmX3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9wZXJmX3R5cGVzLmgKQEAgLTI3Miw2ICsyNzIsMTIgQEAgc3RydWN0IGk5
MTVfcGVyZl9zdHJlYW0gewogCQkgKi8KIAkJdTMyIGhlYWQ7CiAJfSBvYV9idWZmZXI7CisKKwkv
KioKKwkgKiBBIGJhdGNoIGJ1ZmZlciBkb2luZyBhIHdhaXQgb24gdGhlIEdQVSBmb3IgdGhlIE5P
QSBsb2dpYyB0byBiZQorCSAqIHJlcHJvZ3JhbW1lZC4KKwkgKi8KKwlzdHJ1Y3QgaTkxNV92bWEg
Km5vYV93YWl0OwogfTsKIAogLyoqCkBAIC0zOTEsNiArMzk3LDggQEAgc3RydWN0IGk5MTVfcGVy
ZiB7CiAKIAlzdHJ1Y3QgaTkxNV9vYV9vcHMgb3BzOwogCWNvbnN0IHN0cnVjdCBpOTE1X29hX2Zv
cm1hdCAqb2FfZm9ybWF0czsKKworCWF0b21pYzY0X3Qgbm9hX3Byb2dyYW1taW5nX2RlbGF5Owog
fTsKIAogI2VuZGlmIC8qIF9JOTE1X1BFUkZfVFlQRVNfSF8gKi8KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Jl
Zy5oCmluZGV4IDFkYzA2N2ZjNTdhYi4uOTlmOGEwOGRjMmIyIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
cmVnLmgKQEAgLTU0NSw3ICs1NDUsOSBAQCBzdGF0aWMgaW5saW5lIGJvb2wgaTkxNV9tbWlvX3Jl
Z192YWxpZChpOTE1X3JlZ190IHJlZykKICNkZWZpbmUgTUlfUFJFRElDQVRFX1NSQzBfVURXCV9N
TUlPKDB4MjQwMCArIDQpCiAjZGVmaW5lIE1JX1BSRURJQ0FURV9TUkMxCV9NTUlPKDB4MjQwOCkK
ICNkZWZpbmUgTUlfUFJFRElDQVRFX1NSQzFfVURXCV9NTUlPKDB4MjQwOCArIDQpCi0KKyNkZWZp
bmUgTUlfUFJFRElDQVRFX0RBVEEgICAgICAgX01NSU8oMHgyNDEwKQorI2RlZmluZSBNSV9QUkVE
SUNBVEVfUkVTVUxUICAgICBfTU1JTygweDI0MTgpCisjZGVmaW5lIE1JX1BSRURJQ0FURV9SRVNV
TFRfMSAgIF9NTUlPKDB4MjQxYykKICNkZWZpbmUgTUlfUFJFRElDQVRFX1JFU1VMVF8yCV9NTUlP
KDB4MjIxNCkKICNkZWZpbmUgIExPV0VSX1NMSUNFX0VOQUJMRUQJKDEgPDwgMCkKICNkZWZpbmUg
IExPV0VSX1NMSUNFX0RJU0FCTEVECSgwIDw8IDApCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9saXZlX3NlbGZ0ZXN0cy5oIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxmdGVzdHMuaAppbmRleCA2NzEzZWZlYTM1MGIu
LjZkYWY2NTk5ZWM3OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3Rz
L2k5MTVfbGl2ZV9zZWxmdGVzdHMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaTkxNV9saXZlX3NlbGZ0ZXN0cy5oCkBAIC0zNSwzICszNSw0IEBAIHNlbGZ0ZXN0KHJlc2V0
LCBpbnRlbF9yZXNldF9saXZlX3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KGhhbmdjaGVjaywgaW50ZWxf
aGFuZ2NoZWNrX2xpdmVfc2VsZnRlc3RzKQogc2VsZnRlc3QoZXhlY2xpc3RzLCBpbnRlbF9leGVj
bGlzdHNfbGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChndWMsIGludGVsX2d1Y19saXZlX3NlbGZ0
ZXN0KQorc2VsZnRlc3QocGVyZiwgaTkxNV9wZXJmX2xpdmVfc2VsZnRlc3RzKQpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcGVyZi5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcGVyZi5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0Cmlu
ZGV4IDAwMDAwMDAwMDAwMC4uYTYyODg1NGRkYTAyCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcGVyZi5jCkBAIC0wLDAgKzEsMjE3IEBACisv
KgorICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAorICoKKyAqIENvcHlyaWdodCDCqSAy
MDE5IEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2luY2x1ZGUgPGxpbnV4L2tyZWYuaD4KKwor
I2luY2x1ZGUgImdlbS9pOTE1X2dlbV9wbS5oIgorI2luY2x1ZGUgImd0L2ludGVsX2d0LmgiCisK
KyNpbmNsdWRlICJpOTE1X3NlbGZ0ZXN0LmgiCisKKyNpbmNsdWRlICJpZ3RfZmx1c2hfdGVzdC5o
IgorI2luY2x1ZGUgImxpYl9zd19mZW5jZS5oIgorCitzdGF0aWMgc3RydWN0IGk5MTVfcGVyZl9z
dHJlYW0gKgordGVzdF9zdHJlYW0oc3RydWN0IGk5MTVfcGVyZiAqcGVyZikKK3sKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcGVyZl9vcGVuX3BhcmFtIHBhcmFtID0ge307CisJc3RydWN0IHBlcmZfb3Blbl9w
cm9wZXJ0aWVzIHByb3BzID0geworCQkuZW5naW5lID0gaW50ZWxfZW5naW5lX2xvb2t1cF91c2Vy
KHBlcmYtPmk5MTUsCisJCQkJCQkgICBJOTE1X0VOR0lORV9DTEFTU19SRU5ERVIsCisJCQkJCQkg
ICAwKSwKKwkJLnNhbXBsZV9mbGFncyA9IFNBTVBMRV9PQV9SRVBPUlQsCisJCS5vYV9mb3JtYXQg
PSBJOTE1X09BX0ZPUk1BVF9DNF9COCwKKwkJLm1ldHJpY3Nfc2V0ID0gMSwKKwl9OworCXN0cnVj
dCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW07CisKKwlzdHJlYW0gPSBremFsbG9jKHNpemVvZigq
c3RyZWFtKSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFzdHJlYW0pCisJCXJldHVybiBOVUxMOworCisJ
c3RyZWFtLT5wZXJmID0gcGVyZjsKKwlzdHJlYW0tPmd0ID0gJnBlcmYtPmk5MTUtPmd0OworCisJ
bXV0ZXhfbG9jaygmcGVyZi0+bG9jayk7CisJaWYgKGk5MTVfb2Ffc3RyZWFtX2luaXQoc3RyZWFt
LCAmcGFyYW0sICZwcm9wcykpIHsKKwkJa2ZyZWUoc3RyZWFtKTsKKwkJc3RyZWFtID0gIE5VTEw7
CisJfQorCW11dGV4X3VubG9jaygmcGVyZi0+bG9jayk7CisKKwlyZXR1cm4gc3RyZWFtOworfQor
CitzdGF0aWMgdm9pZCBzdHJlYW1fZGVzdHJveShzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3Ry
ZWFtKQoreworCXN0cnVjdCBpOTE1X3BlcmYgKnBlcmYgPSBzdHJlYW0tPnBlcmY7CisKKwltdXRl
eF9sb2NrKCZwZXJmLT5sb2NrKTsKKwlpOTE1X3BlcmZfZGVzdHJveV9sb2NrZWQoc3RyZWFtKTsK
KwltdXRleF91bmxvY2soJnBlcmYtPmxvY2spOworfQorCitzdGF0aWMgaW50IGxpdmVfc2FuaXR5
Y2hlY2sodm9pZCAqYXJnKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJn
OworCXN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW07CisKKwkvKiBRdWljayBjaGVjayB3
ZSBjYW4gY3JlYXRlIGEgcGVyZiBzdHJlYW0gKi8KKworCXN0cmVhbSA9IHRlc3Rfc3RyZWFtKCZp
OTE1LT5wZXJmKTsKKwlpZiAoIXN0cmVhbSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlzdHJlYW1f
ZGVzdHJveShzdHJlYW0pOworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IHdyaXRlX3RpbWVz
dGFtcChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgaW50IHNsb3QpCit7CisJdTMyICpjczsKKwlp
bnQgbGVuOworCisJY3MgPSBpbnRlbF9yaW5nX2JlZ2luKHJxLCA2KTsKKwlpZiAoSVNfRVJSKGNz
KSkKKwkJcmV0dXJuIFBUUl9FUlIoY3MpOworCisJbGVuID0gNTsKKwlpZiAoSU5URUxfR0VOKHJx
LT5pOTE1KSA+PSA4KQorCQlsZW4rKzsKKworCSpjcysrID0gR0ZYX09QX1BJUEVfQ09OVFJPTChs
ZW4pOworCSpjcysrID0gUElQRV9DT05UUk9MX0dMT0JBTF9HVFRfSVZCIHwKKwkJUElQRV9DT05U
Uk9MX1NUT1JFX0RBVEFfSU5ERVggfAorCQlQSVBFX0NPTlRST0xfV1JJVEVfVElNRVNUQU1QOwor
CSpjcysrID0gc2xvdCAqIHNpemVvZih1MzIpOworCSpjcysrID0gMDsKKwkqY3MrKyA9IDA7CisJ
KmNzKysgPSAwOworCisJaW50ZWxfcmluZ19hZHZhbmNlKHJxLCBjcyk7CisKKwlyZXR1cm4gMDsK
K30KKworc3RhdGljIGt0aW1lX3QgcG9sbF9zdGF0dXMoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEs
IGludCBzbG90KQoreworCXdoaWxlICghaW50ZWxfcmVhZF9zdGF0dXNfcGFnZShycS0+ZW5naW5l
LCBzbG90KSAmJgorCSAgICAgICAhaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChycSkpCisJCWNwdV9y
ZWxheCgpOworCisJcmV0dXJuIGt0aW1lX2dldCgpOworfQorCitzdGF0aWMgaW50IGxpdmVfbm9h
X2RlbGF5KHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFy
ZzsKKwlzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtOworCXN0cnVjdCBpOTE1X3JlcXVl
c3QgKnJxOworCWt0aW1lX3QgdDAsIHQxOworCXU2NCBleHBlY3RlZDsKKwl1MzIgZGVsYXk7CisJ
aW50IGVycjsKKwlpbnQgaTsKKworCS8qIENoZWNrIHRoYXQgdGhlIEdQVSBkZWxheXMgbWF0Y2hl
cyBleHBlY3RhdGlvbnMgKi8KKworCXN0cmVhbSA9IHRlc3Rfc3RyZWFtKCZpOTE1LT5wZXJmKTsK
KwlpZiAoIXN0cmVhbSkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlleHBlY3RlZCA9IGF0b21pYzY0
X3JlYWQoJnN0cmVhbS0+cGVyZi0+bm9hX3Byb2dyYW1taW5nX2RlbGF5KTsKKworCWlmIChzdHJl
YW0tPmVuZ2luZS0+Y2xhc3MgIT0gUkVOREVSX0NMQVNTKSB7CisJCWVyciA9IC1FTk9ERVY7CisJ
CWdvdG8gb3V0OworCX0KKworCWZvciAoaSA9IDA7IGkgPCA0OyBpKyspCisJCWludGVsX3dyaXRl
X3N0YXR1c19wYWdlKHN0cmVhbS0+ZW5naW5lLCAweDEwMCArIGksIDApOworCisJcnEgPSBpOTE1
X3JlcXVlc3RfY3JlYXRlKHN0cmVhbS0+ZW5naW5lLT5rZXJuZWxfY29udGV4dCk7CisJaWYgKElT
X0VSUihycSkpIHsKKwkJZXJyID0gUFRSX0VSUihycSk7CisJCWdvdG8gb3V0OworCX0KKworCWlm
IChycS0+ZW5naW5lLT5lbWl0X2luaXRfYnJlYWRjcnVtYiAmJgorCSAgICBpOTE1X3JlcXVlc3Rf
dGltZWxpbmUocnEpLT5oYXNfaW5pdGlhbF9icmVhZGNydW1iKSB7CisJCWVyciA9IHJxLT5lbmdp
bmUtPmVtaXRfaW5pdF9icmVhZGNydW1iKHJxKTsKKwkJaWYgKGVycikgeworCQkJaTkxNV9yZXF1
ZXN0X2FkZChycSk7CisJCQlnb3RvIG91dDsKKwkJfQorCX0KKworCWVyciA9IHdyaXRlX3RpbWVz
dGFtcChycSwgMHgxMDApOworCWlmIChlcnIpIHsKKwkJaTkxNV9yZXF1ZXN0X2FkZChycSk7CisJ
CWdvdG8gb3V0OworCX0KKworCWVyciA9IHJxLT5lbmdpbmUtPmVtaXRfYmJfc3RhcnQocnEsCisJ
CQkJCWk5MTVfZ2d0dF9vZmZzZXQoc3RyZWFtLT5ub2Ffd2FpdCksIDAsCisJCQkJCUk5MTVfRElT
UEFUQ0hfU0VDVVJFKTsKKwlpZiAoZXJyKSB7CisJCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCQln
b3RvIG91dDsKKwl9CisKKwllcnIgPSB3cml0ZV90aW1lc3RhbXAocnEsIDB4MTAyKTsKKwlpZiAo
ZXJyKSB7CisJCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCQlnb3RvIG91dDsKKwl9CisKKwlpOTE1
X3JlcXVlc3RfZ2V0KHJxKTsKKwlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKworCXByZWVtcHRfZGlz
YWJsZSgpOworCXQwID0gcG9sbF9zdGF0dXMocnEsIDB4MTAwKTsKKwl0MSA9IHBvbGxfc3RhdHVz
KHJxLCAweDEwMik7CisJcHJlZW1wdF9lbmFibGUoKTsKKworCXByX2luZm8oIkNQVSBkZWxheTog
JWxsdW5zLCBleHBlY3RlZCAlbGx1bnNcbiIsCisJCWt0aW1lX3N1Yih0MSwgdDApLCBleHBlY3Rl
ZCk7CisKKwlkZWxheSA9IGludGVsX3JlYWRfc3RhdHVzX3BhZ2Uoc3RyZWFtLT5lbmdpbmUsIDB4
MTAyKTsKKwlkZWxheSAtPSBpbnRlbF9yZWFkX3N0YXR1c19wYWdlKHN0cmVhbS0+ZW5naW5lLCAw
eDEwMCk7CisJZGVsYXkgPSBkaXZfdTY0KG11bF91MzJfdTMyKGRlbGF5LCAxMDAwICogMTAwMCks
CisJCQlSVU5USU1FX0lORk8oaTkxNSktPmNzX3RpbWVzdGFtcF9mcmVxdWVuY3lfa2h6KTsKKwlw
cl9pbmZvKCJHUFUgZGVsYXk6ICV1bnMsIGV4cGVjdGVkICVsbHVuc1xuIiwKKwkJZGVsYXksIGV4
cGVjdGVkKTsKKworCWlmICg0ICogZGVsYXkgPCAzICogZXhwZWN0ZWQgfHwgMiAqIGRlbGF5ID4g
MyAqIGV4cGVjdGVkKSB7CisJCXByX2VycigiR1BVIGRlbGF5IFsldXVzXSBvdXRzaWRlIG9mIGV4
cGVjdGVkIHRocmVzaG9sZCEgWyVsbHV1cywgJWxsdXVzXVxuIiwKKwkJICAgICAgIGRlbGF5IC8g
MTAwMCwKKwkJICAgICAgIGRpdl91NjQoMyAqIGV4cGVjdGVkLCA0MDAwKSwKKwkJICAgICAgIGRp
dl91NjQoMyAqIGV4cGVjdGVkLCAyMDAwKSk7CisJCWVyciA9IC1FSU5WQUw7CisJfQorCisJaTkx
NV9yZXF1ZXN0X3B1dChycSk7CitvdXQ6CisJc3RyZWFtX2Rlc3Ryb3koc3RyZWFtKTsKKwlyZXR1
cm4gZXJyOworfQorCitpbnQgaTkxNV9wZXJmX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQoreworCXN0YXRpYyBjb25zdCBzdHJ1Y3QgaTkxNV9zdWJ0ZXN0IHRl
c3RzW10gPSB7CisJCVNVQlRFU1QobGl2ZV9zYW5pdHljaGVjayksCisJCVNVQlRFU1QobGl2ZV9u
b2FfZGVsYXkpLAorCX07CisJc3RydWN0IGk5MTVfcGVyZiAqcGVyZiA9ICZpOTE1LT5wZXJmOwor
CisJaWYgKCFwZXJmLT5tZXRyaWNzX2tvYmogfHwgIXBlcmYtPm9wcy5lbmFibGVfbWV0cmljX3Nl
dCkKKwkJcmV0dXJuIDA7CisKKwlpZiAoaW50ZWxfZ3RfaXNfd2VkZ2VkKCZpOTE1LT5ndCkpCisJ
CXJldHVybiAwOworCisJcmV0dXJuIGk5MTVfc3VidGVzdHModGVzdHMsIGk5MTUpOworfQotLSAK
Mi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJ
bnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0
cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

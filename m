Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9C9744CFCF
	for <lists+intel-gfx@lfdr.de>; Thu, 20 Jun 2019 16:00:57 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0C05A6E586;
	Thu, 20 Jun 2019 14:00:56 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0FCF16E586
 for <intel-gfx@lists.freedesktop.org>; Thu, 20 Jun 2019 14:00:54 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga006.fm.intel.com ([10.253.24.20])
 by fmsmga104.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 20 Jun 2019 07:00:53 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,397,1557212400"; d="scan'208";a="358944918"
Received: from gaia.fi.intel.com ([10.237.72.169])
 by fmsmga006.fm.intel.com with ESMTP; 20 Jun 2019 07:00:52 -0700
Received: by gaia.fi.intel.com (Postfix, from userid 1000)
 id 3E2535C1EC2; Thu, 20 Jun 2019 17:00:44 +0300 (EEST)
From: Mika Kuoppala <mika.kuoppala@linux.intel.com>
To: Chris Wilson <chris@chris-wilson.co.uk>, intel-gfx@lists.freedesktop.org
In-Reply-To: <20190620070559.30076-3-chris@chris-wilson.co.uk>
References: <20190620070559.30076-1-chris@chris-wilson.co.uk>
 <20190620070559.30076-3-chris@chris-wilson.co.uk>
Date: Thu, 20 Jun 2019 17:00:44 +0300
Message-ID: <87v9x05pbn.fsf@gaia.fi.intel.com>
MIME-Version: 1.0
Subject: Re: [Intel-gfx] [PATCH 3/3] drm/i915/execlists: Force preemption
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+IHdyaXRlczoKCj4gSWYgdGhl
IHByZWVtcHRlZCBjb250ZXh0IHRha2VzIHRvbyBsb25nIHRvIHJlbGlucXVpc2ggY29udHJvbCwg
ZS5nLiBpdAo+IGlzIHN0dWNrIGluc2lkZSBhIHNoYWRlciB3aXRoIGFyYml0cmF0aW9uIGRpc2Fi
bGVkLCBldmljdCB0aGF0IGNvbnRleHQKPiB3aXRoIGFuIGVuZ2luZSByZXNldC4gVGhpcyBlbnN1
cmVzIHRoYXQgcHJlZW1wdGlvbnMgYXJlIHJlYXNvbmFibHkKPiByZXNwb25zaXZlLCBwcm92aWRp
bmcgYSB0aWdodGVyIFFvUyBmb3IgdGhlIG1vcmUgaW1wb3J0YW50IGNvbnRleHQgYXQKPiB0aGUg
Y29zdCBvZiBmbGFnZ2luZyB1bnJlc3BvbnNpdmUgY29udGV4dHMgbW9yZSBmcmVxdWVudGx5IChp
LmUuIGluc3RlYWQKPiBvZiB1c2luZyBhbiB+MTBzIGhhbmdjaGVjaywgd2Ugbm93IGV2aWN0IGF0
IH4xMG1zKS4gIFRoZSBjaGFsbGVuZ2Ugb2YKPiBsaWVzIGluIHBpY2tpbmcgYSB0aW1lb3V0IHRo
YXQgY2FuIGJlIHJlYXNvbmFibHkgc2VydmljZWQgYnkgSFcgZm9yCj4gdHlwaWNhbCB3b3JrbG9h
ZHMsIGJhbGFuY2luZyB0aGUgZXhpc3RpbmcgY2xpZW50cyBhZ2FpbnN0IHRoZSBuZWVkcyBmb3IK
PiByZXNwb25zaXZlbmVzcy4KPgo+IFNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNA
Y2hyaXMtd2lsc29uLmNvLnVrPgo+IENjOiBNaWthIEt1b3BwYWxhIDxtaWthLmt1b3BwYWxhQGxp
bnV4LmludGVsLmNvbT4KPiBDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVs
LmNvbT4KPiAtLS0KPiAgZHJpdmVycy9ncHUvZHJtL2k5MTUvS2NvbmZpZy5wcm9maWxlIHwgMTIg
KysrKysrCj4gIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jICB8IDU2ICsrKysr
KysrKysrKysrKysrKysrKysrKysrLS0KPiAgMiBmaWxlcyBjaGFuZ2VkLCA2NSBpbnNlcnRpb25z
KCspLCAzIGRlbGV0aW9ucygtKQo+Cj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L0tjb25maWcucHJvZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L0tjb25maWcucHJvZmlsZQo+
IGluZGV4IDQ4ZGY4ODg5YTg4YS4uODI3M2QzYmFhZmU0IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L0tjb25maWcucHJvZmlsZQo+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L0tjb25maWcucHJvZmlsZQo+IEBAIC0yNSwzICsyNSwxNSBAQCBjb25maWcgRFJNX0k5MTVfU1BJ
Tl9SRVFVRVNUCj4gIAkgIE1heSBiZSAwIHRvIGRpc2FibGUgdGhlIGluaXRpYWwgc3Bpbi4gSW4g
cHJhY3RpY2UsIHdlIGVzdGltYXRlCj4gIAkgIHRoZSBjb3N0IG9mIGVuYWJsaW5nIHRoZSBpbnRl
cnJ1cHQgKGlmIGN1cnJlbnRseSBkaXNhYmxlZCkgdG8gYmUKPiAgCSAgYSBmZXcgbWljcm9zZWNv
bmRzLgo+ICsKPiArY29uZmlnIERSTV9JOTE1X1BSRUVNUFRfVElNRU9VVAo+ICsJaW50ICJQcmVl
bXB0IHRpbWVvdXQgKG1zKSIKPiArCWRlZmF1bHQgMTAgIyBtaWxsaXNlY29uZHMKPiArCWhlbHAK
PiArCSAgSG93IGxvbmcgdG8gd2FpdCAoaW4gbWlsbGlzZWNvbmRzKSBmb3IgYSBwcmVlbXB0aW9u
IGV2ZW50IHRvIG9jY3VyCj4gKwkgIHdoZW4gc3VibWl0dGluZyBhIG5ldyBjb250ZXh0IHZpYSBl
eGVjbGlzdHMuIElmIHRoZSBjdXJyZW50IGNvbnRleHQKPiArCSAgZG9lcyBub3QgaGl0IGFuIGFy
Yml0cmF0aW9uIHBvaW50IGFuZCB5aWVsZCB0byBIVyBiZWZvcmUgdGhlIHRpbWVyCj4gKwkgIGV4
cGlyZXMsIHRoZSBIVyB3aWxsIGJlIHJlc2V0IHRvIGFsbG93IHRoZSBtb3JlIGltcG9ydGFudCBj
b250ZXh0Cj4gKwkgIHRvIGV4ZWN1dGUuCj4gKwo+ICsJICBNYXkgYmUgMCB0byBkaXNhYmxlIHRo
ZSB0aW1lb3V0Lgo+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9s
cmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCj4gaW5kZXggZmNhNzlh
ZGI0YWEzLi5lOGQ3ZGViYTNlNDkgMTAwNjQ0Cj4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfbHJjLmMKPiArKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMu
Ywo+IEBAIC04ODksNiArODg5LDE1IEBAIGVuYWJsZV90aW1lc2xpY2Uoc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqZW5naW5lKQo+ICAJcmV0dXJuIGxhc3QgJiYgbmVlZF90aW1lc2xpY2UoZW5naW5l
LCBsYXN0KTsKPiAgfQo+ICAKPiArc3RhdGljIHVuc2lnbmVkIGxvbmcgcHJlZW1wdF9leHBpcmVz
KHZvaWQpCj4gK3sKPiArCXVuc2lnbmVkIGxvbmcgdGltZW91dCA9Cgpjb3VsZCBiZSBjb25zdAoK
PiArCQltc2Vjc190b19qaWZmaWVzX3RpbWVvdXQoQ09ORklHX0RSTV9JOTE1X1BSRUVNUFRfVElN
RU9VVCk7Cj4gKwo+ICsJYmFycmllcigpOwoKVGhpcyBuZWVkcyBhIGNvbW1lbnQuIEkgZmFpbCB0
byBjb25uZWN0IHRoZSBkb3RzIGFzIGppZmZpZXMKaXMgdm9sYXRpbGUgYnkgbmF0dXJlLgoKPiAr
CXJldHVybiBqaWZmaWVzICsgdGltZW91dDsKPiArfQo+ICsKPiAgc3RhdGljIHZvaWQgZXhlY2xp
c3RzX2RlcXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQo+ICB7Cj4gIAlzdHJ1
Y3QgaW50ZWxfZW5naW5lX2V4ZWNsaXN0cyAqIGNvbnN0IGV4ZWNsaXN0cyA9ICZlbmdpbmUtPmV4
ZWNsaXN0czsKPiBAQCAtMTIyMCw2ICsxMjI5LDkgQEAgc3RhdGljIHZvaWQgZXhlY2xpc3RzX2Rl
cXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQo+ICAJCSpwb3J0ID0gZXhlY2xp
c3RzX3NjaGVkdWxlX2luKGxhc3QsIHBvcnQgLSBleGVjbGlzdHMtPnBlbmRpbmcpOwo+ICAJCW1l
bXNldChwb3J0ICsgMSwgMCwgKGxhc3RfcG9ydCAtIHBvcnQpICogc2l6ZW9mKCpwb3J0KSk7Cj4g
IAkJZXhlY2xpc3RzX3N1Ym1pdF9wb3J0cyhlbmdpbmUpOwo+ICsKPiArCQlpZiAoQ09ORklHX0RS
TV9JOTE1X1BSRUVNUFRfVElNRU9VVCkKPiArCQkJbW9kX3RpbWVyKCZleGVjbGlzdHMtPnRpbWVy
LCBwcmVlbXB0X2V4cGlyZXMoKSk7Cj4gIAl9Cj4gIH0KPiAgCj4gQEAgLTEzNzYsMTMgKzEzODgs
NDggQEAgc3RhdGljIHZvaWQgcHJvY2Vzc19jc2Ioc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lKQo+ICAJaW52YWxpZGF0ZV9jc2JfZW50cmllcygmYnVmWzBdLCAmYnVmW251bV9lbnRyaWVz
IC0gMV0pOwo+ICB9Cj4gIAo+IC1zdGF0aWMgdm9pZCBfX2V4ZWNsaXN0c19zdWJtaXNzaW9uX3Rh
c2tsZXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqY29uc3QgZW5naW5lKQo+ICtzdGF0aWMgYm9v
bCBfX2V4ZWNsaXN0c19zdWJtaXNzaW9uX3Rhc2tsZXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
Y29uc3QgZW5naW5lKQo+ICB7Cj4gIAlsb2NrZGVwX2Fzc2VydF9oZWxkKCZlbmdpbmUtPmFjdGl2
ZS5sb2NrKTsKPiAgCj4gIAlwcm9jZXNzX2NzYihlbmdpbmUpOwo+IC0JaWYgKCFlbmdpbmUtPmV4
ZWNsaXN0cy5wZW5kaW5nWzBdKQo+ICsJaWYgKCFlbmdpbmUtPmV4ZWNsaXN0cy5wZW5kaW5nWzBd
KSB7Cj4gIAkJZXhlY2xpc3RzX2RlcXVldWUoZW5naW5lKTsKPiArCQlyZXR1cm4gdHJ1ZTsKPiAr
CX0KPiArCj4gKwlyZXR1cm4gZmFsc2U7Cj4gK30KPiArCj4gK3N0YXRpYyB2b2lkIHByZWVtcHRf
cmVzZXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQo+ICt7Cj4gKwljb25zdCB1bnNp
Z25lZCBpbnQgYml0ID0gSTkxNV9SRVNFVF9FTkdJTkUgKyBlbmdpbmUtPmlkOwo+ICsJdW5zaWdu
ZWQgbG9uZyAqbG9jayA9ICZlbmdpbmUtPmk5MTUtPmdwdV9lcnJvci5mbGFnczsKPiArCj4gKwlp
ZiAodGVzdF9hbmRfc2V0X2JpdChiaXQsIGxvY2spKQo+ICsJCXJldHVybjsKPiArCj4gKwl0YXNr
bGV0X2Rpc2FibGVfbm9zeW5jKCZlbmdpbmUtPmV4ZWNsaXN0cy50YXNrbGV0KTsKPiArCXNwaW5f
dW5sb2NrKCZlbmdpbmUtPmFjdGl2ZS5sb2NrKTsKPiArCgpXaHkgZG8gd2UgbmVlZCB0byBkcm9w
IHRoZSBsb2NrPwotTWlrYQoKPiArCWk5MTVfcmVzZXRfZW5naW5lKGVuZ2luZSwgInByZWVtcHRp
b24gdGltZSBvdXQiKTsKPiArCj4gKwlzcGluX2xvY2soJmVuZ2luZS0+YWN0aXZlLmxvY2spOwo+
ICsJdGFza2xldF9lbmFibGUoJmVuZ2luZS0+ZXhlY2xpc3RzLnRhc2tsZXQpOwo+ICsKPiArCWNs
ZWFyX2JpdChiaXQsIGxvY2spOwo+ICsJd2FrZV91cF9iaXQobG9jaywgYml0KTsKPiArfQo+ICsK
PiArc3RhdGljIGJvb2wgcHJlZW1wdF90aW1lb3V0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmNv
bnN0IGVuZ2luZSkKPiArewo+ICsJaWYgKCFDT05GSUdfRFJNX0k5MTVfUFJFRU1QVF9USU1FT1VU
KQo+ICsJCXJldHVybiBmYWxzZTsKPiArCj4gKwlpZiAoIWludGVsX2VuZ2luZV9oYXNfcHJlZW1w
dGlvbihlbmdpbmUpKQo+ICsJCXJldHVybiBmYWxzZTsKPiArCj4gKwlyZXR1cm4gIXRpbWVyX3Bl
bmRpbmcoJmVuZ2luZS0+ZXhlY2xpc3RzLnRpbWVyKTsKPiAgfQo+ICAKPiAgLyoKPiBAQCAtMTM5
NSw3ICsxNDQyLDEwIEBAIHN0YXRpYyB2b2lkIGV4ZWNsaXN0c19zdWJtaXNzaW9uX3Rhc2tsZXQo
dW5zaWduZWQgbG9uZyBkYXRhKQo+ICAJdW5zaWduZWQgbG9uZyBmbGFnczsKPiAgCj4gIAlzcGlu
X2xvY2tfaXJxc2F2ZSgmZW5naW5lLT5hY3RpdmUubG9jaywgZmxhZ3MpOwo+IC0JX19leGVjbGlz
dHNfc3VibWlzc2lvbl90YXNrbGV0KGVuZ2luZSk7Cj4gKwo+ICsJaWYgKCFfX2V4ZWNsaXN0c19z
dWJtaXNzaW9uX3Rhc2tsZXQoZW5naW5lKSAmJiBwcmVlbXB0X3RpbWVvdXQoZW5naW5lKSkKPiAr
CQlwcmVlbXB0X3Jlc2V0KGVuZ2luZSk7Cj4gKwo+ICAJc3Bpbl91bmxvY2tfaXJxcmVzdG9yZSgm
ZW5naW5lLT5hY3RpdmUubG9jaywgZmxhZ3MpOwo+ICB9Cj4gIAo+IC0tIAo+IDIuMjAuMQpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFp
bGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5m
cmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 1A078C8719
	for <lists+intel-gfx@lfdr.de>; Wed,  2 Oct 2019 13:20:39 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 515D56E93F;
	Wed,  2 Oct 2019 11:20:31 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 897126E935
 for <intel-gfx@lists.freedesktop.org>; Wed,  2 Oct 2019 11:20:29 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18692023-1500050 
 for multiple; Wed, 02 Oct 2019 12:20:06 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  2 Oct 2019 12:19:38 +0100
Message-Id: <20191002112000.12280-8-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191002112000.12280-1-chris@chris-wilson.co.uk>
References: <20191002112000.12280-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 08/30] drm/i915: Coordinate i915_active with its
 own mutex
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Rm9yZ28gdGhlIHN0cnVjdF9tdXRleCBzZXJpYWxpc2F0aW9uIGZvciBpOTE1X2FjdGl2ZSwgYW5k
IGludGVycG9zZSBpdHMKb3duIG11dGV4IGhhbmRsaW5nIGZvciBhY3RpdmUvcmV0aXJlLgoKVGhp
cyBpcyBhIG11bHRpLWxheWVyZWQgc2xlaWdodC1vZi1oYW5kLiBGaXJzdCwgd2UgaGFkIHRvIGVu
c3VyZSB0aGF0IG5vCmFjdGl2ZS9yZXRpcmUgY2FsbGJhY2tzIGFjY2lkZW50YWxseSBpbnZlcnRl
ZCB0aGUgbXV0ZXggb3JkZXJpbmcgcnVsZXMsCm5vciBhc3N1bWVkIHRoYXQgdGhleSB3ZXJlIHRo
ZW1zZWx2ZXMgc2VyaWFsaXNlZCBieSBzdHJ1Y3RfbXV0ZXguIE1vcmUKY2hhbGxlbmdpbmcgdGhv
dWdoLCBpcyB0aGUgcnVsZSBvdmVyIHVwZGF0aW5nIGVsZW1lbnRzIG9mIHRoZSBhY3RpdmUKcmJ0
cmVlLiBJbnN0ZWFkIG9mIHRoZSB3aG9sZSBpOTE1X2FjdGl2ZSBub3cgYmVpbmcgc2VyaWFsaXNl
ZCBieQpzdHJ1Y3RfbXV0ZXgsIGFsbG9jYXRpb25zL3JvdGF0aW9ucyBvZiB0aGUgdHJlZSBhcmUg
c2VyaWFsaXNlZCBieSB0aGUKaTkxNV9hY3RpdmUubXV0ZXggYW5kIGluZGl2aWR1YWwgbm9kZXMg
YXJlIHNlcmlhbGlzZWQgYnkgdGhlIGNhbGxlcgp1c2luZyB0aGUgaTkxNV90aW1lbGluZS5tdXRl
eCAod2UgbmVlZCB0byB1c2UgbmVzdGVkIHNwaW5sb2NrcyB0bwppbnRlcmFjdCB3aXRoIHRoZSBk
bWFfZmVuY2UgY2FsbGJhY2sgbGlzdHMpLgoKVGhlIHBhaW4gcG9pbnQgaGVyZSBpcyB0aGF0IGlu
c3RlYWQgb2YgYSBzaW5nbGUgbXV0ZXggYXJvdW5kIGV4ZWNidWYsIHdlCm5vdyBoYXZlIHRvIHRh
a2UgYSBtdXRleCBmb3IgYWN0aXZlIHRyYWNrZXIgKG9uZSBmb3IgZWFjaCB2bWEsIGNvbnRleHQs
CmV0YykgYW5kIGEgY291cGxlIG9mIHNwaW5sb2NrcyBmb3IgZWFjaCBmZW5jZSB1cGRhdGUuIFRo
ZSBpbXByb3ZlbWVudCBpbgpmaW5lIGdyYWluZWQgbG9ja2luZyBhbGxvd2luZyBmb3IgbXVsdGlw
bGUgY29uY3VycmVudCBjbGllbnRzCihldmVudHVhbGx5ISkgc2hvdWxkIGJlIHdvcnRoIGl0IGlu
IHR5cGljYWwgbG9hZHMuCgp2MjogQWRkIHNvbWUgY29tbWVudHMgdGhhdCBiYXJlbHkgZWx1Y2lk
YXRlIGFueXRoaW5nIDooCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlz
LXdpbHNvbi5jby51az4KLS0tCiAuLi4vZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZnJvbnRi
dWZmZXIuYyAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3Zl
cmxheS5jICB8ICAgMyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRl
eHQuYyAgIHwgICA0ICstCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlw
ZXMuaCAgfCAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMgICAg
ICAgIHwgICA5ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMgICAg
ICAgfCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sLmMg
ICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYyAgICAgICAg
IHwgIDEwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF90aW1lbGluZS5jICAgICAg
fCAgIDcgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmVfdHlwZXMuaCAgICB8
ICAgOSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jICAgIHwg
IDE2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYyAgICAgICAgfCAg
MTAgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RzL21vY2tfdGltZWxpbmUuYyB8ICAg
MiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jICAgICAgICAgIHwgICAz
IC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMgICAgICAgICAgICB8IDMyMiAr
KysrKysrKystLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmggICAg
ICAgICAgICB8IDMxOSArKysrLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9hY3RpdmVfdHlwZXMuaCAgICAgIHwgIDIzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2dlbS5jICAgICAgICAgICAgICAgfCAgNDIgKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2dlbV9ndHQuYyAgICAgICAgICAgfCAgIDMgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
Z3B1X2Vycm9yLmMgICAgICAgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9y
ZXF1ZXN0LmMgICAgICAgICAgIHwgIDM4ICstLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9y
ZXF1ZXN0LmggICAgICAgICAgIHwgICAxIC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1h
LmMgICAgICAgICAgICAgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3Rz
L2k5MTVfYWN0aXZlLmMgIHwgIDMyICstCiAyNCBmaWxlcyBjaGFuZ2VkLCAyOTggaW5zZXJ0aW9u
cygrKSwgNTcyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZnJvbnRidWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZnJvbnRidWZmZXIuYwppbmRleCA2NDI4YjhkZDcwZDMuLjg0YjE2NGYzMTg5NSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mcm9udGJ1ZmZl
ci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZnJvbnRidWZmZXIu
YwpAQCAtMjU3LDcgKzI1Nyw3IEBAIGludGVsX2Zyb250YnVmZmVyX2dldChzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqKQogCWZyb250LT5vYmogPSBvYmo7CiAJa3JlZl9pbml0KCZmcm9u
dC0+cmVmKTsKIAlhdG9taWNfc2V0KCZmcm9udC0+Yml0cywgMCk7Ci0JaTkxNV9hY3RpdmVfaW5p
dChpOTE1LCAmZnJvbnQtPndyaXRlLAorCWk5MTVfYWN0aXZlX2luaXQoJmZyb250LT53cml0ZSwK
IAkJCSBmcm9udGJ1ZmZlcl9hY3RpdmUsCiAJCQkgaTkxNV9hY3RpdmVfbWF5X3NsZWVwKGZyb250
YnVmZmVyX3JldGlyZSkpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX292ZXJsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
b3ZlcmxheS5jCmluZGV4IDNmNGFjMWVlNzY2OC4uZTEyZTFhNzUzYWYwIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYwpAQCAtMTM2MCw4ICsxMzYwLDcg
QEAgdm9pZCBpbnRlbF9vdmVybGF5X3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIAlvdmVybGF5LT5jb250cmFzdCA9IDc1OwogCW92ZXJsYXktPnNhdHVyYXRpb24gPSAx
NDY7CiAKLQlpOTE1X2FjdGl2ZV9pbml0KGRldl9wcml2LAotCQkJICZvdmVybGF5LT5sYXN0X2Zs
aXAsCisJaTkxNV9hY3RpdmVfaW5pdCgmb3ZlcmxheS0+bGFzdF9mbGlwLAogCQkJIE5VTEwsIGlu
dGVsX292ZXJsYXlfbGFzdF9mbGlwX3JldGlyZSk7CiAKIAlyZXQgPSBnZXRfcmVnaXN0ZXJzKG92
ZXJsYXksIE9WRVJMQVlfTkVFRFNfUEhZU0lDQUwoZGV2X3ByaXYpKTsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCmluZGV4IDRjZDdkMmVjZjFkNS4uOWQ4NWFh
YjY4ZDM0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29u
dGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMK
QEAgLTg2OCwyMCArODY4LDE4IEBAIHN0YXRpYyBpbnQgY29udGV4dF9iYXJyaWVyX3Rhc2soc3Ry
dWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJCQl2b2lkICgqdGFzaykodm9pZCAqZGF0YSks
CiAJCQkJdm9pZCAqZGF0YSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGN0
eC0+aTkxNTsKIAlzdHJ1Y3QgY29udGV4dF9iYXJyaWVyX3Rhc2sgKmNiOwogCXN0cnVjdCBpOTE1
X2dlbV9lbmdpbmVzX2l0ZXIgaXQ7CiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCWludCBl
cnIgPSAwOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiAJR0VNX0JVR19PTighdGFzayk7CiAKIAljYiA9IGttYWxsb2Moc2l6ZW9mKCpjYiksIEdGUF9L
RVJORUwpOwogCWlmICghY2IpCiAJCXJldHVybiAtRU5PTUVNOwogCi0JaTkxNV9hY3RpdmVfaW5p
dChpOTE1LCAmY2ItPmJhc2UsIE5VTEwsIGNiX3JldGlyZSk7CisJaTkxNV9hY3RpdmVfaW5pdCgm
Y2ItPmJhc2UsIE5VTEwsIGNiX3JldGlyZSk7CiAJZXJyID0gaTkxNV9hY3RpdmVfYWNxdWlyZSgm
Y2ItPmJhc2UpOwogCWlmIChlcnIpIHsKIAkJa2ZyZWUoY2IpOwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oCmluZGV4IGUxYWFiMmZkMWNkOS4u
YzAwYjRmMDc3ZjllIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fb2JqZWN0X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X29iamVjdF90eXBlcy5oCkBAIC04LDYgKzgsNyBAQAogI2RlZmluZSBfX0k5MTVfR0VNX09CSkVD
VF9UWVBFU19IX18KIAogI2luY2x1ZGUgPGRybS9kcm1fZ2VtLmg+CisjaW5jbHVkZSA8dWFwaS9k
cm0vaTkxNV9kcm0uaD4KIAogI2luY2x1ZGUgImk5MTVfYWN0aXZlLmgiCiAjaW5jbHVkZSAiaTkx
NV9zZWxmdGVzdC5oIgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYwppbmRleCBj
Y2ExOTJlY2ZmOGIuLjBhNDExNWM2YzI3NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX3BtLmMKQEAgLTE2LDE0ICsxNiwxMSBAQCBzdGF0aWMgdm9pZCBjYWxsX2lkbGVfYmFycmll
cnMoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCXN0cnVjdCBsbGlzdF9ub2RlICpu
b2RlLCAqbmV4dDsKIAogCWxsaXN0X2Zvcl9lYWNoX3NhZmUobm9kZSwgbmV4dCwgbGxpc3RfZGVs
X2FsbCgmZW5naW5lLT5iYXJyaWVyX3Rhc2tzKSkgewotCQlzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVx
dWVzdCAqYWN0aXZlID0KKwkJc3RydWN0IGRtYV9mZW5jZV9jYiAqY2IgPQogCQkJY29udGFpbmVy
X29mKChzdHJ1Y3QgbGlzdF9oZWFkICopbm9kZSwKLQkJCQkgICAgIHR5cGVvZigqYWN0aXZlKSwg
bGluayk7CisJCQkJICAgICB0eXBlb2YoKmNiKSwgbm9kZSk7CiAKLQkJSU5JVF9MSVNUX0hFQUQo
JmFjdGl2ZS0+bGluayk7Ci0JCVJDVV9JTklUX1BPSU5URVIoYWN0aXZlLT5yZXF1ZXN0LCBOVUxM
KTsKLQotCQlhY3RpdmUtPnJldGlyZShhY3RpdmUsIE5VTEwpOworCQljYi0+ZnVuYyhOVUxMLCBj
Yik7CiAJfQogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9j
b250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKaW5kZXgg
MDZmYWJkZjIwNWNmLi4zNWE0MGMyODIwYTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9jb250ZXh0LmMKQEAgLTI0MCw3ICsyNDAsNyBAQCBpbnRlbF9jb250ZXh0X2luaXQoc3RydWN0
IGludGVsX2NvbnRleHQgKmNlLAogCiAJbXV0ZXhfaW5pdCgmY2UtPnBpbl9tdXRleCk7CiAKLQlp
OTE1X2FjdGl2ZV9pbml0KGN0eC0+aTkxNSwgJmNlLT5hY3RpdmUsCisJaTkxNV9hY3RpdmVfaW5p
dCgmY2UtPmFjdGl2ZSwKIAkJCSBfX2ludGVsX2NvbnRleHRfYWN0aXZlLCBfX2ludGVsX2NvbnRl
eHRfcmV0aXJlKTsKIH0KIApAQCAtMzA3LDcgKzMwNyw3IEBAIGludCBpbnRlbF9jb250ZXh0X3By
ZXBhcmVfcmVtb3RlX3JlcXVlc3Qoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCQkJcmV0dXJu
IGVycjsKIAogCQkvKiBRdWV1ZSB0aGlzIHN3aXRjaCBhZnRlciBjdXJyZW50IGFjdGl2aXR5IGJ5
IHRoaXMgY29udGV4dC4gKi8KLQkJZXJyID0gaTkxNV9hY3RpdmVfcmVxdWVzdF9zZXQoJnRsLT5s
YXN0X3JlcXVlc3QsIHJxKTsKKwkJZXJyID0gaTkxNV9hY3RpdmVfZmVuY2Vfc2V0KCZ0bC0+bGFz
dF9yZXF1ZXN0LCBycSk7CiAJCW11dGV4X3VubG9jaygmdGwtPm11dGV4KTsKIAkJaWYgKGVycikK
IAkJCXJldHVybiBlcnI7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9lbmdpbmVfcG9vbC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3Bv
b2wuYwppbmRleCA4MWZhYjEwMWZkYjQuLjNjZGJkNWY4YjViZSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3Bvb2wuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG9vbC5jCkBAIC05NSw3ICs5NSw3IEBAIG5vZGVfY3Jl
YXRlKHN0cnVjdCBpbnRlbF9lbmdpbmVfcG9vbCAqcG9vbCwgc2l6ZV90IHN6KQogCQlyZXR1cm4g
RVJSX1BUUigtRU5PTUVNKTsKIAogCW5vZGUtPnBvb2wgPSBwb29sOwotCWk5MTVfYWN0aXZlX2lu
aXQoZW5naW5lLT5pOTE1LCAmbm9kZS0+YWN0aXZlLCBwb29sX2FjdGl2ZSwgcG9vbF9yZXRpcmUp
OworCWk5MTVfYWN0aXZlX2luaXQoJm5vZGUtPmFjdGl2ZSwgcG9vbF9hY3RpdmUsIHBvb2xfcmV0
aXJlKTsKIAogCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoZW5naW5lLT5p
OTE1LCBzeik7CiAJaWYgKElTX0VSUihvYmopKSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9yZXNldC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
cmVzZXQuYwppbmRleCBlMTg5ODk3ZTg3OTcuLjA1NTQ5NmYwODI1ZiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9yZXNldC5jCkBAIC04NDQsMTAgKzg0NCwxMCBAQCBzdGF0aWMgYm9vbCBf
X2ludGVsX2d0X3Vuc2V0X3dlZGdlZChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogCSAqLwogCXNwaW5f
bG9ja19pcnFzYXZlKCZ0aW1lbGluZXMtPmxvY2ssIGZsYWdzKTsKIAlsaXN0X2Zvcl9lYWNoX2Vu
dHJ5KHRsLCAmdGltZWxpbmVzLT5hY3RpdmVfbGlzdCwgbGluaykgewotCQlzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpycTsKKwkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CiAKLQkJcnEgPSBpOTE1X2Fj
dGl2ZV9yZXF1ZXN0X2dldF91bmxvY2tlZCgmdGwtPmxhc3RfcmVxdWVzdCk7Ci0JCWlmICghcnEp
CisJCWZlbmNlID0gaTkxNV9hY3RpdmVfZmVuY2VfZ2V0KCZ0bC0+bGFzdF9yZXF1ZXN0KTsKKwkJ
aWYgKCFmZW5jZSkKIAkJCWNvbnRpbnVlOwogCiAJCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnRp
bWVsaW5lcy0+bG9jaywgZmxhZ3MpOwpAQCAtODU5LDggKzg1OSw4IEBAIHN0YXRpYyBib29sIF9f
aW50ZWxfZ3RfdW5zZXRfd2VkZ2VkKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAJCSAqIChJOTE1X0ZF
TkNFX1RJTUVPVVQpIHNvIHRoaXMgd2FpdCBzaG91bGQgbm90IGJlIHVuYm91bmRlZAogCQkgKiBp
biB0aGUgd29yc3QgY2FzZS4KIAkJICovCi0JCWRtYV9mZW5jZV9kZWZhdWx0X3dhaXQoJnJxLT5m
ZW5jZSwgZmFsc2UsIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKLQkJaTkxNV9yZXF1ZXN0X3B1dChy
cSk7CisJCWRtYV9mZW5jZV9kZWZhdWx0X3dhaXQoZmVuY2UsIGZhbHNlLCBNQVhfU0NIRURVTEVf
VElNRU9VVCk7CisJCWRtYV9mZW5jZV9wdXQoZmVuY2UpOwogCiAJCS8qIFJlc3RhcnQgaXRlcmF0
aW9uIGFmdGVyIGRyb3BpbmcgbG9jayAqLwogCQlzcGluX2xvY2tfaXJxc2F2ZSgmdGltZWxpbmVz
LT5sb2NrLCBmbGFncyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF90aW1lbGluZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmUuYwpp
bmRleCA2NTNmNjBlNzgzOTIuLjBmOTU5Njk0MzAzYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF90aW1lbGluZS5jCkBAIC0xNzgsOCArMTc4LDcgQEAgY2FjaGVsaW5lX2FsbG9jKHN0
cnVjdCBpbnRlbF90aW1lbGluZV9od3NwICpod3NwLCB1bnNpZ25lZCBpbnQgY2FjaGVsaW5lKQog
CWNsLT5od3NwID0gaHdzcDsKIAljbC0+dmFkZHIgPSBwYWdlX3BhY2tfYml0cyh2YWRkciwgY2Fj
aGVsaW5lKTsKIAotCWk5MTVfYWN0aXZlX2luaXQoaHdzcC0+Z3QtPmk5MTUsICZjbC0+YWN0aXZl
LAotCQkJIF9fY2FjaGVsaW5lX2FjdGl2ZSwgX19jYWNoZWxpbmVfcmV0aXJlKTsKKwlpOTE1X2Fj
dGl2ZV9pbml0KCZjbC0+YWN0aXZlLCBfX2NhY2hlbGluZV9hY3RpdmUsIF9fY2FjaGVsaW5lX3Jl
dGlyZSk7CiAKIAlyZXR1cm4gY2w7CiB9CkBAIC0yNTUsNyArMjU0LDcgQEAgaW50IGludGVsX3Rp
bWVsaW5lX2luaXQoc3RydWN0IGludGVsX3RpbWVsaW5lICp0aW1lbGluZSwKIAogCW11dGV4X2lu
aXQoJnRpbWVsaW5lLT5tdXRleCk7CiAKLQlJTklUX0FDVElWRV9SRVFVRVNUKCZ0aW1lbGluZS0+
bGFzdF9yZXF1ZXN0LCAmdGltZWxpbmUtPm11dGV4KTsKKwlJTklUX0FDVElWRV9GRU5DRSgmdGlt
ZWxpbmUtPmxhc3RfcmVxdWVzdCwgJnRpbWVsaW5lLT5tdXRleCk7CiAJSU5JVF9MSVNUX0hFQUQo
JnRpbWVsaW5lLT5yZXF1ZXN0cyk7CiAKIAlpOTE1X3N5bmNtYXBfaW5pdCgmdGltZWxpbmUtPnN5
bmMpOwpAQCAtNDQzLDcgKzQ0Miw3IEBAIF9faW50ZWxfdGltZWxpbmVfZ2V0X3NlcW5vKHN0cnVj
dCBpbnRlbF90aW1lbGluZSAqdGwsCiAJICogZnJlZSBpdCBhZnRlciB0aGUgY3VycmVudCByZXF1
ZXN0IGlzIHJldGlyZWQsIHdoaWNoIGVuc3VyZXMgdGhhdAogCSAqIGFsbCB3cml0ZXMgaW50byB0
aGUgY2FjaGVsaW5lIGZyb20gcHJldmlvdXMgcmVxdWVzdHMgYXJlIGNvbXBsZXRlLgogCSAqLwot
CWVyciA9IGk5MTVfYWN0aXZlX3JlZigmdGwtPmh3c3BfY2FjaGVsaW5lLT5hY3RpdmUsIHRsLCBy
cSk7CisJZXJyID0gaTkxNV9hY3RpdmVfcmVmKCZ0bC0+aHdzcF9jYWNoZWxpbmUtPmFjdGl2ZSwg
dGwsICZycS0+ZmVuY2UpOwogCWlmIChlcnIpCiAJCWdvdG8gZXJyX2NhY2hlbGluZTsKIApkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmVfdHlwZXMuaCBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lX3R5cGVzLmgKaW5kZXggYzY2
OGM0YzUwZTc1Li45OGQ5ZWUxNjYzNzkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX3RpbWVsaW5lX3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfdGltZWxpbmVfdHlwZXMuaApAQCAtNTgsMTIgKzU4LDEzIEBAIHN0cnVjdCBpbnRlbF90
aW1lbGluZSB7CiAJICovCiAJc3RydWN0IGxpc3RfaGVhZCByZXF1ZXN0czsKIAotCS8qIENvbnRh
aW5zIGFuIFJDVSBndWFyZGVkIHBvaW50ZXIgdG8gdGhlIGxhc3QgcmVxdWVzdC4gTm8gcmVmZXJl
bmNlIGlzCisJLyoKKwkgKiBDb250YWlucyBhbiBSQ1UgZ3VhcmRlZCBwb2ludGVyIHRvIHRoZSBs
YXN0IHJlcXVlc3QuIE5vIHJlZmVyZW5jZSBpcwogCSAqIGhlbGQgdG8gdGhlIHJlcXVlc3QsIHVz
ZXJzIG11c3QgY2FyZWZ1bGx5IGFjcXVpcmUgYSByZWZlcmVuY2UgdG8KLQkgKiB0aGUgcmVxdWVz
dCB1c2luZyBpOTE1X2FjdGl2ZV9yZXF1ZXN0X2dldF9yZXF1ZXN0X3JjdSgpLCBvciBob2xkIHRo
ZQotCSAqIHN0cnVjdF9tdXRleC4KKwkgKiB0aGUgcmVxdWVzdCB1c2luZyBpOTE1X2FjdGl2ZV9m
ZW5jZV9nZXQoKSwgb3IgbWFuYWdlIHRoZSBSQ1UKKwkgKiBwcm90ZWN0aW9uIHRoZW1zZWx2ZXMg
KGNmIHRoZSBpOTE1X2FjdGl2ZV9mZW5jZSBBUEkpLgogCSAqLwotCXN0cnVjdCBpOTE1X2FjdGl2
ZV9yZXF1ZXN0IGxhc3RfcmVxdWVzdDsKKwlzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgbGFzdF9y
ZXF1ZXN0OwogCiAJLyoqCiAJICogV2UgdHJhY2sgdGhlIG1vc3QgcmVjZW50IHNlcW5vIHRoYXQg
d2Ugd2FpdCBvbiBpbiBldmVyeSBjb250ZXh0IHNvCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9z
ZWxmdGVzdF9jb250ZXh0LmMKaW5kZXggNGNlMWUyNTQzM2QyLi5lNmJjYmU3YWI1ZTEgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKQEAgLTQ3LDI0ICs0Nywy
MCBAQCBzdGF0aWMgaW50IGNvbnRleHRfc3luYyhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAK
IAltdXRleF9sb2NrKCZ0bC0+bXV0ZXgpOwogCWRvIHsKLQkJc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnE7CisJCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlOwogCQlsb25nIHRpbWVvdXQ7CiAKLQkJcmN1
X3JlYWRfbG9jaygpOwotCQlycSA9IHJjdV9kZXJlZmVyZW5jZSh0bC0+bGFzdF9yZXF1ZXN0LnJl
cXVlc3QpOwotCQlpZiAocnEpCi0JCQlycSA9IGk5MTVfcmVxdWVzdF9nZXRfcmN1KHJxKTsKLQkJ
cmN1X3JlYWRfdW5sb2NrKCk7Ci0JCWlmICghcnEpCisJCWZlbmNlID0gaTkxNV9hY3RpdmVfZmVu
Y2VfZ2V0KCZ0bC0+bGFzdF9yZXF1ZXN0KTsKKwkJaWYgKCFmZW5jZSkKIAkJCWJyZWFrOwogCi0J
CXRpbWVvdXQgPSBpOTE1X3JlcXVlc3Rfd2FpdChycSwgMCwgSFogLyAxMCk7CisJCXRpbWVvdXQg
PSBkbWFfZmVuY2Vfd2FpdF90aW1lb3V0KGZlbmNlLCBmYWxzZSwgSFogLyAxMCk7CiAJCWlmICh0
aW1lb3V0IDwgMCkKIAkJCWVyciA9IHRpbWVvdXQ7CiAJCWVsc2UKLQkJCWk5MTVfcmVxdWVzdF9y
ZXRpcmVfdXB0byhycSk7CisJCQlpOTE1X3JlcXVlc3RfcmV0aXJlX3VwdG8odG9fcmVxdWVzdChm
ZW5jZSkpOwogCi0JCWk5MTVfcmVxdWVzdF9wdXQocnEpOworCQlkbWFfZmVuY2VfcHV0KGZlbmNl
KTsKIAl9IHdoaWxlICghZXJyKTsKIAltdXRleF91bmxvY2soJnRsLT5tdXRleCk7CiAKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKaW5kZXggMmRhNGZhNTE0OWNiLi4wMWQ1YTI2
YjlhYTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCkBAIC0xMTc2LDkg
KzExNzYsMTMgQEAgc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3QgKmR1bW15X3JlcXVlc3Qoc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCWlmICghcnEpCiAJCXJldHVybiBOVUxMOwog
Ci0JSU5JVF9MSVNUX0hFQUQoJnJxLT5hY3RpdmVfbGlzdCk7CiAJcnEtPmVuZ2luZSA9IGVuZ2lu
ZTsKIAorCXNwaW5fbG9ja19pbml0KCZycS0+bG9jayk7CisJSU5JVF9MSVNUX0hFQUQoJnJxLT5m
ZW5jZS5jYl9saXN0KTsKKwlycS0+ZmVuY2UubG9jayA9ICZycS0+bG9jazsKKwlycS0+ZmVuY2Uu
b3BzID0gJmk5MTVfZmVuY2Vfb3BzOworCiAJaTkxNV9zY2hlZF9ub2RlX2luaXQoJnJxLT5zY2hl
ZCk7CiAKIAkvKiBtYXJrIHRoaXMgcmVxdWVzdCBhcyBwZXJtYW5lbnRseSBpbmNvbXBsZXRlICov
CkBAIC0xMjcxLDggKzEyNzUsOCBAQCBzdGF0aWMgaW50IGxpdmVfc3VwcHJlc3Nfd2FpdF9wcmVl
bXB0KHZvaWQgKmFyZykKIAkJCQl9CiAKIAkJCQkvKiBEaXNhYmxlIE5FV0NMSUVOVCBwcm9tb3Rp
b24gKi8KLQkJCQlfX2k5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KCZpOTE1X3JlcXVlc3RfdGltZWxp
bmUocnFbaV0pLT5sYXN0X3JlcXVlc3QsCi0JCQkJCQkJICBkdW1teSk7CisJCQkJX19pOTE1X2Fj
dGl2ZV9mZW5jZV9zZXQoJmk5MTVfcmVxdWVzdF90aW1lbGluZShycVtpXSktPmxhc3RfcmVxdWVz
dCwKKwkJCQkJCQkmZHVtbXktPmZlbmNlKTsKIAkJCQlpOTE1X3JlcXVlc3RfYWRkKHJxW2ldKTsK
IAkJCX0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RzL21v
Y2tfdGltZWxpbmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0cy9tb2NrX3Rp
bWVsaW5lLmMKaW5kZXggNTk4MTcwZWZjYWY2Li4yYTc3YzA1MWYzNmEgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0cy9tb2NrX3RpbWVsaW5lLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RzL21vY2tfdGltZWxpbmUuYwpAQCAtMTUsNyAr
MTUsNyBAQCB2b2lkIG1vY2tfdGltZWxpbmVfaW5pdChzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRp
bWVsaW5lLCB1NjQgY29udGV4dCkKIAogCW11dGV4X2luaXQoJnRpbWVsaW5lLT5tdXRleCk7CiAK
LQlJTklUX0FDVElWRV9SRVFVRVNUKCZ0aW1lbGluZS0+bGFzdF9yZXF1ZXN0LCAmdGltZWxpbmUt
Pm11dGV4KTsKKwlJTklUX0FDVElWRV9GRU5DRSgmdGltZWxpbmUtPmxhc3RfcmVxdWVzdCwgJnRp
bWVsaW5lLT5tdXRleCk7CiAJSU5JVF9MSVNUX0hFQUQoJnRpbWVsaW5lLT5yZXF1ZXN0cyk7CiAK
IAlpOTE1X3N5bmNtYXBfaW5pdCgmdGltZWxpbmUtPnN5bmMpOwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0
L3NjaGVkdWxlci5jCmluZGV4IDZjNzlkMTZiMzgxZS4uMDNmNTY3MDg0NTQ4IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVyLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jCkBAIC0zODUsMTEgKzM4NSw4IEBAIGludGVsX2d2dF93
b3JrbG9hZF9yZXFfYWxsb2Moc3RydWN0IGludGVsX3ZncHVfd29ya2xvYWQgKndvcmtsb2FkKQog
ewogCXN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1ID0gd29ya2xvYWQtPnZncHU7CiAJc3RydWN0IGlu
dGVsX3ZncHVfc3VibWlzc2lvbiAqcyA9ICZ2Z3B1LT5zdWJtaXNzaW9uOwotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHZncHUtPmd2dC0+ZGV2X3ByaXY7CiAJc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnE7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJpdi0+ZHJtLnN0
cnVjdF9tdXRleCk7Ci0KIAlpZiAod29ya2xvYWQtPnJlcSkKIAkJcmV0dXJuIDA7CiAKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2FjdGl2ZS5jCmluZGV4IDdjYTA2NjY4OGI5OC4uMDIzNjUyZGVkNGJlIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMKQEAgLTEyLDggKzEyLDYgQEAKICNpbmNsdWRl
ICJpOTE1X2FjdGl2ZS5oIgogI2luY2x1ZGUgImk5MTVfZ2xvYmFscy5oIgogCi0jZGVmaW5lIEJL
TChyZWYpICgmKHJlZiktPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpCi0KIC8qCiAgKiBBY3RpdmUg
cmVmcyBtZW1vcnkgbWFuYWdlbWVudAogICoKQEAgLTI3LDM1ICsyNSwzNSBAQCBzdGF0aWMgc3Ry
dWN0IGk5MTVfZ2xvYmFsX2FjdGl2ZSB7CiB9IGdsb2JhbDsKIAogc3RydWN0IGFjdGl2ZV9ub2Rl
IHsKLQlzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCBiYXNlOworCXN0cnVjdCBpOTE1X2FjdGl2
ZV9mZW5jZSBiYXNlOwogCXN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmOwogCXN0cnVjdCByYl9ub2Rl
IG5vZGU7CiAJdTY0IHRpbWVsaW5lOwogfTsKIAogc3RhdGljIGlubGluZSBzdHJ1Y3QgYWN0aXZl
X25vZGUgKgotbm9kZV9mcm9tX2FjdGl2ZShzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0
aXZlKQorbm9kZV9mcm9tX2FjdGl2ZShzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2ZSkK
IHsKIAlyZXR1cm4gY29udGFpbmVyX29mKGFjdGl2ZSwgc3RydWN0IGFjdGl2ZV9ub2RlLCBiYXNl
KTsKIH0KIAogI2RlZmluZSB0YWtlX3ByZWFsbG9jYXRlZF9iYXJyaWVycyh4KSBsbGlzdF9kZWxf
YWxsKCYoeCktPnByZWFsbG9jYXRlZF9iYXJyaWVycykKIAotc3RhdGljIGlubGluZSBib29sIGlz
X2JhcnJpZXIoY29uc3Qgc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSkKK3N0YXRp
YyBpbmxpbmUgYm9vbCBpc19iYXJyaWVyKGNvbnN0IHN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAq
YWN0aXZlKQogewotCXJldHVybiBJU19FUlIocmN1X2FjY2Vzc19wb2ludGVyKGFjdGl2ZS0+cmVx
dWVzdCkpOworCXJldHVybiBJU19FUlIocmN1X2FjY2Vzc19wb2ludGVyKGFjdGl2ZS0+ZmVuY2Up
KTsKIH0KIAogc3RhdGljIGlubGluZSBzdHJ1Y3QgbGxpc3Rfbm9kZSAqYmFycmllcl90b19sbChz
dHJ1Y3QgYWN0aXZlX25vZGUgKm5vZGUpCiB7CiAJR0VNX0JVR19PTighaXNfYmFycmllcigmbm9k
ZS0+YmFzZSkpOwotCXJldHVybiAoc3RydWN0IGxsaXN0X25vZGUgKikmbm9kZS0+YmFzZS5saW5r
OworCXJldHVybiAoc3RydWN0IGxsaXN0X25vZGUgKikmbm9kZS0+YmFzZS5jYi5ub2RlOwogfQog
CiBzdGF0aWMgaW5saW5lIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKgogX19iYXJyaWVyX3RvX2Vu
Z2luZShzdHJ1Y3QgYWN0aXZlX25vZGUgKm5vZGUpCiB7Ci0JcmV0dXJuIChzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICopUkVBRF9PTkNFKG5vZGUtPmJhc2UubGluay5wcmV2KTsKKwlyZXR1cm4gKHN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKilSRUFEX09OQ0Uobm9kZS0+YmFzZS5jYi5ub2RlLnByZXYp
OwogfQogCiBzdGF0aWMgaW5saW5lIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKgpAQCAtNjgsNyAr
NjYsNyBAQCBiYXJyaWVyX3RvX2VuZ2luZShzdHJ1Y3QgYWN0aXZlX25vZGUgKm5vZGUpCiBzdGF0
aWMgaW5saW5lIHN0cnVjdCBhY3RpdmVfbm9kZSAqYmFycmllcl9mcm9tX2xsKHN0cnVjdCBsbGlz
dF9ub2RlICp4KQogewogCXJldHVybiBjb250YWluZXJfb2YoKHN0cnVjdCBsaXN0X2hlYWQgKil4
LAotCQkJICAgIHN0cnVjdCBhY3RpdmVfbm9kZSwgYmFzZS5saW5rKTsKKwkJCSAgICBzdHJ1Y3Qg
YWN0aXZlX25vZGUsIGJhc2UuY2Iubm9kZSk7CiB9CiAKICNpZiBJU19FTkFCTEVEKENPTkZJR19E
Uk1fSTkxNV9ERUJVR19HRU0pICYmIElTX0VOQUJMRUQoQ09ORklHX0RFQlVHX09CSkVDVFMpCkBA
IC0xNDcsMTUgKzE0NSwxOCBAQCBfX2FjdGl2ZV9yZXRpcmUoc3RydWN0IGk5MTVfYWN0aXZlICpy
ZWYpCiAJaWYgKCFyZXRpcmUpCiAJCXJldHVybjsKIAotCUdFTV9CVUdfT04ocmN1X2FjY2Vzc19w
b2ludGVyKHJlZi0+ZXhjbCkpOworCUdFTV9CVUdfT04ocmN1X2FjY2Vzc19wb2ludGVyKHJlZi0+
ZXhjbC5mZW5jZSkpOwogCXJidHJlZV9wb3N0b3JkZXJfZm9yX2VhY2hfZW50cnlfc2FmZShpdCwg
biwgJnJvb3QsIG5vZGUpIHsKLQkJR0VNX0JVR19PTihpOTE1X2FjdGl2ZV9yZXF1ZXN0X2lzc2V0
KCZpdC0+YmFzZSkpOworCQlHRU1fQlVHX09OKGk5MTVfYWN0aXZlX2ZlbmNlX2lzc2V0KCZpdC0+
YmFzZSkpOwogCQlrbWVtX2NhY2hlX2ZyZWUoZ2xvYmFsLnNsYWJfY2FjaGUsIGl0KTsKIAl9CiAK
IAkvKiBBZnRlciB0aGUgZmluYWwgcmV0aXJlLCB0aGUgZW50aXJlIHN0cnVjdCBtYXkgYmUgZnJl
ZWQgKi8KIAlpZiAocmVmLT5yZXRpcmUpCiAJCXJlZi0+cmV0aXJlKHJlZik7CisKKwkvKiAuLi4g
ZXhjZXB0IGlmIHlvdSB3YWl0IG9uIGl0LCB5b3UgbXVzdCBtYW5hZ2UgeW91ciBvd24gcmVmZXJl
bmNlcyEgKi8KKwl3YWtlX3VwX3ZhcihyZWYpOwogfQogCiBzdGF0aWMgdm9pZApAQCAtMTg5LDEy
ICsxOTAsMjAgQEAgYWN0aXZlX3JldGlyZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIH0KIAog
c3RhdGljIHZvaWQKLW5vZGVfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICpiYXNl
LCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKK25vZGVfcmV0aXJlKHN0cnVjdCBkbWFfZmVuY2Ug
KmZlbmNlLCBzdHJ1Y3QgZG1hX2ZlbmNlX2NiICpjYikKIHsKLQlhY3RpdmVfcmV0aXJlKG5vZGVf
ZnJvbV9hY3RpdmUoYmFzZSktPnJlZik7CisJaTkxNV9hY3RpdmVfZmVuY2VfY2IoZmVuY2UsIGNi
KTsKKwlhY3RpdmVfcmV0aXJlKGNvbnRhaW5lcl9vZihjYiwgc3RydWN0IGFjdGl2ZV9ub2RlLCBi
YXNlLmNiKS0+cmVmKTsKIH0KIAotc3RhdGljIHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICoK
K3N0YXRpYyB2b2lkCitleGNsX3JldGlyZShzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSwgc3RydWN0
IGRtYV9mZW5jZV9jYiAqY2IpCit7CisJaTkxNV9hY3RpdmVfZmVuY2VfY2IoZmVuY2UsIGNiKTsK
KwlhY3RpdmVfcmV0aXJlKGNvbnRhaW5lcl9vZihjYiwgc3RydWN0IGk5MTVfYWN0aXZlLCBleGNs
LmNiKSk7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKgogYWN0aXZlX2lu
c3RhbmNlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCBzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRs
KQogewogCXN0cnVjdCBhY3RpdmVfbm9kZSAqbm9kZSwgKnByZWFsbG9jOwpAQCAtMjM4LDcgKzI0
Nyw3IEBAIGFjdGl2ZV9pbnN0YW5jZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgc3RydWN0IGlu
dGVsX3RpbWVsaW5lICp0bCkKIAl9CiAKIAlub2RlID0gcHJlYWxsb2M7Ci0JaTkxNV9hY3RpdmVf
cmVxdWVzdF9pbml0KCZub2RlLT5iYXNlLCAmdGwtPm11dGV4LCBOVUxMLCBub2RlX3JldGlyZSk7
CisJX19pOTE1X2FjdGl2ZV9mZW5jZV9pbml0KCZub2RlLT5iYXNlLCAmdGwtPm11dGV4LCBOVUxM
LCBub2RlX3JldGlyZSk7CiAJbm9kZS0+cmVmID0gcmVmOwogCW5vZGUtPnRpbWVsaW5lID0gaWR4
OwogCkBAIC0yNTMsOCArMjYyLDcgQEAgYWN0aXZlX2luc3RhbmNlKHN0cnVjdCBpOTE1X2FjdGl2
ZSAqcmVmLCBzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsKQogCXJldHVybiAmbm9kZS0+YmFzZTsK
IH0KIAotdm9pZCBfX2k5MTVfYWN0aXZlX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCi0JCQlzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKK3ZvaWQgX19pOTE1X2FjdGl2ZV9pbml0
KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLAogCQkJaW50ICgqYWN0aXZlKShzdHJ1Y3QgaTkxNV9h
Y3RpdmUgKnJlZiksCiAJCQl2b2lkICgqcmV0aXJlKShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiks
CiAJCQlzdHJ1Y3QgbG9ja19jbGFzc19rZXkgKmtleSkKQEAgLTI2MywxOSArMjcxLDE4IEBAIHZv
aWQgX19pOTE1X2FjdGl2ZV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCiAJ
ZGVidWdfYWN0aXZlX2luaXQocmVmKTsKIAotCXJlZi0+aTkxNSA9IGk5MTU7CiAJcmVmLT5mbGFn
cyA9IDA7CiAJcmVmLT5hY3RpdmUgPSBhY3RpdmU7CiAJcmVmLT5yZXRpcmUgPSBwdHJfdW5wYWNr
X2JpdHMocmV0aXJlLCAmYml0cywgMik7CiAJaWYgKGJpdHMgJiBJOTE1X0FDVElWRV9NQVlfU0xF
RVApCiAJCXJlZi0+ZmxhZ3MgfD0gSTkxNV9BQ1RJVkVfUkVUSVJFX1NMRUVQUzsKIAotCXJlZi0+
ZXhjbCA9IE5VTEw7CiAJcmVmLT50cmVlID0gUkJfUk9PVDsKIAlyZWYtPmNhY2hlID0gTlVMTDsK
IAlpbml0X2xsaXN0X2hlYWQoJnJlZi0+cHJlYWxsb2NhdGVkX2JhcnJpZXJzKTsKIAlhdG9taWNf
c2V0KCZyZWYtPmNvdW50LCAwKTsKIAlfX211dGV4X2luaXQoJnJlZi0+bXV0ZXgsICJpOTE1X2Fj
dGl2ZSIsIGtleSk7CisJX19pOTE1X2FjdGl2ZV9mZW5jZV9pbml0KCZyZWYtPmV4Y2wsICZyZWYt
Pm11dGV4LCBOVUxMLCBleGNsX3JldGlyZSk7CiAJSU5JVF9XT1JLKCZyZWYtPndvcmssIGFjdGl2
ZV93b3JrKTsKIH0KIApAQCAtMzI5LDkgKzMzNiw5IEBAIF9fYWN0aXZlX2RlbF9iYXJyaWVyKHN0
cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCBzdHJ1Y3QgYWN0aXZlX25vZGUgKm5vZGUpCiAKIGludCBp
OTE1X2FjdGl2ZV9yZWYoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCiAJCSAgICBzdHJ1Y3QgaW50
ZWxfdGltZWxpbmUgKnRsLAotCQkgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCisJCSAgICBz
dHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSkKIHsKLQlzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAq
YWN0aXZlOworCXN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlOwogCWludCBlcnI7CiAK
IAlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ0bC0+bXV0ZXgpOwpAQCAtMzU0LDY2ICszNjEsNDQgQEAg
aW50IGk5MTVfYWN0aXZlX3JlZihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKIAkJICogcmVxdWVz
dCB0aGF0IHdlIHdhbnQgdG8gZW1pdCBvbiB0aGUga2VybmVsX2NvbnRleHQuCiAJCSAqLwogCQlf
X2FjdGl2ZV9kZWxfYmFycmllcihyZWYsIG5vZGVfZnJvbV9hY3RpdmUoYWN0aXZlKSk7Ci0JCVJD
VV9JTklUX1BPSU5URVIoYWN0aXZlLT5yZXF1ZXN0LCBOVUxMKTsKLQkJSU5JVF9MSVNUX0hFQUQo
JmFjdGl2ZS0+bGluayk7Ci0JfSBlbHNlIHsKLQkJaWYgKCFpOTE1X2FjdGl2ZV9yZXF1ZXN0X2lz
c2V0KGFjdGl2ZSkpCi0JCQlhdG9taWNfaW5jKCZyZWYtPmNvdW50KTsKKwkJUkNVX0lOSVRfUE9J
TlRFUihhY3RpdmUtPmZlbmNlLCBOVUxMKTsKKwkJYXRvbWljX2RlYygmcmVmLT5jb3VudCk7CiAJ
fQotCUdFTV9CVUdfT04oIWF0b21pY19yZWFkKCZyZWYtPmNvdW50KSk7Ci0JX19pOTE1X2FjdGl2
ZV9yZXF1ZXN0X3NldChhY3RpdmUsIHJxKTsKKwlpZiAoIV9faTkxNV9hY3RpdmVfZmVuY2Vfc2V0
KGFjdGl2ZSwgZmVuY2UpKQorCQlhdG9taWNfaW5jKCZyZWYtPmNvdW50KTsKIAogb3V0OgogCWk5
MTVfYWN0aXZlX3JlbGVhc2UocmVmKTsKIAlyZXR1cm4gZXJyOwogfQogCi1zdGF0aWMgdm9pZCBl
eGNsX2NiKHN0cnVjdCBkbWFfZmVuY2UgKmYsIHN0cnVjdCBkbWFfZmVuY2VfY2IgKmNiKQotewot
CXN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmID0gY29udGFpbmVyX29mKGNiLCB0eXBlb2YoKnJlZiks
IGV4Y2xfY2IpOwotCi0JUkNVX0lOSVRfUE9JTlRFUihyZWYtPmV4Y2wsIE5VTEwpOwotCWRtYV9m
ZW5jZV9wdXQoZik7Ci0KLQlhY3RpdmVfcmV0aXJlKHJlZik7Ci19Ci0KIHZvaWQgaTkxNV9hY3Rp
dmVfc2V0X2V4Y2x1c2l2ZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgc3RydWN0IGRtYV9mZW5j
ZSAqZikKIHsKIAkvKiBXZSBleHBlY3QgdGhlIGNhbGxlciB0byBtYW5hZ2UgdGhlIGV4Y2x1c2l2
ZSB0aW1lbGluZSBvcmRlcmluZyAqLwogCUdFTV9CVUdfT04oaTkxNV9hY3RpdmVfaXNfaWRsZShy
ZWYpKTsKIAotCWRtYV9mZW5jZV9nZXQoZik7Ci0KLQlyY3VfcmVhZF9sb2NrKCk7Ci0JaWYgKHJj
dV9hY2Nlc3NfcG9pbnRlcihyZWYtPmV4Y2wpKSB7Ci0JCXN0cnVjdCBkbWFfZmVuY2UgKm9sZDsK
LQotCQlvbGQgPSBkbWFfZmVuY2VfZ2V0X3JjdV9zYWZlKCZyZWYtPmV4Y2wpOwotCQlpZiAob2xk
KSB7Ci0JCQlpZiAoZG1hX2ZlbmNlX3JlbW92ZV9jYWxsYmFjayhvbGQsICZyZWYtPmV4Y2xfY2Ip
KQotCQkJCWF0b21pY19kZWMoJnJlZi0+Y291bnQpOwotCQkJZG1hX2ZlbmNlX3B1dChvbGQpOwot
CQl9Ci0JfQotCXJjdV9yZWFkX3VubG9jaygpOwotCi0JYXRvbWljX2luYygmcmVmLT5jb3VudCk7
Ci0JcmN1X2Fzc2lnbl9wb2ludGVyKHJlZi0+ZXhjbCwgZik7CisJLyoKKwkgKiBBcyB3ZSBkb24n
dCBrbm93IHdoaWNoIG11dGV4IHRoZSBjYWxsZXIgaXMgdXNpbmcsIHdlIHRvbGQgYSBzbWFsbAor
CSAqIGxpZSB0byB0aGUgZGVidWcgY29kZSB0aGF0IGl0IGlzIHVzaW5nIHRoZSBpOTE1X2FjdGl2
ZS5tdXRleDsKKwkgKiBhbmQgbm93IHdlIG11c3Qgc3RpY2sgdG8gdGhhdCBsaWUuCisJICovCisJ
bXV0ZXhfYWNxdWlyZSgmcmVmLT5tdXRleC5kZXBfbWFwLCAwLCAwLCBfVEhJU19JUF8pOworCWlm
ICghX19pOTE1X2FjdGl2ZV9mZW5jZV9zZXQoJnJlZi0+ZXhjbCwgZikpCisJCWF0b21pY19pbmMo
JnJlZi0+Y291bnQpOworCW11dGV4X3JlbGVhc2UoJnJlZi0+bXV0ZXguZGVwX21hcCwgMCwgX1RI
SVNfSVBfKTsKK30KIAotCWlmIChkbWFfZmVuY2VfYWRkX2NhbGxiYWNrKGYsICZyZWYtPmV4Y2xf
Y2IsIGV4Y2xfY2IpKSB7Ci0JCVJDVV9JTklUX1BPSU5URVIocmVmLT5leGNsLCBOVUxMKTsKLQkJ
YXRvbWljX2RlYygmcmVmLT5jb3VudCk7Ci0JCWRtYV9mZW5jZV9wdXQoZik7Ci0JfQorYm9vbCBp
OTE1X2FjdGl2ZV9hY3F1aXJlX2lmX2J1c3koc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCit7CisJ
ZGVidWdfYWN0aXZlX2Fzc2VydChyZWYpOworCXJldHVybiBhdG9taWNfYWRkX3VubGVzcygmcmVm
LT5jb3VudCwgMSwgMCk7CiB9CiAKIGludCBpOTE1X2FjdGl2ZV9hY3F1aXJlKHN0cnVjdCBpOTE1
X2FjdGl2ZSAqcmVmKQogewogCWludCBlcnI7CiAKLQlkZWJ1Z19hY3RpdmVfYXNzZXJ0KHJlZik7
Ci0JaWYgKGF0b21pY19hZGRfdW5sZXNzKCZyZWYtPmNvdW50LCAxLCAwKSkKKwlpZiAoaTkxNV9h
Y3RpdmVfYWNxdWlyZV9pZl9idXN5KHJlZikpCiAJCXJldHVybiAwOwogCiAJZXJyID0gbXV0ZXhf
bG9ja19pbnRlcnJ1cHRpYmxlKCZyZWYtPm11dGV4KTsKQEAgLTQzOCwxMjEgKzQyMyw1NyBAQCB2
b2lkIGk5MTVfYWN0aXZlX3JlbGVhc2Uoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiAJYWN0aXZl
X3JldGlyZShyZWYpOwogfQogCi1zdGF0aWMgdm9pZCBfX2FjdGl2ZV91bmdyYWIoc3RydWN0IGk5
MTVfYWN0aXZlICpyZWYpCi17Ci0JY2xlYXJfYW5kX3dha2VfdXBfYml0KEk5MTVfQUNUSVZFX0dS
QUJfQklULCAmcmVmLT5mbGFncyk7Ci19Ci0KLWJvb2wgaTkxNV9hY3RpdmVfdHJ5Z3JhYihzdHJ1
Y3QgaTkxNV9hY3RpdmUgKnJlZikKK3N0YXRpYyB2b2lkIGVuYWJsZV9zaWduYWxpbmcoc3RydWN0
IGk5MTVfYWN0aXZlX2ZlbmNlICphY3RpdmUpCiB7Ci0JZGVidWdfYWN0aXZlX2Fzc2VydChyZWYp
OwotCi0JaWYgKHRlc3RfYW5kX3NldF9iaXQoSTkxNV9BQ1RJVkVfR1JBQl9CSVQsICZyZWYtPmZs
YWdzKSkKLQkJcmV0dXJuIGZhbHNlOwotCi0JaWYgKCFhdG9taWNfYWRkX3VubGVzcygmcmVmLT5j
b3VudCwgMSwgMCkpIHsKLQkJX19hY3RpdmVfdW5ncmFiKHJlZik7Ci0JCXJldHVybiBmYWxzZTsK
LQl9CisJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CiAKLQlyZXR1cm4gdHJ1ZTsKLX0KLQotdm9p
ZCBpOTE1X2FjdGl2ZV91bmdyYWIoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCi17Ci0JR0VNX0JV
R19PTighdGVzdF9iaXQoSTkxNV9BQ1RJVkVfR1JBQl9CSVQsICZyZWYtPmZsYWdzKSk7Ci0KLQlh
Y3RpdmVfcmV0aXJlKHJlZik7Ci0JX19hY3RpdmVfdW5ncmFiKHJlZik7Ci19Ci0KLXN0YXRpYyBp
bnQgZXhjbF93YWl0KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQotewotCXN0cnVjdCBkbWFfZmVu
Y2UgKm9sZDsKLQlpbnQgZXJyID0gMDsKLQotCWlmICghcmN1X2FjY2Vzc19wb2ludGVyKHJlZi0+
ZXhjbCkpCi0JCXJldHVybiAwOwotCi0JcmN1X3JlYWRfbG9jaygpOwotCW9sZCA9IGRtYV9mZW5j
ZV9nZXRfcmN1X3NhZmUoJnJlZi0+ZXhjbCk7Ci0JcmN1X3JlYWRfdW5sb2NrKCk7Ci0JaWYgKG9s
ZCkgewotCQllcnIgPSBkbWFfZmVuY2Vfd2FpdChvbGQsIHRydWUpOwotCQlkbWFfZmVuY2VfcHV0
KG9sZCk7Ci0JfQorCWZlbmNlID0gaTkxNV9hY3RpdmVfZmVuY2VfZ2V0KGFjdGl2ZSk7CisJaWYg
KCFmZW5jZSkKKwkJcmV0dXJuOwogCi0JcmV0dXJuIGVycjsKKwlkbWFfZmVuY2VfZW5hYmxlX3N3
X3NpZ25hbGluZyhmZW5jZSk7CisJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CiB9CiAKIGludCBpOTE1
X2FjdGl2ZV93YWl0KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQogewogCXN0cnVjdCBhY3RpdmVf
bm9kZSAqaXQsICpuOwotCWludCBlcnI7CisJaW50IGVyciA9IDA7CiAKIAltaWdodF9zbGVlcCgp
OwotCW1pZ2h0X2xvY2soJnJlZi0+bXV0ZXgpOwotCi0JaWYgKGk5MTVfYWN0aXZlX2lzX2lkbGUo
cmVmKSkKLQkJcmV0dXJuIDA7Ci0KLQllcnIgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJnJl
Zi0+bXV0ZXgpOwotCWlmIChlcnIpCi0JCXJldHVybiBlcnI7CiAKLQlpZiAoIWF0b21pY19hZGRf
dW5sZXNzKCZyZWYtPmNvdW50LCAxLCAwKSkgewotCQltdXRleF91bmxvY2soJnJlZi0+bXV0ZXgp
OworCWlmICghaTkxNV9hY3RpdmVfYWNxdWlyZV9pZl9idXN5KHJlZikpCiAJCXJldHVybiAwOwot
CX0KLQotCWVyciA9IGV4Y2xfd2FpdChyZWYpOwotCWlmIChlcnIpCi0JCWdvdG8gb3V0OwogCisJ
LyogRmx1c2ggbGF6eSBzaWduYWxzICovCisJZW5hYmxlX3NpZ25hbGluZygmcmVmLT5leGNsKTsK
IAlyYnRyZWVfcG9zdG9yZGVyX2Zvcl9lYWNoX2VudHJ5X3NhZmUoaXQsIG4sICZyZWYtPnRyZWUs
IG5vZGUpIHsKLQkJaWYgKGlzX2JhcnJpZXIoJml0LT5iYXNlKSkgeyAvKiB1bmNvbm5lY3RlZCBp
ZGxlLWJhcnJpZXIgKi8KLQkJCWVyciA9IC1FQlVTWTsKLQkJCWJyZWFrOwotCQl9CisJCWlmIChp
c19iYXJyaWVyKCZpdC0+YmFzZSkpIC8qIHVuY29ubmVjdGVkIGlkbGUgYmFycmllciAqLworCQkJ
Y29udGludWU7CiAKLQkJZXJyID0gaTkxNV9hY3RpdmVfcmVxdWVzdF9yZXRpcmUoJml0LT5iYXNl
LCBCS0wocmVmKSk7Ci0JCWlmIChlcnIpCi0JCQlicmVhazsKKwkJZW5hYmxlX3NpZ25hbGluZygm
aXQtPmJhc2UpOwogCX0KKwkvKiBBbnkgZmVuY2UgYWRkZWQgYWZ0ZXIgdGhlIHdhaXQgYmVnaW5z
IHdpbGwgbm90IGJlIGF1dG8tc2lnbmFsZWQgKi8KIAotb3V0OgotCV9fYWN0aXZlX3JldGlyZShy
ZWYpOworCWk5MTVfYWN0aXZlX3JlbGVhc2UocmVmKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJy
OwogCi0JaWYgKHdhaXRfb25fYml0KCZyZWYtPmZsYWdzLCBJOTE1X0FDVElWRV9HUkFCX0JJVCwg
VEFTS19LSUxMQUJMRSkpCisJaWYgKHdhaXRfdmFyX2V2ZW50X2ludGVycnVwdGlibGUocmVmLCBp
OTE1X2FjdGl2ZV9pc19pZGxlKHJlZikpKQogCQlyZXR1cm4gLUVJTlRSOwogCi0JZmx1c2hfd29y
aygmcmVmLT53b3JrKTsKLQlpZiAoIWk5MTVfYWN0aXZlX2lzX2lkbGUocmVmKSkKLQkJcmV0dXJu
IC1FQlVTWTsKLQogCXJldHVybiAwOwogfQogCi1pbnQgaTkxNV9yZXF1ZXN0X2F3YWl0X2FjdGl2
ZV9yZXF1ZXN0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAotCQkJCSAgICAgIHN0cnVjdCBpOTE1
X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUpCi17Ci0Jc3RydWN0IGk5MTVfcmVxdWVzdCAqYmFycmll
ciA9Ci0JCWk5MTVfYWN0aXZlX3JlcXVlc3RfcmF3KGFjdGl2ZSwgJnJxLT5pOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKLQotCXJldHVybiBiYXJyaWVyID8gaTkxNV9yZXF1ZXN0X2F3YWl0X2RtYV9m
ZW5jZShycSwgJmJhcnJpZXItPmZlbmNlKSA6IDA7Ci19Ci0KIGludCBpOTE1X3JlcXVlc3RfYXdh
aXRfYWN0aXZlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJl
ZikKIHsKIAlpbnQgZXJyID0gMDsKIAotCWlmIChyY3VfYWNjZXNzX3BvaW50ZXIocmVmLT5leGNs
KSkgeworCWlmIChyY3VfYWNjZXNzX3BvaW50ZXIocmVmLT5leGNsLmZlbmNlKSkgewogCQlzdHJ1
Y3QgZG1hX2ZlbmNlICpmZW5jZTsKIAogCQlyY3VfcmVhZF9sb2NrKCk7Ci0JCWZlbmNlID0gZG1h
X2ZlbmNlX2dldF9yY3Vfc2FmZSgmcmVmLT5leGNsKTsKKwkJZmVuY2UgPSBkbWFfZmVuY2VfZ2V0
X3JjdV9zYWZlKCZyZWYtPmV4Y2wuZmVuY2UpOwogCQlyY3VfcmVhZF91bmxvY2soKTsKIAkJaWYg
KGZlbmNlKSB7CiAJCQllcnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfZG1hX2ZlbmNlKHJxLCBmZW5j
ZSk7CkBAIC01NzgsNyArNDk5LDcgQEAgdm9pZCBpOTE1X2FjdGl2ZV9maW5pKHN0cnVjdCBpOTE1
X2FjdGl2ZSAqcmVmKQogCiBzdGF0aWMgaW5saW5lIGJvb2wgaXNfaWRsZV9iYXJyaWVyKHN0cnVj
dCBhY3RpdmVfbm9kZSAqbm9kZSwgdTY0IGlkeCkKIHsKLQlyZXR1cm4gbm9kZS0+dGltZWxpbmUg
PT0gaWR4ICYmICFpOTE1X2FjdGl2ZV9yZXF1ZXN0X2lzc2V0KCZub2RlLT5iYXNlKTsKKwlyZXR1
cm4gbm9kZS0+dGltZWxpbmUgPT0gaWR4ICYmICFpOTE1X2FjdGl2ZV9mZW5jZV9pc3NldCgmbm9k
ZS0+YmFzZSk7CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgYWN0aXZlX25vZGUgKnJldXNlX2lkbGVfYmFy
cmllcihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgdTY0IGlkeCkKQEAgLTY5OCwxMyArNjE5LDEz
IEBAIGludCBpOTE1X2FjdGl2ZV9hY3F1aXJlX3ByZWFsbG9jYXRlX2JhcnJpZXIoc3RydWN0IGk5
MTVfYWN0aXZlICpyZWYsCiAJCQlub2RlLT5iYXNlLmxvY2sgPQogCQkJCSZlbmdpbmUtPmtlcm5l
bF9jb250ZXh0LT50aW1lbGluZS0+bXV0ZXg7CiAjZW5kaWYKLQkJCVJDVV9JTklUX1BPSU5URVIo
bm9kZS0+YmFzZS5yZXF1ZXN0LCBOVUxMKTsKLQkJCW5vZGUtPmJhc2UucmV0aXJlID0gbm9kZV9y
ZXRpcmU7CisJCQlSQ1VfSU5JVF9QT0lOVEVSKG5vZGUtPmJhc2UuZmVuY2UsIE5VTEwpOworCQkJ
bm9kZS0+YmFzZS5jYi5mdW5jID0gbm9kZV9yZXRpcmU7CiAJCQlub2RlLT50aW1lbGluZSA9IGlk
eDsKIAkJCW5vZGUtPnJlZiA9IHJlZjsKIAkJfQogCi0JCWlmICghaTkxNV9hY3RpdmVfcmVxdWVz
dF9pc3NldCgmbm9kZS0+YmFzZSkpIHsKKwkJaWYgKCFpOTE1X2FjdGl2ZV9mZW5jZV9pc3NldCgm
bm9kZS0+YmFzZSkpIHsKIAkJCS8qCiAJCQkgKiBNYXJrIHRoaXMgYXMgYmVpbmcgKm91ciogdW5j
b25uZWN0ZWQgcHJvdG8tbm9kZS4KIAkJCSAqCkBAIC03MTQsOCArNjM1LDggQEAgaW50IGk5MTVf
YWN0aXZlX2FjcXVpcmVfcHJlYWxsb2NhdGVfYmFycmllcihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJl
ZiwKIAkJCSAqIGFuZCB0aGVuIHdlIGNhbiB1c2UgdGhlIHJiX25vZGUgYW5kIGxpc3QgcG9pbnRl
cnMKIAkJCSAqIGZvciBvdXIgdHJhY2tpbmcgb2YgdGhlIHBlbmRpbmcgYmFycmllci4KIAkJCSAq
LwotCQkJUkNVX0lOSVRfUE9JTlRFUihub2RlLT5iYXNlLnJlcXVlc3QsIEVSUl9QVFIoLUVBR0FJ
TikpOwotCQkJbm9kZS0+YmFzZS5saW5rLnByZXYgPSAodm9pZCAqKWVuZ2luZTsKKwkJCVJDVV9J
TklUX1BPSU5URVIobm9kZS0+YmFzZS5mZW5jZSwgRVJSX1BUUigtRUFHQUlOKSk7CisJCQlub2Rl
LT5iYXNlLmNiLm5vZGUucHJldiA9ICh2b2lkICopZW5naW5lOwogCQkJYXRvbWljX2luYygmcmVm
LT5jb3VudCk7CiAJCX0KIApAQCAtNzgyLDQ0ICs3MDMsMTEzIEBAIHZvaWQgaTkxNV9yZXF1ZXN0
X2FkZF9hY3RpdmVfYmFycmllcnMoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7CiAJc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lID0gcnEtPmVuZ2luZTsKIAlzdHJ1Y3QgbGxpc3Rfbm9k
ZSAqbm9kZSwgKm5leHQ7CisJdW5zaWduZWQgbG9uZyBmbGFnczsKIAogCUdFTV9CVUdfT04oaW50
ZWxfZW5naW5lX2lzX3ZpcnR1YWwoZW5naW5lKSk7CiAJR0VNX0JVR19PTihpOTE1X3JlcXVlc3Rf
dGltZWxpbmUocnEpICE9IGVuZ2luZS0+a2VybmVsX2NvbnRleHQtPnRpbWVsaW5lKTsKIAorCW5v
ZGUgPSBsbGlzdF9kZWxfYWxsKCZlbmdpbmUtPmJhcnJpZXJfdGFza3MpOworCWlmICghbm9kZSkK
KwkJcmV0dXJuOwogCS8qCiAJICogQXR0YWNoIHRoZSBsaXN0IG9mIHByb3RvLWZlbmNlcyB0byB0
aGUgaW4tZmxpZ2h0IHJlcXVlc3Qgc3VjaAogCSAqIHRoYXQgdGhlIHBhcmVudCBpOTE1X2FjdGl2
ZSB3aWxsIGJlIHJlbGVhc2VkIHdoZW4gdGhpcyByZXF1ZXN0CiAJICogaXMgcmV0aXJlZC4KIAkg
Ki8KLQlsbGlzdF9mb3JfZWFjaF9zYWZlKG5vZGUsIG5leHQsIGxsaXN0X2RlbF9hbGwoJmVuZ2lu
ZS0+YmFycmllcl90YXNrcykpIHsKLQkJUkNVX0lOSVRfUE9JTlRFUihiYXJyaWVyX2Zyb21fbGwo
bm9kZSktPmJhc2UucmVxdWVzdCwgcnEpOworCXNwaW5fbG9ja19pcnFzYXZlKCZycS0+bG9jaywg
ZmxhZ3MpOworCWxsaXN0X2Zvcl9lYWNoX3NhZmUobm9kZSwgbmV4dCwgbm9kZSkgeworCQlSQ1Vf
SU5JVF9QT0lOVEVSKGJhcnJpZXJfZnJvbV9sbChub2RlKS0+YmFzZS5mZW5jZSwgJnJxLT5mZW5j
ZSk7CiAJCXNtcF93bWIoKTsgLyogc2VyaWFsaXNlIHdpdGggcmV1c2VfaWRsZV9iYXJyaWVyICov
Ci0JCWxpc3RfYWRkX3RhaWwoKHN0cnVjdCBsaXN0X2hlYWQgKilub2RlLCAmcnEtPmFjdGl2ZV9s
aXN0KTsKKwkJbGlzdF9hZGRfdGFpbCgoc3RydWN0IGxpc3RfaGVhZCAqKW5vZGUsICZycS0+ZmVu
Y2UuY2JfbGlzdCk7CisJfQorCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnJxLT5sb2NrLCBmbGFn
cyk7Cit9CisKKyNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9ERUJVR19HRU0pCisjZGVm
aW5lIGFjdGl2ZV9pc19oZWxkKGFjdGl2ZSkgbG9ja2RlcF9pc19oZWxkKChhY3RpdmUpLT5sb2Nr
KQorI2Vsc2UKKyNkZWZpbmUgYWN0aXZlX2lzX2hlbGQoYWN0aXZlKSB0cnVlCisjZW5kaWYKKwor
LyoKKyAqIF9faTkxNV9hY3RpdmVfZmVuY2Vfc2V0OiBVcGRhdGUgdGhlIGxhc3QgYWN0aXZlIGZl
bmNlIGFsb25nIGl0cyB0aW1lbGluZQorICogQGFjdGl2ZTogdGhlIGFjdGl2ZSB0cmFja2VyCisg
KiBAZmVuY2U6IHRoZSBuZXcgZmVuY2UgKHVuZGVyIGNvbnN0cnVjdGlvbikKKyAqCisgKiBSZWNv
cmRzIHRoZSBuZXcgQGZlbmNlIGFzIHRoZSBsYXN0IGFjdGl2ZSBmZW5jZSBhbG9uZyBpdHMgdGlt
ZWxpbmUgaW4KKyAqIHRoaXMgYWN0aXZlIHRyYWNrZXIsIG1vdmluZyB0aGUgdHJhY2tpbmcgY2Fs
bGJhY2tzIGZyb20gdGhlIHByZXZpb3VzCisgKiBmZW5jZSBvbnRvIHRoaXMgb25lLiBSZXR1cm5z
IHRoZSBwcmV2aW91cyBmZW5jZSAoaWYgbm90IGFscmVhZHkgY29tcGxldGVkKSwKKyAqIHdoaWNo
IHRoZSBjYWxsZXIgbXVzdCBlbnN1cmUgaXMgZXhlY3V0ZWQgYmVmb3JlIHRoZSBuZXcgZmVuY2Uu
IFRvIGVuc3VyZQorICogdGhhdCB0aGUgb3JkZXIgb2YgZmVuY2VzIHdpdGhpbiB0aGUgdGltZWxp
bmUgb2YgdGhlIGk5MTVfYWN0aXZlX2ZlbmNlIGlzCisgKiBtYWludGFpbmVkLCBpdCBtdXN0IGJl
IGxvY2tlZCBieSB0aGUgY2FsbGVyLgorICovCitzdHJ1Y3QgZG1hX2ZlbmNlICoKK19faTkxNV9h
Y3RpdmVfZmVuY2Vfc2V0KHN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlLAorCQkJc3Ry
dWN0IGRtYV9mZW5jZSAqZmVuY2UpCit7CisJc3RydWN0IGRtYV9mZW5jZSAqcHJldjsKKwl1bnNp
Z25lZCBsb25nIGZsYWdzOworCisJLyogTkI6IG11c3QgYmUgc2VyaWFsaXNlZCBieSBhbiBvdXRl
ciB0aW1lbGluZSBtdXRleCAoYWN0aXZlLT5sb2NrKSAqLworCXNwaW5fbG9ja19pcnFzYXZlKGZl
bmNlLT5sb2NrLCBmbGFncyk7CisJR0VNX0JVR19PTih0ZXN0X2JpdChETUFfRkVOQ0VfRkxBR19T
SUdOQUxFRF9CSVQsICZmZW5jZS0+ZmxhZ3MpKTsKKworCXByZXYgPSByY3VfZGVyZWZlcmVuY2Vf
cHJvdGVjdGVkKGFjdGl2ZS0+ZmVuY2UsIGFjdGl2ZV9pc19oZWxkKGFjdGl2ZSkpOworCWlmIChw
cmV2KSB7CisJCUdFTV9CVUdfT04ocHJldiA9PSBmZW5jZSk7CisJCXNwaW5fbG9ja19uZXN0ZWQo
cHJldi0+bG9jaywgU0lOR0xFX0RFUFRIX05FU1RJTkcpOworCQlfX2xpc3RfZGVsX2VudHJ5KCZh
Y3RpdmUtPmNiLm5vZGUpOworCQlzcGluX3VubG9jayhwcmV2LT5sb2NrKTsgLyogc2VyaWFsaXNl
IHdpdGggcHJldi0+Y2JfbGlzdCAqLworCisJCS8qCisJCSAqIGFjdGl2ZS0+ZmVuY2UgaXMgcmVz
ZXQgYnkgdGhlIGNhbGxiYWNrIGZyb20gaW5zaWRlCisJCSAqIGludGVycnVwdCBjb250ZXh0LiBX
ZSBuZWVkIHRvIHNlcmlhbGlzZSBvdXIgbGlzdAorCQkgKiBtYW5pcHVsYXRpb24gd2l0aCB0aGUg
ZmVuY2UtPmxvY2sgdG8gcHJldmVudCB0aGUgcHJldgorCQkgKiBiZWluZyBsb3N0IGluc2lkZSBh
biBpbnRlcnJ1cHQgKGl0IGNhbid0IGJlIHJlcGxhY2VkIGFzCisJCSAqIG5vIG90aGVyIGNhbGxl
ciBpcyBhbGxvd2VkIHRvIGVudGVyIF9faTkxNV9hY3RpdmVfZmVuY2Vfc2V0CisJCSAqIGFzIHdl
IGhvbGQgdGhlIHRpbWVsaW5lIGxvY2spLiBBZnRlciBzZXJpYWxpc2luZyB3aXRoCisJCSAqIHRo
ZSBjYWxsYmFjaywgd2UgbmVlZCB0byBkb3VibGUgY2hlY2sgd2hpY2ggcmFuIGZpcnN0LAorCQkg
KiBvdXIgbGlzdF9kZWwoKSBbZGVjb3VwbGluZyBwcmV2IGZyb20gdGhlIGNhbGxiYWNrXSBvcgor
CQkgKiB0aGUgY2FsbGJhY2suLi4KKwkJICovCisJCXByZXYgPSByY3VfYWNjZXNzX3BvaW50ZXIo
YWN0aXZlLT5mZW5jZSk7CiAJfQorCisJcmN1X2Fzc2lnbl9wb2ludGVyKGFjdGl2ZS0+ZmVuY2Us
IGZlbmNlKTsKKwlsaXN0X2FkZF90YWlsKCZhY3RpdmUtPmNiLm5vZGUsICZmZW5jZS0+Y2JfbGlz
dCk7CisKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKGZlbmNlLT5sb2NrLCBmbGFncyk7CisKKwly
ZXR1cm4gcHJldjsKIH0KIAotaW50IGk5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KHN0cnVjdCBpOTE1
X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCi0JCQkgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEp
CitpbnQgaTkxNV9hY3RpdmVfZmVuY2Vfc2V0KHN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0
aXZlLAorCQkJICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKLQlpbnQgZXJyOworCXN0cnVj
dCBkbWFfZmVuY2UgKmZlbmNlOworCWludCBlcnIgPSAwOwogCiAjaWYgSVNfRU5BQkxFRChDT05G
SUdfRFJNX0k5MTVfREVCVUdfR0VNKQogCWxvY2tkZXBfYXNzZXJ0X2hlbGQoYWN0aXZlLT5sb2Nr
KTsKICNlbmRpZgogCi0JLyogTXVzdCBtYWludGFpbiBvcmRlcmluZyB3cnQgcHJldmlvdXMgYWN0
aXZlIHJlcXVlc3RzICovCi0JZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X2FjdGl2ZV9yZXF1ZXN0
KHJxLCBhY3RpdmUpOwotCWlmIChlcnIpCi0JCXJldHVybiBlcnI7CisJLyogTXVzdCBtYWludGFp
biB0aW1lbGluZSBvcmRlcmluZyB3cnQgcHJldmlvdXMgYWN0aXZlIHJlcXVlc3RzICovCisJcmN1
X3JlYWRfbG9jaygpOworCWZlbmNlID0gX19pOTE1X2FjdGl2ZV9mZW5jZV9zZXQoYWN0aXZlLCAm
cnEtPmZlbmNlKTsKKwlpZiAoZmVuY2UpIC8qIGJ1dCB0aGUgcHJldmlvdXMgZmVuY2UgbWF5IG5v
dCBiZWxvbmcgdG8gdGhhdCB0aW1lbGluZSEgKi8KKwkJZmVuY2UgPSBkbWFfZmVuY2VfZ2V0X3Jj
dShmZW5jZSk7CisJcmN1X3JlYWRfdW5sb2NrKCk7CisJaWYgKGZlbmNlKSB7CisJCWVyciA9IGk5
MTVfcmVxdWVzdF9hd2FpdF9kbWFfZmVuY2UocnEsIGZlbmNlKTsKKwkJZG1hX2ZlbmNlX3B1dChm
ZW5jZSk7CisJfQogCi0JX19pOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldChhY3RpdmUsIHJxKTsKLQly
ZXR1cm4gMDsKKwlyZXR1cm4gZXJyOwogfQogCi12b2lkIGk5MTVfYWN0aXZlX3JldGlyZV9ub29w
KHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCi0JCQkgICAgIHN0cnVjdCBpOTE1
X3JlcXVlc3QgKnJlcXVlc3QpCit2b2lkIGk5MTVfYWN0aXZlX25vb3Aoc3RydWN0IGRtYV9mZW5j
ZSAqZmVuY2UsIHN0cnVjdCBkbWFfZmVuY2VfY2IgKmNiKQogewotCS8qIFNwYWNlIGxlZnQgaW50
ZW50aW9uYWxseSBibGFuayAqLworCWk5MTVfYWN0aXZlX2ZlbmNlX2NiKGZlbmNlLCBjYik7CiB9
CiAKICNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9TRUxGVEVTVCkKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2FjdGl2ZS5oCmluZGV4IDkwMDM0ZjYxYjdjMi4uNGY1MmZlNjE0NmQyIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5oCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfYWN0aXZlLmgKQEAgLTEyLDYgKzEyLDEwIEBACiAjaW5jbHVkZSAiaTkx
NV9hY3RpdmVfdHlwZXMuaCIKICNpbmNsdWRlICJpOTE1X3JlcXVlc3QuaCIKIAorc3RydWN0IGk5
MTVfcmVxdWVzdDsKK3N0cnVjdCBpbnRlbF9lbmdpbmVfY3M7CitzdHJ1Y3QgaW50ZWxfdGltZWxp
bmU7CisKIC8qCiAgKiBXZSB0cmVhdCByZXF1ZXN0cyBhcyBmZW5jZXMuIFRoaXMgaXMgbm90IGJl
IHRvIGNvbmZ1c2VkIHdpdGggb3VyCiAgKiAiZmVuY2UgcmVnaXN0ZXJzIiBidXQgcGlwZWxpbmUg
c3luY2hyb25pc2F0aW9uIG9iamVjdHMgYWxhIEdMX0FSQl9zeW5jLgpAQCAtMjgsMzA4ICszMiwx
MDggQEAKICAqIHdyaXRlIGFjY2VzcyBzbyB0aGF0IHdlIGNhbiBwZXJmb3JtIGNvbmN1cnJlbnQg
cmVhZCBvcGVyYXRpb25zIGJldHdlZW4KICAqIHRoZSBDUFUgYW5kIEdQVSBlbmdpbmVzLCBhcyB3
ZWxsIGFzIHdhaXRpbmcgZm9yIGFsbCByZW5kZXJpbmcgdG8KICAqIGNvbXBsZXRlLCBvciB3YWl0
aW5nIGZvciB0aGUgbGFzdCBHUFUgdXNlciBvZiBhICJmZW5jZSByZWdpc3RlciIuIFRoZQotICog
b2JqZWN0IHRoZW4gZW1iZWRzIGEgI2k5MTVfYWN0aXZlX3JlcXVlc3QgdG8gdHJhY2sgdGhlIG1v
c3QgcmVjZW50IChpbgorICogb2JqZWN0IHRoZW4gZW1iZWRzIGEgI2k5MTVfYWN0aXZlX2ZlbmNl
IHRvIHRyYWNrIHRoZSBtb3N0IHJlY2VudCAoaW4KICAqIHJldGlyZW1lbnQgb3JkZXIpIHJlcXVl
c3QgcmVsZXZhbnQgZm9yIHRoZSBkZXNpcmVkIG1vZGUgb2YgYWNjZXNzLgotICogVGhlICNpOTE1
X2FjdGl2ZV9yZXF1ZXN0IGlzIHVwZGF0ZWQgd2l0aCBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldCgp
IHRvCisgKiBUaGUgI2k5MTVfYWN0aXZlX2ZlbmNlIGlzIHVwZGF0ZWQgd2l0aCBpOTE1X2FjdGl2
ZV9mZW5jZV9zZXQoKSB0bwogICogdHJhY2sgdGhlIG1vc3QgcmVjZW50IGZlbmNlIHJlcXVlc3Qs
IHR5cGljYWxseSB0aGlzIGlzIGRvbmUgYXMgcGFydCBvZgogICogaTkxNV92bWFfbW92ZV90b19h
Y3RpdmUoKS4KICAqCi0gKiBXaGVuIHRoZSAjaTkxNV9hY3RpdmVfcmVxdWVzdCBjb21wbGV0ZXMg
KGlzIHJldGlyZWQpLCBpdCB3aWxsCisgKiBXaGVuIHRoZSAjaTkxNV9hY3RpdmVfZmVuY2UgY29t
cGxldGVzIChpcyByZXRpcmVkKSwgaXQgd2lsbAogICogc2lnbmFsIGl0cyBjb21wbGV0aW9uIHRv
IHRoZSBvd25lciB0aHJvdWdoIGEgY2FsbGJhY2sgYXMgd2VsbCBhcyBtYXJrCi0gKiBpdHNlbGYg
YXMgaWRsZSAoaTkxNV9hY3RpdmVfcmVxdWVzdC5yZXF1ZXN0ID09IE5VTEwpLiBUaGUgb3duZXIK
KyAqIGl0c2VsZiBhcyBpZGxlIChpOTE1X2FjdGl2ZV9mZW5jZS5yZXF1ZXN0ID09IE5VTEwpLiBU
aGUgb3duZXIKICAqIGNhbiB0aGVuIHBlcmZvcm0gYW55IGFjdGlvbiwgc3VjaCBhcyBkZWxheWVk
IGZyZWVpbmcgb2YgYW4gYWN0aXZlCiAgKiByZXNvdXJjZSBpbmNsdWRpbmcgaXRzZWxmLgogICov
CiAKLXZvaWQgaTkxNV9hY3RpdmVfcmV0aXJlX25vb3Aoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVl
c3QgKmFjdGl2ZSwKLQkJCSAgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdCk7Cit2b2lk
IGk5MTVfYWN0aXZlX25vb3Aoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsIHN0cnVjdCBkbWFfZmVu
Y2VfY2IgKmNiKTsKIAogLyoqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X2luaXQgLSBwcmVwYXJl
cyB0aGUgYWN0aXZpdHkgdHJhY2tlciBmb3IgdXNlCisgKiBfX2k5MTVfYWN0aXZlX2ZlbmNlX2lu
aXQgLSBwcmVwYXJlcyB0aGUgYWN0aXZpdHkgdHJhY2tlciBmb3IgdXNlCiAgKiBAYWN0aXZlIC0g
dGhlIGFjdGl2ZSB0cmFja2VyCi0gKiBAcnEgLSBpbml0aWFsIHJlcXVlc3QgdG8gdHJhY2ssIGNh
biBiZSBOVUxMCisgKiBAZmVuY2UgLSBpbml0aWFsIGZlbmNlIHRvIHRyYWNrLCBjYW4gYmUgTlVM
TAogICogQGZ1bmMgLSBhIGNhbGxiYWNrIHdoZW4gdGhlbiB0aGUgdHJhY2tlciBpcyByZXRpcmVk
IChiZWNvbWVzIGlkbGUpLAogICogICAgICAgICBjYW4gYmUgTlVMTAogICoKLSAqIGk5MTVfYWN0
aXZlX3JlcXVlc3RfaW5pdCgpIHByZXBhcmVzIHRoZSBlbWJlZGRlZCBAYWN0aXZlIHN0cnVjdCBm
b3IgdXNlIGFzCi0gKiBhbiBhY3Rpdml0eSB0cmFja2VyLCB0aGF0IGlzIGZvciB0cmFja2luZyB0
aGUgbGFzdCBrbm93biBhY3RpdmUgcmVxdWVzdAotICogYXNzb2NpYXRlZCB3aXRoIGl0LiBXaGVu
IHRoZSBsYXN0IHJlcXVlc3QgYmVjb21lcyBpZGxlLCB3aGVuIGl0IGlzIHJldGlyZWQKKyAqIGk5
MTVfYWN0aXZlX2ZlbmNlX2luaXQoKSBwcmVwYXJlcyB0aGUgZW1iZWRkZWQgQGFjdGl2ZSBzdHJ1
Y3QgZm9yIHVzZSBhcworICogYW4gYWN0aXZpdHkgdHJhY2tlciwgdGhhdCBpcyBmb3IgdHJhY2tp
bmcgdGhlIGxhc3Qga25vd24gYWN0aXZlIGZlbmNlCisgKiBhc3NvY2lhdGVkIHdpdGggaXQuIFdo
ZW4gdGhlIGxhc3QgZmVuY2UgYmVjb21lcyBpZGxlLCB3aGVuIGl0IGlzIHJldGlyZWQKICAqIGFm
dGVyIGNvbXBsZXRpb24sIHRoZSBvcHRpb25hbCBjYWxsYmFjayBAZnVuYyBpcyBpbnZva2VkLgog
ICovCiBzdGF0aWMgaW5saW5lIHZvaWQKLWk5MTVfYWN0aXZlX3JlcXVlc3RfaW5pdChzdHJ1Y3Qg
aTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLAorX19pOTE1X2FjdGl2ZV9mZW5jZV9pbml0KHN0
cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlLAogCQkJIHN0cnVjdCBtdXRleCAqbG9jaywK
LQkJCSBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKLQkJCSBpOTE1X2FjdGl2ZV9yZXRpcmVfZm4g
cmV0aXJlKQorCQkJIHZvaWQgKmZlbmNlLAorCQkJIGRtYV9mZW5jZV9mdW5jX3QgZm4pCiB7Ci0J
UkNVX0lOSVRfUE9JTlRFUihhY3RpdmUtPnJlcXVlc3QsIHJxKTsKLQlJTklUX0xJU1RfSEVBRCgm
YWN0aXZlLT5saW5rKTsKLQlhY3RpdmUtPnJldGlyZSA9IHJldGlyZSA/OiBpOTE1X2FjdGl2ZV9y
ZXRpcmVfbm9vcDsKKwlSQ1VfSU5JVF9QT0lOVEVSKGFjdGl2ZS0+ZmVuY2UsIGZlbmNlKTsKKwlh
Y3RpdmUtPmNiLmZ1bmMgPSBmbiA/OiBpOTE1X2FjdGl2ZV9ub29wOwogI2lmIElTX0VOQUJMRUQo
Q09ORklHX0RSTV9JOTE1X0RFQlVHX0dFTSkKIAlhY3RpdmUtPmxvY2sgPSBsb2NrOwogI2VuZGlm
CiB9CiAKLSNkZWZpbmUgSU5JVF9BQ1RJVkVfUkVRVUVTVChuYW1lLCBsb2NrKSBcCi0JaTkxNV9h
Y3RpdmVfcmVxdWVzdF9pbml0KChuYW1lKSwgKGxvY2spLCBOVUxMLCBOVUxMKQotCi0vKioKLSAq
IGk5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0IC0gdXBkYXRlcyB0aGUgdHJhY2tlciB0byB3YXRjaCB0
aGUgY3VycmVudCByZXF1ZXN0Ci0gKiBAYWN0aXZlIC0gdGhlIGFjdGl2ZSB0cmFja2VyCi0gKiBA
cmVxdWVzdCAtIHRoZSByZXF1ZXN0IHRvIHdhdGNoCi0gKgotICogX19pOTE1X2FjdGl2ZV9yZXF1
ZXN0X3NldCgpIHdhdGNoZXMgdGhlIGdpdmVuIEByZXF1ZXN0IGZvciBjb21wbGV0aW9uLiBXaGls
c3QKLSAqIHRoYXQgQHJlcXVlc3QgaXMgYnVzeSwgdGhlIEBhY3RpdmUgcmVwb3J0cyBidXN5LiBX
aGVuIHRoYXQgQHJlcXVlc3QgaXMKLSAqIHJldGlyZWQsIHRoZSBAYWN0aXZlIHRyYWNrZXIgaXMg
dXBkYXRlZCB0byByZXBvcnQgaWRsZS4KLSAqLwotc3RhdGljIGlubGluZSB2b2lkCi1fX2k5MTVf
YWN0aXZlX3JlcXVlc3Rfc2V0KHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCi0J
CQkgIHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QpCi17Ci0jaWYgSVNfRU5BQkxFRChDT05G
SUdfRFJNX0k5MTVfREVCVUdfR0VNKQotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoYWN0aXZlLT5sb2Nr
KTsKLSNlbmRpZgotCWxpc3RfbW92ZSgmYWN0aXZlLT5saW5rLCAmcmVxdWVzdC0+YWN0aXZlX2xp
c3QpOwotCXJjdV9hc3NpZ25fcG9pbnRlcihhY3RpdmUtPnJlcXVlc3QsIHJlcXVlc3QpOwotfQor
I2RlZmluZSBJTklUX0FDVElWRV9GRU5DRShBLCBMT0NLKSBcCisJX19pOTE1X2FjdGl2ZV9mZW5j
ZV9pbml0KChBKSwgKExPQ0spLCBOVUxMLCBOVUxMKQogCi1pbnQgX19tdXN0X2NoZWNrCi1pOTE1
X2FjdGl2ZV9yZXF1ZXN0X3NldChzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLAot
CQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpOworc3RydWN0IGRtYV9mZW5jZSAqCitfX2k5MTVf
YWN0aXZlX2ZlbmNlX3NldChzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2ZSwKKwkJCXN0
cnVjdCBkbWFfZmVuY2UgKmZlbmNlKTsKIAogLyoqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3Jh
dyAtIHJldHVybiB0aGUgYWN0aXZlIHJlcXVlc3QKKyAqIGk5MTVfYWN0aXZlX2ZlbmNlX3NldCAt
IHVwZGF0ZXMgdGhlIHRyYWNrZXIgdG8gd2F0Y2ggdGhlIGN1cnJlbnQgZmVuY2UKICAqIEBhY3Rp
dmUgLSB0aGUgYWN0aXZlIHRyYWNrZXIKKyAqIEBycSAtIHRoZSByZXF1ZXN0IHRvIHdhdGNoCiAg
KgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9yYXcoKSByZXR1cm5zIHRoZSBjdXJyZW50IHJlcXVl
c3QgYmVpbmcgdHJhY2tlZCwgb3IgTlVMTC4KLSAqIEl0IGRvZXMgbm90IG9idGFpbiBhIHJlZmVy
ZW5jZSBvbiB0aGUgcmVxdWVzdCBmb3IgdGhlIGNhbGxlciwgc28gdGhlIGNhbGxlcgotICogbXVz
dCBob2xkIHN0cnVjdF9tdXRleC4KKyAqIGk5MTVfYWN0aXZlX2ZlbmNlX3NldCgpIHdhdGNoZXMg
dGhlIGdpdmVuIEBycSBmb3IgY29tcGxldGlvbi4gV2hpbGUKKyAqIHRoYXQgQHJxIGlzIGJ1c3ks
IHRoZSBAYWN0aXZlIHJlcG9ydHMgYnVzeS4gV2hlbiB0aGF0IEBycSBpcyBzaWduYWxlZAorICog
KG9yIGVsc2UgcmV0aXJlZCkgdGhlIEBhY3RpdmUgdHJhY2tlciBpcyB1cGRhdGVkIHRvIHJlcG9y
dCBpZGxlLgogICovCi1zdGF0aWMgaW5saW5lIHN0cnVjdCBpOTE1X3JlcXVlc3QgKgotaTkxNV9h
Y3RpdmVfcmVxdWVzdF9yYXcoY29uc3Qgc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2
ZSwKLQkJCXN0cnVjdCBtdXRleCAqbXV0ZXgpCi17Ci0JcmV0dXJuIHJjdV9kZXJlZmVyZW5jZV9w
cm90ZWN0ZWQoYWN0aXZlLT5yZXF1ZXN0LAotCQkJCQkgbG9ja2RlcF9pc19oZWxkKG11dGV4KSk7
Ci19Ci0KLS8qKgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9wZWVrIC0gcmVwb3J0IHRoZSBhY3Rp
dmUgcmVxdWVzdCBiZWluZyBtb25pdG9yZWQKLSAqIEBhY3RpdmUgLSB0aGUgYWN0aXZlIHRyYWNr
ZXIKLSAqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3BlZWsoKSByZXR1cm5zIHRoZSBjdXJyZW50
IHJlcXVlc3QgYmVpbmcgdHJhY2tlZCBpZgotICogc3RpbGwgYWN0aXZlLCBvciBOVUxMLiBJdCBk
b2VzIG5vdCBvYnRhaW4gYSByZWZlcmVuY2Ugb24gdGhlIHJlcXVlc3QKLSAqIGZvciB0aGUgY2Fs
bGVyLCBzbyB0aGUgY2FsbGVyIG11c3QgaG9sZCBzdHJ1Y3RfbXV0ZXguCi0gKi8KLXN0YXRpYyBp
bmxpbmUgc3RydWN0IGk5MTVfcmVxdWVzdCAqCi1pOTE1X2FjdGl2ZV9yZXF1ZXN0X3BlZWsoY29u
c3Qgc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSwKLQkJCSBzdHJ1Y3QgbXV0ZXgg
Km11dGV4KQotewotCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3Q7Ci0KLQlyZXF1ZXN0ID0g
aTkxNV9hY3RpdmVfcmVxdWVzdF9yYXcoYWN0aXZlLCBtdXRleCk7Ci0JaWYgKCFyZXF1ZXN0IHx8
IGk5MTVfcmVxdWVzdF9jb21wbGV0ZWQocmVxdWVzdCkpCi0JCXJldHVybiBOVUxMOwotCi0JcmV0
dXJuIHJlcXVlc3Q7Ci19Ci0KLS8qKgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9nZXQgLSByZXR1
cm4gYSByZWZlcmVuY2UgdG8gdGhlIGFjdGl2ZSByZXF1ZXN0Ci0gKiBAYWN0aXZlIC0gdGhlIGFj
dGl2ZSB0cmFja2VyCi0gKgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9nZXQoKSByZXR1cm5zIGEg
cmVmZXJlbmNlIHRvIHRoZSBhY3RpdmUgcmVxdWVzdCwgb3IgTlVMTAotICogaWYgdGhlIGFjdGl2
ZSB0cmFja2VyIGlzIGlkbGUuIFRoZSBjYWxsZXIgbXVzdCBob2xkIHN0cnVjdF9tdXRleC4KLSAq
Lwotc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICoKLWk5MTVfYWN0aXZlX3JlcXVl
c3RfZ2V0KGNvbnN0IHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCi0JCQlzdHJ1
Y3QgbXV0ZXggKm11dGV4KQotewotCXJldHVybiBpOTE1X3JlcXVlc3RfZ2V0KGk5MTVfYWN0aXZl
X3JlcXVlc3RfcGVlayhhY3RpdmUsIG11dGV4KSk7Ci19Ci0KLS8qKgotICogX19pOTE1X2FjdGl2
ZV9yZXF1ZXN0X2dldF9yY3UgLSByZXR1cm4gYSByZWZlcmVuY2UgdG8gdGhlIGFjdGl2ZSByZXF1
ZXN0Ci0gKiBAYWN0aXZlIC0gdGhlIGFjdGl2ZSB0cmFja2VyCi0gKgotICogX19pOTE1X2FjdGl2
ZV9yZXF1ZXN0X2dldCgpIHJldHVybnMgYSByZWZlcmVuY2UgdG8gdGhlIGFjdGl2ZSByZXF1ZXN0
LAotICogb3IgTlVMTCBpZiB0aGUgYWN0aXZlIHRyYWNrZXIgaXMgaWRsZS4gVGhlIGNhbGxlciBt
dXN0IGhvbGQgdGhlIFJDVSByZWFkCi0gKiBsb2NrLCBidXQgdGhlIHJldHVybmVkIHBvaW50ZXIg
aXMgc2FmZSB0byB1c2Ugb3V0c2lkZSBvZiBSQ1UuCi0gKi8KLXN0YXRpYyBpbmxpbmUgc3RydWN0
IGk5MTVfcmVxdWVzdCAqCi1fX2k5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0X3JjdShjb25zdCBzdHJ1
Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlKQotewotCS8qCi0JICogUGVyZm9ybWluZyBh
IGxvY2tsZXNzIHJldHJpZXZhbCBvZiB0aGUgYWN0aXZlIHJlcXVlc3QgaXMgc3VwZXIKLQkgKiB0
cmlja3kuIFNMQUJfVFlQRVNBRkVfQllfUkNVIG1lcmVseSBndWFyYW50ZWVzIHRoYXQgdGhlIGJh
Y2tpbmcKLQkgKiBzbGFiIG9mIHJlcXVlc3Qgb2JqZWN0cyB3aWxsIG5vdCBiZSBmcmVlZCB3aGls
c3Qgd2UgaG9sZCB0aGUKLQkgKiBSQ1UgcmVhZCBsb2NrLiBJdCBkb2VzIG5vdCBndWFyYW50ZWUg
dGhhdCB0aGUgcmVxdWVzdCBpdHNlbGYKLQkgKiB3aWxsIG5vdCBiZSBmcmVlZCBhbmQgdGhlbiAq
cmV1c2VkKi4gVml6LAotCSAqCi0JICogVGhyZWFkIEEJCQlUaHJlYWQgQgotCSAqCi0JICogcnEg
PSBhY3RpdmUucmVxdWVzdAotCSAqCQkJCXJldGlyZShycSkgLT4gZnJlZShycSk7Ci0JICoJCQkJ
KHJxIGlzIG5vdyBmaXJzdCBvbiB0aGUgc2xhYiBmcmVlbGlzdCkKLQkgKgkJCQlhY3RpdmUucmVx
dWVzdCA9IE5VTEwKLQkgKgotCSAqCQkJCXJxID0gbmV3IHN1Ym1pc3Npb24gb24gYSBuZXcgb2Jq
ZWN0Ci0JICogcmVmKHJxKQotCSAqCi0JICogVG8gcHJldmVudCB0aGUgcmVxdWVzdCBmcm9tIGJl
aW5nIHJldXNlZCB3aGlsc3QgdGhlIGNhbGxlcgotCSAqIHVzZXMgaXQsIHdlIHRha2UgYSByZWZl
cmVuY2UgbGlrZSBub3JtYWwuIFdoaWxzdCBhY3F1aXJpbmcKLQkgKiB0aGUgcmVmZXJlbmNlIHdl
IGNoZWNrIHRoYXQgaXQgaXMgbm90IGluIGEgZGVzdHJveWVkIHN0YXRlCi0JICogKHJlZmNudCA9
PSAwKS4gVGhhdCBwcmV2ZW50cyB0aGUgcmVxdWVzdCBiZWluZyByZWFsbG9jYXRlZAotCSAqIHdo
aWxzdCB0aGUgY2FsbGVyIGhvbGRzIG9uIHRvIGl0LiBUbyBjaGVjayB0aGF0IHRoZSByZXF1ZXN0
Ci0JICogd2FzIG5vdCByZWFsbG9jYXRlZCBhcyB3ZSBhY3F1aXJlZCB0aGUgcmVmZXJlbmNlIHdl
IGhhdmUgdG8KLQkgKiBjaGVjayB0aGF0IG91ciByZXF1ZXN0IHJlbWFpbnMgdGhlIGFjdGl2ZSBy
ZXF1ZXN0IGFjcm9zcwotCSAqIHRoZSBsb29rdXAsIGluIHRoZSBzYW1lIG1hbm5lciBhcyBhIHNl
cWxvY2suIFRoZSB2aXNpYmlsaXR5Ci0JICogb2YgdGhlIHBvaW50ZXIgdmVyc3VzIHRoZSByZWZl
cmVuY2UgY291bnRpbmcgaXMgY29udHJvbGxlZAotCSAqIGJ5IHVzaW5nIFJDVSBiYXJyaWVycyAo
cmN1X2RlcmVmZXJlbmNlIGFuZCByY3VfYXNzaWduX3BvaW50ZXIpLgotCSAqCi0JICogSW4gdGhl
IG1pZGRsZSBvZiBhbGwgdGhhdCwgd2UgaW5zcGVjdCB3aGV0aGVyIHRoZSByZXF1ZXN0IGlzCi0J
ICogY29tcGxldGUuIFJldGlyaW5nIGlzIGxhenkgc28gdGhlIHJlcXVlc3QgbWF5IGJlIGNvbXBs
ZXRlZCBsb25nCi0JICogYmVmb3JlIHRoZSBhY3RpdmUgdHJhY2tlciBpcyB1cGRhdGVkLiBRdWVy
eWluZyB3aGV0aGVyIHRoZQotCSAqIHJlcXVlc3QgaXMgY29tcGxldGUgaXMgZmFyIGNoZWFwZXIg
KGFzIGl0IGludm9sdmVzIG5vIGxvY2tlZAotCSAqIGluc3RydWN0aW9ucyBzZXR0aW5nIGNhY2hl
bGluZXMgdG8gZXhjbHVzaXZlKSB0aGFuIGFjcXVpcmluZwotCSAqIHRoZSByZWZlcmVuY2UsIHNv
IHdlIGRvIGl0IGZpcnN0LiBUaGUgUkNVIHJlYWQgbG9jayBlbnN1cmVzIHRoZQotCSAqIHBvaW50
ZXIgZGVyZWZlcmVuY2UgaXMgdmFsaWQsIGJ1dCBkb2VzIG5vdCBlbnN1cmUgdGhhdCB0aGUKLQkg
KiBzZXFubyBub3IgSFdTIGlzIHRoZSByaWdodCBvbmUhIEhvd2V2ZXIsIGlmIHRoZSByZXF1ZXN0
IHdhcwotCSAqIHJlYWxsb2NhdGVkLCB0aGF0IG1lYW5zIHRoZSBhY3RpdmUgdHJhY2tlcidzIHJl
cXVlc3Qgd2FzIGNvbXBsZXRlLgotCSAqIElmIHRoZSBuZXcgcmVxdWVzdCBpcyBhbHNvIGNvbXBs
ZXRlLCB0aGVuIGJvdGggYXJlIGFuZCB3ZSBjYW4KLQkgKiBqdXN0IHJlcG9ydCB0aGUgYWN0aXZl
IHRyYWNrZXIgaXMgaWRsZS4gSWYgdGhlIG5ldyByZXF1ZXN0IGlzCi0JICogaW5jb21wbGV0ZSwg
dGhlbiB3ZSBhY3F1aXJlIGEgcmVmZXJlbmNlIG9uIGl0IGFuZCBjaGVjayB0aGF0Ci0JICogaXQg
cmVtYWluZWQgdGhlIGFjdGl2ZSByZXF1ZXN0LgotCSAqCi0JICogSXQgaXMgdGhlbiBpbXBlcmF0
aXZlIHRoYXQgd2UgZG8gbm90IHplcm8gdGhlIHJlcXVlc3Qgb24KLQkgKiByZWFsbG9jYXRpb24s
IHNvIHRoYXQgd2UgY2FuIGNoYXNlIHRoZSBkYW5nbGluZyBwb2ludGVycyEKLQkgKiBTZWUgaTkx
NV9yZXF1ZXN0X2FsbG9jKCkuCi0JICovCi0JZG8gewotCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
ZXF1ZXN0OwotCi0JCXJlcXVlc3QgPSByY3VfZGVyZWZlcmVuY2UoYWN0aXZlLT5yZXF1ZXN0KTsK
LQkJaWYgKCFyZXF1ZXN0IHx8IGk5MTVfcmVxdWVzdF9jb21wbGV0ZWQocmVxdWVzdCkpCi0JCQly
ZXR1cm4gTlVMTDsKLQotCQkvKgotCQkgKiBBbiBlc3BlY2lhbGx5IHNpbGx5IGNvbXBpbGVyIGNv
dWxkIGRlY2lkZSB0byByZWNvbXB1dGUgdGhlCi0JCSAqIHJlc3VsdCBvZiBpOTE1X3JlcXVlc3Rf
Y29tcGxldGVkLCBtb3JlIHNwZWNpZmljYWxseQotCQkgKiByZS1lbWl0IHRoZSBsb2FkIGZvciBy
ZXF1ZXN0LT5mZW5jZS5zZXFuby4gQSByYWNlIHdvdWxkIGNhdGNoCi0JCSAqIGEgbGF0ZXIgc2Vx
bm8gdmFsdWUsIHdoaWNoIGNvdWxkIGZsaXAgdGhlIHJlc3VsdCBmcm9tIHRydWUgdG8KLQkJICog
ZmFsc2UuIFdoaWNoIG1lYW5zIHBhcnQgb2YgdGhlIGluc3RydWN0aW9ucyBiZWxvdyBtaWdodCBu
b3QKLQkJICogYmUgZXhlY3V0ZWQsIHdoaWxlIGxhdGVyIG9uIGluc3RydWN0aW9ucyBhcmUgZXhl
Y3V0ZWQuIER1ZSB0bwotCQkgKiBiYXJyaWVycyB3aXRoaW4gdGhlIHJlZmNvdW50aW5nIHRoZSBp
bmNvbnNpc3RlbmN5IGNhbid0IHJlYWNoCi0JCSAqIHBhc3QgdGhlIGNhbGwgdG8gaTkxNV9yZXF1
ZXN0X2dldF9yY3UsIGJ1dCBub3QgZXhlY3V0aW5nCi0JCSAqIHRoYXQgd2hpbGUgc3RpbGwgZXhl
Y3V0aW5nIGk5MTVfcmVxdWVzdF9wdXQoKSBjcmVhdGVzCi0JCSAqIGhhdm9jIGVub3VnaC4gIFBy
ZXZlbnQgdGhpcyB3aXRoIGEgY29tcGlsZXIgYmFycmllci4KLQkJICovCi0JCWJhcnJpZXIoKTsK
LQotCQlyZXF1ZXN0ID0gaTkxNV9yZXF1ZXN0X2dldF9yY3UocmVxdWVzdCk7Ci0KLQkJLyoKLQkJ
ICogV2hhdCBzdG9wcyB0aGUgZm9sbG93aW5nIHJjdV9hY2Nlc3NfcG9pbnRlcigpIGZyb20gb2Nj
dXJyaW5nCi0JCSAqIGJlZm9yZSB0aGUgYWJvdmUgaTkxNV9yZXF1ZXN0X2dldF9yY3UoKT8gSWYg
d2Ugd2VyZQotCQkgKiB0byByZWFkIHRoZSB2YWx1ZSBiZWZvcmUgcGF1c2luZyB0byBnZXQgdGhl
IHJlZmVyZW5jZSB0bwotCQkgKiB0aGUgcmVxdWVzdCwgd2UgbWF5IG5vdCBub3RpY2UgYSBjaGFu
Z2UgaW4gdGhlIGFjdGl2ZQotCQkgKiB0cmFja2VyLgotCQkgKgotCQkgKiBUaGUgcmN1X2FjY2Vz
c19wb2ludGVyKCkgaXMgYSBtZXJlIGNvbXBpbGVyIGJhcnJpZXIsIHdoaWNoCi0JCSAqIG1lYW5z
IGJvdGggdGhlIENQVSBhbmQgY29tcGlsZXIgYXJlIGZyZWUgdG8gcGVyZm9ybSB0aGUKLQkJICog
bWVtb3J5IHJlYWQgd2l0aG91dCBjb25zdHJhaW50LiBUaGUgY29tcGlsZXIgb25seSBoYXMgdG8K
LQkJICogZW5zdXJlIHRoYXQgYW55IG9wZXJhdGlvbnMgYWZ0ZXIgdGhlIHJjdV9hY2Nlc3NfcG9p
bnRlcigpCi0JCSAqIG9jY3VyIGFmdGVyd2FyZHMgaW4gcHJvZ3JhbSBvcmRlci4gVGhpcyBtZWFu
cyB0aGUgcmVhZCBtYXkKLQkJICogYmUgcGVyZm9ybWVkIGVhcmxpZXIgYnkgYW4gb3V0LW9mLW9y
ZGVyIENQVSwgb3IgYWR2ZW50dXJvdXMKLQkJICogY29tcGlsZXIuCi0JCSAqCi0JCSAqIFRoZSBh
dG9taWMgb3BlcmF0aW9uIGF0IHRoZSBoZWFydCBvZgotCQkgKiBpOTE1X3JlcXVlc3RfZ2V0X3Jj
dSgpLCBzZWUgZG1hX2ZlbmNlX2dldF9yY3UoKSwgaXMKLQkJICogYXRvbWljX2luY19ub3RfemVy
bygpIHdoaWNoIGlzIG9ubHkgYSBmdWxsIG1lbW9yeSBiYXJyaWVyCi0JCSAqIHdoZW4gc3VjY2Vz
c2Z1bC4gVGhhdCBpcywgaWYgaTkxNV9yZXF1ZXN0X2dldF9yY3UoKQotCQkgKiByZXR1cm5zIHRo
ZSByZXF1ZXN0IChhbmQgc28gd2l0aCB0aGUgcmVmZXJlbmNlIGNvdW50ZWQKLQkJICogaW5jcmVt
ZW50ZWQpIHRoZW4gdGhlIGZvbGxvd2luZyByZWFkIGZvciByY3VfYWNjZXNzX3BvaW50ZXIoKQot
CQkgKiBtdXN0IG9jY3VyIGFmdGVyIHRoZSBhdG9taWMgb3BlcmF0aW9uIGFuZCBzbyBjb25maXJt
Ci0JCSAqIHRoYXQgdGhpcyByZXF1ZXN0IGlzIHRoZSBvbmUgY3VycmVudGx5IGJlaW5nIHRyYWNr
ZWQuCi0JCSAqCi0JCSAqIFRoZSBjb3JyZXNwb25kaW5nIHdyaXRlIGJhcnJpZXIgaXMgcGFydCBv
ZgotCQkgKiByY3VfYXNzaWduX3BvaW50ZXIoKS4KLQkJICovCi0JCWlmICghcmVxdWVzdCB8fCBy
ZXF1ZXN0ID09IHJjdV9hY2Nlc3NfcG9pbnRlcihhY3RpdmUtPnJlcXVlc3QpKQotCQkJcmV0dXJu
IHJjdV9wb2ludGVyX2hhbmRvZmYocmVxdWVzdCk7Ci0KLQkJaTkxNV9yZXF1ZXN0X3B1dChyZXF1
ZXN0KTsKLQl9IHdoaWxlICgxKTsKLX0KLQoraW50IF9fbXVzdF9jaGVjaworaTkxNV9hY3RpdmVf
ZmVuY2Vfc2V0KHN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlLAorCQkgICAgICBzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycSk7CiAvKioKLSAqIGk5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0X3Vu
bG9ja2VkIC0gcmV0dXJuIGEgcmVmZXJlbmNlIHRvIHRoZSBhY3RpdmUgcmVxdWVzdAorICogaTkx
NV9hY3RpdmVfZmVuY2VfZ2V0IC0gcmV0dXJuIGEgcmVmZXJlbmNlIHRvIHRoZSBhY3RpdmUgZmVu
Y2UKICAqIEBhY3RpdmUgLSB0aGUgYWN0aXZlIHRyYWNrZXIKICAqCi0gKiBpOTE1X2FjdGl2ZV9y
ZXF1ZXN0X2dldF91bmxvY2tlZCgpIHJldHVybnMgYSByZWZlcmVuY2UgdG8gdGhlIGFjdGl2ZSBy
ZXF1ZXN0LAorICogaTkxNV9hY3RpdmVfZmVuY2VfZ2V0KCkgcmV0dXJucyBhIHJlZmVyZW5jZSB0
byB0aGUgYWN0aXZlIGZlbmNlLAogICogb3IgTlVMTCBpZiB0aGUgYWN0aXZlIHRyYWNrZXIgaXMg
aWRsZS4gVGhlIHJlZmVyZW5jZSBpcyBvYnRhaW5lZCB1bmRlciBSQ1UsCiAgKiBzbyBubyBsb2Nr
aW5nIGlzIHJlcXVpcmVkIGJ5IHRoZSBjYWxsZXIuCiAgKgotICogVGhlIHJlZmVyZW5jZSBzaG91
bGQgYmUgZnJlZWQgd2l0aCBpOTE1X3JlcXVlc3RfcHV0KCkuCisgKiBUaGUgcmVmZXJlbmNlIHNo
b3VsZCBiZSBmcmVlZCB3aXRoIGRtYV9mZW5jZV9wdXQoKS4KICAqLwotc3RhdGljIGlubGluZSBz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICoKLWk5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0X3VubG9ja2VkKGNv
bnN0IHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUpCitzdGF0aWMgaW5saW5lIHN0
cnVjdCBkbWFfZmVuY2UgKgoraTkxNV9hY3RpdmVfZmVuY2VfZ2V0KHN0cnVjdCBpOTE1X2FjdGl2
ZV9mZW5jZSAqYWN0aXZlKQogewotCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3Q7CisJc3Ry
dWN0IGRtYV9mZW5jZSAqZmVuY2U7CiAKIAlyY3VfcmVhZF9sb2NrKCk7Ci0JcmVxdWVzdCA9IF9f
aTkxNV9hY3RpdmVfcmVxdWVzdF9nZXRfcmN1KGFjdGl2ZSk7CisJZmVuY2UgPSBkbWFfZmVuY2Vf
Z2V0X3JjdV9zYWZlKCZhY3RpdmUtPmZlbmNlKTsKIAlyY3VfcmVhZF91bmxvY2soKTsKIAotCXJl
dHVybiByZXF1ZXN0OworCXJldHVybiBmZW5jZTsKIH0KIAogLyoqCi0gKiBpOTE1X2FjdGl2ZV9y
ZXF1ZXN0X2lzc2V0IC0gcmVwb3J0IHdoZXRoZXIgdGhlIGFjdGl2ZSB0cmFja2VyIGlzIGFzc2ln
bmVkCisgKiBpOTE1X2FjdGl2ZV9mZW5jZV9pc3NldCAtIHJlcG9ydCB3aGV0aGVyIHRoZSBhY3Rp
dmUgdHJhY2tlciBpcyBhc3NpZ25lZAogICogQGFjdGl2ZSAtIHRoZSBhY3RpdmUgdHJhY2tlcgog
ICoKLSAqIGk5MTVfYWN0aXZlX3JlcXVlc3RfaXNzZXQoKSByZXR1cm5zIHRydWUgaWYgdGhlIGFj
dGl2ZSB0cmFja2VyIGlzIGN1cnJlbnRseQotICogYXNzaWduZWQgdG8gYSByZXF1ZXN0LiBEdWUg
dG8gdGhlIGxhenkgcmV0aXJpbmcsIHRoYXQgcmVxdWVzdCBtYXkgYmUgaWRsZQorICogaTkxNV9h
Y3RpdmVfZmVuY2VfaXNzZXQoKSByZXR1cm5zIHRydWUgaWYgdGhlIGFjdGl2ZSB0cmFja2VyIGlz
IGN1cnJlbnRseQorICogYXNzaWduZWQgdG8gYSBmZW5jZS4gRHVlIHRvIHRoZSBsYXp5IHJldGly
aW5nLCB0aGF0IGZlbmNlIG1heSBiZSBpZGxlCiAgKiBhbmQgdGhpcyBtYXkgcmVwb3J0IHN0YWxl
IGluZm9ybWF0aW9uLgogICovCiBzdGF0aWMgaW5saW5lIGJvb2wKLWk5MTVfYWN0aXZlX3JlcXVl
c3RfaXNzZXQoY29uc3Qgc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSkKK2k5MTVf
YWN0aXZlX2ZlbmNlX2lzc2V0KGNvbnN0IHN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZl
KQogewotCXJldHVybiByY3VfYWNjZXNzX3BvaW50ZXIoYWN0aXZlLT5yZXF1ZXN0KTsKKwlyZXR1
cm4gcmN1X2FjY2Vzc19wb2ludGVyKGFjdGl2ZS0+ZmVuY2UpOwogfQogCi0vKioKLSAqIGk5MTVf
YWN0aXZlX3JlcXVlc3RfcmV0aXJlIC0gd2FpdHMgdW50aWwgdGhlIHJlcXVlc3QgaXMgcmV0aXJl
ZAotICogQGFjdGl2ZSAtIHRoZSBhY3RpdmUgcmVxdWVzdCBvbiB3aGljaCB0byB3YWl0Ci0gKgot
ICogaTkxNV9hY3RpdmVfcmVxdWVzdF9yZXRpcmUoKSB3YWl0cyB1bnRpbCB0aGUgcmVxdWVzdCBp
cyBjb21wbGV0ZWQsCi0gKiBhbmQgdGhlbiBlbnN1cmVzIHRoYXQgYXQgbGVhc3QgdGhlIHJldGly
ZW1lbnQgaGFuZGxlciBmb3IgdGhpcwotICogQGFjdGl2ZSB0cmFja2VyIGlzIGNhbGxlZCBiZWZv
cmUgcmV0dXJuaW5nLiBJZiB0aGUgQGFjdGl2ZQotICogdHJhY2tlciBpcyBpZGxlLCB0aGUgZnVu
Y3Rpb24gcmV0dXJucyBpbW1lZGlhdGVseS4KLSAqLwotc3RhdGljIGlubGluZSBpbnQgX19tdXN0
X2NoZWNrCi1pOTE1X2FjdGl2ZV9yZXF1ZXN0X3JldGlyZShzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVx
dWVzdCAqYWN0aXZlLAotCQkJICAgc3RydWN0IG11dGV4ICptdXRleCkKK3N0YXRpYyBpbmxpbmUg
dm9pZAoraTkxNV9hY3RpdmVfZmVuY2VfY2Ioc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsIHN0cnVj
dCBkbWFfZmVuY2VfY2IgKmNiKQogewotCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3Q7Ci0J
bG9uZyByZXQ7Ci0KLQlyZXF1ZXN0ID0gaTkxNV9hY3RpdmVfcmVxdWVzdF9yYXcoYWN0aXZlLCBt
dXRleCk7Ci0JaWYgKCFyZXF1ZXN0KQotCQlyZXR1cm4gMDsKLQotCXJldCA9IGk5MTVfcmVxdWVz
dF93YWl0KHJlcXVlc3QsCi0JCQkJSTkxNV9XQUlUX0lOVEVSUlVQVElCTEUsCi0JCQkJTUFYX1ND
SEVEVUxFX1RJTUVPVVQpOwotCWlmIChyZXQgPCAwKQotCQlyZXR1cm4gcmV0OworCXN0cnVjdCBp
OTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlID0KKwkJY29udGFpbmVyX29mKGNiLCB0eXBlb2YoKmFj
dGl2ZSksIGNiKTsKIAotCWxpc3RfZGVsX2luaXQoJmFjdGl2ZS0+bGluayk7Ci0JUkNVX0lOSVRf
UE9JTlRFUihhY3RpdmUtPnJlcXVlc3QsIE5VTEwpOwotCi0JYWN0aXZlLT5yZXRpcmUoYWN0aXZl
LCByZXF1ZXN0KTsKLQotCXJldHVybiAwOworCVJDVV9JTklUX1BPSU5URVIoYWN0aXZlLT5mZW5j
ZSwgTlVMTCk7CiB9CiAKIC8qCkBAIC0zNTgsNDcgKzE2Miw0MCBAQCBpOTE1X2FjdGl2ZV9yZXF1
ZXN0X3JldGlyZShzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLAogICogc3luY2hy
b25pc2F0aW9uLgogICovCiAKLXZvaWQgX19pOTE1X2FjdGl2ZV9pbml0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1LAotCQkJc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCit2b2lkIF9faTkx
NV9hY3RpdmVfaW5pdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKIAkJCWludCAoKmFjdGl2ZSko
c3RydWN0IGk5MTVfYWN0aXZlICpyZWYpLAogCQkJdm9pZCAoKnJldGlyZSkoc3RydWN0IGk5MTVf
YWN0aXZlICpyZWYpLAogCQkJc3RydWN0IGxvY2tfY2xhc3Nfa2V5ICprZXkpOwotI2RlZmluZSBp
OTE1X2FjdGl2ZV9pbml0KGk5MTUsIHJlZiwgYWN0aXZlLCByZXRpcmUpIGRvIHsJCVwKKyNkZWZp
bmUgaTkxNV9hY3RpdmVfaW5pdChyZWYsIGFjdGl2ZSwgcmV0aXJlKSBkbyB7CQlcCiAJc3RhdGlj
IHN0cnVjdCBsb2NrX2NsYXNzX2tleSBfX2tleTsJCQkJXAogCQkJCQkJCQkJXAotCV9faTkxNV9h
Y3RpdmVfaW5pdChpOTE1LCByZWYsIGFjdGl2ZSwgcmV0aXJlLCAmX19rZXkpOwkJXAorCV9faTkx
NV9hY3RpdmVfaW5pdChyZWYsIGFjdGl2ZSwgcmV0aXJlLCAmX19rZXkpOwkJXAogfSB3aGlsZSAo
MCkKIAogaW50IGk5MTVfYWN0aXZlX3JlZihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKIAkJICAg
IHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwsCi0JCSAgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
cSk7CisJCSAgICBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSk7CiAKIHN0YXRpYyBpbmxpbmUgaW50
CiBpOTE1X2FjdGl2ZV9hZGRfcmVxdWVzdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgc3RydWN0
IGk5MTVfcmVxdWVzdCAqcnEpCiB7Ci0JcmV0dXJuIGk5MTVfYWN0aXZlX3JlZihyZWYsIGk5MTVf
cmVxdWVzdF90aW1lbGluZShycSksIHJxKTsKKwlyZXR1cm4gaTkxNV9hY3RpdmVfcmVmKHJlZiwg
aTkxNV9yZXF1ZXN0X3RpbWVsaW5lKHJxKSwgJnJxLT5mZW5jZSk7CiB9CiAKIHZvaWQgaTkxNV9h
Y3RpdmVfc2V0X2V4Y2x1c2l2ZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgc3RydWN0IGRtYV9m
ZW5jZSAqZik7CiAKIHN0YXRpYyBpbmxpbmUgYm9vbCBpOTE1X2FjdGl2ZV9oYXNfZXhjbHVzaXZl
KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQogewotCXJldHVybiByY3VfYWNjZXNzX3BvaW50ZXIo
cmVmLT5leGNsKTsKKwlyZXR1cm4gcmN1X2FjY2Vzc19wb2ludGVyKHJlZi0+ZXhjbC5mZW5jZSk7
CiB9CiAKIGludCBpOTE1X2FjdGl2ZV93YWl0KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsKIAot
aW50IGk5MTVfcmVxdWVzdF9hd2FpdF9hY3RpdmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCi0J
CQkgICAgICBzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7Ci1pbnQgaTkxNV9yZXF1ZXN0X2F3YWl0
X2FjdGl2ZV9yZXF1ZXN0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAotCQkJCSAgICAgIHN0cnVj
dCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUpOworaW50IGk5MTVfcmVxdWVzdF9hd2FpdF9h
Y3RpdmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsIHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsK
IAogaW50IGk5MTVfYWN0aXZlX2FjcXVpcmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpOworYm9v
bCBpOTE1X2FjdGl2ZV9hY3F1aXJlX2lmX2J1c3koc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpOwog
dm9pZCBpOTE1X2FjdGl2ZV9yZWxlYXNlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKTsKLXZvaWQg
X19pOTE1X2FjdGl2ZV9yZWxlYXNlX25lc3RlZChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgaW50
IHN1YmNsYXNzKTsKLQotYm9vbCBpOTE1X2FjdGl2ZV90cnlncmFiKHN0cnVjdCBpOTE1X2FjdGl2
ZSAqcmVmKTsKLXZvaWQgaTkxNV9hY3RpdmVfdW5ncmFiKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVm
KTsKIAogc3RhdGljIGlubGluZSBib29sCiBpOTE1X2FjdGl2ZV9pc19pZGxlKGNvbnN0IHN0cnVj
dCBpOTE1X2FjdGl2ZSAqcmVmKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9hY3RpdmVfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5cGVz
LmgKaW5kZXggMDIxMTY3ZjAwMDRkLi5kODlhNzRjMTQyYzYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9hY3RpdmVfdHlwZXMuaApAQCAtMTcsMTcgKzE3LDkgQEAKIAogI2luY2x1ZGUgImk5
MTVfdXRpbHMuaCIKIAotc3RydWN0IGRybV9pOTE1X3ByaXZhdGU7Ci1zdHJ1Y3QgaTkxNV9hY3Rp
dmVfcmVxdWVzdDsKLXN0cnVjdCBpOTE1X3JlcXVlc3Q7Ci0KLXR5cGVkZWYgdm9pZCAoKmk5MTVf
YWN0aXZlX3JldGlyZV9mbikoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKiwKLQkJCQkgICAg
ICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICopOwotCi1zdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCB7
Ci0Jc3RydWN0IGk5MTVfcmVxdWVzdCBfX3JjdSAqcmVxdWVzdDsKLQlzdHJ1Y3QgbGlzdF9oZWFk
IGxpbms7Ci0JaTkxNV9hY3RpdmVfcmV0aXJlX2ZuIHJldGlyZTsKK3N0cnVjdCBpOTE1X2FjdGl2
ZV9mZW5jZSB7CisJc3RydWN0IGRtYV9mZW5jZSBfX3JjdSAqZmVuY2U7CisJc3RydWN0IGRtYV9m
ZW5jZV9jYiBjYjsKICNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9ERUJVR19HRU0pCiAJ
LyoKIAkgKiBJbmNvcnBvcmVhbCEKQEAgLTUzLDIwICs0NSwxNyBAQCBzdHJ1Y3QgYWN0aXZlX25v
ZGU7CiAjZGVmaW5lIGk5MTVfYWN0aXZlX21heV9zbGVlcChmbikgcHRyX3BhY2tfYml0cygmKGZu
KSwgSTkxNV9BQ1RJVkVfTUFZX1NMRUVQLCAyKQogCiBzdHJ1Y3QgaTkxNV9hY3RpdmUgewotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1OworCWF0b21pY190IGNvdW50OworCXN0cnVjdCBt
dXRleCBtdXRleDsKIAogCXN0cnVjdCBhY3RpdmVfbm9kZSAqY2FjaGU7CiAJc3RydWN0IHJiX3Jv
b3QgdHJlZTsKLQlzdHJ1Y3QgbXV0ZXggbXV0ZXg7Ci0JYXRvbWljX3QgY291bnQ7CiAKIAkvKiBQ
cmVhbGxvY2F0ZWQgImV4Y2x1c2l2ZSIgbm9kZSAqLwotCXN0cnVjdCBkbWFfZmVuY2UgX19yY3Ug
KmV4Y2w7Ci0Jc3RydWN0IGRtYV9mZW5jZV9jYiBleGNsX2NiOworCXN0cnVjdCBpOTE1X2FjdGl2
ZV9mZW5jZSBleGNsOwogCiAJdW5zaWduZWQgbG9uZyBmbGFnczsKICNkZWZpbmUgSTkxNV9BQ1RJ
VkVfUkVUSVJFX1NMRUVQUyBCSVQoMCkKLSNkZWZpbmUgSTkxNV9BQ1RJVkVfR1JBQl9CSVQgMQog
CiAJaW50ICgqYWN0aXZlKShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7CiAJdm9pZCAoKnJldGly
ZSkoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKaW5kZXgg
ZjUwMDU4Y2Y4YWI4Li42NDg5MDYyN2Q2MzggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwpAQCAt
ODkyLDI4ICs4OTIsMzggQEAgd2FpdF9mb3JfdGltZWxpbmVzKHN0cnVjdCBpbnRlbF9ndCAqZ3Qs
IHVuc2lnbmVkIGludCB3YWl0LCBsb25nIHRpbWVvdXQpCiAKIAlzcGluX2xvY2tfaXJxc2F2ZSgm
dGltZWxpbmVzLT5sb2NrLCBmbGFncyk7CiAJbGlzdF9mb3JfZWFjaF9lbnRyeSh0bCwgJnRpbWVs
aW5lcy0+YWN0aXZlX2xpc3QsIGxpbmspIHsKLQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJ
CXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlOwogCi0JCXJxID0gaTkxNV9hY3RpdmVfcmVxdWVzdF9n
ZXRfdW5sb2NrZWQoJnRsLT5sYXN0X3JlcXVlc3QpOwotCQlpZiAoIXJxKQorCQlmZW5jZSA9IGk5
MTVfYWN0aXZlX2ZlbmNlX2dldCgmdGwtPmxhc3RfcmVxdWVzdCk7CisJCWlmICghZmVuY2UpCiAJ
CQljb250aW51ZTsKIAogCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZ0aW1lbGluZXMtPmxvY2ss
IGZsYWdzKTsKIAotCQkvKgotCQkgKiAiUmFjZS10by1pZGxlIi4KLQkJICoKLQkJICogU3dpdGNo
aW5nIHRvIHRoZSBrZXJuZWwgY29udGV4dCBpcyBvZnRlbiB1c2VkIGEgc3luY2hyb25vdXMKLQkJ
ICogc3RlcCBwcmlvciB0byBpZGxpbmcsIGUuZy4gaW4gc3VzcGVuZCBmb3IgZmx1c2hpbmcgYWxs
Ci0JCSAqIGN1cnJlbnQgb3BlcmF0aW9ucyB0byBtZW1vcnkgYmVmb3JlIHNsZWVwaW5nLiBUaGVz
ZSB3ZQotCQkgKiB3YW50IHRvIGNvbXBsZXRlIGFzIHF1aWNrbHkgYXMgcG9zc2libGUgdG8gYXZv
aWQgcHJvbG9uZ2VkCi0JCSAqIHN0YWxscywgc28gYWxsb3cgdGhlIGdwdSB0byBib29zdCB0byBt
YXhpbXVtIGNsb2Nrcy4KLQkJICovCi0JCWlmICh3YWl0ICYgSTkxNV9XQUlUX0ZPUl9JRExFX0JP
T1NUKQotCQkJZ2VuNl9ycHNfYm9vc3QocnEpOworCQlpZiAoIWRtYV9mZW5jZV9pc19pOTE1KGZl
bmNlKSkgeworCQkJdGltZW91dCA9IGRtYV9mZW5jZV93YWl0X3RpbWVvdXQoZmVuY2UsCisJCQkJ
CQkJIGZsYWdzICYgSTkxNV9XQUlUX0lOVEVSUlVQVElCTEUsCisJCQkJCQkJIHRpbWVvdXQpOwor
CQl9IGVsc2UgeworCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEgPSB0b19yZXF1ZXN0KGZlbmNl
KTsKKworCQkJLyoKKwkJCSAqICJSYWNlLXRvLWlkbGUiLgorCQkJICoKKwkJCSAqIFN3aXRjaGlu
ZyB0byB0aGUga2VybmVsIGNvbnRleHQgaXMgb2Z0ZW4gdXNlZCBhcworCQkJICogYSBzeW5jaHJv
bm91cyBzdGVwIHByaW9yIHRvIGlkbGluZywgZS5nLiBpbiBzdXNwZW5kCisJCQkgKiBmb3IgZmx1
c2hpbmcgYWxsIGN1cnJlbnQgb3BlcmF0aW9ucyB0byBtZW1vcnkgYmVmb3JlCisJCQkgKiBzbGVl
cGluZy4gVGhlc2Ugd2Ugd2FudCB0byBjb21wbGV0ZSBhcyBxdWlja2x5IGFzCisJCQkgKiBwb3Nz
aWJsZSB0byBhdm9pZCBwcm9sb25nZWQgc3RhbGxzLCBzbyBhbGxvdyB0aGUgZ3B1CisJCQkgKiB0
byBib29zdCB0byBtYXhpbXVtIGNsb2Nrcy4KKwkJCSAqLworCQkJaWYgKGZsYWdzICYgSTkxNV9X
QUlUX0ZPUl9JRExFX0JPT1NUKQorCQkJCWdlbjZfcnBzX2Jvb3N0KHJxKTsKKworCQkJdGltZW91
dCA9IGk5MTVfcmVxdWVzdF93YWl0KHJxLCBmbGFncywgdGltZW91dCk7CisJCX0KIAotCQl0aW1l
b3V0ID0gaTkxNV9yZXF1ZXN0X3dhaXQocnEsIHdhaXQsIHRpbWVvdXQpOwotCQlpOTE1X3JlcXVl
c3RfcHV0KHJxKTsKKwkJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CiAJCWlmICh0aW1lb3V0IDwgMCkK
IAkJCXJldHVybiB0aW1lb3V0OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCmluZGV4
IDU1Y2ViZjI1NmQwMy4uNzQ2MmQ4N2Y3YTQ4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9n
dHQuYwpAQCAtMTg2MSw3ICsxODYxLDYgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBpOTE1X3ZtYV9v
cHMgcGRfdm1hX29wcyA9IHsKIAogc3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqcGRfdm1hX2NyZWF0
ZShzdHJ1Y3QgZ2VuNl9wcGd0dCAqcHBndHQsIGludCBzaXplKQogewotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gcHBndHQtPmJhc2Uudm0uaTkxNTsKIAlzdHJ1Y3QgaTkxNV9nZ3R0
ICpnZ3R0ID0gcHBndHQtPmJhc2Uudm0uZ3QtPmdndHQ7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7
CiAKQEAgLTE4NzIsNyArMTg3MSw3IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKnBkX3ZtYV9j
cmVhdGUoc3RydWN0IGdlbjZfcHBndHQgKnBwZ3R0LCBpbnQgc2l6ZSkKIAlpZiAoIXZtYSkKIAkJ
cmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CiAKLQlpOTE1X2FjdGl2ZV9pbml0KGk5MTUsICZ2bWEt
PmFjdGl2ZSwgTlVMTCwgTlVMTCk7CisJaTkxNV9hY3RpdmVfaW5pdCgmdm1hLT5hY3RpdmUsIE5V
TEwsIE5VTEwpOwogCiAJbXV0ZXhfaW5pdCgmdm1hLT5wYWdlc19tdXRleCk7CiAJdm1hLT52bSA9
IGk5MTVfdm1fZ2V0KCZnZ3R0LT52bSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dwdV9lcnJvci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3Iu
YwppbmRleCA2Mzg0YTA2YWE1YmYuLmEyOGVlNzU0YjdiNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3IuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dwdV9lcnJvci5jCkBAIC0xMjk5LDcgKzEyOTksNyBAQCBjYXB0dXJlX3ZtYShzdHJ1Y3Qg
Y2FwdHVyZV92bWEgKm5leHQsCiAJaWYgKCFjKQogCQlyZXR1cm4gbmV4dDsKIAotCWlmICghaTkx
NV9hY3RpdmVfdHJ5Z3JhYigmdm1hLT5hY3RpdmUpKSB7CisJaWYgKCFpOTE1X2FjdGl2ZV9hY3F1
aXJlX2lmX2J1c3koJnZtYS0+YWN0aXZlKSkgewogCQlrZnJlZShjKTsKIAkJcmV0dXJuIG5leHQ7
CiAJfQpAQCAtMTQzOSw3ICsxNDM5LDcgQEAgZ2VtX3JlY29yZF9yaW5ncyhzdHJ1Y3QgaTkxNV9n
cHVfc3RhdGUgKmVycm9yLCBzdHJ1Y3QgY29tcHJlc3MgKmNvbXByZXNzKQogCQkJKnRoaXMtPnNs
b3QgPQogCQkJCWk5MTVfZXJyb3Jfb2JqZWN0X2NyZWF0ZShpOTE1LCB2bWEsIGNvbXByZXNzKTsK
IAotCQkJaTkxNV9hY3RpdmVfdW5ncmFiKCZ2bWEtPmFjdGl2ZSk7CisJCQlpOTE1X2FjdGl2ZV9y
ZWxlYXNlKCZ2bWEtPmFjdGl2ZSk7CiAJCQlpOTE1X3ZtYV9wdXQodm1hKTsKIAogCQkJY2FwdHVy
ZSA9IHRoaXMtPm5leHQ7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Jl
cXVlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCmluZGV4IGE4OTE2
NDEyNzU5Yi4uNGZmZTYyYTQyMTg2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3JlcXVlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYwpA
QCAtMjE4LDggKzIxOCw2IEBAIHN0YXRpYyB2b2lkIHJlbW92ZV9mcm9tX2VuZ2luZShzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycSkKIAogc3RhdGljIGJvb2wgaTkxNV9yZXF1ZXN0X3JldGlyZShzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKLQlzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0
aXZlLCAqbmV4dDsKLQogCWlmICghaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChycSkpCiAJCXJldHVy
biBmYWxzZTsKIApAQCAtMjQ0LDM1ICsyNDIsNiBAQCBzdGF0aWMgYm9vbCBpOTE1X3JlcXVlc3Rf
cmV0aXJlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCQkJCSAgJmk5MTVfcmVxdWVzdF90aW1l
bGluZShycSktPnJlcXVlc3RzKSk7CiAJcnEtPnJpbmctPmhlYWQgPSBycS0+cG9zdGZpeDsKIAot
CS8qCi0JICogV2FsayB0aHJvdWdoIHRoZSBhY3RpdmUgbGlzdCwgY2FsbGluZyByZXRpcmUgb24g
ZWFjaC4gVGhpcyBhbGxvd3MKLQkgKiBvYmplY3RzIHRvIHRyYWNrIHRoZWlyIEdQVSBhY3Rpdml0
eSBhbmQgbWFyayB0aGVtc2VsdmVzIGFzIGlkbGUKLQkgKiB3aGVuIHRoZWlyICpsYXN0KiBhY3Rp
dmUgcmVxdWVzdCBpcyBjb21wbGV0ZWQgKHVwZGF0aW5nIHN0YXRlCi0JICogdHJhY2tpbmcgbGlz
dHMgZm9yIGV2aWN0aW9uLCBhY3RpdmUgcmVmZXJlbmNlcyBmb3IgR0VNLCBldGMpLgotCSAqCi0J
ICogQXMgdGhlIC0+cmV0aXJlKCkgbWF5IGZyZWUgdGhlIG5vZGUsIHdlIGRlY291cGxlIGl0IGZp
cnN0IGFuZAotCSAqIHBhc3MgYWxvbmcgdGhlIGF1eGlsaWFyeSBpbmZvcm1hdGlvbiAodG8gYXZv
aWQgZGVyZWZlcmVuY2luZwotCSAqIHRoZSBub2RlIGFmdGVyIHRoZSBjYWxsYmFjaykuCi0JICov
Ci0JbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKGFjdGl2ZSwgbmV4dCwgJnJxLT5hY3RpdmVfbGlz
dCwgbGluaykgewotCQkvKgotCQkgKiBJbiBtaWNyb2JlbmNobWFya3Mgb3IgZm9jdXNpbmcgdXBv
biB0aW1lIGluc2lkZSB0aGUga2VybmVsLAotCQkgKiB3ZSBtYXkgc3BlbmQgYW4gaW5vcmRpbmF0
ZSBhbW91bnQgb2YgdGltZSBzaW1wbHkgaGFuZGxpbmcKLQkJICogdGhlIHJldGlyZW1lbnQgb2Yg
cmVxdWVzdHMgYW5kIHByb2Nlc3NpbmcgdGhlaXIgY2FsbGJhY2tzLgotCQkgKiBPZiB3aGljaCwg
dGhpcyBsb29wIGl0c2VsZiBpcyBwYXJ0aWN1bGFybHkgaG90IGR1ZSB0byB0aGUKLQkJICogY2Fj
aGUgbWlzc2VzIHdoZW4ganVtcGluZyBhcm91bmQgdGhlIGxpc3Qgb2YKLQkJICogaTkxNV9hY3Rp
dmVfcmVxdWVzdC4gIFNvIHdlIHRyeSB0byBrZWVwIHRoaXMgbG9vcCBhcwotCQkgKiBzdHJlYW1s
aW5lZCBhcyBwb3NzaWJsZSBhbmQgYWxzbyBwcmVmZXRjaCB0aGUgbmV4dAotCQkgKiBpOTE1X2Fj
dGl2ZV9yZXF1ZXN0IHRvIHRyeSBhbmQgaGlkZSB0aGUgbGlrZWx5IGNhY2hlIG1pc3MuCi0JCSAq
LwotCQlwcmVmZXRjaHcobmV4dCk7Ci0KLQkJSU5JVF9MSVNUX0hFQUQoJmFjdGl2ZS0+bGluayk7
Ci0JCVJDVV9JTklUX1BPSU5URVIoYWN0aXZlLT5yZXF1ZXN0LCBOVUxMKTsKLQotCQlhY3RpdmUt
PnJldGlyZShhY3RpdmUsIHJxKTsKLQl9Ci0KIAlsb2NhbF9pcnFfZGlzYWJsZSgpOwogCiAJLyoK
QEAgLTcwNCw3ICs2NzMsNiBAQCBfX2k5MTVfcmVxdWVzdF9jcmVhdGUoc3RydWN0IGludGVsX2Nv
bnRleHQgKmNlLCBnZnBfdCBnZnApCiAJcnEtPmZsYWdzID0gMDsKIAlycS0+ZXhlY3V0aW9uX21h
c2sgPSBBTExfRU5HSU5FUzsKIAotCUlOSVRfTElTVF9IRUFEKCZycS0+YWN0aXZlX2xpc3QpOwog
CUlOSVRfTElTVF9IRUFEKCZycS0+ZXhlY3V0ZV9jYik7CiAKIAkvKgpAQCAtNzQzLDcgKzcxMSw2
IEBAIF9faTkxNV9yZXF1ZXN0X2NyZWF0ZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIGdmcF90
IGdmcCkKIAljZS0+cmluZy0+ZW1pdCA9IHJxLT5oZWFkOwogCiAJLyogTWFrZSBzdXJlIHdlIGRp
ZG4ndCBhZGQgb3Vyc2VsdmVzIHRvIGV4dGVybmFsIHN0YXRlIGJlZm9yZSBmcmVlaW5nICovCi0J
R0VNX0JVR19PTighbGlzdF9lbXB0eSgmcnEtPmFjdGl2ZV9saXN0KSk7CiAJR0VNX0JVR19PTigh
bGlzdF9lbXB0eSgmcnEtPnNjaGVkLnNpZ25hbGVyc19saXN0KSk7CiAJR0VNX0JVR19PTighbGlz
dF9lbXB0eSgmcnEtPnNjaGVkLndhaXRlcnNfbGlzdCkpOwogCkBAIC0xMTc0LDggKzExNDEsOCBA
QCBfX2k5MTVfcmVxdWVzdF9hZGRfdG9fdGltZWxpbmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEp
CiAJICogcHJlY2x1ZGVzIG9wdGltaXNpbmcgdG8gdXNlIHNlbWFwaG9yZXMgc2VyaWFsaXNhdGlv
biBvZiBhIHNpbmdsZQogCSAqIHRpbWVsaW5lIGFjcm9zcyBlbmdpbmVzLgogCSAqLwotCXByZXYg
PSByY3VfZGVyZWZlcmVuY2VfcHJvdGVjdGVkKHRpbWVsaW5lLT5sYXN0X3JlcXVlc3QucmVxdWVz
dCwKLQkJCQkJIGxvY2tkZXBfaXNfaGVsZCgmdGltZWxpbmUtPm11dGV4KSk7CisJcHJldiA9IHRv
X3JlcXVlc3QoX19pOTE1X2FjdGl2ZV9mZW5jZV9zZXQoJnRpbWVsaW5lLT5sYXN0X3JlcXVlc3Qs
CisJCQkJCQkgICZycS0+ZmVuY2UpKTsKIAlpZiAocHJldiAmJiAhaTkxNV9yZXF1ZXN0X2NvbXBs
ZXRlZChwcmV2KSkgewogCQlpZiAoaXNfcG93ZXJfb2ZfMihwcmV2LT5lbmdpbmUtPm1hc2sgfCBy
cS0+ZW5naW5lLT5tYXNrKSkKIAkJCWk5MTVfc3dfZmVuY2VfYXdhaXRfc3dfZmVuY2UoJnJxLT5z
dWJtaXQsCkBAIC0xMjAwLDcgKzExNjcsNiBAQCBfX2k5MTVfcmVxdWVzdF9hZGRfdG9fdGltZWxp
bmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJICogdXMsIHRoZSB0aW1lbGluZSB3aWxsIGhv
bGQgaXRzIHNlcW5vIHdoaWNoIGlzIGxhdGVyIHRoYW4gb3Vycy4KIAkgKi8KIAlHRU1fQlVHX09O
KHRpbWVsaW5lLT5zZXFubyAhPSBycS0+ZmVuY2Uuc2Vxbm8pOwotCV9faTkxNV9hY3RpdmVfcmVx
dWVzdF9zZXQoJnRpbWVsaW5lLT5sYXN0X3JlcXVlc3QsIHJxKTsKIAogCXJldHVybiBwcmV2Owog
fQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmggYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaAppbmRleCBlYzViYjRjMmU1YWUuLjkxYTg4
NWMzNmM2YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmgK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmgKQEAgLTIxMSw3ICsyMTEs
NiBAQCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0IHsKIAkgKiBvbiB0aGUgYWN0aXZlX2xpc3QgKG9mIHRo
ZWlyIGZpbmFsIHJlcXVlc3QpLgogCSAqLwogCXN0cnVjdCBpOTE1X2NhcHR1cmVfbGlzdCAqY2Fw
dHVyZV9saXN0OwotCXN0cnVjdCBsaXN0X2hlYWQgYWN0aXZlX2xpc3Q7CiAKIAkvKiogVGltZSBh
dCB3aGljaCB0aGlzIHJlcXVlc3Qgd2FzIGVtaXR0ZWQsIGluIGppZmZpZXMuICovCiAJdW5zaWdu
ZWQgbG9uZyBlbWl0dGVkX2ppZmZpZXM7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3ZtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwppbmRleCBlMTkx
MjQ3YzdjNWYuLjlmZGNkNGUyYzc5OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV92bWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCkBAIC0xMjAs
OCArMTIwLDcgQEAgdm1hX2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAog
CXZtYS0+c2l6ZSA9IG9iai0+YmFzZS5zaXplOwogCXZtYS0+ZGlzcGxheV9hbGlnbm1lbnQgPSBJ
OTE1X0dUVF9NSU5fQUxJR05NRU5UOwogCi0JaTkxNV9hY3RpdmVfaW5pdCh2bS0+aTkxNSwgJnZt
YS0+YWN0aXZlLAotCQkJIF9faTkxNV92bWFfYWN0aXZlLCBfX2k5MTVfdm1hX3JldGlyZSk7CisJ
aTkxNV9hY3RpdmVfaW5pdCgmdm1hLT5hY3RpdmUsIF9faTkxNV92bWFfYWN0aXZlLCBfX2k5MTVf
dm1hX3JldGlyZSk7CiAKIAkvKiBEZWNsYXJlIG91cnNlbHZlcyBzYWZlIGZvciB1c2UgaW5zaWRl
IHNocmlua2VycyAqLwogCWlmIChJU19FTkFCTEVEKENPTkZJR19MT0NLREVQKSkgewpAQCAtMTE0
OCw2ICsxMTQ3LDcgQEAgaW50IF9faTkxNV92bWFfdW5iaW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1h
KQogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKKwlHRU1fQlVHX09OKGk5MTVfdm1hX2lzX2Fj
dGl2ZSh2bWEpKTsKIAlpZiAoaTkxNV92bWFfaXNfcGlubmVkKHZtYSkpIHsKIAkJdm1hX3ByaW50
X2FsbG9jYXRvcih2bWEsICJpcyBwaW5uZWQiKTsKIAkJcmV0dXJuIC1FQlVTWTsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfYWN0aXZlLmMKaW5kZXggYTQxNzg1ODIyZWQ5
Li4yY2M3MWJjZjg4NGYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pOTE1X2FjdGl2ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1
X2FjdGl2ZS5jCkBAIC02OCw3ICs2OCw3IEBAIHN0YXRpYyBzdHJ1Y3QgbGl2ZV9hY3RpdmUgKl9f
bGl2ZV9hbGxvYyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkJcmV0dXJuIE5VTEw7
CiAKIAlrcmVmX2luaXQoJmFjdGl2ZS0+cmVmKTsKLQlpOTE1X2FjdGl2ZV9pbml0KGk5MTUsICZh
Y3RpdmUtPmJhc2UsIF9fbGl2ZV9hY3RpdmUsIF9fbGl2ZV9yZXRpcmUpOworCWk5MTVfYWN0aXZl
X2luaXQoJmFjdGl2ZS0+YmFzZSwgX19saXZlX2FjdGl2ZSwgX19saXZlX3JldGlyZSk7CiAKIAly
ZXR1cm4gYWN0aXZlOwogfQpAQCAtMTQ2LDE5ICsxNDYsMTMgQEAgc3RhdGljIGludCBsaXZlX2Fj
dGl2ZV93YWl0KHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IGFyZzsKIAlzdHJ1Y3QgbGl2ZV9hY3RpdmUgKmFjdGl2ZTsKLQlpbnRlbF93YWtlcmVmX3Qgd2Fr
ZXJlZjsKIAlpbnQgZXJyID0gMDsKIAogCS8qIENoZWNrIHRoYXQgd2UgZ2V0IGEgY2FsbGJhY2sg
d2hlbiByZXF1ZXN0cyByZXRpcmUgdXBvbiB3YWl0aW5nICovCiAKLQltdXRleF9sb2NrKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmk5
MTUtPnJ1bnRpbWVfcG0pOwotCiAJYWN0aXZlID0gX19saXZlX2FjdGl2ZV9zZXR1cChpOTE1KTsK
LQlpZiAoSVNfRVJSKGFjdGl2ZSkpIHsKLQkJZXJyID0gUFRSX0VSUihhY3RpdmUpOwotCQlnb3Rv
IGVycjsKLQl9CisJaWYgKElTX0VSUihhY3RpdmUpKQorCQlyZXR1cm4gUFRSX0VSUihhY3RpdmUp
OwogCiAJaTkxNV9hY3RpdmVfd2FpdCgmYWN0aXZlLT5iYXNlKTsKIAlpZiAoIVJFQURfT05DRShh
Y3RpdmUtPnJldGlyZWQpKSB7CkBAIC0xNjgsMTEgKzE2Miw5IEBAIHN0YXRpYyBpbnQgbGl2ZV9h
Y3RpdmVfd2FpdCh2b2lkICphcmcpCiAKIAlfX2xpdmVfcHV0KGFjdGl2ZSk7CiAKKwltdXRleF9s
b2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwg
STkxNV9XQUlUX0xPQ0tFRCkpCiAJCWVyciA9IC1FSU87Ci0KLWVycjoKLQlpbnRlbF9ydW50aW1l
X3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7CiAJbXV0ZXhfdW5sb2NrKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKIAogCXJldHVybiBlcnI7CkBAIC0xODIsMjMgKzE3NCwxOSBA
QCBzdGF0aWMgaW50IGxpdmVfYWN0aXZlX3JldGlyZSh2b2lkICphcmcpCiB7CiAJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CiAJc3RydWN0IGxpdmVfYWN0aXZlICphY3RpdmU7
Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJaW50IGVyciA9IDA7CiAKIAkvKiBDaGVjayB0
aGF0IHdlIGdldCBhIGNhbGxiYWNrIHdoZW4gcmVxdWVzdHMgYXJlIGluZGlyZWN0bHkgcmV0aXJl
ZCAqLwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9
IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKLQogCWFjdGl2ZSA9IF9f
bGl2ZV9hY3RpdmVfc2V0dXAoaTkxNSk7Ci0JaWYgKElTX0VSUihhY3RpdmUpKSB7Ci0JCWVyciA9
IFBUUl9FUlIoYWN0aXZlKTsKLQkJZ290byBlcnI7Ci0JfQorCWlmIChJU19FUlIoYWN0aXZlKSkK
KwkJcmV0dXJuIFBUUl9FUlIoYWN0aXZlKTsKIAogCS8qIHdhaXRzIGZvciAmIHJldGlyZXMgYWxs
IHJlcXVlc3RzICovCisJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYg
KGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQogCQllcnIgPSAtRUlPOwor
CW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlpZiAoIVJFQURfT05D
RShhY3RpdmUtPnJldGlyZWQpKSB7CiAJCXByX2VycigiaTkxNV9hY3RpdmUgbm90IHJldGlyZWQg
YWZ0ZXIgZmx1c2hpbmchXG4iKTsKQEAgLTIwNywxMCArMTk1LDYgQEAgc3RhdGljIGludCBsaXZl
X2FjdGl2ZV9yZXRpcmUodm9pZCAqYXJnKQogCiAJX19saXZlX3B1dChhY3RpdmUpOwogCi1lcnI6
Ci0JaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlyZXR1cm4gZXJyOwogfQog
Ci0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdm
eA==

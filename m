Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 48E8251C67
	for <lists+intel-gfx@lfdr.de>; Mon, 24 Jun 2019 22:32:19 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 73A0C89DEA;
	Mon, 24 Jun 2019 20:32:17 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga06.intel.com (mga06.intel.com [134.134.136.31])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B173189DE1
 for <intel-gfx@lists.freedesktop.org>; Mon, 24 Jun 2019 20:32:14 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga004.fm.intel.com ([10.253.24.48])
 by orsmga104.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 24 Jun 2019 13:32:14 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,413,1557212400"; d="scan'208";a="184241365"
Received: from dceraolo-linux.fm.intel.com ([10.1.27.145])
 by fmsmga004.fm.intel.com with ESMTP; 24 Jun 2019 13:32:14 -0700
From: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 24 Jun 2019 13:31:50 -0700
Message-Id: <20190624203152.13725-3-daniele.ceraolospurio@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190624203152.13725-1-daniele.ceraolospurio@intel.com>
References: <20190624203152.13725-1-daniele.ceraolospurio@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [RFC 2/4] drm/i915: rework mmio debug stop/start
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U2luY2Ugd2Ugbm93IGhhdmUgYSBzZXBhcmF0ZSBvYmplY3QsIGl0IGlzIGNsZWFuZXIgdG8gaGF2
ZSBkZWRpY2F0ZWQKZnVuY3Rpb25zIHdvcmtpbmcgb24gdGhlIG9iamVjdCB0byBzdG9wIGFuZCBy
ZXN0YXJ0IHRoZSBtbWlvIGRlYnVnLgpBcGFydCBmcm9tIHRoZSBjb3NtZXRpYyBjaGFuZ2VzLCB0
aGlzIHBhdGNoIGludHJvZHVjZXMgMiBmdW5jdGlvbmFsCnVwZGF0ZXM6CgotIEFsbCBjYWxscyB0
byBjaGVja19mb3JfdW5jbGFpbWVkX21taW8gd2lsbCBub3cgcmV0dXJuIGZhbHNlIHdoZW4KICB0
aGUgZGVidWcgaXMgc3VzcGVuZGVkLCBub3QganVzdCB0aGUgb25lcyB0aGF0IGFyZSBhY3RpdmUg
b25seSB3aGVuCiAgaTkxNV9tb2RwYXJhbXMubW1pb19kZWJ1ZyBpcyBzZXQuIElmIHdlIGRvbid0
IHRydXN0IHRoZSByZXN1bHQgb2YgdGhlCiAgY2hlY2sgd2hpbGUgYSB1c2VyIGlzIGRvaW5nIG1t
aW8gYWNjZXNzIHRoZW4gd2Ugc2hvdWxkbid0IGF0dGVtcHQgdGhlCiAgY2hlY2sgYW55d2hlcmUu
CgotIGk5MTVfbW9kcGFyYW1zLm1taW9fZGVidWcgaXMgbm90IHNhdmUvcmVzdG9yZWQgYW55bW9y
ZSBhcm91bmQgdXNlcgogIGFjY2Vzcy4gVGhlIHZhbHVlIGlzIG5vdyBuZXZlciB0b3VjaGVkIGJ5
IHRoZSBrZXJuZWwgd2hpbGUgZGVidWcgaXMKICBkaXNhYmxlZCBzbyBubyBuZWVkIGZvciBzYXZl
L3Jlc3RvcmUuCgpTaWduZWQtb2ZmLWJ5OiBEYW5pZWxlIENlcmFvbG8gU3B1cmlvIDxkYW5pZWxl
LmNlcmFvbG9zcHVyaW9AaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZGVidWdmcy5jIHwgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMgICAgIHwg
IDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3VuY29yZS5jIHwgNDMgKysrKysrKysr
KysrKysrKysrLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3VuY29yZS5o
IHwgIDkgKystLS0tCiA0IGZpbGVzIGNoYW5nZWQsIDMyIGluc2VydGlvbnMoKyksIDI0IGRlbGV0
aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKaW5kZXggZWVlY2RhZDBlM2Nh
Li4xZWI3MmJkNzRhYjkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVi
dWdmcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCkBAIC0xMjE4
LDcgKzEyMTgsNyBAQCBzdGF0aWMgaW50IGk5MTVfZm9yY2V3YWtlX2RvbWFpbnMoc3RydWN0IHNl
cV9maWxlICptLCB2b2lkICpkYXRhKQogCXVuc2lnbmVkIGludCB0bXA7CiAKIAlzZXFfcHJpbnRm
KG0sICJ1c2VyLmJ5cGFzc19jb3VudCA9ICV1XG4iLAotCQkgICB1bmNvcmUtPnVzZXJfZm9yY2V3
YWtlLmNvdW50KTsKKwkJICAgdW5jb3JlLT51c2VyX2ZvcmNld2FrZV9jb3VudCk7CiAKIAlmb3Jf
ZWFjaF9md19kb21haW4oZndfZG9tYWluLCB1bmNvcmUsIHRtcCkKIAkJc2VxX3ByaW50ZihtLCAi
JXMud2FrZV9jb3VudCA9ICV1XG4iLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9kcnYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMKaW5kZXggMWM0Y2Zk
YjA0ODY3Li4yZDZjNjQzZGRlNTEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYwpAQCAtMjIwNCw3
ICsyMjA0LDcgQEAgc3RhdGljIGludCBpOTE1X2RybV9zdXNwZW5kX2xhdGUoc3RydWN0IGRybV9k
ZXZpY2UgKmRldiwgYm9vbCBoaWJlcm5hdGlvbikKIAogb3V0OgogCWVuYWJsZV9ycG1fd2FrZXJl
Zl9hc3NlcnRzKHJwbSk7Ci0JaWYgKCFkZXZfcHJpdi0+dW5jb3JlLnVzZXJfZm9yY2V3YWtlLmNv
dW50KQorCWlmICghZGV2X3ByaXYtPnVuY29yZS51c2VyX2ZvcmNld2FrZV9jb3VudCkKIAkJaW50
ZWxfcnVudGltZV9wbV9jbGVhbnVwKHJwbSk7CiAKIAlyZXR1cm4gcmV0OwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdW5jb3JlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF91bmNvcmUuYwppbmRleCBmMmRmYWNjZDY2MTQuLjE5MDVmZDk0ZGQzYyAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdW5jb3JlLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaW50ZWxfdW5jb3JlLmMKQEAgLTQxLDYgKzQxLDI1IEBAIGludGVsX3VuY29y
ZV9tbWlvX2RlYnVnX2luaXRfZWFybHkoc3RydWN0IGludGVsX3VuY29yZV9tbWlvX2RlYnVnICpt
bWlvX2RlYnVnKQogCW1taW9fZGVidWctPnVuY2xhaW1lZF9tbWlvX2NoZWNrID0gMTsKIH0KIAor
dm9pZCB1bmNvcmVfbW1pb19kZWJ1Z19zdXNwZW5kKHN0cnVjdCBpbnRlbF91bmNvcmVfbW1pb19k
ZWJ1ZyAqbW1pb19kZWJ1ZykKK3sKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZtbWlvX2RlYnVnLT5s
b2NrKTsKKworCS8qIFNhdmUgYW5kIGRpc2FibGUgbW1pbyBkZWJ1Z2dpbmcgZm9yIHRoZSB1c2Vy
IGJ5cGFzcyAqLworCWlmICghbW1pb19kZWJ1Zy0+c3VzcGVuZF9jb3VudCsrKSB7CisJCW1taW9f
ZGVidWctPnNhdmVkX21taW9fY2hlY2sgPSBtbWlvX2RlYnVnLT51bmNsYWltZWRfbW1pb19jaGVj
azsKKwkJbW1pb19kZWJ1Zy0+dW5jbGFpbWVkX21taW9fY2hlY2sgPSAwOworCX0KK30KKwordm9p
ZCB1bmNvcmVfbW1pb19kZWJ1Z19yZXN1bWUoc3RydWN0IGludGVsX3VuY29yZV9tbWlvX2RlYnVn
ICptbWlvX2RlYnVnKQoreworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJm1taW9fZGVidWctPmxvY2sp
OworCisJaWYgKCEtLW1taW9fZGVidWctPnN1c3BlbmRfY291bnQpCisJCW1taW9fZGVidWctPnVu
Y2xhaW1lZF9tbWlvX2NoZWNrID0gbW1pb19kZWJ1Zy0+c2F2ZWRfbW1pb19jaGVjazsKK30KKwog
c3RhdGljIGNvbnN0IGNoYXIgKiBjb25zdCBmb3JjZXdha2VfZG9tYWluX25hbWVzW10gPSB7CiAJ
InJlbmRlciIsCiAJImJsaXR0ZXIiLApAQCAtNDgyLDYgKzUwMSw5IEBAIGNoZWNrX2Zvcl91bmNs
YWltZWRfbW1pbyhzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpCiAKIAlsb2NrZGVwX2Fzc2Vy
dF9oZWxkKCZ1bmNvcmUtPmRlYnVnLT5sb2NrKTsKIAorCWlmICh1bmNvcmUtPmRlYnVnLT5zdXNw
ZW5kX2NvdW50KQorCQlyZXR1cm4gZmFsc2U7CisKIAlpZiAoaW50ZWxfdW5jb3JlX2hhc19mcGdh
X2RiZ191bmNsYWltZWQodW5jb3JlKSkKIAkJcmV0IHw9IGZwZ2FfY2hlY2tfZm9yX3VuY2xhaW1l
ZF9tbWlvKHVuY29yZSk7CiAKQEAgLTYxNSwxNyArNjM3LDkgQEAgdm9pZCBpbnRlbF91bmNvcmVf
Zm9yY2V3YWtlX3VzZXJfZ2V0KHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSkKIHsKIAlzcGlu
X2xvY2tfaXJxKCZ1bmNvcmUtPmxvY2spOwogCXNwaW5fbG9jaygmdW5jb3JlLT5kZWJ1Zy0+bG9j
ayk7Ci0JaWYgKCF1bmNvcmUtPnVzZXJfZm9yY2V3YWtlLmNvdW50KyspIHsKKwlpZiAoIXVuY29y
ZS0+dXNlcl9mb3JjZXdha2VfY291bnQrKykgewogCQlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX2dl
dF9fbG9ja2VkKHVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7Ci0KLQkJLyogU2F2ZSBhbmQgZGlzYWJs
ZSBtbWlvIGRlYnVnZ2luZyBmb3IgdGhlIHVzZXIgYnlwYXNzICovCi0JCXVuY29yZS0+dXNlcl9m
b3JjZXdha2Uuc2F2ZWRfbW1pb19jaGVjayA9Ci0JCQl1bmNvcmUtPmRlYnVnLT51bmNsYWltZWRf
bW1pb19jaGVjazsKLQkJdW5jb3JlLT51c2VyX2ZvcmNld2FrZS5zYXZlZF9tbWlvX2RlYnVnID0K
LQkJCWk5MTVfbW9kcGFyYW1zLm1taW9fZGVidWc7Ci0KLQkJdW5jb3JlLT5kZWJ1Zy0+dW5jbGFp
bWVkX21taW9fY2hlY2sgPSAwOwotCQlpOTE1X21vZHBhcmFtcy5tbWlvX2RlYnVnID0gMDsKKwkJ
dW5jb3JlX21taW9fZGVidWdfc3VzcGVuZCh1bmNvcmUtPmRlYnVnKTsKIAl9CiAJc3Bpbl91bmxv
Y2soJnVuY29yZS0+ZGVidWctPmxvY2spOwogCXNwaW5fdW5sb2NrX2lycSgmdW5jb3JlLT5sb2Nr
KTsKQEAgLTY0MiwxNiArNjU2LDEzIEBAIHZvaWQgaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV91c2Vy
X3B1dChzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpCiB7CiAJc3Bpbl9sb2NrX2lycSgmdW5j
b3JlLT5sb2NrKTsKIAlzcGluX2xvY2soJnVuY29yZS0+ZGVidWctPmxvY2spOwotCWlmICghLS11
bmNvcmUtPnVzZXJfZm9yY2V3YWtlLmNvdW50KSB7CisJaWYgKCEtLXVuY29yZS0+dXNlcl9mb3Jj
ZXdha2VfY291bnQpIHsKKwkJdW5jb3JlX21taW9fZGVidWdfcmVzdW1lKHVuY29yZS0+ZGVidWcp
OworCiAJCWlmIChjaGVja19mb3JfdW5jbGFpbWVkX21taW8odW5jb3JlKSkKIAkJCWRldl9pbmZv
KHVuY29yZS0+aTkxNS0+ZHJtLmRldiwKIAkJCQkgIkludmFsaWQgbW1pbyBkZXRlY3RlZCBkdXJp
bmcgdXNlciBhY2Nlc3NcbiIpOwogCi0JCXVuY29yZS0+ZGVidWctPnVuY2xhaW1lZF9tbWlvX2No
ZWNrID0KLQkJCXVuY29yZS0+dXNlcl9mb3JjZXdha2Uuc2F2ZWRfbW1pb19jaGVjazsKLQkJaTkx
NV9tb2RwYXJhbXMubW1pb19kZWJ1ZyA9Ci0JCQl1bmNvcmUtPnVzZXJfZm9yY2V3YWtlLnNhdmVk
X21taW9fZGVidWc7Ci0KIAkJaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXRfX2xvY2tlZCh1bmNv
cmUsIEZPUkNFV0FLRV9BTEwpOwogCX0KIAlzcGluX3VubG9jaygmdW5jb3JlLT5kZWJ1Zy0+bG9j
ayk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF91bmNvcmUuaCBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3VuY29yZS5oCmluZGV4IGQxYjEyYjNiODM1My4uMzk2
OWRkMTIyMDhiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF91bmNvcmUu
aAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF91bmNvcmUuaApAQCAtMzksNiArMzks
OCBAQCBzdHJ1Y3QgaW50ZWxfdW5jb3JlOwogc3RydWN0IGludGVsX3VuY29yZV9tbWlvX2RlYnVn
IHsKIAlzcGlubG9ja190IGxvY2s7IC8qKiBsb2NrIGlzIGFsc28gdGFrZW4gaW4gaXJxIGNvbnRl
eHRzLiAqLwogCWludCB1bmNsYWltZWRfbW1pb19jaGVjazsKKwlpbnQgc2F2ZWRfbW1pb19jaGVj
azsKKwl1MzIgc3VzcGVuZF9jb3VudDsKIH07CiAKIGVudW0gZm9yY2V3YWtlX2RvbWFpbl9pZCB7
CkBAIC0xNDEsMTIgKzE0Myw3IEBAIHN0cnVjdCBpbnRlbF91bmNvcmUgewogCQl1MzIgX19pb21l
bSAqcmVnX2FjazsKIAl9ICpmd19kb21haW5bRldfRE9NQUlOX0lEX0NPVU5UXTsKIAotCXN0cnVj
dCB7Ci0JCXVuc2lnbmVkIGludCBjb3VudDsKLQotCQlpbnQgc2F2ZWRfbW1pb19jaGVjazsKLQkJ
aW50IHNhdmVkX21taW9fZGVidWc7Ci0JfSB1c2VyX2ZvcmNld2FrZTsKKwl1bnNpZ25lZCBpbnQg
dXNlcl9mb3JjZXdha2VfY291bnQ7CiAKIAlzdHJ1Y3QgaW50ZWxfdW5jb3JlX21taW9fZGVidWcg
KmRlYnVnOwogfTsKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGlu
Zm8vaW50ZWwtZ2Z4

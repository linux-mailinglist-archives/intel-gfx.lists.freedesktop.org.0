Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 87BBABDADE
	for <lists+intel-gfx@lfdr.de>; Wed, 25 Sep 2019 11:23:53 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D2D3A6EB56;
	Wed, 25 Sep 2019 09:23:51 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 657496EB51;
 Wed, 25 Sep 2019 09:23:49 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18608871-1500050 
 for multiple; Wed, 25 Sep 2019 10:23:33 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 25 Sep 2019 10:23:28 +0100
Message-Id: <20190925092328.30236-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190924220137.20627-1-chris@chris-wilson.co.uk>
References: <20190924220137.20627-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t v2] i915/perf_pmu: Compare semaphore and
 busy measurements
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

T3VyIHNlbWFwaG9yZSB0aW1lIGlzIG1lYXN1cmVkIGJ5IHNhbXBsaW5nIGEgcmluZyByZWdpc3Rl
ciwgd2hlcmVhcyBvdXIKYnVzeSB0aW1lIGlzIG1lYXN1cmVkIGV4YWN0bHkuIFRoaXMgbGVhdmVz
IGEgd2luZG93IG9mIGRpc2NyZXBhbmN5IHRoYXQKd2Ugd2lzaCB0byBrZWVwIHNtYWxsIChhdCBs
ZWFzdCB3aXRoaW4gc2FtcGxlIHRvbGVyYW5jZSkuCgp2MjogRXhwbGFpbiB0aGUgc2VtYSA8PSBi
dXN5IGFzc2VydCwgYW5kIGxvdHMgb2Ygb3RoZXIgVHZydGtvIHR3ZWFrcwoKUmVmZXJlbmNlczog
aHR0cHM6Ly9idWdzLmZyZWVkZXNrdG9wLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTExNzg4ClNpZ25l
ZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogVHZy
dGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KLS0tCiB0ZXN0cy9wZXJmX3Bt
dS5jIHwgOTMgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKyst
CiAxIGZpbGUgY2hhbmdlZCwgOTIgaW5zZXJ0aW9ucygrKSwgMSBkZWxldGlvbigtKQoKZGlmZiAt
LWdpdCBhL3Rlc3RzL3BlcmZfcG11LmMgYi90ZXN0cy9wZXJmX3BtdS5jCmluZGV4IDhhMDZlNWQ0
NC4uMmFlZDMzODFmIDEwMDY0NAotLS0gYS90ZXN0cy9wZXJmX3BtdS5jCisrKyBiL3Rlc3RzL3Bl
cmZfcG11LmMKQEAgLTEzMCw3ICsxMzAsNyBAQCBzdGF0aWMgdWludDY0X3QgcG11X3JlYWRfbXVs
dGkoaW50IGZkLCB1bnNpZ25lZCBpbnQgbnVtLCB1aW50NjRfdCAqdmFsKQogI2RlZmluZSBfX2Fz
c2VydF93aXRoaW5fZXBzaWxvbih4LCByZWYsIHRvbF91cCwgdG9sX2Rvd24pIFwKIAlpZ3RfYXNz
ZXJ0X2YoKGRvdWJsZSkoeCkgPD0gKDEuMCArICh0b2xfdXApKSAqIChkb3VibGUpKHJlZikgJiYg
XAogCQkgICAgIChkb3VibGUpKHgpID49ICgxLjAgLSAodG9sX2Rvd24pKSAqIChkb3VibGUpKHJl
ZiksIFwKLQkJICAgICAiJyVzJyAhPSAnJXMnICglZiBub3Qgd2l0aGluICslZiUlLy0lZiUlIHRv
bGVyYW5jZSBvZiAlZilcbiIsXAorCQkgICAgICInJXMnICE9ICclcycgKCVmIG5vdCB3aXRoaW4g
KyUuMWYlJS8tJS4xZiUlIHRvbGVyYW5jZSBvZiAlZilcbiIsXAogCQkgICAgICN4LCAjcmVmLCAo
ZG91YmxlKSh4KSwgXAogCQkgICAgICh0b2xfdXApICogMTAwLjAsICh0b2xfZG93bikgKiAxMDAu
MCwgXAogCQkgICAgIChkb3VibGUpKHJlZikpCkBAIC03NDQsNiArNzQ0LDk0IEBAIHNlbWFfd2Fp
dChpbnQgZ2VtX2ZkLCBjb25zdCBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2VuZ2luZTIgKmUsCiAJ
YXNzZXJ0X3dpdGhpbl9lcHNpbG9uKHZhbFsxXSAtIHZhbFswXSwgc2xlcHQsIHRvbGVyYW5jZSk7
CiB9CiAKK3N0YXRpYyB2b2lkCitfX3NlbWFfYnVzeShpbnQgZ2VtX2ZkLCBpbnQgcG11LAorCSAg
ICBjb25zdCBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2VuZ2luZTIgKmUsCisJICAgIGNvbnN0IHN0
cnVjdCBpbnRlbF9leGVjdXRpb25fZW5naW5lMiAqc2lnbmFsLAorCSAgICBpbnQgc2VtYV9wY3Qs
CisJICAgIGludCBidXN5X3BjdCkKK3sKKwllbnVtIHsKKwkJU0VNQSA9IDAsCisJCUJVU1ksCisJ
fTsKKwl1aW50NjRfdCB0b3RhbCwgc2VtYSwgYnVzeTsKKwl1aW50NjRfdCBzdGFydFsyXSwgdmFs
WzJdOworCWlndF9zcGluX3QgKnNwaW5bMl07CisKKwkvKiBUaW1lIHNwZW50IGJlaW5nIGJ1c3kg
aW5jbHVkZXMgdGltZSB3YWl0aW5nIG9uIHNlbWFwaG9yZXMgKi8KKwlpZ3RfYXNzZXJ0KGJ1c3lf
cGN0ID49IHNlbWFfcGN0KTsKKworCWdlbV9xdWllc2NlbnRfZ3B1KGdlbV9mZCk7CisKKwlzcGlu
WzBdID0gaWd0X3NwaW5fbmV3KGdlbV9mZCwKKwkJCSAgICAgICAuZW5naW5lID0gc2lnbmFsLT5m
bGFncywKKwkJCSAgICAgICAuZmxhZ3MgPSBJR1RfU1BJTl9GRU5DRV9PVVQgfCBJR1RfU1BJTl9Q
T0xMX1JVTik7CisJc3BpblsxXSA9IGlndF9zcGluX25ldyhnZW1fZmQsCisJCQkgICAgICAgLmVu
Z2luZSA9IGUtPmZsYWdzLAorCQkJICAgICAgIC5mZW5jZSA9IHNwaW5bMF0tPm91dF9mZW5jZSwK
KwkJCSAgICAgICAuZmxhZ3MgPSBJR1RfU1BJTl9GRU5DRV9JTik7CisKKwlpZ3Rfc3Bpbl9idXN5
d2FpdF91bnRpbF9zdGFydGVkKHNwaW5bMF0pOworCisJdG90YWwgPSBwbXVfcmVhZF9tdWx0aShw
bXUsIDIsIHN0YXJ0KTsKKworCXNlbWEgPSBtZWFzdXJlZF91c2xlZXAoYmF0Y2hfZHVyYXRpb25f
bnMgKiBzZW1hX3BjdCAvIDEwMCAvIDEwMDApOworCWlndF9zcGluX2VuZChzcGluWzBdKTsKKwli
dXN5ID0gbWVhc3VyZWRfdXNsZWVwKGJhdGNoX2R1cmF0aW9uX25zICogKGJ1c3lfcGN0IC0gc2Vt
YV9wY3QpIC8gMTAwIC8gMTAwMCk7CisJaWd0X3NwaW5fZW5kKHNwaW5bMV0pOworCW1lYXN1cmVk
X3VzbGVlcChiYXRjaF9kdXJhdGlvbl9ucyAqICgxMDAgLSBidXN5X3BjdCkgLyAxMDAgLyAxMDAw
KTsKKworCXRvdGFsID0gcG11X3JlYWRfbXVsdGkocG11LCAyLCB2YWwpIC0gdG90YWw7CisKKwli
dXN5ICs9IHNlbWE7CisJdmFsW1NFTUFdIC09IHN0YXJ0W1NFTUFdOworCXZhbFtCVVNZXSAtPSBz
dGFydFtCVVNZXTsKKworCWlndF9pbmZvKCIlczwtJXMsIHRhcmdldDogeyUuMWYlJSBbJWRdLCAl
LjFmJSUgWyVkXX0sIG1lYXN1cmVkOiB7JS4xZiUlLCAlLjFmJSV9XG4iLAorCQkgZS0+bmFtZSwg
c2lnbmFsLT5uYW1lLAorCQkgc2VtYSAqIDEwMC4gLyB0b3RhbCwgc2VtYV9wY3QsCisJCSBidXN5
ICogMTAwLiAvIHRvdGFsLCBidXN5X3BjdCwKKwkJIHZhbFtTRU1BXSAqIDEwMC4gLyB0b3RhbCwK
KwkJIHZhbFtCVVNZXSAqIDEwMC4gLyB0b3RhbCk7CisKKwlhc3NlcnRfd2l0aGluX2Vwc2lsb24o
dmFsW1NFTUFdLCBzZW1hLCB0b2xlcmFuY2UpOworCWFzc2VydF93aXRoaW5fZXBzaWxvbih2YWxb
QlVTWV0sIGJ1c3ksIHRvbGVyYW5jZSk7CisJaWd0X2Fzc2VydF9mKHZhbFtTRU1BXSA8IHZhbFtC
VVNZXSAqICgxICsgdG9sZXJhbmNlKSwKKwkJICAgICAiU2VtYXBob3JlIHRpbWUgKCUuM2Z1cywg
JTEuZiUlKSBncmVhdGVyIHRoYW4gdG90YWwgdGltZSBidXN5ICglLjNmdXMsICUxLmYlJSkhXG4i
LAorCQkgICAgIHZhbFtTRU1BXSAqIDFlLTMsIHZhbFtTRU1BXSAqIDEwMC4gLyB0b3RhbCwKKwkJ
ICAgICB2YWxbQlVTWV0gKiAxZS0zLCB2YWxbQlVTWV0gKiAxMDAuIC8gdG90YWwpOworCisJaWd0
X3NwaW5fZnJlZShnZW1fZmQsIHNwaW5bMV0pOworCWlndF9zcGluX2ZyZWUoZ2VtX2ZkLCBzcGlu
WzBdKTsKK30KKworc3RhdGljIHZvaWQKK3NlbWFfYnVzeShpbnQgZ2VtX2ZkLAorCSAgY29uc3Qg
c3RydWN0IGludGVsX2V4ZWN1dGlvbl9lbmdpbmUyICplLAorCSAgdW5zaWduZWQgaW50IGZsYWdz
KQoreworCWNvbnN0IHN0cnVjdCBpbnRlbF9leGVjdXRpb25fZW5naW5lMiAqc2lnbmFsOworCWlu
dCBmZDsKKworCWlndF9yZXF1aXJlKGdlbV9zY2hlZHVsZXJfaGFzX3NlbWFwaG9yZXMoZ2VtX2Zk
KSk7CisKKwlmZCA9IG9wZW5fZ3JvdXAoSTkxNV9QTVVfRU5HSU5FX1NFTUEoZS0+Y2xhc3MsIGUt
Pmluc3RhbmNlKSwgLTEpOworCW9wZW5fZ3JvdXAoSTkxNV9QTVVfRU5HSU5FX0JVU1koZS0+Y2xh
c3MsIGUtPmluc3RhbmNlKSwgZmQpOworCisJX19mb3JfZWFjaF9waHlzaWNhbF9lbmdpbmUoZ2Vt
X2ZkLCBzaWduYWwpIHsKKwkJaWYgKGUtPmNsYXNzID09IHNpZ25hbC0+Y2xhc3MgJiYKKwkJICAg
IGUtPmluc3RhbmNlID09IHNpZ25hbC0+aW5zdGFuY2UpCisJCQljb250aW51ZTsKKworCQlfX3Nl
bWFfYnVzeShnZW1fZmQsIGZkLCBlLCBzaWduYWwsIDUwLCAxMDApOworCQlfX3NlbWFfYnVzeShn
ZW1fZmQsIGZkLCBlLCBzaWduYWwsIDI1LCA1MCk7CisJCV9fc2VtYV9idXN5KGdlbV9mZCwgZmQs
IGUsIHNpZ25hbCwgNzUsIDc1KTsKKwl9CisKKwljbG9zZShmZCk7Cit9CisKICNkZWZpbmUgICBN
SV9XQUlUX0ZPUl9QSVBFX0NfVkJMQU5LICgxPDwyMSkKICNkZWZpbmUgICBNSV9XQUlUX0ZPUl9Q
SVBFX0JfVkJMQU5LICgxPDwxMSkKICNkZWZpbmUgICBNSV9XQUlUX0ZPUl9QSVBFX0FfVkJMQU5L
ICgxPDwzKQpAQCAtMTc3NCw2ICsxODYyLDkgQEAgaWd0X21haW4KIAkJCXNlbWFfd2FpdChmZCwg
ZSwKIAkJCQkgIFRFU1RfQlVTWSB8IFRFU1RfVFJBSUxJTkdfSURMRSk7CiAKKwkJaWd0X3N1YnRl
c3RfZigic2VtYXBob3JlLWJ1c3ktJXMiLCBlLT5uYW1lKQorCQkJc2VtYV9idXN5KGZkLCBlLCAw
KTsKKwogCQkvKioKIAkJICogQ2hlY2sgdGhhdCB0d28gcGVyZiBjbGllbnRzIGRvIG5vdCBpbmZs
dWVuY2UgZWFjaAogCQkgKiBvdGhlcnMgb2JzZXJ2YXRpb25zLgotLSAKMi4yMy4wCgpfX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGlu
ZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVl
ZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

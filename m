Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id C32B210F1A3
	for <lists+intel-gfx@lfdr.de>; Mon,  2 Dec 2019 21:43:33 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D9FCF89DC1;
	Mon,  2 Dec 2019 20:43:31 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AF0DE89DC1
 for <intel-gfx@lists.freedesktop.org>; Mon,  2 Dec 2019 20:43:29 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19434099-1500050 
 for multiple; Mon, 02 Dec 2019 20:43:16 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  2 Dec 2019 20:43:14 +0000
Message-Id: <20191202204316.2665847-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 1/3] drm/i915: Lift i915_vma_pin() out of
 intel_renderstate_emit()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

T25jZSBpbnNpZGUgYSByZXF1ZXN0LCBpbnNpZGUgdGhlIHRpbWVsaW5lLT5tdXRleCwgcGlubmlu
ZyBpcyB2ZXJib3Rlbi4KCjw0PiBbODk2LjAzMjgyOV0gPT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Cjw0PiBbODk2LjAzMjgzMV0gV0FSTklORzog
cG9zc2libGUgY2lyY3VsYXIgbG9ja2luZyBkZXBlbmRlbmN5IGRldGVjdGVkCjw0PiBbODk2LjAz
MjgzNV0gNS40LjAtcmM4LUNJLVBhdGNod29ya18xNTUzMysgIzEgVGFpbnRlZDogRyAgICAgVQo8
ND4gWzg5Ni4wMzI4MzhdIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLQo8ND4gWzg5Ni4wMzI4NDFdIGdlbV9leGVjX3BhcmFsbC8zNzIwIGlzIHRy
eWluZyB0byBhY3F1aXJlIGxvY2s6Cjw0PiBbODk2LjAzMjg0NF0gZmZmZjg4ODQwMTg2MzI3MCAo
Jmtlcm5lbCMyKXsrLisufSwgYXQ6IGk5MTVfcmVxdWVzdF9jcmVhdGUrMHgxNi8weDFjMCBbaTkx
NV0KPDQ+IFs4OTYuMDMyOTE1XQpidXQgdGFzayBpcyBhbHJlYWR5IGhvbGRpbmcgbG9jazoKPDQ+
IFs4OTYuMDMyOTE3XSBmZmZmODg4M2VjMWM5M2MwICgmdm0tPm11dGV4KXsrLisufSwgYXQ6IGk5
MTVfdm1hX3BpbisweGYzLzB4MTFjMCBbaTkxNV0KPDQ+IFs4OTYuMDMyOTUyXQp3aGljaCBsb2Nr
IGFscmVhZHkgZGVwZW5kcyBvbiB0aGUgbmV3IGxvY2suCgo8ND4gWzg5Ni4wMzI5NTRdCnRoZSBl
eGlzdGluZyBkZXBlbmRlbmN5IGNoYWluIChpbiByZXZlcnNlIG9yZGVyKSBpczoKPDQ+IFs4OTYu
MDMyOTU2XQotPiAjMSAoJnZtLT5tdXRleCl7Ky4rLn06Cjw0PiBbODk2LjAzMjk2MV0gICAgICAg
IF9fbXV0ZXhfbG9jaysweDlhLzB4OWQwCjw0PiBbODk2LjAzMjk5NV0gICAgICAgIGk5MTVfdm1h
X3BpbisweGYzLzB4MTFjMCBbaTkxNV0KPDQ+IFs4OTYuMDMzMDMzXSAgICAgICAgaW50ZWxfcmVu
ZGVyc3RhdGVfZW1pdCsweGI5LzB4OWUwIFtpOTE1XQo8ND4gWzg5Ni4wMzMwODFdICAgICAgICBp
OTE1X2dlbV9pbml0KzB4NWE5LzB4YTUwIFtpOTE1XQo8ND4gWzg5Ni4wMzMxMTJdICAgICAgICBp
OTE1X2RyaXZlcl9wcm9iZSsweGIwMC8weDE1ZjAgW2k5MTVdCjw0PiBbODk2LjAzMzE0NF0gICAg
ICAgIGk5MTVfcGNpX3Byb2JlKzB4NDMvMHgxYzAgW2k5MTVdCjw0PiBbODk2LjAzMzE0OV0gICAg
ICAgIHBjaV9kZXZpY2VfcHJvYmUrMHg5ZS8weDEyMAo8ND4gWzg5Ni4wMzMxNTRdICAgICAgICBy
ZWFsbHlfcHJvYmUrMHhlYS8weDQyMAo8ND4gWzg5Ni4wMzMxNThdICAgICAgICBkcml2ZXJfcHJv
YmVfZGV2aWNlKzB4MTBiLzB4MTIwCjw0PiBbODk2LjAzMzE2MV0gICAgICAgIGRldmljZV9kcml2
ZXJfYXR0YWNoKzB4NGEvMHg1MAo8ND4gWzg5Ni4wMzMxNjRdICAgICAgICBfX2RyaXZlcl9hdHRh
Y2grMHg5Ny8weDEzMAo8ND4gWzg5Ni4wMzMxNjhdICAgICAgICBidXNfZm9yX2VhY2hfZGV2KzB4
NzQvMHhjMAo8ND4gWzg5Ni4wMzMxNzFdICAgICAgICBidXNfYWRkX2RyaXZlcisweDE0Mi8weDIy
MAo8ND4gWzg5Ni4wMzMxNzRdICAgICAgICBkcml2ZXJfcmVnaXN0ZXIrMHg1Ni8weGYwCjw0PiBb
ODk2LjAzMzE3OF0gICAgICAgIGRvX29uZV9pbml0Y2FsbCsweDU4LzB4MmZmCjw0PiBbODk2LjAz
MzE4M10gICAgICAgIGRvX2luaXRfbW9kdWxlKzB4NTYvMHgxZjgKPDQ+IFs4OTYuMDMzMTg3XSAg
ICAgICAgbG9hZF9tb2R1bGUrMHgyNDNlLzB4MjlmMAo8ND4gWzg5Ni4wMzMxOTBdICAgICAgICBf
X2RvX3N5c19maW5pdF9tb2R1bGUrMHhlOS8weDExMAo8ND4gWzg5Ni4wMzMxOTRdICAgICAgICBk
b19zeXNjYWxsXzY0KzB4NGYvMHgyMTAKPDQ+IFs4OTYuMDMzMTk3XSAgICAgICAgZW50cnlfU1lT
Q0FMTF82NF9hZnRlcl9od2ZyYW1lKzB4NDkvMHhiZQo8ND4gWzg5Ni4wMzMyMDBdCi0+ICMwICgm
a2VybmVsIzIpeysuKy59Ogo8ND4gWzg5Ni4wMzMyMDZdICAgICAgICBfX2xvY2tfYWNxdWlyZSsw
eDEzMjgvMHgxNWQwCjw0PiBbODk2LjAzMzIwOV0gICAgICAgIGxvY2tfYWNxdWlyZSsweGE3LzB4
MWMwCjw0PiBbODk2LjAzMzIxM10gICAgICAgIF9fbXV0ZXhfbG9jaysweDlhLzB4OWQwCjw0PiBb
ODk2LjAzMzI1NV0gICAgICAgIGk5MTVfcmVxdWVzdF9jcmVhdGUrMHgxNi8weDFjMCBbaTkxNV0K
PDQ+IFs4OTYuMDMzMjg3XSAgICAgICAgaW50ZWxfZW5naW5lX2ZsdXNoX2JhcnJpZXJzKzB4NGMv
MHgxMDAgW2k5MTVdCjw0PiBbODk2LjAzMzMyN10gICAgICAgIGdndHRfZmx1c2grMHgzNy8weDYw
IFtpOTE1XQo8ND4gWzg5Ni4wMzMzNjZdICAgICAgICBpOTE1X2dlbV9ldmljdF9zb21ldGhpbmcr
MHg0NmIvMHg1YTAgW2k5MTVdCjw0PiBbODk2LjAzMzQwN10gICAgICAgIGk5MTVfZ2VtX2d0dF9p
bnNlcnQrMHgyMWQvMHg2YTAgW2k5MTVdCjw0PiBbODk2LjAzMzQ0OV0gICAgICAgIGk5MTVfdm1h
X3BpbisweGIzNi8weDExYzAgW2k5MTVdCjw0PiBbODk2LjAzMzQ4OF0gICAgICAgIGdlbjZfcHBn
dHRfcGluKzB4ZDUvMHgxNzAgW2k5MTVdCjw0PiBbODk2LjAzMzUyM10gICAgICAgIHJpbmdfY29u
dGV4dF9waW4rMHgyZS8weGMwIFtpOTE1XQo8ND4gWzg5Ni4wMzM1NTRdICAgICAgICBfX2ludGVs
X2NvbnRleHRfZG9fcGluKzB4NmIvMHgxOTAgW2k5MTVdCjw0PiBbODk2LjAzMzU5MV0gICAgICAg
IGk5MTVfZ2VtX2RvX2V4ZWNidWZmZXIrMHgxODE0LzB4MjZjMCBbaTkxNV0KPDQ+IFs4OTYuMDMz
NjI3XSAgICAgICAgaTkxNV9nZW1fZXhlY2J1ZmZlcjJfaW9jdGwrMHgxMWIvMHg0NjAgW2k5MTVd
Cjw0PiBbODk2LjAzMzYzMl0gICAgICAgIGRybV9pb2N0bF9rZXJuZWwrMHhhNy8weGYwCjw0PiBb
ODk2LjAzMzYzNV0gICAgICAgIGRybV9pb2N0bCsweDJlMS8weDM5MAo8ND4gWzg5Ni4wMzM2Mzhd
ICAgICAgICBkb192ZnNfaW9jdGwrMHhhMC8weDZmMAo8ND4gWzg5Ni4wMzM2NDFdICAgICAgICBr
c3lzX2lvY3RsKzB4MzUvMHg2MAo8ND4gWzg5Ni4wMzM2NDRdICAgICAgICBfX3g2NF9zeXNfaW9j
dGwrMHgxMS8weDIwCjw0PiBbODk2LjAzMzY0N10gICAgICAgIGRvX3N5c2NhbGxfNjQrMHg0Zi8w
eDIxMAo8ND4gWzg5Ni4wMzM2NTBdICAgICAgICBlbnRyeV9TWVNDQUxMXzY0X2FmdGVyX2h3ZnJh
bWUrMHg0OS8weGJlCgpMaWZ0IHRoZSBvYmplY3QgYWxsb2NhdGlvbiBhbmQgcGluIHByaW9yIHRv
IHRoZSByZXF1ZXN0IGNvbnN0cnVjdGlvbi4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8
Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogTWlrYSBLdW9wcGFsYSA8bWlrYS5rdW9wcGFs
YUBsaW51eC5pbnRlbC5jb20+CkNjOiBNYWFydGVuIExhbmtob3JzdCA8bWFhcnRlbi5sYW5raG9y
c3RAbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jl
bmRlcnN0YXRlLmMgfCA5NyArKysrKysrKysrKystLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX3JlbmRlcnN0YXRlLmggfCAxNyArKystCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbS5jICAgICAgICAgICAgIHwgIDggKy0KIDMgZmlsZXMgY2hhbmdlZCwgNzggaW5z
ZXJ0aW9ucygrKSwgNDQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfcmVuZGVyc3RhdGUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX3JlbmRlcnN0YXRlLmMKaW5kZXggYzRlZGMzNWU3ZDg5Li41OTU0ZWNjMzIwN2YgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JlbmRlcnN0YXRlLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVuZGVyc3RhdGUuYwpAQCAtMjksMTYgKzI5
LDYgQEAKICNpbmNsdWRlICJpbnRlbF9yZW5kZXJzdGF0ZS5oIgogI2luY2x1ZGUgImludGVsX3Jp
bmcuaCIKIAotc3RydWN0IGludGVsX3JlbmRlcnN0YXRlIHsKLQljb25zdCBzdHJ1Y3QgaW50ZWxf
cmVuZGVyc3RhdGVfcm9kYXRhICpyb2RhdGE7Ci0Jc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iajsKLQlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKLQl1MzIgYmF0Y2hfb2Zmc2V0OwotCXUzMiBi
YXRjaF9zaXplOwotCXUzMiBhdXhfb2Zmc2V0OwotCXUzMiBhdXhfc2l6ZTsKLX07Ci0KIHN0YXRp
YyBjb25zdCBzdHJ1Y3QgaW50ZWxfcmVuZGVyc3RhdGVfcm9kYXRhICoKIHJlbmRlcl9zdGF0ZV9n
ZXRfcm9kYXRhKGNvbnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIHsKQEAgLTg0
LDExICs3NCwxMSBAQCBzdGF0aWMgaW50IHJlbmRlcl9zdGF0ZV9zZXR1cChzdHJ1Y3QgaW50ZWxf
cmVuZGVyc3RhdGUgKnNvLAogCXUzMiAqZDsKIAlpbnQgcmV0OwogCi0JcmV0ID0gaTkxNV9nZW1f
b2JqZWN0X3ByZXBhcmVfd3JpdGUoc28tPm9iaiwgJm5lZWRzX2NsZmx1c2gpOworCXJldCA9IGk5
MTVfZ2VtX29iamVjdF9wcmVwYXJlX3dyaXRlKHNvLT52bWEtPm9iaiwgJm5lZWRzX2NsZmx1c2gp
OwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlkID0ga21hcF9hdG9taWMoaTkxNV9nZW1f
b2JqZWN0X2dldF9kaXJ0eV9wYWdlKHNvLT5vYmosIDApKTsKKwlkID0ga21hcF9hdG9taWMoaTkx
NV9nZW1fb2JqZWN0X2dldF9kaXJ0eV9wYWdlKHNvLT52bWEtPm9iaiwgMCkpOwogCiAJd2hpbGUg
KGkgPCByb2RhdGEtPmJhdGNoX2l0ZW1zKSB7CiAJCXUzMiBzID0gcm9kYXRhLT5iYXRjaFtpXTsK
QEAgLTE2Niw3ICsxNTYsNyBAQCBzdGF0aWMgaW50IHJlbmRlcl9zdGF0ZV9zZXR1cChzdHJ1Y3Qg
aW50ZWxfcmVuZGVyc3RhdGUgKnNvLAogCiAJcmV0ID0gMDsKIG91dDoKLQlpOTE1X2dlbV9vYmpl
Y3RfZmluaXNoX2FjY2Vzcyhzby0+b2JqKTsKKwlpOTE1X2dlbV9vYmplY3RfZmluaXNoX2FjY2Vz
cyhzby0+dm1hLT5vYmopOwogCXJldHVybiByZXQ7CiAKIGVycjoKQEAgLTE3Nyw2MSArMTY3LDg0
IEBAIHN0YXRpYyBpbnQgcmVuZGVyX3N0YXRlX3NldHVwKHN0cnVjdCBpbnRlbF9yZW5kZXJzdGF0
ZSAqc28sCiAKICN1bmRlZiBPVVRfQkFUQ0gKIAotaW50IGludGVsX3JlbmRlcnN0YXRlX2VtaXQo
c3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCitpbnQgaW50ZWxfcmVuZGVyc3RhdGVfaW5pdChzdHJ1
Y3QgaW50ZWxfcmVuZGVyc3RhdGUgKnNvLAorCQkJICAgc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lKQogewotCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSA9IHJxLT5lbmdpbmU7
Ci0Jc3RydWN0IGludGVsX3JlbmRlcnN0YXRlIHNvID0ge307IC8qIGtlZXAgdGhlIGNvbXBpbGVy
IGhhcHB5ICovCisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKIAlpbnQgZXJyOwog
Ci0Jc28ucm9kYXRhID0gcmVuZGVyX3N0YXRlX2dldF9yb2RhdGEoZW5naW5lKTsKLQlpZiAoIXNv
LnJvZGF0YSkKKwltZW1zZXQoc28sIDAsIHNpemVvZigqc28pKTsKKworCXNvLT5yb2RhdGEgPSBy
ZW5kZXJfc3RhdGVfZ2V0X3JvZGF0YShlbmdpbmUpOworCWlmICghc28tPnJvZGF0YSkKIAkJcmV0
dXJuIDA7CiAKLQlpZiAoc28ucm9kYXRhLT5iYXRjaF9pdGVtcyAqIDQgPiBQQUdFX1NJWkUpCisJ
aWYgKHNvLT5yb2RhdGEtPmJhdGNoX2l0ZW1zICogNCA+IFBBR0VfU0laRSkKIAkJcmV0dXJuIC1F
SU5WQUw7CiAKLQlzby5vYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGVuZ2lu
ZS0+aTkxNSwgUEFHRV9TSVpFKTsKLQlpZiAoSVNfRVJSKHNvLm9iaikpCi0JCXJldHVybiBQVFJf
RVJSKHNvLm9iaik7CisJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChlbmdp
bmUtPmk5MTUsIFBBR0VfU0laRSk7CisJaWYgKElTX0VSUihvYmopKQorCQlyZXR1cm4gUFRSX0VS
UihvYmopOwogCi0Jc28udm1hID0gaTkxNV92bWFfaW5zdGFuY2Uoc28ub2JqLCAmZW5naW5lLT5n
dC0+Z2d0dC0+dm0sIE5VTEwpOwotCWlmIChJU19FUlIoc28udm1hKSkgewotCQllcnIgPSBQVFJf
RVJSKHNvLnZtYSk7CisJc28tPnZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgJmVuZ2luZS0+
Z3QtPmdndHQtPnZtLCBOVUxMKTsKKwlpZiAoSVNfRVJSKHNvLT52bWEpKSB7CisJCWVyciA9IFBU
Ul9FUlIoc28tPnZtYSk7CiAJCWdvdG8gZXJyX29iajsKIAl9CiAKLQllcnIgPSBpOTE1X3ZtYV9w
aW4oc28udm1hLCAwLCAwLCBQSU5fR0xPQkFMIHwgUElOX0hJR0gpOworCWVyciA9IGk5MTVfdm1h
X3Bpbihzby0+dm1hLCAwLCAwLCBQSU5fR0xPQkFMIHwgUElOX0hJR0gpOwogCWlmIChlcnIpCiAJ
CWdvdG8gZXJyX3ZtYTsKIAotCWVyciA9IHJlbmRlcl9zdGF0ZV9zZXR1cCgmc28sIHJxLT5pOTE1
KTsKKwllcnIgPSByZW5kZXJfc3RhdGVfc2V0dXAoc28sIGVuZ2luZS0+aTkxNSk7CiAJaWYgKGVy
cikKIAkJZ290byBlcnJfdW5waW47CiAKKwlyZXR1cm4gMDsKKworZXJyX3VucGluOgorCWk5MTVf
dm1hX3VucGluKHNvLT52bWEpOworZXJyX3ZtYToKKwlpOTE1X3ZtYV9jbG9zZShzby0+dm1hKTsK
K2Vycl9vYmo6CisJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCXNvLT52bWEgPSBOVUxMOwor
CXJldHVybiBlcnI7Cit9CisKK2ludCBpbnRlbF9yZW5kZXJzdGF0ZV9lbWl0KHN0cnVjdCBpbnRl
bF9yZW5kZXJzdGF0ZSAqc28sCisJCQkgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKK3sKKwlz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUgPSBycS0+ZW5naW5lOworCWludCBlcnI7CisK
KwlpZiAoIXNvLT52bWEpCisJCXJldHVybiAwOworCiAJZXJyID0gZW5naW5lLT5lbWl0X2JiX3N0
YXJ0KHJxLAotCQkJCSAgICBzby5iYXRjaF9vZmZzZXQsIHNvLmJhdGNoX3NpemUsCisJCQkJICAg
IHNvLT5iYXRjaF9vZmZzZXQsIHNvLT5iYXRjaF9zaXplLAogCQkJCSAgICBJOTE1X0RJU1BBVENI
X1NFQ1VSRSk7CiAJaWYgKGVycikKLQkJZ290byBlcnJfdW5waW47CisJCXJldHVybiBlcnI7CiAK
LQlpZiAoc28uYXV4X3NpemUgPiA4KSB7CisJaWYgKHNvLT5hdXhfc2l6ZSA+IDgpIHsKIAkJZXJy
ID0gZW5naW5lLT5lbWl0X2JiX3N0YXJ0KHJxLAotCQkJCQkgICAgc28uYXV4X29mZnNldCwgc28u
YXV4X3NpemUsCisJCQkJCSAgICBzby0+YXV4X29mZnNldCwgc28tPmF1eF9zaXplLAogCQkJCQkg
ICAgSTkxNV9ESVNQQVRDSF9TRUNVUkUpOwogCQlpZiAoZXJyKQotCQkJZ290byBlcnJfdW5waW47
CisJCQlyZXR1cm4gZXJyOwogCX0KIAotCWk5MTVfdm1hX2xvY2soc28udm1hKTsKLQllcnIgPSBp
OTE1X3JlcXVlc3RfYXdhaXRfb2JqZWN0KHJxLCBzby52bWEtPm9iaiwgZmFsc2UpOworCWk5MTVf
dm1hX2xvY2soc28tPnZtYSk7CisJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X29iamVjdChycSwg
c28tPnZtYS0+b2JqLCBmYWxzZSk7CiAJaWYgKGVyciA9PSAwKQotCQllcnIgPSBpOTE1X3ZtYV9t
b3ZlX3RvX2FjdGl2ZShzby52bWEsIHJxLCAwKTsKLQlpOTE1X3ZtYV91bmxvY2soc28udm1hKTsK
LWVycl91bnBpbjoKLQlpOTE1X3ZtYV91bnBpbihzby52bWEpOwotZXJyX3ZtYToKLQlpOTE1X3Zt
YV9jbG9zZShzby52bWEpOwotZXJyX29iajoKLQlpOTE1X2dlbV9vYmplY3RfcHV0KHNvLm9iaik7
CisJCWVyciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZlKHNvLT52bWEsIHJxLCAwKTsKKwlpOTE1
X3ZtYV91bmxvY2soc28tPnZtYSk7CisKIAlyZXR1cm4gZXJyOwogfQorCit2b2lkIGludGVsX3Jl
bmRlcnN0YXRlX2Zpbmkoc3RydWN0IGludGVsX3JlbmRlcnN0YXRlICpzbykKK3sKKwlpOTE1X3Zt
YV91bnBpbl9hbmRfcmVsZWFzZSgmc28tPnZtYSwgMCk7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZW5kZXJzdGF0ZS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfcmVuZGVyc3RhdGUuaAppbmRleCA4ZDUwNzkxNDUwNTQuLjU3MDBiZTY5YTA1
YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVuZGVyc3RhdGUu
aAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZW5kZXJzdGF0ZS5oCkBAIC0y
Nyw2ICsyNyw4IEBACiAjaW5jbHVkZSA8bGludXgvdHlwZXMuaD4KIAogc3RydWN0IGk5MTVfcmVx
dWVzdDsKK3N0cnVjdCBpbnRlbF9lbmdpbmVfY3M7CitzdHJ1Y3QgaTkxNV92bWE7CiAKIHN0cnVj
dCBpbnRlbF9yZW5kZXJzdGF0ZV9yb2RhdGEgewogCWNvbnN0IHUzMiAqcmVsb2M7CkBAIC00Niw2
ICs0OCwxOSBAQCBleHRlcm4gY29uc3Qgc3RydWN0IGludGVsX3JlbmRlcnN0YXRlX3JvZGF0YSBn
ZW43X251bGxfc3RhdGU7CiBleHRlcm4gY29uc3Qgc3RydWN0IGludGVsX3JlbmRlcnN0YXRlX3Jv
ZGF0YSBnZW44X251bGxfc3RhdGU7CiBleHRlcm4gY29uc3Qgc3RydWN0IGludGVsX3JlbmRlcnN0
YXRlX3JvZGF0YSBnZW45X251bGxfc3RhdGU7CiAKLWludCBpbnRlbF9yZW5kZXJzdGF0ZV9lbWl0
KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKTsKK3N0cnVjdCBpbnRlbF9yZW5kZXJzdGF0ZSB7CisJ
Y29uc3Qgc3RydWN0IGludGVsX3JlbmRlcnN0YXRlX3JvZGF0YSAqcm9kYXRhOworCXN0cnVjdCBp
OTE1X3ZtYSAqdm1hOworCXUzMiBiYXRjaF9vZmZzZXQ7CisJdTMyIGJhdGNoX3NpemU7CisJdTMy
IGF1eF9vZmZzZXQ7CisJdTMyIGF1eF9zaXplOworfTsKKworaW50IGludGVsX3JlbmRlcnN0YXRl
X2luaXQoc3RydWN0IGludGVsX3JlbmRlcnN0YXRlICpzbywKKwkJCSAgIHN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZSk7CitpbnQgaW50ZWxfcmVuZGVyc3RhdGVfZW1pdChzdHJ1Y3QgaW50
ZWxfcmVuZGVyc3RhdGUgKnNvLAorCQkJICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpOwordm9p
ZCBpbnRlbF9yZW5kZXJzdGF0ZV9maW5pKHN0cnVjdCBpbnRlbF9yZW5kZXJzdGF0ZSAqc28pOwog
CiAjZW5kaWYgLyogX0lOVEVMX1JFTkRFUlNUQVRFX0hfICovCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0u
YwppbmRleCA2MTM5NWIwMzQ0M2UuLmQyYzJkNjZiYjVmMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dl
bS5jCkBAIC0xMDcxLDkgKzEwNzEsMTQgQEAgc3RhdGljIGludCBfX2ludGVsX2VuZ2luZXNfcmVj
b3JkX2RlZmF1bHRzKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAJICovCiAKIAlmb3JfZWFjaF9lbmdp
bmUoZW5naW5lLCBndCwgaWQpIHsKKwkJc3RydWN0IGludGVsX3JlbmRlcnN0YXRlIHNvOwogCQlz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwogCisJ
CWVyciA9IGludGVsX3JlbmRlcnN0YXRlX2luaXQoJnNvLCBlbmdpbmUpOworCQlpZiAoZXJyKQor
CQkJZ290byBvdXQ7CisKIAkJLyogV2UgbXVzdCBiZSBhYmxlIHRvIHN3aXRjaCB0byBzb21ldGhp
bmchICovCiAJCUdFTV9CVUdfT04oIWVuZ2luZS0+a2VybmVsX2NvbnRleHQpOwogCQllbmdpbmUt
PnNlcmlhbCsrOyAvKiBmb3JjZSB0aGUga2VybmVsIGNvbnRleHQgc3dpdGNoICovCkBAIC0xMDk2
LDEzICsxMTAxLDE0IEBAIHN0YXRpYyBpbnQgX19pbnRlbF9lbmdpbmVzX3JlY29yZF9kZWZhdWx0
cyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogCQlpZiAoZXJyKQogCQkJZ290byBlcnJfcnE7CiAKLQkJ
ZXJyID0gaW50ZWxfcmVuZGVyc3RhdGVfZW1pdChycSk7CisJCWVyciA9IGludGVsX3JlbmRlcnN0
YXRlX2VtaXQoJnNvLCBycSk7CiAJCWlmIChlcnIpCiAJCQlnb3RvIGVycl9ycTsKIAogZXJyX3Jx
OgogCQlyZXF1ZXN0c1tpZF0gPSBpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKIAkJaTkxNV9yZXF1ZXN0
X2FkZChycSk7CisJCWludGVsX3JlbmRlcnN0YXRlX2ZpbmkoJnNvKTsKIAkJaWYgKGVycikKIAkJ
CWdvdG8gb3V0OwogCX0KLS0gCjIuMjQuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlz
dGluZm8vaW50ZWwtZ2Z4

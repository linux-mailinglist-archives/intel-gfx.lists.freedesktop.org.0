Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id A914E684F8
	for <lists+intel-gfx@lfdr.de>; Mon, 15 Jul 2019 10:11:58 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8ADF48987C;
	Mon, 15 Jul 2019 08:11:55 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B1B3D8984F
 for <intel-gfx@lists.freedesktop.org>; Mon, 15 Jul 2019 08:11:45 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17303240-1500050 
 for multiple; Mon, 15 Jul 2019 09:09:51 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 15 Jul 2019 09:09:26 +0100
Message-Id: <20190715080946.15593-4-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190715080946.15593-1-chris@chris-wilson.co.uk>
References: <20190715080946.15593-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 04/24] drm/i915/gtt: Tidy up ppgtt insertion for
 gen8
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QXBwbHkgdGhlIG5ldyByYWRpeCBzaGlmdCBoZWxwZXJzIHRvIGV4dHJhY3QgdGhlIG11bHRpLWxl
dmVsIGluZGljZXMKY2xlYW5seSB3aGVuIGluc2VydGluZyBwdGUgaW50byB0aGUgZ3R0IHRyZWUu
CgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4K
LS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYyB8IDExNSArKysrKysrKysr
Ky0tLS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaCB8
ICA5MCArKy0tLS0tLS0tLS0tLS0tLS0tLS0tCiAyIGZpbGVzIGNoYW5nZWQsIDQ4IGluc2VydGlv
bnMoKyksIDE1NyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCmlu
ZGV4IDQ5ZGU2ZDM5NDg4Zi4uMjIwYWJhNWE5NGQyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dl
bV9ndHQuYwpAQCAtMTEzMSw0NyArMTEzMSwyOCBAQCBzdGF0aWMgaW5saW5lIHN0cnVjdCBzZ3Rf
ZG1hIHsKIAlyZXR1cm4gKHN0cnVjdCBzZ3RfZG1hKSB7IHNnLCBhZGRyLCBhZGRyICsgc2ctPmxl
bmd0aCB9OwogfQogCi1zdHJ1Y3QgZ2VuOF9pbnNlcnRfcHRlIHsKLQl1MTYgcG1sNGU7Ci0JdTE2
IHBkcGU7Ci0JdTE2IHBkZTsKLQl1MTYgcHRlOwotfTsKLQotc3RhdGljIF9fYWx3YXlzX2lubGlu
ZSBzdHJ1Y3QgZ2VuOF9pbnNlcnRfcHRlIGdlbjhfaW5zZXJ0X3B0ZSh1NjQgc3RhcnQpCi17Ci0J
cmV0dXJuIChzdHJ1Y3QgZ2VuOF9pbnNlcnRfcHRlKSB7Ci0JCSBnZW44X3BtbDRlX2luZGV4KHN0
YXJ0KSwKLQkJIGdlbjhfcGRwZV9pbmRleChzdGFydCksCi0JCSBnZW44X3BkZV9pbmRleChzdGFy
dCksCi0JCSBnZW44X3B0ZV9pbmRleChzdGFydCksCi0JfTsKLX0KLQotc3RhdGljIF9fYWx3YXlz
X2lubGluZSBib29sCitzdGF0aWMgX19hbHdheXNfaW5saW5lIHU2NAogZ2VuOF9wcGd0dF9pbnNl
cnRfcHRlX2VudHJpZXMoc3RydWN0IGk5MTVfcHBndHQgKnBwZ3R0LAogCQkJICAgICAgc3RydWN0
IGk5MTVfcGFnZV9kaXJlY3RvcnkgKnBkcCwKIAkJCSAgICAgIHN0cnVjdCBzZ3RfZG1hICppdGVy
LAotCQkJICAgICAgc3RydWN0IGdlbjhfaW5zZXJ0X3B0ZSAqaWR4LAorCQkJICAgICAgdTY0IGlk
eCwKIAkJCSAgICAgIGVudW0gaTkxNV9jYWNoZV9sZXZlbCBjYWNoZV9sZXZlbCwKIAkJCSAgICAg
IHUzMiBmbGFncykKIHsKIAlzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVjdG9yeSAqcGQ7CiAJY29uc3Qg
Z2VuOF9wdGVfdCBwdGVfZW5jb2RlID0gZ2VuOF9wdGVfZW5jb2RlKDAsIGNhY2hlX2xldmVsLCBm
bGFncyk7CiAJZ2VuOF9wdGVfdCAqdmFkZHI7Ci0JYm9vbCByZXQ7CiAKLQlHRU1fQlVHX09OKGlk
eC0+cGRwZSA+PSBpOTE1X3BkcGVzX3Blcl9wZHAoJnBwZ3R0LT52bSkpOwotCXBkID0gaTkxNV9w
ZF9lbnRyeShwZHAsIGlkeC0+cGRwZSk7Ci0JdmFkZHIgPSBrbWFwX2F0b21pY19weChpOTE1X3B0
X2VudHJ5KHBkLCBpZHgtPnBkZSkpOworCXBkID0gaTkxNV9wZF9lbnRyeShwZHAsIGdlbjhfcGRf
aW5kZXgoaWR4LCAyKSk7CisJdmFkZHIgPSBrbWFwX2F0b21pY19weChpOTE1X3B0X2VudHJ5KHBk
LCBnZW44X3BkX2luZGV4KGlkeCwgMSkpKTsKIAlkbyB7Ci0JCXZhZGRyW2lkeC0+cHRlXSA9IHB0
ZV9lbmNvZGUgfCBpdGVyLT5kbWE7CisJCXZhZGRyW2dlbjhfcGRfaW5kZXgoaWR4LCAwKV0gPSBw
dGVfZW5jb2RlIHwgaXRlci0+ZG1hOwogCiAJCWl0ZXItPmRtYSArPSBJOTE1X0dUVF9QQUdFX1NJ
WkU7CiAJCWlmIChpdGVyLT5kbWEgPj0gaXRlci0+bWF4KSB7CiAJCQlpdGVyLT5zZyA9IF9fc2df
bmV4dChpdGVyLT5zZyk7CiAJCQlpZiAoIWl0ZXItPnNnKSB7Ci0JCQkJcmV0ID0gZmFsc2U7CisJ
CQkJaWR4ID0gMDsKIAkJCQlicmVhazsKIAkJCX0KIApAQCAtMTE3OSwzMCArMTE2MCwyMiBAQCBn
ZW44X3BwZ3R0X2luc2VydF9wdGVfZW50cmllcyhzdHJ1Y3QgaTkxNV9wcGd0dCAqcHBndHQsCiAJ
CQlpdGVyLT5tYXggPSBpdGVyLT5kbWEgKyBpdGVyLT5zZy0+bGVuZ3RoOwogCQl9CiAKLQkJaWYg
KCsraWR4LT5wdGUgPT0gR0VOOF9QVEVTKSB7Ci0JCQlpZHgtPnB0ZSA9IDA7Ci0KLQkJCWlmICgr
K2lkeC0+cGRlID09IEk5MTVfUERFUykgewotCQkJCWlkeC0+cGRlID0gMDsKLQorCQlpZiAoZ2Vu
OF9wZF9pbmRleCgrK2lkeCwgMCkgPT0gMCkgeworCQkJaWYgKGdlbjhfcGRfaW5kZXgoaWR4LCAx
KSA9PSAwKSB7CiAJCQkJLyogTGltaXRlZCBieSBzZyBsZW5ndGggZm9yIDNsdmwgKi8KLQkJCQlp
ZiAoKytpZHgtPnBkcGUgPT0gR0VOOF9QTUw0RVNfUEVSX1BNTDQpIHsKLQkJCQkJaWR4LT5wZHBl
ID0gMDsKLQkJCQkJcmV0ID0gdHJ1ZTsKKwkJCQlpZiAoZ2VuOF9wZF9pbmRleChpZHgsIDIpID09
IDApCiAJCQkJCWJyZWFrOwotCQkJCX0KIAotCQkJCUdFTV9CVUdfT04oaWR4LT5wZHBlID49IGk5
MTVfcGRwZXNfcGVyX3BkcCgmcHBndHQtPnZtKSk7Ci0JCQkJcGQgPSBwZHAtPmVudHJ5W2lkeC0+
cGRwZV07CisJCQkJcGQgPSBwZHAtPmVudHJ5W2dlbjhfcGRfaW5kZXgoaWR4LCAyKV07CiAJCQl9
CiAKIAkJCWt1bm1hcF9hdG9taWModmFkZHIpOwotCQkJdmFkZHIgPSBrbWFwX2F0b21pY19weChp
OTE1X3B0X2VudHJ5KHBkLCBpZHgtPnBkZSkpOworCQkJdmFkZHIgPSBrbWFwX2F0b21pY19weChp
OTE1X3B0X2VudHJ5KHBkLCBnZW44X3BkX2luZGV4KGlkeCwgMSkpKTsKIAkJfQogCX0gd2hpbGUg
KDEpOwogCWt1bm1hcF9hdG9taWModmFkZHIpOwogCi0JcmV0dXJuIHJldDsKKwlyZXR1cm4gaWR4
OwogfQogCiBzdGF0aWMgdm9pZCBnZW44X3BwZ3R0X2luc2VydF8zbHZsKHN0cnVjdCBpOTE1X2Fk
ZHJlc3Nfc3BhY2UgKnZtLApAQCAtMTIxMiw5ICsxMTg1LDkgQEAgc3RhdGljIHZvaWQgZ2VuOF9w
cGd0dF9pbnNlcnRfM2x2bChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIHsKIAlzdHJ1
Y3QgaTkxNV9wcGd0dCAqcHBndHQgPSBpOTE1X3ZtX3RvX3BwZ3R0KHZtKTsKIAlzdHJ1Y3Qgc2d0
X2RtYSBpdGVyID0gc2d0X2RtYSh2bWEpOwotCXN0cnVjdCBnZW44X2luc2VydF9wdGUgaWR4ID0g
Z2VuOF9pbnNlcnRfcHRlKHZtYS0+bm9kZS5zdGFydCk7CiAKLQlnZW44X3BwZ3R0X2luc2VydF9w
dGVfZW50cmllcyhwcGd0dCwgcHBndHQtPnBkLCAmaXRlciwgJmlkeCwKKwlnZW44X3BwZ3R0X2lu
c2VydF9wdGVfZW50cmllcyhwcGd0dCwgcHBndHQtPnBkLCAmaXRlciwKKwkJCQkgICAgICB2bWEt
Pm5vZGUuc3RhcnQgPj4gR0VOOF9QVEVfU0hJRlQsCiAJCQkJICAgICAgY2FjaGVfbGV2ZWwsIGZs
YWdzKTsKIAogCXZtYS0+cGFnZV9zaXplcy5ndHQgPSBJOTE1X0dUVF9QQUdFX1NJWkU7CkBAIC0x
MjMxLDM5ICsxMjA0LDM4IEBAIHN0YXRpYyB2b2lkIGdlbjhfcHBndHRfaW5zZXJ0X2h1Z2VfZW50
cmllcyhzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAlkbWFfYWRkcl90IHJlbSA9IGl0ZXItPnNnLT5s
ZW5ndGg7CiAKIAlkbyB7Ci0JCXN0cnVjdCBnZW44X2luc2VydF9wdGUgaWR4ID0gZ2VuOF9pbnNl
cnRfcHRlKHN0YXJ0KTsKIAkJc3RydWN0IGk5MTVfcGFnZV9kaXJlY3RvcnkgKnBkcCA9Ci0JCQlp
OTE1X3BkcF9lbnRyeShwbWw0LCBpZHgucG1sNGUpOwotCQlzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVj
dG9yeSAqcGQgPSBpOTE1X3BkX2VudHJ5KHBkcCwgaWR4LnBkcGUpOwotCQl1bnNpZ25lZCBpbnQg
cGFnZV9zaXplOwotCQlib29sIG1heWJlXzY0SyA9IGZhbHNlOworCQkJaTkxNV9wZF9lbnRyeShw
bWw0LCBfX2dlbjhfcHRlX2luZGV4KHN0YXJ0LCAzKSk7CisJCXN0cnVjdCBpOTE1X3BhZ2VfZGly
ZWN0b3J5ICpwZCA9CisJCQlpOTE1X3BkX2VudHJ5KHBkcCwgX19nZW44X3B0ZV9pbmRleChzdGFy
dCwgMikpOwogCQlnZW44X3B0ZV90IGVuY29kZSA9IHB0ZV9lbmNvZGU7CisJCXVuc2lnbmVkIGlu
dCBtYXliZV82NEsgPSAtMTsKKwkJdW5zaWduZWQgaW50IHBhZ2Vfc2l6ZTsKIAkJZ2VuOF9wdGVf
dCAqdmFkZHI7Ci0JCXUxNiBpbmRleCwgbWF4OworCQl1MTYgaW5kZXg7CiAKIAkJaWYgKHZtYS0+
cGFnZV9zaXplcy5zZyAmIEk5MTVfR1RUX1BBR0VfU0laRV8yTSAmJgogCQkgICAgSVNfQUxJR05F
RChpdGVyLT5kbWEsIEk5MTVfR1RUX1BBR0VfU0laRV8yTSkgJiYKLQkJICAgIHJlbSA+PSBJOTE1
X0dUVF9QQUdFX1NJWkVfMk0gJiYgIWlkeC5wdGUpIHsKLQkJCWluZGV4ID0gaWR4LnBkZTsKLQkJ
CW1heCA9IEk5MTVfUERFUzsKLQkJCXBhZ2Vfc2l6ZSA9IEk5MTVfR1RUX1BBR0VfU0laRV8yTTsK
LQorCQkgICAgcmVtID49IEk5MTVfR1RUX1BBR0VfU0laRV8yTSAmJgorCQkgICAgIV9fZ2VuOF9w
dGVfaW5kZXgoc3RhcnQsIDApKSB7CisJCQlpbmRleCA9IF9fZ2VuOF9wdGVfaW5kZXgoc3RhcnQs
IDEpOwogCQkJZW5jb2RlIHw9IEdFTjhfUERFX1BTXzJNOworCQkJcGFnZV9zaXplID0gSTkxNV9H
VFRfUEFHRV9TSVpFXzJNOwogCiAJCQl2YWRkciA9IGttYXBfYXRvbWljX3B4KHBkKTsKIAkJfSBl
bHNlIHsKLQkJCXN0cnVjdCBpOTE1X3BhZ2VfdGFibGUgKnB0ID0gaTkxNV9wdF9lbnRyeShwZCwg
aWR4LnBkZSk7CisJCQlzdHJ1Y3QgaTkxNV9wYWdlX3RhYmxlICpwdCA9CisJCQkJaTkxNV9wdF9l
bnRyeShwZCwgX19nZW44X3B0ZV9pbmRleChzdGFydCwgMSkpOwogCi0JCQlpbmRleCA9IGlkeC5w
dGU7Ci0JCQltYXggPSBHRU44X1BURVM7CisJCQlpbmRleCA9IF9fZ2VuOF9wdGVfaW5kZXgoc3Rh
cnQsIDApOwogCQkJcGFnZV9zaXplID0gSTkxNV9HVFRfUEFHRV9TSVpFOwogCiAJCQlpZiAoIWlu
ZGV4ICYmCiAJCQkgICAgdm1hLT5wYWdlX3NpemVzLnNnICYgSTkxNV9HVFRfUEFHRV9TSVpFXzY0
SyAmJgogCQkJICAgIElTX0FMSUdORUQoaXRlci0+ZG1hLCBJOTE1X0dUVF9QQUdFX1NJWkVfNjRL
KSAmJgogCQkJICAgIChJU19BTElHTkVEKHJlbSwgSTkxNV9HVFRfUEFHRV9TSVpFXzY0SykgfHwK
LQkJCSAgICAgcmVtID49IChtYXggLSBpbmRleCkgKiBJOTE1X0dUVF9QQUdFX1NJWkUpKQotCQkJ
CW1heWJlXzY0SyA9IHRydWU7CisJCQkgICAgIHJlbSA+PSAoSTkxNV9QREVTIC0gaW5kZXgpICog
STkxNV9HVFRfUEFHRV9TSVpFKSkKKwkJCQltYXliZV82NEsgPSBfX2dlbjhfcHRlX2luZGV4KHN0
YXJ0LCAxKTsKIAogCQkJdmFkZHIgPSBrbWFwX2F0b21pY19weChwdCk7CiAJCX0KQEAgLTEyODQs
MTYgKzEyNTYsMTYgQEAgc3RhdGljIHZvaWQgZ2VuOF9wcGd0dF9pbnNlcnRfaHVnZV9lbnRyaWVz
KHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCQkJCWl0ZXItPmRtYSA9IHNnX2RtYV9hZGRyZXNzKGl0
ZXItPnNnKTsKIAkJCQlpdGVyLT5tYXggPSBpdGVyLT5kbWEgKyByZW07CiAKLQkJCQlpZiAobWF5
YmVfNjRLICYmIGluZGV4IDwgbWF4ICYmCisJCQkJaWYgKG1heWJlXzY0SyAhPSAtMSAmJiBpbmRl
eCA8IEk5MTVfUERFUyAmJgogCQkJCSAgICAhKElTX0FMSUdORUQoaXRlci0+ZG1hLCBJOTE1X0dU
VF9QQUdFX1NJWkVfNjRLKSAmJgogCQkJCSAgICAgIChJU19BTElHTkVEKHJlbSwgSTkxNV9HVFRf
UEFHRV9TSVpFXzY0SykgfHwKLQkJCQkgICAgICAgcmVtID49IChtYXggLSBpbmRleCkgKiBJOTE1
X0dUVF9QQUdFX1NJWkUpKSkKLQkJCQkJbWF5YmVfNjRLID0gZmFsc2U7CisJCQkJICAgICAgIHJl
bSA+PSAoSTkxNV9QREVTIC0gaW5kZXgpICogSTkxNV9HVFRfUEFHRV9TSVpFKSkpCisJCQkJCW1h
eWJlXzY0SyA9IC0xOwogCiAJCQkJaWYgKHVubGlrZWx5KCFJU19BTElHTkVEKGl0ZXItPmRtYSwg
cGFnZV9zaXplKSkpCiAJCQkJCWJyZWFrOwogCQkJfQotCQl9IHdoaWxlIChyZW0gPj0gcGFnZV9z
aXplICYmIGluZGV4IDwgbWF4KTsKKwkJfSB3aGlsZSAocmVtID49IHBhZ2Vfc2l6ZSAmJiBpbmRl
eCA8IEk5MTVfUERFUyk7CiAKIAkJa3VubWFwX2F0b21pYyh2YWRkcik7CiAKQEAgLTEzMDMsMTQg
KzEyNzUsMTQgQEAgc3RhdGljIHZvaWQgZ2VuOF9wcGd0dF9pbnNlcnRfaHVnZV9lbnRyaWVzKHN0
cnVjdCBpOTE1X3ZtYSAqdm1hLAogCQkgKiBpdCBhbmQgaGF2ZSByZWFjaGVkIHRoZSBlbmQgb2Yg
dGhlIHNnIHRhYmxlIGFuZCB3ZSBoYXZlCiAJCSAqIGVub3VnaCBwYWRkaW5nLgogCQkgKi8KLQkJ
aWYgKG1heWJlXzY0SyAmJgotCQkgICAgKGluZGV4ID09IG1heCB8fAorCQlpZiAobWF5YmVfNjRL
ICE9IC0xICYmCisJCSAgICAoaW5kZXggPT0gSTkxNV9QREVTIHx8CiAJCSAgICAgKGk5MTVfdm1f
aGFzX3NjcmF0Y2hfNjRLKHZtYS0+dm0pICYmCiAJCSAgICAgICFpdGVyLT5zZyAmJiBJU19BTElH
TkVEKHZtYS0+bm9kZS5zdGFydCArCiAJCQkJCSAgICAgIHZtYS0+bm9kZS5zaXplLAogCQkJCQkg
ICAgICBJOTE1X0dUVF9QQUdFX1NJWkVfMk0pKSkpIHsKIAkJCXZhZGRyID0ga21hcF9hdG9taWNf
cHgocGQpOwotCQkJdmFkZHJbaWR4LnBkZV0gfD0gR0VOOF9QREVfSVBTXzY0SzsKKwkJCXZhZGRy
W21heWJlXzY0S10gfD0gR0VOOF9QREVfSVBTXzY0SzsKIAkJCWt1bm1hcF9hdG9taWModmFkZHIp
OwogCQkJcGFnZV9zaXplID0gSTkxNV9HVFRfUEFHRV9TSVpFXzY0SzsKIApAQCAtMTMyNyw4ICsx
Mjk5LDcgQEAgc3RhdGljIHZvaWQgZ2VuOF9wcGd0dF9pbnNlcnRfaHVnZV9lbnRyaWVzKHN0cnVj
dCBpOTE1X3ZtYSAqdm1hLAogCQkJCXUxNiBpOwogCiAJCQkJZW5jb2RlID0gdm1hLT52bS0+c2Ny
YXRjaFswXS5lbmNvZGU7Ci0JCQkJdmFkZHIgPSBrbWFwX2F0b21pY19weChpOTE1X3B0X2VudHJ5
KHBkLAotCQkJCQkJCQkgICAgIGlkeC5wZGUpKTsKKwkJCQl2YWRkciA9IGttYXBfYXRvbWljX3B4
KGk5MTVfcHRfZW50cnkocGQsIG1heWJlXzY0SykpOwogCiAJCQkJZm9yIChpID0gMTsgaSA8IGlu
ZGV4OyBpICs9IDE2KQogCQkJCQltZW1zZXQ2NCh2YWRkciArIGksIGVuY29kZSwgMTUpOwpAQCAt
MTM1NCwxMyArMTMyNSwxMyBAQCBzdGF0aWMgdm9pZCBnZW44X3BwZ3R0X2luc2VydF80bHZsKHN0
cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCQlnZW44X3BwZ3R0X2luc2VydF9odWdlX2Vu
dHJpZXModm1hLCBwbWw0LCAmaXRlciwgY2FjaGVfbGV2ZWwsCiAJCQkJCSAgICAgICBmbGFncyk7
CiAJfSBlbHNlIHsKLQkJc3RydWN0IGdlbjhfaW5zZXJ0X3B0ZSBpZHggPSBnZW44X2luc2VydF9w
dGUodm1hLT5ub2RlLnN0YXJ0KTsKKwkJdTY0IGlkeCA9IHZtYS0+bm9kZS5zdGFydCA+PiBHRU44
X1BURV9TSElGVDsKIAotCQl3aGlsZSAoZ2VuOF9wcGd0dF9pbnNlcnRfcHRlX2VudHJpZXMocHBn
dHQsCi0JCQkJCQkgICAgIGk5MTVfcGRwX2VudHJ5KHBtbDQsIGlkeC5wbWw0ZSsrKSwKLQkJCQkJ
CSAgICAgJml0ZXIsICZpZHgsIGNhY2hlX2xldmVsLAotCQkJCQkJICAgICBmbGFncykpCi0JCQlH
RU1fQlVHX09OKGlkeC5wbWw0ZSA+PSBHRU44X1BNTDRFU19QRVJfUE1MNCk7CisJCXdoaWxlICgo
aWR4ID0gZ2VuOF9wcGd0dF9pbnNlcnRfcHRlX2VudHJpZXMocHBndHQsCisJCQkJCQkJICAgIGk5
MTVfcGRfZW50cnkocG1sNCwgZ2VuOF9wZF9pbmRleChpZHgsIDMpKSwKKwkJCQkJCQkgICAgJml0
ZXIsIGlkeCwgY2FjaGVfbGV2ZWwsCisJCQkJCQkJICAgIGZsYWdzKSkpCisJCQk7CiAKIAkJdm1h
LT5wYWdlX3NpemVzLmd0dCA9IEk5MTVfR1RUX1BBR0VfU0laRTsKIAl9CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ2VtX2d0dC5oCmluZGV4IGRlMTU2NjM0YTg4OS4uY2VhNTllZjFhMzY1IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaApAQCAtMTE1LDI5ICsxMTUsMTggQEAgdHlwZWRlZiB1
NjQgZ2VuOF9wdGVfdDsKICNkZWZpbmUgSFNXX0dUVF9BRERSX0VOQ09ERShhZGRyKQkoKGFkZHIp
IHwgKCgoYWRkcikgPj4gMjgpICYgMHg3ZjApKQogI2RlZmluZSBIU1dfUFRFX0FERFJfRU5DT0RF
KGFkZHIpCUhTV19HVFRfQUREUl9FTkNPREUoYWRkcikKIAotLyogR0VOOCAzMmIgc3R5bGUgYWRk
cmVzcyBpcyBkZWZpbmVkIGFzIGEgMyBsZXZlbCBwYWdlIHRhYmxlOgorLyoKKyAqIEdFTjggMzJi
IHN0eWxlIGFkZHJlc3MgaXMgZGVmaW5lZCBhcyBhIDMgbGV2ZWwgcGFnZSB0YWJsZToKICAqIDMx
OjMwIHwgMjk6MjEgfCAyMDoxMiB8ICAxMTowCiAgKiBQRFBFICB8ICBQREUgIHwgIFBURSAgfCBv
ZmZzZXQKICAqIFRoZSBkaWZmZXJlbmNlIGFzIGNvbXBhcmVkIHRvIG5vcm1hbCB4ODYgMyBsZXZl
bCBwYWdlIHRhYmxlIGlzIHRoZSBQRFBFcyBhcmUKICAqIHByb2dyYW1tZWQgdmlhIHJlZ2lzdGVy
LgotICovCi0jZGVmaW5lIEdFTjhfM0xWTF9QRFBFUwkJCTQKLSNkZWZpbmUgR0VOOF9QREVfU0hJ
RlQJCQkyMQotI2RlZmluZSBHRU44X1BERV9NQVNLCQkJMHgxZmYKLSNkZWZpbmUgR0VOOF9QVEVf
TUFTSwkJCTB4MWZmCi0jZGVmaW5lIEdFTjhfUFRFUwkJCUk5MTVfUFRFUyhzaXplb2YoZ2VuOF9w
dGVfdCkpCi0KLS8qIEdFTjggNDhiIHN0eWxlIGFkZHJlc3MgaXMgZGVmaW5lZCBhcyBhIDQgbGV2
ZWwgcGFnZSB0YWJsZToKKyAqCisgKiBHRU44IDQ4YiBzdHlsZSBhZGRyZXNzIGlzIGRlZmluZWQg
YXMgYSA0IGxldmVsIHBhZ2UgdGFibGU6CiAgKiA0NzozOSB8IDM4OjMwIHwgMjk6MjEgfCAyMDox
MiB8ICAxMTowCiAgKiBQTUw0RSB8IFBEUEUgIHwgIFBERSAgfCAgUFRFICB8IG9mZnNldAogICov
Ci0jZGVmaW5lIEdFTjhfUE1MNEVTX1BFUl9QTUw0CQk1MTIKLSNkZWZpbmUgR0VOOF9QTUw0RV9T
SElGVAkJMzkKLSNkZWZpbmUgR0VOOF9QTUw0RV9NQVNLCQkJKEdFTjhfUE1MNEVTX1BFUl9QTUw0
IC0gMSkKLSNkZWZpbmUgR0VOOF9QRFBFX1NISUZUCQkJMzAKLS8qIE5COiBHRU44X1BEUEVfTUFT
SyBpcyB1bnRydWUgZm9yIDMyYiBwbGF0Zm9ybXMsIGJ1dCBpdCBoYXMgbm8gaW1wYWN0IG9uIDMy
YiBwYWdlCi0gKiB0YWJsZXMgKi8KLSNkZWZpbmUgR0VOOF9QRFBFX01BU0sJCQkweDFmZgorI2Rl
ZmluZSBHRU44XzNMVkxfUERQRVMJCQk0CiAKICNkZWZpbmUgUFBBVF9VTkNBQ0hFRAkJCShfUEFH
RV9QV1QgfCBfUEFHRV9QQ0QpCiAjZGVmaW5lIFBQQVRfQ0FDSEVEX1BERQkJCTAgLyogV0IgTExD
ICovCkBAIC01MjEsMTUgKzUxMCw2IEBAIHN0YXRpYyBpbmxpbmUgdTMyIGdlbjZfcGRlX2luZGV4
KHUzMiBhZGRyKQogCXJldHVybiBpOTE1X3BkZV9pbmRleChhZGRyLCBHRU42X1BERV9TSElGVCk7
CiB9CiAKLXN0YXRpYyBpbmxpbmUgdW5zaWduZWQgaW50Ci1pOTE1X3BkcGVzX3Blcl9wZHAoY29u
c3Qgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCi17Ci0JaWYgKGk5MTVfdm1faXNfNGx2
bCh2bSkpCi0JCXJldHVybiBHRU44X1BNTDRFU19QRVJfUE1MNDsKLQotCXJldHVybiBHRU44XzNM
VkxfUERQRVM7Ci19Ci0KIHN0YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVfcGFnZV90YWJsZSAqCiBp
OTE1X3B0X2VudHJ5KGNvbnN0IHN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICogY29uc3QgcGQs
CiAJICAgICAgY29uc3QgdW5zaWduZWQgc2hvcnQgbikKQEAgLTU0NCw2NiArNTI0LDYgQEAgaTkx
NV9wZF9lbnRyeShjb25zdCBzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVjdG9yeSAqIGNvbnN0IHBkcCwK
IAlyZXR1cm4gcGRwLT5lbnRyeVtuXTsKIH0KIAotc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV9w
YWdlX2RpcmVjdG9yeSAqCi1pOTE1X3BkcF9lbnRyeShjb25zdCBzdHJ1Y3QgaTkxNV9wYWdlX2Rp
cmVjdG9yeSAqIGNvbnN0IHBtbDQsCi0JICAgICAgIGNvbnN0IHVuc2lnbmVkIHNob3J0IG4pCi17
Ci0JcmV0dXJuIHBtbDQtPmVudHJ5W25dOwotfQotCi0vKiBFcXVpdmFsZW50IHRvIHRoZSBnZW42
IHZlcnNpb24sIEZvciBlYWNoIHBkZSBpdGVyYXRlcyBvdmVyIGV2ZXJ5IHBkZQotICogYmV0d2Vl
biBmcm9tIHN0YXJ0IHVudGlsIHN0YXJ0ICsgbGVuZ3RoLiBPbiBnZW44KyBpdCBzaW1wbHkgaXRl
cmF0ZXMKLSAqIG92ZXIgZXZlcnkgcGFnZSBkaXJlY3RvcnkgZW50cnkgaW4gYSBwYWdlIGRpcmVj
dG9yeS4KLSAqLwotI2RlZmluZSBnZW44X2Zvcl9lYWNoX3BkZShwdCwgcGQsIHN0YXJ0LCBsZW5n
dGgsIGl0ZXIpCQkJXAotCWZvciAoaXRlciA9IGdlbjhfcGRlX2luZGV4KHN0YXJ0KTsJCQkJXAot
CSAgICAgbGVuZ3RoID4gMCAmJiBpdGVyIDwgSTkxNV9QREVTICYmCQkJCVwKLQkJICAgICAocHQg
PSBpOTE1X3B0X2VudHJ5KHBkLCBpdGVyKSwgdHJ1ZSk7CQlcCi0JICAgICAoeyB1NjQgdGVtcCA9
IEFMSUdOKHN0YXJ0KzEsIDEgPDwgR0VOOF9QREVfU0hJRlQpOwkJXAotCQkgICAgdGVtcCA9IG1p
bih0ZW1wIC0gc3RhcnQsIGxlbmd0aCk7CQkJXAotCQkgICAgc3RhcnQgKz0gdGVtcCwgbGVuZ3Ro
IC09IHRlbXA7IH0pLCArK2l0ZXIpCi0KLSNkZWZpbmUgZ2VuOF9mb3JfZWFjaF9wZHBlKHBkLCBw
ZHAsIHN0YXJ0LCBsZW5ndGgsIGl0ZXIpCQlcCi0JZm9yIChpdGVyID0gZ2VuOF9wZHBlX2luZGV4
KHN0YXJ0KTsJCQkJXAotCSAgICAgbGVuZ3RoID4gMCAmJiBpdGVyIDwgaTkxNV9wZHBlc19wZXJf
cGRwKHZtKSAmJgkJXAotCQkgICAgIChwZCA9IGk5MTVfcGRfZW50cnkocGRwLCBpdGVyKSwgdHJ1
ZSk7CQlcCi0JICAgICAoeyB1NjQgdGVtcCA9IEFMSUdOKHN0YXJ0KzEsIDEgPDwgR0VOOF9QRFBF
X1NISUZUKTsJXAotCQkgICAgdGVtcCA9IG1pbih0ZW1wIC0gc3RhcnQsIGxlbmd0aCk7CQkJXAot
CQkgICAgc3RhcnQgKz0gdGVtcCwgbGVuZ3RoIC09IHRlbXA7IH0pLCArK2l0ZXIpCi0KLSNkZWZp
bmUgZ2VuOF9mb3JfZWFjaF9wbWw0ZShwZHAsIHBtbDQsIHN0YXJ0LCBsZW5ndGgsIGl0ZXIpCQlc
Ci0JZm9yIChpdGVyID0gZ2VuOF9wbWw0ZV9pbmRleChzdGFydCk7CQkJCVwKLQkgICAgIGxlbmd0
aCA+IDAgJiYgaXRlciA8IEdFTjhfUE1MNEVTX1BFUl9QTUw0ICYmCQlcCi0JCSAgICAgKHBkcCA9
IGk5MTVfcGRwX2VudHJ5KHBtbDQsIGl0ZXIpLCB0cnVlKTsJCVwKLQkgICAgICh7IHU2NCB0ZW1w
ID0gQUxJR04oc3RhcnQrMSwgMVVMTCA8PCBHRU44X1BNTDRFX1NISUZUKTsJXAotCQkgICAgdGVt
cCA9IG1pbih0ZW1wIC0gc3RhcnQsIGxlbmd0aCk7CQkJXAotCQkgICAgc3RhcnQgKz0gdGVtcCwg
bGVuZ3RoIC09IHRlbXA7IH0pLCArK2l0ZXIpCi0KLXN0YXRpYyBpbmxpbmUgdTMyIGdlbjhfcHRl
X2luZGV4KHU2NCBhZGRyZXNzKQotewotCXJldHVybiBpOTE1X3B0ZV9pbmRleChhZGRyZXNzLCBH
RU44X1BERV9TSElGVCk7Ci19Ci0KLXN0YXRpYyBpbmxpbmUgdTMyIGdlbjhfcGRlX2luZGV4KHU2
NCBhZGRyZXNzKQotewotCXJldHVybiBpOTE1X3BkZV9pbmRleChhZGRyZXNzLCBHRU44X1BERV9T
SElGVCk7Ci19Ci0KLXN0YXRpYyBpbmxpbmUgdTMyIGdlbjhfcGRwZV9pbmRleCh1NjQgYWRkcmVz
cykKLXsKLQlyZXR1cm4gKGFkZHJlc3MgPj4gR0VOOF9QRFBFX1NISUZUKSAmIEdFTjhfUERQRV9N
QVNLOwotfQotCi1zdGF0aWMgaW5saW5lIHUzMiBnZW44X3BtbDRlX2luZGV4KHU2NCBhZGRyZXNz
KQotewotCXJldHVybiAoYWRkcmVzcyA+PiBHRU44X1BNTDRFX1NISUZUKSAmIEdFTjhfUE1MNEVf
TUFTSzsKLX0KLQotc3RhdGljIGlubGluZSB1NjQgZ2VuOF9wdGVfY291bnQodTY0IGFkZHJlc3Ms
IHU2NCBsZW5ndGgpCi17Ci0JcmV0dXJuIGk5MTVfcHRlX2NvdW50KGFkZHJlc3MsIGxlbmd0aCwg
R0VOOF9QREVfU0hJRlQpOwotfQotCiBzdGF0aWMgaW5saW5lIGRtYV9hZGRyX3QKIGk5MTVfcGFn
ZV9kaXJfZG1hX2FkZHIoY29uc3Qgc3RydWN0IGk5MTVfcHBndHQgKnBwZ3R0LCBjb25zdCB1bnNp
Z25lZCBpbnQgbikKIHsKLS0gCjIuMjIuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlz
dGluZm8vaW50ZWwtZ2Z4

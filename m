Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3D216349BE1
	for <lists+intel-gfx@lfdr.de>; Thu, 25 Mar 2021 22:48:41 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4FE166EE6A;
	Thu, 25 Mar 2021 21:48:39 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga17.intel.com (mga17.intel.com [192.55.52.151])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 66EB46EE5E
 for <intel-gfx@lists.freedesktop.org>; Thu, 25 Mar 2021 21:48:35 +0000 (UTC)
IronPort-SDR: D3OsejxEGjk7lK9DIKbPiWRXC6+5vMs05rzxoqIOtJEoQdAKc5KDVxdt1davjsZgwdpZKIOMiH
 9qqAuLHzsb/Q==
X-IronPort-AV: E=McAfee;i="6000,8403,9934"; a="171005090"
X-IronPort-AV: E=Sophos;i="5.81,278,1610438400"; d="scan'208";a="171005090"
Received: from orsmga003.jf.intel.com ([10.7.209.27])
 by fmsmga107.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 25 Mar 2021 14:48:35 -0700
IronPort-SDR: 4mKWsABZptii9lCcXzBUPv7JzrbXHauOvC2jrep3ntABDePj/VDQz19y+GXjqzvKZv2a8gXTyT
 a1W3K9Gi8Dsw==
X-IronPort-AV: E=Sophos;i="5.81,278,1610438400"; d="scan'208";a="375235708"
Received: from ideak-desk.fi.intel.com ([10.237.68.141])
 by orsmga003-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 25 Mar 2021 14:48:33 -0700
From: Imre Deak <imre.deak@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 25 Mar 2021 23:48:01 +0200
Message-Id: <20210325214808.2071517-19-imre.deak@intel.com>
X-Mailer: git-send-email 2.25.1
In-Reply-To: <20210325214808.2071517-1-imre.deak@intel.com>
References: <20210325214808.2071517-1-imre.deak@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 18/25] drm/i915: Simplify copying the FB view
 state to the plane state
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SW5zdGVhZCBvZiBjb3B5aW5nIHNlcGFyYXRlbHkgdGhlIEdUVCByZW1hcHBlZCBhbmQgY29sb3Ig
cGxhbmUgdmlldyBpbmZvCmZyb20gdGhlIEZCIHRvIHRoZSBwbGFuZSBzdGF0ZSwgZG8gdGhpcyBi
eSBjb3B5aW5nIHRoZSB3aG9sZQppbnRlbF9mYl92aWV3IHN0cnVjdC4gRm9yIHRoaXMgd2UgbWFr
ZSBzdXJlIHRoZSBGQiB2aWV3IHN0YXRlIGlzIGZ1bGx5CmluaXRlZCAodGhhdCBpcyBhbHNvIGlu
Y2x1ZGluZyB0aGUgdmlldyB0eXBlKSBhbHJlYWR5IGR1cmluZyBGQgpjcmVhdGlvbiwgc28gdGhp
cyBpbml0IGlzIG5vdCByZXF1aXJlZCBkdXJpbmcgYXRvbWljIGNoZWNrIHRpbWUuIFRoaXMKYWxz
byBtZWFucyB0aGUgd2UgZG9uJ3QgbmVlZCB0byByZXNldCB0aGUgdW51c2VkIGNvbG9yIHBsYW5l
IGluZm8gZHVyaW5nCmF0b21pYyBjaGVjaywgYXMgdGhlc2UgYXJlIGFscmVhZHkgcmVzZXQgZHVy
aW5nIEZCIGNyZWF0aW9uLgoKSSBub3RpY2VkIHRoYXQgaW5pdGlhbCBGQnMgd2lsbCBvbmx5IHdv
cmsgYXRtIGlmIHRoZXkgYXJlIHBhZ2UgYWxpZ25lZAood2hpY2ggQklPUyBtb3N0IHByb2JhYmx5
IGFsd2F5cyBlbnN1cmVzKSwgYnV0IGFkZCBhIGNvbW1lbnQgdG8gc2FuaXRpemUKdGhpcyBwYXJ0
IG9uY2UuIEFsc28gd2Ugd29uJ3QgZGlzYWJsZSB0aGUgcGxhbmUgaWYKZ2V0X2luaXRpYWxfcGxh
bmVfY29uZmlnKCkgZmFpbGVkIGZvciBzb21lIHJlYXNvbiAoZm9yIGluc3RhbmNlIGR1ZSB0bwp1
bnN1cHBvcnRlZCByb3RhdGlvbiksIGFkZCBhIFRPRE86IGNvbW1lbnQgZm9yIHRoaXMgdG9vLgoK
Q2M6IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBsaW51eC5pbnRlbC5jb20+ClNpZ25l
ZC1vZmYtYnk6IEltcmUgRGVhayA8aW1yZS5kZWFrQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyAgfCAxMSArKy0tCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiLmMgICAgICAgfCA1OSArKysrKysrKy0tLS0tLS0t
LS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiLmggICAgICAgfCAgNyAr
LS0KIC4uLi9kcm0vaTkxNS9kaXNwbGF5L3NrbF91bml2ZXJzYWxfcGxhbmUuYyAgICB8ICA4ICst
LQogNCBmaWxlcyBjaGFuZ2VkLCAzNCBpbnNlcnRpb25zKCspLCA1MSBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4IDRlZTdl
NzIxNDJhNWYuLjQ4YjhlMjA4M2UxNGEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGlzcGxheS5jCkBAIC0xNjI5LDYgKzE2MjksMTEgQEAgaW50ZWxfZmluZF9pbml0
aWFsX3BsYW5lX29iaihzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YywKIAlzdHJ1Y3QgZHJt
X2ZyYW1lYnVmZmVyICpmYjsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAorCS8qCisJICogVE9E
TzoKKwkgKiAgIERpc2FibGUgcGxhbmVzIGlmIGdldF9pbml0aWFsX3BsYW5lX2NvbmZpZygpIGZh
aWxlZC4KKwkgKiAgIE1ha2Ugc3VyZSB0aGluZ3Mgd29yayBpZiB0aGUgc3VyZmFjZSBiYXNlIGlz
IG5vdCBwYWdlIGFsaWduZWQuCisJICovCiAJaWYgKCFwbGFuZV9jb25maWctPmZiKQogCQlyZXR1
cm47CiAKQEAgLTE2ODAsMTAgKzE2ODUsOCBAQCBpbnRlbF9maW5kX2luaXRpYWxfcGxhbmVfb2Jq
KHN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjLAogCiB2YWxpZF9mYjoKIAlwbGFuZV9zdGF0
ZS0+cm90YXRpb24gPSBwbGFuZV9jb25maWctPnJvdGF0aW9uOwotCWludGVsX2ZpbGxfZmJfZ2d0
dF92aWV3KCZpbnRlbF9zdGF0ZS0+dmlldy5ndHQsIGZiLAotCQkJCXBsYW5lX3N0YXRlLT5yb3Rh
dGlvbik7Ci0JaW50ZWxfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbMF0ucGl0Y2ggPQotCQlpbnRl
bF9mYl9waXRjaChmYiwgMCwgcGxhbmVfc3RhdGUtPnJvdGF0aW9uKTsKKwlpbnRlbF9mYl9maWxs
X3ZpZXcodG9faW50ZWxfZnJhbWVidWZmZXIoZmIpLCBwbGFuZV9zdGF0ZS0+cm90YXRpb24sCisJ
CQkgICAmaW50ZWxfc3RhdGUtPnZpZXcpOwogCiAJX19pOTE1X3ZtYV9waW4odm1hKTsKIAlpbnRl
bF9zdGF0ZS0+dm1hID0gaTkxNV92bWFfZ2V0KHZtYSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2ZiLmMKaW5kZXggMzFmZDg0ODBmNzA3ZS4uMTZkY2ZiNTM4YjQ0OCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYi5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmIuYwpAQCAtNDg0LDEwICs0ODQsOCBAQCBz
dGF0aWMgYm9vbCBpbnRlbF9wbGFuZV9jYW5fcmVtYXAoY29uc3Qgc3RydWN0IGludGVsX3BsYW5l
X3N0YXRlICpwbGFuZV9zdGF0ZSkKIAlyZXR1cm4gdHJ1ZTsKIH0KIAotaW50IGludGVsX2ZiX3Bp
dGNoKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmRybV9mYiwgaW50IGNvbG9yX3BsYW5l
LCB1bnNpZ25lZCBpbnQgcm90YXRpb24pCitzdGF0aWMgaW50IGludGVsX2ZiX3BpdGNoKGNvbnN0
IHN0cnVjdCBpbnRlbF9mcmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFuZSwgdW5zaWduZWQg
aW50IHJvdGF0aW9uKQogewotCXN0cnVjdCBpbnRlbF9mcmFtZWJ1ZmZlciAqZmIgPSB0b19pbnRl
bF9mcmFtZWJ1ZmZlcihkcm1fZmIpOwotCiAJaWYgKGRybV9yb3RhdGlvbl85MF9vcl8yNzAocm90
YXRpb24pKQogCQlyZXR1cm4gZmItPnJvdGF0ZWRfdmlldy5jb2xvcl9wbGFuZVtjb2xvcl9wbGFu
ZV0ucGl0Y2g7CiAJZWxzZQpAQCAtNDk3LDcgKzQ5NSw3IEBAIGludCBpbnRlbF9mYl9waXRjaChj
b25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpkcm1fZmIsIGludCBjb2xvcl9wbGFuZSwgdW5z
aWduCiBzdGF0aWMgYm9vbCBpbnRlbF9wbGFuZV9uZWVkc19yZW1hcChjb25zdCBzdHJ1Y3QgaW50
ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxh
bmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+dWFwaS5wbGFuZSk7Ci0JY29uc3Qgc3Ry
dWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CisJY29uc3Qgc3Ry
dWN0IGludGVsX2ZyYW1lYnVmZmVyICpmYiA9IHRvX2ludGVsX2ZyYW1lYnVmZmVyKHBsYW5lX3N0
YXRlLT5ody5mYik7CiAJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJv
dGF0aW9uOwogCXUzMiBzdHJpZGUsIG1heF9zdHJpZGU7CiAKQEAgLTUxNiw4ICs1MTQsOCBAQCBz
dGF0aWMgYm9vbCBpbnRlbF9wbGFuZV9uZWVkc19yZW1hcChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCSAqIHVuY2xlYXIgaW4gQnNwZWMsIGZvciBub3cgbm8g
Y2hlY2tpbmcuCiAJICovCiAJc3RyaWRlID0gaW50ZWxfZmJfcGl0Y2goZmIsIDAsIHJvdGF0aW9u
KTsKLQltYXhfc3RyaWRlID0gcGxhbmUtPm1heF9zdHJpZGUocGxhbmUsIGZiLT5mb3JtYXQtPmZv
cm1hdCwKLQkJCQkgICAgICAgZmItPm1vZGlmaWVyLCByb3RhdGlvbik7CisJbWF4X3N0cmlkZSA9
IHBsYW5lLT5tYXhfc3RyaWRlKHBsYW5lLCBmYi0+YmFzZS5mb3JtYXQtPmZvcm1hdCwKKwkJCQkg
ICAgICAgZmItPmJhc2UubW9kaWZpZXIsIHJvdGF0aW9uKTsKIAogCXJldHVybiBzdHJpZGUgPiBt
YXhfc3RyaWRlOwogfQpAQCAtNzAyLDYgKzcwMCwxMiBAQCBjYWxjX3BsYW5lX25vcm1hbF9zaXpl
KGNvbnN0IHN0cnVjdCBpbnRlbF9mcmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFuZSwKIAly
ZXR1cm4gdGlsZXM7CiB9CiAKK3N0YXRpYyB2b2lkIGludGVsX2ZiX3ZpZXdfaW5pdChzdHJ1Y3Qg
aW50ZWxfZmJfdmlldyAqdmlldywgZW51bSBpOTE1X2dndHRfdmlld190eXBlIHZpZXdfdHlwZSkK
K3sKKwltZW1zZXQodmlldywgMCwgc2l6ZW9mKCp2aWV3KSk7CisJdmlldy0+Z3R0LnR5cGUgPSB2
aWV3X3R5cGU7Cit9CisKIGludCBpbnRlbF9maWxsX2ZiX2luZm8oc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsIHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiKQogewogCXN0cnVjdCBpbnRl
bF9mcmFtZWJ1ZmZlciAqaW50ZWxfZmIgPSB0b19pbnRlbF9mcmFtZWJ1ZmZlcihmYik7CkBAIC03
MTEsNiArNzE1LDkgQEAgaW50IGludGVsX2ZpbGxfZmJfaW5mbyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIKIAlpbnQgaSwgbnVtX3BsYW5l
cyA9IGZiLT5mb3JtYXQtPm51bV9wbGFuZXM7CiAJdW5zaWduZWQgaW50IHRpbGVfc2l6ZSA9IGlu
dGVsX3RpbGVfc2l6ZShpOTE1KTsKIAorCWludGVsX2ZiX3ZpZXdfaW5pdCgmaW50ZWxfZmItPm5v
cm1hbF92aWV3LCBJOTE1X0dHVFRfVklFV19OT1JNQUwpOworCWludGVsX2ZiX3ZpZXdfaW5pdCgm
aW50ZWxfZmItPnJvdGF0ZWRfdmlldywgSTkxNV9HR1RUX1ZJRVdfUk9UQVRFRCk7CisKIAlmb3Ig
KGkgPSAwOyBpIDwgbnVtX3BsYW5lczsgaSsrKSB7CiAJCXN0cnVjdCBmYl9wbGFuZV92aWV3X2Rp
bXMgdmlld19kaW1zOwogCQl1bnNpZ25lZCBpbnQgd2lkdGgsIGhlaWdodDsKQEAgLTc5Niw5ICs4
MDMsOSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wbGFuZV9yZW1hcF9ndHQoc3RydWN0IGludGVsX3Bs
YW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAl1bnNpZ25lZCBpbnQgc3JjX3csIHNyY19oOwogCXUz
MiBndHRfb2Zmc2V0ID0gMDsKIAotCW1lbXNldCgmcGxhbmVfc3RhdGUtPnZpZXcuZ3R0LCAwLCBz
aXplb2YocGxhbmVfc3RhdGUtPnZpZXcuZ3R0KSk7Ci0JcGxhbmVfc3RhdGUtPnZpZXcuZ3R0LnR5
cGUgPSBkcm1fcm90YXRpb25fOTBfb3JfMjcwKHJvdGF0aW9uKSA/Ci0JCUk5MTVfR0dUVF9WSUVX
X1JPVEFURUQgOiBJOTE1X0dHVFRfVklFV19SRU1BUFBFRDsKKwlpbnRlbF9mYl92aWV3X2luaXQo
JnBsYW5lX3N0YXRlLT52aWV3LAorCQkJICAgZHJtX3JvdGF0aW9uXzkwX29yXzI3MChyb3RhdGlv
bikgPyBJOTE1X0dHVFRfVklFV19ST1RBVEVEIDoKKwkJCQkJCQkgICAgICBJOTE1X0dHVFRfVklF
V19SRU1BUFBFRCk7CiAKIAlzcmNfeCA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy54MSA+PiAxNjsK
IAlzcmNfeSA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy55MSA+PiAxNjsKQEAgLTg4OSwxNyArODk2
LDEzIEBAIHN0YXRpYyB2b2lkIGludGVsX3BsYW5lX3JlbWFwX2d0dChzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCX0KIH0KIAotdm9pZCBpbnRlbF9maWxsX2ZiX2dndHRf
dmlldyhzdHJ1Y3QgaTkxNV9nZ3R0X3ZpZXcgKnZpZXcsCi0JCQkgICAgIGNvbnN0IHN0cnVjdCBk
cm1fZnJhbWVidWZmZXIgKmZiLAotCQkJICAgICB1bnNpZ25lZCBpbnQgcm90YXRpb24pCit2b2lk
IGludGVsX2ZiX2ZpbGxfdmlldyhjb25zdCBzdHJ1Y3QgaW50ZWxfZnJhbWVidWZmZXIgKmZiLCB1
bnNpZ25lZCBpbnQgcm90YXRpb24sCisJCQlzdHJ1Y3QgaW50ZWxfZmJfdmlldyAqdmlldykKIHsK
LQltZW1zZXQodmlldywgMCwgc2l6ZW9mKCp2aWV3KSk7Ci0KLQl2aWV3LT50eXBlID0gSTkxNV9H
R1RUX1ZJRVdfTk9STUFMOwotCWlmIChkcm1fcm90YXRpb25fOTBfb3JfMjcwKHJvdGF0aW9uKSkg
ewotCQl2aWV3LT50eXBlID0gSTkxNV9HR1RUX1ZJRVdfUk9UQVRFRDsKLQkJdmlldy0+cm90YXRl
ZCA9IHRvX2ludGVsX2ZyYW1lYnVmZmVyKGZiKS0+cm90YXRlZF92aWV3Lmd0dC5yb3RhdGVkOwot
CX0KKwlpZiAoZHJtX3JvdGF0aW9uXzkwX29yXzI3MChyb3RhdGlvbikpCisJCSp2aWV3ID0gZmIt
PnJvdGF0ZWRfdmlldzsKKwllbHNlCisJCSp2aWV3ID0gZmItPm5vcm1hbF92aWV3OwogfQogCiBz
dGF0aWMgaW50IGludGVsX3BsYW5lX2NoZWNrX3N0cmlkZShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGUgKnBsYW5lX3N0YXRlKQpAQCAtOTM5LDEzICs5NDIsMTAgQEAgaW50IGludGVsX3Bs
YW5lX2NvbXB1dGVfZ3R0KHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJ
Y29uc3Qgc3RydWN0IGludGVsX2ZyYW1lYnVmZmVyICpmYiA9CiAJCXRvX2ludGVsX2ZyYW1lYnVm
ZmVyKHBsYW5lX3N0YXRlLT5ody5mYik7CiAJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVf
c3RhdGUtPmh3LnJvdGF0aW9uOwotCWludCBpLCBudW1fcGxhbmVzOwogCiAJaWYgKCFmYikKIAkJ
cmV0dXJuIDA7CiAKLQludW1fcGxhbmVzID0gZmItPmJhc2UuZm9ybWF0LT5udW1fcGxhbmVzOwot
CiAJaWYgKGludGVsX3BsYW5lX25lZWRzX3JlbWFwKHBsYW5lX3N0YXRlKSkgewogCQlpbnRlbF9w
bGFuZV9yZW1hcF9ndHQocGxhbmVfc3RhdGUpOwogCkBAIC05NTgsMjAgKzk1OCw3IEBAIGludCBp
bnRlbF9wbGFuZV9jb21wdXRlX2d0dChzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0
YXRlKQogCQlyZXR1cm4gaW50ZWxfcGxhbmVfY2hlY2tfc3RyaWRlKHBsYW5lX3N0YXRlKTsKIAl9
CiAKLQlpbnRlbF9maWxsX2ZiX2dndHRfdmlldygmcGxhbmVfc3RhdGUtPnZpZXcuZ3R0LCAmZmIt
PmJhc2UsIHJvdGF0aW9uKTsKLQotCWZvciAoaSA9IDA7IGkgPCBudW1fcGxhbmVzOyBpKyspIHsK
LQkJcGxhbmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbaV0ucGl0Y2ggPSBpbnRlbF9mYl9waXRj
aCgmZmItPmJhc2UsIGksIHJvdGF0aW9uKTsKLQkJcGxhbmVfc3RhdGUtPnZpZXcuY29sb3JfcGxh
bmVbaV0ub2Zmc2V0ID0gMDsKLQotCQlpZiAoZHJtX3JvdGF0aW9uXzkwX29yXzI3MChyb3RhdGlv
bikpIHsKLQkJCXBsYW5lX3N0YXRlLT52aWV3LmNvbG9yX3BsYW5lW2ldLnggPSBmYi0+cm90YXRl
ZF92aWV3LmNvbG9yX3BsYW5lW2ldLng7Ci0JCQlwbGFuZV9zdGF0ZS0+dmlldy5jb2xvcl9wbGFu
ZVtpXS55ID0gZmItPnJvdGF0ZWRfdmlldy5jb2xvcl9wbGFuZVtpXS55OwotCQl9IGVsc2Ugewot
CQkJcGxhbmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbaV0ueCA9IGZiLT5ub3JtYWxfdmlldy5j
b2xvcl9wbGFuZVtpXS54OwotCQkJcGxhbmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbaV0ueSA9
IGZiLT5ub3JtYWxfdmlldy5jb2xvcl9wbGFuZVtpXS55OwotCQl9Ci0JfQorCWludGVsX2ZiX2Zp
bGxfdmlldyhmYiwgcm90YXRpb24sICZwbGFuZV9zdGF0ZS0+dmlldyk7CiAKIAkvKiBSb3RhdGUg
c3JjIGNvb3JkaW5hdGVzIHRvIG1hdGNoIHJvdGF0ZWQgR1RUIHZpZXcgKi8KIAlpZiAoZHJtX3Jv
dGF0aW9uXzkwX29yXzI3MChyb3RhdGlvbikpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2ZiLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2ZiLmgKaW5kZXggOGZmYzg4M2E4M2MzNC4uMGVhOWRhMzYwNDUwZCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYi5oCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmIuaApAQCAtMTUsNiArMTUsNyBAQCBzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZTsKIHN0cnVjdCBpOTE1X2dndHRfdmlldzsKIAogc3RydWN0IGludGVsX2Zi
X3ZpZXc7CitzdHJ1Y3QgaW50ZWxfZnJhbWVidWZmZXI7CiBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3Rh
dGU7CiAKIGVudW0gaTkxNV9nZ3R0X3ZpZXdfdHlwZTsKQEAgLTQ5LDExICs1MCw5IEBAIHUzMiBp
bnRlbF9wbGFuZV9jb21wdXRlX2FsaWduZWRfb2Zmc2V0KGludCAqeCwgaW50ICp5LAogCQkJCSAg
ICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnN0YXRlLAogCQkJCSAgICAgICBp
bnQgY29sb3JfcGxhbmUpOwogCi1pbnQgaW50ZWxfZmJfcGl0Y2goY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFuZSwgdW5zaWduZWQgaW50IHJvdGF0aW9uKTsK
LQogaW50IGludGVsX2ZpbGxfZmJfaW5mbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwg
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIpOwotdm9pZCBpbnRlbF9maWxsX2ZiX2dndHRfdmll
dyhzdHJ1Y3QgaTkxNV9nZ3R0X3ZpZXcgKnZpZXcsIGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiLAotCQkJICAgICB1bnNpZ25lZCBpbnQgcm90YXRpb24pOwordm9pZCBpbnRlbF9mYl9m
aWxsX3ZpZXcoY29uc3Qgc3RydWN0IGludGVsX2ZyYW1lYnVmZmVyICpmYiwgdW5zaWduZWQgaW50
IHJvdGF0aW9uLAorCQkJc3RydWN0IGludGVsX2ZiX3ZpZXcgKnZpZXcpOwogaW50IGludGVsX3Bs
YW5lX2NvbXB1dGVfZ3R0KHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpOwog
CiAjZW5kaWYgLyogX19JTlRFTF9GQl9IX18gKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvc2tsX3VuaXZlcnNhbF9wbGFuZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9za2xfdW5pdmVyc2FsX3BsYW5lLmMKaW5kZXggMDBhMTFmYjUxNmU1Mi4uMDBh
NTM1MTJlZjZjZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9za2xf
dW5pdmVyc2FsX3BsYW5lLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9za2xf
dW5pdmVyc2FsX3BsYW5lLmMKQEAgLTE1MzgsNyArMTUzOCw3IEBAIHN0YXRpYyBpbnQgc2tsX2No
ZWNrX2Njc19hdXhfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRl
KQogc3RhdGljIGludCBza2xfY2hlY2tfcGxhbmVfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVf
c3RhdGUgKnBsYW5lX3N0YXRlKQogewogCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
ID0gcGxhbmVfc3RhdGUtPmh3LmZiOwotCWludCByZXQsIGk7CisJaW50IHJldDsKIAogCXJldCA9
IGludGVsX3BsYW5lX2NvbXB1dGVfZ3R0KHBsYW5lX3N0YXRlKTsKIAlpZiAocmV0KQpAQCAtMTU2
NCwxMiArMTU2NCw2IEBAIHN0YXRpYyBpbnQgc2tsX2NoZWNrX3BsYW5lX3N1cmZhY2Uoc3RydWN0
IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAkJCXJldHVybiByZXQ7CiAJfQogCi0J
Zm9yIChpID0gZmItPmZvcm1hdC0+bnVtX3BsYW5lczsgaSA8IEFSUkFZX1NJWkUocGxhbmVfc3Rh
dGUtPnZpZXcuY29sb3JfcGxhbmUpOyBpKyspIHsKLQkJcGxhbmVfc3RhdGUtPnZpZXcuY29sb3Jf
cGxhbmVbaV0ub2Zmc2V0ID0gMDsKLQkJcGxhbmVfc3RhdGUtPnZpZXcuY29sb3JfcGxhbmVbaV0u
eCA9IDA7Ci0JCXBsYW5lX3N0YXRlLT52aWV3LmNvbG9yX3BsYW5lW2ldLnkgPSAwOwotCX0KLQog
CXJldCA9IHNrbF9jaGVja19tYWluX3N1cmZhY2UocGxhbmVfc3RhdGUpOwogCWlmIChyZXQpCiAJ
CXJldHVybiByZXQ7Ci0tIAoyLjI1LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZy
ZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL2ludGVsLWdmeAo=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 1FFC3684E6
	for <lists+intel-gfx@lfdr.de>; Mon, 15 Jul 2019 10:10:31 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0B9A689862;
	Mon, 15 Jul 2019 08:10:29 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E6EC78981D
 for <intel-gfx@lists.freedesktop.org>; Mon, 15 Jul 2019 08:10:15 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17303256-1500050 
 for multiple; Mon, 15 Jul 2019 09:09:54 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 15 Jul 2019 09:09:41 +0100
Message-Id: <20190715080946.15593-19-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190715080946.15593-1-chris@chris-wilson.co.uk>
References: <20190715080946.15593-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 19/24] drm/i915: Extract intel_frontbuffer
 active tracking
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TW92ZSB0aGUgYWN0aXZlIHRyYWNraW5nIGZvciB0aGUgZnJvbnRidWZmZXIgb3BlcmF0aW9ucyBv
dXQgb2YgdGhlCmk5MTVfZ2VtX29iamVjdCBhbmQgaW50byBpdHMgb3duIGZpcnN0IGNsYXNzIChy
ZWZjb3VudGVkKSBvYmplY3QuIEluIHRoZQpwcm9jZXNzIG9mIGRldGFuZ2xpbmcsIHdlIHN3aXRj
aCBmcm9tIGxvdyBsZXZlbCByZXF1ZXN0IHRyYWNraW5nIHRvIHRoZQplYXNpZXIgaTkxNV9hY3Rp
dmUgLS0gd2l0aCB0aGUgcGxhbiB0aGF0IHRoaXMgYXZvaWRzIGFueSBwb3RlbnRpYWwKYXRvbWlj
IGNhbGxiYWNrcyBhcyB0aGUgZnJvbnRidWZmZXIgdHJhY2tpbmcgd2lzaGVzIHRvIHNsZWVwIGFz
IGl0CmZsdXNoZXMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdp
bHNvbi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3Bs
YXkuYyAgfCAgNzAgKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJk
ZXYuYyAgICB8ICA0MCArKy0KIC4uLi9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mcm9udGJ1
ZmZlci5jICB8IDI1NSArKysrKysrKysrKysrLS0tLS0KIC4uLi9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9mcm9udGJ1ZmZlci5oICB8ICA3MCArKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9vdmVybGF5LmMgIHwgICA4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fY2xmbHVzaC5jICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9kb21haW4uYyAgICB8ICAxNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX21tYW4uYyAgICAgIHwgICA0IC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9vYmplY3QuYyAgICB8ICAyNyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX29iamVjdC5oICAgIHwgICAyICstCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9vYmplY3RfdHlwZXMuaCAgfCAgIDggKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVi
dWdmcy5jICAgICAgICAgICB8ICAgNSAtCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5o
ICAgICAgICAgICAgICAgfCAgIDQgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyAg
ICAgICAgICAgICAgIHwgIDQ3ICstLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMg
ICAgICAgICAgICAgICB8ICAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZHJ2Lmgg
ICAgICAgICAgICAgIHwgICAxICsKIDE2IGZpbGVzIGNoYW5nZWQsIDMwNiBpbnNlcnRpb25zKCsp
LCAyNTcgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2Rpc3BsYXkuYwppbmRleCBlMjViODJkMDdkNGYuLjIxOWFlNWE2MGIzMSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTMwNDksMTIgKzMwNDks
MTMgQEAgaW50ZWxfYWxsb2NfaW5pdGlhbF9wbGFuZV9vYmooc3RydWN0IGludGVsX2NydGMgKmNy
dGMsCiB7CiAJc3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNydGMtPmJhc2UuZGV2OwogCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKLQlzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqID0gTlVMTDsKIAlzdHJ1Y3QgZHJtX21vZGVfZmJfY21kMiBt
b2RlX2NtZCA9IHsgMCB9OwogCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gJnBsYW5lX2Nv
bmZpZy0+ZmItPmJhc2U7CiAJdTMyIGJhc2VfYWxpZ25lZCA9IHJvdW5kX2Rvd24ocGxhbmVfY29u
ZmlnLT5iYXNlLCBQQUdFX1NJWkUpOwogCXUzMiBzaXplX2FsaWduZWQgPSByb3VuZF91cChwbGFu
ZV9jb25maWctPmJhc2UgKyBwbGFuZV9jb25maWctPnNpemUsCiAJCQkJICAgIFBBR0VfU0laRSk7
CisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKKwlib29sIHJldCA9IGZhbHNlOwog
CiAJc2l6ZV9hbGlnbmVkIC09IGJhc2VfYWxpZ25lZDsKIApAQCAtMzA5Niw3ICszMDk3LDcgQEAg
aW50ZWxfYWxsb2NfaW5pdGlhbF9wbGFuZV9vYmooc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJ
CWJyZWFrOwogCWRlZmF1bHQ6CiAJCU1JU1NJTkdfQ0FTRShwbGFuZV9jb25maWctPnRpbGluZyk7
Ci0JCXJldHVybiBmYWxzZTsKKwkJZ290byBvdXQ7CiAJfQogCiAJbW9kZV9jbWQucGl4ZWxfZm9y
bWF0ID0gZmItPmZvcm1hdC0+Zm9ybWF0OwpAQCAtMzEwOCwxNiArMzEwOSwxNSBAQCBpbnRlbF9h
bGxvY19pbml0aWFsX3BsYW5lX29iaihzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAogCWlmIChp
bnRlbF9mcmFtZWJ1ZmZlcl9pbml0KHRvX2ludGVsX2ZyYW1lYnVmZmVyKGZiKSwgb2JqLCAmbW9k
ZV9jbWQpKSB7CiAJCURSTV9ERUJVR19LTVMoImludGVsIGZiIGluaXQgZmFpbGVkXG4iKTsKLQkJ
Z290byBvdXRfdW5yZWZfb2JqOworCQlnb3RvIG91dDsKIAl9CiAKIAogCURSTV9ERUJVR19LTVMo
ImluaXRpYWwgcGxhbmUgZmIgb2JqICVwXG4iLCBvYmopOwotCXJldHVybiB0cnVlOwotCi1vdXRf
dW5yZWZfb2JqOgorCXJldCA9IHRydWU7CitvdXQ6CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmop
OwotCXJldHVybiBmYWxzZTsKKwlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMgdm9pZApAQCAtMzE3
NCw2ICszMTc0LDEyIEBAIHN0YXRpYyB2b2lkIGludGVsX3BsYW5lX2Rpc2FibGVfbm9hdG9taWMo
c3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJaW50ZWxfZGlzYWJsZV9wbGFuZShwbGFuZSwgY3J0
Y19zdGF0ZSk7CiB9CiAKK3N0YXRpYyBzdHJ1Y3QgaW50ZWxfZnJvbnRidWZmZXIgKgordG9faW50
ZWxfZnJvbnRidWZmZXIoc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIpCit7CisJcmV0dXJuIGZi
ID8gdG9faW50ZWxfZnJhbWVidWZmZXIoZmIpLT5mcm9udGJ1ZmZlciA6IE5VTEw7Cit9CisKIHN0
YXRpYyB2b2lkCiBpbnRlbF9maW5kX2luaXRpYWxfcGxhbmVfb2JqKHN0cnVjdCBpbnRlbF9jcnRj
ICppbnRlbF9jcnRjLAogCQkJICAgICBzdHJ1Y3QgaW50ZWxfaW5pdGlhbF9wbGFuZV9jb25maWcg
KnBsYW5lX2NvbmZpZykKQEAgLTMxODEsNyArMzE4Nyw2IEBAIGludGVsX2ZpbmRfaW5pdGlhbF9w
bGFuZV9vYmooc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMsCiAJc3RydWN0IGRybV9kZXZp
Y2UgKmRldiA9IGludGVsX2NydGMtPmJhc2UuZGV2OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKIAlzdHJ1Y3QgZHJtX2NydGMgKmM7Ci0Jc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKIAlzdHJ1Y3QgZHJtX3BsYW5lICpwcmltYXJ5ID0g
aW50ZWxfY3J0Yy0+YmFzZS5wcmltYXJ5OwogCXN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKnBsYW5l
X3N0YXRlID0gcHJpbWFyeS0+c3RhdGU7CiAJc3RydWN0IGludGVsX3BsYW5lICppbnRlbF9wbGFu
ZSA9IHRvX2ludGVsX3BsYW5lKHByaW1hcnkpOwpAQCAtMzI1Nyw4ICszMjYyLDcgQEAgaW50ZWxf
ZmluZF9pbml0aWFsX3BsYW5lX29iaihzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YywKIAkJ
cmV0dXJuOwogCX0KIAotCW9iaiA9IGludGVsX2ZiX29iaihmYik7Ci0JaW50ZWxfZmJfb2JqX2Zs
dXNoKG9iaiwgT1JJR0lOX0RJUlRZRkIpOworCWludGVsX2Zyb250YnVmZmVyX2ZsdXNoKHRvX2lu
dGVsX2Zyb250YnVmZmVyKGZiKSwgT1JJR0lOX0RJUlRZRkIpOwogCiAJcGxhbmVfc3RhdGUtPnNy
Y194ID0gMDsKIAlwbGFuZV9zdGF0ZS0+c3JjX3kgPSAwOwpAQCAtMzI3MywxNCArMzI3NywxNCBA
QCBpbnRlbF9maW5kX2luaXRpYWxfcGxhbmVfb2JqKHN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9j
cnRjLAogCWludGVsX3N0YXRlLT5iYXNlLnNyYyA9IGRybV9wbGFuZV9zdGF0ZV9zcmMocGxhbmVf
c3RhdGUpOwogCWludGVsX3N0YXRlLT5iYXNlLmRzdCA9IGRybV9wbGFuZV9zdGF0ZV9kZXN0KHBs
YW5lX3N0YXRlKTsKIAotCWlmIChpOTE1X2dlbV9vYmplY3RfaXNfdGlsZWQob2JqKSkKKwlpZiAo
cGxhbmVfY29uZmlnLT50aWxpbmcpCiAJCWRldl9wcml2LT5wcmVzZXJ2ZV9iaW9zX3N3aXp6bGUg
PSB0cnVlOwogCiAJcGxhbmVfc3RhdGUtPmZiID0gZmI7CiAJcGxhbmVfc3RhdGUtPmNydGMgPSAm
aW50ZWxfY3J0Yy0+YmFzZTsKIAogCWF0b21pY19vcih0b19pbnRlbF9wbGFuZShwcmltYXJ5KS0+
ZnJvbnRidWZmZXJfYml0LAotCQkgICZvYmotPmZyb250YnVmZmVyX2JpdHMpOworCQkgICZ0b19p
bnRlbF9mcm9udGJ1ZmZlcihmYiktPmJpdHMpOwogfQogCiBzdGF0aWMgaW50IHNrbF9tYXhfcGxh
bmVfd2lkdGgoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCkBAIC0xNDEyOSw5ICsx
NDEzMyw5IEBAIHN0YXRpYyB2b2lkIGludGVsX2F0b21pY190cmFja19mYnMoc3RydWN0IGludGVs
X2F0b21pY19zdGF0ZSAqc3RhdGUpCiAKIAlmb3JfZWFjaF9vbGRuZXdfaW50ZWxfcGxhbmVfaW5f
c3RhdGUoc3RhdGUsIHBsYW5lLCBvbGRfcGxhbmVfc3RhdGUsCiAJCQkJCSAgICAgbmV3X3BsYW5l
X3N0YXRlLCBpKQotCQlpOTE1X2dlbV90cmFja19mYihpbnRlbF9mYl9vYmoob2xkX3BsYW5lX3N0
YXRlLT5iYXNlLmZiKSwKLQkJCQkgIGludGVsX2ZiX29iaihuZXdfcGxhbmVfc3RhdGUtPmJhc2Uu
ZmIpLAotCQkJCSAgcGxhbmUtPmZyb250YnVmZmVyX2JpdCk7CisJCWludGVsX2Zyb250YnVmZmVy
X3RyYWNrKHRvX2ludGVsX2Zyb250YnVmZmVyKG9sZF9wbGFuZV9zdGF0ZS0+YmFzZS5mYiksCisJ
CQkJCXRvX2ludGVsX2Zyb250YnVmZmVyKG5ld19wbGFuZV9zdGF0ZS0+YmFzZS5mYiksCisJCQkJ
CXBsYW5lLT5mcm9udGJ1ZmZlcl9iaXQpOwogfQogCiBzdGF0aWMgaW50IGludGVsX2F0b21pY19j
b21taXQoc3RydWN0IGRybV9kZXZpY2UgKmRldiwKQEAgLTE0NDE1LDcgKzE0NDE5LDcgQEAgaW50
ZWxfcHJlcGFyZV9wbGFuZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAkJcmV0dXJuIHJl
dDsKIAogCWZiX29ial9idW1wX3JlbmRlcl9wcmlvcml0eShvYmopOwotCWludGVsX2ZiX29ial9m
bHVzaChvYmosIE9SSUdJTl9ESVJUWUZCKTsKKwlpbnRlbF9mcm9udGJ1ZmZlcl9mbHVzaChvYmot
PmZyb250YnVmZmVyLCBPUklHSU5fRElSVFlGQik7CiAKIAlpZiAoIW5ld19zdGF0ZS0+ZmVuY2Up
IHsgLyogaW1wbGljaXQgZmVuY2luZyAqLwogCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKQEAg
LTE0Njc4LDEzICsxNDY4MiwxMiBAQCBpbnRlbF9sZWdhY3lfY3Vyc29yX3VwZGF0ZShzdHJ1Y3Qg
ZHJtX3BsYW5lICpwbGFuZSwKIAkJCSAgIHN0cnVjdCBkcm1fbW9kZXNldF9hY3F1aXJlX2N0eCAq
Y3R4KQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0
Yy0+ZGV2KTsKLQlpbnQgcmV0OwogCXN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKm9sZF9wbGFuZV9z
dGF0ZSwgKm5ld19wbGFuZV9zdGF0ZTsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKmludGVsX3BsYW5l
ID0gdG9faW50ZWxfcGxhbmUocGxhbmUpOwotCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKm9sZF9m
YjsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSA9CiAJCXRvX2ludGVsX2Ny
dGNfc3RhdGUoY3J0Yy0+c3RhdGUpOwogCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0
Y19zdGF0ZTsKKwlpbnQgcmV0OwogCiAJLyoKIAkgKiBXaGVuIGNydGMgaXMgaW5hY3RpdmUgb3Ig
dGhlcmUgaXMgYSBtb2Rlc2V0IHBlbmRpbmcsCkBAIC0xNDc1MiwxMSArMTQ3NTUsMTAgQEAgaW50
ZWxfbGVnYWN5X2N1cnNvcl91cGRhdGUoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJaWYgKHJl
dCkKIAkJZ290byBvdXRfdW5sb2NrOwogCi0JaW50ZWxfZmJfb2JqX2ZsdXNoKGludGVsX2ZiX29i
aihmYiksIE9SSUdJTl9GTElQKTsKLQotCW9sZF9mYiA9IG9sZF9wbGFuZV9zdGF0ZS0+ZmI7Ci0J
aTkxNV9nZW1fdHJhY2tfZmIoaW50ZWxfZmJfb2JqKG9sZF9mYiksIGludGVsX2ZiX29iaihmYiks
Ci0JCQkgIGludGVsX3BsYW5lLT5mcm9udGJ1ZmZlcl9iaXQpOworCWludGVsX2Zyb250YnVmZmVy
X2ZsdXNoKHRvX2ludGVsX2Zyb250YnVmZmVyKGZiKSwgT1JJR0lOX0ZMSVApOworCWludGVsX2Zy
b250YnVmZmVyX3RyYWNrKHRvX2ludGVsX2Zyb250YnVmZmVyKG9sZF9wbGFuZV9zdGF0ZS0+ZmIp
LAorCQkJCXRvX2ludGVsX2Zyb250YnVmZmVyKGZiKSwKKwkJCQlpbnRlbF9wbGFuZS0+ZnJvbnRi
dWZmZXJfYml0KTsKIAogCS8qIFN3YXAgcGxhbmUgc3RhdGUgKi8KIAlwbGFuZS0+c3RhdGUgPSBu
ZXdfcGxhbmVfc3RhdGU7CkBAIC0xNTUzNiwxNSArMTU1MzgsOSBAQCBzdGF0aWMgdm9pZCBpbnRl
bF9zZXR1cF9vdXRwdXRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHN0YXRp
YyB2b2lkIGludGVsX3VzZXJfZnJhbWVidWZmZXJfZGVzdHJveShzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYikKIHsKIAlzdHJ1Y3QgaW50ZWxfZnJhbWVidWZmZXIgKmludGVsX2ZiID0gdG9faW50
ZWxfZnJhbWVidWZmZXIoZmIpOwotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSBp
bnRlbF9mYl9vYmooZmIpOwogCiAJZHJtX2ZyYW1lYnVmZmVyX2NsZWFudXAoZmIpOwotCi0JaTkx
NV9nZW1fb2JqZWN0X2xvY2sob2JqKTsKLQlXQVJOX09OKCFvYmotPmZyYW1lYnVmZmVyX3JlZmVy
ZW5jZXMtLSk7Ci0JaTkxNV9nZW1fb2JqZWN0X3VubG9jayhvYmopOwotCi0JaTkxNV9nZW1fb2Jq
ZWN0X3B1dChvYmopOworCWludGVsX2Zyb250YnVmZmVyX3B1dChpbnRlbF9mYi0+ZnJvbnRidWZm
ZXIpOwogCiAJa2ZyZWUoaW50ZWxfZmIpOwogfQpAQCAtMTU1NzIsNyArMTU1NjgsNyBAQCBzdGF0
aWMgaW50IGludGVsX3VzZXJfZnJhbWVidWZmZXJfZGlydHkoc3RydWN0IGRybV9mcmFtZWJ1ZmZl
ciAqZmIsCiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IGludGVsX2ZiX29iaihm
Yik7CiAKIAlpOTE1X2dlbV9vYmplY3RfZmx1c2hfaWZfZGlzcGxheShvYmopOwotCWludGVsX2Zi
X29ial9mbHVzaChvYmosIE9SSUdJTl9ESVJUWUZCKTsKKwlpbnRlbF9mcm9udGJ1ZmZlcl9mbHVz
aCh0b19pbnRlbF9mcm9udGJ1ZmZlcihmYiksIE9SSUdJTl9ESVJUWUZCKTsKIAogCXJldHVybiAw
OwogfQpAQCAtMTU1OTQsOCArMTU1OTAsMTEgQEAgc3RhdGljIGludCBpbnRlbF9mcmFtZWJ1ZmZl
cl9pbml0KHN0cnVjdCBpbnRlbF9mcmFtZWJ1ZmZlciAqaW50ZWxfZmIsCiAJaW50IHJldCA9IC1F
SU5WQUw7CiAJaW50IGk7CiAKKwlpbnRlbF9mYi0+ZnJvbnRidWZmZXIgPSBpbnRlbF9mcm9udGJ1
ZmZlcl9nZXQob2JqKTsKKwlpZiAoIWludGVsX2ZiLT5mcm9udGJ1ZmZlcikKKwkJcmV0dXJuIC1F
Tk9NRU07CisKIAlpOTE1X2dlbV9vYmplY3RfbG9jayhvYmopOwotCW9iai0+ZnJhbWVidWZmZXJf
cmVmZXJlbmNlcysrOwogCXRpbGluZyA9IGk5MTVfZ2VtX29iamVjdF9nZXRfdGlsaW5nKG9iaik7
CiAJc3RyaWRlID0gaTkxNV9nZW1fb2JqZWN0X2dldF9zdHJpZGUob2JqKTsKIAlpOTE1X2dlbV9v
YmplY3RfdW5sb2NrKG9iaik7CkBAIC0xNTcxMiw5ICsxNTcxMSw3IEBAIHN0YXRpYyBpbnQgaW50
ZWxfZnJhbWVidWZmZXJfaW5pdChzdHJ1Y3QgaW50ZWxfZnJhbWVidWZmZXIgKmludGVsX2ZiLAog
CXJldHVybiAwOwogCiBlcnI6Ci0JaTkxNV9nZW1fb2JqZWN0X2xvY2sob2JqKTsKLQlvYmotPmZy
YW1lYnVmZmVyX3JlZmVyZW5jZXMtLTsKLQlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKG9iaik7CisJ
aW50ZWxfZnJvbnRidWZmZXJfcHV0KGludGVsX2ZiLT5mcm9udGJ1ZmZlcik7CiAJcmV0dXJuIHJl
dDsKIH0KIApAQCAtMTU3MzIsOCArMTU3MjksNyBAQCBpbnRlbF91c2VyX2ZyYW1lYnVmZmVyX2Ny
ZWF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogCQlyZXR1cm4gRVJSX1BUUigtRU5PRU5UKTsK
IAogCWZiID0gaW50ZWxfZnJhbWVidWZmZXJfY3JlYXRlKG9iaiwgJm1vZGVfY21kKTsKLQlpZiAo
SVNfRVJSKGZiKSkKLQkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCWk5MTVfZ2VtX29iamVj
dF9wdXQob2JqKTsKIAogCXJldHVybiBmYjsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJkZXYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZmJkZXYuYwppbmRleCAxZWRkNDRlZTMyYjIuLjRiNTdjZGQ3NjY5OSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmRldi5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJkZXYuYwpAQCAtNDcsMTMgKzQ3LDE0
IEBACiAjaW5jbHVkZSAiaW50ZWxfZmJkZXYuaCIKICNpbmNsdWRlICJpbnRlbF9mcm9udGJ1ZmZl
ci5oIgogCi1zdGF0aWMgdm9pZCBpbnRlbF9mYmRldl9pbnZhbGlkYXRlKHN0cnVjdCBpbnRlbF9m
YmRldiAqaWZiZGV2KQorc3RhdGljIHN0cnVjdCBpbnRlbF9mcm9udGJ1ZmZlciAqdG9fZnJvbnRi
dWZmZXIoc3RydWN0IGludGVsX2ZiZGV2ICppZmJkZXYpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaiA9IGludGVsX2ZiX29iaigmaWZiZGV2LT5mYi0+YmFzZSk7Ci0JdW5zaWdu
ZWQgaW50IG9yaWdpbiA9Ci0JCWlmYmRldi0+dm1hX2ZsYWdzICYgUExBTkVfSEFTX0ZFTkNFID8g
T1JJR0lOX0dUVCA6IE9SSUdJTl9DUFU7CisJcmV0dXJuIGlmYmRldi0+ZmItPmZyb250YnVmZmVy
OworfQogCi0JaW50ZWxfZmJfb2JqX2ludmFsaWRhdGUob2JqLCBvcmlnaW4pOworc3RhdGljIHZv
aWQgaW50ZWxfZmJkZXZfaW52YWxpZGF0ZShzdHJ1Y3QgaW50ZWxfZmJkZXYgKmlmYmRldikKK3sK
KwlpbnRlbF9mcm9udGJ1ZmZlcl9pbnZhbGlkYXRlKHRvX2Zyb250YnVmZmVyKGlmYmRldiksIE9S
SUdJTl9DUFUpOwogfQogCiBzdGF0aWMgaW50IGludGVsX2ZiZGV2X3NldF9wYXIoc3RydWN0IGZi
X2luZm8gKmluZm8pCkBAIC0xMjAsNyArMTIxLDcgQEAgc3RhdGljIGludCBpbnRlbGZiX2FsbG9j
KHN0cnVjdCBkcm1fZmJfaGVscGVyICpoZWxwZXIsCiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShkZXYpOwogCXN0cnVjdCBkcm1fbW9kZV9mYl9jbWQyIG1vZGVf
Y21kID0ge307CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKLQlpbnQgc2l6ZSwg
cmV0OworCWludCBzaXplOwogCiAJLyogd2UgZG9uJ3QgZG8gcGFja2VkIDI0YnBwICovCiAJaWYg
KHNpemVzLT5zdXJmYWNlX2JwcCA9PSAyNCkKQEAgLTE0NywyNCArMTQ4LDE2IEBAIHN0YXRpYyBp
bnQgaW50ZWxmYl9hbGxvYyhzdHJ1Y3QgZHJtX2ZiX2hlbHBlciAqaGVscGVyLAogCQlvYmogPSBp
OTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtKGRldl9wcml2LCBzaXplKTsKIAlpZiAoSVNfRVJS
KG9iaikpIHsKIAkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gYWxsb2NhdGUgZnJhbWVidWZmZXJcbiIp
OwotCQlyZXQgPSBQVFJfRVJSKG9iaik7Ci0JCWdvdG8gZXJyOworCQlyZXR1cm4gUFRSX0VSUihv
YmopOwogCX0KIAogCWZiID0gaW50ZWxfZnJhbWVidWZmZXJfY3JlYXRlKG9iaiwgJm1vZGVfY21k
KTsKLQlpZiAoSVNfRVJSKGZiKSkgewotCQlyZXQgPSBQVFJfRVJSKGZiKTsKLQkJZ290byBlcnJf
b2JqOwotCX0KKwlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CisJaWYgKElTX0VSUihmYikpCisJ
CXJldHVybiBQVFJfRVJSKGZiKTsKIAogCWlmYmRldi0+ZmIgPSB0b19pbnRlbF9mcmFtZWJ1ZmZl
cihmYik7Ci0KIAlyZXR1cm4gMDsKLQotZXJyX29iajoKLQlpOTE1X2dlbV9vYmplY3RfcHV0KG9i
aik7Ci1lcnI6Ci0JcmV0dXJuIHJldDsKIH0KIAogc3RhdGljIGludCBpbnRlbGZiX2NyZWF0ZShz
dHJ1Y3QgZHJtX2ZiX2hlbHBlciAqaGVscGVyLApAQCAtMTgwLDcgKzE3Myw2IEBAIHN0YXRpYyBp
bnQgaW50ZWxmYl9jcmVhdGUoc3RydWN0IGRybV9mYl9oZWxwZXIgKmhlbHBlciwKIAljb25zdCBz
dHJ1Y3QgaTkxNV9nZ3R0X3ZpZXcgdmlldyA9IHsKIAkJLnR5cGUgPSBJOTE1X0dHVFRfVklFV19O
T1JNQUwsCiAJfTsKLQlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYjsKIAlpbnRlbF93YWtlcmVm
X3Qgd2FrZXJlZjsKIAlzdHJ1Y3QgZmJfaW5mbyAqaW5mbzsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZt
YTsKQEAgLTIyNiw4ICsyMTgsNyBAQCBzdGF0aWMgaW50IGludGVsZmJfY3JlYXRlKHN0cnVjdCBk
cm1fZmJfaGVscGVyICpoZWxwZXIsCiAJCWdvdG8gb3V0X3VubG9jazsKIAl9CiAKLQlmYiA9ICZp
ZmJkZXYtPmZiLT5iYXNlOwotCWludGVsX2ZiX29ial9mbHVzaChpbnRlbF9mYl9vYmooZmIpLCBP
UklHSU5fRElSVFlGQik7CisJaW50ZWxfZnJvbnRidWZmZXJfZmx1c2godG9fZnJvbnRidWZmZXIo
aWZiZGV2KSwgT1JJR0lOX0RJUlRZRkIpOwogCiAJaW5mbyA9IGRybV9mYl9oZWxwZXJfYWxsb2Nf
ZmJpKGhlbHBlcik7CiAJaWYgKElTX0VSUihpbmZvKSkgewpAQCAtMjM2LDcgKzIyNyw3IEBAIHN0
YXRpYyBpbnQgaW50ZWxmYl9jcmVhdGUoc3RydWN0IGRybV9mYl9oZWxwZXIgKmhlbHBlciwKIAkJ
Z290byBvdXRfdW5waW47CiAJfQogCi0JaWZiZGV2LT5oZWxwZXIuZmIgPSBmYjsKKwlpZmJkZXYt
PmhlbHBlci5mYiA9ICZpZmJkZXYtPmZiLT5iYXNlOwogCiAJaW5mby0+ZmJvcHMgPSAmaW50ZWxm
Yl9vcHM7CiAKQEAgLTI2MiwxMyArMjUzLDE0IEBAIHN0YXRpYyBpbnQgaW50ZWxmYl9jcmVhdGUo
c3RydWN0IGRybV9mYl9oZWxwZXIgKmhlbHBlciwKIAkgKiBJZiB0aGUgb2JqZWN0IGlzIHN0b2xl
biBob3dldmVyLCBpdCB3aWxsIGJlIGZ1bGwgb2Ygd2hhdGV2ZXIKIAkgKiBnYXJiYWdlIHdhcyBs
ZWZ0IGluIHRoZXJlLgogCSAqLwotCWlmIChpbnRlbF9mYl9vYmooZmIpLT5zdG9sZW4gJiYgIXBy
ZWFsbG9jKQorCWlmICh2bWEtPm9iai0+c3RvbGVuICYmICFwcmVhbGxvYykKIAkJbWVtc2V0X2lv
KGluZm8tPnNjcmVlbl9iYXNlLCAwLCBpbmZvLT5zY3JlZW5fc2l6ZSk7CiAKIAkvKiBVc2UgZGVm
YXVsdCBzY3JhdGNoIHBpeG1hcCAoaW5mby0+cGl4bWFwLmZsYWdzID0gRkJfUElYTUFQX1NZU1RF
TSkgKi8KIAogCURSTV9ERUJVR19LTVMoImFsbG9jYXRlZCAlZHglZCBmYjogMHglMDh4XG4iLAot
CQkgICAgICBmYi0+d2lkdGgsIGZiLT5oZWlnaHQsIGk5MTVfZ2d0dF9vZmZzZXQodm1hKSk7CisJ
CSAgICAgIGlmYmRldi0+ZmItPmJhc2Uud2lkdGgsIGlmYmRldi0+ZmItPmJhc2UuaGVpZ2h0LAor
CQkgICAgICBpOTE1X2dndHRfb2Zmc2V0KHZtYSkpOwogCWlmYmRldi0+dm1hID0gdm1hOwogCWlm
YmRldi0+dm1hX2ZsYWdzID0gZmxhZ3M7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZnJvbnRidWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZnJvbnRidWZmZXIuYwppbmRleCA0NDI3M2MxMGNlYTUuLmQxMTAzMTgxMWE0
OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mcm9udGJ1
ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZnJvbnRidWZm
ZXIuYwpAQCAtMzAsMTEgKzMwLDExIEBACiAgKiBNYW55IGZlYXR1cmVzIHJlcXVpcmUgdXMgdG8g
dHJhY2sgY2hhbmdlcyB0byB0aGUgY3VycmVudGx5IGFjdGl2ZQogICogZnJvbnRidWZmZXIsIGVz
cGVjaWFsbHkgcmVuZGVyaW5nIHRhcmdldGVkIGF0IHRoZSBmcm9udGJ1ZmZlci4KICAqCi0gKiBU
byBiZSBhYmxlIHRvIGRvIHNvIEdFTSB0cmFja3MgZnJvbnRidWZmZXJzIHVzaW5nIGEgYml0bWFz
ayBmb3IgYWxsIHBvc3NpYmxlCi0gKiBmcm9udGJ1ZmZlciBzbG90cyB0aHJvdWdoIGk5MTVfZ2Vt
X3RyYWNrX2ZiKCkuIFRoZSBmdW5jdGlvbiBpbiB0aGlzIGZpbGUgYXJlCi0gKiB0aGVuIGNhbGxl
ZCB3aGVuIHRoZSBjb250ZW50cyBvZiB0aGUgZnJvbnRidWZmZXIgYXJlIGludmFsaWRhdGVkLCB3
aGVuCi0gKiBmcm9udGJ1ZmZlciByZW5kZXJpbmcgaGFzIHN0b3BwZWQgYWdhaW4gdG8gZmx1c2gg
b3V0IGFsbCB0aGUgY2hhbmdlcyBhbmQgd2hlbgotICogdGhlIGZyb250YnVmZmVyIGlzIGV4Y2hh
bmdlZCB3aXRoIGEgZmxpcC4gU3Vic3lzdGVtcyBpbnRlcmVzdGVkIGluCisgKiBUbyBiZSBhYmxl
IHRvIGRvIHNvIHdlIHRyYWNrIGZyb250YnVmZmVycyB1c2luZyBhIGJpdG1hc2sgZm9yIGFsbCBw
b3NzaWJsZQorICogZnJvbnRidWZmZXIgc2xvdHMgdGhyb3VnaCBpbnRlbF9mcm9udGJ1ZmZlcl90
cmFjaygpLiBUaGUgZnVuY3Rpb25zIGluIHRoaXMKKyAqIGZpbGUgYXJlIHRoZW4gY2FsbGVkIHdo
ZW4gdGhlIGNvbnRlbnRzIG9mIHRoZSBmcm9udGJ1ZmZlciBhcmUgaW52YWxpZGF0ZWQsCisgKiB3
aGVuIGZyb250YnVmZmVyIHJlbmRlcmluZyBoYXMgc3RvcHBlZCBhZ2FpbiB0byBmbHVzaCBvdXQg
YWxsIHRoZSBjaGFuZ2VzCisgKiBhbmQgd2hlbiB0aGUgZnJvbnRidWZmZXIgaXMgZXhjaGFuZ2Vk
IHdpdGggYSBmbGlwLiBTdWJzeXN0ZW1zIGludGVyZXN0ZWQgaW4KICAqIGZyb250YnVmZmVyIGNo
YW5nZXMgKGUuZy4gUFNSLCBGQkMsIERSUlMpIHNob3VsZCBkaXJlY3RseSBwdXQgdGhlaXIgY2Fs
bGJhY2tzCiAgKiBpbnRvIHRoZSByZWxldmFudCBwbGFjZXMgYW5kIGZpbHRlciBmb3IgdGhlIGZy
b250YnVmZmVyIHNsb3RzIHRoYXQgdGhleSBhcmUKICAqIGludGVyZXN0ZWQgaW50LgpAQCAtNjMs
MjggKzYzLDkgQEAKICNpbmNsdWRlICJpbnRlbF9mcm9udGJ1ZmZlci5oIgogI2luY2x1ZGUgImlu
dGVsX3Bzci5oIgogCi12b2lkIF9faW50ZWxfZmJfb2JqX2ludmFsaWRhdGUoc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaiwKLQkJCSAgICAgICBlbnVtIGZiX29wX29yaWdpbiBvcmlnaW4s
Ci0JCQkgICAgICAgdW5zaWduZWQgaW50IGZyb250YnVmZmVyX2JpdHMpCi17Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShvYmotPmJhc2UuZGV2KTsKLQotCWlm
IChvcmlnaW4gPT0gT1JJR0lOX0NTKSB7Ci0JCXNwaW5fbG9jaygmZGV2X3ByaXYtPmZiX3RyYWNr
aW5nLmxvY2spOwotCQlkZXZfcHJpdi0+ZmJfdHJhY2tpbmcuYnVzeV9iaXRzIHw9IGZyb250YnVm
ZmVyX2JpdHM7Ci0JCWRldl9wcml2LT5mYl90cmFja2luZy5mbGlwX2JpdHMgJj0gfmZyb250YnVm
ZmVyX2JpdHM7Ci0JCXNwaW5fdW5sb2NrKCZkZXZfcHJpdi0+ZmJfdHJhY2tpbmcubG9jayk7Ci0J
fQotCi0JbWlnaHRfc2xlZXAoKTsKLQlpbnRlbF9wc3JfaW52YWxpZGF0ZShkZXZfcHJpdiwgZnJv
bnRidWZmZXJfYml0cywgb3JpZ2luKTsKLQlpbnRlbF9lZHBfZHJyc19pbnZhbGlkYXRlKGRldl9w
cml2LCBmcm9udGJ1ZmZlcl9iaXRzKTsKLQlpbnRlbF9mYmNfaW52YWxpZGF0ZShkZXZfcHJpdiwg
ZnJvbnRidWZmZXJfYml0cywgb3JpZ2luKTsKLX0KLQogLyoqCi0gKiBpbnRlbF9mcm9udGJ1ZmZl
cl9mbHVzaCAtIGZsdXNoIGZyb250YnVmZmVyCi0gKiBAZGV2X3ByaXY6IGk5MTUgZGV2aWNlCisg
KiBmcm9udGJ1ZmZlcl9mbHVzaCAtIGZsdXNoIGZyb250YnVmZmVyCisgKiBAaTkxNTogaTkxNSBk
ZXZpY2UKICAqIEBmcm9udGJ1ZmZlcl9iaXRzOiBmcm9udGJ1ZmZlciBwbGFuZSB0cmFja2luZyBi
aXRzCiAgKiBAb3JpZ2luOiB3aGljaCBvcGVyYXRpb24gY2F1c2VkIHRoZSBmbHVzaAogICoKQEAg
LTk0LDQ1ICs3NSwyNyBAQCB2b2lkIF9faW50ZWxfZmJfb2JqX2ludmFsaWRhdGUoc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKICAqCiAgKiBDYW4gYmUgY2FsbGVkIHdpdGhvdXQgYW55
IGxvY2tzIGhlbGQuCiAgKi8KLXN0YXRpYyB2b2lkIGludGVsX2Zyb250YnVmZmVyX2ZsdXNoKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCQkgICAgdW5zaWduZWQgZnJvbnRi
dWZmZXJfYml0cywKLQkJCQkgICAgZW51bSBmYl9vcF9vcmlnaW4gb3JpZ2luKQorc3RhdGljIHZv
aWQgZnJvbnRidWZmZXJfZmx1c2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCisJCQkg
ICAgICB1bnNpZ25lZCBpbnQgZnJvbnRidWZmZXJfYml0cywKKwkJCSAgICAgIGVudW0gZmJfb3Bf
b3JpZ2luIG9yaWdpbikKIHsKIAkvKiBEZWxheSBmbHVzaGluZyB3aGVuIHJpbmdzIGFyZSBzdGls
bCBidXN5LiovCi0Jc3Bpbl9sb2NrKCZkZXZfcHJpdi0+ZmJfdHJhY2tpbmcubG9jayk7Ci0JZnJv
bnRidWZmZXJfYml0cyAmPSB+ZGV2X3ByaXYtPmZiX3RyYWNraW5nLmJ1c3lfYml0czsKLQlzcGlu
X3VubG9jaygmZGV2X3ByaXYtPmZiX3RyYWNraW5nLmxvY2spOworCXNwaW5fbG9jaygmaTkxNS0+
ZmJfdHJhY2tpbmcubG9jayk7CisJZnJvbnRidWZmZXJfYml0cyAmPSB+aTkxNS0+ZmJfdHJhY2tp
bmcuYnVzeV9iaXRzOworCXNwaW5fdW5sb2NrKCZpOTE1LT5mYl90cmFja2luZy5sb2NrKTsKIAog
CWlmICghZnJvbnRidWZmZXJfYml0cykKIAkJcmV0dXJuOwogCiAJbWlnaHRfc2xlZXAoKTsKLQlp
bnRlbF9lZHBfZHJyc19mbHVzaChkZXZfcHJpdiwgZnJvbnRidWZmZXJfYml0cyk7Ci0JaW50ZWxf
cHNyX2ZsdXNoKGRldl9wcml2LCBmcm9udGJ1ZmZlcl9iaXRzLCBvcmlnaW4pOwotCWludGVsX2Zi
Y19mbHVzaChkZXZfcHJpdiwgZnJvbnRidWZmZXJfYml0cywgb3JpZ2luKTsKLX0KLQotdm9pZCBf
X2ludGVsX2ZiX29ial9mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAotCQkJ
ICBlbnVtIGZiX29wX29yaWdpbiBvcmlnaW4sCi0JCQkgIHVuc2lnbmVkIGludCBmcm9udGJ1ZmZl
cl9iaXRzKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
b2JqLT5iYXNlLmRldik7Ci0KLQlpZiAob3JpZ2luID09IE9SSUdJTl9DUykgewotCQlzcGluX2xv
Y2soJmRldl9wcml2LT5mYl90cmFja2luZy5sb2NrKTsKLQkJLyogRmlsdGVyIG91dCBuZXcgYml0
cyBzaW5jZSByZW5kZXJpbmcgc3RhcnRlZC4gKi8KLQkJZnJvbnRidWZmZXJfYml0cyAmPSBkZXZf
cHJpdi0+ZmJfdHJhY2tpbmcuYnVzeV9iaXRzOwotCQlkZXZfcHJpdi0+ZmJfdHJhY2tpbmcuYnVz
eV9iaXRzICY9IH5mcm9udGJ1ZmZlcl9iaXRzOwotCQlzcGluX3VubG9jaygmZGV2X3ByaXYtPmZi
X3RyYWNraW5nLmxvY2spOwotCX0KLQotCWlmIChmcm9udGJ1ZmZlcl9iaXRzKQotCQlpbnRlbF9m
cm9udGJ1ZmZlcl9mbHVzaChkZXZfcHJpdiwgZnJvbnRidWZmZXJfYml0cywgb3JpZ2luKTsKKwlp
bnRlbF9lZHBfZHJyc19mbHVzaChpOTE1LCBmcm9udGJ1ZmZlcl9iaXRzKTsKKwlpbnRlbF9wc3Jf
Zmx1c2goaTkxNSwgZnJvbnRidWZmZXJfYml0cywgb3JpZ2luKTsKKwlpbnRlbF9mYmNfZmx1c2go
aTkxNSwgZnJvbnRidWZmZXJfYml0cywgb3JpZ2luKTsKIH0KIAogLyoqCiAgKiBpbnRlbF9mcm9u
dGJ1ZmZlcl9mbGlwX3ByZXBhcmUgLSBwcmVwYXJlIGFzeW5jaHJvbm91cyBmcm9udGJ1ZmZlciBm
bGlwCi0gKiBAZGV2X3ByaXY6IGk5MTUgZGV2aWNlCisgKiBAaTkxNTogaTkxNSBkZXZpY2UKICAq
IEBmcm9udGJ1ZmZlcl9iaXRzOiBmcm9udGJ1ZmZlciBwbGFuZSB0cmFja2luZyBiaXRzCiAgKgog
ICogVGhpcyBmdW5jdGlvbiBnZXRzIGNhbGxlZCBhZnRlciBzY2hlZHVsaW5nIGEgZmxpcCBvbiBA
b2JqLiBUaGUgYWN0dWFsCkBAIC0xNDIsMTkgKzEwNSwxOSBAQCB2b2lkIF9faW50ZWxfZmJfb2Jq
X2ZsdXNoKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAgKgogICogQ2FuIGJlIGNh
bGxlZCB3aXRob3V0IGFueSBsb2NrcyBoZWxkLgogICovCi12b2lkIGludGVsX2Zyb250YnVmZmVy
X2ZsaXBfcHJlcGFyZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2b2lkIGlu
dGVsX2Zyb250YnVmZmVyX2ZsaXBfcHJlcGFyZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKIAkJCQkgICAgdW5zaWduZWQgZnJvbnRidWZmZXJfYml0cykKIHsKLQlzcGluX2xvY2soJmRl
dl9wcml2LT5mYl90cmFja2luZy5sb2NrKTsKLQlkZXZfcHJpdi0+ZmJfdHJhY2tpbmcuZmxpcF9i
aXRzIHw9IGZyb250YnVmZmVyX2JpdHM7CisJc3Bpbl9sb2NrKCZpOTE1LT5mYl90cmFja2luZy5s
b2NrKTsKKwlpOTE1LT5mYl90cmFja2luZy5mbGlwX2JpdHMgfD0gZnJvbnRidWZmZXJfYml0czsK
IAkvKiBSZW1vdmUgc3RhbGUgYnVzeSBiaXRzIGR1ZSB0byB0aGUgb2xkIGJ1ZmZlci4gKi8KLQlk
ZXZfcHJpdi0+ZmJfdHJhY2tpbmcuYnVzeV9iaXRzICY9IH5mcm9udGJ1ZmZlcl9iaXRzOwotCXNw
aW5fdW5sb2NrKCZkZXZfcHJpdi0+ZmJfdHJhY2tpbmcubG9jayk7CisJaTkxNS0+ZmJfdHJhY2tp
bmcuYnVzeV9iaXRzICY9IH5mcm9udGJ1ZmZlcl9iaXRzOworCXNwaW5fdW5sb2NrKCZpOTE1LT5m
Yl90cmFja2luZy5sb2NrKTsKIH0KIAogLyoqCiAgKiBpbnRlbF9mcm9udGJ1ZmZlcl9mbGlwX2Nv
bXBsZXRlIC0gY29tcGxldGUgYXN5bmNocm9ub3VzIGZyb250YnVmZmVyIGZsaXAKLSAqIEBkZXZf
cHJpdjogaTkxNSBkZXZpY2UKKyAqIEBpOTE1OiBpOTE1IGRldmljZQogICogQGZyb250YnVmZmVy
X2JpdHM6IGZyb250YnVmZmVyIHBsYW5lIHRyYWNraW5nIGJpdHMKICAqCiAgKiBUaGlzIGZ1bmN0
aW9uIGdldHMgY2FsbGVkIGFmdGVyIHRoZSBmbGlwIGhhcyBiZWVuIGxhdGNoZWQgYW5kIHdpbGwg
Y29tcGxldGUKQEAgLTE2MiwyMyArMTI1LDIyIEBAIHZvaWQgaW50ZWxfZnJvbnRidWZmZXJfZmxp
cF9wcmVwYXJlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKICAqCiAgKiBDYW4g
YmUgY2FsbGVkIHdpdGhvdXQgYW55IGxvY2tzIGhlbGQuCiAgKi8KLXZvaWQgaW50ZWxfZnJvbnRi
dWZmZXJfZmxpcF9jb21wbGV0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCit2
b2lkIGludGVsX2Zyb250YnVmZmVyX2ZsaXBfY29tcGxldGUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCiAJCQkJICAgICB1bnNpZ25lZCBmcm9udGJ1ZmZlcl9iaXRzKQogewotCXNwaW5f
bG9jaygmZGV2X3ByaXYtPmZiX3RyYWNraW5nLmxvY2spOworCXNwaW5fbG9jaygmaTkxNS0+ZmJf
dHJhY2tpbmcubG9jayk7CiAJLyogTWFzayBhbnkgY2FuY2VsbGVkIGZsaXBzLiAqLwotCWZyb250
YnVmZmVyX2JpdHMgJj0gZGV2X3ByaXYtPmZiX3RyYWNraW5nLmZsaXBfYml0czsKLQlkZXZfcHJp
di0+ZmJfdHJhY2tpbmcuZmxpcF9iaXRzICY9IH5mcm9udGJ1ZmZlcl9iaXRzOwotCXNwaW5fdW5s
b2NrKCZkZXZfcHJpdi0+ZmJfdHJhY2tpbmcubG9jayk7CisJZnJvbnRidWZmZXJfYml0cyAmPSBp
OTE1LT5mYl90cmFja2luZy5mbGlwX2JpdHM7CisJaTkxNS0+ZmJfdHJhY2tpbmcuZmxpcF9iaXRz
ICY9IH5mcm9udGJ1ZmZlcl9iaXRzOworCXNwaW5fdW5sb2NrKCZpOTE1LT5mYl90cmFja2luZy5s
b2NrKTsKIAogCWlmIChmcm9udGJ1ZmZlcl9iaXRzKQotCQlpbnRlbF9mcm9udGJ1ZmZlcl9mbHVz
aChkZXZfcHJpdiwKLQkJCQkJZnJvbnRidWZmZXJfYml0cywgT1JJR0lOX0ZMSVApOworCQlmcm9u
dGJ1ZmZlcl9mbHVzaChpOTE1LCBmcm9udGJ1ZmZlcl9iaXRzLCBPUklHSU5fRkxJUCk7CiB9CiAK
IC8qKgogICogaW50ZWxfZnJvbnRidWZmZXJfZmxpcCAtIHN5bmNocm9ub3VzIGZyb250YnVmZmVy
IGZsaXAKLSAqIEBkZXZfcHJpdjogaTkxNSBkZXZpY2UKKyAqIEBpOTE1OiBpOTE1IGRldmljZQog
ICogQGZyb250YnVmZmVyX2JpdHM6IGZyb250YnVmZmVyIHBsYW5lIHRyYWNraW5nIGJpdHMKICAq
CiAgKiBUaGlzIGZ1bmN0aW9uIGdldHMgY2FsbGVkIGFmdGVyIHNjaGVkdWxpbmcgYSBmbGlwIG9u
IEBvYmouIFRoaXMgaXMgZm9yCkBAIC0xODcsMTMgKzE0OSwxNjAgQEAgdm9pZCBpbnRlbF9mcm9u
dGJ1ZmZlcl9mbGlwX2NvbXBsZXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwK
ICAqCiAgKiBDYW4gYmUgY2FsbGVkIHdpdGhvdXQgYW55IGxvY2tzIGhlbGQuCiAgKi8KLXZvaWQg
aW50ZWxfZnJvbnRidWZmZXJfZmxpcChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
Cit2b2lkIGludGVsX2Zyb250YnVmZmVyX2ZsaXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJCQkgICAgdW5zaWduZWQgZnJvbnRidWZmZXJfYml0cykKIHsKLQlzcGluX2xvY2soJmRl
dl9wcml2LT5mYl90cmFja2luZy5sb2NrKTsKKwlzcGluX2xvY2soJmk5MTUtPmZiX3RyYWNraW5n
LmxvY2spOwogCS8qIFJlbW92ZSBzdGFsZSBidXN5IGJpdHMgZHVlIHRvIHRoZSBvbGQgYnVmZmVy
LiAqLwotCWRldl9wcml2LT5mYl90cmFja2luZy5idXN5X2JpdHMgJj0gfmZyb250YnVmZmVyX2Jp
dHM7Ci0Jc3Bpbl91bmxvY2soJmRldl9wcml2LT5mYl90cmFja2luZy5sb2NrKTsKKwlpOTE1LT5m
Yl90cmFja2luZy5idXN5X2JpdHMgJj0gfmZyb250YnVmZmVyX2JpdHM7CisJc3Bpbl91bmxvY2so
Jmk5MTUtPmZiX3RyYWNraW5nLmxvY2spOwogCi0JaW50ZWxfZnJvbnRidWZmZXJfZmx1c2goZGV2
X3ByaXYsIGZyb250YnVmZmVyX2JpdHMsIE9SSUdJTl9GTElQKTsKKwlmcm9udGJ1ZmZlcl9mbHVz
aChpOTE1LCBmcm9udGJ1ZmZlcl9iaXRzLCBPUklHSU5fRkxJUCk7Cit9CisKK3ZvaWQgX19pbnRl
bF9mYl9pbnZhbGlkYXRlKHN0cnVjdCBpbnRlbF9mcm9udGJ1ZmZlciAqZnJvbnQsCisJCQkgICBl
bnVtIGZiX29wX29yaWdpbiBvcmlnaW4sCisJCQkgICB1bnNpZ25lZCBpbnQgZnJvbnRidWZmZXJf
Yml0cykKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZnJvbnQt
Pm9iai0+YmFzZS5kZXYpOworCisJaWYgKG9yaWdpbiA9PSBPUklHSU5fQ1MpIHsKKwkJc3Bpbl9s
b2NrKCZpOTE1LT5mYl90cmFja2luZy5sb2NrKTsKKwkJaTkxNS0+ZmJfdHJhY2tpbmcuYnVzeV9i
aXRzIHw9IGZyb250YnVmZmVyX2JpdHM7CisJCWk5MTUtPmZiX3RyYWNraW5nLmZsaXBfYml0cyAm
PSB+ZnJvbnRidWZmZXJfYml0czsKKwkJc3Bpbl91bmxvY2soJmk5MTUtPmZiX3RyYWNraW5nLmxv
Y2spOworCX0KKworCW1pZ2h0X3NsZWVwKCk7CisJaW50ZWxfcHNyX2ludmFsaWRhdGUoaTkxNSwg
ZnJvbnRidWZmZXJfYml0cywgb3JpZ2luKTsKKwlpbnRlbF9lZHBfZHJyc19pbnZhbGlkYXRlKGk5
MTUsIGZyb250YnVmZmVyX2JpdHMpOworCWludGVsX2ZiY19pbnZhbGlkYXRlKGk5MTUsIGZyb250
YnVmZmVyX2JpdHMsIG9yaWdpbik7Cit9CisKK3ZvaWQgX19pbnRlbF9mYl9mbHVzaChzdHJ1Y3Qg
aW50ZWxfZnJvbnRidWZmZXIgKmZyb250LAorCQkgICAgICBlbnVtIGZiX29wX29yaWdpbiBvcmln
aW4sCisJCSAgICAgIHVuc2lnbmVkIGludCBmcm9udGJ1ZmZlcl9iaXRzKQoreworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShmcm9udC0+b2JqLT5iYXNlLmRldik7CisK
KwlpZiAob3JpZ2luID09IE9SSUdJTl9DUykgeworCQlzcGluX2xvY2soJmk5MTUtPmZiX3RyYWNr
aW5nLmxvY2spOworCQkvKiBGaWx0ZXIgb3V0IG5ldyBiaXRzIHNpbmNlIHJlbmRlcmluZyBzdGFy
dGVkLiAqLworCQlmcm9udGJ1ZmZlcl9iaXRzICY9IGk5MTUtPmZiX3RyYWNraW5nLmJ1c3lfYml0
czsKKwkJaTkxNS0+ZmJfdHJhY2tpbmcuYnVzeV9iaXRzICY9IH5mcm9udGJ1ZmZlcl9iaXRzOwor
CQlzcGluX3VubG9jaygmaTkxNS0+ZmJfdHJhY2tpbmcubG9jayk7CisJfQorCisJaWYgKGZyb250
YnVmZmVyX2JpdHMpCisJCWZyb250YnVmZmVyX2ZsdXNoKGk5MTUsIGZyb250YnVmZmVyX2JpdHMs
IG9yaWdpbik7Cit9CisKK3N0YXRpYyBpbnQgZnJvbnRidWZmZXJfYWN0aXZlKHN0cnVjdCBpOTE1
X2FjdGl2ZSAqcmVmKQoreworCXN0cnVjdCBpbnRlbF9mcm9udGJ1ZmZlciAqZnJvbnQgPQorCQlj
b250YWluZXJfb2YocmVmLCB0eXBlb2YoKmZyb250KSwgd3JpdGUpOworCisJa3JlZl9nZXQoJmZy
b250LT5yZWYpOworCXJldHVybiAwOworfQorCitzdGF0aWMgdm9pZCBmcm9udGJ1ZmZlcl9yZXRp
cmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCit7CisJc3RydWN0IGludGVsX2Zyb250YnVmZmVy
ICpmcm9udCA9CisJCWNvbnRhaW5lcl9vZihyZWYsIHR5cGVvZigqZnJvbnQpLCB3cml0ZSk7CisK
KwlpbnRlbF9mcm9udGJ1ZmZlcl9mbHVzaChmcm9udCwgT1JJR0lOX0NTKTsKKwlpbnRlbF9mcm9u
dGJ1ZmZlcl9wdXQoZnJvbnQpOworfQorCitzdGF0aWMgdm9pZCBmcm9udGJ1ZmZlcl9yZWxlYXNl
KHN0cnVjdCBrcmVmICpyZWYpCisJX19yZWxlYXNlcygmdG9faTkxNShmcm9udC0+b2JqLT5iYXNl
LmRldiktPmZiX3RyYWNraW5nLmxvY2spCit7CisJc3RydWN0IGludGVsX2Zyb250YnVmZmVyICpm
cm9udCA9CisJCWNvbnRhaW5lcl9vZihyZWYsIHR5cGVvZigqZnJvbnQpLCByZWYpOworCisJZnJv
bnQtPm9iai0+ZnJvbnRidWZmZXIgPSBOVUxMOworCXNwaW5fdW5sb2NrKCZ0b19pOTE1KGZyb250
LT5vYmotPmJhc2UuZGV2KS0+ZmJfdHJhY2tpbmcubG9jayk7CisKKwlpOTE1X2dlbV9vYmplY3Rf
cHV0KGZyb250LT5vYmopOworCWtmcmVlKGZyb250KTsKK30KKworc3RydWN0IGludGVsX2Zyb250
YnVmZmVyICoKK2ludGVsX2Zyb250YnVmZmVyX2dldChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShvYmot
PmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfZnJvbnRidWZmZXIgKmZyb250OworCisJc3Bpbl9s
b2NrKCZpOTE1LT5mYl90cmFja2luZy5sb2NrKTsKKwlmcm9udCA9IG9iai0+ZnJvbnRidWZmZXI7
CisJaWYgKGZyb250KQorCQlrcmVmX2dldCgmZnJvbnQtPnJlZik7CisJc3Bpbl91bmxvY2soJmk5
MTUtPmZiX3RyYWNraW5nLmxvY2spOworCWlmIChmcm9udCkKKwkJcmV0dXJuIGZyb250OworCisJ
ZnJvbnQgPSBrbWFsbG9jKHNpemVvZigqZnJvbnQpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWZyb250
KQorCQlyZXR1cm4gTlVMTDsKKworCWZyb250LT5vYmogPSBvYmo7CisJa3JlZl9pbml0KCZmcm9u
dC0+cmVmKTsKKwlhdG9taWNfc2V0KCZmcm9udC0+Yml0cywgMCk7CisJaTkxNV9hY3RpdmVfaW5p
dChpOTE1LCAmZnJvbnQtPndyaXRlLAorCQkJIGZyb250YnVmZmVyX2FjdGl2ZSwgZnJvbnRidWZm
ZXJfcmV0aXJlKTsKKworCXNwaW5fbG9jaygmaTkxNS0+ZmJfdHJhY2tpbmcubG9jayk7CisJaWYg
KG9iai0+ZnJvbnRidWZmZXIpIHsKKwkJa2ZyZWUoZnJvbnQpOworCQlmcm9udCA9IG9iai0+ZnJv
bnRidWZmZXI7CisJCWtyZWZfZ2V0KCZmcm9udC0+cmVmKTsKKwl9IGVsc2UgeworCQlpOTE1X2dl
bV9vYmplY3RfZ2V0KG9iaik7CisJCW9iai0+ZnJvbnRidWZmZXIgPSBmcm9udDsKKwl9CisJc3Bp
bl91bmxvY2soJmk5MTUtPmZiX3RyYWNraW5nLmxvY2spOworCisJcmV0dXJuIGZyb250OworfQor
Cit2b2lkIGludGVsX2Zyb250YnVmZmVyX3B1dChzdHJ1Y3QgaW50ZWxfZnJvbnRidWZmZXIgKmZy
b250KQoreworCWtyZWZfcHV0X2xvY2soJmZyb250LT5yZWYsCisJCSAgICAgIGZyb250YnVmZmVy
X3JlbGVhc2UsCisJCSAgICAgICZ0b19pOTE1KGZyb250LT5vYmotPmJhc2UuZGV2KS0+ZmJfdHJh
Y2tpbmcubG9jayk7Cit9CisKKy8qKgorICogaW50ZWxfZnJvbnRidWZmZXJfdHJhY2sgLSB1cGRh
dGUgZnJvbnRidWZmZXIgdHJhY2tpbmcKKyAqIEBvbGQ6IGN1cnJlbnQgYnVmZmVyIGZvciB0aGUg
ZnJvbnRidWZmZXIgc2xvdHMKKyAqIEBuZXc6IG5ldyBidWZmZXIgZm9yIHRoZSBmcm9udGJ1ZmZl
ciBzbG90cworICogQGZyb250YnVmZmVyX2JpdHM6IGJpdG1hc2sgb2YgZnJvbnRidWZmZXIgc2xv
dHMKKyAqCisgKiBUaGlzIHVwZGF0ZXMgdGhlIGZyb250YnVmZmVyIHRyYWNraW5nIGJpdHMgQGZy
b250YnVmZmVyX2JpdHMgYnkgY2xlYXJpbmcgdGhlbQorICogZnJvbSBAb2xkIGFuZCBzZXR0aW5n
IHRoZW0gaW4gQG5ldy4gQm90aCBAb2xkIGFuZCBAbmV3IGNhbiBiZSBOVUxMLgorICovCit2b2lk
IGludGVsX2Zyb250YnVmZmVyX3RyYWNrKHN0cnVjdCBpbnRlbF9mcm9udGJ1ZmZlciAqb2xkLAor
CQkJICAgICBzdHJ1Y3QgaW50ZWxfZnJvbnRidWZmZXIgKm5ldywKKwkJCSAgICAgdW5zaWduZWQg
aW50IGZyb250YnVmZmVyX2JpdHMpCit7CisJLyoKKwkgKiBDb250cm9sIG9mIGluZGl2aWR1YWwg
Yml0cyB3aXRoaW4gdGhlIG1hc2sgYXJlIGd1YXJkZWQgYnkKKwkgKiB0aGUgb3duaW5nIHBsYW5l
LT5tdXRleCwgaS5lLiB3ZSBjYW4gbmV2ZXIgc2VlIGNvbmN1cnJlbnQKKwkgKiBtYW5pcHVsYXRp
b24gb2YgaW5kaXZpZHVhbCBiaXRzLiBCdXQgc2luY2UgdGhlIGJpdGZpZWxkIGFzIGEgd2hvbGUK
KwkgKiBpcyB1cGRhdGVkIHVzaW5nIFJNVywgd2UgbmVlZCB0byB1c2UgYXRvbWljcyBpbiBvcmRl
ciB0byB1cGRhdGUKKwkgKiB0aGUgYml0cy4KKwkgKi8KKwlCVUlMRF9CVUdfT04oSU5URUxfRlJP
TlRCVUZGRVJfQklUU19QRVJfUElQRSAqIEk5MTVfTUFYX1BJUEVTID4KKwkJICAgICBCSVRTX1BF
Ul9UWVBFKGF0b21pY190KSk7CisKKwlpZiAob2xkKSB7CisJCVdBUk5fT04oIShhdG9taWNfcmVh
ZCgmb2xkLT5iaXRzKSAmIGZyb250YnVmZmVyX2JpdHMpKTsKKwkJYXRvbWljX2FuZG5vdChmcm9u
dGJ1ZmZlcl9iaXRzLCAmb2xkLT5iaXRzKTsKKwl9CisKKwlpZiAobmV3KSB7CisJCVdBUk5fT04o
YXRvbWljX3JlYWQoJm5ldy0+Yml0cykgJiBmcm9udGJ1ZmZlcl9iaXRzKTsKKwkJYXRvbWljX29y
KGZyb250YnVmZmVyX2JpdHMsICZuZXctPmJpdHMpOworCX0KIH0KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZnJvbnRidWZmZXIuaCBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZnJvbnRidWZmZXIuaAppbmRleCA1NzI3MzIwYzgwODQu
LmFkYzY0ZDYxYTRhNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9mcm9udGJ1ZmZlci5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZnJvbnRidWZmZXIuaApAQCAtMjQsNyArMjQsMTAgQEAKICNpZm5kZWYgX19JTlRFTF9GUk9O
VEJVRkZFUl9IX18KICNkZWZpbmUgX19JTlRFTF9GUk9OVEJVRkZFUl9IX18KIAotI2luY2x1ZGUg
ImdlbS9pOTE1X2dlbV9vYmplY3QuaCIKKyNpbmNsdWRlIDxsaW51eC9hdG9taWMuaD4KKyNpbmNs
dWRlIDxsaW51eC9rcmVmLmg+CisKKyNpbmNsdWRlICJpOTE1X2FjdGl2ZS5oIgogCiBzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZTsKIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0OwpAQCAtMzcsMjMg
KzQwLDMwIEBAIGVudW0gZmJfb3Bfb3JpZ2luIHsKIAlPUklHSU5fRElSVFlGQiwKIH07CiAKLXZv
aWQgaW50ZWxfZnJvbnRidWZmZXJfZmxpcF9wcmVwYXJlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKK3N0cnVjdCBpbnRlbF9mcm9udGJ1ZmZlciB7CisJc3RydWN0IGtyZWYgcmVm
OworCWF0b21pY190IGJpdHM7CisJc3RydWN0IGk5MTVfYWN0aXZlIHdyaXRlOworCXN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7Cit9OworCit2b2lkIGludGVsX2Zyb250YnVmZmVyX2Zs
aXBfcHJlcGFyZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkgICAgdW5zaWdu
ZWQgZnJvbnRidWZmZXJfYml0cyk7Ci12b2lkIGludGVsX2Zyb250YnVmZmVyX2ZsaXBfY29tcGxl
dGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAordm9pZCBpbnRlbF9mcm9udGJ1
ZmZlcl9mbGlwX2NvbXBsZXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCSAg
ICAgdW5zaWduZWQgZnJvbnRidWZmZXJfYml0cyk7Ci12b2lkIGludGVsX2Zyb250YnVmZmVyX2Zs
aXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAordm9pZCBpbnRlbF9mcm9udGJ1
ZmZlcl9mbGlwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJICAgIHVuc2lnbmVk
IGZyb250YnVmZmVyX2JpdHMpOwogCi12b2lkIF9faW50ZWxfZmJfb2JqX2ludmFsaWRhdGUoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKLQkJCSAgICAgICBlbnVtIGZiX29wX29yaWdp
biBvcmlnaW4sCi0JCQkgICAgICAgdW5zaWduZWQgaW50IGZyb250YnVmZmVyX2JpdHMpOwotdm9p
ZCBfX2ludGVsX2ZiX29ial9mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAot
CQkJICBlbnVtIGZiX29wX29yaWdpbiBvcmlnaW4sCi0JCQkgIHVuc2lnbmVkIGludCBmcm9udGJ1
ZmZlcl9iaXRzKTsKK3N0cnVjdCBpbnRlbF9mcm9udGJ1ZmZlciAqCitpbnRlbF9mcm9udGJ1ZmZl
cl9nZXQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaik7CisKK3ZvaWQgX19pbnRlbF9m
Yl9pbnZhbGlkYXRlKHN0cnVjdCBpbnRlbF9mcm9udGJ1ZmZlciAqZnJvbnQsCisJCQkgICBlbnVt
IGZiX29wX29yaWdpbiBvcmlnaW4sCisJCQkgICB1bnNpZ25lZCBpbnQgZnJvbnRidWZmZXJfYml0
cyk7CiAKIC8qKgotICogaW50ZWxfZmJfb2JqX2ludmFsaWRhdGUgLSBpbnZhbGlkYXRlIGZyb250
YnVmZmVyIG9iamVjdAotICogQG9iajogR0VNIG9iamVjdCB0byBpbnZhbGlkYXRlCisgKiBpbnRl
bF9mcm9udGJ1ZmZlcl9pbnZhbGlkYXRlIC0gaW52YWxpZGF0ZSBmcm9udGJ1ZmZlciBvYmplY3QK
KyAqIEBmcm9udDogR0VNIG9iamVjdCB0byBpbnZhbGlkYXRlCiAgKiBAb3JpZ2luOiB3aGljaCBv
cGVyYXRpb24gY2F1c2VkIHRoZSBpbnZhbGlkYXRpb24KICAqCiAgKiBUaGlzIGZ1bmN0aW9uIGdl
dHMgY2FsbGVkIGV2ZXJ5IHRpbWUgcmVuZGVyaW5nIG9uIHRoZSBnaXZlbiBvYmplY3Qgc3RhcnRz
IGFuZApAQCAtNjIsMzcgKzcyLDUzIEBAIHZvaWQgX19pbnRlbF9mYl9vYmpfZmx1c2goc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKICAqIHVudGlsIHRoZSByZW5kZXJpbmcgY29tcGxl
dGVzIG9yIGEgZmxpcCBvbiB0aGlzIGZyb250YnVmZmVyIHBsYW5lIGlzCiAgKiBzY2hlZHVsZWQu
CiAgKi8KLXN0YXRpYyBpbmxpbmUgYm9vbCBpbnRlbF9mYl9vYmpfaW52YWxpZGF0ZShzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAotCQkJCQkgICBlbnVtIGZiX29wX29yaWdpbiBvcmln
aW4pCitzdGF0aWMgaW5saW5lIGJvb2wgaW50ZWxfZnJvbnRidWZmZXJfaW52YWxpZGF0ZShzdHJ1
Y3QgaW50ZWxfZnJvbnRidWZmZXIgKmZyb250LAorCQkJCQkJZW51bSBmYl9vcF9vcmlnaW4gb3Jp
Z2luKQogewogCXVuc2lnbmVkIGludCBmcm9udGJ1ZmZlcl9iaXRzOwogCi0JZnJvbnRidWZmZXJf
Yml0cyA9IGF0b21pY19yZWFkKCZvYmotPmZyb250YnVmZmVyX2JpdHMpOworCWlmICghZnJvbnQp
CisJCXJldHVybiBmYWxzZTsKKworCWZyb250YnVmZmVyX2JpdHMgPSBhdG9taWNfcmVhZCgmZnJv
bnQtPmJpdHMpOwogCWlmICghZnJvbnRidWZmZXJfYml0cykKIAkJcmV0dXJuIGZhbHNlOwogCi0J
X19pbnRlbF9mYl9vYmpfaW52YWxpZGF0ZShvYmosIG9yaWdpbiwgZnJvbnRidWZmZXJfYml0cyk7
CisJX19pbnRlbF9mYl9pbnZhbGlkYXRlKGZyb250LCBvcmlnaW4sIGZyb250YnVmZmVyX2JpdHMp
OwogCXJldHVybiB0cnVlOwogfQogCit2b2lkIF9faW50ZWxfZmJfZmx1c2goc3RydWN0IGludGVs
X2Zyb250YnVmZmVyICpmcm9udCwKKwkJICAgICAgZW51bSBmYl9vcF9vcmlnaW4gb3JpZ2luLAor
CQkgICAgICB1bnNpZ25lZCBpbnQgZnJvbnRidWZmZXJfYml0cyk7CisKIC8qKgotICogaW50ZWxf
ZmJfb2JqX2ZsdXNoIC0gZmx1c2ggZnJvbnRidWZmZXIgb2JqZWN0Ci0gKiBAb2JqOiBHRU0gb2Jq
ZWN0IHRvIGZsdXNoCisgKiBpbnRlbF9mcm9udGJ1ZmZlcl9mbHVzaCAtIGZsdXNoIGZyb250YnVm
ZmVyIG9iamVjdAorICogQGZyb250OiBHRU0gb2JqZWN0IHRvIGZsdXNoCiAgKiBAb3JpZ2luOiB3
aGljaCBvcGVyYXRpb24gY2F1c2VkIHRoZSBmbHVzaAogICoKICAqIFRoaXMgZnVuY3Rpb24gZ2V0
cyBjYWxsZWQgZXZlcnkgdGltZSByZW5kZXJpbmcgb24gdGhlIGdpdmVuIG9iamVjdCBoYXMKICAq
IGNvbXBsZXRlZCBhbmQgZnJvbnRidWZmZXIgY2FjaGluZyBjYW4gYmUgc3RhcnRlZCBhZ2Fpbi4K
ICAqLwotc3RhdGljIGlubGluZSB2b2lkIGludGVsX2ZiX29ial9mbHVzaChzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqLAotCQkJCSAgICAgIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbikK
K3N0YXRpYyBpbmxpbmUgdm9pZCBpbnRlbF9mcm9udGJ1ZmZlcl9mbHVzaChzdHJ1Y3QgaW50ZWxf
ZnJvbnRidWZmZXIgKmZyb250LAorCQkJCQkgICBlbnVtIGZiX29wX29yaWdpbiBvcmlnaW4pCiB7
CiAJdW5zaWduZWQgaW50IGZyb250YnVmZmVyX2JpdHM7CiAKLQlmcm9udGJ1ZmZlcl9iaXRzID0g
YXRvbWljX3JlYWQoJm9iai0+ZnJvbnRidWZmZXJfYml0cyk7CisJaWYgKCFmcm9udCkKKwkJcmV0
dXJuOworCisJZnJvbnRidWZmZXJfYml0cyA9IGF0b21pY19yZWFkKCZmcm9udC0+Yml0cyk7CiAJ
aWYgKCFmcm9udGJ1ZmZlcl9iaXRzKQogCQlyZXR1cm47CiAKLQlfX2ludGVsX2ZiX29ial9mbHVz
aChvYmosIG9yaWdpbiwgZnJvbnRidWZmZXJfYml0cyk7CisJX19pbnRlbF9mYl9mbHVzaChmcm9u
dCwgb3JpZ2luLCBmcm9udGJ1ZmZlcl9iaXRzKTsKIH0KIAordm9pZCBpbnRlbF9mcm9udGJ1ZmZl
cl90cmFjayhzdHJ1Y3QgaW50ZWxfZnJvbnRidWZmZXIgKm9sZCwKKwkJCSAgICAgc3RydWN0IGlu
dGVsX2Zyb250YnVmZmVyICpuZXcsCisJCQkgICAgIHVuc2lnbmVkIGludCBmcm9udGJ1ZmZlcl9i
aXRzKTsKKwordm9pZCBpbnRlbF9mcm9udGJ1ZmZlcl9wdXQoc3RydWN0IGludGVsX2Zyb250YnVm
ZmVyICpmcm9udCk7CisKICNlbmRpZiAvKiBfX0lOVEVMX0ZST05UQlVGRkVSX0hfXyAqLwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYwppbmRleCA5YjNmNGY2
NjQ0ZjMuLjFhMTVmYTM0MjA1YyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9vdmVybGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9vdmVybGF5LmMKQEAgLTI4MSw5ICsyODEsOSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9vdmVy
bGF5X2ZsaXBfcHJlcGFyZShzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3ZlcmxheSwKIAogCVdBUk5f
T04ob3ZlcmxheS0+b2xkX3ZtYSk7CiAKLQlpOTE1X2dlbV90cmFja19mYihvdmVybGF5LT52bWEg
PyBvdmVybGF5LT52bWEtPm9iaiA6IE5VTEwsCi0JCQkgIHZtYSA/IHZtYS0+b2JqIDogTlVMTCwK
LQkJCSAgSU5URUxfRlJPTlRCVUZGRVJfT1ZFUkxBWShwaXBlKSk7CisJaW50ZWxfZnJvbnRidWZm
ZXJfdHJhY2sob3ZlcmxheS0+dm1hID8gb3ZlcmxheS0+dm1hLT5vYmotPmZyb250YnVmZmVyIDog
TlVMTCwKKwkJCQl2bWEgPyB2bWEtPm9iai0+ZnJvbnRidWZmZXIgOiBOVUxMLAorCQkJCUlOVEVM
X0ZST05UQlVGRkVSX09WRVJMQVkocGlwZSkpOwogCiAJaW50ZWxfZnJvbnRidWZmZXJfZmxpcF9w
cmVwYXJlKG92ZXJsYXktPmk5MTUsCiAJCQkJICAgICAgIElOVEVMX0ZST05UQlVGRkVSX09WRVJM
QVkocGlwZSkpOwpAQCAtNzY4LDcgKzc2OCw3IEBAIHN0YXRpYyBpbnQgaW50ZWxfb3ZlcmxheV9k
b19wdXRfaW1hZ2Uoc3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJsYXksCiAJCXJldCA9IFBUUl9F
UlIodm1hKTsKIAkJZ290byBvdXRfcGluX3NlY3Rpb247CiAJfQotCWludGVsX2ZiX29ial9mbHVz
aChuZXdfYm8sIE9SSUdJTl9ESVJUWUZCKTsKKwlpbnRlbF9mcm9udGJ1ZmZlcl9mbHVzaChuZXdf
Ym8tPmZyb250YnVmZmVyLCBPUklHSU5fRElSVFlGQik7CiAKIAlyZXQgPSBpOTE1X3ZtYV9wdXRf
ZmVuY2Uodm1hKTsKIAlpZiAocmV0KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX2NsZmx1c2guYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9jbGZsdXNoLmMKaW5kZXggNTI5NTI4NWQ1ODQzLi5hNjVkNDAxZjg5MWMgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGZsdXNoLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsZmx1c2guYwpAQCAtNDgsNyArNDgsNyBAQCBz
dGF0aWMgdm9pZCBfX2k5MTVfZG9fY2xmbHVzaChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqKQogewogCUdFTV9CVUdfT04oIWk5MTVfZ2VtX29iamVjdF9oYXNfcGFnZXMob2JqKSk7CiAJ
ZHJtX2NsZmx1c2hfc2cob2JqLT5tbS5wYWdlcyk7Ci0JaW50ZWxfZmJfb2JqX2ZsdXNoKG9iaiwg
T1JJR0lOX0NQVSk7CisJaW50ZWxfZnJvbnRidWZmZXJfZmx1c2gob2JqLT5mcm9udGJ1ZmZlciwg
T1JJR0lOX0NQVSk7CiB9CiAKIHN0YXRpYyB2b2lkIGk5MTVfY2xmbHVzaF93b3JrKHN0cnVjdCB3
b3JrX3N0cnVjdCAqd29yaykKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9kb21haW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21h
aW4uYwppbmRleCAyZTNjZTJhNjk2NTMuLmExYWZjMjY5MGU5ZSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYwpAQCAtNTUxLDEzICs1NTEsNiBAQCBpOTE1X2dl
bV9vYmplY3Rfc2V0X3RvX2NwdV9kb21haW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9i
aiwgYm9vbCB3cml0ZSkKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIGlubGluZSBlbnVtIGZiX29w
X29yaWdpbgotZmJfd3JpdGVfb3JpZ2luKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmos
IHVuc2lnbmVkIGludCBkb21haW4pCi17Ci0JcmV0dXJuIChkb21haW4gPT0gSTkxNV9HRU1fRE9N
QUlOX0dUVCA/Ci0JCW9iai0+ZnJvbnRidWZmZXJfZ2d0dF9vcmlnaW4gOiBPUklHSU5fQ1BVKTsK
LX0KLQogLyoqCiAgKiBDYWxsZWQgd2hlbiB1c2VyIHNwYWNlIHByZXBhcmVzIHRvIHVzZSBhbiBv
YmplY3Qgd2l0aCB0aGUgQ1BVLCBlaXRoZXIKICAqIHRocm91Z2ggdGhlIG1tYXAgaW9jdGwncyBt
YXBwaW5nIG9yIGEgR1RUIG1hcHBpbmcuCkBAIC02NjEsOSArNjU0LDggQEAgaTkxNV9nZW1fc2V0
X2RvbWFpbl9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCiAJaTkx
NV9nZW1fb2JqZWN0X3VubG9jayhvYmopOwogCi0JaWYgKHdyaXRlX2RvbWFpbiAhPSAwKQotCQlp
bnRlbF9mYl9vYmpfaW52YWxpZGF0ZShvYmosCi0JCQkJCWZiX3dyaXRlX29yaWdpbihvYmosIHdy
aXRlX2RvbWFpbikpOworCWlmICh3cml0ZV9kb21haW4pCisJCWludGVsX2Zyb250YnVmZmVyX2lu
dmFsaWRhdGUob2JqLT5mcm9udGJ1ZmZlciwgT1JJR0lOX0NQVSk7CiAKIG91dF91bnBpbjoKIAlp
OTE1X2dlbV9vYmplY3RfdW5waW5fcGFnZXMob2JqKTsKQEAgLTc4Myw3ICs3NzUsNyBAQCBpbnQg
aTkxNV9nZW1fb2JqZWN0X3ByZXBhcmVfd3JpdGUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iaiwKIAl9CiAKIG91dDoKLQlpbnRlbF9mYl9vYmpfaW52YWxpZGF0ZShvYmosIE9SSUdJTl9D
UFUpOworCWludGVsX2Zyb250YnVmZmVyX2ludmFsaWRhdGUob2JqLT5mcm9udGJ1ZmZlciwgT1JJ
R0lOX0NQVSk7CiAJb2JqLT5tbS5kaXJ0eSA9IHRydWU7CiAJLyogcmV0dXJuIHdpdGggdGhlIHBh
Z2VzIHBpbm5lZCAqLwogCXJldHVybiAwOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9tbWFuLmMKaW5kZXggYTU2NGMxZTQyMzFiLi43MWQxMGFlOTA5MjIgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYwpAQCAtMTAxLDkgKzEwMSw2IEBAIGk5MTVfZ2Vt
X21tYXBfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAkJdXBfd3Jp
dGUoJm1tLT5tbWFwX3NlbSk7CiAJCWlmIChJU19FUlJfVkFMVUUoYWRkcikpCiAJCQlnb3RvIGVy
cjsKLQotCQkvKiBUaGlzIG1heSByYWNlLCBidXQgdGhhdCdzIG9rLCBpdCBvbmx5IGdldHMgc2V0
ICovCi0JCVdSSVRFX09OQ0Uob2JqLT5mcm9udGJ1ZmZlcl9nZ3R0X29yaWdpbiwgT1JJR0lOX0NQ
VSk7CiAJfQogCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKIApAQCAtMjgzLDcgKzI4MCw2IEBA
IHZtX2ZhdWx0X3QgaTkxNV9nZW1fZmF1bHQoc3RydWN0IHZtX2ZhdWx0ICp2bWYpCiAJCSAqIFVz
ZXJzcGFjZSBpcyBub3cgd3JpdGluZyB0aHJvdWdoIGFuIHVudHJhY2tlZCBWTUEsIGFiYW5kb24K
IAkJICogYWxsIGhvcGUgdGhhdCB0aGUgaGFyZHdhcmUgaXMgYWJsZSB0byB0cmFjayBmdXR1cmUg
d3JpdGVzLgogCQkgKi8KLQkJb2JqLT5mcm9udGJ1ZmZlcl9nZ3R0X29yaWdpbiA9IE9SSUdJTl9D
UFU7CiAKIAkJdm1hID0gaTkxNV9nZW1fb2JqZWN0X2dndHRfcGluKG9iaiwgJnZpZXcsIDAsIDAs
IGZsYWdzKTsKIAkJaWYgKElTX0VSUih2bWEpICYmICF2aWV3LnR5cGUpIHsKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYwppbmRleCBlY2NkN2Y0NzY4ZjguLmNmZWQy
OGNjNjE4NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29i
amVjdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYwpA
QCAtNDUsMTYgKzQ1LDYgQEAgdm9pZCBpOTE1X2dlbV9vYmplY3RfZnJlZShzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqKQogCXJldHVybiBrbWVtX2NhY2hlX2ZyZWUoZ2xvYmFsLnNsYWJf
b2JqZWN0cywgb2JqKTsKIH0KIAotc3RhdGljIHZvaWQKLWZyb250YnVmZmVyX3JldGlyZShzdHJ1
Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLAotCQkgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpyZXF1ZXN0KQotewotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPQotCQljb250
YWluZXJfb2YoYWN0aXZlLCB0eXBlb2YoKm9iaiksIGZyb250YnVmZmVyX3dyaXRlKTsKLQotCWlu
dGVsX2ZiX29ial9mbHVzaChvYmosIE9SSUdJTl9DUyk7Ci19Ci0KIHZvaWQgaTkxNV9nZW1fb2Jq
ZWN0X2luaXQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJCSAgY29uc3Qgc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3Rfb3BzICpvcHMpCiB7CkBAIC03MSwxMCArNjEsNiBAQCB2
b2lkIGk5MTVfZ2VtX29iamVjdF9pbml0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmos
CiAKIAlvYmotPm9wcyA9IG9wczsKIAotCW9iai0+ZnJvbnRidWZmZXJfZ2d0dF9vcmlnaW4gPSBP
UklHSU5fR1RUOwotCWk5MTVfYWN0aXZlX3JlcXVlc3RfaW5pdCgmb2JqLT5mcm9udGJ1ZmZlcl93
cml0ZSwKLQkJCQkgTlVMTCwgZnJvbnRidWZmZXJfcmV0aXJlKTsKLQogCW9iai0+bW0ubWFkdiA9
IEk5MTVfTUFEVl9XSUxMTkVFRDsKIAlJTklUX1JBRElYX1RSRUUoJm9iai0+bW0uZ2V0X3BhZ2Uu
cmFkaXgsIEdGUF9LRVJORUwgfCBfX0dGUF9OT1dBUk4pOwogCW11dGV4X2luaXQoJm9iai0+bW0u
Z2V0X3BhZ2UubG9jayk7CkBAIC0xODYsNyArMTcyLDYgQEAgc3RhdGljIHZvaWQgX19pOTE1X2dl
bV9mcmVlX29iamVjdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAKIAkJR0VNX0JV
R19PTihhdG9taWNfcmVhZCgmb2JqLT5iaW5kX2NvdW50KSk7CiAJCUdFTV9CVUdfT04ob2JqLT51
c2VyZmF1bHRfY291bnQpOwotCQlHRU1fQlVHX09OKGF0b21pY19yZWFkKCZvYmotPmZyb250YnVm
ZmVyX2JpdHMpKTsKIAkJR0VNX0JVR19PTighbGlzdF9lbXB0eSgmb2JqLT5sdXRfbGlzdCkpOwog
CiAJCWF0b21pY19zZXQoJm9iai0+bW0ucGFnZXNfcGluX2NvdW50LCAwKTsKQEAgLTI1OSw2ICsy
NDQsOCBAQCB2b2lkIGk5MTVfZ2VtX2ZyZWVfb2JqZWN0KHN0cnVjdCBkcm1fZ2VtX29iamVjdCAq
Z2VtX29iaikKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gdG9faW50ZWxfYm8o
Z2VtX29iaik7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+
YmFzZS5kZXYpOwogCisJR0VNX0JVR19PTihpOTE1X2dlbV9vYmplY3RfaXNfZnJhbWVidWZmZXIo
b2JqKSk7CisKIAkvKgogCSAqIEJlZm9yZSB3ZSBmcmVlIHRoZSBvYmplY3QsIG1ha2Ugc3VyZSBh
bnkgcHVyZSBSQ1Utb25seQogCSAqIHJlYWQtc2lkZSBjcml0aWNhbCBzZWN0aW9ucyBhcmUgY29t
cGxldGUsIGUuZy4KQEAgLTI5MCwxMyArMjc3LDYgQEAgdm9pZCBpOTE1X2dlbV9mcmVlX29iamVj
dChzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKmdlbV9vYmopCiAJCXF1ZXVlX3dvcmsoaTkxNS0+d3Es
ICZpOTE1LT5tbS5mcmVlX3dvcmspOwogfQogCi1zdGF0aWMgaW5saW5lIGVudW0gZmJfb3Bfb3Jp
Z2luCi1mYl93cml0ZV9vcmlnaW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgdW5z
aWduZWQgaW50IGRvbWFpbikKLXsKLQlyZXR1cm4gKGRvbWFpbiA9PSBJOTE1X0dFTV9ET01BSU5f
R1RUID8KLQkJb2JqLT5mcm9udGJ1ZmZlcl9nZ3R0X29yaWdpbiA6IE9SSUdJTl9DUFUpOwotfQot
CiBzdGF0aWMgYm9vbCBncHVfd3JpdGVfbmVlZHNfY2xmbHVzaChzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqKQogewogCXJldHVybiAhKG9iai0+Y2FjaGVfbGV2ZWwgPT0gSTkxNV9DQUNI
RV9OT05FIHx8CkBAIC0zMTksOCArMjk5LDcgQEAgaTkxNV9nZW1fb2JqZWN0X2ZsdXNoX3dyaXRl
X2RvbWFpbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQlmb3JfZWFjaF9nZ3R0
X3ZtYSh2bWEsIG9iaikKIAkJCWludGVsX2d0X2ZsdXNoX2dndHRfd3JpdGVzKHZtYS0+dm0tPmd0
KTsKIAotCQlpbnRlbF9mYl9vYmpfZmx1c2gob2JqLAotCQkJCSAgIGZiX3dyaXRlX29yaWdpbihv
YmosIEk5MTVfR0VNX0RPTUFJTl9HVFQpKTsKKwkJaW50ZWxfZnJvbnRidWZmZXJfZmx1c2gob2Jq
LT5mcm9udGJ1ZmZlciwgT1JJR0lOX0NQVSk7CiAKIAkJZm9yX2VhY2hfZ2d0dF92bWEodm1hLCBv
YmopIHsKIAkJCWlmICh2bWEtPmlvbWFwKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX29iamVjdC5oCmluZGV4IDM3MTRjZjIzNGQ2NC4uYWJjMjNlN2UxM2E3IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oCkBAIC0xNjEsNyArMTYxLDcgQEAg
aTkxNV9nZW1fb2JqZWN0X25lZWRzX2FzeW5jX2NhbmNlbChjb25zdCBzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqKQogc3RhdGljIGlubGluZSBib29sCiBpOTE1X2dlbV9vYmplY3RfaXNf
ZnJhbWVidWZmZXIoY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHsKLQly
ZXR1cm4gUkVBRF9PTkNFKG9iai0+ZnJhbWVidWZmZXJfcmVmZXJlbmNlcyk7CisJcmV0dXJuIFJF
QURfT05DRShvYmotPmZyb250YnVmZmVyKTsKIH0KIAogc3RhdGljIGlubGluZSB1bnNpZ25lZCBp
bnQKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3Rf
dHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMu
aAppbmRleCBkNDc0YzZhYzQxMDAuLmVkZTBlYjQyMThhOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaApAQCAtMTMsNiArMTMsNyBAQAog
I2luY2x1ZGUgImk5MTVfc2VsZnRlc3QuaCIKIAogc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Q7
CitzdHJ1Y3QgaW50ZWxfZnJvbmJ1ZmZlcjsKIAogLyoKICAqIHN0cnVjdCBpOTE1X2x1dF9oYW5k
bGUgdHJhY2tzIHRoZSBmYXN0IGxvb2t1cHMgZnJvbSBoYW5kbGUgdG8gdm1hIHVzZWQKQEAgLTE0
MSw5ICsxNDIsNyBAQCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCB7CiAJICovCiAJdTE2IHdy
aXRlX2RvbWFpbjsKIAotCWF0b21pY190IGZyb250YnVmZmVyX2JpdHM7Ci0JdW5zaWduZWQgaW50
IGZyb250YnVmZmVyX2dndHRfb3JpZ2luOyAvKiB3cml0ZSBvbmNlICovCi0Jc3RydWN0IGk5MTVf
YWN0aXZlX3JlcXVlc3QgZnJvbnRidWZmZXJfd3JpdGU7CisJc3RydWN0IGludGVsX2Zyb250YnVm
ZmVyICpmcm9udGJ1ZmZlcjsKIAogCS8qKiBDdXJyZW50IHRpbGluZyBzdHJpZGUgZm9yIHRoZSBv
YmplY3QsIGlmIGl0J3MgdGlsZWQuICovCiAJdW5zaWduZWQgaW50IHRpbGluZ19hbmRfc3RyaWRl
OwpAQCAtMjI0LDkgKzIyMyw2IEBAIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0IHsKIAkJYm9v
bCBxdWlya2VkOjE7CiAJfSBtbTsKIAotCS8qKiBSZWZlcmVuY2VzIGZyb20gZnJhbWVidWZmZXJz
LCBsb2NrcyBvdXQgdGlsaW5nIGNoYW5nZXMuICovCi0JdW5zaWduZWQgaW50IGZyYW1lYnVmZmVy
X3JlZmVyZW5jZXM7Ci0KIAkvKiogUmVjb3JkIG9mIGFkZHJlc3MgYml0IDE3IG9mIGVhY2ggcGFn
ZSBhdCBsYXN0IHVuYmluZC4gKi8KIAl1bnNpZ25lZCBsb25nICpiaXRfMTc7CiAKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKaW5kZXggOGY2MzllZDYwMzRhLi5iNmI4MDk2M2Y5OTIgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCkBAIC0xMzYsNyArMTM2LDYgQEAgZGVzY3Jp
YmVfb2JqKHN0cnVjdCBzZXFfZmlsZSAqbSwgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9i
aikKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KG9iai0+YmFz
ZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAlzdHJ1Y3QgaTkxNV92
bWEgKnZtYTsKLQl1bnNpZ25lZCBpbnQgZnJvbnRidWZmZXJfYml0czsKIAlpbnQgcGluX2NvdW50
ID0gMDsKIAogCXNlcV9wcmludGYobSwgIiVwSzogJWMlYyVjJWMgJTh6ZEtpQiAlMDJ4ICUwMngg
JXMlcyVzIiwKQEAgLTIyNiwxMCArMjI1LDYgQEAgZGVzY3JpYmVfb2JqKHN0cnVjdCBzZXFfZmls
ZSAqbSwgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAllbmdpbmUgPSBpOTE1X2dl
bV9vYmplY3RfbGFzdF93cml0ZV9lbmdpbmUob2JqKTsKIAlpZiAoZW5naW5lKQogCQlzZXFfcHJp
bnRmKG0sICIgKCVzKSIsIGVuZ2luZS0+bmFtZSk7Ci0KLQlmcm9udGJ1ZmZlcl9iaXRzID0gYXRv
bWljX3JlYWQoJm9iai0+ZnJvbnRidWZmZXJfYml0cyk7Ci0JaWYgKGZyb250YnVmZmVyX2JpdHMp
Ci0JCXNlcV9wcmludGYobSwgIiAoZnJvbnRidWZmZXI6IDB4JTAzeCkiLCBmcm9udGJ1ZmZlcl9i
aXRzKTsKIH0KIAogc3RydWN0IGZpbGVfc3RhdHMgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKaW5k
ZXggODZiMGExNjYzMmJjLi44ZmJlZGJiYjM5ZGMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaApA
QCAtMjQ3MywxMCArMjQ3Myw2IEBAIGludCBpOTE1X2dlbV9tbWFwX2d0dChzdHJ1Y3QgZHJtX2Zp
bGUgKmZpbGVfcHJpdiwgc3RydWN0IGRybV9kZXZpY2UgKmRldiwKIAkJICAgICAgdTMyIGhhbmRs
ZSwgdTY0ICpvZmZzZXQpOwogaW50IGk5MTVfZ2VtX21tYXBfZ3R0X3ZlcnNpb24odm9pZCk7CiAK
LXZvaWQgaTkxNV9nZW1fdHJhY2tfZmIoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9sZCwK
LQkJICAgICAgIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpuZXcsCi0JCSAgICAgICB1bnNp
Z25lZCBmcm9udGJ1ZmZlcl9iaXRzKTsKLQogaW50IF9fbXVzdF9jaGVjayBpOTE1X2dlbV9zZXRf
Z2xvYmFsX3NlcW5vKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHUzMiBzZXFubyk7CiAKIHN0YXRp
YyBpbmxpbmUgdTMyIGk5MTVfcmVzZXRfY291bnQoc3RydWN0IGk5MTVfZ3B1X2Vycm9yICplcnJv
cikKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IDA1ZGJmNTQyODFhOC4uNDZlZDkwZTU5YThk
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTEzOCwxNyArMTM4LDE5IEBAIGk5MTVfZ2Vt
X3BoeXNfcHdyaXRlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJdm9pZCAqdmFk
ZHIgPSBvYmotPnBoeXNfaGFuZGxlLT52YWRkciArIGFyZ3MtPm9mZnNldDsKIAljaGFyIF9fdXNl
ciAqdXNlcl9kYXRhID0gdTY0X3RvX3VzZXJfcHRyKGFyZ3MtPmRhdGFfcHRyKTsKIAotCS8qIFdl
IG1hbnVhbGx5IGNvbnRyb2wgdGhlIGRvbWFpbiBoZXJlIGFuZCBwcmV0ZW5kIHRoYXQgaXQKKwkv
KgorCSAqIFdlIG1hbnVhbGx5IGNvbnRyb2wgdGhlIGRvbWFpbiBoZXJlIGFuZCBwcmV0ZW5kIHRo
YXQgaXQKIAkgKiByZW1haW5zIGNvaGVyZW50IGkuZS4gaW4gdGhlIEdUVCBkb21haW4sIGxpa2Ug
c2htZW1fcHdyaXRlLgogCSAqLwotCWludGVsX2ZiX29ial9pbnZhbGlkYXRlKG9iaiwgT1JJR0lO
X0NQVSk7CisJaW50ZWxfZnJvbnRidWZmZXJfaW52YWxpZGF0ZShvYmotPmZyb250YnVmZmVyLCBP
UklHSU5fQ1BVKTsKKwogCWlmIChjb3B5X2Zyb21fdXNlcih2YWRkciwgdXNlcl9kYXRhLCBhcmdz
LT5zaXplKSkKIAkJcmV0dXJuIC1FRkFVTFQ7CiAKIAlkcm1fY2xmbHVzaF92aXJ0X3JhbmdlKHZh
ZGRyLCBhcmdzLT5zaXplKTsKIAlpbnRlbF9ndF9jaGlwc2V0X2ZsdXNoKCZ0b19pOTE1KG9iai0+
YmFzZS5kZXYpLT5ndCk7CiAKLQlpbnRlbF9mYl9vYmpfZmx1c2gob2JqLCBPUklHSU5fQ1BVKTsK
KwlpbnRlbF9mcm9udGJ1ZmZlcl9mbHVzaChvYmotPmZyb250YnVmZmVyLCBPUklHSU5fQ1BVKTsK
IAlyZXR1cm4gMDsKIH0KIApAQCAtNTk2LDcgKzU5OCw3IEBAIGk5MTVfZ2VtX2d0dF9wd3JpdGVf
ZmFzdChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQlnb3RvIG91dF91bnBpbjsK
IAl9CiAKLQlpbnRlbF9mYl9vYmpfaW52YWxpZGF0ZShvYmosIE9SSUdJTl9DUFUpOworCWludGVs
X2Zyb250YnVmZmVyX2ludmFsaWRhdGUob2JqLT5mcm9udGJ1ZmZlciwgT1JJR0lOX0NQVSk7CiAK
IAl1c2VyX2RhdGEgPSB1NjRfdG9fdXNlcl9wdHIoYXJncy0+ZGF0YV9wdHIpOwogCW9mZnNldCA9
IGFyZ3MtPm9mZnNldDsKQEAgLTYzNyw3ICs2MzksNyBAQCBpOTE1X2dlbV9ndHRfcHdyaXRlX2Zh
c3Qoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJdXNlcl9kYXRhICs9IHBhZ2Vf
bGVuZ3RoOwogCQlvZmZzZXQgKz0gcGFnZV9sZW5ndGg7CiAJfQotCWludGVsX2ZiX29ial9mbHVz
aChvYmosIE9SSUdJTl9DUFUpOworCWludGVsX2Zyb250YnVmZmVyX2ZsdXNoKG9iai0+ZnJvbnRi
dWZmZXIsIE9SSUdJTl9DUFUpOwogCiAJaTkxNV9nZW1fb2JqZWN0X3VubG9ja19mZW5jZShvYmos
IGZlbmNlKTsKIG91dF91bnBpbjoKQEAgLTczMCw3ICs3MzIsNyBAQCBpOTE1X2dlbV9zaG1lbV9w
d3JpdGUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJb2Zmc2V0ID0gMDsKIAl9
CiAKLQlpbnRlbF9mYl9vYmpfZmx1c2gob2JqLCBPUklHSU5fQ1BVKTsKKwlpbnRlbF9mcm9udGJ1
ZmZlcl9mbHVzaChvYmotPmZyb250YnVmZmVyLCBPUklHSU5fQ1BVKTsKIAlpOTE1X2dlbV9vYmpl
Y3RfdW5sb2NrX2ZlbmNlKG9iaiwgZmVuY2UpOwogCiAJcmV0dXJuIHJldDsKQEAgLTE3NzYsMzkg
KzE3NzgsNiBAQCBpbnQgaTkxNV9nZW1fb3BlbihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwgc3RydWN0IGRybV9maWxlICpmaWxlKQogCXJldHVybiByZXQ7CiB9CiAKLS8qKgotICogaTkx
NV9nZW1fdHJhY2tfZmIgLSB1cGRhdGUgZnJvbnRidWZmZXIgdHJhY2tpbmcKLSAqIEBvbGQ6IGN1
cnJlbnQgR0VNIGJ1ZmZlciBmb3IgdGhlIGZyb250YnVmZmVyIHNsb3RzCi0gKiBAbmV3OiBuZXcg
R0VNIGJ1ZmZlciBmb3IgdGhlIGZyb250YnVmZmVyIHNsb3RzCi0gKiBAZnJvbnRidWZmZXJfYml0
czogYml0bWFzayBvZiBmcm9udGJ1ZmZlciBzbG90cwotICoKLSAqIFRoaXMgdXBkYXRlcyB0aGUg
ZnJvbnRidWZmZXIgdHJhY2tpbmcgYml0cyBAZnJvbnRidWZmZXJfYml0cyBieSBjbGVhcmluZyB0
aGVtCi0gKiBmcm9tIEBvbGQgYW5kIHNldHRpbmcgdGhlbSBpbiBAbmV3LiBCb3RoIEBvbGQgYW5k
IEBuZXcgY2FuIGJlIE5VTEwuCi0gKi8KLXZvaWQgaTkxNV9nZW1fdHJhY2tfZmIoc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9sZCwKLQkJICAgICAgIHN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpuZXcsCi0JCSAgICAgICB1bnNpZ25lZCBmcm9udGJ1ZmZlcl9iaXRzKQotewotCS8qIENv
bnRyb2wgb2YgaW5kaXZpZHVhbCBiaXRzIHdpdGhpbiB0aGUgbWFzayBhcmUgZ3VhcmRlZCBieQot
CSAqIHRoZSBvd25pbmcgcGxhbmUtPm11dGV4LCBpLmUuIHdlIGNhbiBuZXZlciBzZWUgY29uY3Vy
cmVudAotCSAqIG1hbmlwdWxhdGlvbiBvZiBpbmRpdmlkdWFsIGJpdHMuIEJ1dCBzaW5jZSB0aGUg
Yml0ZmllbGQgYXMgYSB3aG9sZQotCSAqIGlzIHVwZGF0ZWQgdXNpbmcgUk1XLCB3ZSBuZWVkIHRv
IHVzZSBhdG9taWNzIGluIG9yZGVyIHRvIHVwZGF0ZQotCSAqIHRoZSBiaXRzLgotCSAqLwotCUJV
SUxEX0JVR19PTihJTlRFTF9GUk9OVEJVRkZFUl9CSVRTX1BFUl9QSVBFICogSTkxNV9NQVhfUElQ
RVMgPgotCQkgICAgIEJJVFNfUEVSX1RZUEUoYXRvbWljX3QpKTsKLQotCWlmIChvbGQpIHsKLQkJ
V0FSTl9PTighKGF0b21pY19yZWFkKCZvbGQtPmZyb250YnVmZmVyX2JpdHMpICYgZnJvbnRidWZm
ZXJfYml0cykpOwotCQlhdG9taWNfYW5kbm90KGZyb250YnVmZmVyX2JpdHMsICZvbGQtPmZyb250
YnVmZmVyX2JpdHMpOwotCX0KLQotCWlmIChuZXcpIHsKLQkJV0FSTl9PTihhdG9taWNfcmVhZCgm
bmV3LT5mcm9udGJ1ZmZlcl9iaXRzKSAmIGZyb250YnVmZmVyX2JpdHMpOwotCQlhdG9taWNfb3Io
ZnJvbnRidWZmZXJfYml0cywgJm5ldy0+ZnJvbnRidWZmZXJfYml0cyk7Ci0JfQotfQotCiAjaWYg
SVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfU0VMRlRFU1QpCiAjaW5jbHVkZSAic2VsZnRlc3Rz
L21vY2tfZ2VtX2RldmljZS5jIgogI2luY2x1ZGUgInNlbGZ0ZXN0cy9pOTE1X2dlbS5jIgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfdm1hLmMKaW5kZXggODViNGE5MDZiZTFlLi5jYzFiOTNmY2UxNDUgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV92bWEuYwpAQCAtOTI3LDggKzkyNywxMCBAQCBpbnQgaTkxNV92bWFfbW92
ZV90b19hY3RpdmUoc3RydWN0IGk5MTVfdm1hICp2bWEsCiAJaWYgKGZsYWdzICYgRVhFQ19PQkpF
Q1RfV1JJVEUpIHsKIAkJb2JqLT53cml0ZV9kb21haW4gPSBJOTE1X0dFTV9ET01BSU5fUkVOREVS
OwogCi0JCWlmIChpbnRlbF9mYl9vYmpfaW52YWxpZGF0ZShvYmosIE9SSUdJTl9DUykpCi0JCQlf
X2k5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KCZvYmotPmZyb250YnVmZmVyX3dyaXRlLCBycSk7CisJ
CWlmIChpbnRlbF9mcm9udGJ1ZmZlcl9pbnZhbGlkYXRlKG9iai0+ZnJvbnRidWZmZXIsIE9SSUdJ
Tl9DUykpCisJCQlpOTE1X2FjdGl2ZV9yZWYoJm9iai0+ZnJvbnRidWZmZXItPndyaXRlLAorCQkJ
CQlycS0+ZmVuY2UuY29udGV4dCwKKwkJCQkJcnEpOwogCiAJCW9iai0+cmVhZF9kb21haW5zID0g
MDsKIAl9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcnYuaCBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Rydi5oCmluZGV4IGU4ZWNiZDU1NDc2ZS4uYTEyOWEz
MmQ5MDQwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcnYuaAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcnYuaApAQCAtNjksNiArNjksNyBAQCBlbnVt
IGludGVsX291dHB1dF90eXBlIHsKIAogc3RydWN0IGludGVsX2ZyYW1lYnVmZmVyIHsKIAlzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyIGJhc2U7CisJc3RydWN0IGludGVsX2Zyb250YnVmZmVyICpmcm9u
dGJ1ZmZlcjsKIAlzdHJ1Y3QgaW50ZWxfcm90YXRpb25faW5mbyByb3RfaW5mbzsKIAogCS8qIGZv
ciBlYWNoIHBsYW5lIGluIHRoZSBub3JtYWwgR1RUIHZpZXcgKi8KLS0gCjIuMjIuMAoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxp
bmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

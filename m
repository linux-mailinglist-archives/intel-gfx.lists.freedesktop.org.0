Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id B536AAEEAD
	for <lists+intel-gfx@lfdr.de>; Tue, 10 Sep 2019 17:43:03 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 731716E918;
	Tue, 10 Sep 2019 15:43:01 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga05.intel.com (mga05.intel.com [192.55.52.43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D6A026E919
 for <intel-gfx@lists.freedesktop.org>; Tue, 10 Sep 2019 15:43:00 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga002.fm.intel.com ([10.253.24.26])
 by fmsmga105.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 10 Sep 2019 08:43:00 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,489,1559545200"; d="scan'208";a="214345933"
Received: from mdroper-desk.fm.intel.com ([10.105.128.12])
 by fmsmga002.fm.intel.com with ESMTP; 10 Sep 2019 08:43:00 -0700
From: Matt Roper <matthew.d.roper@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 10 Sep 2019 08:42:45 -0700
Message-Id: <20190910154252.30503-2-matthew.d.roper@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190910154252.30503-1-matthew.d.roper@intel.com>
References: <20190910154252.30503-1-matthew.d.roper@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v4 1/8] drm/i915: Consolidate bxt/cnl/icl cdclk
 readout
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QXNpZGUgZnJvbSBhIGZldyBtaW5vciByZWdpc3RlciBjaGFuZ2VzIGFuZCBzb21lIGRpZmZlcmVu
dCBjbG9jayB2YWx1ZXMsCmNkY2xrIGRlc2lnbiBoYXNuJ3QgY2hhbmdlZCBtdWNoIHNpbmNlIGdl
bjlscC4gIExldCdzIGNvbnNvbGlkYXRlIHRoZQpoYW5kbGVycyBmb3IgYnh0LCBjbmwsIGFuZCBp
Y2wgdG8ga2VlcCB0aGUgY29kZWZsb3cgY29uc2lzdGVudC4KCkFsc28sIHdoaWxlIHdlJ3JlIGF0
IGl0LCBzL2J4dF9kZV9wbGxfdXBkYXRlL2J4dF9kZV9wbGxfcmVhZG91dC8gc2luY2UKInVwZGF0
ZSIgbWFrZXMgbWUgdGhpbmsgd2Ugc2hvdWxkIGJlIHdyaXRpbmcgdG8gaGFyZHdhcmUgcmF0aGVy
IHRoYW4KcmVhZGluZyBmcm9tIGl0LgoKdjI6CiAtIEZpeCBpY2xfY2FsY192b2x0YWdlX2xldmVs
KCkgbGltaXRzLiAgKFZpbGxlKQogLSBVc2UgQ05MX0NEQ0xLX1BMTF9SQVRJT19NQVNLIHJhdGhl
ciB0aGFuIEJYVF9ERV9QTExfUkFUSU9fTUFTSyBvbgogICBnZW4xMCsgdG8gYXZvaWQgY29uZnVz
aW9uLiAgKFZpbGxlKQoKQ2M6IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBsaW51eC5p
bnRlbC5jb20+ClN1Z2dlc3RlZC1ieTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxp
bnV4LmludGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogTWF0dCBSb3BlciA8bWF0dGhldy5kLnJvcGVy
QGludGVsLmNvbT4KUmV2aWV3ZWQtYnk6IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBs
aW51eC5pbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9j
ZGNsay5jIHwgMzI1ICsrKysrKysrKy0tLS0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDEzOCBp
bnNlcnRpb25zKCspLCAxODcgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jZGNsay5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9jZGNsay5jCmluZGV4IGQzZTU2NjI4YWY3MC4uMDFlZDMyNjJkOTFlIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NkY2xrLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jZGNsay5jCkBAIC0xMTkwLDYgKzEx
OTAsMzYgQEAgc3RhdGljIHU4IGJ4dF9jYWxjX3ZvbHRhZ2VfbGV2ZWwoaW50IGNkY2xrKQogCXJl
dHVybiBESVZfUk9VTkRfVVAoY2RjbGssIDI1MDAwKTsKIH0KIAorc3RhdGljIHU4IGNubF9jYWxj
X3ZvbHRhZ2VfbGV2ZWwoaW50IGNkY2xrKQoreworCWlmIChjZGNsayA+IDMzNjAwMCkKKwkJcmV0
dXJuIDI7CisJZWxzZSBpZiAoY2RjbGsgPiAxNjgwMDApCisJCXJldHVybiAxOworCWVsc2UKKwkJ
cmV0dXJuIDA7Cit9CisKK3N0YXRpYyB1OCBpY2xfY2FsY192b2x0YWdlX2xldmVsKGludCBjZGNs
aykKK3sKKwlpZiAoY2RjbGsgPiA1NTY4MDApCisJCXJldHVybiAyOworCWVsc2UgaWYgKGNkY2xr
ID4gMzEyMDAwKQorCQlyZXR1cm4gMTsKKwllbHNlCisJCXJldHVybiAwOworfQorCitzdGF0aWMg
dTggZWhsX2NhbGNfdm9sdGFnZV9sZXZlbChpbnQgY2RjbGspCit7CisJaWYgKGNkY2xrID4gMzI2
NDAwKQorCQlyZXR1cm4gMjsKKwllbHNlIGlmIChjZGNsayA+IDE4MDAwMCkKKwkJcmV0dXJuIDE7
CisJZWxzZQorCQlyZXR1cm4gMDsKK30KKwogc3RhdGljIGludCBieHRfZGVfcGxsX3ZjbyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGludCBjZGNsaykKIHsKIAlpbnQgcmF0aW87
CkBAIC0xMjM2LDIzICsxMjY2LDY5IEBAIHN0YXRpYyBpbnQgZ2xrX2RlX3BsbF92Y28oc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBpbnQgY2RjbGspCiAJcmV0dXJuIGRldl9wcml2
LT5jZGNsay5ody5yZWYgKiByYXRpbzsKIH0KIAotc3RhdGljIHZvaWQgYnh0X2RlX3BsbF91cGRh
dGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAotCQkJICAgICAgc3RydWN0IGlu
dGVsX2NkY2xrX3N0YXRlICpjZGNsa19zdGF0ZSkKK3N0YXRpYyB2b2lkIGNubF9yZWFkb3V0X3Jl
ZmNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJCQkgICAgICAgc3RydWN0
IGludGVsX2NkY2xrX3N0YXRlICpjZGNsa19zdGF0ZSkKIHsKLQl1MzIgdmFsOworCWlmIChJOTE1
X1JFQUQoU0tMX0RTU00pICYgQ05MX0RTU01fQ0RDTEtfUExMX1JFRkNMS18yNE1IeikKKwkJY2Rj
bGtfc3RhdGUtPnJlZiA9IDI0MDAwOworCWVsc2UKKwkJY2RjbGtfc3RhdGUtPnJlZiA9IDE5MjAw
OworfQogCi0JY2RjbGtfc3RhdGUtPnJlZiA9IDE5MjAwOwotCWNkY2xrX3N0YXRlLT52Y28gPSAw
Oworc3RhdGljIHZvaWQgaWNsX3JlYWRvdXRfcmVmY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKKwkJCSAgICAgICBzdHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUgKmNkY2xrX3N0
YXRlKQoreworCXUzMiBkc3NtID0gSTkxNV9SRUFEKFNLTF9EU1NNKSAmIElDTF9EU1NNX0NEQ0xL
X1BMTF9SRUZDTEtfTUFTSzsKKworCXN3aXRjaCAoZHNzbSkgeworCWRlZmF1bHQ6CisJCU1JU1NJ
TkdfQ0FTRShkc3NtKTsKKwkJLyogZmFsbCB0aHJvdWdoICovCisJY2FzZSBJQ0xfRFNTTV9DRENM
S19QTExfUkVGQ0xLXzI0TUh6OgorCQljZGNsa19zdGF0ZS0+cmVmID0gMjQwMDA7CisJCWJyZWFr
OworCWNhc2UgSUNMX0RTU01fQ0RDTEtfUExMX1JFRkNMS18xOV8yTUh6OgorCQljZGNsa19zdGF0
ZS0+cmVmID0gMTkyMDA7CisJCWJyZWFrOworCWNhc2UgSUNMX0RTU01fQ0RDTEtfUExMX1JFRkNM
S18zOF80TUh6OgorCQljZGNsa19zdGF0ZS0+cmVmID0gMzg0MDA7CisJCWJyZWFrOworCX0KK30K
Kworc3RhdGljIHZvaWQgYnh0X2RlX3BsbF9yZWFkb3V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKKwkJCSAgICAgICBzdHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUgKmNkY2xrX3N0
YXRlKQoreworCXUzMiB2YWwsIHJhdGlvOworCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
MTEpCisJCWljbF9yZWFkb3V0X3JlZmNsayhkZXZfcHJpdiwgY2RjbGtfc3RhdGUpOworCWVsc2Ug
aWYgKElTX0NBTk5PTkxBS0UoZGV2X3ByaXYpKQorCQljbmxfcmVhZG91dF9yZWZjbGsoZGV2X3By
aXYsIGNkY2xrX3N0YXRlKTsKKwllbHNlCisJCWNkY2xrX3N0YXRlLT5yZWYgPSAxOTIwMDsKIAog
CXZhbCA9IEk5MTVfUkVBRChCWFRfREVfUExMX0VOQUJMRSk7Ci0JaWYgKCh2YWwgJiBCWFRfREVf
UExMX1BMTF9FTkFCTEUpID09IDApCisJaWYgKCh2YWwgJiBCWFRfREVfUExMX1BMTF9FTkFCTEUp
ID09IDAgfHwKKwkgICAgKHZhbCAmIEJYVF9ERV9QTExfTE9DSykgPT0gMCkgeworCQkvKgorCQkg
KiBDRENMSyBQTEwgaXMgZGlzYWJsZWQsIHRoZSBWQ08vcmF0aW8gZG9lc24ndCBtYXR0ZXIsIGJ1
dAorCQkgKiBzZXR0aW5nIGl0IHRvIHplcm8gaXMgYSB3YXkgdG8gc2lnbmFsIHRoYXQuCisJCSAq
LworCQljZGNsa19zdGF0ZS0+dmNvID0gMDsKIAkJcmV0dXJuOworCX0KIAotCWlmIChXQVJOX09O
KCh2YWwgJiBCWFRfREVfUExMX0xPQ0spID09IDApKQotCQlyZXR1cm47CisJLyoKKwkgKiBDTkwr
IGhhdmUgdGhlIHJhdGlvIGRpcmVjdGx5IGluIHRoZSBQTEwgZW5hYmxlIHJlZ2lzdGVyLCBnZW45
bHAgaGFkCisJICogaXQgaW4gYSBzZXBhcmF0ZSBQTEwgY29udHJvbCByZWdpc3Rlci4KKwkgKi8K
KwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMCkKKwkJcmF0aW8gPSB2YWwgJiBDTkxfQ0RD
TEtfUExMX1JBVElPX01BU0s7CisJZWxzZQorCQlyYXRpbyA9IEk5MTVfUkVBRChCWFRfREVfUExM
X0NUTCkgJiBCWFRfREVfUExMX1JBVElPX01BU0s7CiAKLQl2YWwgPSBJOTE1X1JFQUQoQlhUX0RF
X1BMTF9DVEwpOwotCWNkY2xrX3N0YXRlLT52Y28gPSAodmFsICYgQlhUX0RFX1BMTF9SQVRJT19N
QVNLKSAqIGNkY2xrX3N0YXRlLT5yZWY7CisJY2RjbGtfc3RhdGUtPnZjbyA9IHJhdGlvICogY2Rj
bGtfc3RhdGUtPnJlZjsKIH0KIAogc3RhdGljIHZvaWQgYnh0X2dldF9jZGNsayhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCkBAIC0xMjYxLDEyICsxMzM3LDE4IEBAIHN0YXRpYyB2
b2lkIGJ4dF9nZXRfY2RjbGsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCXUz
MiBkaXZpZGVyOwogCWludCBkaXY7CiAKLQlieHRfZGVfcGxsX3VwZGF0ZShkZXZfcHJpdiwgY2Rj
bGtfc3RhdGUpOwotCi0JY2RjbGtfc3RhdGUtPmNkY2xrID0gY2RjbGtfc3RhdGUtPmJ5cGFzcyA9
IGNkY2xrX3N0YXRlLT5yZWY7CisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpCisJCWNk
Y2xrX3N0YXRlLT5ieXBhc3MgPSBjZGNsa19zdGF0ZS0+cmVmIC8gMjsKKwllbHNlIGlmIChJTlRF
TF9HRU4oZGV2X3ByaXYpID49IDExKQorCQljZGNsa19zdGF0ZS0+YnlwYXNzID0gNTAwMDA7CisJ
ZWxzZQorCQljZGNsa19zdGF0ZS0+YnlwYXNzID0gY2RjbGtfc3RhdGUtPnJlZjsKIAotCWlmIChj
ZGNsa19zdGF0ZS0+dmNvID09IDApCisJYnh0X2RlX3BsbF9yZWFkb3V0KGRldl9wcml2LCBjZGNs
a19zdGF0ZSk7CisJaWYgKGNkY2xrX3N0YXRlLT52Y28gPT0gMCkgeworCQljZGNsa19zdGF0ZS0+
Y2RjbGsgPSBjZGNsa19zdGF0ZS0+YnlwYXNzOwogCQlnb3RvIG91dDsKKwl9CiAKIAlkaXZpZGVy
ID0gSTkxNV9SRUFEKENEQ0xLX0NUTCkgJiBCWFRfQ0RDTEtfQ0QyWF9ESVZfU0VMX01BU0s7CiAK
QEAgLTEyNzUsMTMgKzEzNTcsMTUgQEAgc3RhdGljIHZvaWQgYnh0X2dldF9jZGNsayhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCWRpdiA9IDI7CiAJCWJyZWFrOwogCWNhc2Ug
QlhUX0NEQ0xLX0NEMlhfRElWX1NFTF8xXzU6Ci0JCVdBUk4oSVNfR0VNSU5JTEFLRShkZXZfcHJp
diksICJVbnN1cHBvcnRlZCBkaXZpZGVyXG4iKTsKKwkJV0FSTihJU19HRU1JTklMQUtFKGRldl9w
cml2KSB8fCBJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEwLAorCQkgICAgICJVbnN1cHBvcnRlZCBk
aXZpZGVyXG4iKTsKIAkJZGl2ID0gMzsKIAkJYnJlYWs7CiAJY2FzZSBCWFRfQ0RDTEtfQ0QyWF9E
SVZfU0VMXzI6CiAJCWRpdiA9IDQ7CiAJCWJyZWFrOwogCWNhc2UgQlhUX0NEQ0xLX0NEMlhfRElW
X1NFTF80OgorCQlXQVJOKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAsICJVbnN1cHBvcnRlZCBk
aXZpZGVyXG4iKTsKIAkJZGl2ID0gODsKIAkJYnJlYWs7CiAJZGVmYXVsdDoKQEAgLTEyOTYsOCAr
MTM4MCwxOCBAQCBzdGF0aWMgdm9pZCBieHRfZ2V0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKIAkgKiBDYW4ndCByZWFkIHRoaXMgb3V0IDooIExldCdzIGFzc3VtZSBp
dCdzCiAJICogYXQgbGVhc3Qgd2hhdCB0aGUgQ0RDTEsgZnJlcXVlbmN5IHJlcXVpcmVzLgogCSAq
LwotCWNkY2xrX3N0YXRlLT52b2x0YWdlX2xldmVsID0KLQkJYnh0X2NhbGNfdm9sdGFnZV9sZXZl
bChjZGNsa19zdGF0ZS0+Y2RjbGspOworCWlmIChJU19FTEtIQVJUTEFLRShkZXZfcHJpdikpCisJ
CWNkY2xrX3N0YXRlLT52b2x0YWdlX2xldmVsID0KKwkJCWVobF9jYWxjX3ZvbHRhZ2VfbGV2ZWwo
Y2RjbGtfc3RhdGUtPmNkY2xrKTsKKwllbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEx
KQorCQljZGNsa19zdGF0ZS0+dm9sdGFnZV9sZXZlbCA9CisJCQlpY2xfY2FsY192b2x0YWdlX2xl
dmVsKGNkY2xrX3N0YXRlLT5jZGNsayk7CisJZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+
PSAxMCkKKwkJY2RjbGtfc3RhdGUtPnZvbHRhZ2VfbGV2ZWwgPQorCQkJY25sX2NhbGNfdm9sdGFn
ZV9sZXZlbChjZGNsa19zdGF0ZS0+Y2RjbGspOworCWVsc2UKKwkJY2RjbGtfc3RhdGUtPnZvbHRh
Z2VfbGV2ZWwgPQorCQkJYnh0X2NhbGNfdm9sdGFnZV9sZXZlbChjZGNsa19zdGF0ZS0+Y2RjbGsp
OwogfQogCiBzdGF0aWMgdm9pZCBieHRfZGVfcGxsX2Rpc2FibGUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQpAQCAtMTUxNSw3NiArMTYwOSw2IEBAIHN0YXRpYyBpbnQgY25sX2Nh
bGNfY2RjbGsoaW50IG1pbl9jZGNsaykKIAkJcmV0dXJuIDE2ODAwMDsKIH0KIAotc3RhdGljIHU4
IGNubF9jYWxjX3ZvbHRhZ2VfbGV2ZWwoaW50IGNkY2xrKQotewotCWlmIChjZGNsayA+IDMzNjAw
MCkKLQkJcmV0dXJuIDI7Ci0JZWxzZSBpZiAoY2RjbGsgPiAxNjgwMDApCi0JCXJldHVybiAxOwot
CWVsc2UKLQkJcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyB2b2lkIGNubF9jZGNsa19wbGxfdXBkYXRl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCQkgc3RydWN0IGludGVsX2Nk
Y2xrX3N0YXRlICpjZGNsa19zdGF0ZSkKLXsKLQl1MzIgdmFsOwotCi0JaWYgKEk5MTVfUkVBRChT
S0xfRFNTTSkgJiBDTkxfRFNTTV9DRENMS19QTExfUkVGQ0xLXzI0TUh6KQotCQljZGNsa19zdGF0
ZS0+cmVmID0gMjQwMDA7Ci0JZWxzZQotCQljZGNsa19zdGF0ZS0+cmVmID0gMTkyMDA7Ci0KLQlj
ZGNsa19zdGF0ZS0+dmNvID0gMDsKLQotCXZhbCA9IEk5MTVfUkVBRChCWFRfREVfUExMX0VOQUJM
RSk7Ci0JaWYgKCh2YWwgJiBCWFRfREVfUExMX1BMTF9FTkFCTEUpID09IDApCi0JCXJldHVybjsK
LQotCWlmIChXQVJOX09OKCh2YWwgJiBCWFRfREVfUExMX0xPQ0spID09IDApKQotCQlyZXR1cm47
Ci0KLQljZGNsa19zdGF0ZS0+dmNvID0gKHZhbCAmIENOTF9DRENMS19QTExfUkFUSU9fTUFTSykg
KiBjZGNsa19zdGF0ZS0+cmVmOwotfQotCi1zdGF0aWMgdm9pZCBjbmxfZ2V0X2NkY2xrKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCSBzdHJ1Y3QgaW50ZWxfY2RjbGtfc3Rh
dGUgKmNkY2xrX3N0YXRlKQotewotCXUzMiBkaXZpZGVyOwotCWludCBkaXY7Ci0KLQljbmxfY2Rj
bGtfcGxsX3VwZGF0ZShkZXZfcHJpdiwgY2RjbGtfc3RhdGUpOwotCi0JY2RjbGtfc3RhdGUtPmNk
Y2xrID0gY2RjbGtfc3RhdGUtPmJ5cGFzcyA9IGNkY2xrX3N0YXRlLT5yZWY7Ci0KLQlpZiAoY2Rj
bGtfc3RhdGUtPnZjbyA9PSAwKQotCQlnb3RvIG91dDsKLQotCWRpdmlkZXIgPSBJOTE1X1JFQUQo
Q0RDTEtfQ1RMKSAmIEJYVF9DRENMS19DRDJYX0RJVl9TRUxfTUFTSzsKLQotCXN3aXRjaCAoZGl2
aWRlcikgewotCWNhc2UgQlhUX0NEQ0xLX0NEMlhfRElWX1NFTF8xOgotCQlkaXYgPSAyOwotCQli
cmVhazsKLQljYXNlIEJYVF9DRENMS19DRDJYX0RJVl9TRUxfMjoKLQkJZGl2ID0gNDsKLQkJYnJl
YWs7Ci0JZGVmYXVsdDoKLQkJTUlTU0lOR19DQVNFKGRpdmlkZXIpOwotCQlyZXR1cm47Ci0JfQot
Ci0JY2RjbGtfc3RhdGUtPmNkY2xrID0gRElWX1JPVU5EX0NMT1NFU1QoY2RjbGtfc3RhdGUtPnZj
bywgZGl2KTsKLQotIG91dDoKLQkvKgotCSAqIENhbid0IHJlYWQgdGhpcyBvdXQgOiggTGV0J3Mg
YXNzdW1lIGl0J3MKLQkgKiBhdCBsZWFzdCB3aGF0IHRoZSBDRENMSyBmcmVxdWVuY3kgcmVxdWly
ZXMuCi0JICovCi0JY2RjbGtfc3RhdGUtPnZvbHRhZ2VfbGV2ZWwgPQotCQljbmxfY2FsY192b2x0
YWdlX2xldmVsKGNkY2xrX3N0YXRlLT5jZGNsayk7Ci19Ci0KIHN0YXRpYyB2b2lkIGNubF9jZGNs
a19wbGxfZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7CiAJdTMy
IHZhbDsKQEAgLTE4MzAsOTEgKzE4NTQsNiBAQCBzdGF0aWMgaW50IGljbF9jYWxjX2NkY2xrX3Bs
bF92Y28oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBpbnQgY2RjbGspCiAJcmV0
dXJuIGRldl9wcml2LT5jZGNsay5ody5yZWYgKiByYXRpbzsKIH0KIAotc3RhdGljIHU4IGljbF9j
YWxjX3ZvbHRhZ2VfbGV2ZWwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBpbnQg
Y2RjbGspCi17Ci0JaWYgKElTX0VMS0hBUlRMQUtFKGRldl9wcml2KSkgewotCQlpZiAoY2RjbGsg
PiAzMTIwMDApCi0JCQlyZXR1cm4gMjsKLQkJZWxzZSBpZiAoY2RjbGsgPiAxODAwMDApCi0JCQly
ZXR1cm4gMTsKLQkJZWxzZQotCQkJcmV0dXJuIDA7Ci0JfSBlbHNlIHsKLQkJaWYgKGNkY2xrID4g
NTU2ODAwKQotCQkJcmV0dXJuIDI7Ci0JCWVsc2UgaWYgKGNkY2xrID4gMzEyMDAwKQotCQkJcmV0
dXJuIDE7Ci0JCWVsc2UKLQkJCXJldHVybiAwOwotCX0KLX0KLQotc3RhdGljIHZvaWQgaWNsX2dl
dF9jZGNsayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCi0JCQkgIHN0cnVjdCBp
bnRlbF9jZGNsa19zdGF0ZSAqY2RjbGtfc3RhdGUpCi17Ci0JdTMyIHZhbDsKLQlpbnQgZGl2Owot
Ci0JdmFsID0gSTkxNV9SRUFEKFNLTF9EU1NNKTsKLQlzd2l0Y2ggKHZhbCAmIElDTF9EU1NNX0NE
Q0xLX1BMTF9SRUZDTEtfTUFTSykgewotCWRlZmF1bHQ6Ci0JCU1JU1NJTkdfQ0FTRSh2YWwpOwot
CQkvKiBmYWxsIHRocm91Z2ggKi8KLQljYXNlIElDTF9EU1NNX0NEQ0xLX1BMTF9SRUZDTEtfMjRN
SHo6Ci0JCWNkY2xrX3N0YXRlLT5yZWYgPSAyNDAwMDsKLQkJYnJlYWs7Ci0JY2FzZSBJQ0xfRFNT
TV9DRENMS19QTExfUkVGQ0xLXzE5XzJNSHo6Ci0JCWNkY2xrX3N0YXRlLT5yZWYgPSAxOTIwMDsK
LQkJYnJlYWs7Ci0JY2FzZSBJQ0xfRFNTTV9DRENMS19QTExfUkVGQ0xLXzM4XzRNSHo6Ci0JCWNk
Y2xrX3N0YXRlLT5yZWYgPSAzODQwMDsKLQkJYnJlYWs7Ci0JfQotCi0JaWYgKElOVEVMX0dFTihk
ZXZfcHJpdikgPj0gMTIpCi0JCWNkY2xrX3N0YXRlLT5ieXBhc3MgPSBjZGNsa19zdGF0ZS0+cmVm
IC8gMjsKLQllbHNlCi0JCWNkY2xrX3N0YXRlLT5ieXBhc3MgPSA1MDAwMDsKLQotCXZhbCA9IEk5
MTVfUkVBRChCWFRfREVfUExMX0VOQUJMRSk7Ci0JaWYgKCh2YWwgJiBCWFRfREVfUExMX1BMTF9F
TkFCTEUpID09IDAgfHwKLQkgICAgKHZhbCAmIEJYVF9ERV9QTExfTE9DSykgPT0gMCkgewotCQkv
KgotCQkgKiBDRENMSyBQTEwgaXMgZGlzYWJsZWQsIHRoZSBWQ08vcmF0aW8gZG9lc24ndCBtYXR0
ZXIsIGJ1dAotCQkgKiBzZXR0aW5nIGl0IHRvIHplcm8gaXMgYSB3YXkgdG8gc2lnbmFsIHRoYXQu
Ci0JCSAqLwotCQljZGNsa19zdGF0ZS0+dmNvID0gMDsKLQkJY2RjbGtfc3RhdGUtPmNkY2xrID0g
Y2RjbGtfc3RhdGUtPmJ5cGFzczsKLQkJZ290byBvdXQ7Ci0JfQotCi0JY2RjbGtfc3RhdGUtPnZj
byA9ICh2YWwgJiBCWFRfREVfUExMX1JBVElPX01BU0spICogY2RjbGtfc3RhdGUtPnJlZjsKLQot
CXZhbCA9IEk5MTVfUkVBRChDRENMS19DVEwpICYgQlhUX0NEQ0xLX0NEMlhfRElWX1NFTF9NQVNL
OwotCXN3aXRjaCAodmFsKSB7Ci0JY2FzZSBCWFRfQ0RDTEtfQ0QyWF9ESVZfU0VMXzE6Ci0JCWRp
diA9IDI7Ci0JCWJyZWFrOwotCWNhc2UgQlhUX0NEQ0xLX0NEMlhfRElWX1NFTF8yOgotCQlkaXYg
PSA0OwotCQlicmVhazsKLQlkZWZhdWx0OgotCQlNSVNTSU5HX0NBU0UodmFsKTsKLQkJZGl2ID0g
MjsKLQkJYnJlYWs7Ci0JfQotCi0JY2RjbGtfc3RhdGUtPmNkY2xrID0gRElWX1JPVU5EX0NMT1NF
U1QoY2RjbGtfc3RhdGUtPnZjbywgZGl2KTsKLQotb3V0OgotCS8qCi0JICogQ2FuJ3QgcmVhZCB0
aGlzIG91dCA6KCBMZXQncyBhc3N1bWUgaXQncwotCSAqIGF0IGxlYXN0IHdoYXQgdGhlIENEQ0xL
IGZyZXF1ZW5jeSByZXF1aXJlcy4KLQkgKi8KLQljZGNsa19zdGF0ZS0+dm9sdGFnZV9sZXZlbCA9
Ci0JCWljbF9jYWxjX3ZvbHRhZ2VfbGV2ZWwoZGV2X3ByaXYsIGNkY2xrX3N0YXRlLT5jZGNsayk7
Ci19Ci0KIHN0YXRpYyB2b2lkIGljbF9pbml0X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKIHsKIAlzdHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUgc2FuaXRpemVkX3N0YXRl
OwpAQCAtMTk0Niw5ICsxODg1LDEyIEBAIHN0YXRpYyB2b2lkIGljbF9pbml0X2NkY2xrKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlzYW5pdGl6ZWRfc3RhdGUuY2RjbGsgPSBp
Y2xfY2FsY19jZGNsaygwLCBzYW5pdGl6ZWRfc3RhdGUucmVmKTsKIAlzYW5pdGl6ZWRfc3RhdGUu
dmNvID0gaWNsX2NhbGNfY2RjbGtfcGxsX3ZjbyhkZXZfcHJpdiwKIAkJCQkJCSAgICAgc2FuaXRp
emVkX3N0YXRlLmNkY2xrKTsKLQlzYW5pdGl6ZWRfc3RhdGUudm9sdGFnZV9sZXZlbCA9Ci0JCQkJ
aWNsX2NhbGNfdm9sdGFnZV9sZXZlbChkZXZfcHJpdiwKLQkJCQkJCSAgICAgICBzYW5pdGl6ZWRf
c3RhdGUuY2RjbGspOworCWlmIChJU19FTEtIQVJUTEFLRShkZXZfcHJpdikpCisJCXNhbml0aXpl
ZF9zdGF0ZS52b2x0YWdlX2xldmVsID0KKwkJCWVobF9jYWxjX3ZvbHRhZ2VfbGV2ZWwoc2FuaXRp
emVkX3N0YXRlLmNkY2xrKTsKKwllbHNlCisJCXNhbml0aXplZF9zdGF0ZS52b2x0YWdlX2xldmVs
ID0KKwkJCWljbF9jYWxjX3ZvbHRhZ2VfbGV2ZWwoc2FuaXRpemVkX3N0YXRlLmNkY2xrKTsKIAog
CWNubF9zZXRfY2RjbGsoZGV2X3ByaXYsICZzYW5pdGl6ZWRfc3RhdGUsIElOVkFMSURfUElQRSk7
CiB9CkBAIC0xOTU5LDggKzE5MDEsMTIgQEAgc3RhdGljIHZvaWQgaWNsX3VuaW5pdF9jZGNsayhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAKIAljZGNsa19zdGF0ZS5jZGNsayA9
IGNkY2xrX3N0YXRlLmJ5cGFzczsKIAljZGNsa19zdGF0ZS52Y28gPSAwOwotCWNkY2xrX3N0YXRl
LnZvbHRhZ2VfbGV2ZWwgPSBpY2xfY2FsY192b2x0YWdlX2xldmVsKGRldl9wcml2LAotCQkJCQkJ
CSAgIGNkY2xrX3N0YXRlLmNkY2xrKTsKKwlpZiAoSVNfRUxLSEFSVExBS0UoZGV2X3ByaXYpKQor
CQljZGNsa19zdGF0ZS52b2x0YWdlX2xldmVsID0KKwkJCWVobF9jYWxjX3ZvbHRhZ2VfbGV2ZWwo
Y2RjbGtfc3RhdGUuY2RjbGspOworCWVsc2UKKwkJY2RjbGtfc3RhdGUudm9sdGFnZV9sZXZlbCA9
CisJCQlpY2xfY2FsY192b2x0YWdlX2xldmVsKGNkY2xrX3N0YXRlLmNkY2xrKTsKIAogCWNubF9z
ZXRfY2RjbGsoZGV2X3ByaXYsICZjZGNsa19zdGF0ZSwgSU5WQUxJRF9QSVBFKTsKIH0KQEAgLTI1
NjEsOSArMjUwNywxNCBAQCBzdGF0aWMgaW50IGljbF9tb2Rlc2V0X2NhbGNfY2RjbGsoc3RydWN0
IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAKIAlzdGF0ZS0+Y2RjbGsubG9naWNhbC52Y28g
PSB2Y287CiAJc3RhdGUtPmNkY2xrLmxvZ2ljYWwuY2RjbGsgPSBjZGNsazsKLQlzdGF0ZS0+Y2Rj
bGsubG9naWNhbC52b2x0YWdlX2xldmVsID0KLQkJbWF4KGljbF9jYWxjX3ZvbHRhZ2VfbGV2ZWwo
ZGV2X3ByaXYsIGNkY2xrKSwKLQkJICAgIGNubF9jb21wdXRlX21pbl92b2x0YWdlX2xldmVsKHN0
YXRlKSk7CisJaWYgKElTX0VMS0hBUlRMQUtFKGRldl9wcml2KSkKKwkJc3RhdGUtPmNkY2xrLmxv
Z2ljYWwudm9sdGFnZV9sZXZlbCA9CisJCQltYXgoZWhsX2NhbGNfdm9sdGFnZV9sZXZlbChjZGNs
ayksCisJCQkgICAgY25sX2NvbXB1dGVfbWluX3ZvbHRhZ2VfbGV2ZWwoc3RhdGUpKTsKKwllbHNl
CisJCXN0YXRlLT5jZGNsay5sb2dpY2FsLnZvbHRhZ2VfbGV2ZWwgPQorCQkJbWF4KGljbF9jYWxj
X3ZvbHRhZ2VfbGV2ZWwoY2RjbGspLAorCQkJICAgIGNubF9jb21wdXRlX21pbl92b2x0YWdlX2xl
dmVsKHN0YXRlKSk7CiAKIAlpZiAoIXN0YXRlLT5hY3RpdmVfcGlwZXMpIHsKIAkJY2RjbGsgPSBp
Y2xfY2FsY19jZGNsayhzdGF0ZS0+Y2RjbGsuZm9yY2VfbWluX2NkY2xrLCByZWYpOwpAQCAtMjU3
MSw4ICsyNTIyLDEyIEBAIHN0YXRpYyBpbnQgaWNsX21vZGVzZXRfY2FsY19jZGNsayhzdHJ1Y3Qg
aW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAogCQlzdGF0ZS0+Y2RjbGsuYWN0dWFsLnZjbyA9
IHZjbzsKIAkJc3RhdGUtPmNkY2xrLmFjdHVhbC5jZGNsayA9IGNkY2xrOwotCQlzdGF0ZS0+Y2Rj
bGsuYWN0dWFsLnZvbHRhZ2VfbGV2ZWwgPQotCQkJaWNsX2NhbGNfdm9sdGFnZV9sZXZlbChkZXZf
cHJpdiwgY2RjbGspOworCQlpZiAoSVNfRUxLSEFSVExBS0UoZGV2X3ByaXYpKQorCQkJc3RhdGUt
PmNkY2xrLmFjdHVhbC52b2x0YWdlX2xldmVsID0KKwkJCQllaGxfY2FsY192b2x0YWdlX2xldmVs
KGNkY2xrKTsKKwkJZWxzZQorCQkJc3RhdGUtPmNkY2xrLmFjdHVhbC52b2x0YWdlX2xldmVsID0K
KwkJCQlpY2xfY2FsY192b2x0YWdlX2xldmVsKGNkY2xrKTsKIAl9IGVsc2UgewogCQlzdGF0ZS0+
Y2RjbGsuYWN0dWFsID0gc3RhdGUtPmNkY2xrLmxvZ2ljYWw7CiAJfQpAQCAtMjgxOSwxMSArMjc3
NCw3IEBAIHZvaWQgaW50ZWxfaW5pdF9jZGNsa19ob29rcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCiAJCWRldl9wcml2LT5kaXNwbGF5Lm1vZGVzZXRfY2FsY19jZGNsayA9IHZs
dl9tb2Rlc2V0X2NhbGNfY2RjbGs7CiAJfQogCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
MTEpCi0JCWRldl9wcml2LT5kaXNwbGF5LmdldF9jZGNsayA9IGljbF9nZXRfY2RjbGs7Ci0JZWxz
ZSBpZiAoSVNfQ0FOTk9OTEFLRShkZXZfcHJpdikpCi0JCWRldl9wcml2LT5kaXNwbGF5LmdldF9j
ZGNsayA9IGNubF9nZXRfY2RjbGs7Ci0JZWxzZSBpZiAoSVNfR0VOOV9MUChkZXZfcHJpdikpCisJ
aWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VOOV9MUChkZXZfcHJpdikpCiAJ
CWRldl9wcml2LT5kaXNwbGF5LmdldF9jZGNsayA9IGJ4dF9nZXRfY2RjbGs7CiAJZWxzZSBpZiAo
SVNfR0VOOV9CQyhkZXZfcHJpdikpCiAJCWRldl9wcml2LT5kaXNwbGF5LmdldF9jZGNsayA9IHNr
bF9nZXRfY2RjbGs7Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZy
ZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL2ludGVsLWdmeA==

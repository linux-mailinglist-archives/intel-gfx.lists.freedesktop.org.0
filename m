Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 83168B7A41
	for <lists+intel-gfx@lfdr.de>; Thu, 19 Sep 2019 15:14:51 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B6DDD6F496;
	Thu, 19 Sep 2019 13:14:49 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3AB346F672
 for <intel-gfx@lists.freedesktop.org>; Thu, 19 Sep 2019 13:14:48 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18546057-1500050 
 for multiple; Thu, 19 Sep 2019 14:14:16 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 19 Sep 2019 14:14:14 +0100
Message-Id: <20190919131414.7495-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190915163749.19540-1-chris@chris-wilson.co.uk>
References: <20190915163749.19540-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2] drm/i915/selftests: Exercise CS TLB
 invalidation
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q2hlY2sgdGhhdCB3ZSBhcmUgY29ycmVjdGx5IGludmFsaWRhdGluZyB0aGUgVExCIGF0IHRoZSBz
dGFydCBvZiBhCmJhdGNoIGFmdGVyIHVwZGF0aW5nIHRoZSBHVFQuCgp2MjogQ29tbWVudHMgYW5k
IGhvbGQgdGhlIHJlcXVlc3QgcmVmZXJlbmNlIHdoaWxlIHNwaW5uaW5nCgpTaWduZWQtb2ZmLWJ5
OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IE1pa2EgS3VvcHBh
bGEgPG1pa2Eua3VvcHBhbGFAbGludXguaW50ZWwuY29tPgpDYzogRGFuaWVsZSBDZXJhb2xvIFNw
dXJpbyA8ZGFuaWVsZS5jZXJhb2xvc3B1cmlvQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMgfCAzMDggKysrKysrKysrKysrKysrKysr
CiAxIGZpbGUgY2hhbmdlZCwgMzA4IGluc2VydGlvbnMoKykKCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMKaW5kZXggNTk4YzE4ZDEwNjQwLi5hYTdiZTkw
ODllMmQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dl
bV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0
LmMKQEAgLTI1LDEzICsyNSwxNiBAQAogI2luY2x1ZGUgPGxpbnV4L2xpc3Rfc29ydC5oPgogI2lu
Y2x1ZGUgPGxpbnV4L3ByaW1lX251bWJlcnMuaD4KIAorI2luY2x1ZGUgImdlbS9pOTE1X2dlbV9j
b250ZXh0LmgiCiAjaW5jbHVkZSAiZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQuaCIKKyNpbmNs
dWRlICJndC9pbnRlbF9jb250ZXh0LmgiCiAKICNpbmNsdWRlICJpOTE1X3JhbmRvbS5oIgogI2lu
Y2x1ZGUgImk5MTVfc2VsZnRlc3QuaCIKIAogI2luY2x1ZGUgIm1vY2tfZHJtLmgiCiAjaW5jbHVk
ZSAibW9ja19nZW1fZGV2aWNlLmgiCisjaW5jbHVkZSAiaWd0X2ZsdXNoX3Rlc3QuaCIKIAogc3Rh
dGljIHZvaWQgY2xlYW51cF9mcmVlZF9vYmplY3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQogewpAQCAtMTcwNSw2ICsxNzA4LDMxMCBAQCBpbnQgaTkxNV9nZW1fZ3R0X21vY2tfc2Vs
ZnRlc3RzKHZvaWQpCiAJcmV0dXJuIGVycjsKIH0KIAorc3RhdGljIGludCBjb250ZXh0X3N5bmMo
c3RydWN0IGludGVsX2NvbnRleHQgKmNlKQoreworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwor
CWxvbmcgdGltZW91dDsKKworCXJxID0gaW50ZWxfY29udGV4dF9jcmVhdGVfcmVxdWVzdChjZSk7
CisJaWYgKElTX0VSUihycSkpCisJCXJldHVybiBQVFJfRVJSKHJxKTsKKworCWk5MTVfcmVxdWVz
dF9nZXQocnEpOworCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCisJdGltZW91dCA9IGk5MTVfcmVx
dWVzdF93YWl0KHJxLCAwLCBIWiAvIDUpOworCWk5MTVfcmVxdWVzdF9wdXQocnEpOworCisJcmV0
dXJuIHRpbWVvdXQgPCAwID8gLUVJTyA6IDA7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICoKK3N1Ym1pdF9iYXRjaChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIHU2NCBhZGRyKQor
eworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCWludCBlcnI7CisKKwlycSA9IGludGVsX2Nv
bnRleHRfY3JlYXRlX3JlcXVlc3QoY2UpOworCWlmIChJU19FUlIocnEpKQorCQlyZXR1cm4gcnE7
CisKKwllcnIgPSAwOworCWlmIChycS0+ZW5naW5lLT5lbWl0X2luaXRfYnJlYWRjcnVtYikgLyog
ZGV0ZWN0IGEgaGFuZyAqLworCQllcnIgPSBycS0+ZW5naW5lLT5lbWl0X2luaXRfYnJlYWRjcnVt
YihycSk7CisJaWYgKGVyciA9PSAwKQorCQllcnIgPSBycS0+ZW5naW5lLT5lbWl0X2JiX3N0YXJ0
KHJxLCBhZGRyLCAwLCAwKTsKKworCWlmIChlcnIgPT0gMCkKKwkJaTkxNV9yZXF1ZXN0X2dldChy
cSk7CisJaTkxNV9yZXF1ZXN0X2FkZChycSk7CisKKwlyZXR1cm4gZXJyID8gRVJSX1BUUihlcnIp
IDogcnE7Cit9CisKK3N0YXRpYyB1MzIgKnNwaW5uZXIodTMyICpiYXRjaCwgaW50IGkpCit7CisJ
cmV0dXJuIGJhdGNoICsgaSAqIDY0IC8gc2l6ZW9mKCpiYXRjaCkgKyA0OworfQorCitzdGF0aWMg
dm9pZCBlbmRfc3Bpbih1MzIgKmJhdGNoLCBpbnQgaSkKK3sKKwkqc3Bpbm5lcihiYXRjaCwgaSkg
PSBNSV9CQVRDSF9CVUZGRVJfRU5EOworCXdtYigpOworfQorCitzdGF0aWMgaW50IGlndF9jc190
bGIodm9pZCAqYXJnKQoreworCWNvbnN0IHVuc2lnbmVkIGludCBjb3VudCA9IFBBR0VfU0laRSAv
IDY0OworCWNvbnN0IHVuc2lnbmVkIGludCBjaHVua19zaXplID0gY291bnQgKiBQQUdFX1NJWkU7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CisJc3RydWN0IGRybV9pOTE1
X2dlbV9vYmplY3QgKmJiZSwgKmFjdCwgKm91dDsKKwlzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lc19p
dGVyIGl0OworCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtOworCXN0cnVjdCBpOTE1X2dl
bV9jb250ZXh0ICpjdHg7CisJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOworCXN0cnVjdCBkcm1f
ZmlsZSAqZmlsZTsKKwlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKKwl1bnNpZ25lZCBpbnQgaTsKKwl1
MzIgKnJlc3VsdDsKKwl1MzIgKmJhdGNoOworCWludCBlcnIgPSAwOworCisJLyoKKwkgKiBPdXIg
bWlzc2lvbiBoZXJlIGlzIHRvIGZvb2wgdGhlIGhhcmR3YXJlIHRvIGV4ZWN1dGUgc29tZXRoaW5n
CisJICogZnJvbSBzY3JhdGNoIGFzIGl0IGhhcyBub3Qgc2VlbiB0aGUgYmF0Y2ggbW92ZSAoZHVl
IHRvIG1pc3NpbmcKKwkgKiB0aGUgVExCIGludmFsaWRhdGUpLgorCSAqLworCisJZmlsZSA9IG1v
Y2tfZmlsZShpOTE1KTsKKwlpZiAoSVNfRVJSKGZpbGUpKQorCQlyZXR1cm4gUFRSX0VSUihmaWxl
KTsKKworCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWN0eCA9IGxpdmVf
Y29udGV4dChpOTE1LCBmaWxlKTsKKwlpZiAoSVNfRVJSKGN0eCkpIHsKKwkJZXJyID0gUFRSX0VS
UihjdHgpOworCQlnb3RvIG91dF91bmxvY2s7CisJfQorCisJdm0gPSBjdHgtPnZtOworCWlmICgh
dm0pCisJCWdvdG8gb3V0X3VubG9jazsKKworCS8qIENyZWF0ZSB0d28gcGFnZXM7IGR1bW15IHdl
IHByZWZpbGwgdGhlIFRMQiwgYW5kIGludGVuZGVkICovCisJYmJlID0gaTkxNV9nZW1fb2JqZWN0
X2NyZWF0ZV9pbnRlcm5hbChpOTE1LCBQQUdFX1NJWkUpOworCWlmIChJU19FUlIoYmJlKSkgewor
CQllcnIgPSBQVFJfRVJSKGJiZSk7CisJCWdvdG8gb3V0X3VubG9jazsKKwl9CisKKwliYXRjaCA9
IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKGJiZSwgSTkxNV9NQVBfV0MpOworCWlmIChJU19FUlIo
YmF0Y2gpKSB7CisJCWVyciA9IFBUUl9FUlIoYmF0Y2gpOworCQlnb3RvIG91dF9iYmU7CisJfQor
CW1lbXNldDMyKGJhdGNoLCBNSV9CQVRDSF9CVUZGRVJfRU5ELCBQQUdFX1NJWkUgLyBzaXplb2Yo
dTMyKSk7CisJaTkxNV9nZW1fb2JqZWN0X2ZsdXNoX21hcChiYmUpOworCWk5MTVfZ2VtX29iamVj
dF91bnBpbl9tYXAoYmJlKTsKKworCWFjdCA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJu
YWwoaTkxNSwgUEFHRV9TSVpFKTsKKwlpZiAoSVNfRVJSKGFjdCkpIHsKKwkJZXJyID0gUFRSX0VS
UihhY3QpOworCQlnb3RvIG91dF9iYmU7CisJfQorCisJLyogVHJhY2sgdGhlIGV4ZWN1dGlvbiBv
ZiBlYWNoIHJlcXVlc3QgYnkgd3JpdGluZyBpbnRvIGRpZmZlcmVudCBzbG90ICovCisJYmF0Y2gg
PSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChhY3QsIEk5MTVfTUFQX1dDKTsKKwlpZiAoSVNfRVJS
KGJhdGNoKSkgeworCQllcnIgPSBQVFJfRVJSKGJhdGNoKTsKKwkJZ290byBvdXRfYWN0OworCX0K
Kwlmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykgeworCQl1MzIgKmNzID0gYmF0Y2ggKyBpICog
NjQgLyBzaXplb2YoKmNzKTsKKwkJdTY0IGFkZHIgPSAodm0tPnRvdGFsIC0gUEFHRV9TSVpFKSAr
IGkgKiBzaXplb2YodTMyKTsKKworCQlHRU1fQlVHX09OKElOVEVMX0dFTihpOTE1KSA8IDYpOwor
CQljc1swXSA9IE1JX1NUT1JFX0RXT1JEX0lNTV9HRU40OworCQlpZiAoSU5URUxfR0VOKGk5MTUp
ID49IDgpIHsKKwkJCWNzWzFdID0gbG93ZXJfMzJfYml0cyhhZGRyKTsKKwkJCWNzWzJdID0gdXBw
ZXJfMzJfYml0cyhhZGRyKTsKKwkJCWNzWzNdID0gaTsKKwkJCWNzWzRdID0gTUlfTk9PUDsKKwkJ
CWNzWzVdID0gTUlfQkFUQ0hfQlVGRkVSX1NUQVJUX0dFTjg7CisJCX0gZWxzZSB7CisJCQljc1sx
XSA9IDA7CisJCQljc1syXSA9IGxvd2VyXzMyX2JpdHMoYWRkcik7CisJCQljc1szXSA9IGk7CisJ
CQljc1s0XSA9IE1JX05PT1A7CisJCQljc1s1XSA9IE1JX0JBVENIX0JVRkZFUl9TVEFSVDsKKwkJ
fQorCX0KKworCW91dCA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoaTkxNSwgUEFH
RV9TSVpFKTsKKwlpZiAoSVNfRVJSKG91dCkpIHsKKwkJZXJyID0gUFRSX0VSUihvdXQpOworCQln
b3RvIG91dF9iYXRjaDsKKwl9CisJaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNoZV9jb2hlcmVuY3ko
b3V0LCBJOTE1X0NBQ0hJTkdfQ0FDSEVEKTsKKworCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG91
dCwgdm0sIE5VTEwpOworCWlmIChJU19FUlIodm1hKSkgeworCQllcnIgPSBQVFJfRVJSKHZtYSk7
CisJCWdvdG8gb3V0X2JhdGNoOworCX0KKworCWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAs
CisJCQkgICBQSU5fVVNFUiB8CisJCQkgICBQSU5fT0ZGU0VUX0ZJWEVEIHwKKwkJCSAgICh2bS0+
dG90YWwgLSBQQUdFX1NJWkUpKTsKKwlpZiAoZXJyKQorCQlnb3RvIG91dF9vdXQ7CisJR0VNX0JV
R19PTih2bWEtPm5vZGUuc3RhcnQgIT0gdm0tPnRvdGFsIC0gUEFHRV9TSVpFKTsKKworCXJlc3Vs
dCA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKG91dCwgSTkxNV9NQVBfV0IpOworCWlmIChJU19F
UlIocmVzdWx0KSkgeworCQllcnIgPSBQVFJfRVJSKHJlc3VsdCk7CisJCWdvdG8gb3V0X291dDsK
Kwl9CisKKwlmb3JfZWFjaF9nZW1fZW5naW5lKGNlLCBpOTE1X2dlbV9jb250ZXh0X2xvY2tfZW5n
aW5lcyhjdHgpLCBpdCkgeworCQlJR1RfVElNRU9VVChlbmRfdGltZSk7CisJCXVuc2lnbmVkIGxv
bmcgcGFzcyA9IDA7CisKKwkJaWYgKCFpbnRlbF9lbmdpbmVfY2FuX3N0b3JlX2R3b3JkKGNlLT5l
bmdpbmUpKQorCQkJY29udGludWU7CisKKwkJd2hpbGUgKCFfX2lndF90aW1lb3V0KGVuZF90aW1l
LCBOVUxMKSkgeworCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJCQl1NjQgb2Zmc2V0Owor
CisJCQlvZmZzZXQgPSByYW5kb21fb2Zmc2V0KDAsIHZtLT50b3RhbCAtIFBBR0VfU0laRSwKKwkJ
CQkJICAgICAgIGNodW5rX3NpemUsIFBBR0VfU0laRSk7CisKKwkJCWVyciA9IHZtLT5hbGxvY2F0
ZV92YV9yYW5nZSh2bSwgb2Zmc2V0LCBjaHVua19zaXplKTsKKwkJCWlmIChlcnIpCisJCQkJZ290
byBlbmQ7CisKKwkJCW1lbXNldDMyKHJlc3VsdCwgU1RBQ0tfTUFHSUMsIFBBR0VfU0laRSAvIHNp
emVvZih1MzIpKTsKKworCQkJdm1hID0gaTkxNV92bWFfaW5zdGFuY2UoYmJlLCB2bSwgTlVMTCk7
CisJCQlpZiAoSVNfRVJSKHZtYSkpIHsKKwkJCQllcnIgPSBQVFJfRVJSKHZtYSk7CisJCQkJZ290
byBlbmQ7CisJCQl9CisKKwkJCWVyciA9IHZtYS0+b3BzLT5zZXRfcGFnZXModm1hKTsKKwkJCWlm
IChlcnIpCisJCQkJZ290byBlbmQ7CisKKwkJCS8qIFByaW1lIHRoZSBUTEIgd2l0aCB0aGUgZHVt
bXkgcGFnZXMgKi8KKwkJCWZvciAoaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CisJCQkJdm1hLT5u
b2RlLnN0YXJ0ID0gb2Zmc2V0ICsgaSAqIFBBR0VfU0laRTsKKwkJCQl2bS0+aW5zZXJ0X2VudHJp
ZXModm0sIHZtYSwgSTkxNV9DQUNIRV9OT05FLCAwKTsKKworCQkJCXJxID0gc3VibWl0X2JhdGNo
KGNlLCB2bWEtPm5vZGUuc3RhcnQpOworCQkJCWlmIChJU19FUlIocnEpKSB7CisJCQkJCWVyciA9
IFBUUl9FUlIocnEpOworCQkJCQlnb3RvIGVuZDsKKwkJCQl9CisJCQkJaTkxNV9yZXF1ZXN0X3B1
dChycSk7CisJCQl9CisKKwkJCXZtYS0+b3BzLT5jbGVhcl9wYWdlcyh2bWEpOworCisJCQllcnIg
PSBjb250ZXh0X3N5bmMoY2UpOworCQkJaWYgKGVycikgeworCQkJCXByX2VycigiJXM6IGR1bW15
IHNldHVwIHRpbWVkIG91dFxuIiwKKwkJCQkgICAgICAgY2UtPmVuZ2luZS0+bmFtZSk7CisJCQkJ
Z290byBlbmQ7CisJCQl9CisKKwkJCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKGFjdCwgdm0sIE5V
TEwpOworCQkJaWYgKElTX0VSUih2bWEpKSB7CisJCQkJZXJyID0gUFRSX0VSUih2bWEpOworCQkJ
CWdvdG8gZW5kOworCQkJfQorCisJCQllcnIgPSB2bWEtPm9wcy0+c2V0X3BhZ2VzKHZtYSk7CisJ
CQlpZiAoZXJyKQorCQkJCWdvdG8gZW5kOworCisJCQkvKiBSZXBsYWNlIHRoZSBUTEIgd2l0aCB0
YXJnZXQgYmF0Y2hlcyAqLworCQkJZm9yIChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKKwkJCQlz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKKwkJCQl1MzIgKmNzID0gYmF0Y2ggKyBpICogNjQgLyBz
aXplb2YoKmNzKTsKKwkJCQl1NjQgYWRkcjsKKworCQkJCXZtYS0+bm9kZS5zdGFydCA9IG9mZnNl
dCArIGkgKiBQQUdFX1NJWkU7CisJCQkJdm0tPmluc2VydF9lbnRyaWVzKHZtLCB2bWEsIEk5MTVf
Q0FDSEVfTk9ORSwgMCk7CisKKwkJCQlhZGRyID0gdm1hLT5ub2RlLnN0YXJ0ICsgaSAqIDY0Owor
CQkJCWNzWzRdID0gTUlfTk9PUDsKKwkJCQljc1s2XSA9IGxvd2VyXzMyX2JpdHMoYWRkcik7CisJ
CQkJY3NbN10gPSB1cHBlcl8zMl9iaXRzKGFkZHIpOworCQkJCXdtYigpOworCisJCQkJcnEgPSBz
dWJtaXRfYmF0Y2goY2UsIGFkZHIpOworCQkJCWlmIChJU19FUlIocnEpKSB7CisJCQkJCWVyciA9
IFBUUl9FUlIocnEpOworCQkJCQlnb3RvIGVuZDsKKwkJCQl9CisKKwkJCQkvKiBXYWl0IHVudGls
IHRoZSBjb250ZXh0IGNoYWluIGhhcyBzdGFydGVkICovCisJCQkJaWYgKGkgPT0gMCkgeworCQkJ
CQl3aGlsZSAoUkVBRF9PTkNFKHJlc3VsdFtpXSkgJiYKKwkJCQkJICAgICAgICFpOTE1X3JlcXVl
c3RfY29tcGxldGVkKHJxKSkKKwkJCQkJCWNvbmRfcmVzY2hlZCgpOworCQkJCX0gZWxzZSB7CisJ
CQkJCWVuZF9zcGluKGJhdGNoLCBpIC0gMSk7CisJCQkJfQorCisJCQkJaTkxNV9yZXF1ZXN0X3B1
dChycSk7CisJCQl9CisJCQllbmRfc3BpbihiYXRjaCwgY291bnQgLSAxKTsKKworCQkJdm1hLT5v
cHMtPmNsZWFyX3BhZ2VzKHZtYSk7CisKKwkJCWVyciA9IGNvbnRleHRfc3luYyhjZSk7CisJCQlp
ZiAoZXJyKSB7CisJCQkJcHJfZXJyKCIlczogd3JpdGVzIHRpbWVkIG91dFxuIiwKKwkJCQkgICAg
ICAgY2UtPmVuZ2luZS0+bmFtZSk7CisJCQkJZ290byBlbmQ7CisJCQl9CisKKwkJCWZvciAoaSA9
IDA7IGkgPCBjb3VudDsgaSsrKSB7CisJCQkJaWYgKHJlc3VsdFtpXSAhPSBpKSB7CisJCQkJCXBy
X2VycigiJXM6IFdyaXRlIGxvc3Qgb24gcGFzcyAlbHUsIGF0IG9mZnNldCAlbGx4LCBpbmRleCAl
ZCwgZm91bmQgJXgsIGV4cGVjdGVkICV4XG4iLAorCQkJCQkgICAgICAgY2UtPmVuZ2luZS0+bmFt
ZSwgcGFzcywKKwkJCQkJICAgICAgIG9mZnNldCwgaSwgcmVzdWx0W2ldLCBpKTsKKwkJCQkJZXJy
ID0gLUVJTlZBTDsKKwkJCQkJZ290byBlbmQ7CisJCQkJfQorCQkJfQorCisJCQl2bS0+Y2xlYXJf
cmFuZ2Uodm0sIG9mZnNldCwgY2h1bmtfc2l6ZSk7CisJCQlwYXNzKys7CisJCX0KKwl9CitlbmQ6
CisJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQorCQllcnIgPSAt
RUlPOworCWk5MTVfZ2VtX2NvbnRleHRfdW5sb2NrX2VuZ2luZXMoY3R4KTsKKwlpOTE1X2dlbV9v
YmplY3RfdW5waW5fbWFwKG91dCk7CitvdXRfb3V0OgorCWk5MTVfZ2VtX29iamVjdF9wdXQob3V0
KTsKK291dF9iYXRjaDoKKwlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKGFjdCk7CitvdXRfYWN0
OgorCWk5MTVfZ2VtX29iamVjdF9wdXQoYWN0KTsKK291dF9iYmU6CisJaTkxNV9nZW1fb2JqZWN0
X3B1dChiYmUpOworb3V0X3VubG9jazoKKwltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOworCW1vY2tfZmlsZV9mcmVlKGk5MTUsIGZpbGUpOworCXJldHVybiBlcnI7Cit9CisK
IGludCBpOTE1X2dlbV9ndHRfbGl2ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCiB7CiAJc3RhdGljIGNvbnN0IHN0cnVjdCBpOTE1X3N1YnRlc3QgdGVzdHNbXSA9IHsK
QEAgLTE3MjIsNiArMjAyOSw3IEBAIGludCBpOTE1X2dlbV9ndHRfbGl2ZV9zZWxmdGVzdHMoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJCVNVQlRFU1QoaWd0X2dndHRfcG90KSwKIAkJ
U1VCVEVTVChpZ3RfZ2d0dF9maWxsKSwKIAkJU1VCVEVTVChpZ3RfZ2d0dF9wYWdlKSwKKwkJU1VC
VEVTVChpZ3RfY3NfdGxiKSwKIAl9OwogCiAJR0VNX0JVR19PTihvZmZzZXRfaW5fcGFnZShpOTE1
LT5nZ3R0LnZtLnRvdGFsKSk7Ci0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxp
c3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFu
L2xpc3RpbmZvL2ludGVsLWdmeA==

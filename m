Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id DA7E54C4B5
	for <lists+intel-gfx@lfdr.de>; Thu, 20 Jun 2019 03:00:54 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C43A96E4AA;
	Thu, 20 Jun 2019 01:00:52 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga01.intel.com (mga01.intel.com [192.55.52.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D24926E4A3
 for <intel-gfx@lists.freedesktop.org>; Thu, 20 Jun 2019 01:00:48 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga007.jf.intel.com ([10.7.209.58])
 by fmsmga101.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 19 Jun 2019 18:00:48 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,394,1557212400"; d="scan'208";a="150774395"
Received: from dceraolo-linux.fm.intel.com ([10.1.27.145])
 by orsmga007.jf.intel.com with ESMTP; 19 Jun 2019 18:00:48 -0700
From: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 19 Jun 2019 18:00:20 -0700
Message-Id: <20190620010021.20637-6-daniele.ceraolospurio@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190620010021.20637-1-daniele.ceraolospurio@intel.com>
References: <20190620010021.20637-1-daniele.ceraolospurio@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 5/6] drm/i915: dynamically allocate forcewake
 domains
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UnZCBsaWtlIHRvIGludHJvZHVjZSBhIGRpc3BsYXkgdW5jb3JlIHdpdGggbm8gZm9yY2V3YWtl
IGRvbWFpbnMsIHNvCmxldCdzIGF2b2lkIHdhc3RpbmcgbWVtb3J5IGFuZCBiZSByZWFkeSB0byBh
bGxvY2F0ZSBvbmx5IHdoYXQgd2UgbmVlZC4KRXZlbiB3aXRob3V0IG11bHRpcGxlIHVuY29yZSwg
d2Ugc3RpbGwgZG9uJ3QgbmVlZCBhbGwgdGhlIGRvbWFpbnMgb24gYWxsCmdlbnMuCgp2MjogYXZv
aWQgaGlkZGVuIGNvbnRyb2wgZmxvdywgaW1wcm92ZSBjaGVja3MgKFR2cnRrbyksIGZpeCBJVkIg
c3BlY2lhbApjYXNlLCBhZGQgZmFpbHVyZSBpbmplY3Rpb24gcG9pbnQKClNpZ25lZC1vZmYtYnk6
IERhbmllbGUgQ2VyYW9sbyBTcHVyaW8gPGRhbmllbGUuY2VyYW9sb3NwdXJpb0BpbnRlbC5jb20+
CkNjOiBUdnJ0a28gVXJzdWxpbiA8dHZydGtvLnVyc3VsaW5AbGludXguaW50ZWwuY29tPgotLS0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3VuY29yZS5jIHwgMTAxICsrKysrKysrKysrKysr
KysrKysrLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3VuY29yZS5oIHwgIDEz
ICsrLS0KIDIgZmlsZXMgY2hhbmdlZCwgNzcgaW5zZXJ0aW9ucygrKSwgMzcgZGVsZXRpb25zKC0p
CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdW5jb3JlLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF91bmNvcmUuYwppbmRleCAwMGJmNWUwODVhMmMuLjJiZDYw
MmE0MWJiNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdW5jb3JlLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdW5jb3JlLmMKQEAgLTM0NCw3ICszNDQs
NyBAQCBpbnRlbF91bmNvcmVfZndfcmVsZWFzZV90aW1lcihzdHJ1Y3QgaHJ0aW1lciAqdGltZXIp
CiB7CiAJc3RydWN0IGludGVsX3VuY29yZV9mb3JjZXdha2VfZG9tYWluICpkb21haW4gPQogCSAg
ICAgICBjb250YWluZXJfb2YodGltZXIsIHN0cnVjdCBpbnRlbF91bmNvcmVfZm9yY2V3YWtlX2Rv
bWFpbiwgdGltZXIpOwotCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9IGZvcmNld2FrZV9k
b21haW5fdG9fdW5jb3JlKGRvbWFpbik7CisJc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0g
ZG9tYWluLT51bmNvcmU7CiAJdW5zaWduZWQgbG9uZyBpcnFmbGFnczsKIAogCWFzc2VydF9ycG1f
ZGV2aWNlX25vdF9zdXNwZW5kZWQodW5jb3JlLT5ycG0pOwpAQCAtMTI5MywyMyArMTI5MywyNyBA
QCBkbyB7IFwKIAkodW5jb3JlKS0+ZnVuY3MucmVhZF9md19kb21haW5zID0geCMjX3JlZ19yZWFk
X2Z3X2RvbWFpbnM7IFwKIH0gd2hpbGUgKDApCiAKLXN0YXRpYyB2b2lkIGZ3X2RvbWFpbl9pbml0
KHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSwKLQkJCSAgIGVudW0gZm9yY2V3YWtlX2RvbWFp
bl9pZCBkb21haW5faWQsCi0JCQkgICBpOTE1X3JlZ190IHJlZ19zZXQsCi0JCQkgICBpOTE1X3Jl
Z190IHJlZ19hY2spCitzdGF0aWMgaW50IF9fZndfZG9tYWluX2luaXQoc3RydWN0IGludGVsX3Vu
Y29yZSAqdW5jb3JlLAorCQkJICAgIGVudW0gZm9yY2V3YWtlX2RvbWFpbl9pZCBkb21haW5faWQs
CisJCQkgICAgaTkxNV9yZWdfdCByZWdfc2V0LAorCQkJICAgIGk5MTVfcmVnX3QgcmVnX2FjaykK
IHsKIAlzdHJ1Y3QgaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9kb21haW4gKmQ7CiAKLQlpZiAoV0FS
Tl9PTihkb21haW5faWQgPj0gRldfRE9NQUlOX0lEX0NPVU5UKSkKLQkJcmV0dXJuOworCUdFTV9C
VUdfT04oZG9tYWluX2lkID49IEZXX0RPTUFJTl9JRF9DT1VOVCk7CisJR0VNX0JVR19PTih1bmNv
cmUtPmZ3X2RvbWFpbltkb21haW5faWRdKTsKIAotCWQgPSAmdW5jb3JlLT5md19kb21haW5bZG9t
YWluX2lkXTsKKwlpZiAoaTkxNV9pbmplY3RfbG9hZF9mYWlsdXJlKCkpCisJCXJldHVybiAtRU5P
TUVNOwogCi0JV0FSTl9PTihkLT53YWtlX2NvdW50KTsKKwlkID0ga3phbGxvYyhzaXplb2YoKmQp
LCBHRlBfS0VSTkVMKTsKKwlpZiAoIWQpCisJCXJldHVybiAtRU5PTUVNOwogCiAJV0FSTl9PTigh
aTkxNV9tbWlvX3JlZ192YWxpZChyZWdfc2V0KSk7CiAJV0FSTl9PTighaTkxNV9tbWlvX3JlZ192
YWxpZChyZWdfYWNrKSk7CiAKKwlkLT51bmNvcmUgPSB1bmNvcmU7CiAJZC0+d2FrZV9jb3VudCA9
IDA7CiAJZC0+cmVnX3NldCA9IHVuY29yZS0+cmVncyArIGk5MTVfbW1pb19yZWdfb2Zmc2V0KHJl
Z19zZXQpOwogCWQtPnJlZ19hY2sgPSB1bmNvcmUtPnJlZ3MgKyBpOTE1X21taW9fcmVnX29mZnNl
dChyZWdfYWNrKTsKQEAgLTEzMjYsNyArMTMzMCw2IEBAIHN0YXRpYyB2b2lkIGZ3X2RvbWFpbl9p
bml0KHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSwKIAlCVUlMRF9CVUdfT04oRk9SQ0VXQUtF
X01FRElBX1ZFQk9YMCAhPSAoMSA8PCBGV19ET01BSU5fSURfTUVESUFfVkVCT1gwKSk7CiAJQlVJ
TERfQlVHX09OKEZPUkNFV0FLRV9NRURJQV9WRUJPWDEgIT0gKDEgPDwgRldfRE9NQUlOX0lEX01F
RElBX1ZFQk9YMSkpOwogCi0KIAlkLT5tYXNrID0gQklUKGRvbWFpbl9pZCk7CiAKIAlocnRpbWVy
X2luaXQoJmQtPnRpbWVyLCBDTE9DS19NT05PVE9OSUMsIEhSVElNRVJfTU9ERV9SRUwpOwpAQCAt
MTMzNSw2ICsxMzM4LDEwIEBAIHN0YXRpYyB2b2lkIGZ3X2RvbWFpbl9pbml0KHN0cnVjdCBpbnRl
bF91bmNvcmUgKnVuY29yZSwKIAl1bmNvcmUtPmZ3X2RvbWFpbnMgfD0gQklUKGRvbWFpbl9pZCk7
CiAKIAlmd19kb21haW5fcmVzZXQoZCk7CisKKwl1bmNvcmUtPmZ3X2RvbWFpbltkb21haW5faWRd
ID0gZDsKKworCXJldHVybiAwOwogfQogCiBzdGF0aWMgdm9pZCBmd19kb21haW5fZmluaShzdHJ1
Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUsCkBAIC0xMzQyLDI5ICsxMzQ5LDQxIEBAIHN0YXRpYyB2
b2lkIGZ3X2RvbWFpbl9maW5pKHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSwKIHsKIAlzdHJ1
Y3QgaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9kb21haW4gKmQ7CiAKLQlpZiAoV0FSTl9PTihkb21h
aW5faWQgPj0gRldfRE9NQUlOX0lEX0NPVU5UKSkKLQkJcmV0dXJuOworCUdFTV9CVUdfT04oZG9t
YWluX2lkID49IEZXX0RPTUFJTl9JRF9DT1VOVCk7CiAKLQlkID0gJnVuY29yZS0+ZndfZG9tYWlu
W2RvbWFpbl9pZF07CisJZCA9IGZldGNoX2FuZF96ZXJvKCZ1bmNvcmUtPmZ3X2RvbWFpbltkb21h
aW5faWRdKTsKKwlpZiAoIWQpCisJCXJldHVybjsKIAorCXVuY29yZS0+ZndfZG9tYWlucyAmPSB+
QklUKGRvbWFpbl9pZCk7CiAJV0FSTl9PTihkLT53YWtlX2NvdW50KTsKIAlXQVJOX09OKGhydGlt
ZXJfY2FuY2VsKCZkLT50aW1lcikpOwotCW1lbXNldChkLCAwLCBzaXplb2YoKmQpKTsKKwlrZnJl
ZShkKTsKK30KIAotCXVuY29yZS0+ZndfZG9tYWlucyAmPSB+QklUKGRvbWFpbl9pZCk7CitzdGF0
aWMgdm9pZCBpbnRlbF91bmNvcmVfZndfZG9tYWluc19maW5pKHN0cnVjdCBpbnRlbF91bmNvcmUg
KnVuY29yZSkKK3sKKwlzdHJ1Y3QgaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9kb21haW4gKmQ7CisJ
aW50IHRtcDsKKworCWZvcl9lYWNoX2Z3X2RvbWFpbihkLCB1bmNvcmUsIHRtcCkKKwkJZndfZG9t
YWluX2ZpbmkodW5jb3JlLCBkLT5pZCk7CiB9CiAKLXN0YXRpYyB2b2lkIGludGVsX3VuY29yZV9m
d19kb21haW5zX2luaXQoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQorc3RhdGljIGludCBp
bnRlbF91bmNvcmVfZndfZG9tYWluc19pbml0KHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSkK
IHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHVuY29yZS0+aTkxNTsKKwlpbnQg
cmV0ID0gMDsKIAogCUdFTV9CVUdfT04oIWludGVsX3VuY29yZV9oYXNfZm9yY2V3YWtlKHVuY29y
ZSkpOwogCisjZGVmaW5lIGZ3X2RvbWFpbl9pbml0KHVuY29yZV9fLCBpZF9fLCBzZXRfXywgYWNr
X18pIFwKKwkocmV0ID86IChyZXQgPSBfX2Z3X2RvbWFpbl9pbml0KCh1bmNvcmVfXyksIChpZF9f
KSwgKHNldF9fKSwgKGFja19fKSkpKQorCiAJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSkgewog
CQlpbnQgaTsKIAotCQl1bmNvcmUtPmZ1bmNzLmZvcmNlX3dha2VfZ2V0ID0KLQkJCWZ3X2RvbWFp
bnNfZ2V0X3dpdGhfZmFsbGJhY2s7CisJCXVuY29yZS0+ZnVuY3MuZm9yY2Vfd2FrZV9nZXQgPSBm
d19kb21haW5zX2dldF93aXRoX2ZhbGxiYWNrOwogCQl1bmNvcmUtPmZ1bmNzLmZvcmNlX3dha2Vf
cHV0ID0gZndfZG9tYWluc19wdXQ7CiAJCWZ3X2RvbWFpbl9pbml0KHVuY29yZSwgRldfRE9NQUlO
X0lEX1JFTkRFUiwKIAkJCSAgICAgICBGT1JDRVdBS0VfUkVOREVSX0dFTjksCkBAIC0xMzcyLDYg
KzEzOTEsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF91bmNvcmVfZndfZG9tYWluc19pbml0KHN0cnVj
dCBpbnRlbF91bmNvcmUgKnVuY29yZSkKIAkJZndfZG9tYWluX2luaXQodW5jb3JlLCBGV19ET01B
SU5fSURfQkxJVFRFUiwKIAkJCSAgICAgICBGT1JDRVdBS0VfQkxJVFRFUl9HRU45LAogCQkJICAg
ICAgIEZPUkNFV0FLRV9BQ0tfQkxJVFRFUl9HRU45KTsKKwogCQlmb3IgKGkgPSAwOyBpIDwgSTkx
NV9NQVhfVkNTOyBpKyspIHsKIAkJCWlmICghSEFTX0VOR0lORShpOTE1LCBfVkNTKGkpKSkKIAkJ
CQljb250aW51ZTsKQEAgLTEzODksOCArMTQwOSw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3VuY29y
ZV9md19kb21haW5zX2luaXQoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQogCQkJCSAgICAg
ICBGT1JDRVdBS0VfQUNLX01FRElBX1ZFQk9YX0dFTjExKGkpKTsKIAkJfQogCX0gZWxzZSBpZiAo
SVNfR0VOX1JBTkdFKGk5MTUsIDksIDEwKSkgewotCQl1bmNvcmUtPmZ1bmNzLmZvcmNlX3dha2Vf
Z2V0ID0KLQkJCWZ3X2RvbWFpbnNfZ2V0X3dpdGhfZmFsbGJhY2s7CisJCXVuY29yZS0+ZnVuY3Mu
Zm9yY2Vfd2FrZV9nZXQgPSBmd19kb21haW5zX2dldF93aXRoX2ZhbGxiYWNrOwogCQl1bmNvcmUt
PmZ1bmNzLmZvcmNlX3dha2VfcHV0ID0gZndfZG9tYWluc19wdXQ7CiAJCWZ3X2RvbWFpbl9pbml0
KHVuY29yZSwgRldfRE9NQUlOX0lEX1JFTkRFUiwKIAkJCSAgICAgICBGT1JDRVdBS0VfUkVOREVS
X0dFTjksCkBAIC0xNDM5LDggKzE0NTgsMTAgQEAgc3RhdGljIHZvaWQgaW50ZWxfdW5jb3JlX2Z3
X2RvbWFpbnNfaW5pdChzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpCiAJCV9fcmF3X3VuY29y
ZV93cml0ZTMyKHVuY29yZSwgRk9SQ0VXQUtFLCAwKTsKIAkJX19yYXdfcG9zdGluZ19yZWFkKHVu
Y29yZSwgRUNPQlVTKTsKIAotCQlmd19kb21haW5faW5pdCh1bmNvcmUsIEZXX0RPTUFJTl9JRF9S
RU5ERVIsCi0JCQkgICAgICAgRk9SQ0VXQUtFX01ULCBGT1JDRVdBS0VfTVRfQUNLKTsKKwkJcmV0
ID0gX19md19kb21haW5faW5pdCh1bmNvcmUsIEZXX0RPTUFJTl9JRF9SRU5ERVIsCisJCQkJICAg
ICAgIEZPUkNFV0FLRV9NVCwgRk9SQ0VXQUtFX01UX0FDSyk7CisJCWlmIChyZXQpCisJCQlnb3Rv
IG91dDsKIAogCQlzcGluX2xvY2tfaXJxKCZ1bmNvcmUtPmxvY2spOwogCQlmd19kb21haW5zX2dl
dF93aXRoX3RocmVhZF9zdGF0dXModW5jb3JlLCBGT1JDRVdBS0VfUkVOREVSKTsKQEAgLTE0NTEs
NiArMTQ3Miw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3VuY29yZV9md19kb21haW5zX2luaXQoc3Ry
dWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQogCQlpZiAoIShlY29idXMgJiBGT1JDRVdBS0VfTVRf
RU5BQkxFKSkgewogCQkJRFJNX0lORk8oIk5vIE1UIGZvcmNld2FrZSBhdmFpbGFibGUgb24gSXZ5
YnJpZGdlLCB0aGlzIGNhbiByZXN1bHQgaW4gaXNzdWVzXG4iKTsKIAkJCURSTV9JTkZPKCJ3aGVu
IHVzaW5nIHZibGFuay1zeW5jZWQgcGFydGlhbCBzY3JlZW4gdXBkYXRlcy5cbiIpOworCQkJZndf
ZG9tYWluX2ZpbmkodW5jb3JlLCBGV19ET01BSU5fSURfUkVOREVSKTsKIAkJCWZ3X2RvbWFpbl9p
bml0KHVuY29yZSwgRldfRE9NQUlOX0lEX1JFTkRFUiwKIAkJCQkgICAgICAgRk9SQ0VXQUtFLCBG
T1JDRVdBS0VfQUNLKTsKIAkJfQpAQCAtMTQ2Miw4ICsxNDg0LDE2IEBAIHN0YXRpYyB2b2lkIGlu
dGVsX3VuY29yZV9md19kb21haW5zX2luaXQoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQog
CQkJICAgICAgIEZPUkNFV0FLRSwgRk9SQ0VXQUtFX0FDSyk7CiAJfQogCisjdW5kZWYgZndfZG9t
YWluX2luaXQKKwogCS8qIEFsbCBmdXR1cmUgcGxhdGZvcm1zIGFyZSBleHBlY3RlZCB0byByZXF1
aXJlIGNvbXBsZXggcG93ZXIgZ2F0aW5nICovCi0JV0FSTl9PTih1bmNvcmUtPmZ3X2RvbWFpbnMg
PT0gMCk7CisJV0FSTl9PTighcmV0ICYmIHVuY29yZS0+ZndfZG9tYWlucyA9PSAwKTsKKworb3V0
OgorCWlmIChyZXQpCisJCWludGVsX3VuY29yZV9md19kb21haW5zX2ZpbmkodW5jb3JlKTsKKwor
CXJldHVybiByZXQ7CiB9CiAKICNkZWZpbmUgQVNTSUdOX0ZXX0RPTUFJTlNfVEFCTEUodW5jb3Jl
LCBkKSBcCkBAIC0xNTY0LDEzICsxNTk0LDE3IEBAIHN0YXRpYyB2b2lkIHVuY29yZV9yYXdfaW5p
dChzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpCiAJfQogfQogCi1zdGF0aWMgdm9pZCB1bmNv
cmVfZm9yY2V3YWtlX2luaXQoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQorc3RhdGljIGlu
dCB1bmNvcmVfZm9yY2V3YWtlX2luaXQoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQogewog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdW5jb3JlLT5pOTE1OworCWludCByZXQ7
CiAKIAlHRU1fQlVHX09OKCFpbnRlbF91bmNvcmVfaGFzX2ZvcmNld2FrZSh1bmNvcmUpKTsKIAot
CWludGVsX3VuY29yZV9md19kb21haW5zX2luaXQodW5jb3JlKTsKKwlyZXQgPSBpbnRlbF91bmNv
cmVfZndfZG9tYWluc19pbml0KHVuY29yZSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKwog
CWZvcmNld2FrZV9lYXJseV9zYW5pdGl6ZSh1bmNvcmUsIDApOwogCiAJaWYgKElTX0dFTl9SQU5H
RShpOTE1LCA2LCA3KSkgewpAQCAtMTYwMyw2ICsxNjM3LDggQEAgc3RhdGljIHZvaWQgdW5jb3Jl
X2ZvcmNld2FrZV9pbml0KHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSkKIAogCXVuY29yZS0+
cG1pY19idXNfYWNjZXNzX25iLm5vdGlmaWVyX2NhbGwgPSBpOTE1X3BtaWNfYnVzX2FjY2Vzc19u
b3RpZmllcjsKIAlpb3NmX21iaV9yZWdpc3Rlcl9wbWljX2J1c19hY2Nlc3Nfbm90aWZpZXIoJnVu
Y29yZS0+cG1pY19idXNfYWNjZXNzX25iKTsKKworCXJldHVybiAwOwogfQogCiBpbnQgaW50ZWxf
dW5jb3JlX2luaXRfbW1pbyhzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpCkBAIC0xNjIxLDEw
ICsxNjU3LDEzIEBAIGludCBpbnRlbF91bmNvcmVfaW5pdF9tbWlvKHN0cnVjdCBpbnRlbF91bmNv
cmUgKnVuY29yZSkKIAogCXVuY29yZS0+dW5jbGFpbWVkX21taW9fY2hlY2sgPSAxOwogCi0JaWYg
KCFpbnRlbF91bmNvcmVfaGFzX2ZvcmNld2FrZSh1bmNvcmUpKQorCWlmICghaW50ZWxfdW5jb3Jl
X2hhc19mb3JjZXdha2UodW5jb3JlKSkgewogCQl1bmNvcmVfcmF3X2luaXQodW5jb3JlKTsKLQll
bHNlCi0JCXVuY29yZV9mb3JjZXdha2VfaW5pdCh1bmNvcmUpOworCX0gZWxzZSB7CisJCXJldCA9
IHVuY29yZV9mb3JjZXdha2VfaW5pdCh1bmNvcmUpOworCQlpZiAocmV0KQorCQkJZ290byBvdXRf
bW1pb19jbGVhbnVwOworCX0KIAogCS8qIG1ha2Ugc3VyZSBmdyBmdW5jcyBhcmUgc2V0IGlmIGFu
ZCBvbmx5IGlmIHdlIGhhdmUgZncqLwogCUdFTV9CVUdfT04oaW50ZWxfdW5jb3JlX2hhc19mb3Jj
ZXdha2UodW5jb3JlKSAhPSAhIXVuY29yZS0+ZnVuY3MuZm9yY2Vfd2FrZV9nZXQpOwpAQCAtMTY0
Niw2ICsxNjg1LDExIEBAIGludCBpbnRlbF91bmNvcmVfaW5pdF9tbWlvKHN0cnVjdCBpbnRlbF91
bmNvcmUgKnVuY29yZSkKIAkJRFJNX0RFQlVHKCJ1bmNsYWltZWQgbW1pbyBkZXRlY3RlZCBvbiB1
bmNvcmUgaW5pdCwgY2xlYXJpbmdcbiIpOwogCiAJcmV0dXJuIDA7CisKK291dF9tbWlvX2NsZWFu
dXA6CisJdW5jb3JlX21taW9fY2xlYW51cCh1bmNvcmUpOworCisJcmV0dXJuIHJldDsKIH0KIAog
LyoKQEAgLTE2OTEsNiArMTczNSw3IEBAIHZvaWQgaW50ZWxfdW5jb3JlX2ZpbmlfbW1pbyhzdHJ1
Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpCiAJCWlvc2ZfbWJpX3VucmVnaXN0ZXJfcG1pY19idXNf
YWNjZXNzX25vdGlmaWVyX3VubG9ja2VkKAogCQkJJnVuY29yZS0+cG1pY19idXNfYWNjZXNzX25i
KTsKIAkJaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9yZXNldCh1bmNvcmUpOworCQlpbnRlbF91bmNv
cmVfZndfZG9tYWluc19maW5pKHVuY29yZSk7CiAJCWlvc2ZfbWJpX3B1bml0X3JlbGVhc2UoKTsK
IAl9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3VuY29yZS5oIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdW5jb3JlLmgKaW5kZXggNTk1MDVhMmY5MDk3Li43
MTA4NDc1ZDliMjQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3VuY29y
ZS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3VuY29yZS5oCkBAIC0xMjYsNiAr
MTI2LDcgQEAgc3RydWN0IGludGVsX3VuY29yZSB7CiAJZW51bSBmb3JjZXdha2VfZG9tYWlucyBm
d19kb21haW5zX3NhdmVkOyAvKiB1c2VyIGRvbWFpbnMgc2F2ZWQgZm9yIFMzICovCiAKIAlzdHJ1
Y3QgaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9kb21haW4geworCQlzdHJ1Y3QgaW50ZWxfdW5jb3Jl
ICp1bmNvcmU7CiAJCWVudW0gZm9yY2V3YWtlX2RvbWFpbl9pZCBpZDsKIAkJZW51bSBmb3JjZXdh
a2VfZG9tYWlucyBtYXNrOwogCQl1bnNpZ25lZCBpbnQgd2FrZV9jb3VudDsKQEAgLTEzMyw3ICsx
MzQsNyBAQCBzdHJ1Y3QgaW50ZWxfdW5jb3JlIHsKIAkJc3RydWN0IGhydGltZXIgdGltZXI7CiAJ
CXUzMiBfX2lvbWVtICpyZWdfc2V0OwogCQl1MzIgX19pb21lbSAqcmVnX2FjazsKLQl9IGZ3X2Rv
bWFpbltGV19ET01BSU5fSURfQ09VTlRdOworCX0gKmZ3X2RvbWFpbltGV19ET01BSU5fSURfQ09V
TlRdOwogCiAJc3RydWN0IHsKIAkJdW5zaWduZWQgaW50IGNvdW50OwpAQCAtMTQ3LDE4ICsxNDgs
MTIgQEAgc3RydWN0IGludGVsX3VuY29yZSB7CiAKIC8qIEl0ZXJhdGUgb3ZlciBpbml0aWFsaXNl
ZCBmdyBkb21haW5zICovCiAjZGVmaW5lIGZvcl9lYWNoX2Z3X2RvbWFpbl9tYXNrZWQoZG9tYWlu
X18sIG1hc2tfXywgdW5jb3JlX18sIHRtcF9fKSBcCi0JZm9yICh0bXBfXyA9IChtYXNrX18pOyBc
Ci0JICAgICB0bXBfXyA/IChkb21haW5fXyA9ICYodW5jb3JlX18pLT5md19kb21haW5bX19tYXNr
X25leHRfYml0KHRtcF9fKV0pLCAxIDogMDspCisJZm9yICh0bXBfXyA9IChtYXNrX18pOyB0bXBf
XyA7KSBcCisJCWZvcl9lYWNoX2lmKGRvbWFpbl9fID0gKHVuY29yZV9fKS0+ZndfZG9tYWluW19f
bWFza19uZXh0X2JpdCh0bXBfXyldKQogCiAjZGVmaW5lIGZvcl9lYWNoX2Z3X2RvbWFpbihkb21h
aW5fXywgdW5jb3JlX18sIHRtcF9fKSBcCiAJZm9yX2VhY2hfZndfZG9tYWluX21hc2tlZChkb21h
aW5fXywgKHVuY29yZV9fKS0+ZndfZG9tYWlucywgdW5jb3JlX18sIHRtcF9fKQogCi1zdGF0aWMg
aW5saW5lIHN0cnVjdCBpbnRlbF91bmNvcmUgKgotZm9yY2V3YWtlX2RvbWFpbl90b191bmNvcmUo
Y29uc3Qgc3RydWN0IGludGVsX3VuY29yZV9mb3JjZXdha2VfZG9tYWluICpkKQotewotCXJldHVy
biBjb250YWluZXJfb2YoZCwgc3RydWN0IGludGVsX3VuY29yZSwgZndfZG9tYWluW2QtPmlkXSk7
Ci19Ci0KIHN0YXRpYyBpbmxpbmUgYm9vbAogaW50ZWxfdW5jb3JlX2hhc19mb3JjZXdha2UoY29u
c3Qgc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQogewotLSAKMi4yMC4xCgpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBs
aXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

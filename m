Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id A97521288FC
	for <lists+intel-gfx@lfdr.de>; Sat, 21 Dec 2019 13:06:32 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A3C496E457;
	Sat, 21 Dec 2019 12:06:30 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga03.intel.com (mga03.intel.com [134.134.136.65])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9EA786E457
 for <intel-gfx@lists.freedesktop.org>; Sat, 21 Dec 2019 12:06:21 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga003.jf.intel.com ([10.7.209.27])
 by orsmga103.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 21 Dec 2019 04:06:21 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,338,1571727600"; d="scan'208";a="219065234"
Received: from ideak-desk.fi.intel.com ([10.237.72.183])
 by orsmga003.jf.intel.com with ESMTP; 21 Dec 2019 04:06:19 -0800
From: Imre Deak <imre.deak@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Sat, 21 Dec 2019 14:05:39 +0200
Message-Id: <20191221120543.22816-7-imre.deak@intel.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20191221120543.22816-1-imre.deak@intel.com>
References: <20191221120543.22816-1-imre.deak@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 06/10] drm/i915/tgl: Gen-12 render decompression
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Nanley G Chery <nanley.g.chery@intel.com>,
 Lucas De Marchi <lucas.demarchi@intel.com>,
 Dhinakaran Pandiyan <dhinakaran.pandiyan@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogRGhpbmFrYXJhbiBQYW5kaXlhbiA8ZGhpbmFrYXJhbi5wYW5kaXlhbkBpbnRlbC5jb20+
CgpHZW4tMTIgZGlzcGxheSBkZWNvbXByZXNzaW9uIG9wZXJhdGVzIG9uIFktdGlsZWQgY29tcHJl
c3NlZCBtYWluIHN1cmZhY2UuClRoZSBDQ1MgaXMgbGluZWFyIGFuZCBoYXMgNCBiaXRzIG9mIG1l
dGFkYXRhIGZvciBlYWNoIG1haW4gc3VyZmFjZSBjYWNoZQpsaW5lIHBhaXIsIGEgc2l6ZSByYXRp
byBvZiAxOjI1Ni4gR2VuLTEyIGRpc3BsYXkgZGVjb21wcmVzc2lvbiBpcwppbmNvbXBhdGlibGUg
d2l0aCBidWZmZXJzIGNvbXByZXNzZWQgYnkgZWFybGllciBHUFVzLCBzbyBtYWtlIHVzZSBvZiBh
IG5ldwptb2RpZmllciB0byBpZGVudGlmeSBnZW4tMTIgY29tcHJlc3Npb24uIEFub3RoZXIgbm90
YWJsZSBjaGFuZ2UgaXMgdGhhdApyZW5kZXIgZGVjb21wcmVzc2lvbiBpcyBzdXBwb3J0ZWQgb24g
YWxsIHBsYW5lcyBleGNlcHQgY3Vyc29yIGFuZCBvbiBhbGwKcGlwZXMuIFN0YXJ0IGJ5IGFkZGlu
ZyByZW5kZXIgZGVjb21wcmVzc2lvbiBzdXBwb3J0IGZvciBbQSxYXUJHUjg4OCBwaXhlbApmb3Jt
YXRzLgoKdjI6IEZpeCBjaGVja3BhdGNoIHdhcm5pbmdzIChMdWNhcykKdjM6ClJlYmFzZSwgZGlz
YWJsZSBjb2xvciBjbGVhciwgc3R5bGluZyBjaGFuZ2VzIGFuZCBtb2RpZnkKaW50ZWxfdGlsZV93
aWR0aF9ieXRlcyBhbmQgaW50ZWxfdGlsZV9oZWlnaHQgdG8gaGFuZGxlIGxpbmVhciBDQ1MKdjQ6
Ci0gVXNlIGZvcm1hdCBibG9jayBkZXNjcmlwdG9ycyBhbmQgdGhlIGk5MTUgc3BlY2lmaWMgZnVu
YyB0byBnZXQgdGhlCiAgc3Vic2FtcGxpbmcgZm9yIGVhY2ggY29sb3IgcGxhbmUuCi0gVXNlIGhl
bHBlcnMgdG8gY29udmVydCBiZXR3ZWVuIENDUyBhbmQgbWFpbiBwbGFuZXMuCnY1OgotIEZpeCBz
dWJzYW1wbGluZyByZXR1cm5lZCBieSBpbnRlbF9mYl9wbGFuZV9nZXRfc3Vic2FtcGxpbmcoKSBm
b3IKICB0aGUgQ0NTIHBsYW5lIG9mIHRoZSBmaXJzdCBwbGFuZS4KdjY6Ci0gUmViYXNlZCBvbiB2
MiBvZiBwYXRjaCA0Lgp2NzoKLSBGaXggcGxhbmUgZGltZW5zaW9ucyBkdXJpbmcgRkIgY2hlY2su
CgpDYzogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KQ2M6
IE1hdHQgUm9wZXIgPG1hdHRoZXcuZC5yb3BlckBpbnRlbC5jb20+CkNjOiBOYW5sZXkgRyBDaGVy
eSA8bmFubGV5LmcuY2hlcnlAaW50ZWwuY29tPgpDYzogSmFzb24gRWtzdHJhbmQgPGphc29uQGps
ZWtzdHJhbmQubmV0PgpDYzogUmFkaGFrcmlzaG5hIFNyaXBhZGEgPHJhZGhha3Jpc2huYS5zcmlw
YWRhQGludGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogRGhpbmFrYXJhbiBQYW5kaXlhbiA8ZGhpbmFr
YXJhbi5wYW5kaXlhbkBpbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6IEx1Y2FzIERlIE1hcmNoaSA8
bHVjYXMuZGVtYXJjaGlAaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBJbXJlIERlYWsgPGltcmUu
ZGVha0BpbnRlbC5jb20+ClJldmlld2VkLWJ5OiBSYWRoYWtyaXNobmEgU3JpcGFkYSA8cmFkaGFr
cmlzaG5hLnNyaXBhZGFAaW50ZWwuY29tPiAodjYpCi0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgfCAxOTcgKysrKysrKysrKysrKysrLS0tLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYyAgfCAgMjMgKystCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oICAgICAgICAgICAgICB8ICAgMSArCiAzIGZpbGVzIGNo
YW5nZWQsIDE3OCBpbnNlcnRpb25zKCspLCA0MyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4IGQ0N2NmNjM5NDA3My4uNTYw
ODJiMmRlZjBiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3Bs
YXkuYwpAQCAtMTk0Miw2ICsxOTQyLDE2IEBAIHN0YXRpYyBib29sIGlzX2Njc19wbGFuZShjb25z
dCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IHBsYW5lKQogCXJldHVybiBwbGFuZSA+
PSBmYi0+Zm9ybWF0LT5udW1fcGxhbmVzIC8gMjsKIH0KIAorc3RhdGljIGJvb2wgaXNfZ2VuMTJf
Y2NzX21vZGlmaWVyKHU2NCBtb2RpZmllcikKK3sKKwlyZXR1cm4gbW9kaWZpZXIgPT0gSTkxNV9G
T1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTOworfQorCitzdGF0aWMgYm9vbCBpc19nZW4x
Ml9jY3NfcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBwbGFuZSkK
K3sKKwlyZXR1cm4gaXNfZ2VuMTJfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikgJiYgaXNfY2Nz
X3BsYW5lKGZiLCBwbGFuZSk7Cit9CisKIHN0YXRpYyBib29sIGlzX2F1eF9wbGFuZShjb25zdCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IHBsYW5lKQogewogCWlmIChpc19jY3NfbW9k
aWZpZXIoZmItPm1vZGlmaWVyKSkKQEAgLTE5NTgsNiArMTk2OCwxNCBAQCBzdGF0aWMgaW50IG1h
aW5fdG9fY2NzX3BsYW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgbWFp
bl9wbGFuZSkKIAlyZXR1cm4gZmItPmZvcm1hdC0+bnVtX3BsYW5lcyAvIDIgKyBtYWluX3BsYW5l
OwogfQogCitzdGF0aWMgaW50IGNjc190b19tYWluX3BsYW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJh
bWVidWZmZXIgKmZiLCBpbnQgY2NzX3BsYW5lKQoreworCVdBUk5fT04oIWlzX2Njc19tb2RpZmll
cihmYi0+bW9kaWZpZXIpIHx8CisJCWNjc19wbGFuZSA8IGZiLT5mb3JtYXQtPm51bV9wbGFuZXMg
LyAyKTsKKworCXJldHVybiBjY3NfcGxhbmUgLSBmYi0+Zm9ybWF0LT5udW1fcGxhbmVzIC8gMjsK
K30KKwogLyogUmV0dXJuIGVpdGhlciB0aGUgbWFpbiBwbGFuZSdzIENDUyBvciAtIGlmIG5vdCBh
IENDUyBGQiAtIFVWIHBsYW5lICovCiBzdGF0aWMgaW50CiBpbnRlbF9tYWluX3RvX2F1eF9wbGFu
ZShjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IG1haW5fcGxhbmUpCkBAIC0x
OTg2LDYgKzIwMDQsMTAgQEAgaW50ZWxfdGlsZV93aWR0aF9ieXRlcyhjb25zdCBzdHJ1Y3QgZHJt
X2ZyYW1lYnVmZmVyICpmYiwgaW50IGNvbG9yX3BsYW5lKQogCQlpZiAoaXNfY2NzX3BsYW5lKGZi
LCBjb2xvcl9wbGFuZSkpCiAJCQlyZXR1cm4gMTI4OwogCQkvKiBmYWxsIHRocm91Z2ggKi8KKwlj
YXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUzoKKwkJaWYgKGlzX2Njc19w
bGFuZShmYiwgY29sb3JfcGxhbmUpKQorCQkJcmV0dXJuIDY0OworCQkvKiBmYWxsIHRocm91Z2gg
Ki8KIAljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEOgogCQlpZiAoSVNfR0VOKGRldl9wcml2
LCAyKSB8fCBIQVNfMTI4X0JZVEVfWV9USUxJTkcoZGV2X3ByaXYpKQogCQkJcmV0dXJuIDEyODsK
QEAgLTIwMTksNiArMjA0MSw5IEBAIGludGVsX3RpbGVfd2lkdGhfYnl0ZXMoY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFuZSkKIHN0YXRpYyB1bnNpZ25lZCBp
bnQKIGludGVsX3RpbGVfaGVpZ2h0KGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBp
bnQgY29sb3JfcGxhbmUpCiB7CisJaWYgKGlzX2dlbjEyX2Njc19wbGFuZShmYiwgY29sb3JfcGxh
bmUpKQorCQlyZXR1cm4gMTsKKwogCXJldHVybiBpbnRlbF90aWxlX3NpemUodG9faTkxNShmYi0+
ZGV2KSkgLwogCQlpbnRlbF90aWxlX3dpZHRoX2J5dGVzKGZiLCBjb2xvcl9wbGFuZSk7CiB9CkBA
IC0yMTE5LDYgKzIxNDQsOCBAQCBzdGF0aWMgdW5zaWduZWQgaW50IGludGVsX3N1cmZfYWxpZ25t
ZW50KGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAogCQlpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA+PSA5KQogCQkJcmV0dXJuIDI1NiAqIDEwMjQ7CiAJCXJldHVybiAwOworCWNhc2Ug
STkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTOgorCQlyZXR1cm4gMTYgKiAxMDI0
OwogCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfQ0NTOgogCWNhc2UgSTkxNV9GT1JNQVRf
TU9EX1lmX1RJTEVEX0NDUzoKIAljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEOgpAQCAtMjMx
MSw5ICsyMzM4LDEwIEBAIHN0YXRpYyB1MzIgaW50ZWxfYWRqdXN0X3RpbGVfb2Zmc2V0KGludCAq
eCwgaW50ICp5LAogCXJldHVybiBuZXdfb2Zmc2V0OwogfQogCi1zdGF0aWMgYm9vbCBpc19zdXJm
YWNlX2xpbmVhcih1NjQgbW9kaWZpZXIsIGludCBjb2xvcl9wbGFuZSkKK3N0YXRpYyBib29sIGlz
X3N1cmZhY2VfbGluZWFyKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgY29s
b3JfcGxhbmUpCiB7Ci0JcmV0dXJuIG1vZGlmaWVyID09IERSTV9GT1JNQVRfTU9EX0xJTkVBUjsK
KwlyZXR1cm4gZmItPm1vZGlmaWVyID09IERSTV9GT1JNQVRfTU9EX0xJTkVBUiB8fAorCSAgICAg
ICBpc19nZW4xMl9jY3NfcGxhbmUoZmIsIGNvbG9yX3BsYW5lKTsKIH0KIAogc3RhdGljIHUzMiBp
bnRlbF9hZGp1c3RfYWxpZ25lZF9vZmZzZXQoaW50ICp4LCBpbnQgKnksCkBAIC0yMzI4LDcgKzIz
NTYsNyBAQCBzdGF0aWMgdTMyIGludGVsX2FkanVzdF9hbGlnbmVkX29mZnNldChpbnQgKngsIGlu
dCAqeSwKIAogCVdBUk5fT04obmV3X29mZnNldCA+IG9sZF9vZmZzZXQpOwogCi0JaWYgKCFpc19z
dXJmYWNlX2xpbmVhcihmYi0+bW9kaWZpZXIsIGNvbG9yX3BsYW5lKSkgeworCWlmICghaXNfc3Vy
ZmFjZV9saW5lYXIoZmIsIGNvbG9yX3BsYW5lKSkgewogCQl1bnNpZ25lZCBpbnQgdGlsZV9zaXpl
LCB0aWxlX3dpZHRoLCB0aWxlX2hlaWdodDsKIAkJdW5zaWduZWQgaW50IHBpdGNoX3RpbGVzOwog
CkBAIC0yMzk4LDcgKzI0MjYsNyBAQCBzdGF0aWMgdTMyIGludGVsX2NvbXB1dGVfYWxpZ25lZF9v
ZmZzZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCWlmIChhbGlnbm1lbnQp
CiAJCWFsaWdubWVudC0tOwogCi0JaWYgKCFpc19zdXJmYWNlX2xpbmVhcihmYi0+bW9kaWZpZXIs
IGNvbG9yX3BsYW5lKSkgeworCWlmICghaXNfc3VyZmFjZV9saW5lYXIoZmIsIGNvbG9yX3BsYW5l
KSkgewogCQl1bnNpZ25lZCBpbnQgdGlsZV9zaXplLCB0aWxlX3dpZHRoLCB0aWxlX2hlaWdodDsK
IAkJdW5zaWduZWQgaW50IHRpbGVfcm93cywgdGlsZXMsIHBpdGNoX3RpbGVzOwogCkBAIC0yNTAw
LDYgKzI1MjgsNyBAQCBzdGF0aWMgdW5zaWduZWQgaW50IGludGVsX2ZiX21vZGlmaWVyX3RvX3Rp
bGluZyh1NjQgZmJfbW9kaWZpZXIpCiAJCXJldHVybiBJOTE1X1RJTElOR19YOwogCWNhc2UgSTkx
NV9GT1JNQVRfTU9EX1lfVElMRUQ6CiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1M6
CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1M6CiAJCXJldHVybiBJ
OTE1X1RJTElOR19ZOwogCWRlZmF1bHQ6CiAJCXJldHVybiBJOTE1X1RJTElOR19OT05FOwpAQCAt
MjUyMCw3ICsyNTQ5LDcgQEAgc3RhdGljIHVuc2lnbmVkIGludCBpbnRlbF9mYl9tb2RpZmllcl90
b190aWxpbmcodTY0IGZiX21vZGlmaWVyKQogICogdXMgYSByYXRpbyBvZiBvbmUgYnl0ZSBpbiB0
aGUgQ0NTIGZvciBlYWNoIDh4MTYgcGl4ZWxzIGluIHRoZQogICogbWFpbiBzdXJmYWNlLgogICov
Ci1zdGF0aWMgY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyBjY3NfZm9ybWF0c1tdID0gewor
c3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0X2luZm8gc2tsX2Njc19mb3JtYXRzW10gPSB7
CiAJeyAuZm9ybWF0ID0gRFJNX0ZPUk1BVF9YUkdCODg4OCwgLmRlcHRoID0gMjQsIC5udW1fcGxh
bmVzID0gMiwKIAkgIC5jcHAgPSB7IDQsIDEsIH0sIC5oc3ViID0gOCwgLnZzdWIgPSAxNiwgfSwK
IAl7IC5mb3JtYXQgPSBEUk1fRk9STUFUX1hCR1I4ODg4LCAuZGVwdGggPSAyNCwgLm51bV9wbGFu
ZXMgPSAyLApAQCAtMjUzMSw2ICsyNTYwLDI4IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2Zv
cm1hdF9pbmZvIGNjc19mb3JtYXRzW10gPSB7CiAJICAuY3BwID0geyA0LCAxLCB9LCAuaHN1YiA9
IDgsIC52c3ViID0gMTYsIC5oYXNfYWxwaGEgPSB0cnVlLCB9LAogfTsKIAorLyoKKyAqIEdlbi0x
MiBjb21wcmVzc2lvbiB1c2VzIDQgYml0cyBvZiBDQ1MgZGF0YSBmb3IgZWFjaCBjYWNoZSBsaW5l
IHBhaXIgaW4gdGhlCisgKiBtYWluIHN1cmZhY2UuIEFuZCBlYWNoIDY0QiBDQ1MgY2FjaGUgbGlu
ZSByZXByZXNlbnRzIGFuIGFyZWEgb2YgNHgxIFktdGlsZXMKKyAqIGluIHRoZSBtYWluIHN1cmZh
Y2UuIFdpdGggNCBieXRlIHBpeGVscyBhbmQgZWFjaCBZLXRpbGUgaGF2aW5nIGRpbWVuc2lvbnMg
b2YKKyAqIDMyeDMyIHBpeGVscywgdGhlIHJhdGlvIHR1cm5zIG91dCB0byAxQiBpbiB0aGUgQ0NT
IGZvciBldmVyeSAyeDMyIHBpeGVscyBpbgorICogdGhlIG1haW4gc3VyZmFjZS4KKyAqLworc3Rh
dGljIGNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0X2luZm8gZ2VuMTJfY2NzX2Zvcm1hdHNbXSA9IHsK
Kwl7IC5mb3JtYXQgPSBEUk1fRk9STUFUX1hSR0I4ODg4LCAuZGVwdGggPSAyNCwgLm51bV9wbGFu
ZXMgPSAyLAorCSAgLmNoYXJfcGVyX2Jsb2NrID0geyA0LCAxIH0sIC5ibG9ja193ID0geyAxLCAy
IH0sIC5ibG9ja19oID0geyAxLCAxIH0sCisJICAuaHN1YiA9IDEsIC52c3ViID0gMSwgfSwKKwl7
IC5mb3JtYXQgPSBEUk1fRk9STUFUX1hCR1I4ODg4LCAuZGVwdGggPSAyNCwgLm51bV9wbGFuZXMg
PSAyLAorCSAgLmNoYXJfcGVyX2Jsb2NrID0geyA0LCAxIH0sIC5ibG9ja193ID0geyAxLCAyIH0s
IC5ibG9ja19oID0geyAxLCAxIH0sCisJICAuaHN1YiA9IDEsIC52c3ViID0gMSwgfSwKKwl7IC5m
b3JtYXQgPSBEUk1fRk9STUFUX0FSR0I4ODg4LCAuZGVwdGggPSAzMiwgLm51bV9wbGFuZXMgPSAy
LAorCSAgLmNoYXJfcGVyX2Jsb2NrID0geyA0LCAxIH0sIC5ibG9ja193ID0geyAxLCAyIH0sIC5i
bG9ja19oID0geyAxLCAxIH0sCisJICAuaHN1YiA9IDEsIC52c3ViID0gMSwgLmhhc19hbHBoYSA9
IHRydWUgfSwKKwl7IC5mb3JtYXQgPSBEUk1fRk9STUFUX0FCR1I4ODg4LCAuZGVwdGggPSAzMiwg
Lm51bV9wbGFuZXMgPSAyLAorCSAgLmNoYXJfcGVyX2Jsb2NrID0geyA0LCAxIH0sIC5ibG9ja193
ID0geyAxLCAyIH0sIC5ibG9ja19oID0geyAxLCAxIH0sCisJICAuaHN1YiA9IDEsIC52c3ViID0g
MSwgLmhhc19hbHBoYSA9IHRydWUgfSwKK307CisKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2Zv
cm1hdF9pbmZvICoKIGxvb2t1cF9mb3JtYXRfaW5mbyhjb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9p
bmZvIGZvcm1hdHNbXSwKIAkJICAgaW50IG51bV9mb3JtYXRzLCB1MzIgZm9ybWF0KQpAQCAtMjU1
MSw4ICsyNjAyLDEyIEBAIGludGVsX2dldF9mb3JtYXRfaW5mbyhjb25zdCBzdHJ1Y3QgZHJtX21v
ZGVfZmJfY21kMiAqY21kKQogCXN3aXRjaCAoY21kLT5tb2RpZmllclswXSkgewogCWNhc2UgSTkx
NV9GT1JNQVRfTU9EX1lfVElMRURfQ0NTOgogCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVE
X0NDUzoKLQkJcmV0dXJuIGxvb2t1cF9mb3JtYXRfaW5mbyhjY3NfZm9ybWF0cywKLQkJCQkJICBB
UlJBWV9TSVpFKGNjc19mb3JtYXRzKSwKKwkJcmV0dXJuIGxvb2t1cF9mb3JtYXRfaW5mbyhza2xf
Y2NzX2Zvcm1hdHMsCisJCQkJCSAgQVJSQVlfU0laRShza2xfY2NzX2Zvcm1hdHMpLAorCQkJCQkg
IGNtZC0+cGl4ZWxfZm9ybWF0KTsKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEy
X1JDX0NDUzoKKwkJcmV0dXJuIGxvb2t1cF9mb3JtYXRfaW5mbyhnZW4xMl9jY3NfZm9ybWF0cywK
KwkJCQkJICBBUlJBWV9TSVpFKGdlbjEyX2Njc19mb3JtYXRzKSwKIAkJCQkJICBjbWQtPnBpeGVs
X2Zvcm1hdCk7CiAJZGVmYXVsdDoKIAkJcmV0dXJuIE5VTEw7CkBAIC0yNTYxLDcgKzI2MTYsOCBA
QCBpbnRlbF9nZXRfZm9ybWF0X2luZm8oY29uc3Qgc3RydWN0IGRybV9tb2RlX2ZiX2NtZDIgKmNt
ZCkKIAogYm9vbCBpc19jY3NfbW9kaWZpZXIodTY0IG1vZGlmaWVyKQogewotCXJldHVybiBtb2Rp
ZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1MgfHwKKwlyZXR1cm4gbW9kaWZpZXIg
PT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTIHx8CisJICAgICAgIG1vZGlm
aWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUyB8fAogCSAgICAgICBtb2RpZmllciA9
PSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRURfQ0NTOwogfQogCkBAIC0yNjA5LDggKzI2NjUsOSBA
QCBzdGF0aWMgdTMyCiBpbnRlbF9mYl9zdHJpZGVfYWxpZ25tZW50KGNvbnN0IHN0cnVjdCBkcm1f
ZnJhbWVidWZmZXIgKmZiLCBpbnQgY29sb3JfcGxhbmUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShmYi0+ZGV2KTsKKwl1MzIgdGlsZV93aWR0aDsKIAot
CWlmIChmYi0+bW9kaWZpZXIgPT0gRFJNX0ZPUk1BVF9NT0RfTElORUFSKSB7CisJaWYgKGlzX3N1
cmZhY2VfbGluZWFyKGZiLCBjb2xvcl9wbGFuZSkpIHsKIAkJdTMyIG1heF9zdHJpZGUgPSBpbnRl
bF9wbGFuZV9mYl9tYXhfc3RyaWRlKGRldl9wcml2LAogCQkJCQkJCSAgIGZiLT5mb3JtYXQtPmZv
cm1hdCwKIAkJCQkJCQkgICBmYi0+bW9kaWZpZXIpOwpAQCAtMjYxOSwxMyArMjY3NiwxNSBAQCBp
bnRlbF9mYl9zdHJpZGVfYWxpZ25tZW50KGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
LCBpbnQgY29sb3JfcGxhbmUpCiAJCSAqIFRvIG1ha2UgcmVtYXBwaW5nIHdpdGggbGluZWFyIGdl
bmVyYWxseSBmZWFzaWJsZQogCQkgKiB3ZSBuZWVkIHRoZSBzdHJpZGUgdG8gYmUgcGFnZSBhbGln
bmVkLgogCQkgKi8KLQkJaWYgKGZiLT5waXRjaGVzW2NvbG9yX3BsYW5lXSA+IG1heF9zdHJpZGUp
CisJCWlmIChmYi0+cGl0Y2hlc1tjb2xvcl9wbGFuZV0gPiBtYXhfc3RyaWRlICYmCisJCSAgICAh
aXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikpCiAJCQlyZXR1cm4gaW50ZWxfdGlsZV9zaXpl
KGRldl9wcml2KTsKIAkJZWxzZQogCQkJcmV0dXJuIDY0OwotCX0gZWxzZSB7Ci0JCXUzMiB0aWxl
X3dpZHRoID0gaW50ZWxfdGlsZV93aWR0aF9ieXRlcyhmYiwgY29sb3JfcGxhbmUpOworCX0KIAor
CXRpbGVfd2lkdGggPSBpbnRlbF90aWxlX3dpZHRoX2J5dGVzKGZiLCBjb2xvcl9wbGFuZSk7CisJ
aWYgKGlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpICYmIGNvbG9yX3BsYW5lID09IDApIHsK
IAkJLyoKIAkJICogRGlzcGxheSBXQSAjMDUzMTogc2tsLGJ4dCxrYmwsZ2xrCiAJCSAqCkBAIC0y
NjM1LDEyICsyNjk0LDE2IEBAIGludGVsX2ZiX3N0cmlkZV9hbGlnbm1lbnQoY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFuZSkKIAkJICogcmVxdWlyZSB0aGUg
ZW50aXJlIGZiIHRvIGFjY29tbW9kYXRlIHRoYXQgdG8gYXZvaWQKIAkJICogcG90ZW50aWFsIHJ1
bnRpbWUgZXJyb3JzIGF0IHBsYW5lIGNvbmZpZ3VyYXRpb24gdGltZS4KIAkJICovCi0JCWlmIChJ
U19HRU4oZGV2X3ByaXYsIDkpICYmIGlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpICYmCi0J
CSAgICBjb2xvcl9wbGFuZSA9PSAwICYmIGZiLT53aWR0aCA+IDM4NDApCisJCWlmIChJU19HRU4o
ZGV2X3ByaXYsIDkpICYmIGZiLT53aWR0aCA+IDM4NDApCisJCQl0aWxlX3dpZHRoICo9IDQ7CisJ
CS8qCisJCSAqIFRoZSBtYWluIHN1cmZhY2UgcGl0Y2ggbXVzdCBiZSBwYWRkZWQgdG8gYSBtdWx0
aXBsZSBvZiBmb3VyCisJCSAqIHRpbGUgd2lkdGhzLgorCQkgKi8KKwkJZWxzZSBpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSAxMikKIAkJCXRpbGVfd2lkdGggKj0gNDsKLQotCQlyZXR1cm4gdGls
ZV93aWR0aDsKIAl9CisJcmV0dXJuIHRpbGVfd2lkdGg7CiB9CiAKIGJvb2wgaW50ZWxfcGxhbmVf
Y2FuX3JlbWFwKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCkBA
IC0yNzExLDI4ICsyNzc0LDczIEBAIHN0YXRpYyBib29sIGludGVsX3BsYW5lX25lZWRzX3JlbWFw
KGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJcmV0dXJuIHN0
cmlkZSA+IG1heF9zdHJpZGU7CiB9CiAKK3N0YXRpYyB2b2lkCitpbnRlbF9mYl9wbGFuZV9nZXRf
c3Vic2FtcGxpbmcoaW50ICpoc3ViLCBpbnQgKnZzdWIsCisJCQkgICAgICAgY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIsCisJCQkgICAgICAgaW50IGNvbG9yX3BsYW5lKQoreworCWlu
dCBtYWluX3BsYW5lOworCisJaWYgKGNvbG9yX3BsYW5lID09IDApIHsKKwkJKmhzdWIgPSAxOwor
CQkqdnN1YiA9IDE7CisKKwkJcmV0dXJuOworCX0KKworCS8qCisJICogVE9ETzogRGVkdWN0IHRo
ZSBzdWJzYW1wbGluZyBmcm9tIHRoZSBjaGFyIGJsb2NrIGZvciBhbGwgQ0NTCisJICogZm9ybWF0
cyBhbmQgcGxhbmVzLgorCSAqLworCWlmICghaXNfZ2VuMTJfY2NzX3BsYW5lKGZiLCBjb2xvcl9w
bGFuZSkpIHsKKwkJKmhzdWIgPSBmYi0+Zm9ybWF0LT5oc3ViOworCQkqdnN1YiA9IGZiLT5mb3Jt
YXQtPnZzdWI7CisKKwkJcmV0dXJuOworCX0KKworCW1haW5fcGxhbmUgPSBjY3NfdG9fbWFpbl9w
bGFuZShmYiwgY29sb3JfcGxhbmUpOworCSpoc3ViID0gZHJtX2Zvcm1hdF9pbmZvX2Jsb2NrX3dp
ZHRoKGZiLT5mb3JtYXQsIGNvbG9yX3BsYW5lKSAvCisJCWRybV9mb3JtYXRfaW5mb19ibG9ja193
aWR0aChmYi0+Zm9ybWF0LCBtYWluX3BsYW5lKTsKKworCS8qCisJICogVGhlIG1pbiBzdHJpZGUg
Y2hlY2sgaW4gdGhlIGNvcmUgZnJhbWVidWZmZXJfY2hlY2soKSBmdW5jdGlvbgorCSAqIGFzc3Vt
ZXMgdGhhdCBmb3JtYXQtPmhzdWIgYXBwbGllcyB0byBldmVyeSBwbGFuZSBleGNlcHQgZm9yIHRo
ZQorCSAqIGZpcnN0IHBsYW5lLiBUaGF0J3MgaW5jb3JyZWN0IGZvciB0aGUgQ0NTIEFVWCBwbGFu
ZSBvZiB0aGUgZmlyc3QKKwkgKiBwbGFuZSwgYnV0IGZvciB0aGUgYWJvdmUgY2hlY2sgdG8gcGFz
cyB3ZSBtdXN0IGRlZmluZSB0aGUgYmxvY2sKKwkgKiB3aWR0aCB3aXRoIHRoYXQgc3Vic2FtcGxp
bmcgYXBwbGllZCB0byBpdC4gQWRqdXN0IHRoZSB3aWR0aCBoZXJlCisJICogYWNjb3JkaW5nbHks
IHNvIHdlIGNhbiBjYWxjdWxhdGUgdGhlIGFjdHVhbCBzdWJzYW1wbGluZyBmYWN0b3IuCisJICov
CisJaWYgKG1haW5fcGxhbmUgPT0gMCkKKwkJKmhzdWIgKj0gZmItPmZvcm1hdC0+aHN1YjsKKwor
CSp2c3ViID0gMzI7Cit9CiBzdGF0aWMgaW50CiBpbnRlbF9mYl9jaGVja19jY3NfeHkoc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjY3NfcGxhbmUsIGludCB4LCBpbnQgeSkKIHsKIAlz
dHJ1Y3QgaW50ZWxfZnJhbWVidWZmZXIgKmludGVsX2ZiID0gdG9faW50ZWxfZnJhbWVidWZmZXIo
ZmIpOwotCWludCBoc3ViID0gZmItPmZvcm1hdC0+aHN1YjsKLQlpbnQgdnN1YiA9IGZiLT5mb3Jt
YXQtPnZzdWI7CisJaW50IG1haW5fcGxhbmU7CisJaW50IGhzdWIsIHZzdWI7CiAJaW50IHRpbGVf
d2lkdGgsIHRpbGVfaGVpZ2h0OwogCWludCBjY3NfeCwgY2NzX3k7CiAJaW50IG1haW5feCwgbWFp
bl95OwogCi0JaWYgKCFpc19jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSB8fCBjY3NfcGxhbmUg
IT0gMSkKKwlpZiAoIWlzX2Njc19wbGFuZShmYiwgY2NzX3BsYW5lKSkKIAkJcmV0dXJuIDA7CiAK
LQlpbnRlbF90aWxlX2RpbXMoZmIsIDEsICZ0aWxlX3dpZHRoLCAmdGlsZV9oZWlnaHQpOworCWlu
dGVsX3RpbGVfZGltcyhmYiwgY2NzX3BsYW5lLCAmdGlsZV93aWR0aCwgJnRpbGVfaGVpZ2h0KTsK
KwlpbnRlbF9mYl9wbGFuZV9nZXRfc3Vic2FtcGxpbmcoJmhzdWIsICZ2c3ViLCBmYiwgY2NzX3Bs
YW5lKTsKIAogCXRpbGVfd2lkdGggKj0gaHN1YjsKIAl0aWxlX2hlaWdodCAqPSB2c3ViOwogCiAJ
Y2NzX3ggPSAoeCAqIGhzdWIpICUgdGlsZV93aWR0aDsKIAljY3NfeSA9ICh5ICogdnN1YikgJSB0
aWxlX2hlaWdodDsKLQltYWluX3ggPSBpbnRlbF9mYi0+bm9ybWFsWzBdLnggJSB0aWxlX3dpZHRo
OwotCW1haW5feSA9IGludGVsX2ZiLT5ub3JtYWxbMF0ueSAlIHRpbGVfaGVpZ2h0OworCisJbWFp
bl9wbGFuZSA9IGNjc190b19tYWluX3BsYW5lKGZiLCBjY3NfcGxhbmUpOworCW1haW5feCA9IGlu
dGVsX2ZiLT5ub3JtYWxbbWFpbl9wbGFuZV0ueCAlIHRpbGVfd2lkdGg7CisJbWFpbl95ID0gaW50
ZWxfZmItPm5vcm1hbFttYWluX3BsYW5lXS55ICUgdGlsZV9oZWlnaHQ7CiAKIAkvKgogCSAqIEND
UyBkb2Vzbid0IGhhdmUgaXRzIG93biB4L3kgb2Zmc2V0IHJlZ2lzdGVyLCBzbyB0aGUgaW50cmEg
Q0NTIHRpbGUKQEAgLTI3NDIsOCArMjg1MCw4IEBAIGludGVsX2ZiX2NoZWNrX2Njc194eShzdHJ1
Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNjc19wbGFuZSwgaW50IHgsIGludCB5KQogCQlE
Uk1fREVCVUdfS01TKCJCYWQgQ0NTIHgveSAobWFpbiAlZCwlZCBjY3MgJWQsJWQpIGZ1bGwgKG1h
aW4gJWQsJWQgY2NzICVkLCVkKVxuIiwKIAkJCSAgICAgIG1haW5feCwgbWFpbl95LAogCQkJICAg
ICAgY2NzX3gsIGNjc195LAotCQkJICAgICAgaW50ZWxfZmItPm5vcm1hbFswXS54LAotCQkJICAg
ICAgaW50ZWxfZmItPm5vcm1hbFswXS55LAorCQkJICAgICAgaW50ZWxfZmItPm5vcm1hbFttYWlu
X3BsYW5lXS54LAorCQkJICAgICAgaW50ZWxfZmItPm5vcm1hbFttYWluX3BsYW5lXS55LAogCQkJ
ICAgICAgeCwgeSk7CiAJCXJldHVybiAtRUlOVkFMOwogCX0KQEAgLTI3NTEsNiArMjg1OSwxNiBA
QCBpbnRlbF9mYl9jaGVja19jY3NfeHkoc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBj
Y3NfcGxhbmUsIGludCB4LCBpbnQgeSkKIAlyZXR1cm4gMDsKIH0KIAorc3RhdGljIHZvaWQKK2lu
dGVsX2ZiX3BsYW5lX2RpbXMoaW50ICp3LCBpbnQgKmgsIHN0cnVjdCBkcm1fZnJhbWVidWZmZXIg
KmZiLCBpbnQgY29sb3JfcGxhbmUpCit7CisJaW50IGhzdWIsIHZzdWI7CisKKwlpbnRlbF9mYl9w
bGFuZV9nZXRfc3Vic2FtcGxpbmcoJmhzdWIsICZ2c3ViLCBmYiwgY29sb3JfcGxhbmUpOworCSp3
ID0gZmItPndpZHRoIC8gaHN1YjsKKwkqaCA9IGZiLT5oZWlnaHQgLyB2c3ViOworfQorCiBzdGF0
aWMgaW50CiBpbnRlbF9maWxsX2ZiX2luZm8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAogCQkgICBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYikKQEAgLTI3NzEsOCArMjg4OSw3
IEBAIGludGVsX2ZpbGxfZmJfaW5mbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CiAJCWludCByZXQ7CiAKIAkJY3BwID0gZmItPmZvcm1hdC0+Y3BwW2ldOwotCQl3aWR0aCA9IGRy
bV9mcmFtZWJ1ZmZlcl9wbGFuZV93aWR0aChmYi0+d2lkdGgsIGZiLCBpKTsKLQkJaGVpZ2h0ID0g
ZHJtX2ZyYW1lYnVmZmVyX3BsYW5lX2hlaWdodChmYi0+aGVpZ2h0LCBmYiwgaSk7CisJCWludGVs
X2ZiX3BsYW5lX2RpbXMoJndpZHRoLCAmaGVpZ2h0LCBmYiwgaSk7CiAKIAkJcmV0ID0gaW50ZWxf
ZmJfb2Zmc2V0X3RvX3h5KCZ4LCAmeSwgZmIsIGkpOwogCQlpZiAocmV0KSB7CkBAIC0yODE0LDcg
KzI5MzEsNyBAQCBpbnRlbF9maWxsX2ZiX2luZm8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAogCQkJCQkJICAgICAgdGlsZV9zaXplKTsKIAkJb2Zmc2V0IC89IHRpbGVfc2l6ZTsK
IAotCQlpZiAoIWlzX3N1cmZhY2VfbGluZWFyKGZiLT5tb2RpZmllciwgaSkpIHsKKwkJaWYgKCFp
c19zdXJmYWNlX2xpbmVhcihmYiwgaSkpIHsKIAkJCXVuc2lnbmVkIGludCB0aWxlX3dpZHRoLCB0
aWxlX2hlaWdodDsKIAkJCXVuc2lnbmVkIGludCBwaXRjaF90aWxlczsKIAkJCXN0cnVjdCBkcm1f
cmVjdCByOwpAQCAtMzQ5MywxNCArMzYxMCwxNSBAQCBzdGF0aWMgYm9vbCBza2xfY2hlY2tfbWFp
bl9jY3NfY29vcmRpbmF0ZXMoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZQog
CQkJCQkgICBpbnQgbWFpbl94LCBpbnQgbWFpbl95LCB1MzIgbWFpbl9vZmZzZXQpCiB7CiAJY29u
c3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7Ci0JaW50
IGhzdWIgPSBmYi0+Zm9ybWF0LT5oc3ViOwotCWludCB2c3ViID0gZmItPmZvcm1hdC0+dnN1YjsK
IAlpbnQgY2NzX3BsYW5lID0gbWFpbl90b19jY3NfcGxhbmUoZmIsIDApOwogCWludCBhdXhfeCA9
IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLng7CiAJaW50IGF1eF95ID0gcGxh
bmVfc3RhdGUtPmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueTsKIAl1MzIgYXV4X29mZnNldCA9IHBs
YW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLm9mZnNldDsKIAl1MzIgYWxpZ25tZW50
ID0gaW50ZWxfc3VyZl9hbGlnbm1lbnQoZmIsIGNjc19wbGFuZSk7CisJaW50IGhzdWI7CisJaW50
IHZzdWI7CiAKKwlpbnRlbF9mYl9wbGFuZV9nZXRfc3Vic2FtcGxpbmcoJmhzdWIsICZ2c3ViLCBm
YiwgY2NzX3BsYW5lKTsKIAl3aGlsZSAoYXV4X29mZnNldCA+PSBtYWluX29mZnNldCAmJiBhdXhf
eSA8PSBtYWluX3kpIHsKIAkJaW50IHgsIHk7CiAKQEAgLTM2NjcsMTIgKzM3ODUsMTUgQEAgc3Rh
dGljIGludCBza2xfY2hlY2tfY2NzX2F1eF9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0
ZSAqcGxhbmVfc3RhdGUpCiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFu
ZV9zdGF0ZS0+aHcuZmI7CiAJaW50IHNyY194ID0gcGxhbmVfc3RhdGUtPnVhcGkuc3JjLngxID4+
IDE2OwogCWludCBzcmNfeSA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy55MSA+PiAxNjsKLQlpbnQg
aHN1YiA9IGZiLT5mb3JtYXQtPmhzdWI7Ci0JaW50IHZzdWIgPSBmYi0+Zm9ybWF0LT52c3ViOwot
CWludCB4ID0gc3JjX3ggLyBoc3ViOwotCWludCB5ID0gc3JjX3kgLyB2c3ViOworCWludCBoc3Vi
OworCWludCB2c3ViOworCWludCB4OworCWludCB5OwogCXUzMiBvZmZzZXQ7CiAKKwlpbnRlbF9m
Yl9wbGFuZV9nZXRfc3Vic2FtcGxpbmcoJmhzdWIsICZ2c3ViLCBmYiwgMSk7CisJeCA9IHNyY194
IC8gaHN1YjsKKwl5ID0gc3JjX3kgLyB2c3ViOwogCWludGVsX2FkZF9mYl9vZmZzZXRzKCZ4LCAm
eSwgcGxhbmVfc3RhdGUsIDEpOwogCW9mZnNldCA9IGludGVsX3BsYW5lX2NvbXB1dGVfYWxpZ25l
ZF9vZmZzZXQoJngsICZ5LCBwbGFuZV9zdGF0ZSwgMSk7CiAKQEAgLTQxNjgsNyArNDI4OSw3IEBA
IHN0YXRpYyB1bnNpZ25lZCBpbnQgc2tsX3BsYW5lX3N0cmlkZV9tdWx0KGNvbnN0IHN0cnVjdCBk
cm1fZnJhbWVidWZmZXIgKmZiLAogCSAqIFRoZSBzdHJpZGUgaXMgZWl0aGVyIGV4cHJlc3NlZCBh
cyBhIG11bHRpcGxlIG9mIDY0IGJ5dGVzIGNodW5rcyBmb3IKIAkgKiBsaW5lYXIgYnVmZmVycyBv
ciBpbiBudW1iZXIgb2YgdGlsZXMgZm9yIHRpbGVkIGJ1ZmZlcnMuCiAJICovCi0JaWYgKGZiLT5t
b2RpZmllciA9PSBEUk1fRk9STUFUX01PRF9MSU5FQVIpCisJaWYgKGlzX3N1cmZhY2VfbGluZWFy
KGZiLCBjb2xvcl9wbGFuZSkpCiAJCXJldHVybiA2NDsKIAllbHNlIGlmIChkcm1fcm90YXRpb25f
OTBfb3JfMjcwKHJvdGF0aW9uKSkKIAkJcmV0dXJuIGludGVsX3RpbGVfaGVpZ2h0KGZiLCBjb2xv
cl9wbGFuZSk7CkBAIC00Mjk2LDYgKzQ0MTcsMTAgQEAgc3RhdGljIHUzMiBza2xfcGxhbmVfY3Rs
X3RpbGluZyh1NjQgZmJfbW9kaWZpZXIpCiAJCXJldHVybiBQTEFORV9DVExfVElMRURfWTsKIAlj
YXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUzoKIAkJcmV0dXJuIFBMQU5FX0NUTF9USUxF
RF9ZIHwgUExBTkVfQ1RMX1JFTkRFUl9ERUNPTVBSRVNTSU9OX0VOQUJMRTsKKwljYXNlIEk5MTVf
Rk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUzoKKwkJcmV0dXJuIFBMQU5FX0NUTF9USUxF
RF9ZIHwKKwkJICAgICAgIFBMQU5FX0NUTF9SRU5ERVJfREVDT01QUkVTU0lPTl9FTkFCTEUgfAor
CQkgICAgICAgUExBTkVfQ1RMX0NMRUFSX0NPTE9SX0RJU0FCTEU7CiAJY2FzZSBJOTE1X0ZPUk1B
VF9NT0RfWWZfVElMRUQ6CiAJCXJldHVybiBQTEFORV9DVExfVElMRURfWUY7CiAJY2FzZSBJOTE1
X0ZPUk1BVF9NT0RfWWZfVElMRURfQ0NTOgpAQCAtMTAwMjcsNyArMTAxNTIsOSBAQCBza3lsYWtl
X2dldF9pbml0aWFsX3BsYW5lX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAljYXNl
IFBMQU5FX0NUTF9USUxFRF9ZOgogCQlwbGFuZV9jb25maWctPnRpbGluZyA9IEk5MTVfVElMSU5H
X1k7CiAJCWlmICh2YWwgJiBQTEFORV9DVExfUkVOREVSX0RFQ09NUFJFU1NJT05fRU5BQkxFKQot
CQkJZmItPm1vZGlmaWVyID0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfQ0NTOworCQkJZmItPm1v
ZGlmaWVyID0gSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMiA/CisJCQkJSTkxNV9GT1JNQVRfTU9E
X1lfVElMRURfR0VOMTJfUkNfQ0NTIDoKKwkJCQlJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1M7
CiAJCWVsc2UKIAkJCWZiLT5tb2RpZmllciA9IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEOwogCQli
cmVhazsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3By
aXRlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCmluZGV4
IGE1YjdjYWI2ZGZmMy4uMGEyOTg2NjdiN2M2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfc3ByaXRlLmMKQEAgLTU4Myw2ICs1ODMsNyBAQCBza2xfcHJvZ3JhbV9wbGFu
ZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCWNvbnN0IHN0cnVjdCBkcm1faW50ZWxfc3By
aXRlX2NvbG9ya2V5ICprZXkgPSAmcGxhbmVfc3RhdGUtPmNrZXk7CiAJdTMyIHN1cmZfYWRkciA9
IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjb2xvcl9wbGFuZV0ub2Zmc2V0OwogCXUzMiBzdHJp
ZGUgPSBza2xfcGxhbmVfc3RyaWRlKHBsYW5lX3N0YXRlLCBjb2xvcl9wbGFuZSk7CisJdTMyIGF1
eF9kaXN0ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzFdLm9mZnNldCAtIHN1cmZfYWRkcjsK
IAl1MzIgYXV4X3N0cmlkZSA9IHNrbF9wbGFuZV9zdHJpZGUocGxhbmVfc3RhdGUsIDEpOwogCWlu
dCBjcnRjX3ggPSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3QueDE7CiAJaW50IGNydGNfeSA9IHBsYW5l
X3N0YXRlLT51YXBpLmRzdC55MTsKQEAgLTYyNCw4ICs2MjUsMTAgQEAgc2tsX3Byb2dyYW1fcGxh
bmUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAlJOTE1X1dSSVRFX0ZXKFBMQU5FX1NUUklE
RShwaXBlLCBwbGFuZV9pZCksIHN0cmlkZSk7CiAJSTkxNV9XUklURV9GVyhQTEFORV9QT1MocGlw
ZSwgcGxhbmVfaWQpLCAoY3J0Y195IDw8IDE2KSB8IGNydGNfeCk7CiAJSTkxNV9XUklURV9GVyhQ
TEFORV9TSVpFKHBpcGUsIHBsYW5lX2lkKSwgKHNyY19oIDw8IDE2KSB8IHNyY193KTsKLQlJOTE1
X1dSSVRFX0ZXKFBMQU5FX0FVWF9ESVNUKHBpcGUsIHBsYW5lX2lkKSwKLQkJICAgICAgKHBsYW5l
X3N0YXRlLT5jb2xvcl9wbGFuZVsxXS5vZmZzZXQgLSBzdXJmX2FkZHIpIHwgYXV4X3N0cmlkZSk7
CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDEyKQorCQlhdXhfZGlzdCB8PSBhdXhfc3Ry
aWRlOworCUk5MTVfV1JJVEVfRlcoUExBTkVfQVVYX0RJU1QocGlwZSwgcGxhbmVfaWQpLCBhdXhf
ZGlzdCk7CiAKIAlpZiAoaWNsX2lzX2hkcl9wbGFuZShkZXZfcHJpdiwgcGxhbmVfaWQpKQogCQlJ
OTE1X1dSSVRFX0ZXKFBMQU5FX0NVU19DVEwocGlwZSwgcGxhbmVfaWQpLCBwbGFuZV9zdGF0ZS0+
Y3VzX2N0bCk7CkBAIC0yMTAyLDcgKzIxMDUsOCBAQCBzdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVj
a19mYihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkgICAgKGZi
LT5tb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRCB8fAogCSAgICAgZmItPm1vZGlm
aWVyID09IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRCB8fAogCSAgICAgZmItPm1vZGlmaWVyID09
IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUyB8fAotCSAgICAgZmItPm1vZGlmaWVyID09IEk5
MTVfRk9STUFUX01PRF9ZZl9USUxFRF9DQ1MpKSB7CisJICAgICBmYi0+bW9kaWZpZXIgPT0gSTkx
NV9GT1JNQVRfTU9EX1lmX1RJTEVEX0NDUyB8fAorCSAgICAgZmItPm1vZGlmaWVyID09IEk5MTVf
Rk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUykpIHsKIAkJRFJNX0RFQlVHX0tNUygiWS9Z
ZiB0aWxpbmcgbm90IHN1cHBvcnRlZCBpbiBJRi1JRCBtb2RlXG4iKTsKIAkJcmV0dXJuIC1FSU5W
QUw7CiAJfQpAQCAtMjU3Myw3ICsyNTc3LDggQEAgc3RhdGljIGNvbnN0IHU2NCBza2xfcGxhbmVf
Zm9ybWF0X21vZGlmaWVyc19jY3NbXSA9IHsKIAlEUk1fRk9STUFUX01PRF9JTlZBTElECiB9Owog
Ci1zdGF0aWMgY29uc3QgdTY0IGdlbjEyX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfbm9jY3NbXSA9
IHsKK3N0YXRpYyBjb25zdCB1NjQgZ2VuMTJfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19jY3NbXSA9
IHsKKwlJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1MsCiAJSTkxNV9GT1JNQVRf
TU9EX1lfVElMRUQsCiAJSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQsCiAJRFJNX0ZPUk1BVF9NT0Rf
TElORUFSLApAQCAtMjc0NCw2ICsyNzQ5LDcgQEAgc3RhdGljIGJvb2wgZ2VuMTJfcGxhbmVfZm9y
bWF0X21vZF9zdXBwb3J0ZWQoc3RydWN0IGRybV9wbGFuZSAqX3BsYW5lLAogCWNhc2UgRFJNX0ZP
Uk1BVF9NT0RfTElORUFSOgogCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQ6CiAJY2FzZSBJ
OTE1X0ZPUk1BVF9NT0RfWV9USUxFRDoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dF
TjEyX1JDX0NDUzoKIAkJYnJlYWs7CiAJZGVmYXVsdDoKIAkJcmV0dXJuIGZhbHNlOwpAQCAtMjc1
NCw2ICsyNzYwLDkgQEAgc3RhdGljIGJvb2wgZ2VuMTJfcGxhbmVfZm9ybWF0X21vZF9zdXBwb3J0
ZWQoc3RydWN0IGRybV9wbGFuZSAqX3BsYW5lLAogCWNhc2UgRFJNX0ZPUk1BVF9YQkdSODg4ODoK
IAljYXNlIERSTV9GT1JNQVRfQVJHQjg4ODg6CiAJY2FzZSBEUk1fRk9STUFUX0FCR1I4ODg4Ogor
CQlpZiAoaXNfY2NzX21vZGlmaWVyKG1vZGlmaWVyKSkKKwkJCXJldHVybiB0cnVlOworCQkvKiBm
YWxsIHRocm91Z2ggKi8KIAljYXNlIERSTV9GT1JNQVRfUkdCNTY1OgogCWNhc2UgRFJNX0ZPUk1B
VF9YUkdCMjEwMTAxMDoKIAljYXNlIERSTV9GT1JNQVRfWEJHUjIxMDEwMTA6CkBAIC0yOTYzLDEz
ICsyOTcyLDExIEBAIHNrbF91bml2ZXJzYWxfcGxhbmVfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKIAkJZm9ybWF0cyA9IHNrbF9nZXRfcGxhbmVfZm9ybWF0cyhkZXZf
cHJpdiwgcGlwZSwKIAkJCQkJCXBsYW5lX2lkLCAmbnVtX2Zvcm1hdHMpOwogCisJcGxhbmUtPmhh
c19jY3MgPSBza2xfcGxhbmVfaGFzX2NjcyhkZXZfcHJpdiwgcGlwZSwgcGxhbmVfaWQpOwogCWlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKSB7Ci0JCS8qIFRPRE86IEltcGxlbWVudCBzdXBw
b3J0IGZvciBnZW4tMTIgQ0NTIG1vZGlmaWVycyAqLwotCQlwbGFuZS0+aGFzX2NjcyA9IGZhbHNl
OwotCQltb2RpZmllcnMgPSBnZW4xMl9wbGFuZV9mb3JtYXRfbW9kaWZpZXJzX25vY2NzOworCQlt
b2RpZmllcnMgPSBnZW4xMl9wbGFuZV9mb3JtYXRfbW9kaWZpZXJzX2NjczsKIAkJcGxhbmVfZnVu
Y3MgPSAmZ2VuMTJfcGxhbmVfZnVuY3M7CiAJfSBlbHNlIHsKLQkJcGxhbmUtPmhhc19jY3MgPSBz
a2xfcGxhbmVfaGFzX2NjcyhkZXZfcHJpdiwgcGlwZSwgcGxhbmVfaWQpOwogCQlpZiAocGxhbmUt
Pmhhc19jY3MpCiAJCQltb2RpZmllcnMgPSBza2xfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19jY3M7
CiAJCWVsc2UKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oCmluZGV4IGNiYjQ2ODlhZjQzMi4uYmJmZWRl
YjAwYjdmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmgKQEAgLTY4MDAsNiArNjgwMCw3IEBAIGVu
dW0gewogI2RlZmluZSAgIFBMQU5FX0NUTF9ZVVY0MjJfVllVWQkJCSgzIDw8IDE2KQogI2RlZmlu
ZSAgIFBMQU5FX0NUTF9SRU5ERVJfREVDT01QUkVTU0lPTl9FTkFCTEUJKDEgPDwgMTUpCiAjZGVm
aW5lICAgUExBTkVfQ1RMX1RSSUNLTEVfRkVFRF9ESVNBQkxFCSgxIDw8IDE0KQorI2RlZmluZSAg
IFBMQU5FX0NUTF9DTEVBUl9DT0xPUl9ESVNBQkxFCQkoMSA8PCAxMykgLyogVEdMKyAqLwogI2Rl
ZmluZSAgIFBMQU5FX0NUTF9QTEFORV9HQU1NQV9ESVNBQkxFCQkoMSA8PCAxMykgLyogUHJlLUdM
SyAqLwogI2RlZmluZSAgIFBMQU5FX0NUTF9USUxFRF9NQVNLCQkJKDB4NyA8PCAxMCkKICNkZWZp
bmUgICBQTEFORV9DVExfVElMRURfTElORUFSCQkoMCA8PCAxMCkKLS0gCjIuMjIuMAoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxp
bmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

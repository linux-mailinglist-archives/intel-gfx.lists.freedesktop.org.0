Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 29423217B7
	for <lists+intel-gfx@lfdr.de>; Fri, 17 May 2019 13:26:14 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A514C899B3;
	Fri, 17 May 2019 11:26:11 +0000 (UTC)
X-Original-To: Intel-gfx@lists.freedesktop.org
Delivered-To: Intel-gfx@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3960389973;
 Fri, 17 May 2019 11:25:59 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga005.fm.intel.com ([10.253.24.32])
 by fmsmga104.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 17 May 2019 04:25:59 -0700
X-ExtLoop1: 1
Received: from kmarenda-mobl2.ger.corp.intel.com (HELO localhost.localdomain)
 ([10.252.11.159])
 by fmsmga005.fm.intel.com with ESMTP; 17 May 2019 04:25:58 -0700
From: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>
To: igt-dev@lists.freedesktop.org
Date: Fri, 17 May 2019 12:25:24 +0100
Message-Id: <20190517112526.6738-24-tvrtko.ursulin@linux.intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190517112526.6738-1-tvrtko.ursulin@linux.intel.com>
References: <20190517112526.6738-1-tvrtko.ursulin@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t 23/25] gem_wsim: Consolidate engine
 assignments into helpers
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Intel-gfx@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KClRoaXMgd2ls
bCBhbGxvdyBhcHBseWluZyB0aGUgZGlzY292ZXJlZCBlbmdpbmUgY29uZmlndXJhdGlvbiBmcm9t
IGEgc2luZ2xlCnBsYWNlLgoKU2lnbmVkLW9mZi1ieTogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51
cnN1bGluQGludGVsLmNvbT4KLS0tCiBiZW5jaG1hcmtzL2dlbV93c2ltLmMgfCAxNDUgKysrKysr
KysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgODcg
aW5zZXJ0aW9ucygrKSwgNTggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvYmVuY2htYXJrcy9n
ZW1fd3NpbS5jIGIvYmVuY2htYXJrcy9nZW1fd3NpbS5jCmluZGV4IGFmMDQyZDcxYzFkMy4uZDQz
ZTdjNzY3ODAxIDEwMDY0NAotLS0gYS9iZW5jaG1hcmtzL2dlbV93c2ltLmMKKysrIGIvYmVuY2ht
YXJrcy9nZW1fd3NpbS5jCkBAIC0zNjUsNiArMzY1LDYxIEBAIHN0YXRpYyBpbnQgc3RyX3RvX2Vu
Z2luZShjb25zdCBjaGFyICpzdHIpCiAJcmV0dXJuIC0xOwogfQogCitzdGF0aWMgdW5zaWduZWQg
aW50IG51bV9lbmdpbmVzX2luX2NsYXNzKGVudW0gaW50ZWxfZW5naW5lX2lkIGNsYXNzKQorewor
CWlndF9hc3NlcnQoY2xhc3MgPT0gVkNTKTsKKworCXJldHVybiAyOworfQorCitzdGF0aWMgdm9p
ZAorZmlsbF9lbmdpbmVzX2NsYXNzKHN0cnVjdCBpOTE1X2VuZ2luZV9jbGFzc19pbnN0YW5jZSAq
Y2ksCisJCSAgIGVudW0gaW50ZWxfZW5naW5lX2lkIGNsYXNzKQoreworCWlndF9hc3NlcnQoY2xh
c3MgPT0gVkNTKTsKKworCWNpWzBdLmVuZ2luZV9jbGFzcyA9IEk5MTVfRU5HSU5FX0NMQVNTX1ZJ
REVPOworCWNpWzBdLmVuZ2luZV9pbnN0YW5jZSA9IDA7CisKKwljaVsxXS5lbmdpbmVfY2xhc3Mg
PSBJOTE1X0VOR0lORV9DTEFTU19WSURFTzsKKwljaVsxXS5lbmdpbmVfaW5zdGFuY2UgPSAxOwor
fQorCitzdGF0aWMgdm9pZAorZmlsbF9lbmdpbmVzX2lkX2NsYXNzKGVudW0gaW50ZWxfZW5naW5l
X2lkICpsaXN0LAorCQkgICAgICBlbnVtIGludGVsX2VuZ2luZV9pZCBjbGFzcykKK3sKKwlpZ3Rf
YXNzZXJ0KGNsYXNzID09IFZDUyk7CisKKwlsaXN0WzBdID0gVkNTMTsKKwlsaXN0WzFdID0gVkNT
MjsKK30KKworc3RhdGljIHN0cnVjdCBpOTE1X2VuZ2luZV9jbGFzc19pbnN0YW5jZQorZ2V0X2Vu
Z2luZShlbnVtIGludGVsX2VuZ2luZV9pZCBlbmdpbmUpCit7CisJc3RydWN0IGk5MTVfZW5naW5l
X2NsYXNzX2luc3RhbmNlIGNpOworCisJc3dpdGNoIChlbmdpbmUpIHsKKwljYXNlIFJDUzoKKwkJ
Y2kuZW5naW5lX2NsYXNzID0gSTkxNV9FTkdJTkVfQ0xBU1NfUkVOREVSOworCQljaS5lbmdpbmVf
aW5zdGFuY2UgPSAwOworCQlicmVhazsKKwljYXNlIFZDUzE6CisJCWNpLmVuZ2luZV9jbGFzcyA9
IEk5MTVfRU5HSU5FX0NMQVNTX1ZJREVPOworCQljaS5lbmdpbmVfaW5zdGFuY2UgPSAwOworCQli
cmVhazsKKwljYXNlIFZDUzI6CisJCWNpLmVuZ2luZV9jbGFzcyA9IEk5MTVfRU5HSU5FX0NMQVNT
X1ZJREVPOworCQljaS5lbmdpbmVfaW5zdGFuY2UgPSAxOworCQlicmVhazsKKwlkZWZhdWx0Ogor
CQlpZ3RfYXNzZXJ0KDApOworCX07CisKKwlyZXR1cm4gY2k7Cit9CisKIHN0YXRpYyBpbnQgcGFy
c2VfZW5naW5lX21hcChzdHJ1Y3Qgd19zdGVwICpzdGVwLCBjb25zdCBjaGFyICpfc3RyKQogewog
CWNoYXIgKnRva2VuLCAqdGN0eCA9IE5VTEwsICp0c3RhcnQgPSAoY2hhciAqKV9zdHI7CkBAIC0z
ODYsMTggKzQ0MSwxNiBAQCBzdGF0aWMgaW50IHBhcnNlX2VuZ2luZV9tYXAoc3RydWN0IHdfc3Rl
cCAqc3RlcCwgY29uc3QgY2hhciAqX3N0cikKIAkJICAgIGVuZ2luZSAhPSBSQ1MpCiAJCQlyZXR1
cm4gLTE7IC8qIFRPRE8gKi8KIAotCQlhZGQgPSBlbmdpbmUgPT0gVkNTID8gMiA6IDE7CisJCWFk
ZCA9IGVuZ2luZSA9PSBWQ1MgPyBudW1fZW5naW5lc19pbl9jbGFzcyhWQ1MpIDogMTsKIAkJc3Rl
cC0+ZW5naW5lX21hcF9jb3VudCArPSBhZGQ7CiAJCXN0ZXAtPmVuZ2luZV9tYXAgPSByZWFsbG9j
KHN0ZXAtPmVuZ2luZV9tYXAsCiAJCQkJCSAgIHN0ZXAtPmVuZ2luZV9tYXBfY291bnQgKgogCQkJ
CQkgICBzaXplb2Yoc3RlcC0+ZW5naW5lX21hcFswXSkpOwogCi0JCWlmIChlbmdpbmUgIT0gVkNT
KSB7Ci0JCQlzdGVwLT5lbmdpbmVfbWFwW3N0ZXAtPmVuZ2luZV9tYXBfY291bnQgLSAxXSA9IGVu
Z2luZTsKLQkJfSBlbHNlIHsKLQkJCXN0ZXAtPmVuZ2luZV9tYXBbc3RlcC0+ZW5naW5lX21hcF9j
b3VudCAtIDJdID0gVkNTMTsKLQkJCXN0ZXAtPmVuZ2luZV9tYXBbc3RlcC0+ZW5naW5lX21hcF9j
b3VudCAtIDFdID0gVkNTMjsKLQkJfQorCQlpZiAoZW5naW5lICE9IFZDUykKKwkJCXN0ZXAtPmVu
Z2luZV9tYXBbc3RlcC0+ZW5naW5lX21hcF9jb3VudCAtIGFkZF0gPSBlbmdpbmU7CisJCWVsc2UK
KwkJCWZpbGxfZW5naW5lc19pZF9jbGFzcygmc3RlcC0+ZW5naW5lX21hcFtzdGVwLT5lbmdpbmVf
bWFwX2NvdW50IC0gYWRkXSwgVkNTKTsKIAl9CiAKIAlyZXR1cm4gMDsKQEAgLTE0NzIsMTkgKzE1
MjUsOSBAQCBwcmVwYXJlX3dvcmtsb2FkKHVuc2lnbmVkIGludCBpZCwgc3RydWN0IHdvcmtsb2Fk
ICp3cmssIHVuc2lnbmVkIGludCBmbGFncykKIAkJCQlsb2FkX2JhbGFuY2UubnVtX3NpYmxpbmdz
ID0KIAkJCQkJY3R4LT5lbmdpbmVfbWFwX2NvdW50OwogCi0JCQkJZm9yIChqID0gMDsgaiA8IGN0
eC0+ZW5naW5lX21hcF9jb3VudDsgaisrKSB7Ci0JCQkJCWlmIChjdHgtPmVuZ2luZV9tYXBbal0g
PT0gUkNTKSB7Ci0JCQkJCQlsb2FkX2JhbGFuY2UuZW5naW5lc1tqXS5lbmdpbmVfY2xhc3MgPQot
CQkJCQkJCUk5MTVfRU5HSU5FX0NMQVNTX1JFTkRFUjsKLQkJCQkJCWxvYWRfYmFsYW5jZS5lbmdp
bmVzW2pdLmVuZ2luZV9pbnN0YW5jZSA9Ci0JCQkJCQkJMDsgLyogRklYTUUgKi8KLQkJCQkJfSBl
bHNlIHsKLQkJCQkJCWxvYWRfYmFsYW5jZS5lbmdpbmVzW2pdLmVuZ2luZV9jbGFzcyA9Ci0JCQkJ
CQkJSTkxNV9FTkdJTkVfQ0xBU1NfVklERU87IC8qIEZJWE1FICovCi0JCQkJCQlsb2FkX2JhbGFu
Y2UuZW5naW5lc1tqXS5lbmdpbmVfaW5zdGFuY2UgPQotCQkJCQkJCWN0eC0+ZW5naW5lX21hcFtq
XSAtIFZDUzE7IC8qIEZJWE1FICovCi0JCQkJCX0KLQkJCQl9CisJCQkJZm9yIChqID0gMDsgaiA8
IGN0eC0+ZW5naW5lX21hcF9jb3VudDsgaisrKQorCQkJCQlsb2FkX2JhbGFuY2UuZW5naW5lc1tq
XSA9CisJCQkJCQlnZXRfZW5naW5lKGN0eC0+ZW5naW5lX21hcFtqXSk7CiAJCQl9IGVsc2Ugewog
CQkJCXNldF9lbmdpbmVzLmV4dGVuc2lvbnMgPSAwOwogCQkJfQpAQCAtMTQ5NSwxOCArMTUzOCw5
IEBAIHByZXBhcmVfd29ya2xvYWQodW5zaWduZWQgaW50IGlkLCBzdHJ1Y3Qgd29ya2xvYWQgKndy
aywgdW5zaWduZWQgaW50IGZsYWdzKQogCQkJc2V0X2VuZ2luZXMuZW5naW5lc1swXS5lbmdpbmVf
aW5zdGFuY2UgPQogCQkJCUk5MTVfRU5HSU5FX0NMQVNTX0lOVkFMSURfTk9ORTsKIAotCQkJZm9y
IChqID0gMTsgaiA8PSBjdHgtPmVuZ2luZV9tYXBfY291bnQ7IGorKykgewotCQkJCWlmIChjdHgt
PmVuZ2luZV9tYXBbaiAtIDFdID09IFJDUykgewotCQkJCQlzZXRfZW5naW5lcy5lbmdpbmVzW2pd
LmVuZ2luZV9jbGFzcyA9Ci0JCQkJCQlJOTE1X0VOR0lORV9DTEFTU19SRU5ERVI7Ci0JCQkJCXNl
dF9lbmdpbmVzLmVuZ2luZXNbal0uZW5naW5lX2luc3RhbmNlID0gMDsgLyogRklYTUUgKi8KLQkJ
CQl9IGVsc2UgewotCQkJCQlzZXRfZW5naW5lcy5lbmdpbmVzW2pdLmVuZ2luZV9jbGFzcyA9Ci0J
CQkJCQlJOTE1X0VOR0lORV9DTEFTU19WSURFTzsgLyogRklYTUUgKi8KLQkJCQkJc2V0X2VuZ2lu
ZXMuZW5naW5lc1tqXS5lbmdpbmVfaW5zdGFuY2UgPQotCQkJCQkJY3R4LT5lbmdpbmVfbWFwW2og
LSAxXSAtIFZDUzE7IC8qIEZJWE1FICovCi0JCQkJfQotCQkJfQorCQkJZm9yIChqID0gMTsgaiA8
PSBjdHgtPmVuZ2luZV9tYXBfY291bnQ7IGorKykKKwkJCQlzZXRfZW5naW5lcy5lbmdpbmVzW2pd
ID0KKwkJCQkJZ2V0X2VuZ2luZShjdHgtPmVuZ2luZV9tYXBbaiAtIDFdKTsKIAogCQkJZm9yIChq
ID0gMDsgaiA8IGN0eC0+Ym9uZF9jb3VudDsgaisrKSB7CiAJCQkJdW5zaWduZWQgbG9uZyBtYXNr
ID0gY3R4LT5ib25kc1tqXS5tYXNrOwpAQCAtMTUyOSwxMCArMTU2Myw3IEBAIHByZXBhcmVfd29y
a2xvYWQodW5zaWduZWQgaW50IGlkLCBzdHJ1Y3Qgd29ya2xvYWQgKndyaywgdW5zaWduZWQgaW50
IGZsYWdzKQogCiAJCQkJcC0+YmFzZS5uYW1lID0gSTkxNV9DT05URVhUX0VOR0lORVNfRVhUX0JP
TkQ7CiAJCQkJcC0+dmlydHVhbF9pbmRleCA9IDA7Ci0JCQkJcC0+bWFzdGVyLmVuZ2luZV9jbGFz
cyA9Ci0JCQkJCUk5MTVfRU5HSU5FX0NMQVNTX1ZJREVPOwotCQkJCXAtPm1hc3Rlci5lbmdpbmVf
aW5zdGFuY2UgPQotCQkJCQljdHgtPmJvbmRzW2pdLm1hc3RlciAtIFZDUzE7CisJCQkJcC0+bWFz
dGVyID0gZ2V0X2VuZ2luZShjdHgtPmJvbmRzW2pdLm1hc3Rlcik7CiAKIAkJCQlmb3IgKGIgPSAw
LCBlID0gMDsgbWFzazsgZSsrLCBtYXNrID4+PSAxKSB7CiAJCQkJCXVuc2lnbmVkIGludCBpZHg7
CkBAIC0xNTUwLDI4ICsxNTgxLDExIEBAIHByZXBhcmVfd29ya2xvYWQodW5zaWduZWQgaW50IGlk
LCBzdHJ1Y3Qgd29ya2xvYWQgKndyaywgdW5zaWduZWQgaW50IGZsYWdzKQogCiAJCQlnZW1fY29u
dGV4dF9zZXRfcGFyYW0oZmQsICZwYXJhbSk7CiAJCX0gZWxzZSBpZiAoY3R4LT53YW50c19iYWxh
bmNlKSB7Ci0JCQlJOTE1X0RFRklORV9DT05URVhUX0VOR0lORVNfTE9BRF9CQUxBTkNFKGxvYWRf
YmFsYW5jZSwgMikgPSB7Ci0JCQkJLmJhc2UubmFtZSA9IEk5MTVfQ09OVEVYVF9FTkdJTkVTX0VY
VF9MT0FEX0JBTEFOQ0UsCi0JCQkJLm51bV9zaWJsaW5ncyA9IDIsCi0JCQkJLmVuZ2luZXMgPSB7
Ci0JCQkJCXsgLmVuZ2luZV9jbGFzcyA9IEk5MTVfRU5HSU5FX0NMQVNTX1ZJREVPLAotCQkJCQkg
IC5lbmdpbmVfaW5zdGFuY2UgPSAwIH0sCi0JCQkJCXsgLmVuZ2luZV9jbGFzcyA9IEk5MTVfRU5H
SU5FX0NMQVNTX1ZJREVPLAotCQkJCQkgIC5lbmdpbmVfaW5zdGFuY2UgPSAxIH0sCi0JCQkJfSwK
LQkJCX07Ci0JCQlJOTE1X0RFRklORV9DT05URVhUX1BBUkFNX0VOR0lORVMoc2V0X2VuZ2luZXMs
IDMpID0gewotCQkJCS5leHRlbnNpb25zID0gdG9fdXNlcl9wb2ludGVyKCZsb2FkX2JhbGFuY2Up
LAotCQkJCS5lbmdpbmVzID0gewotCQkJCQl7IC5lbmdpbmVfY2xhc3MgPSBJOTE1X0VOR0lORV9D
TEFTU19JTlZBTElELAotCQkJCQkgIC5lbmdpbmVfaW5zdGFuY2UgPSBJOTE1X0VOR0lORV9DTEFT
U19JTlZBTElEX05PTkUgfSwKLQkJCQkJeyAuZW5naW5lX2NsYXNzID0gSTkxNV9FTkdJTkVfQ0xB
U1NfVklERU8sCi0JCQkJCSAgLmVuZ2luZV9pbnN0YW5jZSA9IDAgfSwKLQkJCQkJeyAuZW5naW5l
X2NsYXNzID0gSTkxNV9FTkdJTkVfQ0xBU1NfVklERU8sCi0JCQkJCSAgLmVuZ2luZV9pbnN0YW5j
ZSA9IDEgfSwKLQkJCQl9LAotCQkJfTsKLQorCQkJY29uc3QgdW5zaWduZWQgaW50IGNvdW50ID0g
bnVtX2VuZ2luZXNfaW5fY2xhc3MoVkNTKTsKKwkJCUk5MTVfREVGSU5FX0NPTlRFWFRfRU5HSU5F
U19MT0FEX0JBTEFOQ0UobG9hZF9iYWxhbmNlLAorCQkJCQkJCQkgY291bnQpOworCQkJSTkxNV9E
RUZJTkVfQ09OVEVYVF9QQVJBTV9FTkdJTkVTKHNldF9lbmdpbmVzLAorCQkJCQkJCSAgY291bnQg
KyAxKTsKIAkJCXN0cnVjdCBkcm1faTkxNV9nZW1fY29udGV4dF9wYXJhbSBwYXJhbSA9IHsKIAkJ
CQkuY3R4X2lkID0gY3R4X2lkLAogCQkJCS5wYXJhbSA9IEk5MTVfQ09OVEVYVF9QQVJBTV9FTkdJ
TkVTLApAQCAtMTU3OSw2ICsxNTkzLDIxIEBAIHByZXBhcmVfd29ya2xvYWQodW5zaWduZWQgaW50
IGlkLCBzdHJ1Y3Qgd29ya2xvYWQgKndyaywgdW5zaWduZWQgaW50IGZsYWdzKQogCQkJCS52YWx1
ZSA9IHRvX3VzZXJfcG9pbnRlcigmc2V0X2VuZ2luZXMpLAogCQkJfTsKIAorCQkJc2V0X2VuZ2lu
ZXMuZXh0ZW5zaW9ucyA9IHRvX3VzZXJfcG9pbnRlcigmbG9hZF9iYWxhbmNlKTsKKworCQkJc2V0
X2VuZ2luZXMuZW5naW5lc1swXS5lbmdpbmVfY2xhc3MgPQorCQkJCUk5MTVfRU5HSU5FX0NMQVNT
X0lOVkFMSUQ7CisJCQlzZXRfZW5naW5lcy5lbmdpbmVzWzBdLmVuZ2luZV9pbnN0YW5jZSA9CisJ
CQkJSTkxNV9FTkdJTkVfQ0xBU1NfSU5WQUxJRF9OT05FOworCQkJZmlsbF9lbmdpbmVzX2NsYXNz
KCZzZXRfZW5naW5lcy5lbmdpbmVzWzFdLCBWQ1MpOworCisJCQltZW1zZXQoJmxvYWRfYmFsYW5j
ZSwgMCwgc2l6ZW9mKGxvYWRfYmFsYW5jZSkpOworCQkJbG9hZF9iYWxhbmNlLmJhc2UubmFtZSA9
CisJCQkJSTkxNV9DT05URVhUX0VOR0lORVNfRVhUX0xPQURfQkFMQU5DRTsKKwkJCWxvYWRfYmFs
YW5jZS5udW1fc2libGluZ3MgPSBjb3VudDsKKworCQkJZmlsbF9lbmdpbmVzX2NsYXNzKCZsb2Fk
X2JhbGFuY2UuZW5naW5lc1swXSwgVkNTKTsKKwogCQkJZ2VtX2NvbnRleHRfc2V0X3BhcmFtKGZk
LCAmcGFyYW0pOwogCQl9CiAKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlz
dHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4v
bGlzdGluZm8vaW50ZWwtZ2Z4

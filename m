Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9C8261A9A28
	for <lists+intel-gfx@lfdr.de>; Wed, 15 Apr 2020 12:13:07 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D3C6D6E953;
	Wed, 15 Apr 2020 10:13:05 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D538E6E94F
 for <intel-gfx@lists.freedesktop.org>; Wed, 15 Apr 2020 10:13:03 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from build.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 20904672-1500050 
 for multiple; Wed, 15 Apr 2020 11:12:56 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 15 Apr 2020 11:12:54 +0100
Message-Id: <20200415101254.22649-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20200415100322.28378-1-chris@chris-wilson.co.uk>
References: <20200415100322.28378-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/selftests: Exercise basic RPS
 interrupt generation
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Chris Wilson <chris@chris-wilson.co.uk>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U2luY2Ugd2UgZGVwZW5kIHVwb24gUlBTIGdlbmVyYXRpbmcgaW50ZXJydXB0cyBhZnRlciBldmFs
dWF0aW9uCmludGVydmFscyB0byBkZXRlcm1pbmUgd2hlbiB0byB1cC9kb3duIGNsb2NrIHRoZSBH
UFUsIGl0IGlzIGltcGVyYXRpdmUKdGhhdCB3ZSBzdWNjZXNzZnVsbHkgZW5hYmxlIGludGVycnVw
dCBnZW5lcmF0aW9uISBWZXJpZnkgdGhhdCB3ZSBkbyBzZWUKYW4gaW50ZXJydXB0IGlmIHdlIGtl
ZXAgdGhlIEdQVSBidXN5IGZvciBhbiBlbnRpcmUgRUkuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBX
aWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9ycHMuYyAgICAgIHwgICA0ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Nl
bGZ0ZXN0X2d0X3BtLmMgfCAgIDIgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
cnBzLmMgICB8IDE4MiArKysrKysrKysrKysrKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Qvc2VsZnRlc3RfcnBzLmggICB8ICAxMSArKwogNCBmaWxlcyBjaGFuZ2VkLCAxOTkgaW5z
ZXJ0aW9ucygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Nl
bGZ0ZXN0X3Jwcy5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfcnBzLmgKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9ycHMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jwcy5jCmluZGV4IDg2MTEw
NDU4ZTJhNy4uZDE5MTYxYzdhM2Q4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9ycHMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ycHMuYwpA
QCAtMTkyMywzICsxOTIzLDcgQEAgYm9vbCBpOTE1X2dwdV90dXJib19kaXNhYmxlKHZvaWQpCiAJ
cmV0dXJuIHJldDsKIH0KIEVYUE9SVF9TWU1CT0xfR1BMKGk5MTVfZ3B1X3R1cmJvX2Rpc2FibGUp
OworCisjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfU0VMRlRFU1QpCisjaW5jbHVkZSAi
c2VsZnRlc3RfcnBzLmMiCisjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3NlbGZ0ZXN0X2d0X3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9n
dF9wbS5jCmluZGV4IDA5ZmY4ZTRmODhhZi4uYzUwYmI1MDJmZTAzIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9ndF9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X2d0X3BtLmMKQEAgLTcsNiArNyw3IEBACiAKICNpbmNsdWRlICJz
ZWxmdGVzdF9sbGMuaCIKICNpbmNsdWRlICJzZWxmdGVzdF9yYzYuaCIKKyNpbmNsdWRlICJzZWxm
dGVzdF9ycHMuaCIKIAogc3RhdGljIGludCBsaXZlX2d0X3Jlc3VtZSh2b2lkICphcmcpCiB7CkBA
IC01Miw2ICs1Myw3IEBAIGludCBpbnRlbF9ndF9wbV9saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdGF0aWMgY29uc3Qgc3RydWN0IGk5MTVfc3VidGVz
dCB0ZXN0c1tdID0gewogCQlTVUJURVNUKGxpdmVfcmM2X21hbnVhbCksCisJCVNVQlRFU1QobGl2
ZV9ycHNfaW50ZXJydXB0KSwKIAkJU1VCVEVTVChsaXZlX2d0X3Jlc3VtZSksCiAJfTsKIApkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfcnBzLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9ycHMuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRl
eCAwMDAwMDAwMDAwMDAuLjU1MThmM2RjNjMyOAotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3Jwcy5jCkBAIC0wLDAgKzEsMTgyIEBACisvLyBTUERY
LUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUCisvKgorICogQ29weXJpZ2h0IMKpIDIwMjAgSW50ZWwg
Q29ycG9yYXRpb24KKyAqLworCisjaW5jbHVkZSAiaW50ZWxfZW5naW5lX3BtLmgiCisjaW5jbHVk
ZSAiaW50ZWxfZ3RfcG0uaCIKKyNpbmNsdWRlICJzZWxmdGVzdF9ycHMuaCIKKyNpbmNsdWRlICJz
ZWxmdGVzdHMvaWd0X2ZsdXNoX3Rlc3QuaCIKKyNpbmNsdWRlICJzZWxmdGVzdHMvaWd0X3NwaW5u
ZXIuaCIKKworc3RhdGljIHZvaWQgZHVtbXlfcnBzX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3
cmspCit7Cit9CisKK3N0YXRpYyBpbnQgX19ycHNfdXBfaW50ZXJydXB0KHN0cnVjdCBpbnRlbF9y
cHMgKnJwcywKKwkJCSAgICAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKKwkJCSAg
ICAgIHN0cnVjdCBpZ3Rfc3Bpbm5lciAqc3BpbikKK3sKKwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
cTsKKwl1MzIgdGltZW91dDsKKworCUdFTV9CVUdfT04ocnBzLT5hY3RpdmUpOworCisJcnBzLT5w
bV9paXIgPSAwOworCXJwcy0+Y3VyX2ZyZXEgPSBycHMtPm1pbl9mcmVxOworCisJcnEgPSBpZ3Rf
c3Bpbm5lcl9jcmVhdGVfcmVxdWVzdChzcGluLCBlbmdpbmUtPmtlcm5lbF9jb250ZXh0LCBNSV9O
T09QKTsKKwlpZiAoSVNfRVJSKHJxKSkKKwkJcmV0dXJuIFBUUl9FUlIocnEpOworCisJaTkxNV9y
ZXF1ZXN0X2dldChycSk7CisJaTkxNV9yZXF1ZXN0X2FkZChycSk7CisKKwlpZiAoIWlndF93YWl0
X2Zvcl9zcGlubmVyKHNwaW4sIHJxKSkgeworCQlwcl9lcnIoIiVzOiBSUFMgc3Bpbm5lciBkaWQg
bm90IHN0YXJ0XG4iLAorCQkgICAgICAgZW5naW5lLT5uYW1lKTsKKwkJaTkxNV9yZXF1ZXN0X3B1
dChycSk7CisJCWludGVsX2d0X3NldF93ZWRnZWQoZW5naW5lLT5ndCk7CisJCXJldHVybiAtRUlP
OworCX0KKworCWlmICghcnBzLT5hY3RpdmUpIHsKKwkJcHJfZXJyKCIlczogUlBTIG5vdCBlbmFi
bGVkIG9uIHN0YXJ0aW5nIHNwaW5uZXJcbiIsCisJCSAgICAgICBlbmdpbmUtPm5hbWUpOworCQlp
Z3Rfc3Bpbm5lcl9lbmQoc3Bpbik7CisJCWk5MTVfcmVxdWVzdF9wdXQocnEpOworCQlyZXR1cm4g
LUVJTlZBTDsKKwl9CisKKwl0aW1lb3V0ID0gaW50ZWxfdW5jb3JlX3JlYWQoZW5naW5lLT51bmNv
cmUsIEdFTjZfUlBfVVBfRUkpOworCXRpbWVvdXQgPSBHVF9QTV9JTlRFUlZBTF9UT19VUyhlbmdp
bmUtPmk5MTUsIHRpbWVvdXQpOworCisJdXNsZWVwX3JhbmdlKDIgKiB0aW1lb3V0LCAzICogdGlt
ZW91dCk7CisJR0VNX0JVR19PTihpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJxKSk7CisKKwlpZ3Rf
c3Bpbm5lcl9lbmQoc3Bpbik7CisJaTkxNV9yZXF1ZXN0X3B1dChycSk7CisKKwlpZiAoIXJwcy0+
cG1faWlyKSB7CisJCXByX2VycigiJXM6IFJQUyBpbnRlcnJ1cHQgbm90IHJlY29yZGVkIG9uIGlu
aXRpYWwgc3BpblxuIiwKKwkJICAgICAgIGVuZ2luZS0+bmFtZSk7CisJCXJldHVybiAtRUlOVkFM
OworCX0KKworCWlmIChycHMtPmN1cl9mcmVxICE9IHJwcy0+bWluX2ZyZXEpIHsKKwkJcHJfZXJy
KCIlczogRnJlcXVlbmN5IHVuZXhwZWN0ZWRseSBjaGFuZ2VkIFt1cF0sIG5vdyAlZCFcbiIsCisJ
CSAgICAgICBlbmdpbmUtPm5hbWUsIGludGVsX3Jwc19yZWFkX2FjdHVhbF9mcmVxdWVuY3kocnBz
KSk7CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCWlmICghKHJwcy0+cG1faWlyICYgR0VONl9Q
TV9SUF9VUF9USFJFU0hPTEQpKSB7CisJCXByX2VycigiJXM6IFVQIGludGVycnVwdCBub3QgcmVj
b3JkZWQgZm9yIHNwaW5uZXJcbiIsCisJCSAgICAgICBlbmdpbmUtPm5hbWUpOworCQlyZXR1cm4g
LUVJTlZBTDsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBfX3Jwc19kb3duX2lu
dGVycnVwdChzdHJ1Y3QgaW50ZWxfcnBzICpycHMsCisJCQkJc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lKQoreworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBycHNfdG9fZ3QocnBzKTsKKwl1
MzIgdGltZW91dDsKKworCUdFTV9CVUdfT04oIXJwcy0+YWN0aXZlKTsKKwlpbnRlbF9ycHNfc2V0
KHJwcywgcnBzLT5tYXhfZnJlcSk7CisKKwl0aW1lb3V0ID0gaW50ZWxfdW5jb3JlX3JlYWQoZ3Qt
PnVuY29yZSwgR0VONl9SUF9ET1dOX0VJKTsKKwl0aW1lb3V0ID0gR1RfUE1fSU5URVJWQUxfVE9f
VVMoZ3QtPmk5MTUsIHRpbWVvdXQpOworCisJcnBzLT5wbV9paXIgPSAwOworCXVzbGVlcF9yYW5n
ZSgyICogdGltZW91dCwgMyAqIHRpbWVvdXQpOworCisJaWYgKCFycHMtPnBtX2lpcikgeworCQlw
cl9lcnIoIiVzOiBSUFMgaW50ZXJydXB0IG5vdCByZWNvcmRlZCBvbiBpbml0aWFsIHNwaW5cbiIs
CisJCSAgICAgICBlbmdpbmUtPm5hbWUpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlpZiAo
cnBzLT5jdXJfZnJlcSAhPSBycHMtPm1heF9mcmVxKSB7CisJCXByX2VycigiJXM6IEZyZXF1ZW5j
eSB1bmV4cGVjdGVkbHkgY2hhbmdlZCBbZG93bl0sIG5vdyAlZCFcbiIsCisJCSAgICAgICBlbmdp
bmUtPm5hbWUsCisJCSAgICAgICBpbnRlbF9ycHNfcmVhZF9hY3R1YWxfZnJlcXVlbmN5KHJwcykp
OworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlpZiAoIShycHMtPnBtX2lpciAmIEdFTjZfUE1f
UlBfRE9XTl9USFJFU0hPTEQpKSB7CisJCXByX2VycigiJXM6IERPV04gaW50ZXJydXB0IG5vdCBy
ZWNvcmRlZCBmb3Igc3Bpbm5lclxuIiwKKwkJICAgICAgIGVuZ2luZS0+bmFtZSk7CisJCXJldHVy
biAtRUlOVkFMOworCX0KKworCXJldHVybiAwOworfQorCitpbnQgbGl2ZV9ycHNfaW50ZXJydXB0
KHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOworCXN0cnVjdCBpbnRl
bF9ycHMgKnJwcyA9ICZndC0+cnBzOworCXZvaWQgKCpzYXZlZF93b3JrKShzdHJ1Y3Qgd29ya19z
dHJ1Y3QgKndyayk7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOworCWVudW0gaW50
ZWxfZW5naW5lX2lkIGlkOworCXN0cnVjdCBpZ3Rfc3Bpbm5lciBzcGluOworCXUzMiBwbV9ldmVu
dHM7CisJaW50IGVyciA9IDA7CisKKwkvKgorCSAqIEZpcnN0LCBsZXQncyBjaGVjayB3aGV0aGVy
IG9yIG5vdCB3ZSBhcmUgcmVjZWl2aW5nIGludGVycnVwdHMuCisJICovCisKKwlpZiAoIXJwcy0+
ZW5hYmxlZCB8fCBycHMtPm1heF9mcmVxIDw9IHJwcy0+bWluX2ZyZXEpCisJCXJldHVybiAwOwor
CisJaW50ZWxfZ3RfcG1fZ2V0KGd0KTsKKwlwbV9ldmVudHMgPSBycHMtPnBtX2V2ZW50czsKKwlp
bnRlbF9ndF9wbV9wdXQoZ3QpOworCWlmICghcG1fZXZlbnRzKSB7CisJCXByX2VycigiTm8gUlBT
IFBNIGV2ZW50cyByZWdpc3RlcmVkLCBidXQgUlBTIGlzIGVuYWJsZWQ/XG4iKTsKKwkJcmV0dXJu
IC1FTk9ERVY7CisJfQorCisJaWYgKGlndF9zcGlubmVyX2luaXQoJnNwaW4sIGd0KSkKKwkJcmV0
dXJuIC1FTk9NRU07CisKKworCWludGVsX2d0X3BtX3dhaXRfZm9yX2lkbGUoZ3QpOworCXNhdmVk
X3dvcmsgPSBycHMtPndvcmsuZnVuYzsKKwlycHMtPndvcmsuZnVuYyA9IGR1bW15X3Jwc193b3Jr
OworCisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7CisJCWludGVsX2d0X3BtX3dh
aXRfZm9yX2lkbGUoZ3QpOworCisJCS8qIEtlZXAgdGhlIGVuZ2luZSBidXN5IHdpdGggYSBzcGlu
bmVyOyBleHBlY3QgYW4gVVAhICovCisJCWlmIChwbV9ldmVudHMgJiBHRU42X1BNX1JQX1VQX1RI
UkVTSE9MRCkgeworCQkJZXJyID0gX19ycHNfdXBfaW50ZXJydXB0KHJwcywgZW5naW5lLCAmc3Bp
bik7CisJCQlpZiAoZXJyKQorCQkJCWdvdG8gb3V0OworCQl9CisKKwkJLyogS2VlcCB0aGUgZW5n
aW5lIGF3YWtlIGJ1dCBpZGxlIGFuZCBjaGVjayBmb3IgRE9XTiAqLworCQlpZiAocG1fZXZlbnRz
ICYgR0VONl9QTV9SUF9ET1dOX1RIUkVTSE9MRCkgeworCQkJaW50ZWxfZW5naW5lX3BtX2dldChl
bmdpbmUpOworCQkJZXJyID0gX19ycHNfZG93bl9pbnRlcnJ1cHQocnBzLCBlbmdpbmUpOworCQkJ
aW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOworCQkJaWYgKGVycikKKwkJCQlnb3RvIG91dDsK
KwkJfQorCX0KKworb3V0OgorCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpCisJCWVyciA9
IC1FSU87CisKKwlpZ3Rfc3Bpbm5lcl9maW5pKCZzcGluKTsKKworCWludGVsX2d0X3BtX3dhaXRf
Zm9yX2lkbGUoZ3QpOworCXJwcy0+d29yay5mdW5jID0gc2F2ZWRfd29yazsKKworCXJldHVybiBl
cnI7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9ycHMu
aCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3Jwcy5oCm5ldyBmaWxlIG1vZGUg
MTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uYWJiYTY2NDIwOTk2Ci0tLSAvZGV2L251bGwKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfcnBzLmgKQEAgLTAsMCArMSwxMSBA
QAorLyogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVCAqLworLyoKKyAqIENvcHlyaWdodCDC
qSAyMDIwIEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2lmbmRlZiBTRUxGVEVTVF9SUFNfSAor
I2RlZmluZSBTRUxGVEVTVF9SUFNfSAorCitpbnQgbGl2ZV9ycHNfaW50ZXJydXB0KHZvaWQgKmFy
Zyk7CisKKyNlbmRpZiAvKiBTRUxGVEVTVF9SUFNfSCAqLwotLSAKMi4yMC4xCgpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBs
aXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZngK

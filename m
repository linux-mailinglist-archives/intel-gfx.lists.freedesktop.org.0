Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 889CDB286E
	for <lists+intel-gfx@lfdr.de>; Sat, 14 Sep 2019 00:33:05 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 867266F48D;
	Fri, 13 Sep 2019 22:33:00 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga14.intel.com (mga14.intel.com [192.55.52.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C0EF26F48C
 for <intel-gfx@lists.freedesktop.org>; Fri, 13 Sep 2019 22:32:57 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga004.jf.intel.com ([10.7.209.38])
 by fmsmga103.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 13 Sep 2019 15:32:57 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,489,1559545200"; d="scan'208";a="337037994"
Received: from josouza-mobl.jf.intel.com (HELO josouza-MOBL.intel.com)
 ([10.24.9.135])
 by orsmga004.jf.intel.com with ESMTP; 13 Sep 2019 15:32:56 -0700
From: =?UTF-8?q?Jos=C3=A9=20Roberto=20de=20Souza?= <jose.souza@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 13 Sep 2019 15:32:49 -0700
Message-Id: <20190913223251.354877-13-jose.souza@intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190913223251.354877-1-jose.souza@intel.com>
References: <20190913223251.354877-1-jose.souza@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 12/14] drm/i915: Add dkl phy pll calculations
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIF9wbGxfZmluZF9kaXZpc29ycyBhbmQgX2NhbGNfZGtsX3BsbF9zdGF0ZSBUR0wgdmVyc2lv
bnMgYXJlCnNpbWlsYXIgdG8gSUNMIG9uZXMgYnV0IHRoZSBCU3BlYyBhbGdvcml0aG0gY29udmVy
c2lvbiBmcm9tIHJlYWwgdG8KaW50ZWdlciBudW1iZXIgcGx1cyB0aGUgZGlmZmVyZW5jZXMgbWFr
ZXMgaXQgZWFzaWVyIGFuZCBzYWZlciB0bwppbXBsZW1lbnQgaXQgaW4gbmV3IGZ1bmN0aW9ucy4K
CkJTcGVjOiA0OTIwNAoKU2lnbmVkLW9mZi1ieTogVmFuZGl0YSBLdWxrYXJuaSA8dmFuZGl0YS5r
dWxrYXJuaUBpbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6IEpvc8OpIFJvYmVydG8gZGUgU291emEg
PGpvc2Uuc291emFAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGRpLmMgICAgICB8ICAyOSArKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZHBsbF9tZ3IuYyB8IDIwNSArKysrKysrKysrKysrKysrKy0KIDIgZmlsZXMgY2hhbmdl
ZCwgMjI3IGluc2VydGlvbnMoKyksIDcgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZGRpLmMKaW5kZXggOTgxZTI0MTIwYTg3Li41MjFlNWIyZTZmMWMgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYwpAQCAtMTQzNiwxMSArMTQz
NiwzMCBAQCBzdGF0aWMgaW50IGljbF9jYWxjX21nX3BsbF9saW5rKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKIAogCXJlZl9jbG9jayA9IGRldl9wcml2LT5jZGNsay5ody5yZWY7
CiAKLQltMSA9IHBsbF9zdGF0ZS0+bWdfcGxsX2RpdjEgJiBNR19QTExfRElWMV9GQlBSRURJVl9N
QVNLOwotCW0yX2ludCA9IHBsbF9zdGF0ZS0+bWdfcGxsX2RpdjAgJiBNR19QTExfRElWMF9GQkRJ
Vl9JTlRfTUFTSzsKLQltMl9mcmFjID0gKHBsbF9zdGF0ZS0+bWdfcGxsX2RpdjAgJiBNR19QTExf
RElWMF9GUkFDTkVOX0gpID8KLQkJKHBsbF9zdGF0ZS0+bWdfcGxsX2RpdjAgJiBNR19QTExfRElW
MF9GQkRJVl9GUkFDX01BU0spID4+Ci0JCU1HX1BMTF9ESVYwX0ZCRElWX0ZSQUNfU0hJRlQgOiAw
OworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKSB7CisJCW0xID0gcGxsX3N0YXRlLT5t
Z19wbGxfZGl2MCAmIERLTF9QTExfRElWMF9GQlBSRURJVl9NQVNLOworCQltMSA9IG0xID4+IERL
TF9QTExfRElWMF9GQlBSRURJVl9TSElGVDsKKwkJbTJfaW50ID0gcGxsX3N0YXRlLT5tZ19wbGxf
ZGl2MCAmIERLTF9QTExfRElWMF9GQkRJVl9JTlRfTUFTSzsKKworCQlpZiAocGxsX3N0YXRlLT5t
Z19wbGxfYmlhcyAmIERLTF9QTExfQklBU19GUkFDX0VOX0gpIHsKKwkJCW0yX2ZyYWMgPSBwbGxf
c3RhdGUtPm1nX3BsbF9iaWFzICYKKwkJCQkgIERLTF9QTExfQklBU19GQkRJVl9GUkFDX01BU0s7
CisJCQltMl9mcmFjID0gbTJfZnJhYyA+PiBES0xfUExMX0JJQVNfRkJESVZfU0hJRlQ7CisJCX0g
ZWxzZSB7CisJCQltMl9mcmFjID0gMDsKKwkJfQorCX0gZWxzZSB7CisJCW0xID0gcGxsX3N0YXRl
LT5tZ19wbGxfZGl2MSAmIE1HX1BMTF9ESVYxX0ZCUFJFRElWX01BU0s7CisJCW0yX2ludCA9IHBs
bF9zdGF0ZS0+bWdfcGxsX2RpdjAgJiBNR19QTExfRElWMF9GQkRJVl9JTlRfTUFTSzsKKworCQlp
ZiAocGxsX3N0YXRlLT5tZ19wbGxfZGl2MCAmIE1HX1BMTF9ESVYwX0ZSQUNORU5fSCkgeworCQkJ
bTJfZnJhYyA9IHBsbF9zdGF0ZS0+bWdfcGxsX2RpdjAgJgorCQkJCSAgTUdfUExMX0RJVjBfRkJE
SVZfRlJBQ19NQVNLOworCQkJbTJfZnJhYyA9IG0yX2ZyYWMgPj4gTUdfUExMX0RJVjBfRkJESVZf
RlJBQ19TSElGVDsKKwkJfSBlbHNlIHsKKwkJCW0yX2ZyYWMgPSAwOworCQl9CisJfQogCiAJc3dp
dGNoIChwbGxfc3RhdGUtPm1nX2Nsa3RvcDJfaHNjbGtjdGwgJgogCQlNR19DTEtUT1AyX0hTQ0xL
Q1RMX0hTRElWX1JBVElPX01BU0spIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZHBsbF9tZ3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZHBsbF9tZ3IuYwppbmRleCA5MzA0NjA2YzFjMGEuLjI1YmU2MjI5YjEyMiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcGxsX21nci5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBsbF9tZ3IuYwpAQCAtMjYwNSw2
ICsyNjA1LDIwMiBAQCBlbnVtIGludGVsX2RwbGxfaWQgaWNsX3RjX3BvcnRfdG9fcGxsX2lkKGVu
dW0gdGNfcG9ydCB0Y19wb3J0KQogCXJldHVybiB0Y19wb3J0ICsgRFBMTF9JRF9JQ0xfTUdQTEwx
OwogfQogCitzdGF0aWMgYm9vbCB0Z2xfZGtsX3BsbF9maW5kX2Rpdmlzb3JzKGludCBjbG9ja19r
aHosIGJvb2wgaXNfZHAsIGJvb2wgdXNlX3NzYywKKwkJCQkgICAgICB1MzIgKnRhcmdldF9kY29f
a2h6LAorCQkJCSAgICAgIHN0cnVjdCBpbnRlbF9kcGxsX2h3X3N0YXRlICpzdGF0ZSkKK3sKKwl1
MzIgZGNvX21pbl9mcmVxLCBkY29fbWF4X2ZyZXE7CisJaW50IGRpdjFfdmFsc1tdID0gezcsIDUs
IDMsIDJ9OworCWludCBpLCBkaXYyOworCisJZGNvX21pbl9mcmVxID0gaXNfZHAgPyA4MTAwMDAw
IDogdXNlX3NzYyA/IDgwMDAwMDAgOiA3OTkyMDAwOworCWRjb19tYXhfZnJlcSA9IGlzX2RwID8g
ODEwMDAwMCA6IDEwMDAwMDAwOworCisJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUoZGl2MV92
YWxzKTsgaSsrKSB7CisJCWludCBkaXYxID0gZGl2MV92YWxzW2ldOworCisJCWZvciAoZGl2MiA9
IDEwOyBkaXYyID4gMDsgZGl2Mi0tKSB7CisJCQlpbnQgZGNvID0gZGl2MSAqIGRpdjIgKiBjbG9j
a19raHogKiA1OworCQkJaW50IGlucHV0c2VsLCB0bGluZWRydjsKKwkJCXUzMiBoc2RpdjsKKwor
CQkJaWYgKGRjbyA8IGRjb19taW5fZnJlcSB8fCBkY28gPiBkY29fbWF4X2ZyZXEpCisJCQkJY29u
dGludWU7CisKKwkJCXN0YXRlLT5tZ19yZWZjbGtpbl9jdGwgPSBNR19SRUZDTEtJTl9DVExfT0Rf
Ml9NVVgoMSk7CisJCQlzdGF0ZS0+bWdfY2xrdG9wMl9jb3JlY2xrY3RsMSA9CisJCQkJCU1HX0NM
S1RPUDJfQ09SRUNMS0NUTDFfQV9ESVZSQVRJTyg1KTsKKworCQkJdGxpbmVkcnYgPSBkaXYyID49
IDIgPyAxIDogMjsKKwkJCWlucHV0c2VsID0gaXNfZHAgPyAwIDogMTsKKworCQkJc3dpdGNoIChk
aXYxKSB7CisJCQlkZWZhdWx0OgorCQkJCU1JU1NJTkdfQ0FTRShkaXYxKTsKKwkJCQkvKiBmYWxs
IHRocm91Z2ggKi8KKwkJCWNhc2UgMjoKKwkJCQloc2RpdiA9IE1HX0NMS1RPUDJfSFNDTEtDVExf
SFNESVZfUkFUSU9fMjsKKwkJCQlicmVhazsKKwkJCWNhc2UgMzoKKwkJCQloc2RpdiA9IE1HX0NM
S1RPUDJfSFNDTEtDVExfSFNESVZfUkFUSU9fMzsKKwkJCQlicmVhazsKKwkJCWNhc2UgNToKKwkJ
CQloc2RpdiA9IE1HX0NMS1RPUDJfSFNDTEtDVExfSFNESVZfUkFUSU9fNTsKKwkJCQlicmVhazsK
KwkJCWNhc2UgNzoKKwkJCQloc2RpdiA9IE1HX0NMS1RPUDJfSFNDTEtDVExfSFNESVZfUkFUSU9f
NzsKKwkJCQlicmVhazsKKwkJCX0KKworCQkJKnRhcmdldF9kY29fa2h6ID0gZGNvOworCisJCQlz
dGF0ZS0+bWdfY2xrdG9wMl9oc2Nsa2N0bCA9CisJCQkJTUdfQ0xLVE9QMl9IU0NMS0NUTF9UTElO
RURSVl9DTEtTRUwodGxpbmVkcnYpIHwKKwkJCQlNR19DTEtUT1AyX0hTQ0xLQ1RMX0NPUkVfSU5Q
VVRTRUwoaW5wdXRzZWwpIHwKKwkJCQloc2RpdiB8CisJCQkJTUdfQ0xLVE9QMl9IU0NMS0NUTF9E
U0RJVl9SQVRJTyhkaXYyKTsKKworCQkJcmV0dXJuIHRydWU7CisJCX0KKwl9CisKKwlyZXR1cm4g
ZmFsc2U7Cit9CisKKy8qCisgKiBUaGUgc3BlY2lmaWNhdGlvbiBmb3IgdGhpcyBmdW5jdGlvbiB1
c2VzIHJlYWwgbnVtYmVycywgc28gdGhlIG1hdGggaGFkIHRvIGJlCisgKiBhZGFwdGVkIHRvIGlu
dGVnZXItb25seSBjYWxjdWxhdGlvbiwgdGhhdCdzIHdoeSBpdCBsb29rcyBzbyBkaWZmZXJlbnQu
CisgKi8KK3N0YXRpYyBib29sIHRnbF9jYWxjX2RrbF9wbGxfc3RhdGUoc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkJICAgc3RydWN0IGludGVsX2RwbGxfaHdfc3RhdGUg
KnBsbF9zdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KGNydGNfc3RhdGUtPmJhc2UuY3J0Yy0+ZGV2KTsKKwlpbnQgcmVmY2xrX2toeiA9IGRldl9w
cml2LT5jZGNsay5ody5yZWY7CisJaW50IHN5bWJvbF9mcmVxdWVuY3kgPSBjcnRjX3N0YXRlLT5w
b3J0X2Nsb2NrOworCXUzMiBkY29fa2h6LCBtMWRpdiwgbTJkaXZfaW50LCBtMmRpdl9yZW0sIG0y
ZGl2X2ZyYWM7CisJdTMyIGlyZWZfbmRpdiwgaXJlZl90cmltOworCXUzMiBwcm9wX2NvZWZmLCBp
bnRfY29lZmY7CisJdTMyIHRkY190YXJnZXRjbnQsIGZlZWRmd2dhaW47CisJdTY0IHNzY19zdGVw
c2l6ZSwgc3NjX3N0ZXBsZW4sIHNzY19zdGVwbG9nOworCXU2NCB0bXA7CisJYm9vbCB1c2Vfc3Nj
ID0gdHJ1ZTsKKwlib29sIGlzX2RwID0gIWludGVsX2NydGNfaGFzX3R5cGUoY3J0Y19zdGF0ZSwg
SU5URUxfT1VUUFVUX0hETUkpOworCisJbWVtc2V0KHBsbF9zdGF0ZSwgMCwgc2l6ZW9mKCpwbGxf
c3RhdGUpKTsKKworCWlmICghdGdsX2RrbF9wbGxfZmluZF9kaXZpc29ycyhzeW1ib2xfZnJlcXVl
bmN5LCBpc19kcCwgdXNlX3NzYywKKwkJCQkgICAgICAgJmRjb19raHosIHBsbF9zdGF0ZSkpIHsK
KwkJRFJNX0RFQlVHX0tNUygiRmFpbGVkIHRvIGZpbmQgZGl2aXNvcnMgZm9yIGNsb2NrICVkXG4i
LAorCQkJICAgICAgc3ltYm9sX2ZyZXF1ZW5jeSk7CisJCXJldHVybiBmYWxzZTsKKwl9CisKKwlt
MWRpdiA9IDI7CisJbTJkaXZfaW50ID0gZGNvX2toeiAvIChyZWZjbGtfa2h6ICogbTFkaXYpOwor
CWlmIChtMmRpdl9pbnQgPiAyNTUpIHsKKwkJRFJNX0RFQlVHX0tNUygiRmFpbGVkIHRvIGZpbmQg
bWRpdiBmb3IgY2xvY2sgJWRcbiIsCisJCQkgICAgICBzeW1ib2xfZnJlcXVlbmN5KTsKKwkJcmV0
dXJuIGZhbHNlOworCX0KKwltMmRpdl9yZW0gPSBkY29fa2h6ICUgKHJlZmNsa19raHogKiBtMWRp
dik7CisKKwl0bXAgPSAodTY0KW0yZGl2X3JlbSAqICgxIDw8IDIyKTsKKwlkb19kaXYodG1wLCBy
ZWZjbGtfa2h6ICogbTFkaXYpOworCW0yZGl2X2ZyYWMgPSB0bXA7CisKKwlzd2l0Y2ggKHJlZmNs
a19raHopIHsKKwljYXNlIDE5MjAwOgorCQlpcmVmX25kaXYgPSAxOworCQlicmVhazsKKwljYXNl
IDI0MDAwOgorCQlpcmVmX25kaXYgPSAxOworCQlicmVhazsKKwljYXNlIDM4NDAwOgorCQlpcmVm
X25kaXYgPSAyOworCQlicmVhazsKKwlkZWZhdWx0OgorCQlNSVNTSU5HX0NBU0UocmVmY2xrX2to
eik7CisJCXJldHVybiBmYWxzZTsKKwl9CisKKwkvKgorCSAqIHRkY19yZXMgPSAwLjAwMDAwMwor
CSAqIHRkY190YXJnZXRjbnQgPSBpbnQoMiAvICh0ZGNfcmVzICogOCAqIDUwICogMS4xKSAvIHJl
ZmNsa19taHogKyAwLjUpCisJICoKKwkgKiBUaGUgbXVsdGlwbGljYXRpb24gYnkgMTAwMCBpcyBk
dWUgdG8gcmVmY2xrIE1IeiB0byBLSHogY29udmVyc2lvbi4gSXQKKwkgKiB3YXMgc3VwcG9zZWQg
dG8gYmUgYSBkaXZpc2lvbiwgYnV0IHdlIHJlYXJyYW5nZWQgdGhlIG9wZXJhdGlvbnMgb2YKKwkg
KiB0aGUgZm9ybXVsYSB0byBhdm9pZCBlYXJseSBkaXZpc2lvbnMgc28gd2UgZG9uJ3QgbXVsdGlw
bHkgdGhlCisJICogcm91bmRpbmcgZXJyb3JzLgorCSAqCisJICogMC4wMDAwMDMgKiA4ICogNTAg
KiAxLjEgPSAwLjAwMTMyLCBhbHNvIGtub3duIGFzIDEzMiAvIDEwMDAwMCwgd2hpY2gKKwkgKiB3
ZSBhbHNvIHJlYXJyYW5nZSB0byB3b3JrIHdpdGggaW50ZWdlcnMuCisJICoKKwkgKiBUaGUgMC41
IHRyYW5zZm9ybWVkIHRvIDUgcmVzdWx0cyBpbiBhIG11bHRpcGxpY2F0aW9uIGJ5IDEwIGFuZCB0
aGUKKwkgKiBsYXN0IGRpdmlzaW9uIGJ5IDEwLgorCSAqLworCXRkY190YXJnZXRjbnQgPSAoMiAq
IDEwMDAgKiAxMDAwMDAgKiAxMCAvICgxMzIgKiByZWZjbGtfa2h6KSArIDUpIC8gMTA7CisKKwkv
KgorCSAqIEhlcmUgd2UgZGl2aWRlIGRjb19raHogYnkgMTAgaW4gb3JkZXIgdG8gYWxsb3cgdGhl
IGRpdmlkZW5kIHRvIGZpdCBpbgorCSAqIDMyIGJpdHMuIFRoYXQncyBub3QgYSBwcm9ibGVtIHNp
bmNlIHdlIHJvdW5kIHRoZSBkaXZpc2lvbiBkb3duCisJICogYW55d2F5LgorCSAqLworCWZlZWRm
d2dhaW4gPSAodXNlX3NzYyB8fCBtMmRpdl9yZW0gPiAwKSA/CisJCW0xZGl2ICogMTAwMDAwMCAq
IDEwMCAvIChkY29fa2h6ICogMyAvIDEwKSA6IDA7CisKKwl0bXAgPSByZWZjbGtfa2h6IC8gaXJl
Zl9uZGl2OworCWlmICh0bXAgPD0gMTkyMDApCisJCWlyZWZfdHJpbSA9IDI4OworCWVsc2UgaWYg
KHRtcCA8PSAyNTAwMCkKKwkJaXJlZl90cmltID0gMjU7CisJZWxzZQorCQlpcmVmX3RyaW0gPSAy
NDsKKworCWlmIChkY29fa2h6ID49IDkwMDAwMDApIHsKKwkJcHJvcF9jb2VmZiA9IDU7CisJCWlu
dF9jb2VmZiA9IDEwOworCX0gZWxzZSB7CisJCXByb3BfY29lZmYgPSA0OworCQlpbnRfY29lZmYg
PSA4OworCX0KKworCWlmICh1c2Vfc3NjKSB7CisJCXRtcCA9IG11bF91MzJfdTMyKGRjb19raHos
IDQ3ICogMzIpOworCQlkb19kaXYodG1wLCByZWZjbGtfa2h6ICogbTFkaXYgKiAxMDAwMCk7CisJ
CXNzY19zdGVwc2l6ZSA9IHRtcDsKKworCQl0bXAgPSBtdWxfdTMyX3UzMihkY29fa2h6LCAxMDAw
KTsKKwkJc3NjX3N0ZXBsZW4gPSBESVZfUk9VTkRfVVBfVUxMKHRtcCwgMzIgKiAyICogMzIpOwor
CX0gZWxzZSB7CisJCXNzY19zdGVwc2l6ZSA9IDA7CisJCXNzY19zdGVwbGVuID0gMDsKKwl9CisJ
c3NjX3N0ZXBsb2cgPSA0OworCisJLyogd3JpdGUgcGxsX3N0YXRlIGNhbGN1bGF0aW9ucyAqLwor
CXBsbF9zdGF0ZS0+bWdfcGxsX2RpdjAgPSBES0xfUExMX0RJVjBfSU5URUdfQ09FRkYoaW50X2Nv
ZWZmKSB8CisJCQkJIERLTF9QTExfRElWMF9QUk9QX0NPRUZGKHByb3BfY29lZmYpIHwKKwkJCQkg
REtMX1BMTF9ESVYwX0ZCUFJFRElWKG0xZGl2KSB8CisJCQkJIERLTF9QTExfRElWMF9GQkRJVl9J
TlQobTJkaXZfaW50KTsKKworCXBsbF9zdGF0ZS0+bWdfcGxsX2RpdjEgPSBES0xfUExMX0RJVjFf
SVJFRl9UUklNKGlyZWZfdHJpbSkgfAorCQkJCSBES0xfUExMX0RJVjFfVERDX1RBUkdFVF9DTlQo
dGRjX3RhcmdldGNudCk7CisKKwlwbGxfc3RhdGUtPm1nX3BsbF9zc2MgPSBES0xfUExMX1NTQ19J
UkVGX05ESVZfUkFUSU8oaXJlZl9uZGl2KSB8CisJCQkJREtMX1BMTF9TU0NfU1RFUF9MRU4oc3Nj
X3N0ZXBsZW4pIHwKKwkJCQlES0xfUExMX1NTQ19TVEVQX05VTShzc2Nfc3RlcGxvZykgfAorCQkJ
CSh1c2Vfc3NjID8gREtMX1BMTF9TU0NfRU4gOiAwKTsKKworCXBsbF9zdGF0ZS0+bWdfcGxsX2Jp
YXMgPSAobTJkaXZfZnJhYyA+IDAgPyBES0xfUExMX0JJQVNfRlJBQ19FTl9IIDogMCkgfAorCQkJ
CSBES0xfUExMX0JJQVNfRkJESVZfRlJBQyhtMmRpdl9mcmFjKTsKKworCXBsbF9zdGF0ZS0+bWdf
cGxsX3RkY19jb2xkc3RfYmlhcyA9CisJCQlES0xfUExMX1REQ19TU0NfU1RFUF9TSVpFKHNzY19z
dGVwc2l6ZSkgfAorCQkJREtMX1BMTF9URENfRkVFRF9GV0RfR0FJTihmZWVkZndnYWluKTsKKwor
CXJldHVybiB0cnVlOworfQorCiBzdGF0aWMgYm9vbCBpY2xfbWdfcGxsX2ZpbmRfZGl2aXNvcnMo
aW50IGNsb2NrX2toeiwgYm9vbCBpc19kcCwgYm9vbCB1c2Vfc3NjLAogCQkJCSAgICAgdTMyICp0
YXJnZXRfZGNvX2toeiwKIAkJCQkgICAgIHN0cnVjdCBpbnRlbF9kcGxsX2h3X3N0YXRlICpzdGF0
ZSkKQEAgLTI5MzIsNiArMzEyOCw3IEBAIHN0YXRpYyBib29sIGljbF9nZXRfdGNfcGh5X2RwbGxz
KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCQlpbnRlbF9hdG9taWNfZ2V0X25l
d19jcnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsKIAlzdHJ1Y3QgaWNsX3BvcnRfZHBsbCAqcG9ydF9k
cGxsOwogCWVudW0gaW50ZWxfZHBsbF9pZCBkcGxsX2lkOworCWJvb2wgcjsKIAogCXBvcnRfZHBs
bCA9ICZjcnRjX3N0YXRlLT5pY2xfcG9ydF9kcGxsc1tJQ0xfUE9SVF9EUExMX0RFRkFVTFRdOwog
CWlmICghaWNsX2NhbGNfZHBsbF9zdGF0ZShjcnRjX3N0YXRlLCBlbmNvZGVyLCAmcG9ydF9kcGxs
LT5od19zdGF0ZSkpIHsKQEAgLTI5NTAsOSArMzE0NywxMyBAQCBzdGF0aWMgYm9vbCBpY2xfZ2V0
X3RjX3BoeV9kcGxscyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKIAlpbnRlbF9y
ZWZlcmVuY2Vfc2hhcmVkX2RwbGwoc3RhdGUsIGNydGMsCiAJCQkJICAgIHBvcnRfZHBsbC0+cGxs
LCAmcG9ydF9kcGxsLT5od19zdGF0ZSk7CiAKLQogCXBvcnRfZHBsbCA9ICZjcnRjX3N0YXRlLT5p
Y2xfcG9ydF9kcGxsc1tJQ0xfUE9SVF9EUExMX01HX1BIWV07Ci0JaWYgKCFpY2xfY2FsY19tZ19w
bGxfc3RhdGUoY3J0Y19zdGF0ZSwgJnBvcnRfZHBsbC0+aHdfc3RhdGUpKSB7CisJaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPj0gMTIpCisJCXIgPSB0Z2xfY2FsY19ka2xfcGxsX3N0YXRlKGNydGNf
c3RhdGUsICZwb3J0X2RwbGwtPmh3X3N0YXRlKTsKKwllbHNlCisJCXIgPSBpY2xfY2FsY19tZ19w
bGxfc3RhdGUoY3J0Y19zdGF0ZSwgJnBvcnRfZHBsbC0+aHdfc3RhdGUpOworCisJaWYgKCFyKSB7
CiAJCURSTV9ERUJVR19LTVMoIkNvdWxkIG5vdCBjYWxjdWxhdGUgTUcgUEhZIFBMTCBzdGF0ZS5c
biIpOwogCQlnb3RvIGVycl91bnJlZmVyZW5jZV90YnRfcGxsOwogCX0KLS0gCjIuMjMuMAoKX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1h
aWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

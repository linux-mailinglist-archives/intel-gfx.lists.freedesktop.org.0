Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C6412F6AF3
	for <lists+intel-gfx@lfdr.de>; Sun, 10 Nov 2019 19:58:36 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B5E366E7A2;
	Sun, 10 Nov 2019 18:58:32 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id DDA476E7AF
 for <intel-gfx@lists.freedesktop.org>; Sun, 10 Nov 2019 18:58:28 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19151895-1500050 
 for multiple; Sun, 10 Nov 2019 18:58:12 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sun, 10 Nov 2019 18:57:56 +0000
Message-Id: <20191110185806.17413-15-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191110185806.17413-1-chris@chris-wilson.co.uk>
References: <20191110185806.17413-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 15/25] drm/i915/selftests: Perform some basic
 cycle counting of MI ops
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Anna Karas <anna.karas@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U29tZSBiYXNpYyBpbmZvcm1hdGlvbiB0aGF0IGlzIHVzZWZ1bCB0byBrbm93LCBzdWNoIGFzIGhv
dyBtYW55IGN5Y2xlcwppcyBhIE1JX05PT1AuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24g
PGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IEFubmEgS2FyYXMgPGFubmEua2FyYXNAaW50
ZWwuY29tPgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KLS0t
CiAuLi4vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVjdF9ibHQuYyAgfCAgMTUgKy0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9jcy5jICB8IDMzOSArKysr
KysrKysrKysrKysrKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNpLmMgICAgICAgICAg
ICAgICB8ICAgNiArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NlbGZ0ZXN0LmggICAgICAg
ICAgfCAgIDQgKwogLi4uL2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3BlcmZfc2VsZnRlc3RzLmgg
IHwgIDEzICsKIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfc2VsZnRlc3QuYyAgICB8
ICA0MyArKysKIDYgZmlsZXMgY2hhbmdlZCwgNDE3IGluc2VydGlvbnMoKyksIDMgZGVsZXRpb25z
KC0pCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5
MTVfcGVyZl9zZWxmdGVzdHMuaAoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9zZWxmdGVzdHMvaTkxNV9nZW1fb2JqZWN0X2JsdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmplY3RfYmx0LmMKaW5kZXggOGEwZmJhN2Q1ZDRmLi5j
OGE4YzA3ZTA3YWIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVz
dHMvaTkxNV9nZW1fb2JqZWN0X2JsdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9z
ZWxmdGVzdHMvaTkxNV9nZW1fb2JqZWN0X2JsdC5jCkBAIC01MjYsOCArNTI2LDYgQEAgc3RhdGlj
IGludCBpZ3RfY29weV9ibHRfY3R4MCh2b2lkICphcmcpCiBpbnQgaTkxNV9nZW1fb2JqZWN0X2Js
dF9saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlzdGF0
aWMgY29uc3Qgc3RydWN0IGk5MTVfc3VidGVzdCB0ZXN0c1tdID0gewotCQlTVUJURVNUKHBlcmZf
ZmlsbF9ibHQpLAotCQlTVUJURVNUKHBlcmZfY29weV9ibHQpLAogCQlTVUJURVNUKGlndF9maWxs
X2JsdCksCiAJCVNVQlRFU1QoaWd0X2ZpbGxfYmx0X2N0eDApLAogCQlTVUJURVNUKGlndF9jb3B5
X2JsdCksCkBAIC01NDIsMyArNTQwLDE2IEBAIGludCBpOTE1X2dlbV9vYmplY3RfYmx0X2xpdmVf
c2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCiAJcmV0dXJuIGk5MTVf
bGl2ZV9zdWJ0ZXN0cyh0ZXN0cywgaTkxNSk7CiB9CisKK2ludCBpOTE1X2dlbV9vYmplY3RfYmx0
X3BlcmZfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQoreworCXN0YXRp
YyBjb25zdCBzdHJ1Y3QgaTkxNV9zdWJ0ZXN0IHRlc3RzW10gPSB7CisJCVNVQlRFU1QocGVyZl9m
aWxsX2JsdCksCisJCVNVQlRFU1QocGVyZl9jb3B5X2JsdCksCisJfTsKKworCWlmIChpbnRlbF9n
dF9pc193ZWRnZWQoJmk5MTUtPmd0KSkKKwkJcmV0dXJuIDA7CisKKwlyZXR1cm4gaTkxNV9saXZl
X3N1YnRlc3RzKHRlc3RzLCBpOTE1KTsKK30KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9jcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfZW5naW5lX2NzLmMKaW5kZXggMzg4MGYwN2MyOWI4Li4wYWQ4MzFmNmEyNWEgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9jcy5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2VuZ2luZV9jcy5jCkBAIC00LDcgKzQs
MzQ0IEBACiAgKiBDb3B5cmlnaHQgwqkgMjAxOCBJbnRlbCBDb3Jwb3JhdGlvbgogICovCiAKLSNp
bmNsdWRlICIuLi9pOTE1X3NlbGZ0ZXN0LmgiCisjaW5jbHVkZSA8bGludXgvc29ydC5oPgorCisj
aW5jbHVkZSAiaW50ZWxfZ3RfcG0uaCIKKyNpbmNsdWRlICJpbnRlbF9ycHMuaCIKKworI2luY2x1
ZGUgImk5MTVfc2VsZnRlc3QuaCIKKyNpbmNsdWRlICJzZWxmdGVzdHMvaWd0X2ZsdXNoX3Rlc3Qu
aCIKKworI2RlZmluZSBDT1VOVCA1CisKK3N0YXRpYyBpbnQgY21wX3UzMihjb25zdCB2b2lkICpB
LCBjb25zdCB2b2lkICpCKQoreworCWNvbnN0IHUzMiAqYSA9IEEsICpiID0gQjsKKworCXJldHVy
biAqYSAtICpiOworfQorCitzdGF0aWMgdm9pZCBwZXJmX2JlZ2luKHN0cnVjdCBpbnRlbF9ndCAq
Z3QpCit7CisJaW50ZWxfZ3RfcG1fZ2V0KGd0KTsKKworCS8qIEJvb3N0IGdwdWZyZXEgdG8gbWF4
IFt3YWl0Ym9vc3RdIGFuZCBrZWVwIGl0IGZpeGVkICovCisJYXRvbWljX2luYygmZ3QtPnJwcy5u
dW1fd2FpdGVycyk7CisJc2NoZWR1bGVfd29yaygmZ3QtPnJwcy53b3JrKTsKKwlmbHVzaF93b3Jr
KCZndC0+cnBzLndvcmspOworfQorCitzdGF0aWMgaW50IHBlcmZfZW5kKHN0cnVjdCBpbnRlbF9n
dCAqZ3QpCit7CisJYXRvbWljX2RlYygmZ3QtPnJwcy5udW1fd2FpdGVycyk7CisJaW50ZWxfZ3Rf
cG1fcHV0KGd0KTsKKworCXJldHVybiBpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSk7Cit9CisKK3N0
YXRpYyBpbnQgd3JpdGVfdGltZXN0YW1wKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBpbnQgc2xv
dCkKK3sKKwl1MzIgY21kOworCXUzMiAqY3M7CisKKwljcyA9IGludGVsX3JpbmdfYmVnaW4ocnEs
IDQpOworCWlmIChJU19FUlIoY3MpKQorCQlyZXR1cm4gUFRSX0VSUihjcyk7CisKKwljbWQgPSBN
SV9TVE9SRV9SRUdJU1RFUl9NRU0gfCBNSV9VU0VfR0dUVDsKKwlpZiAoSU5URUxfR0VOKHJxLT5p
OTE1KSA+PSA4KQorCQljbWQrKzsKKwkqY3MrKyA9IGNtZDsKKwkqY3MrKyA9IGk5MTVfbW1pb19y
ZWdfb2Zmc2V0KFJJTkdfVElNRVNUQU1QKHJxLT5lbmdpbmUtPm1taW9fYmFzZSkpOworCSpjcysr
ID0gaTkxNV9yZXF1ZXN0X3RpbWVsaW5lKHJxKS0+aHdzcF9vZmZzZXQgKyBzbG90ICogc2l6ZW9m
KHUzMik7CisJKmNzKysgPSAwOworCisJaW50ZWxfcmluZ19hZHZhbmNlKHJxLCBjcyk7CisKKwly
ZXR1cm4gMDsKK30KKworc3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqY3JlYXRlX2VtcHR5X2JhdGNo
KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqOworCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOworCXUzMiAqY3M7CisJaW50IGVycjsKKwor
CW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoY2UtPmVuZ2luZS0+aTkxNSwg
UEFHRV9TSVpFKTsKKwlpZiAoSVNfRVJSKG9iaikpCisJCXJldHVybiBFUlJfQ0FTVChvYmopOwor
CisJY3MgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChvYmosIEk5MTVfTUFQX1dCKTsKKwlpZiAo
SVNfRVJSKGNzKSkgeworCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CisJCXJldHVybiBFUlJf
Q0FTVChjcyk7CisJfQorCisJY3NbMF0gPSBNSV9CQVRDSF9CVUZGRVJfRU5EOworCisJaTkxNV9n
ZW1fb2JqZWN0X2ZsdXNoX21hcChvYmopOworCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAob2Jq
KTsKKworCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgY2UtPnZtLCBOVUxMKTsKKwlpZiAo
SVNfRVJSKHZtYSkpIHsKKwkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCQlyZXR1cm4gdm1h
OworCX0KKworCWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIFBJTl9VU0VSKTsKKwlpZiAo
ZXJyKSB7CisJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwkJcmV0dXJuIEVSUl9QVFIoZXJy
KTsKKwl9CisKKwlyZXR1cm4gdm1hOworfQorCitzdGF0aWMgdTMyIHRyaWZpbHRlcih1MzIgKmEp
Cit7CisJdTY0IHN1bTsKKworCXNvcnQoYSwgQ09VTlQsIHNpemVvZigqYSksIGNtcF91MzIsIE5V
TEwpOworCisJc3VtICs9IG11bF91MzJfdTMyKGFbMl0sIDIpOworCXN1bSArPSBhWzFdOworCXN1
bSArPSBhWzNdOworCisJcmV0dXJuIHN1bSA+PiAyOworfQorCitzdGF0aWMgaW50IHBlcmZfbWlf
YmJfc3RhcnQodm9pZCAqYXJnKQoreworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CisJc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOworCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwor
CWludCBlcnIgPSAwOworCisJaWYgKElOVEVMX0dFTihndC0+aTkxNSkgPCA3KSAvKiBmb3IgcGVy
LWVuZ2luZSBDU19USU1FU1RBTVAgKi8KKwkJcmV0dXJuIDA7CisKKwlwZXJmX2JlZ2luKGd0KTsK
Kwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwgaWQpIHsKKwkJc3RydWN0IGludGVsX2NvbnRl
eHQgKmNlID0gZW5naW5lLT5rZXJuZWxfY29udGV4dDsKKwkJc3RydWN0IGk5MTVfdm1hICpiYXRj
aDsKKwkJdTMyIGN5Y2xlc1tDT1VOVF07CisJCWludCBpOworCisJCWJhdGNoID0gY3JlYXRlX2Vt
cHR5X2JhdGNoKGNlKTsKKwkJaWYgKElTX0VSUihiYXRjaCkpIHsKKwkJCWVyciA9IFBUUl9FUlIo
YmF0Y2gpOworCQkJYnJlYWs7CisJCX0KKworCQllcnIgPSBpOTE1X3ZtYV9zeW5jKGJhdGNoKTsK
KwkJaWYgKGVycikgeworCQkJaTkxNV92bWFfcHV0KGJhdGNoKTsKKwkJCWJyZWFrOworCQl9CisK
KwkJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUoY3ljbGVzKTsgaSsrKSB7CisJCQlzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycTsKKworCQkJcnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKGNlKTsKKwkJ
CWlmIChJU19FUlIocnEpKSB7CisJCQkJZXJyID0gUFRSX0VSUihycSk7CisJCQkJYnJlYWs7CisJ
CQl9CisKKwkJCWVyciA9IHdyaXRlX3RpbWVzdGFtcChycSwgMik7CisJCQlpZiAoZXJyKQorCQkJ
CWdvdG8gb3V0OworCisJCQllcnIgPSBycS0+ZW5naW5lLT5lbWl0X2JiX3N0YXJ0KHJxLAorCQkJ
CQkJCWJhdGNoLT5ub2RlLnN0YXJ0LCA4LAorCQkJCQkJCTApOworCQkJaWYgKGVycikKKwkJCQln
b3RvIG91dDsKKworCQkJZXJyID0gd3JpdGVfdGltZXN0YW1wKHJxLCAzKTsKKwkJCWlmIChlcnIp
CisJCQkJZ290byBvdXQ7CisKK291dDoKKwkJCWk5MTVfcmVxdWVzdF9nZXQocnEpOworCQkJaTkx
NV9yZXF1ZXN0X2FkZChycSk7CisKKwkJCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChycSwgMCwgSFog
LyA1KSA8IDApCisJCQkJZXJyID0gLUVJTzsKKwkJCWk5MTVfcmVxdWVzdF9wdXQocnEpOworCQkJ
aWYgKGVycikKKwkJCQlicmVhazsKKworCQkJY3ljbGVzW2ldID0gcnEtPmh3c3Bfc2Vxbm9bM10g
LSBycS0+aHdzcF9zZXFub1syXTsKKwkJfQorCQlpOTE1X3ZtYV9wdXQoYmF0Y2gpOworCQlpZiAo
ZXJyKQorCQkJYnJlYWs7CisKKwkJcHJfaW5mbygiJXM6IE1JX0JCX1NUQVJUIGN5Y2xlczogJXVc
biIsCisJCQllbmdpbmUtPm5hbWUsIHRyaWZpbHRlcihjeWNsZXMpKTsKKwl9CisJaWYgKHBlcmZf
ZW5kKGd0KSkKKwkJZXJyID0gLUVJTzsKKworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBzdHJ1
Y3QgaTkxNV92bWEgKmNyZWF0ZV9ub3BfYmF0Y2goc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQor
eworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CisJc3RydWN0IGk5MTVfdm1hICp2
bWE7CisJdTMyICpjczsKKwlpbnQgZXJyOworCisJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0
ZV9pbnRlcm5hbChjZS0+ZW5naW5lLT5pOTE1LCBTWl82NEspOworCWlmIChJU19FUlIob2JqKSkK
KwkJcmV0dXJuIEVSUl9DQVNUKG9iaik7CisKKwljcyA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFw
KG9iaiwgSTkxNV9NQVBfV0IpOworCWlmIChJU19FUlIoY3MpKSB7CisJCWk5MTVfZ2VtX29iamVj
dF9wdXQob2JqKTsKKwkJcmV0dXJuIEVSUl9DQVNUKGNzKTsKKwl9CisKKwltZW1zZXQoY3MsIDAs
IFNaXzY0Syk7CisJY3NbU1pfNjRLIC8gc2l6ZW9mKCpjcykgLSAxXSA9IE1JX0JBVENIX0JVRkZF
Ul9FTkQ7CisKKwlpOTE1X2dlbV9vYmplY3RfZmx1c2hfbWFwKG9iaik7CisJaTkxNV9nZW1fb2Jq
ZWN0X3VucGluX21hcChvYmopOworCisJdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLCBjZS0+
dm0sIE5VTEwpOworCWlmIChJU19FUlIodm1hKSkgeworCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9i
aik7CisJCXJldHVybiB2bWE7CisJfQorCisJZXJyID0gaTkxNV92bWFfcGluKHZtYSwgMCwgMCwg
UElOX1VTRVIpOworCWlmIChlcnIpIHsKKwkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCQly
ZXR1cm4gRVJSX1BUUihlcnIpOworCX0KKworCXJldHVybiB2bWE7Cit9CisKK3N0YXRpYyBpbnQg
cGVyZl9taV9ub29wKHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwor
CXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKKwllbnVtIGludGVsX2VuZ2luZV9pZCBp
ZDsKKwlpbnQgZXJyID0gMDsKKworCWlmIChJTlRFTF9HRU4oZ3QtPmk5MTUpIDwgNykgLyogZm9y
IHBlci1lbmdpbmUgQ1NfVElNRVNUQU1QICovCisJCXJldHVybiAwOworCisJcGVyZl9iZWdpbihn
dCk7CisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7CisJCXN0cnVjdCBpbnRlbF9j
b250ZXh0ICpjZSA9IGVuZ2luZS0+a2VybmVsX2NvbnRleHQ7CisJCXN0cnVjdCBpOTE1X3ZtYSAq
YmFzZSwgKm5vcDsKKwkJdTMyIGN5Y2xlc1tDT1VOVF07CisJCWludCBpOworCisJCWJhc2UgPSBj
cmVhdGVfZW1wdHlfYmF0Y2goY2UpOworCQlpZiAoSVNfRVJSKGJhc2UpKSB7CisJCQllcnIgPSBQ
VFJfRVJSKGJhc2UpOworCQkJYnJlYWs7CisJCX0KKworCQllcnIgPSBpOTE1X3ZtYV9zeW5jKGJh
c2UpOworCQlpZiAoZXJyKSB7CisJCQlpOTE1X3ZtYV9wdXQoYmFzZSk7CisJCQlicmVhazsKKwkJ
fQorCisJCW5vcCA9IGNyZWF0ZV9ub3BfYmF0Y2goY2UpOworCQlpZiAoSVNfRVJSKG5vcCkpIHsK
KwkJCWVyciA9IFBUUl9FUlIobm9wKTsKKwkJCWk5MTVfdm1hX3B1dChiYXNlKTsKKwkJCWJyZWFr
OworCQl9CisKKwkJZXJyID0gaTkxNV92bWFfc3luYyhub3ApOworCQlpZiAoZXJyKSB7CisJCQlp
OTE1X3ZtYV9wdXQobm9wKTsKKwkJCWk5MTVfdm1hX3B1dChiYXNlKTsKKwkJCWJyZWFrOworCQl9
CisKKwkJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUoY3ljbGVzKTsgaSsrKSB7CisJCQlzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycTsKKworCQkJcnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKGNlKTsK
KwkJCWlmIChJU19FUlIocnEpKSB7CisJCQkJZXJyID0gUFRSX0VSUihycSk7CisJCQkJYnJlYWs7
CisJCQl9CisKKwkJCWVyciA9IHdyaXRlX3RpbWVzdGFtcChycSwgMik7CisJCQlpZiAoZXJyKQor
CQkJCWdvdG8gb3V0OworCisJCQllcnIgPSBycS0+ZW5naW5lLT5lbWl0X2JiX3N0YXJ0KHJxLAor
CQkJCQkJCWJhc2UtPm5vZGUuc3RhcnQsIDgsCisJCQkJCQkJMCk7CisJCQlpZiAoZXJyKQorCQkJ
CWdvdG8gb3V0OworCisJCQllcnIgPSB3cml0ZV90aW1lc3RhbXAocnEsIDMpOworCQkJaWYgKGVy
cikKKwkJCQlnb3RvIG91dDsKKworCQkJZXJyID0gcnEtPmVuZ2luZS0+ZW1pdF9iYl9zdGFydChy
cSwKKwkJCQkJCQlub3AtPm5vZGUuc3RhcnQsIDQwOTYsCisJCQkJCQkJMCk7CisJCQlpZiAoZXJy
KQorCQkJCWdvdG8gb3V0OworCisJCQllcnIgPSB3cml0ZV90aW1lc3RhbXAocnEsIDQpOworCQkJ
aWYgKGVycikKKwkJCQlnb3RvIG91dDsKKworb3V0OgorCQkJaTkxNV9yZXF1ZXN0X2dldChycSk7
CisJCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKworCQkJaWYgKGk5MTVfcmVxdWVzdF93YWl0KHJx
LCAwLCBIWiAvIDUpIDwgMCkKKwkJCQllcnIgPSAtRUlPOworCQkJaTkxNV9yZXF1ZXN0X3B1dChy
cSk7CisJCQlpZiAoZXJyKQorCQkJCWJyZWFrOworCisJCQljeWNsZXNbaV0gPQorCQkJCShycS0+
aHdzcF9zZXFub1s0XSAtIHJxLT5od3NwX3NlcW5vWzNdKSAtCisJCQkJKHJxLT5od3NwX3NlcW5v
WzNdIC0gcnEtPmh3c3Bfc2Vxbm9bMl0pOworCQl9CisJCWk5MTVfdm1hX3B1dChub3ApOworCQlp
OTE1X3ZtYV9wdXQoYmFzZSk7CisJCWlmIChlcnIpCisJCQlicmVhazsKKworCQlwcl9pbmZvKCIl
czogMTZLIE1JX05PT1AgY3ljbGVzOiAldVxuIiwKKwkJCWVuZ2luZS0+bmFtZSwgdHJpZmlsdGVy
KGN5Y2xlcykpOworCX0KKwlpZiAocGVyZl9lbmQoZ3QpKQorCQllcnIgPSAtRUlPOworCisJcmV0
dXJuIGVycjsKK30KKworaW50IGludGVsX2VuZ2luZV9jc19wZXJmX3NlbGZ0ZXN0cyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3sKKwlzdGF0aWMgY29uc3Qgc3RydWN0IGk5MTVfc3Vi
dGVzdCB0ZXN0c1tdID0geworCQlTVUJURVNUKHBlcmZfbWlfYmJfc3RhcnQpLAorCQlTVUJURVNU
KHBlcmZfbWlfbm9vcCksCisJfTsKKworCWlmIChpbnRlbF9ndF9pc193ZWRnZWQoJmk5MTUtPmd0
KSkKKwkJcmV0dXJuIDA7CisKKwlyZXR1cm4gaW50ZWxfZ3RfbGl2ZV9zdWJ0ZXN0cyh0ZXN0cywg
Jmk5MTUtPmd0KTsKK30KIAogc3RhdGljIGludCBpbnRlbF9tbWlvX2Jhc2VzX2NoZWNrKHZvaWQg
KmFyZykKIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNpLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BjaS5jCmluZGV4IDFiYjcwMWQzMmE1ZC4uZGEzZTli
NTc1MmFjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BjaS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNpLmMKQEAgLTEwMDMsNiArMTAwMywxMiBAQCBz
dGF0aWMgaW50IGk5MTVfcGNpX3Byb2JlKHN0cnVjdCBwY2lfZGV2ICpwZGV2LCBjb25zdCBzdHJ1
Y3QgcGNpX2RldmljZV9pZCAqZW50KQogCQlyZXR1cm4gZXJyID4gMCA/IC1FTk9UVFkgOiBlcnI7
CiAJfQogCisJZXJyID0gaTkxNV9wZXJmX3NlbGZ0ZXN0cyhwZGV2KTsKKwlpZiAoZXJyKSB7CisJ
CWk5MTVfcGNpX3JlbW92ZShwZGV2KTsKKwkJcmV0dXJuIGVyciA+IDAgPyAtRU5PVFRZIDogZXJy
OworCX0KKwogCXJldHVybiAwOwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3NlbGZ0ZXN0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NlbGZ0ZXN0LmgK
aW5kZXggNGQ4ODIwNWRlNTFiLi45OGJjYjZmYTBhYjQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfc2VsZnRlc3QuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3NlbGZ0ZXN0LmgKQEAgLTM2LDYgKzM2LDcgQEAgc3RydWN0IGk5MTVfc2VsZnRlc3QgewogCWNo
YXIgKmZpbHRlcjsKIAlpbnQgbW9jazsKIAlpbnQgbGl2ZTsKKwlpbnQgcGVyZjsKIH07CiAKICNp
ZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9TRUxGVEVTVCkKQEAgLTQ1LDYgKzQ2LDcgQEAg
ZXh0ZXJuIHN0cnVjdCBpOTE1X3NlbGZ0ZXN0IGk5MTVfc2VsZnRlc3Q7CiAKIGludCBpOTE1X21v
Y2tfc2VsZnRlc3RzKHZvaWQpOwogaW50IGk5MTVfbGl2ZV9zZWxmdGVzdHMoc3RydWN0IHBjaV9k
ZXYgKnBkZXYpOworaW50IGk5MTVfcGVyZl9zZWxmdGVzdHMoc3RydWN0IHBjaV9kZXYgKnBkZXYp
OwogCiAvKiBXZSBleHRyYWN0IHRoZSBmdW5jdGlvbiBkZWNsYXJhdGlvbnMgZnJvbSBpOTE1X21v
Y2tfc2VsZnRlc3RzLmggYW5kCiAgKiBpOTE1X2xpdmVfc2VsZnRlc3RzLmggQWRkIHlvdXIgdW5p
dCB0ZXN0IGRlY2xhcmF0aW9ucyB0aGVyZSEKQEAgLTYxLDYgKzYzLDcgQEAgaW50IGk5MTVfbGl2
ZV9zZWxmdGVzdHMoc3RydWN0IHBjaV9kZXYgKnBkZXYpOwogI3VuZGVmIHNlbGZ0ZXN0CiAjZGVm
aW5lIHNlbGZ0ZXN0KG5hbWUsIGZ1bmMpIGludCBmdW5jKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KTsKICNpbmNsdWRlICJzZWxmdGVzdHMvaTkxNV9saXZlX3NlbGZ0ZXN0cy5oIgorI2lu
Y2x1ZGUgInNlbGZ0ZXN0cy9pOTE1X3BlcmZfc2VsZnRlc3RzLmgiCiAjdW5kZWYgc2VsZnRlc3QK
IAogc3RydWN0IGk5MTVfc3VidGVzdCB7CkBAIC0xMDksNiArMTEyLDcgQEAgaW50IF9faTkxNV9z
dWJ0ZXN0cyhjb25zdCBjaGFyICpjYWxsZXIsCiAKIHN0YXRpYyBpbmxpbmUgaW50IGk5MTVfbW9j
a19zZWxmdGVzdHModm9pZCkgeyByZXR1cm4gMDsgfQogc3RhdGljIGlubGluZSBpbnQgaTkxNV9s
aXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgcGNpX2RldiAqcGRldikgeyByZXR1cm4gMDsgfQorc3RhdGlj
IGlubGluZSBpbnQgaTkxNV9wZXJmX3NlbGZ0ZXN0cyhzdHJ1Y3QgcGNpX2RldiAqcGRldikgeyBy
ZXR1cm4gMDsgfQogCiAjZGVmaW5lIEk5MTVfU0VMRlRFU1RfREVDTEFSRSh4KQogI2RlZmluZSBJ
OTE1X1NFTEZURVNUX09OTFkoeCkgMApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2k5MTVfcGVyZl9zZWxmdGVzdHMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9pOTE1X3BlcmZfc2VsZnRlc3RzLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXgg
MDAwMDAwMDAwMDAwLi5mNzEyOWEyNDNkYWEKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9wZXJmX3NlbGZ0ZXN0cy5oCkBAIC0wLDAgKzEsMTMg
QEAKKy8qIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wICovCisvKiBMaXN0IGVhY2gg
dW5pdCB0ZXN0IGFzIHNlbGZ0ZXN0KG5hbWUsIGZ1bmN0aW9uKQorICoKKyAqIFRoZSBuYW1lIGlz
IHVzZWQgYXMgYm90aCBhbiBlbnVtIGFuZCBleHBhbmRlZCBhcyBzdWJ0ZXN0X19uYW1lIHRvIGNy
ZWF0ZQorICogYSBtb2R1bGUgcGFyYW1ldGVyLiBJdCBtdXN0IGJlIHVuaXF1ZSBhbmQgbGVnYWwg
Zm9yIGEgQyBpZGVudGlmaWVyLgorICoKKyAqIFRoZSBmdW5jdGlvbiBzaG91bGQgYmUgb2YgdHlw
ZSBpbnQgZnVuY3Rpb24odm9pZCkuIEl0IG1heSBiZSBjb25kaXRpb25hbGx5CisgKiBjb21waWxl
ZCB1c2luZyAjaWYgSVNfRU5BQkxFRChEUk1fSTkxNV9TRUxGVEVTVCkuCisgKgorICogVGVzdHMg
YXJlIGV4ZWN1dGVkIGluIG9yZGVyIGJ5IGlndC9pOTE1X3NlbGZ0ZXN0CisgKi8KK3NlbGZ0ZXN0
KGVuZ2luZV9jcywgaW50ZWxfZW5naW5lX2NzX3BlcmZfc2VsZnRlc3RzKQorc2VsZnRlc3QoYmx0
LCBpOTE1X2dlbV9vYmplY3RfYmx0X3BlcmZfc2VsZnRlc3RzKQpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfc2VsZnRlc3QuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3NlbGZ0ZXN0LmMKaW5kZXggYTZjY2E0YWQ5NmY2Li5kM2Jm
OWVlZmI2ODIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1
X3NlbGZ0ZXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfc2Vs
ZnRlc3QuYwpAQCAtNTcsNiArNTcsMTIgQEAgZW51bSB7CiAjdW5kZWYgc2VsZnRlc3QKIH07CiAK
K2VudW0geworI2RlZmluZSBzZWxmdGVzdChuYW1lLCBmdW5jKSBwZXJmXyMjbmFtZSwKKyNpbmNs
dWRlICJpOTE1X3BlcmZfc2VsZnRlc3RzLmgiCisjdW5kZWYgc2VsZnRlc3QKK307CisKIHN0cnVj
dCBzZWxmdGVzdCB7CiAJYm9vbCBlbmFibGVkOwogCWNvbnN0IGNoYXIgKm5hbWU7CkBAIC03OCw2
ICs4NCwxMiBAQCBzdGF0aWMgc3RydWN0IHNlbGZ0ZXN0IGxpdmVfc2VsZnRlc3RzW10gPSB7CiB9
OwogI3VuZGVmIHNlbGZ0ZXN0CiAKKyNkZWZpbmUgc2VsZnRlc3QobiwgZikgW3BlcmZfIyNuXSA9
IHsgLm5hbWUgPSAjbiwgeyAubGl2ZSA9IGYgfSB9LAorc3RhdGljIHN0cnVjdCBzZWxmdGVzdCBw
ZXJmX3NlbGZ0ZXN0c1tdID0geworI2luY2x1ZGUgImk5MTVfcGVyZl9zZWxmdGVzdHMuaCIKK307
CisjdW5kZWYgc2VsZnRlc3QKKwogLyogRW1iZWQgdGhlIGxpbmUgbnVtYmVyIGludG8gdGhlIHBh
cmFtZXRlciBuYW1lIHNvIHRoYXQgd2UgY2FuIG9yZGVyIHRlc3RzICovCiAjZGVmaW5lIHNlbGZ0
ZXN0KG4sIGZ1bmMpIHNlbGZ0ZXN0XzAobiwgZnVuYywgcGFyYW0obikpCiAjZGVmaW5lIHBhcmFt
KG4pIF9fUEFTVEUoaWd0X18sIF9fUEFTVEUoX19MSU5FX18sIF9fbW9ja18jI24pKQpAQCAtOTMs
NiArMTA1LDEzIEBAIG1vZHVsZV9wYXJhbV9uYW1lZChpZCwgbGl2ZV9zZWxmdGVzdHNbbGl2ZV8j
I25dLmVuYWJsZWQsIGJvb2wsIDA0MDApOwogI2luY2x1ZGUgImk5MTVfbGl2ZV9zZWxmdGVzdHMu
aCIKICN1bmRlZiBzZWxmdGVzdF8wCiAjdW5kZWYgcGFyYW0KKworI2RlZmluZSBwYXJhbShuKSBf
X1BBU1RFKGlndF9fLCBfX1BBU1RFKF9fTElORV9fLCBfX3BlcmZfIyNuKSkKKyNkZWZpbmUgc2Vs
ZnRlc3RfMChuLCBmdW5jLCBpZCkgXAorbW9kdWxlX3BhcmFtX25hbWVkKGlkLCBwZXJmX3NlbGZ0
ZXN0c1twZXJmXyMjbl0uZW5hYmxlZCwgYm9vbCwgMDQwMCk7CisjaW5jbHVkZSAiaTkxNV9wZXJm
X3NlbGZ0ZXN0cy5oIgorI3VuZGVmIHNlbGZ0ZXN0XzAKKyN1bmRlZiBwYXJhbQogI3VuZGVmIHNl
bGZ0ZXN0CiAKIHN0YXRpYyB2b2lkIHNldF9kZWZhdWx0X3Rlc3RfYWxsKHN0cnVjdCBzZWxmdGVz
dCAqc3QsIHVuc2lnbmVkIGludCBjb3VudCkKQEAgLTIwMCw2ICsyMTksMjcgQEAgaW50IGk5MTVf
bGl2ZV9zZWxmdGVzdHMoc3RydWN0IHBjaV9kZXYgKnBkZXYpCiAJcmV0dXJuIDA7CiB9CiAKK2lu
dCBpOTE1X3BlcmZfc2VsZnRlc3RzKHN0cnVjdCBwY2lfZGV2ICpwZGV2KQoreworCWludCBlcnI7
CisKKwlpZiAoIWk5MTVfc2VsZnRlc3QucGVyZikKKwkJcmV0dXJuIDA7CisKKwllcnIgPSBydW5f
c2VsZnRlc3RzKHBlcmYsIHBkZXZfdG9faTkxNShwZGV2KSk7CisJaWYgKGVycikgeworCQlpOTE1
X3NlbGZ0ZXN0LnBlcmYgPSBlcnI7CisJCXJldHVybiBlcnI7CisJfQorCisJaWYgKGk5MTVfc2Vs
ZnRlc3QucGVyZiA8IDApIHsKKwkJaTkxNV9zZWxmdGVzdC5wZXJmID0gLUVOT1RUWTsKKwkJcmV0
dXJuIDE7CisJfQorCisJcmV0dXJuIDA7Cit9CisKIHN0YXRpYyBib29sIGFwcGx5X3N1YnRlc3Rf
ZmlsdGVyKGNvbnN0IGNoYXIgKmNhbGxlciwgY29uc3QgY2hhciAqbmFtZSkKIHsKIAljaGFyICpm
aWx0ZXIsICpzZXAsICp0b2s7CkBAIC0zNjUsMyArNDA1LDYgQEAgTU9EVUxFX1BBUk1fREVTQyht
b2NrX3NlbGZ0ZXN0cywgIlJ1biBzZWxmdGVzdHMgYmVmb3JlIGxvYWRpbmcsIHVzaW5nIG1vY2sg
aGFyZHcKIAogbW9kdWxlX3BhcmFtX25hbWVkX3Vuc2FmZShsaXZlX3NlbGZ0ZXN0cywgaTkxNV9z
ZWxmdGVzdC5saXZlLCBpbnQsIDA0MDApOwogTU9EVUxFX1BBUk1fREVTQyhsaXZlX3NlbGZ0ZXN0
cywgIlJ1biBzZWxmdGVzdHMgYWZ0ZXIgZHJpdmVyIGluaXRpYWxpc2F0aW9uIG9uIHRoZSBsaXZl
IHN5c3RlbSAoMDpkaXNhYmxlZCBbZGVmYXVsdF0sIDE6cnVuIHRlc3RzIHRoZW4gY29udGludWUs
IC0xOnJ1biB0ZXN0cyB0aGVuIGV4aXQgbW9kdWxlKSIpOworCittb2R1bGVfcGFyYW1fbmFtZWRf
dW5zYWZlKHBlcmZfc2VsZnRlc3RzLCBpOTE1X3NlbGZ0ZXN0LnBlcmYsIGludCwgMDQwMCk7CitN
T0RVTEVfUEFSTV9ERVNDKHBlcmZfc2VsZnRlc3RzLCAiUnVuIHBlcmZvcm1hbmNlIG9yaWVudGF0
ZWQgc2VsZnRlc3RzIGFmdGVyIGRyaXZlciBpbml0aWFsaXNhdGlvbiBvbiB0aGUgbGl2ZSBzeXN0
ZW0gKDA6ZGlzYWJsZWQgW2RlZmF1bHRdLCAxOnJ1biB0ZXN0cyB0aGVuIGNvbnRpbnVlLCAtMTpy
dW4gdGVzdHMgdGhlbiBleGl0IG1vZHVsZSkiKTsKLS0gCjIuMjQuMAoKX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJ
bnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Au
b3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

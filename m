Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id E7C9F48B7D
	for <lists+intel-gfx@lfdr.de>; Mon, 17 Jun 2019 20:10:36 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E736F892E0;
	Mon, 17 Jun 2019 18:10:34 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga05.intel.com (mga05.intel.com [192.55.52.43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 93D72892BF
 for <intel-gfx@lists.freedesktop.org>; Mon, 17 Jun 2019 18:10:29 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga003.jf.intel.com ([10.7.209.27])
 by fmsmga105.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 17 Jun 2019 11:10:29 -0700
X-ExtLoop1: 1
Received: from dceraolo-linux.fm.intel.com ([10.1.27.145])
 by orsmga003.jf.intel.com with ESMTP; 17 Jun 2019 11:10:28 -0700
From: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 17 Jun 2019 11:09:34 -0700
Message-Id: <20190617180935.505-6-daniele.ceraolospurio@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190617180935.505-1-daniele.ceraolospurio@intel.com>
References: <20190617180935.505-1-daniele.ceraolospurio@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 5/6] drm/i915: dynamically allocate forcewake
 domains
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UnZCBsaWtlIHRvIGludHJvZHVjZSBhIGRpc3BsYXkgdW5jb3JlIHdpdGggbm8gZm9yY2V3YWtl
IGRvbWFpbnMsIHNvCmxldCdzIGF2b2lkIHdhc3RpbmcgbWVtb3J5IGFuZCBiZSByZWFkeSB0byBh
bGxvY2F0ZSBvbmx5IHdoYXQgd2UgbmVlZC4KRXZlbiB3aXRob3V0IG11bHRpcGxlIHVuY29yZSwg
d2Ugc3RpbGwgZG9uJ3QgbmVlZCBhbGwgdGhlIGRvbWFpbnMgb24gYWxsCmdlbnMuCgpTaWduZWQt
b2ZmLWJ5OiBEYW5pZWxlIENlcmFvbG8gU3B1cmlvIDxkYW5pZWxlLmNlcmFvbG9zcHVyaW9AaW50
ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3VuY29yZS5jIHwgMTU1ICsr
KysrKysrKysrKysrKysrKy0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3Vu
Y29yZS5oIHwgIDEzICstLQogMiBmaWxlcyBjaGFuZ2VkLCAxMDIgaW5zZXJ0aW9ucygrKSwgNjYg
ZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdW5j
b3JlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF91bmNvcmUuYwppbmRleCBjMGY1NTY3
ZWUwOTYuLjdmMzExODI3YzNlZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfdW5jb3JlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdW5jb3JlLmMKQEAg
LTM0NCw3ICszNDQsNyBAQCBpbnRlbF91bmNvcmVfZndfcmVsZWFzZV90aW1lcihzdHJ1Y3QgaHJ0
aW1lciAqdGltZXIpCiB7CiAJc3RydWN0IGludGVsX3VuY29yZV9mb3JjZXdha2VfZG9tYWluICpk
b21haW4gPQogCSAgICAgICBjb250YWluZXJfb2YodGltZXIsIHN0cnVjdCBpbnRlbF91bmNvcmVf
Zm9yY2V3YWtlX2RvbWFpbiwgdGltZXIpOwotCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9
IGZvcmNld2FrZV9kb21haW5fdG9fdW5jb3JlKGRvbWFpbik7CisJc3RydWN0IGludGVsX3VuY29y
ZSAqdW5jb3JlID0gZG9tYWluLT51bmNvcmU7CiAJdW5zaWduZWQgbG9uZyBpcnFmbGFnczsKIAog
CWFzc2VydF9ycG1fZGV2aWNlX25vdF9zdXNwZW5kZWQodW5jb3JlLT5ycG0pOwpAQCAtMTI5MSwy
MyArMTI5MSwyMyBAQCBkbyB7IFwKIAkodW5jb3JlKS0+ZnVuY3MucmVhZF9md19kb21haW5zID0g
eCMjX3JlZ19yZWFkX2Z3X2RvbWFpbnM7IFwKIH0gd2hpbGUgKDApCiAKLXN0YXRpYyB2b2lkIGZ3
X2RvbWFpbl9pbml0KHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSwKK3N0YXRpYyBpbnQgZndf
ZG9tYWluX2luaXQoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlLAogCQkJICAgZW51bSBmb3Jj
ZXdha2VfZG9tYWluX2lkIGRvbWFpbl9pZCwKIAkJCSAgIGk5MTVfcmVnX3QgcmVnX3NldCwKIAkJ
CSAgIGk5MTVfcmVnX3QgcmVnX2FjaykKIHsKIAlzdHJ1Y3QgaW50ZWxfdW5jb3JlX2ZvcmNld2Fr
ZV9kb21haW4gKmQ7CiAKLQlpZiAoV0FSTl9PTihkb21haW5faWQgPj0gRldfRE9NQUlOX0lEX0NP
VU5UKSkKLQkJcmV0dXJuOwotCi0JZCA9ICZ1bmNvcmUtPmZ3X2RvbWFpbltkb21haW5faWRdOwor
CUdFTV9CVUdfT04oZG9tYWluX2lkID49IEZXX0RPTUFJTl9JRF9DT1VOVCk7CiAKLQlXQVJOX09O
KGQtPndha2VfY291bnQpOworCWQgPSBremFsbG9jKHNpemVvZigqZCksIEdGUF9LRVJORUwpOwor
CWlmICghZCkKKwkJcmV0dXJuIC1FTk9NRU07CiAKIAlXQVJOX09OKCFpOTE1X21taW9fcmVnX3Zh
bGlkKHJlZ19zZXQpKTsKIAlXQVJOX09OKCFpOTE1X21taW9fcmVnX3ZhbGlkKHJlZ19hY2spKTsK
IAorCWQtPnVuY29yZSA9IHVuY29yZTsKIAlkLT53YWtlX2NvdW50ID0gMDsKIAlkLT5yZWdfc2V0
ID0gdW5jb3JlLT5yZWdzICsgaTkxNV9tbWlvX3JlZ19vZmZzZXQocmVnX3NldCk7CiAJZC0+cmVn
X2FjayA9IHVuY29yZS0+cmVncyArIGk5MTVfbW1pb19yZWdfb2Zmc2V0KHJlZ19hY2spOwpAQCAt
MTMyNCw3ICsxMzI0LDYgQEAgc3RhdGljIHZvaWQgZndfZG9tYWluX2luaXQoc3RydWN0IGludGVs
X3VuY29yZSAqdW5jb3JlLAogCUJVSUxEX0JVR19PTihGT1JDRVdBS0VfTUVESUFfVkVCT1gwICE9
ICgxIDw8IEZXX0RPTUFJTl9JRF9NRURJQV9WRUJPWDApKTsKIAlCVUlMRF9CVUdfT04oRk9SQ0VX
QUtFX01FRElBX1ZFQk9YMSAhPSAoMSA8PCBGV19ET01BSU5fSURfTUVESUFfVkVCT1gxKSk7CiAK
LQogCWQtPm1hc2sgPSBCSVQoZG9tYWluX2lkKTsKIAogCWhydGltZXJfaW5pdCgmZC0+dGltZXIs
IENMT0NLX01PTk9UT05JQywgSFJUSU1FUl9NT0RFX1JFTCk7CkBAIC0xMzMzLDYgKzEzMzIsMTAg
QEAgc3RhdGljIHZvaWQgZndfZG9tYWluX2luaXQoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3Jl
LAogCXVuY29yZS0+ZndfZG9tYWlucyB8PSBCSVQoZG9tYWluX2lkKTsKIAogCWZ3X2RvbWFpbl9y
ZXNldChkKTsKKworCXVuY29yZS0+ZndfZG9tYWluW2RvbWFpbl9pZF0gPSBkOworCisJcmV0dXJu
IDA7CiB9CiAKIHN0YXRpYyB2b2lkIGZ3X2RvbWFpbl9maW5pKHN0cnVjdCBpbnRlbF91bmNvcmUg
KnVuY29yZSwKQEAgLTEzNDAsNzcgKzEzNDMsOTIgQEAgc3RhdGljIHZvaWQgZndfZG9tYWluX2Zp
bmkoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlLAogewogCXN0cnVjdCBpbnRlbF91bmNvcmVf
Zm9yY2V3YWtlX2RvbWFpbiAqZDsKIAotCWlmIChXQVJOX09OKGRvbWFpbl9pZCA+PSBGV19ET01B
SU5fSURfQ09VTlQpKQotCQlyZXR1cm47CisJR0VNX0JVR19PTihkb21haW5faWQgPj0gRldfRE9N
QUlOX0lEX0NPVU5UKTsKIAotCWQgPSAmdW5jb3JlLT5md19kb21haW5bZG9tYWluX2lkXTsKKwlk
ID0gZmV0Y2hfYW5kX3plcm8oJnVuY29yZS0+ZndfZG9tYWluW2RvbWFpbl9pZF0pOworCXVuY29y
ZS0+ZndfZG9tYWlucyAmPSB+QklUKGRvbWFpbl9pZCk7CiAKLQlXQVJOX09OKGQtPndha2VfY291
bnQpOwotCVdBUk5fT04oaHJ0aW1lcl9jYW5jZWwoJmQtPnRpbWVyKSk7Ci0JbWVtc2V0KGQsIDAs
IHNpemVvZigqZCkpOworCWlmIChkKSB7CisJCVdBUk5fT04oZC0+d2FrZV9jb3VudCk7CisJCVdB
Uk5fT04oaHJ0aW1lcl9jYW5jZWwoJmQtPnRpbWVyKSk7CisJCWtmcmVlKGQpOworCX0KK30KIAot
CXVuY29yZS0+ZndfZG9tYWlucyAmPSB+QklUKGRvbWFpbl9pZCk7CitzdGF0aWMgdm9pZCBpbnRl
bF91bmNvcmVfZndfZG9tYWluc19maW5pKHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSkKK3sK
KwlzdHJ1Y3QgaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9kb21haW4gKmQ7CisJaW50IHRtcDsKKwor
CWZvcl9lYWNoX2Z3X2RvbWFpbihkLCB1bmNvcmUsIHRtcCkKKwkJZndfZG9tYWluX2ZpbmkodW5j
b3JlLCBkLT5pZCk7CiB9CiAKLXN0YXRpYyB2b2lkIGludGVsX3VuY29yZV9md19kb21haW5zX2lu
aXQoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQorc3RhdGljIGludCBpbnRlbF91bmNvcmVf
ZndfZG9tYWluc19pbml0KHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSkKIHsKIAlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHVuY29yZS0+aTkxNTsKKwlpbnQgcmV0OwogCiAJR0VN
X0JVR19PTighaW50ZWxfdW5jb3JlX2hhc19mb3JjZXdha2UodW5jb3JlKSk7CiAKKyNkZWZpbmUg
X19md19kb21haW5faW5pdChpZF9fLCBzZXRfXywgYWNrX18pIFwKKwlyZXQgPSBmd19kb21haW5f
aW5pdCh1bmNvcmUsIChpZF9fKSwgKHNldF9fKSwgKGFja19fKSk7IFwKKwlpZiAocmV0KSBcCisJ
CWdvdG8gb3V0X2NsZWFuOworCiAJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMSkgewogCQlpbnQg
aTsKIAotCQl1bmNvcmUtPmZ1bmNzLmZvcmNlX3dha2VfZ2V0ID0KLQkJCWZ3X2RvbWFpbnNfZ2V0
X3dpdGhfZmFsbGJhY2s7CisJCXVuY29yZS0+ZnVuY3MuZm9yY2Vfd2FrZV9nZXQgPSBmd19kb21h
aW5zX2dldF93aXRoX2ZhbGxiYWNrOwogCQl1bmNvcmUtPmZ1bmNzLmZvcmNlX3dha2VfcHV0ID0g
ZndfZG9tYWluc19wdXQ7Ci0JCWZ3X2RvbWFpbl9pbml0KHVuY29yZSwgRldfRE9NQUlOX0lEX1JF
TkRFUiwKLQkJCSAgICAgICBGT1JDRVdBS0VfUkVOREVSX0dFTjksCi0JCQkgICAgICAgRk9SQ0VX
QUtFX0FDS19SRU5ERVJfR0VOOSk7Ci0JCWZ3X2RvbWFpbl9pbml0KHVuY29yZSwgRldfRE9NQUlO
X0lEX0JMSVRURVIsCi0JCQkgICAgICAgRk9SQ0VXQUtFX0JMSVRURVJfR0VOOSwKLQkJCSAgICAg
ICBGT1JDRVdBS0VfQUNLX0JMSVRURVJfR0VOOSk7CisJCV9fZndfZG9tYWluX2luaXQoRldfRE9N
QUlOX0lEX1JFTkRFUiwKKwkJCQkgRk9SQ0VXQUtFX1JFTkRFUl9HRU45LAorCQkJCSBGT1JDRVdB
S0VfQUNLX1JFTkRFUl9HRU45KTsKKwkJX19md19kb21haW5faW5pdChGV19ET01BSU5fSURfQkxJ
VFRFUiwKKwkJCQkgRk9SQ0VXQUtFX0JMSVRURVJfR0VOOSwKKwkJCQkgRk9SQ0VXQUtFX0FDS19C
TElUVEVSX0dFTjkpOworCiAJCWZvciAoaSA9IDA7IGkgPCBJOTE1X01BWF9WQ1M7IGkrKykgewog
CQkJaWYgKCFIQVNfRU5HSU5FKGk5MTUsIF9WQ1MoaSkpKQogCQkJCWNvbnRpbnVlOwogCi0JCQlm
d19kb21haW5faW5pdCh1bmNvcmUsIEZXX0RPTUFJTl9JRF9NRURJQV9WREJPWDAgKyBpLAotCQkJ
CSAgICAgICBGT1JDRVdBS0VfTUVESUFfVkRCT1hfR0VOMTEoaSksCi0JCQkJICAgICAgIEZPUkNF
V0FLRV9BQ0tfTUVESUFfVkRCT1hfR0VOMTEoaSkpOworCQkJX19md19kb21haW5faW5pdChGV19E
T01BSU5fSURfTUVESUFfVkRCT1gwICsgaSwKKwkJCQkJIEZPUkNFV0FLRV9NRURJQV9WREJPWF9H
RU4xMShpKSwKKwkJCQkJIEZPUkNFV0FLRV9BQ0tfTUVESUFfVkRCT1hfR0VOMTEoaSkpOwogCQl9
CiAJCWZvciAoaSA9IDA7IGkgPCBJOTE1X01BWF9WRUNTOyBpKyspIHsKIAkJCWlmICghSEFTX0VO
R0lORShpOTE1LCBfVkVDUyhpKSkpCiAJCQkJY29udGludWU7CiAKLQkJCWZ3X2RvbWFpbl9pbml0
KHVuY29yZSwgRldfRE9NQUlOX0lEX01FRElBX1ZFQk9YMCArIGksCi0JCQkJICAgICAgIEZPUkNF
V0FLRV9NRURJQV9WRUJPWF9HRU4xMShpKSwKLQkJCQkgICAgICAgRk9SQ0VXQUtFX0FDS19NRURJ
QV9WRUJPWF9HRU4xMShpKSk7CisJCQlfX2Z3X2RvbWFpbl9pbml0KEZXX0RPTUFJTl9JRF9NRURJ
QV9WRUJPWDAgKyBpLAorCQkJCQkgRk9SQ0VXQUtFX01FRElBX1ZFQk9YX0dFTjExKGkpLAorCQkJ
CQkgRk9SQ0VXQUtFX0FDS19NRURJQV9WRUJPWF9HRU4xMShpKSk7CiAJCX0KIAl9IGVsc2UgaWYg
KElTX0dFTl9SQU5HRShpOTE1LCA5LCAxMCkpIHsKLQkJdW5jb3JlLT5mdW5jcy5mb3JjZV93YWtl
X2dldCA9Ci0JCQlmd19kb21haW5zX2dldF93aXRoX2ZhbGxiYWNrOworCQl1bmNvcmUtPmZ1bmNz
LmZvcmNlX3dha2VfZ2V0ID0gZndfZG9tYWluc19nZXRfd2l0aF9mYWxsYmFjazsKIAkJdW5jb3Jl
LT5mdW5jcy5mb3JjZV93YWtlX3B1dCA9IGZ3X2RvbWFpbnNfcHV0OwotCQlmd19kb21haW5faW5p
dCh1bmNvcmUsIEZXX0RPTUFJTl9JRF9SRU5ERVIsCi0JCQkgICAgICAgRk9SQ0VXQUtFX1JFTkRF
Ul9HRU45LAotCQkJICAgICAgIEZPUkNFV0FLRV9BQ0tfUkVOREVSX0dFTjkpOwotCQlmd19kb21h
aW5faW5pdCh1bmNvcmUsIEZXX0RPTUFJTl9JRF9CTElUVEVSLAotCQkJICAgICAgIEZPUkNFV0FL
RV9CTElUVEVSX0dFTjksCi0JCQkgICAgICAgRk9SQ0VXQUtFX0FDS19CTElUVEVSX0dFTjkpOwot
CQlmd19kb21haW5faW5pdCh1bmNvcmUsIEZXX0RPTUFJTl9JRF9NRURJQSwKLQkJCSAgICAgICBG
T1JDRVdBS0VfTUVESUFfR0VOOSwgRk9SQ0VXQUtFX0FDS19NRURJQV9HRU45KTsKKwkJX19md19k
b21haW5faW5pdChGV19ET01BSU5fSURfUkVOREVSLAorCQkJCSBGT1JDRVdBS0VfUkVOREVSX0dF
TjksCisJCQkJIEZPUkNFV0FLRV9BQ0tfUkVOREVSX0dFTjkpOworCQlfX2Z3X2RvbWFpbl9pbml0
KEZXX0RPTUFJTl9JRF9CTElUVEVSLAorCQkJCSBGT1JDRVdBS0VfQkxJVFRFUl9HRU45LAorCQkJ
CSBGT1JDRVdBS0VfQUNLX0JMSVRURVJfR0VOOSk7CisJCV9fZndfZG9tYWluX2luaXQoRldfRE9N
QUlOX0lEX01FRElBLAorCQkJCSBGT1JDRVdBS0VfTUVESUFfR0VOOSwKKwkJCQkgRk9SQ0VXQUtF
X0FDS19NRURJQV9HRU45KTsKIAl9IGVsc2UgaWYgKElTX1ZBTExFWVZJRVcoaTkxNSkgfHwgSVNf
Q0hFUlJZVklFVyhpOTE1KSkgewogCQl1bmNvcmUtPmZ1bmNzLmZvcmNlX3dha2VfZ2V0ID0gZndf
ZG9tYWluc19nZXQ7CiAJCXVuY29yZS0+ZnVuY3MuZm9yY2Vfd2FrZV9wdXQgPSBmd19kb21haW5z
X3B1dDsKLQkJZndfZG9tYWluX2luaXQodW5jb3JlLCBGV19ET01BSU5fSURfUkVOREVSLAotCQkJ
ICAgICAgIEZPUkNFV0FLRV9WTFYsIEZPUkNFV0FLRV9BQ0tfVkxWKTsKLQkJZndfZG9tYWluX2lu
aXQodW5jb3JlLCBGV19ET01BSU5fSURfTUVESUEsCi0JCQkgICAgICAgRk9SQ0VXQUtFX01FRElB
X1ZMViwgRk9SQ0VXQUtFX0FDS19NRURJQV9WTFYpOworCQlfX2Z3X2RvbWFpbl9pbml0KEZXX0RP
TUFJTl9JRF9SRU5ERVIsCisJCQkJIEZPUkNFV0FLRV9WTFYsIEZPUkNFV0FLRV9BQ0tfVkxWKTsK
KwkJX19md19kb21haW5faW5pdChGV19ET01BSU5fSURfTUVESUEsCisJCQkJIEZPUkNFV0FLRV9N
RURJQV9WTFYsIEZPUkNFV0FLRV9BQ0tfTUVESUFfVkxWKTsKIAl9IGVsc2UgaWYgKElTX0hBU1dF
TEwoaTkxNSkgfHwgSVNfQlJPQURXRUxMKGk5MTUpKSB7CiAJCXVuY29yZS0+ZnVuY3MuZm9yY2Vf
d2FrZV9nZXQgPQogCQkJZndfZG9tYWluc19nZXRfd2l0aF90aHJlYWRfc3RhdHVzOwogCQl1bmNv
cmUtPmZ1bmNzLmZvcmNlX3dha2VfcHV0ID0gZndfZG9tYWluc19wdXQ7Ci0JCWZ3X2RvbWFpbl9p
bml0KHVuY29yZSwgRldfRE9NQUlOX0lEX1JFTkRFUiwKLQkJCSAgICAgICBGT1JDRVdBS0VfTVQs
IEZPUkNFV0FLRV9BQ0tfSFNXKTsKKwkJX19md19kb21haW5faW5pdChGV19ET01BSU5fSURfUkVO
REVSLAorCQkJCSBGT1JDRVdBS0VfTVQsIEZPUkNFV0FLRV9BQ0tfSFNXKTsKIAl9IGVsc2UgaWYg
KElTX0lWWUJSSURHRShpOTE1KSkgewogCQl1MzIgZWNvYnVzOwogCkBAIC0xNDM3LDggKzE0NTUs
OCBAQCBzdGF0aWMgdm9pZCBpbnRlbF91bmNvcmVfZndfZG9tYWluc19pbml0KHN0cnVjdCBpbnRl
bF91bmNvcmUgKnVuY29yZSkKIAkJX19yYXdfdW5jb3JlX3dyaXRlMzIodW5jb3JlLCBGT1JDRVdB
S0UsIDApOwogCQlfX3Jhd19wb3N0aW5nX3JlYWQodW5jb3JlLCBFQ09CVVMpOwogCi0JCWZ3X2Rv
bWFpbl9pbml0KHVuY29yZSwgRldfRE9NQUlOX0lEX1JFTkRFUiwKLQkJCSAgICAgICBGT1JDRVdB
S0VfTVQsIEZPUkNFV0FLRV9NVF9BQ0spOworCQlfX2Z3X2RvbWFpbl9pbml0KEZXX0RPTUFJTl9J
RF9SRU5ERVIsCisJCQkJIEZPUkNFV0FLRV9NVCwgRk9SQ0VXQUtFX01UX0FDSyk7CiAKIAkJc3Bp
bl9sb2NrX2lycSgmdW5jb3JlLT5sb2NrKTsKIAkJZndfZG9tYWluc19nZXRfd2l0aF90aHJlYWRf
c3RhdHVzKHVuY29yZSwgRk9SQ0VXQUtFX1JFTkRFUik7CkBAIC0xNDQ5LDE5ICsxNDY3LDI3IEBA
IHN0YXRpYyB2b2lkIGludGVsX3VuY29yZV9md19kb21haW5zX2luaXQoc3RydWN0IGludGVsX3Vu
Y29yZSAqdW5jb3JlKQogCQlpZiAoIShlY29idXMgJiBGT1JDRVdBS0VfTVRfRU5BQkxFKSkgewog
CQkJRFJNX0lORk8oIk5vIE1UIGZvcmNld2FrZSBhdmFpbGFibGUgb24gSXZ5YnJpZGdlLCB0aGlz
IGNhbiByZXN1bHQgaW4gaXNzdWVzXG4iKTsKIAkJCURSTV9JTkZPKCJ3aGVuIHVzaW5nIHZibGFu
ay1zeW5jZWQgcGFydGlhbCBzY3JlZW4gdXBkYXRlcy5cbiIpOwotCQkJZndfZG9tYWluX2luaXQo
dW5jb3JlLCBGV19ET01BSU5fSURfUkVOREVSLAotCQkJCSAgICAgICBGT1JDRVdBS0UsIEZPUkNF
V0FLRV9BQ0spOworCQkJX19md19kb21haW5faW5pdChGV19ET01BSU5fSURfUkVOREVSLAorCQkJ
CQkgRk9SQ0VXQUtFLCBGT1JDRVdBS0VfQUNLKTsKIAkJfQogCX0gZWxzZSBpZiAoSVNfR0VOKGk5
MTUsIDYpKSB7CiAJCXVuY29yZS0+ZnVuY3MuZm9yY2Vfd2FrZV9nZXQgPQogCQkJZndfZG9tYWlu
c19nZXRfd2l0aF90aHJlYWRfc3RhdHVzOwogCQl1bmNvcmUtPmZ1bmNzLmZvcmNlX3dha2VfcHV0
ID0gZndfZG9tYWluc19wdXQ7Ci0JCWZ3X2RvbWFpbl9pbml0KHVuY29yZSwgRldfRE9NQUlOX0lE
X1JFTkRFUiwKLQkJCSAgICAgICBGT1JDRVdBS0UsIEZPUkNFV0FLRV9BQ0spOworCQlfX2Z3X2Rv
bWFpbl9pbml0KEZXX0RPTUFJTl9JRF9SRU5ERVIsCisJCQkJIEZPUkNFV0FLRSwgRk9SQ0VXQUtF
X0FDSyk7CiAJfQogCisjdW5kZWYgX19md19kb21haW5faW5pdAorCiAJLyogQWxsIGZ1dHVyZSBw
bGF0Zm9ybXMgYXJlIGV4cGVjdGVkIHRvIHJlcXVpcmUgY29tcGxleCBwb3dlciBnYXRpbmcgKi8K
IAlXQVJOX09OKHVuY29yZS0+ZndfZG9tYWlucyA9PSAwKTsKKworCXJldHVybiAwOworCitvdXRf
Y2xlYW46CisJaW50ZWxfdW5jb3JlX2Z3X2RvbWFpbnNfZmluaSh1bmNvcmUpOworCXJldHVybiBy
ZXQ7CiB9CiAKICNkZWZpbmUgQVNTSUdOX0ZXX0RPTUFJTlNfVEFCTEUodW5jb3JlLCBkKSBcCkBA
IC0xNTYyLDEzICsxNTg4LDE3IEBAIHN0YXRpYyB2b2lkIHVuY29yZV9yYXdfaW5pdChzdHJ1Y3Qg
aW50ZWxfdW5jb3JlICp1bmNvcmUpCiAJfQogfQogCi1zdGF0aWMgdm9pZCB1bmNvcmVfZm9yY2V3
YWtlX2luaXQoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQorc3RhdGljIGludCB1bmNvcmVf
Zm9yY2V3YWtlX2luaXQoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQogewogCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gdW5jb3JlLT5pOTE1OworCWludCByZXQ7CiAKIAlHRU1f
QlVHX09OKCFpbnRlbF91bmNvcmVfaGFzX2ZvcmNld2FrZSh1bmNvcmUpKTsKIAotCWludGVsX3Vu
Y29yZV9md19kb21haW5zX2luaXQodW5jb3JlKTsKKwlyZXQgPSBpbnRlbF91bmNvcmVfZndfZG9t
YWluc19pbml0KHVuY29yZSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKwogCWZvcmNld2Fr
ZV9lYXJseV9zYW5pdGl6ZSh1bmNvcmUsIDApOwogCiAJaWYgKElTX0dFTl9SQU5HRShpOTE1LCA2
LCA3KSkgewpAQCAtMTYwMSw2ICsxNjMxLDggQEAgc3RhdGljIHZvaWQgdW5jb3JlX2ZvcmNld2Fr
ZV9pbml0KHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSkKIAogCXVuY29yZS0+cG1pY19idXNf
YWNjZXNzX25iLm5vdGlmaWVyX2NhbGwgPSBpOTE1X3BtaWNfYnVzX2FjY2Vzc19ub3RpZmllcjsK
IAlpb3NmX21iaV9yZWdpc3Rlcl9wbWljX2J1c19hY2Nlc3Nfbm90aWZpZXIoJnVuY29yZS0+cG1p
Y19idXNfYWNjZXNzX25iKTsKKworCXJldHVybiAwOwogfQogCiBpbnQgaW50ZWxfdW5jb3JlX2lu
aXRfbW1pbyhzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpCkBAIC0xNjE5LDEwICsxNjUxLDEz
IEBAIGludCBpbnRlbF91bmNvcmVfaW5pdF9tbWlvKHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29y
ZSkKIAogCXVuY29yZS0+dW5jbGFpbWVkX21taW9fY2hlY2sgPSAxOwogCi0JaWYgKCFpbnRlbF91
bmNvcmVfaGFzX2ZvcmNld2FrZSh1bmNvcmUpKQorCWlmICghaW50ZWxfdW5jb3JlX2hhc19mb3Jj
ZXdha2UodW5jb3JlKSkgewogCQl1bmNvcmVfcmF3X2luaXQodW5jb3JlKTsKLQllbHNlCi0JCXVu
Y29yZV9mb3JjZXdha2VfaW5pdCh1bmNvcmUpOworCX0gZWxzZSB7CisJCXJldCA9IHVuY29yZV9m
b3JjZXdha2VfaW5pdCh1bmNvcmUpOworCQlpZiAocmV0KQorCQkJZ290byBvdXRfbW1pb19jbGVh
bnVwOworCX0KIAogCS8qIG1ha2Ugc3VyZSBmdyBmdW5jcyBhcmUgc2V0IGlmIGFuZCBvbmx5IGlm
IHdlIGhhdmUgZncqLwogCUdFTV9CVUdfT04oaW50ZWxfdW5jb3JlX2hhc19mb3JjZXdha2UodW5j
b3JlKSAhPSAhIXVuY29yZS0+ZnVuY3MuZm9yY2Vfd2FrZV9nZXQpOwpAQCAtMTY0NCw2ICsxNjc5
LDExIEBAIGludCBpbnRlbF91bmNvcmVfaW5pdF9tbWlvKHN0cnVjdCBpbnRlbF91bmNvcmUgKnVu
Y29yZSkKIAkJRFJNX0RFQlVHKCJ1bmNsYWltZWQgbW1pbyBkZXRlY3RlZCBvbiB1bmNvcmUgaW5p
dCwgY2xlYXJpbmdcbiIpOwogCiAJcmV0dXJuIDA7CisKK291dF9tbWlvX2NsZWFudXA6CisJdW5j
b3JlX21taW9fY2xlYW51cCh1bmNvcmUpOworCisJcmV0dXJuIHJldDsKIH0KIAogLyoKQEAgLTE2
ODksNiArMTcyOSw3IEBAIHZvaWQgaW50ZWxfdW5jb3JlX2ZpbmlfbW1pbyhzdHJ1Y3QgaW50ZWxf
dW5jb3JlICp1bmNvcmUpCiAJCWlvc2ZfbWJpX3VucmVnaXN0ZXJfcG1pY19idXNfYWNjZXNzX25v
dGlmaWVyX3VubG9ja2VkKAogCQkJJnVuY29yZS0+cG1pY19idXNfYWNjZXNzX25iKTsKIAkJaW50
ZWxfdW5jb3JlX2ZvcmNld2FrZV9yZXNldCh1bmNvcmUpOworCQlpbnRlbF91bmNvcmVfZndfZG9t
YWluc19maW5pKHVuY29yZSk7CiAJCWlvc2ZfbWJpX3B1bml0X3JlbGVhc2UoKTsKIAl9CiAKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3VuY29yZS5oIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaW50ZWxfdW5jb3JlLmgKaW5kZXggODc5MjUyNzM1YmJhLi5iYmZmMjgxYjg4
MGQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3VuY29yZS5oCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3VuY29yZS5oCkBAIC0xMjYsNiArMTI2LDcgQEAg
c3RydWN0IGludGVsX3VuY29yZSB7CiAJZW51bSBmb3JjZXdha2VfZG9tYWlucyBmd19kb21haW5z
X3NhdmVkOyAvKiB1c2VyIGRvbWFpbnMgc2F2ZWQgZm9yIFMzICovCiAKIAlzdHJ1Y3QgaW50ZWxf
dW5jb3JlX2ZvcmNld2FrZV9kb21haW4geworCQlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmU7
CiAJCWVudW0gZm9yY2V3YWtlX2RvbWFpbl9pZCBpZDsKIAkJZW51bSBmb3JjZXdha2VfZG9tYWlu
cyBtYXNrOwogCQl1bnNpZ25lZCBpbnQgd2FrZV9jb3VudDsKQEAgLTEzMyw3ICsxMzQsNyBAQCBz
dHJ1Y3QgaW50ZWxfdW5jb3JlIHsKIAkJc3RydWN0IGhydGltZXIgdGltZXI7CiAJCXUzMiBfX2lv
bWVtICpyZWdfc2V0OwogCQl1MzIgX19pb21lbSAqcmVnX2FjazsKLQl9IGZ3X2RvbWFpbltGV19E
T01BSU5fSURfQ09VTlRdOworCX0gKmZ3X2RvbWFpbltGV19ET01BSU5fSURfQ09VTlRdOwogCiAJ
c3RydWN0IHsKIAkJdW5zaWduZWQgaW50IGNvdW50OwpAQCAtMTQ3LDE4ICsxNDgsMTIgQEAgc3Ry
dWN0IGludGVsX3VuY29yZSB7CiAKIC8qIEl0ZXJhdGUgb3ZlciBpbml0aWFsaXNlZCBmdyBkb21h
aW5zICovCiAjZGVmaW5lIGZvcl9lYWNoX2Z3X2RvbWFpbl9tYXNrZWQoZG9tYWluX18sIG1hc2tf
XywgdW5jb3JlX18sIHRtcF9fKSBcCi0JZm9yICh0bXBfXyA9IChtYXNrX18pOyBcCi0JICAgICB0
bXBfXyA/IChkb21haW5fXyA9ICYodW5jb3JlX18pLT5md19kb21haW5bX19tYXNrX25leHRfYml0
KHRtcF9fKV0pLCAxIDogMDspCisJZm9yICh0bXBfXyA9IChtYXNrX18pOyB0bXBfXyA7KSBcCisJ
CWZvcl9lYWNoX2lmKGRvbWFpbl9fID0gKHVuY29yZV9fKS0+ZndfZG9tYWluW19fbWFza19uZXh0
X2JpdCh0bXBfXyldKQogCiAjZGVmaW5lIGZvcl9lYWNoX2Z3X2RvbWFpbihkb21haW5fXywgdW5j
b3JlX18sIHRtcF9fKSBcCiAJZm9yX2VhY2hfZndfZG9tYWluX21hc2tlZChkb21haW5fXywgKHVu
Y29yZV9fKS0+ZndfZG9tYWlucywgdW5jb3JlX18sIHRtcF9fKQogCi1zdGF0aWMgaW5saW5lIHN0
cnVjdCBpbnRlbF91bmNvcmUgKgotZm9yY2V3YWtlX2RvbWFpbl90b191bmNvcmUoY29uc3Qgc3Ry
dWN0IGludGVsX3VuY29yZV9mb3JjZXdha2VfZG9tYWluICpkKQotewotCXJldHVybiBjb250YWlu
ZXJfb2YoZCwgc3RydWN0IGludGVsX3VuY29yZSwgZndfZG9tYWluW2QtPmlkXSk7Ci19Ci0KIHN0
YXRpYyBpbmxpbmUgYm9vbAogaW50ZWxfdW5jb3JlX2hhc19mb3JjZXdha2UoY29uc3Qgc3RydWN0
IGludGVsX3VuY29yZSAqdW5jb3JlKQogewotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVs
LWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcv
bWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

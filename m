Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4BD11B24BF
	for <lists+intel-gfx@lfdr.de>; Fri, 13 Sep 2019 19:49:20 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 23AC56F42A;
	Fri, 13 Sep 2019 17:49:18 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8FA666F42A
 for <intel-gfx@lists.freedesktop.org>; Fri, 13 Sep 2019 17:49:16 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18481046-1500050 
 for multiple; Fri, 13 Sep 2019 18:48:26 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 13 Sep 2019 18:48:24 +0100
Message-Id: <20190913174824.15906-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/tgl: Extend MI_SEMAPHORE_WAIT
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

T24gVGlnZXJsYWtlLCBNSV9TRU1BUEhPUkVfV0FJVCBncmV3IGFuIGV4dHJhIGR3b3JkLCBzbyBi
ZSBzdXJlIHRvCnVwZGF0ZSB0aGUgbGVuZ3RoIGZpZWxkIGFuZCBlbWl0IHRoYXQgZXh0cmEgcGFy
YW1ldGVyIGFuZCBhbnkgcGFkZGluZwpub29wIGFzIHJlcXVpcmVkLgoKdjI6IERlZmluZSB0aGUg
dG9rZW4gc2hpZnQgd2hpbGUgd2UgYXJlIGFkZGluZyB0aGUgdXBkYXRlZCBNSV9TRU1BUEhPUkVf
V0FJVAoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28u
dWs+CkNjOiBNaWthIEt1b3BwYWxhIDxtaWthLmt1b3BwYWxhQGxpbnV4LmludGVsLmNvbT4KQ2M6
IERhbmllbGUgQ2VyYW9sbyBTcHVyaW8gPGRhbmllbGUuY2VyYW9sb3NwdXJpb0BpbnRlbC5jb20+
CkNjOiBNaWNoYWwgV2luaWFyc2tpIDxtaWNoYWwud2luaWFyc2tpQGludGVsLmNvbT4KLS0tCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMuaCB8ICAyICsKIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jICAgICAgICAgIHwgNzEgKysrKysrKysrKysr
KysrKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNpLmMgICAgICAgICAgICAgIHwg
IDEgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMgICAgICAgICAgfCAyMSAr
KysrLS0KIDQgZmlsZXMgY2hhbmdlZCwgODMgaW5zZXJ0aW9ucygrKSwgMTIgZGVsZXRpb25zKC0p
CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3B1X2NvbW1hbmRz
LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMuaAppbmRleCBm
YmFkNDAzYWI3YWMuLmRhMjAyNWJjMzMyYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZ3B1X2NvbW1hbmRzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfZ3B1X2NvbW1hbmRzLmgKQEAgLTExMiw2ICsxMTIsNyBAQAogI2RlZmluZSBNSV9TRU1B
UEhPUkVfU0lHTkFMCU1JX0lOU1RSKDB4MWIsIDApIC8qIEdFTjgrICovCiAjZGVmaW5lICAgTUlf
U0VNQVBIT1JFX1RBUkdFVChlbmdpbmUpCSgoZW5naW5lKTw8MTUpCiAjZGVmaW5lIE1JX1NFTUFQ
SE9SRV9XQUlUCU1JX0lOU1RSKDB4MWMsIDIpIC8qIEdFTjgrICovCisjZGVmaW5lIE1JX1NFTUFQ
SE9SRV9XQUlUX1RPS0VOCU1JX0lOU1RSKDB4MWMsIDMpIC8qIEdFTjEyKyAqLwogI2RlZmluZSAg
IE1JX1NFTUFQSE9SRV9QT0xMCQkoMSA8PCAxNSkKICNkZWZpbmUgICBNSV9TRU1BUEhPUkVfU0FE
X0dUX1NERAkoMCA8PCAxMikKICNkZWZpbmUgICBNSV9TRU1BUEhPUkVfU0FEX0dURV9TREQJKDEg
PDwgMTIpCkBAIC0xMTksNiArMTIwLDcgQEAKICNkZWZpbmUgICBNSV9TRU1BUEhPUkVfU0FEX0xU
RV9TREQJKDMgPDwgMTIpCiAjZGVmaW5lICAgTUlfU0VNQVBIT1JFX1NBRF9FUV9TREQJKDQgPDwg
MTIpCiAjZGVmaW5lICAgTUlfU0VNQVBIT1JFX1NBRF9ORVFfU0RECSg1IDw8IDEyKQorI2RlZmlu
ZSAgIE1JX1NFTUFQSE9SRV9UT0tFTl9TSElGVAk1CiAjZGVmaW5lIE1JX1NUT1JFX0RXT1JEX0lN
TQlNSV9JTlNUUigweDIwLCAxKQogI2RlZmluZSBNSV9TVE9SRV9EV09SRF9JTU1fR0VONAlNSV9J
TlNUUigweDIwLCAyKQogI2RlZmluZSAgIE1JX01FTV9WSVJUVUFMCSgxIDw8IDIyKSAvKiA5NDUs
ZzMzLDk2NSAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJj
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYwppbmRleCA2NGZhMmRiNTkw
NWYuLmM3NGZjNzVlNDk4MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKQEAgLTMy
MzcsNiArMzIzNywyMiBAQCBzdGF0aWMgdTMyICpnZW44X2VtaXRfZmluaV9icmVhZGNydW1iX3Jj
cyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0LCB1MzIgKmNzKQogCXJldHVybiBnZW44X2Vt
aXRfZmluaV9icmVhZGNydW1iX2Zvb3RlcihyZXF1ZXN0LCBjcyk7CiB9CiAKK3N0YXRpYyB1MzIg
KgorZ2VuMTFfZW1pdF9maW5pX2JyZWFkY3J1bWJfcmNzKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJl
cXVlc3QsIHUzMiAqY3MpCit7CisJY3MgPSBnZW44X2VtaXRfZ2d0dF93cml0ZV9yY3MoY3MsCisJ
CQkJICAgICAgcmVxdWVzdC0+ZmVuY2Uuc2Vxbm8sCisJCQkJICAgICAgcmVxdWVzdC0+dGltZWxp
bmUtPmh3c3Bfb2Zmc2V0LAorCQkJCSAgICAgIFBJUEVfQ09OVFJPTF9DU19TVEFMTCB8CisJCQkJ
ICAgICAgUElQRV9DT05UUk9MX1RJTEVfQ0FDSEVfRkxVU0ggfAorCQkJCSAgICAgIFBJUEVfQ09O
VFJPTF9SRU5ERVJfVEFSR0VUX0NBQ0hFX0ZMVVNIIHwKKwkJCQkgICAgICBQSVBFX0NPTlRST0xf
REVQVEhfQ0FDSEVfRkxVU0ggfAorCQkJCSAgICAgIFBJUEVfQ09OVFJPTF9EQ19GTFVTSF9FTkFC
TEUgfAorCQkJCSAgICAgIFBJUEVfQ09OVFJPTF9GTFVTSF9FTkFCTEUpOworCisJcmV0dXJuIGdl
bjhfZW1pdF9maW5pX2JyZWFkY3J1bWJfZm9vdGVyKHJlcXVlc3QsIGNzKTsKK30KKwogLyoKICAq
IE5vdGUgdGhhdCB0aGUgQ1MgaW5zdHJ1Y3Rpb24gcHJlLXBhcnNlciB3aWxsIG5vdCBzdGFsbCBv
biB0aGUgYnJlYWRjcnVtYgogICogZmx1c2ggYW5kIHdpbGwgY29udGludWUgcHJlLWZldGNoaW5n
IHRoZSBpbnN0cnVjdGlvbnMgYWZ0ZXIgaXQgYmVmb3JlIHRoZQpAQCAtMzI1NSw4ICszMjcxLDQ5
IEBAIHN0YXRpYyB1MzIgKmdlbjhfZW1pdF9maW5pX2JyZWFkY3J1bWJfcmNzKHN0cnVjdCBpOTE1
X3JlcXVlc3QgKnJlcXVlc3QsIHUzMiAqY3MpCiAgKiBBbGwgdGhlIGFib3ZlIGFwcGxpZXMgb25s
eSB0byB0aGUgaW5zdHJ1Y3Rpb25zIHRoZW1zZWx2ZXMuIE5vbi1pbmxpbmUgZGF0YQogICogdXNl
ZCBieSB0aGUgaW5zdHJ1Y3Rpb25zIGlzIG5vdCBwcmUtZmV0Y2hlZC4KICAqLwotc3RhdGljIHUz
MiAqZ2VuMTFfZW1pdF9maW5pX2JyZWFkY3J1bWJfcmNzKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJl
cXVlc3QsCi0JCQkJCSAgIHUzMiAqY3MpCisKK3N0YXRpYyB1MzIgKmdlbjEyX2VtaXRfcHJlZW1w
dF9idXN5d2FpdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0LCB1MzIgKmNzKQoreworCSpj
cysrID0gTUlfU0VNQVBIT1JFX1dBSVRfVE9LRU4gfAorCQlNSV9TRU1BUEhPUkVfR0xPQkFMX0dU
VCB8CisJCU1JX1NFTUFQSE9SRV9QT0xMIHwKKwkJTUlfU0VNQVBIT1JFX1NBRF9FUV9TREQ7CisJ
KmNzKysgPSAwOworCSpjcysrID0gaW50ZWxfaHdzX3ByZWVtcHRfYWRkcmVzcyhyZXF1ZXN0LT5l
bmdpbmUpOworCSpjcysrID0gMDsKKwkqY3MrKyA9IDA7CisJKmNzKysgPSBNSV9OT09QOworCisJ
cmV0dXJuIGNzOworfQorCitzdGF0aWMgX19hbHdheXNfaW5saW5lIHUzMioKK2dlbjEyX2VtaXRf
ZmluaV9icmVhZGNydW1iX2Zvb3RlcihzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0LCB1MzIg
KmNzKQoreworCSpjcysrID0gTUlfVVNFUl9JTlRFUlJVUFQ7CisKKwkqY3MrKyA9IE1JX0FSQl9P
Tl9PRkYgfCBNSV9BUkJfRU5BQkxFOworCWlmIChpbnRlbF9lbmdpbmVfaGFzX3NlbWFwaG9yZXMo
cmVxdWVzdC0+ZW5naW5lKSkKKwkJY3MgPSBnZW4xMl9lbWl0X3ByZWVtcHRfYnVzeXdhaXQocmVx
dWVzdCwgY3MpOworCisJcmVxdWVzdC0+dGFpbCA9IGludGVsX3Jpbmdfb2Zmc2V0KHJlcXVlc3Qs
IGNzKTsKKwlhc3NlcnRfcmluZ190YWlsX3ZhbGlkKHJlcXVlc3QtPnJpbmcsIHJlcXVlc3QtPnRh
aWwpOworCisJcmV0dXJuIGdlbjhfZW1pdF93YV90YWlsKHJlcXVlc3QsIGNzKTsKK30KKworc3Rh
dGljIHUzMiAqZ2VuMTJfZW1pdF9maW5pX2JyZWFkY3J1bWIoc3RydWN0IGk5MTVfcmVxdWVzdCAq
cmVxdWVzdCwgdTMyICpjcykKK3sKKwljcyA9IGdlbjhfZW1pdF9nZ3R0X3dyaXRlKGNzLAorCQkJ
CSAgcmVxdWVzdC0+ZmVuY2Uuc2Vxbm8sCisJCQkJICByZXF1ZXN0LT50aW1lbGluZS0+aHdzcF9v
ZmZzZXQsCisJCQkJICAwKTsKKworCXJldHVybiBnZW4xMl9lbWl0X2ZpbmlfYnJlYWRjcnVtYl9m
b290ZXIocmVxdWVzdCwgY3MpOworfQorCitzdGF0aWMgdTMyICoKK2dlbjEyX2VtaXRfZmluaV9i
cmVhZGNydW1iX3JjcyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0LCB1MzIgKmNzKQogewog
CWNzID0gZ2VuOF9lbWl0X2dndHRfd3JpdGVfcmNzKGNzLAogCQkJCSAgICAgIHJlcXVlc3QtPmZl
bmNlLnNlcW5vLApAQCAtMzI2OCw3ICszMzI1LDcgQEAgc3RhdGljIHUzMiAqZ2VuMTFfZW1pdF9m
aW5pX2JyZWFkY3J1bWJfcmNzKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QsCiAJCQkJICAg
ICAgUElQRV9DT05UUk9MX0RDX0ZMVVNIX0VOQUJMRSB8CiAJCQkJICAgICAgUElQRV9DT05UUk9M
X0ZMVVNIX0VOQUJMRSk7CiAKLQlyZXR1cm4gZ2VuOF9lbWl0X2ZpbmlfYnJlYWRjcnVtYl9mb290
ZXIocmVxdWVzdCwgY3MpOworCXJldHVybiBnZW4xMl9lbWl0X2ZpbmlfYnJlYWRjcnVtYl9mb290
ZXIocmVxdWVzdCwgY3MpOwogfQogCiBzdGF0aWMgdm9pZCBleGVjbGlzdHNfcGFyayhzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUpCkBAIC0zMjk3LDkgKzMzNTQsNiBAQCB2b2lkIGludGVs
X2V4ZWNsaXN0c19zZXRfZGVmYXVsdF9zdWJtaXNzaW9uKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZSkKIAkJCWVuZ2luZS0+ZmxhZ3MgfD0gSTkxNV9FTkdJTkVfSEFTX1BSRUVNUFRJT047
CiAJfQogCi0JaWYgKElOVEVMX0dFTihlbmdpbmUtPmk5MTUpID49IDEyKSAvKiBYWFggZGlzYWJs
ZWQgZm9yIGRlYnVnZ2luZyAqLwotCQllbmdpbmUtPmZsYWdzICY9IH5JOTE1X0VOR0lORV9IQVNf
U0VNQVBIT1JFUzsKLQogCWlmIChlbmdpbmUtPmNsYXNzICE9IENPUFlfRU5HSU5FX0NMQVNTICYm
IElOVEVMX0dFTihlbmdpbmUtPmk5MTUpID49IDExKQogCQllbmdpbmUtPmZsYWdzIHw9IEk5MTVf
RU5HSU5FX0hBU19SRUxBVElWRV9NTUlPOwogfQpAQCAtMzMyOSw2ICszMzgzLDggQEAgbG9naWNh
bF9yaW5nX2RlZmF1bHRfdmZ1bmNzKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAll
bmdpbmUtPmVtaXRfZmx1c2ggPSBnZW44X2VtaXRfZmx1c2g7CiAJZW5naW5lLT5lbWl0X2luaXRf
YnJlYWRjcnVtYiA9IGdlbjhfZW1pdF9pbml0X2JyZWFkY3J1bWI7CiAJZW5naW5lLT5lbWl0X2Zp
bmlfYnJlYWRjcnVtYiA9IGdlbjhfZW1pdF9maW5pX2JyZWFkY3J1bWI7CisJaWYgKElOVEVMX0dF
TihlbmdpbmUtPmk5MTUpID49IDEyKQorCQllbmdpbmUtPmVtaXRfZmluaV9icmVhZGNydW1iID0g
Z2VuMTJfZW1pdF9maW5pX2JyZWFkY3J1bWI7CiAKIAllbmdpbmUtPnNldF9kZWZhdWx0X3N1Ym1p
c3Npb24gPSBpbnRlbF9leGVjbGlzdHNfc2V0X2RlZmF1bHRfc3VibWlzc2lvbjsKIApAQCAtMzM3
NCw2ICszNDMwLDkgQEAgc3RhdGljIHZvaWQgcmNzX3N1Ym1pc3Npb25fb3ZlcnJpZGUoc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewogCXN3aXRjaCAoSU5URUxfR0VOKGVuZ2luZS0+
aTkxNSkpIHsKIAljYXNlIDEyOgorCQllbmdpbmUtPmVtaXRfZmx1c2ggPSBnZW4xMV9lbWl0X2Zs
dXNoX3JlbmRlcjsKKwkJZW5naW5lLT5lbWl0X2ZpbmlfYnJlYWRjcnVtYiA9IGdlbjEyX2VtaXRf
ZmluaV9icmVhZGNydW1iX3JjczsKKwkJYnJlYWs7CiAJY2FzZSAxMToKIAkJZW5naW5lLT5lbWl0
X2ZsdXNoID0gZ2VuMTFfZW1pdF9mbHVzaF9yZW5kZXI7CiAJCWVuZ2luZS0+ZW1pdF9maW5pX2Jy
ZWFkY3J1bWIgPSBnZW4xMV9lbWl0X2ZpbmlfYnJlYWRjcnVtYl9yY3M7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BjaS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9wY2kuYwppbmRleCBlZTlhNzk1OTIwNGMuLmYwZTYxNzJjY2Q5NyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wY2kuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3BjaS5jCkBAIC03OTgsNyArNzk4LDYgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRlbF9k
ZXZpY2VfaW5mbyBpbnRlbF90aWdlcmxha2VfMTJfaW5mbyA9IHsKIAkuZW5naW5lX21hc2sgPQog
CQlCSVQoUkNTMCkgfCBCSVQoQkNTMCkgfCBCSVQoVkVDUzApIHwgQklUKFZDUzApIHwgQklUKFZD
UzIpLAogCS5oYXNfcmM2ID0gZmFsc2UsIC8qIFhYWCBkaXNhYmxlZCBmb3IgZGVidWdnaW5nICov
Ci0JLmhhc19sb2dpY2FsX3JpbmdfcHJlZW1wdGlvbiA9IGZhbHNlLCAvKiBYWFggZGlzYWJsZWQg
Zm9yIGRlYnVnZ2luZyAqLwogCS5lbmdpbmVfbWFzayA9IEJJVChSQ1MwKSwgLyogWFhYIHJlZHVj
ZWQgZm9yIGRlYnVnZ2luZyAqLwogfTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9yZXF1ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYwpp
bmRleCA3NTRhNzgzNjRhNjMuLmE5NjdhZmZmNWU1MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9y
ZXF1ZXN0LmMKQEAgLTc4Myw3ICs3ODMsOSBAQCBlbWl0X3NlbWFwaG9yZV93YWl0KHN0cnVjdCBp
OTE1X3JlcXVlc3QgKnRvLAogCQkgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqZnJvbSwKIAkJICAg
IGdmcF90IGdmcCkKIHsKKwlib29sIGhhc190b2tlbiA9IElOVEVMX0dFTih0by0+aTkxNSkgPj0g
MTI7CiAJdTMyIGh3c3Bfb2Zmc2V0OworCWludCBsZW47CiAJdTMyICpjczsKIAlpbnQgZXJyOwog
CkBAIC04MTAsNyArODEyLDExIEBAIGVtaXRfc2VtYXBob3JlX3dhaXQoc3RydWN0IGk5MTVfcmVx
dWVzdCAqdG8sCiAJaWYgKGVycikKIAkJcmV0dXJuIGVycjsKIAotCWNzID0gaW50ZWxfcmluZ19i
ZWdpbih0bywgNCk7CisJbGVuID0gNDsKKwlpZiAoaGFzX3Rva2VuKQorCQlsZW4gKz0gMjsKKwor
CWNzID0gaW50ZWxfcmluZ19iZWdpbih0bywgbGVuKTsKIAlpZiAoSVNfRVJSKGNzKSkKIAkJcmV0
dXJuIFBUUl9FUlIoY3MpOwogCkBAIC04MjIsMTMgKzgyOCwxOCBAQCBlbWl0X3NlbWFwaG9yZV93
YWl0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnRvLAogCSAqIChwb3N0LXdyYXApIHZhbHVlcyB0aGFu
IHRoZXkgd2VyZSBleHBlY3RpbmcgKGFuZCBzbyB3YWl0CiAJICogZm9yZXZlcikuCiAJICovCi0J
KmNzKysgPSBNSV9TRU1BUEhPUkVfV0FJVCB8Ci0JCU1JX1NFTUFQSE9SRV9HTE9CQUxfR1RUIHwK
LQkJTUlfU0VNQVBIT1JFX1BPTEwgfAotCQlNSV9TRU1BUEhPUkVfU0FEX0dURV9TREQ7CisJKmNz
KysgPSAoTUlfU0VNQVBIT1JFX1dBSVQgfAorCQkgTUlfU0VNQVBIT1JFX0dMT0JBTF9HVFQgfAor
CQkgTUlfU0VNQVBIT1JFX1BPTEwgfAorCQkgTUlfU0VNQVBIT1JFX1NBRF9HVEVfU0REKSArCisJ
CWhhc190b2tlbjsKIAkqY3MrKyA9IGZyb20tPmZlbmNlLnNlcW5vOwogCSpjcysrID0gaHdzcF9v
ZmZzZXQ7CiAJKmNzKysgPSAwOworCWlmIChoYXNfdG9rZW4pIHsKKwkJKmNzKysgPSAwOworCQkq
Y3MrKyA9IE1JX05PT1A7CisJfQogCiAJaW50ZWxfcmluZ19hZHZhbmNlKHRvLCBjcyk7CiAJdG8t
PnNjaGVkLnNlbWFwaG9yZXMgfD0gZnJvbS0+ZW5naW5lLT5tYXNrOwotLSAKMi4yMy4wCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFp
bGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5m
cmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7A49D127186
	for <lists+intel-gfx@lfdr.de>; Fri, 20 Dec 2019 00:31:46 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 75F1C6EBB0;
	Thu, 19 Dec 2019 23:31:44 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga06.intel.com (mga06.intel.com [134.134.136.31])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 48F856E3FE
 for <intel-gfx@lists.freedesktop.org>; Thu, 19 Dec 2019 23:31:41 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga005.fm.intel.com ([10.253.24.32])
 by orsmga104.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 19 Dec 2019 15:31:33 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,333,1571727600"; d="scan'208";a="416359976"
Received: from labuser-z97x-ud5h.jf.intel.com ([10.54.75.49])
 by fmsmga005.fm.intel.com with ESMTP; 19 Dec 2019 15:31:32 -0800
From: Manasi Navare <manasi.d.navare@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 19 Dec 2019 15:33:04 -0800
Message-Id: <20191219233305.28080-2-manasi.d.navare@intel.com>
X-Mailer: git-send-email 2.19.1
In-Reply-To: <20191219233305.28080-1-manasi.d.navare@intel.com>
References: <20191219233305.28080-1-manasi.d.navare@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v3 2/3] drm/i915/dp: Make port sync mode
 assignments only if all tiles present
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWRkIGFuIGV4dHJhIGNoZWNrIGJlZm9yZSBtYWtpbmcgbWFzdGVyIHNsYXZlIGFzc2lnbm1lbnRz
IGZvciB0aWxlZApkaXNwbGF5cyB0byBtYWtlIHN1cmUgd2UgbWFrZSB0aGVzZSBhc3NpZ25tZW50
cyBvbmx5IGlmIGFsbCB0aWxlZApjb25uZWN0b3JzIGFyZSBwcmVzZW50LiBJZiBub3QgdGhlbiBp
bml0aWFsaXplIHRoZSBzdGF0ZSB0byBkZWZhdWx0cwpzbyBpdCBkb2VzIGEgbm9ybWFsIG5vbiB0
aWxlZCBtb2Rlc2V0IHdpdGhvdXQgdHJhbnNjb2RlciBwb3J0IHN5bmMuCgp2MzoKKiBEZWZhdWx0
IG1hc3RlciB0cmFucyB0byBJTlZBTElEIHRvIGF2b2lkIHBpcGUgbWlzbWF0Y2gKdjI6CiogUmVu
YW1lIGljbF9hZGRfc3luY19tb2RlX2NydGNzCiogTW92ZSB0aGlzIGZ1bmN0aW9uIGp1c3QgYmVm
b3JlIC5jb21wdXRlX2NvbmZpZyBob29rCiogQ2hlY2sgaWYgRFAgYmVmb3JlIG1hc3RlciBzbGF2
ZSBhc3NpZ25tZW50cyAoVmlsbGUpCgpCdWd6aWxsYTogaHR0cHM6Ly9naXRsYWIuZnJlZWRlc2t0
b3Aub3JnL2RybS9pbnRlbC9pc3N1ZXMvNQpDYzogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJq
YWxhQGxpbnV4LmludGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogTWFuYXNpIE5hdmFyZSA8bWFuYXNp
LmQubmF2YXJlQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2Rpc3BsYXkuYyB8IDE2NSArKysrKysrKysrKystLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwg
MTAyIGluc2VydGlvbnMoKyksIDYzIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggY2I0MDM2YzYyM2MyLi42OGE2M2NmNWYx
NWMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxh
eS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBA
IC0xMjAxNCw4OCArMTIwMTQsMTA2IEBAIHN0YXRpYyBib29sIGM4X3BsYW5lc19jaGFuZ2VkKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSkKIAlyZXR1cm4gIW9s
ZF9jcnRjX3N0YXRlLT5jOF9wbGFuZXMgIT0gIW5ld19jcnRjX3N0YXRlLT5jOF9wbGFuZXM7CiB9
CiAKLXN0YXRpYyBpbnQgaWNsX2FkZF9zeW5jX21vZGVfY3J0Y3Moc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUpCitzdGF0aWMgdm9pZCByZXNldF9wb3J0X3N5bmNfbW9kZV9zdGF0
ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3sKKwljcnRjX3N0YXRlLT5t
YXN0ZXJfdHJhbnNjb2RlciA9IElOVkFMSURfVFJBTlNDT0RFUjsKKwljcnRjX3N0YXRlLT5zeW5j
X21vZGVfc2xhdmVzX21hc2sgPSAwOworfQorCitzdGF0aWMgaW50IGljbF9jb21wdXRlX3BvcnRf
c3luY19jcnRjX3N0YXRlKHN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IsCisJCQkJCSAg
ICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCQkJICAgIGludCBudW1f
dGlsZWRfY29ubnMpCiB7CiAJc3RydWN0IGRybV9jcnRjICpjcnRjID0gY3J0Y19zdGF0ZS0+dWFw
aS5jcnRjOwogCXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlID0gdG9faW50ZWxfYXRv
bWljX3N0YXRlKGNydGNfc3RhdGUtPnVhcGkuc3RhdGUpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjLT5kZXYpOwotCXN0
cnVjdCBkcm1fY29ubmVjdG9yICptYXN0ZXJfY29ubmVjdG9yLCAqY29ubmVjdG9yOwotCXN0cnVj
dCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uZWN0b3Jfc3RhdGU7CisJc3RydWN0IGRybV9jb25u
ZWN0b3IgKm1hc3Rlcl9jb25uZWN0b3I7CiAJc3RydWN0IGRybV9jb25uZWN0b3JfbGlzdF9pdGVy
IGNvbm5faXRlcjsKIAlzdHJ1Y3QgZHJtX2NydGMgKm1hc3Rlcl9jcnRjID0gTlVMTDsKIAlzdHJ1
Y3QgZHJtX2NydGNfc3RhdGUgKm1hc3Rlcl9jcnRjX3N0YXRlOwogCXN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICptYXN0ZXJfcGlwZV9jb25maWc7Ci0JaW50IGksIHRpbGVfZ3JvdXBfaWQ7CiAKIAlp
ZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDExKQogCQlyZXR1cm4gMDsKIAorCWlmICghaW50ZWxf
Y3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9PVVRQVVRfRFApKQorCQlyZXR1cm4gMDsK
KwogCS8qCiAJICogSW4gY2FzZSBvZiB0aWxlZCBkaXNwbGF5cyB0aGVyZSBjb3VsZCBiZSBvbmUg
b3IgbW9yZSBzbGF2ZXMgYnV0IHRoZXJlIGlzCiAJICogb25seSBvbmUgbWFzdGVyLiBMZXRzIG1h
a2UgdGhlIENSVEMgdXNlZCBieSB0aGUgY29ubmVjdG9yIGNvcnJlc3BvbmRpbmcKIAkgKiB0byB0
aGUgbGFzdCBob3Jpem9uYWwgYW5kIGxhc3QgdmVydGljYWwgdGlsZSBhIG1hc3Rlci9nZW5sb2Nr
IENSVEMuCiAJICogQWxsIHRoZSBvdGhlciBDUlRDcyBjb3JyZXNwb25kaW5nIHRvIG90aGVyIHRp
bGVzIG9mIHRoZSBzYW1lIFRpbGUgZ3JvdXAKIAkgKiBhcmUgdGhlIHNsYXZlIENSVENzIGFuZCBo
b2xkIGEgcG9pbnRlciB0byB0aGVpciBnZW5sb2NrIENSVEMuCisJICogSWYgYWxsIHRpbGVzIG5v
dCBwcmVzZW50IGRvIG5vdCBtYWtlIG1hc3RlciBzbGF2ZSBhc3NpZ25tZW50cy4KKwkgKgorCSAq
IEZJWE1FOiBBZGQgc3VwcG9ydCBmb3IgbXVsdGlwbGUgdGlsZSBncnAgaWRzIGluIHRoZSBmdXR1
cmUgd2hlbiBzdWNoCisJICogcGFuZWxzIGFyZSBhdmFpbGFibGUuCiAJICovCi0JZm9yX2VhY2hf
bmV3X2Nvbm5lY3Rvcl9pbl9zdGF0ZSgmc3RhdGUtPmJhc2UsIGNvbm5lY3RvciwgY29ubmVjdG9y
X3N0YXRlLCBpKSB7Ci0JCWlmIChjb25uZWN0b3Jfc3RhdGUtPmNydGMgIT0gY3J0YykKLQkJCWNv
bnRpbnVlOwotCQlpZiAoIWNvbm5lY3Rvci0+aGFzX3RpbGUpCisJaWYgKCFjb25uZWN0b3ItPmhh
c190aWxlIHx8CisJICAgIGNydGNfc3RhdGUtPmh3Lm1vZGUuaGRpc3BsYXkgIT0gY29ubmVjdG9y
LT50aWxlX2hfc2l6ZSB8fAorCSAgICBjcnRjX3N0YXRlLT5ody5tb2RlLnZkaXNwbGF5ICE9IGNv
bm5lY3Rvci0+dGlsZV92X3NpemUgfHwKKwkgICAgbnVtX3RpbGVkX2Nvbm5zIDwgY29ubmVjdG9y
LT5udW1faF90aWxlICogY29ubmVjdG9yLT5udW1fdl90aWxlKSB7CisJCXJlc2V0X3BvcnRfc3lu
Y19tb2RlX3N0YXRlKGNydGNfc3RhdGUpOworCQlyZXR1cm4gMDsKKwl9CisJLyogTGFzdCBIb3Jp
em9udGFsIGFuZCBsYXN0IHZlcnRpY2FsIHRpbGUgY29ubmVjdG9yIGlzIGEgbWFzdGVyCisJICog
TWFzdGVyIFRyYW5zIGZvciBhIE1hc3RlciBDUlRDIGlzIGFsd2F5cyBJTlZBTElELgorCSAqLwor
CWlmIChjb25uZWN0b3ItPnRpbGVfaF9sb2MgPT0gY29ubmVjdG9yLT5udW1faF90aWxlIC0gMSAm
JgorCSAgICBjb25uZWN0b3ItPnRpbGVfdl9sb2MgPT0gY29ubmVjdG9yLT5udW1fdl90aWxlIC0g
MSkgeworCQljcnRjX3N0YXRlLT5tYXN0ZXJfdHJhbnNjb2RlciA9IElOVkFMSURfVFJBTlNDT0RF
UjsKKwkJcmV0dXJuIDA7CisJfQorCisJLyogTG9vcCB0aHJvdWdoIGFsbCBjb25uZWN0b3JzIGFu
ZCBjb25maWd1cmUgdGhlIFNsYXZlIGNydGNfc3RhdGUKKwkgKiB0byBwb2ludCB0byB0aGUgY29y
cmVjdCBtYXN0ZXIuCisJICovCisJcmVzZXRfcG9ydF9zeW5jX21vZGVfc3RhdGUoY3J0Y19zdGF0
ZSk7CisJZHJtX2Nvbm5lY3Rvcl9saXN0X2l0ZXJfYmVnaW4oJmRldl9wcml2LT5kcm0sICZjb25u
X2l0ZXIpOworCWRybV9mb3JfZWFjaF9jb25uZWN0b3JfaXRlcihtYXN0ZXJfY29ubmVjdG9yLCAm
Y29ubl9pdGVyKSB7CisJCXN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICptYXN0ZXJfY29ubl9z
dGF0ZSA9IE5VTEw7CisKKwkJaWYgKCEobWFzdGVyX2Nvbm5lY3Rvci0+aGFzX3RpbGUgJiYKKwkJ
ICAgICAgbWFzdGVyX2Nvbm5lY3Rvci0+dGlsZV9ncm91cC0+aWQgPT0gY29ubmVjdG9yLT50aWxl
X2dyb3VwLT5pZCkpCiAJCQljb250aW51ZTsKLQkJaWYgKGNydGNfc3RhdGUtPmh3Lm1vZGUuaGRp
c3BsYXkgIT0gY29ubmVjdG9yLT50aWxlX2hfc2l6ZSB8fAotCQkgICAgY3J0Y19zdGF0ZS0+aHcu
bW9kZS52ZGlzcGxheSAhPSBjb25uZWN0b3ItPnRpbGVfdl9zaXplKQotCQkJcmV0dXJuIDA7Ci0J
CWlmIChjb25uZWN0b3ItPnRpbGVfaF9sb2MgPT0gY29ubmVjdG9yLT5udW1faF90aWxlIC0gMSAm
JgotCQkgICAgY29ubmVjdG9yLT50aWxlX3ZfbG9jID09IGNvbm5lY3Rvci0+bnVtX3ZfdGlsZSAt
IDEpCisJCWlmIChtYXN0ZXJfY29ubmVjdG9yLT50aWxlX2hfbG9jICE9IG1hc3Rlcl9jb25uZWN0
b3ItPm51bV9oX3RpbGUgLSAxIHx8CisJCSAgICBtYXN0ZXJfY29ubmVjdG9yLT50aWxlX3ZfbG9j
ICE9IG1hc3Rlcl9jb25uZWN0b3ItPm51bV92X3RpbGUgLSAxKQogCQkJY29udGludWU7Ci0JCWNy
dGNfc3RhdGUtPnN5bmNfbW9kZV9zbGF2ZXNfbWFzayA9IDA7Ci0JCXRpbGVfZ3JvdXBfaWQgPSBj
b25uZWN0b3ItPnRpbGVfZ3JvdXAtPmlkOwotCQlkcm1fY29ubmVjdG9yX2xpc3RfaXRlcl9iZWdp
bigmZGV2X3ByaXYtPmRybSwgJmNvbm5faXRlcik7Ci0JCWRybV9mb3JfZWFjaF9jb25uZWN0b3Jf
aXRlcihtYXN0ZXJfY29ubmVjdG9yLCAmY29ubl9pdGVyKSB7Ci0JCQlzdHJ1Y3QgZHJtX2Nvbm5l
Y3Rvcl9zdGF0ZSAqbWFzdGVyX2Nvbm5fc3RhdGUgPSBOVUxMOwogCi0JCQlpZiAoIW1hc3Rlcl9j
b25uZWN0b3ItPmhhc190aWxlKQotCQkJCWNvbnRpbnVlOwotCQkJaWYgKG1hc3Rlcl9jb25uZWN0
b3ItPnRpbGVfaF9sb2MgIT0gbWFzdGVyX2Nvbm5lY3Rvci0+bnVtX2hfdGlsZSAtIDEgfHwKLQkJ
CSAgICBtYXN0ZXJfY29ubmVjdG9yLT50aWxlX3ZfbG9jICE9IG1hc3Rlcl9jb25uZWN0b3ItPm51
bV92X3RpbGUgLSAxKQotCQkJCWNvbnRpbnVlOwotCQkJaWYgKG1hc3Rlcl9jb25uZWN0b3ItPnRp
bGVfZ3JvdXAtPmlkICE9IHRpbGVfZ3JvdXBfaWQpCi0JCQkJY29udGludWU7Ci0KLQkJCW1hc3Rl
cl9jb25uX3N0YXRlID0gZHJtX2F0b21pY19nZXRfY29ubmVjdG9yX3N0YXRlKCZzdGF0ZS0+YmFz
ZSwKLQkJCQkJCQkJCSAgIG1hc3Rlcl9jb25uZWN0b3IpOwotCQkJaWYgKElTX0VSUihtYXN0ZXJf
Y29ubl9zdGF0ZSkpIHsKLQkJCQlkcm1fY29ubmVjdG9yX2xpc3RfaXRlcl9lbmQoJmNvbm5faXRl
cik7Ci0JCQkJcmV0dXJuIFBUUl9FUlIobWFzdGVyX2Nvbm5fc3RhdGUpOwotCQkJfQotCQkJaWYg
KG1hc3Rlcl9jb25uX3N0YXRlLT5jcnRjKSB7Ci0JCQkJbWFzdGVyX2NydGMgPSBtYXN0ZXJfY29u
bl9zdGF0ZS0+Y3J0YzsKLQkJCQlicmVhazsKLQkJCX0KKwkJbWFzdGVyX2Nvbm5fc3RhdGUgPSBk
cm1fYXRvbWljX2dldF9jb25uZWN0b3Jfc3RhdGUoJnN0YXRlLT5iYXNlLAorCQkJCQkJCQkgICBt
YXN0ZXJfY29ubmVjdG9yKTsKKwkJaWYgKElTX0VSUihtYXN0ZXJfY29ubl9zdGF0ZSkpIHsKKwkJ
CWRybV9jb25uZWN0b3JfbGlzdF9pdGVyX2VuZCgmY29ubl9pdGVyKTsKKwkJCXJldHVybiBQVFJf
RVJSKG1hc3Rlcl9jb25uX3N0YXRlKTsKIAkJfQotCQlkcm1fY29ubmVjdG9yX2xpc3RfaXRlcl9l
bmQoJmNvbm5faXRlcik7Ci0KLQkJaWYgKCFtYXN0ZXJfY3J0YykgewotCQkJRFJNX0RFQlVHX0tN
UygiQ291bGQgbm90IGZpbmQgTWFzdGVyIENSVEMgZm9yIFNsYXZlIENSVEMgJWRcbiIsCi0JCQkJ
ICAgICAgY29ubmVjdG9yX3N0YXRlLT5jcnRjLT5iYXNlLmlkKTsKLQkJCXJldHVybiAtRUlOVkFM
OworCQlpZiAobWFzdGVyX2Nvbm5fc3RhdGUtPmNydGMpIHsKKwkJCW1hc3Rlcl9jcnRjID0gbWFz
dGVyX2Nvbm5fc3RhdGUtPmNydGM7CisJCQlicmVhazsKIAkJfQorCX0KKwlkcm1fY29ubmVjdG9y
X2xpc3RfaXRlcl9lbmQoJmNvbm5faXRlcik7CiAKLQkJbWFzdGVyX2NydGNfc3RhdGUgPSBkcm1f
YXRvbWljX2dldF9jcnRjX3N0YXRlKCZzdGF0ZS0+YmFzZSwKLQkJCQkJCQkgICAgICBtYXN0ZXJf
Y3J0Yyk7Ci0JCWlmIChJU19FUlIobWFzdGVyX2NydGNfc3RhdGUpKQotCQkJcmV0dXJuIFBUUl9F
UlIobWFzdGVyX2NydGNfc3RhdGUpOwotCi0JCW1hc3Rlcl9waXBlX2NvbmZpZyA9IHRvX2ludGVs
X2NydGNfc3RhdGUobWFzdGVyX2NydGNfc3RhdGUpOwotCQljcnRjX3N0YXRlLT5tYXN0ZXJfdHJh
bnNjb2RlciA9IG1hc3Rlcl9waXBlX2NvbmZpZy0+Y3B1X3RyYW5zY29kZXI7Ci0JCW1hc3Rlcl9w
aXBlX2NvbmZpZy0+c3luY19tb2RlX3NsYXZlc19tYXNrIHw9Ci0JCQlCSVQoY3J0Y19zdGF0ZS0+
Y3B1X3RyYW5zY29kZXIpOwotCQlEUk1fREVCVUdfS01TKCJNYXN0ZXIgVHJhbnNjb2RlciA9ICVz
IGFkZGVkIGZvciBTbGF2ZSBDUlRDID0gJWQsIHNsYXZlIHRyYW5zY29kZXIgYml0bWFzayA9ICVk
XG4iLAotCQkJICAgICAgdHJhbnNjb2Rlcl9uYW1lKGNydGNfc3RhdGUtPm1hc3Rlcl90cmFuc2Nv
ZGVyKSwKLQkJCSAgICAgIGNydGNfc3RhdGUtPnVhcGkuY3J0Yy0+YmFzZS5pZCwKLQkJCSAgICAg
IG1hc3Rlcl9waXBlX2NvbmZpZy0+c3luY19tb2RlX3NsYXZlc19tYXNrKTsKKwlpZiAoIW1hc3Rl
cl9jcnRjKSB7CisJCURSTV9ERUJVR19LTVMoIkNvdWxkIG5vdCBmaW5kIE1hc3RlciBDUlRDIGZv
ciBTbGF2ZSBDUlRDICVkXG4iLAorCQkJICAgICAgY3J0Yy0+YmFzZS5pZCk7CisJCXJldHVybiAt
RUlOVkFMOwogCX0KIAorCW1hc3Rlcl9jcnRjX3N0YXRlID0gZHJtX2F0b21pY19nZXRfY3J0Y19z
dGF0ZSgmc3RhdGUtPmJhc2UsCisJCQkJCQkgICAgICBtYXN0ZXJfY3J0Yyk7CisJaWYgKElTX0VS
UihtYXN0ZXJfY3J0Y19zdGF0ZSkpCisJCXJldHVybiBQVFJfRVJSKG1hc3Rlcl9jcnRjX3N0YXRl
KTsKKworCW1hc3Rlcl9waXBlX2NvbmZpZyA9IHRvX2ludGVsX2NydGNfc3RhdGUobWFzdGVyX2Ny
dGNfc3RhdGUpOworCWNydGNfc3RhdGUtPm1hc3Rlcl90cmFuc2NvZGVyID0gbWFzdGVyX3BpcGVf
Y29uZmlnLT5jcHVfdHJhbnNjb2RlcjsKKwltYXN0ZXJfcGlwZV9jb25maWctPnN5bmNfbW9kZV9z
bGF2ZXNfbWFzayB8PQorCQlCSVQoY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXIpOworCURSTV9E
RUJVR19LTVMoIk1hc3RlciBUcmFuc2NvZGVyID0gJXMgYWRkZWQgZm9yIFNsYXZlIENSVEMgPSAl
ZCwgc2xhdmUgdHJhbnNjb2RlciBiaXRtYXNrID0gJWRcbiIsCisJCSAgICAgIHRyYW5zY29kZXJf
bmFtZShjcnRjX3N0YXRlLT5tYXN0ZXJfdHJhbnNjb2RlciksCisJCSAgICAgIGNydGMtPmJhc2Uu
aWQsCisJCSAgICAgIG1hc3Rlcl9waXBlX2NvbmZpZy0+c3luY19tb2RlX3NsYXZlc19tYXNrKTsK
KwogCXJldHVybiAwOwogfQogCkBAIC0xMjY2MCw3ICsxMjY3OCw3IEBAIGludGVsX21vZGVzZXRf
cGlwZV9jb25maWcoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQogCXN0cnVj
dCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3I7CiAJc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUg
KmNvbm5lY3Rvcl9zdGF0ZTsKIAlpbnQgYmFzZV9icHAsIHJldDsKLQlpbnQgaTsKKwlpbnQgaSwg
dGlsZV9ncm91cF9pZCA9IC0xLCBudW1fdGlsZWRfY29ubnMgPSAwOwogCWJvb2wgcmV0cnkgPSB0
cnVlOwogCiAJcGlwZV9jb25maWctPmNwdV90cmFuc2NvZGVyID0KQEAgLTEyNzI2LDE3ICsxMjc0
NCwzMCBAQCBpbnRlbF9tb2Rlc2V0X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpwaXBlX2NvbmZpZykKIAlwaXBlX2NvbmZpZy0+cG9ydF9jbG9jayA9IDA7CiAJcGlwZV9jb25m
aWctPnBpeGVsX211bHRpcGxpZXIgPSAxOwogCisJLyogUmVzZXQgdGhlIG1hc3RlciB0cmFuc2Nv
ZGVyIGZvciBwb3J0IHN5bmMgbW9kZSAqLworCXBpcGVfY29uZmlnLT5tYXN0ZXJfdHJhbnNjb2Rl
ciA9IElOVkFMSURfVFJBTlNDT0RFUjsKKwogCS8qIEZpbGwgaW4gZGVmYXVsdCBjcnRjIHRpbWlu
Z3MsIGFsbG93IGVuY29kZXJzIHRvIG92ZXJ3cml0ZSB0aGVtLiAqLwogCWRybV9tb2RlX3NldF9j
cnRjaW5mbygmcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUsCiAJCQkgICAgICBDUlRDX1NU
RVJFT19ET1VCTEUpOwogCi0JLyogU2V0IHRoZSBjcnRjX3N0YXRlIGRlZmF1bHRzIGZvciB0cmFu
c19wb3J0X3N5bmMgKi8KLQlwaXBlX2NvbmZpZy0+bWFzdGVyX3RyYW5zY29kZXIgPSBJTlZBTElE
X1RSQU5TQ09ERVI7Ci0JcmV0ID0gaWNsX2FkZF9zeW5jX21vZGVfY3J0Y3MocGlwZV9jb25maWcp
OwotCWlmIChyZXQpIHsKLQkJRFJNX0RFQlVHX0tNUygiQ2Fubm90IGFzc2lnbiBTeW5jIE1vZGUg
Q1JUQ3M6ICVkXG4iLAotCQkJICAgICAgcmV0KTsKLQkJcmV0dXJuIHJldDsKKworCS8qIEdldCB0
aWxlX2dyb3VwX2lkIG9mIHRpbGVkIGNvbm5lY3RvciAqLworCWZvcl9lYWNoX25ld19jb25uZWN0
b3JfaW5fc3RhdGUoc3RhdGUsIGNvbm5lY3RvciwgY29ubmVjdG9yX3N0YXRlLCBpKSB7CisJCWlm
IChjb25uZWN0b3Jfc3RhdGUtPmNydGMgPT0gY3J0YyAmJgorCQkgICAgY29ubmVjdG9yLT5oYXNf
dGlsZSkgeworCQkJdGlsZV9ncm91cF9pZCA9IGNvbm5lY3Rvci0+dGlsZV9ncm91cC0+aWQ7CisJ
CQlicmVhazsKKwkJfQorCX0KKworCS8qIEdldCB0b3RhbCBudW1iZXIgb2YgdGlsZWQgY29ubmVj
dG9ycyBpbiBzdGF0ZSB0aGF0IGJlbG9uZyB0bworCSAqIHRoaXMgdGlsZSBncm91cC4KKwkgKi8K
Kwlmb3JfZWFjaF9uZXdfY29ubmVjdG9yX2luX3N0YXRlKHN0YXRlLCBjb25uZWN0b3IsIGNvbm5l
Y3Rvcl9zdGF0ZSwgaSkgeworCQlpZiAoY29ubmVjdG9yLT5oYXNfdGlsZSAmJgorCQkgICAgY29u
bmVjdG9yLT50aWxlX2dyb3VwLT5pZCA9PSB0aWxlX2dyb3VwX2lkKQorCQkJbnVtX3RpbGVkX2Nv
bm5zKys7CiAJfQogCiAJLyogUGFzcyBvdXIgbW9kZSB0byB0aGUgY29ubmVjdG9ycyBhbmQgdGhl
IENSVEMgdG8gZ2l2ZSB0aGVtIGEgY2hhbmNlIHRvCkBAIC0xMjc0Nyw2ICsxMjc3OCwxNCBAQCBp
bnRlbF9tb2Rlc2V0X3BpcGVfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2Nv
bmZpZykKIAkJaWYgKGNvbm5lY3Rvcl9zdGF0ZS0+Y3J0YyAhPSBjcnRjKQogCQkJY29udGludWU7
CiAKKwkJcmV0ID0gaWNsX2NvbXB1dGVfcG9ydF9zeW5jX2NydGNfc3RhdGUoY29ubmVjdG9yLCBw
aXBlX2NvbmZpZywKKwkJCQkJCSAgICAgICBudW1fdGlsZWRfY29ubnMpOworCQlpZiAocmV0KSB7
CisJCQlEUk1fREVCVUdfS01TKCJDYW5ub3QgYXNzaWduIFN5bmMgTW9kZSBDUlRDczogJWRcbiIs
CisJCQkJICAgICAgcmV0KTsKKwkJCXJldHVybiByZXQ7CisJCX0KKwogCQllbmNvZGVyID0gdG9f
aW50ZWxfZW5jb2Rlcihjb25uZWN0b3Jfc3RhdGUtPmJlc3RfZW5jb2Rlcik7CiAJCXJldCA9IGVu
Y29kZXItPmNvbXB1dGVfY29uZmlnKGVuY29kZXIsIHBpcGVfY29uZmlnLAogCQkJCQkgICAgICBj
b25uZWN0b3Jfc3RhdGUpOwotLSAKMi4xOS4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0
cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9s
aXN0aW5mby9pbnRlbC1nZngK

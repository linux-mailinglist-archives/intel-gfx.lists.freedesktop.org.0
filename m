Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 14106D4DE6
	for <lists+intel-gfx@lfdr.de>; Sat, 12 Oct 2019 09:23:18 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 14DFB6E456;
	Sat, 12 Oct 2019 07:23:16 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0CC6D6E456
 for <intel-gfx@lists.freedesktop.org>; Sat, 12 Oct 2019 07:23:12 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18811658-1500050 
 for <intel-gfx@lists.freedesktop.org>; Sat, 12 Oct 2019 08:23:09 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sat, 12 Oct 2019 08:23:08 +0100
Message-Id: <20191012072308.30312-3-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191012072308.30312-1-chris@chris-wilson.co.uk>
References: <20191012072308.30312-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 3/3] drm/i915/perf: execute OA configuration from
 command stream
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwuY29tPgoK
V2UgaGF2ZW4ndCBydW4gaW50byBpc3N1ZXMgd2l0aCBwcm9ncmFtbWluZyB0aGUgZ2xvYmFsIE9B
L05PQQpyZWdpc3RlcnMgY29uZmlndXJhdGlvbiBmcm9tIENQVSBzbyBmYXIsIGJ1dCBIVyBlbmdp
bmVlcnMgYWN0dWFsbHkKcmVjb21tZW5kIGRvaW5nIHRoaXMgZnJvbSB0aGUgY29tbWFuZCBzdHJl
YW1lci4gT24gVEdMIGluIHBhcnRpY3VsYXIKb25lIG9mIHRoZSBjbG9jayBkb21haW4gaW4gd2hp
Y2ggc29tZSBvZiB0aGF0IHByb2dyYW1taW5nIGdvZXMgbWlnaHQKbm90IGJlIHBvd2VyZWQgd2hl
biB3ZSBwb2tlIHRoaW5ncyBmcm9tIHRoZSBDUFUuCgpTaW5jZSB3ZSBoYXZlIGEgY29tbWFuZCBi
dWZmZXIgcHJlcGFyZWQgZm9yIHRoZSBleGVjYnVmZmVyIHNpZGUgb2YKdGhpbmdzLCB3ZSBjYW4g
cmV1c2UgdGhhdCBhcHByb2FjaCBoZXJlIHRvby4KClRoaXMgYWxzbyBhbGxvd3MgdXMgdG8gc2ln
bmlmaWNhbnRseSByZWR1Y2UgdGhlIGFtb3VudCBvZiB0aW1lIHdlIGhvbGQKdGhlIG1haW4gbG9j
ay4KCnYyOiBEcm9wIHRoZSBnbG9iYWwgbG9jayBhcyBtdWNoIGFzIHBvc3NpYmxlCgp2MzogVGFr
ZSBnbG9iYWwgbG9jayB0byBwaW4gZ2xvYmFsCgp2NDogQ3JlYXRlIGk5MTUgcmVxdWVzdCBpbiBl
bWl0X29hX2NvbmZpZygpIHRvIGF2b2lkIGRlYWRsb2NrcyAoTGlvbmVsKQoKdjU6IE1vdmUgbG9j
a2luZyB0byB0aGUgc3RyZWFtIChMaW9uZWwpCgp2NjogTW92ZSBhY3RpdmUgcmVjb25maWd1cmF0
aW9uIHJlcXVlc3QgaW50byBpOTE1X3BlcmZfc3RyZWFtIChMaW9uZWwpCgp2NzogUGluIFZNQSBv
dXRzaWRlIHJlcXVlc3QgY3JlYXRpb24gKENocmlzKQogICAgTG9jayBWTUEgYmVmb3JlIG1vdmUg
dG8gYWN0aXZlIChDaHJpcykKCnY4OiBGaXggZG91YmxlIGZyZWUgb24gc3RyZWFtLT5pbml0aWFs
X29hX2NvbmZpZ19ibyAoTGlvbmVsKQogICAgRG9uJ3QgYWxsb3cgaW50ZXJydXB0aW9uIHdoZW4g
d2FpdGluZyBvbiBhY3RpdmUgY29uZmlnIHJlcXVlc3QKICAgIChMaW9uZWwpCgpTaWduZWQtb2Zm
LWJ5OiBMaW9uZWwgTGFuZHdlcmxpbiA8bGlvbmVsLmcubGFuZHdlcmxpbkBpbnRlbC5jb20+ClJl
dmlld2VkLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KU2lnbmVk
LW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0tLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgfCAxOTkgKysrKysrKysrKysrKysrKysrKysr
KysrLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDE1NiBpbnNlcnRpb25zKCspLCA0MyBkZWxldGlv
bnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCmluZGV4IDgxZThhNzkzNDAwMS4uNzRmNTAx
MjBjMTUxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYwpAQCAtMTczMSw1NiArMTczMSwxODEg
QEAgc3RhdGljIGludCBhbGxvY19ub2Ffd2FpdChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3Ry
ZWFtKQogCXJldHVybiAwOwogCiBlcnJfdW5waW46Ci0JX19pOTE1X3ZtYV91bnBpbih2bWEpOwor
CWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZ2bWEsIDApOwogZXJyX3VucmVmOgogCWk5MTVf
Z2VtX29iamVjdF9wdXQoYm8pOwogCXJldHVybiByZXQ7CiB9CiAKLXN0YXRpYyB2b2lkIGNvbmZp
Z19vYV9yZWdzKHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSwKLQkJCSAgIGNvbnN0IHN0cnVj
dCBpOTE1X29hX3JlZyAqcmVncywKLQkJCSAgIHUzMiBuX3JlZ3MpCitzdGF0aWMgdTMyICp3cml0
ZV9jc19taV9scmkodTMyICpjcywKKwkJCSAgICBjb25zdCBzdHJ1Y3QgaTkxNV9vYV9yZWcgKnJl
Z19kYXRhLAorCQkJICAgIHUzMiBuX3JlZ3MpCiB7CiAJdTMyIGk7CiAKIAlmb3IgKGkgPSAwOyBp
IDwgbl9yZWdzOyBpKyspIHsKLQkJY29uc3Qgc3RydWN0IGk5MTVfb2FfcmVnICpyZWcgPSByZWdz
ICsgaTsKKwkJaWYgKChpICUgTUlfTE9BRF9SRUdJU1RFUl9JTU1fTUFYX1JFR1MpID09IDApIHsK
KwkJCXUzMiBuX2xyaSA9IG1pbl90KHUzMiwKKwkJCQkJICBuX3JlZ3MgLSBpLAorCQkJCQkgIE1J
X0xPQURfUkVHSVNURVJfSU1NX01BWF9SRUdTKTsKKworCQkJKmNzKysgPSBNSV9MT0FEX1JFR0lT
VEVSX0lNTShuX2xyaSk7CisJCX0KKwkJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChyZWdf
ZGF0YVtpXS5hZGRyKTsKKwkJKmNzKysgPSByZWdfZGF0YVtpXS52YWx1ZTsKKwl9CisKKwlyZXR1
cm4gY3M7Cit9CisKK3N0YXRpYyBpbnQgbnVtX2xyaV9kd29yZHMoaW50IG51bV9yZWdzKQorewor
CWludCBjb3VudCA9IDA7CisKKwlpZiAobnVtX3JlZ3MgPiAwKSB7CisJCWNvdW50ICs9IERJVl9S
T1VORF9VUChudW1fcmVncywgTUlfTE9BRF9SRUdJU1RFUl9JTU1fTUFYX1JFR1MpOworCQljb3Vu
dCArPSBudW1fcmVncyAqIDI7CisJfQorCisJcmV0dXJuIGNvdW50OworfQorCitzdGF0aWMgc3Ry
dWN0IGk5MTVfb2FfY29uZmlnX2JvICoKK2FsbG9jX29hX2NvbmZpZ19idWZmZXIoc3RydWN0IGk5
MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwKKwkJICAgICAgIHN0cnVjdCBpOTE1X29hX2NvbmZpZyAq
b2FfY29uZmlnKQoreworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CisJc3RydWN0
IGk5MTVfb2FfY29uZmlnX2JvICpvYV9ibzsKKwlzaXplX3QgY29uZmlnX2xlbmd0aCA9IDA7CisJ
dTMyICpjczsKKwlpbnQgZXJyOworCisJb2FfYm8gPSBremFsbG9jKHNpemVvZigqb2FfYm8pLCBH
RlBfS0VSTkVMKTsKKwlpZiAoIW9hX2JvKQorCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKKwor
CWNvbmZpZ19sZW5ndGggKz0gbnVtX2xyaV9kd29yZHMob2FfY29uZmlnLT5tdXhfcmVnc19sZW4p
OworCWNvbmZpZ19sZW5ndGggKz0gbnVtX2xyaV9kd29yZHMob2FfY29uZmlnLT5iX2NvdW50ZXJf
cmVnc19sZW4pOworCWNvbmZpZ19sZW5ndGggKz0gbnVtX2xyaV9kd29yZHMob2FfY29uZmlnLT5m
bGV4X3JlZ3NfbGVuKTsKKwljb25maWdfbGVuZ3RoKys7IC8qIE1JX0JBVENIX0JVRkZFUl9FTkQg
Ki8KKwljb25maWdfbGVuZ3RoID0gQUxJR04oc2l6ZW9mKHUzMikgKiBjb25maWdfbGVuZ3RoLCBJ
OTE1X0dUVF9QQUdFX1NJWkUpOworCisJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zaG1l
bShzdHJlYW0tPnBlcmYtPmk5MTUsIGNvbmZpZ19sZW5ndGgpOworCWlmIChJU19FUlIob2JqKSkg
eworCQllcnIgPSBQVFJfRVJSKG9iaik7CisJCWdvdG8gZXJyX2ZyZWU7CisJfQorCisJY3MgPSBp
OTE1X2dlbV9vYmplY3RfcGluX21hcChvYmosIEk5MTVfTUFQX1dCKTsKKwlpZiAoSVNfRVJSKGNz
KSkgeworCQllcnIgPSBQVFJfRVJSKGNzKTsKKwkJZ290byBlcnJfb2FfYm87CisJfQogCi0JCWlu
dGVsX3VuY29yZV93cml0ZSh1bmNvcmUsIHJlZy0+YWRkciwgcmVnLT52YWx1ZSk7CisJY3MgPSB3
cml0ZV9jc19taV9scmkoY3MsCisJCQkgICAgIG9hX2NvbmZpZy0+bXV4X3JlZ3MsCisJCQkgICAg
IG9hX2NvbmZpZy0+bXV4X3JlZ3NfbGVuKTsKKwljcyA9IHdyaXRlX2NzX21pX2xyaShjcywKKwkJ
CSAgICAgb2FfY29uZmlnLT5iX2NvdW50ZXJfcmVncywKKwkJCSAgICAgb2FfY29uZmlnLT5iX2Nv
dW50ZXJfcmVnc19sZW4pOworCWNzID0gd3JpdGVfY3NfbWlfbHJpKGNzLAorCQkJICAgICBvYV9j
b25maWctPmZsZXhfcmVncywKKwkJCSAgICAgb2FfY29uZmlnLT5mbGV4X3JlZ3NfbGVuKTsKKwor
CSpjcysrID0gTUlfQkFUQ0hfQlVGRkVSX0VORDsKKworCWk5MTVfZ2VtX29iamVjdF9mbHVzaF9t
YXAob2JqKTsKKwlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKG9iaik7CisKKwlvYV9iby0+dm1h
ID0gaTkxNV92bWFfaW5zdGFuY2Uob2JqLAorCQkJCSAgICAgICAmc3RyZWFtLT5lbmdpbmUtPmd0
LT5nZ3R0LT52bSwKKwkJCQkgICAgICAgTlVMTCk7CisJaWYgKElTX0VSUihvYV9iby0+dm1hKSkg
eworCQllcnIgPSBQVFJfRVJSKG9hX2JvLT52bWEpOworCQlnb3RvIGVycl9vYV9ibzsKIAl9CisK
KwlvYV9iby0+b2FfY29uZmlnID0gaTkxNV9vYV9jb25maWdfZ2V0KG9hX2NvbmZpZyk7CisJbGxp
c3RfYWRkKCZvYV9iby0+bm9kZSwgJnN0cmVhbS0+b2FfY29uZmlnX2Jvcyk7CisKKwlyZXR1cm4g
b2FfYm87CisKK2Vycl9vYV9ibzoKKwlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CitlcnJfZnJl
ZToKKwlrZnJlZShvYV9ibyk7CisJcmV0dXJuIEVSUl9QVFIoZXJyKTsKIH0KIAotc3RhdGljIHZv
aWQgZGVsYXlfYWZ0ZXJfbXV4KHZvaWQpCitzdGF0aWMgc3RydWN0IGk5MTVfdm1hICoKK2dldF9v
YV92bWEoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwgc3RydWN0IGk5MTVfb2FfY29u
ZmlnICpvYV9jb25maWcpCiB7CisJc3RydWN0IGk5MTVfb2FfY29uZmlnX2JvICpvYV9ibzsKKwog
CS8qCi0JICogSXQgYXBwYXJlbnRseSB0YWtlcyBhIGZhaXJseSBsb25nIHRpbWUgZm9yIGEgbmV3
IE1VWAotCSAqIGNvbmZpZ3VyYXRpb24gdG8gYmUgYmUgYXBwbGllZCBhZnRlciB0aGVzZSByZWdp
c3RlciB3cml0ZXMuCi0JICogVGhpcyBkZWxheSBkdXJhdGlvbiB3YXMgZGVyaXZlZCBlbXBpcmlj
YWxseSBiYXNlZCBvbiB0aGUKLQkgKiByZW5kZXJfYmFzaWMgY29uZmlnIGJ1dCBob3BlZnVsbHkg
aXQgY292ZXJzIHRoZSBtYXhpbXVtCi0JICogY29uZmlndXJhdGlvbiBsYXRlbmN5LgotCSAqCi0J
ICogQXMgYSBmYWxsYmFjaywgdGhlIGNoZWNrcyBpbiBfYXBwZW5kX29hX3JlcG9ydHMoKSB0byBz
a2lwCi0JICogaW52YWxpZCBPQSByZXBvcnRzIGRvIGFsc28gc2VlbSB0byB3b3JrIHRvIGRpc2Nh
cmQgcmVwb3J0cwotCSAqIGdlbmVyYXRlZCBiZWZvcmUgdGhpcyBjb25maWcgaGFzIGNvbXBsZXRl
ZCAtIGFsYmVpdCBub3QKLQkgKiBzaWxlbnRseS4KLQkgKgotCSAqIFVuZm9ydHVuYXRlbHkgdGhp
cyBpcyBlc3NlbnRpYWxseSBhIG1hZ2ljIG51bWJlciwgc2luY2Ugd2UKLQkgKiBkb24ndCBjdXJy
ZW50bHkga25vdyBvZiBhIHJlbGlhYmxlIG1lY2hhbmlzbSBmb3IgcHJlZGljdGluZwotCSAqIGhv
dyBsb25nIHRoZSBNVVggY29uZmlnIHdpbGwgdGFrZSB0byBhcHBseSBhbmQgYmVzaWRlcwotCSAq
IHNlZWluZyBpbnZhbGlkIHJlcG9ydHMgd2UgZG9uJ3Qga25vdyBvZiBhIHJlbGlhYmxlIHdheSB0
bwotCSAqIGV4cGxpY2l0bHkgY2hlY2sgdGhhdCB0aGUgTVVYIGNvbmZpZyBoYXMgbGFuZGVkLgot
CSAqCi0JICogSXQncyBldmVuIHBvc3NpYmxlIHdlJ3ZlIG1pc3MgY2hhcmFjdGVyaXplZCB0aGUg
dW5kZXJseWluZwotCSAqIHByb2JsZW0gLSBpdCBqdXN0IHNlZW1zIGxpa2UgdGhlIHNpbXBsZXN0
IGV4cGxhbmF0aW9uIHdoeQotCSAqIGEgZGVsYXkgYXQgdGhpcyBsb2NhdGlvbiB3b3VsZCBtaXRp
Z2F0ZSBhbnkgaW52YWxpZCByZXBvcnRzLgorCSAqIExvb2sgZm9yIHRoZSBidWZmZXIgaW4gdGhl
IGFscmVhZHkgYWxsb2NhdGVkIEJPcyBhdHRhY2hlZAorCSAqIHRvIHRoZSBzdHJlYW0uCiAJICov
Ci0JdXNsZWVwX3JhbmdlKDE1MDAwLCAyMDAwMCk7CisJbGxpc3RfZm9yX2VhY2hfZW50cnkob2Ff
Ym8sIHN0cmVhbS0+b2FfY29uZmlnX2Jvcy5maXJzdCwgbm9kZSkgeworCQlpZiAob2FfYm8tPm9h
X2NvbmZpZyA9PSBvYV9jb25maWcgJiYKKwkJICAgIG1lbWNtcChvYV9iby0+b2FfY29uZmlnLT51
dWlkLAorCQkJICAgb2FfY29uZmlnLT51dWlkLAorCQkJICAgc2l6ZW9mKG9hX2NvbmZpZy0+dXVp
ZCkpID09IDApCisJCQlnb3RvIG91dDsKKwl9CisKKwlvYV9ibyA9IGFsbG9jX29hX2NvbmZpZ19i
dWZmZXIoc3RyZWFtLCBvYV9jb25maWcpOworCWlmIChJU19FUlIob2FfYm8pKQorCQlyZXR1cm4g
RVJSX0NBU1Qob2FfYm8pOworCitvdXQ6CisJcmV0dXJuIGk5MTVfdm1hX2dldChvYV9iby0+dm1h
KTsKK30KKworc3RhdGljIGludCBlbWl0X29hX2NvbmZpZyhzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVh
bSAqc3RyZWFtLAorCQkJICBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCit7CisJc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnE7CisJc3RydWN0IGk5MTVfdm1hICp2bWE7CisJaW50IGVycjsKKworCXZt
YSA9IGdldF9vYV92bWEoc3RyZWFtLCBzdHJlYW0tPm9hX2NvbmZpZyk7CisJaWYgKElTX0VSUih2
bWEpKQorCQlyZXR1cm4gUFRSX0VSUih2bWEpOworCisJZXJyID0gaTkxNV92bWFfcGluKHZtYSwg
MCwgMCwgUElOX0dMT0JBTCB8IFBJTl9ISUdIKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl92bWFf
cHV0OworCisJcnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKGNlKTsKKwlpZiAoSVNfRVJSKHJxKSkg
eworCQllcnIgPSBQVFJfRVJSKHJxKTsKKwkJZ290byBlcnJfdm1hX3VucGluOworCX0KKworCWk5
MTVfdm1hX2xvY2sodm1hKTsKKwllcnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfb2JqZWN0KHJxLCB2
bWEtPm9iaiwgMCk7CisJaWYgKCFlcnIpCisJCWVyciA9IGk5MTVfdm1hX21vdmVfdG9fYWN0aXZl
KHZtYSwgcnEsIDApOworCWk5MTVfdm1hX3VubG9jayh2bWEpOworCWlmIChlcnIpCisJCWdvdG8g
ZXJyX2FkZF9yZXF1ZXN0OworCisJZXJyID0gcnEtPmVuZ2luZS0+ZW1pdF9iYl9zdGFydChycSwK
KwkJCQkJdm1hLT5ub2RlLnN0YXJ0LCAwLAorCQkJCQlJOTE1X0RJU1BBVENIX1NFQ1VSRSk7Citl
cnJfYWRkX3JlcXVlc3Q6CisJaTkxNV9yZXF1ZXN0X2FkZChycSk7CitlcnJfdm1hX3VucGluOgor
CWk5MTVfdm1hX3VucGluKHZtYSk7CitlcnJfdm1hX3B1dDoKKwlpOTE1X3ZtYV9wdXQodm1hKTsK
KwlyZXR1cm4gZXJyOwogfQogCiBzdGF0aWMgaW50IGhzd19lbmFibGVfbWV0cmljX3NldChzdHJ1
Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogewogCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVu
Y29yZSA9IHN0cmVhbS0+dW5jb3JlOwotCWNvbnN0IHN0cnVjdCBpOTE1X29hX2NvbmZpZyAqb2Ff
Y29uZmlnID0gc3RyZWFtLT5vYV9jb25maWc7CiAKIAkvKgogCSAqIFBSTToKQEAgLTE3OTcsMTMg
KzE5MjIsNyBAQCBzdGF0aWMgaW50IGhzd19lbmFibGVfbWV0cmljX3NldChzdHJ1Y3QgaTkxNV9w
ZXJmX3N0cmVhbSAqc3RyZWFtKQogCWludGVsX3VuY29yZV9ybXcodW5jb3JlLCBHRU42X1VDR0NU
TDEsCiAJCQkgMCwgR0VONl9DU1VOSVRfQ0xPQ0tfR0FURV9ESVNBQkxFKTsKIAotCWNvbmZpZ19v
YV9yZWdzKHVuY29yZSwgb2FfY29uZmlnLT5tdXhfcmVncywgb2FfY29uZmlnLT5tdXhfcmVnc19s
ZW4pOwotCWRlbGF5X2FmdGVyX211eCgpOwotCi0JY29uZmlnX29hX3JlZ3ModW5jb3JlLCBvYV9j
b25maWctPmJfY291bnRlcl9yZWdzLAotCQkgICAgICAgb2FfY29uZmlnLT5iX2NvdW50ZXJfcmVn
c19sZW4pOwotCi0JcmV0dXJuIDA7CisJcmV0dXJuIGVtaXRfb2FfY29uZmlnKHN0cmVhbSwgc3Ry
ZWFtLT5lbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKIH0KIAogc3RhdGljIHZvaWQgaHN3X2Rpc2Fi
bGVfbWV0cmljX3NldChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQpAQCAtMjE2Nywx
MyArMjI4Niw3IEBAIHN0YXRpYyBpbnQgZ2VuOF9lbmFibGVfbWV0cmljX3NldChzdHJ1Y3QgaTkx
NV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQljb25m
aWdfb2FfcmVncyh1bmNvcmUsIG9hX2NvbmZpZy0+bXV4X3JlZ3MsIG9hX2NvbmZpZy0+bXV4X3Jl
Z3NfbGVuKTsKLQlkZWxheV9hZnRlcl9tdXgoKTsKLQotCWNvbmZpZ19vYV9yZWdzKHVuY29yZSwg
b2FfY29uZmlnLT5iX2NvdW50ZXJfcmVncywKLQkJICAgICAgIG9hX2NvbmZpZy0+Yl9jb3VudGVy
X3JlZ3NfbGVuKTsKLQotCXJldHVybiAwOworCXJldHVybiBlbWl0X29hX2NvbmZpZyhzdHJlYW0s
IHN0cmVhbS0+ZW5naW5lLT5rZXJuZWxfY29udGV4dCk7CiB9CiAKIHN0YXRpYyB2b2lkIGdlbjhf
ZGlzYWJsZV9tZXRyaWNfc2V0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCi0tIAoy
LjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCklu
dGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 596A86ABC9
	for <lists+intel-gfx@lfdr.de>; Tue, 16 Jul 2019 17:30:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A193989BE8;
	Tue, 16 Jul 2019 15:30:21 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga02.intel.com (mga02.intel.com [134.134.136.20])
 by gabe.freedesktop.org (Postfix) with ESMTPS id ED14589BE8
 for <intel-gfx@lists.freedesktop.org>; Tue, 16 Jul 2019 15:30:19 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga002.fm.intel.com ([10.253.24.26])
 by orsmga101.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 16 Jul 2019 08:30:14 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,498,1557212400"; d="scan'208";a="194921739"
Received: from unknown (HELO abj-mbp2.local) ([10.249.254.172])
 by fmsmga002.fm.intel.com with ESMTP; 16 Jul 2019 08:30:11 -0700
To: Chris Wilson <chris@chris-wilson.co.uk>, intel-gfx@lists.freedesktop.org
References: <20190712112725.2892-1-chris@chris-wilson.co.uk>
 <20190712112725.2892-5-chris@chris-wilson.co.uk>
From: Abdiel Janulgue <abdiel.janulgue@linux.intel.com>
Message-ID: <8289218a-dfe9-1c88-be56-33092ac0a2e6@linux.intel.com>
Date: Tue, 16 Jul 2019 18:30:09 +0300
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:60.0)
 Gecko/20100101 Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <20190712112725.2892-5-chris@chris-wilson.co.uk>
Content-Language: en-US
Subject: Re: [Intel-gfx] [PATCH 4/4] drm/i915/gtt: Tidy up ppgtt insertion
 for gen8
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

CgpPbiAxMi8wNy8yMDE5IDE0LjI3LCBDaHJpcyBXaWxzb24gd3JvdGU6Cj4gQXBwbHkgdGhlIG5l
dyByYWRpeCBzaGlmdCBoZWxwZXJzIHRvIGV4dHJhY3QgdGhlIG11bHRpLWxldmVsIGluZGljZXMK
PiBjbGVhbmx5IHdoZW4gaW5zZXJ0aW5nIHB0ZSBpbnRvIHRoZSBndHQgdHJlZS4KPiAKUmV2aWV3
ZWQtYnk6IEFiZGllbCBKYW51bGd1ZSA8YWJkaWVsLmphbnVsZ3VlQGxpbnV4LmludGVsLmNvbT4K
Cj4gU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+
Cj4gLS0tCj4gIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jIHwgMTE1ICsrKysr
KysrKysrLS0tLS0tLS0tLS0tLS0tLS0KPiAgZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1f
Z3R0LmggfCAgOTAgKystLS0tLS0tLS0tLS0tLS0tLS0tLQo+ICAyIGZpbGVzIGNoYW5nZWQsIDQ4
IGluc2VydGlvbnMoKyksIDE1NyBkZWxldGlvbnMoLSkKPiAKPiBkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2dlbV9ndHQuYwo+IGluZGV4IDcyZTBmOTc5OWE0Ni4uZGU3OGRjOGM0MjVjIDEwMDY0NAo+IC0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCj4gKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKPiBAQCAtMTEzMSw0NyArMTEzMSwyOCBAQCBzdGF0
aWMgaW5saW5lIHN0cnVjdCBzZ3RfZG1hIHsKPiAgCXJldHVybiAoc3RydWN0IHNndF9kbWEpIHsg
c2csIGFkZHIsIGFkZHIgKyBzZy0+bGVuZ3RoIH07Cj4gIH0KPiAgCj4gLXN0cnVjdCBnZW44X2lu
c2VydF9wdGUgewo+IC0JdTE2IHBtbDRlOwo+IC0JdTE2IHBkcGU7Cj4gLQl1MTYgcGRlOwo+IC0J
dTE2IHB0ZTsKPiAtfTsKPiAtCj4gLXN0YXRpYyBfX2Fsd2F5c19pbmxpbmUgc3RydWN0IGdlbjhf
aW5zZXJ0X3B0ZSBnZW44X2luc2VydF9wdGUodTY0IHN0YXJ0KQo+IC17Cj4gLQlyZXR1cm4gKHN0
cnVjdCBnZW44X2luc2VydF9wdGUpIHsKPiAtCQkgZ2VuOF9wbWw0ZV9pbmRleChzdGFydCksCj4g
LQkJIGdlbjhfcGRwZV9pbmRleChzdGFydCksCj4gLQkJIGdlbjhfcGRlX2luZGV4KHN0YXJ0KSwK
PiAtCQkgZ2VuOF9wdGVfaW5kZXgoc3RhcnQpLAo+IC0JfTsKPiAtfQo+IC0KPiAtc3RhdGljIF9f
YWx3YXlzX2lubGluZSBib29sCj4gK3N0YXRpYyBfX2Fsd2F5c19pbmxpbmUgdTY0Cj4gIGdlbjhf
cHBndHRfaW5zZXJ0X3B0ZV9lbnRyaWVzKHN0cnVjdCBpOTE1X3BwZ3R0ICpwcGd0dCwKPiAgCQkJ
ICAgICAgc3RydWN0IGk5MTVfcGFnZV9kaXJlY3RvcnkgKnBkcCwKPiAgCQkJICAgICAgc3RydWN0
IHNndF9kbWEgKml0ZXIsCj4gLQkJCSAgICAgIHN0cnVjdCBnZW44X2luc2VydF9wdGUgKmlkeCwK
PiArCQkJICAgICAgdTY0IGlkeCwKPiAgCQkJICAgICAgZW51bSBpOTE1X2NhY2hlX2xldmVsIGNh
Y2hlX2xldmVsLAo+ICAJCQkgICAgICB1MzIgZmxhZ3MpCj4gIHsKPiAgCXN0cnVjdCBpOTE1X3Bh
Z2VfZGlyZWN0b3J5ICpwZDsKPiAgCWNvbnN0IGdlbjhfcHRlX3QgcHRlX2VuY29kZSA9IGdlbjhf
cHRlX2VuY29kZSgwLCBjYWNoZV9sZXZlbCwgZmxhZ3MpOwo+ICAJZ2VuOF9wdGVfdCAqdmFkZHI7
Cj4gLQlib29sIHJldDsKPiAgCj4gLQlHRU1fQlVHX09OKGlkeC0+cGRwZSA+PSBpOTE1X3BkcGVz
X3Blcl9wZHAoJnBwZ3R0LT52bSkpOwo+IC0JcGQgPSBpOTE1X3BkX2VudHJ5KHBkcCwgaWR4LT5w
ZHBlKTsKPiAtCXZhZGRyID0ga21hcF9hdG9taWNfcHgoaTkxNV9wdF9lbnRyeShwZCwgaWR4LT5w
ZGUpKTsKPiArCXBkID0gaTkxNV9wZF9lbnRyeShwZHAsIGdlbjhfcGRfaW5kZXgoaWR4LCAyKSk7
Cj4gKwl2YWRkciA9IGttYXBfYXRvbWljX3B4KGk5MTVfcHRfZW50cnkocGQsIGdlbjhfcGRfaW5k
ZXgoaWR4LCAxKSkpOwo+ICAJZG8gewo+IC0JCXZhZGRyW2lkeC0+cHRlXSA9IHB0ZV9lbmNvZGUg
fCBpdGVyLT5kbWE7Cj4gKwkJdmFkZHJbZ2VuOF9wZF9pbmRleChpZHgsIDApXSA9IHB0ZV9lbmNv
ZGUgfCBpdGVyLT5kbWE7Cj4gIAo+ICAJCWl0ZXItPmRtYSArPSBJOTE1X0dUVF9QQUdFX1NJWkU7
Cj4gIAkJaWYgKGl0ZXItPmRtYSA+PSBpdGVyLT5tYXgpIHsKPiAgCQkJaXRlci0+c2cgPSBfX3Nn
X25leHQoaXRlci0+c2cpOwo+ICAJCQlpZiAoIWl0ZXItPnNnKSB7Cj4gLQkJCQlyZXQgPSBmYWxz
ZTsKPiArCQkJCWlkeCA9IDA7Cj4gIAkJCQlicmVhazsKPiAgCQkJfQo+ICAKPiBAQCAtMTE3OSwz
MCArMTE2MCwyMiBAQCBnZW44X3BwZ3R0X2luc2VydF9wdGVfZW50cmllcyhzdHJ1Y3QgaTkxNV9w
cGd0dCAqcHBndHQsCj4gIAkJCWl0ZXItPm1heCA9IGl0ZXItPmRtYSArIGl0ZXItPnNnLT5sZW5n
dGg7Cj4gIAkJfQo+ICAKPiAtCQlpZiAoKytpZHgtPnB0ZSA9PSBHRU44X1BURVMpIHsKPiAtCQkJ
aWR4LT5wdGUgPSAwOwo+IC0KPiAtCQkJaWYgKCsraWR4LT5wZGUgPT0gSTkxNV9QREVTKSB7Cj4g
LQkJCQlpZHgtPnBkZSA9IDA7Cj4gLQo+ICsJCWlmIChnZW44X3BkX2luZGV4KCsraWR4LCAwKSA9
PSAwKSB7Cj4gKwkJCWlmIChnZW44X3BkX2luZGV4KGlkeCwgMSkgPT0gMCkgewo+ICAJCQkJLyog
TGltaXRlZCBieSBzZyBsZW5ndGggZm9yIDNsdmwgKi8KPiAtCQkJCWlmICgrK2lkeC0+cGRwZSA9
PSBHRU44X1BNTDRFU19QRVJfUE1MNCkgewo+IC0JCQkJCWlkeC0+cGRwZSA9IDA7Cj4gLQkJCQkJ
cmV0ID0gdHJ1ZTsKPiArCQkJCWlmIChnZW44X3BkX2luZGV4KGlkeCwgMikgPT0gMCkKPiAgCQkJ
CQlicmVhazsKPiAtCQkJCX0KPiAgCj4gLQkJCQlHRU1fQlVHX09OKGlkeC0+cGRwZSA+PSBpOTE1
X3BkcGVzX3Blcl9wZHAoJnBwZ3R0LT52bSkpOwo+IC0JCQkJcGQgPSBwZHAtPmVudHJ5W2lkeC0+
cGRwZV07Cj4gKwkJCQlwZCA9IHBkcC0+ZW50cnlbZ2VuOF9wZF9pbmRleChpZHgsIDIpXTsKPiAg
CQkJfQo+ICAKPiAgCQkJa3VubWFwX2F0b21pYyh2YWRkcik7Cj4gLQkJCXZhZGRyID0ga21hcF9h
dG9taWNfcHgoaTkxNV9wdF9lbnRyeShwZCwgaWR4LT5wZGUpKTsKPiArCQkJdmFkZHIgPSBrbWFw
X2F0b21pY19weChpOTE1X3B0X2VudHJ5KHBkLCBnZW44X3BkX2luZGV4KGlkeCwgMSkpKTsKPiAg
CQl9Cj4gIAl9IHdoaWxlICgxKTsKPiAgCWt1bm1hcF9hdG9taWModmFkZHIpOwo+ICAKPiAtCXJl
dHVybiByZXQ7Cj4gKwlyZXR1cm4gaWR4Owo+ICB9Cj4gIAo+ICBzdGF0aWMgdm9pZCBnZW44X3Bw
Z3R0X2luc2VydF8zbHZsKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAo+IEBAIC0xMjEy
LDkgKzExODUsOSBAQCBzdGF0aWMgdm9pZCBnZW44X3BwZ3R0X2luc2VydF8zbHZsKHN0cnVjdCBp
OTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAo+ICB7Cj4gIAlzdHJ1Y3QgaTkxNV9wcGd0dCAqcHBndHQg
PSBpOTE1X3ZtX3RvX3BwZ3R0KHZtKTsKPiAgCXN0cnVjdCBzZ3RfZG1hIGl0ZXIgPSBzZ3RfZG1h
KHZtYSk7Cj4gLQlzdHJ1Y3QgZ2VuOF9pbnNlcnRfcHRlIGlkeCA9IGdlbjhfaW5zZXJ0X3B0ZSh2
bWEtPm5vZGUuc3RhcnQpOwo+ICAKPiAtCWdlbjhfcHBndHRfaW5zZXJ0X3B0ZV9lbnRyaWVzKHBw
Z3R0LCBwcGd0dC0+cGQsICZpdGVyLCAmaWR4LAo+ICsJZ2VuOF9wcGd0dF9pbnNlcnRfcHRlX2Vu
dHJpZXMocHBndHQsIHBwZ3R0LT5wZCwgJml0ZXIsCj4gKwkJCQkgICAgICB2bWEtPm5vZGUuc3Rh
cnQgPj4gR0VOOF9QVEVfU0hJRlQsCj4gIAkJCQkgICAgICBjYWNoZV9sZXZlbCwgZmxhZ3MpOwo+
ICAKPiAgCXZtYS0+cGFnZV9zaXplcy5ndHQgPSBJOTE1X0dUVF9QQUdFX1NJWkU7Cj4gQEAgLTEy
MzEsMzkgKzEyMDQsMzggQEAgc3RhdGljIHZvaWQgZ2VuOF9wcGd0dF9pbnNlcnRfaHVnZV9lbnRy
aWVzKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAo+ICAJZG1hX2FkZHJfdCByZW0gPSBpdGVyLT5zZy0+
bGVuZ3RoOwo+ICAKPiAgCWRvIHsKPiAtCQlzdHJ1Y3QgZ2VuOF9pbnNlcnRfcHRlIGlkeCA9IGdl
bjhfaW5zZXJ0X3B0ZShzdGFydCk7Cj4gIAkJc3RydWN0IGk5MTVfcGFnZV9kaXJlY3RvcnkgKnBk
cCA9Cj4gLQkJCWk5MTVfcGRwX2VudHJ5KHBtbDQsIGlkeC5wbWw0ZSk7Cj4gLQkJc3RydWN0IGk5
MTVfcGFnZV9kaXJlY3RvcnkgKnBkID0gaTkxNV9wZF9lbnRyeShwZHAsIGlkeC5wZHBlKTsKPiAt
CQl1bnNpZ25lZCBpbnQgcGFnZV9zaXplOwo+IC0JCWJvb2wgbWF5YmVfNjRLID0gZmFsc2U7Cj4g
KwkJCWk5MTVfcGRfZW50cnkocG1sNCwgX19nZW44X3B0ZV9pbmRleChzdGFydCwgMykpOwo+ICsJ
CXN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICpwZCA9Cj4gKwkJCWk5MTVfcGRfZW50cnkocGRw
LCBfX2dlbjhfcHRlX2luZGV4KHN0YXJ0LCAyKSk7Cj4gIAkJZ2VuOF9wdGVfdCBlbmNvZGUgPSBw
dGVfZW5jb2RlOwo+ICsJCXVuc2lnbmVkIGludCBtYXliZV82NEsgPSAtMTsKPiArCQl1bnNpZ25l
ZCBpbnQgcGFnZV9zaXplOwo+ICAJCWdlbjhfcHRlX3QgKnZhZGRyOwo+IC0JCXUxNiBpbmRleCwg
bWF4Owo+ICsJCXUxNiBpbmRleDsKPiAgCj4gIAkJaWYgKHZtYS0+cGFnZV9zaXplcy5zZyAmIEk5
MTVfR1RUX1BBR0VfU0laRV8yTSAmJgo+ICAJCSAgICBJU19BTElHTkVEKGl0ZXItPmRtYSwgSTkx
NV9HVFRfUEFHRV9TSVpFXzJNKSAmJgo+IC0JCSAgICByZW0gPj0gSTkxNV9HVFRfUEFHRV9TSVpF
XzJNICYmICFpZHgucHRlKSB7Cj4gLQkJCWluZGV4ID0gaWR4LnBkZTsKPiAtCQkJbWF4ID0gSTkx
NV9QREVTOwo+IC0JCQlwYWdlX3NpemUgPSBJOTE1X0dUVF9QQUdFX1NJWkVfMk07Cj4gLQo+ICsJ
CSAgICByZW0gPj0gSTkxNV9HVFRfUEFHRV9TSVpFXzJNICYmCj4gKwkJICAgICFfX2dlbjhfcHRl
X2luZGV4KHN0YXJ0LCAwKSkgewo+ICsJCQlpbmRleCA9IF9fZ2VuOF9wdGVfaW5kZXgoc3RhcnQs
IDEpOwo+ICAJCQllbmNvZGUgfD0gR0VOOF9QREVfUFNfMk07Cj4gKwkJCXBhZ2Vfc2l6ZSA9IEk5
MTVfR1RUX1BBR0VfU0laRV8yTTsKPiAgCj4gIAkJCXZhZGRyID0ga21hcF9hdG9taWNfcHgocGQp
Owo+ICAJCX0gZWxzZSB7Cj4gLQkJCXN0cnVjdCBpOTE1X3BhZ2VfdGFibGUgKnB0ID0gaTkxNV9w
dF9lbnRyeShwZCwgaWR4LnBkZSk7Cj4gKwkJCXN0cnVjdCBpOTE1X3BhZ2VfdGFibGUgKnB0ID0K
PiArCQkJCWk5MTVfcHRfZW50cnkocGQsIF9fZ2VuOF9wdGVfaW5kZXgoc3RhcnQsIDEpKTsKPiAg
Cj4gLQkJCWluZGV4ID0gaWR4LnB0ZTsKPiAtCQkJbWF4ID0gR0VOOF9QVEVTOwo+ICsJCQlpbmRl
eCA9IF9fZ2VuOF9wdGVfaW5kZXgoc3RhcnQsIDApOwo+ICAJCQlwYWdlX3NpemUgPSBJOTE1X0dU
VF9QQUdFX1NJWkU7Cj4gIAo+ICAJCQlpZiAoIWluZGV4ICYmCj4gIAkJCSAgICB2bWEtPnBhZ2Vf
c2l6ZXMuc2cgJiBJOTE1X0dUVF9QQUdFX1NJWkVfNjRLICYmCj4gIAkJCSAgICBJU19BTElHTkVE
KGl0ZXItPmRtYSwgSTkxNV9HVFRfUEFHRV9TSVpFXzY0SykgJiYKPiAgCQkJICAgIChJU19BTElH
TkVEKHJlbSwgSTkxNV9HVFRfUEFHRV9TSVpFXzY0SykgfHwKPiAtCQkJICAgICByZW0gPj0gKG1h
eCAtIGluZGV4KSAqIEk5MTVfR1RUX1BBR0VfU0laRSkpCj4gLQkJCQltYXliZV82NEsgPSB0cnVl
Owo+ICsJCQkgICAgIHJlbSA+PSAoSTkxNV9QREVTIC0gaW5kZXgpICogSTkxNV9HVFRfUEFHRV9T
SVpFKSkKPiArCQkJCW1heWJlXzY0SyA9IF9fZ2VuOF9wdGVfaW5kZXgoc3RhcnQsIDEpOwo+ICAK
PiAgCQkJdmFkZHIgPSBrbWFwX2F0b21pY19weChwdCk7Cj4gIAkJfQo+IEBAIC0xMjg0LDE2ICsx
MjU2LDE2IEBAIHN0YXRpYyB2b2lkIGdlbjhfcHBndHRfaW5zZXJ0X2h1Z2VfZW50cmllcyhzdHJ1
Y3QgaTkxNV92bWEgKnZtYSwKPiAgCQkJCWl0ZXItPmRtYSA9IHNnX2RtYV9hZGRyZXNzKGl0ZXIt
PnNnKTsKPiAgCQkJCWl0ZXItPm1heCA9IGl0ZXItPmRtYSArIHJlbTsKPiAgCj4gLQkJCQlpZiAo
bWF5YmVfNjRLICYmIGluZGV4IDwgbWF4ICYmCj4gKwkJCQlpZiAobWF5YmVfNjRLICE9IC0xICYm
IGluZGV4IDwgSTkxNV9QREVTICYmCj4gIAkJCQkgICAgIShJU19BTElHTkVEKGl0ZXItPmRtYSwg
STkxNV9HVFRfUEFHRV9TSVpFXzY0SykgJiYKPiAgCQkJCSAgICAgIChJU19BTElHTkVEKHJlbSwg
STkxNV9HVFRfUEFHRV9TSVpFXzY0SykgfHwKPiAtCQkJCSAgICAgICByZW0gPj0gKG1heCAtIGlu
ZGV4KSAqIEk5MTVfR1RUX1BBR0VfU0laRSkpKQo+IC0JCQkJCW1heWJlXzY0SyA9IGZhbHNlOwo+
ICsJCQkJICAgICAgIHJlbSA+PSAoSTkxNV9QREVTIC0gaW5kZXgpICogSTkxNV9HVFRfUEFHRV9T
SVpFKSkpCj4gKwkJCQkJbWF5YmVfNjRLID0gLTE7Cj4gIAo+ICAJCQkJaWYgKHVubGlrZWx5KCFJ
U19BTElHTkVEKGl0ZXItPmRtYSwgcGFnZV9zaXplKSkpCj4gIAkJCQkJYnJlYWs7Cj4gIAkJCX0K
PiAtCQl9IHdoaWxlIChyZW0gPj0gcGFnZV9zaXplICYmIGluZGV4IDwgbWF4KTsKPiArCQl9IHdo
aWxlIChyZW0gPj0gcGFnZV9zaXplICYmIGluZGV4IDwgSTkxNV9QREVTKTsKPiAgCj4gIAkJa3Vu
bWFwX2F0b21pYyh2YWRkcik7Cj4gIAo+IEBAIC0xMzAzLDE0ICsxMjc1LDE0IEBAIHN0YXRpYyB2
b2lkIGdlbjhfcHBndHRfaW5zZXJ0X2h1Z2VfZW50cmllcyhzdHJ1Y3QgaTkxNV92bWEgKnZtYSwK
PiAgCQkgKiBpdCBhbmQgaGF2ZSByZWFjaGVkIHRoZSBlbmQgb2YgdGhlIHNnIHRhYmxlIGFuZCB3
ZSBoYXZlCj4gIAkJICogZW5vdWdoIHBhZGRpbmcuCj4gIAkJICovCj4gLQkJaWYgKG1heWJlXzY0
SyAmJgo+IC0JCSAgICAoaW5kZXggPT0gbWF4IHx8Cj4gKwkJaWYgKG1heWJlXzY0SyAhPSAtMSAm
Jgo+ICsJCSAgICAoaW5kZXggPT0gSTkxNV9QREVTIHx8Cj4gIAkJICAgICAoaTkxNV92bV9oYXNf
c2NyYXRjaF82NEsodm1hLT52bSkgJiYKPiAgCQkgICAgICAhaXRlci0+c2cgJiYgSVNfQUxJR05F
RCh2bWEtPm5vZGUuc3RhcnQgKwo+ICAJCQkJCSAgICAgIHZtYS0+bm9kZS5zaXplLAo+ICAJCQkJ
CSAgICAgIEk5MTVfR1RUX1BBR0VfU0laRV8yTSkpKSkgewo+ICAJCQl2YWRkciA9IGttYXBfYXRv
bWljX3B4KHBkKTsKPiAtCQkJdmFkZHJbaWR4LnBkZV0gfD0gR0VOOF9QREVfSVBTXzY0SzsKPiAr
CQkJdmFkZHJbbWF5YmVfNjRLXSB8PSBHRU44X1BERV9JUFNfNjRLOwo+ICAJCQlrdW5tYXBfYXRv
bWljKHZhZGRyKTsKPiAgCQkJcGFnZV9zaXplID0gSTkxNV9HVFRfUEFHRV9TSVpFXzY0SzsKPiAg
Cj4gQEAgLTEzMjcsOCArMTI5OSw3IEBAIHN0YXRpYyB2b2lkIGdlbjhfcHBndHRfaW5zZXJ0X2h1
Z2VfZW50cmllcyhzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKPiAgCQkJCXUxNiBpOwo+ICAKPiAgCQkJ
CWVuY29kZSA9IHZtYS0+dm0tPnNjcmF0Y2hbMF0uZW5jb2RlOwo+IC0JCQkJdmFkZHIgPSBrbWFw
X2F0b21pY19weChpOTE1X3B0X2VudHJ5KHBkLAo+IC0JCQkJCQkJCSAgICAgaWR4LnBkZSkpOwo+
ICsJCQkJdmFkZHIgPSBrbWFwX2F0b21pY19weChpOTE1X3B0X2VudHJ5KHBkLCBtYXliZV82NEsp
KTsKPiAgCj4gIAkJCQlmb3IgKGkgPSAxOyBpIDwgaW5kZXg7IGkgKz0gMTYpCj4gIAkJCQkJbWVt
c2V0NjQodmFkZHIgKyBpLCBlbmNvZGUsIDE1KTsKPiBAQCAtMTM1NCwxMyArMTMyNSwxMyBAQCBz
dGF0aWMgdm9pZCBnZW44X3BwZ3R0X2luc2VydF80bHZsKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3Bh
Y2UgKnZtLAo+ICAJCWdlbjhfcHBndHRfaW5zZXJ0X2h1Z2VfZW50cmllcyh2bWEsIHBtbDQsICZp
dGVyLCBjYWNoZV9sZXZlbCwKPiAgCQkJCQkgICAgICAgZmxhZ3MpOwo+ICAJfSBlbHNlIHsKPiAt
CQlzdHJ1Y3QgZ2VuOF9pbnNlcnRfcHRlIGlkeCA9IGdlbjhfaW5zZXJ0X3B0ZSh2bWEtPm5vZGUu
c3RhcnQpOwo+ICsJCXU2NCBpZHggPSB2bWEtPm5vZGUuc3RhcnQgPj4gR0VOOF9QVEVfU0hJRlQ7
Cj4gIAo+IC0JCXdoaWxlIChnZW44X3BwZ3R0X2luc2VydF9wdGVfZW50cmllcyhwcGd0dCwKPiAt
CQkJCQkJICAgICBpOTE1X3BkcF9lbnRyeShwbWw0LCBpZHgucG1sNGUrKyksCj4gLQkJCQkJCSAg
ICAgJml0ZXIsICZpZHgsIGNhY2hlX2xldmVsLAo+IC0JCQkJCQkgICAgIGZsYWdzKSkKPiAtCQkJ
R0VNX0JVR19PTihpZHgucG1sNGUgPj0gR0VOOF9QTUw0RVNfUEVSX1BNTDQpOwo+ICsJCXdoaWxl
ICgoaWR4ID0gZ2VuOF9wcGd0dF9pbnNlcnRfcHRlX2VudHJpZXMocHBndHQsCj4gKwkJCQkJCQkg
ICAgaTkxNV9wZF9lbnRyeShwbWw0LCBnZW44X3BkX2luZGV4KGlkeCwgMykpLAo+ICsJCQkJCQkJ
ICAgICZpdGVyLCBpZHgsIGNhY2hlX2xldmVsLAo+ICsJCQkJCQkJICAgIGZsYWdzKSkpCj4gKwkJ
CTsKPiAgCj4gIAkJdm1hLT5wYWdlX3NpemVzLmd0dCA9IEk5MTVfR1RUX1BBR0VfU0laRTsKPiAg
CX0KPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaAo+IGluZGV4IGFlYTlhNzA4NDQxNC4u
NmQ2ZTFmNDAxNWI5IDEwMDY0NAo+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2Vt
X2d0dC5oCj4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmgKPiBAQCAt
MTE1LDI5ICsxMTUsMTggQEAgdHlwZWRlZiB1NjQgZ2VuOF9wdGVfdDsKPiAgI2RlZmluZSBIU1df
R1RUX0FERFJfRU5DT0RFKGFkZHIpCSgoYWRkcikgfCAoKChhZGRyKSA+PiAyOCkgJiAweDdmMCkp
Cj4gICNkZWZpbmUgSFNXX1BURV9BRERSX0VOQ09ERShhZGRyKQlIU1dfR1RUX0FERFJfRU5DT0RF
KGFkZHIpCj4gIAo+IC0vKiBHRU44IDMyYiBzdHlsZSBhZGRyZXNzIGlzIGRlZmluZWQgYXMgYSAz
IGxldmVsIHBhZ2UgdGFibGU6Cj4gKy8qCj4gKyAqIEdFTjggMzJiIHN0eWxlIGFkZHJlc3MgaXMg
ZGVmaW5lZCBhcyBhIDMgbGV2ZWwgcGFnZSB0YWJsZToKPiAgICogMzE6MzAgfCAyOToyMSB8IDIw
OjEyIHwgIDExOjAKPiAgICogUERQRSAgfCAgUERFICB8ICBQVEUgIHwgb2Zmc2V0Cj4gICAqIFRo
ZSBkaWZmZXJlbmNlIGFzIGNvbXBhcmVkIHRvIG5vcm1hbCB4ODYgMyBsZXZlbCBwYWdlIHRhYmxl
IGlzIHRoZSBQRFBFcyBhcmUKPiAgICogcHJvZ3JhbW1lZCB2aWEgcmVnaXN0ZXIuCj4gLSAqLwo+
IC0jZGVmaW5lIEdFTjhfM0xWTF9QRFBFUwkJCTQKPiAtI2RlZmluZSBHRU44X1BERV9TSElGVAkJ
CTIxCj4gLSNkZWZpbmUgR0VOOF9QREVfTUFTSwkJCTB4MWZmCj4gLSNkZWZpbmUgR0VOOF9QVEVf
TUFTSwkJCTB4MWZmCj4gLSNkZWZpbmUgR0VOOF9QVEVTCQkJSTkxNV9QVEVTKHNpemVvZihnZW44
X3B0ZV90KSkKPiAtCj4gLS8qIEdFTjggNDhiIHN0eWxlIGFkZHJlc3MgaXMgZGVmaW5lZCBhcyBh
IDQgbGV2ZWwgcGFnZSB0YWJsZToKPiArICoKPiArICogR0VOOCA0OGIgc3R5bGUgYWRkcmVzcyBp
cyBkZWZpbmVkIGFzIGEgNCBsZXZlbCBwYWdlIHRhYmxlOgo+ICAgKiA0NzozOSB8IDM4OjMwIHwg
Mjk6MjEgfCAyMDoxMiB8ICAxMTowCj4gICAqIFBNTDRFIHwgUERQRSAgfCAgUERFICB8ICBQVEUg
IHwgb2Zmc2V0Cj4gICAqLwo+IC0jZGVmaW5lIEdFTjhfUE1MNEVTX1BFUl9QTUw0CQk1MTIKPiAt
I2RlZmluZSBHRU44X1BNTDRFX1NISUZUCQkzOQo+IC0jZGVmaW5lIEdFTjhfUE1MNEVfTUFTSwkJ
CShHRU44X1BNTDRFU19QRVJfUE1MNCAtIDEpCj4gLSNkZWZpbmUgR0VOOF9QRFBFX1NISUZUCQkJ
MzAKPiAtLyogTkI6IEdFTjhfUERQRV9NQVNLIGlzIHVudHJ1ZSBmb3IgMzJiIHBsYXRmb3Jtcywg
YnV0IGl0IGhhcyBubyBpbXBhY3Qgb24gMzJiIHBhZ2UKPiAtICogdGFibGVzICovCj4gLSNkZWZp
bmUgR0VOOF9QRFBFX01BU0sJCQkweDFmZgo+ICsjZGVmaW5lIEdFTjhfM0xWTF9QRFBFUwkJCTQK
PiAgCj4gICNkZWZpbmUgUFBBVF9VTkNBQ0hFRAkJCShfUEFHRV9QV1QgfCBfUEFHRV9QQ0QpCj4g
ICNkZWZpbmUgUFBBVF9DQUNIRURfUERFCQkJMCAvKiBXQiBMTEMgKi8KPiBAQCAtNTIxLDE1ICs1
MTAsNiBAQCBzdGF0aWMgaW5saW5lIHUzMiBnZW42X3BkZV9pbmRleCh1MzIgYWRkcikKPiAgCXJl
dHVybiBpOTE1X3BkZV9pbmRleChhZGRyLCBHRU42X1BERV9TSElGVCk7Cj4gIH0KPiAgCj4gLXN0
YXRpYyBpbmxpbmUgdW5zaWduZWQgaW50Cj4gLWk5MTVfcGRwZXNfcGVyX3BkcChjb25zdCBzdHJ1
Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKPiAtewo+IC0JaWYgKGk5MTVfdm1faXNfNGx2bCh2
bSkpCj4gLQkJcmV0dXJuIEdFTjhfUE1MNEVTX1BFUl9QTUw0Owo+IC0KPiAtCXJldHVybiBHRU44
XzNMVkxfUERQRVM7Cj4gLX0KPiAtCj4gIHN0YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVfcGFnZV90
YWJsZSAqCj4gIGk5MTVfcHRfZW50cnkoY29uc3Qgc3RydWN0IGk5MTVfcGFnZV9kaXJlY3Rvcnkg
KiBjb25zdCBwZCwKPiAgCSAgICAgIGNvbnN0IHVuc2lnbmVkIHNob3J0IG4pCj4gQEAgLTU0NCw2
NiArNTI0LDYgQEAgaTkxNV9wZF9lbnRyeShjb25zdCBzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVjdG9y
eSAqIGNvbnN0IHBkcCwKPiAgCXJldHVybiBwZHAtPmVudHJ5W25dOwo+ICB9Cj4gIAo+IC1zdGF0
aWMgaW5saW5lIHN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICoKPiAtaTkxNV9wZHBfZW50cnko
Y29uc3Qgc3RydWN0IGk5MTVfcGFnZV9kaXJlY3RvcnkgKiBjb25zdCBwbWw0LAo+IC0JICAgICAg
IGNvbnN0IHVuc2lnbmVkIHNob3J0IG4pCj4gLXsKPiAtCXJldHVybiBwbWw0LT5lbnRyeVtuXTsK
PiAtfQo+IC0KPiAtLyogRXF1aXZhbGVudCB0byB0aGUgZ2VuNiB2ZXJzaW9uLCBGb3IgZWFjaCBw
ZGUgaXRlcmF0ZXMgb3ZlciBldmVyeSBwZGUKPiAtICogYmV0d2VlbiBmcm9tIHN0YXJ0IHVudGls
IHN0YXJ0ICsgbGVuZ3RoLiBPbiBnZW44KyBpdCBzaW1wbHkgaXRlcmF0ZXMKPiAtICogb3ZlciBl
dmVyeSBwYWdlIGRpcmVjdG9yeSBlbnRyeSBpbiBhIHBhZ2UgZGlyZWN0b3J5Lgo+IC0gKi8KPiAt
I2RlZmluZSBnZW44X2Zvcl9lYWNoX3BkZShwdCwgcGQsIHN0YXJ0LCBsZW5ndGgsIGl0ZXIpCQkJ
XAo+IC0JZm9yIChpdGVyID0gZ2VuOF9wZGVfaW5kZXgoc3RhcnQpOwkJCQlcCj4gLQkgICAgIGxl
bmd0aCA+IDAgJiYgaXRlciA8IEk5MTVfUERFUyAmJgkJCQlcCj4gLQkJICAgICAocHQgPSBpOTE1
X3B0X2VudHJ5KHBkLCBpdGVyKSwgdHJ1ZSk7CQlcCj4gLQkgICAgICh7IHU2NCB0ZW1wID0gQUxJ
R04oc3RhcnQrMSwgMSA8PCBHRU44X1BERV9TSElGVCk7CQlcCj4gLQkJICAgIHRlbXAgPSBtaW4o
dGVtcCAtIHN0YXJ0LCBsZW5ndGgpOwkJCVwKPiAtCQkgICAgc3RhcnQgKz0gdGVtcCwgbGVuZ3Ro
IC09IHRlbXA7IH0pLCArK2l0ZXIpCj4gLQo+IC0jZGVmaW5lIGdlbjhfZm9yX2VhY2hfcGRwZShw
ZCwgcGRwLCBzdGFydCwgbGVuZ3RoLCBpdGVyKQkJXAo+IC0JZm9yIChpdGVyID0gZ2VuOF9wZHBl
X2luZGV4KHN0YXJ0KTsJCQkJXAo+IC0JICAgICBsZW5ndGggPiAwICYmIGl0ZXIgPCBpOTE1X3Bk
cGVzX3Blcl9wZHAodm0pICYmCQlcCj4gLQkJICAgICAocGQgPSBpOTE1X3BkX2VudHJ5KHBkcCwg
aXRlciksIHRydWUpOwkJXAo+IC0JICAgICAoeyB1NjQgdGVtcCA9IEFMSUdOKHN0YXJ0KzEsIDEg
PDwgR0VOOF9QRFBFX1NISUZUKTsJXAo+IC0JCSAgICB0ZW1wID0gbWluKHRlbXAgLSBzdGFydCwg
bGVuZ3RoKTsJCQlcCj4gLQkJICAgIHN0YXJ0ICs9IHRlbXAsIGxlbmd0aCAtPSB0ZW1wOyB9KSwg
KytpdGVyKQo+IC0KPiAtI2RlZmluZSBnZW44X2Zvcl9lYWNoX3BtbDRlKHBkcCwgcG1sNCwgc3Rh
cnQsIGxlbmd0aCwgaXRlcikJCVwKPiAtCWZvciAoaXRlciA9IGdlbjhfcG1sNGVfaW5kZXgoc3Rh
cnQpOwkJCQlcCj4gLQkgICAgIGxlbmd0aCA+IDAgJiYgaXRlciA8IEdFTjhfUE1MNEVTX1BFUl9Q
TUw0ICYmCQlcCj4gLQkJICAgICAocGRwID0gaTkxNV9wZHBfZW50cnkocG1sNCwgaXRlciksIHRy
dWUpOwkJXAo+IC0JICAgICAoeyB1NjQgdGVtcCA9IEFMSUdOKHN0YXJ0KzEsIDFVTEwgPDwgR0VO
OF9QTUw0RV9TSElGVCk7CVwKPiAtCQkgICAgdGVtcCA9IG1pbih0ZW1wIC0gc3RhcnQsIGxlbmd0
aCk7CQkJXAo+IC0JCSAgICBzdGFydCArPSB0ZW1wLCBsZW5ndGggLT0gdGVtcDsgfSksICsraXRl
cikKPiAtCj4gLXN0YXRpYyBpbmxpbmUgdTMyIGdlbjhfcHRlX2luZGV4KHU2NCBhZGRyZXNzKQo+
IC17Cj4gLQlyZXR1cm4gaTkxNV9wdGVfaW5kZXgoYWRkcmVzcywgR0VOOF9QREVfU0hJRlQpOwo+
IC19Cj4gLQo+IC1zdGF0aWMgaW5saW5lIHUzMiBnZW44X3BkZV9pbmRleCh1NjQgYWRkcmVzcykK
PiAtewo+IC0JcmV0dXJuIGk5MTVfcGRlX2luZGV4KGFkZHJlc3MsIEdFTjhfUERFX1NISUZUKTsK
PiAtfQo+IC0KPiAtc3RhdGljIGlubGluZSB1MzIgZ2VuOF9wZHBlX2luZGV4KHU2NCBhZGRyZXNz
KQo+IC17Cj4gLQlyZXR1cm4gKGFkZHJlc3MgPj4gR0VOOF9QRFBFX1NISUZUKSAmIEdFTjhfUERQ
RV9NQVNLOwo+IC19Cj4gLQo+IC1zdGF0aWMgaW5saW5lIHUzMiBnZW44X3BtbDRlX2luZGV4KHU2
NCBhZGRyZXNzKQo+IC17Cj4gLQlyZXR1cm4gKGFkZHJlc3MgPj4gR0VOOF9QTUw0RV9TSElGVCkg
JiBHRU44X1BNTDRFX01BU0s7Cj4gLX0KPiAtCj4gLXN0YXRpYyBpbmxpbmUgdTY0IGdlbjhfcHRl
X2NvdW50KHU2NCBhZGRyZXNzLCB1NjQgbGVuZ3RoKQo+IC17Cj4gLQlyZXR1cm4gaTkxNV9wdGVf
Y291bnQoYWRkcmVzcywgbGVuZ3RoLCBHRU44X1BERV9TSElGVCk7Cj4gLX0KPiAtCj4gIHN0YXRp
YyBpbmxpbmUgZG1hX2FkZHJfdAo+ICBpOTE1X3BhZ2VfZGlyX2RtYV9hZGRyKGNvbnN0IHN0cnVj
dCBpOTE1X3BwZ3R0ICpwcGd0dCwgY29uc3QgdW5zaWduZWQgaW50IG4pCj4gIHsKPiAKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxp
bmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7AEE867991
	for <lists+intel-gfx@lfdr.de>; Sat, 13 Jul 2019 12:00:45 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7EB506E3E7;
	Sat, 13 Jul 2019 10:00:41 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 450806E3D8
 for <intel-gfx@lists.freedesktop.org>; Sat, 13 Jul 2019 10:00:35 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17265474-1500050 
 for multiple; Sat, 13 Jul 2019 11:00:18 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sat, 13 Jul 2019 11:00:10 +0100
Message-Id: <20190713100016.8026-5-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190713100016.8026-1-chris@chris-wilson.co.uk>
References: <20190713100016.8026-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 05/11] drm/i915/guc: unify guc irq handling
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogRGFuaWVsZSBDZXJhb2xvIFNwdXJpbyA8ZGFuaWVsZS5jZXJhb2xvc3B1cmlvQGludGVs
LmNvbT4KClRoZSAxNi1iaXQgZ3VjIGlycSB2ZWN0b3IgaXMgdW5jaGFuZ2VkIGFjcm9zcyBnZW5z
LCB0aGUgb25seSB0aGluZyB0aGF0Cm1vdmVkIGlzIGl0cyBwb3NpdGlvbiAoZnJvbSB0aGUgdXBw
ZXIgMTYgYml0cyBvZiB0aGUgUE0gcmVncyB0byBpdHMgb3duCnJlZ2lzdGVyKS4gSW5zdGVhZCBv
ZiBkdXBsaWNhdGluZyBhbGwgZGVmaW5lcyBhbmQgZnVuY3Rpb25zIHRvIGhhbmRsZQp0aGUgMiBk
aWZmZXJlbnQgcG9zaXRpb25zLCB3ZSBjYW4gd29yayBvbiB0aGUgdmVjdG9yIGFuZCBzaGlmdCBp
dCBhcwphcHByb3ByaWF0ZS4gV2hpbGUgYXQgaXQsIHVwZGF0ZSB0aGUgaGFuZGxlciB0byB3b3Jr
IG9uIGludGVsX2d1Yy4KClNpZ25lZC1vZmYtYnk6IERhbmllbGUgQ2VyYW9sbyBTcHVyaW8gPGRh
bmllbGUuY2VyYW9sb3NwdXJpb0BpbnRlbC5jb20+CkNjOiBNaWNoYWwgV2FqZGVjemtvIDxtaWNo
YWwud2FqZGVjemtvQGludGVsLmNvbT4KUmV2aWV3ZWQtYnk6IE1pY2hhbCBXYWpkZWN6a28gPG1p
Y2hhbC53YWpkZWN6a29AaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
aXJxLmMgICAgICB8IDI0ICsrKysrKysrLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9yZWcuaCAgICAgIHwgMTAgLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF9ndWNfcmVnLmggfCAzMiArKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tCiAzIGZpbGVz
IGNoYW5nZWQsIDI1IGluc2VydGlvbnMoKyksIDQxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfaXJxLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2lycS5jCmluZGV4IDgzMWQxODVjMDdkMi4uNDJkNmQ4YmZhYzcwIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2lycS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfaXJxLmMKQEAgLTI2NCw3ICsyNjQsNyBAQCBzdGF0aWMgdm9pZCBnZW4yX2lycV9pbml0
KHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSwKIAlnZW4yX2lycV9pbml0KCh1bmNvcmUpLCBp
bXJfdmFsLCBpZXJfdmFsKQogCiBzdGF0aWMgdm9pZCBnZW42X3Jwc19pcnFfaGFuZGxlcihzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBwbV9paXIpOwotc3RhdGljIHZvaWQg
Z2VuOV9ndWNfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1
MzIgcG1faWlyKTsKK3N0YXRpYyB2b2lkIGd1Y19pcnFfaGFuZGxlcihzdHJ1Y3QgaW50ZWxfZ3Vj
ICpndWMsIHUxNiBndWNfaWlyKTsKIAogLyogRm9yIGRpc3BsYXkgaG90cGx1ZyBpbnRlcnJ1cHQg
Ki8KIHN0YXRpYyBpbmxpbmUgdm9pZApAQCAtNjU4LDggKzY1OCw3IEBAIHZvaWQgZ2VuMTFfZW5h
YmxlX2d1Y19pbnRlcnJ1cHRzKHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKIAogCXNwaW5fbG9ja19p
cnEoJmRldl9wcml2LT5pcnFfbG9jayk7CiAJaWYgKCFndWMtPmludGVycnVwdHMuZW5hYmxlZCkg
ewotCQl1MzIgZXZlbnRzID0gUkVHX0ZJRUxEX1BSRVAoRU5HSU5FMV9NQVNLLAotCQkJCQkgICAg
R0VOMTFfR1VDX0lOVFJfR1VDMkhPU1QpOworCQl1MzIgZXZlbnRzID0gUkVHX0ZJRUxEX1BSRVAo
RU5HSU5FMV9NQVNLLCBHVUNfSU5UUl9HVUMySE9TVCk7CiAKIAkJV0FSTl9PTl9PTkNFKGdlbjEx
X3Jlc2V0X29uZV9paXIoJmRldl9wcml2LT5ndCwgMCwgR0VOMTFfR1VDKSk7CiAJCUk5MTVfV1JJ
VEUoR0VOMTFfR1VDX1NHX0lOVFJfRU5BQkxFLCBldmVudHMpOwpAQCAtMTY1Niw3ICsxNjU1LDcg
QEAgc3RhdGljIHZvaWQgZ2VuOF9ndF9pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAogCWlmIChtYXN0ZXJfY3RsICYgKEdFTjhfR1RfUE1fSVJRIHwgR0VOOF9HVF9H
VUNfSVJRKSkgewogCQlnZW42X3Jwc19pcnFfaGFuZGxlcihpOTE1LCBndF9paXJbMl0pOwotCQln
ZW45X2d1Y19pcnFfaGFuZGxlcihpOTE1LCBndF9paXJbMl0pOworCQlndWNfaXJxX2hhbmRsZXIo
Jmk5MTUtPmd1YywgZ3RfaWlyWzJdID4+IDE2KTsKIAl9CiB9CiAKQEAgLTE5NTUsMTYgKzE5NTQs
MTAgQEAgc3RhdGljIHZvaWQgZ2VuNl9ycHNfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LCB1MzIgcG1faWlyKQogCQlEUk1fREVCVUcoIkNvbW1hbmQgcGFyc2Vy
IGVycm9yLCBwbV9paXIgMHglMDh4XG4iLCBwbV9paXIpOwogfQogCi1zdGF0aWMgdm9pZCBnZW45
X2d1Y19pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBn
dF9paXIpCitzdGF0aWMgdm9pZCBndWNfaXJxX2hhbmRsZXIoc3RydWN0IGludGVsX2d1YyAqZ3Vj
LCB1MTYgaWlyKQogewotCWlmIChndF9paXIgJiBHRU45X0dVQ19UT19IT1NUX0lOVF9FVkVOVCkK
LQkJaW50ZWxfZ3VjX3RvX2hvc3RfZXZlbnRfaGFuZGxlcigmZGV2X3ByaXYtPmd1Yyk7Ci19Ci0K
LXN0YXRpYyB2b2lkIGdlbjExX2d1Y19pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwgdTE2IGlpcikKLXsKLQlpZiAoaWlyICYgR0VOMTFfR1VDX0lOVFJfR1VDMkhPU1Qp
Ci0JCWludGVsX2d1Y190b19ob3N0X2V2ZW50X2hhbmRsZXIoJmk5MTUtPmd1Yyk7CisJaWYgKGlp
ciAmIEdVQ19JTlRSX0dVQzJIT1NUKQorCQlpbnRlbF9ndWNfdG9faG9zdF9ldmVudF9oYW5kbGVy
KGd1Yyk7CiB9CiAKIHN0YXRpYyB2b2lkIGk5eHhfcGlwZXN0YXRfaXJxX3Jlc2V0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKQEAgLTMwOTIsNyArMzA4NSw3IEBAIGdlbjExX290
aGVyX2lycV9oYW5kbGVyKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIGNvbnN0IHU4IGluc3RhbmNlLAog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ3QtPmk5MTU7CiAKIAlpZiAoaW5zdGFu
Y2UgPT0gT1RIRVJfR1VDX0lOU1RBTkNFKQotCQlyZXR1cm4gZ2VuMTFfZ3VjX2lycV9oYW5kbGVy
KGk5MTUsIGlpcik7CisJCXJldHVybiBndWNfaXJxX2hhbmRsZXIoJmk5MTUtPmd1YywgaWlyKTsK
IAogCWlmIChpbnN0YW5jZSA9PSBPVEhFUl9HVFBNX0lOU1RBTkNFKQogCQlyZXR1cm4gZ2VuMTFf
cnBzX2lycV9oYW5kbGVyKGd0LCBpaXIpOwpAQCAtNDc2NCw4ICs0NzU3LDkgQEAgdm9pZCBpbnRl
bF9pcnFfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJZm9yIChpID0g
MDsgaSA8IE1BWF9MM19TTElDRVM7ICsraSkKIAkJZGV2X3ByaXYtPmwzX3Bhcml0eS5yZW1hcF9p
bmZvW2ldID0gTlVMTDsKIAorCS8qIHByZS1nZW4xMSB0aGUgZ3VjIGlycXMgYml0cyBhcmUgaW4g
dGhlIHVwcGVyIDE2IGJpdHMgb2YgdGhlIHBtIHJlZyAqLwogCWlmIChIQVNfR1VDX1NDSEVEKGRl
dl9wcml2KSAmJiBJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTEpCi0JCWRldl9wcml2LT5wbV9ndWNf
ZXZlbnRzID0gR0VOOV9HVUNfVE9fSE9TVF9JTlRfRVZFTlQ7CisJCWRldl9wcml2LT5wbV9ndWNf
ZXZlbnRzID0gR1VDX0lOVFJfR1VDMkhPU1QgPDwgMTY7CiAKIAkvKiBMZXQncyB0cmFjayB0aGUg
ZW5hYmxlZCBycHMgZXZlbnRzICovCiAJaWYgKElTX1ZBTExFWVZJRVcoZGV2X3ByaXYpKQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaCBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfcmVnLmgKaW5kZXggMGRkNDUwNjMyM2YyLi5mZGQ5YmMwMWU2OTQgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmgKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9yZWcuaApAQCAtNzM1NywxNiArNzM1Nyw2IEBAIGVudW0gewogI2RlZmlu
ZSBHRU44X0dUX0lJUih3aGljaCkgX01NSU8oMHg0NDMwOCArICgweDEwICogKHdoaWNoKSkpCiAj
ZGVmaW5lIEdFTjhfR1RfSUVSKHdoaWNoKSBfTU1JTygweDQ0MzBjICsgKDB4MTAgKiAod2hpY2gp
KSkKIAotI2RlZmluZSBHRU45X0dVQ19UT19IT1NUX0lOVF9FVkVOVAkoMSA8PCAzMSkKLSNkZWZp
bmUgR0VOOV9HVUNfRVhFQ19FUlJPUl9FVkVOVAkoMSA8PCAzMCkKLSNkZWZpbmUgR0VOOV9HVUNf
RElTUExBWV9FVkVOVAkJKDEgPDwgMjkpCi0jZGVmaW5lIEdFTjlfR1VDX1NFTUFfU0lHTkFMX0VW
RU5UCSgxIDw8IDI4KQotI2RlZmluZSBHRU45X0dVQ19JT01NVV9NU0dfRVZFTlQJKDEgPDwgMjcp
Ci0jZGVmaW5lIEdFTjlfR1VDX0RCX1JJTkdfRVZFTlQJCSgxIDw8IDI2KQotI2RlZmluZSBHRU45
X0dVQ19ETUFfRE9ORV9FVkVOVAkJKDEgPDwgMjUpCi0jZGVmaW5lIEdFTjlfR1VDX0ZBVEFMX0VS
Uk9SX0VWRU5UCSgxIDw8IDI0KQotI2RlZmluZSBHRU45X0dVQ19OT1RJRklDQVRJT05fRVZFTlQJ
KDEgPDwgMjMpCi0KICNkZWZpbmUgR0VOOF9SQ1NfSVJRX1NISUZUIDAKICNkZWZpbmUgR0VOOF9C
Q1NfSVJRX1NISUZUIDE2CiAjZGVmaW5lIEdFTjhfVkNTMF9JUlFfU0hJRlQgMCAgLyogTkI6IFZD
UzEgaW4gYnNwZWMhICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9n
dWNfcmVnLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWNfcmVnLmgKaW5kZXggYTVh
YjdiYzU1MDRjLi5lM2NiYjIzMjk5Y2UgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2ludGVsX2d1Y19yZWcuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWNfcmVn
LmgKQEAgLTE0MSwyMSArMTQxLDIxIEBAIHN0cnVjdCBndWNfZG9vcmJlbGxfaW5mbyB7CiAjZGVm
aW5lIEdVQ19QTV9QMjRDX0lFUgkJCV9NTUlPKDB4QzU1QykKIAogLyogR3VDIEludGVycnVwdCBW
ZWN0b3IgKi8KLSNkZWZpbmUgR0VOMTFfR1VDX0lOVFJfR1VDMkhPU1QJCSgxIDw8IDE1KQotI2Rl
ZmluZSBHRU4xMV9HVUNfSU5UUl9FWEVDX0VSUk9SCSgxIDw8IDE0KQotI2RlZmluZSBHRU4xMV9H
VUNfSU5UUl9ESVNQTEFZX0VWRU5UCSgxIDw8IDEzKQotI2RlZmluZSBHRU4xMV9HVUNfSU5UUl9T
RU1fU0lHCQkoMSA8PCAxMikKLSNkZWZpbmUgR0VOMTFfR1VDX0lOVFJfSU9NTVUyR1VDCSgxIDw8
IDExKQotI2RlZmluZSBHRU4xMV9HVUNfSU5UUl9ET09SQkVMTF9SQU5HCSgxIDw8IDEwKQotI2Rl
ZmluZSBHRU4xMV9HVUNfSU5UUl9ETUFfRE9ORQkJKDEgPDwgIDkpCi0jZGVmaW5lIEdFTjExX0dV
Q19JTlRSX0ZBVEFMX0VSUk9SCSgxIDw8ICA4KQotI2RlZmluZSBHRU4xMV9HVUNfSU5UUl9OT1RJ
Rl9FUlJPUgkoMSA8PCAgNykKLSNkZWZpbmUgR0VOMTFfR1VDX0lOVFJfU1dfSU5UXzYJCSgxIDw8
ICA2KQotI2RlZmluZSBHRU4xMV9HVUNfSU5UUl9TV19JTlRfNQkJKDEgPDwgIDUpCi0jZGVmaW5l
IEdFTjExX0dVQ19JTlRSX1NXX0lOVF80CQkoMSA8PCAgNCkKLSNkZWZpbmUgR0VOMTFfR1VDX0lO
VFJfU1dfSU5UXzMJCSgxIDw8ICAzKQotI2RlZmluZSBHRU4xMV9HVUNfSU5UUl9TV19JTlRfMgkJ
KDEgPDwgIDIpCi0jZGVmaW5lIEdFTjExX0dVQ19JTlRSX1NXX0lOVF8xCQkoMSA8PCAgMSkKLSNk
ZWZpbmUgR0VOMTFfR1VDX0lOVFJfU1dfSU5UXzAJCSgxIDw8ICAwKQorI2RlZmluZSBHVUNfSU5U
Ul9HVUMySE9TVAkJQklUKDE1KQorI2RlZmluZSBHVUNfSU5UUl9FWEVDX0VSUk9SCQlCSVQoMTQp
CisjZGVmaW5lIEdVQ19JTlRSX0RJU1BMQVlfRVZFTlQJCUJJVCgxMykKKyNkZWZpbmUgR1VDX0lO
VFJfU0VNX1NJRwkJQklUKDEyKQorI2RlZmluZSBHVUNfSU5UUl9JT01NVTJHVUMJCUJJVCgxMSkK
KyNkZWZpbmUgR1VDX0lOVFJfRE9PUkJFTExfUkFORwkJQklUKDEwKQorI2RlZmluZSBHVUNfSU5U
Ul9ETUFfRE9ORQkJQklUKDkpCisjZGVmaW5lIEdVQ19JTlRSX0ZBVEFMX0VSUk9SCQlCSVQoOCkK
KyNkZWZpbmUgR1VDX0lOVFJfTk9USUZfRVJST1IJCUJJVCg3KQorI2RlZmluZSBHVUNfSU5UUl9T
V19JTlRfNgkJQklUKDYpCisjZGVmaW5lIEdVQ19JTlRSX1NXX0lOVF81CQlCSVQoNSkKKyNkZWZp
bmUgR1VDX0lOVFJfU1dfSU5UXzQJCUJJVCg0KQorI2RlZmluZSBHVUNfSU5UUl9TV19JTlRfMwkJ
QklUKDMpCisjZGVmaW5lIEdVQ19JTlRSX1NXX0lOVF8yCQlCSVQoMikKKyNkZWZpbmUgR1VDX0lO
VFJfU1dfSU5UXzEJCUJJVCgxKQorI2RlZmluZSBHVUNfSU5UUl9TV19JTlRfMAkJQklUKDApCiAK
ICNlbmRpZgotLSAKMi4yMi4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVz
a3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9p
bnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 2962CD199A
	for <lists+intel-gfx@lfdr.de>; Wed,  9 Oct 2019 22:36:59 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5AAF16EA28;
	Wed,  9 Oct 2019 20:36:55 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id E95826E321
 for <intel-gfx@lists.freedesktop.org>; Wed,  9 Oct 2019 20:36:53 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18782942-1500050 
 for multiple; Wed, 09 Oct 2019 21:36:44 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  9 Oct 2019 21:36:35 +0100
Message-Id: <20191009203641.15477-5-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191009203641.15477-1-chris@chris-wilson.co.uk>
References: <20191009203641.15477-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 05/11] drm/i915/perf: allow for CS OA configs to
 be created lazily
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwuY29tPgoK
SGVyZSB3ZSBpbnRyb2R1Y2UgYSBtZWNoYW5pc20gYnkgd2hpY2ggdGhlIGV4ZWNidWYgcGFydCBv
ZiB0aGUgaTkxNQpkcml2ZXIgd2lsbCBiZSBhYmxlIHRvIHJlcXVlc3QgdGhhdCBhIGJhdGNoIGJ1
ZmZlciBjb250YWluaW5nIHRoZQpwcm9ncmFtbWluZyBmb3IgYSBwYXJ0aWN1bGFyIE9BIGNvbmZp
ZyBiZSBjcmVhdGVkLgoKV2UnbGwgZXhlY3V0ZSB0aGVzZSBPQSBjb25maWd1cmF0aW9uIGJ1ZmZl
cnMgcmlnaHQgYmVmb3JlIGV4ZWN1dGluZyBhCnNldCBvZiB1c2Vyc3BhY2UgY29tbWFuZHMgc28g
dGhhdCBhIHBhcnRpY3VsYXIgdXNlciBiYXRjaGJ1ZmZlciBiZQpleGVjdXRlZCB3aXRoIGEgZ2l2
ZW4gT0EgY29uZmlndXJhdGlvbi4KClRoaXMgbWVjaGFuaXNtIGVzc2VudGlhbGx5IGFsbG93cyB0
aGUgdXNlcnNwYWNlIGRyaXZlciB0byBnbyB0aHJvdWdoCnNldmVyYWwgT0EgY29uZmlndXJhdGlv
biB3aXRob3V0IGhhdmluZyB0byBvcGVuL2Nsb3NlIHRoZSBpOTE1L3BlcmYKc3RyZWFtLgoKdjI6
IE5vIG5lZWQgZm9yIGxvY2tpbmcgb24gb2JqZWN0IE9BIGNvbmZpZyBvYmplY3QgY3JlYXRpb24g
KENocmlzKQogICAgRmx1c2ggY3B1IG1hcHBpbmcgb2YgT0EgY29uZmlnIChDaHJpcykKCnYzOiBQ
cm9wZXJseSBkZWFsIHdpdGggdGhlIHBlcmZfbWV0cmljIGxvY2sgKENocmlzL0xpb25lbCkKCnY0
OiBGaXggb2EgY29uZmlnIHVucmVmL3B1dCB3aGVuIG5vdCBmb3VuZCAoTGlvbmVsKQoKdjU6IEFs
bG9jYXRlIEJPcyBmb3IgY29uZmlndXJhdGlvbnMgb24gdGhlIHN0cmVhbSBpbnN0ZWFkIG9mIGds
b2JhbGx5CiAgICAoTGlvbmVsKQoKdjY6IEZpeCA2NGJpdCBkaXZpc2lvbiAoQ2hyaXMpCgp2Nzog
U3RvcmUgYWxsb2NhdGVkIGNvbmZpZyBCT3MgaW50byB0aGUgc3RyZWFtIChMaW9uZWwpCgpTaWdu
ZWQtb2ZmLWJ5OiBMaW9uZWwgTGFuZHdlcmxpbiA8bGlvbmVsLmcubGFuZHdlcmxpbkBpbnRlbC5j
b20+ClJldmlld2VkLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4g
KHY0KQotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5oIHwg
ICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jICAgICAgICAgICAgIHwgMTA3
ICsrKysrKysrKysrLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5oICAg
ICAgICAgICAgIHwgIDI0ICsrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmZfdHlw
ZXMuaCAgICAgICB8ICAyMyArKy0tCiA0IGZpbGVzIGNoYW5nZWQsIDEwMiBpbnNlcnRpb25zKCsp
LCA1MyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9ncHVfY29tbWFuZHMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9j
b21tYW5kcy5oCmluZGV4IGIwMjI3YWIyZmUxYi4uMDk4NzEwMGM3ODZiIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMuaAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMuaApAQCAtMTM4LDYgKzEzOCw3IEBA
CiAvKiBHZW4xMSsuIGFkZHIgPSBiYXNlICsgKGN0eF9yZXN0b3JlID8gb2Zmc2V0ICYgR0VOTUFT
SygxMiwyKSA6IG9mZnNldCkgKi8KICNkZWZpbmUgICBNSV9MUklfQ1NfTU1JTwkJKDE8PDE5KQog
I2RlZmluZSAgIE1JX0xSSV9GT1JDRV9QT1NURUQJCSgxPDwxMikKKyNkZWZpbmUgTUlfTE9BRF9S
RUdJU1RFUl9JTU1fTUFYX1JFR1MgKDEyNikKICNkZWZpbmUgTUlfU1RPUkVfUkVHSVNURVJfTUVN
ICAgICAgICBNSV9JTlNUUigweDI0LCAxKQogI2RlZmluZSBNSV9TVE9SRV9SRUdJU1RFUl9NRU1f
R0VOOCAgIE1JX0lOU1RSKDB4MjQsIDIpCiAjZGVmaW5lICAgTUlfU1JNX0xSTV9HTE9CQUxfR1RU
CQkoMTw8MjIpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCmluZGV4IGJmOTllYWYyMzE1Zi4uOGMw
NmY0MjcyMGQ2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYwpAQCAtMzY5LDUyICszNjksNTIg
QEAgc3RydWN0IHBlcmZfb3Blbl9wcm9wZXJ0aWVzIHsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmU7CiB9OwogCitzdHJ1Y3QgaTkxNV9vYV9jb25maWdfYm8geworCXN0cnVjdCBsbGlz
dF9ub2RlIG5vZGU7CisKKwlzdHJ1Y3QgaTkxNV9vYV9jb25maWcgKm9hX2NvbmZpZzsKKwlzdHJ1
Y3QgaTkxNV92bWEgKnZtYTsKK307CisKIHN0YXRpYyBlbnVtIGhydGltZXJfcmVzdGFydCBvYV9w
b2xsX2NoZWNrX3RpbWVyX2NiKHN0cnVjdCBocnRpbWVyICpocnRpbWVyKTsKIAotc3RhdGljIHZv
aWQgZnJlZV9vYV9jb25maWcoc3RydWN0IGk5MTVfb2FfY29uZmlnICpvYV9jb25maWcpCit2b2lk
IGk5MTVfb2FfY29uZmlnX3JlbGVhc2Uoc3RydWN0IGtyZWYgKnJlZikKIHsKKwlzdHJ1Y3QgaTkx
NV9vYV9jb25maWcgKm9hX2NvbmZpZyA9CisJCWNvbnRhaW5lcl9vZihyZWYsIHR5cGVvZigqb2Ff
Y29uZmlnKSwgcmVmKTsKKwogCWlmICghUFRSX0VSUihvYV9jb25maWctPmZsZXhfcmVncykpCiAJ
CWtmcmVlKG9hX2NvbmZpZy0+ZmxleF9yZWdzKTsKIAlpZiAoIVBUUl9FUlIob2FfY29uZmlnLT5i
X2NvdW50ZXJfcmVncykpCiAJCWtmcmVlKG9hX2NvbmZpZy0+Yl9jb3VudGVyX3JlZ3MpOwogCWlm
ICghUFRSX0VSUihvYV9jb25maWctPm11eF9yZWdzKSkKIAkJa2ZyZWUob2FfY29uZmlnLT5tdXhf
cmVncyk7Ci0Ja2ZyZWUob2FfY29uZmlnKTsKLX0KLQotc3RhdGljIHZvaWQgcHV0X29hX2NvbmZp
ZyhzdHJ1Y3QgaTkxNV9vYV9jb25maWcgKm9hX2NvbmZpZykKLXsKLQlpZiAoIWF0b21pY19kZWNf
YW5kX3Rlc3QoJm9hX2NvbmZpZy0+cmVmX2NvdW50KSkKLQkJcmV0dXJuOwogCi0JZnJlZV9vYV9j
b25maWcob2FfY29uZmlnKTsKKwlrZnJlZV9yY3Uob2FfY29uZmlnLCByY3UpOwogfQogCi1zdGF0
aWMgaW50IGdldF9vYV9jb25maWcoc3RydWN0IGk5MTVfcGVyZiAqcGVyZiwKLQkJCSBpbnQgbWV0
cmljc19zZXQsCi0JCQkgc3RydWN0IGk5MTVfb2FfY29uZmlnICoqb3V0X2NvbmZpZykKK3N0cnVj
dCBpOTE1X29hX2NvbmZpZyAqCitpOTE1X3BlcmZfZ2V0X29hX2NvbmZpZyhzdHJ1Y3QgaTkxNV9w
ZXJmICpwZXJmLCBpbnQgbWV0cmljc19zZXQpCiB7Ci0JaW50IHJldDsKLQotCWlmIChtZXRyaWNz
X3NldCA9PSAxKSB7Ci0JCSpvdXRfY29uZmlnID0gJnBlcmYtPnRlc3RfY29uZmlnOwotCQlhdG9t
aWNfaW5jKCZwZXJmLT50ZXN0X2NvbmZpZy5yZWZfY291bnQpOwotCQlyZXR1cm4gMDsKLQl9Ci0K
LQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJnBlcmYtPm1ldHJpY3NfbG9jayk7Ci0J
aWYgKHJldCkKLQkJcmV0dXJuIHJldDsKKwlzdHJ1Y3QgaTkxNV9vYV9jb25maWcgKm9hX2NvbmZp
ZzsKIAotCSpvdXRfY29uZmlnID0gaWRyX2ZpbmQoJnBlcmYtPm1ldHJpY3NfaWRyLCBtZXRyaWNz
X3NldCk7Ci0JaWYgKCEqb3V0X2NvbmZpZykKLQkJcmV0ID0gLUVJTlZBTDsKKwlyY3VfcmVhZF9s
b2NrKCk7CisJaWYgKG1ldHJpY3Nfc2V0ID09IDEpCisJCW9hX2NvbmZpZyA9ICZwZXJmLT50ZXN0
X2NvbmZpZzsKIAllbHNlCi0JCWF0b21pY19pbmMoJigqb3V0X2NvbmZpZyktPnJlZl9jb3VudCk7
CisJCW9hX2NvbmZpZyA9IGlkcl9maW5kKCZwZXJmLT5tZXRyaWNzX2lkciwgbWV0cmljc19zZXQp
OworCWlmIChvYV9jb25maWcpCisJCW9hX2NvbmZpZyA9IGk5MTVfb2FfY29uZmlnX2dldChvYV9j
b25maWcpOworCXJjdV9yZWFkX3VubG9jaygpOwogCi0JbXV0ZXhfdW5sb2NrKCZwZXJmLT5tZXRy
aWNzX2xvY2spOworCXJldHVybiBvYV9jb25maWc7Cit9CiAKLQlyZXR1cm4gcmV0Oworc3RhdGlj
IHZvaWQgZnJlZV9vYV9jb25maWdfYm8oc3RydWN0IGk5MTVfb2FfY29uZmlnX2JvICpvYV9ibykK
K3sKKwlpOTE1X29hX2NvbmZpZ19wdXQob2FfYm8tPm9hX2NvbmZpZyk7CisJaTkxNV92bWFfcHV0
KG9hX2JvLT52bWEpOworCWtmcmVlKG9hX2JvKTsKIH0KIAogc3RhdGljIHUzMiBnZW44X29hX2h3
X3RhaWxfcmVhZChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQpAQCAtMTMzNyw2ICsx
MzM3LDE2IEBAIGZyZWVfb2FfYnVmZmVyKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0p
CiAJc3RyZWFtLT5vYV9idWZmZXIudmFkZHIgPSBOVUxMOwogfQogCitzdGF0aWMgdm9pZAorZnJl
ZV9vYV9jb25maWdzKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCit7CisJc3RydWN0
IGk5MTVfb2FfY29uZmlnX2JvICpvYV9ibywgKnRtcDsKKworCWk5MTVfb2FfY29uZmlnX3B1dChz
dHJlYW0tPm9hX2NvbmZpZyk7CisJbGxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShvYV9ibywgdG1w
LCBzdHJlYW0tPm9hX2NvbmZpZ19ib3MuZmlyc3QsIG5vZGUpCisJCWZyZWVfb2FfY29uZmlnX2Jv
KG9hX2JvKTsKK30KKwogc3RhdGljIHZvaWQgaTkxNV9vYV9zdHJlYW1fZGVzdHJveShzdHJ1Y3Qg
aTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogewogCXN0cnVjdCBpOTE1X3BlcmYgKnBlcmYgPSBz
dHJlYW0tPnBlcmY7CkBAIC0xMzUzLDcgKzEzNjMsNyBAQCBzdGF0aWMgdm9pZCBpOTE1X29hX3N0
cmVhbV9kZXN0cm95KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiAJZnJlZV9vYV9i
dWZmZXIoc3RyZWFtKTsKIAlwdXRfb2FfY29udGV4dChzdHJlYW0pOwogCi0JcHV0X29hX2NvbmZp
ZyhzdHJlYW0tPm9hX2NvbmZpZyk7CisJZnJlZV9vYV9jb25maWdzKHN0cmVhbSk7CiAKIAlpZiAo
cGVyZi0+c3B1cmlvdXNfcmVwb3J0X3JzLm1pc3NlZCkgewogCQlEUk1fTk9URSgiJWQgc3B1cmlv
dXMgT0EgcmVwb3J0IG5vdGljZXMgc3VwcHJlc3NlZCBkdWUgdG8gcmF0ZWxpbWl0aW5nXG4iLApA
QCAtMTUwMCwxMCArMTUxMCw2IEBAIHN0YXRpYyBpbnQgYWxsb2Nfb2FfYnVmZmVyKHN0cnVjdCBp
OTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiAJCWdvdG8gZXJyX3VucGluOwogCX0KIAotCURSTV9E
RUJVR19EUklWRVIoIk9BIEJ1ZmZlciBpbml0aWFsaXplZCwgZ3R0IG9mZnNldCA9IDB4JXgsIHZh
ZGRyID0gJXBcbiIsCi0JCQkgaTkxNV9nZ3R0X29mZnNldChzdHJlYW0tPm9hX2J1ZmZlci52bWEp
LAotCQkJIHN0cmVhbS0+b2FfYnVmZmVyLnZhZGRyKTsKLQogCXJldHVybiAwOwogCiBlcnJfdW5w
aW46CkBAIC0yMTk0LDkgKzIyMDAsMTAgQEAgc3RhdGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0
KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJCX0KIAl9CiAKLQlyZXQgPSBnZXRf
b2FfY29uZmlnKHBlcmYsIHByb3BzLT5tZXRyaWNzX3NldCwgJnN0cmVhbS0+b2FfY29uZmlnKTsK
LQlpZiAocmV0KSB7CisJc3RyZWFtLT5vYV9jb25maWcgPSBpOTE1X3BlcmZfZ2V0X29hX2NvbmZp
ZyhwZXJmLCBwcm9wcy0+bWV0cmljc19zZXQpOworCWlmICghc3RyZWFtLT5vYV9jb25maWcpIHsK
IAkJRFJNX0RFQlVHKCJJbnZhbGlkIE9BIGNvbmZpZyBpZD0laVxuIiwgcHJvcHMtPm1ldHJpY3Nf
c2V0KTsKKwkJcmV0ID0gLUVJTlZBTDsKIAkJZ290byBlcnJfY29uZmlnOwogCX0KIApAQCAtMjIx
Myw2ICsyMjIwLDkgQEAgc3RhdGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1
X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJCWdvdG8gZXJyX2VuYWJsZTsKIAl9CiAKKwlEUk1fREVC
VUcoIm9wZW5pbmcgc3RyZWFtIG9hIGNvbmZpZyB1dWlkPSVzXG4iLAorCQkgIHN0cmVhbS0+b2Ff
Y29uZmlnLT51dWlkKTsKKwogCWhydGltZXJfaW5pdCgmc3RyZWFtLT5wb2xsX2NoZWNrX3RpbWVy
LAogCQkgICAgIENMT0NLX01PTk9UT05JQywgSFJUSU1FUl9NT0RFX1JFTCk7CiAJc3RyZWFtLT5w
b2xsX2NoZWNrX3RpbWVyLmZ1bmN0aW9uID0gb2FfcG9sbF9jaGVja190aW1lcl9jYjsKQEAgLTIy
MjgsNyArMjIzOCw3IEBAIHN0YXRpYyBpbnQgaTkxNV9vYV9zdHJlYW1faW5pdChzdHJ1Y3QgaTkx
NV9wZXJmX3N0cmVhbSAqc3RyZWFtLAogCWZyZWVfb2FfYnVmZmVyKHN0cmVhbSk7CiAKIGVycl9v
YV9idWZfYWxsb2M6Ci0JcHV0X29hX2NvbmZpZyhzdHJlYW0tPm9hX2NvbmZpZyk7CisJZnJlZV9v
YV9jb25maWdzKHN0cmVhbSk7CiAKIGVycl9jb25maWc6CiAJcHV0X29hX2NvbnRleHQoc3RyZWFt
KTsKQEAgLTMwNDksNyArMzA1OSw4IEBAIHZvaWQgaTkxNV9wZXJmX3JlZ2lzdGVyKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogCWlmIChyZXQpCiAJCWdvdG8gc3lzZnNfZXJyb3I7CiAK
LQlhdG9taWNfc2V0KCZwZXJmLT50ZXN0X2NvbmZpZy5yZWZfY291bnQsIDEpOworCXBlcmYtPnRl
c3RfY29uZmlnLnBlcmYgPSBwZXJmOworCWtyZWZfaW5pdCgmcGVyZi0+dGVzdF9jb25maWcucmVm
KTsKIAogCWdvdG8gZXhpdDsKIApAQCAtMzMwNyw3ICszMzE4LDggQEAgaW50IGk5MTVfcGVyZl9h
ZGRfY29uZmlnX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCXJl
dHVybiAtRU5PTUVNOwogCX0KIAotCWF0b21pY19zZXQoJm9hX2NvbmZpZy0+cmVmX2NvdW50LCAx
KTsKKwlvYV9jb25maWctPnBlcmYgPSBwZXJmOworCWtyZWZfaW5pdCgmb2FfY29uZmlnLT5yZWYp
OwogCiAJaWYgKCF1dWlkX2lzX3ZhbGlkKGFyZ3MtPnV1aWQpKSB7CiAJCURSTV9ERUJVRygiSW52
YWxpZCB1dWlkIGZvcm1hdCBmb3IgT0EgY29uZmlnXG4iKTsKQEAgLTM0MDYsNyArMzQxOCw3IEBA
IGludCBpOTE1X3BlcmZfYWRkX2NvbmZpZ19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2
b2lkICpkYXRhLAogc3lzZnNfZXJyOgogCW11dGV4X3VubG9jaygmcGVyZi0+bWV0cmljc19sb2Nr
KTsKIHJlZ19lcnI6Ci0JcHV0X29hX2NvbmZpZyhvYV9jb25maWcpOworCWk5MTVfb2FfY29uZmln
X3B1dChvYV9jb25maWcpOwogCURSTV9ERUJVRygiRmFpbGVkIHRvIGFkZCBuZXcgT0EgY29uZmln
XG4iKTsKIAlyZXR1cm4gZXJyOwogfQpAQCAtMzQ0MiwxMyArMzQ1NCwxMyBAQCBpbnQgaTkxNV9w
ZXJmX3JlbW92ZV9jb25maWdfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0
YSwKIAogCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmcGVyZi0+bWV0cmljc19sb2Nr
KTsKIAlpZiAocmV0KQotCQlnb3RvIGxvY2tfZXJyOworCQlyZXR1cm4gcmV0OwogCiAJb2FfY29u
ZmlnID0gaWRyX2ZpbmQoJnBlcmYtPm1ldHJpY3NfaWRyLCAqYXJnKTsKIAlpZiAoIW9hX2NvbmZp
ZykgewogCQlEUk1fREVCVUcoIkZhaWxlZCB0byByZW1vdmUgdW5rbm93biBPQSBjb25maWdcbiIp
OwogCQlyZXQgPSAtRU5PRU5UOwotCQlnb3RvIGNvbmZpZ19lcnI7CisJCWdvdG8gZXJyX3VubG9j
azsKIAl9CiAKIAlHRU1fQlVHX09OKCphcmcgIT0gb2FfY29uZmlnLT5pZCk7CkBAIC0zNDU4LDEz
ICszNDcwLDE2IEBAIGludCBpOTE1X3BlcmZfcmVtb3ZlX2NvbmZpZ19pb2N0bChzdHJ1Y3QgZHJt
X2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCiAJaWRyX3JlbW92ZSgmcGVyZi0+bWV0cmljc19p
ZHIsICphcmcpOwogCisJbXV0ZXhfdW5sb2NrKCZwZXJmLT5tZXRyaWNzX2xvY2spOworCiAJRFJN
X0RFQlVHKCJSZW1vdmVkIGNvbmZpZyAlcyBpZD0laVxuIiwgb2FfY29uZmlnLT51dWlkLCBvYV9j
b25maWctPmlkKTsKIAotCXB1dF9vYV9jb25maWcob2FfY29uZmlnKTsKKwlpOTE1X29hX2NvbmZp
Z19wdXQob2FfY29uZmlnKTsKKworCXJldHVybiAwOwogCi1jb25maWdfZXJyOgorZXJyX3VubG9j
azoKIAltdXRleF91bmxvY2soJnBlcmYtPm1ldHJpY3NfbG9jayk7Ci1sb2NrX2VycjoKIAlyZXR1
cm4gcmV0OwogfQogCkBAIC0zNjM0LDcgKzM2NDksNyBAQCB2b2lkIGk5MTVfcGVyZl9pbml0KHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCiBzdGF0aWMgaW50IGRlc3Ryb3lfY29uZmln
KGludCBpZCwgdm9pZCAqcCwgdm9pZCAqZGF0YSkKIHsKLQlwdXRfb2FfY29uZmlnKHApOworCWk5
MTVfb2FfY29uZmlnX3B1dChwKTsKIAlyZXR1cm4gMDsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Bl
cmYuaAppbmRleCAyOTVlMzNlOGVlZjcuLjRjZWViY2U3MjA2MCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9wZXJmLmgKQEAgLTYsNiArNiw3IEBACiAjaWZuZGVmIF9fSTkxNV9QRVJGX0hfXwogI2RlZmlu
ZSBfX0k5MTVfUEVSRl9IX18KIAorI2luY2x1ZGUgPGxpbnV4L2tyZWYuaD4KICNpbmNsdWRlIDxs
aW51eC90eXBlcy5oPgogCiAjaW5jbHVkZSAiaTkxNV9wZXJmX3R5cGVzLmgiCkBAIC0xMyw2ICsx
NCw3IEBACiBzdHJ1Y3QgZHJtX2RldmljZTsKIHN0cnVjdCBkcm1fZmlsZTsKIHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlOworc3RydWN0IGk5MTVfb2FfY29uZmlnOwogc3RydWN0IGludGVsX2NvbnRl
eHQ7CiBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzOwogCkBAIC0yOCw3ICszMCwyOSBAQCBpbnQgaTkx
NV9wZXJmX2FkZF9jb25maWdfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0
YSwKIAkJCSAgICAgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpOwogaW50IGk5MTVfcGVyZl9yZW1v
dmVfY29uZmlnX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCQkJ
ICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUpOworCiB2b2lkIGk5MTVfb2FfaW5pdF9yZWdfc3RhdGUo
Y29uc3Qgc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCQkJICAgIGNvbnN0IHN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKmVuZ2luZSk7CiAKK3N0cnVjdCBpOTE1X29hX2NvbmZpZyAqCitpOTE1X3Bl
cmZfZ2V0X29hX2NvbmZpZyhzdHJ1Y3QgaTkxNV9wZXJmICpwZXJmLCBpbnQgbWV0cmljc19zZXQp
OworCitzdGF0aWMgaW5saW5lIHN0cnVjdCBpOTE1X29hX2NvbmZpZyAqCitpOTE1X29hX2NvbmZp
Z19nZXQoc3RydWN0IGk5MTVfb2FfY29uZmlnICpvYV9jb25maWcpCit7CisJaWYgKGtyZWZfZ2V0
X3VubGVzc196ZXJvKCZvYV9jb25maWctPnJlZikpCisJCXJldHVybiBvYV9jb25maWc7CisJZWxz
ZQorCQlyZXR1cm4gTlVMTDsKK30KKwordm9pZCBpOTE1X29hX2NvbmZpZ19yZWxlYXNlKHN0cnVj
dCBrcmVmICpyZWYpOworc3RhdGljIGlubGluZSB2b2lkIGk5MTVfb2FfY29uZmlnX3B1dChzdHJ1
Y3QgaTkxNV9vYV9jb25maWcgKm9hX2NvbmZpZykKK3sKKwlpZiAoIW9hX2NvbmZpZykKKwkJcmV0
dXJuOworCisJa3JlZl9wdXQoJm9hX2NvbmZpZy0+cmVmLCBpOTE1X29hX2NvbmZpZ19yZWxlYXNl
KTsKK30KKwogI2VuZGlmIC8qIF9fSTkxNV9QRVJGX0hfXyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmX3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3BlcmZfdHlwZXMuaAppbmRleCA4Y2ZlNTk4MzUyYTguLmIxYjdjOGQwNGY1MCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmX3R5cGVzLmgKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmX3R5cGVzLmgKQEAgLTksNyArOSw3IEBACiAjaW5jbHVk
ZSA8bGludXgvYXRvbWljLmg+CiAjaW5jbHVkZSA8bGludXgvZGV2aWNlLmg+CiAjaW5jbHVkZSA8
bGludXgvaHJ0aW1lci5oPgotI2luY2x1ZGUgPGxpbnV4L2xpc3QuaD4KKyNpbmNsdWRlIDxsaW51
eC9sbGlzdC5oPgogI2luY2x1ZGUgPGxpbnV4L3BvbGwuaD4KICNpbmNsdWRlIDxsaW51eC9zeXNm
cy5oPgogI2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+CkBAIC0yMiw2ICsyMiw3IEBACiBzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZTsKIHN0cnVjdCBmaWxlOwogc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQ7
CitzdHJ1Y3QgaTkxNV9wZXJmOwogc3RydWN0IGk5MTVfdm1hOwogc3RydWN0IGludGVsX2NvbnRl
eHQ7CiBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzOwpAQCAtMzcsNiArMzgsOCBAQCBzdHJ1Y3QgaTkx
NV9vYV9yZWcgewogfTsKIAogc3RydWN0IGk5MTVfb2FfY29uZmlnIHsKKwlzdHJ1Y3QgaTkxNV9w
ZXJmICpwZXJmOworCiAJY2hhciB1dWlkW1VVSURfU1RSSU5HX0xFTiArIDFdOwogCWludCBpZDsK
IApAQCAtNTEsNyArNTQsOCBAQCBzdHJ1Y3QgaTkxNV9vYV9jb25maWcgewogCXN0cnVjdCBhdHRy
aWJ1dGUgKmF0dHJzWzJdOwogCXN0cnVjdCBkZXZpY2VfYXR0cmlidXRlIHN5c2ZzX21ldHJpY19p
ZDsKIAotCWF0b21pY190IHJlZl9jb3VudDsKKwlzdHJ1Y3Qga3JlZiByZWY7CisJc3RydWN0IHJj
dV9oZWFkIHJjdTsKIH07CiAKIHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtOwpAQCAtMTc5LDYgKzE4
MywxMiBAQCBzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSB7CiAJICovCiAJc3RydWN0IGk5MTVfb2Ff
Y29uZmlnICpvYV9jb25maWc7CiAKKwkvKioKKwkgKiBAb2FfY29uZmlnX2JvczogQSBsaXN0IG9m
IHN0cnVjdCBpOTE1X29hX2NvbmZpZ19ibyBhbGxvY2F0ZWQgbGF6aWx5CisJICogZWFjaCB0aW1l
IEBvYV9jb25maWcgY2hhbmdlcy4KKwkgKi8KKwlzdHJ1Y3QgbGxpc3RfaGVhZCBvYV9jb25maWdf
Ym9zOworCiAJLyoqCiAJICogQHBpbm5lZF9jdHg6IFRoZSBPQSBjb250ZXh0IHNwZWNpZmljIGlu
Zm9ybWF0aW9uLgogCSAqLwpAQCAtMzMzLDEzICszNDMsMTMgQEAgc3RydWN0IGk5MTVfcGVyZiB7
CiAKIAkvKgogCSAqIExvY2sgYXNzb2NpYXRlZCB3aXRoIGFkZGluZy9tb2RpZnlpbmcvcmVtb3Zp
bmcgT0EgY29uZmlncwotCSAqIGluIGRldl9wcml2LT5wZXJmLm1ldHJpY3NfaWRyLgorCSAqIGlu
IHBlcmYtPm1ldHJpY3NfaWRyLgogCSAqLwogCXN0cnVjdCBtdXRleCBtZXRyaWNzX2xvY2s7CiAK
IAkvKgotCSAqIExpc3Qgb2YgZHluYW1pYyBjb25maWd1cmF0aW9ucywgeW91IG5lZWQgdG8gaG9s
ZAotCSAqIGRldl9wcml2LT5wZXJmLm1ldHJpY3NfbG9jayB0byBhY2Nlc3MgaXQuCisJICogTGlz
dCBvZiBkeW5hbWljIGNvbmZpZ3VyYXRpb25zIChzdHJ1Y3QgaTkxNV9vYV9jb25maWcpLCB5b3UK
KwkgKiBuZWVkIHRvIGhvbGQgcGVyZi0+bWV0cmljc19sb2NrIHRvIGFjY2VzcyBpdC4KIAkgKi8K
IAlzdHJ1Y3QgaWRyIG1ldHJpY3NfaWRyOwogCkBAIC0zNTIsOCArMzYyLDcgQEAgc3RydWN0IGk5
MTVfcGVyZiB7CiAJLyoKIAkgKiBUaGUgc3RyZWFtIGN1cnJlbnRseSB1c2luZyB0aGUgT0EgdW5p
dC4gSWYgYWNjZXNzZWQKIAkgKiBvdXRzaWRlIGEgc3lzY2FsbCBhc3NvY2lhdGVkIHRvIGl0cyBm
aWxlCi0JICogZGVzY3JpcHRvciwgeW91IG5lZWQgdG8gaG9sZAotCSAqIGRldl9wcml2LT5kcm0u
c3RydWN0X211dGV4LgorCSAqIGRlc2NyaXB0b3IuCiAJICovCiAJc3RydWN0IGk5MTVfcGVyZl9z
dHJlYW0gKmV4Y2x1c2l2ZV9zdHJlYW07CiAKLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRl
bC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
L21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

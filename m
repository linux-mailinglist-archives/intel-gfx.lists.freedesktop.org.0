Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 32CCD7ACB2
	for <lists+intel-gfx@lfdr.de>; Tue, 30 Jul 2019 17:49:06 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 021766E5AA;
	Tue, 30 Jul 2019 15:49:04 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 393E96E5AA
 for <intel-gfx@lists.freedesktop.org>; Tue, 30 Jul 2019 15:49:02 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17734078-1500050 
 for multiple; Tue, 30 Jul 2019 16:48:54 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 30 Jul 2019 16:48:53 +0100
Message-Id: <20190730154853.19157-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.22.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/selftests: Pass intel_context to
 igt_spinner
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGVhY2ggaWd0X3NwaW5uZXIgdG8gb25seSB1c2Ugb3VyIGludGVybmFsIHN0cnVjdHMsIGRlY291
cGxpbmcgdGhlCmludGVyZmFjZSBmcm9tIHRoZSBHRU0gY29udGV4dHMuIFRoaXMgbWFrZXMgaXQg
ZWFzaWVyIHRvIGF2b2lkCnJlcXVpcmluZyBjZS0+Z2VtX2NvbnRleHQgYmFjayByZWZlcmVuY2Vz
IGZvciBrZXJuZWxfY29udGV4dCB0aGF0IG1heQpoYXZlIHRoZW0gaW4gZnV0dXJlLgoKU2lnbmVk
LW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0tLQogLi4u
L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jIHwgIDQzICsrKy0tLS0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jICAgICAgICB8IDExNSArKysr
KysrKysrLS0tLS0tLS0KIC4uLi9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29ya2Fyb3VuZHMu
YyAgICB8ICAyMyArKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X3NwaW5u
ZXIuYyAgfCAgMzIgKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3Rfc3Bp
bm5lci5oICB8ICAgNiArLQogNSBmaWxlcyBjaGFuZ2VkLCAxMTkgaW5zZXJ0aW9ucygrKSwgMTAw
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxm
dGVzdHMvaTkxNV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0
ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXggN2Y5ZjY3MDFiMzJjLi5jMjQ0MzAzNTJhMzgg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1f
Y29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9n
ZW1fY29udGV4dC5jCkBAIC04MjEsOCArODIxLDcgQEAgZW1pdF9ycGNzX3F1ZXJ5KHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAjZGVmaW5lIFRFU1RfUkVTRVQJQklUKDIpCiAKIHN0
YXRpYyBpbnQKLV9fc3NldV9wcmVwYXJlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAot
CSAgICAgICBjb25zdCBjaGFyICpuYW1lLAorX19zc2V1X3ByZXBhcmUoY29uc3QgY2hhciAqbmFt
ZSwKIAkgICAgICAgdW5zaWduZWQgaW50IGZsYWdzLAogCSAgICAgICBzdHJ1Y3QgaW50ZWxfY29u
dGV4dCAqY2UsCiAJICAgICAgIHN0cnVjdCBpZ3Rfc3Bpbm5lciAqKnNwaW4pCkBAIC04MzgsMTQg
KzgzNywxMSBAQCBfX3NzZXVfcHJlcGFyZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwK
IAlpZiAoISpzcGluKQogCQlyZXR1cm4gLUVOT01FTTsKIAotCXJldCA9IGlndF9zcGlubmVyX2lu
aXQoKnNwaW4sIGk5MTUpOworCXJldCA9IGlndF9zcGlubmVyX2luaXQoKnNwaW4sIGNlLT5lbmdp
bmUtPmd0KTsKIAlpZiAocmV0KQogCQlnb3RvIGVycl9mcmVlOwogCi0JcnEgPSBpZ3Rfc3Bpbm5l
cl9jcmVhdGVfcmVxdWVzdCgqc3BpbiwKLQkJCQkJY2UtPmdlbV9jb250ZXh0LAotCQkJCQljZS0+
ZW5naW5lLAotCQkJCQlNSV9OT09QKTsKKwlycSA9IGlndF9zcGlubmVyX2NyZWF0ZV9yZXF1ZXN0
KCpzcGluLCBjZSwgTUlfTk9PUCk7CiAJaWYgKElTX0VSUihycSkpIHsKIAkJcmV0ID0gUFRSX0VS
UihycSk7CiAJCWdvdG8gZXJyX2Zpbmk7CkBAIC04NzEsOCArODY3LDcgQEAgX19zc2V1X3ByZXBh
cmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiB9CiAKIHN0YXRpYyBpbnQKLV9fcmVh
ZF9zbGljZV9jb3VudChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKLQkJICAgc3RydWN0
IGludGVsX2NvbnRleHQgKmNlLAorX19yZWFkX3NsaWNlX2NvdW50KHN0cnVjdCBpbnRlbF9jb250
ZXh0ICpjZSwKIAkJICAgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJICAgc3Ry
dWN0IGlndF9zcGlubmVyICpzcGluLAogCQkgICB1MzIgKnJwY3MpCkBAIC05MDEsNyArODk2LDcg
QEAgX19yZWFkX3NsaWNlX2NvdW50KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQly
ZXR1cm4gcmV0OwogCX0KIAotCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gMTEpIHsKKwlpZiAoSU5U
RUxfR0VOKGNlLT5lbmdpbmUtPmk5MTUpID49IDExKSB7CiAJCXNfbWFzayA9IEdFTjExX1JQQ1Nf
U19DTlRfTUFTSzsKIAkJc19zaGlmdCA9IEdFTjExX1JQQ1NfU19DTlRfU0hJRlQ7CiAJfSBlbHNl
IHsKQEAgLTk0NCw4ICs5MzksNyBAQCBfX2NoZWNrX3JwY3MoY29uc3QgY2hhciAqbmFtZSwgdTMy
IHJwY3MsIGludCBzbGljZXMsIHVuc2lnbmVkIGludCBleHBlY3RlZCwKIH0KIAogc3RhdGljIGlu
dAotX19zc2V1X2ZpbmlzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKLQkgICAgICBj
b25zdCBjaGFyICpuYW1lLAorX19zc2V1X2ZpbmlzaChjb25zdCBjaGFyICpuYW1lLAogCSAgICAg
IHVuc2lnbmVkIGludCBmbGFncywKIAkgICAgICBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJ
ICAgICAgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKQEAgLTk2MiwxNCArOTU2LDEz
IEBAIF9fc3NldV9maW5pc2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQlnb3Rv
IG91dDsKIAl9CiAKLQlyZXQgPSBfX3JlYWRfc2xpY2VfY291bnQoaTkxNSwgY2UsIG9iaiwKKwly
ZXQgPSBfX3JlYWRfc2xpY2VfY291bnQoY2UsIG9iaiwKIAkJCQkgZmxhZ3MgJiBURVNUX1JFU0VU
ID8gTlVMTCA6IHNwaW4sICZycGNzKTsKIAlyZXQgPSBfX2NoZWNrX3JwY3MobmFtZSwgcnBjcywg
cmV0LCBleHBlY3RlZCwgIkNvbnRleHQiLCAiISIpOwogCWlmIChyZXQpCiAJCWdvdG8gb3V0Owog
Ci0JcmV0ID0gX19yZWFkX3NsaWNlX2NvdW50KGk5MTUsIGNlLT5lbmdpbmUtPmtlcm5lbF9jb250
ZXh0LCBvYmosCi0JCQkJIE5VTEwsICZycGNzKTsKKwlyZXQgPSBfX3JlYWRfc2xpY2VfY291bnQo
Y2UtPmVuZ2luZS0+a2VybmVsX2NvbnRleHQsIG9iaiwgTlVMTCwgJnJwY3MpOwogCXJldCA9IF9f
Y2hlY2tfcnBjcyhuYW1lLCBycGNzLCByZXQsIHNsaWNlcywgIktlcm5lbCBjb250ZXh0IiwgIiEi
KTsKIAogb3V0OgpAQCAtOTc3LDExICs5NzAsMTIgQEAgX19zc2V1X2ZpbmlzaChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJaWd0X3NwaW5uZXJfZW5kKHNwaW4pOwogCiAJaWYgKChm
bGFncyAmIFRFU1RfSURMRSkgJiYgcmV0ID09IDApIHsKLQkJcmV0ID0gaTkxNV9nZW1fd2FpdF9m
b3JfaWRsZShpOTE1LCAwLCBNQVhfU0NIRURVTEVfVElNRU9VVCk7CisJCXJldCA9IGk5MTVfZ2Vt
X3dhaXRfZm9yX2lkbGUoY2UtPmVuZ2luZS0+aTkxNSwKKwkJCQkJICAgICAwLCBNQVhfU0NIRURV
TEVfVElNRU9VVCk7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0OwogCi0JCXJldCA9IF9fcmVh
ZF9zbGljZV9jb3VudChpOTE1LCBjZSwgb2JqLCBOVUxMLCAmcnBjcyk7CisJCXJldCA9IF9fcmVh
ZF9zbGljZV9jb3VudChjZSwgb2JqLCBOVUxMLCAmcnBjcyk7CiAJCXJldCA9IF9fY2hlY2tfcnBj
cyhuYW1lLCBycGNzLCByZXQsIGV4cGVjdGVkLAogCQkJCSAgICJDb250ZXh0IiwgIiBhZnRlciBp
ZGxlISIpOwogCX0KQEAgLTk5MCw4ICs5ODQsNyBAQCBfX3NzZXVfZmluaXNoKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1LAogfQogCiBzdGF0aWMgaW50Ci1fX3NzZXVfdGVzdChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKLQkgICAgY29uc3QgY2hhciAqbmFtZSwKK19fc3NldV90
ZXN0KGNvbnN0IGNoYXIgKm5hbWUsCiAJICAgIHVuc2lnbmVkIGludCBmbGFncywKIAkgICAgc3Ry
dWN0IGludGVsX2NvbnRleHQgKmNlLAogCSAgICBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqLApAQCAtMTAwMCw3ICs5OTMsNyBAQCBfX3NzZXVfdGVzdChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwKIAlzdHJ1Y3QgaWd0X3NwaW5uZXIgKnNwaW4gPSBOVUxMOwogCWludCByZXQ7
CiAKLQlyZXQgPSBfX3NzZXVfcHJlcGFyZShpOTE1LCBuYW1lLCBmbGFncywgY2UsICZzcGluKTsK
KwlyZXQgPSBfX3NzZXVfcHJlcGFyZShuYW1lLCBmbGFncywgY2UsICZzcGluKTsKIAlpZiAocmV0
KQogCQlyZXR1cm4gcmV0OwogCkBAIC0xMDA4LDcgKzEwMDEsNyBAQCBfX3NzZXVfdGVzdChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlpZiAocmV0KQogCQlnb3RvIG91dF9zcGluOwog
Ci0JcmV0ID0gX19zc2V1X2ZpbmlzaChpOTE1LCBuYW1lLCBmbGFncywgY2UsIG9iaiwKKwlyZXQg
PSBfX3NzZXVfZmluaXNoKG5hbWUsIGZsYWdzLCBjZSwgb2JqLAogCQkJICAgIGh3ZWlnaHQzMihz
c2V1LnNsaWNlX21hc2spLCBzcGluKTsKIAogb3V0X3NwaW46CkBAIC0xMDg4LDIyICsxMDgxLDIy
IEBAIF9faWd0X2N0eF9zc2V1KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQlnb3Rv
IG91dF9jb250ZXh0OwogCiAJLyogRmlyc3Qgc2V0IHRoZSBkZWZhdWx0IG1hc2suICovCi0JcmV0
ID0gX19zc2V1X3Rlc3QoaTkxNSwgbmFtZSwgZmxhZ3MsIGNlLCBvYmosIGVuZ2luZS0+c3NldSk7
CisJcmV0ID0gX19zc2V1X3Rlc3QobmFtZSwgZmxhZ3MsIGNlLCBvYmosIGVuZ2luZS0+c3NldSk7
CiAJaWYgKHJldCkKIAkJZ290byBvdXRfZmFpbDsKIAogCS8qIFRoZW4gc2V0IGEgcG93ZXItZ2F0
ZWQgY29uZmlndXJhdGlvbi4gKi8KLQlyZXQgPSBfX3NzZXVfdGVzdChpOTE1LCBuYW1lLCBmbGFn
cywgY2UsIG9iaiwgcGdfc3NldSk7CisJcmV0ID0gX19zc2V1X3Rlc3QobmFtZSwgZmxhZ3MsIGNl
LCBvYmosIHBnX3NzZXUpOwogCWlmIChyZXQpCiAJCWdvdG8gb3V0X2ZhaWw7CiAKIAkvKiBCYWNr
IHRvIGRlZmF1bHRzLiAqLwotCXJldCA9IF9fc3NldV90ZXN0KGk5MTUsIG5hbWUsIGZsYWdzLCBj
ZSwgb2JqLCBlbmdpbmUtPnNzZXUpOworCXJldCA9IF9fc3NldV90ZXN0KG5hbWUsIGZsYWdzLCBj
ZSwgb2JqLCBlbmdpbmUtPnNzZXUpOwogCWlmIChyZXQpCiAJCWdvdG8gb3V0X2ZhaWw7CiAKIAkv
KiBPbmUgbGFzdCBwb3dlci1nYXRlZCBjb25maWd1cmF0aW9uIGZvciB0aGUgcm9hZC4gKi8KLQly
ZXQgPSBfX3NzZXVfdGVzdChpOTE1LCBuYW1lLCBmbGFncywgY2UsIG9iaiwgcGdfc3NldSk7CisJ
cmV0ID0gX19zc2V1X3Rlc3QobmFtZSwgZmxhZ3MsIGNlLCBvYmosIHBnX3NzZXUpOwogCWlmIChy
ZXQpCiAJCWdvdG8gb3V0X2ZhaWw7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3NlbGZ0ZXN0X2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJj
LmMKaW5kZXggNjBmMjdlNTJkMjY3Li5iNDBiNTdkMmRhYWUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3NlbGZ0ZXN0X2xyYy5jCkBAIC0yMiw5ICsyMiw5IEBACiBzdGF0aWMgaW50IGxpdmVfc2Fu
aXR5Y2hlY2sodm9pZCAqYXJnKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
YXJnOwotCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKKwlzdHJ1Y3QgaTkxNV9nZW1f
ZW5naW5lc19pdGVyIGl0OwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7Ci0JZW51bSBp
bnRlbF9lbmdpbmVfaWQgaWQ7CisJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCXN0cnVjdCBp
Z3Rfc3Bpbm5lciBzcGluOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCWludCBlcnIgPSAt
RU5PTUVNOwpAQCAtMzUsMTcgKzM1LDE3IEBAIHN0YXRpYyBpbnQgbGl2ZV9zYW5pdHljaGVjayh2
b2lkICphcmcpCiAJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJd2FrZXJl
ZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKIAotCWlmIChpZ3Rf
c3Bpbm5lcl9pbml0KCZzcGluLCBpOTE1KSkKKwlpZiAoaWd0X3NwaW5uZXJfaW5pdCgmc3Bpbiwg
Jmk5MTUtPmd0KSkKIAkJZ290byBlcnJfdW5sb2NrOwogCiAJY3R4ID0ga2VybmVsX2NvbnRleHQo
aTkxNSk7CiAJaWYgKCFjdHgpCiAJCWdvdG8gZXJyX3NwaW47CiAKLQlmb3JfZWFjaF9lbmdpbmUo
ZW5naW5lLCBpOTE1LCBpZCkgeworCWZvcl9lYWNoX2dlbV9lbmdpbmUoY2UsIGk5MTVfZ2VtX2Nv
bnRleHRfbG9ja19lbmdpbmVzKGN0eCksIGl0KSB7CiAJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
OwogCi0JCXJxID0gaWd0X3NwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJnNwaW4sIGN0eCwgZW5naW5l
LCBNSV9OT09QKTsKKwkJcnEgPSBpZ3Rfc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmc3BpbiwgY2Us
IE1JX05PT1ApOwogCQlpZiAoSVNfRVJSKHJxKSkgewogCQkJZXJyID0gUFRSX0VSUihycSk7CiAJ
CQlnb3RvIGVycl9jdHg7CkBAIC02OSw2ICs2OSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9zYW5pdHlj
aGVjayh2b2lkICphcmcpCiAKIAllcnIgPSAwOwogZXJyX2N0eDoKKwlpOTE1X2dlbV9jb250ZXh0
X3VubG9ja19lbmdpbmVzKGN0eCk7CiAJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsKIGVycl9z
cGluOgogCWlndF9zcGlubmVyX2ZpbmkoJnNwaW4pOwpAQCAtNDgwLDYgKzQ4MSwyNCBAQCBzdGF0
aWMgaW50IGxpdmVfYnVzeXdhaXRfcHJlZW1wdCh2b2lkICphcmcpCiAJcmV0dXJuIGVycjsKIH0K
IAorc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3QgKgorc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdChz
dHJ1Y3QgaWd0X3NwaW5uZXIgKnNwaW4sCisJCSAgICAgICBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqY3R4LAorCQkgICAgICAgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAorCQkgICAg
ICAgdTMyIGFyYikKK3sKKwlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CisJc3RydWN0IGk5MTVf
cmVxdWVzdCAqcnE7CisKKwljZSA9IGk5MTVfZ2VtX2NvbnRleHRfZ2V0X2VuZ2luZShjdHgsIGVu
Z2luZS0+aWQpOworCWlmIChJU19FUlIoY2UpKQorCQlyZXR1cm4gRVJSX0NBU1QoY2UpOworCisJ
cnEgPSBpZ3Rfc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdChzcGluLCBjZSwgYXJiKTsKKwlpbnRlbF9j
b250ZXh0X3B1dChjZSk7CisJcmV0dXJuIHJxOworfQorCiBzdGF0aWMgaW50IGxpdmVfcHJlZW1w
dCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CkBA
IC00OTksMTAgKzUxOCwxMCBAQCBzdGF0aWMgaW50IGxpdmVfcHJlZW1wdCh2b2lkICphcmcpCiAJ
bXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJd2FrZXJlZiA9IGludGVsX3J1
bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKIAotCWlmIChpZ3Rfc3Bpbm5lcl9pbml0
KCZzcGluX2hpLCBpOTE1KSkKKwlpZiAoaWd0X3NwaW5uZXJfaW5pdCgmc3Bpbl9oaSwgJmk5MTUt
Pmd0KSkKIAkJZ290byBlcnJfdW5sb2NrOwogCi0JaWYgKGlndF9zcGlubmVyX2luaXQoJnNwaW5f
bG8sIGk5MTUpKQorCWlmIChpZ3Rfc3Bpbm5lcl9pbml0KCZzcGluX2xvLCAmaTkxNS0+Z3QpKQog
CQlnb3RvIGVycl9zcGluX2hpOwogCiAJY3R4X2hpID0ga2VybmVsX2NvbnRleHQoaTkxNSk7CkBA
IC01MjksOCArNTQ4LDggQEAgc3RhdGljIGludCBsaXZlX3ByZWVtcHQodm9pZCAqYXJnKQogCQkJ
Z290byBlcnJfY3R4X2xvOwogCQl9CiAKLQkJcnEgPSBpZ3Rfc3Bpbm5lcl9jcmVhdGVfcmVxdWVz
dCgmc3Bpbl9sbywgY3R4X2xvLCBlbmdpbmUsCi0JCQkJCQlNSV9BUkJfQ0hFQ0spOworCQlycSA9
IHNwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJnNwaW5fbG8sIGN0eF9sbywgZW5naW5lLAorCQkJCQkg
ICAgTUlfQVJCX0NIRUNLKTsKIAkJaWYgKElTX0VSUihycSkpIHsKIAkJCWVyciA9IFBUUl9FUlIo
cnEpOwogCQkJZ290byBlcnJfY3R4X2xvOwpAQCAtNTQ1LDggKzU2NCw4IEBAIHN0YXRpYyBpbnQg
bGl2ZV9wcmVlbXB0KHZvaWQgKmFyZykKIAkJCWdvdG8gZXJyX2N0eF9sbzsKIAkJfQogCi0JCXJx
ID0gaWd0X3NwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJnNwaW5faGksIGN0eF9oaSwgZW5naW5lLAot
CQkJCQkJTUlfQVJCX0NIRUNLKTsKKwkJcnEgPSBzcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZzcGlu
X2hpLCBjdHhfaGksIGVuZ2luZSwKKwkJCQkJICAgIE1JX0FSQl9DSEVDSyk7CiAJCWlmIChJU19F
UlIocnEpKSB7CiAJCQlpZ3Rfc3Bpbm5lcl9lbmQoJnNwaW5fbG8pOwogCQkJZXJyID0gUFRSX0VS
UihycSk7CkBAIC02MDMsMTAgKzYyMiwxMCBAQCBzdGF0aWMgaW50IGxpdmVfbGF0ZV9wcmVlbXB0
KHZvaWQgKmFyZykKIAltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAl3YWtl
cmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwogCi0JaWYgKGln
dF9zcGlubmVyX2luaXQoJnNwaW5faGksIGk5MTUpKQorCWlmIChpZ3Rfc3Bpbm5lcl9pbml0KCZz
cGluX2hpLCAmaTkxNS0+Z3QpKQogCQlnb3RvIGVycl91bmxvY2s7CiAKLQlpZiAoaWd0X3NwaW5u
ZXJfaW5pdCgmc3Bpbl9sbywgaTkxNSkpCisJaWYgKGlndF9zcGlubmVyX2luaXQoJnNwaW5fbG8s
ICZpOTE1LT5ndCkpCiAJCWdvdG8gZXJyX3NwaW5faGk7CiAKIAljdHhfaGkgPSBrZXJuZWxfY29u
dGV4dChpOTE1KTsKQEAgLTYzMiw4ICs2NTEsOCBAQCBzdGF0aWMgaW50IGxpdmVfbGF0ZV9wcmVl
bXB0KHZvaWQgKmFyZykKIAkJCWdvdG8gZXJyX2N0eF9sbzsKIAkJfQogCi0JCXJxID0gaWd0X3Nw
aW5uZXJfY3JlYXRlX3JlcXVlc3QoJnNwaW5fbG8sIGN0eF9sbywgZW5naW5lLAotCQkJCQkJTUlf
QVJCX0NIRUNLKTsKKwkJcnEgPSBzcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZzcGluX2xvLCBjdHhf
bG8sIGVuZ2luZSwKKwkJCQkJICAgIE1JX0FSQl9DSEVDSyk7CiAJCWlmIChJU19FUlIocnEpKSB7
CiAJCQllcnIgPSBQVFJfRVJSKHJxKTsKIAkJCWdvdG8gZXJyX2N0eF9sbzsKQEAgLTY0NSw4ICs2
NjQsOCBAQCBzdGF0aWMgaW50IGxpdmVfbGF0ZV9wcmVlbXB0KHZvaWQgKmFyZykKIAkJCWdvdG8g
ZXJyX3dlZGdlZDsKIAkJfQogCi0JCXJxID0gaWd0X3NwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJnNw
aW5faGksIGN0eF9oaSwgZW5naW5lLAotCQkJCQkJTUlfTk9PUCk7CisJCXJxID0gc3Bpbm5lcl9j
cmVhdGVfcmVxdWVzdCgmc3Bpbl9oaSwgY3R4X2hpLCBlbmdpbmUsCisJCQkJCSAgICBNSV9OT09Q
KTsKIAkJaWYgKElTX0VSUihycSkpIHsKIAkJCWlndF9zcGlubmVyX2VuZCgmc3Bpbl9sbyk7CiAJ
CQllcnIgPSBQVFJfRVJSKHJxKTsKQEAgLTcxMSw3ICs3MzAsNyBAQCBzdGF0aWMgaW50IHByZWVt
cHRfY2xpZW50X2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJaWYgKCFjLT5j
dHgpCiAJCXJldHVybiAtRU5PTUVNOwogCi0JaWYgKGlndF9zcGlubmVyX2luaXQoJmMtPnNwaW4s
IGk5MTUpKQorCWlmIChpZ3Rfc3Bpbm5lcl9pbml0KCZjLT5zcGluLCAmaTkxNS0+Z3QpKQogCQln
b3RvIGVycl9jdHg7CiAKIAlyZXR1cm4gMDsKQEAgLTc2MSw5ICs3ODAsOSBAQCBzdGF0aWMgaW50
IGxpdmVfbm9wcmVlbXB0KHZvaWQgKmFyZykKIAogCQllbmdpbmUtPmV4ZWNsaXN0cy5wcmVlbXB0
X2hhbmcuY291bnQgPSAwOwogCi0JCXJxX2EgPSBpZ3Rfc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgm
YS5zcGluLAotCQkJCQkJICBhLmN0eCwgZW5naW5lLAotCQkJCQkJICBNSV9BUkJfQ0hFQ0spOwor
CQlycV9hID0gc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmYS5zcGluLAorCQkJCQkgICAgICBhLmN0
eCwgZW5naW5lLAorCQkJCQkgICAgICBNSV9BUkJfQ0hFQ0spOwogCQlpZiAoSVNfRVJSKHJxX2Ep
KSB7CiAJCQllcnIgPSBQVFJfRVJSKHJxX2EpOwogCQkJZ290byBlcnJfY2xpZW50X2I7CkBAIC03
NzgsOSArNzk3LDkgQEAgc3RhdGljIGludCBsaXZlX25vcHJlZW1wdCh2b2lkICphcmcpCiAJCQln
b3RvIGVycl93ZWRnZWQ7CiAJCX0KIAotCQlycV9iID0gaWd0X3NwaW5uZXJfY3JlYXRlX3JlcXVl
c3QoJmIuc3BpbiwKLQkJCQkJCSAgYi5jdHgsIGVuZ2luZSwKLQkJCQkJCSAgTUlfQVJCX0NIRUNL
KTsKKwkJcnFfYiA9IHNwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJmIuc3BpbiwKKwkJCQkJICAgICAg
Yi5jdHgsIGVuZ2luZSwKKwkJCQkJICAgICAgTUlfQVJCX0NIRUNLKTsKIAkJaWYgKElTX0VSUihy
cV9iKSkgewogCQkJZXJyID0gUFRSX0VSUihycV9iKTsKIAkJCWdvdG8gZXJyX2NsaWVudF9iOwpA
QCAtODgwLDkgKzg5OSw5IEBAIHN0YXRpYyBpbnQgbGl2ZV9zdXBwcmVzc19zZWxmX3ByZWVtcHQo
dm9pZCAqYXJnKQogCiAJCWVuZ2luZS0+ZXhlY2xpc3RzLnByZWVtcHRfaGFuZy5jb3VudCA9IDA7
CiAKLQkJcnFfYSA9IGlndF9zcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZhLnNwaW4sCi0JCQkJCQkg
IGEuY3R4LCBlbmdpbmUsCi0JCQkJCQkgIE1JX05PT1ApOworCQlycV9hID0gc3Bpbm5lcl9jcmVh
dGVfcmVxdWVzdCgmYS5zcGluLAorCQkJCQkgICAgICBhLmN0eCwgZW5naW5lLAorCQkJCQkgICAg
ICBNSV9OT09QKTsKIAkJaWYgKElTX0VSUihycV9hKSkgewogCQkJZXJyID0gUFRSX0VSUihycV9h
KTsKIAkJCWdvdG8gZXJyX2NsaWVudF9iOwpAQCAtODk1LDkgKzkxNCw5IEBAIHN0YXRpYyBpbnQg
bGl2ZV9zdXBwcmVzc19zZWxmX3ByZWVtcHQodm9pZCAqYXJnKQogCQl9CiAKIAkJZm9yIChkZXB0
aCA9IDA7IGRlcHRoIDwgODsgZGVwdGgrKykgewotCQkJcnFfYiA9IGlndF9zcGlubmVyX2NyZWF0
ZV9yZXF1ZXN0KCZiLnNwaW4sCi0JCQkJCQkJICBiLmN0eCwgZW5naW5lLAotCQkJCQkJCSAgTUlf
Tk9PUCk7CisJCQlycV9iID0gc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmYi5zcGluLAorCQkJCQkJ
ICAgICAgYi5jdHgsIGVuZ2luZSwKKwkJCQkJCSAgICAgIE1JX05PT1ApOwogCQkJaWYgKElTX0VS
UihycV9iKSkgewogCQkJCWVyciA9IFBUUl9FUlIocnFfYik7CiAJCQkJZ290byBlcnJfY2xpZW50
X2I7CkBAIC0xMDQ4LDkgKzEwNjcsOSBAQCBzdGF0aWMgaW50IGxpdmVfc3VwcHJlc3Nfd2FpdF9w
cmVlbXB0KHZvaWQgKmFyZykKIAkJCQlnb3RvIGVycl9jbGllbnRfMzsKIAogCQkJZm9yIChpID0g
MDsgaSA8IEFSUkFZX1NJWkUoY2xpZW50KTsgaSsrKSB7Ci0JCQkJcnFbaV0gPSBpZ3Rfc3Bpbm5l
cl9jcmVhdGVfcmVxdWVzdCgmY2xpZW50W2ldLnNwaW4sCi0JCQkJCQkJCSAgIGNsaWVudFtpXS5j
dHgsIGVuZ2luZSwKLQkJCQkJCQkJICAgTUlfTk9PUCk7CisJCQkJcnFbaV0gPSBzcGlubmVyX2Ny
ZWF0ZV9yZXF1ZXN0KCZjbGllbnRbaV0uc3BpbiwKKwkJCQkJCQkgICAgICAgY2xpZW50W2ldLmN0
eCwgZW5naW5lLAorCQkJCQkJCSAgICAgICBNSV9OT09QKTsKIAkJCQlpZiAoSVNfRVJSKHJxW2ld
KSkgewogCQkJCQllcnIgPSBQVFJfRVJSKHJxW2ldKTsKIAkJCQkJZ290byBlcnJfd2VkZ2VkOwpA
QCAtMTE1Nyw5ICsxMTc2LDkgQEAgc3RhdGljIGludCBsaXZlX2NoYWluX3ByZWVtcHQodm9pZCAq
YXJnKQogCQlpZiAoIWludGVsX2VuZ2luZV9oYXNfcHJlZW1wdGlvbihlbmdpbmUpKQogCQkJY29u
dGludWU7CiAKLQkJcnEgPSBpZ3Rfc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmbG8uc3BpbiwKLQkJ
CQkJCWxvLmN0eCwgZW5naW5lLAotCQkJCQkJTUlfQVJCX0NIRUNLKTsKKwkJcnEgPSBzcGlubmVy
X2NyZWF0ZV9yZXF1ZXN0KCZsby5zcGluLAorCQkJCQkgICAgbG8uY3R4LCBlbmdpbmUsCisJCQkJ
CSAgICBNSV9BUkJfQ0hFQ0spOwogCQlpZiAoSVNfRVJSKHJxKSkKIAkJCWdvdG8gZXJyX3dlZGdl
ZDsKIAkJaTkxNV9yZXF1ZXN0X2FkZChycSk7CkBAIC0xMTgzLDE4ICsxMjAyLDE4IEBAIHN0YXRp
YyBpbnQgbGl2ZV9jaGFpbl9wcmVlbXB0KHZvaWQgKmFyZykKIAkJfQogCiAJCWZvcl9lYWNoX3By
aW1lX251bWJlcl9mcm9tKGNvdW50LCAxLCByaW5nX3NpemUpIHsKLQkJCXJxID0gaWd0X3NwaW5u
ZXJfY3JlYXRlX3JlcXVlc3QoJmhpLnNwaW4sCi0JCQkJCQkJaGkuY3R4LCBlbmdpbmUsCi0JCQkJ
CQkJTUlfQVJCX0NIRUNLKTsKKwkJCXJxID0gc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmaGkuc3Bp
biwKKwkJCQkJCSAgICBoaS5jdHgsIGVuZ2luZSwKKwkJCQkJCSAgICBNSV9BUkJfQ0hFQ0spOwog
CQkJaWYgKElTX0VSUihycSkpCiAJCQkJZ290byBlcnJfd2VkZ2VkOwogCQkJaTkxNV9yZXF1ZXN0
X2FkZChycSk7CiAJCQlpZiAoIWlndF93YWl0X2Zvcl9zcGlubmVyKCZoaS5zcGluLCBycSkpCiAJ
CQkJZ290byBlcnJfd2VkZ2VkOwogCi0JCQlycSA9IGlndF9zcGlubmVyX2NyZWF0ZV9yZXF1ZXN0
KCZsby5zcGluLAotCQkJCQkJCWxvLmN0eCwgZW5naW5lLAotCQkJCQkJCU1JX0FSQl9DSEVDSyk7
CisJCQlycSA9IHNwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJmxvLnNwaW4sCisJCQkJCQkgICAgbG8u
Y3R4LCBlbmdpbmUsCisJCQkJCQkgICAgTUlfQVJCX0NIRUNLKTsKIAkJCWlmIChJU19FUlIocnEp
KQogCQkJCWdvdG8gZXJyX3dlZGdlZDsKIAkJCWk5MTVfcmVxdWVzdF9hZGQocnEpOwpAQCAtMTI4
NCwxMCArMTMwMywxMCBAQCBzdGF0aWMgaW50IGxpdmVfcHJlZW1wdF9oYW5nKHZvaWQgKmFyZykK
IAltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAl3YWtlcmVmID0gaW50ZWxf
cnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwogCi0JaWYgKGlndF9zcGlubmVyX2lu
aXQoJnNwaW5faGksIGk5MTUpKQorCWlmIChpZ3Rfc3Bpbm5lcl9pbml0KCZzcGluX2hpLCAmaTkx
NS0+Z3QpKQogCQlnb3RvIGVycl91bmxvY2s7CiAKLQlpZiAoaWd0X3NwaW5uZXJfaW5pdCgmc3Bp
bl9sbywgaTkxNSkpCisJaWYgKGlndF9zcGlubmVyX2luaXQoJnNwaW5fbG8sICZpOTE1LT5ndCkp
CiAJCWdvdG8gZXJyX3NwaW5faGk7CiAKIAljdHhfaGkgPSBrZXJuZWxfY29udGV4dChpOTE1KTsK
QEAgLTEzMDgsOCArMTMyNyw4IEBAIHN0YXRpYyBpbnQgbGl2ZV9wcmVlbXB0X2hhbmcodm9pZCAq
YXJnKQogCQlpZiAoIWludGVsX2VuZ2luZV9oYXNfcHJlZW1wdGlvbihlbmdpbmUpKQogCQkJY29u
dGludWU7CiAKLQkJcnEgPSBpZ3Rfc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmc3Bpbl9sbywgY3R4
X2xvLCBlbmdpbmUsCi0JCQkJCQlNSV9BUkJfQ0hFQ0spOworCQlycSA9IHNwaW5uZXJfY3JlYXRl
X3JlcXVlc3QoJnNwaW5fbG8sIGN0eF9sbywgZW5naW5lLAorCQkJCQkgICAgTUlfQVJCX0NIRUNL
KTsKIAkJaWYgKElTX0VSUihycSkpIHsKIAkJCWVyciA9IFBUUl9FUlIocnEpOwogCQkJZ290byBl
cnJfY3R4X2xvOwpAQCAtMTMyNCw4ICsxMzQzLDggQEAgc3RhdGljIGludCBsaXZlX3ByZWVtcHRf
aGFuZyh2b2lkICphcmcpCiAJCQlnb3RvIGVycl9jdHhfbG87CiAJCX0KIAotCQlycSA9IGlndF9z
cGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZzcGluX2hpLCBjdHhfaGksIGVuZ2luZSwKLQkJCQkJCU1J
X0FSQl9DSEVDSyk7CisJCXJxID0gc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmc3Bpbl9oaSwgY3R4
X2hpLCBlbmdpbmUsCisJCQkJCSAgICBNSV9BUkJfQ0hFQ0spOwogCQlpZiAoSVNfRVJSKHJxKSkg
ewogCQkJaWd0X3NwaW5uZXJfZW5kKCZzcGluX2xvKTsKIAkJCWVyciA9IFBUUl9FUlIocnEpOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29ya2Fyb3VuZHMu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMKaW5kZXgg
YWIxNDc5ODVmYTc0Li5mYzA1OWFiM2QzZjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Qvc2VsZnRlc3Rfd29ya2Fyb3VuZHMuYwpAQCAtMjM4LDYgKzIzOCw3IEBAIHN3aXRjaF90b19z
Y3JhdGNoX2NvbnRleHQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCQkJICBzdHJ1
Y3QgaWd0X3NwaW5uZXIgKnNwaW4pCiB7CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsK
KwlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CiAJ
aW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJaW50IGVyciA9IDA7CkBAIC0yNDgsMTAgKzI0OSwx
NCBAQCBzd2l0Y2hfdG9fc2NyYXRjaF9jb250ZXh0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSwKIAogCUdFTV9CVUdfT04oaTkxNV9nZW1fY29udGV4dF9pc19iYW5uYWJsZShjdHgpKTsK
IAorCWNlID0gaTkxNV9nZW1fY29udGV4dF9nZXRfZW5naW5lKGN0eCwgZW5naW5lLT5pZCk7CisJ
R0VNX0JVR19PTihJU19FUlIoY2UpKTsKKwogCXJxID0gRVJSX1BUUigtRU5PREVWKTsKIAl3aXRo
X2ludGVsX3J1bnRpbWVfcG0oJmVuZ2luZS0+aTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZikKLQkJ
cnEgPSBpZ3Rfc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdChzcGluLCBjdHgsIGVuZ2luZSwgTUlfTk9P
UCk7CisJCXJxID0gaWd0X3NwaW5uZXJfY3JlYXRlX3JlcXVlc3Qoc3BpbiwgY2UsTUlfTk9PUCk7
CiAKKwlpbnRlbF9jb250ZXh0X3B1dChjZSk7CiAJa2VybmVsX2NvbnRleHRfY2xvc2UoY3R4KTsK
IAogCWlmIChJU19FUlIocnEpKSB7CkBAIC0yOTEsNyArMjk2LDcgQEAgc3RhdGljIGludCBjaGVj
a193aGl0ZWxpc3RfYWNyb3NzX3Jlc2V0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwK
IAlpZiAoSVNfRVJSKGN0eCkpCiAJCXJldHVybiBQVFJfRVJSKGN0eCk7CiAKLQllcnIgPSBpZ3Rf
c3Bpbm5lcl9pbml0KCZzcGluLCBpOTE1KTsKKwllcnIgPSBpZ3Rfc3Bpbm5lcl9pbml0KCZzcGlu
LCBlbmdpbmUtPmd0KTsKIAlpZiAoZXJyKQogCQlnb3RvIG91dF9jdHg7CiAKQEAgLTExNjUsNiAr
MTE3MCw3IEBAIGxpdmVfZW5naW5lX3Jlc2V0X3dvcmthcm91bmRzKHZvaWQgKmFyZykKIAlyZWZl
cmVuY2VfbGlzdHNfaW5pdChpOTE1LCAmbGlzdHMpOwogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2lu
ZSwgaTkxNSwgaWQpIHsKKwkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCQlib29sIG9rOwog
CiAJCXByX2luZm8oIlZlcmlmeWluZyBhZnRlciAlcyByZXNldC4uLlxuIiwgZW5naW5lLT5uYW1l
KTsKQEAgLTExODMsMTEgKzExODksMTYgQEAgbGl2ZV9lbmdpbmVfcmVzZXRfd29ya2Fyb3VuZHMo
dm9pZCAqYXJnKQogCQkJZ290byBlcnI7CiAJCX0KIAotCQlyZXQgPSBpZ3Rfc3Bpbm5lcl9pbml0
KCZzcGluLCBpOTE1KTsKLQkJaWYgKHJldCkKLQkJCWdvdG8gZXJyOworCQljZSA9IGk5MTVfZ2Vt
X2NvbnRleHRfZ2V0X2VuZ2luZShjdHgsIGVuZ2luZS0+aWQpOworCQlpZiAoSVNfRVJSKGNlKSkK
KwkJCWNvbnRpbnVlOwogCi0JCXJxID0gaWd0X3NwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJnNwaW4s
IGN0eCwgZW5naW5lLCBNSV9OT09QKTsKKwkJcmV0ID0gaWd0X3NwaW5uZXJfaW5pdCgmc3Bpbiwg
ZW5naW5lLT5ndCk7CisJCWlmICghcmV0KQorCQkJcnEgPSBpZ3Rfc3Bpbm5lcl9jcmVhdGVfcmVx
dWVzdCgmc3BpbiwgY2UsIE1JX05PT1ApOworCQllbHNlCisJCQlycSA9IEVSUl9QVFIocmV0KTsK
KwkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwogCQlpZiAoSVNfRVJSKHJxKSkgewogCQkJcmV0ID0g
UFRSX0VSUihycSk7CiAJCQlpZ3Rfc3Bpbm5lcl9maW5pKCZzcGluKTsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3Rfc3Bpbm5lci5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9zcGlubmVyLmMKaW5kZXggODliNjU1MmE2NDk3Li5mZTkw
N2FiMjU1OWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3Rf
c3Bpbm5lci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3Rfc3Bpbm5l
ci5jCkBAIC05LDI1ICs5LDI0IEBACiAKICNpbmNsdWRlICJpZ3Rfc3Bpbm5lci5oIgogCi1pbnQg
aWd0X3NwaW5uZXJfaW5pdChzdHJ1Y3QgaWd0X3NwaW5uZXIgKnNwaW4sIHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQoraW50IGlndF9zcGlubmVyX2luaXQoc3RydWN0IGlndF9zcGlubmVy
ICpzcGluLCBzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogewogCXVuc2lnbmVkIGludCBtb2RlOwogCXZv
aWQgKnZhZGRyOwogCWludCBlcnI7CiAKLQlHRU1fQlVHX09OKElOVEVMX0dFTihpOTE1KSA8IDgp
OworCUdFTV9CVUdfT04oSU5URUxfR0VOKGd0LT5pOTE1KSA8IDgpOwogCiAJbWVtc2V0KHNwaW4s
IDAsIHNpemVvZigqc3BpbikpOwotCXNwaW4tPmk5MTUgPSBpOTE1OwotCXNwaW4tPmd0ID0gJmk5
MTUtPmd0OworCXNwaW4tPmd0ID0gZ3Q7CiAKLQlzcGluLT5od3MgPSBpOTE1X2dlbV9vYmplY3Rf
Y3JlYXRlX2ludGVybmFsKGk5MTUsIFBBR0VfU0laRSk7CisJc3Bpbi0+aHdzID0gaTkxNV9nZW1f
b2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChndC0+aTkxNSwgUEFHRV9TSVpFKTsKIAlpZiAoSVNfRVJS
KHNwaW4tPmh3cykpIHsKIAkJZXJyID0gUFRSX0VSUihzcGluLT5od3MpOwogCQlnb3RvIGVycjsK
IAl9CiAKLQlzcGluLT5vYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGk5MTUs
IFBBR0VfU0laRSk7CisJc3Bpbi0+b2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5h
bChndC0+aTkxNSwgUEFHRV9TSVpFKTsKIAlpZiAoSVNfRVJSKHNwaW4tPm9iaikpIHsKIAkJZXJy
ID0gUFRSX0VSUihzcGluLT5vYmopOwogCQlnb3RvIGVycl9od3M7CkBAIC00MSw3ICs0MCw3IEBA
IGludCBpZ3Rfc3Bpbm5lcl9pbml0KHN0cnVjdCBpZ3Rfc3Bpbm5lciAqc3Bpbiwgc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJfQogCXNwaW4tPnNlcW5vID0gbWVtc2V0KHZhZGRyLCAw
eGZmLCBQQUdFX1NJWkUpOwogCi0JbW9kZSA9IGk5MTVfY29oZXJlbnRfbWFwX3R5cGUoaTkxNSk7
CisJbW9kZSA9IGk5MTVfY29oZXJlbnRfbWFwX3R5cGUoZ3QtPmk5MTUpOwogCXZhZGRyID0gaTkx
NV9nZW1fb2JqZWN0X3Bpbl9tYXAoc3Bpbi0+b2JqLCBtb2RlKTsKIAlpZiAoSVNfRVJSKHZhZGRy
KSkgewogCQllcnIgPSBQVFJfRVJSKHZhZGRyKTsKQEAgLTg3LDggKzg2LDcgQEAgc3RhdGljIGlu
dCBtb3ZlX3RvX2FjdGl2ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAogc3RydWN0IGk5MTVfcmVx
dWVzdCAqCiBpZ3Rfc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdChzdHJ1Y3QgaWd0X3NwaW5uZXIgKnNw
aW4sCi0JCQkgICBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAotCQkJICAgc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqZW5naW5lLAorCQkJICAgc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAog
CQkJICAgdTMyIGFyYml0cmF0aW9uX2NvbW1hbmQpCiB7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnEgPSBOVUxMOwpAQCAtOTYsMTMgKzk0LDEzIEBAIGlndF9zcGlubmVyX2NyZWF0ZV9yZXF1ZXN0
KHN0cnVjdCBpZ3Rfc3Bpbm5lciAqc3BpbiwKIAl1MzIgKmJhdGNoOwogCWludCBlcnI7CiAKLQlz
cGluLT5ndCA9IGVuZ2luZS0+Z3Q7CisJR0VNX0JVR19PTihzcGluLT5ndCAhPSBjZS0+dm0tPmd0
KTsKIAotCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKHNwaW4tPm9iaiwgY3R4LT52bSwgTlVMTCk7
CisJdm1hID0gaTkxNV92bWFfaW5zdGFuY2Uoc3Bpbi0+b2JqLCBjZS0+dm0sIE5VTEwpOwogCWlm
IChJU19FUlIodm1hKSkKIAkJcmV0dXJuIEVSUl9DQVNUKHZtYSk7CiAKLQlod3MgPSBpOTE1X3Zt
YV9pbnN0YW5jZShzcGluLT5od3MsIGN0eC0+dm0sIE5VTEwpOworCWh3cyA9IGk5MTVfdm1hX2lu
c3RhbmNlKHNwaW4tPmh3cywgY2UtPnZtLCBOVUxMKTsKIAlpZiAoSVNfRVJSKGh3cykpCiAJCXJl
dHVybiBFUlJfQ0FTVChod3MpOwogCkBAIC0xMTQsNyArMTEyLDcgQEAgaWd0X3NwaW5uZXJfY3Jl
YXRlX3JlcXVlc3Qoc3RydWN0IGlndF9zcGlubmVyICpzcGluLAogCWlmIChlcnIpCiAJCWdvdG8g
dW5waW5fdm1hOwogCi0JcnEgPSBpZ3RfcmVxdWVzdF9hbGxvYyhjdHgsIGVuZ2luZSk7CisJcnEg
PSBpbnRlbF9jb250ZXh0X2NyZWF0ZV9yZXF1ZXN0KGNlKTsKIAlpZiAoSVNfRVJSKHJxKSkgewog
CQllcnIgPSBQVFJfRVJSKHJxKTsKIAkJZ290byB1bnBpbl9od3M7CkBAIC0xNDIsMTYgKzE0MCwx
NiBAQCBpZ3Rfc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdChzdHJ1Y3QgaWd0X3NwaW5uZXIgKnNwaW4s
CiAJKmJhdGNoKysgPSB1cHBlcl8zMl9iaXRzKHZtYS0+bm9kZS5zdGFydCk7CiAJKmJhdGNoKysg
PSBNSV9CQVRDSF9CVUZGRVJfRU5EOyAvKiBub3QgcmVhY2hlZCAqLwogCi0JaW50ZWxfZ3RfY2hp
cHNldF9mbHVzaChlbmdpbmUtPmd0KTsKKwlpbnRlbF9ndF9jaGlwc2V0X2ZsdXNoKHJxLT5lbmdp
bmUtPmd0KTsKIAotCWlmIChlbmdpbmUtPmVtaXRfaW5pdF9icmVhZGNydW1iICYmCisJaWYgKHJx
LT5lbmdpbmUtPmVtaXRfaW5pdF9icmVhZGNydW1iICYmCiAJICAgIHJxLT50aW1lbGluZS0+aGFz
X2luaXRpYWxfYnJlYWRjcnVtYikgewotCQllcnIgPSBlbmdpbmUtPmVtaXRfaW5pdF9icmVhZGNy
dW1iKHJxKTsKKwkJZXJyID0gcnEtPmVuZ2luZS0+ZW1pdF9pbml0X2JyZWFkY3J1bWIocnEpOwog
CQlpZiAoZXJyKQogCQkJZ290byBjYW5jZWxfcnE7CiAJfQogCi0JZXJyID0gZW5naW5lLT5lbWl0
X2JiX3N0YXJ0KHJxLCB2bWEtPm5vZGUuc3RhcnQsIFBBR0VfU0laRSwgMCk7CisJZXJyID0gcnEt
PmVuZ2luZS0+ZW1pdF9iYl9zdGFydChycSwgdm1hLT5ub2RlLnN0YXJ0LCBQQUdFX1NJWkUsIDAp
OwogCiBjYW5jZWxfcnE6CiAJaWYgKGVycikgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL2lndF9zcGlubmVyLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaWd0X3NwaW5uZXIuaAppbmRleCAxYmZjMzllZmE3NzMuLmVjNjJjOWVmMzIwYiAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9zcGlubmVyLmgKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9zcGlubmVyLmgKQEAgLTE3LDcg
KzE3LDYgQEAKIHN0cnVjdCBpbnRlbF9ndDsKIAogc3RydWN0IGlndF9zcGlubmVyIHsKLQlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNTsKIAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0OwogCXN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpod3M7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iajsKQEAgLTI1LDEzICsyNCwxMiBAQCBzdHJ1Y3QgaWd0X3NwaW5uZXIgewogCXZvaWQgKnNl
cW5vOwogfTsKIAotaW50IGlndF9zcGlubmVyX2luaXQoc3RydWN0IGlndF9zcGlubmVyICpzcGlu
LCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7CitpbnQgaWd0X3NwaW5uZXJfaW5pdChz
dHJ1Y3QgaWd0X3NwaW5uZXIgKnNwaW4sIHN0cnVjdCBpbnRlbF9ndCAqZ3QpOwogdm9pZCBpZ3Rf
c3Bpbm5lcl9maW5pKHN0cnVjdCBpZ3Rfc3Bpbm5lciAqc3Bpbik7CiAKIHN0cnVjdCBpOTE1X3Jl
cXVlc3QgKgogaWd0X3NwaW5uZXJfY3JlYXRlX3JlcXVlc3Qoc3RydWN0IGlndF9zcGlubmVyICpz
cGluLAotCQkJICAgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKLQkJCSAgIHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKKwkJCSAgIHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwK
IAkJCSAgIHUzMiBhcmJpdHJhdGlvbl9jb21tYW5kKTsKIHZvaWQgaWd0X3NwaW5uZXJfZW5kKHN0
cnVjdCBpZ3Rfc3Bpbm5lciAqc3Bpbik7CiAKLS0gCjIuMjIuMAoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRl
bC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
L21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

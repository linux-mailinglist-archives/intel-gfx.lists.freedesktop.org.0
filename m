Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7DCC8E9D78
	for <lists+intel-gfx@lfdr.de>; Wed, 30 Oct 2019 15:27:21 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 35BA56EA27;
	Wed, 30 Oct 2019 14:27:17 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2D54D6EA26
 for <intel-gfx@lists.freedesktop.org>; Wed, 30 Oct 2019 14:27:06 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 30 Oct 2019 15:26:54 +0100
Message-Id: <20191030142657.22405-9-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191030142657.22405-1-maarten.lankhorst@linux.intel.com>
References: <20191030142657.22405-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 09/12] drm/i915: Perform automated conversions for
 plane uapi/hw split, base -> hw.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U3BsaXQgdXAgcGxhbmVfc3RhdGUtPmJhc2UgdG8gaHcuIFRoaXMgaXMgZG9uZSB1c2luZyB0aGUg
Zm9sbG93aW5nIHBhdGNoOgoKQEAKc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpUOwppZGVudGlm
aWVyIHggPX4gIl4oY3J0Y3xmYnxhbHBoYXxwaXhlbF9ibGVuZF9tb2RlfHJvdGF0aW9ufGNvbG9y
X2VuY29kaW5nfGNvbG9yX3JhbmdlKSQiOwpAQAotVC0+YmFzZS54CitULT5ody54CgpTaWduZWQt
b2ZmLWJ5OiBNYWFydGVuIExhbmtob3JzdCA8bWFhcnRlbi5sYW5raG9yc3RAbGludXguaW50ZWwu
Y29tPgpSZXZpZXdlZC1ieTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4Lmlu
dGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5j
ICAgfCAgIDYgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWNfcGxhbmUu
YyB8ICAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMg
IHwgMTI2ICsrKysrKysrKy0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9mYmMuYyAgICAgIHwgICA4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX292ZXJsYXkuYyAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfc3ByaXRlLmMgICB8ICA5MCArKysrKystLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF9wbS5jICAgICAgICAgICAgICAgfCAgMzIgKystLS0KIDcgZmlsZXMgY2hhbmdlZCwgMTM1
IGluc2VydGlvbnMoKyksIDEzNSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9hdG9taWMuYwppbmRleCAzMzAxYzE3OGRhMDMuLjBhNWVlZTRjMzUwZiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5jCkBAIC0yODMs
OSArMjgzLDkgQEAgc3RhdGljIHZvaWQgaW50ZWxfYXRvbWljX3NldHVwX3NjYWxlcihzdHJ1Y3Qg
aW50ZWxfY3J0Y19zY2FsZXJfc3RhdGUgKnNjYWxlcl9zdGEKIAkJcmV0dXJuOwogCiAJLyogc2V0
IHNjYWxlciBtb2RlICovCi0JaWYgKHBsYW5lX3N0YXRlICYmIHBsYW5lX3N0YXRlLT5iYXNlLmZi
ICYmCi0JICAgIHBsYW5lX3N0YXRlLT5iYXNlLmZiLT5mb3JtYXQtPmlzX3l1diAmJgotCSAgICBw
bGFuZV9zdGF0ZS0+YmFzZS5mYi0+Zm9ybWF0LT5udW1fcGxhbmVzID4gMSkgeworCWlmIChwbGFu
ZV9zdGF0ZSAmJiBwbGFuZV9zdGF0ZS0+aHcuZmIgJiYKKwkgICAgcGxhbmVfc3RhdGUtPmh3LmZi
LT5mb3JtYXQtPmlzX3l1diAmJgorCSAgICBwbGFuZV9zdGF0ZS0+aHcuZmItPmZvcm1hdC0+bnVt
X3BsYW5lcyA+IDEpIHsKIAkJc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3Bs
YW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsKIAkJaWYgKElTX0dFTihkZXZfcHJpdiwgOSkg
JiYKIAkJICAgICFJU19HRU1JTklMQUtFKGRldl9wcml2KSkgewpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWNfcGxhbmUuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljX3BsYW5lLmMKaW5kZXggNDE2Y2ZhNDM5ZjMz
Li40ZTkyOGUzNjFiZTEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfYXRvbWljX3BsYW5lLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9hdG9taWNfcGxhbmUuYwpAQCAtMTE4LDcgKzExOCw3IEBAIGludGVsX3BsYW5lX2Rlc3Ry
b3lfc3RhdGUoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiB1bnNpZ25lZCBpbnQgaW50ZWxfcGxh
bmVfZGF0YV9yYXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAog
CQkJCSAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0J
Y29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsK
Kwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsK
IAl1bnNpZ25lZCBpbnQgY3BwOwogCiAJaWYgKCFwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlKQpA
QCAtMTgyLDcgKzE4Miw3IEBAIGludCBpbnRlbF9wbGFuZV9hdG9taWNfY2hlY2tfd2l0aF9zdGF0
ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfCiAJCQkJCXN0cnVjdCBp
bnRlbF9wbGFuZV9zdGF0ZSAqbmV3X3BsYW5lX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9wbGFu
ZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShuZXdfcGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOwot
CWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gbmV3X3BsYW5lX3N0YXRlLT5iYXNl
LmZiOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gbmV3X3BsYW5lX3N0YXRl
LT5ody5mYjsKIAlpbnQgcmV0OwogCiAJbmV3X2NydGNfc3RhdGUtPmFjdGl2ZV9wbGFuZXMgJj0g
fkJJVChwbGFuZS0+aWQpOwpAQCAtMTkyLDcgKzE5Miw3IEBAIGludCBpbnRlbF9wbGFuZV9hdG9t
aWNfY2hlY2tfd2l0aF9zdGF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2Ny
dGNfCiAJbmV3X2NydGNfc3RhdGUtPm1pbl9jZGNsa1twbGFuZS0+aWRdID0gMDsKIAluZXdfcGxh
bmVfc3RhdGUtPmJhc2UudmlzaWJsZSA9IGZhbHNlOwogCi0JaWYgKCFuZXdfcGxhbmVfc3RhdGUt
PmJhc2UuY3J0YyAmJiAhb2xkX3BsYW5lX3N0YXRlLT5iYXNlLmNydGMpCisJaWYgKCFuZXdfcGxh
bmVfc3RhdGUtPmh3LmNydGMgJiYgIW9sZF9wbGFuZV9zdGF0ZS0+aHcuY3J0YykKIAkJcmV0dXJu
IDA7CiAKIAlyZXQgPSBwbGFuZS0+Y2hlY2tfcGxhbmUobmV3X2NydGNfc3RhdGUsIG5ld19wbGFu
ZV9zdGF0ZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5j
CmluZGV4IGIwYjJjNDZlNGMwYS4uMWMwYzU1YTc4ZDAzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAtMjIxNSw3ICsyMjE1LDcgQEAgdTMyIGlu
dGVsX2ZiX3h5X3RvX2xpbmVhcihpbnQgeCwgaW50IHksCiAJCQkgIGNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqc3RhdGUsCiAJCQkgIGludCBjb2xvcl9wbGFuZSkKIHsKLQljb25zdCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHN0YXRlLT5iYXNlLmZiOworCWNvbnN0IHN0cnVj
dCBkcm1fZnJhbWVidWZmZXIgKmZiID0gc3RhdGUtPmh3LmZiOwogCXVuc2lnbmVkIGludCBjcHAg
PSBmYi0+Zm9ybWF0LT5jcHBbY29sb3JfcGxhbmVdOwogCXVuc2lnbmVkIGludCBwaXRjaCA9IHN0
YXRlLT5jb2xvcl9wbGFuZVtjb2xvcl9wbGFuZV0uc3RyaWRlOwogCkBAIC0yMzE2LDggKzIzMTYs
OCBAQCBzdGF0aWMgdTMyIGludGVsX3BsYW5lX2FkanVzdF9hbGlnbmVkX29mZnNldChpbnQgKngs
IGludCAqeSwKIAkJCQkJICAgICBpbnQgY29sb3JfcGxhbmUsCiAJCQkJCSAgICAgdTMyIG9sZF9v
ZmZzZXQsIHUzMiBuZXdfb2Zmc2V0KQogewotCXJldHVybiBpbnRlbF9hZGp1c3RfYWxpZ25lZF9v
ZmZzZXQoeCwgeSwgc3RhdGUtPmJhc2UuZmIsIGNvbG9yX3BsYW5lLAotCQkJCQkgICBzdGF0ZS0+
YmFzZS5yb3RhdGlvbiwKKwlyZXR1cm4gaW50ZWxfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KHgsIHks
IHN0YXRlLT5ody5mYiwgY29sb3JfcGxhbmUsCisJCQkJCSAgIHN0YXRlLT5ody5yb3RhdGlvbiwK
IAkJCQkJICAgc3RhdGUtPmNvbG9yX3BsYW5lW2NvbG9yX3BsYW5lXS5zdHJpZGUsCiAJCQkJCSAg
IG9sZF9vZmZzZXQsIG5ld19vZmZzZXQpOwogfQpAQCAtMjM5Myw4ICsyMzkzLDggQEAgc3RhdGlj
IHUzMiBpbnRlbF9wbGFuZV9jb21wdXRlX2FsaWduZWRfb2Zmc2V0KGludCAqeCwgaW50ICp5LAog
ewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqaW50ZWxfcGxhbmUgPSB0b19pbnRlbF9wbGFuZShzdGF0
ZS0+YmFzZS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShpbnRlbF9wbGFuZS0+YmFzZS5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiID0gc3RhdGUtPmJhc2UuZmI7Ci0JdW5zaWduZWQgaW50IHJvdGF0aW9uID0gc3RhdGUt
PmJhc2Uucm90YXRpb247CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBzdGF0
ZS0+aHcuZmI7CisJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gc3RhdGUtPmh3LnJvdGF0aW9uOwog
CWludCBwaXRjaCA9IHN0YXRlLT5jb2xvcl9wbGFuZVtjb2xvcl9wbGFuZV0uc3RyaWRlOwogCXUz
MiBhbGlnbm1lbnQ7CiAKQEAgLTI1ODEsNyArMjU4MSw3IEBAIGJvb2wgaW50ZWxfcGxhbmVfY2Fu
X3JlbWFwKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJ
c3RydWN0IGludGVsX3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5i
YXNlLnBsYW5lKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KHBsYW5lLT5iYXNlLmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBw
bGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9
IHBsYW5lX3N0YXRlLT5ody5mYjsKIAlpbnQgaTsKIAogCS8qIFdlIGRvbid0IHdhbnQgdG8gZGVh
bCB3aXRoIHJlbWFwcGluZyB3aXRoIGN1cnNvcnMgKi8KQEAgLTI2MjAsOCArMjYyMCw4IEBAIGJv
b2wgaW50ZWxfcGxhbmVfY2FuX3JlbWFwKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUpCiBzdGF0aWMgYm9vbCBpbnRlbF9wbGFuZV9uZWVkc19yZW1hcChjb25zdCBz
dHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9w
bGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7Ci0J
Y29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsK
LQl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+YmFzZS5yb3RhdGlvbjsKKwlj
b25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKKwl1
bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247CiAJdTMyIHN0
cmlkZSwgbWF4X3N0cmlkZTsKIAogCS8qCkBAIC0yODEyLDEwICsyODEyLDEwIEBAIGludGVsX3Bs
YW5lX3JlbWFwX2d0dChzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9CiAJCXRvX2k5MTUocGxhbmVfc3Rh
dGUtPmJhc2UucGxhbmUtPmRldik7Ci0Jc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFu
ZV9zdGF0ZS0+YmFzZS5mYjsKKwlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0
YXRlLT5ody5mYjsKIAlzdHJ1Y3QgaW50ZWxfZnJhbWVidWZmZXIgKmludGVsX2ZiID0gdG9faW50
ZWxfZnJhbWVidWZmZXIoZmIpOwogCXN0cnVjdCBpbnRlbF9yb3RhdGlvbl9pbmZvICppbmZvID0g
JnBsYW5lX3N0YXRlLT52aWV3LnJvdGF0ZWQ7Ci0JdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxh
bmVfc3RhdGUtPmJhc2Uucm90YXRpb247CisJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVf
c3RhdGUtPmh3LnJvdGF0aW9uOwogCWludCBpLCBudW1fcGxhbmVzID0gZmItPmZvcm1hdC0+bnVt
X3BsYW5lczsKIAl1bnNpZ25lZCBpbnQgdGlsZV9zaXplID0gaW50ZWxfdGlsZV9zaXplKGRldl9w
cml2KTsKIAl1bnNpZ25lZCBpbnQgc3JjX3gsIHNyY195OwpAQCAtMjkyMSw4ICsyOTIxLDggQEAg
c3RhdGljIGludAogaW50ZWxfcGxhbmVfY29tcHV0ZV9ndHQoc3RydWN0IGludGVsX3BsYW5lX3N0
YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAljb25zdCBzdHJ1Y3QgaW50ZWxfZnJhbWVidWZmZXIgKmZi
ID0KLQkJdG9faW50ZWxfZnJhbWVidWZmZXIocGxhbmVfc3RhdGUtPmJhc2UuZmIpOwotCXVuc2ln
bmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9uOworCQl0b19pbnRl
bF9mcmFtZWJ1ZmZlcihwbGFuZV9zdGF0ZS0+aHcuZmIpOworCXVuc2lnbmVkIGludCByb3RhdGlv
biA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKIAlpbnQgaSwgbnVtX3BsYW5lczsKIAogCWlm
ICghZmIpCkBAIC0zMjI1LDcgKzMyMjUsNyBAQCBpbnRlbF9maW5kX2luaXRpYWxfcGxhbmVfb2Jq
KHN0cnVjdCBpbnRlbF9jcnRjICppbnRlbF9jcnRjLAogCQkJY29udGludWU7CiAKIAkJaWYgKGlu
dGVsX3BsYW5lX2dndHRfb2Zmc2V0KHN0YXRlKSA9PSBwbGFuZV9jb25maWctPmJhc2UpIHsKLQkJ
CWZiID0gc3RhdGUtPmJhc2UuZmI7CisJCQlmYiA9IHN0YXRlLT5ody5mYjsKIAkJCWRybV9mcmFt
ZWJ1ZmZlcl9nZXQoZmIpOwogCQkJZ290byB2YWxpZF9mYjsKIAkJfQpAQCAtMzI0MywxMSArMzI0
MywxMSBAQCBpbnRlbF9maW5kX2luaXRpYWxfcGxhbmVfb2JqKHN0cnVjdCBpbnRlbF9jcnRjICpp
bnRlbF9jcnRjLAogCXJldHVybjsKIAogdmFsaWRfZmI6Ci0JaW50ZWxfc3RhdGUtPmJhc2Uucm90
YXRpb24gPSBwbGFuZV9jb25maWctPnJvdGF0aW9uOworCWludGVsX3N0YXRlLT5ody5yb3RhdGlv
biA9IHBsYW5lX2NvbmZpZy0+cm90YXRpb247CiAJaW50ZWxfZmlsbF9mYl9nZ3R0X3ZpZXcoJmlu
dGVsX3N0YXRlLT52aWV3LCBmYiwKLQkJCQlpbnRlbF9zdGF0ZS0+YmFzZS5yb3RhdGlvbik7CisJ
CQkJaW50ZWxfc3RhdGUtPmh3LnJvdGF0aW9uKTsKIAlpbnRlbF9zdGF0ZS0+Y29sb3JfcGxhbmVb
MF0uc3RyaWRlID0KLQkJaW50ZWxfZmJfcGl0Y2goZmIsIDAsIGludGVsX3N0YXRlLT5iYXNlLnJv
dGF0aW9uKTsKKwkJaW50ZWxfZmJfcGl0Y2goZmIsIDAsIGludGVsX3N0YXRlLT5ody5yb3RhdGlv
bik7CiAKIAlpbnRlbF9zdGF0ZS0+dm1hID0KIAkJaW50ZWxfcGluX2FuZF9mZW5jZV9mYl9vYmoo
ZmIsCkBAIC0zMzc0LDcgKzMzNzQsNyBAQCBzdGF0aWMgaW50IGljbF9tYXhfcGxhbmVfaGVpZ2h0
KHZvaWQpCiBzdGF0aWMgYm9vbCBza2xfY2hlY2tfbWFpbl9jY3NfY29vcmRpbmF0ZXMoc3RydWN0
IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKIAkJCQkJICAgaW50IG1haW5feCwgaW50
IG1haW5feSwgdTMyIG1haW5fb2Zmc2V0KQogewotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJaW50IGhzdWIgPSBmYi0+Zm9ybWF0LT5o
c3ViOwogCWludCB2c3ViID0gZmItPmZvcm1hdC0+dnN1YjsKIAlpbnQgYXV4X3ggPSBwbGFuZV9z
dGF0ZS0+Y29sb3JfcGxhbmVbMV0ueDsKQEAgLTM0MTIsOCArMzQxMiw4IEBAIHN0YXRpYyBib29s
IHNrbF9jaGVja19tYWluX2Njc19jb29yZGluYXRlcyhzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUg
KnBsYW5lX3N0YXRlCiBzdGF0aWMgaW50IHNrbF9jaGVja19tYWluX3N1cmZhY2Uoc3RydWN0IGlu
dGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lLT5kZXYpOwotCWNv
bnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7Ci0J
dW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmJhc2Uucm90YXRpb247CisJY29u
c3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CisJdW5z
aWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwogCWludCB4ID0g
cGxhbmVfc3RhdGUtPmJhc2Uuc3JjLngxID4+IDE2OwogCWludCB5ID0gcGxhbmVfc3RhdGUtPmJh
c2Uuc3JjLnkxID4+IDE2OwogCWludCB3ID0gZHJtX3JlY3Rfd2lkdGgoJnBsYW5lX3N0YXRlLT5i
YXNlLnNyYykgPj4gMTY7CkBAIC0zNTA4LDggKzM1MDgsOCBAQCBzdGF0aWMgaW50IHNrbF9jaGVj
a19tYWluX3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAog
c3RhdGljIGludCBza2xfY2hlY2tfbnYxMl9hdXhfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVf
c3RhdGUgKnBsYW5lX3N0YXRlKQogewotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
ID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7Ci0JdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVf
c3RhdGUtPmJhc2Uucm90YXRpb247CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIg
PSBwbGFuZV9zdGF0ZS0+aHcuZmI7CisJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3Rh
dGUtPmh3LnJvdGF0aW9uOwogCWludCBtYXhfd2lkdGggPSBza2xfbWF4X3BsYW5lX3dpZHRoKGZi
LCAxLCByb3RhdGlvbik7CiAJaW50IG1heF9oZWlnaHQgPSA0MDk2OwogCWludCB4ID0gcGxhbmVf
c3RhdGUtPmJhc2Uuc3JjLngxID4+IDE3OwpAQCAtMzUzNyw3ICszNTM3LDcgQEAgc3RhdGljIGlu
dCBza2xfY2hlY2tfbnYxMl9hdXhfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBs
YW5lX3N0YXRlKQogCiBzdGF0aWMgaW50IHNrbF9jaGVja19jY3NfYXV4X3N1cmZhY2Uoc3RydWN0
IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQljb25zdCBzdHJ1Y3QgZHJtX2Zy
YW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCWNvbnN0IHN0cnVjdCBkcm1f
ZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCWludCBzcmNfeCA9IHBsYW5l
X3N0YXRlLT5iYXNlLnNyYy54MSA+PiAxNjsKIAlpbnQgc3JjX3kgPSBwbGFuZV9zdGF0ZS0+YmFz
ZS5zcmMueTEgPj4gMTY7CiAJaW50IGhzdWIgPSBmYi0+Zm9ybWF0LT5oc3ViOwpAQCAtMzU1OCw3
ICszNTU4LDcgQEAgc3RhdGljIGludCBza2xfY2hlY2tfY2NzX2F1eF9zdXJmYWNlKHN0cnVjdCBp
bnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAKIGludCBza2xfY2hlY2tfcGxhbmVfc3Vy
ZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewotCWNvbnN0IHN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7CisJY29uc3Qg
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJaW50IHJl
dDsKIAogCXJldCA9IGludGVsX3BsYW5lX2NvbXB1dGVfZ3R0KHBsYW5lX3N0YXRlKTsKQEAgLTM1
OTcsNyArMzU5Nyw3IEBAIHN0YXRpYyB2b2lkIGk5eHhfcGxhbmVfcmF0aW8oY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCQkgICAgIGNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCiAJCQkgICAgIHVuc2lnbmVkIGludCAqbnVtLCB1
bnNpZ25lZCBpbnQgKmRlbikKIHsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9
IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
ID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCXVuc2lnbmVkIGludCBjcHAgPSBmYi0+Zm9ybWF0LT5j
cHBbMF07CiAKIAkvKgpAQCAtMzY5MCw4ICszNjkwLDggQEAgc3RhdGljIHUzMiBpOXh4X3BsYW5l
X2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIHsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQogCQl0b19pOTE1KHBsYW5lX3N0YXRlLT5i
YXNlLnBsYW5lLT5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxh
bmVfc3RhdGUtPmJhc2UuZmI7Ci0JdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUt
PmJhc2Uucm90YXRpb247CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFu
ZV9zdGF0ZS0+aHcuZmI7CisJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3
LnJvdGF0aW9uOwogCXUzMiBkc3BjbnRyOwogCiAJZHNwY250ciA9IERJU1BMQVlfUExBTkVfRU5B
QkxFOwpAQCAtMzc0Nyw3ICszNzQ3LDcgQEAgaW50IGk5eHhfY2hlY2tfcGxhbmVfc3VyZmFjZShz
dHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9CiAJCXRvX2k5MTUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUt
PmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+
YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRl
LT5ody5mYjsKIAlpbnQgc3JjX3gsIHNyY195LCBzcmNfdzsKIAl1MzIgb2Zmc2V0OwogCWludCBy
ZXQ7CkBAIC0zNzg0LDcgKzM3ODQsNyBAQCBpbnQgaTl4eF9jaGVja19wbGFuZV9zdXJmYWNlKHN0
cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAKIAkvKiBIU1cvQkRXIGRvIHRo
aXMgYXV0b21hZ2ljYWxseSBpbiBoYXJkd2FyZSAqLwogCWlmICghSVNfSEFTV0VMTChkZXZfcHJp
dikgJiYgIUlTX0JST0FEV0VMTChkZXZfcHJpdikpIHsKLQkJdW5zaWduZWQgaW50IHJvdGF0aW9u
ID0gcGxhbmVfc3RhdGUtPmJhc2Uucm90YXRpb247CisJCXVuc2lnbmVkIGludCByb3RhdGlvbiA9
IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKIAkJaW50IHNyY193ID0gZHJtX3JlY3Rfd2lkdGgo
JnBsYW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7CiAJCWludCBzcmNfaCA9IGRybV9yZWN0X2hl
aWdodCgmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjKSA+PiAxNjsKIApAQCAtNDAzNyw4ICs0MDM3LDgg
QEAgc3RhdGljIHVuc2lnbmVkIGludCBza2xfcGxhbmVfc3RyaWRlX211bHQoY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIsCiB1MzIgc2tsX3BsYW5lX3N0cmlkZShjb25zdCBzdHJ1Y3Qg
aW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAogCQkgICAgIGludCBjb2xvcl9wbGFuZSkK
IHsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNl
LmZiOwotCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9u
OworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZi
OworCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKIAl1
MzIgc3RyaWRlID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lW2NvbG9yX3BsYW5lXS5zdHJpZGU7
CiAKIAlpZiAoY29sb3JfcGxhbmUgPj0gZmItPmZvcm1hdC0+bnVtX3BsYW5lcykKQEAgLTQxMDcs
MTAgKzQxMDcsMTAgQEAgc3RhdGljIHUzMiBza2xfcGxhbmVfY3RsX2Zvcm1hdCh1MzIgcGl4ZWxf
Zm9ybWF0KQogCiBzdGF0aWMgdTMyIHNrbF9wbGFuZV9jdGxfYWxwaGEoY29uc3Qgc3RydWN0IGlu
dGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQlpZiAoIXBsYW5lX3N0YXRlLT5iYXNl
LmZiLT5mb3JtYXQtPmhhc19hbHBoYSkKKwlpZiAoIXBsYW5lX3N0YXRlLT5ody5mYi0+Zm9ybWF0
LT5oYXNfYWxwaGEpCiAJCXJldHVybiBQTEFORV9DVExfQUxQSEFfRElTQUJMRTsKIAotCXN3aXRj
aCAocGxhbmVfc3RhdGUtPmJhc2UucGl4ZWxfYmxlbmRfbW9kZSkgeworCXN3aXRjaCAocGxhbmVf
c3RhdGUtPmh3LnBpeGVsX2JsZW5kX21vZGUpIHsKIAljYXNlIERSTV9NT0RFX0JMRU5EX1BJWEVM
X05PTkU6CiAJCXJldHVybiBQTEFORV9DVExfQUxQSEFfRElTQUJMRTsKIAljYXNlIERSTV9NT0RF
X0JMRU5EX1BSRU1VTFRJOgpAQCAtNDExOCwxNyArNDExOCwxNyBAQCBzdGF0aWMgdTMyIHNrbF9w
bGFuZV9jdGxfYWxwaGEoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0
ZSkKIAljYXNlIERSTV9NT0RFX0JMRU5EX0NPVkVSQUdFOgogCQlyZXR1cm4gUExBTkVfQ1RMX0FM
UEhBX0hXX1BSRU1VTFRJUExZOwogCWRlZmF1bHQ6Ci0JCU1JU1NJTkdfQ0FTRShwbGFuZV9zdGF0
ZS0+YmFzZS5waXhlbF9ibGVuZF9tb2RlKTsKKwkJTUlTU0lOR19DQVNFKHBsYW5lX3N0YXRlLT5o
dy5waXhlbF9ibGVuZF9tb2RlKTsKIAkJcmV0dXJuIFBMQU5FX0NUTF9BTFBIQV9ESVNBQkxFOwog
CX0KIH0KIAogc3RhdGljIHUzMiBnbGtfcGxhbmVfY29sb3JfY3RsX2FscGhhKGNvbnN0IHN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0JaWYgKCFwbGFuZV9zdGF0ZS0+
YmFzZS5mYi0+Zm9ybWF0LT5oYXNfYWxwaGEpCisJaWYgKCFwbGFuZV9zdGF0ZS0+aHcuZmItPmZv
cm1hdC0+aGFzX2FscGhhKQogCQlyZXR1cm4gUExBTkVfQ09MT1JfQUxQSEFfRElTQUJMRTsKIAot
CXN3aXRjaCAocGxhbmVfc3RhdGUtPmJhc2UucGl4ZWxfYmxlbmRfbW9kZSkgeworCXN3aXRjaCAo
cGxhbmVfc3RhdGUtPmh3LnBpeGVsX2JsZW5kX21vZGUpIHsKIAljYXNlIERSTV9NT0RFX0JMRU5E
X1BJWEVMX05PTkU6CiAJCXJldHVybiBQTEFORV9DT0xPUl9BTFBIQV9ESVNBQkxFOwogCWNhc2Ug
RFJNX01PREVfQkxFTkRfUFJFTVVMVEk6CkBAIC00MTM2LDcgKzQxMzYsNyBAQCBzdGF0aWMgdTMy
IGdsa19wbGFuZV9jb2xvcl9jdGxfYWxwaGEoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICpwbGFuZV9zdGF0ZQogCWNhc2UgRFJNX01PREVfQkxFTkRfQ09WRVJBR0U6CiAJCXJldHVybiBQ
TEFORV9DT0xPUl9BTFBIQV9IV19QUkVNVUxUSVBMWTsKIAlkZWZhdWx0OgotCQlNSVNTSU5HX0NB
U0UocGxhbmVfc3RhdGUtPmJhc2UucGl4ZWxfYmxlbmRfbW9kZSk7CisJCU1JU1NJTkdfQ0FTRShw
bGFuZV9zdGF0ZS0+aHcucGl4ZWxfYmxlbmRfbW9kZSk7CiAJCXJldHVybiBQTEFORV9DT0xPUl9B
TFBIQV9ESVNBQkxFOwogCX0KIH0KQEAgLTQyMjIsOCArNDIyMiw4IEBAIHUzMiBza2xfcGxhbmVf
Y3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogewogCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9CiAJCXRvX2k5MTUocGxhbmVfc3RhdGUtPmJh
c2UucGxhbmUtPmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFu
ZV9zdGF0ZS0+YmFzZS5mYjsKLQl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+
YmFzZS5yb3RhdGlvbjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5l
X3N0YXRlLT5ody5mYjsKKwl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcu
cm90YXRpb247CiAJY29uc3Qgc3RydWN0IGRybV9pbnRlbF9zcHJpdGVfY29sb3JrZXkgKmtleSA9
ICZwbGFuZV9zdGF0ZS0+Y2tleTsKIAl1MzIgcGxhbmVfY3RsOwogCkBAIC00MjMzLDEwICs0MjMz
LDEwIEBAIHUzMiBza2xfcGxhbmVfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlLAogCQlwbGFuZV9jdGwgfD0gc2tsX3BsYW5lX2N0bF9hbHBoYShwbGFuZV9zdGF0
ZSk7CiAJCXBsYW5lX2N0bCB8PSBQTEFORV9DVExfUExBTkVfR0FNTUFfRElTQUJMRTsKIAotCQlp
ZiAocGxhbmVfc3RhdGUtPmJhc2UuY29sb3JfZW5jb2RpbmcgPT0gRFJNX0NPTE9SX1lDQkNSX0JU
NzA5KQorCQlpZiAocGxhbmVfc3RhdGUtPmh3LmNvbG9yX2VuY29kaW5nID09IERSTV9DT0xPUl9Z
Q0JDUl9CVDcwOSkKIAkJCXBsYW5lX2N0bCB8PSBQTEFORV9DVExfWVVWX1RPX1JHQl9DU0NfRk9S
TUFUX0JUNzA5OwogCi0JCWlmIChwbGFuZV9zdGF0ZS0+YmFzZS5jb2xvcl9yYW5nZSA9PSBEUk1f
Q09MT1JfWUNCQ1JfRlVMTF9SQU5HRSkKKwkJaWYgKHBsYW5lX3N0YXRlLT5ody5jb2xvcl9yYW5n
ZSA9PSBEUk1fQ09MT1JfWUNCQ1JfRlVMTF9SQU5HRSkKIAkJCXBsYW5lX2N0bCB8PSBQTEFORV9D
VExfWVVWX1JBTkdFX0NPUlJFQ1RJT05fRElTQUJMRTsKIAl9CiAKQEAgLTQyNzgsNyArNDI3OCw3
IEBAIHUzMiBnbGtfcGxhbmVfY29sb3JfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlLAogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9CiAJ
CXRvX2k5MTUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUtPmRldik7Ci0JY29uc3Qgc3RydWN0IGRy
bV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAlzdHJ1Y3QgaW50ZWxf
cGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOwog
CXUzMiBwbGFuZV9jb2xvcl9jdGwgPSAwOwogCkBAIC00Mjg2LDEyICs0Mjg2LDEyIEBAIHUzMiBn
bGtfcGxhbmVfY29sb3JfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAogCXBsYW5lX2NvbG9yX2N0bCB8PSBnbGtfcGxhbmVfY29sb3JfY3RsX2FscGhhKHBsYW5l
X3N0YXRlKTsKIAogCWlmIChmYi0+Zm9ybWF0LT5pc195dXYgJiYgIWljbF9pc19oZHJfcGxhbmUo
ZGV2X3ByaXYsIHBsYW5lLT5pZCkpIHsKLQkJaWYgKHBsYW5lX3N0YXRlLT5iYXNlLmNvbG9yX2Vu
Y29kaW5nID09IERSTV9DT0xPUl9ZQ0JDUl9CVDcwOSkKKwkJaWYgKHBsYW5lX3N0YXRlLT5ody5j
b2xvcl9lbmNvZGluZyA9PSBEUk1fQ09MT1JfWUNCQ1JfQlQ3MDkpCiAJCQlwbGFuZV9jb2xvcl9j
dGwgfD0gUExBTkVfQ09MT1JfQ1NDX01PREVfWVVWNzA5X1RPX1JHQjcwOTsKIAkJZWxzZQogCQkJ
cGxhbmVfY29sb3JfY3RsIHw9IFBMQU5FX0NPTE9SX0NTQ19NT0RFX1lVVjYwMV9UT19SR0I3MDk7
CiAKLQkJaWYgKHBsYW5lX3N0YXRlLT5iYXNlLmNvbG9yX3JhbmdlID09IERSTV9DT0xPUl9ZQ0JD
Ul9GVUxMX1JBTkdFKQorCQlpZiAocGxhbmVfc3RhdGUtPmh3LmNvbG9yX3JhbmdlID09IERSTV9D
T0xPUl9ZQ0JDUl9GVUxMX1JBTkdFKQogCQkJcGxhbmVfY29sb3JfY3RsIHw9IFBMQU5FX0NPTE9S
X1lVVl9SQU5HRV9DT1JSRUNUSU9OX0RJU0FCTEU7CiAJfSBlbHNlIGlmIChmYi0+Zm9ybWF0LT5p
c195dXYpIHsKIAkJcGxhbmVfY29sb3JfY3RsIHw9IFBMQU5FX0NPTE9SX0lOUFVUX0NTQ19FTkFC
TEU7CkBAIC01NjI1LDcgKzU2MjUsNyBAQCBzdGF0aWMgaW50IHNrbF91cGRhdGVfc2NhbGVyX3Bs
YW5lKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCXN0cnVjdCBpbnRlbF9w
bGFuZSAqaW50ZWxfcGxhbmUgPQogCQl0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5w
bGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShpbnRl
bF9wbGFuZS0+YmFzZS5kZXYpOwotCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVf
c3RhdGUtPmJhc2UuZmI7CisJc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0
ZS0+aHcuZmI7CiAJaW50IHJldDsKIAlib29sIGZvcmNlX2RldGFjaCA9ICFmYiB8fCAhcGxhbmVf
c3RhdGUtPmJhc2UudmlzaWJsZTsKIAlib29sIG5lZWRfc2NhbGVyID0gZmFsc2U7CkBAIC0xMDcy
OSw3ICsxMDcyOSw3IEBAIHN0YXRpYyB1MzIgaW50ZWxfY3Vyc29yX2Jhc2UoY29uc3Qgc3RydWN0
IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPQogCQl0b19pOTE1KHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lLT5kZXYp
OwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2Uu
ZmI7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcu
ZmI7CiAJY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IGludGVsX2ZiX29i
aihmYik7CiAJdTMyIGJhc2U7CiAKQEAgLTEwNzc3LDcgKzEwNzc3LDcgQEAgc3RhdGljIGludCBp
bnRlbF9jdXJzb3JfY2hlY2tfc3VyZmFjZShzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5l
X3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9CiAJCXRvX2k5
MTUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUtPmRldik7Ci0JdW5zaWduZWQgaW50IHJvdGF0aW9u
ID0gcGxhbmVfc3RhdGUtPmJhc2Uucm90YXRpb247CisJdW5zaWduZWQgaW50IHJvdGF0aW9uID0g
cGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uOwogCWludCBzcmNfeCwgc3JjX3k7CiAJdTMyIG9mZnNl
dDsKIAlpbnQgcmV0OwpAQCAtMTA4MTAsNyArMTA4MTAsNyBAQCBzdGF0aWMgaW50IGludGVsX2N1
cnNvcl9jaGVja19zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUp
CiAKIAkvKiBJTEsrIGRvIHRoaXMgYXV0b21hZ2ljYWxseSBpbiBoYXJkd2FyZSAqLwogCWlmIChI
QVNfR01DSChkZXZfcHJpdikgJiYgcm90YXRpb24gJiBEUk1fTU9ERV9ST1RBVEVfMTgwKSB7Ci0J
CWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7
CisJCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZi
OwogCQlpbnQgc3JjX3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJhc2Uuc3JjKSA+
PiAxNjsKIAkJaW50IHNyY19oID0gZHJtX3JlY3RfaGVpZ2h0KCZwbGFuZV9zdGF0ZS0+YmFzZS5z
cmMpID4+IDE2OwogCkBAIC0xMDgyNyw3ICsxMDgyNyw3IEBAIHN0YXRpYyBpbnQgaW50ZWxfY3Vy
c29yX2NoZWNrX3N1cmZhY2Uoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkK
IHN0YXRpYyBpbnQgaW50ZWxfY2hlY2tfY3Vyc29yKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlLAogCQkJICAgICAgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0
ZSkKIHsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5i
YXNlLmZiOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUt
Pmh3LmZiOwogCWludCByZXQ7CiAKIAlpZiAoZmIgJiYgZmItPm1vZGlmaWVyICE9IERSTV9GT1JN
QVRfTU9EX0xJTkVBUikgewpAQCAtMTA5MDEsNyArMTA5MDEsNyBAQCBzdGF0aWMgYm9vbCBpODQ1
X2N1cnNvcl9zaXplX29rKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3Rh
dGUpCiBzdGF0aWMgaW50IGk4NDVfY2hlY2tfY3Vyc29yKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlLAogCQkJICAgICBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0
YXRlKQogewotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUt
PmJhc2UuZmI7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0
ZS0+aHcuZmI7CiAJaW50IHJldDsKIAogCXJldCA9IGludGVsX2NoZWNrX2N1cnNvcihjcnRjX3N0
YXRlLCBwbGFuZV9zdGF0ZSk7CkBAIC0xMTA2Nyw3ICsxMTA2Nyw3IEBAIHN0YXRpYyB1MzIgaTl4
eF9jdXJzb3JfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAog
CQlyZXR1cm4gMDsKIAl9CiAKLQlpZiAocGxhbmVfc3RhdGUtPmJhc2Uucm90YXRpb24gJiBEUk1f
TU9ERV9ST1RBVEVfMTgwKQorCWlmIChwbGFuZV9zdGF0ZS0+aHcucm90YXRpb24gJiBEUk1fTU9E
RV9ST1RBVEVfMTgwKQogCQljbnRsIHw9IE1DVVJTT1JfUk9UQVRFXzE4MDsKIAogCXJldHVybiBj
bnRsOwpAQCAtMTExMDAsNyArMTExMDAsNyBAQCBzdGF0aWMgYm9vbCBpOXh4X2N1cnNvcl9zaXpl
X29rKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJICogY3Vy
c29ycy4KIAkgKi8KIAlpZiAoSEFTX0NVUl9GQkMoZGV2X3ByaXYpICYmCi0JICAgIHBsYW5lX3N0
YXRlLT5iYXNlLnJvdGF0aW9uICYgRFJNX01PREVfUk9UQVRFXzApIHsKKwkgICAgcGxhbmVfc3Rh
dGUtPmh3LnJvdGF0aW9uICYgRFJNX01PREVfUk9UQVRFXzApIHsKIAkJaWYgKGhlaWdodCA8IDgg
fHwgaGVpZ2h0ID4gd2lkdGgpCiAJCQlyZXR1cm4gZmFsc2U7CiAJfSBlbHNlIHsKQEAgLTExMTE2
LDcgKzExMTE2LDcgQEAgc3RhdGljIGludCBpOXh4X2NoZWNrX2N1cnNvcihzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIHsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0g
dG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOwogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQljb25zdCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCWNvbnN0
IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCWVudW0g
cGlwZSBwaXBlID0gcGxhbmUtPnBpcGU7CiAJaW50IHJldDsKIApAQCAtMTE3MjAsMTEgKzExNzIw
LDExIEBAIHN0YXRpYyBib29sIGludGVsX3dtX25lZWRfdXBkYXRlKGNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqY3VyLAogCWlmIChuZXctPmJhc2UudmlzaWJsZSAhPSBjdXItPmJhc2Uu
dmlzaWJsZSkKIAkJcmV0dXJuIHRydWU7CiAKLQlpZiAoIWN1ci0+YmFzZS5mYiB8fCAhbmV3LT5i
YXNlLmZiKQorCWlmICghY3VyLT5ody5mYiB8fCAhbmV3LT5ody5mYikKIAkJcmV0dXJuIGZhbHNl
OwogCi0JaWYgKGN1ci0+YmFzZS5mYi0+bW9kaWZpZXIgIT0gbmV3LT5iYXNlLmZiLT5tb2RpZmll
ciB8fAotCSAgICBjdXItPmJhc2Uucm90YXRpb24gIT0gbmV3LT5iYXNlLnJvdGF0aW9uIHx8CisJ
aWYgKGN1ci0+aHcuZmItPm1vZGlmaWVyICE9IG5ldy0+aHcuZmItPm1vZGlmaWVyIHx8CisJICAg
IGN1ci0+aHcucm90YXRpb24gIT0gbmV3LT5ody5yb3RhdGlvbiB8fAogCSAgICBkcm1fcmVjdF93
aWR0aCgmbmV3LT5iYXNlLnNyYykgIT0gZHJtX3JlY3Rfd2lkdGgoJmN1ci0+YmFzZS5zcmMpIHx8
CiAJICAgIGRybV9yZWN0X2hlaWdodCgmbmV3LT5iYXNlLnNyYykgIT0gZHJtX3JlY3RfaGVpZ2h0
KCZjdXItPmJhc2Uuc3JjKSB8fAogCSAgICBkcm1fcmVjdF93aWR0aCgmbmV3LT5iYXNlLmRzdCkg
IT0gZHJtX3JlY3Rfd2lkdGgoJmN1ci0+YmFzZS5kc3QpIHx8CkBAIC0xMjM1Niw3ICsxMjM1Niw3
IEBAIHN0YXRpYyBjb25zdCBjaGFyICpvdXRwdXRfZm9ybWF0cyhlbnVtIGludGVsX291dHB1dF9m
b3JtYXQgZm9ybWF0KQogc3RhdGljIHZvaWQgaW50ZWxfZHVtcF9wbGFuZV9zdGF0ZShjb25zdCBz
dHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9w
bGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7Ci0J
Y29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsK
Kwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsK
IAlzdHJ1Y3QgZHJtX2Zvcm1hdF9uYW1lX2J1ZiBmb3JtYXRfbmFtZTsKIAogCWlmICghZmIpIHsK
QEAgLTEyMzcyLDcgKzEyMzcyLDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfZHVtcF9wbGFuZV9zdGF0
ZShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCQkgICAgICBk
cm1fZ2V0X2Zvcm1hdF9uYW1lKGZiLT5mb3JtYXQtPmZvcm1hdCwgJmZvcm1hdF9uYW1lKSwKIAkJ
ICAgICAgeWVzbm8ocGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSkpOwogCURSTV9ERUJVR19LTVMo
Ilx0cm90YXRpb246IDB4JXgsIHNjYWxlcjogJWRcbiIsCi0JCSAgICAgIHBsYW5lX3N0YXRlLT5i
YXNlLnJvdGF0aW9uLCBwbGFuZV9zdGF0ZS0+c2NhbGVyX2lkKTsKKwkJICAgICAgcGxhbmVfc3Rh
dGUtPmh3LnJvdGF0aW9uLCBwbGFuZV9zdGF0ZS0+c2NhbGVyX2lkKTsKIAlpZiAocGxhbmVfc3Rh
dGUtPmJhc2UudmlzaWJsZSkKIAkJRFJNX0RFQlVHX0tNUygiXHRzcmM6ICIgRFJNX1JFQ1RfRlBf
Rk1UICIgZHN0OiAiIERSTV9SRUNUX0ZNVCAiXG4iLAogCQkJICAgICAgRFJNX1JFQ1RfRlBfQVJH
KCZwbGFuZV9zdGF0ZS0+YmFzZS5zcmMpLApAQCAtMTQ4NzQsOCArMTQ4NzQsOCBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9hdG9taWNfdHJhY2tfZmJzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0
YXRlKQogCiAJZm9yX2VhY2hfb2xkbmV3X2ludGVsX3BsYW5lX2luX3N0YXRlKHN0YXRlLCBwbGFu
ZSwgb2xkX3BsYW5lX3N0YXRlLAogCQkJCQkgICAgIG5ld19wbGFuZV9zdGF0ZSwgaSkKLQkJaW50
ZWxfZnJvbnRidWZmZXJfdHJhY2sodG9faW50ZWxfZnJvbnRidWZmZXIob2xkX3BsYW5lX3N0YXRl
LT5iYXNlLmZiKSwKLQkJCQkJdG9faW50ZWxfZnJvbnRidWZmZXIobmV3X3BsYW5lX3N0YXRlLT5i
YXNlLmZiKSwKKwkJaW50ZWxfZnJvbnRidWZmZXJfdHJhY2sodG9faW50ZWxfZnJvbnRidWZmZXIo
b2xkX3BsYW5lX3N0YXRlLT5ody5mYiksCisJCQkJCXRvX2ludGVsX2Zyb250YnVmZmVyKG5ld19w
bGFuZV9zdGF0ZS0+aHcuZmIpLAogCQkJCQlwbGFuZS0+ZnJvbnRidWZmZXJfYml0KTsKIH0KIApA
QCAtMTUwNDQsNyArMTUwNDQsNyBAQCBzdGF0aWMgaW50IGludGVsX3BsYW5lX3Bpbl9mYihzdHJ1
Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9wbGFu
ZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYp
OwotCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7CisJ
c3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJc3RydWN0
IGk5MTVfdm1hICp2bWE7CiAKIAlpZiAocGxhbmUtPmlkID09IFBMQU5FX0NVUlNPUiAmJgpAQCAt
MTUxMDksNyArMTUxMDksNyBAQCBpbnRlbF9wcmVwYXJlX3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxh
bmUgKnBsYW5lLAogCXN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKmludGVsX3N0YXRlID0KIAkJ
dG9faW50ZWxfYXRvbWljX3N0YXRlKG5ld19wbGFuZV9zdGF0ZS0+YmFzZS5zdGF0ZSk7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+ZGV2KTsKLQlz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IG5ld19wbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwlz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IG5ld19wbGFuZV9zdGF0ZS0+aHcuZmI7CiAJc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9IGludGVsX2ZiX29iaihmYik7CiAJc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9sZF9vYmogPSBpbnRlbF9mYl9vYmoocGxhbmUtPnN0YXRl
LT5mYik7CiAJaW50IHJldDsKQEAgLTE1MTc3LDEyICsxNTE3NywxMiBAQCBpbnRlbF9wcmVwYXJl
X3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCiAJCWZlbmNlID0gZG1hX3Jlc3Zf
Z2V0X2V4Y2xfcmN1KG9iai0+YmFzZS5yZXN2KTsKIAkJaWYgKGZlbmNlKSB7Ci0JCQlhZGRfcnBz
X2Jvb3N0X2FmdGVyX3ZibGFuayhuZXdfcGxhbmVfc3RhdGUtPmJhc2UuY3J0YywKKwkJCWFkZF9y
cHNfYm9vc3RfYWZ0ZXJfdmJsYW5rKG5ld19wbGFuZV9zdGF0ZS0+aHcuY3J0YywKIAkJCQkJCSAg
IGZlbmNlKTsKIAkJCWRtYV9mZW5jZV9wdXQoZmVuY2UpOwogCQl9CiAJfSBlbHNlIHsKLQkJYWRk
X3Jwc19ib29zdF9hZnRlcl92YmxhbmsobmV3X3BsYW5lX3N0YXRlLT5iYXNlLmNydGMsCisJCWFk
ZF9ycHNfYm9vc3RfYWZ0ZXJfdmJsYW5rKG5ld19wbGFuZV9zdGF0ZS0+aHcuY3J0YywKIAkJCQkJ
ICAgbmV3X3BsYW5lX3N0YXRlLT5iYXNlLmZlbmNlKTsKIAl9CiAKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2ZiYy5jCmluZGV4IGM2Y2MzNzc1ZjNiOC4uM2VhOGQwMTBkYjZjIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiYy5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJjLmMKQEAgLTY2Miw3ICs2NjIs
NyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9mYmNfdXBkYXRlX3N0YXRlX2NhY2hlKHN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjLAogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoY3J0Yy0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9mYmMgKmZiYyA9ICZkZXZfcHJpdi0+
ZmJjOwogCXN0cnVjdCBpbnRlbF9mYmNfc3RhdGVfY2FjaGUgKmNhY2hlID0gJmZiYy0+c3RhdGVf
Y2FjaGU7Ci0Jc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5m
YjsKKwlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAog
CWNhY2hlLT52bWEgPSBOVUxMOwogCWNhY2hlLT5mbGFncyA9IDA7CkBAIC02NzEsNyArNjcxLDcg
QEAgc3RhdGljIHZvaWQgaW50ZWxfZmJjX3VwZGF0ZV9zdGF0ZV9jYWNoZShzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YywKIAlpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikgfHwgSVNfQlJPQURXRUxMKGRl
dl9wcml2KSkKIAkJY2FjaGUtPmNydGMuaHN3X2Jkd19waXhlbF9yYXRlID0gY3J0Y19zdGF0ZS0+
cGl4ZWxfcmF0ZTsKIAotCWNhY2hlLT5wbGFuZS5yb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5iYXNl
LnJvdGF0aW9uOworCWNhY2hlLT5wbGFuZS5yb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5yb3Rh
dGlvbjsKIAkvKgogCSAqIFNyYyBjb29yZGluYXRlcyBhcmUgYWxyZWFkeSByb3RhdGVkIGJ5IDI3
MCBkZWdyZWVzIGZvcgogCSAqIHRoZSA5MC8yNzAgZGVncmVlIHBsYW5lIHJvdGF0aW9uIGNhc2Vz
ICh0byBtYXRjaCB0aGUKQEAgLTY4NCw3ICs2ODQsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9mYmNf
dXBkYXRlX3N0YXRlX2NhY2hlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCWNhY2hlLT5wbGFu
ZS5hZGp1c3RlZF95ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzBdLnk7CiAJY2FjaGUtPnBs
YW5lLnkgPSBwbGFuZV9zdGF0ZS0+YmFzZS5zcmMueTEgPj4gMTY7CiAKLQljYWNoZS0+cGxhbmUu
cGl4ZWxfYmxlbmRfbW9kZSA9IHBsYW5lX3N0YXRlLT5iYXNlLnBpeGVsX2JsZW5kX21vZGU7CisJ
Y2FjaGUtPnBsYW5lLnBpeGVsX2JsZW5kX21vZGUgPSBwbGFuZV9zdGF0ZS0+aHcucGl4ZWxfYmxl
bmRfbW9kZTsKIAogCWlmICghY2FjaGUtPnBsYW5lLnZpc2libGUpCiAJCXJldHVybjsKQEAgLTEw
NDcsNyArMTA0Nyw3IEBAIHZvaWQgaW50ZWxfZmJjX2Nob29zZV9jcnRjKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwKIAkgKiB0byBwaXBlIG9yIHBsYW5lIEEuICovCiAJZm9yX2Vh
Y2hfbmV3X2ludGVsX3BsYW5lX2luX3N0YXRlKHN0YXRlLCBwbGFuZSwgcGxhbmVfc3RhdGUsIGkp
IHsKIAkJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGU7Ci0JCXN0cnVjdCBpbnRl
bF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhwbGFuZV9zdGF0ZS0+YmFzZS5jcnRjKTsKKwkJ
c3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKHBsYW5lX3N0YXRlLT5ody5j
cnRjKTsKIAogCQlpZiAoIXBsYW5lLT5oYXNfZmJjKQogCQkJY29udGludWU7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3ZlcmxheS5jCmluZGV4IDg0OGNlMDdhOGVjMi4u
NDZlM2Q2Y2Y1OTc2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX292ZXJsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292
ZXJsYXkuYwpAQCAtNjY5LDcgKzY2OSw3IEBAIHN0YXRpYyB2b2lkIHVwZGF0ZV9jb2xvcmtleShz
dHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3ZlcmxheSwKIAkJZmxhZ3MgfD0gRFNUX0tFWV9FTkFCTEU7
CiAKIAlpZiAoc3RhdGUtPmJhc2UudmlzaWJsZSkKLQkJZm9ybWF0ID0gc3RhdGUtPmJhc2UuZmIt
PmZvcm1hdC0+Zm9ybWF0OworCQlmb3JtYXQgPSBzdGF0ZS0+aHcuZmItPmZvcm1hdC0+Zm9ybWF0
OwogCiAJc3dpdGNoIChmb3JtYXQpIHsKIAljYXNlIERSTV9GT1JNQVRfQzg6CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYwppbmRleCA1YmE4ZmFmMGNjZmUuLmIy
MTE2ZDEyMzU0OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9zcHJpdGUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0
ZS5jCkBAIC0yNDEsOCArMjQxLDggQEAgdm9pZCBpbnRlbF9waXBlX3VwZGF0ZV9lbmQoc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKQogaW50IGludGVsX3BsYW5lX2NoZWNr
X3N0cmlkZShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewog
CXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+
YmFzZS5wbGFuZSk7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9z
dGF0ZS0+YmFzZS5mYjsKLQl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+YmFz
ZS5yb3RhdGlvbjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0
YXRlLT5ody5mYjsKKwl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90
YXRpb247CiAJdTMyIHN0cmlkZSwgbWF4X3N0cmlkZTsKIAogCS8qCkBAIC0yNzIsMTAgKzI3Miwx
MCBAQCBpbnQgaW50ZWxfcGxhbmVfY2hlY2tfc3RyaWRlKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFu
ZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAKIGludCBpbnRlbF9wbGFuZV9jaGVja19zcmNfY29vcmRp
bmF0ZXMoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQljb25zdCBz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCWNvbnN0
IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCXN0cnVj
dCBkcm1fcmVjdCAqc3JjID0gJnBsYW5lX3N0YXRlLT5iYXNlLnNyYzsKIAl1MzIgc3JjX3gsIHNy
Y195LCBzcmNfdywgc3JjX2gsIGhzdWIsIHZzdWI7Ci0JYm9vbCByb3RhdGVkID0gZHJtX3JvdGF0
aW9uXzkwX29yXzI3MChwbGFuZV9zdGF0ZS0+YmFzZS5yb3RhdGlvbik7CisJYm9vbCByb3RhdGVk
ID0gZHJtX3JvdGF0aW9uXzkwX29yXzI3MChwbGFuZV9zdGF0ZS0+aHcucm90YXRpb24pOwogCiAJ
LyoKIAkgKiBIYXJkd2FyZSBkb2Vzbid0IGhhbmRsZSBzdWJwaXhlbCBjb29yZGluYXRlcy4KQEAg
LTMyOSw3ICszMjksNyBAQCBza2xfcGxhbmVfcmF0aW8oY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUsCiAJCXVuc2lnbmVkIGludCAqbnVtLCB1bnNpZ25lZCBpbnQgKmRl
bikKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5l
X3N0YXRlLT5iYXNlLnBsYW5lLT5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIg
KmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZl
ciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAKIAlpZiAoZmItPmZvcm1hdC0+Y3BwWzBdID09
IDgpIHsKIAkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShk
ZXZfcHJpdikpIHsKQEAgLTM5Niw3ICszOTYsNyBAQCBza2xfcHJvZ3JhbV9zY2FsZXIoc3RydWN0
IGludGVsX3BsYW5lICpwbGFuZSwKIAkJICAgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KHBsYW5lLT5iYXNlLmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAq
ZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVy
ICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAllbnVtIHBpcGUgcGlwZSA9IHBsYW5lLT5waXBl
OwogCWludCBzY2FsZXJfaWQgPSBwbGFuZV9zdGF0ZS0+c2NhbGVyX2lkOwogCWNvbnN0IHN0cnVj
dCBpbnRlbF9zY2FsZXIgKnNjYWxlciA9CkBAIC01NDIsMTAgKzU0MiwxMCBAQCBpY2xfcHJvZ3Jh
bV9pbnB1dF9jc2Moc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAl9OwogCWNvbnN0IHUxNiAq
Y3NjOwogCi0JaWYgKHBsYW5lX3N0YXRlLT5iYXNlLmNvbG9yX3JhbmdlID09IERSTV9DT0xPUl9Z
Q0JDUl9GVUxMX1JBTkdFKQotCQljc2MgPSBpbnB1dF9jc2NfbWF0cml4W3BsYW5lX3N0YXRlLT5i
YXNlLmNvbG9yX2VuY29kaW5nXTsKKwlpZiAocGxhbmVfc3RhdGUtPmh3LmNvbG9yX3JhbmdlID09
IERSTV9DT0xPUl9ZQ0JDUl9GVUxMX1JBTkdFKQorCQljc2MgPSBpbnB1dF9jc2NfbWF0cml4W3Bs
YW5lX3N0YXRlLT5ody5jb2xvcl9lbmNvZGluZ107CiAJZWxzZQotCQljc2MgPSBpbnB1dF9jc2Nf
bWF0cml4X2xyW3BsYW5lX3N0YXRlLT5iYXNlLmNvbG9yX2VuY29kaW5nXTsKKwkJY3NjID0gaW5w
dXRfY3NjX21hdHJpeF9scltwbGFuZV9zdGF0ZS0+aHcuY29sb3JfZW5jb2RpbmddOwogCiAJSTkx
NV9XUklURV9GVyhQTEFORV9JTlBVVF9DU0NfQ09FRkYocGlwZSwgcGxhbmVfaWQsIDApLCBST0ZG
KGNzY1swXSkgfAogCQkgICAgICBHT0ZGKGNzY1sxXSkpOwpAQCAtNTU5LDcgKzU1OSw3IEBAIGlj
bF9wcm9ncmFtX2lucHV0X2NzYyhzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCiAJSTkxNV9X
UklURV9GVyhQTEFORV9JTlBVVF9DU0NfUFJFT0ZGKHBpcGUsIHBsYW5lX2lkLCAwKSwKIAkJICAg
ICAgUFJFT0ZGX1lVVl9UT19SR0JfSEkpOwotCWlmIChwbGFuZV9zdGF0ZS0+YmFzZS5jb2xvcl9y
YW5nZSA9PSBEUk1fQ09MT1JfWUNCQ1JfRlVMTF9SQU5HRSkKKwlpZiAocGxhbmVfc3RhdGUtPmh3
LmNvbG9yX3JhbmdlID09IERSTV9DT0xPUl9ZQ0JDUl9GVUxMX1JBTkdFKQogCQlJOTE1X1dSSVRF
X0ZXKFBMQU5FX0lOUFVUX0NTQ19QUkVPRkYocGlwZSwgcGxhbmVfaWQsIDEpLCAwKTsKIAllbHNl
CiAJCUk5MTVfV1JJVEVfRlcoUExBTkVfSU5QVVRfQ1NDX1BSRU9GRihwaXBlLCBwbGFuZV9pZCwg
MSksCkBAIC01OTEsOCArNTkxLDggQEAgc2tsX3Byb2dyYW1fcGxhbmUoc3RydWN0IGludGVsX3Bs
YW5lICpwbGFuZSwKIAl1MzIgc3JjX3cgPSBkcm1fcmVjdF93aWR0aCgmcGxhbmVfc3RhdGUtPmJh
c2Uuc3JjKSA+PiAxNjsKIAl1MzIgc3JjX2ggPSBkcm1fcmVjdF9oZWlnaHQoJnBsYW5lX3N0YXRl
LT5iYXNlLnNyYykgPj4gMTY7CiAJc3RydWN0IGludGVsX3BsYW5lICpsaW5rZWQgPSBwbGFuZV9z
dGF0ZS0+cGxhbmFyX2xpbmtlZF9wbGFuZTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVy
ICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOwotCXU4IGFscGhhID0gcGxhbmVfc3RhdGUtPmJh
c2UuYWxwaGEgPj4gODsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5l
X3N0YXRlLT5ody5mYjsKKwl1OCBhbHBoYSA9IHBsYW5lX3N0YXRlLT5ody5hbHBoYSA+PiA4Owog
CXUzMiBwbGFuZV9jb2xvcl9jdGwgPSAwOwogCXVuc2lnbmVkIGxvbmcgaXJxZmxhZ3M7CiAJdTMy
IGtleW1zaywga2V5bWF4OwpAQCAtNzY4LDcgKzc2OCw3IEBAIGNodl91cGRhdGVfY3NjKGNvbnN0
IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7CiAJc3RydWN0IGludGVs
X3BsYW5lICpwbGFuZSA9IHRvX2ludGVsX3BsYW5lKHBsYW5lX3N0YXRlLT5iYXNlLnBsYW5lKTsK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNl
LmRldik7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+
YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRl
LT5ody5mYjsKIAllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0gcGxhbmUtPmlkOwogCS8qCiAJICog
fHJ8ICAgfCBjMCBjMSBjMiB8ICAgfGNyfApAQCAtNzk0LDcgKzc5NCw3IEBAIGNodl91cGRhdGVf
Y3NjKGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiAJCQkgICAg
MCwgNDA5NiwgIDc2MDEsCiAJCX0sCiAJfTsKLQljb25zdCBzMTYgKmNzYyA9IGNzY19tYXRyaXhb
cGxhbmVfc3RhdGUtPmJhc2UuY29sb3JfZW5jb2RpbmddOworCWNvbnN0IHMxNiAqY3NjID0gY3Nj
X21hdHJpeFtwbGFuZV9zdGF0ZS0+aHcuY29sb3JfZW5jb2RpbmddOwogCiAJLyogU2VlbXMgUkdC
IGRhdGEgYnlwYXNzZXMgdGhlIENTQyBhbHdheXMgKi8KIAlpZiAoIWZiLT5mb3JtYXQtPmlzX3l1
dikKQEAgLTgyNywxMyArODI3LDEzIEBAIHZsdl91cGRhdGVfY2xyYyhjb25zdCBzdHJ1Y3QgaW50
ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxh
bmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CiAJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwotCWNv
bnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7CisJ
Y29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJ
ZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlwZTsKIAllbnVtIHBsYW5lX2lkIHBsYW5lX2lkID0g
cGxhbmUtPmlkOwogCWludCBjb250cmFzdCwgYnJpZ2h0bmVzcywgc2hfc2NhbGUsIHNoX3Npbiwg
c2hfY29zOwogCiAJaWYgKGZiLT5mb3JtYXQtPmlzX3l1diAmJgotCSAgICBwbGFuZV9zdGF0ZS0+
YmFzZS5jb2xvcl9yYW5nZSA9PSBEUk1fQ09MT1JfWUNCQ1JfTElNSVRFRF9SQU5HRSkgeworCSAg
ICBwbGFuZV9zdGF0ZS0+aHcuY29sb3JfcmFuZ2UgPT0gRFJNX0NPTE9SX1lDQkNSX0xJTUlURURf
UkFOR0UpIHsKIAkJLyoKIAkJICogRXhwYW5kIGxpbWl0ZWQgcmFuZ2UgdG8gZnVsbCByYW5nZToK
IAkJICogQ29udHJhc3QgaXMgYXBwbGllZCBmaXJzdCBhbmQgaXMgdXNlZCB0byBleHBhbmQgWSBy
YW5nZS4KQEAgLTg2Nyw3ICs4NjcsNyBAQCB2bHZfcGxhbmVfcmF0aW8oY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCXVuc2lnbmVkIGludCAqbnVtLCB1bnNpZ25l
ZCBpbnQgKmRlbikKIHsKIAl1OCBhY3RpdmVfcGxhbmVzID0gY3J0Y19zdGF0ZS0+YWN0aXZlX3Bs
YW5lcyAmIH5CSVQoUExBTkVfQ1VSU09SKTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVy
ICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZm
ZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCXVuc2lnbmVkIGludCBjcHAgPSBmYi0+Zm9y
bWF0LT5jcHBbMF07CiAKIAkvKgpAQCAtOTUzLDggKzk1Myw4IEBAIHN0YXRpYyB1MzIgdmx2X3Nw
cml0ZV9jdGxfY3J0Yyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkK
IHN0YXRpYyB1MzIgdmx2X3Nwcml0ZV9jdGwoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUsCiAJCQkgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVf
c3RhdGUpCiB7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0
ZS0+YmFzZS5mYjsKLQl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+YmFzZS5y
b3RhdGlvbjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRl
LT5ody5mYjsKKwl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRp
b247CiAJY29uc3Qgc3RydWN0IGRybV9pbnRlbF9zcHJpdGVfY29sb3JrZXkgKmtleSA9ICZwbGFu
ZV9zdGF0ZS0+Y2tleTsKIAl1MzIgc3ByY3RsOwogCkBAIC05OTksNyArOTk5LDcgQEAgc3RhdGlj
IHUzMiB2bHZfc3ByaXRlX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSwKIAkJcmV0dXJuIDA7CiAJfQogCi0JaWYgKHBsYW5lX3N0YXRlLT5iYXNlLmNvbG9yX2Vu
Y29kaW5nID09IERSTV9DT0xPUl9ZQ0JDUl9CVDcwOSkKKwlpZiAocGxhbmVfc3RhdGUtPmh3LmNv
bG9yX2VuY29kaW5nID09IERSTV9DT0xPUl9ZQ0JDUl9CVDcwOSkKIAkJc3ByY3RsIHw9IFNQX1lV
Vl9GT1JNQVRfQlQ3MDk7CiAKIAlpZiAoZmItPm1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9Y
X1RJTEVEKQpAQCAtMTAyMSw3ICsxMDIxLDcgQEAgc3RhdGljIHZvaWQgdmx2X3VwZGF0ZV9nYW1t
YShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVj
dCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5w
bGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFu
ZS0+YmFzZS5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVf
c3RhdGUtPmJhc2UuZmI7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFu
ZV9zdGF0ZS0+aHcuZmI7CiAJZW51bSBwaXBlIHBpcGUgPSBwbGFuZS0+cGlwZTsKIAllbnVtIHBs
YW5lX2lkIHBsYW5lX2lkID0gcGxhbmUtPmlkOwogCXUxNiBnYW1tYVs4XTsKQEAgLTExNTEsNyAr
MTE1MSw3IEBAIHN0YXRpYyB2b2lkIGl2Yl9wbGFuZV9yYXRpbyhjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgICB1bnNpZ25lZCBpbnQgKm51bSwgdW5zaWdu
ZWQgaW50ICpkZW4pCiB7CiAJdTggYWN0aXZlX3BsYW5lcyA9IGNydGNfc3RhdGUtPmFjdGl2ZV9w
bGFuZXMgJiB+QklUKFBMQU5FX0NVUlNPUik7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZl
ciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAl1bnNpZ25lZCBpbnQgY3BwID0gZmItPmZv
cm1hdC0+Y3BwWzBdOwogCiAJaWYgKGh3ZWlnaHQ4KGFjdGl2ZV9wbGFuZXMpID09IDIpIHsKQEAg
LTExODcsNyArMTE4Nyw3IEBAIHN0YXRpYyB2b2lkIGl2Yl9wbGFuZV9yYXRpb19zY2FsaW5nKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCSAgICBjb25zdCBz
dHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlLAogCQkJCSAgICB1bnNpZ25lZCBp
bnQgKm51bSwgdW5zaWduZWQgaW50ICpkZW4pCiB7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAl1bnNpZ25lZCBpbnQgY3BwID0gZmIt
PmZvcm1hdC0+Y3BwWzBdOwogCiAJc3dpdGNoIChjcHApIHsKQEAgLTEyNjUsNyArMTI2NSw3IEBA
IHN0YXRpYyB2b2lkIGhzd19wbGFuZV9yYXRpbyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqY3J0Y19zdGF0ZSwKIAkJCSAgICB1bnNpZ25lZCBpbnQgKm51bSwgdW5zaWduZWQgaW50ICpk
ZW4pCiB7CiAJdTggYWN0aXZlX3BsYW5lcyA9IGNydGNfc3RhdGUtPmFjdGl2ZV9wbGFuZXMgJiB+
QklUKFBMQU5FX0NVUlNPUik7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBw
bGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9
IHBsYW5lX3N0YXRlLT5ody5mYjsKIAl1bnNpZ25lZCBpbnQgY3BwID0gZmItPmZvcm1hdC0+Y3Bw
WzBdOwogCiAJaWYgKGh3ZWlnaHQ4KGFjdGl2ZV9wbGFuZXMpID09IDIpIHsKQEAgLTEzMjEsNyAr
MTMyMSw3IEBAIHN0YXRpYyBib29sIGl2Yl9uZWVkX3Nwcml0ZV9nYW1tYShjb25zdCBzdHJ1Y3Qg
aW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9CiAJCXRvX2k5MTUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUtPmRldik7
Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5m
YjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5m
YjsKIAogCXJldHVybiBmYi0+Zm9ybWF0LT5jcHBbMF0gPT0gOCAmJgogCQkoSVNfSVZZQlJJREdF
KGRldl9wcml2KSB8fCBJU19IQVNXRUxMKGRldl9wcml2KSk7CkBAIC0xMzMyLDggKzEzMzIsOCBA
QCBzdGF0aWMgdTMyIGl2Yl9zcHJpdGVfY3RsKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlLAogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9CiAJ
CXRvX2k5MTUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUtPmRldik7Ci0JY29uc3Qgc3RydWN0IGRy
bV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKLQl1bnNpZ25lZCBpbnQg
cm90YXRpb24gPSBwbGFuZV9zdGF0ZS0+YmFzZS5yb3RhdGlvbjsKKwljb25zdCBzdHJ1Y3QgZHJt
X2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKKwl1bnNpZ25lZCBpbnQgcm90
YXRpb24gPSBwbGFuZV9zdGF0ZS0+aHcucm90YXRpb247CiAJY29uc3Qgc3RydWN0IGRybV9pbnRl
bF9zcHJpdGVfY29sb3JrZXkgKmtleSA9ICZwbGFuZV9zdGF0ZS0+Y2tleTsKIAl1MzIgc3ByY3Rs
OwogCkBAIC0xMzc1LDEwICsxMzc1LDEwIEBAIHN0YXRpYyB1MzIgaXZiX3Nwcml0ZV9jdGwoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJaWYgKCFpdmJfbmVlZF9z
cHJpdGVfZ2FtbWEocGxhbmVfc3RhdGUpKQogCQlzcHJjdGwgfD0gU1BSSVRFX0lOVF9HQU1NQV9E
SVNBQkxFOwogCi0JaWYgKHBsYW5lX3N0YXRlLT5iYXNlLmNvbG9yX2VuY29kaW5nID09IERSTV9D
T0xPUl9ZQ0JDUl9CVDcwOSkKKwlpZiAocGxhbmVfc3RhdGUtPmh3LmNvbG9yX2VuY29kaW5nID09
IERSTV9DT0xPUl9ZQ0JDUl9CVDcwOSkKIAkJc3ByY3RsIHw9IFNQUklURV9ZVVZfVE9fUkdCX0NT
Q19GT1JNQVRfQlQ3MDk7CiAKLQlpZiAocGxhbmVfc3RhdGUtPmJhc2UuY29sb3JfcmFuZ2UgPT0g
RFJNX0NPTE9SX1lDQkNSX0ZVTExfUkFOR0UpCisJaWYgKHBsYW5lX3N0YXRlLT5ody5jb2xvcl9y
YW5nZSA9PSBEUk1fQ09MT1JfWUNCQ1JfRlVMTF9SQU5HRSkKIAkJc3ByY3RsIHw9IFNQUklURV9Z
VVZfUkFOR0VfQ09SUkVDVElPTl9ESVNBQkxFOwogCiAJaWYgKGZiLT5tb2RpZmllciA9PSBJOTE1
X0ZPUk1BVF9NT0RfWF9USUxFRCkKQEAgLTE1NjcsNyArMTU2Nyw3IEBAIGl2Yl9wbGFuZV9nZXRf
aHdfc3RhdGUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIHN0YXRpYyBpbnQgZzR4X3Nwcml0
ZV9taW5fY2RjbGsoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJ
CQkJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKLQljb25z
dCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCWNv
bnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCXVu
c2lnbmVkIGludCBoc2NhbGUsIHBpeGVsX3JhdGU7CiAJdW5zaWduZWQgaW50IGxpbWl0LCBkZWNp
bWF0ZTsKIApAQCAtMTYzNyw4ICsxNjM3LDggQEAgc3RhdGljIHUzMiBnNHhfc3ByaXRlX2N0bChj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIHsKIAlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQogCQl0b19pOTE1KHBsYW5lX3N0YXRlLT5iYXNlLnBs
YW5lLT5kZXYpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3Rh
dGUtPmJhc2UuZmI7Ci0JdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmJhc2Uu
cm90YXRpb247CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0
ZS0+aHcuZmI7CisJdW5zaWduZWQgaW50IHJvdGF0aW9uID0gcGxhbmVfc3RhdGUtPmh3LnJvdGF0
aW9uOwogCWNvbnN0IHN0cnVjdCBkcm1faW50ZWxfc3ByaXRlX2NvbG9ya2V5ICprZXkgPSAmcGxh
bmVfc3RhdGUtPmNrZXk7CiAJdTMyIGR2c2NudHI7CiAKQEAgLTE2NzcsMTAgKzE2NzcsMTAgQEAg
c3RhdGljIHUzMiBnNHhfc3ByaXRlX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSwKIAkJcmV0dXJuIDA7CiAJfQogCi0JaWYgKHBsYW5lX3N0YXRlLT5iYXNlLmNv
bG9yX2VuY29kaW5nID09IERSTV9DT0xPUl9ZQ0JDUl9CVDcwOSkKKwlpZiAocGxhbmVfc3RhdGUt
Pmh3LmNvbG9yX2VuY29kaW5nID09IERSTV9DT0xPUl9ZQ0JDUl9CVDcwOSkKIAkJZHZzY250ciB8
PSBEVlNfWVVWX0ZPUk1BVF9CVDcwOTsKIAotCWlmIChwbGFuZV9zdGF0ZS0+YmFzZS5jb2xvcl9y
YW5nZSA9PSBEUk1fQ09MT1JfWUNCQ1JfRlVMTF9SQU5HRSkKKwlpZiAocGxhbmVfc3RhdGUtPmh3
LmNvbG9yX3JhbmdlID09IERSTV9DT0xPUl9ZQ0JDUl9GVUxMX1JBTkdFKQogCQlkdnNjbnRyIHw9
IERWU19ZVVZfUkFOR0VfQ09SUkVDVElPTl9ESVNBQkxFOwogCiAJaWYgKGZiLT5tb2RpZmllciA9
PSBJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRCkKQEAgLTE3MDEsNyArMTcwMSw3IEBAIHN0YXRpYyB2
b2lkIGc0eF91cGRhdGVfZ2FtbWEoY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFu
ZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUo
cGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1l
YnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCWNvbnN0IHN0cnVjdCBkcm1fZnJh
bWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCWVudW0gcGlwZSBwaXBlID0gcGxh
bmUtPnBpcGU7CiAJdTE2IGdhbW1hWzhdOwogCWludCBpOwpAQCAtMTczMyw3ICsxNzMzLDcgQEAg
c3RhdGljIHZvaWQgaWxrX3VwZGF0ZV9nYW1tYShjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3Rh
dGUgKnBsYW5lX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRl
bF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwotCWNvbnN0IHN0cnVjdCBk
cm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJhc2UuZmI7CisJY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJZW51bSBwaXBlIHBp
cGUgPSBwbGFuZS0+cGlwZTsKIAl1MTYgZ2FtbWFbMTddOwogCWludCBpOwpAQCAtMTg4Nyw3ICsx
ODg3LDcgQEAgc3RhdGljIGludAogZzR4X3Nwcml0ZV9jaGVja19zY2FsaW5nKHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJIHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUpCiB7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFu
ZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBs
YW5lX3N0YXRlLT5ody5mYjsKIAljb25zdCBzdHJ1Y3QgZHJtX3JlY3QgKnNyYyA9ICZwbGFuZV9z
dGF0ZS0+YmFzZS5zcmM7CiAJY29uc3Qgc3RydWN0IGRybV9yZWN0ICpkc3QgPSAmcGxhbmVfc3Rh
dGUtPmJhc2UuZHN0OwogCWludCBzcmNfeCwgc3JjX3csIHNyY19oLCBjcnRjX3csIGNydGNfaDsK
QEAgLTE5NTQsNyArMTk1NCw3IEBAIGc0eF9zcHJpdGVfY2hlY2soc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUsCiAJaW50IG1heF9zY2FsZSA9IERSTV9QTEFORV9IRUxQRVJfTk9f
U0NBTElORzsKIAlpbnQgcmV0OwogCi0JaWYgKGludGVsX2ZiX3NjYWxhYmxlKHBsYW5lX3N0YXRl
LT5iYXNlLmZiKSkgeworCWlmIChpbnRlbF9mYl9zY2FsYWJsZShwbGFuZV9zdGF0ZS0+aHcuZmIp
KSB7CiAJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgNykgewogCQkJbWluX3NjYWxlID0gMTsK
IAkJCW1heF9zY2FsZSA9IDE2IDw8IDE2OwpAQCAtMTk5OCw3ICsxOTk4LDcgQEAgaW50IGNodl9w
bGFuZV9jaGVja19yb3RhdGlvbihjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5l
X3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19pbnRlbF9wbGFuZShw
bGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0gdG9faTkxNShwbGFuZS0+YmFzZS5kZXYpOwotCXVuc2lnbmVkIGludCByb3RhdGlvbiA9
IHBsYW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9uOworCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBs
YW5lX3N0YXRlLT5ody5yb3RhdGlvbjsKIAogCS8qIENIViBpZ25vcmVzIHRoZSBtaXJyb3IgYml0
IHdoZW4gdGhlIHJvdGF0ZSBiaXQgaXMgc2V0IDooICovCiAJaWYgKElTX0NIRVJSWVZJRVcoZGV2
X3ByaXYpICYmCkBAIC0yMDUwLDggKzIwNTAsOCBAQCBzdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVj
a19mYihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIHsKIAlzdHJ1
Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2Uu
cGxhbmUpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxh
bmUtPmJhc2UuZGV2KTsKLQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5l
X3N0YXRlLT5iYXNlLmZiOwotCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5i
YXNlLnJvdGF0aW9uOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVf
c3RhdGUtPmh3LmZiOworCXVuc2lnbmVkIGludCByb3RhdGlvbiA9IHBsYW5lX3N0YXRlLT5ody5y
b3RhdGlvbjsKIAlzdHJ1Y3QgZHJtX2Zvcm1hdF9uYW1lX2J1ZiBmb3JtYXRfbmFtZTsKIAogCWlm
ICghZmIpCkBAIC0yMTUxLDggKzIxNTEsOCBAQCBzdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVja19k
c3RfY29vcmRpbmF0ZXMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfcwogCiBz
dGF0aWMgaW50IHNrbF9wbGFuZV9jaGVja19udjEyX3JvdGF0aW9uKGNvbnN0IHN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUpCiB7Ci0JY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKLQl1bnNpZ25lZCBpbnQgcm90YXRpb24g
PSBwbGFuZV9zdGF0ZS0+YmFzZS5yb3RhdGlvbjsKKwljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVm
ZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKKwl1bnNpZ25lZCBpbnQgcm90YXRpb24gPSBw
bGFuZV9zdGF0ZS0+aHcucm90YXRpb247CiAJaW50IHNyY193ID0gZHJtX3JlY3Rfd2lkdGgoJnBs
YW5lX3N0YXRlLT5iYXNlLnNyYykgPj4gMTY7CiAKIAkvKiBEaXNwbGF5IFdBICMxMTA2ICovCkBA
IC0yMTg3LDcgKzIxODcsNyBAQCBzdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVjayhzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIHsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5l
ID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOwogCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsKLQljb25z
dCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCWNv
bnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmh3LmZiOwogCWlu
dCBtaW5fc2NhbGUgPSBEUk1fUExBTkVfSEVMUEVSX05PX1NDQUxJTkc7CiAJaW50IG1heF9zY2Fs
ZSA9IERSTV9QTEFORV9IRUxQRVJfTk9fU0NBTElORzsKIAlpbnQgcmV0OwpAQCAtMjIyOSw3ICsy
MjI5LDcgQEAgc3RhdGljIGludCBza2xfcGxhbmVfY2hlY2soc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUsCiAJCXJldHVybiByZXQ7CiAKIAkvKiBIVyBvbmx5IGhhcyA4IGJpdHMg
cGl4ZWwgcHJlY2lzaW9uLCBkaXNhYmxlIHBsYW5lIGlmIGludmlzaWJsZSAqLwotCWlmICghKHBs
YW5lX3N0YXRlLT5iYXNlLmFscGhhID4+IDgpKQorCWlmICghKHBsYW5lX3N0YXRlLT5ody5hbHBo
YSA+PiA4KSkKIAkJcGxhbmVfc3RhdGUtPmJhc2UudmlzaWJsZSA9IGZhbHNlOwogCiAJcGxhbmVf
c3RhdGUtPmN0bCA9IHNrbF9wbGFuZV9jdGwoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX3BtLmMKaW5kZXggYjAzNzk1ZjkyYzg0Li4wYTAxMDNlY2Y3YmMgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaW50ZWxfcG0uYwpAQCAtODAxLDcgKzgwMSw3IEBAIHN0YXRpYyBib29sIGludGVs
X3dtX3BsYW5lX3Zpc2libGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGUsCiAJICogYXJvdW5kIHRoaXMgcHJvYmxlbSB3aXRoIHRoZSB3YXRlcm1hcmsgY29kZS4KIAkg
Ki8KIAlpZiAocGxhbmUtPmlkID09IFBMQU5FX0NVUlNPUikKLQkJcmV0dXJuIHBsYW5lX3N0YXRl
LT5iYXNlLmZiICE9IE5VTEw7CisJCXJldHVybiBwbGFuZV9zdGF0ZS0+aHcuZmIgIT0gTlVMTDsK
IAllbHNlCiAJCXJldHVybiBwbGFuZV9zdGF0ZS0+YmFzZS52aXNpYmxlOwogfQpAQCAtMTA4OCw3
ICsxMDg4LDcgQEAgc3RhdGljIHUxNiBnNHhfY29tcHV0ZV93bShjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlpZiAoIWludGVsX3dtX3BsYW5lX3Zpc2libGUoY3J0
Y19zdGF0ZSwgcGxhbmVfc3RhdGUpKQogCQlyZXR1cm4gMDsKIAotCWNwcCA9IHBsYW5lX3N0YXRl
LT5iYXNlLmZiLT5mb3JtYXQtPmNwcFswXTsKKwljcHAgPSBwbGFuZV9zdGF0ZS0+aHcuZmItPmZv
cm1hdC0+Y3BwWzBdOwogCiAJLyoKIAkgKiBOb3QgMTAwJSBzdXJlIHdoaWNoIHdheSBFTEsgc2hv
dWxkIGdvIGhlcmUgYXMgdGhlCkBAIC0xMzA4LDggKzEzMDgsOCBAQCBzdGF0aWMgaW50IGc0eF9j
b21wdXRlX3BpcGVfd20oc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJZm9y
X2VhY2hfb2xkbmV3X2ludGVsX3BsYW5lX2luX3N0YXRlKHN0YXRlLCBwbGFuZSwKIAkJCQkJICAg
ICBvbGRfcGxhbmVfc3RhdGUsCiAJCQkJCSAgICAgbmV3X3BsYW5lX3N0YXRlLCBpKSB7Ci0JCWlm
IChuZXdfcGxhbmVfc3RhdGUtPmJhc2UuY3J0YyAhPSAmY3J0Yy0+YmFzZSAmJgotCQkgICAgb2xk
X3BsYW5lX3N0YXRlLT5iYXNlLmNydGMgIT0gJmNydGMtPmJhc2UpCisJCWlmIChuZXdfcGxhbmVf
c3RhdGUtPmh3LmNydGMgIT0gJmNydGMtPmJhc2UgJiYKKwkJICAgIG9sZF9wbGFuZV9zdGF0ZS0+
aHcuY3J0YyAhPSAmY3J0Yy0+YmFzZSkKIAkJCWNvbnRpbnVlOwogCiAJCWlmIChnNHhfcmF3X3Bs
YW5lX3dtX2NvbXB1dGUoY3J0Y19zdGF0ZSwgbmV3X3BsYW5lX3N0YXRlKSkKQEAgLTE1OTMsNyAr
MTU5Myw3IEBAIHN0YXRpYyB1MTYgdmx2X2NvbXB1dGVfd21fbGV2ZWwoY29uc3Qgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJaWYgKCFpbnRlbF93bV9wbGFuZV92aXNpYmxl
KGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKSkKIAkJcmV0dXJuIDA7CiAKLQljcHAgPSBwbGFuZV9z
dGF0ZS0+YmFzZS5mYi0+Zm9ybWF0LT5jcHBbMF07CisJY3BwID0gcGxhbmVfc3RhdGUtPmh3LmZi
LT5mb3JtYXQtPmNwcFswXTsKIAljbG9jayA9IGFkanVzdGVkX21vZGUtPmNydGNfY2xvY2s7CiAJ
aHRvdGFsID0gYWRqdXN0ZWRfbW9kZS0+Y3J0Y19odG90YWw7CiAJd2lkdGggPSBjcnRjX3N0YXRl
LT5waXBlX3NyY193OwpAQCAtMTgyOSw4ICsxODI5LDggQEAgc3RhdGljIGludCB2bHZfY29tcHV0
ZV9waXBlX3dtKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCWZvcl9lYWNo
X29sZG5ld19pbnRlbF9wbGFuZV9pbl9zdGF0ZShzdGF0ZSwgcGxhbmUsCiAJCQkJCSAgICAgb2xk
X3BsYW5lX3N0YXRlLAogCQkJCQkgICAgIG5ld19wbGFuZV9zdGF0ZSwgaSkgewotCQlpZiAobmV3
X3BsYW5lX3N0YXRlLT5iYXNlLmNydGMgIT0gJmNydGMtPmJhc2UgJiYKLQkJICAgIG9sZF9wbGFu
ZV9zdGF0ZS0+YmFzZS5jcnRjICE9ICZjcnRjLT5iYXNlKQorCQlpZiAobmV3X3BsYW5lX3N0YXRl
LT5ody5jcnRjICE9ICZjcnRjLT5iYXNlICYmCisJCSAgICBvbGRfcGxhbmVfc3RhdGUtPmh3LmNy
dGMgIT0gJmNydGMtPmJhc2UpCiAJCQljb250aW51ZTsKIAogCQlpZiAodmx2X3Jhd19wbGFuZV93
bV9jb21wdXRlKGNydGNfc3RhdGUsIG5ld19wbGFuZV9zdGF0ZSkpCkBAIC0yNDc1LDcgKzI0NzUs
NyBAQCBzdGF0aWMgdTMyIGlsa19jb21wdXRlX3ByaV93bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlpZiAoIWludGVsX3dtX3BsYW5lX3Zpc2libGUoY3J0Y19z
dGF0ZSwgcGxhbmVfc3RhdGUpKQogCQlyZXR1cm4gMDsKIAotCWNwcCA9IHBsYW5lX3N0YXRlLT5i
YXNlLmZiLT5mb3JtYXQtPmNwcFswXTsKKwljcHAgPSBwbGFuZV9zdGF0ZS0+aHcuZmItPmZvcm1h
dC0+Y3BwWzBdOwogCiAJbWV0aG9kMSA9IGlsa193bV9tZXRob2QxKGNydGNfc3RhdGUtPnBpeGVs
X3JhdGUsIGNwcCwgbWVtX3ZhbHVlKTsKIApAQCAtMjUwNyw3ICsyNTA3LDcgQEAgc3RhdGljIHUz
MiBpbGtfY29tcHV0ZV9zcHJfd20oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCiAJaWYgKCFpbnRlbF93bV9wbGFuZV92aXNpYmxlKGNydGNfc3RhdGUsIHBsYW5lX3N0
YXRlKSkKIAkJcmV0dXJuIDA7CiAKLQljcHAgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYi0+Zm9ybWF0
LT5jcHBbMF07CisJY3BwID0gcGxhbmVfc3RhdGUtPmh3LmZiLT5mb3JtYXQtPmNwcFswXTsKIAog
CW1ldGhvZDEgPSBpbGtfd21fbWV0aG9kMShjcnRjX3N0YXRlLT5waXhlbF9yYXRlLCBjcHAsIG1l
bV92YWx1ZSk7CiAJbWV0aG9kMiA9IGlsa193bV9tZXRob2QyKGNydGNfc3RhdGUtPnBpeGVsX3Jh
dGUsCkBAIC0yNTMzLDcgKzI1MzMsNyBAQCBzdGF0aWMgdTMyIGlsa19jb21wdXRlX2N1cl93bShj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAlpZiAoIWludGVsX3dt
X3BsYW5lX3Zpc2libGUoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpKQogCQlyZXR1cm4gMDsKIAot
CWNwcCA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiLT5mb3JtYXQtPmNwcFswXTsKKwljcHAgPSBwbGFu
ZV9zdGF0ZS0+aHcuZmItPmZvcm1hdC0+Y3BwWzBdOwogCiAJcmV0dXJuIGlsa193bV9tZXRob2Qy
KGNydGNfc3RhdGUtPnBpeGVsX3JhdGUsCiAJCQkgICAgICBjcnRjX3N0YXRlLT5ody5hZGp1c3Rl
ZF9tb2RlLmNydGNfaHRvdGFsLApAQCAtMjU1MSw3ICsyNTUxLDcgQEAgc3RhdGljIHUzMiBpbGtf
Y29tcHV0ZV9mYmNfd20oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUs
CiAJaWYgKCFpbnRlbF93bV9wbGFuZV92aXNpYmxlKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKSkK
IAkJcmV0dXJuIDA7CiAKLQljcHAgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYi0+Zm9ybWF0LT5jcHBb
MF07CisJY3BwID0gcGxhbmVfc3RhdGUtPmh3LmZiLT5mb3JtYXQtPmNwcFswXTsKIAogCXJldHVy
biBpbGtfd21fZmJjKHByaV92YWwsIGRybV9yZWN0X3dpZHRoKCZwbGFuZV9zdGF0ZS0+YmFzZS5k
c3QpLCBjcHApOwogfQpAQCAtNDA5MSw3ICs0MDkxLDcgQEAgc2tsX3BsYW5lX3JlbGF0aXZlX2Rh
dGFfcmF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCSAg
ICAgaW50IGNvbG9yX3BsYW5lKQogewogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19p
bnRlbF9wbGFuZShwbGFuZV9zdGF0ZS0+YmFzZS5wbGFuZSk7Ci0JY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3QgZHJt
X2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAl1MzIgZGF0YV9yYXRlOwog
CXUzMiB3aWR0aCA9IDAsIGhlaWdodCA9IDA7CiAJdWludF9maXhlZF8xNl8xNl90IGRvd25fc2Nh
bGVfYW1vdW50OwpAQCAtNDYxMiw3ICs0NjEyLDcgQEAgc2tsX2NvbXB1dGVfcGxhbmVfd21fcGFy
YW1zKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgIGNv
bnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVfc3RhdGUsCiAJCQkgICAgc3RydWN0
IHNrbF93bV9wYXJhbXMgKndwLCBpbnQgY29sb3JfcGxhbmUpCiB7Ci0JY29uc3Qgc3RydWN0IGRy
bV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwljb25zdCBzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5ody5mYjsKIAlpbnQgd2lkdGg7CiAK
IAkvKgpAQCAtNDYyNCw3ICs0NjI0LDcgQEAgc2tsX2NvbXB1dGVfcGxhbmVfd21fcGFyYW1zKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCiAJcmV0dXJuIHNrbF9j
b21wdXRlX3dtX3BhcmFtcyhjcnRjX3N0YXRlLCB3aWR0aCwKIAkJCQkgICAgIGZiLT5mb3JtYXQs
IGZiLT5tb2RpZmllciwKLQkJCQkgICAgIHBsYW5lX3N0YXRlLT5iYXNlLnJvdGF0aW9uLAorCQkJ
CSAgICAgcGxhbmVfc3RhdGUtPmh3LnJvdGF0aW9uLAogCQkJCSAgICAgc2tsX2FkanVzdGVkX3Bs
YW5lX3BpeGVsX3JhdGUoY3J0Y19zdGF0ZSwgcGxhbmVfc3RhdGUpLAogCQkJCSAgICAgd3AsIGNv
bG9yX3BsYW5lKTsKIH0KQEAgLTQ5MDMsNyArNDkwMyw3IEBAIHN0YXRpYyBpbnQgc2tsX2J1aWxk
X3BsYW5lX3dtKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJICAgICAg
Y29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3Qg
aW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxh
bmUpOwotCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVfc3RhdGUtPmJh
c2UuZmI7CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+
aHcuZmI7CiAJZW51bSBwbGFuZV9pZCBwbGFuZV9pZCA9IHBsYW5lLT5pZDsKIAlpbnQgcmV0Owog
CkBAIC00OTM2LDcgKzQ5MzYsNyBAQCBzdGF0aWMgaW50IGljbF9idWlsZF9wbGFuZV93bShzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJcmV0dXJuIDA7CiAKIAlpZiAocGxh
bmVfc3RhdGUtPnBsYW5hcl9saW5rZWRfcGxhbmUpIHsKLQkJY29uc3Qgc3RydWN0IGRybV9mcmFt
ZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+YmFzZS5mYjsKKwkJY29uc3Qgc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJCWVudW0gcGxhbmVfaWQgeV9w
bGFuZV9pZCA9IHBsYW5lX3N0YXRlLT5wbGFuYXJfbGlua2VkX3BsYW5lLT5pZDsKIAogCQlXQVJO
X09OKCFpbnRlbF93bV9wbGFuZV92aXNpYmxlKGNydGNfc3RhdGUsIHBsYW5lX3N0YXRlKSk7Ci0t
IAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
CkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpo
dHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

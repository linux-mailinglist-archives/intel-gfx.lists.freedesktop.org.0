Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 4434BE0B16
	for <lists+intel-gfx@lfdr.de>; Tue, 22 Oct 2019 19:56:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7123E6E8BD;
	Tue, 22 Oct 2019 17:56:21 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga09.intel.com (mga09.intel.com [134.134.136.24])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A7E4C6E8BA
 for <intel-gfx@lists.freedesktop.org>; Tue, 22 Oct 2019 17:56:12 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by orsmga102.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 22 Oct 2019 10:56:11 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.68,217,1569308400"; d="scan'208";a="191550959"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by orsmga008.jf.intel.com with SMTP; 22 Oct 2019 10:56:10 -0700
Received: by stinkbox (sSMTP sendmail emulation);
 Tue, 22 Oct 2019 20:56:09 +0300
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 22 Oct 2019 20:55:51 +0300
Message-Id: <20191022175554.18012-6-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20191022175554.18012-1-ville.syrjala@linux.intel.com>
References: <20191022175554.18012-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 5/8] drm/i915: Use drm_rect to store the pfit
 window pos/size
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KCk1h
a2UgdGhpbmdzIGEgYml0IG1vcmUgYWJzdHJhY3QgYnkgcmVwbGFjaW5nIHRoZSBwY2hfcGZpdC5w
b3Mvc2l6ZQpyYXcgcmVnaXN0ZXIgdmFsdWVzIHdpdGggYSBkcm1fcmVjdC4gTWFrZXMgaXQgc2xp
Z2hseSBtb3JlIGNvbnZlbmllbnQKdG8gZWcuIGNvbXB1dGUgdGhlIHNjYWxpbmcgZmFjdG9ycy4K
CnYyOiBVc2UgZHJtX3JlY3RfaW5pdCgpCgpTaWduZWQtb2ZmLWJ5OiBWaWxsZSBTeXJqw6Rsw6Qg
PHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jICB8IDc5ICsrKysrKysrKysrKy0tLS0tLS0KIC4uLi9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaCAgICB8ICAzICstCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3BhbmVsLmMgICAgfCAxMyArKy0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX3BtLmMgICAgICAgICAgICAgICB8ICA1ICstCiA0IGZpbGVzIGNo
YW5nZWQsIDYwIGluc2VydGlvbnMoKyksIDQwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggNmFlZWMwMWUyZDI0Li4zOGRm
MTU0MTIzZDIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxh
eS5jCkBAIC01NTIxLDEwICs1NTIxLDggQEAgc3RhdGljIGludCBza2xfdXBkYXRlX3NjYWxlcl9j
cnRjKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCWludCB3aWR0aCwgaGVp
Z2h0OwogCiAJaWYgKGNydGNfc3RhdGUtPnBjaF9wZml0LmVuYWJsZWQpIHsKLQkJdTMyIHBmaXRf
c2l6ZSA9IGNydGNfc3RhdGUtPnBjaF9wZml0LnNpemU7Ci0KLQkJd2lkdGggPSBwZml0X3NpemUg
Pj4gMTY7Ci0JCWhlaWdodCA9IHBmaXRfc2l6ZSAmIDB4ZmZmZjsKKwkJd2lkdGggPSBkcm1fcmVj
dF93aWR0aCgmY3J0Y19zdGF0ZS0+cGNoX3BmaXQuZHN0KTsKKwkJaGVpZ2h0ID0gZHJtX3JlY3Rf
aGVpZ2h0KCZjcnRjX3N0YXRlLT5wY2hfcGZpdC5kc3QpOwogCX0gZWxzZSB7CiAJCXdpZHRoID0g
YWRqdXN0ZWRfbW9kZS0+Y3J0Y19oZGlzcGxheTsKIAkJaGVpZ2h0ID0gYWRqdXN0ZWRfbW9kZS0+
Y3J0Y192ZGlzcGxheTsKQEAgLTU2MzMsMTEgKzU2MzEsMjAgQEAgc3RhdGljIHZvaWQgc2t5bGFr
ZV9wZml0X2VuYWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkK
IHsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+
YmFzZS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGNydGMtPmJhc2UuZGV2KTsKLQllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc2NhbGVyX3N0YXRlICpzY2FsZXJfc3RhdGUgPQogCQkmY3J0Y19z
dGF0ZS0+c2NhbGVyX3N0YXRlOworCXN0cnVjdCBkcm1fcmVjdCBzcmMgPSB7CisJCS54MiA9IGNy
dGNfc3RhdGUtPnBpcGVfc3JjX3cgPDwgMTYsCisJCS55MiA9IGNydGNfc3RhdGUtPnBpcGVfc3Jj
X2ggPDwgMTYsCisJfTsKKwljb25zdCBzdHJ1Y3QgZHJtX3JlY3QgKmRzdCA9ICZjcnRjX3N0YXRl
LT5wY2hfcGZpdC5kc3Q7CiAJdTE2IHV2X3JnYl9ocGhhc2UsIHV2X3JnYl92cGhhc2U7Ci0JaW50
IHBmaXRfdywgcGZpdF9oLCBoc2NhbGUsIHZzY2FsZTsKKwllbnVtIHBpcGUgcGlwZSA9IGNydGMt
PnBpcGU7CisJaW50IHdpZHRoID0gZHJtX3JlY3Rfd2lkdGgoZHN0KTsKKwlpbnQgaGVpZ2h0ID0g
ZHJtX3JlY3RfaGVpZ2h0KGRzdCk7CisJaW50IHggPSBkc3QtPngxOworCWludCB5ID0gZHN0LT55
MTsKKwlpbnQgaHNjYWxlLCB2c2NhbGU7CiAJaW50IGlkOwogCiAJaWYgKCFjcnRjX3N0YXRlLT5w
Y2hfcGZpdC5lbmFibGVkKQpAQCAtNTY0NiwxMSArNTY1Myw4IEBAIHN0YXRpYyB2b2lkIHNreWxh
a2VfcGZpdF9lbmFibGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
CiAJaWYgKFdBUk5fT04oY3J0Y19zdGF0ZS0+c2NhbGVyX3N0YXRlLnNjYWxlcl9pZCA8IDApKQog
CQlyZXR1cm47CiAKLQlwZml0X3cgPSAoY3J0Y19zdGF0ZS0+cGNoX3BmaXQuc2l6ZSA+PiAxNikg
JiAweEZGRkY7Ci0JcGZpdF9oID0gY3J0Y19zdGF0ZS0+cGNoX3BmaXQuc2l6ZSAmIDB4RkZGRjsK
LQotCWhzY2FsZSA9IChjcnRjX3N0YXRlLT5waXBlX3NyY193IDw8IDE2KSAvIHBmaXRfdzsKLQl2
c2NhbGUgPSAoY3J0Y19zdGF0ZS0+cGlwZV9zcmNfaCA8PCAxNikgLyBwZml0X2g7CisJaHNjYWxl
ID0gZHJtX3JlY3RfY2FsY19oc2NhbGUoJnNyYywgZHN0LCAwLCBJTlRfTUFYKTsKKwl2c2NhbGUg
PSBkcm1fcmVjdF9jYWxjX3ZzY2FsZSgmc3JjLCBkc3QsIDAsIElOVF9NQVgpOwogCiAJdXZfcmdi
X2hwaGFzZSA9IHNrbF9zY2FsZXJfY2FsY19waGFzZSgxLCBoc2NhbGUsIGZhbHNlKTsKIAl1dl9y
Z2JfdnBoYXNlID0gc2tsX3NjYWxlcl9jYWxjX3BoYXNlKDEsIHZzY2FsZSwgZmFsc2UpOwpAQCAt
NTY2MiwxNSArNTY2NiwyMCBAQCBzdGF0aWMgdm9pZCBza3lsYWtlX3BmaXRfZW5hYmxlKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCQkgICBQU19ZX1BIQVNFKDAp
IHwgUFNfVVZfUkdCX1BIQVNFKHV2X3JnYl92cGhhc2UpKTsKIAlJOTE1X1dSSVRFKFNLTF9QU19I
UEhBU0UocGlwZSwgaWQpLAogCQkgICBQU19ZX1BIQVNFKDApIHwgUFNfVVZfUkdCX1BIQVNFKHV2
X3JnYl9ocGhhc2UpKTsKLQlJOTE1X1dSSVRFKFNLTF9QU19XSU5fUE9TKHBpcGUsIGlkKSwgY3J0
Y19zdGF0ZS0+cGNoX3BmaXQucG9zKTsKLQlJOTE1X1dSSVRFKFNLTF9QU19XSU5fU1oocGlwZSwg
aWQpLCBjcnRjX3N0YXRlLT5wY2hfcGZpdC5zaXplKTsKKwlJOTE1X1dSSVRFKFNLTF9QU19XSU5f
UE9TKHBpcGUsIGlkKSwgeCA8PCAxNiB8IHkpOworCUk5MTVfV1JJVEUoU0tMX1BTX1dJTl9TWihw
aXBlLCBpZCksIHdpZHRoIDw8IDE2IHwgaGVpZ2h0KTsKIH0KIAogc3RhdGljIHZvaWQgaXJvbmxh
a2VfcGZpdF9lbmFibGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
CiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUt
PmJhc2UuY3J0Yyk7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkx
NShjcnRjLT5iYXNlLmRldik7CisJY29uc3Qgc3RydWN0IGRybV9yZWN0ICpkc3QgPSAmY3J0Y19z
dGF0ZS0+cGNoX3BmaXQuZHN0OwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKKwlpbnQg
d2lkdGggPSBkcm1fcmVjdF93aWR0aChkc3QpOworCWludCBoZWlnaHQgPSBkcm1fcmVjdF9oZWln
aHQoZHN0KTsKKwlpbnQgeCA9IGRzdC0+eDE7CisJaW50IHkgPSBkc3QtPnkxOwogCiAJaWYgKCFj
cnRjX3N0YXRlLT5wY2hfcGZpdC5lbmFibGVkKQogCQlyZXR1cm47CkBAIC01Njg0LDggKzU2OTMs
OCBAQCBzdGF0aWMgdm9pZCBpcm9ubGFrZV9wZml0X2VuYWJsZShjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkJCSAgIFBGX1BJUEVfU0VMX0lWQihwaXBlKSk7CiAJ
ZWxzZQogCQlJOTE1X1dSSVRFKFBGX0NUTChwaXBlKSwgUEZfRU5BQkxFIHwgUEZfRklMVEVSX01F
RF8zeDMpOwotCUk5MTVfV1JJVEUoUEZfV0lOX1BPUyhwaXBlKSwgY3J0Y19zdGF0ZS0+cGNoX3Bm
aXQucG9zKTsKLQlJOTE1X1dSSVRFKFBGX1dJTl9TWihwaXBlKSwgY3J0Y19zdGF0ZS0+cGNoX3Bm
aXQuc2l6ZSk7CisJSTkxNV9XUklURShQRl9XSU5fUE9TKHBpcGUpLCB4IDw8IDE2IHwgeSk7CisJ
STkxNV9XUklURShQRl9XSU5fU1oocGlwZSksIHdpZHRoIDw8IDE2IHwgaGVpZ2h0KTsKIH0KIAog
dm9pZCBoc3dfZW5hYmxlX2lwcyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZSkKQEAgLTc0MDAsOCArNzQwOSw3IEBAIHN0YXRpYyBib29sIGludGVsX2NydGNfc3VwcG9y
dHNfZG91YmxlX3dpZGUoY29uc3Qgc3RydWN0IGludGVsX2NydGMgKmNydGMpCiBzdGF0aWMgdTMy
IGlsa19waXBlX3BpeGVsX3JhdGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCiB7CiAJdTMyIHBpeGVsX3JhdGUgPSBjcnRjX3N0YXRlLT5iYXNlLmFkanVzdGVkX21v
ZGUuY3J0Y19jbG9jazsKLQl1MzIgcGZpdF9zaXplID0gY3J0Y19zdGF0ZS0+cGNoX3BmaXQuc2l6
ZTsKLQl1NjQgcGlwZV93LCBwaXBlX2gsIHBmaXRfdywgcGZpdF9oOworCXVuc2lnbmVkIGludCBw
aXBlX3csIHBpcGVfaCwgcGZpdF93LCBwZml0X2g7CiAKIAkvKgogCSAqIFdlIG9ubHkgdXNlIElG
LUlEIGludGVybGFjaW5nLiBJZiB3ZSBldmVyIHVzZQpAQCAtNzQxNCw4ICs3NDIyLDkgQEAgc3Rh
dGljIHUzMiBpbGtfcGlwZV9waXhlbF9yYXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlKQogCXBpcGVfdyA9IGNydGNfc3RhdGUtPnBpcGVfc3JjX3c7CiAJcGlwZV9o
ID0gY3J0Y19zdGF0ZS0+cGlwZV9zcmNfaDsKIAotCXBmaXRfdyA9IChwZml0X3NpemUgPj4gMTYp
ICYgMHhGRkZGOwotCXBmaXRfaCA9IHBmaXRfc2l6ZSAmIDB4RkZGRjsKKwlwZml0X3cgPSBkcm1f
cmVjdF93aWR0aCgmY3J0Y19zdGF0ZS0+cGNoX3BmaXQuZHN0KTsKKwlwZml0X2ggPSBkcm1fcmVj
dF9oZWlnaHQoJmNydGNfc3RhdGUtPnBjaF9wZml0LmRzdCk7CisKIAlpZiAocGlwZV93IDwgcGZp
dF93KQogCQlwaXBlX3cgPSBwZml0X3c7CiAJaWYgKHBpcGVfaCA8IHBmaXRfaCkKQEAgLTk4MDks
NiArOTgxOCwxNCBAQCBzdGF0aWMgdm9pZCBpcm9ubGFrZV9nZXRfZmRpX21fbl9jb25maWcoc3Ry
dWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkJICAgICAmcGlwZV9jb25maWctPmZkaV9tX24sIE5V
TEwpOwogfQogCitzdGF0aWMgdm9pZCBpbGtfZ2V0X3BmaXRfcG9zX3NpemUoc3RydWN0IGludGVs
X2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkJICB1MzIgcG9zLCB1MzIgc2l6ZSkKK3sKKwlk
cm1fcmVjdF9pbml0KCZjcnRjX3N0YXRlLT5wY2hfcGZpdC5kc3QsCisJCSAgICAgIHBvcyA+PiAx
NiwgcG9zICYgMHhmZmZmLAorCQkgICAgICBzaXplID4+IDE2LCBzaXplICYgMHhmZmZmKTsKK30K
Kwogc3RhdGljIHZvaWQgc2t5bGFrZV9nZXRfcGZpdF9jb25maWcoc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRl
bF9jcnRjKGNydGNfc3RhdGUtPmJhc2UuY3J0Yyk7CkBAIC05ODI3LDggKzk4NDQsMTEgQEAgc3Rh
dGljIHZvaWQgc2t5bGFrZV9nZXRfcGZpdF9jb25maWcoc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUpCiAKIAkJaWQgPSBpOwogCQljcnRjX3N0YXRlLT5wY2hfcGZpdC5lbmFibGVk
ID0gdHJ1ZTsKLQkJY3J0Y19zdGF0ZS0+cGNoX3BmaXQucG9zID0gSTkxNV9SRUFEKFNLTF9QU19X
SU5fUE9TKGNydGMtPnBpcGUsIGkpKTsKLQkJY3J0Y19zdGF0ZS0+cGNoX3BmaXQuc2l6ZSA9IEk5
MTVfUkVBRChTS0xfUFNfV0lOX1NaKGNydGMtPnBpcGUsIGkpKTsKKworCQlpbGtfZ2V0X3BmaXRf
cG9zX3NpemUoY3J0Y19zdGF0ZSwKKwkJCQkgICAgICBJOTE1X1JFQUQoU0tMX1BTX1dJTl9QT1Mo
Y3J0Yy0+cGlwZSwgaSkpLAorCQkJCSAgICAgIEk5MTVfUkVBRChTS0xfUFNfV0lOX1NaKGNydGMt
PnBpcGUsIGkpKSk7CisKIAkJc2NhbGVyX3N0YXRlLT5zY2FsZXJzW2ldLmluX3VzZSA9IHRydWU7
CiAJCWJyZWFrOwogCX0KQEAgLTk5ODYsOCArMTAwMDYsMTAgQEAgc3RhdGljIHZvaWQgaXJvbmxh
a2VfZ2V0X3BmaXRfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQog
CQkodG1wICYgUEZfUElQRV9TRUxfTUFTS19JVkIpICE9IFBGX1BJUEVfU0VMX0lWQihjcnRjLT5w
aXBlKSk7CiAKIAljcnRjX3N0YXRlLT5wY2hfcGZpdC5lbmFibGVkID0gdHJ1ZTsKLQljcnRjX3N0
YXRlLT5wY2hfcGZpdC5wb3MgPSBJOTE1X1JFQUQoUEZfV0lOX1BPUyhjcnRjLT5waXBlKSk7Ci0J
Y3J0Y19zdGF0ZS0+cGNoX3BmaXQuc2l6ZSA9IEk5MTVfUkVBRChQRl9XSU5fU1ooY3J0Yy0+cGlw
ZSkpOworCisJaWxrX2dldF9wZml0X3Bvc19zaXplKGNydGNfc3RhdGUsCisJCQkgICAgICBJOTE1
X1JFQUQoUEZfV0lOX1BPUyhjcnRjLT5waXBlKSksCisJCQkgICAgICBJOTE1X1JFQUQoUEZfV0lO
X1NaKGNydGMtPnBpcGUpKSk7CiB9CiAKIHN0YXRpYyBib29sIGlyb25sYWtlX2dldF9waXBlX2Nv
bmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKQEAgLTEyMzgzLDkgKzEyNDA1LDggQEAgc3Rh
dGljIHZvaWQgaW50ZWxfZHVtcF9waXBlX2NvbmZpZyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqcGlwZV9jb25maWcsCiAJCQkgICAgICBwaXBlX2NvbmZpZy0+Z21jaF9wZml0LnBnbV9y
YXRpb3MsCiAJCQkgICAgICBwaXBlX2NvbmZpZy0+Z21jaF9wZml0Lmx2ZHNfYm9yZGVyX2JpdHMp
OwogCWVsc2UKLQkJRFJNX0RFQlVHX0tNUygicGNoIHBmaXQ6IHBvczogMHglMDh4LCBzaXplOiAw
eCUwOHgsICVzLCBmb3JjZSB0aHJ1OiAlc1xuIiwKLQkJCSAgICAgIHBpcGVfY29uZmlnLT5wY2hf
cGZpdC5wb3MsCi0JCQkgICAgICBwaXBlX2NvbmZpZy0+cGNoX3BmaXQuc2l6ZSwKKwkJRFJNX0RF
QlVHX0tNUygicGNoIHBmaXQ6ICIgRFJNX1JFQ1RfRk1UICIsICVzLCBmb3JjZSB0aHJ1OiAlc1xu
IiwKKwkJCSAgICAgIERSTV9SRUNUX0FSRygmcGlwZV9jb25maWctPnBjaF9wZml0LmRzdCksCiAJ
CQkgICAgICBlbmFibGVkZGlzYWJsZWQocGlwZV9jb25maWctPnBjaF9wZml0LmVuYWJsZWQpLAog
CQkJICAgICAgeWVzbm8ocGlwZV9jb25maWctPnBjaF9wZml0LmZvcmNlX3RocnUpKTsKIApAQCAt
MTMwNTgsOCArMTMwNzksMTAgQEAgaW50ZWxfcGlwZV9jb25maWdfY29tcGFyZShjb25zdCBzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3VycmVudF9jb25maWcsCiAKIAkJUElQRV9DT05GX0NIRUNL
X0JPT0wocGNoX3BmaXQuZW5hYmxlZCk7CiAJCWlmIChjdXJyZW50X2NvbmZpZy0+cGNoX3BmaXQu
ZW5hYmxlZCkgewotCQkJUElQRV9DT05GX0NIRUNLX1gocGNoX3BmaXQucG9zKTsKLQkJCVBJUEVf
Q09ORl9DSEVDS19YKHBjaF9wZml0LnNpemUpOworCQkJUElQRV9DT05GX0NIRUNLX0kocGNoX3Bm
aXQuZHN0LngxKTsKKwkJCVBJUEVfQ09ORl9DSEVDS19JKHBjaF9wZml0LmRzdC55MSk7CisJCQlQ
SVBFX0NPTkZfQ0hFQ0tfSShwY2hfcGZpdC5kc3QueDIpOworCQkJUElQRV9DT05GX0NIRUNLX0ko
cGNoX3BmaXQuZHN0LnkyKTsKIAkJfQogCiAJCVBJUEVfQ09ORl9DSEVDS19JKHNjYWxlcl9zdGF0
ZS5zY2FsZXJfaWQpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kaXNwbGF5X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2Rpc3BsYXlfdHlwZXMuaAppbmRleCA4MzU4MTUyZTQwM2UuLmFiNGVjNjIxNWMyMiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgK
QEAgLTkwMiw4ICs5MDIsNyBAQCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSB7CiAKIAkvKiBQYW5l
bCBmaXR0ZXIgcGxhY2VtZW50IGFuZCBzaXplIGZvciBJcm9ubGFrZSsgKi8KIAlzdHJ1Y3Qgewot
CQl1MzIgcG9zOwotCQl1MzIgc2l6ZTsKKwkJc3RydWN0IGRybV9yZWN0IGRzdDsKIAkJYm9vbCBl
bmFibGVkOwogCQlib29sIGZvcmNlX3RocnU7CiAJfSBwY2hfcGZpdDsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcGFuZWwuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfcGFuZWwuYwppbmRleCA0NjAxNDE2YzYwM2UuLjY4MjU3YjIx
YWJmNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wYW5l
bC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcGFuZWwuYwpAQCAt
MTc5LDEzICsxNzksMTMgQEAgaW50ZWxfcGNoX3BhbmVsX2ZpdHRpbmcoc3RydWN0IGludGVsX2Ny
dGMgKmludGVsX2NydGMsCiAJCQlpbnQgZml0dGluZ19tb2RlKQogewogCWNvbnN0IHN0cnVjdCBk
cm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlID0gJnBpcGVfY29uZmlnLT5iYXNlLmFkanVz
dGVkX21vZGU7Ci0JaW50IHggPSAwLCB5ID0gMCwgd2lkdGggPSAwLCBoZWlnaHQgPSAwOworCWlu
dCB4LCB5LCB3aWR0aCwgaGVpZ2h0OwogCiAJLyogTmF0aXZlIG1vZGVzIGRvbid0IG5lZWQgZml0
dGluZyAqLwogCWlmIChhZGp1c3RlZF9tb2RlLT5jcnRjX2hkaXNwbGF5ID09IHBpcGVfY29uZmln
LT5waXBlX3NyY193ICYmCiAJICAgIGFkanVzdGVkX21vZGUtPmNydGNfdmRpc3BsYXkgPT0gcGlw
ZV9jb25maWctPnBpcGVfc3JjX2ggJiYKIAkgICAgcGlwZV9jb25maWctPm91dHB1dF9mb3JtYXQg
IT0gSU5URUxfT1VUUFVUX0ZPUk1BVF9ZQ0JDUjQyMCkKLQkJZ290byBkb25lOworCQlyZXR1cm47
CiAKIAlzd2l0Y2ggKGZpdHRpbmdfbW9kZSkgewogCWNhc2UgRFJNX01PREVfU0NBTEVfQ0VOVEVS
OgpAQCAtMjMxLDE0ICsyMzEsMTMgQEAgaW50ZWxfcGNoX3BhbmVsX2ZpdHRpbmcoc3RydWN0IGlu
dGVsX2NydGMgKmludGVsX2NydGMsCiAJCWJyZWFrOwogCiAJZGVmYXVsdDoKLQkJV0FSTigxLCAi
YmFkIHBhbmVsIGZpdCBtb2RlOiAlZFxuIiwgZml0dGluZ19tb2RlKTsKKwkJTUlTU0lOR19DQVNF
KGZpdHRpbmdfbW9kZSk7CiAJCXJldHVybjsKIAl9CiAKLWRvbmU6Ci0JcGlwZV9jb25maWctPnBj
aF9wZml0LnBvcyA9ICh4IDw8IDE2KSB8IHk7Ci0JcGlwZV9jb25maWctPnBjaF9wZml0LnNpemUg
PSAod2lkdGggPDwgMTYpIHwgaGVpZ2h0OwotCXBpcGVfY29uZmlnLT5wY2hfcGZpdC5lbmFibGVk
ID0gcGlwZV9jb25maWctPnBjaF9wZml0LnNpemUgIT0gMDsKKwlkcm1fcmVjdF9pbml0KCZwaXBl
X2NvbmZpZy0+cGNoX3BmaXQuZHN0LAorCQkgICAgICB4LCB5LCB3aWR0aCwgaGVpZ2h0KTsKKwlw
aXBlX2NvbmZpZy0+cGNoX3BmaXQuZW5hYmxlZCA9IHRydWU7CiB9CiAKIHN0YXRpYyB2b2lkCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaW50ZWxfcG0uYwppbmRleCA4MGVhNTA3NGNhYmQuLmU3Y2U4MGFjZGQ0NSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF9wbS5jCkBAIC00MTAyLDcgKzQxMDIsNiBAQCBza2xfcGlwZV9kb3du
c2NhbGVfYW1vdW50KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQog
ewogCXVpbnRfZml4ZWRfMTZfMTZfdCBwaXBlX2Rvd25zY2FsZSA9IHUzMl90b19maXhlZDE2KDEp
OwogCXUzMiBzcmNfdywgc3JjX2gsIGRzdF93LCBkc3RfaDsKLQl1MzIgcGZpdF9zaXplID0gY3J0
Y19zdGF0ZS0+cGNoX3BmaXQuc2l6ZTsKIAl1aW50X2ZpeGVkXzE2XzE2X3QgZnBfd19yYXRpbywg
ZnBfaF9yYXRpbzsKIAl1aW50X2ZpeGVkXzE2XzE2X3QgZG93bnNjYWxlX2gsIGRvd25zY2FsZV93
OwogCkBAIC00MTEyLDggKzQxMTEsOCBAQCBza2xfcGlwZV9kb3duc2NhbGVfYW1vdW50KGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCiAJc3JjX3cgPSBjcnRjX3N0
YXRlLT5waXBlX3NyY193OwogCXNyY19oID0gY3J0Y19zdGF0ZS0+cGlwZV9zcmNfaDsKLQlkc3Rf
dyA9IHBmaXRfc2l6ZSA+PiAxNjsKLQlkc3RfaCA9IHBmaXRfc2l6ZSAmIDB4ZmZmZjsKKwlkc3Rf
dyA9IGRybV9yZWN0X3dpZHRoKCZjcnRjX3N0YXRlLT5wY2hfcGZpdC5kc3QpOworCWRzdF9oID0g
ZHJtX3JlY3RfaGVpZ2h0KCZjcnRjX3N0YXRlLT5wY2hfcGZpdC5kc3QpOwogCiAJaWYgKCFkc3Rf
dyB8fCAhZHN0X2gpCiAJCXJldHVybiBwaXBlX2Rvd25zY2FsZTsKLS0gCjIuMjEuMAoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxp
bmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D828659868
	for <lists+intel-gfx@lfdr.de>; Fri, 28 Jun 2019 12:30:00 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 410956E8CE;
	Fri, 28 Jun 2019 10:29:59 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8866E6E8CE
 for <intel-gfx@lists.freedesktop.org>; Fri, 28 Jun 2019 10:29:57 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17055876-1500050 
 for multiple; Fri, 28 Jun 2019 11:29:46 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 28 Jun 2019 11:29:44 +0100
Message-Id: <20190628102944.2855-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] buddy
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: matthew.auld@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QSBwdXp6bGUgZm9yIHlvdS4uLgoKLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2J1ZGR5
LmMgICAgICAgICAgIHwgIDE3ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV9idWRkeS5jIHwgMjMwICsrKysrKysrKysrKysrKysrKystCiAyIGZpbGVzIGNoYW5nZWQsIDIz
NCBpbnNlcnRpb25zKCspLCAxMyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2J1ZGR5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2J1ZGR5
LmMKaW5kZXggYzBhYzY4ZDcxZDk0Li5lNTY2NzU0MDI4MmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfYnVkZHkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2J1ZGR5LmMKQEAgLTE2LDcgKzE2LDcgQEAgc3RhdGljIHZvaWQgbWFya19hbGxvY2F0ZWQoc3Ry
dWN0IGk5MTVfYnVkZHlfYmxvY2sgKmJsb2NrKQogCWJsb2NrLT5oZWFkZXIgJj0gfkk5MTVfQlVE
RFlfSEVBREVSX1NUQVRFOwogCWJsb2NrLT5oZWFkZXIgfD0gSTkxNV9CVUREWV9BTExPQ0FURUQ7
CiAKLQlsaXN0X2RlbF9pbml0KCZibG9jay0+bGluayk7CisJbGlzdF9kZWwoJmJsb2NrLT5saW5r
KTsKIH0KIAogc3RhdGljIHZvaWQgbWFya19mcmVlKHN0cnVjdCBpOTE1X2J1ZGR5X21tICptbSwK
QEAgLTM0LDcgKzM0LDcgQEAgc3RhdGljIHZvaWQgbWFya19zcGxpdChzdHJ1Y3QgaTkxNV9idWRk
eV9ibG9jayAqYmxvY2spCiAJYmxvY2stPmhlYWRlciAmPSB+STkxNV9CVUREWV9IRUFERVJfU1RB
VEU7CiAJYmxvY2stPmhlYWRlciB8PSBJOTE1X0JVRERZX1NQTElUOwogCi0JbGlzdF9kZWxfaW5p
dCgmYmxvY2stPmxpbmspOworCWxpc3RfZGVsKCZibG9jay0+bGluayk7CiB9CiAKIGludCBpOTE1
X2J1ZGR5X2luaXQoc3RydWN0IGk5MTVfYnVkZHlfbW0gKm1tLCB1NjQgc2l6ZSwgdTY0IG1pbl9z
aXplKQpAQCAtMTcwLDkgKzE3MCw2IEBAIHN0YXRpYyBpbnQgc3BsaXRfYmxvY2soc3RydWN0IGk5
MTVfYnVkZHlfbW0gKm1tLAogCiAJYmxvY2stPmxlZnQtPnBhcmVudCA9IGJsb2NrOwogCi0JSU5J
VF9MSVNUX0hFQUQoJmJsb2NrLT5sZWZ0LT5saW5rKTsKLQlJTklUX0xJU1RfSEVBRCgmYmxvY2st
PmxlZnQtPnRtcF9saW5rKTsKLQogCWJsb2NrLT5yaWdodCA9IGttZW1fY2FjaGVfemFsbG9jKG1t
LT5ibG9ja3MsIEdGUF9LRVJORUwpOwogCWlmICghYmxvY2stPnJpZ2h0KSB7CiAJCWttZW1fY2Fj
aGVfZnJlZShtbS0+YmxvY2tzLCBibG9jay0+bGVmdCk7CkBAIC0xODQsOSArMTgxLDYgQEAgc3Rh
dGljIGludCBzcGxpdF9ibG9jayhzdHJ1Y3QgaTkxNV9idWRkeV9tbSAqbW0sCiAKIAlibG9jay0+
cmlnaHQtPnBhcmVudCA9IGJsb2NrOwogCi0JSU5JVF9MSVNUX0hFQUQoJmJsb2NrLT5yaWdodC0+
bGluayk7Ci0JSU5JVF9MSVNUX0hFQUQoJmJsb2NrLT5yaWdodC0+dG1wX2xpbmspOwotCiAJbWFy
a19mcmVlKG1tLCBibG9jay0+bGVmdCk7CiAJbWFya19mcmVlKG1tLCBibG9jay0+cmlnaHQpOwog
CkBAIC0yMTMsOSArMjA3LDkgQEAgZ2V0X2J1ZGR5KHN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpi
bG9jaykKIHN0YXRpYyB2b2lkIF9faTkxNV9idWRkeV9mcmVlKHN0cnVjdCBpOTE1X2J1ZGR5X21t
ICptbSwKIAkJCSAgICAgIHN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpibG9jaykKIHsKLQlsaXN0
X2RlbF9pbml0KCZibG9jay0+bGluayk7IC8qIFdlIGhhdmUgb3duZXJzaGlwIG5vdyAqLworCXN0
cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpwYXJlbnQ7CiAKLQl3aGlsZSAoYmxvY2stPnBhcmVudCkg
eworCXdoaWxlICgocGFyZW50ID0gYmxvY2stPnBhcmVudCkpIHsKIAkJc3RydWN0IGk5MTVfYnVk
ZHlfYmxvY2sgKmJ1ZGR5OwogCiAJCWJ1ZGR5ID0gZ2V0X2J1ZGR5KGJsb2NrKTsKQEAgLTIyOCw3
ICsyMjIsNyBAQCBzdGF0aWMgdm9pZCBfX2k5MTVfYnVkZHlfZnJlZShzdHJ1Y3QgaTkxNV9idWRk
eV9tbSAqbW0sCiAJCWttZW1fY2FjaGVfZnJlZShtbS0+YmxvY2tzLCBibG9jayk7CiAJCWttZW1f
Y2FjaGVfZnJlZShtbS0+YmxvY2tzLCBidWRkeSk7CiAKLQkJYmxvY2sgPSBibG9jay0+cGFyZW50
OworCQlibG9jayA9IHBhcmVudDsKIAl9CiAKIAltYXJrX2ZyZWUobW0sIGJsb2NrKTsKQEAgLTI0
OCw2ICsyNDIsNyBAQCB2b2lkIGk5MTVfYnVkZHlfZnJlZV9saXN0KHN0cnVjdCBpOTE1X2J1ZGR5
X21tICptbSwKIAogCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShibG9jaywgb24sIG9iamVjdHMs
IGxpbmspCiAJCWk5MTVfYnVkZHlfZnJlZShtbSwgYmxvY2spOworCUlOSVRfTElTVF9IRUFEKG9i
amVjdHMpOwogfQogCiAvKgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2k5MTVfYnVkZHkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2J1
ZGR5LmMKaW5kZXggMjE1OWFhOWY0ODY3Li45NDNhOWQwOGQyZjUgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2J1ZGR5LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfYnVkZHkuYwpAQCAtMjk1LDcgKzI5NSw3IEBAIHN0YXRp
YyB2b2lkIGlndF9tbV9jb25maWcodTY0ICpzaXplLCB1NjQgKm1pbl9zaXplKQogCSpzaXplID0g
czsKIH0KIAotc3RhdGljIGludCBpZ3RfYnVkZHlfYWxsb2Modm9pZCAqYXJnKQorc3RhdGljIGlu
dCBpZ3RfYnVkZHlfYWxsb2Nfc21va2Uodm9pZCAqYXJnKQogewogCXN0cnVjdCBpOTE1X2J1ZGR5
X21tIG1tOwogCWludCBtYXhfb3JkZXI7CkBAIC0zODUsNiArMzg1LDIyOSBAQCBzdGF0aWMgaW50
IGlndF9idWRkeV9hbGxvYyh2b2lkICphcmcpCiAJcmV0dXJuIGVycjsKIH0KIAorc3RhdGljIGlu
dCBpZ3RfYnVkZHlfYWxsb2NfcGVzc2ltaXN0aWModm9pZCAqYXJnKQoreworCWNvbnN0IHVuc2ln
bmVkIGludCBtYXhfb3JkZXIgPSAxNjsKKwlzdHJ1Y3QgaTkxNV9idWRkeV9ibG9jayAqYmxvY2ss
ICpibjsKKwlzdHJ1Y3QgaTkxNV9idWRkeV9tbSBtbTsKKwl1bnNpZ25lZCBpbnQgb3JkZXI7CisJ
TElTVF9IRUFEKGJsb2Nrcyk7CisJaW50IGVycjsKKworCS8qCisJICogQ3JlYXRlIGEgcG90LXNp
emVkIG1tLCB0aGVuIGFsbG9jYXRlIG9uZSBvZiBlYWNoIHBvc3NpYmxlCisJICogb3JkZXIgd2l0
aGluLiBUaGlzIHNob3VsZCBsZWF2ZSB0aGUgbW0gd2l0aCBleGFjdGx5IG9uZQorCSAqIHBhZ2Ug
bGVmdC4KKwkgKi8KKworCWVyciA9IGk5MTVfYnVkZHlfaW5pdCgmbW0sIFBBR0VfU0laRSA8PCBt
YXhfb3JkZXIsIFBBR0VfU0laRSk7CisJaWYgKGVycikgeworCQlwcl9lcnIoImJ1ZGR5X2luaXQg
ZmFpbGVkKCVkKVxuIiwgZXJyKTsKKwkJcmV0dXJuIGVycjsKKwl9CisJR0VNX0JVR19PTihtbS5t
YXhfb3JkZXIgIT0gbWF4X29yZGVyKTsKKworCWZvciAob3JkZXIgPSAwOyBvcmRlciA8IG1heF9v
cmRlcjsgb3JkZXIrKykgeworCQlibG9jayA9IGk5MTVfYnVkZHlfYWxsb2MoJm1tLCBvcmRlcik7
CisJCWlmIChJU19FUlIoYmxvY2spKSB7CisJCQlwcl9pbmZvKCJidWRkeV9hbGxvYyBoaXQgLUVO
T01FTSB3aXRoIG9yZGVyPSVkXG4iLAorCQkJCW9yZGVyKTsKKwkJCWVyciA9IFBUUl9FUlIoYmxv
Y2spOworCQkJZ290byBlcnI7CisJCX0KKworCQlsaXN0X2FkZF90YWlsKCZibG9jay0+bGluaywg
JmJsb2Nrcyk7CisJfQorCisJLyogQW5kIG5vdyB0aGUgbGFzdCByZW1haW5pbmcgYmxvY2sgYXZh
aWxhYmxlICovCisJYmxvY2sgPSBpOTE1X2J1ZGR5X2FsbG9jKCZtbSwgMCk7CisJaWYgKElTX0VS
UihibG9jaykpIHsKKwkJcHJfaW5mbygiYnVkZHlfYWxsb2MgaGl0IC1FTk9NRU0gb24gZmluYWwg
YWxsb2NcbiIpOworCQllcnIgPSBQVFJfRVJSKGJsb2NrKTsKKwkJZ290byBlcnI7CisJfQorCWxp
c3RfYWRkX3RhaWwoJmJsb2NrLT5saW5rLCAmYmxvY2tzKTsKKworCS8qIFNob3VsZCBiZSBjb21w
bGV0ZWx5IGZ1bGwhICovCisJZm9yIChvcmRlciA9IG1heF9vcmRlcjsgb3JkZXItLTsgKSB7CisJ
CWJsb2NrID0gaTkxNV9idWRkeV9hbGxvYygmbW0sIG9yZGVyKTsKKwkJaWYgKCFJU19FUlIoYmxv
Y2spKSB7CisJCQlwcl9pbmZvKCJidWRkeV9hbGxvYyB1bmV4cGVjdGVkbHkgc3VjY2VlZGVkIGF0
IG9yZGVyICVkLCBpdCBzaG91bGQgYmUgZnVsbCEiLAorCQkJCW9yZGVyKTsKKwkJCWxpc3RfYWRk
X3RhaWwoJmJsb2NrLT5saW5rLCAmYmxvY2tzKTsKKwkJCWVyciA9IC1FSU5WQUw7CisJCQlnb3Rv
IGVycjsKKwkJfQorCX0KKworCWJsb2NrID0gbGlzdF9sYXN0X2VudHJ5KCZibG9ja3MsIHR5cGVv
ZigqYmxvY2spLCBsaW5rKTsKKwlsaXN0X2RlbCgmYmxvY2stPmxpbmspOworCWk5MTVfYnVkZHlf
ZnJlZSgmbW0sIGJsb2NrKTsKKworCS8qIEFzIHdlIGZyZWUgaW4gaW5jcmVhc2luZyBzaXplLCB3
ZSBtYWtlIGF2YWlsYWJsZSBsYXJnZXIgYmxvY2tzICovCisJb3JkZXIgPSAxOworCWxpc3RfZm9y
X2VhY2hfZW50cnlfc2FmZShibG9jaywgYm4sICZibG9ja3MsIGxpbmspIHsKKwkJbGlzdF9kZWwo
JmJsb2NrLT5saW5rKTsKKwkJaTkxNV9idWRkeV9mcmVlKCZtbSwgYmxvY2spOworCisJCWJsb2Nr
ID0gaTkxNV9idWRkeV9hbGxvYygmbW0sIG9yZGVyKTsKKwkJaWYgKElTX0VSUihibG9jaykpIHsK
KwkJCXByX2luZm8oImJ1ZGR5X2FsbG9jIChyZWFsbG9jKSBoaXQgLUVOT01FTSB3aXRoIG9yZGVy
PSVkXG4iLAorCQkJCW9yZGVyKTsKKwkJCWVyciA9IFBUUl9FUlIoYmxvY2spOworCQkJZ290byBl
cnI7CisJCX0KKwkJaTkxNV9idWRkeV9mcmVlKCZtbSwgYmxvY2spOworCQlvcmRlcisrOworCX0K
KworCS8qIFRvIGNvbmZpcm0sIG5vdyB0aGUgd2hvbGUgbW0gc2hvdWxkIGJlIGF2YWlsYWJsZSAq
LworCWJsb2NrID0gaTkxNV9idWRkeV9hbGxvYygmbW0sIG1heF9vcmRlcik7CisJaWYgKElTX0VS
UihibG9jaykpIHsKKwkJcHJfaW5mbygiYnVkZHlfYWxsb2MgKHJlYWxsb2MpIGhpdCAtRU5PTUVN
IHdpdGggb3JkZXI9JWRcbiIsCisJCQltYXhfb3JkZXIpOworCQllcnIgPSBQVFJfRVJSKGJsb2Nr
KTsKKwkJZ290byBlcnI7CisJfQorCWk5MTVfYnVkZHlfZnJlZSgmbW0sIGJsb2NrKTsKKworZXJy
OgorCWk5MTVfYnVkZHlfZnJlZV9saXN0KCZtbSwgJmJsb2Nrcyk7CisJaTkxNV9idWRkeV9maW5p
KCZtbSk7CisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIGludCBpZ3RfYnVkZHlfYWxsb2Nfb3B0
aW1pc3RpYyh2b2lkICphcmcpCit7CisJY29uc3QgaW50IG1heF9vcmRlciA9IDE2OworCXN0cnVj
dCBpOTE1X2J1ZGR5X2Jsb2NrICpibG9jazsKKwlzdHJ1Y3QgaTkxNV9idWRkeV9tbSBtbTsKKwlM
SVNUX0hFQUQoYmxvY2tzKTsKKwlpbnQgb3JkZXI7CisJaW50IGVycjsKKworCS8qCisJICogQ3Jl
YXRlIGEgbW0gd2l0aCBvbmUgYmxvY2sgb2YgZWFjaCBvcmRlciBhdmFpbGFibGUsIGFuZAorCSAq
IHRyeSB0byBhbGxvY2F0ZSB0aGVtIGFsbC4KKwkgKi8KKworCWVyciA9IGk5MTVfYnVkZHlfaW5p
dCgmbW0sCisJCQkgICAgICBQQUdFX1NJWkUgKiAoKDEgPDwgKG1heF9vcmRlciArIDEpKSAtIDEp
LAorCQkJICAgICAgUEFHRV9TSVpFKTsKKwlpZiAoZXJyKSB7CisJCXByX2VycigiYnVkZHlfaW5p
dCBmYWlsZWQoJWQpXG4iLCBlcnIpOworCQlyZXR1cm4gZXJyOworCX0KKwlHRU1fQlVHX09OKG1t
Lm1heF9vcmRlciAhPSBtYXhfb3JkZXIpOworCisJZm9yIChvcmRlciA9IDA7IG9yZGVyIDw9IG1h
eF9vcmRlcjsgb3JkZXIrKykgeworCQlibG9jayA9IGk5MTVfYnVkZHlfYWxsb2MoJm1tLCBvcmRl
cik7CisJCWlmIChJU19FUlIoYmxvY2spKSB7CisJCQlwcl9pbmZvKCJidWRkeV9hbGxvYyBoaXQg
LUVOT01FTSB3aXRoIG9yZGVyPSVkXG4iLAorCQkJCW9yZGVyKTsKKwkJCWVyciA9IFBUUl9FUlIo
YmxvY2spOworCQkJZ290byBlcnI7CisJCX0KKworCQlsaXN0X2FkZF90YWlsKCZibG9jay0+bGlu
aywgJmJsb2Nrcyk7CisJfQorCisJLyogU2hvdWxkIGJlIGNvbXBsZXRlbHkgZnVsbCEgKi8KKwli
bG9jayA9IGk5MTVfYnVkZHlfYWxsb2MoJm1tLCAwKTsKKwlpZiAoIUlTX0VSUihibG9jaykpIHsK
KwkJcHJfaW5mbygiYnVkZHlfYWxsb2MgdW5leHBlY3RlZGx5IHN1Y2NlZWRlZCwgaXQgc2hvdWxk
IGJlIGZ1bGwhIik7CisJCWxpc3RfYWRkX3RhaWwoJmJsb2NrLT5saW5rLCAmYmxvY2tzKTsKKwkJ
ZXJyID0gLUVJTlZBTDsKKwkJZ290byBlcnI7CisJfQorCitlcnI6CisJaTkxNV9idWRkeV9mcmVl
X2xpc3QoJm1tLCAmYmxvY2tzKTsKKwlpOTE1X2J1ZGR5X2ZpbmkoJm1tKTsKKwlyZXR1cm4gZXJy
OworfQorCitzdGF0aWMgaW50IGlndF9idWRkeV9hbGxvY19wYXRob2xvZ2ljYWwodm9pZCAqYXJn
KQoreworCWNvbnN0IGludCBtYXhfb3JkZXIgPSAxNjsKKwlzdHJ1Y3QgaTkxNV9idWRkeV9ibG9j
ayAqYmxvY2s7CisJc3RydWN0IGk5MTVfYnVkZHlfbW0gbW07CisJTElTVF9IRUFEKGJsb2Nrcyk7
CisJTElTVF9IRUFEKGJ1ZGRpZXMpOworCWludCBvcmRlciwgdG9wOworCWludCBlcnI7CisKKwkv
KgorCSAqIENyZWF0ZSBhIHBvdC1zaXplZCBtbSwgdGhlbiBhbGxvY2F0ZSBvbmUgb2YgZWFjaCBw
b3NzaWJsZQorCSAqIG9yZGVyIHdpdGhpbi4gVGhpcyBzaG91bGQgbGVhdmUgdGhlIG1tIHdpdGgg
ZXhhY3RseSBvbmUKKwkgKiBwYWdlIGxlZnQuIEZyZWUgdGhlIGxhcmdlc3QgYmxvY2ssIHRoZW4g
d2hpdHRsZSBkb3duIGFnYWluLgorCSAqIEV2ZW50dWFsbHkgd2Ugd2lsbCBoYXZlIGEgZnVsbHkg
NTAlIGZyYWdtZW50ZWQgbW0uCisJICovCisKKwllcnIgPSBpOTE1X2J1ZGR5X2luaXQoJm1tLCBQ
QUdFX1NJWkUgPDwgbWF4X29yZGVyLCBQQUdFX1NJWkUpOworCWlmIChlcnIpIHsKKwkJcHJfZXJy
KCJidWRkeV9pbml0IGZhaWxlZCglZClcbiIsIGVycik7CisJCXJldHVybiBlcnI7CisJfQorCUdF
TV9CVUdfT04obW0ubWF4X29yZGVyICE9IG1heF9vcmRlcik7CisKKwlmb3IgKHRvcCA9IG1heF9v
cmRlcjsgdG9wOyB0b3AtLSkgeworCQkvKiBNYWtlIHJvb20gYnkgZnJlZWluZyB0aGUgbGFyZ2Vz
dCBhbGxvY2F0ZWQgYmxvY2sgKi8KKwkJYmxvY2sgPSBsaXN0X2ZpcnN0X2VudHJ5X29yX251bGwo
JmJsb2NrcywgdHlwZW9mKCpibG9jayksIGxpbmspOworCQlpZiAoYmxvY2spIHsKKwkJCWxpc3Rf
ZGVsKCZibG9jay0+bGluayk7CisJCQlpOTE1X2J1ZGR5X2ZyZWUoJm1tLCBibG9jayk7CisJCX0K
KworCQlmb3IgKG9yZGVyID0gdG9wOyBvcmRlci0tOyApIHsKKwkJCWJsb2NrID0gaTkxNV9idWRk
eV9hbGxvYygmbW0sIG9yZGVyKTsKKwkJCWlmIChJU19FUlIoYmxvY2spKSB7CisJCQkJcHJfaW5m
bygiYnVkZHlfYWxsb2MgaGl0IC1FTk9NRU0gd2l0aCBvcmRlcj0lZCwgdG9wPSVkXG4iLAorCQkJ
CQlvcmRlciwgdG9wKTsKKwkJCQllcnIgPSBQVFJfRVJSKGJsb2NrKTsKKwkJCQlnb3RvIGVycjsK
KwkJCX0KKwkJCWxpc3RfYWRkX3RhaWwoJmJsb2NrLT5saW5rLCAmYmxvY2tzKTsKKwkJfQorCisJ
CWJsb2NrID0gaTkxNV9idWRkeV9hbGxvYygmbW0sIHRvcCk7CisJCWlmICghSVNfRVJSKGJsb2Nr
KSkgeworCQkJcHJfaW5mbygiYnVkZHlfYWxsb2MgdW5leHBlY3RlZGx5IHN1Y2NlZWRlZCBhdCB0
b3Atb3JkZXIgJWQvJWQsIGl0IHNob3VsZCBiZSBmdWxsISIsCisJCQkJdG9wLCBtYXhfb3JkZXIp
OworCQkJbGlzdF9hZGRfdGFpbCgmYmxvY2stPmxpbmssICZibG9ja3MpOworCQkJZXJyID0gLUVJ
TlZBTDsKKwkJCWdvdG8gZXJyOworCQl9CisJfQorCisJLyogU3BsaXQgdGhlIGZpbmFsIGJsb2Nr
ICovCisJYmxvY2sgPSBpOTE1X2J1ZGR5X2FsbG9jKCZtbSwgMCk7CisJaWYgKElTX0VSUihibG9j
aykpIHsKKwkJcHJfaW5mbygiYnVkZHlfYWxsb2MgaGl0IC1FTk9NRU0gd2l0aCBvcmRlcj0lZFxu
IiwKKwkJCQkwKTsKKwkJZXJyID0gUFRSX0VSUihibG9jayk7CisJCWdvdG8gZXJyOworCX0KKwls
aXN0X2FkZF90YWlsKCZibG9jay0+bGluaywgJmJsb2Nrcyk7CisKKwkvKiBOb3RoaW5nIGxhcmdl
ciB0aGFuIGJsb2NrcyBvZiBtaW5fc2l6ZSBub3cgYXZhaWxhYmxlICovCisJZm9yIChvcmRlciA9
IDE7IG9yZGVyIDw9IG1heF9vcmRlcjsgb3JkZXIrKykgeworCQlibG9jayA9IGk5MTVfYnVkZHlf
YWxsb2MoJm1tLCBvcmRlcik7CisJCWlmICghSVNfRVJSKGJsb2NrKSkgeworCQkJcHJfaW5mbygi
YnVkZHlfYWxsb2MgdW5leHBlY3RlZGx5IHN1Y2NlZWRlZCBhdCBvcmRlciAlZCwgaXQgc2hvdWxk
IGJlIGZ1bGwhIiwKKwkJCQlvcmRlcik7CisJCQlsaXN0X2FkZF90YWlsKCZibG9jay0+bGluaywg
JmJsb2Nrcyk7CisJCQllcnIgPSAtRUlOVkFMOworCQkJZ290byBlcnI7CisJCX0KKwl9CisKK2Vy
cjoKKwlpOTE1X2J1ZGR5X2ZyZWVfbGlzdCgmbW0sICZibG9ja3MpOworCWk5MTVfYnVkZHlfZmlu
aSgmbW0pOworCXJldHVybiBlcnI7Cit9CisKIHN0YXRpYyBpbnQgaWd0X2J1ZGR5X2FsbG9jX3Jh
bmdlKHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3QgaTkxNV9idWRkeV9tbSBtbTsKQEAgLTQ4Myw3ICs3
MDYsMTAgQEAgc3RhdGljIGludCBpZ3RfYnVkZHlfYWxsb2NfcmFuZ2Uodm9pZCAqYXJnKQogaW50
IGk5MTVfYnVkZHlfbW9ja19zZWxmdGVzdHModm9pZCkKIHsKIAlzdGF0aWMgY29uc3Qgc3RydWN0
IGk5MTVfc3VidGVzdCB0ZXN0c1tdID0gewotCQlTVUJURVNUKGlndF9idWRkeV9hbGxvYyksCisJ
CVNVQlRFU1QoaWd0X2J1ZGR5X2FsbG9jX3Blc3NpbWlzdGljKSwKKwkJU1VCVEVTVChpZ3RfYnVk
ZHlfYWxsb2Nfb3B0aW1pc3RpYyksCisJCVNVQlRFU1QoaWd0X2J1ZGR5X2FsbG9jX3BhdGhvbG9n
aWNhbCksCisJCVNVQlRFU1QoaWd0X2J1ZGR5X2FsbG9jX3Ntb2tlKSwKIAkJU1VCVEVTVChpZ3Rf
YnVkZHlfYWxsb2NfcmFuZ2UpLAogCX07CiAKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRl
bC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
L21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

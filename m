Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E906072464
	for <lists+intel-gfx@lfdr.de>; Wed, 24 Jul 2019 04:22:38 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3FE1A6E42A;
	Wed, 24 Jul 2019 02:22:37 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga18.intel.com (mga18.intel.com [134.134.136.126])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 26BF96E42B
 for <intel-gfx@lists.freedesktop.org>; Wed, 24 Jul 2019 02:22:25 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga007.jf.intel.com ([10.7.209.58])
 by orsmga106.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 23 Jul 2019 19:22:25 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,300,1559545200"; d="scan'208";a="160422039"
Received: from dceraolo-linux.fm.intel.com ([10.1.27.145])
 by orsmga007.jf.intel.com with ESMTP; 23 Jul 2019 19:22:24 -0700
From: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 23 Jul 2019 19:21:53 -0700
Message-Id: <20190724022153.8927-9-daniele.ceraolospurio@intel.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190724022153.8927-1-daniele.ceraolospurio@intel.com>
References: <20190724022153.8927-1-daniele.ceraolospurio@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 8/8] drm/i915/uc: Unify uC firmware upload
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIHdheSB3ZSBsb2FkIHRoZSBmaXJtd2FyZXMgaXMgdGhlIHNhbWUgZm9yIGJvdGggR3VDIGFu
ZCBIdUMsIHRoZSBvbmx5CmRpZmZlcmVuY2UgaXMgaW4gdGhlIHdvcGNtIGRlc3RpbmF0aW9uIGFk
ZHJlc3MgYW5kIHRoZSBkbWEgZmxhZ3MsIHNvIHdlCmVhc2lseSBjYW4gbW92ZSB0aGUgbG9naWMg
dG8gYSBjb21tb24gZnVuY3Rpb24gYW5kIHBhc3MgaW4gb2Zmc2V0IGFuZApmbGFncy4gVGhlIG9u
bHkgb3RoZXIgZGlmZmVyZW5jZSBpbiB0aGUgdXBsYW9kIHBhdGggYXJlIHNvbWUgdGhlIGV4dHJh
CnN0ZXBzIHRoYXQgZ3VjIGRvZXMgYmVmb3JlIGFuZCBhZnRlciB0aGUgeGZlciwgYnV0IHRob3Nl
IGRvbid0IHJlcXVpcmUKdGhlIGd1YyBmdyB0byBiZSBwaW5uZWQgaW4gZ2d0dCBhbmQgY2FuIHNh
ZmVseSBiZSBwZXJmb3JtZWQgYmVmb3JlCmNhbGxpbmcgdGhlIHVjX3VwbG9hZCBmdW5jdGlvbi4K
Ck5vdGUgdGhhdCB0aGlzIHBhdGNoIHJlLWludHJvZHVjZXMgdGhlIGRtYSB4ZmVyIHdhaXQgZm9y
IGd1YyBsb2FkaW5nIHRoYXQKd2FzIHJlbW92ZWQgd2l0aCAiZHJtL2k5MTUvZ3VjOiBQcm9wYWdh
dGUgdGhlIGZ3IHhmZXIgdGltZW91dCIuIFRoaXMgaXMKbm90IGdvaW5nIHRvIHNsb3cgdXMgZG93
biBvbiBhIHN1Y2Nlc3NmdWwgbG9hZCAodGhlIGRtYSBoYXMgdG8gY29tcGxldGUKYmVmb3JlIGZ3
IGluaXQgY2FuIHN0YXJ0KSwgYnV0IGNvdWxkIHNsaWdodGx5IGluY3JlYXNlIHRoZSB0aW1lb3V0
IGluIGNhc2UKb2YgYSBmdyBpbml0IGVycm9yLgoKdjI6IHVzZSBfZncgdmFyaWFudHMgZm9yIHVu
Y29yZSBhY2Nlc3NlcyAoQ2hyaXMpLCBmaXggZ3VjX2Z3IHN0YXR1cyBvbgogICAgZmFpbGVkIHdh
aXQuCgpTaWduZWQtb2ZmLWJ5OiBEYW5pZWxlIENlcmFvbG8gU3B1cmlvIDxkYW5pZWxlLmNlcmFv
bG9zcHVyaW9AaW50ZWwuY29tPgpDYzogTWljaGFsIFdhamRlY3prbyA8bWljaGFsLndhamRlY3pr
b0BpbnRlbC5jb20+CkNjOiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4K
LS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF9ndWNfZncuYyB8IDEwNyArKysr
KystLS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF9odWNf
ZncuYyB8ICA1NyArLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVs
X3VjX2Z3LmMgIHwgIDc5ICsrKysrKysrKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3VjL2ludGVsX3VjX2Z3LmggIHwgICA0ICstCiA0IGZpbGVzIGNoYW5nZWQsIDkyIGluc2VydGlv
bnMoKyksIDE1NSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC91Yy9pbnRlbF9ndWNfZncuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVs
X2d1Y19mdy5jCmluZGV4IGRjYjRkZGNlNjU5YS4uMDM5NjU3OWNlZTc2IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF9ndWNfZncuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC91Yy9pbnRlbF9ndWNfZncuYwpAQCAtODYsMTMgKzg2LDYgQEAgc3RhdGlj
IHZvaWQgZ3VjX3hmZXJfcnNhKHN0cnVjdCBpbnRlbF91Y19mdyAqZ3VjX2Z3LAogCQlpbnRlbF91
bmNvcmVfd3JpdGUodW5jb3JlLCBVT1NfUlNBX1NDUkFUQ0goaSksIHJzYVtpXSk7CiB9CiAKLXN0
YXRpYyBib29sIGd1Y194ZmVyX2NvbXBsZXRlZChzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUs
IHUzMiAqc3RhdHVzKQotewotCS8qIERpZCB3ZSBjb21wbGV0ZSB0aGUgeGZlcj8gKi8KLQkqc3Rh
dHVzID0gaW50ZWxfdW5jb3JlX3JlYWQodW5jb3JlLCBETUFfQ1RSTCk7Ci0JcmV0dXJuICEoKnN0
YXR1cyAmIFNUQVJUX0RNQSk7Ci19Ci0KIC8qCiAgKiBSZWFkIHRoZSBHdUMgc3RhdHVzIHJlZ2lz
dGVyIChHVUNfU1RBVFVTKSBhbmQgc3RvcmUgaXQgaW4gdGhlCiAgKiBzcGVjaWZpZWQgbG9jYXRp
b247IHRoZW4gcmV0dXJuIGEgYm9vbGVhbiBpbmRpY2F0aW5nIHdoZXRoZXIKQEAgLTEzOSw2NSAr
MTMyLDI3IEBAIHN0YXRpYyBpbnQgZ3VjX3dhaXRfdWNvZGUoc3RydWN0IGludGVsX3VuY29yZSAq
dW5jb3JlKQogCQlyZXQgPSAtRU5YSU87CiAJfQogCi0JaWYgKHJldCA9PSAwICYmICFndWNfeGZl
cl9jb21wbGV0ZWQodW5jb3JlLCAmc3RhdHVzKSkgewotCQlEUk1fRVJST1IoIkd1QyBpcyByZWFk
eSwgYnV0IHRoZSB4ZmVyICUwOHggaXMgaW5jb21wbGV0ZVxuIiwKLQkJCSAgc3RhdHVzKTsKLQkJ
cmV0ID0gLUVOWElPOwotCX0KLQogCXJldHVybiByZXQ7CiB9CiAKLS8qCi0gKiBUcmFuc2ZlciB0
aGUgZmlybXdhcmUgaW1hZ2UgdG8gUkFNIGZvciBleGVjdXRpb24gYnkgdGhlIG1pY3JvY29udHJv
bGxlci4KKy8qKgorICogaW50ZWxfZ3VjX2Z3X3VwbG9hZCgpIC0gbG9hZCBHdUMgdUNvZGUgdG8g
ZGV2aWNlCisgKiBAZ3VjOiBpbnRlbF9ndWMgc3RydWN0dXJlCiAgKgotICogQXJjaGl0ZWN0dXJh
bGx5LCB0aGUgRE1BIGVuZ2luZSBpcyBiaWRpcmVjdGlvbmFsLCBhbmQgY2FuIHBvdGVudGlhbGx5
IGV2ZW4KLSAqIHRyYW5zZmVyIGJldHdlZW4gR1RUIGxvY2F0aW9ucy4gVGhpcyBmdW5jdGlvbmFs
aXR5IGlzIGxlZnQgb3V0IG9mIHRoZSBBUEkKLSAqIGZvciBub3cgYXMgdGhlcmUgaXMgbm8gbmVl
ZCBmb3IgaXQuCi0gKi8KLXN0YXRpYyBpbnQgZ3VjX3hmZXJfdWNvZGUoc3RydWN0IGludGVsX3Vj
X2Z3ICpndWNfZncsCi0JCQkgIHN0cnVjdCBpbnRlbF9ndCAqZ3QpCi17Ci0Jc3RydWN0IGludGVs
X3VuY29yZSAqdW5jb3JlID0gZ3QtPnVuY29yZTsKLQl1bnNpZ25lZCBsb25nIG9mZnNldDsKLQot
CS8qCi0JICogVGhlIGhlYWRlciBwbHVzIHVDb2RlIHdpbGwgYmUgY29waWVkIHRvIFdPUENNIHZp
YSBETUEsIGV4Y2x1ZGluZyBhbnkKLQkgKiBvdGhlciBjb21wb25lbnRzCi0JICovCi0JaW50ZWxf
dW5jb3JlX3dyaXRlKHVuY29yZSwgRE1BX0NPUFlfU0laRSwKLQkJCSAgIGd1Y19mdy0+aGVhZGVy
X3NpemUgKyBndWNfZnctPnVjb2RlX3NpemUpOwotCi0JLyogU2V0IHRoZSBzb3VyY2UgYWRkcmVz
cyBmb3IgdGhlIG5ldyBibG9iICovCi0Jb2Zmc2V0ID0gaW50ZWxfdWNfZndfZ2d0dF9vZmZzZXQo
Z3VjX2Z3LCBndC0+Z2d0dCkgKyBndWNfZnctPmhlYWRlcl9vZmZzZXQ7Ci0JaW50ZWxfdW5jb3Jl
X3dyaXRlKHVuY29yZSwgRE1BX0FERFJfMF9MT1csIGxvd2VyXzMyX2JpdHMob2Zmc2V0KSk7Ci0J
aW50ZWxfdW5jb3JlX3dyaXRlKHVuY29yZSwgRE1BX0FERFJfMF9ISUdILCB1cHBlcl8zMl9iaXRz
KG9mZnNldCkgJiAweEZGRkYpOwotCi0JLyoKLQkgKiBTZXQgdGhlIERNQSBkZXN0aW5hdGlvbi4g
Q3VycmVudCB1Q29kZSBleHBlY3RzIHRoZSBjb2RlIHRvIGJlCi0JICogbG9hZGVkIGF0IDhrOyBs
b2NhdGlvbnMgYmVsb3cgdGhpcyBhcmUgdXNlZCBmb3IgdGhlIHN0YWNrLgotCSAqLwotCWludGVs
X3VuY29yZV93cml0ZSh1bmNvcmUsIERNQV9BRERSXzFfTE9XLCAweDIwMDApOwotCWludGVsX3Vu
Y29yZV93cml0ZSh1bmNvcmUsIERNQV9BRERSXzFfSElHSCwgRE1BX0FERFJFU1NfU1BBQ0VfV09Q
Q00pOwotCi0JLyogRmluYWxseSBzdGFydCB0aGUgRE1BICovCi0JaW50ZWxfdW5jb3JlX3dyaXRl
KHVuY29yZSwgRE1BX0NUUkwsCi0JCQkgICBfTUFTS0VEX0JJVF9FTkFCTEUoVU9TX01PVkUgfCBT
VEFSVF9ETUEpKTsKLQotCXJldHVybiBndWNfd2FpdF91Y29kZSh1bmNvcmUpOwotfQotLyoKLSAq
IExvYWQgdGhlIEd1QyBmaXJtd2FyZSBibG9iIGludG8gdGhlIE1pbnV0ZUlBLgorICogQ2FsbGVk
IGZyb20gaW50ZWxfdWNfaW5pdF9odygpIGR1cmluZyBkcml2ZXIgbG9hZCwgcmVzdW1lIGZyb20g
c2xlZXAgYW5kCisgKiBhZnRlciBhIEdQVSByZXNldC4KKyAqCisgKiBUaGUgZmlybXdhcmUgaW1h
Z2Ugc2hvdWxkIGhhdmUgYWxyZWFkeSBiZWVuIGZldGNoZWQgaW50byBtZW1vcnksIHNvIG9ubHkK
KyAqIGNoZWNrIHRoYXQgZmV0Y2ggc3VjY2VlZGVkLCBhbmQgdGhlbiB0cmFuc2ZlciB0aGUgaW1h
Z2UgdG8gdGhlIGgvdy4KKyAqCisgKiBSZXR1cm46CW5vbi16ZXJvIGNvZGUgb24gZXJyb3IKICAq
Lwotc3RhdGljIGludCBndWNfZndfeGZlcihzdHJ1Y3QgaW50ZWxfdWNfZncgKmd1Y19mdywgc3Ry
dWN0IGludGVsX2d0ICpndCkKK2ludCBpbnRlbF9ndWNfZndfdXBsb2FkKHN0cnVjdCBpbnRlbF9n
dWMgKmd1YykKIHsKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gZ3VjX3RvX2d0KGd1Yyk7CiAJc3Ry
dWN0IGludGVsX3VuY29yZSAqdW5jb3JlID0gZ3QtPnVuY29yZTsKIAlpbnQgcmV0OwogCi0JR0VN
X0JVR19PTihndWNfZnctPnR5cGUgIT0gSU5URUxfVUNfRldfVFlQRV9HVUMpOwotCi0JaW50ZWxf
dW5jb3JlX2ZvcmNld2FrZV9nZXQodW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKLQogCWd1Y19wcmVw
YXJlX3hmZXIodW5jb3JlKTsKIAogCS8qCkBAIC0yMDUsMzIgKzE2MCwyNCBAQCBzdGF0aWMgaW50
IGd1Y19md194ZmVyKHN0cnVjdCBpbnRlbF91Y19mdyAqZ3VjX2Z3LCBzdHJ1Y3QgaW50ZWxfZ3Qg
Kmd0KQogCSAqIGJ5IHRoZSBETUEgZW5naW5lIGluIG9uZSBvcGVyYXRpb24sIHdoZXJlYXMgdGhl
IFJTQSBzaWduYXR1cmUgaXMKIAkgKiBsb2FkZWQgdmlhIE1NSU8uCiAJICovCi0JZ3VjX3hmZXJf
cnNhKGd1Y19mdywgdW5jb3JlKTsKKwlndWNfeGZlcl9yc2EoJmd1Yy0+ZncsIHVuY29yZSk7CiAK
LQlyZXQgPSBndWNfeGZlcl91Y29kZShndWNfZncsIGd0KTsKLQotCWludGVsX3VuY29yZV9mb3Jj
ZXdha2VfcHV0KHVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CisJLyoKKwkgKiBDdXJyZW50IHVDb2Rl
IGV4cGVjdHMgdGhlIGNvZGUgdG8gYmUgbG9hZGVkIGF0IDhrOyBsb2NhdGlvbnMgYmVsb3cKKwkg
KiB0aGlzIGFyZSB1c2VkIGZvciB0aGUgc3RhY2suCisJICovCisJcmV0ID0gaW50ZWxfdWNfZndf
dXBsb2FkKCZndWMtPmZ3LCBndCwgMHgyMDAwLCBVT1NfTU9WRSk7CisJaWYgKHJldCkKKwkJZ290
byBvdXQ7CiAKLQlyZXR1cm4gcmV0OwotfQorCXJldCA9IGd1Y193YWl0X3Vjb2RlKHVuY29yZSk7
CisJaWYgKHJldCkKKwkJZ290byBvdXQ7CiAKLS8qKgotICogaW50ZWxfZ3VjX2Z3X3VwbG9hZCgp
IC0gbG9hZCBHdUMgdUNvZGUgdG8gZGV2aWNlCi0gKiBAZ3VjOiBpbnRlbF9ndWMgc3RydWN0dXJl
Ci0gKgotICogQ2FsbGVkIGZyb20gaW50ZWxfdWNfaW5pdF9odygpIGR1cmluZyBkcml2ZXIgbG9h
ZCwgcmVzdW1lIGZyb20gc2xlZXAgYW5kCi0gKiBhZnRlciBhIEdQVSByZXNldC4KLSAqCi0gKiBU
aGUgZmlybXdhcmUgaW1hZ2Ugc2hvdWxkIGhhdmUgYWxyZWFkeSBiZWVuIGZldGNoZWQgaW50byBt
ZW1vcnksIHNvIG9ubHkKLSAqIGNoZWNrIHRoYXQgZmV0Y2ggc3VjY2VlZGVkLCBhbmQgdGhlbiB0
cmFuc2ZlciB0aGUgaW1hZ2UgdG8gdGhlIGgvdy4KLSAqCi0gKiBSZXR1cm46CW5vbi16ZXJvIGNv
ZGUgb24gZXJyb3IKLSAqLwotaW50IGludGVsX2d1Y19md191cGxvYWQoc3RydWN0IGludGVsX2d1
YyAqZ3VjKQotewotCWludCByZXQgPSBpbnRlbF91Y19md191cGxvYWQoJmd1Yy0+ZncsIGd1Y190
b19ndChndWMpLCBndWNfZndfeGZlcik7Ci0JaWYgKCFyZXQpCi0JCWd1Yy0+Zncuc3RhdHVzID0g
SU5URUxfVUNfRklSTVdBUkVfUlVOTklORzsKKwlndWMtPmZ3LnN0YXR1cyA9IElOVEVMX1VDX0ZJ
Uk1XQVJFX1JVTk5JTkc7CisJcmV0dXJuIDA7CiAKK291dDoKKwlndWMtPmZ3LnN0YXR1cyA9IElO
VEVMX1VDX0ZJUk1XQVJFX0xPQURfRkFJTDsKIAlyZXR1cm4gcmV0OwogfQpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfaHVjX2Z3LmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC91Yy9pbnRlbF9odWNfZncuYwppbmRleCAwNTM0MmVlMGQxNTYuLjllYWE2ZTlh
NTM4NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfaHVjX2Z3
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfaHVjX2Z3LmMKQEAgLTM2
LDYwICszNiw2IEBAIHZvaWQgaW50ZWxfaHVjX2Z3X2luaXRfZWFybHkoc3RydWN0IGludGVsX2h1
YyAqaHVjKQogCWludGVsX3VjX2Z3X2luaXRfZWFybHkoaHVjX3RvX2d0KGh1YyktPmk5MTUsIGh1
Y19mdywgSU5URUxfVUNfRldfVFlQRV9IVUMpOwogfQogCi0vKioKLSAqIGh1Y19md194ZmVyKCkg
LSBETUEncyB0aGUgZmlybXdhcmUKLSAqIEBodWNfZnc6IHRoZSBmaXJtd2FyZSBkZXNjcmlwdG9y
Ci0gKgotICogVHJhbnNmZXIgdGhlIGZpcm13YXJlIGltYWdlIHRvIFJBTSBmb3IgZXhlY3V0aW9u
IGJ5IHRoZSBtaWNyb2NvbnRyb2xsZXIuCi0gKgotICogUmV0dXJuOiAwIG9uIHN1Y2Nlc3MsIG5v
bi16ZXJvIG9uIGZhaWx1cmUKLSAqLwotc3RhdGljIGludCBodWNfZndfeGZlcihzdHJ1Y3QgaW50
ZWxfdWNfZncgKmh1Y19mdywgc3RydWN0IGludGVsX2d0ICpndCkKLXsKLQlzdHJ1Y3QgaW50ZWxf
dW5jb3JlICp1bmNvcmUgPSBndC0+dW5jb3JlOwotCXVuc2lnbmVkIGxvbmcgb2Zmc2V0ID0gMDsK
LQl1MzIgc2l6ZTsKLQlpbnQgcmV0OwotCi0JR0VNX0JVR19PTihodWNfZnctPnR5cGUgIT0gSU5U
RUxfVUNfRldfVFlQRV9IVUMpOwotCi0JaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9nZXQodW5jb3Jl
LCBGT1JDRVdBS0VfQUxMKTsKLQotCS8qIFNldCB0aGUgc291cmNlIGFkZHJlc3MgZm9yIHRoZSB1
Q29kZSAqLwotCW9mZnNldCA9IGludGVsX3VjX2Z3X2dndHRfb2Zmc2V0KGh1Y19mdywgZ3QtPmdn
dHQpICsKLQkJIGh1Y19mdy0+aGVhZGVyX29mZnNldDsKLQlpbnRlbF91bmNvcmVfd3JpdGUodW5j
b3JlLCBETUFfQUREUl8wX0xPVywKLQkJCSAgIGxvd2VyXzMyX2JpdHMob2Zmc2V0KSk7Ci0JaW50
ZWxfdW5jb3JlX3dyaXRlKHVuY29yZSwgRE1BX0FERFJfMF9ISUdILAotCQkJICAgdXBwZXJfMzJf
Yml0cyhvZmZzZXQpICYgMHhGRkZGKTsKLQotCS8qCi0JICogSGFyZHdhcmUgZG9lc24ndCBsb29r
IGF0IGRlc3RpbmF0aW9uIGFkZHJlc3MgZm9yIEh1Qy4gU2V0IGl0IHRvIDAsCi0JICogYnV0IHN0
aWxsIHByb2dyYW0gdGhlIGNvcnJlY3QgYWRkcmVzcyBzcGFjZS4KLQkgKi8KLQlpbnRlbF91bmNv
cmVfd3JpdGUodW5jb3JlLCBETUFfQUREUl8xX0xPVywgMCk7Ci0JaW50ZWxfdW5jb3JlX3dyaXRl
KHVuY29yZSwgRE1BX0FERFJfMV9ISUdILCBETUFfQUREUkVTU19TUEFDRV9XT1BDTSk7Ci0KLQlz
aXplID0gaHVjX2Z3LT5oZWFkZXJfc2l6ZSArIGh1Y19mdy0+dWNvZGVfc2l6ZTsKLQlpbnRlbF91
bmNvcmVfd3JpdGUodW5jb3JlLCBETUFfQ09QWV9TSVpFLCBzaXplKTsKLQotCS8qIFN0YXJ0IHRo
ZSBETUEgKi8KLQlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLCBETUFfQ1RSTCwKLQkJCSAgIF9N
QVNLRURfQklUX0VOQUJMRShIVUNfVUtFUk5FTCB8IFNUQVJUX0RNQSkpOwotCi0JLyogV2FpdCBm
b3IgRE1BIHRvIGZpbmlzaCAqLwotCXJldCA9IGludGVsX3dhaXRfZm9yX3JlZ2lzdGVyX2Z3KHVu
Y29yZSwgRE1BX0NUUkwsIFNUQVJUX0RNQSwgMCwgMTAwKTsKLQotCURSTV9ERUJVR19EUklWRVIo
Ikh1QyBETUEgdHJhbnNmZXIgd2FpdCBvdmVyIHdpdGggcmV0ICVkXG4iLCByZXQpOwotCi0JLyog
RGlzYWJsZSB0aGUgYml0cyBvbmNlIERNQSBpcyBvdmVyICovCi0JaW50ZWxfdW5jb3JlX3dyaXRl
KHVuY29yZSwgRE1BX0NUUkwsIF9NQVNLRURfQklUX0RJU0FCTEUoSFVDX1VLRVJORUwpKTsKLQot
CWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KHVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7Ci0KLQly
ZXR1cm4gcmV0OwotfQotCiAvKioKICAqIGludGVsX2h1Y19md191cGxvYWQoKSAtIGxvYWQgSHVD
IHVDb2RlIHRvIGRldmljZQogICogQGh1YzogaW50ZWxfaHVjIHN0cnVjdHVyZQpAQCAtMTA0LDUg
KzUwLDYgQEAgc3RhdGljIGludCBodWNfZndfeGZlcihzdHJ1Y3QgaW50ZWxfdWNfZncgKmh1Y19m
dywgc3RydWN0IGludGVsX2d0ICpndCkKICAqLwogaW50IGludGVsX2h1Y19md191cGxvYWQoc3Ry
dWN0IGludGVsX2h1YyAqaHVjKQogewotCXJldHVybiBpbnRlbF91Y19md191cGxvYWQoJmh1Yy0+
ZncsIGh1Y190b19ndChodWMpLCBodWNfZndfeGZlcik7CisJLyogSFcgZG9lc24ndCBsb29rIGF0
IGRlc3RpbmF0aW9uIGFkZHJlc3MgZm9yIEh1Qywgc28gc2V0IGl0IHRvIDAgKi8KKwlyZXR1cm4g
aW50ZWxfdWNfZndfdXBsb2FkKCZodWMtPmZ3LCBodWNfdG9fZ3QoaHVjKSwgMCwgSFVDX1VLRVJO
RUwpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfdWNf
ZncuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX3VjX2Z3LmMKaW5kZXggZWEx
NDUyZGJlNzhjLi4wNWZlZWYzNTRmMzMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3VjL2ludGVsX3VjX2Z3LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50
ZWxfdWNfZncuYwpAQCAtMzI1LDEzICszMjUsMjQgQEAgdm9pZCBpbnRlbF91Y19md19mZXRjaChz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJcmVsZWFzZV9maXJtd2FyZShmdyk7
CQkvKiBPSyBldmVuIGlmIGZ3IGlzIE5VTEwgKi8KIH0KIAorc3RhdGljIHUzMiB1Y19md19nZ3R0
X29mZnNldChzdHJ1Y3QgaW50ZWxfdWNfZncgKnVjX2Z3LCBzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0
KQoreworCXN0cnVjdCBkcm1fbW1fbm9kZSAqbm9kZSA9ICZnZ3R0LT51Y19mdzsKKworCUdFTV9C
VUdfT04oIW5vZGUtPmFsbG9jYXRlZCk7CisJR0VNX0JVR19PTih1cHBlcl8zMl9iaXRzKG5vZGUt
PnN0YXJ0KSk7CisJR0VNX0JVR19PTih1cHBlcl8zMl9iaXRzKG5vZGUtPnN0YXJ0ICsgbm9kZS0+
c2l6ZSAtIDEpKTsKKworCXJldHVybiBsb3dlcl8zMl9iaXRzKG5vZGUtPnN0YXJ0KTsKK30KKwog
c3RhdGljIHZvaWQgaW50ZWxfdWNfZndfZ2d0dF9iaW5kKHN0cnVjdCBpbnRlbF91Y19mdyAqdWNf
ZncsCiAJCQkJICBzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogewogCXN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmogPSB1Y19mdy0+b2JqOwogCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSBndC0+
Z2d0dDsKIAlzdHJ1Y3QgaTkxNV92bWEgZHVtbXkgPSB7Ci0JCS5ub2RlLnN0YXJ0ID0gaW50ZWxf
dWNfZndfZ2d0dF9vZmZzZXQodWNfZncsIGdndHQpLAorCQkubm9kZS5zdGFydCA9IHVjX2Z3X2dn
dHRfb2Zmc2V0KHVjX2Z3LCBnZ3R0KSwKIAkJLm5vZGUuc2l6ZSA9IG9iai0+YmFzZS5zaXplLAog
CQkucGFnZXMgPSBvYmotPm1tLnBhZ2VzLAogCQkudm0gPSAmZ2d0dC0+dm0sCkBAIC0zNTEsMjMg
KzM2Miw2OCBAQCBzdGF0aWMgdm9pZCBpbnRlbF91Y19md19nZ3R0X3VuYmluZChzdHJ1Y3QgaW50
ZWxfdWNfZncgKnVjX2Z3LAogewogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB1
Y19mdy0+b2JqOwogCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSBndC0+Z2d0dDsKLQl1NjQgc3Rh
cnQgPSBpbnRlbF91Y19md19nZ3R0X29mZnNldCh1Y19mdywgZ2d0dCk7CisJdTY0IHN0YXJ0ID0g
dWNfZndfZ2d0dF9vZmZzZXQodWNfZncsIGdndHQpOwogCiAJZ2d0dC0+dm0uY2xlYXJfcmFuZ2Uo
JmdndHQtPnZtLCBzdGFydCwgb2JqLT5iYXNlLnNpemUpOwogfQogCitzdGF0aWMgaW50IHVjX2Z3
X3hmZXIoc3RydWN0IGludGVsX3VjX2Z3ICp1Y19mdywgc3RydWN0IGludGVsX2d0ICpndCwKKwkJ
ICAgICAgdTMyIHdvcGNtX29mZnNldCwgdTMyIGRtYV9mbGFncykKK3sKKwlzdHJ1Y3QgaW50ZWxf
dW5jb3JlICp1bmNvcmUgPSBndC0+dW5jb3JlOworCXU2NCBvZmZzZXQ7CisJaW50IHJldDsKKwor
CWludGVsX3VuY29yZV9mb3JjZXdha2VfZ2V0KHVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CisKKwkv
KiBTZXQgdGhlIHNvdXJjZSBhZGRyZXNzIGZvciB0aGUgdUNvZGUgKi8KKwlvZmZzZXQgPSB1Y19m
d19nZ3R0X29mZnNldCh1Y19mdywgZ3QtPmdndHQpICsgdWNfZnctPmhlYWRlcl9vZmZzZXQ7CisJ
R0VNX0JVR19PTih1cHBlcl8zMl9iaXRzKG9mZnNldCkgJiAweEZGRkYwMDAwKTsKKwlpbnRlbF91
bmNvcmVfd3JpdGVfZncodW5jb3JlLCBETUFfQUREUl8wX0xPVywgbG93ZXJfMzJfYml0cyhvZmZz
ZXQpKTsKKwlpbnRlbF91bmNvcmVfd3JpdGVfZncodW5jb3JlLCBETUFfQUREUl8wX0hJR0gsIHVw
cGVyXzMyX2JpdHMob2Zmc2V0KSk7CisKKwkvKiBTZXQgdGhlIERNQSBkZXN0aW5hdGlvbiAqLwor
CWludGVsX3VuY29yZV93cml0ZV9mdyh1bmNvcmUsIERNQV9BRERSXzFfTE9XLCB3b3BjbV9vZmZz
ZXQpOworCWludGVsX3VuY29yZV93cml0ZV9mdyh1bmNvcmUsIERNQV9BRERSXzFfSElHSCwgRE1B
X0FERFJFU1NfU1BBQ0VfV09QQ00pOworCisJLyoKKwkgKiBTZXQgdGhlIHRyYW5zZmVyIHNpemUu
IFRoZSBoZWFkZXIgcGx1cyB1Q29kZSB3aWxsIGJlIGNvcGllZCB0byBXT1BDTQorCSAqIHZpYSBE
TUEsIGV4Y2x1ZGluZyBhbnkgb3RoZXIgY29tcG9uZW50cworCSAqLworCWludGVsX3VuY29yZV93
cml0ZV9mdyh1bmNvcmUsIERNQV9DT1BZX1NJWkUsCisJCQkgICAgICB1Y19mdy0+aGVhZGVyX3Np
emUgKyB1Y19mdy0+dWNvZGVfc2l6ZSk7CisKKwkvKiBTdGFydCB0aGUgRE1BICovCisJaW50ZWxf
dW5jb3JlX3dyaXRlX2Z3KHVuY29yZSwgRE1BX0NUUkwsCisJCQkgICAgICBfTUFTS0VEX0JJVF9F
TkFCTEUoZG1hX2ZsYWdzIHwgU1RBUlRfRE1BKSk7CisKKwkvKiBXYWl0IGZvciBETUEgdG8gZmlu
aXNoICovCisJcmV0ID0gaW50ZWxfd2FpdF9mb3JfcmVnaXN0ZXJfZncodW5jb3JlLCBETUFfQ1RS
TCwgU1RBUlRfRE1BLCAwLCAxMDApOworCWlmIChyZXQpCisJCURSTV9FUlJPUigiRE1BIGZvciAl
cyBmdyBmYWlsZWQsIGVycj0lZFxuIiwKKwkJCSAgaW50ZWxfdWNfZndfdHlwZV9yZXByKHVjX2Z3
LT50eXBlKSwgcmV0KTsKKworCS8qIERpc2FibGUgdGhlIGJpdHMgb25jZSBETUEgaXMgb3ZlciAq
LworCWludGVsX3VuY29yZV93cml0ZV9mdyh1bmNvcmUsIERNQV9DVFJMLCBfTUFTS0VEX0JJVF9E
SVNBQkxFKGRtYV9mbGFncykpOworCisJaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQodW5jb3Jl
LCBGT1JDRVdBS0VfQUxMKTsKKworCXJldHVybiByZXQ7Cit9CisKIC8qKgogICogaW50ZWxfdWNf
ZndfdXBsb2FkIC0gbG9hZCB1QyBmaXJtd2FyZSB1c2luZyBjdXN0b20gbG9hZGVyCiAgKiBAdWNf
Znc6IHVDIGZpcm13YXJlCiAgKiBAZ3Q6IHRoZSBpbnRlbF9ndCBzdHJ1Y3R1cmUKLSAqIEB4ZmVy
OiBjdXN0b20gdUMgZmlybXdhcmUgbG9hZGVyIGZ1bmN0aW9uCisgKiBAd29wY21fb2Zmc2V0OiBk
ZXN0aW5hdGlvbiBvZmZzZXQgaW4gd29wY20KKyAqIEBkbWFfZmxhZ3M6IGZsYWdzIGZvciBmbGFn
cyBmb3IgZG1hIGN0cmwKICAqCi0gKiBMb2FkcyB1QyBmaXJtd2FyZSB1c2luZyBjdXN0b20gbG9h
ZGVyIGFuZCB1cGRhdGVzIGludGVybmFsIGZsYWdzLgorICogTG9hZHMgdUMgZmlybXdhcmUgYW5k
IHVwZGF0ZXMgaW50ZXJuYWwgZmxhZ3MuCiAgKgogICogUmV0dXJuOiAwIG9uIHN1Y2Nlc3MsIG5v
bi16ZXJvIG9uIGZhaWx1cmUuCiAgKi8KIGludCBpbnRlbF91Y19md191cGxvYWQoc3RydWN0IGlu
dGVsX3VjX2Z3ICp1Y19mdywgc3RydWN0IGludGVsX2d0ICpndCwKLQkJICAgICAgIGludCAoKnhm
ZXIpKHN0cnVjdCBpbnRlbF91Y19mdyAqdWNfZncsIHN0cnVjdCBpbnRlbF9ndCAqZ3QpKQorCQkg
ICAgICAgdTMyIHdvcGNtX29mZnNldCwgdTMyIGRtYV9mbGFncykKIHsKIAlpbnQgZXJyOwogCkBA
IC0zODEsNyArNDM3LDcgQEAgaW50IGludGVsX3VjX2Z3X3VwbG9hZChzdHJ1Y3QgaW50ZWxfdWNf
ZncgKnVjX2Z3LCBzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCQlyZXR1cm4gLUVOT0VYRUM7CiAJLyog
Q2FsbCBjdXN0b20gbG9hZGVyICovCiAJaW50ZWxfdWNfZndfZ2d0dF9iaW5kKHVjX2Z3LCBndCk7
Ci0JZXJyID0geGZlcih1Y19mdywgZ3QpOworCWVyciA9IHVjX2Z3X3hmZXIodWNfZncsIGd0LCB3
b3BjbV9vZmZzZXQsIGRtYV9mbGFncyk7CiAJaW50ZWxfdWNfZndfZ2d0dF91bmJpbmQodWNfZncs
IGd0KTsKIAlpZiAoZXJyKQogCQlnb3RvIGZhaWw7CkBAIC00MzQsMTcgKzQ5MCw2IEBAIHZvaWQg
aW50ZWxfdWNfZndfZmluaShzdHJ1Y3QgaW50ZWxfdWNfZncgKnVjX2Z3KQogCWk5MTVfZ2VtX29i
amVjdF91bnBpbl9wYWdlcyh1Y19mdy0+b2JqKTsKIH0KIAotdTMyIGludGVsX3VjX2Z3X2dndHRf
b2Zmc2V0KHN0cnVjdCBpbnRlbF91Y19mdyAqdWNfZncsIHN0cnVjdCBpOTE1X2dndHQgKmdndHQp
Ci17Ci0Jc3RydWN0IGRybV9tbV9ub2RlICpub2RlID0gJmdndHQtPnVjX2Z3OwotCi0JR0VNX0JV
R19PTighbm9kZS0+YWxsb2NhdGVkKTsKLQlHRU1fQlVHX09OKHVwcGVyXzMyX2JpdHMobm9kZS0+
c3RhcnQpKTsKLQlHRU1fQlVHX09OKHVwcGVyXzMyX2JpdHMobm9kZS0+c3RhcnQgKyBub2RlLT5z
aXplIC0gMSkpOwotCi0JcmV0dXJuIGxvd2VyXzMyX2JpdHMobm9kZS0+c3RhcnQpOwotfQotCiAv
KioKICAqIGludGVsX3VjX2Z3X2NsZWFudXBfZmV0Y2ggLSBjbGVhbnVwIHVDIGZpcm13YXJlCiAg
KgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfdWNfZncuaCBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX3VjX2Z3LmgKaW5kZXggY2JkM2FhYzdh
Y2Y5Li41YjgyZGRhZDU4OTEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Vj
L2ludGVsX3VjX2Z3LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfdWNf
ZncuaApAQCAtMzEsNyArMzEsNiBAQAogc3RydWN0IGRybV9wcmludGVyOwogc3RydWN0IGRybV9p
OTE1X3ByaXZhdGU7CiBzdHJ1Y3QgaW50ZWxfZ3Q7Ci1zdHJ1Y3QgaTkxNV9nZ3R0OwogCiAvKiBI
b21lIG9mIEd1QywgSHVDIGFuZCBETUMgZmlybXdhcmVzICovCiAjZGVmaW5lIElOVEVMX1VDX0ZJ
Uk1XQVJFX1VSTCAiaHR0cHM6Ly9naXQua2VybmVsLm9yZy9wdWIvc2NtL2xpbnV4L2tlcm5lbC9n
aXQvZmlybXdhcmUvbGludXgtZmlybXdhcmUuZ2l0L3RyZWUvaTkxNSIKQEAgLTE3NSwxMCArMTc0
LDkgQEAgdm9pZCBpbnRlbF91Y19md19mZXRjaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKIAkJICAgICAgIHN0cnVjdCBpbnRlbF91Y19mdyAqdWNfZncpOwogdm9pZCBpbnRlbF91Y19m
d19jbGVhbnVwX2ZldGNoKHN0cnVjdCBpbnRlbF91Y19mdyAqdWNfZncpOwogaW50IGludGVsX3Vj
X2Z3X3VwbG9hZChzdHJ1Y3QgaW50ZWxfdWNfZncgKnVjX2Z3LCBzdHJ1Y3QgaW50ZWxfZ3QgKmd0
LAotCQkgICAgICAgaW50ICgqeGZlcikoc3RydWN0IGludGVsX3VjX2Z3ICp1Y19mdywgc3RydWN0
IGludGVsX2d0ICpndCkpOworCQkgICAgICAgdTMyIHdvcGNtX29mZnNldCwgdTMyIGRtYV9mbGFn
cyk7CiBpbnQgaW50ZWxfdWNfZndfaW5pdChzdHJ1Y3QgaW50ZWxfdWNfZncgKnVjX2Z3KTsKIHZv
aWQgaW50ZWxfdWNfZndfZmluaShzdHJ1Y3QgaW50ZWxfdWNfZncgKnVjX2Z3KTsKLXUzMiBpbnRl
bF91Y19md19nZ3R0X29mZnNldChzdHJ1Y3QgaW50ZWxfdWNfZncgKnVjX2Z3LCBzdHJ1Y3QgaTkx
NV9nZ3R0ICpnZ3R0KTsKIHNpemVfdCBpbnRlbF91Y19md19jb3B5X3JzYShzdHJ1Y3QgaW50ZWxf
dWNfZncgKnVjX2Z3LCB2b2lkICpkc3QsIHUzMiBtYXhfbGVuKTsKIHZvaWQgaW50ZWxfdWNfZndf
ZHVtcChjb25zdCBzdHJ1Y3QgaW50ZWxfdWNfZncgKnVjX2Z3LCBzdHJ1Y3QgZHJtX3ByaW50ZXIg
KnApOwogCi0tIAoyLjIyLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2lu
dGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id F01BF30FAD6
	for <lists+intel-gfx@lfdr.de>; Thu,  4 Feb 2021 19:11:13 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3AD756EE15;
	Thu,  4 Feb 2021 18:11:12 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga14.intel.com (mga14.intel.com [192.55.52.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1168C6EE15
 for <intel-gfx@lists.freedesktop.org>; Thu,  4 Feb 2021 18:11:11 +0000 (UTC)
IronPort-SDR: bVR67qoxf1+ILAlyUE+YfoTag6awiXbouJAIeofGAY0D6bfs+UWi5pz7b2QVK4U6wDPiOhPBuz
 3Trxdcv58vUA==
X-IronPort-AV: E=McAfee;i="6000,8403,9885"; a="180524794"
X-IronPort-AV: E=Sophos;i="5.81,153,1610438400"; d="scan'208";a="180524794"
Received: from orsmga001.jf.intel.com ([10.7.209.18])
 by fmsmga103.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 04 Feb 2021 10:11:09 -0800
IronPort-SDR: HAz2z5lQtkdL1AW608Bp1Kx4+Ixod0mhUY1oyXhXkPNuRmwtFgk8VW7dQ5i0calahDSwxB0fEq
 QLacLVOdcjVQ==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.81,153,1610438400"; d="scan'208";a="434053353"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.171])
 by orsmga001.jf.intel.com with SMTP; 04 Feb 2021 10:11:07 -0800
Received: by stinkbox (sSMTP sendmail emulation);
 Thu, 04 Feb 2021 20:11:06 +0200
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  4 Feb 2021 20:10:40 +0200
Message-Id: <20210204181048.24202-7-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.26.2
In-Reply-To: <20210204181048.24202-1-ville.syrjala@linux.intel.com>
References: <20210204181048.24202-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 06/14] drm/i915: Extract icl+ .{enable,
 disable}_clock() vfuncs
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Lucas De Marchi <lucas.demarchi@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KCkZv
ciBJQ0wrIHdlIGhhdmUgc2V2ZXJhbCBzdHlsZXMgb2YgY2xvY2sgcm91dGluZyBmb3IgRERJczoK
MSkgVEMgRERJICsgVEMgUEhZCiAgIC0+IG5lZWRzIERESV9DTEtfU0VMPT1NRy9UQlQgcGFydCBm
b3JtIGludGVsX2RkaV9jbGtfe3NlbGVjdCxkaXNhYmxlfSgpCiAgIGFuZCBJQ0xfRFBDTEtBX0NG
R0NSMF9UQ19DTEtfT0ZGIHBhcnQgZm9ybSBpY2xfe21hcCx1bm1hcH1fcGxsc190b19wb3J0cygp
CjIpIElDTC9UR0wgY29tYm8gRERJICsgY29tYm8gUEhZCiAgIC0+IGp1c3QgbmVlZCB0aGUgc3R1
ZmYgZnJvbSBpY2xfe21hcCx1bm1hcH1fcGxsc190b19wb3J0cygpCjMpIEpTTC9FSEwgVEMgRERJ
ICsgY29tYm8gUEhZCiAgIC0+IG5lZWRzIERESV9DTEtfU0VMPT1NRyBwYXJ0IGZyb20gaW50ZWxf
ZGRpX2Nsa197c2VsZWN0LGRpc2FibGV9KCkgYW5kCiAgIHRoZSBmdWxsIGNvbWJvIHN0eWxlIGNs
b2NrIHNlbGVjdGlvbiBmcm9tIGljbF97bWFwLHVubWFwfV9wbGxzX3RvX3BvcnRzKCkKNCkgQURM
Uy9SS0wKICAgLT4gdGhlc2UgdXNlIGJvdGggVEMgYW5kIGNvbWJvIERESXMgd2l0aCBjb21ibyBQ
SFlzLCBob3dldmVyIHRoZXkKICAgYWx3YXlzIHVzZSB0aGUgZnVsbCBjb21ibyBzdHlsZSBjbG9j
ayBzZWxlY3Rpb24gYXMgcGVyCiAgIGljbF97bWFwLHVubWFwfV9wbGxzX3RvX3BvcnRzKCkgYW5k
IGRvIG5vdCB1c2UgRERJX0NMS19TRUwgYXQgYWxsLAogICB0aHVzIGdldCB0cmVhdGVkIHRoZSBz
YW1lIGFzIDIpCgpXZSBleHRyYWN0IGFsbCB0aGF0IGZyb20gdGhlIGN1cnJlbnQgbWVzcyBpbiB0
aGUgZm9sbG93aW5nIHdheToKMSkgaWNsX2RkaV90Y197ZW5hYmxlLGRpc2FibGV9X2Nsb2NrKCkK
MikgaWNsX2RkaV9jb21ib197ZW5hYmxlLGRpc2FibGV9X2Nsb2NrKCkKMykganNsX2RkaV90Y197
ZW5hYmxlLGRpc2FibGV9X2Nsb2NrKCkKNCkgZm9yIG5vdyB3ZSByZXVzZSBpY2xfZGRpX2NvbWJv
X3tlbmFibGUsZGlzYWJsZX1fY2xvY2soKSBoZXJlCgp2Mjogcy9kZXZfcHJpdi9pOTE1LyAoTHVj
YXMpCgpSZXZpZXdlZC1ieTogTHVjYXMgRGUgTWFyY2hpIDxsdWNhcy5kZW1hcmNoaUBpbnRlbC5j
b20+ClNpZ25lZC1vZmYtYnk6IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBsaW51eC5p
bnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYyB8
IDE2MyArKysrKysrKysrKysrKy0tLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDEwMiBpbnNlcnRp
b25zKCspLCA2MSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2RkaS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kZGkuYwppbmRleCBjYmViNzVkMDAwMTMuLmQ2ODhlZjIzMWVlYiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCkBAIC0zMTc0LDggKzMxNzQsOCBAQCBzdGF0aWMg
dm9pZCBkZzFfZGRpX2Rpc2FibGVfY2xvY2soc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIp
CiAJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHBsbC5sb2NrKTsKIH0KIAotc3RhdGljIHZvaWQg
aWNsX21hcF9wbGxzX3RvX3BvcnRzKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAotCQkJ
CSAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCitzdGF0aWMgdm9p
ZCBpY2xfZGRpX2NvbWJvX2VuYWJsZV9jbG9jayhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
ciwKKwkJCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
CiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVy
LT5iYXNlLmRldik7CiAJc3RydWN0IGludGVsX3NoYXJlZF9kcGxsICpwbGwgPSBjcnRjX3N0YXRl
LT5zaGFyZWRfZHBsbDsKQEAgLTMyMDMsMjIgKzMyMDMsMjAgQEAgc3RhdGljIHZvaWQgaWNsX21h
cF9wbGxzX3RvX3BvcnRzKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCWRybV9XQVJO
X09OKCZkZXZfcHJpdi0+ZHJtLAogCQkgICAgKHZhbCAmIGljbF9kcGNsa2FfY2ZnY3IwX2Nsa19v
ZmYoZGV2X3ByaXYsIHBoeSkpID09IDApOwogCi0JaWYgKGludGVsX3BoeV9pc19jb21ibyhkZXZf
cHJpdiwgcGh5KSkgewotCQkvKgotCQkgKiBFdmVuIHRob3VnaCB0aGlzIHJlZ2lzdGVyIHJlZmVy
ZW5jZXMgRERJcywgbm90ZSB0aGF0IHdlCi0JCSAqIHdhbnQgdG8gcGFzcyB0aGUgUEhZIHJhdGhl
ciB0aGFuIHRoZSBwb3J0IChEREkpLiAgRm9yCi0JCSAqIElDTCwgcG9ydD1waHkgaW4gYWxsIGNh
c2VzIHNvIGl0IGRvZXNuJ3QgbWF0dGVyLCBidXQgZm9yCi0JCSAqIEVITCB0aGUgYnNwZWMgbm90
ZXMgdGhlIGZvbGxvd2luZzoKLQkJICoKLQkJICogICAiRERJRCBjbG9jayB0aWVkIHRvIERESUEg
Y2xvY2ssIHNvIERQQ0xLQV9DRkdDUjAgRERJQQotCQkgKiAgIENsb2NrIFNlbGVjdCBjaG9vc2Vz
IHRoZSBQTEwgZm9yIGJvdGggRERJQSBhbmQgRERJRCBhbmQKLQkJICogICBkcml2ZXMgcG9ydCBB
IGluIGFsbCBjYXNlcy4iCi0JCSAqLwotCQl2YWwgJj0gfm1hc2s7Ci0JCXZhbCB8PSBzZWw7Ci0J
CWludGVsX2RlX3dyaXRlKGRldl9wcml2LCByZWcsIHZhbCk7Ci0JCWludGVsX2RlX3Bvc3Rpbmdf
cmVhZChkZXZfcHJpdiwgcmVnKTsKLQl9CisJLyoKKwkgKiBFdmVuIHRob3VnaCB0aGlzIHJlZ2lz
dGVyIHJlZmVyZW5jZXMgRERJcywgbm90ZSB0aGF0IHdlCisJICogd2FudCB0byBwYXNzIHRoZSBQ
SFkgcmF0aGVyIHRoYW4gdGhlIHBvcnQgKERESSkuICBGb3IKKwkgKiBJQ0wsIHBvcnQ9cGh5IGlu
IGFsbCBjYXNlcyBzbyBpdCBkb2Vzbid0IG1hdHRlciwgYnV0IGZvcgorCSAqIEVITCB0aGUgYnNw
ZWMgbm90ZXMgdGhlIGZvbGxvd2luZzoKKwkgKgorCSAqICAgIkRESUQgY2xvY2sgdGllZCB0byBE
RElBIGNsb2NrLCBzbyBEUENMS0FfQ0ZHQ1IwIERESUEKKwkgKiAgIENsb2NrIFNlbGVjdCBjaG9v
c2VzIHRoZSBQTEwgZm9yIGJvdGggRERJQSBhbmQgRERJRCBhbmQKKwkgKiAgIGRyaXZlcyBwb3J0
IEEgaW4gYWxsIGNhc2VzLiIKKwkgKi8KKwl2YWwgJj0gfm1hc2s7CisJdmFsIHw9IHNlbDsKKwlp
bnRlbF9kZV93cml0ZShkZXZfcHJpdiwgcmVnLCB2YWwpOworCWludGVsX2RlX3Bvc3RpbmdfcmVh
ZChkZXZfcHJpdiwgcmVnKTsKIAogCXZhbCAmPSB+aWNsX2RwY2xrYV9jZmdjcjBfY2xrX29mZihk
ZXZfcHJpdiwgcGh5KTsKIAlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgcmVnLCB2YWwpOwpAQCAt
MzIyNiw3ICszMjI0LDcgQEAgc3RhdGljIHZvaWQgaWNsX21hcF9wbGxzX3RvX3BvcnRzKHN0cnVj
dCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRwbGwu
bG9jayk7CiB9CiAKLXN0YXRpYyB2b2lkIGljbF91bm1hcF9wbGxzX3RvX3BvcnRzKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyKQorc3RhdGljIHZvaWQgaWNsX2RkaV9jb21ib19kaXNhYmxl
X2Nsb2NrKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyKQogewogCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOwogCWVudW0g
cGh5IHBoeSA9IGludGVsX3BvcnRfdG9fcGh5KGRldl9wcml2LCBlbmNvZGVyLT5wb3J0KTsKQEAg
LTMzNzUsNDcgKzMzNzMsNzEgQEAgdm9pZCBpY2xfc2FuaXRpemVfZW5jb2Rlcl9wbGxfbWFwcGlu
ZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIAkJaWNsX3Nhbml0aXplX3BvcnRfY2xr
X29mZihkZXZfcHJpdiwgcG9ydF9tYXNrLCBkZGlfY2xrX25lZWRlZCk7CiB9CiAKLXN0YXRpYyB2
b2lkIGludGVsX2RkaV9jbGtfc2VsZWN0KHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAot
CQkJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3N0YXRpYyB2
b2lkIGpzbF9kZGlfdGNfZW5hYmxlX2Nsb2NrKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
LAorCQkJCSAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsK
LQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJh
c2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZW5jb2Rl
ci0+YmFzZS5kZXYpOworCWNvbnN0IHN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxsID0gY3J0
Y19zdGF0ZS0+c2hhcmVkX2RwbGw7CiAJZW51bSBwb3J0IHBvcnQgPSBlbmNvZGVyLT5wb3J0Owot
CWVudW0gcGh5IHBoeSA9IGludGVsX3BvcnRfdG9fcGh5KGRldl9wcml2LCBwb3J0KTsKKworCWlm
IChkcm1fV0FSTl9PTigmaTkxNS0+ZHJtLCAhcGxsKSkKKwkJcmV0dXJuOworCisJLyoKKwkgKiAi
Rm9yIERESUMgYW5kIERESUQsIHByb2dyYW0gRERJX0NMS19TRUwgdG8gbWFwIHRoZSBNRyBjbG9j
ayB0byB0aGUgcG9ydC4KKwkgKiAgTUcgZG9lcyBub3QgZXhpc3QsIGJ1dCB0aGUgcHJvZ3JhbW1p
bmcgaXMgcmVxdWlyZWQgdG8gdW5nYXRlIERESUMgYW5kIERESUQuIgorCSAqLworCWludGVsX2Rl
X3dyaXRlKGk5MTUsIERESV9DTEtfU0VMKHBvcnQpLCBERElfQ0xLX1NFTF9NRyk7CisKKwlpY2xf
ZGRpX2NvbWJvX2VuYWJsZV9jbG9jayhlbmNvZGVyLCBjcnRjX3N0YXRlKTsKK30KKworc3RhdGlj
IHZvaWQganNsX2RkaV90Y19kaXNhYmxlX2Nsb2NrKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShlbmNvZGVy
LT5iYXNlLmRldik7CisJZW51bSBwb3J0IHBvcnQgPSBlbmNvZGVyLT5wb3J0OworCisJaWNsX2Rk
aV9jb21ib19kaXNhYmxlX2Nsb2NrKGVuY29kZXIpOworCisJaW50ZWxfZGVfd3JpdGUoaTkxNSwg
RERJX0NMS19TRUwocG9ydCksIERESV9DTEtfU0VMX05PTkUpOworfQorCitzdGF0aWMgdm9pZCBp
Y2xfZGRpX3RjX2VuYWJsZV9jbG9jayhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKKwkJ
CQkgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCit7CisJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsK
IAljb25zdCBzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKnBsbCA9IGNydGNfc3RhdGUtPnNoYXJl
ZF9kcGxsOworCWVudW0gdGNfcG9ydCB0Y19wb3J0ID0gaW50ZWxfcG9ydF90b190YyhpOTE1LCBl
bmNvZGVyLT5wb3J0KTsKKwllbnVtIHBvcnQgcG9ydCA9IGVuY29kZXItPnBvcnQ7CiAKLQlpZiAo
ZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sICFwbGwpKQorCWlmIChkcm1fV0FSTl9PTigmaTkx
NS0+ZHJtLCAhcGxsKSkKIAkJcmV0dXJuOwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRwbGwu
bG9jayk7Ci0KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkgewotCQlpZiAoIWludGVs
X3BoeV9pc19jb21ibyhkZXZfcHJpdiwgcGh5KSkKLQkJCWludGVsX2RlX3dyaXRlKGRldl9wcml2
LCBERElfQ0xLX1NFTChwb3J0KSwKLQkJCQkgICAgICAgaWNsX3BsbF90b19kZGlfY2xrX3NlbChl
bmNvZGVyLCBjcnRjX3N0YXRlKSk7Ci0JCWVsc2UgaWYgKElTX0pTTF9FSEwoZGV2X3ByaXYpICYm
IHBvcnQgPj0gUE9SVF9DKQotCQkJLyoKLQkJCSAqIE1HIGRvZXMgbm90IGV4aXN0IGJ1dCB0aGUg
cHJvZ3JhbW1pbmcgaXMgcmVxdWlyZWQKLQkJCSAqIHRvIHVuZ2F0ZSBERElDIGFuZCBERElECi0J
CQkgKi8KLQkJCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBERElfQ0xLX1NFTChwb3J0KSwKLQkJ
CQkgICAgICAgRERJX0NMS19TRUxfTUcpOwotCX0KLQotCW11dGV4X3VubG9jaygmZGV2X3ByaXYt
PmRwbGwubG9jayk7CisJaW50ZWxfZGVfd3JpdGUoaTkxNSwgRERJX0NMS19TRUwocG9ydCksCisJ
CSAgICAgICBpY2xfcGxsX3RvX2RkaV9jbGtfc2VsKGVuY29kZXIsIGNydGNfc3RhdGUpKTsKKwor
CW11dGV4X2xvY2soJmk5MTUtPmRwbGwubG9jayk7CisKKwlpbnRlbF9kZV9ybXcoaTkxNSwgSUNM
X0RQQ0xLQV9DRkdDUjAsCisJCSAgICAgSUNMX0RQQ0xLQV9DRkdDUjBfVENfQ0xLX09GRih0Y19w
b3J0KSwgMCk7CisKKwltdXRleF91bmxvY2soJmk5MTUtPmRwbGwubG9jayk7CiB9CiAKLXN0YXRp
YyB2b2lkIGludGVsX2RkaV9jbGtfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
cikKK3N0YXRpYyB2b2lkIGljbF9kZGlfdGNfZGlzYWJsZV9jbG9jayhzdHJ1Y3QgaW50ZWxfZW5j
b2RlciAqZW5jb2RlcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5kZXYpOworCWVudW0gdGNfcG9ydCB0Y19wb3J0ID0g
aW50ZWxfcG9ydF90b190YyhpOTE1LCBlbmNvZGVyLT5wb3J0KTsKIAllbnVtIHBvcnQgcG9ydCA9
IGVuY29kZXItPnBvcnQ7Ci0JZW51bSBwaHkgcGh5ID0gaW50ZWxfcG9ydF90b19waHkoZGV2X3By
aXYsIHBvcnQpOwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpIHsKLQkJaWYgKCFp
bnRlbF9waHlfaXNfY29tYm8oZGV2X3ByaXYsIHBoeSkgfHwKLQkJICAgIChJU19KU0xfRUhMKGRl
dl9wcml2KSAmJiBwb3J0ID49IFBPUlRfQykpCi0JCQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwg
RERJX0NMS19TRUwocG9ydCksCi0JCQkJICAgICAgIERESV9DTEtfU0VMX05PTkUpOwotCX0KKwor
CW11dGV4X2xvY2soJmk5MTUtPmRwbGwubG9jayk7CisKKwlpbnRlbF9kZV9ybXcoaTkxNSwgSUNM
X0RQQ0xLQV9DRkdDUjAsCisJCSAgICAgMCwgSUNMX0RQQ0xLQV9DRkdDUjBfVENfQ0xLX09GRih0
Y19wb3J0KSk7CisKKwltdXRleF91bmxvY2soJmk5MTUtPmRwbGwubG9jayk7CisKKwlpbnRlbF9k
ZV93cml0ZShpOTE1LCBERElfQ0xLX1NFTChwb3J0KSwgRERJX0NMS19TRUxfTk9ORSk7CiB9CiAK
IHN0YXRpYyB2b2lkIGNubF9kZGlfZW5hYmxlX2Nsb2NrKHN0cnVjdCBpbnRlbF9lbmNvZGVyICpl
bmNvZGVyLApAQCAtMzUxNiwxNiArMzUzOCwxMiBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kZGlfZW5h
YmxlX2Nsb2NrKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogewogCWlmIChlbmNvZGVy
LT5lbmFibGVfY2xvY2spCiAJCWVuY29kZXItPmVuYWJsZV9jbG9jayhlbmNvZGVyLCBjcnRjX3N0
YXRlKTsKLQllbHNlCi0JCWludGVsX2RkaV9jbGtfc2VsZWN0KGVuY29kZXIsIGNydGNfc3RhdGUp
OwogfQogCiBzdGF0aWMgdm9pZCBpbnRlbF9kZGlfZGlzYWJsZV9jbG9jayhzdHJ1Y3QgaW50ZWxf
ZW5jb2RlciAqZW5jb2RlcikKIHsKIAlpZiAoZW5jb2Rlci0+ZGlzYWJsZV9jbG9jaykKIAkJZW5j
b2Rlci0+ZGlzYWJsZV9jbG9jayhlbmNvZGVyKTsKLQllbHNlCi0JCWludGVsX2RkaV9jbGtfZGlz
YWJsZShlbmNvZGVyKTsKIH0KIAogc3RhdGljIHZvaWQKQEAgLTQwMDcsOSArNDAyNSw2IEBAIHN0
YXRpYyB2b2lkIGludGVsX2RkaV9wcmVfZW5hYmxlKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUg
KnN0YXRlLAogCiAJZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIGNydGNfc3RhdGUtPmhhc19w
Y2hfZW5jb2Rlcik7CiAKLQlpZiAoIUlTX0RHMShkZXZfcHJpdikgJiYgSU5URUxfR0VOKGRldl9w
cml2KSA+PSAxMSkKLQkJaWNsX21hcF9wbGxzX3RvX3BvcnRzKGVuY29kZXIsIGNydGNfc3RhdGUp
OwotCiAJaW50ZWxfc2V0X2NwdV9maWZvX3VuZGVycnVuX3JlcG9ydGluZyhkZXZfcHJpdiwgcGlw
ZSwgdHJ1ZSk7CiAKIAlpZiAoaW50ZWxfY3J0Y19oYXNfdHlwZShjcnRjX3N0YXRlLCBJTlRFTF9P
VVRQVVRfSERNSSkpIHsKQEAgLTQyMDgsOSArNDIyMyw2IEBAIHN0YXRpYyB2b2lkIGludGVsX2Rk
aV9wb3N0X2Rpc2FibGUoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJCWludGVs
X2RkaV9wb3N0X2Rpc2FibGVfZHAoc3RhdGUsIGVuY29kZXIsIG9sZF9jcnRjX3N0YXRlLAogCQkJ
CQkgIG9sZF9jb25uX3N0YXRlKTsKIAotCWlmICghSVNfREcxKGRldl9wcml2KSAmJiBJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDExKQotCQlpY2xfdW5tYXBfcGxsc190b19wb3J0cyhlbmNvZGVyKTsK
LQogCWlmIChpbnRlbF9jcnRjX2hhc19kcF9lbmNvZGVyKG9sZF9jcnRjX3N0YXRlKSB8fCBpc190
Y19wb3J0KQogCQlpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dChkZXZfcHJpdiwKIAkJCQkJaW50ZWxf
ZGRpX21haW5fbGlua19hdXhfZG9tYWluKGRpZ19wb3J0KSwKQEAgLTU1NDksNiArNTU2MSwxNiBA
QCBzdGF0aWMgZW51bSBocGRfcGluIGNubF9ocGRfcGluKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIAlyZXR1cm4gSFBEX1BPUlRfQSArIHBvcnQgLSBQT1JUX0E7CiB9CiAKK3N0
YXRpYyBib29sIGludGVsX2RkaV9pc190YyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwg
ZW51bSBwb3J0IHBvcnQpCit7CisJaWYgKElOVEVMX0dFTihpOTE1KSA+PSAxMikKKwkJcmV0dXJu
IHBvcnQgPj0gUE9SVF9UQzE7CisJZWxzZSBpZiAoSU5URUxfR0VOKGk5MTUpID49IDExKQorCQly
ZXR1cm4gcG9ydCA+PSBQT1JUX0M7CisJZWxzZQorCQlyZXR1cm4gZmFsc2U7Cit9CisKICNkZWZp
bmUgcG9ydF90Y19uYW1lKHBvcnQpICgocG9ydCkgLSBQT1JUX1RDMSArICcxJykKICNkZWZpbmUg
dGNfcG9ydF9uYW1lKHRjX3BvcnQpICgodGNfcG9ydCkgLSBUQ19QT1JUXzEgKyAnMScpCiAKQEAg
LTU2NTMsOSArNTY3NSwyOCBAQCB2b2lkIGludGVsX2RkaV9pbml0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwgZW51bSBwb3J0IHBvcnQpCiAJZW5jb2Rlci0+Y2xvbmVhYmxlID0g
MDsKIAllbmNvZGVyLT5waXBlX21hc2sgPSB+MDsKIAotCWlmIChJU19ERzEoZGV2X3ByaXYpKSB7
CisJaWYgKElTX0FMREVSTEFLRV9TKGRldl9wcml2KSB8fCBJU19ST0NLRVRMQUtFKGRldl9wcml2
KSkgeworCQllbmNvZGVyLT5lbmFibGVfY2xvY2sgPSBpY2xfZGRpX2NvbWJvX2VuYWJsZV9jbG9j
azsKKwkJZW5jb2Rlci0+ZGlzYWJsZV9jbG9jayA9IGljbF9kZGlfY29tYm9fZGlzYWJsZV9jbG9j
azsKKwl9IGVsc2UgaWYgKElTX0RHMShkZXZfcHJpdikpIHsKIAkJZW5jb2Rlci0+ZW5hYmxlX2Ns
b2NrID0gZGcxX2RkaV9lbmFibGVfY2xvY2s7CiAJCWVuY29kZXItPmRpc2FibGVfY2xvY2sgPSBk
ZzFfZGRpX2Rpc2FibGVfY2xvY2s7CisJfSBlbHNlIGlmIChJU19KU0xfRUhMKGRldl9wcml2KSkg
eworCQlpZiAoaW50ZWxfZGRpX2lzX3RjKGRldl9wcml2LCBwb3J0KSkgeworCQkJZW5jb2Rlci0+
ZW5hYmxlX2Nsb2NrID0ganNsX2RkaV90Y19lbmFibGVfY2xvY2s7CisJCQllbmNvZGVyLT5kaXNh
YmxlX2Nsb2NrID0ganNsX2RkaV90Y19kaXNhYmxlX2Nsb2NrOworCQl9IGVsc2UgeworCQkJZW5j
b2Rlci0+ZW5hYmxlX2Nsb2NrID0gaWNsX2RkaV9jb21ib19lbmFibGVfY2xvY2s7CisJCQllbmNv
ZGVyLT5kaXNhYmxlX2Nsb2NrID0gaWNsX2RkaV9jb21ib19kaXNhYmxlX2Nsb2NrOworCQl9CisJ
fSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKSB7CisJCWlmIChpbnRlbF9kZGlf
aXNfdGMoZGV2X3ByaXYsIHBvcnQpKSB7CisJCQllbmNvZGVyLT5lbmFibGVfY2xvY2sgPSBpY2xf
ZGRpX3RjX2VuYWJsZV9jbG9jazsKKwkJCWVuY29kZXItPmRpc2FibGVfY2xvY2sgPSBpY2xfZGRp
X3RjX2Rpc2FibGVfY2xvY2s7CisJCX0gZWxzZSB7CisJCQllbmNvZGVyLT5lbmFibGVfY2xvY2sg
PSBpY2xfZGRpX2NvbWJvX2VuYWJsZV9jbG9jazsKKwkJCWVuY29kZXItPmRpc2FibGVfY2xvY2sg
PSBpY2xfZGRpX2NvbWJvX2Rpc2FibGVfY2xvY2s7CisJCX0KIAl9IGVsc2UgaWYgKElTX0NBTk5P
TkxBS0UoZGV2X3ByaXYpKSB7CiAJCWVuY29kZXItPmVuYWJsZV9jbG9jayA9IGNubF9kZGlfZW5h
YmxlX2Nsb2NrOwogCQllbmNvZGVyLT5kaXNhYmxlX2Nsb2NrID0gY25sX2RkaV9kaXNhYmxlX2Ns
b2NrOwotLSAKMi4yNi4yCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3Rv
cC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRl
bC1nZngK

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 717F42CFC6
	for <lists+intel-gfx@lfdr.de>; Tue, 28 May 2019 21:50:49 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6459A89F3C;
	Tue, 28 May 2019 19:50:47 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D4BD16E04A
 for <intel-gfx@lists.freedesktop.org>; Tue, 28 May 2019 19:50:45 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16711421-1500050 
 for multiple; Tue, 28 May 2019 20:50:29 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 28 May 2019 20:50:21 +0100
Message-Id: <20190528195022.11531-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 1/2] drm/i915: Track the purgeable objects on a
 separate eviction list
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q3VycmVudGx5IHRoZSBwdXJnZWFibGUgb2JqZWN0cywgSTkxNV9NQURWX0RPTlRORUVELCBhcyBt
aXhlZCBpbiB0aGUKbm9ybWFsIGJvdW5kL3VuYm91bmQgbGlzdHMuIEV2ZXJ5IHNocmlua2VyIHBh
c3Mgc3RhcnRzIHdpdGggYW4gYXR0ZW1wdAp0byBwdXJnZSBmcm9tIHRoaXMgc2V0IG9mIHVubmVl
ZGVkIG9iamVjdHMsIHdoaWNoIGVudGFpbHMgdXMgZG9pbmcgYQp3YWxrIG92ZXIgYm90aCBsaXN0
cyBsb29raW5nIGZvciBhbnkgY2FuZGlkYXRlcy4gSWYgdGhlcmUgYXJlIG5vbmUsIGFuZApzaW5j
ZSB3ZSBhcmUgc2hyaW5raW5nIHdlIGNhbiByZWFzb25hYmx5IGFzc3VtZSB0aGF0IHRoZSBsaXN0
cyBhcmUKZnVsbCEsIHRoaXMgYmVjb21lcyBhIHZlcnkgc2xvdyBmdXRpbGUgd2Fsay4KCklmIHdl
IHNlcGFyYXRlIG91dCB0aGUgcHVyZ2VhYmxlIG9iamVjdHMgaW50byBvd24gbGlzdCwgdGhpcyBz
ZWFyY2ggdGhlbgpiZWNvbWVzIGl0cyBvd24gcGhhc2UgdGhhdCBpcyBwcmVmZXJlbnRpYWxseSBo
YW5kbGVkIGR1cmluZyBzaHJpbmtpbmcuCkluc3RlYWQgdGhlIGNvc3QgYmVjb21lcyB0aGF0IHdl
IHRoZW4gbmVlZCB0byBmaWx0ZXIgdGhlIHB1cmdlYWJsZSBsaXN0CmlmIHdlIHdhbnQgdG8gZGlz
dGluZ3Vpc2ggYmV0d2VlbiBib3VuZCBhbmQgdW5ib3VuZCBvYmplY3RzLgoKU2lnbmVkLW9mZi1i
eTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBKb29uYXMgTGFo
dGluZW4gPGpvb25hcy5sYWh0aW5lbkBsaW51eC5pbnRlbC5jb20+CkNjOiBNYXR0aGV3IEF1bGQg
PG1hdHRoZXcud2lsbGlhbS5hdWxkQGdtYWlsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fZG9tYWluLmMgICB8IDE0ICsrKysrKysrLS0tLS0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaG1lbS5jICAgIHwgIDQgKy0tLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMgfCAyMiArKysrKysrKystLS0tLS0tLS0t
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAgICAgICAgICAgICAgfCAxNiArKysr
KysrKy0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyAgICAgICAgICAgICAg
fCAyMCArKysrKysrKysrKysrKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMg
ICAgICAgICAgICAgIHwgIDMgKystCiA2IGZpbGVzIGNoYW5nZWQsIDUwIGluc2VydGlvbnMoKyks
IDI5IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9kb21haW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21h
aW4uYwppbmRleCBjY2U5NmU2YzZlNTIuLjUyYjczZTkwYzlmNCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYwpAQCAtNDYyLDcgKzQ2Miw2IEBAIGk5MTVfZ2Vt
X29iamVjdF9waW5fdG9fZGlzcGxheV9wbGFuZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqLAogc3RhdGljIHZvaWQgaTkxNV9nZW1fb2JqZWN0X2J1bXBfaW5hY3RpdmVfZ2d0dChzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gdG9faTkxNShvYmotPmJhc2UuZGV2KTsKLQlzdHJ1Y3QgbGlzdF9oZWFkICpsaXN0
OwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCiAJR0VNX0JVR19PTighaTkxNV9nZW1fb2JqZWN0
X2hhc19waW5uZWRfcGFnZXMob2JqKSk7CkBAIC00NzYsMTAgKzQ3NSwxNSBAQCBzdGF0aWMgdm9p
ZCBpOTE1X2dlbV9vYmplY3RfYnVtcF9pbmFjdGl2ZV9nZ3R0KHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmopCiAJfQogCW11dGV4X3VubG9jaygmaTkxNS0+Z2d0dC52bS5tdXRleCk7CiAK
LQlzcGluX2xvY2soJmk5MTUtPm1tLm9ial9sb2NrKTsKLQlsaXN0ID0gb2JqLT5iaW5kX2NvdW50
ID8gJmk5MTUtPm1tLmJvdW5kX2xpc3QgOiAmaTkxNS0+bW0udW5ib3VuZF9saXN0OwotCWxpc3Rf
bW92ZV90YWlsKCZvYmotPm1tLmxpbmssIGxpc3QpOwotCXNwaW5fdW5sb2NrKCZpOTE1LT5tbS5v
YmpfbG9jayk7CisJaWYgKG9iai0+bW0ubWFkdiA9PSBJOTE1X01BRFZfV0lMTE5FRUQpIHsKKwkJ
c3RydWN0IGxpc3RfaGVhZCAqbGlzdDsKKworCQlzcGluX2xvY2soJmk5MTUtPm1tLm9ial9sb2Nr
KTsKKwkJbGlzdCA9IG9iai0+YmluZF9jb3VudCA/CisJCQkmaTkxNS0+bW0uYm91bmRfbGlzdCA6
ICZpOTE1LT5tbS51bmJvdW5kX2xpc3Q7CisJCWxpc3RfbW92ZV90YWlsKCZvYmotPm1tLmxpbmss
IGxpc3QpOworCQlzcGluX3VubG9jaygmaTkxNS0+bW0ub2JqX2xvY2spOworCX0KIH0KIAogdm9p
ZApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3NobWVtLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2htZW0uYwppbmRleCA2NjVmMjJl
YmY4ZTguLjE5ZDllY2RiMjg5NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX3NobWVtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X3NobWVtLmMKQEAgLTgwLDkgKzgwLDcgQEAgc3RhdGljIGludCBzaG1lbV9nZXRfcGFnZXMoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAlzZ19wYWdlX3NpemVzID0gMDsKIAlmb3Ig
KGkgPSAwOyBpIDwgcGFnZV9jb3VudDsgaSsrKSB7CiAJCWNvbnN0IHVuc2lnbmVkIGludCBzaHJp
bmtbXSA9IHsKLQkJCShJOTE1X1NIUklOS19CT1VORCB8Ci0JCQkgSTkxNV9TSFJJTktfVU5CT1VO
RCB8Ci0JCQkgSTkxNV9TSFJJTktfUFVSR0VBQkxFKSwKKwkJCUk5MTVfU0hSSU5LX0JPVU5EIHwg
STkxNV9TSFJJTktfVU5CT1VORCwKIAkJCTAsCiAJCX0sICpzID0gc2hyaW5rOwogCQlnZnBfdCBn
ZnAgPSBub3JlY2xhaW07CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fc2hyaW5rZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJp
bmtlci5jCmluZGV4IGNkNDIyOTlmMDE5YS4uNmE5M2UzMjZhYmYzIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYwpAQCAtMTQ0LDYgKzE0NCw3IEBAIGk5
MTVfZ2VtX3NocmluayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJc3RydWN0IGxp
c3RfaGVhZCAqbGlzdDsKIAkJdW5zaWduZWQgaW50IGJpdDsKIAl9IHBoYXNlc1tdID0geworCQl7
ICZpOTE1LT5tbS5wdXJnZV9saXN0LCB+MHUgfSwKIAkJeyAmaTkxNS0+bW0udW5ib3VuZF9saXN0
LCBJOTE1X1NIUklOS19VTkJPVU5EIH0sCiAJCXsgJmk5MTUtPm1tLmJvdW5kX2xpc3QsIEk5MTVf
U0hSSU5LX0JPVU5EIH0sCiAJCXsgTlVMTCwgMCB9LApAQCAtMjI2LDEwICsyMjcsNiBAQCBpOTE1
X2dlbV9zaHJpbmsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJCQkgICAgICAg
bW0ubGluaykpKSB7CiAJCQlsaXN0X21vdmVfdGFpbCgmb2JqLT5tbS5saW5rLCAmc3RpbGxfaW5f
bGlzdCk7CiAKLQkJCWlmIChmbGFncyAmIEk5MTVfU0hSSU5LX1BVUkdFQUJMRSAmJgotCQkJICAg
IG9iai0+bW0ubWFkdiAhPSBJOTE1X01BRFZfRE9OVE5FRUQpCi0JCQkJY29udGludWU7Ci0KIAkJ
CWlmIChmbGFncyAmIEk5MTVfU0hSSU5LX1ZNQVBTICYmCiAJCQkgICAgIWlzX3ZtYWxsb2NfYWRk
cihvYmotPm1tLm1hcHBpbmcpKQogCQkJCWNvbnRpbnVlOwpAQCAtMjM5LDYgKzIzNiwxMCBAQCBp
OTE1X2dlbV9zaHJpbmsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgIGk5
MTVfZ2VtX29iamVjdF9pc19mcmFtZWJ1ZmZlcihvYmopKSkKIAkJCQljb250aW51ZTsKIAorCQkJ
aWYgKCEoZmxhZ3MgJiBJOTE1X1NIUklOS19CT1VORCkgJiYKKwkJCSAgICBSRUFEX09OQ0Uob2Jq
LT5iaW5kX2NvdW50KSkKKwkJCQljb250aW51ZTsKKwogCQkJaWYgKCFjYW5fcmVsZWFzZV9wYWdl
cyhvYmopKQogCQkJCWNvbnRpbnVlOwogCkBAIC0zMjQsNiArMzI1LDExIEBAIGk5MTVfZ2VtX3No
cmlua2VyX2NvdW50KHN0cnVjdCBzaHJpbmtlciAqc2hyaW5rZXIsIHN0cnVjdCBzaHJpbmtfY29u
dHJvbCAqc2MpCiAJCQljb3VudCArPSBvYmotPmJhc2Uuc2l6ZSA+PiBQQUdFX1NISUZUOwogCQkJ
bnVtX29iamVjdHMrKzsKIAkJfQorCWxpc3RfZm9yX2VhY2hfZW50cnkob2JqLCAmaTkxNS0+bW0u
cHVyZ2VfbGlzdCwgbW0ubGluaykKKwkJaWYgKCFpOTE1X2dlbV9vYmplY3RfaXNfYWN0aXZlKG9i
aikgJiYgY2FuX3JlbGVhc2VfcGFnZXMob2JqKSkgeworCQkJY291bnQgKz0gb2JqLT5iYXNlLnNp
emUgPj4gUEFHRV9TSElGVDsKKwkJCW51bV9vYmplY3RzKys7CisJCX0KIAlzcGluX3VubG9jaygm
aTkxNS0+bW0ub2JqX2xvY2spOwogCiAJLyogVXBkYXRlIG91ciBwcmVmZXJyZWQgdm1zY2FuIGJh
dGNoIHNpemUgZm9yIHRoZSBuZXh0IHBhc3MuCkBAIC0zNjEsMTUgKzM2Nyw3IEBAIGk5MTVfZ2Vt
X3Nocmlua2VyX3NjYW4oc3RydWN0IHNocmlua2VyICpzaHJpbmtlciwgc3RydWN0IHNocmlua19j
b250cm9sICpzYykKIAkJCQkmc2MtPm5yX3NjYW5uZWQsCiAJCQkJSTkxNV9TSFJJTktfQk9VTkQg
fAogCQkJCUk5MTVfU0hSSU5LX1VOQk9VTkQgfAotCQkJCUk5MTVfU0hSSU5LX1BVUkdFQUJMRSB8
CiAJCQkJSTkxNV9TSFJJTktfV1JJVEVCQUNLKTsKLQlpZiAoc2MtPm5yX3NjYW5uZWQgPCBzYy0+
bnJfdG9fc2NhbikKLQkJZnJlZWQgKz0gaTkxNV9nZW1fc2hyaW5rKGk5MTUsCi0JCQkJCSBzYy0+
bnJfdG9fc2NhbiAtIHNjLT5ucl9zY2FubmVkLAotCQkJCQkgJnNjLT5ucl9zY2FubmVkLAotCQkJ
CQkgSTkxNV9TSFJJTktfQk9VTkQgfAotCQkJCQkgSTkxNV9TSFJJTktfVU5CT1VORCB8Ci0JCQkJ
CSBJOTE1X1NIUklOS19XUklURUJBQ0spOwogCWlmIChzYy0+bnJfc2Nhbm5lZCA8IHNjLT5ucl90
b19zY2FuICYmIGN1cnJlbnRfaXNfa3N3YXBkKCkpIHsKIAkJaW50ZWxfd2FrZXJlZl90IHdha2Vy
ZWY7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCmluZGV4IDRlYjhmNmExODFjMS4uZmIyZTg5MTMz
ZTc4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKQEAgLTg2NCw2ICs4NjQsMTAgQEAgc3RydWN0
IGk5MTVfZ2VtX21tIHsKIAkgKiBub3QgYWN0dWFsbHkgaGF2ZSBhbnkgcGFnZXMgYXR0YWNoZWQu
CiAJICovCiAJc3RydWN0IGxpc3RfaGVhZCB1bmJvdW5kX2xpc3Q7CisJLyoqCisJICogTGlzdCBv
ZiBvYmplY3RzIHdoaWNoIGFyZSBwdXJnZWFibGUuIE1heSBiZSBhY3RpdmUuCisJICovCisJc3Ry
dWN0IGxpc3RfaGVhZCBwdXJnZV9saXN0OwogCiAJLyoqIExpc3Qgb2YgYWxsIG9iamVjdHMgaW4g
Z3R0X3NwYWNlLCBjdXJyZW50bHkgbW1hcGVkIGJ5IHVzZXJzcGFjZS4KIAkgKiBBbGwgb2JqZWN0
cyB3aXRoaW4gdGhpcyBsaXN0IG11c3QgYWxzbyBiZSBvbiBib3VuZF9saXN0LgpAQCAtMjg2Niwx
MiArMjg3MCwxMiBAQCB1bnNpZ25lZCBsb25nIGk5MTVfZ2VtX3NocmluayhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCSAgICAgIHVuc2lnbmVkIGxvbmcgdGFyZ2V0LAogCQkJICAg
ICAgdW5zaWduZWQgbG9uZyAqbnJfc2Nhbm5lZCwKIAkJCSAgICAgIHVuc2lnbmVkIGZsYWdzKTsK
LSNkZWZpbmUgSTkxNV9TSFJJTktfUFVSR0VBQkxFCUJJVCgwKQotI2RlZmluZSBJOTE1X1NIUklO
S19VTkJPVU5ECUJJVCgxKQotI2RlZmluZSBJOTE1X1NIUklOS19CT1VORAlCSVQoMikKLSNkZWZp
bmUgSTkxNV9TSFJJTktfQUNUSVZFCUJJVCgzKQotI2RlZmluZSBJOTE1X1NIUklOS19WTUFQUwlC
SVQoNCkKLSNkZWZpbmUgSTkxNV9TSFJJTktfV1JJVEVCQUNLCUJJVCg1KQorI2RlZmluZSBJOTE1
X1NIUklOS19VTkJPVU5ECUJJVCgwKQorI2RlZmluZSBJOTE1X1NIUklOS19CT1VORAlCSVQoMSkK
KyNkZWZpbmUgSTkxNV9TSFJJTktfQUNUSVZFCUJJVCgyKQorI2RlZmluZSBJOTE1X1NIUklOS19W
TUFQUwlCSVQoMykKKyNkZWZpbmUgSTkxNV9TSFJJTktfV1JJVEVCQUNLCUJJVCg0KQorCiB1bnNp
Z25lZCBsb25nIGk5MTVfZ2VtX3Nocmlua19hbGwoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpOwogdm9pZCBpOTE1X2dlbV9zaHJpbmtlcl9yZWdpc3RlcihzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSk7CiB2b2lkIGk5MTVfZ2VtX3Nocmlua2VyX3VucmVnaXN0ZXIoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKaW5kZXggZTVhYWZi
ZWIxZDE5Li5kOThjY2JiZGU1M2MgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwpAQCAtMTA5NSw3
ICsxMDk1LDcgQEAgaW50CiBpOTE1X2dlbV9tYWR2aXNlX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNl
ICpkZXYsIHZvaWQgKmRhdGEsCiAJCSAgICAgICBzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGVfcHJpdikK
IHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KGRldik7CiAJc3RydWN0IGRy
bV9pOTE1X2dlbV9tYWR2aXNlICphcmdzID0gZGF0YTsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqOwogCWludCBlcnI7CkBAIC0xMTE4LDcgKzExMTgsNyBAQCBpOTE1X2dlbV9tYWR2
aXNlX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAKIAlpZiAoaTkx
NV9nZW1fb2JqZWN0X2hhc19wYWdlcyhvYmopICYmCiAJICAgIGk5MTVfZ2VtX29iamVjdF9pc190
aWxlZChvYmopICYmCi0JICAgIGRldl9wcml2LT5xdWlya3MgJiBRVUlSS19QSU5fU1dJWlpMRURf
UEFHRVMpIHsKKwkgICAgaTkxNS0+cXVpcmtzICYgUVVJUktfUElOX1NXSVpaTEVEX1BBR0VTKSB7
CiAJCWlmIChvYmotPm1tLm1hZHYgPT0gSTkxNV9NQURWX1dJTExORUVEKSB7CiAJCQlHRU1fQlVH
X09OKCFvYmotPm1tLnF1aXJrZWQpOwogCQkJX19pOTE1X2dlbV9vYmplY3RfdW5waW5fcGFnZXMo
b2JqKTsKQEAgLTExMzQsNiArMTEzNCwyMCBAQCBpOTE1X2dlbV9tYWR2aXNlX2lvY3RsKHN0cnVj
dCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJaWYgKG9iai0+bW0ubWFkdiAhPSBfX0k5
MTVfTUFEVl9QVVJHRUQpCiAJCW9iai0+bW0ubWFkdiA9IGFyZ3MtPm1hZHY7CiAKKwlpZiAoaTkx
NV9nZW1fb2JqZWN0X2hhc19wYWdlcyhvYmopKSB7CisJCXN0cnVjdCBsaXN0X2hlYWQgKmxpc3Q7
CisKKwkJc3Bpbl9sb2NrKCZpOTE1LT5tbS5vYmpfbG9jayk7CisJCWlmIChvYmotPm1tLm1hZHYg
IT0gSTkxNV9NQURWX1dJTExORUVEKQorCQkJbGlzdCA9ICZpOTE1LT5tbS5wdXJnZV9saXN0Owor
CQllbHNlIGlmIChvYmotPmJpbmRfY291bnQpCisJCQlsaXN0ID0gJmk5MTUtPm1tLmJvdW5kX2xp
c3Q7CisJCWVsc2UKKwkJCWxpc3QgPSAmaTkxNS0+bW0udW5ib3VuZF9saXN0OworCQlsaXN0X21v
dmVfdGFpbCgmb2JqLT5tbS5saW5rLCBsaXN0KTsKKwkJc3Bpbl91bmxvY2soJmk5MTUtPm1tLm9i
al9sb2NrKTsKKwl9CisKIAkvKiBpZiB0aGUgb2JqZWN0IGlzIG5vIGxvbmdlciBhdHRhY2hlZCwg
ZGlzY2FyZCBpdHMgYmFja2luZyBzdG9yYWdlICovCiAJaWYgKG9iai0+bW0ubWFkdiA9PSBJOTE1
X01BRFZfRE9OVE5FRUQgJiYKIAkgICAgIWk5MTVfZ2VtX29iamVjdF9oYXNfcGFnZXMob2JqKSkK
QEAgLTE3NDIsNiArMTc1Niw3IEBAIHN0YXRpYyB2b2lkIGk5MTVfZ2VtX2luaXRfX21tKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCiAJaW5pdF9sbGlzdF9oZWFkKCZpOTE1LT5tbS5m
cmVlX2xpc3QpOwogCisJSU5JVF9MSVNUX0hFQUQoJmk5MTUtPm1tLnB1cmdlX2xpc3QpOwogCUlO
SVRfTElTVF9IRUFEKCZpOTE1LT5tbS51bmJvdW5kX2xpc3QpOwogCUlOSVRfTElTVF9IRUFEKCZp
OTE1LT5tbS5ib3VuZF9saXN0KTsKIAlJTklUX0xJU1RfSEVBRCgmaTkxNS0+bW0uZmVuY2VfbGlz
dCk7CkBAIC0xODM2LDYgKzE4NTEsNyBAQCBpbnQgaTkxNV9nZW1fZnJlZXplX2xhdGUoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJCQlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKG9iaik7
CiAJCX0KIAl9CisJR0VNX0JVR19PTighbGlzdF9lbXB0eSgmaTkxNS0+bW0ucHVyZ2VfbGlzdCkp
OwogCiAJcmV0dXJuIDA7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3ZtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwppbmRleCA1OWEyZjZhZjYx
MDMuLmY2NDBjYWVjNGJhZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92
bWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCkBAIC03MTcsNyArNzE3
LDggQEAgaTkxNV92bWFfcmVtb3ZlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCQlzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqID0gdm1hLT5vYmo7CiAKIAkJc3Bpbl9sb2NrKCZpOTE1LT5t
bS5vYmpfbG9jayk7Ci0JCWlmICgtLW9iai0+YmluZF9jb3VudCA9PSAwKQorCQlpZiAoLS1vYmot
PmJpbmRfY291bnQgPT0gMCAmJgorCQkgICAgb2JqLT5tbS5tYWR2ID09IEk5MTVfTUFEVl9XSUxM
TkVFRCkKIAkJCWxpc3RfbW92ZV90YWlsKCZvYmotPm1tLmxpbmssICZpOTE1LT5tbS51bmJvdW5k
X2xpc3QpOwogCQlzcGluX3VubG9jaygmaTkxNS0+bW0ub2JqX2xvY2spOwogCi0tIAoyLjIwLjEK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdm
eCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xp
c3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

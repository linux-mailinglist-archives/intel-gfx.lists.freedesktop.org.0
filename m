Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 800D22FCDC9
	for <lists+intel-gfx@lfdr.de>; Wed, 20 Jan 2021 11:19:00 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CDF016E159;
	Wed, 20 Jan 2021 10:18:58 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga02.intel.com (mga02.intel.com [134.134.136.20])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B94CB6E159
 for <intel-gfx@lists.freedesktop.org>; Wed, 20 Jan 2021 10:18:57 +0000 (UTC)
IronPort-SDR: fG0UkA16t2caO1PXZyCITWNK4zpnEXH9iKPvx/9p0lN1ge/2AB5JfVyTH4yG2BaZO8oJUOySmX
 /kmRttkMI4Zg==
X-IronPort-AV: E=McAfee;i="6000,8403,9869"; a="166172298"
X-IronPort-AV: E=Sophos;i="5.79,360,1602572400"; d="scan'208";a="166172298"
Received: from fmsmga008.fm.intel.com ([10.253.24.58])
 by orsmga101.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 20 Jan 2021 02:18:56 -0800
IronPort-SDR: 2K1Y27AdhLgHGxjjHouyP2JuRKfJCE1uKIuxBxsJQ4X+zg1MLgrhUeWtk50zoV6f8zf6olhtvL
 liyjBXvCggeA==
X-IronPort-AV: E=Sophos;i="5.79,360,1602572400"; d="scan'208";a="355998573"
Received: from oreunova-mobl1.ccr.corp.intel.com (HELO localhost)
 ([10.252.45.61])
 by fmsmga008-auth.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 20 Jan 2021 02:18:54 -0800
From: Jani Nikula <jani.nikula@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 20 Jan 2021 12:18:34 +0200
Message-Id: <20210120101834.19813-4-jani.nikula@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20210120101834.19813-1-jani.nikula@intel.com>
References: <20210120101834.19813-1-jani.nikula@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 4/4] drm/i915/dp: split out aux functionality to
 intel_dp_aux.c
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U3BsaXQgb3V0IHRoZSBEUCBhdXggZnVuY3Rpb25hbGl0eSB0byBhIG5ldyBpbnRlbF9kcF9hdXgu
W2NoXS4gVGhpcyBpcyBhCnN1cnByaXNpbmdseSBjbGVhbiBjdXQuCgp2MjoKLSBSZW1vdmUgaW50
ZWxfZHBfcGFja19hdXggZGVjbGFyYXRpb24gZnJvbSBpbnRlbF9kcC5oIChBbnNodW1hbikKLSBG
aXhlZCBzb21lIHdoaXRlc3BhY2UvY29tbWVudCBjaGVja3BhdGNoIHdhcm5pbmdzCgpDYzogQW5z
aHVtYW4gR3VwdGEgPGFuc2h1bWFuLmd1cHRhQGludGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogSmFu
aSBOaWt1bGEgPGphbmkubmlrdWxhQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9NYWtlZmlsZSAgICAgICAgICAgICAgIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZHAuYyAgICAgfCA2ODAgKy0tLS0tLS0tLS0tLS0tLS0tLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5oICAgICB8ICAgMSAtCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX2F1eC5jIHwgNjkyICsrKysrKysrKysrKysrKysrKysr
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX2F1eC5oIHwgIDE4ICsKIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmMgICAgfCAgIDMgKy0KIDYgZmls
ZXMgY2hhbmdlZCwgNzE0IGluc2VydGlvbnMoKyksIDY4MSBkZWxldGlvbnMoLSkKIGNyZWF0ZSBt
b2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX2F1eC5jCiBj
cmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9h
dXguaAoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKaW5kZXggMDA2ZGVjNTQ0MDhkLi5lYTFjYzU3MzYwNDkg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L01ha2VmaWxlCkBAIC0yNDMsNiArMjQzLDcgQEAgaTkxNS15ICs9IFwKIAlk
aXNwbGF5L2ludGVsX2NydC5vIFwKIAlkaXNwbGF5L2ludGVsX2RkaS5vIFwKIAlkaXNwbGF5L2lu
dGVsX2RwLm8gXAorCWRpc3BsYXkvaW50ZWxfZHBfYXV4Lm8gXAogCWRpc3BsYXkvaW50ZWxfZHBf
YXV4X2JhY2tsaWdodC5vIFwKIAlkaXNwbGF5L2ludGVsX2RwX2hkY3AubyBcCiAJZGlzcGxheS9p
bnRlbF9kcF9saW5rX3RyYWluaW5nLm8gXApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kcC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kcC5jCmluZGV4IGQ4MTUwODdhMjZhYS4uODk3OTk5NmYxNzQ3IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCkBAIC00MSwxMyArNDEsMTMgQEAKIAogI2luY2x1ZGUg
Imk5MTVfZGVidWdmcy5oIgogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCi0jaW5jbHVkZSAiaTkxNV90
cmFjZS5oIgogI2luY2x1ZGUgImludGVsX2F0b21pYy5oIgogI2luY2x1ZGUgImludGVsX2F1ZGlv
LmgiCiAjaW5jbHVkZSAiaW50ZWxfY29ubmVjdG9yLmgiCiAjaW5jbHVkZSAiaW50ZWxfZGRpLmgi
CiAjaW5jbHVkZSAiaW50ZWxfZGlzcGxheV90eXBlcy5oIgogI2luY2x1ZGUgImludGVsX2RwLmgi
CisjaW5jbHVkZSAiaW50ZWxfZHBfYXV4LmgiCiAjaW5jbHVkZSAiaW50ZWxfZHBfbGlua190cmFp
bmluZy5oIgogI2luY2x1ZGUgImludGVsX2RwX21zdC5oIgogI2luY2x1ZGUgImludGVsX2RwaW9f
cGh5LmgiCkBAIC04NjIsNjg0ICs4NjIsNiBAQCBpbnRlbF9kcF9tb2RlX3ZhbGlkKHN0cnVjdCBk
cm1fY29ubmVjdG9yICpjb25uZWN0b3IsCiAJcmV0dXJuIGludGVsX21vZGVfdmFsaWRfbWF4X3Bs
YW5lX3NpemUoZGV2X3ByaXYsIG1vZGUsIGJpZ2pvaW5lcik7CiB9CiAKLXUzMiBpbnRlbF9kcF9w
YWNrX2F1eChjb25zdCB1OCAqc3JjLCBpbnQgc3JjX2J5dGVzKQotewotCWludCBpOwotCXUzMiB2
ID0gMDsKLQotCWlmIChzcmNfYnl0ZXMgPiA0KQotCQlzcmNfYnl0ZXMgPSA0OwotCWZvciAoaSA9
IDA7IGkgPCBzcmNfYnl0ZXM7IGkrKykKLQkJdiB8PSAoKHUzMilzcmNbaV0pIDw8ICgoMyAtIGkp
ICogOCk7Ci0JcmV0dXJuIHY7Ci19Ci0KLXN0YXRpYyB2b2lkIGludGVsX2RwX3VucGFja19hdXgo
dTMyIHNyYywgdTggKmRzdCwgaW50IGRzdF9ieXRlcykKLXsKLQlpbnQgaTsKLQlpZiAoZHN0X2J5
dGVzID4gNCkKLQkJZHN0X2J5dGVzID0gNDsKLQlmb3IgKGkgPSAwOyBpIDwgZHN0X2J5dGVzOyBp
KyspCi0JCWRzdFtpXSA9IHNyYyA+PiAoKDMtaSkgKiA4KTsKLX0KLQotc3RhdGljIHUzMgotaW50
ZWxfZHBfYXV4X3dhaXRfZG9uZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQotewotCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7Ci0JaTkxNV9y
ZWdfdCBjaF9jdGwgPSBpbnRlbF9kcC0+YXV4X2NoX2N0bF9yZWcoaW50ZWxfZHApOwotCWNvbnN0
IHVuc2lnbmVkIGludCB0aW1lb3V0X21zID0gMTA7Ci0JdTMyIHN0YXR1czsKLQlib29sIGRvbmU7
Ci0KLSNkZWZpbmUgQyAoKChzdGF0dXMgPSBpbnRlbF91bmNvcmVfcmVhZF9ub3RyYWNlKCZpOTE1
LT51bmNvcmUsIGNoX2N0bCkpICYgRFBfQVVYX0NIX0NUTF9TRU5EX0JVU1kpID09IDApCi0JZG9u
ZSA9IHdhaXRfZXZlbnRfdGltZW91dChpOTE1LT5nbWJ1c193YWl0X3F1ZXVlLCBDLAotCQkJCSAg
bXNlY3NfdG9famlmZmllc190aW1lb3V0KHRpbWVvdXRfbXMpKTsKLQotCS8qIGp1c3QgdHJhY2Ug
dGhlIGZpbmFsIHZhbHVlICovCi0JdHJhY2VfaTkxNV9yZWdfcncoZmFsc2UsIGNoX2N0bCwgc3Rh
dHVzLCBzaXplb2Yoc3RhdHVzKSwgdHJ1ZSk7Ci0KLQlpZiAoIWRvbmUpCi0JCWRybV9lcnIoJmk5
MTUtPmRybSwKLQkJCSIlczogZGlkIG5vdCBjb21wbGV0ZSBvciB0aW1lb3V0IHdpdGhpbiAldW1z
IChzdGF0dXMgMHglMDh4KVxuIiwKLQkJCWludGVsX2RwLT5hdXgubmFtZSwgdGltZW91dF9tcywg
c3RhdHVzKTsKLSN1bmRlZiBDCi0KLQlyZXR1cm4gc3RhdHVzOwotfQotCi1zdGF0aWMgdTMyIGc0
eF9nZXRfYXV4X2Nsb2NrX2RpdmlkZXIoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwgaW50IGlu
ZGV4KQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUo
aW50ZWxfZHApOwotCi0JaWYgKGluZGV4KQotCQlyZXR1cm4gMDsKLQotCS8qCi0JICogVGhlIGNs
b2NrIGRpdmlkZXIgaXMgYmFzZWQgb2ZmIHRoZSBocmF3Y2xrLCBhbmQgd291bGQgbGlrZSB0byBy
dW4gYXQKLQkgKiAyTUh6LiAgU28sIHRha2UgdGhlIGhyYXdjbGsgdmFsdWUgYW5kIGRpdmlkZSBi
eSAyMDAwIGFuZCB1c2UgdGhhdAotCSAqLwotCXJldHVybiBESVZfUk9VTkRfQ0xPU0VTVChSVU5U
SU1FX0lORk8oZGV2X3ByaXYpLT5yYXdjbGtfZnJlcSwgMjAwMCk7Ci19Ci0KLXN0YXRpYyB1MzIg
aWxrX2dldF9hdXhfY2xvY2tfZGl2aWRlcihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCBpbnQg
aW5kZXgpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkx
NShpbnRlbF9kcCk7Ci0Jc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90
b19kaWdfcG9ydChpbnRlbF9kcCk7Ci0JdTMyIGZyZXE7Ci0KLQlpZiAoaW5kZXgpCi0JCXJldHVy
biAwOwotCi0JLyoKLQkgKiBUaGUgY2xvY2sgZGl2aWRlciBpcyBiYXNlZCBvZmYgdGhlIGNkY2xr
IG9yIFBDSCByYXdjbGssIGFuZCB3b3VsZAotCSAqIGxpa2UgdG8gcnVuIGF0IDJNSHouICBTbywg
dGFrZSB0aGUgY2RjbGsgb3IgUENIIHJhd2NsayB2YWx1ZSBhbmQKLQkgKiBkaXZpZGUgYnkgMjAw
MCBhbmQgdXNlIHRoYXQKLQkgKi8KLQlpZiAoZGlnX3BvcnQtPmF1eF9jaCA9PSBBVVhfQ0hfQSkK
LQkJZnJlcSA9IGRldl9wcml2LT5jZGNsay5ody5jZGNsazsKLQllbHNlCi0JCWZyZXEgPSBSVU5U
SU1FX0lORk8oZGV2X3ByaXYpLT5yYXdjbGtfZnJlcTsKLQlyZXR1cm4gRElWX1JPVU5EX0NMT1NF
U1QoZnJlcSwgMjAwMCk7Ci19Ci0KLXN0YXRpYyB1MzIgaHN3X2dldF9hdXhfY2xvY2tfZGl2aWRl
cihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCBpbnQgaW5kZXgpCi17Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7Ci0Jc3RydWN0IGlu
dGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7Ci0K
LQlpZiAoZGlnX3BvcnQtPmF1eF9jaCAhPSBBVVhfQ0hfQSAmJiBIQVNfUENIX0xQVF9IKGRldl9w
cml2KSkgewotCQkvKiBXb3JrYXJvdW5kIGZvciBub24tVUxUIEhTVyAqLwotCQlzd2l0Y2ggKGlu
ZGV4KSB7Ci0JCWNhc2UgMDogcmV0dXJuIDYzOwotCQljYXNlIDE6IHJldHVybiA3MjsKLQkJZGVm
YXVsdDogcmV0dXJuIDA7Ci0JCX0KLQl9Ci0KLQlyZXR1cm4gaWxrX2dldF9hdXhfY2xvY2tfZGl2
aWRlcihpbnRlbF9kcCwgaW5kZXgpOwotfQotCi1zdGF0aWMgdTMyIHNrbF9nZXRfYXV4X2Nsb2Nr
X2RpdmlkZXIoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwgaW50IGluZGV4KQotewotCS8qCi0J
ICogU0tMIGRvZXNuJ3QgbmVlZCB1cyB0byBwcm9ncmFtIHRoZSBBVVggY2xvY2sgZGl2aWRlciAo
SGFyZHdhcmUgd2lsbAotCSAqIGRlcml2ZSB0aGUgY2xvY2sgZnJvbSBDRENMSyBhdXRvbWF0aWNh
bGx5KS4gV2Ugc3RpbGwgaW1wbGVtZW50IHRoZQotCSAqIGdldF9hdXhfY2xvY2tfZGl2aWRlciB2
ZnVuYyB0byBwbHVnLWluIGludG8gdGhlIGV4aXN0aW5nIGNvZGUuCi0JICovCi0JcmV0dXJuIGlu
ZGV4ID8gMCA6IDE7Ci19Ci0KLXN0YXRpYyB1MzIgZzR4X2dldF9hdXhfc2VuZF9jdGwoc3RydWN0
IGludGVsX2RwICppbnRlbF9kcCwKLQkJCQlpbnQgc2VuZF9ieXRlcywKLQkJCQl1MzIgYXV4X2Ns
b2NrX2RpdmlkZXIpCi17Ci0Jc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBk
cF90b19kaWdfcG9ydChpbnRlbF9kcCk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0KLQkJCXRvX2k5MTUoZGlnX3BvcnQtPmJhc2UuYmFzZS5kZXYpOwotCXUzMiBwcmVjaGFy
Z2UsIHRpbWVvdXQ7Ci0KLQlpZiAoSVNfR0VOKGRldl9wcml2LCA2KSkKLQkJcHJlY2hhcmdlID0g
MzsKLQllbHNlCi0JCXByZWNoYXJnZSA9IDU7Ci0KLQlpZiAoSVNfQlJPQURXRUxMKGRldl9wcml2
KSkKLQkJdGltZW91dCA9IERQX0FVWF9DSF9DVExfVElNRV9PVVRfNjAwdXM7Ci0JZWxzZQotCQl0
aW1lb3V0ID0gRFBfQVVYX0NIX0NUTF9USU1FX09VVF80MDB1czsKLQotCXJldHVybiBEUF9BVVhf
Q0hfQ1RMX1NFTkRfQlVTWSB8Ci0JICAgICAgIERQX0FVWF9DSF9DVExfRE9ORSB8Ci0JICAgICAg
IERQX0FVWF9DSF9DVExfSU5URVJSVVBUIHwKLQkgICAgICAgRFBfQVVYX0NIX0NUTF9USU1FX09V
VF9FUlJPUiB8Ci0JICAgICAgIHRpbWVvdXQgfAotCSAgICAgICBEUF9BVVhfQ0hfQ1RMX1JFQ0VJ
VkVfRVJST1IgfAotCSAgICAgICAoc2VuZF9ieXRlcyA8PCBEUF9BVVhfQ0hfQ1RMX01FU1NBR0Vf
U0laRV9TSElGVCkgfAotCSAgICAgICAocHJlY2hhcmdlIDw8IERQX0FVWF9DSF9DVExfUFJFQ0hB
UkdFXzJVU19TSElGVCkgfAotCSAgICAgICAoYXV4X2Nsb2NrX2RpdmlkZXIgPDwgRFBfQVVYX0NI
X0NUTF9CSVRfQ0xPQ0tfMlhfU0hJRlQpOwotfQotCi1zdGF0aWMgdTMyIHNrbF9nZXRfYXV4X3Nl
bmRfY3RsKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCi0JCQkJaW50IHNlbmRfYnl0ZXMsCi0J
CQkJdTMyIHVudXNlZCkKLXsKLQlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCA9
IGRwX3RvX2RpZ19wb3J0KGludGVsX2RwKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSA9Ci0JCQl0b19pOTE1KGRpZ19wb3J0LT5iYXNlLmJhc2UuZGV2KTsKLQllbnVtIHBoeSBwaHkg
PSBpbnRlbF9wb3J0X3RvX3BoeShpOTE1LCBkaWdfcG9ydC0+YmFzZS5wb3J0KTsKLQl1MzIgcmV0
OwotCi0JcmV0ID0gRFBfQVVYX0NIX0NUTF9TRU5EX0JVU1kgfAotCSAgICAgIERQX0FVWF9DSF9D
VExfRE9ORSB8Ci0JICAgICAgRFBfQVVYX0NIX0NUTF9JTlRFUlJVUFQgfAotCSAgICAgIERQX0FV
WF9DSF9DVExfVElNRV9PVVRfRVJST1IgfAotCSAgICAgIERQX0FVWF9DSF9DVExfVElNRV9PVVRf
TUFYIHwKLQkgICAgICBEUF9BVVhfQ0hfQ1RMX1JFQ0VJVkVfRVJST1IgfAotCSAgICAgIChzZW5k
X2J5dGVzIDw8IERQX0FVWF9DSF9DVExfTUVTU0FHRV9TSVpFX1NISUZUKSB8Ci0JICAgICAgRFBf
QVVYX0NIX0NUTF9GV19TWU5DX1BVTFNFX1NLTCgzMikgfAotCSAgICAgIERQX0FVWF9DSF9DVExf
U1lOQ19QVUxTRV9TS0woMzIpOwotCi0JaWYgKGludGVsX3BoeV9pc190YyhpOTE1LCBwaHkpICYm
Ci0JICAgIGRpZ19wb3J0LT50Y19tb2RlID09IFRDX1BPUlRfVEJUX0FMVCkKLQkJcmV0IHw9IERQ
X0FVWF9DSF9DVExfVEJUX0lPOwotCi0JcmV0dXJuIHJldDsKLX0KLQotc3RhdGljIGludAotaW50
ZWxfZHBfYXV4X3hmZXIoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKLQkJICBjb25zdCB1OCAq
c2VuZCwgaW50IHNlbmRfYnl0ZXMsCi0JCSAgdTggKnJlY3YsIGludCByZWN2X3NpemUsCi0JCSAg
dTMyIGF1eF9zZW5kX2N0bF9mbGFncykKLXsKLQlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpk
aWdfcG9ydCA9IGRwX3RvX2RpZ19wb3J0KGludGVsX2RwKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9Ci0JCQl0b19pOTE1KGRpZ19wb3J0LT5iYXNlLmJhc2UuZGV2KTsKLQlzdHJ1
Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUgPSAmaTkxNS0+dW5jb3JlOwotCWVudW0gcGh5IHBoeSA9
IGludGVsX3BvcnRfdG9fcGh5KGk5MTUsIGRpZ19wb3J0LT5iYXNlLnBvcnQpOwotCWJvb2wgaXNf
dGNfcG9ydCA9IGludGVsX3BoeV9pc190YyhpOTE1LCBwaHkpOwotCWk5MTVfcmVnX3QgY2hfY3Rs
LCBjaF9kYXRhWzVdOwotCXUzMiBhdXhfY2xvY2tfZGl2aWRlcjsKLQllbnVtIGludGVsX2Rpc3Bs
YXlfcG93ZXJfZG9tYWluIGF1eF9kb21haW47Ci0JaW50ZWxfd2FrZXJlZl90IGF1eF93YWtlcmVm
OwotCWludGVsX3dha2VyZWZfdCBwcHNfd2FrZXJlZjsKLQlpbnQgaSwgcmV0LCByZWN2X2J5dGVz
OwotCWludCB0cnksIGNsb2NrID0gMDsKLQl1MzIgc3RhdHVzOwotCWJvb2wgdmRkOwotCi0JY2hf
Y3RsID0gaW50ZWxfZHAtPmF1eF9jaF9jdGxfcmVnKGludGVsX2RwKTsKLQlmb3IgKGkgPSAwOyBp
IDwgQVJSQVlfU0laRShjaF9kYXRhKTsgaSsrKQotCQljaF9kYXRhW2ldID0gaW50ZWxfZHAtPmF1
eF9jaF9kYXRhX3JlZyhpbnRlbF9kcCwgaSk7Ci0KLQlpZiAoaXNfdGNfcG9ydCkKLQkJaW50ZWxf
dGNfcG9ydF9sb2NrKGRpZ19wb3J0KTsKLQotCWF1eF9kb21haW4gPSBpbnRlbF9hdXhfcG93ZXJf
ZG9tYWluKGRpZ19wb3J0KTsKLQotCWF1eF93YWtlcmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9n
ZXQoaTkxNSwgYXV4X2RvbWFpbik7Ci0JcHBzX3dha2VyZWYgPSBpbnRlbF9wcHNfbG9jayhpbnRl
bF9kcCk7Ci0KLQkvKgotCSAqIFdlIHdpbGwgYmUgY2FsbGVkIHdpdGggVkREIGFscmVhZHkgZW5h
YmxlZCBmb3IgZHBjZC9lZGlkL291aSByZWFkcy4KLQkgKiBJbiBzdWNoIGNhc2VzIHdlIHdhbnQg
dG8gbGVhdmUgVkREIGVuYWJsZWQgYW5kIGl0J3MgdXAgdG8gdXBwZXIgbGF5ZXJzCi0JICogdG8g
dHVybiBpdCBvZmYuIEJ1dCBmb3IgZWcuIGkyYy1kZXYgYWNjZXNzIHdlIG5lZWQgdG8gdHVybiBp
dCBvbi9vZmYKLQkgKiBvdXJzZWx2ZXMuCi0JICovCi0JdmRkID0gaW50ZWxfcHBzX3ZkZF9vbl91
bmxvY2tlZChpbnRlbF9kcCk7Ci0KLQkvKiBkcCBhdXggaXMgZXh0cmVtZWx5IHNlbnNpdGl2ZSB0
byBpcnEgbGF0ZW5jeSwgaGVuY2UgcmVxdWVzdCB0aGUKLQkgKiBsb3dlc3QgcG9zc2libGUgd2Fr
ZXVwIGxhdGVuY3kgYW5kIHNvIHByZXZlbnQgdGhlIGNwdSBmcm9tIGdvaW5nIGludG8KLQkgKiBk
ZWVwIHNsZWVwIHN0YXRlcy4KLQkgKi8KLQljcHVfbGF0ZW5jeV9xb3NfdXBkYXRlX3JlcXVlc3Qo
JmludGVsX2RwLT5wbV9xb3MsIDApOwotCi0JaW50ZWxfcHBzX2NoZWNrX3Bvd2VyX3VubG9ja2Vk
KGludGVsX2RwKTsKLQotCS8qIFRyeSB0byB3YWl0IGZvciBhbnkgcHJldmlvdXMgQVVYIGNoYW5u
ZWwgYWN0aXZpdHkgKi8KLQlmb3IgKHRyeSA9IDA7IHRyeSA8IDM7IHRyeSsrKSB7Ci0JCXN0YXR1
cyA9IGludGVsX3VuY29yZV9yZWFkX25vdHJhY2UodW5jb3JlLCBjaF9jdGwpOwotCQlpZiAoKHN0
YXR1cyAmIERQX0FVWF9DSF9DVExfU0VORF9CVVNZKSA9PSAwKQotCQkJYnJlYWs7Ci0JCW1zbGVl
cCgxKTsKLQl9Ci0JLyoganVzdCB0cmFjZSB0aGUgZmluYWwgdmFsdWUgKi8KLQl0cmFjZV9pOTE1
X3JlZ19ydyhmYWxzZSwgY2hfY3RsLCBzdGF0dXMsIHNpemVvZihzdGF0dXMpLCB0cnVlKTsKLQot
CWlmICh0cnkgPT0gMykgewotCQljb25zdCB1MzIgc3RhdHVzID0gaW50ZWxfdW5jb3JlX3JlYWQo
dW5jb3JlLCBjaF9jdGwpOwotCi0JCWlmIChzdGF0dXMgIT0gaW50ZWxfZHAtPmF1eF9idXN5X2xh
c3Rfc3RhdHVzKSB7Ci0JCQlkcm1fV0FSTigmaTkxNS0+ZHJtLCAxLAotCQkJCSAiJXM6IG5vdCBz
dGFydGVkIChzdGF0dXMgMHglMDh4KVxuIiwKLQkJCQkgaW50ZWxfZHAtPmF1eC5uYW1lLCBzdGF0
dXMpOwotCQkJaW50ZWxfZHAtPmF1eF9idXN5X2xhc3Rfc3RhdHVzID0gc3RhdHVzOwotCQl9Ci0K
LQkJcmV0ID0gLUVCVVNZOwotCQlnb3RvIG91dDsKLQl9Ci0KLQkvKiBPbmx5IDUgZGF0YSByZWdp
c3RlcnMhICovCi0JaWYgKGRybV9XQVJOX09OKCZpOTE1LT5kcm0sIHNlbmRfYnl0ZXMgPiAyMCB8
fCByZWN2X3NpemUgPiAyMCkpIHsKLQkJcmV0ID0gLUUyQklHOwotCQlnb3RvIG91dDsKLQl9Ci0K
LQl3aGlsZSAoKGF1eF9jbG9ja19kaXZpZGVyID0gaW50ZWxfZHAtPmdldF9hdXhfY2xvY2tfZGl2
aWRlcihpbnRlbF9kcCwgY2xvY2srKykpKSB7Ci0JCXUzMiBzZW5kX2N0bCA9IGludGVsX2RwLT5n
ZXRfYXV4X3NlbmRfY3RsKGludGVsX2RwLAotCQkJCQkJCSAgc2VuZF9ieXRlcywKLQkJCQkJCQkg
IGF1eF9jbG9ja19kaXZpZGVyKTsKLQotCQlzZW5kX2N0bCB8PSBhdXhfc2VuZF9jdGxfZmxhZ3M7
Ci0KLQkJLyogTXVzdCB0cnkgYXQgbGVhc3QgMyB0aW1lcyBhY2NvcmRpbmcgdG8gRFAgc3BlYyAq
LwotCQlmb3IgKHRyeSA9IDA7IHRyeSA8IDU7IHRyeSsrKSB7Ci0JCQkvKiBMb2FkIHRoZSBzZW5k
IGRhdGEgaW50byB0aGUgYXV4IGNoYW5uZWwgZGF0YSByZWdpc3RlcnMgKi8KLQkJCWZvciAoaSA9
IDA7IGkgPCBzZW5kX2J5dGVzOyBpICs9IDQpCi0JCQkJaW50ZWxfdW5jb3JlX3dyaXRlKHVuY29y
ZSwKLQkJCQkJCSAgIGNoX2RhdGFbaSA+PiAyXSwKLQkJCQkJCSAgIGludGVsX2RwX3BhY2tfYXV4
KHNlbmQgKyBpLAotCQkJCQkJCQkgICAgIHNlbmRfYnl0ZXMgLSBpKSk7Ci0KLQkJCS8qIFNlbmQg
dGhlIGNvbW1hbmQgYW5kIHdhaXQgZm9yIGl0IHRvIGNvbXBsZXRlICovCi0JCQlpbnRlbF91bmNv
cmVfd3JpdGUodW5jb3JlLCBjaF9jdGwsIHNlbmRfY3RsKTsKLQotCQkJc3RhdHVzID0gaW50ZWxf
ZHBfYXV4X3dhaXRfZG9uZShpbnRlbF9kcCk7Ci0KLQkJCS8qIENsZWFyIGRvbmUgc3RhdHVzIGFu
ZCBhbnkgZXJyb3JzICovCi0JCQlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLAotCQkJCQkgICBj
aF9jdGwsCi0JCQkJCSAgIHN0YXR1cyB8Ci0JCQkJCSAgIERQX0FVWF9DSF9DVExfRE9ORSB8Ci0J
CQkJCSAgIERQX0FVWF9DSF9DVExfVElNRV9PVVRfRVJST1IgfAotCQkJCQkgICBEUF9BVVhfQ0hf
Q1RMX1JFQ0VJVkVfRVJST1IpOwotCi0JCQkvKiBEUCBDVFMgMS4yIENvcmUgUmV2IDEuMSwgNC4y
LjEuMSAmIDQuMi4xLjIKLQkJCSAqICAgNDAwdXMgZGVsYXkgcmVxdWlyZWQgZm9yIGVycm9ycyBh
bmQgdGltZW91dHMKLQkJCSAqICAgVGltZW91dCBlcnJvcnMgZnJvbSB0aGUgSFcgYWxyZWFkeSBt
ZWV0IHRoaXMKLQkJCSAqICAgcmVxdWlyZW1lbnQgc28gc2tpcCB0byBuZXh0IGl0ZXJhdGlvbgot
CQkJICovCi0JCQlpZiAoc3RhdHVzICYgRFBfQVVYX0NIX0NUTF9USU1FX09VVF9FUlJPUikKLQkJ
CQljb250aW51ZTsKLQotCQkJaWYgKHN0YXR1cyAmIERQX0FVWF9DSF9DVExfUkVDRUlWRV9FUlJP
UikgewotCQkJCXVzbGVlcF9yYW5nZSg0MDAsIDUwMCk7Ci0JCQkJY29udGludWU7Ci0JCQl9Ci0J
CQlpZiAoc3RhdHVzICYgRFBfQVVYX0NIX0NUTF9ET05FKQotCQkJCWdvdG8gZG9uZTsKLQkJfQot
CX0KLQotCWlmICgoc3RhdHVzICYgRFBfQVVYX0NIX0NUTF9ET05FKSA9PSAwKSB7Ci0JCWRybV9l
cnIoJmk5MTUtPmRybSwgIiVzOiBub3QgZG9uZSAoc3RhdHVzIDB4JTA4eClcbiIsCi0JCQlpbnRl
bF9kcC0+YXV4Lm5hbWUsIHN0YXR1cyk7Ci0JCXJldCA9IC1FQlVTWTsKLQkJZ290byBvdXQ7Ci0J
fQotCi1kb25lOgotCS8qIENoZWNrIGZvciB0aW1lb3V0IG9yIHJlY2VpdmUgZXJyb3IuCi0JICog
VGltZW91dHMgb2NjdXIgd2hlbiB0aGUgc2luayBpcyBub3QgY29ubmVjdGVkCi0JICovCi0JaWYg
KHN0YXR1cyAmIERQX0FVWF9DSF9DVExfUkVDRUlWRV9FUlJPUikgewotCQlkcm1fZXJyKCZpOTE1
LT5kcm0sICIlczogcmVjZWl2ZSBlcnJvciAoc3RhdHVzIDB4JTA4eClcbiIsCi0JCQlpbnRlbF9k
cC0+YXV4Lm5hbWUsIHN0YXR1cyk7Ci0JCXJldCA9IC1FSU87Ci0JCWdvdG8gb3V0OwotCX0KLQot
CS8qIFRpbWVvdXRzIG9jY3VyIHdoZW4gdGhlIGRldmljZSBpc24ndCBjb25uZWN0ZWQsIHNvIHRo
ZXkncmUKLQkgKiAibm9ybWFsIiAtLSBkb24ndCBmaWxsIHRoZSBrZXJuZWwgbG9nIHdpdGggdGhl
c2UgKi8KLQlpZiAoc3RhdHVzICYgRFBfQVVYX0NIX0NUTF9USU1FX09VVF9FUlJPUikgewotCQlk
cm1fZGJnX2ttcygmaTkxNS0+ZHJtLCAiJXM6IHRpbWVvdXQgKHN0YXR1cyAweCUwOHgpXG4iLAot
CQkJICAgIGludGVsX2RwLT5hdXgubmFtZSwgc3RhdHVzKTsKLQkJcmV0ID0gLUVUSU1FRE9VVDsK
LQkJZ290byBvdXQ7Ci0JfQotCi0JLyogVW5sb2FkIGFueSBieXRlcyBzZW50IGJhY2sgZnJvbSB0
aGUgb3RoZXIgc2lkZSAqLwotCXJlY3ZfYnl0ZXMgPSAoKHN0YXR1cyAmIERQX0FVWF9DSF9DVExf
TUVTU0FHRV9TSVpFX01BU0spID4+Ci0JCSAgICAgIERQX0FVWF9DSF9DVExfTUVTU0FHRV9TSVpF
X1NISUZUKTsKLQotCS8qCi0JICogQnkgQlNwZWM6ICJNZXNzYWdlIHNpemVzIG9mIDAgb3IgPjIw
IGFyZSBub3QgYWxsb3dlZC4iCi0JICogV2UgaGF2ZSBubyBpZGVhIG9mIHdoYXQgaGFwcGVuZWQg
c28gd2UgcmV0dXJuIC1FQlVTWSBzbwotCSAqIGRybSBsYXllciB0YWtlcyBjYXJlIGZvciB0aGUg
bmVjZXNzYXJ5IHJldHJpZXMuCi0JICovCi0JaWYgKHJlY3ZfYnl0ZXMgPT0gMCB8fCByZWN2X2J5
dGVzID4gMjApIHsKLQkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwKLQkJCSAgICAiJXM6IEZvcmJp
ZGRlbiByZWN2X2J5dGVzID0gJWQgb24gYXV4IHRyYW5zYWN0aW9uXG4iLAotCQkJICAgIGludGVs
X2RwLT5hdXgubmFtZSwgcmVjdl9ieXRlcyk7Ci0JCXJldCA9IC1FQlVTWTsKLQkJZ290byBvdXQ7
Ci0JfQotCi0JaWYgKHJlY3ZfYnl0ZXMgPiByZWN2X3NpemUpCi0JCXJlY3ZfYnl0ZXMgPSByZWN2
X3NpemU7Ci0KLQlmb3IgKGkgPSAwOyBpIDwgcmVjdl9ieXRlczsgaSArPSA0KQotCQlpbnRlbF9k
cF91bnBhY2tfYXV4KGludGVsX3VuY29yZV9yZWFkKHVuY29yZSwgY2hfZGF0YVtpID4+IDJdKSwK
LQkJCQkgICAgcmVjdiArIGksIHJlY3ZfYnl0ZXMgLSBpKTsKLQotCXJldCA9IHJlY3ZfYnl0ZXM7
Ci1vdXQ6Ci0JY3B1X2xhdGVuY3lfcW9zX3VwZGF0ZV9yZXF1ZXN0KCZpbnRlbF9kcC0+cG1fcW9z
LCBQTV9RT1NfREVGQVVMVF9WQUxVRSk7Ci0KLQlpZiAodmRkKQotCQlpbnRlbF9wcHNfdmRkX29m
Zl91bmxvY2tlZChpbnRlbF9kcCwgZmFsc2UpOwotCi0JaW50ZWxfcHBzX3VubG9jayhpbnRlbF9k
cCwgcHBzX3dha2VyZWYpOwotCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0X2FzeW5jKGk5MTUsIGF1
eF9kb21haW4sIGF1eF93YWtlcmVmKTsKLQotCWlmIChpc190Y19wb3J0KQotCQlpbnRlbF90Y19w
b3J0X3VubG9jayhkaWdfcG9ydCk7Ci0KLQlyZXR1cm4gcmV0OwotfQotCi0jZGVmaW5lIEJBUkVf
QUREUkVTU19TSVpFCTMKLSNkZWZpbmUgSEVBREVSX1NJWkUJCShCQVJFX0FERFJFU1NfU0laRSAr
IDEpCi0KLXN0YXRpYyB2b2lkCi1pbnRlbF9kcF9hdXhfaGVhZGVyKHU4IHR4YnVmW0hFQURFUl9T
SVpFXSwKLQkJICAgIGNvbnN0IHN0cnVjdCBkcm1fZHBfYXV4X21zZyAqbXNnKQotewotCXR4YnVm
WzBdID0gKG1zZy0+cmVxdWVzdCA8PCA0KSB8ICgobXNnLT5hZGRyZXNzID4+IDE2KSAmIDB4Zik7
Ci0JdHhidWZbMV0gPSAobXNnLT5hZGRyZXNzID4+IDgpICYgMHhmZjsKLQl0eGJ1ZlsyXSA9IG1z
Zy0+YWRkcmVzcyAmIDB4ZmY7Ci0JdHhidWZbM10gPSBtc2ctPnNpemUgLSAxOwotfQotCi1zdGF0
aWMgdTMyIGludGVsX2RwX2F1eF94ZmVyX2ZsYWdzKGNvbnN0IHN0cnVjdCBkcm1fZHBfYXV4X21z
ZyAqbXNnKQotewotCS8qCi0JICogSWYgd2UncmUgdHJ5aW5nIHRvIHNlbmQgdGhlIEhEQ1AgQWtz
diwgd2UgbmVlZCB0byBzZXQgYSB0aGUgQWtzdgotCSAqIHNlbGVjdCBiaXQgdG8gaW5mb3JtIHRo
ZSBoYXJkd2FyZSB0byBzZW5kIHRoZSBBa3N2IGFmdGVyIG91ciBoZWFkZXIKLQkgKiBzaW5jZSB3
ZSBjYW4ndCBhY2Nlc3MgdGhhdCBkYXRhIGZyb20gc29mdHdhcmUuCi0JICovCi0JaWYgKChtc2ct
PnJlcXVlc3QgJiB+RFBfQVVYX0kyQ19NT1QpID09IERQX0FVWF9OQVRJVkVfV1JJVEUgJiYKLQkg
ICAgbXNnLT5hZGRyZXNzID09IERQX0FVWF9IRENQX0FLU1YpCi0JCXJldHVybiBEUF9BVVhfQ0hf
Q1RMX0FVWF9BS1NWX1NFTEVDVDsKLQotCXJldHVybiAwOwotfQotCi1zdGF0aWMgc3NpemVfdAot
aW50ZWxfZHBfYXV4X3RyYW5zZmVyKHN0cnVjdCBkcm1fZHBfYXV4ICphdXgsIHN0cnVjdCBkcm1f
ZHBfYXV4X21zZyAqbXNnKQotewotCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBjb250YWlu
ZXJfb2YoYXV4LCBzdHJ1Y3QgaW50ZWxfZHAsIGF1eCk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSBkcF90b19pOTE1KGludGVsX2RwKTsKLQl1OCB0eGJ1ZlsyMF0sIHJ4YnVmWzIw
XTsKLQlzaXplX3QgdHhzaXplLCByeHNpemU7Ci0JdTMyIGZsYWdzID0gaW50ZWxfZHBfYXV4X3hm
ZXJfZmxhZ3MobXNnKTsKLQlpbnQgcmV0OwotCi0JaW50ZWxfZHBfYXV4X2hlYWRlcih0eGJ1Ziwg
bXNnKTsKLQotCXN3aXRjaCAobXNnLT5yZXF1ZXN0ICYgfkRQX0FVWF9JMkNfTU9UKSB7Ci0JY2Fz
ZSBEUF9BVVhfTkFUSVZFX1dSSVRFOgotCWNhc2UgRFBfQVVYX0kyQ19XUklURToKLQljYXNlIERQ
X0FVWF9JMkNfV1JJVEVfU1RBVFVTX1VQREFURToKLQkJdHhzaXplID0gbXNnLT5zaXplID8gSEVB
REVSX1NJWkUgKyBtc2ctPnNpemUgOiBCQVJFX0FERFJFU1NfU0laRTsKLQkJcnhzaXplID0gMjsg
LyogMCBvciAxIGRhdGEgYnl0ZXMgKi8KLQotCQlpZiAoZHJtX1dBUk5fT04oJmk5MTUtPmRybSwg
dHhzaXplID4gMjApKQotCQkJcmV0dXJuIC1FMkJJRzsKLQotCQlkcm1fV0FSTl9PTigmaTkxNS0+
ZHJtLCAhbXNnLT5idWZmZXIgIT0gIW1zZy0+c2l6ZSk7Ci0KLQkJaWYgKG1zZy0+YnVmZmVyKQot
CQkJbWVtY3B5KHR4YnVmICsgSEVBREVSX1NJWkUsIG1zZy0+YnVmZmVyLCBtc2ctPnNpemUpOwot
Ci0JCXJldCA9IGludGVsX2RwX2F1eF94ZmVyKGludGVsX2RwLCB0eGJ1ZiwgdHhzaXplLAotCQkJ
CQlyeGJ1ZiwgcnhzaXplLCBmbGFncyk7Ci0JCWlmIChyZXQgPiAwKSB7Ci0JCQltc2ctPnJlcGx5
ID0gcnhidWZbMF0gPj4gNDsKLQotCQkJaWYgKHJldCA+IDEpIHsKLQkJCQkvKiBOdW1iZXIgb2Yg
Ynl0ZXMgd3JpdHRlbiBpbiBhIHNob3J0IHdyaXRlLiAqLwotCQkJCXJldCA9IGNsYW1wX3QoaW50
LCByeGJ1ZlsxXSwgMCwgbXNnLT5zaXplKTsKLQkJCX0gZWxzZSB7Ci0JCQkJLyogUmV0dXJuIHBh
eWxvYWQgc2l6ZS4gKi8KLQkJCQlyZXQgPSBtc2ctPnNpemU7Ci0JCQl9Ci0JCX0KLQkJYnJlYWs7
Ci0KLQljYXNlIERQX0FVWF9OQVRJVkVfUkVBRDoKLQljYXNlIERQX0FVWF9JMkNfUkVBRDoKLQkJ
dHhzaXplID0gbXNnLT5zaXplID8gSEVBREVSX1NJWkUgOiBCQVJFX0FERFJFU1NfU0laRTsKLQkJ
cnhzaXplID0gbXNnLT5zaXplICsgMTsKLQotCQlpZiAoZHJtX1dBUk5fT04oJmk5MTUtPmRybSwg
cnhzaXplID4gMjApKQotCQkJcmV0dXJuIC1FMkJJRzsKLQotCQlyZXQgPSBpbnRlbF9kcF9hdXhf
eGZlcihpbnRlbF9kcCwgdHhidWYsIHR4c2l6ZSwKLQkJCQkJcnhidWYsIHJ4c2l6ZSwgZmxhZ3Mp
OwotCQlpZiAocmV0ID4gMCkgewotCQkJbXNnLT5yZXBseSA9IHJ4YnVmWzBdID4+IDQ7Ci0JCQkv
KgotCQkJICogQXNzdW1lIGhhcHB5IGRheSwgYW5kIGNvcHkgdGhlIGRhdGEuIFRoZSBjYWxsZXIg
aXMKLQkJCSAqIGV4cGVjdGVkIHRvIGNoZWNrIG1zZy0+cmVwbHkgYmVmb3JlIHRvdWNoaW5nIGl0
LgotCQkJICoKLQkJCSAqIFJldHVybiBwYXlsb2FkIHNpemUuCi0JCQkgKi8KLQkJCXJldC0tOwot
CQkJbWVtY3B5KG1zZy0+YnVmZmVyLCByeGJ1ZiArIDEsIHJldCk7Ci0JCX0KLQkJYnJlYWs7Ci0K
LQlkZWZhdWx0OgotCQlyZXQgPSAtRUlOVkFMOwotCQlicmVhazsKLQl9Ci0KLQlyZXR1cm4gcmV0
OwotfQotCi0KLXN0YXRpYyBpOTE1X3JlZ190IGc0eF9hdXhfY3RsX3JlZyhzdHJ1Y3QgaW50ZWxf
ZHAgKmludGVsX2RwKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRw
X3RvX2k5MTUoaW50ZWxfZHApOwotCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0
ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOwotCWVudW0gYXV4X2NoIGF1eF9jaCA9IGRpZ19w
b3J0LT5hdXhfY2g7Ci0KLQlzd2l0Y2ggKGF1eF9jaCkgewotCWNhc2UgQVVYX0NIX0I6Ci0JY2Fz
ZSBBVVhfQ0hfQzoKLQljYXNlIEFVWF9DSF9EOgotCQlyZXR1cm4gRFBfQVVYX0NIX0NUTChhdXhf
Y2gpOwotCWRlZmF1bHQ6Ci0JCU1JU1NJTkdfQ0FTRShhdXhfY2gpOwotCQlyZXR1cm4gRFBfQVVY
X0NIX0NUTChBVVhfQ0hfQik7Ci0JfQotfQotCi1zdGF0aWMgaTkxNV9yZWdfdCBnNHhfYXV4X2Rh
dGFfcmVnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIGludCBpbmRleCkKLXsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKLQlzdHJ1
Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCA9IGRwX3RvX2RpZ19wb3J0KGludGVsX2Rw
KTsKLQllbnVtIGF1eF9jaCBhdXhfY2ggPSBkaWdfcG9ydC0+YXV4X2NoOwotCi0Jc3dpdGNoIChh
dXhfY2gpIHsKLQljYXNlIEFVWF9DSF9COgotCWNhc2UgQVVYX0NIX0M6Ci0JY2FzZSBBVVhfQ0hf
RDoKLQkJcmV0dXJuIERQX0FVWF9DSF9EQVRBKGF1eF9jaCwgaW5kZXgpOwotCWRlZmF1bHQ6Ci0J
CU1JU1NJTkdfQ0FTRShhdXhfY2gpOwotCQlyZXR1cm4gRFBfQVVYX0NIX0RBVEEoQVVYX0NIX0Is
IGluZGV4KTsKLQl9Ci19Ci0KLXN0YXRpYyBpOTE1X3JlZ190IGlsa19hdXhfY3RsX3JlZyhzdHJ1
Y3QgaW50ZWxfZHAgKmludGVsX2RwKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwotCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQg
KmRpZ19wb3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOwotCWVudW0gYXV4X2NoIGF1eF9j
aCA9IGRpZ19wb3J0LT5hdXhfY2g7Ci0KLQlzd2l0Y2ggKGF1eF9jaCkgewotCWNhc2UgQVVYX0NI
X0E6Ci0JCXJldHVybiBEUF9BVVhfQ0hfQ1RMKGF1eF9jaCk7Ci0JY2FzZSBBVVhfQ0hfQjoKLQlj
YXNlIEFVWF9DSF9DOgotCWNhc2UgQVVYX0NIX0Q6Ci0JCXJldHVybiBQQ0hfRFBfQVVYX0NIX0NU
TChhdXhfY2gpOwotCWRlZmF1bHQ6Ci0JCU1JU1NJTkdfQ0FTRShhdXhfY2gpOwotCQlyZXR1cm4g
RFBfQVVYX0NIX0NUTChBVVhfQ0hfQSk7Ci0JfQotfQotCi1zdGF0aWMgaTkxNV9yZWdfdCBpbGtf
YXV4X2RhdGFfcmVnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIGludCBpbmRleCkKLXsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsK
LQlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCA9IGRwX3RvX2RpZ19wb3J0KGlu
dGVsX2RwKTsKLQllbnVtIGF1eF9jaCBhdXhfY2ggPSBkaWdfcG9ydC0+YXV4X2NoOwotCi0Jc3dp
dGNoIChhdXhfY2gpIHsKLQljYXNlIEFVWF9DSF9BOgotCQlyZXR1cm4gRFBfQVVYX0NIX0RBVEEo
YXV4X2NoLCBpbmRleCk7Ci0JY2FzZSBBVVhfQ0hfQjoKLQljYXNlIEFVWF9DSF9DOgotCWNhc2Ug
QVVYX0NIX0Q6Ci0JCXJldHVybiBQQ0hfRFBfQVVYX0NIX0RBVEEoYXV4X2NoLCBpbmRleCk7Ci0J
ZGVmYXVsdDoKLQkJTUlTU0lOR19DQVNFKGF1eF9jaCk7Ci0JCXJldHVybiBEUF9BVVhfQ0hfREFU
QShBVVhfQ0hfQSwgaW5kZXgpOwotCX0KLX0KLQotc3RhdGljIGk5MTVfcmVnX3Qgc2tsX2F1eF9j
dGxfcmVnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCi17Ci0Jc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7Ci0Jc3RydWN0IGludGVsX2Rp
Z2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7Ci0JZW51bSBh
dXhfY2ggYXV4X2NoID0gZGlnX3BvcnQtPmF1eF9jaDsKLQotCXN3aXRjaCAoYXV4X2NoKSB7Ci0J
Y2FzZSBBVVhfQ0hfQToKLQljYXNlIEFVWF9DSF9COgotCWNhc2UgQVVYX0NIX0M6Ci0JY2FzZSBB
VVhfQ0hfRDoKLQljYXNlIEFVWF9DSF9FOgotCWNhc2UgQVVYX0NIX0Y6Ci0JCXJldHVybiBEUF9B
VVhfQ0hfQ1RMKGF1eF9jaCk7Ci0JZGVmYXVsdDoKLQkJTUlTU0lOR19DQVNFKGF1eF9jaCk7Ci0J
CXJldHVybiBEUF9BVVhfQ0hfQ1RMKEFVWF9DSF9BKTsKLQl9Ci19Ci0KLXN0YXRpYyBpOTE1X3Jl
Z190IHNrbF9hdXhfZGF0YV9yZWcoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwgaW50IGluZGV4
KQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50
ZWxfZHApOwotCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0ID0gZHBfdG9fZGln
X3BvcnQoaW50ZWxfZHApOwotCWVudW0gYXV4X2NoIGF1eF9jaCA9IGRpZ19wb3J0LT5hdXhfY2g7
Ci0KLQlzd2l0Y2ggKGF1eF9jaCkgewotCWNhc2UgQVVYX0NIX0E6Ci0JY2FzZSBBVVhfQ0hfQjoK
LQljYXNlIEFVWF9DSF9DOgotCWNhc2UgQVVYX0NIX0Q6Ci0JY2FzZSBBVVhfQ0hfRToKLQljYXNl
IEFVWF9DSF9GOgotCQlyZXR1cm4gRFBfQVVYX0NIX0RBVEEoYXV4X2NoLCBpbmRleCk7Ci0JZGVm
YXVsdDoKLQkJTUlTU0lOR19DQVNFKGF1eF9jaCk7Ci0JCXJldHVybiBEUF9BVVhfQ0hfREFUQShB
VVhfQ0hfQSwgaW5kZXgpOwotCX0KLX0KLQotc3RhdGljIGk5MTVfcmVnX3QgdGdsX2F1eF9jdGxf
cmVnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7Ci0Jc3RydWN0IGludGVsX2RpZ2l0
YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7Ci0JZW51bSBhdXhf
Y2ggYXV4X2NoID0gZGlnX3BvcnQtPmF1eF9jaDsKLQotCXN3aXRjaCAoYXV4X2NoKSB7Ci0JY2Fz
ZSBBVVhfQ0hfQToKLQljYXNlIEFVWF9DSF9COgotCWNhc2UgQVVYX0NIX0M6Ci0JY2FzZSBBVVhf
Q0hfVVNCQzE6Ci0JY2FzZSBBVVhfQ0hfVVNCQzI6Ci0JY2FzZSBBVVhfQ0hfVVNCQzM6Ci0JY2Fz
ZSBBVVhfQ0hfVVNCQzQ6Ci0JY2FzZSBBVVhfQ0hfVVNCQzU6Ci0JY2FzZSBBVVhfQ0hfVVNCQzY6
Ci0JCXJldHVybiBEUF9BVVhfQ0hfQ1RMKGF1eF9jaCk7Ci0JZGVmYXVsdDoKLQkJTUlTU0lOR19D
QVNFKGF1eF9jaCk7Ci0JCXJldHVybiBEUF9BVVhfQ0hfQ1RMKEFVWF9DSF9BKTsKLQl9Ci19Ci0K
LXN0YXRpYyBpOTE1X3JlZ190IHRnbF9hdXhfZGF0YV9yZWcoc3RydWN0IGludGVsX2RwICppbnRl
bF9kcCwgaW50IGluZGV4KQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IGRwX3RvX2k5MTUoaW50ZWxfZHApOwotCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19w
b3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOwotCWVudW0gYXV4X2NoIGF1eF9jaCA9IGRp
Z19wb3J0LT5hdXhfY2g7Ci0KLQlzd2l0Y2ggKGF1eF9jaCkgewotCWNhc2UgQVVYX0NIX0E6Ci0J
Y2FzZSBBVVhfQ0hfQjoKLQljYXNlIEFVWF9DSF9DOgotCWNhc2UgQVVYX0NIX1VTQkMxOgotCWNh
c2UgQVVYX0NIX1VTQkMyOgotCWNhc2UgQVVYX0NIX1VTQkMzOgotCWNhc2UgQVVYX0NIX1VTQkM0
OgotCWNhc2UgQVVYX0NIX1VTQkM1OgotCWNhc2UgQVVYX0NIX1VTQkM2OgotCQlyZXR1cm4gRFBf
QVVYX0NIX0RBVEEoYXV4X2NoLCBpbmRleCk7Ci0JZGVmYXVsdDoKLQkJTUlTU0lOR19DQVNFKGF1
eF9jaCk7Ci0JCXJldHVybiBEUF9BVVhfQ0hfREFUQShBVVhfQ0hfQSwgaW5kZXgpOwotCX0KLX0K
LQotc3RhdGljIHZvaWQKLWludGVsX2RwX2F1eF9maW5pKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHApCi17Ci0JaWYgKGNwdV9sYXRlbmN5X3Fvc19yZXF1ZXN0X2FjdGl2ZSgmaW50ZWxfZHAtPnBt
X3FvcykpCi0JCWNwdV9sYXRlbmN5X3Fvc19yZW1vdmVfcmVxdWVzdCgmaW50ZWxfZHAtPnBtX3Fv
cyk7Ci0KLQlrZnJlZShpbnRlbF9kcC0+YXV4Lm5hbWUpOwotfQotCi1zdGF0aWMgdm9pZAotaW50
ZWxfZHBfYXV4X2luaXQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKLXsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKLQlzdHJ1Y3Qg
aW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCA9IGRwX3RvX2RpZ19wb3J0KGludGVsX2RwKTsK
LQlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciA9ICZkaWdfcG9ydC0+YmFzZTsKLQllbnVt
IGF1eF9jaCBhdXhfY2ggPSBkaWdfcG9ydC0+YXV4X2NoOwotCi0JaWYgKElOVEVMX0dFTihkZXZf
cHJpdikgPj0gMTIpIHsKLQkJaW50ZWxfZHAtPmF1eF9jaF9jdGxfcmVnID0gdGdsX2F1eF9jdGxf
cmVnOwotCQlpbnRlbF9kcC0+YXV4X2NoX2RhdGFfcmVnID0gdGdsX2F1eF9kYXRhX3JlZzsKLQl9
IGVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkgewotCQlpbnRlbF9kcC0+YXV4X2No
X2N0bF9yZWcgPSBza2xfYXV4X2N0bF9yZWc7Ci0JCWludGVsX2RwLT5hdXhfY2hfZGF0YV9yZWcg
PSBza2xfYXV4X2RhdGFfcmVnOwotCX0gZWxzZSBpZiAoSEFTX1BDSF9TUExJVChkZXZfcHJpdikp
IHsKLQkJaW50ZWxfZHAtPmF1eF9jaF9jdGxfcmVnID0gaWxrX2F1eF9jdGxfcmVnOwotCQlpbnRl
bF9kcC0+YXV4X2NoX2RhdGFfcmVnID0gaWxrX2F1eF9kYXRhX3JlZzsKLQl9IGVsc2UgewotCQlp
bnRlbF9kcC0+YXV4X2NoX2N0bF9yZWcgPSBnNHhfYXV4X2N0bF9yZWc7Ci0JCWludGVsX2RwLT5h
dXhfY2hfZGF0YV9yZWcgPSBnNHhfYXV4X2RhdGFfcmVnOwotCX0KLQotCWlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDkpCi0JCWludGVsX2RwLT5nZXRfYXV4X2Nsb2NrX2RpdmlkZXIgPSBza2xf
Z2V0X2F1eF9jbG9ja19kaXZpZGVyOwotCWVsc2UgaWYgKElTX0JST0FEV0VMTChkZXZfcHJpdikg
fHwgSVNfSEFTV0VMTChkZXZfcHJpdikpCi0JCWludGVsX2RwLT5nZXRfYXV4X2Nsb2NrX2Rpdmlk
ZXIgPSBoc3dfZ2V0X2F1eF9jbG9ja19kaXZpZGVyOwotCWVsc2UgaWYgKEhBU19QQ0hfU1BMSVQo
ZGV2X3ByaXYpKQotCQlpbnRlbF9kcC0+Z2V0X2F1eF9jbG9ja19kaXZpZGVyID0gaWxrX2dldF9h
dXhfY2xvY2tfZGl2aWRlcjsKLQllbHNlCi0JCWludGVsX2RwLT5nZXRfYXV4X2Nsb2NrX2Rpdmlk
ZXIgPSBnNHhfZ2V0X2F1eF9jbG9ja19kaXZpZGVyOwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJp
dikgPj0gOSkKLQkJaW50ZWxfZHAtPmdldF9hdXhfc2VuZF9jdGwgPSBza2xfZ2V0X2F1eF9zZW5k
X2N0bDsKLQllbHNlCi0JCWludGVsX2RwLT5nZXRfYXV4X3NlbmRfY3RsID0gZzR4X2dldF9hdXhf
c2VuZF9jdGw7Ci0KLQlkcm1fZHBfYXV4X2luaXQoJmludGVsX2RwLT5hdXgpOwotCi0JLyogRmFp
bHVyZSB0byBhbGxvY2F0ZSBvdXIgcHJlZmVycmVkIG5hbWUgaXMgbm90IGNyaXRpY2FsICovCi0J
aWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIgJiYgYXV4X2NoID49IEFVWF9DSF9VU0JDMSkK
LQkJaW50ZWxfZHAtPmF1eC5uYW1lID0ga2FzcHJpbnRmKEdGUF9LRVJORUwsICJBVVggVVNCQyVj
LyVzIiwKLQkJCQkJICAgICAgIGF1eF9jaCAtIEFVWF9DSF9VU0JDMSArICcxJywKLQkJCQkJICAg
ICAgIGVuY29kZXItPmJhc2UubmFtZSk7Ci0JZWxzZQotCQlpbnRlbF9kcC0+YXV4Lm5hbWUgPSBr
YXNwcmludGYoR0ZQX0tFUk5FTCwgIkFVWCAlYy8lcyIsCi0JCQkJCSAgICAgICBhdXhfY2hfbmFt
ZShhdXhfY2gpLAotCQkJCQkgICAgICAgZW5jb2Rlci0+YmFzZS5uYW1lKTsKLQotCWludGVsX2Rw
LT5hdXgudHJhbnNmZXIgPSBpbnRlbF9kcF9hdXhfdHJhbnNmZXI7Ci0JY3B1X2xhdGVuY3lfcW9z
X2FkZF9yZXF1ZXN0KCZpbnRlbF9kcC0+cG1fcW9zLCBQTV9RT1NfREVGQVVMVF9WQUxVRSk7Ci19
Ci0KIGJvb2wgaW50ZWxfZHBfc291cmNlX3N1cHBvcnRzX2hicjIoc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCkKIHsKIAlpbnQgbWF4X3JhdGUgPSBpbnRlbF9kcC0+c291cmNlX3JhdGVzW2ludGVs
X2RwLT5udW1fc291cmNlX3JhdGVzIC0gMV07CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2RwLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2RwLmgKaW5kZXggNDBlNzA1MzEyOTZjLi5kODA4MzkxMzliZmIgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmgKQEAgLTc1LDcgKzc1LDYgQEAgdm9pZCBpbnRlbF9k
cF9tc3RfcmVzdW1lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiBpbnQgaW50
ZWxfZHBfbWF4X2xpbmtfcmF0ZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKTsKIGludCBpbnRl
bF9kcF9tYXhfbGFuZV9jb3VudChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKTsKIGludCBpbnRl
bF9kcF9yYXRlX3NlbGVjdChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCBpbnQgcmF0ZSk7Ci11
MzIgaW50ZWxfZHBfcGFja19hdXgoY29uc3QgdTggKnNyYywgaW50IHNyY19ieXRlcyk7CiAKIHZv
aWQgaW50ZWxfZWRwX2RycnNfZW5hYmxlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCQkg
ICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX2F1eC5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9hdXguYwpuZXcgZmlsZSBtb2RlIDEwMDY0NApp
bmRleCAwMDAwMDAwMDAwMDAuLmM3YzgyYTZjZDYzYwotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfYXV4LmMKQEAgLTAsMCArMSw2OTIgQEAK
Ky8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKKy8qCisgKiBDb3B5cmlnaHQgwqkgMjAy
MCBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpbmNsdWRlICJpOTE1X2Rydi5oIgorI2luY2x1
ZGUgImk5MTVfdHJhY2UuaCIKKyNpbmNsdWRlICJpbnRlbF9kaXNwbGF5X3R5cGVzLmgiCisjaW5j
bHVkZSAiaW50ZWxfZHBfYXV4LmgiCisjaW5jbHVkZSAiaW50ZWxfcHBzLmgiCisjaW5jbHVkZSAi
aW50ZWxfdGMuaCIKKwordTMyIGludGVsX2RwX3BhY2tfYXV4KGNvbnN0IHU4ICpzcmMsIGludCBz
cmNfYnl0ZXMpCit7CisJaW50IGk7CisJdTMyIHYgPSAwOworCisJaWYgKHNyY19ieXRlcyA+IDQp
CisJCXNyY19ieXRlcyA9IDQ7CisJZm9yIChpID0gMDsgaSA8IHNyY19ieXRlczsgaSsrKQorCQl2
IHw9ICgodTMyKXNyY1tpXSkgPDwgKCgzIC0gaSkgKiA4KTsKKwlyZXR1cm4gdjsKK30KKworc3Rh
dGljIHZvaWQgaW50ZWxfZHBfdW5wYWNrX2F1eCh1MzIgc3JjLCB1OCAqZHN0LCBpbnQgZHN0X2J5
dGVzKQoreworCWludCBpOworCisJaWYgKGRzdF9ieXRlcyA+IDQpCisJCWRzdF9ieXRlcyA9IDQ7
CisJZm9yIChpID0gMDsgaSA8IGRzdF9ieXRlczsgaSsrKQorCQlkc3RbaV0gPSBzcmMgPj4gKCgz
IC0gaSkgKiA4KTsKK30KKworc3RhdGljIHUzMgoraW50ZWxfZHBfYXV4X3dhaXRfZG9uZShzdHJ1
Y3QgaW50ZWxfZHAgKmludGVsX2RwKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisJaTkxNV9yZWdfdCBjaF9jdGwgPSBpbnRlbF9kcC0+
YXV4X2NoX2N0bF9yZWcoaW50ZWxfZHApOworCWNvbnN0IHVuc2lnbmVkIGludCB0aW1lb3V0X21z
ID0gMTA7CisJdTMyIHN0YXR1czsKKwlib29sIGRvbmU7CisKKyNkZWZpbmUgQyAoKChzdGF0dXMg
PSBpbnRlbF91bmNvcmVfcmVhZF9ub3RyYWNlKCZpOTE1LT51bmNvcmUsIGNoX2N0bCkpICYgRFBf
QVVYX0NIX0NUTF9TRU5EX0JVU1kpID09IDApCisJZG9uZSA9IHdhaXRfZXZlbnRfdGltZW91dChp
OTE1LT5nbWJ1c193YWl0X3F1ZXVlLCBDLAorCQkJCSAgbXNlY3NfdG9famlmZmllc190aW1lb3V0
KHRpbWVvdXRfbXMpKTsKKworCS8qIGp1c3QgdHJhY2UgdGhlIGZpbmFsIHZhbHVlICovCisJdHJh
Y2VfaTkxNV9yZWdfcncoZmFsc2UsIGNoX2N0bCwgc3RhdHVzLCBzaXplb2Yoc3RhdHVzKSwgdHJ1
ZSk7CisKKwlpZiAoIWRvbmUpCisJCWRybV9lcnIoJmk5MTUtPmRybSwKKwkJCSIlczogZGlkIG5v
dCBjb21wbGV0ZSBvciB0aW1lb3V0IHdpdGhpbiAldW1zIChzdGF0dXMgMHglMDh4KVxuIiwKKwkJ
CWludGVsX2RwLT5hdXgubmFtZSwgdGltZW91dF9tcywgc3RhdHVzKTsKKyN1bmRlZiBDCisKKwly
ZXR1cm4gc3RhdHVzOworfQorCitzdGF0aWMgdTMyIGc0eF9nZXRfYXV4X2Nsb2NrX2RpdmlkZXIo
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCwgaW50IGluZGV4KQoreworCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCisJaWYgKGluZGV4
KQorCQlyZXR1cm4gMDsKKworCS8qCisJICogVGhlIGNsb2NrIGRpdmlkZXIgaXMgYmFzZWQgb2Zm
IHRoZSBocmF3Y2xrLCBhbmQgd291bGQgbGlrZSB0byBydW4gYXQKKwkgKiAyTUh6LiAgU28sIHRh
a2UgdGhlIGhyYXdjbGsgdmFsdWUgYW5kIGRpdmlkZSBieSAyMDAwIGFuZCB1c2UgdGhhdAorCSAq
LworCXJldHVybiBESVZfUk9VTkRfQ0xPU0VTVChSVU5USU1FX0lORk8oZGV2X3ByaXYpLT5yYXdj
bGtfZnJlcSwgMjAwMCk7Cit9CisKK3N0YXRpYyB1MzIgaWxrX2dldF9hdXhfY2xvY2tfZGl2aWRl
cihzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCBpbnQgaW5kZXgpCit7CisJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisJc3RydWN0IGlu
dGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7CisJ
dTMyIGZyZXE7CisKKwlpZiAoaW5kZXgpCisJCXJldHVybiAwOworCisJLyoKKwkgKiBUaGUgY2xv
Y2sgZGl2aWRlciBpcyBiYXNlZCBvZmYgdGhlIGNkY2xrIG9yIFBDSCByYXdjbGssIGFuZCB3b3Vs
ZAorCSAqIGxpa2UgdG8gcnVuIGF0IDJNSHouICBTbywgdGFrZSB0aGUgY2RjbGsgb3IgUENIIHJh
d2NsayB2YWx1ZSBhbmQKKwkgKiBkaXZpZGUgYnkgMjAwMCBhbmQgdXNlIHRoYXQKKwkgKi8KKwlp
ZiAoZGlnX3BvcnQtPmF1eF9jaCA9PSBBVVhfQ0hfQSkKKwkJZnJlcSA9IGRldl9wcml2LT5jZGNs
ay5ody5jZGNsazsKKwllbHNlCisJCWZyZXEgPSBSVU5USU1FX0lORk8oZGV2X3ByaXYpLT5yYXdj
bGtfZnJlcTsKKwlyZXR1cm4gRElWX1JPVU5EX0NMT1NFU1QoZnJlcSwgMjAwMCk7Cit9CisKK3N0
YXRpYyB1MzIgaHN3X2dldF9hdXhfY2xvY2tfZGl2aWRlcihzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwLCBpbnQgaW5kZXgpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
ZHBfdG9faTkxNShpbnRlbF9kcCk7CisJc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3Bv
cnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7CisKKwlpZiAoZGlnX3BvcnQtPmF1eF9jaCAh
PSBBVVhfQ0hfQSAmJiBIQVNfUENIX0xQVF9IKGRldl9wcml2KSkgeworCQkvKiBXb3JrYXJvdW5k
IGZvciBub24tVUxUIEhTVyAqLworCQlzd2l0Y2ggKGluZGV4KSB7CisJCWNhc2UgMDogcmV0dXJu
IDYzOworCQljYXNlIDE6IHJldHVybiA3MjsKKwkJZGVmYXVsdDogcmV0dXJuIDA7CisJCX0KKwl9
CisKKwlyZXR1cm4gaWxrX2dldF9hdXhfY2xvY2tfZGl2aWRlcihpbnRlbF9kcCwgaW5kZXgpOwor
fQorCitzdGF0aWMgdTMyIHNrbF9nZXRfYXV4X2Nsb2NrX2RpdmlkZXIoc3RydWN0IGludGVsX2Rw
ICppbnRlbF9kcCwgaW50IGluZGV4KQoreworCS8qCisJICogU0tMIGRvZXNuJ3QgbmVlZCB1cyB0
byBwcm9ncmFtIHRoZSBBVVggY2xvY2sgZGl2aWRlciAoSGFyZHdhcmUgd2lsbAorCSAqIGRlcml2
ZSB0aGUgY2xvY2sgZnJvbSBDRENMSyBhdXRvbWF0aWNhbGx5KS4gV2Ugc3RpbGwgaW1wbGVtZW50
IHRoZQorCSAqIGdldF9hdXhfY2xvY2tfZGl2aWRlciB2ZnVuYyB0byBwbHVnLWluIGludG8gdGhl
IGV4aXN0aW5nIGNvZGUuCisJICovCisJcmV0dXJuIGluZGV4ID8gMCA6IDE7Cit9CisKK3N0YXRp
YyB1MzIgZzR4X2dldF9hdXhfc2VuZF9jdGwoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKKwkJ
CQlpbnQgc2VuZF9ieXRlcywKKwkJCQl1MzIgYXV4X2Nsb2NrX2RpdmlkZXIpCit7CisJc3RydWN0
IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7
CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0KKwkJCXRvX2k5MTUoZGlnX3Bv
cnQtPmJhc2UuYmFzZS5kZXYpOworCXUzMiBwcmVjaGFyZ2UsIHRpbWVvdXQ7CisKKwlpZiAoSVNf
R0VOKGRldl9wcml2LCA2KSkKKwkJcHJlY2hhcmdlID0gMzsKKwllbHNlCisJCXByZWNoYXJnZSA9
IDU7CisKKwlpZiAoSVNfQlJPQURXRUxMKGRldl9wcml2KSkKKwkJdGltZW91dCA9IERQX0FVWF9D
SF9DVExfVElNRV9PVVRfNjAwdXM7CisJZWxzZQorCQl0aW1lb3V0ID0gRFBfQVVYX0NIX0NUTF9U
SU1FX09VVF80MDB1czsKKworCXJldHVybiBEUF9BVVhfQ0hfQ1RMX1NFTkRfQlVTWSB8CisJICAg
ICAgIERQX0FVWF9DSF9DVExfRE9ORSB8CisJICAgICAgIERQX0FVWF9DSF9DVExfSU5URVJSVVBU
IHwKKwkgICAgICAgRFBfQVVYX0NIX0NUTF9USU1FX09VVF9FUlJPUiB8CisJICAgICAgIHRpbWVv
dXQgfAorCSAgICAgICBEUF9BVVhfQ0hfQ1RMX1JFQ0VJVkVfRVJST1IgfAorCSAgICAgICAoc2Vu
ZF9ieXRlcyA8PCBEUF9BVVhfQ0hfQ1RMX01FU1NBR0VfU0laRV9TSElGVCkgfAorCSAgICAgICAo
cHJlY2hhcmdlIDw8IERQX0FVWF9DSF9DVExfUFJFQ0hBUkdFXzJVU19TSElGVCkgfAorCSAgICAg
ICAoYXV4X2Nsb2NrX2RpdmlkZXIgPDwgRFBfQVVYX0NIX0NUTF9CSVRfQ0xPQ0tfMlhfU0hJRlQp
OworfQorCitzdGF0aWMgdTMyIHNrbF9nZXRfYXV4X3NlbmRfY3RsKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHAsCisJCQkJaW50IHNlbmRfYnl0ZXMsCisJCQkJdTMyIHVudXNlZCkKK3sKKwlzdHJ1
Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCA9IGRwX3RvX2RpZ19wb3J0KGludGVsX2Rw
KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9CisJCQl0b19pOTE1KGRpZ19wb3J0
LT5iYXNlLmJhc2UuZGV2KTsKKwllbnVtIHBoeSBwaHkgPSBpbnRlbF9wb3J0X3RvX3BoeShpOTE1
LCBkaWdfcG9ydC0+YmFzZS5wb3J0KTsKKwl1MzIgcmV0OworCisJcmV0ID0gRFBfQVVYX0NIX0NU
TF9TRU5EX0JVU1kgfAorCSAgICAgIERQX0FVWF9DSF9DVExfRE9ORSB8CisJICAgICAgRFBfQVVY
X0NIX0NUTF9JTlRFUlJVUFQgfAorCSAgICAgIERQX0FVWF9DSF9DVExfVElNRV9PVVRfRVJST1Ig
fAorCSAgICAgIERQX0FVWF9DSF9DVExfVElNRV9PVVRfTUFYIHwKKwkgICAgICBEUF9BVVhfQ0hf
Q1RMX1JFQ0VJVkVfRVJST1IgfAorCSAgICAgIChzZW5kX2J5dGVzIDw8IERQX0FVWF9DSF9DVExf
TUVTU0FHRV9TSVpFX1NISUZUKSB8CisJICAgICAgRFBfQVVYX0NIX0NUTF9GV19TWU5DX1BVTFNF
X1NLTCgzMikgfAorCSAgICAgIERQX0FVWF9DSF9DVExfU1lOQ19QVUxTRV9TS0woMzIpOworCisJ
aWYgKGludGVsX3BoeV9pc190YyhpOTE1LCBwaHkpICYmCisJICAgIGRpZ19wb3J0LT50Y19tb2Rl
ID09IFRDX1BPUlRfVEJUX0FMVCkKKwkJcmV0IHw9IERQX0FVWF9DSF9DVExfVEJUX0lPOworCisJ
cmV0dXJuIHJldDsKK30KKworc3RhdGljIGludAoraW50ZWxfZHBfYXV4X3hmZXIoc3RydWN0IGlu
dGVsX2RwICppbnRlbF9kcCwKKwkJICBjb25zdCB1OCAqc2VuZCwgaW50IHNlbmRfYnl0ZXMsCisJ
CSAgdTggKnJlY3YsIGludCByZWN2X3NpemUsCisJCSAgdTMyIGF1eF9zZW5kX2N0bF9mbGFncykK
K3sKKwlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCA9IGRwX3RvX2RpZ19wb3J0
KGludGVsX2RwKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9CisJCQl0b19pOTE1
KGRpZ19wb3J0LT5iYXNlLmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUg
PSAmaTkxNS0+dW5jb3JlOworCWVudW0gcGh5IHBoeSA9IGludGVsX3BvcnRfdG9fcGh5KGk5MTUs
IGRpZ19wb3J0LT5iYXNlLnBvcnQpOworCWJvb2wgaXNfdGNfcG9ydCA9IGludGVsX3BoeV9pc190
YyhpOTE1LCBwaHkpOworCWk5MTVfcmVnX3QgY2hfY3RsLCBjaF9kYXRhWzVdOworCXUzMiBhdXhf
Y2xvY2tfZGl2aWRlcjsKKwllbnVtIGludGVsX2Rpc3BsYXlfcG93ZXJfZG9tYWluIGF1eF9kb21h
aW47CisJaW50ZWxfd2FrZXJlZl90IGF1eF93YWtlcmVmOworCWludGVsX3dha2VyZWZfdCBwcHNf
d2FrZXJlZjsKKwlpbnQgaSwgcmV0LCByZWN2X2J5dGVzOworCWludCB0cnksIGNsb2NrID0gMDsK
Kwl1MzIgc3RhdHVzOworCWJvb2wgdmRkOworCisJY2hfY3RsID0gaW50ZWxfZHAtPmF1eF9jaF9j
dGxfcmVnKGludGVsX2RwKTsKKwlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShjaF9kYXRhKTsg
aSsrKQorCQljaF9kYXRhW2ldID0gaW50ZWxfZHAtPmF1eF9jaF9kYXRhX3JlZyhpbnRlbF9kcCwg
aSk7CisKKwlpZiAoaXNfdGNfcG9ydCkKKwkJaW50ZWxfdGNfcG9ydF9sb2NrKGRpZ19wb3J0KTsK
KworCWF1eF9kb21haW4gPSBpbnRlbF9hdXhfcG93ZXJfZG9tYWluKGRpZ19wb3J0KTsKKworCWF1
eF93YWtlcmVmID0gaW50ZWxfZGlzcGxheV9wb3dlcl9nZXQoaTkxNSwgYXV4X2RvbWFpbik7CisJ
cHBzX3dha2VyZWYgPSBpbnRlbF9wcHNfbG9jayhpbnRlbF9kcCk7CisKKwkvKgorCSAqIFdlIHdp
bGwgYmUgY2FsbGVkIHdpdGggVkREIGFscmVhZHkgZW5hYmxlZCBmb3IgZHBjZC9lZGlkL291aSBy
ZWFkcy4KKwkgKiBJbiBzdWNoIGNhc2VzIHdlIHdhbnQgdG8gbGVhdmUgVkREIGVuYWJsZWQgYW5k
IGl0J3MgdXAgdG8gdXBwZXIgbGF5ZXJzCisJICogdG8gdHVybiBpdCBvZmYuIEJ1dCBmb3IgZWcu
IGkyYy1kZXYgYWNjZXNzIHdlIG5lZWQgdG8gdHVybiBpdCBvbi9vZmYKKwkgKiBvdXJzZWx2ZXMu
CisJICovCisJdmRkID0gaW50ZWxfcHBzX3ZkZF9vbl91bmxvY2tlZChpbnRlbF9kcCk7CisKKwkv
KgorCSAqIGRwIGF1eCBpcyBleHRyZW1lbHkgc2Vuc2l0aXZlIHRvIGlycSBsYXRlbmN5LCBoZW5j
ZSByZXF1ZXN0IHRoZQorCSAqIGxvd2VzdCBwb3NzaWJsZSB3YWtldXAgbGF0ZW5jeSBhbmQgc28g
cHJldmVudCB0aGUgY3B1IGZyb20gZ29pbmcgaW50bworCSAqIGRlZXAgc2xlZXAgc3RhdGVzLgor
CSAqLworCWNwdV9sYXRlbmN5X3Fvc191cGRhdGVfcmVxdWVzdCgmaW50ZWxfZHAtPnBtX3Fvcywg
MCk7CisKKwlpbnRlbF9wcHNfY2hlY2tfcG93ZXJfdW5sb2NrZWQoaW50ZWxfZHApOworCisJLyog
VHJ5IHRvIHdhaXQgZm9yIGFueSBwcmV2aW91cyBBVVggY2hhbm5lbCBhY3Rpdml0eSAqLworCWZv
ciAodHJ5ID0gMDsgdHJ5IDwgMzsgdHJ5KyspIHsKKwkJc3RhdHVzID0gaW50ZWxfdW5jb3JlX3Jl
YWRfbm90cmFjZSh1bmNvcmUsIGNoX2N0bCk7CisJCWlmICgoc3RhdHVzICYgRFBfQVVYX0NIX0NU
TF9TRU5EX0JVU1kpID09IDApCisJCQlicmVhazsKKwkJbXNsZWVwKDEpOworCX0KKwkvKiBqdXN0
IHRyYWNlIHRoZSBmaW5hbCB2YWx1ZSAqLworCXRyYWNlX2k5MTVfcmVnX3J3KGZhbHNlLCBjaF9j
dGwsIHN0YXR1cywgc2l6ZW9mKHN0YXR1cyksIHRydWUpOworCisJaWYgKHRyeSA9PSAzKSB7CisJ
CWNvbnN0IHUzMiBzdGF0dXMgPSBpbnRlbF91bmNvcmVfcmVhZCh1bmNvcmUsIGNoX2N0bCk7CisK
KwkJaWYgKHN0YXR1cyAhPSBpbnRlbF9kcC0+YXV4X2J1c3lfbGFzdF9zdGF0dXMpIHsKKwkJCWRy
bV9XQVJOKCZpOTE1LT5kcm0sIDEsCisJCQkJICIlczogbm90IHN0YXJ0ZWQgKHN0YXR1cyAweCUw
OHgpXG4iLAorCQkJCSBpbnRlbF9kcC0+YXV4Lm5hbWUsIHN0YXR1cyk7CisJCQlpbnRlbF9kcC0+
YXV4X2J1c3lfbGFzdF9zdGF0dXMgPSBzdGF0dXM7CisJCX0KKworCQlyZXQgPSAtRUJVU1k7CisJ
CWdvdG8gb3V0OworCX0KKworCS8qIE9ubHkgNSBkYXRhIHJlZ2lzdGVycyEgKi8KKwlpZiAoZHJt
X1dBUk5fT04oJmk5MTUtPmRybSwgc2VuZF9ieXRlcyA+IDIwIHx8IHJlY3Zfc2l6ZSA+IDIwKSkg
eworCQlyZXQgPSAtRTJCSUc7CisJCWdvdG8gb3V0OworCX0KKworCXdoaWxlICgoYXV4X2Nsb2Nr
X2RpdmlkZXIgPSBpbnRlbF9kcC0+Z2V0X2F1eF9jbG9ja19kaXZpZGVyKGludGVsX2RwLCBjbG9j
aysrKSkpIHsKKwkJdTMyIHNlbmRfY3RsID0gaW50ZWxfZHAtPmdldF9hdXhfc2VuZF9jdGwoaW50
ZWxfZHAsCisJCQkJCQkJICBzZW5kX2J5dGVzLAorCQkJCQkJCSAgYXV4X2Nsb2NrX2RpdmlkZXIp
OworCisJCXNlbmRfY3RsIHw9IGF1eF9zZW5kX2N0bF9mbGFnczsKKworCQkvKiBNdXN0IHRyeSBh
dCBsZWFzdCAzIHRpbWVzIGFjY29yZGluZyB0byBEUCBzcGVjICovCisJCWZvciAodHJ5ID0gMDsg
dHJ5IDwgNTsgdHJ5KyspIHsKKwkJCS8qIExvYWQgdGhlIHNlbmQgZGF0YSBpbnRvIHRoZSBhdXgg
Y2hhbm5lbCBkYXRhIHJlZ2lzdGVycyAqLworCQkJZm9yIChpID0gMDsgaSA8IHNlbmRfYnl0ZXM7
IGkgKz0gNCkKKwkJCQlpbnRlbF91bmNvcmVfd3JpdGUodW5jb3JlLAorCQkJCQkJICAgY2hfZGF0
YVtpID4+IDJdLAorCQkJCQkJICAgaW50ZWxfZHBfcGFja19hdXgoc2VuZCArIGksCisJCQkJCQkJ
CSAgICAgc2VuZF9ieXRlcyAtIGkpKTsKKworCQkJLyogU2VuZCB0aGUgY29tbWFuZCBhbmQgd2Fp
dCBmb3IgaXQgdG8gY29tcGxldGUgKi8KKwkJCWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsIGNo
X2N0bCwgc2VuZF9jdGwpOworCisJCQlzdGF0dXMgPSBpbnRlbF9kcF9hdXhfd2FpdF9kb25lKGlu
dGVsX2RwKTsKKworCQkJLyogQ2xlYXIgZG9uZSBzdGF0dXMgYW5kIGFueSBlcnJvcnMgKi8KKwkJ
CWludGVsX3VuY29yZV93cml0ZSh1bmNvcmUsCisJCQkJCSAgIGNoX2N0bCwKKwkJCQkJICAgc3Rh
dHVzIHwKKwkJCQkJICAgRFBfQVVYX0NIX0NUTF9ET05FIHwKKwkJCQkJICAgRFBfQVVYX0NIX0NU
TF9USU1FX09VVF9FUlJPUiB8CisJCQkJCSAgIERQX0FVWF9DSF9DVExfUkVDRUlWRV9FUlJPUik7
CisKKwkJCS8qCisJCQkgKiBEUCBDVFMgMS4yIENvcmUgUmV2IDEuMSwgNC4yLjEuMSAmIDQuMi4x
LjIKKwkJCSAqICAgNDAwdXMgZGVsYXkgcmVxdWlyZWQgZm9yIGVycm9ycyBhbmQgdGltZW91dHMK
KwkJCSAqICAgVGltZW91dCBlcnJvcnMgZnJvbSB0aGUgSFcgYWxyZWFkeSBtZWV0IHRoaXMKKwkJ
CSAqICAgcmVxdWlyZW1lbnQgc28gc2tpcCB0byBuZXh0IGl0ZXJhdGlvbgorCQkJICovCisJCQlp
ZiAoc3RhdHVzICYgRFBfQVVYX0NIX0NUTF9USU1FX09VVF9FUlJPUikKKwkJCQljb250aW51ZTsK
KworCQkJaWYgKHN0YXR1cyAmIERQX0FVWF9DSF9DVExfUkVDRUlWRV9FUlJPUikgeworCQkJCXVz
bGVlcF9yYW5nZSg0MDAsIDUwMCk7CisJCQkJY29udGludWU7CisJCQl9CisJCQlpZiAoc3RhdHVz
ICYgRFBfQVVYX0NIX0NUTF9ET05FKQorCQkJCWdvdG8gZG9uZTsKKwkJfQorCX0KKworCWlmICgo
c3RhdHVzICYgRFBfQVVYX0NIX0NUTF9ET05FKSA9PSAwKSB7CisJCWRybV9lcnIoJmk5MTUtPmRy
bSwgIiVzOiBub3QgZG9uZSAoc3RhdHVzIDB4JTA4eClcbiIsCisJCQlpbnRlbF9kcC0+YXV4Lm5h
bWUsIHN0YXR1cyk7CisJCXJldCA9IC1FQlVTWTsKKwkJZ290byBvdXQ7CisJfQorCitkb25lOgor
CS8qCisJICogQ2hlY2sgZm9yIHRpbWVvdXQgb3IgcmVjZWl2ZSBlcnJvci4gVGltZW91dHMgb2Nj
dXIgd2hlbiB0aGUgc2luayBpcworCSAqIG5vdCBjb25uZWN0ZWQuCisJICovCisJaWYgKHN0YXR1
cyAmIERQX0FVWF9DSF9DVExfUkVDRUlWRV9FUlJPUikgeworCQlkcm1fZXJyKCZpOTE1LT5kcm0s
ICIlczogcmVjZWl2ZSBlcnJvciAoc3RhdHVzIDB4JTA4eClcbiIsCisJCQlpbnRlbF9kcC0+YXV4
Lm5hbWUsIHN0YXR1cyk7CisJCXJldCA9IC1FSU87CisJCWdvdG8gb3V0OworCX0KKworCS8qCisJ
ICogVGltZW91dHMgb2NjdXIgd2hlbiB0aGUgZGV2aWNlIGlzbid0IGNvbm5lY3RlZCwgc28gdGhl
eSdyZSAibm9ybWFsIgorCSAqIC0tIGRvbid0IGZpbGwgdGhlIGtlcm5lbCBsb2cgd2l0aCB0aGVz
ZQorCSAqLworCWlmIChzdGF0dXMgJiBEUF9BVVhfQ0hfQ1RMX1RJTUVfT1VUX0VSUk9SKSB7CisJ
CWRybV9kYmdfa21zKCZpOTE1LT5kcm0sICIlczogdGltZW91dCAoc3RhdHVzIDB4JTA4eClcbiIs
CisJCQkgICAgaW50ZWxfZHAtPmF1eC5uYW1lLCBzdGF0dXMpOworCQlyZXQgPSAtRVRJTUVET1VU
OworCQlnb3RvIG91dDsKKwl9CisKKwkvKiBVbmxvYWQgYW55IGJ5dGVzIHNlbnQgYmFjayBmcm9t
IHRoZSBvdGhlciBzaWRlICovCisJcmVjdl9ieXRlcyA9ICgoc3RhdHVzICYgRFBfQVVYX0NIX0NU
TF9NRVNTQUdFX1NJWkVfTUFTSykgPj4KKwkJICAgICAgRFBfQVVYX0NIX0NUTF9NRVNTQUdFX1NJ
WkVfU0hJRlQpOworCisJLyoKKwkgKiBCeSBCU3BlYzogIk1lc3NhZ2Ugc2l6ZXMgb2YgMCBvciA+
MjAgYXJlIG5vdCBhbGxvd2VkLiIKKwkgKiBXZSBoYXZlIG5vIGlkZWEgb2Ygd2hhdCBoYXBwZW5l
ZCBzbyB3ZSByZXR1cm4gLUVCVVNZIHNvCisJICogZHJtIGxheWVyIHRha2VzIGNhcmUgZm9yIHRo
ZSBuZWNlc3NhcnkgcmV0cmllcy4KKwkgKi8KKwlpZiAocmVjdl9ieXRlcyA9PSAwIHx8IHJlY3Zf
Ynl0ZXMgPiAyMCkgeworCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLAorCQkJICAgICIlczogRm9y
YmlkZGVuIHJlY3ZfYnl0ZXMgPSAlZCBvbiBhdXggdHJhbnNhY3Rpb25cbiIsCisJCQkgICAgaW50
ZWxfZHAtPmF1eC5uYW1lLCByZWN2X2J5dGVzKTsKKwkJcmV0ID0gLUVCVVNZOworCQlnb3RvIG91
dDsKKwl9CisKKwlpZiAocmVjdl9ieXRlcyA+IHJlY3Zfc2l6ZSkKKwkJcmVjdl9ieXRlcyA9IHJl
Y3Zfc2l6ZTsKKworCWZvciAoaSA9IDA7IGkgPCByZWN2X2J5dGVzOyBpICs9IDQpCisJCWludGVs
X2RwX3VucGFja19hdXgoaW50ZWxfdW5jb3JlX3JlYWQodW5jb3JlLCBjaF9kYXRhW2kgPj4gMl0p
LAorCQkJCSAgICByZWN2ICsgaSwgcmVjdl9ieXRlcyAtIGkpOworCisJcmV0ID0gcmVjdl9ieXRl
czsKK291dDoKKwljcHVfbGF0ZW5jeV9xb3NfdXBkYXRlX3JlcXVlc3QoJmludGVsX2RwLT5wbV9x
b3MsIFBNX1FPU19ERUZBVUxUX1ZBTFVFKTsKKworCWlmICh2ZGQpCisJCWludGVsX3Bwc192ZGRf
b2ZmX3VubG9ja2VkKGludGVsX2RwLCBmYWxzZSk7CisKKwlpbnRlbF9wcHNfdW5sb2NrKGludGVs
X2RwLCBwcHNfd2FrZXJlZik7CisJaW50ZWxfZGlzcGxheV9wb3dlcl9wdXRfYXN5bmMoaTkxNSwg
YXV4X2RvbWFpbiwgYXV4X3dha2VyZWYpOworCisJaWYgKGlzX3RjX3BvcnQpCisJCWludGVsX3Rj
X3BvcnRfdW5sb2NrKGRpZ19wb3J0KTsKKworCXJldHVybiByZXQ7Cit9CisKKyNkZWZpbmUgQkFS
RV9BRERSRVNTX1NJWkUJMworI2RlZmluZSBIRUFERVJfU0laRQkJKEJBUkVfQUREUkVTU19TSVpF
ICsgMSkKKworc3RhdGljIHZvaWQKK2ludGVsX2RwX2F1eF9oZWFkZXIodTggdHhidWZbSEVBREVS
X1NJWkVdLAorCQkgICAgY29uc3Qgc3RydWN0IGRybV9kcF9hdXhfbXNnICptc2cpCit7CisJdHhi
dWZbMF0gPSAobXNnLT5yZXF1ZXN0IDw8IDQpIHwgKChtc2ctPmFkZHJlc3MgPj4gMTYpICYgMHhm
KTsKKwl0eGJ1ZlsxXSA9IChtc2ctPmFkZHJlc3MgPj4gOCkgJiAweGZmOworCXR4YnVmWzJdID0g
bXNnLT5hZGRyZXNzICYgMHhmZjsKKwl0eGJ1ZlszXSA9IG1zZy0+c2l6ZSAtIDE7Cit9CisKK3N0
YXRpYyB1MzIgaW50ZWxfZHBfYXV4X3hmZXJfZmxhZ3MoY29uc3Qgc3RydWN0IGRybV9kcF9hdXhf
bXNnICptc2cpCit7CisJLyoKKwkgKiBJZiB3ZSdyZSB0cnlpbmcgdG8gc2VuZCB0aGUgSERDUCBB
a3N2LCB3ZSBuZWVkIHRvIHNldCBhIHRoZSBBa3N2CisJICogc2VsZWN0IGJpdCB0byBpbmZvcm0g
dGhlIGhhcmR3YXJlIHRvIHNlbmQgdGhlIEFrc3YgYWZ0ZXIgb3VyIGhlYWRlcgorCSAqIHNpbmNl
IHdlIGNhbid0IGFjY2VzcyB0aGF0IGRhdGEgZnJvbSBzb2Z0d2FyZS4KKwkgKi8KKwlpZiAoKG1z
Zy0+cmVxdWVzdCAmIH5EUF9BVVhfSTJDX01PVCkgPT0gRFBfQVVYX05BVElWRV9XUklURSAmJgor
CSAgICBtc2ctPmFkZHJlc3MgPT0gRFBfQVVYX0hEQ1BfQUtTVikKKwkJcmV0dXJuIERQX0FVWF9D
SF9DVExfQVVYX0FLU1ZfU0VMRUNUOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBzc2l6ZV90
CitpbnRlbF9kcF9hdXhfdHJhbnNmZXIoc3RydWN0IGRybV9kcF9hdXggKmF1eCwgc3RydWN0IGRy
bV9kcF9hdXhfbXNnICptc2cpCit7CisJc3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGNvbnRh
aW5lcl9vZihhdXgsIHN0cnVjdCBpbnRlbF9kcCwgYXV4KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXU4IHR4YnVmWzIwXSwgcnhidWZb
MjBdOworCXNpemVfdCB0eHNpemUsIHJ4c2l6ZTsKKwl1MzIgZmxhZ3MgPSBpbnRlbF9kcF9hdXhf
eGZlcl9mbGFncyhtc2cpOworCWludCByZXQ7CisKKwlpbnRlbF9kcF9hdXhfaGVhZGVyKHR4YnVm
LCBtc2cpOworCisJc3dpdGNoIChtc2ctPnJlcXVlc3QgJiB+RFBfQVVYX0kyQ19NT1QpIHsKKwlj
YXNlIERQX0FVWF9OQVRJVkVfV1JJVEU6CisJY2FzZSBEUF9BVVhfSTJDX1dSSVRFOgorCWNhc2Ug
RFBfQVVYX0kyQ19XUklURV9TVEFUVVNfVVBEQVRFOgorCQl0eHNpemUgPSBtc2ctPnNpemUgPyBI
RUFERVJfU0laRSArIG1zZy0+c2l6ZSA6IEJBUkVfQUREUkVTU19TSVpFOworCQlyeHNpemUgPSAy
OyAvKiAwIG9yIDEgZGF0YSBieXRlcyAqLworCisJCWlmIChkcm1fV0FSTl9PTigmaTkxNS0+ZHJt
LCB0eHNpemUgPiAyMCkpCisJCQlyZXR1cm4gLUUyQklHOworCisJCWRybV9XQVJOX09OKCZpOTE1
LT5kcm0sICFtc2ctPmJ1ZmZlciAhPSAhbXNnLT5zaXplKTsKKworCQlpZiAobXNnLT5idWZmZXIp
CisJCQltZW1jcHkodHhidWYgKyBIRUFERVJfU0laRSwgbXNnLT5idWZmZXIsIG1zZy0+c2l6ZSk7
CisKKwkJcmV0ID0gaW50ZWxfZHBfYXV4X3hmZXIoaW50ZWxfZHAsIHR4YnVmLCB0eHNpemUsCisJ
CQkJCXJ4YnVmLCByeHNpemUsIGZsYWdzKTsKKwkJaWYgKHJldCA+IDApIHsKKwkJCW1zZy0+cmVw
bHkgPSByeGJ1ZlswXSA+PiA0OworCisJCQlpZiAocmV0ID4gMSkgeworCQkJCS8qIE51bWJlciBv
ZiBieXRlcyB3cml0dGVuIGluIGEgc2hvcnQgd3JpdGUuICovCisJCQkJcmV0ID0gY2xhbXBfdChp
bnQsIHJ4YnVmWzFdLCAwLCBtc2ctPnNpemUpOworCQkJfSBlbHNlIHsKKwkJCQkvKiBSZXR1cm4g
cGF5bG9hZCBzaXplLiAqLworCQkJCXJldCA9IG1zZy0+c2l6ZTsKKwkJCX0KKwkJfQorCQlicmVh
azsKKworCWNhc2UgRFBfQVVYX05BVElWRV9SRUFEOgorCWNhc2UgRFBfQVVYX0kyQ19SRUFEOgor
CQl0eHNpemUgPSBtc2ctPnNpemUgPyBIRUFERVJfU0laRSA6IEJBUkVfQUREUkVTU19TSVpFOwor
CQlyeHNpemUgPSBtc2ctPnNpemUgKyAxOworCisJCWlmIChkcm1fV0FSTl9PTigmaTkxNS0+ZHJt
LCByeHNpemUgPiAyMCkpCisJCQlyZXR1cm4gLUUyQklHOworCisJCXJldCA9IGludGVsX2RwX2F1
eF94ZmVyKGludGVsX2RwLCB0eGJ1ZiwgdHhzaXplLAorCQkJCQlyeGJ1ZiwgcnhzaXplLCBmbGFn
cyk7CisJCWlmIChyZXQgPiAwKSB7CisJCQltc2ctPnJlcGx5ID0gcnhidWZbMF0gPj4gNDsKKwkJ
CS8qCisJCQkgKiBBc3N1bWUgaGFwcHkgZGF5LCBhbmQgY29weSB0aGUgZGF0YS4gVGhlIGNhbGxl
ciBpcworCQkJICogZXhwZWN0ZWQgdG8gY2hlY2sgbXNnLT5yZXBseSBiZWZvcmUgdG91Y2hpbmcg
aXQuCisJCQkgKgorCQkJICogUmV0dXJuIHBheWxvYWQgc2l6ZS4KKwkJCSAqLworCQkJcmV0LS07
CisJCQltZW1jcHkobXNnLT5idWZmZXIsIHJ4YnVmICsgMSwgcmV0KTsKKwkJfQorCQlicmVhazsK
KworCWRlZmF1bHQ6CisJCXJldCA9IC1FSU5WQUw7CisJCWJyZWFrOworCX0KKworCXJldHVybiBy
ZXQ7Cit9CisKK3N0YXRpYyBpOTE1X3JlZ190IGc0eF9hdXhfY3RsX3JlZyhzdHJ1Y3QgaW50ZWxf
ZHAgKmludGVsX2RwKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRw
X3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0
ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOworCWVudW0gYXV4X2NoIGF1eF9jaCA9IGRpZ19w
b3J0LT5hdXhfY2g7CisKKwlzd2l0Y2ggKGF1eF9jaCkgeworCWNhc2UgQVVYX0NIX0I6CisJY2Fz
ZSBBVVhfQ0hfQzoKKwljYXNlIEFVWF9DSF9EOgorCQlyZXR1cm4gRFBfQVVYX0NIX0NUTChhdXhf
Y2gpOworCWRlZmF1bHQ6CisJCU1JU1NJTkdfQ0FTRShhdXhfY2gpOworCQlyZXR1cm4gRFBfQVVY
X0NIX0NUTChBVVhfQ0hfQik7CisJfQorfQorCitzdGF0aWMgaTkxNV9yZWdfdCBnNHhfYXV4X2Rh
dGFfcmVnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIGludCBpbmRleCkKK3sKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwlzdHJ1
Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCA9IGRwX3RvX2RpZ19wb3J0KGludGVsX2Rw
KTsKKwllbnVtIGF1eF9jaCBhdXhfY2ggPSBkaWdfcG9ydC0+YXV4X2NoOworCisJc3dpdGNoIChh
dXhfY2gpIHsKKwljYXNlIEFVWF9DSF9COgorCWNhc2UgQVVYX0NIX0M6CisJY2FzZSBBVVhfQ0hf
RDoKKwkJcmV0dXJuIERQX0FVWF9DSF9EQVRBKGF1eF9jaCwgaW5kZXgpOworCWRlZmF1bHQ6CisJ
CU1JU1NJTkdfQ0FTRShhdXhfY2gpOworCQlyZXR1cm4gRFBfQVVYX0NIX0RBVEEoQVVYX0NIX0Is
IGluZGV4KTsKKwl9Cit9CisKK3N0YXRpYyBpOTE1X3JlZ190IGlsa19hdXhfY3RsX3JlZyhzdHJ1
Y3QgaW50ZWxfZHAgKmludGVsX2RwKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQg
KmRpZ19wb3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOworCWVudW0gYXV4X2NoIGF1eF9j
aCA9IGRpZ19wb3J0LT5hdXhfY2g7CisKKwlzd2l0Y2ggKGF1eF9jaCkgeworCWNhc2UgQVVYX0NI
X0E6CisJCXJldHVybiBEUF9BVVhfQ0hfQ1RMKGF1eF9jaCk7CisJY2FzZSBBVVhfQ0hfQjoKKwlj
YXNlIEFVWF9DSF9DOgorCWNhc2UgQVVYX0NIX0Q6CisJCXJldHVybiBQQ0hfRFBfQVVYX0NIX0NU
TChhdXhfY2gpOworCWRlZmF1bHQ6CisJCU1JU1NJTkdfQ0FTRShhdXhfY2gpOworCQlyZXR1cm4g
RFBfQVVYX0NIX0NUTChBVVhfQ0hfQSk7CisJfQorfQorCitzdGF0aWMgaTkxNV9yZWdfdCBpbGtf
YXV4X2RhdGFfcmVnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIGludCBpbmRleCkKK3sKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsK
KwlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCA9IGRwX3RvX2RpZ19wb3J0KGlu
dGVsX2RwKTsKKwllbnVtIGF1eF9jaCBhdXhfY2ggPSBkaWdfcG9ydC0+YXV4X2NoOworCisJc3dp
dGNoIChhdXhfY2gpIHsKKwljYXNlIEFVWF9DSF9BOgorCQlyZXR1cm4gRFBfQVVYX0NIX0RBVEEo
YXV4X2NoLCBpbmRleCk7CisJY2FzZSBBVVhfQ0hfQjoKKwljYXNlIEFVWF9DSF9DOgorCWNhc2Ug
QVVYX0NIX0Q6CisJCXJldHVybiBQQ0hfRFBfQVVYX0NIX0RBVEEoYXV4X2NoLCBpbmRleCk7CisJ
ZGVmYXVsdDoKKwkJTUlTU0lOR19DQVNFKGF1eF9jaCk7CisJCXJldHVybiBEUF9BVVhfQ0hfREFU
QShBVVhfQ0hfQSwgaW5kZXgpOworCX0KK30KKworc3RhdGljIGk5MTVfcmVnX3Qgc2tsX2F1eF9j
dGxfcmVnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCit7CisJc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisJc3RydWN0IGludGVsX2Rp
Z2l0YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7CisJZW51bSBh
dXhfY2ggYXV4X2NoID0gZGlnX3BvcnQtPmF1eF9jaDsKKworCXN3aXRjaCAoYXV4X2NoKSB7CisJ
Y2FzZSBBVVhfQ0hfQToKKwljYXNlIEFVWF9DSF9COgorCWNhc2UgQVVYX0NIX0M6CisJY2FzZSBB
VVhfQ0hfRDoKKwljYXNlIEFVWF9DSF9FOgorCWNhc2UgQVVYX0NIX0Y6CisJCXJldHVybiBEUF9B
VVhfQ0hfQ1RMKGF1eF9jaCk7CisJZGVmYXVsdDoKKwkJTUlTU0lOR19DQVNFKGF1eF9jaCk7CisJ
CXJldHVybiBEUF9BVVhfQ0hfQ1RMKEFVWF9DSF9BKTsKKwl9Cit9CisKK3N0YXRpYyBpOTE1X3Jl
Z190IHNrbF9hdXhfZGF0YV9yZWcoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwgaW50IGluZGV4
KQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50
ZWxfZHApOworCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19wb3J0ID0gZHBfdG9fZGln
X3BvcnQoaW50ZWxfZHApOworCWVudW0gYXV4X2NoIGF1eF9jaCA9IGRpZ19wb3J0LT5hdXhfY2g7
CisKKwlzd2l0Y2ggKGF1eF9jaCkgeworCWNhc2UgQVVYX0NIX0E6CisJY2FzZSBBVVhfQ0hfQjoK
KwljYXNlIEFVWF9DSF9DOgorCWNhc2UgQVVYX0NIX0Q6CisJY2FzZSBBVVhfQ0hfRToKKwljYXNl
IEFVWF9DSF9GOgorCQlyZXR1cm4gRFBfQVVYX0NIX0RBVEEoYXV4X2NoLCBpbmRleCk7CisJZGVm
YXVsdDoKKwkJTUlTU0lOR19DQVNFKGF1eF9jaCk7CisJCXJldHVybiBEUF9BVVhfQ0hfREFUQShB
VVhfQ0hfQSwgaW5kZXgpOworCX0KK30KKworc3RhdGljIGk5MTVfcmVnX3QgdGdsX2F1eF9jdGxf
cmVnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CisJc3RydWN0IGludGVsX2RpZ2l0
YWxfcG9ydCAqZGlnX3BvcnQgPSBkcF90b19kaWdfcG9ydChpbnRlbF9kcCk7CisJZW51bSBhdXhf
Y2ggYXV4X2NoID0gZGlnX3BvcnQtPmF1eF9jaDsKKworCXN3aXRjaCAoYXV4X2NoKSB7CisJY2Fz
ZSBBVVhfQ0hfQToKKwljYXNlIEFVWF9DSF9COgorCWNhc2UgQVVYX0NIX0M6CisJY2FzZSBBVVhf
Q0hfVVNCQzE6CisJY2FzZSBBVVhfQ0hfVVNCQzI6CisJY2FzZSBBVVhfQ0hfVVNCQzM6CisJY2Fz
ZSBBVVhfQ0hfVVNCQzQ6CisJY2FzZSBBVVhfQ0hfVVNCQzU6CisJY2FzZSBBVVhfQ0hfVVNCQzY6
CisJCXJldHVybiBEUF9BVVhfQ0hfQ1RMKGF1eF9jaCk7CisJZGVmYXVsdDoKKwkJTUlTU0lOR19D
QVNFKGF1eF9jaCk7CisJCXJldHVybiBEUF9BVVhfQ0hfQ1RMKEFVWF9DSF9BKTsKKwl9Cit9CisK
K3N0YXRpYyBpOTE1X3JlZ190IHRnbF9hdXhfZGF0YV9yZWcoc3RydWN0IGludGVsX2RwICppbnRl
bF9kcCwgaW50IGluZGV4KQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmRpZ19w
b3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOworCWVudW0gYXV4X2NoIGF1eF9jaCA9IGRp
Z19wb3J0LT5hdXhfY2g7CisKKwlzd2l0Y2ggKGF1eF9jaCkgeworCWNhc2UgQVVYX0NIX0E6CisJ
Y2FzZSBBVVhfQ0hfQjoKKwljYXNlIEFVWF9DSF9DOgorCWNhc2UgQVVYX0NIX1VTQkMxOgorCWNh
c2UgQVVYX0NIX1VTQkMyOgorCWNhc2UgQVVYX0NIX1VTQkMzOgorCWNhc2UgQVVYX0NIX1VTQkM0
OgorCWNhc2UgQVVYX0NIX1VTQkM1OgorCWNhc2UgQVVYX0NIX1VTQkM2OgorCQlyZXR1cm4gRFBf
QVVYX0NIX0RBVEEoYXV4X2NoLCBpbmRleCk7CisJZGVmYXVsdDoKKwkJTUlTU0lOR19DQVNFKGF1
eF9jaCk7CisJCXJldHVybiBEUF9BVVhfQ0hfREFUQShBVVhfQ0hfQSwgaW5kZXgpOworCX0KK30K
Kwordm9pZCBpbnRlbF9kcF9hdXhfZmluaShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQorewor
CWlmIChjcHVfbGF0ZW5jeV9xb3NfcmVxdWVzdF9hY3RpdmUoJmludGVsX2RwLT5wbV9xb3MpKQor
CQljcHVfbGF0ZW5jeV9xb3NfcmVtb3ZlX3JlcXVlc3QoJmludGVsX2RwLT5wbV9xb3MpOworCisJ
a2ZyZWUoaW50ZWxfZHAtPmF1eC5uYW1lKTsKK30KKwordm9pZCBpbnRlbF9kcF9hdXhfaW5pdChz
dHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOworCXN0cnVjdCBpbnRlbF9kaWdpdGFsX3Bv
cnQgKmRpZ19wb3J0ID0gZHBfdG9fZGlnX3BvcnQoaW50ZWxfZHApOworCXN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyID0gJmRpZ19wb3J0LT5iYXNlOworCWVudW0gYXV4X2NoIGF1eF9jaCA9
IGRpZ19wb3J0LT5hdXhfY2g7CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikgewor
CQlpbnRlbF9kcC0+YXV4X2NoX2N0bF9yZWcgPSB0Z2xfYXV4X2N0bF9yZWc7CisJCWludGVsX2Rw
LT5hdXhfY2hfZGF0YV9yZWcgPSB0Z2xfYXV4X2RhdGFfcmVnOworCX0gZWxzZSBpZiAoSU5URUxf
R0VOKGRldl9wcml2KSA+PSA5KSB7CisJCWludGVsX2RwLT5hdXhfY2hfY3RsX3JlZyA9IHNrbF9h
dXhfY3RsX3JlZzsKKwkJaW50ZWxfZHAtPmF1eF9jaF9kYXRhX3JlZyA9IHNrbF9hdXhfZGF0YV9y
ZWc7CisJfSBlbHNlIGlmIChIQVNfUENIX1NQTElUKGRldl9wcml2KSkgeworCQlpbnRlbF9kcC0+
YXV4X2NoX2N0bF9yZWcgPSBpbGtfYXV4X2N0bF9yZWc7CisJCWludGVsX2RwLT5hdXhfY2hfZGF0
YV9yZWcgPSBpbGtfYXV4X2RhdGFfcmVnOworCX0gZWxzZSB7CisJCWludGVsX2RwLT5hdXhfY2hf
Y3RsX3JlZyA9IGc0eF9hdXhfY3RsX3JlZzsKKwkJaW50ZWxfZHAtPmF1eF9jaF9kYXRhX3JlZyA9
IGc0eF9hdXhfZGF0YV9yZWc7CisJfQorCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSkK
KwkJaW50ZWxfZHAtPmdldF9hdXhfY2xvY2tfZGl2aWRlciA9IHNrbF9nZXRfYXV4X2Nsb2NrX2Rp
dmlkZXI7CisJZWxzZSBpZiAoSVNfQlJPQURXRUxMKGRldl9wcml2KSB8fCBJU19IQVNXRUxMKGRl
dl9wcml2KSkKKwkJaW50ZWxfZHAtPmdldF9hdXhfY2xvY2tfZGl2aWRlciA9IGhzd19nZXRfYXV4
X2Nsb2NrX2RpdmlkZXI7CisJZWxzZSBpZiAoSEFTX1BDSF9TUExJVChkZXZfcHJpdikpCisJCWlu
dGVsX2RwLT5nZXRfYXV4X2Nsb2NrX2RpdmlkZXIgPSBpbGtfZ2V0X2F1eF9jbG9ja19kaXZpZGVy
OworCWVsc2UKKwkJaW50ZWxfZHAtPmdldF9hdXhfY2xvY2tfZGl2aWRlciA9IGc0eF9nZXRfYXV4
X2Nsb2NrX2RpdmlkZXI7CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5KQorCQlpbnRl
bF9kcC0+Z2V0X2F1eF9zZW5kX2N0bCA9IHNrbF9nZXRfYXV4X3NlbmRfY3RsOworCWVsc2UKKwkJ
aW50ZWxfZHAtPmdldF9hdXhfc2VuZF9jdGwgPSBnNHhfZ2V0X2F1eF9zZW5kX2N0bDsKKworCWRy
bV9kcF9hdXhfaW5pdCgmaW50ZWxfZHAtPmF1eCk7CisKKwkvKiBGYWlsdXJlIHRvIGFsbG9jYXRl
IG91ciBwcmVmZXJyZWQgbmFtZSBpcyBub3QgY3JpdGljYWwgKi8KKwlpZiAoSU5URUxfR0VOKGRl
dl9wcml2KSA+PSAxMiAmJiBhdXhfY2ggPj0gQVVYX0NIX1VTQkMxKQorCQlpbnRlbF9kcC0+YXV4
Lm5hbWUgPSBrYXNwcmludGYoR0ZQX0tFUk5FTCwgIkFVWCBVU0JDJWMvJXMiLAorCQkJCQkgICAg
ICAgYXV4X2NoIC0gQVVYX0NIX1VTQkMxICsgJzEnLAorCQkJCQkgICAgICAgZW5jb2Rlci0+YmFz
ZS5uYW1lKTsKKwllbHNlCisJCWludGVsX2RwLT5hdXgubmFtZSA9IGthc3ByaW50ZihHRlBfS0VS
TkVMLCAiQVVYICVjLyVzIiwKKwkJCQkJICAgICAgIGF1eF9jaF9uYW1lKGF1eF9jaCksCisJCQkJ
CSAgICAgICBlbmNvZGVyLT5iYXNlLm5hbWUpOworCisJaW50ZWxfZHAtPmF1eC50cmFuc2ZlciA9
IGludGVsX2RwX2F1eF90cmFuc2ZlcjsKKwljcHVfbGF0ZW5jeV9xb3NfYWRkX3JlcXVlc3QoJmlu
dGVsX2RwLT5wbV9xb3MsIFBNX1FPU19ERUZBVUxUX1ZBTFVFKTsKK30KZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfYXV4LmggYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX2F1eC5oCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4
IDAwMDAwMDAwMDAwMC4uY2VhNThkZDg2YzQ5Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9hdXguaApAQCAtMCwwICsxLDE4IEBACisvKiBT
UERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUICovCisvKgorICogQ29weXJpZ2h0IMKpIDIwMjAg
SW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaWZuZGVmIF9fSU5URUxfRFBfQVVYX0hfXworI2Rl
ZmluZSBfX0lOVEVMX0RQX0FVWF9IX18KKworI2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+CisKK3N0
cnVjdCBpbnRlbF9kcDsKKwordTMyIGludGVsX2RwX3BhY2tfYXV4KGNvbnN0IHU4ICpzcmMsIGlu
dCBzcmNfYnl0ZXMpOworCit2b2lkIGludGVsX2RwX2F1eF9maW5pKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHApOwordm9pZCBpbnRlbF9kcF9hdXhfaW5pdChzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwKTsKKworI2VuZGlmIC8qIF9fSU5URUxfRFBfQVVYX0hfXyAqLwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmMKaW5kZXggMWU2YzFmYTU5ZDRhLi43MmQ0YzYxZTE0MmUg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuYwpAQCAtMjgsOSArMjgs
MTAgQEAKICNpbmNsdWRlICJpOTE1X2Rydi5oIgogI2luY2x1ZGUgImludGVsX2F0b21pYy5oIgog
I2luY2x1ZGUgImludGVsX2Rpc3BsYXlfdHlwZXMuaCIKKyNpbmNsdWRlICJpbnRlbF9kcF9hdXgu
aCIKKyNpbmNsdWRlICJpbnRlbF9oZG1pLmgiCiAjaW5jbHVkZSAiaW50ZWxfcHNyLmgiCiAjaW5j
bHVkZSAiaW50ZWxfc3ByaXRlLmgiCi0jaW5jbHVkZSAiaW50ZWxfaGRtaS5oIgogCiAvKioKICAq
IERPQzogUGFuZWwgU2VsZiBSZWZyZXNoIChQU1IvU1JEKQotLSAKMi4yMC4xCgpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBs
aXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZngK

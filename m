Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 969AC1733E
	for <lists+intel-gfx@lfdr.de>; Wed,  8 May 2019 10:09:26 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A6503895E1;
	Wed,  8 May 2019 08:09:20 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7679B89561
 for <intel-gfx@lists.freedesktop.org>; Wed,  8 May 2019 08:09:14 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16485924-1500050 
 for multiple; Wed, 08 May 2019 09:07:10 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  8 May 2019 09:06:48 +0100
Message-Id: <20190508080704.24223-24-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190508080704.24223-1-chris@chris-wilson.co.uk>
References: <20190508080704.24223-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 24/40] drm/i915: Move mmap and friends to its
 own file
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Matthew Auld <matthew.auld@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q29udGludWluZyB0aGUgZGVjbHV0dGVyaW5nIG9mIGk5MTVfZ2VtLmMsIG5vdyB0aGUgdHVybiBv
ZiBkb19tbWFwIGFuZAp0aGUgZmF1bHRoYW5kbGVycwoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2ls
c29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+ClJldmlld2VkLWJ5OiBNYXR0aGV3IEF1bGQg
PG1hdHRoZXcuYXVsZEBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZp
bGUgICAgICAgICAgICAgICAgIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9tbWFuLmMgICAgICB8IDUwNSArKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMgICAgfCAgNTYgKysKIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaCAgICB8ICAgNyArCiAuLi4vZHJtL2k5MTUvZ2VtL3Nl
bGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMgICAgfCA1MDMgKysrKysrKysrKysrKysrKwogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAgICAgICAgICAgICAgIHwgICAxIC0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgICAgICAgICAgICAgICB8IDU2MSArLS0tLS0tLS0tLS0t
LS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX3RpbGluZy5jICAgICAgICB8ICAg
MiArLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fb2JqZWN0LmMgIHwgNDg3
IC0tLS0tLS0tLS0tLS0tLQogLi4uL2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2xpdmVfc2VsZnRl
c3RzLmggIHwgICAxICsKIDEwIGZpbGVzIGNoYW5nZWQsIDEwODggaW5zZXJ0aW9ucygrKSwgMTAz
NiBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fbW1hbi5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCmluZGV4
IGJhM2I4MmYzY2Q0OS4uZDA1NzU3YzUyNDkyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9NYWtlZmlsZQorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQpAQCAtODgs
NiArODgsNyBAQCBpOTE1LXkgKz0gJChndC15KQogb2JqLXkgKz0gZ2VtLwogZ2VtLXkgKz0gXAog
CWdlbS9pOTE1X2dlbV9vYmplY3QubyBcCisJZ2VtL2k5MTVfZ2VtX21tYW4ubyBcCiAJZ2VtL2k5
MTVfZ2VtX3BhZ2VzLm8gXAogCWdlbS9pOTE1X2dlbV9waHlzLm8gXAogCWdlbS9pOTE1X2dlbV9z
aG1lbS5vCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fbW1h
bi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYwpuZXcgZmlsZSBt
b2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjFiY2M2ZTEwOTFlOQotLS0gL2Rldi9udWxs
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMKQEAgLTAsMCAr
MSw1MDUgQEAKKy8qCisgKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUCisgKgorICogQ29w
eXJpZ2h0IMKpIDIwMTQtMjAxNiBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpbmNsdWRlIDxs
aW51eC9tbWFuLmg+CisjaW5jbHVkZSA8bGludXgvc2l6ZXMuaD4KKworI2luY2x1ZGUgImk5MTVf
Z2VtX2lvY3Rscy5oIgorI2luY2x1ZGUgImk5MTVfZ2VtX29iamVjdC5oIgorCisjaW5jbHVkZSAi
Li4vaTkxNV9nZW1fZ3R0LmgiCisjaW5jbHVkZSAiLi4vaTkxNV92bWEuaCIKKyNpbmNsdWRlICIu
Li9pOTE1X2Rydi5oIgorI2luY2x1ZGUgIi4uL2ludGVsX2Rydi5oIgorCitzdGF0aWMgaW5saW5l
IGJvb2wKK19fdm1hX21hdGNoZXMoc3RydWN0IHZtX2FyZWFfc3RydWN0ICp2bWEsIHN0cnVjdCBm
aWxlICpmaWxwLAorCSAgICAgIHVuc2lnbmVkIGxvbmcgYWRkciwgdW5zaWduZWQgbG9uZyBzaXpl
KQoreworCWlmICh2bWEtPnZtX2ZpbGUgIT0gZmlscCkKKwkJcmV0dXJuIGZhbHNlOworCisJcmV0
dXJuIHZtYS0+dm1fc3RhcnQgPT0gYWRkciAmJgorCSAgICAgICAodm1hLT52bV9lbmQgLSB2bWEt
PnZtX3N0YXJ0KSA9PSBQQUdFX0FMSUdOKHNpemUpOworfQorCisvKioKKyAqIGk5MTVfZ2VtX21t
YXBfaW9jdGwgLSBNYXBzIHRoZSBjb250ZW50cyBvZiBhbiBvYmplY3QsIHJldHVybmluZyB0aGUg
YWRkcmVzcworICoJCQkgaXQgaXMgbWFwcGVkIHRvLgorICogQGRldjogZHJtIGRldmljZQorICog
QGRhdGE6IGlvY3RsIGRhdGEgYmxvYgorICogQGZpbGU6IGRybSBmaWxlCisgKgorICogV2hpbGUg
dGhlIG1hcHBpbmcgaG9sZHMgYSByZWZlcmVuY2Ugb24gdGhlIGNvbnRlbnRzIG9mIHRoZSBvYmpl
Y3QsIGl0IGRvZXNuJ3QKKyAqIGltcGx5IGEgcmVmIG9uIHRoZSBvYmplY3QgaXRzZWxmLgorICoK
KyAqIElNUE9SVEFOVDoKKyAqCisgKiBEUk0gZHJpdmVyIHdyaXRlcnMgd2hvIGxvb2sgYSB0aGlz
IGZ1bmN0aW9uIGFzIGFuIGV4YW1wbGUgZm9yIGhvdyB0byBkbyBHRU0KKyAqIG1tYXAgc3VwcG9y
dCwgcGxlYXNlIGRvbid0IGltcGxlbWVudCBtbWFwIHN1cHBvcnQgbGlrZSBoZXJlLiBUaGUgbW9k
ZXJuIHdheQorICogdG8gaW1wbGVtZW50IERSTSBtbWFwIHN1cHBvcnQgaXMgd2l0aCBhbiBtbWFw
IG9mZnNldCBpb2N0bCAobGlrZQorICogaTkxNV9nZW1fbW1hcF9ndHQpIGFuZCB0aGVuIHVzaW5n
IHRoZSBtbWFwIHN5c2NhbGwgb24gdGhlIERSTSBmZCBkaXJlY3RseS4KKyAqIFRoYXQgd2F5IGRl
YnVnIHRvb2xpbmcgbGlrZSB2YWxncmluZCB3aWxsIHVuZGVyc3RhbmQgd2hhdCdzIGdvaW5nIG9u
LCBoaWRpbmcKKyAqIHRoZSBtbWFwIGNhbGwgaW4gYSBkcml2ZXIgcHJpdmF0ZSBpb2N0bCB3aWxs
IGJyZWFrIHRoYXQuIFRoZSBpOTE1IGRyaXZlciBvbmx5CisgKiBkb2VzIGNwdSBtbWFwcyB0aGlz
IHdheSBiZWNhdXNlIHdlIGRpZG4ndCBrbm93IGJldHRlci4KKyAqLworaW50CitpOTE1X2dlbV9t
bWFwX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCisJCSAgICBzdHJ1
Y3QgZHJtX2ZpbGUgKmZpbGUpCit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9tbWFwICphcmdzID0g
ZGF0YTsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOworCXVuc2lnbmVkIGxvbmcg
YWRkcjsKKworCWlmIChhcmdzLT5mbGFncyAmIH4oSTkxNV9NTUFQX1dDKSkKKwkJcmV0dXJuIC1F
SU5WQUw7CisKKwlpZiAoYXJncy0+ZmxhZ3MgJiBJOTE1X01NQVBfV0MgJiYgIWJvb3RfY3B1X2hh
cyhYODZfRkVBVFVSRV9QQVQpKQorCQlyZXR1cm4gLUVOT0RFVjsKKworCW9iaiA9IGk5MTVfZ2Vt
X29iamVjdF9sb29rdXAoZmlsZSwgYXJncy0+aGFuZGxlKTsKKwlpZiAoIW9iaikKKwkJcmV0dXJu
IC1FTk9FTlQ7CisKKwkvKiBwcmltZSBvYmplY3RzIGhhdmUgbm8gYmFja2luZyBmaWxwIHRvIEdF
TSBtbWFwCisJICogcGFnZXMgZnJvbS4KKwkgKi8KKwlpZiAoIW9iai0+YmFzZS5maWxwKSB7CisJ
CWFkZHIgPSAtRU5YSU87CisJCWdvdG8gZXJyOworCX0KKworCWlmIChyYW5nZV9vdmVyZmxvd3Mo
YXJncy0+b2Zmc2V0LCBhcmdzLT5zaXplLCAodTY0KW9iai0+YmFzZS5zaXplKSkgeworCQlhZGRy
ID0gLUVJTlZBTDsKKwkJZ290byBlcnI7CisJfQorCisJYWRkciA9IHZtX21tYXAob2JqLT5iYXNl
LmZpbHAsIDAsIGFyZ3MtPnNpemUsCisJCSAgICAgICBQUk9UX1JFQUQgfCBQUk9UX1dSSVRFLCBN
QVBfU0hBUkVELAorCQkgICAgICAgYXJncy0+b2Zmc2V0KTsKKwlpZiAoSVNfRVJSX1ZBTFVFKGFk
ZHIpKQorCQlnb3RvIGVycjsKKworCWlmIChhcmdzLT5mbGFncyAmIEk5MTVfTU1BUF9XQykgewor
CQlzdHJ1Y3QgbW1fc3RydWN0ICptbSA9IGN1cnJlbnQtPm1tOworCQlzdHJ1Y3Qgdm1fYXJlYV9z
dHJ1Y3QgKnZtYTsKKworCQlpZiAoZG93bl93cml0ZV9raWxsYWJsZSgmbW0tPm1tYXBfc2VtKSkg
eworCQkJYWRkciA9IC1FSU5UUjsKKwkJCWdvdG8gZXJyOworCQl9CisJCXZtYSA9IGZpbmRfdm1h
KG1tLCBhZGRyKTsKKwkJaWYgKHZtYSAmJiBfX3ZtYV9tYXRjaGVzKHZtYSwgb2JqLT5iYXNlLmZp
bHAsIGFkZHIsIGFyZ3MtPnNpemUpKQorCQkJdm1hLT52bV9wYWdlX3Byb3QgPQorCQkJCXBncHJv
dF93cml0ZWNvbWJpbmUodm1fZ2V0X3BhZ2VfcHJvdCh2bWEtPnZtX2ZsYWdzKSk7CisJCWVsc2UK
KwkJCWFkZHIgPSAtRU5PTUVNOworCQl1cF93cml0ZSgmbW0tPm1tYXBfc2VtKTsKKwkJaWYgKElT
X0VSUl9WQUxVRShhZGRyKSkKKwkJCWdvdG8gZXJyOworCisJCS8qIFRoaXMgbWF5IHJhY2UsIGJ1
dCB0aGF0J3Mgb2ssIGl0IG9ubHkgZ2V0cyBzZXQgKi8KKwkJV1JJVEVfT05DRShvYmotPmZyb250
YnVmZmVyX2dndHRfb3JpZ2luLCBPUklHSU5fQ1BVKTsKKwl9CisJaTkxNV9nZW1fb2JqZWN0X3B1
dChvYmopOworCisJYXJncy0+YWRkcl9wdHIgPSAodTY0KWFkZHI7CisJcmV0dXJuIDA7CisKK2Vy
cjoKKwlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CisJcmV0dXJuIGFkZHI7Cit9CisKK3N0YXRp
YyB1bnNpZ25lZCBpbnQgdGlsZV9yb3dfcGFnZXMoY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaikKK3sKKwlyZXR1cm4gaTkxNV9nZW1fb2JqZWN0X2dldF90aWxlX3Jvd19zaXpl
KG9iaikgPj4gUEFHRV9TSElGVDsKK30KKworLyoqCisgKiBpOTE1X2dlbV9tbWFwX2d0dF92ZXJz
aW9uIC0gcmVwb3J0IHRoZSBjdXJyZW50IGZlYXR1cmUgc2V0IGZvciBHVFQgbW1hcHMKKyAqCisg
KiBBIGhpc3Rvcnkgb2YgdGhlIEdUVCBtbWFwIGludGVyZmFjZToKKyAqCisgKiAwIC0gRXZlcnl0
aGluZyBoYWQgdG8gZml0IGludG8gdGhlIEdUVC4gQm90aCBwYXJ0aWVzIG9mIGEgbWVtY3B5IGhh
ZCB0bworICogICAgIGFsaWduZWQgYW5kIHN1aXRhYmxlIGZvciBmZW5jaW5nLCBhbmQgc3RpbGwg
Zml0IGludG8gdGhlIGF2YWlsYWJsZQorICogICAgIG1hcHBhYmxlIHNwYWNlIGxlZnQgYnkgdGhl
IHBpbm5lZCBkaXNwbGF5IG9iamVjdHMuIEEgY2xhc3NpYyBwcm9ibGVtCisgKiAgICAgd2UgY2Fs
bGVkIHRoZSBwYWdlLWZhdWx0LW9mLWRvb20gd2hlcmUgd2Ugd291bGQgcGluZy1wb25nIGJldHdl
ZW4KKyAqICAgICB0d28gb2JqZWN0cyB0aGF0IGNvdWxkIG5vdCBmaXQgaW5zaWRlIHRoZSBHVFQg
YW5kIHNvIHRoZSBtZW1jcHkKKyAqICAgICB3b3VsZCBwYWdlIG9uZSBvYmplY3QgaW4gYXQgdGhl
IGV4cGVuc2Ugb2YgdGhlIG90aGVyIGJldHdlZW4gZXZlcnkKKyAqICAgICBzaW5nbGUgYnl0ZS4K
KyAqCisgKiAxIC0gT2JqZWN0cyBjYW4gYmUgYW55IHNpemUsIGFuZCBoYXZlIGFueSBjb21wYXRp
YmxlIGZlbmNpbmcgKFggWSwgb3Igbm9uZQorICogICAgIGFzIHNldCB2aWEgaTkxNV9nZW1fc2V0
X3RpbGluZygpIFtEUk1fSTkxNV9HRU1fU0VUX1RJTElOR10pLiBJZiB0aGUKKyAqICAgICBvYmpl
Y3QgaXMgdG9vIGxhcmdlIGZvciB0aGUgYXZhaWxhYmxlIHNwYWNlIChvciBzaW1wbHkgdG9vIGxh
cmdlCisgKiAgICAgZm9yIHRoZSBtYXBwYWJsZSBhcGVydHVyZSEpLCBhIHZpZXcgaXMgY3JlYXRl
ZCBpbnN0ZWFkIGFuZCBmYXVsdGVkCisgKiAgICAgaW50byB1c2Vyc3BhY2UuIChUaGlzIHZpZXcg
aXMgYWxpZ25lZCBhbmQgc2l6ZWQgYXBwcm9wcmlhdGVseSBmb3IKKyAqICAgICBmZW5jZWQgYWNj
ZXNzLikKKyAqCisgKiAyIC0gUmVjb2duaXNlIFdDIGFzIGEgc2VwYXJhdGUgY2FjaGUgZG9tYWlu
IHNvIHRoYXQgd2UgY2FuIGZsdXNoIHRoZQorICogICAgIGRlbGF5ZWQgd3JpdGVzIHZpYSBHVFQg
YmVmb3JlIHBlcmZvcm1pbmcgZGlyZWN0IGFjY2VzcyB2aWEgV0MuCisgKgorICogMyAtIFJlbW92
ZSBpbXBsaWNpdCBzZXQtZG9tYWluKEdUVCkgYW5kIHN5bmNocm9uaXNhdGlvbiBvbiBpbml0aWFs
CisgKiAgICAgcGFnZWZhdWx0OyBzd2FwaW4gcmVtYWlucyB0cmFuc3BhcmVudC4KKyAqCisgKiBS
ZXN0cmljdGlvbnM6CisgKgorICogICogc25vb3BhYmxlIG9iamVjdHMgY2Fubm90IGJlIGFjY2Vz
c2VkIHZpYSB0aGUgR1RULiBJdCBjYW4gY2F1c2UgbWFjaGluZQorICogICAgaGFuZ3Mgb24gc29t
ZSBhcmNoaXRlY3R1cmVzLCBjb3JydXB0aW9uIG9uIG90aGVycy4gQW4gYXR0ZW1wdCB0byBzZXJ2
aWNlCisgKiAgICBhIEdUVCBwYWdlIGZhdWx0IGZyb20gYSBzbm9vcGFibGUgb2JqZWN0IHdpbGwg
Z2VuZXJhdGUgYSBTSUdCVVMuCisgKgorICogICogdGhlIG9iamVjdCBtdXN0IGJlIGFibGUgdG8g
Zml0IGludG8gUkFNIChwaHlzaWNhbCBtZW1vcnksIHRob3VnaCBubworICogICAgbGltaXRlZCB0
byB0aGUgbWFwcGFibGUgYXBlcnR1cmUpLgorICoKKyAqCisgKiBDYXZlYXRzOgorICoKKyAqICAq
IGEgbmV3IEdUVCBwYWdlIGZhdWx0IHdpbGwgc3luY2hyb25pemUgcmVuZGVyaW5nIGZyb20gdGhl
IEdQVSBhbmQgZmx1c2gKKyAqICAgIGFsbCBkYXRhIHRvIHN5c3RlbSBtZW1vcnkuIFN1YnNlcXVl
bnQgYWNjZXNzIHdpbGwgbm90IGJlIHN5bmNocm9uaXplZC4KKyAqCisgKiAgKiBhbGwgbWFwcGlu
Z3MgYXJlIHJldm9rZWQgb24gcnVudGltZSBkZXZpY2Ugc3VzcGVuZC4KKyAqCisgKiAgKiB0aGVy
ZSBhcmUgb25seSA4LCAxNiBvciAzMiBmZW5jZSByZWdpc3RlcnMgdG8gc2hhcmUgYmV0d2VlbiBh
bGwgdXNlcnMKKyAqICAgIChvbGRlciBtYWNoaW5lcyByZXF1aXJlIGZlbmNlIHJlZ2lzdGVyIGZv
ciBkaXNwbGF5IGFuZCBibGl0dGVyIGFjY2VzcworICogICAgYXMgd2VsbCkuIENvbnRlbnRpb24g
b2YgdGhlIGZlbmNlIHJlZ2lzdGVycyB3aWxsIGNhdXNlIHRoZSBwcmV2aW91cyB1c2VycworICog
ICAgdG8gYmUgdW5tYXBwZWQgYW5kIGFueSBuZXcgYWNjZXNzIHdpbGwgZ2VuZXJhdGUgbmV3IHBh
Z2UgZmF1bHRzLgorICoKKyAqICAqIHJ1bm5pbmcgb3V0IG9mIG1lbW9yeSB3aGlsZSBzZXJ2aWNp
bmcgYSBmYXVsdCBtYXkgZ2VuZXJhdGUgYSBTSUdCVVMsCisgKiAgICByYXRoZXIgdGhhbiB0aGUg
ZXhwZWN0ZWQgU0lHU0VHVi4KKyAqLworaW50IGk5MTVfZ2VtX21tYXBfZ3R0X3ZlcnNpb24odm9p
ZCkKK3sKKwlyZXR1cm4gMzsKK30KKworc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV9nZ3R0X3Zp
ZXcKK2NvbXB1dGVfcGFydGlhbF92aWV3KGNvbnN0IHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmosCisJCSAgICAgcGdvZmZfdCBwYWdlX29mZnNldCwKKwkJICAgICB1bnNpZ25lZCBpbnQg
Y2h1bmspCit7CisJc3RydWN0IGk5MTVfZ2d0dF92aWV3IHZpZXc7CisKKwlpZiAoaTkxNV9nZW1f
b2JqZWN0X2lzX3RpbGVkKG9iaikpCisJCWNodW5rID0gcm91bmR1cChjaHVuaywgdGlsZV9yb3df
cGFnZXMob2JqKSk7CisKKwl2aWV3LnR5cGUgPSBJOTE1X0dHVFRfVklFV19QQVJUSUFMOworCXZp
ZXcucGFydGlhbC5vZmZzZXQgPSByb3VuZGRvd24ocGFnZV9vZmZzZXQsIGNodW5rKTsKKwl2aWV3
LnBhcnRpYWwuc2l6ZSA9CisJCW1pbl90KHVuc2lnbmVkIGludCwgY2h1bmssCisJCSAgICAgIChv
YmotPmJhc2Uuc2l6ZSA+PiBQQUdFX1NISUZUKSAtIHZpZXcucGFydGlhbC5vZmZzZXQpOworCisJ
LyogSWYgdGhlIHBhcnRpYWwgY292ZXJzIHRoZSBlbnRpcmUgb2JqZWN0LCBqdXN0IGNyZWF0ZSBh
IG5vcm1hbCBWTUEuICovCisJaWYgKGNodW5rID49IG9iai0+YmFzZS5zaXplID4+IFBBR0VfU0hJ
RlQpCisJCXZpZXcudHlwZSA9IEk5MTVfR0dUVF9WSUVXX05PUk1BTDsKKworCXJldHVybiB2aWV3
OworfQorCisvKioKKyAqIGk5MTVfZ2VtX2ZhdWx0IC0gZmF1bHQgYSBwYWdlIGludG8gdGhlIEdU
VAorICogQHZtZjogZmF1bHQgaW5mbworICoKKyAqIFRoZSBmYXVsdCBoYW5kbGVyIGlzIHNldCB1
cCBieSBkcm1fZ2VtX21tYXAoKSB3aGVuIGEgb2JqZWN0IGlzIEdUVCBtYXBwZWQKKyAqIGZyb20g
dXNlcnNwYWNlLiAgVGhlIGZhdWx0IGhhbmRsZXIgdGFrZXMgY2FyZSBvZiBiaW5kaW5nIHRoZSBv
YmplY3QgdG8KKyAqIHRoZSBHVFQgKGlmIG5lZWRlZCksIGFsbG9jYXRpbmcgYW5kIHByb2dyYW1t
aW5nIGEgZmVuY2UgcmVnaXN0ZXIgKGFnYWluLAorICogb25seSBpZiBuZWVkZWQgYmFzZWQgb24g
d2hldGhlciB0aGUgb2xkIHJlZyBpcyBzdGlsbCB2YWxpZCBvciB0aGUgb2JqZWN0CisgKiBpcyB0
aWxlZCkgYW5kIGluc2VydGluZyBhIG5ldyBQVEUgaW50byB0aGUgZmF1bHRpbmcgcHJvY2Vzcy4K
KyAqCisgKiBOb3RlIHRoYXQgdGhlIGZhdWx0aW5nIHByb2Nlc3MgbWF5IGludm9sdmUgZXZpY3Rp
bmcgZXhpc3Rpbmcgb2JqZWN0cworICogZnJvbSB0aGUgR1RUIGFuZC9vciBmZW5jZSByZWdpc3Rl
cnMgdG8gbWFrZSByb29tLiAgU28gcGVyZm9ybWFuY2UgbWF5CisgKiBzdWZmZXIgaWYgdGhlIEdU
VCB3b3JraW5nIHNldCBpcyBsYXJnZSBvciB0aGVyZSBhcmUgZmV3IGZlbmNlIHJlZ2lzdGVycwor
ICogbGVmdC4KKyAqCisgKiBUaGUgY3VycmVudCBmZWF0dXJlIHNldCBzdXBwb3J0ZWQgYnkgaTkx
NV9nZW1fZmF1bHQoKSBhbmQgdGh1cyBHVFQgbW1hcHMKKyAqIGlzIGV4cG9zZWQgdmlhIEk5MTVf
UEFSQU1fTU1BUF9HVFRfVkVSU0lPTiAoc2VlIGk5MTVfZ2VtX21tYXBfZ3R0X3ZlcnNpb24pLgor
ICovCit2bV9mYXVsdF90IGk5MTVfZ2VtX2ZhdWx0KHN0cnVjdCB2bV9mYXVsdCAqdm1mKQorewor
I2RlZmluZSBNSU5fQ0hVTktfUEFHRVMgKFNaXzFNID4+IFBBR0VfU0hJRlQpCisJc3RydWN0IHZt
X2FyZWFfc3RydWN0ICphcmVhID0gdm1mLT52bWE7CisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmpl
Y3QgKm9iaiA9IHRvX2ludGVsX2JvKGFyZWEtPnZtX3ByaXZhdGVfZGF0YSk7CisJc3RydWN0IGRy
bV9kZXZpY2UgKmRldiA9IG9iai0+YmFzZS5kZXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSB0b19pOTE1KGRldik7CisJc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCA9ICZpOTE1LT5n
Z3R0OworCWJvb2wgd3JpdGUgPSBhcmVhLT52bV9mbGFncyAmIFZNX1dSSVRFOworCWludGVsX3dh
a2VyZWZfdCB3YWtlcmVmOworCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOworCXBnb2ZmX3QgcGFnZV9v
ZmZzZXQ7CisJaW50IHNyY3U7CisJaW50IHJldDsKKworCS8qIFNhbml0eSBjaGVjayB0aGF0IHdl
IGFsbG93IHdyaXRpbmcgaW50byB0aGlzIG9iamVjdCAqLworCWlmIChpOTE1X2dlbV9vYmplY3Rf
aXNfcmVhZG9ubHkob2JqKSAmJiB3cml0ZSkKKwkJcmV0dXJuIFZNX0ZBVUxUX1NJR0JVUzsKKwor
CS8qIFdlIGRvbid0IHVzZSB2bWYtPnBnb2ZmIHNpbmNlIHRoYXQgaGFzIHRoZSBmYWtlIG9mZnNl
dCAqLworCXBhZ2Vfb2Zmc2V0ID0gKHZtZi0+YWRkcmVzcyAtIGFyZWEtPnZtX3N0YXJ0KSA+PiBQ
QUdFX1NISUZUOworCisJdHJhY2VfaTkxNV9nZW1fb2JqZWN0X2ZhdWx0KG9iaiwgcGFnZV9vZmZz
ZXQsIHRydWUsIHdyaXRlKTsKKworCXJldCA9IGk5MTVfZ2VtX29iamVjdF9waW5fcGFnZXMob2Jq
KTsKKwlpZiAocmV0KQorCQlnb3RvIGVycjsKKworCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3Bt
X2dldChpOTE1KTsKKworCXNyY3UgPSBpOTE1X3Jlc2V0X3RyeWxvY2soaTkxNSk7CisJaWYgKHNy
Y3UgPCAwKSB7CisJCXJldCA9IHNyY3U7CisJCWdvdG8gZXJyX3JwbTsKKwl9CisKKwlyZXQgPSBp
OTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZShkZXYpOworCWlmIChyZXQpCisJCWdvdG8gZXJy
X3Jlc2V0OworCisJLyogQWNjZXNzIHRvIHNub29wYWJsZSBwYWdlcyB0aHJvdWdoIHRoZSBHVFQg
aXMgaW5jb2hlcmVudC4gKi8KKwlpZiAob2JqLT5jYWNoZV9sZXZlbCAhPSBJOTE1X0NBQ0hFX05P
TkUgJiYgIUhBU19MTEMoaTkxNSkpIHsKKwkJcmV0ID0gLUVGQVVMVDsKKwkJZ290byBlcnJfdW5s
b2NrOworCX0KKworCS8qIE5vdyBwaW4gaXQgaW50byB0aGUgR1RUIGFzIG5lZWRlZCAqLworCXZt
YSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihvYmosIE5VTEwsIDAsIDAsCisJCQkJICAgICAg
IFBJTl9NQVBQQUJMRSB8CisJCQkJICAgICAgIFBJTl9OT05CTE9DSyB8CisJCQkJICAgICAgIFBJ
Tl9OT05GQVVMVCk7CisJaWYgKElTX0VSUih2bWEpKSB7CisJCS8qIFVzZSBhIHBhcnRpYWwgdmll
dyBpZiBpdCBpcyBiaWdnZXIgdGhhbiBhdmFpbGFibGUgc3BhY2UgKi8KKwkJc3RydWN0IGk5MTVf
Z2d0dF92aWV3IHZpZXcgPQorCQkJY29tcHV0ZV9wYXJ0aWFsX3ZpZXcob2JqLCBwYWdlX29mZnNl
dCwgTUlOX0NIVU5LX1BBR0VTKTsKKwkJdW5zaWduZWQgaW50IGZsYWdzOworCisJCWZsYWdzID0g
UElOX01BUFBBQkxFOworCQlpZiAodmlldy50eXBlID09IEk5MTVfR0dUVF9WSUVXX05PUk1BTCkK
KwkJCWZsYWdzIHw9IFBJTl9OT05CTE9DSzsgLyogYXZvaWQgd2FybmluZ3MgZm9yIHBpbm5lZCAq
LworCisJCS8qCisJCSAqIFVzZXJzcGFjZSBpcyBub3cgd3JpdGluZyB0aHJvdWdoIGFuIHVudHJh
Y2tlZCBWTUEsIGFiYW5kb24KKwkJICogYWxsIGhvcGUgdGhhdCB0aGUgaGFyZHdhcmUgaXMgYWJs
ZSB0byB0cmFjayBmdXR1cmUgd3JpdGVzLgorCQkgKi8KKwkJb2JqLT5mcm9udGJ1ZmZlcl9nZ3R0
X29yaWdpbiA9IE9SSUdJTl9DUFU7CisKKwkJdm1hID0gaTkxNV9nZW1fb2JqZWN0X2dndHRfcGlu
KG9iaiwgJnZpZXcsIDAsIDAsIGZsYWdzKTsKKwkJaWYgKElTX0VSUih2bWEpICYmICF2aWV3LnR5
cGUpIHsKKwkJCWZsYWdzID0gUElOX01BUFBBQkxFOworCQkJdmlldy50eXBlID0gSTkxNV9HR1RU
X1ZJRVdfUEFSVElBTDsKKwkJCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihvYmosICZ2
aWV3LCAwLCAwLCBmbGFncyk7CisJCX0KKwl9CisJaWYgKElTX0VSUih2bWEpKSB7CisJCXJldCA9
IFBUUl9FUlIodm1hKTsKKwkJZ290byBlcnJfdW5sb2NrOworCX0KKworCXJldCA9IGk5MTVfdm1h
X3Bpbl9mZW5jZSh2bWEpOworCWlmIChyZXQpCisJCWdvdG8gZXJyX3VucGluOworCisJLyogRmlu
YWxseSwgcmVtYXAgaXQgdXNpbmcgdGhlIG5ldyBHVFQgb2Zmc2V0ICovCisJcmV0ID0gcmVtYXBf
aW9fbWFwcGluZyhhcmVhLAorCQkJICAgICAgIGFyZWEtPnZtX3N0YXJ0ICsgKHZtYS0+Z2d0dF92
aWV3LnBhcnRpYWwub2Zmc2V0IDw8IFBBR0VfU0hJRlQpLAorCQkJICAgICAgIChnZ3R0LT5nbWFk
ci5zdGFydCArIHZtYS0+bm9kZS5zdGFydCkgPj4gUEFHRV9TSElGVCwKKwkJCSAgICAgICBtaW5f
dCh1NjQsIHZtYS0+c2l6ZSwgYXJlYS0+dm1fZW5kIC0gYXJlYS0+dm1fc3RhcnQpLAorCQkJICAg
ICAgICZnZ3R0LT5pb21hcCk7CisJaWYgKHJldCkKKwkJZ290byBlcnJfZmVuY2U7CisKKwkvKiBN
YXJrIGFzIGJlaW5nIG1tYXBwZWQgaW50byB1c2Vyc3BhY2UgZm9yIGxhdGVyIHJldm9jYXRpb24g
Ki8KKwlhc3NlcnRfcnBtX3dha2Vsb2NrX2hlbGQoaTkxNSk7CisJaWYgKCFpOTE1X3ZtYV9zZXRf
dXNlcmZhdWx0KHZtYSkgJiYgIW9iai0+dXNlcmZhdWx0X2NvdW50KyspCisJCWxpc3RfYWRkKCZv
YmotPnVzZXJmYXVsdF9saW5rLCAmaTkxNS0+bW0udXNlcmZhdWx0X2xpc3QpOworCUdFTV9CVUdf
T04oIW9iai0+dXNlcmZhdWx0X2NvdW50KTsKKworCWk5MTVfdm1hX3NldF9nZ3R0X3dyaXRlKHZt
YSk7CisKK2Vycl9mZW5jZToKKwlpOTE1X3ZtYV91bnBpbl9mZW5jZSh2bWEpOworZXJyX3VucGlu
OgorCV9faTkxNV92bWFfdW5waW4odm1hKTsKK2Vycl91bmxvY2s6CisJbXV0ZXhfdW5sb2NrKCZk
ZXYtPnN0cnVjdF9tdXRleCk7CitlcnJfcmVzZXQ6CisJaTkxNV9yZXNldF91bmxvY2soaTkxNSwg
c3JjdSk7CitlcnJfcnBtOgorCWludGVsX3J1bnRpbWVfcG1fcHV0KGk5MTUsIHdha2VyZWYpOwor
CWk5MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmopOworZXJyOgorCXN3aXRjaCAocmV0KSB7
CisJY2FzZSAtRUlPOgorCQkvKgorCQkgKiBXZSBlYXQgZXJyb3JzIHdoZW4gdGhlIGdwdSBpcyB0
ZXJtaW5hbGx5IHdlZGdlZCB0byBhdm9pZAorCQkgKiB1c2Vyc3BhY2UgdW5kdWx5IGNyYXNoaW5n
IChnbCBoYXMgbm8gcHJvdmlzaW9ucyBmb3IgbW1hcHMgdG8KKwkJICogZmFpbCkuIEJ1dCBhbnkg
b3RoZXIgLUVJTyBpc24ndCBvdXJzIChlLmcuIHN3YXAgaW4gZmFpbHVyZSkKKwkJICogYW5kIHNv
IG5lZWRzIHRvIGJlIHJlcG9ydGVkLgorCQkgKi8KKwkJaWYgKCFpOTE1X3Rlcm1pbmFsbHlfd2Vk
Z2VkKGk5MTUpKQorCQkJcmV0dXJuIFZNX0ZBVUxUX1NJR0JVUzsKKwkJLyogZWxzZTogZmFsbCB0
aHJvdWdoICovCisJY2FzZSAtRUFHQUlOOgorCQkvKgorCQkgKiBFQUdBSU4gbWVhbnMgdGhlIGdw
dSBpcyBodW5nIGFuZCB3ZSdsbCB3YWl0IGZvciB0aGUgZXJyb3IKKwkJICogaGFuZGxlciB0byBy
ZXNldCBldmVyeXRoaW5nIHdoZW4gcmUtZmF1bHRpbmcgaW4KKwkJICogaTkxNV9tdXRleF9sb2Nr
X2ludGVycnVwdGlibGUuCisJCSAqLworCWNhc2UgMDoKKwljYXNlIC1FUkVTVEFSVFNZUzoKKwlj
YXNlIC1FSU5UUjoKKwljYXNlIC1FQlVTWToKKwkJLyoKKwkJICogRUJVU1kgaXMgb2s6IHRoaXMg
anVzdCBtZWFucyB0aGF0IGFub3RoZXIgdGhyZWFkCisJCSAqIGFscmVhZHkgZGlkIHRoZSBqb2Iu
CisJCSAqLworCQlyZXR1cm4gVk1fRkFVTFRfTk9QQUdFOworCWNhc2UgLUVOT01FTToKKwkJcmV0
dXJuIFZNX0ZBVUxUX09PTTsKKwljYXNlIC1FTk9TUEM6CisJY2FzZSAtRUZBVUxUOgorCQlyZXR1
cm4gVk1fRkFVTFRfU0lHQlVTOworCWRlZmF1bHQ6CisJCVdBUk5fT05DRShyZXQsICJ1bmhhbmRs
ZWQgZXJyb3IgaW4gJXM6ICVpXG4iLCBfX2Z1bmNfXywgcmV0KTsKKwkJcmV0dXJuIFZNX0ZBVUxU
X1NJR0JVUzsKKwl9Cit9CisKK3ZvaWQgX19pOTE1X2dlbV9vYmplY3RfcmVsZWFzZV9tbWFwKHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCit7CisJc3RydWN0IGk5MTVfdm1hICp2bWE7
CisKKwlHRU1fQlVHX09OKCFvYmotPnVzZXJmYXVsdF9jb3VudCk7CisKKwlvYmotPnVzZXJmYXVs
dF9jb3VudCA9IDA7CisJbGlzdF9kZWwoJm9iai0+dXNlcmZhdWx0X2xpbmspOworCWRybV92bWFf
bm9kZV91bm1hcCgmb2JqLT5iYXNlLnZtYV9ub2RlLAorCQkJICAgb2JqLT5iYXNlLmRldi0+YW5v
bl9pbm9kZS0+aV9tYXBwaW5nKTsKKworCWZvcl9lYWNoX2dndHRfdm1hKHZtYSwgb2JqKQorCQlp
OTE1X3ZtYV91bnNldF91c2VyZmF1bHQodm1hKTsKK30KKworLyoqCisgKiBpOTE1X2dlbV9vYmpl
Y3RfcmVsZWFzZV9tbWFwIC0gcmVtb3ZlIHBoeXNpY2FsIHBhZ2UgbWFwcGluZ3MKKyAqIEBvYmo6
IG9iaiBpbiBxdWVzdGlvbgorICoKKyAqIFByZXNlcnZlIHRoZSByZXNlcnZhdGlvbiBvZiB0aGUg
bW1hcHBpbmcgd2l0aCB0aGUgRFJNIGNvcmUgY29kZSwgYnV0CisgKiByZWxpbnF1aXNoIG93bmVy
c2hpcCBvZiB0aGUgcGFnZXMgYmFjayB0byB0aGUgc3lzdGVtLgorICoKKyAqIEl0IGlzIHZpdGFs
IHRoYXQgd2UgcmVtb3ZlIHRoZSBwYWdlIG1hcHBpbmcgaWYgd2UgaGF2ZSBtYXBwZWQgYSB0aWxl
ZAorICogb2JqZWN0IHRocm91Z2ggdGhlIEdUVCBhbmQgdGhlbiBsb3NlIHRoZSBmZW5jZSByZWdp
c3RlciBkdWUgdG8KKyAqIHJlc291cmNlIHByZXNzdXJlLiBTaW1pbGFybHkgaWYgdGhlIG9iamVj
dCBoYXMgYmVlbiBtb3ZlZCBvdXQgb2YgdGhlCisgKiBhcGVydHVyZSwgdGhhbiBwYWdlcyBtYXBw
ZWQgaW50byB1c2Vyc3BhY2UgbXVzdCBiZSByZXZva2VkLiBSZW1vdmluZyB0aGUKKyAqIG1hcHBp
bmcgd2lsbCB0aGVuIHRyaWdnZXIgYSBwYWdlIGZhdWx0IG9uIHRoZSBuZXh0IHVzZXIgYWNjZXNz
LCBhbGxvd2luZworICogZml4dXAgYnkgaTkxNV9nZW1fZmF1bHQoKS4KKyAqLwordm9pZCBpOTE1
X2dlbV9vYmplY3RfcmVsZWFzZV9tbWFwKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmop
Cit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5k
ZXYpOworCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOworCisJLyogU2VyaWFsaXNhdGlvbiBiZXR3
ZWVuIHVzZXIgR1RUIGFjY2VzcyBhbmQgb3VyIGNvZGUgZGVwZW5kcyB1cG9uCisJICogcmV2b2tp
bmcgdGhlIENQVSdzIFBURSB3aGlsc3QgdGhlIG11dGV4IGlzIGhlbGQuIFRoZSBuZXh0IHVzZXIK
KwkgKiBwYWdlZmF1bHQgdGhlbiBoYXMgdG8gd2FpdCB1bnRpbCB3ZSByZWxlYXNlIHRoZSBtdXRl
eC4KKwkgKgorCSAqIE5vdGUgdGhhdCBSUE0gY29tcGxpY2F0ZXMgc29tZXdoYXQgYnkgYWRkaW5n
IGFuIGFkZGl0aW9uYWwKKwkgKiByZXF1aXJlbWVudCB0aGF0IG9wZXJhdGlvbnMgdG8gdGhlIEdH
VFQgYmUgbWFkZSBob2xkaW5nIHRoZSBSUE0KKwkgKiB3YWtlcmVmLgorCSAqLworCWxvY2tkZXBf
YXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCXdha2VyZWYgPSBpbnRlbF9y
dW50aW1lX3BtX2dldChpOTE1KTsKKworCWlmICghb2JqLT51c2VyZmF1bHRfY291bnQpCisJCWdv
dG8gb3V0OworCisJX19pOTE1X2dlbV9vYmplY3RfcmVsZWFzZV9tbWFwKG9iaik7CisKKwkvKiBF
bnN1cmUgdGhhdCB0aGUgQ1BVJ3MgUFRFIGFyZSByZXZva2VkIGFuZCB0aGVyZSBhcmUgbm90IG91
dHN0YW5kaW5nCisJICogbWVtb3J5IHRyYW5zYWN0aW9ucyBmcm9tIHVzZXJzcGFjZSBiZWZvcmUg
d2UgcmV0dXJuLiBUaGUgVExCCisJICogZmx1c2hpbmcgaW1wbGllZCBhYm92ZSBieSBjaGFuZ2lu
ZyB0aGUgUFRFIGFib3ZlICpzaG91bGQqIGJlCisJICogc3VmZmljaWVudCwgYW4gZXh0cmEgYmFy
cmllciBoZXJlIGp1c3QgcHJvdmlkZXMgdXMgd2l0aCBhIGJpdAorCSAqIG9mIHBhcmFub2lkIGRv
Y3VtZW50YXRpb24gYWJvdXQgb3VyIHJlcXVpcmVtZW50IHRvIHNlcmlhbGlzZQorCSAqIG1lbW9y
eSB3cml0ZXMgYmVmb3JlIHRvdWNoaW5nIHJlZ2lzdGVycyAvIEdTTS4KKwkgKi8KKwl3bWIoKTsK
Kworb3V0OgorCWludGVsX3J1bnRpbWVfcG1fcHV0KGk5MTUsIHdha2VyZWYpOworfQorCitzdGF0
aWMgaW50IGNyZWF0ZV9tbWFwX29mZnNldChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
KQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdG9faTkxNShvYmotPmJhc2Uu
ZGV2KTsKKwlpbnQgZXJyOworCisJZXJyID0gZHJtX2dlbV9jcmVhdGVfbW1hcF9vZmZzZXQoJm9i
ai0+YmFzZSk7CisJaWYgKGxpa2VseSghZXJyKSkKKwkJcmV0dXJuIDA7CisKKwkvKiBBdHRlbXB0
IHRvIHJlYXAgc29tZSBtbWFwIHNwYWNlIGZyb20gZGVhZCBvYmplY3RzICovCisJZG8geworCQll
cnIgPSBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGk5MTUsCisJCQkJCSAgICAgSTkxNV9XQUlUX0lO
VEVSUlVQVElCTEUsCisJCQkJCSAgICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOworCQlpZiAoZXJy
KQorCQkJYnJlYWs7CisKKwkJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhpOTE1KTsKKwkJ
ZXJyID0gZHJtX2dlbV9jcmVhdGVfbW1hcF9vZmZzZXQoJm9iai0+YmFzZSk7CisJCWlmICghZXJy
KQorCQkJYnJlYWs7CisKKwl9IHdoaWxlIChmbHVzaF9kZWxheWVkX3dvcmsoJmk5MTUtPmdlbS5y
ZXRpcmVfd29yaykpOworCisJcmV0dXJuIGVycjsKK30KKworaW50CitpOTE1X2dlbV9tbWFwX2d0
dChzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUsCisJCSAgc3RydWN0IGRybV9kZXZpY2UgKmRldiwKKwkJ
ICB1MzIgaGFuZGxlLAorCQkgIHU2NCAqb2Zmc2V0KQoreworCXN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmo7CisJaW50IHJldDsKKworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9sb29rdXAo
ZmlsZSwgaGFuZGxlKTsKKwlpZiAoIW9iaikKKwkJcmV0dXJuIC1FTk9FTlQ7CisKKwlyZXQgPSBj
cmVhdGVfbW1hcF9vZmZzZXQob2JqKTsKKwlpZiAocmV0ID09IDApCisJCSpvZmZzZXQgPSBkcm1f
dm1hX25vZGVfb2Zmc2V0X2FkZHIoJm9iai0+YmFzZS52bWFfbm9kZSk7CisKKwlpOTE1X2dlbV9v
YmplY3RfcHV0KG9iaik7CisJcmV0dXJuIHJldDsKK30KKworLyoqCisgKiBpOTE1X2dlbV9tbWFw
X2d0dF9pb2N0bCAtIHByZXBhcmUgYW4gb2JqZWN0IGZvciBHVFQgbW1hcCdpbmcKKyAqIEBkZXY6
IERSTSBkZXZpY2UKKyAqIEBkYXRhOiBHVFQgbWFwcGluZyBpb2N0bCBkYXRhCisgKiBAZmlsZTog
R0VNIG9iamVjdCBpbmZvCisgKgorICogU2ltcGx5IHJldHVybnMgdGhlIGZha2Ugb2Zmc2V0IHRv
IHVzZXJzcGFjZSBzbyBpdCBjYW4gbW1hcCBpdC4KKyAqIFRoZSBtbWFwIGNhbGwgd2lsbCBlbmQg
dXAgaW4gZHJtX2dlbV9tbWFwKCksIHdoaWNoIHdpbGwgc2V0IHRoaW5ncworICogdXAgc28gd2Ug
Y2FuIGdldCBmYXVsdHMgaW4gdGhlIGhhbmRsZXIgYWJvdmUuCisgKgorICogVGhlIGZhdWx0IGhh
bmRsZXIgd2lsbCB0YWtlIGNhcmUgb2YgYmluZGluZyB0aGUgb2JqZWN0IGludG8gdGhlIEdUVAor
ICogKHNpbmNlIGl0IG1heSBoYXZlIGJlZW4gZXZpY3RlZCB0byBtYWtlIHJvb20gZm9yIHNvbWV0
aGluZyksIGFsbG9jYXRpbmcKKyAqIGEgZmVuY2UgcmVnaXN0ZXIsIGFuZCBtYXBwaW5nIHRoZSBh
cHByb3ByaWF0ZSBhcGVydHVyZSBhZGRyZXNzIGludG8KKyAqIHVzZXJzcGFjZS4KKyAqLworaW50
CitpOTE1X2dlbV9tbWFwX2d0dF9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpk
YXRhLAorCQkJc3RydWN0IGRybV9maWxlICpmaWxlKQoreworCXN0cnVjdCBkcm1faTkxNV9nZW1f
bW1hcF9ndHQgKmFyZ3MgPSBkYXRhOworCisJcmV0dXJuIGk5MTVfZ2VtX21tYXBfZ3R0KGZpbGUs
IGRldiwgYXJncy0+aGFuZGxlLCAmYXJncy0+b2Zmc2V0KTsKK30KKworI2lmIElTX0VOQUJMRUQo
Q09ORklHX0RSTV9JOTE1X1NFTEZURVNUKQorI2luY2x1ZGUgInNlbGZ0ZXN0cy9pOTE1X2dlbV9t
bWFuLmMiCisjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9vYmplY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3Qu
YwppbmRleCA4NmU3ZTg4ODE3YWYuLjAwNWUxN2IzYWNjZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYwpAQCAtMjYsNiArMjYsNyBAQAogCiAjaW5jbHVkZSAi
Li4vaTkxNV9kcnYuaCIKICNpbmNsdWRlICIuLi9pOTE1X2dsb2JhbHMuaCIKKyNpbmNsdWRlICIu
Li9pOTE1X2dlbV9jbGZsdXNoLmgiCiAjaW5jbHVkZSAiLi4vaW50ZWxfZnJvbnRidWZmZXIuaCIK
IAogc3RhdGljIHN0cnVjdCBpOTE1X2dsb2JhbF9vYmplY3QgewpAQCAtMzU3LDYgKzM1OCw2MSBA
QCB2b2lkIF9faTkxNV9nZW1fb2JqZWN0X3JlbGVhc2VfdW5sZXNzX2FjdGl2ZShzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqKQogCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CiB9CiAK
K3N0YXRpYyBpbmxpbmUgZW51bSBmYl9vcF9vcmlnaW4KK2ZiX3dyaXRlX29yaWdpbihzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCB1bnNpZ25lZCBpbnQgZG9tYWluKQoreworCXJldHVy
biAoZG9tYWluID09IEk5MTVfR0VNX0RPTUFJTl9HVFQgPworCQlvYmotPmZyb250YnVmZmVyX2dn
dHRfb3JpZ2luIDogT1JJR0lOX0NQVSk7Cit9CisKK3N0YXRpYyBib29sIGdwdV93cml0ZV9uZWVk
c19jbGZsdXNoKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCit7CisJcmV0dXJuICEo
b2JqLT5jYWNoZV9sZXZlbCA9PSBJOTE1X0NBQ0hFX05PTkUgfHwKKwkJIG9iai0+Y2FjaGVfbGV2
ZWwgPT0gSTkxNV9DQUNIRV9XVCk7Cit9CisKK3ZvaWQKK2k5MTVfZ2VtX29iamVjdF9mbHVzaF93
cml0ZV9kb21haW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKKwkJCQkgICB1bnNp
Z25lZCBpbnQgZmx1c2hfZG9tYWlucykKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOworCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwor
CisJaWYgKCEob2JqLT53cml0ZV9kb21haW4gJiBmbHVzaF9kb21haW5zKSkKKwkJcmV0dXJuOwor
CisJc3dpdGNoIChvYmotPndyaXRlX2RvbWFpbikgeworCWNhc2UgSTkxNV9HRU1fRE9NQUlOX0dU
VDoKKwkJaTkxNV9nZW1fZmx1c2hfZ2d0dF93cml0ZXMoZGV2X3ByaXYpOworCisJCWludGVsX2Zi
X29ial9mbHVzaChvYmosCisJCQkJICAgZmJfd3JpdGVfb3JpZ2luKG9iaiwgSTkxNV9HRU1fRE9N
QUlOX0dUVCkpOworCisJCWZvcl9lYWNoX2dndHRfdm1hKHZtYSwgb2JqKSB7CisJCQlpZiAodm1h
LT5pb21hcCkKKwkJCQljb250aW51ZTsKKworCQkJaTkxNV92bWFfdW5zZXRfZ2d0dF93cml0ZSh2
bWEpOworCQl9CisJCWJyZWFrOworCisJY2FzZSBJOTE1X0dFTV9ET01BSU5fV0M6CisJCXdtYigp
OworCQlicmVhazsKKworCWNhc2UgSTkxNV9HRU1fRE9NQUlOX0NQVToKKwkJaTkxNV9nZW1fY2xm
bHVzaF9vYmplY3Qob2JqLCBJOTE1X0NMRkxVU0hfU1lOQyk7CisJCWJyZWFrOworCisJY2FzZSBJ
OTE1X0dFTV9ET01BSU5fUkVOREVSOgorCQlpZiAoZ3B1X3dyaXRlX25lZWRzX2NsZmx1c2gob2Jq
KSkKKwkJCW9iai0+Y2FjaGVfZGlydHkgPSB0cnVlOworCQlicmVhazsKKwl9CisKKwlvYmotPndy
aXRlX2RvbWFpbiA9IDA7Cit9CisKIHZvaWQgaTkxNV9nZW1faW5pdF9fb2JqZWN0cyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlJTklUX1dPUksoJmk5MTUtPm1tLmZyZWVfd29y
aywgX19pOTE1X2dlbV9mcmVlX3dvcmspOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX29iamVjdC5oCmluZGV4IDJlOTYzYTU5MzI0NS4uOWJmODE1NWQyN2RlIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oCkBAIC0zNDYsNiArMzQ2LDEzIEBA
IHN0YXRpYyBpbmxpbmUgdm9pZCBpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmopCiAJaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKG9iaik7
CiB9CiAKK3ZvaWQgX19pOTE1X2dlbV9vYmplY3RfcmVsZWFzZV9tbWFwKHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmopOwordm9pZCBpOTE1X2dlbV9vYmplY3RfcmVsZWFzZV9tbWFwKHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopOworCit2b2lkCitpOTE1X2dlbV9vYmplY3Rf
Zmx1c2hfd3JpdGVfZG9tYWluKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCisJCQkJ
ICAgdW5zaWduZWQgaW50IGZsdXNoX2RvbWFpbnMpOworCiBzdGF0aWMgaW5saW5lIHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKgogaTkxNV9nZW1fb2JqZWN0X2xhc3Rfd3JpdGVfZW5naW5lKHN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0Cmlu
ZGV4IDAwMDAwMDAwMDAwMC4uODdkYTAxMjMwMTc5Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMKQEAgLTAsMCArMSw1
MDMgQEAKKy8qCisgKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUCisgKgorICogQ29weXJp
Z2h0IMKpIDIwMTYgSW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaW5jbHVkZSA8bGludXgvcHJp
bWVfbnVtYmVycy5oPgorCisjaW5jbHVkZSAiZ3QvaW50ZWxfZ3RfcG0uaCIKKyNpbmNsdWRlICJp
OTE1X3NlbGZ0ZXN0LmgiCisjaW5jbHVkZSAic2VsZnRlc3RzL2h1Z2VfZ2VtX29iamVjdC5oIgor
I2luY2x1ZGUgInNlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5oIgorCitzdHJ1Y3QgdGlsZSB7CisJ
dW5zaWduZWQgaW50IHdpZHRoOworCXVuc2lnbmVkIGludCBoZWlnaHQ7CisJdW5zaWduZWQgaW50
IHN0cmlkZTsKKwl1bnNpZ25lZCBpbnQgc2l6ZTsKKwl1bnNpZ25lZCBpbnQgdGlsaW5nOworCXVu
c2lnbmVkIGludCBzd2l6emxlOworfTsKKworc3RhdGljIHU2NCBzd2l6emxlX2JpdCh1bnNpZ25l
ZCBpbnQgYml0LCB1NjQgb2Zmc2V0KQoreworCXJldHVybiAob2Zmc2V0ICYgQklUX1VMTChiaXQp
KSA+PiAoYml0IC0gNik7Cit9CisKK3N0YXRpYyB1NjQgdGlsZWRfb2Zmc2V0KGNvbnN0IHN0cnVj
dCB0aWxlICp0aWxlLCB1NjQgdikKK3sKKwl1NjQgeCwgeTsKKworCWlmICh0aWxlLT50aWxpbmcg
PT0gSTkxNV9USUxJTkdfTk9ORSkKKwkJcmV0dXJuIHY7CisKKwl5ID0gZGl2NjRfdTY0X3JlbSh2
LCB0aWxlLT5zdHJpZGUsICZ4KTsKKwl2ID0gZGl2NjRfdTY0X3JlbSh5LCB0aWxlLT5oZWlnaHQs
ICZ5KSAqIHRpbGUtPnN0cmlkZSAqIHRpbGUtPmhlaWdodDsKKworCWlmICh0aWxlLT50aWxpbmcg
PT0gSTkxNV9USUxJTkdfWCkgeworCQl2ICs9IHkgKiB0aWxlLT53aWR0aDsKKwkJdiArPSBkaXY2
NF91NjRfcmVtKHgsIHRpbGUtPndpZHRoLCAmeCkgPDwgdGlsZS0+c2l6ZTsKKwkJdiArPSB4Owor
CX0gZWxzZSBpZiAodGlsZS0+d2lkdGggPT0gMTI4KSB7CisJCWNvbnN0IHVuc2lnbmVkIGludCB5
dGlsZV9zcGFuID0gMTY7CisJCWNvbnN0IHVuc2lnbmVkIGludCB5dGlsZV9oZWlnaHQgPSA1MTI7
CisKKwkJdiArPSB5ICogeXRpbGVfc3BhbjsKKwkJdiArPSBkaXY2NF91NjRfcmVtKHgsIHl0aWxl
X3NwYW4sICZ4KSAqIHl0aWxlX2hlaWdodDsKKwkJdiArPSB4OworCX0gZWxzZSB7CisJCWNvbnN0
IHVuc2lnbmVkIGludCB5dGlsZV9zcGFuID0gMzI7CisJCWNvbnN0IHVuc2lnbmVkIGludCB5dGls
ZV9oZWlnaHQgPSAyNTY7CisKKwkJdiArPSB5ICogeXRpbGVfc3BhbjsKKwkJdiArPSBkaXY2NF91
NjRfcmVtKHgsIHl0aWxlX3NwYW4sICZ4KSAqIHl0aWxlX2hlaWdodDsKKwkJdiArPSB4OworCX0K
KworCXN3aXRjaCAodGlsZS0+c3dpenpsZSkgeworCWNhc2UgSTkxNV9CSVRfNl9TV0laWkxFXzk6
CisJCXYgXj0gc3dpenpsZV9iaXQoOSwgdik7CisJCWJyZWFrOworCWNhc2UgSTkxNV9CSVRfNl9T
V0laWkxFXzlfMTA6CisJCXYgXj0gc3dpenpsZV9iaXQoOSwgdikgXiBzd2l6emxlX2JpdCgxMCwg
dik7CisJCWJyZWFrOworCWNhc2UgSTkxNV9CSVRfNl9TV0laWkxFXzlfMTE6CisJCXYgXj0gc3dp
enpsZV9iaXQoOSwgdikgXiBzd2l6emxlX2JpdCgxMSwgdik7CisJCWJyZWFrOworCWNhc2UgSTkx
NV9CSVRfNl9TV0laWkxFXzlfMTBfMTE6CisJCXYgXj0gc3dpenpsZV9iaXQoOSwgdikgXiBzd2l6
emxlX2JpdCgxMCwgdikgXiBzd2l6emxlX2JpdCgxMSwgdik7CisJCWJyZWFrOworCX0KKworCXJl
dHVybiB2OworfQorCitzdGF0aWMgaW50IGNoZWNrX3BhcnRpYWxfbWFwcGluZyhzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqLAorCQkJCSBjb25zdCBzdHJ1Y3QgdGlsZSAqdGlsZSwKKwkJ
CQkgdW5zaWduZWQgbG9uZyBlbmRfdGltZSkKK3sKKwljb25zdCB1bnNpZ25lZCBpbnQgbnJlYWwg
PSBvYmotPnNjcmF0Y2ggLyBQQUdFX1NJWkU7CisJY29uc3QgdW5zaWduZWQgbG9uZyBucGFnZXMg
PSBvYmotPmJhc2Uuc2l6ZSAvIFBBR0VfU0laRTsKKwlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKKwl1
bnNpZ25lZCBsb25nIHBhZ2U7CisJaW50IGVycjsKKworCWlmIChpZ3RfdGltZW91dChlbmRfdGlt
ZSwKKwkJCSIlczogdGltZWQgb3V0IGJlZm9yZSB0aWxpbmc9JWQgc3RyaWRlPSVkXG4iLAorCQkJ
X19mdW5jX18sIHRpbGUtPnRpbGluZywgdGlsZS0+c3RyaWRlKSkKKwkJcmV0dXJuIC1FSU5UUjsK
KworCWVyciA9IGk5MTVfZ2VtX29iamVjdF9zZXRfdGlsaW5nKG9iaiwgdGlsZS0+dGlsaW5nLCB0
aWxlLT5zdHJpZGUpOworCWlmIChlcnIpIHsKKwkJcHJfZXJyKCJGYWlsZWQgdG8gc2V0IHRpbGlu
ZyBtb2RlPSV1LCBzdHJpZGU9JXUsIGVycj0lZFxuIiwKKwkJICAgICAgIHRpbGUtPnRpbGluZywg
dGlsZS0+c3RyaWRlLCBlcnIpOworCQlyZXR1cm4gZXJyOworCX0KKworCUdFTV9CVUdfT04oaTkx
NV9nZW1fb2JqZWN0X2dldF90aWxpbmcob2JqKSAhPSB0aWxlLT50aWxpbmcpOworCUdFTV9CVUdf
T04oaTkxNV9nZW1fb2JqZWN0X2dldF9zdHJpZGUob2JqKSAhPSB0aWxlLT5zdHJpZGUpOworCisJ
Zm9yX2VhY2hfcHJpbWVfbnVtYmVyX2Zyb20ocGFnZSwgMSwgbnBhZ2VzKSB7CisJCXN0cnVjdCBp
OTE1X2dndHRfdmlldyB2aWV3ID0KKwkJCWNvbXB1dGVfcGFydGlhbF92aWV3KG9iaiwgcGFnZSwg
TUlOX0NIVU5LX1BBR0VTKTsKKwkJdTMyIF9faW9tZW0gKmlvOworCQlzdHJ1Y3QgcGFnZSAqcDsK
KwkJdW5zaWduZWQgaW50IG47CisJCXU2NCBvZmZzZXQ7CisJCXUzMiAqY3B1OworCisJCUdFTV9C
VUdfT04odmlldy5wYXJ0aWFsLnNpemUgPiBucmVhbCk7CisJCWNvbmRfcmVzY2hlZCgpOworCisJ
CWVyciA9IGk5MTVfZ2VtX29iamVjdF9zZXRfdG9fZ3R0X2RvbWFpbihvYmosIHRydWUpOworCQlp
ZiAoZXJyKSB7CisJCQlwcl9lcnIoIkZhaWxlZCB0byBmbHVzaCB0byBHVFQgd3JpdGUgZG9tYWlu
OyBlcnI9JWRcbiIsCisJCQkgICAgICAgZXJyKTsKKwkJCXJldHVybiBlcnI7CisJCX0KKworCQl2
bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4ob2JqLCAmdmlldywgMCwgMCwgUElOX01BUFBB
QkxFKTsKKwkJaWYgKElTX0VSUih2bWEpKSB7CisJCQlwcl9lcnIoIkZhaWxlZCB0byBwaW4gcGFy
dGlhbCB2aWV3OiBvZmZzZXQ9JWx1OyBlcnI9JWRcbiIsCisJCQkgICAgICAgcGFnZSwgKGludClQ
VFJfRVJSKHZtYSkpOworCQkJcmV0dXJuIFBUUl9FUlIodm1hKTsKKwkJfQorCisJCW4gPSBwYWdl
IC0gdmlldy5wYXJ0aWFsLm9mZnNldDsKKwkJR0VNX0JVR19PTihuID49IHZpZXcucGFydGlhbC5z
aXplKTsKKworCQlpbyA9IGk5MTVfdm1hX3Bpbl9pb21hcCh2bWEpOworCQlpOTE1X3ZtYV91bnBp
bih2bWEpOworCQlpZiAoSVNfRVJSKGlvKSkgeworCQkJcHJfZXJyKCJGYWlsZWQgdG8gaW9tYXAg
cGFydGlhbCB2aWV3OiBvZmZzZXQ9JWx1OyBlcnI9JWRcbiIsCisJCQkgICAgICAgcGFnZSwgKGlu
dClQVFJfRVJSKGlvKSk7CisJCQlyZXR1cm4gUFRSX0VSUihpbyk7CisJCX0KKworCQlpb3dyaXRl
MzIocGFnZSwgaW8gKyBuICogUEFHRV9TSVpFIC8gc2l6ZW9mKCppbykpOworCQlpOTE1X3ZtYV91
bnBpbl9pb21hcCh2bWEpOworCisJCW9mZnNldCA9IHRpbGVkX29mZnNldCh0aWxlLCBwYWdlIDw8
IFBBR0VfU0hJRlQpOworCQlpZiAob2Zmc2V0ID49IG9iai0+YmFzZS5zaXplKQorCQkJY29udGlu
dWU7CisKKwkJaTkxNV9nZW1fb2JqZWN0X2ZsdXNoX3dyaXRlX2RvbWFpbihvYmosIH5JOTE1X0dF
TV9ET01BSU5fQ1BVKTsKKworCQlwID0gaTkxNV9nZW1fb2JqZWN0X2dldF9wYWdlKG9iaiwgb2Zm
c2V0ID4+IFBBR0VfU0hJRlQpOworCQljcHUgPSBrbWFwKHApICsgb2Zmc2V0X2luX3BhZ2Uob2Zm
c2V0KTsKKwkJZHJtX2NsZmx1c2hfdmlydF9yYW5nZShjcHUsIHNpemVvZigqY3B1KSk7CisJCWlm
ICgqY3B1ICE9ICh1MzIpcGFnZSkgeworCQkJcHJfZXJyKCJQYXJ0aWFsIHZpZXcgZm9yICVsdSBb
JXVdIChvZmZzZXQ9JWxsdSwgc2l6ZT0ldSBbJWxsdSwgcm93IHNpemUgJXVdLCBmZW5jZT0lZCwg
dGlsaW5nPSVkLCBzdHJpZGU9JWQpIG1pc2FsaWdubWVudCwgZXhwZWN0ZWQgd3JpdGUgdG8gcGFn
ZSAoJWxsdSArICV1IFsweCVsbHhdKSBvZiAweCV4LCBmb3VuZCAweCV4XG4iLAorCQkJICAgICAg
IHBhZ2UsIG4sCisJCQkgICAgICAgdmlldy5wYXJ0aWFsLm9mZnNldCwKKwkJCSAgICAgICB2aWV3
LnBhcnRpYWwuc2l6ZSwKKwkJCSAgICAgICB2bWEtPnNpemUgPj4gUEFHRV9TSElGVCwKKwkJCSAg
ICAgICB0aWxlLT50aWxpbmcgPyB0aWxlX3Jvd19wYWdlcyhvYmopIDogMCwKKwkJCSAgICAgICB2
bWEtPmZlbmNlID8gdm1hLT5mZW5jZS0+aWQgOiAtMSwgdGlsZS0+dGlsaW5nLCB0aWxlLT5zdHJp
ZGUsCisJCQkgICAgICAgb2Zmc2V0ID4+IFBBR0VfU0hJRlQsCisJCQkgICAgICAgKHVuc2lnbmVk
IGludClvZmZzZXRfaW5fcGFnZShvZmZzZXQpLAorCQkJICAgICAgIG9mZnNldCwKKwkJCSAgICAg
ICAodTMyKXBhZ2UsICpjcHUpOworCQkJZXJyID0gLUVJTlZBTDsKKwkJfQorCQkqY3B1ID0gMDsK
KwkJZHJtX2NsZmx1c2hfdmlydF9yYW5nZShjcHUsIHNpemVvZigqY3B1KSk7CisJCWt1bm1hcChw
KTsKKwkJaWYgKGVycikKKwkJCXJldHVybiBlcnI7CisKKwkJaTkxNV92bWFfZGVzdHJveSh2bWEp
OworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGlndF9wYXJ0aWFsX3RpbGluZyh2
b2lkICphcmcpCit7CisJY29uc3QgdW5zaWduZWQgaW50IG5yZWFsID0gMSA8PCAxMjsgLyogbGFy
Z2VzdCB0aWxlIHJvdyB4MiAqLworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJn
OworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CisJaW50ZWxfd2FrZXJlZl90IHdh
a2VyZWY7CisJaW50IHRpbGluZzsKKwlpbnQgZXJyOworCisJLyogV2Ugd2FudCB0byBjaGVjayB0
aGUgcGFnZSBtYXBwaW5nIGFuZCBmZW5jaW5nIG9mIGEgbGFyZ2Ugb2JqZWN0CisJICogbW1hcHBl
ZCB0aHJvdWdoIHRoZSBHVFQuIFRoZSBvYmplY3Qgd2UgY3JlYXRlIGlzIGxhcmdlciB0aGFuIGNh
bgorCSAqIHBvc3NpYmx5IGJlIG1tYXBlZCBhcyBhIHdob2xlLCBhbmQgc28gd2UgbXVzdCB1c2Ug
cGFydGlhbCBHR1RUIHZtYS4KKwkgKiBXZSB0aGVuIGNoZWNrIHRoYXQgYSB3cml0ZSB0aHJvdWdo
IGVhY2ggcGFydGlhbCBHR1RUIHZtYSBlbmRzIHVwCisJICogaW4gdGhlIHJpZ2h0IHNldCBvZiBw
YWdlcyB3aXRoaW4gdGhlIG9iamVjdCwgYW5kIHdpdGggdGhlIGV4cGVjdGVkCisJICogdGlsaW5n
LCB3aGljaCB3ZSB2ZXJpZnkgYnkgbWFudWFsIHN3aXp6bGluZy4KKwkgKi8KKworCW9iaiA9IGh1
Z2VfZ2VtX29iamVjdChpOTE1LAorCQkJICAgICAgbnJlYWwgPDwgUEFHRV9TSElGVCwKKwkJCSAg
ICAgICgxICsgbmV4dF9wcmltZV9udW1iZXIoaTkxNS0+Z2d0dC52bS50b3RhbCA+PiBQQUdFX1NI
SUZUKSkgPDwgUEFHRV9TSElGVCk7CisJaWYgKElTX0VSUihvYmopKQorCQlyZXR1cm4gUFRSX0VS
UihvYmopOworCisJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9wYWdlcyhvYmopOworCWlmIChl
cnIpIHsKKwkJcHJfZXJyKCJGYWlsZWQgdG8gYWxsb2NhdGUgJXUgcGFnZXMgKCVsdSB0b3RhbCks
IGVycj0lZFxuIiwKKwkJICAgICAgIG5yZWFsLCBvYmotPmJhc2Uuc2l6ZSAvIFBBR0VfU0laRSwg
ZXJyKTsKKwkJZ290byBvdXQ7CisJfQorCisJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CisJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KGk5MTUpOworCisJaWYgKDEp
IHsKKwkJSUdUX1RJTUVPVVQoZW5kKTsKKwkJc3RydWN0IHRpbGUgdGlsZTsKKworCQl0aWxlLmhl
aWdodCA9IDE7CisJCXRpbGUud2lkdGggPSAxOworCQl0aWxlLnNpemUgPSAwOworCQl0aWxlLnN0
cmlkZSA9IDA7CisJCXRpbGUuc3dpenpsZSA9IEk5MTVfQklUXzZfU1dJWlpMRV9OT05FOworCQl0
aWxlLnRpbGluZyA9IEk5MTVfVElMSU5HX05PTkU7CisKKwkJZXJyID0gY2hlY2tfcGFydGlhbF9t
YXBwaW5nKG9iaiwgJnRpbGUsIGVuZCk7CisJCWlmIChlcnIgJiYgZXJyICE9IC1FSU5UUikKKwkJ
CWdvdG8gb3V0X3VubG9jazsKKwl9CisKKwlmb3IgKHRpbGluZyA9IEk5MTVfVElMSU5HX1g7IHRp
bGluZyA8PSBJOTE1X1RJTElOR19ZOyB0aWxpbmcrKykgeworCQlJR1RfVElNRU9VVChlbmQpOwor
CQl1bnNpZ25lZCBpbnQgbWF4X3BpdGNoOworCQl1bnNpZ25lZCBpbnQgcGl0Y2g7CisJCXN0cnVj
dCB0aWxlIHRpbGU7CisKKwkJaWYgKGk5MTUtPnF1aXJrcyAmIFFVSVJLX1BJTl9TV0laWkxFRF9Q
QUdFUykKKwkJCS8qCisJCQkgKiBUaGUgc3dpenpsaW5nIHBhdHRlcm4gaXMgYWN0dWFsbHkgdW5r
bm93biBhcyBpdAorCQkJICogdmFyaWVzIGJhc2VkIG9uIHBoeXNpY2FsIGFkZHJlc3Mgb2YgZWFj
aCBwYWdlLgorCQkJICogU2VlIGk5MTVfZ2VtX2RldGVjdF9iaXRfNl9zd2l6emxlKCkuCisJCQkg
Ki8KKwkJCWJyZWFrOworCisJCXRpbGUudGlsaW5nID0gdGlsaW5nOworCQlzd2l0Y2ggKHRpbGlu
ZykgeworCQljYXNlIEk5MTVfVElMSU5HX1g6CisJCQl0aWxlLnN3aXp6bGUgPSBpOTE1LT5tbS5i
aXRfNl9zd2l6emxlX3g7CisJCQlicmVhazsKKwkJY2FzZSBJOTE1X1RJTElOR19ZOgorCQkJdGls
ZS5zd2l6emxlID0gaTkxNS0+bW0uYml0XzZfc3dpenpsZV95OworCQkJYnJlYWs7CisJCX0KKwor
CQlHRU1fQlVHX09OKHRpbGUuc3dpenpsZSA9PSBJOTE1X0JJVF82X1NXSVpaTEVfVU5LTk9XTik7
CisJCWlmICh0aWxlLnN3aXp6bGUgPT0gSTkxNV9CSVRfNl9TV0laWkxFXzlfMTcgfHwKKwkJICAg
IHRpbGUuc3dpenpsZSA9PSBJOTE1X0JJVF82X1NXSVpaTEVfOV8xMF8xNykKKwkJCWNvbnRpbnVl
OworCisJCWlmIChJTlRFTF9HRU4oaTkxNSkgPD0gMikgeworCQkJdGlsZS5oZWlnaHQgPSAxNjsK
KwkJCXRpbGUud2lkdGggPSAxMjg7CisJCQl0aWxlLnNpemUgPSAxMTsKKwkJfSBlbHNlIGlmICh0
aWxlLnRpbGluZyA9PSBJOTE1X1RJTElOR19ZICYmCisJCQkgICBIQVNfMTI4X0JZVEVfWV9USUxJ
TkcoaTkxNSkpIHsKKwkJCXRpbGUuaGVpZ2h0ID0gMzI7CisJCQl0aWxlLndpZHRoID0gMTI4Owor
CQkJdGlsZS5zaXplID0gMTI7CisJCX0gZWxzZSB7CisJCQl0aWxlLmhlaWdodCA9IDg7CisJCQl0
aWxlLndpZHRoID0gNTEyOworCQkJdGlsZS5zaXplID0gMTI7CisJCX0KKworCQlpZiAoSU5URUxf
R0VOKGk5MTUpIDwgNCkKKwkJCW1heF9waXRjaCA9IDgxOTIgLyB0aWxlLndpZHRoOworCQllbHNl
IGlmIChJTlRFTF9HRU4oaTkxNSkgPCA3KQorCQkJbWF4X3BpdGNoID0gMTI4ICogSTk2NV9GRU5D
RV9NQVhfUElUQ0hfVkFMIC8gdGlsZS53aWR0aDsKKwkJZWxzZQorCQkJbWF4X3BpdGNoID0gMTI4
ICogR0VON19GRU5DRV9NQVhfUElUQ0hfVkFMIC8gdGlsZS53aWR0aDsKKworCQlmb3IgKHBpdGNo
ID0gbWF4X3BpdGNoOyBwaXRjaDsgcGl0Y2ggPj49IDEpIHsKKwkJCXRpbGUuc3RyaWRlID0gdGls
ZS53aWR0aCAqIHBpdGNoOworCQkJZXJyID0gY2hlY2tfcGFydGlhbF9tYXBwaW5nKG9iaiwgJnRp
bGUsIGVuZCk7CisJCQlpZiAoZXJyID09IC1FSU5UUikKKwkJCQlnb3RvIG5leHRfdGlsaW5nOwor
CQkJaWYgKGVycikKKwkJCQlnb3RvIG91dF91bmxvY2s7CisKKwkJCWlmIChwaXRjaCA+IDIgJiYg
SU5URUxfR0VOKGk5MTUpID49IDQpIHsKKwkJCQl0aWxlLnN0cmlkZSA9IHRpbGUud2lkdGggKiAo
cGl0Y2ggLSAxKTsKKwkJCQllcnIgPSBjaGVja19wYXJ0aWFsX21hcHBpbmcob2JqLCAmdGlsZSwg
ZW5kKTsKKwkJCQlpZiAoZXJyID09IC1FSU5UUikKKwkJCQkJZ290byBuZXh0X3RpbGluZzsKKwkJ
CQlpZiAoZXJyKQorCQkJCQlnb3RvIG91dF91bmxvY2s7CisJCQl9CisKKwkJCWlmIChwaXRjaCA8
IG1heF9waXRjaCAmJiBJTlRFTF9HRU4oaTkxNSkgPj0gNCkgeworCQkJCXRpbGUuc3RyaWRlID0g
dGlsZS53aWR0aCAqIChwaXRjaCArIDEpOworCQkJCWVyciA9IGNoZWNrX3BhcnRpYWxfbWFwcGlu
ZyhvYmosICZ0aWxlLCBlbmQpOworCQkJCWlmIChlcnIgPT0gLUVJTlRSKQorCQkJCQlnb3RvIG5l
eHRfdGlsaW5nOworCQkJCWlmIChlcnIpCisJCQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCX0KKwkJ
fQorCisJCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gNCkgeworCQkJZm9yX2VhY2hfcHJpbWVfbnVt
YmVyKHBpdGNoLCBtYXhfcGl0Y2gpIHsKKwkJCQl0aWxlLnN0cmlkZSA9IHRpbGUud2lkdGggKiBw
aXRjaDsKKwkJCQllcnIgPSBjaGVja19wYXJ0aWFsX21hcHBpbmcob2JqLCAmdGlsZSwgZW5kKTsK
KwkJCQlpZiAoZXJyID09IC1FSU5UUikKKwkJCQkJZ290byBuZXh0X3RpbGluZzsKKwkJCQlpZiAo
ZXJyKQorCQkJCQlnb3RvIG91dF91bmxvY2s7CisJCQl9CisJCX0KKworbmV4dF90aWxpbmc6IDsK
Kwl9CisKK291dF91bmxvY2s6CisJaW50ZWxfcnVudGltZV9wbV9wdXQoaTkxNSwgd2FrZXJlZik7
CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlpOTE1X2dlbV9vYmpl
Y3RfdW5waW5fcGFnZXMob2JqKTsKK291dDoKKwlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CisJ
cmV0dXJuIGVycjsKK30KKworc3RhdGljIGludCBtYWtlX29ial9idXN5KHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmopCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0
b19pOTE1KG9iai0+YmFzZS5kZXYpOworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCXN0cnVj
dCBpOTE1X3ZtYSAqdm1hOworCWludCBlcnI7CisKKwl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShv
YmosICZpOTE1LT5nZ3R0LnZtLCBOVUxMKTsKKwlpZiAoSVNfRVJSKHZtYSkpCisJCXJldHVybiBQ
VFJfRVJSKHZtYSk7CisKKwllcnIgPSBpOTE1X3ZtYV9waW4odm1hLCAwLCAwLCBQSU5fVVNFUik7
CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCXJxID0gaTkxNV9yZXF1ZXN0X2NyZWF0ZShp
OTE1LT5lbmdpbmVbUkNTMF0tPmtlcm5lbF9jb250ZXh0KTsKKwlpZiAoSVNfRVJSKHJxKSkgewor
CQlpOTE1X3ZtYV91bnBpbih2bWEpOworCQlyZXR1cm4gUFRSX0VSUihycSk7CisJfQorCisJZXJy
ID0gaTkxNV92bWFfbW92ZV90b19hY3RpdmUodm1hLCBycSwgRVhFQ19PQkpFQ1RfV1JJVEUpOwor
CisJaTkxNV9yZXF1ZXN0X2FkZChycSk7CisKKwlfX2k5MTVfZ2VtX29iamVjdF9yZWxlYXNlX3Vu
bGVzc19hY3RpdmUob2JqKTsKKwlpOTE1X3ZtYV91bnBpbih2bWEpOworCisJcmV0dXJuIGVycjsK
K30KKworc3RhdGljIGJvb2wgYXNzZXJ0X21tYXBfb2Zmc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAorCQkJICAgICAgIHVuc2lnbmVkIGxvbmcgc2l6ZSwKKwkJCSAgICAgICBpbnQg
ZXhwZWN0ZWQpCit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKKwlpbnQgZXJy
OworCisJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChpOTE1LCBzaXplKTsK
KwlpZiAoSVNfRVJSKG9iaikpCisJCXJldHVybiBQVFJfRVJSKG9iaik7CisKKwllcnIgPSBjcmVh
dGVfbW1hcF9vZmZzZXQob2JqKTsKKwlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CisKKwlyZXR1
cm4gZXJyID09IGV4cGVjdGVkOworfQorCitzdGF0aWMgdm9pZCBkaXNhYmxlX3JldGlyZV93b3Jr
ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCit7CisJaTkxNV9nZW1fc2hyaW5rZXJf
dW5yZWdpc3RlcihpOTE1KTsKKworCWludGVsX2d0X3BtX2dldChpOTE1KTsKKworCWNhbmNlbF9k
ZWxheWVkX3dvcmtfc3luYygmaTkxNS0+Z2VtLnJldGlyZV93b3JrKTsKKwlmbHVzaF93b3JrKCZp
OTE1LT5nZW0uaWRsZV93b3JrKTsKK30KKworc3RhdGljIHZvaWQgcmVzdG9yZV9yZXRpcmVfd29y
a2VyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQoreworCWludGVsX2d0X3BtX3B1dChp
OTE1KTsKKworCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWlndF9mbHVz
aF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpOworCW11dGV4X3VubG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CisKKwlpOTE1X2dlbV9zaHJpbmtlcl9yZWdpc3RlcihpOTE1KTsKK30K
Kworc3RhdGljIGludCBpZ3RfbW1hcF9vZmZzZXRfZXhoYXVzdGlvbih2b2lkICphcmcpCit7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CisJc3RydWN0IGRybV9tbSAqbW0g
PSAmaTkxNS0+ZHJtLnZtYV9vZmZzZXRfbWFuYWdlci0+dm1fYWRkcl9zcGFjZV9tbTsKKwlzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOworCXN0cnVjdCBkcm1fbW1fbm9kZSByZXN2LCAq
aG9sZTsKKwl1NjQgaG9sZV9zdGFydCwgaG9sZV9lbmQ7CisJaW50IGxvb3AsIGVycjsKKworCS8q
IERpc2FibGUgYmFja2dyb3VuZCByZWFwZXIgKi8KKwlkaXNhYmxlX3JldGlyZV93b3JrZXIoaTkx
NSk7CisJR0VNX0JVR19PTighaTkxNS0+Z3QuYXdha2UpOworCisJLyogVHJpbSB0aGUgZGV2aWNl
IG1tYXAgc3BhY2UgdG8gb25seSBhIHBhZ2UgKi8KKwltZW1zZXQoJnJlc3YsIDAsIHNpemVvZihy
ZXN2KSk7CisJZHJtX21tX2Zvcl9lYWNoX2hvbGUoaG9sZSwgbW0sIGhvbGVfc3RhcnQsIGhvbGVf
ZW5kKSB7CisJCXJlc3Yuc3RhcnQgPSBob2xlX3N0YXJ0OworCQlyZXN2LnNpemUgPSBob2xlX2Vu
ZCAtIGhvbGVfc3RhcnQgLSAxOyAvKiBQQUdFX1NJWkUgdW5pdHMgKi8KKwkJZXJyID0gZHJtX21t
X3Jlc2VydmVfbm9kZShtbSwgJnJlc3YpOworCQlpZiAoZXJyKSB7CisJCQlwcl9lcnIoIkZhaWxl
ZCB0byB0cmltIFZNQSBtYW5hZ2VyLCBlcnI9JWRcbiIsIGVycik7CisJCQlnb3RvIG91dF9wYXJr
OworCQl9CisJCWJyZWFrOworCX0KKworCS8qIEp1c3QgZml0cyEgKi8KKwlpZiAoIWFzc2VydF9t
bWFwX29mZnNldChpOTE1LCBQQUdFX1NJWkUsIDApKSB7CisJCXByX2VycigiVW5hYmxlIHRvIGlu
c2VydCBvYmplY3QgaW50byBzaW5nbGUgcGFnZSBob2xlXG4iKTsKKwkJZXJyID0gLUVJTlZBTDsK
KwkJZ290byBvdXQ7CisJfQorCisJLyogVG9vIGxhcmdlICovCisJaWYgKCFhc3NlcnRfbW1hcF9v
ZmZzZXQoaTkxNSwgMiAqIFBBR0VfU0laRSwgLUVOT1NQQykpIHsKKwkJcHJfZXJyKCJVbmV4cGVj
dGVkbHkgc3VjY2VlZGVkIGluIGluc2VydGluZyB0b28gbGFyZ2Ugb2JqZWN0IGludG8gc2luZ2xl
IHBhZ2UgaG9sZVxuIik7CisJCWVyciA9IC1FSU5WQUw7CisJCWdvdG8gb3V0OworCX0KKworCS8q
IEZpbGwgdGhlIGhvbGUsIGZ1cnRoZXIgYWxsb2NhdGlvbiBhdHRlbXB0cyBzaG91bGQgdGhlbiBm
YWlsICovCisJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChpOTE1LCBQQUdF
X1NJWkUpOworCWlmIChJU19FUlIob2JqKSkgeworCQllcnIgPSBQVFJfRVJSKG9iaik7CisJCWdv
dG8gb3V0OworCX0KKworCWVyciA9IGNyZWF0ZV9tbWFwX29mZnNldChvYmopOworCWlmIChlcnIp
IHsKKwkJcHJfZXJyKCJVbmFibGUgdG8gaW5zZXJ0IG9iamVjdCBpbnRvIHJlY2xhaW1lZCBob2xl
XG4iKTsKKwkJZ290byBlcnJfb2JqOworCX0KKworCWlmICghYXNzZXJ0X21tYXBfb2Zmc2V0KGk5
MTUsIFBBR0VfU0laRSwgLUVOT1NQQykpIHsKKwkJcHJfZXJyKCJVbmV4cGVjdGVkbHkgc3VjY2Vl
ZGVkIGluIGluc2VydGluZyBvYmplY3QgaW50byBubyBob2xlcyFcbiIpOworCQllcnIgPSAtRUlO
VkFMOworCQlnb3RvIGVycl9vYmo7CisJfQorCisJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwor
CisJLyogTm93IGZpbGwgd2l0aCBidXN5IGRlYWQgb2JqZWN0cyB0aGF0IHdlIGV4cGVjdCB0byBy
ZWFwICovCisJZm9yIChsb29wID0gMDsgbG9vcCA8IDM7IGxvb3ArKykgeworCQlpZiAoaTkxNV90
ZXJtaW5hbGx5X3dlZGdlZChpOTE1KSkKKwkJCWJyZWFrOworCisJCW9iaiA9IGk5MTVfZ2VtX29i
amVjdF9jcmVhdGVfaW50ZXJuYWwoaTkxNSwgUEFHRV9TSVpFKTsKKwkJaWYgKElTX0VSUihvYmop
KSB7CisJCQllcnIgPSBQVFJfRVJSKG9iaik7CisJCQlnb3RvIG91dDsKKwkJfQorCisJCW11dGV4
X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCQllcnIgPSBtYWtlX29ial9idXN5KG9i
aik7CisJCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJCWlmIChlcnIp
IHsKKwkJCXByX2VycigiW2xvb3AgJWRdIEZhaWxlZCB0byBidXN5IHRoZSBvYmplY3RcbiIsIGxv
b3ApOworCQkJZ290byBlcnJfb2JqOworCQl9CisKKwkJLyogTkIgd2UgcmVseSBvbiB0aGUgX2Fj
dGl2ZV8gcmVmZXJlbmNlIHRvIGFjY2VzcyBvYmogbm93ICovCisJCUdFTV9CVUdfT04oIWk5MTVf
Z2VtX29iamVjdF9pc19hY3RpdmUob2JqKSk7CisJCWVyciA9IGNyZWF0ZV9tbWFwX29mZnNldChv
YmopOworCQlpZiAoZXJyKSB7CisJCQlwcl9lcnIoIltsb29wICVkXSBjcmVhdGVfbW1hcF9vZmZz
ZXQgZmFpbGVkIHdpdGggZXJyPSVkXG4iLAorCQkJICAgICAgIGxvb3AsIGVycik7CisJCQlnb3Rv
IG91dDsKKwkJfQorCX0KKworb3V0OgorCWRybV9tbV9yZW1vdmVfbm9kZSgmcmVzdik7CitvdXRf
cGFyazoKKwlyZXN0b3JlX3JldGlyZV93b3JrZXIoaTkxNSk7CisJcmV0dXJuIGVycjsKK2Vycl9v
Ymo6CisJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCWdvdG8gb3V0OworfQorCitpbnQgaTkx
NV9nZW1fbW1hbl9saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
K3sKKwlzdGF0aWMgY29uc3Qgc3RydWN0IGk5MTVfc3VidGVzdCB0ZXN0c1tdID0geworCQlTVUJU
RVNUKGlndF9wYXJ0aWFsX3RpbGluZyksCisJCVNVQlRFU1QoaWd0X21tYXBfb2Zmc2V0X2V4aGF1
c3Rpb24pLAorCX07CisKKwlyZXR1cm4gaTkxNV9zdWJ0ZXN0cyh0ZXN0cywgaTkxNSk7Cit9CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9kcnYuaAppbmRleCBkYTlmNWEzNzU2MTMuLmU4ZmE2ZjRiMTAwYyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2Rydi5oCkBAIC0yNzkwLDcgKzI3OTAsNiBAQCBpOTE1X2dlbV9vYmpl
Y3RfZ2d0dF9waW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJCSB1NjQgZmxh
Z3MpOwogCiBpbnQgaTkxNV9nZW1fb2JqZWN0X3VuYmluZChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqKTsKLXZvaWQgaTkxNV9nZW1fcmVsZWFzZV9tbWFwKHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmopOwogCiB2b2lkIGk5MTVfZ2VtX3J1bnRpbWVfc3VzcGVuZChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwppbmRl
eCAwNTQ5YjczZjAxZmYuLjc4ZDk5ODQxY2Y3NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCkBA
IC0zODAsMTIgKzM4MCw2IEBAIGk5MTVfZ2VtX2R1bWJfY3JlYXRlKHN0cnVjdCBkcm1fZmlsZSAq
ZmlsZSwKIAkJCSAgICAgICAmYXJncy0+c2l6ZSwgJmFyZ3MtPmhhbmRsZSk7CiB9CiAKLXN0YXRp
YyBib29sIGdwdV93cml0ZV9uZWVkc19jbGZsdXNoKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmopCi17Ci0JcmV0dXJuICEob2JqLT5jYWNoZV9sZXZlbCA9PSBJOTE1X0NBQ0hFX05PTkUg
fHwKLQkJIG9iai0+Y2FjaGVfbGV2ZWwgPT0gSTkxNV9DQUNIRV9XVCk7Ci19Ci0KIC8qKgogICog
Q3JlYXRlcyBhIG5ldyBtbSBvYmplY3QgYW5kIHJldHVybnMgYSBoYW5kbGUgdG8gaXQuCiAgKiBA
ZGV2OiBkcm0gZGV2aWNlIHBvaW50ZXIKQEAgLTQwNSwxMyArMzk5LDYgQEAgaTkxNV9nZW1fY3Jl
YXRlX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCQkgICAgICAg
JmFyZ3MtPnNpemUsICZhcmdzLT5oYW5kbGUpOwogfQogCi1zdGF0aWMgaW5saW5lIGVudW0gZmJf
b3Bfb3JpZ2luCi1mYl93cml0ZV9vcmlnaW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9i
aiwgdW5zaWduZWQgaW50IGRvbWFpbikKLXsKLQlyZXR1cm4gKGRvbWFpbiA9PSBJOTE1X0dFTV9E
T01BSU5fR1RUID8KLQkJb2JqLT5mcm9udGJ1ZmZlcl9nZ3R0X29yaWdpbiA6IE9SSUdJTl9DUFUp
OwotfQotCiB2b2lkIGk5MTVfZ2VtX2ZsdXNoX2dndHRfd3JpdGVzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKIHsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKQEAgLTQ1MSw0
NyArNDM4LDYgQEAgdm9pZCBpOTE1X2dlbV9mbHVzaF9nZ3R0X3dyaXRlcyhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJfQogfQogCi1zdGF0aWMgdm9pZAotZmx1c2hfd3JpdGVf
ZG9tYWluKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosIHVuc2lnbmVkIGludCBmbHVz
aF9kb21haW5zKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUob2JqLT5iYXNlLmRldik7Ci0Jc3RydWN0IGk5MTVfdm1hICp2bWE7Ci0KLQlpZiAoIShvYmot
PndyaXRlX2RvbWFpbiAmIGZsdXNoX2RvbWFpbnMpKQotCQlyZXR1cm47Ci0KLQlzd2l0Y2ggKG9i
ai0+d3JpdGVfZG9tYWluKSB7Ci0JY2FzZSBJOTE1X0dFTV9ET01BSU5fR1RUOgotCQlpOTE1X2dl
bV9mbHVzaF9nZ3R0X3dyaXRlcyhkZXZfcHJpdik7Ci0KLQkJaW50ZWxfZmJfb2JqX2ZsdXNoKG9i
aiwKLQkJCQkgICBmYl93cml0ZV9vcmlnaW4ob2JqLCBJOTE1X0dFTV9ET01BSU5fR1RUKSk7Ci0K
LQkJZm9yX2VhY2hfZ2d0dF92bWEodm1hLCBvYmopIHsKLQkJCWlmICh2bWEtPmlvbWFwKQotCQkJ
CWNvbnRpbnVlOwotCi0JCQlpOTE1X3ZtYV91bnNldF9nZ3R0X3dyaXRlKHZtYSk7Ci0JCX0KLQkJ
YnJlYWs7Ci0KLQljYXNlIEk5MTVfR0VNX0RPTUFJTl9XQzoKLQkJd21iKCk7Ci0JCWJyZWFrOwot
Ci0JY2FzZSBJOTE1X0dFTV9ET01BSU5fQ1BVOgotCQlpOTE1X2dlbV9jbGZsdXNoX29iamVjdChv
YmosIEk5MTVfQ0xGTFVTSF9TWU5DKTsKLQkJYnJlYWs7Ci0KLQljYXNlIEk5MTVfR0VNX0RPTUFJ
Tl9SRU5ERVI6Ci0JCWlmIChncHVfd3JpdGVfbmVlZHNfY2xmbHVzaChvYmopKQotCQkJb2JqLT5j
YWNoZV9kaXJ0eSA9IHRydWU7Ci0JCWJyZWFrOwotCX0KLQotCW9iai0+d3JpdGVfZG9tYWluID0g
MDsKLX0KLQogLyoKICAqIFBpbnMgdGhlIHNwZWNpZmllZCBvYmplY3QncyBwYWdlcyBhbmQgc3lu
Y2hyb25pemVzIHRoZSBvYmplY3Qgd2l0aAogICogR1BVIGFjY2Vzc2VzLiBTZXRzIG5lZWRzX2Ns
Zmx1c2ggdG8gbm9uLXplcm8gaWYgdGhlIGNhbGxlciBzaG91bGQKQEAgLTUyOCw3ICs0NzQsNyBA
QCBpbnQgaTkxNV9nZW1fb2JqX3ByZXBhcmVfc2htZW1fcmVhZChzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqLAogCQkJZ290byBvdXQ7CiAJfQogCi0JZmx1c2hfd3JpdGVfZG9tYWluKG9i
aiwgfkk5MTVfR0VNX0RPTUFJTl9DUFUpOworCWk5MTVfZ2VtX29iamVjdF9mbHVzaF93cml0ZV9k
b21haW4ob2JqLCB+STkxNV9HRU1fRE9NQUlOX0NQVSk7CiAKIAkvKiBJZiB3ZSdyZSBub3QgaW4g
dGhlIGNwdSByZWFkIGRvbWFpbiwgc2V0IG91cnNlbGYgaW50byB0aGUgZ3R0CiAJICogcmVhZCBk
b21haW4gYW5kIG1hbnVhbGx5IGZsdXNoIGNhY2hlbGluZXMgKGlmIHJlcXVpcmVkKS4gVGhpcwpA
QCAtNTgwLDcgKzUyNiw3IEBAIGludCBpOTE1X2dlbV9vYmpfcHJlcGFyZV9zaG1lbV93cml0ZShz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkJZ290byBvdXQ7CiAJfQogCi0JZmx1
c2hfd3JpdGVfZG9tYWluKG9iaiwgfkk5MTVfR0VNX0RPTUFJTl9DUFUpOworCWk5MTVfZ2VtX29i
amVjdF9mbHVzaF93cml0ZV9kb21haW4ob2JqLCB+STkxNV9HRU1fRE9NQUlOX0NQVSk7CiAKIAkv
KiBJZiB3ZSdyZSBub3QgaW4gdGhlIGNwdSB3cml0ZSBkb21haW4sIHNldCBvdXJzZWxmIGludG8g
dGhlCiAJICogZ3R0IHdyaXRlIGRvbWFpbiBhbmQgbWFudWFsbHkgZmx1c2ggY2FjaGVsaW5lcyAo
YXMgcmVxdWlyZWQpLgpAQCAtMTE4Myw2ICsxMTI5LDEzIEBAIHN0YXRpYyB2b2lkIGk5MTVfZ2Vt
X29iamVjdF9idW1wX2luYWN0aXZlX2dndHQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9i
aikKIAlzcGluX3VubG9jaygmaTkxNS0+bW0ub2JqX2xvY2spOwogfQogCitzdGF0aWMgaW5saW5l
IGVudW0gZmJfb3Bfb3JpZ2luCitmYl93cml0ZV9vcmlnaW4oc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaiwgdW5zaWduZWQgaW50IGRvbWFpbikKK3sKKwlyZXR1cm4gKGRvbWFpbiA9PSBJ
OTE1X0dFTV9ET01BSU5fR1RUID8KKwkJb2JqLT5mcm9udGJ1ZmZlcl9nZ3R0X29yaWdpbiA6IE9S
SUdJTl9DUFUpOworfQorCiAvKioKICAqIENhbGxlZCB3aGVuIHVzZXIgc3BhY2UgcHJlcGFyZXMg
dG8gdXNlIGFuIG9iamVjdCB3aXRoIHRoZSBDUFUsIGVpdGhlcgogICogdGhyb3VnaCB0aGUgbW1h
cCBpb2N0bCdzIG1hcHBpbmcgb3IgYSBHVFQgbWFwcGluZy4KQEAgLTEzMjYsNDIwICsxMjc5LDYg
QEAgaTkxNV9nZW1fc3dfZmluaXNoX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQg
KmRhdGEsCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbmxpbmUgYm9vbAotX192bWFfbWF0Y2hl
cyhzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKnZtYSwgc3RydWN0IGZpbGUgKmZpbHAsCi0JICAgICAg
dW5zaWduZWQgbG9uZyBhZGRyLCB1bnNpZ25lZCBsb25nIHNpemUpCi17Ci0JaWYgKHZtYS0+dm1f
ZmlsZSAhPSBmaWxwKQotCQlyZXR1cm4gZmFsc2U7Ci0KLQlyZXR1cm4gdm1hLT52bV9zdGFydCA9
PSBhZGRyICYmCi0JICAgICAgICh2bWEtPnZtX2VuZCAtIHZtYS0+dm1fc3RhcnQpID09IFBBR0Vf
QUxJR04oc2l6ZSk7Ci19Ci0KLS8qKgotICogaTkxNV9nZW1fbW1hcF9pb2N0bCAtIE1hcHMgdGhl
IGNvbnRlbnRzIG9mIGFuIG9iamVjdCwgcmV0dXJuaW5nIHRoZSBhZGRyZXNzCi0gKgkJCSBpdCBp
cyBtYXBwZWQgdG8uCi0gKiBAZGV2OiBkcm0gZGV2aWNlCi0gKiBAZGF0YTogaW9jdGwgZGF0YSBi
bG9iCi0gKiBAZmlsZTogZHJtIGZpbGUKLSAqCi0gKiBXaGlsZSB0aGUgbWFwcGluZyBob2xkcyBh
IHJlZmVyZW5jZSBvbiB0aGUgY29udGVudHMgb2YgdGhlIG9iamVjdCwgaXQgZG9lc24ndAotICog
aW1wbHkgYSByZWYgb24gdGhlIG9iamVjdCBpdHNlbGYuCi0gKgotICogSU1QT1JUQU5UOgotICoK
LSAqIERSTSBkcml2ZXIgd3JpdGVycyB3aG8gbG9vayBhIHRoaXMgZnVuY3Rpb24gYXMgYW4gZXhh
bXBsZSBmb3IgaG93IHRvIGRvIEdFTQotICogbW1hcCBzdXBwb3J0LCBwbGVhc2UgZG9uJ3QgaW1w
bGVtZW50IG1tYXAgc3VwcG9ydCBsaWtlIGhlcmUuIFRoZSBtb2Rlcm4gd2F5Ci0gKiB0byBpbXBs
ZW1lbnQgRFJNIG1tYXAgc3VwcG9ydCBpcyB3aXRoIGFuIG1tYXAgb2Zmc2V0IGlvY3RsIChsaWtl
Ci0gKiBpOTE1X2dlbV9tbWFwX2d0dCkgYW5kIHRoZW4gdXNpbmcgdGhlIG1tYXAgc3lzY2FsbCBv
biB0aGUgRFJNIGZkIGRpcmVjdGx5LgotICogVGhhdCB3YXkgZGVidWcgdG9vbGluZyBsaWtlIHZh
bGdyaW5kIHdpbGwgdW5kZXJzdGFuZCB3aGF0J3MgZ29pbmcgb24sIGhpZGluZwotICogdGhlIG1t
YXAgY2FsbCBpbiBhIGRyaXZlciBwcml2YXRlIGlvY3RsIHdpbGwgYnJlYWsgdGhhdC4gVGhlIGk5
MTUgZHJpdmVyIG9ubHkKLSAqIGRvZXMgY3B1IG1tYXBzIHRoaXMgd2F5IGJlY2F1c2Ugd2UgZGlk
bid0IGtub3cgYmV0dGVyLgotICovCi1pbnQKLWk5MTVfZ2VtX21tYXBfaW9jdGwoc3RydWN0IGRy
bV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKLQkJICAgIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkK
LXsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX21tYXAgKmFyZ3MgPSBkYXRhOwotCXN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmo7Ci0JdW5zaWduZWQgbG9uZyBhZGRyOwotCi0JaWYgKGFyZ3Mt
PmZsYWdzICYgfihJOTE1X01NQVBfV0MpKQotCQlyZXR1cm4gLUVJTlZBTDsKLQotCWlmIChhcmdz
LT5mbGFncyAmIEk5MTVfTU1BUF9XQyAmJiAhYm9vdF9jcHVfaGFzKFg4Nl9GRUFUVVJFX1BBVCkp
Ci0JCXJldHVybiAtRU5PREVWOwotCi0Jb2JqID0gaTkxNV9nZW1fb2JqZWN0X2xvb2t1cChmaWxl
LCBhcmdzLT5oYW5kbGUpOwotCWlmICghb2JqKQotCQlyZXR1cm4gLUVOT0VOVDsKLQotCS8qIHBy
aW1lIG9iamVjdHMgaGF2ZSBubyBiYWNraW5nIGZpbHAgdG8gR0VNIG1tYXAKLQkgKiBwYWdlcyBm
cm9tLgotCSAqLwotCWlmICghb2JqLT5iYXNlLmZpbHApIHsKLQkJYWRkciA9IC1FTlhJTzsKLQkJ
Z290byBlcnI7Ci0JfQotCi0JaWYgKHJhbmdlX292ZXJmbG93cyhhcmdzLT5vZmZzZXQsIGFyZ3Mt
PnNpemUsICh1NjQpb2JqLT5iYXNlLnNpemUpKSB7Ci0JCWFkZHIgPSAtRUlOVkFMOwotCQlnb3Rv
IGVycjsKLQl9Ci0KLQlhZGRyID0gdm1fbW1hcChvYmotPmJhc2UuZmlscCwgMCwgYXJncy0+c2l6
ZSwKLQkJICAgICAgIFBST1RfUkVBRCB8IFBST1RfV1JJVEUsIE1BUF9TSEFSRUQsCi0JCSAgICAg
ICBhcmdzLT5vZmZzZXQpOwotCWlmIChJU19FUlJfVkFMVUUoYWRkcikpCi0JCWdvdG8gZXJyOwot
Ci0JaWYgKGFyZ3MtPmZsYWdzICYgSTkxNV9NTUFQX1dDKSB7Ci0JCXN0cnVjdCBtbV9zdHJ1Y3Qg
Km1tID0gY3VycmVudC0+bW07Ci0JCXN0cnVjdCB2bV9hcmVhX3N0cnVjdCAqdm1hOwotCi0JCWlm
IChkb3duX3dyaXRlX2tpbGxhYmxlKCZtbS0+bW1hcF9zZW0pKSB7Ci0JCQlhZGRyID0gLUVJTlRS
OwotCQkJZ290byBlcnI7Ci0JCX0KLQkJdm1hID0gZmluZF92bWEobW0sIGFkZHIpOwotCQlpZiAo
dm1hICYmIF9fdm1hX21hdGNoZXModm1hLCBvYmotPmJhc2UuZmlscCwgYWRkciwgYXJncy0+c2l6
ZSkpCi0JCQl2bWEtPnZtX3BhZ2VfcHJvdCA9Ci0JCQkJcGdwcm90X3dyaXRlY29tYmluZSh2bV9n
ZXRfcGFnZV9wcm90KHZtYS0+dm1fZmxhZ3MpKTsKLQkJZWxzZQotCQkJYWRkciA9IC1FTk9NRU07
Ci0JCXVwX3dyaXRlKCZtbS0+bW1hcF9zZW0pOwotCQlpZiAoSVNfRVJSX1ZBTFVFKGFkZHIpKQot
CQkJZ290byBlcnI7Ci0KLQkJLyogVGhpcyBtYXkgcmFjZSwgYnV0IHRoYXQncyBvaywgaXQgb25s
eSBnZXRzIHNldCAqLwotCQlXUklURV9PTkNFKG9iai0+ZnJvbnRidWZmZXJfZ2d0dF9vcmlnaW4s
IE9SSUdJTl9DUFUpOwotCX0KLQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7Ci0KLQlhcmdzLT5h
ZGRyX3B0ciA9ICh1NjQpYWRkcjsKLQlyZXR1cm4gMDsKLQotZXJyOgotCWk5MTVfZ2VtX29iamVj
dF9wdXQob2JqKTsKLQlyZXR1cm4gYWRkcjsKLX0KLQotc3RhdGljIHVuc2lnbmVkIGludCB0aWxl
X3Jvd19wYWdlcyhjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQotewotCXJl
dHVybiBpOTE1X2dlbV9vYmplY3RfZ2V0X3RpbGVfcm93X3NpemUob2JqKSA+PiBQQUdFX1NISUZU
OwotfQotCi0vKioKLSAqIGk5MTVfZ2VtX21tYXBfZ3R0X3ZlcnNpb24gLSByZXBvcnQgdGhlIGN1
cnJlbnQgZmVhdHVyZSBzZXQgZm9yIEdUVCBtbWFwcwotICoKLSAqIEEgaGlzdG9yeSBvZiB0aGUg
R1RUIG1tYXAgaW50ZXJmYWNlOgotICoKLSAqIDAgLSBFdmVyeXRoaW5nIGhhZCB0byBmaXQgaW50
byB0aGUgR1RULiBCb3RoIHBhcnRpZXMgb2YgYSBtZW1jcHkgaGFkIHRvCi0gKiAgICAgYWxpZ25l
ZCBhbmQgc3VpdGFibGUgZm9yIGZlbmNpbmcsIGFuZCBzdGlsbCBmaXQgaW50byB0aGUgYXZhaWxh
YmxlCi0gKiAgICAgbWFwcGFibGUgc3BhY2UgbGVmdCBieSB0aGUgcGlubmVkIGRpc3BsYXkgb2Jq
ZWN0cy4gQSBjbGFzc2ljIHByb2JsZW0KLSAqICAgICB3ZSBjYWxsZWQgdGhlIHBhZ2UtZmF1bHQt
b2YtZG9vbSB3aGVyZSB3ZSB3b3VsZCBwaW5nLXBvbmcgYmV0d2VlbgotICogICAgIHR3byBvYmpl
Y3RzIHRoYXQgY291bGQgbm90IGZpdCBpbnNpZGUgdGhlIEdUVCBhbmQgc28gdGhlIG1lbWNweQot
ICogICAgIHdvdWxkIHBhZ2Ugb25lIG9iamVjdCBpbiBhdCB0aGUgZXhwZW5zZSBvZiB0aGUgb3Ro
ZXIgYmV0d2VlbiBldmVyeQotICogICAgIHNpbmdsZSBieXRlLgotICoKLSAqIDEgLSBPYmplY3Rz
IGNhbiBiZSBhbnkgc2l6ZSwgYW5kIGhhdmUgYW55IGNvbXBhdGlibGUgZmVuY2luZyAoWCBZLCBv
ciBub25lCi0gKiAgICAgYXMgc2V0IHZpYSBpOTE1X2dlbV9zZXRfdGlsaW5nKCkgW0RSTV9JOTE1
X0dFTV9TRVRfVElMSU5HXSkuIElmIHRoZQotICogICAgIG9iamVjdCBpcyB0b28gbGFyZ2UgZm9y
IHRoZSBhdmFpbGFibGUgc3BhY2UgKG9yIHNpbXBseSB0b28gbGFyZ2UKLSAqICAgICBmb3IgdGhl
IG1hcHBhYmxlIGFwZXJ0dXJlISksIGEgdmlldyBpcyBjcmVhdGVkIGluc3RlYWQgYW5kIGZhdWx0
ZWQKLSAqICAgICBpbnRvIHVzZXJzcGFjZS4gKFRoaXMgdmlldyBpcyBhbGlnbmVkIGFuZCBzaXpl
ZCBhcHByb3ByaWF0ZWx5IGZvcgotICogICAgIGZlbmNlZCBhY2Nlc3MuKQotICoKLSAqIDIgLSBS
ZWNvZ25pc2UgV0MgYXMgYSBzZXBhcmF0ZSBjYWNoZSBkb21haW4gc28gdGhhdCB3ZSBjYW4gZmx1
c2ggdGhlCi0gKiAgICAgZGVsYXllZCB3cml0ZXMgdmlhIEdUVCBiZWZvcmUgcGVyZm9ybWluZyBk
aXJlY3QgYWNjZXNzIHZpYSBXQy4KLSAqCi0gKiAzIC0gUmVtb3ZlIGltcGxpY2l0IHNldC1kb21h
aW4oR1RUKSBhbmQgc3luY2hyb25pc2F0aW9uIG9uIGluaXRpYWwKLSAqICAgICBwYWdlZmF1bHQ7
IHN3YXBpbiByZW1haW5zIHRyYW5zcGFyZW50LgotICoKLSAqIFJlc3RyaWN0aW9uczoKLSAqCi0g
KiAgKiBzbm9vcGFibGUgb2JqZWN0cyBjYW5ub3QgYmUgYWNjZXNzZWQgdmlhIHRoZSBHVFQuIEl0
IGNhbiBjYXVzZSBtYWNoaW5lCi0gKiAgICBoYW5ncyBvbiBzb21lIGFyY2hpdGVjdHVyZXMsIGNv
cnJ1cHRpb24gb24gb3RoZXJzLiBBbiBhdHRlbXB0IHRvIHNlcnZpY2UKLSAqICAgIGEgR1RUIHBh
Z2UgZmF1bHQgZnJvbSBhIHNub29wYWJsZSBvYmplY3Qgd2lsbCBnZW5lcmF0ZSBhIFNJR0JVUy4K
LSAqCi0gKiAgKiB0aGUgb2JqZWN0IG11c3QgYmUgYWJsZSB0byBmaXQgaW50byBSQU0gKHBoeXNp
Y2FsIG1lbW9yeSwgdGhvdWdoIG5vCi0gKiAgICBsaW1pdGVkIHRvIHRoZSBtYXBwYWJsZSBhcGVy
dHVyZSkuCi0gKgotICoKLSAqIENhdmVhdHM6Ci0gKgotICogICogYSBuZXcgR1RUIHBhZ2UgZmF1
bHQgd2lsbCBzeW5jaHJvbml6ZSByZW5kZXJpbmcgZnJvbSB0aGUgR1BVIGFuZCBmbHVzaAotICog
ICAgYWxsIGRhdGEgdG8gc3lzdGVtIG1lbW9yeS4gU3Vic2VxdWVudCBhY2Nlc3Mgd2lsbCBub3Qg
YmUgc3luY2hyb25pemVkLgotICoKLSAqICAqIGFsbCBtYXBwaW5ncyBhcmUgcmV2b2tlZCBvbiBy
dW50aW1lIGRldmljZSBzdXNwZW5kLgotICoKLSAqICAqIHRoZXJlIGFyZSBvbmx5IDgsIDE2IG9y
IDMyIGZlbmNlIHJlZ2lzdGVycyB0byBzaGFyZSBiZXR3ZWVuIGFsbCB1c2VycwotICogICAgKG9s
ZGVyIG1hY2hpbmVzIHJlcXVpcmUgZmVuY2UgcmVnaXN0ZXIgZm9yIGRpc3BsYXkgYW5kIGJsaXR0
ZXIgYWNjZXNzCi0gKiAgICBhcyB3ZWxsKS4gQ29udGVudGlvbiBvZiB0aGUgZmVuY2UgcmVnaXN0
ZXJzIHdpbGwgY2F1c2UgdGhlIHByZXZpb3VzIHVzZXJzCi0gKiAgICB0byBiZSB1bm1hcHBlZCBh
bmQgYW55IG5ldyBhY2Nlc3Mgd2lsbCBnZW5lcmF0ZSBuZXcgcGFnZSBmYXVsdHMuCi0gKgotICog
ICogcnVubmluZyBvdXQgb2YgbWVtb3J5IHdoaWxlIHNlcnZpY2luZyBhIGZhdWx0IG1heSBnZW5l
cmF0ZSBhIFNJR0JVUywKLSAqICAgIHJhdGhlciB0aGFuIHRoZSBleHBlY3RlZCBTSUdTRUdWLgot
ICovCi1pbnQgaTkxNV9nZW1fbW1hcF9ndHRfdmVyc2lvbih2b2lkKQotewotCXJldHVybiAzOwot
fQotCi1zdGF0aWMgaW5saW5lIHN0cnVjdCBpOTE1X2dndHRfdmlldwotY29tcHV0ZV9wYXJ0aWFs
X3ZpZXcoY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKLQkJICAgICBwZ29m
Zl90IHBhZ2Vfb2Zmc2V0LAotCQkgICAgIHVuc2lnbmVkIGludCBjaHVuaykKLXsKLQlzdHJ1Y3Qg
aTkxNV9nZ3R0X3ZpZXcgdmlldzsKLQotCWlmIChpOTE1X2dlbV9vYmplY3RfaXNfdGlsZWQob2Jq
KSkKLQkJY2h1bmsgPSByb3VuZHVwKGNodW5rLCB0aWxlX3Jvd19wYWdlcyhvYmopKTsKLQotCXZp
ZXcudHlwZSA9IEk5MTVfR0dUVF9WSUVXX1BBUlRJQUw7Ci0Jdmlldy5wYXJ0aWFsLm9mZnNldCA9
IHJvdW5kZG93bihwYWdlX29mZnNldCwgY2h1bmspOwotCXZpZXcucGFydGlhbC5zaXplID0KLQkJ
bWluX3QodW5zaWduZWQgaW50LCBjaHVuaywKLQkJICAgICAgKG9iai0+YmFzZS5zaXplID4+IFBB
R0VfU0hJRlQpIC0gdmlldy5wYXJ0aWFsLm9mZnNldCk7Ci0KLQkvKiBJZiB0aGUgcGFydGlhbCBj
b3ZlcnMgdGhlIGVudGlyZSBvYmplY3QsIGp1c3QgY3JlYXRlIGEgbm9ybWFsIFZNQS4gKi8KLQlp
ZiAoY2h1bmsgPj0gb2JqLT5iYXNlLnNpemUgPj4gUEFHRV9TSElGVCkKLQkJdmlldy50eXBlID0g
STkxNV9HR1RUX1ZJRVdfTk9STUFMOwotCi0JcmV0dXJuIHZpZXc7Ci19Ci0KLS8qKgotICogaTkx
NV9nZW1fZmF1bHQgLSBmYXVsdCBhIHBhZ2UgaW50byB0aGUgR1RUCi0gKiBAdm1mOiBmYXVsdCBp
bmZvCi0gKgotICogVGhlIGZhdWx0IGhhbmRsZXIgaXMgc2V0IHVwIGJ5IGRybV9nZW1fbW1hcCgp
IHdoZW4gYSBvYmplY3QgaXMgR1RUIG1hcHBlZAotICogZnJvbSB1c2Vyc3BhY2UuICBUaGUgZmF1
bHQgaGFuZGxlciB0YWtlcyBjYXJlIG9mIGJpbmRpbmcgdGhlIG9iamVjdCB0bwotICogdGhlIEdU
VCAoaWYgbmVlZGVkKSwgYWxsb2NhdGluZyBhbmQgcHJvZ3JhbW1pbmcgYSBmZW5jZSByZWdpc3Rl
ciAoYWdhaW4sCi0gKiBvbmx5IGlmIG5lZWRlZCBiYXNlZCBvbiB3aGV0aGVyIHRoZSBvbGQgcmVn
IGlzIHN0aWxsIHZhbGlkIG9yIHRoZSBvYmplY3QKLSAqIGlzIHRpbGVkKSBhbmQgaW5zZXJ0aW5n
IGEgbmV3IFBURSBpbnRvIHRoZSBmYXVsdGluZyBwcm9jZXNzLgotICoKLSAqIE5vdGUgdGhhdCB0
aGUgZmF1bHRpbmcgcHJvY2VzcyBtYXkgaW52b2x2ZSBldmljdGluZyBleGlzdGluZyBvYmplY3Rz
Ci0gKiBmcm9tIHRoZSBHVFQgYW5kL29yIGZlbmNlIHJlZ2lzdGVycyB0byBtYWtlIHJvb20uICBT
byBwZXJmb3JtYW5jZSBtYXkKLSAqIHN1ZmZlciBpZiB0aGUgR1RUIHdvcmtpbmcgc2V0IGlzIGxh
cmdlIG9yIHRoZXJlIGFyZSBmZXcgZmVuY2UgcmVnaXN0ZXJzCi0gKiBsZWZ0LgotICoKLSAqIFRo
ZSBjdXJyZW50IGZlYXR1cmUgc2V0IHN1cHBvcnRlZCBieSBpOTE1X2dlbV9mYXVsdCgpIGFuZCB0
aHVzIEdUVCBtbWFwcwotICogaXMgZXhwb3NlZCB2aWEgSTkxNV9QQVJBTV9NTUFQX0dUVF9WRVJT
SU9OIChzZWUgaTkxNV9nZW1fbW1hcF9ndHRfdmVyc2lvbikuCi0gKi8KLXZtX2ZhdWx0X3QgaTkx
NV9nZW1fZmF1bHQoc3RydWN0IHZtX2ZhdWx0ICp2bWYpCi17Ci0jZGVmaW5lIE1JTl9DSFVOS19Q
QUdFUyAoU1pfMU0gPj4gUEFHRV9TSElGVCkKLQlzdHJ1Y3Qgdm1fYXJlYV9zdHJ1Y3QgKmFyZWEg
PSB2bWYtPnZtYTsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gdG9faW50ZWxf
Ym8oYXJlYS0+dm1fcHJpdmF0ZV9kYXRhKTsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gb2Jq
LT5iYXNlLmRldjsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGRldik7Ci0Jc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCA9ICZkZXZfcHJpdi0+Z2d0dDsKLQlib29s
IHdyaXRlID0gYXJlYS0+dm1fZmxhZ3MgJiBWTV9XUklURTsKLQlpbnRlbF93YWtlcmVmX3Qgd2Fr
ZXJlZjsKLQlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKLQlwZ29mZl90IHBhZ2Vfb2Zmc2V0OwotCWlu
dCBzcmN1OwotCWludCByZXQ7Ci0KLQkvKiBTYW5pdHkgY2hlY2sgdGhhdCB3ZSBhbGxvdyB3cml0
aW5nIGludG8gdGhpcyBvYmplY3QgKi8KLQlpZiAoaTkxNV9nZW1fb2JqZWN0X2lzX3JlYWRvbmx5
KG9iaikgJiYgd3JpdGUpCi0JCXJldHVybiBWTV9GQVVMVF9TSUdCVVM7Ci0KLQkvKiBXZSBkb24n
dCB1c2Ugdm1mLT5wZ29mZiBzaW5jZSB0aGF0IGhhcyB0aGUgZmFrZSBvZmZzZXQgKi8KLQlwYWdl
X29mZnNldCA9ICh2bWYtPmFkZHJlc3MgLSBhcmVhLT52bV9zdGFydCkgPj4gUEFHRV9TSElGVDsK
LQotCXRyYWNlX2k5MTVfZ2VtX29iamVjdF9mYXVsdChvYmosIHBhZ2Vfb2Zmc2V0LCB0cnVlLCB3
cml0ZSk7Ci0KLQlyZXQgPSBpOTE1X2dlbV9vYmplY3RfcGluX3BhZ2VzKG9iaik7Ci0JaWYgKHJl
dCkKLQkJZ290byBlcnI7Ci0KLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoZGV2X3By
aXYpOwotCi0Jc3JjdSA9IGk5MTVfcmVzZXRfdHJ5bG9jayhkZXZfcHJpdik7Ci0JaWYgKHNyY3Ug
PCAwKSB7Ci0JCXJldCA9IHNyY3U7Ci0JCWdvdG8gZXJyX3JwbTsKLQl9Ci0KLQlyZXQgPSBpOTE1
X211dGV4X2xvY2tfaW50ZXJydXB0aWJsZShkZXYpOwotCWlmIChyZXQpCi0JCWdvdG8gZXJyX3Jl
c2V0OwotCi0JLyogQWNjZXNzIHRvIHNub29wYWJsZSBwYWdlcyB0aHJvdWdoIHRoZSBHVFQgaXMg
aW5jb2hlcmVudC4gKi8KLQlpZiAob2JqLT5jYWNoZV9sZXZlbCAhPSBJOTE1X0NBQ0hFX05PTkUg
JiYgIUhBU19MTEMoZGV2X3ByaXYpKSB7Ci0JCXJldCA9IC1FRkFVTFQ7Ci0JCWdvdG8gZXJyX3Vu
bG9jazsKLQl9Ci0KLQkvKiBOb3cgcGluIGl0IGludG8gdGhlIEdUVCBhcyBuZWVkZWQgKi8KLQl2
bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4ob2JqLCBOVUxMLCAwLCAwLAotCQkJCSAgICAg
ICBQSU5fTUFQUEFCTEUgfAotCQkJCSAgICAgICBQSU5fTk9OQkxPQ0sgfAotCQkJCSAgICAgICBQ
SU5fTk9ORkFVTFQpOwotCWlmIChJU19FUlIodm1hKSkgewotCQkvKiBVc2UgYSBwYXJ0aWFsIHZp
ZXcgaWYgaXQgaXMgYmlnZ2VyIHRoYW4gYXZhaWxhYmxlIHNwYWNlICovCi0JCXN0cnVjdCBpOTE1
X2dndHRfdmlldyB2aWV3ID0KLQkJCWNvbXB1dGVfcGFydGlhbF92aWV3KG9iaiwgcGFnZV9vZmZz
ZXQsIE1JTl9DSFVOS19QQUdFUyk7Ci0JCXVuc2lnbmVkIGludCBmbGFnczsKLQotCQlmbGFncyA9
IFBJTl9NQVBQQUJMRTsKLQkJaWYgKHZpZXcudHlwZSA9PSBJOTE1X0dHVFRfVklFV19OT1JNQUwp
Ci0JCQlmbGFncyB8PSBQSU5fTk9OQkxPQ0s7IC8qIGF2b2lkIHdhcm5pbmdzIGZvciBwaW5uZWQg
Ki8KLQotCQkvKgotCQkgKiBVc2Vyc3BhY2UgaXMgbm93IHdyaXRpbmcgdGhyb3VnaCBhbiB1bnRy
YWNrZWQgVk1BLCBhYmFuZG9uCi0JCSAqIGFsbCBob3BlIHRoYXQgdGhlIGhhcmR3YXJlIGlzIGFi
bGUgdG8gdHJhY2sgZnV0dXJlIHdyaXRlcy4KLQkJICovCi0JCW9iai0+ZnJvbnRidWZmZXJfZ2d0
dF9vcmlnaW4gPSBPUklHSU5fQ1BVOwotCi0JCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3Bp
bihvYmosICZ2aWV3LCAwLCAwLCBmbGFncyk7Ci0JCWlmIChJU19FUlIodm1hKSAmJiAhdmlldy50
eXBlKSB7Ci0JCQlmbGFncyA9IFBJTl9NQVBQQUJMRTsKLQkJCXZpZXcudHlwZSA9IEk5MTVfR0dU
VF9WSUVXX1BBUlRJQUw7Ci0JCQl2bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4ob2JqLCAm
dmlldywgMCwgMCwgZmxhZ3MpOwotCQl9Ci0JfQotCWlmIChJU19FUlIodm1hKSkgewotCQlyZXQg
PSBQVFJfRVJSKHZtYSk7Ci0JCWdvdG8gZXJyX3VubG9jazsKLQl9Ci0KLQlyZXQgPSBpOTE1X3Zt
YV9waW5fZmVuY2Uodm1hKTsKLQlpZiAocmV0KQotCQlnb3RvIGVycl91bnBpbjsKLQotCS8qIEZp
bmFsbHksIHJlbWFwIGl0IHVzaW5nIHRoZSBuZXcgR1RUIG9mZnNldCAqLwotCXJldCA9IHJlbWFw
X2lvX21hcHBpbmcoYXJlYSwKLQkJCSAgICAgICBhcmVhLT52bV9zdGFydCArICh2bWEtPmdndHRf
dmlldy5wYXJ0aWFsLm9mZnNldCA8PCBQQUdFX1NISUZUKSwKLQkJCSAgICAgICAoZ2d0dC0+Z21h
ZHIuc3RhcnQgKyB2bWEtPm5vZGUuc3RhcnQpID4+IFBBR0VfU0hJRlQsCi0JCQkgICAgICAgbWlu
X3QodTY0LCB2bWEtPnNpemUsIGFyZWEtPnZtX2VuZCAtIGFyZWEtPnZtX3N0YXJ0KSwKLQkJCSAg
ICAgICAmZ2d0dC0+aW9tYXApOwotCWlmIChyZXQpCi0JCWdvdG8gZXJyX2ZlbmNlOwotCi0JLyog
TWFyayBhcyBiZWluZyBtbWFwcGVkIGludG8gdXNlcnNwYWNlIGZvciBsYXRlciByZXZvY2F0aW9u
ICovCi0JYXNzZXJ0X3JwbV93YWtlbG9ja19oZWxkKGRldl9wcml2KTsKLQlpZiAoIWk5MTVfdm1h
X3NldF91c2VyZmF1bHQodm1hKSAmJiAhb2JqLT51c2VyZmF1bHRfY291bnQrKykKLQkJbGlzdF9h
ZGQoJm9iai0+dXNlcmZhdWx0X2xpbmssICZkZXZfcHJpdi0+bW0udXNlcmZhdWx0X2xpc3QpOwot
CUdFTV9CVUdfT04oIW9iai0+dXNlcmZhdWx0X2NvdW50KTsKLQotCWk5MTVfdm1hX3NldF9nZ3R0
X3dyaXRlKHZtYSk7Ci0KLWVycl9mZW5jZToKLQlpOTE1X3ZtYV91bnBpbl9mZW5jZSh2bWEpOwot
ZXJyX3VucGluOgotCV9faTkxNV92bWFfdW5waW4odm1hKTsKLWVycl91bmxvY2s6Ci0JbXV0ZXhf
dW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRleCk7Ci1lcnJfcmVzZXQ6Ci0JaTkxNV9yZXNldF91bmxv
Y2soZGV2X3ByaXYsIHNyY3UpOwotZXJyX3JwbToKLQlpbnRlbF9ydW50aW1lX3BtX3B1dChkZXZf
cHJpdiwgd2FrZXJlZik7Ci0JaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKG9iaik7Ci1lcnI6
Ci0Jc3dpdGNoIChyZXQpIHsKLQljYXNlIC1FSU86Ci0JCS8qCi0JCSAqIFdlIGVhdCBlcnJvcnMg
d2hlbiB0aGUgZ3B1IGlzIHRlcm1pbmFsbHkgd2VkZ2VkIHRvIGF2b2lkCi0JCSAqIHVzZXJzcGFj
ZSB1bmR1bHkgY3Jhc2hpbmcgKGdsIGhhcyBubyBwcm92aXNpb25zIGZvciBtbWFwcyB0bwotCQkg
KiBmYWlsKS4gQnV0IGFueSBvdGhlciAtRUlPIGlzbid0IG91cnMgKGUuZy4gc3dhcCBpbiBmYWls
dXJlKQotCQkgKiBhbmQgc28gbmVlZHMgdG8gYmUgcmVwb3J0ZWQuCi0JCSAqLwotCQlpZiAoIWk5
MTVfdGVybWluYWxseV93ZWRnZWQoZGV2X3ByaXYpKQotCQkJcmV0dXJuIFZNX0ZBVUxUX1NJR0JV
UzsKLQkJLyogZWxzZTogZmFsbCB0aHJvdWdoICovCi0JY2FzZSAtRUFHQUlOOgotCQkvKgotCQkg
KiBFQUdBSU4gbWVhbnMgdGhlIGdwdSBpcyBodW5nIGFuZCB3ZSdsbCB3YWl0IGZvciB0aGUgZXJy
b3IKLQkJICogaGFuZGxlciB0byByZXNldCBldmVyeXRoaW5nIHdoZW4gcmUtZmF1bHRpbmcgaW4K
LQkJICogaTkxNV9tdXRleF9sb2NrX2ludGVycnVwdGlibGUuCi0JCSAqLwotCWNhc2UgMDoKLQlj
YXNlIC1FUkVTVEFSVFNZUzoKLQljYXNlIC1FSU5UUjoKLQljYXNlIC1FQlVTWToKLQkJLyoKLQkJ
ICogRUJVU1kgaXMgb2s6IHRoaXMganVzdCBtZWFucyB0aGF0IGFub3RoZXIgdGhyZWFkCi0JCSAq
IGFscmVhZHkgZGlkIHRoZSBqb2IuCi0JCSAqLwotCQlyZXR1cm4gVk1fRkFVTFRfTk9QQUdFOwot
CWNhc2UgLUVOT01FTToKLQkJcmV0dXJuIFZNX0ZBVUxUX09PTTsKLQljYXNlIC1FTk9TUEM6Ci0J
Y2FzZSAtRUZBVUxUOgotCQlyZXR1cm4gVk1fRkFVTFRfU0lHQlVTOwotCWRlZmF1bHQ6Ci0JCVdB
Uk5fT05DRShyZXQsICJ1bmhhbmRsZWQgZXJyb3IgaW4gaTkxNV9nZW1fZmF1bHQ6ICVpXG4iLCBy
ZXQpOwotCQlyZXR1cm4gVk1fRkFVTFRfU0lHQlVTOwotCX0KLX0KLQotc3RhdGljIHZvaWQgX19p
OTE1X2dlbV9vYmplY3RfcmVsZWFzZV9tbWFwKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
YmopCi17Ci0Jc3RydWN0IGk5MTVfdm1hICp2bWE7Ci0KLQlHRU1fQlVHX09OKCFvYmotPnVzZXJm
YXVsdF9jb3VudCk7Ci0KLQlvYmotPnVzZXJmYXVsdF9jb3VudCA9IDA7Ci0JbGlzdF9kZWwoJm9i
ai0+dXNlcmZhdWx0X2xpbmspOwotCWRybV92bWFfbm9kZV91bm1hcCgmb2JqLT5iYXNlLnZtYV9u
b2RlLAotCQkJICAgb2JqLT5iYXNlLmRldi0+YW5vbl9pbm9kZS0+aV9tYXBwaW5nKTsKLQotCWZv
cl9lYWNoX2dndHRfdm1hKHZtYSwgb2JqKQotCQlpOTE1X3ZtYV91bnNldF91c2VyZmF1bHQodm1h
KTsKLX0KLQotLyoqCi0gKiBpOTE1X2dlbV9yZWxlYXNlX21tYXAgLSByZW1vdmUgcGh5c2ljYWwg
cGFnZSBtYXBwaW5ncwotICogQG9iajogb2JqIGluIHF1ZXN0aW9uCi0gKgotICogUHJlc2VydmUg
dGhlIHJlc2VydmF0aW9uIG9mIHRoZSBtbWFwcGluZyB3aXRoIHRoZSBEUk0gY29yZSBjb2RlLCBi
dXQKLSAqIHJlbGlucXVpc2ggb3duZXJzaGlwIG9mIHRoZSBwYWdlcyBiYWNrIHRvIHRoZSBzeXN0
ZW0uCi0gKgotICogSXQgaXMgdml0YWwgdGhhdCB3ZSByZW1vdmUgdGhlIHBhZ2UgbWFwcGluZyBp
ZiB3ZSBoYXZlIG1hcHBlZCBhIHRpbGVkCi0gKiBvYmplY3QgdGhyb3VnaCB0aGUgR1RUIGFuZCB0
aGVuIGxvc2UgdGhlIGZlbmNlIHJlZ2lzdGVyIGR1ZSB0bwotICogcmVzb3VyY2UgcHJlc3N1cmUu
IFNpbWlsYXJseSBpZiB0aGUgb2JqZWN0IGhhcyBiZWVuIG1vdmVkIG91dCBvZiB0aGUKLSAqIGFw
ZXJ0dXJlLCB0aGFuIHBhZ2VzIG1hcHBlZCBpbnRvIHVzZXJzcGFjZSBtdXN0IGJlIHJldm9rZWQu
IFJlbW92aW5nIHRoZQotICogbWFwcGluZyB3aWxsIHRoZW4gdHJpZ2dlciBhIHBhZ2UgZmF1bHQg
b24gdGhlIG5leHQgdXNlciBhY2Nlc3MsIGFsbG93aW5nCi0gKiBmaXh1cCBieSBpOTE1X2dlbV9m
YXVsdCgpLgotICovCi12b2lkCi1pOTE1X2dlbV9yZWxlYXNlX21tYXAoc3RydWN0IGRybV9pOTE1
X2dlbV9vYmplY3QgKm9iaikKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRv
X2k5MTUob2JqLT5iYXNlLmRldik7Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7Ci0KLQkvKiBT
ZXJpYWxpc2F0aW9uIGJldHdlZW4gdXNlciBHVFQgYWNjZXNzIGFuZCBvdXIgY29kZSBkZXBlbmRz
IHVwb24KLQkgKiByZXZva2luZyB0aGUgQ1BVJ3MgUFRFIHdoaWxzdCB0aGUgbXV0ZXggaXMgaGVs
ZC4gVGhlIG5leHQgdXNlcgotCSAqIHBhZ2VmYXVsdCB0aGVuIGhhcyB0byB3YWl0IHVudGlsIHdl
IHJlbGVhc2UgdGhlIG11dGV4LgotCSAqCi0JICogTm90ZSB0aGF0IFJQTSBjb21wbGljYXRlcyBz
b21ld2hhdCBieSBhZGRpbmcgYW4gYWRkaXRpb25hbAotCSAqIHJlcXVpcmVtZW50IHRoYXQgb3Bl
cmF0aW9ucyB0byB0aGUgR0dUVCBiZSBtYWRlIGhvbGRpbmcgdGhlIFJQTQotCSAqIHdha2VyZWYu
Ci0JICovCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0J
d2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KGk5MTUpOwotCi0JaWYgKCFvYmotPnVzZXJm
YXVsdF9jb3VudCkKLQkJZ290byBvdXQ7Ci0KLQlfX2k5MTVfZ2VtX29iamVjdF9yZWxlYXNlX21t
YXAob2JqKTsKLQotCS8qIEVuc3VyZSB0aGF0IHRoZSBDUFUncyBQVEUgYXJlIHJldm9rZWQgYW5k
IHRoZXJlIGFyZSBub3Qgb3V0c3RhbmRpbmcKLQkgKiBtZW1vcnkgdHJhbnNhY3Rpb25zIGZyb20g
dXNlcnNwYWNlIGJlZm9yZSB3ZSByZXR1cm4uIFRoZSBUTEIKLQkgKiBmbHVzaGluZyBpbXBsaWVk
IGFib3ZlIGJ5IGNoYW5naW5nIHRoZSBQVEUgYWJvdmUgKnNob3VsZCogYmUKLQkgKiBzdWZmaWNp
ZW50LCBhbiBleHRyYSBiYXJyaWVyIGhlcmUganVzdCBwcm92aWRlcyB1cyB3aXRoIGEgYml0Ci0J
ICogb2YgcGFyYW5vaWQgZG9jdW1lbnRhdGlvbiBhYm91dCBvdXIgcmVxdWlyZW1lbnQgdG8gc2Vy
aWFsaXNlCi0JICogbWVtb3J5IHdyaXRlcyBiZWZvcmUgdG91Y2hpbmcgcmVnaXN0ZXJzIC8gR1NN
LgotCSAqLwotCXdtYigpOwotCi1vdXQ6Ci0JaW50ZWxfcnVudGltZV9wbV9wdXQoaTkxNSwgd2Fr
ZXJlZik7Ci19Ci0KIHZvaWQgaTkxNV9nZW1fcnVudGltZV9zdXNwZW5kKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
LCAqb247CkBAIC0xNzgyLDc4ICsxMzIxLDYgQEAgdm9pZCBpOTE1X2dlbV9ydW50aW1lX3N1c3Bl
bmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCX0KIH0KIAotc3RhdGljIGlu
dCBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX21tYXBfb2Zmc2V0KHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmopCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShvYmotPmJhc2UuZGV2KTsKLQlpbnQgZXJyOwotCi0JZXJyID0gZHJtX2dlbV9jcmVhdGVf
bW1hcF9vZmZzZXQoJm9iai0+YmFzZSk7Ci0JaWYgKGxpa2VseSghZXJyKSkKLQkJcmV0dXJuIDA7
Ci0KLQkvKiBBdHRlbXB0IHRvIHJlYXAgc29tZSBtbWFwIHNwYWNlIGZyb20gZGVhZCBvYmplY3Rz
ICovCi0JZG8gewotCQllcnIgPSBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGRldl9wcml2LAotCQkJ
CQkgICAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFLAotCQkJCQkgICAgIE1BWF9TQ0hFRFVMRV9U
SU1FT1VUKTsKLQkJaWYgKGVycikKLQkJCWJyZWFrOwotCi0JCWk5MTVfZ2VtX2RyYWluX2ZyZWVk
X29iamVjdHMoZGV2X3ByaXYpOwotCQllcnIgPSBkcm1fZ2VtX2NyZWF0ZV9tbWFwX29mZnNldCgm
b2JqLT5iYXNlKTsKLQkJaWYgKCFlcnIpCi0JCQlicmVhazsKLQotCX0gd2hpbGUgKGZsdXNoX2Rl
bGF5ZWRfd29yaygmZGV2X3ByaXYtPmdlbS5yZXRpcmVfd29yaykpOwotCi0JcmV0dXJuIGVycjsK
LX0KLQotaW50Ci1pOTE1X2dlbV9tbWFwX2d0dChzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUsCi0JCSAg
c3RydWN0IGRybV9kZXZpY2UgKmRldiwKLQkJICB1MzIgaGFuZGxlLAotCQkgIHU2NCAqb2Zmc2V0
KQotewotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7Ci0JaW50IHJldDsKLQotCW9i
aiA9IGk5MTVfZ2VtX29iamVjdF9sb29rdXAoZmlsZSwgaGFuZGxlKTsKLQlpZiAoIW9iaikKLQkJ
cmV0dXJuIC1FTk9FTlQ7Ci0KLQlyZXQgPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX21tYXBfb2Zm
c2V0KG9iaik7Ci0JaWYgKHJldCA9PSAwKQotCQkqb2Zmc2V0ID0gZHJtX3ZtYV9ub2RlX29mZnNl
dF9hZGRyKCZvYmotPmJhc2Uudm1hX25vZGUpOwotCi0JaTkxNV9nZW1fb2JqZWN0X3B1dChvYmop
OwotCXJldHVybiByZXQ7Ci19Ci0KLS8qKgotICogaTkxNV9nZW1fbW1hcF9ndHRfaW9jdGwgLSBw
cmVwYXJlIGFuIG9iamVjdCBmb3IgR1RUIG1tYXAnaW5nCi0gKiBAZGV2OiBEUk0gZGV2aWNlCi0g
KiBAZGF0YTogR1RUIG1hcHBpbmcgaW9jdGwgZGF0YQotICogQGZpbGU6IEdFTSBvYmplY3QgaW5m
bwotICoKLSAqIFNpbXBseSByZXR1cm5zIHRoZSBmYWtlIG9mZnNldCB0byB1c2Vyc3BhY2Ugc28g
aXQgY2FuIG1tYXAgaXQuCi0gKiBUaGUgbW1hcCBjYWxsIHdpbGwgZW5kIHVwIGluIGRybV9nZW1f
bW1hcCgpLCB3aGljaCB3aWxsIHNldCB0aGluZ3MKLSAqIHVwIHNvIHdlIGNhbiBnZXQgZmF1bHRz
IGluIHRoZSBoYW5kbGVyIGFib3ZlLgotICoKLSAqIFRoZSBmYXVsdCBoYW5kbGVyIHdpbGwgdGFr
ZSBjYXJlIG9mIGJpbmRpbmcgdGhlIG9iamVjdCBpbnRvIHRoZSBHVFQKLSAqIChzaW5jZSBpdCBt
YXkgaGF2ZSBiZWVuIGV2aWN0ZWQgdG8gbWFrZSByb29tIGZvciBzb21ldGhpbmcpLCBhbGxvY2F0
aW5nCi0gKiBhIGZlbmNlIHJlZ2lzdGVyLCBhbmQgbWFwcGluZyB0aGUgYXBwcm9wcmlhdGUgYXBl
cnR1cmUgYWRkcmVzcyBpbnRvCi0gKiB1c2Vyc3BhY2UuCi0gKi8KLWludAotaTkxNV9nZW1fbW1h
cF9ndHRfaW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKLQkJCXN0cnVj
dCBkcm1fZmlsZSAqZmlsZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX21tYXBfZ3R0ICphcmdz
ID0gZGF0YTsKLQotCXJldHVybiBpOTE1X2dlbV9tbWFwX2d0dChmaWxlLCBkZXYsIGFyZ3MtPmhh
bmRsZSwgJmFyZ3MtPm9mZnNldCk7Ci19Ci0KIGJvb2wgaTkxNV9zZ190cmltKHN0cnVjdCBzZ190
YWJsZSAqb3JpZ19zdCkKIHsKIAlzdHJ1Y3Qgc2dfdGFibGUgbmV3X3N0OwpAQCAtMjA1Nyw3ICsx
NTI0LDcgQEAgc3RhdGljIHZvaWQgX19pOTE1X2dlbV9vYmplY3RfZmx1c2hfZm9yX2Rpc3BsYXko
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAkgKiBXZSBtYW51YWxseSBmbHVzaCB0
aGUgQ1BVIGRvbWFpbiBzbyB0aGF0IHdlIGNhbiBvdmVycmlkZSBhbmQKIAkgKiBmb3JjZSB0aGUg
Zmx1c2ggZm9yIHRoZSBkaXNwbGF5LCBhbmQgcGVyZm9ybSBpdCBhc3luY3Job25vdXNseS4KIAkg
Ki8KLQlmbHVzaF93cml0ZV9kb21haW4ob2JqLCB+STkxNV9HRU1fRE9NQUlOX0NQVSk7CisJaTkx
NV9nZW1fb2JqZWN0X2ZsdXNoX3dyaXRlX2RvbWFpbihvYmosIH5JOTE1X0dFTV9ET01BSU5fQ1BV
KTsKIAlpZiAob2JqLT5jYWNoZV9kaXJ0eSkKIAkJaTkxNV9nZW1fY2xmbHVzaF9vYmplY3Qob2Jq
LCBJOTE1X0NMRkxVU0hfRk9SQ0UpOwogCW9iai0+d3JpdGVfZG9tYWluID0gMDsKQEAgLTIxMTEs
NyArMTU3OCw3IEBAIGk5MTVfZ2VtX29iamVjdF9zZXRfdG9fd2NfZG9tYWluKHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmosIGJvb2wgd3JpdGUpCiAJaWYgKHJldCkKIAkJcmV0dXJuIHJl
dDsKIAotCWZsdXNoX3dyaXRlX2RvbWFpbihvYmosIH5JOTE1X0dFTV9ET01BSU5fV0MpOworCWk5
MTVfZ2VtX29iamVjdF9mbHVzaF93cml0ZV9kb21haW4ob2JqLCB+STkxNV9HRU1fRE9NQUlOX1dD
KTsKIAogCS8qIFNlcmlhbGlzZSBkaXJlY3QgYWNjZXNzIHRvIHRoaXMgb2JqZWN0IHdpdGggdGhl
IGJhcnJpZXJzIGZvcgogCSAqIGNvaGVyZW50IHdyaXRlcyBmcm9tIHRoZSBHUFUsIGJ5IGVmZmVj
dGl2ZWx5IGludmFsaWRhdGluZyB0aGUKQEAgLTIxNzMsNyArMTY0MCw3IEBAIGk5MTVfZ2VtX29i
amVjdF9zZXRfdG9fZ3R0X2RvbWFpbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCBi
b29sIHdyaXRlKQogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlmbHVzaF93cml0ZV9kb21h
aW4ob2JqLCB+STkxNV9HRU1fRE9NQUlOX0dUVCk7CisJaTkxNV9nZW1fb2JqZWN0X2ZsdXNoX3dy
aXRlX2RvbWFpbihvYmosIH5JOTE1X0dFTV9ET01BSU5fR1RUKTsKIAogCS8qIFNlcmlhbGlzZSBk
aXJlY3QgYWNjZXNzIHRvIHRoaXMgb2JqZWN0IHdpdGggdGhlIGJhcnJpZXJzIGZvcgogCSAqIGNv
aGVyZW50IHdyaXRlcyBmcm9tIHRoZSBHUFUsIGJ5IGVmZmVjdGl2ZWx5IGludmFsaWRhdGluZyB0
aGUKQEAgLTIyODIsNyArMTc0OSw3IEBAIGludCBpOTE1X2dlbV9vYmplY3Rfc2V0X2NhY2hlX2xl
dmVsKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJCQkgKiB0aGVuIGRvdWJsZSBj
aGVjayBpZiB0aGUgR1RUIG1hcHBpbmcgaXMgc3RpbGwKIAkJCSAqIHZhbGlkIGZvciB0aGF0IHBv
aW50ZXIgYWNjZXNzLgogCQkJICovCi0JCQlpOTE1X2dlbV9yZWxlYXNlX21tYXAob2JqKTsKKwkJ
CWk5MTVfZ2VtX29iamVjdF9yZWxlYXNlX21tYXAob2JqKTsKIAogCQkJLyogQXMgd2Ugbm8gbG9u
Z2VyIG5lZWQgYSBmZW5jZSBmb3IgR1RUIGFjY2VzcywKIAkJCSAqIHdlIGNhbiByZWxpbnF1aXNo
IGl0IG5vdyAoYW5kIHNvIHByZXZlbnQgaGF2aW5nCkBAIC0yNTM3LDcgKzIwMDQsNyBAQCBpOTE1
X2dlbV9vYmplY3Rfc2V0X3RvX2NwdV9kb21haW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iaiwgYm9vbCB3cml0ZSkKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0JZmx1c2hfd3Jp
dGVfZG9tYWluKG9iaiwgfkk5MTVfR0VNX0RPTUFJTl9DUFUpOworCWk5MTVfZ2VtX29iamVjdF9m
bHVzaF93cml0ZV9kb21haW4ob2JqLCB+STkxNV9HRU1fRE9NQUlOX0NQVSk7CiAKIAkvKiBGbHVz
aCB0aGUgQ1BVIGNhY2hlIGlmIGl0J3Mgc3RpbGwgaW52YWxpZC4gKi8KIAlpZiAoKG9iai0+cmVh
ZF9kb21haW5zICYgSTkxNV9HRU1fRE9NQUlOX0NQVSkgPT0gMCkgewpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fdGlsaW5nLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbV90aWxpbmcuYwppbmRleCA3ZDVjYzljY2Y2ZGQuLjg2ZDZkOTJjY2JjOSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fdGlsaW5nLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fdGlsaW5nLmMKQEAgLTI5OSw3ICsyOTksNyBAQCBp
OTE1X2dlbV9vYmplY3Rfc2V0X3RpbGluZyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
LAogCWk5MTVfZ2VtX29iamVjdF91bmxvY2sob2JqKTsKIAogCS8qIEZvcmNlIHRoZSBmZW5jZSB0
byBiZSByZWFjcXVpcmVkIGZvciBHVFQgYWNjZXNzICovCi0JaTkxNV9nZW1fcmVsZWFzZV9tbWFw
KG9iaik7CisJaTkxNV9nZW1fb2JqZWN0X3JlbGVhc2VfbW1hcChvYmopOwogCiAJLyogVHJ5IHRv
IHByZWFsbG9jYXRlIG1lbW9yeSByZXF1aXJlZCB0byBzYXZlIHN3aXp6bGluZyBvbiBwdXQtcGFn
ZXMgKi8KIAlpZiAoaTkxNV9nZW1fb2JqZWN0X25lZWRzX2JpdDE3X3N3aXp6bGUob2JqKSkgewpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVj
dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVjdC5jCmlu
ZGV4IGI5OGEyODZhOGJlNS4uYTNkZDJmMWJlOTViIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fb2JqZWN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVjdC5jCkBAIC04OSw0OTEgKzg5LDYgQEAgc3Rh
dGljIGludCBpZ3RfZ2VtX2h1Z2Uodm9pZCAqYXJnKQogCXJldHVybiBlcnI7CiB9CiAKLXN0cnVj
dCB0aWxlIHsKLQl1bnNpZ25lZCBpbnQgd2lkdGg7Ci0JdW5zaWduZWQgaW50IGhlaWdodDsKLQl1
bnNpZ25lZCBpbnQgc3RyaWRlOwotCXVuc2lnbmVkIGludCBzaXplOwotCXVuc2lnbmVkIGludCB0
aWxpbmc7Ci0JdW5zaWduZWQgaW50IHN3aXp6bGU7Ci19OwotCi1zdGF0aWMgdTY0IHN3aXp6bGVf
Yml0KHVuc2lnbmVkIGludCBiaXQsIHU2NCBvZmZzZXQpCi17Ci0JcmV0dXJuIChvZmZzZXQgJiBC
SVRfVUxMKGJpdCkpID4+IChiaXQgLSA2KTsKLX0KLQotc3RhdGljIHU2NCB0aWxlZF9vZmZzZXQo
Y29uc3Qgc3RydWN0IHRpbGUgKnRpbGUsIHU2NCB2KQotewotCXU2NCB4LCB5OwotCi0JaWYgKHRp
bGUtPnRpbGluZyA9PSBJOTE1X1RJTElOR19OT05FKQotCQlyZXR1cm4gdjsKLQotCXkgPSBkaXY2
NF91NjRfcmVtKHYsIHRpbGUtPnN0cmlkZSwgJngpOwotCXYgPSBkaXY2NF91NjRfcmVtKHksIHRp
bGUtPmhlaWdodCwgJnkpICogdGlsZS0+c3RyaWRlICogdGlsZS0+aGVpZ2h0OwotCi0JaWYgKHRp
bGUtPnRpbGluZyA9PSBJOTE1X1RJTElOR19YKSB7Ci0JCXYgKz0geSAqIHRpbGUtPndpZHRoOwot
CQl2ICs9IGRpdjY0X3U2NF9yZW0oeCwgdGlsZS0+d2lkdGgsICZ4KSA8PCB0aWxlLT5zaXplOwot
CQl2ICs9IHg7Ci0JfSBlbHNlIGlmICh0aWxlLT53aWR0aCA9PSAxMjgpIHsKLQkJY29uc3QgdW5z
aWduZWQgaW50IHl0aWxlX3NwYW4gPSAxNjsKLQkJY29uc3QgdW5zaWduZWQgaW50IHl0aWxlX2hl
aWdodCA9IDUxMjsKLQotCQl2ICs9IHkgKiB5dGlsZV9zcGFuOwotCQl2ICs9IGRpdjY0X3U2NF9y
ZW0oeCwgeXRpbGVfc3BhbiwgJngpICogeXRpbGVfaGVpZ2h0OwotCQl2ICs9IHg7Ci0JfSBlbHNl
IHsKLQkJY29uc3QgdW5zaWduZWQgaW50IHl0aWxlX3NwYW4gPSAzMjsKLQkJY29uc3QgdW5zaWdu
ZWQgaW50IHl0aWxlX2hlaWdodCA9IDI1NjsKLQotCQl2ICs9IHkgKiB5dGlsZV9zcGFuOwotCQl2
ICs9IGRpdjY0X3U2NF9yZW0oeCwgeXRpbGVfc3BhbiwgJngpICogeXRpbGVfaGVpZ2h0OwotCQl2
ICs9IHg7Ci0JfQotCi0Jc3dpdGNoICh0aWxlLT5zd2l6emxlKSB7Ci0JY2FzZSBJOTE1X0JJVF82
X1NXSVpaTEVfOToKLQkJdiBePSBzd2l6emxlX2JpdCg5LCB2KTsKLQkJYnJlYWs7Ci0JY2FzZSBJ
OTE1X0JJVF82X1NXSVpaTEVfOV8xMDoKLQkJdiBePSBzd2l6emxlX2JpdCg5LCB2KSBeIHN3aXp6
bGVfYml0KDEwLCB2KTsKLQkJYnJlYWs7Ci0JY2FzZSBJOTE1X0JJVF82X1NXSVpaTEVfOV8xMToK
LQkJdiBePSBzd2l6emxlX2JpdCg5LCB2KSBeIHN3aXp6bGVfYml0KDExLCB2KTsKLQkJYnJlYWs7
Ci0JY2FzZSBJOTE1X0JJVF82X1NXSVpaTEVfOV8xMF8xMToKLQkJdiBePSBzd2l6emxlX2JpdCg5
LCB2KSBeIHN3aXp6bGVfYml0KDEwLCB2KSBeIHN3aXp6bGVfYml0KDExLCB2KTsKLQkJYnJlYWs7
Ci0JfQotCi0JcmV0dXJuIHY7Ci19Ci0KLXN0YXRpYyBpbnQgY2hlY2tfcGFydGlhbF9tYXBwaW5n
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCi0JCQkJIGNvbnN0IHN0cnVjdCB0aWxl
ICp0aWxlLAotCQkJCSB1bnNpZ25lZCBsb25nIGVuZF90aW1lKQotewotCWNvbnN0IHVuc2lnbmVk
IGludCBucmVhbCA9IG9iai0+c2NyYXRjaCAvIFBBR0VfU0laRTsKLQljb25zdCB1bnNpZ25lZCBs
b25nIG5wYWdlcyA9IG9iai0+YmFzZS5zaXplIC8gUEFHRV9TSVpFOwotCXN0cnVjdCBpOTE1X3Zt
YSAqdm1hOwotCXVuc2lnbmVkIGxvbmcgcGFnZTsKLQlpbnQgZXJyOwotCi0JaWYgKGlndF90aW1l
b3V0KGVuZF90aW1lLAotCQkJIiVzOiB0aW1lZCBvdXQgYmVmb3JlIHRpbGluZz0lZCBzdHJpZGU9
JWRcbiIsCi0JCQlfX2Z1bmNfXywgdGlsZS0+dGlsaW5nLCB0aWxlLT5zdHJpZGUpKQotCQlyZXR1
cm4gLUVJTlRSOwotCi0JZXJyID0gaTkxNV9nZW1fb2JqZWN0X3NldF90aWxpbmcob2JqLCB0aWxl
LT50aWxpbmcsIHRpbGUtPnN0cmlkZSk7Ci0JaWYgKGVycikgewotCQlwcl9lcnIoIkZhaWxlZCB0
byBzZXQgdGlsaW5nIG1vZGU9JXUsIHN0cmlkZT0ldSwgZXJyPSVkXG4iLAotCQkgICAgICAgdGls
ZS0+dGlsaW5nLCB0aWxlLT5zdHJpZGUsIGVycik7Ci0JCXJldHVybiBlcnI7Ci0JfQotCi0JR0VN
X0JVR19PTihpOTE1X2dlbV9vYmplY3RfZ2V0X3RpbGluZyhvYmopICE9IHRpbGUtPnRpbGluZyk7
Ci0JR0VNX0JVR19PTihpOTE1X2dlbV9vYmplY3RfZ2V0X3N0cmlkZShvYmopICE9IHRpbGUtPnN0
cmlkZSk7Ci0KLQlmb3JfZWFjaF9wcmltZV9udW1iZXJfZnJvbShwYWdlLCAxLCBucGFnZXMpIHsK
LQkJc3RydWN0IGk5MTVfZ2d0dF92aWV3IHZpZXcgPQotCQkJY29tcHV0ZV9wYXJ0aWFsX3ZpZXco
b2JqLCBwYWdlLCBNSU5fQ0hVTktfUEFHRVMpOwotCQl1MzIgX19pb21lbSAqaW87Ci0JCXN0cnVj
dCBwYWdlICpwOwotCQl1bnNpZ25lZCBpbnQgbjsKLQkJdTY0IG9mZnNldDsKLQkJdTMyICpjcHU7
Ci0KLQkJR0VNX0JVR19PTih2aWV3LnBhcnRpYWwuc2l6ZSA+IG5yZWFsKTsKLQkJY29uZF9yZXNj
aGVkKCk7Ci0KLQkJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3NldF90b19ndHRfZG9tYWluKG9iaiwg
dHJ1ZSk7Ci0JCWlmIChlcnIpIHsKLQkJCXByX2VycigiRmFpbGVkIHRvIGZsdXNoIHRvIEdUVCB3
cml0ZSBkb21haW47IGVycj0lZFxuIiwKLQkJCSAgICAgICBlcnIpOwotCQkJcmV0dXJuIGVycjsK
LQkJfQotCi0JCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihvYmosICZ2aWV3LCAwLCAw
LCBQSU5fTUFQUEFCTEUpOwotCQlpZiAoSVNfRVJSKHZtYSkpIHsKLQkJCXByX2VycigiRmFpbGVk
IHRvIHBpbiBwYXJ0aWFsIHZpZXc6IG9mZnNldD0lbHU7IGVycj0lZFxuIiwKLQkJCSAgICAgICBw
YWdlLCAoaW50KVBUUl9FUlIodm1hKSk7Ci0JCQlyZXR1cm4gUFRSX0VSUih2bWEpOwotCQl9Ci0K
LQkJbiA9IHBhZ2UgLSB2aWV3LnBhcnRpYWwub2Zmc2V0OwotCQlHRU1fQlVHX09OKG4gPj0gdmll
dy5wYXJ0aWFsLnNpemUpOwotCi0JCWlvID0gaTkxNV92bWFfcGluX2lvbWFwKHZtYSk7Ci0JCWk5
MTVfdm1hX3VucGluKHZtYSk7Ci0JCWlmIChJU19FUlIoaW8pKSB7Ci0JCQlwcl9lcnIoIkZhaWxl
ZCB0byBpb21hcCBwYXJ0aWFsIHZpZXc6IG9mZnNldD0lbHU7IGVycj0lZFxuIiwKLQkJCSAgICAg
ICBwYWdlLCAoaW50KVBUUl9FUlIoaW8pKTsKLQkJCXJldHVybiBQVFJfRVJSKGlvKTsKLQkJfQot
Ci0JCWlvd3JpdGUzMihwYWdlLCBpbyArIG4gKiBQQUdFX1NJWkUvc2l6ZW9mKCppbykpOwotCQlp
OTE1X3ZtYV91bnBpbl9pb21hcCh2bWEpOwotCi0JCW9mZnNldCA9IHRpbGVkX29mZnNldCh0aWxl
LCBwYWdlIDw8IFBBR0VfU0hJRlQpOwotCQlpZiAob2Zmc2V0ID49IG9iai0+YmFzZS5zaXplKQot
CQkJY29udGludWU7Ci0KLQkJZmx1c2hfd3JpdGVfZG9tYWluKG9iaiwgfkk5MTVfR0VNX0RPTUFJ
Tl9DUFUpOwotCi0JCXAgPSBpOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2Uob2JqLCBvZmZzZXQgPj4g
UEFHRV9TSElGVCk7Ci0JCWNwdSA9IGttYXAocCkgKyBvZmZzZXRfaW5fcGFnZShvZmZzZXQpOwot
CQlkcm1fY2xmbHVzaF92aXJ0X3JhbmdlKGNwdSwgc2l6ZW9mKCpjcHUpKTsKLQkJaWYgKCpjcHUg
IT0gKHUzMilwYWdlKSB7Ci0JCQlwcl9lcnIoIlBhcnRpYWwgdmlldyBmb3IgJWx1IFsldV0gKG9m
ZnNldD0lbGx1LCBzaXplPSV1IFslbGx1LCByb3cgc2l6ZSAldV0sIGZlbmNlPSVkLCB0aWxpbmc9
JWQsIHN0cmlkZT0lZCkgbWlzYWxpZ25tZW50LCBleHBlY3RlZCB3cml0ZSB0byBwYWdlICglbGx1
ICsgJXUgWzB4JWxseF0pIG9mIDB4JXgsIGZvdW5kIDB4JXhcbiIsCi0JCQkgICAgICAgcGFnZSwg
biwKLQkJCSAgICAgICB2aWV3LnBhcnRpYWwub2Zmc2V0LAotCQkJICAgICAgIHZpZXcucGFydGlh
bC5zaXplLAotCQkJICAgICAgIHZtYS0+c2l6ZSA+PiBQQUdFX1NISUZULAotCQkJICAgICAgIHRp
bGUtPnRpbGluZyA/IHRpbGVfcm93X3BhZ2VzKG9iaikgOiAwLAotCQkJICAgICAgIHZtYS0+ZmVu
Y2UgPyB2bWEtPmZlbmNlLT5pZCA6IC0xLCB0aWxlLT50aWxpbmcsIHRpbGUtPnN0cmlkZSwKLQkJ
CSAgICAgICBvZmZzZXQgPj4gUEFHRV9TSElGVCwKLQkJCSAgICAgICAodW5zaWduZWQgaW50KW9m
ZnNldF9pbl9wYWdlKG9mZnNldCksCi0JCQkgICAgICAgb2Zmc2V0LAotCQkJICAgICAgICh1MzIp
cGFnZSwgKmNwdSk7Ci0JCQllcnIgPSAtRUlOVkFMOwotCQl9Ci0JCSpjcHUgPSAwOwotCQlkcm1f
Y2xmbHVzaF92aXJ0X3JhbmdlKGNwdSwgc2l6ZW9mKCpjcHUpKTsKLQkJa3VubWFwKHApOwotCQlp
ZiAoZXJyKQotCQkJcmV0dXJuIGVycjsKLQotCQlpOTE1X3ZtYV9kZXN0cm95KHZtYSk7Ci0JfQot
Ci0JcmV0dXJuIDA7Ci19Ci0KLXN0YXRpYyBpbnQgaWd0X3BhcnRpYWxfdGlsaW5nKHZvaWQgKmFy
ZykKLXsKLQljb25zdCB1bnNpZ25lZCBpbnQgbnJlYWwgPSAxIDw8IDEyOyAvKiBsYXJnZXN0IHRp
bGUgcm93IHgyICovCi0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7Ci0Jc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsK
LQlpbnQgdGlsaW5nOwotCWludCBlcnI7Ci0KLQkvKiBXZSB3YW50IHRvIGNoZWNrIHRoZSBwYWdl
IG1hcHBpbmcgYW5kIGZlbmNpbmcgb2YgYSBsYXJnZSBvYmplY3QKLQkgKiBtbWFwcGVkIHRocm91
Z2ggdGhlIEdUVC4gVGhlIG9iamVjdCB3ZSBjcmVhdGUgaXMgbGFyZ2VyIHRoYW4gY2FuCi0JICog
cG9zc2libHkgYmUgbW1hcGVkIGFzIGEgd2hvbGUsIGFuZCBzbyB3ZSBtdXN0IHVzZSBwYXJ0aWFs
IEdHVFQgdm1hLgotCSAqIFdlIHRoZW4gY2hlY2sgdGhhdCBhIHdyaXRlIHRocm91Z2ggZWFjaCBw
YXJ0aWFsIEdHVFQgdm1hIGVuZHMgdXAKLQkgKiBpbiB0aGUgcmlnaHQgc2V0IG9mIHBhZ2VzIHdp
dGhpbiB0aGUgb2JqZWN0LCBhbmQgd2l0aCB0aGUgZXhwZWN0ZWQKLQkgKiB0aWxpbmcsIHdoaWNo
IHdlIHZlcmlmeSBieSBtYW51YWwgc3dpenpsaW5nLgotCSAqLwotCi0Jb2JqID0gaHVnZV9nZW1f
b2JqZWN0KGk5MTUsCi0JCQkgICAgICBucmVhbCA8PCBQQUdFX1NISUZULAotCQkJICAgICAgKDEg
KyBuZXh0X3ByaW1lX251bWJlcihpOTE1LT5nZ3R0LnZtLnRvdGFsID4+IFBBR0VfU0hJRlQpKSA8
PCBQQUdFX1NISUZUKTsKLQlpZiAoSVNfRVJSKG9iaikpCi0JCXJldHVybiBQVFJfRVJSKG9iaik7
Ci0KLQllcnIgPSBpOTE1X2dlbV9vYmplY3RfcGluX3BhZ2VzKG9iaik7Ci0JaWYgKGVycikgewot
CQlwcl9lcnIoIkZhaWxlZCB0byBhbGxvY2F0ZSAldSBwYWdlcyAoJWx1IHRvdGFsKSwgZXJyPSVk
XG4iLAotCQkgICAgICAgbnJlYWwsIG9iai0+YmFzZS5zaXplIC8gUEFHRV9TSVpFLCBlcnIpOwot
CQlnb3RvIG91dDsKLQl9Ci0KLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
LQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoaTkxNSk7Ci0KLQlpZiAoMSkgewotCQlJ
R1RfVElNRU9VVChlbmQpOwotCQlzdHJ1Y3QgdGlsZSB0aWxlOwotCi0JCXRpbGUuaGVpZ2h0ID0g
MTsKLQkJdGlsZS53aWR0aCA9IDE7Ci0JCXRpbGUuc2l6ZSA9IDA7Ci0JCXRpbGUuc3RyaWRlID0g
MDsKLQkJdGlsZS5zd2l6emxlID0gSTkxNV9CSVRfNl9TV0laWkxFX05PTkU7Ci0JCXRpbGUudGls
aW5nID0gSTkxNV9USUxJTkdfTk9ORTsKLQotCQllcnIgPSBjaGVja19wYXJ0aWFsX21hcHBpbmco
b2JqLCAmdGlsZSwgZW5kKTsKLQkJaWYgKGVyciAmJiBlcnIgIT0gLUVJTlRSKQotCQkJZ290byBv
dXRfdW5sb2NrOwotCX0KLQotCWZvciAodGlsaW5nID0gSTkxNV9USUxJTkdfWDsgdGlsaW5nIDw9
IEk5MTVfVElMSU5HX1k7IHRpbGluZysrKSB7Ci0JCUlHVF9USU1FT1VUKGVuZCk7Ci0JCXVuc2ln
bmVkIGludCBtYXhfcGl0Y2g7Ci0JCXVuc2lnbmVkIGludCBwaXRjaDsKLQkJc3RydWN0IHRpbGUg
dGlsZTsKLQotCQlpZiAoaTkxNS0+cXVpcmtzICYgUVVJUktfUElOX1NXSVpaTEVEX1BBR0VTKQot
CQkJLyoKLQkJCSAqIFRoZSBzd2l6emxpbmcgcGF0dGVybiBpcyBhY3R1YWxseSB1bmtub3duIGFz
IGl0Ci0JCQkgKiB2YXJpZXMgYmFzZWQgb24gcGh5c2ljYWwgYWRkcmVzcyBvZiBlYWNoIHBhZ2Uu
Ci0JCQkgKiBTZWUgaTkxNV9nZW1fZGV0ZWN0X2JpdF82X3N3aXp6bGUoKS4KLQkJCSAqLwotCQkJ
YnJlYWs7Ci0KLQkJdGlsZS50aWxpbmcgPSB0aWxpbmc7Ci0JCXN3aXRjaCAodGlsaW5nKSB7Ci0J
CWNhc2UgSTkxNV9USUxJTkdfWDoKLQkJCXRpbGUuc3dpenpsZSA9IGk5MTUtPm1tLmJpdF82X3N3
aXp6bGVfeDsKLQkJCWJyZWFrOwotCQljYXNlIEk5MTVfVElMSU5HX1k6Ci0JCQl0aWxlLnN3aXp6
bGUgPSBpOTE1LT5tbS5iaXRfNl9zd2l6emxlX3k7Ci0JCQlicmVhazsKLQkJfQotCi0JCUdFTV9C
VUdfT04odGlsZS5zd2l6emxlID09IEk5MTVfQklUXzZfU1dJWlpMRV9VTktOT1dOKTsKLQkJaWYg
KHRpbGUuc3dpenpsZSA9PSBJOTE1X0JJVF82X1NXSVpaTEVfOV8xNyB8fAotCQkgICAgdGlsZS5z
d2l6emxlID09IEk5MTVfQklUXzZfU1dJWlpMRV85XzEwXzE3KQotCQkJY29udGludWU7Ci0KLQkJ
aWYgKElOVEVMX0dFTihpOTE1KSA8PSAyKSB7Ci0JCQl0aWxlLmhlaWdodCA9IDE2OwotCQkJdGls
ZS53aWR0aCA9IDEyODsKLQkJCXRpbGUuc2l6ZSA9IDExOwotCQl9IGVsc2UgaWYgKHRpbGUudGls
aW5nID09IEk5MTVfVElMSU5HX1kgJiYKLQkJCSAgIEhBU18xMjhfQllURV9ZX1RJTElORyhpOTE1
KSkgewotCQkJdGlsZS5oZWlnaHQgPSAzMjsKLQkJCXRpbGUud2lkdGggPSAxMjg7Ci0JCQl0aWxl
LnNpemUgPSAxMjsKLQkJfSBlbHNlIHsKLQkJCXRpbGUuaGVpZ2h0ID0gODsKLQkJCXRpbGUud2lk
dGggPSA1MTI7Ci0JCQl0aWxlLnNpemUgPSAxMjsKLQkJfQotCi0JCWlmIChJTlRFTF9HRU4oaTkx
NSkgPCA0KQotCQkJbWF4X3BpdGNoID0gODE5MiAvIHRpbGUud2lkdGg7Ci0JCWVsc2UgaWYgKElO
VEVMX0dFTihpOTE1KSA8IDcpCi0JCQltYXhfcGl0Y2ggPSAxMjggKiBJOTY1X0ZFTkNFX01BWF9Q
SVRDSF9WQUwgLyB0aWxlLndpZHRoOwotCQllbHNlCi0JCQltYXhfcGl0Y2ggPSAxMjggKiBHRU43
X0ZFTkNFX01BWF9QSVRDSF9WQUwgLyB0aWxlLndpZHRoOwotCi0JCWZvciAocGl0Y2ggPSBtYXhf
cGl0Y2g7IHBpdGNoOyBwaXRjaCA+Pj0gMSkgewotCQkJdGlsZS5zdHJpZGUgPSB0aWxlLndpZHRo
ICogcGl0Y2g7Ci0JCQllcnIgPSBjaGVja19wYXJ0aWFsX21hcHBpbmcob2JqLCAmdGlsZSwgZW5k
KTsKLQkJCWlmIChlcnIgPT0gLUVJTlRSKQotCQkJCWdvdG8gbmV4dF90aWxpbmc7Ci0JCQlpZiAo
ZXJyKQotCQkJCWdvdG8gb3V0X3VubG9jazsKLQotCQkJaWYgKHBpdGNoID4gMiAmJiBJTlRFTF9H
RU4oaTkxNSkgPj0gNCkgewotCQkJCXRpbGUuc3RyaWRlID0gdGlsZS53aWR0aCAqIChwaXRjaCAt
IDEpOwotCQkJCWVyciA9IGNoZWNrX3BhcnRpYWxfbWFwcGluZyhvYmosICZ0aWxlLCBlbmQpOwot
CQkJCWlmIChlcnIgPT0gLUVJTlRSKQotCQkJCQlnb3RvIG5leHRfdGlsaW5nOwotCQkJCWlmIChl
cnIpCi0JCQkJCWdvdG8gb3V0X3VubG9jazsKLQkJCX0KLQotCQkJaWYgKHBpdGNoIDwgbWF4X3Bp
dGNoICYmIElOVEVMX0dFTihpOTE1KSA+PSA0KSB7Ci0JCQkJdGlsZS5zdHJpZGUgPSB0aWxlLndp
ZHRoICogKHBpdGNoICsgMSk7Ci0JCQkJZXJyID0gY2hlY2tfcGFydGlhbF9tYXBwaW5nKG9iaiwg
JnRpbGUsIGVuZCk7Ci0JCQkJaWYgKGVyciA9PSAtRUlOVFIpCi0JCQkJCWdvdG8gbmV4dF90aWxp
bmc7Ci0JCQkJaWYgKGVycikKLQkJCQkJZ290byBvdXRfdW5sb2NrOwotCQkJfQotCQl9Ci0KLQkJ
aWYgKElOVEVMX0dFTihpOTE1KSA+PSA0KSB7Ci0JCQlmb3JfZWFjaF9wcmltZV9udW1iZXIocGl0
Y2gsIG1heF9waXRjaCkgewotCQkJCXRpbGUuc3RyaWRlID0gdGlsZS53aWR0aCAqIHBpdGNoOwot
CQkJCWVyciA9IGNoZWNrX3BhcnRpYWxfbWFwcGluZyhvYmosICZ0aWxlLCBlbmQpOwotCQkJCWlm
IChlcnIgPT0gLUVJTlRSKQotCQkJCQlnb3RvIG5leHRfdGlsaW5nOwotCQkJCWlmIChlcnIpCi0J
CQkJCWdvdG8gb3V0X3VubG9jazsKLQkJCX0KLQkJfQotCi1uZXh0X3RpbGluZzogOwotCX0KLQot
b3V0X3VubG9jazoKLQlpbnRlbF9ydW50aW1lX3BtX3B1dChpOTE1LCB3YWtlcmVmKTsKLQltdXRl
eF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWk5MTVfZ2VtX29iamVjdF91bnBp
bl9wYWdlcyhvYmopOwotb3V0OgotCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKLQlyZXR1cm4g
ZXJyOwotfQotCi1zdGF0aWMgaW50IG1ha2Vfb2JqX2J1c3koc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaikKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUo
b2JqLT5iYXNlLmRldik7Ci0Jc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7Ci0Jc3RydWN0IGk5MTVf
dm1hICp2bWE7Ci0JaW50IGVycjsKLQotCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgJmk5
MTUtPmdndHQudm0sIE5VTEwpOwotCWlmIChJU19FUlIodm1hKSkKLQkJcmV0dXJuIFBUUl9FUlIo
dm1hKTsKLQotCWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIFBJTl9VU0VSKTsKLQlpZiAo
ZXJyKQotCQlyZXR1cm4gZXJyOwotCi0JcnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKGk5MTUtPmVu
Z2luZVtSQ1MwXS0+a2VybmVsX2NvbnRleHQpOwotCWlmIChJU19FUlIocnEpKSB7Ci0JCWk5MTVf
dm1hX3VucGluKHZtYSk7Ci0JCXJldHVybiBQVFJfRVJSKHJxKTsKLQl9Ci0KLQllcnIgPSBpOTE1
X3ZtYV9tb3ZlX3RvX2FjdGl2ZSh2bWEsIHJxLCBFWEVDX09CSkVDVF9XUklURSk7Ci0KLQlpOTE1
X3JlcXVlc3RfYWRkKHJxKTsKLQotCV9faTkxNV9nZW1fb2JqZWN0X3JlbGVhc2VfdW5sZXNzX2Fj
dGl2ZShvYmopOwotCWk5MTVfdm1hX3VucGluKHZtYSk7Ci0KLQlyZXR1cm4gZXJyOwotfQotCi1z
dGF0aWMgYm9vbCBhc3NlcnRfbW1hcF9vZmZzZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCi0JCQkgICAgICAgdW5zaWduZWQgbG9uZyBzaXplLAotCQkJICAgICAgIGludCBleHBlY3Rl
ZCkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwotCWludCBlcnI7Ci0KLQlv
YmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGk5MTUsIHNpemUpOwotCWlmIChJ
U19FUlIob2JqKSkKLQkJcmV0dXJuIFBUUl9FUlIob2JqKTsKLQotCWVyciA9IGk5MTVfZ2VtX29i
amVjdF9jcmVhdGVfbW1hcF9vZmZzZXQob2JqKTsKLQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7
Ci0KLQlyZXR1cm4gZXJyID09IGV4cGVjdGVkOwotfQotCi1zdGF0aWMgdm9pZCBkaXNhYmxlX3Jl
dGlyZV93b3JrZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCi17Ci0JaTkxNV9nZW1f
c2hyaW5rZXJfdW5yZWdpc3RlcihpOTE1KTsKLQotCWludGVsX2d0X3BtX2dldChpOTE1KTsKLQot
CWNhbmNlbF9kZWxheWVkX3dvcmtfc3luYygmaTkxNS0+Z2VtLnJldGlyZV93b3JrKTsKLQlmbHVz
aF93b3JrKCZpOTE1LT5nZW0uaWRsZV93b3JrKTsKLX0KLQotc3RhdGljIHZvaWQgcmVzdG9yZV9y
ZXRpcmVfd29ya2VyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQotewotCWludGVsX2d0
X3BtX3B1dChpOTE1KTsKLQotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwot
CWlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpOwotCW11dGV4X3VubG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQlpOTE1X2dlbV9zaHJpbmtlcl9yZWdpc3Rlcihp
OTE1KTsKLX0KLQotc3RhdGljIGludCBpZ3RfbW1hcF9vZmZzZXRfZXhoYXVzdGlvbih2b2lkICph
cmcpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7Ci0Jc3RydWN0IGRy
bV9tbSAqbW0gPSAmaTkxNS0+ZHJtLnZtYV9vZmZzZXRfbWFuYWdlci0+dm1fYWRkcl9zcGFjZV9t
bTsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwotCXN0cnVjdCBkcm1fbW1fbm9k
ZSByZXN2LCAqaG9sZTsKLQl1NjQgaG9sZV9zdGFydCwgaG9sZV9lbmQ7Ci0JaW50IGxvb3AsIGVy
cjsKLQotCS8qIERpc2FibGUgYmFja2dyb3VuZCByZWFwZXIgKi8KLQlkaXNhYmxlX3JldGlyZV93
b3JrZXIoaTkxNSk7Ci0JR0VNX0JVR19PTighaTkxNS0+Z3QuYXdha2UpOwotCi0JLyogVHJpbSB0
aGUgZGV2aWNlIG1tYXAgc3BhY2UgdG8gb25seSBhIHBhZ2UgKi8KLQltZW1zZXQoJnJlc3YsIDAs
IHNpemVvZihyZXN2KSk7Ci0JZHJtX21tX2Zvcl9lYWNoX2hvbGUoaG9sZSwgbW0sIGhvbGVfc3Rh
cnQsIGhvbGVfZW5kKSB7Ci0JCXJlc3Yuc3RhcnQgPSBob2xlX3N0YXJ0OwotCQlyZXN2LnNpemUg
PSBob2xlX2VuZCAtIGhvbGVfc3RhcnQgLSAxOyAvKiBQQUdFX1NJWkUgdW5pdHMgKi8KLQkJZXJy
ID0gZHJtX21tX3Jlc2VydmVfbm9kZShtbSwgJnJlc3YpOwotCQlpZiAoZXJyKSB7Ci0JCQlwcl9l
cnIoIkZhaWxlZCB0byB0cmltIFZNQSBtYW5hZ2VyLCBlcnI9JWRcbiIsIGVycik7Ci0JCQlnb3Rv
IG91dF9wYXJrOwotCQl9Ci0JCWJyZWFrOwotCX0KLQotCS8qIEp1c3QgZml0cyEgKi8KLQlpZiAo
IWFzc2VydF9tbWFwX29mZnNldChpOTE1LCBQQUdFX1NJWkUsIDApKSB7Ci0JCXByX2VycigiVW5h
YmxlIHRvIGluc2VydCBvYmplY3QgaW50byBzaW5nbGUgcGFnZSBob2xlXG4iKTsKLQkJZXJyID0g
LUVJTlZBTDsKLQkJZ290byBvdXQ7Ci0JfQotCi0JLyogVG9vIGxhcmdlICovCi0JaWYgKCFhc3Nl
cnRfbW1hcF9vZmZzZXQoaTkxNSwgMipQQUdFX1NJWkUsIC1FTk9TUEMpKSB7Ci0JCXByX2Vycigi
VW5leHBlY3RlZGx5IHN1Y2NlZWRlZCBpbiBpbnNlcnRpbmcgdG9vIGxhcmdlIG9iamVjdCBpbnRv
IHNpbmdsZSBwYWdlIGhvbGVcbiIpOwotCQllcnIgPSAtRUlOVkFMOwotCQlnb3RvIG91dDsKLQl9
Ci0KLQkvKiBGaWxsIHRoZSBob2xlLCBmdXJ0aGVyIGFsbG9jYXRpb24gYXR0ZW1wdHMgc2hvdWxk
IHRoZW4gZmFpbCAqLwotCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoaTkx
NSwgUEFHRV9TSVpFKTsKLQlpZiAoSVNfRVJSKG9iaikpIHsKLQkJZXJyID0gUFRSX0VSUihvYmop
OwotCQlnb3RvIG91dDsKLQl9Ci0KLQllcnIgPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX21tYXBf
b2Zmc2V0KG9iaik7Ci0JaWYgKGVycikgewotCQlwcl9lcnIoIlVuYWJsZSB0byBpbnNlcnQgb2Jq
ZWN0IGludG8gcmVjbGFpbWVkIGhvbGVcbiIpOwotCQlnb3RvIGVycl9vYmo7Ci0JfQotCi0JaWYg
KCFhc3NlcnRfbW1hcF9vZmZzZXQoaTkxNSwgUEFHRV9TSVpFLCAtRU5PU1BDKSkgewotCQlwcl9l
cnIoIlVuZXhwZWN0ZWRseSBzdWNjZWVkZWQgaW4gaW5zZXJ0aW5nIG9iamVjdCBpbnRvIG5vIGhv
bGVzIVxuIik7Ci0JCWVyciA9IC1FSU5WQUw7Ci0JCWdvdG8gZXJyX29iajsKLQl9Ci0KLQlpOTE1
X2dlbV9vYmplY3RfcHV0KG9iaik7Ci0KLQkvKiBOb3cgZmlsbCB3aXRoIGJ1c3kgZGVhZCBvYmpl
Y3RzIHRoYXQgd2UgZXhwZWN0IHRvIHJlYXAgKi8KLQlmb3IgKGxvb3AgPSAwOyBsb29wIDwgMzsg
bG9vcCsrKSB7Ci0JCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwotCi0JCWlmIChpOTE1X3Rlcm1p
bmFsbHlfd2VkZ2VkKGk5MTUpKQotCQkJYnJlYWs7Ci0KLQkJb2JqID0gaTkxNV9nZW1fb2JqZWN0
X2NyZWF0ZV9pbnRlcm5hbChpOTE1LCBQQUdFX1NJWkUpOwotCQlpZiAoSVNfRVJSKG9iaikpIHsK
LQkJCWVyciA9IFBUUl9FUlIob2JqKTsKLQkJCWdvdG8gb3V0OwotCQl9Ci0KLQkJZXJyID0gMDsK
LQkJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JCXdpdGhfaW50ZWxfcnVu
dGltZV9wbShpOTE1LCB3YWtlcmVmKQotCQkJZXJyID0gbWFrZV9vYmpfYnVzeShvYmopOwotCQlt
dXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCQlpZiAoZXJyKSB7Ci0JCQlw
cl9lcnIoIltsb29wICVkXSBGYWlsZWQgdG8gYnVzeSB0aGUgb2JqZWN0XG4iLCBsb29wKTsKLQkJ
CWdvdG8gZXJyX29iajsKLQkJfQotCi0JCS8qIE5CIHdlIHJlbHkgb24gdGhlIF9hY3RpdmVfIHJl
ZmVyZW5jZSB0byBhY2Nlc3Mgb2JqIG5vdyAqLwotCQlHRU1fQlVHX09OKCFpOTE1X2dlbV9vYmpl
Y3RfaXNfYWN0aXZlKG9iaikpOwotCQllcnIgPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX21tYXBf
b2Zmc2V0KG9iaik7Ci0JCWlmIChlcnIpIHsKLQkJCXByX2VycigiW2xvb3AgJWRdIGk5MTVfZ2Vt
X29iamVjdF9jcmVhdGVfbW1hcF9vZmZzZXQgZmFpbGVkIHdpdGggZXJyPSVkXG4iLAotCQkJICAg
ICAgIGxvb3AsIGVycik7Ci0JCQlnb3RvIG91dDsKLQkJfQotCX0KLQotb3V0OgotCWRybV9tbV9y
ZW1vdmVfbm9kZSgmcmVzdik7Ci1vdXRfcGFyazoKLQlyZXN0b3JlX3JldGlyZV93b3JrZXIoaTkx
NSk7Ci0JcmV0dXJuIGVycjsKLWVycl9vYmo6Ci0JaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwot
CWdvdG8gb3V0OwotfQotCiBpbnQgaTkxNV9nZW1fb2JqZWN0X21vY2tfc2VsZnRlc3RzKHZvaWQp
CiB7CiAJc3RhdGljIGNvbnN0IHN0cnVjdCBpOTE1X3N1YnRlc3QgdGVzdHNbXSA9IHsKQEAgLTU5
Niw4ICsxMTEsNiBAQCBpbnQgaTkxNV9nZW1fb2JqZWN0X2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogewogCXN0YXRpYyBjb25zdCBzdHJ1Y3QgaTkxNV9zdWJ0
ZXN0IHRlc3RzW10gPSB7CiAJCVNVQlRFU1QoaWd0X2dlbV9odWdlKSwKLQkJU1VCVEVTVChpZ3Rf
cGFydGlhbF90aWxpbmcpLAotCQlTVUJURVNUKGlndF9tbWFwX29mZnNldF9leGhhdXN0aW9uKSwK
IAl9OwogCiAJcmV0dXJuIGk5MTVfc3VidGVzdHModGVzdHMsIGk5MTUpOwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxmdGVzdHMuaCBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2xpdmVfc2VsZnRlc3RzLmgKaW5kZXgg
NmQ3NjY5MjVhZDA0Li5iYmYzODdkZThkYjMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X2xpdmVfc2VsZnRlc3RzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxmdGVzdHMuaApAQCAtMTYsNiArMTYsNyBAQCBz
ZWxmdGVzdCh0aW1lbGluZXMsIGk5MTVfdGltZWxpbmVfbGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVz
dChyZXF1ZXN0cywgaTkxNV9yZXF1ZXN0X2xpdmVfc2VsZnRlc3RzKQogc2VsZnRlc3QoYWN0aXZl
LCBpOTE1X2FjdGl2ZV9saXZlX3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KG9iamVjdHMsIGk5MTVfZ2Vt
X29iamVjdF9saXZlX3NlbGZ0ZXN0cykKK3NlbGZ0ZXN0KG1tYW4sIGk5MTVfZ2VtX21tYW5fbGl2
ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChkbWFidWYsIGk5MTVfZ2VtX2RtYWJ1Zl9saXZlX3NlbGZ0
ZXN0cykKIHNlbGZ0ZXN0KGNvaGVyZW5jeSwgaTkxNV9nZW1fY29oZXJlbmN5X2xpdmVfc2VsZnRl
c3RzKQogc2VsZnRlc3QoZ3R0LCBpOTE1X2dlbV9ndHRfbGl2ZV9zZWxmdGVzdHMpCi0tIAoyLjIw
LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVs
LWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

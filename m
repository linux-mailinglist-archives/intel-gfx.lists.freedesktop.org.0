Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id AC1B18A4D5
	for <lists+intel-gfx@lfdr.de>; Mon, 12 Aug 2019 19:48:13 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 216AF6E58F;
	Mon, 12 Aug 2019 17:48:12 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BC9316E58F
 for <intel-gfx@lists.freedesktop.org>; Mon, 12 Aug 2019 17:48:08 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17973032-1500050 
 for <intel-gfx@lists.freedesktop.org>; Mon, 12 Aug 2019 18:48:05 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 12 Aug 2019 18:48:04 +0100
Message-Id: <20190812174804.26180-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190812174804.26180-1-chris@chris-wilson.co.uk>
References: <20190812174804.26180-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 2/2] drm/i915/overlay: Switch to using i915_active
 tracking
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UmVtb3ZlIHRoZSByYXcgaTkxNV9hY3RpdmVfcmVxdWVzdCB0cmFja2luZyBpbiBmYXZvdXIgb2Yg
dGhlIGhpZ2hlcgpsZXZlbCBpOTE1X2FjdGl2ZSB0cmFja2luZyBmb3IgdGhlIHNvbGUgcHVycG9z
ZSBvZiBtYWtpbmcgdGhlIGxvY2tsZXNzCnRyYW5zaXRpb24gZWFzaWVyIGluIGxhdGVyIHBhdGNo
ZXMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51
az4KUmV2aWV3ZWQtYnk6IE1hdHRoZXcgQXVsZCA8bWF0dGhldy5hdWxkQGludGVsLmNvbT4KLS0t
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYyB8IDEyOSArKysr
KysrKystLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5oICAgICAg
ICAgICB8ICAxOSAtLS0KIDIgZmlsZXMgY2hhbmdlZCwgNjQgaW5zZXJ0aW9ucygrKSwgODQgZGVs
ZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9vdmVybGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXku
YwppbmRleCA0ZDNiMjA4NjU3MGUuLjRmNzg1ODZlZTA1ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMKQEAgLTE5MSw3ICsxOTEsOCBAQCBzdHJ1Y3Qg
aW50ZWxfb3ZlcmxheSB7CiAJc3RydWN0IG92ZXJsYXlfcmVnaXN0ZXJzIF9faW9tZW0gKnJlZ3M7
CiAJdTMyIGZsaXBfYWRkcjsKIAkvKiBmbGlwIGhhbmRsaW5nICovCi0Jc3RydWN0IGk5MTVfYWN0
aXZlX3JlcXVlc3QgbGFzdF9mbGlwOworCXN0cnVjdCBpOTE1X2FjdGl2ZSBsYXN0X2ZsaXA7CisJ
dm9pZCAoKmZsaXBfY29tcGxldGUpKHN0cnVjdCBpbnRlbF9vdmVybGF5ICpvdmwpOwogfTsKIAog
c3RhdGljIHZvaWQgaTgzMF9vdmVybGF5X2Nsb2NrX2dhdGluZyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYsCkBAIC0yMTcsMzAgKzIxOCwyNSBAQCBzdGF0aWMgdm9pZCBpODMwX292
ZXJsYXlfY2xvY2tfZ2F0aW5nKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJ
CQkgIFBDSV9ERVZGTigwLCAwKSwgSTgzMF9DTE9DS19HQVRFLCB2YWwpOwogfQogCi1zdGF0aWMg
dm9pZCBpbnRlbF9vdmVybGF5X3N1Ym1pdF9yZXF1ZXN0KHN0cnVjdCBpbnRlbF9vdmVybGF5ICpv
dmVybGF5LAotCQkJCQkgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCi0JCQkJCSBpOTE1X2FjdGl2
ZV9yZXRpcmVfZm4gcmV0aXJlKQorc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3QgKgorYWxsb2Nf
cmVxdWVzdChzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3ZlcmxheSwgdm9pZCAoKmZuKShzdHJ1Y3Qg
aW50ZWxfb3ZlcmxheSAqKSkKIHsKLQlHRU1fQlVHX09OKGk5MTVfYWN0aXZlX3JlcXVlc3RfcGVl
aygmb3ZlcmxheS0+bGFzdF9mbGlwLAotCQkJCQkgICAgJm92ZXJsYXktPmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpKTsKLQlpOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldF9yZXRpcmVfZm4oJm92ZXJsYXkt
Pmxhc3RfZmxpcCwgcmV0aXJlLAotCQkJCQkgICZvdmVybGF5LT5pOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKLQlfX2k5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KCZvdmVybGF5LT5sYXN0X2ZsaXAsIHJx
KTsKLQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKLX0KKwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsK
KwlpbnQgZXJyOwogCi1zdGF0aWMgaW50IGludGVsX292ZXJsYXlfZG9fd2FpdF9yZXF1ZXN0KHN0
cnVjdCBpbnRlbF9vdmVybGF5ICpvdmVybGF5LAotCQkJCQkgc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnEsCi0JCQkJCSBpOTE1X2FjdGl2ZV9yZXRpcmVfZm4gcmV0aXJlKQotewotCWludGVsX292ZXJs
YXlfc3VibWl0X3JlcXVlc3Qob3ZlcmxheSwgcnEsIHJldGlyZSk7Ci0JcmV0dXJuIGk5MTVfYWN0
aXZlX3JlcXVlc3RfcmV0aXJlKCZvdmVybGF5LT5sYXN0X2ZsaXAsCi0JCQkJCSAgJm92ZXJsYXkt
Pmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotfQorCW92ZXJsYXktPmZsaXBfY29tcGxldGUgPSBm
bjsKIAotc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3QgKmFsbG9jX3JlcXVlc3Qoc3RydWN0IGlu
dGVsX292ZXJsYXkgKm92ZXJsYXkpCi17Ci0JcmV0dXJuIGk5MTVfcmVxdWVzdF9jcmVhdGUob3Zl
cmxheS0+Y29udGV4dCk7CisJcnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKG92ZXJsYXktPmNvbnRl
eHQpOworCWlmIChJU19FUlIocnEpKQorCQlyZXR1cm4gcnE7CisKKwllcnIgPSBpOTE1X2FjdGl2
ZV9yZWYoJm92ZXJsYXktPmxhc3RfZmxpcCwgcnEtPmZlbmNlLmNvbnRleHQsIHJxKTsKKwlpZiAo
ZXJyKSB7CisJCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCQlyZXR1cm4gRVJSX1BUUihlcnIpOwor
CX0KKworCXJldHVybiBycTsKIH0KIAogLyogb3ZlcmxheSBuZWVkcyB0byBiZSBkaXNhYmxlIGlu
IE9DTUQgcmVnICovCkBAIC0yNTIsNyArMjQ4LDcgQEAgc3RhdGljIGludCBpbnRlbF9vdmVybGF5
X29uKHN0cnVjdCBpbnRlbF9vdmVybGF5ICpvdmVybGF5KQogCiAJV0FSTl9PTihvdmVybGF5LT5h
Y3RpdmUpOwogCi0JcnEgPSBhbGxvY19yZXF1ZXN0KG92ZXJsYXkpOworCXJxID0gYWxsb2NfcmVx
dWVzdChvdmVybGF5LCBOVUxMKTsKIAlpZiAoSVNfRVJSKHJxKSkKIAkJcmV0dXJuIFBUUl9FUlIo
cnEpOwogCkBAIC0yNzMsNyArMjY5LDkgQEAgc3RhdGljIGludCBpbnRlbF9vdmVybGF5X29uKHN0
cnVjdCBpbnRlbF9vdmVybGF5ICpvdmVybGF5KQogCSpjcysrID0gTUlfTk9PUDsKIAlpbnRlbF9y
aW5nX2FkdmFuY2UocnEsIGNzKTsKIAotCXJldHVybiBpbnRlbF9vdmVybGF5X2RvX3dhaXRfcmVx
dWVzdChvdmVybGF5LCBycSwgTlVMTCk7CisJaTkxNV9yZXF1ZXN0X2FkZChycSk7CisKKwlyZXR1
cm4gaTkxNV9hY3RpdmVfd2FpdCgmb3ZlcmxheS0+bGFzdF9mbGlwKTsKIH0KIAogc3RhdGljIHZv
aWQgaW50ZWxfb3ZlcmxheV9mbGlwX3ByZXBhcmUoc3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJs
YXksCkBAIC0zMTcsNyArMzE1LDcgQEAgc3RhdGljIGludCBpbnRlbF9vdmVybGF5X2NvbnRpbnVl
KHN0cnVjdCBpbnRlbF9vdmVybGF5ICpvdmVybGF5LAogCWlmICh0bXAgJiAoMSA8PCAxNykpCiAJ
CURSTV9ERUJVRygib3ZlcmxheSB1bmRlcnJ1biwgRE9WU1RBOiAleFxuIiwgdG1wKTsKIAotCXJx
ID0gYWxsb2NfcmVxdWVzdChvdmVybGF5KTsKKwlycSA9IGFsbG9jX3JlcXVlc3Qob3ZlcmxheSwg
TlVMTCk7CiAJaWYgKElTX0VSUihycSkpCiAJCXJldHVybiBQVFJfRVJSKHJxKTsKIApAQCAtMzMy
LDggKzMzMCw3IEBAIHN0YXRpYyBpbnQgaW50ZWxfb3ZlcmxheV9jb250aW51ZShzdHJ1Y3QgaW50
ZWxfb3ZlcmxheSAqb3ZlcmxheSwKIAlpbnRlbF9yaW5nX2FkdmFuY2UocnEsIGNzKTsKIAogCWlu
dGVsX292ZXJsYXlfZmxpcF9wcmVwYXJlKG92ZXJsYXksIHZtYSk7Ci0KLQlpbnRlbF9vdmVybGF5
X3N1Ym1pdF9yZXF1ZXN0KG92ZXJsYXksIHJxLCBOVUxMKTsKKwlpOTE1X3JlcXVlc3RfYWRkKHJx
KTsKIAogCXJldHVybiAwOwogfQpAQCAtMzU0LDIwICszNTEsMTMgQEAgc3RhdGljIHZvaWQgaW50
ZWxfb3ZlcmxheV9yZWxlYXNlX29sZF92bWEoc3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJsYXkp
CiB9CiAKIHN0YXRpYyB2b2lkCi1pbnRlbF9vdmVybGF5X3JlbGVhc2Vfb2xkX3ZpZF90YWlsKHN0
cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCi0JCQkJICAgc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnEpCitpbnRlbF9vdmVybGF5X3JlbGVhc2Vfb2xkX3ZpZF90YWlsKHN0cnVjdCBpbnRl
bF9vdmVybGF5ICpvdmVybGF5KQogewotCXN0cnVjdCBpbnRlbF9vdmVybGF5ICpvdmVybGF5ID0K
LQkJY29udGFpbmVyX29mKGFjdGl2ZSwgdHlwZW9mKCpvdmVybGF5KSwgbGFzdF9mbGlwKTsKLQog
CWludGVsX292ZXJsYXlfcmVsZWFzZV9vbGRfdm1hKG92ZXJsYXkpOwogfQogCi1zdGF0aWMgdm9p
ZCBpbnRlbF9vdmVybGF5X29mZl90YWlsKHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3Rp
dmUsCi0JCQkJICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCitzdGF0aWMgdm9pZCBpbnRlbF9v
dmVybGF5X29mZl90YWlsKHN0cnVjdCBpbnRlbF9vdmVybGF5ICpvdmVybGF5KQogewotCXN0cnVj
dCBpbnRlbF9vdmVybGF5ICpvdmVybGF5ID0KLQkJY29udGFpbmVyX29mKGFjdGl2ZSwgdHlwZW9m
KCpvdmVybGF5KSwgbGFzdF9mbGlwKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSBvdmVybGF5LT5pOTE1OwogCiAJaW50ZWxfb3ZlcmxheV9yZWxlYXNlX29sZF92bWEob3Zl
cmxheSk7CkBAIC0zODAsNiArMzcwLDE2IEBAIHN0YXRpYyB2b2lkIGludGVsX292ZXJsYXlfb2Zm
X3RhaWwoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSwKIAkJaTgzMF9vdmVybGF5
X2Nsb2NrX2dhdGluZyhkZXZfcHJpdiwgdHJ1ZSk7CiB9CiAKK3N0YXRpYyB2b2lkCitpbnRlbF9v
dmVybGF5X2xhc3RfZmxpcF9yZXRpcmUoc3RydWN0IGk5MTVfYWN0aXZlICphY3RpdmUpCit7CisJ
c3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJsYXkgPQorCQljb250YWluZXJfb2YoYWN0aXZlLCB0
eXBlb2YoKm92ZXJsYXkpLCBsYXN0X2ZsaXApOworCisJaWYgKG92ZXJsYXktPmZsaXBfY29tcGxl
dGUpCisJCW92ZXJsYXktPmZsaXBfY29tcGxldGUob3ZlcmxheSk7Cit9CisKIC8qIG92ZXJsYXkg
bmVlZHMgdG8gYmUgZGlzYWJsZWQgaW4gT0NNRCByZWcgKi8KIHN0YXRpYyBpbnQgaW50ZWxfb3Zl
cmxheV9vZmYoc3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJsYXkpCiB7CkBAIC0zOTQsNyArMzk0
LDcgQEAgc3RhdGljIGludCBpbnRlbF9vdmVybGF5X29mZihzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAq
b3ZlcmxheSkKIAkgKiBvZiB0aGUgaHcuIERvIGl0IGluIGJvdGggY2FzZXMgKi8KIAlmbGlwX2Fk
ZHIgfD0gT0ZDX1VQREFURTsKIAotCXJxID0gYWxsb2NfcmVxdWVzdChvdmVybGF5KTsKKwlycSA9
IGFsbG9jX3JlcXVlc3Qob3ZlcmxheSwgaW50ZWxfb3ZlcmxheV9vZmZfdGFpbCk7CiAJaWYgKElT
X0VSUihycSkpCiAJCXJldHVybiBQVFJfRVJSKHJxKTsKIApAQCAtNDE3LDE3ICs0MTcsMTYgQEAg
c3RhdGljIGludCBpbnRlbF9vdmVybGF5X29mZihzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3Zlcmxh
eSkKIAlpbnRlbF9yaW5nX2FkdmFuY2UocnEsIGNzKTsKIAogCWludGVsX292ZXJsYXlfZmxpcF9w
cmVwYXJlKG92ZXJsYXksIE5VTEwpOworCWk5MTVfcmVxdWVzdF9hZGQocnEpOwogCi0JcmV0dXJu
IGludGVsX292ZXJsYXlfZG9fd2FpdF9yZXF1ZXN0KG92ZXJsYXksIHJxLAotCQkJCQkgICAgIGlu
dGVsX292ZXJsYXlfb2ZmX3RhaWwpOworCXJldHVybiBpOTE1X2FjdGl2ZV93YWl0KCZvdmVybGF5
LT5sYXN0X2ZsaXApOwogfQogCiAvKiByZWNvdmVyIGZyb20gYW4gaW50ZXJydXB0aW9uIGR1ZSB0
byBhIHNpZ25hbAogICogV2UgaGF2ZSB0byBiZSBjYXJlZnVsIG5vdCB0byByZXBlYXQgd29yayBm
b3JldmVyIGFuIG1ha2UgZm9yd2FyZCBwcm9nZXNzLiAqLwogc3RhdGljIGludCBpbnRlbF9vdmVy
bGF5X3JlY292ZXJfZnJvbV9pbnRlcnJ1cHQoc3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJsYXkp
CiB7Ci0JcmV0dXJuIGk5MTVfYWN0aXZlX3JlcXVlc3RfcmV0aXJlKCZvdmVybGF5LT5sYXN0X2Zs
aXAsCi0JCQkJCSAgJm92ZXJsYXktPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCXJldHVybiBp
OTE1X2FjdGl2ZV93YWl0KCZvdmVybGF5LT5sYXN0X2ZsaXApOwogfQogCiAvKiBXYWl0IGZvciBw
ZW5kaW5nIG92ZXJsYXkgZmxpcCBhbmQgcmVsZWFzZSBvbGQgZnJhbWUuCkBAIC00MzcsNDMgKzQz
Niw0MCBAQCBzdGF0aWMgaW50IGludGVsX292ZXJsYXlfcmVjb3Zlcl9mcm9tX2ludGVycnVwdChz
dHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3ZlcmxheSkKIHN0YXRpYyBpbnQgaW50ZWxfb3ZlcmxheV9y
ZWxlYXNlX29sZF92aWQoc3RydWN0IGludGVsX292ZXJsYXkgKm92ZXJsYXkpCiB7CiAJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gb3ZlcmxheS0+aTkxNTsKKwlzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpycTsKIAl1MzIgKmNzOwotCWludCByZXQ7CiAKIAlsb2NrZGVwX2Fzc2VydF9o
ZWxkKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKLQkvKiBPbmx5IHdhaXQgaWYgdGhl
cmUgaXMgYWN0dWFsbHkgYW4gb2xkIGZyYW1lIHRvIHJlbGVhc2UgdG8KKwkvKgorCSAqIE9ubHkg
d2FpdCBpZiB0aGVyZSBpcyBhY3R1YWxseSBhbiBvbGQgZnJhbWUgdG8gcmVsZWFzZSB0bwogCSAq
IGd1YXJhbnRlZSBmb3J3YXJkIHByb2dyZXNzLgogCSAqLwogCWlmICghb3ZlcmxheS0+b2xkX3Zt
YSkKIAkJcmV0dXJuIDA7CiAKLQlpZiAoSTkxNV9SRUFEKEdFTjJfSVNSKSAmIEk5MTVfT1ZFUkxB
WV9QTEFORV9GTElQX1BFTkRJTkdfSU5URVJSVVBUKSB7Ci0JCS8qIHN5bmNocm9ub3VzIHNsb3dw
YXRoICovCi0JCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCWlmICghKEk5MTVfUkVBRChHRU4y
X0lTUikgJiBJOTE1X09WRVJMQVlfUExBTkVfRkxJUF9QRU5ESU5HX0lOVEVSUlVQVCkpIHsKKwkJ
aW50ZWxfb3ZlcmxheV9yZWxlYXNlX29sZF92aWRfdGFpbChvdmVybGF5KTsKKwkJcmV0dXJuIDA7
CisJfQogCi0JCXJxID0gYWxsb2NfcmVxdWVzdChvdmVybGF5KTsKLQkJaWYgKElTX0VSUihycSkp
Ci0JCQlyZXR1cm4gUFRSX0VSUihycSk7CisJcnEgPSBhbGxvY19yZXF1ZXN0KG92ZXJsYXksIGlu
dGVsX292ZXJsYXlfcmVsZWFzZV9vbGRfdmlkX3RhaWwpOworCWlmIChJU19FUlIocnEpKQorCQly
ZXR1cm4gUFRSX0VSUihycSk7CiAKLQkJY3MgPSBpbnRlbF9yaW5nX2JlZ2luKHJxLCAyKTsKLQkJ
aWYgKElTX0VSUihjcykpIHsKLQkJCWk5MTVfcmVxdWVzdF9hZGQocnEpOwotCQkJcmV0dXJuIFBU
Ul9FUlIoY3MpOwotCQl9CisJY3MgPSBpbnRlbF9yaW5nX2JlZ2luKHJxLCAyKTsKKwlpZiAoSVNf
RVJSKGNzKSkgeworCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKwkJcmV0dXJuIFBUUl9FUlIoY3Mp
OworCX0KIAotCQkqY3MrKyA9IE1JX1dBSVRfRk9SX0VWRU5UIHwgTUlfV0FJVF9GT1JfT1ZFUkxB
WV9GTElQOwotCQkqY3MrKyA9IE1JX05PT1A7Ci0JCWludGVsX3JpbmdfYWR2YW5jZShycSwgY3Mp
OworCSpjcysrID0gTUlfV0FJVF9GT1JfRVZFTlQgfCBNSV9XQUlUX0ZPUl9PVkVSTEFZX0ZMSVA7
CisJKmNzKysgPSBNSV9OT09QOworCWludGVsX3JpbmdfYWR2YW5jZShycSwgY3MpOwogCi0JCXJl
dCA9IGludGVsX292ZXJsYXlfZG9fd2FpdF9yZXF1ZXN0KG92ZXJsYXksIHJxLAotCQkJCQkJICAg
IGludGVsX292ZXJsYXlfcmVsZWFzZV9vbGRfdmlkX3RhaWwpOwotCQlpZiAocmV0KQotCQkJcmV0
dXJuIHJldDsKLQl9IGVsc2UKLQkJaW50ZWxfb3ZlcmxheV9yZWxlYXNlX29sZF92aWRfdGFpbCgm
b3ZlcmxheS0+bGFzdF9mbGlwLCBOVUxMKTsKKwlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKIAotCXJl
dHVybiAwOworCXJldHVybiBpOTE1X2FjdGl2ZV93YWl0KCZvdmVybGF5LT5sYXN0X2ZsaXApOwog
fQogCiB2b2lkIGludGVsX292ZXJsYXlfcmVzZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQpAQCAtMTM3NSw3ICsxMzcxLDkgQEAgdm9pZCBpbnRlbF9vdmVybGF5X3NldHVwKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlvdmVybGF5LT5jb250cmFzdCA9IDc1
OwogCW92ZXJsYXktPnNhdHVyYXRpb24gPSAxNDY7CiAKLQlJTklUX0FDVElWRV9SRVFVRVNUKCZv
dmVybGF5LT5sYXN0X2ZsaXApOworCWk5MTVfYWN0aXZlX2luaXQoZGV2X3ByaXYsCisJCQkgJm92
ZXJsYXktPmxhc3RfZmxpcCwKKwkJCSBOVUxMLCBpbnRlbF9vdmVybGF5X2xhc3RfZmxpcF9yZXRp
cmUpOwogCiAJcmV0ID0gZ2V0X3JlZ2lzdGVycyhvdmVybGF5LCBPVkVSTEFZX05FRURTX1BIWVNJ
Q0FMKGRldl9wcml2KSk7CiAJaWYgKHJldCkKQEAgLTE0MDksNiArMTQwNyw3IEBAIHZvaWQgaW50
ZWxfb3ZlcmxheV9jbGVhbnVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlX
QVJOX09OKG92ZXJsYXktPmFjdGl2ZSk7CiAKIAlpOTE1X2dlbV9vYmplY3RfcHV0KG92ZXJsYXkt
PnJlZ19ibyk7CisJaTkxNV9hY3RpdmVfZmluaSgmb3ZlcmxheS0+bGFzdF9mbGlwKTsKIAogCWtm
cmVlKG92ZXJsYXkpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9h
Y3RpdmUuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmgKaW5kZXggNTY2MzM2
Yzk5ZWQ3Li5mNmQ3MzBjZjJmZTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfYWN0aXZlLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaApAQCAt
ODksMjUgKzg5LDYgQEAgaW50IF9fbXVzdF9jaGVjawogaTkxNV9hY3RpdmVfcmVxdWVzdF9zZXQo
c3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSwKIAkJCXN0cnVjdCBpOTE1X3JlcXVl
c3QgKnJxKTsKIAotLyoqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldF9yZXRpcmVfZm4gLSB1
cGRhdGVzIHRoZSByZXRpcmVtZW50IGNhbGxiYWNrCi0gKiBAYWN0aXZlIC0gdGhlIGFjdGl2ZSB0
cmFja2VyCi0gKiBAZm4gLSB0aGUgcm91dGluZSBjYWxsZWQgd2hlbiB0aGUgcmVxdWVzdCBpcyBy
ZXRpcmVkCi0gKiBAbXV0ZXggLSBzdHJ1Y3RfbXV0ZXggdXNlZCB0byBndWFyZCByZXRpcmVtZW50
cwotICoKLSAqIGk5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0X3JldGlyZV9mbigpIHVwZGF0ZXMgdGhl
IGZ1bmN0aW9uIHBvaW50ZXIgdGhhdAotICogaXMgY2FsbGVkIHdoZW4gdGhlIGZpbmFsIHJlcXVl
c3QgYXNzb2NpYXRlZCB3aXRoIHRoZSBAYWN0aXZlIHRyYWNrZXIKLSAqIGlzIHJldGlyZWQuCi0g
Ki8KLXN0YXRpYyBpbmxpbmUgdm9pZAotaTkxNV9hY3RpdmVfcmVxdWVzdF9zZXRfcmV0aXJlX2Zu
KHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCi0JCQkJICBpOTE1X2FjdGl2ZV9y
ZXRpcmVfZm4gZm4sCi0JCQkJICBzdHJ1Y3QgbXV0ZXggKm11dGV4KQotewotCWxvY2tkZXBfYXNz
ZXJ0X2hlbGQobXV0ZXgpOwotCWFjdGl2ZS0+cmV0aXJlID0gZm4gPzogaTkxNV9hY3RpdmVfcmV0
aXJlX25vb3A7Ci19Ci0KIC8qKgogICogaTkxNV9hY3RpdmVfcmVxdWVzdF9yYXcgLSByZXR1cm4g
dGhlIGFjdGl2ZSByZXF1ZXN0CiAgKiBAYWN0aXZlIC0gdGhlIGFjdGl2ZSB0cmFja2VyCi0tIAoy
LjIzLjAucmMxCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
XwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcK
aHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

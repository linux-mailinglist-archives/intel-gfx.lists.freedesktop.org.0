Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 4BAD92DFBAF
	for <lists+intel-gfx@lfdr.de>; Mon, 21 Dec 2020 12:59:15 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 355D56E484;
	Mon, 21 Dec 2020 11:59:12 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (unknown [77.68.26.236])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B27166E484;
 Mon, 21 Dec 2020 11:59:09 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 23390712-1500050 
 for multiple; Mon, 21 Dec 2020 11:58:56 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 21 Dec 2020 11:58:55 +0000
Message-Id: <20201221115855.2451913-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.29.2
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t] i915/gem_exec_fair: Try to spot unfairness
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org, Chris Wilson <chris@chris-wilson.co.uk>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QW4gaW1wb3J0YW50IHByb3BlcnR5IGZvciBtdWx0aS1jbGllbnQgc3lzdGVtcyBpcyB0aGF0IGVh
Y2ggY2xpZW50IGdldHMKYSAnZmFpcicgYWxsb3RtZW50IG9mIHN5c3RlbSB0aW1lLiAoV2hlcmUg
ZmFpcm5lc3MgaXMgYXQgdGhlIHdoaW0gb2YgdGhlCmNvbnRleHQgcHJvcGVydGllcywgc3VjaCBh
cyBwcmlvcml0aWVzLikgVGhpcyB0ZXN0IGZvcmtzIE4gaW5kZXBlbmRlbnQKY2xpZW50cyAoYWxi
ZWl0IHRoZXkgaGFwcGVuIHRvIHNoYXJlIGEgc2luZ2xlIHZtKSwgYW5kIGRvZXMgYW4gZXF1YWwK
YW1vdW50IG9mIHdvcmsgaW4gY2xpZW50IGFuZCBhc3NlcnRzIHRoYXQgdGhleSB0YWtlIGFuIGVx
dWFsIGFtb3VudCBvZgp0aW1lLgoKVGhvdWdoIHdlIGhhdmUgbmV2ZXIgY2xhaW1lZCB0byBoYXZl
IGEgY29tcGxldGVseSBmYWlyIHNjaGVkdWxlciwgdGhhdAppcyB3aGF0IGlzIGV4cGVjdGVkLgoK
djI6IGlndF9hc3NlcnRfZiBhbmQgbW9yZSBjb21tZW50YXJ5OyBleGNsdWRlIHZpcCBmcm9tIGNs
aWVudCBzdGF0cywKaW5jbHVkZSByYW5nZSBvZiBmcmFtZSBpbnRlcnZhbHMgZnJvbSBlYWNoIGlu
ZGl2aWR1YWwgY2xpZW50CnYzOiBXcml0ZSBkb3duIHdoYXQgdGhlIHRlc3QgYWN0dWFsbHkgZG9l
cyEKdjQ6IFNwbGl0IG91dCB0byBnZW1fZXhlY19mYWlyIHNvIHRoYXQgd2UgY2FuIGFwcGx5IENJ
IGZpbHRlcmluZyB0bwpyZWR1Y2UgdGhlIHRlc3Qgc2V0CgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBX
aWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IFR2cnRrbyBVcnN1bGluIDx0dnJ0
a28udXJzdWxpbkBpbnRlbC5jb20+CkNjOiBSYW1hbGluZ2FtIEMgPHJhbWFsaW5nYW0uY0BpbnRl
bC5jb20+Ci0tLQogdGVzdHMvTWFrZWZpbGUuc291cmNlcyAgICAgICB8ICAgMyArCiB0ZXN0cy9p
OTE1L2dlbV9leGVjX2ZhaXIuYyAgIHwgOTE0ICsrKysrKysrKysrKysrKysrKysrKysrKysrKysr
KysrKysrCiB0ZXN0cy9pbnRlbC1jaS9ibGFja2xpc3QudHh0IHwgICAxICsKIHRlc3RzL21lc29u
LmJ1aWxkICAgICAgICAgICAgfCAgIDEgKwogNCBmaWxlcyBjaGFuZ2VkLCA5MTkgaW5zZXJ0aW9u
cygrKQogY3JlYXRlIG1vZGUgMTAwNjQ0IHRlc3RzL2k5MTUvZ2VtX2V4ZWNfZmFpci5jCgpkaWZm
IC0tZ2l0IGEvdGVzdHMvTWFrZWZpbGUuc291cmNlcyBiL3Rlc3RzL01ha2VmaWxlLnNvdXJjZXMK
aW5kZXggZDljOGY2MTA0Li5kYjJiZTZhMTcgMTAwNjQ0Ci0tLSBhL3Rlc3RzL01ha2VmaWxlLnNv
dXJjZXMKKysrIGIvdGVzdHMvTWFrZWZpbGUuc291cmNlcwpAQCAtMjc1LDYgKzI3NSw5IEBAIGdl
bV9leGVjX3JlbG9jX1NPVVJDRVMgPSBpOTE1L2dlbV9leGVjX3JlbG9jLmMKIFRFU1RTX3Byb2dz
ICs9IGdlbV9leGVjX3NjaGVkdWxlCiBnZW1fZXhlY19zY2hlZHVsZV9TT1VSQ0VTID0gaTkxNS9n
ZW1fZXhlY19zY2hlZHVsZS5jCiAKK1RFU1RTX3Byb2dzICs9IGdlbV9leGVjX2ZhaXIKK2dlbV9l
eGVjX2ZhaXJfU09VUkNFUyA9IGk5MTUvZ2VtX2V4ZWNfZmFpci5jCisKIFRFU1RTX3Byb2dzICs9
IGdlbV9leGVjX3N0b3JlCiBnZW1fZXhlY19zdG9yZV9TT1VSQ0VTID0gaTkxNS9nZW1fZXhlY19z
dG9yZS5jCiAKZGlmZiAtLWdpdCBhL3Rlc3RzL2k5MTUvZ2VtX2V4ZWNfZmFpci5jIGIvdGVzdHMv
aTkxNS9nZW1fZXhlY19mYWlyLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAw
Li43NmJmMGY0NjEKLS0tIC9kZXYvbnVsbAorKysgYi90ZXN0cy9pOTE1L2dlbV9leGVjX2ZhaXIu
YwpAQCAtMCwwICsxLDkxNCBAQAorLyogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVCAqLwor
LyoKKyAqIENvcHlyaWdodCDCqSAyMDE2IEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2luY2x1
ZGUgImNvbmZpZy5oIgorCisjaW5jbHVkZSA8cHRocmVhZC5oPgorI2luY2x1ZGUgPHN5cy9wb2xs
Lmg+CisjaW5jbHVkZSA8c3lzL2lvY3RsLmg+CisjaW5jbHVkZSA8c3lzL21tYW4uaD4KKyNpbmNs
dWRlIDxzeXMvcmVzb3VyY2UuaD4KKyNpbmNsdWRlIDxzeXMvc3lzY2FsbC5oPgorI2luY2x1ZGUg
PHNjaGVkLmg+CisjaW5jbHVkZSA8c2lnbmFsLmg+CisjaW5jbHVkZSA8dW5pc3RkLmg+CisKKyNp
bmNsdWRlICJpOTE1L2dlbS5oIgorI2luY2x1ZGUgImk5MTUvZ2VtX3JpbmcuaCIKKyNpbmNsdWRl
ICJpZ3QuaCIKKyNpbmNsdWRlICJpZ3RfcmFuZC5oIgorI2luY2x1ZGUgImlndF9yYXBsLmgiCisj
aW5jbHVkZSAiaWd0X3N5c2ZzLmgiCisjaW5jbHVkZSAiaWd0X3ZnZW0uaCIKKyNpbmNsdWRlICJz
d19zeW5jLmgiCisKK0lHVF9URVNUX0RFU0NSSVBUSU9OKCJDaGVjayB0aGF0IEdQVSB0aW1lIGFu
ZCBleGVjdXRpb24gb3JkZXIgaXMgZmFpcmx5IGRpc3RyaWJ1dGVkIGFjcm9zcyBjbGllbnRzIik7
CisKK3N0YXRpYyB1bnNpZ25lZCBpbnQgb2Zmc2V0X2luX3BhZ2Uodm9pZCAqYWRkcikKK3sKKwly
ZXR1cm4gKHVpbnRwdHJfdClhZGRyICYgNDA5NTsKK30KKworc3RhdGljIHVpbnQzMl90IF9fYmF0
Y2hfY3JlYXRlKGludCBpOTE1LCB1aW50MzJfdCBvZmZzZXQpCit7CisJY29uc3QgdWludDMyX3Qg
YmJlID0gTUlfQkFUQ0hfQlVGRkVSX0VORDsKKwl1aW50MzJfdCBoYW5kbGU7CisKKwloYW5kbGUg
PSBnZW1fY3JlYXRlKGk5MTUsIEFMSUdOKG9mZnNldCArIDQsIDQwOTYpKTsKKwlnZW1fd3JpdGUo
aTkxNSwgaGFuZGxlLCBvZmZzZXQsICZiYmUsIHNpemVvZihiYmUpKTsKKworCXJldHVybiBoYW5k
bGU7Cit9CisKK3N0YXRpYyB1aW50MzJfdCBiYXRjaF9jcmVhdGUoaW50IGk5MTUpCit7CisJcmV0
dXJuIF9fYmF0Y2hfY3JlYXRlKGk5MTUsIDApOworfQorCitzdGF0aWMgaW50IHJlYWRfdGltZXN0
YW1wX2ZyZXF1ZW5jeShpbnQgaTkxNSkKK3sKKwlpbnQgdmFsdWUgPSAwOworCWRybV9pOTE1X2dl
dHBhcmFtX3QgZ3AgPSB7CisJCS52YWx1ZSA9ICZ2YWx1ZSwKKwkJLnBhcmFtID0gSTkxNV9QQVJB
TV9DU19USU1FU1RBTVBfRlJFUVVFTkNZLAorCX07CisJaW9jdGwoaTkxNSwgRFJNX0lPQ1RMX0k5
MTVfR0VUUEFSQU0sICZncCk7CisJcmV0dXJuIHZhbHVlOworfQorCitzdGF0aWMgdWludDY0X3Qg
ZGl2NjRfdTY0X3JvdW5kX3VwKHVpbnQ2NF90IHgsIHVpbnQ2NF90IHkpCit7CisJcmV0dXJuICh4
ICsgeSAtIDEpIC8geTsKK30KKworc3RhdGljIHVpbnQ2NF90IG5zX3RvX2N0eF90aWNrcyhpbnQg
aTkxNSwgdWludDY0X3QgbnMpCit7CisJaW50IGYgPSByZWFkX3RpbWVzdGFtcF9mcmVxdWVuY3ko
aTkxNSk7CisJaWYgKGludGVsX2dlbihpbnRlbF9nZXRfZHJtX2RldmlkKGk5MTUpKSA9PSAxMSkK
KwkJZiA9IDEyNTAwMDAwOyAvKiBpY2whISEgYXJlIHlvdSBmZWVsaW5nIGFscmlnaHQ/IENUWCB2
cyBDUyAqLworCXJldHVybiBkaXY2NF91NjRfcm91bmRfdXAobnMgKiBmLCBOU0VDX1BFUl9TRUMp
OworfQorCitzdGF0aWMgdWludDY0X3QgdGlja3NfdG9fbnMoaW50IGk5MTUsIHVpbnQ2NF90IHRp
Y2tzKQoreworCXJldHVybiBkaXY2NF91NjRfcm91bmRfdXAodGlja3MgKiBOU0VDX1BFUl9TRUMs
CisJCQkJICByZWFkX3RpbWVzdGFtcF9mcmVxdWVuY3koaTkxNSkpOworfQorCisjZGVmaW5lIE1J
X0lOU1RSKG9wY29kZSwgZmxhZ3MpICgoKG9wY29kZSkgPDwgMjMpIHwgKGZsYWdzKSkKKworI2Rl
ZmluZSBNSV9NQVRIKHgpICAgICAgICAgICAgICAgICAgICAgIE1JX0lOU1RSKDB4MWEsICh4KSAt
IDEpCisjZGVmaW5lIE1JX01BVEhfSU5TVFIob3Bjb2RlLCBvcDEsIG9wMikgKChvcGNvZGUpIDw8
IDIwIHwgKG9wMSkgPDwgMTAgfCAob3AyKSkKKy8qIE9wY29kZXMgZm9yIE1JX01BVEhfSU5TVFIg
Ki8KKyNkZWZpbmUgICBNSV9NQVRIX05PT1AgICAgICAgICAgICAgICAgICBNSV9NQVRIX0lOU1RS
KDB4MDAwLCAweDAsIDB4MCkKKyNkZWZpbmUgICBNSV9NQVRIX0xPQUQob3AxLCBvcDIpICAgICAg
ICBNSV9NQVRIX0lOU1RSKDB4MDgwLCBvcDEsIG9wMikKKyNkZWZpbmUgICBNSV9NQVRIX0xPQURJ
TlYob3AxLCBvcDIpICAgICBNSV9NQVRIX0lOU1RSKDB4NDgwLCBvcDEsIG9wMikKKyNkZWZpbmUg
ICBNSV9NQVRIX0xPQUQwKG9wMSkgICAgICAgICAgICBNSV9NQVRIX0lOU1RSKDB4MDgxLCBvcDEp
CisjZGVmaW5lICAgTUlfTUFUSF9MT0FEMShvcDEpICAgICAgICAgICAgTUlfTUFUSF9JTlNUUigw
eDQ4MSwgb3AxKQorI2RlZmluZSAgIE1JX01BVEhfQUREICAgICAgICAgICAgICAgICAgIE1JX01B
VEhfSU5TVFIoMHgxMDAsIDB4MCwgMHgwKQorI2RlZmluZSAgIE1JX01BVEhfU1VCICAgICAgICAg
ICAgICAgICAgIE1JX01BVEhfSU5TVFIoMHgxMDEsIDB4MCwgMHgwKQorI2RlZmluZSAgIE1JX01B
VEhfQU5EICAgICAgICAgICAgICAgICAgIE1JX01BVEhfSU5TVFIoMHgxMDIsIDB4MCwgMHgwKQor
I2RlZmluZSAgIE1JX01BVEhfT1IgICAgICAgICAgICAgICAgICAgIE1JX01BVEhfSU5TVFIoMHgx
MDMsIDB4MCwgMHgwKQorI2RlZmluZSAgIE1JX01BVEhfWE9SICAgICAgICAgICAgICAgICAgIE1J
X01BVEhfSU5TVFIoMHgxMDQsIDB4MCwgMHgwKQorI2RlZmluZSAgIE1JX01BVEhfU1RPUkUob3Ax
LCBvcDIpICAgICAgIE1JX01BVEhfSU5TVFIoMHgxODAsIG9wMSwgb3AyKQorI2RlZmluZSAgIE1J
X01BVEhfU1RPUkVJTlYob3AxLCBvcDIpICAgIE1JX01BVEhfSU5TVFIoMHg1ODAsIG9wMSwgb3Ay
KQorLyogUmVnaXN0ZXJzIHVzZWQgYXMgb3BlcmFuZHMgaW4gTUlfTUFUSF9JTlNUUiAqLworI2Rl
ZmluZSAgIE1JX01BVEhfUkVHKHgpICAgICAgICAgICAgICAgICh4KQorI2RlZmluZSAgIE1JX01B
VEhfUkVHX1NSQ0EgICAgICAgICAgICAgIDB4MjAKKyNkZWZpbmUgICBNSV9NQVRIX1JFR19TUkNC
ICAgICAgICAgICAgICAweDIxCisjZGVmaW5lICAgTUlfTUFUSF9SRUdfQUNDVSAgICAgICAgICAg
ICAgMHgzMQorI2RlZmluZSAgIE1JX01BVEhfUkVHX1pGICAgICAgICAgICAgICAgIDB4MzIKKyNk
ZWZpbmUgICBNSV9NQVRIX1JFR19DRiAgICAgICAgICAgICAgICAweDMzCisKKyNkZWZpbmUgTUlf
TE9BRF9SRUdJU1RFUl9SRUcgICAgTUlfSU5TVFIoMHgyQSwgMSkKKworc3RhdGljIHZvaWQgZGVs
YXkoaW50IGk5MTUsCisJCSAgY29uc3Qgc3RydWN0IGludGVsX2V4ZWN1dGlvbl9lbmdpbmUyICpl
LAorCQkgIHVpbnQzMl90IGhhbmRsZSwKKwkJICB1aW50NjRfdCBhZGRyLAorCQkgIHVpbnQ2NF90
IG5zKQoreworCWNvbnN0IGludCB1c2VfNjRiID0gaW50ZWxfZ2VuKGludGVsX2dldF9kcm1fZGV2
aWQoaTkxNSkpID49IDg7CisJY29uc3QgdWludDMyX3QgYmFzZSA9IGdlbV9lbmdpbmVfbW1pb19i
YXNlKGk5MTUsIGUtPm5hbWUpOworI2RlZmluZSBDU19HUFIoeCkgKGJhc2UgKyAweDYwMCArIDgg
KiAoeCkpCisjZGVmaW5lIFJVTlRJTUUgKGJhc2UgKyAweDNhOCkKKwllbnVtIHsgU1RBUlRfVFMs
IE5PV19UUyB9OworCXVpbnQzMl90ICptYXAsICpjcywgKmptcDsKKworCWlndF9yZXF1aXJlKGJh
c2UpOworCisJLyogTG9vcCB1bnRpbCBDVFhfVElNRVNUQU1QIC0gaW5pdGlhbCA+IEBucyAqLwor
CisJY3MgPSBtYXAgPSBnZW1fbW1hcF9fZGV2aWNlX2NvaGVyZW50KGk5MTUsIGhhbmRsZSwgMCwg
NDA5NiwgUFJPVF9XUklURSk7CisKKwkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJfSU1NOworCSpj
cysrID0gQ1NfR1BSKFNUQVJUX1RTKSArIDQ7CisJKmNzKysgPSAwOworCSpjcysrID0gTUlfTE9B
RF9SRUdJU1RFUl9SRUc7CisJKmNzKysgPSBSVU5USU1FOworCSpjcysrID0gQ1NfR1BSKFNUQVJU
X1RTKTsKKworCXdoaWxlIChvZmZzZXRfaW5fcGFnZShjcykgJiA2MykKKwkJKmNzKysgPSAwOwor
CWptcCA9IGNzOworCisJKmNzKysgPSAweDUgPDwgMjM7IC8qIE1JX0FSQl9DSEVDSyAqLworCisJ
KmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX0lNTTsKKwkqY3MrKyA9IENTX0dQUihOT1dfVFMpICsg
NDsKKwkqY3MrKyA9IDA7CisJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX1JFRzsKKwkqY3MrKyA9
IFJVTlRJTUU7CisJKmNzKysgPSBDU19HUFIoTk9XX1RTKTsKKworCS8qIGRlbHRhID0gbm93IC0g
c3RhcnQ7IGludmVydGVkIHRvIG1hdGNoIENPTkRfQkJFICovCisJKmNzKysgPSBNSV9NQVRIKDQp
OworCSpjcysrID0gTUlfTUFUSF9MT0FEKE1JX01BVEhfUkVHX1NSQ0EsIE1JX01BVEhfUkVHKE5P
V19UUykpOworCSpjcysrID0gTUlfTUFUSF9MT0FEKE1JX01BVEhfUkVHX1NSQ0IsIE1JX01BVEhf
UkVHKFNUQVJUX1RTKSk7CisJKmNzKysgPSBNSV9NQVRIX1NVQjsKKwkqY3MrKyA9IE1JX01BVEhf
U1RPUkVJTlYoTUlfTUFUSF9SRUcoTk9XX1RTKSwgTUlfTUFUSF9SRUdfQUNDVSk7CisKKwkvKiBT
YXZlIGRlbHRhIGZvciByZWFkaW5nIGJ5IENPTkRfQkJFICovCisJKmNzKysgPSAweDI0IDw8IDIz
IHwgKDEgKyB1c2VfNjRiKTsgLyogU1JNICovCisJKmNzKysgPSBDU19HUFIoTk9XX1RTKTsKKwkq
Y3MrKyA9IGFkZHIgKyA0MDAwOworCSpjcysrID0gYWRkciA+PiAzMjsKKworCS8qIERlbGF5IGJl
dHdlZW4gU1JNIGFuZCBDT05EX0JCRSB0byBwb3N0IHRoZSB3cml0ZXMgKi8KKwlmb3IgKGludCBu
ID0gMDsgbiA8IDg7IG4rKykgeworCQkqY3MrKyA9IE1JX1NUT1JFX0RXT1JEX0lNTTsKKwkJaWYg
KHVzZV82NGIpIHsKKwkJCSpjcysrID0gYWRkciArIDQwNjQ7CisJCQkqY3MrKyA9IGFkZHIgPj4g
MzI7CisJCX0gZWxzZSB7CisJCQkqY3MrKyA9IDA7CisJCQkqY3MrKyA9IGFkZHIgKyA0MDY0Owor
CQl9CisJCSpjcysrID0gMDsKKwl9CisKKwkvKiBCcmVhayBpZiBkZWx0YSBbdGltZSBlbGFwc2Vk
XSA+IG5zICovCisJKmNzKysgPSBNSV9DT05EX0JBVENIX0JVRkZFUl9FTkQgfCBNSV9ET19DT01Q
QVJFIHwgKDEgKyB1c2VfNjRiKTsKKwkqY3MrKyA9IH5uc190b19jdHhfdGlja3MoaTkxNSwgbnMp
OworCSpjcysrID0gYWRkciArIDQwMDA7CisJKmNzKysgPSBhZGRyID4+IDMyOworCisJLyogT3Ro
ZXJ3aXNlIGJhY2sgdG8gcmVjYWxjdWxhdGluZyBkZWx0YSAqLworCSpjcysrID0gTUlfQkFUQ0hf
QlVGRkVSX1NUQVJUIHwgMSA8PCA4IHwgdXNlXzY0YjsKKwkqY3MrKyA9IGFkZHIgKyBvZmZzZXRf
aW5fcGFnZShqbXApOworCSpjcysrID0gYWRkciA+PiAzMjsKKworCW11bm1hcChtYXAsIDQwOTYp
OworfQorCitzdGF0aWMgc3RydWN0IGRybV9pOTE1X2dlbV9leGVjX29iamVjdDIKK2RlbGF5X2Ny
ZWF0ZShpbnQgaTkxNSwgdWludDMyX3QgY3R4LAorCSAgICAgY29uc3Qgc3RydWN0IGludGVsX2V4
ZWN1dGlvbl9lbmdpbmUyICplLAorCSAgICAgdWludDY0X3QgdGFyZ2V0X25zKQoreworCXN0cnVj
dCBkcm1faTkxNV9nZW1fZXhlY19vYmplY3QyIG9iaiA9IHsKKwkJLmhhbmRsZSA9IGJhdGNoX2Ny
ZWF0ZShpOTE1KSwKKwkJLmZsYWdzID0gRVhFQ19PQkpFQ1RfU1VQUE9SVFNfNDhCX0FERFJFU1Ms
CisJfTsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyIGV4ZWNidWYgPSB7CisJCS5i
dWZmZXJzX3B0ciA9IHRvX3VzZXJfcG9pbnRlcigmb2JqKSwKKwkJLmJ1ZmZlcl9jb3VudCA9IDEs
CisJCS5yc3ZkMSA9IGN0eCwKKwkJLmZsYWdzID0gZS0+ZmxhZ3MsCisJfTsKKworCW9iai5vZmZz
ZXQgPSBvYmouaGFuZGxlIDw8IDEyOworCWdlbV9leGVjYnVmKGk5MTUsICZleGVjYnVmKTsKKwln
ZW1fc3luYyhpOTE1LCBvYmouaGFuZGxlKTsKKworCWRlbGF5KGk5MTUsIGUsIG9iai5oYW5kbGUs
IG9iai5vZmZzZXQsIHRhcmdldF9ucyk7CisKKwlvYmouZmxhZ3MgfD0gRVhFQ19PQkpFQ1RfUElO
TkVEOworCXJldHVybiBvYmo7Cit9CisKK3N0YXRpYyB2b2lkIHRzbG9nKGludCBpOTE1LAorCQkg
IGNvbnN0IHN0cnVjdCBpbnRlbF9leGVjdXRpb25fZW5naW5lMiAqZSwKKwkJICB1aW50MzJfdCBo
YW5kbGUsCisJCSAgdWludDY0X3QgYWRkcikKK3sKKwljb25zdCBpbnQgdXNlXzY0YiA9IGludGVs
X2dlbihpbnRlbF9nZXRfZHJtX2RldmlkKGk5MTUpKSA+PSA4OworCWNvbnN0IHVpbnQzMl90IGJh
c2UgPSBnZW1fZW5naW5lX21taW9fYmFzZShpOTE1LCBlLT5uYW1lKTsKKyNkZWZpbmUgQ1NfR1BS
KHgpIChiYXNlICsgMHg2MDAgKyA4ICogKHgpKQorI2RlZmluZSBDU19USU1FU1RBTVAgKGJhc2Ug
KyAweDM1OCkKKwllbnVtIHsgSU5DLCBNQVNLLCBBRERSIH07CisJdWludDMyX3QgKnRpbWVzdGFt
cF9sbywgKmFkZHJfbG87CisJdWludDMyX3QgKm1hcCwgKmNzOworCisJaWd0X3JlcXVpcmUoYmFz
ZSk7CisKKwltYXAgPSBnZW1fbW1hcF9fZGV2aWNlX2NvaGVyZW50KGk5MTUsIGhhbmRsZSwgMCwg
NDA5NiwgUFJPVF9XUklURSk7CisJY3MgPSBtYXAgKyA1MTI7CisKKwkvKiBSZWNvcmQgdGhlIGN1
cnJlbnQgQ1NfVElNRVNUQU1QIGludG8gYSBqb3VybmFsIFthIDUxMiBzbG90IHJpbmddLiAqLwor
CSpjcysrID0gMHgyNCA8PCAyMyB8ICgxICsgdXNlXzY0Yik7IC8qIFNSTSAqLworCSpjcysrID0g
Q1NfVElNRVNUQU1QOworCXRpbWVzdGFtcF9sbyA9IGNzOworCSpjcysrID0gYWRkcjsKKwkqY3Mr
KyA9IGFkZHIgPj4gMzI7CisKKwkvKiBMb2FkIHRoZSBhZGRyZXNzICsgaW5jICYgbWFzayB2YXJp
YWJsZXMgKi8KKwkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJfSU1NOworCSpjcysrID0gQ1NfR1BS
KEFERFIpOworCWFkZHJfbG8gPSBjczsKKwkqY3MrKyA9IGFkZHI7CisJKmNzKysgPSBNSV9MT0FE
X1JFR0lTVEVSX0lNTTsKKwkqY3MrKyA9IENTX0dQUihBRERSKSArIDQ7CisJKmNzKysgPSBhZGRy
ID4+IDMyOworCisJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX0lNTTsKKwkqY3MrKyA9IENTX0dQ
UihJTkMpOworCSpjcysrID0gNDsKKwkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJfSU1NOworCSpj
cysrID0gQ1NfR1BSKElOQykgKyA0OworCSpjcysrID0gMDsKKworCSpjcysrID0gTUlfTE9BRF9S
RUdJU1RFUl9JTU07CisJKmNzKysgPSBDU19HUFIoTUFTSyk7CisJKmNzKysgPSAweGZmZmZmN2Zm
OworCSpjcysrID0gTUlfTE9BRF9SRUdJU1RFUl9JTU07CisJKmNzKysgPSBDU19HUFIoTUFTSykg
KyA0OworCSpjcysrID0gMHhmZmZmZmZmZjsKKworCS8qIEluY3JlbWVudCB0aGUgW3JpbmddIGFk
ZHJlc3MgZm9yIHNhdmluZyBDU19USU1FU1RBTVAgKi8KKwkqY3MrKyA9IE1JX01BVEgoOCk7CisJ
KmNzKysgPSBNSV9NQVRIX0xPQUQoTUlfTUFUSF9SRUdfU1JDQSwgTUlfTUFUSF9SRUcoSU5DKSk7
CisJKmNzKysgPSBNSV9NQVRIX0xPQUQoTUlfTUFUSF9SRUdfU1JDQiwgTUlfTUFUSF9SRUcoQURE
UikpOworCSpjcysrID0gTUlfTUFUSF9BREQ7CisJKmNzKysgPSBNSV9NQVRIX1NUT1JFKE1JX01B
VEhfUkVHKEFERFIpLCBNSV9NQVRIX1JFR19BQ0NVKTsKKwkqY3MrKyA9IE1JX01BVEhfTE9BRChN
SV9NQVRIX1JFR19TUkNBLCBNSV9NQVRIX1JFRyhBRERSKSk7CisJKmNzKysgPSBNSV9NQVRIX0xP
QUQoTUlfTUFUSF9SRUdfU1JDQiwgTUlfTUFUSF9SRUcoTUFTSykpOworCSpjcysrID0gTUlfTUFU
SF9BTkQ7CisJKmNzKysgPSBNSV9NQVRIX1NUT1JFKE1JX01BVEhfUkVHKEFERFIpLCBNSV9NQVRI
X1JFR19BQ0NVKTsKKworCS8qIFJld3JpdGUgdGhlIGJhdGNoIGJ1ZmZlciBmb3IgdGhlIG5leHQg
ZXhlY3V0aW9uICovCisJKmNzKysgPSAweDI0IDw8IDIzIHwgKDEgKyB1c2VfNjRiKTsgLyogU1JN
ICovCisJKmNzKysgPSBDU19HUFIoQUREUik7CisJKmNzKysgPSBhZGRyICsgb2Zmc2V0X2luX3Bh
Z2UodGltZXN0YW1wX2xvKTsKKwkqY3MrKyA9IGFkZHIgPj4gMzI7CisJKmNzKysgPSAweDI0IDw8
IDIzIHwgKDEgKyB1c2VfNjRiKTsgLyogU1JNICovCisJKmNzKysgPSBDU19HUFIoQUREUik7CisJ
KmNzKysgPSBhZGRyICsgb2Zmc2V0X2luX3BhZ2UoYWRkcl9sbyk7CisJKmNzKysgPSBhZGRyID4+
IDMyOworCisJKmNzKysgPSBNSV9CQVRDSF9CVUZGRVJfRU5EOworCisJbXVubWFwKG1hcCwgNDA5
Nik7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNfb2JqZWN0MgordHNsb2df
Y3JlYXRlKGludCBpOTE1LCB1aW50MzJfdCBjdHgsIGNvbnN0IHN0cnVjdCBpbnRlbF9leGVjdXRp
b25fZW5naW5lMiAqZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNfb2JqZWN0MiBvYmog
PSB7CisJCS5oYW5kbGUgPSBiYXRjaF9jcmVhdGUoaTkxNSksCisJCS5mbGFncyA9IEVYRUNfT0JK
RUNUX1NVUFBPUlRTXzQ4Ql9BRERSRVNTLAorCX07CisJc3RydWN0IGRybV9pOTE1X2dlbV9leGVj
YnVmZmVyMiBleGVjYnVmID0geworCQkuYnVmZmVyc19wdHIgPSB0b191c2VyX3BvaW50ZXIoJm9i
aiksCisJCS5idWZmZXJfY291bnQgPSAxLAorCQkucnN2ZDEgPSBjdHgsCisJCS5mbGFncyA9IGUt
PmZsYWdzLAorCX07CisKKwlvYmoub2Zmc2V0ID0gb2JqLmhhbmRsZSA8PCAxMjsKKwlnZW1fZXhl
Y2J1ZihpOTE1LCAmZXhlY2J1Zik7CisJZ2VtX3N5bmMoaTkxNSwgb2JqLmhhbmRsZSk7CisKKwl0
c2xvZyhpOTE1LCBlLCBvYmouaGFuZGxlLCBvYmoub2Zmc2V0KTsKKworCW9iai5mbGFncyB8PSBF
WEVDX09CSkVDVF9QSU5ORUQ7CisJcmV0dXJuIG9iajsKK30KKworc3RhdGljIGludCBjbXBfdTMy
KGNvbnN0IHZvaWQgKkEsIGNvbnN0IHZvaWQgKkIpCit7CisJY29uc3QgdWludDMyX3QgKmEgPSBB
LCAqYiA9IEI7CisKKwlpZiAoKmEgPCAqYikKKwkJcmV0dXJuIC0xOworCWVsc2UgaWYgKCphID4g
KmIpCisJCXJldHVybiAxOworCWVsc2UKKwkJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBib29sIGhh
c19jdHhfdGltZXN0YW1wKGludCBpOTE1LCBjb25zdCBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2Vu
Z2luZTIgKmUpCit7CisJY29uc3QgaW50IGdlbiA9IGludGVsX2dlbihpbnRlbF9nZXRfZHJtX2Rl
dmlkKGk5MTUpKTsKKworCWlmIChnZW4gPT0gOCAmJiBlLT5jbGFzcyA9PSBJOTE1X0VOR0lORV9D
TEFTU19WSURFTykKKwkJcmV0dXJuIGZhbHNlOyAvKiBsb29rcyBmdWJhciAqLworCisJcmV0dXJu
IHRydWU7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2VuZ2luZTIKK3BpY2tf
cmFuZG9tX2VuZ2luZShpbnQgaTkxNSwgY29uc3Qgc3RydWN0IGludGVsX2V4ZWN1dGlvbl9lbmdp
bmUyICpub3QpCit7CisJY29uc3Qgc3RydWN0IGludGVsX2V4ZWN1dGlvbl9lbmdpbmUyICplOwor
CXVuc2lnbmVkIGludCBjb3VudCA9IDA7CisKKwlfX2Zvcl9lYWNoX3BoeXNpY2FsX2VuZ2luZShp
OTE1LCBlKSB7CisJCWlmIChlLT5mbGFncyA9PSBub3QtPmZsYWdzKQorCQkJY29udGludWU7CisJ
CWlmICghZ2VtX2NsYXNzX2hhc19tdXRhYmxlX3N1Ym1pc3Npb24oaTkxNSwgZS0+Y2xhc3MpKQor
CQkJY29udGludWU7CisJCWNvdW50Kys7CisJfQorCWlmICghY291bnQpCisJCXJldHVybiAqbm90
OworCisJY291bnQgPSByYW5kKCkgJSBjb3VudDsKKwlfX2Zvcl9lYWNoX3BoeXNpY2FsX2VuZ2lu
ZShpOTE1LCBlKSB7CisJCWlmIChlLT5mbGFncyA9PSBub3QtPmZsYWdzKQorCQkJY29udGludWU7
CisJCWlmICghZ2VtX2NsYXNzX2hhc19tdXRhYmxlX3N1Ym1pc3Npb24oaTkxNSwgZS0+Y2xhc3Mp
KQorCQkJY29udGludWU7CisJCWlmICghY291bnQtLSkKKwkJCWJyZWFrOworCX0KKworCXJldHVy
biAqZTsKK30KKworc3RhdGljIHZvaWQgZmFpcl9jaGlsZChpbnQgaTkxNSwgdWludDMyX3QgY3R4
LAorCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX2V4ZWN1dGlvbl9lbmdpbmUyICplLAorCQkg
ICAgICAgdWludDY0X3QgZnJhbWVfbnMsCisJCSAgICAgICBpbnQgdGltZWxpbmUsCisJCSAgICAg
ICB1aW50MzJfdCBjb21tb24sCisJCSAgICAgICB1bnNpZ25lZCBpbnQgZmxhZ3MsCisJCSAgICAg
ICB1bnNpZ25lZCBsb25nICpjdGwsCisJCSAgICAgICB1bnNpZ25lZCBsb25nICptZWRpYW4sCisJ
CSAgICAgICB1bnNpZ25lZCBsb25nICppcXIpCisjZGVmaW5lIEZfU1lOQwkJKDEgPDwgMCkKKyNk
ZWZpbmUgRl9QQUNFCQkoMSA8PCAxKQorI2RlZmluZSBGX0ZMT1cJCSgxIDw8IDIpCisjZGVmaW5l
IEZfSEFMRgkJKDEgPDwgMykKKyNkZWZpbmUgRl9TT0xPCQkoMSA8PCA0KQorI2RlZmluZSBGX1NQ
QVJFCQkoMSA8PCA1KQorI2RlZmluZSBGX05FWFQJCSgxIDw8IDYpCisjZGVmaW5lIEZfVklQCQko
MSA8PCA3KQorI2RlZmluZSBGX1JSVUwJCSgxIDw8IDgpCisjZGVmaW5lIEZfU0hBUkUJCSgxIDw8
IDkpCisjZGVmaW5lIEZfUElORwkJKDEgPDwgMTApCisjZGVmaW5lIEZfVEhST1RUTEUJKDEgPDwg
MTEpCisjZGVmaW5lIEZfSVNPTEFURQkoMSA8PCAxMikKK3sKKwljb25zdCBpbnQgYmF0Y2hlc19w
ZXJfZnJhbWUgPSBmbGFncyAmIEZfU09MTyA/IDEgOiAzOworCXN0cnVjdCBkcm1faTkxNV9nZW1f
ZXhlY19vYmplY3QyIG9ials0XSA9IHsKKwkJe30sCisJCXsKKwkJCS5oYW5kbGUgPSBjb21tb24g
PzogZ2VtX2NyZWF0ZShpOTE1LCA0MDk2KSwKKwkJfSwKKwkJZGVsYXlfY3JlYXRlKGk5MTUsIGN0
eCwgZSwgZnJhbWVfbnMgLyBiYXRjaGVzX3Blcl9mcmFtZSksCisJCWRlbGF5X2NyZWF0ZShpOTE1
LCBjdHgsIGUsIGZyYW1lX25zIC8gYmF0Y2hlc19wZXJfZnJhbWUpLAorCX07CisJc3RydWN0IGlu
dGVsX2V4ZWN1dGlvbl9lbmdpbmUyIHBpbmcgPSAqZTsKKwlpbnQgcF9mZW5jZSA9IC0xLCBuX2Zl
bmNlID0gLTE7CisJdW5zaWduZWQgbG9uZyBjb3VudCA9IDA7CisJaW50IG47CisKKwlzcmFuZG9t
KGdldHBpZCgpKTsKKwlpZiAoZmxhZ3MgJiBGX1BJTkcpCisJCXBpbmcgPSBwaWNrX3JhbmRvbV9l
bmdpbmUoaTkxNSwgZSk7CisJb2JqWzBdID0gdHNsb2dfY3JlYXRlKGk5MTUsIGN0eCwgJnBpbmcp
OworCisJd2hpbGUgKCFSRUFEX09OQ0UoKmN0bCkpIHsKKwkJc3RydWN0IGRybV9pOTE1X2dlbV9l
eGVjYnVmZmVyMiBleGVjYnVmID0geworCQkJLmJ1ZmZlcnNfcHRyID0gdG9fdXNlcl9wb2ludGVy
KG9iaiksCisJCQkuYnVmZmVyX2NvdW50ID0gMywKKwkJCS5yc3ZkMSA9IGN0eCwKKwkJCS5yc3Zk
MiA9IC0xLAorCQkJLmZsYWdzID0gZS0+ZmxhZ3MsCisJCX07CisKKwkJaWYgKGZsYWdzICYgRl9G
TE9XKSB7CisJCQl1bnNpZ25lZCBpbnQgc2VxOworCisJCQlzZXEgPSBjb3VudDsKKwkJCWlmIChm
bGFncyAmIEZfTkVYVCkKKwkJCQlzZXErKzsKKworCQkJZXhlY2J1Zi5yc3ZkMiA9CisJCQkJc3df
c3luY190aW1lbGluZV9jcmVhdGVfZmVuY2UodGltZWxpbmUsIHNlcSk7CisJCQlleGVjYnVmLmZs
YWdzIHw9IEk5MTVfRVhFQ19GRU5DRV9JTjsKKwkJfQorCisJCWV4ZWNidWYuZmxhZ3MgfD0gSTkx
NV9FWEVDX0ZFTkNFX09VVDsKKwkJZ2VtX2V4ZWNidWZfd3IoaTkxNSwgJmV4ZWNidWYpOworCQlu
X2ZlbmNlID0gZXhlY2J1Zi5yc3ZkMiA+PiAzMjsKKwkJZXhlY2J1Zi5mbGFncyAmPSB+KEk5MTVf
RVhFQ19GRU5DRV9PVVQgfCBJOTE1X0VYRUNfRkVOQ0VfSU4pOworCQlmb3IgKG4gPSAxOyBuIDwg
YmF0Y2hlc19wZXJfZnJhbWU7IG4rKykKKwkJCWdlbV9leGVjYnVmKGk5MTUsICZleGVjYnVmKTsK
KwkJY2xvc2UoZXhlY2J1Zi5yc3ZkMik7CisKKwkJZXhlY2J1Zi5idWZmZXJfY291bnQgPSAxOwor
CQlleGVjYnVmLmJhdGNoX3N0YXJ0X29mZnNldCA9IDIwNDg7CisJCWV4ZWNidWYuZmxhZ3MgPSBw
aW5nLmZsYWdzIHwgSTkxNV9FWEVDX0ZFTkNFX0lOOworCQlleGVjYnVmLnJzdmQyID0gbl9mZW5j
ZTsKKwkJZ2VtX2V4ZWNidWYoaTkxNSwgJmV4ZWNidWYpOworCisJCWlmIChmbGFncyAmIEZfUEFD
RSAmJiBwX2ZlbmNlICE9IC0xKSB7CisJCQlzdHJ1Y3QgcG9sbGZkIHBmZCA9IHsKKwkJCQkuZmQg
PSBwX2ZlbmNlLAorCQkJCS5ldmVudHMgPSBQT0xMSU4sCisJCQl9OworCQkJcG9sbCgmcGZkLCAx
LCAtMSk7CisJCX0KKwkJY2xvc2UocF9mZW5jZSk7CisKKwkJaWYgKGZsYWdzICYgRl9TWU5DKSB7
CisJCQlzdHJ1Y3QgcG9sbGZkIHBmZCA9IHsKKwkJCQkuZmQgPSBuX2ZlbmNlLAorCQkJCS5ldmVu
dHMgPSBQT0xMSU4sCisJCQl9OworCQkJcG9sbCgmcGZkLCAxLCAtMSk7CisJCX0KKworCQlpZiAo
ZmxhZ3MgJiBGX1RIUk9UVExFKQorCQkJaWd0X2lvY3RsKGk5MTUsIERSTV9JT0NUTF9JOTE1X0dF
TV9USFJPVFRMRSwgMCk7CisKKwkJaWd0X3N3YXAob2JqWzJdLCBvYmpbM10pOworCQlpZ3Rfc3dh
cChwX2ZlbmNlLCBuX2ZlbmNlKTsKKwkJY291bnQrKzsKKwl9CisJY2xvc2UocF9mZW5jZSk7CisK
KwlnZW1fY2xvc2UoaTkxNSwgb2JqWzNdLmhhbmRsZSk7CisJZ2VtX2Nsb3NlKGk5MTUsIG9ialsy
XS5oYW5kbGUpOworCWlmIChvYmpbMV0uaGFuZGxlICE9IGNvbW1vbikKKwkJZ2VtX2Nsb3NlKGk5
MTUsIG9ialsxXS5oYW5kbGUpOworCisJZ2VtX3N5bmMoaTkxNSwgb2JqWzBdLmhhbmRsZSk7CisJ
aWYgKG1lZGlhbikgeworCQl1aW50MzJfdCAqbWFwOworCisJCS8qCisJCSAqIFdlIHJlY29yZGVk
IHRoZSBDU19USU1FU1RBTVAgb2YgZWFjaCBmcmFtZSwgYW5kIGlmCisJCSAqIHRoZSBHUFUgaXMg
YmVpbmcgc2hhcmVkIGNvbXBsZXRlbHkgZmFpcmx5LCB3ZSBleHBlY3QKKwkJICogZWFjaCBmcmFt
ZSB0byBiZSBhdCB0aGUgc2FtZSBpbnRlcnZhbCBmcm9tIHRoZSBsYXN0LgorCQkgKgorCQkgKiBD
b21wdXRlIHRoZSBpbnRlcnZhbCBiZXR3ZWVuIGZyYW1lcyBhbmQgcmVwb3J0IGJhY2sKKwkJICog
Ym90aCB0aGUgbWVkaWFuIGludGVydmFsIGFuZCB0aGUgcmFuZ2UgZm9yIHRoaXMgY2xpZW50Lgor
CQkgKi8KKworCQltYXAgPSBnZW1fbW1hcF9fZGV2aWNlX2NvaGVyZW50KGk5MTUsIG9ialswXS5o
YW5kbGUsCisJCQkJCQkwLCA0MDk2LCBQUk9UX1dSSVRFKTsKKwkJZm9yIChuID0gMTsgbiA8IG1p
bihjb3VudCwgNTEyKTsgbisrKSB7CisJCQlpZ3RfYXNzZXJ0KG1hcFtuXSk7CisJCQltYXBbbiAt
IDFdID0gbWFwW25dIC0gbWFwW24gLSAxXTsKKwkJfQorCQlxc29ydChtYXAsIC0tbiwgc2l6ZW9m
KCptYXApLCBjbXBfdTMyKTsKKwkJKmlxciA9IHRpY2tzX3RvX25zKGk5MTUsIG1hcFsoMyAqIG4g
KyAzKSAvIDRdIC0gbWFwW24gLyA0XSk7CisJCSptZWRpYW4gPSB0aWNrc190b19ucyhpOTE1LCBt
YXBbbiAvIDJdKTsKKwkJbXVubWFwKG1hcCwgNDA5Nik7CisJfQorCWdlbV9jbG9zZShpOTE1LCBv
YmpbMF0uaGFuZGxlKTsKK30KKworc3RhdGljIGludCBjbXBfdWwoY29uc3Qgdm9pZCAqQSwgY29u
c3Qgdm9pZCAqQikKK3sKKwljb25zdCB1bnNpZ25lZCBsb25nICphID0gQSwgKmIgPSBCOworCisJ
aWYgKCphIDwgKmIpCisJCXJldHVybiAtMTsKKwllbHNlIGlmICgqYSA+ICpiKQorCQlyZXR1cm4g
MTsKKwllbHNlCisJCXJldHVybiAwOworfQorCitzdGF0aWMgdWludDY0X3QgZF9jcHVfdGltZShj
b25zdCBzdHJ1Y3QgcnVzYWdlICphLCBjb25zdCBzdHJ1Y3QgcnVzYWdlICpiKQoreworCXVpbnQ2
NF90IGNwdV90aW1lID0gMDsKKworCWNwdV90aW1lICs9IChhLT5ydV91dGltZS50dl9zZWMgLSBi
LT5ydV91dGltZS50dl9zZWMpICogTlNFQ19QRVJfU0VDOworCWNwdV90aW1lICs9IChhLT5ydV91
dGltZS50dl91c2VjIC0gYi0+cnVfdXRpbWUudHZfdXNlYykgKiAxMDAwOworCisJY3B1X3RpbWUg
Kz0gKGEtPnJ1X3N0aW1lLnR2X3NlYyAtIGItPnJ1X3N0aW1lLnR2X3NlYykgKiBOU0VDX1BFUl9T
RUM7CisJY3B1X3RpbWUgKz0gKGEtPnJ1X3N0aW1lLnR2X3VzZWMgLSBiLT5ydV9zdGltZS50dl91
c2VjKSAqIDEwMDA7CisKKwlyZXR1cm4gY3B1X3RpbWU7Cit9CisKK3N0YXRpYyB2b2lkIHRpbWVs
aW5lX2FkdmFuY2UoaW50IHRpbWVsaW5lLCBpbnQgZGVsYXlfbnMpCit7CisJc3RydWN0IHRpbWVz
cGVjIHR2ID0geyAudHZfbnNlYyA9IGRlbGF5X25zIH07CisJbmFub3NsZWVwKCZ0diwgTlVMTCk7
CisJc3dfc3luY190aW1lbGluZV9pbmModGltZWxpbmUsIDEpOworfQorCitzdGF0aWMgdm9pZCBm
YWlybmVzcyhpbnQgaTkxNSwKKwkJICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2Vu
Z2luZTIgKmUsCisJCSAgICAgaW50IHRpbWVvdXQsIHVuc2lnbmVkIGludCBmbGFncykKK3sKKwlj
b25zdCBpbnQgZnJhbWVfbnMgPSAxNjY2NiAqIDEwMDA7CisJY29uc3QgaW50IGZlbmNlX25zID0g
ZmxhZ3MgJiBGX0hBTEYgPyAyICogZnJhbWVfbnMgOiBmcmFtZV9uczsKKwl1bnNpZ25lZCBsb25n
ICpyZXN1bHQsICppcXI7CisJdWludDMyX3QgY29tbW9uID0gMDsKKworCWlndF9yZXF1aXJlKGhh
c19jdHhfdGltZXN0YW1wKGk5MTUsIGUpKTsKKwlpZ3RfcmVxdWlyZShnZW1fY2xhc3NfaGFzX211
dGFibGVfc3VibWlzc2lvbihpOTE1LCBlLT5jbGFzcykpOworCisJaWYgKGZsYWdzICYgRl9TSEFS
RSkKKwkJY29tbW9uID0gZ2VtX2NyZWF0ZShpOTE1LCA0MDk1KTsKKworCXJlc3VsdCA9IG1tYXAo
TlVMTCwgNDA5NiwgUFJPVF9XUklURSwgTUFQX1NIQVJFRCB8IE1BUF9BTk9OLCAtMSwgMCk7CisJ
aWd0X2Fzc2VydChyZXN1bHQgIT0gTUFQX0ZBSUxFRCk7CisJaXFyID0gbW1hcChOVUxMLCA0MDk2
LCBQUk9UX1dSSVRFLCBNQVBfU0hBUkVEIHwgTUFQX0FOT04sIC0xLCAwKTsKKwlpZ3RfYXNzZXJ0
KGlxciAhPSBNQVBfRkFJTEVEKTsKKworCS8qCisJICogVGhlIGNvbWJpbmVkIHdvcmtsb2FkIGFs
d2F5cyBydW5zIGF0IGEgNjBmcHMgdGFyZ2V0ICh1bmxlc3MgRl9IQUxGISkuCisJICogVGhpcyBn
aXZlcyBhIGZyYW1lIG9mIGludGVydmFsIG9mIDE2bXMgdGhhdCBpcyBldmVubHkgc3BsaXQgYWNy
b3NzCisJICogYWxsIHRoZSBjbGllbnRzLCBzbyBzaW11bGF0aW5nIGEgc3lzdGVtIHdpdGggYSBi
dW5jaCBvZiBjbGllbnRzIHRoYXQKKwkgKiBhcmUgcGVyZmVjdGx5IGJhbGFuY2VkIGFuZCBjYW4g
c3VzdGFpbiA2MGZwcy4gT3VyIGpvYiBpcyB0byBlbnN1cmUKKwkgKiB0aGF0IGVhY2ggY2xpZW50
IGRvZXMgcnVuIGF0IGEgc21vb3RoIDYwZnBzLgorCSAqCisJICogRWFjaCBjbGllbnQgcnVucyBh
IGZpeGVkIGxlbmd0aCBkZWxheSBsb29wIChhcyBhIHNpbmdsZSByZXF1ZXN0LAorCSAqIG9yIHNw
bGl0IGludG8gMykgYW5kIHRoZW4gcmVjb3JkcyB0aGUgQ1NfVElNRVNUQU1QIGFmdGVyIGNvbXBs
ZXRpbmcKKwkgKiBpdHMgZGVsYXkuIEdpdmVuIGEgZmFpciBhbGxvdG1lbnQgb2YgR1BVIHRpbWUg
dG8gZWFjaCBjbGllbnQsCisJICogdGhhdCB0aW1lc3RhbXAgd2lsbCBbaWRlYWxseV0gYmUgYXQg
YSBwcmVjaXNlIDE2bXMgaW50ZXJ2YWxzLgorCSAqIEluIHByYWN0aWNlLCB0aW1lIGlzIHdhc3Rl
ZCBvbiBjb250ZXh0IHN3aXRjaGVzLCBzbyBhcyB0aGUgbnVtYmVyCisJICogb2YgY2xpZW50cyBp
bmNyZWFzZXMsIHRoZSBwcm9wcm90aW9uIG9mIHRpbWUgc3BlbnQgb24gY29udGV4dAorCSAqIHN3
aXRjaGVzIGdyb3dzLiBBcyB3ZSBnZXQgdG8gNjQgcmVuZGVyIGNsaWVudHMsIHdlIHdpbGwgYmUg
c3BlbmRpbmcKKwkgKiBhcyBtdWNoIHRpbWUgaW4gY29udGV4dCBzd2l0Y2hlcyBhcyBleGVjdXRp
bmcgdGhlIGNsaWVudCB3b3JrbG9hZHMuCisJICoKKwkgKiBFYWNoIGNsaWVudCBmcmFtZSBtYXkg
YmUgcGFjZWQgYnkgc29tZSB0aHJvdHRsaW5nIHRlY2huaXF1ZSBmb3VuZAorCSAqIGluIHRoZSB3
aWxkLiBpLmUuIGVhY2ggY2xpZW50IG1heSB3YWl0IHVudGlsIGEgc2ltdWxhdGVkIHZibGFuawor
CSAqIHRvIGluZGljYXRlIHRoZSBzdGFydCBvZiBhIG5ldyBmcmFtZSwgb3IgaXQgbWF5IHdhaXQg
dW50aWwgdGhlCisJICogY29tcGxldGlvbiBvZiBhIHByZXZpb3VzIGZyYW1lLiBUaGlzIGNhdXNl
cyBzdWJtaXNzaW9uIGZyb20gZWFjaAorCSAqIGNsaWVudCBhbmQgYWNyb3NzIHRoZSBzeXN0ZW0g
dG8gYmUgY2h1bmt5IGFuZCB1bmV2ZW4uCisJICoKKwkgKiBXZSBsb29rIGF0IHRoZSB2YXJpYXRp
b24gb2YgZnJhbWUgaW50ZXJ2YWxzIHdpdGhpbiBlYWNoIGNsaWVudCwgYW5kCisJICogdGhlIHZh
cmlhdGlvbiBvZiB0aGUgbWVkaWFucyBhY3Jvc3MgdGhlIGNsaWVudHMgdG8gc2VlIGlmIHRoZQor
CSAqIGRpc3RyaWJ1dGlvbiAoYnVkZ2V0KSBvZiBHUFUgdGltZSB3YXMgZmFpciBlbm91Z2guCisJ
ICoKKwkgKiBBbHRlcm5hdGl2ZSAoYW5kIGltcG9ydGFudCkgbWV0cmljcyB3aWxsIGJlIG1vcmUg
bGF0ZW5jeSBjZW50cmljOworCSAqIGxvb2tpbmcgYXQgaG93IHdlbGwgd2UgY2FuIHN1c3RhaW4g
bWVldGluZyBkZWFkbGluZSBnaXZlbiBjb21wZXRpdGlvbgorCSAqIGJ5IGNsaWVudHMgZm9yIHRo
ZSBHUFUuCisJICovCisKKwlmb3IgKGludCBuID0gMjsgbiA8PSAyNTY7IG4gPDw9IDEpIHsgLyog
MzIgPT0gNTAwdXMgcGVyIGNsaWVudCAqLworCQlpbnQgdGltZWxpbmUgPSBzd19zeW5jX3RpbWVs
aW5lX2NyZWF0ZSgpOworCQlpbnQgbmZlbmNlcyA9IHRpbWVvdXQgKiBOU0VDX1BFUl9TRUMgLyBm
ZW5jZV9ucyArIDE7CisJCWludCBuY2hpbGQgPSBuIC0gMTsgLyogb2RkIGZvciBlYXN5IG1lZGlh
bnMgKi8KKwkJY29uc3QgaW50IGNoaWxkX25zID0gZnJhbWVfbnMgLyAobmNoaWxkICsgISEoZmxh
Z3MgJiBGX1NQQVJFKSk7CisJCWNvbnN0IGludCBsbyA9IG5jaGlsZCAvIDQ7CisJCWNvbnN0IGlu
dCBoaSA9ICgzICogbmNoaWxkICsgMykgLyA0IC0gMTsKKwkJc3RydWN0IHJ1c2FnZSBvbGRfdXNh
Z2UsIHVzYWdlOworCQl1aW50NjRfdCBjcHVfdGltZSwgZF90aW1lOworCQlzdHJ1Y3QgdGltZXNw
ZWMgdHY7CisJCXN0cnVjdCBpZ3RfbWVhbiBtOworCisJCW1lbXNldChyZXN1bHQsIDAsIChuY2hp
bGQgKyAxKSAqIHNpemVvZihyZXN1bHRbMF0pKTsKKworCQlpZiAoZmxhZ3MgJiBGX1BJTkcpIHsg
LyogZmlsbCB0aGUgb3RoZXJzIHdpdGggbGlnaHQgYmcgbG9hZCAqLworCQkJc3RydWN0IGludGVs
X2V4ZWN1dGlvbl9lbmdpbmUyICpwaW5nOworCisJCQlfX2Zvcl9lYWNoX3BoeXNpY2FsX2VuZ2lu
ZShpOTE1LCBwaW5nKSB7CisJCQkJaWYgKHBpbmctPmZsYWdzID09IGUtPmZsYWdzKQorCQkJCQlj
b250aW51ZTsKKworCQkJCWlndF9mb3JrKGNoaWxkLCAxKSB7CisJCQkJCXVpbnQzMl90IGN0eCA9
IGdlbV9jb250ZXh0X2Nsb25lX3dpdGhfZW5naW5lcyhpOTE1LCAwKTsKKworCQkJCQlmYWlyX2No
aWxkKGk5MTUsIGN0eCwgcGluZywKKwkJCQkJCSAgIGNoaWxkX25zIC8gOCwKKwkJCQkJCSAgIC0x
LCBjb21tb24sCisJCQkJCQkgICBGX1NPTE8gfCBGX1BBQ0UgfCBGX1NIQVJFLAorCQkJCQkJICAg
JnJlc3VsdFtuY2hpbGRdLAorCQkJCQkJICAgTlVMTCwgTlVMTCk7CisKKwkJCQkJZ2VtX2NvbnRl
eHRfZGVzdHJveShpOTE1LCBjdHgpOworCQkJCX0KKwkJCX0KKwkJfQorCisJCWdldHJ1c2FnZShS
VVNBR0VfQ0hJTERSRU4sICZvbGRfdXNhZ2UpOworCQlpZ3RfbnNlY19lbGFwc2VkKG1lbXNldCgm
dHYsIDAsIHNpemVvZih0dikpKTsKKwkJaWd0X2ZvcmsoY2hpbGQsIG5jaGlsZCkgeworCQkJdWlu
dDMyX3QgY3R4OworCisJCQlpZiAoZmxhZ3MgJiBGX0lTT0xBVEUpIHsKKwkJCQlpbnQgY2xvbmUs
IGRtYWJ1ZiA9IC0xOworCisJCQkJaWYgKGNvbW1vbikKKwkJCQkJZG1hYnVmID0gcHJpbWVfaGFu
ZGxlX3RvX2ZkKGk5MTUsIGNvbW1vbik7CisKKwkJCQljbG9uZSA9IGdlbV9yZW9wZW5fZHJpdmVy
KGk5MTUpOworCQkJCWdlbV9jb250ZXh0X2NvcHlfZW5naW5lcyhpOTE1LCAwLCBjbG9uZSwgMCk7
CisJCQkJaTkxNSA9IGNsb25lOworCisJCQkJaWYgKGRtYWJ1ZiAhPSAtMSkKKwkJCQkJY29tbW9u
ID0gcHJpbWVfZmRfdG9faGFuZGxlKGk5MTUsIGRtYWJ1Zik7CisJCQl9CisKKwkJCWN0eCA9IGdl
bV9jb250ZXh0X2Nsb25lX3dpdGhfZW5naW5lcyhpOTE1LCAwKTsKKworCQkJaWYgKGZsYWdzICYg
Rl9WSVAgJiYgY2hpbGQgPT0gMCkgeworCQkJCWdlbV9jb250ZXh0X3NldF9wcmlvcml0eShpOTE1
LCBjdHgsIDEwMjMpOworCQkJCWZsYWdzIHw9IEZfRkxPVzsKKwkJCX0KKwkJCWlmIChmbGFncyAm
IEZfUlJVTCAmJiBjaGlsZCA9PSAwKQorCQkJCWZsYWdzIHw9IEZfU09MTyB8IEZfRkxPVyB8IEZf
U1lOQzsKKworCQkJZmFpcl9jaGlsZChpOTE1LCBjdHgsIGUsIGNoaWxkX25zLAorCQkJCSAgIHRp
bWVsaW5lLCBjb21tb24sIGZsYWdzLAorCQkJCSAgICZyZXN1bHRbbmNoaWxkXSwKKwkJCQkgICAm
cmVzdWx0W2NoaWxkXSwgJmlxcltjaGlsZF0pOworCisJCQlnZW1fY29udGV4dF9kZXN0cm95KGk5
MTUsIGN0eCk7CisJCX0KKworCQl3aGlsZSAobmZlbmNlcy0tKQorCQkJdGltZWxpbmVfYWR2YW5j
ZSh0aW1lbGluZSwgZmVuY2VfbnMpOworCisJCXJlc3VsdFtuY2hpbGRdID0gMTsKKwkJZm9yIChp
bnQgY2hpbGQgPSAwOyBjaGlsZCA8IG5jaGlsZDsgY2hpbGQrKykgeworCQkJd2hpbGUgKCFSRUFE
X09OQ0UocmVzdWx0W2NoaWxkXSkpCisJCQkJdGltZWxpbmVfYWR2YW5jZSh0aW1lbGluZSwgZmVu
Y2VfbnMpOworCQl9CisKKwkJaWd0X3dhaXRjaGlsZHJlbigpOworCQljbG9zZSh0aW1lbGluZSk7
CisKKwkJLyoKKwkJICogQXJlIHdlIHJ1bm5pbmcgb3V0IG9mIENQVSB0aW1lLCBhbmQgZmFpbCB0
byBzdWJtaXQgZnJhbWVzPworCQkgKgorCQkgKiBXZSB0cnkgdG8gcnVsZSBvdXQgYW55IHVuZHVl
IGltcGFjdCBvbiB0aGUgR1BVIHNjaGVkdWxpbmcKKwkJICogZnJvbSB0aGUgQ1BVIHNjaGVkdWxl
ciBieSBsb29raW5nIGZvciBjb3JlIHNhdHVyYXRpb24uIElmCisJCSAqIHdlIG1heSBiZSBpbiBh
IHNpdHVhdGlvbiB3aGVyZSB0aGUgY2xpZW50cyArIGtlcm5lbCBhcmUKKwkJICogdGFraW5nIGEg
d2hvbGUgY29yZSAodGhpbmsgbG9ja2RlcCksIHRoZW4gaXQgaXMgaW5jcmVhc2luZ2x5CisJCSAq
IGxpa2VseSB0aGF0IG91ciBtZWFzdXJlbWVudHMgaW5jbHVkZSBkZWxheXMgZnJvbSB0aGUgQ1BV
CisJCSAqIHNjaGVkdWxlci4gRXJyIG9uIHRoZSBzaWRlIG9mIGNhdXRpb24uCisJCSAqLworCQlk
X3RpbWUgPSBpZ3RfbnNlY19lbGFwc2VkKCZ0dik7CisJCWdldHJ1c2FnZShSVVNBR0VfQ0hJTERS
RU4sICZ1c2FnZSk7CisJCWNwdV90aW1lID0gZF9jcHVfdGltZSgmdXNhZ2UsICZvbGRfdXNhZ2Up
OworCQlpZ3RfZGVidWcoIkNQVSB1c2FnZTogJS4wZiUlXG4iLCAxMDAuICogY3B1X3RpbWUgLyBk
X3RpbWUpOworCQlpZiAoNCAqIGNwdV90aW1lID4gMyAqIGRfdGltZSkgeworCQkJaWYgKG5jaGls
ZCA+IDcpIC8qIGdvb2QgZW5vdWdoIHRvIGp1ZGdlIHBhc3MvZmFpbCAqLworCQkJCWJyZWFrOwor
CisJCQlpZ3Rfc2tpcF9vbl9mKDQgKiBjcHVfdGltZSA+IDMgKiBkX3RpbWUsCisJCQkJICAgICAg
IiUuMGYlJSBDUFUgdXNhZ2UsIHByZXN1bWluZyBjYXBhY2l0eSBleGNlZWRlZFxuIiwKKwkJCQkg
ICAgICAxMDAuICogY3B1X3RpbWUgLyBkX3RpbWUpOworCQl9CisKKwkJLyogV2l0aCBubyBjb250
ZW50aW9uLCB3ZSBzaG91bGQgbWF0Y2ggb3VyIHRhcmdldCBmcmFtZXRpbWUgKi8KKwkJaWYgKG5j
aGlsZCA9PSAxKSB7CisJCQlpZ3RfYXNzZXJ0KDQgKiByZXN1bHRbMF0gPiAzICogZmVuY2VfbnMg
JiYKKwkJCQkgICAzICogcmVzdWx0WzBdIDwgNCAqIGZlbmNlX25zKTsKKwkJCWNvbnRpbnVlOwor
CQl9CisKKwkJLyoKKwkJICogVGhlIFZJUCBzaG91bGQgYWx3YXlzIGJlIGFibGUgdG8gaGl0IHRo
ZSB0YXJnZXQgZnJhbWUgcmF0ZTsKKwkJICogcmVnYXJkbGVzcyBvZiBidWRnZXQgY29udGVudGlv
biBmcm9tIGxlc3NvciBjbGllbnRzLgorCQkgKi8KKwkJaWYgKGZsYWdzICYgKEZfVklQIHwgRl9S
UlVMKSkgeworCQkJaWd0X2luZm8oIlZJUCBpbnRlcnZhbCAlLjJmbXMsIHJhbmdlICUuMmZtc1xu
IiwKKwkJCQkgMWUtNiAqIHJlc3VsdFswXSwgMWUtNiAqIGlxclswXSk7CisJCQlpZ3RfYXNzZXJ0
X2YoNCAqIHJlc3VsdFswXSA+IDMgKiBmZW5jZV9ucyAmJgorCQkJCSAgICAgMyAqIHJlc3VsdFsw
XSA8IDQgKiBmZW5jZV9ucywKKwkJCQkgICAgICJWSVAgZXhwZWN0cyB0byBydW4gZXhhY3RseSB3
aGVuIGl0IHdhbnRzLCBleHBlY3RzIGFuIGludGVydmFsIG9mICUuMmZtcywgd2FzICUuMmZtc1xu
IiwKKwkJCQkgICAgIDFlLTYgKiBmZW5jZV9ucywgMWUtNiAqIHJlc3VsdFswXSk7CisJCQlpZ3Rf
YXNzZXJ0X2YoMiAqIGlxclswXSA8IHJlc3VsdFswXSwKKwkJCQkgICAgICJWSVAgZnJhbWUgSVFS
ICUuMmZtcyBleGNlZWRlZCBtZWRpYW4gdGhyZXNob2xkICUuMmZtc1xuIiwKKwkJCQkgICAgIDFl
LTYgKiBpcXJbMF0sCisJCQkJICAgICAxZS02ICogcmVzdWx0WzBdIC8gMik7CisJCQlpZiAoIS0t
bmNoaWxkKQorCQkJCWNvbnRpbnVlOworCisJCQkvKiBFeGNsdWRlIHRoZSBWSVAgcmVzdWx0IGZy
b20gdGhlIHBsZWJpYW4gc3RhdGlzdGljcyAqLworCQkJbWVtbW92ZShyZXN1bHQsIHJlc3VsdCAr
IDEsIG5jaGlsZCAqIHNpemVvZigqcmVzdWx0KSk7CisJCQltZW1tb3ZlKGlxciwgaXFyICsgMSwg
bmNoaWxkICogc2l6ZW9mKCppcXIpKTsKKwkJfQorCisJCWlndF9tZWFuX2luaXQoJm0pOworCQlm
b3IgKGludCBjaGlsZCA9IDA7IGNoaWxkIDwgbmNoaWxkOyBjaGlsZCsrKQorCQkJaWd0X21lYW5f
YWRkKCZtLCByZXN1bHRbY2hpbGRdKTsKKworCQlxc29ydChyZXN1bHQsIG5jaGlsZCwgc2l6ZW9m
KCpyZXN1bHQpLCBjbXBfdWwpOworCQlxc29ydChpcXIsIG5jaGlsZCwgc2l6ZW9mKCppcXIpLCBj
bXBfdWwpOworCisJCS8qCisJCSAqIFRoZSB0YXJnZXQgaW50ZXJ2YWwgZm9yIG1lZGlhbi9tZWFu
IGlzIDE2bXMgKGZlbmNlX25zKS4KKwkJICogSG93ZXZlciwgdGhpcyB3b3JrIGlzIGV2ZW5seSBz
cGxpdCBhY3Jvc3MgdGhlIGNsaWVudHMgc28KKwkJICogdGhlIHJhbmdlIChhbmQgbWVkaWFuKSBv
ZiBjbGllbnQgbWVkaWFucyBtYXkgYmUgbXVjaCBsZXNzCisJCSAqIHRoYW4gMTZtcyBbMTYvM05d
LiBXZSBwcmVzZW50IG1lZGlhbiBvZiBtZWRpYW5zIHRvIHRyeQorCQkgKiBhbmQgYXZvaWQgYW55
IGluc3RhYmlsaXR5IHdoaWxlIHJ1bm5pbmcgaW4gQ0k7IGF0IHRoZSBjb3N0CisJCSAqIG9mIGlu
c2Vuc2l0aXZpdHkhCisJCSAqLworCQlpZ3RfaW5mbygiJTNkIGNsaWVudHMsIHJhbmdlOiBbJS4x
ZiwgJS4xZl0sIGlxcjogWyUuMWYsICUuMWZdLCBtZWRpYW46ICUuMWYgWyUuMWYsICUuMWZdLCBt
ZWFuOiAlLjFmIMKxICUuMmYgbXMsIGNwdTogJS4wZiUlXG4iLAorCQkJIG5jaGlsZCwKKwkJCSAx
ZS02ICogcmVzdWx0WzBdLCAgMWUtNiAqIHJlc3VsdFtuY2hpbGQgLSAxXSwKKwkJCSAxZS02ICog
cmVzdWx0W2xvXSwgMWUtNiAqIHJlc3VsdFtoaV0sCisJCQkgMWUtNiAqIHJlc3VsdFtuY2hpbGQg
LyAyXSwKKwkJCSAxZS02ICogaXFyW2xvXSwgMWUtNiAqIGlxcltoaV0sCisJCQkgMWUtNiAqIGln
dF9tZWFuX2dldCgmbSksCisJCQkgMWUtNiAqIHNxcnQoaWd0X21lYW5fZ2V0X3ZhcmlhbmNlKCZt
KSksCisJCQkgMTAwLiAqIGNwdV90aW1lIC8gZF90aW1lKTsKKworCQlpZ3RfYXNzZXJ0X2YoaXFy
W25jaGlsZCAvIDJdIDwgMiAqIHJlc3VsdFtuY2hpbGQgLyAyXSwKKwkJCSAgICAgIkNoaWxkIGZy
YW1lIElRUiAlLjJmbXMgZXhjZWVkZWQgbWVkaWFuIHRocmVzaG9sZCAlLjJmbXNcbiIsCisJCQkg
ICAgIDFlLTYgKiBpcXJbbmNoaWxkIC8gMl0sCisJCQkgICAgIDFlLTYgKiByZXN1bHRbbmNoaWxk
IC8gMl0gKiAyKTsKKworCQlpZ3RfYXNzZXJ0X2YoNCAqIGlndF9tZWFuX2dldCgmbSkgPiAzICog
cmVzdWx0W25jaGlsZCAvIDJdICYmCisJCQkgICAgIDMgKiBpZ3RfbWVhbl9nZXQoJm0pIDwgNCAq
IHJlc3VsdFtuY2hpbGQgLyAyXSwKKwkJCSAgICAgIk1lYW4gb2YgY2xpZW50IGludGVydmFsICUu
MmZtcyBkaWZmZXJzIGZyb20gbWVkaWFuICUuMmZtcywgZGlzdHJpYnV0aW9uIGlzIHNrZXdlZFxu
IiwKKworCQkJICAgICAxZS02ICogaWd0X21lYW5fZ2V0KCZtKSwgMWUtNiAqIHJlc3VsdFtuY2hp
bGQgLyAyXSk7CisKKwkJaWd0X2Fzc2VydF9mKHJlc3VsdFtuY2hpbGQgLyAyXSA+IGZyYW1lX25z
IC8gMiwKKwkJCSAgICAgIk1lZGlhbiBjbGllbnQgaW50ZXJ2YWwgJS4yZm1zIGRpZCBub3QgbWF0
Y2ggdGFyZ2V0IGludGVydmFsICUuMmZtc1xuIiwKKwkJCSAgICAgMWUtNiAqIHJlc3VsdFtuY2hp
bGQgLyAyXSwgMWUtNiAqIGZyYW1lX25zKTsKKworCisJCWlndF9hc3NlcnRfZihyZXN1bHRbaGld
IC0gcmVzdWx0W2xvXSA8IHJlc3VsdFtuY2hpbGQgLyAyXSwKKwkJCSAgICAgIkludGVycXVhcnRp
bGUgcmFuZ2Ugb2YgY2xpZW50IGludGVydmFscyAlLjJmbXMgaXMgYXMgbGFyZ2UgYXMgdGhlIG1l
ZGlhbiB0aHJlc2hvbGQgJS4yZm1zLCBjbGllbnRzIGFyZSBub3QgZXZlbmx5IGRpc3RyaWJ1dGVk
IVxuIiwKKwkJCSAgICAgMWUtNiAqIChyZXN1bHRbaGldIC0gcmVzdWx0W2xvXSksCisJCQkgICAg
IDFlLTYgKiByZXN1bHRbbmNoaWxkIC8gMl0pOworCisJCS8qIE1heSBiZSBzbG93ZWQgZHVlIHRv
IHNoZWVyIHZvbHVtZSBvZiBjb250ZXh0IHN3aXRjaGVzICovCisJCWlmIChyZXN1bHRbMF0gPiAy
ICogZmVuY2VfbnMpCisJCQlicmVhazsKKwl9CisKKwltdW5tYXAoaXFyLCA0MDk2KTsKKwltdW5t
YXAocmVzdWx0LCA0MDk2KTsKKwlpZiAoY29tbW9uKQorCQlnZW1fY2xvc2UoaTkxNSwgY29tbW9u
KTsKK30KKworaWd0X21haW4KK3sKKwlzdGF0aWMgY29uc3Qgc3RydWN0IHsKKwkJY29uc3QgY2hh
ciAqbmFtZTsKKwkJdW5zaWduZWQgaW50IGZsYWdzOworCQl1bnNpZ25lZCBpbnQgYmFzaWM7Cisj
ZGVmaW5lIEJBU0lDCQkoMSA8PCAwKQorI2RlZmluZSBCQVNJQ19BTEwJKDEgPDwgMSkKKwl9IGZh
aXJbXSA9IHsKKwkJLyoKKwkJICogbm9uZSAtIG1heGltYWwgZ3JlZWQgaW4gZWFjaCBjbGllbnQK
KwkJICoKKwkJICogUHVzaCBhcyBtYW55IGZyYW1lcyBmcm9tIGVhY2ggY2xpZW50IGFzIGZhc3Qg
YXMgcG9zc2libGUKKwkJICovCisJCXsgIm5vbmUiLCAgICAgICAwLCBCQVNJQ19BTEwgfSwKKwkJ
eyAibm9uZS12aXAiLCAgIEZfVklQLCBCQVNJQyB9LCAvKiBvbmUgdmlwIGNsaWVudCBtdXN0IG1l
ZXQgZGVhZGxpbmVzICovCisJCXsgIm5vbmUtc29sbyIsICBGX1NPTE8sIEJBU0lDIH0sIC8qIDEg
YmF0Y2ggcGVyIGZyYW1lIHBlciBjbGllbnQgKi8KKwkJeyAibm9uZS1zaGFyZSIsIEZfU0hBUkUs
IEJBU0lDIH0sIC8qIHJlYWQgZnJvbSBhIGNvbW1vbiBidWZmZXIgKi8KKwkJeyAibm9uZS1ycnVs
IiwgIEZfUlJVTCwgQkFTSUMgfSwgLyogInJlYWx0aW1lLXJlc3BvbnNlIHVuZGVyIGxvYWQiICov
CisJCXsgIm5vbmUtcGluZyIsICBGX1BJTkcgfSwgLyogbWVhc3VyZSBpbnRlci1lbmdpbmUgZmFp
cm5lc3MgKi8KKworCQkvKgorCQkgKiB0aHJvdHRsZSAtIG9yaWdpbmFsIHBlciBjbGllbnQgdGhy
b3R0bGluZworCQkgKgorCQkgKiBVc2VkIGZvciBmcm9udCBidWZmZXJpbmcgcmVuZGVyaW5nIHdo
ZXJlIHRoZXJlIGlzIG5vCisJCSAqIGV4dGVuYWwgZnJhbWUgbWFya2VyLiBFYWNoIGNsaWVudCB0
cmllcyB0byBvbmx5IGtlZXAKKwkJICogMjBtcyBvZiB3b3JrIHN1Ym1pdHRlZCwgdGhvdWdoIHRo
YXQgbWVhc3VyZW1lbnQgaXMKKwkJICogZmxhd2VkLi4uCisJCSAqCisJCSAqIFRoaXMgaXMgdXNl
ZCBieSBYb3JnIHRvIHRyeSBhbmQgbWFpbnRhaW4gc29tZSByZXNlbWJhbGFuY2UKKwkJICogb2Yg
aW5wdXQvb3V0cHV0IGNvbnNpc3RlbmN5IHdoZW4gYmVpbmcgZmVlZCBhIGNvbnRpbnVvdXMKKwkJ
ICogc3RyZWFtIG9mIFgxMSBkcmF3IHJlcXVlc3RzIHN0cmFpZ2h0IGludG8gc2Nhbm91dCwgd2hl
cmUKKwkJICogdGhlIGNsaWVudHMgbWF5IHN1Ym1pdCB0aGUgd29yayBmYXN0ZXIgdGhhbiBjYW4g
YmUgZHJhd24uCisJCSAqCisJCSAqIFRocm90dGxpbmcgdHJhY2tzIHJlcXVlc3RzIHBlci1maWxl
IChhbmQgYXNzdW1lcyB0aGF0CisJCSAqIGFsbCByZXF1ZXN0cyBhcmUgaW4gc3VibWlzc2lvbiBv
cmRlciBhY3Jvc3MgdGhlIHdob2xlIGZpbGUpLAorCQkgKiBzbyB3ZSBzcGxpdCBlYWNoIGNoaWxk
IHRvIGl0cyBvd24gZmQuCisJCSAqLworCQl7ICJ0aHJvdHRsZSIsICAgICAgIEZfVEhST1RUTEUg
fCBGX0lTT0xBVEUsIEJBU0lDIH0sCisJCXsgInRocm90dGxlLXZpcCIsICAgRl9USFJPVFRMRSB8
IEZfSVNPTEFURSB8IEZfVklQIH0sCisJCXsgInRocm90dGxlLXNvbG8iLCAgRl9USFJPVFRMRSB8
IEZfSVNPTEFURSB8IEZfU09MTyB9LAorCQl7ICJ0aHJvdHRsZS1zaGFyZSIsIEZfVEhST1RUTEUg
fCBGX0lTT0xBVEUgfCBGX1NIQVJFIH0sCisJCXsgInRocm90dGxlLXJydWwiLCAgRl9USFJPVFRM
RSB8IEZfSVNPTEFURSB8IEZfUlJVTCB9LAorCisJCS8qCisJCSAqIHBhY2UgLSBtZXNhICJzdWJt
aXQgZG91YmxlIGJ1ZmZlcmluZyIKKwkJICoKKwkJICogU3VibWl0IGEgZnJhbWUsIHdhaXQgZm9y
IHByZXZpb3VzIGZyYW1lIHRvIHN0YXJ0LiBUaGlzCisJCSAqIHByZXZlbnRzIGVhY2ggY2xpZW50
IGZyb20gZ2V0dGluZyB0b28gZmFyIGFoZWFkIG9mIGl0cworCQkgKiByZW5kZXJpbmcsIG1haW50
YWluaW5nIGEgY29uc2lzdGVudCBpbnB1dC9vdXRwdXQgbGF0ZW5jeS4KKwkJICovCisJCXsgInBh
Y2UiLCAgICAgICBGX1BBQ0UsIEJBU0lDX0FMTCB9LAorCQl7ICJwYWNlLXNvbG8iLCAgRl9QQUNF
IHwgRl9TT0xPLCBCQVNJQyB9LAorCQl7ICJwYWNlLXNoYXJlIiwgRl9QQUNFIHwgRl9TT0xPIHwg
Rl9TSEFSRSwgQkFTSUMgfSwKKwkJeyAicGFjZS1waW5nIiwgIEZfUEFDRSB8IEZfU09MTyB8IEZf
U0hBUkUgfCBGX1BJTkd9LAorCisJCS8qIHN5bmMgLSBvbmx5IHN1Ym1pdCBhIGZyYW1lIGF0IGEg
dGltZSAqLworCQl7ICJzeW5jIiwgICAgICBGX1NZTkMsIEJBU0lDIH0sCisJCXsgInN5bmMtdmlw
IiwgIEZfU1lOQyB8IEZfVklQIH0sCisJCXsgInN5bmMtc29sbyIsIEZfU1lOQyB8IEZfU09MTyB9
LAorCisJCS8qIGZsb3cgLSBzeW5jaHJvbmlzZSBleGVjdXRpb24gYWdhaW5zdCB0aGUgY2xvY2sg
KHZibGFuaykgKi8KKwkJeyAiZmxvdyIsICAgICAgIEZfUEFDRSB8IEZfRkxPVywgQkFTSUMgfSwK
KwkJeyAiZmxvdy1zb2xvIiwgIEZfUEFDRSB8IEZfRkxPVyB8IEZfU09MTyB9LAorCQl7ICJmbG93
LXNoYXJlIiwgRl9QQUNFIHwgRl9GTE9XIHwgRl9TSEFSRSB9LAorCQl7ICJmbG93LXBpbmciLCAg
Rl9QQUNFIHwgRl9GTE9XIHwgRl9TSEFSRSB8IEZfUElORyB9LAorCisJCS8qIG5leHQgLSBzdWJt
aXQgYWhlYWQgb2YgdGhlIGNsb2NrICh2YmxhbmsgZG91YmxlIGJ1ZmZlcmluZykgKi8KKwkJeyAi
bmV4dCIsICAgICAgIEZfUEFDRSB8IEZfRkxPVyB8IEZfTkVYVCB9LAorCQl7ICJuZXh0LXNvbG8i
LCAgRl9QQUNFIHwgRl9GTE9XIHwgRl9ORVhUIHwgRl9TT0xPIH0sCisJCXsgIm5leHQtc2hhcmUi
LCBGX1BBQ0UgfCBGX0ZMT1cgfCBGX05FWFQgfCBGX1NIQVJFIH0sCisJCXsgIm5leHQtcGluZyIs
ICBGX1BBQ0UgfCBGX0ZMT1cgfCBGX05FWFQgfCBGX1NIQVJFIHwgRl9QSU5HIH0sCisKKwkJLyog
c3BhcmUgLSB1bmRlcnV0aWxpc2UgYnkgYSBzaW5nbGUgY2xpZW50IHRpbWVzbGljZSAqLworCQl7
ICJzcGFyZSIsICAgICAgRl9QQUNFIHwgRl9GTE9XIHwgRl9TUEFSRSB9LAorCQl7ICJzcGFyZS1z
b2xvIiwgRl9QQUNFIHwgRl9GTE9XIHwgRl9TUEFSRSB8IEZfU09MTyB9LAorCisJCS8qIGhhbGYg
LSBydW4gYXQgaGFsZiBwYWNlIChzdWJtaXQgMTZtcyBvZiB3b3JrIGV2ZXJ5IDMybXMpICovCisJ
CXsgImhhbGYiLCAgICAgICBGX1BBQ0UgfCBGX0ZMT1cgfCBGX0hBTEYgfSwKKwkJeyAiaGFsZi1z
b2xvIiwgIEZfUEFDRSB8IEZfRkxPVyB8IEZfSEFMRiB8IEZfU09MTyB9LAorCisJCXt9CisJfTsK
Kwljb25zdCBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2VuZ2luZTIgKmU7CisJaW50IGk5MTUgPSAt
MTsKKworCWlndF9maXh0dXJlIHsKKwkJaWd0X3JlcXVpcmVfc3dfc3luYygpOworCisJCWk5MTUg
PSBkcm1fb3Blbl9kcml2ZXJfbWFzdGVyKERSSVZFUl9JTlRFTCk7CisJCWdlbV9zdWJtaXNzaW9u
X3ByaW50X21ldGhvZChpOTE1KTsKKwkJZ2VtX3NjaGVkdWxlcl9wcmludF9jYXBhYmlsaXR5KGk5
MTUpOworCisJCWlndF9yZXF1aXJlX2dlbShpOTE1KTsKKwkJZ2VtX3JlcXVpcmVfbW1hcF93Yyhp
OTE1KTsKKwkJZ2VtX3JlcXVpcmVfY29udGV4dHMoaTkxNSk7CisJCWlndF9yZXF1aXJlKGdlbV9z
Y2hlZHVsZXJfZW5hYmxlZChpOTE1KSk7CisJCWlndF9yZXF1aXJlKGdlbV9zY2hlZHVsZXJfaGFz
X2N0eF9wcmlvcml0eShpOTE1KSk7CisKKwkJaWd0X2luZm8oIkNTIHRpbWVzdGFtcCBmcmVxdWVu
Y3k6ICVkXG4iLAorCQkJIHJlYWRfdGltZXN0YW1wX2ZyZXF1ZW5jeShpOTE1KSk7CisJCWlndF9y
ZXF1aXJlKGludGVsX2dlbihpbnRlbF9nZXRfZHJtX2RldmlkKGk5MTUpKSA+PSA4KTsKKworCQlp
Z3RfZm9ya19oYW5nX2RldGVjdG9yKGk5MTUpOworCX0KKworCS8qIEZpcnN0IHdlIGRvIGEgdHJp
bW1lZCBzZXQgb2YgYmFzaWMgdGVzdHMgZm9yIGZhc3RlciBDSSAqLworCWZvciAodHlwZW9mKCpm
YWlyKSAqZiA9IGZhaXI7IGYtPm5hbWU7IGYrKykgeworCQlpZiAoIWYtPmJhc2ljKQorCQkJY29u
dGludWU7CisKKwkJaWd0X3N1YnRlc3Rfd2l0aF9keW5hbWljX2YoImJhc2ljLSVzIiwgZi0+bmFt
ZSkgIHsKKwkJCV9fZm9yX2VhY2hfcGh5c2ljYWxfZW5naW5lKGk5MTUsIGUpIHsKKwkJCQlpZiAo
IWdlbV9jbGFzc19jYW5fc3RvcmVfZHdvcmQoaTkxNSwgZS0+Y2xhc3MpKQorCQkJCQljb250aW51
ZTsKKworCQkJCWlmIChlLT5mbGFncyAmJiAhKGYtPmJhc2ljICYgQkFTSUNfQUxMKSkKKwkJCQkJ
Y29udGludWU7CisKKwkJCQlpZ3RfZHluYW1pY19mKCIlcyIsIGUtPm5hbWUpCisJCQkJCWZhaXJu
ZXNzKGk5MTUsIGUsIDEsIGYtPmZsYWdzKTsKKwkJCX0KKwkJfQorCX0KKworCWZvciAodHlwZW9m
KCpmYWlyKSAqZiA9IGZhaXI7IGYtPm5hbWU7IGYrKykgeworCQlpZ3Rfc3VidGVzdF93aXRoX2R5
bmFtaWNfZigiZmFpci0lcyIsIGYtPm5hbWUpICB7CisJCQlfX2Zvcl9lYWNoX3BoeXNpY2FsX2Vu
Z2luZShpOTE1LCBlKSB7CisJCQkJaWYgKCFnZW1fY2xhc3NfY2FuX3N0b3JlX2R3b3JkKGk5MTUs
IGUtPmNsYXNzKSkKKwkJCQkJY29udGludWU7CisKKwkJCQlpZ3RfZHluYW1pY19mKCIlcyIsIGUt
Pm5hbWUpCisJCQkJCWZhaXJuZXNzKGk5MTUsIGUsIDUsIGYtPmZsYWdzKTsKKwkJCX0KKwkJfQor
CX0KKworCWlndF9maXh0dXJlIHsKKwkJaWd0X3N0b3BfaGFuZ19kZXRlY3RvcigpOworCQljbG9z
ZShpOTE1KTsKKwl9Cit9CmRpZmYgLS1naXQgYS90ZXN0cy9pbnRlbC1jaS9ibGFja2xpc3QudHh0
IGIvdGVzdHMvaW50ZWwtY2kvYmxhY2tsaXN0LnR4dAppbmRleCBjNmFmMjJiMzAuLjY3MTZjYzk3
ZiAxMDA2NDQKLS0tIGEvdGVzdHMvaW50ZWwtY2kvYmxhY2tsaXN0LnR4dAorKysgYi90ZXN0cy9p
bnRlbC1jaS9ibGFja2xpc3QudHh0CkBAIC0yNiw2ICsyNiw3IEBAIGlndEBnZW1fZXZpY3RfYWxp
Z25tZW50KEAuKik/CiBpZ3RAZ2VtX2V2aWN0X2V2ZXJ5dGhpbmcoQC4qKT8KIGlndEBnZW1fZXhl
Y19iaWdAKD8hLipzaW5nbGUpLioKIGlndEBnZW1fZXhlY19jYXB0dXJlQG1hbnktKD8hNEstKS4q
CitpZ3RAZ2VtX2V4ZWNfZmFpckAoPyEuKmJhc2ljKS4qCiBpZ3RAZ2VtX2V4ZWNfZmVuY2VALipo
YW5nLioKIGlndEBnZW1fZXhlY19mbHVzaEAoPyEuKmJhc2ljKS4qCiBpZ3RAZ2VtX2V4ZWNfbGF0
ZW5jeShALiopPwpkaWZmIC0tZ2l0IGEvdGVzdHMvbWVzb24uYnVpbGQgYi90ZXN0cy9tZXNvbi5i
dWlsZAppbmRleCA5ZDYwMDY3MDkuLmNkMzQyNzQ4NSAxMDA2NDQKLS0tIGEvdGVzdHMvbWVzb24u
YnVpbGQKKysrIGIvdGVzdHMvbWVzb24uYnVpbGQKQEAgLTE0OCw2ICsxNDgsNyBAQCBpOTE1X3By
b2dzID0gWwogCSdnZW1fZXhlY19jYXB0dXJlJywKIAknZ2VtX2V4ZWNfY3JlYXRlJywKIAknZ2Vt
X2V4ZWNfZW5kbGVzcycsCisJJ2dlbV9leGVjX2ZhaXInLAogCSdnZW1fZXhlY19mZW5jZScsCiAJ
J2dlbV9leGVjX2ZsdXNoJywKIAknZ2VtX2V4ZWNfZ3R0ZmlsbCcsCi0tIAoyLjI5LjIKCl9fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWls
aW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZy
ZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

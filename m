Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 518D210270F
	for <lists+intel-gfx@lfdr.de>; Tue, 19 Nov 2019 15:42:10 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6247B6E8A5;
	Tue, 19 Nov 2019 14:42:08 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 69E926E88C
 for <intel-gfx@lists.freedesktop.org>; Tue, 19 Nov 2019 14:42:06 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from localhost (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP (TLS) id
 19259116-1500050 for multiple; Tue, 19 Nov 2019 14:41:55 +0000
MIME-Version: 1.0
To: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>,
 intel-gfx@lists.freedesktop.org
From: Chris Wilson <chris@chris-wilson.co.uk>
In-Reply-To: <fde77006-d72b-712f-09c6-7fc4e2a84ac6@linux.intel.com>
References: <20191118230254.2615942-1-chris@chris-wilson.co.uk>
 <20191118230254.2615942-4-chris@chris-wilson.co.uk>
 <fde77006-d72b-712f-09c6-7fc4e2a84ac6@linux.intel.com>
Message-ID: <157417451261.10169.17308970866103066621@skylake-alporthouse-com>
User-Agent: alot/0.6
Date: Tue, 19 Nov 2019 14:41:52 +0000
Subject: Re: [Intel-gfx] [PATCH 03/19] drm/i915/gt: Close race between
 engine_park and intel_gt_retire_requests
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Matthew Auld <matthew.auld@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UXVvdGluZyBUdnJ0a28gVXJzdWxpbiAoMjAxOS0xMS0xOSAxNDoxNTo0OSkKPiAKPiBPbiAxOC8x
MS8yMDE5IDIzOjAyLCBDaHJpcyBXaWxzb24gd3JvdGU6Cj4gPiBUaGUgZ2VuZXJhbCBjb25jZXB0
IHdhcyB0aGF0IGludGVsX3RpbWVsaW5lLmFjdGl2ZV9jb3VudCB3YXMgbG9ja2VkIGJ5Cj4gPiB0
aGUgaW50ZWxfdGltZWxpbmUubXV0ZXguIFRoZSBleGNlcHRpb24gd2FzIGZvciBwb3dlciBtYW5h
Z2VtZW50LCB3aGVyZQo+ID4gdGhlIGVuZ2luZS0+a2VybmVsX2NvbnRleHQtPnRpbWVsaW5lIGNv
dWxkIGJlIG1hbmlwdWxhdGVkIHVuZGVyIHRoZQo+ID4gZ2xvYmFsIHdha2VyZWYubXV0ZXguCj4g
PiAKPiA+IFRoaXMgd2FzIHF1aXRlIHNvbGlkLCBhcyB3ZSBhbHdheXMgbWFuaXB1bGF0ZWQgdGhl
IHRpbWVsaW5lIG9ubHkgd2hpbGUKPiA+IHdlIGhlbGQgYW4gZW5naW5lIHdha2VyZWYuCj4gPiAK
PiA+IEFuZCB0aGVuIHdlIHN0YXJ0ZWQgcmV0aXJpbmcgcmVxdWVzdHMgb3V0c2lkZSBvZiBzdHJ1
Y3RfbXV0ZXgsIG9ubHkKPiA+IHVzaW5nIHRoZSB0aW1lbGluZXMuYWN0aXZlX2xpc3QgYW5kIHRo
ZSB0aW1lbGluZS0+bXV0ZXguIFRoZXJlIHdlCj4gPiBzdGFydGVkIG1hbmlwdWxhdGluZyBpbnRl
bF90aW1lbGluZS5hY3RpdmVfY291bnQgb3V0c2lkZSBvZiBhbiBlbmdpbmUKPiA+IHdha2VyZWYs
IGFuZCBzbyBpbnRyb2R1Y2VkIGEgcmFjZSBiZXR3ZWVuIF9fZW5naW5lX3BhcmsoKSBhbmQKPiA+
IGludGVsX2d0X3JldGlyZV9yZXF1ZXN0cygpLCBhIHJhY2UgdGhhdCBjb3VsZCByZXN1bHQgaW4g
dGhlCj4gPiBlbmdpbmUtPmtlcm5lbF9jb250ZXh0IG5vdCBiZWluZyBhZGRlZCB0byB0aGUgYWN0
aXZlIHRpbWVsaW5lcyBhbmQgc28KPiA+IGxvc2luZyByZXF1ZXN0cywgd2hpY2ggY2F1c2VkIHVz
IHRvIGtlZXAgdGhlIHN5c3RlbSBwZXJtYW5lbnRseSBwb3dlcmVkCj4gPiB1cCBbYW5kIHVubG9h
ZGFibGVdLgo+ID4gCj4gPiBUaGUgcmFjZSB3b3VsZCBiZSBlYXN5IHRvIGNsb3NlIGlmIHdlIGNv
dWxkIHRha2UgdGhlIGVuZ2luZSB3YWtlcmVmIGZvcgo+ID4gdGhlIHRpbWVsaW5lIGJlZm9yZSB3
ZSByZXRpcmUgLS0gZXhjZXB0IHRpbWVsaW5lcyBhcmUgbm90IGJvdW5kIHRvIGFueQo+ID4gZW5n
aW5lIGFuZCBzbyB3ZSB3b3VsZCBuZWVkIHRvIGtlZXAgYWxsIGFjdGl2ZSBlbmdpbmVzIGF3YWtl
LiBUaGUKPiA+IGFsdGVybmF0aXZlIGlzIHRvIGd1YXJkIGludGVsX3RpbWVsaW5lX2VudGVyL2lu
dGVsX3RpbWVsaW5lX2V4aXQgZm9yIHVzZQo+ID4gb3V0c2lkZSBvZiB0aGUgdGltZWxpbmUtPm11
dGV4Lgo+ID4gCj4gPiBGaXhlczogZTVkYWRmZjRiMDkzICgiZHJtL2k5MTU6IFByb3RlY3QgcmVx
dWVzdCByZXRpcmVtZW50IHdpdGggdGltZWxpbmUtPm11dGV4IikKPiA+IFNpZ25lZC1vZmYtYnk6
IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgo+ID4gQ2M6IE1hdHRoZXcg
QXVsZCA8bWF0dGhldy5hdWxkQGludGVsLmNvbT4KPiA+IENjOiBUdnJ0a28gVXJzdWxpbiA8dHZy
dGtvLnVyc3VsaW5AaW50ZWwuY29tPgo+ID4gLS0tCj4gPiAgIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2d0X3JlcXVlc3RzLmMgICB8ICA4ICsrLS0tCj4gPiAgIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lLmMgICAgICB8IDM0ICsrKysrKysrKysrKysrKy0tLS0K
PiA+ICAgLi4uL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF90aW1lbGluZV90eXBlcy5oICAgIHwgIDIg
Ky0KPiA+ICAgMyBmaWxlcyBjaGFuZ2VkLCAzMiBpbnNlcnRpb25zKCspLCAxMiBkZWxldGlvbnMo
LSkKPiA+IAo+ID4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0
X3JlcXVlc3RzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9yZXF1ZXN0cy5j
Cj4gPiBpbmRleCBhNzllNmVmYjMxYTIuLjc1NTlkNjM3M2Y0OSAxMDA2NDQKPiA+IC0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3JlcXVlc3RzLmMKPiA+ICsrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3JlcXVlc3RzLmMKPiA+IEBAIC00OSw4ICs0OSw4
IEBAIGxvbmcgaW50ZWxfZ3RfcmV0aXJlX3JlcXVlc3RzX3RpbWVvdXQoc3RydWN0IGludGVsX2d0
ICpndCwgbG9uZyB0aW1lb3V0KQo+ID4gICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwo+
ID4gICAKPiA+ICAgICAgICAgICAgICAgaW50ZWxfdGltZWxpbmVfZ2V0KHRsKTsKPiA+IC0gICAg
ICAgICAgICAgR0VNX0JVR19PTighdGwtPmFjdGl2ZV9jb3VudCk7Cj4gPiAtICAgICAgICAgICAg
IHRsLT5hY3RpdmVfY291bnQrKzsgLyogcGluIHRoZSBsaXN0IGVsZW1lbnQgKi8KPiA+ICsgICAg
ICAgICAgICAgR0VNX0JVR19PTighYXRvbWljX3JlYWQoJnRsLT5hY3RpdmVfY291bnQpKTsKPiA+
ICsgICAgICAgICAgICAgYXRvbWljX2luYygmdGwtPmFjdGl2ZV9jb3VudCk7IC8qIHBpbiB0aGUg
bGlzdCBlbGVtZW50ICovCj4gPiAgICAgICAgICAgICAgIHNwaW5fdW5sb2NrX2lycXJlc3RvcmUo
JnRpbWVsaW5lcy0+bG9jaywgZmxhZ3MpOwo+ID4gICAKPiA+ICAgICAgICAgICAgICAgaWYgKHRp
bWVvdXQgPiAwKSB7Cj4gPiBAQCAtNzEsMTQgKzcxLDE0IEBAIGxvbmcgaW50ZWxfZ3RfcmV0aXJl
X3JlcXVlc3RzX3RpbWVvdXQoc3RydWN0IGludGVsX2d0ICpndCwgbG9uZyB0aW1lb3V0KQo+ID4g
ICAKPiA+ICAgICAgICAgICAgICAgLyogUmVzdW1lIGl0ZXJhdGlvbiBhZnRlciBkcm9wcGluZyBs
b2NrICovCj4gPiAgICAgICAgICAgICAgIGxpc3Rfc2FmZV9yZXNldF9uZXh0KHRsLCB0biwgbGlu
ayk7Cj4gPiAtICAgICAgICAgICAgIGlmICghLS10bC0+YWN0aXZlX2NvdW50KQo+ID4gKyAgICAg
ICAgICAgICBpZiAoYXRvbWljX2RlY19hbmRfdGVzdCgmdGwtPmFjdGl2ZV9jb3VudCkpCj4gPiAg
ICAgICAgICAgICAgICAgICAgICAgbGlzdF9kZWwoJnRsLT5saW5rKTsKPiA+ICAgCj4gPiAgICAg
ICAgICAgICAgIG11dGV4X3VubG9jaygmdGwtPm11dGV4KTsKPiA+ICAgCj4gPiAgICAgICAgICAg
ICAgIC8qIERlZmVyIHRoZSBmaW5hbCByZWxlYXNlIHRvIGFmdGVyIHRoZSBzcGlubG9jayAqLwo+
ID4gICAgICAgICAgICAgICBpZiAocmVmY291bnRfZGVjX2FuZF90ZXN0KCZ0bC0+a3JlZi5yZWZj
b3VudCkpIHsKPiA+IC0gICAgICAgICAgICAgICAgICAgICBHRU1fQlVHX09OKHRsLT5hY3RpdmVf
Y291bnQpOwo+ID4gKyAgICAgICAgICAgICAgICAgICAgIEdFTV9CVUdfT04oYXRvbWljX3JlYWQo
JnRsLT5hY3RpdmVfY291bnQpKTsKPiA+ICAgICAgICAgICAgICAgICAgICAgICBsaXN0X2FkZCgm
dGwtPmxpbmssICZmcmVlKTsKPiA+ICAgICAgICAgICAgICAgfQo+ID4gICAgICAgfQo+ID4gZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF90aW1lbGluZS5jCj4gPiBpbmRleCAxNmE5ZTg4ZDkz
ZGUuLjRmOTE0ZjBkNWVhYiAxMDA2NDQKPiA+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX3RpbWVsaW5lLmMKPiA+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X3RpbWVsaW5lLmMKPiA+IEBAIC0zMzQsMTUgKzMzNCwzMyBAQCB2b2lkIGludGVsX3RpbWVsaW5l
X2VudGVyKHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwpCj4gPiAgICAgICBzdHJ1Y3QgaW50ZWxf
Z3RfdGltZWxpbmVzICp0aW1lbGluZXMgPSAmdGwtPmd0LT50aW1lbGluZXM7Cj4gPiAgICAgICB1
bnNpZ25lZCBsb25nIGZsYWdzOwo+ID4gICAKPiA+ICsgICAgIC8qCj4gPiArICAgICAgKiBQcmV0
ZW5kIHdlIGFyZSBzZXJpYWxpc2VkIGJ5IHRoZSB0aW1lbGluZS0+bXV0ZXguCj4gPiArICAgICAg
Kgo+ID4gKyAgICAgICogV2hpbGUgZ2VuZXJhbGx5IHRydWUsIHRoZXJlIGFyZSBhIGZldyBleGNl
cHRpb25zIHRvIHRoZSBydWxlCj4gPiArICAgICAgKiBmb3IgdGhlIGVuZ2luZS0+a2VybmVsX2Nv
bnRleHQgYmVpbmcgdXNlZCB0byBtYW5hZ2UgcG93ZXIKPiA+ICsgICAgICAqIHRyYW5zaXRpb25z
LiBBcyB0aGUgZW5naW5lX3BhcmsgbWF5IGJlIGNhbGxlZCBmcm9tIHVuZGVyIGFueQo+ID4gKyAg
ICAgICogdGltZWxpbmUsIGl0IHVzZXMgdGhlIHBvd2VyIG11dGV4IGFzIGEgZ2xvYmFsIHNlcmlh
bGlzYXRpb24KPiA+ICsgICAgICAqIGxvY2sgdG8gcHJldmVudCBhbnkgb3RoZXIgcmVxdWVzdCBl
bnRlcmluZyBpdHMgdGltZWxpbmUuCj4gPiArICAgICAgKgo+ID4gKyAgICAgICogVGhlIHJ1bGUg
aXMgZ2VuZXJhbGx5IHRsLT5tdXRleCwgb3RoZXJ3aXNlIGVuZ2luZS0+d2FrZXJlZi5tdXRleC4K
PiA+ICsgICAgICAqCj4gPiArICAgICAgKiBIb3dldmVyLCBpbnRlbF9ndF9yZXRpcmVfcmVxdWVz
dCgpIGRvZXMgbm90IGtub3cgd2hpY2ggZW5naW5lCj4gPiArICAgICAgKiBpdCBpcyByZXRpcmlu
ZyBhbG9uZyBhbmQgc28gY2Fubm90IHBhcnRha2UgaW4gdGhlIGVuZ2luZS1wbQo+ID4gKyAgICAg
ICogYmFycmllciwgYW5kIHRoZXJlIHdlIHVzZSB0aGUgdGwtPmFjdGl2ZV9jb3VudCBhcyBhIG1l
YW5zIHRvCj4gPiArICAgICAgKiBwaW4gdGhlIHRpbWVsaW5lIGluIHRoZSBhY3RpdmVfbGlzdCB3
aGlsZSB0aGUgbG9ja3MgYXJlIGRyb3BwZWQuCj4gPiArICAgICAgKiBFcmdvLCBhcyB0aGF0IGlz
IG91dHNpZGUgb2YgdGhlIGVuZ2luZS1wbSBiYXJyaWVyLCB3ZSBuZWVkIHRvCj4gPiArICAgICAg
KiB1c2UgYXRvbWljIHRvIG1hbmlwdWxhdGUgdGwtPmFjdGl2ZV9jb3VudC4KPiA+ICsgICAgICAq
Lwo+ID4gICAgICAgbG9ja2RlcF9hc3NlcnRfaGVsZCgmdGwtPm11dGV4KTsKPiA+IC0KPiA+ICAg
ICAgIEdFTV9CVUdfT04oIWF0b21pY19yZWFkKCZ0bC0+cGluX2NvdW50KSk7Cj4gPiAtICAgICBp
ZiAodGwtPmFjdGl2ZV9jb3VudCsrKQo+ID4gKwo+ID4gKyAgICAgaWYgKGF0b21pY19hZGRfdW5s
ZXNzKCZ0bC0+YWN0aXZlX2NvdW50LCAxLCAwKSkKPiA+ICAgICAgICAgICAgICAgcmV0dXJuOwo+
ID4gLSAgICAgR0VNX0JVR19PTighdGwtPmFjdGl2ZV9jb3VudCk7IC8qIG92ZXJmbG93PyAqLwo+
ID4gICAKPiA+ICAgICAgIHNwaW5fbG9ja19pcnFzYXZlKCZ0aW1lbGluZXMtPmxvY2ssIGZsYWdz
KTsKPiA+IC0gICAgIGxpc3RfYWRkKCZ0bC0+bGluaywgJnRpbWVsaW5lcy0+YWN0aXZlX2xpc3Qp
Owo+ID4gKyAgICAgaWYgKCFhdG9taWNfZmV0Y2hfaW5jKCZ0bC0+YWN0aXZlX2NvdW50KSkKPiA+
ICsgICAgICAgICAgICAgbGlzdF9hZGQoJnRsLT5saW5rLCAmdGltZWxpbmVzLT5hY3RpdmVfbGlz
dCk7Cj4gCj4gU28gcmV0aXJlbWVudCByYWNlZCB3aXRoIHRoaXMgYW5kIGhhcyBlbGV2YXRlZCB0
aGUgYWN0aXZlX2NvdW50PyBCdXQgCj4gcmV0aXJlbWVudCBkb2VzIG5vdCBhZGQgdGhlIHRpbWVs
aW5lIHRvIHRoZSBsaXN0LCBzbyB3ZSBleGl0IGhlcmUgCj4gd2l0aG91dCBpdCBvbiB0aGUgYWN0
aXZlX2xpc3QuCgpSZXRpcmVtZW50IG9ubHkgc2VlcyBhbiBlbGVtZW50IG9uIHRoZSBhY3RpdmVf
bGlzdC4gV2hhdCB3ZSBvYnNlcnZlZCBpbgpwcmFjdGljZSB3YXMgdGhlIGluYy9kZWMgb24gdGwt
PmFjdGl2ZV9jb3VudCByYWNpbmcsIGNhdXNpbmcKaW5kZXRlcm1pbmF0ZSByZXN1bHRzLCB3aXRo
IHRoZSByZXN1bHQgdGhhdCB3ZSByZW1vdmVkIHRoZSBlbGVtZW50IGZyb20KdGhlIGFjdGl2ZV9s
aXN0IHdoaWxlIGl0IGhhZCBhIHJhaXNlZCB0bC0+YWN0aXZlX2NvdW50IChkdWUgdG8gdGhlCmlu
ZmxpZ2h0IHBvc3RpbmcgZnJvbSB0aGUgb3RoZXIgQ1BVKS4KClRodXMgd2Uga2VwdCByZXF1ZXN0
cyBpbmZsaWdodCBhbmQgdGhlIGVuZ2luZSBhd2FrZSB3aXRoIG5vIHdheSB0byBjbGVhcgp0aGVt
LiBUaGlzIG1vc3Qgb2J2aW91cyB0cmlnZ2VyZWQgR0VNX0JVR19PTihndC0+YXdha2UpIGR1cmlu
ZyBzdXNwZW5kLAphbmQgaXMgYWxzbyByZXNwb25zaWJsZSBmb3IgdGhlIHRpbWVvdXRzIG9uIGdl
bV9xdWllc2NlbnRfZ3B1KCkgb3IKaWd0X2Ryb3BfY2FjaGVzX3NldChEUk9QX0lETEUpLgotQ2hy
aXMKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwt
Z2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8v
bGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

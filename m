Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D98A37DE12
	for <lists+intel-gfx@lfdr.de>; Thu,  1 Aug 2019 16:39:09 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D68A06E67E;
	Thu,  1 Aug 2019 14:39:07 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 620156E67E
 for <intel-gfx@lists.freedesktop.org>; Thu,  1 Aug 2019 14:39:06 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from localhost (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP (TLS) id
 17790803-1500050 for multiple; Thu, 01 Aug 2019 15:39:03 +0100
MIME-Version: 1.0
From: Chris Wilson <chris@chris-wilson.co.uk>
User-Agent: alot/0.6
To: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>,
 intel-gfx@lists.freedesktop.org
References: <20190801121533.14057-1-chris@chris-wilson.co.uk>
 <20190801122002.24248-1-chris@chris-wilson.co.uk>
 <8ed53b04-9dae-3430-9b4f-7ce233101218@linux.intel.com>
In-Reply-To: <8ed53b04-9dae-3430-9b4f-7ce233101218@linux.intel.com>
Message-ID: <156467034056.6045.9270718607329366656@skylake-alporthouse-com>
Date: Thu, 01 Aug 2019 15:39:00 +0100
Subject: Re: [Intel-gfx] [PATCH] drm/i915/pmu: Atomically acquire the gt_pm
 wakeref
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UXVvdGluZyBUdnJ0a28gVXJzdWxpbiAoMjAxOS0wOC0wMSAxNToyMToxNykKPiAKPiBPbiAwMS8w
OC8yMDE5IDEzOjIwLCBDaHJpcyBXaWxzb24gd3JvdGU6Cj4gPiBDdXJyZW50bHksIHdlIG9ubHkg
c2FtcGxlIGlmIHRoZSBpbnRlbF9ndCBpcyBhd2FrZSwgYnV0IHdlIGFjcXVpcmUgb3VyCj4gPiBv
d24gcnVudGltZV9wbSB3YWtlcmVmLiBTaW5jZSBpbnRlbF9ndCBoYXMgdHJhbnNpdGlvbmVkIHRv
IHRyYWNraW5nIGl0cwo+ID4gb3duIHdha2VyZWYsIHdlIGNhbiBhdG9taWNhbGx5IHRlc3QgYW5k
IGFjcXVpcmUgdGhhdCB3YWtlcmVmIGluc3RlYWQuCj4gPiAKPiA+IFNpZ25lZC1vZmYtYnk6IENo
cmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgo+ID4gQ2M6IFR2cnRrbyBVcnN1
bGluIDx0dnJ0a28udXJzdWxpbkBpbnRlbC5jb20+Cj4gPiAtLS0KPiA+IE5vIGF1dG9tYWdpYyBk
cm9wIQo+ID4gLS0tCj4gPiAgIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmgg
fCAgOCArKysrKysrLQo+ID4gICBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BtdS5jICAgICAg
IHwgMjMgKysrKysrKystLS0tLS0tLS0tLS0tLS0KPiA+ICAgMiBmaWxlcyBjaGFuZ2VkLCAxNSBp
bnNlcnRpb25zKCspLCAxNiBkZWxldGlvbnMoLSkKPiA+IAo+ID4gZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9ndF9wbS5oCj4gPiBpbmRleCBiYTk2MGUxZmMyMDkuLjAxNjI5ODQ4M2RlNyAxMDA2
NDQKPiA+IC0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmgKPiA+ICsr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmgKPiA+IEBAIC05LDcgKzks
OCBAQAo+ID4gICAKPiA+ICAgI2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+Cj4gPiAgIAo+ID4gLXN0
cnVjdCBpbnRlbF9ndDsKPiA+ICsjaW5jbHVkZSAiaW50ZWxfZ3RfdHlwZXMuaCIKPiA+ICsjaW5j
bHVkZSAiaW50ZWxfd2FrZXJlZi5oIgo+ID4gICAKPiA+ICAgZW51bSB7Cj4gPiAgICAgICBJTlRF
TF9HVF9VTlBBUkssCj4gPiBAQCAtMTksNiArMjAsMTEgQEAgZW51bSB7Cj4gPiAgIHZvaWQgaW50
ZWxfZ3RfcG1fZ2V0KHN0cnVjdCBpbnRlbF9ndCAqZ3QpOwo+ID4gICB2b2lkIGludGVsX2d0X3Bt
X3B1dChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KTsKPiA+ICAgCj4gPiArc3RhdGljIGlubGluZSBib29s
IGludGVsX2d0X3BtX2dldF9pZl9hd2FrZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQo+ID4gK3sKPiA+
ICsgICAgIHJldHVybiBpbnRlbF93YWtlcmVmX2dldF9pZl9hY3RpdmUoJmd0LT53YWtlcmVmKTsK
PiA+ICt9Cj4gPiArCj4gPiAgIHZvaWQgaW50ZWxfZ3RfcG1faW5pdF9lYXJseShzdHJ1Y3QgaW50
ZWxfZ3QgKmd0KTsKPiA+ICAgCj4gPiAgIHZvaWQgaW50ZWxfZ3Rfc2FuaXRpemUoc3RydWN0IGlu
dGVsX2d0ICpndCwgYm9vbCBmb3JjZSk7Cj4gPiBkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9wbXUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcG11LmMKPiA+IGlu
ZGV4IGVmZjg2NDgzYmVjMC4uZTcxMTkyODA0OTk2IDEwMDY0NAo+ID4gLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9wbXUuYwo+ID4gKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9wbXUuYwo+ID4gQEAgLTgsNiArOCw3IEBACj4gPiAgICNpbmNsdWRlIDxsaW51eC9wbV9ydW50
aW1lLmg+Cj4gPiAgIAo+ID4gICAjaW5jbHVkZSAiZ3QvaW50ZWxfZW5naW5lLmgiCj4gPiArI2lu
Y2x1ZGUgImd0L2ludGVsX2d0X3BtLmgiCj4gPiAgIAo+ID4gICAjaW5jbHVkZSAiaTkxNV9kcnYu
aCIKPiA+ICAgI2luY2x1ZGUgImk5MTVfcG11LmgiCj4gPiBAQCAtMTYxLDE2ICsxNjIsMTIgQEAg
ZW5naW5lc19zYW1wbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1bnNpZ25l
ZCBpbnQgcGVyaW9kX25zKQo+ID4gICB7Cj4gPiAgICAgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmU7Cj4gPiAgICAgICBlbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKPiA+IC0gICAgIGlu
dGVsX3dha2VyZWZfdCB3YWtlcmVmOwo+ID4gICAgICAgdW5zaWduZWQgbG9uZyBmbGFnczsKPiA+
ICAgCj4gPiAgICAgICBpZiAoKGRldl9wcml2LT5wbXUuZW5hYmxlICYgRU5HSU5FX1NBTVBMRV9N
QVNLKSA9PSAwKQo+ID4gICAgICAgICAgICAgICByZXR1cm47Cj4gPiAgIAo+ID4gLSAgICAgd2Fr
ZXJlZiA9IDA7Cj4gPiAtICAgICBpZiAoUkVBRF9PTkNFKGRldl9wcml2LT5ndC5hd2FrZSkpCj4g
PiAtICAgICAgICAgICAgIHdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldF9pZl9pbl91c2Uo
JmRldl9wcml2LT5ydW50aW1lX3BtKTsKPiA+IC0gICAgIGlmICghd2FrZXJlZikKPiA+ICsgICAg
IGlmICghaW50ZWxfZ3RfcG1fZ2V0X2lmX2F3YWtlKCZkZXZfcHJpdi0+Z3QpKQo+ID4gICAgICAg
ICAgICAgICByZXR1cm47Cj4gPiAgIAo+ID4gICAgICAgc3Bpbl9sb2NrX2lycXNhdmUoJmRldl9w
cml2LT51bmNvcmUubG9jaywgZmxhZ3MpOwo+ID4gQEAgLTIwNSw3ICsyMDIsNyBAQCBlbmdpbmVz
X3NhbXBsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHVuc2lnbmVkIGludCBw
ZXJpb2RfbnMpCj4gPiAgICAgICB9Cj4gPiAgICAgICBzcGluX3VubG9ja19pcnFyZXN0b3JlKCZk
ZXZfcHJpdi0+dW5jb3JlLmxvY2ssIGZsYWdzKTsKPiA+ICAgCj4gPiAtICAgICBpbnRlbF9ydW50
aW1lX3BtX3B1dCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwo+ID4gKyAgICAgaW50
ZWxfZ3RfcG1fcHV0KCZkZXZfcHJpdi0+Z3QpOwo+ID4gICB9Cj4gPiAgIAo+ID4gICBzdGF0aWMg
dm9pZAo+ID4gQEAgLTIyMiwxNSArMjE5LDExIEBAIGZyZXF1ZW5jeV9zYW1wbGUoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1bnNpZ25lZCBpbnQgcGVyaW9kX25zKQo+ID4gICAg
ICAgICAgICAgICB1MzIgdmFsOwo+ID4gICAKPiA+ICAgICAgICAgICAgICAgdmFsID0gZGV2X3By
aXYtPmd0X3BtLnJwcy5jdXJfZnJlcTsKPiA+IC0gICAgICAgICAgICAgaWYgKGRldl9wcml2LT5n
dC5hd2FrZSkgewo+ID4gLSAgICAgICAgICAgICAgICAgICAgIGludGVsX3dha2VyZWZfdCB3YWtl
cmVmOwo+ID4gLQo+ID4gLSAgICAgICAgICAgICAgICAgICAgIHdpdGhfaW50ZWxfcnVudGltZV9w
bV9pZl9pbl91c2UoJmRldl9wcml2LT5ydW50aW1lX3BtLAo+ID4gLSAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FrZXJlZikgewo+ID4gLSAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0gaW50ZWxfdW5jb3JlX3JlYWRfbm90cmFjZSgm
ZGV2X3ByaXYtPnVuY29yZSwKPiA+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgR0VONl9SUFNUQVQxKTsKPiA+IC0gICAgICAgICAg
ICAgICAgICAgICAgICAgICAgIHZhbCA9IGludGVsX2dldF9jYWdmKGRldl9wcml2LCB2YWwpOwo+
ID4gLSAgICAgICAgICAgICAgICAgICAgIH0KPiA+ICsgICAgICAgICAgICAgaWYgKGludGVsX2d0
X3BtX2dldF9pZl9hd2FrZSgmZGV2X3ByaXYtPmd0KSkgewo+ID4gKyAgICAgICAgICAgICAgICAg
ICAgIHZhbCA9IGludGVsX3VuY29yZV9yZWFkX25vdHJhY2UoJmRldl9wcml2LT51bmNvcmUsCj4g
PiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBH
RU42X1JQU1RBVDEpOwo+ID4gKyAgICAgICAgICAgICAgICAgICAgIHZhbCA9IGludGVsX2dldF9j
YWdmKGRldl9wcml2LCB2YWwpOwo+ID4gKyAgICAgICAgICAgICAgICAgICAgIGludGVsX2d0X3Bt
X3B1dCgmZGV2X3ByaXYtPmd0KTsKPiA+ICAgICAgICAgICAgICAgfQo+ID4gICAKPiA+ICAgICAg
ICAgICAgICAgYWRkX3NhbXBsZV9tdWx0KCZkZXZfcHJpdi0+cG11LnNhbXBsZVtfX0k5MTVfU0FN
UExFX0ZSRVFfQUNUXSwKPiA+IAo+IAo+IEkgZ3Vlc3MgSSdsbCBiZSByZWJhc2luZyBtaW5lLCBh
dCBzb21lIHBvaW50LiA6KQoKSSBhbnRpY2lwYXRlZCB5b3UgbWVyZ2luZyBpdCBhdCBzb21lIHBv
aW50LgoKSGFkIGEgdGhvdWdodCwgYW5kIHdlIGRvbid0IG5lZWQgZ3RfcG0gZm9yIHRoZSBlbmdp
bmUgc2FtcGxpbmcsIGJ1dApyYXRoZXIgaW50ZWxfZW5naW5lX3BtX2dldF9pZl9hd2FrZS4KLUNo
cmlzCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVs
LWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

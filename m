Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 38360EC440
	for <lists+intel-gfx@lfdr.de>; Fri,  1 Nov 2019 15:10:19 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 299B86F802;
	Fri,  1 Nov 2019 14:10:16 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9B9D56F802
 for <intel-gfx@lists.freedesktop.org>; Fri,  1 Nov 2019 14:10:14 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19047921-1500050 
 for <intel-gfx@lists.freedesktop.org>; Fri, 01 Nov 2019 14:10:10 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  1 Nov 2019 14:10:09 +0000
Message-Id: <20191101141009.15581-4-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0.rc2
In-Reply-To: <20191101141009.15581-1-chris@chris-wilson.co.uk>
References: <20191101141009.15581-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 4/4] drm/i915: Defer rc6 shutdown to suspend_late
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q3VycmVudGx5IHdlIHNodXRkb3duIHJjNiBkdXJpbmcgaTkxNV9nZW1fcmVzdW1lKCkgYnV0IHRo
aXMgaXMgY2FsbGVkCmR1cmluZyB0aGUgcHJlcGFyYXRpb24gcGhhc2UgKGk5MTVfZHJtX3ByZXBh
cmUpIGZvciBhbGwgc3VzcGVuZCBwYXRocywKYnV0IHdlIG9ubHkgd2FudCB0byBzaHV0ZG93biBy
YzYgZm9yIFMzKy4gTW92ZSB0aGUgYWN0dWFsIHNodXRkb3duIHRvCmk5MTVfZ2VtX3N1c3BlbmRf
bGF0ZSgpLgoKV2UgdGhlbiBuZWVkIHRvIGRpZmZlcmVudGlhdGUgYmV0d2VlbiBzdXNwZW5kIHRh
cmdldHMsIHRvIGRpc3Rpbmd1aXNoIFMwCihzMmlkbGUpIHdoZXJlIHRoZSBkZXZpY2UgaXMga2Vw
dCBhd2FrZSBidXQgbmVlZHMgdG8gYmUgaW4gYSBsb3cgcG93ZXIKbW9kZSAodGhlIHNhbWUgYXMg
cnVudGltZSBzdXNwZW5kKSBmcm9tIHRoZSBkZXZpY2Ugc3VzcGVuZCBsZXZlbHMgd2hlcmUKd2Ug
bG9zZSBjb250cm9sIG9mIEhXIGFuZCBzbyBtdXN0IGRpc2FibGUgYW55IEhXIGFjY2VzcyB0byBk
YW5nbGluZwptZW1vcnkuCgpCdWd6aWxsYTogaHR0cHM6Ly9idWdzLmZyZWVkZXNrdG9wLm9yZy9z
aG93X2J1Zy5jZ2k/aWQ9MTExOTA5CkZpeGVzOiBjMTEzMjM2NzE4ZTggKCJkcm0vaTkxNTogRXh0
cmFjdCBHVCByZW5kZXIgc2xlZXAgKHJjNikgbWFuYWdlbWVudCIpClRlc3RjYXNlOiBpZ3QvZ2Vt
X2V4ZWNfc3VzcGVuZC9wb3dlci1TMApTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlz
QGNocmlzLXdpbHNvbi5jby51az4KQ2M6IEFuZGkgU2h5dGkgPGFuZGkuc2h5dGlAaW50ZWwuY29t
PgpBY2tlZC1ieTogQW5kaSBTaHl0aSA8YW5kaS5zaHl0aUBpbnRlbC5jb20+Ci0tLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMgICB8ICA0ICsrLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uYyAgICB8IDQ0ICsrKysrKysrKysrKysrKysrKysrLS0t
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uaCAgICB8ICAzICstCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yYzYuYyAgICAgIHwgIDUgKysrCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9ndF9wbS5jIHwgIDIgKy0KIDUgZmlsZXMgY2hhbmdlZCwg
NDkgaW5zZXJ0aW9ucygrKSwgOSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9wbS5jCmluZGV4IDY3NzlhYjM0MTAxYi4uZjg4ZWUxMzE3YmI0IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYwpAQCAtMjcsNyArMjcsNyBAQCB2b2lkIGk5MTVf
Z2VtX3N1c3BlbmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJICogc3RhdGUuIEZv
cnR1bmF0ZWx5LCB0aGUga2VybmVsX2NvbnRleHQgaXMgZGlzcG9zYWJsZSBhbmQgd2UgZG8KIAkg
KiBub3QgcmVseSBvbiBpdHMgc3RhdGUuCiAJICovCi0JaW50ZWxfZ3Rfc3VzcGVuZCgmaTkxNS0+
Z3QpOworCWludGVsX2d0X3N1c3BlbmRfcHJlcGFyZSgmaTkxNS0+Z3QpOwogCiAJaTkxNV9nZW1f
ZHJhaW5fZnJlZWRfb2JqZWN0cyhpOTE1KTsKIH0KQEAgLTY5LDYgKzY5LDggQEAgdm9pZCBpOTE1
X2dlbV9zdXNwZW5kX2xhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJICogbWFj
aGluZSBpbiBhbiB1bnVzYWJsZSBjb25kaXRpb24uCiAJICovCiAKKwlpbnRlbF9ndF9zdXNwZW5k
X2xhdGUoJmk5MTUtPmd0KTsKKwogCXNwaW5fbG9ja19pcnFzYXZlKCZpOTE1LT5tbS5vYmpfbG9j
aywgZmxhZ3MpOwogCWZvciAocGhhc2UgPSBwaGFzZXM7ICpwaGFzZTsgcGhhc2UrKykgewogCQlM
SVNUX0hFQUQoa2VlcCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9ndF9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uYwppbmRleCAx
MTY2MWRlOGM0MGIuLjYzNzQ3NDRiYjY1ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZ3RfcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9n
dF9wbS5jCkBAIC00LDYgKzQsOCBAQAogICogQ29weXJpZ2h0IMKpIDIwMTkgSW50ZWwgQ29ycG9y
YXRpb24KICAqLwogCisjaW5jbHVkZSA8bGludXgvc3VzcGVuZC5oPgorCiAjaW5jbHVkZSAiaTkx
NV9kcnYuaCIKICNpbmNsdWRlICJpOTE1X2dsb2JhbHMuaCIKICNpbmNsdWRlICJpOTE1X3BhcmFt
cy5oIgpAQCAtMjM2LDggKzIzOCwxMSBAQCBpbnQgaW50ZWxfZ3RfcmVzdW1lKHN0cnVjdCBpbnRl
bF9ndCAqZ3QpCiAJcmV0dXJuIGVycjsKIH0KIAotc3RhdGljIHZvaWQgd2FpdF9mb3JfaWRsZShz
dHJ1Y3QgaW50ZWxfZ3QgKmd0KQorc3RhdGljIHZvaWQgd2FpdF9mb3Jfc3VzcGVuZChzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0KQogeworCWlmICghaW50ZWxfZ3RfcG1faXNfYXdha2UoZ3QpKQorCQlyZXR1
cm47CisKIAlpZiAoaW50ZWxfZ3Rfd2FpdF9mb3JfaWRsZShndCwgSTkxNV9HRU1fSURMRV9USU1F
T1VUKSA9PSAtRVRJTUUpIHsKIAkJLyoKIAkJICogRm9yY2libHkgY2FuY2VsIG91dHN0YW5kaW5n
IHdvcmsgYW5kIGxlYXZlCkBAIC0yNDYsMTkgKzI1MSw0NiBAQCBzdGF0aWMgdm9pZCB3YWl0X2Zv
cl9pZGxlKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAJCWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOwog
CX0KIAorCUdFTV9CVUdfT04oYXRvbWljX3JlYWQoJmd0LT51c2VyX3dha2VyZWYpKTsKIAlpbnRl
bF9ndF9wbV93YWl0X2Zvcl9pZGxlKGd0KTsKIH0KIAotdm9pZCBpbnRlbF9ndF9zdXNwZW5kKHN0
cnVjdCBpbnRlbF9ndCAqZ3QpCit2b2lkIGludGVsX2d0X3N1c3BlbmRfcHJlcGFyZShzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0KQogewotCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwotCiAJdXNlcl9mb3Jj
ZXdha2UoZ3QsIHRydWUpOworCXdhaXRfZm9yX3N1c3BlbmQoZ3QpOworCisJaW50ZWxfdWNfc3Vz
cGVuZCgmZ3QtPnVjKTsKK30KKworc3RhdGljIHN1c3BlbmRfc3RhdGVfdCBwbV9zdXNwZW5kX3Rh
cmdldCh2b2lkKQoreworI2lmIElTX0VOQUJMRUQoQ09ORklHX1BNX1NMRUVQKQorCXJldHVybiBw
bV9zdXNwZW5kX3RhcmdldF9zdGF0ZTsKKyNlbHNlCisJcmV0dXJuIFBNX1NVU1BFTkRfVE9fSURM
RTsKKyNlbmRpZgorfQorCit2b2lkIGludGVsX2d0X3N1c3BlbmRfbGF0ZShzdHJ1Y3QgaW50ZWxf
Z3QgKmd0KQoreworCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCiAJLyogV2UgZXhwZWN0IHRv
IGJlIGlkbGUgYWxyZWFkeTsgYnV0IGFsc28gd2FudCB0byBiZSBpbmRlcGVuZGVudCAqLwotCXdh
aXRfZm9yX2lkbGUoZ3QpOworCXdhaXRfZm9yX3N1c3BlbmQoZ3QpOwogCi0JaW50ZWxfdWNfc3Vz
cGVuZCgmZ3QtPnVjKTsKKwkvKgorCSAqIE9uIGRpc2FibGluZyB0aGUgZGV2aWNlLCB3ZSB3YW50
IHRvIHR1cm4gb2ZmIEhXIGFjY2VzcyB0byBtZW1vcnkKKwkgKiB0aGF0IHdlIG5vIGxvbmdlciBv
d24uCisJICoKKwkgKiBIb3dldmVyLCBub3QgYWxsIHN1c3BlbmQtc3RhdGVzIGRpc2FibGUgdGhl
IGRldmljZS4gUzAgKHMyaWRsZSkKKwkgKiBpcyBlZmZlY3RpdmVseSBydW50aW1lLXN1c3BlbmQs
IHRoZSBkZXZpY2UgaXMgbGVmdCBwb3dlcmVkIG9uCisJICogYnV0IG5lZWRzIHRvIGJlIHB1dCBp
bnRvIGEgbG93IHBvd2VyIHN0YXRlLiBXZSBuZWVkIHRvIGtlZXAKKwkgKiBwb3dlcm1hbmFnZW1l
bnQgZW5hYmxlZCwgYnV0IHdlIGFsc28gcmV0YWluIHN5c3RlbSBzdGF0ZSBhbmQgc28KKwkgKiBp
dCByZW1haW5zIHNhZmUgdG8ga2VlcCBvbiB1c2luZyBvdXIgYWxsb2NhdGVkIG1lbW9yeS4KKwkg
Ki8KKwlpZiAocG1fc3VzcGVuZF90YXJnZXQoKSA9PSBQTV9TVVNQRU5EX1RPX0lETEUpCisJCXJl
dHVybjsKIAogCXdpdGhfaW50ZWxfcnVudGltZV9wbShndC0+dW5jb3JlLT5ycG0sIHdha2VyZWYp
IHsKIAkJaW50ZWxfcnBzX2Rpc2FibGUoJmd0LT5ycHMpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2d0X3BtLmgKaW5kZXggZDkyNGM5ODRjNzRkLi5iM2UxNzM5OWJlOWIgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmgKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uaApAQCAtNDMsOCArNDMsOSBAQCB2b2lkIGludGVsX2d0
X3BtX2Zpbmkoc3RydWN0IGludGVsX2d0ICpndCk7CiAKIHZvaWQgaW50ZWxfZ3Rfc2FuaXRpemUo
c3RydWN0IGludGVsX2d0ICpndCwgYm9vbCBmb3JjZSk7CiAKK3ZvaWQgaW50ZWxfZ3Rfc3VzcGVu
ZF9wcmVwYXJlKHN0cnVjdCBpbnRlbF9ndCAqZ3QpOwordm9pZCBpbnRlbF9ndF9zdXNwZW5kX2xh
dGUoc3RydWN0IGludGVsX2d0ICpndCk7CiBpbnQgaW50ZWxfZ3RfcmVzdW1lKHN0cnVjdCBpbnRl
bF9ndCAqZ3QpOwotdm9pZCBpbnRlbF9ndF9zdXNwZW5kKHN0cnVjdCBpbnRlbF9ndCAqZ3QpOwog
CiB2b2lkIGludGVsX2d0X3J1bnRpbWVfc3VzcGVuZChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KTsKIGlu
dCBpbnRlbF9ndF9ydW50aW1lX3Jlc3VtZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0KTsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JjNi5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfcmM2LmMKaW5kZXggNzBmMGUwMWEzOGI5Li41YWQ0YTkyYTk1ODIgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JjNi5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JjNi5jCkBAIC01MjUsNiArNTI1LDExIEBAIHZvaWQg
aW50ZWxfcmM2X2luaXQoc3RydWN0IGludGVsX3JjNiAqcmM2KQogCiB2b2lkIGludGVsX3JjNl9z
YW5pdGl6ZShzdHJ1Y3QgaW50ZWxfcmM2ICpyYzYpCiB7CisJaWYgKHJjNi0+ZW5hYmxlZCkgeyAv
KiB1bmJhbGFuY2VkIHN1c3BlbmQvcmVzdW1lICovCisJCXJwbV9nZXQocmM2KTsKKwkJcmM2LT5l
bmFibGVkID0gZmFsc2U7CisJfQorCiAJaWYgKHJjNi0+c3VwcG9ydGVkKQogCQlfX2ludGVsX3Jj
Nl9kaXNhYmxlKHJjNik7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9z
ZWxmdGVzdF9ndF9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZ3RfcG0u
YwppbmRleCA1ZDQyOTAzN2NkYWQuLjNkNGU2YTAwOGFmOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZ3RfcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF9ndF9wbS5jCkBAIC0xNSw3ICsxNSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9n
dF9yZXN1bWUodm9pZCAqYXJnKQogCiAJLyogRG8gc2V2ZXJhbCBzdXNwZW5kL3Jlc3VtZSBjeWNs
ZXMgdG8gY2hlY2sgd2UgZG9uJ3QgZXhwbG9kZSEgKi8KIAlkbyB7Ci0JCWludGVsX2d0X3N1c3Bl
bmQoZ3QpOworCQlpbnRlbF9ndF9zdXNwZW5kX2xhdGUoZ3QpOwogCiAJCWlmIChndC0+cmM2LmVu
YWJsZWQpIHsKIAkJCXByX2VycigicmM2IHN0aWxsIGVuYWJsZWQgYWZ0ZXIgc3VzcGVuZCFcbiIp
OwotLSAKMi4yNC4wLnJjMgoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50
ZWwtZ2Z4

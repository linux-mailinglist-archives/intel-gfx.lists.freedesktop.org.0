Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 635BADD2D3
	for <lists+intel-gfx@lfdr.de>; Sat, 19 Oct 2019 00:15:21 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 694E289E32;
	Fri, 18 Oct 2019 22:15:13 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 053BF89E01
 for <intel-gfx@lists.freedesktop.org>; Fri, 18 Oct 2019 22:15:05 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18887730-1500050 
 for multiple; Fri, 18 Oct 2019 23:14:52 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 18 Oct 2019 23:14:45 +0100
Message-Id: <20191018221450.26247-8-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191018221450.26247-1-chris@chris-wilson.co.uk>
References: <20191018221450.26247-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 08/13] drm/i915/execlists: Cancel banned
 contexts on schedule-out
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

T24gc2NoZWR1bGUtb3V0IChDUyBjb21wbGV0aW9uKSBvZiBhIGJhbm5lZCBjb250ZXh0LCBzY3J1
YiB0aGUgY29udGV4dAppbWFnZSBzbyB0aGF0IHdlIGRvIG5vdCByZXBsYXkgdGhlIGFjdGl2ZSBw
YXlsb2FkLiBUaGUgaW50ZW50IGlzIHRoYXQgd2UKc2tpcCBiYW5uZWQgcGF5bG9hZHMgb24gcmVx
dWVzdCBzdWJtaXNzaW9uIHNvIHRoYXQgdGhlIHRpbWVsaW5lCmFkdmFuY2VtZW50IGNvbnRpbnVl
cyBvbiBpbiB0aGUgYmFja2dyb3VuZC4gSG93ZXZlciwgaWYgd2UgYXJlIHJldHVybmluZwp0byBh
IHByZWVtcHRlZCByZXF1ZXN0LCBpOTE1X3JlcXVlc3Rfc2tpcCgpIGlzIGluZWZmZWN0aXZlIGFu
ZCBpbnN0ZWFkIHdlCm5lZWQgdG8gcGF0Y2ggdXAgdGhlIGNvbnRleHQgaW1hZ2Ugc28gdGhhdCBp
dCBjb250aW51ZXMgZnJvbSB0aGUgc3RhcnQKb2YgdGhlIG5leHQgcmVxdWVzdC4KCnYyOiBGaXh1
cCBjYW5jZWxsYXRpb24gc28gdGhhdCB3ZSBvbmx5IHNjcnViIHRoZSBwYXlsb2FkIG9mIHRoZSBh
Y3RpdmUKcmVxdWVzdCBhbmQgZG8gbm90IHNob3J0LWNpcmN1aXQgdGhlIGJyZWFkY3J1bWJzICh3
aGljaCBtaWdodCBjYXVzZQpvdGhlciBjb250ZXh0cyB0byBleGVjdXRlIG91dCBvZiBvcmRlciku
CnYzOiBHcmFtbWFyIHBhc3MKClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hy
aXMtd2lsc29uLmNvLnVrPgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVs
LmNvbT4KUmV2aWV3ZWQtYnk6IFR2cnRrbyBVcnN1bGluIDx0dnJ0a28udXJzdWxpbkBpbnRlbC5j
b20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgICAgfCAxMzQgKysr
KysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jIHwgMzIxICsr
KysrKysrKysrKysrKysrKysrKysrKysKIDIgZmlsZXMgY2hhbmdlZCwgNDE0IGluc2VydGlvbnMo
KyksIDQxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKaW5kZXgg
MzE2MTlmMmJiMWI5Li5jYjE5ZDdkN2FiOTEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xy
Yy5jCkBAIC0yMzQsNiArMjM0LDkgQEAgc3RhdGljIHZvaWQgZXhlY2xpc3RzX2luaXRfcmVnX3N0
YXRlKHUzMiAqcmVnX3N0YXRlLAogCQkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lLAogCQkJCSAgICAgY29uc3Qgc3RydWN0IGludGVsX3JpbmcgKnJpbmcsCiAJCQkJ
ICAgICBib29sIGNsb3NlKTsKK3N0YXRpYyB2b2lkCitfX2V4ZWNsaXN0c191cGRhdGVfcmVnX3N0
YXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKKwkJCSAgICAgY29uc3Qgc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKTsKIAogc3RhdGljIHZvaWQgX19jb250ZXh0X3Bpbl9h
Y3F1aXJlKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIHsKQEAgLTI1Niw2ICsyNTksMzEgQEAg
c3RhdGljIHZvaWQgbWFya19laW8oc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJaTkxNV9yZXF1
ZXN0X21hcmtfY29tcGxldGUocnEpOwogfQogCitzdGF0aWMgc3RydWN0IGk5MTVfcmVxdWVzdCAq
YWN0aXZlX3JlcXVlc3Qoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCit7CisJY29uc3Qgc3RydWN0
IGludGVsX2NvbnRleHQgKiBjb25zdCBjZSA9IHJxLT5od19jb250ZXh0OworCXN0cnVjdCBpOTE1
X3JlcXVlc3QgKmFjdGl2ZSA9IE5VTEw7CisJc3RydWN0IGxpc3RfaGVhZCAqbGlzdDsKKworCWlm
ICghaTkxNV9yZXF1ZXN0X2lzX2FjdGl2ZShycSkpIC8qIHVud291bmQsIGJ1dCBpbmNvbXBsZXRl
ISAqLworCQlyZXR1cm4gcnE7CisKKwlyY3VfcmVhZF9sb2NrKCk7CisJbGlzdCA9ICZyY3VfZGVy
ZWZlcmVuY2UocnEtPnRpbWVsaW5lKS0+cmVxdWVzdHM7CisJbGlzdF9mb3JfZWFjaF9lbnRyeV9m
cm9tX3JldmVyc2UocnEsIGxpc3QsIGxpbmspIHsKKwkJaWYgKGk5MTVfcmVxdWVzdF9jb21wbGV0
ZWQocnEpKQorCQkJYnJlYWs7CisKKwkJaWYgKHJxLT5od19jb250ZXh0ICE9IGNlKQorCQkJYnJl
YWs7CisKKwkJYWN0aXZlID0gcnE7CisJfQorCXJjdV9yZWFkX3VubG9jaygpOworCisJcmV0dXJu
IGFjdGl2ZTsKK30KKwogc3RhdGljIGlubGluZSB1MzIgaW50ZWxfaHdzX3ByZWVtcHRfYWRkcmVz
cyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7CiAJcmV0dXJuIChpOTE1X2dndHRf
b2Zmc2V0KGVuZ2luZS0+c3RhdHVzX3BhZ2Uudm1hKSArCkBAIC05ODIsNiArMTAxMCw2MSBAQCBz
dGF0aWMgdm9pZCBraWNrX3NpYmxpbmdzKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBzdHJ1Y3Qg
aW50ZWxfY29udGV4dCAqY2UpCiAJCXRhc2tsZXRfc2NoZWR1bGUoJnZlLT5iYXNlLmV4ZWNsaXN0
cy50YXNrbGV0KTsKIH0KIAorc3RhdGljIHZvaWQgcmVzdG9yZV9kZWZhdWx0X3N0YXRlKHN0cnVj
dCBpbnRlbF9jb250ZXh0ICpjZSwKKwkJCQkgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZSkKK3sKKwl1MzIgKnJlZ3MgPSBjZS0+bHJjX3JlZ19zdGF0ZTsKKworCWlmIChlbmdpbmUtPnBp
bm5lZF9kZWZhdWx0X3N0YXRlKQorCQltZW1jcHkocmVncywgLyogc2tpcCByZXN0b3JpbmcgdGhl
IHZhbmlsbGEgUFBIV1NQICovCisJCSAgICAgICBlbmdpbmUtPnBpbm5lZF9kZWZhdWx0X3N0YXRl
ICsgTFJDX1NUQVRFX1BOICogUEFHRV9TSVpFLAorCQkgICAgICAgZW5naW5lLT5jb250ZXh0X3Np
emUgLSBQQUdFX1NJWkUpOworCisJZXhlY2xpc3RzX2luaXRfcmVnX3N0YXRlKHJlZ3MsIGNlLCBl
bmdpbmUsIGNlLT5yaW5nLCBmYWxzZSk7Cit9CisKK3N0YXRpYyB2b2lkIHJlc2V0X2FjdGl2ZShz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKKwkJCSBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmUpCit7CisJc3RydWN0IGludGVsX2NvbnRleHQgKiBjb25zdCBjZSA9IHJxLT5od19jb250ZXh0
OworCisJLyoKKwkgKiBUaGUgZXhlY3V0aW5nIGNvbnRleHQgaGFzIGJlZW4gY2FuY2VsbGVkLiBX
ZSB3YW50IHRvIHByZXZlbnQKKwkgKiBmdXJ0aGVyIGV4ZWN1dGlvbiBhbG9uZyB0aGlzIGNvbnRl
eHQgYW5kIHByb3BhZ2F0ZSB0aGUgZXJyb3Igb24KKwkgKiB0byBhbnl0aGluZyBkZXBlbmRpbmcg
b24gaXRzIHJlc3VsdHMuCisJICoKKwkgKiBJbiBfX2k5MTVfcmVxdWVzdF9zdWJtaXQoKSwgd2Ug
YXBwbHkgdGhlIC1FSU8gYW5kIHJlbW92ZSB0aGUKKwkgKiByZXF1ZXN0cycgcGF5bG9hZHMgZm9y
IGFueSBiYW5uZWQgcmVxdWVzdHMuIEJ1dCBmaXJzdCwgd2UgbXVzdAorCSAqIHJld2luZCB0aGUg
Y29udGV4dCBiYWNrIHRvIHRoZSBzdGFydCBvZiB0aGUgaW5jb21wbGV0ZSByZXF1ZXN0IHNvCisJ
ICogdGhhdCB3ZSBkbyBub3QganVtcCBiYWNrIGludG8gdGhlIG1pZGRsZSBvZiB0aGUgYmF0Y2gu
CisJICoKKwkgKiBXZSBwcmVzZXJ2ZSB0aGUgYnJlYWRjcnVtYnMgYW5kIHNlbWFwaG9yZXMgb2Yg
dGhlIGluY29tcGxldGUKKwkgKiByZXF1ZXN0cyBzbyB0aGF0IGludGVyLXRpbWVsaW5lIGRlcGVu
ZGVuY2llcyAoaS5lIG90aGVyIHRpbWVsaW5lcykKKwkgKiByZW1haW4gY29ycmVjdGx5IG9yZGVy
ZWQuIEFuZCB3ZSBkZWZlciB0byBfX2k5MTVfcmVxdWVzdF9zdWJtaXQoKQorCSAqIHNvIHRoYXQg
YWxsIGFzeW5jaHJvbm91cyB3YWl0cyBhcmUgY29ycmVjdGx5IGhhbmRsZWQuCisJICovCisJR0VN
X1RSQUNFKCIlcyglcyk6IHsgcnE9JWxseDolbGxkIH1cbiIsCisJCSAgX19mdW5jX18sIGVuZ2lu
ZS0+bmFtZSwgcnEtPmZlbmNlLmNvbnRleHQsIHJxLT5mZW5jZS5zZXFubyk7CisJX19jb250ZXh0
X3Bpbl9hY3F1aXJlKGNlKTsKKworCS8qIE9uIHJlc3VibWlzc2lvbiBvZiB0aGUgYWN0aXZlIHJl
cXVlc3QsIHBheWxvYWQgd2lsbCBiZSBzY3J1YmJlZCAqLworCXJxID0gYWN0aXZlX3JlcXVlc3Qo
cnEpOworCWlmIChycSkKKwkJY2UtPnJpbmctPmhlYWQgPSBpbnRlbF9yaW5nX3dyYXAoY2UtPnJp
bmcsIHJxLT5oZWFkKTsKKwllbHNlCisJCWNlLT5yaW5nLT5oZWFkID0gY2UtPnJpbmctPnRhaWw7
CisJaW50ZWxfcmluZ191cGRhdGVfc3BhY2UoY2UtPnJpbmcpOworCisJLyogU2NydWIgdGhlIGNv
bnRleHQgaW1hZ2UgdG8gcHJldmVudCByZXBsYXlpbmcgdGhlIHByZXZpb3VzIGJhdGNoICovCisJ
cmVzdG9yZV9kZWZhdWx0X3N0YXRlKGNlLCBlbmdpbmUpOworCV9fZXhlY2xpc3RzX3VwZGF0ZV9y
ZWdfc3RhdGUoY2UsIGVuZ2luZSk7CisKKwkvKiBXZSd2ZSBzd2l0Y2hlZCBhd2F5LCBzbyB0aGlz
IHNob3VsZCBiZSBhIG5vLW9wLCBidXQgaW50ZW50IG1hdHRlcnMgKi8KKwljZS0+bHJjX2Rlc2Mg
fD0gQ1RYX0RFU0NfRk9SQ0VfUkVTVE9SRTsKKworCV9fY29udGV4dF9waW5fcmVsZWFzZShjZSk7
Cit9CisKIHN0YXRpYyBpbmxpbmUgdm9pZAogX19leGVjbGlzdHNfc2NoZWR1bGVfb3V0KHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxLAogCQkJIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKiBjb25zdCBl
bmdpbmUpCkBAIC05OTIsNiArMTA3NSw5IEBAIF9fZXhlY2xpc3RzX3NjaGVkdWxlX291dChzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycSwKIAlleGVjbGlzdHNfY29udGV4dF9zdGF0dXNfY2hhbmdlKHJx
LCBJTlRFTF9DT05URVhUX1NDSEVEVUxFX09VVCk7CiAJaW50ZWxfZ3RfcG1fcHV0KGVuZ2luZS0+
Z3QpOwogCisJaWYgKHVubGlrZWx5KGk5MTVfZ2VtX2NvbnRleHRfaXNfYmFubmVkKGNlLT5nZW1f
Y29udGV4dCkpKQorCQlyZXNldF9hY3RpdmUocnEsIGVuZ2luZSk7CisKIAkvKgogCSAqIElmIHRo
aXMgaXMgcGFydCBvZiBhIHZpcnR1YWwgZW5naW5lLCBpdHMgbmV4dCByZXF1ZXN0IG1heQogCSAq
IGhhdmUgYmVlbiBibG9ja2VkIHdhaXRpbmcgZm9yIGFjY2VzcyB0byB0aGUgYWN0aXZlIGNvbnRl
eHQuCkBAIC0xNDIxLDYgKzE1MDcsMTAgQEAgc3RhdGljIHVuc2lnbmVkIGxvbmcgYWN0aXZlX3By
ZWVtcHRfdGltZW91dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJaWYgKCFycSkK
IAkJcmV0dXJuIDA7CiAKKwkvKiBGb3JjZSBhIGZhc3QgcmVzZXQgZm9yIHRlcm1pbmF0ZWQgY29u
dGV4dHMgKGlnbm9yaW5nIHN5c2ZzISkgKi8KKwlpZiAodW5saWtlbHkoaTkxNV9nZW1fY29udGV4
dF9pc19iYW5uZWQocnEtPmdlbV9jb250ZXh0KSkpCisJCXJldHVybiAxOworCiAJcmV0dXJuIFJF
QURfT05DRShlbmdpbmUtPnByb3BzLnByZWVtcHRfdGltZW91dF9tcyk7CiB9CiAKQEAgLTI4NDgs
MjkgKzI5MzgsNiBAQCBzdGF0aWMgdm9pZCByZXNldF9jc2JfcG9pbnRlcnMoc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lKQogCQkJICAgICAgICZleGVjbGlzdHMtPmNzYl9zdGF0dXNbcmVz
ZXRfdmFsdWVdKTsKIH0KIAotc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3QgKmFjdGl2ZV9yZXF1
ZXN0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQotewotCWNvbnN0IHN0cnVjdCBpbnRlbF9jb250
ZXh0ICogY29uc3QgY2UgPSBycS0+aHdfY29udGV4dDsKLQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICph
Y3RpdmUgPSBOVUxMOwotCXN0cnVjdCBsaXN0X2hlYWQgKmxpc3Q7Ci0KLQlpZiAoIWk5MTVfcmVx
dWVzdF9pc19hY3RpdmUocnEpKSAvKiB1bndvdW5kLCBidXQgaW5jb21wbGV0ZSEgKi8KLQkJcmV0
dXJuIHJxOwotCi0JbGlzdCA9ICZpOTE1X3JlcXVlc3RfYWN0aXZlX3RpbWVsaW5lKHJxKS0+cmVx
dWVzdHM7Ci0JbGlzdF9mb3JfZWFjaF9lbnRyeV9mcm9tX3JldmVyc2UocnEsIGxpc3QsIGxpbmsp
IHsKLQkJaWYgKGk5MTVfcmVxdWVzdF9jb21wbGV0ZWQocnEpKQotCQkJYnJlYWs7Ci0KLQkJaWYg
KHJxLT5od19jb250ZXh0ICE9IGNlKQotCQkJYnJlYWs7Ci0KLQkJYWN0aXZlID0gcnE7Ci0JfQot
Ci0JcmV0dXJuIGFjdGl2ZTsKLX0KLQogc3RhdGljIHZvaWQgX19leGVjbGlzdHNfcmVzZXRfcmVn
X3N0YXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKIAkJCQkJY29uc3Qgc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewpAQCAtMjg4Nyw3ICsyOTU0LDYgQEAgc3RhdGlj
IHZvaWQgX19leGVjbGlzdHNfcmVzZXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBi
b29sIHN0YWxsZWQpCiAJc3RydWN0IGludGVsX2VuZ2luZV9leGVjbGlzdHMgKiBjb25zdCBleGVj
bGlzdHMgPSAmZW5naW5lLT5leGVjbGlzdHM7CiAJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwog
CXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwotCXUzMiAqcmVnczsKIAogCW1iKCk7IC8qIHBhcmFu
b2lhOiByZWFkIHRoZSBDU0IgcG9pbnRlcnMgZnJvbSBhZnRlciB0aGUgcmVzZXQgKi8KIAljbGZs
dXNoKGV4ZWNsaXN0cy0+Y3NiX3dyaXRlKTsKQEAgLTI5NjYsMTMgKzMwMzIsNyBAQCBzdGF0aWMg
dm9pZCBfX2V4ZWNsaXN0c19yZXNldChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIGJv
b2wgc3RhbGxlZCkKIAkgKiB0byByZWNyZWF0ZSBpdHMgb3duIHN0YXRlLgogCSAqLwogCUdFTV9C
VUdfT04oIWludGVsX2NvbnRleHRfaXNfcGlubmVkKGNlKSk7Ci0JcmVncyA9IGNlLT5scmNfcmVn
X3N0YXRlOwotCWlmIChlbmdpbmUtPnBpbm5lZF9kZWZhdWx0X3N0YXRlKSB7Ci0JCW1lbWNweShy
ZWdzLCAvKiBza2lwIHJlc3RvcmluZyB0aGUgdmFuaWxsYSBQUEhXU1AgKi8KLQkJICAgICAgIGVu
Z2luZS0+cGlubmVkX2RlZmF1bHRfc3RhdGUgKyBMUkNfU1RBVEVfUE4gKiBQQUdFX1NJWkUsCi0J
CSAgICAgICBlbmdpbmUtPmNvbnRleHRfc2l6ZSAtIFBBR0VfU0laRSk7Ci0JfQotCWV4ZWNsaXN0
c19pbml0X3JlZ19zdGF0ZShyZWdzLCBjZSwgZW5naW5lLCBjZS0+cmluZywgZmFsc2UpOworCXJl
c3RvcmVfZGVmYXVsdF9zdGF0ZShjZSwgZW5naW5lKTsKIAogb3V0X3JlcGxheToKIAlHRU1fVFJB
Q0UoIiVzIHJlcGxheSB7aGVhZDolMDR4LCB0YWlsOiUwNHhcbiIsCkBAIC00NjM1LDE2ICs0Njk1
LDggQEAgdm9pZCBpbnRlbF9scl9jb250ZXh0X3Jlc2V0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZSwKIAkgKiBmdXR1cmUgcmVxdWVzdCB3aWxsIGJlIGFmdGVyIHVzZXJzcGFjZSBoYXMg
aGFkIHRoZSBvcHBvcnR1bml0eQogCSAqIHRvIHJlY3JlYXRlIGl0cyBvd24gc3RhdGUuCiAJICov
Ci0JaWYgKHNjcnViKSB7Ci0JCXUzMiAqcmVncyA9IGNlLT5scmNfcmVnX3N0YXRlOwotCi0JCWlm
IChlbmdpbmUtPnBpbm5lZF9kZWZhdWx0X3N0YXRlKSB7Ci0JCQltZW1jcHkocmVncywgLyogc2tp
cCByZXN0b3JpbmcgdGhlIHZhbmlsbGEgUFBIV1NQICovCi0JCQkgICAgICAgZW5naW5lLT5waW5u
ZWRfZGVmYXVsdF9zdGF0ZSArIExSQ19TVEFURV9QTiAqIFBBR0VfU0laRSwKLQkJCSAgICAgICBl
bmdpbmUtPmNvbnRleHRfc2l6ZSAtIFBBR0VfU0laRSk7Ci0JCX0KLQkJZXhlY2xpc3RzX2luaXRf
cmVnX3N0YXRlKHJlZ3MsIGNlLCBlbmdpbmUsIGNlLT5yaW5nLCBmYWxzZSk7Ci0JfQorCWlmIChz
Y3J1YikKKwkJcmVzdG9yZV9kZWZhdWx0X3N0YXRlKGNlLCBlbmdpbmUpOwogCiAJLyogUmVydW4g
dGhlIHJlcXVlc3Q7IGl0cyBwYXlsb2FkIGhhcyBiZWVuIG5ldXRlcmVkIChpZiBndWlsdHkpLiAq
LwogCWNlLT5yaW5nLT5oZWFkID0gaGVhZDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
bHJjLmMKaW5kZXggMzMyNTdiNWYwNTU1Li5lNWFjZTk5MjI3NGEgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCkBAIC03LDYgKzcsNyBAQAogI2luY2x1ZGUgPGxpbnV4L3By
aW1lX251bWJlcnMuaD4KIAogI2luY2x1ZGUgImdlbS9pOTE1X2dlbV9wbS5oIgorI2luY2x1ZGUg
Imd0L2ludGVsX2VuZ2luZV9oZWFydGJlYXQuaCIKICNpbmNsdWRlICJndC9pbnRlbF9yZXNldC5o
IgogCiAjaW5jbHVkZSAiaTkxNV9zZWxmdGVzdC5oIgpAQCAtMTE2OSw2ICsxMTcwLDMyNSBAQCBz
dGF0aWMgaW50IGxpdmVfbm9wcmVlbXB0KHZvaWQgKmFyZykKIAlnb3RvIGVycl9jbGllbnRfYjsK
IH0KIAorc3RydWN0IGxpdmVfcHJlZW1wdF9jYW5jZWwgeworCXN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmVuZ2luZTsKKwlzdHJ1Y3QgcHJlZW1wdF9jbGllbnQgYSwgYjsKK307CisKK3N0YXRpYyBp
bnQgX19jYW5jZWxfYWN0aXZlMChzdHJ1Y3QgbGl2ZV9wcmVlbXB0X2NhbmNlbCAqYXJnKQorewor
CXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7CisJaW50
IGVycjsKKworCS8qIFByZWVtcHQgY2FuY2VsIG9mIEVMU1AwICovCisJR0VNX1RSQUNFKCIlcygl
cylcbiIsIF9fZnVuY19fLCBhcmctPmVuZ2luZS0+bmFtZSk7CisJaWYgKGlndF9saXZlX3Rlc3Rf
YmVnaW4oJnQsIGFyZy0+ZW5naW5lLT5ndCwKKwkJCQlfX2Z1bmNfXywgYXJnLT5lbmdpbmUtPm5h
bWUpKQorCQlyZXR1cm4gLUVJTzsKKworCWNsZWFyX2JpdChDT05URVhUX0JBTk5FRCwgJmFyZy0+
YS5jdHgtPmZsYWdzKTsKKwlycSA9IHNwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJmFyZy0+YS5zcGlu
LAorCQkJCSAgICBhcmctPmEuY3R4LCBhcmctPmVuZ2luZSwKKwkJCQkgICAgTUlfQVJCX0NIRUNL
KTsKKwlpZiAoSVNfRVJSKHJxKSkKKwkJcmV0dXJuIFBUUl9FUlIocnEpOworCisJaTkxNV9yZXF1
ZXN0X2dldChycSk7CisJaTkxNV9yZXF1ZXN0X2FkZChycSk7CisJaWYgKCFpZ3Rfd2FpdF9mb3Jf
c3Bpbm5lcigmYXJnLT5hLnNwaW4sIHJxKSkgeworCQllcnIgPSAtRUlPOworCQlnb3RvIG91dDsK
Kwl9CisKKwlpOTE1X2dlbV9jb250ZXh0X3NldF9iYW5uZWQoYXJnLT5hLmN0eCk7CisJZXJyID0g
aW50ZWxfZW5naW5lX3B1bHNlKGFyZy0+ZW5naW5lKTsKKwlpZiAoZXJyKQorCQlnb3RvIG91dDsK
KworCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChycSwgMCwgSFogLyA1KSA8IDApIHsKKwkJZXJyID0g
LUVJTzsKKwkJZ290byBvdXQ7CisJfQorCisJaWYgKHJxLT5mZW5jZS5lcnJvciAhPSAtRUlPKSB7
CisJCXByX2VycigiQ2FuY2VsbGVkIGluZmxpZ2h0MCByZXF1ZXN0IGRpZCBub3QgcmVwb3J0IC1F
SU9cbiIpOworCQllcnIgPSAtRUlOVkFMOworCQlnb3RvIG91dDsKKwl9CisKK291dDoKKwlpOTE1
X3JlcXVlc3RfcHV0KHJxKTsKKwlpZiAoaWd0X2xpdmVfdGVzdF9lbmQoJnQpKQorCQllcnIgPSAt
RUlPOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQgX19jYW5jZWxfYWN0aXZlMShzdHJ1
Y3QgbGl2ZV9wcmVlbXB0X2NhbmNlbCAqYXJnKQoreworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
WzJdID0ge307CisJc3RydWN0IGlndF9saXZlX3Rlc3QgdDsKKwlpbnQgZXJyOworCisJLyogUHJl
ZW1wdCBjYW5jZWwgb2YgRUxTUDEgKi8KKwlHRU1fVFJBQ0UoIiVzKCVzKVxuIiwgX19mdW5jX18s
IGFyZy0+ZW5naW5lLT5uYW1lKTsKKwlpZiAoaWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgYXJnLT5l
bmdpbmUtPmd0LAorCQkJCV9fZnVuY19fLCBhcmctPmVuZ2luZS0+bmFtZSkpCisJCXJldHVybiAt
RUlPOworCisJY2xlYXJfYml0KENPTlRFWFRfQkFOTkVELCAmYXJnLT5hLmN0eC0+ZmxhZ3MpOwor
CXJxWzBdID0gc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmYXJnLT5hLnNwaW4sCisJCQkJICAgICAg
IGFyZy0+YS5jdHgsIGFyZy0+ZW5naW5lLAorCQkJCSAgICAgICBNSV9OT09QKTsgLyogbm8gcHJl
ZW1wdGlvbiAqLworCWlmIChJU19FUlIocnFbMF0pKQorCQlyZXR1cm4gUFRSX0VSUihycVswXSk7
CisKKwlpOTE1X3JlcXVlc3RfZ2V0KHJxWzBdKTsKKwlpOTE1X3JlcXVlc3RfYWRkKHJxWzBdKTsK
KwlpZiAoIWlndF93YWl0X2Zvcl9zcGlubmVyKCZhcmctPmEuc3BpbiwgcnFbMF0pKSB7CisJCWVy
ciA9IC1FSU87CisJCWdvdG8gb3V0OworCX0KKworCWNsZWFyX2JpdChDT05URVhUX0JBTk5FRCwg
JmFyZy0+Yi5jdHgtPmZsYWdzKTsKKwlycVsxXSA9IHNwaW5uZXJfY3JlYXRlX3JlcXVlc3QoJmFy
Zy0+Yi5zcGluLAorCQkJCSAgICAgICBhcmctPmIuY3R4LCBhcmctPmVuZ2luZSwKKwkJCQkgICAg
ICAgTUlfQVJCX0NIRUNLKTsKKwlpZiAoSVNfRVJSKHJxWzFdKSkgeworCQllcnIgPSBQVFJfRVJS
KHJxWzFdKTsKKwkJZ290byBvdXQ7CisJfQorCisJaTkxNV9yZXF1ZXN0X2dldChycVsxXSk7CisJ
ZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X2RtYV9mZW5jZShycVsxXSwgJnJxWzBdLT5mZW5jZSk7
CisJaTkxNV9yZXF1ZXN0X2FkZChycVsxXSk7CisJaWYgKGVycikKKwkJZ290byBvdXQ7CisKKwlp
OTE1X2dlbV9jb250ZXh0X3NldF9iYW5uZWQoYXJnLT5iLmN0eCk7CisJZXJyID0gaW50ZWxfZW5n
aW5lX3B1bHNlKGFyZy0+ZW5naW5lKTsKKwlpZiAoZXJyKQorCQlnb3RvIG91dDsKKworCWlndF9z
cGlubmVyX2VuZCgmYXJnLT5hLnNwaW4pOworCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChycVsxXSwg
MCwgSFogLyA1KSA8IDApIHsKKwkJZXJyID0gLUVJTzsKKwkJZ290byBvdXQ7CisJfQorCisJaWYg
KHJxWzBdLT5mZW5jZS5lcnJvciAhPSAwKSB7CisJCXByX2VycigiTm9ybWFsIGluZmxpZ2h0MCBy
ZXF1ZXN0IGRpZCBub3QgY29tcGxldGVcbiIpOworCQllcnIgPSAtRUlOVkFMOworCQlnb3RvIG91
dDsKKwl9CisKKwlpZiAocnFbMV0tPmZlbmNlLmVycm9yICE9IC1FSU8pIHsKKwkJcHJfZXJyKCJD
YW5jZWxsZWQgaW5mbGlnaHQxIHJlcXVlc3QgZGlkIG5vdCByZXBvcnQgLUVJT1xuIik7CisJCWVy
ciA9IC1FSU5WQUw7CisJCWdvdG8gb3V0OworCX0KKworb3V0OgorCWk5MTVfcmVxdWVzdF9wdXQo
cnFbMV0pOworCWk5MTVfcmVxdWVzdF9wdXQocnFbMF0pOworCWlmIChpZ3RfbGl2ZV90ZXN0X2Vu
ZCgmdCkpCisJCWVyciA9IC1FSU87CisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIGludCBfX2Nh
bmNlbF9xdWV1ZWQoc3RydWN0IGxpdmVfcHJlZW1wdF9jYW5jZWwgKmFyZykKK3sKKwlzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycVszXSA9IHt9OworCXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7CisJaW50
IGVycjsKKworCS8qIEZ1bGwgRUxTUCBhbmQgb25lIGluIHRoZSB3aW5ncyAqLworCUdFTV9UUkFD
RSgiJXMoJXMpXG4iLCBfX2Z1bmNfXywgYXJnLT5lbmdpbmUtPm5hbWUpOworCWlmIChpZ3RfbGl2
ZV90ZXN0X2JlZ2luKCZ0LCBhcmctPmVuZ2luZS0+Z3QsCisJCQkJX19mdW5jX18sIGFyZy0+ZW5n
aW5lLT5uYW1lKSkKKwkJcmV0dXJuIC1FSU87CisKKwljbGVhcl9iaXQoQ09OVEVYVF9CQU5ORUQs
ICZhcmctPmEuY3R4LT5mbGFncyk7CisJcnFbMF0gPSBzcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZh
cmctPmEuc3BpbiwKKwkJCQkgICAgICAgYXJnLT5hLmN0eCwgYXJnLT5lbmdpbmUsCisJCQkJICAg
ICAgIE1JX0FSQl9DSEVDSyk7CisJaWYgKElTX0VSUihycVswXSkpCisJCXJldHVybiBQVFJfRVJS
KHJxWzBdKTsKKworCWk5MTVfcmVxdWVzdF9nZXQocnFbMF0pOworCWk5MTVfcmVxdWVzdF9hZGQo
cnFbMF0pOworCWlmICghaWd0X3dhaXRfZm9yX3NwaW5uZXIoJmFyZy0+YS5zcGluLCBycVswXSkp
IHsKKwkJZXJyID0gLUVJTzsKKwkJZ290byBvdXQ7CisJfQorCisJY2xlYXJfYml0KENPTlRFWFRf
QkFOTkVELCAmYXJnLT5iLmN0eC0+ZmxhZ3MpOworCXJxWzFdID0gaWd0X3JlcXVlc3RfYWxsb2Mo
YXJnLT5iLmN0eCwgYXJnLT5lbmdpbmUpOworCWlmIChJU19FUlIocnFbMV0pKSB7CisJCWVyciA9
IFBUUl9FUlIocnFbMV0pOworCQlnb3RvIG91dDsKKwl9CisKKwlpOTE1X3JlcXVlc3RfZ2V0KHJx
WzFdKTsKKwllcnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfZG1hX2ZlbmNlKHJxWzFdLCAmcnFbMF0t
PmZlbmNlKTsKKwlpOTE1X3JlcXVlc3RfYWRkKHJxWzFdKTsKKwlpZiAoZXJyKQorCQlnb3RvIG91
dDsKKworCXJxWzJdID0gc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmYXJnLT5iLnNwaW4sCisJCQkJ
ICAgICAgIGFyZy0+YS5jdHgsIGFyZy0+ZW5naW5lLAorCQkJCSAgICAgICBNSV9BUkJfQ0hFQ0sp
OworCWlmIChJU19FUlIocnFbMl0pKSB7CisJCWVyciA9IFBUUl9FUlIocnFbMl0pOworCQlnb3Rv
IG91dDsKKwl9CisKKwlpOTE1X3JlcXVlc3RfZ2V0KHJxWzJdKTsKKwllcnIgPSBpOTE1X3JlcXVl
c3RfYXdhaXRfZG1hX2ZlbmNlKHJxWzJdLCAmcnFbMV0tPmZlbmNlKTsKKwlpOTE1X3JlcXVlc3Rf
YWRkKHJxWzJdKTsKKwlpZiAoZXJyKQorCQlnb3RvIG91dDsKKworCWk5MTVfZ2VtX2NvbnRleHRf
c2V0X2Jhbm5lZChhcmctPmEuY3R4KTsKKwllcnIgPSBpbnRlbF9lbmdpbmVfcHVsc2UoYXJnLT5l
bmdpbmUpOworCWlmIChlcnIpCisJCWdvdG8gb3V0OworCisJaWYgKGk5MTVfcmVxdWVzdF93YWl0
KHJxWzJdLCAwLCBIWiAvIDUpIDwgMCkgeworCQllcnIgPSAtRUlPOworCQlnb3RvIG91dDsKKwl9
CisKKwlpZiAocnFbMF0tPmZlbmNlLmVycm9yICE9IC1FSU8pIHsKKwkJcHJfZXJyKCJDYW5jZWxs
ZWQgaW5mbGlnaHQwIHJlcXVlc3QgZGlkIG5vdCByZXBvcnQgLUVJT1xuIik7CisJCWVyciA9IC1F
SU5WQUw7CisJCWdvdG8gb3V0OworCX0KKworCWlmIChycVsxXS0+ZmVuY2UuZXJyb3IgIT0gMCkg
eworCQlwcl9lcnIoIk5vcm1hbCBpbmZsaWdodDEgcmVxdWVzdCBkaWQgbm90IGNvbXBsZXRlXG4i
KTsKKwkJZXJyID0gLUVJTlZBTDsKKwkJZ290byBvdXQ7CisJfQorCisJaWYgKHJxWzJdLT5mZW5j
ZS5lcnJvciAhPSAtRUlPKSB7CisJCXByX2VycigiQ2FuY2VsbGVkIHF1ZXVlZCByZXF1ZXN0IGRp
ZCBub3QgcmVwb3J0IC1FSU9cbiIpOworCQllcnIgPSAtRUlOVkFMOworCQlnb3RvIG91dDsKKwl9
CisKK291dDoKKwlpOTE1X3JlcXVlc3RfcHV0KHJxWzJdKTsKKwlpOTE1X3JlcXVlc3RfcHV0KHJx
WzFdKTsKKwlpOTE1X3JlcXVlc3RfcHV0KHJxWzBdKTsKKwlpZiAoaWd0X2xpdmVfdGVzdF9lbmQo
JnQpKQorCQllcnIgPSAtRUlPOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQgX19jYW5j
ZWxfaG9zdGlsZShzdHJ1Y3QgbGl2ZV9wcmVlbXB0X2NhbmNlbCAqYXJnKQoreworCXN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxOworCWludCBlcnI7CisKKwkvKiBQcmVlbXB0IGNhbmNlbCBub24tcHJl
ZW1wdGlibGUgc3Bpbm5lciBpbiBFTFNQMCAqLworCWlmICghQ09ORklHX0RSTV9JOTE1X1BSRUVN
UFRfVElNRU9VVCkKKwkJcmV0dXJuIDA7CisKKwlHRU1fVFJBQ0UoIiVzKCVzKVxuIiwgX19mdW5j
X18sIGFyZy0+ZW5naW5lLT5uYW1lKTsKKwljbGVhcl9iaXQoQ09OVEVYVF9CQU5ORUQsICZhcmct
PmEuY3R4LT5mbGFncyk7CisJcnEgPSBzcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZhcmctPmEuc3Bp
biwKKwkJCQkgICAgYXJnLT5hLmN0eCwgYXJnLT5lbmdpbmUsCisJCQkJICAgIE1JX05PT1ApOyAv
KiBwcmVlbXB0aW9uIGRpc2FibGVkICovCisJaWYgKElTX0VSUihycSkpCisJCXJldHVybiBQVFJf
RVJSKHJxKTsKKworCWk5MTVfcmVxdWVzdF9nZXQocnEpOworCWk5MTVfcmVxdWVzdF9hZGQocnEp
OworCWlmICghaWd0X3dhaXRfZm9yX3NwaW5uZXIoJmFyZy0+YS5zcGluLCBycSkpIHsKKwkJZXJy
ID0gLUVJTzsKKwkJZ290byBvdXQ7CisJfQorCisJaTkxNV9nZW1fY29udGV4dF9zZXRfYmFubmVk
KGFyZy0+YS5jdHgpOworCWVyciA9IGludGVsX2VuZ2luZV9wdWxzZShhcmctPmVuZ2luZSk7IC8q
IGZvcmNlIHJlc2V0ICovCisJaWYgKGVycikKKwkJZ290byBvdXQ7CisKKwlpZiAoaTkxNV9yZXF1
ZXN0X3dhaXQocnEsIDAsIEhaIC8gNSkgPCAwKSB7CisJCWVyciA9IC1FSU87CisJCWdvdG8gb3V0
OworCX0KKworCWlmIChycS0+ZmVuY2UuZXJyb3IgIT0gLUVJTykgeworCQlwcl9lcnIoIkNhbmNl
bGxlZCBpbmZsaWdodDAgcmVxdWVzdCBkaWQgbm90IHJlcG9ydCAtRUlPXG4iKTsKKwkJZXJyID0g
LUVJTlZBTDsKKwkJZ290byBvdXQ7CisJfQorCitvdXQ6CisJaTkxNV9yZXF1ZXN0X3B1dChycSk7
CisJaWYgKGlndF9mbHVzaF90ZXN0KGFyZy0+ZW5naW5lLT5ndCkpCisJCWVyciA9IC1FSU87CisJ
cmV0dXJuIGVycjsKK30KKworc3RhdGljIGludCBsaXZlX3ByZWVtcHRfY2FuY2VsKHZvaWQgKmFy
ZykKK3sKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOworCXN0cnVjdCBsaXZlX3ByZWVtcHRf
Y2FuY2VsIGRhdGE7CisJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisJaW50IGVyciA9IC1FTk9N
RU07CisKKwkvKgorCSAqIFRvIGNhbmNlbCBhbiBpbmZsaWdodCBjb250ZXh0LCB3ZSBuZWVkIHRv
IGZpcnN0IHJlbW92ZSBpdCBmcm9tIHRoZQorCSAqIEdQVS4gVGhhdCBzb3VuZHMgbGlrZSBwcmVl
bXB0aW9uISBQbHVzIGEgbGl0dGxlIGJpdCBvZiBib29ra2VlcGluZy4KKwkgKi8KKworCWlmICgh
SEFTX0xPR0lDQUxfUklOR19QUkVFTVBUSU9OKGd0LT5pOTE1KSkKKwkJcmV0dXJuIDA7CisKKwlp
ZiAocHJlZW1wdF9jbGllbnRfaW5pdChndCwgJmRhdGEuYSkpCisJCXJldHVybiAtRU5PTUVNOwor
CWlmIChwcmVlbXB0X2NsaWVudF9pbml0KGd0LCAmZGF0YS5iKSkKKwkJZ290byBlcnJfY2xpZW50
X2E7CisKKwlmb3JfZWFjaF9lbmdpbmUoZGF0YS5lbmdpbmUsIGd0LCBpZCkgeworCQlpZiAoIWlu
dGVsX2VuZ2luZV9oYXNfcHJlZW1wdGlvbihkYXRhLmVuZ2luZSkpCisJCQljb250aW51ZTsKKwor
CQllcnIgPSBfX2NhbmNlbF9hY3RpdmUwKCZkYXRhKTsKKwkJaWYgKGVycikKKwkJCWdvdG8gZXJy
X3dlZGdlZDsKKworCQllcnIgPSBfX2NhbmNlbF9hY3RpdmUxKCZkYXRhKTsKKwkJaWYgKGVycikK
KwkJCWdvdG8gZXJyX3dlZGdlZDsKKworCQllcnIgPSBfX2NhbmNlbF9xdWV1ZWQoJmRhdGEpOwor
CQlpZiAoZXJyKQorCQkJZ290byBlcnJfd2VkZ2VkOworCisJCWVyciA9IF9fY2FuY2VsX2hvc3Rp
bGUoJmRhdGEpOworCQlpZiAoZXJyKQorCQkJZ290byBlcnJfd2VkZ2VkOworCX0KKworCWVyciA9
IDA7CitlcnJfY2xpZW50X2I6CisJcHJlZW1wdF9jbGllbnRfZmluaSgmZGF0YS5iKTsKK2Vycl9j
bGllbnRfYToKKwlwcmVlbXB0X2NsaWVudF9maW5pKCZkYXRhLmEpOworCXJldHVybiBlcnI7CisK
K2Vycl93ZWRnZWQ6CisJR0VNX1RSQUNFX0RVTVAoKTsKKwlpZ3Rfc3Bpbm5lcl9lbmQoJmRhdGEu
Yi5zcGluKTsKKwlpZ3Rfc3Bpbm5lcl9lbmQoJmRhdGEuYS5zcGluKTsKKwlpbnRlbF9ndF9zZXRf
d2VkZ2VkKGd0KTsKKwlnb3RvIGVycl9jbGllbnRfYjsKK30KKwogc3RhdGljIGludCBsaXZlX3N1
cHByZXNzX3NlbGZfcHJlZW1wdCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGludGVsX2d0ICpndCA9
IGFyZzsKQEAgLTI3MDIsNiArMzAyMiw3IEBAIGludCBpbnRlbF9leGVjbGlzdHNfbGl2ZV9zZWxm
dGVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJCVNVQlRFU1QobGl2ZV9wcmVl
bXB0KSwKIAkJU1VCVEVTVChsaXZlX2xhdGVfcHJlZW1wdCksCiAJCVNVQlRFU1QobGl2ZV9ub3By
ZWVtcHQpLAorCQlTVUJURVNUKGxpdmVfcHJlZW1wdF9jYW5jZWwpLAogCQlTVUJURVNUKGxpdmVf
c3VwcHJlc3Nfc2VsZl9wcmVlbXB0KSwKIAkJU1VCVEVTVChsaXZlX3N1cHByZXNzX3dhaXRfcHJl
ZW1wdCksCiAJCVNVQlRFU1QobGl2ZV9jaGFpbl9wcmVlbXB0KSwKLS0gCjIuMjMuMAoKX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxp
bmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id B9E191BCE9B
	for <lists+intel-gfx@lfdr.de>; Tue, 28 Apr 2020 23:25:13 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 43D016E9C5;
	Tue, 28 Apr 2020 21:25:11 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 788126E99E
 for <intel-gfx@lists.freedesktop.org>; Tue, 28 Apr 2020 21:25:09 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from build.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 21052115-1500050 
 for multiple; Tue, 28 Apr 2020 22:24:54 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 28 Apr 2020 22:24:53 +0100
Message-Id: <20200428212453.27634-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20200428205520.29559-1-chris@chris-wilson.co.uk>
References: <20200428205520.29559-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/gt: Keep a no-frills swappable copy of
 the default context state
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Matthew Auld <matthew.auld@intel.com>,
 Chris Wilson <chris@chris-wilson.co.uk>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgbmVlZCB0byBrZWVwIHRoZSBkZWZhdWx0IGNvbnRleHQgc3RhdGUgYXJvdW5kIHRvIGluc3Rh
bnRpYXRlIG5ldwpjb250ZXh0cyAoYWthIGdvbGRlbiByZW5kZXJjb250ZXh0KSwgYW5kIHdlIGFs
c28ga2VlcCBpdCBwaW5uZWQgd2hpbGUKdGhlIGVuZ2luZSBpcyBhY3RpdmUgc28gdGhhdCB3ZSBj
YW4gcXVpY2tseSByZXNldCBhIGhhbmdpbmcgY29udGV4dC4KSG93ZXZlciwgdGhlIGRlZmF1bHQg
Y29udGV4dHMgYXJlIGxhcmdlIGVub3VnaCB0byBtZXJpdCBrZWVwaW5nIGluCnN3YXBwYWJsZSBt
ZW1vcnkgYXMgb3Bwb3NlZCB0byBrZXJuZWwgbWVtb3J5LCBzbyB3ZSBzdG9yZSB0aGVtIGluc2lk
ZQpzaG1lbWZzLiBDdXJyZW50bHksIHdlIHVzZSB0aGUgbm9ybWFsIEdFTSBvYmplY3RzIHRvIGNy
ZWF0ZSB0aGUgZGVmYXVsdApjb250ZXh0IGltYWdlLCBidXQgd2UgY2FuIHRocm93IGF3YXkgYWxs
IGJ1dCB0aGUgc2htZW1mcyBmaWxlLgoKVGhpcyBncmVhdGx5IHNpbXBsaWZpZXMgdGhlIHRyaWNr
eSBwb3dlciBtYW5hZ2VtZW50IGNvZGUgd2hpY2ggd2FudHMgdG8KcnVuIHVuZGVybmVhdGggdGhl
IG5vcm1hbCBHVCBsb2NraW5nLCBhbmQgd2UgZGVmaW5pdGVseSBkbyBub3Qgd2FudCB0bwp1c2Ug
YW55IGhpZ2ggbGV2ZWwgb2JqZWN0cyB0aGF0IG1heSBhcHBlYXIgdG8gcmVjdXJzZSBiYWNrIGlu
dG8gdGhlIEdULgpUaG91Z2ggcGVyaGFwcyB0aGUgcHJpbWFyeSBhZHZhbnRhZ2Ugb2YgdGhlIGNv
bXBsZXggR0VNIG9iamVjdCBpcyB0aGF0CndlIGFnZ3Jlc3NpdmVseSBjYWNoZSB0aGUgbWFwcGlu
ZywgYnV0IGhlcmUgd2UgYXJlIHJlY3JlYXRpbmcgdGhlCnZtX2FyZWEgZXZlcnl0aW1lIHRpbWUg
d2UgdW5wYXJrLiBBdCB0aGUgd29yc3QsIHdlIGFkZCBhIGxpZ2h0d2VpZ2h0CmNhY2hlLCBidXQg
Zmlyc3QgZmluZCBhIG1pY3JvYmVuY2htYXJrIHRoYXQgaXMgaW1wYWN0ZWQuCgpIYXZpbmcgc3Rh
cnRlZCB0byBjcmVhdGUgc29tZSB1dGlsaXR5IGZ1bmN0aW9ucyB0byBtYWtlIHdvcmtpbmcgd2l0
aApzaG1lbWZzIG9iamVjdHMgZWFzaWVyLCB3ZSBjYW4gc3RhcnQgcHV0dGluZyB0aGVtIHRvIHdp
ZGVyIHVzZSwgd2hlcmUKR0VNIG9iamVjdHMgYXJlIG92ZXJraWxsLCBzdWNoIGFzIHN0b3Jpbmcg
cGVyc2lzdGVudCBlcnJvciBzdGF0ZS4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hy
aXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogTWF0dGhldyBBdWxkIDxtYXR0aGV3LmF1bGRAaW50
ZWwuY29tPgpDYzogUmFtYWxpbmdhbSBDIDxyYW1hbGluZ2FtLmNAaW50ZWwuY29tPgpDYzogVHZy
dGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9NYWtlZmlsZSAgICAgICAgICAgICAgICAgfCAgIDEgKwogZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMgICAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYyAgICAgfCAgMTAgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5oICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZ3QuYyAgICAgICAgICAgIHwgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9scmMuYyAgICAgICAgICAgfCAgMjUgKy0tCiAuLi4vZ3B1L2RybS9pOTE1L2d0
L2ludGVsX3Jpbmdfc3VibWlzc2lvbi5jICAgfCAgMTYgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYyAgICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Qvc2VsZnRlc3RfbHJjLmMgICAgICAgIHwgIDEwICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9zaG1lbV91dGlscy5jICAgICAgICAgfCAxNzggKysrKysrKysrKysrKysrKysrCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zaG1lbV91dGlscy5oICAgICAgICAgfCAgMjIgKysrCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5jICAgICAgICAgfCAgMjYgLS0tCiAxMiBmaWxl
cyBjaGFuZ2VkLCAyMjYgaW5zZXJ0aW9ucygrKSwgNzIgZGVsZXRpb25zKC0pCiBjcmVhdGUgbW9k
ZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2htZW1fdXRpbHMuYwogY3JlYXRlIG1v
ZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NobWVtX3V0aWxzLmgKCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZSBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L01ha2VmaWxlCmluZGV4IDIxYmIyZmI1YTZiOC4uY2FmMDBkOTJlYTlkIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9N
YWtlZmlsZQpAQCAtMTExLDYgKzExMSw3IEBAIGd0LXkgKz0gXAogCWd0L2ludGVsX3NzZXUubyBc
CiAJZ3QvaW50ZWxfdGltZWxpbmUubyBcCiAJZ3QvaW50ZWxfd29ya2Fyb3VuZHMubyBcCisJZ3Qv
c2htZW1fdXRpbHMubyBcCiAJZ3Qvc3lzZnNfZW5naW5lcy5vCiAjIGF1dG9nZW5lcmF0ZWQgbnVs
bCByZW5kZXIgc3RhdGUKIGd0LXkgKz0gXApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9l
bmdpbmVfY3MuYwppbmRleCA3YzNjYjVhZWRmZGYuLjgwYmY3MTYzNmMwZiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKQEAgLTgzNCw3ICs4MzQsNyBAQCB2b2lk
IGludGVsX2VuZ2luZV9jbGVhbnVwX2NvbW1vbihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmUpCiAJaW50ZWxfZW5naW5lX2NsZWFudXBfY21kX3BhcnNlcihlbmdpbmUpOwogCiAJaWYgKGVu
Z2luZS0+ZGVmYXVsdF9zdGF0ZSkKLQkJaTkxNV9nZW1fb2JqZWN0X3B1dChlbmdpbmUtPmRlZmF1
bHRfc3RhdGUpOworCQlmcHV0KGVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSk7CiAKIAlpZiAoZW5naW5l
LT5rZXJuZWxfY29udGV4dCkgewogCQlpbnRlbF9jb250ZXh0X3VucGluKGVuZ2luZS0+a2VybmVs
X2NvbnRleHQpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5n
aW5lX3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYwppbmRl
eCAzYmU2Nzk3NDFkMjIuLjQ0NmUzNWFjMDIyNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfZW5naW5lX3BtLmMKQEAgLTE1LDYgKzE1LDcgQEAKICNpbmNsdWRlICJpbnRlbF9ndF9w
bS5oIgogI2luY2x1ZGUgImludGVsX3JjNi5oIgogI2luY2x1ZGUgImludGVsX3JpbmcuaCIKKyNp
bmNsdWRlICJzaG1lbV91dGlscy5oIgogCiBzdGF0aWMgaW50IF9fZW5naW5lX3VucGFyayhzdHJ1
Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiB7CkBAIC0zMCwxMCArMzEsOCBAQCBzdGF0aWMgaW50IF9f
ZW5naW5lX3VucGFyayhzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiAJLyogUGluIHRoZSBkZWZh
dWx0IHN0YXRlIGZvciBmYXN0IHJlc2V0cyBmcm9tIGF0b21pYyBjb250ZXh0LiAqLwogCW1hcCA9
IE5VTEw7CiAJaWYgKGVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSkKLQkJbWFwID0gaTkxNV9nZW1fb2Jq
ZWN0X3Bpbl9tYXAoZW5naW5lLT5kZWZhdWx0X3N0YXRlLAotCQkJCQkgICAgICBJOTE1X01BUF9X
Qik7Ci0JaWYgKCFJU19FUlJfT1JfTlVMTChtYXApKQotCQllbmdpbmUtPnBpbm5lZF9kZWZhdWx0
X3N0YXRlID0gbWFwOworCQltYXAgPSBzaG1lbV9waW5fbWFwKGVuZ2luZS0+ZGVmYXVsdF9zdGF0
ZSk7CisJZW5naW5lLT5waW5uZWRfZGVmYXVsdF9zdGF0ZSA9IG1hcDsKIAogCS8qIERpc2NhcmQg
c3RhbGUgY29udGV4dCBzdGF0ZSBmcm9tIGFjcm9zcyBpZGxpbmcgKi8KIAljZSA9IGVuZ2luZS0+
a2VybmVsX2NvbnRleHQ7CkBAIC0yNjQsNyArMjYzLDggQEAgc3RhdGljIGludCBfX2VuZ2luZV9w
YXJrKHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZikKIAkJZW5naW5lLT5wYXJrKGVuZ2luZSk7CiAK
IAlpZiAoZW5naW5lLT5waW5uZWRfZGVmYXVsdF9zdGF0ZSkgewotCQlpOTE1X2dlbV9vYmplY3Rf
dW5waW5fbWFwKGVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSk7CisJCXNobWVtX3VucGluX21hcChlbmdp
bmUtPmRlZmF1bHRfc3RhdGUsCisJCQkJZW5naW5lLT5waW5uZWRfZGVmYXVsdF9zdGF0ZSk7CiAJ
CWVuZ2luZS0+cGlubmVkX2RlZmF1bHRfc3RhdGUgPSBOVUxMOwogCX0KIApkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmggYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMuaAppbmRleCBjZmU0ZmVhZWU5ODIuLjQ4
M2Q4ZmYzOWEwZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5n
aW5lX3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5
cGVzLmgKQEAgLTMzOSw3ICszMzksNyBAQCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzIHsKIAogCXVu
c2lnbmVkIGxvbmcgd2FrZXJlZl9zZXJpYWw7CiAJc3RydWN0IGludGVsX3dha2VyZWYgd2FrZXJl
ZjsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqZGVmYXVsdF9zdGF0ZTsKKwlzdHJ1Y3Qg
ZmlsZSAqZGVmYXVsdF9zdGF0ZTsKIAl2b2lkICpwaW5uZWRfZGVmYXVsdF9zdGF0ZTsKIAogCXN0
cnVjdCB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYwppbmRleCBkOWNmODE5NGM5OTcuLmMz
ZjI1YTJhNTcwNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3Qu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jCkBAIC0xNiw2ICsxNiw3
IEBACiAjaW5jbHVkZSAiaW50ZWxfcnBzLmgiCiAjaW5jbHVkZSAiaW50ZWxfdW5jb3JlLmgiCiAj
aW5jbHVkZSAiaW50ZWxfcG0uaCIKKyNpbmNsdWRlICJzaG1lbV91dGlscy5oIgogCiB2b2lkIGlu
dGVsX2d0X2luaXRfZWFybHkoc3RydWN0IGludGVsX2d0ICpndCwgc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCiB7CkBAIC01MDEsNyArNTAyLDggQEAgc3RhdGljIGludCBfX2VuZ2luZXNf
cmVjb3JkX2RlZmF1bHRzKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAJCQlnb3RvIG91dDsKIAkJfQog
Ci0JCXJxLT5lbmdpbmUtPmRlZmF1bHRfc3RhdGUgPSBpOTE1X2dlbV9vYmplY3RfZ2V0KHN0YXRl
LT5vYmopOworCQlycS0+ZW5naW5lLT5kZWZhdWx0X3N0YXRlID0KKwkJCXNobWVtX2NyZWF0ZV9m
cm9tX29iamVjdChzdGF0ZS0+b2JqKTsKIAkJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChzdGF0
ZS0+b2JqKTsKIAl9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKaW5kZXggOTBhY2Mz
ZDI0NDBiLi43ZmM0MDgxYzM0ZmUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCkBA
IC0xNDcsNiArMTQ3LDcgQEAKICNpbmNsdWRlICJpbnRlbF9yZXNldC5oIgogI2luY2x1ZGUgImlu
dGVsX3JpbmcuaCIKICNpbmNsdWRlICJpbnRlbF93b3JrYXJvdW5kcy5oIgorI2luY2x1ZGUgInNo
bWVtX3V0aWxzLmgiCiAKICNkZWZpbmUgUklOR19FWEVDTElTVF9RRlVMTAkJKDEgPDwgMHgyKQog
I2RlZmluZSBSSU5HX0VYRUNMSVNUMV9WQUxJRAkJKDEgPDwgMHgzKQpAQCAtNTA4MywzMCArNTA4
NCwxOCBAQCBwb3B1bGF0ZV9scl9jb250ZXh0KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKIHsK
IAlib29sIGluaGliaXQgPSB0cnVlOwogCXZvaWQgKnZhZGRyOwotCWludCByZXQ7CiAKIAl2YWRk
ciA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKGN0eF9vYmosIEk5MTVfTUFQX1dCKTsKIAlpZiAo
SVNfRVJSKHZhZGRyKSkgewotCQlyZXQgPSBQVFJfRVJSKHZhZGRyKTsKLQkJZHJtX2RiZygmZW5n
aW5lLT5pOTE1LT5kcm0sCi0JCQkiQ291bGQgbm90IG1hcCBvYmplY3QgcGFnZXMhICglZClcbiIs
IHJldCk7Ci0JCXJldHVybiByZXQ7CisJCWRybV9kYmcoJmVuZ2luZS0+aTkxNS0+ZHJtLCAiQ291
bGQgbm90IG1hcCBvYmplY3QgcGFnZXMhXG4iKTsKKwkJcmV0dXJuIFBUUl9FUlIodmFkZHIpOwog
CX0KIAogCXNldF9yZWR6b25lKHZhZGRyLCBlbmdpbmUpOwogCiAJaWYgKGVuZ2luZS0+ZGVmYXVs
dF9zdGF0ZSkgewotCQl2b2lkICpkZWZhdWx0czsKLQotCQlkZWZhdWx0cyA9IGk5MTVfZ2VtX29i
amVjdF9waW5fbWFwKGVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSwKLQkJCQkJCSAgIEk5MTVfTUFQX1dC
KTsKLQkJaWYgKElTX0VSUihkZWZhdWx0cykpIHsKLQkJCXJldCA9IFBUUl9FUlIoZGVmYXVsdHMp
OwotCQkJZ290byBlcnJfdW5waW5fY3R4OwotCQl9Ci0KLQkJbWVtY3B5KHZhZGRyLCBkZWZhdWx0
cywgZW5naW5lLT5jb250ZXh0X3NpemUpOwotCQlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKGVu
Z2luZS0+ZGVmYXVsdF9zdGF0ZSk7CisJCXNobWVtX3JlYWQoZW5naW5lLT5kZWZhdWx0X3N0YXRl
LCAwLAorCQkJICAgdmFkZHIsIGVuZ2luZS0+Y29udGV4dF9zaXplKTsKIAkJX19zZXRfYml0KENP
TlRFWFRfVkFMSURfQklULCAmY2UtPmZsYWdzKTsKIAkJaW5oaWJpdCA9IGZhbHNlOwogCX0KQEAg
LTUxMjEsMTEgKzUxMTAsOSBAQCBwb3B1bGF0ZV9scl9jb250ZXh0KHN0cnVjdCBpbnRlbF9jb250
ZXh0ICpjZSwKIAlleGVjbGlzdHNfaW5pdF9yZWdfc3RhdGUodmFkZHIgKyBMUkNfU1RBVEVfT0ZG
U0VULAogCQkJCSBjZSwgZW5naW5lLCByaW5nLCBpbmhpYml0KTsKIAotCXJldCA9IDA7Ci1lcnJf
dW5waW5fY3R4OgogCV9faTkxNV9nZW1fb2JqZWN0X2ZsdXNoX21hcChjdHhfb2JqLCAwLCBlbmdp
bmUtPmNvbnRleHRfc2l6ZSk7CiAJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChjdHhfb2JqKTsK
LQlyZXR1cm4gcmV0OworCXJldHVybiAwOwogfQogCiBzdGF0aWMgaW50IF9fZXhlY2xpc3RzX2Nv
bnRleHRfYWxsb2Moc3RydWN0IGludGVsX2NvbnRleHQgKmNlLApkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ19zdWJtaXNzaW9uLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9yaW5nX3N1Ym1pc3Npb24uYwppbmRleCBkMDE1ZjdiOGIyOGUuLmNh
NzI4NmU1ODQwOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmlu
Z19zdWJtaXNzaW9uLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ19z
dWJtaXNzaW9uLmMKQEAgLTQyLDYgKzQyLDcgQEAKICNpbmNsdWRlICJpbnRlbF9yZXNldC5oIgog
I2luY2x1ZGUgImludGVsX3JpbmcuaCIKICNpbmNsdWRlICJpbnRlbF93b3JrYXJvdW5kcy5oIgor
I2luY2x1ZGUgInNobWVtX3V0aWxzLmgiCiAKIC8qIFJvdWdoIGVzdGltYXRlIG9mIHRoZSB0eXBp
Y2FsIHJlcXVlc3Qgc2l6ZSwgcGVyZm9ybWluZyBhIGZsdXNoLAogICogc2V0LWNvbnRleHQgYW5k
IHRoZW4gZW1pdHRpbmcgdGhlIGJhdGNoLgpAQCAtMTI0MSw3ICsxMjQyLDcgQEAgYWxsb2NfY29u
dGV4dF92bWEoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCQlpOTE1X2dlbV9vYmpl
Y3Rfc2V0X2NhY2hlX2NvaGVyZW5jeShvYmosIEk5MTVfQ0FDSEVfTDNfTExDKTsKIAogCWlmIChl
bmdpbmUtPmRlZmF1bHRfc3RhdGUpIHsKLQkJdm9pZCAqZGVmYXVsdHMsICp2YWRkcjsKKwkJdm9p
ZCAqdmFkZHI7CiAKIAkJdmFkZHIgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChvYmosIEk5MTVf
TUFQX1dCKTsKIAkJaWYgKElTX0VSUih2YWRkcikpIHsKQEAgLTEyNDksMTUgKzEyNTAsOCBAQCBh
bGxvY19jb250ZXh0X3ZtYShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJCQlnb3Rv
IGVycl9vYmo7CiAJCX0KIAotCQlkZWZhdWx0cyA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKGVu
Z2luZS0+ZGVmYXVsdF9zdGF0ZSwKLQkJCQkJCSAgIEk5MTVfTUFQX1dCKTsKLQkJaWYgKElTX0VS
UihkZWZhdWx0cykpIHsKLQkJCWVyciA9IFBUUl9FUlIoZGVmYXVsdHMpOwotCQkJZ290byBlcnJf
bWFwOwotCQl9Ci0KLQkJbWVtY3B5KHZhZGRyLCBkZWZhdWx0cywgZW5naW5lLT5jb250ZXh0X3Np
emUpOwotCQlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKGVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSk7
CisJCXNobWVtX3JlYWQoZW5naW5lLT5kZWZhdWx0X3N0YXRlLCAwLAorCQkJICAgdmFkZHIsIGVu
Z2luZS0+Y29udGV4dF9zaXplKTsKIAogCQlpOTE1X2dlbV9vYmplY3RfZmx1c2hfbWFwKG9iaik7
CiAJCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAob2JqKTsKQEAgLTEyNzEsOCArMTI2NSw2IEBA
IGFsbG9jX2NvbnRleHRfdm1hKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAogCXJl
dHVybiB2bWE7CiAKLWVycl9tYXA6Ci0JaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChvYmopOwog
ZXJyX29iajoKIAlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CiAJcmV0dXJuIEVSUl9QVFIoZXJy
KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYwppbmRleCBlODc0
ZGZhYTUzMTYuLmI4ZWQzY2JlMTI3NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Qvc2VsZnRlc3RfY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X2NvbnRleHQuYwpAQCAtMTU1LDcgKzE1NSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9jb250ZXh0
X3NpemUodm9pZCAqYXJnKQogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7CiAJ
CXN0cnVjdCB7Ci0JCQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqc3RhdGU7CisJCQlzdHJ1
Y3QgZmlsZSAqc3RhdGU7CiAJCQl2b2lkICpwaW5uZWQ7CiAJCX0gc2F2ZWQ7CiAKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKaW5kZXggZDNmYTkxYWVkN2RlLi5kOTAwYmJjY2Q1
ZGIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCkBAIC00NDUyLDggKzQ0
NTIsNyBAQCBzdGF0aWMgaW50IGxpdmVfbHJjX2xheW91dCh2b2lkICphcmcpCiAJCWlmICghZW5n
aW5lLT5kZWZhdWx0X3N0YXRlKQogCQkJY29udGludWU7CiAKLQkJaHcgPSBpOTE1X2dlbV9vYmpl
Y3RfcGluX21hcChlbmdpbmUtPmRlZmF1bHRfc3RhdGUsCi0JCQkJCSAgICAgSTkxNV9NQVBfV0Ip
OworCQlodyA9IHNobWVtX3Bpbl9tYXAoZW5naW5lLT5kZWZhdWx0X3N0YXRlKTsKIAkJaWYgKElT
X0VSUihodykpIHsKIAkJCWVyciA9IFBUUl9FUlIoaHcpOwogCQkJYnJlYWs7CkBAIC00NTI1LDcg
KzQ1MjQsNyBAQCBzdGF0aWMgaW50IGxpdmVfbHJjX2xheW91dCh2b2lkICphcmcpCiAJCQloZXhk
dW1wKGxyYywgUEFHRV9TSVpFKTsKIAkJfQogCi0JCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAo
ZW5naW5lLT5kZWZhdWx0X3N0YXRlKTsKKwkJc2htZW1fdW5waW5fbWFwKGVuZ2luZS0+ZGVmYXVs
dF9zdGF0ZSwgaHcpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAJfQpAQCAtNDYzMCw4ICs0NjI5
LDcgQEAgc3RhdGljIGludCBsaXZlX2xyY19maXhlZCh2b2lkICphcmcpCiAJCWlmICghZW5naW5l
LT5kZWZhdWx0X3N0YXRlKQogCQkJY29udGludWU7CiAKLQkJaHcgPSBpOTE1X2dlbV9vYmplY3Rf
cGluX21hcChlbmdpbmUtPmRlZmF1bHRfc3RhdGUsCi0JCQkJCSAgICAgSTkxNV9NQVBfV0IpOwor
CQlodyA9IHNobWVtX3Bpbl9tYXAoZW5naW5lLT5kZWZhdWx0X3N0YXRlKTsKIAkJaWYgKElTX0VS
UihodykpIHsKIAkJCWVyciA9IFBUUl9FUlIoaHcpOwogCQkJYnJlYWs7CkBAIC00NjUyLDcgKzQ2
NTAsNyBAQCBzdGF0aWMgaW50IGxpdmVfbHJjX2ZpeGVkKHZvaWQgKmFyZykKIAkJCX0KIAkJfQog
Ci0JCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAoZW5naW5lLT5kZWZhdWx0X3N0YXRlKTsKKwkJ
c2htZW1fdW5waW5fbWFwKGVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSwgaHcpOwogCX0KIAogCXJldHVy
biBlcnI7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zaG1lbV91dGlscy5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2htZW1fdXRpbHMuYwpuZXcgZmlsZSBtb2RlIDEw
MDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmVmYmU1MTA5NmRjNgotLS0gL2Rldi9udWxsCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NobWVtX3V0aWxzLmMKQEAgLTAsMCArMSwxNzggQEAK
Ky8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKKy8qCisgKiBDb3B5cmlnaHQgwqkgMjAy
MCBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpbmNsdWRlIDxsaW51eC9tbS5oPgorI2luY2x1
ZGUgPGxpbnV4L3BhZ2VtYXAuaD4KKyNpbmNsdWRlIDxsaW51eC9zaG1lbV9mcy5oPgorCisjaW5j
bHVkZSAiZ2VtL2k5MTVfZ2VtX29iamVjdC5oIgorI2luY2x1ZGUgInNobWVtX3V0aWxzLmgiCisK
K3N0cnVjdCBmaWxlICpzaG1lbV9jcmVhdGVfZnJvbV9kYXRhKGNvbnN0IGNoYXIgKm5hbWUsIHZv
aWQgKmRhdGEsIHNpemVfdCBsZW4pCit7CisJc3RydWN0IGZpbGUgKmZpbGU7CisJdW5zaWduZWQg
bG9uZyBwZm47CisJdW5zaWduZWQgbG9uZyBzejsKKwlpbnQgZXJyOworCisJc3ogPSBQQUdFX0FM
SUdOKGxlbik7CisJZmlsZSA9IHNobWVtX2ZpbGVfc2V0dXAobmFtZSwgc3osIFZNX05PUkVTRVJW
RSk7CisJaWYgKElTX0VSUihmaWxlKSkKKwkJcmV0dXJuIGZpbGU7CisKKwlmb3IgKHBmbiA9IDA7
IHBmbiA8IHN6ID4+IFBBR0VfU0hJRlQ7IHBmbisrKSB7CisJCXN0cnVjdCBwYWdlICpwYWdlOwor
CQl1bnNpZ25lZCBpbnQgdGhpczsKKwkJdm9pZCAqdmFkZHI7CisKKwkJcGFnZSA9IHNobWVtX3Jl
YWRfbWFwcGluZ19wYWdlX2dmcChmaWxlLT5mX21hcHBpbmcsIHBmbiwKKwkJCQkJCSAgIEdGUF9L
RVJORUwpOworCQlpZiAoSVNfRVJSKHBhZ2UpKSB7CisJCQllcnIgPSBQVFJfRVJSKHBhZ2UpOwor
CQkJZ290byBlcnJfZmlsZTsKKwkJfQorCisJCXRoaXMgPSBtaW5fdChzaXplX3QsIFBBR0VfU0la
RSwgbGVuKTsKKworCQl2YWRkciA9IGttYXAocGFnZSk7CisJCW1lbWNweSh2YWRkciwgZGF0YSwg
dGhpcyk7CisJCWt1bm1hcChwYWdlKTsKKwkJcHV0X3BhZ2UocGFnZSk7CisKKwkJbGVuIC09IHRo
aXM7CisJCWRhdGEgKz0gdGhpczsKKwl9CisKKwlyZXR1cm4gZmlsZTsKKworZXJyX2ZpbGU6CisJ
ZnB1dChmaWxlKTsKKwlyZXR1cm4gRVJSX1BUUihlcnIpOworfQorCitzdHJ1Y3QgZmlsZSAqc2ht
ZW1fY3JlYXRlX2Zyb21fb2JqZWN0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCit7
CisJc3RydWN0IGZpbGUgKmZpbGU7CisJdm9pZCAqcHRyOworCisJaWYgKG9iai0+b3BzID09ICZp
OTE1X2dlbV9zaG1lbV9vcHMpIHsKKwkJZmlsZSA9IG9iai0+YmFzZS5maWxwOworCQlhdG9taWNf
bG9uZ19pbmMoJmZpbGUtPmZfY291bnQpOworCQlyZXR1cm4gZmlsZTsKKwl9CisKKwlwdHIgPSBp
OTE1X2dlbV9vYmplY3RfcGluX21hcChvYmosIEk5MTVfTUFQX1dCKTsKKwlpZiAoSVNfRVJSKHB0
cikpCisJCXJldHVybiBFUlJfQ0FTVChwdHIpOworCisJZmlsZSA9IHNobWVtX2NyZWF0ZV9mcm9t
X2RhdGEoIiIsIHB0ciwgb2JqLT5iYXNlLnNpemUpOworCWk5MTVfZ2VtX29iamVjdF91bnBpbl9t
YXAob2JqKTsKKworCXJldHVybiBmaWxlOworfQorCitzdGF0aWMgc2l6ZV90IHNobWVtX25wdGUo
c3RydWN0IGZpbGUgKmZpbGUpCit7CisJcmV0dXJuIGZpbGUtPmZfbWFwcGluZy0+aG9zdC0+aV9z
aXplID4+IFBBR0VfU0hJRlQ7Cit9CisKK3N0YXRpYyB2b2lkIF9fc2htZW1fdW5waW5fbWFwKHN0
cnVjdCBmaWxlICpmaWxlLCB2b2lkICpwdHIsIHNpemVfdCBuX3B0ZSkKK3sKKwl1bnNpZ25lZCBs
b25nIHBmbjsKKworCXZ1bm1hcChwdHIpOworCisJZm9yIChwZm4gPSAwOyBwZm4gPCBuX3B0ZTsg
cGZuKyspIHsKKwkJc3RydWN0IHBhZ2UgKnBhZ2U7CisKKwkJcGFnZSA9IHNobWVtX3JlYWRfbWFw
cGluZ19wYWdlX2dmcChmaWxlLT5mX21hcHBpbmcsIHBmbiwKKwkJCQkJCSAgIEdGUF9LRVJORUwp
OworCQlpZiAoIVdBUk5fT04oSVNfRVJSKHBhZ2UpKSkgeworCQkJcHV0X3BhZ2UocGFnZSk7CisJ
CQlwdXRfcGFnZShwYWdlKTsKKwkJfQorCX0KK30KKwordm9pZCAqc2htZW1fcGluX21hcChzdHJ1
Y3QgZmlsZSAqZmlsZSkKK3sKKwljb25zdCBzaXplX3Qgbl9wdGUgPSBzaG1lbV9ucHRlKGZpbGUp
OworCXB0ZV90ICpzdGFja1szMl0sICoqcHRlcywgKiptZW07CisJc3RydWN0IHZtX3N0cnVjdCAq
YXJlYTsKKwl1bnNpZ25lZCBsb25nIHBmbjsKKworCW1lbSA9IHN0YWNrOworCWlmIChuX3B0ZSA+
IEFSUkFZX1NJWkUoc3RhY2spKSB7CisJCW1lbSA9IGt2bWFsbG9jX2FycmF5KG5fcHRlLCBzaXpl
b2YoKm1lbSksIEdGUF9LRVJORUwpOworCQlpZiAoIW1lbSkKKwkJCXJldHVybiBOVUxMOworCX0K
KworCWFyZWEgPSBhbGxvY192bV9hcmVhKG5fcHRlIDw8IFBBR0VfU0hJRlQsIG1lbSk7CisJaWYg
KCFhcmVhKSB7CisJCWlmIChtZW0gIT0gc3RhY2spCisJCQlrdmZyZWUobWVtKTsKKwkJcmV0dXJu
IE5VTEw7CisJfQorCisJcHRlcyA9IG1lbTsKKwlmb3IgKHBmbiA9IDA7IHBmbiA8IG5fcHRlOyBw
Zm4rKykgeworCQlzdHJ1Y3QgcGFnZSAqcGFnZTsKKworCQlwYWdlID0gc2htZW1fcmVhZF9tYXBw
aW5nX3BhZ2VfZ2ZwKGZpbGUtPmZfbWFwcGluZywgcGZuLAorCQkJCQkJICAgR0ZQX0tFUk5FTCk7
CisJCWlmIChJU19FUlIocGFnZSkpCisJCQlnb3RvIGVycl9wYWdlOworCisJCSoqcHRlcysrID0g
bWtfcHRlKHBhZ2UsICBQQUdFX0tFUk5FTCk7CisJfQorCisJaWYgKG1lbSAhPSBzdGFjaykKKwkJ
a3ZmcmVlKG1lbSk7CisKKwltYXBwaW5nX3NldF91bmV2aWN0YWJsZShmaWxlLT5mX21hcHBpbmcp
OworCXJldHVybiBhcmVhLT5hZGRyOworCitlcnJfcGFnZToKKwlpZiAobWVtICE9IHN0YWNrKQor
CQlrdmZyZWUobWVtKTsKKworCV9fc2htZW1fdW5waW5fbWFwKGZpbGUsIGFyZWEtPmFkZHIsIHBm
bik7CisJcmV0dXJuIE5VTEw7Cit9CisKK3ZvaWQgc2htZW1fdW5waW5fbWFwKHN0cnVjdCBmaWxl
ICpmaWxlLCB2b2lkICpwdHIpCit7CisJbWFwcGluZ19jbGVhcl91bmV2aWN0YWJsZShmaWxlLT5m
X21hcHBpbmcpOworCV9fc2htZW1fdW5waW5fbWFwKGZpbGUsIHB0ciwgc2htZW1fbnB0ZShmaWxl
KSk7Cit9CisKK2ludCBzaG1lbV9yZWFkKHN0cnVjdCBmaWxlICpmaWxlLCBsb2ZmX3Qgb2ZmLCB2
b2lkICpkc3QsIHNpemVfdCBsZW4pCit7CisJdW5zaWduZWQgbG9uZyBwZm47CisKKwlmb3IgKHBm
biA9IG9mZiA+PiBQQUdFX1NISUZUOyBsZW47IHBmbisrKSB7CisJCXVuc2lnbmVkIGludCB0aGlz
ID0KKwkJCW1pbl90KHNpemVfdCwgUEFHRV9TSVpFIC0gb2Zmc2V0X2luX3BhZ2Uob2ZmKSwgbGVu
KTsKKwkJc3RydWN0IHBhZ2UgKnBhZ2U7CisJCXZvaWQgKnZhZGRyOworCisJCXBhZ2UgPSBzaG1l
bV9yZWFkX21hcHBpbmdfcGFnZV9nZnAoZmlsZS0+Zl9tYXBwaW5nLCBwZm4sCisJCQkJCQkgICBH
RlBfS0VSTkVMKTsKKwkJaWYgKElTX0VSUihwYWdlKSkKKwkJCXJldHVybiBQVFJfRVJSKHBhZ2Up
OworCisJCXZhZGRyID0ga21hcChwYWdlKTsKKwkJbWVtY3B5KGRzdCwgdmFkZHIgKyBvZmZzZXRf
aW5fcGFnZShvZmYpLCB0aGlzKTsKKwkJa3VubWFwKHBhZ2UpOworCQlwdXRfcGFnZShwYWdlKTsK
KworCQlsZW4gLT0gdGhpczsKKwkJZHN0ICs9IHRoaXM7CisJCW9mZiA9IDA7CisJfQorCisJcmV0
dXJuIDA7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zaG1lbV91dGls
cy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2htZW1fdXRpbHMuaApuZXcgZmlsZSBtb2Rl
IDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjIxM2ZhZThhOTQzYQotLS0gL2Rldi9udWxsCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NobWVtX3V0aWxzLmgKQEAgLTAsMCArMSwyMiBA
QAorLyogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVCAqLworLyoKKyAqIENvcHlyaWdodCDC
qSAyMDIwIEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2lmbmRlZiBTSE1FTV9VVElMU19ICisj
ZGVmaW5lIFNITUVNX1VUSUxTX0gKKworI2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+CisKK3N0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0Oworc3RydWN0IGZpbGU7CisKK3N0cnVjdCBmaWxlICpzaG1l
bV9jcmVhdGVfZnJvbV9kYXRhKGNvbnN0IGNoYXIgKm5hbWUsIHZvaWQgKmRhdGEsIHNpemVfdCBs
ZW4pOworc3RydWN0IGZpbGUgKnNobWVtX2NyZWF0ZV9mcm9tX29iamVjdChzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqb2JqKTsKKwordm9pZCAqc2htZW1fcGluX21hcChzdHJ1Y3QgZmlsZSAq
ZmlsZSk7Cit2b2lkIHNobWVtX3VucGluX21hcChzdHJ1Y3QgZmlsZSAqZmlsZSwgdm9pZCAqcHRy
KTsKKworaW50IHNobWVtX3JlYWQoc3RydWN0IGZpbGUgKmZpbGUsIGxvZmZfdCBvZmYsIHZvaWQg
KmRzdCwgc2l6ZV90IGxlbik7CisKKyNlbmRpZiAvKiBTSE1FTV9VVElMU19IICovCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3IuYwppbmRleCA0ZDU0ZGJhMzUzMDIuLjg1MDZjYTQzZWNh
NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3IuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dwdV9lcnJvci5jCkBAIC0xMzE4LDI2ICsxMzE4
LDYgQEAgY2FwdHVyZV91c2VyKHN0cnVjdCBpbnRlbF9lbmdpbmVfY2FwdHVyZV92bWEgKmNhcHR1
cmUsCiAJcmV0dXJuIGNhcHR1cmU7CiB9CiAKLXN0YXRpYyBzdHJ1Y3QgaTkxNV92bWFfY29yZWR1
bXAgKgotY2FwdHVyZV9vYmplY3QoY29uc3Qgc3RydWN0IGludGVsX2d0ICpndCwKLQkgICAgICAg
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKLQkgICAgICAgY29uc3QgY2hhciAqbmFt
ZSwKLQkgICAgICAgc3RydWN0IGk5MTVfdm1hX2NvbXByZXNzICpjb21wcmVzcykKLXsKLQlpZiAo
b2JqICYmIGk5MTVfZ2VtX29iamVjdF9oYXNfcGFnZXMob2JqKSkgewotCQlzdHJ1Y3QgaTkxNV92
bWEgZmFrZSA9IHsKLQkJCS5ub2RlID0geyAuc3RhcnQgPSBVNjRfTUFYLCAuc2l6ZSA9IG9iai0+
YmFzZS5zaXplIH0sCi0JCQkuc2l6ZSA9IG9iai0+YmFzZS5zaXplLAotCQkJLnBhZ2VzID0gb2Jq
LT5tbS5wYWdlcywKLQkJCS5vYmogPSBvYmosCi0JCX07Ci0KLQkJcmV0dXJuIGk5MTVfdm1hX2Nv
cmVkdW1wX2NyZWF0ZShndCwgJmZha2UsIG5hbWUsIGNvbXByZXNzKTsKLQl9IGVsc2UgewotCQly
ZXR1cm4gTlVMTDsKLQl9Ci19Ci0KIHN0YXRpYyB2b2lkIGFkZF92bWEoc3RydWN0IGludGVsX2Vu
Z2luZV9jb3JlZHVtcCAqZWUsCiAJCSAgICBzdHJ1Y3QgaTkxNV92bWFfY29yZWR1bXAgKnZtYSkK
IHsKQEAgLTE0MjYsMTIgKzE0MDYsNiBAQCBpbnRlbF9lbmdpbmVfY29yZWR1bXBfYWRkX3ZtYShz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NvcmVkdW1wICplZSwKIAkJCQkJIGVuZ2luZS0+d2FfY3R4LnZt
YSwKIAkJCQkJICJXQSBjb250ZXh0IiwKIAkJCQkJIGNvbXByZXNzKSk7Ci0KLQlhZGRfdm1hKGVl
LAotCQljYXB0dXJlX29iamVjdChlbmdpbmUtPmd0LAotCQkJICAgICAgIGVuZ2luZS0+ZGVmYXVs
dF9zdGF0ZSwKLQkJCSAgICAgICAiTlVMTCBjb250ZXh0IiwKLQkJCSAgICAgICBjb21wcmVzcykp
OwogfQogCiBzdGF0aWMgc3RydWN0IGludGVsX2VuZ2luZV9jb3JlZHVtcCAqCi0tIAoyLjIwLjEK
Cl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdm
eCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xp
c3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

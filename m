Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3CC3090815
	for <lists+intel-gfx@lfdr.de>; Fri, 16 Aug 2019 21:09:20 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A37666E989;
	Fri, 16 Aug 2019 19:09:18 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D4F7C6E989
 for <intel-gfx@lists.freedesktop.org>; Fri, 16 Aug 2019 19:09:17 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18167151-1500050 
 for multiple; Fri, 16 Aug 2019 20:09:05 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 16 Aug 2019 20:09:03 +0100
Message-Id: <20190816190903.3570-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190816175801.8215-1-chris@chris-wilson.co.uk>
References: <20190816175801.8215-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2] drm/i915/selftests: Check the context size
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWRkIGEgcmVkem9uZSB0byBvdXIgY29udGV4dCBpbWFnZSBhbmQgY2hlY2sgdGhlIEhXIGRvZXMg
bm90IHdyaXRlIGludG8KYWZ0ZXIgYSBjb250ZXh0IHNhdmUsIHRvIHZlcmlmeSB0aGF0IHdlIGhh
dmUgdGhlIGNvcnJlY3QgY29udGV4dCBzaXplLgooVGhpcyBkb2VzIHZhcnkgd2l0aCBmZWF0dXJl
IGJpdHMsIHNvIHRlc3Qgd2l0aCBhIGxpdmUgc2V0dXAgdGhhdCBzaG91bGQKbWF0Y2ggaG93IHdl
IHJ1biB1c2Vyc3BhY2UuKQoKdjI6IENoZWNrIHRoZSByZWR6b25lIG9uIGV2ZXJ5IGNvbnRleHQg
dW5waW4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNv
LnVrPgpDYzogRGFuaWVsZSBDZXJhb2xvIFNwdXJpbyA8ZGFuaWVsZS5jZXJhb2xvc3B1cmlvQGlu
dGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyAgICAgICAg
fCAgMzMgKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYyB8
IDEzMyArKysrKysrKysrKysrKysrKysrKysKIDIgZmlsZXMgY2hhbmdlZCwgMTY2IGluc2VydGlv
bnMoKykKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCmluZGV4IGU5ODYzZjRkODI2Yi4u
YWRlMjEyNjg2YmY2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9s
cmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYwpAQCAtMTU3OCw5
ICsxNTc4LDM4IEBAIHN0YXRpYyB2b2lkIGV4ZWNsaXN0c19jb250ZXh0X2Rlc3Ryb3koc3RydWN0
IGtyZWYgKmtyZWYpCiAJaW50ZWxfY29udGV4dF9maW5pKGNlKTsKIAlpbnRlbF9jb250ZXh0X2Zy
ZWUoY2UpOwogfQorc3RhdGljIHZvaWQKK3NldF9yZWR6b25lKHZvaWQgKnZhZGRyLCBjb25zdCBz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCit7CisJaWYgKCFJU19FTkFCTEVEKENPTkZJ
R19EUk1fSTkxNV9ERUJVR19HRU0pKQorCQlyZXR1cm47CisKKwl2YWRkciArPSBMUkNfSEVBREVS
X1BBR0VTICogUEFHRV9TSVpFOworCXZhZGRyICs9IGVuZ2luZS0+Y29udGV4dF9zaXplOworCisJ
bWVtc2V0KHZhZGRyLCBQT0lTT05fSU5VU0UsIEk5MTVfR1RUX1BBR0VfU0laRSk7Cit9CisKK3N0
YXRpYyB2b2lkCitjaGVja19yZWR6b25lKGNvbnN0IHZvaWQgKnZhZGRyLCBjb25zdCBzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUpCit7CisJaWYgKCFJU19FTkFCTEVEKENPTkZJR19EUk1f
STkxNV9ERUJVR19HRU0pKQorCQlyZXR1cm47CisKKwl2YWRkciArPSBMUkNfSEVBREVSX1BBR0VT
ICogUEFHRV9TSVpFOworCXZhZGRyICs9IGVuZ2luZS0+Y29udGV4dF9zaXplOworCisJaWYgKG1l
bWNocl9pbnYodmFkZHIsIFBPSVNPTl9JTlVTRSwgSTkxNV9HVFRfUEFHRV9TSVpFKSkKKwkJZGV2
X2Vycl9vbmNlKGVuZ2luZS0+aTkxNS0+ZHJtLmRldiwKKwkJCSAgICAgIiVzIGNvbnRleHQgcmVk
em9uZSBvdmVyd3JpdHRlbiFcbiIsCisJCQkgICAgIGVuZ2luZS0+bmFtZSk7Cit9CiAKIHN0YXRp
YyB2b2lkIGV4ZWNsaXN0c19jb250ZXh0X3VucGluKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkK
IHsKKwljaGVja19yZWR6b25lKCh2b2lkICopY2UtPmxyY19yZWdfc3RhdGUgLSBMUkNfU1RBVEVf
UE4gKiBQQUdFX1NJWkUsCisJCSAgICAgIGNlLT5lbmdpbmUpOworCiAJaTkxNV9nZW1fY29udGV4
dF91bnBpbl9od19pZChjZS0+Z2VtX2NvbnRleHQpOwogCWk5MTVfZ2VtX29iamVjdF91bnBpbl9t
YXAoY2UtPnN0YXRlLT5vYmopOwogCWludGVsX3JpbmdfcmVzZXQoY2UtPnJpbmcsIGNlLT5yaW5n
LT50YWlsKTsKQEAgLTMxMTksNiArMzE0OCw4IEBAIHBvcHVsYXRlX2xyX2NvbnRleHQoc3RydWN0
IGludGVsX2NvbnRleHQgKmNlLAogCQlyZXR1cm4gcmV0OwogCX0KIAorCXNldF9yZWR6b25lKHZh
ZGRyLCBlbmdpbmUpOworCiAJaWYgKGVuZ2luZS0+ZGVmYXVsdF9zdGF0ZSkgewogCQkvKgogCQkg
KiBXZSBvbmx5IHdhbnQgdG8gY29weSBvdmVyIHRoZSB0ZW1wbGF0ZSBjb250ZXh0IHN0YXRlOwpA
QCAtMzE3Myw2ICszMjA0LDggQEAgc3RhdGljIGludCBfX2V4ZWNsaXN0c19jb250ZXh0X2FsbG9j
KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKIAkgKiBmb3Igb3VyIG93biB1c2UgYW5kIGZvciBz
aGFyaW5nIHdpdGggdGhlIEd1Qy4KIAkgKi8KIAljb250ZXh0X3NpemUgKz0gTFJDX0hFQURFUl9Q
QUdFUyAqIFBBR0VfU0laRTsKKwlpZiAoSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfREVCVUdf
R0VNKSkKKwkJY29udGV4dF9zaXplICs9IEk5MTVfR1RUX1BBR0VfU0laRTsgLyogZm9yIHJlZHpv
bmUgKi8KIAogCWN0eF9vYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtKGVuZ2luZS0+
aTkxNSwgY29udGV4dF9zaXplKTsKIAlpZiAoSVNfRVJSKGN0eF9vYmopKQpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jCmluZGV4IDZmYmM3MmJjMjkwZS4uMGQzYWZi
ZjRkNGRjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250
ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jCkBA
IC01LDYgKzUsNyBAQAogICovCiAKICNpbmNsdWRlICJpOTE1X3NlbGZ0ZXN0LmgiCisjaW5jbHVk
ZSAiaW50ZWxfZW5naW5lX3BtLmgiCiAjaW5jbHVkZSAiaW50ZWxfZ3QuaCIKIAogI2luY2x1ZGUg
ImdlbS9zZWxmdGVzdHMvbW9ja19jb250ZXh0LmgiCkBAIC02NCw2ICs2NSwxMzcgQEAgc3RhdGlj
IGludCBjb250ZXh0X3N5bmMoc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogCXJldHVybiBlcnI7
CiB9CiAKK3N0YXRpYyBpbnQgX19saXZlX2NvbnRleHRfc2l6ZShzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmUsCisJCQkgICAgICAgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmZpeG1lKQor
eworCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKKwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsK
Kwl2b2lkICp2YWRkcjsKKwlpbnQgZXJyOworCisJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShm
aXhtZSwgZW5naW5lKTsKKwlpZiAoSVNfRVJSKGNlKSkKKwkJcmV0dXJuIFBUUl9FUlIoY2UpOwor
CisJZXJyID0gaW50ZWxfY29udGV4dF9waW4oY2UpOworCWlmIChlcnIpCisJCWdvdG8gZXJyOwor
CisJdmFkZHIgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChjZS0+c3RhdGUtPm9iaiwKKwkJCQkJ
aTkxNV9jb2hlcmVudF9tYXBfdHlwZShlbmdpbmUtPmk5MTUpKTsKKwlpZiAoSVNfRVJSKHZhZGRy
KSkgeworCQllcnIgPSBQVFJfRVJSKHZhZGRyKTsKKwkJaW50ZWxfY29udGV4dF91bnBpbihjZSk7
CisJCWdvdG8gZXJyOworCX0KKworCWlmIChIQVNfRVhFQ0xJU1RTKGVuZ2luZS0+aTkxNSkpCisJ
CXZhZGRyICs9IExSQ19IRUFERVJfUEFHRVMgKiBQQUdFX1NJWkU7CisKKwl2YWRkciArPSBlbmdp
bmUtPmNvbnRleHRfc2l6ZSAtIEk5MTVfR1RUX1BBR0VfU0laRTsKKwltZW1zZXQodmFkZHIsIFBP
SVNPTl9JTlVTRSwgSTkxNV9HVFRfUEFHRV9TSVpFKTsKKworCXJxID0gaW50ZWxfY29udGV4dF9j
cmVhdGVfcmVxdWVzdChjZSk7CisJaW50ZWxfY29udGV4dF91bnBpbihjZSk7CisJaWYgKElTX0VS
UihycSkpIHsKKwkJZXJyID0gUFRSX0VSUihycSk7CisJCWdvdG8gZXJyX3VucGluOworCX0KKwor
CWVyciA9IHJlcXVlc3Rfc3luYyhycSk7CisJaWYgKGVycikKKwkJZ290byBlcnJfdW5waW47CisK
KwkvKiBGb3JjZSB0aGUgY29udGV4dCBzd2l0Y2ggKi8KKwlycSA9IGk5MTVfcmVxdWVzdF9jcmVh
dGUoZW5naW5lLT5rZXJuZWxfY29udGV4dCk7CisJaWYgKElTX0VSUihycSkpIHsKKwkJZXJyID0g
UFRSX0VSUihycSk7CisJCWdvdG8gZXJyX3VucGluOworCX0KKwllcnIgPSByZXF1ZXN0X3N5bmMo
cnEpOworCWlmIChlcnIpCisJCWdvdG8gZXJyX3VucGluOworCisJaWYgKG1lbWNocl9pbnYodmFk
ZHIsIFBPSVNPTl9JTlVTRSwgSTkxNV9HVFRfUEFHRV9TSVpFKSkgeworCQlwcl9lcnIoIiVzIGNv
bnRleHQgb3Zlcndyb3RlIHRyYWlsaW5nIHJlZC16b25lISIsIGVuZ2luZS0+bmFtZSk7CisJCWVy
ciA9IC1FSU5WQUw7CisJfQorCitlcnJfdW5waW46CisJaTkxNV9nZW1fb2JqZWN0X3VucGluX21h
cChjZS0+c3RhdGUtPm9iaik7CitlcnI6CisJaW50ZWxfY29udGV4dF9wdXQoY2UpOworCXJldHVy
biBlcnI7Cit9CisKK3N0YXRpYyBpbnQgbGl2ZV9jb250ZXh0X3NpemUodm9pZCAqYXJnKQorewor
CXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lOworCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpmaXhtZTsKKwllbnVtIGludGVsX2VuZ2lu
ZV9pZCBpZDsKKwlzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGU7CisJaW50IGVyciA9IDA7CisKKwkvKgor
CSAqIENoZWNrIHRoYXQgb3VyIGNvbnRleHQgc2l6ZXMgYXJlIGNvcnJlY3QgYnkgc2VlaW5nIGlm
IHRoZQorCSAqIEhXIHRyaWVzIHRvIHdyaXRlIHBhc3QgdGhlIGVuZCBvZiBvbmUuCisJICovCisK
KwlmaWxlID0gbW9ja19maWxlKGd0LT5pOTE1KTsKKwlpZiAoSVNfRVJSKGZpbGUpKQorCQlyZXR1
cm4gUFRSX0VSUihmaWxlKTsKKworCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKKworCWZpeG1lID0gbGl2ZV9jb250ZXh0KGd0LT5pOTE1LCBmaWxlKTsKKwlpZiAoSVNf
RVJSKGZpeG1lKSkgeworCQllcnIgPSBQVFJfRVJSKGZpeG1lKTsKKwkJZ290byB1bmxvY2s7CisJ
fQorCisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5MTUsIGlkKSB7CisJCXN0cnVjdCB7
CisJCQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqc3RhdGU7CisJCQl2b2lkICpwaW5uZWQ7
CisJCX0gc2F2ZWQ7CisKKwkJaWYgKCFlbmdpbmUtPmNvbnRleHRfc2l6ZSkKKwkJCWNvbnRpbnVl
OworCisJCWludGVsX2VuZ2luZV9wbV9nZXQoZW5naW5lKTsKKworCQkvKgorCQkgKiBIaWRlIHRo
ZSBvbGQgZGVmYXVsdCBzdGF0ZSAtLSB3ZSBsaWUgYWJvdXQgdGhlIGNvbnRleHQgc2l6ZQorCQkg
KiBhbmQgZ2V0IGNvbmZ1c2VkIHdoZW4gdGhlIGRlZmF1bHQgc3RhdGUgaXMgc21hbGxlciB0aGFu
CisJCSAqIGV4cGVjdGVkLiBGb3Igb3VyIGRvIG5vdGhpbmcgcmVxdWVzdCwgaW5oZXJpdGluZyB0
aGUKKwkJICogYWN0aXZlIHN0YXRlIGlzIHN1ZmZpY2llbnQsIHdlIGFyZSBvbmx5IGNoZWNraW5n
IHRoYXQgd2UKKwkJICogZG9uJ3QgdXNlIG1vcmUgdGhhbiB3ZSBwbGFubmVkLgorCQkgKi8KKwkJ
c2F2ZWQuc3RhdGUgPSBmZXRjaF9hbmRfemVybygmZW5naW5lLT5kZWZhdWx0X3N0YXRlKTsKKwkJ
c2F2ZWQucGlubmVkID0gZmV0Y2hfYW5kX3plcm8oJmVuZ2luZS0+cGlubmVkX2RlZmF1bHRfc3Rh
dGUpOworCisJCWVuZ2luZS0+Y29udGV4dF9zaXplICs9IEk5MTVfR1RUX1BBR0VfU0laRTsKKwor
CQllcnIgPSBfX2xpdmVfY29udGV4dF9zaXplKGVuZ2luZSwgZml4bWUpOworCisJCWVuZ2luZS0+
Y29udGV4dF9zaXplIC09IEk5MTVfR1RUX1BBR0VfU0laRTsKKworCQllbmdpbmUtPnBpbm5lZF9k
ZWZhdWx0X3N0YXRlID0gc2F2ZWQucGlubmVkOworCQllbmdpbmUtPmRlZmF1bHRfc3RhdGUgPSBz
YXZlZC5zdGF0ZTsKKworCQlpbnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2luZSk7CisKKwkJaWYgKGVy
cikKKwkJCWJyZWFrOworCX0KKwordW5sb2NrOgorCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOworCW1vY2tfZmlsZV9mcmVlKGd0LT5pOTE1LCBmaWxlKTsKKwlyZXR1
cm4gZXJyOworfQorCiBzdGF0aWMgaW50IF9fbGl2ZV9hY3RpdmVfY29udGV4dChzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJCQkJIHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpmaXht
ZSkKIHsKQEAgLTMwMyw2ICs0MzUsNyBAQCBzdGF0aWMgaW50IGxpdmVfcmVtb3RlX2NvbnRleHQo
dm9pZCAqYXJnKQogaW50IGludGVsX2NvbnRleHRfbGl2ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3RhdGljIGNvbnN0IHN0cnVjdCBpOTE1X3N1YnRlc3Qg
dGVzdHNbXSA9IHsKKwkJU1VCVEVTVChsaXZlX2NvbnRleHRfc2l6ZSksCiAJCVNVQlRFU1QobGl2
ZV9hY3RpdmVfY29udGV4dCksCiAJCVNVQlRFU1QobGl2ZV9yZW1vdGVfY29udGV4dCksCiAJfTsK
LS0gCjIuMjMuMC5yYzEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVs
LWdmeA==

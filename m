Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 73B5CD02FC
	for <lists+intel-gfx@lfdr.de>; Tue,  8 Oct 2019 23:40:41 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C1BE089B48;
	Tue,  8 Oct 2019 21:40:37 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id EC55B89A67
 for <intel-gfx@lists.freedesktop.org>; Tue,  8 Oct 2019 21:40:31 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18770558-1500050 
 for multiple; Tue, 08 Oct 2019 22:40:23 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue,  8 Oct 2019 22:40:17 +0100
Message-Id: <20191008214021.5120-6-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191008214021.5120-1-chris@chris-wilson.co.uk>
References: <20191008214021.5120-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 5/9] drm/i915/perf: implement active wait for
 noa configurations
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwuY29tPgoK
Tk9BIGNvbmZpZ3VyYXRpb24gdGFrZSBzb21lIGFtb3VudCBvZiB0aW1lIHRvIGFwcGx5LiBUaGF0
IGFtb3VudCBvZgp0aW1lIGRlcGVuZHMgb24gdGhlIHNpemUgb2YgdGhlIEdULiBUaGVyZSBpcyBu
byBkb2N1bWVudGVkIHRpbWUgZm9yCnRoaXMuIEZvciBleGFtcGxlLCBwYXN0IGV4cGVyaW1lbnRh
dGlvbnMgd2l0aCBwb3dlcmdhdGluZwpjb25maWd1cmF0aW9uIGNoYW5nZXMgc2VlbSB0byBpbmRp
Y2F0ZSBhIDYwfjcwdXMgZGVsYXkuIFdlIGdvIHdpdGgKNTAwdXMgYXMgZGVmYXVsdCBmb3Igbm93
IHdoaWNoIHNob3VsZCBiZSBvdmVyIHRoZSByZXF1aXJlZCBhbW91bnQgb2YKdGltZSAoYWNjb3Jk
aW5nIHRvIEhXIGFyY2hpdGVjdHMpLgoKdjI6IERvbid0IGZvcmdldCB0byBzYXZlL3Jlc3RvcmUg
cmVnaXN0ZXJzIHVzZWQgZm9yIHRoZSB3YWl0IChDaHJpcykKCnYzOiBOYW1lIHVzZWQgQ1NfR1BS
IHJlZ2lzdGVycyAoQ2hyaXMpCiAgICBGaXggY29tcGlsZSBpc3N1ZSBkdWUgdG8gcmViYXNlIChM
aW9uZWwpCgp2NDogRml4IHNhdmUvcmVzdG9yZSBoZWxwZXJzIChVbWVzaCkKCnY1OiBNb3ZlIG5v
YV93YWl0IGZyb20gZHJtX2k5MTVfcHJpdmF0ZSB0byBpOTE1X3BlcmZfc3RyZWFtIChMaW9uZWwp
Cgp2NjogQWRkIG1pc3Npbmcgc3RydWN0IGRlY2xhcmF0aW9ucyBpbiBpOTE1X3BlcmYuaAoKU2ln
bmVkLW9mZi1ieTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwu
Y29tPgpSZXZpZXdlZC1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+
ICh2NCkKLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMuaCAg
fCAgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmggICAgICB8
ICAgNSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyAgICAgICAgICAgfCAg
MzIgKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyAgICAgICAgICAgICAgfCAy
MzIgKysrKysrKysrKysrKysrKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmZfdHlw
ZXMuaCAgICAgICAgfCAgIDggKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaCAgICAg
ICAgICAgICAgIHwgICA0ICstCiAuLi4vZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxm
dGVzdHMuaCAgfCAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfcGVy
Zi5jICAgIHwgMTk2ICsrKysrKysrKysrKysrKwogOCBmaWxlcyBjaGFuZ2VkLCA0NzggaW5zZXJ0
aW9ucygrKSwgNCBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9wZXJmLmMKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2dwdV9jb21tYW5kcy5oCmluZGV4IDA5ODcxMDBjNzg2Yi4uOGU2M2NmZmNhYmUwIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMuaApAQCAtMTYz
LDcgKzE2Myw4IEBACiAjZGVmaW5lIE1JX0JBVENIX0JVRkZFUl9TVEFSVAlNSV9JTlNUUigweDMx
LCAwKQogI2RlZmluZSAgIE1JX0JBVENIX0dUVAkJICAgICgyPDw2KSAvKiBhbGlhc2VkIHdpdGgg
KDE8PDcpIG9uIGdlbjQgKi8KICNkZWZpbmUgTUlfQkFUQ0hfQlVGRkVSX1NUQVJUX0dFTjgJTUlf
SU5TVFIoMHgzMSwgMSkKLSNkZWZpbmUgICBNSV9CQVRDSF9SRVNPVVJDRV9TVFJFQU1FUiAoMTw8
MTApCisjZGVmaW5lICAgTUlfQkFUQ0hfUkVTT1VSQ0VfU1RSRUFNRVIgUkVHX0JJVCgxMCkKKyNk
ZWZpbmUgICBNSV9CQVRDSF9QUkVESUNBVEUgICAgICAgICBSRUdfQklUKDE1KSAvKiBIU1crIG9u
IFJDUyBvbmx5Ki8KIAogLyoKICAqIDNEIGluc3RydWN0aW9ucyB1c2VkIGJ5IHRoZSBrZXJuZWwK
QEAgLTIyNCw2ICsyMjUsNyBAQAogI2RlZmluZSAgIFBJUEVfQ09OVFJPTF9DU19TVEFMTAkJCQko
MTw8MjApCiAjZGVmaW5lICAgUElQRV9DT05UUk9MX1RMQl9JTlZBTElEQVRFCQkJKDE8PDE4KQog
I2RlZmluZSAgIFBJUEVfQ09OVFJPTF9NRURJQV9TVEFURV9DTEVBUgkJKDE8PDE2KQorI2RlZmlu
ZSAgIFBJUEVfQ09OVFJPTF9XUklURV9USU1FU1RBTVAJCQkoMzw8MTQpCiAjZGVmaW5lICAgUElQ
RV9DT05UUk9MX1FXX1dSSVRFCQkJCSgxPDwxNCkKICNkZWZpbmUgICBQSVBFX0NPTlRST0xfUE9T
VF9TWU5DX09QX01BU0sgICAgICAgICAgICAgICAgKDM8PDE0KQogI2RlZmluZSAgIFBJUEVfQ09O
VFJPTF9ERVBUSF9TVEFMTAkJCSgxPDwxMykKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2d0X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9n
dF90eXBlcy5oCmluZGV4IDgwMmY1MTZhMzQzMC4uYmU0YjI2MzYyMWM4IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmgKQEAgLTEwOSw2ICsxMDksMTEgQEAgZW51bSBp
bnRlbF9ndF9zY3JhdGNoX2ZpZWxkIHsKIAkvKiA4IGJ5dGVzICovCiAJSU5URUxfR1RfU0NSQVRD
SF9GSUVMRF9DT0hFUkVOVEwzX1dBID0gMjU2LAogCisJLyogNiAqIDggYnl0ZXMgKi8KKwlJTlRF
TF9HVF9TQ1JBVENIX0ZJRUxEX1BFUkZfQ1NfR1BSID0gMjA0OCwKKworCS8qIDQgYnl0ZXMgKi8K
KwlJTlRFTF9HVF9TQ1JBVENIX0ZJRUxEX1BFUkZfUFJFRElDQVRFX1JFU1VMVF8xID0gMjA5NiwK
IH07CiAKICNlbmRpZiAvKiBfX0lOVEVMX0dUX1RZUEVTX0hfXyAqLwpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2RlYnVnZnMuYwppbmRleCAyNzdmMzEyOTdmMjkuLmQ0NjNhMjhiNzQ3NSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKQEAgLTM1OTAsNiArMzU5MCwzNyBAQCBERUZJTkVfU0lN
UExFX0FUVFJJQlVURShpOTE1X3dlZGdlZF9mb3BzLAogCQkJaTkxNV93ZWRnZWRfZ2V0LCBpOTE1
X3dlZGdlZF9zZXQsCiAJCQkiJWxsdVxuIik7CiAKK3N0YXRpYyBpbnQKK2k5MTVfcGVyZl9ub2Ff
ZGVsYXlfc2V0KHZvaWQgKmRhdGEsIHU2NCB2YWwpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSBkYXRhOworCWNvbnN0IHUzMiBjbGsgPSBSVU5USU1FX0lORk8oaTkxNSktPmNz
X3RpbWVzdGFtcF9mcmVxdWVuY3lfa2h6OworCisJLyoKKwkgKiBUaGlzIHdvdWxkIGxlYWQgdG8g
aW5maW5pdGUgd2FpdHMgYXMgd2UncmUgZG9pbmcgdGltZXN0YW1wCisJICogZGlmZmVyZW5jZSBv
biB0aGUgQ1Mgd2l0aCBvbmx5IDMyYml0cy4KKwkgKi8KKwlpZiAodmFsID4gbXVsX3UzMl91MzIo
VTMyX01BWCwgY2xrKSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlhdG9taWM2NF9zZXQoJmk5MTUt
PnBlcmYubm9hX3Byb2dyYW1taW5nX2RlbGF5LCB2YWwpOworCXJldHVybiAwOworfQorCitzdGF0
aWMgaW50CitpOTE1X3BlcmZfbm9hX2RlbGF5X2dldCh2b2lkICpkYXRhLCB1NjQgKnZhbCkKK3sK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGRhdGE7CisKKwkqdmFsID0gYXRvbWlj
NjRfcmVhZCgmaTkxNS0+cGVyZi5ub2FfcHJvZ3JhbW1pbmdfZGVsYXkpOworCXJldHVybiAwOwor
fQorCitERUZJTkVfU0lNUExFX0FUVFJJQlVURShpOTE1X3BlcmZfbm9hX2RlbGF5X2ZvcHMsCisJ
CQlpOTE1X3BlcmZfbm9hX2RlbGF5X2dldCwKKwkJCWk5MTVfcGVyZl9ub2FfZGVsYXlfc2V0LAor
CQkJIiVsbHVcbiIpOworCiAjZGVmaW5lIERST1BfVU5CT1VORAlCSVQoMCkKICNkZWZpbmUgRFJP
UF9CT1VORAlCSVQoMSkKICNkZWZpbmUgRFJPUF9SRVRJUkUJQklUKDIpCkBAIC00MzQwLDYgKzQz
NzEsNyBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGk5MTVfZGVidWdmc19maWxlcyB7CiAJY29uc3Qg
Y2hhciAqbmFtZTsKIAljb25zdCBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zICpmb3BzOwogfSBpOTE1
X2RlYnVnZnNfZmlsZXNbXSA9IHsKKwl7Imk5MTVfcGVyZl9ub2FfZGVsYXkiLCAmaTkxNV9wZXJm
X25vYV9kZWxheV9mb3BzfSwKIAl7Imk5MTVfd2VkZ2VkIiwgJmk5MTVfd2VkZ2VkX2ZvcHN9LAog
CXsiaTkxNV9jYWNoZV9zaGFyaW5nIiwgJmk5MTVfY2FjaGVfc2hhcmluZ19mb3BzfSwKIAl7Imk5
MTVfZ2VtX2Ryb3BfY2FjaGVzIiwgJmk5MTVfZHJvcF9jYWNoZXNfZm9wc30sCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfcGVyZi5jCmluZGV4IDE4M2YxYWMzMWUzNi4uNjU1OTgwMjc2ZTk2IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3BlcmYuYwpAQCAtMTk4LDYgKzE5OCw3IEBACiAjaW5jbHVkZSAiZ2VtL2k5MTVf
Z2VtX2NvbnRleHQuaCIKICNpbmNsdWRlICJnZW0vaTkxNV9nZW1fcG0uaCIKICNpbmNsdWRlICJn
dC9pbnRlbF9lbmdpbmVfdXNlci5oIgorI2luY2x1ZGUgImd0L2ludGVsX2d0LmgiCiAjaW5jbHVk
ZSAiZ3QvaW50ZWxfbHJjX3JlZy5oIgogCiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIKQEAgLTQ2Miw3
ICs0NjMsNyBAQCBhbGxvY19vYV9jb25maWdfYnVmZmVyKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFt
ICpzdHJlYW0sCiAJY29uZmlnX2xlbmd0aCArPSBudW1fbHJpX2R3b3JkcyhvYV9jb25maWctPm11
eF9yZWdzX2xlbik7CiAJY29uZmlnX2xlbmd0aCArPSBudW1fbHJpX2R3b3JkcyhvYV9jb25maWct
PmJfY291bnRlcl9yZWdzX2xlbik7CiAJY29uZmlnX2xlbmd0aCArPSBudW1fbHJpX2R3b3Jkcyhv
YV9jb25maWctPmZsZXhfcmVnc19sZW4pOwotCWNvbmZpZ19sZW5ndGgrKzsgLyogTUlfQkFUQ0hf
QlVGRkVSX0VORCAqLworCWNvbmZpZ19sZW5ndGggKz0gMzsgLyogTUlfQkFUQ0hfQlVGRkVSX1NU
QVJUIGludG8gbm9hX3dhaXQgbG9vcCAqLwogCWNvbmZpZ19sZW5ndGggPSBBTElHTihzaXplb2Yo
dTMyKSAqIGNvbmZpZ19sZW5ndGgsIEk5MTVfR1RUX1BBR0VfU0laRSk7CiAKIAlvYmogPSBpOTE1
X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtKHN0cmVhbS0+cGVyZi0+aTkxNSwgY29uZmlnX2xlbmd0
aCk7CkBAIC00ODcsNyArNDg4LDEyIEBAIGFsbG9jX29hX2NvbmZpZ19idWZmZXIoc3RydWN0IGk5
MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwKIAkJCSAgICAgb2FfY29uZmlnLT5mbGV4X3JlZ3MsCiAJ
CQkgICAgIG9hX2NvbmZpZy0+ZmxleF9yZWdzX2xlbik7CiAKLQkqY3MrKyA9IE1JX0JBVENIX0JV
RkZFUl9FTkQ7CisJLyogSnVtcCBpbnRvIHRoZSBOT0Egd2FpdCBidXN5IGxvb3AuICovCisJKmNz
KysgPSBJTlRFTF9HRU4oc3RyZWFtLT5wZXJmLT5pOTE1KSA8IDggPworCQlNSV9CQVRDSF9CVUZG
RVJfU1RBUlQgOgorCQlNSV9CQVRDSF9CVUZGRVJfU1RBUlRfR0VOODsKKwkqY3MrKyA9IGk5MTVf
Z2d0dF9vZmZzZXQoc3RyZWFtLT5ub2Ffd2FpdCk7CisJKmNzKysgPSAwOwogCiAJaTkxNV9nZW1f
b2JqZWN0X2ZsdXNoX21hcChvYmopOwogCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAob2JqKTsK
QEAgLTE1MDAsNiArMTUwNiwxMiBAQCBmcmVlX29hX2J1ZmZlcihzdHJ1Y3QgaTkxNV9wZXJmX3N0
cmVhbSAqc3RyZWFtKQogCXN0cmVhbS0+b2FfYnVmZmVyLnZhZGRyID0gTlVMTDsKIH0KIAorc3Rh
dGljIHZvaWQKK2ZyZWVfbm9hX3dhaXQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkK
K3sKKwlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmc3RyZWFtLT5ub2Ffd2FpdCwgMCk7Cit9
CisKIHN0YXRpYyB2b2lkCiBmcmVlX29hX2NvbmZpZ3Moc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0g
KnN0cmVhbSkKIHsKQEAgLTE1MjQsNiArMTUzNiw3IEBAIHN0YXRpYyB2b2lkIGk5MTVfb2Ffc3Ry
ZWFtX2Rlc3Ryb3koc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIAlwZXJmLT5vcHMu
ZGlzYWJsZV9tZXRyaWNfc2V0KHN0cmVhbSk7CiAKIAlmcmVlX29hX2J1ZmZlcihzdHJlYW0pOwor
CWZyZWVfbm9hX3dhaXQoc3RyZWFtKTsKIAogCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KHN0
cmVhbS0+Z3QtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CiAJaW50ZWxfcnVudGltZV9wbV9wdXQo
c3RyZWFtLT5ndC0+dW5jb3JlLT5ycG0sIHN0cmVhbS0+d2FrZXJlZik7CkBAIC0xNjk2LDYgKzE3
MDksMjA1IEBAIHN0YXRpYyBpbnQgYWxsb2Nfb2FfYnVmZmVyKHN0cnVjdCBpOTE1X3BlcmZfc3Ry
ZWFtICpzdHJlYW0pCiAJcmV0dXJuIHJldDsKIH0KIAorc3RhdGljIHUzMiAqc2F2ZV9yZXN0b3Jl
X3JlZ2lzdGVyKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sIHUzMiAqY3MsCisJCQkJ
ICBib29sIHNhdmUsIGk5MTVfcmVnX3QgcmVnLCB1MzIgb2Zmc2V0LAorCQkJCSAgdTMyIGR3b3Jk
X2NvdW50KQoreworCXUzMiBjbWQ7CisJdTMyIGQ7CisKKwljbWQgPSBzYXZlID8gTUlfU1RPUkVf
UkVHSVNURVJfTUVNIDogTUlfTE9BRF9SRUdJU1RFUl9NRU07CisJaWYgKElOVEVMX0dFTihzdHJl
YW0tPnBlcmYtPmk5MTUpID49IDgpCisJCWNtZCsrOworCisJZm9yIChkID0gMDsgZCA8IGR3b3Jk
X2NvdW50OyBkKyspIHsKKwkJKmNzKysgPSBjbWQ7CisJCSpjcysrID0gaTkxNV9tbWlvX3JlZ19v
ZmZzZXQocmVnKSArIDQgKiBkOworCQkqY3MrKyA9IGludGVsX2d0X3NjcmF0Y2hfb2Zmc2V0KHN0
cmVhbS0+Z3QsIG9mZnNldCkgKyA0ICogZDsKKwkJKmNzKysgPSAwOworCX0KKworCXJldHVybiBj
czsKK30KKworc3RhdGljIGludCBhbGxvY19ub2Ffd2FpdChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVh
bSAqc3RyZWFtKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gc3RyZWFtLT5w
ZXJmLT5pOTE1OworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpibzsKKwlzdHJ1Y3QgaTkx
NV92bWEgKnZtYTsKKwljb25zdCB1NjQgZGVsYXlfdGlja3MgPSAweGZmZmZmZmZmZmZmZmZmZmYg
LQorCQlESVY2NF9VNjRfUk9VTkRfVVAoCisJCQlhdG9taWM2NF9yZWFkKCZzdHJlYW0tPnBlcmYt
Pm5vYV9wcm9ncmFtbWluZ19kZWxheSkgKgorCQkJUlVOVElNRV9JTkZPKGk5MTUpLT5jc190aW1l
c3RhbXBfZnJlcXVlbmN5X2toeiwKKwkJCTEwMDAwMDB1bGwpOworCWNvbnN0IHUzMiBiYXNlID0g
c3RyZWFtLT5lbmdpbmUtPm1taW9fYmFzZTsKKyNkZWZpbmUgQ1NfR1BSKHgpIEdFTjhfUklOR19D
U19HUFIoYmFzZSwgeCkKKwl1MzIgKmJhdGNoLCAqdHMwLCAqY3MsICpqdW1wOworCWludCByZXQs
IGk7CisJZW51bSB7CisJCVNUQVJUX1RTLAorCQlOT1dfVFMsCisJCURFTFRBX1RTLAorCQlKVU1Q
X1BSRURJQ0FURSwKKwkJREVMVEFfVEFSR0VULAorCQlOX0NTX0dQUgorCX07CisKKwlibyA9IGk5
MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoaTkxNSwgNDA5Nik7CisJaWYgKElTX0VSUihi
bykpIHsKKwkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gYWxsb2NhdGUgTk9BIHdhaXQgYmF0Y2hidWZm
ZXJcbiIpOworCQlyZXR1cm4gUFRSX0VSUihibyk7CisJfQorCisJLyoKKwkgKiBXZSBwaW4gaW4g
R0dUVCBiZWNhdXNlIHdlIGp1bXAgaW50byB0aGlzIGJ1ZmZlciBub3cgYmVjYXVzZQorCSAqIG11
bHRpcGxlIE9BIGNvbmZpZyBCT3Mgd2lsbCBoYXZlIGEganVtcCB0byB0aGlzIGFkZHJlc3MgYW5k
IGl0CisJICogbmVlZHMgdG8gYmUgZml4ZWQgZHVyaW5nIHRoZSBsaWZldGltZSBvZiB0aGUgaTkx
NS9wZXJmIHN0cmVhbS4KKwkgKi8KKwl2bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4oYm8s
IE5VTEwsIDAsIDAsIFBJTl9ISUdIKTsKKwlpZiAoSVNfRVJSKHZtYSkpIHsKKwkJcmV0ID0gUFRS
X0VSUih2bWEpOworCQlnb3RvIGVycl91bnJlZjsKKwl9CisKKwliYXRjaCA9IGNzID0gaTkxNV9n
ZW1fb2JqZWN0X3Bpbl9tYXAoYm8sIEk5MTVfTUFQX1dCKTsKKwlpZiAoSVNfRVJSKGJhdGNoKSkg
eworCQlyZXQgPSBQVFJfRVJSKGJhdGNoKTsKKwkJZ290byBlcnJfdW5waW47CisJfQorCisJLyog
U2F2ZSByZWdpc3RlcnMuICovCisJZm9yIChpID0gMDsgaSA8IE5fQ1NfR1BSOyBpKyspCisJCWNz
ID0gc2F2ZV9yZXN0b3JlX3JlZ2lzdGVyKAorCQkJc3RyZWFtLCBjcywgdHJ1ZSAvKiBzYXZlICov
LCBDU19HUFIoaSksCisJCQlJTlRFTF9HVF9TQ1JBVENIX0ZJRUxEX1BFUkZfQ1NfR1BSICsgOCAq
IGksIDIpOworCWNzID0gc2F2ZV9yZXN0b3JlX3JlZ2lzdGVyKAorCQlzdHJlYW0sIGNzLCB0cnVl
IC8qIHNhdmUgKi8sIE1JX1BSRURJQ0FURV9SRVNVTFRfMSwKKwkJSU5URUxfR1RfU0NSQVRDSF9G
SUVMRF9QRVJGX1BSRURJQ0FURV9SRVNVTFRfMSwgMSk7CisKKwkvKiBGaXJzdCB0aW1lc3RhbXAg
c25hcHNob3QgbG9jYXRpb24uICovCisJdHMwID0gY3M7CisKKwkvKgorCSAqIEluaXRpYWwgc25h
cHNob3Qgb2YgdGhlIHRpbWVzdGFtcCByZWdpc3RlciB0byBpbXBsZW1lbnQgdGhlIHdhaXQuCisJ
ICogV2Ugd29yayB3aXRoIDMyYiB2YWx1ZXMsIHNvIGNsZWFyIG91dCB0aGUgdG9wIDMyYiBiaXRz
IG9mIHRoZQorCSAqIHJlZ2lzdGVyIGJlY2F1c2UgdGhlIEFMVSB3b3JrcyA2NGJpdHMuCisJICov
CisJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX0lNTSgxKTsKKwkqY3MrKyA9IGk5MTVfbW1pb19y
ZWdfb2Zmc2V0KENTX0dQUihTVEFSVF9UUykpICsgNDsKKwkqY3MrKyA9IDA7CisJKmNzKysgPSBN
SV9MT0FEX1JFR0lTVEVSX1JFRyB8ICgzIC0gMik7CisJKmNzKysgPSBpOTE1X21taW9fcmVnX29m
ZnNldChSSU5HX1RJTUVTVEFNUChiYXNlKSk7CisJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNl
dChDU19HUFIoU1RBUlRfVFMpKTsKKworCS8qCisJICogVGhpcyBpcyB0aGUgbG9jYXRpb24gd2Un
cmUgZ29pbmcgdG8ganVtcCBiYWNrIGludG8gdW50aWwgdGhlCisJICogcmVxdWlyZWQgYW1vdW50
IG9mIHRpbWUgaGFzIHBhc3NlZC4KKwkgKi8KKwlqdW1wID0gY3M7CisKKwkvKgorCSAqIFRha2Ug
YW5vdGhlciBzbmFwc2hvdCBvZiB0aGUgdGltZXN0YW1wIHJlZ2lzdGVyLiBUYWtlIGNhcmUgdG8g
Y2xlYXIKKwkgKiB1cCB0aGUgdG9wIDMyYml0cyBvZiBDU19HUFIoMSkgYXMgd2UncmUgdXNpbmcg
aXQgZm9yIG90aGVyCisJICogb3BlcmF0aW9ucyBiZWxvdy4KKwkgKi8KKwkqY3MrKyA9IE1JX0xP
QURfUkVHSVNURVJfSU1NKDEpOworCSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQoQ1NfR1BS
KE5PV19UUykpICsgNDsKKwkqY3MrKyA9IDA7CisJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX1JF
RyB8ICgzIC0gMik7CisJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChSSU5HX1RJTUVTVEFN
UChiYXNlKSk7CisJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChDU19HUFIoTk9XX1RTKSk7
CisKKwkvKgorCSAqIERvIGEgZGlmZiBiZXR3ZWVuIHRoZSAyIHRpbWVzdGFtcHMgYW5kIHN0b3Jl
IHRoZSByZXN1bHQgYmFjayBpbnRvCisJICogQ1NfR1BSKDEpLgorCSAqLworCSpjcysrID0gTUlf
TUFUSCg1KTsKKwkqY3MrKyA9IE1JX01BVEhfTE9BRChNSV9NQVRIX1JFR19TUkNBLCBNSV9NQVRI
X1JFRyhOT1dfVFMpKTsKKwkqY3MrKyA9IE1JX01BVEhfTE9BRChNSV9NQVRIX1JFR19TUkNCLCBN
SV9NQVRIX1JFRyhTVEFSVF9UUykpOworCSpjcysrID0gTUlfTUFUSF9TVUI7CisJKmNzKysgPSBN
SV9NQVRIX1NUT1JFKE1JX01BVEhfUkVHKERFTFRBX1RTKSwgTUlfTUFUSF9SRUdfQUNDVSk7CisJ
KmNzKysgPSBNSV9NQVRIX1NUT1JFKE1JX01BVEhfUkVHKEpVTVBfUFJFRElDQVRFKSwgTUlfTUFU
SF9SRUdfQ0YpOworCisJLyoKKwkgKiBUcmFuc2ZlciB0aGUgY2FycnkgZmxhZyAoc2V0IHRvIDEg
aWYgdHMxIDwgdHMwLCBtZWFuaW5nIHRoZQorCSAqIHRpbWVzdGFtcCBoYXZlIHJvbGxlZCBvdmVy
IHRoZSAzMmJpdHMpIGludG8gdGhlIHByZWRpY2F0ZSByZWdpc3RlcgorCSAqIHRvIGJlIHVzZWQg
Zm9yIHRoZSBwcmVkaWNhdGVkIGp1bXAuCisJICovCisJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVS
X1JFRyB8ICgzIC0gMik7CisJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChDU19HUFIoSlVN
UF9QUkVESUNBVEUpKTsKKwkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KE1JX1BSRURJQ0FU
RV9SRVNVTFRfMSk7CisKKwkvKiBSZXN0YXJ0IGZyb20gdGhlIGJlZ2lubmluZyBpZiB3ZSBoYWQg
dGltZXN0YW1wcyByb2xsIG92ZXIuICovCisJKmNzKysgPSAoSU5URUxfR0VOKGk5MTUpIDwgOCA/
CisJCSBNSV9CQVRDSF9CVUZGRVJfU1RBUlQgOgorCQkgTUlfQkFUQ0hfQlVGRkVSX1NUQVJUX0dF
TjgpIHwKKwkJTUlfQkFUQ0hfUFJFRElDQVRFOworCSpjcysrID0gaTkxNV9nZ3R0X29mZnNldCh2
bWEpICsgKHRzMCAtIGJhdGNoKSAqIDQ7CisJKmNzKysgPSAwOworCisJLyoKKwkgKiBOb3cgYWRk
IHRoZSBkaWZmIGJldHdlZW4gdG8gcHJldmlvdXMgdGltZXN0YW1wcyBhbmQgYWRkIGl0IHRvIDoK
KwkgKiAgICAgICgoKDEgKiA8PCA2NCkgLSAxKSAtIGRlbGF5X25zKQorCSAqCisJICogV2hlbiB0
aGUgQ2FycnkgRmxhZyBjb250YWlucyAxIHRoaXMgbWVhbnMgdGhlIGVsYXBzZWQgdGltZSBpcwor
CSAqIGxvbmdlciB0aGFuIHRoZSBleHBlY3RlZCBkZWxheSwgYW5kIHdlIGNhbiBleGl0IHRoZSB3
YWl0IGxvb3AuCisJICovCisJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX0lNTSgyKTsKKwkqY3Mr
KyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KENTX0dQUihERUxUQV9UQVJHRVQpKTsKKwkqY3MrKyA9
IGxvd2VyXzMyX2JpdHMoZGVsYXlfdGlja3MpOworCSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZz
ZXQoQ1NfR1BSKERFTFRBX1RBUkdFVCkpICsgNDsKKwkqY3MrKyA9IHVwcGVyXzMyX2JpdHMoZGVs
YXlfdGlja3MpOworCisJKmNzKysgPSBNSV9NQVRIKDQpOworCSpjcysrID0gTUlfTUFUSF9MT0FE
KE1JX01BVEhfUkVHX1NSQ0EsIE1JX01BVEhfUkVHKERFTFRBX1RTKSk7CisJKmNzKysgPSBNSV9N
QVRIX0xPQUQoTUlfTUFUSF9SRUdfU1JDQiwgTUlfTUFUSF9SRUcoREVMVEFfVEFSR0VUKSk7CisJ
KmNzKysgPSBNSV9NQVRIX0FERDsKKwkqY3MrKyA9IE1JX01BVEhfU1RPUkVJTlYoTUlfTUFUSF9S
RUcoSlVNUF9QUkVESUNBVEUpLCBNSV9NQVRIX1JFR19DRik7CisKKwkvKgorCSAqIFRyYW5zZmVy
IHRoZSByZXN1bHQgaW50byB0aGUgcHJlZGljYXRlIHJlZ2lzdGVyIHRvIGJlIHVzZWQgZm9yIHRo
ZQorCSAqIHByZWRpY2F0ZWQganVtcC4KKwkgKi8KKwkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJf
UkVHIHwgKDMgLSAyKTsKKwkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KENTX0dQUihKVU1Q
X1BSRURJQ0FURSkpOworCSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQoTUlfUFJFRElDQVRF
X1JFU1VMVF8xKTsKKworCS8qIFByZWRpY2F0ZSB0aGUganVtcC4gICovCisJKmNzKysgPSAoSU5U
RUxfR0VOKGk5MTUpIDwgOCA/CisJCSBNSV9CQVRDSF9CVUZGRVJfU1RBUlQgOgorCQkgTUlfQkFU
Q0hfQlVGRkVSX1NUQVJUX0dFTjgpIHwKKwkJTUlfQkFUQ0hfUFJFRElDQVRFOworCSpjcysrID0g
aTkxNV9nZ3R0X29mZnNldCh2bWEpICsgKGp1bXAgLSBiYXRjaCkgKiA0OworCSpjcysrID0gMDsK
KworCS8qIFJlc3RvcmUgcmVnaXN0ZXJzLiAqLworCWZvciAoaSA9IDA7IGkgPCBOX0NTX0dQUjsg
aSsrKQorCQljcyA9IHNhdmVfcmVzdG9yZV9yZWdpc3RlcigKKwkJCXN0cmVhbSwgY3MsIGZhbHNl
IC8qIHJlc3RvcmUgKi8sIENTX0dQUihpKSwKKwkJCUlOVEVMX0dUX1NDUkFUQ0hfRklFTERfUEVS
Rl9DU19HUFIgKyA4ICogaSwgMik7CisJY3MgPSBzYXZlX3Jlc3RvcmVfcmVnaXN0ZXIoCisJCXN0
cmVhbSwgY3MsIGZhbHNlIC8qIHJlc3RvcmUgKi8sIE1JX1BSRURJQ0FURV9SRVNVTFRfMSwKKwkJ
SU5URUxfR1RfU0NSQVRDSF9GSUVMRF9QRVJGX1BSRURJQ0FURV9SRVNVTFRfMSwgMSk7CisKKwkv
KiBBbmQgcmV0dXJuIHRvIHRoZSByaW5nLiAqLworCSpjcysrID0gTUlfQkFUQ0hfQlVGRkVSX0VO
RDsKKworCUdFTV9CVUdfT04oY3MgLSBiYXRjaCA+IFBBR0VfU0laRSAvIHNpemVvZigqYmF0Y2gp
KTsKKworCWk5MTVfZ2VtX29iamVjdF9mbHVzaF9tYXAoYm8pOworCWk5MTVfZ2VtX29iamVjdF91
bnBpbl9tYXAoYm8pOworCisJc3RyZWFtLT5ub2Ffd2FpdCA9IHZtYTsKKwlyZXR1cm4gMDsKKwor
ZXJyX3VucGluOgorCV9faTkxNV92bWFfdW5waW4odm1hKTsKK2Vycl91bnJlZjoKKwlpOTE1X2dl
bV9vYmplY3RfcHV0KGJvKTsKKwlyZXR1cm4gcmV0OworfQorCiBzdGF0aWMgdm9pZCBjb25maWdf
b2FfcmVncyhzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUsCiAJCQkgICBjb25zdCBzdHJ1Y3Qg
aTkxNV9vYV9yZWcgKnJlZ3MsCiAJCQkgICB1MzIgbl9yZWdzKQpAQCAtMjM3NCw2ICsyNTg2LDEy
IEBAIHN0YXRpYyBpbnQgaTkxNV9vYV9zdHJlYW1faW5pdChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVh
bSAqc3RyZWFtLAogCQl9CiAJfQogCisJcmV0ID0gYWxsb2Nfbm9hX3dhaXQoc3RyZWFtKTsKKwlp
ZiAocmV0KSB7CisJCURSTV9ERUJVRygiVW5hYmxlIHRvIGFsbG9jYXRlIE5PQSB3YWl0IGJhdGNo
IGJ1ZmZlclxuIik7CisJCWdvdG8gZXJyX25vYV93YWl0X2FsbG9jOworCX0KKwogCXN0cmVhbS0+
b2FfY29uZmlnID0gaTkxNV9wZXJmX2dldF9vYV9jb25maWcocGVyZiwgcHJvcHMtPm1ldHJpY3Nf
c2V0KTsKIAlpZiAoIXN0cmVhbS0+b2FfY29uZmlnKSB7CiAJCURSTV9ERUJVRygiSW52YWxpZCBP
QSBjb25maWcgaWQ9JWlcbiIsIHByb3BzLT5tZXRyaWNzX3NldCk7CkBAIC0yNDM0LDYgKzI2NTIs
OSBAQCBzdGF0aWMgaW50IGk5MTVfb2Ffc3RyZWFtX2luaXQoc3RydWN0IGk5MTVfcGVyZl9zdHJl
YW0gKnN0cmVhbSwKIAlmcmVlX29hX2NvbmZpZ3Moc3RyZWFtKTsKIAogZXJyX2NvbmZpZzoKKwlm
cmVlX25vYV93YWl0KHN0cmVhbSk7CisKK2Vycl9ub2Ffd2FpdF9hbGxvYzoKIAlpZiAoc3RyZWFt
LT5jdHgpCiAJCW9hX3B1dF9yZW5kZXJfY3R4X2lkKHN0cmVhbSk7CiAKQEAgLTM4MjEsNiArNDA0
Miw5IEBAIHZvaWQgaTkxNV9wZXJmX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
CiAJCXJhdGVsaW1pdF9zZXRfZmxhZ3MoJnBlcmYtPnNwdXJpb3VzX3JlcG9ydF9ycywKIAkJCQkg
ICAgUkFURUxJTUlUX01TR19PTl9SRUxFQVNFKTsKIAorCQlhdG9taWM2NF9zZXQoJnBlcmYtPm5v
YV9wcm9ncmFtbWluZ19kZWxheSwKKwkJCSAgICAgNTAwICogMTAwMCAvKiA1MDB1cyAqLyk7CisK
IAkJcGVyZi0+aTkxNSA9IGk5MTU7CiAJfQogfQpAQCAtMzg1NywzICs0MDgxLDcgQEAgaW50IGk5
MTVfcGVyZl9pb2N0bF92ZXJzaW9uKHZvaWQpCiB7CiAJcmV0dXJuIDE7CiB9CisKKyNpZiBJU19F
TkFCTEVEKENPTkZJR19EUk1fSTkxNV9TRUxGVEVTVCkKKyNpbmNsdWRlICJzZWxmdGVzdHMvaTkx
NV9wZXJmLmMiCisjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
cGVyZl90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmX3R5cGVzLmgKaW5k
ZXggNWJhZWU0ZjBmZTkxLi5mMTI2Zjc5MGM2OGIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfcGVyZl90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
cGVyZl90eXBlcy5oCkBAIC0yNzgsNiArMjc4LDEyIEBAIHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFt
IHsKIAkJICovCiAJCXUzMiBoZWFkOwogCX0gb2FfYnVmZmVyOworCisJLyoqCisJICogQSBiYXRj
aCBidWZmZXIgZG9pbmcgYSB3YWl0IG9uIHRoZSBHUFUgZm9yIHRoZSBOT0EgbG9naWMgdG8gYmUK
KwkgKiByZXByb2dyYW1tZWQuCisJICovCisJc3RydWN0IGk5MTVfdm1hICpub2Ffd2FpdDsKIH07
CiAKIC8qKgpAQCAtMzk4LDYgKzQwNCw4IEBAIHN0cnVjdCBpOTE1X3BlcmYgewogCiAJc3RydWN0
IGk5MTVfb2Ffb3BzIG9wczsKIAljb25zdCBzdHJ1Y3QgaTkxNV9vYV9mb3JtYXQgKm9hX2Zvcm1h
dHM7CisKKwlhdG9taWM2NF90IG5vYV9wcm9ncmFtbWluZ19kZWxheTsKIH07CiAKICNlbmRpZiAv
KiBfSTkxNV9QRVJGX1RZUEVTX0hfICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3JlZy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaAppbmRleCAxZGMw
NjdmYzU3YWIuLjk5ZjhhMDhkYzJiMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9yZWcuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oCkBAIC01NDUs
NyArNTQ1LDkgQEAgc3RhdGljIGlubGluZSBib29sIGk5MTVfbW1pb19yZWdfdmFsaWQoaTkxNV9y
ZWdfdCByZWcpCiAjZGVmaW5lIE1JX1BSRURJQ0FURV9TUkMwX1VEVwlfTU1JTygweDI0MDAgKyA0
KQogI2RlZmluZSBNSV9QUkVESUNBVEVfU1JDMQlfTU1JTygweDI0MDgpCiAjZGVmaW5lIE1JX1BS
RURJQ0FURV9TUkMxX1VEVwlfTU1JTygweDI0MDggKyA0KQotCisjZGVmaW5lIE1JX1BSRURJQ0FU
RV9EQVRBICAgICAgIF9NTUlPKDB4MjQxMCkKKyNkZWZpbmUgTUlfUFJFRElDQVRFX1JFU1VMVCAg
ICAgX01NSU8oMHgyNDE4KQorI2RlZmluZSBNSV9QUkVESUNBVEVfUkVTVUxUXzEgICBfTU1JTygw
eDI0MWMpCiAjZGVmaW5lIE1JX1BSRURJQ0FURV9SRVNVTFRfMglfTU1JTygweDIyMTQpCiAjZGVm
aW5lICBMT1dFUl9TTElDRV9FTkFCTEVECSgxIDw8IDApCiAjZGVmaW5lICBMT1dFUl9TTElDRV9E
SVNBQkxFRAkoMCA8PCAwKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2k5MTVfbGl2ZV9zZWxmdGVzdHMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pOTE1X2xpdmVfc2VsZnRlc3RzLmgKaW5kZXggNjcxM2VmZWEzNTBiLi42ZGFmNjU5OWVjNzkg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2xpdmVfc2Vs
ZnRlc3RzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9z
ZWxmdGVzdHMuaApAQCAtMzUsMyArMzUsNCBAQCBzZWxmdGVzdChyZXNldCwgaW50ZWxfcmVzZXRf
bGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChoYW5nY2hlY2ssIGludGVsX2hhbmdjaGVja19saXZl
X3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KGV4ZWNsaXN0cywgaW50ZWxfZXhlY2xpc3RzX2xpdmVfc2Vs
ZnRlc3RzKQogc2VsZnRlc3QoZ3VjLCBpbnRlbF9ndWNfbGl2ZV9zZWxmdGVzdCkKK3NlbGZ0ZXN0
KHBlcmYsIGk5MTVfcGVyZl9saXZlX3NlbGZ0ZXN0cykKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3BlcmYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9pOTE1X3BlcmYuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAw
MDAuLjgxMjBiNWQ4OWZiZAotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pOTE1X3BlcmYuYwpAQCAtMCwwICsxLDE5NiBAQAorLyoKKyAqIFNQRFgtTGlj
ZW5zZS1JZGVudGlmaWVyOiBNSVQKKyAqCisgKiBDb3B5cmlnaHQgwqkgMjAxOSBJbnRlbCBDb3Jw
b3JhdGlvbgorICovCisKKyNpbmNsdWRlIDxsaW51eC9rcmVmLmg+CisKKyNpbmNsdWRlICJnZW0v
aTkxNV9nZW1fcG0uaCIKKyNpbmNsdWRlICJndC9pbnRlbF9ndC5oIgorCisjaW5jbHVkZSAiaTkx
NV9zZWxmdGVzdC5oIgorCisjaW5jbHVkZSAiaWd0X2ZsdXNoX3Rlc3QuaCIKKyNpbmNsdWRlICJs
aWJfc3dfZmVuY2UuaCIKKworc3RhdGljIHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICoKK3Rlc3Rf
c3RyZWFtKHN0cnVjdCBpOTE1X3BlcmYgKnBlcmYpCit7CisJc3RydWN0IGRybV9pOTE1X3BlcmZf
b3Blbl9wYXJhbSBwYXJhbSA9IHt9OworCXN0cnVjdCBwZXJmX29wZW5fcHJvcGVydGllcyBwcm9w
cyA9IHsKKwkJLmVuZ2luZSA9IGludGVsX2VuZ2luZV9sb29rdXBfdXNlcihwZXJmLT5pOTE1LAor
CQkJCQkJICAgSTkxNV9FTkdJTkVfQ0xBU1NfUkVOREVSLAorCQkJCQkJICAgMCksCisJCS5zYW1w
bGVfZmxhZ3MgPSBTQU1QTEVfT0FfUkVQT1JULAorCQkub2FfZm9ybWF0ID0gSTkxNV9PQV9GT1JN
QVRfQzRfQjgsCisJCS5tZXRyaWNzX3NldCA9IDEsCisJfTsKKwlzdHJ1Y3QgaTkxNV9wZXJmX3N0
cmVhbSAqc3RyZWFtOworCisJc3RyZWFtID0ga3phbGxvYyhzaXplb2YoKnN0cmVhbSksIEdGUF9L
RVJORUwpOworCWlmICghc3RyZWFtKQorCQlyZXR1cm4gTlVMTDsKKworCUlOSVRfTElTVF9IRUFE
KCZzdHJlYW0tPm9hX2NvbmZpZ19ib3MpOworCXN0cmVhbS0+cGVyZiA9IHBlcmY7CisJc3RyZWFt
LT5ndCA9ICZwZXJmLT5pOTE1LT5ndDsKKworCW11dGV4X2xvY2soJnBlcmYtPmxvY2spOworCWlm
IChpOTE1X29hX3N0cmVhbV9pbml0KHN0cmVhbSwgJnBhcmFtLCAmcHJvcHMpKSB7CisJCWtmcmVl
KHN0cmVhbSk7CisJCXN0cmVhbSA9ICBOVUxMOworCX0KKwltdXRleF91bmxvY2soJnBlcmYtPmxv
Y2spOworCisJcmV0dXJuIHN0cmVhbTsKK30KKworc3RhdGljIHZvaWQgc3RyZWFtX2Rlc3Ryb3ko
c3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKK3sKKwlzdHJ1Y3QgaTkxNV9wZXJmICpw
ZXJmID0gc3RyZWFtLT5wZXJmOworCisJbXV0ZXhfbG9jaygmcGVyZi0+bG9jayk7CisJaTkxNV9w
ZXJmX2Rlc3Ryb3lfbG9ja2VkKHN0cmVhbSk7CisJbXV0ZXhfdW5sb2NrKCZwZXJmLT5sb2NrKTsK
K30KKworc3RhdGljIGludCBsaXZlX3Nhbml0eWNoZWNrKHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKKwlzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAq
c3RyZWFtOworCisJLyogUXVpY2sgY2hlY2sgd2UgY2FuIGNyZWF0ZSBhIHBlcmYgc3RyZWFtICov
CisKKwlzdHJlYW0gPSB0ZXN0X3N0cmVhbSgmaTkxNS0+cGVyZik7CisJaWYgKCFzdHJlYW0pCisJ
CXJldHVybiAtRUlOVkFMOworCisJc3RyZWFtX2Rlc3Ryb3koc3RyZWFtKTsKKwlyZXR1cm4gMDsK
K30KKworc3RhdGljIGludCB3cml0ZV90aW1lc3RhbXAoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEs
IGludCBzbG90KQoreworCXUzMiAqY3M7CisKKwljcyA9IGludGVsX3JpbmdfYmVnaW4ocnEsIDYp
OworCWlmIChJU19FUlIoY3MpKQorCQlyZXR1cm4gUFRSX0VSUihjcyk7CisKKwljcyA9IGdlbjhf
ZW1pdF9waXBlX2NvbnRyb2woY3MsCisJCQkJICAgIFBJUEVfQ09OVFJPTF9HTE9CQUxfR1RUX0lW
QiB8CisJCQkJICAgIFBJUEVfQ09OVFJPTF9TVE9SRV9EQVRBX0lOREVYIHwKKwkJCQkgICAgUElQ
RV9DT05UUk9MX1dSSVRFX1RJTUVTVEFNUCwKKwkJCQkgICAgc2xvdCAqIHNpemVvZih1MzIpKTsK
KwlpbnRlbF9yaW5nX2FkdmFuY2UocnEsIGNzKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMg
aW50IGxpdmVfbm9hX2RlbGF5KHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IGFyZzsKKwlzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtOworCXN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxOworCWt0aW1lX3QgdDAsIHQxOworCXU2NCBleHBlY3RlZDsKKwl1
MzIgZGVsYXk7CisJaW50IGVycjsKKwlpbnQgaTsKKworCS8qIENoZWNrIHRoYXQgdGhlIEdQVSBk
ZWxheXMgbWF0Y2hlcyBleHBlY3RhdGlvbnMgKi8KKworCXN0cmVhbSA9IHRlc3Rfc3RyZWFtKCZp
OTE1LT5wZXJmKTsKKwlpZiAoIXN0cmVhbSkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlleHBlY3Rl
ZCA9IGF0b21pYzY0X3JlYWQoJnN0cmVhbS0+cGVyZi0+bm9hX3Byb2dyYW1taW5nX2RlbGF5KTsK
KworCWlmIChzdHJlYW0tPmVuZ2luZS0+Y2xhc3MgIT0gUkVOREVSX0NMQVNTKSB7CisJCWVyciA9
IC1FTk9ERVY7CisJCWdvdG8gb3V0OworCX0KKworCWZvciAoaSA9IDA7IGkgPCA0OyBpKyspCisJ
CWludGVsX3dyaXRlX3N0YXR1c19wYWdlKHN0cmVhbS0+ZW5naW5lLCAweDEwMCArIGksIDApOwor
CisJcnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKHN0cmVhbS0+ZW5naW5lLT5rZXJuZWxfY29udGV4
dCk7CisJaWYgKElTX0VSUihycSkpIHsKKwkJZXJyID0gUFRSX0VSUihycSk7CisJCWdvdG8gb3V0
OworCX0KKworCWVyciA9IHdyaXRlX3RpbWVzdGFtcChycSwgMHgxMDApOworCWlmIChlcnIpIHsK
KwkJaTkxNV9yZXF1ZXN0X2FkZChycSk7CisJCWdvdG8gb3V0OworCX0KKworCWVyciA9IHJxLT5l
bmdpbmUtPmVtaXRfYmJfc3RhcnQocnEsCisJCQkJCWk5MTVfZ2d0dF9vZmZzZXQoc3RyZWFtLT5u
b2Ffd2FpdCksIDAsCisJCQkJCUk5MTVfRElTUEFUQ0hfU0VDVVJFKTsKKwlpZiAoZXJyKSB7CisJ
CWk5MTVfcmVxdWVzdF9hZGQocnEpOworCQlnb3RvIG91dDsKKwl9CisKKwllcnIgPSB3cml0ZV90
aW1lc3RhbXAocnEsIDB4MTAyKTsKKwlpZiAoZXJyKSB7CisJCWk5MTVfcmVxdWVzdF9hZGQocnEp
OworCQlnb3RvIG91dDsKKwl9CisKKwlpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKKwlpOTE1X3JlcXVl
c3RfYWRkKHJxKTsKKworCXdoaWxlICghaW50ZWxfcmVhZF9zdGF0dXNfcGFnZShzdHJlYW0tPmVu
Z2luZSwgMHgxMDApICYmCisJICAgICAgICFpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJxKSkKKwkJ
Y3B1X3JlbGF4KCk7CisJdDAgPSBrdGltZV9nZXQoKTsKKworCXdoaWxlICghaW50ZWxfcmVhZF9z
dGF0dXNfcGFnZShzdHJlYW0tPmVuZ2luZSwgMHgxMDIpICYmCisJICAgICAgICFpOTE1X3JlcXVl
c3RfY29tcGxldGVkKHJxKSkKKwkJY3B1X3JlbGF4KCk7CisJdDEgPSBrdGltZV9nZXQoKTsKKwor
CXByX2luZm8oIkNQVSBkZWxheTogJWxsdW5zLCBleHBlY3RlZCAlbGx1bnNcbiIsCisJCWt0aW1l
X3N1Yih0MSwgdDApLCBleHBlY3RlZCk7CisKKwlkZWxheSA9IGludGVsX3JlYWRfc3RhdHVzX3Bh
Z2Uoc3RyZWFtLT5lbmdpbmUsIDB4MTAyKTsKKwlkZWxheSAtPSBpbnRlbF9yZWFkX3N0YXR1c19w
YWdlKHN0cmVhbS0+ZW5naW5lLCAweDEwMCk7CisJZGVsYXkgPSBkaXZfdTY0KG11bF91MzJfdTMy
KGRlbGF5LCAxMDAwICogMTAwMCksCisJCQlSVU5USU1FX0lORk8oaTkxNSktPmNzX3RpbWVzdGFt
cF9mcmVxdWVuY3lfa2h6KTsKKwlwcl9pbmZvKCJHUFUgZGVsYXk6ICV1bnMsIGV4cGVjdGVkICVs
bHVuc1xuIiwKKwkJZGVsYXksIGV4cGVjdGVkKTsKKworCWlmICg0ICogZGVsYXkgPCAzICogZXhw
ZWN0ZWQgfHwgMiAqIGRlbGF5ID4gMyAqIGV4cGVjdGVkKSB7CisJCXByX2VycigiR1BVIGRlbGF5
IFsldXVzXSBvdXRzaWRlIG9mIGV4cGVjdGVkIHRocmVzaG9sZCEgWyVsbHV1cywgJWxsdXVzXVxu
IiwKKwkJICAgICAgIGRlbGF5IC8gMTAwMCwKKwkJICAgICAgIGRpdl91NjQoMyAqIGV4cGVjdGVk
LCA0MDAwKSwKKwkJICAgICAgIGRpdl91NjQoMyAqIGV4cGVjdGVkLCAyMDAwKSk7CisJCWVyciA9
IC1FSU5WQUw7CisJfQorCisJaTkxNV9yZXF1ZXN0X3B1dChycSk7CitvdXQ6CisJc3RyZWFtX2Rl
c3Ryb3koc3RyZWFtKTsKKwlyZXR1cm4gZXJyOworfQorCitpbnQgaTkxNV9wZXJmX2xpdmVfc2Vs
ZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQoreworCXN0YXRpYyBjb25zdCBz
dHJ1Y3QgaTkxNV9zdWJ0ZXN0IHRlc3RzW10gPSB7CisJCVNVQlRFU1QobGl2ZV9zYW5pdHljaGVj
ayksCisJCVNVQlRFU1QobGl2ZV9ub2FfZGVsYXkpLAorCX07CisJc3RydWN0IGk5MTVfcGVyZiAq
cGVyZiA9ICZpOTE1LT5wZXJmOworCisJaWYgKCFwZXJmLT5tZXRyaWNzX2tvYmogfHwgIXBlcmYt
Pm9wcy5lbmFibGVfbWV0cmljX3NldCkKKwkJcmV0dXJuIDA7CisKKwlpZiAoaW50ZWxfZ3RfaXNf
d2VkZ2VkKCZpOTE1LT5ndCkpCisJCXJldHVybiAwOworCisJcmV0dXJuIGk5MTVfc3VidGVzdHMo
dGVzdHMsIGk5MTUpOworfQotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0
cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9s
aXN0aW5mby9pbnRlbC1nZng=

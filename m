Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3886E14799E
	for <lists+intel-gfx@lfdr.de>; Fri, 24 Jan 2020 09:48:46 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 313616FF75;
	Fri, 24 Jan 2020 08:48:43 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 422746FF74
 for <intel-gfx@lists.freedesktop.org>; Fri, 24 Jan 2020 08:48:42 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga004.jf.intel.com ([10.7.209.38])
 by orsmga105.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 24 Jan 2020 00:48:42 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.70,357,1574150400"; d="scan'208";a="375460326"
Received: from slisovsk-lenovo-ideapad-720s-13ikb.fi.intel.com ([10.237.72.89])
 by orsmga004.jf.intel.com with ESMTP; 24 Jan 2020 00:48:40 -0800
From: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 24 Jan 2020 10:44:53 +0200
Message-Id: <20200124084456.2961-5-stanislav.lisovskiy@intel.com>
X-Mailer: git-send-email 2.24.1.485.gad05a3d8e5
In-Reply-To: <20200124084456.2961-1-stanislav.lisovskiy@intel.com>
References: <20200124084456.2961-1-stanislav.lisovskiy@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v16 4/7] drm/i915: Manipulate DBuf slices
 properly
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U3RhcnQgbWFuaXB1bGF0aW5nIERCdWYgc2xpY2VzIGFzIGEgbWFzaywKYnV0IG5vdCBhcyBhIHRv
dGFsIG51bWJlciwgYXMgY3VycmVudCBhcHByb2FjaApkb2Vzbid0IGdpdmUgdXMgZnVsbCBjb250
cm9sIG9uIGFsbCBjb21iaW5hdGlvbnMKb2Ygc2xpY2VzLCB3aGljaCB3ZSBtaWdodCBuZWVkKGxp
a2UgZW5hYmxpbmcgUzIKb25seSBjYW4ndCBlbmFibGVkIGJ5IHNldHRpbmcgZW5hYmxlZF9zbGlj
ZXM9MSkuCgpSZW1vdmVkIHdyb25nIGNvZGUgZnJvbSBpbnRlbF9nZXRfZGRiX3NpemUgYXMKaXQg
ZG9lc24ndCBtYXRjaCB0byBCU3BlYy4gRm9yIG5vdyBzdGlsbCBqdXN0CnVzZSBEQnVmIHNsaWNl
IHVudGlsIHByb3BlciBhbGdvcml0aG0gaXMgaW1wbGVtZW50ZWQuCgpPdGhlciBtaW5vciBjb2Rl
IHJlZmFjdG9yaW5nIHRvIGdldCBwcmVwYXJlZApmb3IgbWFqb3IgREJ1ZiBhc3NpZ25tZW50IGNo
YW5nZXMgbGFuZGVkOgotIEFzIG5vdyBlbmFibGVkIHNsaWNlcyBjb250YWluIGEgbWFzawogIHdl
IHN0aWxsIG5lZWQgc29tZSB2YWx1ZSB3aGljaCBzaG91bGQKICByZWZsZWN0IGhvdyBtdWNoIERC
dWYgc2xpY2VzIGFyZSBzdXBwb3J0ZWQKICBieSB0aGUgcGxhdGZvcm0sIG5vdyBkZXZpY2UgaW5m
byBjb250YWlucwogIG51bV9zdXBwb3J0ZWRfZGJ1Zl9zbGljZXMuCi0gUmVtb3ZlZCB1bm5lZWRl
ZCBhc3NlcnRpb24gYXMgd2UgYXJlIG5vdwogIG1hbmlwdWxhdGluZyBzbGljZXMgaW4gYSBtb3Jl
IHByb3BlciB3YXkuCgp2MjogU3RhcnQgdXNpbmcgZW5hYmxlZF9zbGljZXMgaW4gZGV2X3ByaXYK
CnYzOiAiZW5hYmxlZF9zbGljZXMiIGlzIG5vdyAiZW5hYmxlZF9kYnVmX3NsaWNlc19tYXNrIiwK
ICAgIGFzIHRoaXMgbm93IHNpdHMgaW4gZGV2X3ByaXYgaW5kZXBlbmRlbnRseS4KCnY0OiAtIEZp
eGVkIGRlYnVnIHByaW50IGZvcm1hdHRpbmcgdG8gaGV4KE1hdHQgUm9wZXIpCiAgICAtIE9wdGlt
aXplZCBkYnVmIHNsaWNlIHVwZGF0ZXMgdG8gYmUgdXNlZCBvbmx5CiAgICAgIGlmIHNsaWNlIHVu
aW9uIGlzIGRpZmZlcmVudCBmcm9tIGN1cnJlbnQgY29uZihNYXR0IFJvcGVyKQogICAgLSBGaXhl
ZCBzb21lIGZ1bmN0aW9ucyB0byBiZSBzdGF0aWMoTWF0dCBSb3BlcikKICAgIC0gQ3JlYXRlZCBh
IHBhcmFtZXRlcml6ZWQgdmVyc2lvbiBmb3IgREJVRl9DVEwgdG8KICAgICAgc2ltcGxpZnkgREJ1
ZiBwcm9ncmFtbWluZyBjeWNsZShNYXR0IFJvcGVyKQogICAgLSBSZW1vdmVkIHVucmVxdXJlZCBm
aWVsZCBmcm9tIEdFTjEwX0ZFQVRVUkVTKE1hdHQgUm9wZXIpCgp2NTogLSBSZW1vdmVkIHJlZHVu
ZGFudCBwcm9ncmFtbWluZyBkYnVmIHNsaWNlcyBoZWxwZXIoVmlsbGUgU3lyasOkbMOkKQogICAg
LSBTdGFydGVkIHRvIHVzZSBwYXJhbWV0ZXJpemVkIGxvb3AgZm9yIGh3IHJlYWRvdXQgdG8gZ2V0
IHNsaWNlcwogICAgICAoVmlsbGUgU3lyasOkbMOkKQogICAgLSBBZGRlZCBiYWNrIGFzc2VydGlv
biBjaGVja2luZyBhbW91bnQgb2YgREJVRiBzbGljZXMgZW5hYmxlZAogICAgICBhZnRlciBEQyBz
dGF0ZXMgNS82IHRyYW5zaXRpb24sIGFsc28gYWRkZWQgbmV3IGFzc2VydGlvbgogICAgICBhcyBz
dGFydGluZyBmcm9tIElDTCBETUMgc2VlbXMgdG8gcmVzdG9yZSB0aGUgbGFzdCBEQnVmCiAgICAg
IHBvd2VyIHN0YXRlIHNldCwgcmF0aGVyIHRoYW4gcG93ZXIgdXAgYWxsIGRidWYgc2xpY2VzCiAg
ICAgIGFzIGFzc2VydGlvbiB3YXMgcHJldmlvdXNseSBleHBlY3RpbmcoVmlsbGUgU3lyasOkbMOk
KQoKdjY6IC0gTm93IHVzaW5nIGVudW0gZm9yIERCdWYgc2xpY2VzIGluIHRoaXMgcGF0Y2ggKFZp
bGxlIFN5cmrDpGzDpCkKICAgIC0gUmVtb3ZlZCBnZW4xMV9hc3NlcnRfZGJ1Zl9lbmFibGVkIGFu
ZCBwdXQgZ2VuOV9hc3NlcnRfZGJ1Zl9lbmFibGVkCiAgICAgIGJhY2ssIGFzIHdlIHJlYWxseSBu
ZWVkIHRvIGhhdmUgYSBzaW5nbGUgdW5pZmllZCBhc3NlcnQgaGVyZQogICAgICBob3dldmVyIGN1
cnJlbnRseSBlbmFibGluZyBhbHdheXMgc2xpY2UgMSBpcyBlbmZvcmNlZCBieSBCU3BlYywKICAg
ICAgc28gd2Ugd2lsbCBoYXZlIHRvIE9SIGVuYWJsZWQgc2xpY2VzIG1hc2sgd2l0aCAxIGluIG9y
ZGVyCiAgICAgIHRvIGJlIGNvbnNpc3RlbnQgd2l0aCBCU3BlYywgdGhhdCB3YXkgd2UgY2FuIHVu
aWZ5IHRoYXQKICAgICAgYXNzZXJ0aW9uIGFuZCBhZ2FpbnN0IHRoZSBhY3R1YWwgc3RhdGUgZnJv
bSB0aGUgZHJpdmVyLCBidXQKICAgICAgbm90IHNvbWUgaGFyZGNvZGVkIHZhbHVlLihjb25jbHVk
ZWQgd2l0aCBWaWxsZSkKICAgIC0gUmVtb3ZlIHBhcmFtZXRlcml6ZWQgREJVRl9DVEwgdmVyc2lv
biwgdG8gZXh0cmFjdCBpdCB0byBhbm90aGVyCiAgICAgIHBhdGNoLihWaWxsZSBTeXJqw6Rsw6Qp
CnY3OgogICAgLSBSZW1vdmVkIHVubmVlZGVkIGhhcmRjb2RlZCByZXR1cm4gdmFsdWUgZm9yIG9s
ZGVyIGdlbnMgZnJvbQogICAgICBpbnRlbF9lbmFibGVkX2RidWZfc2xpY2VzX21hc2sgLSB0aGlz
IG5vdyBpcyBoYW5kbGVkIGluIGEKICAgICAgdW5pZmllZCBtYW5uZXIgc2luY2UgZGV2aWNlIGlu
Zm8gYW55d2F5IHJldHVybnMgbWF4IGRidWYgc2xpY2VzCiAgICAgIGFzIDEgZm9yIG9sZGVyIHBs
YXRmb3JtcyhNYXR0aGV3IFJvcGVyKQogICAgLSBOb3cgdXNpbmcgSU5URUxfSU5GTyhkZXZfcHJp
diktPm51bV9zdXBwb3J0ZWRfZGJ1Zl9zbGljZXMgaW5zdGVhZAogICAgICBvZiBpbnRlbF9kYnVm
X21heF9zbGljZXMgZnVuY3Rpb24gYXMgaXQgaXMgdHJpdmlhbChNYXR0aGV3IFJvcGVyKQoKdjg6
IC0gRml4ZWQgaWNsX2RidWZfZGlzYWJsZSB0byBkaXNhYmxlIGFsbCBkYnVmcyBzdGlsbChWaWxs
ZSBTeXJqw6Rsw6QpCgpSZXZpZXdlZC1ieTogTWF0dCBSb3BlciA8bWF0dGhldy5kLnJvcGVyQGlu
dGVsLmNvbT4KUmV2aWV3ZWQtYnk6IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBsaW51
eC5pbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6IFN0YW5pc2xhdiBMaXNvdnNraXkgPHN0YW5pc2xh
di5saXNvdnNraXlAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGlzcGxheS5jICB8IDIzICsrLS0tCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
aXNwbGF5X3Bvd2VyLmMgICAgfCA4OSArKysrKystLS0tLS0tLS0tLS0tCiAuLi4vZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggICAgfCAgMiArLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9kcnYuaCAgICAgICAgICAgICAgIHwgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfcGNpLmMgICAgICAgICAgICAgICB8ICA1ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9kZXZpY2VfaW5mby5oICAgICAgfCAgMSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF9wbS5jICAgICAgICAgICAgICAgfCA1MyArKystLS0tLS0tLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvaW50ZWxfcG0uaCAgICAgICAgICAgICAgIHwgIDIgKy0KIDggZmlsZXMgY2hhbmdlZCwg
NjAgaW5zZXJ0aW9ucygrKSwgMTE3IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggNjYwMTZjNjQxY2RkLi4xYzk1N2RmNWMy
OGMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxh
eS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBA
IC0xMzc2NSwxMiArMTM3NjUsMTIgQEAgc3RhdGljIHZvaWQgdmVyaWZ5X3dtX3N0YXRlKHN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjLAogCiAJc2tsX3BpcGVfZGRiX2dldF9od19zdGF0ZShjcnRjLCBo
dy0+ZGRiX3ksIGh3LT5kZGJfdXYpOwogCi0JaHdfZW5hYmxlZF9zbGljZXMgPSBpbnRlbF9lbmFi
bGVkX2RidWZfc2xpY2VzX251bShkZXZfcHJpdik7CisJaHdfZW5hYmxlZF9zbGljZXMgPSBpbnRl
bF9lbmFibGVkX2RidWZfc2xpY2VzX21hc2soZGV2X3ByaXYpOwogCiAJaWYgKElOVEVMX0dFTihk
ZXZfcHJpdikgPj0gMTEgJiYKLQkgICAgaHdfZW5hYmxlZF9zbGljZXMgIT0gZGV2X3ByaXYtPmVu
YWJsZWRfZGJ1Zl9zbGljZXNfbnVtKQotCQlEUk1fRVJST1IoIm1pc21hdGNoIGluIERCVUYgU2xp
Y2VzIChleHBlY3RlZCAldSwgZ290ICV1KVxuIiwKLQkJCSAgZGV2X3ByaXYtPmVuYWJsZWRfZGJ1
Zl9zbGljZXNfbnVtLAorCSAgICBod19lbmFibGVkX3NsaWNlcyAhPSBkZXZfcHJpdi0+ZW5hYmxl
ZF9kYnVmX3NsaWNlc19tYXNrKQorCQlEUk1fRVJST1IoIm1pc21hdGNoIGluIERCVUYgU2xpY2Vz
IChleHBlY3RlZCAweCV4LCBnb3QgMHgleClcbiIsCisJCQkgIGRldl9wcml2LT5lbmFibGVkX2Ri
dWZfc2xpY2VzX21hc2ssCiAJCQkgIGh3X2VuYWJsZWRfc2xpY2VzKTsKIAogCS8qIHBsYW5lcyAq
LwpAQCAtMTUwOTcsMjIgKzE1MDk3LDIzIEBAIHN0YXRpYyB2b2lkIGludGVsX3VwZGF0ZV90cmFu
c19wb3J0X3N5bmNfY3J0Y3Moc3RydWN0IGludGVsX2NydGMgKmNydGMsCiBzdGF0aWMgdm9pZCBp
Y2xfZGJ1Zl9zbGljZV9wcmVfdXBkYXRlKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRl
KQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoc3RhdGUt
PmJhc2UuZGV2KTsKLQl1OCBod19lbmFibGVkX3NsaWNlcyA9IGRldl9wcml2LT5lbmFibGVkX2Ri
dWZfc2xpY2VzX251bTsKLQl1OCByZXF1aXJlZF9zbGljZXMgPSBzdGF0ZS0+ZW5hYmxlZF9kYnVm
X3NsaWNlc19udW07CisJdTggaHdfZW5hYmxlZF9zbGljZXMgPSBkZXZfcHJpdi0+ZW5hYmxlZF9k
YnVmX3NsaWNlc19tYXNrOworCXU4IHJlcXVpcmVkX3NsaWNlcyA9IHN0YXRlLT5lbmFibGVkX2Ri
dWZfc2xpY2VzX21hc2s7CisJdTggc2xpY2VzX3VuaW9uID0gaHdfZW5hYmxlZF9zbGljZXMgfCBy
ZXF1aXJlZF9zbGljZXM7CiAKIAkvKiBJZiAybmQgREJ1ZiBzbGljZSByZXF1aXJlZCwgZW5hYmxl
IGl0IGhlcmUgKi8KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSAmJiByZXF1aXJlZF9z
bGljZXMgPiBod19lbmFibGVkX3NsaWNlcykKLQkJaWNsX2RidWZfc2xpY2VzX3VwZGF0ZShkZXZf
cHJpdiwgcmVxdWlyZWRfc2xpY2VzKTsKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSAm
JiBzbGljZXNfdW5pb24gIT0gaHdfZW5hYmxlZF9zbGljZXMpCisJCWljbF9kYnVmX3NsaWNlc191
cGRhdGUoZGV2X3ByaXYsIHNsaWNlc191bmlvbik7CiB9CiAKIHN0YXRpYyB2b2lkIGljbF9kYnVm
X3NsaWNlX3Bvc3RfdXBkYXRlKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogewog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoc3RhdGUtPmJhc2Uu
ZGV2KTsKLQl1OCBod19lbmFibGVkX3NsaWNlcyA9IGRldl9wcml2LT5lbmFibGVkX2RidWZfc2xp
Y2VzX251bTsKLQl1OCByZXF1aXJlZF9zbGljZXMgPSBzdGF0ZS0+ZW5hYmxlZF9kYnVmX3NsaWNl
c19udW07CisJdTggaHdfZW5hYmxlZF9zbGljZXMgPSBkZXZfcHJpdi0+ZW5hYmxlZF9kYnVmX3Ns
aWNlc19tYXNrOworCXU4IHJlcXVpcmVkX3NsaWNlcyA9IHN0YXRlLT5lbmFibGVkX2RidWZfc2xp
Y2VzX21hc2s7CiAKIAkvKiBJZiAybmQgREJ1ZiBzbGljZSBpcyBubyBtb3JlIHJlcXVpcmVkIGRp
c2FibGUgaXQgKi8KLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSAmJiByZXF1aXJlZF9z
bGljZXMgPCBod19lbmFibGVkX3NsaWNlcykKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAx
MSAmJiByZXF1aXJlZF9zbGljZXMgIT0gaHdfZW5hYmxlZF9zbGljZXMpCiAJCWljbF9kYnVmX3Ns
aWNlc191cGRhdGUoZGV2X3ByaXYsIHJlcXVpcmVkX3NsaWNlcyk7CiB9CiAKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmMKaW5kZXggYTU5
ZWZiMjRiZTkyLi45NmIzODI1MjU3OGIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5jCkBAIC0xNSw2ICsxNSw3IEBACiAjaW5jbHVk
ZSAiaW50ZWxfZGlzcGxheV90eXBlcy5oIgogI2luY2x1ZGUgImludGVsX2RwaW9fcGh5LmgiCiAj
aW5jbHVkZSAiaW50ZWxfaG90cGx1Zy5oIgorI2luY2x1ZGUgImludGVsX3BtLmgiCiAjaW5jbHVk
ZSAiaW50ZWxfc2lkZWJhbmQuaCIKICNpbmNsdWRlICJpbnRlbF90Yy5oIgogI2luY2x1ZGUgImlu
dGVsX3ZnYS5oIgpAQCAtMTAyOCwxMSArMTAyOSwxMyBAQCBzdGF0aWMgYm9vbCBnZW45X2RjX29m
Zl9wb3dlcl93ZWxsX2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAog
CiBzdGF0aWMgdm9pZCBnZW45X2Fzc2VydF9kYnVmX2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQogewotCXUzMiB0bXAgPSBJOTE1X1JFQUQoREJVRl9DVEwpOworCXU4
IGh3X2VuYWJsZWRfZGJ1Zl9zbGljZXMgPSBpbnRlbF9lbmFibGVkX2RidWZfc2xpY2VzX21hc2so
ZGV2X3ByaXYpOworCXU4IGVuYWJsZWRfZGJ1Zl9zbGljZXMgPSBkZXZfcHJpdi0+ZW5hYmxlZF9k
YnVmX3NsaWNlc19tYXNrOwogCi0JV0FSTigodG1wICYgKERCVUZfUE9XRVJfU1RBVEUgfCBEQlVG
X1BPV0VSX1JFUVVFU1QpKSAhPQotCSAgICAgKERCVUZfUE9XRVJfU1RBVEUgfCBEQlVGX1BPV0VS
X1JFUVVFU1QpLAotCSAgICAgIlVuZXhwZWN0ZWQgREJ1ZiBwb3dlciBwb3dlciBzdGF0ZSAoMHgl
MDh4KVxuIiwgdG1wKTsKKwlXQVJOKGh3X2VuYWJsZWRfZGJ1Zl9zbGljZXMgIT0gZW5hYmxlZF9k
YnVmX3NsaWNlcywKKwkgICAgICJVbmV4cGVjdGVkIERCdWYgcG93ZXIgcG93ZXIgc3RhdGUgKDB4
JTA4eCwgZXhwZWN0ZWQgMHglMDh4KVxuIiwKKwkgICAgIGh3X2VuYWJsZWRfZGJ1Zl9zbGljZXMs
CisJICAgICBlbmFibGVkX2RidWZfc2xpY2VzKTsKIH0KIAogc3RhdGljIHZvaWQgZ2VuOV9kaXNh
YmxlX2RjX3N0YXRlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCkBAIC00Mzg4
LDg2ICs0MzkxLDQ2IEBAIGJvb2wgaW50ZWxfZGJ1Zl9zbGljZV9zZXQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LAogCiBzdGF0aWMgdm9pZCBnZW45X2RidWZfZW5hYmxlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKLQlpbnRlbF9kYnVmX3NsaWNlX3NldChk
ZXZfcHJpdiwgREJVRl9DVEwsIHRydWUpOworCWljbF9kYnVmX3NsaWNlc191cGRhdGUoZGV2X3By
aXYsIEJJVChEQlVGX1MxKSk7CiB9CiAKIHN0YXRpYyB2b2lkIGdlbjlfZGJ1Zl9kaXNhYmxlKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKLQlpbnRlbF9kYnVmX3NsaWNlX3Nl
dChkZXZfcHJpdiwgREJVRl9DVEwsIGZhbHNlKTsKLX0KLQotc3RhdGljIHU4IGludGVsX2RidWZf
bWF4X3NsaWNlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCi17Ci0JaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPCAxMSkKLQkJcmV0dXJuIDE7Ci0JcmV0dXJuIDI7CisJaWNsX2Ri
dWZfc2xpY2VzX3VwZGF0ZShkZXZfcHJpdiwgMCk7CiB9CiAKIHZvaWQgaWNsX2RidWZfc2xpY2Vz
X3VwZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkgICAgdTggcmVx
X3NsaWNlcykKIHsKLQljb25zdCB1OCBod19lbmFibGVkX3NsaWNlcyA9IGRldl9wcml2LT5lbmFi
bGVkX2RidWZfc2xpY2VzX251bTsKLQlib29sIHJldDsKKwlpbnQgaTsKKwlpbnQgbWF4X3NsaWNl
cyA9IElOVEVMX0lORk8oZGV2X3ByaXYpLT5udW1fc3VwcG9ydGVkX2RidWZfc2xpY2VzOwogCi0J
aWYgKHJlcV9zbGljZXMgPiBpbnRlbF9kYnVmX21heF9zbGljZXMoZGV2X3ByaXYpKSB7Ci0JCURS
TV9FUlJPUigiSW52YWxpZCBudW1iZXIgb2YgZGJ1ZiBzbGljZXMgcmVxdWVzdGVkXG4iKTsKLQkJ
cmV0dXJuOwotCX0KKwlXQVJOKGh3ZWlnaHQ4KHJlcV9zbGljZXMpID4gbWF4X3NsaWNlcywKKwkg
ICAgICJJbnZhbGlkIG51bWJlciBvZiBkYnVmIHNsaWNlcyByZXF1ZXN0ZWRcbiIpOwogCi0JaWYg
KHJlcV9zbGljZXMgPT0gaHdfZW5hYmxlZF9zbGljZXMgfHwgcmVxX3NsaWNlcyA9PSAwKQotCQly
ZXR1cm47CisJRFJNX0RFQlVHX0tNUygiVXBkYXRpbmcgZGJ1ZiBzbGljZXMgdG8gMHgleFxuIiwg
cmVxX3NsaWNlcyk7CiAKLQlpZiAocmVxX3NsaWNlcyA+IGh3X2VuYWJsZWRfc2xpY2VzKQotCQly
ZXQgPSBpbnRlbF9kYnVmX3NsaWNlX3NldChkZXZfcHJpdiwKLQkJCQkJICAgX0RCVUZfQ1RMX1Mo
REJVRl9TMiksIHRydWUpOwotCWVsc2UKLQkJcmV0ID0gaW50ZWxfZGJ1Zl9zbGljZV9zZXQoZGV2
X3ByaXYsCi0JCQkJCSAgIF9EQlVGX0NUTF9TKERCVUZfUzIpLCBmYWxzZSk7CisJZm9yIChpID0g
MDsgaSA8IG1heF9zbGljZXM7IGkrKykgeworCQlpbnRlbF9kYnVmX3NsaWNlX3NldChkZXZfcHJp
diwKKwkJCQkgICAgIF9EQlVGX0NUTF9TKGkpLAorCQkJCSAgICAgKHJlcV9zbGljZXMgJiBCSVQo
aSkpICE9IDApOworCX0KIAotCWlmIChyZXQpCi0JCWRldl9wcml2LT5lbmFibGVkX2RidWZfc2xp
Y2VzX251bSA9IHJlcV9zbGljZXM7CisJZGV2X3ByaXYtPmVuYWJsZWRfZGJ1Zl9zbGljZXNfbWFz
ayA9IHJlcV9zbGljZXM7CiB9CiAKIHN0YXRpYyB2b2lkIGljbF9kYnVmX2VuYWJsZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7Ci0JSTkxNV9XUklURShfREJVRl9DVExfUyhE
QlVGX1MxKSwKLQkJICAgSTkxNV9SRUFEKF9EQlVGX0NUTF9TKERCVUZfUzEpKSB8IERCVUZfUE9X
RVJfUkVRVUVTVCk7Ci0JSTkxNV9XUklURShfREJVRl9DVExfUyhEQlVGX1MyKSwKLQkJICAgSTkx
NV9SRUFEKF9EQlVGX0NUTF9TKERCVUZfUzIpKSB8IERCVUZfUE9XRVJfUkVRVUVTVCk7Ci0JUE9T
VElOR19SRUFEKF9EQlVGX0NUTF9TKERCVUZfUzIpKTsKLQotCXVkZWxheSgxMCk7Ci0KLQlpZiAo
IShJOTE1X1JFQUQoX0RCVUZfQ1RMX1MoREJVRl9TMSkpICYgREJVRl9QT1dFUl9TVEFURSkgfHwK
LQkgICAgIShJOTE1X1JFQUQoX0RCVUZfQ1RMX1MoREJVRl9TMikpICYgREJVRl9QT1dFUl9TVEFU
RSkpCi0JCURSTV9FUlJPUigiREJ1ZiBwb3dlciBlbmFibGUgdGltZW91dFxuIik7Ci0JZWxzZQot
CQkvKgotCQkgKiBGSVhNRTogZm9yIG5vdyBwcmV0ZW5kIHRoYXQgd2Ugb25seSBoYXZlIDEgc2xp
Y2UsIHNlZQotCQkgKiBpbnRlbF9lbmFibGVkX2RidWZfc2xpY2VzX251bSgpLgotCQkgKi8KLQkJ
ZGV2X3ByaXYtPmVuYWJsZWRfZGJ1Zl9zbGljZXNfbnVtID0gMTsKKwkvKgorCSAqIEp1c3QgcG93
ZXIgdXAgMSBzbGljZSwgd2Ugd2lsbAorCSAqIGZpZ3VyZSBvdXQgbGF0ZXIgd2hpY2ggc2xpY2Vz
IHdlIGhhdmUgYW5kIHdoYXQgd2UgbmVlZC4KKwkgKi8KKwlpY2xfZGJ1Zl9zbGljZXNfdXBkYXRl
KGRldl9wcml2LCBCSVQoREJVRl9TMSkpOwogfQogCiBzdGF0aWMgdm9pZCBpY2xfZGJ1Zl9kaXNh
YmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKLQlJOTE1X1dSSVRFKF9E
QlVGX0NUTF9TKERCVUZfUzEpLAotCQkgICBJOTE1X1JFQUQoX0RCVUZfQ1RMX1MoREJVRl9TMSkp
ICYgfkRCVUZfUE9XRVJfUkVRVUVTVCk7Ci0JSTkxNV9XUklURShfREJVRl9DVExfUyhEQlVGX1My
KSwKLQkJICAgSTkxNV9SRUFEKF9EQlVGX0NUTF9TKERCVUZfUzIpKSAmIH5EQlVGX1BPV0VSX1JF
UVVFU1QpOwotCVBPU1RJTkdfUkVBRChfREJVRl9DVExfUyhEQlVGX1MyKSk7Ci0KLQl1ZGVsYXko
MTApOwotCi0JaWYgKChJOTE1X1JFQUQoX0RCVUZfQ1RMX1MoREJVRl9TMSkpICYgREJVRl9QT1dF
Ul9TVEFURSkgfHwKLQkgICAgKEk5MTVfUkVBRChfREJVRl9DVExfUyhEQlVGX1MyKSkgJiBEQlVG
X1BPV0VSX1NUQVRFKSkKLQkJRFJNX0VSUk9SKCJEQnVmIHBvd2VyIGRpc2FibGUgdGltZW91dCFc
biIpOwotCWVsc2UKLQkJLyoKLQkJICogRklYTUU6IGZvciBub3cgcHJldGVuZCB0aGF0IHRoZSBm
aXJzdCBzbGljZSBpcyBhbHdheXMKLQkJICogZW5hYmxlZCwgc2VlIGludGVsX2VuYWJsZWRfZGJ1
Zl9zbGljZXNfbnVtKCkuCi0JCSAqLwotCQlkZXZfcHJpdi0+ZW5hYmxlZF9kYnVmX3NsaWNlc19u
dW0gPSAxOworCWljbF9kYnVmX3NsaWNlc191cGRhdGUoZGV2X3ByaXYsIDApOwogfQogCiBzdGF0
aWMgdm9pZCBpY2xfbWJ1c19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90
eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVz
LmgKaW5kZXggNzkzYzUyNzFjNWFkLi4yOTdkMzNhNjliNjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCkBAIC01MjIsNyArNTIy
LDcgQEAgc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSB7CiAJc3RydWN0IHNrbF9kZGJfdmFsdWVz
IHdtX3Jlc3VsdHM7CiAKIAkvKiBOdW1iZXIgb2YgZW5hYmxlZCBEQnVmIHNsaWNlcyAqLwotCXU4
IGVuYWJsZWRfZGJ1Zl9zbGljZXNfbnVtOworCXU4IGVuYWJsZWRfZGJ1Zl9zbGljZXNfbWFzazsK
IAogCXN0cnVjdCBpOTE1X3N3X2ZlbmNlIGNvbW1pdF9yZWFkeTsKIApkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZHJ2LmgKaW5kZXggM2Q4ODg1Mjc4OTdiLi4yNjc4YWM4NGYxMDcgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kcnYuaApAQCAtMTIwNiw3ICsxMjA2LDcgQEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgewog
CQlib29sIGRpc3RydXN0X2Jpb3Nfd207CiAJfSB3bTsKIAotCXU4IGVuYWJsZWRfZGJ1Zl9zbGlj
ZXNfbnVtOyAvKiBHRU4xMSBoYXMgY29uZmlndXJhYmxlIDIgc2xpY2VzICovCisJdTggZW5hYmxl
ZF9kYnVmX3NsaWNlc19tYXNrOyAvKiBHRU4xMSBoYXMgY29uZmlndXJhYmxlIDIgc2xpY2VzICov
CiAKIAlzdHJ1Y3QgZHJhbV9pbmZvIHsKIAkJYm9vbCB2YWxpZDsKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNpLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Bj
aS5jCmluZGV4IDZmYmVjMmU3MDY4ZC4uYzkxYWFjY2RiM2Q2IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X3BjaS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
cGNpLmMKQEAgLTYxNSw3ICs2MTUsOCBAQCBzdGF0aWMgY29uc3Qgc3RydWN0IGludGVsX2Rldmlj
ZV9pbmZvIGNodl9pbmZvID0gewogCS5oYXNfZ3RfdWMgPSAxLCBcCiAJLmRpc3BsYXkuaGFzX2hk
Y3AgPSAxLCBcCiAJLmRpc3BsYXkuaGFzX2lwYyA9IDEsIFwKLQkuZGRiX3NpemUgPSA4OTYKKwku
ZGRiX3NpemUgPSA4OTYsIFwKKwkubnVtX3N1cHBvcnRlZF9kYnVmX3NsaWNlcyA9IDEKIAogI2Rl
ZmluZSBTS0xfUExBVEZPUk0gXAogCUdFTjlfRkVBVFVSRVMsIFwKQEAgLTY1MCw2ICs2NTEsNyBA
QCBzdGF0aWMgY29uc3Qgc3RydWN0IGludGVsX2RldmljZV9pbmZvIHNrbF9ndDRfaW5mbyA9IHsK
ICNkZWZpbmUgR0VOOV9MUF9GRUFUVVJFUyBcCiAJR0VOKDkpLCBcCiAJLmlzX2xwID0gMSwgXAor
CS5udW1fc3VwcG9ydGVkX2RidWZfc2xpY2VzID0gMSwgXAogCS5kaXNwbGF5Lmhhc19ob3RwbHVn
ID0gMSwgXAogCS5lbmdpbmVfbWFzayA9IEJJVChSQ1MwKSB8IEJJVChWQ1MwKSB8IEJJVChCQ1Mw
KSB8IEJJVChWRUNTMCksIFwKIAkucGlwZV9tYXNrID0gQklUKFBJUEVfQSkgfCBCSVQoUElQRV9C
KSB8IEJJVChQSVBFX0MpLCBcCkBAIC03NzQsNiArNzc2LDcgQEAgc3RhdGljIGNvbnN0IHN0cnVj
dCBpbnRlbF9kZXZpY2VfaW5mbyBjbmxfaW5mbyA9IHsKIAl9LCBcCiAJR0VOKDExKSwgXAogCS5k
ZGJfc2l6ZSA9IDIwNDgsIFwKKwkubnVtX3N1cHBvcnRlZF9kYnVmX3NsaWNlcyA9IDIsIFwKIAku
aGFzX2xvZ2ljYWxfcmluZ19lbHNxID0gMSwgXAogCS5jb2xvciA9IHsgLmRlZ2FtbWFfbHV0X3Np
emUgPSAzMywgLmdhbW1hX2x1dF9zaXplID0gMjYyMTQ1IH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaW50ZWxfZGV2aWNlX2luZm8uaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2ludGVsX2RldmljZV9pbmZvLmgKaW5kZXggMjcyNWNiN2ZjMTY5Li43ZDRkMTIyZDIxODIgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2RldmljZV9pbmZvLmgKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZGV2aWNlX2luZm8uaApAQCAtMTgwLDYgKzE4MCw3
IEBAIHN0cnVjdCBpbnRlbF9kZXZpY2VfaW5mbyB7CiAJfSBkaXNwbGF5OwogCiAJdTE2IGRkYl9z
aXplOyAvKiBpbiBibG9ja3MgKi8KKwl1OCBudW1fc3VwcG9ydGVkX2RidWZfc2xpY2VzOyAvKiBu
dW1iZXIgb2YgREJ1ZiBzbGljZXMgKi8KIAogCS8qIFJlZ2lzdGVyIG9mZnNldHMgZm9yIHRoZSB2
YXJpb3VzIGRpc3BsYXkgcGlwZXMgYW5kIHRyYW5zY29kZXJzICovCiAJaW50IHBpcGVfb2Zmc2V0
c1tJOTE1X01BWF9UUkFOU0NPREVSU107CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uYwppbmRleCBiOGQ3
OGUyNjUxNWMuLmNhNWIzNGQyOTdkOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aW50ZWxfcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCkBAIC0zNjQ0
LDI2ICszNjQ0LDE4IEBAIGJvb2wgaWxrX2Rpc2FibGVfbHBfd20oc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQogCXJldHVybiBfaWxrX2Rpc2FibGVfbHBfd20oZGV2X3ByaXYsIFdN
X0RJUlRZX0xQX0FMTCk7CiB9CiAKLXU4IGludGVsX2VuYWJsZWRfZGJ1Zl9zbGljZXNfbnVtKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKK3U4IGludGVsX2VuYWJsZWRfZGJ1Zl9z
bGljZXNfbWFzayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7Ci0JdTggZW5h
YmxlZF9kYnVmX3NsaWNlc19udW07Ci0KLQkvKiBTbGljZSAxIHdpbGwgYWx3YXlzIGJlIGVuYWJs
ZWQgKi8KLQllbmFibGVkX2RidWZfc2xpY2VzX251bSA9IDE7Ci0KLQkvKiBHZW4gcHJpb3IgdG8g
R0VOMTEgaGF2ZSBvbmx5IG9uZSBEQnVmIHNsaWNlICovCi0JaWYgKElOVEVMX0dFTihkZXZfcHJp
dikgPCAxMSkKLQkJcmV0dXJuIGVuYWJsZWRfZGJ1Zl9zbGljZXNfbnVtOworCWludCBpOworCWlu
dCBtYXhfc2xpY2VzID0gSU5URUxfSU5GTyhkZXZfcHJpdiktPm51bV9zdXBwb3J0ZWRfZGJ1Zl9z
bGljZXM7CisJdTggZW5hYmxlZF9zbGljZXNfbWFzayA9IDA7CiAKLQkvKgotCSAqIEZJWE1FOiBm
b3Igbm93IHdlJ2xsIG9ubHkgZXZlciB1c2UgMSBzbGljZTsgcHJldGVuZCB0aGF0IHdlIGhhdmUK
LQkgKiBvbmx5IHRoYXQgMSBzbGljZSBlbmFibGVkIHVudGlsIHdlIGhhdmUgYSBwcm9wZXIgd2F5
IGZvciBvbi1kZW1hbmQKLQkgKiB0b2dnbGluZyBvZiB0aGUgc2Vjb25kIHNsaWNlLgotCSAqLwot
CWlmICgwICYmIEk5MTVfUkVBRChfREJVRl9DVExfUyhEQlVGX1MyKSkgJiBEQlVGX1BPV0VSX1NU
QVRFKQotCQllbmFibGVkX2RidWZfc2xpY2VzX251bSsrOworCWZvciAoaSA9IDA7IGkgPCBtYXhf
c2xpY2VzOyBpKyspIHsKKwkJaWYgKEk5MTVfUkVBRChfREJVRl9DVExfUyhpKSkgJiBEQlVGX1BP
V0VSX1NUQVRFKQorCQkJZW5hYmxlZF9zbGljZXNfbWFzayB8PSBCSVQoaSk7CisJfQogCi0JcmV0
dXJuIGVuYWJsZWRfZGJ1Zl9zbGljZXNfbnVtOworCXJldHVybiBlbmFibGVkX3NsaWNlc19tYXNr
OwogfQogCiAvKgpAQCAtMzg3MSw4ICszODYzLDYgQEAgc3RhdGljIHUxNiBpbnRlbF9nZXRfZGRi
X3NpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogewogCXN0cnVjdCBkcm1f
YXRvbWljX3N0YXRlICpzdGF0ZSA9IGNydGNfc3RhdGUtPnVhcGkuc3RhdGU7CiAJc3RydWN0IGlu
dGVsX2F0b21pY19zdGF0ZSAqaW50ZWxfc3RhdGUgPSB0b19pbnRlbF9hdG9taWNfc3RhdGUoc3Rh
dGUpOwotCWNvbnN0IHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICphZGp1c3RlZF9tb2RlOwotCXU2
NCB0b3RhbF9kYXRhX2J3OwogCXUxNiBkZGJfc2l6ZSA9IElOVEVMX0lORk8oZGV2X3ByaXYpLT5k
ZGJfc2l6ZTsKIAogCWRybV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCBkZGJfc2l6ZSA9PSAwKTsK
QEAgLTM4ODAsMjMgKzM4NzAsOCBAQCBzdGF0aWMgdTE2IGludGVsX2dldF9kZGJfc2l6ZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikg
PCAxMSkKIAkJcmV0dXJuIGRkYl9zaXplIC0gNDsgLyogNCBibG9ja3MgZm9yIGJ5cGFzcyBwYXRo
IGFsbG9jYXRpb24gKi8KIAotCWFkanVzdGVkX21vZGUgPSAmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0
ZWRfbW9kZTsKLQl0b3RhbF9kYXRhX2J3ID0gdG90YWxfZGF0YV9yYXRlICogZHJtX21vZGVfdnJl
ZnJlc2goYWRqdXN0ZWRfbW9kZSk7Ci0KLQkvKgotCSAqIDEyR0IvcyBpcyBtYXhpbXVtIEJXIHN1
cHBvcnRlZCBieSBzaW5nbGUgREJ1ZiBzbGljZS4KLQkgKgotCSAqIEZJWE1FIGRidWYgc2xpY2Ug
Y29kZSBpcyBicm9rZW46Ci0JICogLSBtdXN0IHdhaXQgZm9yIHBsYW5lcyB0byBzdG9wIHVzaW5n
IHRoZSBzbGljZSBiZWZvcmUgcG93ZXJpbmcgaXQgb2ZmCi0JICogLSBwbGFuZSBzdHJhZGRsaW5n
IGJvdGggc2xpY2VzIGlzIGlsbGVnYWwgaW4gbXVsdGktcGlwZSBzY2VuYXJpb3MKLQkgKiAtIHNo
b3VsZCB2YWxpZGF0ZSB3ZSBzdGF5IHdpdGhpbiB0aGUgaHcgYmFuZHdpZHRoIGxpbWl0cwotCSAq
LwotCWlmICgwICYmIChudW1fYWN0aXZlID4gMSB8fCB0b3RhbF9kYXRhX2J3ID49IEdCcHMoMTIp
KSkgewotCQlpbnRlbF9zdGF0ZS0+ZW5hYmxlZF9kYnVmX3NsaWNlc19udW0gPSAyOwotCX0gZWxz
ZSB7Ci0JCWludGVsX3N0YXRlLT5lbmFibGVkX2RidWZfc2xpY2VzX251bSA9IDE7Ci0JCWRkYl9z
aXplIC89IDI7Ci0JfQorCWludGVsX3N0YXRlLT5lbmFibGVkX2RidWZfc2xpY2VzX21hc2sgPSBC
SVQoREJVRl9TMSk7CisJZGRiX3NpemUgLz0gMjsKIAogCXJldHVybiBkZGJfc2l6ZTsKIH0KQEAg
LTQwOTMsOCArNDA2OCw4IEBAIHZvaWQgc2tsX3BpcGVfZGRiX2dldF9od19zdGF0ZShzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YywKIAogdm9pZCBza2xfZGRiX2dldF9od19zdGF0ZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7Ci0JZGV2X3ByaXYtPmVuYWJsZWRfZGJ1Zl9zbGlj
ZXNfbnVtID0KLQkJCQlpbnRlbF9lbmFibGVkX2RidWZfc2xpY2VzX251bShkZXZfcHJpdik7CisJ
ZGV2X3ByaXYtPmVuYWJsZWRfZGJ1Zl9zbGljZXNfbWFzayA9CisJCQkJaW50ZWxfZW5hYmxlZF9k
YnVmX3NsaWNlc19tYXNrKGRldl9wcml2KTsKIH0KIAogLyoKQEAgLTUyMzgsNyArNTIxMyw3IEBA
IHNrbF9jb21wdXRlX2RkYihzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAlzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YzsKIAlpbnQgcmV0LCBpOwogCi0Jc3RhdGUtPmVuYWJsZWRfZGJ1
Zl9zbGljZXNfbnVtID0gZGV2X3ByaXYtPmVuYWJsZWRfZGJ1Zl9zbGljZXNfbnVtOworCXN0YXRl
LT5lbmFibGVkX2RidWZfc2xpY2VzX21hc2sgPSBkZXZfcHJpdi0+ZW5hYmxlZF9kYnVmX3NsaWNl
c19tYXNrOwogCiAJZm9yX2VhY2hfb2xkbmV3X2ludGVsX2NydGNfaW5fc3RhdGUoc3RhdGUsIGNy
dGMsIG9sZF9jcnRjX3N0YXRlLAogCQkJCQkgICAgbmV3X2NydGNfc3RhdGUsIGkpIHsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmggYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9wbS5oCmluZGV4IDIyZmQyZGFmNjA4ZS4uZDYwYTg1NDIxYzVhIDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5oCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2ludGVsX3BtLmgKQEAgLTMyLDcgKzMyLDcgQEAgdm9pZCBnNHhfd21fZ2V0X2h3X3N0
YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiB2b2lkIHZsdl93bV9nZXRf
aHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIHZvaWQgaWxrX3dt
X2dldF9od19zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogdm9pZCBz
a2xfd21fZ2V0X2h3X3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci11
OCBpbnRlbF9lbmFibGVkX2RidWZfc2xpY2VzX251bShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpOwordTggaW50ZWxfZW5hYmxlZF9kYnVmX3NsaWNlc19tYXNrKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiB2b2lkIHNrbF9waXBlX2RkYl9nZXRfaHdfc3RhdGUo
c3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJCQkgICAgICAgc3RydWN0IHNrbF9kZGJfZW50cnkg
KmRkYl95LAogCQkJICAgICAgIHN0cnVjdCBza2xfZGRiX2VudHJ5ICpkZGJfdXYpOwotLSAKMi4y
NC4xLjQ4NS5nYWQwNWEzZDhlNQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
aW50ZWwtZ2Z4Cg==

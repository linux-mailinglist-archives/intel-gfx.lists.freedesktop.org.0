Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 71EFEFF47E
	for <lists+intel-gfx@lfdr.de>; Sat, 16 Nov 2019 18:52:09 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 53A1D6E130;
	Sat, 16 Nov 2019 17:52:07 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 09C186E130
 for <intel-gfx@lists.freedesktop.org>; Sat, 16 Nov 2019 17:51:52 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19226428-1500050 
 for multiple; Sat, 16 Nov 2019 17:51:43 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sat, 16 Nov 2019 17:51:39 +0000
Message-Id: <20191116175139.1790440-11-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191116175139.1790440-1-chris@chris-wilson.co.uk>
References: <20191116175139.1790440-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 11/11] drm/i915/gt: Track engine round-trip times
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

S25vd2luZyB0aGUgcm91bmQgdHJpcCB0aW1lIG9mIGFuIGVuZ2luZSBpcyB1c2VmdWwgZm9yIHRy
YWNraW5nIHRoZQpoZWFsdGggb2YgdGhlIHN5c3RlbSBhcyB3ZWxsIGFzIHByb3ZpZGluZyBhIG1l
dHJpYyBmb3IgdGhlIGJhc2VsaW5lCnJlc3BvbnNpdmVuZXNzIG9mIHRoZSBlbmdpbmUuIFdlIGNh
biB1c2UgdGhlIGxhdHRlciBtZXRyaWMgZm9yCmF1dG9tYXRpY2FsbHkgdHVuaW5nIG91ciB3YWl0
cyBpbiBzZWxmdGVzdHMgYW5kIHdoZW4gaWRsaW5nIHNvIHdlIGRvbid0CmNvbmZ1c2UgYSBzbG93
ZXIgc3lzdGVtIHdpdGggYSBkZWFkIG9uZS4KClVwb24gaWRsaW5nIHRoZSBlbmdpbmUsIHdlIHNl
bmQgb25lIGxhc3QgcHVsc2UgdG8gc3dpdGNoIHRoZSBjb250ZXh0CmF3YXkgZnJvbSBwcmVjaW91
cyB1c2VyIHN0YXRlIHRvIHRoZSB2b2xhdGlsZSBrZXJuZWwgY29udGV4dC4gV2Uga25vdwp0aGUg
ZW5naW5lIGlzIGlkbGUgYXQgdGhpcyBwb2ludCwgYW5kIHRoZSBwdWxzZSBpcyBub24tcHJlZW1w
dGFibGUsIHNvCnRoaXMgcHJvdmlkZXMgdXMgd2l0aCBhIGdvb2QgbWVhc3VyZW1lbnQgb2YgdGhl
IHJvdW5kIHRyaXAgdGltZS4gQQpzZWNvbmRhcnkgZWZmZWN0IGlzIHRoYXQgYnkgaW5zdGFsbGlu
ZyBhbiBpbnRlcnJ1cHQgb250byB0aGUgcHVsc2UsIHdlCmNhbiBmbHVzaCB0aGUgZW5naW5lIGlt
bWVkaWF0ZWx5IHVwb24gY29tcGxldGlvbiwgY3VydGFpbGluZyB0aGUKYmFja2dyb3VuZCBmbHVz
aCBhbmQgZW50ZXJpbmcgcG93ZXJzYXZpbmcgaW1tZWRpYXRlbHkuCgp2MjogTWFuYWdlIHBtIHdh
a2VyZWZzIHRvIGF2b2lkIHRvbyBlYXJseSBtb2R1bGUgdW5sb2FkCgpSZWZlcmVuY2VzOiA3ZTM0
ZjRlNGFhZDMgKCJkcm0vaTkxNS9nZW44KzogQWRkIFJDNiBDVFggY29ycnVwdGlvbiBXQSIpClNp
Z25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzog
VHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KQ2M6IFN0dWFydCBTdW1t
ZXJzIDxzdHVhcnQuc3VtbWVyc0BpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZW5naW5lX2NzLmMgICAgfCAgMiArKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfZW5naW5lX3BtLmMgICAgfCAzNiArKysrKysrKysrKysrKysrKysrLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmggfCAxMSArKysrKysKIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmggICAgICAgIHwgIDUgKysrCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF93YWtlcmVmLmggICAgICAgICB8IDEzICsrKysrKysKIDUgZmlsZXMg
Y2hhbmdlZCwgNjYgaW5zZXJ0aW9ucygrKSwgMSBkZWxldGlvbigtKQoKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKaW5kZXggYjk2MTNkMDQ0MzkzLi4yZDExZGIxM2Rj
ODkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jCkBAIC0zMzQs
NiArMzM0LDcgQEAgc3RhdGljIGludCBpbnRlbF9lbmdpbmVfc2V0dXAoc3RydWN0IGludGVsX2d0
ICpndCwgZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQpCiAJLyogTm90aGluZyB0byBkbyBoZXJlLCBl
eGVjdXRlIGluIG9yZGVyIG9mIGRlcGVuZGVuY2llcyAqLwogCWVuZ2luZS0+c2NoZWR1bGUgPSBO
VUxMOwogCisJZXdtYV9kZWxheV9pbml0KCZlbmdpbmUtPmRlbGF5KTsKIAlzZXFsb2NrX2luaXQo
JmVuZ2luZS0+c3RhdHMubG9jayk7CiAKIAlBVE9NSUNfSU5JVF9OT1RJRklFUl9IRUFEKCZlbmdp
bmUtPmNvbnRleHRfc3RhdHVzX25vdGlmaWVyKTsKQEAgLTE0NzcsNiArMTQ3OCw3IEBAIHZvaWQg
aW50ZWxfZW5naW5lX2R1bXAoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCQlkcm1f
cHJpbnRmKG0sICIqKiogV0VER0VEICoqKlxuIik7CiAKIAlkcm1fcHJpbnRmKG0sICJcdEF3YWtl
PyAlZFxuIiwgYXRvbWljX3JlYWQoJmVuZ2luZS0+d2FrZXJlZi5jb3VudCkpOworCWRybV9wcmlu
dGYobSwgIlx0RGVsYXk6ICVsdXVzXG4iLCBld21hX2RlbGF5X3JlYWQoJmVuZ2luZS0+ZGVsYXkp
KTsKIAogCXJjdV9yZWFkX2xvY2soKTsKIAlycSA9IFJFQURfT05DRShlbmdpbmUtPmhlYXJ0YmVh
dC5zeXN0b2xlKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Vu
Z2luZV9wbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3BtLmMKaW5k
ZXggM2MwZjQ5MGZmMmM3Li5lNzliMTRlNDU5OWIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2VuZ2luZV9wbS5jCkBAIC03Myw2ICs3MywyNCBAQCBzdGF0aWMgaW5saW5lIHZvaWQg
X190aW1lbGluZV9tYXJrX3VubG9jayhzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAKICNlbmRp
ZiAvKiAhSVNfRU5BQkxFRChDT05GSUdfTE9DS0RFUCkgKi8KIAorc3RydWN0IGR1cmF0aW9uX2Ni
IHsKKwlzdHJ1Y3QgZG1hX2ZlbmNlX2NiIGNiOworCWt0aW1lX3QgZW1pdHRlZDsKK307CisKK3N0
YXRpYyB2b2lkIGR1cmF0aW9uX2NiKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlLCBzdHJ1Y3QgZG1h
X2ZlbmNlX2NiICpjYikKK3sKKwlzdHJ1Y3QgZHVyYXRpb25fY2IgKmRjYiA9IGNvbnRhaW5lcl9v
ZihjYiwgdHlwZW9mKCpkY2IpLCBjYik7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5l
ID0gdG9fcmVxdWVzdChmZW5jZSktPmVuZ2luZTsKKworCWV3bWFfZGVsYXlfYWRkKCZlbmdpbmUt
PmRlbGF5LAorCQkgICAgICAga3RpbWVfdXNfZGVsdGEoa3RpbWVfZ2V0KCksIGRjYi0+ZW1pdHRl
ZCkpOworCisJLyogS2ljayByZXRpcmUgZm9yIHF1aWNrZXIgcG93ZXJzYXZpbmcgKHNvZnQtcmM2
KS4gKi8KKwltb2RfZGVsYXllZF93b3JrKHN5c3RlbV93cSwgJmVuZ2luZS0+Z3QtPnJlcXVlc3Rz
LnJldGlyZV93b3JrLCAwKTsKKwlpbnRlbF9ndF9wbV9wdXQoZW5naW5lLT5ndCk7Cit9CisKIHN0
YXRpYyBib29sIHN3aXRjaF90b19rZXJuZWxfY29udGV4dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2Nz
ICplbmdpbmUpCiB7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CkBAIC0xMTQsNyArMTMyLDIz
IEBAIHN0YXRpYyBib29sIHN3aXRjaF90b19rZXJuZWxfY29udGV4dChzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmUpCiAKIAkvKiBJbnN0YWxsIG91cnNlbHZlcyBhcyBhIHByZWVtcHRpb24g
YmFycmllciAqLwogCXJxLT5zY2hlZC5hdHRyLnByaW9yaXR5ID0gSTkxNV9QUklPUklUWV9CQVJS
SUVSOwotCV9faTkxNV9yZXF1ZXN0X2NvbW1pdChycSk7CisJaWYgKGxpa2VseSghX19pOTE1X3Jl
cXVlc3RfY29tbWl0KHJxKSkpIHsgLyogZW5naW5lIHNob3VsZCBiZSBpZGxlISAqLworCQlzdHJ1
Y3QgZHVyYXRpb25fY2IgKmRjYjsKKworCQlCVUlMRF9CVUdfT04oc2l6ZW9mKCpkY2IpID4gc2l6
ZW9mKHJxLT5zdWJtaXRxKSk7CisJCWRjYiA9IChzdHJ1Y3QgZHVyYXRpb25fY2IgKikmcnEtPnN1
Ym1pdHE7CisKKwkJLyoKKwkJICogVXNlIGFuIGludGVycnVwdCBmb3IgcHJlY2lzZSBtZWFzdXJl
bWVudCBvZiBkdXJhdGlvbiwKKwkJICogb3RoZXJ3aXNlIHdlIHJlbHkgb24gc29tZW9uZSBlbHNl
IHJldGlyaW5nIGFsbCB0aGUgcmVxdWVzdHMKKwkJICogd2hpY2ggbWF5IGRlbGF5IHRoZSBzaWdu
YWxpbmcgKGkuZS4gd2Ugd2lsbCBsaWtlbHkgd2FpdAorCQkgKiB1bnRpbCB0aGUgYmFja2dyb3Vu
ZCByZXF1ZXN0IHJldGlyZW1lbnQgcnVubmluZyBldmVyeQorCQkgKiBzZWNvbmQgb3IgdHdvKS4K
KwkJICovCisJCV9faW50ZWxfZ3RfcG1fZ2V0KHJxLT5lbmdpbmUtPmd0KTsKKwkJZG1hX2ZlbmNl
X2FkZF9jYWxsYmFjaygmcnEtPmZlbmNlLCAmZGNiLT5jYiwgZHVyYXRpb25fY2IpOworCQlkY2It
PmVtaXR0ZWQgPSBrdGltZV9nZXQoKTsKKwl9CiAKIAkvKiBSZWxlYXNlIG91ciBleGNsdXNpdmUg
aG9sZCBvbiB0aGUgZW5naW5lICovCiAJX19pbnRlbF93YWtlcmVmX2RlZmVyX3BhcmsoJmVuZ2lu
ZS0+d2FrZXJlZik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9l
bmdpbmVfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV90eXBl
cy5oCmluZGV4IDc1OGYwZThlYzY3Mi4uMWRlMTIxNTgzNDgyIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMuaApAQCAtNyw2ICs3LDcgQEAKICNpZm5kZWYg
X19JTlRFTF9FTkdJTkVfVFlQRVNfXwogI2RlZmluZSBfX0lOVEVMX0VOR0lORV9UWVBFU19fCiAK
KyNpbmNsdWRlIDxsaW51eC9hdmVyYWdlLmg+CiAjaW5jbHVkZSA8bGludXgvaGFzaHRhYmxlLmg+
CiAjaW5jbHVkZSA8bGludXgvaXJxX3dvcmsuaD4KICNpbmNsdWRlIDxsaW51eC9rcmVmLmg+CkBA
IC0xMTksNiArMTIwLDkgQEAgZW51bSBpbnRlbF9lbmdpbmVfaWQgewogI2RlZmluZSBJTlZBTElE
X0VOR0lORSAoKGVudW0gaW50ZWxfZW5naW5lX2lkKS0xKQogfTsKIAorLyogQSBzaW1wbGUgZXN0
aW1hdG9yIGZvciB0aGUgcm91bmQtdHJpcCByZXNwb25zaXZlIHRpbWUgb2YgYW4gZW5naW5lICov
CitERUNMQVJFX0VXTUEoZGVsYXksIDYsIDQpCisKIHN0cnVjdCBzdF9wcmVlbXB0X2hhbmcgewog
CXN0cnVjdCBjb21wbGV0aW9uIGNvbXBsZXRpb247CiAJdW5zaWduZWQgaW50IGNvdW50OwpAQCAt
MzE2LDYgKzMyMCwxMyBAQCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzIHsKIAkJc3RydWN0IGludGVs
X3RpbWVsaW5lICp0aW1lbGluZTsKIAl9IGxlZ2FjeTsKIAorCS8qCisJICogV2UgdHJhY2sgdGhl
IGF2ZXJhZ2UgZHVyYXRpb24gb2YgdGhlIGlkbGUgcHVsc2Ugb24gcGFya2luZyB0aGUKKwkgKiBl
bmdpbmUgdG8ga2VlcCBhbiBlc3RpbWF0ZSBvZiB0aGUgaG93IHRoZSBmYXN0IHRoZSBlbmdpbmUg
aXMKKwkgKiB1bmRlciBpZGVhbCBjb25kaXRpb25zLgorCSAqLworCXN0cnVjdCBld21hX2RlbGF5
IGRlbGF5OworCiAJLyogUmF0aGVyIHRoYW4gaGF2ZSBldmVyeSBjbGllbnQgd2FpdCB1cG9uIGFs
bCB1c2VyIGludGVycnVwdHMsCiAJICogd2l0aCB0aGUgaGVyZCB3YWtpbmcgYWZ0ZXIgZXZlcnkg
aW50ZXJydXB0IGFuZCBlYWNoIGRvaW5nIHRoZQogCSAqIGhlYXZ5d2VpZ2h0IHNlcW5vIGRhbmNl
LCB3ZSBkZWxlZ2F0ZSB0aGUgdGFzayAob2YgYmVpbmcgdGhlCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfZ3RfcG0uaAppbmRleCA5OTBlZmMyN2E0ZTQuLjRhOWU0OGMxMmJkNCAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uaAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5oCkBAIC0yMiw2ICsyMiwxMSBAQCBzdGF0aWMgaW5s
aW5lIHZvaWQgaW50ZWxfZ3RfcG1fZ2V0KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAJaW50ZWxfd2Fr
ZXJlZl9nZXQoJmd0LT53YWtlcmVmKTsKIH0KIAorc3RhdGljIGlubGluZSB2b2lkIF9faW50ZWxf
Z3RfcG1fZ2V0KHN0cnVjdCBpbnRlbF9ndCAqZ3QpCit7CisJX19pbnRlbF93YWtlcmVmX2dldCgm
Z3QtPndha2VyZWYpOworfQorCiBzdGF0aWMgaW5saW5lIGJvb2wgaW50ZWxfZ3RfcG1fZ2V0X2lm
X2F3YWtlKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiB7CiAJcmV0dXJuIGludGVsX3dha2VyZWZfZ2V0
X2lmX2FjdGl2ZSgmZ3QtPndha2VyZWYpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaW50ZWxfd2FrZXJlZi5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd2FrZXJlZi5o
CmluZGV4IGVlYWMzZTdkZmFmZS4uOTIyMTA2NzI2OWNlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF93YWtlcmVmLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfd2FrZXJlZi5oCkBAIC04MSw2ICs4MSwxOSBAQCBpbnRlbF93YWtlcmVmX2dldChzdHJ1Y3Qg
aW50ZWxfd2FrZXJlZiAqd2YpCiAJcmV0dXJuIDA7CiB9CiAKKy8qKgorICogX19pbnRlbF93YWtl
cmVmX2dldDogQWNxdWlyZSB0aGUgd2FrZXJlZiwgYWdhaW4KKyAqIEB3ZjogdGhlIHdha2VyZWYK
KyAqCisgKiBBY3F1aXJlIGEgaG9sZCBvbiBhbiBhbHJlYWR5IGFjdGl2ZSB3YWtlcmVmLgorICov
CitzdGF0aWMgaW5saW5lIHZvaWQKK19faW50ZWxfd2FrZXJlZl9nZXQoc3RydWN0IGludGVsX3dh
a2VyZWYgKndmKQoreworCUlOVEVMX1dBS0VSRUZfQlVHX09OKGF0b21pY19yZWFkKCZ3Zi0+Y291
bnQpIDw9IDApOworCWF0b21pY19pbmMoJndmLT5jb3VudCk7Cit9CisKIC8qKgogICogaW50ZWxf
d2FrZXJlZl9nZXRfaWZfaW5fdXNlOiBBY3F1aXJlIHRoZSB3YWtlcmVmCiAgKiBAd2Y6IHRoZSB3
YWtlcmVmCi0tIAoyLjI0LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2lu
dGVsLWdmeA==

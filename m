Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 78D92E2F81
	for <lists+intel-gfx@lfdr.de>; Thu, 24 Oct 2019 12:55:12 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 68BF76E266;
	Thu, 24 Oct 2019 10:55:04 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id EEF756E24D
 for <intel-gfx@lists.freedesktop.org>; Thu, 24 Oct 2019 10:54:59 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18947986-1500050 
 for multiple; Thu, 24 Oct 2019 11:54:51 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 24 Oct 2019 11:54:46 +0100
Message-Id: <20191024105449.31948-6-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0.rc0
In-Reply-To: <20191024105449.31948-1-chris@chris-wilson.co.uk>
References: <20191024105449.31948-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t 6/9] i915: Exercise preemption timeout
 controls in sysfs
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgW3dpbGxdIGV4cG9zZSB2YXJpb3VzIHBlci1lbmdpbmUgc2NoZWR1bGluZyBjb250cm9scy4g
T25lIG9mIHdoaWNoLAoncHJlZW1wdF90aW1lb3V0X21zJywgZGVmaW5lcyBob3cgd2Ugd2FpdCBm
b3IgYSBwcmVlbXB0aW9uIHJlcXVlc3QgdG8gYmUKaG9ub3VyZWQgYnkgdGhlIGN1cnJlbnRseSBl
eGVjdXRpbmcgY29udGV4dC4gSWYgaXQgZmFpbHMgdG8gcmVsaWV2ZSB0aGUKR1BVIHdpdGhpbiB0
aGUgcmVxdWlyZWQgdGltZW91dCwgdGhlIGVuZ2luZSBpcyByZXNldCBhbmQgdGhlIG1pc2NyZWFu
dApmb3JjaWJseSBldmljdGVkLgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0Bj
aHJpcy13aWxzb24uY28udWs+Ci0tLQogbGliL2k5MTUvZ2VtX2NvbnRleHQuYyAgICAgICAgICAg
ICB8ICA0MSArKysrCiBsaWIvaTkxNS9nZW1fY29udGV4dC5oICAgICAgICAgICAgIHwgICAyICsK
IHRlc3RzL01ha2VmaWxlLnNvdXJjZXMgICAgICAgICAgICAgfCAgIDEgKwogdGVzdHMvaTkxNS9z
eXNmc19wcmVlbXB0X3RpbWVvdXQuYyB8IDM1MyArKysrKysrKysrKysrKysrKysrKysrKysrKysr
KwogdGVzdHMvbWVzb24uYnVpbGQgICAgICAgICAgICAgICAgICB8ICAgMSArCiA1IGZpbGVzIGNo
YW5nZWQsIDM5OCBpbnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgdGVzdHMvaTkxNS9z
eXNmc19wcmVlbXB0X3RpbWVvdXQuYwoKZGlmZiAtLWdpdCBhL2xpYi9pOTE1L2dlbV9jb250ZXh0
LmMgYi9saWIvaTkxNS9nZW1fY29udGV4dC5jCmluZGV4IDFmYWU1MTkxZi4uYWEwODNjMmYwIDEw
MDY0NAotLS0gYS9saWIvaTkxNS9nZW1fY29udGV4dC5jCisrKyBiL2xpYi9pOTE1L2dlbV9jb250
ZXh0LmMKQEAgLTQwMywzICs0MDMsNDQgQEAgYm9vbCBnZW1fY29udGV4dF9oYXNfZW5naW5lKGlu
dCBmZCwgdWludDMyX3QgY3R4LCB1aW50NjRfdCBlbmdpbmUpCiAKIAlyZXR1cm4gX19nZW1fZXhl
Y2J1ZihmZCwgJmV4ZWNidWYpID09IC1FTk9FTlQ7CiB9CisKK3N0YXRpYyBpbnQgY3JlYXRlX2V4
dF9pb2N0bChpbnQgaTkxNSwKKwkJCSAgICBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2NvbnRleHRfY3Jl
YXRlX2V4dCAqYXJnKQoreworCWludCBlcnI7CisKKwllcnIgPSAwOworCWlmIChpZ3RfaW9jdGwo
aTkxNSwgRFJNX0lPQ1RMX0k5MTVfR0VNX0NPTlRFWFRfQ1JFQVRFX0VYVCwgYXJnKSkgeworCQll
cnIgPSAtZXJybm87CisJCWlndF9hc3N1bWUoZXJyKTsKKwl9CisKKwllcnJubyA9IDA7CisJcmV0
dXJuIGVycjsKK30KKwordWludDMyX3QgZ2VtX2NvbnRleHRfY3JlYXRlX2Zvcl9lbmdpbmUoaW50
IGk5MTUsIHVuc2lnbmVkIGludCBjbGFzcywgdW5zaWduZWQgaW50IGluc3QpCit7CisJSTkxNV9E
RUZJTkVfQ09OVEVYVF9QQVJBTV9FTkdJTkVTKGVuZ2luZXMsIDEpID0geworCQkuZW5naW5lcyA9
IHsgeyAuZW5naW5lX2NsYXNzID0gY2xhc3MsIC5lbmdpbmVfaW5zdGFuY2UgPSBpbnN0IH0gfQor
CX07CisJc3RydWN0IGRybV9pOTE1X2dlbV9jb250ZXh0X2NyZWF0ZV9leHRfc2V0cGFyYW0gcF9l
bmdpbmVzID0geworCQkuYmFzZSA9IHsKKwkJCS5uYW1lID0gSTkxNV9DT05URVhUX0NSRUFURV9F
WFRfU0VUUEFSQU0sCisJCQkubmV4dF9leHRlbnNpb24gPSAwLCAvKiBlbmQgb2YgY2hhaW4gKi8K
KwkJfSwKKwkJLnBhcmFtID0geworCQkJLnBhcmFtID0gSTkxNV9DT05URVhUX1BBUkFNX0VOR0lO
RVMsCisJCQkudmFsdWUgPSB0b191c2VyX3BvaW50ZXIoJmVuZ2luZXMpLAorCQkJLnNpemUgPSBz
aXplb2YoZW5naW5lcyksCisJCX0sCisJfTsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2NvbnRleHRf
Y3JlYXRlX2V4dCBjcmVhdGUgPSB7CisJCS5mbGFncyA9IEk5MTVfQ09OVEVYVF9DUkVBVEVfRkxB
R1NfVVNFX0VYVEVOU0lPTlMsCisJCS5leHRlbnNpb25zID0gdG9fdXNlcl9wb2ludGVyKCZwX2Vu
Z2luZXMpLAorCX07CisKKwlpZ3RfYXNzZXJ0X2VxKGNyZWF0ZV9leHRfaW9jdGwoaTkxNSwgJmNy
ZWF0ZSksIDApOworCWlndF9hc3NlcnRfbmVxKGNyZWF0ZS5jdHhfaWQsIDApOworCXJldHVybiBj
cmVhdGUuY3R4X2lkOworfQpkaWZmIC0tZ2l0IGEvbGliL2k5MTUvZ2VtX2NvbnRleHQuaCBiL2xp
Yi9pOTE1L2dlbV9jb250ZXh0LmgKaW5kZXggYzBkNGM5NjE1Li45ZTBhMDgzZjAgMTAwNjQ0Ci0t
LSBhL2xpYi9pOTE1L2dlbV9jb250ZXh0LmgKKysrIGIvbGliL2k5MTUvZ2VtX2NvbnRleHQuaApA
QCAtMzQsNiArMzQsOCBAQCBpbnQgX19nZW1fY29udGV4dF9jcmVhdGUoaW50IGZkLCB1aW50MzJf
dCAqY3R4X2lkKTsKIHZvaWQgZ2VtX2NvbnRleHRfZGVzdHJveShpbnQgZmQsIHVpbnQzMl90IGN0
eF9pZCk7CiBpbnQgX19nZW1fY29udGV4dF9kZXN0cm95KGludCBmZCwgdWludDMyX3QgY3R4X2lk
KTsKIAordWludDMyX3QgZ2VtX2NvbnRleHRfY3JlYXRlX2Zvcl9lbmdpbmUoaW50IGZkLCB1bnNp
Z25lZCBpbnQgY2xhc3MsIHVuc2lnbmVkIGludCBpbnN0KTsKKwogaW50IF9fZ2VtX2NvbnRleHRf
Y2xvbmUoaW50IGk5MTUsCiAJCQl1aW50MzJfdCBzcmMsIHVuc2lnbmVkIGludCBzaGFyZSwKIAkJ
CXVuc2lnbmVkIGludCBmbGFncywKZGlmZiAtLWdpdCBhL3Rlc3RzL01ha2VmaWxlLnNvdXJjZXMg
Yi90ZXN0cy9NYWtlZmlsZS5zb3VyY2VzCmluZGV4IDA5M2ViNTdmMy4uYzk5MDFhZjE4IDEwMDY0
NAotLS0gYS90ZXN0cy9NYWtlZmlsZS5zb3VyY2VzCisrKyBiL3Rlc3RzL01ha2VmaWxlLnNvdXJj
ZXMKQEAgLTk4LDYgKzk4LDcgQEAgVEVTVFNfcHJvZ3MgPSBcCiAJdG9vbHNfdGVzdCBcCiAJdmdl
bV9iYXNpYyBcCiAJdmdlbV9zbG93IFwKKwlpOTE1L3N5c2ZzX3ByZWVtcHRfdGltZW91dCBcCiAJ
JChOVUxMKQogCiBURVNUU19wcm9ncyArPSBnZW1fYmFkX3JlbG9jCmRpZmYgLS1naXQgYS90ZXN0
cy9pOTE1L3N5c2ZzX3ByZWVtcHRfdGltZW91dC5jIGIvdGVzdHMvaTkxNS9zeXNmc19wcmVlbXB0
X3RpbWVvdXQuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAuLjliZGQ4MTk5
YgotLS0gL2Rldi9udWxsCisrKyBiL3Rlc3RzL2k5MTUvc3lzZnNfcHJlZW1wdF90aW1lb3V0LmMK
QEAgLTAsMCArMSwzNTMgQEAKKy8qCisgKiBDb3B5cmlnaHQgwqkgMjAxOSBJbnRlbCBDb3Jwb3Jh
dGlvbgorICoKKyAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdl
LCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhCisgKiBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5k
IGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLAorICogdG8g
ZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhv
dXQgbGltaXRhdGlvbgorICogdGhlIHJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2Us
IHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsCisgKiBhbmQvb3Igc2VsbCBjb3BpZXMg
b2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUKKyAqIFNv
ZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNv
bmRpdGlvbnM6CisgKgorICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVy
bWlzc2lvbiBub3RpY2UgKGluY2x1ZGluZyB0aGUgbmV4dAorICogcGFyYWdyYXBoKSBzaGFsbCBi
ZSBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZQor
ICogU29mdHdhcmUuCisgKgorICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJ
VEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKKyAqIElNUExJRUQsIElOQ0xV
RElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZ
LAorICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVO
VC4gIElOIE5PIEVWRU5UIFNIQUxMCisgKiBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVS
UyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgorICogTElBQklMSVRZ
LCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFS
SVNJTkcKKyAqIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJF
IE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MKKyAqIElOIFRIRSBTT0ZUV0FSRS4KKyAqLwor
CisjaW5jbHVkZSA8ZGlyZW50Lmg+CisjaW5jbHVkZSA8ZXJybm8uaD4KKyNpbmNsdWRlIDxmY250
bC5oPgorI2luY2x1ZGUgPGludHR5cGVzLmg+CisjaW5jbHVkZSA8c3lzL3N0YXQuaD4KKyNpbmNs
dWRlIDxzeXMvdHlwZXMuaD4KKyNpbmNsdWRlIDx1bmlzdGQuaD4KKworI2luY2x1ZGUgImRybXRl
c3QuaCIgLyogZ2VtX3F1aWVzY2VudF9ncHUoKSEgKi8KKyNpbmNsdWRlICJpOTE1L2dlbV9lbmdp
bmVfdG9wb2xvZ3kuaCIKKyNpbmNsdWRlICJpZ3RfZHVtbXlsb2FkLmgiCisjaW5jbHVkZSAiaWd0
X3N5c2ZzLmgiCisjaW5jbHVkZSAiaW9jdGxfd3JhcHBlcnMuaCIgLyogaWd0X3JlcXVpcmVfZ2Vt
KCkhICovCisjaW5jbHVkZSAic3dfc3luYy5oIgorCisjaW5jbHVkZSAiaWd0X2RlYnVnZnMuaCIK
Kworc3RhdGljIGJvb2wgX19lbmFibGVfaGFuZ2NoZWNrKGludCBkaXIsIGJvb2wgc3RhdGUpCit7
CisJcmV0dXJuIGlndF9zeXNmc19zZXQoZGlyLCAiZW5hYmxlX2hhbmdjaGVjayIsIHN0YXRlID8g
IjEiIDogIjAiKTsKK30KKworc3RhdGljIGJvb2wgZW5hYmxlX2hhbmdjaGVjayhpbnQgaTkxNSwg
Ym9vbCBzdGF0ZSkKK3sKKwlib29sIHN1Y2Nlc3M7CisJaW50IGRpcjsKKworCWRpciA9IGlndF9z
eXNmc19vcGVuX3BhcmFtZXRlcnMoaTkxNSk7CisJaWYgKGRpciA8IDApIC8qIG5vIHBhcmFtZXRl
cnMsIG11c3QgYmUgZGVmYXVsdCEgKi8KKwkJcmV0dXJuIGZhbHNlOworCisJc3VjY2VzcyA9IF9f
ZW5hYmxlX2hhbmdjaGVjayhkaXIsIHN0YXRlKTsKKwljbG9zZShkaXIpOworCisJcmV0dXJuIHN1
Y2Nlc3M7Cit9CisKK3N0YXRpYyB2b2lkIHNldF9wcmVlbXB0X3RpbWVvdXQoaW50IGVuZ2luZSwg
dW5zaWduZWQgaW50IHZhbHVlKQoreworCXVuc2lnbmVkIGludCBkZWxheTsKKworCWlndF9zeXNm
c19wcmludGYoZW5naW5lLCAicHJlZW1wdF90aW1lb3V0X21zIiwgIiV1IiwgdmFsdWUpOworCWln
dF9zeXNmc19zY2FuZihlbmdpbmUsICJwcmVlbXB0X3RpbWVvdXRfbXMiLCAiJXUiLCAmZGVsYXkp
OworCWlndF9hc3NlcnRfZXEoZGVsYXksIHZhbHVlKTsKK30KKworc3RhdGljIHZvaWQgdGVzdF9p
ZGVtcG90ZW50KGludCBpOTE1LCBpbnQgZW5naW5lKQoreworCXVuc2lnbmVkIGludCBkZWxheXNb
XSA9IHsgMCwgMSwgMTAwMCwgMTIzNCwgNjU0MzIxIH07CisJdW5zaWduZWQgaW50IHNhdmVkOwor
CisJLyogUXVpY2sgdGVzdCB0aGF0IHN0b3JlL3Nob3cgcmVwb3J0cyB0aGUgc2FtZSB2YWx1ZXMg
Ki8KKworCWlndF9hc3NlcnQoaWd0X3N5c2ZzX3NjYW5mKGVuZ2luZSwgInByZWVtcHRfdGltZW91
dF9tcyIsICIldSIsICZzYXZlZCkgPT0gMSk7CisJaWd0X2RlYnVnKCJJbml0aWFsIHByZWVtcHRf
dGltZW91dF9tczoldVxuIiwgc2F2ZWQpOworCisJZm9yIChpbnQgaSA9IDA7IGkgPCBBUlJBWV9T
SVpFKGRlbGF5cyk7IGkrKykKKwkJc2V0X3ByZWVtcHRfdGltZW91dChlbmdpbmUsIGRlbGF5c1tp
XSk7CisKKwlzZXRfcHJlZW1wdF90aW1lb3V0KGVuZ2luZSwgc2F2ZWQpOworfQorCitzdGF0aWMg
dm9pZCB0ZXN0X2ludmFsaWQoaW50IGk5MTUsIGludCBlbmdpbmUpCit7CisJdW5zaWduZWQgaW50
IHNhdmVkLCBkZWxheTsKKworCS8qIFF1aWNrIHRlc3QgdGhhdCB2YWx1ZXMgdGhhdCBhcmUgbm90
IHJlcHJlc2VudGFibGUgYXJlIHJlamVjdGVkICovCisKKwlpZ3RfYXNzZXJ0KGlndF9zeXNmc19z
Y2FuZihlbmdpbmUsICJwcmVlbXB0X3RpbWVvdXRfbXMiLCAiJXUiLCAmc2F2ZWQpID09IDEpOwor
CWlndF9kZWJ1ZygiSW5pdGlhbCBwcmVlbXB0X3RpbWVvdXRfbXM6JXVcbiIsIHNhdmVkKTsKKwor
CWlndF9zeXNmc19wcmludGYoZW5naW5lLCAicHJlZW1wdF90aW1lb3V0X21zIiwgUFJJdTY0LCAt
MSk7CisJaWd0X3N5c2ZzX3NjYW5mKGVuZ2luZSwgInByZWVtcHRfdGltZW91dF9tcyIsICIldSIs
ICZkZWxheSk7CisJaWd0X2Fzc2VydF9lcShkZWxheSwgc2F2ZWQpOworCisJaWd0X3N5c2ZzX3By
aW50ZihlbmdpbmUsICJwcmVlbXB0X3RpbWVvdXRfbXMiLCAiJWQiLCAtMSk7CisJaWd0X3N5c2Zz
X3NjYW5mKGVuZ2luZSwgInByZWVtcHRfdGltZW91dF9tcyIsICIldSIsICZkZWxheSk7CisJaWd0
X2Fzc2VydF9lcShkZWxheSwgc2F2ZWQpOworCisJaWd0X3N5c2ZzX3ByaW50ZihlbmdpbmUsICJw
cmVlbXB0X3RpbWVvdXRfbXMiLCBQUkl1NjQsIDQwdWxsIDw8IDMyKTsKKwlpZ3Rfc3lzZnNfc2Nh
bmYoZW5naW5lLCAicHJlZW1wdF90aW1lb3V0X21zIiwgIiV1IiwgJmRlbGF5KTsKKwlpZ3RfYXNz
ZXJ0X2VxKGRlbGF5LCBzYXZlZCk7Cit9CisKK3N0YXRpYyB2b2lkIHNldF91bmJhbm5hYmxlKGlu
dCBpOTE1LCB1aW50MzJfdCBjdHgpCit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9jb250ZXh0X3Bh
cmFtIHAgPSB7CisJCS5jdHhfaWQgPSBjdHgsCisJCS5wYXJhbSA9IEk5MTVfQ09OVEVYVF9QQVJB
TV9CQU5OQUJMRSwKKwl9OworCisJaWd0X2Fzc2VydF9lcShfX2dlbV9jb250ZXh0X3NldF9wYXJh
bShpOTE1LCAmcCksIDApOworfQorCitzdGF0aWMgdWludDMyX3QgY3JlYXRlX2NvbnRleHQoaW50
IGk5MTUsIHVuc2lnbmVkIGludCBjbGFzcywgdW5zaWduZWQgaW50IGluc3QsIGludCBwcmlvKQor
eworCXVpbnQzMl90IGN0eDsKKworCWN0eCA9IGdlbV9jb250ZXh0X2NyZWF0ZV9mb3JfZW5naW5l
KGk5MTUsIGNsYXNzLCBpbnN0KTsKKwlzZXRfdW5iYW5uYWJsZShpOTE1LCBjdHgpOworCWdlbV9j
b250ZXh0X3NldF9wcmlvcml0eShpOTE1LCBjdHgsIHByaW8pOworCisJcmV0dXJuIGN0eDsKK30K
Kworc3RhdGljIHVpbnQ2NF90IF9fdGVzdF90aW1lb3V0KGludCBpOTE1LCBpbnQgZW5naW5lLCB1
bnNpZ25lZCBpbnQgdGltZW91dCkKK3sKKwl1bnNpZ25lZCBpbnQgY2xhc3MsIGluc3Q7CisJc3Ry
dWN0IHRpbWVzcGVjIHRzID0ge307CisJaWd0X3NwaW5fdCAqc3BpblsyXTsKKwl1aW50NjRfdCBl
bGFwc2VkOworCXVpbnQzMl90IGN0eFsyXTsKKworCWlndF9hc3NlcnQoaWd0X3N5c2ZzX3NjYW5m
KGVuZ2luZSwgImNsYXNzIiwgIiV1IiwgJmNsYXNzKSA9PSAxKTsKKwlpZ3RfYXNzZXJ0KGlndF9z
eXNmc19zY2FuZihlbmdpbmUsICJpbnN0YW5jZSIsICIldSIsICZpbnN0KSA9PSAxKTsKKworCXNl
dF9wcmVlbXB0X3RpbWVvdXQoZW5naW5lLCB0aW1lb3V0KTsKKworCWN0eFswXSA9IGNyZWF0ZV9j
b250ZXh0KGk5MTUsIGNsYXNzLCBpbnN0LCAtMTAyMyk7CisJc3BpblswXSA9IGlndF9zcGluX25l
dyhpOTE1LCBjdHhbMF0sCisJCQkgICAgICAgLmZsYWdzID0gKElHVF9TUElOX05PX1BSRUVNUFRJ
T04gfAorCQkJCQkgSUdUX1NQSU5fUE9MTF9SVU4gfAorCQkJCQkgSUdUX1NQSU5fRkVOQ0VfT1VU
KSk7CisJaWd0X3NwaW5fYnVzeXdhaXRfdW50aWxfc3RhcnRlZChzcGluWzBdKTsKKworCWN0eFsx
XSA9IGNyZWF0ZV9jb250ZXh0KGk5MTUsIGNsYXNzLCBpbnN0LCAxMDIzKTsKKwlpZ3RfbnNlY19l
bGFwc2VkKCZ0cyk7CisJc3BpblsxXSA9IGlndF9zcGluX25ldyhpOTE1LCBjdHhbMV0sIC5mbGFn
cyA9IElHVF9TUElOX1BPTExfUlVOKTsKKwlpZ3Rfc3Bpbl9idXN5d2FpdF91bnRpbF9zdGFydGVk
KHNwaW5bMV0pOworCWVsYXBzZWQgPSBpZ3RfbnNlY19lbGFwc2VkKCZ0cyk7CisKKwlpZ3Rfc3Bp
bl9mcmVlKGk5MTUsIHNwaW5bMV0pOworCisJaWd0X2Fzc2VydF9lcShzeW5jX2ZlbmNlX3dhaXQo
c3BpblswXS0+b3V0X2ZlbmNlLCAxKSwgMCk7CisJaWd0X2Fzc2VydF9lcShzeW5jX2ZlbmNlX3N0
YXR1cyhzcGluWzBdLT5vdXRfZmVuY2UpLCAtRUlPKTsKKworCWlndF9zcGluX2ZyZWUoaTkxNSwg
c3BpblswXSk7CisKKwlnZW1fY29udGV4dF9kZXN0cm95KGk5MTUsIGN0eFsxXSk7CisJZ2VtX2Nv
bnRleHRfZGVzdHJveShpOTE1LCBjdHhbMF0pOworCWdlbV9xdWllc2NlbnRfZ3B1KGk5MTUpOwor
CisJcmV0dXJuIGVsYXBzZWQ7Cit9CisKK3N0YXRpYyB2b2lkIHRlc3RfdGltZW91dChpbnQgaTkx
NSwgaW50IGVuZ2luZSkKK3sKKwlpbnQgZGVsYXlzW10gPSB7IDEsIDUwLCAxMDAsIDUwMCB9Owor
CXVuc2lnbmVkIGludCBzYXZlZDsKKworCS8qCisJICogU2VuZCBkb3duIHNvbWUgbm9uLXByZWVt
cHRhYmxlIHdvcmtsb2FkcyBhbmQgdGhlbiByZXF1ZXN0IGEKKwkgKiBzd2l0Y2ggdG8gYSBoaWdo
ZXIgcHJpb3JpdHkgY29udGV4dC4gVGhlIEhXIHdpbGwgbm90IGJlIGFibGUgdG8KKwkgKiByZXNw
b25kLCBzbyB0aGUga2VybmVsIHdpbGwgYmUgZm9yY2VkIHRvIHJlc2V0IHRoZSBob2cuIFRoaXMK
KwkgKiB0aW1lb3V0IHNob3VsZCBtYXRjaCBvdXIgc3BlY2lmaWNhdGlvbiwgYW5kIHNvIHdlIGNh
biBtZWFzdXJlCisJICogdGhlIGRlbGF5IGZyb20gcmVxdWVzdGluZyB0aGUgcHJlZW1wdGlvbiB0
byBpdHMgY29tcGxldGlvbi4KKwkgKi8KKworCWlndF9hc3NlcnQoaWd0X3N5c2ZzX3NjYW5mKGVu
Z2luZSwgInByZWVtcHRfdGltZW91dF9tcyIsICIldSIsICZzYXZlZCkgPT0gMSk7CisJaWd0X2Rl
YnVnKCJJbml0aWFsIHByZWVtcHRfdGltZW91dF9tczoldVxuIiwgc2F2ZWQpOworCisJZ2VtX3F1
aWVzY2VudF9ncHUoaTkxNSk7CisJaWd0X3JlcXVpcmUoZW5hYmxlX2hhbmdjaGVjayhpOTE1LCBm
YWxzZSkpOworCisJZm9yIChpbnQgaSA9IDA7IGkgPCBBUlJBWV9TSVpFKGRlbGF5cyk7IGkrKykg
eworCQl1aW50NjRfdCBlbGFwc2VkOworCisJCWVsYXBzZWQgPSBfX3Rlc3RfdGltZW91dChpOTE1
LCBlbmdpbmUsIGRlbGF5c1tpXSk7CisJCWlndF9pbmZvKCJwcmVlbXB0X3RpbWVvdXRfbXM6JWQs
IGVsYXBzZWQ9JS4zZm1zXG4iLAorCQkJIGRlbGF5c1tpXSwgZWxhcHNlZCAqIDFlLTYpOworCisJ
CS8qCisJCSAqIFdlIG5lZWQgdG8gZ2l2ZSBhIGNvdXBsZSBvZiBqaWZmaWVzIHNsYWNrIGZvciB0
aGUgc2NoZWR1bGVyIHRpbWVvdXRzCisJCSAqIGFuZCB0aGVuIGEgbGl0dGxlIG1vcmUgc2xhY2sg
ZnIgdGhlIG92ZXJoZWFkIGluIHN1Ym1pdHRpbmcgYW5kCisJCSAqIG1lYXN1cmluZy4gNTBtcyBz
aG91bGQgY292ZXIgYWxsIG9mIG91ciBzaW5zIGFuZCBiZSB1c2VmdWwKKwkJICogdG9sZXJhbmNl
LgorCQkgKi8KKwkJaWd0X2Fzc2VydF9mKGVsYXBzZWQgLyAxMDAwIC8gMTAwMCA8IGRlbGF5c1tp
XSArIDUwLAorCQkJICAgICAiRm9yY2VkIHByZWVtcHRpb24gdGltZW91dCBleGNlZWRlZCByZXF1
ZXN0IVxuIik7CisJfQorCisJaWd0X2Fzc2VydChlbmFibGVfaGFuZ2NoZWNrKGk5MTUsIHRydWUp
KTsKKwlnZW1fcXVpZXNjZW50X2dwdShpOTE1KTsKKwlzZXRfcHJlZW1wdF90aW1lb3V0KGVuZ2lu
ZSwgc2F2ZWQpOworfQorCitzdGF0aWMgdm9pZCB0ZXN0X29mZihpbnQgaTkxNSwgaW50IGVuZ2lu
ZSkKK3sKKwl1bnNpZ25lZCBpbnQgY2xhc3MsIGluc3Q7CisJaWd0X3NwaW5fdCAqc3BpblsyXTsK
Kwl1bnNpZ25lZCBpbnQgc2F2ZWQ7CisJdWludDMyX3QgY3R4WzJdOworCisJLyoKKwkgKiBXZSBz
dXBwb3J0IHNldHRpbmcgdGhlIHRpbWVvdXQgdG8gMCB0byBkaXNhYmxlIHRoZSByZXNldCBvbgor
CSAqIHByZWVtcHRpb24gZmFpbHVyZS4gSGF2aW5nIGVzdGFibGlzaGVkIHRoYXQgd2UgY2FuIGRv
IGZvcmNlZAorCSAqIHByZWVtcHRpb24gb24gZGVtYW5kLCB3ZSB1c2UgdGhlIHNhbWUgc2V0dXAg
KG5vbi1wcmVlZW1wdGFibGUgaG9nCisJICogZm9sbG93ZWQgYnkgYSBoaWdoIHByaW9yaXR5IGNv
bnRleHQpIGFuZCB2ZXJpZnkgdGhhdCB0aGUgaG9nIGlzCisJICogbmV2ZXIgcmVzZXQuIE5ldmVy
IGlzIGEgbG9uZyB0aW1lLCBzbyB3ZSBzZXR0bGUgZm9yIDE1MHMuCisJICovCisKKwlpZ3RfYXNz
ZXJ0KGlndF9zeXNmc19zY2FuZihlbmdpbmUsICJwcmVlbXB0X3RpbWVvdXRfbXMiLCAiJXUiLCAm
c2F2ZWQpID09IDEpOworCWlndF9kZWJ1ZygiSW5pdGlhbCBwcmVlbXB0X3RpbWVvdXRfbXM6JXVc
biIsIHNhdmVkKTsKKworCWdlbV9xdWllc2NlbnRfZ3B1KGk5MTUpOworCWlndF9yZXF1aXJlKGVu
YWJsZV9oYW5nY2hlY2soaTkxNSwgZmFsc2UpKTsKKworCWlndF9hc3NlcnQoaWd0X3N5c2ZzX3Nj
YW5mKGVuZ2luZSwgImNsYXNzIiwgIiV1IiwgJmNsYXNzKSA9PSAxKTsKKwlpZ3RfYXNzZXJ0KGln
dF9zeXNmc19zY2FuZihlbmdpbmUsICJpbnN0YW5jZSIsICIldSIsICZpbnN0KSA9PSAxKTsKKwor
CXNldF9wcmVlbXB0X3RpbWVvdXQoZW5naW5lLCAwKTsKKworCWN0eFswXSA9IGNyZWF0ZV9jb250
ZXh0KGk5MTUsIGNsYXNzLCBpbnN0LCAtMTAyMyk7CisJc3BpblswXSA9IGlndF9zcGluX25ldyhp
OTE1LCBjdHhbMF0sCisJCQkgICAgICAgLmZsYWdzID0gKElHVF9TUElOX05PX1BSRUVNUFRJT04g
fAorCQkJCQkgSUdUX1NQSU5fUE9MTF9SVU4gfAorCQkJCQkgSUdUX1NQSU5fRkVOQ0VfT1VUKSk7
CisJaWd0X3NwaW5fYnVzeXdhaXRfdW50aWxfc3RhcnRlZChzcGluWzBdKTsKKworCWN0eFsxXSA9
IGNyZWF0ZV9jb250ZXh0KGk5MTUsIGNsYXNzLCBpbnN0LCAxMDIzKTsKKwlzcGluWzFdID0gaWd0
X3NwaW5fbmV3KGk5MTUsIGN0eFsxXSwgLmZsYWdzID0gSUdUX1NQSU5fUE9MTF9SVU4pOworCisJ
Zm9yIChpbnQgaSA9IDA7IGkgPCAxNTA7IGkrKykgeworCQlpZ3RfYXNzZXJ0X2VxKHN5bmNfZmVu
Y2Vfc3RhdHVzKHNwaW5bMF0tPm91dF9mZW5jZSksIDApOworCQlzbGVlcCgxKTsKKwl9CisKKwlz
ZXRfcHJlZW1wdF90aW1lb3V0KGVuZ2luZSwgMSk7CisKKwlpZ3Rfc3Bpbl9idXN5d2FpdF91bnRp
bF9zdGFydGVkKHNwaW5bMV0pOworCWlndF9zcGluX2ZyZWUoaTkxNSwgc3BpblsxXSk7CisKKwlp
Z3RfYXNzZXJ0X2VxKHN5bmNfZmVuY2Vfd2FpdChzcGluWzBdLT5vdXRfZmVuY2UsIDEpLCAwKTsK
KwlpZ3RfYXNzZXJ0X2VxKHN5bmNfZmVuY2Vfc3RhdHVzKHNwaW5bMF0tPm91dF9mZW5jZSksIC1F
SU8pOworCisJaWd0X3NwaW5fZnJlZShpOTE1LCBzcGluWzBdKTsKKworCWdlbV9jb250ZXh0X2Rl
c3Ryb3koaTkxNSwgY3R4WzFdKTsKKwlnZW1fY29udGV4dF9kZXN0cm95KGk5MTUsIGN0eFswXSk7
CisKKwlpZ3RfYXNzZXJ0KGVuYWJsZV9oYW5nY2hlY2soaTkxNSwgdHJ1ZSkpOworCWdlbV9xdWll
c2NlbnRfZ3B1KGk5MTUpOworCisJc2V0X3ByZWVtcHRfdGltZW91dChlbmdpbmUsIHNhdmVkKTsK
K30KKworI2lmIDAKK3N0YXRpYyB2b2lkIGVhY2hfZW5naW5lcyhpbnQgZmQpCit7CisJc3RydWN0
IGRpcmVudCAqZGU7CisJRElSICpkaXI7CisKKwlkaXIgPSBmZG9wZW5kaXIoZmQpOworCXdoaWxl
IChkaXIgJiYgKGRlID0gcmVhZGRpcihkaXIpKSkgeworCQlpbnQgZW5naW5lID0gb3BlbmF0KGVu
Z2luZXMsIGRlLT5kX25hbWUsIE9fUkRPTkxZKTsKKwkJY2hhciAqbmFtZTsKKworCQluYW1lID0g
aWd0X3N5c2ZzX2dldChlbmdpbmUsICJuYW1lIik7CisJCWlmICghbmFtZSkKKwkJCWNvbnRpbnVl
OworCisJCWlndF9zdWJ0ZXN0X2dyb3VwIHsKKwkJCWlndF9maXh0dXJlIHsKKwkJCQlpZ3RfcmVx
dWlyZShmc3RhdGF0KGVuZ2luZSwKKwkJCQkJCQkicHJlZW1wdF90aW1lb3V0X21zIiwKKwkJCQkJ
CQkmc3QsIDApID09IDApOworCQkJfQorCQl9CisJfQorCWNsb3NlZGlyKGRpcik7Cit9CisjZW5k
aWYKKworaWd0X21haW4KK3sKKwljb25zdCBzdHJ1Y3QgaW50ZWxfZXhlY3V0aW9uX2VuZ2luZTIg
Kml0OworCWludCBpOTE1ID0gLTEsIGVuZ2luZXMgPSAtMTsKKworCWlndF9maXh0dXJlIHsKKwkJ
aW50IHN5czsKKworCQlpOTE1ID0gZHJtX29wZW5fZHJpdmVyKERSSVZFUl9JTlRFTCk7CisJCWln
dF9yZXF1aXJlX2dlbShpOTE1KTsKKworCQlzeXMgPSBpZ3Rfc3lzZnNfb3BlbihpOTE1KTsKKwkJ
aWd0X3JlcXVpcmUoc3lzICE9IC0xKTsKKworCQllbmdpbmVzID0gb3BlbmF0KHN5cywgImVuZ2lu
ZSIsIE9fUkRPTkxZKTsKKwkJaWd0X3JlcXVpcmUoZW5naW5lcyAhPSAtMSk7CisKKwkJY2xvc2Uo
c3lzKTsKKwl9CisKKwlfX2Zvcl9lYWNoX3N0YXRpY19lbmdpbmUoaXQpIHsKKwkJaWd0X3N1YnRl
c3RfZ3JvdXAgeworCQkJaW50IGVuZ2luZSA9IC0xOworCQkJY2hhciAqbmFtZSA9IE5VTEw7CisK
KwkJCWlndF9maXh0dXJlIHsKKwkJCQlzdHJ1Y3Qgc3RhdCBzdDsKKworCQkJCWVuZ2luZSA9IG9w
ZW5hdChlbmdpbmVzLCBpdC0+bmFtZSwgT19SRE9OTFkpOworCQkJCWlndF9yZXF1aXJlKGZzdGF0
YXQoZW5naW5lLAorCQkJCQkJICAgICJwcmVlbXB0X3RpbWVvdXRfbXMiLAorCQkJCQkJICAgICZz
dCwgMCkgPT0gMCk7CisKKwkJCQluYW1lID0gaWd0X3N5c2ZzX2dldChlbmdpbmUsICJuYW1lIik7
CisJCQl9CisJCQlpZiAoIW5hbWUpCisJCQkJY29udGludWU7CisKKwkJCWlndF9zdWJ0ZXN0X2Yo
IiVzLWlkZW1wb3RlbnQiLCBuYW1lKQorCQkJCXRlc3RfaWRlbXBvdGVudChpOTE1LCBlbmdpbmUp
OworCQkJaWd0X3N1YnRlc3RfZigiJXMtaW52YWxpZCIsIG5hbWUpCisJCQkJdGVzdF9pbnZhbGlk
KGk5MTUsIGVuZ2luZSk7CisJCQlpZ3Rfc3VidGVzdF9mKCIlcy10aW1lb3V0IiwgbmFtZSkKKwkJ
CQl0ZXN0X3RpbWVvdXQoaTkxNSwgZW5naW5lKTsKKwkJCWlndF9zdWJ0ZXN0X2YoIiVzLW9mZiIs
IG5hbWUpCisJCQkJdGVzdF9vZmYoaTkxNSwgZW5naW5lKTsKKworCQkJZnJlZShuYW1lKTsKKwkJ
CWNsb3NlKGVuZ2luZSk7CisJCX0KKwl9CisKKwlpZ3RfZml4dHVyZSB7CisJCWNsb3NlKGVuZ2lu
ZXMpOworCQljbG9zZShpOTE1KTsKKwl9Cit9CmRpZmYgLS1naXQgYS90ZXN0cy9tZXNvbi5idWls
ZCBiL3Rlc3RzL21lc29uLmJ1aWxkCmluZGV4IDNmM2VlZTI3Ny4uNTA3NDM0OTQyIDEwMDY0NAot
LS0gYS90ZXN0cy9tZXNvbi5idWlsZAorKysgYi90ZXN0cy9tZXNvbi5idWlsZApAQCAtMjM4LDYg
KzIzOCw3IEBAIGk5MTVfcHJvZ3MgPSBbCiAJJ2k5MTVfcXVlcnknLAogCSdpOTE1X3NlbGZ0ZXN0
JywKIAknaTkxNV9zdXNwZW5kJywKKwknc3lzZnNfcHJlZW1wdF90aW1lb3V0JywKIF0KIAogdGVz
dF9kZXBzID0gWyBpZ3RfZGVwcyBdCi0tIAoyLjI0LjAucmMwCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVs
LWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcv
bWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

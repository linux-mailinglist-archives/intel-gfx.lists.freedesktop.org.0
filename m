Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id CF5E34DCFB
	for <lists+intel-gfx@lfdr.de>; Thu, 20 Jun 2019 23:46:31 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 452096E7F7;
	Thu, 20 Jun 2019 21:46:26 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C94056E7EA
 for <intel-gfx@lists.freedesktop.org>; Thu, 20 Jun 2019 21:46:16 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 20 Jun 2019 23:46:07 +0200
Message-Id: <20190620214613.14481-4-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190620214613.14481-1-maarten.lankhorst@linux.intel.com>
References: <20190620214613.14481-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 3/9] drm/i915: Convert hw state verifier to take
 more intel state
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U2lnbmVkLW9mZi1ieTogTWFhcnRlbiBMYW5raG9yc3QgPG1hYXJ0ZW4ubGFua2hvcnN0QGxpbnV4
LmludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3Bs
YXkuYyB8IDE1NCArKysrKysrKystLS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgNzQgaW5zZXJ0
aW9ucygrKSwgODAgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXkuYwppbmRleCA4NTVmOTBhODEzOTYuLmE1MThkNzRmODk4ZiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTY5NzcsNyAr
Njk3Nyw3IEBAIHZvaWQgaW50ZWxfZW5jb2Rlcl9kZXN0cm95KHN0cnVjdCBkcm1fZW5jb2RlciAq
ZW5jb2RlcikKIAogLyogQ3Jvc3MgY2hlY2sgdGhlIGFjdHVhbCBodyBzdGF0ZSB3aXRoIG91ciBv
d24gbW9kZXNldCBzdGF0ZSB0cmFja2luZyAoYW5kIGl0J3MKICAqIGludGVybmFsIGNvbnNpc3Rl
bmN5KS4gKi8KLXN0YXRpYyB2b2lkIGludGVsX2Nvbm5lY3Rvcl92ZXJpZnlfc3RhdGUoc3RydWN0
IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAorc3RhdGljIHZvaWQgaW50ZWxfY29ubmVjdG9y
X3ZlcmlmeV9zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkJ
IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlKQogewogCXN0cnVjdCBpbnRl
bF9jb25uZWN0b3IgKmNvbm5lY3RvciA9IHRvX2ludGVsX2Nvbm5lY3Rvcihjb25uX3N0YXRlLT5j
b25uZWN0b3IpOwpAQCAtNjk5NSw3ICs2OTk1LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfY29ubmVj
dG9yX3ZlcmlmeV9zdGF0ZShzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCWlm
ICghY3J0Y19zdGF0ZSkKIAkJCXJldHVybjsKIAotCQlJOTE1X1NUQVRFX1dBUk4oIWNydGNfc3Rh
dGUtPmFjdGl2ZSwKKwkJSTkxNV9TVEFURV9XQVJOKCFjcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSwK
IAkJICAgICAgImNvbm5lY3RvciBpcyBhY3RpdmUsIGJ1dCBhdHRhY2hlZCBjcnRjIGlzbid0XG4i
KTsKIAogCQlpZiAoIWVuY29kZXIgfHwgZW5jb2Rlci0+dHlwZSA9PSBJTlRFTF9PVVRQVVRfRFBf
TVNUKQpAQCAtNzAwNyw3ICs3MDA3LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfY29ubmVjdG9yX3Zl
cmlmeV9zdGF0ZShzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCUk5MTVfU1RB
VEVfV0FSTihjb25uX3N0YXRlLT5jcnRjICE9IGVuY29kZXItPmJhc2UuY3J0YywKIAkJCSJhdHRh
Y2hlZCBlbmNvZGVyIGNydGMgZGlmZmVycyBmcm9tIGNvbm5lY3RvciBjcnRjXG4iKTsKIAl9IGVs
c2UgewotCQlJOTE1X1NUQVRFX1dBUk4oY3J0Y19zdGF0ZSAmJiBjcnRjX3N0YXRlLT5hY3RpdmUs
CisJCUk5MTVfU1RBVEVfV0FSTihjcnRjX3N0YXRlICYmIGNydGNfc3RhdGUtPmJhc2UuYWN0aXZl
LAogCQkJImF0dGFjaGVkIGNydGMgaXMgYWN0aXZlLCBidXQgY29ubmVjdG9yIGlzbid0XG4iKTsK
IAkJSTkxNV9TVEFURV9XQVJOKCFjcnRjX3N0YXRlICYmIGNvbm5fc3RhdGUtPmJlc3RfZW5jb2Rl
ciwKIAkJCSJiZXN0IGVuY29kZXIgc2V0IHdpdGhvdXQgY3J0YyFcbiIpOwpAQCAtMTI2OTUsMTAg
KzEyNjk1LDEwIEBAIHN0YXRpYyB2b2lkIGludGVsX3BpcGVfY29uZmlnX3Nhbml0eV9jaGVjayhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJfQogfQogCi1zdGF0aWMgdm9pZCB2
ZXJpZnlfd21fc3RhdGUoc3RydWN0IGRybV9jcnRjICpjcnRjLAotCQkJICAgIHN0cnVjdCBkcm1f
Y3J0Y19zdGF0ZSAqbmV3X3N0YXRlKQorc3RhdGljIHZvaWQgdmVyaWZ5X3dtX3N0YXRlKHN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjLAorCQkJICAgIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdf
c3RhdGUpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShj
cnRjLT5kZXYpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
Y3J0Yy0+YmFzZS5kZXYpOwogCXN0cnVjdCBza2xfaHdfc3RhdGUgewogCQlzdHJ1Y3Qgc2tsX2Rk
Yl9lbnRyeSBkZGJfeVtJOTE1X01BWF9QTEFORVNdOwogCQlzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSBk
ZGJfdXZbSTkxNV9NQVhfUExBTkVTXTsKQEAgLTEyNzA4LDIxICsxMjcwOCwyMCBAQCBzdGF0aWMg
dm9pZCB2ZXJpZnlfd21fc3RhdGUoc3RydWN0IGRybV9jcnRjICpjcnRjLAogCXN0cnVjdCBza2xf
ZGRiX2FsbG9jYXRpb24gKnN3X2RkYjsKIAlzdHJ1Y3Qgc2tsX3BpcGVfd20gKnN3X3dtOwogCXN0
cnVjdCBza2xfZGRiX2VudHJ5ICpod19kZGJfZW50cnksICpzd19kZGJfZW50cnk7Ci0Jc3RydWN0
IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9jcnRjKGNydGMpOwotCWNvbnN0IGVu
dW0gcGlwZSBwaXBlID0gaW50ZWxfY3J0Yy0+cGlwZTsKKwljb25zdCBlbnVtIHBpcGUgcGlwZSA9
IGNydGMtPnBpcGU7CiAJaW50IHBsYW5lLCBsZXZlbCwgbWF4X2xldmVsID0gaWxrX3dtX21heF9s
ZXZlbChkZXZfcHJpdik7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDkgfHwgIW5ld19z
dGF0ZS0+YWN0aXZlKQorCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgOSB8fCAhbmV3X3N0YXRl
LT5iYXNlLmFjdGl2ZSkKIAkJcmV0dXJuOwogCiAJaHcgPSBremFsbG9jKHNpemVvZigqaHcpLCBH
RlBfS0VSTkVMKTsKIAlpZiAoIWh3KQogCQlyZXR1cm47CiAKLQlza2xfcGlwZV93bV9nZXRfaHdf
c3RhdGUoaW50ZWxfY3J0YywgJmh3LT53bSk7Ci0Jc3dfd20gPSAmdG9faW50ZWxfY3J0Y19zdGF0
ZShuZXdfc3RhdGUpLT53bS5za2wub3B0aW1hbDsKKwlza2xfcGlwZV93bV9nZXRfaHdfc3RhdGUo
Y3J0YywgJmh3LT53bSk7CisJc3dfd20gPSAmbmV3X3N0YXRlLT53bS5za2wub3B0aW1hbDsKIAot
CXNrbF9waXBlX2RkYl9nZXRfaHdfc3RhdGUoaW50ZWxfY3J0YywgaHctPmRkYl95LCBody0+ZGRi
X3V2KTsKKwlza2xfcGlwZV9kZGJfZ2V0X2h3X3N0YXRlKGNydGMsIGh3LT5kZGJfeSwgaHctPmRk
Yl91dik7CiAKIAlza2xfZGRiX2dldF9od19zdGF0ZShkZXZfcHJpdiwgJmh3LT5kZGIpOwogCXN3
X2RkYiA9ICZkZXZfcHJpdi0+d20uc2tsX2h3LmRkYjsKQEAgLTEyNzcwLDcgKzEyNzY5LDcgQEAg
c3RhdGljIHZvaWQgdmVyaWZ5X3dtX3N0YXRlKHN0cnVjdCBkcm1fY3J0YyAqY3J0YywKIAogCQkv
KiBEREIgKi8KIAkJaHdfZGRiX2VudHJ5ID0gJmh3LT5kZGJfeVtwbGFuZV07Ci0JCXN3X2RkYl9l
bnRyeSA9ICZ0b19pbnRlbF9jcnRjX3N0YXRlKG5ld19zdGF0ZSktPndtLnNrbC5wbGFuZV9kZGJf
eVtwbGFuZV07CisJCXN3X2RkYl9lbnRyeSA9ICZuZXdfc3RhdGUtPndtLnNrbC5wbGFuZV9kZGJf
eVtwbGFuZV07CiAKIAkJaWYgKCFza2xfZGRiX2VudHJ5X2VxdWFsKGh3X2RkYl9lbnRyeSwgc3df
ZGRiX2VudHJ5KSkgewogCQkJRFJNX0VSUk9SKCJtaXNtYXRjaCBpbiBEREIgc3RhdGUgcGlwZSAl
YyBwbGFuZSAlZCAoZXhwZWN0ZWQgKCV1LCV1KSwgZm91bmQgKCV1LCV1KSlcbiIsCkBAIC0xMjgy
Miw3ICsxMjgyMSw3IEBAIHN0YXRpYyB2b2lkIHZlcmlmeV93bV9zdGF0ZShzdHJ1Y3QgZHJtX2Ny
dGMgKmNydGMsCiAKIAkJLyogRERCICovCiAJCWh3X2RkYl9lbnRyeSA9ICZody0+ZGRiX3lbUExB
TkVfQ1VSU09SXTsKLQkJc3dfZGRiX2VudHJ5ID0gJnRvX2ludGVsX2NydGNfc3RhdGUobmV3X3N0
YXRlKS0+d20uc2tsLnBsYW5lX2RkYl95W1BMQU5FX0NVUlNPUl07CisJCXN3X2RkYl9lbnRyeSA9
ICZuZXdfc3RhdGUtPndtLnNrbC5wbGFuZV9kZGJfeVtQTEFORV9DVVJTT1JdOwogCiAJCWlmICgh
c2tsX2RkYl9lbnRyeV9lcXVhbChod19kZGJfZW50cnksIHN3X2RkYl9lbnRyeSkpIHsKIAkJCURS
TV9FUlJPUigibWlzbWF0Y2ggaW4gRERCIHN0YXRlIHBpcGUgJWMgY3Vyc29yIChleHBlY3RlZCAo
JXUsJXUpLCBmb3VuZCAoJXUsJXUpKVxuIiwKQEAgLTEyODM2LDIzICsxMjgzNSwyMiBAQCBzdGF0
aWMgdm9pZCB2ZXJpZnlfd21fc3RhdGUoc3RydWN0IGRybV9jcnRjICpjcnRjLAogfQogCiBzdGF0
aWMgdm9pZAotdmVyaWZ5X2Nvbm5lY3Rvcl9zdGF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAot
CQkgICAgICAgc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlLAotCQkgICAgICAgc3RydWN0
IGRybV9jcnRjICpjcnRjKQordmVyaWZ5X2Nvbm5lY3Rvcl9zdGF0ZShzdHJ1Y3QgaW50ZWxfYXRv
bWljX3N0YXRlICpzdGF0ZSwKKwkJICAgICAgIHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQogewog
CXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3I7CiAJc3RydWN0IGRybV9jb25uZWN0b3Jf
c3RhdGUgKm5ld19jb25uX3N0YXRlOwogCWludCBpOwogCi0JZm9yX2VhY2hfbmV3X2Nvbm5lY3Rv
cl9pbl9zdGF0ZShzdGF0ZSwgY29ubmVjdG9yLCBuZXdfY29ubl9zdGF0ZSwgaSkgeworCWZvcl9l
YWNoX25ld19jb25uZWN0b3JfaW5fc3RhdGUoJnN0YXRlLT5iYXNlLCBjb25uZWN0b3IsIG5ld19j
b25uX3N0YXRlLCBpKSB7CiAJCXN0cnVjdCBkcm1fZW5jb2RlciAqZW5jb2RlciA9IGNvbm5lY3Rv
ci0+ZW5jb2RlcjsKLQkJc3RydWN0IGRybV9jcnRjX3N0YXRlICpjcnRjX3N0YXRlID0gTlVMTDsK
KwkJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUgPSBOVUxMOwogCi0JCWlmIChu
ZXdfY29ubl9zdGF0ZS0+Y3J0YyAhPSBjcnRjKQorCQlpZiAobmV3X2Nvbm5fc3RhdGUtPmNydGMg
IT0gJmNydGMtPmJhc2UpCiAJCQljb250aW51ZTsKIAogCQlpZiAoY3J0YykKLQkJCWNydGNfc3Rh
dGUgPSBkcm1fYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0ZSwgbmV3X2Nvbm5fc3RhdGUt
PmNydGMpOworCQkJY3J0Y19zdGF0ZSA9IGludGVsX2F0b21pY19nZXRfbmV3X2NydGNfc3RhdGUo
c3RhdGUsIGNydGMpOwogCiAJCWludGVsX2Nvbm5lY3Rvcl92ZXJpZnlfc3RhdGUoY3J0Y19zdGF0
ZSwgbmV3X2Nvbm5fc3RhdGUpOwogCkBAIC0xMjg2MiwxNCArMTI4NjAsMTQgQEAgdmVyaWZ5X2Nv
bm5lY3Rvcl9zdGF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LAogfQogCiBzdGF0aWMgdm9pZAot
dmVyaWZ5X2VuY29kZXJfc3RhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgc3RydWN0IGRybV9h
dG9taWNfc3RhdGUgKnN0YXRlKQordmVyaWZ5X2VuY29kZXJfc3RhdGUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2LCBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIHsK
IAlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKIAlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAq
Y29ubmVjdG9yOwogCXN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpvbGRfY29ubl9zdGF0ZSwg
Km5ld19jb25uX3N0YXRlOwogCWludCBpOwogCi0JZm9yX2VhY2hfaW50ZWxfZW5jb2RlcihkZXYs
IGVuY29kZXIpIHsKKwlmb3JfZWFjaF9pbnRlbF9lbmNvZGVyKCZkZXZfcHJpdi0+ZHJtLCBlbmNv
ZGVyKSB7CiAJCWJvb2wgZW5hYmxlZCA9IGZhbHNlLCBmb3VuZCA9IGZhbHNlOwogCQllbnVtIHBp
cGUgcGlwZTsKIApAQCAtMTI4NzcsNyArMTI4NzUsNyBAQCB2ZXJpZnlfZW5jb2Rlcl9zdGF0ZShz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJ
CQkgICAgICBlbmNvZGVyLT5iYXNlLmJhc2UuaWQsCiAJCQkgICAgICBlbmNvZGVyLT5iYXNlLm5h
bWUpOwogCi0JCWZvcl9lYWNoX29sZG5ld19jb25uZWN0b3JfaW5fc3RhdGUoc3RhdGUsIGNvbm5l
Y3Rvciwgb2xkX2Nvbm5fc3RhdGUsCisJCWZvcl9lYWNoX29sZG5ld19jb25uZWN0b3JfaW5fc3Rh
dGUoJnN0YXRlLT5iYXNlLCBjb25uZWN0b3IsIG9sZF9jb25uX3N0YXRlLAogCQkJCQkJICAgbmV3
X2Nvbm5fc3RhdGUsIGkpIHsKIAkJCWlmIChvbGRfY29ubl9zdGF0ZS0+YmVzdF9lbmNvZGVyID09
ICZlbmNvZGVyLT5iYXNlKQogCQkJCWZvdW5kID0gdHJ1ZTsKQEAgLTEyOTExLDUwICsxMjkwOSw0
OSBAQCB2ZXJpZnlfZW5jb2Rlcl9zdGF0ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCBzdHJ1Y3Qg
ZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB9CiAKIHN0YXRpYyB2b2lkCi12ZXJpZnlfY3J0Y19z
dGF0ZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCi0JCSAgc3RydWN0IGRybV9jcnRjX3N0YXRlICpv
bGRfY3J0Y19zdGF0ZSwKLQkJICBzdHJ1Y3QgZHJtX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRl
KQordmVyaWZ5X2NydGNfc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCisJCSAgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlLAorCQkgIHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpuZXdfY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gY3J0
Yy0+ZGV2OworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5iYXNlLmRldjsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CiAJc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXI7Ci0Jc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0
b19pbnRlbF9jcnRjKGNydGMpOwotCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZp
ZywgKnN3X2NvbmZpZzsKKwlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWc7CiAJ
c3RydWN0IGRybV9hdG9taWNfc3RhdGUgKm9sZF9zdGF0ZTsKIAlib29sIGFjdGl2ZTsKIAotCW9s
ZF9zdGF0ZSA9IG9sZF9jcnRjX3N0YXRlLT5zdGF0ZTsKLQlfX2RybV9hdG9taWNfaGVscGVyX2Ny
dGNfZGVzdHJveV9zdGF0ZShvbGRfY3J0Y19zdGF0ZSk7Ci0JcGlwZV9jb25maWcgPSB0b19pbnRl
bF9jcnRjX3N0YXRlKG9sZF9jcnRjX3N0YXRlKTsKKwlvbGRfc3RhdGUgPSBvbGRfY3J0Y19zdGF0
ZS0+YmFzZS5zdGF0ZTsKKwlfX2RybV9hdG9taWNfaGVscGVyX2NydGNfZGVzdHJveV9zdGF0ZSgm
b2xkX2NydGNfc3RhdGUtPmJhc2UpOworCXBpcGVfY29uZmlnID0gb2xkX2NydGNfc3RhdGU7CiAJ
bWVtc2V0KHBpcGVfY29uZmlnLCAwLCBzaXplb2YoKnBpcGVfY29uZmlnKSk7Ci0JcGlwZV9jb25m
aWctPmJhc2UuY3J0YyA9IGNydGM7CisJcGlwZV9jb25maWctPmJhc2UuY3J0YyA9ICZjcnRjLT5i
YXNlOwogCXBpcGVfY29uZmlnLT5iYXNlLnN0YXRlID0gb2xkX3N0YXRlOwogCi0JRFJNX0RFQlVH
X0tNUygiW0NSVEM6JWQ6JXNdXG4iLCBjcnRjLT5iYXNlLmlkLCBjcnRjLT5uYW1lKTsKKwlEUk1f
REVCVUdfS01TKCJbQ1JUQzolZDolc11cbiIsIGNydGMtPmJhc2UuYmFzZS5pZCwgY3J0Yy0+YmFz
ZS5uYW1lKTsKIAotCWFjdGl2ZSA9IGRldl9wcml2LT5kaXNwbGF5LmdldF9waXBlX2NvbmZpZyhp
bnRlbF9jcnRjLCBwaXBlX2NvbmZpZyk7CisJYWN0aXZlID0gZGV2X3ByaXYtPmRpc3BsYXkuZ2V0
X3BpcGVfY29uZmlnKGNydGMsIHBpcGVfY29uZmlnKTsKIAogCS8qIHdlIGtlZXAgYm90aCBwaXBl
cyBlbmFibGVkIG9uIDgzMCAqLwogCWlmIChJU19JODMwKGRldl9wcml2KSkKLQkJYWN0aXZlID0g
bmV3X2NydGNfc3RhdGUtPmFjdGl2ZTsKKwkJYWN0aXZlID0gbmV3X2NydGNfc3RhdGUtPmJhc2Uu
YWN0aXZlOwogCi0JSTkxNV9TVEFURV9XQVJOKG5ld19jcnRjX3N0YXRlLT5hY3RpdmUgIT0gYWN0
aXZlLAorCUk5MTVfU1RBVEVfV0FSTihuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUgIT0gYWN0
aXZlLAogCSAgICAgImNydGMgYWN0aXZlIHN0YXRlIGRvZXNuJ3QgbWF0Y2ggd2l0aCBodyBzdGF0
ZSAiCi0JICAgICAiKGV4cGVjdGVkICVpLCBmb3VuZCAlaSlcbiIsIG5ld19jcnRjX3N0YXRlLT5h
Y3RpdmUsIGFjdGl2ZSk7CisJICAgICAiKGV4cGVjdGVkICVpLCBmb3VuZCAlaSlcbiIsIG5ld19j
cnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSwgYWN0aXZlKTsKIAotCUk5MTVfU1RBVEVfV0FSTihpbnRl
bF9jcnRjLT5hY3RpdmUgIT0gbmV3X2NydGNfc3RhdGUtPmFjdGl2ZSwKKwlJOTE1X1NUQVRFX1dB
Uk4oY3J0Yy0+YWN0aXZlICE9IG5ld19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSwKIAkgICAgICJ0
cmFuc2l0aW9uYWwgYWN0aXZlIHN0YXRlIGRvZXMgbm90IG1hdGNoIGF0b21pYyBodyBzdGF0ZSAi
Ci0JICAgICAiKGV4cGVjdGVkICVpLCBmb3VuZCAlaSlcbiIsIG5ld19jcnRjX3N0YXRlLT5hY3Rp
dmUsIGludGVsX2NydGMtPmFjdGl2ZSk7CisJICAgICAiKGV4cGVjdGVkICVpLCBmb3VuZCAlaSlc
biIsIG5ld19jcnRjX3N0YXRlLT5iYXNlLmFjdGl2ZSwgY3J0Yy0+YWN0aXZlKTsKIAotCWZvcl9l
YWNoX2VuY29kZXJfb25fY3J0YyhkZXYsIGNydGMsIGVuY29kZXIpIHsKKwlmb3JfZWFjaF9lbmNv
ZGVyX29uX2NydGMoZGV2LCAmY3J0Yy0+YmFzZSwgZW5jb2RlcikgewogCQllbnVtIHBpcGUgcGlw
ZTsKIAogCQlhY3RpdmUgPSBlbmNvZGVyLT5nZXRfaHdfc3RhdGUoZW5jb2RlciwgJnBpcGUpOwot
CQlJOTE1X1NUQVRFX1dBUk4oYWN0aXZlICE9IG5ld19jcnRjX3N0YXRlLT5hY3RpdmUsCisJCUk5
MTVfU1RBVEVfV0FSTihhY3RpdmUgIT0gbmV3X2NydGNfc3RhdGUtPmJhc2UuYWN0aXZlLAogCQkJ
IltFTkNPREVSOiVpXSBhY3RpdmUgJWkgd2l0aCBjcnRjIGFjdGl2ZSAlaVxuIiwKLQkJCWVuY29k
ZXItPmJhc2UuYmFzZS5pZCwgYWN0aXZlLCBuZXdfY3J0Y19zdGF0ZS0+YWN0aXZlKTsKKwkJCWVu
Y29kZXItPmJhc2UuYmFzZS5pZCwgYWN0aXZlLCBuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUp
OwogCi0JCUk5MTVfU1RBVEVfV0FSTihhY3RpdmUgJiYgaW50ZWxfY3J0Yy0+cGlwZSAhPSBwaXBl
LAorCQlJOTE1X1NUQVRFX1dBUk4oYWN0aXZlICYmIGNydGMtPnBpcGUgIT0gcGlwZSwKIAkJCQki
RW5jb2RlciBjb25uZWN0ZWQgdG8gd3JvbmcgcGlwZSAlY1xuIiwKIAkJCQlwaXBlX25hbWUocGlw
ZSkpOwogCkBAIC0xMjk2NCwxNiArMTI5NjEsMTYgQEAgdmVyaWZ5X2NydGNfc3RhdGUoc3RydWN0
IGRybV9jcnRjICpjcnRjLAogCiAJaW50ZWxfY3J0Y19jb21wdXRlX3BpeGVsX3JhdGUocGlwZV9j
b25maWcpOwogCi0JaWYgKCFuZXdfY3J0Y19zdGF0ZS0+YWN0aXZlKQorCWlmICghbmV3X2NydGNf
c3RhdGUtPmJhc2UuYWN0aXZlKQogCQlyZXR1cm47CiAKIAlpbnRlbF9waXBlX2NvbmZpZ19zYW5p
dHlfY2hlY2soZGV2X3ByaXYsIHBpcGVfY29uZmlnKTsKIAotCXN3X2NvbmZpZyA9IHRvX2ludGVs
X2NydGNfc3RhdGUobmV3X2NydGNfc3RhdGUpOwotCWlmICghaW50ZWxfcGlwZV9jb25maWdfY29t
cGFyZShzd19jb25maWcsIHBpcGVfY29uZmlnLCBmYWxzZSkpIHsKKwlpZiAoIWludGVsX3BpcGVf
Y29uZmlnX2NvbXBhcmUobmV3X2NydGNfc3RhdGUsCisJCQkJICAgICAgIHBpcGVfY29uZmlnLCBm
YWxzZSkpIHsKIAkJSTkxNV9TVEFURV9XQVJOKDEsICJwaXBlIHN0YXRlIGRvZXNuJ3QgbWF0Y2gh
XG4iKTsKIAkJaW50ZWxfZHVtcF9waXBlX2NvbmZpZyhwaXBlX2NvbmZpZywgTlVMTCwgIltodyBz
dGF0ZV0iKTsKLQkJaW50ZWxfZHVtcF9waXBlX2NvbmZpZyhzd19jb25maWcsIE5VTEwsICJbc3cg
c3RhdGVdIik7CisJCWludGVsX2R1bXBfcGlwZV9jb25maWcobmV3X2NydGNfc3RhdGUsIE5VTEws
ICJbc3cgc3RhdGVdIik7CiAJfQogfQogCkBAIC0xMjk5Myw4ICsxMjk5MCw4IEBAIGludGVsX3Zl
cmlmeV9wbGFuZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiBzdGF0aWMgdm9p
ZAogdmVyaWZ5X3NpbmdsZV9kcGxsX3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKIAkJCSBzdHJ1Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKnBsbCwKLQkJCSBzdHJ1Y3QgZHJt
X2NydGMgKmNydGMsCi0JCQkgc3RydWN0IGRybV9jcnRjX3N0YXRlICpuZXdfc3RhdGUpCisJCQkg
c3RydWN0IGludGVsX2NydGMgKmNydGMsCisJCQkgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm5l
d19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfZHBsbF9od19zdGF0ZSBkcGxsX2h3X3N0YXRlOwog
CXVuc2lnbmVkIGludCBjcnRjX21hc2s7CkBAIC0xMzAyNCwxNiArMTMwMjEsMTYgQEAgdmVyaWZ5
X3NpbmdsZV9kcGxsX3N0YXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJ
cmV0dXJuOwogCX0KIAotCWNydGNfbWFzayA9IGRybV9jcnRjX21hc2soY3J0Yyk7CisJY3J0Y19t
YXNrID0gZHJtX2NydGNfbWFzaygmY3J0Yy0+YmFzZSk7CiAKLQlpZiAobmV3X3N0YXRlLT5hY3Rp
dmUpCisJaWYgKG5ld19zdGF0ZS0+YmFzZS5hY3RpdmUpCiAJCUk5MTVfU1RBVEVfV0FSTighKHBs
bC0+YWN0aXZlX21hc2sgJiBjcnRjX21hc2spLAogCQkJCSJwbGwgYWN0aXZlIG1pc21hdGNoIChl
eHBlY3RlZCBwaXBlICVjIGluIGFjdGl2ZSBtYXNrIDB4JTAyeClcbiIsCi0JCQkJcGlwZV9uYW1l
KGRybV9jcnRjX2luZGV4KGNydGMpKSwgcGxsLT5hY3RpdmVfbWFzayk7CisJCQkJcGlwZV9uYW1l
KGRybV9jcnRjX2luZGV4KCZjcnRjLT5iYXNlKSksIHBsbC0+YWN0aXZlX21hc2spOwogCWVsc2UK
IAkJSTkxNV9TVEFURV9XQVJOKHBsbC0+YWN0aXZlX21hc2sgJiBjcnRjX21hc2ssCiAJCQkJInBs
bCBhY3RpdmUgbWlzbWF0Y2ggKGRpZG4ndCBleHBlY3QgcGlwZSAlYyBpbiBhY3RpdmUgbWFzayAw
eCUwMngpXG4iLAotCQkJCXBpcGVfbmFtZShkcm1fY3J0Y19pbmRleChjcnRjKSksIHBsbC0+YWN0
aXZlX21hc2spOworCQkJCXBpcGVfbmFtZShkcm1fY3J0Y19pbmRleCgmY3J0Yy0+YmFzZSkpLCBw
bGwtPmFjdGl2ZV9tYXNrKTsKIAogCUk5MTVfU1RBVEVfV0FSTighKHBsbC0+c3RhdGUuY3J0Y19t
YXNrICYgY3J0Y19tYXNrKSwKIAkJCSJwbGwgZW5hYmxlZCBjcnRjcyBtaXNtYXRjaCAoZXhwZWN0
ZWQgMHgleCBpbiAweCUwMngpXG4iLApAQCAtMTMwNDYsMjggKzEzMDQzLDI2IEBAIHZlcmlmeV9z
aW5nbGVfZHBsbF9zdGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiB9CiAK
IHN0YXRpYyB2b2lkCi12ZXJpZnlfc2hhcmVkX2RwbGxfc3RhdGUoc3RydWN0IGRybV9kZXZpY2Ug
KmRldiwgc3RydWN0IGRybV9jcnRjICpjcnRjLAotCQkJIHN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAq
b2xkX2NydGNfc3RhdGUsCi0JCQkgc3RydWN0IGRybV9jcnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0
ZSkKK3ZlcmlmeV9zaGFyZWRfZHBsbF9zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKKwkJ
CSBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3RhdGUsCisJCQkgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKm5ld19jcnRjX3N0YXRlKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
b2xkX3N0YXRlID0gdG9faW50ZWxfY3J0Y19zdGF0ZShvbGRfY3J0Y19zdGF0ZSk7Ci0Jc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKm5ld19zdGF0ZSA9IHRvX2ludGVsX2NydGNfc3RhdGUobmV3X2Ny
dGNfc3RhdGUpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
Y3J0Yy0+YmFzZS5kZXYpOwogCi0JaWYgKG5ld19zdGF0ZS0+c2hhcmVkX2RwbGwpCi0JCXZlcmlm
eV9zaW5nbGVfZHBsbF9zdGF0ZShkZXZfcHJpdiwgbmV3X3N0YXRlLT5zaGFyZWRfZHBsbCwgY3J0
YywgbmV3X2NydGNfc3RhdGUpOworCWlmIChuZXdfY3J0Y19zdGF0ZS0+c2hhcmVkX2RwbGwpCisJ
CXZlcmlmeV9zaW5nbGVfZHBsbF9zdGF0ZShkZXZfcHJpdiwgbmV3X2NydGNfc3RhdGUtPnNoYXJl
ZF9kcGxsLCBjcnRjLCBuZXdfY3J0Y19zdGF0ZSk7CiAKLQlpZiAob2xkX3N0YXRlLT5zaGFyZWRf
ZHBsbCAmJgotCSAgICBvbGRfc3RhdGUtPnNoYXJlZF9kcGxsICE9IG5ld19zdGF0ZS0+c2hhcmVk
X2RwbGwpIHsKLQkJdW5zaWduZWQgaW50IGNydGNfbWFzayA9IGRybV9jcnRjX21hc2soY3J0Yyk7
Ci0JCXN0cnVjdCBpbnRlbF9zaGFyZWRfZHBsbCAqcGxsID0gb2xkX3N0YXRlLT5zaGFyZWRfZHBs
bDsKKwlpZiAob2xkX2NydGNfc3RhdGUtPnNoYXJlZF9kcGxsICYmCisJICAgIG9sZF9jcnRjX3N0
YXRlLT5zaGFyZWRfZHBsbCAhPSBuZXdfY3J0Y19zdGF0ZS0+c2hhcmVkX2RwbGwpIHsKKwkJdW5z
aWduZWQgaW50IGNydGNfbWFzayA9IGRybV9jcnRjX21hc2soJmNydGMtPmJhc2UpOworCQlzdHJ1
Y3QgaW50ZWxfc2hhcmVkX2RwbGwgKnBsbCA9IG9sZF9jcnRjX3N0YXRlLT5zaGFyZWRfZHBsbDsK
IAogCQlJOTE1X1NUQVRFX1dBUk4ocGxsLT5hY3RpdmVfbWFzayAmIGNydGNfbWFzaywKIAkJCQki
cGxsIGFjdGl2ZSBtaXNtYXRjaCAoZGlkbid0IGV4cGVjdCBwaXBlICVjIGluIGFjdGl2ZSBtYXNr
KVxuIiwKLQkJCQlwaXBlX25hbWUoZHJtX2NydGNfaW5kZXgoY3J0YykpKTsKKwkJCQlwaXBlX25h
bWUoZHJtX2NydGNfaW5kZXgoJmNydGMtPmJhc2UpKSk7CiAJCUk5MTVfU1RBVEVfV0FSTihwbGwt
PnN0YXRlLmNydGNfbWFzayAmIGNydGNfbWFzaywKIAkJCQkicGxsIGVuYWJsZWQgY3J0Y3MgbWlz
bWF0Y2ggKGZvdW5kICV4IGluIGVuYWJsZWQgbWFzaylcbiIsCi0JCQkJcGlwZV9uYW1lKGRybV9j
cnRjX2luZGV4KGNydGMpKSk7CisJCQkJcGlwZV9uYW1lKGRybV9jcnRjX2luZGV4KCZjcnRjLT5i
YXNlKSkpOwogCX0KIH0KIApAQCAtMTMwODAsMTYgKzEzMDc1LDE1IEBAIGludGVsX21vZGVzZXRf
dmVyaWZ5X2NydGMoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJaWYgKCFuZWVkc19tb2Rlc2V0
KG5ld19zdGF0ZSkgJiYgIW5ld19zdGF0ZS0+dXBkYXRlX3BpcGUpCiAJCXJldHVybjsKIAotCXZl
cmlmeV93bV9zdGF0ZSgmY3J0Yy0+YmFzZSwgJm5ld19zdGF0ZS0+YmFzZSk7Ci0JdmVyaWZ5X2Nv
bm5lY3Rvcl9zdGF0ZShjcnRjLT5iYXNlLmRldiwgJnN0YXRlLT5iYXNlLCAmY3J0Yy0+YmFzZSk7
Ci0JdmVyaWZ5X2NydGNfc3RhdGUoJmNydGMtPmJhc2UsICZvbGRfc3RhdGUtPmJhc2UsICZuZXdf
c3RhdGUtPmJhc2UpOwotCXZlcmlmeV9zaGFyZWRfZHBsbF9zdGF0ZShjcnRjLT5iYXNlLmRldiwg
JmNydGMtPmJhc2UsICZvbGRfc3RhdGUtPmJhc2UsICZuZXdfc3RhdGUtPmJhc2UpOworCXZlcmlm
eV93bV9zdGF0ZShjcnRjLCBuZXdfc3RhdGUpOworCXZlcmlmeV9jb25uZWN0b3Jfc3RhdGUoc3Rh
dGUsIGNydGMpOworCXZlcmlmeV9jcnRjX3N0YXRlKGNydGMsIG9sZF9zdGF0ZSwgbmV3X3N0YXRl
KTsKKwl2ZXJpZnlfc2hhcmVkX2RwbGxfc3RhdGUoY3J0Yywgb2xkX3N0YXRlLCBuZXdfc3RhdGUp
OwogfQogCiBzdGF0aWMgdm9pZAotdmVyaWZ5X2Rpc2FibGVkX2RwbGxfc3RhdGUoc3RydWN0IGRy
bV9kZXZpY2UgKmRldikKK3ZlcmlmeV9kaXNhYmxlZF9kcGxsX3N0YXRlKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGRldik7CiAJaW50IGk7CiAKIAlmb3IgKGkgPSAwOyBpIDwgZGV2X3ByaXYt
Pm51bV9zaGFyZWRfZHBsbDsgaSsrKQpAQCAtMTMwOTcsMTIgKzEzMDkxLDEyIEBAIHZlcmlmeV9k
aXNhYmxlZF9kcGxsX3N0YXRlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiB9CiAKIHN0YXRpYyB2
b2lkCi1pbnRlbF9tb2Rlc2V0X3ZlcmlmeV9kaXNhYmxlZChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
LAoraW50ZWxfbW9kZXNldF92ZXJpZnlfZGlzYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2LAogCQkJICAgICAgc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7
Ci0JdmVyaWZ5X2VuY29kZXJfc3RhdGUoZGV2LCAmc3RhdGUtPmJhc2UpOwotCXZlcmlmeV9jb25u
ZWN0b3Jfc3RhdGUoZGV2LCAmc3RhdGUtPmJhc2UsIE5VTEwpOwotCXZlcmlmeV9kaXNhYmxlZF9k
cGxsX3N0YXRlKGRldik7CisJdmVyaWZ5X2VuY29kZXJfc3RhdGUoZGV2X3ByaXYsIHN0YXRlKTsK
Kwl2ZXJpZnlfY29ubmVjdG9yX3N0YXRlKHN0YXRlLCBOVUxMKTsKKwl2ZXJpZnlfZGlzYWJsZWRf
ZHBsbF9zdGF0ZShkZXZfcHJpdik7CiB9CiAKIHN0YXRpYyB2b2lkIHVwZGF0ZV9zY2FubGluZV9v
ZmZzZXQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCkBAIC0xMzgy
Myw3ICsxMzgxNyw3IEBAIHN0YXRpYyB2b2lkIGludGVsX2F0b21pY19jb21taXRfdGFpbChzdHJ1
Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJaWYgKCFpbnRlbF9jYW5fZW5hYmxlX3Nh
Z3Yoc3RhdGUpKQogCQkJaW50ZWxfZGlzYWJsZV9zYWd2KGRldl9wcml2KTsKIAotCQlpbnRlbF9t
b2Rlc2V0X3ZlcmlmeV9kaXNhYmxlZChkZXYsIHN0YXRlKTsKKwkJaW50ZWxfbW9kZXNldF92ZXJp
ZnlfZGlzYWJsZWQoZGV2X3ByaXYsIHN0YXRlKTsKIAl9CiAKIAkvKiBDb21wbGV0ZSB0aGUgZXZl
bnRzIGZvciBwaXBlcyB0aGF0IGhhdmUgbm93IGJlZW4gZGlzYWJsZWQgKi8KLS0gCjIuMjAuMQoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4
IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 1FE2C12799B
	for <lists+intel-gfx@lfdr.de>; Fri, 20 Dec 2019 11:50:11 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id AA57389DB8;
	Fri, 20 Dec 2019 10:50:07 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga09.intel.com (mga09.intel.com [134.134.136.24])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7D2B188284
 for <intel-gfx@lists.freedesktop.org>; Fri, 20 Dec 2019 10:50:02 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga003.jf.intel.com ([10.7.209.27])
 by orsmga102.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 20 Dec 2019 02:50:02 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,335,1571727600"; d="scan'208";a="218777976"
Received: from ideak-desk.fi.intel.com ([10.237.72.183])
 by orsmga003.jf.intel.com with ESMTP; 20 Dec 2019 02:49:59 -0800
From: Imre Deak <imre.deak@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 20 Dec 2019 12:49:27 +0200
Message-Id: <20191220104931.12135-3-imre.deak@intel.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20191218170740.829-1-imre.deak@intel.com>
References: <20191218170740.829-1-imre.deak@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v3 06/15] drm/i915/tgl: Gen-12 render
 decompression
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Nanley G Chery <nanley.g.chery@intel.com>,
 Lucas De Marchi <lucas.demarchi@intel.com>,
 Dhinakaran Pandiyan <dhinakaran.pandiyan@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogRGhpbmFrYXJhbiBQYW5kaXlhbiA8ZGhpbmFrYXJhbi5wYW5kaXlhbkBpbnRlbC5jb20+
CgpHZW4tMTIgZGlzcGxheSBkZWNvbXByZXNzaW9uIG9wZXJhdGVzIG9uIFktdGlsZWQgY29tcHJl
c3NlZCBtYWluIHN1cmZhY2UuClRoZSBDQ1MgaXMgbGluZWFyIGFuZCBoYXMgNCBiaXRzIG9mIG1l
dGFkYXRhIGZvciBlYWNoIG1haW4gc3VyZmFjZSBjYWNoZQpsaW5lIHBhaXIsIGEgc2l6ZSByYXRp
byBvZiAxOjI1Ni4gR2VuLTEyIGRpc3BsYXkgZGVjb21wcmVzc2lvbiBpcwppbmNvbXBhdGlibGUg
d2l0aCBidWZmZXJzIGNvbXByZXNzZWQgYnkgZWFybGllciBHUFVzLCBzbyBtYWtlIHVzZSBvZiBh
IG5ldwptb2RpZmllciB0byBpZGVudGlmeSBnZW4tMTIgY29tcHJlc3Npb24uIEFub3RoZXIgbm90
YWJsZSBjaGFuZ2UgaXMgdGhhdApyZW5kZXIgZGVjb21wcmVzc2lvbiBpcyBzdXBwb3J0ZWQgb24g
YWxsIHBsYW5lcyBleGNlcHQgY3Vyc29yIGFuZCBvbiBhbGwKcGlwZXMuIFN0YXJ0IGJ5IGFkZGlu
ZyByZW5kZXIgZGVjb21wcmVzc2lvbiBzdXBwb3J0IGZvciBbQSxYXUJHUjg4OCBwaXhlbApmb3Jt
YXRzLgoKdjI6IEZpeCBjaGVja3BhdGNoIHdhcm5pbmdzIChMdWNhcykKdjM6ClJlYmFzZSwgZGlz
YWJsZSBjb2xvciBjbGVhciwgc3R5bGluZyBjaGFuZ2VzIGFuZCBtb2RpZnkKaW50ZWxfdGlsZV93
aWR0aF9ieXRlcyBhbmQgaW50ZWxfdGlsZV9oZWlnaHQgdG8gaGFuZGxlIGxpbmVhciBDQ1MKdjQ6
Ci0gVXNlIGZvcm1hdCBibG9jayBkZXNjcmlwdG9ycyBhbmQgdGhlIGk5MTUgc3BlY2lmaWMgZnVu
YyB0byBnZXQgdGhlCiAgc3Vic2FtcGxpbmcgZm9yIGVhY2ggY29sb3IgcGxhbmUuCi0gVXNlIGhl
bHBlcnMgdG8gY29udmVydCBiZXR3ZWVuIENDUyBhbmQgbWFpbiBwbGFuZXMuCnY1OgotIEZpeCBz
dWJzYW1wbGluZyByZXR1cm5lZCBieSBpbnRlbF9mYl9wbGFuZV9nZXRfc3Vic2FtcGxpbmcoKSBm
b3IKICB0aGUgQ0NTIHBsYW5lIG9mIHRoZSBmaXJzdCBwbGFuZS4KdjY6Ci0gUmViYXNlZCBvbiB2
MiBvZiBwYXRjaCA0LgoKQ2M6IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBsaW51eC5p
bnRlbC5jb20+CkNjOiBNYXR0IFJvcGVyIDxtYXR0aGV3LmQucm9wZXJAaW50ZWwuY29tPgpDYzog
TmFubGV5IEcgQ2hlcnkgPG5hbmxleS5nLmNoZXJ5QGludGVsLmNvbT4KQ2M6IEphc29uIEVrc3Ry
YW5kIDxqYXNvbkBqbGVrc3RyYW5kLm5ldD4KQ2M6IFJhZGhha3Jpc2huYSBTcmlwYWRhIDxyYWRo
YWtyaXNobmEuc3JpcGFkYUBpbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6IERoaW5ha2FyYW4gUGFu
ZGl5YW4gPGRoaW5ha2FyYW4ucGFuZGl5YW5AaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBMdWNh
cyBEZSBNYXJjaGkgPGx1Y2FzLmRlbWFyY2hpQGludGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogSW1y
ZSBEZWFrIDxpbXJlLmRlYWtAaW50ZWwuY29tPgpSZXZpZXdlZC1ieTogUmFkaGFrcmlzaG5hIFNy
aXBhZGEgPHJhZGhha3Jpc2huYS5zcmlwYWRhQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyB8IDE4MyArKysrKysrKysrKysrKystLS0t
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jICB8ICAyMyArKy0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmggICAgICAgICAgICAgIHwgICAxICsKIDMg
ZmlsZXMgY2hhbmdlZCwgMTY2IGluc2VydGlvbnMoKyksIDQxIGRlbGV0aW9ucygtKQoKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggNTQ0NWYwZDVi
MDA1Li5hZmVkMDMzMWU4YWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheS5jCkBAIC0xOTQxLDYgKzE5NDEsMTYgQEAgc3RhdGljIGJvb2wgaXNfY2NzX3Bs
YW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgcGxhbmUpCiAJcmV0dXJu
IHBsYW5lID49IGZiLT5mb3JtYXQtPm51bV9wbGFuZXMgLyAyOwogfQogCitzdGF0aWMgYm9vbCBp
c19nZW4xMl9jY3NfbW9kaWZpZXIodTY0IG1vZGlmaWVyKQoreworCXJldHVybiBtb2RpZmllciA9
PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1M7Cit9CisKK3N0YXRpYyBib29s
IGlzX2dlbjEyX2Njc19wbGFuZShjb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50
IHBsYW5lKQoreworCXJldHVybiBpc19nZW4xMl9jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSAm
JiBpc19jY3NfcGxhbmUoZmIsIHBsYW5lKTsKK30KKwogc3RhdGljIGJvb2wgaXNfYXV4X3BsYW5l
KGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgcGxhbmUpCiB7CiAJaWYgKGlz
X2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpKQpAQCAtMTk1Nyw2ICsxOTY3LDE0IEBAIHN0YXRp
YyBpbnQgbWFpbl90b19jY3NfcGxhbmUoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIs
IGludCBtYWluX3BsYW5lKQogCXJldHVybiBmYi0+Zm9ybWF0LT5udW1fcGxhbmVzIC8gMiArIG1h
aW5fcGxhbmU7CiB9CiAKK3N0YXRpYyBpbnQgY2NzX3RvX21haW5fcGxhbmUoY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjY3NfcGxhbmUpCit7CisJV0FSTl9PTighaXNfY2Nz
X21vZGlmaWVyKGZiLT5tb2RpZmllcikgfHwKKwkJY2NzX3BsYW5lIDwgZmItPmZvcm1hdC0+bnVt
X3BsYW5lcyAvIDIpOworCisJcmV0dXJuIGNjc19wbGFuZSAtIGZiLT5mb3JtYXQtPm51bV9wbGFu
ZXMgLyAyOworfQorCiAvKiBSZXR1cm4gZWl0aGVyIHRoZSBtYWluIHBsYW5lJ3MgQ0NTIG9yIC0g
aWYgbm90IGEgQ0NTIEZCIC0gVVYgcGxhbmUgKi8KIHN0YXRpYyBpbnQKIGludGVsX21haW5fdG9f
YXV4X3BsYW5lKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgbWFpbl9wbGFu
ZSkKQEAgLTE5ODUsNiArMjAwMywxMCBAQCBpbnRlbF90aWxlX3dpZHRoX2J5dGVzKGNvbnN0IHN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgY29sb3JfcGxhbmUpCiAJCWlmIChpc19jY3Nf
cGxhbmUoZmIsIGNvbG9yX3BsYW5lKSkKIAkJCXJldHVybiAxMjg7CiAJCS8qIGZhbGwgdGhyb3Vn
aCAqLworCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTOgorCQlpZiAo
aXNfY2NzX3BsYW5lKGZiLCBjb2xvcl9wbGFuZSkpCisJCQlyZXR1cm4gNjQ7CisJCS8qIGZhbGwg
dGhyb3VnaCAqLwogCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQ6CiAJCWlmIChJU19HRU4o
ZGV2X3ByaXYsIDIpIHx8IEhBU18xMjhfQllURV9ZX1RJTElORyhkZXZfcHJpdikpCiAJCQlyZXR1
cm4gMTI4OwpAQCAtMjAxOCw2ICsyMDQwLDkgQEAgaW50ZWxfdGlsZV93aWR0aF9ieXRlcyhjb25z
dCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwgaW50IGNvbG9yX3BsYW5lKQogc3RhdGljIHVu
c2lnbmVkIGludAogaW50ZWxfdGlsZV9oZWlnaHQoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZl
ciAqZmIsIGludCBjb2xvcl9wbGFuZSkKIHsKKwlpZiAoaXNfZ2VuMTJfY2NzX3BsYW5lKGZiLCBj
b2xvcl9wbGFuZSkpCisJCXJldHVybiAxOworCiAJcmV0dXJuIGludGVsX3RpbGVfc2l6ZSh0b19p
OTE1KGZiLT5kZXYpKSAvCiAJCWludGVsX3RpbGVfd2lkdGhfYnl0ZXMoZmIsIGNvbG9yX3BsYW5l
KTsKIH0KQEAgLTIxMTgsNiArMjE0Myw4IEBAIHN0YXRpYyB1bnNpZ25lZCBpbnQgaW50ZWxfc3Vy
Zl9hbGlnbm1lbnQoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCiAJCWlmIChJTlRF
TF9HRU4oZGV2X3ByaXYpID49IDkpCiAJCQlyZXR1cm4gMjU2ICogMTAyNDsKIAkJcmV0dXJuIDA7
CisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1M6CisJCXJldHVybiAx
NiAqIDEwMjQ7CiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1M6CiAJY2FzZSBJOTE1
X0ZPUk1BVF9NT0RfWWZfVElMRURfQ0NTOgogCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRUQ6
CkBAIC0yMzEwLDkgKzIzMzcsMTAgQEAgc3RhdGljIHUzMiBpbnRlbF9hZGp1c3RfdGlsZV9vZmZz
ZXQoaW50ICp4LCBpbnQgKnksCiAJcmV0dXJuIG5ld19vZmZzZXQ7CiB9CiAKLXN0YXRpYyBib29s
IGlzX3N1cmZhY2VfbGluZWFyKHU2NCBtb2RpZmllciwgaW50IGNvbG9yX3BsYW5lKQorc3RhdGlj
IGJvb2wgaXNfc3VyZmFjZV9saW5lYXIoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIs
IGludCBjb2xvcl9wbGFuZSkKIHsKLQlyZXR1cm4gbW9kaWZpZXIgPT0gRFJNX0ZPUk1BVF9NT0Rf
TElORUFSOworCXJldHVybiBmYi0+bW9kaWZpZXIgPT0gRFJNX0ZPUk1BVF9NT0RfTElORUFSIHx8
CisJICAgICAgIGlzX2dlbjEyX2Njc19wbGFuZShmYiwgY29sb3JfcGxhbmUpOwogfQogCiBzdGF0
aWMgdTMyIGludGVsX2FkanVzdF9hbGlnbmVkX29mZnNldChpbnQgKngsIGludCAqeSwKQEAgLTIz
MjcsNyArMjM1NSw3IEBAIHN0YXRpYyB1MzIgaW50ZWxfYWRqdXN0X2FsaWduZWRfb2Zmc2V0KGlu
dCAqeCwgaW50ICp5LAogCiAJV0FSTl9PTihuZXdfb2Zmc2V0ID4gb2xkX29mZnNldCk7CiAKLQlp
ZiAoIWlzX3N1cmZhY2VfbGluZWFyKGZiLT5tb2RpZmllciwgY29sb3JfcGxhbmUpKSB7CisJaWYg
KCFpc19zdXJmYWNlX2xpbmVhcihmYiwgY29sb3JfcGxhbmUpKSB7CiAJCXVuc2lnbmVkIGludCB0
aWxlX3NpemUsIHRpbGVfd2lkdGgsIHRpbGVfaGVpZ2h0OwogCQl1bnNpZ25lZCBpbnQgcGl0Y2hf
dGlsZXM7CiAKQEAgLTIzOTcsNyArMjQyNSw3IEBAIHN0YXRpYyB1MzIgaW50ZWxfY29tcHV0ZV9h
bGlnbmVkX29mZnNldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaWYgKGFs
aWdubWVudCkKIAkJYWxpZ25tZW50LS07CiAKLQlpZiAoIWlzX3N1cmZhY2VfbGluZWFyKGZiLT5t
b2RpZmllciwgY29sb3JfcGxhbmUpKSB7CisJaWYgKCFpc19zdXJmYWNlX2xpbmVhcihmYiwgY29s
b3JfcGxhbmUpKSB7CiAJCXVuc2lnbmVkIGludCB0aWxlX3NpemUsIHRpbGVfd2lkdGgsIHRpbGVf
aGVpZ2h0OwogCQl1bnNpZ25lZCBpbnQgdGlsZV9yb3dzLCB0aWxlcywgcGl0Y2hfdGlsZXM7CiAK
QEAgLTI0OTksNiArMjUyNyw3IEBAIHN0YXRpYyB1bnNpZ25lZCBpbnQgaW50ZWxfZmJfbW9kaWZp
ZXJfdG9fdGlsaW5nKHU2NCBmYl9tb2RpZmllcikKIAkJcmV0dXJuIEk5MTVfVElMSU5HX1g7CiAJ
Y2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRDoKIAljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJ
TEVEX0NDUzoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUzoKIAkJ
cmV0dXJuIEk5MTVfVElMSU5HX1k7CiAJZGVmYXVsdDoKIAkJcmV0dXJuIEk5MTVfVElMSU5HX05P
TkU7CkBAIC0yNTE5LDcgKzI1NDgsNyBAQCBzdGF0aWMgdW5zaWduZWQgaW50IGludGVsX2ZiX21v
ZGlmaWVyX3RvX3RpbGluZyh1NjQgZmJfbW9kaWZpZXIpCiAgKiB1cyBhIHJhdGlvIG9mIG9uZSBi
eXRlIGluIHRoZSBDQ1MgZm9yIGVhY2ggOHgxNiBwaXhlbHMgaW4gdGhlCiAgKiBtYWluIHN1cmZh
Y2UuCiAgKi8KLXN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvIGNjc19mb3JtYXRz
W10gPSB7CitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyBza2xfY2NzX2Zvcm1h
dHNbXSA9IHsKIAl7IC5mb3JtYXQgPSBEUk1fRk9STUFUX1hSR0I4ODg4LCAuZGVwdGggPSAyNCwg
Lm51bV9wbGFuZXMgPSAyLAogCSAgLmNwcCA9IHsgNCwgMSwgfSwgLmhzdWIgPSA4LCAudnN1YiA9
IDE2LCB9LAogCXsgLmZvcm1hdCA9IERSTV9GT1JNQVRfWEJHUjg4ODgsIC5kZXB0aCA9IDI0LCAu
bnVtX3BsYW5lcyA9IDIsCkBAIC0yNTMwLDYgKzI1NTksMjggQEAgc3RhdGljIGNvbnN0IHN0cnVj
dCBkcm1fZm9ybWF0X2luZm8gY2NzX2Zvcm1hdHNbXSA9IHsKIAkgIC5jcHAgPSB7IDQsIDEsIH0s
IC5oc3ViID0gOCwgLnZzdWIgPSAxNiwgLmhhc19hbHBoYSA9IHRydWUsIH0sCiB9OwogCisvKgor
ICogR2VuLTEyIGNvbXByZXNzaW9uIHVzZXMgNCBiaXRzIG9mIENDUyBkYXRhIGZvciBlYWNoIGNh
Y2hlIGxpbmUgcGFpciBpbiB0aGUKKyAqIG1haW4gc3VyZmFjZS4gQW5kIGVhY2ggNjRCIENDUyBj
YWNoZSBsaW5lIHJlcHJlc2VudHMgYW4gYXJlYSBvZiA0eDEgWS10aWxlcworICogaW4gdGhlIG1h
aW4gc3VyZmFjZS4gV2l0aCA0IGJ5dGUgcGl4ZWxzIGFuZCBlYWNoIFktdGlsZSBoYXZpbmcgZGlt
ZW5zaW9ucyBvZgorICogMzJ4MzIgcGl4ZWxzLCB0aGUgcmF0aW8gdHVybnMgb3V0IHRvIDFCIGlu
IHRoZSBDQ1MgZm9yIGV2ZXJ5IDJ4MzIgcGl4ZWxzIGluCisgKiB0aGUgbWFpbiBzdXJmYWNlLgor
ICovCitzdGF0aWMgY29uc3Qgc3RydWN0IGRybV9mb3JtYXRfaW5mbyBnZW4xMl9jY3NfZm9ybWF0
c1tdID0geworCXsgLmZvcm1hdCA9IERSTV9GT1JNQVRfWFJHQjg4ODgsIC5kZXB0aCA9IDI0LCAu
bnVtX3BsYW5lcyA9IDIsCisJICAuY2hhcl9wZXJfYmxvY2sgPSB7IDQsIDEgfSwgLmJsb2NrX3cg
PSB7IDEsIDIgfSwgLmJsb2NrX2ggPSB7IDEsIDEgfSwKKwkgIC5oc3ViID0gMSwgLnZzdWIgPSAx
LCB9LAorCXsgLmZvcm1hdCA9IERSTV9GT1JNQVRfWEJHUjg4ODgsIC5kZXB0aCA9IDI0LCAubnVt
X3BsYW5lcyA9IDIsCisJICAuY2hhcl9wZXJfYmxvY2sgPSB7IDQsIDEgfSwgLmJsb2NrX3cgPSB7
IDEsIDIgfSwgLmJsb2NrX2ggPSB7IDEsIDEgfSwKKwkgIC5oc3ViID0gMSwgLnZzdWIgPSAxLCB9
LAorCXsgLmZvcm1hdCA9IERSTV9GT1JNQVRfQVJHQjg4ODgsIC5kZXB0aCA9IDMyLCAubnVtX3Bs
YW5lcyA9IDIsCisJICAuY2hhcl9wZXJfYmxvY2sgPSB7IDQsIDEgfSwgLmJsb2NrX3cgPSB7IDEs
IDIgfSwgLmJsb2NrX2ggPSB7IDEsIDEgfSwKKwkgIC5oc3ViID0gMSwgLnZzdWIgPSAxLCAuaGFz
X2FscGhhID0gdHJ1ZSB9LAorCXsgLmZvcm1hdCA9IERSTV9GT1JNQVRfQUJHUjg4ODgsIC5kZXB0
aCA9IDMyLCAubnVtX3BsYW5lcyA9IDIsCisJICAuY2hhcl9wZXJfYmxvY2sgPSB7IDQsIDEgfSwg
LmJsb2NrX3cgPSB7IDEsIDIgfSwgLmJsb2NrX2ggPSB7IDEsIDEgfSwKKwkgIC5oc3ViID0gMSwg
LnZzdWIgPSAxLCAuaGFzX2FscGhhID0gdHJ1ZSB9LAorfTsKKwogc3RhdGljIGNvbnN0IHN0cnVj
dCBkcm1fZm9ybWF0X2luZm8gKgogbG9va3VwX2Zvcm1hdF9pbmZvKGNvbnN0IHN0cnVjdCBkcm1f
Zm9ybWF0X2luZm8gZm9ybWF0c1tdLAogCQkgICBpbnQgbnVtX2Zvcm1hdHMsIHUzMiBmb3JtYXQp
CkBAIC0yNTUwLDggKzI2MDEsMTIgQEAgaW50ZWxfZ2V0X2Zvcm1hdF9pbmZvKGNvbnN0IHN0cnVj
dCBkcm1fbW9kZV9mYl9jbWQyICpjbWQpCiAJc3dpdGNoIChjbWQtPm1vZGlmaWVyWzBdKSB7CiAJ
Y2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1M6CiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0Rf
WWZfVElMRURfQ0NTOgotCQlyZXR1cm4gbG9va3VwX2Zvcm1hdF9pbmZvKGNjc19mb3JtYXRzLAot
CQkJCQkgIEFSUkFZX1NJWkUoY2NzX2Zvcm1hdHMpLAorCQlyZXR1cm4gbG9va3VwX2Zvcm1hdF9p
bmZvKHNrbF9jY3NfZm9ybWF0cywKKwkJCQkJICBBUlJBWV9TSVpFKHNrbF9jY3NfZm9ybWF0cyks
CisJCQkJCSAgY21kLT5waXhlbF9mb3JtYXQpOworCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElM
RURfR0VOMTJfUkNfQ0NTOgorCQlyZXR1cm4gbG9va3VwX2Zvcm1hdF9pbmZvKGdlbjEyX2Njc19m
b3JtYXRzLAorCQkJCQkgIEFSUkFZX1NJWkUoZ2VuMTJfY2NzX2Zvcm1hdHMpLAogCQkJCQkgIGNt
ZC0+cGl4ZWxfZm9ybWF0KTsKIAlkZWZhdWx0OgogCQlyZXR1cm4gTlVMTDsKQEAgLTI1NjAsNyAr
MjYxNSw4IEBAIGludGVsX2dldF9mb3JtYXRfaW5mbyhjb25zdCBzdHJ1Y3QgZHJtX21vZGVfZmJf
Y21kMiAqY21kKQogCiBib29sIGlzX2Njc19tb2RpZmllcih1NjQgbW9kaWZpZXIpCiB7Ci0JcmV0
dXJuIG1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUyB8fAorCXJldHVybiBt
b2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1MgfHwKKwkgICAg
ICAgbW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfQ0NTIHx8CiAJICAgICAgIG1v
ZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRF9DQ1M7CiB9CiAKQEAgLTI2MDgsOCAr
MjY2NCw5IEBAIHN0YXRpYyB1MzIKIGludGVsX2ZiX3N0cmlkZV9hbGlnbm1lbnQoY29uc3Qgc3Ry
dWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjb2xvcl9wbGFuZSkKIHsKIAlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGZiLT5kZXYpOworCXUzMiB0aWxlX3dp
ZHRoOwogCi0JaWYgKGZiLT5tb2RpZmllciA9PSBEUk1fRk9STUFUX01PRF9MSU5FQVIpIHsKKwlp
ZiAoaXNfc3VyZmFjZV9saW5lYXIoZmIsIGNvbG9yX3BsYW5lKSkgewogCQl1MzIgbWF4X3N0cmlk
ZSA9IGludGVsX3BsYW5lX2ZiX21heF9zdHJpZGUoZGV2X3ByaXYsCiAJCQkJCQkJICAgZmItPmZv
cm1hdC0+Zm9ybWF0LAogCQkJCQkJCSAgIGZiLT5tb2RpZmllcik7CkBAIC0yNjE4LDEzICsyNjc1
LDE0IEBAIGludGVsX2ZiX3N0cmlkZV9hbGlnbm1lbnQoY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1
ZmZlciAqZmIsIGludCBjb2xvcl9wbGFuZSkKIAkJICogVG8gbWFrZSByZW1hcHBpbmcgd2l0aCBs
aW5lYXIgZ2VuZXJhbGx5IGZlYXNpYmxlCiAJCSAqIHdlIG5lZWQgdGhlIHN0cmlkZSB0byBiZSBw
YWdlIGFsaWduZWQuCiAJCSAqLwotCQlpZiAoZmItPnBpdGNoZXNbY29sb3JfcGxhbmVdID4gbWF4
X3N0cmlkZSkKKwkJaWYgKGZiLT5waXRjaGVzW2NvbG9yX3BsYW5lXSA+IG1heF9zdHJpZGUgJiYg
IWlzX2Njc19tb2RpZmllcihmYi0+bW9kaWZpZXIpKQogCQkJcmV0dXJuIGludGVsX3RpbGVfc2l6
ZShkZXZfcHJpdik7CiAJCWVsc2UKIAkJCXJldHVybiA2NDsKLQl9IGVsc2UgewotCQl1MzIgdGls
ZV93aWR0aCA9IGludGVsX3RpbGVfd2lkdGhfYnl0ZXMoZmIsIGNvbG9yX3BsYW5lKTsKKwl9CiAK
Kwl0aWxlX3dpZHRoID0gaW50ZWxfdGlsZV93aWR0aF9ieXRlcyhmYiwgY29sb3JfcGxhbmUpOwor
CWlmIChpc19jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSAmJiBjb2xvcl9wbGFuZSA9PSAwKSB7
CiAJCS8qCiAJCSAqIERpc3BsYXkgV0EgIzA1MzE6IHNrbCxieHQsa2JsLGdsawogCQkgKgpAQCAt
MjYzNCwxMiArMjY5MiwxNiBAQCBpbnRlbF9mYl9zdHJpZGVfYWxpZ25tZW50KGNvbnN0IHN0cnVj
dCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgY29sb3JfcGxhbmUpCiAJCSAqIHJlcXVpcmUgdGhl
IGVudGlyZSBmYiB0byBhY2NvbW1vZGF0ZSB0aGF0IHRvIGF2b2lkCiAJCSAqIHBvdGVudGlhbCBy
dW50aW1lIGVycm9ycyBhdCBwbGFuZSBjb25maWd1cmF0aW9uIHRpbWUuCiAJCSAqLwotCQlpZiAo
SVNfR0VOKGRldl9wcml2LCA5KSAmJiBpc19jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSAmJgot
CQkgICAgY29sb3JfcGxhbmUgPT0gMCAmJiBmYi0+d2lkdGggPiAzODQwKQorCQlpZiAoSVNfR0VO
KGRldl9wcml2LCA5KSAmJiBmYi0+d2lkdGggPiAzODQwKQorCQkJdGlsZV93aWR0aCAqPSA0Owor
CQkvKgorCQkgKiBUaGUgbWFpbiBzdXJmYWNlIHBpdGNoIG11c3QgYmUgcGFkZGVkIHRvIGEgbXVs
dGlwbGUgb2YgZm91cgorCQkgKiB0aWxlIHdpZHRocy4KKwkJICovCisJCWVsc2UgaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPj0gMTIpCiAJCQl0aWxlX3dpZHRoICo9IDQ7Ci0KLQkJcmV0dXJuIHRp
bGVfd2lkdGg7CiAJfQorCXJldHVybiB0aWxlX3dpZHRoOwogfQogCiBib29sIGludGVsX3BsYW5l
X2Nhbl9yZW1hcChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQpA
QCAtMjcxMCwyOCArMjc3Miw3MyBAQCBzdGF0aWMgYm9vbCBpbnRlbF9wbGFuZV9uZWVkc19yZW1h
cChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlKQogCXJldHVybiBz
dHJpZGUgPiBtYXhfc3RyaWRlOwogfQogCitzdGF0aWMgdm9pZAoraW50ZWxfZmJfcGxhbmVfZ2V0
X3N1YnNhbXBsaW5nKGludCAqaHN1YiwgaW50ICp2c3ViLAorCQkJICAgICAgIGNvbnN0IHN0cnVj
dCBkcm1fZnJhbWVidWZmZXIgKmZiLAorCQkJICAgICAgIGludCBjb2xvcl9wbGFuZSkKK3sKKwlp
bnQgbWFpbl9wbGFuZTsKKworCWlmIChjb2xvcl9wbGFuZSA9PSAwKSB7CisJCSpoc3ViID0gMTsK
KwkJKnZzdWIgPSAxOworCisJCXJldHVybjsKKwl9CisKKwkvKgorCSAqIFRPRE86IERlZHVjdCB0
aGUgc3Vic2FtcGxpbmcgZnJvbSB0aGUgY2hhciBibG9jayBmb3IgYWxsIENDUworCSAqIGZvcm1h
dHMgYW5kIHBsYW5lcy4KKwkgKi8KKwlpZiAoIWlzX2dlbjEyX2Njc19wbGFuZShmYiwgY29sb3Jf
cGxhbmUpKSB7CisJCSpoc3ViID0gZmItPmZvcm1hdC0+aHN1YjsKKwkJKnZzdWIgPSBmYi0+Zm9y
bWF0LT52c3ViOworCisJCXJldHVybjsKKwl9CisKKwltYWluX3BsYW5lID0gY2NzX3RvX21haW5f
cGxhbmUoZmIsIGNvbG9yX3BsYW5lKTsKKwkqaHN1YiA9IGRybV9mb3JtYXRfaW5mb19ibG9ja193
aWR0aChmYi0+Zm9ybWF0LCBjb2xvcl9wbGFuZSkgLworCQlkcm1fZm9ybWF0X2luZm9fYmxvY2tf
d2lkdGgoZmItPmZvcm1hdCwgbWFpbl9wbGFuZSk7CisKKwkvKgorCSAqIFRoZSBtaW4gc3RyaWRl
IGNoZWNrIGluIHRoZSBjb3JlIGZyYW1lYnVmZmVyX2NoZWNrKCkgZnVuY3Rpb24KKwkgKiBhc3N1
bWVzIHRoYXQgZm9ybWF0LT5oc3ViIGFwcGxpZXMgdG8gZXZlcnkgcGxhbmUgZXhjZXB0IGZvciB0
aGUKKwkgKiBmaXJzdCBwbGFuZS4gVGhhdCdzIGluY29ycmVjdCBmb3IgdGhlIENDUyBBVVggcGxh
bmUgb2YgdGhlIGZpcnN0CisJICogcGxhbmUsIGJ1dCBmb3IgdGhlIGFib3ZlIGNoZWNrIHRvIHBh
c3Mgd2UgbXVzdCBkZWZpbmUgdGhlIGJsb2NrCisJICogd2lkdGggd2l0aCB0aGF0IHN1YnNhbXBs
aW5nIGFwcGxpZWQgdG8gaXQuIEFkanVzdCB0aGUgd2lkdGggaGVyZQorCSAqIGFjY29yZGluZ2x5
LCBzbyB3ZSBjYW4gY2FsY3VsYXRlIHRoZSBhY3R1YWwgc3Vic2FtcGxpbmcgZmFjdG9yLgorCSAq
LworCWlmIChtYWluX3BsYW5lID09IDApCisJCSpoc3ViICo9IGZiLT5mb3JtYXQtPmhzdWI7CisK
KwkqdnN1YiA9IDMyOworfQogc3RhdGljIGludAogaW50ZWxfZmJfY2hlY2tfY2NzX3h5KHN0cnVj
dCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgY2NzX3BsYW5lLCBpbnQgeCwgaW50IHkpCiB7CiAJ
c3RydWN0IGludGVsX2ZyYW1lYnVmZmVyICppbnRlbF9mYiA9IHRvX2ludGVsX2ZyYW1lYnVmZmVy
KGZiKTsKLQlpbnQgaHN1YiA9IGZiLT5mb3JtYXQtPmhzdWI7Ci0JaW50IHZzdWIgPSBmYi0+Zm9y
bWF0LT52c3ViOworCWludCBtYWluX3BsYW5lOworCWludCBoc3ViLCB2c3ViOwogCWludCB0aWxl
X3dpZHRoLCB0aWxlX2hlaWdodDsKIAlpbnQgY2NzX3gsIGNjc195OwogCWludCBtYWluX3gsIG1h
aW5feTsKIAotCWlmICghaXNfY2NzX21vZGlmaWVyKGZiLT5tb2RpZmllcikgfHwgY2NzX3BsYW5l
ICE9IDEpCisJaWYgKCFpc19jY3NfcGxhbmUoZmIsIGNjc19wbGFuZSkpCiAJCXJldHVybiAwOwog
Ci0JaW50ZWxfdGlsZV9kaW1zKGZiLCAxLCAmdGlsZV93aWR0aCwgJnRpbGVfaGVpZ2h0KTsKKwlp
bnRlbF90aWxlX2RpbXMoZmIsIGNjc19wbGFuZSwgJnRpbGVfd2lkdGgsICZ0aWxlX2hlaWdodCk7
CisJaW50ZWxfZmJfcGxhbmVfZ2V0X3N1YnNhbXBsaW5nKCZoc3ViLCAmdnN1YiwgZmIsIGNjc19w
bGFuZSk7CiAKIAl0aWxlX3dpZHRoICo9IGhzdWI7CiAJdGlsZV9oZWlnaHQgKj0gdnN1YjsKIAog
CWNjc194ID0gKHggKiBoc3ViKSAlIHRpbGVfd2lkdGg7CiAJY2NzX3kgPSAoeSAqIHZzdWIpICUg
dGlsZV9oZWlnaHQ7Ci0JbWFpbl94ID0gaW50ZWxfZmItPm5vcm1hbFswXS54ICUgdGlsZV93aWR0
aDsKLQltYWluX3kgPSBpbnRlbF9mYi0+bm9ybWFsWzBdLnkgJSB0aWxlX2hlaWdodDsKKworCW1h
aW5fcGxhbmUgPSBjY3NfdG9fbWFpbl9wbGFuZShmYiwgY2NzX3BsYW5lKTsKKwltYWluX3ggPSBp
bnRlbF9mYi0+bm9ybWFsW21haW5fcGxhbmVdLnggJSB0aWxlX3dpZHRoOworCW1haW5feSA9IGlu
dGVsX2ZiLT5ub3JtYWxbbWFpbl9wbGFuZV0ueSAlIHRpbGVfaGVpZ2h0OwogCiAJLyoKIAkgKiBD
Q1MgZG9lc24ndCBoYXZlIGl0cyBvd24geC95IG9mZnNldCByZWdpc3Rlciwgc28gdGhlIGludHJh
IENDUyB0aWxlCkBAIC0yNzQxLDggKzI4NDgsOCBAQCBpbnRlbF9mYl9jaGVja19jY3NfeHkoc3Ry
dWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsIGludCBjY3NfcGxhbmUsIGludCB4LCBpbnQgeSkKIAkJ
RFJNX0RFQlVHX0tNUygiQmFkIENDUyB4L3kgKG1haW4gJWQsJWQgY2NzICVkLCVkKSBmdWxsICht
YWluICVkLCVkIGNjcyAlZCwlZClcbiIsCiAJCQkgICAgICBtYWluX3gsIG1haW5feSwKIAkJCSAg
ICAgIGNjc194LCBjY3NfeSwKLQkJCSAgICAgIGludGVsX2ZiLT5ub3JtYWxbMF0ueCwKLQkJCSAg
ICAgIGludGVsX2ZiLT5ub3JtYWxbMF0ueSwKKwkJCSAgICAgIGludGVsX2ZiLT5ub3JtYWxbbWFp
bl9wbGFuZV0ueCwKKwkJCSAgICAgIGludGVsX2ZiLT5ub3JtYWxbbWFpbl9wbGFuZV0ueSwKIAkJ
CSAgICAgIHgsIHkpOwogCQlyZXR1cm4gLUVJTlZBTDsKIAl9CkBAIC0yODEzLDcgKzI5MjAsNyBA
QCBpbnRlbF9maWxsX2ZiX2luZm8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAog
CQkJCQkJICAgICAgdGlsZV9zaXplKTsKIAkJb2Zmc2V0IC89IHRpbGVfc2l6ZTsKIAotCQlpZiAo
IWlzX3N1cmZhY2VfbGluZWFyKGZiLT5tb2RpZmllciwgaSkpIHsKKwkJaWYgKCFpc19zdXJmYWNl
X2xpbmVhcihmYiwgaSkpIHsKIAkJCXVuc2lnbmVkIGludCB0aWxlX3dpZHRoLCB0aWxlX2hlaWdo
dDsKIAkJCXVuc2lnbmVkIGludCBwaXRjaF90aWxlczsKIAkJCXN0cnVjdCBkcm1fcmVjdCByOwpA
QCAtMzQ5MiwxNCArMzU5OSwxNSBAQCBzdGF0aWMgYm9vbCBza2xfY2hlY2tfbWFpbl9jY3NfY29v
cmRpbmF0ZXMoc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZQogCQkJCQkgICBp
bnQgbWFpbl94LCBpbnQgbWFpbl95LCB1MzIgbWFpbl9vZmZzZXQpCiB7CiAJY29uc3Qgc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7Ci0JaW50IGhzdWIgPSBm
Yi0+Zm9ybWF0LT5oc3ViOwotCWludCB2c3ViID0gZmItPmZvcm1hdC0+dnN1YjsKIAlpbnQgY2Nz
X3BsYW5lID0gbWFpbl90b19jY3NfcGxhbmUoZmIsIDApOwogCWludCBhdXhfeCA9IHBsYW5lX3N0
YXRlLT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLng7CiAJaW50IGF1eF95ID0gcGxhbmVfc3RhdGUt
PmNvbG9yX3BsYW5lW2Njc19wbGFuZV0ueTsKIAl1MzIgYXV4X29mZnNldCA9IHBsYW5lX3N0YXRl
LT5jb2xvcl9wbGFuZVtjY3NfcGxhbmVdLm9mZnNldDsKIAl1MzIgYWxpZ25tZW50ID0gaW50ZWxf
c3VyZl9hbGlnbm1lbnQoZmIsIGNjc19wbGFuZSk7CisJaW50IGhzdWI7CisJaW50IHZzdWI7CiAK
KwlpbnRlbF9mYl9wbGFuZV9nZXRfc3Vic2FtcGxpbmcoJmhzdWIsICZ2c3ViLCBmYiwgY2NzX3Bs
YW5lKTsKIAl3aGlsZSAoYXV4X29mZnNldCA+PSBtYWluX29mZnNldCAmJiBhdXhfeSA8PSBtYWlu
X3kpIHsKIAkJaW50IHgsIHk7CiAKQEAgLTM2NjAsMTIgKzM3NjgsMTUgQEAgc3RhdGljIGludCBz
a2xfY2hlY2tfY2NzX2F1eF9zdXJmYWNlKHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqcGxhbmVf
c3RhdGUpCiAJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+
aHcuZmI7CiAJaW50IHNyY194ID0gcGxhbmVfc3RhdGUtPnVhcGkuc3JjLngxID4+IDE2OwogCWlu
dCBzcmNfeSA9IHBsYW5lX3N0YXRlLT51YXBpLnNyYy55MSA+PiAxNjsKLQlpbnQgaHN1YiA9IGZi
LT5mb3JtYXQtPmhzdWI7Ci0JaW50IHZzdWIgPSBmYi0+Zm9ybWF0LT52c3ViOwotCWludCB4ID0g
c3JjX3ggLyBoc3ViOwotCWludCB5ID0gc3JjX3kgLyB2c3ViOworCWludCBoc3ViOworCWludCB2
c3ViOworCWludCB4OworCWludCB5OwogCXUzMiBvZmZzZXQ7CiAKKwlpbnRlbF9mYl9wbGFuZV9n
ZXRfc3Vic2FtcGxpbmcoJmhzdWIsICZ2c3ViLCBmYiwgMSk7CisJeCA9IHNyY194IC8gaHN1YjsK
Kwl5ID0gc3JjX3kgLyB2c3ViOwogCWludGVsX2FkZF9mYl9vZmZzZXRzKCZ4LCAmeSwgcGxhbmVf
c3RhdGUsIDEpOwogCW9mZnNldCA9IGludGVsX3BsYW5lX2NvbXB1dGVfYWxpZ25lZF9vZmZzZXQo
JngsICZ5LCBwbGFuZV9zdGF0ZSwgMSk7CiAKQEAgLTQxNjEsNyArNDI3Miw3IEBAIHN0YXRpYyB1
bnNpZ25lZCBpbnQgc2tsX3BsYW5lX3N0cmlkZV9tdWx0KGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVi
dWZmZXIgKmZiLAogCSAqIFRoZSBzdHJpZGUgaXMgZWl0aGVyIGV4cHJlc3NlZCBhcyBhIG11bHRp
cGxlIG9mIDY0IGJ5dGVzIGNodW5rcyBmb3IKIAkgKiBsaW5lYXIgYnVmZmVycyBvciBpbiBudW1i
ZXIgb2YgdGlsZXMgZm9yIHRpbGVkIGJ1ZmZlcnMuCiAJICovCi0JaWYgKGZiLT5tb2RpZmllciA9
PSBEUk1fRk9STUFUX01PRF9MSU5FQVIpCisJaWYgKGlzX3N1cmZhY2VfbGluZWFyKGZiLCBjb2xv
cl9wbGFuZSkpCiAJCXJldHVybiA2NDsKIAllbHNlIGlmIChkcm1fcm90YXRpb25fOTBfb3JfMjcw
KHJvdGF0aW9uKSkKIAkJcmV0dXJuIGludGVsX3RpbGVfaGVpZ2h0KGZiLCBjb2xvcl9wbGFuZSk7
CkBAIC00Mjg5LDYgKzQ0MDAsMTAgQEAgc3RhdGljIHUzMiBza2xfcGxhbmVfY3RsX3RpbGluZyh1
NjQgZmJfbW9kaWZpZXIpCiAJCXJldHVybiBQTEFORV9DVExfVElMRURfWTsKIAljYXNlIEk5MTVf
Rk9STUFUX01PRF9ZX1RJTEVEX0NDUzoKIAkJcmV0dXJuIFBMQU5FX0NUTF9USUxFRF9ZIHwgUExB
TkVfQ1RMX1JFTkRFUl9ERUNPTVBSRVNTSU9OX0VOQUJMRTsKKwljYXNlIEk5MTVfRk9STUFUX01P
RF9ZX1RJTEVEX0dFTjEyX1JDX0NDUzoKKwkJcmV0dXJuIFBMQU5FX0NUTF9USUxFRF9ZIHwKKwkJ
ICAgICAgIFBMQU5FX0NUTF9SRU5ERVJfREVDT01QUkVTU0lPTl9FTkFCTEUgfAorCQkgICAgICAg
UExBTkVfQ1RMX0NMRUFSX0NPTE9SX0RJU0FCTEU7CiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWWZf
VElMRUQ6CiAJCXJldHVybiBQTEFORV9DVExfVElMRURfWUY7CiAJY2FzZSBJOTE1X0ZPUk1BVF9N
T0RfWWZfVElMRURfQ0NTOgpAQCAtMTAwMjQsNyArMTAxMzksOSBAQCBza3lsYWtlX2dldF9pbml0
aWFsX3BsYW5lX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAljYXNlIFBMQU5FX0NU
TF9USUxFRF9ZOgogCQlwbGFuZV9jb25maWctPnRpbGluZyA9IEk5MTVfVElMSU5HX1k7CiAJCWlm
ICh2YWwgJiBQTEFORV9DVExfUkVOREVSX0RFQ09NUFJFU1NJT05fRU5BQkxFKQotCQkJZmItPm1v
ZGlmaWVyID0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfQ0NTOworCQkJZmItPm1vZGlmaWVyID0g
SU5URUxfR0VOKGRldl9wcml2KSA+PSAxMiA/CisJCQkJSTkxNV9GT1JNQVRfTU9EX1lfVElMRURf
R0VOMTJfUkNfQ0NTIDoKKwkJCQlJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1M7CiAJCWVsc2UK
IAkJCWZiLT5tb2RpZmllciA9IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEOwogCQlicmVhazsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCmluZGV4IDgzOTQ1MDJi
MDkyZC4uNjdhOTAwNTk5MDBmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX3Nwcml0ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfc3ByaXRlLmMKQEAgLTU4Myw2ICs1ODMsNyBAQCBza2xfcHJvZ3JhbV9wbGFuZShzdHJ1Y3Qg
aW50ZWxfcGxhbmUgKnBsYW5lLAogCWNvbnN0IHN0cnVjdCBkcm1faW50ZWxfc3ByaXRlX2NvbG9y
a2V5ICprZXkgPSAmcGxhbmVfc3RhdGUtPmNrZXk7CiAJdTMyIHN1cmZfYWRkciA9IHBsYW5lX3N0
YXRlLT5jb2xvcl9wbGFuZVtjb2xvcl9wbGFuZV0ub2Zmc2V0OwogCXUzMiBzdHJpZGUgPSBza2xf
cGxhbmVfc3RyaWRlKHBsYW5lX3N0YXRlLCBjb2xvcl9wbGFuZSk7CisJdTMyIGF1eF9kaXN0ID0g
cGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzFdLm9mZnNldCAtIHN1cmZfYWRkcjsKIAl1MzIgYXV4
X3N0cmlkZSA9IHNrbF9wbGFuZV9zdHJpZGUocGxhbmVfc3RhdGUsIDEpOwogCWludCBjcnRjX3gg
PSBwbGFuZV9zdGF0ZS0+dWFwaS5kc3QueDE7CiAJaW50IGNydGNfeSA9IHBsYW5lX3N0YXRlLT51
YXBpLmRzdC55MTsKQEAgLTYyNCw4ICs2MjUsMTAgQEAgc2tsX3Byb2dyYW1fcGxhbmUoc3RydWN0
IGludGVsX3BsYW5lICpwbGFuZSwKIAlJOTE1X1dSSVRFX0ZXKFBMQU5FX1NUUklERShwaXBlLCBw
bGFuZV9pZCksIHN0cmlkZSk7CiAJSTkxNV9XUklURV9GVyhQTEFORV9QT1MocGlwZSwgcGxhbmVf
aWQpLCAoY3J0Y195IDw8IDE2KSB8IGNydGNfeCk7CiAJSTkxNV9XUklURV9GVyhQTEFORV9TSVpF
KHBpcGUsIHBsYW5lX2lkKSwgKHNyY19oIDw8IDE2KSB8IHNyY193KTsKLQlJOTE1X1dSSVRFX0ZX
KFBMQU5FX0FVWF9ESVNUKHBpcGUsIHBsYW5lX2lkKSwKLQkJICAgICAgKHBsYW5lX3N0YXRlLT5j
b2xvcl9wbGFuZVsxXS5vZmZzZXQgLSBzdXJmX2FkZHIpIHwgYXV4X3N0cmlkZSk7CisKKwlpZiAo
SU5URUxfR0VOKGRldl9wcml2KSA8IDEyKQorCQlhdXhfZGlzdCB8PSBhdXhfc3RyaWRlOworCUk5
MTVfV1JJVEVfRlcoUExBTkVfQVVYX0RJU1QocGlwZSwgcGxhbmVfaWQpLCBhdXhfZGlzdCk7CiAK
IAlpZiAoaWNsX2lzX2hkcl9wbGFuZShkZXZfcHJpdiwgcGxhbmVfaWQpKQogCQlJOTE1X1dSSVRF
X0ZXKFBMQU5FX0NVU19DVEwocGlwZSwgcGxhbmVfaWQpLCBwbGFuZV9zdGF0ZS0+Y3VzX2N0bCk7
CkBAIC0yMTAyLDcgKzIxMDUsOCBAQCBzdGF0aWMgaW50IHNrbF9wbGFuZV9jaGVja19mYihjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkgICAgKGZiLT5tb2RpZmll
ciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRCB8fAogCSAgICAgZmItPm1vZGlmaWVyID09IEk5
MTVfRk9STUFUX01PRF9ZZl9USUxFRCB8fAogCSAgICAgZmItPm1vZGlmaWVyID09IEk5MTVfRk9S
TUFUX01PRF9ZX1RJTEVEX0NDUyB8fAotCSAgICAgZmItPm1vZGlmaWVyID09IEk5MTVfRk9STUFU
X01PRF9ZZl9USUxFRF9DQ1MpKSB7CisJICAgICBmYi0+bW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRf
TU9EX1lmX1RJTEVEX0NDUyB8fAorCSAgICAgZmItPm1vZGlmaWVyID09IEk5MTVfRk9STUFUX01P
RF9ZX1RJTEVEX0dFTjEyX1JDX0NDUykpIHsKIAkJRFJNX0RFQlVHX0tNUygiWS9ZZiB0aWxpbmcg
bm90IHN1cHBvcnRlZCBpbiBJRi1JRCBtb2RlXG4iKTsKIAkJcmV0dXJuIC1FSU5WQUw7CiAJfQpA
QCAtMjU3Myw3ICsyNTc3LDggQEAgc3RhdGljIGNvbnN0IHU2NCBza2xfcGxhbmVfZm9ybWF0X21v
ZGlmaWVyc19jY3NbXSA9IHsKIAlEUk1fRk9STUFUX01PRF9JTlZBTElECiB9OwogCi1zdGF0aWMg
Y29uc3QgdTY0IGdlbjEyX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfbm9jY3NbXSA9IHsKK3N0YXRp
YyBjb25zdCB1NjQgZ2VuMTJfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19jY3NbXSA9IHsKKwlJOTE1
X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1MsCiAJSTkxNV9GT1JNQVRfTU9EX1lfVElM
RUQsCiAJSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQsCiAJRFJNX0ZPUk1BVF9NT0RfTElORUFSLApA
QCAtMjc0NCw2ICsyNzQ5LDcgQEAgc3RhdGljIGJvb2wgZ2VuMTJfcGxhbmVfZm9ybWF0X21vZF9z
dXBwb3J0ZWQoc3RydWN0IGRybV9wbGFuZSAqX3BsYW5lLAogCWNhc2UgRFJNX0ZPUk1BVF9NT0Rf
TElORUFSOgogCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1hfVElMRUQ6CiAJY2FzZSBJOTE1X0ZPUk1B
VF9NT0RfWV9USUxFRDoKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0ND
UzoKIAkJYnJlYWs7CiAJZGVmYXVsdDoKIAkJcmV0dXJuIGZhbHNlOwpAQCAtMjc1NCw2ICsyNzYw
LDkgQEAgc3RhdGljIGJvb2wgZ2VuMTJfcGxhbmVfZm9ybWF0X21vZF9zdXBwb3J0ZWQoc3RydWN0
IGRybV9wbGFuZSAqX3BsYW5lLAogCWNhc2UgRFJNX0ZPUk1BVF9YQkdSODg4ODoKIAljYXNlIERS
TV9GT1JNQVRfQVJHQjg4ODg6CiAJY2FzZSBEUk1fRk9STUFUX0FCR1I4ODg4OgorCQlpZiAoaXNf
Y2NzX21vZGlmaWVyKG1vZGlmaWVyKSkKKwkJCXJldHVybiB0cnVlOworCQkvKiBmYWxsIHRocm91
Z2ggKi8KIAljYXNlIERSTV9GT1JNQVRfUkdCNTY1OgogCWNhc2UgRFJNX0ZPUk1BVF9YUkdCMjEw
MTAxMDoKIAljYXNlIERSTV9GT1JNQVRfWEJHUjIxMDEwMTA6CkBAIC0yOTYzLDEzICsyOTcyLDEx
IEBAIHNrbF91bml2ZXJzYWxfcGxhbmVfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiwKIAkJZm9ybWF0cyA9IHNrbF9nZXRfcGxhbmVfZm9ybWF0cyhkZXZfcHJpdiwgcGlw
ZSwKIAkJCQkJCXBsYW5lX2lkLCAmbnVtX2Zvcm1hdHMpOwogCisJcGxhbmUtPmhhc19jY3MgPSBz
a2xfcGxhbmVfaGFzX2NjcyhkZXZfcHJpdiwgcGlwZSwgcGxhbmVfaWQpOwogCWlmIChJTlRFTF9H
RU4oZGV2X3ByaXYpID49IDEyKSB7Ci0JCS8qIFRPRE86IEltcGxlbWVudCBzdXBwb3J0IGZvciBn
ZW4tMTIgQ0NTIG1vZGlmaWVycyAqLwotCQlwbGFuZS0+aGFzX2NjcyA9IGZhbHNlOwotCQltb2Rp
ZmllcnMgPSBnZW4xMl9wbGFuZV9mb3JtYXRfbW9kaWZpZXJzX25vY2NzOworCQltb2RpZmllcnMg
PSBnZW4xMl9wbGFuZV9mb3JtYXRfbW9kaWZpZXJzX2NjczsKIAkJcGxhbmVfZnVuY3MgPSAmZ2Vu
MTJfcGxhbmVfZnVuY3M7CiAJfSBlbHNlIHsKLQkJcGxhbmUtPmhhc19jY3MgPSBza2xfcGxhbmVf
aGFzX2NjcyhkZXZfcHJpdiwgcGlwZSwgcGxhbmVfaWQpOwogCQlpZiAocGxhbmUtPmhhc19jY3Mp
CiAJCQltb2RpZmllcnMgPSBza2xfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19jY3M7CiAJCWVsc2UK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmggYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3JlZy5oCmluZGV4IGNiYjQ2ODlhZjQzMi4uYmJmZWRlYjAwYjdmIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfcmVnLmgKQEAgLTY4MDAsNiArNjgwMCw3IEBAIGVudW0gewogI2Rl
ZmluZSAgIFBMQU5FX0NUTF9ZVVY0MjJfVllVWQkJCSgzIDw8IDE2KQogI2RlZmluZSAgIFBMQU5F
X0NUTF9SRU5ERVJfREVDT01QUkVTU0lPTl9FTkFCTEUJKDEgPDwgMTUpCiAjZGVmaW5lICAgUExB
TkVfQ1RMX1RSSUNLTEVfRkVFRF9ESVNBQkxFCSgxIDw8IDE0KQorI2RlZmluZSAgIFBMQU5FX0NU
TF9DTEVBUl9DT0xPUl9ESVNBQkxFCQkoMSA8PCAxMykgLyogVEdMKyAqLwogI2RlZmluZSAgIFBM
QU5FX0NUTF9QTEFORV9HQU1NQV9ESVNBQkxFCQkoMSA8PCAxMykgLyogUHJlLUdMSyAqLwogI2Rl
ZmluZSAgIFBMQU5FX0NUTF9USUxFRF9NQVNLCQkJKDB4NyA8PCAxMCkKICNkZWZpbmUgICBQTEFO
RV9DVExfVElMRURfTElORUFSCQkoMCA8PCAxMCkKLS0gCjIuMjIuMAoKX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJ
bnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Au
b3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 6E42026DED
	for <lists+intel-gfx@lfdr.de>; Wed, 22 May 2019 21:45:37 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id CDB7989007;
	Wed, 22 May 2019 19:45:35 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 292AB88FFB;
 Wed, 22 May 2019 19:45:34 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16645938-1500050 
 for multiple; Wed, 22 May 2019 20:45:17 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 22 May 2019 20:45:16 +0100
Message-Id: <20190522194516.17361-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t] i915/gem_exec_fence: Replace open-coded
 recursive batch with igt_spin_t
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org, Matthew Auld <matthew.auld@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIG9ubHkgZGV0YWlsIG9mIG5vdGUgaGVyZSB3YXMgdGhhdCB3ZSB3ZXJlIGNyZWF0aW5nIGEg
ZmVuY2UgZnJvbSB0aGUKcmVjdXJzaXZlIGJhdGNoLCBub3cgc3VwcG9ydGVkIGJ5IGlndF9zcGlu
X3QgKHRoYW5rcyBUdnJ0a28pLgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0Bj
aHJpcy13aWxzb24uY28udWs+CkNjOiBUdnJ0a28gVXJzdWxpbiA8dHZydGtvLnVyc3VsaW5AaW50
ZWwuY29tPgpDYzogTWF0dGhldyBBdWxkIDxtYXR0aGV3LmF1bGRAaW50ZWwuY29tPgpSZXZpZXdl
ZC1ieTogTWF0dGhldyBBdWxkIDxtYXR0aGV3LmF1bGRAaW50ZWwuY29tPgotLS0KIGxpYi9pZ3Rf
Y29yZS5jICAgICAgICAgICAgICB8ICAxICsKIGxpYi9pZ3RfZHVtbXlsb2FkLmMgICAgICAgICB8
ICA1ICsrKwogbGliL2lndF9kdW1teWxvYWQuaCAgICAgICAgIHwgIDEgKwogdGVzdHMvaTkxNS9n
ZW1fZXhlY19mZW5jZS5jIHwgNzcgKysrKysrKystLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LQogNCBmaWxlcyBjaGFuZ2VkLCAyMiBpbnNlcnRpb25zKCspLCA2MiBkZWxldGlvbnMoLSkKCmRp
ZmYgLS1naXQgYS9saWIvaWd0X2NvcmUuYyBiL2xpYi9pZ3RfY29yZS5jCmluZGV4IGQ1ZDRmY2Uy
Ni4uM2FlMTFjZWYwIDEwMDY0NAotLS0gYS9saWIvaWd0X2NvcmUuYworKysgYi9saWIvaWd0X2Nv
cmUuYwpAQCAtMTczMSw2ICsxNzMxLDcgQEAgYm9vbCBfX2lndF9mb3JrKHZvaWQpCiAJCWV4aXRf
aGFuZGxlcl9jb3VudCA9IDA7CiAJCXJlc2V0X2hlbHBlcl9wcm9jZXNzX2xpc3QoKTsKIAkJb29t
X2FkanVzdF9mb3JfZG9vbSgpOworCQlpZ3RfdW5jbG9uZV9zcGlucygpOwogCiAJCXJldHVybiB0
cnVlOwogCWRlZmF1bHQ6CmRpZmYgLS1naXQgYS9saWIvaWd0X2R1bW15bG9hZC5jIGIvbGliL2ln
dF9kdW1teWxvYWQuYwppbmRleCAxZTExY2NkM2QuLmQxNTIxZjlhMCAxMDA2NDQKLS0tIGEvbGli
L2lndF9kdW1teWxvYWQuYworKysgYi9saWIvaWd0X2R1bW15bG9hZC5jCkBAIC00NjQsNiArNDY0
LDExIEBAIHZvaWQgaWd0X3Rlcm1pbmF0ZV9zcGlucyh2b2lkKQogCXB0aHJlYWRfbXV0ZXhfdW5s
b2NrKCZsaXN0X2xvY2spOwogfQogCit2b2lkIGlndF91bmNsb25lX3NwaW5zKHZvaWQpCit7CisJ
aWd0X2xpc3RfaW5pdCgmc3Bpbl9saXN0KTsKK30KKwogc3RhdGljIHVpbnQzMl90IHBsdWdfdmdl
bV9oYW5kbGUoc3RydWN0IGlndF9jb3JrICpjb3JrLCBpbnQgZmQpCiB7CiAJc3RydWN0IHZnZW1f
Ym8gYm87CmRpZmYgLS1naXQgYS9saWIvaWd0X2R1bW15bG9hZC5oIGIvbGliL2lndF9kdW1teWxv
YWQuaAppbmRleCA2MWE5ZjJmY2YuLmI5ZWNhMzUxOSAxMDA2NDQKLS0tIGEvbGliL2lndF9kdW1t
eWxvYWQuaAorKysgYi9saWIvaWd0X2R1bW15bG9hZC5oCkBAIC05Miw2ICs5Miw3IEBAIHN0YXRp
YyBpbmxpbmUgdm9pZCBpZ3Rfc3Bpbl9idXN5d2FpdF91bnRpbF9zdGFydGVkKGlndF9zcGluX3Qg
KnNwaW4pCiB9CiAKIHZvaWQgaWd0X3Rlcm1pbmF0ZV9zcGlucyh2b2lkKTsKK3ZvaWQgaWd0X3Vu
Y2xvbmVfc3BpbnModm9pZCk7CiAKIGVudW0gaWd0X2NvcmtfdHlwZSB7CiAJQ09SS19TWU5DX0ZE
ID0gMSwKZGlmZiAtLWdpdCBhL3Rlc3RzL2k5MTUvZ2VtX2V4ZWNfZmVuY2UuYyBiL3Rlc3RzL2k5
MTUvZ2VtX2V4ZWNfZmVuY2UuYwppbmRleCA4MTIwZjhiNTYuLjBiZWZiNTRmOCAxMDA2NDQKLS0t
IGEvdGVzdHMvaTkxNS9nZW1fZXhlY19mZW5jZS5jCisrKyBiL3Rlc3RzL2k5MTUvZ2VtX2V4ZWNf
ZmVuY2UuYwpAQCAtMzE3LDY4ICszMTcsMjIgQEAgc3RhdGljIHZvaWQgdGVzdF9mZW5jZV9idXN5
X2FsbChpbnQgZmQsIHVuc2lnbmVkIGZsYWdzKQogCiBzdGF0aWMgdm9pZCB0ZXN0X2ZlbmNlX2F3
YWl0KGludCBmZCwgdW5zaWduZWQgcmluZywgdW5zaWduZWQgZmxhZ3MpCiB7Ci0JY29uc3QgaW50
IGdlbiA9IGludGVsX2dlbihpbnRlbF9nZXRfZHJtX2RldmlkKGZkKSk7Ci0Jc3RydWN0IGRybV9p
OTE1X2dlbV9leGVjX29iamVjdDIgb2JqOwotCXN0cnVjdCBkcm1faTkxNV9nZW1fcmVsb2NhdGlv
bl9lbnRyeSByZWxvYzsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyIGV4ZWNidWY7
CiAJdWludDMyX3Qgc2NyYXRjaCA9IGdlbV9jcmVhdGUoZmQsIDQwOTYpOwotCXVpbnQzMl90ICpi
YXRjaCwgKm91dDsKKwlpZ3Rfc3Bpbl90ICpzcGluOwogCXVuc2lnbmVkIGVuZ2luZTsKLQlpbnQg
ZmVuY2UsIGk7CisJdWludDMyX3QgKm91dDsKKwlpbnQgaTsKIAogCWlndF9yZXF1aXJlKGdlbV9j
YW5fc3RvcmVfZHdvcmQoZmQsIDApKTsKIAotCW1lbXNldCgmZXhlY2J1ZiwgMCwgc2l6ZW9mKGV4
ZWNidWYpKTsKLQlleGVjYnVmLmJ1ZmZlcnNfcHRyID0gdG9fdXNlcl9wb2ludGVyKCZvYmopOwot
CWV4ZWNidWYuYnVmZmVyX2NvdW50ID0gMTsKLQlleGVjYnVmLmZsYWdzID0gcmluZyB8IExPQ0FM
X0VYRUNfRkVOQ0VfT1VUOwotCi0JbWVtc2V0KCZvYmosIDAsIHNpemVvZihvYmopKTsKLQlvYmou
aGFuZGxlID0gZ2VtX2NyZWF0ZShmZCwgNDA5Nik7Ci0KLQlvYmoucmVsb2NzX3B0ciA9IHRvX3Vz
ZXJfcG9pbnRlcigmcmVsb2MpOwotCW9iai5yZWxvY2F0aW9uX2NvdW50ID0gMTsKLQltZW1zZXQo
JnJlbG9jLCAwLCBzaXplb2YocmVsb2MpKTsKLQogCW91dCA9IGdlbV9tbWFwX193YyhmZCwgc2Ny
YXRjaCwgMCwgNDA5NiwgUFJPVF9XUklURSk7Ci0JZ2VtX3NldF9kb21haW4oZmQsIG9iai5oYW5k
bGUsCi0JCQlJOTE1X0dFTV9ET01BSU5fR1RULCBJOTE1X0dFTV9ET01BSU5fR1RUKTsKLQotCWJh
dGNoID0gZ2VtX21tYXBfX3djKGZkLCBvYmouaGFuZGxlLCAwLCA0MDk2LCBQUk9UX1dSSVRFKTsK
LQlnZW1fc2V0X2RvbWFpbihmZCwgb2JqLmhhbmRsZSwKKwlnZW1fc2V0X2RvbWFpbihmZCwgc2Ny
YXRjaCwKIAkJCUk5MTVfR0VNX0RPTUFJTl9HVFQsIEk5MTVfR0VNX0RPTUFJTl9HVFQpOwogCi0J
cmVsb2MudGFyZ2V0X2hhbmRsZSA9IG9iai5oYW5kbGU7IC8qIHJlY3Vyc2UgKi8KLQlyZWxvYy5w
cmVzdW1lZF9vZmZzZXQgPSAwOwotCXJlbG9jLm9mZnNldCA9IHNpemVvZih1aW50MzJfdCk7Ci0J
cmVsb2MuZGVsdGEgPSAwOwotCXJlbG9jLnJlYWRfZG9tYWlucyA9IEk5MTVfR0VNX0RPTUFJTl9D
T01NQU5EOwotCXJlbG9jLndyaXRlX2RvbWFpbiA9IDA7Ci0KLQlpID0gMDsKLQliYXRjaFtpXSA9
IE1JX0JBVENIX0JVRkZFUl9TVEFSVDsKLQlpZiAoZ2VuID49IDgpIHsKLQkJYmF0Y2hbaV0gfD0g
MSA8PCA4IHwgMTsKLQkJYmF0Y2hbKytpXSA9IDA7Ci0JCWJhdGNoWysraV0gPSAwOwotCX0gZWxz
ZSBpZiAoZ2VuID49IDYpIHsKLQkJYmF0Y2hbaV0gfD0gMSA8PCA4OwotCQliYXRjaFsrK2ldID0g
MDsKLQl9IGVsc2UgewotCQliYXRjaFtpXSB8PSAyIDw8IDY7Ci0JCWJhdGNoWysraV0gPSAwOwot
CQlpZiAoZ2VuIDwgNCkgewotCQkJYmF0Y2hbaV0gfD0gMTsKLQkJCXJlbG9jLmRlbHRhID0gMTsK
LQkJfQotCX0KLQlpKys7Ci0KLQlleGVjYnVmLnJzdmQyID0gLTE7Ci0JZ2VtX2V4ZWNidWZfd3Io
ZmQsICZleGVjYnVmKTsKLQlnZW1fY2xvc2UoZmQsIG9iai5oYW5kbGUpOwotCWZlbmNlID0gZXhl
Y2J1Zi5yc3ZkMiA+PiAzMjsKLQlpZ3RfYXNzZXJ0KGZlbmNlICE9IC0xKTsKKwlzcGluID0gaWd0
X3NwaW5fbmV3KGZkLAorCQkJICAgIC5lbmdpbmUgPSByaW5nLAorCQkJICAgIC5mbGFncyA9IElH
VF9TUElOX0ZFTkNFX09VVCk7CisJaWd0X2Fzc2VydChzcGluLT5vdXRfZmVuY2UgIT0gLTEpOwog
CiAJaSA9IDA7CiAJZm9yX2VhY2hfcGh5c2ljYWxfZW5naW5lKGZkLCBlbmdpbmUpIHsKQEAgLTM4
NiwyNyArMzQwLDI0IEBAIHN0YXRpYyB2b2lkIHRlc3RfZmVuY2VfYXdhaXQoaW50IGZkLCB1bnNp
Z25lZCByaW5nLCB1bnNpZ25lZCBmbGFncykKIAkJCWNvbnRpbnVlOwogCiAJCWlmIChmbGFncyAm
IE5PTkJMT0NLKSB7Ci0JCQlzdG9yZShmZCwgZW5naW5lLCBmZW5jZSwgc2NyYXRjaCwgaSk7CisJ
CQlzdG9yZShmZCwgZW5naW5lLCBzcGluLT5vdXRfZmVuY2UsIHNjcmF0Y2gsIGkpOwogCQl9IGVs
c2UgewogCQkJaWd0X2ZvcmsoY2hpbGQsIDEpCi0JCQkJc3RvcmUoZmQsIGVuZ2luZSwgZmVuY2Us
IHNjcmF0Y2gsIGkpOworCQkJCXN0b3JlKGZkLCBlbmdpbmUsIHNwaW4tPm91dF9mZW5jZSwgc2Ny
YXRjaCwgaSk7CiAJCX0KIAogCQlpKys7CiAJfQotCWNsb3NlKGZlbmNlKTsKIAogCXNsZWVwKDEp
OwogCiAJLyogQ2hlY2sgZm9yIGludmFsaWRseSBjb21wbGV0aW5nIHRoZSB0YXNrIGVhcmx5ICov
CisJaWd0X2Fzc2VydChmZW5jZV9idXN5KHNwaW4tPm91dF9mZW5jZSkpOwogCWZvciAoaW50IG4g
PSAwOyBuIDwgaTsgbisrKQogCQlpZ3RfYXNzZXJ0X2VxX3UzMihvdXRbbl0sIDApOwogCi0JaWYg
KChmbGFncyAmIEhBTkcpID09IDApIHsKLQkJKmJhdGNoID0gTUlfQkFUQ0hfQlVGRkVSX0VORDsK
LQkJX19zeW5jX3N5bmNocm9uaXplKCk7Ci0JfQotCW11bm1hcChiYXRjaCwgNDA5Nik7CisJaWYg
KChmbGFncyAmIEhBTkcpID09IDApCisJCWlndF9zcGluX2VuZChzcGluKTsKIAogCWlndF93YWl0
Y2hpbGRyZW4oKTsKIApAQCAtNDE0LDYgKzM2NSw4IEBAIHN0YXRpYyB2b2lkIHRlc3RfZmVuY2Vf
YXdhaXQoaW50IGZkLCB1bnNpZ25lZCByaW5nLCB1bnNpZ25lZCBmbGFncykKIAl3aGlsZSAoaS0t
KQogCQlpZ3RfYXNzZXJ0X2VxX3UzMihvdXRbaV0sIGkpOwogCW11bm1hcChvdXQsIDQwOTYpOwor
CisJaWd0X3NwaW5fZnJlZShmZCwgc3Bpbik7CiAJZ2VtX2Nsb3NlKGZkLCBzY3JhdGNoKTsKIH0K
IAotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5v
cmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1n
Zng=

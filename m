Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C29DBB8F26
	for <lists+intel-gfx@lfdr.de>; Fri, 20 Sep 2019 13:43:06 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8396E6FCA5;
	Fri, 20 Sep 2019 11:43:02 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl
 [IPv6:2a02:2308::216:3eff:fe92:dfa3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id BCA7E6FC9E
 for <intel-gfx@lists.freedesktop.org>; Fri, 20 Sep 2019 11:42:43 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 20 Sep 2019 13:42:32 +0200
Message-Id: <20190920114235.22411-20-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190920114235.22411-1-maarten.lankhorst@linux.intel.com>
References: <20190920114235.22411-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 20/23] drm/i915: Make prepare_plane_fb() work
 with bigjoiner planes
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U2ltaWxhciB0byBwbGFuZSBwcm9ncmFtbWluZywgd2UgbmVlZCBhIHNlcGFyYXRlIG1hc3Rlcl9w
bGFuZV9zdGF0ZSBmcm9tCndoaWNoIHdlIHdpbGwgcmVhZCBhbGwgYXRvbWljIHByb3BlcnRpZXMs
IGFuZCBwbGFuZV9zdGF0ZSBmb3IgdGhlIHJlYWwKY29vcmRpbmF0ZXMuCgpBbHRob3VnaCB3ZSBh
ZGQgYWxsIHBsYW5lcyB3aXRoIGljbF9hZGRfbGlua2VkX3BsYW5lcygpLAppY2xfY2hlY2tfbnYx
Ml9wbGFuZXMoKSBtYXkgYWRkIGV4dHJhIFkgcGxhbmVzIG9uIHRoZSBzbGF2ZSBDUlRDLgpGb3Ig
dGhvc2UgcGxhbmVzLCB0aGUgY29ycmVzcG9uZGluZyBwbGFuZXMgb24gdGhlIG1hc3RlciBDUlRD
CmFyZSBub3QgYWRkZWQsIHNvIHdlIGhhdmUgdG8gYmUgc2xpZ2h0bHkgbW9yZSBjYXJlZnVsIGlu
IHRoYXQgY2FzZS4KClNpZ25lZC1vZmYtYnk6IE1hYXJ0ZW4gTGFua2hvcnN0IDxtYWFydGVuLmxh
bmtob3JzdEBsaW51eC5pbnRlbC5jb20+Ci0tLQogLi4uL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2F0b21pY19wbGFuZS5jIHwgIDIgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9hdG9taWNfcGxhbmUuaCB8ICA0ICsrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2Rpc3BsYXkuYyAgfCA3MSArKysrKysrKysrKy0tLS0tLS0tCiAzIGZpbGVzIGNoYW5nZWQs
IDQ3IGluc2VydGlvbnMoKyksIDMwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRvbWljX3BsYW5lLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19wbGFuZS5jCmluZGV4IGEwYzFkMTY5NmM4Yy4u
OWZjYTllOTBhZjU4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2F0b21pY19wbGFuZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfYXRvbWljX3BsYW5lLmMKQEAgLTIwNCw3ICsyMDQsNyBAQCBzdHJ1Y3QgaW50ZWxfY3J0YyAq
CiBpbnRlbF9wbGFuZV9nZXRfY3J0Y19mcm9tX3N0YXRlcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0
YXRlICpzdGF0ZSwKIAkJCQkgY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpvbGRfcGxh
bmVfc3RhdGUsCiAJCQkJIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqbmV3X3BsYW5l
X3N0YXRlKQotICB7Cit7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9f
aTkxNShzdGF0ZS0+YmFzZS5kZXYpOwogCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUgPSB0b19p
bnRlbF9wbGFuZShuZXdfcGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOwogCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pY19wbGFuZS5oIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWNfcGxhbmUuaAppbmRleCBjOThjY2Y4
MTE0YzMuLmQ3ODlhMTg4NjkwOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9hdG9taWNfcGxhbmUuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2F0b21pY19wbGFuZS5oCkBAIC01Miw1ICs1Miw5IEBAIGludCBpbnRlbF9hdG9t
aWNfcGxhbmVfY2hlY2tfc2NhbGluZyhzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSwKIAkJCQkgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqbWFzdGVyX3BsYW5l
X3N0YXRlLAogCQkJCSAgICAgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwK
IAkJCQkgICAgIGludCBtaW5fc2NhbGUsIGludCBtYXhfc2NhbGUpOworc3RydWN0IGludGVsX2Ny
dGMgKgoraW50ZWxfcGxhbmVfZ2V0X2NydGNfZnJvbV9zdGF0ZXMoc3RydWN0IGludGVsX2F0b21p
Y19zdGF0ZSAqc3RhdGUsCisJCQkJIGNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqb2xk
X3BsYW5lX3N0YXRlLAorCQkJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm5ld19w
bGFuZV9zdGF0ZSk7CiAKICNlbmRpZiAvKiBfX0lOVEVMX0FUT01JQ19QTEFORV9IX18gKi8KZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggNjkwYzNk
MTBjZTQ0Li44ZTFmYWIwZmU3YjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGlzcGxheS5jCkBAIC0xNDkyOSwxMSArMTQ5MjksMTIgQEAgc3RhdGljIHZvaWQgYWRk
X3Jwc19ib29zdF9hZnRlcl92Ymxhbmsoc3RydWN0IGRybV9jcnRjICpjcnRjLAogCWFkZF93YWl0
X3F1ZXVlKGRybV9jcnRjX3ZibGFua193YWl0cXVldWUoY3J0YyksICZ3YWl0LT53YWl0KTsKIH0K
IAotc3RhdGljIGludCBpbnRlbF9wbGFuZV9waW5fZmIoc3RydWN0IGludGVsX3BsYW5lX3N0YXRl
ICpwbGFuZV9zdGF0ZSkKK3N0YXRpYyBpbnQgaW50ZWxfcGxhbmVfcGluX2ZiKGNvbnN0IHN0cnVj
dCBpbnRlbF9wbGFuZV9zdGF0ZSAqbWFzdGVyX3BsYW5lX3N0YXRlLAorCQkJICAgICAgc3RydWN0
IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUg
KnBsYW5lID0gdG9faW50ZWxfcGxhbmUocGxhbmVfc3RhdGUtPmJhc2UucGxhbmUpOwogCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmJhc2UuZGV2KTsK
LQlzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiA9IHBsYW5lX3N0YXRlLT5iYXNlLmZiOworCXN0
cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gbWFzdGVyX3BsYW5lX3N0YXRlLT5iYXNlLmZiOwog
CXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCiAJaWYgKHBsYW5lLT5pZCA9PSBQTEFORV9DVVJTT1Ig
JiYKQEAgLTE0OTkyLDIxICsxNDk5MywyNyBAQCBzdGF0aWMgdm9pZCBmYl9vYmpfYnVtcF9yZW5k
ZXJfcHJpb3JpdHkoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKICAqIFJldHVybnMg
MCBvbiBzdWNjZXNzLCBuZWdhdGl2ZSBlcnJvciBjb2RlIG9uIGZhaWx1cmUuCiAgKi8KIGludAot
aW50ZWxfcHJlcGFyZV9wbGFuZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKLQkJICAgICAg
IHN0cnVjdCBkcm1fcGxhbmVfc3RhdGUgKm5ld19zdGF0ZSkKK2ludGVsX3ByZXBhcmVfcGxhbmVf
ZmIoc3RydWN0IGRybV9wbGFuZSAqZHJtX3BsYW5lLAorCQkgICAgICAgc3RydWN0IGRybV9wbGFu
ZV9zdGF0ZSAqX25ld19wbGFuZV9zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
ICppbnRlbF9zdGF0ZSA9Ci0JCXRvX2ludGVsX2F0b21pY19zdGF0ZShuZXdfc3RhdGUtPnN0YXRl
KTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5k
ZXYpOwotCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gbmV3X3N0YXRlLT5mYjsKLQlzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gaW50ZWxfZmJfb2JqKGZiKTsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2xkX29iaiA9IGludGVsX2ZiX29iaihwbGFuZS0+c3RhdGUt
PmZiKTsKKwlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lID0gdG9faW50ZWxfcGxhbmUoZHJtX3Bs
YW5lKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5l
LT5iYXNlLmRldik7CisJc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUgPQorCQl0b19p
bnRlbF9hdG9taWNfc3RhdGUoX25ld19wbGFuZV9zdGF0ZS0+c3RhdGUpOworCXN0cnVjdCBpbnRl
bF9wbGFuZV9zdGF0ZSAqbmV3X3BsYW5lX3N0YXRlID0gdG9faW50ZWxfcGxhbmVfc3RhdGUoX25l
d19wbGFuZV9zdGF0ZSk7CisJY29uc3Qgc3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpvbGRfcGxh
bmVfc3RhdGUgPQorCQlpbnRlbF9hdG9taWNfZ2V0X29sZF9wbGFuZV9zdGF0ZShzdGF0ZSwgcGxh
bmUpOworCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqbmV3X21hc3Rlcl9wbGFuZV9z
dGF0ZSA9IG5ld19wbGFuZV9zdGF0ZTsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
LCAqb2xkX29iajsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKIAlpbnQgcmV0OwogCi0JaWYg
KG9sZF9vYmopIHsKLQkJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUgPQotCQkJ
aW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShpbnRlbF9zdGF0ZSwKLQkJCQkJCQl0b19p
bnRlbF9jcnRjKHBsYW5lLT5zdGF0ZS0+Y3J0YykpOworCW9sZF9vYmogPSBpbnRlbF9mYl9vYmoo
b2xkX3BsYW5lX3N0YXRlLT5iYXNlLmZiKTsKKwlpZiAoIW9sZF9wbGFuZV9zdGF0ZS0+Ymlnam9p
bmVyX3NsYXZlICYmIG9sZF9vYmopIHsKKwkJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGU7CisKKwkJY3J0YyA9IHRvX2ludGVsX2NydGMob2xkX3BsYW5lX3N0YXRlLT5iYXNlLmNy
dGMpOworCQljcnRjX3N0YXRlID0gaW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0
ZSwgY3J0Yyk7CiAKIAkJLyogQmlnIEhhbW1lciwgd2UgYWxzbyBuZWVkIHRvIGVuc3VyZSB0aGF0
IGFueSBwZW5kaW5nCiAJCSAqIE1JX1dBSVRfRk9SX0VWRU5UIGluc2lkZSBhIHVzZXIgYmF0Y2gg
YnVmZmVyIG9uIHRoZQpAQCAtMTUwMjAsNyArMTUwMjcsNyBAQCBpbnRlbF9wcmVwYXJlX3BsYW5l
X2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCQkgKiBjYW4gc2FmZWx5IGNvbnRpbnVlLgog
CQkgKi8KIAkJaWYgKG5lZWRzX21vZGVzZXQoY3J0Y19zdGF0ZSkpIHsKLQkJCXJldCA9IGk5MTVf
c3dfZmVuY2VfYXdhaXRfcmVzZXJ2YXRpb24oJmludGVsX3N0YXRlLT5jb21taXRfcmVhZHksCisJ
CQlyZXQgPSBpOTE1X3N3X2ZlbmNlX2F3YWl0X3Jlc2VydmF0aW9uKCZzdGF0ZS0+Y29tbWl0X3Jl
YWR5LAogCQkJCQkJCSAgICAgIG9sZF9vYmotPmJhc2UucmVzdiwgTlVMTCwKIAkJCQkJCQkgICAg
ICBmYWxzZSwgMCwKIAkJCQkJCQkgICAgICBHRlBfS0VSTkVMKTsKQEAgLTE1MDI5LDE5ICsxNTAz
NiwxOCBAQCBpbnRlbF9wcmVwYXJlX3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAog
CQl9CiAJfQogCi0JaWYgKG5ld19zdGF0ZS0+ZmVuY2UpIHsgLyogZXhwbGljaXQgZmVuY2luZyAq
LwotCQlyZXQgPSBpOTE1X3N3X2ZlbmNlX2F3YWl0X2RtYV9mZW5jZSgmaW50ZWxfc3RhdGUtPmNv
bW1pdF9yZWFkeSwKLQkJCQkJCSAgICBuZXdfc3RhdGUtPmZlbmNlLAorCWlmIChuZXdfcGxhbmVf
c3RhdGUtPmJhc2UuZmVuY2UpIHsgLyogZXhwbGljaXQgZmVuY2luZyAqLworCQlyZXQgPSBpOTE1
X3N3X2ZlbmNlX2F3YWl0X2RtYV9mZW5jZSgmc3RhdGUtPmNvbW1pdF9yZWFkeSwKKwkJCQkJCSAg
ICBuZXdfcGxhbmVfc3RhdGUtPmJhc2UuZmVuY2UsCiAJCQkJCQkgICAgSTkxNV9GRU5DRV9USU1F
T1VULAogCQkJCQkJICAgIEdGUF9LRVJORUwpOwogCQlpZiAocmV0IDwgMCkKIAkJCXJldHVybiBy
ZXQ7CiAJfQogCi0JaWYgKHRvX2ludGVsX3BsYW5lX3N0YXRlKG5ld19zdGF0ZSktPnBsYW5hcl9z
bGF2ZSkgewotCQlzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgKm5ld19wbGFuZV9zdGF0ZSA9IHRv
X2ludGVsX3BsYW5lX3N0YXRlKG5ld19zdGF0ZSk7CisJaWYgKG5ld19wbGFuZV9zdGF0ZS0+cGxh
bmFyX3NsYXZlKSB7CiAJCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAqbGlua2VkX3Bs
YW5lX3N0YXRlID0KLQkJCWludGVsX2F0b21pY19nZXRfbmV3X3BsYW5lX3N0YXRlKGludGVsX3N0
YXRlLCBuZXdfcGxhbmVfc3RhdGUtPnBsYW5hcl9saW5rZWRfcGxhbmUpOworCQkJaW50ZWxfYXRv
bWljX2dldF9uZXdfcGxhbmVfc3RhdGUoc3RhdGUsIG5ld19wbGFuZV9zdGF0ZS0+cGxhbmFyX2xp
bmtlZF9wbGFuZSk7CiAKIAkJLyoKIAkJICogV2UgYXJlIGEgcGxhbmFyIHNsYXZlLCBWTUEgaXMg
b24gb3VyIHBsYW5hciBtYXN0ZXIsCkBAIC0xNTA1NSw2ICsxNTA2MSwxMiBAQCBpbnRlbF9wcmVw
YXJlX3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCQlyZXR1cm4gMDsKIAl9CiAK
KwlpZiAobmV3X3BsYW5lX3N0YXRlLT5iaWdqb2luZXJfc2xhdmUpCisJCW5ld19tYXN0ZXJfcGxh
bmVfc3RhdGUgPSBpbnRlbF9hdG9taWNfZ2V0X25ld19wbGFuZV9zdGF0ZShzdGF0ZSwgbmV3X3Bs
YW5lX3N0YXRlLT5iaWdqb2luZXJfcGxhbmUpOworCisJY3J0YyA9IGludGVsX3BsYW5lX2dldF9j
cnRjX2Zyb21fc3RhdGVzKHN0YXRlLCBvbGRfcGxhbmVfc3RhdGUsCisJCQkJCQluZXdfcGxhbmVf
c3RhdGUpOworCW9iaiA9IGludGVsX2ZiX29iaihuZXdfbWFzdGVyX3BsYW5lX3N0YXRlLT5iYXNl
LmZiKTsKIAlpZiAoIW9iaikKIAkJcmV0dXJuIDA7CiAKQEAgLTE1MDY4LDcgKzE1MDgwLDcgQEAg
aW50ZWxfcHJlcGFyZV9wbGFuZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAkJcmV0dXJu
IHJldDsKIAl9CiAKLQlyZXQgPSBpbnRlbF9wbGFuZV9waW5fZmIodG9faW50ZWxfcGxhbmVfc3Rh
dGUobmV3X3N0YXRlKSk7CisJcmV0ID0gaW50ZWxfcGxhbmVfcGluX2ZiKG5ld19tYXN0ZXJfcGxh
bmVfc3RhdGUsIG5ld19wbGFuZV9zdGF0ZSk7CiAKIAltdXRleF91bmxvY2soJmRldl9wcml2LT5k
cm0uc3RydWN0X211dGV4KTsKIAlpOTE1X2dlbV9vYmplY3RfdW5waW5fcGFnZXMob2JqKTsKQEAg
LTE1MDc4LDEwICsxNTA5MCwxMCBAQCBpbnRlbF9wcmVwYXJlX3BsYW5lX2ZiKHN0cnVjdCBkcm1f
cGxhbmUgKnBsYW5lLAogCWZiX29ial9idW1wX3JlbmRlcl9wcmlvcml0eShvYmopOwogCWludGVs
X2Zyb250YnVmZmVyX2ZsdXNoKG9iai0+ZnJvbnRidWZmZXIsIE9SSUdJTl9ESVJUWUZCKTsKIAot
CWlmICghbmV3X3N0YXRlLT5mZW5jZSkgeyAvKiBpbXBsaWNpdCBmZW5jaW5nICovCisJaWYgKCFu
ZXdfcGxhbmVfc3RhdGUtPmJhc2UuZmVuY2UpIHsgLyogaW1wbGljaXQgZmVuY2luZyAqLwogCQlz
dHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKIAotCQlyZXQgPSBpOTE1X3N3X2ZlbmNlX2F3YWl0X3Jl
c2VydmF0aW9uKCZpbnRlbF9zdGF0ZS0+Y29tbWl0X3JlYWR5LAorCQlyZXQgPSBpOTE1X3N3X2Zl
bmNlX2F3YWl0X3Jlc2VydmF0aW9uKCZzdGF0ZS0+Y29tbWl0X3JlYWR5LAogCQkJCQkJICAgICAg
b2JqLT5iYXNlLnJlc3YsIE5VTEwsCiAJCQkJCQkgICAgICBmYWxzZSwgSTkxNV9GRU5DRV9USU1F
T1VULAogCQkJCQkJICAgICAgR0ZQX0tFUk5FTCk7CkBAIC0xNTA5MCwxMSArMTUxMDIsMTEgQEAg
aW50ZWxfcHJlcGFyZV9wbGFuZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAogCQlmZW5j
ZSA9IGRtYV9yZXN2X2dldF9leGNsX3JjdShvYmotPmJhc2UucmVzdik7CiAJCWlmIChmZW5jZSkg
ewotCQkJYWRkX3Jwc19ib29zdF9hZnRlcl92YmxhbmsobmV3X3N0YXRlLT5jcnRjLCBmZW5jZSk7
CisJCQlhZGRfcnBzX2Jvb3N0X2FmdGVyX3ZibGFuaygmY3J0Yy0+YmFzZSwgZmVuY2UpOwogCQkJ
ZG1hX2ZlbmNlX3B1dChmZW5jZSk7CiAJCX0KIAl9IGVsc2UgewotCQlhZGRfcnBzX2Jvb3N0X2Fm
dGVyX3ZibGFuayhuZXdfc3RhdGUtPmNydGMsIG5ld19zdGF0ZS0+ZmVuY2UpOworCQlhZGRfcnBz
X2Jvb3N0X2FmdGVyX3ZibGFuaygmY3J0Yy0+YmFzZSwgbmV3X3BsYW5lX3N0YXRlLT5iYXNlLmZl
bmNlKTsKIAl9CiAKIAkvKgpAQCAtMTUxMDUsOSArMTUxMTcsOSBAQCBpbnRlbF9wcmVwYXJlX3Bs
YW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCSAqIHRoYXQgYXJlIG5vdCBxdWl0ZSBz
dGVhZHkgc3RhdGUgd2l0aG91dCByZXNvcnRpbmcgdG8gZm9yY2luZwogCSAqIG1heGltdW0gY2xv
Y2tzIGZvbGxvd2luZyBhIHZibGFuayBtaXNzIChzZWUgZG9fcnBzX2Jvb3N0KCkpLgogCSAqLwot
CWlmICghaW50ZWxfc3RhdGUtPnJwc19pbnRlcmFjdGl2ZSkgeworCWlmICghc3RhdGUtPnJwc19p
bnRlcmFjdGl2ZSkgewogCQlpbnRlbF9ycHNfbWFya19pbnRlcmFjdGl2ZShkZXZfcHJpdiwgdHJ1
ZSk7Ci0JCWludGVsX3N0YXRlLT5ycHNfaW50ZXJhY3RpdmUgPSB0cnVlOworCQlzdGF0ZS0+cnBz
X2ludGVyYWN0aXZlID0gdHJ1ZTsKIAl9CiAKIAlyZXR1cm4gMDsKQEAgLTE1MzU0LDcgKzE1MzY2
LDggQEAgaW50ZWxfbGVnYWN5X2N1cnNvcl91cGRhdGUoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUs
CiAJaWYgKHJldCkKIAkJZ290byBvdXRfZnJlZTsKIAotCXJldCA9IGludGVsX3BsYW5lX3Bpbl9m
Yih0b19pbnRlbF9wbGFuZV9zdGF0ZShuZXdfcGxhbmVfc3RhdGUpKTsKKwlyZXQgPSBpbnRlbF9w
bGFuZV9waW5fZmIodG9faW50ZWxfcGxhbmVfc3RhdGUobmV3X3BsYW5lX3N0YXRlKSwKKwkJCQkg
dG9faW50ZWxfcGxhbmVfc3RhdGUobmV3X3BsYW5lX3N0YXRlKSk7CiAJaWYgKHJldCkKIAkJZ290
byBvdXRfdW5sb2NrOwogCi0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3Rz
LmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xp
c3RpbmZvL2ludGVsLWdmeA==

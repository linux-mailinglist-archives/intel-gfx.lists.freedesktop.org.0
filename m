Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7A9F3DA77C
	for <lists+intel-gfx@lfdr.de>; Thu, 17 Oct 2019 10:37:04 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B8D546E4AA;
	Thu, 17 Oct 2019 08:37:02 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 14DB16E4AA
 for <intel-gfx@lists.freedesktop.org>; Thu, 17 Oct 2019 08:37:01 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18865932-1500050 
 for multiple; Thu, 17 Oct 2019 09:36:46 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 17 Oct 2019 09:36:44 +0100
Message-Id: <20191017083644.17419-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191016195251.17863-1-chris@chris-wilson.co.uk>
References: <20191016195251.17863-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/execlists: Don't merely skip
 submission if maybe timeslicing
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Tm9ybWFsbHksIHdlIHRyeSBhbmQgc2tpcCBzdWJtaXNzaW9uIGlmIEVMU1BbMV0gaXMgZmlsbGVk
LiBIb3dldmVyLCB3ZQptYXkgZGVzaXJlIHRvIGVuYWJsZSB0aW1lc2xpY2luZyBkdWUgdG8gdGhl
IHF1ZXVlIHByaW9yaXR5LCBldmVuIGlmCkVMU1BbMV0gaXRzZWxmIGRvZXMgbm90IHJlcXVpcmUg
dGltZXNsaWNpbmcuIFRoYXQgaXMgdGhlIHF1ZXVlIGlzIGVxdWFsCnByaW9yaXR5IHRvIEVMU1Bb
MF0gYW5kIGhpZ2hlciBwcmlvcml0eSB0aGVuIEVMU1BbMV0uIFByZXZpb3VzbHksIHdlCndvdWxk
IHdhaXQgdW50aWwgdGhlIGNvbnRleHQgc3dpdGNoIHRvIHByZWVtcHQgdGhlIGN1cnJlbnQgRUxT
UFsxXSwgYnV0CndpdGggdGltZXNsaWNpbmcsIHdlIHdhbnQgdG8gcHJlZW1wdCBFTFNQWzBdIGFu
ZCByZXBsYWNlIGl0IHdpdGggdGhlCnF1ZXVlLgoKSW4gd3JpdGluZyB0aGUgdGVzdCBjYXNlLCBp
dCBiZWNvbWUgcXVpY2tseSBhcHBhcmVudCB0aGF0IHdlIHdlcmUgYWxzbwpzdXBwcmVzc2luZyB0
aGUgdGFza2xldCBkdXJpbmcgcHJvbW90aW9uIGFuZCBzbyBmYWlsaW5nIHRvIG5vdGljZSB3aGVu
CnRoZSBxdWV1ZSBzdGFydGVkIHJlcXVpcmluZyB0aW1lc2xpY2luZy4KCkZpeGVzOiAyMjI5YWRj
ODEzODAgKCJkcm0vaTkxNS9leGVjbGlzdDogVHJpbSBpbW1lZGlhdGUgdGltZXNsaWNlIGV4cGly
eSIpClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVr
PgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KLS0tCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyAgICB8ICAyMiArKystCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYyB8IDE1NyArKysrKysrKysrKysrKysrKysrKysr
KystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5jICB8ICAxNyArKy0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmggIHwgIDE4IC0tLQogNCBmaWxlcyBj
aGFuZ2VkLCAxODUgaW5zZXJ0aW9ucygrKSwgMjkgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9scmMuYwppbmRleCBlOWZlOWY3OWNlZGQuLmQwMDg4ZDAyMDIyMCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKQEAgLTM1MiwxMCArMzUyLDE1IEBAIHN0YXRpYyBp
bmxpbmUgYm9vbCBuZWVkX3ByZWVtcHQoY29uc3Qgc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lLAogCSAqIEhvd2V2ZXIsIHRoZSBwcmlvcml0eSBoaW50IGlzIGEgbWVyZSBoaW50IHRoYXQg
d2UgbWF5IG5lZWQgdG8KIAkgKiBwcmVlbXB0LiBJZiB0aGF0IGhpbnQgaXMgc3RhbGUgb3Igd2Ug
bWF5IGJlIHRyeWluZyB0byBwcmVlbXB0CiAJICogb3Vyc2VsdmVzLCBpZ25vcmUgdGhlIHJlcXVl
c3QuCisJICoKKwkgKiBNb3JlIG5hdHVyYWxseSB3ZSB3b3VsZCB3cml0ZQorCSAqICAgICAgcHJp
byA+PSBtYXgoMCwgbGFzdCk7CisJICogZXhjZXB0IHRoYXQgd2Ugd2lzaCB0byBwcmV2ZW50IHRy
aWdnZXJpbmcgcHJlZW1wdGlvbiBhdCB0aGUgc2FtZQorCSAqIHByaW9yaXR5IGxldmVsOiB0aGUg
dGFzayB0aGF0IGlzIHJ1bm5pbmcgc2hvdWxkIHJlbWFpbiBydW5uaW5nCisJICogdG8gcHJlc2Vy
dmUgRklGTyBvcmRlcmluZyBvZiBkZXBlbmRlbmNpZXMuCiAJICovCi0JbGFzdF9wcmlvID0gZWZm
ZWN0aXZlX3ByaW8ocnEpOwotCWlmICghaTkxNV9zY2hlZHVsZXJfbmVlZF9wcmVlbXB0KGVuZ2lu
ZS0+ZXhlY2xpc3RzLnF1ZXVlX3ByaW9yaXR5X2hpbnQsCi0JCQkJCSBsYXN0X3ByaW8pKQorCWxh
c3RfcHJpbyA9IG1heChlZmZlY3RpdmVfcHJpbyhycSksIEk5MTVfUFJJT1JJVFlfTk9STUFMIC0g
MSk7CisJaWYgKGVuZ2luZS0+ZXhlY2xpc3RzLnF1ZXVlX3ByaW9yaXR5X2hpbnQgPD0gbGFzdF9w
cmlvKQogCQlyZXR1cm4gZmFsc2U7CiAKIAkvKgpAQCAtMTUwOSw4ICsxNTE0LDE3IEBAIHN0YXRp
YyB2b2lkIGV4ZWNsaXN0c19kZXF1ZXVlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkK
IAkJCSAqIHN1Ym1pc3Npb24uCiAJCQkgKi8KIAkJCWlmICghbGlzdF9pc19sYXN0KCZsYXN0LT5z
Y2hlZC5saW5rLAotCQkJCQkgICZlbmdpbmUtPmFjdGl2ZS5yZXF1ZXN0cykpCisJCQkJCSAgJmVu
Z2luZS0+YWN0aXZlLnJlcXVlc3RzKSkgeworCQkJCS8qCisJCQkJICogRXZlbiBpZiBFTFNQWzFd
IGlzIG9jY3VwaWVkIGFuZCBub3Qgd29ydGh5CisJCQkJICogb2YgdGltZXNsaWNlcywgb3VyIHF1
ZXVlIG1pZ2h0IGJlLgorCQkJCSAqLworCQkJCWlmICghZXhlY2xpc3RzLT50aW1lci5leHBpcmVz
ICYmCisJCQkJICAgIG5lZWRfdGltZXNsaWNlKGVuZ2luZSwgbGFzdCkpCisJCQkJCW1vZF90aW1l
cigmZXhlY2xpc3RzLT50aW1lciwKKwkJCQkJCSAgamlmZmllcyArIDEpOwogCQkJCXJldHVybjsK
KwkJCX0KIAogCQkJLyoKIAkJCSAqIFdhSWRsZUxpdGVSZXN0b3JlOmJkdyxza2wKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKaW5kZXggMjg2ODM3MWM2MDllLi4zMmVlYmUxY2Jh
ZmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCkBAIC0zMjUsNyArMzI1
LDEzIEBAIHNlbWFwaG9yZV9xdWV1ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIHN0
cnVjdCBpOTE1X3ZtYSAqdm1hLCBpbnQgaWR4KQogCWlmIChJU19FUlIocnEpKQogCQlnb3RvIG91
dF9jdHg7CiAKLQllcnIgPSBlbWl0X3NlbWFwaG9yZV9jaGFpbihycSwgdm1hLCBpZHgpOworCWVy
ciA9IDA7CisJaWYgKHJxLT5lbmdpbmUtPmVtaXRfaW5pdF9icmVhZGNydW1iKQorCQllcnIgPSBy
cS0+ZW5naW5lLT5lbWl0X2luaXRfYnJlYWRjcnVtYihycSk7CisJaWYgKGVyciA9PSAwKQorCQll
cnIgPSBlbWl0X3NlbWFwaG9yZV9jaGFpbihycSwgdm1hLCBpZHgpOworCWlmIChlcnIgPT0gMCkK
KwkJaTkxNV9yZXF1ZXN0X2dldChycSk7CiAJaTkxNV9yZXF1ZXN0X2FkZChycSk7CiAJaWYgKGVy
cikKIAkJcnEgPSBFUlJfUFRSKGVycik7CkBAIC0zMzgsMTAgKzM0NCwxMCBAQCBzZW1hcGhvcmVf
cXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBzdHJ1Y3QgaTkxNV92bWEgKnZt
YSwgaW50IGlkeCkKIHN0YXRpYyBpbnQKIHJlbGVhc2VfcXVldWUoc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lLAogCSAgICAgIHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAotCSAgICAgIGludCBp
ZHgpCisJICAgICAgaW50IGlkeCwgaW50IHByaW8pCiB7CiAJc3RydWN0IGk5MTVfc2NoZWRfYXR0
ciBhdHRyID0gewotCQkucHJpb3JpdHkgPSBJOTE1X1VTRVJfUFJJT1JJVFkoSTkxNV9QUklPUklU
WV9NQVgpLAorCQkucHJpb3JpdHkgPSBwcmlvLAogCX07CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnE7CiAJdTMyICpjczsKQEAgLTM2Miw5ICszNjgsMTUgQEAgcmVsZWFzZV9xdWV1ZShzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUsCiAJKmNzKysgPSAxOwogCiAJaW50ZWxfcmluZ19hZHZh
bmNlKHJxLCBjcyk7CisKKwlpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKIAlpOTE1X3JlcXVlc3RfYWRk
KHJxKTsKIAorCWxvY2FsX2JoX2Rpc2FibGUoKTsKIAllbmdpbmUtPnNjaGVkdWxlKHJxLCAmYXR0
cik7CisJbG9jYWxfYmhfZW5hYmxlKCk7IC8qIGtpY2sgdGFza2xldCAqLworCisJaTkxNV9yZXF1
ZXN0X3B1dChycSk7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTM4Myw3ICszOTUsNiBAQCBzbGljZV9z
ZW1hcGhvcmVfcXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqb3V0ZXIsCiAJaWYgKElTX0VS
UihoZWFkKSkKIAkJcmV0dXJuIFBUUl9FUlIoaGVhZCk7CiAKLQlpOTE1X3JlcXVlc3RfZ2V0KGhl
YWQpOwogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIG91dGVyLT5pOTE1LCBpZCkgewogCQlmb3Ig
KGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CkBA
IC0zOTMsMTAgKzQwNCwxMiBAQCBzbGljZV9zZW1hcGhvcmVfcXVldWUoc3RydWN0IGludGVsX2Vu
Z2luZV9jcyAqb3V0ZXIsCiAJCQkJZXJyID0gUFRSX0VSUihycSk7CiAJCQkJZ290byBvdXQ7CiAJ
CQl9CisKKwkJCWk5MTVfcmVxdWVzdF9wdXQocnEpOwogCQl9CiAJfQogCi0JZXJyID0gcmVsZWFz
ZV9xdWV1ZShvdXRlciwgdm1hLCBuKTsKKwllcnIgPSByZWxlYXNlX3F1ZXVlKG91dGVyLCB2bWEs
IG4sIElOVF9NQVgpOwogCWlmIChlcnIpCiAJCWdvdG8gb3V0OwogCkBAIC00ODIsNiArNDk1LDEz
OSBAQCBzdGF0aWMgaW50IGxpdmVfdGltZXNsaWNlX3ByZWVtcHQodm9pZCAqYXJnKQogCXJldHVy
biBlcnI7CiB9CiAKK3N0YXRpYyBpbnQgbm9wX3JlcXVlc3Qoc3RydWN0IGludGVsX2VuZ2luZV9j
cyAqZW5naW5lKQoreworCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCisJcnEgPSBpOTE1X3Jl
cXVlc3RfY3JlYXRlKGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOworCWlmIChJU19FUlIocnEpKQor
CQlyZXR1cm4gUFRSX0VSUihycSk7CisKKwlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKwlyZXR1cm4g
MDsKK30KKworc3RhdGljIGludCBsaXZlX3RpbWVzbGljZV9xdWV1ZSh2b2lkICphcmcpCit7CisJ
c3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqOworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKKwllbnVtIGludGVsX2VuZ2lu
ZV9pZCBpZDsKKwlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKKwl2b2lkICp2YWRkcjsKKwlpbnQgZXJy
ID0gMDsKKworCS8qCisJICogTWFrZSBzdXJlIHRoYXQgZXZlbiBpZiBFTFNQWzBdIGFuZCBFTFNQ
WzFdIGFyZSBmaWxsZWQgd2l0aAorCSAqIHRpbWVzbGljaW5nIGJldHdlZW4gdGhlbSBkaXNhYmxl
ZCwgd2UgKmRvKiBlbmFibGUgdGltZXNsaWNpbmcKKwkgKiBpZiB0aGUgcXVldWUgZGVtYW5kcyBp
dC4gKE5vcm1hbGx5LCB3ZSBkbyBub3Qgc3VibWl0IGlmCisJICogRUxTUFsxXSBpcyBhbHJlYWR5
IG9jY3VwaWVkLCBzbyBtdXN0IHJlbHkgb24gdGltZXNsaWNpbmcgdG8KKwkgKiBlamVjdCBFTFNQ
WzBdIGluIGZhdm91ciBvZiB0aGUgcXVldWUuKQorCSAqLworCisJb2JqID0gaTkxNV9nZW1fb2Jq
ZWN0X2NyZWF0ZV9pbnRlcm5hbChndC0+aTkxNSwgUEFHRV9TSVpFKTsKKwlpZiAoSVNfRVJSKG9i
aikpCisJCXJldHVybiBQVFJfRVJSKG9iaik7CisKKwl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShv
YmosICZndC0+Z2d0dC0+dm0sIE5VTEwpOworCWlmIChJU19FUlIodm1hKSkgeworCQllcnIgPSBQ
VFJfRVJSKHZtYSk7CisJCWdvdG8gZXJyX29iajsKKwl9CisKKwl2YWRkciA9IGk5MTVfZ2VtX29i
amVjdF9waW5fbWFwKG9iaiwgSTkxNV9NQVBfV0MpOworCWlmIChJU19FUlIodmFkZHIpKSB7CisJ
CWVyciA9IFBUUl9FUlIodmFkZHIpOworCQlnb3RvIGVycl9vYmo7CisJfQorCisJZXJyID0gaTkx
NV92bWFfcGluKHZtYSwgMCwgMCwgUElOX0dMT0JBTCk7CisJaWYgKGVycikKKwkJZ290byBlcnJf
bWFwOworCisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5MTUsIGlkKSB7CisJCXN0cnVj
dCBpOTE1X3NjaGVkX2F0dHIgYXR0ciA9IHsKKwkJCS5wcmlvcml0eSA9IEk5MTVfVVNFUl9QUklP
UklUWShJOTE1X1BSSU9SSVRZX01BWCksCisJCX07CisJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
OworCisJCWlmICghaW50ZWxfZW5naW5lX2hhc19wcmVlbXB0aW9uKGVuZ2luZSkpCisJCQljb250
aW51ZTsKKworCQltZW1zZXQodmFkZHIsIDAsIFBBR0VfU0laRSk7CisKKwkJLyogRUxTUFswXTog
c2VtYXBob3JlIHdhaXQgKi8KKwkJcnEgPSBzZW1hcGhvcmVfcXVldWUoZW5naW5lLCB2bWEsIDAp
OworCQlpZiAoSVNfRVJSKHJxKSkgeworCQkJZXJyID0gUFRSX0VSUihycSk7CisJCQlnb3RvIGVy
cl9waW47CisJCX0KKwkJZW5naW5lLT5zY2hlZHVsZShycSwgJmF0dHIpOworCisJCS8qIEVMU1Bb
MV06IG5vcCByZXF1ZXN0ICovCisJCWVyciA9IG5vcF9yZXF1ZXN0KGVuZ2luZSk7CisJCWlmIChl
cnIpIHsKKwkJCWk5MTVfcmVxdWVzdF9wdXQocnEpOworCQkJZ290byBlcnJfcGluOworCQl9CisK
KwkJLyogUG9wdWxhdGUgRUxTUFtdIGJlZm9yZSBuZXh0IHN1Ym1pc3Npb24gKi8KKwkJZG8gewor
CQkJY29uZF9yZXNjaGVkKCk7CisJCQlpbnRlbF9lbmdpbmVfZmx1c2hfc3VibWlzc2lvbihlbmdp
bmUpOworCQl9IHdoaWxlIChSRUFEX09OQ0UoZW5naW5lLT5leGVjbGlzdHMucGVuZGluZ1swXSkp
OworCisJCUdFTV9CVUdfT04oaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChycSkpOworCisJCS8qIFF1
ZXVlOiBzZW1hcGhvcmUgc2lnbmFsLCBtYXRjaGluZyBwcmlvcml0eSBhcyBzZW1hcGhvcmUgKi8K
KwkJZXJyID0gcmVsZWFzZV9xdWV1ZShlbmdpbmUsIHZtYSwgMSwgZWZmZWN0aXZlX3ByaW8ocnEp
KTsKKwkJaWYgKGVycikgeworCQkJaTkxNV9yZXF1ZXN0X3B1dChycSk7CisJCQlnb3RvIGVycl9w
aW47CisJCX0KKworCQlpbnRlbF9lbmdpbmVfZmx1c2hfc3VibWlzc2lvbihlbmdpbmUpOworCQlp
ZiAoIWVuZ2luZS0+ZXhlY2xpc3RzLnRpbWVyLmV4cGlyZXMgJiYKKwkJICAgICFpOTE1X3JlcXVl
c3RfY29tcGxldGVkKHJxKSkgeworCQkJc3RydWN0IGRybV9wcmludGVyIHAgPQorCQkJCWRybV9p
bmZvX3ByaW50ZXIoZ3QtPmk5MTUtPmRybS5kZXYpOworCisJCQlHRU1fVFJBQ0VfRVJSKCJGYWls
ZWQgdG8gZW5hYmxlIHRpbWVzbGljaW5nIVxuIik7CisJCQlpbnRlbF9lbmdpbmVfZHVtcChlbmdp
bmUsICZwLAorCQkJCQkgICIlc1xuIiwgZW5naW5lLT5uYW1lKTsKKwkJCUdFTV9UUkFDRV9EVU1Q
KCk7CisKKwkJCW1lbXNldCh2YWRkciwgMHhmZiwgUEFHRV9TSVpFKTsKKwkJCWVyciA9IC1FSU5W
QUw7CisJCX0KKworCQkvKiBUaW1lc2xpY2UgZXZlcnkgamlmZmllLCBzbyB3aXRoaW4gMiB3ZSBz
aG91bGQgc2lnbmFsICovCisJCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChycSwgMCwgMykgPCAwKSB7
CisJCQlzdHJ1Y3QgZHJtX3ByaW50ZXIgcCA9CisJCQkJZHJtX2luZm9fcHJpbnRlcihndC0+aTkx
NS0+ZHJtLmRldik7CisKKwkJCXByX2VycigiRmFpbGVkIHRvIHRpbWVzbGljZSBpbnRvIHF1ZXVl
XG4iKTsKKwkJCWludGVsX2VuZ2luZV9kdW1wKGVuZ2luZSwgJnAsCisJCQkJCSAgIiVzXG4iLCBl
bmdpbmUtPm5hbWUpOworCisJCQltZW1zZXQodmFkZHIsIDB4ZmYsIFBBR0VfU0laRSk7CisJCQll
cnIgPSAtRUlPOworCQl9CisJCWk5MTVfcmVxdWVzdF9wdXQocnEpOworCQlpZiAoZXJyKQorCQkJ
YnJlYWs7CisJfQorCisKK2Vycl9waW46CisJaTkxNV92bWFfdW5waW4odm1hKTsKK2Vycl9tYXA6
CisJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChvYmopOworZXJyX29iajoKKwlpOTE1X2dlbV9v
YmplY3RfcHV0KG9iaik7CisJcmV0dXJuIGVycjsKK30KKwogc3RhdGljIGludCBsaXZlX2J1c3l3
YWl0X3ByZWVtcHQodm9pZCAqYXJnKQogewogCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CkBA
IC0yNDM3LDYgKzI1ODMsNyBAQCBpbnQgaW50ZWxfZXhlY2xpc3RzX2xpdmVfc2VsZnRlc3RzKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCQlTVUJURVNUKGxpdmVfdW5saXRlX3N3aXRj
aCksCiAJCVNVQlRFU1QobGl2ZV91bmxpdGVfcHJlZW1wdCksCiAJCVNVQlRFU1QobGl2ZV90aW1l
c2xpY2VfcHJlZW1wdCksCisJCVNVQlRFU1QobGl2ZV90aW1lc2xpY2VfcXVldWUpLAogCQlTVUJU
RVNUKGxpdmVfYnVzeXdhaXRfcHJlZW1wdCksCiAJCVNVQlRFU1QobGl2ZV9wcmVlbXB0KSwKIAkJ
U1VCVEVTVChsaXZlX2xhdGVfcHJlZW1wdCksCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3NjaGVkdWxlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVs
ZXIuYwppbmRleCA3Yjg0ZWJjYTI5MDEuLjBjYTQwZjZiZjA4YyAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3NjaGVkdWxlci5jCkBAIC0xNzcsOSArMTc3LDIyIEBAIHN0YXRpYyBpbmxpbmUgaW50
IHJxX3ByaW8oY29uc3Qgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJcmV0dXJuIHJxLT5zY2hl
ZC5hdHRyLnByaW9yaXR5IHwgX19OT19QUkVFTVBUSU9OOwogfQogCitzdGF0aWMgaW5saW5lIGJv
b2wgbmVlZF9wcmVlbXB0KGludCBwcmlvLCBpbnQgYWN0aXZlKQoreworCS8qCisJICogQWxsb3cg
cHJlZW1wdGlvbiBvZiBsb3cgLT4gbm9ybWFsIC0+IGhpZ2gsIGJ1dCB3ZSBkbworCSAqIG5vdCBh
bGxvdyBsb3cgcHJpb3JpdHkgdGFza3MgdG8gcHJlZW1wdCBvdGhlciBsb3cgcHJpb3JpdHkKKwkg
KiB0YXNrcyB1bmRlciB0aGUgaW1wcmVzc2lvbiB0aGF0IGxhdGVuY3kgZm9yIGxvdyBwcmlvcml0
eQorCSAqIHRhc2tzIGRvZXMgbm90IG1hdHRlciAoYXMgbXVjaCBhcyBiYWNrZ3JvdW5kIHRocm91
Z2hwdXQpLAorCSAqIHNvIGtpc3MuCisJICovCisJcmV0dXJuIHByaW8gPj0gbWF4KEk5MTVfUFJJ
T1JJVFlfTk9STUFMLCBhY3RpdmUpOworfQorCiBzdGF0aWMgdm9pZCBraWNrX3N1Ym1pc3Npb24o
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLCBpbnQgcHJpbykKIHsKLQljb25zdCBzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICppbmZsaWdodCA9ICplbmdpbmUtPmV4ZWNsaXN0cy5hY3RpdmU7CisJ
Y29uc3Qgc3RydWN0IGk5MTVfcmVxdWVzdCAqaW5mbGlnaHQgPQorCQlleGVjbGlzdHNfYWN0aXZl
KCZlbmdpbmUtPmV4ZWNsaXN0cyk7CiAKIAkvKgogCSAqIElmIHdlIGFyZSBhbHJlYWR5IHRoZSBj
dXJyZW50bHkgZXhlY3V0aW5nIGNvbnRleHQsIGRvbid0CkBAIC0xODgsNyArMjAxLDcgQEAgc3Rh
dGljIHZvaWQga2lja19zdWJtaXNzaW9uKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwg
aW50IHByaW8pCiAJICogdGFza2xldCwgaS5lLiB3ZSBoYXZlIG5vdCBjaGFuZ2UgdGhlIHByaW9y
aXR5IHF1ZXVlCiAJICogc3VmZmljaWVudGx5IHRvIG91c3QgdGhlIHJ1bm5pbmcgY29udGV4dC4K
IAkgKi8KLQlpZiAoIWluZmxpZ2h0IHx8ICFpOTE1X3NjaGVkdWxlcl9uZWVkX3ByZWVtcHQocHJp
bywgcnFfcHJpbyhpbmZsaWdodCkpKQorCWlmICghaW5mbGlnaHQgfHwgIW5lZWRfcHJlZW1wdChw
cmlvLCBycV9wcmlvKGluZmxpZ2h0KSkpCiAJCXJldHVybjsKIAogCXRhc2tsZXRfaGlfc2NoZWR1
bGUoJmVuZ2luZS0+ZXhlY2xpc3RzLnRhc2tsZXQpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2No
ZWR1bGVyLmgKaW5kZXggN2VlZmNjZmYzOWJmLi4wN2QyNDNhY2Y1NTMgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc2NoZWR1bGVyLmgKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9zY2hlZHVsZXIuaApAQCAtNTIsMjIgKzUyLDQgQEAgc3RhdGljIGlubGluZSB2
b2lkIGk5MTVfcHJpb2xpc3RfZnJlZShzdHJ1Y3QgaTkxNV9wcmlvbGlzdCAqcCkKIAkJX19pOTE1
X3ByaW9saXN0X2ZyZWUocCk7CiB9CiAKLXN0YXRpYyBpbmxpbmUgYm9vbCBpOTE1X3NjaGVkdWxl
cl9uZWVkX3ByZWVtcHQoaW50IHByaW8sIGludCBhY3RpdmUpCi17Ci0JLyoKLQkgKiBBbGxvdyBw
cmVlbXB0aW9uIG9mIGxvdyAtPiBub3JtYWwgLT4gaGlnaCwgYnV0IHdlIGRvCi0JICogbm90IGFs
bG93IGxvdyBwcmlvcml0eSB0YXNrcyB0byBwcmVlbXB0IG90aGVyIGxvdyBwcmlvcml0eQotCSAq
IHRhc2tzIHVuZGVyIHRoZSBpbXByZXNzaW9uIHRoYXQgbGF0ZW5jeSBmb3IgbG93IHByaW9yaXR5
Ci0JICogdGFza3MgZG9lcyBub3QgbWF0dGVyIChhcyBtdWNoIGFzIGJhY2tncm91bmQgdGhyb3Vn
aHB1dCksCi0JICogc28ga2lzcy4KLQkgKgotCSAqIE1vcmUgbmF0dXJhbGx5IHdlIHdvdWxkIHdy
aXRlCi0JICoJcHJpbyA+PSBtYXgoMCwgbGFzdCk7Ci0JICogZXhjZXB0IHRoYXQgd2Ugd2lzaCB0
byBwcmV2ZW50IHRyaWdnZXJpbmcgcHJlZW1wdGlvbiBhdCB0aGUgc2FtZQotCSAqIHByaW9yaXR5
IGxldmVsOiB0aGUgdGFzayB0aGF0IGlzIHJ1bm5pbmcgc2hvdWxkIHJlbWFpbiBydW5uaW5nCi0J
ICogdG8gcHJlc2VydmUgRklGTyBvcmRlcmluZyBvZiBkZXBlbmRlbmNpZXMuCi0JICovCi0JcmV0
dXJuIHByaW8gPiBtYXgoSTkxNV9QUklPUklUWV9OT1JNQUwgLSAxLCBhY3RpdmUpOwotfQotCiAj
ZW5kaWYgLyogX0k5MTVfU0NIRURVTEVSX0hfICovCi0tIAoyLjIzLjAKCl9fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QK
SW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9w
Lm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

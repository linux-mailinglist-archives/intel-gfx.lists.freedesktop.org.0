Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 88DFFC9ADA
	for <lists+intel-gfx@lfdr.de>; Thu,  3 Oct 2019 11:36:59 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BAD5E6E993;
	Thu,  3 Oct 2019 09:36:56 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C51736E98C
 for <intel-gfx@lists.freedesktop.org>; Thu,  3 Oct 2019 09:36:53 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18704188-1500050 
 for multiple; Thu, 03 Oct 2019 10:36:44 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu,  3 Oct 2019 10:36:30 +0100
Message-Id: <20191003093639.10186-14-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191003093639.10186-1-chris@chris-wilson.co.uk>
References: <20191003093639.10186-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 13/22] drm/i915: Move request runtime management
 onto gt
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UmVxdWVzdHMgYXJlIHJ1biBmcm9tIHRoZSBndCBhbmQgYXJlIHRpZGVkIGludG8gdGhlIGd0IHJ1
bnRpbWUgcG93ZXIKbWFuYWdlbWVudCwgc28gcHVsbCB0aGUgcnVudGltZSByZXF1ZXN0IG1hbmFn
ZW1lbnQgdW5kZXIgZ3QvCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlz
LXdpbHNvbi5jby51az4KUmV2aWV3ZWQtYnk6IFR2cnRrbyBVcnN1bGluIDx0dnJ0a28udXJzdWxp
bkBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgICAgICAgICAg
ICAgICAgIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMg
ICAgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMgICAg
ICAgIHwgIDI4ICstLS0KIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRl
eHQuYyB8ICAgNSArLQogLi4uL2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5j
ICAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jICAgICAgICAg
ICAgfCAgIDIgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uYyAgICAgICAg
IHwgICA1ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9yZXF1ZXN0cy5jICAg
fCAxMjMgKysrKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9n
dF9yZXF1ZXN0cy5oICAgfCAgMjQgKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
Z3RfdHlwZXMuaCAgICAgIHwgIDExICsrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVz
dF90aW1lbGluZS5jICAgfCAgIDggKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdm
cy5jICAgICAgICAgICB8ICAxNyArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2Lmgg
ICAgICAgICAgICAgICB8ICAxMCAtLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyAg
ICAgICAgICAgICAgIHwgIDE3IC0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZXZp
Y3QuYyAgICAgICAgIHwgIDE0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQu
YyAgICAgICAgICAgfCAgIDUgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5j
ICAgICAgICAgICB8ICA2NCArLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVx
dWVzdC5oICAgICAgICAgICB8ICAgNyArLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0
X2ZsdXNoX3Rlc3QuYyAgIHwgICA5ICstCiAuLi4vZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3Rf
bGl2ZV90ZXN0LmMgICAgfCAgIDUgKy0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tf
Z2VtX2RldmljZS5jICB8ICAxMCArLQogMjEgZmlsZXMgY2hhbmdlZCwgMjEzIGluc2VydGlvbnMo
KyksIDE1OCBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9ndF9yZXF1ZXN0cy5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcmVxdWVzdHMuaAoKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L01ha2VmaWxlIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKaW5k
ZXggZDJiNTNiNWFkZDgxLi4wNmUxODc2ZDAyNTAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L01ha2VmaWxlCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCkBAIC04
Myw2ICs4Myw3IEBAIGd0LXkgKz0gXAogCWd0L2ludGVsX2d0X2lycS5vIFwKIAlndC9pbnRlbF9n
dF9wbS5vIFwKIAlndC9pbnRlbF9ndF9wbV9pcnEubyBcCisJZ3QvaW50ZWxfZ3RfcmVxdWVzdHMu
byBcCiAJZ3QvaW50ZWxfaGFuZ2NoZWNrLm8gXAogCWd0L2ludGVsX2xyYy5vIFwKIAlndC9pbnRl
bF9yYzYubyBcCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
bW1hbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYwppbmRleCA0
NWJiZDIyYzE0ZjEuLmZkNDEyMmQ4YzBhOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fbW1hbi5jCkBAIC04LDYgKzgsNyBAQAogI2luY2x1ZGUgPGxpbnV4L3NpemVzLmg+CiAK
ICNpbmNsdWRlICJndC9pbnRlbF9ndC5oIgorI2luY2x1ZGUgImd0L2ludGVsX2d0X3JlcXVlc3Rz
LmgiCiAKICNpbmNsdWRlICJpOTE1X2Rydi5oIgogI2luY2x1ZGUgImk5MTVfZ2VtX2d0dC5oIgpA
QCAtNDI0LDYgKzQyNSw3IEBAIHZvaWQgaTkxNV9nZW1fb2JqZWN0X3JlbGVhc2VfbW1hcChzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogc3RhdGljIGludCBjcmVhdGVfbW1hcF9vZmZz
ZXQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7CisJc3RydWN0IGludGVsX2d0
ICpndCA9ICZpOTE1LT5ndDsKIAlpbnQgZXJyOwogCiAJZXJyID0gZHJtX2dlbV9jcmVhdGVfbW1h
cF9vZmZzZXQoJm9iai0+YmFzZSk7CkBAIC00MzEsNyArNDMzLDcgQEAgc3RhdGljIGludCBjcmVh
dGVfbW1hcF9vZmZzZXQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAkJcmV0dXJu
IDA7CiAKIAkvKiBBdHRlbXB0IHRvIHJlYXAgc29tZSBtbWFwIHNwYWNlIGZyb20gZGVhZCBvYmpl
Y3RzICovCi0JZXJyID0gaTkxNV9yZXRpcmVfcmVxdWVzdHNfdGltZW91dChpOTE1LCBNQVhfU0NI
RURVTEVfVElNRU9VVCk7CisJZXJyID0gaW50ZWxfZ3RfcmV0aXJlX3JlcXVlc3RzX3RpbWVvdXQo
Z3QsIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwogCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCmluZGV4IDkwYjIxMTI1N2YyZC4uOTE5
NGQ4NDY0YmY3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
cG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYwpAQCAtNywz
MSArNywxOCBAQAogI2luY2x1ZGUgImdlbS9pOTE1X2dlbV9wbS5oIgogI2luY2x1ZGUgImd0L2lu
dGVsX2d0LmgiCiAjaW5jbHVkZSAiZ3QvaW50ZWxfZ3RfcG0uaCIKKyNpbmNsdWRlICJndC9pbnRl
bF9ndF9yZXF1ZXN0cy5oIgogCiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIKICNpbmNsdWRlICJpOTE1
X2dsb2JhbHMuaCIKIAogc3RhdGljIHZvaWQgaTkxNV9nZW1fcGFyayhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIHsKLQljYW5jZWxfZGVsYXllZF93b3JrKCZpOTE1LT5nZW0ucmV0aXJl
X3dvcmspOwotCiAJaTkxNV92bWFfcGFya2VkKGk5MTUpOwogCiAJaTkxNV9nbG9iYWxzX3Bhcmso
KTsKIH0KIAotc3RhdGljIHZvaWQgcmV0aXJlX3dvcmtfaGFuZGxlcihzdHJ1Y3Qgd29ya19zdHJ1
Y3QgKndvcmspCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPQotCQljb250YWlu
ZXJfb2Yod29yaywgdHlwZW9mKCppOTE1KSwgZ2VtLnJldGlyZV93b3JrLndvcmspOwotCi0JaTkx
NV9yZXRpcmVfcmVxdWVzdHMoaTkxNSk7Ci0KLQlxdWV1ZV9kZWxheWVkX3dvcmsoaTkxNS0+d3Es
Ci0JCQkgICAmaTkxNS0+Z2VtLnJldGlyZV93b3JrLAotCQkJICAgcm91bmRfamlmZmllc191cF9y
ZWxhdGl2ZShIWikpOwotfQotCiBzdGF0aWMgaW50IHBtX25vdGlmaWVyKHN0cnVjdCBub3RpZmll
cl9ibG9jayAqbmIsCiAJCSAgICAgICB1bnNpZ25lZCBsb25nIGFjdGlvbiwKIAkJICAgICAgIHZv
aWQgKmRhdGEpCkBAIC00Miw5ICsyOSw2IEBAIHN0YXRpYyBpbnQgcG1fbm90aWZpZXIoc3RydWN0
IG5vdGlmaWVyX2Jsb2NrICpuYiwKIAlzd2l0Y2ggKGFjdGlvbikgewogCWNhc2UgSU5URUxfR1Rf
VU5QQVJLOgogCQlpOTE1X2dsb2JhbHNfdW5wYXJrKCk7Ci0JCXF1ZXVlX2RlbGF5ZWRfd29yayhp
OTE1LT53cSwKLQkJCQkgICAmaTkxNS0+Z2VtLnJldGlyZV93b3JrLAotCQkJCSAgIHJvdW5kX2pp
ZmZpZXNfdXBfcmVsYXRpdmUoSFopKTsKIAkJYnJlYWs7CiAKIAljYXNlIElOVEVMX0dUX1BBUks6
CkBAIC01OSw3ICs0Myw3IEBAIHN0YXRpYyBib29sIHN3aXRjaF90b19rZXJuZWxfY29udGV4dF9z
eW5jKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiB7CiAJYm9vbCByZXN1bHQgPSAhaW50ZWxfZ3RfaXNf
d2VkZ2VkKGd0KTsKIAotCWlmIChpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGd0LT5pOTE1LCBJOTE1
X0dFTV9JRExFX1RJTUVPVVQpID09IC1FVElNRSkgeworCWlmIChpbnRlbF9ndF93YWl0X2Zvcl9p
ZGxlKGd0LCBJOTE1X0dFTV9JRExFX1RJTUVPVVQpID09IC1FVElNRSkgewogCQkvKiBYWFggaGlk
ZSB3YXJuaW5nIGZyb20gZ2VtX2VpbyAqLwogCQlpZiAoaTkxNV9tb2RwYXJhbXMucmVzZXQpIHsK
IAkJCWRldl9lcnIoZ3QtPmk5MTUtPmRybS5kZXYsCkBAIC0xMjIsMTQgKzEwNiwxMiBAQCB2b2lk
IGk5MTVfZ2VtX3N1c3BlbmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJICogc3Rh
dGUuIEZvcnR1bmF0ZWx5LCB0aGUga2VybmVsX2NvbnRleHQgaXMgZGlzcG9zYWJsZSBhbmQgd2Ug
ZG8KIAkgKiBub3QgcmVseSBvbiBpdHMgc3RhdGUuCiAJICovCi0Jc3dpdGNoX3RvX2tlcm5lbF9j
b250ZXh0X3N5bmMoJmk5MTUtPmd0KTsKKwlpbnRlbF9ndF9zdXNwZW5kKCZpOTE1LT5ndCk7CisJ
aW50ZWxfdWNfc3VzcGVuZCgmaTkxNS0+Z3QudWMpOwogCiAJY2FuY2VsX2RlbGF5ZWRfd29ya19z
eW5jKCZpOTE1LT5ndC5oYW5nY2hlY2sud29yayk7CiAKIAlpOTE1X2dlbV9kcmFpbl9mcmVlZF9v
YmplY3RzKGk5MTUpOwotCi0JaW50ZWxfdWNfc3VzcGVuZCgmaTkxNS0+Z3QudWMpOwotCWludGVs
X2d0X3N1c3BlbmQoJmk5MTUtPmd0KTsKIH0KIAogc3RhdGljIHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpmaXJzdF9tbV9vYmplY3Qoc3RydWN0IGxpc3RfaGVhZCAqbGlzdCkKQEAgLTIzOSw4
ICsyMjEsNiBAQCB2b2lkIGk5MTVfZ2VtX3Jlc3VtZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIAogdm9pZCBpOTE1X2dlbV9pbml0X19wbShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIHsKLQlJTklUX0RFTEFZRURfV09SSygmaTkxNS0+Z2VtLnJldGlyZV93b3JrLCByZXRp
cmVfd29ya19oYW5kbGVyKTsKLQogCWk5MTUtPmdlbS5wbV9ub3RpZmllci5ub3RpZmllcl9jYWxs
ID0gcG1fbm90aWZpZXI7CiAJYmxvY2tpbmdfbm90aWZpZXJfY2hhaW5fcmVnaXN0ZXIoJmk5MTUt
Pmd0LnBtX25vdGlmaWNhdGlvbnMsCiAJCQkJCSAmaTkxNS0+Z2VtLnBtX25vdGlmaWVyKTsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29u
dGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250
ZXh0LmMKaW5kZXggZjkwMmFlZWUxNzU1Li4yMjg4NzU3ODA4YWUgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCkBAIC04
LDYgKzgsNyBAQAogCiAjaW5jbHVkZSAiZ2VtL2k5MTVfZ2VtX3BtLmgiCiAjaW5jbHVkZSAiZ3Qv
aW50ZWxfZ3QuaCIKKyNpbmNsdWRlICJndC9pbnRlbF9ndF9yZXF1ZXN0cy5oIgogI2luY2x1ZGUg
Imd0L2ludGVsX3Jlc2V0LmgiCiAjaW5jbHVkZSAiaTkxNV9zZWxmdGVzdC5oIgogCkBAIC01MTgs
NyArNTE5LDcgQEAgY3JlYXRlX3Rlc3Rfb2JqZWN0KHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ug
KnZtLAogCWludCBlcnI7CiAKIAkvKiBLZWVwIGluIEdFTSdzIGdvb2QgZ3JhY2VzICovCi0JaTkx
NV9yZXRpcmVfcmVxdWVzdHModm0tPmk5MTUpOworCWludGVsX2d0X3JldGlyZV9yZXF1ZXN0cyh2
bS0+Z3QpOwogCiAJc2l6ZSA9IG1pbih2bS0+dG90YWwgLyAyLCAxMDI0dWxsICogRFdfUEVSX1BB
R0UgKiBQQUdFX1NJWkUpOwogCXNpemUgPSByb3VuZF9kb3duKHNpemUsIERXX1BFUl9QQUdFICog
UEFHRV9TSVpFKTsKQEAgLTExMzYsNyArMTEzNyw3IEBAIF9fc3NldV9maW5pc2goY29uc3QgY2hh
ciAqbmFtZSwKIAkJaWd0X3NwaW5uZXJfZW5kKHNwaW4pOwogCiAJaWYgKChmbGFncyAmIFRFU1Rf
SURMRSkgJiYgcmV0ID09IDApIHsKLQkJcmV0ID0gaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShjZS0+
ZW5naW5lLT5pOTE1LAorCQlyZXQgPSBpbnRlbF9ndF93YWl0X2Zvcl9pZGxlKGNlLT5lbmdpbmUt
Pmd0LAogCQkJCQkgICAgIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKIAkJaWYgKHJldCkKIAkJCXJl
dHVybiByZXQ7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3Rz
L2k5MTVfZ2VtX21tYW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkx
NV9nZW1fbW1hbi5jCmluZGV4IDRiYTZlZDVjODMxMy4uMWNkMjVjZmQwMjQ2IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYwpAQCAt
NTczLDcgKzU3Myw3IEBAIHN0YXRpYyB2b2lkIGRpc2FibGVfcmV0aXJlX3dvcmtlcihzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlpOTE1X2dlbV9kcml2ZXJfdW5yZWdpc3Rlcl9f
c2hyaW5rZXIoaTkxNSk7CiAJaW50ZWxfZ3RfcG1fZ2V0KCZpOTE1LT5ndCk7Ci0JY2FuY2VsX2Rl
bGF5ZWRfd29ya19zeW5jKCZpOTE1LT5nZW0ucmV0aXJlX3dvcmspOworCWNhbmNlbF9kZWxheWVk
X3dvcmtfc3luYygmaTkxNS0+Z3QucmVxdWVzdHMucmV0aXJlX3dvcmspOwogfQogCiBzdGF0aWMg
dm9pZCByZXN0b3JlX3JldGlyZV93b3JrZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYwppbmRleCA3MjA1NTk1MzY5YmUuLjUzMjIwNzQx
ZTQ5ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndC5jCkBAIC02LDYgKzYsNyBAQAogI2lu
Y2x1ZGUgImk5MTVfZHJ2LmgiCiAjaW5jbHVkZSAiaW50ZWxfZ3QuaCIKICNpbmNsdWRlICJpbnRl
bF9ndF9wbS5oIgorI2luY2x1ZGUgImludGVsX2d0X3JlcXVlc3RzLmgiCiAjaW5jbHVkZSAiaW50
ZWxfbW9jcy5oIgogI2luY2x1ZGUgImludGVsX3JjNi5oIgogI2luY2x1ZGUgImludGVsX3VuY29y
ZS5oIgpAQCAtMjMsNiArMjQsNyBAQCB2b2lkIGludGVsX2d0X2luaXRfZWFybHkoc3RydWN0IGlu
dGVsX2d0ICpndCwgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAKIAlpbnRlbF9ndF9p
bml0X2hhbmdjaGVjayhndCk7CiAJaW50ZWxfZ3RfaW5pdF9yZXNldChndCk7CisJaW50ZWxfZ3Rf
aW5pdF9yZXF1ZXN0cyhndCk7CiAJaW50ZWxfZ3RfcG1faW5pdF9lYXJseShndCk7CiAJaW50ZWxf
dWNfaW5pdF9lYXJseSgmZ3QtPnVjKTsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2d0X3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9w
bS5jCmluZGV4IGJkYjM0ZjAzZWM0Ny4uZDJlODBiYTY0ZDY5IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2d0X3BtLmMKQEAgLTEwLDYgKzEwLDcgQEAKICNpbmNsdWRlICJpbnRlbF9lbmdp
bmVfcG0uaCIKICNpbmNsdWRlICJpbnRlbF9ndC5oIgogI2luY2x1ZGUgImludGVsX2d0X3BtLmgi
CisjaW5jbHVkZSAiaW50ZWxfZ3RfcmVxdWVzdHMuaCIKICNpbmNsdWRlICJpbnRlbF9wbS5oIgog
I2luY2x1ZGUgImludGVsX3JjNi5oIgogI2luY2x1ZGUgImludGVsX3dha2VyZWYuaCIKQEAgLTQ5
LDYgKzUwLDcgQEAgc3RhdGljIGludCBfX2d0X3VucGFyayhzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAq
d2YpCiAJaTkxNV9wbXVfZ3RfdW5wYXJrZWQoaTkxNSk7CiAKIAlpbnRlbF9ndF9xdWV1ZV9oYW5n
Y2hlY2soZ3QpOworCWludGVsX2d0X3VucGFya19yZXF1ZXN0cyhndCk7CiAKIAlwbV9ub3RpZnko
Z3QsIElOVEVMX0dUX1VOUEFSSyk7CiAKQEAgLTY0LDYgKzY2LDcgQEAgc3RhdGljIGludCBfX2d0
X3Bhcmsoc3RydWN0IGludGVsX3dha2VyZWYgKndmKQogCUdFTV9UUkFDRSgiXG4iKTsKIAogCXBt
X25vdGlmeShndCwgSU5URUxfR1RfUEFSSyk7CisJaW50ZWxfZ3RfcGFya19yZXF1ZXN0cyhndCk7
CiAKIAlpOTE1X3BtdV9ndF9wYXJrZWQoaTkxNSk7CiAJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA2
KQpAQCAtMTk2LDcgKzE5OSw3IEBAIGludCBpbnRlbF9ndF9yZXN1bWUoc3RydWN0IGludGVsX2d0
ICpndCkKIAogc3RhdGljIHZvaWQgd2FpdF9mb3JfaWRsZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQog
ewotCWlmIChpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGd0LT5pOTE1LCBJOTE1X0dFTV9JRExFX1RJ
TUVPVVQpID09IC1FVElNRSkgeworCWlmIChpbnRlbF9ndF93YWl0X2Zvcl9pZGxlKGd0LCBJOTE1
X0dFTV9JRExFX1RJTUVPVVQpID09IC1FVElNRSkgewogCQkvKgogCQkgKiBGb3JjaWJseSBjYW5j
ZWwgb3V0c3RhbmRpbmcgd29yayBhbmQgbGVhdmUKIAkJICogdGhlIGdwdSBxdWlldC4KZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3JlcXVlc3RzLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9yZXF1ZXN0cy5jCm5ldyBmaWxlIG1vZGUgMTAw
NjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uOGFlZDg5ZmQyY2RjCi0tLSAvZGV2L251bGwKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcmVxdWVzdHMuYwpAQCAtMCwwICsxLDEy
MyBAQAorLyoKKyAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKKyAqCisgKiBDb3B5cmln
aHQgwqkgMjAxOSBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpbmNsdWRlICJpOTE1X3JlcXVl
c3QuaCIKKyNpbmNsdWRlICJpbnRlbF9ndC5oIgorI2luY2x1ZGUgImludGVsX2d0X3BtLmgiCisj
aW5jbHVkZSAiaW50ZWxfZ3RfcmVxdWVzdHMuaCIKKyNpbmNsdWRlICJpbnRlbF90aW1lbGluZS5o
IgorCitzdGF0aWMgdm9pZCByZXRpcmVfcmVxdWVzdHMoc3RydWN0IGludGVsX3RpbWVsaW5lICp0
bCkKK3sKKwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgKnJuOworCisJbGlzdF9mb3JfZWFjaF9l
bnRyeV9zYWZlKHJxLCBybiwgJnRsLT5yZXF1ZXN0cywgbGluaykKKwkJaWYgKCFpOTE1X3JlcXVl
c3RfcmV0aXJlKHJxKSkKKwkJCWJyZWFrOworfQorCitsb25nIGludGVsX2d0X3JldGlyZV9yZXF1
ZXN0c190aW1lb3V0KHN0cnVjdCBpbnRlbF9ndCAqZ3QsIGxvbmcgdGltZW91dCkKK3sKKwlzdHJ1
Y3QgaW50ZWxfZ3RfdGltZWxpbmVzICp0aW1lbGluZXMgPSAmZ3QtPnRpbWVsaW5lczsKKwlzdHJ1
Y3QgaW50ZWxfdGltZWxpbmUgKnRsLCAqdG47CisJdW5zaWduZWQgbG9uZyBhY3RpdmVfY291bnQg
PSAwOworCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisJYm9vbCBpbnRlcnJ1cHRpYmxlOworCUxJU1Rf
SEVBRChmcmVlKTsKKworCWludGVycnVwdGlibGUgPSB0cnVlOworCWlmICh1bmxpa2VseSh0aW1l
b3V0IDwgMCkpCisJCXRpbWVvdXQgPSAtdGltZW91dCwgaW50ZXJydXB0aWJsZSA9IGZhbHNlOwor
CisJc3Bpbl9sb2NrX2lycXNhdmUoJnRpbWVsaW5lcy0+bG9jaywgZmxhZ3MpOworCWxpc3RfZm9y
X2VhY2hfZW50cnlfc2FmZSh0bCwgdG4sICZ0aW1lbGluZXMtPmFjdGl2ZV9saXN0LCBsaW5rKSB7
CisJCWlmICghbXV0ZXhfdHJ5bG9jaygmdGwtPm11dGV4KSkKKwkJCWNvbnRpbnVlOworCisJCWlu
dGVsX3RpbWVsaW5lX2dldCh0bCk7CisJCUdFTV9CVUdfT04oIXRsLT5hY3RpdmVfY291bnQpOwor
CQl0bC0+YWN0aXZlX2NvdW50Kys7IC8qIHBpbiB0aGUgbGlzdCBlbGVtZW50ICovCisJCXNwaW5f
dW5sb2NrX2lycXJlc3RvcmUoJnRpbWVsaW5lcy0+bG9jaywgZmxhZ3MpOworCisJCWlmICh0aW1l
b3V0ID4gMCkgeworCQkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CisKKwkJCWZlbmNlID0gaTkx
NV9hY3RpdmVfZmVuY2VfZ2V0KCZ0bC0+bGFzdF9yZXF1ZXN0KTsKKwkJCWlmIChmZW5jZSkgewor
CQkJCXRpbWVvdXQgPSBkbWFfZmVuY2Vfd2FpdF90aW1lb3V0KGZlbmNlLAorCQkJCQkJCQkgdHJ1
ZSwKKwkJCQkJCQkJIHRpbWVvdXQpOworCQkJCWRtYV9mZW5jZV9wdXQoZmVuY2UpOworCQkJfQor
CQl9CisKKwkJcmV0aXJlX3JlcXVlc3RzKHRsKTsKKworCQlzcGluX2xvY2tfaXJxc2F2ZSgmdGlt
ZWxpbmVzLT5sb2NrLCBmbGFncyk7CisKKwkJLyogUmVzdW1lIGl0ZXJhdGlvbiBhZnRlciBkcm9w
cGluZyBsb2NrICovCisJCWxpc3Rfc2FmZV9yZXNldF9uZXh0KHRsLCB0biwgbGluayk7CisJCWlm
ICgtLXRsLT5hY3RpdmVfY291bnQpCisJCQlhY3RpdmVfY291bnQgKz0gISFyY3VfYWNjZXNzX3Bv
aW50ZXIodGwtPmxhc3RfcmVxdWVzdC5mZW5jZSk7CisJCWVsc2UKKwkJCWxpc3RfZGVsKCZ0bC0+
bGluayk7CisKKwkJbXV0ZXhfdW5sb2NrKCZ0bC0+bXV0ZXgpOworCisJCS8qIERlZmVyIHRoZSBm
aW5hbCByZWxlYXNlIHRvIGFmdGVyIHRoZSBzcGlubG9jayAqLworCQlpZiAocmVmY291bnRfZGVj
X2FuZF90ZXN0KCZ0bC0+a3JlZi5yZWZjb3VudCkpIHsKKwkJCUdFTV9CVUdfT04odGwtPmFjdGl2
ZV9jb3VudCk7CisJCQlsaXN0X2FkZCgmdGwtPmxpbmssICZmcmVlKTsKKwkJfQorCX0KKwlzcGlu
X3VubG9ja19pcnFyZXN0b3JlKCZ0aW1lbGluZXMtPmxvY2ssIGZsYWdzKTsKKworCWxpc3RfZm9y
X2VhY2hfZW50cnlfc2FmZSh0bCwgdG4sICZmcmVlLCBsaW5rKQorCQlfX2ludGVsX3RpbWVsaW5l
X2ZyZWUoJnRsLT5rcmVmKTsKKworCXJldHVybiBhY3RpdmVfY291bnQgPyB0aW1lb3V0IDogMDsK
K30KKworaW50IGludGVsX2d0X3dhaXRfZm9yX2lkbGUoc3RydWN0IGludGVsX2d0ICpndCwgbG9u
ZyB0aW1lb3V0KQoreworCS8qIElmIHRoZSBkZXZpY2UgaXMgYXNsZWVwLCB3ZSBoYXZlIG5vIHJl
cXVlc3RzIG91dHN0YW5kaW5nICovCisJaWYgKCFpbnRlbF9ndF9wbV9pc19hd2FrZShndCkpCisJ
CXJldHVybiAwOworCisJd2hpbGUgKCh0aW1lb3V0ID0gaW50ZWxfZ3RfcmV0aXJlX3JlcXVlc3Rz
X3RpbWVvdXQoZ3QsIHRpbWVvdXQpKSA+IDApIHsKKwkJY29uZF9yZXNjaGVkKCk7CisJCWlmIChz
aWduYWxfcGVuZGluZyhjdXJyZW50KSkKKwkJCXJldHVybiAtRUlOVFI7CisJfQorCisJcmV0dXJu
IHRpbWVvdXQ7Cit9CisKK3N0YXRpYyB2b2lkIHJldGlyZV93b3JrX2hhbmRsZXIoc3RydWN0IHdv
cmtfc3RydWN0ICp3b3JrKQoreworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPQorCQljb250YWluZXJf
b2Yod29yaywgdHlwZW9mKCpndCksIHJlcXVlc3RzLnJldGlyZV93b3JrLndvcmspOworCisJaW50
ZWxfZ3RfcmV0aXJlX3JlcXVlc3RzKGd0KTsKKwlzY2hlZHVsZV9kZWxheWVkX3dvcmsoJmd0LT5y
ZXF1ZXN0cy5yZXRpcmVfd29yaywKKwkJCSAgICAgIHJvdW5kX2ppZmZpZXNfdXBfcmVsYXRpdmUo
SFopKTsKK30KKwordm9pZCBpbnRlbF9ndF9pbml0X3JlcXVlc3RzKHN0cnVjdCBpbnRlbF9ndCAq
Z3QpCit7CisJSU5JVF9ERUxBWUVEX1dPUksoJmd0LT5yZXF1ZXN0cy5yZXRpcmVfd29yaywgcmV0
aXJlX3dvcmtfaGFuZGxlcik7Cit9CisKK3ZvaWQgaW50ZWxfZ3RfcGFya19yZXF1ZXN0cyhzdHJ1
Y3QgaW50ZWxfZ3QgKmd0KQoreworCWNhbmNlbF9kZWxheWVkX3dvcmsoJmd0LT5yZXF1ZXN0cy5y
ZXRpcmVfd29yayk7Cit9CisKK3ZvaWQgaW50ZWxfZ3RfdW5wYXJrX3JlcXVlc3RzKHN0cnVjdCBp
bnRlbF9ndCAqZ3QpCit7CisJc2NoZWR1bGVfZGVsYXllZF93b3JrKCZndC0+cmVxdWVzdHMucmV0
aXJlX3dvcmssCisJCQkgICAgICByb3VuZF9qaWZmaWVzX3VwX3JlbGF0aXZlKEhaKSk7Cit9CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9yZXF1ZXN0cy5oIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcmVxdWVzdHMuaApuZXcgZmlsZSBtb2Rl
IDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmJkMzFjYmNlNDdlMAotLS0gL2Rldi9udWxsCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3JlcXVlc3RzLmgKQEAgLTAsMCAr
MSwyNCBAQAorLyoKKyAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKKyAqCisgKiBDb3B5
cmlnaHQgwqkgMjAxOSBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpZm5kZWYgSU5URUxfR1Rf
UkVRVUVTVFNfSAorI2RlZmluZSBJTlRFTF9HVF9SRVFVRVNUU19ICisKK3N0cnVjdCBpbnRlbF9n
dDsKKworbG9uZyBpbnRlbF9ndF9yZXRpcmVfcmVxdWVzdHNfdGltZW91dChzdHJ1Y3QgaW50ZWxf
Z3QgKmd0LCBsb25nIHRpbWVvdXQpOworc3RhdGljIGlubGluZSB2b2lkIGludGVsX2d0X3JldGly
ZV9yZXF1ZXN0cyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQoreworCWludGVsX2d0X3JldGlyZV9yZXF1
ZXN0c190aW1lb3V0KGd0LCAwKTsKK30KKworaW50IGludGVsX2d0X3dhaXRfZm9yX2lkbGUoc3Ry
dWN0IGludGVsX2d0ICpndCwgbG9uZyB0aW1lb3V0KTsKKwordm9pZCBpbnRlbF9ndF9pbml0X3Jl
cXVlc3RzKHN0cnVjdCBpbnRlbF9ndCAqZ3QpOwordm9pZCBpbnRlbF9ndF9wYXJrX3JlcXVlc3Rz
KHN0cnVjdCBpbnRlbF9ndCAqZ3QpOwordm9pZCBpbnRlbF9ndF91bnBhcmtfcmVxdWVzdHMoc3Ry
dWN0IGludGVsX2d0ICpndCk7CisKKyNlbmRpZiAvKiBJTlRFTF9HVF9SRVFVRVNUU19IICovCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90eXBlcy5oIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaAppbmRleCA3MTM0ZjEzMTliYmUu
LjgwMmY1MTZhMzQzMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
Z3RfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90eXBlcy5o
CkBAIC01MCw2ICs1MCwxNyBAQCBzdHJ1Y3QgaW50ZWxfZ3QgewogCQlzdHJ1Y3QgbGlzdF9oZWFk
IGh3c3BfZnJlZV9saXN0OwogCX0gdGltZWxpbmVzOwogCisJc3RydWN0IGludGVsX2d0X3JlcXVl
c3RzIHsKKwkJLyoqCisJCSAqIFdlIGxlYXZlIHRoZSB1c2VyIElSUSBvZmYgYXMgbXVjaCBhcyBw
b3NzaWJsZSwKKwkJICogYnV0IHRoaXMgbWVhbnMgdGhhdCByZXF1ZXN0cyB3aWxsIGZpbmlzaCBh
bmQgbmV2ZXIKKwkJICogYmUgcmV0aXJlZCBvbmNlIHRoZSBzeXN0ZW0gZ29lcyBpZGxlLiBTZXQg
YSB0aW1lciB0bworCQkgKiBmaXJlIHBlcmlvZGljYWxseSB3aGlsZSB0aGUgcmluZyBpcyBydW5u
aW5nLiBXaGVuIGl0CisJCSAqIGZpcmVzLCBnbyByZXRpcmUgcmVxdWVzdHMuCisJCSAqLworCQlz
dHJ1Y3QgZGVsYXllZF93b3JrIHJldGlyZV93b3JrOworCX0gcmVxdWVzdHM7CisKIAlzdHJ1Y3Qg
aW50ZWxfd2FrZXJlZiB3YWtlcmVmOwogCWF0b21pY190IHVzZXJfd2FrZXJlZjsKIApkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfdGltZWxpbmUuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3RpbWVsaW5lLmMKaW5kZXggMTZhYmZhYmYwOGM3
Li5kNmRmNDBjZGM4YTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X3RpbWVsaW5lLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfdGlt
ZWxpbmUuYwpAQCAtOCw2ICs4LDcgQEAKIAogI2luY2x1ZGUgImludGVsX2VuZ2luZV9wbS5oIgog
I2luY2x1ZGUgImludGVsX2d0LmgiCisjaW5jbHVkZSAiaW50ZWxfZ3RfcmVxdWVzdHMuaCIKIAog
I2luY2x1ZGUgIi4uL3NlbGZ0ZXN0cy9pOTE1X3JhbmRvbS5oIgogI2luY2x1ZGUgIi4uL2k5MTVf
c2VsZnRlc3QuaCIKQEAgLTY0MSw2ICs2NDIsNyBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF9hbHRl
cm5hdGUodm9pZCAqYXJnKQogc3RhdGljIGludCBsaXZlX2h3c3Bfd3JhcCh2b2lkICphcmcpCiB7
CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CisJc3RydWN0IGludGVsX2d0
ICpndCA9ICZpOTE1LT5ndDsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJc3Ry
dWN0IGludGVsX3RpbWVsaW5lICp0bDsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKQEAgLTY1
MSw3ICs2NTMsNyBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF93cmFwKHZvaWQgKmFyZykKIAkgKiBm
b3JlaWduIEdQVSByZWZlcmVuY2VzLgogCSAqLwogCi0JdGwgPSBpbnRlbF90aW1lbGluZV9jcmVh
dGUoJmk5MTUtPmd0LCBOVUxMKTsKKwl0bCA9IGludGVsX3RpbWVsaW5lX2NyZWF0ZShndCwgTlVM
TCk7CiAJaWYgKElTX0VSUih0bCkpCiAJCXJldHVybiBQVFJfRVJSKHRsKTsKIApAQCAtNjYyLDcg
KzY2NCw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX3dyYXAodm9pZCAqYXJnKQogCWlmIChlcnIp
CiAJCWdvdG8gb3V0X2ZyZWU7CiAKLQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkg
eworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LT5pOTE1LCBpZCkgewogCQljb25zdCB1MzIg
Kmh3c3Bfc2Vxbm9bMl07CiAJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwogCQl1MzIgc2Vxbm9b
Ml07CkBAIC03MzQsNyArNzM2LDcgQEAgc3RhdGljIGludCBsaXZlX2h3c3Bfd3JhcCh2b2lkICph
cmcpCiAJCQlnb3RvIG91dDsKIAkJfQogCi0JCWk5MTVfcmV0aXJlX3JlcXVlc3RzKGk5MTUpOyAv
KiByZWN5Y2xlIEhXU1AgKi8KKwkJaW50ZWxfZ3RfcmV0aXJlX3JlcXVlc3RzKGd0KTsgLyogcmVj
eWNsZSBIV1NQICovCiAJfQogCiBvdXQ6CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2RlYnVnZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCmlu
ZGV4IDU4ODhhNjU4ZTJiNy4uMmFmYzQxZTQzYjZlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2RlYnVnZnMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rl
YnVnZnMuYwpAQCAtNDEsNiArNDEsNyBAQAogCiAjaW5jbHVkZSAiZ2VtL2k5MTVfZ2VtX2NvbnRl
eHQuaCIKICNpbmNsdWRlICJndC9pbnRlbF9ndF9wbS5oIgorI2luY2x1ZGUgImd0L2ludGVsX2d0
X3JlcXVlc3RzLmgiCiAjaW5jbHVkZSAiZ3QvaW50ZWxfcmVzZXQuaCIKICNpbmNsdWRlICJndC9p
bnRlbF9yYzYuaCIKICNpbmNsdWRlICJndC91Yy9pbnRlbF9ndWNfc3VibWlzc2lvbi5oIgpAQCAt
MzYyMSwzMyArMzYyMiwzMyBAQCBzdGF0aWMgaW50CiBpOTE1X2Ryb3BfY2FjaGVzX3NldCh2b2lk
ICpkYXRhLCB1NjQgdmFsKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZGF0
YTsKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gJmk5MTUtPmd0OwogCWludCByZXQ7CiAKIAlEUk1f
REVCVUcoIkRyb3BwaW5nIGNhY2hlczogMHglMDhsbHggWzB4JTA4bGx4XVxuIiwKIAkJICB2YWws
IHZhbCAmIERST1BfQUxMKTsKIAogCWlmICh2YWwgJiBEUk9QX1JFU0VUX0FDVElWRSAmJgotCSAg
ICB3YWl0X2ZvcihpbnRlbF9lbmdpbmVzX2FyZV9pZGxlKCZpOTE1LT5ndCksCi0JCSAgICAgSTkx
NV9JRExFX0VOR0lORVNfVElNRU9VVCkpCi0JCWludGVsX2d0X3NldF93ZWRnZWQoJmk5MTUtPmd0
KTsKKwkgICAgd2FpdF9mb3IoaW50ZWxfZW5naW5lc19hcmVfaWRsZShndCksIEk5MTVfSURMRV9F
TkdJTkVTX1RJTUVPVVQpKQorCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKGd0KTsKIAogCWlmICh2YWwg
JiBEUk9QX1JFVElSRSkKLQkJaTkxNV9yZXRpcmVfcmVxdWVzdHMoaTkxNSk7CisJCWludGVsX2d0
X3JldGlyZV9yZXF1ZXN0cyhndCk7CiAKIAlpZiAodmFsICYgKERST1BfSURMRSB8IERST1BfQUNU
SVZFKSkgewotCQlyZXQgPSBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGk5MTUsIE1BWF9TQ0hFRFVM
RV9USU1FT1VUKTsKKwkJcmV0ID0gaW50ZWxfZ3Rfd2FpdF9mb3JfaWRsZShndCwgTUFYX1NDSEVE
VUxFX1RJTUVPVVQpOwogCQlpZiAocmV0KQogCQkJcmV0dXJuIHJldDsKIAl9CiAKIAlpZiAodmFs
ICYgRFJPUF9JRExFKSB7Ci0JCXJldCA9IGludGVsX2d0X3BtX3dhaXRfZm9yX2lkbGUoJmk5MTUt
Pmd0KTsKKwkJcmV0ID0gaW50ZWxfZ3RfcG1fd2FpdF9mb3JfaWRsZShndCk7CiAJCWlmIChyZXQp
CiAJCQlyZXR1cm4gcmV0OwogCX0KIAotCWlmICh2YWwgJiBEUk9QX1JFU0VUX0FDVElWRSAmJiBp
bnRlbF9ndF90ZXJtaW5hbGx5X3dlZGdlZCgmaTkxNS0+Z3QpKQotCQlpbnRlbF9ndF9oYW5kbGVf
ZXJyb3IoJmk5MTUtPmd0LCBBTExfRU5HSU5FUywgMCwgTlVMTCk7CisJaWYgKHZhbCAmIERST1Bf
UkVTRVRfQUNUSVZFICYmIGludGVsX2d0X3Rlcm1pbmFsbHlfd2VkZ2VkKGd0KSkKKwkJaW50ZWxf
Z3RfaGFuZGxlX2Vycm9yKGd0LCBBTExfRU5HSU5FUywgMCwgTlVMTCk7CiAKIAlmc19yZWNsYWlt
X2FjcXVpcmUoR0ZQX0tFUk5FTCk7CiAJaWYgKHZhbCAmIERST1BfQk9VTkQpCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9kcnYuaAppbmRleCA0NGYzNDYzZmY5ZjEuLmNiNjNiMmJkMGNlOCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2Rydi5oCkBAIC0xNzEwLDE1ICsxNzEwLDYgQEAgc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgewogCiAJc3RydWN0IHsKIAkJc3RydWN0IG5vdGlmaWVyX2Jsb2NrIHBtX25vdGlmaWVyOwot
Ci0JCS8qKgotCQkgKiBXZSBsZWF2ZSB0aGUgdXNlciBJUlEgb2ZmIGFzIG11Y2ggYXMgcG9zc2li
bGUsCi0JCSAqIGJ1dCB0aGlzIG1lYW5zIHRoYXQgcmVxdWVzdHMgd2lsbCBmaW5pc2ggYW5kIG5l
dmVyCi0JCSAqIGJlIHJldGlyZWQgb25jZSB0aGUgc3lzdGVtIGdvZXMgaWRsZS4gU2V0IGEgdGlt
ZXIgdG8KLQkJICogZmlyZSBwZXJpb2RpY2FsbHkgd2hpbGUgdGhlIHJpbmcgaXMgcnVubmluZy4g
V2hlbiBpdAotCQkgKiBmaXJlcywgZ28gcmV0aXJlIHJlcXVlc3RzLgotCQkgKi8KLQkJc3RydWN0
IGRlbGF5ZWRfd29yayByZXRpcmVfd29yazsKIAl9IGdlbTsKIAogCS8qIEZvciBpOTQ1Z20gdmJs
YW5rIGlycSB2cy4gQzMgd29ya2Fyb3VuZCAqLwpAQCAtMjMyMSw3ICsyMzEyLDYgQEAgdm9pZCBp
OTE1X2dlbV9kcml2ZXJfcmVnaXN0ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpOwog
dm9pZCBpOTE1X2dlbV9kcml2ZXJfdW5yZWdpc3RlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSk7CiB2b2lkIGk5MTVfZ2VtX2RyaXZlcl9yZW1vdmUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KTsKIHZvaWQgaTkxNV9nZW1fZHJpdmVyX3JlbGVhc2Uoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLWludCBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgbG9uZyB0aW1lb3V0KTsKIHZvaWQgaTkxNV9n
ZW1fc3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogdm9pZCBpOTE1
X2dlbV9zdXNwZW5kX2xhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIHZv
aWQgaTkxNV9nZW1fcmVzdW1lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9nZW0uYwppbmRleCA3YzgyZmMzOWY2NTUuLjVhNjY0YmRlYWQ4YyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbS5jCkBAIC04ODMsMjMgKzg4Myw2IEBAIHZvaWQgaTkxNV9nZW1f
cnVudGltZV9zdXNwZW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCX0KIH0KIAot
aW50IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
IGxvbmcgdGltZW91dCkKLXsKLQlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gJmk5MTUtPmd0OwotCi0J
LyogSWYgdGhlIGRldmljZSBpcyBhc2xlZXAsIHdlIGhhdmUgbm8gcmVxdWVzdHMgb3V0c3RhbmRp
bmcgKi8KLQlpZiAoIWludGVsX2d0X3BtX2lzX2F3YWtlKGd0KSkKLQkJcmV0dXJuIDA7Ci0KLQl3
aGlsZSAoKHRpbWVvdXQgPSBpOTE1X3JldGlyZV9yZXF1ZXN0c190aW1lb3V0KGk5MTUsIHRpbWVv
dXQpKSA+IDApIHsKLQkJY29uZF9yZXNjaGVkKCk7Ci0JCWlmIChzaWduYWxfcGVuZGluZyhjdXJy
ZW50KSkKLQkJCXJldHVybiAtRUlOVFI7Ci0JfQotCi0JcmV0dXJuIHRpbWVvdXQ7Ci19Ci0KIHN0
cnVjdCBpOTE1X3ZtYSAqCiBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4oc3RydWN0IGRybV9pOTE1
X2dlbV9vYmplY3QgKm9iaiwKIAkJCSBjb25zdCBzdHJ1Y3QgaTkxNV9nZ3R0X3ZpZXcgKnZpZXcs
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ldmljdC5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZXZpY3QuYwppbmRleCAwYTQxMmY2ZDAxZDcuLjdl
NjJjMzEwMjkwZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZXZp
Y3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ldmljdC5jCkBAIC0yOSw2
ICsyOSw3IEBACiAjaW5jbHVkZSA8ZHJtL2k5MTVfZHJtLmg+CiAKICNpbmNsdWRlICJnZW0vaTkx
NV9nZW1fY29udGV4dC5oIgorI2luY2x1ZGUgImd0L2ludGVsX2d0X3JlcXVlc3RzLmgiCiAKICNp
bmNsdWRlICJpOTE1X2Rydi5oIgogI2luY2x1ZGUgImk5MTVfdHJhY2UuaCIKQEAgLTM3LDcgKzM4
LDcgQEAgSTkxNV9TRUxGVEVTVF9ERUNMQVJFKHN0YXRpYyBzdHJ1Y3QgaWd0X2V2aWN0X2N0bCB7
CiAJYm9vbCBmYWlsX2lmX2J1c3k6MTsKIH0gaWd0X2V2aWN0X2N0bDspCiAKLXN0YXRpYyBpbnQg
Z2d0dF9mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3N0YXRpYyBpbnQgZ2d0
dF9mbHVzaChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogewogCS8qCiAJICogTm90IGV2ZXJ5dGhpbmcg
aW4gdGhlIEdHVFQgaXMgdHJhY2tlZCB2aWEgdm1hIChvdGhlcndpc2Ugd2UKQEAgLTQ2LDcgKzQ3
LDcgQEAgc3RhdGljIGludCBnZ3R0X2ZsdXNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQogCSAqIHRoZSBob3BlcyB0aGF0IHdlIGNhbiB0aGVuIHJlbW92ZSBjb250ZXh0cyBhbmQgdGhl
IGxpa2Ugb25seQogCSAqIGJvdW5kIGJ5IHRoZWlyIGFjdGl2ZSByZWZlcmVuY2UuCiAJICovCi0J
cmV0dXJuIGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoaTkxNSwgTUFYX1NDSEVEVUxFX1RJTUVPVVQp
OworCXJldHVybiBpbnRlbF9ndF93YWl0X2Zvcl9pZGxlKGd0LCBNQVhfU0NIRURVTEVfVElNRU9V
VCk7CiB9CiAKIHN0YXRpYyBib29sCkBAIC05Miw3ICs5Myw2IEBAIGk5MTVfZ2VtX2V2aWN0X3Nv
bWV0aGluZyhzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAkJCSB1NjQgc3RhcnQsIHU2
NCBlbmQsCiAJCQkgdW5zaWduZWQgZmxhZ3MpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdm0tPmk5MTU7CiAJc3RydWN0IGRybV9tbV9zY2FuIHNjYW47CiAJc3RydWN0
IGxpc3RfaGVhZCBldmljdGlvbl9saXN0OwogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hLCAqbmV4dDsK
QEAgLTEyNCw3ICsxMjQsNyBAQCBpOTE1X2dlbV9ldmljdF9zb21ldGhpbmcoc3RydWN0IGk5MTVf
YWRkcmVzc19zcGFjZSAqdm0sCiAJCQkJICAgIG1pbl9zaXplLCBhbGlnbm1lbnQsIGNvbG9yLAog
CQkJCSAgICBzdGFydCwgZW5kLCBtb2RlKTsKIAotCWk5MTVfcmV0aXJlX3JlcXVlc3RzKHZtLT5p
OTE1KTsKKwlpbnRlbF9ndF9yZXRpcmVfcmVxdWVzdHModm0tPmd0KTsKIAogc2VhcmNoX2FnYWlu
OgogCWFjdGl2ZSA9IE5VTEw7CkBAIC0xOTcsNyArMTk3LDcgQEAgaTkxNV9nZW1fZXZpY3Rfc29t
ZXRoaW5nKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCWlmIChJOTE1X1NFTEZURVNU
X09OTFkoaWd0X2V2aWN0X2N0bC5mYWlsX2lmX2J1c3kpKQogCQlyZXR1cm4gLUVCVVNZOwogCi0J
cmV0ID0gZ2d0dF9mbHVzaChkZXZfcHJpdik7CisJcmV0ID0gZ2d0dF9mbHVzaCh2bS0+Z3QpOwog
CWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKQEAgLTI3MCw3ICsyNzAsNyBAQCBpbnQgaTkxNV9n
ZW1fZXZpY3RfZm9yX25vZGUoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJICogYSBz
dHJheSBwaW4gKHByZXZlbnRpbmcgZXZpY3Rpb24pIHRoYXQgY2FuIG9ubHkgYmUgcmVzb2x2ZWQg
YnkKIAkgKiByZXRpcmluZy4KIAkgKi8KLQlpOTE1X3JldGlyZV9yZXF1ZXN0cyh2bS0+aTkxNSk7
CisJaW50ZWxfZ3RfcmV0aXJlX3JlcXVlc3RzKHZtLT5ndCk7CiAKIAlpZiAoaTkxNV92bV9oYXNf
Y2FjaGVfY29sb3Jpbmcodm0pKSB7CiAJCS8qIEV4cGFuZCBzZWFyY2ggdG8gY292ZXIgbmVpZ2hi
b3VyaW5nIGd1YXJkIHBhZ2VzIChvciBsYWNrISkgKi8KQEAgLTM3Miw3ICszNzIsNyBAQCBpbnQg
aTkxNV9nZW1fZXZpY3Rfdm0oc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiAJICogc3dp
dGNoIG90aGVyd2lzZSBpcyBpbmVmZmVjdGl2ZS4KIAkgKi8KIAlpZiAoaTkxNV9pc19nZ3R0KHZt
KSkgewotCQlyZXQgPSBnZ3R0X2ZsdXNoKHZtLT5pOTE1KTsKKwkJcmV0ID0gZ2d0dF9mbHVzaCh2
bS0+Z3QpOwogCQlpZiAocmV0KQogCQkJcmV0dXJuIHJldDsKIAl9CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ2VtX2d0dC5jCmluZGV4IDA4MmZjZjkwODVhNi4uMWQyNjYzNGNhNTk3IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbV9ndHQuYwpAQCAtMzgsNiArMzgsNyBAQAogCiAjaW5jbHVkZSAiZGlz
cGxheS9pbnRlbF9mcm9udGJ1ZmZlci5oIgogI2luY2x1ZGUgImd0L2ludGVsX2d0LmgiCisjaW5j
bHVkZSAiZ3QvaW50ZWxfZ3RfcmVxdWVzdHMuaCIKIAogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAj
aW5jbHVkZSAiaTkxNV9zY2F0dGVybGlzdC5oIgpAQCAtMjUyOSw4ICsyNTMwLDggQEAgdm9pZCBp
OTE1X2dlbV9ndHRfZmluaXNoX3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmos
CiAKIAlpZiAodW5saWtlbHkoZ2d0dC0+ZG9faWRsZV9tYXBzKSkgewogCQkvKiBYWFggVGhpcyBk
b2VzIG5vdCBwcmV2ZW50IG1vcmUgcmVxdWVzdHMgYmVpbmcgc3VibWl0dGVkISAqLwotCQlpZiAo
aTkxNV9yZXRpcmVfcmVxdWVzdHNfdGltZW91dChkZXZfcHJpdiwKLQkJCQkJCSAtTUFYX1NDSEVE
VUxFX1RJTUVPVVQpKSB7CisJCWlmIChpbnRlbF9ndF9yZXRpcmVfcmVxdWVzdHNfdGltZW91dChn
Z3R0LT52bS5ndCwKKwkJCQkJCSAgICAgLU1BWF9TQ0hFRFVMRV9USU1FT1VUKSkgewogCQkJRFJN
X0VSUk9SKCJGYWlsZWQgdG8gd2FpdCBmb3IgaWRsZTsgVlQnZCBtYXkgaGFuZy5cbiIpOwogCQkJ
LyogV2FpdCBhIGJpdCwgaW4gaG9wZXMgaXQgYXZvaWRzIHRoZSBoYW5nICovCiAJCQl1ZGVsYXko
MTApOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYwppbmRleCA1MmY3YzRlNWI2NDQuLjQz
N2Y5ZmM2MjgyZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKQEAgLTIxNiw3ICsy
MTYsNyBAQCBzdGF0aWMgdm9pZCByZW1vdmVfZnJvbV9lbmdpbmUoc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnEpCiAJc3Bpbl91bmxvY2soJmxvY2tlZC0+YWN0aXZlLmxvY2spOwogfQogCi1zdGF0aWMg
Ym9vbCBpOTE1X3JlcXVlc3RfcmV0aXJlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQorYm9vbCBp
OTE1X3JlcXVlc3RfcmV0aXJlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogewogCWlmICghaTkx
NV9yZXF1ZXN0X2NvbXBsZXRlZChycSkpCiAJCXJldHVybiBmYWxzZTsKQEAgLTE1MDgsNjggKzE1
MDgsNiBAQCBsb25nIGk5MTVfcmVxdWVzdF93YWl0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAog
CXJldHVybiB0aW1lb3V0OwogfQogCi1sb25nIGk5MTVfcmV0aXJlX3JlcXVlc3RzX3RpbWVvdXQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIGxvbmcgdGltZW91dCkKLXsKLQlzdHJ1Y3Qg
aW50ZWxfZ3RfdGltZWxpbmVzICp0aW1lbGluZXMgPSAmaTkxNS0+Z3QudGltZWxpbmVzOwotCXN0
cnVjdCBpbnRlbF90aW1lbGluZSAqdGwsICp0bjsKLQl1bnNpZ25lZCBsb25nIGFjdGl2ZV9jb3Vu
dCA9IDA7Ci0JdW5zaWduZWQgbG9uZyBmbGFnczsKLQlib29sIGludGVycnVwdGlibGU7Ci0JTElT
VF9IRUFEKGZyZWUpOwotCi0JaW50ZXJydXB0aWJsZSA9IHRydWU7Ci0JaWYgKHRpbWVvdXQgPCAw
KQotCQl0aW1lb3V0ID0gLXRpbWVvdXQsIGludGVycnVwdGlibGUgPSBmYWxzZTsKLQotCXNwaW5f
bG9ja19pcnFzYXZlKCZ0aW1lbGluZXMtPmxvY2ssIGZsYWdzKTsKLQlsaXN0X2Zvcl9lYWNoX2Vu
dHJ5X3NhZmUodGwsIHRuLCAmdGltZWxpbmVzLT5hY3RpdmVfbGlzdCwgbGluaykgewotCQlpZiAo
IW11dGV4X3RyeWxvY2soJnRsLT5tdXRleCkpCi0JCQljb250aW51ZTsKLQotCQlpbnRlbF90aW1l
bGluZV9nZXQodGwpOwotCQlHRU1fQlVHX09OKCF0bC0+YWN0aXZlX2NvdW50KTsKLQkJdGwtPmFj
dGl2ZV9jb3VudCsrOyAvKiBwaW4gdGhlIGxpc3QgZWxlbWVudCAqLwotCQlzcGluX3VubG9ja19p
cnFyZXN0b3JlKCZ0aW1lbGluZXMtPmxvY2ssIGZsYWdzKTsKLQotCQlpZiAodGltZW91dCA+IDAp
IHsKLQkJCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlOwotCi0JCQlmZW5jZSA9IGk5MTVfYWN0aXZl
X2ZlbmNlX2dldCgmdGwtPmxhc3RfcmVxdWVzdCk7Ci0JCQlpZiAoZmVuY2UpIHsKLQkJCQl0aW1l
b3V0ID0gZG1hX2ZlbmNlX3dhaXRfdGltZW91dChmZW5jZSwKLQkJCQkJCQkJIGludGVycnVwdGli
bGUsCi0JCQkJCQkJCSB0aW1lb3V0KTsKLQkJCQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKLQkJCX0K
LQkJfQotCi0JCXJldGlyZV9yZXF1ZXN0cyh0bCk7Ci0KLQkJc3Bpbl9sb2NrX2lycXNhdmUoJnRp
bWVsaW5lcy0+bG9jaywgZmxhZ3MpOwotCi0JCS8qIFJlc3VtZSBpdGVyYXRpb24gYWZ0ZXIgZHJv
cHBpbmcgbG9jayAqLwotCQlsaXN0X3NhZmVfcmVzZXRfbmV4dCh0bCwgdG4sIGxpbmspOwotCQlp
ZiAoLS10bC0+YWN0aXZlX2NvdW50KQotCQkJYWN0aXZlX2NvdW50ICs9ICEhcmN1X2FjY2Vzc19w
b2ludGVyKHRsLT5sYXN0X3JlcXVlc3QuZmVuY2UpOwotCQllbHNlCi0JCQlsaXN0X2RlbCgmdGwt
PmxpbmspOwotCi0JCW11dGV4X3VubG9jaygmdGwtPm11dGV4KTsKLQotCQkvKiBEZWZlciB0aGUg
ZmluYWwgcmVsZWFzZSB0byBhZnRlciB0aGUgc3BpbmxvY2sgKi8KLQkJaWYgKHJlZmNvdW50X2Rl
Y19hbmRfdGVzdCgmdGwtPmtyZWYucmVmY291bnQpKSB7Ci0JCQlHRU1fQlVHX09OKHRsLT5hY3Rp
dmVfY291bnQpOwotCQkJbGlzdF9hZGQoJnRsLT5saW5rLCAmZnJlZSk7Ci0JCX0KLQl9Ci0Jc3Bp
bl91bmxvY2tfaXJxcmVzdG9yZSgmdGltZWxpbmVzLT5sb2NrLCBmbGFncyk7Ci0KLQlsaXN0X2Zv
cl9lYWNoX2VudHJ5X3NhZmUodGwsIHRuLCAmZnJlZSwgbGluaykKLQkJX19pbnRlbF90aW1lbGlu
ZV9mcmVlKCZ0bC0+a3JlZik7Ci0KLQlyZXR1cm4gYWN0aXZlX2NvdW50ID8gdGltZW91dCA6IDA7
Ci19Ci0KICNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9TRUxGVEVTVCkKICNpbmNsdWRl
ICJzZWxmdGVzdHMvbW9ja19yZXF1ZXN0LmMiCiAjaW5jbHVkZSAic2VsZnRlc3RzL2k5MTVfcmVx
dWVzdC5jIgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0Lmgg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaAppbmRleCAyNTZiMDcxNTE4MGYu
LjZhOTUyNDJiMjgwZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1
ZXN0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmgKQEAgLTI1MCw2
ICsyNTAsNyBAQCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpfX2k5MTVfcmVxdWVzdF9jb21taXQoc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdCk7CiB2b2lkIF9faTkxNV9yZXF1ZXN0X3F1ZXVlKHN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAogCQkJICBjb25zdCBzdHJ1Y3QgaTkxNV9zY2hlZF9hdHRy
ICphdHRyKTsKIAorYm9vbCBpOTE1X3JlcXVlc3RfcmV0aXJlKHN0cnVjdCBpOTE1X3JlcXVlc3Qg
KnJxKTsKIHZvaWQgaTkxNV9yZXF1ZXN0X3JldGlyZV91cHRvKHN0cnVjdCBpOTE1X3JlcXVlc3Qg
KnJxKTsKIAogc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICoKQEAgLTQ1OSwxMCAr
NDYwLDQgQEAgaTkxNV9yZXF1ZXN0X2FjdGl2ZV90aW1lbGluZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycSkKIAkJCQkJIGxvY2tkZXBfaXNfaGVsZCgmcnEtPmVuZ2luZS0+YWN0aXZlLmxvY2spKTsK
IH0KIAotbG9uZyBpOTE1X3JldGlyZV9yZXF1ZXN0c190aW1lb3V0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LCBsb25nIHRpbWVvdXQpOwotc3RhdGljIGlubGluZSB2b2lkIGk5MTVfcmV0
aXJlX3JlcXVlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQotewotCWk5MTVfcmV0
aXJlX3JlcXVlc3RzX3RpbWVvdXQoaTkxNSwgMCk7Ci19Ci0KICNlbmRpZiAvKiBJOTE1X1JFUVVF
U1RfSCAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9m
bHVzaF90ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2ZsdXNoX3Rl
c3QuYwppbmRleCBlZDQ5NmJkNmQ4NGYuLjdiMDkzOWUzZjAwNyAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9mbHVzaF90ZXN0LmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9mbHVzaF90ZXN0LmMKQEAgLTQsOCArNCw4IEBACiAg
KiBDb3B5cmlnaHQgwqkgMjAxOCBJbnRlbCBDb3Jwb3JhdGlvbgogICovCiAKLSNpbmNsdWRlICJn
ZW0vaTkxNV9nZW1fY29udGV4dC5oIgogI2luY2x1ZGUgImd0L2ludGVsX2d0LmgiCisjaW5jbHVk
ZSAiZ3QvaW50ZWxfZ3RfcmVxdWVzdHMuaCIKIAogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAjaW5j
bHVkZSAiaTkxNV9zZWxmdGVzdC5oIgpAQCAtMTQsMTEgKzE0LDEyIEBACiAKIGludCBpZ3RfZmx1
c2hfdGVzdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlpbnQgcmV0ID0gaW50
ZWxfZ3RfaXNfd2VkZ2VkKCZpOTE1LT5ndCkgPyAtRUlPIDogMDsKKwlzdHJ1Y3QgaW50ZWxfZ3Qg
Kmd0ID0gJmk5MTUtPmd0OworCWludCByZXQgPSBpbnRlbF9ndF9pc193ZWRnZWQoZ3QpID8gLUVJ
TyA6IDA7CiAKIAljb25kX3Jlc2NoZWQoKTsKIAotCWlmIChpOTE1X2dlbV93YWl0X2Zvcl9pZGxl
KGk5MTUsIEhaIC8gNSkgPT0gLUVUSU1FKSB7CisJaWYgKGludGVsX2d0X3dhaXRfZm9yX2lkbGUo
Z3QsIEhaIC8gNSkgPT0gLUVUSU1FKSB7CiAJCXByX2VycigiJXBTIHRpbWVkIG91dCwgY2FuY2Vs
bGluZyBhbGwgZnVydGhlciB0ZXN0aW5nLlxuIiwKIAkJICAgICAgIF9fYnVpbHRpbl9yZXR1cm5f
YWRkcmVzcygwKSk7CiAKQEAgLTI2LDcgKzI3LDcgQEAgaW50IGlndF9mbHVzaF90ZXN0KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCQkJICBfX2J1aWx0aW5fcmV0dXJuX2FkZHJlc3Mo
MCkpOwogCQlHRU1fVFJBQ0VfRFVNUCgpOwogCi0JCWludGVsX2d0X3NldF93ZWRnZWQoJmk5MTUt
Pmd0KTsKKwkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CiAJCXJldCA9IC1FSU87CiAJfQogCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2xpdmVfdGVzdC5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9saXZlX3Rlc3QuYwppbmRleCBl
YWU5MGY5N2RmNmMuLjgxMGI2MDEwMGMyYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvc2VsZnRlc3RzL2lndF9saXZlX3Rlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvaWd0X2xpdmVfdGVzdC5jCkBAIC00LDcgKzQsOCBAQAogICogQ29weXJpZ2h0IMKp
IDIwMTggSW50ZWwgQ29ycG9yYXRpb24KICAqLwogCi0jaW5jbHVkZSAiLi4vaTkxNV9kcnYuaCIK
KyNpbmNsdWRlICJpOTE1X2Rydi5oIgorI2luY2x1ZGUgImd0L2ludGVsX2d0X3JlcXVlc3RzLmgi
CiAKICNpbmNsdWRlICIuLi9pOTE1X3NlbGZ0ZXN0LmgiCiAjaW5jbHVkZSAiaWd0X2ZsdXNoX3Rl
c3QuaCIKQEAgLTIzLDcgKzI0LDcgQEAgaW50IGlndF9saXZlX3Rlc3RfYmVnaW4oc3RydWN0IGln
dF9saXZlX3Rlc3QgKnQsCiAJdC0+ZnVuYyA9IGZ1bmM7CiAJdC0+bmFtZSA9IG5hbWU7CiAKLQll
cnIgPSBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGk5MTUsIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsK
KwllcnIgPSBpbnRlbF9ndF93YWl0X2Zvcl9pZGxlKCZpOTE1LT5ndCwgTUFYX1NDSEVEVUxFX1RJ
TUVPVVQpOwogCWlmIChlcnIpIHsKIAkJcHJfZXJyKCIlcyglcyk6IGZhaWxlZCB0byBpZGxlIGJl
Zm9yZSwgd2l0aCBlcnI9JWQhIiwKIAkJICAgICAgIGZ1bmMsIG5hbWUsIGVycik7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKaW5kZXggM2I1
ODliYmIyYzJkLi40ZTZjZGUwZDQ4NTkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKQEAgLTI2LDYgKzI2LDcgQEAKICNpbmNsdWRlIDxs
aW51eC9wbV9ydW50aW1lLmg+CiAKICNpbmNsdWRlICJndC9pbnRlbF9ndC5oIgorI2luY2x1ZGUg
Imd0L2ludGVsX2d0X3JlcXVlc3RzLmgiCiAjaW5jbHVkZSAiZ3QvbW9ja19lbmdpbmUuaCIKIAog
I2luY2x1ZGUgIm1vY2tfcmVxdWVzdC5oIgpAQCAtNDQsNyArNDUsOCBAQCB2b2lkIG1vY2tfZGV2
aWNlX2ZsdXNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCWRvIHsKIAkJZm9yX2Vh
Y2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpCiAJCQltb2NrX2VuZ2luZV9mbHVzaChlbmdpbmUp
OwotCX0gd2hpbGUgKGk5MTVfcmV0aXJlX3JlcXVlc3RzX3RpbWVvdXQoaTkxNSwgTUFYX1NDSEVE
VUxFX1RJTUVPVVQpKTsKKwl9IHdoaWxlIChpbnRlbF9ndF9yZXRpcmVfcmVxdWVzdHNfdGltZW91
dCgmaTkxNS0+Z3QsCisJCQkJCQkgIE1BWF9TQ0hFRFVMRV9USU1FT1VUKSk7CiB9CiAKIHN0YXRp
YyB2b2lkIG1vY2tfZGV2aWNlX3JlbGVhc2Uoc3RydWN0IGRybV9kZXZpY2UgKmRldikKQEAgLTk4
LDEwICsxMDAsNiBAQCBzdGF0aWMgdm9pZCByZWxlYXNlX2RldihzdHJ1Y3QgZGV2aWNlICpkZXYp
CiAJa2ZyZWUocGRldik7CiB9CiAKLXN0YXRpYyB2b2lkIG1vY2tfcmV0aXJlX3dvcmtfaGFuZGxl
cihzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCi17Ci19Ci0KIHN0YXRpYyBpbnQgcG1fZG9tYWlu
X3Jlc3VtZShzdHJ1Y3QgZGV2aWNlICpkZXYpCiB7CiAJcmV0dXJuIHBtX2dlbmVyaWNfcnVudGlt
ZV9yZXN1bWUoZGV2KTsKQEAgLTE4MSw4ICsxNzksNiBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqbW9ja19nZW1fZGV2aWNlKHZvaWQpCiAKIAltb2NrX2luaXRfY29udGV4dHMoaTkxNSk7CiAK
LQlJTklUX0RFTEFZRURfV09SSygmaTkxNS0+Z2VtLnJldGlyZV93b3JrLCBtb2NrX3JldGlyZV93
b3JrX2hhbmRsZXIpOwotCiAJaW50ZWxfdGltZWxpbmVzX2luaXQoaTkxNSk7CiAKIAltdXRleF9s
b2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJ
bnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Au
b3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

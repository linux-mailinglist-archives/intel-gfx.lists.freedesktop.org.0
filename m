Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 8637690056
	for <lists+intel-gfx@lfdr.de>; Fri, 16 Aug 2019 12:55:17 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9A52D6E2FD;
	Fri, 16 Aug 2019 10:55:15 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga06.intel.com (mga06.intel.com [134.134.136.31])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 05BF16E2EF
 for <intel-gfx@lists.freedesktop.org>; Fri, 16 Aug 2019 10:55:10 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga004.fm.intel.com ([10.253.24.48])
 by orsmga104.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 16 Aug 2019 03:55:10 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,393,1559545200"; d="scan'208";a="201514091"
Received: from irvmail001.ir.intel.com ([163.33.26.43])
 by fmsmga004.fm.intel.com with ESMTP; 16 Aug 2019 03:55:08 -0700
Received: from mwajdecz-MOBL1.ger.corp.intel.com
 (mwajdecz-mobl1.ger.corp.intel.com [10.249.129.244])
 by irvmail001.ir.intel.com (8.14.3/8.13.6/MailSET/Hub) with ESMTP id
 x7GAt5dx010923; Fri, 16 Aug 2019 11:55:07 +0100
From: Michal Wajdeczko <michal.wajdeczko@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 16 Aug 2019 10:54:59 +0000
Message-Id: <20190816105501.31020-4-michal.wajdeczko@intel.com>
X-Mailer: git-send-email 2.21.0.windows.1
In-Reply-To: <20190816105501.31020-1-michal.wajdeczko@intel.com>
References: <20190816105501.31020-1-michal.wajdeczko@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v3 3/5] drm/i915/wopcm: Try to use already
 locked WOPCM layout
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SWYgV09QQ00gbGF5b3V0IGlzIGFscmVhZHkgbG9ja2VkIGluIEhXIHdlIHNob3VsZG4ndCBjb250
aW51ZQp3aXRoIG91ciBvd24gcGFydGl0aW9uaW5nIGFzIGl0IGNvdWxkIGJlIGxpa2VseSBkaWZm
ZXJlbnQgYW5kCndlIHdpbGwgYmUgdW5hYmxlIHRvIGVuZm9yY2UgaXQgYW5kIGZhaWwuIEluc3Rl
YWQgd2Ugc2hvdWxkIHRyeQp0byByZXVzZSB3aGF0IGlzIGFscmVhZHkgcHJvZ3JhbW1lZCwgbWF5
YmUgdGhlcmUgd2lsbCBiZSBhIGZpdC4KClRoaXMgc2hvdWxkIGVuYWJsZSB1cyB0byByZWxvYWQg
ZHJpdmVyIHdpdGggc2xpZ2h0bHkgZGlmZmVyZW50Ckh1QyBmaXJtd2FyZSAob3IgZXZlbiB3aXRo
b3V0IEh1Qykgd2l0aG91dCBuZWVkIHRvIHJlYm9vdC4KCnYyOiByZW9yZGVyZWQvcmViYXNlZAoK
U2lnbmVkLW9mZi1ieTogTWljaGFsIFdhamRlY3prbyA8bWljaGFsLndhamRlY3prb0BpbnRlbC5j
b20+CkNjOiBEYW5pZWxlIENlcmFvbG8gU3B1cmlvIDxkYW5pZWxlLmNlcmFvbG9zcHVyaW9AaW50
ZWwuY29tPgpDYzogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBN
aWNoYWwgV2luaWFyc2tpIDxtaWNoYWwud2luaWFyc2tpQGludGVsLmNvbT4KUmV2aWV3ZWQtYnk6
IERhbmllbGUgQ2VyYW9sbyBTcHVyaW8gPGRhbmllbGUuY2VyYW9sb3NwdXJpb0BpbnRlbC5jb20+
Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd29wY20uYyB8IDI5ICsrKysrKysrKysr
KysrKysrKysrKysrKysrKy0tCiAxIGZpbGUgY2hhbmdlZCwgMjcgaW5zZXJ0aW9ucygrKSwgMiBk
ZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF93b3Bj
bS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd29wY20uYwppbmRleCBmNWNmMTFlMmVm
YmQuLjIwOWMzYjU4OTEzNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
d29wY20uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF93b3BjbS5jCkBAIC0xOTAs
NiArMTkwLDIxIEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBfX2NoZWNrX2xheW91dChzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTMyIHdvcGNtX3NpemUsCiAJCQkJICAgICBodWNfZndfc2l6
ZSk7CiB9CiAKK3N0YXRpYyBib29sIF9fd29wY21fcmVnc19sb2NrZWQoc3RydWN0IGludGVsX3Vu
Y29yZSAqdW5jb3JlLAorCQkJCXUzMiAqZ3VjX3dvcGNtX2Jhc2UsIHUzMiAqZ3VjX3dvcGNtX3Np
emUpCit7CisJdTMyIHJlZ19iYXNlID0gaW50ZWxfdW5jb3JlX3JlYWQodW5jb3JlLCBETUFfR1VD
X1dPUENNX09GRlNFVCk7CisJdTMyIHJlZ19zaXplID0gaW50ZWxfdW5jb3JlX3JlYWQodW5jb3Jl
LCBHVUNfV09QQ01fU0laRSk7CisKKwlpZiAoIShyZWdfc2l6ZSAmIEdVQ19XT1BDTV9TSVpFX0xP
Q0tFRCkgfHwKKwkgICAgIShyZWdfYmFzZSAmIEdVQ19XT1BDTV9PRkZTRVRfVkFMSUQpKQorCQly
ZXR1cm4gZmFsc2U7CisKKwkqZ3VjX3dvcGNtX2Jhc2UgPSByZWdfYmFzZSAmIEdVQ19XT1BDTV9P
RkZTRVRfTUFTSzsKKwkqZ3VjX3dvcGNtX3NpemUgPSByZWdfc2l6ZSAmIEdVQ19XT1BDTV9TSVpF
X01BU0s7CisJcmV0dXJuIHRydWU7Cit9CisKIC8qKgogICogaW50ZWxfd29wY21faW5pdCgpIC0g
SW5pdGlhbGl6ZSB0aGUgV09QQ00gc3RydWN0dXJlLgogICogQHdvcGNtOiBwb2ludGVyIHRvIGlu
dGVsX3dvcGNtLgpAQCAtMjAzLDggKzIxOCw5IEBAIHN0YXRpYyBpbmxpbmUgYm9vbCBfX2NoZWNr
X2xheW91dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTMyIHdvcGNtX3NpemUsCiB2
b2lkIGludGVsX3dvcGNtX2luaXQoc3RydWN0IGludGVsX3dvcGNtICp3b3BjbSkKIHsKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHdvcGNtX3RvX2k5MTUod29wY20pOwotCXUzMiBn
dWNfZndfc2l6ZSA9IGludGVsX3VjX2Z3X2dldF91cGxvYWRfc2l6ZSgmaTkxNS0+Z3QudWMuZ3Vj
LmZ3KTsKLQl1MzIgaHVjX2Z3X3NpemUgPSBpbnRlbF91Y19md19nZXRfdXBsb2FkX3NpemUoJmk5
MTUtPmd0LnVjLmh1Yy5mdyk7CisJc3RydWN0IGludGVsX2d0ICpndCA9ICZpOTE1LT5ndDsKKwl1
MzIgZ3VjX2Z3X3NpemUgPSBpbnRlbF91Y19md19nZXRfdXBsb2FkX3NpemUoJmd0LT51Yy5ndWMu
ZncpOworCXUzMiBodWNfZndfc2l6ZSA9IGludGVsX3VjX2Z3X2dldF91cGxvYWRfc2l6ZSgmZ3Qt
PnVjLmh1Yy5mdyk7CiAJdTMyIGN0eF9yc3ZkID0gY29udGV4dF9yZXNlcnZlZF9zaXplKGk5MTUp
OwogCXUzMiBndWNfd29wY21fYmFzZTsKIAl1MzIgZ3VjX3dvcGNtX3NpemU7CkBAIC0yMjIsNiAr
MjM4LDE0IEBAIHZvaWQgaW50ZWxfd29wY21faW5pdChzdHJ1Y3QgaW50ZWxfd29wY20gKndvcGNt
KQogCWlmIChpOTE1X2luamVjdF9wcm9iZV9mYWlsdXJlKGk5MTUpKQogCQlyZXR1cm47CiAKKwlp
ZiAoX193b3BjbV9yZWdzX2xvY2tlZChndC0+dW5jb3JlLCAmZ3VjX3dvcGNtX2Jhc2UsICZndWNf
d29wY21fc2l6ZSkpIHsKKwkJRFJNX0RFVl9ERUJVR19EUklWRVIoaTkxNS0+ZHJtLmRldiwKKwkJ
CQkgICAgICJHdUMgV09QQ00gaXMgYWxyZWFkeSBsb2NrZWQgWyV1SywgJXVLKVxuIiwKKwkJCQkg
ICAgIGd1Y193b3BjbV9iYXNlIC8gU1pfMUssCisJCQkJICAgICBndWNfd29wY21fc2l6ZSAvIFNa
XzFLKTsKKwkJZ290byBjaGVjazsKKwl9CisKIAkvKgogCSAqIEFsaWduZWQgdmFsdWUgb2YgZ3Vj
X3dvcGNtX2Jhc2Ugd2lsbCBkZXRlcm1pbmUgYXZhaWxhYmxlIFdPUENNIHNwYWNlCiAJICogZm9y
IEh1QyBmaXJtd2FyZSBhbmQgbWFuZGF0b3J5IHJlc2VydmVkIGFyZWEuCkBAIC0yNDIsNiArMjY2
LDcgQEAgdm9pZCBpbnRlbF93b3BjbV9pbml0KHN0cnVjdCBpbnRlbF93b3BjbSAqd29wY20pCiAJ
RFJNX0RFVl9ERUJVR19EUklWRVIoaTkxNS0+ZHJtLmRldiwgIkNhbGN1bGF0ZWQgR3VDIFdPUENN
IFsldUssICV1SylcbiIsCiAJCQkgICAgIGd1Y193b3BjbV9iYXNlIC8gU1pfMUssIGd1Y193b3Bj
bV9zaXplIC8gU1pfMUspOwogCitjaGVjazoKIAlpZiAoX19jaGVja19sYXlvdXQoaTkxNSwgd29w
Y20tPnNpemUsIGd1Y193b3BjbV9iYXNlLCBndWNfd29wY21fc2l6ZSwKIAkJCSAgIGd1Y19md19z
aXplLCBodWNfZndfc2l6ZSkpIHsKIAkJd29wY20tPmd1Yy5iYXNlID0gZ3VjX3dvcGNtX2Jhc2U7
Ci0tIAoyLjE5LjIKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdm
eA==

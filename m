Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 75F2849AF5
	for <lists+intel-gfx@lfdr.de>; Tue, 18 Jun 2019 09:44:24 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id DDEC96E11C;
	Tue, 18 Jun 2019 07:44:22 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A38736E11C
 for <intel-gfx@lists.freedesktop.org>; Tue, 18 Jun 2019 07:44:19 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16935657-1500050 
 for multiple; Tue, 18 Jun 2019 08:42:38 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 18 Jun 2019 08:41:43 +0100
Message-Id: <20190618074153.16055-16-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190618074153.16055-1-chris@chris-wilson.co.uk>
References: <20190618074153.16055-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 16/26] drm/i915: Throw away the active object
 retirement complexity
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Matthew Auld <matthew.auld@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UmVtb3ZlIHRoZSBhY2N1bXVsYXRlZCBvcHRpbWlzYXRpb25zIHRoYXQgd2UgaGF2ZSBmb3IgaTkx
NV92bWFfcmV0aXJlCmFuZCByZWR1Y2UgaXQgdG8gdGhlIGJhcmUgZXNzZW50aWFsIG9mIHRyYWNr
aW5nIHRoZSBhY3RpdmUgb2JqZWN0CnJlZmVyZW5jZS4gVGhpcyBhbGxvd3MgdXMgdG8gb25seSB1
c2UgYXRvbWljIG9wZXJhdGlvbnMsIGFuZCBzbyB3aWxsIGJlCmFibGUgdG8gYXZvaWQgdGhlIHN0
cnVjdF9tdXRleCByZXF1aXJlbWVudC4KClRoZSBwcmluY2lwYWwgbG9zcyBoZXJlIGlzIHRoZSBz
aHJpbmtlciBNUlUgYnVtcGluZywgc28gbm93IGlmIHdlIGhhdmUKdG8gc2hyaW5rLCB3ZSB3aWxs
IGRvIHNvIGluIG11Y2ggbW9yZSByYW5kb20gb3JkZXIgYW5kIG1vcmUgbGlrZWx5IHRvCnRyeSBh
bmQgc2hyaW5rIHJlY2VudGx5IHVzZWQgb2JqZWN0cy4gVGhhdCBpcyBhIG51aXNhbmNlLCBidXQg
c2hyaW5raW5nCmFjdGl2ZSBvYmplY3RzIGlzIGEgc2Vjb25kIHN0ZXAgd2UgdHJ5IHRvIGF2b2lk
IGFuZCB3aWxsIGFsd2F5cyBiZSBhCnN5c3RlbS13aWRlIHBlcmZvcm1hbmNlIGlzc3VlLgoKVGhl
IG90aGVyIGxvc3MgaXMgaGVyZSBpcyBpbiB0aGUgYXV0b21hdGljIHBydW5pbmcgb2YgdGhlCnJl
c2VydmF0aW9uX29iamVjdCB3aGVuIGlkbGluZy4gVGhpcyBpcyBub3QgYXMgbGFyZ2UgYW4gaXNz
dWUgYXMgdXBvbgpyZXNlcnZhdGlvbl9vYmplY3QgaW50cm9kdWN0aW9uIGFzIG5vdyBhZGRpbmcg
bmV3IGZlbmNlcyBpbnRvIHRoZSBvYmplY3QKcmVwbGFjZXMgYWxyZWFkeSBzaWduYWxlZCBmZW5j
ZXMsIGtlZXBpbmcgdGhlIGFycmF5IGNvbXBhY3QuIEJ1dCB3ZSBkbwpsb3NlIHRoZSBhdXRvLWV4
cGlyYXRpb24gb2Ygc3RhbGUgZmVuY2VzIGFuZCB1bnVzZWQgYXJyYXlzLiBUaGF0IG1heSBiZQph
IG5vdGljZWFibGUgcHJvYmxlbSBmb3Igd2hpY2ggd2UgbmVlZCB0byByZS1pbXBsZW1lbnQgYXV0
b3BydW5pbmcuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNv
bi5jby51az4KUmV2aWV3ZWQtYnk6IE1hdHRoZXcgQXVsZCA8bWF0dGhldy5hdWxkQGludGVsLmNv
bT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMgICAgfCAg
MSAtCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmggICAgfCAgNiAt
LS0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oICB8ICAxIC0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jICB8ICA1ICstCiAu
Li4vZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMgICAgfCAgOSAtLS0tCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyAgICAgICAgICAgfCAgNCArLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jICAgIHwgIDEgLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMgIHwgMzIgKysrKystLS0tLS0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jICAgICAgICAgICB8ICA4ICstLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fYmF0Y2hfcG9vbC5jICAgIHwgNDIgKysrKysr
LS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jICAgICAgICAgICAgICAg
fCA1NCArKysrLS0tLS0tLS0tLS0tLS0tCiAxMSBmaWxlcyBjaGFuZ2VkLCA0NyBpbnNlcnRpb25z
KCspLCAxMTYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX29iamVjdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X29iamVjdC5jCmluZGV4IDFiNTcxZmQyNmVkNC4uMGExMDViYzI5NDk0IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jCkBAIC0xNjMsNyArMTYzLDYgQEAgc3Rh
dGljIHZvaWQgX19pOTE1X2dlbV9mcmVlX29iamVjdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsCiAKIAkJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKLQkJR0VN
X0JVR19PTihpOTE1X2dlbV9vYmplY3RfaXNfYWN0aXZlKG9iaikpOwogCQlsaXN0X2Zvcl9lYWNo
X2VudHJ5X3NhZmUodm1hLCB2biwgJm9iai0+dm1hLmxpc3QsIG9ial9saW5rKSB7CiAJCQlHRU1f
QlVHX09OKGk5MTVfdm1hX2lzX2FjdGl2ZSh2bWEpKTsKIAkJCXZtYS0+ZmxhZ3MgJj0gfkk5MTVf
Vk1BX1BJTl9NQVNLOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX29iamVjdC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5o
CmluZGV4IDdjYjE4NzFkNzEyOC4uNDU0YmZiNDk4MDAxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oCkBAIC0xNTgsMTIgKzE1OCw2IEBAIGk5MTVfZ2VtX29i
amVjdF9uZWVkc19hc3luY19jYW5jZWwoY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iaikKIAlyZXR1cm4gb2JqLT5vcHMtPmZsYWdzICYgSTkxNV9HRU1fT0JKRUNUX0FTWU5DX0NB
TkNFTDsKIH0KIAotc3RhdGljIGlubGluZSBib29sCi1pOTE1X2dlbV9vYmplY3RfaXNfYWN0aXZl
KGNvbnN0IHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCi17Ci0JcmV0dXJuIFJFQURf
T05DRShvYmotPmFjdGl2ZV9jb3VudCk7Ci19Ci0KIHN0YXRpYyBpbmxpbmUgYm9vbAogaTkxNV9n
ZW1fb2JqZWN0X2lzX2ZyYW1lYnVmZmVyKGNvbnN0IHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmopCiB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
b2JqZWN0X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0
X3R5cGVzLmgKaW5kZXggNWIwNTY5ODYxOWNlLi5jMjk5ZmVkMmM2YjEgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaAorKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmgKQEAgLTE1Niw3ICsx
NTYsNiBAQCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCB7CiAKIAkvKiogQ291bnQgb2YgVk1B
IGFjdHVhbGx5IGJvdW5kIGJ5IHRoaXMgb2JqZWN0ICovCiAJYXRvbWljX3QgYmluZF9jb3VudDsK
LQl1bnNpZ25lZCBpbnQgYWN0aXZlX2NvdW50OwogCS8qKiBDb3VudCBvZiBob3cgbWFueSBnbG9i
YWwgVk1BIGFyZSBjdXJyZW50bHkgcGlubmVkIGZvciB1c2UgYnkgSFcgKi8KIAl1bnNpZ25lZCBp
bnQgcGluX2dsb2JhbDsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX3Nocmlua2VyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hy
aW5rZXIuYwppbmRleCAxYmJjNjkwNDk0YzcuLjY2NzBmYTIzNTBjOSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMKQEAgLTIyOSw4ICsyMjksOSBAQCBp
OTE1X2dlbV9zaHJpbmsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJY29udGlu
dWU7CiAKIAkJCWlmICghKHNocmluayAmIEk5MTVfU0hSSU5LX0FDVElWRSkgJiYKLQkJCSAgICAo
aTkxNV9nZW1fb2JqZWN0X2lzX2FjdGl2ZShvYmopIHx8Ci0JCQkgICAgIGk5MTVfZ2VtX29iamVj
dF9pc19mcmFtZWJ1ZmZlcihvYmopKSkKKwkJCSAgICAoaTkxNV9nZW1fb2JqZWN0X2lzX2ZyYW1l
YnVmZmVyKG9iaikgfHwKKwkJCSAgICAgIXJlc2VydmF0aW9uX29iamVjdF90ZXN0X3NpZ25hbGVk
X3JjdShvYmotPnJlc3YsCisJCQkJCQkJCSAgIHRydWUpKSkKIAkJCQljb250aW51ZTsKIAogCQkJ
aWYgKCEoc2hyaW5rICYgSTkxNV9TSFJJTktfQk9VTkQpICYmCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jCmluZGV4IDVjODFmNGI0ODEz
YS4uMjA1MzE5NGE4YjcwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL2k5MTVfZ2VtX21tYW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL2k5MTVfZ2VtX21tYW4uYwpAQCAtNDc0LDE1ICs0NzQsNiBAQCBzdGF0aWMgaW50IGln
dF9tbWFwX29mZnNldF9leGhhdXN0aW9uKHZvaWQgKmFyZykKIAkJCXByX2VycigiW2xvb3AgJWRd
IEZhaWxlZCB0byBidXN5IHRoZSBvYmplY3RcbiIsIGxvb3ApOwogCQkJZ290byBlcnJfb2JqOwog
CQl9Ci0KLQkJLyogTkIgd2UgcmVseSBvbiB0aGUgX2FjdGl2ZV8gcmVmZXJlbmNlIHRvIGFjY2Vz
cyBvYmogbm93ICovCi0JCUdFTV9CVUdfT04oIWk5MTVfZ2VtX29iamVjdF9pc19hY3RpdmUob2Jq
KSk7Ci0JCWVyciA9IGNyZWF0ZV9tbWFwX29mZnNldChvYmopOwotCQlpZiAoZXJyKSB7Ci0JCQlw
cl9lcnIoIltsb29wICVkXSBjcmVhdGVfbW1hcF9vZmZzZXQgZmFpbGVkIHdpdGggZXJyPSVkXG4i
LAotCQkJICAgICAgIGxvb3AsIGVycik7Ci0JCQlnb3RvIG91dDsKLQkJfQogCX0KIAogb3V0Ogpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYwppbmRleCBiYmJkYzYzOTA2YzYuLmNkNGNmNGQw
YjMwYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKQEAgLTE1MDksOSArMTUwOSw3
IEBAIHN0YXRpYyB2b2lkIGV4ZWNsaXN0c19zdWJtaXRfcmVxdWVzdChzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpyZXF1ZXN0KQogc3RhdGljIHZvaWQgX19leGVjbGlzdHNfY29udGV4dF9maW5pKHN0cnVj
dCBpbnRlbF9jb250ZXh0ICpjZSkKIHsKIAlpbnRlbF9yaW5nX3B1dChjZS0+cmluZyk7Ci0KLQlH
RU1fQlVHX09OKGk5MTVfZ2VtX29iamVjdF9pc19hY3RpdmUoY2UtPnN0YXRlLT5vYmopKTsKLQlp
OTE1X2dlbV9vYmplY3RfcHV0KGNlLT5zdGF0ZS0+b2JqKTsKKwlpOTE1X3ZtYV9wdXQoY2UtPnN0
YXRlKTsKIH0KIAogc3RhdGljIHZvaWQgZXhlY2xpc3RzX2NvbnRleHRfZGVzdHJveShzdHJ1Y3Qg
a3JlZiAqa3JlZikKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jp
bmdidWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYwpp
bmRleCBjNjAyM2JjOTQ1MmQuLjI2ZjMzYTA4YTMyZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX3JpbmdidWZmZXIuYwpAQCAtMTMwOSw3ICsxMzA5LDYgQEAgdm9pZCBpbnRlbF9y
aW5nX2ZyZWUoc3RydWN0IGtyZWYgKnJlZikKIAogc3RhdGljIHZvaWQgX19yaW5nX2NvbnRleHRf
ZmluaShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiB7Ci0JR0VNX0JVR19PTihpOTE1X2dlbV9v
YmplY3RfaXNfYWN0aXZlKGNlLT5zdGF0ZS0+b2JqKSk7CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChj
ZS0+c3RhdGUtPm9iaik7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3NlbGZ0ZXN0X2hhbmdjaGVjay5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
aGFuZ2NoZWNrLmMKaW5kZXggMWVlNGM5MjMwNDRmLi40M2I4MTA4NDEyMmQgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jCkBAIC0xMjksMzMgKzEyOSwy
OSBAQCBoYW5nX2NyZWF0ZV9yZXF1ZXN0KHN0cnVjdCBoYW5nICpoLCBzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBoLT5p
OTE1OwogCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gaC0+Y3R4LT52bSA/OiAmaTkx
NS0+Z2d0dC52bTsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwogCXN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxID0gTlVMTDsKIAlzdHJ1Y3QgaTkxNV92bWEgKmh3cywgKnZtYTsKIAl1
bnNpZ25lZCBpbnQgZmxhZ3M7CisJdm9pZCAqdmFkZHI7CiAJdTMyICpiYXRjaDsKIAlpbnQgZXJy
OwogCi0JaWYgKGk5MTVfZ2VtX29iamVjdF9pc19hY3RpdmUoaC0+b2JqKSkgewotCQlzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwotCQl2b2lkICp2YWRkcjsKLQotCQlvYmogPSBpOTE1
X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGgtPmk5MTUsIFBBR0VfU0laRSk7Ci0JCWlmIChJ
U19FUlIob2JqKSkKLQkJCXJldHVybiBFUlJfQ0FTVChvYmopOworCW9iaiA9IGk5MTVfZ2VtX29i
amVjdF9jcmVhdGVfaW50ZXJuYWwoaC0+aTkxNSwgUEFHRV9TSVpFKTsKKwlpZiAoSVNfRVJSKG9i
aikpCisJCXJldHVybiBFUlJfQ0FTVChvYmopOwogCi0JCXZhZGRyID0gaTkxNV9nZW1fb2JqZWN0
X3Bpbl9tYXAob2JqLAotCQkJCQkJaTkxNV9jb2hlcmVudF9tYXBfdHlwZShoLT5pOTE1KSk7Ci0J
CWlmIChJU19FUlIodmFkZHIpKSB7Ci0JCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7Ci0JCQly
ZXR1cm4gRVJSX0NBU1QodmFkZHIpOwotCQl9CisJdmFkZHIgPSBpOTE1X2dlbV9vYmplY3RfcGlu
X21hcChvYmosIGk5MTVfY29oZXJlbnRfbWFwX3R5cGUoaC0+aTkxNSkpOworCWlmIChJU19FUlIo
dmFkZHIpKSB7CisJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwkJcmV0dXJuIEVSUl9DQVNU
KHZhZGRyKTsKKwl9CiAKLQkJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChoLT5vYmopOwotCQlp
OTE1X2dlbV9vYmplY3RfcHV0KGgtPm9iaik7CisJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcCho
LT5vYmopOworCWk5MTVfZ2VtX29iamVjdF9wdXQoaC0+b2JqKTsKIAotCQloLT5vYmogPSBvYmo7
Ci0JCWgtPmJhdGNoID0gdmFkZHI7Ci0JfQorCWgtPm9iaiA9IG9iajsKKwloLT5iYXRjaCA9IHZh
ZGRyOwogCiAJdm1hID0gaTkxNV92bWFfaW5zdGFuY2UoaC0+b2JqLCB2bSwgTlVMTCk7CiAJaWYg
KElTX0VSUih2bWEpKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1
Z2ZzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwppbmRleCA2MmNmMzRk
YjkyODAuLmVlZWNkYWQwZTNjYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kZWJ1Z2ZzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKQEAg
LTc1LDExICs3NSw2IEBAIHN0YXRpYyBpbnQgaTkxNV9jYXBhYmlsaXRpZXMoc3RydWN0IHNlcV9m
aWxlICptLCB2b2lkICpkYXRhKQogCXJldHVybiAwOwogfQogCi1zdGF0aWMgY2hhciBnZXRfYWN0
aXZlX2ZsYWcoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKLXsKLQlyZXR1cm4gaTkx
NV9nZW1fb2JqZWN0X2lzX2FjdGl2ZShvYmopID8gJyonIDogJyAnOwotfQotCiBzdGF0aWMgY2hh
ciBnZXRfcGluX2ZsYWcoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHsKIAlyZXR1
cm4gb2JqLT5waW5fZ2xvYmFsID8gJ3AnIDogJyAnOwpAQCAtMTQ0LDkgKzEzOSw4IEBAIGRlc2Ny
aWJlX29iaihzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
YmopCiAJdW5zaWduZWQgaW50IGZyb250YnVmZmVyX2JpdHM7CiAJaW50IHBpbl9jb3VudCA9IDA7
CiAKLQlzZXFfcHJpbnRmKG0sICIlcEs6ICVjJWMlYyVjJWMgJTh6ZEtpQiAlMDJ4ICUwMnggJXMl
cyVzIiwKKwlzZXFfcHJpbnRmKG0sICIlcEs6ICVjJWMlYyVjICU4emRLaUIgJTAyeCAlMDJ4ICVz
JXMlcyIsCiAJCSAgICZvYmotPmJhc2UsCi0JCSAgIGdldF9hY3RpdmVfZmxhZyhvYmopLAogCQkg
ICBnZXRfcGluX2ZsYWcob2JqKSwKIAkJICAgZ2V0X3RpbGluZ19mbGFnKG9iaiksCiAJCSAgIGdl
dF9nbG9iYWxfZmxhZyhvYmopLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9nZW1fYmF0Y2hfcG9vbC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fYmF0Y2hf
cG9vbC5jCmluZGV4IDU2YWRmZGNhZWQzZS4uMWI3NTk1ZTJhYzIxIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9iYXRjaF9wb29sLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9nZW1fYmF0Y2hfcG9vbC5jCkBAIC05NCwzNCArOTQsMjYgQEAgaTkxNV9n
ZW1fYmF0Y2hfcG9vbF9nZXQoc3RydWN0IGk5MTVfZ2VtX2JhdGNoX3Bvb2wgKnBvb2wsCiAJbGlz
dCA9ICZwb29sLT5jYWNoZV9saXN0W25dOwogCiAJbGlzdF9mb3JfZWFjaF9lbnRyeShvYmosIGxp
c3QsIGJhdGNoX3Bvb2xfbGluaykgeworCQlzdHJ1Y3QgcmVzZXJ2YXRpb25fb2JqZWN0ICpyZXN2
ID0gb2JqLT5yZXN2OworCiAJCS8qIFRoZSBiYXRjaGVzIGFyZSBzdHJpY3RseSBMUlUgb3JkZXJl
ZCAqLwotCQlpZiAoaTkxNV9nZW1fb2JqZWN0X2lzX2FjdGl2ZShvYmopKSB7Ci0JCQlzdHJ1Y3Qg
cmVzZXJ2YXRpb25fb2JqZWN0ICpyZXN2ID0gb2JqLT5yZXN2OwotCi0JCQlpZiAoIXJlc2VydmF0
aW9uX29iamVjdF90ZXN0X3NpZ25hbGVkX3JjdShyZXN2LCB0cnVlKSkKLQkJCQlicmVhazsKLQot
CQkJaTkxNV9yZXRpcmVfcmVxdWVzdHMocG9vbC0+ZW5naW5lLT5pOTE1KTsKLQkJCUdFTV9CVUdf
T04oaTkxNV9nZW1fb2JqZWN0X2lzX2FjdGl2ZShvYmopKTsKLQotCQkJLyoKLQkJCSAqIFRoZSBv
YmplY3QgaXMgbm93IGlkbGUsIGNsZWFyIHRoZSBhcnJheSBvZiBzaGFyZWQKLQkJCSAqIGZlbmNl
cyBiZWZvcmUgd2UgYWRkIGEgbmV3IHJlcXVlc3QuIEFsdGhvdWdoLCB3ZQotCQkJICogcmVtYWlu
IG9uIHRoZSBzYW1lIGVuZ2luZSwgd2UgbWF5IGJlIG9uIGEgZGlmZmVyZW50Ci0JCQkgKiB0aW1l
bGluZSBhbmQgc28gbWF5IGNvbnRpbnVhbGx5IGdyb3cgdGhlIGFycmF5LAotCQkJICogdHJhcHBp
bmcgYSByZWZlcmVuY2UgdG8gYWxsIHRoZSBvbGQgZmVuY2VzLCByYXRoZXIKLQkJCSAqIHRoYW4g
cmVwbGFjZSB0aGUgZXhpc3RpbmcgZmVuY2UuCi0JCQkgKi8KLQkJCWlmIChyY3VfYWNjZXNzX3Bv
aW50ZXIocmVzdi0+ZmVuY2UpKSB7Ci0JCQkJcmVzZXJ2YXRpb25fb2JqZWN0X2xvY2socmVzdiwg
TlVMTCk7Ci0JCQkJcmVzZXJ2YXRpb25fb2JqZWN0X2FkZF9leGNsX2ZlbmNlKHJlc3YsIE5VTEwp
OwotCQkJCXJlc2VydmF0aW9uX29iamVjdF91bmxvY2socmVzdik7Ci0JCQl9CisJCWlmICghcmVz
ZXJ2YXRpb25fb2JqZWN0X3Rlc3Rfc2lnbmFsZWRfcmN1KHJlc3YsIHRydWUpKQorCQkJYnJlYWs7
CisKKwkJLyoKKwkJICogVGhlIG9iamVjdCBpcyBub3cgaWRsZSwgY2xlYXIgdGhlIGFycmF5IG9m
IHNoYXJlZAorCQkgKiBmZW5jZXMgYmVmb3JlIHdlIGFkZCBhIG5ldyByZXF1ZXN0LiBBbHRob3Vn
aCwgd2UKKwkJICogcmVtYWluIG9uIHRoZSBzYW1lIGVuZ2luZSwgd2UgbWF5IGJlIG9uIGEgZGlm
ZmVyZW50CisJCSAqIHRpbWVsaW5lIGFuZCBzbyBtYXkgY29udGludWFsbHkgZ3JvdyB0aGUgYXJy
YXksCisJCSAqIHRyYXBwaW5nIGEgcmVmZXJlbmNlIHRvIGFsbCB0aGUgb2xkIGZlbmNlcywgcmF0
aGVyCisJCSAqIHRoYW4gcmVwbGFjZSB0aGUgZXhpc3RpbmcgZmVuY2UuCisJCSAqLworCQlpZiAo
cmN1X2FjY2Vzc19wb2ludGVyKHJlc3YtPmZlbmNlKSkgeworCQkJcmVzZXJ2YXRpb25fb2JqZWN0
X2xvY2socmVzdiwgTlVMTCk7CisJCQlyZXNlcnZhdGlvbl9vYmplY3RfYWRkX2V4Y2xfZmVuY2Uo
cmVzdiwgTlVMTCk7CisJCQlyZXNlcnZhdGlvbl9vYmplY3RfdW5sb2NrKHJlc3YpOwogCQl9CiAK
LQkJR0VNX0JVR19PTighcmVzZXJ2YXRpb25fb2JqZWN0X3Rlc3Rfc2lnbmFsZWRfcmN1KG9iai0+
cmVzdiwKLQkJCQkJCQkJIHRydWUpKTsKLQogCQlpZiAob2JqLT5iYXNlLnNpemUgPj0gc2l6ZSkK
IAkJCWdvdG8gZm91bmQ7CiAJfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV92bWEuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKaW5kZXggNWZjMGZkYTMy
ZTJhLi5hZmE2Mzk5MDY2ZjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
dm1hLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwpAQCAtNzcsNDMgKzc3
LDExIEBAIHN0YXRpYyB2b2lkIHZtYV9wcmludF9hbGxvY2F0b3Ioc3RydWN0IGk5MTVfdm1hICp2
bWEsIGNvbnN0IGNoYXIgKnJlYXNvbikKIAogI2VuZGlmCiAKLXN0YXRpYyB2b2lkIG9ial9idW1w
X21ydShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQotewotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1ID0gdG9faTkxNShvYmotPmJhc2UuZGV2KTsKLQl1bnNpZ25lZCBsb25n
IGZsYWdzOwotCi0Jc3Bpbl9sb2NrX2lycXNhdmUoJmk5MTUtPm1tLm9ial9sb2NrLCBmbGFncyk7
Ci0JbGlzdF9tb3ZlX3RhaWwoJm9iai0+bW0ubGluaywgJmk5MTUtPm1tLnNocmlua19saXN0KTsK
LQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZpOTE1LT5tbS5vYmpfbG9jaywgZmxhZ3MpOwotCi0J
b2JqLT5tbS5kaXJ0eSA9IHRydWU7IC8qIGJlIHBhcmFub2lkICAqLwotfQotCiBzdGF0aWMgdm9p
ZCBfX2k5MTVfdm1hX3JldGlyZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIHsKIAlzdHJ1Y3Qg
aTkxNV92bWEgKnZtYSA9IGNvbnRhaW5lcl9vZihyZWYsIHR5cGVvZigqdm1hKSwgYWN0aXZlKTsK
LQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gdm1hLT5vYmo7Ci0KLQlHRU1fQlVH
X09OKCFpOTE1X2dlbV9vYmplY3RfaXNfYWN0aXZlKG9iaikpOwotCWlmICgtLW9iai0+YWN0aXZl
X2NvdW50KQotCQlyZXR1cm47Ci0KLQkvKiBQcnVuZSB0aGUgc2hhcmVkIGZlbmNlIGFycmF5cyBp
ZmYgY29tcGxldGVseSBpZGxlIChpbmMuIGV4dGVybmFsKSAqLwotCWlmIChyZXNlcnZhdGlvbl9v
YmplY3RfdHJ5bG9jayhvYmotPnJlc3YpKSB7Ci0JCWlmIChyZXNlcnZhdGlvbl9vYmplY3RfdGVz
dF9zaWduYWxlZF9yY3Uob2JqLT5yZXN2LCB0cnVlKSkKLQkJCXJlc2VydmF0aW9uX29iamVjdF9h
ZGRfZXhjbF9mZW5jZShvYmotPnJlc3YsIE5VTEwpOwotCQlyZXNlcnZhdGlvbl9vYmplY3RfdW5s
b2NrKG9iai0+cmVzdik7Ci0JfQogCi0JLyoKLQkgKiBCdW1wIG91ciBwbGFjZSBvbiB0aGUgYm91
bmQgbGlzdCB0byBrZWVwIGl0IHJvdWdobHkgaW4gTFJVIG9yZGVyCi0JICogc28gdGhhdCB3ZSBk
b24ndCBzdGVhbCBmcm9tIHJlY2VudGx5IHVzZWQgYnV0IGluYWN0aXZlIG9iamVjdHMKLQkgKiAo
dW5sZXNzIHdlIGFyZSBmb3JjZWQgdG8gb2ZjISkKLQkgKi8KLQlpZiAoaTkxNV9nZW1fb2JqZWN0
X2lzX3Nocmlua2FibGUob2JqKSkKLQkJb2JqX2J1bXBfbXJ1KG9iaik7Ci0KLQlpOTE1X2dlbV9v
YmplY3RfcHV0KG9iaik7IC8qIGFuZCBkcm9wIHRoZSBhY3RpdmUgcmVmZXJlbmNlICovCisJaTkx
NV92bWFfcHV0KHZtYSk7CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKgpAQCAtOTIxLDYg
Kzg4OSw3IEBAIGludCBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShzdHJ1Y3QgaTkxNV92bWEgKnZt
YSwKIAkJCSAgICB1bnNpZ25lZCBpbnQgZmxhZ3MpCiB7CiAJc3RydWN0IGRybV9pOTE1X2dlbV9v
YmplY3QgKm9iaiA9IHZtYS0+b2JqOworCWludCBlcnI7CiAKIAlhc3NlcnRfdm1hX2hlbGQodm1h
KTsKIAlhc3NlcnRfb2JqZWN0X2hlbGQob2JqKTsKQEAgLTkzNCwxNyArOTAzLDEzIEBAIGludCBp
OTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAkgKiBhZGQgdGhl
IGFjdGl2ZSByZWZlcmVuY2UgZmlyc3QgYW5kIHF1ZXVlIGZvciBpdCB0byBiZSBkcm9wcGVkCiAJ
ICogKmxhc3QqLgogCSAqLwotCWlmICghdm1hLT5hY3RpdmUuY291bnQgJiYgIW9iai0+YWN0aXZl
X2NvdW50KyspCi0JCWk5MTVfZ2VtX29iamVjdF9nZXQob2JqKTsgLyogb25jZSBtb3JlIGZvciB0
aGUgYWN0aXZlIHJlZiAqLwotCi0JaWYgKHVubGlrZWx5KGk5MTVfYWN0aXZlX3JlZigmdm1hLT5h
Y3RpdmUsIHJxLT5mZW5jZS5jb250ZXh0LCBycSkpKSB7Ci0JCWlmICghdm1hLT5hY3RpdmUuY291
bnQgJiYgIS0tb2JqLT5hY3RpdmVfY291bnQpCi0JCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7
Ci0JCXJldHVybiAtRU5PTUVNOwotCX0KKwlpZiAoaTkxNV9hY3RpdmVfYWNxdWlyZSgmdm1hLT5h
Y3RpdmUpKQorCQlpOTE1X3ZtYV9nZXQodm1hKTsKIAotCUdFTV9CVUdfT04oIWk5MTVfdm1hX2lz
X2FjdGl2ZSh2bWEpKTsKLQlHRU1fQlVHX09OKCFvYmotPmFjdGl2ZV9jb3VudCk7CisJZXJyID0g
aTkxNV9hY3RpdmVfcmVmKCZ2bWEtPmFjdGl2ZSwgcnEtPmZlbmNlLmNvbnRleHQsIHJxKTsKKwlp
OTE1X2FjdGl2ZV9yZWxlYXNlKCZ2bWEtPmFjdGl2ZSk7CisJaWYgKHVubGlrZWx5KGVycikpCisJ
CXJldHVybiBlcnI7CiAKIAlvYmotPndyaXRlX2RvbWFpbiA9IDA7CiAJaWYgKGZsYWdzICYgRVhF
Q19PQkpFQ1RfV1JJVEUpIHsKQEAgLTk1NiwxMSArOTIxLDE0IEBAIGludCBpOTE1X3ZtYV9tb3Zl
X3RvX2FjdGl2ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAkJb2JqLT5yZWFkX2RvbWFpbnMgPSAw
OwogCX0KIAlvYmotPnJlYWRfZG9tYWlucyB8PSBJOTE1X0dFTV9HUFVfRE9NQUlOUzsKKwlvYmot
Pm1tLmRpcnR5ID0gdHJ1ZTsKIAogCWlmIChmbGFncyAmIEVYRUNfT0JKRUNUX05FRURTX0ZFTkNF
KQogCQlfX2k5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KCZ2bWEtPmxhc3RfZmVuY2UsIHJxKTsKIAog
CWV4cG9ydF9mZW5jZSh2bWEsIHJxLCBmbGFncyk7CisKKwlHRU1fQlVHX09OKCFpOTE1X3ZtYV9p
c19hY3RpdmUodm1hKSk7CiAJcmV0dXJuIDA7CiB9CiAKLS0gCjIuMjAuMQoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlz
dApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3E7C12A93DF
	for <lists+intel-gfx@lfdr.de>; Fri,  6 Nov 2020 11:15:08 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id F05F96EA63;
	Fri,  6 Nov 2020 10:15:05 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga17.intel.com (mga17.intel.com [192.55.52.151])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1D96A6EA5F
 for <intel-gfx@lists.freedesktop.org>; Fri,  6 Nov 2020 10:15:04 +0000 (UTC)
IronPort-SDR: zCdjryn8JK3Vonz4dpvXniK0iTndS8zczLFGzB4XXi05WMl84yDOju96hDqw7oU907yLSZFBGG
 igPsWzEYcttQ==
X-IronPort-AV: E=McAfee;i="6000,8403,9796"; a="149379143"
X-IronPort-AV: E=Sophos;i="5.77,456,1596524400"; d="scan'208";a="149379143"
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga004.jf.intel.com ([10.7.209.38])
 by fmsmga107.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 06 Nov 2020 02:15:02 -0800
IronPort-SDR: neNgsDJuwUQD+nNL1yogxvHozNh0sdTMqkdyxMzMaE+W3hbTthJFPgwTC9foo8YzlpUO7qt1RN
 hR0P1RzSqxvw==
X-IronPort-AV: E=Sophos;i="5.77,456,1596524400"; d="scan'208";a="472017757"
Received: from helsinki.fi.intel.com ([10.237.66.162])
 by orsmga004-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 06 Nov 2020 02:15:00 -0800
From: Gwan-gyeong Mun <gwan-gyeong.mun@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  6 Nov 2020 12:14:42 +0200
Message-Id: <20201106101443.686053-1-gwan-gyeong.mun@intel.com>
X-Mailer: git-send-email 2.25.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v4 1/2] drm/i915/display: Support PSR Multiple
 Transcoders
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SXQgaXMgYSBwcmVsaW1pbmFyeSB3b3JrIGZvciBzdXBwb3J0aW5nIG11bHRpcGxlIEVEUCBQU1Ig
YW5kCkRQIFBhbmVsUmVwbGF5LiBBbmQgaXQgcmVmYWN0b3JzIHNpbmdsZXRvbiBQU1IgdG8gTXVs
dGkgVHJhbnNjb2RlcgpzdXBwb3J0YWJsZSBQU1IuCkFuZCB0aGlzIG1vdmVzIGFuZCByZW5hbWVz
IHRoZSBpOTE1X3BzciBzdHJ1Y3R1cmUgb2YgZHJtX2k5MTVfcHJpdmF0ZSdzIHRvCmludGVsX2Rw
J3MgaW50ZWxfcHNyIHN0cnVjdHVyZS4KSXQgYWxzbyBjYXVzZXMgY2hhbmdlcyBpbiBQU1IgaW50
ZXJydXB0IGhhbmRsaW5nIHJvdXRpbmUgZm9yIHN1cHBvcnRpbmcKbXVsdGlwbGUgdHJhbnNjb2Rl
cnMuIEJ1dCBpdCBkb2VzIG5vdCBjaGFuZ2UgdGhlIHNjZW5hcmlvIGFuZCB0aW1pbmcgb2YKZW5h
YmxpbmcgYW5kIGRpc2FibGluZyBQU1IuCgp2MjogRml4IGluZGVudGF0aW9uIGFuZCBhZGQgY29t
bWVudHMKdjM6IFJlbW92ZSBCbGFuayBsaW5lCnY0OiBSZWJhc2VkCgpTaWduZWQtb2ZmLWJ5OiBH
d2FuLWd5ZW9uZyBNdW4gPGd3YW4tZ3llb25nLm11bkBpbnRlbC5jb20+CkNjOiBKb3PDqSBSb2Jl
cnRvIGRlIFNvdXphIDxqb3NlLnNvdXphQGludGVsLmNvbT4KQ2M6IEp1aGEtUGVra2EgSGVpa2tp
bGEgPGp1aGFwZWtrYS5oZWlra2lsYUBnbWFpbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kZGkuYyAgICAgIHwgICA1ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jICB8ICAgNCAtCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kaXNwbGF5X2RlYnVnZnMuYyAgfCAxMTEgKystLQogLi4uL2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGlzcGxheV90eXBlcy5oICAgIHwgIDM4ICsrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2RwLmMgICAgICAgfCAgMjMgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfcHNyLmMgICAgICB8IDU4NSArKysrKysrKysrLS0tLS0tLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmggICAgICB8ICAxNCArLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zcHJpdGUuYyAgIHwgICA2ICstCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2Rydi5oICAgICAgICAgICAgICAgfCAgMzggLS0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfaXJxLmMgICAgICAgICAgICAgICB8ICA0NyArLQogMTAgZmlsZXMgY2hh
bmdlZCwgNDkxIGluc2VydGlvbnMoKyksIDM4MCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYwppbmRleCAxOWIxNjUxN2E1MDIuLjk4Mzc4MWNlMzY4
MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCkBAIC00MTI3LDcg
KzQxMjcsMTAgQEAgc3RhdGljIHZvaWQgaW50ZWxfZGRpX3VwZGF0ZV9waXBlX2RwKHN0cnVjdCBp
bnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAogCiAJaW50ZWxfZGRpX3NldF9kcF9tc2EoY3J0Y19z
dGF0ZSwgY29ubl9zdGF0ZSk7CiAKKwkvL1RPRE86IG1vdmUgUFNSIHJlbGF0ZWQgZnVuY3Rpb25z
IGludG8gaW50ZWxfcHNyX3VwZGF0ZSgpCisJaW50ZWxfcHNyMl9wcm9ncmFtX3RyYW5zX21hbl90
cmtfY3RsKGludGVsX2RwLCBjcnRjX3N0YXRlKTsKIAlpbnRlbF9wc3JfdXBkYXRlKGludGVsX2Rw
LCBjcnRjX3N0YXRlLCBjb25uX3N0YXRlKTsKKwogCWludGVsX2RwX3NldF9pbmZvZnJhbWVzKGVu
Y29kZXIsIHRydWUsIGNydGNfc3RhdGUsIGNvbm5fc3RhdGUpOwogCWludGVsX2VkcF9kcnJzX3Vw
ZGF0ZShpbnRlbF9kcCwgY3J0Y19zdGF0ZSk7CiAKQEAgLTUyNzUsNiArNTI3OCw4IEBAIHZvaWQg
aW50ZWxfZGRpX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIHBv
cnQgcG9ydCkKIAkJCWdvdG8gZXJyOwogCiAJCWRpZ19wb3J0LT5ocGRfcHVsc2UgPSBpbnRlbF9k
cF9ocGRfcHVsc2U7CisKKwkJaW50ZWxfcHNyX2luaXQoJmRpZ19wb3J0LT5kcCk7CiAJfQogCiAJ
LyogSW4gdGhlb3J5IHdlIGRvbid0IG5lZWQgdGhlIGVuY29kZXItPnR5cGUgY2hlY2ssIGJ1dCBs
ZWF2ZSBpdCBqdXN0IGluCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlz
cGxheS5jCmluZGV4IDhjNDY4N2IxOTgxNC4uNDY2OTIzYTU0MzcwIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAtMTU1MDYsOCArMTU1MDYsNiBA
QCBzdGF0aWMgdm9pZCBjb21taXRfcGlwZV9jb25maWcoc3RydWN0IGludGVsX2F0b21pY19zdGF0
ZSAqc3RhdGUsCiAKIAkJaWYgKG5ld19jcnRjX3N0YXRlLT51cGRhdGVfcGlwZSkKIAkJCWludGVs
X3BpcGVfZmFzdHNldChvbGRfY3J0Y19zdGF0ZSwgbmV3X2NydGNfc3RhdGUpOwotCi0JCWludGVs
X3BzcjJfcHJvZ3JhbV90cmFuc19tYW5fdHJrX2N0bChuZXdfY3J0Y19zdGF0ZSk7CiAJfQogCiAJ
aWYgKGRldl9wcml2LT5kaXNwbGF5LmF0b21pY191cGRhdGVfd2F0ZXJtYXJrcykKQEAgLTE3NDM1
LDggKzE3NDMzLDYgQEAgc3RhdGljIHZvaWQgaW50ZWxfc2V0dXBfb3V0cHV0cyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCWludGVsX2R2b19pbml0KGRldl9wcml2KTsKIAl9
CiAKLQlpbnRlbF9wc3JfaW5pdChkZXZfcHJpdik7Ci0KIAlmb3JfZWFjaF9pbnRlbF9lbmNvZGVy
KCZkZXZfcHJpdi0+ZHJtLCBlbmNvZGVyKSB7CiAJCWVuY29kZXItPmJhc2UucG9zc2libGVfY3J0
Y3MgPQogCQkJaW50ZWxfZW5jb2Rlcl9wb3NzaWJsZV9jcnRjcyhlbmNvZGVyKTsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9kZWJ1Z2ZzLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfZGVidWdmcy5jCmlu
ZGV4IGNmYjRjMTQ3NDk4Mi4uODQwMmU2YWM5Zjc2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfZGVidWdmcy5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9kZWJ1Z2ZzLmMKQEAgLTI0OCwxOCArMjQ4
LDE3IEBAIHN0YXRpYyBpbnQgaTkxNV9wc3Jfc2lua19zdGF0dXNfc2hvdyhzdHJ1Y3Qgc2VxX2Zp
bGUgKm0sIHZvaWQgKmRhdGEpCiAJCSJzaW5rIGludGVybmFsIGVycm9yIiwKIAl9OwogCXN0cnVj
dCBkcm1fY29ubmVjdG9yICpjb25uZWN0b3IgPSBtLT5wcml2YXRlOwotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY29ubmVjdG9yLT5kZXYpOwogCXN0cnVjdCBp
bnRlbF9kcCAqaW50ZWxfZHAgPQogCQlpbnRlbF9hdHRhY2hlZF9kcCh0b19pbnRlbF9jb25uZWN0
b3IoY29ubmVjdG9yKSk7CiAJaW50IHJldDsKIAotCWlmICghQ0FOX1BTUihkZXZfcHJpdikpIHsK
LQkJc2VxX3B1dHMobSwgIlBTUiBVbnN1cHBvcnRlZFxuIik7CisJaWYgKGNvbm5lY3Rvci0+c3Rh
dHVzICE9IGNvbm5lY3Rvcl9zdGF0dXNfY29ubmVjdGVkKQogCQlyZXR1cm4gLUVOT0RFVjsKLQl9
CiAKLQlpZiAoY29ubmVjdG9yLT5zdGF0dXMgIT0gY29ubmVjdG9yX3N0YXR1c19jb25uZWN0ZWQp
CisJaWYgKCFDQU5fUFNSKGludGVsX2RwKSkgeworCQlzZXFfcHV0cyhtLCAiUFNSIFVuc3VwcG9y
dGVkXG4iKTsKIAkJcmV0dXJuIC1FTk9ERVY7CisJfQogCiAJcmV0ID0gZHJtX2RwX2RwY2RfcmVh
ZGIoJmludGVsX2RwLT5hdXgsIERQX1BTUl9TVEFUVVMsICZ2YWwpOwogCkBAIC0yNzksMTIgKzI3
OCwxMyBAQCBzdGF0aWMgaW50IGk5MTVfcHNyX3Npbmtfc3RhdHVzX3Nob3coc3RydWN0IHNlcV9m
aWxlICptLCB2b2lkICpkYXRhKQogREVGSU5FX1NIT1dfQVRUUklCVVRFKGk5MTVfcHNyX3Npbmtf
c3RhdHVzKTsKIAogc3RhdGljIHZvaWQKLXBzcl9zb3VyY2Vfc3RhdHVzKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiwgc3RydWN0IHNlcV9maWxlICptKQorcHNyX3NvdXJjZV9zdGF0
dXMoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwgc3RydWN0IHNlcV9maWxlICptKQogewogCXUz
MiB2YWwsIHN0YXR1c192YWw7CiAJY29uc3QgY2hhciAqc3RhdHVzID0gInVua25vd24iOworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwog
Ci0JaWYgKGRldl9wcml2LT5wc3IucHNyMl9lbmFibGVkKSB7CisJaWYgKGludGVsX2RwLT5wc3Iu
cHNyMl9lbmFibGVkKSB7CiAJCXN0YXRpYyBjb25zdCBjaGFyICogY29uc3QgbGl2ZV9zdGF0dXNb
XSA9IHsKIAkJCSJJRExFIiwKIAkJCSJDQVBUVVJFIiwKQEAgLTI5OSw3ICsyOTksNyBAQCBwc3Jf
c291cmNlX3N0YXR1cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHN0cnVjdCBz
ZXFfZmlsZSAqbSkKIAkJCSJUR19PTiIKIAkJfTsKIAkJdmFsID0gaW50ZWxfZGVfcmVhZChkZXZf
cHJpdiwKLQkJCQkgICAgRURQX1BTUjJfU1RBVFVTKGRldl9wcml2LT5wc3IudHJhbnNjb2Rlcikp
OworCQkJCSAgICBFRFBfUFNSMl9TVEFUVVMoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSk7CiAJ
CXN0YXR1c192YWwgPSAodmFsICYgRURQX1BTUjJfU1RBVFVTX1NUQVRFX01BU0spID4+CiAJCQkg
ICAgICBFRFBfUFNSMl9TVEFUVVNfU1RBVEVfU0hJRlQ7CiAJCWlmIChzdGF0dXNfdmFsIDwgQVJS
QVlfU0laRShsaXZlX3N0YXR1cykpCkBAIC0zMTYsNyArMzE2LDcgQEAgcHNyX3NvdXJjZV9zdGF0
dXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBzdHJ1Y3Qgc2VxX2ZpbGUgKm0p
CiAJCQkiU1JERU5UX09OIiwKIAkJfTsKIAkJdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwK
LQkJCQkgICAgRURQX1BTUl9TVEFUVVMoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSk7CisJCQkJ
ICAgIEVEUF9QU1JfU1RBVFVTKGludGVsX2RwLT5wc3IudHJhbnNjb2RlcikpOwogCQlzdGF0dXNf
dmFsID0gKHZhbCAmIEVEUF9QU1JfU1RBVFVTX1NUQVRFX01BU0spID4+CiAJCQkgICAgICBFRFBf
UFNSX1NUQVRVU19TVEFURV9TSElGVDsKIAkJaWYgKHN0YXR1c192YWwgPCBBUlJBWV9TSVpFKGxp
dmVfc3RhdHVzKSkKQEAgLTMyNiwyMSArMzI2LDE4IEBAIHBzcl9zb3VyY2Vfc3RhdHVzKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgc3RydWN0IHNlcV9maWxlICptKQogCXNlcV9w
cmludGYobSwgIlNvdXJjZSBQU1Igc3RhdHVzOiAlcyBbMHglMDh4XVxuIiwgc3RhdHVzLCB2YWwp
OwogfQogCi1zdGF0aWMgaW50IGk5MTVfZWRwX3Bzcl9zdGF0dXMoc3RydWN0IHNlcV9maWxlICpt
LCB2b2lkICpkYXRhKQorc3RhdGljIGludCBpbnRlbF9wc3Jfc3RhdHVzKHN0cnVjdCBzZXFfZmls
ZSAqbSwgc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7Ci0Jc3RydWN0IGk5MTVf
cHNyICpwc3IgPSAmZGV2X3ByaXYtPnBzcjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKwlzdHJ1Y3QgaW50ZWxfcHNyICpwc3IgPSAm
aW50ZWxfZHAtPnBzcjsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAljb25zdCBjaGFyICpz
dGF0dXM7CiAJYm9vbCBlbmFibGVkOwogCXUzMiB2YWw7CiAKLQlpZiAoIUhBU19QU1IoZGV2X3By
aXYpKQotCQlyZXR1cm4gLUVOT0RFVjsKLQogCXNlcV9wcmludGYobSwgIlNpbmsgc3VwcG9ydDog
JXMiLCB5ZXNubyhwc3ItPnNpbmtfc3VwcG9ydCkpOwotCWlmIChwc3ItPmRwKQotCQlzZXFfcHJp
bnRmKG0sICIgWzB4JTAyeF0iLCBwc3ItPmRwLT5wc3JfZHBjZFswXSk7CisJaWYgKHBzci0+c2lu
a19zdXBwb3J0KQorCQlzZXFfcHJpbnRmKG0sICIgWzB4JTAyeF0iLCBpbnRlbF9kcC0+cHNyX2Rw
Y2RbMF0pOwogCXNlcV9wdXRzKG0sICJcbiIpOwogCiAJaWYgKCFwc3ItPnNpbmtfc3VwcG9ydCkK
QEAgLTM2NCwxNiArMzYxLDE2IEBAIHN0YXRpYyBpbnQgaTkxNV9lZHBfcHNyX3N0YXR1cyhzdHJ1
Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAKIAlpZiAocHNyLT5wc3IyX2VuYWJsZWQpIHsK
IAkJdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwKLQkJCQkgICAgRURQX1BTUjJfQ1RMKGRl
dl9wcml2LT5wc3IudHJhbnNjb2RlcikpOworCQkJCSAgICBFRFBfUFNSMl9DVEwoaW50ZWxfZHAt
PnBzci50cmFuc2NvZGVyKSk7CiAJCWVuYWJsZWQgPSB2YWwgJiBFRFBfUFNSMl9FTkFCTEU7CiAJ
fSBlbHNlIHsKIAkJdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwKLQkJCQkgICAgRURQX1BT
Ul9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSk7CisJCQkJICAgIEVEUF9QU1JfQ1RMKGlu
dGVsX2RwLT5wc3IudHJhbnNjb2RlcikpOwogCQllbmFibGVkID0gdmFsICYgRURQX1BTUl9FTkFC
TEU7CiAJfQogCXNlcV9wcmludGYobSwgIlNvdXJjZSBQU1IgY3RsOiAlcyBbMHglMDh4XVxuIiwK
IAkJICAgZW5hYmxlZGRpc2FibGVkKGVuYWJsZWQpLCB2YWwpOwotCXBzcl9zb3VyY2Vfc3RhdHVz
KGRldl9wcml2LCBtKTsKKwlwc3Jfc291cmNlX3N0YXR1cyhpbnRlbF9kcCwgbSk7CiAJc2VxX3By
aW50ZihtLCAiQnVzeSBmcm9udGJ1ZmZlciBiaXRzOiAweCUwOHhcbiIsCiAJCSAgIHBzci0+YnVz
eV9mcm9udGJ1ZmZlcl9iaXRzKTsKIApAQCAtMzgyLDcgKzM3OSw3IEBAIHN0YXRpYyBpbnQgaTkx
NV9lZHBfcHNyX3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAJICovCiAJ
aWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpIHx8IElTX0JST0FEV0VMTChkZXZfcHJpdikpIHsKIAkJ
dmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwKLQkJCQkgICAgRURQX1BTUl9QRVJGX0NOVChk
ZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpKTsKKwkJCQkgICAgRURQX1BTUl9QRVJGX0NOVChpbnRl
bF9kcC0+cHNyLnRyYW5zY29kZXIpKTsKIAkJdmFsICY9IEVEUF9QU1JfUEVSRl9DTlRfTUFTSzsK
IAkJc2VxX3ByaW50ZihtLCAiUGVyZm9ybWFuY2UgY291bnRlcjogJXVcbiIsIHZhbCk7CiAJfQpA
QCAtNDAzLDcgKzQwMCw3IEBAIHN0YXRpYyBpbnQgaTkxNV9lZHBfcHNyX3N0YXR1cyhzdHJ1Y3Qg
c2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAJCSAqLwogCQlmb3IgKGZyYW1lID0gMDsgZnJhbWUg
PCBQU1IyX1NVX1NUQVRVU19GUkFNRVM7IGZyYW1lICs9IDMpIHsKIAkJCXZhbCA9IGludGVsX2Rl
X3JlYWQoZGV2X3ByaXYsCi0JCQkJCSAgICBQU1IyX1NVX1NUQVRVUyhkZXZfcHJpdi0+cHNyLnRy
YW5zY29kZXIsIGZyYW1lKSk7CisJCQkJCSAgICBQU1IyX1NVX1NUQVRVUyhpbnRlbF9kcC0+cHNy
LnRyYW5zY29kZXIsIGZyYW1lKSk7CiAJCQlzdV9mcmFtZXNfdmFsW2ZyYW1lIC8gM10gPSB2YWw7
CiAJCX0KIApAQCAtNDI5LDIzICs0MjYsNTcgQEAgc3RhdGljIGludCBpOTE1X2VkcF9wc3Jfc3Rh
dHVzKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKIAlyZXR1cm4gMDsKIH0KIAorc3Rh
dGljIGludCBpOTE1X2VkcF9wc3Jfc3RhdHVzKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0
YSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBub2RlX3RvX2k5MTUo
bS0+cHJpdmF0ZSk7CisJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXI7CisJc3RydWN0IGlu
dGVsX2RwICppbnRlbF9kcCA9IE5VTEw7CisKKwlpZiAoIUhBU19QU1IoZGV2X3ByaXYpKQorCQly
ZXR1cm4gLUVOT0RFVjsKKworCS8qIEZpbmQgdGhlIGZpcnN0IEVEUCAqLworCWZvcl9lYWNoX2lu
dGVsX2RwKCZkZXZfcHJpdi0+ZHJtLCBlbmNvZGVyKSB7CisJCWlmIChlbmNvZGVyLT50eXBlID09
IElOVEVMX09VVFBVVF9FRFApIHsKKwkJCWludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKGVuY29k
ZXIpOworCQkJYnJlYWs7CisJCX0KKwl9CisKKwlpZiAoIWludGVsX2RwKQorCQlyZXR1cm4gLUVO
T0RFVjsKKworCXJldHVybiBpbnRlbF9wc3Jfc3RhdHVzKG0sIGludGVsX2RwKTsKK30KKwogc3Rh
dGljIGludAogaTkxNV9lZHBfcHNyX2RlYnVnX3NldCh2b2lkICpkYXRhLCB1NjQgdmFsKQogewog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRhdGE7CiAJaW50ZWxfd2FrZXJl
Zl90IHdha2VyZWY7Ci0JaW50IHJldDsKKwlpbnQgcmV0ID0gLUVOT0RFVjsKKwlzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlcjsKIAotCWlmICghQ0FOX1BTUihkZXZfcHJpdikpCi0JCXJldHVy
biAtRU5PREVWOworCWlmICghSEFTX1BTUihkZXZfcHJpdikpCisJCXJldHVybiByZXQ7CiAKLQlk
cm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgIlNldHRpbmcgUFNSIGRlYnVnIHRvICVsbHhcbiIs
IHZhbCk7CisJZm9yX2VhY2hfaW50ZWxfZHAoJmRldl9wcml2LT5kcm0sIGVuY29kZXIpIHsKKwkJ
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcChlbmNvZGVyKTsKIAot
CXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0pOwor
CQlpZiAoIUNBTl9QU1IoaW50ZWxfZHApKQorCQkJY29udGludWU7CiAKLQlyZXQgPSBpbnRlbF9w
c3JfZGVidWdfc2V0KGRldl9wcml2LCB2YWwpOworCQlpZiAoZW5jb2Rlci0+dHlwZSA9PSBJTlRF
TF9PVVRQVVRfRURQKSB7CisJCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgIlNldHRpbmcg
UFNSIGRlYnVnIHRvICVsbHhcbiIsIHZhbCk7CiAKLQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmZGV2
X3ByaXYtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOworCQkJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVf
cG1fZ2V0KCZkZXZfcHJpdi0+cnVudGltZV9wbSk7CisKKwkJCS8vIFRPRE86IHNwbGl0IHRvIGVh
Y2ggdHJhbnNjb2RlcidzIFBTUiBkZWJ1ZyBzdGF0ZQorCQkJcmV0ID0gaW50ZWxfcHNyX2RlYnVn
X3NldChpbnRlbF9kcCwgdmFsKTsKKworCQkJaW50ZWxfcnVudGltZV9wbV9wdXQoJmRldl9wcml2
LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKKwkJfQorCX0KIAogCXJldHVybiByZXQ7CiB9CkBAIC00
NTQsMTIgKzQ4NSwyNSBAQCBzdGF0aWMgaW50CiBpOTE1X2VkcF9wc3JfZGVidWdfZ2V0KHZvaWQg
KmRhdGEsIHU2NCAqdmFsKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9
IGRhdGE7CisJc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXI7CiAKLQlpZiAoIUNBTl9QU1Io
ZGV2X3ByaXYpKQorCWlmICghSEFTX1BTUihkZXZfcHJpdikpCiAJCXJldHVybiAtRU5PREVWOwog
Ci0JKnZhbCA9IFJFQURfT05DRShkZXZfcHJpdi0+cHNyLmRlYnVnKTsKLQlyZXR1cm4gMDsKKwlm
b3JfZWFjaF9pbnRlbF9kcCgmZGV2X3ByaXYtPmRybSwgZW5jb2RlcikgeworCQlzdHJ1Y3QgaW50
ZWxfZHAgKmludGVsX2RwID0gZW5jX3RvX2ludGVsX2RwKGVuY29kZXIpOworCisJCWlmICghQ0FO
X1BTUihpbnRlbF9kcCkpCisJCQljb250aW51ZTsKKworCQkvLyBUT0RPOiBzcGxpdCB0byBlYWNo
IHRyYW5zY29kZXIncyBQU1IgZGVidWcgc3RhdGUKKwkJaWYgKGVuY29kZXItPnR5cGUgPT0gSU5U
RUxfT1VUUFVUX0VEUCkgeworCQkJKnZhbCA9IFJFQURfT05DRShpbnRlbF9kcC0+cHNyLmRlYnVn
KTsKKwkJCXJldHVybiAwOworCQl9CisJfQorCisJcmV0dXJuIC1FTk9ERVY7CiB9CiAKIERFRklO
RV9TSU1QTEVfQVRUUklCVVRFKGk5MTVfZWRwX3Bzcl9kZWJ1Z19mb3BzLApAQCAtMTEwMyw5ICsx
MTQ3LDYgQEAgc3RhdGljIHZvaWQgZHJyc19zdGF0dXNfcGVyX2NydGMoc3RydWN0IHNlcV9maWxl
ICptLAogCQkvKiBkaXNhYmxlX2RycnMoKSB3aWxsIG1ha2UgZHJycy0+ZHAgTlVMTCAqLwogCQlp
ZiAoIWRycnMtPmRwKSB7CiAJCQlzZXFfcHV0cyhtLCAiSWRsZW5lc3MgRFJSUzogRGlzYWJsZWRc
biIpOwotCQkJaWYgKGRldl9wcml2LT5wc3IuZW5hYmxlZCkKLQkJCQlzZXFfcHV0cyhtLAotCQkJ
CSJcdEFzIFBTUiBpcyBlbmFibGVkLCBEUlJTIGlzIG5vdCBlbmFibGVkXG4iKTsKIAkJCW11dGV4
X3VubG9jaygmZHJycy0+bXV0ZXgpOwogCQkJcmV0dXJuOwogCQl9CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaCBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCmluZGV4IGY2ZjA2MjY2
NDllMC4uMmU0MGZjYmFiMmFhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaApAQCAtMTI4Niw2ICsxMjg2LDQyIEBAIHN0cnVjdCBp
bnRlbF9kcF9jb21wbGlhbmNlIHsKIAl1OCB0ZXN0X2xhbmVfY291bnQ7CiB9OwogCitzdHJ1Y3Qg
aW50ZWxfcHNyIHsKKwkvKiBNdXRleCBmb3IgUFNSIHN0YXRlIG9mIHRoZSB0cmFuc2NvZGVyICov
CisJc3RydWN0IG11dGV4IGxvY2s7CisKKyNkZWZpbmUgSTkxNV9QU1JfREVCVUdfTU9ERV9NQVNL
CTB4MGYKKyNkZWZpbmUgSTkxNV9QU1JfREVCVUdfREVGQVVMVAkJMHgwMAorI2RlZmluZSBJOTE1
X1BTUl9ERUJVR19ESVNBQkxFCQkweDAxCisjZGVmaW5lIEk5MTVfUFNSX0RFQlVHX0VOQUJMRQkJ
MHgwMgorI2RlZmluZSBJOTE1X1BTUl9ERUJVR19GT1JDRV9QU1IxCTB4MDMKKyNkZWZpbmUgSTkx
NV9QU1JfREVCVUdfSVJRCQkweDEwCisKKwl1MzIgZGVidWc7CisJYm9vbCBzaW5rX3N1cHBvcnQ7
CisJYm9vbCBlbmFibGVkOworCWVudW0gcGlwZSBwaXBlOworCWVudW0gdHJhbnNjb2RlciB0cmFu
c2NvZGVyOworCWJvb2wgYWN0aXZlOworCXN0cnVjdCB3b3JrX3N0cnVjdCB3b3JrOworCXVuc2ln
bmVkIGludCBidXN5X2Zyb250YnVmZmVyX2JpdHM7CisJYm9vbCBzaW5rX3BzcjJfc3VwcG9ydDsK
Kwlib29sIGxpbmtfc3RhbmRieTsKKwlib29sIGNvbG9yaW1ldHJ5X3N1cHBvcnQ7CisJYm9vbCBw
c3IyX2VuYWJsZWQ7CisJYm9vbCBwc3IyX3NlbF9mZXRjaF9lbmFibGVkOworCXU4IHNpbmtfc3lu
Y19sYXRlbmN5OworCWt0aW1lX3QgbGFzdF9lbnRyeV9hdHRlbXB0OworCWt0aW1lX3QgbGFzdF9l
eGl0OworCWJvb2wgc2lua19ub3RfcmVsaWFibGU7CisJYm9vbCBpcnFfYXV4X2Vycm9yOworCXUx
NiBzdV94X2dyYW51bGFyaXR5OworCWJvb2wgZGMzY29fZW5hYmxlZDsKKwl1MzIgZGMzY29fZXhp
dF9kZWxheTsKKwlzdHJ1Y3QgZGVsYXllZF93b3JrIGRjM2NvX3dvcms7CisJc3RydWN0IGRybV9k
cF92c2Nfc2RwIHZzYzsKK307CisKIHN0cnVjdCBpbnRlbF9kcCB7CiAJaTkxNV9yZWdfdCBvdXRw
dXRfcmVnOwogCXUzMiBEUDsKQEAgLTE0MDYsNiArMTQ0Miw4IEBAIHN0cnVjdCBpbnRlbF9kcCB7
CiAKIAlib29sIGhvYmxfZmFpbGVkOwogCWJvb2wgaG9ibF9hY3RpdmU7CisKKwlzdHJ1Y3QgaW50
ZWxfcHNyIHBzcjsKIH07CiAKIGVudW0gbHNwY29uX3ZlbmRvciB7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2RwLmMKaW5kZXggM2IwZGJkYTU5MTlhLi42NGFiYzlkMDM3ZjggMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMKQEAgLTI2NDAsMTIgKzI2NDAs
MTAgQEAgdm9pZCBpbnRlbF9kcF9jb21wdXRlX3Bzcl92c2Nfc2RwKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHAsCiAJCQkJICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9z
dGF0ZSwKIAkJCQkgIHN0cnVjdCBkcm1fZHBfdnNjX3NkcCAqdnNjKQogewotCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwotCiAJdnNjLT5z
ZHBfdHlwZSA9IERQX1NEUF9WU0M7CiAKLQlpZiAoZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQp
IHsKLQkJaWYgKGRldl9wcml2LT5wc3IuY29sb3JpbWV0cnlfc3VwcG9ydCAmJgorCWlmIChpbnRl
bF9kcC0+cHNyLnBzcjJfZW5hYmxlZCkgeworCQlpZiAoaW50ZWxfZHAtPnBzci5jb2xvcmltZXRy
eV9zdXBwb3J0ICYmCiAJCSAgICBpbnRlbF9kcF9uZWVkc192c2Nfc2RwKGNydGNfc3RhdGUsIGNv
bm5fc3RhdGUpKSB7CiAJCQkvKiBbUFNSMiwgK0NvbG9yaW1ldHJ5XSAqLwogCQkJaW50ZWxfZHBf
Y29tcHV0ZV92c2NfY29sb3JpbWV0cnkoY3J0Y19zdGF0ZSwgY29ubl9zdGF0ZSwKQEAgLTM3Nzgs
NyArMzc3Niw3IEBAIGJvb2wgaW50ZWxfZHBfaW5pdGlhbF9mYXN0c2V0X2NoZWNrKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQlyZXR1cm4gZmFsc2U7CiAJfQogCi0JaWYgKENBTl9Q
U1IoaTkxNSkgJiYgaW50ZWxfZHBfaXNfZWRwKGludGVsX2RwKSkgeworCWlmIChDQU5fUFNSKGlu
dGVsX2RwKSAmJiBpbnRlbF9kcF9pc19lZHAoaW50ZWxfZHApKSB7CiAJCWRybV9kYmdfa21zKCZp
OTE1LT5kcm0sICJGb3JjaW5nIGZ1bGwgbW9kZXNldCB0byBjb21wdXRlIFBTUiBzdGF0ZVxuIik7
CiAJCWNydGNfc3RhdGUtPnVhcGkubW9kZV9jaGFuZ2VkID0gdHJ1ZTsKIAkJcmV0dXJuIGZhbHNl
OwpAQCAtNzk3OCw2ICs3OTc2LDE3IEBAIHN0YXRpYyB2b2lkIGludGVsX2RwX21vZGVzZXRfcmV0
cnlfd29ya19mbihzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJZHJtX2ttc19oZWxwZXJfaG90
cGx1Z19ldmVudChjb25uZWN0b3ItPmRldik7CiB9CiAKK3N0YXRpYyB2b2lkIGludGVsX2RwX3Vw
ZGF0ZV9waXBlKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlLAorCQkJCSBzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciwKKwkJCQkgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUsCisJCQkJIGNvbnN0IHN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpj
b25uX3N0YXRlKQoreworCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxf
ZHAoZW5jb2Rlcik7CisKKwlpbnRlbF9wYW5lbF91cGRhdGVfYmFja2xpZ2h0KHN0YXRlLCBlbmNv
ZGVyLCBjcnRjX3N0YXRlLCBjb25uX3N0YXRlKTsKKwlpbnRlbF9wc3IyX3Byb2dyYW1fdHJhbnNf
bWFuX3Rya19jdGwoaW50ZWxfZHAsIGNydGNfc3RhdGUpOworfQorCiBib29sCiBpbnRlbF9kcF9p
bml0X2Nvbm5lY3RvcihzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9wb3J0ICpkaWdfcG9ydCwKIAkJCXN0
cnVjdCBpbnRlbF9jb25uZWN0b3IgKmludGVsX2Nvbm5lY3RvcikKQEAgLTgxMzMsNyArODE0Miw3
IEBAIGJvb2wgaW50ZWxfZHBfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CiAJaW50ZWxfZW5jb2Rlci0+Z2V0X2NvbmZpZyA9IGludGVsX2RwX2dldF9jb25maWc7CiAJaW50
ZWxfZW5jb2Rlci0+c3luY19zdGF0ZSA9IGludGVsX2RwX3N5bmNfc3RhdGU7CiAJaW50ZWxfZW5j
b2Rlci0+aW5pdGlhbF9mYXN0c2V0X2NoZWNrID0gaW50ZWxfZHBfaW5pdGlhbF9mYXN0c2V0X2No
ZWNrOwotCWludGVsX2VuY29kZXItPnVwZGF0ZV9waXBlID0gaW50ZWxfcGFuZWxfdXBkYXRlX2Jh
Y2tsaWdodDsKKwlpbnRlbF9lbmNvZGVyLT51cGRhdGVfcGlwZSA9IGludGVsX2RwX3VwZGF0ZV9w
aXBlOwogCWludGVsX2VuY29kZXItPnN1c3BlbmQgPSBpbnRlbF9kcF9lbmNvZGVyX3N1c3BlbmQ7
CiAJaW50ZWxfZW5jb2Rlci0+c2h1dGRvd24gPSBpbnRlbF9kcF9lbmNvZGVyX3NodXRkb3duOwog
CWlmIChJU19DSEVSUllWSUVXKGRldl9wcml2KSkgewpAQCAtODIyMCw2ICs4MjI5LDggQEAgYm9v
bCBpbnRlbF9kcF9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlpZiAo
IWludGVsX2RwX2luaXRfY29ubmVjdG9yKGRpZ19wb3J0LCBpbnRlbF9jb25uZWN0b3IpKQogCQln
b3RvIGVycl9pbml0X2Nvbm5lY3RvcjsKIAorCWludGVsX3Bzcl9pbml0KCZkaWdfcG9ydC0+ZHAp
OworCiAJcmV0dXJuIHRydWU7CiAKIGVycl9pbml0X2Nvbm5lY3RvcjoKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX3Bzci5jCmluZGV4IGIzNjMxYjcyMmRlMy4uOGQ4NThkNTZjNzM2
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfcHNyLmMKQEAgLTc5LDExICs3
OSwxMyBAQAogICogdXNlIHBhZ2UgZmxpcHMuCiAgKi8KIAotc3RhdGljIGJvb2wgcHNyX2dsb2Jh
bF9lbmFibGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQorc3RhdGljIGJvb2wgcHNy
X2dsb2JhbF9lbmFibGVkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7Ci0Jc3dpdGNoIChp
OTE1LT5wc3IuZGVidWcgJiBJOTE1X1BTUl9ERUJVR19NT0RFX01BU0spIHsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKKworCXN3aXRj
aCAoaW50ZWxfZHAtPnBzci5kZWJ1ZyAmIEk5MTVfUFNSX0RFQlVHX01PREVfTUFTSykgewogCWNh
c2UgSTkxNV9QU1JfREVCVUdfREVGQVVMVDoKLQkJcmV0dXJuIGk5MTUtPnBhcmFtcy5lbmFibGVf
cHNyOworCQlyZXR1cm4gZGV2X3ByaXYtPnBhcmFtcy5lbmFibGVfcHNyOwogCWNhc2UgSTkxNV9Q
U1JfREVCVUdfRElTQUJMRToKIAkJcmV0dXJuIGZhbHNlOwogCWRlZmF1bHQ6CkBAIC05MSw5ICs5
Myw5IEBAIHN0YXRpYyBib29sIHBzcl9nbG9iYWxfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSkKIAl9CiB9CiAKLXN0YXRpYyBib29sIHBzcjJfZ2xvYmFsX2VuYWJsZWQoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIGJvb2wgcHNyMl9nbG9iYWxf
ZW5hYmxlZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewotCXN3aXRjaCAoZGV2X3ByaXYt
PnBzci5kZWJ1ZyAmIEk5MTVfUFNSX0RFQlVHX01PREVfTUFTSykgeworCXN3aXRjaCAoaW50ZWxf
ZHAtPnBzci5kZWJ1ZyAmIEk5MTVfUFNSX0RFQlVHX01PREVfTUFTSykgewogCWNhc2UgSTkxNV9Q
U1JfREVCVUdfRElTQUJMRToKIAljYXNlIEk5MTVfUFNSX0RFQlVHX0ZPUkNFX1BTUjE6CiAJCXJl
dHVybiBmYWxzZTsKQEAgLTEwMiwxMSArMTA0LDEyIEBAIHN0YXRpYyBib29sIHBzcjJfZ2xvYmFs
X2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCX0KIH0KIAotc3Rh
dGljIHZvaWQgcHNyX2lycV9jb250cm9sKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
dikKK3N0YXRpYyB2b2lkIHBzcl9pcnFfY29udHJvbChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2Rw
KQogewogCWVudW0gdHJhbnNjb2RlciB0cmFuc19zaGlmdDsKIAl1MzIgbWFzaywgdmFsOwogCWk5
MTVfcmVnX3QgaW1yX3JlZzsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBk
cF90b19pOTE1KGludGVsX2RwKTsKIAogCS8qCiAJICogZ2VuMTIrIGhhcyByZWdpc3RlcnMgcmVs
YXRpdmUgdG8gdHJhbnNjb2RlciBhbmQgb25lIHBlciB0cmFuc2NvZGVyCkBAIC0xMTUsMTQgKzEx
OCwxNCBAQCBzdGF0aWMgdm9pZCBwc3JfaXJxX2NvbnRyb2woc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQogCSAqLwogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKSB7CiAJ
CXRyYW5zX3NoaWZ0ID0gMDsKLQkJaW1yX3JlZyA9IFRSQU5TX1BTUl9JTVIoZGV2X3ByaXYtPnBz
ci50cmFuc2NvZGVyKTsKKwkJaW1yX3JlZyA9IFRSQU5TX1BTUl9JTVIoaW50ZWxfZHAtPnBzci50
cmFuc2NvZGVyKTsKIAl9IGVsc2UgewotCQl0cmFuc19zaGlmdCA9IGRldl9wcml2LT5wc3IudHJh
bnNjb2RlcjsKKwkJdHJhbnNfc2hpZnQgPSBpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXI7CiAJCWlt
cl9yZWcgPSBFRFBfUFNSX0lNUjsKIAl9CiAKIAltYXNrID0gRURQX1BTUl9FUlJPUih0cmFuc19z
aGlmdCk7Ci0JaWYgKGRldl9wcml2LT5wc3IuZGVidWcgJiBJOTE1X1BTUl9ERUJVR19JUlEpCisJ
aWYgKGludGVsX2RwLT5wc3IuZGVidWcgJiBJOTE1X1BTUl9ERUJVR19JUlEpCiAJCW1hc2sgfD0g
RURQX1BTUl9QT1NUX0VYSVQodHJhbnNfc2hpZnQpIHwKIAkJCUVEUF9QU1JfUFJFX0VOVFJZKHRy
YW5zX3NoaWZ0KTsKIApAQCAtMTcxLDM4ICsxNzQsMzcgQEAgc3RhdGljIHZvaWQgcHNyX2V2ZW50
X3ByaW50KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQlkcm1fZGJnX2ttcygmaTkx
NS0+ZHJtLCAiXHRQU1IgZGlzYWJsZWRcbiIpOwogfQogCi12b2lkIGludGVsX3Bzcl9pcnFfaGFu
ZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBwc3JfaWlyKQordm9p
ZCBpbnRlbF9wc3JfaXJxX2hhbmRsZXIoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwgdTMyIHBz
cl9paXIpCiB7Ci0JZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyID0gZGV2X3ByaXYtPnBz
ci50cmFuc2NvZGVyOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3Rv
X2k5MTUoaW50ZWxfZHApOworCWVudW0gdHJhbnNjb2RlciBjcHVfdHJhbnNjb2RlciA9IGludGVs
X2RwLT5wc3IudHJhbnNjb2RlcjsKIAllbnVtIHRyYW5zY29kZXIgdHJhbnNfc2hpZnQ7CiAJaTkx
NV9yZWdfdCBpbXJfcmVnOwogCWt0aW1lX3QgdGltZV9ucyA9ICBrdGltZV9nZXQoKTsKIAogCWlm
IChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKSB7CiAJCXRyYW5zX3NoaWZ0ID0gMDsKLQkJaW1y
X3JlZyA9IFRSQU5TX1BTUl9JTVIoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKTsKKwkJaW1yX3Jl
ZyA9IFRSQU5TX1BTUl9JTVIoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKTsKIAl9IGVsc2Ugewot
CQl0cmFuc19zaGlmdCA9IGRldl9wcml2LT5wc3IudHJhbnNjb2RlcjsKKwkJdHJhbnNfc2hpZnQg
PSBpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXI7CiAJCWltcl9yZWcgPSBFRFBfUFNSX0lNUjsKIAl9
CiAKIAlpZiAocHNyX2lpciAmIEVEUF9QU1JfUFJFX0VOVFJZKHRyYW5zX3NoaWZ0KSkgewotCQlk
ZXZfcHJpdi0+cHNyLmxhc3RfZW50cnlfYXR0ZW1wdCA9IHRpbWVfbnM7Ci0JCWRybV9kYmdfa21z
KCZkZXZfcHJpdi0+ZHJtLAotCQkJICAgICJbdHJhbnNjb2RlciAlc10gUFNSIGVudHJ5IGF0dGVt
cHQgaW4gMiB2YmxhbmtzXG4iLAotCQkJICAgIHRyYW5zY29kZXJfbmFtZShjcHVfdHJhbnNjb2Rl
cikpOworCQlpbnRlbF9kcC0+cHNyLmxhc3RfZW50cnlfYXR0ZW1wdCA9IHRpbWVfbnM7CisJCURS
TV9ERUJVR19LTVMoIlt0cmFuc2NvZGVyICVzXSBQU1IgZW50cnkgYXR0ZW1wdCBpbiAyIHZibGFu
a3NcbiIsCisJCQkgICAgICB0cmFuc2NvZGVyX25hbWUoY3B1X3RyYW5zY29kZXIpKTsKIAl9CiAK
IAlpZiAocHNyX2lpciAmIEVEUF9QU1JfUE9TVF9FWElUKHRyYW5zX3NoaWZ0KSkgewotCQlkZXZf
cHJpdi0+cHNyLmxhc3RfZXhpdCA9IHRpbWVfbnM7Ci0JCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+
ZHJtLAotCQkJICAgICJbdHJhbnNjb2RlciAlc10gUFNSIGV4aXQgY29tcGxldGVkXG4iLAotCQkJ
ICAgIHRyYW5zY29kZXJfbmFtZShjcHVfdHJhbnNjb2RlcikpOworCQlpbnRlbF9kcC0+cHNyLmxh
c3RfZXhpdCA9IHRpbWVfbnM7CisJCURSTV9ERUJVR19LTVMoIlt0cmFuc2NvZGVyICVzXSBQU1Ig
ZXhpdCBjb21wbGV0ZWRcbiIsCisJCQkgICAgICB0cmFuc2NvZGVyX25hbWUoY3B1X3RyYW5zY29k
ZXIpKTsKIAogCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5KSB7CiAJCQl1MzIgdmFsID0g
aW50ZWxfZGVfcmVhZChkZXZfcHJpdiwKIAkJCQkJCVBTUl9FVkVOVChjcHVfdHJhbnNjb2Rlcikp
OwotCQkJYm9vbCBwc3IyX2VuYWJsZWQgPSBkZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxlZDsKKwkJ
CWJvb2wgcHNyMl9lbmFibGVkID0gaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJsZWQ7CiAKIAkJCWlu
dGVsX2RlX3dyaXRlKGRldl9wcml2LCBQU1JfRVZFTlQoY3B1X3RyYW5zY29kZXIpLAogCQkJCSAg
ICAgICB2YWwpOwpAQCAtMjEzLDEwICsyMTUsMTAgQEAgdm9pZCBpbnRlbF9wc3JfaXJxX2hhbmRs
ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1MzIgcHNyX2lpcikKIAlpZiAo
cHNyX2lpciAmIEVEUF9QU1JfRVJST1IodHJhbnNfc2hpZnQpKSB7CiAJCXUzMiB2YWw7CiAKLQkJ
ZHJtX3dhcm4oJmRldl9wcml2LT5kcm0sICJbdHJhbnNjb2RlciAlc10gUFNSIGF1eCBlcnJvclxu
IiwKKwkJRFJNX1dBUk4oIlt0cmFuc2NvZGVyICVzXSBQU1IgYXV4IGVycm9yXG4iLAogCQkJIHRy
YW5zY29kZXJfbmFtZShjcHVfdHJhbnNjb2RlcikpOwogCi0JCWRldl9wcml2LT5wc3IuaXJxX2F1
eF9lcnJvciA9IHRydWU7CisJCWludGVsX2RwLT5wc3IuaXJxX2F1eF9lcnJvciA9IHRydWU7CiAK
IAkJLyoKIAkJICogSWYgdGhpcyBpbnRlcnJ1cHRpb24gaXMgbm90IG1hc2tlZCBpdCB3aWxsIGtl
ZXAKQEAgLTIzMCw3ICsyMzIsNyBAQCB2b2lkIGludGVsX3Bzcl9pcnFfaGFuZGxlcihzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBwc3JfaWlyKQogCQl2YWwgfD0gRURQX1BT
Ul9FUlJPUih0cmFuc19zaGlmdCk7CiAJCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBpbXJfcmVn
LCB2YWwpOwogCi0JCXNjaGVkdWxlX3dvcmsoJmRldl9wcml2LT5wc3Iud29yayk7CisJCXNjaGVk
dWxlX3dvcmsoJmludGVsX2RwLT5wc3Iud29yayk7CiAJfQogfQogCkBAIC0yOTEsMTIgKzI5Myw2
IEBAIHZvaWQgaW50ZWxfcHNyX2luaXRfZHBjZChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9CiAJCXRvX2k5MTUoZHBfdG9fZGln
X3BvcnQoaW50ZWxfZHApLT5iYXNlLmJhc2UuZGV2KTsKIAotCWlmIChkZXZfcHJpdi0+cHNyLmRw
KSB7Ci0JCWRybV93YXJuKCZkZXZfcHJpdi0+ZHJtLAotCQkJICJNb3JlIHRoYW4gb25lIGVEUCBw
YW5lbCBmb3VuZCwgUFNSIHN1cHBvcnQgc2hvdWxkIGJlIGV4dGVuZGVkXG4iKTsKLQkJcmV0dXJu
OwotCX0KLQogCWRybV9kcF9kcGNkX3JlYWQoJmludGVsX2RwLT5hdXgsIERQX1BTUl9TVVBQT1JU
LCBpbnRlbF9kcC0+cHNyX2RwY2QsCiAJCQkgc2l6ZW9mKGludGVsX2RwLT5wc3JfZHBjZCkpOwog
CkBAIC0zMTcsMTIgKzMxMywxMCBAQCB2b2lkIGludGVsX3Bzcl9pbml0X2RwY2Qoc3RydWN0IGlu
dGVsX2RwICppbnRlbF9kcCkKIAkJcmV0dXJuOwogCX0KIAotCWRldl9wcml2LT5wc3Iuc2lua19z
dXBwb3J0ID0gdHJ1ZTsKLQlkZXZfcHJpdi0+cHNyLnNpbmtfc3luY19sYXRlbmN5ID0KKwlpbnRl
bF9kcC0+cHNyLnNpbmtfc3VwcG9ydCA9IHRydWU7CisJaW50ZWxfZHAtPnBzci5zaW5rX3N5bmNf
bGF0ZW5jeSA9CiAJCWludGVsX2RwX2dldF9zaW5rX3N5bmNfbGF0ZW5jeShpbnRlbF9kcCk7CiAK
LQlkZXZfcHJpdi0+cHNyLmRwID0gaW50ZWxfZHA7Ci0KIAlpZiAoSU5URUxfR0VOKGRldl9wcml2
KSA+PSA5ICYmCiAJICAgIChpbnRlbF9kcC0+cHNyX2RwY2RbMF0gPT0gRFBfUFNSMl9XSVRIX1lf
Q09PUkRfSVNfU1VQUE9SVEVEKSkgewogCQlib29sIHlfcmVxID0gaW50ZWxfZHAtPnBzcl9kcGNk
WzFdICYKQEAgLTM0MCwxNCArMzM0LDE0IEBAIHZvaWQgaW50ZWxfcHNyX2luaXRfZHBjZChzdHJ1
Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCQkgKiBZLWNvb3JkaW5hdGUgcmVxdWlyZW1lbnQgcGFu
ZWxzIHdlIHdvdWxkIG5lZWQgdG8gZW5hYmxlCiAJCSAqIEdUQyBmaXJzdC4KIAkJICovCi0JCWRl
dl9wcml2LT5wc3Iuc2lua19wc3IyX3N1cHBvcnQgPSB5X3JlcSAmJiBhbHBtOworCQlpbnRlbF9k
cC0+cHNyLnNpbmtfcHNyMl9zdXBwb3J0ID0geV9yZXEgJiYgYWxwbTsKIAkJZHJtX2RiZ19rbXMo
JmRldl9wcml2LT5kcm0sICJQU1IyICVzc3VwcG9ydGVkXG4iLAotCQkJICAgIGRldl9wcml2LT5w
c3Iuc2lua19wc3IyX3N1cHBvcnQgPyAiIiA6ICJub3QgIik7CisJCQkgICAgaW50ZWxfZHAtPnBz
ci5zaW5rX3BzcjJfc3VwcG9ydCA/ICIiIDogIm5vdCAiKTsKIAotCQlpZiAoZGV2X3ByaXYtPnBz
ci5zaW5rX3BzcjJfc3VwcG9ydCkgewotCQkJZGV2X3ByaXYtPnBzci5jb2xvcmltZXRyeV9zdXBw
b3J0ID0KKwkJaWYgKGludGVsX2RwLT5wc3Iuc2lua19wc3IyX3N1cHBvcnQpIHsKKwkJCWludGVs
X2RwLT5wc3IuY29sb3JpbWV0cnlfc3VwcG9ydCA9CiAJCQkJaW50ZWxfZHBfZ2V0X2NvbG9yaW1l
dHJ5X3N0YXR1cyhpbnRlbF9kcCk7Ci0JCQlkZXZfcHJpdi0+cHNyLnN1X3hfZ3JhbnVsYXJpdHkg
PQorCQkJaW50ZWxfZHAtPnBzci5zdV94X2dyYW51bGFyaXR5ID0KIAkJCQlpbnRlbF9kcF9nZXRf
c3VfeF9ncmFudWxhcnRpeShpbnRlbF9kcCk7CiAJCX0KIAl9CkBAIC0zNzMsNyArMzY3LDcgQEAg
c3RhdGljIHZvaWQgaHN3X3Bzcl9zZXR1cF9hdXgoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkK
IAlCVUlMRF9CVUdfT04oc2l6ZW9mKGF1eF9tc2cpID4gMjApOwogCWZvciAoaSA9IDA7IGkgPCBz
aXplb2YoYXV4X21zZyk7IGkgKz0gNCkKIAkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsCi0JCQkg
ICAgICAgRURQX1BTUl9BVVhfREFUQShkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIsIGkgPj4gMiks
CisJCQkgICAgICAgRURQX1BTUl9BVVhfREFUQShpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIsIGkg
Pj4gMiksCiAJCQkgICAgICAgaW50ZWxfZHBfcGFja19hdXgoJmF1eF9tc2dbaV0sIHNpemVvZihh
dXhfbXNnKSAtIGkpKTsKIAogCWF1eF9jbG9ja19kaXZpZGVyID0gaW50ZWxfZHAtPmdldF9hdXhf
Y2xvY2tfZGl2aWRlcihpbnRlbF9kcCwgMCk7CkBAIC0zODQsNyArMzc4LDcgQEAgc3RhdGljIHZv
aWQgaHN3X3Bzcl9zZXR1cF9hdXgoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAogCS8qIFNl
bGVjdCBvbmx5IHZhbGlkIGJpdHMgZm9yIFNSRF9BVVhfQ1RMICovCiAJYXV4X2N0bCAmPSBwc3Jf
YXV4X21hc2s7Ci0JaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEVEUF9QU1JfQVVYX0NUTChkZXZf
cHJpdi0+cHNyLnRyYW5zY29kZXIpLAorCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBFRFBfUFNS
X0FVWF9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSwKIAkJICAgICAgIGF1eF9jdGwpOwog
fQogCkBAIC0zOTQsMTQgKzM4OCwxNCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZW5hYmxlX3Np
bmsoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAl1OCBkcGNkX3ZhbCA9IERQX1BTUl9FTkFC
TEU7CiAKIAkvKiBFbmFibGUgQUxQTSBhdCBzaW5rIGZvciBwc3IyICovCi0JaWYgKGRldl9wcml2
LT5wc3IucHNyMl9lbmFibGVkKSB7CisJaWYgKGludGVsX2RwLT5wc3IucHNyMl9lbmFibGVkKSB7
CiAJCWRybV9kcF9kcGNkX3dyaXRlYigmaW50ZWxfZHAtPmF1eCwgRFBfUkVDRUlWRVJfQUxQTV9D
T05GSUcsCiAJCQkJICAgRFBfQUxQTV9FTkFCTEUgfAogCQkJCSAgIERQX0FMUE1fTE9DS19FUlJP
Ul9JUlFfSFBEX0VOQUJMRSk7CiAKIAkJZHBjZF92YWwgfD0gRFBfUFNSX0VOQUJMRV9QU1IyIHwg
RFBfUFNSX0lSUV9IUERfV0lUSF9DUkNfRVJST1JTOwogCX0gZWxzZSB7Ci0JCWlmIChkZXZfcHJp
di0+cHNyLmxpbmtfc3RhbmRieSkKKwkJaWYgKGludGVsX2RwLT5wc3IubGlua19zdGFuZGJ5KQog
CQkJZHBjZF92YWwgfD0gRFBfUFNSX01BSU5fTElOS19BQ1RJVkU7CiAKIAkJaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPj0gOCkKQEAgLTQ2NCw3ICs0NTgsNyBAQCBzdGF0aWMgdTggcHNyX2NvbXB1
dGVfaWRsZV9mcmFtZXMoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAkgKiBvZmYtYnktb25l
IGlzc3VlIHRoYXQgSFcgaGFzIGluIHNvbWUgY2FzZXMuCiAJICovCiAJaWRsZV9mcmFtZXMgPSBt
YXgoNiwgZGV2X3ByaXYtPnZidC5wc3IuaWRsZV9mcmFtZXMpOwotCWlkbGVfZnJhbWVzID0gbWF4
KGlkbGVfZnJhbWVzLCBkZXZfcHJpdi0+cHNyLnNpbmtfc3luY19sYXRlbmN5ICsgMSk7CisJaWRs
ZV9mcmFtZXMgPSBtYXgoaWRsZV9mcmFtZXMsIGludGVsX2RwLT5wc3Iuc2lua19zeW5jX2xhdGVu
Y3kgKyAxKTsKIAogCWlmIChkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwgaWRsZV9mcmFtZXMg
PiAweGYpKQogCQlpZGxlX2ZyYW1lcyA9IDB4ZjsKQEAgLTQ4NCw3ICs0NzgsNyBAQCBzdGF0aWMg
dm9pZCBoc3dfYWN0aXZhdGVfcHNyMShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCWlmIChJ
U19IQVNXRUxMKGRldl9wcml2KSkKIAkJdmFsIHw9IEVEUF9QU1JfTUlOX0xJTktfRU5UUllfVElN
RV84X0xJTkVTOwogCi0JaWYgKGRldl9wcml2LT5wc3IubGlua19zdGFuZGJ5KQorCWlmIChpbnRl
bF9kcC0+cHNyLmxpbmtfc3RhbmRieSkKIAkJdmFsIHw9IEVEUF9QU1JfTElOS19TVEFOREJZOwog
CiAJdmFsIHw9IGludGVsX3BzcjFfZ2V0X3RwX3RpbWUoaW50ZWxfZHApOwpAQCAtNDkyLDkgKzQ4
Niw5IEBAIHN0YXRpYyB2b2lkIGhzd19hY3RpdmF0ZV9wc3IxKHN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHApCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOCkKIAkJdmFsIHw9IEVEUF9QU1Jf
Q1JDX0VOQUJMRTsKIAotCXZhbCB8PSAoaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgRURQX1BTUl9D
VEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSkgJgorCXZhbCB8PSAoaW50ZWxfZGVfcmVhZChk
ZXZfcHJpdiwgRURQX1BTUl9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSkgJgogCQlFRFBf
UFNSX1JFU1RPUkVfUFNSX0FDVElWRV9DVFhfTUFTSyk7Ci0JaW50ZWxfZGVfd3JpdGUoZGV2X3By
aXYsIEVEUF9QU1JfQ1RMKGRldl9wcml2LT5wc3IudHJhbnNjb2RlciksIHZhbCk7CisJaW50ZWxf
ZGVfd3JpdGUoZGV2X3ByaXYsIEVEUF9QU1JfQ1RMKGludGVsX2RwLT5wc3IudHJhbnNjb2Rlciks
IHZhbCk7CiB9CiAKIHN0YXRpYyB1MzIgaW50ZWxfcHNyMl9nZXRfdHBfdGltZShzdHJ1Y3QgaW50
ZWxfZHAgKmludGVsX2RwKQpAQCAtNTI5LDcgKzUyMyw3IEBAIHN0YXRpYyB2b2lkIGhzd19hY3Rp
dmF0ZV9wc3IyKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJaWYgKElOVEVMX0dFTihkZXZf
cHJpdikgPj0gMTAgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpCiAJCXZhbCB8PSBFRFBfWV9D
T09SRElOQVRFX0VOQUJMRTsKIAotCXZhbCB8PSBFRFBfUFNSMl9GUkFNRV9CRUZPUkVfU1UoZGV2
X3ByaXYtPnBzci5zaW5rX3N5bmNfbGF0ZW5jeSArIDEpOworCXZhbCB8PSBFRFBfUFNSMl9GUkFN
RV9CRUZPUkVfU1UoaW50ZWxfZHAtPnBzci5zaW5rX3N5bmNfbGF0ZW5jeSArIDEpOwogCXZhbCB8
PSBpbnRlbF9wc3IyX2dldF90cF90aW1lKGludGVsX2RwKTsKIAogCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDEyKSB7CkBAIC01NDgsNyArNTQyLDcgQEAgc3RhdGljIHZvaWQgaHN3X2FjdGl2
YXRlX3BzcjIoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIAkJdmFsIHw9IEVEUF9QU1IyX0ZB
U1RfV0FLRSg3KTsKIAl9CiAKLQlpZiAoZGV2X3ByaXYtPnBzci5wc3IyX3NlbF9mZXRjaF9lbmFi
bGVkKSB7CisJaWYgKGludGVsX2RwLT5wc3IucHNyMl9zZWxfZmV0Y2hfZW5hYmxlZCkgewogCQkv
KiBXQSAxNDA4MzMwODQ3ICovCiAJCWlmIChJU19UR0xfRElTUF9SRVZJRChkZXZfcHJpdiwgVEdM
X1JFVklEX0EwLCBUR0xfUkVWSURfQTApIHx8CiAJCSAgICBJU19SS0xfUkVWSUQoZGV2X3ByaXYs
IFJLTF9SRVZJRF9BMCwgUktMX1JFVklEX0EwKSkKQEAgLTU1NywyMCArNTUxLDIwIEBAIHN0YXRp
YyB2b2lkIGhzd19hY3RpdmF0ZV9wc3IyKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJCQkJ
ICAgICBESVNfUkFNX0JZUEFTU19QU1IyX01BTl9UUkFDSyk7CiAKIAkJaW50ZWxfZGVfd3JpdGUo
ZGV2X3ByaXYsCi0JCQkgICAgICAgUFNSMl9NQU5fVFJLX0NUTChkZXZfcHJpdi0+cHNyLnRyYW5z
Y29kZXIpLAorCQkJICAgICAgIFBTUjJfTUFOX1RSS19DVEwoaW50ZWxfZHAtPnBzci50cmFuc2Nv
ZGVyKSwKIAkJCSAgICAgICBQU1IyX01BTl9UUktfQ1RMX0VOQUJMRSk7CiAJfSBlbHNlIGlmIChI
QVNfUFNSMl9TRUxfRkVUQ0goZGV2X3ByaXYpKSB7CiAJCWludGVsX2RlX3dyaXRlKGRldl9wcml2
LAotCQkJICAgICAgIFBTUjJfTUFOX1RSS19DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSwg
MCk7CisJCQkgICAgICAgUFNSMl9NQU5fVFJLX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIp
LCAwKTsKIAl9CiAKIAkvKgogCSAqIFBTUjIgSFcgaXMgaW5jb3JyZWN0bHkgdXNpbmcgRURQX1BT
Ul9UUDFfVFAzX1NFTCBhbmQgQlNwZWMgaXMKIAkgKiByZWNvbW1lbmRpbmcga2VlcCB0aGlzIGJp
dCB1bnNldCB3aGlsZSBQU1IyIGlzIGVuYWJsZWQuCiAJICovCi0JaW50ZWxfZGVfd3JpdGUoZGV2
X3ByaXYsIEVEUF9QU1JfQ1RMKGRldl9wcml2LT5wc3IudHJhbnNjb2RlciksIDApOworCWludGVs
X2RlX3dyaXRlKGRldl9wcml2LCBFRFBfUFNSX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIp
LCAwKTsKIAotCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBFRFBfUFNSMl9DVEwoZGV2X3ByaXYt
PnBzci50cmFuc2NvZGVyKSwgdmFsKTsKKwlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRURQX1BT
UjJfQ1RMKGludGVsX2RwLT5wc3IudHJhbnNjb2RlciksIHZhbCk7CiB9CiAKIHN0YXRpYyBib29s
CkBAIC01OTMsNTUgKzU4Nyw1OCBAQCBzdGF0aWMgdTMyIGludGVsX2dldF9mcmFtZV90aW1lX3Vz
KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjc3RhdGUpCiAJCQkgICAgZHJtX21vZGVf
dnJlZnJlc2goJmNzdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZSkpOwogfQogCi1zdGF0aWMgdm9pZCBw
c3IyX3Byb2dyYW1faWRsZV9mcmFtZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAorc3RhdGljIHZvaWQgcHNyMl9wcm9ncmFtX2lkbGVfZnJhbWVzKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHAsCiAJCQkJICAgICB1MzIgaWRsZV9mcmFtZXMpCiB7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAJdTMyIHZhbDsKIAog
CWlkbGVfZnJhbWVzIDw8PSAgRURQX1BTUjJfSURMRV9GUkFNRV9TSElGVDsKLQl2YWwgPSBpbnRl
bF9kZV9yZWFkKGRldl9wcml2LCBFRFBfUFNSMl9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVy
KSk7CisJdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgRURQX1BTUjJfQ1RMKGludGVsX2Rw
LT5wc3IudHJhbnNjb2RlcikpOwogCXZhbCAmPSB+RURQX1BTUjJfSURMRV9GUkFNRV9NQVNLOwog
CXZhbCB8PSBpZGxlX2ZyYW1lczsKLQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRURQX1BTUjJf
Q1RMKGRldl9wcml2LT5wc3IudHJhbnNjb2RlciksIHZhbCk7CisJaW50ZWxfZGVfd3JpdGUoZGV2
X3ByaXYsIEVEUF9QU1IyX0NUTChpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpLCB2YWwpOwogfQog
Ci1zdGF0aWMgdm9pZCB0Z2xfcHNyMl9lbmFibGVfZGMzY28oc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgdGdsX3BzcjJfZW5hYmxlX2RjM2NvKHN0cnVjdCBp
bnRlbF9kcCAqaW50ZWxfZHApCiB7Ci0JcHNyMl9wcm9ncmFtX2lkbGVfZnJhbWVzKGRldl9wcml2
LCAwKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGlu
dGVsX2RwKTsKKworCXBzcjJfcHJvZ3JhbV9pZGxlX2ZyYW1lcyhpbnRlbF9kcCwgMCk7CiAJaW50
ZWxfZGlzcGxheV9wb3dlcl9zZXRfdGFyZ2V0X2RjX3N0YXRlKGRldl9wcml2LCBEQ19TVEFURV9F
Tl9EQzNDTyk7CiB9CiAKLXN0YXRpYyB2b2lkIHRnbF9wc3IyX2Rpc2FibGVfZGMzY28oc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgdGdsX3BzcjJfZGlzYWJs
ZV9kYzNjbyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewotCXN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHAgPSBkZXZfcHJpdi0+cHNyLmRwOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCiAJaW50ZWxfZGlzcGxheV9wb3dlcl9z
ZXRfdGFyZ2V0X2RjX3N0YXRlKGRldl9wcml2LCBEQ19TVEFURV9FTl9VUFRPX0RDNik7Ci0JcHNy
Ml9wcm9ncmFtX2lkbGVfZnJhbWVzKGRldl9wcml2LCBwc3JfY29tcHV0ZV9pZGxlX2ZyYW1lcyhp
bnRlbF9kcCkpOworCXBzcjJfcHJvZ3JhbV9pZGxlX2ZyYW1lcyhpbnRlbF9kcCwgcHNyX2NvbXB1
dGVfaWRsZV9mcmFtZXMoaW50ZWxfZHApKTsKIH0KIAogc3RhdGljIHZvaWQgdGdsX2RjM2NvX2Rp
c2FibGVfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiB7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2ID0KLQkJY29udGFpbmVyX29mKHdvcmssIHR5cGVvZigqZGV2X3By
aXYpLCBwc3IuZGMzY29fd29yay53b3JrKTsKKwlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0K
KwkJY29udGFpbmVyX29mKHdvcmssIHR5cGVvZigqaW50ZWxfZHApLCBwc3IuZGMzY29fd29yay53
b3JrKTsKIAotCW11dGV4X2xvY2soJmRldl9wcml2LT5wc3IubG9jayk7CisJbXV0ZXhfbG9jaygm
aW50ZWxfZHAtPnBzci5sb2NrKTsKIAkvKiBJZiBkZWxheWVkIHdvcmsgaXMgcGVuZGluZywgaXQg
aXMgbm90IGlkbGUgKi8KLQlpZiAoZGVsYXllZF93b3JrX3BlbmRpbmcoJmRldl9wcml2LT5wc3Iu
ZGMzY29fd29yaykpCisJaWYgKGRlbGF5ZWRfd29ya19wZW5kaW5nKCZpbnRlbF9kcC0+cHNyLmRj
M2NvX3dvcmspKQogCQlnb3RvIHVubG9jazsKIAotCXRnbF9wc3IyX2Rpc2FibGVfZGMzY28oZGV2
X3ByaXYpOworCXRnbF9wc3IyX2Rpc2FibGVfZGMzY28oaW50ZWxfZHApOwogdW5sb2NrOgotCW11
dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRleF91bmxvY2soJmludGVsX2Rw
LT5wc3IubG9jayk7CiB9CiAKLXN0YXRpYyB2b2lkIHRnbF9kaXNhbGxvd19kYzNjb19vbl9wc3Iy
X2V4aXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3RhdGljIHZvaWQgdGds
X2Rpc2FsbG93X2RjM2NvX29uX3BzcjJfZXhpdChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQog
ewotCWlmICghZGV2X3ByaXYtPnBzci5kYzNjb19lbmFibGVkKQorCWlmICghaW50ZWxfZHAtPnBz
ci5kYzNjb19lbmFibGVkKQogCQlyZXR1cm47CiAKLQljYW5jZWxfZGVsYXllZF93b3JrKCZkZXZf
cHJpdi0+cHNyLmRjM2NvX3dvcmspOworCWNhbmNlbF9kZWxheWVkX3dvcmsoJmludGVsX2RwLT5w
c3IuZGMzY29fd29yayk7CiAJLyogQmVmb3JlIFBTUjIgZXhpdCBkaXNhbGxvdyBkYzNjbyovCi0J
dGdsX3BzcjJfZGlzYWJsZV9kYzNjbyhkZXZfcHJpdik7CisJdGdsX3BzcjJfZGlzYWJsZV9kYzNj
byhpbnRlbF9kcCk7CiB9CiAKIHN0YXRpYyB2b2lkCkBAIC03MTQsNyArNzExLDcgQEAgc3RhdGlj
IGJvb2wgaW50ZWxfcHNyMl9jb25maWdfdmFsaWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwK
IAlpbnQgY3J0Y192ZGlzcGxheSA9IGNydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGUuY3J0Y192
ZGlzcGxheTsKIAlpbnQgcHNyX21heF9oID0gMCwgcHNyX21heF92ID0gMCwgbWF4X2JwcCA9IDA7
CiAKLQlpZiAoIWRldl9wcml2LT5wc3Iuc2lua19wc3IyX3N1cHBvcnQpCisJaWYgKCFpbnRlbF9k
cC0+cHNyLnNpbmtfcHNyMl9zdXBwb3J0KQogCQlyZXR1cm4gZmFsc2U7CiAKIAlpZiAoIXRyYW5z
Y29kZXJfaGFzX3BzcjIoZGV2X3ByaXYsIGNydGNfc3RhdGUtPmNwdV90cmFuc2NvZGVyKSkgewpA
QCAtNzI0LDcgKzcyMSw3IEBAIHN0YXRpYyBib29sIGludGVsX3BzcjJfY29uZmlnX3ZhbGlkKHN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCXJldHVybiBmYWxzZTsKIAl9CiAKLQlpZiAoIXBz
cjJfZ2xvYmFsX2VuYWJsZWQoZGV2X3ByaXYpKSB7CisJaWYgKCFwc3IyX2dsb2JhbF9lbmFibGVk
KGludGVsX2RwKSkgewogCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgIlBTUjIgZGlzYWJs
ZWQgYnkgZmxhZ1xuIik7CiAJCXJldHVybiBmYWxzZTsKIAl9CkBAIC03NzMsMTAgKzc3MCwxMCBA
QCBzdGF0aWMgYm9vbCBpbnRlbF9wc3IyX2NvbmZpZ192YWxpZChzdHJ1Y3QgaW50ZWxfZHAgKmlu
dGVsX2RwLAogCSAqIG9ubHkgbmVlZCB0byB2YWxpZGF0ZSB0aGUgU1UgYmxvY2sgd2lkdGggaXMg
YSBtdWx0aXBsZSBvZgogCSAqIHggZ3JhbnVsYXJpdHkuCiAJICovCi0JaWYgKGNydGNfaGRpc3Bs
YXkgJSBkZXZfcHJpdi0+cHNyLnN1X3hfZ3JhbnVsYXJpdHkpIHsKKwlpZiAoY3J0Y19oZGlzcGxh
eSAlIGludGVsX2RwLT5wc3Iuc3VfeF9ncmFudWxhcml0eSkgewogCQlkcm1fZGJnX2ttcygmZGV2
X3ByaXYtPmRybSwKIAkJCSAgICAiUFNSMiBub3QgZW5hYmxlZCwgaGRpc3BsYXkoJWQpIG5vdCBt
dWx0aXBsZSBvZiAlZFxuIiwKLQkJCSAgICBjcnRjX2hkaXNwbGF5LCBkZXZfcHJpdi0+cHNyLnN1
X3hfZ3JhbnVsYXJpdHkpOworCQkJICAgIGNydGNfaGRpc3BsYXksIGludGVsX2RwLT5wc3Iuc3Vf
eF9ncmFudWxhcml0eSk7CiAJCXJldHVybiBmYWxzZTsKIAl9CiAKQEAgLTgxMSwxMyArODA4LDEw
IEBAIHZvaWQgaW50ZWxfcHNyX2NvbXB1dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHAsCiAJCSZjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlOwogCWludCBwc3Jfc2V0dXBfdGlt
ZTsKIAotCWlmICghQ0FOX1BTUihkZXZfcHJpdikpCi0JCXJldHVybjsKLQotCWlmIChpbnRlbF9k
cCAhPSBkZXZfcHJpdi0+cHNyLmRwKQorCWlmICghQ0FOX1BTUihpbnRlbF9kcCkpCiAJCXJldHVy
bjsKIAotCWlmICghcHNyX2dsb2JhbF9lbmFibGVkKGRldl9wcml2KSkgeworCWlmICghcHNyX2ds
b2JhbF9lbmFibGVkKGludGVsX2RwKSkgewogCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwg
IlBTUiBkaXNhYmxlZCBieSBmbGFnXG4iKTsKIAkJcmV0dXJuOwogCX0KQEAgLTgzNCw3ICs4Mjgs
NyBAQCB2b2lkIGludGVsX3Bzcl9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwLAogCQlyZXR1cm47CiAJfQogCi0JaWYgKGRldl9wcml2LT5wc3Iuc2lua19ub3RfcmVsaWFi
bGUpIHsKKwlpZiAoaW50ZWxfZHAtPnBzci5zaW5rX25vdF9yZWxpYWJsZSkgewogCQlkcm1fZGJn
X2ttcygmZGV2X3ByaXYtPmRybSwKIAkJCSAgICAiUFNSIHNpbmsgaW1wbGVtZW50YXRpb24gaXMg
bm90IHJlbGlhYmxlXG4iKTsKIAkJcmV0dXJuOwpAQCAtODcwLDIzICs4NjQsMjQgQEAgdm9pZCBp
bnRlbF9wc3JfY29tcHV0ZV9jb25maWcoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIHN0YXRp
YyB2b2lkIGludGVsX3Bzcl9hY3RpdmF0ZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHAp
OworCWVudW0gdHJhbnNjb2RlciB0cmFuc2NvZGVyID0gaW50ZWxfZHAtPnBzci50cmFuc2NvZGVy
OwogCi0JaWYgKHRyYW5zY29kZXJfaGFzX3BzcjIoZGV2X3ByaXYsIGRldl9wcml2LT5wc3IudHJh
bnNjb2RlcikpCisJaWYgKHRyYW5zY29kZXJfaGFzX3BzcjIoZGV2X3ByaXYsIHRyYW5zY29kZXIp
KQogCQlkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwKLQkJCSAgICBpbnRlbF9kZV9yZWFkKGRl
dl9wcml2LCBFRFBfUFNSMl9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSkgJiBFRFBfUFNS
Ml9FTkFCTEUpOworCQkJICAgIGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIEVEUF9QU1IyX0NUTCh0
cmFuc2NvZGVyKSkgJiBFRFBfUFNSMl9FTkFCTEUpOwogCiAJZHJtX1dBUk5fT04oJmRldl9wcml2
LT5kcm0sCi0JCSAgICBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBFRFBfUFNSX0NUTChkZXZfcHJp
di0+cHNyLnRyYW5zY29kZXIpKSAmIEVEUF9QU1JfRU5BQkxFKTsKLQlkcm1fV0FSTl9PTigmZGV2
X3ByaXYtPmRybSwgZGV2X3ByaXYtPnBzci5hY3RpdmUpOwotCWxvY2tkZXBfYXNzZXJ0X2hlbGQo
JmRldl9wcml2LT5wc3IubG9jayk7CisJCSAgICBpbnRlbF9kZV9yZWFkKGRldl9wcml2LCBFRFBf
UFNSX0NUTCh0cmFuc2NvZGVyKSkgJiBFRFBfUFNSX0VOQUJMRSk7CisJZHJtX1dBUk5fT04oJmRl
dl9wcml2LT5kcm0sIGludGVsX2RwLT5wc3IuYWN0aXZlKTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxk
KCZpbnRlbF9kcC0+cHNyLmxvY2spOwogCiAJLyogcHNyMSBhbmQgcHNyMiBhcmUgbXV0dWFsbHkg
ZXhjbHVzaXZlLiovCi0JaWYgKGRldl9wcml2LT5wc3IucHNyMl9lbmFibGVkKQorCWlmIChpbnRl
bF9kcC0+cHNyLnBzcjJfZW5hYmxlZCkKIAkJaHN3X2FjdGl2YXRlX3BzcjIoaW50ZWxfZHApOwog
CWVsc2UKIAkJaHN3X2FjdGl2YXRlX3BzcjEoaW50ZWxfZHApOwogCi0JZGV2X3ByaXYtPnBzci5h
Y3RpdmUgPSB0cnVlOworCWludGVsX2RwLT5wc3IuYWN0aXZlID0gdHJ1ZTsKIH0KIAogc3RhdGlj
IHZvaWQgaW50ZWxfcHNyX2VuYWJsZV9zb3VyY2Uoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwK
QEAgLTkwMiw3ICs4OTcsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZW5hYmxlX3NvdXJjZShz
dHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCWlmIChJU19IQVNXRUxMKGRldl9wcml2KSB8fCBJ
U19CUk9BRFdFTEwoZGV2X3ByaXYpKQogCQloc3dfcHNyX3NldHVwX2F1eChpbnRlbF9kcCk7CiAK
LQlpZiAoZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQgJiYgKElTX0dFTihkZXZfcHJpdiwgOSkg
JiYKKwlpZiAoaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJsZWQgJiYgKElTX0dFTihkZXZfcHJpdiwg
OSkgJiYKIAkJCQkJICAgIUlTX0dFTUlOSUxBS0UoZGV2X3ByaXYpKSkgewogCQlpOTE1X3JlZ190
IHJlZyA9IENISUNLRU5fVFJBTlMoY3B1X3RyYW5zY29kZXIpOwogCQl1MzIgY2hpY2tlbiA9IGlu
dGVsX2RlX3JlYWQoZGV2X3ByaXYsIHJlZyk7CkBAIC05MjYsMTAgKzkyMSwxMCBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9wc3JfZW5hYmxlX3NvdXJjZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAog
CWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTEpCiAJCW1hc2sgfD0gRURQX1BTUl9ERUJVR19N
QVNLX0RJU1BfUkVHX1dSSVRFOwogCi0JaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIEVEUF9QU1Jf
REVCVUcoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSwKKwlpbnRlbF9kZV93cml0ZShkZXZfcHJp
diwgRURQX1BTUl9ERUJVRyhpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpLAogCQkgICAgICAgbWFz
ayk7CiAKLQlwc3JfaXJxX2NvbnRyb2woZGV2X3ByaXYpOworCXBzcl9pcnFfY29udHJvbChpbnRl
bF9kcCk7CiAKIAlpZiAoY3J0Y19zdGF0ZS0+ZGMzY29fZXhpdGxpbmUpIHsKIAkJdTMyIHZhbDsK
QEAgLTk0NywzMCArOTQyLDMwIEBAIHN0YXRpYyB2b2lkIGludGVsX3Bzcl9lbmFibGVfc291cmNl
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAKIAlpZiAoSEFTX1BTUl9IV19UUkFDS0lORyhk
ZXZfcHJpdikgJiYgSEFTX1BTUjJfU0VMX0ZFVENIKGRldl9wcml2KSkKIAkJaW50ZWxfZGVfcm13
KGRldl9wcml2LCBDSElDS0VOX1BBUjFfMSwgSUdOT1JFX1BTUjJfSFdfVFJBQ0tJTkcsCi0JCQkg
ICAgIGRldl9wcml2LT5wc3IucHNyMl9zZWxfZmV0Y2hfZW5hYmxlZCA/CisJCQkgICAgIGludGVs
X2RwLT5wc3IucHNyMl9zZWxfZmV0Y2hfZW5hYmxlZCA/CiAJCQkgICAgIElHTk9SRV9QU1IyX0hX
X1RSQUNLSU5HIDogMCk7CiB9CiAKLXN0YXRpYyB2b2lkIGludGVsX3Bzcl9lbmFibGVfbG9ja2Vk
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKK3N0YXRpYyB2b2lkIGludGVsX3Bz
cl9lbmFibGVfbG9ja2VkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCQkJICAgIGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkJCSAgICBjb25zdCBzdHJ1
Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfZHAg
KmludGVsX2RwID0gZGV2X3ByaXYtPnBzci5kcDsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAlzdHJ1Y3QgaW50ZWxfZGlnaXRhbF9w
b3J0ICpkaWdfcG9ydCA9IGRwX3RvX2RpZ19wb3J0KGludGVsX2RwKTsKIAlzdHJ1Y3QgaW50ZWxf
ZW5jb2RlciAqZW5jb2RlciA9ICZkaWdfcG9ydC0+YmFzZTsKIAl1MzIgdmFsOwogCi0JZHJtX1dB
Uk5fT04oJmRldl9wcml2LT5kcm0sIGRldl9wcml2LT5wc3IuZW5hYmxlZCk7CisJZHJtX1dBUk5f
T04oJmRldl9wcml2LT5kcm0sIGludGVsX2RwLT5wc3IuZW5hYmxlZCk7CiAKLQlkZXZfcHJpdi0+
cHNyLnBzcjJfZW5hYmxlZCA9IGNydGNfc3RhdGUtPmhhc19wc3IyOwotCWRldl9wcml2LT5wc3Iu
YnVzeV9mcm9udGJ1ZmZlcl9iaXRzID0gMDsKLQlkZXZfcHJpdi0+cHNyLnBpcGUgPSB0b19pbnRl
bF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0YyktPnBpcGU7Ci0JZGV2X3ByaXYtPnBzci5kYzNj
b19lbmFibGVkID0gISFjcnRjX3N0YXRlLT5kYzNjb19leGl0bGluZTsKLQlkZXZfcHJpdi0+cHNy
LnRyYW5zY29kZXIgPSBjcnRjX3N0YXRlLT5jcHVfdHJhbnNjb2RlcjsKKwlpbnRlbF9kcC0+cHNy
LnBzcjJfZW5hYmxlZCA9IGNydGNfc3RhdGUtPmhhc19wc3IyOworCWludGVsX2RwLT5wc3IuYnVz
eV9mcm9udGJ1ZmZlcl9iaXRzID0gMDsKKwlpbnRlbF9kcC0+cHNyLnBpcGUgPSB0b19pbnRlbF9j
cnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0YyktPnBpcGU7CisJaW50ZWxfZHAtPnBzci5kYzNjb19l
bmFibGVkID0gISFjcnRjX3N0YXRlLT5kYzNjb19leGl0bGluZTsKKwlpbnRlbF9kcC0+cHNyLnRy
YW5zY29kZXIgPSBjcnRjX3N0YXRlLT5jcHVfdHJhbnNjb2RlcjsKIAkvKiBEQzUvREM2IHJlcXVp
cmVzIGF0IGxlYXN0IDYgaWRsZSBmcmFtZXMgKi8KIAl2YWwgPSB1c2Vjc190b19qaWZmaWVzKGlu
dGVsX2dldF9mcmFtZV90aW1lX3VzKGNydGNfc3RhdGUpICogNik7Ci0JZGV2X3ByaXYtPnBzci5k
YzNjb19leGl0X2RlbGF5ID0gdmFsOwotCWRldl9wcml2LT5wc3IucHNyMl9zZWxfZmV0Y2hfZW5h
YmxlZCA9IGNydGNfc3RhdGUtPmVuYWJsZV9wc3IyX3NlbF9mZXRjaDsKKwlpbnRlbF9kcC0+cHNy
LmRjM2NvX2V4aXRfZGVsYXkgPSB2YWw7CisJaW50ZWxfZHAtPnBzci5wc3IyX3NlbF9mZXRjaF9l
bmFibGVkID0gY3J0Y19zdGF0ZS0+ZW5hYmxlX3BzcjJfc2VsX2ZldGNoOwogCiAJLyoKIAkgKiBJ
ZiBhIFBTUiBlcnJvciBoYXBwZW5lZCBhbmQgdGhlIGRyaXZlciBpcyByZWxvYWRlZCwgdGhlIEVE
UF9QU1JfSUlSCkBAIC05ODIsMjcgKzk3NywyNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wc3JfZW5h
YmxlX2xvY2tlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJICovCiAJaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpIHsKIAkJdmFsID0gaW50ZWxfZGVfcmVhZChkZXZf
cHJpdiwKLQkJCQkgICAgVFJBTlNfUFNSX0lJUihkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpKTsK
KwkJCQkgICAgVFJBTlNfUFNSX0lJUihpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpKTsKIAkJdmFs
ICY9IEVEUF9QU1JfRVJST1IoMCk7CiAJfSBlbHNlIHsKIAkJdmFsID0gaW50ZWxfZGVfcmVhZChk
ZXZfcHJpdiwgRURQX1BTUl9JSVIpOwotCQl2YWwgJj0gRURQX1BTUl9FUlJPUihkZXZfcHJpdi0+
cHNyLnRyYW5zY29kZXIpOworCQl2YWwgJj0gRURQX1BTUl9FUlJPUihpbnRlbF9kcC0+cHNyLnRy
YW5zY29kZXIpOwogCX0KIAlpZiAodmFsKSB7Ci0JCWRldl9wcml2LT5wc3Iuc2lua19ub3RfcmVs
aWFibGUgPSB0cnVlOworCQlpbnRlbF9kcC0+cHNyLnNpbmtfbm90X3JlbGlhYmxlID0gdHJ1ZTsK
IAkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sCiAJCQkgICAgIlBTUiBpbnRlcnJ1cHRpb24g
ZXJyb3Igc2V0LCBub3QgZW5hYmxpbmcgUFNSXG4iKTsKIAkJcmV0dXJuOwogCX0KIAogCWRybV9k
Ymdfa21zKCZkZXZfcHJpdi0+ZHJtLCAiRW5hYmxpbmcgUFNSJXNcbiIsCi0JCSAgICBkZXZfcHJp
di0+cHNyLnBzcjJfZW5hYmxlZCA/ICIyIiA6ICIxIik7CisJCSAgICBpbnRlbF9kcC0+cHNyLnBz
cjJfZW5hYmxlZCA/ICIyIiA6ICIxIik7CiAJaW50ZWxfZHBfY29tcHV0ZV9wc3JfdnNjX3NkcChp
bnRlbF9kcCwgY3J0Y19zdGF0ZSwgY29ubl9zdGF0ZSwKLQkJCQkgICAgICZkZXZfcHJpdi0+cHNy
LnZzYyk7Ci0JaW50ZWxfd3JpdGVfZHBfdnNjX3NkcChlbmNvZGVyLCBjcnRjX3N0YXRlLCAmZGV2
X3ByaXYtPnBzci52c2MpOworCQkJCSAgICAgJmludGVsX2RwLT5wc3IudnNjKTsKKwlpbnRlbF93
cml0ZV9kcF92c2Nfc2RwKGVuY29kZXIsIGNydGNfc3RhdGUsICZpbnRlbF9kcC0+cHNyLnZzYyk7
CiAJaW50ZWxfcHNyX2VuYWJsZV9zaW5rKGludGVsX2RwKTsKIAlpbnRlbF9wc3JfZW5hYmxlX3Nv
dXJjZShpbnRlbF9kcCwgY3J0Y19zdGF0ZSk7Ci0JZGV2X3ByaXYtPnBzci5lbmFibGVkID0gdHJ1
ZTsKKwlpbnRlbF9kcC0+cHNyLmVuYWJsZWQgPSB0cnVlOwogCiAJaW50ZWxfcHNyX2FjdGl2YXRl
KGludGVsX2RwKTsKIH0KQEAgLTEwMjEsNyArMTAxNiw3IEBAIHZvaWQgaW50ZWxfcHNyX2VuYWJs
ZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCi0JaWYgKCFDQU5fUFNSKGRldl9w
cml2KSB8fCBkZXZfcHJpdi0+cHNyLmRwICE9IGludGVsX2RwKQorCWlmICghQ0FOX1BTUihpbnRl
bF9kcCkpCiAJCXJldHVybjsKIAogCWlmICghY3J0Y19zdGF0ZS0+aGFzX3BzcikKQEAgLTEwMjks
NDYgKzEwMjQsNDcgQEAgdm9pZCBpbnRlbF9wc3JfZW5hYmxlKHN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHAsCiAKIAlkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwgZGV2X3ByaXYtPmRycnMuZHAp
OwogCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKLQlpbnRlbF9wc3JfZW5hYmxl
X2xvY2tlZChkZXZfcHJpdiwgY3J0Y19zdGF0ZSwgY29ubl9zdGF0ZSk7Ci0JbXV0ZXhfdW5sb2Nr
KCZkZXZfcHJpdi0+cHNyLmxvY2spOworCW11dGV4X2xvY2soJmludGVsX2RwLT5wc3IubG9jayk7
CisJaW50ZWxfcHNyX2VuYWJsZV9sb2NrZWQoaW50ZWxfZHAsIGNydGNfc3RhdGUsIGNvbm5fc3Rh
dGUpOworCW11dGV4X3VubG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKIH0KIAotc3RhdGljIHZv
aWQgaW50ZWxfcHNyX2V4aXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQorc3Rh
dGljIHZvaWQgaW50ZWxfcHNyX2V4aXQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKKwlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsK
IAl1MzIgdmFsOwogCi0JaWYgKCFkZXZfcHJpdi0+cHNyLmFjdGl2ZSkgewotCQlpZiAodHJhbnNj
b2Rlcl9oYXNfcHNyMihkZXZfcHJpdiwgZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSkgeworCWlm
ICghaW50ZWxfZHAtPnBzci5hY3RpdmUpIHsKKwkJaWYgKHRyYW5zY29kZXJfaGFzX3BzcjIoZGV2
X3ByaXYsIGludGVsX2RwLT5wc3IudHJhbnNjb2RlcikpIHsKIAkJCXZhbCA9IGludGVsX2RlX3Jl
YWQoZGV2X3ByaXYsCi0JCQkJCSAgICBFRFBfUFNSMl9DVEwoZGV2X3ByaXYtPnBzci50cmFuc2Nv
ZGVyKSk7CisJCQkJCSAgICBFRFBfUFNSMl9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSk7
CiAJCQlkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwgdmFsICYgRURQX1BTUjJfRU5BQkxFKTsK
IAkJfQogCiAJCXZhbCA9IGludGVsX2RlX3JlYWQoZGV2X3ByaXYsCi0JCQkJICAgIEVEUF9QU1Jf
Q1RMKGRldl9wcml2LT5wc3IudHJhbnNjb2RlcikpOworCQkJCSAgICBFRFBfUFNSX0NUTChpbnRl
bF9kcC0+cHNyLnRyYW5zY29kZXIpKTsKIAkJZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIHZh
bCAmIEVEUF9QU1JfRU5BQkxFKTsKIAogCQlyZXR1cm47CiAJfQogCi0JaWYgKGRldl9wcml2LT5w
c3IucHNyMl9lbmFibGVkKSB7Ci0JCXRnbF9kaXNhbGxvd19kYzNjb19vbl9wc3IyX2V4aXQoZGV2
X3ByaXYpOworCWlmIChpbnRlbF9kcC0+cHNyLnBzcjJfZW5hYmxlZCkgeworCQl0Z2xfZGlzYWxs
b3dfZGMzY29fb25fcHNyMl9leGl0KGludGVsX2RwKTsKIAkJdmFsID0gaW50ZWxfZGVfcmVhZChk
ZXZfcHJpdiwKLQkJCQkgICAgRURQX1BTUjJfQ1RMKGRldl9wcml2LT5wc3IudHJhbnNjb2Rlcikp
OworCQkJCSAgICBFRFBfUFNSMl9DVEwoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKSk7CiAJCWRy
bV9XQVJOX09OKCZkZXZfcHJpdi0+ZHJtLCAhKHZhbCAmIEVEUF9QU1IyX0VOQUJMRSkpOwogCQl2
YWwgJj0gfkVEUF9QU1IyX0VOQUJMRTsKIAkJaW50ZWxfZGVfd3JpdGUoZGV2X3ByaXYsCi0JCQkg
ICAgICAgRURQX1BTUjJfQ1RMKGRldl9wcml2LT5wc3IudHJhbnNjb2RlciksIHZhbCk7CisJCQkg
ICAgICAgRURQX1BTUjJfQ1RMKGludGVsX2RwLT5wc3IudHJhbnNjb2RlciksIHZhbCk7CiAJfSBl
bHNlIHsKIAkJdmFsID0gaW50ZWxfZGVfcmVhZChkZXZfcHJpdiwKLQkJCQkgICAgRURQX1BTUl9D
VEwoZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKSk7CisJCQkJICAgIEVEUF9QU1JfQ1RMKGludGVs
X2RwLT5wc3IudHJhbnNjb2RlcikpOwogCQlkcm1fV0FSTl9PTigmZGV2X3ByaXYtPmRybSwgISh2
YWwgJiBFRFBfUFNSX0VOQUJMRSkpOwogCQl2YWwgJj0gfkVEUF9QU1JfRU5BQkxFOwogCQlpbnRl
bF9kZV93cml0ZShkZXZfcHJpdiwKLQkJCSAgICAgICBFRFBfUFNSX0NUTChkZXZfcHJpdi0+cHNy
LnRyYW5zY29kZXIpLCB2YWwpOworCQkJICAgICAgIEVEUF9QU1JfQ1RMKGludGVsX2RwLT5wc3Iu
dHJhbnNjb2RlciksIHZhbCk7CiAJfQotCWRldl9wcml2LT5wc3IuYWN0aXZlID0gZmFsc2U7CisJ
aW50ZWxfZHAtPnBzci5hY3RpdmUgPSBmYWxzZTsKIH0KIAogc3RhdGljIHZvaWQgaW50ZWxfcHNy
X2Rpc2FibGVfbG9ja2VkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCkBAIC0xMDc3LDIxICsx
MDczLDIxIEBAIHN0YXRpYyB2b2lkIGludGVsX3Bzcl9kaXNhYmxlX2xvY2tlZChzdHJ1Y3QgaW50
ZWxfZHAgKmludGVsX2RwKQogCWk5MTVfcmVnX3QgcHNyX3N0YXR1czsKIAl1MzIgcHNyX3N0YXR1
c19tYXNrOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwls
b2NrZGVwX2Fzc2VydF9oZWxkKCZpbnRlbF9kcC0+cHNyLmxvY2spOwogCi0JaWYgKCFkZXZfcHJp
di0+cHNyLmVuYWJsZWQpCisJaWYgKCFpbnRlbF9kcC0+cHNyLmVuYWJsZWQpCiAJCXJldHVybjsK
IAogCWRybV9kYmdfa21zKCZkZXZfcHJpdi0+ZHJtLCAiRGlzYWJsaW5nIFBTUiVzXG4iLAotCQkg
ICAgZGV2X3ByaXYtPnBzci5wc3IyX2VuYWJsZWQgPyAiMiIgOiAiMSIpOworCQkgICAgaW50ZWxf
ZHAtPnBzci5wc3IyX2VuYWJsZWQgPyAiMiIgOiAiMSIpOwogCi0JaW50ZWxfcHNyX2V4aXQoZGV2
X3ByaXYpOworCWludGVsX3Bzcl9leGl0KGludGVsX2RwKTsKIAotCWlmIChkZXZfcHJpdi0+cHNy
LnBzcjJfZW5hYmxlZCkgewotCQlwc3Jfc3RhdHVzID0gRURQX1BTUjJfU1RBVFVTKGRldl9wcml2
LT5wc3IudHJhbnNjb2Rlcik7CisJaWYgKGludGVsX2RwLT5wc3IucHNyMl9lbmFibGVkKSB7CisJ
CXBzcl9zdGF0dXMgPSBFRFBfUFNSMl9TVEFUVVMoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKTsK
IAkJcHNyX3N0YXR1c19tYXNrID0gRURQX1BTUjJfU1RBVFVTX1NUQVRFX01BU0s7CiAJfSBlbHNl
IHsKLQkJcHNyX3N0YXR1cyA9IEVEUF9QU1JfU1RBVFVTKGRldl9wcml2LT5wc3IudHJhbnNjb2Rl
cik7CisJCXBzcl9zdGF0dXMgPSBFRFBfUFNSX1NUQVRVUyhpbnRlbF9kcC0+cHNyLnRyYW5zY29k
ZXIpOwogCQlwc3Jfc3RhdHVzX21hc2sgPSBFRFBfUFNSX1NUQVRVU19TVEFURV9NQVNLOwogCX0K
IApAQCAtMTEwMSw3ICsxMDk3LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHNyX2Rpc2FibGVfbG9j
a2VkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiAJCWRybV9lcnIoJmRldl9wcml2LT5kcm0s
ICJUaW1lZCBvdXQgd2FpdGluZyBQU1IgaWRsZSBzdGF0ZVxuIik7CiAKIAkvKiBXQSAxNDA4MzMw
ODQ3ICovCi0JaWYgKGRldl9wcml2LT5wc3IucHNyMl9zZWxfZmV0Y2hfZW5hYmxlZCAmJgorCWlm
IChpbnRlbF9kcC0+cHNyLnBzcjJfc2VsX2ZldGNoX2VuYWJsZWQgJiYKIAkgICAgKElTX1RHTF9E
SVNQX1JFVklEKGRldl9wcml2LCBUR0xfUkVWSURfQTAsIFRHTF9SRVZJRF9BMCkgfHwKIAkgICAg
IElTX1JLTF9SRVZJRChkZXZfcHJpdiwgUktMX1JFVklEX0EwLCBSS0xfUkVWSURfQTApKSkKIAkJ
aW50ZWxfZGVfcm13KGRldl9wcml2LCBDSElDS0VOX1BBUjFfMSwKQEAgLTExMTAsMTAgKzExMDYs
MTAgQEAgc3RhdGljIHZvaWQgaW50ZWxfcHNyX2Rpc2FibGVfbG9ja2VkKHN0cnVjdCBpbnRlbF9k
cCAqaW50ZWxfZHApCiAJLyogRGlzYWJsZSBQU1Igb24gU2luayAqLwogCWRybV9kcF9kcGNkX3dy
aXRlYigmaW50ZWxfZHAtPmF1eCwgRFBfUFNSX0VOX0NGRywgMCk7CiAKLQlpZiAoZGV2X3ByaXYt
PnBzci5wc3IyX2VuYWJsZWQpCisJaWYgKGludGVsX2RwLT5wc3IucHNyMl9lbmFibGVkKQogCQlk
cm1fZHBfZHBjZF93cml0ZWIoJmludGVsX2RwLT5hdXgsIERQX1JFQ0VJVkVSX0FMUE1fQ09ORklH
LCAwKTsKIAotCWRldl9wcml2LT5wc3IuZW5hYmxlZCA9IGZhbHNlOworCWludGVsX2RwLT5wc3Iu
ZW5hYmxlZCA9IGZhbHNlOwogfQogCiAvKioKQEAgLTExMzEsMjAgKzExMjcsMjIgQEAgdm9pZCBp
bnRlbF9wc3JfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCWlmICghb2xkX2Ny
dGNfc3RhdGUtPmhhc19wc3IpCiAJCXJldHVybjsKIAotCWlmIChkcm1fV0FSTl9PTigmZGV2X3By
aXYtPmRybSwgIUNBTl9QU1IoZGV2X3ByaXYpKSkKKwlpZiAoZHJtX1dBUk5fT04oJmRldl9wcml2
LT5kcm0sICFDQU5fUFNSKGludGVsX2RwKSkpCiAJCXJldHVybjsKIAotCW11dGV4X2xvY2soJmRl
dl9wcml2LT5wc3IubG9jayk7CisJbXV0ZXhfbG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKIAog
CWludGVsX3Bzcl9kaXNhYmxlX2xvY2tlZChpbnRlbF9kcCk7CiAKLQltdXRleF91bmxvY2soJmRl
dl9wcml2LT5wc3IubG9jayk7Ci0JY2FuY2VsX3dvcmtfc3luYygmZGV2X3ByaXYtPnBzci53b3Jr
KTsKLQljYW5jZWxfZGVsYXllZF93b3JrX3N5bmMoJmRldl9wcml2LT5wc3IuZGMzY29fd29yayk7
CisJbXV0ZXhfdW5sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOworCWNhbmNlbF93b3JrX3N5bmMo
JmludGVsX2RwLT5wc3Iud29yayk7CisJY2FuY2VsX2RlbGF5ZWRfd29ya19zeW5jKCZpbnRlbF9k
cC0+cHNyLmRjM2NvX3dvcmspOwogfQogCi1zdGF0aWMgdm9pZCBwc3JfZm9yY2VfaHdfdHJhY2tp
bmdfZXhpdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBw
c3JfZm9yY2VfaHdfdHJhY2tpbmdfZXhpdChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogewor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHAp
OworCiAJaWYgKElTX1RJR0VSTEFLRShkZXZfcHJpdikpCiAJCS8qCiAJCSAqIFdyaXRlcyB0byBD
VVJTVVJGTElWRSBpbiBUR0wgYXJlIGNhdXNpbmcgSU9NTVUgZXJyb3JzIGFuZApAQCAtMTE1OCw3
ICsxMTU2LDcgQEAgc3RhdGljIHZvaWQgcHNyX2ZvcmNlX2h3X3RyYWNraW5nX2V4aXQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCQkgKiBTbyB1c2luZyB0aGlzIHdvcmthcm91
bmQgdW50aWwgdGhpcyBpc3N1ZSBpcyByb290IGNhdXNlZAogCQkgKiBhbmQgYSBiZXR0ZXIgZml4
IGlzIGZvdW5kLgogCQkgKi8KLQkJaW50ZWxfcHNyX2V4aXQoZGV2X3ByaXYpOworCQlpbnRlbF9w
c3JfZXhpdChpbnRlbF9kcCk7CiAJZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSA5KQog
CQkvKgogCQkgKiBEaXNwbGF5IFdBICMwODg0OiBza2wrCkBAIC0xMTY5LDEzICsxMTY3LDEzIEBA
IHN0YXRpYyB2b2lkIHBzcl9mb3JjZV9od190cmFja2luZ19leGl0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKIAkJICogYnV0IGl0IG1ha2VzIG1vcmUgc2Vuc2Ugd3JpdGUgdG8g
dGhlIGN1cnJlbnQgYWN0aXZlCiAJCSAqIHBpcGUuCiAJCSAqLwotCQlpbnRlbF9kZV93cml0ZShk
ZXZfcHJpdiwgQ1VSU1VSRkxJVkUoZGV2X3ByaXYtPnBzci5waXBlKSwgMCk7CisJCWludGVsX2Rl
X3dyaXRlKGRldl9wcml2LCBDVVJTVVJGTElWRShpbnRlbF9kcC0+cHNyLnBpcGUpLCAwKTsKIAll
bHNlCiAJCS8qCiAJCSAqIEEgd3JpdGUgdG8gQ1VSU1VSRkxJVkUgZG8gbm90IGNhdXNlIEhXIHRy
YWNraW5nIHRvIGV4aXQgUFNSCiAJCSAqIG9uIG9sZGVyIGdlbnMgc28gZG9pbmcgdGhlIG1hbnVh
bCBleGl0IGluc3RlYWQuCiAJCSAqLwotCQlpbnRlbF9wc3JfZXhpdChkZXZfcHJpdik7CisJCWlu
dGVsX3Bzcl9leGl0KGludGVsX2RwKTsKIH0KIAogdm9pZCBpbnRlbF9wc3IyX3Byb2dyYW1fcGxh
bmVfc2VsX2ZldGNoKHN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmUsCkBAIC0xMjEwLDExICsxMjA4
LDExIEBAIHZvaWQgaW50ZWxfcHNyMl9wcm9ncmFtX3BsYW5lX3NlbF9mZXRjaChzdHJ1Y3QgaW50
ZWxfcGxhbmUgKnBsYW5lLAogCWludGVsX2RlX3dyaXRlX2Z3KGRldl9wcml2LCBQTEFORV9TRUxf
RkVUQ0hfU0laRShwaXBlLCBwbGFuZS0+aWQpLCB2YWwpOwogfQogCi12b2lkIGludGVsX3BzcjJf
cHJvZ3JhbV90cmFuc19tYW5fdHJrX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSkKK3ZvaWQgaW50ZWxfcHNyMl9wcm9ncmFtX3RyYW5zX21hbl90cmtfY3RsKHN0
cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCisJCQkJCSAgY29uc3Qgc3RydWN0IGludGVsX2NydGNf
c3RhdGUgKmNydGNfc3RhdGUpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRl
bF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7Ci0Jc3RydWN0IGk5MTVfcHNyICpw
c3IgPSAmZGV2X3ByaXYtPnBzcjsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSBkcF90b19pOTE1KGludGVsX2RwKTsKKwlzdHJ1Y3QgaW50ZWxfcHNyICpwc3IgPSAmaW50ZWxf
ZHAtPnBzcjsKIAogCWlmICghSEFTX1BTUjJfU0VMX0ZFVENIKGRldl9wcml2KSB8fAogCSAgICAh
Y3J0Y19zdGF0ZS0+ZW5hYmxlX3BzcjJfc2VsX2ZldGNoKQpAQCAtMTMyNiwxMyArMTMyNCwxMyBA
QCB2b2lkIGludGVsX3Bzcl91cGRhdGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAkJICAg
ICAgY29uc3Qgc3RydWN0IGRybV9jb25uZWN0b3Jfc3RhdGUgKmNvbm5fc3RhdGUpCiB7CiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7Ci0J
c3RydWN0IGk5MTVfcHNyICpwc3IgPSAmZGV2X3ByaXYtPnBzcjsKKwlzdHJ1Y3QgaW50ZWxfcHNy
ICpwc3IgPSAmaW50ZWxfZHAtPnBzcjsKIAlib29sIGVuYWJsZSwgcHNyMl9lbmFibGU7CiAKLQlp
ZiAoIUNBTl9QU1IoZGV2X3ByaXYpIHx8IFJFQURfT05DRShwc3ItPmRwKSAhPSBpbnRlbF9kcCkK
KwlpZiAoIUNBTl9QU1IoaW50ZWxfZHApKQogCQlyZXR1cm47CiAKLQltdXRleF9sb2NrKCZkZXZf
cHJpdi0+cHNyLmxvY2spOworCW11dGV4X2xvY2soJmludGVsX2RwLT5wc3IubG9jayk7CiAKIAll
bmFibGUgPSBjcnRjX3N0YXRlLT5oYXNfcHNyOwogCXBzcjJfZW5hYmxlID0gY3J0Y19zdGF0ZS0+
aGFzX3BzcjI7CkBAIC0xMzQwLDE1ICsxMzM4LDE1IEBAIHZvaWQgaW50ZWxfcHNyX3VwZGF0ZShz
dHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCWlmIChlbmFibGUgPT0gcHNyLT5lbmFibGVkICYm
IHBzcjJfZW5hYmxlID09IHBzci0+cHNyMl9lbmFibGVkKSB7CiAJCS8qIEZvcmNlIGEgUFNSIGV4
aXQgd2hlbiBlbmFibGluZyBDUkMgdG8gYXZvaWQgQ1JDIHRpbWVvdXRzICovCiAJCWlmIChjcnRj
X3N0YXRlLT5jcmNfZW5hYmxlZCAmJiBwc3ItPmVuYWJsZWQpCi0JCQlwc3JfZm9yY2VfaHdfdHJh
Y2tpbmdfZXhpdChkZXZfcHJpdik7CisJCQlwc3JfZm9yY2VfaHdfdHJhY2tpbmdfZXhpdChpbnRl
bF9kcCk7CiAJCWVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCA5ICYmIHBzci0+ZW5hYmxl
ZCkgewogCQkJLyoKIAkJCSAqIEFjdGl2YXRlIFBTUiBhZ2FpbiBhZnRlciBhIGZvcmNlIGV4aXQg
d2hlbiBlbmFibGluZwogCQkJICogQ1JDIGluIG9sZGVyIGdlbnMKIAkJCSAqLwotCQkJaWYgKCFk
ZXZfcHJpdi0+cHNyLmFjdGl2ZSAmJgotCQkJICAgICFkZXZfcHJpdi0+cHNyLmJ1c3lfZnJvbnRi
dWZmZXJfYml0cykKLQkJCQlzY2hlZHVsZV93b3JrKCZkZXZfcHJpdi0+cHNyLndvcmspOworCQkJ
aWYgKCFpbnRlbF9kcC0+cHNyLmFjdGl2ZSAmJgorCQkJICAgICFpbnRlbF9kcC0+cHNyLmJ1c3lf
ZnJvbnRidWZmZXJfYml0cykKKwkJCQlzY2hlZHVsZV93b3JrKCZpbnRlbF9kcC0+cHNyLndvcmsp
OwogCQl9CiAKIAkJZ290byB1bmxvY2s7CkBAIC0xMzU4LDM0ICsxMzU2LDIzIEBAIHZvaWQgaW50
ZWxfcHNyX3VwZGF0ZShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCQlpbnRlbF9wc3JfZGlz
YWJsZV9sb2NrZWQoaW50ZWxfZHApOwogCiAJaWYgKGVuYWJsZSkKLQkJaW50ZWxfcHNyX2VuYWJs
ZV9sb2NrZWQoZGV2X3ByaXYsIGNydGNfc3RhdGUsIGNvbm5fc3RhdGUpOworCQlpbnRlbF9wc3Jf
ZW5hYmxlX2xvY2tlZChpbnRlbF9kcCwgY3J0Y19zdGF0ZSwgY29ubl9zdGF0ZSk7CiAKIHVubG9j
azoKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5wc3IubG9jayk7CisJbXV0ZXhfdW5sb2NrKCZp
bnRlbF9kcC0+cHNyLmxvY2spOwogfQogCiAvKioKLSAqIGludGVsX3Bzcl93YWl0X2Zvcl9pZGxl
IC0gd2FpdCBmb3IgUFNSMSB0byBpZGxlCi0gKiBAbmV3X2NydGNfc3RhdGU6IG5ldyBDUlRDIHN0
YXRlCisgKiBwc3Jfd2FpdF9mb3JfaWRsZSAtIHdhaXQgZm9yIFBTUjEgdG8gaWRsZQorICogQGlu
dGVsX2RwOiBJbnRlbCBEUAogICogQG91dF92YWx1ZTogUFNSIHN0YXR1cyBpbiBjYXNlIG9mIGZh
aWx1cmUKICAqCi0gKiBUaGlzIGZ1bmN0aW9uIGlzIGV4cGVjdGVkIHRvIGJlIGNhbGxlZCBmcm9t
IHBpcGVfdXBkYXRlX3N0YXJ0KCkgd2hlcmUgaXQgaXMKLSAqIG5vdCBleHBlY3RlZCB0byByYWNl
IHdpdGggUFNSIGVuYWJsZSBvciBkaXNhYmxlLgotICoKICAqIFJldHVybnM6IDAgb24gc3VjY2Vz
cyBvciAtRVRJTUVPVVQgaWYgUFNSIHN0YXR1cyBkb2VzIG5vdCBpZGxlLgorICoKICAqLwotaW50
IGludGVsX3Bzcl93YWl0X2Zvcl9pZGxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpu
ZXdfY3J0Y19zdGF0ZSwKLQkJCSAgICB1MzIgKm91dF92YWx1ZSkKK3N0YXRpYyBpbnQgcHNyX3dh
aXRfZm9yX2lkbGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwgdTMyICpvdXRfdmFsdWUpCiB7
Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKG5ld19jcnRjX3N0YXRl
LT51YXBpLmNydGMpOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5
MTUoY3J0Yy0+YmFzZS5kZXYpOwotCi0JaWYgKCFkZXZfcHJpdi0+cHNyLmVuYWJsZWQgfHwgIW5l
d19jcnRjX3N0YXRlLT5oYXNfcHNyKQotCQlyZXR1cm4gMDsKLQotCS8qIEZJWE1FOiBVcGRhdGUg
dGhpcyBmb3IgUFNSMiBpZiB3ZSBuZWVkIHRvIHdhaXQgZm9yIGlkbGUgKi8KLQlpZiAoUkVBRF9P
TkNFKGRldl9wcml2LT5wc3IucHNyMl9lbmFibGVkKSkKLQkJcmV0dXJuIDA7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAKIAkvKgog
CSAqIEZyb20gYnNwZWM6IFBhbmVsIFNlbGYgUmVmcmVzaCAoQkRXKykKQEAgLTEzOTMsMzIgKzEz
ODAsNjcgQEAgaW50IGludGVsX3Bzcl93YWl0X2Zvcl9pZGxlKGNvbnN0IHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpuZXdfY3J0Y19zdGF0ZSwKIAkgKiBleGl0IHRyYWluaW5nIHRpbWUgKyAxLjUg
bXMgb2YgYXV4IGNoYW5uZWwgaGFuZHNoYWtlLiA1MCBtcyBpcwogCSAqIGRlZmVuc2l2ZSBlbm91
Z2ggdG8gY292ZXIgZXZlcnl0aGluZy4KIAkgKi8KLQogCXJldHVybiBfX2ludGVsX3dhaXRfZm9y
X3JlZ2lzdGVyKCZkZXZfcHJpdi0+dW5jb3JlLAotCQkJCQkgRURQX1BTUl9TVEFUVVMoZGV2X3By
aXYtPnBzci50cmFuc2NvZGVyKSwKKwkJCQkJIEVEUF9QU1JfU1RBVFVTKGludGVsX2RwLT5wc3Iu
dHJhbnNjb2RlciksCiAJCQkJCSBFRFBfUFNSX1NUQVRVU19TVEFURV9NQVNLLAogCQkJCQkgRURQ
X1BTUl9TVEFUVVNfU1RBVEVfSURMRSwgMiwgNTAsCiAJCQkJCSBvdXRfdmFsdWUpOwogfQogCi1z
dGF0aWMgYm9vbCBfX3Bzcl93YWl0X2Zvcl9pZGxlX2xvY2tlZChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCisvKioKKyAqIGludGVsX3Bzcl93YWl0X2Zvcl9pZGxlIC0gd2FpdCBm
b3IgUFNSMSB0byBpZGxlCisgKiBAbmV3X2NydGNfc3RhdGU6IG5ldyBDUlRDIHN0YXRlCisgKgor
ICogVGhpcyBmdW5jdGlvbiBpcyBleHBlY3RlZCB0byBiZSBjYWxsZWQgZnJvbSBwaXBlX3VwZGF0
ZV9zdGFydCgpIHdoZXJlIGl0IGlzCisgKiBub3QgZXhwZWN0ZWQgdG8gcmFjZSB3aXRoIFBTUiBl
bmFibGUgb3IgZGlzYWJsZS4KKyAqLwordm9pZCBpbnRlbF9wc3Jfd2FpdF9mb3JfaWRsZShjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGUpCit7CisJc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShuZXdfY3J0Y19zdGF0ZS0+dWFwaS5j
cnRjLT5kZXYpOworCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyOworCXUzMiBwc3Jfc3Rh
dHVzOworCisJaWYgKCFuZXdfY3J0Y19zdGF0ZS0+aGFzX3BzcikKKwkJcmV0dXJuOworCisJZm9y
X2VhY2hfaW50ZWxfZHAoJmRldl9wcml2LT5kcm0sIGVuY29kZXIpIHsKKwkJc3RydWN0IGludGVs
X2RwICppbnRlbF9kcCA9IGVuY190b19pbnRlbF9kcChlbmNvZGVyKTsKKworCQlpZiAoZW5jb2Rl
ci0+dHlwZSAhPSBJTlRFTF9PVVRQVVRfRURQKQorCQkJY29udGludWU7CisKKwkJLyogd2hlbiB0
aGUgUFNSMSBpcyBlbmFibGVkICovCisJCWlmIChpbnRlbF9kcC0+cHNyLmVuYWJsZWQgJiYgIWlu
dGVsX2RwLT5wc3IucHNyMl9lbmFibGVkKSB7CisJCQlpZiAocHNyX3dhaXRfZm9yX2lkbGUoaW50
ZWxfZHAsICZwc3Jfc3RhdHVzKSkKKwkJCQlkcm1fZXJyKCZkZXZfcHJpdi0+ZHJtLAorCQkJCQki
UFNSIGlkbGUgdGltZWQgb3V0IDB4JXgsIGF0b21pYyB1cGRhdGUgbWF5IGZhaWxcbiIsCisJCQkJ
CXBzcl9zdGF0dXMpOworCisJCQkvKiBvbmx5IG9uZSB0cmFuY29kZXIgY2FuIGVuYWJsZSBQU1Ix
ICovCisJCQlicmVhazsKKwkJfQorCX0KK30KKworc3RhdGljIGJvb2wgX19wc3Jfd2FpdF9mb3Jf
aWRsZV9sb2NrZWQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKIAlpOTE1X3JlZ190IHJl
ZzsKIAl1MzIgbWFzazsKIAlpbnQgZXJyOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCi0JaWYgKCFkZXZfcHJpdi0+cHNyLmVuYWJs
ZWQpCisJaWYgKCFpbnRlbF9kcC0+cHNyLmVuYWJsZWQpCiAJCXJldHVybiBmYWxzZTsKIAotCWlm
IChkZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxlZCkgewotCQlyZWcgPSBFRFBfUFNSMl9TVEFUVVMo
ZGV2X3ByaXYtPnBzci50cmFuc2NvZGVyKTsKKwlpZiAoaW50ZWxfZHAtPnBzci5wc3IyX2VuYWJs
ZWQpIHsKKwkJcmVnID0gRURQX1BTUjJfU1RBVFVTKGludGVsX2RwLT5wc3IudHJhbnNjb2Rlcik7
CiAJCW1hc2sgPSBFRFBfUFNSMl9TVEFUVVNfU1RBVEVfTUFTSzsKIAl9IGVsc2UgewotCQlyZWcg
PSBFRFBfUFNSX1NUQVRVUyhkZXZfcHJpdi0+cHNyLnRyYW5zY29kZXIpOworCQlyZWcgPSBFRFBf
UFNSX1NUQVRVUyhpbnRlbF9kcC0+cHNyLnRyYW5zY29kZXIpOwogCQltYXNrID0gRURQX1BTUl9T
VEFUVVNfU1RBVEVfTUFTSzsKIAl9CiAKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5wc3IubG9j
ayk7CisJbXV0ZXhfdW5sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOwogCiAJZXJyID0gaW50ZWxf
ZGVfd2FpdF9mb3JfY2xlYXIoZGV2X3ByaXYsIHJlZywgbWFzaywgNTApOwogCWlmIChlcnIpCkBA
IC0xNDI2LDggKzE0NDgsOCBAQCBzdGF0aWMgYm9vbCBfX3Bzcl93YWl0X2Zvcl9pZGxlX2xvY2tl
ZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCQkiVGltZWQgb3V0IHdhaXRp
bmcgZm9yIFBTUiBJZGxlIGZvciByZS1lbmFibGVcbiIpOwogCiAJLyogQWZ0ZXIgdGhlIHVubG9j
a2VkIHdhaXQsIHZlcmlmeSB0aGF0IFBTUiBpcyBzdGlsbCB3YW50ZWQhICovCi0JbXV0ZXhfbG9j
aygmZGV2X3ByaXYtPnBzci5sb2NrKTsKLQlyZXR1cm4gZXJyID09IDAgJiYgZGV2X3ByaXYtPnBz
ci5lbmFibGVkOworCW11dGV4X2xvY2soJmludGVsX2RwLT5wc3IubG9jayk7CisJcmV0dXJuIGVy
ciA9PSAwICYmIGludGVsX2RwLT5wc3IuZW5hYmxlZDsKIH0KIAogc3RhdGljIGludCBpbnRlbF9w
c3JfZmFzdHNldF9mb3JjZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCkBAIC0x
NDkzLDExICsxNTE1LDEyIEBAIHN0YXRpYyBpbnQgaW50ZWxfcHNyX2Zhc3RzZXRfZm9yY2Uoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCXJldHVybiBlcnI7CiB9CiAKLWludCBp
bnRlbF9wc3JfZGVidWdfc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwgdTY0
IHZhbCkKK2ludCBpbnRlbF9wc3JfZGVidWdfc2V0KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAs
IHU2NCB2YWwpCiB7CiAJY29uc3QgdTMyIG1vZGUgPSB2YWwgJiBJOTE1X1BTUl9ERUJVR19NT0RF
X01BU0s7CiAJdTMyIG9sZF9tb2RlOwogCWludCByZXQ7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9kcCk7CiAKIAlpZiAodmFsICYgfihJOTE1
X1BTUl9ERUJVR19JUlEgfCBJOTE1X1BTUl9ERUJVR19NT0RFX01BU0spIHx8CiAJICAgIG1vZGUg
PiBJOTE1X1BTUl9ERUJVR19GT1JDRV9QU1IxKSB7CkBAIC0xNTA1LDIxICsxNTI4LDIxIEBAIGlu
dCBpbnRlbF9wc3JfZGVidWdfc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwg
dTY0IHZhbCkKIAkJcmV0dXJuIC1FSU5WQUw7CiAJfQogCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRl
cnJ1cHRpYmxlKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCXJldCA9IG11dGV4X2xvY2tfaW50ZXJy
dXB0aWJsZSgmaW50ZWxfZHAtPnBzci5sb2NrKTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0Owog
Ci0Jb2xkX21vZGUgPSBkZXZfcHJpdi0+cHNyLmRlYnVnICYgSTkxNV9QU1JfREVCVUdfTU9ERV9N
QVNLOwotCWRldl9wcml2LT5wc3IuZGVidWcgPSB2YWw7CisJb2xkX21vZGUgPSBpbnRlbF9kcC0+
cHNyLmRlYnVnICYgSTkxNV9QU1JfREVCVUdfTU9ERV9NQVNLOworCWludGVsX2RwLT5wc3IuZGVi
dWcgPSB2YWw7CiAKIAkvKgogCSAqIERvIGl0IHJpZ2h0IGF3YXkgaWYgaXQncyBhbHJlYWR5IGVu
YWJsZWQsIG90aGVyd2lzZSBpdCB3aWxsIGJlIGRvbmUKIAkgKiB3aGVuIGVuYWJsaW5nIHRoZSBz
b3VyY2UuCiAJICovCi0JaWYgKGRldl9wcml2LT5wc3IuZW5hYmxlZCkKLQkJcHNyX2lycV9jb250
cm9sKGRldl9wcml2KTsKKwlpZiAoaW50ZWxfZHAtPnBzci5lbmFibGVkKQorCQlwc3JfaXJxX2Nv
bnRyb2woaW50ZWxfZHApOwogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOwor
CW11dGV4X3VubG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKIAogCWlmIChvbGRfbW9kZSAhPSBt
b2RlKQogCQlyZXQgPSBpbnRlbF9wc3JfZmFzdHNldF9mb3JjZShkZXZfcHJpdik7CkBAIC0xNTI3
LDI4ICsxNTUwLDI4IEBAIGludCBpbnRlbF9wc3JfZGVidWdfc2V0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwgdTY0IHZhbCkKIAlyZXR1cm4gcmV0OwogfQogCi1zdGF0aWMgdm9p
ZCBpbnRlbF9wc3JfaGFuZGxlX2lycShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CitzdGF0aWMgdm9pZCBpbnRlbF9wc3JfaGFuZGxlX2lycShzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwKQogewotCXN0cnVjdCBpOTE1X3BzciAqcHNyID0gJmRldl9wcml2LT5wc3I7CisJc3RydWN0
IGludGVsX3BzciAqcHNyID0gJmludGVsX2RwLT5wc3I7CiAKLQlpbnRlbF9wc3JfZGlzYWJsZV9s
b2NrZWQocHNyLT5kcCk7CisJaW50ZWxfcHNyX2Rpc2FibGVfbG9ja2VkKGludGVsX2RwKTsKIAlw
c3ItPnNpbmtfbm90X3JlbGlhYmxlID0gdHJ1ZTsKIAkvKiBsZXQncyBtYWtlIHN1cmUgdGhhdCBz
aW5rIGlzIGF3YWtlbiAqLwotCWRybV9kcF9kcGNkX3dyaXRlYigmcHNyLT5kcC0+YXV4LCBEUF9T
RVRfUE9XRVIsIERQX1NFVF9QT1dFUl9EMCk7CisJZHJtX2RwX2RwY2Rfd3JpdGViKCZpbnRlbF9k
cC0+YXV4LCBEUF9TRVRfUE9XRVIsIERQX1NFVF9QT1dFUl9EMCk7CiB9CiAKIHN0YXRpYyB2b2lk
IGludGVsX3Bzcl93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPQotCQljb250YWluZXJfb2Yod29yaywgdHlwZW9mKCpk
ZXZfcHJpdiksIHBzci53b3JrKTsKKwlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwID0KKwkJY29u
dGFpbmVyX29mKHdvcmssIHR5cGVvZigqaW50ZWxfZHApLCBwc3Iud29yayk7CiAKLQltdXRleF9s
b2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCW11dGV4X2xvY2soJmludGVsX2RwLT5wc3IubG9j
ayk7CiAKLQlpZiAoIWRldl9wcml2LT5wc3IuZW5hYmxlZCkKKwlpZiAoIWludGVsX2RwLT5wc3Iu
ZW5hYmxlZCkKIAkJZ290byB1bmxvY2s7CiAKLQlpZiAoUkVBRF9PTkNFKGRldl9wcml2LT5wc3Iu
aXJxX2F1eF9lcnJvcikpCi0JCWludGVsX3Bzcl9oYW5kbGVfaXJxKGRldl9wcml2KTsKKwlpZiAo
UkVBRF9PTkNFKGludGVsX2RwLT5wc3IuaXJxX2F1eF9lcnJvcikpCisJCWludGVsX3Bzcl9oYW5k
bGVfaXJxKGludGVsX2RwKTsKIAogCS8qCiAJICogV2UgaGF2ZSB0byBtYWtlIHN1cmUgUFNSIGlz
IHJlYWR5IGZvciByZS1lbmFibGUKQEAgLTE1NTYsNyArMTU3OSw3IEBAIHN0YXRpYyB2b2lkIGlu
dGVsX3Bzcl93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAkgKiBQU1IgbWlnaHQgdGFr
ZSBzb21lIHRpbWUgdG8gZ2V0IGZ1bGx5IGRpc2FibGVkCiAJICogYW5kIGJlIHJlYWR5IGZvciBy
ZS1lbmFibGUuCiAJICovCi0JaWYgKCFfX3Bzcl93YWl0X2Zvcl9pZGxlX2xvY2tlZChkZXZfcHJp
dikpCisJaWYgKCFfX3Bzcl93YWl0X2Zvcl9pZGxlX2xvY2tlZChpbnRlbF9kcCkpCiAJCWdvdG8g
dW5sb2NrOwogCiAJLyoKQEAgLTE1NjQsMTIgKzE1ODcsMTIgQEAgc3RhdGljIHZvaWQgaW50ZWxf
cHNyX3dvcmsoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCSAqIHJlY2hlY2suIFNpbmNlIHBz
cl9mbHVzaCBmaXJzdCBjbGVhcnMgdGhpcyBhbmQgdGhlbiByZXNjaGVkdWxlcyB3ZQogCSAqIHdv
bid0IGV2ZXIgbWlzcyBhIGZsdXNoIHdoZW4gYmFpbGluZyBvdXQgaGVyZS4KIAkgKi8KLQlpZiAo
ZGV2X3ByaXYtPnBzci5idXN5X2Zyb250YnVmZmVyX2JpdHMgfHwgZGV2X3ByaXYtPnBzci5hY3Rp
dmUpCisJaWYgKGludGVsX2RwLT5wc3IuYnVzeV9mcm9udGJ1ZmZlcl9iaXRzIHx8IGludGVsX2Rw
LT5wc3IuYWN0aXZlKQogCQlnb3RvIHVubG9jazsKIAotCWludGVsX3Bzcl9hY3RpdmF0ZShkZXZf
cHJpdi0+cHNyLmRwKTsKKwlpbnRlbF9wc3JfYWN0aXZhdGUoaW50ZWxfZHApOwogdW5sb2NrOgot
CW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5sb2NrKTsKKwltdXRleF91bmxvY2soJmludGVs
X2RwLT5wc3IubG9jayk7CiB9CiAKIC8qKgpAQCAtMTU4OCwyNyArMTYxMSwzNSBAQCBzdGF0aWMg
dm9pZCBpbnRlbF9wc3Jfd29yayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiB2b2lkIGludGVs
X3Bzcl9pbnZhbGlkYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCSAg
dW5zaWduZWQgZnJvbnRidWZmZXJfYml0cywgZW51bSBmYl9vcF9vcmlnaW4gb3JpZ2luKQogewot
CWlmICghQ0FOX1BTUihkZXZfcHJpdikpCi0JCXJldHVybjsKKwlzdHJ1Y3QgaW50ZWxfZW5jb2Rl
ciAqZW5jb2RlcjsKKwlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwOwogCi0JaWYgKG9yaWdpbiA9
PSBPUklHSU5fRkxJUCkKLQkJcmV0dXJuOworCWZvcl9lYWNoX2ludGVsX2RwKCZkZXZfcHJpdi0+
ZHJtLCBlbmNvZGVyKSB7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOwotCWlm
ICghZGV2X3ByaXYtPnBzci5lbmFibGVkKSB7Ci0JCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBz
ci5sb2NrKTsKLQkJcmV0dXJuOwotCX0KKwkJaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5j
b2Rlcik7CisJCWlmIChlbmNvZGVyLT50eXBlICE9IElOVEVMX09VVFBVVF9FRFApCisJCQljb250
aW51ZTsKKwkJaWYgKCFDQU5fUFNSKGludGVsX2RwKSkKKwkJCWNvbnRpbnVlOworCisJCWlmIChv
cmlnaW4gPT0gT1JJR0lOX0ZMSVApCisJCQljb250aW51ZTsKIAotCWZyb250YnVmZmVyX2JpdHMg
Jj0gSU5URUxfRlJPTlRCVUZGRVJfQUxMX01BU0soZGV2X3ByaXYtPnBzci5waXBlKTsKLQlkZXZf
cHJpdi0+cHNyLmJ1c3lfZnJvbnRidWZmZXJfYml0cyB8PSBmcm9udGJ1ZmZlcl9iaXRzOworCQlt
dXRleF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOworCQlpZiAoIWludGVsX2RwLT5wc3IuZW5h
YmxlZCkgeworCQkJbXV0ZXhfdW5sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOworCQkJY29udGlu
dWU7CisJCX0KIAotCWlmIChmcm9udGJ1ZmZlcl9iaXRzKQotCQlpbnRlbF9wc3JfZXhpdChkZXZf
cHJpdik7CisJCWZyb250YnVmZmVyX2JpdHMgJj0gSU5URUxfRlJPTlRCVUZGRVJfQUxMX01BU0so
aW50ZWxfZHAtPnBzci5waXBlKTsKKwkJaW50ZWxfZHAtPnBzci5idXN5X2Zyb250YnVmZmVyX2Jp
dHMgfD0gZnJvbnRidWZmZXJfYml0czsKIAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBzci5s
b2NrKTsKLX0KKwkJaWYgKGZyb250YnVmZmVyX2JpdHMpCisJCQlpbnRlbF9wc3JfZXhpdChpbnRl
bF9kcCk7CiAKKwkJbXV0ZXhfdW5sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOworCX0KK30KIC8q
CiAgKiBXaGVuIHdlIHdpbGwgYmUgY29tcGxldGVseSByZWx5IG9uIFBTUjIgUy9XIHRyYWNraW5n
IGluIGZ1dHVyZSwKICAqIGludGVsX3Bzcl9mbHVzaCgpIHdpbGwgaW52YWxpZGF0ZSBhbmQgZmx1
c2ggdGhlIFBTUiBmb3IgT1JJR0lOX0ZMSVAKQEAgLTE2MTYsMTUgKzE2NDcsMTUgQEAgdm9pZCBp
bnRlbF9wc3JfaW52YWxpZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAg
KiBhY2NvcmRpbmdseSBpbiBmdXR1cmUuCiAgKi8KIHN0YXRpYyB2b2lkCi10Z2xfZGMzY29fZmx1
c2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAotCQl1bnNpZ25lZCBpbnQgZnJv
bnRidWZmZXJfYml0cywgZW51bSBmYl9vcF9vcmlnaW4gb3JpZ2luKQordGdsX2RjM2NvX2ZsdXNo
KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIHVuc2lnbmVkIGludCBmcm9udGJ1ZmZlcl9iaXRz
LAorCQllbnVtIGZiX29wX29yaWdpbiBvcmlnaW4pCiB7Ci0JbXV0ZXhfbG9jaygmZGV2X3ByaXYt
PnBzci5sb2NrKTsKKwltdXRleF9sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOwogCi0JaWYgKCFk
ZXZfcHJpdi0+cHNyLmRjM2NvX2VuYWJsZWQpCisJaWYgKCFpbnRlbF9kcC0+cHNyLmRjM2NvX2Vu
YWJsZWQpCiAJCWdvdG8gdW5sb2NrOwogCi0JaWYgKCFkZXZfcHJpdi0+cHNyLnBzcjJfZW5hYmxl
ZCB8fCAhZGV2X3ByaXYtPnBzci5hY3RpdmUpCisJaWYgKCFpbnRlbF9kcC0+cHNyLnBzcjJfZW5h
YmxlZCB8fCAhaW50ZWxfZHAtPnBzci5hY3RpdmUpCiAJCWdvdG8gdW5sb2NrOwogCiAJLyoKQEAg
LTE2MzIsMTUgKzE2NjMsMTUgQEAgdGdsX2RjM2NvX2ZsdXNoKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdiwKIAkgKiB3aGVuIGRlbGF5ZWQgd29yayBzY2hlZHVsZXMgdGhhdCBtZWFu
cyBkaXNwbGF5IGhhcyBiZWVuIGlkbGUuCiAJICovCiAJaWYgKCEoZnJvbnRidWZmZXJfYml0cyAm
Ci0JICAgIElOVEVMX0ZST05UQlVGRkVSX0FMTF9NQVNLKGRldl9wcml2LT5wc3IucGlwZSkpKQor
CSAgICBJTlRFTF9GUk9OVEJVRkZFUl9BTExfTUFTSyhpbnRlbF9kcC0+cHNyLnBpcGUpKSkKIAkJ
Z290byB1bmxvY2s7CiAKLQl0Z2xfcHNyMl9lbmFibGVfZGMzY28oZGV2X3ByaXYpOwotCW1vZF9k
ZWxheWVkX3dvcmsoc3lzdGVtX3dxLCAmZGV2X3ByaXYtPnBzci5kYzNjb193b3JrLAotCQkJIGRl
dl9wcml2LT5wc3IuZGMzY29fZXhpdF9kZWxheSk7CisJdGdsX3BzcjJfZW5hYmxlX2RjM2NvKGlu
dGVsX2RwKTsKKwltb2RfZGVsYXllZF93b3JrKHN5c3RlbV93cSwgJmludGVsX2RwLT5wc3IuZGMz
Y29fd29yaywKKwkJCSBpbnRlbF9kcC0+cHNyLmRjM2NvX2V4aXRfZGVsYXkpOwogCiB1bmxvY2s6
Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOworCW11dGV4X3VubG9jaygmaW50
ZWxfZHAtPnBzci5sb2NrKTsKIH0KIAogLyoqCkBAIC0xNjU5LDQ1ICsxNjkwLDU0IEBAIHRnbF9k
YzNjb19mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiB2b2lkIGludGVs
X3Bzcl9mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCSAgICAgdW5z
aWduZWQgZnJvbnRidWZmZXJfYml0cywgZW51bSBmYl9vcF9vcmlnaW4gb3JpZ2luKQogewotCWlm
ICghQ0FOX1BTUihkZXZfcHJpdikpCi0JCXJldHVybjsKLQotCWlmIChvcmlnaW4gPT0gT1JJR0lO
X0ZMSVApIHsKLQkJdGdsX2RjM2NvX2ZsdXNoKGRldl9wcml2LCBmcm9udGJ1ZmZlcl9iaXRzLCBv
cmlnaW4pOwotCQlyZXR1cm47Ci0JfQotCi0JbXV0ZXhfbG9jaygmZGV2X3ByaXYtPnBzci5sb2Nr
KTsKLQlpZiAoIWRldl9wcml2LT5wc3IuZW5hYmxlZCkgewotCQltdXRleF91bmxvY2soJmRldl9w
cml2LT5wc3IubG9jayk7Ci0JCXJldHVybjsKKwlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2Rl
cjsKKwlzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwOworCisJZm9yX2VhY2hfaW50ZWxfZHAoJmRl
dl9wcml2LT5kcm0sIGVuY29kZXIpIHsKKwkJaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5j
b2Rlcik7CisKKwkJaWYgKGVuY29kZXItPnR5cGUgPT0gSU5URUxfT1VUUFVUX0VEUCAmJiBDQU5f
UFNSKGludGVsX2RwKSkgeworCQkJaWYgKG9yaWdpbiA9PSBPUklHSU5fRkxJUCkgeworCQkJCXRn
bF9kYzNjb19mbHVzaChpbnRlbF9kcCwgZnJvbnRidWZmZXJfYml0cywgb3JpZ2luKTsKKwkJCQlj
b250aW51ZTsKKwkJCX0KKworCQkJbXV0ZXhfbG9jaygmaW50ZWxfZHAtPnBzci5sb2NrKTsKKwkJ
CWlmICghaW50ZWxfZHAtPnBzci5lbmFibGVkKSB7CisJCQkJbXV0ZXhfdW5sb2NrKCZpbnRlbF9k
cC0+cHNyLmxvY2spOworCQkJCWNvbnRpbnVlOworCQkJfQorCisJCQlmcm9udGJ1ZmZlcl9iaXRz
ICY9IElOVEVMX0ZST05UQlVGRkVSX0FMTF9NQVNLKGludGVsX2RwLT5wc3IucGlwZSk7CisJCQlp
bnRlbF9kcC0+cHNyLmJ1c3lfZnJvbnRidWZmZXJfYml0cyAmPSB+ZnJvbnRidWZmZXJfYml0czsK
KworCQkJLyogQnkgZGVmaW5pdGlvbiBmbHVzaCA9IGludmFsaWRhdGUgKyBmbHVzaCAqLworCQkJ
aWYgKGZyb250YnVmZmVyX2JpdHMpCisJCQkJcHNyX2ZvcmNlX2h3X3RyYWNraW5nX2V4aXQoaW50
ZWxfZHApOworCisJCQlpZiAoIWludGVsX2RwLT5wc3IuYWN0aXZlICYmICFpbnRlbF9kcC0+cHNy
LmJ1c3lfZnJvbnRidWZmZXJfYml0cykKKwkJCQlzY2hlZHVsZV93b3JrKCZpbnRlbF9kcC0+cHNy
LndvcmspOworCQkJbXV0ZXhfdW5sb2NrKCZpbnRlbF9kcC0+cHNyLmxvY2spOworCQl9CiAJfQot
Ci0JZnJvbnRidWZmZXJfYml0cyAmPSBJTlRFTF9GUk9OVEJVRkZFUl9BTExfTUFTSyhkZXZfcHJp
di0+cHNyLnBpcGUpOwotCWRldl9wcml2LT5wc3IuYnVzeV9mcm9udGJ1ZmZlcl9iaXRzICY9IH5m
cm9udGJ1ZmZlcl9iaXRzOwotCi0JLyogQnkgZGVmaW5pdGlvbiBmbHVzaCA9IGludmFsaWRhdGUg
KyBmbHVzaCAqLwotCWlmIChmcm9udGJ1ZmZlcl9iaXRzKQotCQlwc3JfZm9yY2VfaHdfdHJhY2tp
bmdfZXhpdChkZXZfcHJpdik7Ci0KLQlpZiAoIWRldl9wcml2LT5wc3IuYWN0aXZlICYmICFkZXZf
cHJpdi0+cHNyLmJ1c3lfZnJvbnRidWZmZXJfYml0cykKLQkJc2NoZWR1bGVfd29yaygmZGV2X3By
aXYtPnBzci53b3JrKTsKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5wc3IubG9jayk7CiB9CiAK
IC8qKgogICogaW50ZWxfcHNyX2luaXQgLSBJbml0IGJhc2ljIFBTUiB3b3JrIGFuZCBtdXRleC4K
LSAqIEBkZXZfcHJpdjogaTkxNSBkZXZpY2UgcHJpdmF0ZQorICogQGludGVsX2RwOiBJbnRlbCBE
UAogICoKLSAqIFRoaXMgZnVuY3Rpb24gaXMgIGNhbGxlZCBvbmx5IG9uY2UgYXQgZHJpdmVyIGxv
YWQgdG8gaW5pdGlhbGl6ZSBiYXNpYwotICogUFNSIHN0dWZmLgorICogVGhpcyBmdW5jdGlvbiBp
cyBjYWxsZWQgYWZ0ZXIgdGhlIGluaXRpYWxpemluZyBjb25uZWN0b3IuCisgKiAodGhlIGluaXRp
YWxpemluZyBvZiBjb25uZWN0b3IgdHJlYXRzIHRoZSBoYW5kbGluZyBvZiBjb25uZWN0b3IgY2Fw
YWJpbGl0aWVzKQorICogQW5kIGl0IGluaXRpYWxpemVzIGJhc2ljIFBTUiBzdHVmZiBmb3IgZWFj
aCBEUCBFbmNvZGVyLgogICovCi12b2lkIGludGVsX3Bzcl9pbml0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKK3ZvaWQgaW50ZWxfcHNyX2luaXQoc3RydWN0IGludGVsX2RwICpp
bnRlbF9kcCkKIHsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19p
OTE1KGludGVsX2RwKTsKKwogCWlmICghSEFTX1BTUihkZXZfcHJpdikpCiAJCXJldHVybjsKIAot
CWlmICghZGV2X3ByaXYtPnBzci5zaW5rX3N1cHBvcnQpCisJaWYgKCFpbnRlbF9kcC0+cHNyLnNp
bmtfc3VwcG9ydCkKIAkJcmV0dXJuOwogCiAJaWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpKQpAQCAt
MTcxNSwxNCArMTc1NSwxNCBAQCB2b2lkIGludGVsX3Bzcl9pbml0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKIAkvKiBTZXQgbGlua19zdGFuZGJ5IHggbGlua19vZmYgZGVmYXVs
dHMgKi8KIAlpZiAoSVNfSEFTV0VMTChkZXZfcHJpdikgfHwgSVNfQlJPQURXRUxMKGRldl9wcml2
KSkKIAkJLyogSFNXIGFuZCBCRFcgcmVxdWlyZSB3b3JrYXJvdW5kcyB0aGF0IHdlIGRvbid0IGlt
cGxlbWVudC4gKi8KLQkJZGV2X3ByaXYtPnBzci5saW5rX3N0YW5kYnkgPSBmYWxzZTsKKwkJaW50
ZWxfZHAtPnBzci5saW5rX3N0YW5kYnkgPSBmYWxzZTsKIAllbHNlIGlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpIDwgMTIpCiAJCS8qIEZvciBuZXcgcGxhdGZvcm1zIHVwIHRvIFRHTCBsZXQncyByZXNw
ZWN0IFZCVCBiYWNrIGFnYWluICovCi0JCWRldl9wcml2LT5wc3IubGlua19zdGFuZGJ5ID0gZGV2
X3ByaXYtPnZidC5wc3IuZnVsbF9saW5rOworCQlpbnRlbF9kcC0+cHNyLmxpbmtfc3RhbmRieSA9
IGRldl9wcml2LT52YnQucHNyLmZ1bGxfbGluazsKIAotCUlOSVRfV09SSygmZGV2X3ByaXYtPnBz
ci53b3JrLCBpbnRlbF9wc3Jfd29yayk7Ci0JSU5JVF9ERUxBWUVEX1dPUksoJmRldl9wcml2LT5w
c3IuZGMzY29fd29yaywgdGdsX2RjM2NvX2Rpc2FibGVfd29yayk7Ci0JbXV0ZXhfaW5pdCgmZGV2
X3ByaXYtPnBzci5sb2NrKTsKKwlJTklUX1dPUksoJmludGVsX2RwLT5wc3Iud29yaywgaW50ZWxf
cHNyX3dvcmspOworCUlOSVRfREVMQVlFRF9XT1JLKCZpbnRlbF9kcC0+cHNyLmRjM2NvX3dvcmss
IHRnbF9kYzNjb19kaXNhYmxlX3dvcmspOworCW11dGV4X2luaXQoJmludGVsX2RwLT5wc3IubG9j
ayk7CiB9CiAKIHN0YXRpYyBpbnQgcHNyX2dldF9zdGF0dXNfYW5kX2Vycm9yX3N0YXR1cyhzdHJ1
Y3QgaW50ZWxfZHAgKmludGVsX2RwLApAQCAtMTc0OCw3ICsxNzg4LDcgQEAgc3RhdGljIHZvaWQg
cHNyX2FscG1fY2hlY2soc3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKIAlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKIAlzdHJ1Y3Qg
ZHJtX2RwX2F1eCAqYXV4ID0gJmludGVsX2RwLT5hdXg7Ci0Jc3RydWN0IGk5MTVfcHNyICpwc3Ig
PSAmZGV2X3ByaXYtPnBzcjsKKwlzdHJ1Y3QgaW50ZWxfcHNyICpwc3IgPSAmaW50ZWxfZHAtPnBz
cjsKIAl1OCB2YWw7CiAJaW50IHI7CiAKQEAgLTE3NzUsNyArMTgxNSw3IEBAIHN0YXRpYyB2b2lk
IHBzcl9hbHBtX2NoZWNrKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiBzdGF0aWMgdm9pZCBw
c3JfY2FwYWJpbGl0eV9jaGFuZ2VkX2NoZWNrKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApCiB7
CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBfdG9faTkxNShpbnRlbF9k
cCk7Ci0Jc3RydWN0IGk5MTVfcHNyICpwc3IgPSAmZGV2X3ByaXYtPnBzcjsKKwlzdHJ1Y3QgaW50
ZWxfcHNyICpwc3IgPSAmaW50ZWxfZHAtPnBzcjsKIAl1OCB2YWw7CiAJaW50IHI7CiAKQEAgLTE3
OTksMTggKzE4MzksMTggQEAgc3RhdGljIHZvaWQgcHNyX2NhcGFiaWxpdHlfY2hhbmdlZF9jaGVj
ayhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogdm9pZCBpbnRlbF9wc3Jfc2hvcnRfcHVsc2Uo
c3RydWN0IGludGVsX2RwICppbnRlbF9kcCkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSBkcF90b19pOTE1KGludGVsX2RwKTsKLQlzdHJ1Y3QgaTkxNV9wc3IgKnBzciA9
ICZkZXZfcHJpdi0+cHNyOworCXN0cnVjdCBpbnRlbF9wc3IgKnBzciA9ICZpbnRlbF9kcC0+cHNy
OwogCXU4IHN0YXR1cywgZXJyb3Jfc3RhdHVzOwogCWNvbnN0IHU4IGVycm9ycyA9IERQX1BTUl9S
RkJfU1RPUkFHRV9FUlJPUiB8CiAJCQkgIERQX1BTUl9WU0NfU0RQX1VOQ09SUkVDVEFCTEVfRVJS
T1IgfAogCQkJICBEUF9QU1JfTElOS19DUkNfRVJST1I7CiAKLQlpZiAoIUNBTl9QU1IoZGV2X3By
aXYpIHx8ICFpbnRlbF9kcF9pc19lZHAoaW50ZWxfZHApKQorCWlmICghQ0FOX1BTUihpbnRlbF9k
cCkgfHwgIWludGVsX2RwX2lzX2VkcChpbnRlbF9kcCkpCiAJCXJldHVybjsKIAogCW11dGV4X2xv
Y2soJnBzci0+bG9jayk7CiAKLQlpZiAoIXBzci0+ZW5hYmxlZCB8fCBwc3ItPmRwICE9IGludGVs
X2RwKQorCWlmICghcHNyLT5lbmFibGVkKQogCQlnb3RvIGV4aXQ7CiAKIAlpZiAocHNyX2dldF9z
dGF0dXNfYW5kX2Vycm9yX3N0YXR1cyhpbnRlbF9kcCwgJnN0YXR1cywgJmVycm9yX3N0YXR1cykp
IHsKQEAgLTE4NTMsMTUgKzE4OTMsMTQgQEAgdm9pZCBpbnRlbF9wc3Jfc2hvcnRfcHVsc2Uoc3Ry
dWN0IGludGVsX2RwICppbnRlbF9kcCkKIAogYm9vbCBpbnRlbF9wc3JfZW5hYmxlZChzdHJ1Y3Qg
aW50ZWxfZHAgKmludGVsX2RwKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IGRwX3RvX2k5MTUoaW50ZWxfZHApOwogCWJvb2wgcmV0OwogCi0JaWYgKCFDQU5fUFNSKGRl
dl9wcml2KSB8fCAhaW50ZWxfZHBfaXNfZWRwKGludGVsX2RwKSkKKwlpZiAoIUNBTl9QU1IoaW50
ZWxfZHApIHx8ICFpbnRlbF9kcF9pc19lZHAoaW50ZWxfZHApKQogCQlyZXR1cm4gZmFsc2U7CiAK
LQltdXRleF9sb2NrKCZkZXZfcHJpdi0+cHNyLmxvY2spOwotCXJldCA9IChkZXZfcHJpdi0+cHNy
LmRwID09IGludGVsX2RwICYmIGRldl9wcml2LT5wc3IuZW5hYmxlZCk7Ci0JbXV0ZXhfdW5sb2Nr
KCZkZXZfcHJpdi0+cHNyLmxvY2spOworCW11dGV4X2xvY2soJmludGVsX2RwLT5wc3IubG9jayk7
CisJcmV0ID0gaW50ZWxfZHAtPnBzci5lbmFibGVkOworCW11dGV4X3VubG9jaygmaW50ZWxfZHAt
PnBzci5sb2NrKTsKIAogCXJldHVybiByZXQ7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9wc3IuaAppbmRleCAwYTUxNzk3OGU4YWYuLjAzZWIxOTU0N2QwOSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9wc3IuaAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Bzci5oCkBAIC0xOCw3ICsxOCw3IEBAIHN0cnVj
dCBpbnRlbF9hdG9taWNfc3RhdGU7CiBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGU7CiBzdHJ1Y3Qg
aW50ZWxfcGxhbmU7CiAKLSNkZWZpbmUgQ0FOX1BTUihkZXZfcHJpdikgKEhBU19QU1IoZGV2X3By
aXYpICYmIGRldl9wcml2LT5wc3Iuc2lua19zdXBwb3J0KQorI2RlZmluZSBDQU5fUFNSKGludGVs
X2RwKSAoSEFTX1BTUihkcF90b19pOTE1KGludGVsX2RwKSkgJiYgaW50ZWxfZHAtPnBzci5zaW5r
X3N1cHBvcnQpCiB2b2lkIGludGVsX3Bzcl9pbml0X2RwY2Qoc3RydWN0IGludGVsX2RwICppbnRl
bF9kcCk7CiB2b2lkIGludGVsX3Bzcl9lbmFibGUoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwK
IAkJICAgICAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCkBAIC0y
OCwyNCArMjgsMjQgQEAgdm9pZCBpbnRlbF9wc3JfZGlzYWJsZShzdHJ1Y3QgaW50ZWxfZHAgKmlu
dGVsX2RwLAogdm9pZCBpbnRlbF9wc3JfdXBkYXRlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAs
CiAJCSAgICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAogCQkg
ICAgICBjb25zdCBzdHJ1Y3QgZHJtX2Nvbm5lY3Rvcl9zdGF0ZSAqY29ubl9zdGF0ZSk7Ci1pbnQg
aW50ZWxfcHNyX2RlYnVnX3NldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHU2
NCB2YWx1ZSk7CitpbnQgaW50ZWxfcHNyX2RlYnVnX3NldChzdHJ1Y3QgaW50ZWxfZHAgKmludGVs
X2RwLCB1NjQgdmFsdWUpOwogdm9pZCBpbnRlbF9wc3JfaW52YWxpZGF0ZShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkgIHVuc2lnbmVkIGZyb250YnVmZmVyX2JpdHMsCiAJ
CQkgIGVudW0gZmJfb3Bfb3JpZ2luIG9yaWdpbik7CiB2b2lkIGludGVsX3Bzcl9mbHVzaChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCSAgICAgdW5zaWduZWQgZnJvbnRidWZm
ZXJfYml0cywKIAkJICAgICBlbnVtIGZiX29wX29yaWdpbiBvcmlnaW4pOwotdm9pZCBpbnRlbF9w
c3JfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwordm9pZCBpbnRlbF9w
c3JfaW5pdChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKTsKIHZvaWQgaW50ZWxfcHNyX2NvbXB1
dGVfY29uZmlnKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJCQkgICAgICBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7Ci12b2lkIGludGVsX3Bzcl9pcnFfaGFuZGxlcihz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBwc3JfaWlyKTsKK3ZvaWQgaW50
ZWxfcHNyX2lycV9oYW5kbGVyKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIHUzMiBwc3JfaWly
KTsKIHZvaWQgaW50ZWxfcHNyX3Nob3J0X3B1bHNlKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAp
OwotaW50IGludGVsX3Bzcl93YWl0X2Zvcl9pZGxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpuZXdfY3J0Y19zdGF0ZSwKLQkJCSAgICB1MzIgKm91dF92YWx1ZSk7Cit2b2lkIGludGVs
X3Bzcl93YWl0X2Zvcl9pZGxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfY3J0
Y19zdGF0ZSk7CiBib29sIGludGVsX3Bzcl9lbmFibGVkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxf
ZHApOwogaW50IGludGVsX3BzcjJfc2VsX2ZldGNoX3VwZGF0ZShzdHJ1Y3QgaW50ZWxfYXRvbWlj
X3N0YXRlICpzdGF0ZSwKIAkJCQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0Yyk7Ci12b2lkIGludGVs
X3BzcjJfcHJvZ3JhbV90cmFuc19tYW5fdHJrX2N0bChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSk7Cit2b2lkIGludGVsX3BzcjJfcHJvZ3JhbV90cmFuc19tYW5fdHJr
X2N0bChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAorCQkJCQkgIGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKIHZvaWQgaW50ZWxfcHNyMl9wcm9ncmFtX3BsYW5l
X3NlbF9mZXRjaChzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCQkJCQljb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkJY29uc3Qgc3RydWN0IGludGVsX3Bs
YW5lX3N0YXRlICpwbGFuZV9zdGF0ZSwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX3Nwcml0ZS5jCmluZGV4IGI2ZGVlYjMzODQ3Ny4uY2NkODZmMTY4MzU3IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3ByaXRlLmMKQEAgLTkyLDcgKzkyLDYgQEAg
dm9pZCBpbnRlbF9waXBlX3VwZGF0ZV9zdGFydChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0
ZSAqbmV3X2NydGNfc3RhdGUpCiAJYm9vbCBuZWVkX3Zsdl9kc2lfd2EgPSAoSVNfVkFMTEVZVklF
VyhkZXZfcHJpdikgfHwgSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpICYmCiAJCWludGVsX2NydGNf
aGFzX3R5cGUobmV3X2NydGNfc3RhdGUsIElOVEVMX09VVFBVVF9EU0kpOwogCURFRklORV9XQUlU
KHdhaXQpOwotCXUzMiBwc3Jfc3RhdHVzOwogCiAJaWYgKG5ld19jcnRjX3N0YXRlLT51YXBpLmFz
eW5jX2ZsaXApCiAJCXJldHVybjsKQEAgLTExNywxMCArMTE2LDcgQEAgdm9pZCBpbnRlbF9waXBl
X3VwZGF0ZV9zdGFydChjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3Rh
dGUpCiAJICogVkJMIGludGVycnVwdHMgd2lsbCBzdGFydCB0aGUgUFNSIGV4aXQgYW5kIHByZXZl
bnQgYSBQU1IKIAkgKiByZS1lbnRyeSBhcyB3ZWxsLgogCSAqLwotCWlmIChpbnRlbF9wc3Jfd2Fp
dF9mb3JfaWRsZShuZXdfY3J0Y19zdGF0ZSwgJnBzcl9zdGF0dXMpKQotCQlkcm1fZXJyKCZkZXZf
cHJpdi0+ZHJtLAotCQkJIlBTUiBpZGxlIHRpbWVkIG91dCAweCV4LCBhdG9taWMgdXBkYXRlIG1h
eSBmYWlsXG4iLAotCQkJcHNyX3N0YXR1cyk7CisJaW50ZWxfcHNyX3dhaXRfZm9yX2lkbGUobmV3
X2NydGNfc3RhdGUpOwogCiAJbG9jYWxfaXJxX2Rpc2FibGUoKTsKIApkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZHJ2LmgKaW5kZXggMTViZThkZWJhZTU0Li41YTQwMjk1MjYwYzIgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kcnYuaApAQCAtNDc1LDQyICs0NzUsNiBAQCBzdHJ1Y3QgaTkxNV9kcnJzIHsKIAllbnVtIGRy
cnNfc3VwcG9ydF90eXBlIHR5cGU7CiB9OwogCi1zdHJ1Y3QgaTkxNV9wc3IgewotCXN0cnVjdCBt
dXRleCBsb2NrOwotCi0jZGVmaW5lIEk5MTVfUFNSX0RFQlVHX01PREVfTUFTSwkweDBmCi0jZGVm
aW5lIEk5MTVfUFNSX0RFQlVHX0RFRkFVTFQJCTB4MDAKLSNkZWZpbmUgSTkxNV9QU1JfREVCVUdf
RElTQUJMRQkJMHgwMQotI2RlZmluZSBJOTE1X1BTUl9ERUJVR19FTkFCTEUJCTB4MDIKLSNkZWZp
bmUgSTkxNV9QU1JfREVCVUdfRk9SQ0VfUFNSMQkweDAzCi0jZGVmaW5lIEk5MTVfUFNSX0RFQlVH
X0lSUQkJMHgxMAotCi0JdTMyIGRlYnVnOwotCWJvb2wgc2lua19zdXBwb3J0OwotCWJvb2wgZW5h
YmxlZDsKLQlzdHJ1Y3QgaW50ZWxfZHAgKmRwOwotCWVudW0gcGlwZSBwaXBlOwotCWVudW0gdHJh
bnNjb2RlciB0cmFuc2NvZGVyOwotCWJvb2wgYWN0aXZlOwotCXN0cnVjdCB3b3JrX3N0cnVjdCB3
b3JrOwotCXVuc2lnbmVkIGJ1c3lfZnJvbnRidWZmZXJfYml0czsKLQlib29sIHNpbmtfcHNyMl9z
dXBwb3J0OwotCWJvb2wgbGlua19zdGFuZGJ5OwotCWJvb2wgY29sb3JpbWV0cnlfc3VwcG9ydDsK
LQlib29sIHBzcjJfZW5hYmxlZDsKLQlib29sIHBzcjJfc2VsX2ZldGNoX2VuYWJsZWQ7Ci0JdTgg
c2lua19zeW5jX2xhdGVuY3k7Ci0Ja3RpbWVfdCBsYXN0X2VudHJ5X2F0dGVtcHQ7Ci0Ja3RpbWVf
dCBsYXN0X2V4aXQ7Ci0JYm9vbCBzaW5rX25vdF9yZWxpYWJsZTsKLQlib29sIGlycV9hdXhfZXJy
b3I7Ci0JdTE2IHN1X3hfZ3JhbnVsYXJpdHk7Ci0JYm9vbCBkYzNjb19lbmFibGVkOwotCXUzMiBk
YzNjb19leGl0X2RlbGF5OwotCXN0cnVjdCBkZWxheWVkX3dvcmsgZGMzY29fd29yazsKLQlzdHJ1
Y3QgZHJtX2RwX3ZzY19zZHAgdnNjOwotfTsKLQogI2RlZmluZSBRVUlSS19MVkRTX1NTQ19ESVNB
QkxFICgxPDwxKQogI2RlZmluZSBRVUlSS19JTlZFUlRfQlJJR0hUTkVTUyAoMTw8MikKICNkZWZp
bmUgUVVJUktfQkFDS0xJR0hUX1BSRVNFTlQgKDE8PDMpCkBAIC0xMDQxLDggKzEwMDUsNiBAQCBz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSB7CiAKIAlzdHJ1Y3QgaTkxNV9wb3dlcl9kb21haW5zIHBv
d2VyX2RvbWFpbnM7CiAKLQlzdHJ1Y3QgaTkxNV9wc3IgcHNyOwotCiAJc3RydWN0IGk5MTVfZ3B1
X2Vycm9yIGdwdV9lcnJvcjsKIAogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICp2bHZfcGN0
eDsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfaXJxLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2lycS5jCmluZGV4IGUwZWIzMmJkOTYwNy4uNmQ0MzI5OGM0NmRk
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2lycS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfaXJxLmMKQEAgLTIwNTcsMTAgKzIwNTcsMjAgQEAgc3RhdGlj
IHZvaWQgaXZiX2Rpc3BsYXlfaXJxX2hhbmRsZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAogCQlpdmJfZXJyX2ludF9oYW5kbGVyKGRldl9wcml2KTsKIAogCWlmIChkZV9paXIg
JiBERV9FRFBfUFNSX0lOVF9IU1cpIHsKLQkJdTMyIHBzcl9paXIgPSBJOTE1X1JFQUQoRURQX1BT
Ul9JSVIpOworCQlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKIAotCQlpbnRlbF9wc3Jf
aXJxX2hhbmRsZXIoZGV2X3ByaXYsIHBzcl9paXIpOwotCQlJOTE1X1dSSVRFKEVEUF9QU1JfSUlS
LCBwc3JfaWlyKTsKKwkJZm9yX2VhY2hfaW50ZWxfZHAoJmRldl9wcml2LT5kcm0sIGVuY29kZXIp
IHsKKwkJCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAgPSBlbmNfdG9faW50ZWxfZHAoZW5jb2Rl
cik7CisKKwkJCWlmIChlbmNvZGVyLT50eXBlID09IElOVEVMX09VVFBVVF9FRFAgJiYKKwkJCSAg
ICBDQU5fUFNSKGludGVsX2RwKSkgeworCQkJCXUzMiBwc3JfaWlyID0gSTkxNV9SRUFEKEVEUF9Q
U1JfSUlSKTsKKworCQkJCWludGVsX3Bzcl9pcnFfaGFuZGxlcihpbnRlbF9kcCwgcHNyX2lpcik7
CisJCQkJSTkxNV9XUklURShFRFBfUFNSX0lJUiwgcHNyX2lpcik7CisJCQkJYnJlYWs7CisJCQl9
CisJCX0KIAl9CiAKIAlpZiAoZGVfaWlyICYgREVfQVVYX0NIQU5ORUxfQV9JVkIpCkBAIC0yMjY4
LDIxICsyMjc4LDM0IEBAIGdlbjhfZGVfbWlzY19pcnFfaGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYsIHUzMiBpaXIpCiAJfQogCiAJaWYgKGlpciAmIEdFTjhfREVfRURQ
X1BTUikgeworCQlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKIAkJdTMyIHBzcl9paXI7
CiAJCWk5MTVfcmVnX3QgaWlyX3JlZzsKIAotCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAx
MikKLQkJCWlpcl9yZWcgPSBUUkFOU19QU1JfSUlSKGRldl9wcml2LT5wc3IudHJhbnNjb2Rlcik7
Ci0JCWVsc2UKLQkJCWlpcl9yZWcgPSBFRFBfUFNSX0lJUjsKKwkJZm9yX2VhY2hfaW50ZWxfZHAo
JmRldl9wcml2LT5kcm0sIGVuY29kZXIpIHsKKwkJCXN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAg
PSBlbmNfdG9faW50ZWxfZHAoZW5jb2Rlcik7CiAKLQkJcHNyX2lpciA9IEk5MTVfUkVBRChpaXJf
cmVnKTsKLQkJSTkxNV9XUklURShpaXJfcmVnLCBwc3JfaWlyKTsKKwkJCWlmIChJTlRFTF9HRU4o
ZGV2X3ByaXYpID49IDEyICYmIENBTl9QU1IoaW50ZWxfZHApKSB7CisJCQkJaWlyX3JlZyA9IFRS
QU5TX1BTUl9JSVIoaW50ZWxfZHAtPnBzci50cmFuc2NvZGVyKTsKKwkJCX0gZWxzZSBpZiAoZW5j
b2Rlci0+dHlwZSA9PSBJTlRFTF9PVVRQVVRfRURQICYmCisJCQkJICAgQ0FOX1BTUihpbnRlbF9k
cCkpIHsKKwkJCQlpaXJfcmVnID0gRURQX1BTUl9JSVI7CisJCQl9IGVsc2UgeworCQkJCWNvbnRp
bnVlOworCQkJfQorCisJCQlwc3JfaWlyID0gSTkxNV9SRUFEKGlpcl9yZWcpOworCQkJSTkxNV9X
UklURShpaXJfcmVnLCBwc3JfaWlyKTsKKworCQkJaWYgKHBzcl9paXIpCisJCQkJZm91bmQgPSB0
cnVlOwogCi0JCWlmIChwc3JfaWlyKQotCQkJZm91bmQgPSB0cnVlOworCQkJaW50ZWxfcHNyX2ly
cV9oYW5kbGVyKGludGVsX2RwLCBwc3JfaWlyKTsKIAotCQlpbnRlbF9wc3JfaXJxX2hhbmRsZXIo
ZGV2X3ByaXYsIHBzcl9paXIpOworCQkJLyogcHJpb3IgR0VOMTIgb25seSBoYXZlIG9uZSBFRFAg
UFNSICovCisJCQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDEyKQorCQkJCWJyZWFrOworCQl9
CiAJfQogCiAJaWYgKCFmb3VuZCkKLS0gCjIuMjUuMAoKX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhA
bGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxt
YW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

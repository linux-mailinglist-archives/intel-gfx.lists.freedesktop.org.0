Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 29EB7BDA0F
	for <lists+intel-gfx@lfdr.de>; Wed, 25 Sep 2019 10:43:37 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 04D026EB3D;
	Wed, 25 Sep 2019 08:43:35 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B42A089A67
 for <intel-gfx@lists.freedesktop.org>; Wed, 25 Sep 2019 08:43:32 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from localhost (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP (TLS) id
 18608305-1500050 for multiple; Wed, 25 Sep 2019 09:43:33 +0100
MIME-Version: 1.0
From: Chris Wilson <chris@chris-wilson.co.uk>
User-Agent: alot/0.6
To: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>,
 intel-gfx@lists.freedesktop.org
References: <20190902040303.14195-1-chris@chris-wilson.co.uk>
 <20190902040303.14195-17-chris@chris-wilson.co.uk>
 <86c1cd64-e5e5-4065-7489-f8a861981061@linux.intel.com>
In-Reply-To: <86c1cd64-e5e5-4065-7489-f8a861981061@linux.intel.com>
Message-ID: <156940100781.4979.16490963525085766366@skylake-alporthouse-com>
Date: Wed, 25 Sep 2019 09:43:27 +0100
Subject: Re: [Intel-gfx] [PATCH 17/21] drm/i915: Drop struct_mutex from
 around i915_retire_requests()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UXVvdGluZyBUdnJ0a28gVXJzdWxpbiAoMjAxOS0wOS0yNCAxNjoyNToyOSkKPiAKPiBPbiAwMi8w
OS8yMDE5IDA1OjAyLCBDaHJpcyBXaWxzb24gd3JvdGU6Cj4gPiBAQCAtNDQ5LDggKzQ0Nyw2IEBA
IHRsX3dyaXRlKHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwsIHN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmVuZ2luZSwgdTMyIHZhbHVlKQo+ID4gICAgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7
Cj4gPiAgICAgICBpbnQgZXJyOwo+ID4gICAKPiA+IC0gICAgIGxvY2tkZXBfYXNzZXJ0X2hlbGQo
JnRsLT5ndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7IC8qIGxhenkgcnEgcmVmcyAqLwo+ID4g
LQo+ID4gICAgICAgZXJyID0gaW50ZWxfdGltZWxpbmVfcGluKHRsKTsKPiA+ICAgICAgIGlmIChl
cnIpIHsKPiA+ICAgICAgICAgICAgICAgcnEgPSBFUlJfUFRSKGVycik7Cj4gPiBAQCAtNDYxLDEw
ICs0NTcsMTQgQEAgdGxfd3JpdGUoc3RydWN0IGludGVsX3RpbWVsaW5lICp0bCwgc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqZW5naW5lLCB1MzIgdmFsdWUpCj4gPiAgICAgICBpZiAoSVNfRVJSKHJx
KSkKPiA+ICAgICAgICAgICAgICAgZ290byBvdXRfdW5waW47Cj4gPiAgIAo+ID4gKyAgICAgaTkx
NV9yZXF1ZXN0X2dldChycSk7Cj4gPiArCj4gPiAgICAgICBlcnIgPSBlbWl0X2dndHRfc3RvcmVf
ZHcocnEsIHRsLT5od3NwX29mZnNldCwgdmFsdWUpOwo+ID4gICAgICAgaTkxNV9yZXF1ZXN0X2Fk
ZChycSk7Cj4gPiAtICAgICBpZiAoZXJyKQo+ID4gKyAgICAgaWYgKGVycikgewo+ID4gKyAgICAg
ICAgICAgICBpOTE1X3JlcXVlc3RfcHV0KHJxKTsKPiA+ICAgICAgICAgICAgICAgcnEgPSBFUlJf
UFRSKGVycik7Cj4gPiArICAgICB9Cj4gPiAgIAo+ID4gICBvdXRfdW5waW46Cj4gPiAgICAgICBp
bnRlbF90aW1lbGluZV91bnBpbih0bCk7Cj4gPiBAQCAtNTAwLDcgKzUwMCw2IEBAIHN0YXRpYyBp
bnQgbGl2ZV9od3NwX2VuZ2luZSh2b2lkICphcmcpCj4gPiAgICAgICBzdHJ1Y3QgaW50ZWxfdGlt
ZWxpbmUgKip0aW1lbGluZXM7Cj4gPiAgICAgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmU7Cj4gPiAgICAgICBlbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKPiA+IC0gICAgIGludGVsX3dh
a2VyZWZfdCB3YWtlcmVmOwo+ID4gICAgICAgdW5zaWduZWQgbG9uZyBjb3VudCwgbjsKPiA+ICAg
ICAgIGludCBlcnIgPSAwOwo+ID4gICAKPiA+IEBAIC01MTUsMTQgKzUxNCwxMyBAQCBzdGF0aWMg
aW50IGxpdmVfaHdzcF9lbmdpbmUodm9pZCAqYXJnKQo+ID4gICAgICAgaWYgKCF0aW1lbGluZXMp
Cj4gPiAgICAgICAgICAgICAgIHJldHVybiAtRU5PTUVNOwo+ID4gICAKPiA+IC0gICAgIG11dGV4
X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwo+ID4gLSAgICAgd2FrZXJlZiA9IGludGVs
X3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKPiA+IC0KPiA+ICAgICAgIGNvdW50
ID0gMDsKPiA+ICAgICAgIGZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7Cj4gPiAg
ICAgICAgICAgICAgIGlmICghaW50ZWxfZW5naW5lX2Nhbl9zdG9yZV9kd29yZChlbmdpbmUpKQo+
ID4gICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwo+ID4gICAKPiA+ICsgICAgICAgICAg
ICAgaW50ZWxfZW5naW5lX3BtX2dldChlbmdpbmUpOwo+ID4gKwo+ID4gICAgICAgICAgICAgICBm
b3IgKG4gPSAwOyBuIDwgTlVNX1RJTUVMSU5FUzsgbisrKSB7Cj4gPiAgICAgICAgICAgICAgICAg
ICAgICAgc3RydWN0IGludGVsX3RpbWVsaW5lICp0bDsKPiA+ICAgICAgICAgICAgICAgICAgICAg
ICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKPiA+IEBAIC01MzAsMjIgKzUyOCwyNiBAQCBzdGF0
aWMgaW50IGxpdmVfaHdzcF9lbmdpbmUodm9pZCAqYXJnKQo+ID4gICAgICAgICAgICAgICAgICAg
ICAgIHRsID0gY2hlY2tlZF9pbnRlbF90aW1lbGluZV9jcmVhdGUoaTkxNSk7Cj4gPiAgICAgICAg
ICAgICAgICAgICAgICAgaWYgKElTX0VSUih0bCkpIHsKPiA+ICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIGVyciA9IFBUUl9FUlIodGwpOwo+ID4gLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgZ290byBvdXQ7Cj4gPiArICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsK
PiA+ICAgICAgICAgICAgICAgICAgICAgICB9Cj4gPiAgIAo+ID4gICAgICAgICAgICAgICAgICAg
ICAgIHJxID0gdGxfd3JpdGUodGwsIGVuZ2luZSwgY291bnQpOwo+ID4gICAgICAgICAgICAgICAg
ICAgICAgIGlmIChJU19FUlIocnEpKSB7Cj4gPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICBpbnRlbF90aW1lbGluZV9wdXQodGwpOwo+ID4gICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgZXJyID0gUFRSX0VSUihycSk7Cj4gPiAtICAgICAgICAgICAgICAgICAgICAgICAgICAgICBn
b3RvIG91dDsKPiA+ICsgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwo+ID4gICAg
ICAgICAgICAgICAgICAgICAgIH0KPiA+ICAgCj4gPiAgICAgICAgICAgICAgICAgICAgICAgdGlt
ZWxpbmVzW2NvdW50KytdID0gdGw7Cj4gPiArICAgICAgICAgICAgICAgICAgICAgaTkxNV9yZXF1
ZXN0X3B1dChycSk7Cj4gCj4gVGhpcyB3YXMgYSBsZWFrIHVudGlsIG5vdz8KCk5vLCB3ZSBhZGRl
ZCBhIGdldCBpbnRvIHRsX3dyaXRlKCkgc28gdGhhdCB3ZSBvd24gYSByZWZlcmVuY2UgdG8gdGhl
CnJlcXVlc3QsIGp1c3Qgc28gdGhhdCBvd25lcnNoaXAgaXMgY2xlYXIgYWNyb3NzIHRoZSB3YWl0
cyAoYW5kIGl0IGNhbid0CmFjY2lkZW50YWxseSBiZSByZXRpcmVkKS4KCj4gPiBAQCAtNjgxLDcg
KzY3MCw5IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX3dyYXAodm9pZCAqYXJnKQo+ID4gICAgICAg
ICAgICAgICBpZiAoIWludGVsX2VuZ2luZV9jYW5fc3RvcmVfZHdvcmQoZW5naW5lKSkKPiA+ICAg
ICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKPiA+ICAgCj4gPiArICAgICAgICAgICAgIGlu
dGVsX2VuZ2luZV9wbV9nZXQoZW5naW5lKTsKPiA+ICAgICAgICAgICAgICAgcnEgPSBpOTE1X3Jl
cXVlc3RfY3JlYXRlKGVuZ2luZS0+a2VybmVsX2NvbnRleHQpOwo+ID4gKyAgICAgICAgICAgICBp
bnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2luZSk7Cj4gPiAgICAgICAgICAgICAgIGlmIChJU19FUlIo
cnEpKSB7Cj4gPiAgICAgICAgICAgICAgICAgICAgICAgZXJyID0gUFRSX0VSUihycSk7Cj4gPiAg
ICAgICAgICAgICAgICAgICAgICAgZ290byBvdXQ7Cj4gPiBAQCAtNzQ3LDE2ICs3MzgsMTIgQEAg
c3RhdGljIGludCBsaXZlX2h3c3Bfd3JhcCh2b2lkICphcmcpCj4gPiAgICAgICB9Cj4gPiAgIAo+
IAo+IE5vIGk5MTVfcmVxdWVzdF9wdXQgaW4gdGhpcyBvbmUgYW5kIEkgY2FuJ3Qgc2VlIHdoeSBp
dCB3b3VsZCBiZSBkaWZmZXJlbnQuCgpJdCdzIG5vdCB1c2luZyB0bF93cml0ZSB3aXRoIHRoZSBh
ZGRlZCByZWYuCgo+ID4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pZ3RfZmx1c2hfdGVzdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9m
bHVzaF90ZXN0LmMKPiA+IGluZGV4IGQzYjVlYjQwMmQzMy4uMmE1ZmJlNDZlYTlmIDEwMDY0NAo+
ID4gLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9mbHVzaF90ZXN0LmMK
PiA+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5j
Cj4gPiBAQCAtMTIsMzEgKzEyLDI1IEBACj4gPiAgIAo+ID4gICAjaW5jbHVkZSAiaWd0X2ZsdXNo
X3Rlc3QuaCIKPiA+ICAgCj4gPiAtaW50IGlndF9mbHVzaF90ZXN0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LCB1bnNpZ25lZCBpbnQgZmxhZ3MpCj4gPiAraW50IGlndF9mbHVzaF90ZXN0
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQo+ID4gICB7Cj4gPiAgICAgICBpbnQgcmV0
ID0gaW50ZWxfZ3RfaXNfd2VkZ2VkKCZpOTE1LT5ndCkgPyAtRUlPIDogMDsKPiA+IC0gICAgIGlu
dCByZXBlYXQgPSAhIShmbGFncyAmIEk5MTVfV0FJVF9MT0NLRUQpOwo+ID4gICAKPiA+ICAgICAg
IGNvbmRfcmVzY2hlZCgpOwo+ID4gICAKPiA+IC0gICAgIGRvIHsKPiA+IC0gICAgICAgICAgICAg
aWYgKGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoaTkxNSwgZmxhZ3MsIEhaIC8gNSkgPT0gLUVUSU1F
KSB7Cj4gPiAtICAgICAgICAgICAgICAgICAgICAgcHJfZXJyKCIlcFMgdGltZWQgb3V0LCBjYW5j
ZWxsaW5nIGFsbCBmdXJ0aGVyIHRlc3RpbmcuXG4iLAo+ID4gLSAgICAgICAgICAgICAgICAgICAg
ICAgICAgICBfX2J1aWx0aW5fcmV0dXJuX2FkZHJlc3MoMCkpOwo+ID4gKyAgICAgaTkxNV9yZXRp
cmVfcmVxdWVzdHMoaTkxNSk7Cj4gCj4gRG8geW91IG5lZWQgdGhpcyBvbmUgb3IgaXQgd291bGQg
YmUgYmV0dGVyIHdpdGhvdXQsIGZvciBjbGFyaXR5LCBnaXZlbiAKPiB0aGVyZSBpcyBvbmUgYXQg
dGhlIGVuZD8gaTkxNV9nZW1fd2FpdF9mb3JfaWRsZSB3aWxsIHJldGlyZSBhbGwgaXQgY2FuLgoK
SXQncyB0byBhaWRlIGtpY2sgc3RhcnRpbmcgb2YgdGhlIGlkbGUtYmFycmllci4gRXZlbnR1YWxs
eSB0aGlzIGlzCnB1bGxlZCB0b2dldGhlciBhZ2Fpbi4KCj4gPiArICAgICBpZiAoaTkxNV9nZW1f
d2FpdF9mb3JfaWRsZShpOTE1LCAwLCBIWiAvIDUpID09IC1FVElNRSkgewo+ID4gKyAgICAgICAg
ICAgICBwcl9lcnIoIiVwUyB0aW1lZCBvdXQsIGNhbmNlbGxpbmcgYWxsIGZ1cnRoZXIgdGVzdGlu
Zy5cbiIsCj4gPiArICAgICAgICAgICAgICAgICAgICBfX2J1aWx0aW5fcmV0dXJuX2FkZHJlc3Mo
MCkpOwo+ID4gICAKPiA+IC0gICAgICAgICAgICAgICAgICAgICBHRU1fVFJBQ0UoIiVwUyB0aW1l
ZCBvdXQuXG4iLAo+ID4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfX2J1aWx0aW5f
cmV0dXJuX2FkZHJlc3MoMCkpOwo+ID4gLSAgICAgICAgICAgICAgICAgICAgIEdFTV9UUkFDRV9E
VU1QKCk7Cj4gPiArICAgICAgICAgICAgIEdFTV9UUkFDRSgiJXBTIHRpbWVkIG91dC5cbiIsCj4g
PiArICAgICAgICAgICAgICAgICAgICAgICBfX2J1aWx0aW5fcmV0dXJuX2FkZHJlc3MoMCkpOwo+
ID4gKyAgICAgICAgICAgICBHRU1fVFJBQ0VfRFVNUCgpOwo+ID4gICAKPiA+IC0gICAgICAgICAg
ICAgICAgICAgICBpbnRlbF9ndF9zZXRfd2VkZ2VkKCZpOTE1LT5ndCk7Cj4gPiAtICAgICAgICAg
ICAgICAgICAgICAgcmVwZWF0ID0gMDsKPiA+IC0gICAgICAgICAgICAgICAgICAgICByZXQgPSAt
RUlPOwo+ID4gLSAgICAgICAgICAgICB9Cj4gPiAtCj4gPiAtICAgICAgICAgICAgIC8qIEVuc3Vy
ZSB3ZSBhbHNvIGZsdXNoIGFmdGVyIHdlZGdpbmcuICovCj4gPiAtICAgICAgICAgICAgIGlmIChm
bGFncyAmIEk5MTVfV0FJVF9MT0NLRUQpCj4gPiAtICAgICAgICAgICAgICAgICAgICAgaTkxNV9y
ZXRpcmVfcmVxdWVzdHMoaTkxNSk7Cj4gPiAtICAgICB9IHdoaWxlIChyZXBlYXQtLSk7Cj4gPiAr
ICAgICAgICAgICAgIGludGVsX2d0X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKPiA+ICsgICAgICAg
ICAgICAgcmV0ID0gLUVJTzsKPiA+ICsgICAgIH0KPiA+ICsgICAgIGk5MTVfcmV0aXJlX3JlcXVl
c3RzKGk5MTUpOwo+ID4gICAKPiA+ICAgICAgIHJldHVybiByZXQ7Cj4gPiAgIH0KCj4gRXNzZW50
aWFsbHkgbG9va3MgZmluZS4gUHJvdmlzaW9uYWwsIG1lYW5pbmcga2VlcCBpdCBpZiB5b3UgZG8g
c29tZSAKPiBzbWFsbCB0d2Vha3M6CgpOb3RoaW5nIHNlZW1lZCB0byBiZSByZXF1aXJlZC4KLUNo
cmlzCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVs
LWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczov
L2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

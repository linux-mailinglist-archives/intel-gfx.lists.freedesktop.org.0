Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 0E35A3B8CC9
	for <lists+intel-gfx@lfdr.de>; Thu,  1 Jul 2021 06:06:56 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 250026E9BC;
	Thu,  1 Jul 2021 04:06:52 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga02.intel.com (mga02.intel.com [134.134.136.20])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 88C1B6E9AA
 for <intel-gfx@lists.freedesktop.org>; Thu,  1 Jul 2021 04:06:50 +0000 (UTC)
X-IronPort-AV: E=McAfee;i="6200,9189,10031"; a="195626949"
X-IronPort-AV: E=Sophos;i="5.83,313,1616482800"; d="scan'208";a="195626949"
Received: from fmsmga002.fm.intel.com ([10.253.24.26])
 by orsmga101.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 30 Jun 2021 21:06:45 -0700
X-IronPort-AV: E=Sophos;i="5.83,313,1616482800"; d="scan'208";a="493371304"
Received: from lucas-s2600cw.jf.intel.com ([10.165.21.202])
 by fmsmga002-auth.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 30 Jun 2021 21:06:45 -0700
From: Lucas De Marchi <lucas.demarchi@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 30 Jun 2021 21:06:23 -0700
Message-Id: <20210701040623.1675928-2-lucas.demarchi@intel.com>
X-Mailer: git-send-email 2.31.1
In-Reply-To: <20210701040623.1675928-1-lucas.demarchi@intel.com>
References: <20210701040623.1675928-1-lucas.demarchi@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 1/1] drm/i915/dg1: Compute MEM Bandwidth using
 MCHBAR
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Jani Nikula <jani.nikula@intel.com>, Matthew Auld <matthew.auld@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogQ2xpbnQgVGF5bG9yIDxjbGludG9uLmEudGF5bG9yQGludGVsLmNvbT4KClRoZSBQVU5J
VCBGVyBpcyBjdXJyZW50bHkgcmV0dXJuaW5nIDAgZm9yIGFsbCBtZW1vcnkgYmFuZHdpZHRoCnBh
cmFtZXRlcnMuIFJlYWQgdGhlIHZhbHVlcyBkaXJlY3RseSBmcm9tIE1DSEJBUiBvZmZzZXRzIDB4
NTkxOCBhbmQKMHg0MDAwKDQpLgoKdjIgKEx1Y2FzKTogdGlkeSB1cCBjaGVja2luZyBmb3IgcmV0
IHNsaWdodGx5CnYzIChMdWNhcyk6CiAgLSBTcXVhc2ggY2hhbmdlIHRvIGRvdWJsZSB0aGUgbWVt
b3J5IGJhbmR3aWR0aCBiYXNlZCBvbgogICAgTUNIQkFSIEdlYXJfdHlwZQogIC0gTW92ZSBJQ0xf
R0VBUl9UWVBFX01BU0sgdG8gdGhlIGFwcHJvcHJpYXRlIHBsYWNlIGFuZCBjaGFuZ2UgcHJlZml4
CiAgICB0byBERzEKICAtIE1vdmUgcmVnaXN0ZXIgZGVmaW5pdGlvbnMgdG8gaTkxNV9yZWcuaAog
IC0gTWFrZSB0aGUgTUNIQkFSIHBhdGggcGVybWFuZW50IGZvciBERzEKICAtIENvbnZlcnQgdG8g
UkVHX0JJVCgpL1JFR19HRU5NQVNLKCkKCkNjOiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmph
bGFAbGludXguaW50ZWwuY29tPgpDYzogTWF0dCBSb3BlciA8bWF0dGhldy5kLnJvcGVyQGludGVs
LmNvbT4KQ2M6IEphbmkgU2FhcmluZW4gPGphbmkuc2FhcmluZW5AaW50ZWwuY29tPgpTaWduZWQt
b2ZmLWJ5OiBDbGludCBUYXlsb3IgPGNsaW50b24uYS50YXlsb3JAaW50ZWwuY29tPgpTaWduZWQt
b2ZmLWJ5OiBKYW5pIE5pa3VsYSA8amFuaS5uaWt1bGFAaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5
OiBNYXR0aGV3IEF1bGQgPG1hdHRoZXcuYXVsZEBpbnRlbC5jb20+ClJldmlld2VkLWJ5OiBMdWNh
cyBEZSBNYXJjaGkgPGx1Y2FzLmRlbWFyY2hpQGludGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogTHVj
YXMgRGUgTWFyY2hpIDxsdWNhcy5kZW1hcmNoaUBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9idy5jIHwgNDEgKysrKysrKysrKysrKysrKysrKysrKysr
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaCAgICAgICAgIHwgMTIgKysrKysrKysK
IDIgZmlsZXMgY2hhbmdlZCwgNTIgaW5zZXJ0aW9ucygrKSwgMSBkZWxldGlvbigtKQoKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYncuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYncuYwppbmRleCBiZmIzOThmMDQzMmUuLmM5MTNj
MjE1MTY4MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9i
dy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYncuYwpAQCAtMjMs
NiArMjMsNDEgQEAgc3RydWN0IGludGVsX3Fndl9pbmZvIHsKIAl1OCB0X2JsOwogfTsKIAorc3Rh
dGljIGludCBkZzFfbWNoYmFyX3JlYWRfcWd2X3BvaW50X2luZm8oc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2LAorCQkJCQkgIHN0cnVjdCBpbnRlbF9xZ3ZfcG9pbnQgKnNwLAorCQkJ
CQkgIGludCBwb2ludCkKK3sKKwl1MzIgZGNsa19yYXRpbyA9IDAsIGRjbGtfcmVmZXJlbmNlID0g
MDsKKwl1MzIgdmFsID0gMDsKKworCXZhbCA9IGludGVsX3VuY29yZV9yZWFkKCZkZXZfcHJpdi0+
dW5jb3JlLCBTQV9QRVJGX1NUQVRVU18wXzBfMF9NQ0hCQVJfUEMpOworCWRjbGtfcmF0aW8gPSBS
RUdfRklFTERfR0VUKERHMV9RQ0xLX1JBVElPX01BU0ssIHZhbCk7CisJaWYgKHZhbCAmIERHMV9R
Q0xLX1JFRkVSRU5DRSkKKwkJZGNsa19yZWZlcmVuY2UgPSA2OyAvKiA2ICogMTYuNjY2IE1IeiA9
IDEwMCBNSHogKi8KKwllbHNlCisJCWRjbGtfcmVmZXJlbmNlID0gODsgLyogOCAqIDE2LjY2NiBN
SHogPSAxMzMgTUh6ICovCisJc3AtPmRjbGsgPSBkY2xrX3JhdGlvICogZGNsa19yZWZlcmVuY2U7
CisKKwl2YWwgPSBpbnRlbF91bmNvcmVfcmVhZCgmZGV2X3ByaXYtPnVuY29yZSwgU0tMX01DX0JJ
T1NfREFUQV8wXzBfMF9NQ0hCQVJfUENVKTsKKwlpZiAodmFsICYgREcxX0dFQVJfVFlQRSkKKwkJ
c3AtPmRjbGsgKj0gMjsKKworCWlmIChzcC0+ZGNsayA9PSAwKQorCQlyZXR1cm4gLUVJTlZBTDsK
KworCXZhbCA9IGludGVsX3VuY29yZV9yZWFkKCZkZXZfcHJpdi0+dW5jb3JlLCBNQ0hCQVJfQ0gw
X0NSX1RDX1BSRV8wXzBfMF9NQ0hCQVIpOworCXNwLT50X3JwID0gUkVHX0ZJRUxEX0dFVChERzFf
RFJBTV9UX1JQX01BU0ssIHZhbCk7CisJc3AtPnRfcmRwcmUgPSBSRUdfRklFTERfR0VUKERHMV9E
UkFNX1RfUkRQUkVfTUFTSywgdmFsKTsKKworCXZhbCA9IGludGVsX3VuY29yZV9yZWFkKCZkZXZf
cHJpdi0+dW5jb3JlLCBNQ0hCQVJfQ0gwX0NSX1RDX1BSRV8wXzBfMF9NQ0hCQVJfSElHSCk7CisJ
c3AtPnRfcmNkID0gUkVHX0ZJRUxEX0dFVChERzFfRFJBTV9UX1JDRF9NQVNLLCB2YWwpOworCXNw
LT50X3JhcyA9IFJFR19GSUVMRF9HRVQoREcxX0RSQU1fVF9SQVNfTUFTSywgdmFsKTsKKworCXNw
LT50X3JjID0gc3AtPnRfcnAgKyBzcC0+dF9yYXM7CisKKwlyZXR1cm4gMDsKK30KKwogc3RhdGlj
IGludCBpY2xfcGNvZGVfcmVhZF9xZ3ZfcG9pbnRfaW5mbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCiAJCQkJCSBzdHJ1Y3QgaW50ZWxfcWd2X3BvaW50ICpzcCwKIAkJCQkJIGlu
dCBwb2ludCkKQEAgLTk5LDcgKzEzNCwxMSBAQCBzdGF0aWMgaW50IGljbF9nZXRfcWd2X3BvaW50
cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJZm9yIChpID0gMDsgaSA8IHFp
LT5udW1fcG9pbnRzOyBpKyspIHsKIAkJc3RydWN0IGludGVsX3Fndl9wb2ludCAqc3AgPSAmcWkt
PnBvaW50c1tpXTsKIAotCQlyZXQgPSBpY2xfcGNvZGVfcmVhZF9xZ3ZfcG9pbnRfaW5mbyhkZXZf
cHJpdiwgc3AsIGkpOworCQlpZiAoSVNfREcxKGRldl9wcml2KSkKKwkJCXJldCA9IGRnMV9tY2hi
YXJfcmVhZF9xZ3ZfcG9pbnRfaW5mbyhkZXZfcHJpdiwgc3AsIGkpOworCQllbHNlCisJCQlyZXQg
PSBpY2xfcGNvZGVfcmVhZF9xZ3ZfcG9pbnRfaW5mbyhkZXZfcHJpdiwgc3AsIGkpOworCiAJCWlm
IChyZXQpCiAJCQlyZXR1cm4gcmV0OwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3JlZy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaAppbmRleCA2NWMx
NTViMTQxODkuLjE4MjE5MGRhMzAzNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9yZWcuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oCkBAIC0xMTA2
Myw2ICsxMTA2Myw3IEBAIGVudW0gc2tsX3Bvd2VyX2dhdGUgewogI2RlZmluZSBTS0xfTUVNT1JZ
X0ZSRVFfTVVMVElQTElFUl9IWgkJMjY2NjY2NjY2CiAjZGVmaW5lIFNLTF9NQ19CSU9TX0RBVEFf
MF8wXzBfTUNIQkFSX1BDVQlfTU1JTyhNQ0hCQVJfTUlSUk9SX0JBU0VfU05CICsgMHg1RTA0KQog
I2RlZmluZSAgU0tMX1JFUV9EQVRBX01BU0sJCQkoMHhGIDw8IDApCisjZGVmaW5lICBERzFfR0VB
Ul9UWVBFCQkJCVJFR19CSVQoMTYpCiAKICNkZWZpbmUgU0tMX01BRF9JTlRFUl9DSEFOTkVMXzBf
MF8wX01DSEJBUl9NQ01BSU4gX01NSU8oTUNIQkFSX01JUlJPUl9CQVNFX1NOQiArIDB4NTAwMCkK
ICNkZWZpbmUgIFNLTF9EUkFNX0REUl9UWVBFX01BU0sJCQkoMHgzIDw8IDApCkBAIC0xMTA5OCw2
ICsxMTA5OSwxNyBAQCBlbnVtIHNrbF9wb3dlcl9nYXRlIHsKICNkZWZpbmUgIENOTF9EUkFNX1JB
TktfMwkJCSgweDIgPDwgOSkKICNkZWZpbmUgIENOTF9EUkFNX1JBTktfNAkJCSgweDMgPDwgOSkK
IAorI2RlZmluZSBTQV9QRVJGX1NUQVRVU18wXzBfMF9NQ0hCQVJfUEMJCV9NTUlPKE1DSEJBUl9N
SVJST1JfQkFTRV9TTkIgKyAweDU5MTgpCisjZGVmaW5lICBERzFfUUNMS19SQVRJT19NQVNLCQkJ
UkVHX0dFTk1BU0soOSwgMikKKyNkZWZpbmUgIERHMV9RQ0xLX1JFRkVSRU5DRQkJCVJFR19CSVQo
MTApCisKKyNkZWZpbmUgTUNIQkFSX0NIMF9DUl9UQ19QUkVfMF8wXzBfTUNIQkFSCV9NTUlPKE1D
SEJBUl9NSVJST1JfQkFTRV9TTkIgKyAweDQwMDApCisjZGVmaW5lICAgREcxX0RSQU1fVF9SRFBS
RV9NQVNLCQkJUkVHX0dFTk1BU0soMTYsIDExKQorI2RlZmluZSAgIERHMV9EUkFNX1RfUlBfTUFT
SwkJCVJFR19HRU5NQVNLKDYsIDApCisjZGVmaW5lIE1DSEJBUl9DSDBfQ1JfVENfUFJFXzBfMF8w
X01DSEJBUl9ISUdICV9NTUlPKE1DSEJBUl9NSVJST1JfQkFTRV9TTkIgKyAweDQwMDQpCisjZGVm
aW5lICAgREcxX0RSQU1fVF9SQ0RfTUFTSwkJCVJFR19HRU5NQVNLKDE1LCA5KQorI2RlZmluZSAg
IERHMV9EUkFNX1RfUkFTX01BU0sJCQlSRUdfR0VOTUFTSyg4LCAxKQorCiAvKgogICogUGxlYXNl
IHNlZSBoc3dfcmVhZF9kY29tcCgpIGFuZCBoc3dfd3JpdGVfZGNvbXAoKSBiZWZvcmUgdXNpbmcg
dGhpcyByZWdpc3RlciwKICAqIHNpbmNlIG9uIEhTVyB3ZSBjYW4ndCB3cml0ZSB0byBpdCB1c2lu
ZyBpbnRlbF91bmNvcmVfd3JpdGUuCi0tIAoyLjMxLjEKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

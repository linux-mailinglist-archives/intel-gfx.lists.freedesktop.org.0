Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 137C950615
	for <lists+intel-gfx@lfdr.de>; Mon, 24 Jun 2019 11:47:45 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id F23EE89A0E;
	Mon, 24 Jun 2019 09:47:42 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6AE2789A0E
 for <intel-gfx@lists.freedesktop.org>; Mon, 24 Jun 2019 09:47:41 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17003000-1500050 
 for multiple; Mon, 24 Jun 2019 10:47:38 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 24 Jun 2019 10:47:30 +0100
Message-Id: <20190624094730.25119-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190624090214.2888-1-chris@chris-wilson.co.uk>
References: <20190624090214.2888-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v5] drm/i915/execlists: Disable preemption under
 GVT
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UHJlZW1wdC10by1idXN5IHVzZXMgYSBHUFUgc2VtYXBob3JlIHRvIGVuZm9yY2UgYW4gaWRsZS1i
YXJyaWVyIGFjcm9zcwpwcmVlbXB0aW9uLCBidXQgbWVkaWF0ZWQgZ3Z0IGRvZXMgbm90IGZ1bGx5
IHN1cHBvcnQgc2VtYXBob3Jlcy4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNA
Y2hyaXMtd2lsc29uLmNvLnVrPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Vu
Z2luZV9jcy5jIHwgIDQgKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMg
ICAgICAgfCAyMSArKysrKysrKysrKysrKysrLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3NlbGZ0ZXN0X2xyYy5jICAgIHwgIDMgKysrCiAzIGZpbGVzIGNoYW5nZWQsIDIxIGluc2VydGlv
bnMoKyksIDcgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZW5naW5lX2NzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdp
bmVfY3MuYwppbmRleCA0OTYxZjc0ZmQ5MDIuLmQ2ZmJjNDc3MjdjMSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKQEAgLTgzMCw2ICs4MzAsOCBAQCBpbnQgaW50
ZWxfZW5naW5lX2luaXRfY29tbW9uKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGVuZ2luZS0+aTkxNTsKIAlpbnQgcmV0Owog
CisJZW5naW5lLT5zZXRfZGVmYXVsdF9zdWJtaXNzaW9uKGVuZ2luZSk7CisKIAkvKiBXZSBtYXkg
bmVlZCB0byBkbyB0aGluZ3Mgd2l0aCB0aGUgc2hyaW5rZXIgd2hpY2gKIAkgKiByZXF1aXJlIHVz
IHRvIGltbWVkaWF0ZWx5IHN3aXRjaCBiYWNrIHRvIHRoZSBkZWZhdWx0CiAJICogY29udGV4dC4g
VGhpcyBjYW4gY2F1c2UgYSBwcm9ibGVtIGFzIHBpbm5pbmcgdGhlCkBAIC04NTcsOCArODU5LDYg
QEAgaW50IGludGVsX2VuZ2luZV9pbml0X2NvbW1vbihzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpl
bmdpbmUpCiAKIAllbmdpbmUtPmVtaXRfZmluaV9icmVhZGNydW1iX2R3ID0gcmV0OwogCi0JZW5n
aW5lLT5zZXRfZGVmYXVsdF9zdWJtaXNzaW9uKGVuZ2luZSk7Ci0KIAlyZXR1cm4gMDsKIAogZXJy
X3VucGluOgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYwppbmRleCBjOGEwYzliMzI3NjQu
LjgwMTdlZmIzNmY3YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
bHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKQEAgLTI5NCw2
ICsyOTQsOSBAQCBzdGF0aWMgaW5saW5lIGJvb2wgbmVlZF9wcmVlbXB0KGNvbnN0IHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIHsKIAlpbnQgbGFzdF9wcmlvOwogCisJaWYgKCFpbnRl
bF9lbmdpbmVfaGFzX3ByZWVtcHRpb24oZW5naW5lKSkKKwkJcmV0dXJuIGZhbHNlOworCiAJLyoK
IAkgKiBDaGVjayBpZiB0aGUgY3VycmVudCBwcmlvcml0eSBoaW50IG1lcml0cyBhIHByZWVtcHRp
b24gYXR0ZW1wdC4KIAkgKgpAQCAtODkwLDYgKzg5Myw5IEBAIG5lZWRfdGltZXNsaWNlKHN0cnVj
dCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgY29uc3Qgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEp
CiB7CiAJaW50IGhpbnQ7CiAKKwlpZiAoIWludGVsX2VuZ2luZV9oYXNfcHJlZW1wdGlvbihlbmdp
bmUpKQorCQlyZXR1cm4gZmFsc2U7CisKIAlpZiAobGlzdF9pc19sYXN0KCZycS0+c2NoZWQubGlu
aywgJmVuZ2luZS0+YWN0aXZlLnJlcXVlc3RzKSkKIAkJcmV0dXJuIGZhbHNlOwogCkBAIC0yNjAw
LDcgKzI2MDYsOCBAQCBzdGF0aWMgdTMyICpnZW44X2VtaXRfZmluaV9icmVhZGNydW1iKHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QsIHUzMiAqY3MpCiAJKmNzKysgPSBNSV9VU0VSX0lOVEVS
UlVQVDsKIAogCSpjcysrID0gTUlfQVJCX09OX09GRiB8IE1JX0FSQl9FTkFCTEU7Ci0JY3MgPSBl
bWl0X3ByZWVtcHRfYnVzeXdhaXQocmVxdWVzdCwgY3MpOworCWlmIChpbnRlbF9lbmdpbmVfaGFz
X3ByZWVtcHRpb24ocmVxdWVzdC0+ZW5naW5lKSkKKwkJY3MgPSBlbWl0X3ByZWVtcHRfYnVzeXdh
aXQocmVxdWVzdCwgY3MpOwogCiAJcmVxdWVzdC0+dGFpbCA9IGludGVsX3Jpbmdfb2Zmc2V0KHJl
cXVlc3QsIGNzKTsKIAlhc3NlcnRfcmluZ190YWlsX3ZhbGlkKHJlcXVlc3QtPnJpbmcsIHJlcXVl
c3QtPnRhaWwpOwpAQCAtMjYyNCw3ICsyNjMxLDggQEAgc3RhdGljIHUzMiAqZ2VuOF9lbWl0X2Zp
bmlfYnJlYWRjcnVtYl9yY3Moc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdCwgdTMyICpjcykK
IAkqY3MrKyA9IE1JX1VTRVJfSU5URVJSVVBUOwogCiAJKmNzKysgPSBNSV9BUkJfT05fT0ZGIHwg
TUlfQVJCX0VOQUJMRTsKLQljcyA9IGVtaXRfcHJlZW1wdF9idXN5d2FpdChyZXF1ZXN0LCBjcyk7
CisJaWYgKGludGVsX2VuZ2luZV9oYXNfcHJlZW1wdGlvbihyZXF1ZXN0LT5lbmdpbmUpKQorCQlj
cyA9IGVtaXRfcHJlZW1wdF9idXN5d2FpdChyZXF1ZXN0LCBjcyk7CiAKIAlyZXF1ZXN0LT50YWls
ID0gaW50ZWxfcmluZ19vZmZzZXQocmVxdWVzdCwgY3MpOwogCWFzc2VydF9yaW5nX3RhaWxfdmFs
aWQocmVxdWVzdC0+cmluZywgcmVxdWVzdC0+dGFpbCk7CkBAIC0yNjcyLDEwICsyNjgwLDExIEBA
IHZvaWQgaW50ZWxfZXhlY2xpc3RzX3NldF9kZWZhdWx0X3N1Ym1pc3Npb24oc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lKQogCWVuZ2luZS0+dW5wYXJrID0gTlVMTDsKIAogCWVuZ2luZS0+
ZmxhZ3MgfD0gSTkxNV9FTkdJTkVfU1VQUE9SVFNfU1RBVFM7Ci0JaWYgKCFpbnRlbF92Z3B1X2Fj
dGl2ZShlbmdpbmUtPmk5MTUpKQorCWlmICghaW50ZWxfdmdwdV9hY3RpdmUoZW5naW5lLT5pOTE1
KSkgewogCQllbmdpbmUtPmZsYWdzIHw9IEk5MTVfRU5HSU5FX0hBU19TRU1BUEhPUkVTOwotCWlm
IChIQVNfTE9HSUNBTF9SSU5HX1BSRUVNUFRJT04oZW5naW5lLT5pOTE1KSkKLQkJZW5naW5lLT5m
bGFncyB8PSBJOTE1X0VOR0lORV9IQVNfUFJFRU1QVElPTjsKKwkJaWYgKEhBU19MT0dJQ0FMX1JJ
TkdfUFJFRU1QVElPTihlbmdpbmUtPmk5MTUpKQorCQkJZW5naW5lLT5mbGFncyB8PSBJOTE1X0VO
R0lORV9IQVNfUFJFRU1QVElPTjsKKwl9CiB9CiAKIHN0YXRpYyB2b2lkIGV4ZWNsaXN0c19kZXN0
cm95KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKQEAgLTM0NjMsNiArMzQ3Miw4IEBA
IGludGVsX2V4ZWNsaXN0c19jcmVhdGVfdmlydHVhbChzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAq
Y3R4LAogCQl2ZS0+YmFzZS5lbWl0X2ZpbmlfYnJlYWRjcnVtYiA9IHNpYmxpbmctPmVtaXRfZmlu
aV9icmVhZGNydW1iOwogCQl2ZS0+YmFzZS5lbWl0X2ZpbmlfYnJlYWRjcnVtYl9kdyA9CiAJCQlz
aWJsaW5nLT5lbWl0X2ZpbmlfYnJlYWRjcnVtYl9kdzsKKworCQl2ZS0+YmFzZS5mbGFncyA9IHNp
YmxpbmctPmZsYWdzOwogCX0KIAogCXJldHVybiAmdmUtPmNvbnRleHQ7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCmluZGV4IDBjOTdmOTUzZTkwOC4uYjk5YjU4OWE2YzgxIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwpAQCAtMjcwLDYgKzI3MCw5IEBA
IHN0YXRpYyBpbnQgbGl2ZV90aW1lc2xpY2VfcHJlZW1wdCh2b2lkICphcmcpCiAJCWVudW0gaW50
ZWxfZW5naW5lX2lkIGlkOwogCiAJCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7
CisJCQlpZiAoIWludGVsX2VuZ2luZV9oYXNfcHJlZW1wdGlvbihlbmdpbmUpKQorCQkJCWNvbnRp
bnVlOworCiAJCQltZW1zZXQodmFkZHIsIDAsIFBBR0VfU0laRSk7CiAKIAkJCWVyciA9IHNsaWNl
X3NlbWFwaG9yZV9xdWV1ZShlbmdpbmUsIHZtYSwgY291bnQpOwotLSAKMi4yMC4xCgpfX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGlu
ZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVl
ZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 7FFBBD6AA1
	for <lists+intel-gfx@lfdr.de>; Mon, 14 Oct 2019 22:14:18 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C31506E526;
	Mon, 14 Oct 2019 20:14:16 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8C13B6E528
 for <intel-gfx@lists.freedesktop.org>; Mon, 14 Oct 2019 20:14:09 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18836950-1500050 
 for <intel-gfx@lists.freedesktop.org>; Mon, 14 Oct 2019 21:14:05 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 14 Oct 2019 21:14:02 +0100
Message-Id: <20191014201404.22468-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191014201404.22468-1-chris@chris-wilson.co.uk>
References: <20191014201404.22468-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 2/4] drm/i915: add support for perf configuration
 queries
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwuY29tPgoK
TGlzdGluZyBjb25maWd1cmF0aW9ucyBhdCB0aGUgbW9tZW50IGlzIHN1cHBvcnRlZCBvbmx5IHRo
cm91Z2ggc3lzZnMuClRoaXMgbWlnaHQgY2F1c2UgaXNzdWVzIGZvciBhcHBsaWNhdGlvbnMgd2Fu
dGluZyB0byBsaXN0CmNvbmZpZ3VyYXRpb25zIGZyb20gYSBjb250YWluZXIgd2hlcmUgc3lzZnMg
aXNuJ3QgYXZhaWxhYmxlLgoKVGhpcyBjaGFuZ2UgYWRkcyBhIHdheSB0byBxdWVyeSB0aGUgbnVt
YmVyIG9mIGNvbmZpZ3VyYXRpb25zIGFuZCB0aGVpcgpjb250ZW50IHRocm91Z2ggdGhlIGk5MTUg
cXVlcnkgdUFQSS4KCnYyOiBGaXggc3BhcnNlIHdhcm5pbmdzIChMaW9uZWwpCiAgICBBZGQgc3Vw
cG9ydCB0byBxdWVyeSBjb25maWd1cmF0aW9uIHVzaW5nIHV1aWQgKExpb25lbCkKCnYzOiBGaXgg
c29tZSBpbmNvbnNpc3RlbmN5IGluIHVhcGkgaGVhZGVyIChMaW9uZWwpCiAgICBGaXggdW5sb2Nr
aW5nIHdoZW4gbm90IGxvY2tlZCBpc3N1ZSAoTGlvbmVsKQogICAgQWRkIGRlYnVnIG1lc3NhZ2Vz
IChMaW9uZWwpCgp2NDogRml4IG1pc3NpbmcgdW5sb2NrIChEYW4pCgp2NTogRHJvcCBsb2NrIHdo
ZW4gY29weWluZyBjb25maWcgY29udGVudCB0byB1c2Vyc3BhY2UgKENocmlzKQoKdjY6IERyb3Ag
bG9jayB3aGVuIGNvcHlpbmcgY29uZmlnIGxpc3QgdG8gdXNlcnNwYWNlIChDaHJpcykKICAgIEZp
eCBkZWFkbG9jayB3aGVuIGNhbGxpbmcgaTkxNV9wZXJmX2dldF9vYV9jb25maWcoKSB1bmRlcgog
ICAgcGVyZi5tZXRyaWNzX2xvY2sgKExpb25lbCkKICAgIEFkZCBpOTE1X29hX2NvbmZpZ19nZXQo
KSAoQ2hyaXMpCgpMaW5rOiBodHRwczovL2dpdGxhYi5mcmVlZGVza3RvcC5vcmcvbWVzYS9tZXNh
L21lcmdlX3JlcXVlc3RzLzkzMgpTaWduZWQtb2ZmLWJ5OiBMaW9uZWwgTGFuZHdlcmxpbiA8bGlv
bmVsLmcubGFuZHdlcmxpbkBpbnRlbC5jb20+ClJldmlld2VkLWJ5OiBDaHJpcyBXaWxzb24gPGNo
cmlzQGNocmlzLXdpbHNvbi5jby51az4KU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJp
c0BjaHJpcy13aWxzb24uY28udWs+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJm
LmMgIHwgICAzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3F1ZXJ5LmMgfCAyOTYgKysr
KysrKysrKysrKysrKysrKysrKysrKysrKysrCiBpbmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJtLmgg
ICAgICAgfCAgNjIgKysrKysrLQogMyBmaWxlcyBjaGFuZ2VkLCAzNTggaW5zZXJ0aW9ucygrKSwg
MyBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Bl
cmYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCmluZGV4IDIyMGUzMzg0YWYz
MC4uMTA5NzgyZWEzMGFkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Bl
cmYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYwpAQCAtMzgwNiw4ICsz
ODA2LDcgQEAgaW50IGk5MTVfcGVyZl9yZW1vdmVfY29uZmlnX2lvY3RsKHN0cnVjdCBkcm1fZGV2
aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAKIAlHRU1fQlVHX09OKCphcmcgIT0gb2FfY29uZmlnLT5p
ZCk7CiAKLQlzeXNmc19yZW1vdmVfZ3JvdXAocGVyZi0+bWV0cmljc19rb2JqLAotCQkJICAgJm9h
X2NvbmZpZy0+c3lzZnNfbWV0cmljKTsKKwlzeXNmc19yZW1vdmVfZ3JvdXAocGVyZi0+bWV0cmlj
c19rb2JqLCAmb2FfY29uZmlnLT5zeXNmc19tZXRyaWMpOwogCiAJaWRyX3JlbW92ZSgmcGVyZi0+
bWV0cmljc19pZHIsICphcmcpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3F1ZXJ5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3F1ZXJ5LmMKaW5kZXggYWJh
YzUwNDJkYTJiLi5jMjdjZmVmOTI4MWMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfcXVlcnkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3F1ZXJ5LmMKQEAg
LTcsNiArNyw3IEBACiAjaW5jbHVkZSA8bGludXgvbm9zcGVjLmg+CiAKICNpbmNsdWRlICJpOTE1
X2Rydi5oIgorI2luY2x1ZGUgImk5MTVfcGVyZi5oIgogI2luY2x1ZGUgImk5MTVfcXVlcnkuaCIK
ICNpbmNsdWRlIDx1YXBpL2RybS9pOTE1X2RybS5oPgogCkBAIC0xNDAsMTAgKzE0MSwzMDUgQEAg
cXVlcnlfZW5naW5lX2luZm8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJcmV0dXJu
IGxlbjsKIH0KIAorc3RhdGljIGludCBjYW5fY29weV9wZXJmX2NvbmZpZ19yZWdpc3RlcnNfb3Jf
bnVtYmVyKHUzMiB1c2VyX25fcmVncywKKwkJCQkJCSAgICB1NjQgdXNlcl9yZWdzX3B0ciwKKwkJ
CQkJCSAgICB1MzIga2VybmVsX25fcmVncykKK3sKKwkvKgorCSAqIFdlJ2xsIGp1c3QgcHV0IHRo
ZSBudW1iZXIgb2YgcmVnaXN0ZXJzLCBhbmQgd29uJ3QgY29weSB0aGUKKwkgKiByZWdpc3Rlci4K
KwkgKi8KKwlpZiAodXNlcl9uX3JlZ3MgPT0gMCkKKwkJcmV0dXJuIDA7CisKKwlpZiAodXNlcl9u
X3JlZ3MgPCBrZXJuZWxfbl9yZWdzKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWlmICghYWNjZXNz
X29rKHU2NF90b191c2VyX3B0cih1c2VyX3JlZ3NfcHRyKSwKKwkJICAgICAgIDIgKiBzaXplb2Yo
dTMyKSAqIGtlcm5lbF9uX3JlZ3MpKQorCQlyZXR1cm4gLUVGQVVMVDsKKworCXJldHVybiAwOwor
fQorCitzdGF0aWMgaW50IGNvcHlfcGVyZl9jb25maWdfcmVnaXN0ZXJzX29yX251bWJlcihjb25z
dCBzdHJ1Y3QgaTkxNV9vYV9yZWcgKmtlcm5lbF9yZWdzLAorCQkJCQkJdTMyIGtlcm5lbF9uX3Jl
Z3MsCisJCQkJCQl1NjQgdXNlcl9yZWdzX3B0ciwKKwkJCQkJCXUzMiAqdXNlcl9uX3JlZ3MpCit7
CisJdTMyIHI7CisKKwlpZiAoKnVzZXJfbl9yZWdzID09IDApIHsKKwkJKnVzZXJfbl9yZWdzID0g
a2VybmVsX25fcmVnczsKKwkJcmV0dXJuIDA7CisJfQorCisJKnVzZXJfbl9yZWdzID0ga2VybmVs
X25fcmVnczsKKworCWZvciAociA9IDA7IHIgPCBrZXJuZWxfbl9yZWdzOyByKyspIHsKKwkJdTMy
IF9fdXNlciAqdXNlcl9yZWdfcHRyID0KKwkJCXU2NF90b191c2VyX3B0cih1c2VyX3JlZ3NfcHRy
ICsgc2l6ZW9mKHUzMikgKiByICogMik7CisJCXUzMiBfX3VzZXIgKnVzZXJfdmFsX3B0ciA9CisJ
CQl1NjRfdG9fdXNlcl9wdHIodXNlcl9yZWdzX3B0ciArIHNpemVvZih1MzIpICogciAqIDIgKwor
CQkJCQlzaXplb2YodTMyKSk7CisJCWludCByZXQ7CisKKwkJcmV0ID0gX19wdXRfdXNlcihpOTE1
X21taW9fcmVnX29mZnNldChrZXJuZWxfcmVnc1tyXS5hZGRyKSwKKwkJCQkgdXNlcl9yZWdfcHRy
KTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiAtRUZBVUxUOworCisJCXJldCA9IF9fcHV0X3VzZXIo
a2VybmVsX3JlZ3Nbcl0udmFsdWUsIHVzZXJfdmFsX3B0cik7CisJCWlmIChyZXQpCisJCQlyZXR1
cm4gLUVGQVVMVDsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBxdWVyeV9wZXJm
X2NvbmZpZ19kYXRhKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAorCQkJCSAgc3RydWN0
IGRybV9pOTE1X3F1ZXJ5X2l0ZW0gKnF1ZXJ5X2l0ZW0sCisJCQkJICBib29sIHVzZV91dWlkKQor
eworCXN0cnVjdCBkcm1faTkxNV9xdWVyeV9wZXJmX2NvbmZpZyBfX3VzZXIgKnVzZXJfcXVlcnlf
Y29uZmlnX3B0ciA9CisJCXU2NF90b191c2VyX3B0cihxdWVyeV9pdGVtLT5kYXRhX3B0cik7CisJ
c3RydWN0IGRybV9pOTE1X3BlcmZfb2FfY29uZmlnIF9fdXNlciAqdXNlcl9jb25maWdfcHRyID0K
KwkJdTY0X3RvX3VzZXJfcHRyKHF1ZXJ5X2l0ZW0tPmRhdGFfcHRyICsKKwkJCQlzaXplb2Yoc3Ry
dWN0IGRybV9pOTE1X3F1ZXJ5X3BlcmZfY29uZmlnKSk7CisJc3RydWN0IGRybV9pOTE1X3BlcmZf
b2FfY29uZmlnIHVzZXJfY29uZmlnOworCXN0cnVjdCBpOTE1X3BlcmYgKnBlcmYgPSAmaTkxNS0+
cGVyZjsKKwlzdHJ1Y3QgaTkxNV9vYV9jb25maWcgKm9hX2NvbmZpZzsKKwljaGFyIHV1aWRbVVVJ
RF9TVFJJTkdfTEVOICsgMV07CisJdTY0IGNvbmZpZ19pZDsKKwl1MzIgZmxhZ3MsIHRvdGFsX3Np
emU7CisJaW50IHJldDsKKworCWlmICghcGVyZi0+aTkxNSkKKwkJcmV0dXJuIC1FTk9ERVY7CisK
Kwl0b3RhbF9zaXplID0KKwkJc2l6ZW9mKHN0cnVjdCBkcm1faTkxNV9xdWVyeV9wZXJmX2NvbmZp
ZykgKworCQlzaXplb2Yoc3RydWN0IGRybV9pOTE1X3BlcmZfb2FfY29uZmlnKTsKKworCWlmIChx
dWVyeV9pdGVtLT5sZW5ndGggPT0gMCkKKwkJcmV0dXJuIHRvdGFsX3NpemU7CisKKwlpZiAocXVl
cnlfaXRlbS0+bGVuZ3RoIDwgdG90YWxfc2l6ZSkgeworCQlEUk1fREVCVUcoIkludmFsaWQgcXVl
cnkgY29uZmlnIGRhdGEgaXRlbSBzaXplPSV1IGV4cGVjdGVkPSV1XG4iLAorCQkJICBxdWVyeV9p
dGVtLT5sZW5ndGgsIHRvdGFsX3NpemUpOworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlpZiAo
IWFjY2Vzc19vayh1c2VyX3F1ZXJ5X2NvbmZpZ19wdHIsIHRvdGFsX3NpemUpKQorCQlyZXR1cm4g
LUVGQVVMVDsKKworCWlmIChfX2dldF91c2VyKGZsYWdzLCAmdXNlcl9xdWVyeV9jb25maWdfcHRy
LT5mbGFncykpCisJCXJldHVybiAtRUZBVUxUOworCisJaWYgKGZsYWdzICE9IDApCisJCXJldHVy
biAtRUlOVkFMOworCisJaWYgKHVzZV91dWlkKSB7CisJCXN0cnVjdCBpOTE1X29hX2NvbmZpZyAq
dG1wOworCQlpbnQgaWQ7CisKKwkJQlVJTERfQlVHX09OKHNpemVvZih1c2VyX3F1ZXJ5X2NvbmZp
Z19wdHItPnV1aWQpID49IHNpemVvZih1dWlkKSk7CisKKwkJbWVtc2V0KCZ1dWlkLCAwLCBzaXpl
b2YodXVpZCkpOworCQlpZiAoX19jb3B5X2Zyb21fdXNlcih1dWlkLCB1c2VyX3F1ZXJ5X2NvbmZp
Z19wdHItPnV1aWQsCisJCQkJICAgICBzaXplb2YodXNlcl9xdWVyeV9jb25maWdfcHRyLT51dWlk
KSkpCisJCQlyZXR1cm4gLUVGQVVMVDsKKworCQlvYV9jb25maWcgPSBOVUxMOworCQlyY3VfcmVh
ZF9sb2NrKCk7CisJCWlkcl9mb3JfZWFjaF9lbnRyeSgmcGVyZi0+bWV0cmljc19pZHIsIHRtcCwg
aWQpIHsKKwkJCWlmICghc3RyY21wKHRtcC0+dXVpZCwgdXVpZCkpIHsKKwkJCQlvYV9jb25maWcg
PSBpOTE1X29hX2NvbmZpZ19nZXQodG1wKTsKKwkJCQlicmVhazsKKwkJCX0KKwkJfQorCQlyY3Vf
cmVhZF91bmxvY2soKTsKKwl9IGVsc2UgeworCQlpZiAoX19nZXRfdXNlcihjb25maWdfaWQsICZ1
c2VyX3F1ZXJ5X2NvbmZpZ19wdHItPmNvbmZpZykpCisJCQlyZXR1cm4gLUVGQVVMVDsKKworCQlv
YV9jb25maWcgPSBpOTE1X3BlcmZfZ2V0X29hX2NvbmZpZyhwZXJmLCBjb25maWdfaWQpOworCX0K
KwlpZiAoIW9hX2NvbmZpZykKKwkJcmV0dXJuIC1FTk9FTlQ7CisKKwlpZiAoX19jb3B5X2Zyb21f
dXNlcigmdXNlcl9jb25maWcsIHVzZXJfY29uZmlnX3B0ciwKKwkJCSAgICAgc2l6ZW9mKHVzZXJf
Y29uZmlnKSkpIHsKKwkJcmV0ID0gLUVGQVVMVDsKKwkJZ290byBvdXQ7CisJfQorCisJcmV0ID0g
Y2FuX2NvcHlfcGVyZl9jb25maWdfcmVnaXN0ZXJzX29yX251bWJlcih1c2VyX2NvbmZpZy5uX2Jv
b2xlYW5fcmVncywKKwkJCQkJCSAgICAgICB1c2VyX2NvbmZpZy5ib29sZWFuX3JlZ3NfcHRyLAor
CQkJCQkJICAgICAgIG9hX2NvbmZpZy0+Yl9jb3VudGVyX3JlZ3NfbGVuKTsKKwlpZiAocmV0KQor
CQlnb3RvIG91dDsKKworCXJldCA9IGNhbl9jb3B5X3BlcmZfY29uZmlnX3JlZ2lzdGVyc19vcl9u
dW1iZXIodXNlcl9jb25maWcubl9mbGV4X3JlZ3MsCisJCQkJCQkgICAgICAgdXNlcl9jb25maWcu
ZmxleF9yZWdzX3B0ciwKKwkJCQkJCSAgICAgICBvYV9jb25maWctPmZsZXhfcmVnc19sZW4pOwor
CWlmIChyZXQpCisJCWdvdG8gb3V0OworCisJcmV0ID0gY2FuX2NvcHlfcGVyZl9jb25maWdfcmVn
aXN0ZXJzX29yX251bWJlcih1c2VyX2NvbmZpZy5uX211eF9yZWdzLAorCQkJCQkJICAgICAgIHVz
ZXJfY29uZmlnLm11eF9yZWdzX3B0ciwKKwkJCQkJCSAgICAgICBvYV9jb25maWctPm11eF9yZWdz
X2xlbik7CisJaWYgKHJldCkKKwkJZ290byBvdXQ7CisKKwlyZXQgPSBjb3B5X3BlcmZfY29uZmln
X3JlZ2lzdGVyc19vcl9udW1iZXIob2FfY29uZmlnLT5iX2NvdW50ZXJfcmVncywKKwkJCQkJCSAg
IG9hX2NvbmZpZy0+Yl9jb3VudGVyX3JlZ3NfbGVuLAorCQkJCQkJICAgdXNlcl9jb25maWcuYm9v
bGVhbl9yZWdzX3B0ciwKKwkJCQkJCSAgICZ1c2VyX2NvbmZpZy5uX2Jvb2xlYW5fcmVncyk7CisJ
aWYgKHJldCkKKwkJZ290byBvdXQ7CisKKwlyZXQgPSBjb3B5X3BlcmZfY29uZmlnX3JlZ2lzdGVy
c19vcl9udW1iZXIob2FfY29uZmlnLT5mbGV4X3JlZ3MsCisJCQkJCQkgICBvYV9jb25maWctPmZs
ZXhfcmVnc19sZW4sCisJCQkJCQkgICB1c2VyX2NvbmZpZy5mbGV4X3JlZ3NfcHRyLAorCQkJCQkJ
ICAgJnVzZXJfY29uZmlnLm5fZmxleF9yZWdzKTsKKwlpZiAocmV0KQorCQlnb3RvIG91dDsKKwor
CXJldCA9IGNvcHlfcGVyZl9jb25maWdfcmVnaXN0ZXJzX29yX251bWJlcihvYV9jb25maWctPm11
eF9yZWdzLAorCQkJCQkJICAgb2FfY29uZmlnLT5tdXhfcmVnc19sZW4sCisJCQkJCQkgICB1c2Vy
X2NvbmZpZy5tdXhfcmVnc19wdHIsCisJCQkJCQkgICAmdXNlcl9jb25maWcubl9tdXhfcmVncyk7
CisJaWYgKHJldCkKKwkJZ290byBvdXQ7CisKKwltZW1jcHkodXNlcl9jb25maWcudXVpZCwgb2Ff
Y29uZmlnLT51dWlkLCBzaXplb2YodXNlcl9jb25maWcudXVpZCkpOworCisJaWYgKF9fY29weV90
b191c2VyKHVzZXJfY29uZmlnX3B0ciwgJnVzZXJfY29uZmlnLAorCQkJICAgc2l6ZW9mKHVzZXJf
Y29uZmlnKSkpIHsKKwkJcmV0ID0gLUVGQVVMVDsKKwkJZ290byBvdXQ7CisJfQorCisJcmV0ID0g
dG90YWxfc2l6ZTsKKworb3V0OgorCWk5MTVfb2FfY29uZmlnX3B1dChvYV9jb25maWcpOworCXJl
dHVybiByZXQ7Cit9CisKK3N0YXRpYyBzaXplX3Qgc2l6ZW9mX3BlcmZfY29uZmlnX2xpc3Qoc2l6
ZV90IGNvdW50KQoreworCXJldHVybiBzaXplb2Yoc3RydWN0IGRybV9pOTE1X3F1ZXJ5X3BlcmZf
Y29uZmlnKSArIHNpemVvZih1NjQpICogY291bnQ7Cit9CisKK3N0YXRpYyBzaXplX3Qgc2l6ZW9m
X3BlcmZfbWV0cmljcyhzdHJ1Y3QgaTkxNV9wZXJmICpwZXJmKQoreworCXN0cnVjdCBpOTE1X29h
X2NvbmZpZyAqdG1wOworCXNpemVfdCBpOworCWludCBpZDsKKworCWkgPSAxOworCXJjdV9yZWFk
X2xvY2soKTsKKwlpZHJfZm9yX2VhY2hfZW50cnkoJnBlcmYtPm1ldHJpY3NfaWRyLCB0bXAsIGlk
KQorCQlpKys7CisJcmN1X3JlYWRfdW5sb2NrKCk7CisKKwlyZXR1cm4gc2l6ZW9mX3BlcmZfY29u
ZmlnX2xpc3QoaSk7Cit9CisKK3N0YXRpYyBpbnQgcXVlcnlfcGVyZl9jb25maWdfbGlzdChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKKwkJCQkgIHN0cnVjdCBkcm1faTkxNV9xdWVyeV9p
dGVtICpxdWVyeV9pdGVtKQoreworCXN0cnVjdCBkcm1faTkxNV9xdWVyeV9wZXJmX2NvbmZpZyBf
X3VzZXIgKnVzZXJfcXVlcnlfY29uZmlnX3B0ciA9CisJCXU2NF90b191c2VyX3B0cihxdWVyeV9p
dGVtLT5kYXRhX3B0cik7CisJc3RydWN0IGk5MTVfcGVyZiAqcGVyZiA9ICZpOTE1LT5wZXJmOwor
CXU2NCAqb2FfY29uZmlnX2lkcyA9IE5VTEw7CisJaW50IGFsbG9jLCBuX2NvbmZpZ3M7CisJdTMy
IGZsYWdzOworCWludCByZXQ7CisKKwlpZiAoIXBlcmYtPmk5MTUpCisJCXJldHVybiAtRU5PREVW
OworCisJaWYgKHF1ZXJ5X2l0ZW0tPmxlbmd0aCA9PSAwKQorCQlyZXR1cm4gc2l6ZW9mX3BlcmZf
bWV0cmljcyhwZXJmKTsKKworCWlmIChnZXRfdXNlcihmbGFncywgJnVzZXJfcXVlcnlfY29uZmln
X3B0ci0+ZmxhZ3MpKQorCQlyZXR1cm4gLUVGQVVMVDsKKworCWlmIChmbGFncyAhPSAwKQorCQly
ZXR1cm4gLUVJTlZBTDsKKworCW5fY29uZmlncyA9IDE7CisJZG8geworCQlzdHJ1Y3QgaTkxNV9v
YV9jb25maWcgKnRtcDsKKwkJdTY0ICppZHM7CisJCWludCBpZDsKKworCQlpZHMgPSBrcmVhbGxv
YyhvYV9jb25maWdfaWRzLAorCQkJICAgICAgIG5fY29uZmlncyAqIHNpemVvZigqb2FfY29uZmln
X2lkcyksCisJCQkgICAgICAgR0ZQX0tFUk5FTCk7CisJCWlmICghaWRzKQorCQkJcmV0dXJuIC1F
Tk9NRU07CisKKwkJYWxsb2MgPSBmZXRjaF9hbmRfemVybygmbl9jb25maWdzKTsKKworCQlpZHNb
bl9jb25maWdzKytdID0gMXVsbDsgLyogcmVzZXJ2ZWQgZm9yIHRlc3RfY29uZmlnICovCisJCXJj
dV9yZWFkX2xvY2soKTsKKwkJaWRyX2Zvcl9lYWNoX2VudHJ5KCZwZXJmLT5tZXRyaWNzX2lkciwg
dG1wLCBpZCkgeworCQkJaWYgKG5fY29uZmlncyA8IGFsbG9jKQorCQkJCWlkc1tuX2NvbmZpZ3Nd
ID0gaWQ7CisJCQluX2NvbmZpZ3MrKzsKKwkJfQorCQlyY3VfcmVhZF91bmxvY2soKTsKKworCQlv
YV9jb25maWdfaWRzID0gaWRzOworCX0gd2hpbGUgKG5fY29uZmlncyA+IGFsbG9jKTsKKworCWlm
IChxdWVyeV9pdGVtLT5sZW5ndGggPCBzaXplb2ZfcGVyZl9jb25maWdfbGlzdChuX2NvbmZpZ3Mp
KSB7CisJCURSTV9ERUJVRygiSW52YWxpZCBxdWVyeSBjb25maWcgbGlzdCBpdGVtIHNpemU9JXUg
ZXhwZWN0ZWQ9JXp1XG4iLAorCQkJICBxdWVyeV9pdGVtLT5sZW5ndGgsCisJCQkgIHNpemVvZl9w
ZXJmX2NvbmZpZ19saXN0KG5fY29uZmlncykpOworCQlrZnJlZShvYV9jb25maWdfaWRzKTsKKwkJ
cmV0dXJuIC1FSU5WQUw7CisJfQorCisJaWYgKHB1dF91c2VyKG5fY29uZmlncywgJnVzZXJfcXVl
cnlfY29uZmlnX3B0ci0+Y29uZmlnKSkgeworCQlrZnJlZShvYV9jb25maWdfaWRzKTsKKwkJcmV0
dXJuIC1FRkFVTFQ7CisJfQorCisJcmV0ID0gY29weV90b191c2VyKHVzZXJfcXVlcnlfY29uZmln
X3B0ciArIDEsCisJCQkgICBvYV9jb25maWdfaWRzLAorCQkJICAgbl9jb25maWdzICogc2l6ZW9m
KCpvYV9jb25maWdfaWRzKSk7CisJa2ZyZWUob2FfY29uZmlnX2lkcyk7CisJaWYgKHJldCkKKwkJ
cmV0dXJuIC1FRkFVTFQ7CisKKwlyZXR1cm4gc2l6ZW9mX3BlcmZfY29uZmlnX2xpc3Qobl9jb25m
aWdzKTsKK30KKworc3RhdGljIGludCBxdWVyeV9wZXJmX2NvbmZpZyhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKKwkJCSAgICAgc3RydWN0IGRybV9pOTE1X3F1ZXJ5X2l0ZW0gKnF1ZXJ5
X2l0ZW0pCit7CisJc3dpdGNoIChxdWVyeV9pdGVtLT5mbGFncykgeworCWNhc2UgRFJNX0k5MTVf
UVVFUllfUEVSRl9DT05GSUdfTElTVDoKKwkJcmV0dXJuIHF1ZXJ5X3BlcmZfY29uZmlnX2xpc3Qo
aTkxNSwgcXVlcnlfaXRlbSk7CisJY2FzZSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NPTkZJR19EQVRB
X0ZPUl9VVUlEOgorCQlyZXR1cm4gcXVlcnlfcGVyZl9jb25maWdfZGF0YShpOTE1LCBxdWVyeV9p
dGVtLCB0cnVlKTsKKwljYXNlIERSTV9JOTE1X1FVRVJZX1BFUkZfQ09ORklHX0RBVEFfRk9SX0lE
OgorCQlyZXR1cm4gcXVlcnlfcGVyZl9jb25maWdfZGF0YShpOTE1LCBxdWVyeV9pdGVtLCBmYWxz
ZSk7CisJZGVmYXVsdDoKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorfQorCiBzdGF0aWMgaW50ICgq
IGNvbnN0IGk5MTVfcXVlcnlfZnVuY3NbXSkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAogCQkJCQlzdHJ1Y3QgZHJtX2k5MTVfcXVlcnlfaXRlbSAqcXVlcnlfaXRlbSkgPSB7CiAJ
cXVlcnlfdG9wb2xvZ3lfaW5mbywKIAlxdWVyeV9lbmdpbmVfaW5mbywKKwlxdWVyeV9wZXJmX2Nv
bmZpZywKIH07CiAKIGludCBpOTE1X3F1ZXJ5X2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYs
IHZvaWQgKmRhdGEsIHN0cnVjdCBkcm1fZmlsZSAqZmlsZSkKZGlmZiAtLWdpdCBhL2luY2x1ZGUv
dWFwaS9kcm0vaTkxNV9kcm0uaCBiL2luY2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaAppbmRleCBj
NTBjNzEyYjM3NzEuLjBjN2IyODE1ZmJmMSAxMDA2NDQKLS0tIGEvaW5jbHVkZS91YXBpL2RybS9p
OTE1X2RybS5oCisrKyBiL2luY2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaApAQCAtMjAwNSw2ICsy
MDA1LDcgQEAgc3RydWN0IGRybV9pOTE1X3F1ZXJ5X2l0ZW0gewogCV9fdTY0IHF1ZXJ5X2lkOwog
I2RlZmluZSBEUk1fSTkxNV9RVUVSWV9UT1BPTE9HWV9JTkZPICAgIDEKICNkZWZpbmUgRFJNX0k5
MTVfUVVFUllfRU5HSU5FX0lORk8JMgorI2RlZmluZSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NPTkZJ
RyAgICAgIDMKIC8qIE11c3QgYmUga2VwdCBjb21wYWN0IC0tIG5vIGhvbGVzIGFuZCB3ZWxsIGRv
Y3VtZW50ZWQgKi8KIAogCS8qCkBAIC0yMDE2LDkgKzIwMTcsMTggQEAgc3RydWN0IGRybV9pOTE1
X3F1ZXJ5X2l0ZW0gewogCV9fczMyIGxlbmd0aDsKIAogCS8qCi0JICogVW51c2VkIGZvciBub3cu
IE11c3QgYmUgY2xlYXJlZCB0byB6ZXJvLgorCSAqIFdoZW4gcXVlcnlfaWQgPT0gRFJNX0k5MTVf
UVVFUllfVE9QT0xPR1lfSU5GTywgbXVzdCBiZSAwLgorCSAqCisJICogV2hlbiBxdWVyeV9pZCA9
PSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NPTkZJRywgbXVzdCBiZSBvbmUgb2YgdGhlCisJICogZm9s
bG93aW5nIDoKKwkgKiAgICAgICAgIC0gRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfTElTVAor
CSAqICAgICAgICAgLSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NPTkZJR19EQVRBX0ZPUl9VVUlECisJ
ICogICAgICAgICAtIERSTV9JOTE1X1FVRVJZX1BFUkZfQ09ORklHX0ZPUl9VVUlECiAJICovCiAJ
X191MzIgZmxhZ3M7CisjZGVmaW5lIERSTV9JOTE1X1FVRVJZX1BFUkZfQ09ORklHX0xJU1QgICAg
ICAgICAgMQorI2RlZmluZSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NPTkZJR19EQVRBX0ZPUl9VVUlE
IDIKKyNkZWZpbmUgRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfREFUQV9GT1JfSUQgICAzCiAK
IAkvKgogCSAqIERhdGEgd2lsbCBiZSB3cml0dGVuIGF0IHRoZSBsb2NhdGlvbiBwb2ludGVkIGJ5
IGRhdGFfcHRyIHdoZW4gdGhlCkBAIC0yMTQ2LDYgKzIxNTYsNTYgQEAgc3RydWN0IGRybV9pOTE1
X3F1ZXJ5X2VuZ2luZV9pbmZvIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfZW5naW5lX2luZm8gZW5naW5l
c1tdOwogfTsKIAorLyoKKyAqIERhdGEgd3JpdHRlbiBieSB0aGUga2VybmVsIHdpdGggcXVlcnkg
RFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUcuCisgKi8KK3N0cnVjdCBkcm1faTkxNV9xdWVyeV9w
ZXJmX2NvbmZpZyB7CisJdW5pb24geworCQkvKgorCQkgKiBXaGVuIHF1ZXJ5X2l0ZW0uZmxhZ3Mg
PT0gRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfTElTVCwgaTkxNSBzZXRzCisJCSAqIHRoaXMg
ZmllbGRzIHRvIHRoZSBudW1iZXIgb2YgY29uZmlndXJhdGlvbnMgYXZhaWxhYmxlLgorCQkgKi8K
KwkJX191NjQgbl9jb25maWdzOworCisJCS8qCisJCSAqIFdoZW4gcXVlcnlfaWQgPT0gRFJNX0k5
MTVfUVVFUllfUEVSRl9DT05GSUdfREFUQV9GT1JfSUQsCisJCSAqIGk5MTUgd2lsbCB1c2UgdGhl
IHZhbHVlIGluIHRoaXMgZmllbGQgYXMgY29uZmlndXJhdGlvbgorCQkgKiBpZGVudGlmaWVyIHRv
IGRlY2lkZSB3aGF0IGRhdGEgdG8gd3JpdGUgaW50byBjb25maWdfcHRyLgorCQkgKi8KKwkJX191
NjQgY29uZmlnOworCisJCS8qCisJCSAqIFdoZW4gcXVlcnlfaWQgPT0gRFJNX0k5MTVfUVVFUllf
UEVSRl9DT05GSUdfREFUQV9GT1JfVVVJRCwKKwkJICogaTkxNSB3aWxsIHVzZSB0aGUgdmFsdWUg
aW4gdGhpcyBmaWVsZCBhcyBjb25maWd1cmF0aW9uCisJCSAqIGlkZW50aWZpZXIgdG8gZGVjaWRl
IHdoYXQgZGF0YSB0byB3cml0ZSBpbnRvIGNvbmZpZ19wdHIuCisJCSAqCisJCSAqIFN0cmluZyBm
b3JtYXR0ZWQgbGlrZSAiJTA4eC0lMDR4LSUwNHgtJTA0eC0lMDEyeCIKKwkJICovCisJCWNoYXIg
dXVpZFszNl07CisJfTsKKworCS8qCisJICogVW51c2VkIGZvciBub3cuIE11c3QgYmUgY2xlYXJl
ZCB0byB6ZXJvLgorCSAqLworCV9fdTMyIGZsYWdzOworCisJLyoKKwkgKiBXaGVuIHF1ZXJ5X2l0
ZW0uZmxhZ3MgPT0gRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfTElTVCwgaTkxNSB3aWxsCisJ
ICogd3JpdGUgYW4gYXJyYXkgb2YgX191NjQgb2YgY29uZmlndXJhdGlvbiBpZGVudGlmaWVycy4K
KwkgKgorCSAqIFdoZW4gcXVlcnlfaXRlbS5mbGFncyA9PSBEUk1fSTkxNV9RVUVSWV9QRVJGX0NP
TkZJR19EQVRBLCBpOTE1IHdpbGwKKwkgKiB3cml0ZSBhIHN0cnVjdCBkcm1faTkxNV9wZXJmX29h
X2NvbmZpZy4gSWYgdGhlIGZvbGxvd2luZyBmaWVsZHMgb2YKKwkgKiBkcm1faTkxNV9wZXJmX29h
X2NvbmZpZyBhcmUgc2V0IG5vdCBzZXQgdG8gMCwgaTkxNSB3aWxsIHdyaXRlIGludG8KKwkgKiB0
aGUgYXNzb2NpYXRlZCBwb2ludGVycyB0aGUgdmFsdWVzIG9mIHN1Ym1pdHRlZCB3aGVuIHRoZQor
CSAqIGNvbmZpZ3VyYXRpb24gd2FzIGNyZWF0ZWQgOgorCSAqCisJICogICAgICAgICAtIG5fbXV4
X3JlZ3MKKwkgKiAgICAgICAgIC0gbl9ib29sZWFuX3JlZ3MKKwkgKiAgICAgICAgIC0gbl9mbGV4
X3JlZ3MKKwkgKi8KKwlfX3U4IGRhdGFbXTsKK307CisKICNpZiBkZWZpbmVkKF9fY3BsdXNwbHVz
KQogfQogI2VuZGlmCi0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZy
ZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3Rp
bmZvL2ludGVsLWdmeA==

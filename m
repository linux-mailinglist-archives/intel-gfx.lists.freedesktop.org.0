Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D946C70D41
	for <lists+intel-gfx@lfdr.de>; Tue, 23 Jul 2019 01:21:33 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9047389F4F;
	Mon, 22 Jul 2019 23:21:30 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga02.intel.com (mga02.intel.com [134.134.136.20])
 by gabe.freedesktop.org (Postfix) with ESMTPS id F053489F45
 for <intel-gfx@lists.freedesktop.org>; Mon, 22 Jul 2019 23:21:22 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga001.fm.intel.com ([10.253.24.23])
 by orsmga101.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 22 Jul 2019 16:21:22 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,296,1559545200"; d="scan'208";a="188709314"
Received: from dceraolo-linux.fm.intel.com ([10.1.27.145])
 by fmsmga001.fm.intel.com with ESMTP; 22 Jul 2019 16:21:22 -0700
From: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 22 Jul 2019 16:20:44 -0700
Message-Id: <20190722232048.9970-6-daniele.ceraolospurio@intel.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190722232048.9970-1-daniele.ceraolospurio@intel.com>
References: <20190722232048.9970-1-daniele.ceraolospurio@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 5/9] drm/i915/uc: Unify uc_fw status tracking
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgY3VycmVudGx5IHRyYWNrIGZldGNoIGFuZCBsb2FkIHN0YXR1cyBzZXBhcmF0ZWx5LCBidXQg
dGhlIDIgYXJlCmFjdHVhbGx5IHNlcXVlbnRpYWwgaW4gdGhlIHVjIGxpZmV0aW1lIChmZXRjaCBt
dXN0IGNvbXBsZXRlIGJlZm9yZSB3ZQpjYW4gYXR0ZW1wdCB0aGUgbG9hZCEpLiBVbmlmeWluZyB0
aGUgMiB2YXJpYWJsZXMgd2UgY2FuIGJldHRlciBmb2xsb3cKdGhlIHNlcXVlbnRpYWwgc3RhdGVz
IGFuZCBpbXByb3ZlIG91ciB0cmFja25nIG9mIHRoZSB1QyBzdGF0ZS4KCkFsc28sIHNwcmlua2xl
IHNvbWUgR0VNX0JVR19PTiB0byBtYWtlIHN1cmUgd2UgdHJhbnNpdGlvbiBjb3JyZWN0bHkKYmV0
d2VlbiBzdGF0ZXMuCgpTdWdnZXN0ZWQtYnk6IE1pY2hhbCBXYWpkZWN6a28gPG1pY2hhbC53YWpk
ZWN6a29AaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBEYW5pZWxlIENlcmFvbG8gU3B1cmlvIDxk
YW5pZWxlLmNlcmFvbG9zcHVyaW9AaW50ZWwuY29tPgpDYzogTWljaGFsIFdhamRlY3prbyA8bWlj
aGFsLndhamRlY3prb0BpbnRlbC5jb20+CkNjOiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdp
bHNvbi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF9odWMuYyAg
IHwgIDQgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX3VjX2Z3LmMgfCA3NCAr
KysrKysrKysrLS0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVs
X3VjX2Z3LmggfCA1MCArKysrKysrKy0tLS0tLS0tCiAzIGZpbGVzIGNoYW5nZWQsIDU3IGluc2Vy
dGlvbnMoKyksIDcxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3VjL2ludGVsX2h1Yy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxf
aHVjLmMKaW5kZXggYmMxNDQzOTE3M2Q3Li4xODY4ZjY3NmQ4OTAgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX2h1Yy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3VjL2ludGVsX2h1Yy5jCkBAIC0xMTcsNyArMTE3LDcgQEAgaW50IGludGVsX2h1Y19h
dXRoKHN0cnVjdCBpbnRlbF9odWMgKmh1YykKIAlzdHJ1Y3QgaW50ZWxfZ3VjICpndWMgPSAmZ3Qt
PnVjLmd1YzsKIAlpbnQgcmV0OwogCi0JaWYgKGh1Yy0+ZncubG9hZF9zdGF0dXMgIT0gSU5URUxf
VUNfRklSTVdBUkVfU1VDQ0VTUykKKwlpZiAoaHVjLT5mdy5zdGF0dXMgIT0gSU5URUxfVUNfRklS
TVdBUkVfTE9BREVEKQogCQlyZXR1cm4gLUVOT0VYRUM7CiAKIAlyZXQgPSBpbnRlbF9ndWNfYXV0
aF9odWMoZ3VjLApAQCAtMTQxLDcgKzE0MSw3IEBAIGludCBpbnRlbF9odWNfYXV0aChzdHJ1Y3Qg
aW50ZWxfaHVjICpodWMpCiAJcmV0dXJuIDA7CiAKIGZhaWw6Ci0JaHVjLT5mdy5sb2FkX3N0YXR1
cyA9IElOVEVMX1VDX0ZJUk1XQVJFX0ZBSUw7CisJaHVjLT5mdy5zdGF0dXMgPSBJTlRFTF9VQ19G
SVJNV0FSRV9MT0FEX0ZBSUw7CiAKIAlEUk1fRVJST1IoIkh1QzogQXV0aGVudGljYXRpb24gZmFp
bGVkICVkXG4iLCByZXQpOwogCXJldHVybiByZXQ7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC91Yy9pbnRlbF91Y19mdy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMv
aW50ZWxfdWNfZncuYwppbmRleCBmYWE5Njc0OGFlZDMuLjkxYjFkOTY2MzQ4MSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfdWNfZncuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF91Y19mdy5jCkBAIC00NSwxNSArNDUsMTMgQEAgdm9p
ZCBpbnRlbF91Y19md19zZWxlY3Qoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQlj
b25zdCBzdHJ1Y3QgaW50ZWxfdWNfcGxhdGZvcm1fcmVxdWlyZW1lbnQgKmxpc3QsCiAJCQl1bnNp
Z25lZCBpbnQgbGVuZ3RoKQogewotCUdFTV9CVUdfT04odWNfZnctPmZldGNoX3N0YXR1cyAhPSBJ
TlRFTF9VQ19GSVJNV0FSRV9VTklOSVRJQUxJWkVEKTsKKwlHRU1fQlVHX09OKHVjX2Z3LT5zdGF0
dXMgIT0gSU5URUxfVUNfRklSTVdBUkVfVU5JTklUSUFMSVpFRCk7CiAKIAlpZiAoIUhBU19VQyhp
OTE1KSkgewotCQl1Y19mdy0+ZmV0Y2hfc3RhdHVzID0gSU5URUxfVUNfRklSTVdBUkVfTk9UX1NV
UFBPUlRFRDsKKwkJdWNfZnctPnN0YXR1cyA9IElOVEVMX1VDX0ZJUk1XQVJFX05PVF9TVVBQT1JU
RUQ7CiAJCXJldHVybjsKIAl9CiAKLQl1Y19mdy0+ZmV0Y2hfc3RhdHVzID0gSU5URUxfVUNfRklS
TVdBUkVfTk9UX1NUQVJURUQ7Ci0KIAlpZiAodW5saWtlbHkoaTkxNV9tb2RwYXJhbXMuZ3VjX2Zp
cm13YXJlX3BhdGggJiYKIAkJICAgICB1Y19mdy0+dHlwZSA9PSBJTlRFTF9VQ19GV19UWVBFX0dV
QykpIHsKIAkJdWNfZnctPnBhdGggPSBpOTE1X21vZHBhcmFtcy5ndWNfZmlybXdhcmVfcGF0aDsK
QEAgLTc0LDYgKzcyLDggQEAgdm9pZCBpbnRlbF91Y19md19zZWxlY3Qoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiAJCQl9CiAJCX0KIAl9CisKKwl1Y19mdy0+c3RhdHVzID0gSU5URUxf
VUNfRklSTVdBUkVfU0VMRUNUSU9OX0RPTkU7CiB9CiAKIC8qKgpAQCAtOTUsMjMgKzk1LDExIEBA
IHZvaWQgaW50ZWxfdWNfZndfZmV0Y2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAogCWludCBlcnI7CiAKIAlHRU1fQlVHX09OKCFpbnRlbF91Y19md19zdXBwb3J0ZWQodWNfZncp
KTsKLQotCWlmICghdWNfZnctPnBhdGgpIHsKLQkJZGV2X2luZm8oZGV2X3ByaXYtPmRybS5kZXYs
Ci0JCQkgIiVzOiBObyBmaXJtd2FyZSB3YXMgZGVmaW5lZCBmb3IgJXMhXG4iLAotCQkJIGludGVs
X3VjX2Z3X3R5cGVfcmVwcih1Y19mdy0+dHlwZSksCi0JCQkgaW50ZWxfcGxhdGZvcm1fbmFtZShJ
TlRFTF9JTkZPKGRldl9wcml2KS0+cGxhdGZvcm0pKTsKLQkJcmV0dXJuOwotCX0KKwlHRU1fQlVH
X09OKCFpbnRlbF91Y19md19pc19zZWxlY3RlZCh1Y19mdykpOwogCiAJRFJNX0RFQlVHX0RSSVZF
UigiJXMgZncgZmV0Y2ggJXNcbiIsCiAJCQkgaW50ZWxfdWNfZndfdHlwZV9yZXByKHVjX2Z3LT50
eXBlKSwgdWNfZnctPnBhdGgpOwogCi0JdWNfZnctPmZldGNoX3N0YXR1cyA9IElOVEVMX1VDX0ZJ
Uk1XQVJFX1BFTkRJTkc7Ci0JRFJNX0RFQlVHX0RSSVZFUigiJXMgZncgZmV0Y2ggJXNcbiIsCi0J
CQkgaW50ZWxfdWNfZndfdHlwZV9yZXByKHVjX2Z3LT50eXBlKSwKLQkJCSBpbnRlbF91Y19md19z
dGF0dXNfcmVwcih1Y19mdy0+ZmV0Y2hfc3RhdHVzKSk7Ci0KIAllcnIgPSByZXF1ZXN0X2Zpcm13
YXJlKCZmdywgdWNfZnctPnBhdGgsICZwZGV2LT5kZXYpOwogCWlmIChlcnIpIHsKIAkJRFJNX0RF
QlVHX0RSSVZFUigiJXMgZncgcmVxdWVzdF9maXJtd2FyZSBlcnI9JWRcbiIsCkBAIC0yMTksMTkg
KzIwNywxNyBAQCB2b2lkIGludGVsX3VjX2Z3X2ZldGNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIAogCXVjX2Z3LT5vYmogPSBvYmo7CiAJdWNfZnctPnNpemUgPSBmdy0+c2l6
ZTsKLQl1Y19mdy0+ZmV0Y2hfc3RhdHVzID0gSU5URUxfVUNfRklSTVdBUkVfU1VDQ0VTUzsKLQlE
Uk1fREVCVUdfRFJJVkVSKCIlcyBmdyBmZXRjaCAlc1xuIiwKLQkJCSBpbnRlbF91Y19md190eXBl
X3JlcHIodWNfZnctPnR5cGUpLAotCQkJIGludGVsX3VjX2Z3X3N0YXR1c19yZXByKHVjX2Z3LT5m
ZXRjaF9zdGF0dXMpKTsKKwl1Y19mdy0+c3RhdHVzID0gSU5URUxfVUNfRklSTVdBUkVfRkVUQ0hF
RDsKKwlEUk1fREVCVUdfRFJJVkVSKCIlcyBmdyBmZXRjaCBkb25lXG4iLAorCQkJIGludGVsX3Vj
X2Z3X3R5cGVfcmVwcih1Y19mdy0+dHlwZSkpOwogCiAJcmVsZWFzZV9maXJtd2FyZShmdyk7CiAJ
cmV0dXJuOwogCiBmYWlsOgotCXVjX2Z3LT5mZXRjaF9zdGF0dXMgPSBJTlRFTF9VQ19GSVJNV0FS
RV9GQUlMOwotCURSTV9ERUJVR19EUklWRVIoIiVzIGZ3IGZldGNoICVzXG4iLAotCQkJIGludGVs
X3VjX2Z3X3R5cGVfcmVwcih1Y19mdy0+dHlwZSksCi0JCQkgaW50ZWxfdWNfZndfc3RhdHVzX3Jl
cHIodWNfZnctPmZldGNoX3N0YXR1cykpOworCXVjX2Z3LT5zdGF0dXMgPSBJTlRFTF9VQ19GSVJN
V0FSRV9GRVRDSF9GQUlMOworCURSTV9ERUJVR19EUklWRVIoIiVzIGZ3IGZldGNoIGZhaWxlZFxu
IiwKKwkJCSBpbnRlbF91Y19md190eXBlX3JlcHIodWNfZnctPnR5cGUpKTsKIAogCURSTV9XQVJO
KCIlczogRmFpbGVkIHRvIGZldGNoIGZpcm13YXJlICVzIChlcnJvciAlZClcbiIsCiAJCSBpbnRl
bF91Y19md190eXBlX3JlcHIodWNfZnctPnR5cGUpLCB1Y19mdy0+cGF0aCwgZXJyKTsKQEAgLTI4
NywxMyArMjczLDExIEBAIGludCBpbnRlbF91Y19md191cGxvYWQoc3RydWN0IGludGVsX3VjX2Z3
ICp1Y19mdywKIAlEUk1fREVCVUdfRFJJVkVSKCIlcyBmdyBsb2FkICVzXG4iLAogCQkJIGludGVs
X3VjX2Z3X3R5cGVfcmVwcih1Y19mdy0+dHlwZSksIHVjX2Z3LT5wYXRoKTsKIAotCWlmICh1Y19m
dy0+ZmV0Y2hfc3RhdHVzICE9IElOVEVMX1VDX0ZJUk1XQVJFX1NVQ0NFU1MpCi0JCXJldHVybiAt
RU5PRVhFQzsKKwkvKiBtYWtlIHN1cmUgdGhlIHN0YXR1cyB3YXMgY2xlYXJlZCB0aGUgbGFzdCB0
aW1lIHdlIHJlc2V0IHRoZSB1YyAqLworCUdFTV9CVUdfT04odWNfZnctPnN0YXR1cyA9PSBJTlRF
TF9VQ19GSVJNV0FSRV9MT0FERUQpOwogCi0JdWNfZnctPmxvYWRfc3RhdHVzID0gSU5URUxfVUNf
RklSTVdBUkVfUEVORElORzsKLQlEUk1fREVCVUdfRFJJVkVSKCIlcyBmdyBsb2FkICVzXG4iLAot
CQkJIGludGVsX3VjX2Z3X3R5cGVfcmVwcih1Y19mdy0+dHlwZSksCi0JCQkgaW50ZWxfdWNfZndf
c3RhdHVzX3JlcHIodWNfZnctPmxvYWRfc3RhdHVzKSk7CisJaWYgKHVjX2Z3LT5zdGF0dXMgPCBJ
TlRFTF9VQ19GSVJNV0FSRV9GRVRDSEVEKQorCQlyZXR1cm4gLUVOT0VYRUM7CiAKIAkvKiBDYWxs
IGN1c3RvbSBsb2FkZXIgKi8KIAlpbnRlbF91Y19md19nZ3R0X2JpbmQodWNfZncpOwpAQCAtMzAy
LDEwICsyODYsOSBAQCBpbnQgaW50ZWxfdWNfZndfdXBsb2FkKHN0cnVjdCBpbnRlbF91Y19mdyAq
dWNfZncsCiAJaWYgKGVycikKIAkJZ290byBmYWlsOwogCi0JdWNfZnctPmxvYWRfc3RhdHVzID0g
SU5URUxfVUNfRklSTVdBUkVfU1VDQ0VTUzsKLQlEUk1fREVCVUdfRFJJVkVSKCIlcyBmdyBsb2Fk
ICVzXG4iLAotCQkJIGludGVsX3VjX2Z3X3R5cGVfcmVwcih1Y19mdy0+dHlwZSksCi0JCQkgaW50
ZWxfdWNfZndfc3RhdHVzX3JlcHIodWNfZnctPmxvYWRfc3RhdHVzKSk7CisJdWNfZnctPnN0YXR1
cyA9IElOVEVMX1VDX0ZJUk1XQVJFX0xPQURFRDsKKwlEUk1fREVCVUdfRFJJVkVSKCIlcyBmdyBs
b2FkIGNvbXBsZXRlZFxuIiwKKwkJCSBpbnRlbF91Y19md190eXBlX3JlcHIodWNfZnctPnR5cGUp
KTsKIAogCURSTV9JTkZPKCIlczogTG9hZGVkIGZpcm13YXJlICVzICh2ZXJzaW9uICV1LiV1KVxu
IiwKIAkJIGludGVsX3VjX2Z3X3R5cGVfcmVwcih1Y19mdy0+dHlwZSksCkBAIC0zMTUsMTAgKzI5
OCw5IEBAIGludCBpbnRlbF91Y19md191cGxvYWQoc3RydWN0IGludGVsX3VjX2Z3ICp1Y19mdywK
IAlyZXR1cm4gMDsKIAogZmFpbDoKLQl1Y19mdy0+bG9hZF9zdGF0dXMgPSBJTlRFTF9VQ19GSVJN
V0FSRV9GQUlMOwotCURSTV9ERUJVR19EUklWRVIoIiVzIGZ3IGxvYWQgJXNcbiIsCi0JCQkgaW50
ZWxfdWNfZndfdHlwZV9yZXByKHVjX2Z3LT50eXBlKSwKLQkJCSBpbnRlbF91Y19md19zdGF0dXNf
cmVwcih1Y19mdy0+bG9hZF9zdGF0dXMpKTsKKwl1Y19mdy0+c3RhdHVzID0gSU5URUxfVUNfRklS
TVdBUkVfTE9BRF9GQUlMOworCURSTV9ERUJVR19EUklWRVIoIiVzIGZ3IGxvYWQgZmFpbGVkXG4i
LAorCQkJIGludGVsX3VjX2Z3X3R5cGVfcmVwcih1Y19mdy0+dHlwZSkpOwogCiAJRFJNX1dBUk4o
IiVzOiBGYWlsZWQgdG8gbG9hZCBmaXJtd2FyZSAlcyAoZXJyb3IgJWQpXG4iLAogCQkgaW50ZWxf
dWNfZndfdHlwZV9yZXByKHVjX2Z3LT50eXBlKSwgdWNfZnctPnBhdGgsIGVycik7CkBAIC0zMzAs
NyArMzEyLDEwIEBAIGludCBpbnRlbF91Y19md19pbml0KHN0cnVjdCBpbnRlbF91Y19mdyAqdWNf
ZncpCiB7CiAJaW50IGVycjsKIAotCWlmICh1Y19mdy0+ZmV0Y2hfc3RhdHVzICE9IElOVEVMX1VD
X0ZJUk1XQVJFX1NVQ0NFU1MpCisJLyogdGhpcyBzaG91bGQgaGFwcGVuIGJlZm9yZSB0aGUgbG9h
ZCEgKi8KKwlHRU1fQlVHX09OKHVjX2Z3LT5zdGF0dXMgPT0gSU5URUxfVUNfRklSTVdBUkVfTE9B
REVEKTsKKworCWlmICh1Y19mdy0+c3RhdHVzIDwgSU5URUxfVUNfRklSTVdBUkVfRkVUQ0hFRCkK
IAkJcmV0dXJuIC1FTk9FWEVDOwogCiAJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9wYWdlcyh1
Y19mdy0+b2JqKTsKQEAgLTM0Myw3ICszMjgsNyBAQCBpbnQgaW50ZWxfdWNfZndfaW5pdChzdHJ1
Y3QgaW50ZWxfdWNfZncgKnVjX2Z3KQogCiB2b2lkIGludGVsX3VjX2Z3X2Zpbmkoc3RydWN0IGlu
dGVsX3VjX2Z3ICp1Y19mdykKIHsKLQlpZiAodWNfZnctPmZldGNoX3N0YXR1cyAhPSBJTlRFTF9V
Q19GSVJNV0FSRV9TVUNDRVNTKQorCWlmICh1Y19mdy0+c3RhdHVzIDwgSU5URUxfVUNfRklSTVdB
UkVfRkVUQ0hFRCkKIAkJcmV0dXJuOwogCiAJaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKHVj
X2Z3LT5vYmopOwpAQCAtMzc3LDcgKzM2Miw3IEBAIHZvaWQgaW50ZWxfdWNfZndfY2xlYW51cF9m
ZXRjaChzdHJ1Y3QgaW50ZWxfdWNfZncgKnVjX2Z3KQogCWlmIChvYmopCiAJCWk5MTVfZ2VtX29i
amVjdF9wdXQob2JqKTsKIAotCXVjX2Z3LT5mZXRjaF9zdGF0dXMgPSBJTlRFTF9VQ19GSVJNV0FS
RV9OT1RfU1RBUlRFRDsKKwl1Y19mdy0+c3RhdHVzID0gSU5URUxfVUNfRklSTVdBUkVfU0VMRUNU
SU9OX0RPTkU7CiB9CiAKIC8qKgpAQCAtMzkxLDkgKzM3Niw4IEBAIHZvaWQgaW50ZWxfdWNfZndf
ZHVtcChjb25zdCBzdHJ1Y3QgaW50ZWxfdWNfZncgKnVjX2Z3LCBzdHJ1Y3QgZHJtX3ByaW50ZXIg
KnApCiB7CiAJZHJtX3ByaW50ZihwLCAiJXMgZmlybXdhcmU6ICVzXG4iLAogCQkgICBpbnRlbF91
Y19md190eXBlX3JlcHIodWNfZnctPnR5cGUpLCB1Y19mdy0+cGF0aCk7Ci0JZHJtX3ByaW50Zihw
LCAiXHRzdGF0dXM6IGZldGNoICVzLCBsb2FkICVzXG4iLAotCQkgICBpbnRlbF91Y19md19zdGF0
dXNfcmVwcih1Y19mdy0+ZmV0Y2hfc3RhdHVzKSwKLQkJICAgaW50ZWxfdWNfZndfc3RhdHVzX3Jl
cHIodWNfZnctPmxvYWRfc3RhdHVzKSk7CisJZHJtX3ByaW50ZihwLCAiXHRzdGF0dXM6ICVzXG4i
LAorCQkgICBpbnRlbF91Y19md19zdGF0dXNfcmVwcih1Y19mdy0+c3RhdHVzKSk7CiAJZHJtX3By
aW50ZihwLCAiXHR2ZXJzaW9uOiB3YW50ZWQgJXUuJXUsIGZvdW5kICV1LiV1XG4iLAogCQkgICB1
Y19mdy0+bWFqb3JfdmVyX3dhbnRlZCwgdWNfZnctPm1pbm9yX3Zlcl93YW50ZWQsCiAJCSAgIHVj
X2Z3LT5tYWpvcl92ZXJfZm91bmQsIHVjX2Z3LT5taW5vcl92ZXJfZm91bmQpOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfdWNfZncuaCBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3VjL2ludGVsX3VjX2Z3LmgKaW5kZXggNTUwYjYyNmFmYjE1Li5lMGM1YTM4
Njg1ZTYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX3VjX2Z3
LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfdWNfZncuaApAQCAtMzYs
MTIgKzM2LDEzIEBAIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlOwogI2RlZmluZSBJTlRFTF9VQ19G
SVJNV0FSRV9VUkwgImh0dHBzOi8vZ2l0Lmtlcm5lbC5vcmcvcHViL3NjbS9saW51eC9rZXJuZWwv
Z2l0L2Zpcm13YXJlL2xpbnV4LWZpcm13YXJlLmdpdC90cmVlL2k5MTUiCiAKIGVudW0gaW50ZWxf
dWNfZndfc3RhdHVzIHsKLQlJTlRFTF9VQ19GSVJNV0FSRV9OT1RfU1VQUE9SVEVEID0gLTIsIC8q
IG5vIHVjIEhXICovCi0JSU5URUxfVUNfRklSTVdBUkVfRkFJTCA9IC0xLAorCUlOVEVMX1VDX0ZJ
Uk1XQVJFX0xPQURfRkFJTCA9IC0zLAorCUlOVEVMX1VDX0ZJUk1XQVJFX0ZFVENIX0ZBSUwgPSAt
MiwKKwlJTlRFTF9VQ19GSVJNV0FSRV9OT1RfU1VQUE9SVEVEID0gLTEsIC8qIG5vIHVjIEhXICov
CiAJSU5URUxfVUNfRklSTVdBUkVfVU5JTklUSUFMSVpFRCA9IDAsIC8qIHVzZWQgdG8gY2F0Y2gg
Y2hlY2tzIGRvbmUgdG9vIGVhcmx5ICovCi0JSU5URUxfVUNfRklSTVdBUkVfTk9UX1NUQVJURUQg
PSAxLAotCUlOVEVMX1VDX0ZJUk1XQVJFX1BFTkRJTkcsCi0JSU5URUxfVUNfRklSTVdBUkVfU1VD
Q0VTUworCUlOVEVMX1VDX0ZJUk1XQVJFX1NFTEVDVElPTl9ET05FLCAvKiBzZWxlY3Rpb24gaW5j
bHVkZSB0aGUgIm5vIEZXIiBjYXNlICovCisJSU5URUxfVUNfRklSTVdBUkVfRkVUQ0hFRCwKKwlJ
TlRFTF9VQ19GSVJNV0FSRV9MT0FERUQKIH07CiAKIGVudW0gaW50ZWxfdWNfZndfdHlwZSB7CkBA
IC03Nyw4ICs3OCw3IEBAIHN0cnVjdCBpbnRlbF91Y19mdyB7CiAJY29uc3QgY2hhciAqcGF0aDsK
IAlzaXplX3Qgc2l6ZTsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwotCWVudW0g
aW50ZWxfdWNfZndfc3RhdHVzIGZldGNoX3N0YXR1czsKLQllbnVtIGludGVsX3VjX2Z3X3N0YXR1
cyBsb2FkX3N0YXR1czsKKwllbnVtIGludGVsX3VjX2Z3X3N0YXR1cyBzdGF0dXM7CiAKIAkvKgog
CSAqIFRoZSBmaXJtd2FyZSBidWlsZCBwcm9jZXNzIHdpbGwgZ2VuZXJhdGUgYSB2ZXJzaW9uIGhl
YWRlciBmaWxlIHdpdGggbWFqb3IgYW5kCkBAIC0xMDMsMTggKzEwMywyMCBAQCBzdGF0aWMgaW5s
aW5lCiBjb25zdCBjaGFyICppbnRlbF91Y19md19zdGF0dXNfcmVwcihlbnVtIGludGVsX3VjX2Z3
X3N0YXR1cyBzdGF0dXMpCiB7CiAJc3dpdGNoIChzdGF0dXMpIHsKKwljYXNlIElOVEVMX1VDX0ZJ
Uk1XQVJFX0xPQURfRkFJTDoKKwkJcmV0dXJuICJMT0FEIEZBSUwiOworCWNhc2UgSU5URUxfVUNf
RklSTVdBUkVfRkVUQ0hfRkFJTDoKKwkJcmV0dXJuICJGRVRDSCBGQUlMIjsKIAljYXNlIElOVEVM
X1VDX0ZJUk1XQVJFX05PVF9TVVBQT1JURUQ6Ci0JCXJldHVybiAiTi9BIC0gdWMgSFcgbm90IGF2
YWlsYWJsZSI7Ci0JY2FzZSBJTlRFTF9VQ19GSVJNV0FSRV9GQUlMOgotCQlyZXR1cm4gIkZBSUwi
OworCQlyZXR1cm4gIk4vQSI7CiAJY2FzZSBJTlRFTF9VQ19GSVJNV0FSRV9VTklOSVRJQUxJWkVE
OgogCQlyZXR1cm4gIlVOSU5JVElBTElaRUQiOwotCWNhc2UgSU5URUxfVUNfRklSTVdBUkVfTk9U
X1NUQVJURUQ6Ci0JCXJldHVybiAiTk9UX1NUQVJURUQiOwotCWNhc2UgSU5URUxfVUNfRklSTVdB
UkVfUEVORElORzoKLQkJcmV0dXJuICJQRU5ESU5HIjsKLQljYXNlIElOVEVMX1VDX0ZJUk1XQVJF
X1NVQ0NFU1M6Ci0JCXJldHVybiAiU1VDQ0VTUyI7CisJY2FzZSBJTlRFTF9VQ19GSVJNV0FSRV9T
RUxFQ1RJT05fRE9ORToKKwkJcmV0dXJuICJTRUxFQ1RJT04gRE9ORSI7CisJY2FzZSBJTlRFTF9V
Q19GSVJNV0FSRV9GRVRDSEVEOgorCQlyZXR1cm4gIkZFVENIRUQiOworCWNhc2UgSU5URUxfVUNf
RklSTVdBUkVfTE9BREVEOgorCQlyZXR1cm4gIkxPQURFRCI7CiAJfQogCXJldHVybiAiPGludmFs
aWQ+IjsKIH0KQEAgLTEzNSwzOCArMTM3LDM4IEBAIHZvaWQgaW50ZWxfdWNfZndfaW5pdF9lYXJs
eShzdHJ1Y3QgaW50ZWxfdWNfZncgKnVjX2Z3LAogCQkJICAgIGVudW0gaW50ZWxfdWNfZndfdHlw
ZSB0eXBlKQogewogCS8qCi0JICogd2UgdXNlIEZJUk1XQVJFX1VOSU5JVElBTElaRUQgdG8gZGV0
ZWN0IGNoZWNrcyBhZ2FpbnN0IGZldGNoX3N0YXR1cworCSAqIHdlIHVzZSBGSVJNV0FSRV9VTklO
SVRJQUxJWkVEIHRvIGRldGVjdCBjaGVja3MgYWdhaW5zdCB1Y19mdy0+c3RhdHVzCiAJICogYmVm
b3JlIHdlJ3JlIGxvb2tlZCBhdCB0aGUgSFcgY2FwcyB0byBzZWUgaWYgd2UgaGF2ZSB1YyBzdXBw
b3J0CiAJICovCiAJQlVJTERfQlVHX09OKElOVEVMX1VDX0ZJUk1XQVJFX1VOSU5JVElBTElaRUQp
OwogCiAJdWNfZnctPnBhdGggPSBOVUxMOwotCXVjX2Z3LT5mZXRjaF9zdGF0dXMgPSBJTlRFTF9V
Q19GSVJNV0FSRV9VTklOSVRJQUxJWkVEOwotCXVjX2Z3LT5sb2FkX3N0YXR1cyA9IElOVEVMX1VD
X0ZJUk1XQVJFX05PVF9TVEFSVEVEOworCXVjX2Z3LT5zdGF0dXMgPSBJTlRFTF9VQ19GSVJNV0FS
RV9VTklOSVRJQUxJWkVEOwogCXVjX2Z3LT50eXBlID0gdHlwZTsKIH0KIAogc3RhdGljIGlubGlu
ZSBib29sIGludGVsX3VjX2Z3X2lzX3NlbGVjdGVkKHN0cnVjdCBpbnRlbF91Y19mdyAqdWNfZncp
CiB7CisJR0VNX0JVR19PTih1Y19mdy0+cGF0aCAmJiB1Y19mdy0+c3RhdHVzIDwgSU5URUxfVUNf
RklSTVdBUkVfU0VMRUNUSU9OX0RPTkUpOwogCXJldHVybiB1Y19mdy0+cGF0aCAhPSBOVUxMOwog
fQogCiBzdGF0aWMgaW5saW5lIGJvb2wgaW50ZWxfdWNfZndfaXNfbG9hZGVkKHN0cnVjdCBpbnRl
bF91Y19mdyAqdWNfZncpCiB7Ci0JcmV0dXJuIHVjX2Z3LT5sb2FkX3N0YXR1cyA9PSBJTlRFTF9V
Q19GSVJNV0FSRV9TVUNDRVNTOworCXJldHVybiB1Y19mdy0+c3RhdHVzID09IElOVEVMX1VDX0ZJ
Uk1XQVJFX0xPQURFRDsKIH0KIAogc3RhdGljIGlubGluZSBib29sIGludGVsX3VjX2Z3X3N1cHBv
cnRlZChzdHJ1Y3QgaW50ZWxfdWNfZncgKnVjX2Z3KQogewogCS8qIHNob3VsZG4ndCBjYWxsIHRo
aXMgYmVmb3JlIGNoZWNraW5nIGh3L2Jsb2IgYXZhaWxhYmlsaXR5ICovCi0JR0VNX0JVR19PTih1
Y19mdy0+ZmV0Y2hfc3RhdHVzID09IElOVEVMX1VDX0ZJUk1XQVJFX1VOSU5JVElBTElaRUQpOwot
CXJldHVybiB1Y19mdy0+ZmV0Y2hfc3RhdHVzICE9IElOVEVMX1VDX0ZJUk1XQVJFX05PVF9TVVBQ
T1JURUQ7CisJR0VNX0JVR19PTih1Y19mdy0+c3RhdHVzID09IElOVEVMX1VDX0ZJUk1XQVJFX1VO
SU5JVElBTElaRUQpOworCXJldHVybiB1Y19mdy0+c3RhdHVzICE9IElOVEVMX1VDX0ZJUk1XQVJF
X05PVF9TVVBQT1JURUQ7CiB9CiAKIHN0YXRpYyBpbmxpbmUgdm9pZCBpbnRlbF91Y19md19zYW5p
dGl6ZShzdHJ1Y3QgaW50ZWxfdWNfZncgKnVjX2Z3KQogewogCWlmIChpbnRlbF91Y19md19pc19s
b2FkZWQodWNfZncpKQotCQl1Y19mdy0+bG9hZF9zdGF0dXMgPSBJTlRFTF9VQ19GSVJNV0FSRV9Q
RU5ESU5HOworCQl1Y19mdy0+c3RhdHVzID0gSU5URUxfVUNfRklSTVdBUkVfRkVUQ0hFRDsKIH0K
IAogLyoqCkBAIC0xNzksNyArMTgxLDcgQEAgc3RhdGljIGlubGluZSB2b2lkIGludGVsX3VjX2Z3
X3Nhbml0aXplKHN0cnVjdCBpbnRlbF91Y19mdyAqdWNfZncpCiAgKi8KIHN0YXRpYyBpbmxpbmUg
dTMyIGludGVsX3VjX2Z3X2dldF91cGxvYWRfc2l6ZShzdHJ1Y3QgaW50ZWxfdWNfZncgKnVjX2Z3
KQogewotCWlmICh1Y19mdy0+ZmV0Y2hfc3RhdHVzICE9IElOVEVMX1VDX0ZJUk1XQVJFX1NVQ0NF
U1MpCisJaWYgKHVjX2Z3LT5zdGF0dXMgPCBJTlRFTF9VQ19GSVJNV0FSRV9GRVRDSEVEKQogCQly
ZXR1cm4gMDsKIAogCXJldHVybiB1Y19mdy0+aGVhZGVyX3NpemUgKyB1Y19mdy0+dWNvZGVfc2l6
ZTsKLS0gCjIuMjIuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Au
b3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwt
Z2Z4

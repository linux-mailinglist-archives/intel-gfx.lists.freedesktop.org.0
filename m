Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 9F3629F2CA
	for <lists+intel-gfx@lfdr.de>; Tue, 27 Aug 2019 20:58:38 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7783B8994D;
	Tue, 27 Aug 2019 18:58:36 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga03.intel.com (mga03.intel.com [134.134.136.65])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 651718994D
 for <intel-gfx@lists.freedesktop.org>; Tue, 27 Aug 2019 18:58:35 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga003.jf.intel.com ([10.7.209.27])
 by orsmga103.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 27 Aug 2019 11:58:34 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,438,1559545200"; d="scan'208";a="182882046"
Received: from dceraolo-linux.fm.intel.com ([10.1.27.145])
 by orsmga003.jf.intel.com with ESMTP; 27 Aug 2019 11:58:34 -0700
From: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 27 Aug 2019 11:58:05 -0700
Message-Id: <20190827185805.21799-1-daniele.ceraolospurio@intel.com>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2] drm/i915: use a separate context for gpu
 relocs
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIENTIHByZS1wYXJzZXIgY2FuIHByZS1mZXRjaCBjb21tYW5kcyBhY3Jvc3MgbWVtb3J5IHN5
bmMgcG9pbnRzIGFuZApzdGFydGluZyBmcm9tIGdlbjEyIGl0IGlzIGFibGUgdG8gcHJlLWZldGNo
IGFjcm9zcyBCQl9TVEFSVCBhbmQgQkJfRU5ECmJvdW5kYXJpZXMgYXMgd2VsbCwgc28gd2hlbiB3
ZSBlbWl0IGdwdSByZWxvY3MgdGhlIHByZS1wYXJzZXIgbWlnaHQKZmV0Y2ggdGhlIHRhcmdldCBs
b2NhdGlvbiBvZiB0aGUgcmVsb2MgYmVmb3JlIHRoZSBtZW1vcnkgd3JpdGUgbGFuZHMuCgpUaGUg
cGFyc2VyIGNhbid0IHByZS1mZXRjaCBhY3Jvc3MgdGhlIGN0eCBzd2l0Y2gsIHNvIHdlIHVzZSBh
IHNlcGFyYXRlCmNvbnRleHQgdG8gZ3VhcmFudGVlIHRoYXQgdGhlIG1lbW9yeSBpcyBzeW5jaHJv
bml6ZWQgYmVmb3JlIHRoZSBwYXJzZXIKY2FuIGdldCB0byBpdC4KCk5vdGUgdGhhdCB0aGVyZSBp
cyBubyByaXNrIG9mIHRoZSBDUyBkb2luZyBhIGxpdGUgcmVzdG9yZSBmcm9tIHRoZSByZWxvYwpj
b250ZXh0IHRvIHRoZSB1c2VyIGNvbnRleHQsIGV2ZW4gaWYgdGhlIHR3byBoYXZlIHRoZSBzYW1l
IGh3X2lkLApiZWNhdXNlIHNpbmNlIGdlbjExIHRoZSBDUyBhbHNvIGNoZWNrcyB0aGUgTFJDQSB3
aGVuIGRlY2lkaW5nIGlmIGl0IGNhbgpsaXRlLXJlc3RvcmUuCgp2MjogbGltaXQgbmV3IGNvbnRl
eHQgdG8gZ2VuMTIrLCByZWxlYXNlIGluIGViX2Rlc3Ryb3ksIGFkZCBhIGNvbW1lbnQKICAgIGlu
IGVtaXRfZmluaV9icmVhZGNydW1iIChDaHJpcykuCgpTdWdnZXN0ZWQtYnk6IENocmlzIFdpbHNv
biA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpTaWduZWQtb2ZmLWJ5OiBEYW5pZWxlIENlcmFv
bG8gU3B1cmlvIDxkYW5pZWxlLmNlcmFvbG9zcHVyaW9AaW50ZWwuY29tPgpDYzogQ2hyaXMgV2ls
c29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0tLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fZXhlY2J1ZmZlci5jICAgIHwgMzAgKysrKysrKysrKysrKysrKysrLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgICAgICAgICAgIHwgMTggKysrKysrKysrKysK
IDIgZmlsZXMgY2hhbmdlZCwgNDcgaW5zZXJ0aW9ucygrKSwgMSBkZWxldGlvbigtKQoKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCmluZGV4IGI1ZjY5
MzczNjllYS4uNDI3MjEwZTMwMWFlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9leGVjYnVmZmVyLmMKQEAgLTI1Miw2ICsyNTIsNyBAQCBzdHJ1Y3QgaTkxNV9leGVj
YnVmZmVyIHsKIAkJYm9vbCBoYXNfZmVuY2UgOiAxOwogCQlib29sIG5lZWRzX3VuZmVuY2VkIDog
MTsKIAorCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAJCXN0cnVjdCBpOTE1X3JlcXVlc3Qg
KnJxOwogCQl1MzIgKnJxX2NtZDsKIAkJdW5zaWduZWQgaW50IHJxX3NpemU7CkBAIC04ODAsNiAr
ODgxLDkgQEAgc3RhdGljIHZvaWQgZWJfZGVzdHJveShjb25zdCBzdHJ1Y3QgaTkxNV9leGVjYnVm
ZmVyICplYikKIHsKIAlHRU1fQlVHX09OKGViLT5yZWxvY19jYWNoZS5ycSk7CiAKKwlpZiAoZWIt
PnJlbG9jX2NhY2hlLmNlKQorCQlpbnRlbF9jb250ZXh0X3B1dChlYi0+cmVsb2NfY2FjaGUuY2Up
OworCiAJaWYgKGViLT5sdXRfc2l6ZSA+IDApCiAJCWtmcmVlKGViLT5idWNrZXRzKTsKIH0KQEAg
LTkwMyw2ICs5MDcsNyBAQCBzdGF0aWMgdm9pZCByZWxvY19jYWNoZV9pbml0KHN0cnVjdCByZWxv
Y19jYWNoZSAqY2FjaGUsCiAJY2FjaGUtPmhhc19mZW5jZSA9IGNhY2hlLT5nZW4gPCA0OwogCWNh
Y2hlLT5uZWVkc191bmZlbmNlZCA9IElOVEVMX0lORk8oaTkxNSktPnVuZmVuY2VkX25lZWRzX2Fs
aWdubWVudDsKIAljYWNoZS0+bm9kZS5hbGxvY2F0ZWQgPSBmYWxzZTsKKwljYWNoZS0+Y2UgPSBO
VUxMOwogCWNhY2hlLT5ycSA9IE5VTEw7CiAJY2FjaGUtPnJxX3NpemUgPSAwOwogfQpAQCAtMTE2
OCw3ICsxMTczLDcgQEAgc3RhdGljIGludCBfX3JlbG9jX2dwdV9hbGxvYyhzdHJ1Y3QgaTkxNV9l
eGVjYnVmZmVyICplYiwKIAlpZiAoZXJyKQogCQlnb3RvIGVycl91bm1hcDsKIAotCXJxID0gaTkx
NV9yZXF1ZXN0X2NyZWF0ZShlYi0+Y29udGV4dCk7CisJcnEgPSBpbnRlbF9jb250ZXh0X2NyZWF0
ZV9yZXF1ZXN0KGNhY2hlLT5jZSk7CiAJaWYgKElTX0VSUihycSkpIHsKIAkJZXJyID0gUFRSX0VS
UihycSk7CiAJCWdvdG8gZXJyX3VucGluOwpAQCAtMTIzOSw2ICsxMjQ0LDI5IEBAIHN0YXRpYyB1
MzIgKnJlbG9jX2dwdShzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYiwKIAkJaWYgKCFpbnRlbF9l
bmdpbmVfY2FuX3N0b3JlX2R3b3JkKGViLT5lbmdpbmUpKQogCQkJcmV0dXJuIEVSUl9QVFIoLUVO
T0RFVik7CiAKKwkJaWYgKCFjYWNoZS0+Y2UpIHsKKwkJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpj
ZTsKKworCQkJLyoKKwkJCSAqIFRoZSBDUyBwcmUtcGFyc2VyIGNhbiBwcmUtZmV0Y2ggY29tbWFu
ZHMgYWNyb3NzCisJCQkgKiBtZW1vcnkgc3luYyBwb2ludHMgYW5kIHN0YXJ0aW5nIGdlbjEyIGl0
IGlzIGFibGUgdG8KKwkJCSAqIHByZS1mZXRjaCBhY3Jvc3MgQkJfU1RBUlQgYW5kIEJCX0VORCBi
b3VuZGFyaWVzCisJCQkgKiAod2l0aGluIHRoZSBzYW1lIGNvbnRleHQpLiBXZSB0aGVyZWZvcmUg
dXNlIGEKKwkJCSAqIHNlcGFyYXRlIGNvbnRleHQgZ2VuMTIrIHRvIGd1YXJhbnRlZSB0aGF0IHRo
ZSByZWxvYworCQkJICogd3JpdGVzIGxhbmQgYmVmb3JlIHRoZSBwYXJzZXIgZ2V0cyB0byB0aGUg
dGFyZ2V0CisJCQkgKiBtZW1vcnkgbG9jYXRpb24uCisJCQkgKi8KKwkJCWlmIChjYWNoZS0+Z2Vu
ID49IDEyKQorCQkJCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZWItPmNvbnRleHQtPmdlbV9j
b250ZXh0LAorCQkJCQkJCSAgZWItPmVuZ2luZSk7CisJCQllbHNlCisJCQkJY2UgPSBpbnRlbF9j
b250ZXh0X2dldChlYi0+Y29udGV4dCk7CisJCQlpZiAoSVNfRVJSKGNlKSkKKwkJCQlyZXR1cm4g
RVJSX0NBU1QoY2UpOworCisJCQljYWNoZS0+Y2UgPSBjZTsKKwkJfQorCiAJCWVyciA9IF9fcmVs
b2NfZ3B1X2FsbG9jKGViLCB2bWEsIGxlbik7CiAJCWlmICh1bmxpa2VseShlcnIpKQogCQkJcmV0
dXJuIEVSUl9QVFIoZXJyKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKaW5kZXggZDQy
NTg0NDM5ZjUxLi4xMmVjMjgzMGJhMjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5j
CkBAIC0yOTAzLDYgKzI5MDMsMjQgQEAgZ2VuOF9lbWl0X2ZpbmlfYnJlYWRjcnVtYl9mb290ZXIo
c3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdCwKIAlyZXR1cm4gZ2VuOF9lbWl0X3dhX3RhaWwo
cmVxdWVzdCwgY3MpOwogfQogCisvKgorICogTm90ZSB0aGF0IHRoZSBDUyBpbnN0cnVjdGlvbiBw
cmUtcGFyc2VyIHdpbGwgbm90IHN0YWxsIG9uIHRoZSBicmVhZGNydW1iCisgKiBmbHVzaCBhbmQg
d2lsbCBjb250aW51ZSBwcmUtZmV0Y2hpbmcgdGhlIGluc3RydWN0aW9ucyBhZnRlciBpdCBiZWZv
cmUgdGhlCisgKiBtZW1vcnkgc3luYyBpcyBjb21wbGV0ZWQuIE9uIHByZS1nZW4xMiBIVywgdGhl
IHByZS1wYXJzZXIgd2lsbCBzdG9wIGF0CisgKiBCQl9TVEFSVC9FTkQgaW5zdHJ1Y3Rpb25zLCBz
bywgZXZlbiB0aG91Z2ggd2UgbWlnaHQgcHJlLWZldGNoIHRoZSBwcmUtYW1ibGUKKyAqIG9mIHRo
ZSBuZXh0IHJlcXVlc3QgYmVmb3JlIHRoZSBtZW1vcnkgaGFzIGJlZW4gZmx1c2hlZCwgd2UncmUg
Z3VhcmFudGVlZCB0aGF0CisgKiB3ZSB3b24ndCBhY2Nlc3MgdGhlIGJhdGNoIGl0c2VsZiB0b28g
ZWFybHkuCisgKiBIb3dldmVyLCBvbiBnZW4xMisgdGhlIHBhcnNlciBjYW4gcHJlLWZldGNoIGFj
cm9zcyB0aGUgQkJfU1RBUlQvRU5EIGNvbW1hbmRzLAorICogc28sIGlmIHRoZSBjdXJyZW50IHJl
cXVlc3QgaXMgbW9kaWZ5aW5nIGFuIGluc3RydWN0aW9uIGluIHRoZSBuZXh0IHJlcXVlc3Qgb24K
KyAqIHRoZSBzYW1lIGludGVsX2NvbnRleHQsIHdlIG1pZ2h0IHByZS1mZXRjaCBhbmQgdGhlbiBl
eGVjdXRlIHRoZSBwcmUtdXBkYXRlCisgKiBpbnN0cnVjdGlvbi4gVG8gYXZvaWQgdGhpcywgdGhl
IHVzZXJzIG9mIHNlbGYtbW9kaWZ5aW5nIGNvZGUgc2hvdWxkIGVpdGhlcgorICogZGlzYWJsZSB0
aGUgcGFyc2VyIGFyb3VuZCB0aGUgY29kZSBlbWl0dGluZyB0aGUgbWVtb3J5IHdyaXRlcywgdmlh
IGEgbmV3IGZsYWcKKyAqIGFkZGVkIHRvIE1JX0FSQl9DSEVDSywgb3IgZW1pdCB0aGUgd3JpdGVz
IGZyb20gYSBkaWZmZXJlbnQgaW50ZWxfY29udGV4dC4gRm9yCisgKiB0aGUgaW4ta2VybmVsIHVz
ZS1jYXNlcyB3ZSd2ZSBvcHRlZCB0byB1c2UgYSBzZXBhcmF0ZSBjb250ZXh0LCBzZWUKKyAqIHJl
bG9jX2dwdSgpIGFzIGFuIGV4YW1wbGUuCisgKiBBbGwgdGhlIGFib3ZlIGFwcGxpZXMgb25seSB0
byB0aGUgaW5zdHJ1Y3Rpb25zIHRoZW1zZWx2ZXMuIE5vbi1pbmxpbmUgZGF0YQorICogdXNlZCBi
eSB0aGUgaW5zdHJ1Y3Rpb25zIGlzIG5vdCBwcmUtZmV0Y2hlZC4KKyAqLwogc3RhdGljIHUzMiAq
Z2VuOF9lbWl0X2ZpbmlfYnJlYWRjcnVtYihzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0LCB1
MzIgKmNzKQogewogCWNzID0gZ2VuOF9lbWl0X2dndHRfd3JpdGUoY3MsCi0tIAoyLjIzLjAKCl9f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBt
YWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3Rz
LmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

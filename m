Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 2CD0CCB92E
	for <lists+intel-gfx@lfdr.de>; Fri,  4 Oct 2019 13:35:28 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6338D6EB35;
	Fri,  4 Oct 2019 11:35:24 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl
 [IPv6:2a02:2308::216:3eff:fe92:dfa3])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0C5B46EB33
 for <intel-gfx@lists.freedesktop.org>; Fri,  4 Oct 2019 11:35:22 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  4 Oct 2019 13:34:55 +0200
Message-Id: <20191004113514.17064-6-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191004113514.17064-1-maarten.lankhorst@linux.intel.com>
References: <20191004113514.17064-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 05/24] drm/i915: Use intel_plane_state in
 prepare and cleanup plane_fb
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgbmVlZCB0byBsb29rIGF0IHRoZSBodyBmYiBpbiB0aGUgcGxhbmUgc3BsaXQsIHNvIHJlcGxh
Y2UgYWxsIHRoZSBwbGFjZXMKdGhhdCB1c2UgZHJtX3BsYW5lX3N0YXRlIHdpdGggaW50ZWxfcGxh
bmVfc3RhdGUuCgpTaWduZWQtb2ZmLWJ5OiBNYWFydGVuIExhbmtob3JzdCA8bWFhcnRlbi5sYW5r
aG9yc3RAbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkv
aW50ZWxfZGlzcGxheS5jIHwgMjggKysrKysrKysrKystLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2Vk
LCAxNiBpbnNlcnRpb25zKCspLCAxMiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4IDllMzRiZTQ4Yzc3MC4uYjVlZDA5N2Q2
YTU5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3Bs
YXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpA
QCAtMTQzODAsMTIgKzE0MzgwLDE0IEBAIHN0YXRpYyB2b2lkIGZiX29ial9idW1wX3JlbmRlcl9w
cmlvcml0eShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogICovCiBpbnQKIGludGVs
X3ByZXBhcmVfcGxhbmVfZmIoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCi0JCSAgICAgICBzdHJ1
Y3QgZHJtX3BsYW5lX3N0YXRlICpuZXdfc3RhdGUpCisJCSAgICAgICBzdHJ1Y3QgZHJtX3BsYW5l
X3N0YXRlICpfbmV3X3BsYW5lX3N0YXRlKQogeworCXN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
bmV3X3BsYW5lX3N0YXRlID0KKwkJdG9faW50ZWxfcGxhbmVfc3RhdGUoX25ld19wbGFuZV9zdGF0
ZSk7CiAJc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqaW50ZWxfc3RhdGUgPQotCQl0b19pbnRl
bF9hdG9taWNfc3RhdGUobmV3X3N0YXRlLT5zdGF0ZSk7CisJCXRvX2ludGVsX2F0b21pY19zdGF0
ZShuZXdfcGxhbmVfc3RhdGUtPmJhc2Uuc3RhdGUpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmRldik7Ci0Jc3RydWN0IGRybV9mcmFtZWJ1ZmZl
ciAqZmIgPSBuZXdfc3RhdGUtPmZiOworCXN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gbmV3
X3BsYW5lX3N0YXRlLT5iYXNlLmZiOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmog
PSBpbnRlbF9mYl9vYmooZmIpOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvbGRfb2Jq
ID0gaW50ZWxfZmJfb2JqKHBsYW5lLT5zdGF0ZS0+ZmIpOwogCWludCByZXQ7CkBAIC0xNDQxNiw5
ICsxNDQxOCw5IEBAIGludGVsX3ByZXBhcmVfcGxhbmVfZmIoc3RydWN0IGRybV9wbGFuZSAqcGxh
bmUsCiAJCX0KIAl9CiAKLQlpZiAobmV3X3N0YXRlLT5mZW5jZSkgeyAvKiBleHBsaWNpdCBmZW5j
aW5nICovCisJaWYgKG5ld19wbGFuZV9zdGF0ZS0+YmFzZS5mZW5jZSkgeyAvKiBleHBsaWNpdCBm
ZW5jaW5nICovCiAJCXJldCA9IGk5MTVfc3dfZmVuY2VfYXdhaXRfZG1hX2ZlbmNlKCZpbnRlbF9z
dGF0ZS0+Y29tbWl0X3JlYWR5LAotCQkJCQkJICAgIG5ld19zdGF0ZS0+ZmVuY2UsCisJCQkJCQkg
ICAgbmV3X3BsYW5lX3N0YXRlLT5iYXNlLmZlbmNlLAogCQkJCQkJICAgIEk5MTVfRkVOQ0VfVElN
RU9VVCwKIAkJCQkJCSAgICBHRlBfS0VSTkVMKTsKIAkJaWYgKHJldCA8IDApCkBAIC0xNDQzOCw3
ICsxNDQ0MCw3IEBAIGludGVsX3ByZXBhcmVfcGxhbmVfZmIoc3RydWN0IGRybV9wbGFuZSAqcGxh
bmUsCiAJCXJldHVybiByZXQ7CiAJfQogCi0JcmV0ID0gaW50ZWxfcGxhbmVfcGluX2ZiKHRvX2lu
dGVsX3BsYW5lX3N0YXRlKG5ld19zdGF0ZSkpOworCXJldCA9IGludGVsX3BsYW5lX3Bpbl9mYihu
ZXdfcGxhbmVfc3RhdGUpOwogCiAJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAJaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKG9iaik7CkBAIC0xNDQ0OCw3ICsx
NDQ1MCw3IEBAIGludGVsX3ByZXBhcmVfcGxhbmVfZmIoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUs
CiAJZmJfb2JqX2J1bXBfcmVuZGVyX3ByaW9yaXR5KG9iaik7CiAJaW50ZWxfZnJvbnRidWZmZXJf
Zmx1c2gob2JqLT5mcm9udGJ1ZmZlciwgT1JJR0lOX0RJUlRZRkIpOwogCi0JaWYgKCFuZXdfc3Rh
dGUtPmZlbmNlKSB7IC8qIGltcGxpY2l0IGZlbmNpbmcgKi8KKwlpZiAoIW5ld19wbGFuZV9zdGF0
ZS0+YmFzZS5mZW5jZSkgeyAvKiBpbXBsaWNpdCBmZW5jaW5nICovCiAJCXN0cnVjdCBkbWFfZmVu
Y2UgKmZlbmNlOwogCiAJCXJldCA9IGk5MTVfc3dfZmVuY2VfYXdhaXRfcmVzZXJ2YXRpb24oJmlu
dGVsX3N0YXRlLT5jb21taXRfcmVhZHksCkBAIC0xNDQ2MCwxMSArMTQ0NjIsMTEgQEAgaW50ZWxf
cHJlcGFyZV9wbGFuZV9mYihzdHJ1Y3QgZHJtX3BsYW5lICpwbGFuZSwKIAogCQlmZW5jZSA9IGRt
YV9yZXN2X2dldF9leGNsX3JjdShvYmotPmJhc2UucmVzdik7CiAJCWlmIChmZW5jZSkgewotCQkJ
YWRkX3Jwc19ib29zdF9hZnRlcl92YmxhbmsobmV3X3N0YXRlLT5jcnRjLCBmZW5jZSk7CisJCQlh
ZGRfcnBzX2Jvb3N0X2FmdGVyX3ZibGFuayhuZXdfcGxhbmVfc3RhdGUtPmJhc2UuY3J0YywgZmVu
Y2UpOwogCQkJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CiAJCX0KIAl9IGVsc2UgewotCQlhZGRfcnBz
X2Jvb3N0X2FmdGVyX3ZibGFuayhuZXdfc3RhdGUtPmNydGMsIG5ld19zdGF0ZS0+ZmVuY2UpOwor
CQlhZGRfcnBzX2Jvb3N0X2FmdGVyX3ZibGFuayhuZXdfcGxhbmVfc3RhdGUtPmJhc2UuY3J0Yywg
bmV3X3BsYW5lX3N0YXRlLT5iYXNlLmZlbmNlKTsKIAl9CiAKIAkvKgpAQCAtMTQ0OTQsMTAgKzE0
NDk2LDEyIEBAIGludGVsX3ByZXBhcmVfcGxhbmVfZmIoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUs
CiAgKi8KIHZvaWQKIGludGVsX2NsZWFudXBfcGxhbmVfZmIoc3RydWN0IGRybV9wbGFuZSAqcGxh
bmUsCi0JCSAgICAgICBzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpvbGRfc3RhdGUpCisJCSAgICAg
ICBzdHJ1Y3QgZHJtX3BsYW5lX3N0YXRlICpfb2xkX3BsYW5lX3N0YXRlKQogeworCXN0cnVjdCBp
bnRlbF9wbGFuZV9zdGF0ZSAqb2xkX3BsYW5lX3N0YXRlID0KKwkJdG9faW50ZWxfcGxhbmVfc3Rh
dGUoX29sZF9wbGFuZV9zdGF0ZSk7CiAJc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqaW50ZWxf
c3RhdGUgPQotCQl0b19pbnRlbF9hdG9taWNfc3RhdGUob2xkX3N0YXRlLT5zdGF0ZSk7CisJCXRv
X2ludGVsX2F0b21pY19zdGF0ZShvbGRfcGxhbmVfc3RhdGUtPmJhc2Uuc3RhdGUpOwogCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUocGxhbmUtPmRldik7CiAKIAlp
ZiAoaW50ZWxfc3RhdGUtPnJwc19pbnRlcmFjdGl2ZSkgewpAQCAtMTQ1MDcsNyArMTQ1MTEsNyBA
QCBpbnRlbF9jbGVhbnVwX3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCiAJLyog
U2hvdWxkIG9ubHkgYmUgY2FsbGVkIGFmdGVyIGEgc3VjY2Vzc2Z1bCBpbnRlbF9wcmVwYXJlX3Bs
YW5lX2ZiKCkhICovCiAJbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwot
CWludGVsX3BsYW5lX3VucGluX2ZiKHRvX2ludGVsX3BsYW5lX3N0YXRlKG9sZF9zdGF0ZSkpOwor
CWludGVsX3BsYW5lX3VucGluX2ZiKG9sZF9wbGFuZV9zdGF0ZSk7CiAJbXV0ZXhfdW5sb2NrKCZk
ZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiB9CiAKLS0gCjIuMjMuMAoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlz
dApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

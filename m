Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3987D10D9C6
	for <lists+intel-gfx@lfdr.de>; Fri, 29 Nov 2019 19:55:08 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9BFAC6EA61;
	Fri, 29 Nov 2019 18:55:05 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga02.intel.com (mga02.intel.com [134.134.136.20])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B736A6EA03
 for <intel-gfx@lists.freedesktop.org>; Fri, 29 Nov 2019 18:55:00 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga007.jf.intel.com ([10.7.209.58])
 by orsmga101.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 29 Nov 2019 10:55:00 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,258,1571727600"; d="scan'208";a="199880360"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by orsmga007.jf.intel.com with SMTP; 29 Nov 2019 10:54:58 -0800
Received: by stinkbox (sSMTP sendmail emulation);
 Fri, 29 Nov 2019 20:54:57 +0200
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 29 Nov 2019 20:54:33 +0200
Message-Id: <20191129185434.25549-9-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191129185434.25549-1-ville.syrjala@linux.intel.com>
References: <20191129185434.25549-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 8/9] drm/i915: Dump both the uapi and hw
 states for crtcs and planes
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KCkxl
dCdzIG1ha2UgdGhlIGRpc3BsYXkgaW5mbyBtb3JlIHVzZWZ1bCBieSBkdW1waW5nIGJvdGgKdGhl
IHVhcGkgYW5kIGh3IHN0YXRlcyBmb3IgZWFjaCBjcnRjL3BsYW5lLgoKU2lnbmVkLW9mZi1ieTog
VmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KLS0tCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyB8IDExNiArKysrKysrKysrKysrKysrKy0t
LS0tLS0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgNzMgaW5zZXJ0aW9ucygrKSwgNDMgZGVsZXRpb25z
KC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwppbmRleCA0ZGZmYmZmMWI4YmQuLjQx
NGRhMGE1NDJkNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2Zz
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKQEAgLTI1NTYsNDUg
KzI1NTYsNjggQEAgc3RhdGljIHZvaWQgcGxhbmVfcm90YXRpb24oY2hhciAqYnVmLCBzaXplX3Qg
YnVmc2l6ZSwgdW5zaWduZWQgaW50IHJvdGF0aW9uKQogCQkgcm90YXRpb24pOwogfQogCitzdGF0
aWMgdm9pZCBpbnRlbF9wbGFuZV91YXBpX2luZm8oc3RydWN0IHNlcV9maWxlICptLCBzdHJ1Y3Qg
aW50ZWxfcGxhbmUgKnBsYW5lKQoreworCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9zdGF0ZSAq
cGxhbmVfc3RhdGUgPQorCQl0b19pbnRlbF9wbGFuZV9zdGF0ZShwbGFuZS0+YmFzZS5zdGF0ZSk7
CisJY29uc3Qgc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+dWFwaS5m
YjsKKwlzdHJ1Y3QgZHJtX2Zvcm1hdF9uYW1lX2J1ZiBmb3JtYXRfbmFtZTsKKwlzdHJ1Y3QgZHJt
X3JlY3Qgc3JjLCBkc3Q7CisJY2hhciByb3Rfc3RyWzQ4XTsKKworCXNyYyA9IGRybV9wbGFuZV9z
dGF0ZV9zcmMoJnBsYW5lX3N0YXRlLT51YXBpKTsKKwlkc3QgPSBkcm1fcGxhbmVfc3RhdGVfZGVz
dCgmcGxhbmVfc3RhdGUtPnVhcGkpOworCisJaWYgKGZiKQorCQlkcm1fZ2V0X2Zvcm1hdF9uYW1l
KGZiLT5mb3JtYXQtPmZvcm1hdCwgJmZvcm1hdF9uYW1lKTsKKworCXBsYW5lX3JvdGF0aW9uKHJv
dF9zdHIsIHNpemVvZihyb3Rfc3RyKSwKKwkJICAgICAgIHBsYW5lX3N0YXRlLT51YXBpLnJvdGF0
aW9uKTsKKworCXNlcV9wcmludGYobSwgIlx0XHR1YXBpOiBmYj0lZCwlcywlZHglZCwgc3JjPSIg
RFJNX1JFQ1RfRlBfRk1UICIsIGRzdD0iIERSTV9SRUNUX0ZNVCAiLCByb3RhdGlvbj0lc1xuIiwK
KwkJICAgZmIgPyBmYi0+YmFzZS5pZCA6IDAsIGZiID8gZm9ybWF0X25hbWUuc3RyIDogIm4vYSIs
CisJCSAgIGZiID8gZmItPndpZHRoIDogMCwgZmIgPyBmYi0+aGVpZ2h0IDogMCwKKwkJICAgRFJN
X1JFQ1RfRlBfQVJHKCZzcmMpLAorCQkgICBEUk1fUkVDVF9BUkcoJmRzdCksCisJCSAgIHJvdF9z
dHIpOworfQorCitzdGF0aWMgdm9pZCBpbnRlbF9wbGFuZV9od19pbmZvKHN0cnVjdCBzZXFfZmls
ZSAqbSwgc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSkKK3sKKwljb25zdCBzdHJ1Y3QgaW50ZWxf
cGxhbmVfc3RhdGUgKnBsYW5lX3N0YXRlID0KKwkJdG9faW50ZWxfcGxhbmVfc3RhdGUocGxhbmUt
PmJhc2Uuc3RhdGUpOworCWNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiID0gcGxhbmVf
c3RhdGUtPmh3LmZiOworCXN0cnVjdCBkcm1fZm9ybWF0X25hbWVfYnVmIGZvcm1hdF9uYW1lOwor
CWNoYXIgcm90X3N0cls0OF07CisKKwlpZiAoIWZiKQorCQlyZXR1cm47CisKKwlkcm1fZ2V0X2Zv
cm1hdF9uYW1lKGZiLT5mb3JtYXQtPmZvcm1hdCwgJmZvcm1hdF9uYW1lKTsKKworCXBsYW5lX3Jv
dGF0aW9uKHJvdF9zdHIsIHNpemVvZihyb3Rfc3RyKSwKKwkJICAgICAgIHBsYW5lX3N0YXRlLT5o
dy5yb3RhdGlvbik7CisKKwlzZXFfcHJpbnRmKG0sICJcdFx0aHc6IGZiPSVkLCVzLCVkeCVkLCB2
aXNpYmxlPSVzLCBzcmM9IiBEUk1fUkVDVF9GUF9GTVQgIiwgZHN0PSIgRFJNX1JFQ1RfRk1UICIs
IHJvdGF0aW9uPSVzXG4iLAorCQkgICBmYiA/IGZiLT5iYXNlLmlkIDogMCwgZmIgPyBmb3JtYXRf
bmFtZS5zdHIgOiAibi9hIiwKKwkJICAgZmIgPyBmYi0+d2lkdGggOiAwLCBmYiA/IGZiLT5oZWln
aHQgOiAwLAorCQkgICB5ZXNubyhwbGFuZV9zdGF0ZS0+dWFwaS52aXNpYmxlKSwKKwkJICAgRFJN
X1JFQ1RfRlBfQVJHKCZwbGFuZV9zdGF0ZS0+dWFwaS5zcmMpLAorCQkgICBEUk1fUkVDVF9BUkco
JnBsYW5lX3N0YXRlLT51YXBpLmRzdCksCisJCSAgIHJvdF9zdHIpOworfQorCiBzdGF0aWMgdm9p
ZCBpbnRlbF9wbGFuZV9pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgc3RydWN0IGludGVsX2NydGMg
KmNydGMpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19p
OTE1KG0tPnByaXZhdGUpOwotCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSAmZGV2X3ByaXYtPmRy
bTsKIAlzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lOwogCi0JZm9yX2VhY2hfaW50ZWxfcGxhbmVf
b25fY3J0YyhkZXYsIGNydGMsIHBsYW5lKSB7Ci0JCWNvbnN0IHN0cnVjdCBpbnRlbF9wbGFuZV9z
dGF0ZSAqcGxhbmVfc3RhdGUgPQotCQkJdG9faW50ZWxfcGxhbmVfc3RhdGUocGxhbmUtPmJhc2Uu
c3RhdGUpOwotCQljb25zdCBzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYjsKLQkJc3RydWN0IGRy
bV9mb3JtYXRfbmFtZV9idWYgZm9ybWF0X25hbWU7Ci0JCXN0cnVjdCBkcm1fcmVjdCBzcmMsIGRz
dDsKLQkJY2hhciByb3Rfc3RyWzQ4XTsKLQotCQlpZiAoIXBsYW5lX3N0YXRlKSB7Ci0JCQlzZXFf
cHV0cyhtLCAicGxhbmUtPnN0YXRlIGlzIE5VTEwhXG4iKTsKLQkJCWNvbnRpbnVlOwotCQl9Ci0K
LQkJc3JjID0gZHJtX3BsYW5lX3N0YXRlX3NyYygmcGxhbmVfc3RhdGUtPnVhcGkpOwotCQlkc3Qg
PSBkcm1fcGxhbmVfc3RhdGVfZGVzdCgmcGxhbmVfc3RhdGUtPnVhcGkpOwotCi0JCWZiID0gcGxh
bmVfc3RhdGUtPnVhcGkuZmI7Ci0JCWlmIChmYikKLQkJCWRybV9nZXRfZm9ybWF0X25hbWUoZmIt
PmZvcm1hdC0+Zm9ybWF0LCAmZm9ybWF0X25hbWUpOwotCi0JCXBsYW5lX3JvdGF0aW9uKHJvdF9z
dHIsIHNpemVvZihyb3Rfc3RyKSwKLQkJCSAgICAgICBwbGFuZV9zdGF0ZS0+dWFwaS5yb3RhdGlv
bik7Ci0KLQkJc2VxX3ByaW50ZihtLCAiXHRbUExBTkU6JWQ6JXNdOiB0eXBlPSVzLCBmYj0lZCwl
cywlZHglZCwgc3JjPSIgRFJNX1JFQ1RfRlBfRk1UICIsIGRzdD0iIERSTV9SRUNUX0ZNVCAiLCBy
b3RhdGlvbj0lc1xuIiwKKwlmb3JfZWFjaF9pbnRlbF9wbGFuZV9vbl9jcnRjKCZkZXZfcHJpdi0+
ZHJtLCBjcnRjLCBwbGFuZSkgeworCQlzZXFfcHJpbnRmKG0sICJcdFtQTEFORTolZDolc106IHR5
cGU9JXNcbiIsCiAJCQkgICBwbGFuZS0+YmFzZS5iYXNlLmlkLCBwbGFuZS0+YmFzZS5uYW1lLAot
CQkJICAgcGxhbmVfdHlwZShwbGFuZS0+YmFzZS50eXBlKSwKLQkJCSAgIGZiID8gZmItPmJhc2Uu
aWQgOiAwLAotCQkJICAgZmIgPyBmb3JtYXRfbmFtZS5zdHIgOiAibi9hIiwKLQkJCSAgIGZiID8g
ZmItPndpZHRoIDogMCwKLQkJCSAgIGZiID8gZmItPmhlaWdodCA6IDAsCi0JCQkgICBEUk1fUkVD
VF9GUF9BUkcoJnNyYyksCi0JCQkgICBEUk1fUkVDVF9BUkcoJmRzdCksCi0JCQkgICByb3Rfc3Ry
KTsKKwkJCSAgIHBsYW5lX3R5cGUocGxhbmUtPmJhc2UudHlwZSkpOworCQlpbnRlbF9wbGFuZV91
YXBpX2luZm8obSwgcGxhbmUpOworCQlpbnRlbF9wbGFuZV9od19pbmZvKG0sIHBsYW5lKTsKIAl9
CiB9CiAKQEAgLTI2MzEsMjYgKzI2NTQsMzMgQEAgc3RhdGljIHZvaWQgaW50ZWxfY3J0Y19pbmZv
KHN0cnVjdCBzZXFfZmlsZSAqbSwgc3RydWN0IGludGVsX2NydGMgKmNydGMpCiAJY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUgPQogCQl0b19pbnRlbF9jcnRjX3N0YXRl
KGNydGMtPmJhc2Uuc3RhdGUpOwogCi0Jc2VxX3ByaW50ZihtLCAiW0NSVEM6JWQ6JXNdOiBhY3Rp
dmU9JXMsIChzaXplPSVkeCVkKSwgZGl0aGVyPSVzLCBicHA9JWRcbiIsCi0JCSAgIGNydGMtPmJh
c2UuYmFzZS5pZCwgY3J0Yy0+YmFzZS5uYW1lLAotCQkgICB5ZXNubyhjcnRjX3N0YXRlLT5ody5h
Y3RpdmUpLAotCQkgICBjcnRjX3N0YXRlLT5waXBlX3NyY193LCBjcnRjX3N0YXRlLT5waXBlX3Ny
Y19oLAotCQkgICB5ZXNubyhjcnRjX3N0YXRlLT5kaXRoZXIpLCBjcnRjX3N0YXRlLT5waXBlX2Jw
cCk7CisJc2VxX3ByaW50ZihtLCAiW0NSVEM6JWQ6JXNdOlxuIiwKKwkJICAgY3J0Yy0+YmFzZS5i
YXNlLmlkLCBjcnRjLT5iYXNlLm5hbWUpOwogCi0JaWYgKGNydGNfc3RhdGUtPmh3LmFjdGl2ZSkg
ewotCQljb25zdCBzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqbW9kZSA9Ci0JCQkmY3J0Y19zdGF0
ZS0+aHcubW9kZTsKKwlzZXFfcHJpbnRmKG0sICJcdHVhcGk6IGVuYWJsZT0lcywgYWN0aXZlPSVz
LCBtb2RlPSIgRFJNX01PREVfRk1UICJcbiIsCisJCSAgIHllc25vKGNydGNfc3RhdGUtPnVhcGku
ZW5hYmxlKSwKKwkJICAgeWVzbm8oY3J0Y19zdGF0ZS0+dWFwaS5hY3RpdmUpLAorCQkgICBEUk1f
TU9ERV9BUkcoJmNydGNfc3RhdGUtPnVhcGkubW9kZSkpOworCisJaWYgKGNydGNfc3RhdGUtPmh3
LmVuYWJsZSkgewogCQlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcjsKIAotCQlzZXFfcHJp
bnRmKG0sICJcdG1vZGU6ICIgRFJNX01PREVfRk1UICJcbiIsIERSTV9NT0RFX0FSRyhtb2RlKSk7
CisJCXNlcV9wcmludGYobSwgIlx0aHc6IGFjdGl2ZT0lcywgYWRqdXN0ZWRfbW9kZT0iIERSTV9N
T0RFX0ZNVCAiXG4iLAorCQkJICAgeWVzbm8oY3J0Y19zdGF0ZS0+aHcuYWN0aXZlKSwKKwkJCSAg
IERSTV9NT0RFX0FSRygmY3J0Y19zdGF0ZS0+aHcuYWRqdXN0ZWRfbW9kZSkpOworCisJCXNlcV9w
cmludGYobSwgIlx0cGlwZSBzcmMgc2l6ZT0lZHglZCwgZGl0aGVyPSVzLCBicHA9JWRcbiIsCisJ
CQkgICBjcnRjX3N0YXRlLT5waXBlX3NyY193LCBjcnRjX3N0YXRlLT5waXBlX3NyY19oLAorCQkJ
ICAgeWVzbm8oY3J0Y19zdGF0ZS0+ZGl0aGVyKSwgY3J0Y19zdGF0ZS0+cGlwZV9icHApOwogCiAJ
CWZvcl9lYWNoX2VuY29kZXJfb25fY3J0YygmZGV2X3ByaXYtPmRybSwgJmNydGMtPmJhc2UsIGVu
Y29kZXIpCiAJCQlpbnRlbF9lbmNvZGVyX2luZm8obSwgY3J0YywgZW5jb2Rlcik7CiAKIAkJaW50
ZWxfc2NhbGVyX2luZm8obSwgY3J0Yyk7Ci0JCWludGVsX3BsYW5lX2luZm8obSwgY3J0Yyk7CiAJ
fQogCisJaW50ZWxfcGxhbmVfaW5mbyhtLCBjcnRjKTsKKwogCXNlcV9wcmludGYobSwgIlx0dW5k
ZXJydW4gcmVwb3J0aW5nOiBjcHU9JXMgcGNoPSVzXG4iLAogCQkgICB5ZXNubyghY3J0Yy0+Y3B1
X2ZpZm9fdW5kZXJydW5fZGlzYWJsZWQpLAogCQkgICB5ZXNubyghY3J0Yy0+cGNoX2ZpZm9fdW5k
ZXJydW5fZGlzYWJsZWQpKTsKLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlz
dHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4v
bGlzdGluZm8vaW50ZWwtZ2Z4

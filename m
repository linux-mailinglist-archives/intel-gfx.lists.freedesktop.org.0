Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 889A666A35
	for <lists+intel-gfx@lfdr.de>; Fri, 12 Jul 2019 11:43:37 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8DD116E33B;
	Fri, 12 Jul 2019 09:43:34 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8BE226E33B
 for <intel-gfx@lists.freedesktop.org>; Fri, 12 Jul 2019 09:43:31 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17243562-1500050 
 for <intel-gfx@lists.freedesktop.org>; Fri, 12 Jul 2019 10:43:27 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 12 Jul 2019 10:43:26 +0100
Message-Id: <20190712094327.24437-5-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190712094327.24437-1-chris@chris-wilson.co.uk>
References: <20190712094327.24437-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 5/6] drm/i915/gtt: Convert vm->scratch into an array
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RWFjaCBsZXZlbCBoYXMgaXRzIG93biBzY3JhdGNoLiBNYWtlIHRoZSBsZXZlbHMgbW9yZSBvYnZp
b3VzIGJ5IGZvcmdvaW5nCnRoZSBmYW5jeSBzaW1pbGFybHkgbmFtZXMgYW5kIHJlcGxhY2UgdGhl
bSB3aXRoIGEgbnVtYmVyLiAwIGlzIHRoZSBib3R0b20KbW9zdCBsZXZlbCwgdGhlIHBoeXNpY2Fs
IHBhZ2UgdXNlZCBmb3IgYWN0dWFsIGRhdGE7IDErIGFyZSB0aGUgcGFnZQpkaXJlY3Rvcmllcy4K
ClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpS
ZXZpZXdlZC1ieTogTWlrYSBLdW9wcGFsYSA8bWlrYS5rdW9wcGFsYUBsaW51eC5pbnRlbC5jb20+
Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMgfCAyMDUgKysrKysrKysr
KysrLS0tLS0tLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0Lmgg
fCAgMTYgKystCiAyIGZpbGVzIGNoYW5nZWQsIDEwMCBpbnNlcnRpb25zKCspLCAxMjEgZGVsZXRp
b25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwppbmRleCAxYTYwNDAzZTFhNzAu
LjE2YmNmMjE2M2FlMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1f
Z3R0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKQEAgLTYzMyw3
ICs2MzMsNyBAQCBzZXR1cF9zY3JhdGNoX3BhZ2Uoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAq
dm0sIGdmcF90IGdmcCkKIAlnZnAgfD0gX19HRlBfWkVSTyB8IF9fR0ZQX1JFVFJZX01BWUZBSUw7
CiAKIAlkbyB7Ci0JCWludCBvcmRlciA9IGdldF9vcmRlcihzaXplKTsKKwkJdW5zaWduZWQgaW50
IG9yZGVyID0gZ2V0X29yZGVyKHNpemUpOwogCQlzdHJ1Y3QgcGFnZSAqcGFnZTsKIAkJZG1hX2Fk
ZHJfdCBhZGRyOwogCkBAIC02NTIsOCArNjUyLDggQEAgc2V0dXBfc2NyYXRjaF9wYWdlKHN0cnVj
dCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLCBnZnBfdCBnZnApCiAJCWlmICh1bmxpa2VseSghSVNf
QUxJR05FRChhZGRyLCBzaXplKSkpCiAJCQlnb3RvIHVubWFwX3BhZ2U7CiAKLQkJdm0tPnNjcmF0
Y2hfcGFnZS5wYWdlID0gcGFnZTsKLQkJdm0tPnNjcmF0Y2hfcGFnZS5kYWRkciA9IGFkZHI7CisJ
CXZtLT5zY3JhdGNoWzBdLmJhc2UucGFnZSA9IHBhZ2U7CisJCXZtLT5zY3JhdGNoWzBdLmJhc2Uu
ZGFkZHIgPSBhZGRyOwogCQl2bS0+c2NyYXRjaF9vcmRlciA9IG9yZGVyOwogCQlyZXR1cm4gMDsK
IApAQCAtNjcyLDggKzY3Miw4IEBAIHNldHVwX3NjcmF0Y2hfcGFnZShzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlICp2bSwgZ2ZwX3QgZ2ZwKQogCiBzdGF0aWMgdm9pZCBjbGVhbnVwX3NjcmF0Y2hf
cGFnZShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIHsKLQlzdHJ1Y3QgaTkxNV9wYWdl
X2RtYSAqcCA9ICZ2bS0+c2NyYXRjaF9wYWdlOwotCWludCBvcmRlciA9IHZtLT5zY3JhdGNoX29y
ZGVyOworCXN0cnVjdCBpOTE1X3BhZ2VfZG1hICpwID0gcHhfYmFzZSgmdm0tPnNjcmF0Y2hbMF0p
OworCXVuc2lnbmVkIGludCBvcmRlciA9IHZtLT5zY3JhdGNoX29yZGVyOwogCiAJZG1hX3VubWFw
X3BhZ2Uodm0tPmRtYSwgcC0+ZGFkZHIsIEJJVChvcmRlcikgPDwgUEFHRV9TSElGVCwKIAkJICAg
ICAgIFBDSV9ETUFfQklESVJFQ1RJT05BTCk7CkBAIC02ODIsMTUgKzY4MiwxNiBAQCBzdGF0aWMg
dm9pZCBjbGVhbnVwX3NjcmF0Y2hfcGFnZShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkK
IAogc3RhdGljIHZvaWQgZnJlZV9zY3JhdGNoKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZt
KQogewotCWlmICghdm0tPnNjcmF0Y2hfcGFnZS5kYWRkcikgLyogc2V0IHRvIDAgb24gY2xvbmVz
ICovCisJaW50IGk7CisKKwlpZiAoIXB4X2RtYSgmdm0tPnNjcmF0Y2hbMF0pKSAvKiBzZXQgdG8g
MCBvbiBjbG9uZXMgKi8KIAkJcmV0dXJuOwogCi0JaWYgKHZtLT5zY3JhdGNoX3BkcC5kYWRkcikK
LQkJY2xlYW51cF9wYWdlX2RtYSh2bSwgJnZtLT5zY3JhdGNoX3BkcCk7Ci0JaWYgKHZtLT5zY3Jh
dGNoX3BkLmRhZGRyKQotCQljbGVhbnVwX3BhZ2VfZG1hKHZtLCAmdm0tPnNjcmF0Y2hfcGQpOwot
CWlmICh2bS0+c2NyYXRjaF9wdC5kYWRkcikKLQkJY2xlYW51cF9wYWdlX2RtYSh2bSwgJnZtLT5z
Y3JhdGNoX3B0KTsKKwlmb3IgKGkgPSAxOyBpIDw9IHZtLT50b3A7IGkrKykgeworCQlpZiAoIXB4
X2RtYSgmdm0tPnNjcmF0Y2hbaV0pKQorCQkJYnJlYWs7CisJCWNsZWFudXBfcGFnZV9kbWEodm0s
IHB4X2Jhc2UoJnZtLT5zY3JhdGNoW2ldKSk7CisJfQogCiAJY2xlYW51cF9zY3JhdGNoX3BhZ2Uo
dm0pOwogfQpAQCAtNzUyLDkgKzc1Myw5IEBAIHN0YXRpYyB2b2lkIGZyZWVfcGQoc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqdm0sIHN0cnVjdCBpOTE1X3BhZ2VfZG1hICpwZCkKICNkZWZpbmUg
ZnJlZV9weCh2bSwgcHgpIGZyZWVfcGQodm0sIHB4X2Jhc2UocHgpKQogCiBzdGF0aWMgdm9pZCBp
bml0X3BkKHN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICpwZCwKLQkJICAgIHN0cnVjdCBpOTE1
X3BhZ2VfZG1hICpzY3JhdGNoKQorCQkgICAgc3RydWN0IGk5MTVfcGFnZV9zY3JhdGNoICpzY3Jh
dGNoKQogewotCWZpbGxfcHgocGQsIGdlbjhfcGRlX2VuY29kZShzY3JhdGNoLT5kYWRkciwgSTkx
NV9DQUNIRV9MTEMpKTsKKwlmaWxsX3B4KHBkLCBzY3JhdGNoLT5lbmNvZGUpOwogCW1lbXNldF9w
KHBkLT5lbnRyeSwgc2NyYXRjaCwgNTEyKTsKIH0KIApAQCAtNzgyLDMwICs3ODMsMjYgQEAgX19z
ZXRfcGRfZW50cnkoc3RydWN0IGk5MTVfcGFnZV9kaXJlY3RvcnkgKiBjb25zdCBwZCwKIAl3cml0
ZV9kbWFfZW50cnkocHhfYmFzZShwZCksIHBkZSwgZW5jb2RlKHRvLT5kYWRkciwgSTkxNV9DQUNI
RV9MTEMpKTsKIH0KIAorI2RlZmluZSBzZXRfcGRfZW50cnkocGQsIHBkZSwgdG8pIFwKKwlfX3Nl
dF9wZF9lbnRyeSgocGQpLCAocGRlKSwgcHhfYmFzZSh0byksIGdlbjhfcGRlX2VuY29kZSkKKwog
c3RhdGljIGlubGluZSB2b2lkCi1fX2NsZWFyX3BkX2VudHJ5KHN0cnVjdCBpOTE1X3BhZ2VfZGly
ZWN0b3J5ICogY29uc3QgcGQsCi0JCSBjb25zdCB1bnNpZ25lZCBzaG9ydCBwZGUsCi0JCSBzdHJ1
Y3QgaTkxNV9wYWdlX2RtYSAqIGNvbnN0IHRvLAotCQkgdTY0ICgqZW5jb2RlKShjb25zdCBkbWFf
YWRkcl90LCBjb25zdCBlbnVtIGk5MTVfY2FjaGVfbGV2ZWwpKQorY2xlYXJfcGRfZW50cnkoc3Ry
dWN0IGk5MTVfcGFnZV9kaXJlY3RvcnkgKiBjb25zdCBwZCwKKwkgICAgICAgY29uc3QgdW5zaWdu
ZWQgc2hvcnQgcGRlLAorCSAgICAgICBzdHJ1Y3QgaTkxNV9wYWdlX3NjcmF0Y2ggKiBjb25zdCBz
Y3JhdGNoKQogewogCUdFTV9CVUdfT04oYXRvbWljX3JlYWQocHhfdXNlZChwZCkpID09IDApOwog
Ci0Jd3JpdGVfZG1hX2VudHJ5KHB4X2Jhc2UocGQpLCBwZGUsIGVuY29kZSh0by0+ZGFkZHIsIEk5
MTVfQ0FDSEVfTExDKSk7Ci0JcGQtPmVudHJ5W3BkZV0gPSB0bzsKKwl3cml0ZV9kbWFfZW50cnko
cHhfYmFzZShwZCksIHBkZSwgc2NyYXRjaC0+ZW5jb2RlKTsKKwlwZC0+ZW50cnlbcGRlXSA9IHNj
cmF0Y2g7CiAJYXRvbWljX2RlYyhweF91c2VkKHBkKSk7CiB9CiAKLSNkZWZpbmUgc2V0X3BkX2Vu
dHJ5KHBkLCBwZGUsIHRvKSBcCi0JX19zZXRfcGRfZW50cnkoKHBkKSwgKHBkZSksIHB4X2Jhc2Uo
dG8pLCBnZW44X3BkZV9lbmNvZGUpCi0KLSNkZWZpbmUgY2xlYXJfcGRfZW50cnkocGQsIHBkZSwg
dG8pIFwKLQlfX2NsZWFyX3BkX2VudHJ5KChwZCksIChwZGUpLCAodG8pLCBnZW44X3BkZV9lbmNv
ZGUpCi0KIHN0YXRpYyBib29sCiByZWxlYXNlX3BkX2VudHJ5KHN0cnVjdCBpOTE1X3BhZ2VfZGly
ZWN0b3J5ICogY29uc3QgcGQsCiAJCSBjb25zdCB1bnNpZ25lZCBzaG9ydCBwZGUsCiAJCSBzdHJ1
Y3QgaTkxNV9wYWdlX3RhYmxlICogY29uc3QgcHQsCi0JCSBzdHJ1Y3QgaTkxNV9wYWdlX2RtYSAq
IGNvbnN0IHNjcmF0Y2gpCisJCSBzdHJ1Y3QgaTkxNV9wYWdlX3NjcmF0Y2ggKiBjb25zdCBzY3Jh
dGNoKQogewogCWJvb2wgZnJlZSA9IGZhbHNlOwogCkBAIC05MTUsNyArOTEyLDcgQEAgc3RhdGlj
IHZvaWQgZ2VuOF9mcmVlX3BhZ2VfdGFibGVzKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZt
LAogCWludCBpOwogCiAJZm9yIChpID0gMDsgaSA8IEk5MTVfUERFUzsgaSsrKSB7Ci0JCWlmIChw
ZC0+ZW50cnlbaV0gIT0gJnZtLT5zY3JhdGNoX3B0KQorCQlpZiAocGQtPmVudHJ5W2ldICE9ICZ2
bS0+c2NyYXRjaFsxXSkKIAkJCWZyZWVfcGQodm0sIHBkLT5lbnRyeVtpXSk7CiAJfQogfQpAQCAt
OTI3LDcgKzkyNCw3IEBAIHN0YXRpYyB2b2lkIGdlbjhfcHBndHRfY2xlYW51cF8zbHZsKHN0cnVj
dCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCWludCBpOwogCiAJZm9yIChpID0gMDsgaSA8IHBk
cGVzOyBpKyspIHsKLQkJaWYgKHBkcC0+ZW50cnlbaV0gPT0gJnZtLT5zY3JhdGNoX3BkKQorCQlp
ZiAocGRwLT5lbnRyeVtpXSA9PSAmdm0tPnNjcmF0Y2hbMl0pCiAJCQljb250aW51ZTsKIAogCQln
ZW44X2ZyZWVfcGFnZV90YWJsZXModm0sIHBkcC0+ZW50cnlbaV0pOwpAQCAtOTQ1LDcgKzk0Miw3
IEBAIHN0YXRpYyB2b2lkIGdlbjhfcHBndHRfY2xlYW51cF80bHZsKHN0cnVjdCBpOTE1X3BwZ3R0
ICpwcGd0dCkKIAlmb3IgKGkgPSAwOyBpIDwgR0VOOF9QTUw0RVNfUEVSX1BNTDQ7IGkrKykgewog
CQlzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVjdG9yeSAqcGRwID0gaTkxNV9wZHBfZW50cnkocG1sNCwg
aSk7CiAKLQkJaWYgKHB4X2Jhc2UocGRwKSA9PSAmcHBndHQtPnZtLnNjcmF0Y2hfcGRwKQorCQlp
ZiAocHhfYmFzZShwZHApID09IHB4X2Jhc2UoJnBwZ3R0LT52bS5zY3JhdGNoWzNdKSkKIAkJCWNv
bnRpbnVlOwogCiAJCWdlbjhfcHBndHRfY2xlYW51cF8zbHZsKCZwcGd0dC0+dm0sIHBkcCk7CkBA
IC05ODEsNyArOTc4LDkgQEAgc3RhdGljIHZvaWQgZ2VuOF9wcGd0dF9jbGVhcl9wdChjb25zdCBz
dHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAlnZW44X3B0ZV90ICp2YWRkcjsKIAogCXZh
ZGRyID0ga21hcF9hdG9taWNfcHgocHQpOwotCW1lbXNldDY0KHZhZGRyICsgZ2VuOF9wdGVfaW5k
ZXgoc3RhcnQpLCB2bS0+c2NyYXRjaF9wdGUsIG51bV9lbnRyaWVzKTsKKwltZW1zZXQ2NCh2YWRk
ciArIGdlbjhfcHRlX2luZGV4KHN0YXJ0KSwKKwkJIHZtLT5zY3JhdGNoWzBdLmVuY29kZSwKKwkJ
IG51bV9lbnRyaWVzKTsKIAlrdW5tYXBfYXRvbWljKHZhZGRyKTsKIAogCUdFTV9CVUdfT04obnVt
X2VudHJpZXMgPiBhdG9taWNfcmVhZCgmcHQtPnVzZWQpKTsKQEAgLTk5NywxMSArOTk2LDExIEBA
IHN0YXRpYyB2b2lkIGdlbjhfcHBndHRfY2xlYXJfcGQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZSAqdm0sCiAJdTMyIHBkZTsKIAogCWdlbjhfZm9yX2VhY2hfcGRlKHB0LCBwZCwgc3RhcnQsIGxl
bmd0aCwgcGRlKSB7Ci0JCUdFTV9CVUdfT04ocHhfYmFzZShwdCkgPT0gJnZtLT5zY3JhdGNoX3B0
KTsKKwkJR0VNX0JVR19PTihweF9iYXNlKHB0KSA9PSBweF9iYXNlKCZ2bS0+c2NyYXRjaFsxXSkp
OwogCiAJCWF0b21pY19pbmMoJnB0LT51c2VkKTsKIAkJZ2VuOF9wcGd0dF9jbGVhcl9wdCh2bSwg
cHQsIHN0YXJ0LCBsZW5ndGgpOwotCQlpZiAocmVsZWFzZV9wZF9lbnRyeShwZCwgcGRlLCBwdCwg
JnZtLT5zY3JhdGNoX3B0KSkKKwkJaWYgKHJlbGVhc2VfcGRfZW50cnkocGQsIHBkZSwgcHQsICZ2
bS0+c2NyYXRjaFsxXSkpCiAJCQlmcmVlX3B4KHZtLCBwdCk7CiAJfQogfQpAQCAtMTAxNywxMSAr
MTAxNiwxMSBAQCBzdGF0aWMgdm9pZCBnZW44X3BwZ3R0X2NsZWFyX3BkcChzdHJ1Y3QgaTkxNV9h
ZGRyZXNzX3NwYWNlICp2bSwKIAl1bnNpZ25lZCBpbnQgcGRwZTsKIAogCWdlbjhfZm9yX2VhY2hf
cGRwZShwZCwgcGRwLCBzdGFydCwgbGVuZ3RoLCBwZHBlKSB7Ci0JCUdFTV9CVUdfT04ocHhfYmFz
ZShwZCkgPT0gJnZtLT5zY3JhdGNoX3BkKTsKKwkJR0VNX0JVR19PTihweF9iYXNlKHBkKSA9PSBw
eF9iYXNlKCZ2bS0+c2NyYXRjaFsyXSkpOwogCiAJCWF0b21pY19pbmMocHhfdXNlZChwZCkpOwog
CQlnZW44X3BwZ3R0X2NsZWFyX3BkKHZtLCBwZCwgc3RhcnQsIGxlbmd0aCk7Ci0JCWlmIChyZWxl
YXNlX3BkX2VudHJ5KHBkcCwgcGRwZSwgJnBkLT5wdCwgJnZtLT5zY3JhdGNoX3BkKSkKKwkJaWYg
KHJlbGVhc2VfcGRfZW50cnkocGRwLCBwZHBlLCAmcGQtPnB0LCAmdm0tPnNjcmF0Y2hbMl0pKQog
CQkJZnJlZV9weCh2bSwgcGQpOwogCX0KIH0KQEAgLTEwNDcsMTYgKzEwNDYsMTUgQEAgc3RhdGlj
IHZvaWQgZ2VuOF9wcGd0dF9jbGVhcl80bHZsKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZt
LAogCUdFTV9CVUdfT04oIWk5MTVfdm1faXNfNGx2bCh2bSkpOwogCiAJZ2VuOF9mb3JfZWFjaF9w
bWw0ZShwZHAsIHBtbDQsIHN0YXJ0LCBsZW5ndGgsIHBtbDRlKSB7Ci0JCUdFTV9CVUdfT04ocHhf
YmFzZShwZHApID09ICZ2bS0+c2NyYXRjaF9wZHApOworCQlHRU1fQlVHX09OKHB4X2Jhc2UocGRw
KSA9PSBweF9iYXNlKCZ2bS0+c2NyYXRjaFszXSkpOwogCiAJCWF0b21pY19pbmMocHhfdXNlZChw
ZHApKTsKIAkJZ2VuOF9wcGd0dF9jbGVhcl9wZHAodm0sIHBkcCwgc3RhcnQsIGxlbmd0aCk7Ci0J
CWlmIChyZWxlYXNlX3BkX2VudHJ5KHBtbDQsIHBtbDRlLCAmcGRwLT5wdCwgJnZtLT5zY3JhdGNo
X3BkcCkpCisJCWlmIChyZWxlYXNlX3BkX2VudHJ5KHBtbDQsIHBtbDRlLCAmcGRwLT5wdCwgJnZt
LT5zY3JhdGNoWzNdKSkKIAkJCWZyZWVfcHgodm0sIHBkcCk7CiAJfQogfQogCi0KIHN0YXRpYyBp
bnQgZ2VuOF9wcGd0dF9hbGxvY19wZChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAkJ
CSAgICAgICBzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVjdG9yeSAqcGQsCiAJCQkgICAgICAgdTY0IHN0
YXJ0LCB1NjQgbGVuZ3RoKQpAQCAtMTA3MCw3ICsxMDY4LDcgQEAgc3RhdGljIGludCBnZW44X3Bw
Z3R0X2FsbG9jX3BkKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCWdlbjhfZm9yX2Vh
Y2hfcGRlKHB0LCBwZCwgc3RhcnQsIGxlbmd0aCwgcGRlKSB7CiAJCWNvbnN0IGludCBjb3VudCA9
IGdlbjhfcHRlX2NvdW50KHN0YXJ0LCBsZW5ndGgpOwogCi0JCWlmIChweF9iYXNlKHB0KSA9PSAm
dm0tPnNjcmF0Y2hfcHQpIHsKKwkJaWYgKHB4X2Jhc2UocHQpID09IHB4X2Jhc2UoJnZtLT5zY3Jh
dGNoWzFdKSkgewogCQkJc3Bpbl91bmxvY2soJnBkLT5sb2NrKTsKIAogCQkJcHQgPSBmZXRjaF9h
bmRfemVybygmYWxsb2MpOwpAQCAtMTA4MiwxMCArMTA4MCwxMCBAQCBzdGF0aWMgaW50IGdlbjhf
cHBndHRfYWxsb2NfcGQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJCQl9CiAKIAkJ
CWlmIChjb3VudCA8IEdFTjhfUFRFUyB8fCBpbnRlbF92Z3B1X2FjdGl2ZSh2bS0+aTkxNSkpCi0J
CQkJZmlsbF9weChwdCwgdm0tPnNjcmF0Y2hfcHRlKTsKKwkJCQlmaWxsX3B4KHB0LCB2bS0+c2Ny
YXRjaFswXS5lbmNvZGUpOwogCiAJCQlzcGluX2xvY2soJnBkLT5sb2NrKTsKLQkJCWlmIChwZC0+
ZW50cnlbcGRlXSA9PSAmdm0tPnNjcmF0Y2hfcHQpIHsKKwkJCWlmIChwZC0+ZW50cnlbcGRlXSA9
PSAmdm0tPnNjcmF0Y2hbMV0pIHsKIAkJCQlzZXRfcGRfZW50cnkocGQsIHBkZSwgcHQpOwogCQkJ
fSBlbHNlIHsKIAkJCQlhbGxvYyA9IHB0OwpAQCAtMTExNyw3ICsxMTE1LDcgQEAgc3RhdGljIGlu
dCBnZW44X3BwZ3R0X2FsbG9jX3BkcChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAog
CXNwaW5fbG9jaygmcGRwLT5sb2NrKTsKIAlnZW44X2Zvcl9lYWNoX3BkcGUocGQsIHBkcCwgc3Rh
cnQsIGxlbmd0aCwgcGRwZSkgewotCQlpZiAocHhfYmFzZShwZCkgPT0gJnZtLT5zY3JhdGNoX3Bk
KSB7CisJCWlmIChweF9iYXNlKHBkKSA9PSBweF9iYXNlKCZ2bS0+c2NyYXRjaFsyXSkpIHsKIAkJ
CXNwaW5fdW5sb2NrKCZwZHAtPmxvY2spOwogCiAJCQlwZCA9IGZldGNoX2FuZF96ZXJvKCZhbGxv
Yyk7CkBAIC0xMTI4LDEwICsxMTI2LDEwIEBAIHN0YXRpYyBpbnQgZ2VuOF9wcGd0dF9hbGxvY19w
ZHAoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJCQkJZ290byB1bndpbmQ7CiAJCQl9
CiAKLQkJCWluaXRfcGQocGQsICZ2bS0+c2NyYXRjaF9wdCk7CisJCQlpbml0X3BkKHBkLCAmdm0t
PnNjcmF0Y2hbMV0pOwogCiAJCQlzcGluX2xvY2soJnBkcC0+bG9jayk7Ci0JCQlpZiAocGRwLT5l
bnRyeVtwZHBlXSA9PSAmdm0tPnNjcmF0Y2hfcGQpIHsKKwkJCWlmIChwZHAtPmVudHJ5W3BkcGVd
ID09ICZ2bS0+c2NyYXRjaFsyXSkgewogCQkJCXNldF9wZF9lbnRyeShwZHAsIHBkcGUsIHBkKTsK
IAkJCX0gZWxzZSB7CiAJCQkJYWxsb2MgPSBwZDsKQEAgLTExNTIsNyArMTE1MCw3IEBAIHN0YXRp
YyBpbnQgZ2VuOF9wcGd0dF9hbGxvY19wZHAoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0s
CiAJZ290byBvdXQ7CiAKIHVud2luZF9wZDoKLQlpZiAocmVsZWFzZV9wZF9lbnRyeShwZHAsIHBk
cGUsICZwZC0+cHQsICZ2bS0+c2NyYXRjaF9wZCkpCisJaWYgKHJlbGVhc2VfcGRfZW50cnkocGRw
LCBwZHBlLCAmcGQtPnB0LCAmdm0tPnNjcmF0Y2hbMl0pKQogCQlmcmVlX3B4KHZtLCBwZCk7CiB1
bndpbmQ6CiAJZ2VuOF9wcGd0dF9jbGVhcl9wZHAodm0sIHBkcCwgZnJvbSwgc3RhcnQgLSBmcm9t
KTsKQEAgLTExODEsNyArMTE3OSw3IEBAIHN0YXRpYyBpbnQgZ2VuOF9wcGd0dF9hbGxvY180bHZs
KHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCiAJc3Bpbl9sb2NrKCZwbWw0LT5sb2Nr
KTsKIAlnZW44X2Zvcl9lYWNoX3BtbDRlKHBkcCwgcG1sNCwgc3RhcnQsIGxlbmd0aCwgcG1sNGUp
IHsKLQkJaWYgKHB4X2Jhc2UocGRwKSA9PSAmdm0tPnNjcmF0Y2hfcGRwKSB7CisJCWlmIChweF9i
YXNlKHBkcCkgPT0gcHhfYmFzZSgmdm0tPnNjcmF0Y2hbM10pKSB7CiAJCQlzcGluX3VubG9jaygm
cG1sNC0+bG9jayk7CiAKIAkJCXBkcCA9IGZldGNoX2FuZF96ZXJvKCZhbGxvYyk7CkBAIC0xMTky
LDEwICsxMTkwLDEwIEBAIHN0YXRpYyBpbnQgZ2VuOF9wcGd0dF9hbGxvY180bHZsKHN0cnVjdCBp
OTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCQkJCWdvdG8gdW53aW5kOwogCQkJfQogCi0JCQlpbml0
X3BkKHBkcCwgJnZtLT5zY3JhdGNoX3BkKTsKKwkJCWluaXRfcGQocGRwLCAmdm0tPnNjcmF0Y2hb
Ml0pOwogCiAJCQlzcGluX2xvY2soJnBtbDQtPmxvY2spOwotCQkJaWYgKHBtbDQtPmVudHJ5W3Bt
bDRlXSA9PSAmdm0tPnNjcmF0Y2hfcGRwKSB7CisJCQlpZiAocG1sNC0+ZW50cnlbcG1sNGVdID09
ICZ2bS0+c2NyYXRjaFszXSkgewogCQkJCXNldF9wZF9lbnRyeShwbWw0LCBwbWw0ZSwgcGRwKTsK
IAkJCX0gZWxzZSB7CiAJCQkJYWxsb2MgPSBwZHA7CkBAIC0xMjE2LDcgKzEyMTQsNyBAQCBzdGF0
aWMgaW50IGdlbjhfcHBndHRfYWxsb2NfNGx2bChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2
bSwKIAlnb3RvIG91dDsKIAogdW53aW5kX3BkcDoKLQlpZiAocmVsZWFzZV9wZF9lbnRyeShwbWw0
LCBwbWw0ZSwgJnBkcC0+cHQsICZ2bS0+c2NyYXRjaF9wZHApKQorCWlmIChyZWxlYXNlX3BkX2Vu
dHJ5KHBtbDQsIHBtbDRlLCAmcGRwLT5wdCwgJnZtLT5zY3JhdGNoWzNdKSkKIAkJZnJlZV9weCh2
bSwgcGRwKTsKIHVud2luZDoKIAlnZW44X3BwZ3R0X2NsZWFyXzRsdmwodm0sIGZyb20sIHN0YXJ0
IC0gZnJvbSk7CkBAIC0xNDMwLDcgKzE0MjgsNyBAQCBzdGF0aWMgdm9pZCBnZW44X3BwZ3R0X2lu
c2VydF9odWdlX2VudHJpZXMoc3RydWN0IGk5MTVfdm1hICp2bWEsCiAJCQlpZiAoSTkxNV9TRUxG
VEVTVF9PTkxZKHZtYS0+dm0tPnNjcnViXzY0SykpIHsKIAkJCQl1MTYgaTsKIAotCQkJCWVuY29k
ZSA9IHZtYS0+dm0tPnNjcmF0Y2hfcHRlOworCQkJCWVuY29kZSA9IHZtYS0+dm0tPnNjcmF0Y2hb
MF0uZW5jb2RlOwogCQkJCXZhZGRyID0ga21hcF9hdG9taWNfcHgoaTkxNV9wdF9lbnRyeShwZCwK
IAkJCQkJCQkJICAgICBpZHgucGRlKSk7CiAKQEAgLTE0NzMsNiArMTQ3MSw3IEBAIHN0YXRpYyB2
b2lkIGdlbjhfcHBndHRfaW5zZXJ0XzRsdmwoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0s
CiBzdGF0aWMgaW50IGdlbjhfaW5pdF9zY3JhdGNoKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ug
KnZtKQogewogCWludCByZXQ7CisJaW50IGk7CiAKIAkvKgogCSAqIElmIGV2ZXJ5Ym9keSBhZ3Jl
ZXMgdG8gbm90IHRvIHdyaXRlIGludG8gdGhlIHNjcmF0Y2ggcGFnZSwKQEAgLTE0ODYsMTAgKzE0
ODUsOCBAQCBzdGF0aWMgaW50IGdlbjhfaW5pdF9zY3JhdGNoKHN0cnVjdCBpOTE1X2FkZHJlc3Nf
c3BhY2UgKnZtKQogCQlHRU1fQlVHX09OKCFjbG9uZS0+aGFzX3JlYWRfb25seSk7CiAKIAkJdm0t
PnNjcmF0Y2hfb3JkZXIgPSBjbG9uZS0+c2NyYXRjaF9vcmRlcjsKLQkJdm0tPnNjcmF0Y2hfcHRl
ID0gY2xvbmUtPnNjcmF0Y2hfcHRlOwotCQl2bS0+c2NyYXRjaF9wdCAgPSBjbG9uZS0+c2NyYXRj
aF9wdDsKLQkJdm0tPnNjcmF0Y2hfcGQgID0gY2xvbmUtPnNjcmF0Y2hfcGQ7Ci0JCXZtLT5zY3Jh
dGNoX3BkcCA9IGNsb25lLT5zY3JhdGNoX3BkcDsKKwkJbWVtY3B5KHZtLT5zY3JhdGNoLCBjbG9u
ZS0+c2NyYXRjaCwgc2l6ZW9mKHZtLT5zY3JhdGNoKSk7CisJCXB4X2RtYSgmdm0tPnNjcmF0Y2hb
MF0pID0gMDsgLyogbm8geGZlciBvZiBvd25lcnNoaXAgKi8KIAkJcmV0dXJuIDA7CiAJfQogCkBA
IC0xNDk3LDQzICsxNDk0LDI1IEBAIHN0YXRpYyBpbnQgZ2VuOF9pbml0X3NjcmF0Y2goc3RydWN0
IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIAotCXZt
LT5zY3JhdGNoX3B0ZSA9Ci0JCWdlbjhfcHRlX2VuY29kZSh2bS0+c2NyYXRjaF9wYWdlLmRhZGRy
LAotCQkJCUk5MTVfQ0FDSEVfTExDLAotCQkJCXZtLT5oYXNfcmVhZF9vbmx5KTsKKwl2bS0+c2Ny
YXRjaFswXS5lbmNvZGUgPQorCQlnZW44X3B0ZV9lbmNvZGUocHhfZG1hKCZ2bS0+c2NyYXRjaFsw
XSksCisJCQkJSTkxNV9DQUNIRV9MTEMsIHZtLT5oYXNfcmVhZF9vbmx5KTsKIAotCWlmICh1bmxp
a2VseShzZXR1cF9wYWdlX2RtYSh2bSwgJnZtLT5zY3JhdGNoX3B0KSkpIHsKLQkJcmV0ID0gLUVO
T01FTTsKLQkJZ290byBmcmVlX3NjcmF0Y2hfcGFnZTsKLQl9Ci0JZmlsbF9weCgmdm0tPnNjcmF0
Y2hfcHQsIHZtLT5zY3JhdGNoX3B0ZSk7CisJZm9yIChpID0gMTsgaSA8PSB2bS0+dG9wOyBpKysp
IHsKKwkJaWYgKHVubGlrZWx5KHNldHVwX3BhZ2VfZG1hKHZtLCBweF9iYXNlKCZ2bS0+c2NyYXRj
aFtpXSkpKSkKKwkJCWdvdG8gZnJlZV9zY3JhdGNoOwogCi0JaWYgKHVubGlrZWx5KHNldHVwX3Bh
Z2VfZG1hKHZtLCAmdm0tPnNjcmF0Y2hfcGQpKSkgewotCQlyZXQgPSAtRU5PTUVNOwotCQlnb3Rv
IGZyZWVfcHQ7Ci0JfQotCWZpbGxfcHgoJnZtLT5zY3JhdGNoX3BkLAotCQlnZW44X3BkZV9lbmNv
ZGUodm0tPnNjcmF0Y2hfcHQuZGFkZHIsIEk5MTVfQ0FDSEVfTExDKSk7Ci0KLQlpZiAoaTkxNV92
bV9pc180bHZsKHZtKSkgewotCQlpZiAodW5saWtlbHkoc2V0dXBfcGFnZV9kbWEodm0sICZ2bS0+
c2NyYXRjaF9wZHApKSkgewotCQkJcmV0ID0gLUVOT01FTTsKLQkJCWdvdG8gZnJlZV9wZDsKLQkJ
fQotCQlmaWxsX3B4KCZ2bS0+c2NyYXRjaF9wZHAsCi0JCQlnZW44X3BkZV9lbmNvZGUodm0tPnNj
cmF0Y2hfcGQuZGFkZHIsIEk5MTVfQ0FDSEVfTExDKSk7CisJCWZpbGxfcHgoJnZtLT5zY3JhdGNo
W2ldLCB2bS0+c2NyYXRjaFtpIC0gMV0uZW5jb2RlKTsKKwkJdm0tPnNjcmF0Y2hbaV0uZW5jb2Rl
ID0KKwkJCWdlbjhfcGRlX2VuY29kZShweF9kbWEoJnZtLT5zY3JhdGNoW2ldKSwKKwkJCQkJSTkx
NV9DQUNIRV9MTEMpOwogCX0KIAogCXJldHVybiAwOwogCi1mcmVlX3BkOgotCWNsZWFudXBfcGFn
ZV9kbWEodm0sICZ2bS0+c2NyYXRjaF9wZCk7Ci1mcmVlX3B0OgotCWNsZWFudXBfcGFnZV9kbWEo
dm0sICZ2bS0+c2NyYXRjaF9wdCk7Ci1mcmVlX3NjcmF0Y2hfcGFnZToKLQljbGVhbnVwX3NjcmF0
Y2hfcGFnZSh2bSk7Ci0KLQlyZXR1cm4gcmV0OworZnJlZV9zY3JhdGNoOgorCWZyZWVfc2NyYXRj
aCh2bSk7CisJcmV0dXJuIC1FTk9NRU07CiB9CiAKIHN0YXRpYyBpbnQgZ2VuOF9wcmVhbGxvY2F0
ZV90b3BfbGV2ZWxfcGRwKHN0cnVjdCBpOTE1X3BwZ3R0ICpwcGd0dCkKQEAgLTE1NTAsNyArMTUy
OSw3IEBAIHN0YXRpYyBpbnQgZ2VuOF9wcmVhbGxvY2F0ZV90b3BfbGV2ZWxfcGRwKHN0cnVjdCBp
OTE1X3BwZ3R0ICpwcGd0dCkKIAkJaWYgKElTX0VSUihwZCkpCiAJCQlnb3RvIHVud2luZDsKIAot
CQlpbml0X3BkKHBkLCAmdm0tPnNjcmF0Y2hfcHQpOworCQlpbml0X3BkKHBkLCAmdm0tPnNjcmF0
Y2hbMV0pOwogCQlzZXRfcGRfZW50cnkocGRwLCBwZHBlLCBwZCk7CiAJfQogCkBAIC0xNTgxLDE2
ICsxNTYwLDE1IEBAIHN0YXRpYyB2b2lkIHBwZ3R0X2luaXQoc3RydWN0IGk5MTVfcHBndHQgKnBw
Z3R0LCBzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogCiBzdGF0aWMgdm9pZCBpbml0X3BkX24oc3RydWN0
IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJCSAgICAgIHN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0
b3J5ICpwZCwKLQkJICAgICAgc3RydWN0IGk5MTVfcGFnZV9kbWEgKnRvLAorCQkgICAgICBzdHJ1
Y3QgaTkxNV9wYWdlX3NjcmF0Y2ggKnNjcmF0Y2gsCiAJCSAgICAgIGNvbnN0IHVuc2lnbmVkIGlu
dCBlbnRyaWVzKQogewotCWNvbnN0IHU2NCBkYWRkciA9IGdlbjhfcGRlX2VuY29kZSh0by0+ZGFk
ZHIsIEk5MTVfQ0FDSEVfTExDKTsKIAl1NjQgKiBjb25zdCB2YWRkciA9IGttYXBfYXRvbWljX3B4
KHBkKTsKIAotCW1lbXNldDY0KHZhZGRyLCBkYWRkciwgZW50cmllcyk7CisJbWVtc2V0NjQodmFk
ZHIsIHNjcmF0Y2gtPmVuY29kZSwgZW50cmllcyk7CiAJa3VubWFwX2F0b21pYyh2YWRkcik7CiAK
LQltZW1zZXRfcChwZC0+ZW50cnksIHRvLCBlbnRyaWVzKTsKKwltZW1zZXRfcChwZC0+ZW50cnks
IHNjcmF0Y2gsIGVudHJpZXMpOwogfQogCiBzdGF0aWMgc3RydWN0IGk5MTVfcGFnZV9kaXJlY3Rv
cnkgKgpAQCAtMTYwMSw3ICsxNTc5LDcgQEAgZ2VuOF9hbGxvY190b3BfcGQoc3RydWN0IGk5MTVf
YWRkcmVzc19zcGFjZSAqdm0pCiAJaWYgKGk5MTVfdm1faXNfNGx2bCh2bSkpIHsKIAkJcGQgPSBh
bGxvY19wZCh2bSk7CiAJCWlmICghSVNfRVJSKHBkKSkKLQkJCWluaXRfcGQocGQsICZ2bS0+c2Ny
YXRjaF9wZHApOworCQkJaW5pdF9wZChwZCwgJnZtLT5zY3JhdGNoWzNdKTsKIAogCQlyZXR1cm4g
cGQ7CiAJfQpAQCAtMTYxOCw3ICsxNTk2LDcgQEAgZ2VuOF9hbGxvY190b3BfcGQoc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqdm0pCiAJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwogCX0KIAot
CWluaXRfcGRfbih2bSwgcGQsICZ2bS0+c2NyYXRjaF9wZCwgR0VOOF8zTFZMX1BEUEVTKTsKKwlp
bml0X3BkX24odm0sIHBkLCAmdm0tPnNjcmF0Y2hbMl0sIEdFTjhfM0xWTF9QRFBFUyk7CiAKIAly
ZXR1cm4gcGQ7CiB9CkBAIC0xNzY2LDcgKzE3NDQsNyBAQCBzdGF0aWMgdm9pZCBnZW42X3BwZ3R0
X2NsZWFyX3JhbmdlKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogewogCXN0cnVjdCBn
ZW42X3BwZ3R0ICogY29uc3QgcHBndHQgPSB0b19nZW42X3BwZ3R0KGk5MTVfdm1fdG9fcHBndHQo
dm0pKTsKIAljb25zdCB1bnNpZ25lZCBpbnQgZmlyc3RfZW50cnkgPSBzdGFydCAvIEk5MTVfR1RU
X1BBR0VfU0laRTsKLQljb25zdCBnZW42X3B0ZV90IHNjcmF0Y2hfcHRlID0gdm0tPnNjcmF0Y2hf
cHRlOworCWNvbnN0IGdlbjZfcHRlX3Qgc2NyYXRjaF9wdGUgPSB2bS0+c2NyYXRjaFswXS5lbmNv
ZGU7CiAJdW5zaWduZWQgaW50IHBkZSA9IGZpcnN0X2VudHJ5IC8gR0VONl9QVEVTOwogCXVuc2ln
bmVkIGludCBwdGUgPSBmaXJzdF9lbnRyeSAlIEdFTjZfUFRFUzsKIAl1bnNpZ25lZCBpbnQgbnVt
X2VudHJpZXMgPSBsZW5ndGggLyBJOTE1X0dUVF9QQUdFX1NJWkU7CkBAIC0xNzc3LDcgKzE3NTUs
NyBAQCBzdGF0aWMgdm9pZCBnZW42X3BwZ3R0X2NsZWFyX3JhbmdlKHN0cnVjdCBpOTE1X2FkZHJl
c3Nfc3BhY2UgKnZtLAogCQljb25zdCB1bnNpZ25lZCBpbnQgY291bnQgPSBtaW4obnVtX2VudHJp
ZXMsIEdFTjZfUFRFUyAtIHB0ZSk7CiAJCWdlbjZfcHRlX3QgKnZhZGRyOwogCi0JCUdFTV9CVUdf
T04ocHhfYmFzZShwdCkgPT0gJnZtLT5zY3JhdGNoX3B0KTsKKwkJR0VNX0JVR19PTihweF9iYXNl
KHB0KSA9PSBweF9iYXNlKCZ2bS0+c2NyYXRjaFsxXSkpOwogCiAJCW51bV9lbnRyaWVzIC09IGNv
dW50OwogCkBAIC0xODE0LDcgKzE3OTIsNyBAQCBzdGF0aWMgdm9pZCBnZW42X3BwZ3R0X2luc2Vy
dF9lbnRyaWVzKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCXN0cnVjdCBzZ3RfZG1h
IGl0ZXIgPSBzZ3RfZG1hKHZtYSk7CiAJZ2VuNl9wdGVfdCAqdmFkZHI7CiAKLQlHRU1fQlVHX09O
KHBkLT5lbnRyeVthY3RfcHRdID09ICZ2bS0+c2NyYXRjaF9wdCk7CisJR0VNX0JVR19PTihwZC0+
ZW50cnlbYWN0X3B0XSA9PSAmdm0tPnNjcmF0Y2hbMV0pOwogCiAJdmFkZHIgPSBrbWFwX2F0b21p
Y19weChpOTE1X3B0X2VudHJ5KHBkLCBhY3RfcHQpKTsKIAlkbyB7CkBAIC0xODU5LDcgKzE4Mzcs
NyBAQCBzdGF0aWMgaW50IGdlbjZfYWxsb2NfdmFfcmFuZ2Uoc3RydWN0IGk5MTVfYWRkcmVzc19z
cGFjZSAqdm0sCiAJZ2VuNl9mb3JfZWFjaF9wZGUocHQsIHBkLCBzdGFydCwgbGVuZ3RoLCBwZGUp
IHsKIAkJY29uc3QgdW5zaWduZWQgaW50IGNvdW50ID0gZ2VuNl9wdGVfY291bnQoc3RhcnQsIGxl
bmd0aCk7CiAKLQkJaWYgKHB4X2Jhc2UocHQpID09ICZ2bS0+c2NyYXRjaF9wdCkgeworCQlpZiAo
cHhfYmFzZShwdCkgPT0gcHhfYmFzZSgmdm0tPnNjcmF0Y2hbMV0pKSB7CiAJCQlzcGluX3VubG9j
aygmcGQtPmxvY2spOwogCiAJCQlwdCA9IGZldGNoX2FuZF96ZXJvKCZhbGxvYyk7CkBAIC0xODcw
LDEwICsxODQ4LDEwIEBAIHN0YXRpYyBpbnQgZ2VuNl9hbGxvY192YV9yYW5nZShzdHJ1Y3QgaTkx
NV9hZGRyZXNzX3NwYWNlICp2bSwKIAkJCQlnb3RvIHVud2luZF9vdXQ7CiAJCQl9CiAKLQkJCWZp
bGwzMl9weChwdCwgdm0tPnNjcmF0Y2hfcHRlKTsKKwkJCWZpbGwzMl9weChwdCwgdm0tPnNjcmF0
Y2hbMF0uZW5jb2RlKTsKIAogCQkJc3Bpbl9sb2NrKCZwZC0+bG9jayk7Ci0JCQlpZiAocGQtPmVu
dHJ5W3BkZV0gPT0gJnZtLT5zY3JhdGNoX3B0KSB7CisJCQlpZiAocGQtPmVudHJ5W3BkZV0gPT0g
JnZtLT5zY3JhdGNoWzFdKSB7CiAJCQkJcGQtPmVudHJ5W3BkZV0gPSBwdDsKIAkJCQlpZiAoaTkx
NV92bWFfaXNfYm91bmQocHBndHQtPnZtYSwKIAkJCQkJCSAgICAgIEk5MTVfVk1BX0dMT0JBTF9C
SU5EKSkgewpAQCAtMTkxMCwyNiArMTg4OCwyMyBAQCBzdGF0aWMgaW50IGdlbjZfcHBndHRfaW5p
dF9zY3JhdGNoKHN0cnVjdCBnZW42X3BwZ3R0ICpwcGd0dCkKIHsKIAlzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlICogY29uc3Qgdm0gPSAmcHBndHQtPmJhc2Uudm07CiAJc3RydWN0IGk5MTVfcGFn
ZV9kaXJlY3RvcnkgKiBjb25zdCBwZCA9IHBwZ3R0LT5iYXNlLnBkOwotCXN0cnVjdCBpOTE1X3Bh
Z2VfdGFibGUgKnVudXNlZDsKLQl1MzIgcGRlOwogCWludCByZXQ7CiAKIAlyZXQgPSBzZXR1cF9z
Y3JhdGNoX3BhZ2Uodm0sIF9fR0ZQX0hJR0hNRU0pOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7
CiAKLQl2bS0+c2NyYXRjaF9wdGUgPSB2bS0+cHRlX2VuY29kZSh2bS0+c2NyYXRjaF9wYWdlLmRh
ZGRyLAotCQkJCQkgSTkxNV9DQUNIRV9OT05FLAotCQkJCQkgUFRFX1JFQURfT05MWSk7CisJdm0t
PnNjcmF0Y2hbMF0uZW5jb2RlID0KKwkJdm0tPnB0ZV9lbmNvZGUocHhfZG1hKCZ2bS0+c2NyYXRj
aFswXSksCisJCQkgICAgICAgSTkxNV9DQUNIRV9OT05FLCBQVEVfUkVBRF9PTkxZKTsKIAotCWlm
ICh1bmxpa2VseShzZXR1cF9wYWdlX2RtYSh2bSwgJnZtLT5zY3JhdGNoX3B0KSkpIHsKKwlpZiAo
dW5saWtlbHkoc2V0dXBfcGFnZV9kbWEodm0sIHB4X2Jhc2UoJnZtLT5zY3JhdGNoWzFdKSkpKSB7
CiAJCWNsZWFudXBfc2NyYXRjaF9wYWdlKHZtKTsKIAkJcmV0dXJuIC1FTk9NRU07CiAJfQotCWZp
bGwzMl9weCgmdm0tPnNjcmF0Y2hfcHQsIHZtLT5zY3JhdGNoX3B0ZSk7CiAKLQlnZW42X2Zvcl9h
bGxfcGRlcyh1bnVzZWQsIHBkLCBwZGUpCi0JCXBkLT5lbnRyeVtwZGVdID0gJnZtLT5zY3JhdGNo
X3B0OworCWZpbGwzMl9weCgmdm0tPnNjcmF0Y2hbMV0sIHZtLT5zY3JhdGNoWzBdLmVuY29kZSk7
CisJbWVtc2V0X3AocGQtPmVudHJ5LCAmdm0tPnNjcmF0Y2hbMV0sIEk5MTVfUERFUyk7CiAKIAly
ZXR1cm4gMDsKIH0KQEAgLTE5MzcsMTEgKzE5MTIsMTMgQEAgc3RhdGljIGludCBnZW42X3BwZ3R0
X2luaXRfc2NyYXRjaChzdHJ1Y3QgZ2VuNl9wcGd0dCAqcHBndHQpCiBzdGF0aWMgdm9pZCBnZW42
X3BwZ3R0X2ZyZWVfcGQoc3RydWN0IGdlbjZfcHBndHQgKnBwZ3R0KQogewogCXN0cnVjdCBpOTE1
X3BhZ2VfZGlyZWN0b3J5ICogY29uc3QgcGQgPSBwcGd0dC0+YmFzZS5wZDsKKwlzdHJ1Y3QgaTkx
NV9wYWdlX2RtYSAqIGNvbnN0IHNjcmF0Y2ggPQorCQlweF9iYXNlKCZwcGd0dC0+YmFzZS52bS5z
Y3JhdGNoWzFdKTsKIAlzdHJ1Y3QgaTkxNV9wYWdlX3RhYmxlICpwdDsKIAl1MzIgcGRlOwogCiAJ
Z2VuNl9mb3JfYWxsX3BkZXMocHQsIHBkLCBwZGUpCi0JCWlmIChweF9iYXNlKHB0KSAhPSAmcHBn
dHQtPmJhc2Uudm0uc2NyYXRjaF9wdCkKKwkJaWYgKHB4X2Jhc2UocHQpICE9IHNjcmF0Y2gpCiAJ
CQlmcmVlX3B4KCZwcGd0dC0+YmFzZS52bSwgcHQpOwogfQogCkBAIC0xOTk5LDcgKzE5NzYsOCBA
QCBzdGF0aWMgdm9pZCBwZF92bWFfdW5iaW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewogCXN0
cnVjdCBnZW42X3BwZ3R0ICpwcGd0dCA9IHZtYS0+cHJpdmF0ZTsKIAlzdHJ1Y3QgaTkxNV9wYWdl
X2RpcmVjdG9yeSAqIGNvbnN0IHBkID0gcHBndHQtPmJhc2UucGQ7Ci0Jc3RydWN0IGk5MTVfcGFn
ZV9kbWEgKiBjb25zdCBzY3JhdGNoID0gJnBwZ3R0LT5iYXNlLnZtLnNjcmF0Y2hfcHQ7CisJc3Ry
dWN0IGk5MTVfcGFnZV9kbWEgKiBjb25zdCBzY3JhdGNoID0KKwkJcHhfYmFzZSgmcHBndHQtPmJh
c2Uudm0uc2NyYXRjaFsxXSk7CiAJc3RydWN0IGk5MTVfcGFnZV90YWJsZSAqcHQ7CiAJdW5zaWdu
ZWQgaW50IHBkZTsKIApAQCAtMjQwNSw3ICsyMzgzLDcgQEAgc3RhdGljIHZvaWQgZ2VuOF9nZ3R0
X2NsZWFyX3JhbmdlKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCXN0cnVjdCBpOTE1
X2dndHQgKmdndHQgPSBpOTE1X3ZtX3RvX2dndHQodm0pOwogCXVuc2lnbmVkIGZpcnN0X2VudHJ5
ID0gc3RhcnQgLyBJOTE1X0dUVF9QQUdFX1NJWkU7CiAJdW5zaWduZWQgbnVtX2VudHJpZXMgPSBs
ZW5ndGggLyBJOTE1X0dUVF9QQUdFX1NJWkU7Ci0JY29uc3QgZ2VuOF9wdGVfdCBzY3JhdGNoX3B0
ZSA9IHZtLT5zY3JhdGNoX3B0ZTsKKwljb25zdCBnZW44X3B0ZV90IHNjcmF0Y2hfcHRlID0gdm0t
PnNjcmF0Y2hbMF0uZW5jb2RlOwogCWdlbjhfcHRlX3QgX19pb21lbSAqZ3R0X2Jhc2UgPQogCQko
Z2VuOF9wdGVfdCBfX2lvbWVtICopZ2d0dC0+Z3NtICsgZmlyc3RfZW50cnk7CiAJY29uc3QgaW50
IG1heF9lbnRyaWVzID0gZ2d0dF90b3RhbF9lbnRyaWVzKGdndHQpIC0gZmlyc3RfZW50cnk7CkBA
IC0yNTMwLDggKzI1MDgsNyBAQCBzdGF0aWMgdm9pZCBnZW42X2dndHRfY2xlYXJfcmFuZ2Uoc3Ry
dWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJCSBmaXJzdF9lbnRyeSwgbnVtX2VudHJpZXMs
IG1heF9lbnRyaWVzKSkKIAkJbnVtX2VudHJpZXMgPSBtYXhfZW50cmllczsKIAotCXNjcmF0Y2hf
cHRlID0gdm0tPnNjcmF0Y2hfcHRlOwotCisJc2NyYXRjaF9wdGUgPSB2bS0+c2NyYXRjaFswXS5l
bmNvZGU7CiAJZm9yIChpID0gMDsgaSA8IG51bV9lbnRyaWVzOyBpKyspCiAJCWlvd3JpdGUzMihz
Y3JhdGNoX3B0ZSwgJmd0dF9iYXNlW2ldKTsKIH0KQEAgLTMwMDUsOCArMjk4Miw4IEBAIHN0YXRp
YyBpbnQgZ2d0dF9wcm9iZV9jb21tb24oc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCwgdTY0IHNpemUp
CiAJCXJldHVybiByZXQ7CiAJfQogCi0JZ2d0dC0+dm0uc2NyYXRjaF9wdGUgPQotCQlnZ3R0LT52
bS5wdGVfZW5jb2RlKGdndHQtPnZtLnNjcmF0Y2hfcGFnZS5kYWRkciwKKwlnZ3R0LT52bS5zY3Jh
dGNoWzBdLmVuY29kZSA9CisJCWdndHQtPnZtLnB0ZV9lbmNvZGUocHhfZG1hKCZnZ3R0LT52bS5z
Y3JhdGNoWzBdKSwKIAkJCQkgICAgSTkxNV9DQUNIRV9OT05FLCAwKTsKIAogCXJldHVybiAwOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmggYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaAppbmRleCBmYjMzZjI1MWVmOWEuLjFhNDNhYzRh
OTI0OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmgKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmgKQEAgLTIzOSw2ICsyMzksMTEg
QEAgc3RydWN0IGk5MTVfcGFnZV9kbWEgewogCX07CiB9OwogCitzdHJ1Y3QgaTkxNV9wYWdlX3Nj
cmF0Y2ggeworCXN0cnVjdCBpOTE1X3BhZ2VfZG1hIGJhc2U7CisJdTY0IGVuY29kZTsKK307CisK
IHN0cnVjdCBpOTE1X3BhZ2VfdGFibGUgewogCXN0cnVjdCBpOTE1X3BhZ2VfZG1hIGJhc2U7CiAJ
YXRvbWljX3QgdXNlZDsKQEAgLTI1OSw5ICsyNjQsMTAgQEAgc3RydWN0IGk5MTVfcGFnZV9kaXJl
Y3RvcnkgewogCiAjZGVmaW5lIHB4X2Jhc2UocHgpIFwKIAlfX3B4X2Nob29zZV9leHByKHB4LCBz
dHJ1Y3QgaTkxNV9wYWdlX2RtYSAqLCBfX3gsIFwKKwlfX3B4X2Nob29zZV9leHByKHB4LCBzdHJ1
Y3QgaTkxNV9wYWdlX3NjcmF0Y2ggKiwgJl9feC0+YmFzZSwgXAogCV9fcHhfY2hvb3NlX2V4cHIo
cHgsIHN0cnVjdCBpOTE1X3BhZ2VfdGFibGUgKiwgJl9feC0+YmFzZSwgXAogCV9fcHhfY2hvb3Nl
X2V4cHIocHgsIHN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICosICZfX3gtPnB0LmJhc2UsIFwK
LQkodm9pZCkwKSkpCisJKHZvaWQpMCkpKSkKICNkZWZpbmUgcHhfZG1hKHB4KSAocHhfYmFzZShw
eCktPmRhZGRyKQogCiAjZGVmaW5lIHB4X3B0KHB4KSBcCkBAIC0zMTYsMTIgKzMyMiw4IEBAIHN0
cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgewogI2RlZmluZSBWTV9DTEFTU19HR1RUIDAKICNkZWZp
bmUgVk1fQ0xBU1NfUFBHVFQgMQogCi0JdTY0IHNjcmF0Y2hfcHRlOwotCWludCBzY3JhdGNoX29y
ZGVyOwotCXN0cnVjdCBpOTE1X3BhZ2VfZG1hIHNjcmF0Y2hfcGFnZTsKLQlzdHJ1Y3QgaTkxNV9w
YWdlX2RtYSBzY3JhdGNoX3B0OwotCXN0cnVjdCBpOTE1X3BhZ2VfZG1hIHNjcmF0Y2hfcGQ7Ci0J
c3RydWN0IGk5MTVfcGFnZV9kbWEgc2NyYXRjaF9wZHA7IC8qIEdFTjgrICYgNDhiIFBQR1RUICov
CisJc3RydWN0IGk5MTVfcGFnZV9zY3JhdGNoIHNjcmF0Y2hbNF07CisJdW5zaWduZWQgaW50IHNj
cmF0Y2hfb3JkZXI7CiAJdW5zaWduZWQgaW50IHRvcDsKIAogCS8qKgotLSAKMi4yMi4wCgpfX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFp
bGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5m
cmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

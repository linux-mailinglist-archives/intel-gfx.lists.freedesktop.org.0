Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id BE6463AF74
	for <lists+intel-gfx@lfdr.de>; Mon, 10 Jun 2019 09:21:37 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6DAEC89101;
	Mon, 10 Jun 2019 07:21:34 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 62BD088FA4
 for <intel-gfx@lists.freedesktop.org>; Mon, 10 Jun 2019 07:21:31 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16848369-1500050 
 for multiple; Mon, 10 Jun 2019 08:21:30 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 10 Jun 2019 08:21:14 +0100
Message-Id: <20190610072126.6355-17-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190610072126.6355-1-chris@chris-wilson.co.uk>
References: <20190610072126.6355-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 16/28] drm/i915: Provide an i915_active.acquire
 callback
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SWYgd2UgaW50cm9kdWNlIGEgY2FsbGJhY2sgZm9yIGk5MTVfYWN0aXZlIHRoYXQgaXMgb25seSBj
YWxsZWQgdGhlIGZpcnN0CnRpbWUgd2UgdXNlIHRoZSBpOTE1X2FjdGl2ZSBhbmQgaXMgc3ltbWV0
cmljYWxseSBwYWlyZWQgd2l0aCB0aGUKaTkxNV9hY3RpdmUucmV0aXJlIGNhbGxiYWNrLCB3ZSBj
YW4gcmVwbGFjZSB0aGUgb3Blbi1jb2RlZCBhbmQKbm9uLWF0b21pYyBpbXBsZW1lbnRhdGlvbnMg
LS0gd2hpY2ggd2lsbCBiZSB2ZXJ5IGZyYWdpbGUgKGkuZS4gYnJva2VuKQp1cG9uIHJlbW92aW5n
IHRoZSBzdHJ1Y3RfbXV0ZXggc2VyaWFsaXNhdGlvbi4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdp
bHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgIHwgICA4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9jb250ZXh0LmMgICAgICB8ICA4MiArKysrLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9jb250ZXh0LmggICAgICB8ICAxNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfbHJjLmMgICAgICAgICAgfCAgIDYgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX3JpbmdidWZmZXIuYyAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9t
b2NrX2VuZ2luZS5jICAgICAgICB8ICAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9h
Y3RpdmUuYyAgICAgICAgICAgfCAyMTUgKysrKysrKysrKy0tLS0tLS0tLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9hY3RpdmUuaCAgICAgICAgICAgfCAgMjUgKy0tCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2FjdGl2ZV90eXBlcy5oICAgICB8ICAxMCArLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW1fZ3R0LmMgICAgICAgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfdGltZWxpbmUuYyAgICAgICAgIHwgIDE2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3ZtYS5jICAgICAgICAgICAgICB8ICAxNSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2k5MTVfYWN0aXZlLmMgfCAgMTIgKy0KIDEzIGZpbGVzIGNoYW5nZWQsIDIxOSBp
bnNlcnRpb25zKCspLCAxOTAgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXggZjA5ZTNhYmU2OTVhLi44MzdjYWQyMzNjYzYgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYwpAQCAtOTIyLDgg
KzkyMiwxMiBAQCBzdGF0aWMgaW50IGNvbnRleHRfYmFycmllcl90YXNrKHN0cnVjdCBpOTE1X2dl
bV9jb250ZXh0ICpjdHgsCiAJaWYgKCFjYikKIAkJcmV0dXJuIC1FTk9NRU07CiAKLQlpOTE1X2Fj
dGl2ZV9pbml0KGk5MTUsICZjYi0+YmFzZSwgY2JfcmV0aXJlKTsKLQlpOTE1X2FjdGl2ZV9hY3F1
aXJlKCZjYi0+YmFzZSk7CisJaTkxNV9hY3RpdmVfaW5pdChpOTE1LCAmY2ItPmJhc2UsIE5VTEws
IGNiX3JldGlyZSk7CisJZXJyID0gaTkxNV9hY3RpdmVfYWNxdWlyZSgmY2ItPmJhc2UpOworCWlm
IChlcnIpIHsKKwkJa2ZyZWUoY2IpOworCQlyZXR1cm4gZXJyOworCX0KIAogCWZvcl9lYWNoX2dl
bV9lbmdpbmUoY2UsIGk5MTVfZ2VtX2NvbnRleHRfbG9ja19lbmdpbmVzKGN0eCksIGl0KSB7CiAJ
CXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29u
dGV4dC5jCmluZGV4IDAxMDJmNmJiNjJlYy4uYjlmZWEzMWNmOWVjIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCkBAIC05NSwxMSArOTUsMTQgQEAgdm9pZCBpbnRlbF9j
b250ZXh0X3VucGluKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIAlpbnRlbF9jb250ZXh0X3B1
dChjZSk7CiB9CiAKLXN0YXRpYyBpbnQgX19jb250ZXh0X3Bpbl9zdGF0ZShzdHJ1Y3QgaTkxNV92
bWEgKnZtYSwgdW5zaWduZWQgbG9uZyBmbGFncykKK3N0YXRpYyBpbnQgX19jb250ZXh0X3Bpbl9z
dGF0ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKKwl1NjQgZmxhZ3M7CiAJaW50IGVycjsKIAot
CWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIGZsYWdzIHwgUElOX0dMT0JBTCk7CisJZmxh
Z3MgPSBQSU5fSElHSCB8IFBJTl9HTE9CQUw7CisJZmxhZ3MgfD0gaTkxNV92bV90b19nZ3R0KHZt
YS0+dm0pLT5waW5fYmlhcyB8IFBJTl9PRkZTRVRfQklBUzsKKwllcnIgPSBpOTE1X3ZtYV9waW4o
dm1hLCAwLCAwLCBmbGFncyk7CiAJaWYgKGVycikKIAkJcmV0dXJuIGVycjsKIApAQCAtMTE5LDcg
KzEyMiw3IEBAIHN0YXRpYyB2b2lkIF9fY29udGV4dF91bnBpbl9zdGF0ZShzdHJ1Y3QgaTkxNV92
bWEgKnZtYSkKIAlfX2k5MTVfdm1hX3VucGluKHZtYSk7CiB9CiAKLXN0YXRpYyB2b2lkIGludGVs
X2NvbnRleHRfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqYWN0aXZlKQorc3RhdGljIHZvaWQg
X19pbnRlbF9jb250ZXh0X3JldGlyZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKmFjdGl2ZSkKIHsKIAlz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UgPSBjb250YWluZXJfb2YoYWN0aXZlLCB0eXBlb2YoKmNl
KSwgYWN0aXZlKTsKIApAQCAtMTI5LDY1ICsxMzIsNTggQEAgc3RhdGljIHZvaWQgaW50ZWxfY29u
dGV4dF9yZXRpcmUoc3RydWN0IGk5MTVfYWN0aXZlICphY3RpdmUpCiAJaW50ZWxfY29udGV4dF9w
dXQoY2UpOwogfQogCi12b2lkCi1pbnRlbF9jb250ZXh0X2luaXQoc3RydWN0IGludGVsX2NvbnRl
eHQgKmNlLAotCQkgICBzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4LAotCQkgICBzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUpCi17Ci0JR0VNX0JVR19PTighZW5naW5lLT5jb3BzKTsK
LQotCWtyZWZfaW5pdCgmY2UtPnJlZik7Ci0KLQljZS0+Z2VtX2NvbnRleHQgPSBjdHg7Ci0JY2Ut
PmVuZ2luZSA9IGVuZ2luZTsKLQljZS0+b3BzID0gZW5naW5lLT5jb3BzOwotCWNlLT5zc2V1ID0g
ZW5naW5lLT5zc2V1OwotCi0JSU5JVF9MSVNUX0hFQUQoJmNlLT5zaWduYWxfbGluayk7Ci0JSU5J
VF9MSVNUX0hFQUQoJmNlLT5zaWduYWxzKTsKLQotCW11dGV4X2luaXQoJmNlLT5waW5fbXV0ZXgp
OwotCi0JaTkxNV9hY3RpdmVfaW5pdChjdHgtPmk5MTUsICZjZS0+YWN0aXZlLCBpbnRlbF9jb250
ZXh0X3JldGlyZSk7Ci19Ci0KLWludCBpbnRlbF9jb250ZXh0X2FjdGl2ZShzdHJ1Y3QgaW50ZWxf
Y29udGV4dCAqY2UsIHVuc2lnbmVkIGxvbmcgZmxhZ3MpCitzdGF0aWMgaW50IF9faW50ZWxfY29u
dGV4dF9hY3RpdmUoc3RydWN0IGk5MTVfYWN0aXZlICphY3RpdmUpCiB7CisJc3RydWN0IGludGVs
X2NvbnRleHQgKmNlID0gY29udGFpbmVyX29mKGFjdGl2ZSwgdHlwZW9mKCpjZSksIGFjdGl2ZSk7
CiAJaW50IGVycjsKIAotCWlmICghaTkxNV9hY3RpdmVfYWNxdWlyZSgmY2UtPmFjdGl2ZSkpCi0J
CXJldHVybiAwOwotCiAJaW50ZWxfY29udGV4dF9nZXQoY2UpOwogCiAJaWYgKCFjZS0+c3RhdGUp
CiAJCXJldHVybiAwOwogCi0JZXJyID0gX19jb250ZXh0X3Bpbl9zdGF0ZShjZS0+c3RhdGUsIGZs
YWdzKTsKLQlpZiAoZXJyKSB7Ci0JCWk5MTVfYWN0aXZlX2NhbmNlbCgmY2UtPmFjdGl2ZSk7Ci0J
CWludGVsX2NvbnRleHRfcHV0KGNlKTsKLQkJcmV0dXJuIGVycjsKLQl9CisJZXJyID0gX19jb250
ZXh0X3Bpbl9zdGF0ZShjZS0+c3RhdGUpOworCWlmIChlcnIpCisJCWdvdG8gZXJyX3B1dDsKIAog
CS8qIFByZWFsbG9jYXRlIHRyYWNraW5nIG5vZGVzICovCiAJaWYgKCFpOTE1X2dlbV9jb250ZXh0
X2lzX2tlcm5lbChjZS0+Z2VtX2NvbnRleHQpKSB7CiAJCWVyciA9IGk5MTVfYWN0aXZlX2FjcXVp
cmVfcHJlYWxsb2NhdGVfYmFycmllcigmY2UtPmFjdGl2ZSwKIAkJCQkJCQkgICAgICBjZS0+ZW5n
aW5lKTsKLQkJaWYgKGVycikgewotCQkJaTkxNV9hY3RpdmVfcmVsZWFzZSgmY2UtPmFjdGl2ZSk7
Ci0JCQlyZXR1cm4gZXJyOwotCQl9CisJCWlmIChlcnIpCisJCQlnb3RvIGVycl91bnBpbjsKIAl9
CiAKIAlyZXR1cm4gMDsKKworZXJyX3VucGluOgorCV9fY29udGV4dF91bnBpbl9zdGF0ZShjZS0+
c3RhdGUpOworZXJyX3B1dDoKKwlpbnRlbF9jb250ZXh0X3B1dChjZSk7CisJcmV0dXJuIGVycjsK
IH0KIAotdm9pZCBpbnRlbF9jb250ZXh0X2luYWN0aXZlKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpj
ZSkKK3ZvaWQKK2ludGVsX2NvbnRleHRfaW5pdChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCisJ
CSAgIHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCisJCSAgIHN0cnVjdCBpbnRlbF9lbmdp
bmVfY3MgKmVuZ2luZSkKIHsKLQkvKiBOb2RlcyBwcmVhbGxvY2F0ZWQgaW4gaW50ZWxfY29udGV4
dF9hY3RpdmUoKSAqLwotCWk5MTVfYWN0aXZlX2FjcXVpcmVfYmFycmllcigmY2UtPmFjdGl2ZSk7
Ci0JaTkxNV9hY3RpdmVfcmVsZWFzZSgmY2UtPmFjdGl2ZSk7CisJR0VNX0JVR19PTighZW5naW5l
LT5jb3BzKTsKKworCWtyZWZfaW5pdCgmY2UtPnJlZik7CisKKwljZS0+Z2VtX2NvbnRleHQgPSBj
dHg7CisJY2UtPmVuZ2luZSA9IGVuZ2luZTsKKwljZS0+b3BzID0gZW5naW5lLT5jb3BzOworCWNl
LT5zc2V1ID0gZW5naW5lLT5zc2V1OworCisJSU5JVF9MSVNUX0hFQUQoJmNlLT5zaWduYWxfbGlu
ayk7CisJSU5JVF9MSVNUX0hFQUQoJmNlLT5zaWduYWxzKTsKKworCW11dGV4X2luaXQoJmNlLT5w
aW5fbXV0ZXgpOworCisJaTkxNV9hY3RpdmVfaW5pdChjdHgtPmk5MTUsICZjZS0+YWN0aXZlLAor
CQkJIF9faW50ZWxfY29udGV4dF9hY3RpdmUsIF9faW50ZWxfY29udGV4dF9yZXRpcmUpOwogfQog
CiBzdGF0aWMgdm9pZCBpOTE1X2dsb2JhbF9jb250ZXh0X3Nocmluayh2b2lkKQpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5oIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5oCmluZGV4IGU3MTYyOWY3YzJlMC4uMTU2ZjRhOWM5
MjY5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmgK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5oCkBAIC05LDYgKzks
NyBAQAogCiAjaW5jbHVkZSA8bGludXgvbG9ja2RlcC5oPgogCisjaW5jbHVkZSAiaTkxNV9hY3Rp
dmUuaCIKICNpbmNsdWRlICJpbnRlbF9jb250ZXh0X3R5cGVzLmgiCiAjaW5jbHVkZSAiaW50ZWxf
ZW5naW5lX3R5cGVzLmgiCiAKQEAgLTEwMiw4ICsxMDMsMTcgQEAgc3RhdGljIGlubGluZSB2b2lk
IGludGVsX2NvbnRleHRfZXhpdChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAJCWNlLT5vcHMt
PmV4aXQoY2UpOwogfQogCi1pbnQgaW50ZWxfY29udGV4dF9hY3RpdmUoc3RydWN0IGludGVsX2Nv
bnRleHQgKmNlLCB1bnNpZ25lZCBsb25nIGZsYWdzKTsKLXZvaWQgaW50ZWxfY29udGV4dF9pbmFj
dGl2ZShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpOworc3RhdGljIGlubGluZSBpbnQgaW50ZWxf
Y29udGV4dF9hY3RpdmUoc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQoreworCXJldHVybiBpOTE1
X2FjdGl2ZV9hY3F1aXJlKCZjZS0+YWN0aXZlKTsKK30KKworc3RhdGljIGlubGluZSB2b2lkIGlu
dGVsX2NvbnRleHRfaW5hY3RpdmUoc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQoreworCS8qIE5v
ZGVzIHByZWFsbG9jYXRlZCBpbiBpbnRlbF9jb250ZXh0X2FjdGl2ZSgpICovCisJaTkxNV9hY3Rp
dmVfYWNxdWlyZV9iYXJyaWVyKCZjZS0+YWN0aXZlKTsKKwlpOTE1X2FjdGl2ZV9yZWxlYXNlKCZj
ZS0+YWN0aXZlKTsKK30KIAogc3RhdGljIGlubGluZSBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqaW50
ZWxfY29udGV4dF9nZXQoc3RydWN0IGludGVsX2NvbnRleHQgKmNlKQogewpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9scmMuYwppbmRleCAwYWIzZDEzNzdlOTIuLjgyNmZlNzcxNThhOSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKQEAgLTE1NTgsMTIgKzE1NTgsMTAgQEAgX19leGVj
bGlzdHNfY29udGV4dF9waW4oc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCQlnb3RvIGVycjsK
IAlHRU1fQlVHX09OKCFjZS0+c3RhdGUpOwogCi0JcmV0ID0gaW50ZWxfY29udGV4dF9hY3RpdmUo
Y2UsCi0JCQkJICAgZW5naW5lLT5pOTE1LT5nZ3R0LnBpbl9iaWFzIHwKLQkJCQkgICBQSU5fT0ZG
U0VUX0JJQVMgfAotCQkJCSAgIFBJTl9ISUdIKTsKKwlyZXQgPSBpbnRlbF9jb250ZXh0X2FjdGl2
ZShjZSk7CiAJaWYgKHJldCkKIAkJZ290byBlcnI7CisJR0VNX0JVR19PTighaTkxNV92bWFfaXNf
cGlubmVkKGNlLT5zdGF0ZSkpOwogCiAJdmFkZHIgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChj
ZS0+c3RhdGUtPm9iaiwKIAkJCQkJaTkxNV9jb2hlcmVudF9tYXBfdHlwZShlbmdpbmUtPmk5MTUp
IHwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYwppbmRleCBhYTRj
OWU4MjEzOGUuLjY5NzE4OTYxYWFlOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfcmluZ2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X3JpbmdidWZmZXIuYwpAQCAtMTQzNyw3ICsxNDM3LDcgQEAgc3RhdGljIGludCByaW5nX2NvbnRl
eHRfcGluKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIAkJY2UtPnN0YXRlID0gdm1hOwogCX0K
IAotCWVyciA9IGludGVsX2NvbnRleHRfYWN0aXZlKGNlLCBQSU5fSElHSCk7CisJZXJyID0gaW50
ZWxfY29udGV4dF9hY3RpdmUoY2UpOwogCWlmIChlcnIpCiAJCXJldHVybiBlcnI7CiAKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L21vY2tfZW5naW5lLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9tb2NrX2VuZ2luZS5jCmluZGV4IDAwYzY2NmQzZTY1Mi4uZDg4ZGNkMjFl
YTZjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9tb2NrX2VuZ2luZS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L21vY2tfZW5naW5lLmMKQEAgLTE1NCw3ICsxNTQs
NyBAQCBzdGF0aWMgaW50IG1vY2tfY29udGV4dF9waW4oc3RydWN0IGludGVsX2NvbnRleHQgKmNl
KQogCQkJcmV0dXJuIC1FTk9NRU07CiAJfQogCi0JcmV0ID0gaW50ZWxfY29udGV4dF9hY3RpdmUo
Y2UsIFBJTl9ISUdIKTsKKwlyZXQgPSBpbnRlbF9jb250ZXh0X2FjdGl2ZShjZSk7CiAJaWYgKHJl
dCkKIAkJcmV0dXJuIHJldDsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9hY3RpdmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMKaW5kZXggMTAw
ZTQwYWZjOWQ2Li40ODg4ZWY3NDVjNmIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfYWN0aXZlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYwpA
QCAtMzAsNDggKzMwLDQ5IEBAIHN0cnVjdCBhY3RpdmVfbm9kZSB7CiB9OwogCiBzdGF0aWMgdm9p
ZAotX19hY3RpdmVfcGFyayhzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKK2FjdGl2ZV9yZXRpcmUo
c3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiB7CisJc3RydWN0IHJiX3Jvb3Qgcm9vdCA9IFJCX1JP
T1Q7CiAJc3RydWN0IGFjdGl2ZV9ub2RlICppdCwgKm47CisJYm9vbCByZXRpcmUgPSBmYWxzZTsK
IAotCXJidHJlZV9wb3N0b3JkZXJfZm9yX2VhY2hfZW50cnlfc2FmZShpdCwgbiwgJnJlZi0+dHJl
ZSwgbm9kZSkgewotCQlHRU1fQlVHX09OKGk5MTVfYWN0aXZlX3JlcXVlc3RfaXNzZXQoJml0LT5i
YXNlKSk7Ci0JCWttZW1fY2FjaGVfZnJlZShnbG9iYWwuc2xhYl9jYWNoZSwgaXQpOworCUdFTV9C
VUdfT04oIWF0b21pY19yZWFkKCZyZWYtPmNvdW50KSk7CisJaWYgKGF0b21pY19hZGRfdW5sZXNz
KCZyZWYtPmNvdW50LCAtMSwgMSkpCisJCXJldHVybjsKKworCS8qIE9uZSBhY3RpdmUgbWF5IGJl
IGZsdXNoZWQgZnJvbSBpbnNpZGUgdGhlIGFjcXVpcmUgb2YgYW5vdGhlciAqLworCW11dGV4X2xv
Y2tfbmVzdGVkKCZyZWYtPm11dGV4LCBTSU5HTEVfREVQVEhfTkVTVElORyk7CisKKwkvKiByZXR1
cm4gdGhlIHVudXNlZCBub2RlcyB0byBvdXIgc2xhYmNhY2hlIC0tIGZsdXNoaW5nIHRoZSBhbGxv
Y2F0b3IgKi8KKwlpZiAoYXRvbWljX2RlY19hbmRfdGVzdCgmcmVmLT5jb3VudCkpIHsKKwkJcm9v
dCA9IHJlZi0+dHJlZTsKKwkJcmVmLT50cmVlID0gUkJfUk9PVDsKKwkJcmVmLT5jYWNoZSA9IE5V
TEw7CisJCXJldGlyZSA9IHRydWU7CiAJfQotCXJlZi0+dHJlZSA9IFJCX1JPT1Q7Ci19CiAKLXN0
YXRpYyB2b2lkCi1fX2FjdGl2ZV9yZXRpcmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCi17Ci0J
R0VNX0JVR19PTighcmVmLT5jb3VudCk7Ci0JaWYgKC0tcmVmLT5jb3VudCkKLQkJcmV0dXJuOwor
CW11dGV4X3VubG9jaygmcmVmLT5tdXRleCk7CiAKLQkvKiByZXR1cm4gdGhlIHVudXNlZCBub2Rl
cyB0byBvdXIgc2xhYmNhY2hlICovCi0JX19hY3RpdmVfcGFyayhyZWYpOworCWlmIChyZXRpcmUp
CisJCXJlZi0+cmV0aXJlKHJlZik7CiAKLQlyZWYtPnJldGlyZShyZWYpOworCXJidHJlZV9wb3N0
b3JkZXJfZm9yX2VhY2hfZW50cnlfc2FmZShpdCwgbiwgJnJvb3QsIG5vZGUpIHsKKwkJR0VNX0JV
R19PTihpOTE1X2FjdGl2ZV9yZXF1ZXN0X2lzc2V0KCZpdC0+YmFzZSkpOworCQlrbWVtX2NhY2hl
X2ZyZWUoZ2xvYmFsLnNsYWJfY2FjaGUsIGl0KTsKKwl9CiB9CiAKIHN0YXRpYyB2b2lkCiBub2Rl
X3JldGlyZShzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYmFzZSwgc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnEpCiB7Ci0JX19hY3RpdmVfcmV0aXJlKGNvbnRhaW5lcl9vZihiYXNlLCBzdHJ1Y3Qg
YWN0aXZlX25vZGUsIGJhc2UpLT5yZWYpOwotfQotCi1zdGF0aWMgdm9pZAotbGFzdF9yZXRpcmUo
c3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmJhc2UsIHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
KQotewotCV9fYWN0aXZlX3JldGlyZShjb250YWluZXJfb2YoYmFzZSwgc3RydWN0IGk5MTVfYWN0
aXZlLCBsYXN0KSk7CisJYWN0aXZlX3JldGlyZShjb250YWluZXJfb2YoYmFzZSwgc3RydWN0IGFj
dGl2ZV9ub2RlLCBiYXNlKS0+cmVmKTsKIH0KIAogc3RhdGljIHN0cnVjdCBpOTE1X2FjdGl2ZV9y
ZXF1ZXN0ICoKIGFjdGl2ZV9pbnN0YW5jZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgdTY0IGlk
eCkKIHsKLQlzdHJ1Y3QgYWN0aXZlX25vZGUgKm5vZGU7CisJc3RydWN0IGFjdGl2ZV9ub2RlICpu
b2RlLCAqcHJlYWxsb2M7CiAJc3RydWN0IHJiX25vZGUgKipwLCAqcGFyZW50OwotCXN0cnVjdCBp
OTE1X3JlcXVlc3QgKm9sZDsKIAogCS8qCiAJICogV2UgdHJhY2sgdGhlIG1vc3QgcmVjZW50bHkg
dXNlZCB0aW1lbGluZSB0byBza2lwIGEgcmJ0cmVlIHNlYXJjaApAQCAtNzksMjAgKzgwLDE3IEBA
IGFjdGl2ZV9pbnN0YW5jZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgdTY0IGlkeCkKIAkgKiBh
dCBhbGwuIFdlIGNhbiByZXVzZSB0aGUgbGFzdCBzbG90IGlmIGl0IGlzIGVtcHR5LCB0aGF0IGlz
CiAJICogYWZ0ZXIgdGhlIHByZXZpb3VzIGFjdGl2aXR5IGhhcyBiZWVuIHJldGlyZWQsIG9yIGlm
IGl0IG1hdGNoZXMgdGhlCiAJICogY3VycmVudCB0aW1lbGluZS4KLQkgKgotCSAqIE5vdGUgdGhh
dCB3ZSBhbGxvdyB0aGUgdGltZWxpbmUgdG8gYmUgYWN0aXZlIHNpbXVsdGFuZW91c2x5IGluCi0J
ICogdGhlIHJidHJlZSBhbmQgdGhlIGxhc3QgY2FjaGUuIFdlIGRvIHRoaXMgdG8gYXZvaWQgaGF2
aW5nCi0JICogdG8gc2VhcmNoIGFuZCByZXBsYWNlIHRoZSByYnRyZWUgZWxlbWVudCBmb3IgYSBu
ZXcgdGltZWxpbmUsIHdpdGgKLQkgKiB0aGUgY29zdCBiZWluZyB0aGF0IHdlIG11c3QgYmUgYXdh
cmUgdGhhdCB0aGUgcmVmIG1heSBiZSByZXRpcmVkCi0JICogdHdpY2UgZm9yIHRoZSBzYW1lIHRp
bWVsaW5lIChhcyB0aGUgb2xkZXIgcmJ0cmVlIGVsZW1lbnQgd2lsbCBiZQotCSAqIHJldGlyZWQg
YmVmb3JlIHRoZSBuZXcgcmVxdWVzdCBhZGRlZCB0byBsYXN0KS4KIAkgKi8KLQlvbGQgPSBpOTE1
X2FjdGl2ZV9yZXF1ZXN0X3JhdygmcmVmLT5sYXN0LCBCS0wocmVmKSk7Ci0JaWYgKCFvbGQgfHwg
b2xkLT5mZW5jZS5jb250ZXh0ID09IGlkeCkKLQkJZ290byBvdXQ7CisJbm9kZSA9IFJFQURfT05D
RShyZWYtPmNhY2hlKTsKKwlpZiAobm9kZSAmJiBub2RlLT50aW1lbGluZSA9PSBpZHgpCisJCXJl
dHVybiAmbm9kZS0+YmFzZTsKKworCS8qIFByZWFsbG9jYXRlIGEgcmVwbGFjZW1lbnQsIGp1c3Qg
aW4gY2FzZSAqLworCXByZWFsbG9jID0ga21lbV9jYWNoZV9hbGxvYyhnbG9iYWwuc2xhYl9jYWNo
ZSwgR0ZQX0tFUk5FTCk7CisJaWYgKCFwcmVhbGxvYykKKwkJcmV0dXJuIE5VTEw7CiAKLQkvKiBN
b3ZlIHRoZSBjdXJyZW50bHkgYWN0aXZlIGZlbmNlIGludG8gdGhlIHJidHJlZSAqLwotCWlkeCA9
IG9sZC0+ZmVuY2UuY29udGV4dDsKKwltdXRleF9sb2NrKCZyZWYtPm11dGV4KTsKIAogCXBhcmVu
dCA9IE5VTEw7CiAJcCA9ICZyZWYtPnRyZWUucmJfbm9kZTsKQEAgLTEwMCw4ICs5OCwxMCBAQCBh
Y3RpdmVfaW5zdGFuY2Uoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsIHU2NCBpZHgpCiAJCXBhcmVu
dCA9ICpwOwogCiAJCW5vZGUgPSByYl9lbnRyeShwYXJlbnQsIHN0cnVjdCBhY3RpdmVfbm9kZSwg
bm9kZSk7Ci0JCWlmIChub2RlLT50aW1lbGluZSA9PSBpZHggJiYgIUlTX0VSUihub2RlLT5iYXNl
LnJlcXVlc3QpKQotCQkJZ290byByZXBsYWNlOworCQlpZiAobm9kZS0+dGltZWxpbmUgPT0gaWR4
ICYmICFJU19FUlIobm9kZS0+YmFzZS5yZXF1ZXN0KSkgeworCQkJa21lbV9jYWNoZV9mcmVlKGds
b2JhbC5zbGFiX2NhY2hlLCBwcmVhbGxvYyk7CisJCQlnb3RvIG91dDsKKwkJfQogCiAJCWlmIChu
b2RlLT50aW1lbGluZSA8IGlkeCkKIAkJCXAgPSAmcGFyZW50LT5yYl9yaWdodDsKQEAgLTEwOSwx
NyArMTA5LDcgQEAgYWN0aXZlX2luc3RhbmNlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCB1NjQg
aWR4KQogCQkJcCA9ICZwYXJlbnQtPnJiX2xlZnQ7CiAJfQogCi0Jbm9kZSA9IGttZW1fY2FjaGVf
YWxsb2MoZ2xvYmFsLnNsYWJfY2FjaGUsIEdGUF9LRVJORUwpOwotCi0JLyoga21hbGxvYyBtYXkg
cmV0aXJlIHRoZSByZWYtPmxhc3QgKHRoYW5rcyBzaHJpbmtlcikhICovCi0JaWYgKHVubGlrZWx5
KCFpOTE1X2FjdGl2ZV9yZXF1ZXN0X3JhdygmcmVmLT5sYXN0LCBCS0wocmVmKSkpKSB7Ci0JCWtt
ZW1fY2FjaGVfZnJlZShnbG9iYWwuc2xhYl9jYWNoZSwgbm9kZSk7Ci0JCWdvdG8gb3V0OwotCX0K
LQotCWlmICh1bmxpa2VseSghbm9kZSkpCi0JCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwotCisJ
bm9kZSA9IHByZWFsbG9jOwogCWk5MTVfYWN0aXZlX3JlcXVlc3RfaW5pdCgmbm9kZS0+YmFzZSwg
TlVMTCwgbm9kZV9yZXRpcmUpOwogCW5vZGUtPnJlZiA9IHJlZjsKIAlub2RlLT50aW1lbGluZSA9
IGlkeDsKQEAgLTEyNywzOCArMTE3LDI3IEBAIGFjdGl2ZV9pbnN0YW5jZShzdHJ1Y3QgaTkxNV9h
Y3RpdmUgKnJlZiwgdTY0IGlkeCkKIAlyYl9saW5rX25vZGUoJm5vZGUtPm5vZGUsIHBhcmVudCwg
cCk7CiAJcmJfaW5zZXJ0X2NvbG9yKCZub2RlLT5ub2RlLCAmcmVmLT50cmVlKTsKIAotcmVwbGFj
ZToKLQkvKgotCSAqIE92ZXJ3cml0ZSB0aGUgcHJldmlvdXMgYWN0aXZlIHNsb3QgaW4gdGhlIHJi
dHJlZSB3aXRoIGxhc3QsCi0JICogbGVhdmluZyBsYXN0IHplcm9lZC4gSWYgdGhlIHByZXZpb3Vz
IHNsb3QgaXMgc3RpbGwgYWN0aXZlLAotCSAqIHdlIG11c3QgYmUgY2FyZWZ1bCBhcyB3ZSBub3cg
b25seSBleHBlY3QgdG8gcmVjZWl2ZSBvbmUgcmV0aXJlCi0JICogY2FsbGJhY2sgbm90IHR3bywg
YW5kIHNvIG11Y2ggdW5kbyB0aGUgYWN0aXZlIGNvdW50aW5nIGZvciB0aGUKLQkgKiBvdmVyd3Jp
dHRlbiBzbG90LgotCSAqLwotCWlmIChpOTE1X2FjdGl2ZV9yZXF1ZXN0X2lzc2V0KCZub2RlLT5i
YXNlKSkgewotCQkvKiBSZXRpcmUgb3Vyc2VsdmVzIGZyb20gdGhlIG9sZCBycS0+YWN0aXZlX2xp
c3QgKi8KLQkJX19saXN0X2RlbF9lbnRyeSgmbm9kZS0+YmFzZS5saW5rKTsKLQkJcmVmLT5jb3Vu
dC0tOwotCQlHRU1fQlVHX09OKCFyZWYtPmNvdW50KTsKLQl9Ci0JR0VNX0JVR19PTihsaXN0X2Vt
cHR5KCZyZWYtPmxhc3QubGluaykpOwotCWxpc3RfcmVwbGFjZV9pbml0KCZyZWYtPmxhc3QubGlu
aywgJm5vZGUtPmJhc2UubGluayk7Ci0Jbm9kZS0+YmFzZS5yZXF1ZXN0ID0gZmV0Y2hfYW5kX3pl
cm8oJnJlZi0+bGFzdC5yZXF1ZXN0KTsKLQogb3V0OgotCXJldHVybiAmcmVmLT5sYXN0OworCXJl
Zi0+Y2FjaGUgPSBub2RlOworCW11dGV4X3VubG9jaygmcmVmLT5tdXRleCk7CisKKwlyZXR1cm4g
Jm5vZGUtPmJhc2U7CiB9CiAKLXZvaWQgaTkxNV9hY3RpdmVfaW5pdChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSwKLQkJICAgICAgc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCi0JCSAgICAg
IHZvaWQgKCpyZXRpcmUpKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKSkKK3ZvaWQgX19pOTE1X2Fj
dGl2ZV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAorCQkJc3RydWN0IGk5MTVf
YWN0aXZlICpyZWYsCisJCQlpbnQgKCphY3RpdmUpKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKSwK
KwkJCXZvaWQgKCpyZXRpcmUpKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKSwKKwkJCXN0cnVjdCBs
b2NrX2NsYXNzX2tleSAqa2V5KQogewogCXJlZi0+aTkxNSA9IGk5MTU7CisJcmVmLT5hY3RpdmUg
PSBhY3RpdmU7CiAJcmVmLT5yZXRpcmUgPSByZXRpcmU7CiAJcmVmLT50cmVlID0gUkJfUk9PVDsK
LQlpOTE1X2FjdGl2ZV9yZXF1ZXN0X2luaXQoJnJlZi0+bGFzdCwgTlVMTCwgbGFzdF9yZXRpcmUp
OworCXJlZi0+Y2FjaGUgPSBOVUxMOwogCWluaXRfbGxpc3RfaGVhZCgmcmVmLT5iYXJyaWVycyk7
Ci0JcmVmLT5jb3VudCA9IDA7CisJYXRvbWljX3NldCgmcmVmLT5jb3VudCwgMCk7CisJX19tdXRl
eF9pbml0KCZyZWYtPm11dGV4LCAiaTkxNV9hY3RpdmUiLCBrZXkpOwogfQogCiBpbnQgaTkxNV9h
Y3RpdmVfcmVmKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLApAQCAtMTY2LDYwICsxNDUsODAgQEAg
aW50IGk5MTVfYWN0aXZlX3JlZihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKIAkJICAgIHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxKQogewogCXN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3Rp
dmU7Ci0JaW50IGVyciA9IDA7CisJaW50IGVycjsKIAogCS8qIFByZXZlbnQgcmVhcGluZyBpbiBj
YXNlIHdlIG1hbGxvYy93YWl0IHdoaWxlIGJ1aWxkaW5nIHRoZSB0cmVlICovCi0JaTkxNV9hY3Rp
dmVfYWNxdWlyZShyZWYpOworCWVyciA9IGk5MTVfYWN0aXZlX2FjcXVpcmUocmVmKTsKKwlpZiAo
ZXJyKQorCQlyZXR1cm4gZXJyOwogCiAJYWN0aXZlID0gYWN0aXZlX2luc3RhbmNlKHJlZiwgdGlt
ZWxpbmUpOwotCWlmIChJU19FUlIoYWN0aXZlKSkgewotCQllcnIgPSBQVFJfRVJSKGFjdGl2ZSk7
CisJaWYgKCFhY3RpdmUpIHsKKwkJZXJyID0gLUVOT01FTTsKIAkJZ290byBvdXQ7CiAJfQogCiAJ
aWYgKCFpOTE1X2FjdGl2ZV9yZXF1ZXN0X2lzc2V0KGFjdGl2ZSkpCi0JCXJlZi0+Y291bnQrKzsK
KwkJYXRvbWljX2luYygmcmVmLT5jb3VudCk7CiAJX19pOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldChh
Y3RpdmUsIHJxKTsKIAotCUdFTV9CVUdfT04oIXJlZi0+Y291bnQpOwogb3V0OgogCWk5MTVfYWN0
aXZlX3JlbGVhc2UocmVmKTsKIAlyZXR1cm4gZXJyOwogfQogCi1ib29sIGk5MTVfYWN0aXZlX2Fj
cXVpcmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCitpbnQgaTkxNV9hY3RpdmVfYWNxdWlyZShz
dHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIHsKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKEJLTChyZWYp
KTsKLQlyZXR1cm4gIXJlZi0+Y291bnQrKzsKKwlpbnQgZXJyOworCisJaWYgKGF0b21pY19hZGRf
dW5sZXNzKCZyZWYtPmNvdW50LCAxLCAwKSkKKwkJcmV0dXJuIDA7CisKKwllcnIgPSBtdXRleF9s
b2NrX2ludGVycnVwdGlibGUoJnJlZi0+bXV0ZXgpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7
CisKKwlpZiAoIWF0b21pY19yZWFkKCZyZWYtPmNvdW50KSAmJiByZWYtPmFjdGl2ZSkKKwkJZXJy
ID0gcmVmLT5hY3RpdmUocmVmKTsKKwlpZiAoIWVycikKKwkJYXRvbWljX2luYygmcmVmLT5jb3Vu
dCk7CisKKwltdXRleF91bmxvY2soJnJlZi0+bXV0ZXgpOworCisJcmV0dXJuIGVycjsKIH0KIAog
dm9pZCBpOTE1X2FjdGl2ZV9yZWxlYXNlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQogewotCWxv
Y2tkZXBfYXNzZXJ0X2hlbGQoQktMKHJlZikpOwotCV9fYWN0aXZlX3JldGlyZShyZWYpOworCWFj
dGl2ZV9yZXRpcmUocmVmKTsKIH0KIAogaW50IGk5MTVfYWN0aXZlX3dhaXQoc3RydWN0IGk5MTVf
YWN0aXZlICpyZWYpCiB7CiAJc3RydWN0IGFjdGl2ZV9ub2RlICppdCwgKm47Ci0JaW50IHJldCA9
IDA7CisJaW50IGVycjsKIAotCWlmIChpOTE1X2FjdGl2ZV9hY3F1aXJlKHJlZikpCi0JCWdvdG8g
b3V0X3JlbGVhc2U7CisJaWYgKFJCX0VNUFRZX1JPT1QoJnJlZi0+dHJlZSkpCisJCXJldHVybiAw
OworCisJZXJyID0gaTkxNV9hY3RpdmVfYWNxdWlyZShyZWYpOyAvKiBBdm9pZCByZXRpcmluZyBv
dXJzZWx2ZXMgKi8KKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOwogCi0JcmV0ID0gaTkxNV9hY3Rp
dmVfcmVxdWVzdF9yZXRpcmUoJnJlZi0+bGFzdCwgQktMKHJlZikpOwotCWlmIChyZXQpCi0JCWdv
dG8gb3V0X3JlbGVhc2U7CisJZXJyID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZyZWYtPm11
dGV4KTsKKwlpZiAoZXJyKQorCQlnb3RvIG91dDsKIAogCXJidHJlZV9wb3N0b3JkZXJfZm9yX2Vh
Y2hfZW50cnlfc2FmZShpdCwgbiwgJnJlZi0+dHJlZSwgbm9kZSkgewotCQlyZXQgPSBpOTE1X2Fj
dGl2ZV9yZXF1ZXN0X3JldGlyZSgmaXQtPmJhc2UsIEJLTChyZWYpKTsKLQkJaWYgKHJldCkKKwkJ
ZXJyID0gaTkxNV9hY3RpdmVfcmVxdWVzdF9yZXRpcmUoJml0LT5iYXNlLCBCS0wocmVmKSk7CisJ
CWlmIChlcnIpCiAJCQlicmVhazsKIAl9CisJbXV0ZXhfdW5sb2NrKCZyZWYtPm11dGV4KTsKIAot
b3V0X3JlbGVhc2U6CitvdXQ6CiAJaTkxNV9hY3RpdmVfcmVsZWFzZShyZWYpOwotCXJldHVybiBy
ZXQ7CisJcmV0dXJuIGVycjsKIH0KIAogaW50IGk5MTVfcmVxdWVzdF9hd2FpdF9hY3RpdmVfcmVx
dWVzdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKQEAgLTIzNCwyMyArMjMzLDI0IEBAIGludCBp
OTE1X3JlcXVlc3RfYXdhaXRfYWN0aXZlX3JlcXVlc3Qoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEs
CiBpbnQgaTkxNV9yZXF1ZXN0X2F3YWl0X2FjdGl2ZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwg
c3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiB7CiAJc3RydWN0IGFjdGl2ZV9ub2RlICppdCwgKm47
Ci0JaW50IGVyciA9IDA7CisJaW50IGVycjsKIAotCS8qIGF3YWl0IGFsbG9jYXRlcyBhbmQgc28g
d2UgbmVlZCB0byBhdm9pZCBoaXR0aW5nIHRoZSBzaHJpbmtlciAqLwotCWlmIChpOTE1X2FjdGl2
ZV9hY3F1aXJlKHJlZikpCi0JCWdvdG8gb3V0OyAvKiB3YXMgaWRsZSAqLworCWlmIChSQl9FTVBU
WV9ST09UKCZyZWYtPnRyZWUpKQorCQlyZXR1cm4gMDsKIAotCWVyciA9IGk5MTVfcmVxdWVzdF9h
d2FpdF9hY3RpdmVfcmVxdWVzdChycSwgJnJlZi0+bGFzdCk7CisJLyogYXdhaXQgYWxsb2NhdGVz
IGFuZCBzbyB3ZSBuZWVkIHRvIGF2b2lkIGhpdHRpbmcgdGhlIHNocmlua2VyICovCisJZXJyID0g
aTkxNV9hY3RpdmVfYWNxdWlyZShyZWYpOwogCWlmIChlcnIpCi0JCWdvdG8gb3V0OworCQlyZXR1
cm4gZXJyOwogCisJbXV0ZXhfbG9jaygmcmVmLT5tdXRleCk7CiAJcmJ0cmVlX3Bvc3RvcmRlcl9m
b3JfZWFjaF9lbnRyeV9zYWZlKGl0LCBuLCAmcmVmLT50cmVlLCBub2RlKSB7CiAJCWVyciA9IGk5
MTVfcmVxdWVzdF9hd2FpdF9hY3RpdmVfcmVxdWVzdChycSwgJml0LT5iYXNlKTsKIAkJaWYgKGVy
cikKLQkJCWdvdG8gb3V0OworCQkJYnJlYWs7CiAJfQorCW11dGV4X3VubG9jaygmcmVmLT5tdXRl
eCk7CiAKLW91dDoKIAlpOTE1X2FjdGl2ZV9yZWxlYXNlKHJlZik7CiAJcmV0dXJuIGVycjsKIH0K
QEAgLTI1OCw5ICsyNTgsOSBAQCBpbnQgaTkxNV9yZXF1ZXN0X2F3YWl0X2FjdGl2ZShzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycSwgc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiAjaWYgSVNfRU5BQkxF
RChDT05GSUdfRFJNX0k5MTVfREVCVUdfR0VNKQogdm9pZCBpOTE1X2FjdGl2ZV9maW5pKHN0cnVj
dCBpOTE1X2FjdGl2ZSAqcmVmKQogewotCUdFTV9CVUdfT04oaTkxNV9hY3RpdmVfcmVxdWVzdF9p
c3NldCgmcmVmLT5sYXN0KSk7CiAJR0VNX0JVR19PTighUkJfRU1QVFlfUk9PVCgmcmVmLT50cmVl
KSk7Ci0JR0VNX0JVR19PTihyZWYtPmNvdW50KTsKKwlHRU1fQlVHX09OKGF0b21pY19yZWFkKCZy
ZWYtPmNvdW50KSk7CisJbXV0ZXhfZGVzdHJveSgmcmVmLT5tdXRleCk7CiB9CiAjZW5kaWYKIApA
QCAtMjg2LDcgKzI4Niw3IEBAIGludCBpOTE1X2FjdGl2ZV9hY3F1aXJlX3ByZWFsbG9jYXRlX2Jh
cnJpZXIoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCiAJCQkJCSAodm9pZCAqKWVuZ2luZSwgbm9k
ZV9yZXRpcmUpOwogCQlub2RlLT50aW1lbGluZSA9IGtjdHgtPnJpbmctPnRpbWVsaW5lLT5mZW5j
ZV9jb250ZXh0OwogCQlub2RlLT5yZWYgPSByZWY7Ci0JCXJlZi0+Y291bnQrKzsKKwkJYXRvbWlj
X2luYygmcmVmLT5jb3VudCk7CiAKIAkJbGxpc3RfYWRkKChzdHJ1Y3QgbGxpc3Rfbm9kZSAqKSZu
b2RlLT5iYXNlLmxpbmssCiAJCQkgICZyZWYtPmJhcnJpZXJzKTsKQEAgLTI5OSw4ICsyOTksOSBA
QCB2b2lkIGk5MTVfYWN0aXZlX2FjcXVpcmVfYmFycmllcihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJl
ZikKIHsKIAlzdHJ1Y3QgbGxpc3Rfbm9kZSAqcG9zLCAqbmV4dDsKIAotCWk5MTVfYWN0aXZlX2Fj
cXVpcmUocmVmKTsKKwlHRU1fQlVHX09OKGk5MTVfYWN0aXZlX2lzX2lkbGUocmVmKSk7CiAKKwlt
dXRleF9sb2NrX25lc3RlZCgmcmVmLT5tdXRleCwgU0lOR0xFX0RFUFRIX05FU1RJTkcpOwogCWxs
aXN0X2Zvcl9lYWNoX3NhZmUocG9zLCBuZXh0LCBsbGlzdF9kZWxfYWxsKCZyZWYtPmJhcnJpZXJz
KSkgewogCQlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJCXN0cnVjdCBhY3RpdmVf
bm9kZSAqbm9kZTsKQEAgLTMyOSw3ICszMzAsNyBAQCB2b2lkIGk5MTVfYWN0aXZlX2FjcXVpcmVf
YmFycmllcihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIAkJbGxpc3RfYWRkKChzdHJ1Y3QgbGxp
c3Rfbm9kZSAqKSZub2RlLT5iYXNlLmxpbmssCiAJCQkgICZlbmdpbmUtPmJhcnJpZXJfdGFza3Mp
OwogCX0KLQlpOTE1X2FjdGl2ZV9yZWxlYXNlKHJlZik7CisJbXV0ZXhfdW5sb2NrKCZyZWYtPm11
dGV4KTsKIH0KIAogdm9pZCBpOTE1X3JlcXVlc3RfYWRkX2JhcnJpZXJzKHN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJxKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUu
aCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmgKaW5kZXggZDU1ZDM3NjczOTQ0
Li42ZmE5MjYzY2E0MDcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0
aXZlLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaApAQCAtMzY5LDkg
KzM2OSwxNiBAQCBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3JldGlyZShzdHJ1Y3QgaTkxNV9hY3RpdmVf
cmVxdWVzdCAqYWN0aXZlLAogICogc3luY2hyb25pc2F0aW9uLgogICovCiAKLXZvaWQgaTkxNV9h
Y3RpdmVfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKLQkJICAgICAgc3RydWN0
IGk5MTVfYWN0aXZlICpyZWYsCi0JCSAgICAgIHZvaWQgKCpyZXRpcmUpKHN0cnVjdCBpOTE1X2Fj
dGl2ZSAqcmVmKSk7Cit2b2lkIF9faTkxNV9hY3RpdmVfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwKKwkJCXN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLAorCQkJaW50ICgqYWN0aXZl
KShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiksCisJCQl2b2lkICgqcmV0aXJlKShzdHJ1Y3QgaTkx
NV9hY3RpdmUgKnJlZiksCisJCQlzdHJ1Y3QgbG9ja19jbGFzc19rZXkgKmtleSk7CisjZGVmaW5l
IGk5MTVfYWN0aXZlX2luaXQoaTkxNSwgcmVmLCBhY3RpdmUsIHJldGlyZSkgZG8gewkJXAorCXN0
YXRpYyBzdHJ1Y3QgbG9ja19jbGFzc19rZXkgX19rZXk7CQkJCVwKKwkJCQkJCQkJCVwKKwlfX2k5
MTVfYWN0aXZlX2luaXQoaTkxNSwgcmVmLCBhY3RpdmUsIHJldGlyZSwgJl9fa2V5KTsJCVwKK30g
d2hpbGUgKDApCiAKIGludCBpOTE1X2FjdGl2ZV9yZWYoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYs
CiAJCSAgICB1NjQgdGltZWxpbmUsCkBAIC0zODQsMjAgKzM5MSwxNCBAQCBpbnQgaTkxNV9yZXF1
ZXN0X2F3YWl0X2FjdGl2ZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKIGludCBpOTE1X3JlcXVl
c3RfYXdhaXRfYWN0aXZlX3JlcXVlc3Qoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCiAJCQkJICAg
ICAgc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSk7CiAKLWJvb2wgaTkxNV9hY3Rp
dmVfYWNxdWlyZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7Ci0KLXN0YXRpYyBpbmxpbmUgdm9p
ZCBpOTE1X2FjdGl2ZV9jYW5jZWwoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCi17Ci0JR0VNX0JV
R19PTihyZWYtPmNvdW50ICE9IDEpOwotCXJlZi0+Y291bnQgPSAwOwotfQotCitpbnQgaTkxNV9h
Y3RpdmVfYWNxdWlyZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7CiB2b2lkIGk5MTVfYWN0aXZl
X3JlbGVhc2Uoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpOwordm9pZCBfX2k5MTVfYWN0aXZlX3Jl
bGVhc2VfbmVzdGVkKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCBpbnQgc3ViY2xhc3MpOwogCiBz
dGF0aWMgaW5saW5lIGJvb2wKIGk5MTVfYWN0aXZlX2lzX2lkbGUoY29uc3Qgc3RydWN0IGk5MTVf
YWN0aXZlICpyZWYpCiB7Ci0JcmV0dXJuICFyZWYtPmNvdW50OworCXJldHVybiAhYXRvbWljX3Jl
YWQoJnJlZi0+Y291bnQpOwogfQogCiAjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfREVC
VUdfR0VNKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmVfdHlw
ZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5cGVzLmgKaW5kZXggYzAy
NTk5MWI5MjMzLi41YjBhMzAyNGNlMjQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfYWN0aXZlX3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3Rp
dmVfdHlwZXMuaApAQCAtNyw3ICs3LDkgQEAKICNpZm5kZWYgX0k5MTVfQUNUSVZFX1RZUEVTX0hf
CiAjZGVmaW5lIF9JOTE1X0FDVElWRV9UWVBFU19IXwogCisjaW5jbHVkZSA8bGludXgvYXRvbWlj
Lmg+CiAjaW5jbHVkZSA8bGludXgvbGxpc3QuaD4KKyNpbmNsdWRlIDxsaW51eC9tdXRleC5oPgog
I2luY2x1ZGUgPGxpbnV4L3JidHJlZS5oPgogI2luY2x1ZGUgPGxpbnV4L3JjdXBkYXRlLmg+CiAK
QEAgLTI0LDEzICsyNiwxNyBAQCBzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCB7CiAJaTkxNV9h
Y3RpdmVfcmV0aXJlX2ZuIHJldGlyZTsKIH07CiAKK3N0cnVjdCBhY3RpdmVfbm9kZTsKKwogc3Ry
dWN0IGk5MTVfYWN0aXZlIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNTsKIAorCXN0
cnVjdCBhY3RpdmVfbm9kZSAqY2FjaGU7CiAJc3RydWN0IHJiX3Jvb3QgdHJlZTsKLQlzdHJ1Y3Qg
aTkxNV9hY3RpdmVfcmVxdWVzdCBsYXN0OwotCXVuc2lnbmVkIGludCBjb3VudDsKKwlzdHJ1Y3Qg
bXV0ZXggbXV0ZXg7CisJYXRvbWljX3QgY291bnQ7CiAKKwlpbnQgKCphY3RpdmUpKHN0cnVjdCBp
OTE1X2FjdGl2ZSAqcmVmKTsKIAl2b2lkICgqcmV0aXJlKShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJl
Zik7CiAKIAlzdHJ1Y3QgbGxpc3RfaGVhZCBiYXJyaWVyczsKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
ZW1fZ3R0LmMKaW5kZXggYWNjM2NiN2NiMjE5Li5iOTM5ZDZhMTFhYWYgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtX2d0dC5jCkBAIC0yMDYyLDcgKzIwNjIsNyBAQCBzdGF0aWMgc3RydWN0IGk5
MTVfdm1hICpwZF92bWFfY3JlYXRlKHN0cnVjdCBnZW42X2h3X3BwZ3R0ICpwcGd0dCwgaW50IHNp
emUpCiAJaWYgKCF2bWEpCiAJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwogCi0JaTkxNV9hY3Rp
dmVfaW5pdChpOTE1LCAmdm1hLT5hY3RpdmUsIE5VTEwpOworCWk5MTVfYWN0aXZlX2luaXQoaTkx
NSwgJnZtYS0+YWN0aXZlLCBOVUxMLCBOVUxMKTsKIAlJTklUX0FDVElWRV9SRVFVRVNUKCZ2bWEt
Pmxhc3RfZmVuY2UpOwogCiAJdm1hLT52bSA9ICZnZ3R0LT52bTsKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfdGltZWxpbmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfdGltZWxpbmUuYwppbmRleCBjMzExY2U5YzZmOWQuLmUyZjkzMzZiYWI4MyAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV90aW1lbGluZS5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfdGltZWxpbmUuYwpAQCAtMTQ4LDYgKzE0OCwxNSBAQCBzdGF0aWMgdm9p
ZCBfX2NhY2hlbGluZV9yZXRpcmUoc3RydWN0IGk5MTVfYWN0aXZlICphY3RpdmUpCiAJCV9faWRs
ZV9jYWNoZWxpbmVfZnJlZShjbCk7CiB9CiAKK3N0YXRpYyBpbnQgX19jYWNoZWxpbmVfYWN0aXZl
KHN0cnVjdCBpOTE1X2FjdGl2ZSAqYWN0aXZlKQoreworCXN0cnVjdCBpOTE1X3RpbWVsaW5lX2Nh
Y2hlbGluZSAqY2wgPQorCQljb250YWluZXJfb2YoYWN0aXZlLCB0eXBlb2YoKmNsKSwgYWN0aXZl
KTsKKworCV9faTkxNV92bWFfcGluKGNsLT5od3NwLT52bWEpOworCXJldHVybiAwOworfQorCiBz
dGF0aWMgc3RydWN0IGk5MTVfdGltZWxpbmVfY2FjaGVsaW5lICoKIGNhY2hlbGluZV9hbGxvYyhz
dHJ1Y3QgaTkxNV90aW1lbGluZV9od3NwICpod3NwLCB1bnNpZ25lZCBpbnQgY2FjaGVsaW5lKQog
ewpAQCAtMTcwLDE1ICsxNzksMTYgQEAgY2FjaGVsaW5lX2FsbG9jKHN0cnVjdCBpOTE1X3RpbWVs
aW5lX2h3c3AgKmh3c3AsIHVuc2lnbmVkIGludCBjYWNoZWxpbmUpCiAJY2wtPmh3c3AgPSBod3Nw
OwogCWNsLT52YWRkciA9IHBhZ2VfcGFja19iaXRzKHZhZGRyLCBjYWNoZWxpbmUpOwogCi0JaTkx
NV9hY3RpdmVfaW5pdChod3NwX3RvX2k5MTUoaHdzcCksICZjbC0+YWN0aXZlLCBfX2NhY2hlbGlu
ZV9yZXRpcmUpOworCWk5MTVfYWN0aXZlX2luaXQoaHdzcF90b19pOTE1KGh3c3ApLCAmY2wtPmFj
dGl2ZSwKKwkJCSBfX2NhY2hlbGluZV9hY3RpdmUsIF9fY2FjaGVsaW5lX3JldGlyZSk7CiAKIAly
ZXR1cm4gY2w7CiB9CiAKIHN0YXRpYyB2b2lkIGNhY2hlbGluZV9hY3F1aXJlKHN0cnVjdCBpOTE1
X3RpbWVsaW5lX2NhY2hlbGluZSAqY2wpCiB7Ci0JaWYgKGNsICYmIGk5MTVfYWN0aXZlX2FjcXVp
cmUoJmNsLT5hY3RpdmUpKQotCQlfX2k5MTVfdm1hX3BpbihjbC0+aHdzcC0+dm1hKTsKKwlpZiAo
Y2wpCisJCWk5MTVfYWN0aXZlX2FjcXVpcmUoJmNsLT5hY3RpdmUpOwogfQogCiBzdGF0aWMgdm9p
ZCBjYWNoZWxpbmVfcmVsZWFzZShzdHJ1Y3QgaTkxNV90aW1lbGluZV9jYWNoZWxpbmUgKmNsKQpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfdm1hLmMKaW5kZXggNmUwNGI0NDg5YWQyLi5iZTE1ZjBlMGM2ZWIgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV92bWEuYwpAQCAtNzcsNiArNzcsMTQgQEAgc3RhdGljIHZvaWQgdm1h
X3ByaW50X2FsbG9jYXRvcihzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgY29uc3QgY2hhciAqcmVhc29u
KQogCiAjZW5kaWYKIAorc3RhdGljIGludCBfX2k5MTVfdm1hX2FjdGl2ZShzdHJ1Y3QgaTkxNV9h
Y3RpdmUgKnJlZikKK3sKKwlzdHJ1Y3QgaTkxNV92bWEgKnZtYSA9IGNvbnRhaW5lcl9vZihyZWYs
IHR5cGVvZigqdm1hKSwgYWN0aXZlKTsKKworCWk5MTVfdm1hX2dldCh2bWEpOworCXJldHVybiAw
OworfQorCiBzdGF0aWMgdm9pZCBfX2k5MTVfdm1hX3JldGlyZShzdHJ1Y3QgaTkxNV9hY3RpdmUg
KnJlZikKIHsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYSA9IGNvbnRhaW5lcl9vZihyZWYsIHR5cGVv
Zigqdm1hKSwgYWN0aXZlKTsKQEAgLTEwNiw3ICsxMTQsOCBAQCB2bWFfY3JlYXRlKHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJdm1hLT5zaXplID0gb2JqLT5iYXNlLnNpemU7CiAJ
dm1hLT5kaXNwbGF5X2FsaWdubWVudCA9IEk5MTVfR1RUX01JTl9BTElHTk1FTlQ7CiAKLQlpOTE1
X2FjdGl2ZV9pbml0KHZtLT5pOTE1LCAmdm1hLT5hY3RpdmUsIF9faTkxNV92bWFfcmV0aXJlKTsK
KwlpOTE1X2FjdGl2ZV9pbml0KHZtLT5pOTE1LCAmdm1hLT5hY3RpdmUsCisJCQkgX19pOTE1X3Zt
YV9hY3RpdmUsIF9faTkxNV92bWFfcmV0aXJlKTsKIAlJTklUX0FDVElWRV9SRVFVRVNUKCZ2bWEt
Pmxhc3RfZmVuY2UpOwogCiAJSU5JVF9MSVNUX0hFQUQoJnZtYS0+Y2xvc2VkX2xpbmspOwpAQCAt
OTAzLDExICs5MTIsNyBAQCBpbnQgaTkxNV92bWFfbW92ZV90b19hY3RpdmUoc3RydWN0IGk5MTVf
dm1hICp2bWEsCiAJICogYWRkIHRoZSBhY3RpdmUgcmVmZXJlbmNlIGZpcnN0IGFuZCBxdWV1ZSBm
b3IgaXQgdG8gYmUgZHJvcHBlZAogCSAqICpsYXN0Ki4KIAkgKi8KLQlpZiAoaTkxNV9hY3RpdmVf
YWNxdWlyZSgmdm1hLT5hY3RpdmUpKQotCQlpOTE1X3ZtYV9nZXQodm1hKTsKLQogCWVyciA9IGk5
MTVfYWN0aXZlX3JlZigmdm1hLT5hY3RpdmUsIHJxLT5mZW5jZS5jb250ZXh0LCBycSk7Ci0JaTkx
NV9hY3RpdmVfcmVsZWFzZSgmdm1hLT5hY3RpdmUpOwogCWlmIChlcnIpCiAJCXJldHVybiBlcnI7
CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2
ZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfYWN0aXZlLmMKaW5kZXgg
Y2MxY2E0YmUxYTAwLi4zYjNjYTU2NTgxMjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3Nl
bGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jCkBAIC0zNiwxNCArMzYsMTIgQEAgc3RhdGljIGludCBfX2xp
dmVfYWN0aXZlX3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCWlmICghc3Vi
bWl0KQogCQlyZXR1cm4gLUVOT01FTTsKIAotCWk5MTVfYWN0aXZlX2luaXQoaTkxNSwgJmFjdGl2
ZS0+YmFzZSwgX19saXZlX2FjdGl2ZV9yZXRpcmUpOworCWk5MTVfYWN0aXZlX2luaXQoaTkxNSwg
JmFjdGl2ZS0+YmFzZSwgTlVMTCwgX19saXZlX2FjdGl2ZV9yZXRpcmUpOwogCWFjdGl2ZS0+cmV0
aXJlZCA9IGZhbHNlOwogCi0JaWYgKCFpOTE1X2FjdGl2ZV9hY3F1aXJlKCZhY3RpdmUtPmJhc2Up
KSB7Ci0JCXByX2VycigiRmlyc3QgaTkxNV9hY3RpdmVfYWNxdWlyZSBzaG91bGQgcmVwb3J0IGJl
aW5nIGlkbGVcbiIpOwotCQllcnIgPSAtRUlOVkFMOworCWVyciA9IGk5MTVfYWN0aXZlX2FjcXVp
cmUoJmFjdGl2ZS0+YmFzZSk7CisJaWYgKGVycikKIAkJZ290byBvdXQ7Ci0JfQogCiAJZm9yX2Vh
Y2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKIAkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7
CkBAIC03NCw5ICs3Miw5IEBAIHN0YXRpYyBpbnQgX19saXZlX2FjdGl2ZV9zZXR1cChzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJcHJfZXJyKCJpOTE1X2FjdGl2ZSByZXRpcmVkIGJl
Zm9yZSBzdWJtaXNzaW9uIVxuIik7CiAJCWVyciA9IC1FSU5WQUw7CiAJfQotCWlmIChhY3RpdmUt
PmJhc2UuY291bnQgIT0gY291bnQpIHsKKwlpZiAoYXRvbWljX3JlYWQoJmFjdGl2ZS0+YmFzZS5j
b3VudCkgIT0gY291bnQpIHsKIAkJcHJfZXJyKCJpOTE1X2FjdGl2ZSBub3QgdHJhY2tpbmcgYWxs
IHJlcXVlc3RzLCBmb3VuZCAlZCwgZXhwZWN0ZWQgJWRcbiIsCi0JCSAgICAgICBhY3RpdmUtPmJh
c2UuY291bnQsIGNvdW50KTsKKwkJICAgICAgIGF0b21pY19yZWFkKCZhY3RpdmUtPmJhc2UuY291
bnQpLCBjb3VudCk7CiAJCWVyciA9IC1FSU5WQUw7CiAJfQogCi0tIAoyLjIwLjEKCl9fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5n
IGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVk
ZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

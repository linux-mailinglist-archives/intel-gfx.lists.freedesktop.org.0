Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 4D15045549
	for <lists+intel-gfx@lfdr.de>; Fri, 14 Jun 2019 09:10:41 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 077E989020;
	Fri, 14 Jun 2019 07:10:38 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8E0EF88F1E
 for <intel-gfx@lists.freedesktop.org>; Fri, 14 Jun 2019 07:10:34 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16897529-1500050 
 for multiple; Fri, 14 Jun 2019 08:10:30 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 14 Jun 2019 08:10:08 +0100
Message-Id: <20190614071023.17929-25-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190614071023.17929-1-chris@chris-wilson.co.uk>
References: <20190614071023.17929-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 24/39] drm/i915: Coordinate i915_active with its
 own mutex
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Rm9yZ28gdGhlIHN0cnVjdF9tdXRleCBzZXJpYWxpc2F0aW9uIGZvciBpOTE1X2FjdGl2ZSwgYW5k
IGludGVycG9zZSBpdHMKb3duIG11dGV4IGhhbmRsaW5nIGZvciBhY3RpdmUvcmV0aXJlLgoKVGhp
cyBpcyBhIG11bHRpLWxheWVyZWQgc2xlaWdodC1vZi1oYW5kLiBGaXJzdCwgd2UgaGFkIHRvIGVu
c3VyZSB0aGF0IG5vCmFjdGl2ZS9yZXRpcmUgY2FsbGJhY2tzIGFjY2lkZW50YWxseSBpbnZlcnRl
ZCB0aGUgbXV0ZXggb3JkZXJpbmcgcnVsZXMsCm5vciBhc3N1bWVkIHRoYXQgdGhleSB3ZXJlIHRo
ZW1zZWx2ZXMgc2VyaWFsaXNlZCBieSBzdHJ1Y3RfbXV0ZXguIE1vcmUKY2hhbGxlbmdpbmcgdGhv
dWdoLCBpcyB0aGUgcnVsZSBvdmVyIHVwZGF0aW5nIGVsZW1lbnRzIG9mIHRoZSBhY3RpdmUKcmJ0
cmVlLiBJbnN0ZWFkIG9mIHRoZSB3aG9sZSBpOTE1X2FjdGl2ZSBub3cgYmVpbmcgc2VyaWFsaXNl
ZCBieQpzdHJ1Y3RfbXV0ZXgsIGFsbG9jYXRpb25zL3JvdGF0aW9ucyBvZiB0aGUgdHJlZSBhcmUg
c2VyaWFsaXNlZCBieSB0aGUKaTkxNV9hY3RpdmUubXV0ZXggYW5kIGluZGl2aWR1YWwgbm9kZXMg
YXJlIHNlcmlhbGlzZWQgYnkgdGhlIGNhbGxlcgp1c2luZyB0aGUgaTkxNV90aW1lbGluZS5tdXRl
eCAod2UgbmVlZCB0byB1c2UgbmVzdGVkIHNwaW5sb2NrcyB0bwppbnRlcmFjdCB3aXRoIHRoZSBk
bWFfZmVuY2UgY2FsbGJhY2sgbGlzdHMpLgoKVGhlIHBhaW4gcG9pbnQgaGVyZSBpcyB0aGF0IGlu
c3RlYWQgb2YgYSBzaW5nbGUgbXV0ZXggYXJvdW5kIGV4ZWNidWYsIHdlCm5vdyBoYXZlIHRvIHRh
a2UgYSBtdXRleCBmb3IgYWN0aXZlIHRyYWNrZXIgKG9uZSBmb3IgZWFjaCB2bWEsIGNvbnRleHQs
CmV0YykgYW5kIGEgY291cGxlIG9mIHNwaW5sb2NrcyBmb3IgZWFjaCBmZW5jZSB1cGRhdGUuIFRo
ZSBpbXByb3ZlbWVudCBpbgpmaW5lIGdyYWluZWQgbG9ja2luZyBhbGxvd2luZyBmb3IgbXVsdGlw
bGUgY29uY3VycmVudCBjbGllbnRzCihldmVudHVhbGx5ISkgc2hvdWxkIGJlIHdvcnRoIGl0IGlu
IHR5cGljYWwgbG9hZHMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlz
LXdpbHNvbi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29u
dGV4dC5jICAgfCAgMTIgKy0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZm
ZXIuYyAgICB8ICAgMiArLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5
cGVzLmggIHwgICAyICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jICAg
ICAgICB8ICAgOSArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jICAg
ICAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZXNldC5jICAgICAg
ICAgfCAgMTAgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jICAgICAg
ICB8ICAxMCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L3NjaGVkdWxlci5jICAgICAgICAg
IHwgICAzIC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMgICAgICAgICAgICB8
IDE0OCArKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmggICAgICAg
ICAgICB8IDMwNSArKysrLS0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
YWN0aXZlX3R5cGVzLmggICAgICB8ICAxNyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
ZW0uYyAgICAgICAgICAgICAgIHwgIDQyICsrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9n
ZW1fZ3R0LmMgICAgICAgICAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Jl
cXVlc3QuYyAgICAgICAgICAgfCAgNTMgKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Jl
cXVlc3QuaCAgICAgICAgICAgfCAgIDEgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV90aW1l
bGluZS5jICAgICAgICAgIHwgICA5ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3RpbWVs
aW5lX3R5cGVzLmggICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMg
ICAgICAgICAgICAgICB8ICAzNyArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Zyb250
YnVmZmVyLmMgICAgICB8ICAgMyArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfb3Zlcmxh
eS5jICAgICAgICAgIHwgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV9hY3RpdmUuYyAgfCAgMjIgKy0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfdGlt
ZWxpbmUuYyAgICB8ICAgMiArLQogMjIgZmlsZXMgY2hhbmdlZCwgMjI1IGluc2VydGlvbnMoKyks
IDQ3NCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fY29udGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2Nv
bnRleHQuYwppbmRleCA5MjYyYTFkNGY3NjMuLjJlM2U0N2JiMWQxMSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCkBAIC05MTAsMjAgKzkxMCwxOCBAQCBz
dGF0aWMgaW50IGNvbnRleHRfYmFycmllcl90YXNrKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpj
dHgsCiAJCQkJdm9pZCAoKnRhc2spKHZvaWQgKmRhdGEpLAogCQkJCXZvaWQgKmRhdGEpCiB7Ci0J
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBjdHgtPmk5MTU7CiAJc3RydWN0IGNvbnRl
eHRfYmFycmllcl90YXNrICpjYjsKIAlzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lc19pdGVyIGl0Owog
CXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAlpbnQgZXJyID0gMDsKIAotCWxvY2tkZXBfYXNz
ZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCUdFTV9CVUdfT04oIXRhc2spOwog
CiAJY2IgPSBrbWFsbG9jKHNpemVvZigqY2IpLCBHRlBfS0VSTkVMKTsKIAlpZiAoIWNiKQogCQly
ZXR1cm4gLUVOT01FTTsKIAotCWk5MTVfYWN0aXZlX2luaXQoaTkxNSwgJmNiLT5iYXNlLCBOVUxM
LCBjYl9yZXRpcmUpOworCWk5MTVfYWN0aXZlX2luaXQoJmNiLT5iYXNlLCBOVUxMLCBjYl9yZXRp
cmUpOwogCWVyciA9IGk5MTVfYWN0aXZlX2FjcXVpcmUoJmNiLT5iYXNlKTsKIAlpZiAoZXJyKSB7
CiAJCWtmcmVlKGNiKTsKQEAgLTk1NSw3ICs5NTMsOSBAQCBzdGF0aWMgaW50IGNvbnRleHRfYmFy
cmllcl90YXNrKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCWlmIChlbWl0KQogCQkJ
ZXJyID0gZW1pdChycSwgZGF0YSk7CiAJCWlmIChlcnIgPT0gMCkKLQkJCWVyciA9IGk5MTVfYWN0
aXZlX3JlZigmY2ItPmJhc2UsIHJxLT5mZW5jZS5jb250ZXh0LCBycSk7CisJCQllcnIgPSBpOTE1
X2FjdGl2ZV9yZWYoJmNiLT5iYXNlLAorCQkJCQkgICAgICBycS0+ZmVuY2UuY29udGV4dCwKKwkJ
CQkJICAgICAgJnJxLT5mZW5jZSk7CiAKIAkJaTkxNV9yZXF1ZXN0X2FkZChycSk7CiAJCWlmIChl
cnIpCkBAIC0xMTkyLDcgKzExOTIsNyBAQCBnZW44X21vZGlmeV9ycGNzKHN0cnVjdCBpbnRlbF9j
b250ZXh0ICpjZSwgc3RydWN0IGludGVsX3NzZXUgc3NldSkKIAkJcmV0dXJuIFBUUl9FUlIocnEp
OwogCiAJLyogUXVldWUgdGhpcyBzd2l0Y2ggYWZ0ZXIgYWxsIG90aGVyIGFjdGl2aXR5IGJ5IHRo
aXMgY29udGV4dC4gKi8KLQlyZXQgPSBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldCgmY2UtPnJpbmct
PnRpbWVsaW5lLT5sYXN0X3JlcXVlc3QsIHJxKTsKKwlyZXQgPSBpOTE1X2FjdGl2ZV9mZW5jZV9z
ZXQoJmNlLT5yaW5nLT50aW1lbGluZS0+bGFzdF9yZXF1ZXN0LCBycSk7CiAJaWYgKHJldCkKIAkJ
Z290byBvdXRfYWRkOwogCkBAIC0xMjA0LDcgKzEyMDQsNyBAQCBnZW44X21vZGlmeV9ycGNzKHN0
cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgc3RydWN0IGludGVsX3NzZXUgc3NldSkKIAkgKiB3b3Jk
cyB0cmFuc2ZlciB0aGUgcGlubmVkIGNlIG9iamVjdCB0byB0cmFja2VkIGFjdGl2ZSByZXF1ZXN0
LgogCSAqLwogCUdFTV9CVUdfT04oaTkxNV9hY3RpdmVfaXNfaWRsZSgmY2UtPmFjdGl2ZSkpOwot
CXJldCA9IGk5MTVfYWN0aXZlX3JlZigmY2UtPmFjdGl2ZSwgcnEtPmZlbmNlLmNvbnRleHQsIHJx
KTsKKwlyZXQgPSBpOTE1X2FjdGl2ZV9yZWYoJmNlLT5hY3RpdmUsIHJxLT5mZW5jZS5jb250ZXh0
LCAmcnEtPmZlbmNlKTsKIAlpZiAocmV0KQogCQlnb3RvIG91dF9hZGQ7CiAKZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCmluZGV4IDUyOGVlYTQ0ZGNj
Zi4uZWViNGM2Y2RiMDFkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fZXhlY2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9leGVjYnVmZmVyLmMKQEAgLTEzMTYsNyArMTMxNiw3IEBAIHJlbG9jYXRlX2VudHJ5KHN0cnVj
dCBpOTE1X3ZtYSAqdm1hLAogCiAJaWYgKCFlYi0+cmVsb2NfY2FjaGUudmFkZHIgJiYKIAkgICAg
KERCR19GT1JDRV9SRUxPQyA9PSBGT1JDRV9HUFVfUkVMT0MgfHwKLQkgICAgICFyZXNlcnZhdGlv
bl9vYmplY3RfdGVzdF9zaWduYWxlZF9yY3Uodm1hLT5yZXN2LCB0cnVlKSkpIHsKKwkgICAgIGk5
MTVfdm1hX2lzX2FjdGl2ZSh2bWEpKSkgewogCQljb25zdCB1bnNpZ25lZCBpbnQgZ2VuID0gZWIt
PnJlbG9jX2NhY2hlLmdlbjsKIAkJdW5zaWduZWQgaW50IGxlbjsKIAkJdTMyICpiYXRjaDsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMu
aCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaAppbmRl
eCAyMWJmYjdiZDBmNTcuLmU4N2ZjYTRkODE5NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9vYmplY3RfdHlwZXMuaApAQCAtMTEsNiArMTEsOCBAQAogCiAjaW5j
bHVkZSA8ZHJtL2RybV9nZW0uaD4KIAorI2luY2x1ZGUgPHVhcGkvZHJtL2k5MTVfZHJtLmg+CisK
ICNpbmNsdWRlICJpOTE1X2FjdGl2ZS5oIgogI2luY2x1ZGUgImk5MTVfc2VsZnRlc3QuaCIKIApk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYwppbmRleCAwNTAxMWQ0YTNiODguLjM1
YjczYzM0Nzg4NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKQEAgLTE1
LDE0ICsxNSwxMSBAQCBzdGF0aWMgdm9pZCBjYWxsX2lkbGVfYmFycmllcnMoc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lKQogCXN0cnVjdCBsbGlzdF9ub2RlICpub2RlLCAqbmV4dDsKIAog
CWxsaXN0X2Zvcl9lYWNoX3NhZmUobm9kZSwgbmV4dCwgbGxpc3RfZGVsX2FsbCgmZW5naW5lLT5i
YXJyaWVyX3Rhc2tzKSkgewotCQlzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlID0K
KwkJc3RydWN0IGRtYV9mZW5jZV9jYiAqY2IgPQogCQkJY29udGFpbmVyX29mKChzdHJ1Y3QgbGlz
dF9oZWFkICopbm9kZSwKLQkJCQkgICAgIHR5cGVvZigqYWN0aXZlKSwgbGluayk7CisJCQkJICAg
ICB0eXBlb2YoKmNiKSwgbm9kZSk7CiAKLQkJSU5JVF9MSVNUX0hFQUQoJmFjdGl2ZS0+bGluayk7
Ci0JCVJDVV9JTklUX1BPSU5URVIoYWN0aXZlLT5yZXF1ZXN0LCBOVUxMKTsKLQotCQlhY3RpdmUt
PnJldGlyZShhY3RpdmUsIE5VTEwpOworCQljYi0+ZnVuYyhOVUxMLCBjYik7CiAJfQogfQogCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKaW5kZXggMmVhMDVkY2RiOTlmLi5h
MTA5OTA0ZmFhNTcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2Nv
bnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKQEAg
LTE4Miw3ICsxODIsNyBAQCBpbnRlbF9jb250ZXh0X2luaXQoc3RydWN0IGludGVsX2NvbnRleHQg
KmNlLAogCiAJbXV0ZXhfaW5pdCgmY2UtPnBpbl9tdXRleCk7CiAKLQlpOTE1X2FjdGl2ZV9pbml0
KGN0eC0+aTkxNSwgJmNlLT5hY3RpdmUsCisJaTkxNV9hY3RpdmVfaW5pdCgmY2UtPmFjdGl2ZSwK
IAkJCSBfX2ludGVsX2NvbnRleHRfYWN0aXZlLCBfX2ludGVsX2NvbnRleHRfcmV0aXJlKTsKIH0K
IApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMKaW5kZXggYjc3OTk4NGE1NjIwLi4x
MTBhNTkzNmVhMGUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jl
c2V0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYwpAQCAtODgx
LDEwICs4ODEsMTAgQEAgc3RhdGljIGJvb2wgX19pOTE1X2dlbV91bnNldF93ZWRnZWQoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJICovCiAJbXV0ZXhfbG9jaygmaTkxNS0+Z3QudGlt
ZWxpbmVzLm11dGV4KTsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KHRsLCAmaTkxNS0+Z3QudGltZWxp
bmVzLmFjdGl2ZV9saXN0LCBsaW5rKSB7Ci0JCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCQlz
dHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZTsKIAotCQlycSA9IGk5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0
X3VubG9ja2VkKCZ0bC0+bGFzdF9yZXF1ZXN0KTsKLQkJaWYgKCFycSkKKwkJZmVuY2UgPSBpOTE1
X2FjdGl2ZV9mZW5jZV9nZXQoJnRsLT5sYXN0X3JlcXVlc3QpOworCQlpZiAoIWZlbmNlKQogCQkJ
Y29udGludWU7CiAKIAkJLyoKQEAgLTg5NCw4ICs4OTQsOCBAQCBzdGF0aWMgYm9vbCBfX2k5MTVf
Z2VtX3Vuc2V0X3dlZGdlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkJICogKEk5
MTVfRkVOQ0VfVElNRU9VVCkgc28gdGhpcyB3YWl0IHNob3VsZCBub3QgYmUgdW5ib3VuZGVkCiAJ
CSAqIGluIHRoZSB3b3JzdCBjYXNlLgogCQkgKi8KLQkJZG1hX2ZlbmNlX2RlZmF1bHRfd2FpdCgm
cnEtPmZlbmNlLCBmYWxzZSwgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwotCQlpOTE1X3JlcXVlc3Rf
cHV0KHJxKTsKKwkJZG1hX2ZlbmNlX2RlZmF1bHRfd2FpdChmZW5jZSwgZmFsc2UsIE1BWF9TQ0hF
RFVMRV9USU1FT1VUKTsKKwkJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CiAJfQogCW11dGV4X3VubG9j
aygmaTkxNS0+Z3QudGltZWxpbmVzLm11dGV4KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF9scmMuYwppbmRleCA5YmE2YmZmZmYzZTMuLmJmYmEyZmU5ZWM0ZCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKQEAgLTg1NCw5ICs4NTQsMTMgQEAgc3RhdGljIHN0
cnVjdCBpOTE1X3JlcXVlc3QgKmR1bW15X3JlcXVlc3Qoc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lKQogCWlmICghcnEpCiAJCXJldHVybiBOVUxMOwogCi0JSU5JVF9MSVNUX0hFQUQoJnJx
LT5hY3RpdmVfbGlzdCk7CiAJcnEtPmVuZ2luZSA9IGVuZ2luZTsKIAorCXNwaW5fbG9ja19pbml0
KCZycS0+bG9jayk7CisJSU5JVF9MSVNUX0hFQUQoJnJxLT5mZW5jZS5jYl9saXN0KTsKKwlycS0+
ZmVuY2UubG9jayA9ICZycS0+bG9jazsKKwlycS0+ZmVuY2Uub3BzID0gJmk5MTVfZmVuY2Vfb3Bz
OworCiAJaTkxNV9zY2hlZF9ub2RlX2luaXQoJnJxLT5zY2hlZCk7CiAKIAkvKiBtYXJrIHRoaXMg
cmVxdWVzdCBhcyBwZXJtYW5lbnRseSBpbmNvbXBsZXRlICovCkBAIC05NDUsOCArOTQ5LDggQEAg
c3RhdGljIGludCBsaXZlX3N1cHByZXNzX3dhaXRfcHJlZW1wdCh2b2lkICphcmcpCiAJCQkJfQog
CiAJCQkJLyogRGlzYWJsZSBORVdDTElFTlQgcHJvbW90aW9uICovCi0JCQkJX19pOTE1X2FjdGl2
ZV9yZXF1ZXN0X3NldCgmcnFbaV0tPnRpbWVsaW5lLT5sYXN0X3JlcXVlc3QsCi0JCQkJCQkJICBk
dW1teSk7CisJCQkJX19pOTE1X2FjdGl2ZV9mZW5jZV9zZXQoJnJxW2ldLT50aW1lbGluZS0+bGFz
dF9yZXF1ZXN0LAorCQkJCQkJCSZkdW1teS0+ZmVuY2UpOwogCQkJCWk5MTVfcmVxdWVzdF9hZGQo
cnFbaV0pOwogCQkJfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2No
ZWR1bGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVyLmMKaW5kZXggZTMw
MWVmYjE4ZDQ1Li5jMzZmOTA0YTZkNTQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d2dC9zY2hlZHVsZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvc2NoZWR1bGVy
LmMKQEAgLTM5MSwxMSArMzkxLDggQEAgaW50ZWxfZ3Z0X3dvcmtsb2FkX3JlcV9hbGxvYyhzdHJ1
Y3QgaW50ZWxfdmdwdV93b3JrbG9hZCAqd29ya2xvYWQpCiB7CiAJc3RydWN0IGludGVsX3ZncHUg
KnZncHUgPSB3b3JrbG9hZC0+dmdwdTsKIAlzdHJ1Y3QgaW50ZWxfdmdwdV9zdWJtaXNzaW9uICpz
ID0gJnZncHUtPnN1Ym1pc3Npb247Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gdmdwdS0+Z3Z0LT5kZXZfcHJpdjsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAotCWxv
Y2tkZXBfYXNzZXJ0X2hlbGQoJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWlmICh3
b3JrbG9hZC0+cmVxKQogCQlyZXR1cm4gMDsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9hY3RpdmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMK
aW5kZXggZjc2YTJiNGVmOTVkLi4zOGYxNmI2OWZkZTEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9h
Y3RpdmUuYwpAQCAtOCw4ICs4LDYgQEAKICNpbmNsdWRlICJpOTE1X2FjdGl2ZS5oIgogI2luY2x1
ZGUgImk5MTVfZ2xvYmFscy5oIgogCi0jZGVmaW5lIEJLTChyZWYpICgmKHJlZiktPmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpCi0KIC8qCiAgKiBBY3RpdmUgcmVmcyBtZW1vcnkgbWFuYWdlbWVudAog
ICoKQEAgLTIzLDcgKzIxLDcgQEAgc3RhdGljIHN0cnVjdCBpOTE1X2dsb2JhbF9hY3RpdmUgewog
fSBnbG9iYWw7CiAKIHN0cnVjdCBhY3RpdmVfbm9kZSB7Ci0Jc3RydWN0IGk5MTVfYWN0aXZlX3Jl
cXVlc3QgYmFzZTsKKwlzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgYmFzZTsKIAlzdHJ1Y3QgaTkx
NV9hY3RpdmUgKnJlZjsKIAlzdHJ1Y3QgcmJfbm9kZSBub2RlOwogCXU2NCB0aW1lbGluZTsKQEAg
LTU0LDcgKzUyLDcgQEAgX19hY3RpdmVfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQog
CXJlZi0+cmV0aXJlKHJlZik7CiAKIAlyYnRyZWVfcG9zdG9yZGVyX2Zvcl9lYWNoX2VudHJ5X3Nh
ZmUoaXQsIG4sICZyb290LCBub2RlKSB7Ci0JCUdFTV9CVUdfT04oaTkxNV9hY3RpdmVfcmVxdWVz
dF9pc3NldCgmaXQtPmJhc2UpKTsKKwkJR0VNX0JVR19PTihpOTE1X2FjdGl2ZV9mZW5jZV9pc3Nl
dCgmaXQtPmJhc2UpKTsKIAkJa21lbV9jYWNoZV9mcmVlKGdsb2JhbC5zbGFiX2NhY2hlLCBpdCk7
CiAJfQogfQpAQCAtODksMTIgKzg3LDEzIEBAIGFjdGl2ZV9yZXRpcmUoc3RydWN0IGk5MTVfYWN0
aXZlICpyZWYpCiB9CiAKIHN0YXRpYyB2b2lkCi1ub2RlX3JldGlyZShzdHJ1Y3QgaTkxNV9hY3Rp
dmVfcmVxdWVzdCAqYmFzZSwgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCitub2RlX3JldGlyZShz
dHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSwgc3RydWN0IGRtYV9mZW5jZV9jYiAqY2IpCiB7Ci0JYWN0
aXZlX3JldGlyZShjb250YWluZXJfb2YoYmFzZSwgc3RydWN0IGFjdGl2ZV9ub2RlLCBiYXNlKS0+
cmVmKTsKKwlpOTE1X2FjdGl2ZV9mZW5jZV9jYihmZW5jZSwgY2IpOworCWFjdGl2ZV9yZXRpcmUo
Y29udGFpbmVyX29mKGNiLCBzdHJ1Y3QgYWN0aXZlX25vZGUsIGJhc2UuY2IpLT5yZWYpOwogfQog
Ci1zdGF0aWMgc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKgorc3RhdGljIHN0cnVjdCBpOTE1
X2FjdGl2ZV9mZW5jZSAqCiBhY3RpdmVfaW5zdGFuY2Uoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYs
IHU2NCBpZHgpCiB7CiAJc3RydWN0IGFjdGl2ZV9ub2RlICpub2RlLCAqcHJlYWxsb2M7CkBAIC0x
MzcsNyArMTM2LDcgQEAgYWN0aXZlX2luc3RhbmNlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLCB1
NjQgaWR4KQogCX0KIAogCW5vZGUgPSBwcmVhbGxvYzsKLQlpOTE1X2FjdGl2ZV9yZXF1ZXN0X2lu
aXQoJm5vZGUtPmJhc2UsIE5VTEwsIG5vZGVfcmV0aXJlKTsKKwlfX2k5MTVfYWN0aXZlX2ZlbmNl
X2luaXQoJm5vZGUtPmJhc2UsIE5VTEwsIG5vZGVfcmV0aXJlKTsKIAlub2RlLT5yZWYgPSByZWY7
CiAJbm9kZS0+dGltZWxpbmUgPSBpZHg7CiAKQEAgLTE1MSwxMyArMTUwLDExIEBAIGFjdGl2ZV9p
bnN0YW5jZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwgdTY0IGlkeCkKIAlyZXR1cm4gJm5vZGUt
PmJhc2U7CiB9CiAKLXZvaWQgX19pOTE1X2FjdGl2ZV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAotCQkJc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCit2b2lkIF9faTkxNV9hY3Rp
dmVfaW5pdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKIAkJCWludCAoKmFjdGl2ZSkoc3RydWN0
IGk5MTVfYWN0aXZlICpyZWYpLAogCQkJdm9pZCAoKnJldGlyZSkoc3RydWN0IGk5MTVfYWN0aXZl
ICpyZWYpLAogCQkJc3RydWN0IGxvY2tfY2xhc3Nfa2V5ICprZXkpCiB7Ci0JcmVmLT5pOTE1ID0g
aTkxNTsKIAlyZWYtPmFjdGl2ZSA9IGFjdGl2ZTsKIAlyZWYtPnJldGlyZSA9IHJldGlyZTsKIAly
ZWYtPnRyZWUgPSBSQl9ST09UOwpAQCAtMTcwLDkgKzE2Nyw5IEBAIHZvaWQgX19pOTE1X2FjdGl2
ZV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCiBpbnQgaTkxNV9hY3RpdmVf
cmVmKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLAogCQkgICAgdTY0IHRpbWVsaW5lLAotCQkgICAg
c3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCisJCSAgICBzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSkK
IHsKLQlzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlOworCXN0cnVjdCBpOTE1X2Fj
dGl2ZV9mZW5jZSAqYWN0aXZlOwogCWludCBlcnI7CiAKIAkvKiBQcmV2ZW50IHJlYXBpbmcgaW4g
Y2FzZSB3ZSBtYWxsb2Mvd2FpdCB3aGlsZSBidWlsZGluZyB0aGUgdHJlZSAqLwpAQCAtMTg2LDkg
KzE4Myw5IEBAIGludCBpOTE1X2FjdGl2ZV9yZWYoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCiAJ
CWdvdG8gb3V0OwogCX0KIAotCWlmICghaTkxNV9hY3RpdmVfcmVxdWVzdF9pc3NldChhY3RpdmUp
KQorCUdFTV9CVUdfT04oIWF0b21pY19yZWFkKCZyZWYtPmNvdW50KSk7CisJaWYgKCFfX2k5MTVf
YWN0aXZlX2ZlbmNlX3NldChhY3RpdmUsIGZlbmNlKSkKIAkJYXRvbWljX2luYygmcmVmLT5jb3Vu
dCk7Ci0JX19pOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldChhY3RpdmUsIHJxKTsKIAogb3V0OgogCWk5
MTVfYWN0aXZlX3JlbGVhc2UocmVmKTsKQEAgLTI0MCw0NyArMjM3LDIwIEBAIGludCBpOTE1X2Fj
dGl2ZV93YWl0KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQogCX0KIAogCXJidHJlZV9wb3N0b3Jk
ZXJfZm9yX2VhY2hfZW50cnlfc2FmZShpdCwgbiwgJnJlZi0+dHJlZSwgbm9kZSkgewotCQllcnIg
PSBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3JldGlyZSgmaXQtPmJhc2UsIEJLTChyZWYpKTsKLQkJaWYg
KGVycikKLQkJCWJyZWFrOwotCX0KLQotCV9fYWN0aXZlX3JldGlyZShyZWYpOwotCWZsdXNoX3dv
cmsoJnJlZi0+d29yayk7Ci0JcmV0dXJuIGVycjsKLX0KLQotaW50IGk5MTVfcmVxdWVzdF9hd2Fp
dF9hY3RpdmVfcmVxdWVzdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKLQkJCQkgICAgICBzdHJ1
Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlKQotewotCXN0cnVjdCBpOTE1X3JlcXVlc3Qg
KmJhcnJpZXIgPQotCQlpOTE1X2FjdGl2ZV9yZXF1ZXN0X3JhdyhhY3RpdmUsICZycS0+aTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQlyZXR1cm4gYmFycmllciA/IGk5MTVfcmVxdWVzdF9hd2Fp
dF9kbWFfZmVuY2UocnEsICZiYXJyaWVyLT5mZW5jZSkgOiAwOwotfQorCQlzdHJ1Y3QgZG1hX2Zl
bmNlICpmZW5jZTsKIAotaW50IGk5MTVfcmVxdWVzdF9hd2FpdF9hY3RpdmUoc3RydWN0IGk5MTVf
cmVxdWVzdCAqcnEsIHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQotewotCXN0cnVjdCBhY3RpdmVf
bm9kZSAqaXQsICpuOwotCWludCBlcnI7CisJCWZlbmNlID0gaTkxNV9hY3RpdmVfZmVuY2VfZ2V0
KCZpdC0+YmFzZSk7CisJCWlmICghZmVuY2UpCisJCQljb250aW51ZTsKIAotCWlmIChSQl9FTVBU
WV9ST09UKCZyZWYtPnRyZWUpKQotCQlyZXR1cm4gMDsKLQotCS8qIGF3YWl0IGFsbG9jYXRlcyBh
bmQgc28gd2UgbmVlZCB0byBhdm9pZCBoaXR0aW5nIHRoZSBzaHJpbmtlciAqLwotCWVyciA9IGk5
MTVfYWN0aXZlX2FjcXVpcmUocmVmKTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gZXJyOwotCi0JbXV0
ZXhfbG9jaygmcmVmLT5tdXRleCk7Ci0JcmJ0cmVlX3Bvc3RvcmRlcl9mb3JfZWFjaF9lbnRyeV9z
YWZlKGl0LCBuLCAmcmVmLT50cmVlLCBub2RlKSB7Ci0JCWVyciA9IGk5MTVfcmVxdWVzdF9hd2Fp
dF9hY3RpdmVfcmVxdWVzdChycSwgJml0LT5iYXNlKTsKKwkJZXJyID0gZG1hX2ZlbmNlX3dhaXQo
ZmVuY2UsIHRydWUpOworCQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKIAkJaWYgKGVycikKIAkJCWJy
ZWFrOwogCX0KLQltdXRleF91bmxvY2soJnJlZi0+bXV0ZXgpOwogCi0JaTkxNV9hY3RpdmVfcmVs
ZWFzZShyZWYpOworCV9fYWN0aXZlX3JldGlyZShyZWYpOworCWZsdXNoX3dvcmsoJnJlZi0+d29y
ayk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMzEyLDEzICsyODIsMTIgQEAgaW50IGk5MTVfYWN0
aXZlX2FjcXVpcmVfcHJlYWxsb2NhdGVfYmFycmllcihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwK
IAkJCWJyZWFrOwogCQl9CiAKLQkJaTkxNV9hY3RpdmVfcmVxdWVzdF9pbml0KCZub2RlLT5iYXNl
LAotCQkJCQkgKHZvaWQgKillbmdpbmUsIG5vZGVfcmV0aXJlKTsKKwkJX19pOTE1X2FjdGl2ZV9m
ZW5jZV9pbml0KCZub2RlLT5iYXNlLCBlbmdpbmUsIG5vZGVfcmV0aXJlKTsKIAkJbm9kZS0+dGlt
ZWxpbmUgPSBrY3R4LT5yaW5nLT50aW1lbGluZS0+ZmVuY2VfY29udGV4dDsKIAkJbm9kZS0+cmVm
ID0gcmVmOwogCQlhdG9taWNfaW5jKCZyZWYtPmNvdW50KTsKIAotCQlsbGlzdF9hZGQoKHN0cnVj
dCBsbGlzdF9ub2RlICopJm5vZGUtPmJhc2UubGluaywKKwkJbGxpc3RfYWRkKChzdHJ1Y3QgbGxp
c3Rfbm9kZSAqKSZub2RlLT5iYXNlLmNiLm5vZGUsCiAJCQkgICZyZWYtPmJhcnJpZXJzKTsKIAl9
CiAKQEAgLTMzOCwxMCArMzA3LDEwIEBAIHZvaWQgaTkxNV9hY3RpdmVfYWNxdWlyZV9iYXJyaWVy
KHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQogCQlzdHJ1Y3QgcmJfbm9kZSAqKnAsICpwYXJlbnQ7
CiAKIAkJbm9kZSA9IGNvbnRhaW5lcl9vZigoc3RydWN0IGxpc3RfaGVhZCAqKXBvcywKLQkJCQkg
ICAgdHlwZW9mKCpub2RlKSwgYmFzZS5saW5rKTsKKwkJCQkgICAgdHlwZW9mKCpub2RlKSwgYmFz
ZS5jYi5ub2RlKTsKIAotCQllbmdpbmUgPSAodm9pZCAqKXJjdV9hY2Nlc3NfcG9pbnRlcihub2Rl
LT5iYXNlLnJlcXVlc3QpOwotCQlSQ1VfSU5JVF9QT0lOVEVSKG5vZGUtPmJhc2UucmVxdWVzdCwg
RVJSX1BUUigtRUFHQUlOKSk7CisJCWVuZ2luZSA9ICh2b2lkICopcmN1X2FjY2Vzc19wb2ludGVy
KG5vZGUtPmJhc2UuZmVuY2UpOworCQlSQ1VfSU5JVF9QT0lOVEVSKG5vZGUtPmJhc2UuZmVuY2Us
IEVSUl9QVFIoLUVBR0FJTikpOwogCiAJCXBhcmVudCA9IE5VTEw7CiAJCXAgPSAmcmVmLT50cmVl
LnJiX25vZGU7CkBAIC0zNTcsNyArMzI2LDcgQEAgdm9pZCBpOTE1X2FjdGl2ZV9hY3F1aXJlX2Jh
cnJpZXIoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiAJCXJiX2xpbmtfbm9kZSgmbm9kZS0+bm9k
ZSwgcGFyZW50LCBwKTsKIAkJcmJfaW5zZXJ0X2NvbG9yKCZub2RlLT5ub2RlLCAmcmVmLT50cmVl
KTsKIAotCQlsbGlzdF9hZGQoKHN0cnVjdCBsbGlzdF9ub2RlICopJm5vZGUtPmJhc2UubGluaywK
KwkJbGxpc3RfYWRkKChzdHJ1Y3QgbGxpc3Rfbm9kZSAqKSZub2RlLT5iYXNlLmNiLm5vZGUsCiAJ
CQkgICZlbmdpbmUtPmJhcnJpZXJfdGFza3MpOwogCX0KIAltdXRleF91bmxvY2soJnJlZi0+bXV0
ZXgpOwpAQCAtMzY3LDI5ICszMzYsNzIgQEAgdm9pZCBpOTE1X3JlcXVlc3RfYWRkX2JhcnJpZXJz
KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogewogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSA9IHJxLT5lbmdpbmU7CiAJc3RydWN0IGxsaXN0X25vZGUgKm5vZGUsICpuZXh0OworCXVu
c2lnbmVkIGxvbmcgZmxhZ3M7CiAKLQlsbGlzdF9mb3JfZWFjaF9zYWZlKG5vZGUsIG5leHQsIGxs
aXN0X2RlbF9hbGwoJmVuZ2luZS0+YmFycmllcl90YXNrcykpCi0JCWxpc3RfYWRkX3RhaWwoKHN0
cnVjdCBsaXN0X2hlYWQgKilub2RlLCAmcnEtPmFjdGl2ZV9saXN0KTsKKwlHRU1fQlVHX09OKGlu
dGVsX2VuZ2luZV9pc192aXJ0dWFsKGVuZ2luZSkpOworCW5vZGUgPSBsbGlzdF9kZWxfYWxsKCZl
bmdpbmUtPmJhcnJpZXJfdGFza3MpOworCWlmICghbm9kZSkKKwkJcmV0dXJuOworCisJc3Bpbl9s
b2NrX2lycXNhdmUoJnJxLT5sb2NrLCBmbGFncyk7CisJbGxpc3RfZm9yX2VhY2hfc2FmZShub2Rl
LCBuZXh0LCBub2RlKQorCQlsaXN0X2FkZF90YWlsKChzdHJ1Y3QgbGlzdF9oZWFkICopbm9kZSwg
JnJxLT5mZW5jZS5jYl9saXN0KTsKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZycS0+bG9jaywg
ZmxhZ3MpOwogfQogCi1pbnQgaTkxNV9hY3RpdmVfcmVxdWVzdF9zZXQoc3RydWN0IGk5MTVfYWN0
aXZlX3JlcXVlc3QgKmFjdGl2ZSwKLQkJCSAgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKK3N0
cnVjdCBkbWFfZmVuY2UgKgorX19pOTE1X2FjdGl2ZV9mZW5jZV9zZXQoc3RydWN0IGk5MTVfYWN0
aXZlX2ZlbmNlICphY3RpdmUsCisJCQlzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSkKIHsKKwlzdHJ1
Y3QgZG1hX2ZlbmNlICpwcmV2OworCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisKKwkvKiBOQjogdXBk
YXRlcyBtdXN0IGJlIHNlcmlhbGlzZWQgYnkgYW4gb3V0ZXIgdGltZWxpbmUgbXV0ZXggKi8KKwlz
cGluX2xvY2tfaXJxc2F2ZShmZW5jZS0+bG9jaywgZmxhZ3MpOworCUdFTV9CVUdfT04odGVzdF9i
aXQoRE1BX0ZFTkNFX0ZMQUdfU0lHTkFMRURfQklULCAmZmVuY2UtPmZsYWdzKSk7CisKKwlwcmV2
ID0gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChhY3RpdmUtPmZlbmNlLCAxIC8qIHRpbWVsaW5l
IG11dGV4ICovKTsKKwlpZiAocHJldikgeworCQlzcGluX2xvY2tfbmVzdGVkKHByZXYtPmxvY2ss
IFNJTkdMRV9ERVBUSF9ORVNUSU5HKTsKKwkJX19saXN0X2RlbF9lbnRyeSgmYWN0aXZlLT5jYi5u
b2RlKTsKKwkJc3Bpbl91bmxvY2socHJldi0+bG9jayk7CisJCXByZXYgPSByY3VfYWNjZXNzX3Bv
aW50ZXIoYWN0aXZlLT5mZW5jZSk7CisJfQorCisJcmN1X2Fzc2lnbl9wb2ludGVyKGFjdGl2ZS0+
ZmVuY2UsIGZlbmNlKTsKKwlsaXN0X2FkZF90YWlsKCZhY3RpdmUtPmNiLm5vZGUsICZmZW5jZS0+
Y2JfbGlzdCk7CisKKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKGZlbmNlLT5sb2NrLCBmbGFncyk7
CisKKwlyZXR1cm4gcHJldjsKK30KKworaW50IGk5MTVfYWN0aXZlX2ZlbmNlX3NldChzdHJ1Y3Qg
aTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2ZSwKKwkJCSAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEp
Cit7CisJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7CiAJaW50IGVycjsKIAogCS8qIE11c3QgbWFp
bnRhaW4gb3JkZXJpbmcgd3J0IHByZXZpb3VzIGFjdGl2ZSByZXF1ZXN0cyAqLwotCWVyciA9IGk5
MTVfcmVxdWVzdF9hd2FpdF9hY3RpdmVfcmVxdWVzdChycSwgYWN0aXZlKTsKLQlpZiAoZXJyKQot
CQlyZXR1cm4gZXJyOworCXJjdV9yZWFkX2xvY2soKTsKKwlmZW5jZSA9IF9faTkxNV9hY3RpdmVf
ZmVuY2Vfc2V0KGFjdGl2ZSwgJnJxLT5mZW5jZSk7CisJaWYgKGZlbmNlKQorCQlmZW5jZSA9IGRt
YV9mZW5jZV9nZXRfcmN1KGZlbmNlKTsKKwlyY3VfcmVhZF91bmxvY2soKTsKKworCWlmIChmZW5j
ZSkgeworCQllcnIgPSBpOTE1X3JlcXVlc3RfYXdhaXRfZG1hX2ZlbmNlKHJxLCBmZW5jZSk7CisJ
CWRtYV9mZW5jZV9wdXQoZmVuY2UpOworCQlpZiAoZXJyKQorCQkJcmV0dXJuIGVycjsKKwl9CiAK
LQlfX2k5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KGFjdGl2ZSwgcnEpOwogCXJldHVybiAwOwogfQog
Ci12b2lkIGk5MTVfYWN0aXZlX3JldGlyZV9ub29wKHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0
ICphY3RpdmUsCi0JCQkgICAgIHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QpCit2b2lkIGk5
MTVfYWN0aXZlX25vb3Aoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UsIHN0cnVjdCBkbWFfZmVuY2Vf
Y2IgKmNiKQogewotCS8qIFNwYWNlIGxlZnQgaW50ZW50aW9uYWxseSBibGFuayAqLworCWk5MTVf
YWN0aXZlX2ZlbmNlX2NiKGZlbmNlLCBjYik7CiB9CiAKICNpZiBJU19FTkFCTEVEKENPTkZJR19E
Uk1fSTkxNV9TRUxGVEVTVCkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
YWN0aXZlLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5oCmluZGV4IGJkZWM0
ZjgxYjZlOC4uZmRmODdiYWQ3NmQ1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2FjdGl2ZS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmgKQEAg
LTEwLDcgKzEwLDkgQEAKICNpbmNsdWRlIDxsaW51eC9sb2NrZGVwLmg+CiAKICNpbmNsdWRlICJp
OTE1X2FjdGl2ZV90eXBlcy5oIgotI2luY2x1ZGUgImk5MTVfcmVxdWVzdC5oIgorCitzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0Oworc3RydWN0IGludGVsX2VuZ2luZV9jczsKIAogLyoKICAqIFdlIHRyZWF0
IHJlcXVlc3RzIGFzIGZlbmNlcy4gVGhpcyBpcyBub3QgYmUgdG8gY29uZnVzZWQgd2l0aCBvdXIK
QEAgLTI4LDMwMCArMzAsMTAzIEBACiAgKiB3cml0ZSBhY2Nlc3Mgc28gdGhhdCB3ZSBjYW4gcGVy
Zm9ybSBjb25jdXJyZW50IHJlYWQgb3BlcmF0aW9ucyBiZXR3ZWVuCiAgKiB0aGUgQ1BVIGFuZCBH
UFUgZW5naW5lcywgYXMgd2VsbCBhcyB3YWl0aW5nIGZvciBhbGwgcmVuZGVyaW5nIHRvCiAgKiBj
b21wbGV0ZSwgb3Igd2FpdGluZyBmb3IgdGhlIGxhc3QgR1BVIHVzZXIgb2YgYSAiZmVuY2UgcmVn
aXN0ZXIiLiBUaGUKLSAqIG9iamVjdCB0aGVuIGVtYmVkcyBhICNpOTE1X2FjdGl2ZV9yZXF1ZXN0
IHRvIHRyYWNrIHRoZSBtb3N0IHJlY2VudCAoaW4KKyAqIG9iamVjdCB0aGVuIGVtYmVkcyBhICNp
OTE1X2FjdGl2ZV9mZW5jZSB0byB0cmFjayB0aGUgbW9zdCByZWNlbnQgKGluCiAgKiByZXRpcmVt
ZW50IG9yZGVyKSByZXF1ZXN0IHJlbGV2YW50IGZvciB0aGUgZGVzaXJlZCBtb2RlIG9mIGFjY2Vz
cy4KLSAqIFRoZSAjaTkxNV9hY3RpdmVfcmVxdWVzdCBpcyB1cGRhdGVkIHdpdGggaTkxNV9hY3Rp
dmVfcmVxdWVzdF9zZXQoKSB0bworICogVGhlICNpOTE1X2FjdGl2ZV9mZW5jZSBpcyB1cGRhdGVk
IHdpdGggaTkxNV9hY3RpdmVfZmVuY2Vfc2V0KCkgdG8KICAqIHRyYWNrIHRoZSBtb3N0IHJlY2Vu
dCBmZW5jZSByZXF1ZXN0LCB0eXBpY2FsbHkgdGhpcyBpcyBkb25lIGFzIHBhcnQgb2YKICAqIGk5
MTVfdm1hX21vdmVfdG9fYWN0aXZlKCkuCiAgKgotICogV2hlbiB0aGUgI2k5MTVfYWN0aXZlX3Jl
cXVlc3QgY29tcGxldGVzIChpcyByZXRpcmVkKSwgaXQgd2lsbAorICogV2hlbiB0aGUgI2k5MTVf
YWN0aXZlX2ZlbmNlIGNvbXBsZXRlcyAoaXMgcmV0aXJlZCksIGl0IHdpbGwKICAqIHNpZ25hbCBp
dHMgY29tcGxldGlvbiB0byB0aGUgb3duZXIgdGhyb3VnaCBhIGNhbGxiYWNrIGFzIHdlbGwgYXMg
bWFyawotICogaXRzZWxmIGFzIGlkbGUgKGk5MTVfYWN0aXZlX3JlcXVlc3QucmVxdWVzdCA9PSBO
VUxMKS4gVGhlIG93bmVyCisgKiBpdHNlbGYgYXMgaWRsZSAoaTkxNV9hY3RpdmVfZmVuY2UucmVx
dWVzdCA9PSBOVUxMKS4gVGhlIG93bmVyCiAgKiBjYW4gdGhlbiBwZXJmb3JtIGFueSBhY3Rpb24s
IHN1Y2ggYXMgZGVsYXllZCBmcmVlaW5nIG9mIGFuIGFjdGl2ZQogICogcmVzb3VyY2UgaW5jbHVk
aW5nIGl0c2VsZi4KICAqLwogCi12b2lkIGk5MTVfYWN0aXZlX3JldGlyZV9ub29wKHN0cnVjdCBp
OTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCi0JCQkgICAgIHN0cnVjdCBpOTE1X3JlcXVlc3Qg
KnJlcXVlc3QpOwordm9pZCBpOTE1X2FjdGl2ZV9ub29wKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNl
LCBzdHJ1Y3QgZG1hX2ZlbmNlX2NiICpjYik7CiAKIC8qKgotICogaTkxNV9hY3RpdmVfcmVxdWVz
dF9pbml0IC0gcHJlcGFyZXMgdGhlIGFjdGl2aXR5IHRyYWNrZXIgZm9yIHVzZQorICogX19pOTE1
X2FjdGl2ZV9mZW5jZV9pbml0IC0gcHJlcGFyZXMgdGhlIGFjdGl2aXR5IHRyYWNrZXIgZm9yIHVz
ZQogICogQGFjdGl2ZSAtIHRoZSBhY3RpdmUgdHJhY2tlcgotICogQHJxIC0gaW5pdGlhbCByZXF1
ZXN0IHRvIHRyYWNrLCBjYW4gYmUgTlVMTAorICogQGZlbmNlIC0gaW5pdGlhbCBmZW5jZSB0byB0
cmFjaywgY2FuIGJlIE5VTEwKICAqIEBmdW5jIC0gYSBjYWxsYmFjayB3aGVuIHRoZW4gdGhlIHRy
YWNrZXIgaXMgcmV0aXJlZCAoYmVjb21lcyBpZGxlKSwKICAqICAgICAgICAgY2FuIGJlIE5VTEwK
ICAqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X2luaXQoKSBwcmVwYXJlcyB0aGUgZW1iZWRkZWQg
QGFjdGl2ZSBzdHJ1Y3QgZm9yIHVzZSBhcwotICogYW4gYWN0aXZpdHkgdHJhY2tlciwgdGhhdCBp
cyBmb3IgdHJhY2tpbmcgdGhlIGxhc3Qga25vd24gYWN0aXZlIHJlcXVlc3QKLSAqIGFzc29jaWF0
ZWQgd2l0aCBpdC4gV2hlbiB0aGUgbGFzdCByZXF1ZXN0IGJlY29tZXMgaWRsZSwgd2hlbiBpdCBp
cyByZXRpcmVkCisgKiBpOTE1X2FjdGl2ZV9mZW5jZV9pbml0KCkgcHJlcGFyZXMgdGhlIGVtYmVk
ZGVkIEBhY3RpdmUgc3RydWN0IGZvciB1c2UgYXMKKyAqIGFuIGFjdGl2aXR5IHRyYWNrZXIsIHRo
YXQgaXMgZm9yIHRyYWNraW5nIHRoZSBsYXN0IGtub3duIGFjdGl2ZSBmZW5jZQorICogYXNzb2Np
YXRlZCB3aXRoIGl0LiBXaGVuIHRoZSBsYXN0IGZlbmNlIGJlY29tZXMgaWRsZSwgd2hlbiBpdCBp
cyByZXRpcmVkCiAgKiBhZnRlciBjb21wbGV0aW9uLCB0aGUgb3B0aW9uYWwgY2FsbGJhY2sgQGZ1
bmMgaXMgaW52b2tlZC4KICAqLwogc3RhdGljIGlubGluZSB2b2lkCi1pOTE1X2FjdGl2ZV9yZXF1
ZXN0X2luaXQoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSwKLQkJCSBzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycSwKLQkJCSBpOTE1X2FjdGl2ZV9yZXRpcmVfZm4gcmV0aXJlKQorX19p
OTE1X2FjdGl2ZV9mZW5jZV9pbml0KHN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlLAor
CQkJIHZvaWQgKmZlbmNlLAorCQkJIGRtYV9mZW5jZV9mdW5jX3QgZm4pCiB7Ci0JUkNVX0lOSVRf
UE9JTlRFUihhY3RpdmUtPnJlcXVlc3QsIHJxKTsKLQlJTklUX0xJU1RfSEVBRCgmYWN0aXZlLT5s
aW5rKTsKLQlhY3RpdmUtPnJldGlyZSA9IHJldGlyZSA/OiBpOTE1X2FjdGl2ZV9yZXRpcmVfbm9v
cDsKKwlSQ1VfSU5JVF9QT0lOVEVSKGFjdGl2ZS0+ZmVuY2UsIGZlbmNlKTsKKwlhY3RpdmUtPmNi
LmZ1bmMgPSBmbiA/OiBpOTE1X2FjdGl2ZV9ub29wOwogfQogCi0jZGVmaW5lIElOSVRfQUNUSVZF
X1JFUVVFU1QobmFtZSkgaTkxNV9hY3RpdmVfcmVxdWVzdF9pbml0KChuYW1lKSwgTlVMTCwgTlVM
TCkKLQotLyoqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldCAtIHVwZGF0ZXMgdGhlIHRyYWNr
ZXIgdG8gd2F0Y2ggdGhlIGN1cnJlbnQgcmVxdWVzdAotICogQGFjdGl2ZSAtIHRoZSBhY3RpdmUg
dHJhY2tlcgotICogQHJlcXVlc3QgLSB0aGUgcmVxdWVzdCB0byB3YXRjaAotICoKLSAqIF9faTkx
NV9hY3RpdmVfcmVxdWVzdF9zZXQoKSB3YXRjaGVzIHRoZSBnaXZlbiBAcmVxdWVzdCBmb3IgY29t
cGxldGlvbi4gV2hpbHN0Ci0gKiB0aGF0IEByZXF1ZXN0IGlzIGJ1c3ksIHRoZSBAYWN0aXZlIHJl
cG9ydHMgYnVzeS4gV2hlbiB0aGF0IEByZXF1ZXN0IGlzCi0gKiByZXRpcmVkLCB0aGUgQGFjdGl2
ZSB0cmFja2VyIGlzIHVwZGF0ZWQgdG8gcmVwb3J0IGlkbGUuCi0gKi8KLXN0YXRpYyBpbmxpbmUg
dm9pZAotX19pOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldChzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVz
dCAqYWN0aXZlLAotCQkJICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0KQotewotCWxpc3Rf
bW92ZSgmYWN0aXZlLT5saW5rLCAmcmVxdWVzdC0+YWN0aXZlX2xpc3QpOwotCXJjdV9hc3NpZ25f
cG9pbnRlcihhY3RpdmUtPnJlcXVlc3QsIHJlcXVlc3QpOwotfQotCi1pbnQgX19tdXN0X2NoZWNr
Ci1pOTE1X2FjdGl2ZV9yZXF1ZXN0X3NldChzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0
aXZlLAotCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpOwotCi0vKioKLSAqIGk5MTVfYWN0aXZl
X3JlcXVlc3RfcmF3IC0gcmV0dXJuIHRoZSBhY3RpdmUgcmVxdWVzdAotICogQGFjdGl2ZSAtIHRo
ZSBhY3RpdmUgdHJhY2tlcgotICoKLSAqIGk5MTVfYWN0aXZlX3JlcXVlc3RfcmF3KCkgcmV0dXJu
cyB0aGUgY3VycmVudCByZXF1ZXN0IGJlaW5nIHRyYWNrZWQsIG9yIE5VTEwuCi0gKiBJdCBkb2Vz
IG5vdCBvYnRhaW4gYSByZWZlcmVuY2Ugb24gdGhlIHJlcXVlc3QgZm9yIHRoZSBjYWxsZXIsIHNv
IHRoZSBjYWxsZXIKLSAqIG11c3QgaG9sZCBzdHJ1Y3RfbXV0ZXguCi0gKi8KLXN0YXRpYyBpbmxp
bmUgc3RydWN0IGk5MTVfcmVxdWVzdCAqCi1pOTE1X2FjdGl2ZV9yZXF1ZXN0X3Jhdyhjb25zdCBz
dHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLAotCQkJc3RydWN0IG11dGV4ICptdXRl
eCkKLXsKLQlyZXR1cm4gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChhY3RpdmUtPnJlcXVlc3Qs
Ci0JCQkJCSBsb2NrZGVwX2lzX2hlbGQobXV0ZXgpKTsKLX0KLQotLyoqCi0gKiBpOTE1X2FjdGl2
ZV9yZXF1ZXN0X3BlZWsgLSByZXBvcnQgdGhlIGFjdGl2ZSByZXF1ZXN0IGJlaW5nIG1vbml0b3Jl
ZAotICogQGFjdGl2ZSAtIHRoZSBhY3RpdmUgdHJhY2tlcgotICoKLSAqIGk5MTVfYWN0aXZlX3Jl
cXVlc3RfcGVlaygpIHJldHVybnMgdGhlIGN1cnJlbnQgcmVxdWVzdCBiZWluZyB0cmFja2VkIGlm
Ci0gKiBzdGlsbCBhY3RpdmUsIG9yIE5VTEwuIEl0IGRvZXMgbm90IG9idGFpbiBhIHJlZmVyZW5j
ZSBvbiB0aGUgcmVxdWVzdAotICogZm9yIHRoZSBjYWxsZXIsIHNvIHRoZSBjYWxsZXIgbXVzdCBo
b2xkIHN0cnVjdF9tdXRleC4KLSAqLwotc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICoKLWk5MTVfYWN0aXZlX3JlcXVlc3RfcGVlayhjb25zdCBzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVx
dWVzdCAqYWN0aXZlLAotCQkJIHN0cnVjdCBtdXRleCAqbXV0ZXgpCi17Ci0Jc3RydWN0IGk5MTVf
cmVxdWVzdCAqcmVxdWVzdDsKLQotCXJlcXVlc3QgPSBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3Jhdyhh
Y3RpdmUsIG11dGV4KTsKLQlpZiAoIXJlcXVlc3QgfHwgaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZChy
ZXF1ZXN0KSkKLQkJcmV0dXJuIE5VTEw7CisjZGVmaW5lIElOSVRfQUNUSVZFX0ZFTkNFKEEpIF9f
aTkxNV9hY3RpdmVfZmVuY2VfaW5pdChBLCBOVUxMLCBOVUxMKQogCi0JcmV0dXJuIHJlcXVlc3Q7
Ci19CitzdHJ1Y3QgZG1hX2ZlbmNlICoKK19faTkxNV9hY3RpdmVfZmVuY2Vfc2V0KHN0cnVjdCBp
OTE1X2FjdGl2ZV9mZW5jZSAqYWN0aXZlLAorCQkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpOwog
CiAvKioKLSAqIGk5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0IC0gcmV0dXJuIGEgcmVmZXJlbmNlIHRv
IHRoZSBhY3RpdmUgcmVxdWVzdAorICogaTkxNV9hY3RpdmVfZmVuY2Vfc2V0IC0gdXBkYXRlcyB0
aGUgdHJhY2tlciB0byB3YXRjaCB0aGUgY3VycmVudCBmZW5jZQogICogQGFjdGl2ZSAtIHRoZSBh
Y3RpdmUgdHJhY2tlcgorICogQHJxIC0gdGhlIHJlcXVlc3QgdG8gd2F0Y2gKICAqCi0gKiBpOTE1
X2FjdGl2ZV9yZXF1ZXN0X2dldCgpIHJldHVybnMgYSByZWZlcmVuY2UgdG8gdGhlIGFjdGl2ZSBy
ZXF1ZXN0LCBvciBOVUxMCi0gKiBpZiB0aGUgYWN0aXZlIHRyYWNrZXIgaXMgaWRsZS4gVGhlIGNh
bGxlciBtdXN0IGhvbGQgc3RydWN0X211dGV4LgorICogaTkxNV9hY3RpdmVfZmVuY2Vfc2V0KCkg
d2F0Y2hlcyB0aGUgZ2l2ZW4gQHJxIGZvciBjb21wbGV0aW9uLiBXaGlsZQorICogdGhhdCBAcnEg
aXMgYnVzeSwgdGhlIEBhY3RpdmUgcmVwb3J0cyBidXN5LiBXaGVuIHRoYXQgQHJxIGlzIHNpZ25h
bGVkCisgKiAob3IgZWxzZSByZXRpcmVkKSB0aGUgQGFjdGl2ZSB0cmFja2VyIGlzIHVwZGF0ZWQg
dG8gcmVwb3J0IGlkbGUuCiAgKi8KLXN0YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVfcmVxdWVzdCAq
Ci1pOTE1X2FjdGl2ZV9yZXF1ZXN0X2dldChjb25zdCBzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVz
dCAqYWN0aXZlLAotCQkJc3RydWN0IG11dGV4ICptdXRleCkKLXsKLQlyZXR1cm4gaTkxNV9yZXF1
ZXN0X2dldChpOTE1X2FjdGl2ZV9yZXF1ZXN0X3BlZWsoYWN0aXZlLCBtdXRleCkpOwotfQotCi0v
KioKLSAqIF9faTkxNV9hY3RpdmVfcmVxdWVzdF9nZXRfcmN1IC0gcmV0dXJuIGEgcmVmZXJlbmNl
IHRvIHRoZSBhY3RpdmUgcmVxdWVzdAotICogQGFjdGl2ZSAtIHRoZSBhY3RpdmUgdHJhY2tlcgot
ICoKLSAqIF9faTkxNV9hY3RpdmVfcmVxdWVzdF9nZXQoKSByZXR1cm5zIGEgcmVmZXJlbmNlIHRv
IHRoZSBhY3RpdmUgcmVxdWVzdCwKLSAqIG9yIE5VTEwgaWYgdGhlIGFjdGl2ZSB0cmFja2VyIGlz
IGlkbGUuIFRoZSBjYWxsZXIgbXVzdCBob2xkIHRoZSBSQ1UgcmVhZAotICogbG9jaywgYnV0IHRo
ZSByZXR1cm5lZCBwb2ludGVyIGlzIHNhZmUgdG8gdXNlIG91dHNpZGUgb2YgUkNVLgotICovCi1z
dGF0aWMgaW5saW5lIHN0cnVjdCBpOTE1X3JlcXVlc3QgKgotX19pOTE1X2FjdGl2ZV9yZXF1ZXN0
X2dldF9yY3UoY29uc3Qgc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSkKLXsKLQkv
KgotCSAqIFBlcmZvcm1pbmcgYSBsb2NrbGVzcyByZXRyaWV2YWwgb2YgdGhlIGFjdGl2ZSByZXF1
ZXN0IGlzIHN1cGVyCi0JICogdHJpY2t5LiBTTEFCX1RZUEVTQUZFX0JZX1JDVSBtZXJlbHkgZ3Vh
cmFudGVlcyB0aGF0IHRoZSBiYWNraW5nCi0JICogc2xhYiBvZiByZXF1ZXN0IG9iamVjdHMgd2ls
bCBub3QgYmUgZnJlZWQgd2hpbHN0IHdlIGhvbGQgdGhlCi0JICogUkNVIHJlYWQgbG9jay4gSXQg
ZG9lcyBub3QgZ3VhcmFudGVlIHRoYXQgdGhlIHJlcXVlc3QgaXRzZWxmCi0JICogd2lsbCBub3Qg
YmUgZnJlZWQgYW5kIHRoZW4gKnJldXNlZCouIFZpeiwKLQkgKgotCSAqIFRocmVhZCBBCQkJVGhy
ZWFkIEIKLQkgKgotCSAqIHJxID0gYWN0aXZlLnJlcXVlc3QKLQkgKgkJCQlyZXRpcmUocnEpIC0+
IGZyZWUocnEpOwotCSAqCQkJCShycSBpcyBub3cgZmlyc3Qgb24gdGhlIHNsYWIgZnJlZWxpc3Qp
Ci0JICoJCQkJYWN0aXZlLnJlcXVlc3QgPSBOVUxMCi0JICoKLQkgKgkJCQlycSA9IG5ldyBzdWJt
aXNzaW9uIG9uIGEgbmV3IG9iamVjdAotCSAqIHJlZihycSkKLQkgKgotCSAqIFRvIHByZXZlbnQg
dGhlIHJlcXVlc3QgZnJvbSBiZWluZyByZXVzZWQgd2hpbHN0IHRoZSBjYWxsZXIKLQkgKiB1c2Vz
IGl0LCB3ZSB0YWtlIGEgcmVmZXJlbmNlIGxpa2Ugbm9ybWFsLiBXaGlsc3QgYWNxdWlyaW5nCi0J
ICogdGhlIHJlZmVyZW5jZSB3ZSBjaGVjayB0aGF0IGl0IGlzIG5vdCBpbiBhIGRlc3Ryb3llZCBz
dGF0ZQotCSAqIChyZWZjbnQgPT0gMCkuIFRoYXQgcHJldmVudHMgdGhlIHJlcXVlc3QgYmVpbmcg
cmVhbGxvY2F0ZWQKLQkgKiB3aGlsc3QgdGhlIGNhbGxlciBob2xkcyBvbiB0byBpdC4gVG8gY2hl
Y2sgdGhhdCB0aGUgcmVxdWVzdAotCSAqIHdhcyBub3QgcmVhbGxvY2F0ZWQgYXMgd2UgYWNxdWly
ZWQgdGhlIHJlZmVyZW5jZSB3ZSBoYXZlIHRvCi0JICogY2hlY2sgdGhhdCBvdXIgcmVxdWVzdCBy
ZW1haW5zIHRoZSBhY3RpdmUgcmVxdWVzdCBhY3Jvc3MKLQkgKiB0aGUgbG9va3VwLCBpbiB0aGUg
c2FtZSBtYW5uZXIgYXMgYSBzZXFsb2NrLiBUaGUgdmlzaWJpbGl0eQotCSAqIG9mIHRoZSBwb2lu
dGVyIHZlcnN1cyB0aGUgcmVmZXJlbmNlIGNvdW50aW5nIGlzIGNvbnRyb2xsZWQKLQkgKiBieSB1
c2luZyBSQ1UgYmFycmllcnMgKHJjdV9kZXJlZmVyZW5jZSBhbmQgcmN1X2Fzc2lnbl9wb2ludGVy
KS4KLQkgKgotCSAqIEluIHRoZSBtaWRkbGUgb2YgYWxsIHRoYXQsIHdlIGluc3BlY3Qgd2hldGhl
ciB0aGUgcmVxdWVzdCBpcwotCSAqIGNvbXBsZXRlLiBSZXRpcmluZyBpcyBsYXp5IHNvIHRoZSBy
ZXF1ZXN0IG1heSBiZSBjb21wbGV0ZWQgbG9uZwotCSAqIGJlZm9yZSB0aGUgYWN0aXZlIHRyYWNr
ZXIgaXMgdXBkYXRlZC4gUXVlcnlpbmcgd2hldGhlciB0aGUKLQkgKiByZXF1ZXN0IGlzIGNvbXBs
ZXRlIGlzIGZhciBjaGVhcGVyIChhcyBpdCBpbnZvbHZlcyBubyBsb2NrZWQKLQkgKiBpbnN0cnVj
dGlvbnMgc2V0dGluZyBjYWNoZWxpbmVzIHRvIGV4Y2x1c2l2ZSkgdGhhbiBhY3F1aXJpbmcKLQkg
KiB0aGUgcmVmZXJlbmNlLCBzbyB3ZSBkbyBpdCBmaXJzdC4gVGhlIFJDVSByZWFkIGxvY2sgZW5z
dXJlcyB0aGUKLQkgKiBwb2ludGVyIGRlcmVmZXJlbmNlIGlzIHZhbGlkLCBidXQgZG9lcyBub3Qg
ZW5zdXJlIHRoYXQgdGhlCi0JICogc2Vxbm8gbm9yIEhXUyBpcyB0aGUgcmlnaHQgb25lISBIb3dl
dmVyLCBpZiB0aGUgcmVxdWVzdCB3YXMKLQkgKiByZWFsbG9jYXRlZCwgdGhhdCBtZWFucyB0aGUg
YWN0aXZlIHRyYWNrZXIncyByZXF1ZXN0IHdhcyBjb21wbGV0ZS4KLQkgKiBJZiB0aGUgbmV3IHJl
cXVlc3QgaXMgYWxzbyBjb21wbGV0ZSwgdGhlbiBib3RoIGFyZSBhbmQgd2UgY2FuCi0JICoganVz
dCByZXBvcnQgdGhlIGFjdGl2ZSB0cmFja2VyIGlzIGlkbGUuIElmIHRoZSBuZXcgcmVxdWVzdCBp
cwotCSAqIGluY29tcGxldGUsIHRoZW4gd2UgYWNxdWlyZSBhIHJlZmVyZW5jZSBvbiBpdCBhbmQg
Y2hlY2sgdGhhdAotCSAqIGl0IHJlbWFpbmVkIHRoZSBhY3RpdmUgcmVxdWVzdC4KLQkgKgotCSAq
IEl0IGlzIHRoZW4gaW1wZXJhdGl2ZSB0aGF0IHdlIGRvIG5vdCB6ZXJvIHRoZSByZXF1ZXN0IG9u
Ci0JICogcmVhbGxvY2F0aW9uLCBzbyB0aGF0IHdlIGNhbiBjaGFzZSB0aGUgZGFuZ2xpbmcgcG9p
bnRlcnMhCi0JICogU2VlIGk5MTVfcmVxdWVzdF9hbGxvYygpLgotCSAqLwotCWRvIHsKLQkJc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdDsKLQotCQlyZXF1ZXN0ID0gcmN1X2RlcmVmZXJlbmNl
KGFjdGl2ZS0+cmVxdWVzdCk7Ci0JCWlmICghcmVxdWVzdCB8fCBpOTE1X3JlcXVlc3RfY29tcGxl
dGVkKHJlcXVlc3QpKQotCQkJcmV0dXJuIE5VTEw7Ci0KLQkJLyoKLQkJICogQW4gZXNwZWNpYWxs
eSBzaWxseSBjb21waWxlciBjb3VsZCBkZWNpZGUgdG8gcmVjb21wdXRlIHRoZQotCQkgKiByZXN1
bHQgb2YgaTkxNV9yZXF1ZXN0X2NvbXBsZXRlZCwgbW9yZSBzcGVjaWZpY2FsbHkKLQkJICogcmUt
ZW1pdCB0aGUgbG9hZCBmb3IgcmVxdWVzdC0+ZmVuY2Uuc2Vxbm8uIEEgcmFjZSB3b3VsZCBjYXRj
aAotCQkgKiBhIGxhdGVyIHNlcW5vIHZhbHVlLCB3aGljaCBjb3VsZCBmbGlwIHRoZSByZXN1bHQg
ZnJvbSB0cnVlIHRvCi0JCSAqIGZhbHNlLiBXaGljaCBtZWFucyBwYXJ0IG9mIHRoZSBpbnN0cnVj
dGlvbnMgYmVsb3cgbWlnaHQgbm90Ci0JCSAqIGJlIGV4ZWN1dGVkLCB3aGlsZSBsYXRlciBvbiBp
bnN0cnVjdGlvbnMgYXJlIGV4ZWN1dGVkLiBEdWUgdG8KLQkJICogYmFycmllcnMgd2l0aGluIHRo
ZSByZWZjb3VudGluZyB0aGUgaW5jb25zaXN0ZW5jeSBjYW4ndCByZWFjaAotCQkgKiBwYXN0IHRo
ZSBjYWxsIHRvIGk5MTVfcmVxdWVzdF9nZXRfcmN1LCBidXQgbm90IGV4ZWN1dGluZwotCQkgKiB0
aGF0IHdoaWxlIHN0aWxsIGV4ZWN1dGluZyBpOTE1X3JlcXVlc3RfcHV0KCkgY3JlYXRlcwotCQkg
KiBoYXZvYyBlbm91Z2guICBQcmV2ZW50IHRoaXMgd2l0aCBhIGNvbXBpbGVyIGJhcnJpZXIuCi0J
CSAqLwotCQliYXJyaWVyKCk7Ci0KLQkJcmVxdWVzdCA9IGk5MTVfcmVxdWVzdF9nZXRfcmN1KHJl
cXVlc3QpOwotCi0JCS8qCi0JCSAqIFdoYXQgc3RvcHMgdGhlIGZvbGxvd2luZyByY3VfYWNjZXNz
X3BvaW50ZXIoKSBmcm9tIG9jY3VycmluZwotCQkgKiBiZWZvcmUgdGhlIGFib3ZlIGk5MTVfcmVx
dWVzdF9nZXRfcmN1KCk/IElmIHdlIHdlcmUKLQkJICogdG8gcmVhZCB0aGUgdmFsdWUgYmVmb3Jl
IHBhdXNpbmcgdG8gZ2V0IHRoZSByZWZlcmVuY2UgdG8KLQkJICogdGhlIHJlcXVlc3QsIHdlIG1h
eSBub3Qgbm90aWNlIGEgY2hhbmdlIGluIHRoZSBhY3RpdmUKLQkJICogdHJhY2tlci4KLQkJICoK
LQkJICogVGhlIHJjdV9hY2Nlc3NfcG9pbnRlcigpIGlzIGEgbWVyZSBjb21waWxlciBiYXJyaWVy
LCB3aGljaAotCQkgKiBtZWFucyBib3RoIHRoZSBDUFUgYW5kIGNvbXBpbGVyIGFyZSBmcmVlIHRv
IHBlcmZvcm0gdGhlCi0JCSAqIG1lbW9yeSByZWFkIHdpdGhvdXQgY29uc3RyYWludC4gVGhlIGNv
bXBpbGVyIG9ubHkgaGFzIHRvCi0JCSAqIGVuc3VyZSB0aGF0IGFueSBvcGVyYXRpb25zIGFmdGVy
IHRoZSByY3VfYWNjZXNzX3BvaW50ZXIoKQotCQkgKiBvY2N1ciBhZnRlcndhcmRzIGluIHByb2dy
YW0gb3JkZXIuIFRoaXMgbWVhbnMgdGhlIHJlYWQgbWF5Ci0JCSAqIGJlIHBlcmZvcm1lZCBlYXJs
aWVyIGJ5IGFuIG91dC1vZi1vcmRlciBDUFUsIG9yIGFkdmVudHVyb3VzCi0JCSAqIGNvbXBpbGVy
LgotCQkgKgotCQkgKiBUaGUgYXRvbWljIG9wZXJhdGlvbiBhdCB0aGUgaGVhcnQgb2YKLQkJICog
aTkxNV9yZXF1ZXN0X2dldF9yY3UoKSwgc2VlIGRtYV9mZW5jZV9nZXRfcmN1KCksIGlzCi0JCSAq
IGF0b21pY19pbmNfbm90X3plcm8oKSB3aGljaCBpcyBvbmx5IGEgZnVsbCBtZW1vcnkgYmFycmll
cgotCQkgKiB3aGVuIHN1Y2Nlc3NmdWwuIFRoYXQgaXMsIGlmIGk5MTVfcmVxdWVzdF9nZXRfcmN1
KCkKLQkJICogcmV0dXJucyB0aGUgcmVxdWVzdCAoYW5kIHNvIHdpdGggdGhlIHJlZmVyZW5jZSBj
b3VudGVkCi0JCSAqIGluY3JlbWVudGVkKSB0aGVuIHRoZSBmb2xsb3dpbmcgcmVhZCBmb3IgcmN1
X2FjY2Vzc19wb2ludGVyKCkKLQkJICogbXVzdCBvY2N1ciBhZnRlciB0aGUgYXRvbWljIG9wZXJh
dGlvbiBhbmQgc28gY29uZmlybQotCQkgKiB0aGF0IHRoaXMgcmVxdWVzdCBpcyB0aGUgb25lIGN1
cnJlbnRseSBiZWluZyB0cmFja2VkLgotCQkgKgotCQkgKiBUaGUgY29ycmVzcG9uZGluZyB3cml0
ZSBiYXJyaWVyIGlzIHBhcnQgb2YKLQkJICogcmN1X2Fzc2lnbl9wb2ludGVyKCkuCi0JCSAqLwot
CQlpZiAoIXJlcXVlc3QgfHwgcmVxdWVzdCA9PSByY3VfYWNjZXNzX3BvaW50ZXIoYWN0aXZlLT5y
ZXF1ZXN0KSkKLQkJCXJldHVybiByY3VfcG9pbnRlcl9oYW5kb2ZmKHJlcXVlc3QpOwotCi0JCWk5
MTVfcmVxdWVzdF9wdXQocmVxdWVzdCk7Ci0JfSB3aGlsZSAoMSk7Ci19Ci0KK2ludCBfX211c3Rf
Y2hlY2sKK2k5MTVfYWN0aXZlX2ZlbmNlX3NldChzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFj
dGl2ZSwKKwkJICAgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpOwogLyoqCi0gKiBpOTE1X2Fj
dGl2ZV9yZXF1ZXN0X2dldF91bmxvY2tlZCAtIHJldHVybiBhIHJlZmVyZW5jZSB0byB0aGUgYWN0
aXZlIHJlcXVlc3QKKyAqIGk5MTVfYWN0aXZlX2ZlbmNlX2dldCAtIHJldHVybiBhIHJlZmVyZW5j
ZSB0byB0aGUgYWN0aXZlIGZlbmNlCiAgKiBAYWN0aXZlIC0gdGhlIGFjdGl2ZSB0cmFja2VyCiAg
KgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9nZXRfdW5sb2NrZWQoKSByZXR1cm5zIGEgcmVmZXJl
bmNlIHRvIHRoZSBhY3RpdmUgcmVxdWVzdCwKKyAqIGk5MTVfYWN0aXZlX2ZlbmNlX2dldCgpIHJl
dHVybnMgYSByZWZlcmVuY2UgdG8gdGhlIGFjdGl2ZSBmZW5jZSwKICAqIG9yIE5VTEwgaWYgdGhl
IGFjdGl2ZSB0cmFja2VyIGlzIGlkbGUuIFRoZSByZWZlcmVuY2UgaXMgb2J0YWluZWQgdW5kZXIg
UkNVLAogICogc28gbm8gbG9ja2luZyBpcyByZXF1aXJlZCBieSB0aGUgY2FsbGVyLgogICoKLSAq
IFRoZSByZWZlcmVuY2Ugc2hvdWxkIGJlIGZyZWVkIHdpdGggaTkxNV9yZXF1ZXN0X3B1dCgpLgor
ICogVGhlIHJlZmVyZW5jZSBzaG91bGQgYmUgZnJlZWQgd2l0aCBkbWFfZmVuY2VfcHV0KCkuCiAg
Ki8KLXN0YXRpYyBpbmxpbmUgc3RydWN0IGk5MTVfcmVxdWVzdCAqCi1pOTE1X2FjdGl2ZV9yZXF1
ZXN0X2dldF91bmxvY2tlZChjb25zdCBzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZl
KQorc3RhdGljIGlubGluZSBzdHJ1Y3QgZG1hX2ZlbmNlICoKK2k5MTVfYWN0aXZlX2ZlbmNlX2dl
dChzdHJ1Y3QgaTkxNV9hY3RpdmVfZmVuY2UgKmFjdGl2ZSkKIHsKLQlzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpyZXF1ZXN0OworCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlOwogCiAJcmN1X3JlYWRfbG9j
aygpOwotCXJlcXVlc3QgPSBfX2k5MTVfYWN0aXZlX3JlcXVlc3RfZ2V0X3JjdShhY3RpdmUpOwor
CWZlbmNlID0gZG1hX2ZlbmNlX2dldF9yY3Vfc2FmZSgmYWN0aXZlLT5mZW5jZSk7CiAJcmN1X3Jl
YWRfdW5sb2NrKCk7CiAKLQlyZXR1cm4gcmVxdWVzdDsKKwlyZXR1cm4gZmVuY2U7CiB9CiAKIC8q
KgotICogaTkxNV9hY3RpdmVfcmVxdWVzdF9pc3NldCAtIHJlcG9ydCB3aGV0aGVyIHRoZSBhY3Rp
dmUgdHJhY2tlciBpcyBhc3NpZ25lZAorICogaTkxNV9hY3RpdmVfZmVuY2VfaXNzZXQgLSByZXBv
cnQgd2hldGhlciB0aGUgYWN0aXZlIHRyYWNrZXIgaXMgYXNzaWduZWQKICAqIEBhY3RpdmUgLSB0
aGUgYWN0aXZlIHRyYWNrZXIKICAqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X2lzc2V0KCkgcmV0
dXJucyB0cnVlIGlmIHRoZSBhY3RpdmUgdHJhY2tlciBpcyBjdXJyZW50bHkKLSAqIGFzc2lnbmVk
IHRvIGEgcmVxdWVzdC4gRHVlIHRvIHRoZSBsYXp5IHJldGlyaW5nLCB0aGF0IHJlcXVlc3QgbWF5
IGJlIGlkbGUKKyAqIGk5MTVfYWN0aXZlX2ZlbmNlX2lzc2V0KCkgcmV0dXJucyB0cnVlIGlmIHRo
ZSBhY3RpdmUgdHJhY2tlciBpcyBjdXJyZW50bHkKKyAqIGFzc2lnbmVkIHRvIGEgZmVuY2UuIER1
ZSB0byB0aGUgbGF6eSByZXRpcmluZywgdGhhdCBmZW5jZSBtYXkgYmUgaWRsZQogICogYW5kIHRo
aXMgbWF5IHJlcG9ydCBzdGFsZSBpbmZvcm1hdGlvbi4KICAqLwogc3RhdGljIGlubGluZSBib29s
Ci1pOTE1X2FjdGl2ZV9yZXF1ZXN0X2lzc2V0KGNvbnN0IHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1
ZXN0ICphY3RpdmUpCitpOTE1X2FjdGl2ZV9mZW5jZV9pc3NldChjb25zdCBzdHJ1Y3QgaTkxNV9h
Y3RpdmVfZmVuY2UgKmFjdGl2ZSkKIHsKLQlyZXR1cm4gcmN1X2FjY2Vzc19wb2ludGVyKGFjdGl2
ZS0+cmVxdWVzdCk7CisJcmV0dXJuIHJjdV9hY2Nlc3NfcG9pbnRlcihhY3RpdmUtPmZlbmNlKTsK
IH0KIAotLyoqCi0gKiBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3JldGlyZSAtIHdhaXRzIHVudGlsIHRo
ZSByZXF1ZXN0IGlzIHJldGlyZWQKLSAqIEBhY3RpdmUgLSB0aGUgYWN0aXZlIHJlcXVlc3Qgb24g
d2hpY2ggdG8gd2FpdAotICoKLSAqIGk5MTVfYWN0aXZlX3JlcXVlc3RfcmV0aXJlKCkgd2FpdHMg
dW50aWwgdGhlIHJlcXVlc3QgaXMgY29tcGxldGVkLAotICogYW5kIHRoZW4gZW5zdXJlcyB0aGF0
IGF0IGxlYXN0IHRoZSByZXRpcmVtZW50IGhhbmRsZXIgZm9yIHRoaXMKLSAqIEBhY3RpdmUgdHJh
Y2tlciBpcyBjYWxsZWQgYmVmb3JlIHJldHVybmluZy4gSWYgdGhlIEBhY3RpdmUKLSAqIHRyYWNr
ZXIgaXMgaWRsZSwgdGhlIGZ1bmN0aW9uIHJldHVybnMgaW1tZWRpYXRlbHkuCi0gKi8KLXN0YXRp
YyBpbmxpbmUgaW50IF9fbXVzdF9jaGVjawotaTkxNV9hY3RpdmVfcmVxdWVzdF9yZXRpcmUoc3Ry
dWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKmFjdGl2ZSwKLQkJCSAgIHN0cnVjdCBtdXRleCAqbXV0
ZXgpCitzdGF0aWMgaW5saW5lIHZvaWQKK2k5MTVfYWN0aXZlX2ZlbmNlX2NiKHN0cnVjdCBkbWFf
ZmVuY2UgKmZlbmNlLCBzdHJ1Y3QgZG1hX2ZlbmNlX2NiICpjYikKIHsKLQlzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpyZXF1ZXN0OwotCWxvbmcgcmV0OwotCi0JcmVxdWVzdCA9IGk5MTVfYWN0aXZlX3Jl
cXVlc3RfcmF3KGFjdGl2ZSwgbXV0ZXgpOwotCWlmICghcmVxdWVzdCkKLQkJcmV0dXJuIDA7Ci0K
LQlyZXQgPSBpOTE1X3JlcXVlc3Rfd2FpdChyZXF1ZXN0LAotCQkJCUk5MTVfV0FJVF9JTlRFUlJV
UFRJQkxFIHwgSTkxNV9XQUlUX0xPQ0tFRCwKLQkJCQlNQVhfU0NIRURVTEVfVElNRU9VVCk7Ci0J
aWYgKHJldCA8IDApCi0JCXJldHVybiByZXQ7Ci0KLQlsaXN0X2RlbF9pbml0KCZhY3RpdmUtPmxp
bmspOwotCVJDVV9JTklUX1BPSU5URVIoYWN0aXZlLT5yZXF1ZXN0LCBOVUxMKTsKLQotCWFjdGl2
ZS0+cmV0aXJlKGFjdGl2ZSwgcmVxdWVzdCk7CisJc3RydWN0IGk5MTVfYWN0aXZlX2ZlbmNlICph
Y3RpdmUgPQorCQljb250YWluZXJfb2YoY2IsIHR5cGVvZigqYWN0aXZlKSwgY2IpOwogCi0JcmV0
dXJuIDA7CisJUkNVX0lOSVRfUE9JTlRFUihhY3RpdmUtPmZlbmNlLCBOVUxMKTsKIH0KIAogLyoK
QEAgLTM1MCwzMSArMTU1LDI5IEBAIGk5MTVfYWN0aXZlX3JlcXVlc3RfcmV0aXJlKHN0cnVjdCBp
OTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCiAgKiBzeW5jaHJvbmlzYXRpb24uCiAgKi8KIAot
dm9pZCBfX2k5MTVfYWN0aXZlX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCi0J
CQlzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiwKK3ZvaWQgX19pOTE1X2FjdGl2ZV9pbml0KHN0cnVj
dCBpOTE1X2FjdGl2ZSAqcmVmLAogCQkJaW50ICgqYWN0aXZlKShzdHJ1Y3QgaTkxNV9hY3RpdmUg
KnJlZiksCiAJCQl2b2lkICgqcmV0aXJlKShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiksCiAJCQlz
dHJ1Y3QgbG9ja19jbGFzc19rZXkgKmtleSk7Ci0jZGVmaW5lIGk5MTVfYWN0aXZlX2luaXQoaTkx
NSwgcmVmLCBhY3RpdmUsIHJldGlyZSkgZG8gewkJXAorI2RlZmluZSBpOTE1X2FjdGl2ZV9pbml0
KHJlZiwgYWN0aXZlLCByZXRpcmUpIGRvIHsJCVwKIAlzdGF0aWMgc3RydWN0IGxvY2tfY2xhc3Nf
a2V5IF9fa2V5OwkJCQlcCiAJCQkJCQkJCQlcCi0JX19pOTE1X2FjdGl2ZV9pbml0KGk5MTUsIHJl
ZiwgYWN0aXZlLCByZXRpcmUsICZfX2tleSk7CQlcCisJX19pOTE1X2FjdGl2ZV9pbml0KHJlZiwg
YWN0aXZlLCByZXRpcmUsICZfX2tleSk7CQlcCiB9IHdoaWxlICgwKQogCiBpbnQgaTkxNV9hY3Rp
dmVfcmVmKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmLAogCQkgICAgdTY0IHRpbWVsaW5lLAotCQkg
ICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpOworCQkgICAgc3RydWN0IGRtYV9mZW5jZSAqZmVu
Y2UpOwogCiBpbnQgaTkxNV9hY3RpdmVfd2FpdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7CiAK
IGludCBpOTE1X3JlcXVlc3RfYXdhaXRfYWN0aXZlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAog
CQkJICAgICAgc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpOwotaW50IGk5MTVfcmVxdWVzdF9hd2Fp
dF9hY3RpdmVfcmVxdWVzdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKLQkJCQkgICAgICBzdHJ1
Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlKTsKK2ludCBpOTE1X3JlcXVlc3RfYXdhaXRf
YWN0aXZlX2ZlbmNlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAorCQkJCSAgICBzdHJ1Y3QgaTkx
NV9hY3RpdmVfZmVuY2UgKmFjdGl2ZSk7CiAKIGludCBpOTE1X2FjdGl2ZV9hY3F1aXJlKHN0cnVj
dCBpOTE1X2FjdGl2ZSAqcmVmKTsKIHZvaWQgaTkxNV9hY3RpdmVfcmVsZWFzZShzdHJ1Y3QgaTkx
NV9hY3RpdmUgKnJlZik7Ci12b2lkIF9faTkxNV9hY3RpdmVfcmVsZWFzZV9uZXN0ZWQoc3RydWN0
IGk5MTVfYWN0aXZlICpyZWYsIGludCBzdWJjbGFzcyk7CiAKIHN0YXRpYyBpbmxpbmUgYm9vbAog
aTkxNV9hY3RpdmVfaXNfaWRsZShjb25zdCBzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5cGVzLmggYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZV90eXBlcy5oCmluZGV4IDA2YWNkZmZlMGY2ZC4uOTUx
OWI2NTIzODAxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZV90
eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5cGVzLmgKQEAg
LTgsMzAgKzgsMjEgQEAKICNkZWZpbmUgX0k5MTVfQUNUSVZFX1RZUEVTX0hfCiAKICNpbmNsdWRl
IDxsaW51eC9hdG9taWMuaD4KKyNpbmNsdWRlIDxsaW51eC9kbWEtZmVuY2UuaD4KICNpbmNsdWRl
IDxsaW51eC9sbGlzdC5oPgogI2luY2x1ZGUgPGxpbnV4L211dGV4Lmg+CiAjaW5jbHVkZSA8bGlu
dXgvcmJ0cmVlLmg+CiAjaW5jbHVkZSA8bGludXgvcmN1cGRhdGUuaD4KICNpbmNsdWRlIDxsaW51
eC93b3JrcXVldWUuaD4KIAotc3RydWN0IGRybV9pOTE1X3ByaXZhdGU7Ci1zdHJ1Y3QgaTkxNV9h
Y3RpdmVfcmVxdWVzdDsKLXN0cnVjdCBpOTE1X3JlcXVlc3Q7Ci0KLXR5cGVkZWYgdm9pZCAoKmk5
MTVfYWN0aXZlX3JldGlyZV9mbikoc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgKiwKLQkJCQkg
ICAgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICopOwotCi1zdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVz
dCB7Ci0Jc3RydWN0IGk5MTVfcmVxdWVzdCBfX3JjdSAqcmVxdWVzdDsKLQlzdHJ1Y3QgbGlzdF9o
ZWFkIGxpbms7Ci0JaTkxNV9hY3RpdmVfcmV0aXJlX2ZuIHJldGlyZTsKK3N0cnVjdCBpOTE1X2Fj
dGl2ZV9mZW5jZSB7CisJc3RydWN0IGRtYV9mZW5jZSBfX3JjdSAqZmVuY2U7CisJc3RydWN0IGRt
YV9mZW5jZV9jYiBjYjsKIH07CiAKIHN0cnVjdCBhY3RpdmVfbm9kZTsKIAogc3RydWN0IGk5MTVf
YWN0aXZlIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNTsKLQogCXN0cnVjdCBhY3Rp
dmVfbm9kZSAqY2FjaGU7CiAJc3RydWN0IHJiX3Jvb3QgdHJlZTsKIAlzdHJ1Y3QgbXV0ZXggbXV0
ZXg7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwppbmRleCA5NDIyODIxYzlkNTguLjk0OTAxZDJkNjU3
MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCkBAIC05NTIsMjggKzk1MiwzOCBAQCB3YWl0X2Zv
cl90aW1lbGluZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAKIAltdXRleF9sb2Nr
KCZndC0+bXV0ZXgpOwogCWxpc3RfZm9yX2VhY2hfZW50cnkodGwsICZndC0+YWN0aXZlX2xpc3Qs
IGxpbmspIHsKLQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJCXN0cnVjdCBkbWFfZmVuY2Ug
KmZlbmNlOwogCi0JCXJxID0gaTkxNV9hY3RpdmVfcmVxdWVzdF9nZXRfdW5sb2NrZWQoJnRsLT5s
YXN0X3JlcXVlc3QpOwotCQlpZiAoIXJxKQorCQlmZW5jZSA9IGk5MTVfYWN0aXZlX2ZlbmNlX2dl
dCgmdGwtPmxhc3RfcmVxdWVzdCk7CisJCWlmICghZmVuY2UpCiAJCQljb250aW51ZTsKIAogCQlt
dXRleF91bmxvY2soJmd0LT5tdXRleCk7CiAKLQkJLyoKLQkJICogIlJhY2UtdG8taWRsZSIuCi0J
CSAqCi0JCSAqIFN3aXRjaGluZyB0byB0aGUga2VybmVsIGNvbnRleHQgaXMgb2Z0ZW4gdXNlZCBh
IHN5bmNocm9ub3VzCi0JCSAqIHN0ZXAgcHJpb3IgdG8gaWRsaW5nLCBlLmcuIGluIHN1c3BlbmQg
Zm9yIGZsdXNoaW5nIGFsbAotCQkgKiBjdXJyZW50IG9wZXJhdGlvbnMgdG8gbWVtb3J5IGJlZm9y
ZSBzbGVlcGluZy4gVGhlc2Ugd2UKLQkJICogd2FudCB0byBjb21wbGV0ZSBhcyBxdWlja2x5IGFz
IHBvc3NpYmxlIHRvIGF2b2lkIHByb2xvbmdlZAotCQkgKiBzdGFsbHMsIHNvIGFsbG93IHRoZSBn
cHUgdG8gYm9vc3QgdG8gbWF4aW11bSBjbG9ja3MuCi0JCSAqLwotCQlpZiAoZmxhZ3MgJiBJOTE1
X1dBSVRfRk9SX0lETEVfQk9PU1QpCi0JCQlnZW42X3Jwc19ib29zdChycSk7CisJCWlmICghZG1h
X2ZlbmNlX2lzX2k5MTUoZmVuY2UpKSB7CisJCQl0aW1lb3V0ID0gZG1hX2ZlbmNlX3dhaXRfdGlt
ZW91dChmZW5jZSwKKwkJCQkJCQkgZmxhZ3MgJiBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSwKKwkJ
CQkJCQkgdGltZW91dCk7CisJCX0gZWxzZSB7CisJCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSA9
IHRvX3JlcXVlc3QoZmVuY2UpOworCisJCQkvKgorCQkJICogIlJhY2UtdG8taWRsZSIuCisJCQkg
KgorCQkJICogU3dpdGNoaW5nIHRvIHRoZSBrZXJuZWwgY29udGV4dCBpcyBvZnRlbiB1c2VkIGFz
CisJCQkgKiBhIHN5bmNocm9ub3VzIHN0ZXAgcHJpb3IgdG8gaWRsaW5nLCBlLmcuIGluIHN1c3Bl
bmQKKwkJCSAqIGZvciBmbHVzaGluZyBhbGwgY3VycmVudCBvcGVyYXRpb25zIHRvIG1lbW9yeSBi
ZWZvcmUKKwkJCSAqIHNsZWVwaW5nLiBUaGVzZSB3ZSB3YW50IHRvIGNvbXBsZXRlIGFzIHF1aWNr
bHkgYXMKKwkJCSAqIHBvc3NpYmxlIHRvIGF2b2lkIHByb2xvbmdlZCBzdGFsbHMsIHNvIGFsbG93
IHRoZSBncHUKKwkJCSAqIHRvIGJvb3N0IHRvIG1heGltdW0gY2xvY2tzLgorCQkJICovCisJCQlp
ZiAoZmxhZ3MgJiBJOTE1X1dBSVRfRk9SX0lETEVfQk9PU1QpCisJCQkJZ2VuNl9ycHNfYm9vc3Qo
cnEpOworCisJCQl0aW1lb3V0ID0gaTkxNV9yZXF1ZXN0X3dhaXQocnEsIGZsYWdzLCB0aW1lb3V0
KTsKKwkJfQogCi0JCXRpbWVvdXQgPSBpOTE1X3JlcXVlc3Rfd2FpdChycSwgZmxhZ3MsIHRpbWVv
dXQpOwotCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKKwkJZG1hX2ZlbmNlX3B1dChmZW5jZSk7CiAJ
CWlmICh0aW1lb3V0IDwgMCkKIAkJCXJldHVybiB0aW1lb3V0OwogCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZ2VtX2d0dC5jCmluZGV4IDcxOTVjM2MwOTY1Ni4uN2M1OTcwZjUxNTIzIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbV9ndHQuYwpAQCAtMjA2MSw3ICsyMDYxLDcgQEAgc3RhdGljIHN0cnVj
dCBpOTE1X3ZtYSAqcGRfdm1hX2NyZWF0ZShzdHJ1Y3QgZ2VuNl9wcGd0dCAqcHBndHQsIGludCBz
aXplKQogCWlmICghdm1hKQogCQlyZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKIAotCWk5MTVfYWN0
aXZlX2luaXQoaTkxNSwgJnZtYS0+YWN0aXZlLCBOVUxMLCBOVUxMKTsKKwlpOTE1X2FjdGl2ZV9p
bml0KCZ2bWEtPmFjdGl2ZSwgTlVMTCwgTlVMTCk7CiAKIAl2bWEtPnZtID0gJmdndHQtPnZtOwog
CXZtYS0+b3BzID0gJnBkX3ZtYV9vcHM7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3JlcXVlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCmlu
ZGV4IDg2NWI0OTkyOGZmOS4uZDQzZjFkM2Q1MGJhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3JlcXVlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Jl
cXVlc3QuYwpAQCAtMjI5LDkgKzIyOSw4IEBAIHN0YXRpYyB2b2lkIGZyZWVfY2FwdHVyZV9saXN0
KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QpCiAKIHN0YXRpYyBib29sIGk5MTVfcmVxdWVz
dF9yZXRpcmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7Ci0Jc3RydWN0IGk5MTVfYWN0aXZl
X3JlcXVlc3QgKmFjdGl2ZSwgKm5leHQ7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmcnEtPnRpbWVs
aW5lLT5tdXRleCk7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZycS0+aTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7CiAJaWYgKCFpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJxKSkKIAkJcmV0dXJuIGZh
bHNlOwogCkBAIC0yNDUsMzUgKzI0NCw2IEBAIHN0YXRpYyBib29sIGk5MTVfcmVxdWVzdF9yZXRp
cmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAKIAlhZHZhbmNlX3JpbmcocnEpOwogCi0JLyoK
LQkgKiBXYWxrIHRocm91Z2ggdGhlIGFjdGl2ZSBsaXN0LCBjYWxsaW5nIHJldGlyZSBvbiBlYWNo
LiBUaGlzIGFsbG93cwotCSAqIG9iamVjdHMgdG8gdHJhY2sgdGhlaXIgR1BVIGFjdGl2aXR5IGFu
ZCBtYXJrIHRoZW1zZWx2ZXMgYXMgaWRsZQotCSAqIHdoZW4gdGhlaXIgKmxhc3QqIGFjdGl2ZSBy
ZXF1ZXN0IGlzIGNvbXBsZXRlZCAodXBkYXRpbmcgc3RhdGUKLQkgKiB0cmFja2luZyBsaXN0cyBm
b3IgZXZpY3Rpb24sIGFjdGl2ZSByZWZlcmVuY2VzIGZvciBHRU0sIGV0YykuCi0JICoKLQkgKiBB
cyB0aGUgLT5yZXRpcmUoKSBtYXkgZnJlZSB0aGUgbm9kZSwgd2UgZGVjb3VwbGUgaXQgZmlyc3Qg
YW5kCi0JICogcGFzcyBhbG9uZyB0aGUgYXV4aWxpYXJ5IGluZm9ybWF0aW9uICh0byBhdm9pZCBk
ZXJlZmVyZW5jaW5nCi0JICogdGhlIG5vZGUgYWZ0ZXIgdGhlIGNhbGxiYWNrKS4KLQkgKi8KLQls
aXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUoYWN0aXZlLCBuZXh0LCAmcnEtPmFjdGl2ZV9saXN0LCBs
aW5rKSB7Ci0JCS8qCi0JCSAqIEluIG1pY3JvYmVuY2htYXJrcyBvciBmb2N1c2luZyB1cG9uIHRp
bWUgaW5zaWRlIHRoZSBrZXJuZWwsCi0JCSAqIHdlIG1heSBzcGVuZCBhbiBpbm9yZGluYXRlIGFt
b3VudCBvZiB0aW1lIHNpbXBseSBoYW5kbGluZwotCQkgKiB0aGUgcmV0aXJlbWVudCBvZiByZXF1
ZXN0cyBhbmQgcHJvY2Vzc2luZyB0aGVpciBjYWxsYmFja3MuCi0JCSAqIE9mIHdoaWNoLCB0aGlz
IGxvb3AgaXRzZWxmIGlzIHBhcnRpY3VsYXJseSBob3QgZHVlIHRvIHRoZQotCQkgKiBjYWNoZSBt
aXNzZXMgd2hlbiBqdW1waW5nIGFyb3VuZCB0aGUgbGlzdCBvZgotCQkgKiBpOTE1X2FjdGl2ZV9y
ZXF1ZXN0LiAgU28gd2UgdHJ5IHRvIGtlZXAgdGhpcyBsb29wIGFzCi0JCSAqIHN0cmVhbWxpbmVk
IGFzIHBvc3NpYmxlIGFuZCBhbHNvIHByZWZldGNoIHRoZSBuZXh0Ci0JCSAqIGk5MTVfYWN0aXZl
X3JlcXVlc3QgdG8gdHJ5IGFuZCBoaWRlIHRoZSBsaWtlbHkgY2FjaGUgbWlzcy4KLQkJICovCi0J
CXByZWZldGNodyhuZXh0KTsKLQotCQlJTklUX0xJU1RfSEVBRCgmYWN0aXZlLT5saW5rKTsKLQkJ
UkNVX0lOSVRfUE9JTlRFUihhY3RpdmUtPnJlcXVlc3QsIE5VTEwpOwotCi0JCWFjdGl2ZS0+cmV0
aXJlKGFjdGl2ZSwgcnEpOwotCX0KLQogCWxvY2FsX2lycV9kaXNhYmxlKCk7CiAKIAkvKgpAQCAt
MzI4LDExICsyOTgsOSBAQCB2b2lkIGk5MTVfcmVxdWVzdF9yZXRpcmVfdXB0byhzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpycSkKIAkJICBycS0+ZmVuY2UuY29udGV4dCwgcnEtPmZlbmNlLnNlcW5vLAog
CQkgIGh3c3Bfc2Vxbm8ocnEpKTsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnJxLT5pOTE1LT5k
cm0uc3RydWN0X211dGV4KTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZycS0+dGltZWxpbmUtPm11
dGV4KTsKIAlHRU1fQlVHX09OKCFpOTE1X3JlcXVlc3RfY29tcGxldGVkKHJxKSk7Ci0KLQlpZiAo
bGlzdF9lbXB0eSgmcnEtPnJpbmdfbGluaykpCi0JCXJldHVybjsKKwlHRU1fQlVHX09OKGxpc3Rf
ZW1wdHkoJnJxLT5yaW5nX2xpbmspKTsKIAogCWRvIHsKIAkJdG1wID0gbGlzdF9maXJzdF9lbnRy
eSgmcmluZy0+cmVxdWVzdF9saXN0LApAQCAtNTY3LDYgKzUzNSw3IEBAIHN0YXRpYyB2b2lkIHJp
bmdfcmV0aXJlX3JlcXVlc3RzKHN0cnVjdCBpbnRlbF9yaW5nICpyaW5nKQogewogCXN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxLCAqcm47CiAKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZyaW5nLT50aW1l
bGluZS0+bXV0ZXgpOwogCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShycSwgcm4sICZyaW5nLT5y
ZXF1ZXN0X2xpc3QsIHJpbmdfbGluaykKIAkJaWYgKCFpOTE1X3JlcXVlc3RfcmV0aXJlKHJxKSkK
IAkJCWJyZWFrOwpAQCAtNjg3LDcgKzY1Niw2IEBAIF9faTkxNV9yZXF1ZXN0X2NyZWF0ZShzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2UsIGdmcF90IGdmcCkKIAlycS0+d2FpdGJvb3N0ID0gZmFsc2U7
CiAJcnEtPmV4ZWN1dGlvbl9tYXNrID0gQUxMX0VOR0lORVM7CiAKLQlJTklUX0xJU1RfSEVBRCgm
cnEtPmFjdGl2ZV9saXN0KTsKIAlJTklUX0xJU1RfSEVBRCgmcnEtPmV4ZWN1dGVfY2IpOwogCiAJ
LyoKQEAgLTcyNiw3ICs2OTQsNiBAQCBfX2k5MTVfcmVxdWVzdF9jcmVhdGUoc3RydWN0IGludGVs
X2NvbnRleHQgKmNlLCBnZnBfdCBnZnApCiAJY2UtPnJpbmctPmVtaXQgPSBycS0+aGVhZDsKIAog
CS8qIE1ha2Ugc3VyZSB3ZSBkaWRuJ3QgYWRkIG91cnNlbHZlcyB0byBleHRlcm5hbCBzdGF0ZSBi
ZWZvcmUgZnJlZWluZyAqLwotCUdFTV9CVUdfT04oIWxpc3RfZW1wdHkoJnJxLT5hY3RpdmVfbGlz
dCkpOwogCUdFTV9CVUdfT04oIWxpc3RfZW1wdHkoJnJxLT5zY2hlZC5zaWduYWxlcnNfbGlzdCkp
OwogCUdFTV9CVUdfT04oIWxpc3RfZW1wdHkoJnJxLT5zY2hlZC53YWl0ZXJzX2xpc3QpKTsKIApA
QCAtMTExNiw3ICsxMDgzLDggQEAgX19pOTE1X3JlcXVlc3RfYWRkX3RvX3RpbWVsaW5lKHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxKQogCSAqIHByZWNsdWRlcyBvcHRpbWlzaW5nIHRvIHVzZSBzZW1h
cGhvcmVzIHNlcmlhbGlzYXRpb24gb2YgYSBzaW5nbGUKIAkgKiB0aW1lbGluZSBhY3Jvc3MgZW5n
aW5lcy4KIAkgKi8KLQlwcmV2ID0gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZCh0aW1lbGluZS0+
bGFzdF9yZXF1ZXN0LnJlcXVlc3QsIDEpOworCXByZXYgPSB0b19yZXF1ZXN0KF9faTkxNV9hY3Rp
dmVfZmVuY2Vfc2V0KCZ0aW1lbGluZS0+bGFzdF9yZXF1ZXN0LAorCQkJCQkJICAmcnEtPmZlbmNl
KSk7CiAJaWYgKHByZXYgJiYgIWk5MTVfcmVxdWVzdF9jb21wbGV0ZWQocHJldikpIHsKIAkJaWYg
KGlzX3Bvd2VyX29mXzIocHJldi0+ZW5naW5lLT5tYXNrIHwgcnEtPmVuZ2luZS0+bWFzaykpCiAJ
CQlpOTE1X3N3X2ZlbmNlX2F3YWl0X3N3X2ZlbmNlKCZycS0+c3VibWl0LApAQCAtMTE0MSw3ICsx
MTA5LDYgQEAgX19pOTE1X3JlcXVlc3RfYWRkX3RvX3RpbWVsaW5lKHN0cnVjdCBpOTE1X3JlcXVl
c3QgKnJxKQogCSAqIHVzLCB0aGUgdGltZWxpbmUgd2lsbCBob2xkIGl0cyBzZXFubyB3aGljaCBp
cyBsYXRlciB0aGFuIG91cnMuCiAJICovCiAJR0VNX0JVR19PTih0aW1lbGluZS0+c2Vxbm8gIT0g
cnEtPmZlbmNlLnNlcW5vKTsKLQlfX2k5MTVfYWN0aXZlX3JlcXVlc3Rfc2V0KCZ0aW1lbGluZS0+
bGFzdF9yZXF1ZXN0LCBycSk7CiAKIAlyZXR1cm4gcHJldjsKIH0KQEAgLTEzNzIsMTAgKzEzMzks
NiBAQCBzdGF0aWMgdm9pZCByZXF1ZXN0X3dhaXRfd2FrZShzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5j
ZSwgc3RydWN0IGRtYV9mZW5jZV9jYiAqY2IpCiAgKiBtYXhpbXVtIG9mIEB0aW1lb3V0IGppZmZp
ZXMgKHdpdGggTUFYX1NDSEVEVUxFX1RJTUVPVVQgaW1wbHlpbmcgYW4KICAqIHVuYm91bmRlZCB3
YWl0KS4KICAqCi0gKiBJZiB0aGUgY2FsbGVyIGhvbGRzIHRoZSBzdHJ1Y3RfbXV0ZXgsIHRoZSBj
YWxsZXIgbXVzdCBwYXNzIEk5MTVfV0FJVF9MT0NLRUQKLSAqIGluIHZpYSB0aGUgZmxhZ3MsIGFu
ZCB2aWNlIHZlcnNhIGlmIHRoZSBzdHJ1Y3RfbXV0ZXggaXMgbm90IGhlbGQsIHRoZSBjYWxsZXIK
LSAqIG11c3Qgbm90IHNwZWNpZnkgdGhhdCB0aGUgd2FpdCBpcyBsb2NrZWQuCi0gKgogICogUmV0
dXJucyB0aGUgcmVtYWluaW5nIHRpbWUgKGluIGppZmZpZXMpIGlmIHRoZSByZXF1ZXN0IGNvbXBs
ZXRlZCwgd2hpY2ggbWF5CiAgKiBiZSB6ZXJvIG9yIC1FVElNRSBpZiB0aGUgcmVxdWVzdCBpcyB1
bmZpbmlzaGVkIGFmdGVyIHRoZSB0aW1lb3V0IGV4cGlyZXMuCiAgKiBNYXkgcmV0dXJuIC1FSU5U
UiBpcyBjYWxsZWQgd2l0aCBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSBhbmQgYSBzaWduYWwgaXMK
QEAgLTE0OTUsNyArMTQ1OCwxMSBAQCBib29sIGk5MTVfcmV0aXJlX3JlcXVlc3RzKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShyaW5nLCB0
bXAsCiAJCQkJICZpOTE1LT5ndC5hY3RpdmVfcmluZ3MsIGFjdGl2ZV9saW5rKSB7CiAJCWludGVs
X3JpbmdfZ2V0KHJpbmcpOyAvKiBsYXN0IHJxIGhvbGRzIHJlZmVyZW5jZSEgKi8KKwkJbXV0ZXhf
bG9jaygmcmluZy0+dGltZWxpbmUtPm11dGV4KTsKKwogCQlyaW5nX3JldGlyZV9yZXF1ZXN0cyhy
aW5nKTsKKworCQltdXRleF91bmxvY2soJnJpbmctPnRpbWVsaW5lLT5tdXRleCk7CiAJCWludGVs
X3JpbmdfcHV0KHJpbmcpOwogCX0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9yZXF1ZXN0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaAppbmRl
eCBiZWJjMWU5YjRhNWUuLjgyNzdjZmYwZGY3MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9yZXF1ZXN0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1
ZXN0LmgKQEAgLTIxMSw3ICsyMTEsNiBAQCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0IHsKIAkgKiBvbiB0
aGUgYWN0aXZlX2xpc3QgKG9mIHRoZWlyIGZpbmFsIHJlcXVlc3QpLgogCSAqLwogCXN0cnVjdCBp
OTE1X2NhcHR1cmVfbGlzdCAqY2FwdHVyZV9saXN0OwotCXN0cnVjdCBsaXN0X2hlYWQgYWN0aXZl
X2xpc3Q7CiAKIAkvKiogVGltZSBhdCB3aGljaCB0aGlzIHJlcXVlc3Qgd2FzIGVtaXR0ZWQsIGlu
IGppZmZpZXMuICovCiAJdW5zaWduZWQgbG9uZyBlbWl0dGVkX2ppZmZpZXM7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3RpbWVsaW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3RpbWVsaW5lLmMKaW5kZXggZTJmOTMzNmJhYjgzLi40ZmZiNjE5OTE3NjggMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdGltZWxpbmUuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3RpbWVsaW5lLmMKQEAgLTE3OSw4ICsxNzksNyBAQCBjYWNo
ZWxpbmVfYWxsb2Moc3RydWN0IGk5MTVfdGltZWxpbmVfaHdzcCAqaHdzcCwgdW5zaWduZWQgaW50
IGNhY2hlbGluZSkKIAljbC0+aHdzcCA9IGh3c3A7CiAJY2wtPnZhZGRyID0gcGFnZV9wYWNrX2Jp
dHModmFkZHIsIGNhY2hlbGluZSk7CiAKLQlpOTE1X2FjdGl2ZV9pbml0KGh3c3BfdG9faTkxNSho
d3NwKSwgJmNsLT5hY3RpdmUsCi0JCQkgX19jYWNoZWxpbmVfYWN0aXZlLCBfX2NhY2hlbGluZV9y
ZXRpcmUpOworCWk5MTVfYWN0aXZlX2luaXQoJmNsLT5hY3RpdmUsIF9fY2FjaGVsaW5lX2FjdGl2
ZSwgX19jYWNoZWxpbmVfcmV0aXJlKTsKIAogCXJldHVybiBjbDsKIH0KQEAgLTI2Myw3ICsyNjIs
NyBAQCBpbnQgaTkxNV90aW1lbGluZV9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LAogCiAJbXV0ZXhfaW5pdCgmdGltZWxpbmUtPm11dGV4KTsKIAotCUlOSVRfQUNUSVZFX1JFUVVF
U1QoJnRpbWVsaW5lLT5sYXN0X3JlcXVlc3QpOworCUlOSVRfQUNUSVZFX0ZFTkNFKCZ0aW1lbGlu
ZS0+bGFzdF9yZXF1ZXN0KTsKIAlJTklUX0xJU1RfSEVBRCgmdGltZWxpbmUtPnJlcXVlc3RzKTsK
IAogCWk5MTVfc3luY21hcF9pbml0KCZ0aW1lbGluZS0+c3luYyk7CkBAIC00NjMsNyArNDYyLDcg
QEAgX19pOTE1X3RpbWVsaW5lX2dldF9zZXFubyhzdHJ1Y3QgaTkxNV90aW1lbGluZSAqdGwsCiAJ
ICogYWxsIHdyaXRlcyBpbnRvIHRoZSBjYWNoZWxpbmUgZnJvbSBwcmV2aW91cyByZXF1ZXN0cyBh
cmUgY29tcGxldGUuCiAJICovCiAJZXJyID0gaTkxNV9hY3RpdmVfcmVmKCZ0bC0+aHdzcF9jYWNo
ZWxpbmUtPmFjdGl2ZSwKLQkJCSAgICAgIHRsLT5mZW5jZV9jb250ZXh0LCBycSk7CisJCQkgICAg
ICB0bC0+ZmVuY2VfY29udGV4dCwgJnJxLT5mZW5jZSk7CiAJaWYgKGVycikKIAkJZ290byBlcnJf
Y2FjaGVsaW5lOwogCkBAIC01MTQsNyArNTEzLDcgQEAgaW50IGk5MTVfdGltZWxpbmVfZ2V0X3Nl
cW5vKHN0cnVjdCBpOTE1X3RpbWVsaW5lICp0bCwKIHN0YXRpYyBpbnQgY2FjaGVsaW5lX3JlZihz
dHJ1Y3QgaTkxNV90aW1lbGluZV9jYWNoZWxpbmUgKmNsLAogCQkJIHN0cnVjdCBpOTE1X3JlcXVl
c3QgKnJxKQogewotCXJldHVybiBpOTE1X2FjdGl2ZV9yZWYoJmNsLT5hY3RpdmUsIHJxLT5mZW5j
ZS5jb250ZXh0LCBycSk7CisJcmV0dXJuIGk5MTVfYWN0aXZlX3JlZigmY2wtPmFjdGl2ZSwgcnEt
PmZlbmNlLmNvbnRleHQsICZycS0+ZmVuY2UpOwogfQogCiBpbnQgaTkxNV90aW1lbGluZV9yZWFk
X2h3c3Aoc3RydWN0IGk5MTVfcmVxdWVzdCAqZnJvbSwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfdGltZWxpbmVfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfdGltZWxpbmVfdHlwZXMuaAppbmRleCBmY2U1Y2I0ZjEwOTAuLjVhZjZkMTg1ZDcwYyAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV90aW1lbGluZV90eXBlcy5oCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdGltZWxpbmVfdHlwZXMuaApAQCAtNDUsNyArNDUs
NyBAQCBzdHJ1Y3QgaTkxNV90aW1lbGluZSB7CiAJICogdGhlIHJlcXVlc3QgdXNpbmcgaTkxNV9h
Y3RpdmVfcmVxdWVzdF9nZXRfcmVxdWVzdF9yY3UoKSwgb3IgaG9sZCB0aGUKIAkgKiBzdHJ1Y3Rf
bXV0ZXguCiAJICovCi0Jc3RydWN0IGk5MTVfYWN0aXZlX3JlcXVlc3QgbGFzdF9yZXF1ZXN0Owor
CXN0cnVjdCBpOTE1X2FjdGl2ZV9mZW5jZSBsYXN0X3JlcXVlc3Q7CiAKIAkvKioKIAkgKiBXZSB0
cmFjayB0aGUgbW9zdCByZWNlbnQgc2Vxbm8gdGhhdCB3ZSB3YWl0IG9uIGluIGV2ZXJ5IGNvbnRl
eHQgc28KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCmluZGV4IDA0MTYzOGE1MDAwNi4uMzExZWI5ODM3
Njk5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKQEAgLTExNSw4ICsxMTUsNyBAQCB2bWFfY3Jl
YXRlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJdm1hLT5zaXplID0gb2JqLT5i
YXNlLnNpemU7CiAJdm1hLT5kaXNwbGF5X2FsaWdubWVudCA9IEk5MTVfR1RUX01JTl9BTElHTk1F
TlQ7CiAKLQlpOTE1X2FjdGl2ZV9pbml0KHZtLT5pOTE1LCAmdm1hLT5hY3RpdmUsCi0JCQkgX19p
OTE1X3ZtYV9hY3RpdmUsIF9faTkxNV92bWFfcmV0aXJlKTsKKwlpOTE1X2FjdGl2ZV9pbml0KCZ2
bWEtPmFjdGl2ZSwgX19pOTE1X3ZtYV9hY3RpdmUsIF9faTkxNV92bWFfcmV0aXJlKTsKIAogCUlO
SVRfTElTVF9IRUFEKCZ2bWEtPmNsb3NlZF9saW5rKTsKIApAQCAtOTEwLDcgKzkwOSw3IEBAIGlu
dCBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAkgKiBhZGQg
dGhlIGFjdGl2ZSByZWZlcmVuY2UgZmlyc3QgYW5kIHF1ZXVlIGZvciBpdCB0byBiZSBkcm9wcGVk
CiAJICogKmxhc3QqLgogCSAqLwotCWVyciA9IGk5MTVfYWN0aXZlX3JlZigmdm1hLT5hY3RpdmUs
IHJxLT5mZW5jZS5jb250ZXh0LCBycSk7CisJZXJyID0gaTkxNV9hY3RpdmVfcmVmKCZ2bWEtPmFj
dGl2ZSwgcnEtPmZlbmNlLmNvbnRleHQsICZycS0+ZmVuY2UpOwogCWlmICh1bmxpa2VseShlcnIp
KQogCQlyZXR1cm4gZXJyOwogCkBAIC05MjEsNyArOTIwLDcgQEAgaW50IGk5MTVfdm1hX21vdmVf
dG9fYWN0aXZlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCQlpZiAoaW50ZWxfZnJvbnRidWZmZXJf
aW52YWxpZGF0ZShvYmotPmZyb250YnVmZmVyLCBPUklHSU5fQ1MpKQogCQkJaTkxNV9hY3RpdmVf
cmVmKCZvYmotPmZyb250YnVmZmVyLT53cml0ZSwKIAkJCQkJcnEtPmZlbmNlLmNvbnRleHQsCi0J
CQkJCXJxKTsKKwkJCQkJJnJxLT5mZW5jZSk7CiAKIAkJb2JqLT5yZWFkX2RvbWFpbnMgPSAwOwog
CX0KQEAgLTk0MCwzMyArOTM5LDExIEBAIGludCBpOTE1X3ZtYV91bmJpbmQoc3RydWN0IGk5MTVf
dm1hICp2bWEpCiAKIAlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bWEtPnZtLT5pOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKIAotCS8qCi0JICogRmlyc3Qgd2FpdCB1cG9uIGFueSBhY3Rpdml0eSBhcyBy
ZXRpcmluZyB0aGUgcmVxdWVzdCBtYXkKLQkgKiBoYXZlIHNpZGUtZWZmZWN0cyBzdWNoIGFzIHVu
cGlubmluZyBvciBldmVuIHVuYmluZGluZyB0aGlzIHZtYS4KLQkgKi8KLQltaWdodF9zbGVlcCgp
OwotCWlmIChpOTE1X3ZtYV9pc19hY3RpdmUodm1hKSkgewotCQkvKgotCQkgKiBXaGVuIGEgY2xv
c2VkIFZNQSBpcyByZXRpcmVkLCBpdCBpcyB1bmJvdW5kIC0gZWVrLgotCQkgKiBJbiBvcmRlciB0
byBwcmV2ZW50IGl0IGZyb20gYmVpbmcgcmVjdXJzaXZlbHkgY2xvc2VkLAotCQkgKiB0YWtlIGEg
cGluIG9uIHRoZSB2bWEgc28gdGhhdCB0aGUgc2Vjb25kIHVuYmluZCBpcwotCQkgKiBhYm9ydGVk
LgotCQkgKgotCQkgKiBFdmVuIG1vcmUgc2NhcnkgaXMgdGhhdCB0aGUgcmV0aXJlIGNhbGxiYWNr
IG1heSBmcmVlCi0JCSAqIHRoZSBvYmplY3QgKGxhc3QgYWN0aXZlIHZtYSkuIFRvIHByZXZlbnQg
dGhlIGV4cGxvc2lvbgotCQkgKiB3ZSBkZWZlciB0aGUgYWN0dWFsIG9iamVjdCBmcmVlIHRvIGEg
d29ya2VyIHRoYXQgY2FuCi0JCSAqIG9ubHkgcHJvY2VlZCBvbmNlIGl0IGFjcXVpcmVzIHRoZSBz
dHJ1Y3RfbXV0ZXggKHdoaWNoCi0JCSAqIHdlIGN1cnJlbnRseSBob2xkLCB0aGVyZWZvcmUgaXQg
Y2Fubm90IGZyZWUgdGhpcyBvYmplY3QKLQkJICogYmVmb3JlIHdlIGFyZSBmaW5pc2hlZCkuCi0J
CSAqLwotCQlfX2k5MTVfdm1hX3Bpbih2bWEpOwotCQlyZXQgPSBpOTE1X2FjdGl2ZV93YWl0KCZ2
bWEtPmFjdGl2ZSk7Ci0JCV9faTkxNV92bWFfdW5waW4odm1hKTsKLQkJaWYgKHJldCkKLQkJCXJl
dHVybiByZXQ7Ci0JfQotCUdFTV9CVUdfT04oaTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpOworCXJl
dCA9IGk5MTVfYWN0aXZlX3dhaXQoJnZtYS0+YWN0aXZlKTsKKwlpZiAocmV0KQorCQlyZXR1cm4g
cmV0OwogCisJR0VNX0JVR19PTihpOTE1X3ZtYV9pc19hY3RpdmUodm1hKSk7CiAJaWYgKGk5MTVf
dm1hX2lzX3Bpbm5lZCh2bWEpKSB7CiAJCXZtYV9wcmludF9hbGxvY2F0b3Iodm1hLCAiaXMgcGlu
bmVkIik7CiAJCXJldHVybiAtRUJVU1k7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pbnRlbF9mcm9udGJ1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZnJvbnRi
dWZmZXIuYwppbmRleCBlY2JlZDExMGFlYzkuLjEyOTliYjM0MWM1MyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZnJvbnRidWZmZXIuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9mcm9udGJ1ZmZlci5jCkBAIC0yNDcsOCArMjQ3LDcgQEAgaW50ZWxfZnJv
bnRidWZmZXJfZ2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiAJZnJvbnQtPm9i
aiA9IG9iajsKIAlrcmVmX2luaXQoJmZyb250LT5yZWYpOwogCWF0b21pY19zZXQoJmZyb250LT5i
aXRzLCAwKTsKLQlpOTE1X2FjdGl2ZV9pbml0KGk5MTUsICZmcm9udC0+d3JpdGUsCi0JCQkgZnJv
bnRidWZmZXJfYWN0aXZlLCBmcm9udGJ1ZmZlcl9yZXRpcmUpOworCWk5MTVfYWN0aXZlX2luaXQo
JmZyb250LT53cml0ZSwgZnJvbnRidWZmZXJfYWN0aXZlLCBmcm9udGJ1ZmZlcl9yZXRpcmUpOwog
CiAJc3Bpbl9sb2NrKCZpOTE1LT5mYl90cmFja2luZy5sb2NrKTsKIAlpZiAob2JqLT5mcm9udGJ1
ZmZlcikgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfb3ZlcmxheS5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfb3ZlcmxheS5jCmluZGV4IGYwNzQzYWY3OWZj
Yi4uZDUwYTAxOTZiMTY2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9v
dmVybGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfb3ZlcmxheS5jCkBAIC0y
MzAsNyArMjMwLDggQEAgYWxsb2NfcmVxdWVzdChzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3Zlcmxh
eSwgdm9pZCAoKmZuKShzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqKSkKIAlpZiAoSVNfRVJSKHJxKSkK
IAkJcmV0dXJuIHJxOwogCi0JZXJyID0gaTkxNV9hY3RpdmVfcmVmKCZvdmVybGF5LT5sYXN0X2Zs
aXAsIHJxLT5mZW5jZS5jb250ZXh0LCBycSk7CisJZXJyID0gaTkxNV9hY3RpdmVfcmVmKCZvdmVy
bGF5LT5sYXN0X2ZsaXAsCisJCQkgICAgICBycS0+ZmVuY2UuY29udGV4dCwgJnJxLT5mZW5jZSk7
CiAJaWYgKGVycikgewogCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKIAkJcmV0dXJuIEVSUl9QVFIo
ZXJyKTsKQEAgLTEzNjYsOCArMTM2Nyw3IEBAIHZvaWQgaW50ZWxfb3ZlcmxheV9zZXR1cChzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJb3ZlcmxheS0+Y29udHJhc3QgPSA3NTsK
IAlvdmVybGF5LT5zYXR1cmF0aW9uID0gMTQ2OwogCi0JaTkxNV9hY3RpdmVfaW5pdChkZXZfcHJp
diwKLQkJCSAmb3ZlcmxheS0+bGFzdF9mbGlwLAorCWk5MTVfYWN0aXZlX2luaXQoJm92ZXJsYXkt
Pmxhc3RfZmxpcCwKIAkJCSBOVUxMLCBpbnRlbF9vdmVybGF5X2xhc3RfZmxpcF9yZXRpcmUpOwog
CiAJcmV0ID0gZ2V0X3JlZ2lzdGVycyhvdmVybGF5LCBPVkVSTEFZX05FRURTX1BIWVNJQ0FMKGRl
dl9wcml2KSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV9hY3RpdmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5j
CmluZGV4IDNiM2NhNTY1ODEyMi4uMGU4YmY4YmNlMTQ2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9hY3RpdmUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9zZWxmdGVzdHMvaTkxNV9hY3RpdmUuYwpAQCAtMzYsNyArMzYsNyBAQCBzdGF0aWMgaW50
IF9fbGl2ZV9hY3RpdmVfc2V0dXAoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJaWYg
KCFzdWJtaXQpCiAJCXJldHVybiAtRU5PTUVNOwogCi0JaTkxNV9hY3RpdmVfaW5pdChpOTE1LCAm
YWN0aXZlLT5iYXNlLCBOVUxMLCBfX2xpdmVfYWN0aXZlX3JldGlyZSk7CisJaTkxNV9hY3RpdmVf
aW5pdCgmYWN0aXZlLT5iYXNlLCBOVUxMLCBfX2xpdmVfYWN0aXZlX3JldGlyZSk7CiAJYWN0aXZl
LT5yZXRpcmVkID0gZmFsc2U7CiAKIAllcnIgPSBpOTE1X2FjdGl2ZV9hY3F1aXJlKCZhY3RpdmUt
PmJhc2UpOwpAQCAtNTcsNyArNTcsOCBAQCBzdGF0aWMgaW50IF9fbGl2ZV9hY3RpdmVfc2V0dXAo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJCQkgICAgICAgR0ZQX0tFUk5FTCk7
CiAJCWlmIChlcnIgPj0gMCkKIAkJCWVyciA9IGk5MTVfYWN0aXZlX3JlZigmYWN0aXZlLT5iYXNl
LAotCQkJCQkgICAgICBycS0+ZmVuY2UuY29udGV4dCwgcnEpOworCQkJCQkgICAgICBycS0+ZmVu
Y2UuY29udGV4dCwKKwkJCQkJICAgICAgJnJxLT5mZW5jZSk7CiAJCWk5MTVfcmVxdWVzdF9hZGQo
cnEpOwogCQlpZiAoZXJyKSB7CiAJCQlwcl9lcnIoIkZhaWxlZCB0byB0cmFjayBhY3RpdmUgcmVm
IVxuIik7CkBAIC04OSwxNCArOTAsMTAgQEAgc3RhdGljIGludCBsaXZlX2FjdGl2ZV93YWl0KHZv
aWQgKmFyZykKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKIAlzdHJ1
Y3QgbGl2ZV9hY3RpdmUgYWN0aXZlOwotCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCWludCBl
cnI7CiAKIAkvKiBDaGVjayB0aGF0IHdlIGdldCBhIGNhbGxiYWNrIHdoZW4gcmVxdWVzdHMgcmV0
aXJlIHVwb24gd2FpdGluZyAqLwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KGk5MTUpOwotCiAJZXJyID0gX19s
aXZlX2FjdGl2ZV9zZXR1cChpOTE1LCAmYWN0aXZlKTsKIAogCWk5MTVfYWN0aXZlX3dhaXQoJmFj
dGl2ZS5iYXNlKTsKQEAgLTEwNiwxMSArMTAzLDEyIEBAIHN0YXRpYyBpbnQgbGl2ZV9hY3RpdmVf
d2FpdCh2b2lkICphcmcpCiAJfQogCiAJaTkxNV9hY3RpdmVfZmluaSgmYWN0aXZlLmJhc2UpOwor
CisJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKGlndF9mbHVzaF90
ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQogCQllcnIgPSAtRUlPOwotCi0JaW50ZWxfcnVu
dGltZV9wbV9wdXQoaTkxNSwgd2FrZXJlZik7CiAJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKKwogCXJldHVybiBlcnI7CiB9CiAKQEAgLTExOCwxOSArMTE2LDE3IEBAIHN0
YXRpYyBpbnQgbGl2ZV9hY3RpdmVfcmV0aXJlKHZvaWQgKmFyZykKIHsKIAlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKIAlzdHJ1Y3QgbGl2ZV9hY3RpdmUgYWN0aXZlOwotCWlu
dGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCWludCBlcnI7CiAKIAkvKiBDaGVjayB0aGF0IHdlIGdl
dCBhIGNhbGxiYWNrIHdoZW4gcmVxdWVzdHMgYXJlIGluZGlyZWN0bHkgcmV0aXJlZCAqLwogCi0J
bXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1
bnRpbWVfcG1fZ2V0KGk5MTUpOwotCiAJZXJyID0gX19saXZlX2FjdGl2ZV9zZXR1cChpOTE1LCAm
YWN0aXZlKTsKIAogCS8qIHdhaXRzIGZvciAmIHJldGlyZXMgYWxsIHJlcXVlc3RzICovCisJbXV0
ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWYgKGlndF9mbHVzaF90ZXN0KGk5
MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQogCQllcnIgPSAtRUlPOworCW11dGV4X3VubG9jaygmaTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlpZiAoIWFjdGl2ZS5yZXRpcmVkKSB7CiAJCXByX2Vy
cigiaTkxNV9hY3RpdmUgbm90IHJldGlyZWQgYWZ0ZXIgZmx1c2hpbmchXG4iKTsKQEAgLTEzOCw4
ICsxMzQsNiBAQCBzdGF0aWMgaW50IGxpdmVfYWN0aXZlX3JldGlyZSh2b2lkICphcmcpCiAJfQog
CiAJaTkxNV9hY3RpdmVfZmluaSgmYWN0aXZlLmJhc2UpOwotCWludGVsX3J1bnRpbWVfcG1fcHV0
KGk5MTUsIHdha2VyZWYpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiAJcmV0dXJuIGVycjsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2Vs
ZnRlc3RzL21vY2tfdGltZWxpbmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9t
b2NrX3RpbWVsaW5lLmMKaW5kZXggNjViNTJiZTIzZDQyLi4wMjRkZTcxOGY2NmYgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX3RpbWVsaW5lLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfdGltZWxpbmUuYwpAQCAtMTUsNyAr
MTUsNyBAQCB2b2lkIG1vY2tfdGltZWxpbmVfaW5pdChzdHJ1Y3QgaTkxNV90aW1lbGluZSAqdGlt
ZWxpbmUsIHU2NCBjb250ZXh0KQogCiAJbXV0ZXhfaW5pdCgmdGltZWxpbmUtPm11dGV4KTsKIAot
CUlOSVRfQUNUSVZFX1JFUVVFU1QoJnRpbWVsaW5lLT5sYXN0X3JlcXVlc3QpOworCUlOSVRfQUNU
SVZFX0ZFTkNFKCZ0aW1lbGluZS0+bGFzdF9yZXF1ZXN0KTsKIAlJTklUX0xJU1RfSEVBRCgmdGlt
ZWxpbmUtPnJlcXVlc3RzKTsKIAogCWk5MTVfc3luY21hcF9pbml0KCZ0aW1lbGluZS0+c3luYyk7
Ci0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdm
eA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0C3F49A53B
	for <lists+intel-gfx@lfdr.de>; Fri, 23 Aug 2019 04:09:18 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C589B6E560;
	Fri, 23 Aug 2019 02:09:15 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga18.intel.com (mga18.intel.com [134.134.136.126])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C3DE96E560
 for <intel-gfx@lists.freedesktop.org>; Fri, 23 Aug 2019 02:09:14 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga001.jf.intel.com ([10.7.209.18])
 by orsmga106.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 22 Aug 2019 19:09:14 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,419,1559545200"; d="scan'208";a="263049970"
Received: from dceraolo-linux.fm.intel.com ([10.1.27.145])
 by orsmga001.jf.intel.com with ESMTP; 22 Aug 2019 19:09:14 -0700
From: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 22 Aug 2019 19:09:09 -0700
Message-Id: <20190823020909.6029-1-daniele.ceraolospurio@intel.com>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [RFC] drm/i915/tgl: Advanced preparser support for GPU
 relocs
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VEdMIGhhcyBhbiBpbXByb3ZlZCBDUyBwcmUtcGFyc2VyIHRoYXQgY2FuIG5vdyBwcmUtZmV0Y2gg
Y29tbWFuZHMgYWNyb3NzCmJhdGNoIGJvdW5kYXJpZXMuIFRoaXMgaW1wcm92ZXMgcGVyZm9ybWFu
Y2VzIHdoZW4gbG90cyBvZiBzbWFsbCBiYXRjaGVzCmFyZSB1c2VkLCBidXQgaGFzIGFuIGltcGFj
dCBvbiBzZWxmLW1vZGlmeWluZyBjb2RlLiBJZiB3ZSB3YW50IHRvIG1vZGlmeQp0aGUgY29udGVu
dCBvZiBhIGJhdGNoIGZyb20gYW5vdGhlciByaW5nL2JhdGNoLCB3ZSBuZWVkIHRvIGVpdGhlcgpn
dWFyYW50ZWUgdGhhdCB0aGUgbWVtb3J5IGxvY2F0aW9uIGlzIHVwZGF0ZWQgYmVmb3JlIHRoZSBw
cmUtcGFyc2VyIGdldHMKdG8gaXQgb3Igd2UgbmVlZCB0byB0dXJuIHRoZSBwcmUtcGFyc2VyIG9m
ZiBhcm91bmQgdGhlIG1vZGlmaWNhdGlvbi4KSW4gaTkxNSwgd2UgdXNlIHNlbGYtbW9kaWZ5aW5n
IGNvZGUgb25seSBmb3IgR1BVIHJlbG9jYXRpb25zLgoKVGhlIHByZS1wYXJzZXIgZmV0Y2hlcyBh
Y3Jvc3MgbWVtb3J5IHN5bmNocm9uaXphdGlvbiBjb21tYW5kcyBhcyB3ZWxsLApzbyB0aGUgb25s
eSB3YXkgdG8gZ3VhcmFudGVlIHRoYXQgdGhlIHdyaXRlcyBsYW5kIGJlZm9yZSB0aGUgcGFyc2Vy
IGdldHMKdG8gaXQgaXMgdG8gaGF2ZSBtb3JlIGluc3RydWN0aW9ucyBiZXR3ZWVuIHRoZSBzeW5j
IGFuZCB0aGUgZGVzdGluYXRpb24KdGhhbiB0aGUgcGFyc2VyIEZJRk8gZGVwdGgsIHdoaWNoIGlz
IG5vdCBhbiBvcHRpbWFsIHNvbHV0aW9uLgoKVGhlIHBhcnNlciBjYW4gYmUgZGlzYWJsZWQgZWl0
aGVyIGdsb2JhbGx5IChmcm9tIEdGWF9NT0RFKSBvciBhdCB0aGUKY29udGV4dCBsZXZlbCwgdXNp
bmcgYSBuZXcgZmxhZyBpbiB0aGUgQVJCX0NIRUNLIGNvbW1hbmQuIFdoZW4KcmUtZW5hYmxlZCwg
dGhlIHBhcnNlciB0dXJucyBvbiBhdCB0aGUgbmV4dCBhcmJpdHJhdGlvbiBwb2ludCAoQVJCX0NI
RUNLCmlzIG5vdCBhbiBhcmJpdHJhdGlvbiBwb2ludCB3aGVuIHRoZSBwYXJzZXIgZmxhZyBpcyBz
ZXQpLiBUaGUgY29tbWFuZCBpcwpub3QgcHJpdmlsZWdlZCwgc28gdGhlIHN0YXR1cyBjYW4gYmUg
Y2hhbmdlZCBieSB1c2VyIGJhdGNoZXMgYXMgd2VsbC4KClRvIGNvcGUgd2l0aCB0aGlzIG5ldyBI
VyBmZWF0dXJlLCB0aGlzIHBhdGNoIHR1cm5zIG9mZiB0aGUgcGFyc2VyIHdoZW4KR1BVIHJlbG9j
cyBhcmUgZW1pdHRlZCBhbmQgaXQgY29uZGl0aW9uYWxseSB0dXJucyBiYWNrIG9uIGFmdGVyIHRo
ZQplbWlzc2lvbiwgYmVmb3JlIHRoZSB1c2VyIGJhdGNoIGlzIHN0YXJ0ZWQuIFRoZSBvcmlnaW5h
bCBzdGF0dXMgb2YgdGhlCnBhcnNlciwgd2hpY2ggaXMgc3RvcmVkIGluIFJJTkdfSU5TVFBNLCBp
cyB1c2VkIHRvIGRlY2lkZSB3aGV0aGVyIHRvCnJlLWVuYWJsZSB0aGUgcGFyc2VyIG9yIG5vdC4g
VGhpcyBlbnN1cmUgdGhhdCB3ZSBkb24ndCB0dXJuIHRoZSBwYXJzZXIKYmFjayBvbiBpZiB0aGUg
dXNlcnNwYWNlIGhhZCBkZWNpZGVkIHRvIGRpc2FibGUgaXQuCgpOb3RlIHRoYXQgd2l0aCB0aGlz
IHBhdGNoLCB0aGUgcGFyc2VyIGRlZmF1bHRzIHRvIG9uIGZvciBhbGwgY29udGV4dHMsCndoaWNo
IG1pZ2h0IHJlZ3Jlc3MgbGVnYWN5IHVzZXJzcGFjZSBhcHBsaWNhdGlvbiB0aGF0IHVzZSBzZWxm
LW1vZGlmeWluZwpjb2RlLiBIb3dldmVyLCBpZiB3ZSB0dXJuIGl0IG9mZiBieSBkZWZhdWx0LCBl
LmcuIHdpdGggYW4gQVJCX0NIRUNLIGFzCmZpcnN0IGNtZCBvbiB0aGUgcmluZywgd2Ugd2lsbCBy
ZWdyZXNzIHBlcmZvcm1hbmNlLCBiZWNhdXNlIGV2ZW4gbGVnYWN5CnBhcnNpbmcgY2FwYWJpbGl0
aWVzIGFyZSBkaXNhYmxlZCBpbiB0aGlzIHNjZW5hcmlvLgoKU2lnbmVkLW9mZi1ieTogRGFuaWVs
ZSBDZXJhb2xvIFNwdXJpbyA8ZGFuaWVsZS5jZXJhb2xvc3B1cmlvQGludGVsLmNvbT4KQ2M6IENo
cmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogTWlrYSBLdW9wcGFsYSA8
bWlrYS5rdW9wcGFsYUBsaW51eC5pbnRlbC5jb20+CkNjOiBUdnJ0a28gVXJzdWxpbiA8dHZydGtv
LnVyc3VsaW5AbGludXguaW50ZWwuY29tPgotLS0KIC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX2V4ZWNidWZmZXIuYyAgICB8IDQ1ICsrKysrKysrKysrKy0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9lbmdpbmUuaCAgICAgICAgfCAgOSArKysKIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5oICB8ICA0ICsrCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9ncHVfY29tbWFuZHMuaCAgfCAxNyArKysrKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2xyYy5jICAgICAgICAgICB8IDYwICsrKysrKysrKysrKysrKysrKysKIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lLmMgICAgICB8IDEzICsrKy0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmggICAgICAgICAgICAgICB8ICAxICsKIDcgZmls
ZXMgY2hhbmdlZCwgMTQxIGluc2VydGlvbnMoKyksIDggZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKaW5kZXggYjVmNjkzNzM2
OWVhLi40NWU4NGYyODI3NmMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9leGVjYnVmZmVyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX2V4ZWNidWZmZXIuYwpAQCAtMjU0LDYgKzI1NCw3IEBAIHN0cnVjdCBpOTE1X2V4ZWNidWZm
ZXIgewogCiAJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwogCQl1MzIgKnJxX2NtZDsKKwkJdW5z
aWduZWQgaW50IHNpemU7CiAJCXVuc2lnbmVkIGludCBycV9zaXplOwogCX0gcmVsb2NfY2FjaGU7
CiAKQEAgLTkwNCw2ICs5MDUsNyBAQCBzdGF0aWMgdm9pZCByZWxvY19jYWNoZV9pbml0KHN0cnVj
dCByZWxvY19jYWNoZSAqY2FjaGUsCiAJY2FjaGUtPm5lZWRzX3VuZmVuY2VkID0gSU5URUxfSU5G
TyhpOTE1KS0+dW5mZW5jZWRfbmVlZHNfYWxpZ25tZW50OwogCWNhY2hlLT5ub2RlLmFsbG9jYXRl
ZCA9IGZhbHNlOwogCWNhY2hlLT5ycSA9IE5VTEw7CisJY2FjaGUtPnNpemUgPSBQQUdFX1NJWkU7
CiAJY2FjaGUtPnJxX3NpemUgPSAwOwogfQogCkBAIC05MjgsNyArOTMwLDggQEAgc3RhdGljIGlu
bGluZSBzdHJ1Y3QgaTkxNV9nZ3R0ICpjYWNoZV90b19nZ3R0KHN0cnVjdCByZWxvY19jYWNoZSAq
Y2FjaGUpCiAKIHN0YXRpYyB2b2lkIHJlbG9jX2dwdV9mbHVzaChzdHJ1Y3QgcmVsb2NfY2FjaGUg
KmNhY2hlKQogewotCUdFTV9CVUdfT04oY2FjaGUtPnJxX3NpemUgPj0gY2FjaGUtPnJxLT5iYXRj
aC0+b2JqLT5iYXNlLnNpemUgLyBzaXplb2YodTMyKSk7CisJR0VNX0JVR19PTihjYWNoZS0+cnFf
c2l6ZSA+PSBjYWNoZS0+c2l6ZSAvIHNpemVvZih1MzIpKTsKKwogCWNhY2hlLT5ycV9jbWRbY2Fj
aGUtPnJxX3NpemVdID0gTUlfQkFUQ0hfQlVGRkVSX0VORDsKIAogCV9faTkxNV9nZW1fb2JqZWN0
X2ZsdXNoX21hcChjYWNoZS0+cnEtPmJhdGNoLT5vYmosIDAsIGNhY2hlLT5ycV9zaXplKTsKQEAg
LTExNDIsMTAgKzExNDUsMTEgQEAgc3RhdGljIGludCBfX3JlbG9jX2dwdV9hbGxvYyhzdHJ1Y3Qg
aTkxNV9leGVjYnVmZmVyICplYiwKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX3Bvb2xfbm9kZSAqcG9v
bDsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAlzdHJ1Y3QgaTkxNV92bWEgKmJhdGNoOwor
CXUzMiByZXNlcnZlZF9zaXplID0gZWItPmVuZ2luZS0+ZW1pdF9wcmVwYXJzZXJfZW5hYmxlX3Np
emVfZHcgKiBzaXplb2YodTMyKTsKIAl1MzIgKmNtZDsKIAlpbnQgZXJyOwogCi0JcG9vbCA9IGlu
dGVsX2VuZ2luZV9wb29sX2dldCgmZWItPmVuZ2luZS0+cG9vbCwgUEFHRV9TSVpFKTsKKwlwb29s
ID0gaW50ZWxfZW5naW5lX3Bvb2xfZ2V0KCZlYi0+ZW5naW5lLT5wb29sLCBjYWNoZS0+c2l6ZSk7
CiAJaWYgKElTX0VSUihwb29sKSkKIAkJcmV0dXJuIFBUUl9FUlIocG9vbCk7CiAKQEAgLTExNTgs
NiArMTE2Miw5IEBAIHN0YXRpYyBpbnQgX19yZWxvY19ncHVfYWxsb2Moc3RydWN0IGk5MTVfZXhl
Y2J1ZmZlciAqZWIsCiAJCWdvdG8gb3V0X3Bvb2w7CiAJfQogCisJLyogd2UgcmVzZXJ2ZSBhIHBv
cnRpb24gb2YgdGhlIGJhdGNoIGZvciB0aGUgcHJlLXBhcnNlciByZS1lbmFibGluZyAqLworCWNh
Y2hlLT5zaXplIC09IHJlc2VydmVkX3NpemU7CisKIAliYXRjaCA9IGk5MTVfdm1hX2luc3RhbmNl
KHBvb2wtPm9iaiwgdm1hLT52bSwgTlVMTCk7CiAJaWYgKElTX0VSUihiYXRjaCkpIHsKIAkJZXJy
ID0gUFRSX0VSUihiYXRjaCk7CkBAIC0xMTgyLDkgKzExODksMzkgQEAgc3RhdGljIGludCBfX3Jl
bG9jX2dwdV9hbGxvYyhzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYiwKIAlpZiAoZXJyKQogCQln
b3RvIGVycl9yZXF1ZXN0OwogCisJaWYgKGViLT5lbmdpbmUtPmVtaXRfcHJlcGFyc2VyX2Rpc2Fi
bGUpIHsKKwkJZXJyID0gZWItPmVuZ2luZS0+ZW1pdF9wcmVwYXJzZXJfZGlzYWJsZShycSwKKwkJ
CQkJCQkgY21kICsgY2FjaGUtPnNpemUgLyBzaXplb2YodTMyKSk7CisJCWlmIChlcnIpCisJCQln
b3RvIHNraXBfcmVxdWVzdDsKKwl9CisKIAllcnIgPSBlYi0+ZW5naW5lLT5lbWl0X2JiX3N0YXJ0
KHJxLAotCQkJCQliYXRjaC0+bm9kZS5zdGFydCwgUEFHRV9TSVpFLAorCQkJCQliYXRjaC0+bm9k
ZS5zdGFydCwgY2FjaGUtPnNpemUsCiAJCQkJCWNhY2hlLT5nZW4gPiA1ID8gMCA6IEk5MTVfRElT
UEFUQ0hfU0VDVVJFKTsKKworCS8qCisJICogTm90aGluZyB3ZSBjYW4gZG8gdG8gZml4IHRoaXMg
aWYgd2UgZmFpbCB0byByZS1lbmFibGUsIHNvIHByaW50IGFuCisJICogZXJyb3IgYW5kIGtlZXAg
Z29pbmcuIFRoZSBjb250ZXh0IHdpbGwgc3RpbGwgYmUgZnVuY3Rpb25hbCwgYnV0CisJICogcGVy
Zm9ybWFuY2UgbWlnaHQgYmUgcmVkdWNlZC4KKwkgKiBXZSBhdHRlbXQgdGhpcyBldmVuIGlmIGVt
aXRfYmJfc3RhcnQgZmFpbGVkIHRvIHRyeSBhbmQgYXQgbGVhc3QKKwkgKiByZXN0b3JlIHRoZSBw
YXJzZXIgc3RhdHVzLgorCSAqLworCWlmIChlYi0+ZW5naW5lLT5lbWl0X3ByZXBhcnNlcl9kaXNh
YmxlKSB7CisJCWludCByZXQ7CisJCWViLT5lbmdpbmUtPmVtaXRfZmx1c2gocnEsIEVNSVRfRkxV
U0gpOworCisJCXJldCA9IGViLT5lbmdpbmUtPmVtaXRfYmJfc3RhcnQocnEsCisJCQliYXRjaC0+
bm9kZS5zdGFydCArIGNhY2hlLT5zaXplLCByZXNlcnZlZF9zaXplLAorCQkJY2FjaGUtPmdlbiA+
IDUgPyAwIDogSTkxNV9ESVNQQVRDSF9TRUNVUkUpOworCQlpZiAocmV0KQorCQkJRFJNX0VSUk9S
KCJGYWlsZWQgdG8gcmUtZW5hYmxlIHByZS1wYXJzZXIgZm9yICIKKwkJCQkgICJjdHg9JXUgb24g
ZW5naW5lJXU6JXVcbiIsCisJCQkJICBycS0+Z2VtX2NvbnRleHQtPmh3X2lkLAorCQkJCSAgZWIt
PmVuZ2luZS0+dWFiaV9jbGFzcywKKwkJCQkgIGViLT5lbmdpbmUtPnVhYmlfaW5zdGFuY2UpOwor
CX0KKwogCWlmIChlcnIpCiAJCWdvdG8gc2tpcF9yZXF1ZXN0OwogCkBAIC0xMjI2LDcgKzEyNjMs
NyBAQCBzdGF0aWMgdTMyICpyZWxvY19ncHUoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsCiAJ
c3RydWN0IHJlbG9jX2NhY2hlICpjYWNoZSA9ICZlYi0+cmVsb2NfY2FjaGU7CiAJdTMyICpjbWQ7
CiAKLQlpZiAoY2FjaGUtPnJxX3NpemUgPiBQQUdFX1NJWkUvc2l6ZW9mKHUzMikgLSAobGVuICsg
MSkpCisJaWYgKGNhY2hlLT5ycV9zaXplID4gY2FjaGUtPnNpemUvc2l6ZW9mKHUzMikgLSAobGVu
ICsgMSkpCiAJCXJlbG9jX2dwdV9mbHVzaChjYWNoZSk7CiAKIAlpZiAodW5saWtlbHkoIWNhY2hl
LT5ycSkpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2lu
ZS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lLmgKaW5kZXggZDNjNjk5
M2Y0ZjQ2Li4xYzllMzg1ODZhZjggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2VuZ2luZS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2lu
ZS5oCkBAIC0xODUsOSArMTg1LDE4IEBAIGludGVsX3dyaXRlX3N0YXR1c19wYWdlKHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgaW50IHJlZywgdTMyIHZhbHVlKQogI2RlZmluZSBJOTE1
X0dFTV9IV1NfUFJFRU1QVF9BRERSCShJOTE1X0dFTV9IV1NfUFJFRU1QVCAqIHNpemVvZih1MzIp
KQogI2RlZmluZSBJOTE1X0dFTV9IV1NfU0VRTk8JCTB4NDAKICNkZWZpbmUgSTkxNV9HRU1fSFdT
X1NFUU5PX0FERFIJCShJOTE1X0dFTV9IV1NfU0VRTk8gKiBzaXplb2YodTMyKSkKKy8qCisgKiBu
b3RlOiB3ZSB0cmVhdCB0aGUgY2FjaGVsaW5lIHN0YXJ0aW5nIGZyb20gSTkxNV9HRU1fSFdTX1NF
UU5PIHRoZSBzYW1lIGFzIGEKKyAqIHByZS1jdHggSFNXUC4gc2VlIGxheW91dCBiZWxvdy4KKyAq
LwogI2RlZmluZSBJOTE1X0dFTV9IV1NfU0NSQVRDSAkJMHg4MAogI2RlZmluZSBJOTE1X0dFTV9I
V1NfU0NSQVRDSF9BRERSCShJOTE1X0dFTV9IV1NfU0NSQVRDSCAqIHNpemVvZih1MzIpKQogCisv
KiBvZmZzZXQgaW4gcGVyLWNvbnRleHQgaHdzcCwgMSBjYWNoZWxpbmUgaW4gc2l6ZSAqLworI2Rl
ZmluZSBJOTE1X0dFTV9DVFhfSFdTX1NFUU5PCQkweDAKKyNkZWZpbmUgSTkxNV9HRU1fQ1RYX0hX
U19QUkVGRVRDSF9NQVNLCTB4MTQKKyNkZWZpbmUgSTkxNV9HRU1fQ1RYX0hXU19QUkVGRVRDSF9W
QUwJMHgxNQorCiAjZGVmaW5lIEk5MTVfSFdTX0NTQl9CVUYwX0lOREVYCQkweDEwCiAjZGVmaW5l
IEk5MTVfSFdTX0NTQl9XUklURV9JTkRFWAkweDFmCiAjZGVmaW5lIENOTF9IV1NfQ1NCX1dSSVRF
X0lOREVYCQkweDJmCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9l
bmdpbmVfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV90eXBl
cy5oCmluZGV4IGE4MmNlYTk1YzJmMi4uYmYxYTJkN2IzYTRmIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMuaApAQCAtNDM1LDYgKzQzNSwxMCBAQCBzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzIHsKIAkJCQkJCSB1MzIgKmNzKTsKIAl1bnNpZ25lZCBpbnQJZW1p
dF9maW5pX2JyZWFkY3J1bWJfZHc7CiAKKwlpbnQJCSgqZW1pdF9wcmVwYXJzZXJfZGlzYWJsZSko
c3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCisJCQkJCQkgIHUzMiAqYmF0Y2gpOworCXVuc2lnbmVk
IGludAllbWl0X3ByZXBhcnNlcl9lbmFibGVfc2l6ZV9kdzsKKwogCS8qIFBhc3MgdGhlIHJlcXVl
c3QgdG8gdGhlIGhhcmR3YXJlIHF1ZXVlIChlLmcuIGRpcmVjdGx5IGludG8KIAkgKiB0aGUgbGVn
YWN5IHJpbmdidWZmZXIgb3IgdG8gdGhlIGVuZCBvZiBhbiBleGVjbGlzdCkuCiAJICoKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5oIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3B1X2NvbW1hbmRzLmgKaW5kZXggODZlMDBhMmRi
OGE0Li5kOWU4MmE0ZGU4NTQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2dwdV9jb21tYW5kcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dw
dV9jb21tYW5kcy5oCkBAIC01Myw2ICs1MywxNyBAQAogI2RlZmluZSAgIE1JX0FSQl9FTkFCTEUJ
CQkoMTw8MCkKICNkZWZpbmUgICBNSV9BUkJfRElTQUJMRQkJKDA8PDApCiAjZGVmaW5lIE1JX0JB
VENIX0JVRkZFUl9FTkQJTUlfSU5TVFIoMHgwYSwgMCkKKyNkZWZpbmUgTUlfQ09ORElUSU9OQUxf
QkFUQ0hfQlVGRkVSX0VORCBNSV9JTlNUUigweDM2LCAwKQorI2RlZmluZSAgIE1JX0NCQkVORF9H
TE9CQUxfR1RUCQkoMTw8MjIpCisjZGVmaW5lICAgTUlfQ0JCRU5EX0NPTVBBUkVfU0VNQVBIT1JF
CSgxPDwyMSkgLyogR2VuMTIrKi8KKyNkZWZpbmUgICBNSV9DQkJFTkRfQ09NUEFSRV9NQVNLCSgx
PDwxOSkgLyogR2VuOSsqLworI2RlZmluZSAgIE1JX0NCQkVORF9FTkRfQ1VSUkVOVF9MRVZFTAko
MTw8MTgpIC8qIEdlbjEyKyovCisjZGVmaW5lICAgTUlfQ0JCRU5EX01BRF9HVF9JREQJCSgwIDw8
IDEyKSAvKiBHZW4xMisqLworI2RlZmluZSAgIE1JX0NCQkVORF9NQURfR1RFX0lERAkJKDEgPDwg
MTIpIC8qIEdlbjEyKyovCisjZGVmaW5lICAgTUlfQ0JCRU5EX01BRF9MVF9JREQJCSgyIDw8IDEy
KSAvKiBHZW4xMisqLworI2RlZmluZSAgIE1JX0NCQkVORF9NQURfTFRFX0lERAkJKDMgPDwgMTIp
IC8qIEdlbjEyKyovCisjZGVmaW5lICAgTUlfQ0JCRU5EX01BRF9FUV9JREQJCSg0IDw8IDEyKSAv
KiBHZW4xMisqLworI2RlZmluZSAgIE1JX0NCQkVORF9NQURfTkVfSURECQkoNSA8PCAxMikgLyog
R2VuMTIrKi8KICNkZWZpbmUgTUlfU1VTUEVORF9GTFVTSAlNSV9JTlNUUigweDBiLCAwKQogI2Rl
ZmluZSAgIE1JX1NVU1BFTkRfRkxVU0hfRU4JKDE8PDApCiAjZGVmaW5lIE1JX1NFVF9BUFBJRAkJ
TUlfSU5TVFIoMHgwZSwgMCkKQEAgLTEzNiw2ICsxNDcsNyBAQAogI2RlZmluZSBNSV9TVE9SRV9S
RUdJU1RFUl9NRU0gICAgICAgIE1JX0lOU1RSKDB4MjQsIDEpCiAjZGVmaW5lIE1JX1NUT1JFX1JF
R0lTVEVSX01FTV9HRU44ICAgTUlfSU5TVFIoMHgyNCwgMikKICNkZWZpbmUgICBNSV9TUk1fTFJN
X0dMT0JBTF9HVFQJCSgxPDwyMikKKyNkZWZpbmUgICBNSV9TUk1fQUREX0NTX01NSU9fU1RBUlQJ
KDE8PDE5KSAvKiBnZW4xMSsgKi8KICNkZWZpbmUgTUlfRkxVU0hfRFcJCU1JX0lOU1RSKDB4MjYs
IDEpIC8qIGZvciBHRU42ICovCiAjZGVmaW5lICAgTUlfRkxVU0hfRFdfU1RPUkVfSU5ERVgJKDE8
PDIxKQogI2RlZmluZSAgIE1JX0lOVkFMSURBVEVfVExCCQkoMTw8MTgpCkBAIC0xNTgsNiArMTcw
LDkgQEAKICNkZWZpbmUgTUlfQkFUQ0hfQlVGRkVSX1NUQVJUX0dFTjgJTUlfSU5TVFIoMHgzMSwg
MSkKICNkZWZpbmUgICBNSV9CQVRDSF9SRVNPVVJDRV9TVFJFQU1FUiAoMTw8MTApCiAKKyNkZWZp
bmUgTUlfQVJCX0NIRUNLICAgICAgICAgICAgTUlfSU5TVFIoMHgwNSwgMCkKKyNkZWZpbmUgICBN
SV9BUkJfQ0hFQ0tfUFJFUEFSU0VSX0RJU0FCTEUgQklUKDApCisjZGVmaW5lICAgTUlfQVJCX0NI
RUNLX1BSRVBBUlNFUl9ESVNBQkxFX01BU0sgQklUKDgpCiAvKgogICogM0QgaW5zdHJ1Y3Rpb25z
IHVzZWQgYnkgdGhlIGtlcm5lbAogICovCkBAIC0yMzksNyArMjU0LDYgQEAKICAqIENvbW1hbmRz
IHVzZWQgb25seSBieSB0aGUgY29tbWFuZCBwYXJzZXIKICAqLwogI2RlZmluZSBNSV9TRVRfUFJF
RElDQVRFICAgICAgICBNSV9JTlNUUigweDAxLCAwKQotI2RlZmluZSBNSV9BUkJfQ0hFQ0sgICAg
ICAgICAgICBNSV9JTlNUUigweDA1LCAwKQogI2RlZmluZSBNSV9SU19DT05UUk9MICAgICAgICAg
ICBNSV9JTlNUUigweDA2LCAwKQogI2RlZmluZSBNSV9VUkJfQVRPTUlDX0FMTE9DICAgICBNSV9J
TlNUUigweDA5LCAwKQogI2RlZmluZSBNSV9QUkVESUNBVEUgICAgICAgICAgICBNSV9JTlNUUigw
eDBDLCAwKQpAQCAtMjU1LDcgKzI2OSw2IEBACiAjZGVmaW5lIE1JX1JTX1NUT1JFX0RBVEFfSU1N
ICAgIE1JX0lOU1RSKDB4MkIsIDApCiAjZGVmaW5lIE1JX0xPQURfVVJCX01FTSAgICAgICAgIE1J
X0lOU1RSKDB4MkMsIDApCiAjZGVmaW5lIE1JX1NUT1JFX1VSQl9NRU0gICAgICAgIE1JX0lOU1RS
KDB4MkQsIDApCi0jZGVmaW5lIE1JX0NPTkRJVElPTkFMX0JBVENIX0JVRkZFUl9FTkQgTUlfSU5T
VFIoMHgzNiwgMCkKIAogI2RlZmluZSBQSVBFTElORV9TRUxFQ1QgICAgICAgICAgICAgICAgKCgw
eDM8PDI5KXwoMHgxPDwyNyl8KDB4MTw8MjQpfCgweDQ8PDE2KSkKICNkZWZpbmUgR0ZYX09QXzNE
U1RBVEVfVkZfU1RBVElTVElDUyAgICgoMHgzPDwyOSl8KDB4MTw8MjcpfCgweDA8PDI0KXwoMHhC
PDwxNikpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCmluZGV4IGQ0MjU4NDQzOWY1MS4u
MmU1NjBiYmIzYmRmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9s
cmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYwpAQCAtMjk0Nyw2
ICsyOTQ3LDU5IEBAIHN0YXRpYyB1MzIgKmdlbjExX2VtaXRfZmluaV9icmVhZGNydW1iX3Jjcyhz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0LAogCXJldHVybiBnZW44X2VtaXRfZmluaV9icmVh
ZGNydW1iX2Zvb3RlcihyZXF1ZXN0LCBjcyk7CiB9CiAKK3N0YXRpYyB1MzIgKl9fZ2VuMTJfZW1p
dF9wcmVwYXJzZXJfZW5hYmxlKHUzMiAqYmF0Y2gsIHUzMiB0YXJnZXRfYWRkcikKK3sKKwkvKiBy
ZXR1cm4gZWFybHkgaWYgdGhlIHByZS1wYXJzZXIgd2FzIGRpc2FibGVkIHdoZW4gd2Ugc3RhcnRl
ZCAqLworCSpiYXRjaCsrID0gTUlfQ09ORElUSU9OQUxfQkFUQ0hfQlVGRkVSX0VORCB8IDIgfAor
CQkJTUlfQ0JCRU5EX0dMT0JBTF9HVFQgfAorCQkJTUlfQ0JCRU5EX0NPTVBBUkVfU0VNQVBIT1JF
IHwKKwkJCU1JX0NCQkVORF9FTkRfQ1VSUkVOVF9MRVZFTCB8CisJCQlNSV9DQkJFTkRfTUFEX05F
X0lERDsgLyogcmV0dXJuIGVhcmx5IGlmIEVRICovCisJKmJhdGNoKysgPSBQUkVGRVRDSF9ESVNB
QkxFX1NUQVRVUzsKKwkqYmF0Y2grKyA9IHRhcmdldF9hZGRyOworCSpiYXRjaCsrID0gMDsKKwor
CS8qIHR1cm4gdGhlIHBhcnNlciBiYWNrIG9uICovCisJKmJhdGNoKysgPSBNSV9BUkJfQ0hFQ0sg
fCBNSV9BUkJfQ0hFQ0tfUFJFUEFSU0VSX0RJU0FCTEVfTUFTSzsKKwkqYmF0Y2grKyA9IE1JX0JB
VENIX0JVRkZFUl9FTkQ7CisKKwlyZXR1cm4gYmF0Y2g7Cit9CisKK3N0YXRpYyBpbnQgZ2VuMTJf
ZW1pdF9wcmVwYXJzZXJfZGlzYWJsZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgdTMyICpiYXRj
aCkKK3sKKwkvKiAyIGR3b3JkcywgbWFzayBhbmQgdmFsdWUgKGluIHRoYXQgb3JkZXIpICovCisJ
dTMyIHRhcmdldF9vZmZzZXQgPSBycS0+aHdfY29udGV4dC0+dGltZWxpbmUtPmh3c3Bfb2Zmc2V0
ICsKKwkJCQlJOTE1X0dFTV9DVFhfSFdTX1BSRUZFVENIX01BU0sgKiBzaXplb2YodTMyKTsKKwl1
MzIgKmNzOworCisJY3MgPSBpbnRlbF9yaW5nX2JlZ2luKHJxLCA2KTsKKwlpZiAoSVNfRVJSKGNz
KSkKKwkJcmV0dXJuIFBUUl9FUlIoY3MpOworCisJLyogc2F2ZSB0aGUgY3VycmVudCBzdGF0dXMg
b2YgdGhlIHByZS1wYXJzZXIgLi4uICovCisJKmNzKysgPSBNSV9TVE9SRV9SRUdJU1RFUl9NRU1f
R0VOOCB8CisJCQlNSV9TUk1fTFJNX0dMT0JBTF9HVFQgfAorCQkJTUlfU1JNX0FERF9DU19NTUlP
X1NUQVJUOworCSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQoUklOR19JTlNUUE0oMCkpOwor
CSpjcysrID0gdGFyZ2V0X29mZnNldCArIHNpemVvZih1MzIpOyAvKiAybmQgZHdvcmQgKi8KKwkq
Y3MrKyA9IDA7CisKKwkvKiAuLi4gYW5kIHR1cm4gaXQgb2ZmICovCisJKmNzKysgPSBNSV9BUkJf
Q0hFQ0sgfAorCQlNSV9BUkJfQ0hFQ0tfUFJFUEFSU0VSX0RJU0FCTEVfTUFTSyB8CisJCU1JX0FS
Ql9DSEVDS19QUkVQQVJTRVJfRElTQUJMRTsKKworCSpjcysrID0gTUlfTk9PUDsKKworCWludGVs
X3JpbmdfYWR2YW5jZShycSwgY3MpOworCisJLyogbm93IHByZXBhcmUgdGhlIGJhdGNoIHRoYXQg
d2lsbCByZS1lbmFibGUgdGhlIHBhcnNlciAqLworCV9fZ2VuMTJfZW1pdF9wcmVwYXJzZXJfZW5h
YmxlKGJhdGNoLCB0YXJnZXRfb2Zmc2V0KTsKKworCXJldHVybiAwOworfQorCiBzdGF0aWMgdm9p
ZCBleGVjbGlzdHNfcGFyayhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7CiAJZGVs
X3RpbWVyKCZlbmdpbmUtPmV4ZWNsaXN0cy50aW1lcik7CkBAIC0zMDE3LDYgKzMwNzAsMTMgQEAg
bG9naWNhbF9yaW5nX2RlZmF1bHRfdmZ1bmNzKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZSkKIAkJZW5naW5lLT5lbWl0X2JiX3N0YXJ0ID0gZ2VuOF9lbWl0X2JiX3N0YXJ0OwogCWVsc2UK
IAkJZW5naW5lLT5lbWl0X2JiX3N0YXJ0ID0gZ2VuOV9lbWl0X2JiX3N0YXJ0OworCisJaWYgKElO
VEVMX0dFTihlbmdpbmUtPmk5MTUpID49IDEyKSB7CisJCXUzMiB0bXBbMTZdOworCQllbmdpbmUt
PmVtaXRfcHJlcGFyc2VyX2Rpc2FibGUgPSBnZW4xMl9lbWl0X3ByZXBhcnNlcl9kaXNhYmxlOwor
CQllbmdpbmUtPmVtaXRfcHJlcGFyc2VyX2VuYWJsZV9zaXplX2R3ID0KKwkJCV9fZ2VuMTJfZW1p
dF9wcmVwYXJzZXJfZW5hYmxlKHRtcCwgMCkgLSB0bXA7CisJfQogfQogCiBzdGF0aWMgaW5saW5l
IHZvaWQKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3RpbWVsaW5l
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF90aW1lbGluZS5jCmluZGV4IDAyZmJl
MTFiNjcxYi4uODllMWZkMGI5NmFiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF90aW1lbGluZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Rp
bWVsaW5lLmMKQEAgLTIwOSw2ICsyMDksNyBAQCBpbnQgaW50ZWxfdGltZWxpbmVfaW5pdChzdHJ1
Y3QgaW50ZWxfdGltZWxpbmUgKnRpbWVsaW5lLAogCQkJc3RydWN0IGk5MTVfdm1hICpod3NwKQog
ewogCXZvaWQgKnZhZGRyOworCXUzMiAqaHdzcF9tYXA7CiAKIAlrcmVmX2luaXQoJnRpbWVsaW5l
LT5rcmVmKTsKIAlhdG9taWNfc2V0KCZ0aW1lbGluZS0+cGluX2NvdW50LCAwKTsKQEAgLTI0NCw4
ICsyNDUsMTYgQEAgaW50IGludGVsX3RpbWVsaW5lX2luaXQoc3RydWN0IGludGVsX3RpbWVsaW5l
ICp0aW1lbGluZSwKIAkJCXJldHVybiBQVFJfRVJSKHZhZGRyKTsKIAl9CiAKLQl0aW1lbGluZS0+
aHdzcF9zZXFubyA9Ci0JCW1lbXNldCh2YWRkciArIHRpbWVsaW5lLT5od3NwX29mZnNldCwgMCwg
Q0FDSEVMSU5FX0JZVEVTKTsKKwlod3NwX21hcCA9IG1lbXNldCh2YWRkciArIHRpbWVsaW5lLT5o
d3NwX29mZnNldCwgMCwgQ0FDSEVMSU5FX0JZVEVTKTsKKwl0aW1lbGluZS0+aHdzcF9zZXFubyA9
IGh3c3BfbWFwOworCisJLyoKKwkgKiBGb3IgY2hlY2tpbmcgdGhlIHN0YXR1cyBvZiB0aGUgcHJl
LWZldGNoZXIsIHdlIG5lZWQgc2F2ZSB0aGUgdmFsdWUKKwkgKiBvZiB0aGUgSU5TVFBNIHJlZ2lz
dGVyIGFuZCB0aGVuIGV2YWx1YXRlIGl0IGFnYWluc3QgdGhlIG1hc2sgZHVyaW5nCisJICogYSBC
QkVORC4gVGhpcyByZXF1aXJlcyB0aGUgbWFzayBhbmQgdGhlIHJlZ2lzdGVyIHZhbHVlIHRvIGJl
IGluIDIKKwkgKiBjb25zZWN1dGl2ZSBkd29yZHMgaW4gbWVtb3J5LiBXZSB1c2UgMiBkd29yZCBp
biB0aGUgSFdTUCBmb3IgdGhpcworCSAqLworCWh3c3BfbWFwW0k5MTVfR0VNX0NUWF9IV1NfUFJF
RkVUQ0hfTUFTS10gPSBQUkVGRVRDSF9ESVNBQkxFX1NUQVRVUzsKIAogCXRpbWVsaW5lLT5od3Nw
X2dndHQgPSBpOTE1X3ZtYV9nZXQoaHdzcCk7CiAJR0VNX0JVR19PTih0aW1lbGluZS0+aHdzcF9v
ZmZzZXQgPj0gaHdzcC0+c2l6ZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3JlZy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaAppbmRleCBhMDkyYjM0
YzI2OWQuLjUwNGE1MTNjZmZlZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9yZWcuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oCkBAIC0yNTQ5LDYg
KzI1NDksNyBAQCBzdGF0aWMgaW5saW5lIGJvb2wgaTkxNV9tbWlvX3JlZ192YWxpZChpOTE1X3Jl
Z190IHJlZykKICNkZWZpbmUgUklOR19ETUFfRkFERChiYXNlKQlfTU1JTygoYmFzZSkgKyAweDc4
KQogI2RlZmluZSBSSU5HX0RNQV9GQUREX1VEVyhiYXNlKQlfTU1JTygoYmFzZSkgKyAweDYwKSAv
KiBnZW44KyAqLwogI2RlZmluZSBSSU5HX0lOU1RQTShiYXNlKQlfTU1JTygoYmFzZSkgKyAweGMw
KQorI2RlZmluZSAgUFJFRkVUQ0hfRElTQUJMRV9TVEFUVVMgUkVHX0JJVCgxMikgLyogZ2VuMTIr
ICovCiAjZGVmaW5lIFJJTkdfTUlfTU9ERShiYXNlKQlfTU1JTygoYmFzZSkgKyAweDljKQogI2Rl
ZmluZSBJTlNUUFMJCV9NTUlPKDB4MjA3MCkgLyogOTY1KyBvbmx5ICovCiAjZGVmaW5lIEdFTjRf
SU5TVERPTkUxCV9NTUlPKDB4MjA3YykgLyogOTY1KyBvbmx5LCBha2EgSU5TVERPTkVfMiBvbiBT
TkIgKi8KLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50
ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 48F85B261D
	for <lists+intel-gfx@lfdr.de>; Fri, 13 Sep 2019 21:32:15 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A98926F448;
	Fri, 13 Sep 2019 19:32:13 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga03.intel.com (mga03.intel.com [134.134.136.65])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 995B36F448
 for <intel-gfx@lists.freedesktop.org>; Fri, 13 Sep 2019 19:32:10 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by orsmga103.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 13 Sep 2019 12:32:10 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,492,1559545200"; d="scan'208";a="179777181"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by orsmga008.jf.intel.com with SMTP; 13 Sep 2019 12:32:08 -0700
Received: by stinkbox (sSMTP sendmail emulation);
 Fri, 13 Sep 2019 22:32:07 +0300
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 13 Sep 2019 22:31:56 +0300
Message-Id: <20190913193157.9556-4-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190913193157.9556-1-ville.syrjala@linux.intel.com>
References: <20190913193157.9556-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 3/4] drm/i915: Extract intel_modeset_calc_cdclk()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KCkV4
ZmlsdHJhdGUgdGhlIGNkY2xrIGNvZGUgZnJvbSBpbnRlbF9tb2Rlc2V0X2NoZWNrcygpIGludG8K
aW50ZWxfbW9kZXNldF9jYWxjX2NkY2xrKCkuCgpSZXZpZXdlZC1ieTogTWFhcnRlbiBMYW5raG9y
c3QgPG1hYXJ0ZW4ubGFua2hvcnN0QGxpbnV4LmludGVsLmNvbT4KU2lnbmVkLW9mZi1ieTogVmls
bGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KLS0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NkY2xrLmMgICB8IDEzNSArKysrKysrKysrKysr
KysrKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NkY2xrLmggICB8ICAg
NiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgfCAxMjMg
Ky0tLS0tLS0tLS0tLS0tLS0KIDMgZmlsZXMgY2hhbmdlZCwgMTM1IGluc2VydGlvbnMoKyksIDEy
OSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2NkY2xrLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NkY2xr
LmMKaW5kZXggZWEzZjc1YzcyZmU4Li40MzU2NDI5NWI4NjQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY2RjbGsuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2NkY2xrLmMKQEAgLTIxLDYgKzIxLDcgQEAKICAqIERFQUxJTkdT
IElOIFRIRSBTT0ZUV0FSRS4KICAqLwogCisjaW5jbHVkZSAiaW50ZWxfYXRvbWljLmgiCiAjaW5j
bHVkZSAiaW50ZWxfY2RjbGsuaCIKICNpbmNsdWRlICJpbnRlbF9kaXNwbGF5X3R5cGVzLmgiCiAj
aW5jbHVkZSAiaW50ZWxfc2lkZWJhbmQuaCIKQEAgLTE3NzIsOSArMTc3Myw5IEBAIGJvb2wgaW50
ZWxfY2RjbGtfbmVlZHNfbW9kZXNldChjb25zdCBzdHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUgKmEs
CiAgKiBSZXR1cm5zOgogICogVHJ1ZSBpZiB0aGUgQ0RDTEsgc3RhdGVzIHJlcXVpcmUganVzdCBh
IGNkMnggZGl2aWRlciB1cGRhdGUsIGZhbHNlIGlmIG5vdC4KICAqLwotYm9vbCBpbnRlbF9jZGNs
a19uZWVkc19jZDJ4X3VwZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCi0J
CQkJICAgY29uc3Qgc3RydWN0IGludGVsX2NkY2xrX3N0YXRlICphLAotCQkJCSAgIGNvbnN0IHN0
cnVjdCBpbnRlbF9jZGNsa19zdGF0ZSAqYikKK3N0YXRpYyBib29sIGludGVsX2NkY2xrX25lZWRz
X2NkMnhfdXBkYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKKwkJCQkJICBj
b25zdCBzdHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUgKmEsCisJCQkJCSAgY29uc3Qgc3RydWN0IGlu
dGVsX2NkY2xrX3N0YXRlICpiKQogewogCS8qIE9sZGVyIGh3IGRvZXNuJ3QgaGF2ZSB0aGUgY2Fw
YWJpbGl0eSAqLwogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTAgJiYgIUlTX0dFTjlfTFAo
ZGV2X3ByaXYpKQpAQCAtMTc5Myw4ICsxNzk0LDggQEAgYm9vbCBpbnRlbF9jZGNsa19uZWVkc19j
ZDJ4X3VwZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAgKiBSZXR1cm5z
OgogICogVHJ1ZSBpZiB0aGUgQ0RDTEsgc3RhdGVzIGRvbid0IG1hdGNoLCBmYWxzZSBpZiB0aGV5
IGRvLgogICovCi1ib29sIGludGVsX2NkY2xrX2NoYW5nZWQoY29uc3Qgc3RydWN0IGludGVsX2Nk
Y2xrX3N0YXRlICphLAotCQkJIGNvbnN0IHN0cnVjdCBpbnRlbF9jZGNsa19zdGF0ZSAqYikKK3N0
YXRpYyBib29sIGludGVsX2NkY2xrX2NoYW5nZWQoY29uc3Qgc3RydWN0IGludGVsX2NkY2xrX3N0
YXRlICphLAorCQkJCWNvbnN0IHN0cnVjdCBpbnRlbF9jZGNsa19zdGF0ZSAqYikKIHsKIAlyZXR1
cm4gaW50ZWxfY2RjbGtfbmVlZHNfbW9kZXNldChhLCBiKSB8fAogCQlhLT52b2x0YWdlX2xldmVs
ICE9IGItPnZvbHRhZ2VfbGV2ZWw7CkBAIC0yMjIwLDYgKzIyMjEsMTMwIEBAIHN0YXRpYyBpbnQg
Ynh0X21vZGVzZXRfY2FsY19jZGNsayhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkK
IAlyZXR1cm4gMDsKIH0KIAorc3RhdGljIGludCBpbnRlbF9sb2NrX2FsbF9waXBlcyhzdHJ1Y3Qg
aW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB0b19pOTE1KHN0YXRlLT5iYXNlLmRldik7CisJc3RydWN0IGludGVsX2NydGMg
KmNydGM7CisKKwkvKiBBZGQgYWxsIHBpcGVzIHRvIHRoZSBzdGF0ZSAqLworCWZvcl9lYWNoX2lu
dGVsX2NydGMoJmRldl9wcml2LT5kcm0sIGNydGMpIHsKKwkJc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGU7CisKKwkJY3J0Y19zdGF0ZSA9IGludGVsX2F0b21pY19nZXRfY3J0Y19z
dGF0ZSgmc3RhdGUtPmJhc2UsIGNydGMpOworCQlpZiAoSVNfRVJSKGNydGNfc3RhdGUpKQorCQkJ
cmV0dXJuIFBUUl9FUlIoY3J0Y19zdGF0ZSk7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRp
YyBpbnQgaW50ZWxfbW9kZXNldF9hbGxfcGlwZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAq
c3RhdGUpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShz
dGF0ZS0+YmFzZS5kZXYpOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOworCisJLyoKKwkgKiBB
ZGQgYWxsIHBpcGVzIHRvIHRoZSBzdGF0ZSwgYW5kIGZvcmNlCisJICogYSBtb2Rlc2V0IG9uIGFs
bCB0aGUgYWN0aXZlIG9uZXMuCisJICovCisJZm9yX2VhY2hfaW50ZWxfY3J0YygmZGV2X3ByaXYt
PmRybSwgY3J0YykgeworCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKKwkJ
aW50IHJldDsKKworCQljcnRjX3N0YXRlID0gaW50ZWxfYXRvbWljX2dldF9jcnRjX3N0YXRlKCZz
dGF0ZS0+YmFzZSwgY3J0Yyk7CisJCWlmIChJU19FUlIoY3J0Y19zdGF0ZSkpCisJCQlyZXR1cm4g
UFRSX0VSUihjcnRjX3N0YXRlKTsKKworCQlpZiAoIWNydGNfc3RhdGUtPmJhc2UuYWN0aXZlIHx8
CisJCSAgICBkcm1fYXRvbWljX2NydGNfbmVlZHNfbW9kZXNldCgmY3J0Y19zdGF0ZS0+YmFzZSkp
CisJCQljb250aW51ZTsKKworCQljcnRjX3N0YXRlLT5iYXNlLm1vZGVfY2hhbmdlZCA9IHRydWU7
CisKKwkJcmV0ID0gZHJtX2F0b21pY19hZGRfYWZmZWN0ZWRfY29ubmVjdG9ycygmc3RhdGUtPmJh
c2UsCisJCQkJCQkJICZjcnRjLT5iYXNlKTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiByZXQ7CisK
KwkJcmV0ID0gZHJtX2F0b21pY19hZGRfYWZmZWN0ZWRfcGxhbmVzKCZzdGF0ZS0+YmFzZSwKKwkJ
CQkJCSAgICAgJmNydGMtPmJhc2UpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKworCQlj
cnRjX3N0YXRlLT51cGRhdGVfcGxhbmVzIHw9IGNydGNfc3RhdGUtPmFjdGl2ZV9wbGFuZXM7CisJ
fQorCisJcmV0dXJuIDA7Cit9CisKK2ludCBpbnRlbF9tb2Rlc2V0X2NhbGNfY2RjbGsoc3RydWN0
IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShzdGF0ZS0+YmFzZS5kZXYpOworCWVudW0gcGlwZSBwaXBlOwor
CWludCByZXQ7CisKKwlpZiAoIWRldl9wcml2LT5kaXNwbGF5Lm1vZGVzZXRfY2FsY19jZGNsaykK
KwkJcmV0dXJuIDA7CisKKwlyZXQgPSBkZXZfcHJpdi0+ZGlzcGxheS5tb2Rlc2V0X2NhbGNfY2Rj
bGsoc3RhdGUpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwkvKgorCSAqIFdyaXRlcyB0
byBkZXZfcHJpdi0+Y2RjbGsubG9naWNhbCBtdXN0IHByb3RlY3RlZCBieQorCSAqIGhvbGRpbmcg
YWxsIHRoZSBjcnRjIGxvY2tzLCBldmVuIGlmIHdlIGRvbid0IGVuZCB1cAorCSAqIHRvdWNoaW5n
IHRoZSBoYXJkd2FyZQorCSAqLworCWlmIChpbnRlbF9jZGNsa19jaGFuZ2VkKCZkZXZfcHJpdi0+
Y2RjbGsubG9naWNhbCwKKwkJCQkmc3RhdGUtPmNkY2xrLmxvZ2ljYWwpKSB7CisJCXJldCA9IGlu
dGVsX2xvY2tfYWxsX3BpcGVzKHN0YXRlKTsKKwkJaWYgKHJldCA8IDApCisJCQlyZXR1cm4gcmV0
OworCX0KKworCWlmIChpc19wb3dlcl9vZl8yKHN0YXRlLT5hY3RpdmVfcGlwZXMpKSB7CisJCXN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjOworCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19z
dGF0ZTsKKworCQlwaXBlID0gaWxvZzIoc3RhdGUtPmFjdGl2ZV9waXBlcyk7CisJCWNydGMgPSBp
bnRlbF9nZXRfY3J0Y19mb3JfcGlwZShkZXZfcHJpdiwgcGlwZSk7CisJCWNydGNfc3RhdGUgPSBp
bnRlbF9hdG9taWNfZ2V0X25ld19jcnRjX3N0YXRlKHN0YXRlLCBjcnRjKTsKKwkJaWYgKGNydGNf
c3RhdGUgJiYKKwkJICAgIGRybV9hdG9taWNfY3J0Y19uZWVkc19tb2Rlc2V0KCZjcnRjX3N0YXRl
LT5iYXNlKSkKKwkJCXBpcGUgPSBJTlZBTElEX1BJUEU7CisJfSBlbHNlIHsKKwkJcGlwZSA9IElO
VkFMSURfUElQRTsKKwl9CisKKwkvKiBBbGwgcGlwZXMgbXVzdCBiZSBzd2l0Y2hlZCBvZmYgd2hp
bGUgd2UgY2hhbmdlIHRoZSBjZGNsay4gKi8KKwlpZiAocGlwZSAhPSBJTlZBTElEX1BJUEUgJiYK
KwkgICAgaW50ZWxfY2RjbGtfbmVlZHNfY2QyeF91cGRhdGUoZGV2X3ByaXYsCisJCQkJCSAgJmRl
dl9wcml2LT5jZGNsay5hY3R1YWwsCisJCQkJCSAgJnN0YXRlLT5jZGNsay5hY3R1YWwpKSB7CisJ
CXJldCA9IGludGVsX2xvY2tfYWxsX3BpcGVzKHN0YXRlKTsKKwkJaWYgKHJldCkKKwkJCXJldHVy
biByZXQ7CisKKwkJc3RhdGUtPmNkY2xrLnBpcGUgPSBwaXBlOworCX0gZWxzZSBpZiAoaW50ZWxf
Y2RjbGtfbmVlZHNfbW9kZXNldCgmZGV2X3ByaXYtPmNkY2xrLmFjdHVhbCwKKwkJCQkJICAgICAm
c3RhdGUtPmNkY2xrLmFjdHVhbCkpIHsKKwkJcmV0ID0gaW50ZWxfbW9kZXNldF9hbGxfcGlwZXMo
c3RhdGUpOworCQlpZiAocmV0KQorCQkJcmV0dXJuIHJldDsKKworCQlzdGF0ZS0+Y2RjbGsucGlw
ZSA9IElOVkFMSURfUElQRTsKKwl9CisKKwlEUk1fREVCVUdfS01TKCJOZXcgY2RjbGsgY2FsY3Vs
YXRlZCB0byBiZSBsb2dpY2FsICV1IGtIeiwgYWN0dWFsICV1IGtIelxuIiwKKwkJICAgICAgc3Rh
dGUtPmNkY2xrLmxvZ2ljYWwuY2RjbGssCisJCSAgICAgIHN0YXRlLT5jZGNsay5hY3R1YWwuY2Rj
bGspOworCURSTV9ERUJVR19LTVMoIk5ldyB2b2x0YWdlIGxldmVsIGNhbGN1bGF0ZWQgdG8gYmUg
bG9naWNhbCAldSwgYWN0dWFsICV1XG4iLAorCQkgICAgICBzdGF0ZS0+Y2RjbGsubG9naWNhbC52
b2x0YWdlX2xldmVsLAorCQkgICAgICBzdGF0ZS0+Y2RjbGsuYWN0dWFsLnZvbHRhZ2VfbGV2ZWwp
OworCisJcmV0dXJuIDA7Cit9CisKIHN0YXRpYyBpbnQgaW50ZWxfY29tcHV0ZV9tYXhfZG90Y2xr
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKIAlpbnQgbWF4X2NkY2xrX2Zy
ZXEgPSBkZXZfcHJpdi0+bWF4X2NkY2xrX2ZyZXE7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2NkY2xrLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2NkY2xrLmgKaW5kZXggMWFmYTg0YWI2MDE4Li5jZjcxMzk0Y2M3OWMgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY2RjbGsuaAorKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NkY2xrLmgKQEAgLTI5LDEzICsyOSw4
IEBAIHZvaWQgaW50ZWxfaW5pdF9jZGNsa19ob29rcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpOwogdm9pZCBpbnRlbF91cGRhdGVfbWF4X2NkY2xrKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdik7CiB2b2lkIGludGVsX3VwZGF0ZV9jZGNsayhzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogdm9pZCBpbnRlbF91cGRhdGVfcmF3Y2xrKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci1ib29sIGludGVsX2NkY2xrX25lZWRzX2NkMnhf
dXBkYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCQkgICBjb25zdCBz
dHJ1Y3QgaW50ZWxfY2RjbGtfc3RhdGUgKmEsCi0JCQkJICAgY29uc3Qgc3RydWN0IGludGVsX2Nk
Y2xrX3N0YXRlICpiKTsKIGJvb2wgaW50ZWxfY2RjbGtfbmVlZHNfbW9kZXNldChjb25zdCBzdHJ1
Y3QgaW50ZWxfY2RjbGtfc3RhdGUgKmEsCiAJCQkgICAgICAgY29uc3Qgc3RydWN0IGludGVsX2Nk
Y2xrX3N0YXRlICpiKTsKLWJvb2wgaW50ZWxfY2RjbGtfY2hhbmdlZChjb25zdCBzdHJ1Y3QgaW50
ZWxfY2RjbGtfc3RhdGUgKmEsCi0JCQkgY29uc3Qgc3RydWN0IGludGVsX2NkY2xrX3N0YXRlICpi
KTsKIHZvaWQgaW50ZWxfY2RjbGtfc3dhcF9zdGF0ZShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
ICpzdGF0ZSk7CiB2b2lkCiBpbnRlbF9zZXRfY2RjbGtfcHJlX3BsYW5lX3VwZGF0ZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCkBAIC00OSw1ICs0NCw2IEBAIGludGVsX3NldF9j
ZGNsa19wb3N0X3BsYW5lX3VwZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
CiAJCQkJICBlbnVtIHBpcGUgcGlwZSk7CiB2b2lkIGludGVsX2R1bXBfY2RjbGtfc3RhdGUoY29u
c3Qgc3RydWN0IGludGVsX2NkY2xrX3N0YXRlICpjZGNsa19zdGF0ZSwKIAkJCSAgICBjb25zdCBj
aGFyICpjb250ZXh0KTsKK2ludCBpbnRlbF9tb2Rlc2V0X2NhbGNfY2RjbGsoc3RydWN0IGludGVs
X2F0b21pY19zdGF0ZSAqc3RhdGUpOwogCiAjZW5kaWYgLyogX19JTlRFTF9DRENMS19IX18gKi8K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggN2Uy
OWJhNjc1MjQxLi41ZmM1MjI3MjM2NjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGlzcGxheS5jCkBAIC0xMzQzMyw2NSArMTM0MzMsMTIgQEAgc3RhdGljIGludCBo
YXN3ZWxsX21vZGVfc2V0X3BsYW5lc193b3JrYXJvdW5kKHN0cnVjdCBpbnRlbF9hdG9taWNfc3Rh
dGUgKnN0YXRlKQogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IGludGVsX2xvY2tfYWxsX3Bp
cGVzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQotewotCXN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoc3RhdGUtPmJhc2UuZGV2KTsKLQlzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YzsKLQotCS8qIEFkZCBhbGwgcGlwZXMgdG8gdGhlIHN0YXRlICovCi0J
Zm9yX2VhY2hfaW50ZWxfY3J0YygmZGV2X3ByaXYtPmRybSwgY3J0YykgewotCQlzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZTsKLQotCQljcnRjX3N0YXRlID0gaW50ZWxfYXRvbWlj
X2dldF9jcnRjX3N0YXRlKCZzdGF0ZS0+YmFzZSwgY3J0Yyk7Ci0JCWlmIChJU19FUlIoY3J0Y19z
dGF0ZSkpCi0JCQlyZXR1cm4gUFRSX0VSUihjcnRjX3N0YXRlKTsKLQl9Ci0KLQlyZXR1cm4gMDsK
LX0KLQotc3RhdGljIGludCBpbnRlbF9tb2Rlc2V0X2FsbF9waXBlcyhzdHJ1Y3QgaW50ZWxfYXRv
bWljX3N0YXRlICpzdGF0ZSkKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KHN0YXRlLT5iYXNlLmRldik7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGM7Ci0K
LQkvKgotCSAqIEFkZCBhbGwgcGlwZXMgdG8gdGhlIHN0YXRlLCBhbmQgZm9yY2UKLQkgKiBhIG1v
ZGVzZXQgb24gYWxsIHRoZSBhY3RpdmUgb25lcy4KLQkgKi8KLQlmb3JfZWFjaF9pbnRlbF9jcnRj
KCZkZXZfcHJpdi0+ZHJtLCBjcnRjKSB7Ci0JCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlOwotCQlpbnQgcmV0OwotCi0JCWNydGNfc3RhdGUgPSBpbnRlbF9hdG9taWNfZ2V0X2Ny
dGNfc3RhdGUoJnN0YXRlLT5iYXNlLCBjcnRjKTsKLQkJaWYgKElTX0VSUihjcnRjX3N0YXRlKSkK
LQkJCXJldHVybiBQVFJfRVJSKGNydGNfc3RhdGUpOwotCi0JCWlmICghY3J0Y19zdGF0ZS0+YmFz
ZS5hY3RpdmUgfHwgbmVlZHNfbW9kZXNldChjcnRjX3N0YXRlKSkKLQkJCWNvbnRpbnVlOwotCi0J
CWNydGNfc3RhdGUtPmJhc2UubW9kZV9jaGFuZ2VkID0gdHJ1ZTsKLQotCQlyZXQgPSBkcm1fYXRv
bWljX2FkZF9hZmZlY3RlZF9jb25uZWN0b3JzKCZzdGF0ZS0+YmFzZSwKLQkJCQkJCQkgJmNydGMt
PmJhc2UpOwotCQlpZiAocmV0KQotCQkJcmV0dXJuIHJldDsKLQotCQlyZXQgPSBkcm1fYXRvbWlj
X2FkZF9hZmZlY3RlZF9wbGFuZXMoJnN0YXRlLT5iYXNlLAotCQkJCQkJICAgICAmY3J0Yy0+YmFz
ZSk7Ci0JCWlmIChyZXQpCi0JCQlyZXR1cm4gcmV0OwotCX0KLQotCXJldHVybiAwOwotfQotCiBz
dGF0aWMgaW50IGludGVsX21vZGVzZXRfY2hlY2tzKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUg
KnN0YXRlKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
c3RhdGUtPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNfc3Rh
dGUsICpuZXdfY3J0Y19zdGF0ZTsKIAlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKLQlpbnQgcmV0
ID0gMCwgaTsKKwlpbnQgcmV0LCBpOwogCiAJaWYgKCFjaGVja19kaWdpdGFsX3BvcnRfY29uZmxp
Y3RzKHN0YXRlKSkgewogCQlEUk1fREVCVUdfS01TKCJyZWplY3RpbmcgY29uZmxpY3RpbmcgZGln
aXRhbCBwb3J0IGNvbmZpZ3VyYXRpb25cbiIpOwpAQCAtMTM1MTksNzEgKzEzNDY2LDkgQEAgc3Rh
dGljIGludCBpbnRlbF9tb2Rlc2V0X2NoZWNrcyhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpz
dGF0ZSkKIAkJCXN0YXRlLT5hY3RpdmVfcGlwZV9jaGFuZ2VzIHw9IEJJVChjcnRjLT5waXBlKTsK
IAl9CiAKLQkvKgotCSAqIFNlZSBpZiB0aGUgY29uZmlnIHJlcXVpcmVzIGFueSBhZGRpdGlvbmFs
IHByZXBhcmF0aW9uLCBlLmcuCi0JICogdG8gYWRqdXN0IGdsb2JhbCBzdGF0ZSB3aXRoIHBpcGVz
IG9mZi4gIFdlIG5lZWQgdG8gZG8gdGhpcwotCSAqIGhlcmUgc28gd2UgY2FuIGdldCB0aGUgbW9k
ZXNldF9waXBlIHVwZGF0ZWQgY29uZmlnIGZvciB0aGUgbmV3Ci0JICogbW9kZSBzZXQgb24gdGhp
cyBjcnRjLiAgRm9yIG90aGVyIGNydGNzIHdlIG5lZWQgdG8gdXNlIHRoZQotCSAqIGFkanVzdGVk
X21vZGUgYml0cyBpbiB0aGUgY3J0YyBkaXJlY3RseS4KLQkgKi8KLQlpZiAoZGV2X3ByaXYtPmRp
c3BsYXkubW9kZXNldF9jYWxjX2NkY2xrKSB7Ci0JCWVudW0gcGlwZSBwaXBlOwotCi0JCXJldCA9
IGRldl9wcml2LT5kaXNwbGF5Lm1vZGVzZXRfY2FsY19jZGNsayhzdGF0ZSk7Ci0JCWlmIChyZXQg
PCAwKQotCQkJcmV0dXJuIHJldDsKLQotCQkvKgotCQkgKiBXcml0ZXMgdG8gZGV2X3ByaXYtPmNk
Y2xrLmxvZ2ljYWwgbXVzdCBwcm90ZWN0ZWQgYnkKLQkJICogaG9sZGluZyBhbGwgdGhlIGNydGMg
bG9ja3MsIGV2ZW4gaWYgd2UgZG9uJ3QgZW5kIHVwCi0JCSAqIHRvdWNoaW5nIHRoZSBoYXJkd2Fy
ZQotCQkgKi8KLQkJaWYgKGludGVsX2NkY2xrX2NoYW5nZWQoJmRldl9wcml2LT5jZGNsay5sb2dp
Y2FsLAotCQkJCQkmc3RhdGUtPmNkY2xrLmxvZ2ljYWwpKSB7Ci0JCQlyZXQgPSBpbnRlbF9sb2Nr
X2FsbF9waXBlcyhzdGF0ZSk7Ci0JCQlpZiAocmV0IDwgMCkKLQkJCQlyZXR1cm4gcmV0OwotCQl9
Ci0KLQkJaWYgKGlzX3Bvd2VyX29mXzIoc3RhdGUtPmFjdGl2ZV9waXBlcykpIHsKLQkJCXN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjOwotCQkJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3Rh
dGU7Ci0KLQkJCXBpcGUgPSBpbG9nMihzdGF0ZS0+YWN0aXZlX3BpcGVzKTsKLQkJCWNydGMgPSBp
bnRlbF9nZXRfY3J0Y19mb3JfcGlwZShkZXZfcHJpdiwgcGlwZSk7Ci0JCQljcnRjX3N0YXRlID0g
aW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0ZSwgY3J0Yyk7Ci0JCQlpZiAoY3J0
Y19zdGF0ZSAmJiBuZWVkc19tb2Rlc2V0KGNydGNfc3RhdGUpKQotCQkJCXBpcGUgPSBJTlZBTElE
X1BJUEU7Ci0JCX0gZWxzZSB7Ci0JCQlwaXBlID0gSU5WQUxJRF9QSVBFOwotCQl9Ci0KLQkJLyog
QWxsIHBpcGVzIG11c3QgYmUgc3dpdGNoZWQgb2ZmIHdoaWxlIHdlIGNoYW5nZSB0aGUgY2RjbGsu
ICovCi0JCWlmIChwaXBlICE9IElOVkFMSURfUElQRSAmJgotCQkgICAgaW50ZWxfY2RjbGtfbmVl
ZHNfY2QyeF91cGRhdGUoZGV2X3ByaXYsCi0JCQkJCQkgICZkZXZfcHJpdi0+Y2RjbGsuYWN0dWFs
LAotCQkJCQkJICAmc3RhdGUtPmNkY2xrLmFjdHVhbCkpIHsKLQkJCXJldCA9IGludGVsX2xvY2tf
YWxsX3BpcGVzKHN0YXRlKTsKLQkJCWlmIChyZXQgPCAwKQotCQkJCXJldHVybiByZXQ7Ci0KLQkJ
CXN0YXRlLT5jZGNsay5waXBlID0gcGlwZTsKLQkJfSBlbHNlIGlmIChpbnRlbF9jZGNsa19uZWVk
c19tb2Rlc2V0KCZkZXZfcHJpdi0+Y2RjbGsuYWN0dWFsLAotCQkJCQkJICAgICAmc3RhdGUtPmNk
Y2xrLmFjdHVhbCkpIHsKLQkJCXJldCA9IGludGVsX21vZGVzZXRfYWxsX3BpcGVzKHN0YXRlKTsK
LQkJCWlmIChyZXQgPCAwKQotCQkJCXJldHVybiByZXQ7Ci0KLQkJCXN0YXRlLT5jZGNsay5waXBl
ID0gSU5WQUxJRF9QSVBFOwotCQl9Ci0KLQkJRFJNX0RFQlVHX0tNUygiTmV3IGNkY2xrIGNhbGN1
bGF0ZWQgdG8gYmUgbG9naWNhbCAldSBrSHosIGFjdHVhbCAldSBrSHpcbiIsCi0JCQkgICAgICBz
dGF0ZS0+Y2RjbGsubG9naWNhbC5jZGNsaywKLQkJCSAgICAgIHN0YXRlLT5jZGNsay5hY3R1YWwu
Y2RjbGspOwotCQlEUk1fREVCVUdfS01TKCJOZXcgdm9sdGFnZSBsZXZlbCBjYWxjdWxhdGVkIHRv
IGJlIGxvZ2ljYWwgJXUsIGFjdHVhbCAldVxuIiwKLQkJCSAgICAgIHN0YXRlLT5jZGNsay5sb2dp
Y2FsLnZvbHRhZ2VfbGV2ZWwsCi0JCQkgICAgICBzdGF0ZS0+Y2RjbGsuYWN0dWFsLnZvbHRhZ2Vf
bGV2ZWwpOwotCX0KKwlyZXQgPSBpbnRlbF9tb2Rlc2V0X2NhbGNfY2RjbGsoc3RhdGUpOworCWlm
IChyZXQpCisJCXJldHVybiByZXQ7CiAKIAlpbnRlbF9tb2Rlc2V0X2NsZWFyX3BsbHMoc3RhdGUp
OwogCi0tIAoyLjIxLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVs
LWdmeA==

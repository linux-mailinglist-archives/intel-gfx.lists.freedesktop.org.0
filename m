Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4A0A0607DF
	for <lists+intel-gfx@lfdr.de>; Fri,  5 Jul 2019 16:29:29 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2A20A6E4CE;
	Fri,  5 Jul 2019 14:29:27 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga05.intel.com (mga05.intel.com [192.55.52.43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7E66C6E4CE
 for <intel-gfx@lists.freedesktop.org>; Fri,  5 Jul 2019 14:29:26 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga007.fm.intel.com ([10.253.24.52])
 by fmsmga105.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 05 Jul 2019 07:29:26 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,455,1557212400"; d="scan'208";a="166549184"
Received: from rosetta.fi.intel.com ([10.237.72.194])
 by fmsmga007.fm.intel.com with ESMTP; 05 Jul 2019 07:29:25 -0700
Received: by rosetta.fi.intel.com (Postfix, from userid 1000)
 id 772408402D2; Fri,  5 Jul 2019 17:29:09 +0300 (EEST)
From: Mika Kuoppala <mika.kuoppala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  5 Jul 2019 17:29:07 +0300
Message-Id: <20190705142908.4921-3-mika.kuoppala@linux.intel.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20190705142908.4921-1-mika.kuoppala@linux.intel.com>
References: <20190705142908.4921-1-mika.kuoppala@linux.intel.com>
Subject: [Intel-gfx] [PATCH 3/4] drm/i915/gtt: Setup phys pages for 3lvl pdps
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SWYgd2Ugc2V0dXAgYmFja2luZyBwaHlzIHBhZ2UgZm9yIDNsdmwgcGRwcywgZXZlbiB0aGV5CmFy
ZSBub3QgdXNlZCwgd2UgbG9zZSA1IHBhZ2VzIHBlciBwcGd0dC4KClRyYWRpbmcgdGhpcyBtZW1v
cnkgb24gYnN3LCB3ZSBnYWluIG1vcmUgY29tbW9uIGNvZGUgcGF0aHMgZm9yIGFsbApnZW44KyBk
aXJlY3RvcnkgbWFuaXB1bGF0aW9uLiBBbmQgdGhvc2UgcGF0aHMgYXJlIG5vdyB2b2lkIG9mIGNo
ZWNrcwpmb3IgcGFnZSBkaXJlY3RvcnkgdHlwZSwgbWFraW5nIHRoZSBob3QgcGF0aHMgZmFzdGVy
LgoKdjI6IGRvbid0IHNob3J0Y3V0IHZtIChDaHJpcykKClNpZ25lZC1vZmYtYnk6IE1pa2EgS3Vv
cHBhbGEgPG1pa2Eua3VvcHBhbGFAbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtX2d0dC5jIHwgNzcgKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0K
IDEgZmlsZSBjaGFuZ2VkLCA1MCBpbnNlcnRpb25zKCspLCAyNyBkZWxldGlvbnMoLSkKCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCmluZGV4IGYwMTFjZTFhZTAzYS4uMGE1NWIwOTMyYzg2
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwpAQCAtNzU4LDIyICs3NTgsMTQgQEAg
c3RhdGljIHN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICphbGxvY19wZChzdHJ1Y3QgaTkxNV9h
ZGRyZXNzX3NwYWNlICp2bSkKIAlyZXR1cm4gcGQ7CiB9CiAKLXN0YXRpYyBpbmxpbmUgYm9vbCBw
ZF9oYXNfcGh5c19wYWdlKGNvbnN0IHN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICogY29uc3Qg
cGQpCi17Ci0JcmV0dXJuIHBkLT5iYXNlLnBhZ2U7Ci19Ci0KIHN0YXRpYyB2b2lkIGZyZWVfcGQo
c3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJCSAgICBzdHJ1Y3QgaTkxNV9wYWdlX2Rp
cmVjdG9yeSAqcGQpCiB7Ci0JaWYgKGxpa2VseShwZF9oYXNfcGh5c19wYWdlKHBkKSkpCi0JCWNs
ZWFudXBfcGFnZV9kbWEodm0sICZwZC0+YmFzZSk7Ci0KKwljbGVhbnVwX3BhZ2VfZG1hKHZtLCAm
cGQtPmJhc2UpOwogCWtmcmVlKHBkKTsKIH0KIAogI2RlZmluZSBpbml0X3BkKHZtLCBwZCwgdG8p
IHsJCQkJCVwKLQlHRU1fREVCVUdfQlVHX09OKCFwZF9oYXNfcGh5c19wYWdlKHBkKSk7CQlcCiAJ
ZmlsbF9weCgodm0pLCAocGQpLCBnZW44X3BkZV9lbmNvZGUocHhfZG1hKHRvKSwgSTkxNV9DQUNI
RV9MTEMpKTsgXAogCW1lbXNldF9wKChwZCktPmVudHJ5LCAodG8pLCA1MTIpOwkJCQlcCiB9CkBA
IC0xNjA0LDYgKzE1OTYsNTAgQEAgc3RhdGljIHZvaWQgcHBndHRfaW5pdChzdHJ1Y3QgaTkxNV9w
cGd0dCAqcHBndHQsIHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAJcHBndHQtPnZtLnZtYV9vcHMuY2xl
YXJfcGFnZXMgPSBjbGVhcl9wYWdlczsKIH0KIAorc3RhdGljIHZvaWQgaW5pdF9wZF9uKHN0cnVj
dCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAorCQkgICAgICBzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVj
dG9yeSAqcGQsCisJCSAgICAgIHN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICp0bywKKwkJICAg
ICAgY29uc3QgdW5zaWduZWQgaW50IGVudHJpZXMpCit7CisJY29uc3QgdTY0IGRhZGRyID0gZ2Vu
OF9wZGVfZW5jb2RlKHB4X2RtYSh0byksIEk5MTVfQ0FDSEVfTExDKTsKKwl1NjQgKiBjb25zdCB2
YWRkciA9IGttYXBfYXRvbWljKHBkLT5iYXNlLnBhZ2UpOworCisJbWVtc2V0NjQodmFkZHIsIGRh
ZGRyLCBlbnRyaWVzKTsKKwlrdW5tYXBfYXRvbWljKHZhZGRyKTsKKworCW1lbXNldF9wKHBkLT5l
bnRyeSwgdG8sIGVudHJpZXMpOworfQorCitzdGF0aWMgc3RydWN0IGk5MTVfcGFnZV9kaXJlY3Rv
cnkgKgorZ2VuOF9hbGxvY190b3BfcGQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCit7
CisJc3RydWN0IGk5MTVfcGFnZV9kaXJlY3RvcnkgKnBkOworCisJaWYgKGk5MTVfdm1faXNfNGx2
bCh2bSkpIHsKKwkJcGQgPSBhbGxvY19wZCh2bSk7CisJCWlmICghSVNfRVJSKHBkKSkKKwkJCWlu
aXRfcGQodm0sIHBkLCB2bS0+c2NyYXRjaF9wZHApOworCisJCXJldHVybiBwZDsKKwl9CisKKwkv
KiAzbHZsICovCisJcGQgPSBfX2FsbG9jX3BkKCk7CisJaWYgKCFwZCkKKwkJcmV0dXJuIEVSUl9Q
VFIoLUVOT01FTSk7CisKKwlwZC0+ZW50cnlbR0VOOF8zTFZMX1BEUEVTXSA9IE5VTEw7CisKKwlp
ZiAodW5saWtlbHkoc2V0dXBfcGFnZV9kbWEodm0sICZwZC0+YmFzZSkpKSB7CisJCWtmcmVlKHBk
KTsKKwkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisJfQorCisJaW5pdF9wZF9uKHZtLCBwZCwg
dm0tPnNjcmF0Y2hfcGQsIEdFTjhfM0xWTF9QRFBFUyk7CisKKwlyZXR1cm4gcGQ7Cit9CisKIC8q
CiAgKiBHRU44IGxlZ2FjeSBwcGd0dCBwcm9ncmFtbWluZyBpcyBhY2NvbXBsaXNoZWQgdGhyb3Vn
aCBhIG1heCA0IFBEUCByZWdpc3RlcnMKICAqIHdpdGggYSBuZXQgZWZmZWN0IHJlc2VtYmxpbmcg
YSAyLWxldmVsIHBhZ2UgdGFibGUgaW4gbm9ybWFsIHg4NiB0ZXJtcy4gRWFjaApAQCAtMTY0MCwz
NCArMTY3NiwyMSBAQCBzdGF0aWMgc3RydWN0IGk5MTVfcHBndHQgKmdlbjhfcHBndHRfY3JlYXRl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCWlmIChlcnIpCiAJCWdvdG8gZXJyX2Zy
ZWU7CiAKLQlwcGd0dC0+cGQgPSBfX2FsbG9jX3BkKCk7Ci0JaWYgKCFwcGd0dC0+cGQpIHsKLQkJ
ZXJyID0gLUVOT01FTTsKKwlwcGd0dC0+cGQgPSBnZW44X2FsbG9jX3RvcF9wZCgmcHBndHQtPnZt
KTsKKwlpZiAoSVNfRVJSKHBwZ3R0LT5wZCkpIHsKKwkJZXJyID0gUFRSX0VSUihwcGd0dC0+cGQp
OwogCQlnb3RvIGVycl9mcmVlX3NjcmF0Y2g7CiAJfQogCiAJaWYgKGk5MTVfdm1faXNfNGx2bCgm
cHBndHQtPnZtKSkgewotCQllcnIgPSBzZXR1cF9wYWdlX2RtYSgmcHBndHQtPnZtLCAmcHBndHQt
PnBkLT5iYXNlKTsKLQkJaWYgKGVycikKLQkJCWdvdG8gZXJyX2ZyZWVfcGRwOwotCi0JCWluaXRf
cGQoJnBwZ3R0LT52bSwgcHBndHQtPnBkLCBwcGd0dC0+dm0uc2NyYXRjaF9wZHApOwotCiAJCXBw
Z3R0LT52bS5hbGxvY2F0ZV92YV9yYW5nZSA9IGdlbjhfcHBndHRfYWxsb2NfNGx2bDsKIAkJcHBn
dHQtPnZtLmluc2VydF9lbnRyaWVzID0gZ2VuOF9wcGd0dF9pbnNlcnRfNGx2bDsKIAkJcHBndHQt
PnZtLmNsZWFyX3JhbmdlID0gZ2VuOF9wcGd0dF9jbGVhcl80bHZsOwogCX0gZWxzZSB7Ci0JCS8q
Ci0JCSAqIFdlIGRvbid0IG5lZWQgdG8gc2V0dXAgZG1hIGZvciB0b3AgbGV2ZWwgcGRwLCBvbmx5
Ci0JCSAqIGZvciBlbnRyaWVzLiBTbyBwb2ludCBlbnRyaWVzIHRvIHNjcmF0Y2guCi0JCSAqLwot
CQltZW1zZXRfcChwcGd0dC0+cGQtPmVudHJ5LCBwcGd0dC0+dm0uc2NyYXRjaF9wZCwKLQkJCSBH
RU44XzNMVkxfUERQRVMpOwotCiAJCWlmIChpbnRlbF92Z3B1X2FjdGl2ZShpOTE1KSkgewogCQkJ
ZXJyID0gZ2VuOF9wcmVhbGxvY2F0ZV90b3BfbGV2ZWxfcGRwKHBwZ3R0KTsKIAkJCWlmIChlcnIp
Ci0JCQkJZ290byBlcnJfZnJlZV9wZHA7CisJCQkJZ290byBlcnJfZnJlZV9wZDsKIAkJfQogCiAJ
CXBwZ3R0LT52bS5hbGxvY2F0ZV92YV9yYW5nZSA9IGdlbjhfcHBndHRfYWxsb2NfM2x2bDsKQEAg
LTE2ODIsNyArMTcwNSw3IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV9wcGd0dCAqZ2VuOF9wcGd0dF9j
cmVhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAKIAlyZXR1cm4gcHBndHQ7CiAK
LWVycl9mcmVlX3BkcDoKK2Vycl9mcmVlX3BkOgogCWZyZWVfcGQoJnBwZ3R0LT52bSwgcHBndHQt
PnBkKTsKIGVycl9mcmVlX3NjcmF0Y2g6CiAJZ2VuOF9mcmVlX3NjcmF0Y2goJnBwZ3R0LT52bSk7
Ci0tIAoyLjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdm
eA==

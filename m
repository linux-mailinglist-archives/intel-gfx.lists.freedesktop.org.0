Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C31423D02E0
	for <lists+intel-gfx@lfdr.de>; Tue, 20 Jul 2021 22:40:57 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BFA806E563;
	Tue, 20 Jul 2021 20:40:25 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga05.intel.com (mga05.intel.com [192.55.52.43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 378D56E50C;
 Tue, 20 Jul 2021 20:40:18 +0000 (UTC)
X-IronPort-AV: E=McAfee;i="6200,9189,10051"; a="296885376"
X-IronPort-AV: E=Sophos;i="5.84,256,1620716400"; d="scan'208";a="296885376"
Received: from orsmga006.jf.intel.com ([10.7.209.51])
 by fmsmga105.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 20 Jul 2021 13:40:17 -0700
X-IronPort-AV: E=Sophos;i="5.84,256,1620716400"; d="scan'208";a="414906087"
Received: from dhiatt-server.jf.intel.com ([10.54.81.3])
 by orsmga006-auth.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 20 Jul 2021 13:40:16 -0700
From: Matthew Brost <matthew.brost@intel.com>
To: <intel-gfx@lists.freedesktop.org>,
	<dri-devel@lists.freedesktop.org>
Date: Tue, 20 Jul 2021 13:57:48 -0700
Message-Id: <20210720205802.39610-29-matthew.brost@intel.com>
X-Mailer: git-send-email 2.28.0
In-Reply-To: <20210720205802.39610-1-matthew.brost@intel.com>
References: <20210720205802.39610-1-matthew.brost@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [RFC PATCH 28/42] drm/i915/guc: Add basic GuC multi-lrc
 selftest
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWRkIHZlcnkgYmFzaWMgKHNpbmdsZSBzdWJtaXNzaW9uKSBtdWx0aS1scmMgc2VsZnRlc3QuCgpT
aWduZWQtb2ZmLWJ5OiBNYXR0aGV3IEJyb3N0IDxtYXR0aGV3LmJyb3N0QGludGVsLmNvbT4KLS0t
CiAuLi4vZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX2d1Y19zdWJtaXNzaW9uLmMgfCAgIDEgKwog
Li4uL2RybS9pOTE1L2d0L3VjL3NlbGZ0ZXN0X2d1Y19tdWx0aV9scmMuYyAgIHwgMTY4ICsrKysr
KysrKysrKysrKysrKwogLi4uL2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2xpdmVfc2VsZnRlc3Rz
LmggIHwgICAxICsKIDMgZmlsZXMgY2hhbmdlZCwgMTcwIGluc2VydGlvbnMoKykKIGNyZWF0ZSBt
b2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9zZWxmdGVzdF9ndWNfbXVsdGlf
bHJjLmMKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF9ndWNf
c3VibWlzc2lvbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfZ3VjX3N1Ym1p
c3Npb24uYwppbmRleCAzMjZjYjRmYzhhOWQuLmRkZTZhYWIxZGI4NSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfZ3VjX3N1Ym1pc3Npb24uYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF9ndWNfc3VibWlzc2lvbi5jCkBAIC00NzM3LDQg
KzQ3MzcsNSBAQCBib29sIGludGVsX2d1Y192aXJ0dWFsX2VuZ2luZV9oYXNfaGVhcnRiZWF0KGNv
bnN0IHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKnZlKQogCiAjaWYgSVNfRU5BQkxFRChDT05GSUdf
RFJNX0k5MTVfU0VMRlRFU1QpCiAjaW5jbHVkZSAic2VsZnRlc3RfZ3VjX2Zsb3dfY29udHJvbC5j
IgorI2luY2x1ZGUgInNlbGZ0ZXN0X2d1Y19tdWx0aV9scmMuYyIKICNlbmRpZgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvc2VsZnRlc3RfZ3VjX211bHRpX2xyYy5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvc2VsZnRlc3RfZ3VjX211bHRpX2xyYy5jCm5ldyBm
aWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uMjI2ZTY0ZmVlOTE5Ci0tLSAvZGV2
L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvc2VsZnRlc3RfZ3VjX211bHRp
X2xyYy5jCkBAIC0wLDAgKzEsMTY4IEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlU
CisvKgorICogQ29weXJpZ2h0IO+/ve+/vSAyMDE5IEludGVsIENvcnBvcmF0aW9uCisgKi8KKwor
I2luY2x1ZGUgInNlbGZ0ZXN0cy9pZ3Rfc3Bpbm5lci5oIgorI2luY2x1ZGUgInNlbGZ0ZXN0cy9p
Z3RfcmVzZXQuaCIKKyNpbmNsdWRlICJzZWxmdGVzdHMvaW50ZWxfc2NoZWR1bGVyX2hlbHBlcnMu
aCIKKyNpbmNsdWRlICJndC9pbnRlbF9lbmdpbmVfaGVhcnRiZWF0LmgiCisjaW5jbHVkZSAiZ2Vt
L3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQuaCIKKworc3RhdGljIHZvaWQgbG9naWNhbF9zb3J0KHN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKiplbmdpbmVzLCBpbnQgbnVtX2VuZ2luZXMpCit7CisJc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqc29ydGVkW01BWF9FTkdJTkVfSU5TVEFOQ0UgKyAxXTsKKwlp
bnQgaSwgajsKKworCWZvciAoaSA9IDA7IGkgPCBudW1fZW5naW5lczsgKytpKQorCQlmb3IgKGog
PSAwOyBqIDwgTUFYX0VOR0lORV9JTlNUQU5DRSArIDE7ICsraikgeworCQkJaWYgKGVuZ2luZXNb
al0tPmxvZ2ljYWxfbWFzayAmIEJJVChpKSkgeworCQkJCXNvcnRlZFtpXSA9IGVuZ2luZXNbal07
CisJCQkJYnJlYWs7CisJCQl9CisJCX0KKworCW1lbWNweSgqZW5naW5lcywgKnNvcnRlZCwKKwkg
ICAgICAgc2l6ZW9mKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKikgKiBudW1fZW5naW5lcyk7Cit9
CisKK3N0YXRpYyBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqCittdWx0aV9scmNfY3JlYXRlX3BhcmVu
dChzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCB1OCBjbGFzcywKKwkJCXVuc2lnbmVkIGxvbmcgZmxhZ3Mp
Cit7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqc2libGluZ3NbTUFYX0VOR0lORV9JTlNUQU5D
RSArIDFdOworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKKwllbnVtIGludGVsX2Vu
Z2luZV9pZCBpZDsKKwlpbnQgaSA9IDA7CisKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndCwg
aWQpIHsKKwkJaWYgKGVuZ2luZS0+Y2xhc3MgIT0gY2xhc3MpCisJCQljb250aW51ZTsKKworCQlz
aWJsaW5nc1tpKytdID0gZW5naW5lOworCX0KKworCWlmIChpIDw9IDEpCisJCXJldHVybiBFUlJf
UFRSKDApOworCisJbG9naWNhbF9zb3J0KHNpYmxpbmdzLCBpKTsKKworCXJldHVybiBpbnRlbF9l
bmdpbmVfY3JlYXRlX3BhcmFsbGVsKHNpYmxpbmdzLCAxLCBpKTsKK30KKworc3RhdGljIHZvaWQg
bXVsdGlfbHJjX2NvbnRleHRfcHV0KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKK3sKKwlHRU1f
QlVHX09OKCFpbnRlbF9jb250ZXh0X2lzX3BhcmVudChjZSkpOworCisJLyoKKwkgKiBPbmx5IHRo
ZSBwYXJlbnQgZ2V0cyB0aGUgY3JlYXRpb24gcmVmIHB1dCBpbiB0aGUgdUFQSSwgdGhlIHBhcmVu
dAorCSAqIGl0c2VsZiBpcyByZXNwb25zaWJsZSBmb3IgY3JlYXRpb24gcmVmIHB1dCBvbiB0aGUg
Y2hpbGRyZW4uCisJICovCisJaW50ZWxfY29udGV4dF9wdXQoY2UpOworfQorCitzdGF0aWMgc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqCittdWx0aV9scmNfbm9wX3JlcXVlc3Qoc3RydWN0IGludGVsX2Nv
bnRleHQgKmNlKQoreworCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjaGlsZDsKKwlzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpycSwgKmNoaWxkX3JxOworCWludCBpID0gMDsKKworCUdFTV9CVUdfT04oIWlu
dGVsX2NvbnRleHRfaXNfcGFyZW50KGNlKSk7CisKKwlycSA9IGludGVsX2NvbnRleHRfY3JlYXRl
X3JlcXVlc3QoY2UpOworCWlmIChJU19FUlIocnEpKQorCQlyZXR1cm4gcnE7CisKKwlpOTE1X3Jl
cXVlc3RfZ2V0KHJxKTsKKwlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKworCWZvcl9lYWNoX2NoaWxk
KGNlLCBjaGlsZCkgeworCQljaGlsZF9ycSA9IGludGVsX2NvbnRleHRfY3JlYXRlX3JlcXVlc3Qo
Y2hpbGQpOworCQlpZiAoSVNfRVJSKGNoaWxkX3JxKSkKKwkJCWdvdG8gY2hpbGRfZXJyb3I7CisK
KwkJaWYgKCsraSA9PSBjZS0+Z3VjX251bWJlcl9jaGlsZHJlbikKKwkJCXNldF9iaXQoSTkxNV9G
RU5DRV9GTEFHX1NVQk1JVF9QQVJBTExFTCwKKwkJCQkmY2hpbGRfcnEtPmZlbmNlLmZsYWdzKTsK
KwkJaTkxNV9yZXF1ZXN0X2FkZChjaGlsZF9ycSk7CisJfQorCisJcmV0dXJuIHJxOworCitjaGls
ZF9lcnJvcjoKKwlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKKworCXJldHVybiBFUlJfUFRSKC1FTk9N
RU0pOworfQorCitzdGF0aWMgaW50IF9faW50ZWxfZ3VjX211bHRpX2xyY19iYXNpYyhzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0LCB1bnNpZ25lZCBpbnQgY2xhc3MpCit7CisJc3RydWN0IGludGVsX2NvbnRl
eHQgKnBhcmVudDsKKwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKKwlpbnQgcmV0OworCisJcGFy
ZW50ID0gbXVsdGlfbHJjX2NyZWF0ZV9wYXJlbnQoZ3QsIGNsYXNzLCAwKTsKKwlpZiAoSVNfRVJS
KHBhcmVudCkpIHsKKwkJcHJfZXJyKCJGYWlsZWQgY3JlYXRpbmcgY29udGV4dHM6ICVsZCIsIFBU
Ul9FUlIocGFyZW50KSk7CisJCXJldHVybiBQVFJfRVJSKHBhcmVudCk7CisJfSBlbHNlIGlmIChw
YXJlbnQgPT0gTlVMTCkgeworCQlwcl9kZWJ1ZygiTm90IGVub3VnaCBlbmdpbmVzIGluIGNsYXNz
OiAlZCIsCisJCQkgVklERU9fREVDT0RFX0NMQVNTKTsKKwkJcmV0dXJuIDA7CisJfQorCisJcnEg
PSBtdWx0aV9scmNfbm9wX3JlcXVlc3QocGFyZW50KTsKKwlpZiAoSVNfRVJSKHJxKSkgeworCQly
ZXQgPSBQVFJfRVJSKHJxKTsKKwkJcHJfZXJyKCJGYWlsZWQgY3JlYXRpbmcgcmVxdWVzdHM6ICVk
IiwgcmV0KTsKKwkJZ290byBvdXQ7CisJfQorCisJcmV0ID0gaW50ZWxfc2VsZnRlc3Rfd2FpdF9m
b3JfcnEocnEpOworCWlmIChyZXQpCisJCXByX2VycigiRmFpbGVkIHdhaXRpbmcgb24gcmVxdWVz
dDogJWQiLCByZXQpOworCisJaTkxNV9yZXF1ZXN0X3B1dChycSk7CisKKwlpZiAocmV0ID49IDAp
IHsKKwkJcmV0ID0gaW50ZWxfZ3Rfd2FpdF9mb3JfaWRsZShndCwgSFogKiA1KTsKKwkJaWYgKHJl
dCA8IDApCisJCQlwcl9lcnIoIkdUIGZhaWxlZCB0byBpZGxlOiAlZFxuIiwgcmV0KTsKKwl9CisK
K291dDoKKwltdWx0aV9scmNfY29udGV4dF9wdXQocGFyZW50KTsKKwlyZXR1cm4gcmV0OworfQor
CitzdGF0aWMgaW50IGludGVsX2d1Y19tdWx0aV9scmNfYmFzaWModm9pZCAqYXJnKQoreworCXN0
cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CisJdW5zaWduZWQgY2xhc3M7CisJaW50IHJldDsKKwor
CWZvciAoY2xhc3MgPSAwOyBjbGFzcyA8IE1BWF9FTkdJTkVfQ0xBU1MgKyAxOyArK2NsYXNzKSB7
CisJCXJldCA9IF9faW50ZWxfZ3VjX211bHRpX2xyY19iYXNpYyhndCwgY2xhc3MpOworCQlpZiAo
cmV0KQorCQkJcmV0dXJuIHJldDsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworaW50IGludGVsX2d1
Y19tdWx0aV9scmMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCit7CisJc3RhdGljIGNv
bnN0IHN0cnVjdCBpOTE1X3N1YnRlc3QgdGVzdHNbXSA9IHsKKwkJU1VCVEVTVChpbnRlbF9ndWNf
bXVsdGlfbHJjX2Jhc2ljKSwKKwl9OworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSAmaTkxNS0+Z3Q7
CisKKwlpZiAoaW50ZWxfZ3RfaXNfd2VkZ2VkKGd0KSkKKwkJcmV0dXJuIDA7CisKKwlpZiAoIWlu
dGVsX3VjX3VzZXNfZ3VjX3N1Ym1pc3Npb24oJmd0LT51YykpCisJCXJldHVybiAwOworCisJcmV0
dXJuIGludGVsX2d0X2xpdmVfc3VidGVzdHModGVzdHMsIGd0KTsKK30KZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2xpdmVfc2VsZnRlc3RzLmggYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9saXZlX3NlbGZ0ZXN0cy5oCmluZGV4IGQ5
YmQ3MzJiNzQxYS4uMmRkYjcyYmJhYjY5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvaTkxNV9saXZlX3NlbGZ0ZXN0cy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X2xpdmVfc2VsZnRlc3RzLmgKQEAgLTQ4LDUgKzQ4LDYgQEAgc2Vs
ZnRlc3QoZXhlY2xpc3RzLCBpbnRlbF9leGVjbGlzdHNfbGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVz
dChyaW5nX3N1Ym1pc3Npb24sIGludGVsX3Jpbmdfc3VibWlzc2lvbl9saXZlX3NlbGZ0ZXN0cykK
IHNlbGZ0ZXN0KHBlcmYsIGk5MTVfcGVyZl9saXZlX3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KGd1Y19m
bG93X2NvbnRyb2wsIGludGVsX2d1Y19mbG93X2NvbnRyb2wpCitzZWxmdGVzdChndWNfbXVsdGlf
bHJjLCBpbnRlbF9ndWNfbXVsdGlfbHJjKQogLyogSGVyZSBiZSBkcmFnb25zOiBrZWVwIGxhc3Qg
dG8gcnVuIGxhc3QhICovCiBzZWxmdGVzdChsYXRlX2d0X3BtLCBpbnRlbF9ndF9wbV9sYXRlX3Nl
bGZ0ZXN0cykKLS0gCjIuMjguMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
aW50ZWwtZ2Z4Cg==

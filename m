Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 754389CA25
	for <lists+intel-gfx@lfdr.de>; Mon, 26 Aug 2019 09:23:29 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C62686E1EE;
	Mon, 26 Aug 2019 07:23:27 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1F3076E1BC
 for <intel-gfx@lists.freedesktop.org>; Mon, 26 Aug 2019 07:22:14 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18262695-1500050 
 for multiple; Mon, 26 Aug 2019 08:21:55 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 26 Aug 2019 08:21:41 +0100
Message-Id: <20190826072149.9447-20-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190826072149.9447-1-chris@chris-wilson.co.uk>
References: <20190826072149.9447-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 20/28] drm/i915: Merge wait_for_timelines with
 retire_request
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

d2FpdF9mb3JfdGltZWxpbmVzIGlzIGVzc2VudGlhbGx5IHRoZSBzYW1lIGxvb3AgYXMgcmV0aXJp
bmcgcmVxdWVzdHMKKHdpdGggYW4gZXh0cmEpLCBzbyBtZXJnZSB0aGUgdHdvIGludG8gb25lIHJv
dXRpbmUuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5j
by51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fbW1hbi5jICAgICAg
fCAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMgICAgICAgIHwg
IDYgKy0KIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyB8ICA0
ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF90aW1lbGluZS5jICAgfCAgMiAr
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgICAgICAgICAgIHwgIDYgKy0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggICAgICAgICAgICAgICB8ICAzICstCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jICAgICAgICAgICAgICAgfCA2OCArKy0tLS0t
LS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ldmljdC5jICAgICAg
ICAgfCAxMiArKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYyAgICAgICAg
ICAgfCAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMgICAgICAgICAg
IHwgMTkgKysrKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaCAgICAgICAg
ICAgfCAgMyArLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2ZsdXNoX3Rlc3QuYyAg
IHwgIDQgKy0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9saXZlX3Rlc3QuYyAgICB8
ICA0ICstCiAuLi4vZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYyAgfCAg
MiArLQogMTQgZmlsZXMgY2hhbmdlZCwgNDEgaW5zZXJ0aW9ucygrKSwgOTggZGVsZXRpb25zKC0p
CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMKaW5kZXggMDQ0MGRiZmRh
Mjk1Li42NDM4N2UwMWEwZTQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9tbWFuLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21t
YW4uYwpAQCAtNDM3LDkgKzQzNyw3IEBAIHN0YXRpYyBpbnQgY3JlYXRlX21tYXBfb2Zmc2V0KHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiAKIAkvKiBBdHRlbXB0IHRvIHJlYXAgc29t
ZSBtbWFwIHNwYWNlIGZyb20gZGVhZCBvYmplY3RzICovCiAJZG8gewotCQllcnIgPSBpOTE1X2dl
bV93YWl0X2Zvcl9pZGxlKGk5MTUsCi0JCQkJCSAgICAgSTkxNV9XQUlUX0lOVEVSUlVQVElCTEUs
Ci0JCQkJCSAgICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOworCQllcnIgPSBpOTE1X2dlbV93YWl0
X2Zvcl9pZGxlKGk5MTUsIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKIAkJaWYgKGVycikKIAkJCWJy
ZWFrOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0u
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCmluZGV4IGZlYzBiNDEw
ZDFkOS4uYjQxZjVlNGMwYzY1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0u
YwpAQCAtNDgsNyArNDgsNyBAQCBzdGF0aWMgdm9pZCByZXRpcmVfd29ya19oYW5kbGVyKHN0cnVj
dCB3b3JrX3N0cnVjdCAqd29yaykKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9CiAJ
CWNvbnRhaW5lcl9vZih3b3JrLCB0eXBlb2YoKmk5MTUpLCBnZW0ucmV0aXJlX3dvcmsud29yayk7
CiAKLQlpOTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1KTsKKwlpOTE1X3JldGlyZV9yZXF1ZXN0cyhp
OTE1LCAwKTsKIAogCXF1ZXVlX2RlbGF5ZWRfd29yayhpOTE1LT53cSwKIAkJCSAgICZpOTE1LT5n
ZW0ucmV0aXJlX3dvcmssCkBAIC04Miw5ICs4Miw3IEBAIHN0YXRpYyBib29sIHN3aXRjaF90b19r
ZXJuZWxfY29udGV4dF9zeW5jKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiB7CiAJYm9vbCByZXN1bHQg
PSAhaW50ZWxfZ3RfaXNfd2VkZ2VkKGd0KTsKIAotCWlmIChpOTE1X2dlbV93YWl0X2Zvcl9pZGxl
KGd0LT5pOTE1LAotCQkJCSAgIEk5MTVfV0FJVF9GT1JfSURMRV9CT09TVCwKLQkJCQkgICBJOTE1
X0dFTV9JRExFX1RJTUVPVVQpID09IC1FVElNRSkgeworCWlmIChpOTE1X2dlbV93YWl0X2Zvcl9p
ZGxlKGd0LT5pOTE1LCBJOTE1X0dFTV9JRExFX1RJTUVPVVQpID09IC1FVElNRSkgewogCQkvKiBY
WFggaGlkZSB3YXJuaW5nIGZyb20gZ2VtX2VpbyAqLwogCQlpZiAoaTkxNV9tb2RwYXJhbXMucmVz
ZXQpIHsKIAkJCWRldl9lcnIoZ3QtPmk5MTUtPmRybS5kZXYsCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCmluZGV4IGE4MjIw
ODY4YTU2YS4uOTljODMyMDc1NDI5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYwpAQCAtMzA0LDcgKzMwNCw3IEBAIGNy
ZWF0ZV90ZXN0X29iamVjdChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAlpbnQgZXJy
OwogCiAJLyogS2VlcCBpbiBHRU0ncyBnb29kIGdyYWNlcyAqLwotCWk5MTVfcmV0aXJlX3JlcXVl
c3RzKHZtLT5pOTE1KTsKKwlpOTE1X3JldGlyZV9yZXF1ZXN0cyh2bS0+aTkxNSwgMCk7CiAKIAlz
aXplID0gbWluKHZtLT50b3RhbCAvIDIsIDEwMjR1bGwgKiBEV19QRVJfUEFHRSAqIFBBR0VfU0la
RSk7CiAJc2l6ZSA9IHJvdW5kX2Rvd24oc2l6ZSwgRFdfUEVSX1BBR0UgKiBQQUdFX1NJWkUpOwpA
QCAtOTI0LDcgKzkyNCw3IEBAIF9fc3NldV9maW5pc2goY29uc3QgY2hhciAqbmFtZSwKIAogCWlm
ICgoZmxhZ3MgJiBURVNUX0lETEUpICYmIHJldCA9PSAwKSB7CiAJCXJldCA9IGk5MTVfZ2VtX3dh
aXRfZm9yX2lkbGUoY2UtPmVuZ2luZS0+aTkxNSwKLQkJCQkJICAgICAwLCBNQVhfU0NIRURVTEVf
VElNRU9VVCk7CisJCQkJCSAgICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwogCQlpZiAocmV0KQog
CQkJcmV0dXJuIHJldDsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfdGltZWxpbmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3RpbWVs
aW5lLmMKaW5kZXggNDJkMGJiYmJjN2VhLi4wOTU1YjllNjM3NDYgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3RpbWVsaW5lLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfdGltZWxpbmUuYwpAQCAtNzQzLDcgKzc0Myw3IEBAIHN0YXRp
YyBpbnQgbGl2ZV9od3NwX3dyYXAodm9pZCAqYXJnKQogCQkJZ290byBvdXQ7CiAJCX0KIAotCQlp
OTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1KTsgLyogcmVjeWNsZSBIV1NQICovCisJCWk5MTVfcmV0
aXJlX3JlcXVlc3RzKGk5MTUsIDApOyAvKiByZWN5Y2xlIEhXU1AgKi8KIAl9CiAKIG91dDoKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKaW5kZXggYjM1MDdlYzljOGQ2Li5lNjM2MjI0NTM0
N2IgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCkBAIC0zNjEzLDEyICszNjEzLDEw
IEBAIGk5MTVfZHJvcF9jYWNoZXNfc2V0KHZvaWQgKmRhdGEsIHU2NCB2YWwpCiAJCWludGVsX2d0
X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKIAogCWlmICh2YWwgJiBEUk9QX1JFVElSRSkKLQkJaTkx
NV9yZXRpcmVfcmVxdWVzdHMoaTkxNSk7CisJCWk5MTVfcmV0aXJlX3JlcXVlc3RzKGk5MTUsIDAp
OwogCiAJaWYgKHZhbCAmIChEUk9QX0lETEUgfCBEUk9QX0FDVElWRSkpIHsKLQkJcmV0ID0gaTkx
NV9nZW1fd2FpdF9mb3JfaWRsZShpOTE1LAotCQkJCQkgICAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJ
QkxFLAotCQkJCQkgICAgIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKKwkJcmV0ID0gaTkxNV9nZW1f
d2FpdF9mb3JfaWRsZShpOTE1LCBNQVhfU0NIRURVTEVfVElNRU9VVCk7CiAJCWlmIChyZXQpCiAJ
CQlyZXR1cm4gcmV0OwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCmluZGV4IGI0MjY1MWEzODdk
OS4uODU3NjdiN2NkMDBiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Ry
di5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKQEAgLTIzMjIsOCArMjMy
Miw3IEBAIHZvaWQgaTkxNV9nZW1fZHJpdmVyX3JlZ2lzdGVyKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KTsKIHZvaWQgaTkxNV9nZW1fZHJpdmVyX3VucmVnaXN0ZXIoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpOwogdm9pZCBpOTE1X2dlbV9kcml2ZXJfcmVtb3ZlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiB2b2lkIGk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Ci1pbnQgaTkxNV9nZW1fd2FpdF9m
b3JfaWRsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCi0JCQkgICB1bnNpZ25l
ZCBpbnQgZmxhZ3MsIGxvbmcgdGltZW91dCk7CitpbnQgaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGxvbmcgdGltZW91dCk7CiB2b2lkIGk5
MTVfZ2VtX3N1c3BlbmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIHZvaWQg
aTkxNV9nZW1fc3VzcGVuZF9sYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7
CiB2b2lkIGk5MTVfZ2VtX3Jlc3VtZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKaW5kZXggMzgxMGNkMzA1NDA5Li42MGQ2ZWI1NDZmN2Yg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwpAQCAtODg0LDc5ICs4ODQsMTkgQEAgdm9pZCBpOTE1
X2dlbV9ydW50aW1lX3N1c3BlbmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJfQog
fQogCi1zdGF0aWMgbG9uZwotd2FpdF9mb3JfdGltZWxpbmVzKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAotCQkgICB1bnNpZ25lZCBpbnQgd2FpdCwgbG9uZyB0aW1lb3V0KQotewotCXN0
cnVjdCBpbnRlbF9ndF90aW1lbGluZXMgKnRpbWVsaW5lcyA9ICZpOTE1LT5ndC50aW1lbGluZXM7
Ci0Jc3RydWN0IGludGVsX3RpbWVsaW5lICp0bDsKLQl1bnNpZ25lZCBsb25nIGZsYWdzOwotCi0J
c3Bpbl9sb2NrX2lycXNhdmUoJnRpbWVsaW5lcy0+bG9jaywgZmxhZ3MpOwotCWxpc3RfZm9yX2Vh
Y2hfZW50cnkodGwsICZ0aW1lbGluZXMtPmFjdGl2ZV9saXN0LCBsaW5rKSB7Ci0JCXN0cnVjdCBk
bWFfZmVuY2UgKmZlbmNlOwotCi0JCWZlbmNlID0gaTkxNV9hY3RpdmVfZmVuY2VfZ2V0KCZ0bC0+
bGFzdF9yZXF1ZXN0KTsKLQkJaWYgKCFmZW5jZSkKLQkJCWNvbnRpbnVlOwotCi0JCXNwaW5fdW5s
b2NrX2lycXJlc3RvcmUoJnRpbWVsaW5lcy0+bG9jaywgZmxhZ3MpOwotCi0JCWlmICghZG1hX2Zl
bmNlX2lzX2k5MTUoZmVuY2UpKSB7Ci0JCQl0aW1lb3V0ID0gZG1hX2ZlbmNlX3dhaXRfdGltZW91
dChmZW5jZSwKLQkJCQkJCQkgZmxhZ3MgJiBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSwKLQkJCQkJ
CQkgdGltZW91dCk7Ci0JCX0gZWxzZSB7Ci0JCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSA9IHRv
X3JlcXVlc3QoZmVuY2UpOwotCi0JCQkvKgotCQkJICogIlJhY2UtdG8taWRsZSIuCi0JCQkgKgot
CQkJICogU3dpdGNoaW5nIHRvIHRoZSBrZXJuZWwgY29udGV4dCBpcyBvZnRlbiB1c2VkIGFzCi0J
CQkgKiBhIHN5bmNocm9ub3VzIHN0ZXAgcHJpb3IgdG8gaWRsaW5nLCBlLmcuIGluIHN1c3BlbmQK
LQkJCSAqIGZvciBmbHVzaGluZyBhbGwgY3VycmVudCBvcGVyYXRpb25zIHRvIG1lbW9yeSBiZWZv
cmUKLQkJCSAqIHNsZWVwaW5nLiBUaGVzZSB3ZSB3YW50IHRvIGNvbXBsZXRlIGFzIHF1aWNrbHkg
YXMKLQkJCSAqIHBvc3NpYmxlIHRvIGF2b2lkIHByb2xvbmdlZCBzdGFsbHMsIHNvIGFsbG93IHRo
ZSBncHUKLQkJCSAqIHRvIGJvb3N0IHRvIG1heGltdW0gY2xvY2tzLgotCQkJICovCi0JCQlpZiAo
ZmxhZ3MgJiBJOTE1X1dBSVRfRk9SX0lETEVfQk9PU1QpCi0JCQkJZ2VuNl9ycHNfYm9vc3QocnEp
OwotCi0JCQl0aW1lb3V0ID0gaTkxNV9yZXF1ZXN0X3dhaXQocnEsIGZsYWdzLCB0aW1lb3V0KTsK
LQkJfQotCi0JCWRtYV9mZW5jZV9wdXQoZmVuY2UpOwotCQlpZiAodGltZW91dCA8IDApCi0JCQly
ZXR1cm4gdGltZW91dDsKLQotCQkvKiByZXN0YXJ0IGFmdGVyIHJlYWNxdWlyaW5nIHRoZSBsb2Nr
ICovCi0JCXNwaW5fbG9ja19pcnFzYXZlKCZ0aW1lbGluZXMtPmxvY2ssIGZsYWdzKTsKLQkJdGwg
PSBsaXN0X2VudHJ5KCZ0aW1lbGluZXMtPmFjdGl2ZV9saXN0LCB0eXBlb2YoKnRsKSwgbGluayk7
Ci0JfQotCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnRpbWVsaW5lcy0+bG9jaywgZmxhZ3MpOwot
Ci0JcmV0dXJuIHRpbWVvdXQ7Ci19Ci0KLWludCBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LAotCQkJICAgdW5zaWduZWQgaW50IGZsYWdzLCBsb25n
IHRpbWVvdXQpCitpbnQgaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSwgbG9uZyB0aW1lb3V0KQogewogCS8qIElmIHRoZSBkZXZpY2UgaXMgYXNsZWVw
LCB3ZSBoYXZlIG5vIHJlcXVlc3RzIG91dHN0YW5kaW5nICovCiAJaWYgKCFpbnRlbF9ndF9wbV9p
c19hd2FrZSgmaTkxNS0+Z3QpKQogCQlyZXR1cm4gMDsKIAotCWRvIHsKLQkJdGltZW91dCA9IHdh
aXRfZm9yX3RpbWVsaW5lcyhpOTE1LCBmbGFncywgdGltZW91dCk7Ci0JCWlmICh0aW1lb3V0IDwg
MCkKLQkJCXJldHVybiB0aW1lb3V0OwotCisJd2hpbGUgKCh0aW1lb3V0ID0gaTkxNV9yZXRpcmVf
cmVxdWVzdHMoaTkxNSwgdGltZW91dCkpID4gMCkgewogCQljb25kX3Jlc2NoZWQoKTsKIAkJaWYg
KHNpZ25hbF9wZW5kaW5nKGN1cnJlbnQpKQogCQkJcmV0dXJuIC1FSU5UUjsKKwl9CiAKLQl9IHdo
aWxlIChpOTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1KSk7Ci0KLQlyZXR1cm4gMDsKKwlyZXR1cm4g
dGltZW91dDsKIH0KIAogc3RydWN0IGk5MTVfdm1hICoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ2VtX2V2aWN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dl
bV9ldmljdC5jCmluZGV4IDQ0ZjViNjM4ZmE0My4uNzA4MDU1YTM4ODdlIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ldmljdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtX2V2aWN0LmMKQEAgLTQ2LDkgKzQ2LDcgQEAgc3RhdGljIGludCBnZ3R0
X2ZsdXNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCSAqIHRoZSBob3BlcyB0aGF0
IHdlIGNhbiB0aGVuIHJlbW92ZSBjb250ZXh0cyBhbmQgdGhlIGxpa2Ugb25seQogCSAqIGJvdW5k
IGJ5IHRoZWlyIGFjdGl2ZSByZWZlcmVuY2UuCiAJICovCi0JcmV0dXJuIGk5MTVfZ2VtX3dhaXRf
Zm9yX2lkbGUoaTkxNSwKLQkJCQkgICAgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSwKLQkJCQkg
ICAgICBNQVhfU0NIRURVTEVfVElNRU9VVCk7CisJcmV0dXJuIGk5MTVfZ2VtX3dhaXRfZm9yX2lk
bGUoaTkxNSwgTUFYX1NDSEVEVUxFX1RJTUVPVVQpOwogfQogCiBzdGF0aWMgYm9vbApAQCAtMTI2
LDYgKzEyNCw4IEBAIGk5MTVfZ2VtX2V2aWN0X3NvbWV0aGluZyhzdHJ1Y3QgaTkxNV9hZGRyZXNz
X3NwYWNlICp2bSwKIAkJCQkgICAgbWluX3NpemUsIGFsaWdubWVudCwgY2FjaGVfbGV2ZWwsCiAJ
CQkJICAgIHN0YXJ0LCBlbmQsIG1vZGUpOwogCisJaTkxNV9yZXRpcmVfcmVxdWVzdHModm0tPmk5
MTUsIDApOworCiBzZWFyY2hfYWdhaW46CiAJYWN0aXZlID0gTlVMTDsKIAlJTklUX0xJU1RfSEVB
RCgmZXZpY3Rpb25fbGlzdCk7CkBAIC0yNjUsMTMgKzI2NSwxMyBAQCBpbnQgaTkxNV9nZW1fZXZp
Y3RfZm9yX25vZGUoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAKIAl0cmFjZV9pOTE1
X2dlbV9ldmljdF9ub2RlKHZtLCB0YXJnZXQsIGZsYWdzKTsKIAotCS8qIFJldGlyZSBiZWZvcmUg
d2Ugc2VhcmNoIHRoZSBhY3RpdmUgbGlzdC4gQWx0aG91Z2ggd2UgaGF2ZQorCS8qCisJICogUmV0
aXJlIGJlZm9yZSB3ZSBzZWFyY2ggdGhlIGFjdGl2ZSBsaXN0LiBBbHRob3VnaCB3ZSBoYXZlCiAJ
ICogcmVhc29uYWJsZSBhY2N1cmFjeSBpbiBvdXIgcmV0aXJlbWVudCBsaXN0cywgd2UgbWF5IGhh
dmUKIAkgKiBhIHN0cmF5IHBpbiAocHJldmVudGluZyBldmljdGlvbikgdGhhdCBjYW4gb25seSBi
ZSByZXNvbHZlZCBieQogCSAqIHJldGlyaW5nLgogCSAqLwotCWlmICghKGZsYWdzICYgUElOX05P
TkJMT0NLKSkKLQkJaTkxNV9yZXRpcmVfcmVxdWVzdHModm0tPmk5MTUpOworCWk5MTVfcmV0aXJl
X3JlcXVlc3RzKHZtLT5pOTE1LCAwKTsKIAogCWNoZWNrX2NvbG9yID0gdm0tPm1tLmNvbG9yX2Fk
anVzdDsKIAlpZiAoY2hlY2tfY29sb3IpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtX2d0dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMK
aW5kZXggOTQ4MmIzNDkwYTQ3Li5kMDM5NTY3NWIzM2EgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
Z2VtX2d0dC5jCkBAIC0yNTIwLDcgKzI1MjAsNyBAQCB2b2lkIGk5MTVfZ2VtX2d0dF9maW5pc2hf
cGFnZXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlzdHJ1Y3QgaTkxNV9nZ3R0
ICpnZ3R0ID0gJmRldl9wcml2LT5nZ3R0OwogCiAJaWYgKHVubGlrZWx5KGdndHQtPmRvX2lkbGVf
bWFwcykpIHsKLQkJaWYgKGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoZGV2X3ByaXYsIDAsIE1BWF9T
Q0hFRFVMRV9USU1FT1VUKSkgeworCQlpZiAoaTkxNV9yZXRpcmVfcmVxdWVzdHMoZGV2X3ByaXYs
IE1BWF9TQ0hFRFVMRV9USU1FT1VUKSkgewogCQkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gd2FpdCBm
b3IgaWRsZTsgVlQnZCBtYXkgaGFuZy5cbiIpOwogCQkJLyogV2FpdCBhIGJpdCwgaW4gaG9wZXMg
aXQgYXZvaWRzIHRoZSBoYW5nICovCiAJCQl1ZGVsYXkoMTApOwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3JlcXVlc3QuYwppbmRleCA0ZWNmYWUxNDMyNzYuLjdhYzAzNTg4YzgxMyAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9yZXF1ZXN0LmMKQEAgLTE0MjksNyArMTQyOSw3IEBAIGxvbmcgaTkxNV9yZXF1
ZXN0X3dhaXQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCiAJcmV0dXJuIHRpbWVvdXQ7CiB9CiAK
LWJvb2wgaTkxNV9yZXRpcmVfcmVxdWVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
Citsb25nIGk5MTVfcmV0aXJlX3JlcXVlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LCBsb25nIHRpbWVvdXQpCiB7CiAJc3RydWN0IGludGVsX2d0X3RpbWVsaW5lcyAqdGltZWxpbmVz
ID0gJmk5MTUtPmd0LnRpbWVsaW5lczsKIAlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsLCAqdG47
CkBAIC0xNDQ2LDYgKzE0NDYsMTggQEAgYm9vbCBpOTE1X3JldGlyZV9yZXF1ZXN0cyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkJdGwtPmFjdGl2ZV9jb3VudCsrOyAvKiBwaW4gdGhl
IGxpc3QgZWxlbWVudCAqLwogCQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZ0aW1lbGluZXMtPmxv
Y2ssIGZsYWdzKTsKIAorCQlpZiAodGltZW91dCA+IDApIHsKKwkJCXN0cnVjdCBkbWFfZmVuY2Ug
KmZlbmNlOworCisJCQlmZW5jZSA9IGk5MTVfYWN0aXZlX2ZlbmNlX2dldCgmdGwtPmxhc3RfcmVx
dWVzdCk7CisJCQlpZiAoZmVuY2UpIHsKKwkJCQl0aW1lb3V0ID0gZG1hX2ZlbmNlX3dhaXRfdGlt
ZW91dChmZW5jZSwKKwkJCQkJCQkJIHRydWUsCisJCQkJCQkJCSB0aW1lb3V0KTsKKwkJCQlkbWFf
ZmVuY2VfcHV0KGZlbmNlKTsKKwkJCX0KKwkJfQorCiAJCXJldGlyZV9yZXF1ZXN0cyh0bCk7CiAK
IAkJc3Bpbl9sb2NrX2lycXNhdmUoJnRpbWVsaW5lcy0+bG9jaywgZmxhZ3MpOwpAQCAtMTQ2OCw3
ICsxNDgwLDEwIEBAIGJvb2wgaTkxNV9yZXRpcmVfcmVxdWVzdHMoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCiAJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHRsLCB0biwgJmZyZWUsIGxp
bmspCiAJCV9faW50ZWxfdGltZWxpbmVfZnJlZSgmdGwtPmtyZWYpOwogCi0JcmV0dXJuICFsaXN0
X2VtcHR5KCZ0aW1lbGluZXMtPmFjdGl2ZV9saXN0KTsKKwlpZiAobGlzdF9lbXB0eSgmdGltZWxp
bmVzLT5hY3RpdmVfbGlzdCkpCisJCXJldHVybiAwOworCisJcmV0dXJuIHRpbWVvdXQ7CiB9CiAK
ICNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9TRUxGVEVTVCkKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9yZXF1ZXN0LmgKaW5kZXggNTdhMjE5M2M2NGQxLi4yYTVkNjgyYWE2YjEgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5oCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5oCkBAIC0zMTAsNyArMzEwLDYgQEAgbG9uZyBpOTE1X3Jl
cXVlc3Rfd2FpdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKICNkZWZpbmUgSTkxNV9XQUlUX0lO
VEVSUlVQVElCTEUJQklUKDApCiAjZGVmaW5lIEk5MTVfV0FJVF9QUklPUklUWQlCSVQoMSkgLyog
c21hbGwgcHJpb3JpdHkgYnVtcCBmb3IgdGhlIHJlcXVlc3QgKi8KICNkZWZpbmUgSTkxNV9XQUlU
X0FMTAkJQklUKDIpIC8qIHVzZWQgYnkgaTkxNV9nZW1fb2JqZWN0X3dhaXQoKSAqLwotI2RlZmlu
ZSBJOTE1X1dBSVRfRk9SX0lETEVfQk9PU1QgQklUKDMpCiAKIHN0YXRpYyBpbmxpbmUgYm9vbCBp
OTE1X3JlcXVlc3Rfc2lnbmFsZWQoY29uc3Qgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7CkBA
IC00NDAsNiArNDM5LDYgQEAgc3RhdGljIGlubGluZSBib29sIGk5MTVfcmVxdWVzdF9oYXNfbm9w
cmVlbXB0KGNvbnN0IHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCXJldHVybiB1bmxpa2VseShy
cS0+ZmxhZ3MgJiBJOTE1X1JFUVVFU1RfTk9QUkVFTVBUKTsKIH0KIAotYm9vbCBpOTE1X3JldGly
ZV9yZXF1ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSk7Citsb25nIGk5MTVfcmV0
aXJlX3JlcXVlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBsb25nIHRpbWVvdXQp
OwogCiAjZW5kaWYgLyogSTkxNV9SRVFVRVNUX0ggKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvc2VsZnRlc3RzL2lndF9mbHVzaF90ZXN0LmMKaW5kZXggMmE1ZmJlNDZlYTlmLi5lZDQ5NmJk
NmQ4NGYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1
c2hfdGVzdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hf
dGVzdC5jCkBAIC0xOCw4ICsxOCw3IEBAIGludCBpZ3RfZmx1c2hfdGVzdChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSkKIAogCWNvbmRfcmVzY2hlZCgpOwogCi0JaTkxNV9yZXRpcmVfcmVx
dWVzdHMoaTkxNSk7Ci0JaWYgKGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoaTkxNSwgMCwgSFogLyA1
KSA9PSAtRVRJTUUpIHsKKwlpZiAoaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShpOTE1LCBIWiAvIDUp
ID09IC1FVElNRSkgewogCQlwcl9lcnIoIiVwUyB0aW1lZCBvdXQsIGNhbmNlbGxpbmcgYWxsIGZ1
cnRoZXIgdGVzdGluZy5cbiIsCiAJCSAgICAgICBfX2J1aWx0aW5fcmV0dXJuX2FkZHJlc3MoMCkp
OwogCkBAIC0zMCw3ICsyOSw2IEBAIGludCBpZ3RfZmx1c2hfdGVzdChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIAkJaW50ZWxfZ3Rfc2V0X3dlZGdlZCgmaTkxNS0+Z3QpOwogCQlyZXQg
PSAtRUlPOwogCX0KLQlpOTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1KTsKIAogCXJldHVybiByZXQ7
CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2xpdmVf
dGVzdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9saXZlX3Rlc3QuYwpp
bmRleCAwNGE2Zjg4ZmRmNjQuLmVhZTkwZjk3ZGY2YyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9saXZlX3Rlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9zZWxmdGVzdHMvaWd0X2xpdmVfdGVzdC5jCkBAIC0yMyw5ICsyMyw3IEBAIGludCBpZ3Rf
bGl2ZV90ZXN0X2JlZ2luKHN0cnVjdCBpZ3RfbGl2ZV90ZXN0ICp0LAogCXQtPmZ1bmMgPSBmdW5j
OwogCXQtPm5hbWUgPSBuYW1lOwogCi0JZXJyID0gaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShpOTE1
LAotCQkJCSAgICAgSTkxNV9XQUlUX0lOVEVSUlVQVElCTEUsCi0JCQkJICAgICBNQVhfU0NIRURV
TEVfVElNRU9VVCk7CisJZXJyID0gaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShpOTE1LCBNQVhfU0NI
RURVTEVfVElNRU9VVCk7CiAJaWYgKGVycikgewogCQlwcl9lcnIoIiVzKCVzKTogZmFpbGVkIHRv
IGlkbGUgYmVmb3JlLCB3aXRoIGVycj0lZCEiLAogCQkgICAgICAgZnVuYywgbmFtZSwgZXJyKTsK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZp
Y2UuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYwpp
bmRleCAxOTU2MDA2YTBkNWIuLmUxODc4Yzk1MmRmYSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYwpAQCAtNDQsNyArNDQsNyBAQCB2b2lk
IG1vY2tfZGV2aWNlX2ZsdXNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCWRvIHsK
IAkJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpCiAJCQltb2NrX2VuZ2luZV9mbHVz
aChlbmdpbmUpOwotCX0gd2hpbGUgKGk5MTVfcmV0aXJlX3JlcXVlc3RzKGk5MTUpKTsKKwl9IHdo
aWxlIChpOTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1LCBNQVhfU0NIRURVTEVfVElNRU9VVCkpOwog
fQogCiBzdGF0aWMgdm9pZCBtb2NrX2RldmljZV9yZWxlYXNlKHN0cnVjdCBkcm1fZGV2aWNlICpk
ZXYpCi0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVs
LWdmeA==

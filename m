Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D97178FD24
	for <lists+intel-gfx@lfdr.de>; Fri, 16 Aug 2019 10:07:45 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 397C46EB35;
	Fri, 16 Aug 2019 08:07:43 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga02.intel.com (mga02.intel.com [134.134.136.20])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9ABCF6EB31
 for <intel-gfx@lists.freedesktop.org>; Fri, 16 Aug 2019 08:07:41 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga003.fm.intel.com ([10.253.24.29])
 by orsmga101.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 16 Aug 2019 01:06:25 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,391,1559545200"; d="scan'208";a="184851675"
Received: from miyoungj-mobl1.amr.corp.intel.com (HELO
 ldmartin-desk1.intel.com) ([10.254.105.68])
 by FMSMGA003.fm.intel.com with ESMTP; 16 Aug 2019 01:06:22 -0700
From: Lucas De Marchi <lucas.demarchi@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 16 Aug 2019 01:05:01 -0700
Message-Id: <20190816080503.28594-38-lucas.demarchi@intel.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190816080503.28594-1-lucas.demarchi@intel.com>
References: <20190816080503.28594-1-lucas.demarchi@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 37/39] drm/i915/tgl: Gen-12 render decompression
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Daniel Vetter <daniel.vetter@intel.com>,
 Dhinakaran Pandiyan <dhinakaran.pandiyan@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogRGhpbmFrYXJhbiBQYW5kaXlhbiA8ZGhpbmFrYXJhbi5wYW5kaXlhbkBpbnRlbC5jb20+
CgpHZW4tMTIgZGVjb21wcmVzc2lvbiBpcyBzdXBwb3J0ZWQgd2l0aCBZLXRpbGVkIG1haW4gc3Vy
ZmFjZS4gVGhlIENDUyBpcwpsaW5lYXIgYW5kIGhhcyA0IGJpdHMgb2YgZGF0YSBmb3IgZWFjaCBt
YWluIHN1cmZhY2UgY2FjaGUgbGluZSBwYWlyLCBhCnJhdGlvIG9mIDE6MjU2LiBHZW4tMTIgZGlz
cGxheSBkZWNvbXByZXNzaW9uIGlzIGluY29tcGF0aWJsZSB3aXRoIGJ1ZmZlcnMKY29tcHJlc3Nl
ZCBieSBlYXJsaWVyIEdQVXMsIHNvIG1ha2UgdXNlIG9mIGEgbmV3IG1vZGlmaWVyIHRvIGlkZW50
aWZ5Cmdlbi0xMiBjb21wcmVzc2lvbi4gQW5vdGhlciBub3RhYmxlIGNoYW5nZSBpcyB0aGF0IGRl
Y29tcHJlc3Npb24gaXMKc3VwcG9ydGVkIG9uIGFsbCBwbGFuZXMgZXhjZXB0IGN1cnNvciBhbmQg
b24gYWxsIHBpcGVzLiBUaGlzIHBhdGNoIGFkZHMKZGVjb21wcmVzc2lvbiBzdXBwb3J0IGZvciBb
QSxYXUJHUjg4OCBwaXhlbCBmb3JtYXRzLgoKQnNwZWM6IFJlbmRlciBEZWNvbXByZXNzaW9uICgx
ODQzNykKCkNjOiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29t
PgpDYzogUm9kcmlnbyBWaXZpIDxyb2RyaWdvLnZpdmlAaW50ZWwuY29tPgpDYzogRGFuaWVsIFZl
dHRlciA8ZGFuaWVsLnZldHRlckBpbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6IERoaW5ha2FyYW4g
UGFuZGl5YW4gPGRoaW5ha2FyYW4ucGFuZGl5YW5AaW50ZWwuY29tPgpTaWduZWQtb2ZmLWJ5OiBM
dWNhcyBEZSBNYXJjaGkgPGx1Y2FzLmRlbWFyY2hpQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyB8IDYzICsrKysrKysrKysrKysrKysr
LS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jICB8IDIzICsr
KystLS0KIDIgZmlsZXMgY2hhbmdlZCwgNzEgaW5zZXJ0aW9ucygrKSwgMTUgZGVsZXRpb25zKC0p
CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRleCA4
MWMxZDM1OWVkYjIuLjg5MDY3YTlmNGEzYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTE5MjgsNiArMTkyOCwxMCBAQCBpbnRlbF90aWxlX3dp
ZHRoX2J5dGVzKGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLCBpbnQgY29sb3JfcGxh
bmUpCiAJCWlmIChjb2xvcl9wbGFuZSA9PSAxKQogCQkJcmV0dXJuIDEyODsKIAkJLyogZmFsbCB0
aHJvdWdoICovCisJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1M6CisJ
CWlmIChjb2xvcl9wbGFuZSA9PSAxKQorCQkJcmV0dXJuIGNwcDsKKwkJLyogZmFsbCB0aHJvdWdo
ICovCiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRDoKIAkJaWYgKElTX0dFTihkZXZfcHJp
diwgMikgfHwgSEFTXzEyOF9CWVRFX1lfVElMSU5HKGRldl9wcml2KSkKIAkJCXJldHVybiAxMjg7
CkBAIC0yMDYxLDYgKzIwNjUsOCBAQCBzdGF0aWMgdW5zaWduZWQgaW50IGludGVsX3N1cmZfYWxp
Z25tZW50KGNvbnN0IHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAogCQlpZiAoSU5URUxfR0VO
KGRldl9wcml2KSA+PSA5KQogCQkJcmV0dXJuIDI1NiAqIDEwMjQ7CiAJCXJldHVybiAwOworCWNh
c2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTOgorCQlyZXR1cm4gNCAqIDQg
KiAxMDI0OwogCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfQ0NTOgogCWNhc2UgSTkxNV9G
T1JNQVRfTU9EX1lmX1RJTEVEX0NDUzoKIAljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEOgpA
QCAtMjI1OCw3ICsyMjY0LDggQEAgc3RhdGljIHUzMiBpbnRlbF9hZGp1c3RfdGlsZV9vZmZzZXQo
aW50ICp4LCBpbnQgKnksCiAKIHN0YXRpYyBib29sIGlzX3N1cmZhY2VfbGluZWFyKHU2NCBtb2Rp
ZmllciwgaW50IGNvbG9yX3BsYW5lKQogewotCXJldHVybiBtb2RpZmllciA9PSBEUk1fRk9STUFU
X01PRF9MSU5FQVI7CisJcmV0dXJuIG1vZGlmaWVyID09IERSTV9GT1JNQVRfTU9EX0xJTkVBUiB8
fAorCSAgICAgICAobW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNf
Q0NTICYmIGNvbG9yX3BsYW5lID09IDEpOwogfQogCiBzdGF0aWMgdTMyIGludGVsX2FkanVzdF9h
bGlnbmVkX29mZnNldChpbnQgKngsIGludCAqeSwKQEAgLTI0NDUsNiArMjQ1Miw3IEBAIHN0YXRp
YyB1bnNpZ25lZCBpbnQgaW50ZWxfZmJfbW9kaWZpZXJfdG9fdGlsaW5nKHU2NCBmYl9tb2RpZmll
cikKIAkJcmV0dXJuIEk5MTVfVElMSU5HX1g7CiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxF
RDoKIAljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUzoKKwljYXNlIEk5MTVfRk9STUFU
X01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUzoKIAkJcmV0dXJuIEk5MTVfVElMSU5HX1k7CiAJZGVm
YXVsdDoKIAkJcmV0dXJuIEk5MTVfVElMSU5HX05PTkU7CkBAIC0yNDY1LDcgKzI0NzMsNyBAQCBz
dGF0aWMgdW5zaWduZWQgaW50IGludGVsX2ZiX21vZGlmaWVyX3RvX3RpbGluZyh1NjQgZmJfbW9k
aWZpZXIpCiAgKiB1cyBhIHJhdGlvIG9mIG9uZSBieXRlIGluIHRoZSBDQ1MgZm9yIGVhY2ggOHgx
NiBwaXhlbHMgaW4gdGhlCiAgKiBtYWluIHN1cmZhY2UuCiAgKi8KLXN0YXRpYyBjb25zdCBzdHJ1
Y3QgZHJtX2Zvcm1hdF9pbmZvIGNjc19mb3JtYXRzW10gPSB7CitzdGF0aWMgY29uc3Qgc3RydWN0
IGRybV9mb3JtYXRfaW5mbyBza2xfY2NzX2Zvcm1hdHNbXSA9IHsKIAl7IC5mb3JtYXQgPSBEUk1f
Rk9STUFUX1hSR0I4ODg4LCAuZGVwdGggPSAyNCwgLm51bV9wbGFuZXMgPSAyLAogCSAgLmNwcCA9
IHsgNCwgMSwgfSwgLmhzdWIgPSA4LCAudnN1YiA9IDE2LCB9LAogCXsgLmZvcm1hdCA9IERSTV9G
T1JNQVRfWEJHUjg4ODgsIC5kZXB0aCA9IDI0LCAubnVtX3BsYW5lcyA9IDIsCkBAIC0yNDc2LDYg
KzI0ODQsMjQgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBkcm1fZm9ybWF0X2luZm8gY2NzX2Zvcm1h
dHNbXSA9IHsKIAkgIC5jcHAgPSB7IDQsIDEsIH0sIC5oc3ViID0gOCwgLnZzdWIgPSAxNiwgLmhh
c19hbHBoYSA9IHRydWUsIH0sCiB9OwogCisvKgorICogR2VuLTEyIGNvbXByZXNzaW9uIHVzZXMg
NCBiaXRzIG9mIENDUyBkYXRhIGZvciBlYWNoIGNhY2hlIGxpbmUgcGFpciBpbiB0aGUKKyAqIG1h
aW4gc3VyZmFjZS4gQW5kIGVhY2ggNjRCIENDUyBjYWNoZSBsaW5lIHJlcHJlc2VudHMgYW4gYXJl
YSBvZiA0eDEgWS10aWxlcworICogaW4gdGhlIG1haW4gc3VyZmFjZS4gV2l0aCA0IGJ5dGUgcGl4
ZWxzIGFuZCBlYWNoIFktdGlsZSBoYXZpbmcgZGltZW5zaW9ucyBvZgorICogMzJ4MzIgcGl4ZWxz
LCB0aGUgcmF0aW8gdHVybnMgb3V0IHRvIDFCIGluIHRoZSBDQ1MgZm9yIGV2ZXJ5IDIgeCAzMiBw
aXhlbHMgaW4KKyAqIHRoZSBtYWluIHN1cmZhY2UuCisgKi8KK3N0YXRpYyBjb25zdCBzdHJ1Y3Qg
ZHJtX2Zvcm1hdF9pbmZvIGdlbjEyX2Njc19mb3JtYXRzW10gPSB7CisJeyAuZm9ybWF0ID0gRFJN
X0ZPUk1BVF9YUkdCODg4OCwgLmRlcHRoID0gMjQsIC5udW1fcGxhbmVzID0gMiwKKwkgIC5jcHAg
PSB7IDQsIDEsIH0sIC5oc3ViID0gMiwgLnZzdWIgPSAzMiwgfSwKKwl7IC5mb3JtYXQgPSBEUk1f
Rk9STUFUX1hCR1I4ODg4LCAuZGVwdGggPSAyNCwgLm51bV9wbGFuZXMgPSAyLAorCSAgLmNwcCA9
IHsgNCwgMSwgfSwgLmhzdWIgPSAyLCAudnN1YiA9IDMyLCB9LAorCXsgLmZvcm1hdCA9IERSTV9G
T1JNQVRfQVJHQjg4ODgsIC5kZXB0aCA9IDMyLCAubnVtX3BsYW5lcyA9IDIsCisJICAuY3BwID0g
eyA0LCAxLCB9LCAuaHN1YiA9IDIsIC52c3ViID0gMzIsIC5oYXNfYWxwaGEgPSB0cnVlIH0sCisJ
eyAuZm9ybWF0ID0gRFJNX0ZPUk1BVF9BQkdSODg4OCwgLmRlcHRoID0gMzIsIC5udW1fcGxhbmVz
ID0gMiwKKwkgIC5jcHAgPSB7IDQsIDEsIH0sIC5oc3ViID0gMiwgLnZzdWIgPSAzMiwgLmhhc19h
bHBoYSA9IHRydWUgfSwKK307CisKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZv
ICoKIGxvb2t1cF9mb3JtYXRfaW5mbyhjb25zdCBzdHJ1Y3QgZHJtX2Zvcm1hdF9pbmZvIGZvcm1h
dHNbXSwKIAkJICAgaW50IG51bV9mb3JtYXRzLCB1MzIgZm9ybWF0KQpAQCAtMjQ5Niw4ICsyNTIy
LDEyIEBAIGludGVsX2dldF9mb3JtYXRfaW5mbyhjb25zdCBzdHJ1Y3QgZHJtX21vZGVfZmJfY21k
MiAqY21kKQogCXN3aXRjaCAoY21kLT5tb2RpZmllclswXSkgewogCWNhc2UgSTkxNV9GT1JNQVRf
TU9EX1lfVElMRURfQ0NTOgogCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEX0NDUzoKLQkJ
cmV0dXJuIGxvb2t1cF9mb3JtYXRfaW5mbyhjY3NfZm9ybWF0cywKLQkJCQkJICBBUlJBWV9TSVpF
KGNjc19mb3JtYXRzKSwKKwkJcmV0dXJuIGxvb2t1cF9mb3JtYXRfaW5mbyhza2xfY2NzX2Zvcm1h
dHMsCisJCQkJCSAgQVJSQVlfU0laRShza2xfY2NzX2Zvcm1hdHMpLAorCQkJCQkgIGNtZC0+cGl4
ZWxfZm9ybWF0KTsKKwljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUzoK
KwkJcmV0dXJuIGxvb2t1cF9mb3JtYXRfaW5mbyhnZW4xMl9jY3NfZm9ybWF0cywKKwkJCQkJICBB
UlJBWV9TSVpFKGdlbjEyX2Njc19mb3JtYXRzKSwKIAkJCQkJICBjbWQtPnBpeGVsX2Zvcm1hdCk7
CiAJZGVmYXVsdDoKIAkJcmV0dXJuIE5VTEw7CkBAIC0yNTA2LDcgKzI1MzYsOCBAQCBpbnRlbF9n
ZXRfZm9ybWF0X2luZm8oY29uc3Qgc3RydWN0IGRybV9tb2RlX2ZiX2NtZDIgKmNtZCkKIAogYm9v
bCBpc19jY3NfbW9kaWZpZXIodTY0IG1vZGlmaWVyKQogewotCXJldHVybiBtb2RpZmllciA9PSBJ
OTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9DQ1MgfHwKKwlyZXR1cm4gbW9kaWZpZXIgPT0gSTkxNV9G
T1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTIHx8CisJICAgICAgIG1vZGlmaWVyID09IEk5
MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUyB8fAogCSAgICAgICBtb2RpZmllciA9PSBJOTE1X0ZP
Uk1BVF9NT0RfWWZfVElMRURfQ0NTOwogfQogCkBAIC0yNjc1LDcgKzI3MDYsMTMgQEAgaW50ZWxf
ZmlsbF9mYl9pbmZvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCWludCBt
YWluX3gsIG1haW5feTsKIAkJCWludCBjY3NfeCwgY2NzX3k7CiAKLQkJCWludGVsX3RpbGVfZGlt
cyhmYiwgaSwgJnRpbGVfd2lkdGgsICZ0aWxlX2hlaWdodCk7CisJCQlpZiAoIWlzX3N1cmZhY2Vf
bGluZWFyKGZiLT5tb2RpZmllciwgaSkpIHsKKwkJCQlpbnRlbF90aWxlX2RpbXMoZmIsIGksICZ0
aWxlX3dpZHRoLCAmdGlsZV9oZWlnaHQpOworCQkJfSBlbHNlIHsKKwkJCQl0aWxlX3dpZHRoID0g
NjQvY3BwOworCQkJCXRpbGVfaGVpZ2h0ID0gMTsKKwkJCX0KKwogCQkJdGlsZV93aWR0aCAqPSBo
c3ViOwogCQkJdGlsZV9oZWlnaHQgKj0gdnN1YjsKIApAQCAtNDA2NSw2ICs0MTAyLDggQEAgc3Rh
dGljIHUzMiBza2xfcGxhbmVfY3RsX3RpbGluZyh1NjQgZmJfbW9kaWZpZXIpCiAJY2FzZSBJOTE1
X0ZPUk1BVF9NT0RfWV9USUxFRDoKIAkJcmV0dXJuIFBMQU5FX0NUTF9USUxFRF9ZOwogCWNhc2Ug
STkxNV9GT1JNQVRfTU9EX1lfVElMRURfQ0NTOgorCQkvKiBmYWxsIHRocm91Z2ggKi8KKwljYXNl
IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUzoKIAkJcmV0dXJuIFBMQU5FX0NU
TF9USUxFRF9ZIHwgUExBTkVfQ1RMX1JFTkRFUl9ERUNPTVBSRVNTSU9OX0VOQUJMRTsKIAljYXNl
IEk5MTVfRk9STUFUX01PRF9ZZl9USUxFRDoKIAkJcmV0dXJuIFBMQU5FX0NUTF9USUxFRF9ZRjsK
QEAgLTk4NDQsNyArOTg4Myw5IEBAIHNreWxha2VfZ2V0X2luaXRpYWxfcGxhbmVfY29uZmlnKHN0
cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCWNhc2UgUExBTkVfQ1RMX1RJTEVEX1k6CiAJCXBsYW5l
X2NvbmZpZy0+dGlsaW5nID0gSTkxNV9USUxJTkdfWTsKIAkJaWYgKHZhbCAmIFBMQU5FX0NUTF9S
RU5ERVJfREVDT01QUkVTU0lPTl9FTkFCTEUpCi0JCQlmYi0+bW9kaWZpZXIgPSBJOTE1X0ZPUk1B
VF9NT0RfWV9USUxFRF9DQ1M7CisJCQlmYi0+bW9kaWZpZXIgPSBJTlRFTF9HRU4oZGV2X3ByaXYp
ID49IDEyID8KKwkJCQlJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9HRU4xMl9SQ19DQ1MgOgorCQkJ
CUk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0NDUzsKIAkJZWxzZQogCQkJZmItPm1vZGlmaWVyID0g
STkxNV9GT1JNQVRfTU9EX1lfVElMRUQ7CiAJCWJyZWFrOwpAQCAtMTU3MTYsNiArMTU3NTcsMTQg
QEAgc3RhdGljIGludCBpbnRlbF9mcmFtZWJ1ZmZlcl9pbml0KHN0cnVjdCBpbnRlbF9mcmFtZWJ1
ZmZlciAqaW50ZWxfZmIsCiAJCSAgICBpc19jY3NfbW9kaWZpZXIoZmItPm1vZGlmaWVyKSkKIAkJ
CXN0cmlkZV9hbGlnbm1lbnQgKj0gNDsKIAorCQkvKgorCQkgKiBUaGUgbWFpbiBzdXJmYWNlIHBp
dGNoIG11c3QgYmUgcGFkZWQgdG8gYSBtdWx0aXBsZSBvZiBmb3VyCisJCSAqIHRpbGUgd2lkdGhz
LgorCQkgKi8KKwkJaWYgKGZiLT5tb2RpZmllciA9PSBJOTE1X0ZPUk1BVF9NT0RfWV9USUxFRF9H
RU4xMl9SQ19DQ1MgJiYKKwkJICAgIGkgPT0gMCkKKwkJCXN0cmlkZV9hbGlnbm1lbnQgKj0gNDsK
KwogCQlpZiAoZmItPnBpdGNoZXNbaV0gJiAoc3RyaWRlX2FsaWdubWVudCAtIDEpKSB7CiAJCQlE
Uk1fREVCVUdfS01TKCJwbGFuZSAlZCBwaXRjaCAoJWQpIG11c3QgYmUgYXQgbGVhc3QgJXUgYnl0
ZSBhbGlnbmVkXG4iLAogCQkJCSAgICAgIGksIGZiLT5waXRjaGVzW2ldLCBzdHJpZGVfYWxpZ25t
ZW50KTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfc3By
aXRlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCmluZGV4
IDcxZGFlM2MyZjlkYi4uNzNkMzIwMTdiZTg5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX3Nwcml0ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfc3ByaXRlLmMKQEAgLTU0Nyw2ICs1NDcsNyBAQCBza2xfcHJvZ3JhbV9wbGFu
ZShzdHJ1Y3QgaW50ZWxfcGxhbmUgKnBsYW5lLAogCWNvbnN0IHN0cnVjdCBkcm1faW50ZWxfc3By
aXRlX2NvbG9ya2V5ICprZXkgPSAmcGxhbmVfc3RhdGUtPmNrZXk7CiAJdTMyIHN1cmZfYWRkciA9
IHBsYW5lX3N0YXRlLT5jb2xvcl9wbGFuZVtjb2xvcl9wbGFuZV0ub2Zmc2V0OwogCXUzMiBzdHJp
ZGUgPSBza2xfcGxhbmVfc3RyaWRlKHBsYW5lX3N0YXRlLCBjb2xvcl9wbGFuZSk7CisJdTMyIGF1
eF9kaXN0ID0gcGxhbmVfc3RhdGUtPmNvbG9yX3BsYW5lWzFdLm9mZnNldCAtIHN1cmZfYWRkcjsK
IAl1MzIgYXV4X3N0cmlkZSA9IHNrbF9wbGFuZV9zdHJpZGUocGxhbmVfc3RhdGUsIDEpOwogCWlu
dCBjcnRjX3ggPSBwbGFuZV9zdGF0ZS0+YmFzZS5kc3QueDE7CiAJaW50IGNydGNfeSA9IHBsYW5l
X3N0YXRlLT5iYXNlLmRzdC55MTsKQEAgLTU4OCw4ICs1ODksMTAgQEAgc2tsX3Byb2dyYW1fcGxh
bmUoc3RydWN0IGludGVsX3BsYW5lICpwbGFuZSwKIAlJOTE1X1dSSVRFX0ZXKFBMQU5FX1NUUklE
RShwaXBlLCBwbGFuZV9pZCksIHN0cmlkZSk7CiAJSTkxNV9XUklURV9GVyhQTEFORV9QT1MocGlw
ZSwgcGxhbmVfaWQpLCAoY3J0Y195IDw8IDE2KSB8IGNydGNfeCk7CiAJSTkxNV9XUklURV9GVyhQ
TEFORV9TSVpFKHBpcGUsIHBsYW5lX2lkKSwgKHNyY19oIDw8IDE2KSB8IHNyY193KTsKLQlJOTE1
X1dSSVRFX0ZXKFBMQU5FX0FVWF9ESVNUKHBpcGUsIHBsYW5lX2lkKSwKLQkJICAgICAgKHBsYW5l
X3N0YXRlLT5jb2xvcl9wbGFuZVsxXS5vZmZzZXQgLSBzdXJmX2FkZHIpIHwgYXV4X3N0cmlkZSk7
CisKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDEyKQorCQlhdXhfZGlzdCB8PSBhdXhfc3Ry
aWRlOworCUk5MTVfV1JJVEVfRlcoUExBTkVfQVVYX0RJU1QocGlwZSwgcGxhbmVfaWQpLCBhdXhf
ZGlzdCk7CiAKIAlpZiAoaWNsX2lzX2hkcl9wbGFuZShkZXZfcHJpdiwgcGxhbmVfaWQpKSB7CiAJ
CXUzMiBjdXNfY3RsID0gMDsKQEAgLTE3NDUsNyArMTc0OCw4IEBAIHN0YXRpYyBpbnQgc2tsX3Bs
YW5lX2NoZWNrX2ZiKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlLAog
CSAgICAoZmItPm1vZGlmaWVyID09IEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEIHx8CiAJICAgICBm
Yi0+bW9kaWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEIHx8CiAJICAgICBmYi0+bW9k
aWZpZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfQ0NTIHx8Ci0JICAgICBmYi0+bW9kaWZp
ZXIgPT0gSTkxNV9GT1JNQVRfTU9EX1lmX1RJTEVEX0NDUykpIHsKKwkgICAgIGZiLT5tb2RpZmll
ciA9PSBJOTE1X0ZPUk1BVF9NT0RfWWZfVElMRURfQ0NTIHx8CisJICAgICBmYi0+bW9kaWZpZXIg
PT0gSTkxNV9GT1JNQVRfTU9EX1lfVElMRURfR0VOMTJfUkNfQ0NTKSkgewogCQlEUk1fREVCVUdf
S01TKCJZL1lmIHRpbGluZyBub3Qgc3VwcG9ydGVkIGluIElGLUlEIG1vZGVcbiIpOwogCQlyZXR1
cm4gLUVJTlZBTDsKIAl9CkBAIC0yMTU3LDcgKzIxNjEsOCBAQCBzdGF0aWMgY29uc3QgdTY0IHNr
bF9wbGFuZV9mb3JtYXRfbW9kaWZpZXJzX2Njc1tdID0gewogCURSTV9GT1JNQVRfTU9EX0lOVkFM
SUQKIH07CiAKLXN0YXRpYyBjb25zdCB1NjQgZ2VuMTJfcGxhbmVfZm9ybWF0X21vZGlmaWVyc19u
b2Njc1tdID0geworc3RhdGljIGNvbnN0IHU2NCBnZW4xMl9wbGFuZV9mb3JtYXRfbW9kaWZpZXJz
X2Njc1tdID0geworCUk5MTVfRk9STUFUX01PRF9ZX1RJTEVEX0dFTjEyX1JDX0NDUywKIAlJOTE1
X0ZPUk1BVF9NT0RfWV9USUxFRCwKIAlJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRCwKIAlEUk1fRk9S
TUFUX01PRF9MSU5FQVIsCkBAIC0yMzE5LDYgKzIzMjQsNyBAQCBzdGF0aWMgYm9vbCBnZW4xMl9w
bGFuZV9mb3JtYXRfbW9kX3N1cHBvcnRlZChzdHJ1Y3QgZHJtX3BsYW5lICpfcGxhbmUsCiAJY2Fz
ZSBEUk1fRk9STUFUX01PRF9MSU5FQVI6CiAJY2FzZSBJOTE1X0ZPUk1BVF9NT0RfWF9USUxFRDoK
IAljYXNlIEk5MTVfRk9STUFUX01PRF9ZX1RJTEVEOgorCWNhc2UgSTkxNV9GT1JNQVRfTU9EX1lf
VElMRURfR0VOMTJfUkNfQ0NTOgogCQlicmVhazsKIAlkZWZhdWx0OgogCQlyZXR1cm4gZmFsc2U7
CkBAIC0yMzI5LDYgKzIzMzUsOSBAQCBzdGF0aWMgYm9vbCBnZW4xMl9wbGFuZV9mb3JtYXRfbW9k
X3N1cHBvcnRlZChzdHJ1Y3QgZHJtX3BsYW5lICpfcGxhbmUsCiAJY2FzZSBEUk1fRk9STUFUX1hC
R1I4ODg4OgogCWNhc2UgRFJNX0ZPUk1BVF9BUkdCODg4ODoKIAljYXNlIERSTV9GT1JNQVRfQUJH
Ujg4ODg6CisJCWlmIChpc19jY3NfbW9kaWZpZXIobW9kaWZpZXIpKQorCQkJcmV0dXJuIHRydWU7
CisJCS8qIGZhbGwgdGhyb3VnaCAqLwogCWNhc2UgRFJNX0ZPUk1BVF9SR0I1NjU6CiAJY2FzZSBE
Uk1fRk9STUFUX1hSR0IyMTAxMDEwOgogCWNhc2UgRFJNX0ZPUk1BVF9YQkdSMjEwMTAxMDoKQEAg
LTI1MjQsMTMgKzI1MzMsMTEgQEAgc2tsX3VuaXZlcnNhbF9wbGFuZV9jcmVhdGUoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCQlmb3JtYXRzID0gc2tsX2dldF9wbGFuZV9mb3Jt
YXRzKGRldl9wcml2LCBwaXBlLAogCQkJCQkJcGxhbmVfaWQsICZudW1fZm9ybWF0cyk7CiAKKwlw
bGFuZS0+aGFzX2NjcyA9IHNrbF9wbGFuZV9oYXNfY2NzKGRldl9wcml2LCBwaXBlLCBwbGFuZV9p
ZCk7CiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpIHsKLQkJLyogVE9ETzogSW1wbGVt
ZW50IHN1cHBvcnQgZm9yIGdlbi0xMiBDQ1MgbW9kaWZpZXJzICovCi0JCXBsYW5lLT5oYXNfY2Nz
ID0gZmFsc2U7Ci0JCW1vZGlmaWVycyA9IGdlbjEyX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfbm9j
Y3M7CisJCW1vZGlmaWVycyA9IGdlbjEyX3BsYW5lX2Zvcm1hdF9tb2RpZmllcnNfY2NzOwogCQlw
bGFuZV9mdW5jcyA9ICZnZW4xMl9wbGFuZV9mdW5jczsKIAl9IGVsc2UgewotCQlwbGFuZS0+aGFz
X2NjcyA9IHNrbF9wbGFuZV9oYXNfY2NzKGRldl9wcml2LCBwaXBlLCBwbGFuZV9pZCk7CiAJCWlm
IChwbGFuZS0+aGFzX2NjcykKIAkJCW1vZGlmaWVycyA9IHNrbF9wbGFuZV9mb3JtYXRfbW9kaWZp
ZXJzX2NjczsKIAkJZWxzZQotLSAKMi4yMS4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0
cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9s
aXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3985B883F5
	for <lists+intel-gfx@lfdr.de>; Fri,  9 Aug 2019 22:29:35 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3DA1D6EE9C;
	Fri,  9 Aug 2019 20:29:32 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga03.intel.com (mga03.intel.com [134.134.136.65])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3629F6EE99
 for <intel-gfx@lists.freedesktop.org>; Fri,  9 Aug 2019 20:29:29 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga002.fm.intel.com ([10.253.24.26])
 by orsmga103.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 09 Aug 2019 13:29:28 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,366,1559545200"; d="scan'208";a="204035011"
Received: from jmath3-mobl1.ger.corp.intel.com (HELO
 mwahaha-bdw.ger.corp.intel.com) ([10.252.5.86])
 by fmsmga002.fm.intel.com with ESMTP; 09 Aug 2019 13:29:27 -0700
From: Matthew Auld <matthew.auld@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  9 Aug 2019 21:29:24 +0100
Message-Id: <20190809202926.14545-2-matthew.auld@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190809202926.14545-1-matthew.auld@intel.com>
References: <20190809202926.14545-1-matthew.auld@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 1/3] drm/i915: buddy allocator
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U2ltcGxlIGJ1ZGR5IGFsbG9jYXRvci4gV2Ugd2FudCB0byBhbGxvY2F0ZSBwcm9wZXJseSBhbGln
bmVkCnBvd2VyLW9mLXR3byBibG9ja3MgdG8gcHJvbW90ZSB1c2FnZSBvZiBodWdlLXBhZ2VzIGZv
ciB0aGUgR1RULCBzbyA2NEssCjJNIGFuZCBwb3NzaWJseSBldmVuIDFHLiBXaGlsZSB3ZSBkbyBz
dXBwb3J0IGFsbG9jYXRpbmcgc3R1ZmYgYXQgYQpzcGVjaWZpYyBvZmZzZXQsIGl0IGlzIG1vcmUg
aW50ZW5kZWQgZm9yIHByZWFsbG9jYXRpbmcgcG9ydGlvbnMgb2YgdGhlCmFkZHJlc3Mgc3BhY2Us
IHNheSBmb3IgYW4gaW5pdGlhbCBmcmFtZWJ1ZmZlciwgZm9yIG90aGVyIHVzZXMgZHJtX21tIGlz
CnByb2JhYmx5IGEgbXVjaCBiZXR0ZXIgZml0LiBBbnl3YXksIGhvcGVmdWxseSB0aGlzIGNhbiBh
bGwgYmUgdGhyb3duCmF3YXkgaWYgd2UgZXZlbnR1YWxseSBtb3ZlIHRvIGhhdmluZyB0aGUgY29y
ZSBNTSBtYW5hZ2UgZGV2aWNlIG1lbW9yeS4KClNpZ25lZC1vZmYtYnk6IE1hdHRoZXcgQXVsZCA8
bWF0dGhldy5hdWxkQGludGVsLmNvbT4KQ2M6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2ls
c29uLmNvLnVrPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlICAgICAgICAgICAg
ICAgICB8ICAgMSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2J1ZGR5LmMgICAgICAgICAg
ICAgfCA0MzMgKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYnVkZHkuaCAg
ICAgICAgICAgICB8IDEyNiArKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2xvYmFscy5j
ICAgICAgICAgICB8ICAgMSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dsb2JhbHMuaCAg
ICAgICAgICAgfCAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfYnVk
ZHkuYyAgIHwgNzE5ICsrKysrKysrKysrKysrKysrKwogLi4uL2RybS9pOTE1L3NlbGZ0ZXN0cy9p
OTE1X21vY2tfc2VsZnRlc3RzLmggIHwgICAxICsKIDcgZmlsZXMgY2hhbmdlZCwgMTI4MiBpbnNl
cnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9i
dWRkeS5jCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9idWRk
eS5oCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5
MTVfYnVkZHkuYwoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKaW5kZXggZDNjYTQ2ZGM1NGFlLi4zOTYyZDk3
MjhkZDcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlCkBAIC0xMjYsNiArMTI2LDcgQEAgZ2VtLXkgKz0g
XAogaTkxNS15ICs9IFwKIAkgICQoZ2VtLXkpIFwKIAkgIGk5MTVfYWN0aXZlLm8gXAorCSAgaTkx
NV9idWRkeS5vIFwKIAkgIGk5MTVfY21kX3BhcnNlci5vIFwKIAkgIGk5MTVfZ2VtX2V2aWN0Lm8g
XAogCSAgaTkxNV9nZW1fZmVuY2VfcmVnLm8gXApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9idWRkeS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9idWRkeS5jCm5l
dyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uZTMwMzllMTI3M2VmCi0tLSAv
ZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9idWRkeS5jCkBAIC0wLDAg
KzEsNDMzIEBACisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUCisvKgorICogQ29weXJp
Z2h0IMKpIDIwMTkgSW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaW5jbHVkZSA8bGludXgvc2xh
Yi5oPgorCisjaW5jbHVkZSAiaTkxNV9idWRkeS5oIgorCisjaW5jbHVkZSAiaTkxNV9nZW0uaCIK
KyNpbmNsdWRlICJpOTE1X2dsb2JhbHMuaCIKKyNpbmNsdWRlICJpOTE1X3V0aWxzLmgiCisKK3N0
YXRpYyBzdHJ1Y3QgaTkxNV9nbG9iYWxfYmxvY2sgeworCXN0cnVjdCBpOTE1X2dsb2JhbCBiYXNl
OworCXN0cnVjdCBrbWVtX2NhY2hlICpzbGFiX2Jsb2NrczsKK30gZ2xvYmFsOworCitzdGF0aWMg
dm9pZCBpOTE1X2dsb2JhbF9idWRkeV9zaHJpbmsodm9pZCkKK3sKKwlrbWVtX2NhY2hlX3Nocmlu
ayhnbG9iYWwuc2xhYl9ibG9ja3MpOworfQorCitzdGF0aWMgdm9pZCBpOTE1X2dsb2JhbF9idWRk
eV9leGl0KHZvaWQpCit7CisJa21lbV9jYWNoZV9kZXN0cm95KGdsb2JhbC5zbGFiX2Jsb2Nrcyk7
Cit9CisKK3N0YXRpYyBzdHJ1Y3QgaTkxNV9nbG9iYWxfYmxvY2sgZ2xvYmFsID0geyB7CisJLnNo
cmluayA9IGk5MTVfZ2xvYmFsX2J1ZGR5X3NocmluaywKKwkuZXhpdCA9IGk5MTVfZ2xvYmFsX2J1
ZGR5X2V4aXQsCit9IH07CisKK2ludCBfX2luaXQgaTkxNV9nbG9iYWxfYnVkZHlfaW5pdCh2b2lk
KQoreworCWdsb2JhbC5zbGFiX2Jsb2NrcyA9IEtNRU1fQ0FDSEUoaTkxNV9idWRkeV9ibG9jaywg
U0xBQl9IV0NBQ0hFX0FMSUdOKTsKKwlpZiAoIWdsb2JhbC5zbGFiX2Jsb2NrcykKKwkJcmV0dXJu
IC1FTk9NRU07CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIHN0cnVjdCBpOTE1X2J1ZGR5X2Js
b2NrICppOTE1X2Jsb2NrX2FsbG9jKHN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpwYXJlbnQsCisJ
CQkJCQkgdW5zaWduZWQgaW50IG9yZGVyLAorCQkJCQkJIHU2NCBvZmZzZXQpCit7CisJc3RydWN0
IGk5MTVfYnVkZHlfYmxvY2sgKmJsb2NrOworCisJYmxvY2sgPSBrbWVtX2NhY2hlX3phbGxvYyhn
bG9iYWwuc2xhYl9ibG9ja3MsIEdGUF9LRVJORUwpOworCWlmICghYmxvY2spCisJCXJldHVybiBO
VUxMOworCisJYmxvY2stPmhlYWRlciA9IG9mZnNldDsKKwlibG9jay0+aGVhZGVyIHw9IG9yZGVy
OworCWJsb2NrLT5wYXJlbnQgPSBwYXJlbnQ7CisKKwlyZXR1cm4gYmxvY2s7Cit9CisKK3N0YXRp
YyB2b2lkIGk5MTVfYmxvY2tfZnJlZShzdHJ1Y3QgaTkxNV9idWRkeV9ibG9jayAqYmxvY2spCit7
CisJa21lbV9jYWNoZV9mcmVlKGdsb2JhbC5zbGFiX2Jsb2NrcywgYmxvY2spOworfQorCitzdGF0
aWMgdm9pZCBtYXJrX2FsbG9jYXRlZChzdHJ1Y3QgaTkxNV9idWRkeV9ibG9jayAqYmxvY2spCit7
CisJYmxvY2stPmhlYWRlciAmPSB+STkxNV9CVUREWV9IRUFERVJfU1RBVEU7CisJYmxvY2stPmhl
YWRlciB8PSBJOTE1X0JVRERZX0FMTE9DQVRFRDsKKworCWxpc3RfZGVsKCZibG9jay0+bGluayk7
Cit9CisKK3N0YXRpYyB2b2lkIG1hcmtfZnJlZShzdHJ1Y3QgaTkxNV9idWRkeV9tbSAqbW0sCisJ
CSAgICAgIHN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpibG9jaykKK3sKKwlibG9jay0+aGVhZGVy
ICY9IH5JOTE1X0JVRERZX0hFQURFUl9TVEFURTsKKwlibG9jay0+aGVhZGVyIHw9IEk5MTVfQlVE
RFlfRlJFRTsKKworCWxpc3RfYWRkKCZibG9jay0+bGluaywKKwkJICZtbS0+ZnJlZV9saXN0W2k5
MTVfYnVkZHlfYmxvY2tfb3JkZXIoYmxvY2spXSk7Cit9CisKK3N0YXRpYyB2b2lkIG1hcmtfc3Bs
aXQoc3RydWN0IGk5MTVfYnVkZHlfYmxvY2sgKmJsb2NrKQoreworCWJsb2NrLT5oZWFkZXIgJj0g
fkk5MTVfQlVERFlfSEVBREVSX1NUQVRFOworCWJsb2NrLT5oZWFkZXIgfD0gSTkxNV9CVUREWV9T
UExJVDsKKworCWxpc3RfZGVsKCZibG9jay0+bGluayk7Cit9CisKK2ludCBpOTE1X2J1ZGR5X2lu
aXQoc3RydWN0IGk5MTVfYnVkZHlfbW0gKm1tLCB1NjQgc2l6ZSwgdTY0IGNodW5rX3NpemUpCit7
CisJdW5zaWduZWQgaW50IGk7CisJdTY0IG9mZnNldDsKKworCWlmIChzaXplIDwgY2h1bmtfc2l6
ZSkKKwkJcmV0dXJuIC1FSU5WQUw7CisKKwlpZiAoY2h1bmtfc2l6ZSA8IFBBR0VfU0laRSkKKwkJ
cmV0dXJuIC1FSU5WQUw7CisKKwlpZiAoIWlzX3Bvd2VyX29mXzIoY2h1bmtfc2l6ZSkpCisJCXJl
dHVybiAtRUlOVkFMOworCisJc2l6ZSA9IHJvdW5kX2Rvd24oc2l6ZSwgY2h1bmtfc2l6ZSk7CisK
KwltbS0+c2l6ZSA9IHNpemU7CisJbW0tPmNodW5rX3NpemUgPSBjaHVua19zaXplOworCW1tLT5t
YXhfb3JkZXIgPSBpbG9nMihzaXplKSAtIGlsb2cyKGNodW5rX3NpemUpOworCisJR0VNX0JVR19P
TihtbS0+bWF4X29yZGVyID4gSTkxNV9CVUREWV9NQVhfT1JERVIpOworCisJbW0tPmZyZWVfbGlz
dCA9IGttYWxsb2NfYXJyYXkobW0tPm1heF9vcmRlciArIDEsCisJCQkJICAgICAgc2l6ZW9mKHN0
cnVjdCBsaXN0X2hlYWQpLAorCQkJCSAgICAgIEdGUF9LRVJORUwpOworCWlmICghbW0tPmZyZWVf
bGlzdCkKKwkJcmV0dXJuIC1FTk9NRU07CisKKwlmb3IgKGkgPSAwOyBpIDw9IG1tLT5tYXhfb3Jk
ZXI7ICsraSkKKwkJSU5JVF9MSVNUX0hFQUQoJm1tLT5mcmVlX2xpc3RbaV0pOworCisJbW0tPm5f
cm9vdHMgPSBod2VpZ2h0NjQoc2l6ZSk7CisKKwltbS0+cm9vdHMgPSBrbWFsbG9jX2FycmF5KG1t
LT5uX3Jvb3RzLAorCQkJCSAgc2l6ZW9mKHN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICopLAorCQkJ
CSAgR0ZQX0tFUk5FTCk7CisJaWYgKCFtbS0+cm9vdHMpCisJCWdvdG8gb3V0X2ZyZWVfbGlzdDsK
KworCW9mZnNldCA9IDA7CisJaSA9IDA7CisKKwkvKgorCSAqIFNwbGl0IGludG8gcG93ZXItb2Yt
dHdvIGJsb2NrcywgaW4gY2FzZSB3ZSBhcmUgZ2l2ZW4gYSBzaXplIHRoYXQgaXMKKwkgKiBub3Qg
aXRzZWxmIGEgcG93ZXItb2YtdHdvLgorCSAqLworCWRvIHsKKwkJc3RydWN0IGk5MTVfYnVkZHlf
YmxvY2sgKnJvb3Q7CisJCXVuc2lnbmVkIGludCBvcmRlcjsKKwkJdTY0IHJvb3Rfc2l6ZTsKKwor
CQlyb290X3NpemUgPSByb3VuZGRvd25fcG93X29mX3R3byhzaXplKTsKKwkJb3JkZXIgPSBpbG9n
Mihyb290X3NpemUpIC0gaWxvZzIoY2h1bmtfc2l6ZSk7CisKKwkJcm9vdCA9IGk5MTVfYmxvY2tf
YWxsb2MoTlVMTCwgb3JkZXIsIG9mZnNldCk7CisJCWlmICghcm9vdCkKKwkJCWdvdG8gb3V0X2Zy
ZWVfcm9vdHM7CisKKwkJbWFya19mcmVlKG1tLCByb290KTsKKworCQlHRU1fQlVHX09OKGkgPiBt
bS0+bWF4X29yZGVyKTsKKwkJR0VNX0JVR19PTihpOTE1X2J1ZGR5X2Jsb2NrX3NpemUobW0sIHJv
b3QpIDwgY2h1bmtfc2l6ZSk7CisKKwkJbW0tPnJvb3RzW2ldID0gcm9vdDsKKworCQlvZmZzZXQg
Kz0gcm9vdF9zaXplOworCQlzaXplIC09IHJvb3Rfc2l6ZTsKKwkJaSsrOworCX0gd2hpbGUgKHNp
emUpOworCisJcmV0dXJuIDA7CisKK291dF9mcmVlX3Jvb3RzOgorCXdoaWxlIChpLS0pCisJCWk5
MTVfYmxvY2tfZnJlZShtbS0+cm9vdHNbaV0pOworCWtmcmVlKG1tLT5yb290cyk7CitvdXRfZnJl
ZV9saXN0OgorCWtmcmVlKG1tLT5mcmVlX2xpc3QpOworCXJldHVybiAtRU5PTUVNOworfQorCit2
b2lkIGk5MTVfYnVkZHlfZmluaShzdHJ1Y3QgaTkxNV9idWRkeV9tbSAqbW0pCit7CisJaW50IGVy
ciA9IDA7CisJaW50IGk7CisKKwlmb3IgKGkgPSAwOyBpIDwgbW0tPm5fcm9vdHM7ICsraSkgewor
CQlpZiAoIWk5MTVfYnVkZHlfYmxvY2tfaXNfZnJlZShtbS0+cm9vdHNbaV0pKSB7CisJCQllcnIg
PSAtRUJVU1k7CisJCQljb250aW51ZTsKKwkJfQorCisJCWk5MTVfYmxvY2tfZnJlZShtbS0+cm9v
dHNbaV0pOworCX0KKworCWtmcmVlKG1tLT5yb290cyk7CisJa2ZyZWUobW0tPmZyZWVfbGlzdCk7
Cit9CisKK3N0YXRpYyBpbnQgc3BsaXRfYmxvY2soc3RydWN0IGk5MTVfYnVkZHlfbW0gKm1tLAor
CQkgICAgICAgc3RydWN0IGk5MTVfYnVkZHlfYmxvY2sgKmJsb2NrKQoreworCXVuc2lnbmVkIGlu
dCBibG9ja19vcmRlciA9IGk5MTVfYnVkZHlfYmxvY2tfb3JkZXIoYmxvY2spIC0gMTsKKwl1NjQg
b2Zmc2V0ID0gaTkxNV9idWRkeV9ibG9ja19vZmZzZXQoYmxvY2spOworCisJR0VNX0JVR19PTigh
aTkxNV9idWRkeV9ibG9ja19pc19mcmVlKGJsb2NrKSk7CisJR0VNX0JVR19PTighaTkxNV9idWRk
eV9ibG9ja19vcmRlcihibG9jaykpOworCisJYmxvY2stPmxlZnQgPSBpOTE1X2Jsb2NrX2FsbG9j
KGJsb2NrLCBibG9ja19vcmRlciwgb2Zmc2V0KTsKKwlpZiAoIWJsb2NrLT5sZWZ0KQorCQlyZXR1
cm4gLUVOT01FTTsKKworCWJsb2NrLT5yaWdodCA9IGk5MTVfYmxvY2tfYWxsb2MoYmxvY2ssIGJs
b2NrX29yZGVyLAorCQkJCQlvZmZzZXQgKyAobW0tPmNodW5rX3NpemUgPDwgYmxvY2tfb3JkZXIp
KTsKKwlpZiAoIWJsb2NrLT5yaWdodCkgeworCQlpOTE1X2Jsb2NrX2ZyZWUoYmxvY2stPmxlZnQp
OworCQlyZXR1cm4gLUVOT01FTTsKKwl9CisKKwltYXJrX2ZyZWUobW0sIGJsb2NrLT5sZWZ0KTsK
KwltYXJrX2ZyZWUobW0sIGJsb2NrLT5yaWdodCk7CisKKwltYXJrX3NwbGl0KGJsb2NrKTsKKwor
CXJldHVybiAwOworfQorCitzdGF0aWMgc3RydWN0IGk5MTVfYnVkZHlfYmxvY2sgKgorZ2V0X2J1
ZGR5KHN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpibG9jaykKK3sKKwlzdHJ1Y3QgaTkxNV9idWRk
eV9ibG9jayAqcGFyZW50OworCisJcGFyZW50ID0gYmxvY2stPnBhcmVudDsKKwlpZiAoIXBhcmVu
dCkKKwkJcmV0dXJuIE5VTEw7CisKKwlpZiAocGFyZW50LT5sZWZ0ID09IGJsb2NrKQorCQlyZXR1
cm4gcGFyZW50LT5yaWdodDsKKworCXJldHVybiBwYXJlbnQtPmxlZnQ7Cit9CisKK3N0YXRpYyB2
b2lkIF9faTkxNV9idWRkeV9mcmVlKHN0cnVjdCBpOTE1X2J1ZGR5X21tICptbSwKKwkJCSAgICAg
IHN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpibG9jaykKK3sKKwlzdHJ1Y3QgaTkxNV9idWRkeV9i
bG9jayAqcGFyZW50OworCisJd2hpbGUgKChwYXJlbnQgPSBibG9jay0+cGFyZW50KSkgeworCQlz
dHJ1Y3QgaTkxNV9idWRkeV9ibG9jayAqYnVkZHk7CisKKwkJYnVkZHkgPSBnZXRfYnVkZHkoYmxv
Y2spOworCisJCWlmICghaTkxNV9idWRkeV9ibG9ja19pc19mcmVlKGJ1ZGR5KSkKKwkJCWJyZWFr
OworCisJCWxpc3RfZGVsKCZidWRkeS0+bGluayk7CisKKwkJaTkxNV9ibG9ja19mcmVlKGJsb2Nr
KTsKKwkJaTkxNV9ibG9ja19mcmVlKGJ1ZGR5KTsKKworCQlibG9jayA9IHBhcmVudDsKKwl9CisK
KwltYXJrX2ZyZWUobW0sIGJsb2NrKTsKK30KKwordm9pZCBpOTE1X2J1ZGR5X2ZyZWUoc3RydWN0
IGk5MTVfYnVkZHlfbW0gKm1tLAorCQkgICAgIHN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpibG9j
aykKK3sKKwlHRU1fQlVHX09OKCFpOTE1X2J1ZGR5X2Jsb2NrX2lzX2FsbG9jYXRlZChibG9jaykp
OworCV9faTkxNV9idWRkeV9mcmVlKG1tLCBibG9jayk7Cit9CisKK3ZvaWQgaTkxNV9idWRkeV9m
cmVlX2xpc3Qoc3RydWN0IGk5MTVfYnVkZHlfbW0gKm1tLCBzdHJ1Y3QgbGlzdF9oZWFkICpvYmpl
Y3RzKQoreworCXN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpibG9jaywgKm9uOworCisJbGlzdF9m
b3JfZWFjaF9lbnRyeV9zYWZlKGJsb2NrLCBvbiwgb2JqZWN0cywgbGluaykKKwkJaTkxNV9idWRk
eV9mcmVlKG1tLCBibG9jayk7CisJSU5JVF9MSVNUX0hFQUQob2JqZWN0cyk7Cit9CisKKy8qCisg
KiBBbGxvY2F0ZSBwb3dlci1vZi10d28gYmxvY2suIFRoZSBvcmRlciB2YWx1ZSBoZXJlIHRyYW5z
bGF0ZXMgdG86CisgKgorICogICAwID0gMl4wICogbW0tPmNodW5rX3NpemUKKyAqICAgMSA9IDJe
MSAqIG1tLT5jaHVua19zaXplCisgKiAgIDIgPSAyXjIgKiBtbS0+Y2h1bmtfc2l6ZQorICogICAu
Li4KKyAqLworc3RydWN0IGk5MTVfYnVkZHlfYmxvY2sgKgoraTkxNV9idWRkeV9hbGxvYyhzdHJ1
Y3QgaTkxNV9idWRkeV9tbSAqbW0sIHVuc2lnbmVkIGludCBvcmRlcikKK3sKKwlzdHJ1Y3QgaTkx
NV9idWRkeV9ibG9jayAqYmxvY2sgPSBOVUxMOworCXVuc2lnbmVkIGludCBpOworCWludCBlcnI7
CisKKwlmb3IgKGkgPSBvcmRlcjsgaSA8PSBtbS0+bWF4X29yZGVyOyArK2kpIHsKKwkJYmxvY2sg
PSBsaXN0X2ZpcnN0X2VudHJ5X29yX251bGwoJm1tLT5mcmVlX2xpc3RbaV0sCisJCQkJCQkgc3Ry
dWN0IGk5MTVfYnVkZHlfYmxvY2ssCisJCQkJCQkgbGluayk7CisJCWlmIChibG9jaykKKwkJCWJy
ZWFrOworCX0KKworCWlmICghYmxvY2spCisJCXJldHVybiBFUlJfUFRSKC1FTk9TUEMpOworCisJ
R0VNX0JVR19PTighaTkxNV9idWRkeV9ibG9ja19pc19mcmVlKGJsb2NrKSk7CisKKwl3aGlsZSAo
aSAhPSBvcmRlcikgeworCQllcnIgPSBzcGxpdF9ibG9jayhtbSwgYmxvY2spOworCQlpZiAodW5s
aWtlbHkoZXJyKSkKKwkJCWdvdG8gb3V0X2ZyZWU7CisKKwkJLyogR28gbG93ICovCisJCWJsb2Nr
ID0gYmxvY2stPmxlZnQ7CisJCWktLTsKKwl9CisKKwltYXJrX2FsbG9jYXRlZChibG9jayk7CisJ
cmV0dXJuIGJsb2NrOworCitvdXRfZnJlZToKKwlfX2k5MTVfYnVkZHlfZnJlZShtbSwgYmxvY2sp
OworCXJldHVybiBFUlJfUFRSKGVycik7Cit9CisKK3N0YXRpYyBpbmxpbmUgYm9vbCBvdmVybGFw
cyh1NjQgczEsIHU2NCBlMSwgdTY0IHMyLCB1NjQgZTIpCit7CisJcmV0dXJuIHMxIDw9IGUyICYm
IGUxID49IHMyOworfQorCitzdGF0aWMgaW5saW5lIGJvb2wgY29udGFpbnModTY0IHMxLCB1NjQg
ZTEsIHU2NCBzMiwgdTY0IGUyKQoreworCXJldHVybiBzMSA8PSBzMiAmJiBlMSA+PSBlMjsKK30K
KworLyoKKyAqIEFsbG9jYXRlIHJhbmdlLiBOb3RlIHRoYXQgaXQncyBzYWZlIHRvIGNoYWluIHRv
Z2V0aGVyIG11bHRpcGxlIGFsbG9jX3JhbmdlcworICogd2l0aCB0aGUgc2FtZSBibG9ja3MgbGlz
dC4KKyAqCisgKiBJbnRlbmRlZCBmb3IgcHJlLWFsbG9jYXRpbmcgcG9ydGlvbnMgb2YgdGhlIGFk
ZHJlc3Mgc3BhY2UsIGZvciBleGFtcGxlIHRvCisgKiByZXNlcnZlIGEgYmxvY2sgZm9yIHRoZSBp
bml0aWFsIGZyYW1lYnVmZmVyIG9yIHNpbWlsYXIsIGhlbmNlIHRoZSBleHBlY3RhdGlvbgorICog
aGVyZSBpcyB0aGF0IGk5MTVfYnVkZHlfYWxsb2MoKSBpcyBzdGlsbCB0aGUgbWFpbiB2ZWhpY2xl
IGZvcgorICogYWxsb2NhdGlvbnMsIHNvIGlmIHRoYXQncyBub3QgdGhlIGNhc2UgdGhlbiB0aGUg
ZHJtX21tIHJhbmdlIGFsbG9jYXRvciBpcworICogcHJvYmFibHkgYSBtdWNoIGJldHRlciBmaXQs
IGFuZCBzbyB5b3Ugc2hvdWxkIHByb2JhYmx5IGdvIHVzZSB0aGF0IGluc3RlYWQuCisgKi8KK2lu
dCBpOTE1X2J1ZGR5X2FsbG9jX3JhbmdlKHN0cnVjdCBpOTE1X2J1ZGR5X21tICptbSwKKwkJCSAg
IHN0cnVjdCBsaXN0X2hlYWQgKmJsb2NrcywKKwkJCSAgIHU2NCBzdGFydCwgdTY0IHNpemUpCit7
CisJc3RydWN0IGk5MTVfYnVkZHlfYmxvY2sgKmJsb2NrOworCXN0cnVjdCBpOTE1X2J1ZGR5X2Js
b2NrICpidWRkeTsKKwlMSVNUX0hFQUQoYWxsb2NhdGVkKTsKKwlMSVNUX0hFQUQoZGZzKTsKKwl1
NjQgZW5kOworCWludCBlcnI7CisJaW50IGk7CisKKwlpZiAoc2l6ZSA8IG1tLT5jaHVua19zaXpl
KQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWlmICghSVNfQUxJR05FRChzdGFydCwgbW0tPmNodW5r
X3NpemUpKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWlmICghc2l6ZSB8fCAhSVNfQUxJR05FRChz
aXplLCBtbS0+Y2h1bmtfc2l6ZSkpCisJCXJldHVybiAtRUlOVkFMOworCisJaWYgKHJhbmdlX292
ZXJmbG93cyhzdGFydCwgc2l6ZSwgbW0tPnNpemUpKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWZv
ciAoaSA9IDA7IGkgPCBtbS0+bl9yb290czsgKytpKQorCQlsaXN0X2FkZF90YWlsKCZtbS0+cm9v
dHNbaV0tPnRtcF9saW5rLCAmZGZzKTsKKworCWVuZCA9IHN0YXJ0ICsgc2l6ZSAtIDE7CisKKwlk
byB7CisJCXU2NCBibG9ja19zdGFydDsKKwkJdTY0IGJsb2NrX2VuZDsKKworCQlibG9jayA9IGxp
c3RfZmlyc3RfZW50cnlfb3JfbnVsbCgmZGZzLAorCQkJCQkJIHN0cnVjdCBpOTE1X2J1ZGR5X2Js
b2NrLAorCQkJCQkJIHRtcF9saW5rKTsKKwkJaWYgKCFibG9jaykKKwkJCWJyZWFrOworCisJCWxp
c3RfZGVsKCZibG9jay0+dG1wX2xpbmspOworCisJCWJsb2NrX3N0YXJ0ID0gaTkxNV9idWRkeV9i
bG9ja19vZmZzZXQoYmxvY2spOworCQlibG9ja19lbmQgPSBibG9ja19zdGFydCArIGk5MTVfYnVk
ZHlfYmxvY2tfc2l6ZShtbSwgYmxvY2spIC0gMTsKKworCQlpZiAoIW92ZXJsYXBzKHN0YXJ0LCBl
bmQsIGJsb2NrX3N0YXJ0LCBibG9ja19lbmQpKQorCQkJY29udGludWU7CisKKwkJaWYgKGk5MTVf
YnVkZHlfYmxvY2tfaXNfYWxsb2NhdGVkKGJsb2NrKSkgeworCQkJZXJyID0gLUVOT1NQQzsKKwkJ
CWdvdG8gZXJyX2ZyZWU7CisJCX0KKworCQlpZiAoY29udGFpbnMoc3RhcnQsIGVuZCwgYmxvY2tf
c3RhcnQsIGJsb2NrX2VuZCkpIHsKKwkJCWlmICghaTkxNV9idWRkeV9ibG9ja19pc19mcmVlKGJs
b2NrKSkgeworCQkJCWVyciA9IC1FTk9TUEM7CisJCQkJZ290byBlcnJfZnJlZTsKKwkJCX0KKwor
CQkJbWFya19hbGxvY2F0ZWQoYmxvY2spOworCQkJbGlzdF9hZGRfdGFpbCgmYmxvY2stPmxpbmss
ICZhbGxvY2F0ZWQpOworCQkJY29udGludWU7CisJCX0KKworCQlpZiAoIWk5MTVfYnVkZHlfYmxv
Y2tfaXNfc3BsaXQoYmxvY2spKSB7CisJCQllcnIgPSBzcGxpdF9ibG9jayhtbSwgYmxvY2spOwor
CQkJaWYgKHVubGlrZWx5KGVycikpCisJCQkJZ290byBlcnJfdW5kbzsKKwkJfQorCisJCWxpc3Rf
YWRkKCZibG9jay0+cmlnaHQtPnRtcF9saW5rLCAmZGZzKTsKKwkJbGlzdF9hZGQoJmJsb2NrLT5s
ZWZ0LT50bXBfbGluaywgJmRmcyk7CisJfSB3aGlsZSAoMSk7CisKKwlsaXN0X3NwbGljZV90YWls
KCZhbGxvY2F0ZWQsIGJsb2Nrcyk7CisJcmV0dXJuIDA7CisKK2Vycl91bmRvOgorCS8qCisJICog
V2UgcmVhbGx5IGRvbid0IHdhbnQgdG8gbGVhdmUgYXJvdW5kIGEgYnVuY2ggb2Ygc3BsaXQgYmxv
Y2tzLCBzaW5jZQorCSAqIGJpZ2dlciBpcyBiZXR0ZXIsIHNvIG1ha2Ugc3VyZSB3ZSBtZXJnZSBl
dmVyeXRoaW5nIGJhY2sgYmVmb3JlIHdlCisJICogZnJlZSB0aGUgYWxsb2NhdGVkIGJsb2Nrcy4K
KwkgKi8KKwlidWRkeSA9IGdldF9idWRkeShibG9jayk7CisJaWYgKGJ1ZGR5ICYmIChpOTE1X2J1
ZGR5X2Jsb2NrX2lzX2ZyZWUoYmxvY2spICYmCisJICAgIGk5MTVfYnVkZHlfYmxvY2tfaXNfZnJl
ZShidWRkeSkpKQorCQlfX2k5MTVfYnVkZHlfZnJlZShtbSwgYmxvY2spOworCitlcnJfZnJlZToK
KwlpOTE1X2J1ZGR5X2ZyZWVfbGlzdChtbSwgJmFsbG9jYXRlZCk7CisJcmV0dXJuIGVycjsKK30K
KworI2lmIElTX0VOQUJMRUQoQ09ORklHX0RSTV9JOTE1X1NFTEZURVNUKQorI2luY2x1ZGUgInNl
bGZ0ZXN0cy9pOTE1X2J1ZGR5LmMiCisjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfYnVkZHkuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYnVkZHkuaApu
ZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLjc2YzIwOTQxYWVkNQotLS0g
L2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYnVkZHkuaApAQCAtMCww
ICsxLDEyNiBAQAorLyogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVCAqLworLyoKKyAqIENv
cHlyaWdodCDCqSAyMDE5IEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2lmbmRlZiBfX0k5MTVf
QlVERFlfSF9fCisjZGVmaW5lIF9fSTkxNV9CVUREWV9IX18KKworI2luY2x1ZGUgPGxpbnV4L2Jp
dG9wcy5oPgorI2luY2x1ZGUgPGxpbnV4L2xpc3QuaD4KKworc3RydWN0IGk5MTVfYnVkZHlfYmxv
Y2sgeworI2RlZmluZSBJOTE1X0JVRERZX0hFQURFUl9PRkZTRVQgR0VOTUFTS19VTEwoNjMsIDEy
KQorI2RlZmluZSBJOTE1X0JVRERZX0hFQURFUl9TVEFURSAgR0VOTUFTS19VTEwoMTEsIDEwKQor
I2RlZmluZSAgIEk5MTVfQlVERFlfQUxMT0NBVEVECSAgICgxIDw8IDEwKQorI2RlZmluZSAgIEk5
MTVfQlVERFlfRlJFRQkgICAoMiA8PCAxMCkKKyNkZWZpbmUgICBJOTE1X0JVRERZX1NQTElUCSAg
ICgzIDw8IDEwKQorI2RlZmluZSBJOTE1X0JVRERZX0hFQURFUl9PUkRFUiAgR0VOTUFTS19VTEwo
OSwgMCkKKwl1NjQgaGVhZGVyOworCisJc3RydWN0IGk5MTVfYnVkZHlfYmxvY2sgKmxlZnQ7CisJ
c3RydWN0IGk5MTVfYnVkZHlfYmxvY2sgKnJpZ2h0OworCXN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2Nr
ICpwYXJlbnQ7CisKKwkvKgorCSAqIFdoaWxlIHRoZSBibG9jayBpcyBhbGxvY2F0ZWQgYnkgdGhl
IHVzZXIgdGhyb3VnaCBpOTE1X2J1ZGR5X2FsbG9jKiwKKwkgKiB0aGUgdXNlciBoYXMgb3duZXJz
aGlwIG9mIHRoZSBsaW5rLCBmb3IgZXhhbXBsZSB0byBtYWludGFpbiB3aXRoaW4KKwkgKiBhIGxp
c3QsIGlmIHNvIGRlc2lyZWQuIEFzIHNvb24gYXMgdGhlIGJsb2NrIGlzIGZyZWVkIHdpdGgKKwkg
KiBpOTE1X2J1ZGR5X2ZyZWUqIG93bmVyc2hpcCBpcyBnaXZlbiBiYWNrIHRvIHRoZSBtbS4KKwkg
Ki8KKwlzdHJ1Y3QgbGlzdF9oZWFkIGxpbms7CisJc3RydWN0IGxpc3RfaGVhZCB0bXBfbGluazsK
K307CisKKyNkZWZpbmUgSTkxNV9CVUREWV9NQVhfT1JERVIgIEk5MTVfQlVERFlfSEVBREVSX09S
REVSCisKKy8qCisgKiBCaW5hcnkgQnVkZHkgU3lzdGVtLgorICoKKyAqIExvY2tpbmcgc2hvdWxk
IGJlIGhhbmRsZWQgYnkgdGhlIHVzZXIsIGEgc2ltcGxlIG11dGV4IGFyb3VuZAorICogaTkxNV9i
dWRkeV9hbGxvYyogYW5kIGk5MTVfYnVkZHlfZnJlZSogc2hvdWxkIHN1ZmZpY2UuCisgKi8KK3N0
cnVjdCBpOTE1X2J1ZGR5X21tIHsKKwkvKiBNYWludGFpbiBhIGZyZWUgbGlzdCBmb3IgZWFjaCBv
cmRlci4gKi8KKwlzdHJ1Y3QgbGlzdF9oZWFkICpmcmVlX2xpc3Q7CisKKwkvKgorCSAqIE1haW50
YWluIGV4cGxpY2l0IGJpbmFyeSB0cmVlKHMpIHRvIHRyYWNrIHRoZSBhbGxvY2F0aW9uIG9mIHRo
ZQorCSAqIGFkZHJlc3Mgc3BhY2UuIFRoaXMgZ2l2ZXMgdXMgYSBzaW1wbGUgd2F5IG9mIGZpbmRp
bmcgYSBidWRkeSBibG9jaworCSAqIGFuZCBwZXJmb3JtaW5nIHRoZSBwb3RlbnRpYWxseSByZWN1
cnNpdmUgbWVyZ2Ugc3RlcCB3aGVuIGZyZWVpbmcgYQorCSAqIGJsb2NrLiAgTm9kZXMgYXJlIGVp
dGhlciBhbGxvY2F0ZWQgb3IgZnJlZSwgaW4gd2hpY2ggY2FzZSB0aGV5IHdpbGwKKwkgKiBhbHNv
IGV4aXN0IG9uIHRoZSByZXNwZWN0aXZlIGZyZWUgbGlzdC4KKwkgKi8KKwlzdHJ1Y3QgaTkxNV9i
dWRkeV9ibG9jayAqKnJvb3RzOworCisJLyoKKwkgKiBBbnl0aGluZyBmcm9tIGhlcmUgaXMgcHVi
bGljLCBhbmQgcmVtYWlucyBzdGF0aWMgZm9yIHRoZSBsaWZldGltZSBvZgorCSAqIHRoZSBtbS4g
RXZlcnl0aGluZyBhYm92ZSBpcyBjb25zaWRlcmVkIGRvLW5vdC10b3VjaC4KKwkgKi8KKwl1bnNp
Z25lZCBpbnQgbl9yb290czsKKwl1bnNpZ25lZCBpbnQgbWF4X29yZGVyOworCisJLyogTXVzdCBi
ZSBhdCBsZWFzdCBQQUdFX1NJWkUgKi8KKwl1NjQgY2h1bmtfc2l6ZTsKKwl1NjQgc2l6ZTsKK307
CisKK3N0YXRpYyBpbmxpbmUgdTY0CitpOTE1X2J1ZGR5X2Jsb2NrX29mZnNldChzdHJ1Y3QgaTkx
NV9idWRkeV9ibG9jayAqYmxvY2spCit7CisJcmV0dXJuIGJsb2NrLT5oZWFkZXIgJiBJOTE1X0JV
RERZX0hFQURFUl9PRkZTRVQ7Cit9CisKK3N0YXRpYyBpbmxpbmUgdW5zaWduZWQgaW50CitpOTE1
X2J1ZGR5X2Jsb2NrX29yZGVyKHN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpibG9jaykKK3sKKwly
ZXR1cm4gYmxvY2stPmhlYWRlciAmIEk5MTVfQlVERFlfSEVBREVSX09SREVSOworfQorCitzdGF0
aWMgaW5saW5lIHVuc2lnbmVkIGludAoraTkxNV9idWRkeV9ibG9ja19zdGF0ZShzdHJ1Y3QgaTkx
NV9idWRkeV9ibG9jayAqYmxvY2spCit7CisJcmV0dXJuIGJsb2NrLT5oZWFkZXIgJiBJOTE1X0JV
RERZX0hFQURFUl9TVEFURTsKK30KKworc3RhdGljIGlubGluZSBib29sCitpOTE1X2J1ZGR5X2Js
b2NrX2lzX2FsbG9jYXRlZChzdHJ1Y3QgaTkxNV9idWRkeV9ibG9jayAqYmxvY2spCit7CisJcmV0
dXJuIGk5MTVfYnVkZHlfYmxvY2tfc3RhdGUoYmxvY2spID09IEk5MTVfQlVERFlfQUxMT0NBVEVE
OworfQorCitzdGF0aWMgaW5saW5lIGJvb2wKK2k5MTVfYnVkZHlfYmxvY2tfaXNfZnJlZShzdHJ1
Y3QgaTkxNV9idWRkeV9ibG9jayAqYmxvY2spCit7CisJcmV0dXJuIGk5MTVfYnVkZHlfYmxvY2tf
c3RhdGUoYmxvY2spID09IEk5MTVfQlVERFlfRlJFRTsKK30KKworc3RhdGljIGlubGluZSBib29s
CitpOTE1X2J1ZGR5X2Jsb2NrX2lzX3NwbGl0KHN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpibG9j
aykKK3sKKwlyZXR1cm4gaTkxNV9idWRkeV9ibG9ja19zdGF0ZShibG9jaykgPT0gSTkxNV9CVURE
WV9TUExJVDsKK30KKworc3RhdGljIGlubGluZSB1NjQKK2k5MTVfYnVkZHlfYmxvY2tfc2l6ZShz
dHJ1Y3QgaTkxNV9idWRkeV9tbSAqbW0sCisJCSAgICAgIHN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2Nr
ICpibG9jaykKK3sKKwlyZXR1cm4gbW0tPmNodW5rX3NpemUgPDwgaTkxNV9idWRkeV9ibG9ja19v
cmRlcihibG9jayk7Cit9CisKK2ludCBpOTE1X2J1ZGR5X2luaXQoc3RydWN0IGk5MTVfYnVkZHlf
bW0gKm1tLCB1NjQgc2l6ZSwgdTY0IGNodW5rX3NpemUpOworCit2b2lkIGk5MTVfYnVkZHlfZmlu
aShzdHJ1Y3QgaTkxNV9idWRkeV9tbSAqbW0pOworCitzdHJ1Y3QgaTkxNV9idWRkeV9ibG9jayAq
CitpOTE1X2J1ZGR5X2FsbG9jKHN0cnVjdCBpOTE1X2J1ZGR5X21tICptbSwgdW5zaWduZWQgaW50
IG9yZGVyKTsKKworaW50IGk5MTVfYnVkZHlfYWxsb2NfcmFuZ2Uoc3RydWN0IGk5MTVfYnVkZHlf
bW0gKm1tLAorCQkJICAgc3RydWN0IGxpc3RfaGVhZCAqYmxvY2tzLAorCQkJICAgdTY0IHN0YXJ0
LCB1NjQgc2l6ZSk7CisKK3ZvaWQgaTkxNV9idWRkeV9mcmVlKHN0cnVjdCBpOTE1X2J1ZGR5X21t
ICptbSwgc3RydWN0IGk5MTVfYnVkZHlfYmxvY2sgKmJsb2NrKTsKKwordm9pZCBpOTE1X2J1ZGR5
X2ZyZWVfbGlzdChzdHJ1Y3QgaTkxNV9idWRkeV9tbSAqbW0sIHN0cnVjdCBsaXN0X2hlYWQgKm9i
amVjdHMpOworCisjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
Z2xvYmFscy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nbG9iYWxzLmMKaW5kZXggMmQ1
ZmNiYTk4ODQxLi5iZTEyN2NkMjg5MzEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ2xvYmFscy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2xvYmFscy5j
CkBAIC02Miw2ICs2Miw3IEBAIHN0YXRpYyB2b2lkIF9faTkxNV9nbG9iYWxzX2NsZWFudXAodm9p
ZCkKIAogc3RhdGljIF9faW5pdGNvbnN0IGludCAoKiBjb25zdCBpbml0Zm5bXSkodm9pZCkgPSB7
CiAJaTkxNV9nbG9iYWxfYWN0aXZlX2luaXQsCisJaTkxNV9nbG9iYWxfYnVkZHlfaW5pdCwKIAlp
OTE1X2dsb2JhbF9jb250ZXh0X2luaXQsCiAJaTkxNV9nbG9iYWxfZ2VtX2NvbnRleHRfaW5pdCwK
IAlpOTE1X2dsb2JhbF9vYmplY3RzX2luaXQsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dsb2JhbHMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2xvYmFscy5o
CmluZGV4IDJkMTk5ZjQxMWE0YS4uYjJmNWNkOWI5YjFhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dsb2JhbHMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2dsb2JhbHMuaApAQCAtMjcsNiArMjcsNyBAQCB2b2lkIGk5MTVfZ2xvYmFsc19leGl0KHZvaWQp
OwogCiAvKiBjb25zdHJ1Y3RvcnMgKi8KIGludCBpOTE1X2dsb2JhbF9hY3RpdmVfaW5pdCh2b2lk
KTsKK2ludCBpOTE1X2dsb2JhbF9idWRkeV9pbml0KHZvaWQpOwogaW50IGk5MTVfZ2xvYmFsX2Nv
bnRleHRfaW5pdCh2b2lkKTsKIGludCBpOTE1X2dsb2JhbF9nZW1fY29udGV4dF9pbml0KHZvaWQp
OwogaW50IGk5MTVfZ2xvYmFsX29iamVjdHNfaW5pdCh2b2lkKTsKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2J1ZGR5LmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9zZWxmdGVzdHMvaTkxNV9idWRkeS5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAw
MDAwMDAwMDAwMC4uYjgzOWRkOTlkZDFmCi0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfYnVkZHkuYwpAQCAtMCwwICsxLDcxOSBAQAorLy8gU1BE
WC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAorLyoKKyAqIENvcHlyaWdodCDCqSAyMDE5IEludGVs
IENvcnBvcmF0aW9uCisgKi8KKworI2luY2x1ZGUgPGxpbnV4L3ByaW1lX251bWJlcnMuaD4KKwor
I2luY2x1ZGUgIi4uL2k5MTVfc2VsZnRlc3QuaCIKKyNpbmNsdWRlICJpOTE1X3JhbmRvbS5oIgor
CisjZGVmaW5lIFNaXzhHICgxVUxMIDw8IDMzKQorCitzdGF0aWMgdm9pZCBfX2lndF9kdW1wX2Js
b2NrKHN0cnVjdCBpOTE1X2J1ZGR5X21tICptbSwKKwkJCSAgICAgc3RydWN0IGk5MTVfYnVkZHlf
YmxvY2sgKmJsb2NrLAorCQkJICAgICBib29sIGJ1ZGR5KQoreworCXByX2VycigiYmxvY2sgaW5m
bzogaGVhZGVyPSVsbHgsIHN0YXRlPSV1LCBvcmRlcj0lZCwgb2Zmc2V0PSVsbHggc2l6ZT0lbGx4
IHJvb3Q9JXMgYnVkZHk9JXNcbiIsCisJICAgICAgIGJsb2NrLT5oZWFkZXIsCisJICAgICAgIGk5
MTVfYnVkZHlfYmxvY2tfc3RhdGUoYmxvY2spLAorCSAgICAgICBpOTE1X2J1ZGR5X2Jsb2NrX29y
ZGVyKGJsb2NrKSwKKwkgICAgICAgaTkxNV9idWRkeV9ibG9ja19vZmZzZXQoYmxvY2spLAorCSAg
ICAgICBpOTE1X2J1ZGR5X2Jsb2NrX3NpemUobW0sIGJsb2NrKSwKKwkgICAgICAgeWVzbm8oIWJs
b2NrLT5wYXJlbnQpLAorCSAgICAgICB5ZXNubyhidWRkeSkpOworfQorCitzdGF0aWMgdm9pZCBp
Z3RfZHVtcF9ibG9jayhzdHJ1Y3QgaTkxNV9idWRkeV9tbSAqbW0sCisJCQkgICBzdHJ1Y3QgaTkx
NV9idWRkeV9ibG9jayAqYmxvY2spCit7CisJc3RydWN0IGk5MTVfYnVkZHlfYmxvY2sgKmJ1ZGR5
OworCisJX19pZ3RfZHVtcF9ibG9jayhtbSwgYmxvY2ssIGZhbHNlKTsKKworCWJ1ZGR5ID0gZ2V0
X2J1ZGR5KGJsb2NrKTsKKwlpZiAoYnVkZHkpCisJCV9faWd0X2R1bXBfYmxvY2sobW0sIGJ1ZGR5
LCB0cnVlKTsKK30KKworc3RhdGljIGludCBpZ3RfY2hlY2tfYmxvY2soc3RydWN0IGk5MTVfYnVk
ZHlfbW0gKm1tLAorCQkJICAgc3RydWN0IGk5MTVfYnVkZHlfYmxvY2sgKmJsb2NrKQoreworCXN0
cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpidWRkeTsKKwl1bnNpZ25lZCBpbnQgYmxvY2tfc3RhdGU7
CisJdTY0IGJsb2NrX3NpemU7CisJdTY0IG9mZnNldDsKKwlpbnQgZXJyID0gMDsKKworCWJsb2Nr
X3N0YXRlID0gaTkxNV9idWRkeV9ibG9ja19zdGF0ZShibG9jayk7CisKKwlpZiAoYmxvY2tfc3Rh
dGUgIT0gSTkxNV9CVUREWV9BTExPQ0FURUQgJiYKKwkgICAgYmxvY2tfc3RhdGUgIT0gSTkxNV9C
VUREWV9GUkVFICYmCisJICAgIGJsb2NrX3N0YXRlICE9IEk5MTVfQlVERFlfU1BMSVQpIHsKKwkJ
cHJfZXJyKCJibG9jayBzdGF0ZSBtaXNtYXRjaFxuIik7CisJCWVyciA9IC1FSU5WQUw7CisJfQor
CisJYmxvY2tfc2l6ZSA9IGk5MTVfYnVkZHlfYmxvY2tfc2l6ZShtbSwgYmxvY2spOworCW9mZnNl
dCA9IGk5MTVfYnVkZHlfYmxvY2tfb2Zmc2V0KGJsb2NrKTsKKworCWlmIChibG9ja19zaXplIDwg
bW0tPmNodW5rX3NpemUpIHsKKwkJcHJfZXJyKCJibG9jayBzaXplIHNtYWxsZXIgdGhhbiBtaW4g
c2l6ZVxuIik7CisJCWVyciA9IC1FSU5WQUw7CisJfQorCisJaWYgKCFpc19wb3dlcl9vZl8yKGJs
b2NrX3NpemUpKSB7CisJCXByX2VycigiYmxvY2sgc2l6ZSBub3QgcG93ZXIgb2YgdHdvXG4iKTsK
KwkJZXJyID0gLUVJTlZBTDsKKwl9CisKKwlpZiAoIUlTX0FMSUdORUQoYmxvY2tfc2l6ZSwgbW0t
PmNodW5rX3NpemUpKSB7CisJCXByX2VycigiYmxvY2sgc2l6ZSBub3QgYWxpZ25lZCB0byBtaW4g
c2l6ZVxuIik7CisJCWVyciA9IC1FSU5WQUw7CisJfQorCisJaWYgKCFJU19BTElHTkVEKG9mZnNl
dCwgbW0tPmNodW5rX3NpemUpKSB7CisJCXByX2VycigiYmxvY2sgb2Zmc2V0IG5vdCBhbGlnbmVk
IHRvIG1pbiBzaXplXG4iKTsKKwkJZXJyID0gLUVJTlZBTDsKKwl9CisKKwlpZiAoIUlTX0FMSUdO
RUQob2Zmc2V0LCBibG9ja19zaXplKSkgeworCQlwcl9lcnIoImJsb2NrIG9mZnNldCBub3QgYWxp
Z25lZCB0byBibG9jayBzaXplXG4iKTsKKwkJZXJyID0gLUVJTlZBTDsKKwl9CisKKwlidWRkeSA9
IGdldF9idWRkeShibG9jayk7CisKKwlpZiAoIWJ1ZGR5ICYmIGJsb2NrLT5wYXJlbnQpIHsKKwkJ
cHJfZXJyKCJidWRkeSBoYXMgZ29uZSBmaXNoaW5nXG4iKTsKKwkJZXJyID0gLUVJTlZBTDsKKwl9
CisKKwlpZiAoYnVkZHkpIHsKKwkJaWYgKGk5MTVfYnVkZHlfYmxvY2tfb2Zmc2V0KGJ1ZGR5KSAh
PSAob2Zmc2V0IF4gYmxvY2tfc2l6ZSkpIHsKKwkJCXByX2VycigiYnVkZHkgaGFzIHdyb25nIG9m
ZnNldFxuIik7CisJCQllcnIgPSAtRUlOVkFMOworCQl9CisKKwkJaWYgKGk5MTVfYnVkZHlfYmxv
Y2tfc2l6ZShtbSwgYnVkZHkpICE9IGJsb2NrX3NpemUpIHsKKwkJCXByX2VycigiYnVkZHkgc2l6
ZSBtaXNtYXRjaFxuIik7CisJCQllcnIgPSAtRUlOVkFMOworCQl9CisKKwkJaWYgKGk5MTVfYnVk
ZHlfYmxvY2tfc3RhdGUoYnVkZHkpID09IGJsb2NrX3N0YXRlICYmCisJCSAgICBibG9ja19zdGF0
ZSA9PSBJOTE1X0JVRERZX0ZSRUUpIHsKKwkJCXByX2VycigiYmxvY2sgYW5kIGl0cyBidWRkeSBh
cmUgZnJlZVxuIik7CisJCQllcnIgPSAtRUlOVkFMOworCQl9CisJfQorCisJcmV0dXJuIGVycjsK
K30KKworc3RhdGljIGludCBpZ3RfY2hlY2tfYmxvY2tzKHN0cnVjdCBpOTE1X2J1ZGR5X21tICpt
bSwKKwkJCSAgICBzdHJ1Y3QgbGlzdF9oZWFkICpibG9ja3MsCisJCQkgICAgdTY0IGV4cGVjdGVk
X3NpemUsCisJCQkgICAgYm9vbCBpc19jb250aWd1b3VzKQoreworCXN0cnVjdCBpOTE1X2J1ZGR5
X2Jsb2NrICpibG9jazsKKwlzdHJ1Y3QgaTkxNV9idWRkeV9ibG9jayAqcHJldjsKKwl1NjQgdG90
YWw7CisJaW50IGVyciA9IDA7CisKKwlibG9jayA9IE5VTEw7CisJcHJldiA9IE5VTEw7CisJdG90
YWwgPSAwOworCisJbGlzdF9mb3JfZWFjaF9lbnRyeShibG9jaywgYmxvY2tzLCBsaW5rKSB7CisJ
CWVyciA9IGlndF9jaGVja19ibG9jayhtbSwgYmxvY2spOworCisJCWlmICghaTkxNV9idWRkeV9i
bG9ja19pc19hbGxvY2F0ZWQoYmxvY2spKSB7CisJCQlwcl9lcnIoImJsb2NrIG5vdCBhbGxvY2F0
ZWRcbiIpLAorCQkJZXJyID0gLUVJTlZBTDsKKwkJfQorCisJCWlmIChpc19jb250aWd1b3VzICYm
IHByZXYpIHsKKwkJCXU2NCBwcmV2X2Jsb2NrX3NpemU7CisJCQl1NjQgcHJldl9vZmZzZXQ7CisJ
CQl1NjQgb2Zmc2V0OworCisJCQlwcmV2X29mZnNldCA9IGk5MTVfYnVkZHlfYmxvY2tfb2Zmc2V0
KHByZXYpOworCQkJcHJldl9ibG9ja19zaXplID0gaTkxNV9idWRkeV9ibG9ja19zaXplKG1tLCBw
cmV2KTsKKwkJCW9mZnNldCA9IGk5MTVfYnVkZHlfYmxvY2tfb2Zmc2V0KGJsb2NrKTsKKworCQkJ
aWYgKG9mZnNldCAhPSAocHJldl9vZmZzZXQgKyBwcmV2X2Jsb2NrX3NpemUpKSB7CisJCQkJcHJf
ZXJyKCJibG9jayBvZmZzZXQgbWlzbWF0Y2hcbiIpOworCQkJCWVyciA9IC1FSU5WQUw7CisJCQl9
CisJCX0KKworCQlpZiAoZXJyKQorCQkJYnJlYWs7CisKKwkJdG90YWwgKz0gaTkxNV9idWRkeV9i
bG9ja19zaXplKG1tLCBibG9jayk7CisJCXByZXYgPSBibG9jazsKKwl9CisKKwlpZiAoIWVycikg
eworCQlpZiAodG90YWwgIT0gZXhwZWN0ZWRfc2l6ZSkgeworCQkJcHJfZXJyKCJzaXplIG1pc21h
dGNoLCBleHBlY3RlZD0lbGx4LCBmb3VuZD0lbGx4XG4iLAorCQkJICAgICAgIGV4cGVjdGVkX3Np
emUsIHRvdGFsKTsKKwkJCWVyciA9IC1FSU5WQUw7CisJCX0KKwkJcmV0dXJuIGVycjsKKwl9CisK
KwlpZiAocHJldikgeworCQlwcl9lcnIoInByZXYgYmxvY2ssIGR1bXA6XG4iKTsKKwkJaWd0X2R1
bXBfYmxvY2sobW0sIHByZXYpOworCX0KKworCWlmIChibG9jaykgeworCQlwcl9lcnIoImJhZCBi
bG9jaywgZHVtcDpcbiIpOworCQlpZ3RfZHVtcF9ibG9jayhtbSwgYmxvY2spOworCX0KKworCXJl
dHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQgaWd0X2NoZWNrX21tKHN0cnVjdCBpOTE1X2J1ZGR5
X21tICptbSkKK3sKKwlzdHJ1Y3QgaTkxNV9idWRkeV9ibG9jayAqcm9vdDsKKwlzdHJ1Y3QgaTkx
NV9idWRkeV9ibG9jayAqcHJldjsKKwl1bnNpZ25lZCBpbnQgaTsKKwl1NjQgdG90YWw7CisJaW50
IGVyciA9IDA7CisKKwlpZiAoIW1tLT5uX3Jvb3RzKSB7CisJCXByX2Vycigibl9yb290cyBpcyB6
ZXJvXG4iKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJaWYgKG1tLT5uX3Jvb3RzICE9IGh3
ZWlnaHQ2NChtbS0+c2l6ZSkpIHsKKwkJcHJfZXJyKCJuX3Jvb3RzIG1pc21hdGNoLCBuX3Jvb3Rz
PSV1LCBleHBlY3RlZD0lbHVcbiIsCisJCSAgICAgICBtbS0+bl9yb290cywgaHdlaWdodDY0KG1t
LT5zaXplKSk7CisJCXJldHVybiAtRUlOVkFMOworCX0KKworCXJvb3QgPSBOVUxMOworCXByZXYg
PSBOVUxMOworCXRvdGFsID0gMDsKKworCWZvciAoaSA9IDA7IGkgPCBtbS0+bl9yb290czsgKytp
KSB7CisJCXN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpibG9jazsKKwkJdW5zaWduZWQgaW50IG9y
ZGVyOworCisJCXJvb3QgPSBtbS0+cm9vdHNbaV07CisJCWlmICghcm9vdCkgeworCQkJcHJfZXJy
KCJyb290KCV1KSBpcyBOVUxMXG4iLCBpKTsKKwkJCWVyciA9IC1FSU5WQUw7CisJCQlicmVhazsK
KwkJfQorCisJCWVyciA9IGlndF9jaGVja19ibG9jayhtbSwgcm9vdCk7CisKKwkJaWYgKCFpOTE1
X2J1ZGR5X2Jsb2NrX2lzX2ZyZWUocm9vdCkpIHsKKwkJCXByX2Vycigicm9vdCBub3QgZnJlZVxu
Iik7CisJCQllcnIgPSAtRUlOVkFMOworCQl9CisKKwkJb3JkZXIgPSBpOTE1X2J1ZGR5X2Jsb2Nr
X29yZGVyKHJvb3QpOworCisJCWlmICghaSkgeworCQkJaWYgKG9yZGVyICE9IG1tLT5tYXhfb3Jk
ZXIpIHsKKwkJCQlwcl9lcnIoIm1heCBvcmRlciByb290IG1pc3NpbmdcbiIpOworCQkJCWVyciA9
IC1FSU5WQUw7CisJCQl9CisJCX0KKworCQlpZiAocHJldikgeworCQkJdTY0IHByZXZfYmxvY2tf
c2l6ZTsKKwkJCXU2NCBwcmV2X29mZnNldDsKKwkJCXU2NCBvZmZzZXQ7CisKKwkJCXByZXZfb2Zm
c2V0ID0gaTkxNV9idWRkeV9ibG9ja19vZmZzZXQocHJldik7CisJCQlwcmV2X2Jsb2NrX3NpemUg
PSBpOTE1X2J1ZGR5X2Jsb2NrX3NpemUobW0sIHByZXYpOworCQkJb2Zmc2V0ID0gaTkxNV9idWRk
eV9ibG9ja19vZmZzZXQocm9vdCk7CisKKwkJCWlmIChvZmZzZXQgIT0gKHByZXZfb2Zmc2V0ICsg
cHJldl9ibG9ja19zaXplKSkgeworCQkJCXByX2Vycigicm9vdCBvZmZzZXQgbWlzbWF0Y2hcbiIp
OworCQkJCWVyciA9IC1FSU5WQUw7CisJCQl9CisJCX0KKworCQlibG9jayA9IGxpc3RfZmlyc3Rf
ZW50cnlfb3JfbnVsbCgmbW0tPmZyZWVfbGlzdFtvcmRlcl0sCisJCQkJCQkgc3RydWN0IGk5MTVf
YnVkZHlfYmxvY2ssCisJCQkJCQkgbGluayk7CisJCWlmIChibG9jayAhPSByb290KSB7CisJCQlw
cl9lcnIoInJvb3QgbWlzbWF0Y2ggYXQgb3JkZXI9JXVcbiIsIG9yZGVyKTsKKwkJCWVyciA9IC1F
SU5WQUw7CisJCX0KKworCQlpZiAoZXJyKQorCQkJYnJlYWs7CisKKwkJcHJldiA9IHJvb3Q7CisJ
CXRvdGFsICs9IGk5MTVfYnVkZHlfYmxvY2tfc2l6ZShtbSwgcm9vdCk7CisJfQorCisJaWYgKCFl
cnIpIHsKKwkJaWYgKHRvdGFsICE9IG1tLT5zaXplKSB7CisJCQlwcl9lcnIoImV4cGVjdGVkIG1t
IHNpemU9JWxseCwgZm91bmQ9JWxseFxuIiwgbW0tPnNpemUsCisJCQkgICAgICAgdG90YWwpOwor
CQkJZXJyID0gLUVJTlZBTDsKKwkJfQorCQlyZXR1cm4gZXJyOworCX0KKworCWlmIChwcmV2KSB7
CisJCXByX2VycigicHJldiByb290KCV1KSwgZHVtcDpcbiIsIGkgLSAxKTsKKwkJaWd0X2R1bXBf
YmxvY2sobW0sIHByZXYpOworCX0KKworCWlmIChyb290KSB7CisJCXByX2VycigiYmFkIHJvb3Qo
JXUpLCBkdW1wOlxuIiwgaSk7CisJCWlndF9kdW1wX2Jsb2NrKG1tLCByb290KTsKKwl9CisKKwly
ZXR1cm4gZXJyOworfQorCitzdGF0aWMgdm9pZCBpZ3RfbW1fY29uZmlnKHU2NCAqc2l6ZSwgdTY0
ICpjaHVua19zaXplKQoreworCUk5MTVfUk5EX1NUQVRFKHBybmcpOworCXU2NCBzLCBtczsKKwor
CS8qIE5vdGhpbmcgZmFuY3ksIGp1c3QgdHJ5IHRvIGdldCBhbiBpbnRlcmVzdGluZyBiaXQgcGF0
dGVybiAqLworCisJcHJhbmRvbV9zZWVkX3N0YXRlKCZwcm5nLCBpOTE1X3NlbGZ0ZXN0LnJhbmRv
bV9zZWVkKTsKKworCXMgPSBpOTE1X3ByYW5kb21fdTY0X3N0YXRlKCZwcm5nKSAmIChTWl84RyAt
IDEpOworCW1zID0gQklUX1VMTCgxMiArIChwcmFuZG9tX3UzMl9zdGF0ZSgmcHJuZykgJSBpbG9n
MihzID4+IDEyKSkpOworCXMgPSBtYXgocyAmIC1tcywgbXMpOworCisJKmNodW5rX3NpemUgPSBt
czsKKwkqc2l6ZSA9IHM7Cit9CisKK3N0YXRpYyBpbnQgaWd0X2J1ZGR5X2FsbG9jX3Ntb2tlKHZv
aWQgKmFyZykKK3sKKwlzdHJ1Y3QgaTkxNV9idWRkeV9tbSBtbTsKKwlpbnQgbWF4X29yZGVyOwor
CXU2NCBjaHVua19zaXplOworCXU2NCBtbV9zaXplOworCWludCBlcnI7CisKKwlpZ3RfbW1fY29u
ZmlnKCZtbV9zaXplLCAmY2h1bmtfc2l6ZSk7CisKKwlwcl9pbmZvKCJidWRkeV9pbml0IHdpdGgg
c2l6ZT0lbGx4LCBjaHVua19zaXplPSVsbHhcbiIsIG1tX3NpemUsIGNodW5rX3NpemUpOworCisJ
ZXJyID0gaTkxNV9idWRkeV9pbml0KCZtbSwgbW1fc2l6ZSwgY2h1bmtfc2l6ZSk7CisJaWYgKGVy
cikgeworCQlwcl9lcnIoImJ1ZGR5X2luaXQgZmFpbGVkKCVkKVxuIiwgZXJyKTsKKwkJcmV0dXJu
IGVycjsKKwl9CisKKwlmb3IgKG1heF9vcmRlciA9IG1tLm1heF9vcmRlcjsgbWF4X29yZGVyID49
IDA7IG1heF9vcmRlci0tKSB7CisJCXN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpibG9jazsKKwkJ
aW50IG9yZGVyOworCQlMSVNUX0hFQUQoYmxvY2tzKTsKKwkJdTY0IHRvdGFsOworCisJCWVyciA9
IGlndF9jaGVja19tbSgmbW0pOworCQlpZiAoZXJyKSB7CisJCQlwcl9lcnIoInByZS1tbSBjaGVj
ayBmYWlsZWQsIGFib3J0XG4iKTsKKwkJCWJyZWFrOworCQl9CisKKwkJcHJfaW5mbygiZmlsbGlu
ZyBmcm9tIG1heF9vcmRlcj0ldVxuIiwgbWF4X29yZGVyKTsKKworCQlvcmRlciA9IG1heF9vcmRl
cjsKKwkJdG90YWwgPSAwOworCisJCWRvIHsKK3JldHJ5OgorCQkJYmxvY2sgPSBpOTE1X2J1ZGR5
X2FsbG9jKCZtbSwgb3JkZXIpOworCQkJaWYgKElTX0VSUihibG9jaykpIHsKKwkJCQllcnIgPSBQ
VFJfRVJSKGJsb2NrKTsKKwkJCQlpZiAoZXJyID09IC1FTk9NRU0pIHsKKwkJCQkJcHJfaW5mbygi
YnVkZHlfYWxsb2MgaGl0IC1FTk9NRU0gd2l0aCBvcmRlcj0lZFxuIiwKKwkJCQkJCW9yZGVyKTsK
KwkJCQl9IGVsc2UgeworCQkJCQlpZiAob3JkZXItLSkgeworCQkJCQkJZXJyID0gMDsKKwkJCQkJ
CWdvdG8gcmV0cnk7CisJCQkJCX0KKworCQkJCQlwcl9lcnIoImJ1ZGR5X2FsbG9jIHdpdGggb3Jk
ZXI9JWQgZmFpbGVkKCVkKVxuIiwKKwkJCQkJICAgICAgIG9yZGVyLCBlcnIpOworCQkJCX0KKwor
CQkJCWJyZWFrOworCQkJfQorCisJCQlsaXN0X2FkZF90YWlsKCZibG9jay0+bGluaywgJmJsb2Nr
cyk7CisKKwkJCWlmIChpOTE1X2J1ZGR5X2Jsb2NrX29yZGVyKGJsb2NrKSAhPSBvcmRlcikgewor
CQkJCXByX2VycigiYnVkZHlfYWxsb2Mgb3JkZXIgbWlzbWF0Y2hcbiIpOworCQkJCWVyciA9IC1F
SU5WQUw7CisJCQkJYnJlYWs7CisJCQl9CisKKwkJCXRvdGFsICs9IGk5MTVfYnVkZHlfYmxvY2tf
c2l6ZSgmbW0sIGJsb2NrKTsKKwkJfSB3aGlsZSAodG90YWwgPCBtbS5zaXplKTsKKworCQlpZiAo
IWVycikKKwkJCWVyciA9IGlndF9jaGVja19ibG9ja3MoJm1tLCAmYmxvY2tzLCB0b3RhbCwgZmFs
c2UpOworCisJCWk5MTVfYnVkZHlfZnJlZV9saXN0KCZtbSwgJmJsb2Nrcyk7CisKKwkJaWYgKCFl
cnIpIHsKKwkJCWVyciA9IGlndF9jaGVja19tbSgmbW0pOworCQkJaWYgKGVycikKKwkJCQlwcl9l
cnIoInBvc3QtbW0gY2hlY2sgZmFpbGVkXG4iKTsKKwkJfQorCisJCWlmIChlcnIpCisJCQlicmVh
azsKKwl9CisKKwlpZiAoZXJyID09IC1FTk9NRU0pCisJCWVyciA9IDA7CisKKwlpOTE1X2J1ZGR5
X2ZpbmkoJm1tKTsKKworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQgaWd0X2J1ZGR5X2Fs
bG9jX3Blc3NpbWlzdGljKHZvaWQgKmFyZykKK3sKKwljb25zdCB1bnNpZ25lZCBpbnQgbWF4X29y
ZGVyID0gMTY7CisJc3RydWN0IGk5MTVfYnVkZHlfYmxvY2sgKmJsb2NrLCAqYm47CisJc3RydWN0
IGk5MTVfYnVkZHlfbW0gbW07CisJdW5zaWduZWQgaW50IG9yZGVyOworCUxJU1RfSEVBRChibG9j
a3MpOworCWludCBlcnI7CisKKwkvKgorCSAqIENyZWF0ZSBhIHBvdC1zaXplZCBtbSwgdGhlbiBh
bGxvY2F0ZSBvbmUgb2YgZWFjaCBwb3NzaWJsZQorCSAqIG9yZGVyIHdpdGhpbi4gVGhpcyBzaG91
bGQgbGVhdmUgdGhlIG1tIHdpdGggZXhhY3RseSBvbmUKKwkgKiBwYWdlIGxlZnQuCisJICovCisK
KwllcnIgPSBpOTE1X2J1ZGR5X2luaXQoJm1tLCBQQUdFX1NJWkUgPDwgbWF4X29yZGVyLCBQQUdF
X1NJWkUpOworCWlmIChlcnIpIHsKKwkJcHJfZXJyKCJidWRkeV9pbml0IGZhaWxlZCglZClcbiIs
IGVycik7CisJCXJldHVybiBlcnI7CisJfQorCUdFTV9CVUdfT04obW0ubWF4X29yZGVyICE9IG1h
eF9vcmRlcik7CisKKwlmb3IgKG9yZGVyID0gMDsgb3JkZXIgPCBtYXhfb3JkZXI7IG9yZGVyKysp
IHsKKwkJYmxvY2sgPSBpOTE1X2J1ZGR5X2FsbG9jKCZtbSwgb3JkZXIpOworCQlpZiAoSVNfRVJS
KGJsb2NrKSkgeworCQkJcHJfaW5mbygiYnVkZHlfYWxsb2MgaGl0IC1FTk9NRU0gd2l0aCBvcmRl
cj0lZFxuIiwKKwkJCQlvcmRlcik7CisJCQllcnIgPSBQVFJfRVJSKGJsb2NrKTsKKwkJCWdvdG8g
ZXJyOworCQl9CisKKwkJbGlzdF9hZGRfdGFpbCgmYmxvY2stPmxpbmssICZibG9ja3MpOworCX0K
KworCS8qIEFuZCBub3cgdGhlIGxhc3QgcmVtYWluaW5nIGJsb2NrIGF2YWlsYWJsZSAqLworCWJs
b2NrID0gaTkxNV9idWRkeV9hbGxvYygmbW0sIDApOworCWlmIChJU19FUlIoYmxvY2spKSB7CisJ
CXByX2luZm8oImJ1ZGR5X2FsbG9jIGhpdCAtRU5PTUVNIG9uIGZpbmFsIGFsbG9jXG4iKTsKKwkJ
ZXJyID0gUFRSX0VSUihibG9jayk7CisJCWdvdG8gZXJyOworCX0KKwlsaXN0X2FkZF90YWlsKCZi
bG9jay0+bGluaywgJmJsb2Nrcyk7CisKKwkvKiBTaG91bGQgYmUgY29tcGxldGVseSBmdWxsISAq
LworCWZvciAob3JkZXIgPSBtYXhfb3JkZXI7IG9yZGVyLS07ICkgeworCQlibG9jayA9IGk5MTVf
YnVkZHlfYWxsb2MoJm1tLCBvcmRlcik7CisJCWlmICghSVNfRVJSKGJsb2NrKSkgeworCQkJcHJf
aW5mbygiYnVkZHlfYWxsb2MgdW5leHBlY3RlZGx5IHN1Y2NlZWRlZCBhdCBvcmRlciAlZCwgaXQg
c2hvdWxkIGJlIGZ1bGwhIiwKKwkJCQlvcmRlcik7CisJCQlsaXN0X2FkZF90YWlsKCZibG9jay0+
bGluaywgJmJsb2Nrcyk7CisJCQllcnIgPSAtRUlOVkFMOworCQkJZ290byBlcnI7CisJCX0KKwl9
CisKKwlibG9jayA9IGxpc3RfbGFzdF9lbnRyeSgmYmxvY2tzLCB0eXBlb2YoKmJsb2NrKSwgbGlu
ayk7CisJbGlzdF9kZWwoJmJsb2NrLT5saW5rKTsKKwlpOTE1X2J1ZGR5X2ZyZWUoJm1tLCBibG9j
ayk7CisKKwkvKiBBcyB3ZSBmcmVlIGluIGluY3JlYXNpbmcgc2l6ZSwgd2UgbWFrZSBhdmFpbGFi
bGUgbGFyZ2VyIGJsb2NrcyAqLworCW9yZGVyID0gMTsKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5X3Nh
ZmUoYmxvY2ssIGJuLCAmYmxvY2tzLCBsaW5rKSB7CisJCWxpc3RfZGVsKCZibG9jay0+bGluayk7
CisJCWk5MTVfYnVkZHlfZnJlZSgmbW0sIGJsb2NrKTsKKworCQlibG9jayA9IGk5MTVfYnVkZHlf
YWxsb2MoJm1tLCBvcmRlcik7CisJCWlmIChJU19FUlIoYmxvY2spKSB7CisJCQlwcl9pbmZvKCJi
dWRkeV9hbGxvYyAocmVhbGxvYykgaGl0IC1FTk9NRU0gd2l0aCBvcmRlcj0lZFxuIiwKKwkJCQlv
cmRlcik7CisJCQllcnIgPSBQVFJfRVJSKGJsb2NrKTsKKwkJCWdvdG8gZXJyOworCQl9CisJCWk5
MTVfYnVkZHlfZnJlZSgmbW0sIGJsb2NrKTsKKwkJb3JkZXIrKzsKKwl9CisKKwkvKiBUbyBjb25m
aXJtLCBub3cgdGhlIHdob2xlIG1tIHNob3VsZCBiZSBhdmFpbGFibGUgKi8KKwlibG9jayA9IGk5
MTVfYnVkZHlfYWxsb2MoJm1tLCBtYXhfb3JkZXIpOworCWlmIChJU19FUlIoYmxvY2spKSB7CisJ
CXByX2luZm8oImJ1ZGR5X2FsbG9jIChyZWFsbG9jKSBoaXQgLUVOT01FTSB3aXRoIG9yZGVyPSVk
XG4iLAorCQkJbWF4X29yZGVyKTsKKwkJZXJyID0gUFRSX0VSUihibG9jayk7CisJCWdvdG8gZXJy
OworCX0KKwlpOTE1X2J1ZGR5X2ZyZWUoJm1tLCBibG9jayk7CisKK2VycjoKKwlpOTE1X2J1ZGR5
X2ZyZWVfbGlzdCgmbW0sICZibG9ja3MpOworCWk5MTVfYnVkZHlfZmluaSgmbW0pOworCXJldHVy
biBlcnI7Cit9CisKK3N0YXRpYyBpbnQgaWd0X2J1ZGR5X2FsbG9jX29wdGltaXN0aWModm9pZCAq
YXJnKQoreworCWNvbnN0IGludCBtYXhfb3JkZXIgPSAxNjsKKwlzdHJ1Y3QgaTkxNV9idWRkeV9i
bG9jayAqYmxvY2s7CisJc3RydWN0IGk5MTVfYnVkZHlfbW0gbW07CisJTElTVF9IRUFEKGJsb2Nr
cyk7CisJaW50IG9yZGVyOworCWludCBlcnI7CisKKwkvKgorCSAqIENyZWF0ZSBhIG1tIHdpdGgg
b25lIGJsb2NrIG9mIGVhY2ggb3JkZXIgYXZhaWxhYmxlLCBhbmQKKwkgKiB0cnkgdG8gYWxsb2Nh
dGUgdGhlbSBhbGwuCisJICovCisKKwllcnIgPSBpOTE1X2J1ZGR5X2luaXQoJm1tLAorCQkJICAg
ICAgUEFHRV9TSVpFICogKCgxIDw8IChtYXhfb3JkZXIgKyAxKSkgLSAxKSwKKwkJCSAgICAgIFBB
R0VfU0laRSk7CisJaWYgKGVycikgeworCQlwcl9lcnIoImJ1ZGR5X2luaXQgZmFpbGVkKCVkKVxu
IiwgZXJyKTsKKwkJcmV0dXJuIGVycjsKKwl9CisJR0VNX0JVR19PTihtbS5tYXhfb3JkZXIgIT0g
bWF4X29yZGVyKTsKKworCWZvciAob3JkZXIgPSAwOyBvcmRlciA8PSBtYXhfb3JkZXI7IG9yZGVy
KyspIHsKKwkJYmxvY2sgPSBpOTE1X2J1ZGR5X2FsbG9jKCZtbSwgb3JkZXIpOworCQlpZiAoSVNf
RVJSKGJsb2NrKSkgeworCQkJcHJfaW5mbygiYnVkZHlfYWxsb2MgaGl0IC1FTk9NRU0gd2l0aCBv
cmRlcj0lZFxuIiwKKwkJCQlvcmRlcik7CisJCQllcnIgPSBQVFJfRVJSKGJsb2NrKTsKKwkJCWdv
dG8gZXJyOworCQl9CisKKwkJbGlzdF9hZGRfdGFpbCgmYmxvY2stPmxpbmssICZibG9ja3MpOwor
CX0KKworCS8qIFNob3VsZCBiZSBjb21wbGV0ZWx5IGZ1bGwhICovCisJYmxvY2sgPSBpOTE1X2J1
ZGR5X2FsbG9jKCZtbSwgMCk7CisJaWYgKCFJU19FUlIoYmxvY2spKSB7CisJCXByX2luZm8oImJ1
ZGR5X2FsbG9jIHVuZXhwZWN0ZWRseSBzdWNjZWVkZWQsIGl0IHNob3VsZCBiZSBmdWxsISIpOwor
CQlsaXN0X2FkZF90YWlsKCZibG9jay0+bGluaywgJmJsb2Nrcyk7CisJCWVyciA9IC1FSU5WQUw7
CisJCWdvdG8gZXJyOworCX0KKworZXJyOgorCWk5MTVfYnVkZHlfZnJlZV9saXN0KCZtbSwgJmJs
b2Nrcyk7CisJaTkxNV9idWRkeV9maW5pKCZtbSk7CisJcmV0dXJuIGVycjsKK30KKworc3RhdGlj
IGludCBpZ3RfYnVkZHlfYWxsb2NfcGF0aG9sb2dpY2FsKHZvaWQgKmFyZykKK3sKKwljb25zdCBp
bnQgbWF4X29yZGVyID0gMTY7CisJc3RydWN0IGk5MTVfYnVkZHlfYmxvY2sgKmJsb2NrOworCXN0
cnVjdCBpOTE1X2J1ZGR5X21tIG1tOworCUxJU1RfSEVBRChibG9ja3MpOworCUxJU1RfSEVBRCho
b2xlcyk7CisJaW50IG9yZGVyLCB0b3A7CisJaW50IGVycjsKKworCS8qCisJICogQ3JlYXRlIGEg
cG90LXNpemVkIG1tLCB0aGVuIGFsbG9jYXRlIG9uZSBvZiBlYWNoIHBvc3NpYmxlCisJICogb3Jk
ZXIgd2l0aGluLiBUaGlzIHNob3VsZCBsZWF2ZSB0aGUgbW0gd2l0aCBleGFjdGx5IG9uZQorCSAq
IHBhZ2UgbGVmdC4gRnJlZSB0aGUgbGFyZ2VzdCBibG9jaywgdGhlbiB3aGl0dGxlIGRvd24gYWdh
aW4uCisJICogRXZlbnR1YWxseSB3ZSB3aWxsIGhhdmUgYSBmdWxseSA1MCUgZnJhZ21lbnRlZCBt
bS4KKwkgKi8KKworCWVyciA9IGk5MTVfYnVkZHlfaW5pdCgmbW0sIFBBR0VfU0laRSA8PCBtYXhf
b3JkZXIsIFBBR0VfU0laRSk7CisJaWYgKGVycikgeworCQlwcl9lcnIoImJ1ZGR5X2luaXQgZmFp
bGVkKCVkKVxuIiwgZXJyKTsKKwkJcmV0dXJuIGVycjsKKwl9CisJR0VNX0JVR19PTihtbS5tYXhf
b3JkZXIgIT0gbWF4X29yZGVyKTsKKworCWZvciAodG9wID0gbWF4X29yZGVyOyB0b3A7IHRvcC0t
KSB7CisJCS8qIE1ha2Ugcm9vbSBieSBmcmVlaW5nIHRoZSBsYXJnZXN0IGFsbG9jYXRlZCBibG9j
ayAqLworCQlibG9jayA9IGxpc3RfZmlyc3RfZW50cnlfb3JfbnVsbCgmYmxvY2tzLCB0eXBlb2Yo
KmJsb2NrKSwgbGluayk7CisJCWlmIChibG9jaykgeworCQkJbGlzdF9kZWwoJmJsb2NrLT5saW5r
KTsKKwkJCWk5MTVfYnVkZHlfZnJlZSgmbW0sIGJsb2NrKTsKKwkJfQorCisJCWZvciAob3JkZXIg
PSB0b3A7IG9yZGVyLS07ICkgeworCQkJYmxvY2sgPSBpOTE1X2J1ZGR5X2FsbG9jKCZtbSwgb3Jk
ZXIpOworCQkJaWYgKElTX0VSUihibG9jaykpIHsKKwkJCQlwcl9pbmZvKCJidWRkeV9hbGxvYyBo
aXQgLUVOT01FTSB3aXRoIG9yZGVyPSVkLCB0b3A9JWRcbiIsCisJCQkJCW9yZGVyLCB0b3ApOwor
CQkJCWVyciA9IFBUUl9FUlIoYmxvY2spOworCQkJCWdvdG8gZXJyOworCQkJfQorCQkJbGlzdF9h
ZGRfdGFpbCgmYmxvY2stPmxpbmssICZibG9ja3MpOworCQl9CisKKwkJLyogVGhlcmUgc2hvdWxk
IGJlIG9uZSBmaW5hbCBwYWdlIGZvciB0aGlzIHN1Yi1hbGxvY2F0aW9uICovCisJCWJsb2NrID0g
aTkxNV9idWRkeV9hbGxvYygmbW0sIDApOworCQlpZiAoSVNfRVJSKGJsb2NrKSkgeworCQkJcHJf
aW5mbygiYnVkZHlfYWxsb2MgaGl0IC1FTk9NRU0gZm9yIGhvbGVcbiIpOworCQkJZXJyID0gUFRS
X0VSUihibG9jayk7CisJCQlnb3RvIGVycjsKKwkJfQorCQlsaXN0X2FkZF90YWlsKCZibG9jay0+
bGluaywgJmhvbGVzKTsKKworCQlibG9jayA9IGk5MTVfYnVkZHlfYWxsb2MoJm1tLCB0b3ApOwor
CQlpZiAoIUlTX0VSUihibG9jaykpIHsKKwkJCXByX2luZm8oImJ1ZGR5X2FsbG9jIHVuZXhwZWN0
ZWRseSBzdWNjZWVkZWQgYXQgdG9wLW9yZGVyICVkLyVkLCBpdCBzaG91bGQgYmUgZnVsbCEiLAor
CQkJCXRvcCwgbWF4X29yZGVyKTsKKwkJCWxpc3RfYWRkX3RhaWwoJmJsb2NrLT5saW5rLCAmYmxv
Y2tzKTsKKwkJCWVyciA9IC1FSU5WQUw7CisJCQlnb3RvIGVycjsKKwkJfQorCX0KKworCWk5MTVf
YnVkZHlfZnJlZV9saXN0KCZtbSwgJmhvbGVzKTsKKworCS8qIE5vdGhpbmcgbGFyZ2VyIHRoYW4g
YmxvY2tzIG9mIGNodW5rX3NpemUgbm93IGF2YWlsYWJsZSAqLworCWZvciAob3JkZXIgPSAxOyBv
cmRlciA8PSBtYXhfb3JkZXI7IG9yZGVyKyspIHsKKwkJYmxvY2sgPSBpOTE1X2J1ZGR5X2FsbG9j
KCZtbSwgb3JkZXIpOworCQlpZiAoIUlTX0VSUihibG9jaykpIHsKKwkJCXByX2luZm8oImJ1ZGR5
X2FsbG9jIHVuZXhwZWN0ZWRseSBzdWNjZWVkZWQgYXQgb3JkZXIgJWQsIGl0IHNob3VsZCBiZSBm
dWxsISIsCisJCQkJb3JkZXIpOworCQkJbGlzdF9hZGRfdGFpbCgmYmxvY2stPmxpbmssICZibG9j
a3MpOworCQkJZXJyID0gLUVJTlZBTDsKKwkJCWdvdG8gZXJyOworCQl9CisJfQorCitlcnI6CisJ
bGlzdF9zcGxpY2VfdGFpbCgmaG9sZXMsICZibG9ja3MpOworCWk5MTVfYnVkZHlfZnJlZV9saXN0
KCZtbSwgJmJsb2Nrcyk7CisJaTkxNV9idWRkeV9maW5pKCZtbSk7CisJcmV0dXJuIGVycjsKK30K
Kworc3RhdGljIGludCBpZ3RfYnVkZHlfYWxsb2NfcmFuZ2Uodm9pZCAqYXJnKQoreworCXN0cnVj
dCBpOTE1X2J1ZGR5X21tIG1tOworCXVuc2lnbmVkIGxvbmcgcGFnZV9udW07CisJTElTVF9IRUFE
KGJsb2Nrcyk7CisJdTY0IGNodW5rX3NpemU7CisJdTY0IG9mZnNldDsKKwl1NjQgc2l6ZTsKKwl1
NjQgcmVtOworCWludCBlcnI7CisKKwlpZ3RfbW1fY29uZmlnKCZzaXplLCAmY2h1bmtfc2l6ZSk7
CisKKwlwcl9pbmZvKCJidWRkeV9pbml0IHdpdGggc2l6ZT0lbGx4LCBjaHVua19zaXplPSVsbHhc
biIsIHNpemUsIGNodW5rX3NpemUpOworCisJZXJyID0gaTkxNV9idWRkeV9pbml0KCZtbSwgc2l6
ZSwgY2h1bmtfc2l6ZSk7CisJaWYgKGVycikgeworCQlwcl9lcnIoImJ1ZGR5X2luaXQgZmFpbGVk
KCVkKVxuIiwgZXJyKTsKKwkJcmV0dXJuIGVycjsKKwl9CisKKwllcnIgPSBpZ3RfY2hlY2tfbW0o
Jm1tKTsKKwlpZiAoZXJyKSB7CisJCXByX2VycigicHJlLW1tIGNoZWNrIGZhaWxlZCwgYWJvcnQs
IGFib3J0LCBhYm9ydCFcbiIpOworCQlnb3RvIGVycl9maW5pOworCX0KKworCXJlbSA9IG1tLnNp
emU7CisJb2Zmc2V0ID0gMDsKKworCWZvcl9lYWNoX3ByaW1lX251bWJlcl9mcm9tKHBhZ2VfbnVt
LCAxLCBVTE9OR19NQVggLSAxKSB7CisJCXN0cnVjdCBpOTE1X2J1ZGR5X2Jsb2NrICpibG9jazsK
KwkJTElTVF9IRUFEKHRtcCk7CisKKwkJc2l6ZSA9IG1pbihwYWdlX251bSAqIG1tLmNodW5rX3Np
emUsIHJlbSk7CisKKwkJZXJyID0gaTkxNV9idWRkeV9hbGxvY19yYW5nZSgmbW0sICZ0bXAsIG9m
ZnNldCwgc2l6ZSk7CisJCWlmIChlcnIpIHsKKwkJCWlmIChlcnIgPT0gLUVOT01FTSkgeworCQkJ
CXByX2luZm8oImFsbG9jX3JhbmdlIGhpdCAtRU5PTUVNIHdpdGggc2l6ZT0lbGx4XG4iLAorCQkJ
CQlzaXplKTsKKwkJCX0gZWxzZSB7CisJCQkJcHJfZXJyKCJhbGxvY19yYW5nZSB3aXRoIG9mZnNl
dD0lbGx4LCBzaXplPSVsbHggZmFpbGVkKCVkKVxuIiwKKwkJCQkgICAgICAgb2Zmc2V0LCBzaXpl
LCBlcnIpOworCQkJfQorCisJCQlicmVhazsKKwkJfQorCisJCWJsb2NrID0gbGlzdF9maXJzdF9l
bnRyeV9vcl9udWxsKCZ0bXAsCisJCQkJCQkgc3RydWN0IGk5MTVfYnVkZHlfYmxvY2ssCisJCQkJ
CQkgbGluayk7CisJCWlmICghYmxvY2spIHsKKwkJCXByX2VycigiYWxsb2NfcmFuZ2UgaGFzIG5v
IGJsb2Nrc1xuIik7CisJCQllcnIgPSAtRUlOVkFMOworCQl9CisKKwkJaWYgKGk5MTVfYnVkZHlf
YmxvY2tfb2Zmc2V0KGJsb2NrKSAhPSBvZmZzZXQpIHsKKwkJCXByX2VycigiYWxsb2NfcmFuZ2Ug
c3RhcnQgb2Zmc2V0IG1pc21hdGNoLCBmb3VuZD0lbGx4LCBleHBlY3RlZD0lbGx4XG4iLAorCQkJ
ICAgICAgIGk5MTVfYnVkZHlfYmxvY2tfb2Zmc2V0KGJsb2NrKSwgb2Zmc2V0KTsKKwkJCWVyciA9
IC1FSU5WQUw7CisJCX0KKworCQlpZiAoIWVycikKKwkJCWVyciA9IGlndF9jaGVja19ibG9ja3Mo
Jm1tLCAmdG1wLCBzaXplLCB0cnVlKTsKKworCQlsaXN0X3NwbGljZV90YWlsKCZ0bXAsICZibG9j
a3MpOworCisJCWlmIChlcnIpCisJCQlicmVhazsKKworCQlvZmZzZXQgKz0gc2l6ZTsKKworCQly
ZW0gLT0gc2l6ZTsKKwkJaWYgKCFyZW0pCisJCQlicmVhazsKKwl9CisKKwlpZiAoZXJyID09IC1F
Tk9NRU0pCisJCWVyciA9IDA7CisKKwlpOTE1X2J1ZGR5X2ZyZWVfbGlzdCgmbW0sICZibG9ja3Mp
OworCisJaWYgKCFlcnIpIHsKKwkJZXJyID0gaWd0X2NoZWNrX21tKCZtbSk7CisJCWlmIChlcnIp
CisJCQlwcl9lcnIoInBvc3QtbW0gY2hlY2sgZmFpbGVkXG4iKTsKKwl9CisKK2Vycl9maW5pOgor
CWk5MTVfYnVkZHlfZmluaSgmbW0pOworCisJcmV0dXJuIGVycjsKK30KKworaW50IGk5MTVfYnVk
ZHlfbW9ja19zZWxmdGVzdHModm9pZCkKK3sKKwlzdGF0aWMgY29uc3Qgc3RydWN0IGk5MTVfc3Vi
dGVzdCB0ZXN0c1tdID0geworCQlTVUJURVNUKGlndF9idWRkeV9hbGxvY19wZXNzaW1pc3RpYyks
CisJCVNVQlRFU1QoaWd0X2J1ZGR5X2FsbG9jX29wdGltaXN0aWMpLAorCQlTVUJURVNUKGlndF9i
dWRkeV9hbGxvY19wYXRob2xvZ2ljYWwpLAorCQlTVUJURVNUKGlndF9idWRkeV9hbGxvY19zbW9r
ZSksCisJCVNVQlRFU1QoaWd0X2J1ZGR5X2FsbG9jX3JhbmdlKSwKKwl9OworCisJcmV0dXJuIGk5
MTVfc3VidGVzdHModGVzdHMsIE5VTEwpOworfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL2k5MTVfbW9ja19zZWxmdGVzdHMuaCBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pOTE1X21vY2tfc2VsZnRlc3RzLmgKaW5kZXggYjU1ZGE0ZDljY2JhLi5i
ODgwODRmZTMyNjkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
OTE1X21vY2tfc2VsZnRlc3RzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3Rz
L2k5MTVfbW9ja19zZWxmdGVzdHMuaApAQCAtMjUsMyArMjUsNCBAQCBzZWxmdGVzdChldmljdCwg
aTkxNV9nZW1fZXZpY3RfbW9ja19zZWxmdGVzdHMpCiBzZWxmdGVzdChndHQsIGk5MTVfZ2VtX2d0
dF9tb2NrX3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KGh1Z2VwYWdlcywgaTkxNV9nZW1faHVnZV9wYWdl
X21vY2tfc2VsZnRlc3RzKQogc2VsZnRlc3QoY29udGV4dHMsIGk5MTVfZ2VtX2NvbnRleHRfbW9j
a19zZWxmdGVzdHMpCitzZWxmdGVzdChidWRkeSwgaTkxNV9idWRkeV9tb2NrX3NlbGZ0ZXN0cykK
LS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
Cmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

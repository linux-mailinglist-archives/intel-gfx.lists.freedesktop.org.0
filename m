Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id B8A9C41FC7
	for <lists+intel-gfx@lfdr.de>; Wed, 12 Jun 2019 10:53:15 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 2332789274;
	Wed, 12 Jun 2019 08:53:14 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id CE82689274
 for <intel-gfx@lists.freedesktop.org>; Wed, 12 Jun 2019 08:53:12 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16873250-1500050 
 for multiple; Wed, 12 Jun 2019 09:52:46 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 12 Jun 2019 09:52:46 +0100
Message-Id: <20190612085246.16374-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: Prevent lock-cycles between GPU waits
 and GPU resets
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgY2Fubm90IGFsbG93IG91cnNlbHZlcyB0byB3YWl0IG9uIHRoZSBHUFUgd2hpbGUgaG9sZGlu
ZyBhbnkgbG9jayB3ZQptYXkgbmVlZCB0byByZXNldCB0aGUgR1BVLiBXaGlsZSB0aGVyZSBpcyBu
b3QgYW4gZXhwbGljaXQgbG9jayBiZXR3ZWVuCnRoZSB0d28gb3BlcmF0aW9ucywgbG9ja2RlcCBj
YW5ub3QgZGV0ZWN0IHRoZSBkZXBlbmRlbmN5LiBTbyBsZXQncyB0ZWxsCmxvY2tkZXAgYWJvdXQg
dGhlIHdhaXQvcmVzZXQgZGVwZW5kZW5jeSB3aXRoIGFuIGV4cGxpY2l0IGxvY2ttYXAuCgpTaWdu
ZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IE1p
a2EgS3VvcHBhbGEgPG1pa2Eua3VvcHBhbGFAbGludXguaW50ZWwuY29tPgpDYzogVHZydGtvIFVy
c3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KLS0tClRoaXMgaXMgKmFubm95aW5nbHkq
IGdvb2QgYXQgZGV0ZWN0aW5nIGxvY2sgY3ljbGVzIGluIEdQVSByZXNldC4KLUNocmlzCi0tLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYyAgICAgICAgICAgIHwgNSArKysr
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAgICAgICAgICAgICAgICAgIHwgOCAr
KysrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyAgICAgICAgICAgICAgICAg
IHwgMyArKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jICAgICAgICAgICAg
ICB8IDIgKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2Uu
YyB8IDIgKysKIDUgZmlsZXMgY2hhbmdlZCwgMTkgaW5zZXJ0aW9ucygrKSwgMSBkZWxldGlvbigt
KQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZXNldC5jCmluZGV4IDYwZDI0MTEwYWY4MC4u
NjM2OGIzN2YyNmQxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9y
ZXNldC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3Jlc2V0LmMKQEAgLTk3
OCwxMCArOTc4LDExIEBAIHZvaWQgaTkxNV9yZXNldChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSwKIAogCW1pZ2h0X3NsZWVwKCk7CiAJR0VNX0JVR19PTighdGVzdF9iaXQoSTkxNV9SRVNF
VF9CQUNLT0ZGLCAmZXJyb3ItPmZsYWdzKSk7CisJbG9ja19tYXBfYWNxdWlyZSgmaTkxNS0+Z3Qu
cmVzZXRfbG9ja21hcCk7CiAKIAkvKiBDbGVhciBhbnkgcHJldmlvdXMgZmFpbGVkIGF0dGVtcHRz
IGF0IHJlY292ZXJ5LiBUaW1lIHRvIHRyeSBhZ2Fpbi4gKi8KIAlpZiAoIV9faTkxNV9nZW1fdW5z
ZXRfd2VkZ2VkKGk5MTUpKQotCQlyZXR1cm47CisJCWdvdG8gdW5sb2NrOwogCiAJaWYgKHJlYXNv
bikKIAkJZGV2X25vdGljZShpOTE1LT5kcm0uZGV2LCAiUmVzZXR0aW5nIGNoaXAgZm9yICVzXG4i
LCByZWFzb24pOwpAQCAtMTAyOSw2ICsxMDMwLDggQEAgdm9pZCBpOTE1X3Jlc2V0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCiBmaW5pc2g6CiAJcmVzZXRfZmluaXNoKGk5MTUpOwor
dW5sb2NrOgorCWxvY2tfbWFwX3JlbGVhc2UoJmk5MTUtPmd0LnJlc2V0X2xvY2ttYXApOwogCXJl
dHVybjsKIAogdGFpbnQ6CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Ry
di5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAppbmRleCAwZWE3Zjc4YWUyMjcu
LjljZmE5NTAwZmNjNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYu
aAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCkBAIC0xOTE5LDYgKzE5MTks
MTQgQEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgewogCQlrdGltZV90IGxhc3RfaW5pdF90aW1l
OwogCiAJCXN0cnVjdCBpOTE1X3ZtYSAqc2NyYXRjaDsKKworCQkvKgorCQkgKiBXZSBtdXN0IG5l
dmVyIHdhaXQgb24gdGhlIEdQVSB3aGlsZSBob2xkaW5nIGEgbG9jayB3ZSBtYXkKKwkJICogbmVl
ZCB0byBwZXJmb3JtIGEgR1BVIHJlc2V0LiBTbyB3aGlsZSB3ZSBkb24ndCBuZWVkIHRvCisJCSAq
IHNlcmlhbGlzZSB3YWl0L3Jlc2V0IHdpdGggYW4gZXhwbGljaXQgbG9jaywgd2UgZG8gd2FudAor
CQkgKiBsb2NrZGVwIHRvIGRldGVjdCBwb3RlbnRpYWwgZGVwZW5kZW5jeSBjeWNsZXMuCisJCSAq
LworCQlzdHJ1Y3QgbG9ja2RlcF9tYXAgcmVzZXRfbG9ja21hcDsKIAl9IGd0OwogCiAJc3RydWN0
IHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IGU5ODBjMWVlM2RjZi4uMjRmMGYzZGIxYmZi
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTE3ODIsNiArMTc4Miw3IEBAIHN0YXRpYyB2
b2lkIGk5MTVfZ2VtX2luaXRfX21tKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCiBp
bnQgaTkxNV9nZW1faW5pdF9lYXJseShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiB7CisJc3RhdGljIHN0cnVjdCBsb2NrX2NsYXNzX2tleSByZXNldF9rZXk7CiAJaW50IGVycjsK
IAogCWludGVsX2d0X3BtX2luaXQoZGV2X3ByaXYpOwpAQCAtMTc4OSw2ICsxNzkwLDggQEAgaW50
IGk5MTVfZ2VtX2luaXRfZWFybHkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQog
CUlOSVRfTElTVF9IRUFEKCZkZXZfcHJpdi0+Z3QuYWN0aXZlX3JpbmdzKTsKIAlJTklUX0xJU1Rf
SEVBRCgmZGV2X3ByaXYtPmd0LmNsb3NlZF92bWEpOwogCXNwaW5fbG9ja19pbml0KCZkZXZfcHJp
di0+Z3QuY2xvc2VkX2xvY2spOworCWxvY2tkZXBfaW5pdF9tYXAoJmRldl9wcml2LT5ndC5yZXNl
dF9sb2NrbWFwLAorCQkJICJpOTE1LnJlc2V0IiwgJnJlc2V0X2tleSwgMCk7CiAKIAlpOTE1X2dl
bV9pbml0X19tbShkZXZfcHJpdik7CiAJaTkxNV9nZW1faW5pdF9fcG0oZGV2X3ByaXYpOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYwppbmRleCAxYTk0ODQ3MTgyOWQuLmNkNGNlNDRkYzRl
NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKQEAgLTE0NDQsNiArMTQ0NCw3IEBA
IGxvbmcgaTkxNV9yZXF1ZXN0X3dhaXQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCiAJCXJldHVy
biAtRVRJTUU7CiAKIAl0cmFjZV9pOTE1X3JlcXVlc3Rfd2FpdF9iZWdpbihycSwgZmxhZ3MpOwor
CWxvY2tfbWFwX2FjcXVpcmUoJnJxLT5pOTE1LT5ndC5yZXNldF9sb2NrbWFwKTsKIAogCS8qCiAJ
ICogT3B0aW1pc3RpYyBzcGluIGJlZm9yZSB0b3VjaGluZyBJUlFzLgpAQCAtMTUxNyw2ICsxNTE4
LDcgQEAgbG9uZyBpOTE1X3JlcXVlc3Rfd2FpdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKIAlk
bWFfZmVuY2VfcmVtb3ZlX2NhbGxiYWNrKCZycS0+ZmVuY2UsICZ3YWl0LmNiKTsKIAogb3V0Ogor
CWxvY2tfbWFwX3JlbGVhc2UoJnJxLT5pOTE1LT5ndC5yZXNldF9sb2NrbWFwKTsKIAl0cmFjZV9p
OTE1X3JlcXVlc3Rfd2FpdF9lbmQocnEpOwogCXJldHVybiB0aW1lb3V0OwogfQpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jCmluZGV4IGI3ZjNm
YmI0YWU4OS4uMWU5ZmZjZWQ3OGMxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2Vs
ZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jCkBAIC0xMzAsNiArMTMwLDcgQEAgc3RhdGljIHN0cnVj
dCBkZXZfcG1fZG9tYWluIHBtX2RvbWFpbiA9IHsKIAogc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Km1vY2tfZ2VtX2RldmljZSh2b2lkKQogeworCXN0YXRpYyBzdHJ1Y3QgbG9ja19jbGFzc19rZXkg
cmVzZXRfa2V5OwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1OwogCXN0cnVjdCBwY2lf
ZGV2ICpwZGV2OwogCWludCBlcnI7CkBAIC0yMDQsNiArMjA1LDcgQEAgc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKm1vY2tfZ2VtX2RldmljZSh2b2lkKQogCUlOSVRfTElTVF9IRUFEKCZpOTE1LT5n
dC5hY3RpdmVfcmluZ3MpOwogCUlOSVRfTElTVF9IRUFEKCZpOTE1LT5ndC5jbG9zZWRfdm1hKTsK
IAlzcGluX2xvY2tfaW5pdCgmaTkxNS0+Z3QuY2xvc2VkX2xvY2spOworCWxvY2tkZXBfaW5pdF9t
YXAoJmk5MTUtPmd0LnJlc2V0X2xvY2ttYXAsICJpOTE1LnJlc2V0IiwgJnJlc2V0X2tleSwgMCk7
CiAKIAltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAotLSAKMi4yMC4xCgpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZngg
bWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0
cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

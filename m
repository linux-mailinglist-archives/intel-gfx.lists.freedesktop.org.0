Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 430E05BAC8
	for <lists+intel-gfx@lfdr.de>; Mon,  1 Jul 2019 13:34:53 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 8319289CA1;
	Mon,  1 Jul 2019 11:34:51 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga11.intel.com (mga11.intel.com [192.55.52.93])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 989BA89CAD
 for <intel-gfx@lists.freedesktop.org>; Mon,  1 Jul 2019 11:34:50 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga004.fm.intel.com ([10.253.24.48])
 by fmsmga102.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 01 Jul 2019 04:34:50 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,439,1557212400"; d="scan'208";a="186455072"
Received: from unknown (HELO delly.ger.corp.intel.com) ([10.249.141.63])
 by fmsmga004.fm.intel.com with ESMTP; 01 Jul 2019 04:34:49 -0700
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  1 Jul 2019 14:34:31 +0300
Message-Id: <20190701113437.4043-6-lionel.g.landwerlin@intel.com>
X-Mailer: git-send-email 2.21.0.392.gf8f6787159e
In-Reply-To: <20190701113437.4043-1-lionel.g.landwerlin@intel.com>
References: <20190701113437.4043-1-lionel.g.landwerlin@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v6 05/11] drm/i915/perf: implement active wait
 for noa configurations
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Tk9BIGNvbmZpZ3VyYXRpb24gdGFrZSBzb21lIGFtb3VudCBvZiB0aW1lIHRvIGFwcGx5LiBUaGF0
IGFtb3VudCBvZgp0aW1lIGRlcGVuZHMgb24gdGhlIHNpemUgb2YgdGhlIEdULiBUaGVyZSBpcyBu
byBkb2N1bWVudGVkIHRpbWUgZm9yCnRoaXMuIEZvciBleGFtcGxlLCBwYXN0IGV4cGVyaW1lbnRh
dGlvbnMgd2l0aCBwb3dlcmdhdGluZwpjb25maWd1cmF0aW9uIGNoYW5nZXMgc2VlbSB0byBpbmRp
Y2F0ZSBhIDYwfjcwdXMgZGVsYXkuIFdlIGdvIHdpdGgKNTAwdXMgYXMgZGVmYXVsdCBmb3Igbm93
IHdoaWNoIHNob3VsZCBiZSBvdmVyIHRoZSByZXF1aXJlZCBhbW91bnQgb2YKdGltZSAoYWNjb3Jk
aW5nIHRvIEhXIGFyY2hpdGVjdHMpLgoKdjI6IERvbid0IGZvcmdldCB0byBzYXZlL3Jlc3RvcmUg
cmVnaXN0ZXJzIHVzZWQgZm9yIHRoZSB3YWl0IChDaHJpcykKClNpZ25lZC1vZmYtYnk6IExpb25l
bCBMYW5kd2VybGluIDxsaW9uZWwuZy5sYW5kd2VybGluQGludGVsLmNvbT4KLS0tCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMuaCB8ICAyNCArKwogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaCAgICAgfCAgIDUgKwogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgICAgICAgICAgfCAgMjUgKysrCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2Rydi5oICAgICAgICAgICAgICB8ICAgOCArCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3BlcmYuYyAgICAgICAgICAgICB8IDIyNSArKysrKysrKysrKysrKysrKystCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oICAgICAgICAgICAgICB8ICAgNCArLQogNiBm
aWxlcyBjaGFuZ2VkLCAyODggaW5zZXJ0aW9ucygrKSwgMyBkZWxldGlvbnMoLSkKCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMuaCBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5oCmluZGV4IGU3ZWZmOWRiMzQz
ZS4uNGE2NmFmMzhjODdiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9ncHVfY29tbWFuZHMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ncHVf
Y29tbWFuZHMuaApAQCAtMTUxLDYgKzE1MSw3IEBACiAjZGVmaW5lICAgTUlfQkFUQ0hfR1RUCQkg
ICAgKDI8PDYpIC8qIGFsaWFzZWQgd2l0aCAoMTw8Nykgb24gZ2VuNCAqLwogI2RlZmluZSBNSV9C
QVRDSF9CVUZGRVJfU1RBUlRfR0VOOAlNSV9JTlNUUigweDMxLCAxKQogI2RlZmluZSAgIE1JX0JB
VENIX1JFU09VUkNFX1NUUkVBTUVSICgxPDwxMCkKKyNkZWZpbmUgICBNSV9CQVRDSF9QUkVESUNB
VEUgICAgICAgICAoMSA8PCAxNSkgLyogSFNXKyBvbiBSQ1Mgb25seSovCiAKIC8qCiAgKiAzRCBp
bnN0cnVjdGlvbnMgdXNlZCBieSB0aGUga2VybmVsCkBAIC0yMjYsNiArMjI3LDI5IEBACiAjZGVm
aW5lICAgUElQRV9DT05UUk9MX0RFUFRIX0NBQ0hFX0ZMVVNICQkoMTw8MCkKICNkZWZpbmUgICBQ
SVBFX0NPTlRST0xfR0xPQkFMX0dUVCAoMTw8MikgLyogaW4gYWRkciBkd29yZCAqLwogCisjZGVm
aW5lIE1JX01BVEgoeCkgTUlfSU5TVFIoMHgxYSwgKHgpLTEpCisjZGVmaW5lICAgTUlfQUxVX09Q
KG9wLCBzcmMxLCBzcmMyKSAoKChvcCkgPDwgMjApIHwgKChzcmMxKSA8PCAxMCkgfCAoc3JjMikp
CisvKiBvcGVyYW5kcyAqLworI2RlZmluZSAgIE1JX0FMVV9PUF9OT09QICAgICAwCisjZGVmaW5l
ICAgTUlfQUxVX09QX0xPQUQgICAgIDEyOAorI2RlZmluZSAgIE1JX0FMVV9PUF9MT0FESU5WICAx
MTUyCisjZGVmaW5lICAgTUlfQUxVX09QX0xPQUQwICAgIDEyOQorI2RlZmluZSAgIE1JX0FMVV9P
UF9MT0FEMSAgICAxMTUzCisjZGVmaW5lICAgTUlfQUxVX09QX0FERCAgICAgIDI1NgorI2RlZmlu
ZSAgIE1JX0FMVV9PUF9TVUIgICAgICAyNTcKKyNkZWZpbmUgICBNSV9BTFVfT1BfQU5EICAgICAg
MjU4CisjZGVmaW5lICAgTUlfQUxVX09QX09SICAgICAgIDI1OQorI2RlZmluZSAgIE1JX0FMVV9P
UF9YT1IgICAgICAyNjAKKyNkZWZpbmUgICBNSV9BTFVfT1BfU1RPUkUgICAgMzg0CisjZGVmaW5l
ICAgTUlfQUxVX09QX1NUT1JFSU5WIDE0MDgKKy8qIHNvdXJjZXMgKi8KKyNkZWZpbmUgICBNSV9B
TFVfU1JDX1JFRyh4KSAgKHgpIC8qIDAgLT4gMTUgKi8KKyNkZWZpbmUgICBNSV9BTFVfU1JDX1NS
Q0EgICAgMzIKKyNkZWZpbmUgICBNSV9BTFVfU1JDX1NSQ0IgICAgMzMKKyNkZWZpbmUgICBNSV9B
TFVfU1JDX0FDQ1UgICAgNDkKKyNkZWZpbmUgICBNSV9BTFVfU1JDX1pGICAgICAgNTAKKyNkZWZp
bmUgICBNSV9BTFVfU1JDX0NGICAgICAgNTEKKwogLyoKICAqIENvbW1hbmRzIHVzZWQgb25seSBi
eSB0aGUgY29tbWFuZCBwYXJzZXIKICAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0
X3R5cGVzLmgKaW5kZXggZTYyNWE1ZTMyMGQzLi4wNzUwYWM0OWEwNWIgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaApAQCAtNzAsNiArNzAsMTEgQEAgZW51bSBpbnRl
bF9ndF9zY3JhdGNoX2ZpZWxkIHsKIAkvKiA4IGJ5dGVzICovCiAJSU5URUxfR1RfU0NSQVRDSF9G
SUVMRF9DT0hFUkVOVEwzX1dBID0gMjU2LAogCisJLyogNiAqIDggYnl0ZXMgKi8KKwlJTlRFTF9H
VF9TQ1JBVENIX0ZJRUxEX1BFUkZfQ1NfR1BSID0gMjA0OCwKKworCS8qIDQgYnl0ZXMgKi8KKwlJ
TlRFTF9HVF9TQ1JBVENIX0ZJRUxEX1BFUkZfUFJFRElDQVRFX1JFU1VMVF8xID0gMjA5NiwKIH07
CiAKICNlbmRpZiAvKiBfX0lOVEVMX0dUX1RZUEVTX0hfXyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2RlYnVnZnMuYwppbmRleCBlZWVjZGFkMGUzY2EuLjZiNDlmZGExNDVlNyAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKQEAgLTM2NDYsNiArMzY0NiwzMCBAQCBERUZJTkVfU0lNUExF
X0FUVFJJQlVURShpOTE1X3dlZGdlZF9mb3BzLAogCQkJaTkxNV93ZWRnZWRfZ2V0LCBpOTE1X3dl
ZGdlZF9zZXQsCiAJCQkiJWxsdVxuIik7CiAKK3N0YXRpYyBpbnQKK2k5MTVfcGVyZl9ub2FfZGVs
YXlfc2V0KHZvaWQgKmRhdGEsIHU2NCB2YWwpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSBkYXRhOworCisJYXRvbWljNjRfc2V0KCZpOTE1LT5wZXJmLm9hLm5vYV9wcm9ncmFt
bWluZ19kZWxheSwgdmFsKTsKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludAoraTkxNV9wZXJm
X25vYV9kZWxheV9nZXQodm9pZCAqZGF0YSwgdTY0ICp2YWwpCit7CisJc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSBkYXRhOworCisJKnZhbCA9IGF0b21pYzY0X3JlYWQoJmk5MTUtPnBl
cmYub2Eubm9hX3Byb2dyYW1taW5nX2RlbGF5KTsKKwlyZXR1cm4gMDsKK30KKworREVGSU5FX1NJ
TVBMRV9BVFRSSUJVVEUoaTkxNV9wZXJmX25vYV9kZWxheV9mb3BzLAorCQkJaTkxNV9wZXJmX25v
YV9kZWxheV9nZXQsCisJCQlpOTE1X3BlcmZfbm9hX2RlbGF5X3NldCwKKwkJCSIlbGx1XG4iKTsK
KworCiAjZGVmaW5lIERST1BfVU5CT1VORAlCSVQoMCkKICNkZWZpbmUgRFJPUF9CT1VORAlCSVQo
MSkKICNkZWZpbmUgRFJPUF9SRVRJUkUJQklUKDIpCkBAIC00NDExLDYgKzQ0MzUsNyBAQCBzdGF0
aWMgY29uc3Qgc3RydWN0IGk5MTVfZGVidWdmc19maWxlcyB7CiAJY29uc3QgY2hhciAqbmFtZTsK
IAljb25zdCBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25zICpmb3BzOwogfSBpOTE1X2RlYnVnZnNfZmls
ZXNbXSA9IHsKKwl7Imk5MTVfcGVyZl9ub2FfZGVsYXkiLCAmaTkxNV9wZXJmX25vYV9kZWxheV9m
b3BzfSwKIAl7Imk5MTVfd2VkZ2VkIiwgJmk5MTVfd2VkZ2VkX2ZvcHN9LAogCXsiaTkxNV9jYWNo
ZV9zaGFyaW5nIiwgJmk5MTVfY2FjaGVfc2hhcmluZ19mb3BzfSwKIAl7Imk5MTVfZ2VtX2Ryb3Bf
Y2FjaGVzIiwgJmk5MTVfZHJvcF9jYWNoZXNfZm9wc30sCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaApp
bmRleCBkZjM5YjJlZTZiZDkuLmZlOTNhMjYwYmQyOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5o
CkBAIC0xODM3LDYgKzE4MzcsMTQgQEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgewogCiAJCQlz
dHJ1Y3QgaTkxNV9vYV9vcHMgb3BzOwogCQkJY29uc3Qgc3RydWN0IGk5MTVfb2FfZm9ybWF0ICpv
YV9mb3JtYXRzOworCisJCQkvKioKKwkJCSAqIEEgYmF0Y2ggYnVmZmVyIGRvaW5nIGEgd2FpdCBv
biB0aGUgR1BVIGZvciB0aGUgTk9BCisJCQkgKiBsb2dpYyB0byBiZSByZXByb2dyYW1tZWQuCisJ
CQkgKi8KKwkJCXN0cnVjdCBpOTE1X3ZtYSAqbm9hX3dhaXQ7CisKKwkJCWF0b21pYzY0X3Qgbm9h
X3Byb2dyYW1taW5nX2RlbGF5OwogCQl9IG9hOwogCX0gcGVyZjsKIApkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3BlcmYuYwppbmRleCA1YmE3NzE0NjgwNzguLjAzZTY5MDgyODJlMyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9wZXJmLmMKQEAgLTE5Nyw2ICsxOTcsNyBAQAogCiAjaW5jbHVkZSAiZ2VtL2k5MTVfZ2Vt
X2NvbnRleHQuaCIKICNpbmNsdWRlICJnZW0vaTkxNV9nZW1fcG0uaCIKKyNpbmNsdWRlICJndC9p
bnRlbF9ndC5oIgogI2luY2x1ZGUgImd0L2ludGVsX2xyY19yZWcuaCIKIAogI2luY2x1ZGUgImk5
MTVfZHJ2LmgiCkBAIC00MjksNyArNDMwLDcgQEAgc3RhdGljIGludCBhbGxvY19vYV9jb25maWdf
YnVmZmVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCQkgICAgICBNSV9MT0FE
X1JFR0lTVEVSX0lNTV9NQVhfUkVHUykgKiA0OwogCQljb25maWdfbGVuZ3RoICs9IG9hX2NvbmZp
Zy0+ZmxleF9yZWdzX2xlbiAqIDg7CiAJfQotCWNvbmZpZ19sZW5ndGggKz0gNDsgLyogTUlfQkFU
Q0hfQlVGRkVSX0VORCAqLworCWNvbmZpZ19sZW5ndGggKz0gMTI7IC8qIE1JX0JBVENIX0JVRkZF
Ul9TVEFSVCBpbnRvIG5vYV93YWl0IGxvb3AgKi8KIAljb25maWdfbGVuZ3RoID0gQUxJR04oY29u
ZmlnX2xlbmd0aCwgSTkxNV9HVFRfUEFHRV9TSVpFKTsKIAogCWJvID0gaTkxNV9nZW1fb2JqZWN0
X2NyZWF0ZV9zaG1lbShpOTE1LCBjb25maWdfbGVuZ3RoKTsKQEAgLTQ0Niw3ICs0NDcsMTIgQEAg
c3RhdGljIGludCBhbGxvY19vYV9jb25maWdfYnVmZmVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAogCWNzID0gd3JpdGVfY3NfbWlfbHJpKGNzLCBvYV9jb25maWctPmJfY291bnRlcl9y
ZWdzLCBvYV9jb25maWctPmJfY291bnRlcl9yZWdzX2xlbik7CiAJY3MgPSB3cml0ZV9jc19taV9s
cmkoY3MsIG9hX2NvbmZpZy0+ZmxleF9yZWdzLCBvYV9jb25maWctPmZsZXhfcmVnc19sZW4pOwog
Ci0JKmNzKysgPSBNSV9CQVRDSF9CVUZGRVJfRU5EOworCisJLyogSnVtcCBpbnRvIHRoZSBOT0Eg
d2FpdCBidXN5IGxvb3AuICovCisJKmNzKysgPSAoSU5URUxfR0VOKGk5MTUpIDwgOCA/CisJCSBN
SV9CQVRDSF9CVUZGRVJfU1RBUlQgOiBNSV9CQVRDSF9CVUZGRVJfU1RBUlRfR0VOOCk7CisJKmNz
KysgPSBpOTE1X2dndHRfb2Zmc2V0KGk5MTUtPnBlcmYub2Eubm9hX3dhaXQpOworCSpjcysrID0g
MDsKIAogCWk5MTVfZ2VtX29iamVjdF9mbHVzaF9tYXAoYm8pOwogCWk5MTVfZ2VtX29iamVjdF91
bnBpbl9tYXAoYm8pOwpAQCAtMTQ2Nyw2ICsxNDczLDcgQEAgc3RhdGljIHZvaWQgaTkxNV9vYV9z
dHJlYW1fZGVzdHJveShzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogCW11dGV4X2xv
Y2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIAlkZXZfcHJpdi0+cGVyZi5vYS5leGNs
dXNpdmVfc3RyZWFtID0gTlVMTDsKIAlkZXZfcHJpdi0+cGVyZi5vYS5vcHMuZGlzYWJsZV9tZXRy
aWNfc2V0KGRldl9wcml2KTsKKwlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmZGV2X3ByaXYt
PnBlcmYub2Eubm9hX3dhaXQsIDApOwogCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCiAJZnJlZV9vYV9idWZmZXIoZGV2X3ByaXYpOwpAQCAtMTY1Myw2ICsxNjYw
LDIwNCBAQCBzdGF0aWMgaW50IGFsbG9jX29hX2J1ZmZlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYpCiAJcmV0dXJuIHJldDsKIH0KIAorc3RhdGljIHUzMiAqc2F2ZV9yZWdpc3Rl
cihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgdTMyICpjcywKKwkJCSAgaTkxNV9yZWdf
dCByZWcsIHUzMiBvZmZzZXQsIHUzMiBkd29yZF9jb3VudCkKK3sKKwl1aW50MzJfdCBkOworCisJ
Zm9yIChkID0gMDsgZCA8IGR3b3JkX2NvdW50OyBkKyspIHsKKwkJKmNzKysgPSBJTlRFTF9HRU4o
aTkxNSkgPj0gOCA/CisJCQlNSV9TVE9SRV9SRUdJU1RFUl9NRU1fR0VOOCA6IE1JX1NUT1JFX1JF
R0lTVEVSX01FTTsKKwkJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChyZWcpICsgNCAqIGQ7
CisJCSpjcysrID0gaW50ZWxfZ3Rfc2NyYXRjaF9vZmZzZXQoJmk5MTUtPmd0LCBvZmZzZXQpICsg
NCAqIGQ7CisJCWlmIChJTlRFTF9HRU4oaTkxNSkgPj0gOCkKKwkJCSpjcysrID0gMDsKKwl9CisK
KwlyZXR1cm4gY3M7Cit9CisKK3N0YXRpYyB1MzIgKnJlc3RvcmVfcmVnaXN0ZXIoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsIHUzMiAqY3MsCisJCQkgICAgIGk5MTVfcmVnX3QgcmVnLCB1
MzIgb2Zmc2V0LCB1MzIgZHdvcmRfY291bnQpCit7CisJdWludDMyX3QgZDsKKworCWZvciAoZCA9
IDA7IGQgPCBkd29yZF9jb3VudDsgZCsrKSB7CisJCSpjcysrID0gSU5URUxfR0VOKGk5MTUpID49
IDggPworCQkJTUlfTE9BRF9SRUdJU1RFUl9NRU1fR0VOOCA6IE1JX0xPQURfUkVHSVNURVJfTUVN
OworCQkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KHJlZyk7CisJCSpjcysrID0gaW50ZWxf
Z3Rfc2NyYXRjaF9vZmZzZXQoJmk5MTUtPmd0LCBvZmZzZXQpOworCQlpZiAoSU5URUxfR0VOKGk5
MTUpID49IDgpCisJCQkqY3MrKyA9IDA7CisJfQorCisJcmV0dXJuIGNzOworfQorCitzdGF0aWMg
aW50IGFsbG9jX25vYV93YWl0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQoreworCXN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpibzsKKwlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKKwl1
NjQgZGVsYXlfbnMgPSBhdG9taWM2NF9yZWFkKCZpOTE1LT5wZXJmLm9hLm5vYV9wcm9ncmFtbWlu
Z19kZWxheSksIGRlbGF5X3RpY2tzOworCXUzMiAqYmF0Y2gsICp0czAsICpjcywgKmp1bXA7CisJ
aW50IHJldCwgaTsKKworCWJvID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9zaG1lbShpOTE1LCA0
MDk2KTsKKwlpZiAoSVNfRVJSKGJvKSkgeworCQlEUk1fRVJST1IoIkZhaWxlZCB0byBhbGxvY2F0
ZSBOT0Egd2FpdCBiYXRjaGJ1ZmZlclxuIik7CisJCXJldHVybiBQVFJfRVJSKGJvKTsKKwl9CisK
KwkvKgorCSAqIFdlIHBpbiBpbiBHR1RUIGJlY2F1c2Ugd2UganVtcCBpbnRvIHRoaXMgYnVmZmVy
IG5vdyBiZWNhdXNlCisJICogbXVsdGlwbGUgT0EgY29uZmlnIEJPcyB3aWxsIGhhdmUgYSBqdW1w
IHRvIHRoaXMgYWRkcmVzcyBhbmQgaXQKKwkgKiBuZWVkcyB0byBiZSBmaXhlZCBkdXJpbmcgdGhl
IGxpZmV0aW1lIG9mIHRoZSBpOTE1L3BlcmYgc3RyZWFtLgorCSAqLworCXZtYSA9IGk5MTVfZ2Vt
X29iamVjdF9nZ3R0X3BpbihibywgTlVMTCwgMCwgNDA5NiwgMCk7CisJaWYgKElTX0VSUih2bWEp
KSB7CisJCXJldCA9IFBUUl9FUlIodm1hKTsKKwkJZ290byBlcnJfdW5yZWY7CisJfQorCisJYmF0
Y2ggPSBjcyA9IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKGJvLCBJOTE1X01BUF9XQik7CisJaWYg
KElTX0VSUihiYXRjaCkpIHsKKwkJcmV0ID0gUFRSX0VSUihiYXRjaCk7CisJCWdvdG8gZXJyX3Vu
cGluOworCX0KKworCS8qIFNhdmUgcmVnaXN0ZXJzLiAqLworCWZvciAoaSA9IDA7IGkgPD0gNTsg
aSsrKSB7CisJCWNzID0gc2F2ZV9yZWdpc3RlcihpOTE1LCBjcywgSFNXX0NTX0dQUihpKSwKKwkJ
CQkgICBJTlRFTF9HVF9TQ1JBVENIX0ZJRUxEX1BFUkZfQ1NfR1BSICsgOCAqIGksIDIpOworCX0K
KwljcyA9IHNhdmVfcmVnaXN0ZXIoaTkxNSwgY3MsIE1JX1BSRURJQ0FURV9SRVNVTFRfMSwKKwkJ
CSAgIElOVEVMX0dUX1NDUkFUQ0hfRklFTERfUEVSRl9QUkVESUNBVEVfUkVTVUxUXzEsIDEpOwor
CisJLyogRmlyc3QgdGltZXN0YW1wIHNuYXBzaG90IGxvY2F0aW9uLiAqLworCXRzMCA9IGNzOwor
CisJLyoKKwkgKiBJbml0aWFsIHNuYXBzaG90IG9mIHRoZSB0aW1lc3RhbXAgcmVnaXN0ZXIgdG8g
aW1wbGVtZW50IHRoZSB3YWl0LgorCSAqIFdlIHdvcmsgd2l0aCAzMmIgdmFsdWVzLCBzbyBjbGVh
ciBvdXQgdGhlIHRvcCAzMmIgYml0cyBvZiB0aGUKKwkgKiByZWdpc3RlciBiZWNhdXNlIHRoZSBB
TFUgd29ya3MgNjRiaXRzLgorCSAqLworCSpjcysrID0gTUlfTE9BRF9SRUdJU1RFUl9JTU0oMSk7
CisJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChIU1dfQ1NfR1BSKDApKSArIDQ7CisJKmNz
KysgPSAwOworCSpjcysrID0gTUlfTE9BRF9SRUdJU1RFUl9SRUcgfCAoMyAtIDIpOworCSpjcysr
ID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQoUklOR19USU1FU1RBTVAoUkVOREVSX1JJTkdfQkFTRSkp
OworCSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQoSFNXX0NTX0dQUigwKSk7CisKKwkvKgor
CSAqIFRoaXMgaXMgdGhlIGxvY2F0aW9uIHdlJ3JlIGdvaW5nIHRvIGp1bXAgYmFjayBpbnRvIHVu
dGlsIHRoZQorCSAqIHJlcXVpcmVkIGFtb3VudCBvZiB0aW1lIGhhcyBwYXNzZWQuCisJICovCisJ
anVtcCA9IGNzOworCisJLyoKKwkgKiBUYWtlIGFub3RoZXIgc25hcHNob3Qgb2YgdGhlIHRpbWVz
dGFtcCByZWdpc3Rlci4gVGFrZSBjYXJlIHRvIGNsZWFyCisJICogdXAgdGhlIHRvcCAzMmJpdHMg
b2YgQ1NfR1BSKDEpIGFzIHdlJ3JlIHVzaW5nIGl0IGZvciBvdGhlcgorCSAqIG9wZXJhdGlvbnMg
YmVsb3cuCisJICovCisJKmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX0lNTSgxKTsKKwkqY3MrKyA9
IGk5MTVfbW1pb19yZWdfb2Zmc2V0KEhTV19DU19HUFIoMSkpICsgNDsKKwkqY3MrKyA9IDA7CisJ
KmNzKysgPSBNSV9MT0FEX1JFR0lTVEVSX1JFRyB8ICgzIC0gMik7CisJKmNzKysgPSBpOTE1X21t
aW9fcmVnX29mZnNldChSSU5HX1RJTUVTVEFNUChSRU5ERVJfUklOR19CQVNFKSk7CisJKmNzKysg
PSBpOTE1X21taW9fcmVnX29mZnNldChIU1dfQ1NfR1BSKDEpKTsKKworCS8qCisJICogRG8gYSBk
aWZmIGJldHdlZW4gdGhlIDIgdGltZXN0YW1wcyBhbmQgc3RvcmUgdGhlIHJlc3VsdCBiYWNrIGlu
dG8KKwkgKiBDU19HUFIoMSkuCisJICovCisJKmNzKysgPSBNSV9NQVRIKDUpOworCSpjcysrID0g
TUlfQUxVX09QKE1JX0FMVV9PUF9MT0FELCBNSV9BTFVfU1JDX1NSQ0EsIE1JX0FMVV9TUkNfUkVH
KDEpKTsKKwkqY3MrKyA9IE1JX0FMVV9PUChNSV9BTFVfT1BfTE9BRCwgTUlfQUxVX1NSQ19TUkNC
LCBNSV9BTFVfU1JDX1JFRygwKSk7CisJKmNzKysgPSBNSV9BTFVfT1AoTUlfQUxVX09QX1NVQiwg
MCwgMCk7CisJKmNzKysgPSBNSV9BTFVfT1AoTUlfQUxVX09QX1NUT1JFLCBNSV9BTFVfU1JDX1JF
RygyKSwgTUlfQUxVX1NSQ19BQ0NVKTsKKwkqY3MrKyA9IE1JX0FMVV9PUChNSV9BTFVfT1BfU1RP
UkUsIE1JX0FMVV9TUkNfUkVHKDMpLCBNSV9BTFVfU1JDX0NGKTsKKworCS8qCisJICogVHJhbnNm
ZXIgdGhlIGNhcnJ5IGZsYWcgKHNldCB0byAxIGlmIHRzMSA8IHRzMCwgbWVhbmluZyB0aGUKKwkg
KiB0aW1lc3RhbXAgaGF2ZSByb2xsZWQgb3ZlciB0aGUgMzJiaXRzKSBpbnRvIHRoZSBwcmVkaWNh
dGUgcmVnaXN0ZXIKKwkgKiB0byBiZSB1c2VkIGZvciB0aGUgcHJlZGljYXRlZCBqdW1wLgorCSAq
LworCSpjcysrID0gTUlfTE9BRF9SRUdJU1RFUl9SRUcgfCAoMyAtIDIpOworCSpjcysrID0gaTkx
NV9tbWlvX3JlZ19vZmZzZXQoSFNXX0NTX0dQUigzKSk7CisJKmNzKysgPSBpOTE1X21taW9fcmVn
X29mZnNldChNSV9QUkVESUNBVEVfUkVTVUxUXzEpOworCisJLyogUmVzdGFydCBmcm9tIHRoZSBi
ZWdpbm5pbmcgaWYgd2UgaGFkIHRpbWVzdGFtcHMgcm9sbCBvdmVyLiAqLworCSpjcysrID0gKElO
VEVMX0dFTihpOTE1KSA8IDggPworCQkgTUlfQkFUQ0hfQlVGRkVSX1NUQVJUIDogTUlfQkFUQ0hf
QlVGRkVSX1NUQVJUX0dFTjgpIHwKKwkJTUlfQkFUQ0hfUFJFRElDQVRFOworCSpjcysrID0gdm1h
LT5ub2RlLnN0YXJ0OworCSpjcysrID0gMDsKKworCS8qCisJICogTm93IGFkZCB0aGUgZGlmZiBi
ZXR3ZWVuIHRvIHByZXZpb3VzIHRpbWVzdGFtcHMgYW5kIGFkZCBpdCB0byA6CisJICogICAgICAo
KCgxICogPDwgNjQpIC0gMSkgLSBkZWxheV9ucykKKwkgKgorCSAqIFdoZW4gdGhlIENhcnJ5IEZs
YWcgY29udGFpbnMgMSB0aGlzIG1lYW5zIHRoZSBlbGFwc2VkIHRpbWUgaXMKKwkgKiBsb25nZXIg
dGhhbiB0aGUgZXhwZWN0ZWQgZGVsYXksIGFuZCB3ZSBjYW4gZXhpdCB0aGUgd2FpdCBsb29wLgor
CSAqLworCWRlbGF5X3RpY2tzID0gMHhmZmZmZmZmZmZmZmZmZmZmIC0KKwkJRElWNjRfVTY0X1JP
VU5EX1VQKGRlbGF5X25zICoKKwkJCQkgICBSVU5USU1FX0lORk8oaTkxNSktPmNzX3RpbWVzdGFt
cF9mcmVxdWVuY3lfa2h6LAorCQkJCSAgIDEwMDAwMDB1bGwpOworCSpjcysrID0gTUlfTE9BRF9S
RUdJU1RFUl9JTU0oMik7CisJKmNzKysgPSBpOTE1X21taW9fcmVnX29mZnNldChIU1dfQ1NfR1BS
KDQpKTsKKwkqY3MrKyA9IGxvd2VyXzMyX2JpdHMoZGVsYXlfdGlja3MpOworCSpjcysrID0gaTkx
NV9tbWlvX3JlZ19vZmZzZXQoSFNXX0NTX0dQUig0KSkgKyA0OworCSpjcysrID0gdXBwZXJfMzJf
Yml0cyhkZWxheV90aWNrcyk7CisKKwkqY3MrKyA9IE1JX01BVEgoNCk7CisJKmNzKysgPSBNSV9B
TFVfT1AoTUlfQUxVX09QX0xPQUQsIE1JX0FMVV9TUkNfU1JDQSwgTUlfQUxVX1NSQ19SRUcoMikp
OworCSpjcysrID0gTUlfQUxVX09QKE1JX0FMVV9PUF9MT0FELCBNSV9BTFVfU1JDX1NSQ0IsIE1J
X0FMVV9TUkNfUkVHKDQpKTsKKwkqY3MrKyA9IE1JX0FMVV9PUChNSV9BTFVfT1BfQURELCAwLCAw
KTsKKwkqY3MrKyA9IE1JX0FMVV9PUChNSV9BTFVfT1BfU1RPUkVJTlYsIE1JX0FMVV9TUkNfUkVH
KDUpLCBNSV9BTFVfU1JDX0NGKTsKKworCS8qCisJICogVHJhbnNmZXIgdGhlIHJlc3VsdCBpbnRv
IHRoZSBwcmVkaWNhdGUgcmVnaXN0ZXIgdG8gYmUgdXNlZCBmb3IgdGhlCisJICogcHJlZGljYXRl
ZCBqdW1wLgorCSAqLworCSpjcysrID0gTUlfTE9BRF9SRUdJU1RFUl9SRUcgfCAoMyAtIDIpOwor
CSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQoSFNXX0NTX0dQUig1KSk7CisJKmNzKysgPSBp
OTE1X21taW9fcmVnX29mZnNldChNSV9QUkVESUNBVEVfUkVTVUxUXzEpOworCisJLyogUHJlZGlj
YXRlIHRoZSBqdW1wLiAgKi8KKwkqY3MrKyA9IChJTlRFTF9HRU4oaTkxNSkgPCA4ID8KKwkJIE1J
X0JBVENIX0JVRkZFUl9TVEFSVCA6IE1JX0JBVENIX0JVRkZFUl9TVEFSVF9HRU44KSB8CisJCU1J
X0JBVENIX1BSRURJQ0FURTsKKwkqY3MrKyA9IHZtYS0+bm9kZS5zdGFydCArIChqdW1wIC0gYmF0
Y2gpICogNDsKKwkqY3MrKyA9IDA7CisKKwkvKiBSZXN0b3JlIHJlZ2lzdGVycy4gKi8KKwlmb3Ig
KGkgPSAwOyBpIDw9IDU7IGkrKykgeworCQljcyA9IHJlc3RvcmVfcmVnaXN0ZXIoaTkxNSwgY3Ms
IEhTV19DU19HUFIoaSksCisJCQkJICAgICAgSU5URUxfR1RfU0NSQVRDSF9GSUVMRF9QRVJGX0NT
X0dQUiArIDggKiBpLCAyKTsKKwl9CisJY3MgPSByZXN0b3JlX3JlZ2lzdGVyKGk5MTUsIGNzLCBN
SV9QUkVESUNBVEVfUkVTVUxUXzEsCisJCQkgICAgICBJTlRFTF9HVF9TQ1JBVENIX0ZJRUxEX1BF
UkZfUFJFRElDQVRFX1JFU1VMVF8xLCAxKTsKKworCS8qIEFuZCByZXR1cm4gdG8gdGhlIHJpbmcu
ICovCisJKmNzKysgPSBNSV9CQVRDSF9CVUZGRVJfRU5EOworCisJaTkxNV9nZW1fb2JqZWN0X2Zs
dXNoX21hcChibyk7CisJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChibyk7CisKKwlpOTE1LT5w
ZXJmLm9hLm5vYV93YWl0ID0gdm1hOworCisJcmV0dXJuIDA7CisKK2Vycl91bnBpbjoKKwlfX2k5
MTVfdm1hX3VucGluKHZtYSk7CisKK2Vycl91bnJlZjoKKwlpOTE1X2dlbV9vYmplY3RfcHV0KGJv
KTsKKworCXJldHVybiByZXQ7Cit9CisKIHN0YXRpYyB2b2lkIGNvbmZpZ19vYV9yZWdzKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCSAgIGNvbnN0IHN0cnVjdCBpOTE1X29h
X3JlZyAqcmVncywKIAkJCSAgIHUzMiBuX3JlZ3MpCkBAIC0yMjIxLDYgKzI0MjYsMTIgQEAgc3Rh
dGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJl
YW0sCiAJCWdvdG8gZXJyX2NvbmZpZzsKIAl9CiAKKwlyZXQgPSBhbGxvY19ub2Ffd2FpdChkZXZf
cHJpdik7CisJaWYgKHJldCkgeworCQlEUk1fREVCVUcoIlVuYWJsZSB0byBhbGxvY2F0ZSBOT0Eg
d2FpdCBiYXRjaCBidWZmZXJcbiIpOworCQlnb3RvIGVycl9ub2Ffd2FpdF9hbGxvYzsKKwl9CisK
IAkvKiBQUk0gLSBvYnNlcnZhYmlsaXR5IHBlcmZvcm1hbmNlIGNvdW50ZXJzOgogCSAqCiAJICog
ICBPQUNPTlRST0wsIHBlcmZvcm1hbmNlIGNvdW50ZXIgZW5hYmxlLCBub3RlOgpAQCAtMjI3Myw2
ICsyNDg0LDEzIEBAIHN0YXRpYyBpbnQgaTkxNV9vYV9zdHJlYW1faW5pdChzdHJ1Y3QgaTkxNV9w
ZXJmX3N0cmVhbSAqc3RyZWFtLAogCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0KCZkZXZfcHJp
di0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKIAlpbnRlbF9ydW50aW1lX3BtX3B1dCgmZGV2X3By
aXYtPnJ1bnRpbWVfcG0sIHN0cmVhbS0+d2FrZXJlZik7CiAKKwltdXRleF9sb2NrKCZkZXZfcHJp
di0+ZHJtLnN0cnVjdF9tdXRleCk7CisJaTkxNV92bWFfdW5waW5fYW5kX3JlbGVhc2UoJmRldl9w
cml2LT5wZXJmLm9hLm5vYV93YWl0LCAwKTsKKwltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0u
c3RydWN0X211dGV4KTsKKworZXJyX25vYV93YWl0X2FsbG9jOgorCWk5MTVfb2FfY29uZmlnX3B1
dChzdHJlYW0tPm9hX2NvbmZpZyk7CisKIGVycl9jb25maWc6CiAJaWYgKHN0cmVhbS0+Y3R4KQog
CQlvYV9wdXRfcmVuZGVyX2N0eF9pZChzdHJlYW0pOwpAQCAtMzY0OSw2ICszODY3LDkgQEAgdm9p
ZCBpOTE1X3BlcmZfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJCW11
dGV4X2luaXQoJmRldl9wcml2LT5wZXJmLm1ldHJpY3NfbG9jayk7CiAJCWlkcl9pbml0KCZkZXZf
cHJpdi0+cGVyZi5tZXRyaWNzX2lkcik7CiAKKwkJYXRvbWljNjRfc2V0KCZkZXZfcHJpdi0+cGVy
Zi5vYS5ub2FfcHJvZ3JhbW1pbmdfZGVsYXksCisJCQkgICAgIDUwMCAqIDEwMDAgLyogNTAwdXMg
Ki8pOworCiAJCWRldl9wcml2LT5wZXJmLmluaXRpYWxpemVkID0gdHJ1ZTsKIAl9CiB9CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9yZWcuaAppbmRleCA3ZTYwMDljZWZiMTguLmUxMmIyZmNjZWY3MCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZWcuaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3JlZy5oCkBAIC01NjcsNyArNTY3LDkgQEAgc3RhdGljIGlubGluZSBib29s
IGk5MTVfbW1pb19yZWdfdmFsaWQoaTkxNV9yZWdfdCByZWcpCiAjZGVmaW5lIE1JX1BSRURJQ0FU
RV9TUkMwX1VEVwlfTU1JTygweDI0MDAgKyA0KQogI2RlZmluZSBNSV9QUkVESUNBVEVfU1JDMQlf
TU1JTygweDI0MDgpCiAjZGVmaW5lIE1JX1BSRURJQ0FURV9TUkMxX1VEVwlfTU1JTygweDI0MDgg
KyA0KQotCisjZGVmaW5lIE1JX1BSRURJQ0FURV9EQVRBICAgICAgIF9NTUlPKDB4MjQxMCkKKyNk
ZWZpbmUgTUlfUFJFRElDQVRFX1JFU1VMVCAgICAgX01NSU8oMHgyNDE4KQorI2RlZmluZSBNSV9Q
UkVESUNBVEVfUkVTVUxUXzEgICBfTU1JTygweDI0MWMpCiAjZGVmaW5lIE1JX1BSRURJQ0FURV9S
RVNVTFRfMglfTU1JTygweDIyMTQpCiAjZGVmaW5lICBMT1dFUl9TTElDRV9FTkFCTEVECSgxIDw8
IDApCiAjZGVmaW5lICBMT1dFUl9TTElDRV9ESVNBQkxFRAkoMCA8PCAwKQotLSAKMi4yMS4wLjM5
Mi5nZjhmNjc4NzE1OWUKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9w
Lm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVs
LWdmeA==

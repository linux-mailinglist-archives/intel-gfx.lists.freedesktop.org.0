Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id CCAE927630
	for <lists+intel-gfx@lfdr.de>; Thu, 23 May 2019 08:49:56 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id ED3AB89C88;
	Thu, 23 May 2019 06:49:54 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C69F289C88
 for <intel-gfx@lists.freedesktop.org>; Thu, 23 May 2019 06:49:53 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16649156-1500050 
 for multiple; Thu, 23 May 2019 07:49:34 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 23 May 2019 07:49:33 +0100
Message-Id: <20190523064933.23604-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/gtt: Always acquire struct_mutex for
 gen6_ppgtt_cleanup
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgcmVhcnJhbmdlZCB0aGUgdm1fZGVzdHJveV9pb2N0bCB0byBhdm9pZCB0YWtpbmcgc3RydWN0
X211dGV4LCBsaXR0bGUKcmVhbGlzaW5nIHRoYXQgYnVyaWVkIHVuZGVybmVhdGggdGhlIGdlbjYg
cHBndHQgcmVsZWFzZSBwYXRoIHdhcyBhCnN0cnVjdF9tdXRleCByZXF1aXJlbWVudCAodG8gcmVt
b3ZlIGl0cyBHR1RUIHZtYSkuIFVudGlsIHRoYXQKc3RydWN0X211dGV4IGlzIHZhbnF1aXNoZWQs
IHRha2UgYSBkZXRvdXIgaW4gZ2VuNl9wcGd0dF9jbGVhbnVwIHRvIGRvCnRoZSBpOTE1X3ZtYV9k
ZXN0cm95IGZyb20gaW5zaWRlIGEgd29ya2VyIHVuZGVyIHRoZSBzdHJ1Y3RfbXV0ZXguCgo8ND4g
WzI1Ny43NDAxNjBdIFdBUk5fT04oZGVidWdfbG9ja3MgJiYgIWxvY2tfaXNfaGVsZCgmKCZ2bWEt
PnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KS0+ZGVwX21hcCkpCjw0PiBbMjU3Ljc0MDIxM10g
V0FSTklORzogQ1BVOiAzIFBJRDogMTUwNyBhdCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Zt
YS5jOjg0MSBpOTE1X3ZtYV9kZXN0cm95KzB4MWFlLzB4M2EwIFtpOTE1XQo8ND4gWzI1Ny43NDAy
MTRdIE1vZHVsZXMgbGlua2VkIGluOiBzbmRfaGRhX2NvZGVjX2hkbWkgaTkxNSB4ODZfcGtnX3Rl
bXBfdGhlcm1hbCBtZWlfaGRjcCBjb3JldGVtcCBjcmN0MTBkaWZfcGNsbXVsIGNyYzMyX3BjbG11
bCBnaGFzaF9jbG11bG5pX2ludGVsIHNuZF9oZGFfY29kZWNfcmVhbHRlayBzbmRfaGRhX2NvZGVj
X2dlbmVyaWMgc25kX2hkYV9pbnRlbCBzbmRfaGRhX2NvZGVjIHNuZF9od2RlcCBzbmRfaGRhX2Nv
cmUgcjgxNjkgcmVhbHRlayBzbmRfcGNtIG1laV9tZSBtZWkgcHJpbWVfbnVtYmVycyBscGNfaWNo
Cjw0PiBbMjU3Ljc0MDIyNF0gQ1BVOiAzIFBJRDogMTUwNyBDb21tOiBnZW1fdm1fY3JlYXRlIFRh
aW50ZWQ6IEcgICAgIFUgICAgICAgICAgICA1LjIuMC1yYzEtQ0ktQ0lfRFJNXzYxMTgrICMxCjw0
PiBbMjU3Ljc0MDIyNV0gSGFyZHdhcmUgbmFtZTogTVNJIE1TLTc5MjQvWjk3TS1HNDMoTVMtNzky
NCksIEJJT1MgVjEuMTIgMDIvMTUvMjAxNgo8ND4gWzI1Ny43NDAyNDldIFJJUDogMDAxMDppOTE1
X3ZtYV9kZXN0cm95KzB4MWFlLzB4M2EwIFtpOTE1XQo8ND4gWzI1Ny43NDAyNTBdIENvZGU6IDAw
IDAwIDAwIDQ4IDgxIGM3IGM4IDAwIDAwIDAwIGU4IGVkIDA4IGYwIGUwIDg1IGMwIDBmIDg1IDc4
IGZlIGZmIGZmIDQ4IGM3IGM2IGU4IGVjIDMwIGEwIDQ4IGM3IGM3IGRhIDU1IDMzIGEwIGU4IDQy
IDhjIGU5IGUwIDwwZj4gMGIgOGIgODMgNDAgMDEgMDAgMDAgODUgYzAgMGYgODQgNjMgZmUgZmYg
ZmYgNDggYzcgYzEgYzEgNTggMzMKPDQ+IFsyNTcuNzQwMjUxXSBSU1A6IDAwMTg6ZmZmZmM5MDAw
MGFhZmM2OCBFRkxBR1M6IDAwMDEwMjgyCjw0PiBbMjU3Ljc0MDI1Ml0gUkFYOiAwMDAwMDAwMDAw
MDAwMDAwIFJCWDogZmZmZjg4ODNmNzk1Nzg0MCBSQ1g6IDAwMDAwMDAwMDAwMDAwMDMKPDQ+IFsy
NTcuNzQwMjUzXSBSRFg6IDAwMDAwMDAwMDAwMDAwNDYgUlNJOiAwMDAwMDAwMDAwMDAwMDA2IFJE
STogZmZmZmZmZmY4MjEyZDFiOQo8ND4gWzI1Ny43NDAyNTRdIFJCUDogZmZmZmM5MDAwMGFhZmNj
OCBSMDg6IDAwMDAwMDAwMDAwMDAwMDAgUjA5OiAwMDAwMDAwMDAwMDAwMDAwCjw0PiBbMjU3Ljc0
MDI1NV0gUjEwOiAwMDAwMDAwMDAwMDAwMDAwIFIxMTogMDAwMDAwMDAwMDAwMDAwMCBSMTI6IGZm
ZmY4ODgzZjRkNWMyYTgKPDQ+IFsyNTcuNzQwMjU2XSBSMTM6IGZmZmY4ODgzZjRkNWQ2ODAgUjE0
OiBmZmZmODg4M2Y0ZDVjNjY4IFIxNTogZmZmZjg4ODNmNGQ1YzJmMAo8ND4gWzI1Ny43NDAyNTdd
IEZTOiAgMDAwMDdmNzc3ZmE4ZmU0MCgwMDAwKSBHUzpmZmZmODg4NDBmNzgwMDAwKDAwMDApIGtu
bEdTOjAwMDAwMDAwMDAwMDAwMDAKPDQ+IFsyNTcuNzQwMjU4XSBDUzogIDAwMTAgRFM6IDAwMDAg
RVM6IDAwMDAgQ1IwOiAwMDAwMDAwMDgwMDUwMDMzCjw0PiBbMjU3Ljc0MDI1OV0gQ1IyOiAwMDAw
N2Y3NzdmNjUyMmIwIENSMzogMDAwMDAwMDNjNjEyYTAwNiBDUjQ6IDAwMDAwMDAwMDAxNjA2ZTAK
PDQ+IFsyNTcuNzQwMjYwXSBDYWxsIFRyYWNlOgo8ND4gWzI1Ny43NDAyODNdICBnZW42X3BwZ3R0
X2NsZWFudXArMHgyNS8weDYwIFtpOTE1XQo8ND4gWzI1Ny43NDAzMDZdICBpOTE1X3BwZ3R0X3Jl
bGVhc2UrMHgxMDIvMHgyOTAgW2k5MTVdCjw0PiBbMjU3Ljc0MDMzMF0gIGk5MTVfZ2VtX3ZtX2Rl
c3Ryb3lfaW9jdGwrMHg3Yy8weGEwIFtpOTE1XQo8ND4gWzI1Ny43NDAzNzZdICA/IGk5MTVfZ2Vt
X3ZtX2NyZWF0ZV9pb2N0bCsweDE2MC8weDE2MCBbaTkxNV0KPDQ+IFsyNTcuNzQwMzc5XSAgZHJt
X2lvY3RsX2tlcm5lbCsweDgzLzB4ZjAKPDQ+IFsyNTcuNzQwMzgyXSAgZHJtX2lvY3RsKzB4MmYz
LzB4M2IwCjw0PiBbMjU3Ljc0MDQyMl0gID8gaTkxNV9nZW1fdm1fY3JlYXRlX2lvY3RsKzB4MTYw
LzB4MTYwIFtpOTE1XQo8ND4gWzI1Ny43NDA0MjZdICA/IF9yYXdfc3Bpbl91bmxvY2tfaXJxcmVz
dG9yZSsweDM5LzB4NjAKPDQ+IFsyNTcuNzQwNDMwXSAgZG9fdmZzX2lvY3RsKzB4YTAvMHg2ZTAK
PDQ+IFsyNTcuNzQwNDMzXSAgPyBsb2NrX2FjcXVpcmUrMHhhNi8weDFjMAo8ND4gWzI1Ny43NDA0
MzZdICA/IF9fdGFza19waWRfbnJfbnMrMHhiOS8weDFmMAo8ND4gWzI1Ny43NDA0MzldICBrc3lz
X2lvY3RsKzB4MzUvMHg2MAo8ND4gWzI1Ny43NDA0NDFdICBfX3g2NF9zeXNfaW9jdGwrMHgxMS8w
eDIwCjw0PiBbMjU3Ljc0MDQ0M10gIGRvX3N5c2NhbGxfNjQrMHg1NS8weDFjMAo8ND4gWzI1Ny43
NDA0NDVdICBlbnRyeV9TWVNDQUxMXzY0X2FmdGVyX2h3ZnJhbWUrMHg0OS8weGJlCgpSZWZlcmVu
Y2VzOiBlMDY5NWRiNzI5OGUgKCJkcm0vaTkxNTogQ3JlYXRlL2Rlc3Ryb3kgVk0gKHBwR1RUKSBm
b3IgdXNlIHdpdGggY29udGV4dHMiKQpGaXhlczogN2YzZjMxN2E2NmNhICgiZHJtL2k5MTU6IFJl
c3RvcmUgY29udHJvbCBvdmVyIHBwZ3R0IGZvciBjb250ZXh0IGNyZWF0aW9uIEFCSSIpClNpZ25l
ZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogVHZy
dGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbV9ndHQuYyB8IDMyICsrKysrKysrKysrKysrKysrKysrKysrKysrKy0t
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaCB8ICAyICsrCiAyIGZpbGVzIGNo
YW5nZWQsIDMyIGluc2VydGlvbnMoKyksIDIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9ndHQuYwppbmRleCA5ZWQ0MWFlZmI0NTYuLjVhMzUwMjUxNzY2YSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmMKQEAgLTE4MjgsMTEgKzE4MjgsMzMgQEAgc3RhdGljIHZv
aWQgZ2VuNl9wcGd0dF9mcmVlX3BkKHN0cnVjdCBnZW42X2h3X3BwZ3R0ICpwcGd0dCkKIAkJCWZy
ZWVfcHQoJnBwZ3R0LT5iYXNlLnZtLCBwdCk7CiB9CiAKK3N0cnVjdCBnZW42X3BwZ3R0X2NsZWFu
dXBfd29yayB7CisJc3RydWN0IHdvcmtfc3RydWN0IGJhc2U7CisJc3RydWN0IGk5MTVfdm1hICp2
bWE7Cit9OworCitzdGF0aWMgdm9pZCBnZW42X3BwZ3R0X2NsZWFudXBfd29yayhzdHJ1Y3Qgd29y
a19zdHJ1Y3QgKndyaykKK3sKKwlzdHJ1Y3QgZ2VuNl9wcGd0dF9jbGVhbnVwX3dvcmsgKndvcmsg
PQorCQljb250YWluZXJfb2Yod3JrLCB0eXBlb2YoKndvcmspLCBiYXNlKTsKKwlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHdvcmstPnZtYS0+dm0tPmk5MTU7CisKKwltdXRleF9sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlpOTE1X3ZtYV9kZXN0cm95KHdvcmstPnZtYSk7
CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKworCWtmcmVlKHdvcmsp
OworfQorCiBzdGF0aWMgdm9pZCBnZW42X3BwZ3R0X2NsZWFudXAoc3RydWN0IGk5MTVfYWRkcmVz
c19zcGFjZSAqdm0pCiB7CiAJc3RydWN0IGdlbjZfaHdfcHBndHQgKnBwZ3R0ID0gdG9fZ2VuNl9w
cGd0dChpOTE1X3ZtX3RvX3BwZ3R0KHZtKSk7CisJc3RydWN0IGdlbjZfcHBndHRfY2xlYW51cF93
b3JrICp3b3JrID0gcHBndHQtPndvcms7CiAKLQlpOTE1X3ZtYV9kZXN0cm95KHBwZ3R0LT52bWEp
OworCS8qIEZJWE1FIHJlbW92ZSB0aGUgc3RydWN0X211dGV4IHRvIGJyaW5nIHRoZSBsb2NraW5n
IHVuZGVyIGNvbnRyb2wgKi8KKwlJTklUX1dPUksoJndvcmstPmJhc2UsIGdlbjZfcHBndHRfY2xl
YW51cF93b3JrKTsKKwl3b3JrLT52bWEgPSBwcGd0dC0+dm1hOworCXNjaGVkdWxlX3dvcmsoJndv
cmstPmJhc2UpOwogCiAJZ2VuNl9wcGd0dF9mcmVlX3BkKHBwZ3R0KTsKIAlnZW42X3BwZ3R0X2Zy
ZWVfc2NyYXRjaCh2bSk7CkBAIC0yMDExLDkgKzIwMzMsMTMgQEAgc3RhdGljIHN0cnVjdCBpOTE1
X2h3X3BwZ3R0ICpnZW42X3BwZ3R0X2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKIAogCXBwZ3R0LT5iYXNlLnZtLnB0ZV9lbmNvZGUgPSBnZ3R0LT52bS5wdGVfZW5jb2RlOwog
CisJcHBndHQtPndvcmsgPSBrbWFsbG9jKHNpemVvZigqcHBndHQtPndvcmspLCBHRlBfS0VSTkVM
KTsKKwlpZiAoIXBwZ3R0LT53b3JrKQorCQlnb3RvIGVycl9mcmVlOworCiAJZXJyID0gZ2VuNl9w
cGd0dF9pbml0X3NjcmF0Y2gocHBndHQpOwogCWlmIChlcnIpCi0JCWdvdG8gZXJyX2ZyZWU7CisJ
CWdvdG8gZXJyX3dvcms7CiAKIAlwcGd0dC0+dm1hID0gcGRfdm1hX2NyZWF0ZShwcGd0dCwgR0VO
Nl9QRF9TSVpFKTsKIAlpZiAoSVNfRVJSKHBwZ3R0LT52bWEpKSB7CkBAIC0yMDI1LDYgKzIwNTEs
OCBAQCBzdGF0aWMgc3RydWN0IGk5MTVfaHdfcHBndHQgKmdlbjZfcHBndHRfY3JlYXRlKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCiBlcnJfc2NyYXRjaDoKIAlnZW42X3BwZ3R0X2Zy
ZWVfc2NyYXRjaCgmcHBndHQtPmJhc2Uudm0pOworZXJyX3dvcms6CisJa2ZyZWUocHBndHQtPndv
cmspOwogZXJyX2ZyZWU6CiAJa2ZyZWUocHBndHQpOwogCXJldHVybiBFUlJfUFRSKGVycik7CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaCBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oCmluZGV4IDk4ZmM3MTA1M2Y3Yy4uMzg0OTYwMzk0
NTZiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaApAQCAtNDI0LDYgKzQyNCw4IEBA
IHN0cnVjdCBnZW42X2h3X3BwZ3R0IHsKIAogCXVuc2lnbmVkIGludCBwaW5fY291bnQ7CiAJYm9v
bCBzY2FuX2Zvcl91bnVzZWRfcHQ7CisKKwlzdHJ1Y3QgZ2VuNl9wcGd0dF9jbGVhbnVwX3dvcmsg
Kndvcms7CiB9OwogCiAjZGVmaW5lIF9fdG9fZ2VuNl9wcGd0dChiYXNlKSBjb250YWluZXJfb2Yo
YmFzZSwgc3RydWN0IGdlbjZfaHdfcHBndHQsIGJhc2UpCi0tIAoyLjIwLjEKCl9fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxp
c3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNr
dG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

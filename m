Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D7C6B64EA0
	for <lists+intel-gfx@lfdr.de>; Thu, 11 Jul 2019 00:15:06 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 907168957D;
	Wed, 10 Jul 2019 22:15:04 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga18.intel.com (mga18.intel.com [134.134.136.126])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 278908957D
 for <intel-gfx@lists.freedesktop.org>; Wed, 10 Jul 2019 22:15:03 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga005.fm.intel.com ([10.253.24.32])
 by orsmga106.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 10 Jul 2019 15:15:02 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,476,1557212400"; d="scan'208";a="364619362"
Received: from josouza-mobl.jf.intel.com (HELO josouza-MOBL.intel.com)
 ([10.24.9.133])
 by fmsmga005.fm.intel.com with ESMTP; 10 Jul 2019 15:15:02 -0700
From: =?UTF-8?q?Jos=C3=A9=20Roberto=20de=20Souza?= <jose.souza@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 10 Jul 2019 15:14:59 -0700
Message-Id: <20190710221500.11576-1-jose.souza@intel.com>
X-Mailer: git-send-email 2.22.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v4 1/2] drm/i915: Add support for retrying
 hotplug
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Jani Nikula <jani.nikula@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogSW1yZSBEZWFrIDxpbXJlLmRlYWtAaW50ZWwuY29tPgoKVGhlcmUgaXMgc29tZSBzY2Vu
YXJpb3MgdGhhdCB3ZSBhcmUgYXdhcmUgdGhhdCBzaW5rIHByb2JlIGNhbiBmYWlsLApzbyBsZXRz
IGFkZCB0aGUgaW5mcmFzdHJ1Y3R1cmUgdG8gbGV0IGhvdHBsdWcoKSBob29rIHRvIHJlcXVlc3QK
YW5vdGhlciBwcm9iZSBhZnRlciBzb21lIHRpbWUuCgp2MjogSGFuZGxlIHNoYXJlZCBIUEQgcGlu
cyAoSW1yZSkKdjM6IFJlYmFzZWQKdjQ6IFJlbmFtZWQgSU5URUxfSE9UUExVR19OT0NIQU5HRSB0
byBJTlRFTF9IT1RQTFVHX1VOQ0hBTkdFRCB0byBrZWVwCml0IGNvbnNpc3RlbnQoUm9kcmlnbykK
CkNjOiBWaWxsZSBTeXJqw6Rsw6QgPHZpbGxlLnN5cmphbGFAbGludXguaW50ZWwuY29tPgpSZXZp
ZXdlZC1ieTogUm9kcmlnbyBWaXZpIDxyb2RyaWdvLnZpdmlAaW50ZWwuY29tPgpTaWduZWQtb2Zm
LWJ5OiBKb3PDqSBSb2JlcnRvIGRlIFNvdXphIDxqb3NlLnNvdXphQGludGVsLmNvbT4KU2lnbmVk
LW9mZi1ieTogSmFuaSBOaWt1bGEgPGphbmkubmlrdWxhQGludGVsLmNvbT4KU2lnbmVkLW9mZi1i
eTogSW1yZSBEZWFrIDxpbXJlLmRlYWtAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMgICAgIHwgMTIgKystLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kcC5jICAgICAgfCAxMiArKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2hvdHBsdWcuYyB8IDU5ICsrKysrKysrKysrKysrKy0tLS0tCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2hvdHBsdWcuaCB8ICA1ICstCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Nkdm8uYyAgICB8ICA4ICsrLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgICAgICAgICAgfCAgMiArLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9kcnYuaCAgICAgICAgICAgICAgfCAgMyArLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvaW50ZWxfZHJ2LmggICAgICAgICAgICAgfCAxMSArKystCiA4IGZpbGVzIGNoYW5nZWQs
IDgwIGluc2VydGlvbnMoKyksIDMyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2RkaS5jCmluZGV4IGFkNjM4ZTdmMjdiYi4uNzM0YzAwNDgwMGY4IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMKQEAgLTQwNDcsMTQgKzQwNDcs
MTYgQEAgc3RhdGljIGludCBpbnRlbF9oZG1pX3Jlc2V0X2xpbmsoc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIsCiAJcmV0dXJuIG1vZGVzZXRfcGlwZSgmY3J0Yy0+YmFzZSwgY3R4KTsKIH0K
IAotc3RhdGljIGJvb2wgaW50ZWxfZGRpX2hvdHBsdWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVu
Y29kZXIsCi0JCQkgICAgICBzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IpCitzdGF0
aWMgZW51bSBpbnRlbF9ob3RwbHVnX3N0YXRlCitpbnRlbF9kZGlfaG90cGx1ZyhzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlciwKKwkJICBzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0
b3IsCisJCSAgYm9vbCBpcnFfcmVjZWl2ZWQpCiB7CiAJc3RydWN0IGRybV9tb2Rlc2V0X2FjcXVp
cmVfY3R4IGN0eDsKLQlib29sIGNoYW5nZWQ7CisJZW51bSBpbnRlbF9ob3RwbHVnX3N0YXRlIHN0
YXRlOwogCWludCByZXQ7CiAKLQljaGFuZ2VkID0gaW50ZWxfZW5jb2Rlcl9ob3RwbHVnKGVuY29k
ZXIsIGNvbm5lY3Rvcik7CisJc3RhdGUgPSBpbnRlbF9lbmNvZGVyX2hvdHBsdWcoZW5jb2Rlciwg
Y29ubmVjdG9yLCBpcnFfcmVjZWl2ZWQpOwogCiAJZHJtX21vZGVzZXRfYWNxdWlyZV9pbml0KCZj
dHgsIDApOwogCkBAIC00MDc2LDcgKzQwNzgsNyBAQCBzdGF0aWMgYm9vbCBpbnRlbF9kZGlfaG90
cGx1ZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAlkcm1fbW9kZXNldF9hY3F1aXJl
X2ZpbmkoJmN0eCk7CiAJV0FSTihyZXQsICJBY3F1aXJpbmcgbW9kZXNldCBsb2NrcyBmYWlsZWQg
d2l0aCAlaVxuIiwgcmV0KTsKIAotCXJldHVybiBjaGFuZ2VkOworCXJldHVybiBzdGF0ZTsKIH0K
IAogc3RhdGljIHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kcC5jCmluZGV4IDBiZGI3ZWNjNWE4MS4uNDQyM2FiYmM3OTA3IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCkBAIC00ODUzLDE0ICs0ODUzLDE2IEBA
IGludCBpbnRlbF9kcF9yZXRyYWluX2xpbmsoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIs
CiAgKiByZXRyYWluIHRoZSBsaW5rIHRvIGdldCBhIHBpY3R1cmUuIFRoYXQncyBpbiBjYXNlIG5v
CiAgKiB1c2Vyc3BhY2UgY29tcG9uZW50IHJlYWN0ZWQgdG8gaW50ZXJtaXR0ZW50IEhQRCBkaXAu
CiAgKi8KLXN0YXRpYyBib29sIGludGVsX2RwX2hvdHBsdWcoc3RydWN0IGludGVsX2VuY29kZXIg
KmVuY29kZXIsCi0JCQkgICAgIHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikKK3N0
YXRpYyBlbnVtIGludGVsX2hvdHBsdWdfc3RhdGUKK2ludGVsX2RwX2hvdHBsdWcoc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXIsCisJCSBzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0
b3IsCisJCSBib29sIGlycV9yZWNlaXZlZCkKIHsKIAlzdHJ1Y3QgZHJtX21vZGVzZXRfYWNxdWly
ZV9jdHggY3R4OwotCWJvb2wgY2hhbmdlZDsKKwllbnVtIGludGVsX2hvdHBsdWdfc3RhdGUgc3Rh
dGU7CiAJaW50IHJldDsKIAotCWNoYW5nZWQgPSBpbnRlbF9lbmNvZGVyX2hvdHBsdWcoZW5jb2Rl
ciwgY29ubmVjdG9yKTsKKwlzdGF0ZSA9IGludGVsX2VuY29kZXJfaG90cGx1ZyhlbmNvZGVyLCBj
b25uZWN0b3IsIGlycV9yZWNlaXZlZCk7CiAKIAlkcm1fbW9kZXNldF9hY3F1aXJlX2luaXQoJmN0
eCwgMCk7CiAKQEAgLTQ4NzksNyArNDg4MSw3IEBAIHN0YXRpYyBib29sIGludGVsX2RwX2hvdHBs
dWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJZHJtX21vZGVzZXRfYWNxdWlyZV9m
aW5pKCZjdHgpOwogCVdBUk4ocmV0LCAiQWNxdWlyaW5nIG1vZGVzZXQgbG9ja3MgZmFpbGVkIHdp
dGggJWlcbiIsIHJldCk7CiAKLQlyZXR1cm4gY2hhbmdlZDsKKwlyZXR1cm4gc3RhdGU7CiB9CiAK
IHN0YXRpYyB2b2lkIGludGVsX2RwX2NoZWNrX3NlcnZpY2VfaXJxKHN0cnVjdCBpbnRlbF9kcCAq
aW50ZWxfZHApCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2hvdHBsdWcuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfaG90cGx1Zy5j
CmluZGV4IGVhM2RlNGFjYzg1MC4uMmNhOTI3ODBjNjU5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2hvdHBsdWcuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2hvdHBsdWcuYwpAQCAtMTEyLDYgKzExMiw3IEBAIGVudW0gaHBk
X3BpbiBpbnRlbF9ocGRfcGluX2RlZmF1bHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAogCiAjZGVmaW5lIEhQRF9TVE9STV9ERVRFQ1RfUEVSSU9ECQkxMDAwCiAjZGVmaW5lIEhQ
RF9TVE9STV9SRUVOQUJMRV9ERUxBWQkoMiAqIDYwICogMTAwMCkKKyNkZWZpbmUgSFBEX1JFVFJZ
X0RFTEFZCQkJMTAwMAogCiAvKioKICAqIGludGVsX2hwZF9pcnFfc3Rvcm1fZGV0ZWN0IC0gZ2F0
aGVyIHN0YXRzIGFuZCBkZXRlY3QgSFBEIElSUSBzdG9ybSBvbiBhIHBpbgpAQCAtMjY2LDggKzI2
NywxMCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9ocGRfaXJxX3N0b3JtX3JlZW5hYmxlX3dvcmsoc3Ry
dWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCWludGVsX3J1bnRpbWVfcG1fcHV0KCZkZXZfcHJpdi0+
cnVudGltZV9wbSwgd2FrZXJlZik7CiB9CiAKLWJvb2wgaW50ZWxfZW5jb2Rlcl9ob3RwbHVnKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAotCQkJICAgc3RydWN0IGludGVsX2Nvbm5lY3Rv
ciAqY29ubmVjdG9yKQorZW51bSBpbnRlbF9ob3RwbHVnX3N0YXRlCitpbnRlbF9lbmNvZGVyX2hv
dHBsdWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCisJCSAgICAgIHN0cnVjdCBpbnRl
bF9jb25uZWN0b3IgKmNvbm5lY3RvciwKKwkJICAgICAgYm9vbCBpcnFfcmVjZWl2ZWQpCiB7CiAJ
c3RydWN0IGRybV9kZXZpY2UgKmRldiA9IGNvbm5lY3Rvci0+YmFzZS5kZXY7CiAJZW51bSBkcm1f
Y29ubmVjdG9yX3N0YXR1cyBvbGRfc3RhdHVzOwpAQCAtMjc5LDcgKzI4Miw3IEBAIGJvb2wgaW50
ZWxfZW5jb2Rlcl9ob3RwbHVnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQlkcm1f
aGVscGVyX3Byb2JlX2RldGVjdCgmY29ubmVjdG9yLT5iYXNlLCBOVUxMLCBmYWxzZSk7CiAKIAlp
ZiAob2xkX3N0YXR1cyA9PSBjb25uZWN0b3ItPmJhc2Uuc3RhdHVzKQotCQlyZXR1cm4gZmFsc2U7
CisJCXJldHVybiBJTlRFTF9IT1RQTFVHX1VOQ0hBTkdFRDsKIAogCURSTV9ERUJVR19LTVMoIltD
T05ORUNUT1I6JWQ6JXNdIHN0YXR1cyB1cGRhdGVkIGZyb20gJXMgdG8gJXNcbiIsCiAJCSAgICAg
IGNvbm5lY3Rvci0+YmFzZS5iYXNlLmlkLApAQCAtMjg3LDcgKzI5MCw3IEBAIGJvb2wgaW50ZWxf
ZW5jb2Rlcl9ob3RwbHVnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQkgICAgICBk
cm1fZ2V0X2Nvbm5lY3Rvcl9zdGF0dXNfbmFtZShvbGRfc3RhdHVzKSwKIAkJICAgICAgZHJtX2dl
dF9jb25uZWN0b3Jfc3RhdHVzX25hbWUoY29ubmVjdG9yLT5iYXNlLnN0YXR1cykpOwogCi0JcmV0
dXJuIHRydWU7CisJcmV0dXJuIElOVEVMX0hPVFBMVUdfQ0hBTkdFRDsKIH0KIAogc3RhdGljIGJv
b2wgaW50ZWxfZW5jb2Rlcl9oYXNfaHBkX3B1bHNlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyKQpAQCAtMzM5LDcgKzM0Miw3IEBAIHN0YXRpYyB2b2lkIGk5MTVfZGlncG9ydF93b3JrX2Z1
bmMoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQogCQlzcGluX2xvY2tfaXJxKCZkZXZfcHJpdi0+
aXJxX2xvY2spOwogCQlkZXZfcHJpdi0+aG90cGx1Zy5ldmVudF9iaXRzIHw9IG9sZF9iaXRzOwog
CQlzcGluX3VubG9ja19pcnEoJmRldl9wcml2LT5pcnFfbG9jayk7Ci0JCXNjaGVkdWxlX3dvcmso
JmRldl9wcml2LT5ob3RwbHVnLmhvdHBsdWdfd29yayk7CisJCXNjaGVkdWxlX2RlbGF5ZWRfd29y
aygmZGV2X3ByaXYtPmhvdHBsdWcuaG90cGx1Z193b3JrLCAwKTsKIAl9CiB9CiAKQEAgLTM0OSwx
NCArMzUyLDE2IEBAIHN0YXRpYyB2b2lkIGk5MTVfZGlncG9ydF93b3JrX2Z1bmMoc3RydWN0IHdv
cmtfc3RydWN0ICp3b3JrKQogc3RhdGljIHZvaWQgaTkxNV9ob3RwbHVnX3dvcmtfZnVuYyhzdHJ1
Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2ID0KLQkJY29udGFpbmVyX29mKHdvcmssIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlLCBob3Rw
bHVnLmhvdHBsdWdfd29yayk7CisJCWNvbnRhaW5lcl9vZih3b3JrLCBzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSwKKwkJCSAgICAgaG90cGx1Zy5ob3RwbHVnX3dvcmsud29yayk7CiAJc3RydWN0IGRy
bV9kZXZpY2UgKmRldiA9ICZkZXZfcHJpdi0+ZHJtOwogCXN0cnVjdCBpbnRlbF9jb25uZWN0b3Ig
KmludGVsX2Nvbm5lY3RvcjsKIAlzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqaW50ZWxfZW5jb2RlcjsK
IAlzdHJ1Y3QgZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yOwogCXN0cnVjdCBkcm1fY29ubmVjdG9y
X2xpc3RfaXRlciBjb25uX2l0ZXI7Ci0JYm9vbCBjaGFuZ2VkID0gZmFsc2U7CisJdTMyIGNoYW5n
ZWQgPSAwLCByZXRyeSA9IDA7CiAJdTMyIGhwZF9ldmVudF9iaXRzOworCXUzMiBocGRfcmV0cnlf
Yml0czsKIAogCW11dGV4X2xvY2soJmRldi0+bW9kZV9jb25maWcubXV0ZXgpOwogCURSTV9ERUJV
R19LTVMoInJ1bm5pbmcgZW5jb2RlciBob3RwbHVnIGZ1bmN0aW9uc1xuIik7CkBAIC0zNjUsNiAr
MzcwLDggQEAgc3RhdGljIHZvaWQgaTkxNV9ob3RwbHVnX3dvcmtfZnVuYyhzdHJ1Y3Qgd29ya19z
dHJ1Y3QgKndvcmspCiAKIAlocGRfZXZlbnRfYml0cyA9IGRldl9wcml2LT5ob3RwbHVnLmV2ZW50
X2JpdHM7CiAJZGV2X3ByaXYtPmhvdHBsdWcuZXZlbnRfYml0cyA9IDA7CisJaHBkX3JldHJ5X2Jp
dHMgPSBkZXZfcHJpdi0+aG90cGx1Zy5yZXRyeV9iaXRzOworCWRldl9wcml2LT5ob3RwbHVnLnJl
dHJ5X2JpdHMgPSAwOwogCiAJLyogRW5hYmxlIHBvbGxpbmcgZm9yIGNvbm5lY3RvcnMgd2hpY2gg
aGFkIEhQRCBJUlEgc3Rvcm1zICovCiAJaW50ZWxfaHBkX2lycV9zdG9ybV9zd2l0Y2hfdG9fcG9s
bGluZyhkZXZfcHJpdik7CkBAIC0zNzMsMTYgKzM4MCwyOSBAQCBzdGF0aWMgdm9pZCBpOTE1X2hv
dHBsdWdfd29ya19mdW5jKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIAogCWRybV9jb25uZWN0
b3JfbGlzdF9pdGVyX2JlZ2luKGRldiwgJmNvbm5faXRlcik7CiAJZHJtX2Zvcl9lYWNoX2Nvbm5l
Y3Rvcl9pdGVyKGNvbm5lY3RvciwgJmNvbm5faXRlcikgeworCQl1MzIgaHBkX2JpdDsKKwogCQlp
bnRlbF9jb25uZWN0b3IgPSB0b19pbnRlbF9jb25uZWN0b3IoY29ubmVjdG9yKTsKIAkJaWYgKCFp
bnRlbF9jb25uZWN0b3ItPmVuY29kZXIpCiAJCQljb250aW51ZTsKIAkJaW50ZWxfZW5jb2RlciA9
IGludGVsX2Nvbm5lY3Rvci0+ZW5jb2RlcjsKLQkJaWYgKGhwZF9ldmVudF9iaXRzICYgKDEgPDwg
aW50ZWxfZW5jb2Rlci0+aHBkX3BpbikpIHsKKwkJaHBkX2JpdCA9IEJJVChpbnRlbF9lbmNvZGVy
LT5ocGRfcGluKTsKKwkJaWYgKChocGRfZXZlbnRfYml0cyB8IGhwZF9yZXRyeV9iaXRzKSAmIGhw
ZF9iaXQpIHsKIAkJCURSTV9ERUJVR19LTVMoIkNvbm5lY3RvciAlcyAocGluICVpKSByZWNlaXZl
ZCBob3RwbHVnIGV2ZW50LlxuIiwKIAkJCQkgICAgICBjb25uZWN0b3ItPm5hbWUsIGludGVsX2Vu
Y29kZXItPmhwZF9waW4pOwogCi0JCQljaGFuZ2VkIHw9IGludGVsX2VuY29kZXItPmhvdHBsdWco
aW50ZWxfZW5jb2RlciwKLQkJCQkJCQkgIGludGVsX2Nvbm5lY3Rvcik7CisJCQlzd2l0Y2ggKGlu
dGVsX2VuY29kZXItPmhvdHBsdWcoaW50ZWxfZW5jb2RlciwKKwkJCQkJCSAgICAgICBpbnRlbF9j
b25uZWN0b3IsCisJCQkJCQkgICAgICAgaHBkX2V2ZW50X2JpdHMgJiBocGRfYml0KSkgeworCQkJ
Y2FzZSBJTlRFTF9IT1RQTFVHX1VOQ0hBTkdFRDoKKwkJCQlicmVhazsKKwkJCWNhc2UgSU5URUxf
SE9UUExVR19DSEFOR0VEOgorCQkJCWNoYW5nZWQgfD0gaHBkX2JpdDsKKwkJCQlicmVhazsKKwkJ
CWNhc2UgSU5URUxfSE9UUExVR19SRVRSWToKKwkJCQlyZXRyeSB8PSBocGRfYml0OworCQkJCWJy
ZWFrOworCQkJfQogCQl9CiAJfQogCWRybV9jb25uZWN0b3JfbGlzdF9pdGVyX2VuZCgmY29ubl9p
dGVyKTsKQEAgLTM5MCw2ICs0MTAsMTcgQEAgc3RhdGljIHZvaWQgaTkxNV9ob3RwbHVnX3dvcmtf
ZnVuYyhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAKIAlpZiAoY2hhbmdlZCkKIAkJZHJtX2tt
c19oZWxwZXJfaG90cGx1Z19ldmVudChkZXYpOworCisJLyogUmVtb3ZlIHNoYXJlZCBIUEQgcGlu
cyB0aGF0IGhhdmUgY2hhbmdlZCAqLworCXJldHJ5ICY9IH5jaGFuZ2VkOworCWlmIChyZXRyeSkg
eworCQlzcGluX2xvY2tfaXJxKCZkZXZfcHJpdi0+aXJxX2xvY2spOworCQlkZXZfcHJpdi0+aG90
cGx1Zy5yZXRyeV9iaXRzIHw9IHJldHJ5OworCQlzcGluX3VubG9ja19pcnEoJmRldl9wcml2LT5p
cnFfbG9jayk7CisKKwkJbW9kX2RlbGF5ZWRfd29yayhzeXN0ZW1fd3EsICZkZXZfcHJpdi0+aG90
cGx1Zy5ob3RwbHVnX3dvcmssCisJCQkJIG1zZWNzX3RvX2ppZmZpZXMoSFBEX1JFVFJZX0RFTEFZ
KSk7CisJfQogfQogCiAKQEAgLTUxNiw3ICs1NDcsNyBAQCB2b2lkIGludGVsX2hwZF9pcnFfaGFu
ZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaWYgKHF1ZXVlX2RpZykK
IAkJcXVldWVfd29yayhkZXZfcHJpdi0+aG90cGx1Zy5kcF93cSwgJmRldl9wcml2LT5ob3RwbHVn
LmRpZ19wb3J0X3dvcmspOwogCWlmIChxdWV1ZV9ocCkKLQkJc2NoZWR1bGVfd29yaygmZGV2X3By
aXYtPmhvdHBsdWcuaG90cGx1Z193b3JrKTsKKwkJc2NoZWR1bGVfZGVsYXllZF93b3JrKCZkZXZf
cHJpdi0+aG90cGx1Zy5ob3RwbHVnX3dvcmssIDApOwogfQogCiAvKioKQEAgLTYzNiw3ICs2Njcs
OCBAQCB2b2lkIGludGVsX2hwZF9wb2xsX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2KQogCiB2b2lkIGludGVsX2hwZF9pbml0X3dvcmsoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KQogewotCUlOSVRfV09SSygmZGV2X3ByaXYtPmhvdHBsdWcuaG90cGx1Z193
b3JrLCBpOTE1X2hvdHBsdWdfd29ya19mdW5jKTsKKwlJTklUX0RFTEFZRURfV09SSygmZGV2X3By
aXYtPmhvdHBsdWcuaG90cGx1Z193b3JrLAorCQkJICBpOTE1X2hvdHBsdWdfd29ya19mdW5jKTsK
IAlJTklUX1dPUksoJmRldl9wcml2LT5ob3RwbHVnLmRpZ19wb3J0X3dvcmssIGk5MTVfZGlncG9y
dF93b3JrX2Z1bmMpOwogCUlOSVRfV09SSygmZGV2X3ByaXYtPmhvdHBsdWcucG9sbF9pbml0X3dv
cmssIGk5MTVfaHBkX3BvbGxfaW5pdF93b3JrKTsKIAlJTklUX0RFTEFZRURfV09SSygmZGV2X3By
aXYtPmhvdHBsdWcucmVlbmFibGVfd29yaywKQEAgLTY1MCwxMSArNjgyLDEyIEBAIHZvaWQgaW50
ZWxfaHBkX2NhbmNlbF93b3JrKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlk
ZXZfcHJpdi0+aG90cGx1Zy5sb25nX3BvcnRfbWFzayA9IDA7CiAJZGV2X3ByaXYtPmhvdHBsdWcu
c2hvcnRfcG9ydF9tYXNrID0gMDsKIAlkZXZfcHJpdi0+aG90cGx1Zy5ldmVudF9iaXRzID0gMDsK
KwlkZXZfcHJpdi0+aG90cGx1Zy5yZXRyeV9iaXRzID0gMDsKIAogCXNwaW5fdW5sb2NrX2lycSgm
ZGV2X3ByaXYtPmlycV9sb2NrKTsKIAogCWNhbmNlbF93b3JrX3N5bmMoJmRldl9wcml2LT5ob3Rw
bHVnLmRpZ19wb3J0X3dvcmspOwotCWNhbmNlbF93b3JrX3N5bmMoJmRldl9wcml2LT5ob3RwbHVn
LmhvdHBsdWdfd29yayk7CisJY2FuY2VsX2RlbGF5ZWRfd29ya19zeW5jKCZkZXZfcHJpdi0+aG90
cGx1Zy5ob3RwbHVnX3dvcmspOwogCWNhbmNlbF93b3JrX3N5bmMoJmRldl9wcml2LT5ob3RwbHVn
LnBvbGxfaW5pdF93b3JrKTsKIAljYW5jZWxfZGVsYXllZF93b3JrX3N5bmMoJmRldl9wcml2LT5o
b3RwbHVnLnJlZW5hYmxlX3dvcmspOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9ob3RwbHVnLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2hvdHBsdWcuaAppbmRleCA4MDVmODk3ZGJiN2EuLmIwY2Q0NDdiN2ZiYyAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9ob3RwbHVnLmgKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9ob3RwbHVnLmgKQEAgLTE1LDggKzE1
LDkgQEAgc3RydWN0IGludGVsX2Nvbm5lY3RvcjsKIHN0cnVjdCBpbnRlbF9lbmNvZGVyOwogCiB2
b2lkIGludGVsX2hwZF9wb2xsX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
KTsKLWJvb2wgaW50ZWxfZW5jb2Rlcl9ob3RwbHVnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyLAotCQkJICAgc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVjdG9yKTsKK2VudW0gaW50
ZWxfaG90cGx1Z19zdGF0ZSBpbnRlbF9lbmNvZGVyX2hvdHBsdWcoc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIsCisJCQkJCSAgICAgICBzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0
b3IsCisJCQkJCSAgICAgICBib29sIGlycV9yZWNlaXZlZCk7CiB2b2lkIGludGVsX2hwZF9pcnFf
aGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJCQkgICB1MzIgcGlu
X21hc2ssIHUzMiBsb25nX21hc2spOwogdm9pZCBpbnRlbF9ocGRfaW5pdChzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9zZHZvLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X3Nkdm8uYwppbmRleCAzZmU4ZWFlZjZiZDguLjYzOTMxN2I4NGU1MSAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zZHZvLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9zZHZvLmMKQEAgLTE5MTUsMTIgKzE5MTUsMTQgQEAgc3Rh
dGljIHZvaWQgaW50ZWxfc2R2b19lbmFibGVfaG90cGx1ZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAq
ZW5jb2RlcikKIAkJCSAgICAgJmludGVsX3Nkdm8tPmhvdHBsdWdfYWN0aXZlLCAyKTsKIH0KIAot
c3RhdGljIGJvb2wgaW50ZWxfc2R2b19ob3RwbHVnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyLAotCQkJICAgICAgIHN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3RvcikKK3N0YXRp
YyBlbnVtIGludGVsX2hvdHBsdWdfc3RhdGUKK2ludGVsX3Nkdm9faG90cGx1ZyhzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlciwKKwkJICAgc3RydWN0IGludGVsX2Nvbm5lY3RvciAqY29ubmVj
dG9yLAorCQkgICBib29sIGlycV9yZWNlaXZlZCkKIHsKIAlpbnRlbF9zZHZvX2VuYWJsZV9ob3Rw
bHVnKGVuY29kZXIpOwogCi0JcmV0dXJuIGludGVsX2VuY29kZXJfaG90cGx1ZyhlbmNvZGVyLCBj
b25uZWN0b3IpOworCXJldHVybiBpbnRlbF9lbmNvZGVyX2hvdHBsdWcoZW5jb2RlciwgY29ubmVj
dG9yLCBpcnFfcmVjZWl2ZWQpOwogfQogCiBzdGF0aWMgYm9vbApkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2RlYnVnZnMuYwppbmRleCAzZTRmNThmMTkzNjIuLjZkNGJjOTgzOTE1ZiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKQEAgLTQwOTAsNyArNDA5MCw3IEBAIHN0YXRpYyBpbnQgaTkx
NV9ocGRfc3Rvcm1fY3RsX3Nob3coc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCSAq
LwogCWludGVsX3N5bmNocm9uaXplX2lycShkZXZfcHJpdik7CiAJZmx1c2hfd29yaygmZGV2X3By
aXYtPmhvdHBsdWcuZGlnX3BvcnRfd29yayk7Ci0JZmx1c2hfd29yaygmZGV2X3ByaXYtPmhvdHBs
dWcuaG90cGx1Z193b3JrKTsKKwlmbHVzaF9kZWxheWVkX3dvcmsoJmRldl9wcml2LT5ob3RwbHVn
LmhvdHBsdWdfd29yayk7CiAKIAlzZXFfcHJpbnRmKG0sICJUaHJlc2hvbGQ6ICVkXG4iLCBob3Rw
bHVnLT5ocGRfc3Rvcm1fdGhyZXNob2xkKTsKIAlzZXFfcHJpbnRmKG0sICJEZXRlY3RlZDogJXNc
biIsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAppbmRleCBmOTg3OGNiZWY0ZDkuLmY0NzEzMDdhYTcw
NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAorKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCkBAIC0xNjMsNyArMTYzLDcgQEAgZW51bSBocGRf
cGluIHsKICNkZWZpbmUgSFBEX1NUT1JNX0RFRkFVTFRfVEhSRVNIT0xEIDUwCiAKIHN0cnVjdCBp
OTE1X2hvdHBsdWcgewotCXN0cnVjdCB3b3JrX3N0cnVjdCBob3RwbHVnX3dvcms7CisJc3RydWN0
IGRlbGF5ZWRfd29yayBob3RwbHVnX3dvcms7CiAKIAlzdHJ1Y3QgewogCQl1bnNpZ25lZCBsb25n
IGxhc3RfamlmZmllczsKQEAgLTE3NSw2ICsxNzUsNyBAQCBzdHJ1Y3QgaTkxNV9ob3RwbHVnIHsK
IAkJfSBzdGF0ZTsKIAl9IHN0YXRzW0hQRF9OVU1fUElOU107CiAJdTMyIGV2ZW50X2JpdHM7CisJ
dTMyIHJldHJ5X2JpdHM7CiAJc3RydWN0IGRlbGF5ZWRfd29yayByZWVuYWJsZV93b3JrOwogCiAJ
dTMyIGxvbmdfcG9ydF9tYXNrOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9kcnYuaAppbmRleCAyNGM2M2Vk
NDVjNmYuLmU1OGQzNzUxZWQ0MyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZHJ2LmgKQEAgLTEwMSwx
NCArMTAxLDIxIEBAIHN0cnVjdCBpbnRlbF9mYmRldiB7CiAJc3RydWN0IG11dGV4IGhwZF9sb2Nr
OwogfTsKIAorZW51bSBpbnRlbF9ob3RwbHVnX3N0YXRlIHsKKwlJTlRFTF9IT1RQTFVHX1VOQ0hB
TkdFRCwKKwlJTlRFTF9IT1RQTFVHX0NIQU5HRUQsCisJSU5URUxfSE9UUExVR19SRVRSWSwKK307
CisKIHN0cnVjdCBpbnRlbF9lbmNvZGVyIHsKIAlzdHJ1Y3QgZHJtX2VuY29kZXIgYmFzZTsKIAog
CWVudW0gaW50ZWxfb3V0cHV0X3R5cGUgdHlwZTsKIAllbnVtIHBvcnQgcG9ydDsKIAl1bnNpZ25l
ZCBpbnQgY2xvbmVhYmxlOwotCWJvb2wgKCpob3RwbHVnKShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAq
ZW5jb2RlciwKLQkJCXN0cnVjdCBpbnRlbF9jb25uZWN0b3IgKmNvbm5lY3Rvcik7CisJZW51bSBp
bnRlbF9ob3RwbHVnX3N0YXRlICgqaG90cGx1Zykoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29k
ZXIsCisJCQkJCSAgICBzdHJ1Y3QgaW50ZWxfY29ubmVjdG9yICpjb25uZWN0b3IsCisJCQkJCSAg
ICBib29sIGlycV9yZWNlaXZlZCk7CiAJZW51bSBpbnRlbF9vdXRwdXRfdHlwZSAoKmNvbXB1dGVf
b3V0cHV0X3R5cGUpKHN0cnVjdCBpbnRlbF9lbmNvZGVyICosCiAJCQkJCQkgICAgICBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqLAogCQkJCQkJICAgICAgc3RydWN0IGRybV9jb25uZWN0b3Jfc3Rh
dGUgKik7Ci0tIAoyLjIyLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2lu
dGVsLWdmeA==

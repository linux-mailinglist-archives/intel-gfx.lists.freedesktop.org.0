Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 73D8A6798D
	for <lists+intel-gfx@lfdr.de>; Sat, 13 Jul 2019 12:00:39 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 793DD6E3E4;
	Sat, 13 Jul 2019 10:00:35 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 884C96E3CE
 for <intel-gfx@lists.freedesktop.org>; Sat, 13 Jul 2019 10:00:33 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17265477-1500050 
 for multiple; Sat, 13 Jul 2019 11:00:19 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sat, 13 Jul 2019 11:00:12 +0100
Message-Id: <20190713100016.8026-7-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190713100016.8026-1-chris@chris-wilson.co.uk>
References: <20190713100016.8026-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 07/11] drm/i915/uc: move GuC/HuC inside intel_gt
 under a new intel_uc
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogRGFuaWVsZSBDZXJhb2xvIFNwdXJpbyA8ZGFuaWVsZS5jZXJhb2xvc3B1cmlvQGludGVs
LmNvbT4KCkJlaW5nIHBhcnQgb2YgdGhlIEdUIEhXLCBpdCBtYWtlIHNlbnNlIHRvIGtlZXAgdGhl
IGd1Yy9odWMgc3RydWN0dXJlcwppbnNpZGUgdGhlIEdUIHN0cnVjdHVyZS4gVG8gaGVscCB3aXRo
IHRoZSBlbmNhcHN1bGF0aW9uIHdvcmsgZG9uZSBieSB0aGUKZm9sbG93aW5nIHBhdGNoZXMsIGJv
dGggc3RydWN0dXJlcyBhcmUgcGxhY2VkIGluc2lkZSBhIG5ldyBpbnRlbF91Ywpjb250YWluZXIu
IEFsdGhvdWdoIHRoaXMgcmVzdWx0cyBpbiBjb2RlIHdpdGggdWdseSBuZXN0ZWQgZGVyZWZlcmVu
Y2VzCihpOTE1LT5ndC51Yy5ndWMuLi4pLCBpdCBzYXZlcyB1cyB0aGUgZXh0cmEgd29yayByZXF1
aXJlZCBpbiBtb3ZpbmcKdGhlIHN0cnVjdHVyZXMgdHdpY2UgKGk5MTUgLT4gZ3QgLT4gdWMpLiBU
aGUgZm9sbG93aW5nIHBhdGNoZXMgd2lsbApyZWR1Y2UgdGhlIG51bWJlciBvZiBwbGFjZXMgd2hl
cmUgd2UgdHJ5IHRvIGFjY2VzcyB0aGUgZ3VjL2h1YwpzdHJ1Y3R1cmVzIGRpcmVjdGx5IGZyb20g
aTkxNSBhbmQgcmVkdWNlIHRoZSB1Z2xpbmVzcy4KClNpZ25lZC1vZmYtYnk6IERhbmllbGUgQ2Vy
YW9sbyBTcHVyaW8gPGRhbmllbGUuY2VyYW9sb3NwdXJpb0BpbnRlbC5jb20+CkNjOiBNaWNoYWwg
V2FqZGVjemtvIDxtaWNoYWwud2FqZGVjemtvQGludGVsLmNvbT4KQ2M6IENocmlzIFdpbHNvbiA8
Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2d0X3R5cGVzLmggICAgICB8ICA0ICsrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9yZXNldC5jICAgICAgICAgfCAgNiArLS0KIC4uLi9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxf
Z3VjX3N1Ym1pc3Npb24uYyB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRl
bF9odWMuYyAgICAgICAgfCAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxf
dWMuYyAgICAgICAgIHwgNTIgKysrKysrKysrLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvdWMvaW50ZWxfdWMuaCAgICAgICAgIHwgIDUgKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3VjL3NlbGZ0ZXN0X2d1Yy5jICAgICB8ICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2RlYnVnZnMuYyAgICAgICAgICAgfCAyNiArKysrKy0tLS0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2Rydi5jICAgICAgICAgICAgICAgfCAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9kcnYuaCAgICAgICAgICAgICAgIHwgIDcgKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dwdV9lcnJvci5jICAgICAgICAgfCAxMSArKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2lycS5jICAgICAgICAgICAgICAgfCAgNiArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2ludGVsX3dvcGNtLmMgICAgICAgICAgICB8ICA0ICstCiAxMyBmaWxlcyBjaGFuZ2VkLCA2OSBp
bnNlcnRpb25zKCspLCA2NCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9ndF90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50
ZWxfZ3RfdHlwZXMuaAppbmRleCAxZmZiYzNlYzZlZjMuLmQzYjkwYzZlZThjZiAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfdHlwZXMuaAorKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90eXBlcy5oCkBAIC0xMyw2ICsxMyw4IEBACiAjaW5j
bHVkZSA8bGludXgvc3BpbmxvY2suaD4KICNpbmNsdWRlIDxsaW51eC90eXBlcy5oPgogCisjaW5j
bHVkZSAidWMvaW50ZWxfdWMuaCIKKwogI2luY2x1ZGUgImk5MTVfdm1hLmgiCiAjaW5jbHVkZSAi
aW50ZWxfcmVzZXRfdHlwZXMuaCIKICNpbmNsdWRlICJpbnRlbF93YWtlcmVmLmgiCkBAIC0zNCw2
ICszNiw4IEBAIHN0cnVjdCBpbnRlbF9ndCB7CiAJc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3Jl
OwogCXN0cnVjdCBpOTE1X2dndHQgKmdndHQ7CiAKKwlzdHJ1Y3QgaW50ZWxfdWMgdWM7CisKIAlz
dHJ1Y3QgaW50ZWxfZ3RfdGltZWxpbmVzIHsKIAkJc3RydWN0IG11dGV4IG11dGV4OyAvKiBwcm90
ZWN0cyBsaXN0ICovCiAJCXN0cnVjdCBsaXN0X2hlYWQgYWN0aXZlX2xpc3Q7CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZXNldC5jIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfcmVzZXQuYwppbmRleCA4NDkwZDRhOTkxYWQuLmJkZDM0YTFkNzM5YSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmVzZXQuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yZXNldC5jCkBAIC0xMDk5LDE0ICsxMDk5LDE0
IEBAIGludCBpbnRlbF9lbmdpbmVfcmVzZXQoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5l
LCBjb25zdCBjaGFyICptc2cpCiAJCQkgICAiUmVzZXR0aW5nICVzIGZvciAlc1xuIiwgZW5naW5l
LT5uYW1lLCBtc2cpOwogCWF0b21pY19pbmMoJmVuZ2luZS0+aTkxNS0+Z3B1X2Vycm9yLnJlc2V0
X2VuZ2luZV9jb3VudFtlbmdpbmUtPnVhYmlfY2xhc3NdKTsKIAotCWlmICghZW5naW5lLT5pOTE1
LT5ndWMuZXhlY2J1Zl9jbGllbnQpCisJaWYgKCFlbmdpbmUtPmd0LT51Yy5ndWMuZXhlY2J1Zl9j
bGllbnQpCiAJCXJldCA9IGludGVsX2d0X3Jlc2V0X2VuZ2luZShlbmdpbmUpOwogCWVsc2UKLQkJ
cmV0ID0gaW50ZWxfZ3VjX3Jlc2V0X2VuZ2luZSgmZW5naW5lLT5pOTE1LT5ndWMsIGVuZ2luZSk7
CisJCXJldCA9IGludGVsX2d1Y19yZXNldF9lbmdpbmUoJmVuZ2luZS0+Z3QtPnVjLmd1YywgZW5n
aW5lKTsKIAlpZiAocmV0KSB7CiAJCS8qIElmIHdlIGZhaWwgaGVyZSwgd2UgZXhwZWN0IHRvIGZh
bGxiYWNrIHRvIGEgZ2xvYmFsIHJlc2V0ICovCiAJCURSTV9ERUJVR19EUklWRVIoIiVzRmFpbGVk
IHRvIHJlc2V0ICVzLCByZXQ9JWRcbiIsCi0JCQkJIGVuZ2luZS0+aTkxNS0+Z3VjLmV4ZWNidWZf
Y2xpZW50ID8gIkd1QyAiIDogIiIsCisJCQkJIGVuZ2luZS0+Z3QtPnVjLmd1Yy5leGVjYnVmX2Ns
aWVudCA/ICJHdUMgIiA6ICIiLAogCQkJCSBlbmdpbmUtPm5hbWUsIHJldCk7CiAJCWdvdG8gb3V0
OwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX2d1Y19z
dWJtaXNzaW9uLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF9ndWNfc3VibWlz
c2lvbi5jCmluZGV4IGUxZTRlNjgzY2UyMS4uZmEyMmQzNzdhZTQ4IDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF9ndWNfc3VibWlzc2lvbi5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX2d1Y19zdWJtaXNzaW9uLmMKQEAgLTUwOSw3ICs1
MDksNyBAQCBzdGF0aWMgdm9pZCBndWNfc3VibWl0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSwKIAkJICAgICAgIHN0cnVjdCBpOTE1X3JlcXVlc3QgKipvdXQsCiAJCSAgICAgICBzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICoqZW5kKQogewotCXN0cnVjdCBpbnRlbF9ndWMgKmd1YyA9ICZlbmdp
bmUtPmk5MTUtPmd1YzsKKwlzdHJ1Y3QgaW50ZWxfZ3VjICpndWMgPSAmZW5naW5lLT5ndC0+dWMu
Z3VjOwogCXN0cnVjdCBpbnRlbF9ndWNfY2xpZW50ICpjbGllbnQgPSBndWMtPmV4ZWNidWZfY2xp
ZW50OwogCiAJc3Bpbl9sb2NrKCZjbGllbnQtPndxX2xvY2spOwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfaHVjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC91Yy9pbnRlbF9odWMuYwppbmRleCAyYTQxZWU4OWExNmQuLjU4MWM5YzNkNGZjMCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfaHVjLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfaHVjLmMKQEAgLTQ3LDcgKzQ3LDcgQEAgdm9pZCBp
bnRlbF9odWNfaW5pdF9lYXJseShzdHJ1Y3QgaW50ZWxfaHVjICpodWMpCiBzdGF0aWMgaW50IGlu
dGVsX2h1Y19yc2FfZGF0YV9jcmVhdGUoc3RydWN0IGludGVsX2h1YyAqaHVjKQogewogCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gaHVjX3RvX2k5MTUoaHVjKTsKLQlzdHJ1Y3QgaW50
ZWxfZ3VjICpndWMgPSAmaTkxNS0+Z3VjOworCXN0cnVjdCBpbnRlbF9ndWMgKmd1YyA9ICZpOTE1
LT5ndC51Yy5ndWM7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJdm9pZCAqdmFkZHI7CiAKQEAg
LTExMyw3ICsxMTMsNyBAQCB2b2lkIGludGVsX2h1Y19maW5pKHN0cnVjdCBpbnRlbF9odWMgKmh1
YykKIGludCBpbnRlbF9odWNfYXV0aChzdHJ1Y3QgaW50ZWxfaHVjICpodWMpCiB7CiAJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBodWNfdG9faTkxNShodWMpOwotCXN0cnVjdCBpbnRl
bF9ndWMgKmd1YyA9ICZpOTE1LT5ndWM7CisJc3RydWN0IGludGVsX2d1YyAqZ3VjID0gJmk5MTUt
Pmd0LnVjLmd1YzsKIAlpbnQgcmV0OwogCiAJaWYgKGh1Yy0+ZncubG9hZF9zdGF0dXMgIT0gSU5U
RUxfVUNfRklSTVdBUkVfU1VDQ0VTUykKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3VjL2ludGVsX3VjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9pbnRlbF91Yy5j
CmluZGV4IDRlYTc2NjE3MDViMS4uZjQ3ZWU3NjAxYTY2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC91Yy9pbnRlbF91Yy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L3VjL2ludGVsX3VjLmMKQEAgLTU0LDggKzU0LDggQEAgc3RhdGljIGludCBfX2ludGVsX3VjX3Jl
c2V0X2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogc3RhdGljIGludCBf
X2dldF9wbGF0Zm9ybV9lbmFibGVfZ3VjKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
ewotCXN0cnVjdCBpbnRlbF91Y19mdyAqZ3VjX2Z3ID0gJmk5MTUtPmd1Yy5mdzsKLQlzdHJ1Y3Qg
aW50ZWxfdWNfZncgKmh1Y19mdyA9ICZpOTE1LT5odWMuZnc7CisJc3RydWN0IGludGVsX3VjX2Z3
ICpndWNfZncgPSAmaTkxNS0+Z3QudWMuZ3VjLmZ3OworCXN0cnVjdCBpbnRlbF91Y19mdyAqaHVj
X2Z3ID0gJmk5MTUtPmd0LnVjLmh1Yy5mdzsKIAlpbnQgZW5hYmxlX2d1YyA9IDA7CiAKIAlpZiAo
IUhBU19HVUMoaTkxNSkpCkBAIC03NSw3ICs3NSw3IEBAIHN0YXRpYyBpbnQgX19nZXRfZGVmYXVs
dF9ndWNfbG9nX2xldmVsKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewogCWludCBn
dWNfbG9nX2xldmVsOwogCi0JaWYgKCFpbnRlbF91Y19md19zdXBwb3J0ZWQoJmk5MTUtPmd1Yy5m
dykgfHwKKwlpZiAoIWludGVsX3VjX2Z3X3N1cHBvcnRlZCgmaTkxNS0+Z3QudWMuZ3VjLmZ3KSB8
fAogCSAgICAhaW50ZWxfdWNfaXNfdXNpbmdfZ3VjKGk5MTUpKQogCQlndWNfbG9nX2xldmVsID0g
R1VDX0xPR19MRVZFTF9ESVNBQkxFRDsKIAllbHNlIGlmIChJU19FTkFCTEVEKENPTkZJR19EUk1f
STkxNV9ERUJVRykgfHwKQEAgLTEwOCw4ICsxMDgsOCBAQCBzdGF0aWMgaW50IF9fZ2V0X2RlZmF1
bHRfZ3VjX2xvZ19sZXZlbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKICAqLwogc3Rh
dGljIHZvaWQgc2FuaXRpemVfb3B0aW9uc19lYXJseShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKIHsKLQlzdHJ1Y3QgaW50ZWxfdWNfZncgKmd1Y19mdyA9ICZpOTE1LT5ndWMuZnc7Ci0J
c3RydWN0IGludGVsX3VjX2Z3ICpodWNfZncgPSAmaTkxNS0+aHVjLmZ3OworCXN0cnVjdCBpbnRl
bF91Y19mdyAqZ3VjX2Z3ID0gJmk5MTUtPmd0LnVjLmd1Yy5mdzsKKwlzdHJ1Y3QgaW50ZWxfdWNf
ZncgKmh1Y19mdyA9ICZpOTE1LT5ndC51Yy5odWMuZnc7CiAKIAkvKiBBIG5lZ2F0aXZlIHZhbHVl
IG1lYW5zICJ1c2UgcGxhdGZvcm0gZGVmYXVsdCIgKi8KIAlpZiAoaTkxNV9tb2RwYXJhbXMuZW5h
YmxlX2d1YyA8IDApCkBAIC0xNzgsOCArMTc4LDggQEAgc3RhdGljIHZvaWQgc2FuaXRpemVfb3B0
aW9uc19lYXJseShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAogdm9pZCBpbnRlbF91
Y19pbml0X2Vhcmx5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBp
bnRlbF9ndWMgKmd1YyA9ICZpOTE1LT5ndWM7Ci0Jc3RydWN0IGludGVsX2h1YyAqaHVjID0gJmk5
MTUtPmh1YzsKKwlzdHJ1Y3QgaW50ZWxfZ3VjICpndWMgPSAmaTkxNS0+Z3QudWMuZ3VjOworCXN0
cnVjdCBpbnRlbF9odWMgKmh1YyA9ICZpOTE1LT5ndC51Yy5odWM7CiAKIAlpbnRlbF9ndWNfaW5p
dF9lYXJseShndWMpOwogCWludGVsX2h1Y19pbml0X2Vhcmx5KGh1Yyk7CkBAIC0xODksNyArMTg5
LDcgQEAgdm9pZCBpbnRlbF91Y19pbml0X2Vhcmx5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQogCiB2b2lkIGludGVsX3VjX2NsZWFudXBfZWFybHkoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGludGVsX2d1YyAqZ3VjID0gJmk5MTUtPmd1YzsKKwlzdHJ1
Y3QgaW50ZWxfZ3VjICpndWMgPSAmaTkxNS0+Z3QudWMuZ3VjOwogCiAJZ3VjX2ZyZWVfbG9hZF9l
cnJfbG9nKGd1Yyk7CiB9CkBAIC0yMDMsNyArMjAzLDcgQEAgdm9pZCBpbnRlbF91Y19jbGVhbnVw
X2Vhcmx5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogICovCiB2b2lkIGludGVsX3Vj
X2luaXRfbW1pbyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlpbnRlbF9ndWNf
aW5pdF9zZW5kX3JlZ3MoJmk5MTUtPmd1Yyk7CisJaW50ZWxfZ3VjX2luaXRfc2VuZF9yZWdzKCZp
OTE1LT5ndC51Yy5ndWMpOwogfQogCiBzdGF0aWMgdm9pZCBndWNfY2FwdHVyZV9sb2FkX2Vycl9s
b2coc3RydWN0IGludGVsX2d1YyAqZ3VjKQpAQCAtMzU1LDEwICszNTUsMTAgQEAgdm9pZCBpbnRl
bF91Y19mZXRjaF9maXJtd2FyZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJaWYg
KCFVU0VTX0dVQyhpOTE1KSkKIAkJcmV0dXJuOwogCi0JaW50ZWxfdWNfZndfZmV0Y2goaTkxNSwg
Jmk5MTUtPmd1Yy5mdyk7CisJaW50ZWxfdWNfZndfZmV0Y2goaTkxNSwgJmk5MTUtPmd0LnVjLmd1
Yy5mdyk7CiAKIAlpZiAoVVNFU19IVUMoaTkxNSkpCi0JCWludGVsX3VjX2Z3X2ZldGNoKGk5MTUs
ICZpOTE1LT5odWMuZncpOworCQlpbnRlbF91Y19md19mZXRjaChpOTE1LCAmaTkxNS0+Z3QudWMu
aHVjLmZ3KTsKIH0KIAogdm9pZCBpbnRlbF91Y19jbGVhbnVwX2Zpcm13YXJlcyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKQEAgLTM2NywxNSArMzY3LDE1IEBAIHZvaWQgaW50ZWxfdWNf
Y2xlYW51cF9maXJtd2FyZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJCXJldHVy
bjsKIAogCWlmIChVU0VTX0hVQyhpOTE1KSkKLQkJaW50ZWxfdWNfZndfY2xlYW51cF9mZXRjaCgm
aTkxNS0+aHVjLmZ3KTsKKwkJaW50ZWxfdWNfZndfY2xlYW51cF9mZXRjaCgmaTkxNS0+Z3QudWMu
aHVjLmZ3KTsKIAotCWludGVsX3VjX2Z3X2NsZWFudXBfZmV0Y2goJmk5MTUtPmd1Yy5mdyk7CisJ
aW50ZWxfdWNfZndfY2xlYW51cF9mZXRjaCgmaTkxNS0+Z3QudWMuZ3VjLmZ3KTsKIH0KIAogaW50
IGludGVsX3VjX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0
IGludGVsX2d1YyAqZ3VjID0gJmk5MTUtPmd1YzsKLQlzdHJ1Y3QgaW50ZWxfaHVjICpodWMgPSAm
aTkxNS0+aHVjOworCXN0cnVjdCBpbnRlbF9ndWMgKmd1YyA9ICZpOTE1LT5ndC51Yy5ndWM7CisJ
c3RydWN0IGludGVsX2h1YyAqaHVjID0gJmk5MTUtPmd0LnVjLmh1YzsKIAlpbnQgcmV0OwogCiAJ
aWYgKCFVU0VTX0dVQyhpOTE1KSkKQEAgLTQxOSw3ICs0MTksNyBAQCBpbnQgaW50ZWxfdWNfaW5p
dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAogdm9pZCBpbnRlbF91Y19maW5pKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBpbnRlbF9ndWMgKmd1YyA9
ICZpOTE1LT5ndWM7CisJc3RydWN0IGludGVsX2d1YyAqZ3VjID0gJmk5MTUtPmd0LnVjLmd1YzsK
IAogCWlmICghVVNFU19HVUMoaTkxNSkpCiAJCXJldHVybjsKQEAgLTQzMCwxNSArNDMwLDE1IEBA
IHZvaWQgaW50ZWxfdWNfZmluaShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkJaW50
ZWxfZ3VjX3N1Ym1pc3Npb25fZmluaShndWMpOwogCiAJaWYgKFVTRVNfSFVDKGk5MTUpKQotCQlp
bnRlbF9odWNfZmluaSgmaTkxNS0+aHVjKTsKKwkJaW50ZWxfaHVjX2ZpbmkoJmk5MTUtPmd0LnVj
Lmh1Yyk7CiAKIAlpbnRlbF9ndWNfZmluaShndWMpOwogfQogCiBzdGF0aWMgdm9pZCBfX3VjX3Nh
bml0aXplKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBpbnRlbF9n
dWMgKmd1YyA9ICZpOTE1LT5ndWM7Ci0Jc3RydWN0IGludGVsX2h1YyAqaHVjID0gJmk5MTUtPmh1
YzsKKwlzdHJ1Y3QgaW50ZWxfZ3VjICpndWMgPSAmaTkxNS0+Z3QudWMuZ3VjOworCXN0cnVjdCBp
bnRlbF9odWMgKmh1YyA9ICZpOTE1LT5ndC51Yy5odWM7CiAKIAlHRU1fQlVHX09OKCFpbnRlbF91
Y19md19zdXBwb3J0ZWQoJmd1Yy0+ZncpKTsKIApAQCAtNDU4LDggKzQ1OCw4IEBAIHZvaWQgaW50
ZWxfdWNfc2FuaXRpemUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAKIGludCBpbnRl
bF91Y19pbml0X2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBp
bnRlbF9ndWMgKmd1YyA9ICZpOTE1LT5ndWM7Ci0Jc3RydWN0IGludGVsX2h1YyAqaHVjID0gJmk5
MTUtPmh1YzsKKwlzdHJ1Y3QgaW50ZWxfZ3VjICpndWMgPSAmaTkxNS0+Z3QudWMuZ3VjOworCXN0
cnVjdCBpbnRlbF9odWMgKmh1YyA9ICZpOTE1LT5ndC51Yy5odWM7CiAJaW50IHJldCwgYXR0ZW1w
dHM7CiAKIAlpZiAoIVVTRVNfR1VDKGk5MTUpKQpAQCAtNTU3LDcgKzU1Nyw3IEBAIGludCBpbnRl
bF91Y19pbml0X2h3KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCiB2b2lkIGludGVs
X3VjX2ZpbmlfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGlu
dGVsX2d1YyAqZ3VjID0gJmk5MTUtPmd1YzsKKwlzdHJ1Y3QgaW50ZWxfZ3VjICpndWMgPSAmaTkx
NS0+Z3QudWMuZ3VjOwogCiAJaWYgKCFpbnRlbF9ndWNfaXNfbG9hZGVkKGd1YykpCiAJCXJldHVy
bjsKQEAgLTU3OSw3ICs1NzksNyBAQCB2b2lkIGludGVsX3VjX2ZpbmlfaHcoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUpCiAgKi8KIHZvaWQgaW50ZWxfdWNfcmVzZXRfcHJlcGFyZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3QgaW50ZWxfZ3VjICpndWMgPSAm
aTkxNS0+Z3VjOworCXN0cnVjdCBpbnRlbF9ndWMgKmd1YyA9ICZpOTE1LT5ndC51Yy5ndWM7CiAK
IAlpZiAoIWludGVsX2d1Y19pc19sb2FkZWQoZ3VjKSkKIAkJcmV0dXJuOwpAQCAtNTkwLDcgKzU5
MCw3IEBAIHZvaWQgaW50ZWxfdWNfcmVzZXRfcHJlcGFyZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKIAogdm9pZCBpbnRlbF91Y19ydW50aW1lX3N1c3BlbmQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiB7Ci0Jc3RydWN0IGludGVsX2d1YyAqZ3VjID0gJmk5MTUtPmd1YzsK
KwlzdHJ1Y3QgaW50ZWxfZ3VjICpndWMgPSAmaTkxNS0+Z3QudWMuZ3VjOwogCWludCBlcnI7CiAK
IAlpZiAoIWludGVsX2d1Y19pc19sb2FkZWQoZ3VjKSkKQEAgLTYwNSw3ICs2MDUsNyBAQCB2b2lk
IGludGVsX3VjX3J1bnRpbWVfc3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkK
IAogdm9pZCBpbnRlbF91Y19zdXNwZW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQog
ewotCXN0cnVjdCBpbnRlbF9ndWMgKmd1YyA9ICZpOTE1LT5ndWM7CisJc3RydWN0IGludGVsX2d1
YyAqZ3VjID0gJmk5MTUtPmd0LnVjLmd1YzsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAog
CWlmICghaW50ZWxfZ3VjX2lzX2xvYWRlZChndWMpKQpAQCAtNjE3LDcgKzYxNyw3IEBAIHZvaWQg
aW50ZWxfdWNfc3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAogaW50IGlu
dGVsX3VjX3Jlc3VtZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlzdHJ1Y3Qg
aW50ZWxfZ3VjICpndWMgPSAmaTkxNS0+Z3VjOworCXN0cnVjdCBpbnRlbF9ndWMgKmd1YyA9ICZp
OTE1LT5ndC51Yy5ndWM7CiAJaW50IGVycjsKIAogCWlmICghaW50ZWxfZ3VjX2lzX2xvYWRlZChn
dWMpKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfdWMuaCBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2ludGVsX3VjLmgKaW5kZXggNWExMzgzZTE5MmRk
Li5hMmZkYzg0YWZmZjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL2lu
dGVsX3VjLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvdWMvaW50ZWxfdWMuaApAQCAt
MjgsNiArMjgsMTEgQEAKICNpbmNsdWRlICJpbnRlbF9odWMuaCIKICNpbmNsdWRlICJpOTE1X3Bh
cmFtcy5oIgogCitzdHJ1Y3QgaW50ZWxfdWMgeworCXN0cnVjdCBpbnRlbF9ndWMgZ3VjOworCXN0
cnVjdCBpbnRlbF9odWMgaHVjOworfTsKKwogdm9pZCBpbnRlbF91Y19pbml0X2Vhcmx5KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiB2b2lkIGludGVsX3VjX2NsZWFudXBfZWFy
bHkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIHZvaWQgaW50ZWxfdWNfaW5p
dF9tbWlvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9zZWxmdGVzdF9ndWMuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3VjL3NlbGZ0ZXN0X2d1Yy5jCmluZGV4IDZjYTc2ZjVhOThkNC4uOTNmN2M5MzBh
YjE4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9zZWxmdGVzdF9ndWMu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9zZWxmdGVzdF9ndWMuYwpAQCAtMTM4
LDcgKzEzOCw3IEBAIHN0YXRpYyBpbnQgaWd0X2d1Y19jbGllbnRzKHZvaWQgKmFyZ3MpCiAJbXV0
ZXhfbG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXdha2VyZWYgPSBpbnRlbF9y
dW50aW1lX3BtX2dldCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0pOwogCi0JZ3VjID0gJmRldl9wcml2
LT5ndWM7CisJZ3VjID0gJmRldl9wcml2LT5ndC51Yy5ndWM7CiAJaWYgKCFndWMpIHsKIAkJcHJf
ZXJyKCJObyBndWMgb2JqZWN0IVxuIik7CiAJCWVyciA9IC1FSU5WQUw7CkBAIC0yMzAsNyArMjMw
LDcgQEAgc3RhdGljIGludCBpZ3RfZ3VjX2Rvb3JiZWxscyh2b2lkICphcmcpCiAJbXV0ZXhfbG9j
aygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXdha2VyZWYgPSBpbnRlbF9ydW50aW1l
X3BtX2dldCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0pOwogCi0JZ3VjID0gJmRldl9wcml2LT5ndWM7
CisJZ3VjID0gJmRldl9wcml2LT5ndC51Yy5ndWM7CiAJaWYgKCFndWMpIHsKIAkJcHJfZXJyKCJO
byBndWMgb2JqZWN0IVxuIik7CiAJCWVyciA9IC1FSU5WQUw7CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZGVidWdmcy5jCmluZGV4IDYzMDI0YzBkMGNkOS4uMGFjOWI4ZDVlOGI5IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2RlYnVnZnMuYwpAQCAtMTg2OSw3ICsxODY5LDcgQEAgc3RhdGljIGludCBpOTE1
X2h1Y19sb2FkX3N0YXR1c19pbmZvKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKIAkJ
cmV0dXJuIC1FTk9ERVY7CiAKIAlwID0gZHJtX3NlcV9maWxlX3ByaW50ZXIobSk7Ci0JaW50ZWxf
dWNfZndfZHVtcCgmZGV2X3ByaXYtPmh1Yy5mdywgJnApOworCWludGVsX3VjX2Z3X2R1bXAoJmRl
dl9wcml2LT5ndC51Yy5odWMuZncsICZwKTsKIAogCXdpdGhfaW50ZWxfcnVudGltZV9wbSgmZGV2
X3ByaXYtPnJ1bnRpbWVfcG0sIHdha2VyZWYpCiAJCXNlcV9wcmludGYobSwgIlxuSHVDIHN0YXR1
cyAweCUwOHg6XG4iLCBJOTE1X1JFQUQoSFVDX1NUQVRVUzIpKTsKQEAgLTE4ODcsNyArMTg4Nyw3
IEBAIHN0YXRpYyBpbnQgaTkxNV9ndWNfbG9hZF9zdGF0dXNfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUg
Km0sIHZvaWQgKmRhdGEpCiAJCXJldHVybiAtRU5PREVWOwogCiAJcCA9IGRybV9zZXFfZmlsZV9w
cmludGVyKG0pOwotCWludGVsX3VjX2Z3X2R1bXAoJmRldl9wcml2LT5ndWMuZncsICZwKTsKKwlp
bnRlbF91Y19md19kdW1wKCZkZXZfcHJpdi0+Z3QudWMuZ3VjLmZ3LCAmcCk7CiAKIAl3aXRoX2lu
dGVsX3J1bnRpbWVfcG0oJmRldl9wcml2LT5ydW50aW1lX3BtLCB3YWtlcmVmKSB7CiAJCXUzMiB0
bXAgPSBJOTE1X1JFQUQoR1VDX1NUQVRVUyk7CkBAIC0xOTMwLDcgKzE5MzAsNyBAQCBzdHJpbmdp
ZnlfZ3VjX2xvZ190eXBlKGVudW0gZ3VjX2xvZ19idWZmZXJfdHlwZSB0eXBlKQogc3RhdGljIHZv
aWQgaTkxNV9ndWNfbG9nX2luZm8oc3RydWN0IHNlcV9maWxlICptLAogCQkJICAgICAgc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogewotCXN0cnVjdCBpbnRlbF9ndWNfbG9nICps
b2cgPSAmZGV2X3ByaXYtPmd1Yy5sb2c7CisJc3RydWN0IGludGVsX2d1Y19sb2cgKmxvZyA9ICZk
ZXZfcHJpdi0+Z3QudWMuZ3VjLmxvZzsKIAllbnVtIGd1Y19sb2dfYnVmZmVyX3R5cGUgdHlwZTsK
IAogCWlmICghaW50ZWxfZ3VjX2xvZ19yZWxheV9lbmFibGVkKGxvZykpIHsKQEAgLTE5NzYsNyAr
MTk3Niw3IEBAIHN0YXRpYyB2b2lkIGk5MTVfZ3VjX2NsaWVudF9pbmZvKHN0cnVjdCBzZXFfZmls
ZSAqbSwKIHN0YXRpYyBpbnQgaTkxNV9ndWNfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQg
KmRhdGEpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9kZV90b19p
OTE1KG0tPnByaXZhdGUpOwotCWNvbnN0IHN0cnVjdCBpbnRlbF9ndWMgKmd1YyA9ICZkZXZfcHJp
di0+Z3VjOworCWNvbnN0IHN0cnVjdCBpbnRlbF9ndWMgKmd1YyA9ICZkZXZfcHJpdi0+Z3QudWMu
Z3VjOwogCiAJaWYgKCFVU0VTX0dVQyhkZXZfcHJpdikpCiAJCXJldHVybiAtRU5PREVWOwpAQCAt
MjAwMyw3ICsyMDAzLDcgQEAgc3RhdGljIGludCBpOTE1X2d1Y19pbmZvKHN0cnVjdCBzZXFfZmls
ZSAqbSwgdm9pZCAqZGF0YSkKIHN0YXRpYyBpbnQgaTkxNV9ndWNfc3RhZ2VfcG9vbChzdHJ1Y3Qg
c2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gbm9kZV90b19pOTE1KG0tPnByaXZhdGUpOwotCWNvbnN0IHN0cnVjdCBpbnRlbF9n
dWMgKmd1YyA9ICZkZXZfcHJpdi0+Z3VjOworCWNvbnN0IHN0cnVjdCBpbnRlbF9ndWMgKmd1YyA9
ICZkZXZfcHJpdi0+Z3QudWMuZ3VjOwogCXN0cnVjdCBndWNfc3RhZ2VfZGVzYyAqZGVzYyA9IGd1
Yy0+c3RhZ2VfZGVzY19wb29sX3ZhZGRyOwogCWludGVsX2VuZ2luZV9tYXNrX3QgdG1wOwogCWlu
dCBpbmRleDsKQEAgLTIwNjYsOSArMjA2Niw5IEBAIHN0YXRpYyBpbnQgaTkxNV9ndWNfbG9nX2R1
bXAoc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCQlyZXR1cm4gLUVOT0RFVjsKIAog
CWlmIChkdW1wX2xvYWRfZXJyKQotCQlvYmogPSBkZXZfcHJpdi0+Z3VjLmxvYWRfZXJyX2xvZzsK
LQllbHNlIGlmIChkZXZfcHJpdi0+Z3VjLmxvZy52bWEpCi0JCW9iaiA9IGRldl9wcml2LT5ndWMu
bG9nLnZtYS0+b2JqOworCQlvYmogPSBkZXZfcHJpdi0+Z3QudWMuZ3VjLmxvYWRfZXJyX2xvZzsK
KwllbHNlIGlmIChkZXZfcHJpdi0+Z3QudWMuZ3VjLmxvZy52bWEpCisJCW9iaiA9IGRldl9wcml2
LT5ndC51Yy5ndWMubG9nLnZtYS0+b2JqOwogCiAJaWYgKCFvYmopCiAJCXJldHVybiAwOwpAQCAt
MjA5OSw3ICsyMDk5LDcgQEAgc3RhdGljIGludCBpOTE1X2d1Y19sb2dfbGV2ZWxfZ2V0KHZvaWQg
KmRhdGEsIHU2NCAqdmFsKQogCWlmICghVVNFU19HVUMoZGV2X3ByaXYpKQogCQlyZXR1cm4gLUVO
T0RFVjsKIAotCSp2YWwgPSBpbnRlbF9ndWNfbG9nX2dldF9sZXZlbCgmZGV2X3ByaXYtPmd1Yy5s
b2cpOworCSp2YWwgPSBpbnRlbF9ndWNfbG9nX2dldF9sZXZlbCgmZGV2X3ByaXYtPmd0LnVjLmd1
Yy5sb2cpOwogCiAJcmV0dXJuIDA7CiB9CkBAIC0yMTExLDcgKzIxMTEsNyBAQCBzdGF0aWMgaW50
IGk5MTVfZ3VjX2xvZ19sZXZlbF9zZXQodm9pZCAqZGF0YSwgdTY0IHZhbCkKIAlpZiAoIVVTRVNf
R1VDKGRldl9wcml2KSkKIAkJcmV0dXJuIC1FTk9ERVY7CiAKLQlyZXR1cm4gaW50ZWxfZ3VjX2xv
Z19zZXRfbGV2ZWwoJmRldl9wcml2LT5ndWMubG9nLCB2YWwpOworCXJldHVybiBpbnRlbF9ndWNf
bG9nX3NldF9sZXZlbCgmZGV2X3ByaXYtPmd0LnVjLmd1Yy5sb2csIHZhbCk7CiB9CiAKIERFRklO
RV9TSU1QTEVfQVRUUklCVVRFKGk5MTVfZ3VjX2xvZ19sZXZlbF9mb3BzLApAQCAtMjEyNSw5ICsy
MTI1LDkgQEAgc3RhdGljIGludCBpOTE1X2d1Y19sb2dfcmVsYXlfb3BlbihzdHJ1Y3QgaW5vZGUg
Kmlub2RlLCBzdHJ1Y3QgZmlsZSAqZmlsZSkKIAlpZiAoIVVTRVNfR1VDKGRldl9wcml2KSkKIAkJ
cmV0dXJuIC1FTk9ERVY7CiAKLQlmaWxlLT5wcml2YXRlX2RhdGEgPSAmZGV2X3ByaXYtPmd1Yy5s
b2c7CisJZmlsZS0+cHJpdmF0ZV9kYXRhID0gJmRldl9wcml2LT5ndC51Yy5ndWMubG9nOwogCi0J
cmV0dXJuIGludGVsX2d1Y19sb2dfcmVsYXlfb3BlbigmZGV2X3ByaXYtPmd1Yy5sb2cpOworCXJl
dHVybiBpbnRlbF9ndWNfbG9nX3JlbGF5X29wZW4oJmRldl9wcml2LT5ndC51Yy5ndWMubG9nKTsK
IH0KIAogc3RhdGljIHNzaXplX3QKQEAgLTIxNDcsNyArMjE0Nyw3IEBAIHN0YXRpYyBpbnQgaTkx
NV9ndWNfbG9nX3JlbGF5X3JlbGVhc2Uoc3RydWN0IGlub2RlICppbm9kZSwgc3RydWN0IGZpbGUg
KmZpbGUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gaW5vZGUtPmlf
cHJpdmF0ZTsKIAotCWludGVsX2d1Y19sb2dfcmVsYXlfY2xvc2UoJmRldl9wcml2LT5ndWMubG9n
KTsKKwlpbnRlbF9ndWNfbG9nX3JlbGF5X2Nsb3NlKCZkZXZfcHJpdi0+Z3QudWMuZ3VjLmxvZyk7
CiAKIAlyZXR1cm4gMDsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jCmluZGV4IDdhNzc0NjY5ZjNk
NS4uNjY0ZjE3YjQ4NzZkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Ry
di5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMKQEAgLTQyNiw3ICs0MjYs
NyBAQCBzdGF0aWMgaW50IGk5MTVfZ2V0cGFyYW1faW9jdGwoc3RydWN0IGRybV9kZXZpY2UgKmRl
diwgdm9pZCAqZGF0YSwKIAkJdmFsdWUgPSBzc2V1LT5taW5fZXVfaW5fcG9vbDsKIAkJYnJlYWs7
CiAJY2FzZSBJOTE1X1BBUkFNX0hVQ19TVEFUVVM6Ci0JCXZhbHVlID0gaW50ZWxfaHVjX2NoZWNr
X3N0YXR1cygmZGV2X3ByaXYtPmh1Yyk7CisJCXZhbHVlID0gaW50ZWxfaHVjX2NoZWNrX3N0YXR1
cygmZGV2X3ByaXYtPmd0LnVjLmh1Yyk7CiAJCWlmICh2YWx1ZSA8IDApCiAJCQlyZXR1cm4gdmFs
dWU7CiAJCWJyZWFrOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYu
aCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKaW5kZXggZWJjNDQ0ODk2Njg2Li45
ZDkyNTE2YWYwNjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaApAQCAtMTM0OSw5ICsxMzQ5LDYg
QEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgewogCiAJc3RydWN0IGludGVsX3dvcGNtIHdvcGNt
OwogCi0Jc3RydWN0IGludGVsX2h1YyBodWM7Ci0Jc3RydWN0IGludGVsX2d1YyBndWM7Ci0KIAlz
dHJ1Y3QgaW50ZWxfY3NyIGNzcjsKIAogCXN0cnVjdCBpbnRlbF9nbWJ1cyBnbWJ1c1tHTUJVU19O
VU1fUElOU107CkBAIC0xOTA4LDEyICsxOTA1LDEyIEBAIHN0YXRpYyBpbmxpbmUgc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKndvcGNtX3RvX2k5MTUoc3RydWN0IGludGVsX3dvcGNtICp3b3BjbSkK
IAogc3RhdGljIGlubGluZSBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZ3VjX3RvX2k5MTUoc3Ry
dWN0IGludGVsX2d1YyAqZ3VjKQogewotCXJldHVybiBjb250YWluZXJfb2YoZ3VjLCBzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSwgZ3VjKTsKKwlyZXR1cm4gY29udGFpbmVyX29mKGd1Yywgc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUsIGd0LnVjLmd1Yyk7CiB9CiAKIHN0YXRpYyBpbmxpbmUgc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmh1Y190b19pOTE1KHN0cnVjdCBpbnRlbF9odWMgKmh1YykKIHsK
LQlyZXR1cm4gY29udGFpbmVyX29mKGh1Yywgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUsIGh1Yyk7
CisJcmV0dXJuIGNvbnRhaW5lcl9vZihodWMsIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlLCBndC51
Yy5odWMpOwogfQogCiAvKiBTaW1wbGUgaXRlcmF0b3Igb3ZlciBhbGwgaW5pdGlhbGlzZWQgZW5n
aW5lcyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3Iu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ3B1X2Vycm9yLmMKaW5kZXggNTQ4OWNkODc5
MzE1Li43OGUzODhmYTA1OWMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
Z3B1X2Vycm9yLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9ncHVfZXJyb3IuYwpA
QCAtMTU1MiwyMSArMTU1MiwyMiBAQCBzdGF0aWMgdm9pZCBjYXB0dXJlX3VjX3N0YXRlKHN0cnVj
dCBpOTE1X2dwdV9zdGF0ZSAqZXJyb3IpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUgPSBlcnJvci0+aTkxNTsKIAlzdHJ1Y3QgaTkxNV9lcnJvcl91YyAqZXJyb3JfdWMgPSAmZXJy
b3ItPnVjOworCXN0cnVjdCBpbnRlbF91YyAqdWMgPSAmaTkxNS0+Z3QudWM7CiAKIAkvKiBDYXB0
dXJpbmcgdUMgc3RhdGUgd29uJ3QgYmUgdXNlZnVsIGlmIHRoZXJlIGlzIG5vIEd1QyAqLwogCWlm
ICghZXJyb3ItPmRldmljZV9pbmZvLmhhc19ndWMpCiAJCXJldHVybjsKIAotCWVycm9yX3VjLT5n
dWNfZncgPSBpOTE1LT5ndWMuZnc7Ci0JZXJyb3JfdWMtPmh1Y19mdyA9IGk5MTUtPmh1Yy5mdzsK
KwllcnJvcl91Yy0+Z3VjX2Z3ID0gdWMtPmd1Yy5mdzsKKwllcnJvcl91Yy0+aHVjX2Z3ID0gdWMt
Pmh1Yy5mdzsKIAogCS8qIE5vbi1kZWZhdWx0IGZpcm13YXJlIHBhdGhzIHdpbGwgYmUgc3BlY2lm
aWVkIGJ5IHRoZSBtb2RwYXJhbS4KIAkgKiBBcyBtb2RwYXJhbXMgYXJlIGdlbmVyYWxseSBhY2Nl
c2libGUgZnJvbSB0aGUgdXNlcnNwYWNlIG1ha2UKIAkgKiBleHBsaWNpdCBjb3BpZXMgb2YgdGhl
IGZpcm13YXJlIHBhdGhzLgogCSAqLwotCWVycm9yX3VjLT5ndWNfZncucGF0aCA9IGtzdHJkdXAo
aTkxNS0+Z3VjLmZ3LnBhdGgsIEdGUF9BVE9NSUMpOwotCWVycm9yX3VjLT5odWNfZncucGF0aCA9
IGtzdHJkdXAoaTkxNS0+aHVjLmZ3LnBhdGgsIEdGUF9BVE9NSUMpOwotCWVycm9yX3VjLT5ndWNf
bG9nID0gaTkxNV9lcnJvcl9vYmplY3RfY3JlYXRlKGk5MTUsIGk5MTUtPmd1Yy5sb2cudm1hKTsK
KwllcnJvcl91Yy0+Z3VjX2Z3LnBhdGggPSBrc3RyZHVwKHVjLT5ndWMuZncucGF0aCwgR0ZQX0FU
T01JQyk7CisJZXJyb3JfdWMtPmh1Y19mdy5wYXRoID0ga3N0cmR1cCh1Yy0+aHVjLmZ3LnBhdGgs
IEdGUF9BVE9NSUMpOworCWVycm9yX3VjLT5ndWNfbG9nID0gaTkxNV9lcnJvcl9vYmplY3RfY3Jl
YXRlKGk5MTUsIHVjLT5ndWMubG9nLnZtYSk7CiB9CiAKIC8qIENhcHR1cmUgYWxsIHJlZ2lzdGVy
cyB3aGljaCBkb24ndCBmaXQgaW50byBhbm90aGVyIGNhdGVnb3J5LiAqLwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9pcnEuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfaXJxLmMKaW5kZXggNDJkNmQ4YmZhYzcwLi43OGM3NDhjYjlkZjggMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfaXJxLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9pcnEuYwpAQCAtMTY1NSw3ICsxNjU1LDcgQEAgc3RhdGljIHZvaWQgZ2VuOF9ndF9pcnFf
aGFuZGxlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAogCWlmIChtYXN0ZXJfY3Rs
ICYgKEdFTjhfR1RfUE1fSVJRIHwgR0VOOF9HVF9HVUNfSVJRKSkgewogCQlnZW42X3Jwc19pcnFf
aGFuZGxlcihpOTE1LCBndF9paXJbMl0pOwotCQlndWNfaXJxX2hhbmRsZXIoJmk5MTUtPmd1Yywg
Z3RfaWlyWzJdID4+IDE2KTsKKwkJZ3VjX2lycV9oYW5kbGVyKCZpOTE1LT5ndC51Yy5ndWMsIGd0
X2lpclsyXSA+PiAxNik7CiAJfQogfQogCkBAIC0zMDgyLDEwICszMDgyLDggQEAgc3RhdGljIHZv
aWQKIGdlbjExX290aGVyX2lycV9oYW5kbGVyKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIGNvbnN0IHU4
IGluc3RhbmNlLAogCQkJY29uc3QgdTE2IGlpcikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IGd0LT5pOTE1OwotCiAJaWYgKGluc3RhbmNlID09IE9USEVSX0dVQ19JTlNUQU5D
RSkKLQkJcmV0dXJuIGd1Y19pcnFfaGFuZGxlcigmaTkxNS0+Z3VjLCBpaXIpOworCQlyZXR1cm4g
Z3VjX2lycV9oYW5kbGVyKCZndC0+dWMuZ3VjLCBpaXIpOwogCiAJaWYgKGluc3RhbmNlID09IE9U
SEVSX0dUUE1fSU5TVEFOQ0UpCiAJCXJldHVybiBnZW4xMV9ycHNfaXJxX2hhbmRsZXIoZ3QsIGlp
cik7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF93b3BjbS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd29wY20uYwppbmRleCBhNmJjMTViYzdiZTMuLmZhZmQ0
ZTZhMTE0NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfd29wY20uYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF93b3BjbS5jCkBAIC0xNjQsOCArMTY0LDgg
QEAgc3RhdGljIGlubGluZSBpbnQgY2hlY2tfaHdfcmVzdHJpY3Rpb24oc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsCiBpbnQgaW50ZWxfd29wY21faW5pdChzdHJ1Y3QgaW50ZWxfd29wY20g
KndvcGNtKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gd29wY21fdG9faTkx
NSh3b3BjbSk7Ci0JdTMyIGd1Y19md19zaXplID0gaW50ZWxfdWNfZndfZ2V0X3VwbG9hZF9zaXpl
KCZpOTE1LT5ndWMuZncpOwotCXUzMiBodWNfZndfc2l6ZSA9IGludGVsX3VjX2Z3X2dldF91cGxv
YWRfc2l6ZSgmaTkxNS0+aHVjLmZ3KTsKKwl1MzIgZ3VjX2Z3X3NpemUgPSBpbnRlbF91Y19md19n
ZXRfdXBsb2FkX3NpemUoJmk5MTUtPmd0LnVjLmd1Yy5mdyk7CisJdTMyIGh1Y19md19zaXplID0g
aW50ZWxfdWNfZndfZ2V0X3VwbG9hZF9zaXplKCZpOTE1LT5ndC51Yy5odWMuZncpOwogCXUzMiBj
dHhfcnN2ZCA9IGNvbnRleHRfcmVzZXJ2ZWRfc2l6ZShpOTE1KTsKIAl1MzIgZ3VjX3dvcGNtX2Jh
c2U7CiAJdTMyIGd1Y193b3BjbV9zaXplOwotLSAKMi4yMi4wCgpfX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVs
LWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcv
bWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

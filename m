Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id CD806E69FC
	for <lists+intel-gfx@lfdr.de>; Sun, 27 Oct 2019 23:58:38 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EAAFD6E330;
	Sun, 27 Oct 2019 22:58:32 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A2C4689E7B
 for <intel-gfx@lists.freedesktop.org>; Sun, 27 Oct 2019 22:58:31 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18987251-1500050 
 for multiple; Sun, 27 Oct 2019 22:58:10 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sun, 27 Oct 2019 22:58:07 +0000
Message-Id: <20191027225808.19437-4-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0.rc1
In-Reply-To: <20191027225808.19437-1-chris@chris-wilson.co.uk>
References: <20191027225808.19437-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 4/5] drm/i915/selftests: Use a random engine for
 GEM coherency tests
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: matthew.auld@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U2VsZWN0IGEgcmFuZG9tIHVzZXIgYWNjZXNzaWJsZSBlbmdpbmUgZm9yIGNoZWNraW5nIGNvaGVy
ZW5jeSByZXN1bHRzLgpXaGlsZSB3ZSBzaG91bGQgY2hlY2sgYWxsIGVuZ2luZXMsIHdlIHVzZSBh
IHJhbmRvbSBzZWxlY3Rpb24gc28gdGhhdApvdmVyIHJlcGVhdGVkIHJ1bnMgd2UgY292ZXIgYWxs
LgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+
Ci0tLQogLi4uL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb2hlcmVuY3kuYyAgIHwgMTY4
ICsrKysrKysrKystLS0tLS0tLQogMSBmaWxlIGNoYW5nZWQsIDg5IGluc2VydGlvbnMoKyksIDc5
IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxm
dGVzdHMvaTkxNV9nZW1fY29oZXJlbmN5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL2k5MTVfZ2VtX2NvaGVyZW5jeS5jCmluZGV4IDA4NzdlZjRkZmY2My4uMGExOTVlNWI5
OGU2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVf
Z2VtX2NvaGVyZW5jeS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMv
aTkxNV9nZW1fY29oZXJlbmN5LmMKQEAgLTEzLDkgKzEzLDEyIEBACiAjaW5jbHVkZSAiaTkxNV9z
ZWxmdGVzdC5oIgogI2luY2x1ZGUgInNlbGZ0ZXN0cy9pOTE1X3JhbmRvbS5oIgogCi1zdGF0aWMg
aW50IGNwdV9zZXQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKLQkJICAgdW5zaWdu
ZWQgbG9uZyBvZmZzZXQsCi0JCSAgIHUzMiB2KQorc3RydWN0IGNvbnRleHQgeworCXN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5l
OworfTsKKworc3RhdGljIGludCBjcHVfc2V0KHN0cnVjdCBjb250ZXh0ICpjdHgsIHVuc2lnbmVk
IGxvbmcgb2Zmc2V0LCB1MzIgdikKIHsKIAl1bnNpZ25lZCBpbnQgbmVlZHNfY2xmbHVzaDsKIAlz
dHJ1Y3QgcGFnZSAqcGFnZTsKQEAgLTIzLDExICsyNiwxMSBAQCBzdGF0aWMgaW50IGNwdV9zZXQo
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAl1MzIgKmNwdTsKIAlpbnQgZXJyOwog
Ci0JZXJyID0gaTkxNV9nZW1fb2JqZWN0X3ByZXBhcmVfd3JpdGUob2JqLCAmbmVlZHNfY2xmbHVz
aCk7CisJZXJyID0gaTkxNV9nZW1fb2JqZWN0X3ByZXBhcmVfd3JpdGUoY3R4LT5vYmosICZuZWVk
c19jbGZsdXNoKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwogCi0JcGFnZSA9IGk5MTVfZ2Vt
X29iamVjdF9nZXRfcGFnZShvYmosIG9mZnNldCA+PiBQQUdFX1NISUZUKTsKKwlwYWdlID0gaTkx
NV9nZW1fb2JqZWN0X2dldF9wYWdlKGN0eC0+b2JqLCBvZmZzZXQgPj4gUEFHRV9TSElGVCk7CiAJ
bWFwID0ga21hcF9hdG9taWMocGFnZSk7CiAJY3B1ID0gbWFwICsgb2Zmc2V0X2luX3BhZ2Uob2Zm
c2V0KTsKIApAQCAtNDAsMTQgKzQzLDEyIEBAIHN0YXRpYyBpbnQgY3B1X3NldChzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQlkcm1fY2xmbHVzaF92aXJ0X3JhbmdlKGNwdSwgc2l6
ZW9mKCpjcHUpKTsKIAogCWt1bm1hcF9hdG9taWMobWFwKTsKLQlpOTE1X2dlbV9vYmplY3RfZmlu
aXNoX2FjY2VzcyhvYmopOworCWk5MTVfZ2VtX29iamVjdF9maW5pc2hfYWNjZXNzKGN0eC0+b2Jq
KTsKIAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IGNwdV9nZXQoc3RydWN0IGRybV9pOTE1
X2dlbV9vYmplY3QgKm9iaiwKLQkJICAgdW5zaWduZWQgbG9uZyBvZmZzZXQsCi0JCSAgIHUzMiAq
dikKK3N0YXRpYyBpbnQgY3B1X2dldChzdHJ1Y3QgY29udGV4dCAqY3R4LCB1bnNpZ25lZCBsb25n
IG9mZnNldCwgdTMyICp2KQogewogCXVuc2lnbmVkIGludCBuZWVkc19jbGZsdXNoOwogCXN0cnVj
dCBwYWdlICpwYWdlOwpAQCAtNTUsMTEgKzU2LDExIEBAIHN0YXRpYyBpbnQgY3B1X2dldChzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCXUzMiAqY3B1OwogCWludCBlcnI7CiAKLQll
cnIgPSBpOTE1X2dlbV9vYmplY3RfcHJlcGFyZV9yZWFkKG9iaiwgJm5lZWRzX2NsZmx1c2gpOwor
CWVyciA9IGk5MTVfZ2VtX29iamVjdF9wcmVwYXJlX3JlYWQoY3R4LT5vYmosICZuZWVkc19jbGZs
dXNoKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwogCi0JcGFnZSA9IGk5MTVfZ2VtX29iamVj
dF9nZXRfcGFnZShvYmosIG9mZnNldCA+PiBQQUdFX1NISUZUKTsKKwlwYWdlID0gaTkxNV9nZW1f
b2JqZWN0X2dldF9wYWdlKGN0eC0+b2JqLCBvZmZzZXQgPj4gUEFHRV9TSElGVCk7CiAJbWFwID0g
a21hcF9hdG9taWMocGFnZSk7CiAJY3B1ID0gbWFwICsgb2Zmc2V0X2luX3BhZ2Uob2Zmc2V0KTsK
IApAQCAtNjksMjYgKzcwLDI0IEBAIHN0YXRpYyBpbnQgY3B1X2dldChzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqLAogCSp2ID0gKmNwdTsKIAogCWt1bm1hcF9hdG9taWMobWFwKTsKLQlp
OTE1X2dlbV9vYmplY3RfZmluaXNoX2FjY2VzcyhvYmopOworCWk5MTVfZ2VtX29iamVjdF9maW5p
c2hfYWNjZXNzKGN0eC0+b2JqKTsKIAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IGd0dF9z
ZXQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKLQkJICAgdW5zaWduZWQgbG9uZyBv
ZmZzZXQsCi0JCSAgIHUzMiB2KQorc3RhdGljIGludCBndHRfc2V0KHN0cnVjdCBjb250ZXh0ICpj
dHgsIHVuc2lnbmVkIGxvbmcgb2Zmc2V0LCB1MzIgdikKIHsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZt
YTsKIAl1MzIgX19pb21lbSAqbWFwOwogCWludCBlcnIgPSAwOwogCi0JaTkxNV9nZW1fb2JqZWN0
X2xvY2sob2JqKTsKLQllcnIgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2d0dF9kb21haW4ob2Jq
LCB0cnVlKTsKLQlpOTE1X2dlbV9vYmplY3RfdW5sb2NrKG9iaik7CisJaTkxNV9nZW1fb2JqZWN0
X2xvY2soY3R4LT5vYmopOworCWVyciA9IGk5MTVfZ2VtX29iamVjdF9zZXRfdG9fZ3R0X2RvbWFp
bihjdHgtPm9iaiwgdHJ1ZSk7CisJaTkxNV9nZW1fb2JqZWN0X3VubG9jayhjdHgtPm9iaik7CiAJ
aWYgKGVycikKIAkJcmV0dXJuIGVycjsKIAotCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3Bp
bihvYmosIE5VTEwsIDAsIDAsIFBJTl9NQVBQQUJMRSk7CisJdm1hID0gaTkxNV9nZW1fb2JqZWN0
X2dndHRfcGluKGN0eC0+b2JqLCBOVUxMLCAwLCAwLCBQSU5fTUFQUEFCTEUpOwogCWlmIChJU19F
UlIodm1hKSkKIAkJcmV0dXJuIFBUUl9FUlIodm1hKTsKIApAQCAtMTA5LDIxICsxMDgsMTkgQEAg
c3RhdGljIGludCBndHRfc2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJcmV0
dXJuIGVycjsKIH0KIAotc3RhdGljIGludCBndHRfZ2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmosCi0JCSAgIHVuc2lnbmVkIGxvbmcgb2Zmc2V0LAotCQkgICB1MzIgKnYpCitzdGF0
aWMgaW50IGd0dF9nZXQoc3RydWN0IGNvbnRleHQgKmN0eCwgdW5zaWduZWQgbG9uZyBvZmZzZXQs
IHUzMiAqdikKIHsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAl1MzIgX19pb21lbSAqbWFwOwog
CWludCBlcnIgPSAwOwogCi0JaTkxNV9nZW1fb2JqZWN0X2xvY2sob2JqKTsKLQllcnIgPSBpOTE1
X2dlbV9vYmplY3Rfc2V0X3RvX2d0dF9kb21haW4ob2JqLCBmYWxzZSk7Ci0JaTkxNV9nZW1fb2Jq
ZWN0X3VubG9jayhvYmopOworCWk5MTVfZ2VtX29iamVjdF9sb2NrKGN0eC0+b2JqKTsKKwllcnIg
PSBpOTE1X2dlbV9vYmplY3Rfc2V0X3RvX2d0dF9kb21haW4oY3R4LT5vYmosIGZhbHNlKTsKKwlp
OTE1X2dlbV9vYmplY3RfdW5sb2NrKGN0eC0+b2JqKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJy
OwogCi0Jdm1hID0gaTkxNV9nZW1fb2JqZWN0X2dndHRfcGluKG9iaiwgTlVMTCwgMCwgMCwgUElO
X01BUFBBQkxFKTsKKwl2bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0dF9waW4oY3R4LT5vYmosIE5V
TEwsIDAsIDAsIFBJTl9NQVBQQUJMRSk7CiAJaWYgKElTX0VSUih2bWEpKQogCQlyZXR1cm4gUFRS
X0VSUih2bWEpOwogCkBAIC0xNDQsNzMgKzE0MSw2NiBAQCBzdGF0aWMgaW50IGd0dF9nZXQoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlyZXR1cm4gZXJyOwogfQogCi1zdGF0aWMg
aW50IHdjX3NldChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAotCQkgIHVuc2lnbmVk
IGxvbmcgb2Zmc2V0LAotCQkgIHUzMiB2KQorc3RhdGljIGludCB3Y19zZXQoc3RydWN0IGNvbnRl
eHQgKmN0eCwgdW5zaWduZWQgbG9uZyBvZmZzZXQsIHUzMiB2KQogewogCXUzMiAqbWFwOwogCWlu
dCBlcnI7CiAKLQlpOTE1X2dlbV9vYmplY3RfbG9jayhvYmopOwotCWVyciA9IGk5MTVfZ2VtX29i
amVjdF9zZXRfdG9fd2NfZG9tYWluKG9iaiwgdHJ1ZSk7Ci0JaTkxNV9nZW1fb2JqZWN0X3VubG9j
ayhvYmopOworCWk5MTVfZ2VtX29iamVjdF9sb2NrKGN0eC0+b2JqKTsKKwllcnIgPSBpOTE1X2dl
bV9vYmplY3Rfc2V0X3RvX3djX2RvbWFpbihjdHgtPm9iaiwgdHJ1ZSk7CisJaTkxNV9nZW1fb2Jq
ZWN0X3VubG9jayhjdHgtPm9iaik7CiAJaWYgKGVycikKIAkJcmV0dXJuIGVycjsKIAotCW1hcCA9
IGk5MTVfZ2VtX29iamVjdF9waW5fbWFwKG9iaiwgSTkxNV9NQVBfV0MpOworCW1hcCA9IGk5MTVf
Z2VtX29iamVjdF9waW5fbWFwKGN0eC0+b2JqLCBJOTE1X01BUF9XQyk7CiAJaWYgKElTX0VSUiht
YXApKQogCQlyZXR1cm4gUFRSX0VSUihtYXApOwogCiAJbWFwW29mZnNldCAvIHNpemVvZigqbWFw
KV0gPSB2OwotCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAob2JqKTsKKwlpOTE1X2dlbV9vYmpl
Y3RfdW5waW5fbWFwKGN0eC0+b2JqKTsKIAogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IHdj
X2dldChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAotCQkgIHVuc2lnbmVkIGxvbmcg
b2Zmc2V0LAotCQkgIHUzMiAqdikKK3N0YXRpYyBpbnQgd2NfZ2V0KHN0cnVjdCBjb250ZXh0ICpj
dHgsIHVuc2lnbmVkIGxvbmcgb2Zmc2V0LCB1MzIgKnYpCiB7CiAJdTMyICptYXA7CiAJaW50IGVy
cjsKIAotCWk5MTVfZ2VtX29iamVjdF9sb2NrKG9iaik7Ci0JZXJyID0gaTkxNV9nZW1fb2JqZWN0
X3NldF90b193Y19kb21haW4ob2JqLCBmYWxzZSk7Ci0JaTkxNV9nZW1fb2JqZWN0X3VubG9jayhv
YmopOworCWk5MTVfZ2VtX29iamVjdF9sb2NrKGN0eC0+b2JqKTsKKwllcnIgPSBpOTE1X2dlbV9v
YmplY3Rfc2V0X3RvX3djX2RvbWFpbihjdHgtPm9iaiwgZmFsc2UpOworCWk5MTVfZ2VtX29iamVj
dF91bmxvY2soY3R4LT5vYmopOwogCWlmIChlcnIpCiAJCXJldHVybiBlcnI7CiAKLQltYXAgPSBp
OTE1X2dlbV9vYmplY3RfcGluX21hcChvYmosIEk5MTVfTUFQX1dDKTsKKwltYXAgPSBpOTE1X2dl
bV9vYmplY3RfcGluX21hcChjdHgtPm9iaiwgSTkxNV9NQVBfV0MpOwogCWlmIChJU19FUlIobWFw
KSkKIAkJcmV0dXJuIFBUUl9FUlIobWFwKTsKIAogCSp2ID0gbWFwW29mZnNldCAvIHNpemVvZigq
bWFwKV07Ci0JaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChvYmopOworCWk5MTVfZ2VtX29iamVj
dF91bnBpbl9tYXAoY3R4LT5vYmopOwogCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgZ3B1
X3NldChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAotCQkgICB1bnNpZ25lZCBsb25n
IG9mZnNldCwKLQkJICAgdTMyIHYpCitzdGF0aWMgaW50IGdwdV9zZXQoc3RydWN0IGNvbnRleHQg
KmN0eCwgdW5zaWduZWQgbG9uZyBvZmZzZXQsIHUzMiB2KQogewotCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdG9faTkxNShvYmotPmJhc2UuZGV2KTsKIAlzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycTsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAl1MzIgKmNzOwogCWludCBlcnI7CiAK
LQlpOTE1X2dlbV9vYmplY3RfbG9jayhvYmopOwotCWVyciA9IGk5MTVfZ2VtX29iamVjdF9zZXRf
dG9fZ3R0X2RvbWFpbihvYmosIHRydWUpOwotCWk5MTVfZ2VtX29iamVjdF91bmxvY2sob2JqKTsK
KwlpOTE1X2dlbV9vYmplY3RfbG9jayhjdHgtPm9iaik7CisJZXJyID0gaTkxNV9nZW1fb2JqZWN0
X3NldF90b19ndHRfZG9tYWluKGN0eC0+b2JqLCB0cnVlKTsKKwlpOTE1X2dlbV9vYmplY3RfdW5s
b2NrKGN0eC0+b2JqKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwogCi0Jdm1hID0gaTkxNV9n
ZW1fb2JqZWN0X2dndHRfcGluKG9iaiwgTlVMTCwgMCwgMCwgMCk7CisJdm1hID0gaTkxNV9nZW1f
b2JqZWN0X2dndHRfcGluKGN0eC0+b2JqLCBOVUxMLCAwLCAwLCAwKTsKIAlpZiAoSVNfRVJSKHZt
YSkpCiAJCXJldHVybiBQVFJfRVJSKHZtYSk7CiAKLQlycSA9IGk5MTVfcmVxdWVzdF9jcmVhdGUo
aTkxNS0+ZW5naW5lW1JDUzBdLT5rZXJuZWxfY29udGV4dCk7CisJcnEgPSBpOTE1X3JlcXVlc3Rf
Y3JlYXRlKGN0eC0+ZW5naW5lLT5rZXJuZWxfY29udGV4dCk7CiAJaWYgKElTX0VSUihycSkpIHsK
IAkJaTkxNV92bWFfdW5waW4odm1hKTsKIAkJcmV0dXJuIFBUUl9FUlIocnEpOwpAQCAtMjIzLDEy
ICsyMTMsMTIgQEAgc3RhdGljIGludCBncHVfc2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmosCiAJCXJldHVybiBQVFJfRVJSKGNzKTsKIAl9CiAKLQlpZiAoSU5URUxfR0VOKGk5MTUp
ID49IDgpIHsKKwlpZiAoSU5URUxfR0VOKGN0eC0+ZW5naW5lLT5pOTE1KSA+PSA4KSB7CiAJCSpj
cysrID0gTUlfU1RPUkVfRFdPUkRfSU1NX0dFTjQgfCAxIDw8IDIyOwogCQkqY3MrKyA9IGxvd2Vy
XzMyX2JpdHMoaTkxNV9nZ3R0X29mZnNldCh2bWEpICsgb2Zmc2V0KTsKIAkJKmNzKysgPSB1cHBl
cl8zMl9iaXRzKGk5MTVfZ2d0dF9vZmZzZXQodm1hKSArIG9mZnNldCk7CiAJCSpjcysrID0gdjsK
LQl9IGVsc2UgaWYgKElOVEVMX0dFTihpOTE1KSA+PSA0KSB7CisJfSBlbHNlIGlmIChJTlRFTF9H
RU4oY3R4LT5lbmdpbmUtPmk5MTUpID49IDQpIHsKIAkJKmNzKysgPSBNSV9TVE9SRV9EV09SRF9J
TU1fR0VONCB8IE1JX1VTRV9HR1RUOwogCQkqY3MrKyA9IDA7CiAJCSpjcysrID0gaTkxNV9nZ3R0
X29mZnNldCh2bWEpICsgb2Zmc2V0OwpAQCAtMjUzLDMyICsyNDMsMjkgQEAgc3RhdGljIGludCBn
cHVfc2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJcmV0dXJuIGVycjsKIH0K
IAotc3RhdGljIGJvb2wgYWx3YXlzX3ZhbGlkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQorc3RhdGljIGJvb2wgYWx3YXlzX3ZhbGlkKHN0cnVjdCBjb250ZXh0ICpjdHgpCiB7CiAJcmV0
dXJuIHRydWU7CiB9CiAKLXN0YXRpYyBib29sIG5lZWRzX2ZlbmNlX3JlZ2lzdGVycyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3N0YXRpYyBib29sIG5lZWRzX2ZlbmNlX3JlZ2lzdGVy
cyhzdHJ1Y3QgY29udGV4dCAqY3R4KQogewotCXJldHVybiAhaW50ZWxfZ3RfaXNfd2VkZ2VkKCZp
OTE1LT5ndCk7CisJcmV0dXJuICFpbnRlbF9ndF9pc193ZWRnZWQoY3R4LT5lbmdpbmUtPmd0KTsK
IH0KIAotc3RhdGljIGJvb2wgbmVlZHNfbWlfc3RvcmVfZHdvcmQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpCitzdGF0aWMgYm9vbCBuZWVkc19taV9zdG9yZV9kd29yZChzdHJ1Y3QgY29u
dGV4dCAqY3R4KQogewotCWlmIChpbnRlbF9ndF9pc193ZWRnZWQoJmk5MTUtPmd0KSkKLQkJcmV0
dXJuIGZhbHNlOwotCi0JaWYgKCFIQVNfRU5HSU5FKGk5MTUsIFJDUzApKQorCWlmIChpbnRlbF9n
dF9pc193ZWRnZWQoY3R4LT5lbmdpbmUtPmd0KSkKIAkJcmV0dXJuIGZhbHNlOwogCi0JcmV0dXJu
IGludGVsX2VuZ2luZV9jYW5fc3RvcmVfZHdvcmQoaTkxNS0+ZW5naW5lW1JDUzBdKTsKKwlyZXR1
cm4gaW50ZWxfZW5naW5lX2Nhbl9zdG9yZV9kd29yZChjdHgtPmVuZ2luZSk7CiB9CiAKIHN0YXRp
YyBjb25zdCBzdHJ1Y3QgaWd0X2NvaGVyZW5jeV9tb2RlIHsKIAljb25zdCBjaGFyICpuYW1lOwot
CWludCAoKnNldCkoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKiwgdW5zaWduZWQgbG9uZyBv
ZmZzZXQsIHUzMiB2KTsKLQlpbnQgKCpnZXQpKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICos
IHVuc2lnbmVkIGxvbmcgb2Zmc2V0LCB1MzIgKnYpOwotCWJvb2wgKCp2YWxpZCkoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUpOworCWludCAoKnNldCkoc3RydWN0IGNvbnRleHQgKmN0eCwg
dW5zaWduZWQgbG9uZyBvZmZzZXQsIHUzMiB2KTsKKwlpbnQgKCpnZXQpKHN0cnVjdCBjb250ZXh0
ICpjdHgsIHVuc2lnbmVkIGxvbmcgb2Zmc2V0LCB1MzIgKnYpOworCWJvb2wgKCp2YWxpZCkoc3Ry
dWN0IGNvbnRleHQgKmN0eCk7CiB9IGlndF9jb2hlcmVuY3lfbW9kZVtdID0gewogCXsgImNwdSIs
IGNwdV9zZXQsIGNwdV9nZXQsIGFsd2F5c192YWxpZCB9LAogCXsgImd0dCIsIGd0dF9zZXQsIGd0
dF9nZXQsIG5lZWRzX2ZlbmNlX3JlZ2lzdGVycyB9LApAQCAtMjg3LDE4ICsyNzQsMzcgQEAgc3Rh
dGljIGNvbnN0IHN0cnVjdCBpZ3RfY29oZXJlbmN5X21vZGUgewogCXsgfSwKIH07CiAKK3N0YXRp
YyBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICoKK3JhbmRvbV9lbmdpbmUoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUsIHN0cnVjdCBybmRfc3RhdGUgKnBybmcpCit7CisJc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lOworCXVuc2lnbmVkIGludCBjb3VudDsKKworCWNvdW50ID0gMDsK
Kwlmb3JfZWFjaF91YWJpX2VuZ2luZShlbmdpbmUsIGk5MTUpCisJCWNvdW50Kys7CisKKwljb3Vu
dCA9IGk5MTVfcHJhbmRvbV91MzJfbWF4X3N0YXRlKGNvdW50LCBwcm5nKTsKKwlmb3JfZWFjaF91
YWJpX2VuZ2luZShlbmdpbmUsIGk5MTUpCisJCWlmIChjb3VudC0tID09IDApCisJCQlyZXR1cm4g
ZW5naW5lOworCisJcmV0dXJuIE5VTEw7Cit9CisKIHN0YXRpYyBpbnQgaWd0X2dlbV9jb2hlcmVu
Y3kodm9pZCAqYXJnKQogewogCWNvbnN0IHVuc2lnbmVkIGludCBuY2FjaGVsaW5lcyA9IFBBR0Vf
U0laRS82NDsKLQlJOTE1X1JORF9TVEFURShwcm5nKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9IGFyZzsKIAljb25zdCBzdHJ1Y3QgaWd0X2NvaGVyZW5jeV9tb2RlICpyZWFkLCAq
d3JpdGUsICpvdmVyOwotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJdW5zaWdu
ZWQgbG9uZyBjb3VudCwgbjsKIAl1MzIgKm9mZnNldHMsICp2YWx1ZXM7CisJSTkxNV9STkRfU1RB
VEUocHJuZyk7CisJc3RydWN0IGNvbnRleHQgY3R4OwogCWludCBlcnIgPSAwOwogCi0JLyogV2Ug
cmVwZWF0ZWRseSB3cml0ZSwgb3ZlcndyaXRlIGFuZCByZWFkIGZyb20gYSBzZXF1ZW5jZSBvZgor
CS8qCisJICogV2UgcmVwZWF0ZWRseSB3cml0ZSwgb3ZlcndyaXRlIGFuZCByZWFkIGZyb20gYSBz
ZXF1ZW5jZSBvZgogCSAqIGNhY2hlbGluZXMgaW4gb3JkZXIgdG8gdHJ5IGFuZCBkZXRlY3QgaW5j
b2hlcmVuY3kgKHVuZmx1c2hlZCB3cml0ZXMKIAkgKiBmcm9tIGVpdGhlciB0aGUgQ1BVIG9yIEdQ
VSkuIEVhY2ggc2V0dGVyL2dldHRlciB1c2VzIG91ciBjYWNoZQogCSAqIGRvbWFpbiBBUEkgd2hp
Y2ggc2hvdWxkIHByZXZlbnQgaW5jb2hlcmVuY3kuCkBAIC0zMTIsMzEgKzMxOCwzNSBAQCBzdGF0
aWMgaW50IGlndF9nZW1fY29oZXJlbmN5KHZvaWQgKmFyZykKIAogCXZhbHVlcyA9IG9mZnNldHMg
KyBuY2FjaGVsaW5lczsKIAorCWN0eC5lbmdpbmUgPSByYW5kb21fZW5naW5lKGk5MTUsICZwcm5n
KTsKKwlHRU1fQlVHX09OKCFjdHguZW5naW5lKTsKKwlwcl9pbmZvKCIlczogdXNpbmcgJXNcbiIs
IF9fZnVuY19fLCBjdHguZW5naW5lLT5uYW1lKTsKKwogCWZvciAob3ZlciA9IGlndF9jb2hlcmVu
Y3lfbW9kZTsgb3Zlci0+bmFtZTsgb3ZlcisrKSB7CiAJCWlmICghb3Zlci0+c2V0KQogCQkJY29u
dGludWU7CiAKLQkJaWYgKCFvdmVyLT52YWxpZChpOTE1KSkKKwkJaWYgKCFvdmVyLT52YWxpZCgm
Y3R4KSkKIAkJCWNvbnRpbnVlOwogCiAJCWZvciAod3JpdGUgPSBpZ3RfY29oZXJlbmN5X21vZGU7
IHdyaXRlLT5uYW1lOyB3cml0ZSsrKSB7CiAJCQlpZiAoIXdyaXRlLT5zZXQpCiAJCQkJY29udGlu
dWU7CiAKLQkJCWlmICghd3JpdGUtPnZhbGlkKGk5MTUpKQorCQkJaWYgKCF3cml0ZS0+dmFsaWQo
JmN0eCkpCiAJCQkJY29udGludWU7CiAKIAkJCWZvciAocmVhZCA9IGlndF9jb2hlcmVuY3lfbW9k
ZTsgcmVhZC0+bmFtZTsgcmVhZCsrKSB7CiAJCQkJaWYgKCFyZWFkLT5nZXQpCiAJCQkJCWNvbnRp
bnVlOwogCi0JCQkJaWYgKCFyZWFkLT52YWxpZChpOTE1KSkKKwkJCQlpZiAoIXJlYWQtPnZhbGlk
KCZjdHgpKQogCQkJCQljb250aW51ZTsKIAogCQkJCWZvcl9lYWNoX3ByaW1lX251bWJlcl9mcm9t
KGNvdW50LCAxLCBuY2FjaGVsaW5lcykgewotCQkJCQlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3Jl
YXRlX2ludGVybmFsKGk5MTUsIFBBR0VfU0laRSk7Ci0JCQkJCWlmIChJU19FUlIob2JqKSkgewot
CQkJCQkJZXJyID0gUFRSX0VSUihvYmopOworCQkJCQljdHgub2JqID0gaTkxNV9nZW1fb2JqZWN0
X2NyZWF0ZV9pbnRlcm5hbChpOTE1LCBQQUdFX1NJWkUpOworCQkJCQlpZiAoSVNfRVJSKGN0eC5v
YmopKSB7CisJCQkJCQllcnIgPSBQVFJfRVJSKGN0eC5vYmopOwogCQkJCQkJZ290byBmcmVlOwog
CQkJCQl9CiAKQEAgLTM0NSw3ICszNTUsNyBAQCBzdGF0aWMgaW50IGlndF9nZW1fY29oZXJlbmN5
KHZvaWQgKmFyZykKIAkJCQkJCXZhbHVlc1tuXSA9IHByYW5kb21fdTMyX3N0YXRlKCZwcm5nKTsK
IAogCQkJCQlmb3IgKG4gPSAwOyBuIDwgY291bnQ7IG4rKykgewotCQkJCQkJZXJyID0gb3Zlci0+
c2V0KG9iaiwgb2Zmc2V0c1tuXSwgfnZhbHVlc1tuXSk7CisJCQkJCQllcnIgPSBvdmVyLT5zZXQo
JmN0eCwgb2Zmc2V0c1tuXSwgfnZhbHVlc1tuXSk7CiAJCQkJCQlpZiAoZXJyKSB7CiAJCQkJCQkJ
cHJfZXJyKCJGYWlsZWQgdG8gc2V0IHN0YWxlIHZhbHVlWyVsZC8lbGRdIGluIG9iamVjdCB1c2lu
ZyAlcywgZXJyPSVkXG4iLAogCQkJCQkJCSAgICAgICBuLCBjb3VudCwgb3Zlci0+bmFtZSwgZXJy
KTsKQEAgLTM1NCw3ICszNjQsNyBAQCBzdGF0aWMgaW50IGlndF9nZW1fY29oZXJlbmN5KHZvaWQg
KmFyZykKIAkJCQkJfQogCiAJCQkJCWZvciAobiA9IDA7IG4gPCBjb3VudDsgbisrKSB7Ci0JCQkJ
CQllcnIgPSB3cml0ZS0+c2V0KG9iaiwgb2Zmc2V0c1tuXSwgdmFsdWVzW25dKTsKKwkJCQkJCWVy
ciA9IHdyaXRlLT5zZXQoJmN0eCwgb2Zmc2V0c1tuXSwgdmFsdWVzW25dKTsKIAkJCQkJCWlmIChl
cnIpIHsKIAkJCQkJCQlwcl9lcnIoIkZhaWxlZCB0byBzZXQgdmFsdWVbJWxkLyVsZF0gaW4gb2Jq
ZWN0IHVzaW5nICVzLCBlcnI9JWRcbiIsCiAJCQkJCQkJICAgICAgIG4sIGNvdW50LCB3cml0ZS0+
bmFtZSwgZXJyKTsKQEAgLTM2NSw3ICszNzUsNyBAQCBzdGF0aWMgaW50IGlndF9nZW1fY29oZXJl
bmN5KHZvaWQgKmFyZykKIAkJCQkJZm9yIChuID0gMDsgbiA8IGNvdW50OyBuKyspIHsKIAkJCQkJ
CXUzMiBmb3VuZDsKIAotCQkJCQkJZXJyID0gcmVhZC0+Z2V0KG9iaiwgb2Zmc2V0c1tuXSwgJmZv
dW5kKTsKKwkJCQkJCWVyciA9IHJlYWQtPmdldCgmY3R4LCBvZmZzZXRzW25dLCAmZm91bmQpOwog
CQkJCQkJaWYgKGVycikgewogCQkJCQkJCXByX2VycigiRmFpbGVkIHRvIGdldCB2YWx1ZVslbGQv
JWxkXSBpbiBvYmplY3QgdXNpbmcgJXMsIGVycj0lZFxuIiwKIAkJCQkJCQkgICAgICAgbiwgY291
bnQsIHJlYWQtPm5hbWUsIGVycik7CkBAIC0zODMsNyArMzkzLDcgQEAgc3RhdGljIGludCBpZ3Rf
Z2VtX2NvaGVyZW5jeSh2b2lkICphcmcpCiAJCQkJCQl9CiAJCQkJCX0KIAotCQkJCQlpOTE1X2dl
bV9vYmplY3RfcHV0KG9iaik7CisJCQkJCWk5MTVfZ2VtX29iamVjdF9wdXQoY3R4Lm9iaik7CiAJ
CQkJfQogCQkJfQogCQl9CkBAIC0zOTMsNyArNDAzLDcgQEAgc3RhdGljIGludCBpZ3RfZ2VtX2Nv
aGVyZW5jeSh2b2lkICphcmcpCiAJcmV0dXJuIGVycjsKIAogcHV0X29iamVjdDoKLQlpOTE1X2dl
bV9vYmplY3RfcHV0KG9iaik7CisJaTkxNV9nZW1fb2JqZWN0X3B1dChjdHgub2JqKTsKIAlnb3Rv
IGZyZWU7CiB9CiAKLS0gCjIuMjQuMC5yYzEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3Rz
LmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xp
c3RpbmZvL2ludGVsLWdmeA==

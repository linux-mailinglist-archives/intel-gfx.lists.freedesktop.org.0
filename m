Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 2FE5BFD7D1
	for <lists+intel-gfx@lfdr.de>; Fri, 15 Nov 2019 09:19:31 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 23E7D6E0EF;
	Fri, 15 Nov 2019 08:19:29 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 64C7D6E0EF
 for <intel-gfx@lists.freedesktop.org>; Fri, 15 Nov 2019 08:19:27 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19207888-1500050 
 for multiple; Fri, 15 Nov 2019 08:19:00 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 15 Nov 2019 08:18:57 +0000
Message-Id: <20191115081857.683827-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/gt: Track engine round-trip times
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

S25vd2luZyB0aGUgcm91bmQgdHJpcCB0aW1lIG9mIGFuIGVuZ2luZSBpcyB1c2VmdWwgZm9yIHRy
YWNraW5nIHRoZQpoZWFsdGggb2YgdGhlIHN5c3RlbSBhcyB3ZWxsIGFzIHByb3ZpZGluZyBhIG1l
dHJpYyBmb3IgdGhlIGJhc2VsaW5lCnJlc3BvbnNpdmVuZXNzIG9mIHRoZSBlbmdpbmUuIFdlIGNh
biB1c2UgdGhlIGxhdHRlciBtZXRyaWMgZm9yCmF1dG9tYXRpY2FsbHkgdHVuaW5nIG91ciB3YWl0
cyBpbiBzZWxmdGVzdHMgYW5kIHdoZW4gaWRsaW5nIHNvIHdlIGRvbid0CmNvbmZ1c2UgYSBzbG93
ZXIgc3lzdGVtIHdpdGggYSBkZWFkIG9uZS4KClVwb24gaWRsaW5nIHRoZSBlbmdpbmUsIHdlIHNl
bmQgb25lIGxhc3QgcHVsc2UgdG8gc3dpdGNoIHRoZSBjb250ZXh0CmF3YXkgZnJvbSBwcmVjaW91
cyB1c2VyIHN0YXRlIHRvIHRoZSB2b2xhdGlsZSBrZXJuZWwgY29udGV4dC4gV2Uga25vdwp0aGUg
ZW5naW5lIGlzIGlkbGUgYXQgdGhpcyBwb2ludCwgYW5kIHRoZSBwdWxzZSBpcyBub24tcHJlZW1w
dGFibGUsIHNvCnRoaXMgcHJvdmlkZXMgdXMgd2l0aCBhIGdvb2QgbWVhc3VyZW1lbnQgb2YgdGhl
IHJvdW5kIHRyaXAgdGltZS4gQQpzZWNvbmRhcnkgZWZmZWN0IGlzIHRoYXQgYnkgaW5zdGFsbGlu
ZyBhbiBpbnRlcnJ1cHQgb250byB0aGUgcHVsc2UsIHdlCmNhbiBmbHVzaCB0aGUgZW5naW5lIGlt
bWVkaWF0ZWx5IHVwb24gY29tcGxldGlvbiwgY3VydGFpbGluZyB0aGUKYmFja2dyb3VuZCBmbHVz
aCBhbmQgZW50ZXJpbmcgcG93ZXJzYXZpbmcgaW1tZWRpYXRlbHkuCgpSZWZlcmVuY2VzOiA3ZTM0
ZjRlNGFhZDMgKCJkcm0vaTkxNS9nZW44KzogQWRkIFJDNiBDVFggY29ycnVwdGlvbiBXQSIpClNp
Z25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzog
VHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KQ2M6IFN0dWFydCBTdW1t
ZXJzIDxzdHVhcnQuc3VtbWVyc0BpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3QvaW50ZWxfZW5naW5lX2NzLmMgICAgfCAgMiArKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfZW5naW5lX3BtLmMgICAgfCAzNCArKysrKysrKysrKysrKysrKysrLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmggfCAgNiArKysrCiAzIGZpbGVzIGNo
YW5nZWQsIDQxIGluc2VydGlvbnMoKyksIDEgZGVsZXRpb24oLSkKCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2VuZ2luZV9jcy5jCmluZGV4IGI5NjEzZDA0NDM5My4uMmQxMWRiMTNkYzg5
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfY3MuYwpAQCAtMzM0LDYg
KzMzNCw3IEBAIHN0YXRpYyBpbnQgaW50ZWxfZW5naW5lX3NldHVwKHN0cnVjdCBpbnRlbF9ndCAq
Z3QsIGVudW0gaW50ZWxfZW5naW5lX2lkIGlkKQogCS8qIE5vdGhpbmcgdG8gZG8gaGVyZSwgZXhl
Y3V0ZSBpbiBvcmRlciBvZiBkZXBlbmRlbmNpZXMgKi8KIAllbmdpbmUtPnNjaGVkdWxlID0gTlVM
TDsKIAorCWV3bWFfZGVsYXlfaW5pdCgmZW5naW5lLT5kZWxheSk7CiAJc2VxbG9ja19pbml0KCZl
bmdpbmUtPnN0YXRzLmxvY2spOwogCiAJQVRPTUlDX0lOSVRfTk9USUZJRVJfSEVBRCgmZW5naW5l
LT5jb250ZXh0X3N0YXR1c19ub3RpZmllcik7CkBAIC0xNDc3LDYgKzE0NzgsNyBAQCB2b2lkIGlu
dGVsX2VuZ2luZV9kdW1wKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAkJZHJtX3By
aW50ZihtLCAiKioqIFdFREdFRCAqKipcbiIpOwogCiAJZHJtX3ByaW50ZihtLCAiXHRBd2FrZT8g
JWRcbiIsIGF0b21pY19yZWFkKCZlbmdpbmUtPndha2VyZWYuY291bnQpKTsKKwlkcm1fcHJpbnRm
KG0sICJcdERlbGF5OiAlbHV1c1xuIiwgZXdtYV9kZWxheV9yZWFkKCZlbmdpbmUtPmRlbGF5KSk7
CiAKIAlyY3VfcmVhZF9sb2NrKCk7CiAJcnEgPSBSRUFEX09OQ0UoZW5naW5lLT5oZWFydGJlYXQu
c3lzdG9sZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdp
bmVfcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5jCmluZGV4
IDNjMGY0OTBmZjJjNy4uYTJlZDYwNTZjMmIxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9lbmdpbmVfcG0uYwpAQCAtNzMsNiArNzMsMjMgQEAgc3RhdGljIGlubGluZSB2b2lkIF9f
dGltZWxpbmVfbWFya191bmxvY2soc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCiAjZW5kaWYg
LyogIUlTX0VOQUJMRUQoQ09ORklHX0xPQ0tERVApICovCiAKK3N0cnVjdCBkdXJhdGlvbl9jYiB7
CisJc3RydWN0IGRtYV9mZW5jZV9jYiBjYjsKKwlrdGltZV90IGVtaXR0ZWQ7Cit9OworCitzdGF0
aWMgdm9pZCBkdXJhdGlvbl9jYihzdHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSwgc3RydWN0IGRtYV9m
ZW5jZV9jYiAqY2IpCit7CisJc3RydWN0IGR1cmF0aW9uX2NiICpkY2IgPSBjb250YWluZXJfb2Yo
Y2IsIHR5cGVvZigqZGNiKSwgY2IpOworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSA9
IHRvX3JlcXVlc3QoZmVuY2UpLT5lbmdpbmU7CisKKwlld21hX2RlbGF5X2FkZCgmZW5naW5lLT5k
ZWxheSwKKwkJICAgICAgIGt0aW1lX3VzX2RlbHRhKGt0aW1lX2dldCgpLCBkY2ItPmVtaXR0ZWQp
KTsKKworCS8qIEtpY2sgcmV0aXJlIGZvciBxdWlja2VyIHBvd2Vyc2F2aW5nIChzb2Z0LXJjNiku
ICovCisJZmx1c2hfZGVsYXllZF93b3JrKCZlbmdpbmUtPmd0LT5yZXF1ZXN0cy5yZXRpcmVfd29y
ayk7Cit9CisKIHN0YXRpYyBib29sIHN3aXRjaF90b19rZXJuZWxfY29udGV4dChzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmUpCiB7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CkBAIC0x
MTQsNyArMTMxLDIyIEBAIHN0YXRpYyBib29sIHN3aXRjaF90b19rZXJuZWxfY29udGV4dChzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAKIAkvKiBJbnN0YWxsIG91cnNlbHZlcyBhcyBh
IHByZWVtcHRpb24gYmFycmllciAqLwogCXJxLT5zY2hlZC5hdHRyLnByaW9yaXR5ID0gSTkxNV9Q
UklPUklUWV9CQVJSSUVSOwotCV9faTkxNV9yZXF1ZXN0X2NvbW1pdChycSk7CisJaWYgKGxpa2Vs
eSghX19pOTE1X3JlcXVlc3RfY29tbWl0KHJxKSkpIHsgLyogZW5naW5lIHNob3VsZCBiZSBpZGxl
ISAqLworCQlzdHJ1Y3QgZHVyYXRpb25fY2IgKmRjYjsKKworCQlCVUlMRF9CVUdfT04oc2l6ZW9m
KCpkY2IpID4gc2l6ZW9mKHJxLT5zdWJtaXRxKSk7CisJCWRjYiA9IChzdHJ1Y3QgZHVyYXRpb25f
Y2IgKikmcnEtPnN1Ym1pdHE7CisKKwkJLyoKKwkJICogVXNlIGFuIGludGVycnVwdCBmb3IgcHJl
Y2lzZSBtZWFzdXJlbWVudCBvZiBkdXJhdGlvbiwKKwkJICogb3RoZXJ3aXNlIHdlIHJlbHkgb24g
c29tZW9uZSBlbHNlIHJldGlyaW5nIGFsbCB0aGUgcmVxdWVzdHMKKwkJICogd2hpY2ggbWF5IGRl
bGF5IHRoZSBzaWduYWxpbmcgKGkuZS4gd2Ugd2lsbCBsaWtlbHkgd2FpdAorCQkgKiB1bnRpbCB0
aGUgYmFja2dyb3VuZCByZXF1ZXN0IHJldGlyZW1lbnQgcnVubmluZyBldmVyeQorCQkgKiBzZWNv
bmQgb3IgdHdvKS4KKwkJICovCisJCWRtYV9mZW5jZV9hZGRfY2FsbGJhY2soJnJxLT5mZW5jZSwg
JmRjYi0+Y2IsIGR1cmF0aW9uX2NiKTsKKwkJZGNiLT5lbWl0dGVkID0ga3RpbWVfZ2V0KCk7CisJ
fQogCiAJLyogUmVsZWFzZSBvdXIgZXhjbHVzaXZlIGhvbGQgb24gdGhlIGVuZ2luZSAqLwogCV9f
aW50ZWxfd2FrZXJlZl9kZWZlcl9wYXJrKCZlbmdpbmUtPndha2VyZWYpOwpkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmggYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfdHlwZXMuaAppbmRleCA3NThmMGU4ZWM2NzIuLmM2
YTYwN2Q5Y2Y2YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5n
aW5lX3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5
cGVzLmgKQEAgLTcsNiArNyw3IEBACiAjaWZuZGVmIF9fSU5URUxfRU5HSU5FX1RZUEVTX18KICNk
ZWZpbmUgX19JTlRFTF9FTkdJTkVfVFlQRVNfXwogCisjaW5jbHVkZSA8bGludXgvYXZlcmFnZS5o
PgogI2luY2x1ZGUgPGxpbnV4L2hhc2h0YWJsZS5oPgogI2luY2x1ZGUgPGxpbnV4L2lycV93b3Jr
Lmg+CiAjaW5jbHVkZSA8bGludXgva3JlZi5oPgpAQCAtMTE5LDYgKzEyMCw5IEBAIGVudW0gaW50
ZWxfZW5naW5lX2lkIHsKICNkZWZpbmUgSU5WQUxJRF9FTkdJTkUgKChlbnVtIGludGVsX2VuZ2lu
ZV9pZCktMSkKIH07CiAKKy8qIEEgc2ltcGxlIGVzdGltYXRvciBmb3IgdGhlIHJvdW5kLXRyaXAg
cmVzcG9uc2l2ZSB0aW1lIG9mIGFuIGVuZ2luZSAqLworREVDTEFSRV9FV01BKGRlbGF5LCA2LCA0
KQorCiBzdHJ1Y3Qgc3RfcHJlZW1wdF9oYW5nIHsKIAlzdHJ1Y3QgY29tcGxldGlvbiBjb21wbGV0
aW9uOwogCXVuc2lnbmVkIGludCBjb3VudDsKQEAgLTMxNiw2ICszMjAsOCBAQCBzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzIHsKIAkJc3RydWN0IGludGVsX3RpbWVsaW5lICp0aW1lbGluZTsKIAl9IGxl
Z2FjeTsKIAorCXN0cnVjdCBld21hX2RlbGF5IGRlbGF5OworCiAJLyogUmF0aGVyIHRoYW4gaGF2
ZSBldmVyeSBjbGllbnQgd2FpdCB1cG9uIGFsbCB1c2VyIGludGVycnVwdHMsCiAJICogd2l0aCB0
aGUgaGVyZCB3YWtpbmcgYWZ0ZXIgZXZlcnkgaW50ZXJydXB0IGFuZCBlYWNoIGRvaW5nIHRoZQog
CSAqIGhlYXZ5d2VpZ2h0IHNlcW5vIGRhbmNlLCB3ZSBkZWxlZ2F0ZSB0aGUgdGFzayAob2YgYmVp
bmcgdGhlCi0tIAoyLjI0LjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2lu
dGVsLWdmeA==

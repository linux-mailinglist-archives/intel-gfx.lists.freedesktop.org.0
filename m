Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 4B5F0B6FE9
	for <lists+intel-gfx@lfdr.de>; Thu, 19 Sep 2019 02:07:49 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C4F148BD5C;
	Thu, 19 Sep 2019 00:07:40 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga09.intel.com (mga09.intel.com [134.134.136.24])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 1856A7B71A
 for <intel-gfx@lists.freedesktop.org>; Thu, 19 Sep 2019 00:07:34 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga003.jf.intel.com ([10.7.209.27])
 by orsmga102.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 18 Sep 2019 17:07:32 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,522,1559545200"; d="scan'208";a="189426754"
Received: from josouza-mobl.jf.intel.com (HELO josouza-MOBL.intel.com)
 ([10.24.9.135])
 by orsmga003.jf.intel.com with ESMTP; 18 Sep 2019 17:07:32 -0700
From: =?UTF-8?q?Jos=C3=A9=20Roberto=20de=20Souza?= <jose.souza@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 18 Sep 2019 17:07:21 -0700
Message-Id: <20190919000726.267988-9-jose.souza@intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190919000726.267988-1-jose.souza@intel.com>
References: <20190919000726.267988-1-jose.souza@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2 08/13] drm/i915/tgl: Add dkl phy programming
 sequences
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogQ2xpbnRvbiBBIFRheWxvciA8Y2xpbnRvbi5hLnRheWxvckBpbnRlbC5jb20+CgpBZGRl
ZCBES0wgUGh5IHNlcXVlbmNlcyBhbmQgaGVscGVycyBmdW5jdGlvbnMgdG8gcHJvZ3JhbSB2b2x0
YWdlCnN3aW5nLCBjbG9jayBnYXRpbmcgYW5kIGRwIG1vZGUuCgpJdCBpcyBub3Qgd3JpdHRlbiBp
biBEUCBlbmFibGluZyBzZXF1ZW5jZSBidXQgIlBIWSBDbG9ja2dhdGluZwpwcm9ncmFtbWluZyIg
c3RhdGVzIHRoYXQgY2xvY2sgZ2F0aW5nIHNob3VsZCBiZSBlbmFibGVkIGFmdGVyIHRoZQpsaW5r
IHRyYWluaW5nIGJ1dCBkb2luZyBzbyBjYXVzZXMgYWxsIHRoZSBmb2xsb3dpbmcgdHJhaW5pbmdz
IHRvIGZhaWwKc28gbm90IGVuYWJsaW5nIGl0IGZvci4KCnYyOgpTZXR0aW5nIHRoZSByaWdodCBI
SVBfSU5ERVhfUkVHIGJpdHMgKEpvc8OpKQoKQlNwZWM6IDQ5MjkyCkJTcGVjOiA0OTE5MAoKU2ln
bmVkLW9mZi1ieTogSm9zw6kgUm9iZXJ0byBkZSBTb3V6YSA8am9zZS5zb3V6YUBpbnRlbC5jb20+
ClNpZ25lZC1vZmYtYnk6IENsaW50b24gQSBUYXlsb3IgPGNsaW50b24uYS50YXlsb3JAaW50ZWwu
Y29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMgfCAyNDYg
KysrKysrKysrKysrKysrKysrKysrLS0KIDEgZmlsZSBjaGFuZ2VkLCAyMzQgaW5zZXJ0aW9ucygr
KSwgMTIgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9kZGkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRp
LmMKaW5kZXggODE3OTJhMDRlMGFhLi5mZDI3MTExOGQxZjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kZGkuYwpAQCAtNTg2LDYgKzU4NiwyNSBAQCBzdGF0aWMgY29uc3Qg
c3RydWN0IGljbF9tZ19waHlfZGRpX2J1Zl90cmFucyBpY2xfbWdfcGh5X2RkaV90cmFuc2xhdGlv
bnNbXSA9IHsKIAl7IDB4MCwgMHgwMCwgMHgwMCB9LAkvKiAzICAgICAgICAgICAgICAwICAgKi8K
IH07CiAKK3N0cnVjdCB0Z2xfZGtsX3BoeV9kZGlfYnVmX3RyYW5zIHsKKwl1MzIgZGtsX3Zzd2lu
Z19jb250cm9sOworCXUzMiBka2xfcHJlc2hvb3RfY29udHJvbDsKKwl1MzIgZGtsX2RlX2VtcGhh
c2lzX2NvbnRyb2w7Cit9OworCitzdGF0aWMgY29uc3Qgc3RydWN0IHRnbF9ka2xfcGh5X2RkaV9i
dWZfdHJhbnMgdGdsX2RrbF9waHlfZGRpX3RyYW5zbGF0aW9uc1tdID0geworCXsgMHg3LCAweDAs
IDB4MDAgfSwJLyogMCAgICAgMCAgIDQwMG1WICAwIGRCICAgKi8KKwl7IDB4NSwgMHgwLCAweDAz
IH0sCS8qIDAgICAgIDEgICA0MDBtViAgMy41IGRCICovCisJeyAweDIsIDB4MCwgMHgwYiB9LAkv
KiAwICAgICAyICAgNDAwbVYgIDYgZEIgICAqLworCXsgMHgwLCAweDAsIDB4MTkgfSwJLyogMCAg
ICAgMyAgIDQwMG1WICA5LjUgZEIgKi8KKwl7IDB4NSwgMHgwLCAweDAwIH0sCS8qIDEgICAgIDAg
ICA2MDBtViAgMCBkQiAgICovCisJeyAweDIsIDB4MCwgMHgwMyB9LAkvKiAxICAgICAxICAgNjAw
bVYgIDMuNSBkQiAqLworCXsgMHgwLCAweDAsIDB4MTQgfSwJLyogMSAgICAgMiAgIDYwMG1WICA2
IGRCICAgKi8KKwl7IDB4MiwgMHgwLCAweDAwIH0sCS8qIDIgICAgIDAgICA4MDBtViAgMCBkQiAg
ICovCisJeyAweDAsIDB4MCwgMHgwQiB9LAkvKiAyICAgICAxICAgODAwbVYgIDMuNSBkQiAqLwor
CXsgMHgwLCAweDAsIDB4MDAgfSwJLyogMyAgICAgMCAgMTIwMG1WICAwIGRCICAgIEhETUkgRGVm
YXVsdCAqLworfTsKKwogc3RhdGljIGNvbnN0IHN0cnVjdCBkZGlfYnVmX3RyYW5zICoKIGJkd19n
ZXRfYnVmX3RyYW5zX2VkcChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGludCAq
bl9lbnRyaWVzKQogewpAQCAtODczLDExICs4OTIsMTUgQEAgc3RhdGljIGludCBpbnRlbF9kZGlf
aGRtaV9sZXZlbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGVudW0gcG9ydCBw
b3IKIAlsZXZlbCA9IGRldl9wcml2LT52YnQuZGRpX3BvcnRfaW5mb1twb3J0XS5oZG1pX2xldmVs
X3NoaWZ0OwogCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpIHsKLQkJaWYgKGludGVs
X3BoeV9pc19jb21ibyhkZXZfcHJpdiwgcGh5KSkKKwkJaWYgKGludGVsX3BoeV9pc19jb21ibyhk
ZXZfcHJpdiwgcGh5KSkgewogCQkJaWNsX2dldF9jb21ib19idWZfdHJhbnMoZGV2X3ByaXYsIElO
VEVMX09VVFBVVF9IRE1JLAogCQkJCQkJMCwgJm5fZW50cmllcyk7Ci0JCWVsc2UKLQkJCW5fZW50
cmllcyA9IEFSUkFZX1NJWkUoaWNsX21nX3BoeV9kZGlfdHJhbnNsYXRpb25zKTsKKwkJfSBlbHNl
IHsKKwkJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKQorCQkJCW5fZW50cmllcyA9IEFS
UkFZX1NJWkUodGdsX2RrbF9waHlfZGRpX3RyYW5zbGF0aW9ucyk7CisJCQllbHNlCisJCQkJbl9l
bnRyaWVzID0gQVJSQVlfU0laRShpY2xfbWdfcGh5X2RkaV90cmFuc2xhdGlvbnMpOworCQl9CiAJ
CWRlZmF1bHRfZW50cnkgPSBuX2VudHJpZXMgLSAxOwogCX0gZWxzZSBpZiAoSVNfQ0FOTk9OTEFL
RShkZXZfcHJpdikpIHsKIAkJY25sX2dldF9idWZfdHJhbnNfaGRtaShkZXZfcHJpdiwgJm5fZW50
cmllcyk7CkBAIC0yMzA4LDExICsyMzMxLDE1IEBAIHU4IGludGVsX2RkaV9kcF92b2x0YWdlX21h
eChzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikKIAlpbnQgbl9lbnRyaWVzOwogCiAJaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpIHsKLQkJaWYgKGludGVsX3BoeV9pc19jb21ibyhk
ZXZfcHJpdiwgcGh5KSkKKwkJaWYgKGludGVsX3BoeV9pc19jb21ibyhkZXZfcHJpdiwgcGh5KSkg
ewogCQkJaWNsX2dldF9jb21ib19idWZfdHJhbnMoZGV2X3ByaXYsIGVuY29kZXItPnR5cGUsCiAJ
CQkJCQlpbnRlbF9kcC0+bGlua19yYXRlLCAmbl9lbnRyaWVzKTsKLQkJZWxzZQotCQkJbl9lbnRy
aWVzID0gQVJSQVlfU0laRShpY2xfbWdfcGh5X2RkaV90cmFuc2xhdGlvbnMpOworCQl9IGVsc2Ug
eworCQkJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpCisJCQkJbl9lbnRyaWVzID0gQVJS
QVlfU0laRSh0Z2xfZGtsX3BoeV9kZGlfdHJhbnNsYXRpb25zKTsKKwkJCWVsc2UKKwkJCQluX2Vu
dHJpZXMgPSBBUlJBWV9TSVpFKGljbF9tZ19waHlfZGRpX3RyYW5zbGF0aW9ucyk7CisJCX0KIAl9
IGVsc2UgaWYgKElTX0NBTk5PTkxBS0UoZGV2X3ByaXYpKSB7CiAJCWlmIChlbmNvZGVyLT50eXBl
ID09IElOVEVMX09VVFBVVF9FRFApCiAJCQljbmxfZ2V0X2J1Zl90cmFuc19lZHAoZGV2X3ByaXYs
ICZuX2VudHJpZXMpOwpAQCAtMjc0OSw2ICsyNzc2LDY2IEBAIHN0YXRpYyB2b2lkIGljbF9kZGlf
dnN3aW5nX3NlcXVlbmNlKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCQlpY2xfbWdf
cGh5X2RkaV92c3dpbmdfc2VxdWVuY2UoZW5jb2RlciwgbGlua19jbG9jaywgbGV2ZWwpOwogfQog
CitzdGF0aWMgdm9pZAordGdsX2RrbF9waHlfZGRpX3Zzd2luZ19zZXF1ZW5jZShzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlciwgaW50IGxpbmtfY2xvY2ssCisJCQkJdTMyIGxldmVsKQorewor
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFz
ZS5kZXYpOworCWVudW0gdGNfcG9ydCB0Y19wb3J0ID0gaW50ZWxfcG9ydF90b190YyhkZXZfcHJp
diwgZW5jb2Rlci0+cG9ydCk7CisJY29uc3Qgc3RydWN0IHRnbF9ka2xfcGh5X2RkaV9idWZfdHJh
bnMgKmRkaV90cmFuc2xhdGlvbnM7CisJdTMyIG5fZW50cmllcywgdmFsLCBsbjsKKworCW5fZW50
cmllcyA9IEFSUkFZX1NJWkUodGdsX2RrbF9waHlfZGRpX3RyYW5zbGF0aW9ucyk7CisJZGRpX3Ry
YW5zbGF0aW9ucyA9IHRnbF9ka2xfcGh5X2RkaV90cmFuc2xhdGlvbnM7CisKKwlpZiAobGV2ZWwg
PiBuX2VudHJpZXMpCisJCWxldmVsID0gbl9lbnRyaWVzIC0gMTsKKworCS8qCisJICogQWxsIHJl
Z2lzdGVycyBwcm9ncmFtbWVkIGhlcmUgdXNlIEhJUF9JTkRFWF9SRUcgMCBvciAxCisJICovCisJ
Zm9yIChsbiA9IDA7IGxuIDwgMjsgbG4rKykgeworCQlJOTE1X1dSSVRFKEhJUF9JTkRFWF9SRUco
dGNfcG9ydCksIEhJUF9JTkRFWF9WQUwodGNfcG9ydCwgbG4pKTsKKworCQkvKiBBbGwgdGhlIHJl
Z2lzdGVycyBhcmUgUk1XICovCisJCXZhbCA9IEk5MTVfUkVBRChES0xfVFhfRFBDTlRMMCh0Y19w
b3J0KSk7CisJCXZhbCAmPSB+KERLTF9UWF9QUkVTSE9PVF9DT0VGRl9NQVNLIHwKKwkJCSBES0xf
VFhfREVfRU1QQUhTSVNfQ09FRkZfTUFTSyB8CisJCQkgREtMX1RYX1ZTV0lOR19DT05UUk9MX01B
U0spOworCQl2YWwgfD0gREtMX1RYX1ZTV0lOR19DT05UUk9MKGRkaV90cmFuc2xhdGlvbnNbbGV2
ZWxdLmRrbF92c3dpbmdfY29udHJvbCk7CisJCXZhbCB8PSBES0xfVFhfREVfRU1QSEFTSVNfQ09F
RkYoZGRpX3RyYW5zbGF0aW9uc1tsZXZlbF0uZGtsX2RlX2VtcGhhc2lzX2NvbnRyb2wpOworCQl2
YWwgfD0gREtMX1RYX1BSRVNIT09UX0NPRUZGKGRkaV90cmFuc2xhdGlvbnNbbGV2ZWxdLmRrbF9w
cmVzaG9vdF9jb250cm9sKTsKKwkJSTkxNV9XUklURShES0xfVFhfRFBDTlRMMCh0Y19wb3J0KSwg
dmFsKTsKKworCQl2YWwgPSBJOTE1X1JFQUQoREtMX1RYX0RQQ05UTDEodGNfcG9ydCkpOworCQl2
YWwgJj0gfihES0xfVFhfUFJFU0hPT1RfQ09FRkZfTUFTSyB8CisJCQkgREtMX1RYX0RFX0VNUEFI
U0lTX0NPRUZGX01BU0sgfAorCQkJIERLTF9UWF9WU1dJTkdfQ09OVFJPTF9NQVNLKTsKKwkJdmFs
IHw9IERLTF9UWF9WU1dJTkdfQ09OVFJPTChkZGlfdHJhbnNsYXRpb25zW2xldmVsXS5ka2xfdnN3
aW5nX2NvbnRyb2wpOworCQl2YWwgfD0gREtMX1RYX0RFX0VNUEhBU0lTX0NPRUZGKGRkaV90cmFu
c2xhdGlvbnNbbGV2ZWxdLmRrbF9kZV9lbXBoYXNpc19jb250cm9sKTsKKwkJdmFsIHw9IERLTF9U
WF9QUkVTSE9PVF9DT0VGRihkZGlfdHJhbnNsYXRpb25zW2xldmVsXS5ka2xfcHJlc2hvb3RfY29u
dHJvbCk7CisJCUk5MTVfV1JJVEUoREtMX1RYX0RQQ05UTDEodGNfcG9ydCksIHZhbCk7CisKKwkJ
dmFsID0gSTkxNV9SRUFEKERLTF9UWF9EUENOVEwyKHRjX3BvcnQpKTsKKwkJdmFsICY9IH5ES0xf
VFhfRFAyMEJJVE1PREU7CisJCUk5MTVfV1JJVEUoREtMX1RYX0RQQ05UTDIodGNfcG9ydCksIHZh
bCk7CisJfQorfQorCitzdGF0aWMgdm9pZCB0Z2xfZGRpX3Zzd2luZ19zZXF1ZW5jZShzdHJ1Y3Qg
aW50ZWxfZW5jb2RlciAqZW5jb2RlciwKKwkJCQkgICAgaW50IGxpbmtfY2xvY2ssCisJCQkJICAg
IHUzMiBsZXZlbCwKKwkJCQkgICAgZW51bSBpbnRlbF9vdXRwdXRfdHlwZSB0eXBlKQoreworCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZW5jb2Rlci0+YmFzZS5k
ZXYpOworCWVudW0gcGh5IHBoeSA9IGludGVsX3BvcnRfdG9fcGh5KGRldl9wcml2LCBlbmNvZGVy
LT5wb3J0KTsKKworCWlmIChpbnRlbF9waHlfaXNfY29tYm8oZGV2X3ByaXYsIHBoeSkpCisJCWlj
bF9jb21ib19waHlfZGRpX3Zzd2luZ19zZXF1ZW5jZShlbmNvZGVyLCBsZXZlbCwgdHlwZSk7CisJ
ZWxzZQorCQl0Z2xfZGtsX3BoeV9kZGlfdnN3aW5nX3NlcXVlbmNlKGVuY29kZXIsIGxpbmtfY2xv
Y2ssIGxldmVsKTsKK30KKwogc3RhdGljIHUzMiB0cmFuc2xhdGVfc2lnbmFsX2xldmVsKGludCBz
aWduYWxfbGV2ZWxzKQogewogCWludCBpOwpAQCAtMjc4MCw3ICsyODY3LDEwIEBAIHUzMiBieHRf
c2lnbmFsX2xldmVscyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKQogCXN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyID0gJmRwb3J0LT5iYXNlOwogCWludCBsZXZlbCA9IGludGVsX2RkaV9k
cF9sZXZlbChpbnRlbF9kcCk7CiAKLQlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkKKwlp
ZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikKKwkJdGdsX2RkaV92c3dpbmdfc2VxdWVuY2Uo
ZW5jb2RlciwgaW50ZWxfZHAtPmxpbmtfcmF0ZSwKKwkJCQkJbGV2ZWwsIGVuY29kZXItPnR5cGUp
OworCWVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCiAJCWljbF9kZGlfdnN3aW5n
X3NlcXVlbmNlKGVuY29kZXIsIGludGVsX2RwLT5saW5rX3JhdGUsCiAJCQkJCWxldmVsLCBlbmNv
ZGVyLT50eXBlKTsKIAllbHNlIGlmIChJU19DQU5OT05MQUtFKGRldl9wcml2KSkKQEAgLTMwMjcs
NiArMzExNywzNCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kZGlfY2xrX2Rpc2FibGUoc3RydWN0IGlu
dGVsX2VuY29kZXIgKmVuY29kZXIpCiAJfQogfQogCitzdGF0aWMgdm9pZAordGdsX3BoeV9jbG9j
a19nYXRpbmcoc3RydWN0IGludGVsX2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQsIGJvb2wgZW5hYmxl
KQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGlnX3Bv
cnQtPmJhc2UuYmFzZS5kZXYpOworCWVudW0gcG9ydCBwb3J0ID0gZGlnX3BvcnQtPmJhc2UucG9y
dDsKKwllbnVtIHRjX3BvcnQgdGNfcG9ydCA9IGludGVsX3BvcnRfdG9fdGMoZGV2X3ByaXYsIHBv
cnQpOworCXUzMiB2YWwsIHJlZ3M7CisJaW50IGxuOworCisJaWYgKHRjX3BvcnQgPT0gUE9SVF9U
Q19OT05FKQorCQlyZXR1cm47CisKKwlyZWdzID0gREtMX0RQX01PREVfQ0ZHX1RSMlBXUl9HQVRJ
TkcgfCBES0xfRFBfTU9ERV9DRkdfVFJQV1JfR0FUSU5HIHwKKwkgICAgICAgREtMX0RQX01PREVf
Q0ZHX0NMTlBXUl9HQVRJTkcgfCBES0xfRFBfTU9ERV9DRkdfRElHUFdSX0dBVElORyB8CisJICAg
ICAgIERLTF9EUF9NT0RFX0NGR19HQU9OUFdSX0dBVElORzsKKworCWZvciAobG4gPSAwOyBsbiA8
IDI7IGxuKyspIHsKKwkJSTkxNV9XUklURShISVBfSU5ERVhfUkVHKHRjX3BvcnQpLCBISVBfSU5E
RVhfVkFMKHRjX3BvcnQsIGxuKSk7CisKKwkJdmFsID0gSTkxNV9SRUFEKERLTF9EUF9NT0RFKHRj
X3BvcnQpKTsKKwkJaWYgKGVuYWJsZSkKKwkJCXZhbCB8PSByZWdzOworCQllbHNlCisJCQl2YWwg
Jj0gfnJlZ3M7CisJCUk5MTVfV1JJVEUoREtMX0RQX01PREUodGNfcG9ydCksIHZhbCk7CisJfQor
fQorCiBzdGF0aWMgdm9pZCBpY2xfZW5hYmxlX3BoeV9jbG9ja19nYXRpbmcoc3RydWN0IGludGVs
X2RpZ2l0YWxfcG9ydCAqZGlnX3BvcnQpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2ID0gdG9faTkxNShkaWdfcG9ydC0+YmFzZS5iYXNlLmRldik7CkBAIC0zMTUzLDYgKzMy
NzEsOTUgQEAgc3RhdGljIHZvaWQgaWNsX3Byb2dyYW1fbWdfZHBfbW9kZShzdHJ1Y3QgaW50ZWxf
ZGlnaXRhbF9wb3J0ICppbnRlbF9kaWdfcG9ydCkKIAlJOTE1X1dSSVRFKE1HX0RQX01PREUoMSwg
cG9ydCksIGxuMSk7CiB9CiAKK3N0YXRpYyB2b2lkIHRnbF9wcm9ncmFtX2RrbF9kcF9tb2RlKHN0
cnVjdCBpbnRlbF9kaWdpdGFsX3BvcnQgKmludGVsX2RpZ19wb3J0KQoreworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoaW50ZWxfZGlnX3BvcnQtPmJhc2UuYmFz
ZS5kZXYpOworCWVudW0gcG9ydCBwb3J0ID0gaW50ZWxfZGlnX3BvcnQtPmJhc2UucG9ydDsKKwll
bnVtIHRjX3BvcnQgdGNfcG9ydCA9IGludGVsX3BvcnRfdG9fdGMoZGV2X3ByaXYsIHBvcnQpOwor
CXUzMiBsbjAsIGxuMSwgbGFuZV9tYXNrLCBwaW5fbWFzazsKKwlpbnQgbnVtX2xhbmVzOworCisJ
aWYgKHRjX3BvcnQgPT0gUE9SVF9UQ19OT05FIHx8CisJICAgIGludGVsX2RpZ19wb3J0LT50Y19t
b2RlID09IFRDX1BPUlRfVEJUX0FMVCkKKwkJcmV0dXJuOworCisJSTkxNV9XUklURShISVBfSU5E
RVhfUkVHKHRjX3BvcnQpLCBISVBfSU5ERVhfVkFMKHRjX3BvcnQsIDB4MCkpOworCWxuMCA9IEk5
MTVfUkVBRChES0xfRFBfTU9ERSh0Y19wb3J0KSk7CisJSTkxNV9XUklURShISVBfSU5ERVhfUkVH
KHRjX3BvcnQpLCBISVBfSU5ERVhfVkFMKHRjX3BvcnQsIDB4MSkpOworCWxuMSA9IEk5MTVfUkVB
RChES0xfRFBfTU9ERSh0Y19wb3J0KSk7CisKKwludW1fbGFuZXMgPSBpbnRlbF9kaWdfcG9ydC0+
ZHAubGFuZV9jb3VudDsKKworCXN3aXRjaCAoaW50ZWxfZGlnX3BvcnQtPnRjX21vZGUpIHsKKwlj
YXNlIFRDX1BPUlRfRFBfQUxUOgorCQlsbjAgJj0gfihES0xfRFBfTU9ERV9DRkdfRFBfWDFfTU9E
RSB8IERLTF9EUF9NT0RFX0NGR19EUF9YMV9NT0RFKTsKKwkJbG4xICY9IH4oREtMX0RQX01PREVf
Q0ZHX0RQX1gxX01PREUgfCBES0xfRFBfTU9ERV9DRkdfRFBfWDJfTU9ERSk7CisKKwkJbGFuZV9t
YXNrID0gaW50ZWxfdGNfcG9ydF9nZXRfbGFuZV9tYXNrKGludGVsX2RpZ19wb3J0KTsgLyogRFBY
NFRYTEFUQyAqLworCQlwaW5fbWFzayA9IGludGVsX3RjX3BvcnRfZ2V0X3Bpbl9hc3NpZ25tZW50
X21hc2soaW50ZWxfZGlnX3BvcnQpOyAvKiBEUFBBVEMgKi8KKworCQlzd2l0Y2ggKHBpbl9tYXNr
KSB7CisJCWNhc2UgMHgwOgorCQkJaWYgKG51bV9sYW5lcyA9PSAxKSB7CisJCQkJbG4xIHw9IERL
TF9EUF9NT0RFX0NGR19EUF9YMV9NT0RFOworCQkJfSBlbHNlIHsKKwkJCQlsbjAgfD0gREtMX0RQ
X01PREVfQ0ZHX0RQX1gyX01PREU7CisJCQkJbG4xIHw9IERLTF9EUF9NT0RFX0NGR19EUF9YMl9N
T0RFOworCQkJfQorCQkJYnJlYWs7CisJCWNhc2UgMHgxOgorCQkJaWYgKG51bV9sYW5lcyA9PSA0
KSB7CisJCQkJbG4wIHw9IERLTF9EUF9NT0RFX0NGR19EUF9YMl9NT0RFOworCQkJCWxuMSB8PSBE
S0xfRFBfTU9ERV9DRkdfRFBfWDJfTU9ERTsKKwkJCX0KKwkJCWJyZWFrOworCQljYXNlIDB4MjoK
KwkJCWlmIChudW1fbGFuZXMgPT0gMikgeworCQkJCWxuMCB8PSBES0xfRFBfTU9ERV9DRkdfRFBf
WDJfTU9ERTsKKwkJCQlsbjEgfD0gREtMX0RQX01PREVfQ0ZHX0RQX1gyX01PREU7CisJCQl9CisJ
CQlicmVhazsKKwkJY2FzZSAweDM6CisJCWNhc2UgMHg1OgorCQkJaWYgKG51bV9sYW5lcyA9PSAx
KSB7CisJCQkJbG4wIHw9IERLTF9EUF9NT0RFX0NGR19EUF9YMV9NT0RFOworCQkJCWxuMSB8PSBE
S0xfRFBfTU9ERV9DRkdfRFBfWDFfTU9ERTsKKwkJCX0gZWxzZSB7CisJCQkJbG4wIHw9IERLTF9E
UF9NT0RFX0NGR19EUF9YMl9NT0RFOworCQkJCWxuMSB8PSBES0xfRFBfTU9ERV9DRkdfRFBfWDJf
TU9ERTsKKwkJCX0KKwkJCWJyZWFrOworCQljYXNlIDB4NDoKKwkJY2FzZSAweDY6CisJCQlpZiAo
bnVtX2xhbmVzID09IDEpIHsKKwkJCQlsbjAgfD0gREtMX0RQX01PREVfQ0ZHX0RQX1gxX01PREU7
CisJCQkJbG4xIHw9IERLTF9EUF9NT0RFX0NGR19EUF9YMV9NT0RFOworCQkJfSBlbHNlIHsKKwkJ
CQlsbjAgfD0gREtMX0RQX01PREVfQ0ZHX0RQX1gyX01PREU7CisJCQkJbG4xIHw9IERLTF9EUF9N
T0RFX0NGR19EUF9YMl9NT0RFOworCQkJfQorCQkJYnJlYWs7CisJCWRlZmF1bHQ6CisJCQlNSVNT
SU5HX0NBU0UobGFuZV9tYXNrKTsKKwkJfQorCQlicmVhazsKKworCWNhc2UgVENfUE9SVF9MRUdB
Q1k6CisJCWxuMCB8PSBES0xfRFBfTU9ERV9DRkdfRFBfWDFfTU9ERSB8IERLTF9EUF9NT0RFX0NG
R19EUF9YMl9NT0RFOworCQlsbjEgfD0gREtMX0RQX01PREVfQ0ZHX0RQX1gxX01PREUgfCBES0xf
RFBfTU9ERV9DRkdfRFBfWDJfTU9ERTsKKwkJYnJlYWs7CisKKwlkZWZhdWx0OgorCQlNSVNTSU5H
X0NBU0UoaW50ZWxfZGlnX3BvcnQtPnRjX21vZGUpOworCQlyZXR1cm47CisJfQorCisJSTkxNV9X
UklURShISVBfSU5ERVhfUkVHKHRjX3BvcnQpLCBISVBfSU5ERVhfVkFMKHRjX3BvcnQsIDB4MCkp
OworCUk5MTVfV1JJVEUoREtMX0RQX01PREUodGNfcG9ydCksIGxuMCk7CisJSTkxNV9XUklURShI
SVBfSU5ERVhfUkVHKHRjX3BvcnQpLCBISVBfSU5ERVhfVkFMKHRjX3BvcnQsIDB4MSkpOworCUk5
MTVfV1JJVEUoREtMX0RQX01PREUodGNfcG9ydCksIGxuMSk7Cit9CisKIHN0YXRpYyB2b2lkIGlu
dGVsX2RwX3Npbmtfc2V0X2ZlY19yZWFkeShzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLAogCQkJ
CQljb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKQEAgLTMyMzks
NyArMzQ0Niw3IEBAIHN0YXRpYyB2b2lkIHRnbF9kZGlfcHJlX2VuYWJsZV9kcChzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCQkJZGlnX3BvcnQtPmRkaV9pb19wb3dlcl9kb21haW4p
OwogCiAJLyogNi4gKi8KLQlpY2xfcHJvZ3JhbV9tZ19kcF9tb2RlKGRpZ19wb3J0KTsKKwl0Z2xf
cHJvZ3JhbV9ka2xfZHBfbW9kZShkaWdfcG9ydCk7CiAKIAkvKgogCSAqIDcuYSAtIFN0ZXBzIGlu
IHRoaXMgZnVuY3Rpb24gc2hvdWxkIG9ubHkgYmUgZXhlY3V0ZWQgb3ZlciBNU1QKQEAgLTMyNTIs
MTAgKzM0NTksMTAgQEAgc3RhdGljIHZvaWQgdGdsX2RkaV9wcmVfZW5hYmxlX2RwKHN0cnVjdCBp
bnRlbF9lbmNvZGVyICplbmNvZGVyLAogCWludGVsX2RkaV9jb25maWdfdHJhbnNjb2Rlcl9mdW5j
KGNydGNfc3RhdGUpOwogCiAJLyogNy5kICovCi0JaWNsX2Rpc2FibGVfcGh5X2Nsb2NrX2dhdGlu
ZyhkaWdfcG9ydCk7CisJdGdsX3BoeV9jbG9ja19nYXRpbmcoZGlnX3BvcnQsIGZhbHNlKTsKIAog
CS8qIDcuZSAqLwotCWljbF9kZGlfdnN3aW5nX3NlcXVlbmNlKGVuY29kZXIsIGNydGNfc3RhdGUt
PnBvcnRfY2xvY2ssIGxldmVsLAorCXRnbF9kZGlfdnN3aW5nX3NlcXVlbmNlKGVuY29kZXIsIGNy
dGNfc3RhdGUtPnBvcnRfY2xvY2ssIGxldmVsLAogCQkJCWVuY29kZXItPnR5cGUpOwogCiAJLyog
Ny5mICovCkBAIC0zMjg3LDYgKzM0OTQsMTUgQEAgc3RhdGljIHZvaWQgdGdsX2RkaV9wcmVfZW5h
YmxlX2RwKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCS8qIDcuayAqLwogCWludGVs
X2RwX3N0b3BfbGlua190cmFpbihpbnRlbF9kcCk7CiAKKwkvKgorCSAqIFRPRE86IGVuYWJsZSBj
bG9jayBnYXRpbmcKKwkgKgorCSAqIEl0IGlzIG5vdCB3cml0dGVuIGluIERQIGVuYWJsaW5nIHNl
cXVlbmNlIGJ1dCAiUEhZIENsb2NrZ2F0aW5nCisJICogcHJvZ3JhbW1pbmciIHN0YXRlcyB0aGF0
IGNsb2NrIGdhdGluZyBzaG91bGQgYmUgZW5hYmxlZCBhZnRlciB0aGUKKwkgKiBsaW5rIHRyYWlu
aW5nIGJ1dCBkb2luZyBzbyBjYXVzZXMgYWxsIHRoZSBmb2xsb3dpbmcgdHJhaW5pbmdzIHRvIGZh
aWwKKwkgKiBzbyBub3QgZW5hYmxpbmcgaXQgZm9yLgorCSAqLworCiAJLyogNy5sICovCiAJaW50
ZWxfZGRpX2VuYWJsZV9mZWMoZW5jb2RlciwgY3J0Y19zdGF0ZSk7CiAJaW50ZWxfZHNjX2VuYWJs
ZShlbmNvZGVyLCBjcnRjX3N0YXRlKTsKQEAgLTMzOTIsNyArMzYwOCwxMCBAQCBzdGF0aWMgdm9p
ZCBpbnRlbF9kZGlfcHJlX2VuYWJsZV9oZG1pKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
LAogCWludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0KGRldl9wcml2LCBkaWdfcG9ydC0+ZGRpX2lvX3Bv
d2VyX2RvbWFpbik7CiAKIAlpY2xfcHJvZ3JhbV9tZ19kcF9tb2RlKGRpZ19wb3J0KTsKLQlpY2xf
ZGlzYWJsZV9waHlfY2xvY2tfZ2F0aW5nKGRpZ19wb3J0KTsKKwlpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA+PSAxMikKKwkJdGdsX3BoeV9jbG9ja19nYXRpbmcoZGlnX3BvcnQsIGZhbHNlKTsKKwll
bHNlCisJCWljbF9kaXNhYmxlX3BoeV9jbG9ja19nYXRpbmcoZGlnX3BvcnQpOwogCiAJaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCiAJCWljbF9kZGlfdnN3aW5nX3NlcXVlbmNlKGVuY29k
ZXIsIGNydGNfc3RhdGUtPnBvcnRfY2xvY2ssCkBAIC0zNDA0LDcgKzM2MjMsMTAgQEAgc3RhdGlj
IHZvaWQgaW50ZWxfZGRpX3ByZV9lbmFibGVfaGRtaShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciwKIAllbHNlCiAJCWludGVsX3ByZXBhcmVfaGRtaV9kZGlfYnVmZmVycyhlbmNvZGVyLCBs
ZXZlbCk7CiAKLQlpY2xfZW5hYmxlX3BoeV9jbG9ja19nYXRpbmcoZGlnX3BvcnQpOworCWlmIChJ
TlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKQorCQl0Z2xfcGh5X2Nsb2NrX2dhdGluZyhkaWdfcG9y
dCwgdHJ1ZSk7CisJZWxzZQorCQlpY2xfZW5hYmxlX3BoeV9jbG9ja19nYXRpbmcoZGlnX3BvcnQp
OwogCiAJaWYgKElTX0dFTjlfQkMoZGV2X3ByaXYpKQogCQlza2xfZGRpX3NldF9pYm9vc3QoZW5j
b2RlciwgbGV2ZWwsIElOVEVMX09VVFBVVF9IRE1JKTsKLS0gCjIuMjMuMAoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlz
dApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

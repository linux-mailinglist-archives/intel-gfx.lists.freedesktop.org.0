Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id A3DBB74B9D
	for <lists+intel-gfx@lfdr.de>; Thu, 25 Jul 2019 12:33:38 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7DB806E6DE;
	Thu, 25 Jul 2019 10:33:36 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga14.intel.com (mga14.intel.com [192.55.52.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7E2316E6DE
 for <intel-gfx@lists.freedesktop.org>; Thu, 25 Jul 2019 10:33:35 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga006.jf.intel.com ([10.7.209.51])
 by fmsmga103.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 25 Jul 2019 03:33:35 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,306,1559545200"; d="scan'208";a="175170930"
Received: from roszkopf-mobl.ger.corp.intel.com (HELO
 delly.ger.corp.intel.com) ([10.249.32.173])
 by orsmga006.jf.intel.com with ESMTP; 25 Jul 2019 03:33:33 -0700
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 25 Jul 2019 13:33:20 +0300
Message-Id: <20190725103327.27010-3-lionel.g.landwerlin@intel.com>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190725103327.27010-1-lionel.g.landwerlin@intel.com>
References: <20190725103327.27010-1-lionel.g.landwerlin@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v10 2/9] drm/i915/perf: allow for CS OA configs
 to be created lazily
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SGVyZSB3ZSBpbnRyb2R1Y2UgYSBtZWNoYW5pc20gYnkgd2hpY2ggdGhlIGV4ZWNidWYgcGFydCBv
ZiB0aGUgaTkxNQpkcml2ZXIgd2lsbCBiZSBhYmxlIHRvIHJlcXVlc3QgdGhhdCBhIGJhdGNoIGJ1
ZmZlciBjb250YWluaW5nIHRoZQpwcm9ncmFtbWluZyBmb3IgYSBwYXJ0aWN1bGFyIE9BIGNvbmZp
ZyBiZSBjcmVhdGVkLgoKV2UnbGwgZXhlY3V0ZSB0aGVzZSBPQSBjb25maWd1cmF0aW9uIGJ1ZmZl
cnMgcmlnaHQgYmVmb3JlIGV4ZWN1dGluZyBhCnNldCBvZiB1c2Vyc3BhY2UgY29tbWFuZHMgc28g
dGhhdCBhIHBhcnRpY3VsYXIgdXNlciBiYXRjaGJ1ZmZlciBiZQpleGVjdXRlZCB3aXRoIGEgZ2l2
ZW4gT0EgY29uZmlndXJhdGlvbi4KClRoaXMgbWVjaGFuaXNtIGVzc2VudGlhbGx5IGFsbG93cyB0
aGUgdXNlcnNwYWNlIGRyaXZlciB0byBnbyB0aHJvdWdoCnNldmVyYWwgT0EgY29uZmlndXJhdGlv
biB3aXRob3V0IGhhdmluZyB0byBvcGVuL2Nsb3NlIHRoZSBpOTE1L3BlcmYKc3RyZWFtLgoKdjI6
IE5vIG5lZWQgZm9yIGxvY2tpbmcgb24gb2JqZWN0IE9BIGNvbmZpZyBvYmplY3QgY3JlYXRpb24g
KENocmlzKQogICAgRmx1c2ggY3B1IG1hcHBpbmcgb2YgT0EgY29uZmlnIChDaHJpcykKCnYzOiBQ
cm9wZXJseSBkZWFsIHdpdGggdGhlIHBlcmZfbWV0cmljIGxvY2sgKENocmlzL0xpb25lbCkKCnY0
OiBGaXggb2EgY29uZmlnIHVucmVmL3B1dCB3aGVuIG5vdCBmb3VuZCAoTGlvbmVsKQoKU2lnbmVk
LW9mZi1ieTogTGlvbmVsIExhbmR3ZXJsaW4gPGxpb25lbC5nLmxhbmR3ZXJsaW5AaW50ZWwuY29t
PgpSZXZpZXdlZC1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+Ci0t
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3B1X2NvbW1hbmRzLmggfCAgIDEgKwog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAgICAgICAgICAgICAgfCAgMjQgKystCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyAgICAgICAgICAgICB8IDE4NiArKysrKysr
KysrKysrKystLS0tCiAzIGZpbGVzIGNoYW5nZWQsIDE3NSBpbnNlcnRpb25zKCspLCAzNiBkZWxl
dGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ncHVf
Y29tbWFuZHMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5o
CmluZGV4IDY5ZjM0NzM3MzI1Zi4uNWI1MzAwZjE3Mzg1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMuaApAQCAtMTMzLDYgKzEzMyw3IEBACiAgKi8KICNk
ZWZpbmUgTUlfTE9BRF9SRUdJU1RFUl9JTU0oeCkJTUlfSU5TVFIoMHgyMiwgMiooeCktMSkKICNk
ZWZpbmUgICBNSV9MUklfRk9SQ0VfUE9TVEVECQkoMTw8MTIpCisjZGVmaW5lIE1JX0xPQURfUkVH
SVNURVJfSU1NX01BWF9SRUdTICgxMjYpCiAjZGVmaW5lIE1JX1NUT1JFX1JFR0lTVEVSX01FTSAg
ICAgICAgTUlfSU5TVFIoMHgyNCwgMSkKICNkZWZpbmUgTUlfU1RPUkVfUkVHSVNURVJfTUVNX0dF
TjggICBNSV9JTlNUUigweDI0LCAyKQogI2RlZmluZSAgIE1JX1NSTV9MUk1fR0xPQkFMX0dUVAkJ
KDE8PDIyKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKaW5kZXggNzU2NDIyMDY3M2JiLi44ZDBjMjJh
ZjgzNjIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaApAQCAtMTA5OCw2ICsxMDk4LDggQEAgc3Ry
dWN0IGk5MTVfb2FfcmVnIHsKIH07CiAKIHN0cnVjdCBpOTE1X29hX2NvbmZpZyB7CisJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTU7CisKIAljaGFyIHV1aWRbVVVJRF9TVFJJTkdfTEVOICsg
MV07CiAJaW50IGlkOwogCkBAIC0xMTEyLDYgKzExMTQsMTAgQEAgc3RydWN0IGk5MTVfb2FfY29u
ZmlnIHsKIAlzdHJ1Y3QgYXR0cmlidXRlICphdHRyc1syXTsKIAlzdHJ1Y3QgZGV2aWNlX2F0dHJp
YnV0ZSBzeXNmc19tZXRyaWNfaWQ7CiAKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
OworCisJc3RydWN0IGxpc3RfaGVhZCB2bWFfbGluazsKKwogCWF0b21pY190IHJlZl9jb3VudDsK
IH07CiAKQEAgLTE2ODksMTEgKzE2OTUsMjEgQEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgewog
CQlzdHJ1Y3QgbXV0ZXggbWV0cmljc19sb2NrOwogCiAJCS8qCi0JCSAqIExpc3Qgb2YgZHluYW1p
YyBjb25maWd1cmF0aW9ucywgeW91IG5lZWQgdG8gaG9sZAotCQkgKiBkZXZfcHJpdi0+cGVyZi5t
ZXRyaWNzX2xvY2sgdG8gYWNjZXNzIGl0LgorCQkgKiBMaXN0IG9mIGR5bmFtaWMgY29uZmlndXJh
dGlvbnMgKHN0cnVjdCBpOTE1X29hX2NvbmZpZyksIHlvdQorCQkgKiBuZWVkIHRvIGhvbGQgZGV2
X3ByaXYtPnBlcmYubWV0cmljc19sb2NrIHRvIGFjY2VzcyBpdC4KIAkJICovCiAJCXN0cnVjdCBp
ZHIgbWV0cmljc19pZHI7CiAKKwkJLyoKKwkJICogTGlzdCBvZiBkeW5hbWljIGNvbmZpZ3VyYXRp
b25zIChzdHJ1Y3QgaTkxNV9vYV9jb25maWcpCisJCSAqIHdoaWNoIGhhdmUgYW4gYWxsb2NhdGVk
IGJ1ZmZlciBpbiBHR1RUIGZvciByZWNvbmZpZ3VyYXRpb24sCisJCSAqIHlvdSBuZWVkIHRvIGhv
bGQgZGV2X3ByaXYtPnBlcmYubWV0cmljc19sb2NrIHRvIGFjY2VzcyBpdC4KKwkJICogRWxlbWVu
dHMgYXJlIGFkZGVkIHRvIHRoZSBsaXN0IGxhemlsbHkgb24gZXhlY2J1ZiAod2hlbiBhCisJCSAq
IHBhcnRpY3VsYXIgY29uZmlndXJhdGlvbiBpcyByZXF1ZXN0ZWQpLiBUaGUgbGlzdCBpcyBmcmVl
ZAorCQkgKiB1cG9uIGNsb3NpbmcgdGhlIHBlcmYgc3RyZWFtLgorCQkgKi8KKwkJc3RydWN0IGxp
c3RfaGVhZCBtZXRyaWNzX2J1ZmZlcnM7CisKIAkJLyoKIAkJICogTG9jayBhc3NvY2lhdGVkIHdp
dGggYW55dGhpbmcgYmVsb3cgd2l0aGluIHRoaXMgc3RydWN0dXJlCiAJCSAqIGV4Y2VwdCBleGNs
dXNpdmVfc3RyZWFtLgpAQCAtMjU0MCw2ICsyNTU2LDEwIEBAIGludCBpOTE1X3BlcmZfcmVtb3Zl
X2NvbmZpZ19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogdm9pZCBp
OTE1X29hX2luaXRfcmVnX3N0YXRlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAkJ
CSAgICBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsCiAJCQkgICAgdTMyICpyZWdfc3RhdGUpOwor
aW50IGk5MTVfcGVyZl9nZXRfb2FfY29uZmlnKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
LAorCQkJICAgIGludCBtZXRyaWNzX3NldCwKKwkJCSAgICBzdHJ1Y3QgaTkxNV9vYV9jb25maWcg
KipvdXRfY29uZmlnLAorCQkJICAgIHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICoqb3V0X29i
aik7CiAKIC8qIGk5MTVfZ2VtX2V2aWN0LmMgKi8KIGludCBfX211c3RfY2hlY2sgaTkxNV9nZW1f
ZXZpY3Rfc29tZXRoaW5nKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLApkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3BlcmYuYwppbmRleCBhZDVlZGI2ZTM2NWQuLjExMGUzZjM3NDc3NiAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9wZXJmLmMKQEAgLTM2NCw5ICszNjQsMjAgQEAgc3RydWN0IHBlcmZfb3Blbl9w
cm9wZXJ0aWVzIHsKIAlpbnQgb2FfcGVyaW9kX2V4cG9uZW50OwogfTsKIAotc3RhdGljIHZvaWQg
ZnJlZV9vYV9jb25maWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAotCQkJICAg
c3RydWN0IGk5MTVfb2FfY29uZmlnICpvYV9jb25maWcpCitzdGF0aWMgdm9pZCBwdXRfb2FfY29u
ZmlnKHN0cnVjdCBpOTE1X29hX2NvbmZpZyAqb2FfY29uZmlnKQogeworCWlmICghYXRvbWljX2Rl
Y19hbmRfdGVzdCgmb2FfY29uZmlnLT5yZWZfY291bnQpKQorCQlyZXR1cm47CisKKwlpZiAob2Ff
Y29uZmlnLT5vYmopIHsKKwkJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBvYV9jb25m
aWctPmk5MTU7CisKKwkJbXV0ZXhfbG9jaygmaTkxNS0+cGVyZi5tZXRyaWNzX2xvY2spOworCQls
aXN0X2RlbCgmb2FfY29uZmlnLT52bWFfbGluayk7CisJCWk5MTVfZ2VtX29iamVjdF9wdXQob2Ff
Y29uZmlnLT5vYmopOworCQltdXRleF91bmxvY2soJmk5MTUtPnBlcmYubWV0cmljc19sb2NrKTsK
Kwl9CisKIAlpZiAoIVBUUl9FUlIob2FfY29uZmlnLT5mbGV4X3JlZ3MpKQogCQlrZnJlZShvYV9j
b25maWctPmZsZXhfcmVncyk7CiAJaWYgKCFQVFJfRVJSKG9hX2NvbmZpZy0+Yl9jb3VudGVyX3Jl
Z3MpKQpAQCAtMzc2LDM4ICszODcsMTI0IEBAIHN0YXRpYyB2b2lkIGZyZWVfb2FfY29uZmlnKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlrZnJlZShvYV9jb25maWcpOwogfQog
Ci1zdGF0aWMgdm9pZCBwdXRfb2FfY29uZmlnKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiwKLQkJCSAgc3RydWN0IGk5MTVfb2FfY29uZmlnICpvYV9jb25maWcpCitzdGF0aWMgdTMy
ICp3cml0ZV9jc19taV9scmkodTMyICpjcywgY29uc3Qgc3RydWN0IGk5MTVfb2FfcmVnICpyZWdf
ZGF0YSwgdTMyIG5fcmVncykKIHsKLQlpZiAoIWF0b21pY19kZWNfYW5kX3Rlc3QoJm9hX2NvbmZp
Zy0+cmVmX2NvdW50KSkKLQkJcmV0dXJuOworCXUzMiBpOwogCi0JZnJlZV9vYV9jb25maWcoZGV2
X3ByaXYsIG9hX2NvbmZpZyk7CisJZm9yIChpID0gMDsgaSA8IG5fcmVnczsgaSsrKSB7CisJCWlm
ICgoaSAlIE1JX0xPQURfUkVHSVNURVJfSU1NX01BWF9SRUdTKSA9PSAwKSB7CisJCQl1MzIgbl9s
cmkgPSBtaW4obl9yZWdzIC0gaSwKKwkJCQkJKHUzMikgTUlfTE9BRF9SRUdJU1RFUl9JTU1fTUFY
X1JFR1MpOworCisJCQkqY3MrKyA9IE1JX0xPQURfUkVHSVNURVJfSU1NKG5fbHJpKTsKKwkJfQor
CQkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KHJlZ19kYXRhW2ldLmFkZHIpOworCQkqY3Mr
KyA9IHJlZ19kYXRhW2ldLnZhbHVlOworCX0KKworCXJldHVybiBjczsKIH0KIAotc3RhdGljIGlu
dCBnZXRfb2FfY29uZmlnKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCSBp
bnQgbWV0cmljc19zZXQsCi0JCQkgc3RydWN0IGk5MTVfb2FfY29uZmlnICoqb3V0X2NvbmZpZykK
K3N0YXRpYyBpbnQgYWxsb2Nfb2FfY29uZmlnX2J1ZmZlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKKwkJCQkgIHN0cnVjdCBpOTE1X29hX2NvbmZpZyAqb2FfY29uZmlnKQogewotCWlu
dCByZXQ7CisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKmJvOworCXNpemVfdCBjb25maWdf
bGVuZ3RoID0gMDsKKwl1MzIgKmNzOwogCi0JaWYgKG1ldHJpY3Nfc2V0ID09IDEpIHsKLQkJKm91
dF9jb25maWcgPSAmZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWc7Ci0JCWF0b21pY19pbmMo
JmRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLnJlZl9jb3VudCk7Ci0JCXJldHVybiAwOwor
CWlmIChvYV9jb25maWctPm11eF9yZWdzX2xlbiA+IDApIHsKKwkJY29uZmlnX2xlbmd0aCArPSBE
SVZfUk9VTkRfVVAob2FfY29uZmlnLT5tdXhfcmVnc19sZW4sCisJCQkJCSAgICAgIE1JX0xPQURf
UkVHSVNURVJfSU1NX01BWF9SRUdTKSAqIDQ7CisJCWNvbmZpZ19sZW5ndGggKz0gb2FfY29uZmln
LT5tdXhfcmVnc19sZW4gKiA4OworCX0KKwlpZiAob2FfY29uZmlnLT5iX2NvdW50ZXJfcmVnc19s
ZW4gPiAwKSB7CisJCWNvbmZpZ19sZW5ndGggKz0gRElWX1JPVU5EX1VQKG9hX2NvbmZpZy0+Yl9j
b3VudGVyX3JlZ3NfbGVuLAorCQkJCQkgICAgICBNSV9MT0FEX1JFR0lTVEVSX0lNTV9NQVhfUkVH
UykgKiA0OworCQljb25maWdfbGVuZ3RoICs9IG9hX2NvbmZpZy0+Yl9jb3VudGVyX3JlZ3NfbGVu
ICogODsKKwl9CisJaWYgKG9hX2NvbmZpZy0+ZmxleF9yZWdzX2xlbiA+IDApIHsKKwkJY29uZmln
X2xlbmd0aCArPSBESVZfUk9VTkRfVVAob2FfY29uZmlnLT5mbGV4X3JlZ3NfbGVuLAorCQkJCQkg
ICAgICBNSV9MT0FEX1JFR0lTVEVSX0lNTV9NQVhfUkVHUykgKiA0OworCQljb25maWdfbGVuZ3Ro
ICs9IG9hX2NvbmZpZy0+ZmxleF9yZWdzX2xlbiAqIDg7CiAJfQorCWNvbmZpZ19sZW5ndGggKz0g
NDsgLyogTUlfQkFUQ0hfQlVGRkVSX0VORCAqLworCWNvbmZpZ19sZW5ndGggPSBBTElHTihjb25m
aWdfbGVuZ3RoLCBJOTE1X0dUVF9QQUdFX1NJWkUpOwogCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRl
cnJ1cHRpYmxlKCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2xvY2spOworCWJvID0gaTkxNV9nZW1f
b2JqZWN0X2NyZWF0ZV9zaG1lbShpOTE1LCBjb25maWdfbGVuZ3RoKTsKKwlpZiAoSVNfRVJSKGJv
KSkKKwkJcmV0dXJuIFBUUl9FUlIoYm8pOworCisJY3MgPSBpOTE1X2dlbV9vYmplY3RfcGluX21h
cChibywgSTkxNV9NQVBfV0IpOworCWlmIChJU19FUlIoY3MpKSB7CisJCWk5MTVfZ2VtX29iamVj
dF9wdXQoYm8pOworCQlyZXR1cm4gUFRSX0VSUihjcyk7CisJfQorCisJY3MgPSB3cml0ZV9jc19t
aV9scmkoY3MsIG9hX2NvbmZpZy0+bXV4X3JlZ3MsIG9hX2NvbmZpZy0+bXV4X3JlZ3NfbGVuKTsK
KwljcyA9IHdyaXRlX2NzX21pX2xyaShjcywgb2FfY29uZmlnLT5iX2NvdW50ZXJfcmVncywgb2Ff
Y29uZmlnLT5iX2NvdW50ZXJfcmVnc19sZW4pOworCWNzID0gd3JpdGVfY3NfbWlfbHJpKGNzLCBv
YV9jb25maWctPmZsZXhfcmVncywgb2FfY29uZmlnLT5mbGV4X3JlZ3NfbGVuKTsKKworCSpjcysr
ID0gTUlfQkFUQ0hfQlVGRkVSX0VORDsKKworCWk5MTVfZ2VtX29iamVjdF9mbHVzaF9tYXAoYm8p
OworCWk5MTVfZ2VtX29iamVjdF91bnBpbl9tYXAoYm8pOworCisJb2FfY29uZmlnLT5vYmogPSBi
bzsKKworCXJldHVybiAwOworfQorCitpbnQgaTkxNV9wZXJmX2dldF9vYV9jb25maWcoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCisJCQkgICAgaW50IG1ldHJpY3Nfc2V0LAorCQkJICAg
IHN0cnVjdCBpOTE1X29hX2NvbmZpZyAqKm91dF9jb25maWcsCisJCQkgICAgc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKipvdXRfb2JqKQoreworCWludCByZXQgPSAwOworCXN0cnVjdCBpOTE1
X29hX2NvbmZpZyAqb2FfY29uZmlnOworCisJaWYgKCFpOTE1LT5wZXJmLmluaXRpYWxpemVkKQor
CQlyZXR1cm4gLUVOT0RFVjsKKworCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkx
NS0+cGVyZi5tZXRyaWNzX2xvY2spOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQkqb3V0
X2NvbmZpZyA9IGlkcl9maW5kKCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2lkciwgbWV0cmljc19z
ZXQpOwotCWlmICghKm91dF9jb25maWcpCi0JCXJldCA9IC1FSU5WQUw7Ci0JZWxzZQotCQlhdG9t
aWNfaW5jKCYoKm91dF9jb25maWcpLT5yZWZfY291bnQpOworCWlmIChtZXRyaWNzX3NldCA9PSAx
KSB7CisJCW9hX2NvbmZpZyA9ICZpOTE1LT5wZXJmLm9hLnRlc3RfY29uZmlnOworCX0gZWxzZSB7
CisJCW9hX2NvbmZpZyA9IGlkcl9maW5kKCZpOTE1LT5wZXJmLm1ldHJpY3NfaWRyLCBtZXRyaWNz
X3NldCk7CisJCWlmICghb2FfY29uZmlnKSB7CisJCQlyZXQgPSAtRUlOVkFMOworCQkJZ290byBl
cnJfdW5sb2NrOworCQl9CisJfQogCi0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cGVyZi5tZXRy
aWNzX2xvY2spOworCWlmIChvdXRfY29uZmlnKSB7CisJCWF0b21pY19pbmMoJm9hX2NvbmZpZy0+
cmVmX2NvdW50KTsKKwkJKm91dF9jb25maWcgPSBvYV9jb25maWc7CisJfQorCisJaWYgKG91dF9v
YmopIHsKKwkJaWYgKG9hX2NvbmZpZy0+b2JqKSB7CisJCQkqb3V0X29iaiA9IGk5MTVfZ2VtX29i
amVjdF9nZXQob2FfY29uZmlnLT5vYmopOworCQl9IGVsc2UgeworCQkJcmV0ID0gYWxsb2Nfb2Ff
Y29uZmlnX2J1ZmZlcihpOTE1LCBvYV9jb25maWcpOworCQkJaWYgKHJldCkKKwkJCQlnb3RvIGVy
cl91bmxvY2s7CisKKwkJCWxpc3RfYWRkKCZvYV9jb25maWctPnZtYV9saW5rLAorCQkJCSAmaTkx
NS0+cGVyZi5tZXRyaWNzX2J1ZmZlcnMpOworCQkJKm91dF9vYmogPSBpOTE1X2dlbV9vYmplY3Rf
Z2V0KG9hX2NvbmZpZy0+b2JqKTsKKwkJfQorCX0KKworZXJyX3VubG9jazoKKwltdXRleF91bmxv
Y2soJmk5MTUtPnBlcmYubWV0cmljc19sb2NrKTsKKworCWlmIChyZXQgJiYgb3V0X2NvbmZpZyAm
JiBvYV9jb25maWcpIHsKKwkJcHV0X29hX2NvbmZpZyhvYV9jb25maWcpOworCQkqb3V0X2NvbmZp
ZyA9IE5VTEw7CisJfQogCiAJcmV0dXJuIHJldDsKIH0KQEAgLTEzNzgsNyArMTQ3NSw3IEBAIHN0
YXRpYyB2b2lkIGk5MTVfb2Ffc3RyZWFtX2Rlc3Ryb3koc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0g
KnN0cmVhbSkKIAlpZiAoc3RyZWFtLT5jdHgpCiAJCW9hX3B1dF9yZW5kZXJfY3R4X2lkKHN0cmVh
bSk7CiAKLQlwdXRfb2FfY29uZmlnKGRldl9wcml2LCBzdHJlYW0tPm9hX2NvbmZpZyk7CisJcHV0
X29hX2NvbmZpZyhzdHJlYW0tPm9hX2NvbmZpZyk7CiAKIAlpZiAoZGV2X3ByaXYtPnBlcmYub2Eu
c3B1cmlvdXNfcmVwb3J0X3JzLm1pc3NlZCkgewogCQlEUk1fTk9URSgiJWQgc3B1cmlvdXMgT0Eg
cmVwb3J0IG5vdGljZXMgc3VwcHJlc3NlZCBkdWUgdG8gcmF0ZWxpbWl0aW5nXG4iLApAQCAtMjIy
Niw3ICsyMzIzLDggQEAgc3RhdGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1
X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJCX0KIAl9CiAKLQlyZXQgPSBnZXRfb2FfY29uZmlnKGRl
dl9wcml2LCBwcm9wcy0+bWV0cmljc19zZXQsICZzdHJlYW0tPm9hX2NvbmZpZyk7CisJcmV0ID0g
aTkxNV9wZXJmX2dldF9vYV9jb25maWcoZGV2X3ByaXYsIHByb3BzLT5tZXRyaWNzX3NldCwKKwkJ
CQkgICAgICAmc3RyZWFtLT5vYV9jb25maWcsIE5VTEwpOwogCWlmIChyZXQpIHsKIAkJRFJNX0RF
QlVHKCJJbnZhbGlkIE9BIGNvbmZpZyBpZD0laVxuIiwgcHJvcHMtPm1ldHJpY3Nfc2V0KTsKIAkJ
Z290byBlcnJfY29uZmlnOwpAQCAtMjI2NCw2ICsyMzYyLDggQEAgc3RhdGljIGludCBpOTE1X29h
X3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0sCiAJCWdvdG8gZXJy
X2VuYWJsZTsKIAl9CiAKKwlEUk1fREVCVUcoIm9wZW5pbmcgc3RyZWFtIG9hIGNvbmZpZyB1dWlk
PSVzXG4iLCBzdHJlYW0tPm9hX2NvbmZpZy0+dXVpZCk7CisKIAltdXRleF91bmxvY2soJmRldl9w
cml2LT5kcm0uc3RydWN0X211dGV4KTsKIAogCXJldHVybiAwOwpAQCAtMjI3Nyw3ICsyMzc3LDcg
QEAgc3RhdGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFt
ICpzdHJlYW0sCiAJZnJlZV9vYV9idWZmZXIoZGV2X3ByaXYpOwogCiBlcnJfb2FfYnVmX2FsbG9j
OgotCXB1dF9vYV9jb25maWcoZGV2X3ByaXYsIHN0cmVhbS0+b2FfY29uZmlnKTsKKwlwdXRfb2Ff
Y29uZmlnKHN0cmVhbS0+b2FfY29uZmlnKTsKIAogCWludGVsX3VuY29yZV9mb3JjZXdha2VfcHV0
KCZkZXZfcHJpdi0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsKIAlpbnRlbF9ydW50aW1lX3BtX3B1
dCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0sIHN0cmVhbS0+d2FrZXJlZik7CkBAIC0yNjQ0LDkgKzI3
NDQsMjEgQEAgc3RhdGljIGludCBpOTE1X3BlcmZfcmVsZWFzZShzdHJ1Y3QgaW5vZGUgKmlub2Rl
LCBzdHJ1Y3QgZmlsZSAqZmlsZSkKIHsKIAlzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFt
ID0gZmlsZS0+cHJpdmF0ZV9kYXRhOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHN0cmVhbS0+ZGV2X3ByaXY7CisJc3RydWN0IGk5MTVfb2FfY29uZmlnICpvYV9jb25maWcs
ICpuZXh0OwogCiAJbXV0ZXhfbG9jaygmZGV2X3ByaXYtPnBlcmYubG9jayk7CisKIAlpOTE1X3Bl
cmZfZGVzdHJveV9sb2NrZWQoc3RyZWFtKTsKKworCS8qIERpc3Bvc2Ugb2YgYWxsIG9hIGNvbmZp
ZyBiYXRjaCBidWZmZXJzLiAqLworCW11dGV4X2xvY2soJmRldl9wcml2LT5wZXJmLm1ldHJpY3Nf
bG9jayk7CisJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKG9hX2NvbmZpZywgbmV4dCwgJmRldl9w
cml2LT5wZXJmLm1ldHJpY3NfYnVmZmVycywgdm1hX2xpbmspIHsKKwkJbGlzdF9kZWwoJm9hX2Nv
bmZpZy0+dm1hX2xpbmspOworCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9hX2NvbmZpZy0+b2JqKTsK
KwkJb2FfY29uZmlnLT5vYmogPSBOVUxMOworCX0KKwltdXRleF91bmxvY2soJmRldl9wcml2LT5w
ZXJmLm1ldHJpY3NfbG9jayk7CisKIAltdXRleF91bmxvY2soJmRldl9wcml2LT5wZXJmLmxvY2sp
OwogCiAJLyogUmVsZWFzZSB0aGUgcmVmZXJlbmNlIHRoZSBwZXJmIHN0cmVhbSBrZXB0IG9uIHRo
ZSBkcml2ZXIuICovCkBAIC0zMDgyLDYgKzMxOTQsNyBAQCB2b2lkIGk5MTVfcGVyZl9yZWdpc3Rl
cihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJaWYgKHJldCkKIAkJZ290byBz
eXNmc19lcnJvcjsKIAorCWRldl9wcml2LT5wZXJmLm9hLnRlc3RfY29uZmlnLmk5MTUgPSBkZXZf
cHJpdjsKIAlhdG9taWNfc2V0KCZkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5yZWZfY291
bnQsIDEpOwogCiAJZ290byBleGl0OwpAQCAtMzMzOCw2ICszNDUxLDcgQEAgaW50IGk5MTVfcGVy
Zl9hZGRfY29uZmlnX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJ
CXJldHVybiAtRU5PTUVNOwogCX0KIAorCW9hX2NvbmZpZy0+aTkxNSA9IGRldl9wcml2OwogCWF0
b21pY19zZXQoJm9hX2NvbmZpZy0+cmVmX2NvdW50LCAxKTsKIAogCWlmICghdXVpZF9pc192YWxp
ZChhcmdzLT51dWlkKSkgewpAQCAtMzQzNyw3ICszNTUxLDcgQEAgaW50IGk5MTVfcGVyZl9hZGRf
Y29uZmlnX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiBzeXNmc19l
cnI6CiAJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2xvY2spOwogcmVnX2Vy
cjoKLQlwdXRfb2FfY29uZmlnKGRldl9wcml2LCBvYV9jb25maWcpOworCXB1dF9vYV9jb25maWco
b2FfY29uZmlnKTsKIAlEUk1fREVCVUcoIkZhaWxlZCB0byBhZGQgbmV3IE9BIGNvbmZpZ1xuIik7
CiAJcmV0dXJuIGVycjsKIH0KQEAgLTM0NzMsMTMgKzM1ODcsMTMgQEAgaW50IGk5MTVfcGVyZl9y
ZW1vdmVfY29uZmlnX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAK
IAlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmRldl9wcml2LT5wZXJmLm1ldHJpY3Nf
bG9jayk7CiAJaWYgKHJldCkKLQkJZ290byBsb2NrX2VycjsKKwkJcmV0dXJuIHJldDsKIAogCW9h
X2NvbmZpZyA9IGlkcl9maW5kKCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2lkciwgKmFyZyk7CiAJ
aWYgKCFvYV9jb25maWcpIHsKIAkJRFJNX0RFQlVHKCJGYWlsZWQgdG8gcmVtb3ZlIHVua25vd24g
T0EgY29uZmlnXG4iKTsKIAkJcmV0ID0gLUVOT0VOVDsKLQkJZ290byBjb25maWdfZXJyOworCQln
b3RvIGVycl91bmxvY2s7CiAJfQogCiAJR0VNX0JVR19PTigqYXJnICE9IG9hX2NvbmZpZy0+aWQp
OwpAQCAtMzQ4OSwxMyArMzYwMywxNiBAQCBpbnQgaTkxNV9wZXJmX3JlbW92ZV9jb25maWdfaW9j
dGwoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAogCWlkcl9yZW1vdmUoJmRl
dl9wcml2LT5wZXJmLm1ldHJpY3NfaWRyLCAqYXJnKTsKIAorCW11dGV4X3VubG9jaygmZGV2X3By
aXYtPnBlcmYubWV0cmljc19sb2NrKTsKKwogCURSTV9ERUJVRygiUmVtb3ZlZCBjb25maWcgJXMg
aWQ9JWlcbiIsIG9hX2NvbmZpZy0+dXVpZCwgb2FfY29uZmlnLT5pZCk7CiAKLQlwdXRfb2FfY29u
ZmlnKGRldl9wcml2LCBvYV9jb25maWcpOworCXB1dF9vYV9jb25maWcob2FfY29uZmlnKTsKKwor
CXJldHVybiAwOwogCi1jb25maWdfZXJyOgorZXJyX3VubG9jazoKIAltdXRleF91bmxvY2soJmRl
dl9wcml2LT5wZXJmLm1ldHJpY3NfbG9jayk7Ci1sb2NrX2VycjoKIAlyZXR1cm4gcmV0OwogfQog
CkBAIC0zNjM3LDYgKzM3NTQsOCBAQCB2b2lkIGk5MTVfcGVyZl9pbml0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICpkZXZfcHJpdikKIAkJaW5pdF93YWl0cXVldWVfaGVhZCgmZGV2X3ByaXYtPnBl
cmYub2EucG9sbF93cSk7CiAKIAkJSU5JVF9MSVNUX0hFQUQoJmRldl9wcml2LT5wZXJmLnN0cmVh
bXMpOworCQlJTklUX0xJU1RfSEVBRCgmZGV2X3ByaXYtPnBlcmYubWV0cmljc19idWZmZXJzKTsK
KwogCQltdXRleF9pbml0KCZkZXZfcHJpdi0+cGVyZi5sb2NrKTsKIAkJc3Bpbl9sb2NrX2luaXQo
JmRldl9wcml2LT5wZXJmLm9hLm9hX2J1ZmZlci5wdHJfbG9jayk7CiAKQEAgLTM2NTMsMTAgKzM3
NzIsOSBAQCB2b2lkIGk5MTVfcGVyZl9pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIAogc3RhdGljIGludCBkZXN0cm95X2NvbmZpZyhpbnQgaWQsIHZvaWQgKnAsIHZvaWQg
KmRhdGEpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZGF0YTsKIAlz
dHJ1Y3QgaTkxNV9vYV9jb25maWcgKm9hX2NvbmZpZyA9IHA7CiAKLQlwdXRfb2FfY29uZmlnKGRl
dl9wcml2LCBvYV9jb25maWcpOworCXB1dF9vYV9jb25maWcob2FfY29uZmlnKTsKIAogCXJldHVy
biAwOwogfQpAQCAtMzY3MCw3ICszNzg4LDcgQEAgdm9pZCBpOTE1X3BlcmZfZmluaShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJaWYgKCFkZXZfcHJpdi0+cGVyZi5pbml0aWFs
aXplZCkKIAkJcmV0dXJuOwogCi0JaWRyX2Zvcl9lYWNoKCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNz
X2lkciwgZGVzdHJveV9jb25maWcsIGRldl9wcml2KTsKKwlpZHJfZm9yX2VhY2goJmRldl9wcml2
LT5wZXJmLm1ldHJpY3NfaWRyLCBkZXN0cm95X2NvbmZpZywgTlVMTCk7CiAJaWRyX2Rlc3Ryb3ko
JmRldl9wcml2LT5wZXJmLm1ldHJpY3NfaWRyKTsKIAogCXVucmVnaXN0ZXJfc3lzY3RsX3RhYmxl
KGRldl9wcml2LT5wZXJmLnN5c2N0bF9oZWFkZXIpOwotLSAKMi4yMi4wCgpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0
CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

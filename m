Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 780B2E9A16
	for <lists+intel-gfx@lfdr.de>; Wed, 30 Oct 2019 11:38:42 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B1FE36E93F;
	Wed, 30 Oct 2019 10:38:40 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B85C66E941
 for <intel-gfx@lists.freedesktop.org>; Wed, 30 Oct 2019 10:38:35 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19017338-1500050 
 for multiple; Wed, 30 Oct 2019 10:38:30 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 30 Oct 2019 10:38:27 +0000
Message-Id: <20191030103827.2413-5-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0.rc1
In-Reply-To: <20191030103827.2413-1-chris@chris-wilson.co.uk>
References: <20191030103827.2413-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 5/5] drm/i915: Defer rc6 shutdown to suspend_late
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q3VycmVudGx5IHdlIHNodXRkb3duIHJjNiBkdXJpbmcgaTkxNV9nZW1fcmVzdW1lKCkgYnV0IHRo
aXMgaXMgY2FsbGVkCmR1cmluZyB0aGUgcHJlcGFyYXRpb24gcGhhc2UgKGk5MTVfZHJtX3ByZXBh
cmUpIGZvciBhbGwgc3VzcGVuZCBwYXRocywKYnV0IHdlIG9ubHkgd2FudCB0byBzaHV0ZG93biBy
YzYgZm9yIFMzKy4gTW92ZSB0aGUgYWN0dWFsIHNodXRkb3duIHRvCmk5MTVfZ2VtX3N1c3BlbmRf
bGF0ZSgpLgoKV2UgdGhlbiBuZWVkIHRvIGRpZmZlcmVudGlhdGUgYmV0d2VlbiBzdXNwZW5kIHRh
cmdldHMsIHRvIGRpc3Rpbmd1aXNoIFMwCihzMmlkbGUpIHdoZXJlIHRoZSBkZXZpY2UgaXMga2Vw
dCBhd2FrZSBidXQgbmVlZHMgdG8gYmUgaW4gYSBsb3cgcG93ZXIKbW9kZSAodGhlIHNhbWUgYXMg
cnVudGltZSBzdXNwZW5kKSBmcm9tIHRoZSBkZXZpY2Ugc3VzcGVuZCBsZXZlbHMgd2hlcmUKd2Ug
bG9zZSBjb250cm9sIG9mIEhXIGFuZCBzbyBtdXN0IGRpc2FibGUgYW55IEhXIGFjY2VzcyB0byBk
YW5nbGluZwptZW1vcnkuCgpCdWd6aWxsYTogaHR0cHM6Ly9idWdzLmZyZWVkZXNrdG9wLm9yZy9z
aG93X2J1Zy5jZ2k/aWQ9MTExOTA5CkZpeGVzOiBjMTEzMjM2NzE4ZTggKCJkcm0vaTkxNTogRXh0
cmFjdCBHVCByZW5kZXIgc2xlZXAgKHJjNikgbWFuYWdlbWVudCIpClRlc3RjYXNlOiBpZ3QvZ2Vt
X2V4ZWNfc3VzcGVuZC9wb3dlci1TMApTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlz
QGNocmlzLXdpbHNvbi5jby51az4KQ2M6IEFuZGkgU2h5dGkgPGFuZGkuc2h5dGlAaW50ZWwuY29t
PgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jICAgfCAgNCArKyst
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5jICAgIHwgMzAgKysrKysrKysr
KysrKysrKysrKy0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5oICAg
IHwgIDMgKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yYzYuYyAgICAgIHwgIDUg
KysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfZ3RfcG0uYyB8ICAyICstCiA1
IGZpbGVzIGNoYW5nZWQsIDM1IGluc2VydGlvbnMoKyksIDkgZGVsZXRpb25zKC0pCgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYwppbmRleCA2Nzc5YWIzNDEwMWIuLmY4OGVlMTMx
N2JiNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKQEAgLTI3LDcgKzI3
LDcgQEAgdm9pZCBpOTE1X2dlbV9zdXNwZW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
KQogCSAqIHN0YXRlLiBGb3J0dW5hdGVseSwgdGhlIGtlcm5lbF9jb250ZXh0IGlzIGRpc3Bvc2Fi
bGUgYW5kIHdlIGRvCiAJICogbm90IHJlbHkgb24gaXRzIHN0YXRlLgogCSAqLwotCWludGVsX2d0
X3N1c3BlbmQoJmk5MTUtPmd0KTsKKwlpbnRlbF9ndF9zdXNwZW5kX3ByZXBhcmUoJmk5MTUtPmd0
KTsKIAogCWk5MTVfZ2VtX2RyYWluX2ZyZWVkX29iamVjdHMoaTkxNSk7CiB9CkBAIC02OSw2ICs2
OSw4IEBAIHZvaWQgaTkxNV9nZW1fc3VzcGVuZF9sYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1KQogCSAqIG1hY2hpbmUgaW4gYW4gdW51c2FibGUgY29uZGl0aW9uLgogCSAqLwogCisJ
aW50ZWxfZ3Rfc3VzcGVuZF9sYXRlKCZpOTE1LT5ndCk7CisKIAlzcGluX2xvY2tfaXJxc2F2ZSgm
aTkxNS0+bW0ub2JqX2xvY2ssIGZsYWdzKTsKIAlmb3IgKHBoYXNlID0gcGhhc2VzOyAqcGhhc2U7
IHBoYXNlKyspIHsKIAkJTElTVF9IRUFEKGtlZXApOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2d0X3BtLmMKaW5kZXggMTE2NjFkZThjNDBiLi4wOWY1OWFjZjVlNjMgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfZ3RfcG0uYwpAQCAtNCw2ICs0LDggQEAKICAqIENvcHlyaWdodCDCqSAy
MDE5IEludGVsIENvcnBvcmF0aW9uCiAgKi8KIAorI2luY2x1ZGUgPGxpbnV4L3N1c3BlbmQuaD4K
KwogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAjaW5jbHVkZSAiaTkxNV9nbG9iYWxzLmgiCiAjaW5j
bHVkZSAiaTkxNV9wYXJhbXMuaCIKQEAgLTIzNiw4ICsyMzgsMTMgQEAgaW50IGludGVsX2d0X3Jl
c3VtZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogCXJldHVybiBlcnI7CiB9CiAKLXN0YXRpYyB2b2lk
IHdhaXRfZm9yX2lkbGUoc3RydWN0IGludGVsX2d0ICpndCkKK3ZvaWQgaW50ZWxfZ3Rfc3VzcGVu
ZF9wcmVwYXJlKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiB7CisJaWYgKCFpbnRlbF9ndF9wbV9pc19h
d2FrZShndCkpCisJCXJldHVybjsKKworCXVzZXJfZm9yY2V3YWtlKGd0LCB0cnVlKTsKKwogCWlm
IChpbnRlbF9ndF93YWl0X2Zvcl9pZGxlKGd0LCBJOTE1X0dFTV9JRExFX1RJTUVPVVQpID09IC1F
VElNRSkgewogCQkvKgogCQkgKiBGb3JjaWJseSBjYW5jZWwgb3V0c3RhbmRpbmcgd29yayBhbmQg
bGVhdmUKQEAgLTI0NywxOCArMjU0LDI5IEBAIHN0YXRpYyB2b2lkIHdhaXRfZm9yX2lkbGUoc3Ry
dWN0IGludGVsX2d0ICpndCkKIAl9CiAKIAlpbnRlbF9ndF9wbV93YWl0X2Zvcl9pZGxlKGd0KTsK
KworCWludGVsX3VjX3N1c3BlbmQoJmd0LT51Yyk7CiB9CiAKLXZvaWQgaW50ZWxfZ3Rfc3VzcGVu
ZChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQordm9pZCBpbnRlbF9ndF9zdXNwZW5kX2xhdGUoc3RydWN0
IGludGVsX2d0ICpndCkKIHsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAotCXVzZXJfZm9y
Y2V3YWtlKGd0LCB0cnVlKTsKLQogCS8qIFdlIGV4cGVjdCB0byBiZSBpZGxlIGFscmVhZHk7IGJ1
dCBhbHNvIHdhbnQgdG8gYmUgaW5kZXBlbmRlbnQgKi8KLQl3YWl0X2Zvcl9pZGxlKGd0KTsKKwlp
bnRlbF9ndF9zdXNwZW5kX3ByZXBhcmUoZ3QpOwogCi0JaW50ZWxfdWNfc3VzcGVuZCgmZ3QtPnVj
KTsKKwkvKgorCSAqIE9uIGRpc2FibGluZyB0aGUgZGV2aWNlLCB3ZSB3YW50IHRvIHR1cm4gb2Zm
IEhXIGFjY2VzcyB0byBtZW1vcnkKKwkgKiB0aGF0IHdlIG5vIGxvbmdlciBvd24uCisJICoKKwkg
KiBIb3dldmVyLCBub3QgYWxsIHN1c3BlbmQtc3RhdGVzIGRpc2FibGUgdGhlIGRldmljZS4gUzAg
KHMyaWRsZSkKKwkgKiBpcyBlZmZlY3RpdmVseSBydW50aW1lLXN1c3BlbmQsIHRoZSBkZXZpY2Ug
aXMgbGVmdCBwb3dlcmVkIG9uCisJICogYnV0IG5lZWRzIHRvIGJlIHB1dCBpbnRvIGEgbG93IHBv
d2VyIHN0YXRlLiBXZSBuZWVkIHRvIGtlZXAKKwkgKiBwb3dlcm1hbmFnZW1lbnQgZW5hYmxlZCwg
YnV0IHdlIGFsc28gcmV0YWluIHN5c3RlbSBzdGF0ZSBhbmQgc28KKwkgKiBpdCByZW1haW5zIHNh
ZmUgdG8ga2VlcCBvbiB1c2luZyBvdXIgYWxsb2NhdGVkIG1lbW9yeS4KKwkgKi8KKwlpZiAocG1f
c3VzcGVuZF90YXJnZXRfc3RhdGUgPT0gUE1fU1VTUEVORF9UT19JRExFKQorCQlyZXR1cm47CiAK
IAl3aXRoX2ludGVsX3J1bnRpbWVfcG0oZ3QtPnVuY29yZS0+cnBtLCB3YWtlcmVmKSB7CiAJCWlu
dGVsX3Jwc19kaXNhYmxlKCZndC0+cnBzKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2d0X3BtLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9w
bS5oCmluZGV4IGQ5MjRjOTg0Yzc0ZC4uYjNlMTczOTliZTliIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX2d0X3BtLmgKQEAgLTQzLDggKzQzLDkgQEAgdm9pZCBpbnRlbF9ndF9wbV9maW5p
KHN0cnVjdCBpbnRlbF9ndCAqZ3QpOwogCiB2b2lkIGludGVsX2d0X3Nhbml0aXplKHN0cnVjdCBp
bnRlbF9ndCAqZ3QsIGJvb2wgZm9yY2UpOwogCit2b2lkIGludGVsX2d0X3N1c3BlbmRfcHJlcGFy
ZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0KTsKK3ZvaWQgaW50ZWxfZ3Rfc3VzcGVuZF9sYXRlKHN0cnVj
dCBpbnRlbF9ndCAqZ3QpOwogaW50IGludGVsX2d0X3Jlc3VtZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0
KTsKLXZvaWQgaW50ZWxfZ3Rfc3VzcGVuZChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KTsKIAogdm9pZCBp
bnRlbF9ndF9ydW50aW1lX3N1c3BlbmQoc3RydWN0IGludGVsX2d0ICpndCk7CiBpbnQgaW50ZWxf
Z3RfcnVudGltZV9yZXN1bWUoc3RydWN0IGludGVsX2d0ICpndCk7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yYzYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX3JjNi5jCmluZGV4IDcwZjBlMDFhMzhiOS4uNWFkNGE5MmE5NTgyIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yYzYuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9yYzYuYwpAQCAtNTI1LDYgKzUyNSwxMSBAQCB2b2lkIGludGVsX3Jj
Nl9pbml0KHN0cnVjdCBpbnRlbF9yYzYgKnJjNikKIAogdm9pZCBpbnRlbF9yYzZfc2FuaXRpemUo
c3RydWN0IGludGVsX3JjNiAqcmM2KQogeworCWlmIChyYzYtPmVuYWJsZWQpIHsgLyogdW5iYWxh
bmNlZCBzdXNwZW5kL3Jlc3VtZSAqLworCQlycG1fZ2V0KHJjNik7CisJCXJjNi0+ZW5hYmxlZCA9
IGZhbHNlOworCX0KKwogCWlmIChyYzYtPnN1cHBvcnRlZCkKIAkJX19pbnRlbF9yYzZfZGlzYWJs
ZShyYzYpOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
Z3RfcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2d0X3BtLmMKaW5kZXgg
NWQ0MjkwMzdjZGFkLi4zZDRlNmEwMDhhZjggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X2d0X3BtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfZ3RfcG0uYwpAQCAtMTUsNyArMTUsNyBAQCBzdGF0aWMgaW50IGxpdmVfZ3RfcmVzdW1l
KHZvaWQgKmFyZykKIAogCS8qIERvIHNldmVyYWwgc3VzcGVuZC9yZXN1bWUgY3ljbGVzIHRvIGNo
ZWNrIHdlIGRvbid0IGV4cGxvZGUhICovCiAJZG8gewotCQlpbnRlbF9ndF9zdXNwZW5kKGd0KTsK
KwkJaW50ZWxfZ3Rfc3VzcGVuZF9sYXRlKGd0KTsKIAogCQlpZiAoZ3QtPnJjNi5lbmFibGVkKSB7
CiAJCQlwcl9lcnIoInJjNiBzdGlsbCBlbmFibGVkIGFmdGVyIHN1c3BlbmQhXG4iKTsKLS0gCjIu
MjQuMC5yYzEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
CkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpo
dHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

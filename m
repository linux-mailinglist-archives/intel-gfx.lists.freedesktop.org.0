Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 613F08C138
	for <lists+intel-gfx@lfdr.de>; Tue, 13 Aug 2019 21:07:25 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3CCC36E229;
	Tue, 13 Aug 2019 19:07:23 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id D32016E229
 for <intel-gfx@lists.freedesktop.org>; Tue, 13 Aug 2019 19:07:21 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18024034-1500050 
 for multiple; Tue, 13 Aug 2019 20:07:06 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 13 Aug 2019 20:07:05 +0100
Message-Id: <20190813190705.23869-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190813145138.22057-1-chris@chris-wilson.co.uk>
References: <20190813145138.22057-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v3] drm/i915: Push the wakeref->count deferral
 to the backend
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SWYgdGhlIGJhY2tlbmQgd2lzaGVzIHRvIGRlZmVyIHRoZSB3YWtlcmVmIHBhcmtpbmcsIG1ha2Ug
aXQgcmVzcG9uc2libGUKZm9yIHVubG9ja2luZyB0aGUgd2FrZXJlZiAoaS5lLiBidW1waW5nIHRo
ZSBjb3VudGVyKS4gVGhpcyBhbGxvd3MgaXQgdG8KdGltZSB0aGUgdW5sb2NrIG11Y2ggbW9yZSBj
YXJlZnVsbHkgaW4gY2FzZSBpdCBoYXBwZW5zIHRvIG5lZWRzIHRoZQp3YWtlcmVmIHRvIGJlIGFj
dGl2ZSBkdXJpbmcgaXRzIGRlZmVycmFsLgoKRm9yIGluc3RhbmNlLCBkdXJpbmcgZW5naW5lIHBh
cmtpbmcgd2UgbWF5IGNob29zZSB0byBlbWl0IGFuIGlkbGUKYmFycmllciAoYSByZXF1ZXN0KS4g
VG8gZG8gc28sIHdlIGJvcnJvdyB0aGUgZW5naW5lLT5rZXJuZWxfY29udGV4dAp0aW1lbGluZSBh
bmQgdG8gZW5zdXJlIGV4Y2x1c2l2ZSBhY2Nlc3Mgd2Uga2VlcCB0aGUKZW5naW5lLT53YWtlcmVm
LmNvdW50IGFzIDAuIEhvd2V2ZXIsIHRvIHN1Ym1pdCB0aGF0IHJlcXVlc3QgdG8gSFcgbWF5CnJl
cXVpcmUgYSBpbnRlbF9lbmdpbmVfcG1fZ2V0KCkgKGUuZy4gdG8ga2VlcCB0aGUgc3VibWlzc2lv
biB0YXNrbGV0CmFsaXZlKSBhbmQgYmVmb3JlIHdlIGFsbG93IHRoYXQgd2UgaGF2ZSB0byByZXdh
a2Ugb3VyIHdha2VyZWYgdG8gYXZvaWQgYQpyZWN1cnNpdmUgZGVhZGxvY2suCgo8ND4gWzI1Ny43
NDI5MTZdIElSUXMgbm90IGVuYWJsZWQgYXMgZXhwZWN0ZWQKPDQ+IFsyNTcuNzQyOTMwXSBXQVJO
SU5HOiBDUFU6IDAgUElEOiAwIGF0IGtlcm5lbC9zb2Z0aXJxLmM6MTY5IF9fbG9jYWxfYmhfZW5h
YmxlX2lwKzB4YTkvMHgxMDAKPDQ+IFsyNTcuNzQyOTM2XSBNb2R1bGVzIGxpbmtlZCBpbjogdmdl
bSBzbmRfaGRhX2NvZGVjX2hkbWkgc25kX2hkYV9jb2RlY19yZWFsdGVrIHNuZF9oZGFfY29kZWNf
Z2VuZXJpYyBpOTE1IGJ0dXNiIGJ0cnRsIGJ0YmNtIGJ0aW50ZWwgc25kX2hkYV9pbnRlbCBzbmRf
aW50ZWxfbmhsdCBibHVldG9vdGggc25kX2hkYV9jb2RlYyBjb3JldGVtcCBzbmRfaHdkZXAgY3Jj
dDEwZGlmX3BjbG11bCBzbmRfaGRhX2NvcmUgY3JjMzJfcGNsbXVsIGVjZGhfZ2VuZXJpYyBlY2Mg
Z2hhc2hfY2xtdWxuaV9pbnRlbCBzbmRfcGNtIHI4MTY5IHJlYWx0ZWsgbHBjX2ljaCBwcmltZV9u
dW1iZXJzIGkyY19oaWQKPDQ+IFsyNTcuNzQyOTkxXSBDUFU6IDAgUElEOiAwIENvbW06IHN3YXBw
ZXIvMCBUYWludGVkOiBHICAgICBVICBXICAgICAgICAgNS4zLjAtcmMzLWc1ZDBhMDZjZDUzMmMt
ZHJtdGlwXzM0MCsgIzEKPDQ+IFsyNTcuNzQyOTk4XSBIYXJkd2FyZSBuYW1lOiBHSUdBQllURSBH
Qi1CWEJULTE5MDAvTVpCQVlBQi0wMCwgQklPUyBGNiAwMi8xNy8yMDE1Cjw0PiBbMjU3Ljc0MzAw
OF0gUklQOiAwMDEwOl9fbG9jYWxfYmhfZW5hYmxlX2lwKzB4YTkvMHgxMDAKPDQ+IFsyNTcuNzQz
MDE3XSBDb2RlOiAzNyA1YiA1ZCBjMyA4YiA4MCA1MCAwOCAwMCAwMCA4NSBjMCA3NSBhOSA4MCAz
ZCAwYiBiZSAyNSAwMSAwMCA3NSBhMCA0OCBjNyBjNyBmMyAwYyAwNiBhYyBjNiAwNSBmYiBiZCAy
NSAwMSAwMSBlOCA3NyA4NCBmZiBmZiA8MGY+IDBiIGViIDg5IDQ4IDg5IGVmIGU4IDNiIDQxIDA2
IDAwIGViIDk4IGU4IGU0IDVjIGY0IGZmIDViIDVkIGMzCjw0PiBbMjU3Ljc0MzAyNV0gUlNQOiAw
MDE4OmZmZmZhNzg2MDAwMDNjYjggRUZMQUdTOiAwMDAxMDA4Ngo8ND4gWzI1Ny43NDMwMzVdIFJB
WDogMDAwMDAwMDAwMDAwMDAwMCBSQlg6IDAwMDAwMDAwMDAwMDAyMDAgUkNYOiAwMDAwMDAwMDAw
MDEwMzAyCjw0PiBbMjU3Ljc0MzA0Ml0gUkRYOiAwMDAwMDAwMDgwMDEwMzAyIFJTSTogMDAwMDAw
MDAwMDAwMDAwMCBSREk6IDAwMDAwMDAwZmZmZmZmZmYKPDQ+IFsyNTcuNzQzMDUwXSBSQlA6IGZm
ZmZmZmZmYzA0OTRiYjMgUjA4OiAwMDAwMDAwMDAwMDAwMDAwIFIwOTogMDAwMDAwMDAwMDAwMDAw
MQo8ND4gWzI1Ny43NDMwNThdIFIxMDogMDAwMDAwMDAxNGM4ZjBlOSBSMTE6IDAwMDAwMDAwZmVl
MmZmOGUgUjEyOiBmZmZmYTIzYmE4YzM4MDA4Cjw0PiBbMjU3Ljc0MzA2NV0gUjEzOiBmZmZmYTIz
YmFjYzU3OWMwIFIxNDogZmZmZmEyM2JiN2RiMGY2MCBSMTU6IGZmZmZhMjNiOWNjOGM0MzAKPDQ+
IFsyNTcuNzQzMDc0XSBGUzogIDAwMDAwMDAwMDAwMDAwMDAoMDAwMCkgR1M6ZmZmZmEyM2JiYmEw
MDAwMCgwMDAwKSBrbmxHUzowMDAwMDAwMDAwMDAwMDAwCjw0PiBbMjU3Ljc0MzA4Ml0gQ1M6ICAw
MDEwIERTOiAwMDAwIEVTOiAwMDAwIENSMDogMDAwMDAwMDA4MDA1MDAzMwo8ND4gWzI1Ny43NDMw
ODldIENSMjogMDAwMDdmZTQ3N2IyMDc3OCBDUjM6IDAwMDAwMDAxMWY3MmEwMDAgQ1I0OiAwMDAw
MDAwMDAwMTAwNmYwCjw0PiBbMjU3Ljc0MzA5Nl0gQ2FsbCBUcmFjZToKPDQ+IFsyNTcuNzQzMTA0
XSAgPElSUT4KPDQ+IFsyNTcuNzQzMjY1XSAgX19pOTE1X3JlcXVlc3RfY29tbWl0KzB4MjQwLzB4
NWQwIFtpOTE1XQo8ND4gWzI1Ny43NDM0MjddICA/IF9faTkxNV9yZXF1ZXN0X2NyZWF0ZSsweDIy
OC8weDRjMCBbaTkxNV0KPDQ+IFsyNTcuNzQzNTg0XSAgX19lbmdpbmVfcGFyaysweDY0LzB4MjUw
IFtpOTE1XQo8ND4gWzI1Ny43NDM3MzBdICBfX19faW50ZWxfd2FrZXJlZl9wdXRfbGFzdCsweDFj
LzB4NzAgW2k5MTVdCjw0PiBbMjU3Ljc0Mzg3OF0gIGk5MTVfc2FtcGxlKzB4MmVlLzB4MzEwIFtp
OTE1XQo8ND4gWzI1Ny43NDQwMzBdICA/IGk5MTVfcG11X2NwdV9vZmZsaW5lKzB4YjAvMHhiMCBb
aTkxNV0KPDQ+IFsyNTcuNzQ0MDQwXSAgX19ocnRpbWVyX3J1bl9xdWV1ZXMrMHgxMWUvMHg0YjAK
PDQ+IFsyNTcuNzQ0MDY4XSAgaHJ0aW1lcl9pbnRlcnJ1cHQrMHhlYS8weDI1MAo8ND4gWzI1Ny43
NDQwNzldICA/IGxvY2tkZXBfaGFyZGlycXNfb2ZmKzB4NzkvMHhkMAo8ND4gWzI1Ny43NDQxMDFd
ICBzbXBfYXBpY190aW1lcl9pbnRlcnJ1cHQrMHg5Ni8weDI4MAo8ND4gWzI1Ny43NDQxMTRdICBh
cGljX3RpbWVyX2ludGVycnVwdCsweGYvMHgyMAo8ND4gWzI1Ny43NDQxMjVdIFJJUDogMDAxMDpf
X2RvX3NvZnRpcnErMHhiMy8weDRhZQoKdjI6IEtlZXAgdGhlIHByaW9yaXR5X2hpbnQgYXNzZXJ0
CnYzOiBUaGF0IGFzc2VydCB3YXMgZGVzcGVyYXRlbHkgdHJ5aW5nIHRvIHBvaW50IG91dCBteSBi
dWcuIFNvcnJ5LCBsaXR0bGUKYXNzZXJ0LgoKQnVnemlsbGE6IGh0dHBzOi8vYnVncy5mcmVlZGVz
a3RvcC5vcmcvc2hvd19idWcuY2dpP2lkPTExMTM3OApTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxz
b24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IERhbmllbGUgQ2VyYW9sbyBTcHVyaW8g
PGRhbmllbGUuY2VyYW9sb3NwdXJpb0BpbnRlbC5jb20+CkNjOiBNaWthIEt1b3BwYWxhIDxtaWth
Lmt1b3BwYWxhQGxpbnV4LmludGVsLmNvbT4KUmV2aWV3ZWQtYnk6IE1pa2EgS3VvcHBhbGEgPG1p
a2Eua3VvcHBhbGFAbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2VuZ2luZV9wbS5jICB8ICA4ICsrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9w
cmlvbGlzdF90eXBlcy5oIHwgMjUgKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
cmVxdWVzdC5jICAgICAgICB8IDY2ICsrKysrKysrKysrKy0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5oICAgICAgICB8ICAyICsKIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfc2NoZWR1bGVyLmMgICAgICB8ICAzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF93YWtlcmVmLmMgICAgICAgfCAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
d2FrZXJlZi5oICAgICAgIHwgMTEgKysrKwogNyBmaWxlcyBjaGFuZ2VkLCA3MCBpbnNlcnRpb25z
KCspLCA0OSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9lbmdpbmVfcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2lu
ZV9wbS5jCmluZGV4IDZiMTVlMzMzNWRkNi4uNDlhZDAyYzM3MjBmIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYwpAQCAtNjgsMTAgKzY4LDE2IEBAIHN0YXRpYyBi
b29sIHN3aXRjaF90b19rZXJuZWxfY29udGV4dChzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmUpCiAKIAkvKiBDaGVjayBhZ2FpbiBvbiB0aGUgbmV4dCByZXRpcmVtZW50LiAqLwogCWVuZ2lu
ZS0+d2FrZXJlZl9zZXJpYWwgPSBlbmdpbmUtPnNlcmlhbCArIDE7Ci0KIAlpOTE1X3JlcXVlc3Rf
YWRkX2FjdGl2ZV9iYXJyaWVycyhycSk7CisKKwkvKiBJbnN0YWxsIG91cnNlbHZlcyBhcyBhIHBy
ZWVtcHRpb24gYmFycmllciAqLworCXJxLT5zY2hlZC5hdHRyLnByaW9yaXR5ID0gSTkxNV9QUklP
UklUWV9VTlBSRUVNUFRBQkxFOwogCV9faTkxNV9yZXF1ZXN0X2NvbW1pdChycSk7CiAKKwkvKiBS
ZWxlYXNlIG91ciBleGNsdXNpdmUgaG9sZCBvbiB0aGUgZW5naW5lICovCisJX19pbnRlbF93YWtl
cmVmX2RlZmVyX3BhcmsoJmVuZ2luZS0+d2FrZXJlZik7CisJX19pOTE1X3JlcXVlc3RfcXVldWUo
cnEsIE5VTEwpOworCiAJcmV0dXJuIGZhbHNlOwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3ByaW9saXN0X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3ByaW9saXN0X3R5cGVzLmgKaW5kZXggYjAyZGVhMTdkY2FiLi4yMTAzN2EyZTIwMzggMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcHJpb2xpc3RfdHlwZXMuaAorKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ByaW9saXN0X3R5cGVzLmgKQEAgLTE2LDE4ICsx
Niw2IEBAIGVudW0gewogCUk5MTVfUFJJT1JJVFlfTUlOID0gSTkxNV9DT05URVhUX01JTl9VU0VS
X1BSSU9SSVRZIC0gMSwKIAlJOTE1X1BSSU9SSVRZX05PUk1BTCA9IEk5MTVfQ09OVEVYVF9ERUZB
VUxUX1BSSU9SSVRZLAogCUk5MTVfUFJJT1JJVFlfTUFYID0gSTkxNV9DT05URVhUX01BWF9VU0VS
X1BSSU9SSVRZICsgMSwKLQotCS8qCi0JICogUmVxdWVzdHMgY29udGFpbmluZyBwZXJmb3JtYW5j
ZSBxdWVyaWVzIG11c3Qgbm90IGJlIHByZWVtcHRlZCBieQotCSAqIGFub3RoZXIgY29udGV4dC4g
VGhleSBnZXQgc2NoZWR1bGVkIHdpdGggdGhlaXIgZGVmYXVsdCBwcmlvcml0eSBhbmQKLQkgKiBv
bmNlIHRoZXkgcmVhY2ggdGhlIGV4ZWNsaXN0IHBvcnRzIHdlIGVuc3VyZSB0aGF0IHRoZXkgc3Rp
Y2sgb24gdGhlCi0JICogSFcgdW50aWwgZmluaXNoZWQgYnkgcHJldGVuZGluZyB0aGF0IHRoZXkg
aGF2ZSBtYXhpbXVtIHByaW9yaXR5LAotCSAqIGkuZS4gbm90aGluZyBjYW4gaGF2ZSBoaWdoZXIg
cHJpb3JpdHkgYW5kIGZvcmNlIHVzIHRvIHVzdXJwIHRoZQotCSAqIGFjdGl2ZSByZXF1ZXN0Lgot
CSAqLwotCUk5MTVfUFJJT1JJVFlfVU5QUkVFTVBUQUJMRSA9IElOVF9NQVgsCi0KLQlJOTE1X1BS
SU9SSVRZX0lOVkFMSUQgPSBJTlRfTUlOCiB9OwogCiAjZGVmaW5lIEk5MTVfVVNFUl9QUklPUklU
WV9TSElGVCAyCkBAIC0zOSw2ICsyNywxOSBAQCBlbnVtIHsKICNkZWZpbmUgSTkxNV9QUklPUklU
WV9XQUlUCQkoKHU4KUJJVCgwKSkKICNkZWZpbmUgSTkxNV9QUklPUklUWV9OT1NFTUFQSE9SRQko
KHU4KUJJVCgxKSkKIAorLyogU21hbGxlc3QgcHJpb3JpdHkgdmFsdWUgdGhhdCBjYW5ub3QgYmUg
YnVtcGVkLiAqLworI2RlZmluZSBJOTE1X1BSSU9SSVRZX0lOVkFMSUQgKElOVF9NSU4gfCAodTgp
STkxNV9QUklPUklUWV9NQVNLKQorCisvKgorICogUmVxdWVzdHMgY29udGFpbmluZyBwZXJmb3Jt
YW5jZSBxdWVyaWVzIG11c3Qgbm90IGJlIHByZWVtcHRlZCBieQorICogYW5vdGhlciBjb250ZXh0
LiBUaGV5IGdldCBzY2hlZHVsZWQgd2l0aCB0aGVpciBkZWZhdWx0IHByaW9yaXR5IGFuZAorICog
b25jZSB0aGV5IHJlYWNoIHRoZSBleGVjbGlzdCBwb3J0cyB3ZSBlbnN1cmUgdGhhdCB0aGV5IHN0
aWNrIG9uIHRoZQorICogSFcgdW50aWwgZmluaXNoZWQgYnkgcHJldGVuZGluZyB0aGF0IHRoZXkg
aGF2ZSBtYXhpbXVtIHByaW9yaXR5LAorICogaS5lLiBub3RoaW5nIGNhbiBoYXZlIGhpZ2hlciBw
cmlvcml0eSBhbmQgZm9yY2UgdXMgdG8gdXN1cnAgdGhlCisgKiBhY3RpdmUgcmVxdWVzdC4KKyAq
LworI2RlZmluZSBJOTE1X1BSSU9SSVRZX1VOUFJFRU1QVEFCTEUgSU5UX01BWAorCiAjZGVmaW5l
IF9fTk9fUFJFRU1QVElPTiAoSTkxNV9QUklPUklUWV9XQUlUKQogCiBzdHJ1Y3QgaTkxNV9wcmlv
bGlzdCB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCmluZGV4IDBlYTExMzZkNDUzZS4u
NDAyMTMzNGRkMmM1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVl
c3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYwpAQCAtMTE4Niw2
ICsxMTg2LDEyIEBAIHN0cnVjdCBpOTE1X3JlcXVlc3QgKl9faTkxNV9yZXF1ZXN0X2NvbW1pdChz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAkJbGlzdF9hZGQoJnJpbmctPmFjdGl2ZV9saW5rLCAm
cnEtPmk5MTUtPmd0LmFjdGl2ZV9yaW5ncyk7CiAJcnEtPmVtaXR0ZWRfamlmZmllcyA9IGppZmZp
ZXM7CiAKKwlyZXR1cm4gcHJldjsKK30KKwordm9pZCBfX2k5MTVfcmVxdWVzdF9xdWV1ZShzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycSwKKwkJCSAgY29uc3Qgc3RydWN0IGk5MTVfc2NoZWRfYXR0ciAq
YXR0cikKK3sKIAkvKgogCSAqIExldCB0aGUgYmFja2VuZCBrbm93IGEgbmV3IHJlcXVlc3QgaGFz
IGFycml2ZWQgdGhhdCBtYXkgbmVlZAogCSAqIHRvIGFkanVzdCB0aGUgZXhpc3RpbmcgZXhlY3V0
aW9uIHNjaGVkdWxlIGR1ZSB0byBhIGhpZ2ggcHJpb3JpdHkKQEAgLTExOTksNDMgKzEyMDUsMTUg
QEAgc3RydWN0IGk5MTVfcmVxdWVzdCAqX19pOTE1X3JlcXVlc3RfY29tbWl0KHN0cnVjdCBpOTE1
X3JlcXVlc3QgKnJxKQogCSAqLwogCWxvY2FsX2JoX2Rpc2FibGUoKTsKIAlpOTE1X3N3X2ZlbmNl
X2NvbW1pdCgmcnEtPnNlbWFwaG9yZSk7Ci0JaWYgKGVuZ2luZS0+c2NoZWR1bGUpIHsKLQkJc3Ry
dWN0IGk5MTVfc2NoZWRfYXR0ciBhdHRyID0gcnEtPmdlbV9jb250ZXh0LT5zY2hlZDsKLQotCQkv
KgotCQkgKiBCb29zdCBhY3R1YWwgd29ya2xvYWRzIHBhc3Qgc2VtYXBob3JlcyEKLQkJICoKLQkJ
ICogV2l0aCBzZW1hcGhvcmVzIHdlIHNwaW4gb24gb25lIGVuZ2luZSB3YWl0aW5nIGZvciBhbm90
aGVyLAotCQkgKiBzaW1wbHkgdG8gcmVkdWNlIHRoZSBsYXRlbmN5IG9mIHN0YXJ0aW5nIG91ciB3
b3JrIHdoZW4KLQkJICogdGhlIHNpZ25hbGVyIGNvbXBsZXRlcy4gSG93ZXZlciwgaWYgdGhlcmUg
aXMgYW55IG90aGVyCi0JCSAqIHdvcmsgdGhhdCB3ZSBjb3VsZCBiZSBkb2luZyBvbiB0aGlzIGVu
Z2luZSBpbnN0ZWFkLCB0aGF0Ci0JCSAqIGlzIGJldHRlciB1dGlsaXNhdGlvbiBhbmQgd2lsbCBy
ZWR1Y2UgdGhlIG92ZXJhbGwgZHVyYXRpb24KLQkJICogb2YgdGhlIGN1cnJlbnQgd29yay4gVG8g
YXZvaWQgUEkgYm9vc3RpbmcgYSBzZW1hcGhvcmUKLQkJICogZmFyIGluIHRoZSBkaXN0YW5jZSBw
YXN0IG92ZXIgdXNlZnVsIHdvcmssIHdlIGtlZXAgYSBoaXN0b3J5Ci0JCSAqIG9mIGFueSBzZW1h
cGhvcmUgdXNlIGFsb25nIG91ciBkZXBlbmRlbmN5IGNoYWluLgotCQkgKi8KLQkJaWYgKCEocnEt
PnNjaGVkLmZsYWdzICYgSTkxNV9TQ0hFRF9IQVNfU0VNQVBIT1JFX0NIQUlOKSkKLQkJCWF0dHIu
cHJpb3JpdHkgfD0gSTkxNV9QUklPUklUWV9OT1NFTUFQSE9SRTsKLQotCQkvKgotCQkgKiBCb29z
dCBwcmlvcml0aWVzIHRvIG5ldyBjbGllbnRzIChuZXcgcmVxdWVzdCBmbG93cykuCi0JCSAqCi0J
CSAqIEFsbG93IGludGVyYWN0aXZlL3N5bmNocm9ub3VzIGNsaWVudHMgdG8ganVtcCBhaGVhZCBv
ZgotCQkgKiB0aGUgYnVsayBjbGllbnRzLiAoRlFfQ09ERUwpCi0JCSAqLwotCQlpZiAobGlzdF9l
bXB0eSgmcnEtPnNjaGVkLnNpZ25hbGVyc19saXN0KSkKLQkJCWF0dHIucHJpb3JpdHkgfD0gSTkx
NV9QUklPUklUWV9XQUlUOwotCi0JCWVuZ2luZS0+c2NoZWR1bGUocnEsICZhdHRyKTsKLQl9CisJ
aWYgKGF0dHIgJiYgcnEtPmVuZ2luZS0+c2NoZWR1bGUpCisJCXJxLT5lbmdpbmUtPnNjaGVkdWxl
KHJxLCBhdHRyKTsKIAlpOTE1X3N3X2ZlbmNlX2NvbW1pdCgmcnEtPnN1Ym1pdCk7CiAJbG9jYWxf
YmhfZW5hYmxlKCk7IC8qIEtpY2sgdGhlIGV4ZWNsaXN0cyB0YXNrbGV0IGlmIGp1c3Qgc2NoZWR1
bGVkICovCi0KLQlyZXR1cm4gcHJldjsKIH0KIAogdm9pZCBpOTE1X3JlcXVlc3RfYWRkKHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxKQogeworCXN0cnVjdCBpOTE1X3NjaGVkX2F0dHIgYXR0ciA9IHJx
LT5nZW1fY29udGV4dC0+c2NoZWQ7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcHJldjsKIAogCWxv
Y2tkZXBfYXNzZXJ0X2hlbGQoJnJxLT50aW1lbGluZS0+bXV0ZXgpOwpAQCAtMTI0NSw2ICsxMjIz
LDMyIEBAIHZvaWQgaTkxNV9yZXF1ZXN0X2FkZChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAog
CXByZXYgPSBfX2k5MTVfcmVxdWVzdF9jb21taXQocnEpOwogCisJLyoKKwkgKiBCb29zdCBhY3R1
YWwgd29ya2xvYWRzIHBhc3Qgc2VtYXBob3JlcyEKKwkgKgorCSAqIFdpdGggc2VtYXBob3JlcyB3
ZSBzcGluIG9uIG9uZSBlbmdpbmUgd2FpdGluZyBmb3IgYW5vdGhlciwKKwkgKiBzaW1wbHkgdG8g
cmVkdWNlIHRoZSBsYXRlbmN5IG9mIHN0YXJ0aW5nIG91ciB3b3JrIHdoZW4KKwkgKiB0aGUgc2ln
bmFsZXIgY29tcGxldGVzLiBIb3dldmVyLCBpZiB0aGVyZSBpcyBhbnkgb3RoZXIKKwkgKiB3b3Jr
IHRoYXQgd2UgY291bGQgYmUgZG9pbmcgb24gdGhpcyBlbmdpbmUgaW5zdGVhZCwgdGhhdAorCSAq
IGlzIGJldHRlciB1dGlsaXNhdGlvbiBhbmQgd2lsbCByZWR1Y2UgdGhlIG92ZXJhbGwgZHVyYXRp
b24KKwkgKiBvZiB0aGUgY3VycmVudCB3b3JrLiBUbyBhdm9pZCBQSSBib29zdGluZyBhIHNlbWFw
aG9yZQorCSAqIGZhciBpbiB0aGUgZGlzdGFuY2UgcGFzdCBvdmVyIHVzZWZ1bCB3b3JrLCB3ZSBr
ZWVwIGEgaGlzdG9yeQorCSAqIG9mIGFueSBzZW1hcGhvcmUgdXNlIGFsb25nIG91ciBkZXBlbmRl
bmN5IGNoYWluLgorCSAqLworCWlmICghKHJxLT5zY2hlZC5mbGFncyAmIEk5MTVfU0NIRURfSEFT
X1NFTUFQSE9SRV9DSEFJTikpCisJCWF0dHIucHJpb3JpdHkgfD0gSTkxNV9QUklPUklUWV9OT1NF
TUFQSE9SRTsKKworCS8qCisJICogQm9vc3QgcHJpb3JpdGllcyB0byBuZXcgY2xpZW50cyAobmV3
IHJlcXVlc3QgZmxvd3MpLgorCSAqCisJICogQWxsb3cgaW50ZXJhY3RpdmUvc3luY2hyb25vdXMg
Y2xpZW50cyB0byBqdW1wIGFoZWFkIG9mCisJICogdGhlIGJ1bGsgY2xpZW50cy4gKEZRX0NPREVM
KQorCSAqLworCWlmIChsaXN0X2VtcHR5KCZycS0+c2NoZWQuc2lnbmFsZXJzX2xpc3QpKQorCQlh
dHRyLnByaW9yaXR5IHw9IEk5MTVfUFJJT1JJVFlfV0FJVDsKKworCV9faTkxNV9yZXF1ZXN0X3F1
ZXVlKHJxLCAmYXR0cik7CisKIAkvKgogCSAqIEluIHR5cGljYWwgc2NlbmFyaW9zLCB3ZSBkbyBu
b3QgZXhwZWN0IHRoZSBwcmV2aW91cyByZXF1ZXN0IG9uCiAJICogdGhlIHRpbWVsaW5lIHRvIGJl
IHN0aWxsIHRyYWNrZWQgYnkgdGltZWxpbmUtPmxhc3RfcmVxdWVzdCBpZiBpdApkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmggYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3JlcXVlc3QuaAppbmRleCAzMTNkZjNjMzcxNTguLmZlYzFkNWYxN2M5NCAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmgKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmgKQEAgLTI1MSw2ICsyNTEsOCBAQCBzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICogX19tdXN0X2NoZWNrCiBpOTE1X3JlcXVlc3RfY3JlYXRlKHN0cnVjdCBp
bnRlbF9jb250ZXh0ICpjZSk7CiAKIHN0cnVjdCBpOTE1X3JlcXVlc3QgKl9faTkxNV9yZXF1ZXN0
X2NvbW1pdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0KTsKK3ZvaWQgX19pOTE1X3JlcXVl
c3RfcXVldWUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCisJCQkgIGNvbnN0IHN0cnVjdCBpOTE1
X3NjaGVkX2F0dHIgKmF0dHIpOwogCiB2b2lkIGk5MTVfcmVxdWVzdF9yZXRpcmVfdXB0byhzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfc2NoZWR1bGVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5j
CmluZGV4IDBiZDQ1MmU4NTFkOC4uN2I4NGViY2EyOTAxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfc2NoZWR1bGVyLmMKQEAgLTM0OSw4ICszNDksNyBAQCB2b2lkIGk5MTVfc2NoZWR1bGVfYnVt
cF9wcmlvcml0eShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgdW5zaWduZWQgaW50IGJ1bXApCiAJ
dW5zaWduZWQgbG9uZyBmbGFnczsKIAogCUdFTV9CVUdfT04oYnVtcCAmIH5JOTE1X1BSSU9SSVRZ
X01BU0spOwotCi0JaWYgKFJFQURfT05DRShycS0+c2NoZWQuYXR0ci5wcmlvcml0eSkgPT0gSTkx
NV9QUklPUklUWV9JTlZBTElEKQorCWlmIChSRUFEX09OQ0UocnEtPnNjaGVkLmF0dHIucHJpb3Jp
dHkpICYgYnVtcCkKIAkJcmV0dXJuOwogCiAJc3Bpbl9sb2NrX2lycXNhdmUoJnNjaGVkdWxlX2xv
Y2ssIGZsYWdzKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2Vy
ZWYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYuYwppbmRleCBkNDQ0M2U4
MWMxYzguLjg2OGNjNzgwNDhkMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfd2FrZXJlZi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3dha2VyZWYuYwpA
QCAtNTcsMTIgKzU3LDEwIEBAIHN0YXRpYyB2b2lkIF9fX19pbnRlbF93YWtlcmVmX3B1dF9sYXN0
KHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZikKIAlpZiAoIWF0b21pY19kZWNfYW5kX3Rlc3QoJndm
LT5jb3VudCkpCiAJCWdvdG8gdW5sb2NrOwogCisJLyogb3BzLT5wdXQoKSBtdXN0IHJlc2NoZWR1
bGUgaXRzIG93biByZWxlYXNlIG9uIGVycm9yL2RlZmVycmFsICovCiAJaWYgKGxpa2VseSghd2Yt
Pm9wcy0+cHV0KHdmKSkpIHsKIAkJcnBtX3B1dCh3Zik7CiAJCXdha2VfdXBfdmFyKCZ3Zi0+d2Fr
ZXJlZik7Ci0JfSBlbHNlIHsKLQkJLyogb3BzLT5wdXQoKSBtdXN0IHNjaGVkdWxlIGl0cyBvd24g
cmVsZWFzZSBvbiBkZWZlcnJhbCAqLwotCQlhdG9taWNfc2V0X3JlbGVhc2UoJndmLT5jb3VudCwg
MSk7CiAJfQogCiB1bmxvY2s6CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF93YWtlcmVmLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF93YWtlcmVmLmgKaW5kZXgg
NTM1YTNhMTI4NjRiLi41ZjBjOTcyYTgwZmIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2ludGVsX3dha2VyZWYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF93YWtl
cmVmLmgKQEAgLTE2Myw2ICsxNjMsMTcgQEAgaW50ZWxfd2FrZXJlZl9pc19hY3RpdmUoY29uc3Qg
c3RydWN0IGludGVsX3dha2VyZWYgKndmKQogCXJldHVybiBSRUFEX09OQ0Uod2YtPndha2VyZWYp
OwogfQogCisvKioKKyAqIF9faW50ZWxfd2FrZXJlZl9kZWZlcl9wYXJrOiBEZWZlciB0aGUgY3Vy
cmVudCBwYXJrIGNhbGxiYWNrCisgKiBAd2Y6IHRoZSB3YWtlcmVmCisgKi8KK3N0YXRpYyBpbmxp
bmUgdm9pZAorX19pbnRlbF93YWtlcmVmX2RlZmVyX3Bhcmsoc3RydWN0IGludGVsX3dha2VyZWYg
KndmKQoreworCUlOVEVMX1dBS0VSRUZfQlVHX09OKGF0b21pY19yZWFkKCZ3Zi0+Y291bnQpKTsK
KwlhdG9taWNfc2V0X3JlbGVhc2UoJndmLT5jb3VudCwgMSk7Cit9CisKIC8qKgogICogaW50ZWxf
d2FrZXJlZl93YWl0X2Zvcl9pZGxlOiBXYWl0IHVudGlsIHRoZSB3YWtlcmVmIGlzIGlkbGUKICAq
IEB3ZjogdGhlIHdha2VyZWYKLS0gCjIuMjMuMC5yYzEKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

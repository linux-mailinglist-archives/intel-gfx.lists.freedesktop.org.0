Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id EEFBC10E1EF
	for <lists+intel-gfx@lfdr.de>; Sun,  1 Dec 2019 13:49:45 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B876D89DBA;
	Sun,  1 Dec 2019 12:49:43 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AF43889DBA
 for <intel-gfx@lists.freedesktop.org>; Sun,  1 Dec 2019 12:49:42 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19414713-1500050 
 for multiple; Sun, 01 Dec 2019 12:49:35 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sun,  1 Dec 2019 12:49:35 +0000
Message-Id: <20191201124935.2047628-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/selftests: Disable heartbeats around
 long queues
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Rm9yIHNvbWUgZXhlY2xpc3RzIHNjaGVkdWxlciB0ZXN0cyB3ZSBhc3N1bWUgdmVyeSBwcmVjaXNl
IGxheW91dCBvZiB0aGUKaW5mbGlnaHQgcXVldWUgYW5kIGJlY29tZSBhbmdyeSBpZiB0aGUgaGVh
cnRiZWF0IGludGVyZmVyZXMgYnkKcmVwcmlvcml0aXNpbmcgb3VyIGNvbnRleHRzIChiZWNhdXNl
IHdlIGhhcHBlbiB0byBiZSB1c2luZyB0aGUgc2FtZQplbmdpbmUtPmtlcm5lbF9jb250ZXh0IGZv
ciBvdXIgdGVzdCkuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdp
bHNvbi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYyB8
IDQ0ICsrKysrKysrKysrKysrKysrKysrKy0tLS0tCiAxIGZpbGUgY2hhbmdlZCwgMzYgaW5zZXJ0
aW9ucygrKSwgOCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF9scmMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xy
Yy5jCmluZGV4IGFjOGI5MTE2ZDMwNy4uYjk5ZTQ2YzBlMzViIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF9scmMuYwpAQCAtNTAsNiArNTAsMjUgQEAgc3RhdGljIHN0cnVjdCBpOTE1
X3ZtYSAqY3JlYXRlX3NjcmF0Y2goc3RydWN0IGludGVsX2d0ICpndCkKIAlyZXR1cm4gdm1hOwog
fQogCitzdGF0aWMgdm9pZCBlbmdpbmVfaGVhcnRiZWF0X3NhdmUoc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lLAorCQkJCSAgdW5zaWduZWQgbG9uZyAqc2F2ZWQpCit7CisJaW50ZWxfZW5n
aW5lX3BtX2dldChlbmdpbmUpOworCisJKnNhdmVkID0gZW5naW5lLT5wcm9wcy5oZWFydGJlYXRf
aW50ZXJ2YWxfbXM7CisJZW5naW5lLT5wcm9wcy5oZWFydGJlYXRfaW50ZXJ2YWxfbXMgPSAwOwor
CisJZmx1c2hfZGVsYXllZF93b3JrKCZlbmdpbmUtPmhlYXJ0YmVhdC53b3JrKTsKK30KKworc3Rh
dGljIHZvaWQgZW5naW5lX2hlYXJ0YmVhdF9yZXN0b3JlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZSwKKwkJCQkgICAgIHVuc2lnbmVkIGxvbmcgc2F2ZWQpCit7CisJZW5naW5lLT5wcm9w
cy5oZWFydGJlYXRfaW50ZXJ2YWxfbXMgPSBzYXZlZDsKKworCWludGVsX2VuZ2luZV9wbV9wdXQo
ZW5naW5lKTsKK30KKwogc3RhdGljIGludCBsaXZlX3Nhbml0eWNoZWNrKHZvaWQgKmFyZykKIHsK
IAlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwpAQCAtMTI4LDYgKzE0Nyw3IEBAIHN0YXRpYyBp
bnQgbGl2ZV91bmxpdGVfcmVzdG9yZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBpbnQgcHJpbykKIAkJ
c3RydWN0IGludGVsX2NvbnRleHQgKmNlWzJdID0ge307CiAJCXN0cnVjdCBpOTE1X3JlcXVlc3Qg
KnJxWzJdOwogCQlzdHJ1Y3QgaWd0X2xpdmVfdGVzdCB0OworCQl1bnNpZ25lZCBsb25nIHNhdmVk
OwogCQlpbnQgbjsKIAogCQlpZiAocHJpbyAmJiAhaW50ZWxfZW5naW5lX2hhc19wcmVlbXB0aW9u
KGVuZ2luZSkpCkBAIC0xNDEsNiArMTYxLDggQEAgc3RhdGljIGludCBsaXZlX3VubGl0ZV9yZXN0
b3JlKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIGludCBwcmlvKQogCQkJYnJlYWs7CiAJCX0KIAorCQll
bmdpbmVfaGVhcnRiZWF0X3NhdmUoZW5naW5lLCAmc2F2ZWQpOworCiAJCWZvciAobiA9IDA7IG4g
PCBBUlJBWV9TSVpFKGNlKTsgbisrKSB7CiAJCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqdG1wOwog
CkBAIC0yNDcsNiArMjY5LDcgQEAgc3RhdGljIGludCBsaXZlX3VubGl0ZV9yZXN0b3JlKHN0cnVj
dCBpbnRlbF9ndCAqZ3QsIGludCBwcmlvKQogCQkJaW50ZWxfY29udGV4dF9wdXQoY2Vbbl0pOwog
CQl9CiAKKwkJZW5naW5lX2hlYXJ0YmVhdF9yZXN0b3JlKGVuZ2luZSwgc2F2ZWQpOwogCQlpZiAo
aWd0X2xpdmVfdGVzdF9lbmQoJnQpKQogCQkJZXJyID0gLUVJTzsKIAkJaWYgKGVycikKQEAgLTQ2
OCwxNSArNDkxLDE5IEBAIHN0YXRpYyBpbnQgbGl2ZV90aW1lc2xpY2VfcHJlZW1wdCh2b2lkICph
cmcpCiAJCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwogCiAJCWZvcl9lYWNoX2VuZ2luZShlbmdp
bmUsIGd0LCBpZCkgeworCQkJdW5zaWduZWQgbG9uZyBzYXZlZDsKKwogCQkJaWYgKCFpbnRlbF9l
bmdpbmVfaGFzX3ByZWVtcHRpb24oZW5naW5lKSkKIAkJCQljb250aW51ZTsKIAorCQkJZW5naW5l
X2hlYXJ0YmVhdF9zYXZlKGVuZ2luZSwgJnNhdmVkKTsKIAkJCW1lbXNldCh2YWRkciwgMCwgUEFH
RV9TSVpFKTsKIAogCQkJZXJyID0gc2xpY2Vfc2VtYXBob3JlX3F1ZXVlKGVuZ2luZSwgdm1hLCBj
b3VudCk7CiAJCQlpZiAoZXJyKQogCQkJCWdvdG8gZXJyX3BpbjsKIAorCQkJZW5naW5lX2hlYXJ0
YmVhdF9yZXN0b3JlKGVuZ2luZSwgc2F2ZWQpOwogCQkJaWYgKGlndF9mbHVzaF90ZXN0KGd0LT5p
OTE1KSkgewogCQkJCWVyciA9IC1FSU87CiAJCQkJZ290byBlcnJfcGluOwpAQCAtNTY2LDE3ICs1
OTMsMTkgQEAgc3RhdGljIGludCBsaXZlX3RpbWVzbGljZV9xdWV1ZSh2b2lkICphcmcpCiAJCQku
cHJpb3JpdHkgPSBJOTE1X1VTRVJfUFJJT1JJVFkoSTkxNV9QUklPUklUWV9NQVgpLAogCQl9Owog
CQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgKm5vcDsKKwkJdW5zaWduZWQgbG9uZyBzYXZlZDsK
IAogCQlpZiAoIWludGVsX2VuZ2luZV9oYXNfcHJlZW1wdGlvbihlbmdpbmUpKQogCQkJY29udGlu
dWU7CiAKKwkJZW5naW5lX2hlYXJ0YmVhdF9zYXZlKGVuZ2luZSwgJnNhdmVkKTsKIAkJbWVtc2V0
KHZhZGRyLCAwLCBQQUdFX1NJWkUpOwogCiAJCS8qIEVMU1BbMF06IHNlbWFwaG9yZSB3YWl0ICov
CiAJCXJxID0gc2VtYXBob3JlX3F1ZXVlKGVuZ2luZSwgdm1hLCAwKTsKIAkJaWYgKElTX0VSUihy
cSkpIHsKIAkJCWVyciA9IFBUUl9FUlIocnEpOwotCQkJZ290byBlcnJfcGluOworCQkJZ290byBl
cnJfaGVhcnRiZWF0OwogCQl9CiAJCWVuZ2luZS0+c2NoZWR1bGUocnEsICZhdHRyKTsKIAkJd2Fp
dF9mb3Jfc3VibWl0KGVuZ2luZSwgcnEpOwpAQCAtNTg1LDggKzYxNCw3IEBAIHN0YXRpYyBpbnQg
bGl2ZV90aW1lc2xpY2VfcXVldWUodm9pZCAqYXJnKQogCQlub3AgPSBub3BfcmVxdWVzdChlbmdp
bmUpOwogCQlpZiAoSVNfRVJSKG5vcCkpIHsKIAkJCWVyciA9IFBUUl9FUlIobm9wKTsKLQkJCWk5
MTVfcmVxdWVzdF9wdXQocnEpOwotCQkJZ290byBlcnJfcGluOworCQkJZ290byBlcnJfcnE7CiAJ
CX0KIAkJd2FpdF9mb3Jfc3VibWl0KGVuZ2luZSwgbm9wKTsKIAkJaTkxNV9yZXF1ZXN0X3B1dChu
b3ApOwpAQCAtNTk2LDEwICs2MjQsOCBAQCBzdGF0aWMgaW50IGxpdmVfdGltZXNsaWNlX3F1ZXVl
KHZvaWQgKmFyZykKIAogCQkvKiBRdWV1ZTogc2VtYXBob3JlIHNpZ25hbCwgbWF0Y2hpbmcgcHJp
b3JpdHkgYXMgc2VtYXBob3JlICovCiAJCWVyciA9IHJlbGVhc2VfcXVldWUoZW5naW5lLCB2bWEs
IDEsIGVmZmVjdGl2ZV9wcmlvKHJxKSk7Ci0JCWlmIChlcnIpIHsKLQkJCWk5MTVfcmVxdWVzdF9w
dXQocnEpOwotCQkJZ290byBlcnJfcGluOwotCQl9CisJCWlmIChlcnIpCisJCQlnb3RvIGVycl9y
cTsKIAogCQlpbnRlbF9lbmdpbmVfZmx1c2hfc3VibWlzc2lvbihlbmdpbmUpOwogCQlpZiAoIVJF
QURfT05DRShlbmdpbmUtPmV4ZWNsaXN0cy50aW1lci5leHBpcmVzKSAmJgpAQCAtNjMwLDEyICs2
NTYsMTQgQEAgc3RhdGljIGludCBsaXZlX3RpbWVzbGljZV9xdWV1ZSh2b2lkICphcmcpCiAJCQlt
ZW1zZXQodmFkZHIsIDB4ZmYsIFBBR0VfU0laRSk7CiAJCQllcnIgPSAtRUlPOwogCQl9CitlcnJf
cnE6CiAJCWk5MTVfcmVxdWVzdF9wdXQocnEpOworZXJyX2hlYXJ0YmVhdDoKKwkJZW5naW5lX2hl
YXJ0YmVhdF9yZXN0b3JlKGVuZ2luZSwgc2F2ZWQpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAJ
fQogCi1lcnJfcGluOgogCWk5MTVfdm1hX3VucGluKHZtYSk7CiBlcnJfbWFwOgogCWk5MTVfZ2Vt
X29iamVjdF91bnBpbl9tYXAob2JqKTsKLS0gCjIuMjQuMAoKX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1n
ZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21h
aWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

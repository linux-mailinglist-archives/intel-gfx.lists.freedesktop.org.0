Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id A4863277E2
	for <lists+intel-gfx@lfdr.de>; Thu, 23 May 2019 10:24:37 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E8F9389CDB;
	Thu, 23 May 2019 08:24:35 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga14.intel.com (mga14.intel.com [192.55.52.115])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0696A89CDB
 for <intel-gfx@lists.freedesktop.org>; Thu, 23 May 2019 08:24:29 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga001.jf.intel.com ([10.7.209.18])
 by fmsmga103.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 23 May 2019 01:24:29 -0700
X-ExtLoop1: 1
Received: from igivoni-mobl.amr.corp.intel.com (HELO
 ldmartin-desk.amr.corp.intel.com) ([10.255.88.102])
 by orsmga001.jf.intel.com with ESMTP; 23 May 2019 01:24:28 -0700
From: Lucas De Marchi <lucas.demarchi@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 23 May 2019 01:24:17 -0700
Message-Id: <20190523082420.10352-7-lucas.demarchi@intel.com>
X-Mailer: git-send-email 2.21.0
In-Reply-To: <20190523082420.10352-1-lucas.demarchi@intel.com>
References: <20190523082420.10352-1-lucas.demarchi@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 07/10] drm/i915/dmc: add support to load
 dmc_header version 3
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Lucas De Marchi <lucas.demarchi@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TWFpbiBkaWZmZXJlbmNlIGlzIHRoYXQgbm93IHRoZXJlIGFyZSB1cCB0byAyMCBNTUlPcyB0aGF0
IGNhbiBiZSBzZXQgYW5kCmEgbG90IG9mIG5vaXNlIGR1ZSB0byB0aGUgc3RydWN0IGNoYW5naW5n
IHRoZSBmaWVsZHMgaW4gdGhlIG1pZGRsZS4KClNpZ25lZC1vZmYtYnk6IEx1Y2FzIERlIE1hcmNo
aSA8bHVjYXMuZGVtYXJjaGlAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfZHJ2LmggIHwgICA0ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9jc3IuYyB8IDEw
NyArKysrKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tCiAyIGZpbGVzIGNoYW5nZWQsIDgzIGlu
c2VydGlvbnMoKyksIDI4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCmluZGV4
IDFhZDM4MThkMjY3Ni4uMDRhNmI1OTI1NmZkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKQEAg
LTM1NCw4ICszNTQsOCBAQCBzdHJ1Y3QgaW50ZWxfY3NyIHsKIAl1MzIgZG1jX2Z3X3NpemU7IC8q
IGR3b3JkcyAqLwogCXUzMiB2ZXJzaW9uOwogCXUzMiBtbWlvX2NvdW50OwotCWk5MTVfcmVnX3Qg
bW1pb2FkZHJbOF07Ci0JdTMyIG1taW9kYXRhWzhdOworCWk5MTVfcmVnX3QgbW1pb2FkZHJbMjBd
OworCXUzMiBtbWlvZGF0YVsyMF07CiAJdTMyIGRjX3N0YXRlOwogCXUzMiBhbGxvd2VkX2RjX21h
c2s7CiAJaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9jc3IuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX2Nzci5jCmlu
ZGV4IDIwZGQ0YmQ1ZmVhZS4uYWQ0ZWU1NWE4YzVlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9jc3IuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9jc3Iu
YwpAQCAtNzIsNiArNzIsOCBAQCBNT0RVTEVfRklSTVdBUkUoQlhUX0NTUl9QQVRIKTsKICNkZWZp
bmUgQ1NSX0RFRkFVTFRfRldfT0ZGU0VUCQkweEZGRkZGRkZGCiAjZGVmaW5lIFBBQ0tBR0VfTUFY
X0ZXX0lORk9fRU5UUklFUwkyMAogI2RlZmluZSBQQUNLQUdFX1YyX01BWF9GV19JTkZPX0VOVFJJ
RVMJMzIKKyNkZWZpbmUgRE1DX1YxX01BWF9NTUlPX0NPVU5UCQk4CisjZGVmaW5lIERNQ19WM19N
QVhfTU1JT19DT1VOVAkJMjAKIAogc3RydWN0IGludGVsX2Nzc19oZWFkZXIgewogCS8qIDB4MDkg
Zm9yIERNQyAqLwpAQCAtMTQzLDcgKzE0NSw3IEBAIHN0cnVjdCBpbnRlbF9wYWNrYWdlX2hlYWRl
ciB7CiAJdTMyIG51bV9lbnRyaWVzOwogfSBfX3BhY2tlZDsKIAotc3RydWN0IGludGVsX2RtY19o
ZWFkZXIgeworc3RydWN0IGludGVsX2RtY19oZWFkZXJfYmFzZSB7CiAJLyogYWx3YXlzIHZhbHVl
IHdvdWxkIGJlIDB4NDA0MDNFM0UgKi8KIAl1MzIgc2lnbmF0dXJlOwogCkBAIC0xNjQsMjIgKzE2
Niw0NyBAQCBzdHJ1Y3QgaW50ZWxfZG1jX2hlYWRlciB7CiAKIAkvKiBNYWpvciBNaW5vciB2ZXJz
aW9uICovCiAJdTMyIGZ3X3ZlcnNpb247Cit9IF9fcGFja2VkOworCitzdHJ1Y3QgaW50ZWxfZG1j
X2hlYWRlcl92MSB7CisJc3RydWN0IGludGVsX2RtY19oZWFkZXJfYmFzZSBiYXNlOwogCiAJLyog
TnVtYmVyIG9mIHZhbGlkIE1NSU8gY3ljbGVzIHByZXNlbnQuICovCiAJdTMyIG1taW9fY291bnQ7
CiAKIAkvKiBNTUlPIGFkZHJlc3MgKi8KLQl1MzIgbW1pb2FkZHJbOF07CisJdTMyIG1taW9hZGRy
W0RNQ19WMV9NQVhfTU1JT19DT1VOVF07CiAKIAkvKiBNTUlPIGRhdGEgKi8KLQl1MzIgbW1pb2Rh
dGFbOF07CisJdTMyIG1taW9kYXRhW0RNQ19WMV9NQVhfTU1JT19DT1VOVF07CiAKIAkvKiBGVyBm
aWxlbmFtZSAgKi8KLQl1bnNpZ25lZCBjaGFyIGRmaWxlWzMyXTsKKwljaGFyIGRmaWxlWzMyXTsK
IAogCXUzMiByZXNlcnZlZDFbMl07CiB9IF9fcGFja2VkOwogCitzdHJ1Y3QgaW50ZWxfZG1jX2hl
YWRlcl92MyB7CisJc3RydWN0IGludGVsX2RtY19oZWFkZXJfYmFzZSBiYXNlOworCisJLyogRE1D
IFJBTSBzdGFydCBNTUlPIGFkZHJlc3MgKi8KKwl1MzIgc3RhcnRfbW1pb2FkZHI7CisKKwl1MzIg
cmVzZXJ2ZWRbOV07CisKKwkvKiBGVyBmaWxlbmFtZSAqLworCWNoYXIgZGZpbGVbMzJdOworCisJ
LyogTnVtYmVyIG9mIHZhbGlkIE1NSU8gY3ljbGVzIHByZXNlbnQuICovCisJdTMyIG1taW9fY291
bnQ7CisKKwkvKiBNTUlPIGFkZHJlc3MgKi8KKwl1MzIgbW1pb2FkZHJbRE1DX1YzX01BWF9NTUlP
X0NPVU5UXTsKKworCS8qIE1NSU8gZGF0YSAqLworCXUzMiBtbWlvZGF0YVtETUNfVjNfTUFYX01N
SU9fQ09VTlRdOworfSBfX3BhY2tlZDsKKwogc3RydWN0IHN0ZXBwaW5nX2luZm8gewogCWNoYXIg
c3RlcHBpbmc7CiAJY2hhciBzdWJzdGVwcGluZzsKQEAgLTMzMywzNyArMzYwLDY3IEBAIHN0YXRp
YyB1MzIgZmluZF9kbWNfZndfb2Zmc2V0KGNvbnN0IHN0cnVjdCBpbnRlbF9md19pbmZvICpmd19p
bmZvLAogfQogCiBzdGF0aWMgdTMyIHBhcnNlX2Nzcl9md19kbWMoc3RydWN0IGludGVsX2NzciAq
Y3NyLAotCQkJICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9kbWNfaGVhZGVyICpkbWNfaGVhZGVyKQor
CQkJICAgIGNvbnN0IHN0cnVjdCBpbnRlbF9kbWNfaGVhZGVyX2Jhc2UgKmRtY19oZWFkZXIpCiB7
Ci0JdW5zaWduZWQgaW50IGksIHBheWxvYWRfc2l6ZTsKLQl1MzIgcjsKKwl1bnNpZ25lZCBpbnQg
aGVhZGVyX2xlbl9ieXRlcywgZG1jX2hlYWRlcl9zaXplLCBwYXlsb2FkX3NpemUsIGk7CisJY29u
c3QgdTMyICptbWlvYWRkciwgKm1taW9kYXRhOworCXUzMiBtbWlvX2NvdW50LCBtbWlvX2NvdW50
X21heDsKIAl1OCAqcGF5bG9hZDsKIAotCWlmIChzaXplb2Yoc3RydWN0IGludGVsX2RtY19oZWFk
ZXIpICE9IGRtY19oZWFkZXItPmhlYWRlcl9sZW4pIHsKKwlCVUlMRF9CVUdfT04oQVJSQVlfU0la
RShjc3ItPm1taW9hZGRyKSA8IERNQ19WM19NQVhfTU1JT19DT1VOVCB8fAorCQkgICAgIEFSUkFZ
X1NJWkUoY3NyLT5tbWlvYWRkcikgPCBETUNfVjFfTUFYX01NSU9fQ09VTlQpOworCisJLyogQ29w
ZSB3aXRoIHNtYWxsIGRpZmZlcmVuY2VzIGJldHdlZW4gdjEgYW5kIHYzICovCisJaWYgKGRtY19o
ZWFkZXItPmhlYWRlcl92ZXIgPT0gMykgeworCQljb25zdCBzdHJ1Y3QgaW50ZWxfZG1jX2hlYWRl
cl92MyAqdjMgPQorCQkJKGNvbnN0IHN0cnVjdCBpbnRlbF9kbWNfaGVhZGVyX3YzICopZG1jX2hl
YWRlcjsKKworCQltbWlvYWRkciA9IHYzLT5tbWlvYWRkcjsKKwkJbW1pb2RhdGEgPSB2My0+bW1p
b2RhdGE7CisJCW1taW9fY291bnQgPSB2My0+bW1pb19jb3VudDsKKwkJbW1pb19jb3VudF9tYXgg
PSBETUNfVjNfTUFYX01NSU9fQ09VTlQ7CisJCS8qIGhlYWRlcl9sZW4gaXMgaW4gZHdvcmRzICov
CisJCWhlYWRlcl9sZW5fYnl0ZXMgPSBkbWNfaGVhZGVyLT5oZWFkZXJfbGVuICogNDsKKwkJZG1j
X2hlYWRlcl9zaXplID0gc2l6ZW9mKCp2Myk7CisJfSBlbHNlIGlmIChkbWNfaGVhZGVyLT5oZWFk
ZXJfdmVyID09IDEpIHsKKwkJY29uc3Qgc3RydWN0IGludGVsX2RtY19oZWFkZXJfdjEgKnYxID0K
KwkJCShjb25zdCBzdHJ1Y3QgaW50ZWxfZG1jX2hlYWRlcl92MSAqKWRtY19oZWFkZXI7CisKKwkJ
bW1pb2FkZHIgPSB2MS0+bW1pb2FkZHI7CisJCW1taW9kYXRhID0gdjEtPm1taW9kYXRhOworCQlt
bWlvX2NvdW50ID0gdjEtPm1taW9fY291bnQ7CisJCW1taW9fY291bnRfbWF4ID0gRE1DX1YxX01B
WF9NTUlPX0NPVU5UOworCQloZWFkZXJfbGVuX2J5dGVzID0gZG1jX2hlYWRlci0+aGVhZGVyX2xl
bjsKKwkJZG1jX2hlYWRlcl9zaXplID0gc2l6ZW9mKCp2MSk7CisJfSBlbHNlIHsKKwkJRFJNX0VS
Uk9SKCJVbmtub3duIERNQyBmdyBoZWFkZXIgdmVyc2lvbjogJXVcbiIsCisJCQkgIGRtY19oZWFk
ZXItPmhlYWRlcl92ZXIpOworCQlyZXR1cm4gMDsKKwl9CisKKwlpZiAoaGVhZGVyX2xlbl9ieXRl
cyAhPSBkbWNfaGVhZGVyX3NpemUpIHsKIAkJRFJNX0VSUk9SKCJETUMgZmlybXdhcmUgaGFzIHdy
b25nIGRtYyBoZWFkZXIgbGVuZ3RoICIKLQkJCSAgIigldSBieXRlcylcbiIsCi0JCQkgIChkbWNf
aGVhZGVyLT5oZWFkZXJfbGVuKSk7CisJCQkgICIoJXUgYnl0ZXMpXG4iLCBoZWFkZXJfbGVuX2J5
dGVzKTsKIAkJcmV0dXJuIDA7CiAJfQogCiAJLyogQ2FjaGUgdGhlIGRtYyBoZWFkZXIgaW5mby4g
Ki8KLQlpZiAoZG1jX2hlYWRlci0+bW1pb19jb3VudCA+IEFSUkFZX1NJWkUoY3NyLT5tbWlvYWRk
cikpIHsKLQkJRFJNX0VSUk9SKCJETUMgZmlybXdhcmUgaGFzIHdyb25nIG1taW8gY291bnQgJXVc
biIsCi0JCQkgIGRtY19oZWFkZXItPm1taW9fY291bnQpOworCWlmIChtbWlvX2NvdW50ID4gbW1p
b19jb3VudF9tYXgpIHsKKwkJRFJNX0VSUk9SKCJETUMgZmlybXdhcmUgaGFzIHdyb25nIG1taW8g
Y291bnQgJXVcbiIsIG1taW9fY291bnQpOwogCQlyZXR1cm4gMDsKIAl9CiAKLQljc3ItPm1taW9f
Y291bnQgPSBkbWNfaGVhZGVyLT5tbWlvX2NvdW50OwotCWZvciAoaSA9IDA7IGkgPCBkbWNfaGVh
ZGVyLT5tbWlvX2NvdW50OyBpKyspIHsKLQkJaWYgKGRtY19oZWFkZXItPm1taW9hZGRyW2ldIDwg
Q1NSX01NSU9fU1RBUlRfUkFOR0UgfHwKLQkJICAgIGRtY19oZWFkZXItPm1taW9hZGRyW2ldID4g
Q1NSX01NSU9fRU5EX1JBTkdFKSB7CisJZm9yIChpID0gMDsgaSA8IG1taW9fY291bnQ7IGkrKykg
eworCQlpZiAobW1pb2FkZHJbaV0gPCBDU1JfTU1JT19TVEFSVF9SQU5HRSB8fAorCQkgICAgbW1p
b2FkZHJbaV0gPiBDU1JfTU1JT19FTkRfUkFOR0UpIHsKIAkJCURSTV9FUlJPUigiRE1DIGZpcm13
YXJlIGhhcyB3cm9uZyBtbWlvIGFkZHJlc3MgMHgleFxuIiwKLQkJCQkgIGRtY19oZWFkZXItPm1t
aW9hZGRyW2ldKTsKKwkJCQkgIG1taW9hZGRyW2ldKTsKIAkJCXJldHVybiAwOwogCQl9Ci0JCWNz
ci0+bW1pb2FkZHJbaV0gPSBfTU1JTyhkbWNfaGVhZGVyLT5tbWlvYWRkcltpXSk7Ci0JCWNzci0+
bW1pb2RhdGFbaV0gPSBkbWNfaGVhZGVyLT5tbWlvZGF0YVtpXTsKKwkJY3NyLT5tbWlvYWRkcltp
XSA9IF9NTUlPKG1taW9hZGRyW2ldKTsKKwkJY3NyLT5tbWlvZGF0YVtpXSA9IG1taW9kYXRhW2ld
OwogCX0KKwljc3ItPm1taW9fY291bnQgPSBtbWlvX2NvdW50OwogCiAJLyogZndfc2l6ZSBpcyBp
biBkd29yZHMsIHNvIG11bHRpcGxpZWQgYnkgNCB0byBjb252ZXJ0IGludG8gYnl0ZXMuICovCiAJ
cGF5bG9hZF9zaXplID0gZG1jX2hlYWRlci0+Zndfc2l6ZSAqIDQ7CkBAIC0zNzksMTIgKzQzNiwx
MCBAQCBzdGF0aWMgdTMyIHBhcnNlX2Nzcl9md19kbWMoc3RydWN0IGludGVsX2NzciAqY3NyLAog
CQlyZXR1cm4gMDsKIAl9CiAKLQlyID0gc2l6ZW9mKHN0cnVjdCBpbnRlbF9kbWNfaGVhZGVyKTsK
LQlwYXlsb2FkID0gKHU4ICopKGRtY19oZWFkZXIpICsgcjsKKwlwYXlsb2FkID0gKHU4ICopKGRt
Y19oZWFkZXIpICsgaGVhZGVyX2xlbl9ieXRlczsKIAltZW1jcHkoY3NyLT5kbWNfcGF5bG9hZCwg
cGF5bG9hZCwgcGF5bG9hZF9zaXplKTsKLQlyICs9IHBheWxvYWRfc2l6ZTsKIAotCXJldHVybiBy
OworCXJldHVybiBoZWFkZXJfbGVuX2J5dGVzICsgcGF5bG9hZF9zaXplOwogfQogCiBzdGF0aWMg
dTMyCkBAIC00NzAsNyArNTI1LDcgQEAgc3RhdGljIHUzMiAqcGFyc2VfY3NyX2Z3KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIHsKIAlzdHJ1Y3QgaW50ZWxfY3NzX2hlYWRlciAq
Y3NzX2hlYWRlcjsKIAlzdHJ1Y3QgaW50ZWxfcGFja2FnZV9oZWFkZXIgKnBhY2thZ2VfaGVhZGVy
OwotCXN0cnVjdCBpbnRlbF9kbWNfaGVhZGVyICpkbWNfaGVhZGVyOworCXN0cnVjdCBpbnRlbF9k
bWNfaGVhZGVyX2Jhc2UgKmRtY19oZWFkZXI7CiAJc3RydWN0IGludGVsX2NzciAqY3NyID0gJmRl
dl9wcml2LT5jc3I7CiAJY29uc3Qgc3RydWN0IHN0ZXBwaW5nX2luZm8gKnNpID0gaW50ZWxfZ2V0
X3N0ZXBwaW5nX2luZm8oZGV2X3ByaXYpOwogCXUzMiByZWFkY291bnQgPSAwOwpAQCAtNDk2LDcg
KzU1MSw3IEBAIHN0YXRpYyB1MzIgKnBhcnNlX2Nzcl9mdyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCiAJcmVhZGNvdW50ICs9IHI7CiAKIAkvKiBFeHRyYWN0IGRtY19oZWFkZXIg
aW5mb3JtYXRpb24uICovCi0JZG1jX2hlYWRlciA9IChzdHJ1Y3QgaW50ZWxfZG1jX2hlYWRlciAq
KSZmdy0+ZGF0YVtyZWFkY291bnRdOworCWRtY19oZWFkZXIgPSAoc3RydWN0IGludGVsX2RtY19o
ZWFkZXJfYmFzZSAqKSZmdy0+ZGF0YVtyZWFkY291bnRdOwogCXIgPSBwYXJzZV9jc3JfZndfZG1j
KGNzciwgZG1jX2hlYWRlcik7CiAJaWYgKCFyKQogCQlyZXR1cm4gTlVMTDsKLS0gCjIuMjEuMAoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4
IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

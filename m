Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 1AD8EC8731
	for <lists+intel-gfx@lfdr.de>; Wed,  2 Oct 2019 13:22:18 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E0B6D6E93B;
	Wed,  2 Oct 2019 11:22:09 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4F6816E93B
 for <intel-gfx@lists.freedesktop.org>; Wed,  2 Oct 2019 11:21:59 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18692043-1500050 
 for multiple; Wed, 02 Oct 2019 12:20:12 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  2 Oct 2019 12:19:58 +0100
Message-Id: <20191002112000.12280-28-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191002112000.12280-1-chris@chris-wilson.co.uk>
References: <20191002112000.12280-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 28/30] drm/i915/selftests: Drop vestigal
 struct_mutex guards
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2Ugbm8gbG9uZ2VyIG5lZWQgc3RydWN0X211dGV4IHRvIHNlcmlhbGlzZSByZXF1ZXN0IGVtaXNz
aW9uLCBzbyByZW1vdmUKaXQgZnJvbSB0aGUgZ3Qgc2VsZnRlc3RzLgoKU2lnbmVkLW9mZi1ieTog
Q2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+ClJldmlld2VkLWJ5OiBUdnJ0
a28gVXJzdWxpbiA8dHZydGtvLnVyc3VsaW5AaW50ZWwuY29tPgotLS0KIC4uLi9ncHUvZHJtL2k5
MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMgICB8ICAxNSArLQogLi4uL2RybS9pOTE1L2dl
bS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jIHwgICA0IC0KIC4uLi9kcm0vaTkxNS9nZW0v
c2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYyAgICB8ICAgMiAtCiAuLi4vZHJtL2k5MTUvZ2VtL3Nl
bGZ0ZXN0cy9pOTE1X2dlbV9waHlzLmMgICAgfCAgIDIgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Qvc2VsZnRlc3RfbHJjLmMgICAgICAgIHwgMTQ4ICsrKy0tLS0tLS0tLS0tLS0tLQogLi4uL2dw
dS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jICAgIHwgIDExICstCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC91Yy9zZWxmdGVzdF9ndWMuYyAgICAgfCAgIDQgLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2d0dC5jIHwgICAyIC0KIDggZmlsZXMgY2hh
bmdlZCwgMjcgaW5zZXJ0aW9ucygrKSwgMTYxIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMKaW5kZXggZTIwNGU2NTNiNDU5
Li43NWU3MTdmN2JiNWEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxm
dGVzdHMvaHVnZV9wYWdlcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVz
dHMvaHVnZV9wYWdlcy5jCkBAIC0xNjMzLDcgKzE2MzMsNiBAQCBpbnQgaTkxNV9nZW1faHVnZV9w
YWdlX21vY2tfc2VsZnRlc3RzKHZvaWQpCiAJbWt3cml0ZV9kZXZpY2VfaW5mbyhkZXZfcHJpdikt
PnBwZ3R0X3R5cGUgPSBJTlRFTF9QUEdUVF9GVUxMOwogCW1rd3JpdGVfZGV2aWNlX2luZm8oZGV2
X3ByaXYpLT5wcGd0dF9zaXplID0gNDg7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0
cnVjdF9tdXRleCk7CiAJcHBndHQgPSBpOTE1X3BwZ3R0X2NyZWF0ZShkZXZfcHJpdik7CiAJaWYg
KElTX0VSUihwcGd0dCkpIHsKIAkJZXJyID0gUFRSX0VSUihwcGd0dCk7CkBAIC0xNjU5LDkgKzE2
NTgsNyBAQCBpbnQgaTkxNV9nZW1faHVnZV9wYWdlX21vY2tfc2VsZnRlc3RzKHZvaWQpCiAJaTkx
NV92bV9wdXQoJnBwZ3R0LT52bSk7CiAKIG91dF91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZkZXZf
cHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJZHJtX2Rldl9wdXQoJmRldl9wcml2LT5kcm0pOwot
CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMTY3Nyw3ICsxNjc0LDYgQEAgaW50IGk5MTVfZ2VtX2h1
Z2VfcGFnZV9saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAl9
OwogCXN0cnVjdCBkcm1fZmlsZSAqZmlsZTsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4
OwotCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCWludCBlcnI7CiAKIAlpZiAoIUhBU19QUEdU
VChpOTE1KSkgewpAQCAtMTY5MiwxMyArMTY4OCwxMCBAQCBpbnQgaTkxNV9nZW1faHVnZV9wYWdl
X2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCWlmIChJU19F
UlIoZmlsZSkpCiAJCXJldHVybiBQVFJfRVJSKGZpbGUpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1
LT5ydW50aW1lX3BtKTsKLQogCWN0eCA9IGxpdmVfY29udGV4dChpOTE1LCBmaWxlKTsKIAlpZiAo
SVNfRVJSKGN0eCkpIHsKIAkJZXJyID0gUFRSX0VSUihjdHgpOwotCQlnb3RvIG91dF91bmxvY2s7
CisJCWdvdG8gb3V0X2ZpbGU7CiAJfQogCiAJaWYgKHJjdV9hY2Nlc3NfcG9pbnRlcihjdHgtPnZt
KSkKQEAgLTE3MDYsMTEgKzE2OTksNyBAQCBpbnQgaTkxNV9nZW1faHVnZV9wYWdlX2xpdmVfc2Vs
ZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCiAJZXJyID0gaTkxNV9zdWJ0
ZXN0cyh0ZXN0cywgY3R4KTsKIAotb3V0X3VubG9jazoKLQlpbnRlbF9ydW50aW1lX3BtX3B1dCgm
aTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKLQorb3V0X2ZpbGU6CiAJbW9ja19maWxlX2ZyZWUoaTkxNSwgZmlsZSk7Ci0K
IAlyZXR1cm4gZXJyOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3Nl
bGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2Vs
ZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYwppbmRleCBmZmVkYzY3ZjVjM2QuLjE1ZTgxMDk1YjVk
NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dl
bV9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1
X2dlbV9jb250ZXh0LmMKQEAgLTMwNyw5ICszMDcsNyBAQCBzdGF0aWMgaW50IGxpdmVfcGFyYWxs
ZWxfc3dpdGNoKHZvaWQgKmFyZykKIAkJc3RydWN0IGlndF9saXZlX3Rlc3QgdDsKIAkJaW50IG47
CiAKLQkJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWVyciA9IGlndF9s
aXZlX3Rlc3RfYmVnaW4oJnQsIGk5MTUsIF9fZnVuY19fLCAiIik7Ci0JCW11dGV4X3VubG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWlmIChlcnIpCiAJCQlicmVhazsKIApAQCAtMzQx
LDEwICszMzksOCBAQCBzdGF0aWMgaW50IGxpdmVfcGFyYWxsZWxfc3dpdGNoKHZvaWQgKmFyZykK
IAkJCWRhdGFbbl0udHNrID0gTlVMTDsKIAkJfQogCi0JCW11dGV4X2xvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCQlpZiAoaWd0X2xpdmVfdGVzdF9lbmQoJnQpKQogCQkJZXJyID0gLUVJ
TzsKLQkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAl9CiAKIG91dDoK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1f
bW1hbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFu
LmMKaW5kZXggMWNkMjVjZmQwMjQ2Li5jZmE1MmM1MjU2OTEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jCkBAIC02NjksOSArNjY5
LDcgQEAgc3RhdGljIGludCBpZ3RfbW1hcF9vZmZzZXRfZXhoYXVzdGlvbih2b2lkICphcmcpCiAJ
CQlnb3RvIG91dDsKIAkJfQogCi0JCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwogCQllcnIgPSBtYWtlX29ial9idXN5KG9iaik7Ci0JCW11dGV4X3VubG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CiAJCWlmIChlcnIpIHsKIAkJCXByX2VycigiW2xvb3AgJWRdIEZhaWxl
ZCB0byBidXN5IHRoZSBvYmplY3RcbiIsIGxvb3ApOwogCQkJZ290byBlcnJfb2JqOwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9waHlzLmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX3BoeXMuYwppbmRl
eCA5NGExNWUzZjZkYjguLjM0OTMyODcxYjNhNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9waHlzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9waHlzLmMKQEAgLTI1LDkgKzI1LDcgQEAgc3Rh
dGljIGludCBtb2NrX3BoeXNfb2JqZWN0KHZvaWQgKmFyZykKIAkJZ290byBvdXQ7CiAJfQogCi0J
bXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJZXJyID0gaTkxNV9nZW1fb2Jq
ZWN0X2F0dGFjaF9waHlzKG9iaiwgUEFHRV9TSVpFKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChlcnIpIHsKIAkJcHJfZXJyKCJpOTE1X2dlbV9vYmplY3Rf
YXR0YWNoX3BoeXMgZmFpbGVkLCBlcnI9JWRcbiIsIGVycik7CiAJCWdvdG8gb3V0X29iajsKZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKaW5kZXggMDM1N2NmNjQzZTNkLi4xNzdj
YjdmM2NmOTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xy
Yy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCkBAIC0yNiwx
NyArMjYsMTMgQEAgc3RhdGljIGludCBsaXZlX3Nhbml0eWNoZWNrKHZvaWQgKmFyZykKIAlzdHJ1
Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4OwogCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKIAlz
dHJ1Y3QgaWd0X3NwaW5uZXIgc3BpbjsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAlpbnQg
ZXJyID0gLUVOT01FTTsKIAogCWlmICghSEFTX0xPR0lDQUxfUklOR19DT05URVhUUyhpOTE1KSkK
IAkJcmV0dXJuIDA7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3
YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCiAJaWYg
KGlndF9zcGlubmVyX2luaXQoJnNwaW4sICZpOTE1LT5ndCkpCi0JCWdvdG8gZXJyX3VubG9jazsK
KwkJcmV0dXJuIC1FTk9NRU07CiAKIAljdHggPSBrZXJuZWxfY29udGV4dChpOTE1KTsKIAlpZiAo
IWN0eCkKQEAgLTczLDkgKzY5LDYgQEAgc3RhdGljIGludCBsaXZlX3Nhbml0eWNoZWNrKHZvaWQg
KmFyZykKIAlrZXJuZWxfY29udGV4dF9jbG9zZShjdHgpOwogZXJyX3NwaW46CiAJaWd0X3NwaW5u
ZXJfZmluaSgmc3Bpbik7Ci1lcnJfdW5sb2NrOgotCWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1
LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCXJldHVybiBlcnI7CiB9CiAKQEAgLTQwNiw3ICszOTksNiBAQCBzdGF0aWMgaW50
IGxpdmVfdGltZXNsaWNlX3ByZWVtcHQodm9pZCAqYXJnKQogewogCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gYXJnOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7Ci0J
aW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJdm9pZCAq
dmFkZHI7CiAJaW50IGVyciA9IDA7CkBAIC00MjEsMTQgKzQxMyw5IEBAIHN0YXRpYyBpbnQgbGl2
ZV90aW1lc2xpY2VfcHJlZW1wdCh2b2lkICphcmcpCiAJICogcmVhZHkgdGFzay4KIAkgKi8KIAot
CW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCXdha2VyZWYgPSBpbnRlbF9y
dW50aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7Ci0KIAlvYmogPSBpOTE1X2dlbV9vYmpl
Y3RfY3JlYXRlX2ludGVybmFsKGk5MTUsIFBBR0VfU0laRSk7Ci0JaWYgKElTX0VSUihvYmopKSB7
Ci0JCWVyciA9IFBUUl9FUlIob2JqKTsKLQkJZ290byBlcnJfdW5sb2NrOwotCX0KKwlpZiAoSVNf
RVJSKG9iaikpCisJCXJldHVybiBQVFJfRVJSKG9iaik7CiAKIAl2bWEgPSBpOTE1X3ZtYV9pbnN0
YW5jZShvYmosICZpOTE1LT5nZ3R0LnZtLCBOVUxMKTsKIAlpZiAoSVNfRVJSKHZtYSkpIHsKQEAg
LTQ3MywxMCArNDYwLDYgQEAgc3RhdGljIGludCBsaXZlX3RpbWVzbGljZV9wcmVlbXB0KHZvaWQg
KmFyZykKIAlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKG9iaik7CiBlcnJfb2JqOgogCWk5MTVf
Z2VtX29iamVjdF9wdXQob2JqKTsKLWVycl91bmxvY2s6Ci0JaW50ZWxfcnVudGltZV9wbV9wdXQo
Jmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7Ci0KIAlyZXR1cm4gZXJyOwogfQogCkBAIC00ODgsNyArNDcxLDYgQEAgc3Rh
dGljIGludCBsaXZlX2J1c3l3YWl0X3ByZWVtcHQodm9pZCAqYXJnKQogCXN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmo7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJZW51bSBpbnRlbF9l
bmdpbmVfaWQgaWQ7Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJaW50IGVyciA9IC1FTk9N
RU07CiAJdTMyICptYXA7CiAKQEAgLTQ5NywxMiArNDc5LDkgQEAgc3RhdGljIGludCBsaXZlX2J1
c3l3YWl0X3ByZWVtcHQodm9pZCAqYXJnKQogCSAqIHByZWVtcHQgdGhlIGJ1c3l3YWl0cyB1c2Vk
IHRvIHN5bmNocm9uaXNlIGJldHdlZW4gcmluZ3MuCiAJICovCiAKLQltdXRleF9sb2NrKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmk5
MTUtPnJ1bnRpbWVfcG0pOwotCiAJY3R4X2hpID0ga2VybmVsX2NvbnRleHQoaTkxNSk7CiAJaWYg
KCFjdHhfaGkpCi0JCWdvdG8gZXJyX3VubG9jazsKKwkJcmV0dXJuIC1FTk9NRU07CiAJY3R4X2hp
LT5zY2hlZC5wcmlvcml0eSA9CiAJCUk5MTVfVVNFUl9QUklPUklUWShJOTE1X0NPTlRFWFRfTUFY
X1VTRVJfUFJJT1JJVFkpOwogCkBAIC02NTYsOSArNjM1LDYgQEAgc3RhdGljIGludCBsaXZlX2J1
c3l3YWl0X3ByZWVtcHQodm9pZCAqYXJnKQogCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eF9sbyk7
CiBlcnJfY3R4X2hpOgogCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eF9oaSk7Ci1lcnJfdW5sb2Nr
OgotCWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQlt
dXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CiB9CiAK
QEAgLTY4Nyw3ICs2NjMsNiBAQCBzdGF0aWMgaW50IGxpdmVfcHJlZW1wdCh2b2lkICphcmcpCiAJ
c3RydWN0IGlndF9zcGlubmVyIHNwaW5faGksIHNwaW5fbG87CiAJc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwotCWludGVsX3dha2VyZWZf
dCB3YWtlcmVmOwogCWludCBlcnIgPSAtRU5PTUVNOwogCiAJaWYgKCFIQVNfTE9HSUNBTF9SSU5H
X1BSRUVNUFRJT04oaTkxNSkpCkBAIC02OTYsMTEgKzY3MSw4IEBAIHN0YXRpYyBpbnQgbGl2ZV9w
cmVlbXB0KHZvaWQgKmFyZykKIAlpZiAoIShpOTE1LT5jYXBzLnNjaGVkdWxlciAmIEk5MTVfU0NI
RURVTEVSX0NBUF9QUkVFTVBUSU9OKSkKIAkJcHJfZXJyKCJMb2dpY2FsIHByZWVtcHRpb24gc3Vw
cG9ydGVkLCBidXQgbm90IGV4cG9zZWRcbiIpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50
aW1lX3BtKTsKLQogCWlmIChpZ3Rfc3Bpbm5lcl9pbml0KCZzcGluX2hpLCAmaTkxNS0+Z3QpKQot
CQlnb3RvIGVycl91bmxvY2s7CisJCXJldHVybiAtRU5PTUVNOwogCiAJaWYgKGlndF9zcGlubmVy
X2luaXQoJnNwaW5fbG8sICZpOTE1LT5ndCkpCiAJCWdvdG8gZXJyX3NwaW5faGk7CkBAIC03ODAs
OSArNzUyLDYgQEAgc3RhdGljIGludCBsaXZlX3ByZWVtcHQodm9pZCAqYXJnKQogCWlndF9zcGlu
bmVyX2ZpbmkoJnNwaW5fbG8pOwogZXJyX3NwaW5faGk6CiAJaWd0X3NwaW5uZXJfZmluaSgmc3Bp
bl9oaSk7Ci1lcnJfdW5sb2NrOgotCWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1l
X3BtLCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
CXJldHVybiBlcnI7CiB9CiAKQEAgLTc5NCwxNyArNzYzLDEzIEBAIHN0YXRpYyBpbnQgbGl2ZV9s
YXRlX3ByZWVtcHQodm9pZCAqYXJnKQogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsK
IAlzdHJ1Y3QgaTkxNV9zY2hlZF9hdHRyIGF0dHIgPSB7fTsKIAllbnVtIGludGVsX2VuZ2luZV9p
ZCBpZDsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAlpbnQgZXJyID0gLUVOT01FTTsKIAog
CWlmICghSEFTX0xPR0lDQUxfUklOR19QUkVFTVBUSU9OKGk5MTUpKQogCQlyZXR1cm4gMDsKIAot
CW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCXdha2VyZWYgPSBpbnRlbF9y
dW50aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7Ci0KIAlpZiAoaWd0X3NwaW5uZXJfaW5p
dCgmc3Bpbl9oaSwgJmk5MTUtPmd0KSkKLQkJZ290byBlcnJfdW5sb2NrOworCQlyZXR1cm4gLUVO
T01FTTsKIAogCWlmIChpZ3Rfc3Bpbm5lcl9pbml0KCZzcGluX2xvLCAmaTkxNS0+Z3QpKQogCQln
b3RvIGVycl9zcGluX2hpOwpAQCAtODg2LDkgKzg1MSw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9sYXRl
X3ByZWVtcHQodm9pZCAqYXJnKQogCWlndF9zcGlubmVyX2ZpbmkoJnNwaW5fbG8pOwogZXJyX3Nw
aW5faGk6CiAJaWd0X3NwaW5uZXJfZmluaSgmc3Bpbl9oaSk7Ci1lcnJfdW5sb2NrOgotCWludGVs
X3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91bmxv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CiAKIGVycl93ZWRnZWQ6
CkBAIC05MzMsNyArODk1LDYgQEAgc3RhdGljIGludCBsaXZlX25vcHJlZW1wdCh2b2lkICphcmcp
CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCXN0cnVjdCBwcmVlbXB0X2NsaWVu
dCBhLCBiOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwotCWludGVsX3dha2VyZWZfdCB3YWtl
cmVmOwogCWludCBlcnIgPSAtRU5PTUVNOwogCiAJLyoKQEAgLTk0NCwxMSArOTA1LDggQEAgc3Rh
dGljIGludCBsaXZlX25vcHJlZW1wdCh2b2lkICphcmcpCiAJaWYgKCFIQVNfTE9HSUNBTF9SSU5H
X1BSRUVNUFRJT04oaTkxNSkpCiAJCXJldHVybiAwOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5y
dW50aW1lX3BtKTsKLQogCWlmIChwcmVlbXB0X2NsaWVudF9pbml0KGk5MTUsICZhKSkKLQkJZ290
byBlcnJfdW5sb2NrOworCQlyZXR1cm4gLUVOT01FTTsKIAlpZiAocHJlZW1wdF9jbGllbnRfaW5p
dChpOTE1LCAmYikpCiAJCWdvdG8gZXJyX2NsaWVudF9hOwogCWIuY3R4LT5zY2hlZC5wcmlvcml0
eSA9IEk5MTVfVVNFUl9QUklPUklUWShJOTE1X1BSSU9SSVRZX01BWCk7CkBAIC0xMDIyLDkgKzk4
MCw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9ub3ByZWVtcHQodm9pZCAqYXJnKQogCXByZWVtcHRfY2xp
ZW50X2ZpbmkoJmIpOwogZXJyX2NsaWVudF9hOgogCXByZWVtcHRfY2xpZW50X2ZpbmkoJmEpOwot
ZXJyX3VubG9jazoKLQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2Fr
ZXJlZik7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXR1cm4g
ZXJyOwogCiBlcnJfd2VkZ2VkOgpAQCAtMTA0NCw3ICs5OTksNiBAQCBzdGF0aWMgaW50IGxpdmVf
c3VwcHJlc3Nfc2VsZl9wcmVlbXB0KHZvaWQgKmFyZykKIAl9OwogCXN0cnVjdCBwcmVlbXB0X2Ns
aWVudCBhLCBiOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwotCWludGVsX3dha2VyZWZfdCB3
YWtlcmVmOwogCWludCBlcnIgPSAtRU5PTUVNOwogCiAJLyoKQEAgLTEwNjMsMTEgKzEwMTcsOCBA
QCBzdGF0aWMgaW50IGxpdmVfc3VwcHJlc3Nfc2VsZl9wcmVlbXB0KHZvaWQgKmFyZykKIAlpZiAo
aW50ZWxfdmdwdV9hY3RpdmUoaTkxNSkpCiAJCXJldHVybiAwOyAvKiBHVlQgZm9yY2VzIHNpbmds
ZSBwb3J0ICYgcmVxdWVzdCBzdWJtaXNzaW9uICovCiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1
bnRpbWVfcG0pOwotCiAJaWYgKHByZWVtcHRfY2xpZW50X2luaXQoaTkxNSwgJmEpKQotCQlnb3Rv
IGVycl91bmxvY2s7CisJCXJldHVybiAtRU5PTUVNOwogCWlmIChwcmVlbXB0X2NsaWVudF9pbml0
KGk5MTUsICZiKSkKIAkJZ290byBlcnJfY2xpZW50X2E7CiAKQEAgLTExNDgsOSArMTA5OSw2IEBA
IHN0YXRpYyBpbnQgbGl2ZV9zdXBwcmVzc19zZWxmX3ByZWVtcHQodm9pZCAqYXJnKQogCXByZWVt
cHRfY2xpZW50X2ZpbmkoJmIpOwogZXJyX2NsaWVudF9hOgogCXByZWVtcHRfY2xpZW50X2Zpbmko
JmEpOwotZXJyX3VubG9jazoKLQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9w
bSwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAly
ZXR1cm4gZXJyOwogCiBlcnJfd2VkZ2VkOgpAQCAtMTIyMCw3ICsxMTY4LDYgQEAgc3RhdGljIGlu
dCBsaXZlX3N1cHByZXNzX3dhaXRfcHJlZW1wdCh2b2lkICphcmcpCiAJc3RydWN0IHByZWVtcHRf
Y2xpZW50IGNsaWVudFs0XTsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJZW51
bSBpbnRlbF9lbmdpbmVfaWQgaWQ7Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJaW50IGVy
ciA9IC1FTk9NRU07CiAJaW50IGk7CiAKQEAgLTEyMzMsMTEgKzExODAsOCBAQCBzdGF0aWMgaW50
IGxpdmVfc3VwcHJlc3Nfd2FpdF9wcmVlbXB0KHZvaWQgKmFyZykKIAlpZiAoIUhBU19MT0dJQ0FM
X1JJTkdfUFJFRU1QVElPTihpOTE1KSkKIAkJcmV0dXJuIDA7CiAKLQltdXRleF9sb2NrKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmk5
MTUtPnJ1bnRpbWVfcG0pOwotCiAJaWYgKHByZWVtcHRfY2xpZW50X2luaXQoaTkxNSwgJmNsaWVu
dFswXSkpIC8qIEVMU1BbMF0gKi8KLQkJZ290byBlcnJfdW5sb2NrOworCQlyZXR1cm4gLUVOT01F
TTsKIAlpZiAocHJlZW1wdF9jbGllbnRfaW5pdChpOTE1LCAmY2xpZW50WzFdKSkgLyogRUxTUFsx
XSAqLwogCQlnb3RvIGVycl9jbGllbnRfMDsKIAlpZiAocHJlZW1wdF9jbGllbnRfaW5pdChpOTE1
LCAmY2xpZW50WzJdKSkgLyogaGVhZCBvZiBxdWV1ZSAqLwpAQCAtMTMyMyw5ICsxMjY3LDYgQEAg
c3RhdGljIGludCBsaXZlX3N1cHByZXNzX3dhaXRfcHJlZW1wdCh2b2lkICphcmcpCiAJcHJlZW1w
dF9jbGllbnRfZmluaSgmY2xpZW50WzFdKTsKIGVycl9jbGllbnRfMDoKIAlwcmVlbXB0X2NsaWVu
dF9maW5pKCZjbGllbnRbMF0pOwotZXJyX3VubG9jazoKLQlpbnRlbF9ydW50aW1lX3BtX3B1dCgm
aTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKIAlyZXR1cm4gZXJyOwogCiBlcnJfd2VkZ2VkOgpAQCAtMTM0Miw3ICsxMjgz
LDYgQEAgc3RhdGljIGludCBsaXZlX2NoYWluX3ByZWVtcHQodm9pZCAqYXJnKQogCXN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKIAlzdHJ1Y3QgcHJlZW1wdF9jbGllbnQgaGksIGxvOwog
CWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwotCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCWlu
dCBlcnIgPSAtRU5PTUVNOwogCiAJLyoKQEAgLTEzNTQsMTEgKzEyOTQsOCBAQCBzdGF0aWMgaW50
IGxpdmVfY2hhaW5fcHJlZW1wdCh2b2lkICphcmcpCiAJaWYgKCFIQVNfTE9HSUNBTF9SSU5HX1BS
RUVNUFRJT04oaTkxNSkpCiAJCXJldHVybiAwOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50
aW1lX3BtKTsKLQogCWlmIChwcmVlbXB0X2NsaWVudF9pbml0KGk5MTUsICZoaSkpCi0JCWdvdG8g
ZXJyX3VubG9jazsKKwkJcmV0dXJuIC1FTk9NRU07CiAKIAlpZiAocHJlZW1wdF9jbGllbnRfaW5p
dChpOTE1LCAmbG8pKQogCQlnb3RvIGVycl9jbGllbnRfaGk7CkBAIC0xNDY5LDkgKzE0MDYsNiBA
QCBzdGF0aWMgaW50IGxpdmVfY2hhaW5fcHJlZW1wdCh2b2lkICphcmcpCiAJcHJlZW1wdF9jbGll
bnRfZmluaSgmbG8pOwogZXJyX2NsaWVudF9oaToKIAlwcmVlbXB0X2NsaWVudF9maW5pKCZoaSk7
Ci1lcnJfdW5sb2NrOgotCWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3
YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVy
biBlcnI7CiAKIGVycl93ZWRnZWQ6CkBAIC0xNDg5LDcgKzE0MjMsNiBAQCBzdGF0aWMgaW50IGxp
dmVfcHJlZW1wdF9oYW5nKHZvaWQgKmFyZykKIAlzdHJ1Y3QgaWd0X3NwaW5uZXIgc3Bpbl9oaSwg
c3Bpbl9sbzsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJZW51bSBpbnRlbF9l
bmdpbmVfaWQgaWQ7Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJaW50IGVyciA9IC1FTk9N
RU07CiAKIAlpZiAoIUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1QVElPTihpOTE1KSkKQEAgLTE0OTgs
MTEgKzE0MzEsOCBAQCBzdGF0aWMgaW50IGxpdmVfcHJlZW1wdF9oYW5nKHZvaWQgKmFyZykKIAlp
ZiAoIWludGVsX2hhc19yZXNldF9lbmdpbmUoJmk5MTUtPmd0KSkKIAkJcmV0dXJuIDA7CiAKLQlt
dXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVu
dGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCiAJaWYgKGlndF9zcGlubmVyX2luaXQo
JnNwaW5faGksICZpOTE1LT5ndCkpCi0JCWdvdG8gZXJyX3VubG9jazsKKwkJcmV0dXJuIC1FTk9N
RU07CiAKIAlpZiAoaWd0X3NwaW5uZXJfaW5pdCgmc3Bpbl9sbywgJmk5MTUtPmd0KSkKIAkJZ290
byBlcnJfc3Bpbl9oaTsKQEAgLTE1OTQsOSArMTUyNCw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9wcmVl
bXB0X2hhbmcodm9pZCAqYXJnKQogCWlndF9zcGlubmVyX2ZpbmkoJnNwaW5fbG8pOwogZXJyX3Nw
aW5faGk6CiAJaWd0X3NwaW5uZXJfZmluaSgmc3Bpbl9oaSk7Ci1lcnJfdW5sb2NrOgotCWludGVs
X3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91bmxv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CiB9CiAKQEAgLTE2ODYs
MTEgKzE2MTMsOSBAQCBzdGF0aWMgaW50IHNtb2tlX2NyZXNjZW5kb190aHJlYWQodm9pZCAqYXJn
KQogCQlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqY3R4ID0gc21va2VfY29udGV4dChzbW9rZSk7
CiAJCWludCBlcnI7CiAKLQkJbXV0ZXhfbG9jaygmc21va2UtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwogCQllcnIgPSBzbW9rZV9zdWJtaXQoc21va2UsCiAJCQkJICAgY3R4LCBjb3VudCAlIEk5
MTVfUFJJT1JJVFlfTUFYLAogCQkJCSAgIHNtb2tlLT5iYXRjaCk7Ci0JCW11dGV4X3VubG9jaygm
c21va2UtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQlpZiAoZXJyKQogCQkJcmV0dXJuIGVy
cjsKIApAQCAtMTcxMSw4ICsxNjM2LDYgQEAgc3RhdGljIGludCBzbW9rZV9jcmVzY2VuZG8oc3Ry
dWN0IHByZWVtcHRfc21va2UgKnNtb2tlLCB1bnNpZ25lZCBpbnQgZmxhZ3MpCiAJdW5zaWduZWQg
bG9uZyBjb3VudDsKIAlpbnQgZXJyID0gMDsKIAotCW11dGV4X3VubG9jaygmc21va2UtPmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgc21va2UtPmk5
MTUsIGlkKSB7CiAJCWFyZ1tpZF0gPSAqc21va2U7CiAJCWFyZ1tpZF0uZW5naW5lID0gZW5naW5l
OwpAQCAtMTc0NSw4ICsxNjY4LDYgQEAgc3RhdGljIGludCBzbW9rZV9jcmVzY2VuZG8oc3RydWN0
IHByZWVtcHRfc21va2UgKnNtb2tlLCB1bnNpZ25lZCBpbnQgZmxhZ3MpCiAJCXB1dF90YXNrX3N0
cnVjdCh0c2tbaWRdKTsKIAl9CiAKLQltdXRleF9sb2NrKCZzbW9rZS0+aTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7Ci0KIAlwcl9pbmZvKCJTdWJtaXR0ZWQgJWx1IGNyZXNjZW5kbzoleCByZXF1ZXN0
cyBhY3Jvc3MgJWQgZW5naW5lcyBhbmQgJWQgY29udGV4dHNcbiIsCiAJCWNvdW50LCBmbGFncywK
IAkJUlVOVElNRV9JTkZPKHNtb2tlLT5pOTE1KS0+bnVtX2VuZ2luZXMsIHNtb2tlLT5uY29udGV4
dCk7CkBAIC0xNzg5LDcgKzE3MTAsNiBAQCBzdGF0aWMgaW50IGxpdmVfcHJlZW1wdF9zbW9rZSh2
b2lkICphcmcpCiAJCS5uY29udGV4dCA9IDEwMjQsCiAJfTsKIAljb25zdCB1bnNpZ25lZCBpbnQg
cGhhc2VbXSA9IHsgMCwgQkFUQ0ggfTsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAlzdHJ1
Y3QgaWd0X2xpdmVfdGVzdCB0OwogCWludCBlcnIgPSAtRU5PTUVNOwogCXUzMiAqY3M7CkBAIC0x
ODA0LDEzICsxNzI0LDEwIEBAIHN0YXRpYyBpbnQgbGl2ZV9wcmVlbXB0X3Ntb2tlKHZvaWQgKmFy
ZykKIAlpZiAoIXNtb2tlLmNvbnRleHRzKQogCQlyZXR1cm4gLUVOT01FTTsKIAotCW11dGV4X2xv
Y2soJnNtb2tlLmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCXdha2VyZWYgPSBpbnRlbF9ydW50
aW1lX3BtX2dldCgmc21va2UuaTkxNS0+cnVudGltZV9wbSk7Ci0KIAlzbW9rZS5iYXRjaCA9IGk5
MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoc21va2UuaTkxNSwgUEFHRV9TSVpFKTsKIAlp
ZiAoSVNfRVJSKHNtb2tlLmJhdGNoKSkgewogCQllcnIgPSBQVFJfRVJSKHNtb2tlLmJhdGNoKTsK
LQkJZ290byBlcnJfdW5sb2NrOworCQlnb3RvIGVycl9mcmVlOwogCX0KIAogCWNzID0gaTkxNV9n
ZW1fb2JqZWN0X3Bpbl9tYXAoc21va2UuYmF0Y2gsIEk5MTVfTUFQX1dCKTsKQEAgLTE4NTcsOSAr
MTc3NCw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9wcmVlbXB0X3Ntb2tlKHZvaWQgKmFyZykKIAogZXJy
X2JhdGNoOgogCWk5MTVfZ2VtX29iamVjdF9wdXQoc21va2UuYmF0Y2gpOwotZXJyX3VubG9jazoK
LQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmc21va2UuaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7
Ci0JbXV0ZXhfdW5sb2NrKCZzbW9rZS5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKK2Vycl9mcmVl
OgogCWtmcmVlKHNtb2tlLmNvbnRleHRzKTsKIAogCXJldHVybiBlcnI7CkBAIC0xOTk3LDE5ICsx
OTEyLDE3IEBAIHN0YXRpYyBpbnQgbGl2ZV92aXJ0dWFsX2VuZ2luZSh2b2lkICphcmcpCiAJc3Ry
dWN0IGludGVsX2d0ICpndCA9ICZpOTE1LT5ndDsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsK
IAl1bnNpZ25lZCBpbnQgY2xhc3MsIGluc3Q7Ci0JaW50IGVyciA9IC1FTk9ERVY7CisJaW50IGVy
cjsKIAogCWlmIChVU0VTX0dVQ19TVUJNSVNTSU9OKGk5MTUpKQogCQlyZXR1cm4gMDsKIAotCW11
dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJZm9yX2VhY2hfZW5naW5lKGVu
Z2luZSwgaTkxNSwgaWQpIHsKIAkJZXJyID0gbm9wX3ZpcnR1YWxfZW5naW5lKGk5MTUsICZlbmdp
bmUsIDEsIDEsIDApOwogCQlpZiAoZXJyKSB7CiAJCQlwcl9lcnIoIkZhaWxlZCB0byB3cmFwIGVu
Z2luZSAlczogZXJyPSVkXG4iLAogCQkJICAgICAgIGVuZ2luZS0+bmFtZSwgZXJyKTsKLQkJCWdv
dG8gb3V0X3VubG9jazsKKwkJCXJldHVybiBlcnI7CiAJCX0KIAl9CiAKQEAgLTIwMzAsMTcgKzE5
NDMsMTUgQEAgc3RhdGljIGludCBsaXZlX3ZpcnR1YWxfZW5naW5lKHZvaWQgKmFyZykKIAkJCWVy
ciA9IG5vcF92aXJ0dWFsX2VuZ2luZShpOTE1LCBzaWJsaW5ncywgbnNpYmxpbmcsCiAJCQkJCQkg
biwgMCk7CiAJCQlpZiAoZXJyKQotCQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCQlyZXR1cm4gZXJy
OwogCQl9CiAKIAkJZXJyID0gbm9wX3ZpcnR1YWxfZW5naW5lKGk5MTUsIHNpYmxpbmdzLCBuc2li
bGluZywgbiwgQ0hBSU4pOwogCQlpZiAoZXJyKQotCQkJZ290byBvdXRfdW5sb2NrOworCQkJcmV0
dXJuIGVycjsKIAl9CiAKLW91dF91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKLQlyZXR1cm4gZXJyOworCXJldHVybiAwOwogfQogCiBzdGF0aWMgaW50IG1h
c2tfdmlydHVhbF9lbmdpbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCkBAIC0yMTE5
LDkgKzIwMzAsNiBAQCBzdGF0aWMgaW50IG1hc2tfdmlydHVhbF9lbmdpbmUoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUsCiAJfQogCiAJZXJyID0gaWd0X2xpdmVfdGVzdF9lbmQoJnQpOwot
CWlmIChlcnIpCi0JCWdvdG8gb3V0OwotCiBvdXQ6CiAJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUp
KQogCQllcnIgPSAtRUlPOwpAQCAtMjE0NCwxMyArMjA1MiwxMSBAQCBzdGF0aWMgaW50IGxpdmVf
dmlydHVhbF9tYXNrKHZvaWQgKmFyZykKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpzaWJsaW5n
c1tNQVhfRU5HSU5FX0lOU1RBTkNFICsgMV07CiAJc3RydWN0IGludGVsX2d0ICpndCA9ICZpOTE1
LT5ndDsKIAl1bnNpZ25lZCBpbnQgY2xhc3MsIGluc3Q7Ci0JaW50IGVyciA9IDA7CisJaW50IGVy
cjsKIAogCWlmIChVU0VTX0dVQ19TVUJNSVNTSU9OKGk5MTUpKQogCQlyZXR1cm4gMDsKIAotCW11
dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJZm9yIChjbGFzcyA9IDA7IGNs
YXNzIDw9IE1BWF9FTkdJTkVfQ0xBU1M7IGNsYXNzKyspIHsKIAkJdW5zaWduZWQgaW50IG5zaWJs
aW5nOwogCkBAIC0yMTY2LDEyICsyMDcyLDEwIEBAIHN0YXRpYyBpbnQgbGl2ZV92aXJ0dWFsX21h
c2sodm9pZCAqYXJnKQogCiAJCWVyciA9IG1hc2tfdmlydHVhbF9lbmdpbmUoaTkxNSwgc2libGlu
Z3MsIG5zaWJsaW5nKTsKIAkJaWYgKGVycikKLQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCXJldHVy
biBlcnI7CiAJfQogCi1vdXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7Ci0JcmV0dXJuIGVycjsKKwlyZXR1cm4gMDsKIH0KIAogc3RhdGljIGludCBib25k
X3ZpcnR1YWxfZW5naW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LApAQCAtMjMyMiwx
MyArMjIyNiwxMSBAQCBzdGF0aWMgaW50IGxpdmVfdmlydHVhbF9ib25kKHZvaWQgKmFyZykKIAlz
dHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpzaWJsaW5nc1tNQVhfRU5HSU5FX0lOU1RBTkNFICsgMV07
CiAJc3RydWN0IGludGVsX2d0ICpndCA9ICZpOTE1LT5ndDsKIAl1bnNpZ25lZCBpbnQgY2xhc3Ms
IGluc3Q7Ci0JaW50IGVyciA9IDA7CisJaW50IGVycjsKIAogCWlmIChVU0VTX0dVQ19TVUJNSVNT
SU9OKGk5MTUpKQogCQlyZXR1cm4gMDsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwotCiAJZm9yIChjbGFzcyA9IDA7IGNsYXNzIDw9IE1BWF9FTkdJTkVfQ0xBU1M7IGNs
YXNzKyspIHsKIAkJY29uc3Qgc3RydWN0IHBoYXNlICpwOwogCQlpbnQgbnNpYmxpbmc7CkBAIC0y
MzUxLDE0ICsyMjUzLDEyIEBAIHN0YXRpYyBpbnQgbGl2ZV92aXJ0dWFsX2JvbmQodm9pZCAqYXJn
KQogCQkJaWYgKGVycikgewogCQkJCXByX2VycigiJXMoJXMpOiBmYWlsZWQgY2xhc3M9JWQsIG5z
aWJsaW5nPSVkLCBlcnI9JWRcbiIsCiAJCQkJICAgICAgIF9fZnVuY19fLCBwLT5uYW1lLCBjbGFz
cywgbnNpYmxpbmcsIGVycik7Ci0JCQkJZ290byBvdXRfdW5sb2NrOworCQkJCXJldHVybiBlcnI7
CiAJCQl9CiAJCX0KIAl9CiAKLW91dF91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKLQlyZXR1cm4gZXJyOworCXJldHVybiAwOwogfQogCiBpbnQgaW50ZWxf
ZXhlY2xpc3RzX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29ya2Fyb3VuZHMu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMKaW5kZXgg
ZDE3OTc2ZDlmYjkxLi43OWViZTYwNjk4N2MgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L3NlbGZ0ZXN0X3dvcmthcm91bmRzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Qvc2VsZnRlc3Rfd29ya2Fyb3VuZHMuYwpAQCAtNzA0LDkgKzcwNCw3IEBAIHN0YXRpYyBpbnQg
bGl2ZV9kaXJ0eV93aGl0ZWxpc3Qodm9pZCAqYXJnKQogCiAJd2FrZXJlZiA9IGludGVsX3J1bnRp
bWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKIAotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CiAJZmlsZSA9IG1vY2tfZmlsZShpOTE1KTsKLQltdXRleF9sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlpZiAoSVNfRVJSKGZpbGUpKSB7CiAJCWVyciA9IFBU
Ul9FUlIoZmlsZSk7CiAJCWdvdG8gb3V0X3JwbTsKQEAgLTcyOCw5ICs3MjYsNyBAQCBzdGF0aWMg
aW50IGxpdmVfZGlydHlfd2hpdGVsaXN0KHZvaWQgKmFyZykKIAl9CiAKIG91dF9maWxlOgotCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJbW9ja19maWxlX2ZyZWUoaTkx
NSwgZmlsZSk7Ci0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiBvdXRfcnBt
OgogCWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKIAly
ZXR1cm4gZXJyOwpAQCAtMTI2NCwxNCArMTI2MCw5IEBAIGludCBpbnRlbF93b3JrYXJvdW5kc19s
aXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkJU1VCVEVTVChs
aXZlX2dwdV9yZXNldF93b3JrYXJvdW5kcyksCiAJCVNVQlRFU1QobGl2ZV9lbmdpbmVfcmVzZXRf
d29ya2Fyb3VuZHMpLAogCX07Ci0JaW50IGVycjsKIAogCWlmIChpbnRlbF9ndF9pc193ZWRnZWQo
Jmk5MTUtPmd0KSkKIAkJcmV0dXJuIDA7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLQllcnIgPSBpOTE1X3N1YnRlc3RzKHRlc3RzLCBpOTE1KTsKLQltdXRleF91bmxv
Y2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCi0JcmV0dXJuIGVycjsKKwlyZXR1cm4gaTkx
NV9zdWJ0ZXN0cyh0ZXN0cywgaTkxNSk7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC91Yy9zZWxmdGVzdF9ndWMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3VjL3Nl
bGZ0ZXN0X2d1Yy5jCmluZGV4IGJiYTBlYWZlMWNkYi4uZjkyN2Y4NTFhYWRmIDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC91Yy9zZWxmdGVzdF9ndWMuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC91Yy9zZWxmdGVzdF9ndWMuYwpAQCAtMTE2LDcgKzExNiw2IEBAIHN0
YXRpYyBpbnQgaWd0X2d1Y19jbGllbnRzKHZvaWQgKmFyZ3MpCiAJaW50IGVyciA9IDA7CiAKIAlH
RU1fQlVHX09OKCFIQVNfR1RfVUMoZGV2X3ByaXYpKTsKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZkZXZf
cHJpdi0+cnVudGltZV9wbSk7CiAKIAlndWMgPSAmZGV2X3ByaXYtPmd0LnVjLmd1YzsKQEAgLTE5
MCw3ICsxODksNiBAQCBzdGF0aWMgaW50IGlndF9ndWNfY2xpZW50cyh2b2lkICphcmdzKQogCWd1
Y19jbGllbnRzX2VuYWJsZShndWMpOwogdW5sb2NrOgogCWludGVsX3J1bnRpbWVfcG1fcHV0KCZk
ZXZfcHJpdi0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMjA4LDcgKzIwNiw2IEBA
IHN0YXRpYyBpbnQgaWd0X2d1Y19kb29yYmVsbHModm9pZCAqYXJnKQogCXUxNiBkYl9pZDsKIAog
CUdFTV9CVUdfT04oIUhBU19HVF9VQyhkZXZfcHJpdikpOwotCW11dGV4X2xvY2soJmRldl9wcml2
LT5kcm0uc3RydWN0X211dGV4KTsKIAl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmRl
dl9wcml2LT5ydW50aW1lX3BtKTsKIAogCWd1YyA9ICZkZXZfcHJpdi0+Z3QudWMuZ3VjOwpAQCAt
Mjk5LDcgKzI5Niw2IEBAIHN0YXRpYyBpbnQgaWd0X2d1Y19kb29yYmVsbHModm9pZCAqYXJnKQog
CQl9CiB1bmxvY2s6CiAJaW50ZWxfcnVudGltZV9wbV9wdXQoJmRldl9wcml2LT5ydW50aW1lX3Bt
LCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsK
IAlyZXR1cm4gZXJyOwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaTkxNV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV9nZW1fZ3R0LmMKaW5kZXggYmRkMzM2YTUyZjkwLi5lMDBlMjE3NjNmYzMgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMKQEAgLTE3OTMsNyArMTc5
Myw2IEBAIHN0YXRpYyBpbnQgaWd0X2NzX3RsYih2b2lkICphcmcpCiAJaWYgKElTX0VSUihmaWxl
KSkKIAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKIAljdHggPSBsaXZlX2NvbnRleHQoaTkxNSwgZmlsZSk7CiAJaWYgKElTX0VS
UihjdHgpKSB7CiAJCWVyciA9IFBUUl9FUlIoY3R4KTsKQEAgLTIwMTMsNyArMjAxMiw2IEBAIHN0
YXRpYyBpbnQgaWd0X2NzX3RsYih2b2lkICphcmcpCiBvdXRfcHV0X2JiZToKIAlpOTE1X2dlbV9v
YmplY3RfcHV0KGJiZSk7CiBvdXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CiAJbW9ja19maWxlX2ZyZWUoaTkxNSwgZmlsZSk7CiAJcmV0dXJuIGVycjsK
IH0KLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Au
b3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwt
Z2Z4

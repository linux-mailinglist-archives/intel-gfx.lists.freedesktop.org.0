Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E54D9B4E9F
	for <lists+intel-gfx@lfdr.de>; Tue, 17 Sep 2019 14:58:34 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4084B6EC53;
	Tue, 17 Sep 2019 12:58:33 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 239EA6EC54
 for <intel-gfx@lists.freedesktop.org>; Tue, 17 Sep 2019 12:58:32 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga002.fm.intel.com ([10.253.24.26])
 by orsmga105.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 17 Sep 2019 05:58:31 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,516,1559545200"; d="scan'208";a="216556578"
Received: from genxfsim-shark-bay-client-platform.iind.intel.com
 ([10.223.34.144])
 by fmsmga002.fm.intel.com with ESMTP; 17 Sep 2019 05:58:28 -0700
From: Swati Sharma <swati2.sharma@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 17 Sep 2019 18:18:44 +0530
Message-Id: <1568724525-19275-3-git-send-email-swati2.sharma@intel.com>
X-Mailer: git-send-email 1.9.1
In-Reply-To: <1568724525-19275-1-git-send-email-swati2.sharma@intel.com>
References: <1568724525-19275-1-git-send-email-swati2.sharma@intel.com>
Subject: [Intel-gfx] [v2][PATCH 2/3] drm/i915/display: Extract
 icl_read_luts()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: jani.nikula@intel.com, daniel.vetter@ffwll.ch, ankit.k.nautiyal@intel.com
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Rm9yIGljbCssIGhhdmUgaHcgcmVhZCBvdXQgdG8gY3JlYXRlIGh3IGJsb2Igb2YgZ2FtbWEKbHV0
IHZhbHVlcy4gaWNsKyBwbGF0Zm9ybXMgc3VwcG9ydHMgbXVsdGkgc2VnbWVudGVkIGdhbW1hCm1v
ZGUsIGFkZCBodyBsdXQgY3JlYXRpb24gZm9yIHRoaXMgbW9kZS4KClRoaXMgd2lsbCBiZSB1c2Vk
IHRvIHZhbGlkYXRlIGdhbW1hIHByb2dyYW1taW5nIHVzaW5nIGRzYgooZGlzcGxheSBzdGF0ZSBi
dWZmZXIpIHdoaWNoIGlzIGEgdGdsIGZlYXR1cmUuCgp2MjogLXJlYWRvdXQgY29kZSBmb3IgbXVs
dGlzZWdtZW50ZWQgZ2FtbWEgaGFzIHRvIGNvbWUKICAgICB1cCB3aXRoIHNvbWUgaW50ZXJtZWRp
YXRlIGVudHJpZXMgdGhhdCBhcmVuJ3QgcHJlc2VydmVkCiAgICAgaW4gaGFyZHdhcmUgKEphbmkg
TikKICAgIC1saW5lYXIgaW50ZXJwb2xhdGlvbiAoVmlsbGUpCiAgICAtbW92ZWQgY29tbW9uIGNv
ZGUgdG8gY2hlY2sgZ2FtbWFfZW5hYmxlIHRvIHNwZWNpZmljIGZ1bmNzLAogICAgIHNpbmNlIGlj
bCBkb2Vzbid0IHN1cHBvcnQgdGhhdAoKU2lnbmVkLW9mZi1ieTogU3dhdGkgU2hhcm1hIDxzd2F0
aTIuc2hhcm1hQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2NvbG9yLmMgfCAyNDMgKysrKysrKysrKysrKysrKysrKysrKysrKystLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfcmVnLmggICAgICAgICAgICB8ICAgNyArCiAyIGZpbGVzIGNoYW5n
ZWQsIDIzMCBpbnNlcnRpb25zKCspLCAyMCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NvbG9yLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2NvbG9yLmMKaW5kZXggYjFmMGY3ZS4uMDAwODAxMSAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9jb2xvci5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY29sb3IuYwpAQCAtMTM3MCw2ICsxMzcw
LDkgQEAgc3RhdGljIGludCBpY2xfY29sb3JfY2hlY2soc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUpCiAKIHN0YXRpYyBpbnQgaTl4eF9nYW1tYV9wcmVjaXNpb24oY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CisJaWYgKCFjcnRjX3N0YXRlLT5n
YW1tYV9lbmFibGUpCisJCXJldHVybiAwOworCiAJc3dpdGNoIChjcnRjX3N0YXRlLT5nYW1tYV9t
b2RlKSB7CiAJY2FzZSBHQU1NQV9NT0RFX01PREVfOEJJVDoKIAkJcmV0dXJuIDg7CkBAIC0xMzgz
LDYgKzEzODYsOSBAQCBzdGF0aWMgaW50IGk5eHhfZ2FtbWFfcHJlY2lzaW9uKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCiBzdGF0aWMgaW50IGlsa19nYW1tYV9w
cmVjaXNpb24oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CisJ
aWYgKCFjcnRjX3N0YXRlLT5nYW1tYV9lbmFibGUpCisJCXJldHVybiAwOworCiAJaWYgKChjcnRj
X3N0YXRlLT5jc2NfbW9kZSAmIENTQ19QT1NJVElPTl9CRUZPUkVfR0FNTUEpID09IDApCiAJCXJl
dHVybiAwOwogCkBAIC0xMzk5LDYgKzE0MDUsOSBAQCBzdGF0aWMgaW50IGlsa19nYW1tYV9wcmVj
aXNpb24oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAKIHN0YXRp
YyBpbnQgY2h2X2dhbW1hX3ByZWNpc2lvbihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSkKIHsKKwlpZiAoIWNydGNfc3RhdGUtPmdhbW1hX2VuYWJsZSkKKwkJcmV0dXJu
IDA7CisKIAlpZiAoY3J0Y19zdGF0ZS0+Y2dtX21vZGUgJiBDR01fUElQRV9NT0RFX0dBTU1BKQog
CQlyZXR1cm4gMTA7CiAJZWxzZQpAQCAtMTQwNyw2ICsxNDE2LDkgQEAgc3RhdGljIGludCBjaHZf
Z2FtbWFfcHJlY2lzaW9uKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRl
KQogCiBzdGF0aWMgaW50IGdsa19nYW1tYV9wcmVjaXNpb24oY29uc3Qgc3RydWN0IGludGVsX2Ny
dGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CisJaWYgKCFjcnRjX3N0YXRlLT5nYW1tYV9lbmFibGUp
CisJCXJldHVybiAwOworCiAJc3dpdGNoIChjcnRjX3N0YXRlLT5nYW1tYV9tb2RlKSB7CiAJY2Fz
ZSBHQU1NQV9NT0RFX01PREVfOEJJVDoKIAkJcmV0dXJuIDg7CkBAIC0xNDE4LDIxICsxNDMwLDM5
IEBAIHN0YXRpYyBpbnQgZ2xrX2dhbW1hX3ByZWNpc2lvbihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAl9CiB9CiAKK3N0YXRpYyBpbnQgaWNsX2dhbW1hX3ByZWNp
c2lvbihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3sKKwlpZiAo
KGNydGNfc3RhdGUtPmdhbW1hX21vZGUgJiBQT1NUX0NTQ19HQU1NQV9FTkFCTEUpID09IDApCisJ
CXJldHVybiAwOworCisJc3dpdGNoIChjcnRjX3N0YXRlLT5nYW1tYV9tb2RlICYgR0FNTUFfTU9E
RV9NT0RFX01BU0spIHsKKwljYXNlIEdBTU1BX01PREVfTU9ERV84QklUOgorCQlyZXR1cm4gODsK
KwljYXNlIEdBTU1BX01PREVfTU9ERV8xMEJJVDoKKwkJcmV0dXJuIDEwOworCWNhc2UgR0FNTUFf
TU9ERV9NT0RFXzEyQklUX01VTFRJX1NFR01FTlRFRDoKKwkJcmV0dXJuIDE2OyAgCisJZGVmYXVs
dDoKKwkJTUlTU0lOR19DQVNFKGNydGNfc3RhdGUtPmdhbW1hX21vZGUpOworCQlyZXR1cm4gMDsK
Kwl9CisKK30KKwogaW50IGludGVsX2NvbG9yX2dldF9nYW1tYV9iaXRfcHJlY2lzaW9uKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT5iYXNlLmNydGMpOwogCXN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwog
Ci0JaWYgKCFjcnRjX3N0YXRlLT5nYW1tYV9lbmFibGUpCi0JCXJldHVybiAwOwotCiAJaWYgKEhB
U19HTUNIKGRldl9wcml2KSkgewogCQlpZiAoSVNfQ0hFUlJZVklFVyhkZXZfcHJpdikpCiAJCQly
ZXR1cm4gY2h2X2dhbW1hX3ByZWNpc2lvbihjcnRjX3N0YXRlKTsKIAkJZWxzZQogCQkJcmV0dXJu
IGk5eHhfZ2FtbWFfcHJlY2lzaW9uKGNydGNfc3RhdGUpOwogCX0gZWxzZSB7Ci0JCWlmIChJU19D
QU5OT05MQUtFKGRldl9wcml2KSB8fCBJU19HRU1JTklMQUtFKGRldl9wcml2KSkKKwkJaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCisJCQlyZXR1cm4gaWNsX2dhbW1hX3ByZWNpc2lvbihj
cnRjX3N0YXRlKTsKKwkJZWxzZSBpZiAoSVNfQ0FOTk9OTEFLRShkZXZfcHJpdikgfHwgSVNfR0VN
SU5JTEFLRShkZXZfcHJpdikpCiAJCQlyZXR1cm4gZ2xrX2dhbW1hX3ByZWNpc2lvbihjcnRjX3N0
YXRlKTsKIAkJZWxzZSBpZiAoSVNfSVJPTkxBS0UoZGV2X3ByaXYpKQogCQkJcmV0dXJuIGlsa19n
YW1tYV9wcmVjaXNpb24oY3J0Y19zdGF0ZSk7CkBAIC0xNDYzLDYgKzE0OTMsMzAgQEAgc3RhdGlj
IGJvb2wgaW50ZWxfY29sb3JfbHV0X2VudHJ5X2VxdWFsKHN0cnVjdCBkcm1fY29sb3JfbHV0ICps
dXQxLAogCXJldHVybiB0cnVlOwogfQogCitzdGF0aWMgYm9vbCBpbnRlbF9jb2xvcl9sdXRfZW50
cnlfbXVsdGlfZXF1YWwoc3RydWN0IGRybV9jb2xvcl9sdXQgKmx1dDEsCisJCQkJCSAgICAgIHN0
cnVjdCBkcm1fY29sb3JfbHV0ICpsdXQyLAorCQkJCQkgICAgICBpbnQgbHV0X3NpemUsIHUzMiBl
cnIpCit7CisJaW50IGk7CisKKwlmb3IgKGkgPSAwOyBpIDwgOTsgaSsrKSB7CisJCWlmICghZXJy
X2NoZWNrKCZsdXQxW2ldLCAmbHV0MltpXSwgZXJyKSkKKwkJCXJldHVybiBmYWxzZTsKKwl9CisK
Kwlmb3IgKGkgPSAxOyBpIDwgIDI1NzsgaSsrKSB7CisJCWlmICghZXJyX2NoZWNrKCZsdXQxW2kg
KiA4XSwgJmx1dDJbaSAqIDhdLCBlcnIpKQorCQkJcmV0dXJuIGZhbHNlOworCX0KKworCWZvciAo
aSA9IDA7IGkgPCAyNTY7IGkrKykgeworCQlpZiAoIWVycl9jaGVjaygmbHV0MVtpICogOCAqIDEy
OF0sICZsdXQyW2kgKiA4ICogMTI4XSwgZXJyKSkKKwkJCXJldHVybiBmYWxzZTsKKwl9CisKKwly
ZXR1cm4gdHJ1ZTsKK30KKwogYm9vbCBpbnRlbF9jb2xvcl9sdXRfZXF1YWwoc3RydWN0IGRybV9w
cm9wZXJ0eV9ibG9iICpibG9iMSwKIAkJCSAgIHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqYmxv
YjIsCiAJCQkgICB1MzIgZ2FtbWFfbW9kZSwgdTMyIGJpdF9wcmVjaXNpb24pCkBAIC0xNDgxLDE2
ICsxNTM1LDggQEAgYm9vbCBpbnRlbF9jb2xvcl9sdXRfZXF1YWwoc3RydWN0IGRybV9wcm9wZXJ0
eV9ibG9iICpibG9iMSwKIAlsdXRfc2l6ZTIgPSBkcm1fY29sb3JfbHV0X3NpemUoYmxvYjIpOwog
CiAJLyogY2hlY2sgc3cgYW5kIGh3IGx1dCBzaXplICovCi0Jc3dpdGNoIChnYW1tYV9tb2RlKSB7
Ci0JY2FzZSBHQU1NQV9NT0RFX01PREVfOEJJVDoKLQljYXNlIEdBTU1BX01PREVfTU9ERV8xMEJJ
VDoKLQkJaWYgKGx1dF9zaXplMSAhPSBsdXRfc2l6ZTIpCi0JCQlyZXR1cm4gZmFsc2U7Ci0JCWJy
ZWFrOwotCWRlZmF1bHQ6Ci0JCU1JU1NJTkdfQ0FTRShnYW1tYV9tb2RlKTsKLQkJCXJldHVybiBm
YWxzZTsKLQl9CisJaWYgKGx1dF9zaXplMSAhPSBsdXRfc2l6ZTIpCisJCXJldHVybiBmYWxzZTsK
IAogCWx1dDEgPSBibG9iMS0+ZGF0YTsKIAlsdXQyID0gYmxvYjItPmRhdGE7CkBAIC0xNDk4LDEz
ICsxNTQ0LDE4IEBAIGJvb2wgaW50ZWxfY29sb3JfbHV0X2VxdWFsKHN0cnVjdCBkcm1fcHJvcGVy
dHlfYmxvYiAqYmxvYjEsCiAJZXJyID0gMHhmZmZmID4+IGJpdF9wcmVjaXNpb247CiAKIAkvKiBj
aGVjayBzdyBhbmQgaHcgbHV0IGVudHJ5IHRvIGJlIGVxdWFsICovCi0Jc3dpdGNoIChnYW1tYV9t
b2RlKSB7CisJc3dpdGNoIChnYW1tYV9tb2RlICYgR0FNTUFfTU9ERV9NT0RFX01BU0spIHsKIAlj
YXNlIEdBTU1BX01PREVfTU9ERV84QklUOgogCWNhc2UgR0FNTUFfTU9ERV9NT0RFXzEwQklUOgog
CQlpZiAoIWludGVsX2NvbG9yX2x1dF9lbnRyeV9lcXVhbChsdXQxLCBsdXQyLAogCQkJCQkJIGx1
dF9zaXplMiwgZXJyKSkKIAkJCXJldHVybiBmYWxzZTsKIAkJYnJlYWs7CisJY2FzZSBHQU1NQV9N
T0RFX01PREVfMTJCSVRfTVVMVElfU0VHTUVOVEVEOgorCQlpZiAoIWludGVsX2NvbG9yX2x1dF9l
bnRyeV9tdWx0aV9lcXVhbChsdXQxLCBsdXQyLAorCQkJCQkJICAgICAgIGx1dF9zaXplMiwgZXJy
KSkKKwkJCXJldHVybiBmYWxzZTsKKwkJYnJlYWs7CiAJZGVmYXVsdDoKIAkJTUlTU0lOR19DQVNF
KGdhbW1hX21vZGUpOwogCQkJcmV0dXJuIGZhbHNlOwpAQCAtMTc0NCw2ICsxNzk1LDE1NyBAQCBz
dGF0aWMgdm9pZCBnbGtfcmVhZF9sdXRzKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlKQogCQljcnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dCA9IGdsa19yZWFkX2x1dF8xMChjcnRj
X3N0YXRlLCBQQUxfUFJFQ19JTkRFWF9WQUxVRSgwKSk7CiB9CiAKK3N0YXRpYyBzdHJ1Y3QgZHJt
X2NvbG9yX2x1dCAqCitpY2xfY29tcHV0ZV9pbnRlcnBvbGF0ZWRfZ2FtbWFfYmxvYihzdHJ1Y3Qg
ZHJtX2NvbG9yX2x1dCAqdG1wX2x1dCwKKwkJCQkgICAgc3RydWN0IGRybV9jb2xvcl9sdXQgKmx1
dCwgdTMyIGx1dF9zaXplKQoreworCV9fdTE2IGFfcmVkLCBiX3JlZCwgYV9ncmVlbiwgYl9ncmVl
biwgYV9ibHVlLCBiX2JsdWU7CisJX191MTYgcmVkX3N0ZXAsIGdyZWVuX3N0ZXAsIGJsdWVfc3Rl
cDsKKwlpbnQgaSwgaiwgaywgbSwgbjsKKworCWZvciAoaSA9IDAsIGsgPSAwOyBrIDwgOTsgaSsr
LCBrKyspIHsKKwkJbHV0W2ldLnJlZCA9IHRtcF9sdXRba10ucmVkOworCQlsdXRbaV0uZ3JlZW4g
PSB0bXBfbHV0W2tdLmdyZWVuOworCQlsdXRbaV0uYmx1ZSA9IHRtcF9sdXRba10uYmx1ZTsKKwl9
CisKKwlmb3IgKGsgPSA5OyBrIDwgMjY0OyBrKyspIHsKKwkJYV9yZWQgPSB0bXBfbHV0W2tdLnJl
ZDsKKwkJYl9yZWQgPSB0bXBfbHV0W2sgKyAxXS5yZWQ7CisJCXJlZF9zdGVwID0gKGJfcmVkIC0g
YV9yZWQpIC8gODsKKworCQlhX2dyZWVuID0gdG1wX2x1dFtrXS5ncmVlbjsKKwkJYl9ncmVlbiA9
IHRtcF9sdXRbayArIDFdLmdyZWVuOworCQlncmVlbl9zdGVwID0gKGJfZ3JlZW4gLSBhX2dyZWVu
KSAvIDg7CisKKwkJYV9ibHVlID0gdG1wX2x1dFtrXS5ibHVlOworCQliX2JsdWUgPSB0bXBfbHV0
W2sgKyAxXS5ibHVlOworCQlibHVlX3N0ZXAgPSAoYl9ibHVlIC0gYV9ibHVlKSAvIDg7CisKKwkJ
Zm9yIChqID0gMDsgaiA8IDg7IGorKykgeworCQkJbHV0W2ldLnJlZCA9IGx1dFtpIC0gMV0ucmVk
ICsgcmVkX3N0ZXA7CisJCQlsdXRbaV0uZ3JlZW4gPSBsdXRbaSAtIDFdLmdyZWVuICsgZ3JlZW5f
c3RlcDsKKwkJCWx1dFtpXS5ibHVlID0gbHV0W2kgLSAxXS5ibHVlICsgYmx1ZV9zdGVwOworCisJ
CQlpKys7CisJCX0KKwl9CisKKwlmb3IgKGsgPSAyNjU7IGsgPCA1MjE7IGsrKykgeworCQlhX3Jl
ZCA9IHRtcF9sdXRba10ucmVkOworCQliX3JlZCA9IHRtcF9sdXRbayArIDFdLnJlZDsKKwkJcmVk
X3N0ZXAgPSAoKGJfcmVkIC0gYV9yZWQpIC8gMTI3KSAvIDg7CisKKwkJYV9ncmVlbiA9IHRtcF9s
dXRba10uZ3JlZW47CisJCWJfZ3JlZW4gPSB0bXBfbHV0W2sgKyAxXS5ncmVlbjsKKwkJZ3JlZW5f
c3RlcCA9ICgoYl9ncmVlbiAtIGFfZ3JlZW4pIC8gMTI3KSAvIDg7CisKKwkJYV9ibHVlID0gdG1w
X2x1dFtrXS5ibHVlOworCQliX2JsdWUgPSB0bXBfbHV0W2sgKyAxXS5ibHVlOworCQlibHVlX3N0
ZXAgPSAoKGJfYmx1ZSAtIGFfYmx1ZSkgLyAxMjcpIC8gODsKKworCQlmb3IgKG0gPSAwOyBtIDwg
MTI3OyBtKyspIHsKKwkJCWZvciAobiA9IDA7IG4gPCA4OyBuKyspIHsKKwkJCQlsdXRbaV0ucmVk
ID0gbHV0W2kgLSAxXS5yZWQgKyByZWRfc3RlcDsKKwkJCQlsdXRbaV0uZ3JlZW4gPSBsdXRbaSAt
IDFdLmdyZWVuICsgZ3JlZW5fc3RlcDsKKwkJCQlsdXRbaV0uYmx1ZSA9IGx1dFtpIC0gMV0uYmx1
ZSArIGJsdWVfc3RlcDsKKworCQkJCWkrKzsKKwkJCX0KKwkJfQorCX0KKworCXJldHVybiBsdXQ7
Cit9CisKK3N0YXRpYyBzdHJ1Y3QgZHJtX3Byb3BlcnR5X2Jsb2IgKgoraWNsX3JlYWRfbHV0X211
bHRpX3NlZyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3sKKwlz
dHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+YmFzZS5j
cnRjKTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMt
PmJhc2UuZGV2KTsKKwlpbnQgbHV0X3NpemUgPSBJTlRFTF9JTkZPKGRldl9wcml2KS0+Y29sb3Iu
Z2FtbWFfbHV0X3NpemU7CisJaW50IHRtcF9sdXRfc2l6ZSA9IDUyMjsKKwllbnVtIHBpcGUgcGlw
ZSA9IGNydGMtPnBpcGU7CisJc3RydWN0IGRybV9wcm9wZXJ0eV9ibG9iICpibG9iLCAqdG1wX2Js
b2I7CisJc3RydWN0IGRybV9jb2xvcl9sdXQgKmJsb2JfZGF0YSwgKnRtcF9ibG9iX2RhdGE7CisJ
dTMyIGksIHZhbDEsIHZhbDI7CisKKwlibG9iID0gZHJtX3Byb3BlcnR5X2NyZWF0ZV9ibG9iKCZk
ZXZfcHJpdi0+ZHJtLAorCQkJCQlzaXplb2Yoc3RydWN0IGRybV9jb2xvcl9sdXQpICogbHV0X3Np
emUsCisJCQkJCU5VTEwpOworCXRtcF9ibG9iID0gZHJtX3Byb3BlcnR5X2NyZWF0ZV9ibG9iKCZk
ZXZfcHJpdi0+ZHJtLAorCQkJCQkgICAgc2l6ZW9mKHN0cnVjdCBkcm1fY29sb3JfbHV0KSAqIHRt
cF9sdXRfc2l6ZSwKKwkJCQkJICAgIE5VTEwpOworCWlmIChJU19FUlIoYmxvYikgfHwgSVNfRVJS
KHRtcF9ibG9iKSkKKwkJcmV0dXJuIE5VTEw7CisKKwlibG9iX2RhdGEgPSBibG9iLT5kYXRhOwor
CXRtcF9ibG9iX2RhdGEgPSB0bXBfYmxvYi0+ZGF0YTsKKworCUk5MTVfV1JJVEUoUFJFQ19QQUxf
TVVMVElfU0VHX0lOREVYKHBpcGUpLCBQQUxfUFJFQ19BVVRPX0lOQ1JFTUVOVCk7CisKKwlmb3Ig
KGkgPSAwOyBpIDwgOTsgaSsrKSB7CisJCXZhbDEgPSBJOTE1X1JFQUQoUFJFQ19QQUxfTVVMVElf
U0VHX0RBVEEocGlwZSkpOworCQl2YWwyID0gSTkxNV9SRUFEKFBSRUNfUEFMX01VTFRJX1NFR19E
QVRBKHBpcGUpKTsKKworCQl0bXBfYmxvYl9kYXRhW2ldLnJlZCA9IFJFR19GSUVMRF9HRVQoUEFM
X1BSRUNfTVVMVElfU0VHX1JFRF9VRFdfTUFTSywgdmFsMikgPDwgNiB8CisJCQkJICAgICAgIFJF
R19GSUVMRF9HRVQoUEFMX1BSRUNfTVVMVElfU0VHX1JFRF9MRFdfTUFTSywgdmFsMSk7CisJCXRt
cF9ibG9iX2RhdGFbaV0uZ3JlZW4gPSBSRUdfRklFTERfR0VUKFBBTF9QUkVDX01VTFRJX1NFR19H
UkVFTl9VRFdfTUFTSywgdmFsMikgPDwgNiB8CisJCQkJCSBSRUdfRklFTERfR0VUKFBBTF9QUkVD
X01VTFRJX1NFR19HUkVFTl9MRFdfTUFTSywgdmFsMSk7CisJCXRtcF9ibG9iX2RhdGFbaV0uYmx1
ZSA9IFJFR19GSUVMRF9HRVQoUEFMX1BSRUNfTVVMVElfU0VHX0JMVUVfVURXX01BU0ssIHZhbDIp
IDw8IDYgfAorCQkJCQlSRUdfRklFTERfR0VUKFBBTF9QUkVDX01VTFRJX1NFR19CTFVFX0xEV19N
QVNLLCB2YWwxKTsKKwl9CisKKwlJOTE1X1dSSVRFKFBSRUNfUEFMX0lOREVYKHBpcGUpLCBQQUxf
UFJFQ19BVVRPX0lOQ1JFTUVOVCk7CisKKwlmb3IgKGkgPSAxOyBpIDwgMjU3OyBpKyspIHsKKwkJ
dmFsMSA9IEk5MTVfUkVBRChQUkVDX1BBTF9EQVRBKHBpcGUpKTsKKwkJdmFsMiA9IEk5MTVfUkVB
RChQUkVDX1BBTF9EQVRBKHBpcGUpKTsKKworCQl0bXBfYmxvYl9kYXRhW2kgKyA4XS5yZWQgPSBS
RUdfRklFTERfR0VUKFBBTF9QUkVDX01VTFRJX1NFR19SRURfVURXX01BU0ssIHZhbDIpIDw8IDYg
fAorCQkJCQkgICBSRUdfRklFTERfR0VUKFBBTF9QUkVDX01VTFRJX1NFR19SRURfTERXX01BU0ss
IHZhbDEpOworCQl0bXBfYmxvYl9kYXRhW2kgKyA4XS5ncmVlbiA9IFJFR19GSUVMRF9HRVQoUEFM
X1BSRUNfTVVMVElfU0VHX0dSRUVOX1VEV19NQVNLLCB2YWwyKSA8PCA2IHwKKwkJCQkJICAgICBS
RUdfRklFTERfR0VUKFBBTF9QUkVDX01VTFRJX1NFR19HUkVFTl9MRFdfTUFTSywgdmFsMSk7CisJ
CXRtcF9ibG9iX2RhdGFbaSArIDhdLmJsdWUgPSBSRUdfRklFTERfR0VUKFBBTF9QUkVDX01VTFRJ
X1NFR19CTFVFX1VEV19NQVNLLCB2YWwyKSA8PCA2IHwKKwkJCQkJICAgIFJFR19GSUVMRF9HRVQo
UEFMX1BSRUNfTVVMVElfU0VHX0JMVUVfTERXX01BU0ssIHZhbDEpOworCX0KKworCWZvciAoaSA9
IDA7IGkgPCAyNTY7IGkrKykgeworCQl2YWwxID0gSTkxNV9SRUFEKFBSRUNfUEFMX0RBVEEocGlw
ZSkpOworCQl2YWwyID0gSTkxNV9SRUFEKFBSRUNfUEFMX0RBVEEocGlwZSkpOworCisJCXRtcF9i
bG9iX2RhdGFbaSArIDI2NV0ucmVkID0gUkVHX0ZJRUxEX0dFVChQQUxfUFJFQ19NVUxUSV9TRUdf
UkVEX1VEV19NQVNLLCB2YWwyKSA8PCA2IHwKKwkJCQkJICAgICBSRUdfRklFTERfR0VUKFBBTF9Q
UkVDX01VTFRJX1NFR19SRURfTERXX01BU0ssIHZhbDEpOworCQl0bXBfYmxvYl9kYXRhW2kgKyAy
NjVdLmdyZWVuID0gUkVHX0ZJRUxEX0dFVChQQUxfUFJFQ19NVUxUSV9TRUdfR1JFRU5fVURXX01B
U0ssIHZhbDIpIDw8IDYgfAorCQkJCQkgICAgICAgUkVHX0ZJRUxEX0dFVChQQUxfUFJFQ19NVUxU
SV9TRUdfR1JFRU5fTERXX01BU0ssIHZhbDEpOworCQl0bXBfYmxvYl9kYXRhW2kgKyAyNjVdLmJs
dWUgPSBSRUdfRklFTERfR0VUKFBBTF9QUkVDX01VTFRJX1NFR19CTFVFX1VEV19NQVNLLCB2YWwy
KSA8PCA2IHwKKwkJCQkJICAgICAgUkVHX0ZJRUxEX0dFVChQQUxfUFJFQ19NVUxUSV9TRUdfQkxV
RV9MRFdfTUFTSywgdmFsMSk7CisJfQorCisJdG1wX2Jsb2JfZGF0YVs1MjFdLnJlZCA9IFJFR19G
SUVMRF9HRVQoUFJFQ19QQUxfR0NfTUFYX1JHQl9NQVNLLAorCQkJCQkgICAgICAgSTkxNV9SRUFE
KFBSRUNfUEFMX0dDX01BWChwaXBlLCAwKSkpOworCXRtcF9ibG9iX2RhdGFbNTIxXS5ncmVlbiA9
IFJFR19GSUVMRF9HRVQoUFJFQ19QQUxfR0NfTUFYX1JHQl9NQVNLLAorCQkJCQkJIEk5MTVfUkVB
RChQUkVDX1BBTF9HQ19NQVgocGlwZSwgMSkpKTsKKwl0bXBfYmxvYl9kYXRhWzUyMV0uYmx1ZSA9
IFJFR19GSUVMRF9HRVQoUFJFQ19QQUxfR0NfTUFYX1JHQl9NQVNLLAorCQkJCQkJSTkxNV9SRUFE
KFBSRUNfUEFMX0dDX01BWChwaXBlLCAxKSkpOworCisJYmxvYl9kYXRhID0gaWNsX2NvbXB1dGVf
aW50ZXJwb2xhdGVkX2dhbW1hX2Jsb2IodG1wX2Jsb2JfZGF0YSwgYmxvYl9kYXRhLCBsdXRfc2l6
ZSk7CisKKwlyZXR1cm4gYmxvYjsKK30KKworc3RhdGljIHZvaWQgaWNsX3JlYWRfbHV0cyhzdHJ1
Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3sKKwlpZiAoKGNydGNfc3RhdGUtPmdh
bW1hX21vZGUgJiBHQU1NQV9NT0RFX01PREVfTUFTSykgPT0KKwkgICAgR0FNTUFfTU9ERV9NT0RF
XzhCSVQpCisJCWNydGNfc3RhdGUtPmJhc2UuZ2FtbWFfbHV0ID0gaTl4eF9yZWFkX2x1dF84KGNy
dGNfc3RhdGUpOworCWVsc2UgaWYgKChjcnRjX3N0YXRlLT5nYW1tYV9tb2RlICYgR0FNTUFfTU9E
RV9NT0RFX01BU0spID09CisJCSBHQU1NQV9NT0RFX01PREVfMTJCSVRfTVVMVElfU0VHTUVOVEVE
KQorCQljcnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dCA9IGljbF9yZWFkX2x1dF9tdWx0aV9zZWco
Y3J0Y19zdGF0ZSk7CisJZWxzZQorCQljcnRjX3N0YXRlLT5iYXNlLmdhbW1hX2x1dCA9IGdsa19y
ZWFkX2x1dF8xMChjcnRjX3N0YXRlLCBQQUxfUFJFQ19JTkRFWF9WQUxVRSgwKSk7Cit9CisKIHZv
aWQgaW50ZWxfY29sb3JfaW5pdChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKIHsKIAlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKQEAg
LTE3ODUsMTYgKzE5ODcsMTcgQEAgdm9pZCBpbnRlbF9jb2xvcl9pbml0KHN0cnVjdCBpbnRlbF9j
cnRjICpjcnRjKQogCQllbHNlCiAJCQlkZXZfcHJpdi0+ZGlzcGxheS5jb2xvcl9jb21taXQgPSBp
bGtfY29sb3JfY29tbWl0OwogCi0JCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDExKQorCQlp
ZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkgewogCQkJZGV2X3ByaXYtPmRpc3BsYXkubG9h
ZF9sdXRzID0gaWNsX2xvYWRfbHV0czsKLQkJZWxzZSBpZiAoSVNfQ0FOTk9OTEFLRShkZXZfcHJp
dikgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpIHsKKwkJCWRldl9wcml2LT5kaXNwbGF5LnJl
YWRfbHV0cyA9IGljbF9yZWFkX2x1dHM7CisJCX0gZWxzZSBpZiAoSVNfQ0FOTk9OTEFLRShkZXZf
cHJpdikgfHwgSVNfR0VNSU5JTEFLRShkZXZfcHJpdikpIHsKIAkJCWRldl9wcml2LT5kaXNwbGF5
LmxvYWRfbHV0cyA9IGdsa19sb2FkX2x1dHM7CiAJCQlkZXZfcHJpdi0+ZGlzcGxheS5yZWFkX2x1
dHMgPSBnbGtfcmVhZF9sdXRzOwotCQl9IGVsc2UgaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
OCkKKwkJfSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDgpIHsKIAkJCWRldl9wcml2
LT5kaXNwbGF5LmxvYWRfbHV0cyA9IGJkd19sb2FkX2x1dHM7Ci0JCWVsc2UgaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPj0gNykKKwkJfSBlbHNlIGlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDcp
IHsKIAkJCWRldl9wcml2LT5kaXNwbGF5LmxvYWRfbHV0cyA9IGl2Yl9sb2FkX2x1dHM7Ci0JCWVs
c2UgeworCQl9IGVsc2UgewogCQkJZGV2X3ByaXYtPmRpc3BsYXkubG9hZF9sdXRzID0gaWxrX2xv
YWRfbHV0czsKIAkJCWRldl9wcml2LT5kaXNwbGF5LnJlYWRfbHV0cyA9IGlsa19yZWFkX2x1dHM7
CiAJCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmggYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oCmluZGV4IGJmMzdlY2UuLjg0NGRkNjIgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmgKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9yZWcuaApAQCAtMTAzNzgsNiArMTAzNzgsNyBAQCBlbnVtIHNrbF9wb3dl
cl9nYXRlIHsKIAogI2RlZmluZSBQUkVDX1BBTF9JTkRFWChwaXBlKQkJX01NSU9fUElQRShwaXBl
LCBfUEFMX1BSRUNfSU5ERVhfQSwgX1BBTF9QUkVDX0lOREVYX0IpCiAjZGVmaW5lIFBSRUNfUEFM
X0RBVEEocGlwZSkJCV9NTUlPX1BJUEUocGlwZSwgX1BBTF9QUkVDX0RBVEFfQSwgX1BBTF9QUkVD
X0RBVEFfQikKKyNkZWZpbmUgUFJFQ19QQUxfR0NfTUFYX1JHQl9NQVNLCSBSRUdfR0VOTUFTSygx
NSwgMCkKICNkZWZpbmUgUFJFQ19QQUxfR0NfTUFYKHBpcGUsIGkpCV9NTUlPKF9QSVBFKHBpcGUs
IF9QQUxfUFJFQ19HQ19NQVhfQSwgX1BBTF9QUkVDX0dDX01BWF9CKSArIChpKSAqIDQpCiAjZGVm
aW5lIFBSRUNfUEFMX0VYVF9HQ19NQVgocGlwZSwgaSkJX01NSU8oX1BJUEUocGlwZSwgX1BBTF9Q
UkVDX0VYVF9HQ19NQVhfQSwgX1BBTF9QUkVDX0VYVF9HQ19NQVhfQikgKyAoaSkgKiA0KQogI2Rl
ZmluZSBQUkVDX1BBTF9FWFQyX0dDX01BWChwaXBlLCBpKQlfTU1JTyhfUElQRShwaXBlLCBfUEFM
X1BSRUNfRVhUMl9HQ19NQVhfQSwgX1BBTF9QUkVDX0VYVDJfR0NfTUFYX0IpICsgKGkpICogNCkK
QEAgLTEwNDAxLDYgKzEwNDAyLDEyIEBAIGVudW0gc2tsX3Bvd2VyX2dhdGUgewogCiAjZGVmaW5l
IF9QQUxfUFJFQ19NVUxUSV9TRUdfREFUQV9BCTB4NEE0MEMKICNkZWZpbmUgX1BBTF9QUkVDX01V
TFRJX1NFR19EQVRBX0IJMHg0QUMwQworI2RlZmluZSAgUEFMX1BSRUNfTVVMVElfU0VHX1JFRF9M
RFdfTUFTSyAgIFJFR19HRU5NQVNLKDI5LCAyNCkKKyNkZWZpbmUgIFBBTF9QUkVDX01VTFRJX1NF
R19SRURfVURXX01BU0sgICBSRUdfR0VOTUFTSygyOSwgMjApCisjZGVmaW5lICBQQUxfUFJFQ19N
VUxUSV9TRUdfR1JFRU5fTERXX01BU0sgUkVHX0dFTk1BU0soMTksIDE0KQorI2RlZmluZSAgUEFM
X1BSRUNfTVVMVElfU0VHX0dSRUVOX1VEV19NQVNLIFJFR19HRU5NQVNLKDE5LCAxMCkKKyNkZWZp
bmUgIFBBTF9QUkVDX01VTFRJX1NFR19CTFVFX0xEV19NQVNLICBSRUdfR0VOTUFTSyg5LCA0KQor
I2RlZmluZSAgUEFMX1BSRUNfTVVMVElfU0VHX0JMVUVfVURXX01BU0sgIFJFR19HRU5NQVNLKDks
IDApCiAKICNkZWZpbmUgUFJFQ19QQUxfTVVMVElfU0VHX0lOREVYKHBpcGUpCV9NTUlPX1BJUEUo
cGlwZSwgXAogCQkJCQlfUEFMX1BSRUNfTVVMVElfU0VHX0lOREVYX0EsIFwKLS0gCjEuOS4xCgpf
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZngg
bWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0
cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

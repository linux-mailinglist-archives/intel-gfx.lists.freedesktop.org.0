Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 6B808AD5B8
	for <lists+intel-gfx@lfdr.de>; Mon,  9 Sep 2019 11:31:44 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E57F589A94;
	Mon,  9 Sep 2019 09:31:40 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga12.intel.com (mga12.intel.com [192.55.52.136])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 02DD789A9F
 for <intel-gfx@lists.freedesktop.org>; Mon,  9 Sep 2019 09:31:36 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga005.jf.intel.com ([10.7.209.41])
 by fmsmga106.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 09 Sep 2019 02:31:35 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,484,1559545200"; d="scan'208";a="359433724"
Received: from hoernig-mobl.ger.corp.intel.com (HELO delly.ger.corp.intel.com)
 ([10.249.33.104])
 by orsmga005.jf.intel.com with ESMTP; 09 Sep 2019 02:31:34 -0700
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  9 Sep 2019 12:31:13 +0300
Message-Id: <20190909093116.7747-11-lionel.g.landwerlin@intel.com>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190909093116.7747-1-lionel.g.landwerlin@intel.com>
References: <20190909093116.7747-1-lionel.g.landwerlin@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v16 10/13] drm/i915/perf: execute OA
 configuration from command stream
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgaGF2ZW4ndCBydW4gaW50byBpc3N1ZXMgd2l0aCBwcm9ncmFtbWluZyB0aGUgZ2xvYmFsIE9B
L05PQQpyZWdpc3RlcnMgY29uZmlndXJhdGlvbiBmcm9tIENQVSBzbyBmYXIsIGJ1dCBIVyBlbmdp
bmVlcnMgYWN0dWFsbHkKcmVjb21tZW5kIGRvaW5nIHRoaXMgZnJvbSB0aGUgY29tbWFuZCBzdHJl
YW1lci4gT24gVEdMIGluIHBhcnRpY3VsYXIKb25lIG9mIHRoZSBjbG9jayBkb21haW4gaW4gd2hp
Y2ggc29tZSBvZiB0aGF0IHByb2dyYW1taW5nIGdvZXMgbWlnaHQKbm90IGJlIHBvd2VyZWQgd2hl
biB3ZSBwb2tlIHRoaW5ncyBmcm9tIHRoZSBDUFUuCgpTaW5jZSB3ZSBoYXZlIGEgY29tbWFuZCBi
dWZmZXIgcHJlcGFyZWQgZm9yIHRoZSBleGVjYnVmZmVyIHNpZGUgb2YKdGhpbmdzLCB3ZSBjYW4g
cmV1c2UgdGhhdCBhcHByb2FjaCBoZXJlIHRvby4KClRoaXMgYWxzbyBhbGxvd3MgdXMgdG8gc2ln
bmlmaWNhbnRseSByZWR1Y2UgdGhlIGFtb3VudCBvZiB0aW1lIHdlIGhvbGQKdGhlIG1haW4gbG9j
ay4KCnYyOiBEcm9wIHRoZSBnbG9iYWwgbG9jayBhcyBtdWNoIGFzIHBvc3NpYmxlCgp2MzogVGFr
ZSBnbG9iYWwgbG9jayB0byBwaW4gZ2xvYmFsCgp2NDogQ3JlYXRlIGk5MTUgcmVxdWVzdCBpbiBl
bWl0X29hX2NvbmZpZygpIHRvIGF2b2lkIGRlYWRsb2NrcyAoTGlvbmVsKQoKdjU6IE1vdmUgbG9j
a2luZyB0byB0aGUgc3RyZWFtIChMaW9uZWwpCgp2NjogTW92ZSBhY3RpdmUgcmVjb25maWd1cmF0
aW9uIHJlcXVlc3QgaW50byBpOTE1X3BlcmZfc3RyZWFtIChMaW9uZWwpCgp2NzogUGluIFZNQSBv
dXRzaWRlIHJlcXVlc3QgY3JlYXRpb24gKENocmlzKQogICAgTG9jayBWTUEgYmVmb3JlIG1vdmUg
dG8gYWN0aXZlIChDaHJpcykKCnY4OiBGaXggZG91YmxlIGZyZWUgb24gc3RyZWFtLT5pbml0aWFs
X29hX2NvbmZpZ19ibyAoTGlvbmVsKQogICAgRG9uJ3QgYWxsb3cgaW50ZXJydXB0aW9uIHdoZW4g
d2FpdGluZyBvbiBhY3RpdmUgY29uZmlnIHJlcXVlc3QKICAgIChMaW9uZWwpCgp2OTogRG9uJ3Qg
aWdub3JlIHJldHVybiB2YWx1ZSBmcm9tIGk5MTVfYWN0aXZlX3JlcXVlc3RfcmV0aXJlIChMaW9u
ZWwpCgpTaWduZWQtb2ZmLWJ5OiBMaW9uZWwgTGFuZHdlcmxpbiA8bGlvbmVsLmcubGFuZHdlcmxp
bkBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgICAgICAg
fCAxNzQgKysrKysrKysrKysrKysrKy0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9wZXJmX3R5cGVzLmggfCAgMTUgKystCiAyIGZpbGVzIGNoYW5nZWQsIDEyOCBpbnNlcnRpb25z
KCspLCA2MSBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3BlcmYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jCmluZGV4IGQwMTQ5
NDE4MDQ2NS4uOTI5YWI1NGVlMzcxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3BlcmYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYwpAQCAtMTU1
NywxOCArMTU1NywyMyBAQCBmcmVlX29hX2NvbmZpZ3Moc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0g
KnN0cmVhbSkKIHN0YXRpYyB2b2lkIGk5MTVfb2Ffc3RyZWFtX2Rlc3Ryb3koc3RydWN0IGk5MTVf
cGVyZl9zdHJlYW0gKnN0cmVhbSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSBzdHJlYW0tPmRldl9wcml2OworCWludCBlcnI7CiAKIAlCVUdfT04oc3RyZWFtICE9IGRl
dl9wcml2LT5wZXJmLmV4Y2x1c2l2ZV9zdHJlYW0pOwogCi0JLyoKLQkgKiBVbnNldCBleGNsdXNp
dmVfc3RyZWFtIGZpcnN0LCBpdCB3aWxsIGJlIGNoZWNrZWQgd2hpbGUgZGlzYWJsaW5nCi0JICog
dGhlIG1ldHJpYyBzZXQgb24gZ2VuOCsuCi0JICovCiAJbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwotCWRldl9wcml2LT5wZXJmLmV4Y2x1c2l2ZV9zdHJlYW0gPSBOVUxM
OworCW11dGV4X2xvY2soJnN0cmVhbS0+Y29uZmlnX211dGV4KTsKIAlkZXZfcHJpdi0+cGVyZi5v
cHMuZGlzYWJsZV9tZXRyaWNfc2V0KHN0cmVhbSk7CisJZXJyID0gaTkxNV9hY3RpdmVfcmVxdWVz
dF9yZXRpcmUoJnN0cmVhbS0+YWN0aXZlX2NvbmZpZ19ycSwgMCwKKwkJCQkJICZzdHJlYW0tPmNv
bmZpZ19tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZzdHJlYW0tPmNvbmZpZ19tdXRleCk7CisJZGV2
X3ByaXYtPnBlcmYuZXhjbHVzaXZlX3N0cmVhbSA9IE5VTEw7CiAJbXV0ZXhfdW5sb2NrKCZkZXZf
cHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKKwlpZiAoZXJyKQorCQlEUk1fRVJST1IoIkZhaWxl
ZCB0byBkaXNhYmxlIHBlcmYgc3RyZWFtXG4iKTsKKworCiAJZnJlZV9vYV9idWZmZXIoc3RyZWFt
KTsKIAlmcmVlX25vYV93YWl0KHN0cmVhbSk7CiAKQEAgLTE3OTQsNiArMTc5OSwxMCBAQCBzdGF0
aWMgaW50IGFsbG9jX25vYV93YWl0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiAJ
CXJldHVybiBQVFJfRVJSKGJvKTsKIAl9CiAKKwlyZXQgPSBpOTE1X211dGV4X2xvY2tfaW50ZXJy
dXB0aWJsZSgmaTkxNS0+ZHJtKTsKKwlpZiAocmV0KQorCQlnb3RvIGVycl91bnJlZjsKKwogCS8q
CiAJICogV2UgcGluIGluIEdHVFQgYmVjYXVzZSB3ZSBqdW1wIGludG8gdGhpcyBidWZmZXIgbm93
IGJlY2F1c2UKIAkgKiBtdWx0aXBsZSBPQSBjb25maWcgQk9zIHdpbGwgaGF2ZSBhIGp1bXAgdG8g
dGhpcyBhZGRyZXNzIGFuZCBpdApAQCAtMTgwMSwxMCArMTgxMCwxMyBAQCBzdGF0aWMgaW50IGFs
bG9jX25vYV93YWl0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiAJICovCiAJdm1h
ID0gaTkxNV9nZW1fb2JqZWN0X2dndHRfcGluKGJvLCBOVUxMLCAwLCA0MDk2LCAwKTsKIAlpZiAo
SVNfRVJSKHZtYSkpIHsKKwkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
IAkJcmV0ID0gUFRSX0VSUih2bWEpOwogCQlnb3RvIGVycl91bnJlZjsKIAl9CiAKKwltdXRleF91
bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCiAJYmF0Y2ggPSBjcyA9IGk5MTVfZ2Vt
X29iamVjdF9waW5fbWFwKGJvLCBJOTE1X01BUF9XQik7CiAJaWYgKElTX0VSUihiYXRjaCkpIHsK
IAkJcmV0ID0gUFRSX0VSUihiYXRjaCk7CkBAIC0xOTM4LDcgKzE5NTAsOSBAQCBzdGF0aWMgaW50
IGFsbG9jX25vYV93YWl0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiAJcmV0dXJu
IDA7CiAKIGVycl91bnBpbjoKLQlfX2k5MTVfdm1hX3VucGluKHZtYSk7CisJbXV0ZXhfbG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJaTkxNV92bWFfdW5waW5fYW5kX3JlbGVhc2UoJnZt
YSwgMCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogZXJyX3Vu
cmVmOgogCWk5MTVfZ2VtX29iamVjdF9wdXQoYm8pOwpAQCAtMTk0Niw1MCArMTk2MCw3MyBAQCBz
dGF0aWMgaW50IGFsbG9jX25vYV93YWl0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0p
CiAJcmV0dXJuIHJldDsKIH0KIAotc3RhdGljIHZvaWQgY29uZmlnX29hX3JlZ3Moc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAotCQkJICAgY29uc3Qgc3RydWN0IGk5MTVfb2FfcmVn
ICpyZWdzLAotCQkJICAgdTMyIG5fcmVncykKK3N0YXRpYyBpbnQgZW1pdF9vYV9jb25maWcoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCisJCQkgIHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFt
ICpzdHJlYW0pCiB7Ci0JdTMyIGk7CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJc3RydWN0
IGk5MTVfdm1hICp2bWE7CisJdTMyICpjczsKKwlpbnQgZXJyOwogCi0JZm9yIChpID0gMDsgaSA8
IG5fcmVnczsgaSsrKSB7Ci0JCWNvbnN0IHN0cnVjdCBpOTE1X29hX3JlZyAqcmVnID0gcmVncyAr
IGk7CisJbG9ja2RlcF9hc3NlcnRfaGVsZCgmc3RyZWFtLT5jb25maWdfbXV0ZXgpOworCisJdm1h
ID0gaTkxNV92bWFfaW5zdGFuY2Uoc3RyZWFtLT5pbml0aWFsX29hX2NvbmZpZ19ibywKKwkJCQkm
c3RyZWFtLT5lbmdpbmUtPmd0LT5nZ3R0LT52bSwgTlVMTCk7CisJaWYgKHVubGlrZWx5KElTX0VS
Uih2bWEpKSkKKwkJcmV0dXJuIFBUUl9FUlIodm1hKTsKKworCWVyciA9IGk5MTVfdm1hX3Bpbih2
bWEsIDAsIDAsIFBJTl9HTE9CQUwpOworCWlmIChlcnIpCisJCWdvdG8gZXJyX3ZtYV91bnBpbjsK
IAotCQlJOTE1X1dSSVRFKHJlZy0+YWRkciwgcmVnLT52YWx1ZSk7CisJcnEgPSBpOTE1X3JlcXVl
c3RfY3JlYXRlKHN0cmVhbS0+ZW5naW5lLT5rZXJuZWxfY29udGV4dCk7CisJaWYgKElTX0VSUihy
cSkpIHsKKwkJZXJyID0gUFRSX0VSUihycSk7CisJCWdvdG8gZXJyX2FkZF9yZXF1ZXN0OwogCX0K
LX0KIAotc3RhdGljIHZvaWQgZGVsYXlfYWZ0ZXJfbXV4KHZvaWQpCi17Ci0JLyoKLQkgKiBJdCBh
cHBhcmVudGx5IHRha2VzIGEgZmFpcmx5IGxvbmcgdGltZSBmb3IgYSBuZXcgTVVYCi0JICogY29u
ZmlndXJhdGlvbiB0byBiZSBiZSBhcHBsaWVkIGFmdGVyIHRoZXNlIHJlZ2lzdGVyIHdyaXRlcy4K
LQkgKiBUaGlzIGRlbGF5IGR1cmF0aW9uIHdhcyBkZXJpdmVkIGVtcGlyaWNhbGx5IGJhc2VkIG9u
IHRoZQotCSAqIHJlbmRlcl9iYXNpYyBjb25maWcgYnV0IGhvcGVmdWxseSBpdCBjb3ZlcnMgdGhl
IG1heGltdW0KLQkgKiBjb25maWd1cmF0aW9uIGxhdGVuY3kuCi0JICoKLQkgKiBBcyBhIGZhbGxi
YWNrLCB0aGUgY2hlY2tzIGluIF9hcHBlbmRfb2FfcmVwb3J0cygpIHRvIHNraXAKLQkgKiBpbnZh
bGlkIE9BIHJlcG9ydHMgZG8gYWxzbyBzZWVtIHRvIHdvcmsgdG8gZGlzY2FyZCByZXBvcnRzCi0J
ICogZ2VuZXJhdGVkIGJlZm9yZSB0aGlzIGNvbmZpZyBoYXMgY29tcGxldGVkIC0gYWxiZWl0IG5v
dAotCSAqIHNpbGVudGx5LgotCSAqCi0JICogVW5mb3J0dW5hdGVseSB0aGlzIGlzIGVzc2VudGlh
bGx5IGEgbWFnaWMgbnVtYmVyLCBzaW5jZSB3ZQotCSAqIGRvbid0IGN1cnJlbnRseSBrbm93IG9m
IGEgcmVsaWFibGUgbWVjaGFuaXNtIGZvciBwcmVkaWN0aW5nCi0JICogaG93IGxvbmcgdGhlIE1V
WCBjb25maWcgd2lsbCB0YWtlIHRvIGFwcGx5IGFuZCBiZXNpZGVzCi0JICogc2VlaW5nIGludmFs
aWQgcmVwb3J0cyB3ZSBkb24ndCBrbm93IG9mIGEgcmVsaWFibGUgd2F5IHRvCi0JICogZXhwbGlj
aXRseSBjaGVjayB0aGF0IHRoZSBNVVggY29uZmlnIGhhcyBsYW5kZWQuCi0JICoKLQkgKiBJdCdz
IGV2ZW4gcG9zc2libGUgd2UndmUgbWlzcyBjaGFyYWN0ZXJpemVkIHRoZSB1bmRlcmx5aW5nCi0J
ICogcHJvYmxlbSAtIGl0IGp1c3Qgc2VlbXMgbGlrZSB0aGUgc2ltcGxlc3QgZXhwbGFuYXRpb24g
d2h5Ci0JICogYSBkZWxheSBhdCB0aGlzIGxvY2F0aW9uIHdvdWxkIG1pdGlnYXRlIGFueSBpbnZh
bGlkIHJlcG9ydHMuCi0JICovCi0JdXNsZWVwX3JhbmdlKDE1MDAwLCAyMDAwMCk7CisJZXJyID0g
aTkxNV9hY3RpdmVfcmVxdWVzdF9zZXQoJnN0cmVhbS0+YWN0aXZlX2NvbmZpZ19ycSwKKwkJCQkg
ICAgICBycSk7CisJaWYgKGVycikKKwkJZ290byBlcnJfYWRkX3JlcXVlc3Q7CisKKwlpOTE1X3Zt
YV9sb2NrKHZtYSk7CisJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X29iamVjdChycSwgdm1hLT5v
YmosIDApOworCWlmICghZXJyKQorCQllcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZSh2bWEs
IHJxLCAwKTsKKwlpOTE1X3ZtYV91bmxvY2sodm1hKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl9h
ZGRfcmVxdWVzdDsKKworCWNzID0gaW50ZWxfcmluZ19iZWdpbihycSwgSU5URUxfR0VOKGk5MTUp
ID49IDggPyA0IDogMik7CisJaWYgKElTX0VSUihjcykpIHsKKwkJZXJyID0gUFRSX0VSUihjcyk7
CisJCWdvdG8gZXJyX2FkZF9yZXF1ZXN0OworCX0KKworCWlmIChJTlRFTF9HRU4oaTkxNSkgPiA4
KSB7CisJCSpjcysrID0gTUlfQkFUQ0hfQlVGRkVSX1NUQVJUX0dFTjg7CisJCSpjcysrID0gbG93
ZXJfMzJfYml0cyh2bWEtPm5vZGUuc3RhcnQpOworCQkqY3MrKyA9IHVwcGVyXzMyX2JpdHModm1h
LT5ub2RlLnN0YXJ0KTsKKwkJKmNzKysgPSBNSV9OT09QOworCX0gZWxzZSB7CisJCSpjcysrID0g
TUlfQkFUQ0hfQlVGRkVSX1NUQVJUOworCQkqY3MrKyA9IHZtYS0+bm9kZS5zdGFydDsKKwl9CisK
KwlpbnRlbF9yaW5nX2FkdmFuY2UocnEsIGNzKTsKKworZXJyX2FkZF9yZXF1ZXN0OgorCWk5MTVf
cmVxdWVzdF9hZGQocnEpOworZXJyX3ZtYV91bnBpbjoKKwlpOTE1X3ZtYV91bnBpbih2bWEpOwor
CisJcmV0dXJuIGVycjsKIH0KIAogc3RhdGljIGludCBoc3dfZW5hYmxlX21ldHJpY19zZXQoc3Ry
dWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSBzdHJlYW0tPmRldl9wcml2OwotCWNvbnN0IHN0cnVjdCBpOTE1X29hX2Nv
bmZpZyAqb2FfY29uZmlnID0gc3RyZWFtLT5vYV9jb25maWc7CiAKIAkvKgogCSAqIFBSTToKQEAg
LTIwMDYsMTMgKzIwNDMsNyBAQCBzdGF0aWMgaW50IGhzd19lbmFibGVfbWV0cmljX3NldChzdHJ1
Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogCUk5MTVfV1JJVEUoR0VONl9VQ0dDVEwxLCAo
STkxNV9SRUFEKEdFTjZfVUNHQ1RMMSkgfAogCQkJCSAgR0VONl9DU1VOSVRfQ0xPQ0tfR0FURV9E
SVNBQkxFKSk7CiAKLQljb25maWdfb2FfcmVncyhkZXZfcHJpdiwgb2FfY29uZmlnLT5tdXhfcmVn
cywgb2FfY29uZmlnLT5tdXhfcmVnc19sZW4pOwotCWRlbGF5X2FmdGVyX211eCgpOwotCi0JY29u
ZmlnX29hX3JlZ3MoZGV2X3ByaXYsIG9hX2NvbmZpZy0+Yl9jb3VudGVyX3JlZ3MsCi0JCSAgICAg
ICBvYV9jb25maWctPmJfY291bnRlcl9yZWdzX2xlbik7Ci0KLQlyZXR1cm4gMDsKKwlyZXR1cm4g
ZW1pdF9vYV9jb25maWcoZGV2X3ByaXYsIHN0cmVhbSk7CiB9CiAKIHN0YXRpYyB2b2lkIGhzd19k
aXNhYmxlX21ldHJpY19zZXQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKQEAgLTIz
NzEsMTMgKzI0MDIsNyBAQCBzdGF0aWMgaW50IGdlbjhfZW5hYmxlX21ldHJpY19zZXQoc3RydWN0
IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwogCi0J
Y29uZmlnX29hX3JlZ3MoZGV2X3ByaXYsIG9hX2NvbmZpZy0+bXV4X3JlZ3MsIG9hX2NvbmZpZy0+
bXV4X3JlZ3NfbGVuKTsKLQlkZWxheV9hZnRlcl9tdXgoKTsKLQotCWNvbmZpZ19vYV9yZWdzKGRl
dl9wcml2LCBvYV9jb25maWctPmJfY291bnRlcl9yZWdzLAotCQkgICAgICAgb2FfY29uZmlnLT5i
X2NvdW50ZXJfcmVnc19sZW4pOwotCi0JcmV0dXJuIDA7CisJcmV0dXJuIGVtaXRfb2FfY29uZmln
KGRldl9wcml2LCBzdHJlYW0pOwogfQogCiBzdGF0aWMgdm9pZCBnZW44X2Rpc2FibGVfbWV0cmlj
X3NldChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtKQpAQCAtMjU5Niw2ICsyNjIxLDkg
QEAgc3RhdGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFt
ICpzdHJlYW0sCiAKIAlzdHJlYW0tPmVuZ2luZSA9IHByb3BzLT5lbmdpbmU7CiAKKwlJTklUX0FD
VElWRV9SRVFVRVNUKCZzdHJlYW0tPmFjdGl2ZV9jb25maWdfcnEsCisJCQkgICAgJnN0cmVhbS0+
Y29uZmlnX211dGV4KTsKKwogCXN0cmVhbS0+c2FtcGxlX2ZsYWdzIHw9IFNBTVBMRV9PQV9SRVBP
UlQ7CiAJc3RyZWFtLT5zYW1wbGVfc2l6ZSArPSBmb3JtYXRfc2l6ZTsKIApAQCAtMjYyNCw4ICsy
NjUyLDkgQEAgc3RhdGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1X3BlcmZf
c3RyZWFtICpzdHJlYW0sCiAJCWdvdG8gZXJyX25vYV93YWl0X2FsbG9jOwogCX0KIAotCXJldCA9
IGk5MTVfcGVyZl9nZXRfb2FfY29uZmlnKGRldl9wcml2LCBwcm9wcy0+bWV0cmljc19zZXQsCi0J
CQkJICAgICAgJnN0cmVhbS0+b2FfY29uZmlnKTsKKwlyZXQgPSBpOTE1X3BlcmZfZ2V0X29hX2Nv
bmZpZ19hbmRfYm8oc3RyZWFtLCBwcm9wcy0+bWV0cmljc19zZXQsCisJCQkJCSAgICAgJnN0cmVh
bS0+b2FfY29uZmlnLAorCQkJCQkgICAgICZzdHJlYW0tPmluaXRpYWxfb2FfY29uZmlnX2JvKTsK
IAlpZiAocmV0KSB7CiAJCURSTV9ERUJVRygiSW52YWxpZCBPQSBjb25maWcgaWQ9JWlcbiIsIHBy
b3BzLT5tZXRyaWNzX3NldCk7CiAJCWdvdG8gZXJyX2NvbmZpZzsKQEAgLTI2NTcsMTYgKzI2ODYs
MzUgQEAgc3RhdGljIGludCBpOTE1X29hX3N0cmVhbV9pbml0KHN0cnVjdCBpOTE1X3BlcmZfc3Ry
ZWFtICpzdHJlYW0sCiAJc3RyZWFtLT5vcHMgPSAmaTkxNV9vYV9zdHJlYW1fb3BzOwogCWRldl9w
cml2LT5wZXJmLmV4Y2x1c2l2ZV9zdHJlYW0gPSBzdHJlYW07CiAKKwltdXRleF9sb2NrKCZzdHJl
YW0tPmNvbmZpZ19tdXRleCk7CiAJcmV0ID0gZGV2X3ByaXYtPnBlcmYub3BzLmVuYWJsZV9tZXRy
aWNfc2V0KHN0cmVhbSk7CiAJaWYgKHJldCkgeworCQlpbnQgZXJyOworCiAJCURSTV9ERUJVRygi
VW5hYmxlIHRvIGVuYWJsZSBtZXRyaWMgc2V0XG4iKTsKLQkJZ290byBlcnJfZW5hYmxlOworCQkv
KgorCQkgKiBJZ25vcmUgdGhlIHJldHVybiB2YWx1ZSBzaW5jZSB3ZSBhbHJlYWR5IGhhdmUgYW4g
ZXJyb3IgZnJvbQorCQkgKiB0aGUgZW5hYmxlIHZmdW5jLgorCQkgKi8KKwkJZXJyID0gaTkxNV9h
Y3RpdmVfcmVxdWVzdF9yZXRpcmUoJnN0cmVhbS0+YWN0aXZlX2NvbmZpZ19ycSwgMCwKKwkJCQkJ
CSAmc3RyZWFtLT5jb25maWdfbXV0ZXgpOworCQlpZiAoZXJyKQorCQkJRFJNX0VSUk9SKCJXYWl0
IG9uIE9BIGNvbmZpZ3VyYXRpb24gcmVxdWVzdCBmYWlsZWQuXG4iKTsKKwl9IGVsc2UgeworCQly
ZXQgPSBpOTE1X2FjdGl2ZV9yZXF1ZXN0X3JldGlyZSgmc3RyZWFtLT5hY3RpdmVfY29uZmlnX3Jx
LCAwLAorCQkJCQkJICZzdHJlYW0tPmNvbmZpZ19tdXRleCk7CiAJfQogCi0JRFJNX0RFQlVHKCJv
cGVuaW5nIHN0cmVhbSBvYSBjb25maWcgdXVpZD0lc1xuIiwgc3RyZWFtLT5vYV9jb25maWctPnV1
aWQpOwotCisJbXV0ZXhfdW5sb2NrKCZzdHJlYW0tPmNvbmZpZ19tdXRleCk7CiAJbXV0ZXhfdW5s
b2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKKwlpOTE1X2dlbV9vYmplY3RfcHV0
KHN0cmVhbS0+aW5pdGlhbF9vYV9jb25maWdfYm8pOworCXN0cmVhbS0+aW5pdGlhbF9vYV9jb25m
aWdfYm8gPSBOVUxMOworCWlmIChyZXQpCisJCWdvdG8gZXJyX2VuYWJsZTsKKworCURSTV9ERUJV
Rygib3BlbmluZyBzdHJlYW0gb2EgY29uZmlnIHV1aWQ9JXNcbiIsIHN0cmVhbS0+b2FfY29uZmln
LT51dWlkKTsKKwogCWhydGltZXJfaW5pdCgmc3RyZWFtLT5wb2xsX2NoZWNrX3RpbWVyLAogCQkg
ICAgIENMT0NLX01PTk9UT05JQywgSFJUSU1FUl9NT0RFX1JFTCk7CiAJc3RyZWFtLT5wb2xsX2No
ZWNrX3RpbWVyLmZ1bmN0aW9uID0gb2FfcG9sbF9jaGVja190aW1lcl9jYjsKQEAgLTI2NzYsOCAr
MjcyNCwxMSBAQCBzdGF0aWMgaW50IGk5MTVfb2Ffc3RyZWFtX2luaXQoc3RydWN0IGk5MTVfcGVy
Zl9zdHJlYW0gKnN0cmVhbSwKIAlyZXR1cm4gMDsKIAogZXJyX2VuYWJsZToKLQlkZXZfcHJpdi0+
cGVyZi5leGNsdXNpdmVfc3RyZWFtID0gTlVMTDsKKwltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJt
LnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfbG9jaygmc3RyZWFtLT5jb25maWdfbXV0ZXgpOwogCWRl
dl9wcml2LT5wZXJmLm9wcy5kaXNhYmxlX21ldHJpY19zZXQoc3RyZWFtKTsKKwltdXRleF91bmxv
Y2soJnN0cmVhbS0+Y29uZmlnX211dGV4KTsKKwlkZXZfcHJpdi0+cGVyZi5leGNsdXNpdmVfc3Ry
ZWFtID0gTlVMTDsKIAltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsK
IAogZXJyX2xvY2s6CkBAIC0yNjg5LDYgKzI3NDAsOSBAQCBzdGF0aWMgaW50IGk5MTVfb2Ffc3Ry
ZWFtX2luaXQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwKIAogCWZyZWVfb2FfY29u
ZmlncyhzdHJlYW0pOwogCisJaWYgKHN0cmVhbS0+aW5pdGlhbF9vYV9jb25maWdfYm8pCisJCWk5
MTVfZ2VtX29iamVjdF9wdXQoc3RyZWFtLT5pbml0aWFsX29hX2NvbmZpZ19ibyk7CisKIGVycl9j
b25maWc6CiAJZnJlZV9ub2Ffd2FpdChzdHJlYW0pOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3BlcmZfdHlwZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
cGVyZl90eXBlcy5oCmluZGV4IDE1ZWUwZDMzZTQ0Zi4uMjZjZGI2ODE5N2Y5IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmZfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3BlcmZfdHlwZXMuaApAQCAtMTUsOSArMTUsMTEgQEAKICNpbmNsdWRl
IDxsaW51eC91dWlkLmg+CiAjaW5jbHVkZSA8bGludXgvd2FpdC5oPgogCisjaW5jbHVkZSAiaTkx
NV9hY3RpdmVfdHlwZXMuaCIKICNpbmNsdWRlICJpOTE1X3JlZy5oIgogI2luY2x1ZGUgImludGVs
X3dha2VyZWYuaCIKIAorc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Q7CiBzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZTsKIHN0cnVjdCBmaWxlOwogc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQ7CkBAIC0x
NzUsNyArMTc3LDggQEAgc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gewogCWNvbnN0IHN0cnVjdCBp
OTE1X3BlcmZfc3RyZWFtX29wcyAqb3BzOwogCiAJLyoqCi0JICogQGFjdGl2ZV9jb25maWdfbXV0
ZXg6IFByb3RlY3RzIGFjY2VzcyB0byBAb2FfY29uZmlnICYgQG9hX2NvbmZpZ19ib3MuCisJICog
QGFjdGl2ZV9jb25maWdfbXV0ZXg6IFByb3RlY3RzIGFjY2VzcyB0byBAYWN0aXZlX2NvbmZpZ19y
cSwKKwkgKiBAb2FfY29uZmlnICYgQG9hX2NvbmZpZ19ib3MuCiAJICovCiAJc3RydWN0IG11dGV4
IGNvbmZpZ19tdXRleDsKIApAQCAtMTkwLDYgKzE5MywxNiBAQCBzdHJ1Y3QgaTkxNV9wZXJmX3N0
cmVhbSB7CiAJICovCiAJc3RydWN0IGxpc3RfaGVhZCBvYV9jb25maWdfYm9zOwogCisJLyoqCisJ
ICogQGFjdGl2ZV9jb25maWdfcnE6IExhc3QgcmVxdWVzdCByZWNvbmZpZ3VyaW5nIHRoZSBIVy4K
KwkgKi8KKwlzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCBhY3RpdmVfY29uZmlnX3JxOworCisJ
LyoqCisJICogQGluaXRpYWxfb2FfY29uZmlnX2JvOiBGaXJzdCBPQSBjb25maWd1cmF0aW9uIEJP
IHRvIGJlIHJ1bi4KKwkgKi8KKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqaW5pdGlhbF9v
YV9jb25maWdfYm87CisKIAkvKioKIAkgKiBUaGUgT0EgY29udGV4dCBzcGVjaWZpYyBpbmZvcm1h
dGlvbi4KIAkgKi8KLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGlu
Zm8vaW50ZWwtZ2Z4

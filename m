Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id E7E04F9D2B
	for <lists+intel-gfx@lfdr.de>; Tue, 12 Nov 2019 23:36:23 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 356596EC17;
	Tue, 12 Nov 2019 22:36:22 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 485B96EC13
 for <intel-gfx@lists.freedesktop.org>; Tue, 12 Nov 2019 22:36:16 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19180082-1500050 
 for multiple; Tue, 12 Nov 2019 22:36:02 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 12 Nov 2019 22:36:00 +0000
Message-Id: <20191112223600.30993-4-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191112223600.30993-1-chris@chris-wilson.co.uk>
References: <20191112223600.30993-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 4/4] drm/i915/selftests: Add coverage of mocs
 registers
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UHJvYmUgdGhlIG1vY3MgcmVnaXN0ZXJzIGZvciBuZXcgY29udGV4dHMgYW5kIGFjcm9zcyBHUFUg
cmVzZXRzLiBTaW1pbGFyCnRvIGludGVsX3dvcmthcm91bmRzLCB3ZSBoYXZlIHRhYmxlcyBvZiB3
aGF0IHJlZ2lzdGVyIHZhbHVlcyB3ZSBleHBlY3QKdG8gc2VlLCBzbyB2ZXJpZnkgdGhhdCB1c2Vy
IGNvbnRleHRzIGFyZSBhZmZlY3RlZCBieSB0aGVtLiBJbiB0aGUKZnV0dXJlLCB3ZSBzaG91bGQg
YWRkIHRlc3RzIHNpbWlsYXIgdG8gaW50ZWxfc3NldSB0byBjb3ZlciBkeW5hbWljCnJlY29uZmln
dXJhdGlvbnMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNv
bi5jby51az4KQ2M6IFByYXRoYXAgS3VtYXIgVmFsc2FuIDxwcmF0aGFwLmt1bWFyLnZhbHNhbkBp
bnRlbC5jb20+CkNjOiBNaWthIEt1b3BwYWxhIDxtaWthLmt1b3BwYWxhQGxpbnV4LmludGVsLmNv
bT4KUmV2aWV3ZWQtYnk6IFByYXRoYXAgS3VtYXIgVmFsc2FuIDxwcmF0aGFwLmt1bWFyLnZhbHNh
bkBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbW9jcy5jICAg
ICAgICAgIHwgICA0ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X21vY3MuYyAg
ICAgICB8IDQxOSArKysrKysrKysrKysrKysrKysKIC4uLi9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV9saXZlX3NlbGZ0ZXN0cy5oICB8ICAgMSArCiAzIGZpbGVzIGNoYW5nZWQsIDQyNCBpbnNlcnRp
b25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfbW9jcy5jCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbW9j
cy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbW9jcy5jCmluZGV4IDQ3ZDE2YTI0
MjE4My4uN2YyOTJhYWNhYTgxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9tb2NzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbW9jcy5jCkBA
IC00NjAsMyArNDYwLDcgQEAgdm9pZCBpbnRlbF9tb2NzX2luaXQoc3RydWN0IGludGVsX2d0ICpn
dCkKIAlpZiAoSEFTX0dMT0JBTF9NT0NTX1JFR0lTVEVSUyhndC0+aTkxNSkpCiAJCWluaXRfZ2xv
YmFsX21vY3MoZ3QpOwogfQorCisjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfU0VMRlRF
U1QpCisjaW5jbHVkZSAic2VsZnRlc3RfbW9jcy5jIgorI2VuZGlmCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9tb2NzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF9tb2NzLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAw
MDAwLi5hMzRkNGZiNTJmYTEKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF9tb2NzLmMKQEAgLTAsMCArMSw0MTkgQEAKKy8qCisgKiBTUERYLUxpY2Vu
c2UtSWRlbnRpZmllcjogTUlUCisgKgorICogQ29weXJpZ2h0IMKpIDIwMTkgSW50ZWwgQ29ycG9y
YXRpb24KKyAqLworCisjaW5jbHVkZSAiZ3QvaW50ZWxfZW5naW5lX3BtLmgiCisjaW5jbHVkZSAi
aTkxNV9zZWxmdGVzdC5oIgorCisjaW5jbHVkZSAiZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQu
aCIKKyNpbmNsdWRlICJzZWxmdGVzdHMvaWd0X3Jlc2V0LmgiCisjaW5jbHVkZSAic2VsZnRlc3Rz
L2lndF9zcGlubmVyLmgiCisKK3N0cnVjdCBsaXZlX21vY3MgeworCXN0cnVjdCBkcm1faTkxNV9t
b2NzX3RhYmxlIHRhYmxlOworCXN0cnVjdCBpOTE1X3ZtYSAqc2NyYXRjaDsKKwl2b2lkICp2YWRk
cjsKK307CisKK3N0YXRpYyBpbnQgcmVxdWVzdF9hZGRfc3luYyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycSwgaW50IGVycikKK3sKKwlpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKKwlpOTE1X3JlcXVlc3Rf
YWRkKHJxKTsKKwlpZiAoaTkxNV9yZXF1ZXN0X3dhaXQocnEsIDAsIEhaIC8gNSkgPCAwKQorCQll
cnIgPSAtRVRJTUU7CisJaTkxNV9yZXF1ZXN0X3B1dChycSk7CisKKwlyZXR1cm4gZXJyOworfQor
CitzdGF0aWMgaW50IHJlcXVlc3RfYWRkX3NwaW4oc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsIHN0
cnVjdCBpZ3Rfc3Bpbm5lciAqc3BpbikKK3sKKwlpbnQgZXJyID0gMDsKKworCWk5MTVfcmVxdWVz
dF9nZXQocnEpOworCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCWlmIChzcGluICYmICFpZ3Rfd2Fp
dF9mb3Jfc3Bpbm5lcihzcGluLCBycSkpCisJCWVyciA9IC1FVElNRTsKKwlpOTE1X3JlcXVlc3Rf
cHV0KHJxKTsKKworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKmNy
ZWF0ZV9zY3JhdGNoKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCit7CisJc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iajsKKwlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKKwlpbnQgZXJyOworCisJb2Jq
ID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChndC0+aTkxNSwgUEFHRV9TSVpFKTsK
KwlpZiAoSVNfRVJSKG9iaikpCisJCXJldHVybiBFUlJfQ0FTVChvYmopOworCisJaTkxNV9nZW1f
b2JqZWN0X3NldF9jYWNoZV9jb2hlcmVuY3kob2JqLCBJOTE1X0NBQ0hJTkdfQ0FDSEVEKTsKKwor
CXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgJmd0LT5nZ3R0LT52bSwgTlVMTCk7CisJaWYg
KElTX0VSUih2bWEpKSB7CisJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwkJcmV0dXJuIHZt
YTsKKwl9CisKKwllcnIgPSBpOTE1X3ZtYV9waW4odm1hLCAwLCAwLCBQSU5fR0xPQkFMKTsKKwlp
ZiAoZXJyKSB7CisJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwkJcmV0dXJuIEVSUl9QVFIo
ZXJyKTsKKwl9CisKKwlyZXR1cm4gdm1hOworfQorCitzdGF0aWMgaW50IGxpdmVfbW9jc19pbml0
KHN0cnVjdCBsaXZlX21vY3MgKmFyZywgc3RydWN0IGludGVsX2d0ICpndCkKK3sKKwlpbnQgZXJy
OworCisJaWYgKCFnZXRfbW9jc19zZXR0aW5ncyhndC0+aTkxNSwgJmFyZy0+dGFibGUpKQorCQly
ZXR1cm4gLUVJTlZBTDsKKworCWFyZy0+c2NyYXRjaCA9IGNyZWF0ZV9zY3JhdGNoKGd0KTsKKwlp
ZiAoSVNfRVJSKGFyZy0+c2NyYXRjaCkpCisJCXJldHVybiBQVFJfRVJSKGFyZy0+c2NyYXRjaCk7
CisKKwlhcmctPnZhZGRyID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAoYXJnLT5zY3JhdGNoLT5v
YmosIEk5MTVfTUFQX1dCKTsKKwlpZiAoSVNfRVJSKGFyZy0+dmFkZHIpKSB7CisJCWVyciA9IFBU
Ul9FUlIoYXJnLT52YWRkcik7CisJCWdvdG8gZXJyX3NjcmF0Y2g7CisJfQorCisJcmV0dXJuIDA7
CisKK2Vycl9zY3JhdGNoOgorCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZhcmctPnNjcmF0
Y2gsIDApOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyB2b2lkIGxpdmVfbW9jc19maW5pKHN0
cnVjdCBsaXZlX21vY3MgKmFyZykKK3sKKwlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmYXJn
LT5zY3JhdGNoLCBJOTE1X1ZNQV9SRUxFQVNFX01BUCk7Cit9CisKK3N0YXRpYyBpbnQgcmVhZF9y
ZWdzKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAorCQkgICAgIHUzMiBhZGRyLCB1bnNpZ25lZCBp
bnQgY291bnQsCisJCSAgICAgdWludDMyX3QgKm9mZnNldCkKK3sKKwl1bnNpZ25lZCBpbnQgaTsK
Kwl1MzIgKmNzOworCisJR0VNX0JVR19PTighSVNfQUxJR05FRCgqb2Zmc2V0LCBzaXplb2YodTMy
KSkpOworCisJY3MgPSBpbnRlbF9yaW5nX2JlZ2luKHJxLCA0ICogY291bnQpOworCWlmIChJU19F
UlIoY3MpKQorCQlyZXR1cm4gUFRSX0VSUihjcyk7CisKKwlmb3IgKGkgPSAwOyBpIDwgY291bnQ7
IGkrKykgeworCQkqY3MrKyA9IE1JX1NUT1JFX1JFR0lTVEVSX01FTV9HRU44IHwgTUlfVVNFX0dH
VFQ7CisJCSpjcysrID0gYWRkcjsKKwkJKmNzKysgPSAqb2Zmc2V0OworCQkqY3MrKyA9IDA7CisK
KwkJYWRkciArPSBzaXplb2YodTMyKTsKKwkJKm9mZnNldCArPSBzaXplb2YodTMyKTsKKwl9CisK
KwlpbnRlbF9yaW5nX2FkdmFuY2UocnEsIGNzKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMg
aW50IHJlYWRfbW9jc190YWJsZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKKwkJCSAgIGNvbnN0
IHN0cnVjdCBkcm1faTkxNV9tb2NzX3RhYmxlICp0YWJsZSwKKwkJCSAgIHVpbnQzMl90ICpvZmZz
ZXQpCit7CisJdTMyIGFkZHI7CisKKwlpZiAoSEFTX0dMT0JBTF9NT0NTX1JFR0lTVEVSUyhycS0+
aTkxNSkpCisJCWFkZHIgPSBnbG9iYWxfbW9jc19vZmZzZXQoKTsKKwllbHNlCisJCWFkZHIgPSBt
b2NzX29mZnNldChycS0+ZW5naW5lKTsKKworCXJldHVybiByZWFkX3JlZ3MocnEsIGFkZHIsIHRh
YmxlLT5uX2VudHJpZXMsIG9mZnNldCk7Cit9CisKK3N0YXRpYyBpbnQgcmVhZF9sM2NjX3RhYmxl
KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAorCQkJICAgY29uc3Qgc3RydWN0IGRybV9pOTE1X21v
Y3NfdGFibGUgKnRhYmxlLAorCQkJICAgdWludDMyX3QgKm9mZnNldCkKK3sKKwl1MzIgYWRkciA9
IGk5MTVfbW1pb19yZWdfb2Zmc2V0KEdFTjlfTE5DRkNNT0NTKDApKTsKKworCXJldHVybiByZWFk
X3JlZ3MocnEsIGFkZHIsICh0YWJsZS0+bl9lbnRyaWVzICsgMSkgLyAyLCBvZmZzZXQpOworfQor
CitzdGF0aWMgaW50IGNoZWNrX21vY3NfdGFibGUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lLAorCQkJICAgIGNvbnN0IHN0cnVjdCBkcm1faTkxNV9tb2NzX3RhYmxlICp0YWJsZSwKKwkJ
CSAgICB1aW50MzJfdCAqKnZhZGRyKQoreworCXVuc2lnbmVkIGludCBpOworCXUzMiBleHBlY3Q7
CisKKwlmb3JfZWFjaF9tb2NzKGV4cGVjdCwgdGFibGUsIGkpIHsKKwkJaWYgKCoqdmFkZHIgIT0g
ZXhwZWN0KSB7CisJCQlwcl9lcnIoIiVzOiBJbnZhbGlkIE1PQ1NbJWRdIGVudHJ5LCBmb3VuZCAl
MDh4LCBleHBlY3RlZCAlMDh4XG4iLAorCQkJICAgICAgIGVuZ2luZS0+bmFtZSwgaSwgKip2YWRk
ciwgZXhwZWN0KTsKKwkJCXJldHVybiAtRUlOVkFMOworCQl9CisJCSsrKnZhZGRyOworCX0KKwor
CXJldHVybiAwOworfQorCitzdGF0aWMgYm9vbCBtY3JfcmFuZ2Uoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsIHUzMiBvZmZzZXQpCit7CisJLyoKKwkgKiBSZWdpc3RlcnMgaW4gdGhpcyBy
YW5nZSBhcmUgYWZmZWN0ZWQgYnkgdGhlIE1DUiBzZWxlY3RvcgorCSAqIHdoaWNoIG9ubHkgY29u
dHJvbHMgQ1BVIGluaXRpYXRlZCBNTUlPLiBSb3V0aW5nIGRvZXMgbm90CisJICogd29yayBmb3Ig
Q1MgYWNjZXNzIHNvIHdlIGNhbm5vdCB2ZXJpZnkgdGhlbSBvbiB0aGlzIHBhdGguCisJICovCisJ
cmV0dXJuIElOVEVMX0dFTihpOTE1KSA+PSA4ICYmIG9mZnNldCA+PSAweGIwMDAgJiYgb2Zmc2V0
IDw9IDB4YjRmZjsKK30KKworc3RhdGljIGludCBjaGVja19sM2NjX3RhYmxlKHN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKmVuZ2luZSwKKwkJCSAgICBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfbW9jc190
YWJsZSAqdGFibGUsCisJCQkgICAgdWludDMyX3QgKip2YWRkcikKK3sKKwkvKiBDYW4gd2UgcmVh
ZCB0aGUgTUNSIHJhbmdlIDB4YjAwIGRpcmVjdGx5PyBTZWUgaW50ZWxfd29ya2Fyb3VuZHMhICov
CisJdTMyIHJlZyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KEdFTjlfTE5DRkNNT0NTKDApKTsKKwl1
bnNpZ25lZCBpbnQgaTsKKwl1MzIgZXhwZWN0OworCisJZm9yX2VhY2hfbDNjYyhleHBlY3QsIHRh
YmxlLCBpKSB7CisJCWlmICghbWNyX3JhbmdlKGVuZ2luZS0+aTkxNSwgcmVnKSAmJiAqKnZhZGRy
ICE9IGV4cGVjdCkgeworCQkJcHJfZXJyKCIlczogSW52YWxpZCBMM0NDWyVkXSBlbnRyeSwgZm91
bmQgJTA4eCwgZXhwZWN0ZWQgJTA4eFxuIiwKKwkJCSAgICAgICBlbmdpbmUtPm5hbWUsIGksICoq
dmFkZHIsIGV4cGVjdCk7CisJCQlyZXR1cm4gLUVJTlZBTDsKKwkJfQorCQkrKyp2YWRkcjsKKwkJ
cmVnICs9IDQ7CisJfQorCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgY2hlY2tfbW9jc19l
bmdpbmUoc3RydWN0IGxpdmVfbW9jcyAqYXJnLAorCQkJICAgICBzdHJ1Y3QgaW50ZWxfY29udGV4
dCAqY2UpCit7CisJc3RydWN0IGk5MTVfdm1hICp2bWEgPSBhcmctPnNjcmF0Y2g7CisJc3RydWN0
IGk5MTVfcmVxdWVzdCAqcnE7CisJdTMyIG9mZnNldDsKKwl1MzIgKnZhZGRyOworCWludCBlcnI7
CisKKwltZW1zZXQzMihhcmctPnZhZGRyLCBTVEFDS19NQUdJQywgUEFHRV9TSVpFIC8gc2l6ZW9m
KHUzMikpOworCisJcnEgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZV9yZXF1ZXN0KGNlKTsKKwlpZiAo
SVNfRVJSKHJxKSkKKwkJcmV0dXJuIFBUUl9FUlIocnEpOworCisJaTkxNV92bWFfbG9jayh2bWEp
OworCWVyciA9IGk5MTVfcmVxdWVzdF9hd2FpdF9vYmplY3QocnEsIHZtYS0+b2JqLCB0cnVlKTsK
KwlpZiAoIWVycikKKwkJZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3RpdmUodm1hLCBycSwgRVhF
Q19PQkpFQ1RfV1JJVEUpOworCWk5MTVfdm1hX3VubG9jayh2bWEpOworCisJLyogUmVhZCB0aGUg
bW9jcyB0YWJsZXMgYmFjayB1c2luZyBTUk0gKi8KKwlvZmZzZXQgPSBpOTE1X2dndHRfb2Zmc2V0
KHZtYSk7CisJaWYgKCFlcnIpCisJCWVyciA9IHJlYWRfbW9jc190YWJsZShycSwgJmFyZy0+dGFi
bGUsICZvZmZzZXQpOworCWlmICghZXJyICYmIGNlLT5lbmdpbmUtPmNsYXNzID09IFJFTkRFUl9D
TEFTUykKKwkJZXJyID0gcmVhZF9sM2NjX3RhYmxlKHJxLCAmYXJnLT50YWJsZSwgJm9mZnNldCk7
CisJb2Zmc2V0IC09IGk5MTVfZ2d0dF9vZmZzZXQodm1hKTsKKwlHRU1fQlVHX09OKG9mZnNldCA+
IFBBR0VfU0laRSk7CisKKwllcnIgPSByZXF1ZXN0X2FkZF9zeW5jKHJxLCBlcnIpOworCWlmIChl
cnIpCisJCXJldHVybiBlcnI7CisKKwkvKiBDb21wYXJlIHRoZSByZXN1bHRzIGFnYWluc3QgdGhl
IGV4cGVjdGVkIHRhYmxlcyAqLworCXZhZGRyID0gYXJnLT52YWRkcjsKKwlpZiAoIWVycikKKwkJ
ZXJyID0gY2hlY2tfbW9jc190YWJsZShjZS0+ZW5naW5lLCAmYXJnLT50YWJsZSwgJnZhZGRyKTsK
KwlpZiAoIWVyciAmJiBjZS0+ZW5naW5lLT5jbGFzcyA9PSBSRU5ERVJfQ0xBU1MpCisJCWVyciA9
IGNoZWNrX2wzY2NfdGFibGUoY2UtPmVuZ2luZSwgJmFyZy0+dGFibGUsICZ2YWRkcik7CisJaWYg
KGVycikKKwkJcmV0dXJuIGVycjsKKworCUdFTV9CVUdfT04oYXJnLT52YWRkciArIG9mZnNldCAh
PSB2YWRkcik7CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgbGl2ZV9tb2NzX2tlcm5lbCh2
b2lkICphcmcpCit7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKKwlzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmU7CisJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisJc3RydWN0IGxp
dmVfbW9jcyBtb2NzOworCWludCBlcnI7CisKKwkvKiBCYXNpYyBjaGVjayB0aGUgc3lzdGVtIGlz
IGNvbmZpZ3VyZWQgd2l0aCB0aGUgZXhwZWN0ZWQgbW9jcyB0YWJsZSAqLworCisJZXJyID0gbGl2
ZV9tb2NzX2luaXQoJm1vY3MsIGd0KTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJZm9y
X2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7CisJCWVyciA9IGNoZWNrX21vY3NfZW5naW5l
KCZtb2NzLCBlbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKKwkJaWYgKGVycikKKwkJCWJyZWFrOwor
CX0KKworCWxpdmVfbW9jc19maW5pKCZtb2NzKTsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMg
aW50IGxpdmVfbW9jc19jbGVhbih2b2lkICphcmcpCit7CisJc3RydWN0IGludGVsX2d0ICpndCA9
IGFyZzsKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CisJZW51bSBpbnRlbF9lbmdp
bmVfaWQgaWQ7CisJc3RydWN0IGxpdmVfbW9jcyBtb2NzOworCWludCBlcnI7CisKKwkvKiBFdmVy
eSBuZXcgY29udGV4dCBzaG91bGQgc2VlIHRoZSBzYW1lIG1vY3MgdGFibGUgKi8KKworCWVyciA9
IGxpdmVfbW9jc19pbml0KCZtb2NzLCBndCk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKwor
CWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgeworCQlzdHJ1Y3QgaW50ZWxfY29udGV4
dCAqY2U7CisKKwkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShlbmdpbmUtPmtlcm5lbF9jb250
ZXh0LT5nZW1fY29udGV4dCwKKwkJCQkJICBlbmdpbmUpOworCQlpZiAoSVNfRVJSKGNlKSkgewor
CQkJZXJyID0gUFRSX0VSUihjZSk7CisJCQlicmVhazsKKwkJfQorCisJCWVyciA9IGNoZWNrX21v
Y3NfZW5naW5lKCZtb2NzLCBjZSk7CisJCWludGVsX2NvbnRleHRfcHV0KGNlKTsKKwkJaWYgKGVy
cikKKwkJCWJyZWFrOworCX0KKworCWxpdmVfbW9jc19maW5pKCZtb2NzKTsKKwlyZXR1cm4gZXJy
OworfQorCitzdGF0aWMgaW50IGFjdGl2ZV9lbmdpbmVfcmVzZXQoc3RydWN0IGludGVsX2NvbnRl
eHQgKmNlLAorCQkJICAgICAgIGNvbnN0IGNoYXIgKnJlYXNvbikKK3sKKwlzdHJ1Y3QgaWd0X3Nw
aW5uZXIgc3BpbjsKKwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKKwlpbnQgZXJyOworCisJZXJy
ID0gaWd0X3NwaW5uZXJfaW5pdCgmc3BpbiwgY2UtPmVuZ2luZS0+Z3QpOworCWlmIChlcnIpCisJ
CXJldHVybiBlcnI7CisKKwlycSA9IGlndF9zcGlubmVyX2NyZWF0ZV9yZXF1ZXN0KCZzcGluLCBj
ZSwgTUlfTk9PUCk7CisJaWYgKElTX0VSUihycSkpIHsKKwkJaWd0X3NwaW5uZXJfZmluaSgmc3Bp
bik7CisJCXJldHVybiBQVFJfRVJSKHJxKTsKKwl9CisKKwllcnIgPSByZXF1ZXN0X2FkZF9zcGlu
KHJxLCAmc3Bpbik7CisJaWYgKGVyciA9PSAwKQorCQllcnIgPSBpbnRlbF9lbmdpbmVfcmVzZXQo
Y2UtPmVuZ2luZSwgcmVhc29uKTsKKworCWlndF9zcGlubmVyX2VuZCgmc3Bpbik7CisJaWd0X3Nw
aW5uZXJfZmluaSgmc3Bpbik7CisKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgaW50IF9fbGl2
ZV9tb2NzX3Jlc2V0KHN0cnVjdCBsaXZlX21vY3MgKm1vY3MsCisJCQkgICAgIHN0cnVjdCBpbnRl
bF9jb250ZXh0ICpjZSkKK3sKKwlpbnQgZXJyOworCisJZXJyID0gaW50ZWxfZW5naW5lX3Jlc2V0
KGNlLT5lbmdpbmUsICJtb2NzIik7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWVyciA9
IGNoZWNrX21vY3NfZW5naW5lKG1vY3MsIGNlKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOwor
CisJZXJyID0gYWN0aXZlX2VuZ2luZV9yZXNldChjZSwgIm1vY3MiKTsKKwlpZiAoZXJyKQorCQly
ZXR1cm4gZXJyOworCisJZXJyID0gY2hlY2tfbW9jc19lbmdpbmUobW9jcywgY2UpOworCWlmIChl
cnIpCisJCXJldHVybiBlcnI7CisKKwlpbnRlbF9ndF9yZXNldChjZS0+ZW5naW5lLT5ndCwgY2Ut
PmVuZ2luZS0+bWFzaywgIm1vY3MiKTsKKworCWVyciA9IGNoZWNrX21vY3NfZW5naW5lKG1vY3Ms
IGNlKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRp
YyBpbnQgbGl2ZV9tb2NzX3Jlc2V0KHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0
ID0gYXJnOworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKKwllbnVtIGludGVsX2Vu
Z2luZV9pZCBpZDsKKwlzdHJ1Y3QgbGl2ZV9tb2NzIG1vY3M7CisJaW50IGVyciA9IDA7CisKKwkv
KiBDaGVjayB0aGUgbW9jcyBzZXR1cCBpcyByZXRhaW5lZCBvdmVyIHBlci1lbmdpbmUgYW5kIGds
b2JhbCByZXNldHMgKi8KKworCWlmICghaW50ZWxfaGFzX3Jlc2V0X2VuZ2luZShndCkpCisJCXJl
dHVybiAwOworCisJZXJyID0gbGl2ZV9tb2NzX2luaXQoJm1vY3MsIGd0KTsKKwlpZiAoZXJyKQor
CQlyZXR1cm4gZXJyOworCisJaWd0X2dsb2JhbF9yZXNldF9sb2NrKGd0KTsKKwlmb3JfZWFjaF9l
bmdpbmUoZW5naW5lLCBndCwgaWQpIHsKKwkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOworCisJ
CWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lLT5rZXJuZWxfY29udGV4dC0+Z2VtX2Nv
bnRleHQsCisJCQkJCSAgZW5naW5lKTsKKwkJaWYgKElTX0VSUihjZSkpIHsKKwkJCWVyciA9IFBU
Ul9FUlIoY2UpOworCQkJYnJlYWs7CisJCX0KKworCQlpbnRlbF9lbmdpbmVfcG1fZ2V0KGVuZ2lu
ZSk7CisJCWVyciA9IF9fbGl2ZV9tb2NzX3Jlc2V0KCZtb2NzLCBjZSk7CisJCWludGVsX2VuZ2lu
ZV9wbV9wdXQoZW5naW5lKTsKKworCQlpbnRlbF9jb250ZXh0X3B1dChjZSk7CisJCWlmIChlcnIp
CisJCQlicmVhazsKKwl9CisJaWd0X2dsb2JhbF9yZXNldF91bmxvY2soZ3QpOworCisJbGl2ZV9t
b2NzX2ZpbmkoJm1vY3MpOworCXJldHVybiBlcnI7Cit9CisKK2ludCBpbnRlbF9tb2NzX2xpdmVf
c2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQoreworCXN0YXRpYyBjb25z
dCBzdHJ1Y3QgaTkxNV9zdWJ0ZXN0IHRlc3RzW10gPSB7CisJCVNVQlRFU1QobGl2ZV9tb2NzX2tl
cm5lbCksCisJCVNVQlRFU1QobGl2ZV9tb2NzX2NsZWFuKSwKKwkJU1VCVEVTVChsaXZlX21vY3Nf
cmVzZXQpLAorCX07CisJc3RydWN0IGRybV9pOTE1X21vY3NfdGFibGUgdGFibGU7CisKKwlpZiAo
IWdldF9tb2NzX3NldHRpbmdzKGk5MTUsICZ0YWJsZSkpCisJCXJldHVybiAwOworCisJcmV0dXJu
IGludGVsX2d0X2xpdmVfc3VidGVzdHModGVzdHMsICZpOTE1LT5ndCk7Cit9CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9saXZlX3NlbGZ0ZXN0cy5oIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxmdGVzdHMuaAppbmRl
eCA0YjNjYWM3M2UyOTEuLjExYjQwYmM1OGU2ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxmdGVzdHMuaAorKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9saXZlX3NlbGZ0ZXN0cy5oCkBAIC0xNiw2ICsxNiw3IEBA
IHNlbGZ0ZXN0KGd0X2VuZ2luZXMsIGludGVsX2VuZ2luZV9saXZlX3NlbGZ0ZXN0cykKIHNlbGZ0
ZXN0KGd0X3RpbWVsaW5lcywgaW50ZWxfdGltZWxpbmVfbGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVz
dChndF9jb250ZXh0cywgaW50ZWxfY29udGV4dF9saXZlX3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KGd0
X2xyYywgaW50ZWxfbHJjX2xpdmVfc2VsZnRlc3RzKQorc2VsZnRlc3QoZ3RfbW9jcywgaW50ZWxf
bW9jc19saXZlX3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KGd0X3BtLCBpbnRlbF9ndF9wbV9saXZlX3Nl
bGZ0ZXN0cykKIHNlbGZ0ZXN0KGd0X2hlYXJ0YmVhdCwgaW50ZWxfaGVhcnRiZWF0X2xpdmVfc2Vs
ZnRlc3RzKQogc2VsZnRlc3QocmVxdWVzdHMsIGk5MTVfcmVxdWVzdF9saXZlX3NlbGZ0ZXN0cykK
LS0gCjIuMjQuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
Cmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

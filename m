Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 35375175B1
	for <lists+intel-gfx@lfdr.de>; Wed,  8 May 2019 12:11:57 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6FCFF89624;
	Wed,  8 May 2019 10:11:55 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 136C689624;
 Wed,  8 May 2019 10:11:52 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16487700-1500050 
 for multiple; Wed, 08 May 2019 11:10:13 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  8 May 2019 11:09:55 +0100
Message-Id: <20190508100958.32637-13-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190508100958.32637-1-chris@chris-wilson.co.uk>
References: <20190508100958.32637-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t 13/16] i915: Add gem_exec_balancer
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RXhlcmNpc2UgdGhlIGluLWtlcm5lbCBsb2FkIGJhbGFuY2VyIGNoZWNraW5nIHRoYXQgd2UgY2Fu
IGRpc3RyaWJ1dGUKYmF0Y2hlcyBhY3Jvc3MgdGhlIHNldCBvZiBjdHgtPmVuZ2luZXMgdG8gYXZv
aWQgbG9hZC4KClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29u
LmNvLnVrPgotLS0KIHRlc3RzL01ha2VmaWxlLmFtICAgICAgICAgICAgICB8ICAgIDEgKwogdGVz
dHMvTWFrZWZpbGUuc291cmNlcyAgICAgICAgIHwgICAgMSArCiB0ZXN0cy9pOTE1L2dlbV9leGVj
X2JhbGFuY2VyLmMgfCAxMDUwICsrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiB0ZXN0
cy9tZXNvbi5idWlsZCAgICAgICAgICAgICAgfCAgICA3ICsKIDQgZmlsZXMgY2hhbmdlZCwgMTA1
OSBpbnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgdGVzdHMvaTkxNS9nZW1fZXhlY19i
YWxhbmNlci5jCgpkaWZmIC0tZ2l0IGEvdGVzdHMvTWFrZWZpbGUuYW0gYi90ZXN0cy9NYWtlZmls
ZS5hbQppbmRleCA1MDk3ZGViZjYuLmM2YWYwYWVhZiAxMDA2NDQKLS0tIGEvdGVzdHMvTWFrZWZp
bGUuYW0KKysrIGIvdGVzdHMvTWFrZWZpbGUuYW0KQEAgLTk2LDYgKzk2LDcgQEAgZ2VtX2Nsb3Nl
X3JhY2VfTERBREQgPSAkKExEQUREKSAtbHB0aHJlYWQKIGdlbV9jdHhfdGhyYXNoX0NGTEFHUyA9
ICQoQU1fQ0ZMQUdTKSAkKFRIUkVBRF9DRkxBR1MpCiBnZW1fY3R4X3RocmFzaF9MREFERCA9ICQo
TERBREQpIC1scHRocmVhZAogZ2VtX2N0eF9zc2V1X0xEQUREID0gJChMREFERCkgJCh0b3BfYnVp
bGRkaXIpL2xpYi9saWJpZ3RfcGVyZi5sYQoraTkxNV9nZW1fZXhlY19iYWxhbmNlcl9MREFERCA9
ICQoTERBREQpICQodG9wX2J1aWxkZGlyKS9saWIvbGliaWd0X3BlcmYubGEKIGdlbV9leGVjX2Nh
cHR1cmVfTERBREQgPSAkKExEQUREKSAtbHoKIGdlbV9leGVjX3BhcmFsbGVsX0NGTEFHUyA9ICQo
QU1fQ0ZMQUdTKSAkKFRIUkVBRF9DRkxBR1MpCiBnZW1fZXhlY19wYXJhbGxlbF9MREFERCA9ICQo
TERBREQpIC1scHRocmVhZApkaWZmIC0tZ2l0IGEvdGVzdHMvTWFrZWZpbGUuc291cmNlcyBiL3Rl
c3RzL01ha2VmaWxlLnNvdXJjZXMKaW5kZXggZTdlZTI3ZTgxLi4zMjNiNjI1YWEgMTAwNjQ0Ci0t
LSBhL3Rlc3RzL01ha2VmaWxlLnNvdXJjZXMKKysrIGIvdGVzdHMvTWFrZWZpbGUuc291cmNlcwpA
QCAtMjQsNiArMjQsNyBAQCBURVNUU19wcm9ncyA9IFwKIAlpOTE1L2dlbV9jdHhfY2xvbmUgXAog
CWk5MTUvZ2VtX2N0eF9lbmdpbmVzIFwKIAlpOTE1L2dlbV9jdHhfc2hhcmVkIFwKKwlpOTE1L2dl
bV9leGVjX2JhbGFuY2VyIFwKIAlpOTE1L2dlbV92bV9jcmVhdGUgXAogCWttc18zZCBcCiAJa21z
X2FkZGZiX2Jhc2ljIFwKZGlmZiAtLWdpdCBhL3Rlc3RzL2k5MTUvZ2VtX2V4ZWNfYmFsYW5jZXIu
YyBiL3Rlc3RzL2k5MTUvZ2VtX2V4ZWNfYmFsYW5jZXIuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NApp
bmRleCAwMDAwMDAwMDAuLjI1MTk1ZDQ3OAotLS0gL2Rldi9udWxsCisrKyBiL3Rlc3RzL2k5MTUv
Z2VtX2V4ZWNfYmFsYW5jZXIuYwpAQCAtMCwwICsxLDEwNTAgQEAKKy8qCisgKiBDb3B5cmlnaHQg
wqkgMjAxOCBJbnRlbCBDb3Jwb3JhdGlvbgorICoKKyAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdy
YW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhCisgKiBjb3B5
IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhl
ICJTb2Z0d2FyZSIpLAorICogdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmlj
dGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbgorICogdGhlIHJpZ2h0cyB0byB1c2Us
IGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsCisg
KiBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNv
bnMgdG8gd2hvbSB0aGUKKyAqIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVj
dCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CisgKgorICogVGhlIGFib3ZlIGNvcHlyaWdo
dCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2UgKGluY2x1ZGluZyB0aGUgbmV4dAor
ICogcGFyYWdyYXBoKSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50
aWFsIHBvcnRpb25zIG9mIHRoZQorICogU29mdHdhcmUuCisgKgorICogVEhFIFNPRlRXQVJFIElT
IFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1Mg
T1IKKyAqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJ
RVMgT0YgTUVSQ0hBTlRBQklMSVRZLAorICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBP
U0UgQU5EIE5PTklORlJJTkdFTUVOVC4gIElOIE5PIEVWRU5UIFNIQUxMCisgKiBUSEUgQVVUSE9S
UyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBP
UiBPVEhFUgorICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwg
VE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcKKyAqIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNU
SU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MKKyAqIElO
IFRIRSBTT0ZUV0FSRS4KKyAqLworCisjaW5jbHVkZSA8c2NoZWQuaD4KKworI2luY2x1ZGUgImln
dC5oIgorI2luY2x1ZGUgImlndF9wZXJmLmgiCisjaW5jbHVkZSAiaTkxNS9nZW1fcmluZy5oIgor
I2luY2x1ZGUgInN3X3N5bmMuaCIKKworSUdUX1RFU1RfREVTQ1JJUFRJT04oIkV4ZXJjaXNlIGlu
LWtlcm5lbCBsb2FkLWJhbGFuY2luZyIpOworCisjZGVmaW5lIElOU1RBTkNFX0NPVU5UICgxIDw8
IEk5MTVfUE1VX1NBTVBMRV9JTlNUQU5DRV9CSVRTKQorCitzdGF0aWMgYm9vbCBoYXNfY2xhc3Nf
aW5zdGFuY2UoaW50IGk5MTUsIHVpbnQxNl90IGNsYXNzLCB1aW50MTZfdCBpbnN0YW5jZSkKK3sK
KwlpbnQgZmQ7CisKKwlmZCA9IHBlcmZfaTkxNV9vcGVuKEk5MTVfUE1VX0VOR0lORV9CVVNZKGNs
YXNzLCBpbnN0YW5jZSkpOworCWlmIChmZCAhPSAtMSkgeworCQljbG9zZShmZCk7CisJCXJldHVy
biB0cnVlOworCX0KKworCXJldHVybiBmYWxzZTsKK30KKworc3RhdGljIHN0cnVjdCBpOTE1X2Vu
Z2luZV9jbGFzc19pbnN0YW5jZSAqCitsaXN0X2VuZ2luZXMoaW50IGk5MTUsIHVpbnQzMl90IGNs
YXNzX21hc2ssIHVuc2lnbmVkIGludCAqb3V0KQoreworCXVuc2lnbmVkIGludCBjb3VudCA9IDAs
IHNpemUgPSA2NDsKKwlzdHJ1Y3QgaTkxNV9lbmdpbmVfY2xhc3NfaW5zdGFuY2UgKmVuZ2luZXM7
CisKKwllbmdpbmVzID0gbWFsbG9jKHNpemUgKiBzaXplb2YoKmVuZ2luZXMpKTsKKwlpZiAoIWVu
Z2luZXMpIHsKKwkJKm91dCA9IDA7CisJCXJldHVybiBOVUxMOworCX0KKworCWZvciAoZW51bSBk
cm1faTkxNV9nZW1fZW5naW5lX2NsYXNzIGNsYXNzID0gSTkxNV9FTkdJTkVfQ0xBU1NfUkVOREVS
OworCSAgICAgY2xhc3NfbWFzazsKKwkgICAgIGNsYXNzKyssIGNsYXNzX21hc2sgPj49IDEpIHsK
KwkJaWYgKCEoY2xhc3NfbWFzayAmIDEpKQorCQkJY29udGludWU7CisKKwkJZm9yICh1bnNpZ25l
ZCBpbnQgaW5zdGFuY2UgPSAwOworCQkgICAgIGluc3RhbmNlIDwgSU5TVEFOQ0VfQ09VTlQ7CisJ
CSAgICAgaW5zdGFuY2UrKykgeworCQkgICAgIGlmICghaGFzX2NsYXNzX2luc3RhbmNlKGk5MTUs
IGNsYXNzLCBpbnN0YW5jZSkpCisJCQkgICAgIGNvbnRpbnVlOworCisJCQlpZiAoY291bnQgPT0g
c2l6ZSkgeworCQkJCXN0cnVjdCBpOTE1X2VuZ2luZV9jbGFzc19pbnN0YW5jZSAqZTsKKworCQkJ
CXNpemUgKj0gMjsKKwkJCQllID0gcmVhbGxvYyhlbmdpbmVzLCBzaXplKnNpemVvZigqZW5naW5l
cykpOworCQkJCWlmICghZSkgeworCQkJCQkqb3V0ID0gY291bnQ7CisJCQkJCXJldHVybiBlbmdp
bmVzOworCQkJCX0KKworCQkJCWVuZ2luZXMgPSBlOworCQkJfQorCisJCQllbmdpbmVzW2NvdW50
KytdID0gKHN0cnVjdCBpOTE1X2VuZ2luZV9jbGFzc19pbnN0YW5jZSl7CisJCQkJLmVuZ2luZV9j
bGFzcyA9IGNsYXNzLAorCQkJCS5lbmdpbmVfaW5zdGFuY2UgPSBpbnN0YW5jZSwKKwkJCX07CisJ
CX0KKwl9CisKKwlpZiAoIWNvdW50KSB7CisJCWZyZWUoZW5naW5lcyk7CisJCWVuZ2luZXMgPSBO
VUxMOworCX0KKworCSpvdXQgPSBjb3VudDsKKwlyZXR1cm4gZW5naW5lczsKK30KKworc3RhdGlj
IGludCBfX3NldF9sb2FkX2JhbGFuY2VyKGludCBpOTE1LCB1aW50MzJfdCBjdHgsCisJCQkgICAg
ICAgY29uc3Qgc3RydWN0IGk5MTVfZW5naW5lX2NsYXNzX2luc3RhbmNlICpjaSwKKwkJCSAgICAg
ICB1bnNpZ25lZCBpbnQgY291bnQpCit7CisJSTkxNV9ERUZJTkVfQ09OVEVYVF9FTkdJTkVTX0xP
QURfQkFMQU5DRShiYWxhbmNlciwgY291bnQpOworCUk5MTVfREVGSU5FX0NPTlRFWFRfUEFSQU1f
RU5HSU5FUyhlbmdpbmVzLCAxICsgY291bnQpOworCXN0cnVjdCBkcm1faTkxNV9nZW1fY29udGV4
dF9wYXJhbSBwID0geworCQkuY3R4X2lkID0gY3R4LAorCQkucGFyYW0gPSBJOTE1X0NPTlRFWFRf
UEFSQU1fRU5HSU5FUywKKwkJLnNpemUgPSBzaXplb2YoZW5naW5lcyksCisJCS52YWx1ZSA9IHRv
X3VzZXJfcG9pbnRlcigmZW5naW5lcykKKwl9OworCisJbWVtc2V0KCZiYWxhbmNlciwgMCwgc2l6
ZW9mKGJhbGFuY2VyKSk7CisJYmFsYW5jZXIuYmFzZS5uYW1lID0gSTkxNV9DT05URVhUX0VOR0lO
RVNfRVhUX0xPQURfQkFMQU5DRTsKKworCWlndF9hc3NlcnQoY291bnQpOworCWJhbGFuY2VyLm51
bV9zaWJsaW5ncyA9IGNvdW50OworCW1lbWNweShiYWxhbmNlci5lbmdpbmVzLCBjaSwgY291bnQg
KiBzaXplb2YoKmNpKSk7CisKKwltZW1zZXQoJmVuZ2luZXMsIDAsIHNpemVvZihlbmdpbmVzKSk7
CisJZW5naW5lcy5leHRlbnNpb25zID0gdG9fdXNlcl9wb2ludGVyKCZiYWxhbmNlcik7CisJZW5n
aW5lcy5lbmdpbmVzWzBdLmVuZ2luZV9jbGFzcyA9CisJCUk5MTVfRU5HSU5FX0NMQVNTX0lOVkFM
SUQ7CisJZW5naW5lcy5lbmdpbmVzWzBdLmVuZ2luZV9pbnN0YW5jZSA9CisJCUk5MTVfRU5HSU5F
X0NMQVNTX0lOVkFMSURfTk9ORTsKKwltZW1jcHkoZW5naW5lcy5lbmdpbmVzICsgMSwgY2ksIGNv
dW50ICogc2l6ZW9mKCpjaSkpOworCisJcmV0dXJuIF9fZ2VtX2NvbnRleHRfc2V0X3BhcmFtKGk5
MTUsICZwKTsKK30KKworc3RhdGljIHZvaWQgc2V0X2xvYWRfYmFsYW5jZXIoaW50IGk5MTUsIHVp
bnQzMl90IGN0eCwKKwkJCSAgICAgIGNvbnN0IHN0cnVjdCBpOTE1X2VuZ2luZV9jbGFzc19pbnN0
YW5jZSAqY2ksCisJCQkgICAgICB1bnNpZ25lZCBpbnQgY291bnQpCit7CisJaWd0X2Fzc2VydF9l
cShfX3NldF9sb2FkX2JhbGFuY2VyKGk5MTUsIGN0eCwgY2ksIGNvdW50KSwgMCk7Cit9CisKK3N0
YXRpYyB1aW50MzJfdCBsb2FkX2JhbGFuY2VyX2NyZWF0ZShpbnQgaTkxNSwKKwkJCQkgICAgIGNv
bnN0IHN0cnVjdCBpOTE1X2VuZ2luZV9jbGFzc19pbnN0YW5jZSAqY2ksCisJCQkJICAgICB1bnNp
Z25lZCBpbnQgY291bnQpCit7CisJdWludDMyX3QgY3R4OworCisJY3R4ID0gZ2VtX2NvbnRleHRf
Y3JlYXRlKGk5MTUpOworCXNldF9sb2FkX2JhbGFuY2VyKGk5MTUsIGN0eCwgY2ksIGNvdW50KTsK
KworCXJldHVybiBjdHg7Cit9CisKK3N0YXRpYyB1aW50MzJfdCBfX2JhdGNoX2NyZWF0ZShpbnQg
aTkxNSwgdWludDMyX3Qgb2Zmc2V0KQoreworCWNvbnN0IHVpbnQzMl90IGJiZSA9IE1JX0JBVENI
X0JVRkZFUl9FTkQ7CisJdWludDMyX3QgaGFuZGxlOworCisJaGFuZGxlID0gZ2VtX2NyZWF0ZShp
OTE1LCBBTElHTihvZmZzZXQgKyA0LCA0MDk2KSk7CisJZ2VtX3dyaXRlKGk5MTUsIGhhbmRsZSwg
b2Zmc2V0LCAmYmJlLCBzaXplb2YoYmJlKSk7CisKKwlyZXR1cm4gaGFuZGxlOworfQorCitzdGF0
aWMgdWludDMyX3QgYmF0Y2hfY3JlYXRlKGludCBpOTE1KQoreworCXJldHVybiBfX2JhdGNoX2Ny
ZWF0ZShpOTE1LCAwKTsKK30KKworc3RhdGljIHZvaWQgaW52YWxpZF9iYWxhbmNlcihpbnQgaTkx
NSkKK3sKKwlJOTE1X0RFRklORV9DT05URVhUX0VOR0lORVNfTE9BRF9CQUxBTkNFKGJhbGFuY2Vy
LCA2NCk7CisJSTkxNV9ERUZJTkVfQ09OVEVYVF9QQVJBTV9FTkdJTkVTKGVuZ2luZXMsIDY0KTsK
KwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2NvbnRleHRfcGFyYW0gcCA9IHsKKwkJLnBhcmFtID0gSTkx
NV9DT05URVhUX1BBUkFNX0VOR0lORVMsCisJCS52YWx1ZSA9IHRvX3VzZXJfcG9pbnRlcigmZW5n
aW5lcykKKwl9OworCXVpbnQzMl90IGhhbmRsZTsKKwl2b2lkICpwdHI7CisKKwkvKgorCSAqIEFz
c3VtZSB0aGF0IEk5MTVfQ09OVEVYVF9QQVJBTV9FTkdJTkUgdmFsaWRhdGVzIHRoZSBhcnJheQor
CSAqIG9mIGVuZ2luZXNbXSwgb3VyIGpvYiBpcyB0byBkZXRlcm1pbmUgaWYgdGhlIGxvYWRfYmFs
YW5jZXIKKwkgKiBleHRlbnNpb24gZXhwbG9kZXMuCisJICovCisKKwlmb3IgKGludCBjbGFzcyA9
IDA7IGNsYXNzIDwgMzI7IGNsYXNzKyspIHsKKwkJc3RydWN0IGk5MTVfZW5naW5lX2NsYXNzX2lu
c3RhbmNlICpjaTsKKwkJdW5zaWduZWQgaW50IGNvdW50OworCisJCWNpID0gbGlzdF9lbmdpbmVz
KGk5MTUsIDEgPDwgY2xhc3MsICZjb3VudCk7CisJCWlmICghY2kpCisJCQljb250aW51ZTsKKwor
CQlpZ3RfZGVidWcoIkZvdW5kICVkIGVuZ2luZXNcbiIsIGNvdW50KTsKKwkJaWd0X2Fzc2VydF9s
dGUoY291bnQsIDY0KTsKKworCQlwLmN0eF9pZCA9IGdlbV9jb250ZXh0X2NyZWF0ZShpOTE1KTsK
KwkJcC5zaXplID0gKHNpemVvZihzdHJ1Y3QgaTkxNV9jb250ZXh0X3BhcmFtX2VuZ2luZXMpICsK
KwkJCQkoY291bnQgKyAxKSAqIHNpemVvZigqZW5naW5lcy5lbmdpbmVzKSk7CisKKwkJbWVtc2V0
KCZlbmdpbmVzLCAwLCBzaXplb2YoZW5naW5lcykpOworCQllbmdpbmVzLmVuZ2luZXNbMF0uZW5n
aW5lX2NsYXNzID0gSTkxNV9FTkdJTkVfQ0xBU1NfSU5WQUxJRDsKKwkJZW5naW5lcy5lbmdpbmVz
WzBdLmVuZ2luZV9pbnN0YW5jZSA9IEk5MTVfRU5HSU5FX0NMQVNTX0lOVkFMSURfTk9ORTsKKwkJ
bWVtY3B5KGVuZ2luZXMuZW5naW5lcyArIDEsIGNpLCBjb3VudCAqIHNpemVvZigqY2kpKTsKKwkJ
Z2VtX2NvbnRleHRfc2V0X3BhcmFtKGk5MTUsICZwKTsKKworCQllbmdpbmVzLmV4dGVuc2lvbnMg
PSAtMXVsbDsKKwkJaWd0X2Fzc2VydF9lcShfX2dlbV9jb250ZXh0X3NldF9wYXJhbShpOTE1LCAm
cCksIC1FRkFVTFQpOworCisJCWVuZ2luZXMuZXh0ZW5zaW9ucyA9IDF1bGw7CisJCWlndF9hc3Nl
cnRfZXEoX19nZW1fY29udGV4dF9zZXRfcGFyYW0oaTkxNSwgJnApLCAtRUZBVUxUKTsKKworCQlt
ZW1zZXQoJmJhbGFuY2VyLCAwLCBzaXplb2YoYmFsYW5jZXIpKTsKKwkJYmFsYW5jZXIuYmFzZS5u
YW1lID0gSTkxNV9DT05URVhUX0VOR0lORVNfRVhUX0xPQURfQkFMQU5DRTsKKwkJYmFsYW5jZXIu
bnVtX3NpYmxpbmdzID0gY291bnQ7CisJCW1lbWNweShiYWxhbmNlci5lbmdpbmVzLCBjaSwgY291
bnQgKiBzaXplb2YoKmNpKSk7CisKKwkJZW5naW5lcy5leHRlbnNpb25zID0gdG9fdXNlcl9wb2lu
dGVyKCZiYWxhbmNlcik7CisJCWdlbV9jb250ZXh0X3NldF9wYXJhbShpOTE1LCAmcCk7CisKKwkJ
YmFsYW5jZXIuZW5naW5lX2luZGV4ID0gMTsKKwkJaWd0X2Fzc2VydF9lcShfX2dlbV9jb250ZXh0
X3NldF9wYXJhbShpOTE1LCAmcCksIC1FRVhJU1QpOworCisJCWJhbGFuY2VyLmVuZ2luZV9pbmRl
eCA9IGNvdW50OworCQlpZ3RfYXNzZXJ0X2VxKF9fZ2VtX2NvbnRleHRfc2V0X3BhcmFtKGk5MTUs
ICZwKSwgLUVFWElTVCk7CisKKwkJYmFsYW5jZXIuZW5naW5lX2luZGV4ID0gY291bnQgKyAxOwor
CQlpZ3RfYXNzZXJ0X2VxKF9fZ2VtX2NvbnRleHRfc2V0X3BhcmFtKGk5MTUsICZwKSwgLUVJTlZB
TCk7CisKKwkJYmFsYW5jZXIuZW5naW5lX2luZGV4ID0gMDsKKwkJZ2VtX2NvbnRleHRfc2V0X3Bh
cmFtKGk5MTUsICZwKTsKKworCQliYWxhbmNlci5iYXNlLm5leHRfZXh0ZW5zaW9uID0gdG9fdXNl
cl9wb2ludGVyKCZiYWxhbmNlcik7CisJCWlndF9hc3NlcnRfZXEoX19nZW1fY29udGV4dF9zZXRf
cGFyYW0oaTkxNSwgJnApLCAtRUVYSVNUKTsKKworCQliYWxhbmNlci5iYXNlLm5leHRfZXh0ZW5z
aW9uID0gLTF1bGw7CisJCWlndF9hc3NlcnRfZXEoX19nZW1fY29udGV4dF9zZXRfcGFyYW0oaTkx
NSwgJnApLCAtRUZBVUxUKTsKKworCQloYW5kbGUgPSBnZW1fY3JlYXRlKGk5MTUsIDQwOTYgKiAz
KTsKKwkJcHRyID0gZ2VtX21tYXBfX2d0dChpOTE1LCBoYW5kbGUsIDQwOTYgKiAzLCBQUk9UX1dS
SVRFKTsKKwkJZ2VtX2Nsb3NlKGk5MTUsIGhhbmRsZSk7CisKKwkJbWVtc2V0KCZlbmdpbmVzLCAw
LCBzaXplb2YoZW5naW5lcykpOworCQllbmdpbmVzLmVuZ2luZXNbMF0uZW5naW5lX2NsYXNzID0g
STkxNV9FTkdJTkVfQ0xBU1NfSU5WQUxJRDsKKwkJZW5naW5lcy5lbmdpbmVzWzBdLmVuZ2luZV9p
bnN0YW5jZSA9IEk5MTVfRU5HSU5FX0NMQVNTX0lOVkFMSURfTk9ORTsKKwkJZW5naW5lcy5lbmdp
bmVzWzFdLmVuZ2luZV9jbGFzcyA9IEk5MTVfRU5HSU5FX0NMQVNTX0lOVkFMSUQ7CisJCWVuZ2lu
ZXMuZW5naW5lc1sxXS5lbmdpbmVfaW5zdGFuY2UgPSBJOTE1X0VOR0lORV9DTEFTU19JTlZBTElE
X05PTkU7CisJCW1lbWNweShlbmdpbmVzLmVuZ2luZXMgKyAyLCBjaSwgY291bnQgKiBzaXplb2Yo
Y2kpKTsKKwkJcC5zaXplID0gKHNpemVvZihzdHJ1Y3QgaTkxNV9jb250ZXh0X3BhcmFtX2VuZ2lu
ZXMpICsKKwkJCQkoY291bnQgKyAyKSAqIHNpemVvZigqZW5naW5lcy5lbmdpbmVzKSk7CisJCWdl
bV9jb250ZXh0X3NldF9wYXJhbShpOTE1LCAmcCk7CisKKwkJYmFsYW5jZXIuYmFzZS5uZXh0X2V4
dGVuc2lvbiA9IDA7CisJCWJhbGFuY2VyLmVuZ2luZV9pbmRleCA9IDE7CisJCWVuZ2luZXMuZXh0
ZW5zaW9ucyA9IHRvX3VzZXJfcG9pbnRlcigmYmFsYW5jZXIpOworCQlnZW1fY29udGV4dF9zZXRf
cGFyYW0oaTkxNSwgJnApOworCisJCW1lbWNweShwdHIgKyA0MDk2IC0gOCwgJmJhbGFuY2VyLCBz
aXplb2YoYmFsYW5jZXIpKTsKKwkJbWVtY3B5KHB0ciArIDgxOTIgLSA4LCAmYmFsYW5jZXIsIHNp
emVvZihiYWxhbmNlcikpOworCQliYWxhbmNlci5lbmdpbmVfaW5kZXggPSAwOworCisJCWVuZ2lu
ZXMuZXh0ZW5zaW9ucyA9IHRvX3VzZXJfcG9pbnRlcihwdHIpICsgNDA5NiAtIDg7CisJCWdlbV9j
b250ZXh0X3NldF9wYXJhbShpOTE1LCAmcCk7CisKKwkJYmFsYW5jZXIuYmFzZS5uZXh0X2V4dGVu
c2lvbiA9IGVuZ2luZXMuZXh0ZW5zaW9uczsKKwkJZW5naW5lcy5leHRlbnNpb25zID0gdG9fdXNl
cl9wb2ludGVyKCZiYWxhbmNlcik7CisJCWdlbV9jb250ZXh0X3NldF9wYXJhbShpOTE1LCAmcCk7
CisKKwkJbXVubWFwKHB0ciwgNDA5Nik7CisJCWlndF9hc3NlcnRfZXEoX19nZW1fY29udGV4dF9z
ZXRfcGFyYW0oaTkxNSwgJnApLCAtRUZBVUxUKTsKKwkJZW5naW5lcy5leHRlbnNpb25zID0gdG9f
dXNlcl9wb2ludGVyKHB0cikgKyA0MDk2IC0gODsKKwkJaWd0X2Fzc2VydF9lcShfX2dlbV9jb250
ZXh0X3NldF9wYXJhbShpOTE1LCAmcCksIC1FRkFVTFQpOworCisJCWVuZ2luZXMuZXh0ZW5zaW9u
cyA9IHRvX3VzZXJfcG9pbnRlcihwdHIpICsgODE5MiAtIDg7CisJCWdlbV9jb250ZXh0X3NldF9w
YXJhbShpOTE1LCAmcCk7CisKKwkJYmFsYW5jZXIuYmFzZS5uZXh0X2V4dGVuc2lvbiA9IGVuZ2lu
ZXMuZXh0ZW5zaW9uczsKKwkJZW5naW5lcy5leHRlbnNpb25zID0gdG9fdXNlcl9wb2ludGVyKCZi
YWxhbmNlcik7CisJCWdlbV9jb250ZXh0X3NldF9wYXJhbShpOTE1LCAmcCk7CisKKwkJbXVubWFw
KHB0ciArIDgxOTIsIDQwOTYpOworCQlpZ3RfYXNzZXJ0X2VxKF9fZ2VtX2NvbnRleHRfc2V0X3Bh
cmFtKGk5MTUsICZwKSwgLUVGQVVMVCk7CisJCWVuZ2luZXMuZXh0ZW5zaW9ucyA9IHRvX3VzZXJf
cG9pbnRlcihwdHIpICsgODE5MiAtIDg7CisJCWlndF9hc3NlcnRfZXEoX19nZW1fY29udGV4dF9z
ZXRfcGFyYW0oaTkxNSwgJnApLCAtRUZBVUxUKTsKKworCQltdW5tYXAocHRyICsgNDA5NiwgNDA5
Nik7CisKKwkJZ2VtX2NvbnRleHRfZGVzdHJveShpOTE1LCBwLmN0eF9pZCk7CisJCWZyZWUoY2kp
OworCX0KK30KKworc3RhdGljIHZvaWQga2lja19rdGhyZWFkcyhpbnQgcGVyaW9kX3VzKQorewor
CXNjaGVkX3lpZWxkKCk7CisJdXNsZWVwKHBlcmlvZF91cyk7Cit9CisKK3N0YXRpYyBkb3VibGUg
bWVhc3VyZV9sb2FkKGludCBwbXUsIGludCBwZXJpb2RfdXMpCit7CisJdWludDY0X3QgZGF0YVsy
XTsKKwl1aW50NjRfdCBkX3QsIGRfdjsKKworCWtpY2tfa3RocmVhZHMocGVyaW9kX3VzKTsKKwor
CWlndF9hc3NlcnRfZXEocmVhZChwbXUsIGRhdGEsIHNpemVvZihkYXRhKSksIHNpemVvZihkYXRh
KSk7CisJZF92ID0gLWRhdGFbMF07CisJZF90ID0gLWRhdGFbMV07CisKKwl1c2xlZXAocGVyaW9k
X3VzKTsKKworCWlndF9hc3NlcnRfZXEocmVhZChwbXUsIGRhdGEsIHNpemVvZihkYXRhKSksIHNp
emVvZihkYXRhKSk7CisJZF92ICs9IGRhdGFbMF07CisJZF90ICs9IGRhdGFbMV07CisKKwlyZXR1
cm4gZF92IC8gKGRvdWJsZSlkX3Q7Cit9CisKK3N0YXRpYyBkb3VibGUgbWVhc3VyZV9taW5fbG9h
ZChpbnQgcG11LCB1bnNpZ25lZCBpbnQgbnVtLCBpbnQgcGVyaW9kX3VzKQoreworCXVpbnQ2NF90
IGRhdGFbMiArIG51bV07CisJdWludDY0X3QgZF90LCBkX3ZbbnVtXTsKKwl1aW50NjRfdCBtaW4g
PSAtMSwgbWF4ID0gMDsKKworCWtpY2tfa3RocmVhZHMocGVyaW9kX3VzKTsKKworCWlndF9hc3Nl
cnRfZXEocmVhZChwbXUsIGRhdGEsIHNpemVvZihkYXRhKSksIHNpemVvZihkYXRhKSk7CisJZm9y
ICh1bnNpZ25lZCBpbnQgbiA9IDA7IG4gPCBudW07IG4rKykKKwkJZF92W25dID0gLWRhdGFbMiAr
IG5dOworCWRfdCA9IC1kYXRhWzFdOworCisJdXNsZWVwKHBlcmlvZF91cyk7CisKKwlpZ3RfYXNz
ZXJ0X2VxKHJlYWQocG11LCBkYXRhLCBzaXplb2YoZGF0YSkpLCBzaXplb2YoZGF0YSkpOworCisJ
ZF90ICs9IGRhdGFbMV07CisJZm9yICh1bnNpZ25lZCBpbnQgbiA9IDA7IG4gPCBudW07IG4rKykg
eworCQlkX3Zbbl0gKz0gZGF0YVsyICsgbl07CisJCWlndF9kZWJ1ZygiZW5naW5lWyVkXTogJS4x
ZiUlXG4iLAorCQkJICBuLCBkX3Zbbl0gLyAoZG91YmxlKWRfdCAqIDEwMCk7CisJCWlmIChkX3Zb
bl0gPCBtaW4pCisJCQltaW4gPSBkX3Zbbl07CisJCWlmIChkX3Zbbl0gPiBtYXgpCisJCQltYXgg
PSBkX3Zbbl07CisJfQorCisJaWd0X2RlYnVnKCJlbGFwc2VkOiAlIlBSSXU2NCJucywgbG9hZCBb
JS4xZiwgJS4xZl0lJVxuIiwKKwkJICBkX3QsIG1pbiAvIChkb3VibGUpZF90ICogMTAwLCAgbWF4
IC8gKGRvdWJsZSlkX3QgKiAxMDApOworCisJcmV0dXJuIG1pbiAvIChkb3VibGUpZF90OworfQor
CitzdGF0aWMgdm9pZCBjaGVja19pbmRpdmlkdWFsX2VuZ2luZShpbnQgaTkxNSwKKwkJCQkgICAg
dWludDMyX3QgY3R4LAorCQkJCSAgICBjb25zdCBzdHJ1Y3QgaTkxNV9lbmdpbmVfY2xhc3NfaW5z
dGFuY2UgKmNpLAorCQkJCSAgICBpbnQgaWR4KQoreworCWlndF9zcGluX3QgKnNwaW47CisJZG91
YmxlIGxvYWQ7CisJaW50IHBtdTsKKworCXBtdSA9IHBlcmZfaTkxNV9vcGVuKEk5MTVfUE1VX0VO
R0lORV9CVVNZKGNpW2lkeF0uZW5naW5lX2NsYXNzLAorCQkJCQkJICBjaVtpZHhdLmVuZ2luZV9p
bnN0YW5jZSkpOworCisJc3BpbiA9IGlndF9zcGluX25ldyhpOTE1LCAuY3R4ID0gY3R4LCAuZW5n
aW5lID0gaWR4ICsgMSk7CisJbG9hZCA9IG1lYXN1cmVfbG9hZChwbXUsIDEwMDAwKTsKKwlpZ3Rf
c3Bpbl9mcmVlKGk5MTUsIHNwaW4pOworCisJY2xvc2UocG11KTsKKworCWlndF9hc3NlcnRfZihs
b2FkID4gMC45MCwKKwkJICAgICAiZW5naW5lICVkIChjbGFzczppbnN0YW5jZSAlZDolZCkgd2Fz
IGZvdW5kIHRvIGJlIG9ubHkgJS4xZiUlIGJ1c3lcbiIsCisJCSAgICAgaWR4LCBjaVtpZHhdLmVu
Z2luZV9jbGFzcywgY2lbaWR4XS5lbmdpbmVfaW5zdGFuY2UsIGxvYWQqMTAwKTsKK30KKworc3Rh
dGljIHZvaWQgaW5kaXZpZHVhbChpbnQgaTkxNSkKK3sKKwl1aW50MzJfdCBjdHg7CisKKwkvKgor
CSAqIEk5MTVfQ09OVEVYVF9QQVJBTV9FTkdJTkUgYWxsb3dzIHVzIHRvIGluZGV4IGludG8gdGhl
IHVzZXIKKwkgKiBzdXBwbGllZCBhcnJheSBmcm9tIGdlbV9leGVjYnVmKCkuIE91ciBjaGVjayBp
cyB0byBidWlsZCB0aGUKKwkgKiBjdHgtPmVuZ2luZVtdIHdpdGggdmFyaW91cyBkaWZmZXJlbnQg
ZW5naW5lIGNsYXNzZXMsIGZlZWQgaW4KKwkgKiBhIHNwaW5uZXIgYW5kIHRoZW4gYXNrIHBtdSB0
byBjb25maXJtIGl0IHRoZSBleHBlY3RlZCBlbmdpbmUKKwkgKiB3YXMgYnVzeS4KKwkgKi8KKwor
CWN0eCA9IGdlbV9jb250ZXh0X2NyZWF0ZShpOTE1KTsKKworCWZvciAoaW50IG1hc2sgPSAwOyBt
YXNrIDwgMzI7IG1hc2srKykgeworCQlzdHJ1Y3QgaTkxNV9lbmdpbmVfY2xhc3NfaW5zdGFuY2Ug
KmNpOworCQl1bnNpZ25lZCBpbnQgY291bnQ7CisKKwkJY2kgPSBsaXN0X2VuZ2luZXMoaTkxNSwg
MXUgPDwgbWFzaywgJmNvdW50KTsKKwkJaWYgKCFjaSkKKwkJCWNvbnRpbnVlOworCisJCWlndF9k
ZWJ1ZygiRm91bmQgJWQgZW5naW5lcyBvZiBjbGFzcyAlZFxuIiwgY291bnQsIG1hc2spOworCisJ
CWZvciAoaW50IHBhc3MgPSAwOyBwYXNzIDwgY291bnQ7IHBhc3MrKykgeyAvKiBhcHByb3guIGNv
dW50ISAqLworCQkJaWd0X3Blcm11dGVfYXJyYXkoY2ksIGNvdW50LCBpZ3RfZXhjaGFuZ2VfaW50
NjQpOworCQkJc2V0X2xvYWRfYmFsYW5jZXIoaTkxNSwgY3R4LCBjaSwgY291bnQpOworCQkJZm9y
ICh1bnNpZ25lZCBpbnQgbiA9IDA7IG4gPCBjb3VudDsgbisrKQorCQkJCWNoZWNrX2luZGl2aWR1
YWxfZW5naW5lKGk5MTUsIGN0eCwgY2ksIG4pOworCQl9CisKKwkJZnJlZShjaSk7CisJfQorCisJ
Z2VtX2NvbnRleHRfZGVzdHJveShpOTE1LCBjdHgpOworCWdlbV9xdWllc2NlbnRfZ3B1KGk5MTUp
OworfQorCitzdGF0aWMgdm9pZCBpbmRpY2llcyhpbnQgaTkxNSkKK3sKKwlJOTE1X0RFRklORV9D
T05URVhUX1BBUkFNX0VOR0lORVMoZW5naW5lcywgSTkxNV9FWEVDX1JJTkdfTUFTSyArIDEpOwor
CXN0cnVjdCBkcm1faTkxNV9nZW1fY29udGV4dF9wYXJhbSBwID0geworCQkuY3R4X2lkID0gZ2Vt
X2NvbnRleHRfY3JlYXRlKGk5MTUpLAorCQkucGFyYW0gPSBJOTE1X0NPTlRFWFRfUEFSQU1fRU5H
SU5FUywKKwkJLnZhbHVlID0gdG9fdXNlcl9wb2ludGVyKCZlbmdpbmVzKQorCX07CisKKwlzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNfb2JqZWN0MiBiYXRjaCA9IHsKKwkJLmhhbmRsZSA9IGJhdGNo
X2NyZWF0ZShpOTE1KSwKKwl9OworCisJdW5zaWduZWQgaW50IG5lbmdpbmVzID0gMDsKKwl2b2lk
ICpiYWxhbmNlcnMgPSBOVUxMOworCisJLyoKKwkgKiBXZSBjYW4gcG9wdWxhdGUgb3VyIGVuZ2lu
ZSBtYXAgd2l0aCBtdWx0aXBsZSB2aXJ0dWFsIGVuZ2luZXMuCisJICogRG8gc28uCisJICovCisK
Kwlmb3IgKGludCBjbGFzcyA9IDA7IGNsYXNzIDwgMzI7IGNsYXNzKyspIHsKKwkJc3RydWN0IGk5
MTVfZW5naW5lX2NsYXNzX2luc3RhbmNlICpjaTsKKwkJdW5zaWduZWQgaW50IGNvdW50OworCisJ
CWNpID0gbGlzdF9lbmdpbmVzKGk5MTUsIDF1IDw8IGNsYXNzLCAmY291bnQpOworCQlpZiAoIWNp
KQorCQkJY29udGludWU7CisKKwkJaWd0X2RlYnVnKCJGb3VuZCAlZCBlbmdpbmVzIG9mIGNsYXNz
ICVkXG4iLCBjb3VudCwgY2xhc3MpOworCisJCWZvciAoaW50IG4gPSAwOyBuIDwgY291bnQ7IG4r
KykgeworCQkJSTkxNV9ERUZJTkVfQ09OVEVYVF9FTkdJTkVTX0xPQURfQkFMQU5DRSgqYmFsYW5j
ZXIsCisJCQkJCQkJCSBjb3VudCk7CisKKwkJCWVuZ2luZXMuZW5naW5lc1tuZW5naW5lc10uZW5n
aW5lX2NsYXNzID0KKwkJCQlJOTE1X0VOR0lORV9DTEFTU19JTlZBTElEOworCQkJZW5naW5lcy5l
bmdpbmVzW25lbmdpbmVzXS5lbmdpbmVfaW5zdGFuY2UgPQorCQkJCUk5MTVfRU5HSU5FX0NMQVNT
X0lOVkFMSURfTk9ORTsKKworCQkJYmFsYW5jZXIgPSBjYWxsb2Moc2l6ZW9mKCpiYWxhbmNlciks
IDEpOworCQkJaWd0X2Fzc2VydChiYWxhbmNlcik7CisKKwkJCWJhbGFuY2VyLT5iYXNlLm5hbWUg
PQorCQkJCUk5MTVfQ09OVEVYVF9FTkdJTkVTX0VYVF9MT0FEX0JBTEFOQ0U7CisJCQliYWxhbmNl
ci0+YmFzZS5uZXh0X2V4dGVuc2lvbiA9CisJCQkJdG9fdXNlcl9wb2ludGVyKGJhbGFuY2Vycyk7
CisJCQliYWxhbmNlcnMgPSBiYWxhbmNlcjsKKworCQkJYmFsYW5jZXItPmVuZ2luZV9pbmRleCA9
IG5lbmdpbmVzKys7CisJCQliYWxhbmNlci0+bnVtX3NpYmxpbmdzID0gY291bnQ7CisKKwkJCW1l
bWNweShiYWxhbmNlci0+ZW5naW5lcywKKwkJCSAgICAgICBjaSwgY291bnQgKiBzaXplb2YoKmNp
KSk7CisJCX0KKwkJZnJlZShjaSk7CisJfQorCisJaWd0X3JlcXVpcmUoYmFsYW5jZXJzKTsKKwll
bmdpbmVzLmV4dGVuc2lvbnMgPSB0b191c2VyX3BvaW50ZXIoYmFsYW5jZXJzKTsKKwlwLnNpemUg
PSAoc2l6ZW9mKHN0cnVjdCBpOTE1X2VuZ2luZV9jbGFzc19pbnN0YW5jZSkgKiBuZW5naW5lcyAr
CisJCSAgc2l6ZW9mKHN0cnVjdCBpOTE1X2NvbnRleHRfcGFyYW1fZW5naW5lcykpOworCWdlbV9j
b250ZXh0X3NldF9wYXJhbShpOTE1LCAmcCk7CisKKwlmb3IgKHVuc2lnbmVkIGludCBuID0gMDsg
biA8IG5lbmdpbmVzOyBuKyspIHsKKwkJc3RydWN0IGRybV9pOTE1X2dlbV9leGVjYnVmZmVyMiBl
YiA9IHsKKwkJCS5idWZmZXJzX3B0ciA9IHRvX3VzZXJfcG9pbnRlcigmYmF0Y2gpLAorCQkJLmJ1
ZmZlcl9jb3VudCA9IDEsCisJCQkuZmxhZ3MgPSBuLAorCQkJLnJzdmQxID0gcC5jdHhfaWQsCisJ
CX07CisJCWlndF9kZWJ1ZygiRXhlY3V0aW5nIG9uIGluZGV4PSVkXG4iLCBuKTsKKwkJZ2VtX2V4
ZWNidWYoaTkxNSwgJmViKTsKKwl9CisJZ2VtX2NvbnRleHRfZGVzdHJveShpOTE1LCBwLmN0eF9p
ZCk7CisKKwlnZW1fc3luYyhpOTE1LCBiYXRjaC5oYW5kbGUpOworCWdlbV9jbG9zZShpOTE1LCBi
YXRjaC5oYW5kbGUpOworCisJd2hpbGUgKGJhbGFuY2VycykgeworCQlzdHJ1Y3QgaTkxNV9jb250
ZXh0X2VuZ2luZXNfbG9hZF9iYWxhbmNlICpiLCAqbjsKKworCQliID0gYmFsYW5jZXJzOworCQlu
ID0gZnJvbV91c2VyX3BvaW50ZXIoYi0+YmFzZS5uZXh0X2V4dGVuc2lvbik7CisJCWZyZWUoYik7
CisKKwkJYmFsYW5jZXJzID0gbjsKKwl9CisKKwlnZW1fcXVpZXNjZW50X2dwdShpOTE1KTsKK30K
Kworc3RhdGljIHZvaWQgYnVzeShpbnQgaTkxNSkKK3sKKwl1aW50MzJfdCBzY3JhdGNoID0gZ2Vt
X2NyZWF0ZShpOTE1LCA0MDk2KTsKKworCS8qCisJICogQ2hlY2sgdGhhdCB2aXJ0dWFsIGVuZ2lu
ZXMgYXJlIHJlcG9ydGVkIHZpYSBHRU1fQlVTWS4KKwkgKgorCSAqIFdoZW4gcnVubmluZywgdGhl
IGJhdGNoIHdpbGwgYmUgb24gdGhlIHJlYWwgZW5naW5lIGFuZCByZXBvcnQKKwkgKiB0aGUgYWN0
dWFsIGNsYXNzLgorCSAqCisJICogUHJpb3IgdG8gcnVubmluZywgaWYgdGhlIGxvYWQtYmFsYW5j
ZXIgaXMgYWNyb3NzIG11bHRpcGxlCisJICogY2xhc3NlcyB3ZSBkb24ndCBrbm93IHdoaWNoIGVu
Z2luZSB0aGUgYmF0Y2ggd2lsbAorCSAqIGV4ZWN1dGUgb24sIHNvIHdlIHJlcG9ydCB0aGVtIGFs
bCEKKwkgKgorCSAqIEhvd2V2ZXIsIGFzIHdlIG9ubHkgc3VwcG9ydCAoYW5kIHRlc3QpIGNyZWF0
aW5nIGEgbG9hZC1iYWxhbmNlcgorCSAqIGZyb20gZW5naW5lcyBvZiBvbmx5IG9uZSBjbGFzcywg
dGhhdCBjYW4gYmUgcHJvcGFnYXRlZCBhY2N1cmF0ZWx5CisJICogdGhyb3VnaCB0byBHRU1fQlVT
WS4KKwkgKi8KKworCWZvciAoaW50IGNsYXNzID0gMDsgY2xhc3MgPCAxNjsgY2xhc3MrKykgewor
CQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2J1c3kgYnVzeTsKKwkJc3RydWN0IGk5MTVfZW5naW5lX2Ns
YXNzX2luc3RhbmNlICpjaTsKKwkJdW5zaWduZWQgaW50IGNvdW50OworCQlpZ3Rfc3Bpbl90ICpz
cGluWzJdOworCQl1aW50MzJfdCBjdHg7CisKKwkJY2kgPSBsaXN0X2VuZ2luZXMoaTkxNSwgMXUg
PDwgY2xhc3MsICZjb3VudCk7CisJCWlmICghY2kpCisJCQljb250aW51ZTsKKworCQlpZ3RfZGVi
dWcoIkZvdW5kICVkIGVuZ2luZXMgb2YgY2xhc3MgJWRcbiIsIGNvdW50LCBjbGFzcyk7CisJCWN0
eCA9IGxvYWRfYmFsYW5jZXJfY3JlYXRlKGk5MTUsIGNpLCBjb3VudCk7CisJCWZyZWUoY2kpOwor
CisJCXNwaW5bMF0gPSBfX2lndF9zcGluX25ldyhpOTE1LAorCQkJCQkgLmN0eCA9IGN0eCwKKwkJ
CQkJIC5mbGFncyA9IElHVF9TUElOX1BPTExfUlVOKTsKKwkJc3BpblsxXSA9IF9faWd0X3NwaW5f
bmV3KGk5MTUsCisJCQkJCSAuY3R4ID0gY3R4LAorCQkJCQkgLmRlcGVuZGVuY3kgPSBzY3JhdGNo
KTsKKworCQlpZ3Rfc3Bpbl9idXN5d2FpdF91bnRpbF9zdGFydGVkKHNwaW5bMF0pOworCisJCS8q
IFJ1bm5pbmc6IGFjdHVhbCBjbGFzcyAqLworCQlidXN5LmhhbmRsZSA9IHNwaW5bMF0tPmhhbmRs
ZTsKKwkJZG9faW9jdGwoaTkxNSwgRFJNX0lPQ1RMX0k5MTVfR0VNX0JVU1ksICZidXN5KTsKKwkJ
aWd0X2Fzc2VydF9lcV91MzIoYnVzeS5idXN5LCAxdSA8PCAoY2xhc3MgKyAxNikpOworCisJCS8q
IFF1ZXVlZChyZWFkKTogZXhwZWN0ZWQgY2xhc3MgKi8KKwkJYnVzeS5oYW5kbGUgPSBzcGluWzFd
LT5oYW5kbGU7CisJCWRvX2lvY3RsKGk5MTUsIERSTV9JT0NUTF9JOTE1X0dFTV9CVVNZLCAmYnVz
eSk7CisJCWlndF9hc3NlcnRfZXFfdTMyKGJ1c3kuYnVzeSwgMXUgPDwgKGNsYXNzICsgMTYpKTsK
KworCQkvKiBRdWV1ZWQod3JpdGUpOiBleHBlY3RlZCBjbGFzcyAqLworCQlidXN5LmhhbmRsZSA9
IHNjcmF0Y2g7CisJCWRvX2lvY3RsKGk5MTUsIERSTV9JT0NUTF9JOTE1X0dFTV9CVVNZLCAmYnVz
eSk7CisJCWlndF9hc3NlcnRfZXFfdTMyKGJ1c3kuYnVzeSwKKwkJCQkgICgxdSA8PCAoY2xhc3Mg
KyAxNikpIHwgKGNsYXNzICsgMSkpOworCisJCWlndF9zcGluX2ZyZWUoaTkxNSwgc3BpblsxXSk7
CisJCWlndF9zcGluX2ZyZWUoaTkxNSwgc3BpblswXSk7CisKKwkJZ2VtX2NvbnRleHRfZGVzdHJv
eShpOTE1LCBjdHgpOworCX0KKworCWdlbV9jbG9zZShpOTE1LCBzY3JhdGNoKTsKKwlnZW1fcXVp
ZXNjZW50X2dwdShpOTE1KTsKK30KKworc3RhdGljIGludCBhZGRfcG11KGludCBwbXUsIGNvbnN0
IHN0cnVjdCBpOTE1X2VuZ2luZV9jbGFzc19pbnN0YW5jZSAqY2kpCit7CisJcmV0dXJuIHBlcmZf
aTkxNV9vcGVuX2dyb3VwKEk5MTVfUE1VX0VOR0lORV9CVVNZKGNpLT5lbmdpbmVfY2xhc3MsCisJ
CQkJCQkJIGNpLT5lbmdpbmVfaW5zdGFuY2UpLAorCQkJCSAgICBwbXUpOworfQorCitzdGF0aWMg
dm9pZCBmdWxsKGludCBpOTE1LCB1bnNpZ25lZCBpbnQgZmxhZ3MpCisjZGVmaW5lIFBVTFNFIDB4
MQorI2RlZmluZSBMQVRFIDB4MgoreworCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY19vYmplY3Qy
IGJhdGNoID0geworCQkuaGFuZGxlID0gYmF0Y2hfY3JlYXRlKGk5MTUpLAorCX07CisKKwlpZiAo
ZmxhZ3MgJiBMQVRFKQorCQlpZ3RfcmVxdWlyZV9zd19zeW5jKCk7CisKKwkvKgorCSAqIEk5MTVf
Q09OVEVYVF9QQVJBTV9FTkdJTkUgY2hhbmdlcyB0aGUgbWVhbmluZyBvZiBJOTE1X0VYRUNfREVG
QVVMVAorCSAqIHRvIHByb3ZpZGUgYW4gYXV0b21hdGljIHNlbGVjdGlvbiBmcm9tIHRoZSBjdHgt
PmVuZ2luZVtdLiBJdAorCSAqIGVtcGxveXMgbG9hZC1iYWxhbmNpbmcgdG8gZXZlbmx5IGRpc3Ry
aWJ1dGUgdGhlIHdvcmtsb2FkIHRoZQorCSAqIGFycmF5LiBJZiB3ZSBzdWJtaXQgTiBzcGlubmVy
cywgd2UgZXhwZWN0IHRoZW0gdG8gYmUgc2ltdWx0YW5lb3VzbHkKKwkgKiBydW5uaW5nIGFjcm9z
cyBOIGVuZ2luZXMgYW5kIHVzZSBQTVUgdG8gY29uZmlybSB0aGF0IHRoZSBlbnRpcmUKKwkgKiBz
ZXQgb2YgZW5naW5lcyBhcmUgYnVzeS4KKwkgKgorCSAqIFdlIGNvbXBsaWNhdGUgbWF0dGVycyBi
eSBpbnRlcnBlcnNpbmcgc2hvcnRsaXZlZCB0YXNrcyB0byBjaGFsbGVuZ2UKKwkgKiB0aGUga2Vy
bmVsIHRvIHNlYXJjaCBmb3Igc3BhY2UgaW4gd2hpY2ggdG8gaW5zZXJ0IG5ldyBiYXRjaGVzLgor
CSAqLworCisKKwlmb3IgKGludCBtYXNrID0gMDsgbWFzayA8IDMyOyBtYXNrKyspIHsKKwkJc3Ry
dWN0IGk5MTVfZW5naW5lX2NsYXNzX2luc3RhbmNlICpjaTsKKwkJaWd0X3NwaW5fdCAqc3BpbiA9
IE5VTEw7CisJCUlHVF9DT1JLX0ZFTkNFKGNvcmspOworCQl1bnNpZ25lZCBpbnQgY291bnQ7CisJ
CWRvdWJsZSBsb2FkOworCQlpbnQgZmVuY2UgPSAtMTsKKwkJaW50ICpwbXU7CisKKwkJY2kgPSBs
aXN0X2VuZ2luZXMoaTkxNSwgMXUgPDwgbWFzaywgJmNvdW50KTsKKwkJaWYgKCFjaSkKKwkJCWNv
bnRpbnVlOworCisJCWlndF9kZWJ1ZygiRm91bmQgJWQgZW5naW5lcyBvZiBjbGFzcyAlZFxuIiwg
Y291bnQsIG1hc2spOworCisJCXBtdSA9IG1hbGxvYyhzaXplb2YoKnBtdSkgKiBjb3VudCk7CisJ
CWlndF9hc3NlcnQocG11KTsKKworCQlpZiAoZmxhZ3MgJiBMQVRFKQorCQkJZmVuY2UgPSBpZ3Rf
Y29ya19wbHVnKCZjb3JrLCBpOTE1KTsKKworCQlwbXVbMF0gPSAtMTsKKwkJZm9yICh1bnNpZ25l
ZCBpbnQgbiA9IDA7IG4gPCBjb3VudDsgbisrKSB7CisJCQl1aW50MzJfdCBjdHg7CisKKwkJCXBt
dVtuXSA9IGFkZF9wbXUocG11WzBdLCAmY2lbbl0pOworCisJCQlpZiAoZmxhZ3MgJiBQVUxTRSkg
eworCQkJCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY2J1ZmZlcjIgZWIgPSB7CisJCQkJCS5idWZm
ZXJzX3B0ciA9IHRvX3VzZXJfcG9pbnRlcigmYmF0Y2gpLAorCQkJCQkuYnVmZmVyX2NvdW50ID0g
MSwKKwkJCQkJLnJzdmQyID0gZmVuY2UsCisJCQkJCS5mbGFncyA9IGZsYWdzICYgTEFURSA/IEk5
MTVfRVhFQ19GRU5DRV9JTiA6IDAsCisJCQkJfTsKKwkJCQlnZW1fZXhlY2J1ZihpOTE1LCAmZWIp
OworCQkJfQorCisJCQkvKgorCQkJICogRWFjaCBzcGlubmVyIG5lZWRzIHRvIGJlIG9uZSBhIG5l
dyB0aW1lbGluZSwKKwkJCSAqIG90aGVyd2lzZSB0aGV5IHdpbGwganVzdCBzaXQgaW4gdGhlIHNp
bmdsZSBxdWV1ZQorCQkJICogYW5kIG5vdCBydW4gY29uY3VycmVudGx5LgorCQkJICovCisJCQlj
dHggPSBsb2FkX2JhbGFuY2VyX2NyZWF0ZShpOTE1LCBjaSwgY291bnQpOworCisJCQlpZiAoc3Bp
biA9PSBOVUxMKSB7CisJCQkJc3BpbiA9IF9faWd0X3NwaW5fbmV3KGk5MTUsIC5jdHggPSBjdHgp
OworCQkJfSBlbHNlIHsKKwkJCQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyIGViID0g
eworCQkJCQkuYnVmZmVyc19wdHIgPSBzcGluLT5leGVjYnVmLmJ1ZmZlcnNfcHRyLAorCQkJCQku
YnVmZmVyX2NvdW50ID0gc3Bpbi0+ZXhlY2J1Zi5idWZmZXJfY291bnQsCisJCQkJCS5yc3ZkMSA9
IGN0eCwKKwkJCQkJLnJzdmQyID0gZmVuY2UsCisJCQkJCS5mbGFncyA9IGZsYWdzICYgTEFURSA/
IEk5MTVfRVhFQ19GRU5DRV9JTiA6IDAsCisJCQkJfTsKKwkJCQlnZW1fZXhlY2J1ZihpOTE1LCAm
ZWIpOworCQkJfQorCisJCQlnZW1fY29udGV4dF9kZXN0cm95KGk5MTUsIGN0eCk7CisJCX0KKwor
CQlpZiAoZmxhZ3MgJiBMQVRFKSB7CisJCQlpZ3RfY29ya191bnBsdWcoJmNvcmspOworCQkJY2xv
c2UoZmVuY2UpOworCQl9CisKKwkJbG9hZCA9IG1lYXN1cmVfbWluX2xvYWQocG11WzBdLCBjb3Vu
dCwgMTAwMDApOworCQlpZ3Rfc3Bpbl9mcmVlKGk5MTUsIHNwaW4pOworCisJCWNsb3NlKHBtdVsw
XSk7CisJCWZyZWUocG11KTsKKworCQlmcmVlKGNpKTsKKworCQlpZ3RfYXNzZXJ0X2YobG9hZCA+
IDAuOTAsCisJCQkgICAgICJtaW5pbXVtIGxvYWQgZm9yICVkIHggY2xhc3M6JWQgd2FzIGZvdW5k
IHRvIGJlIG9ubHkgJS4xZiUlIGJ1c3lcbiIsCisJCQkgICAgIGNvdW50LCBtYXNrLCBsb2FkKjEw
MCk7CisJCWdlbV9xdWllc2NlbnRfZ3B1KGk5MTUpOworCX0KKworCWdlbV9jbG9zZShpOTE1LCBi
YXRjaC5oYW5kbGUpOworCWdlbV9xdWllc2NlbnRfZ3B1KGk5MTUpOworfQorCitzdGF0aWMgdm9p
ZCBub3AoaW50IGk5MTUpCit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9leGVjX29iamVjdDIgYmF0
Y2ggPSB7CisJCS5oYW5kbGUgPSBiYXRjaF9jcmVhdGUoaTkxNSksCisJfTsKKworCWZvciAoaW50
IG1hc2sgPSAwOyBtYXNrIDwgMzI7IG1hc2srKykgeworCQlzdHJ1Y3QgaTkxNV9lbmdpbmVfY2xh
c3NfaW5zdGFuY2UgKmNpOworCQl1bnNpZ25lZCBpbnQgY291bnQ7CisJCXVpbnQzMl90IGN0eDsK
KworCQljaSA9IGxpc3RfZW5naW5lcyhpOTE1LCAxdSA8PCBtYXNrLCAmY291bnQpOworCQlpZiAo
IWNpKQorCQkJY29udGludWU7CisKKwkJaWYgKGNvdW50IDwgMikgeworCQkJZnJlZShjaSk7CisJ
CQljb250aW51ZTsKKwkJfQorCisJCWlndF9kZWJ1ZygiRm91bmQgJWQgZW5naW5lcyBvZiBjbGFz
cyAlZFxuIiwgY291bnQsIG1hc2spOworCQljdHggPSBsb2FkX2JhbGFuY2VyX2NyZWF0ZShpOTE1
LCBjaSwgY291bnQpOworCisJCWZvciAoaW50IG4gPSAwOyBuIDwgY291bnQ7IG4rKykgeworCQkJ
c3RydWN0IGRybV9pOTE1X2dlbV9leGVjYnVmZmVyMiBleGVjYnVmID0geworCQkJCS5idWZmZXJz
X3B0ciA9IHRvX3VzZXJfcG9pbnRlcigmYmF0Y2gpLAorCQkJCS5idWZmZXJfY291bnQgPSAxLAor
CQkJCS5mbGFncyA9IG4gKyAxLAorCQkJCS5yc3ZkMSA9IGN0eCwKKwkJCX07CisJCQlzdHJ1Y3Qg
dGltZXNwZWMgdHYgPSB7fTsKKwkJCXVuc2lnbmVkIGxvbmcgbm9wczsKKwkJCWRvdWJsZSB0Owor
CisJCQlpZ3RfbnNlY19lbGFwc2VkKCZ0dik7CisJCQlub3BzID0gMDsKKwkJCWRvIHsKKwkJCQlm
b3IgKGludCByID0gMDsgciA8IDEwMjQ7IHIrKykKKwkJCQkJZ2VtX2V4ZWNidWYoaTkxNSwgJmV4
ZWNidWYpOworCQkJCW5vcHMgKz0gMTAyNDsKKwkJCX0gd2hpbGUgKGlndF9zZWNvbmRzX2VsYXBz
ZWQoJnR2KSA8IDIpOworCQkJZ2VtX3N5bmMoaTkxNSwgYmF0Y2guaGFuZGxlKTsKKworCQkJdCA9
IGlndF9uc2VjX2VsYXBzZWQoJnR2KSAqIDFlLTMgLyBub3BzOworCQkJaWd0X2luZm8oIiV4OiVk
ICUuM2Z1c1xuIiwgbWFzaywgbiwgdCk7CisJCX0KKworCQl7CisJCQlzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX2V4ZWNidWZmZXIyIGV4ZWNidWYgPSB7CisJCQkJLmJ1ZmZlcnNfcHRyID0gdG9fdXNlcl9w
b2ludGVyKCZiYXRjaCksCisJCQkJLmJ1ZmZlcl9jb3VudCA9IDEsCisJCQkJLnJzdmQxID0gY3R4
LAorCQkJfTsKKwkJCXN0cnVjdCB0aW1lc3BlYyB0diA9IHt9OworCQkJdW5zaWduZWQgbG9uZyBu
b3BzOworCQkJZG91YmxlIHQ7CisKKwkJCWlndF9uc2VjX2VsYXBzZWQoJnR2KTsKKwkJCW5vcHMg
PSAwOworCQkJZG8geworCQkJCWZvciAoaW50IHIgPSAwOyByIDwgMTAyNDsgcisrKQorCQkJCQln
ZW1fZXhlY2J1ZihpOTE1LCAmZXhlY2J1Zik7CisJCQkJbm9wcyArPSAxMDI0OworCQkJfSB3aGls
ZSAoaWd0X3NlY29uZHNfZWxhcHNlZCgmdHYpIDwgMik7CisJCQlnZW1fc3luYyhpOTE1LCBiYXRj
aC5oYW5kbGUpOworCisJCQl0ID0gaWd0X25zZWNfZWxhcHNlZCgmdHYpICogMWUtMyAvIG5vcHM7
CisJCQlpZ3RfaW5mbygiJXg6KiAlLjNmdXNcbiIsIG1hc2ssIHQpOworCQl9CisKKworCQlpZ3Rf
Zm9yayhjaGlsZCwgY291bnQpIHsKKwkJCXN0cnVjdCBkcm1faTkxNV9nZW1fZXhlY2J1ZmZlcjIg
ZXhlY2J1ZiA9IHsKKwkJCQkuYnVmZmVyc19wdHIgPSB0b191c2VyX3BvaW50ZXIoJmJhdGNoKSwK
KwkJCQkuYnVmZmVyX2NvdW50ID0gMSwKKwkJCQkuZmxhZ3MgPSBjaGlsZCArIDEsCisJCQkJLnJz
dmQxID0gZ2VtX2NvbnRleHRfY2xvbmUoaTkxNSwgY3R4LAorCQkJCQkJCSAgIEk5MTVfQ09OVEVY
VF9DTE9ORV9FTkdJTkVTLCAwKSwKKwkJCX07CisJCQlzdHJ1Y3QgdGltZXNwZWMgdHYgPSB7fTsK
KwkJCXVuc2lnbmVkIGxvbmcgbm9wczsKKwkJCWRvdWJsZSB0OworCisJCQlpZ3RfbnNlY19lbGFw
c2VkKCZ0dik7CisJCQlub3BzID0gMDsKKwkJCWRvIHsKKwkJCQlmb3IgKGludCByID0gMDsgciA8
IDEwMjQ7IHIrKykKKwkJCQkJZ2VtX2V4ZWNidWYoaTkxNSwgJmV4ZWNidWYpOworCQkJCW5vcHMg
Kz0gMTAyNDsKKwkJCX0gd2hpbGUgKGlndF9zZWNvbmRzX2VsYXBzZWQoJnR2KSA8IDIpOworCQkJ
Z2VtX3N5bmMoaTkxNSwgYmF0Y2guaGFuZGxlKTsKKworCQkJdCA9IGlndF9uc2VjX2VsYXBzZWQo
JnR2KSAqIDFlLTMgLyBub3BzOworCQkJaWd0X2luZm8oIlslZF0gJXg6JWQgJS4zZnVzXG4iLCBj
aGlsZCwgbWFzaywgY2hpbGQsIHQpOworCisJCQltZW1zZXQoJnR2LCAwLCBzaXplb2YodHYpKTsK
KwkJCWV4ZWNidWYuZmxhZ3MgPSAwOworCisJCQlpZ3RfbnNlY19lbGFwc2VkKCZ0dik7CisJCQlu
b3BzID0gMDsKKwkJCWRvIHsKKwkJCQlmb3IgKGludCByID0gMDsgciA8IDEwMjQ7IHIrKykKKwkJ
CQkJZ2VtX2V4ZWNidWYoaTkxNSwgJmV4ZWNidWYpOworCQkJCW5vcHMgKz0gMTAyNDsKKwkJCX0g
d2hpbGUgKGlndF9zZWNvbmRzX2VsYXBzZWQoJnR2KSA8IDIpOworCQkJZ2VtX3N5bmMoaTkxNSwg
YmF0Y2guaGFuZGxlKTsKKworCQkJdCA9IGlndF9uc2VjX2VsYXBzZWQoJnR2KSAqIDFlLTMgLyBu
b3BzOworCQkJaWd0X2luZm8oIlslZF0gJXg6KiAlLjNmdXNcbiIsIGNoaWxkLCBtYXNrLCB0KTsK
KworCQkJZ2VtX2NvbnRleHRfZGVzdHJveShpOTE1LCBleGVjYnVmLnJzdmQxKTsKKwkJfQorCisJ
CWlndF93YWl0Y2hpbGRyZW4oKTsKKworCQlnZW1fY29udGV4dF9kZXN0cm95KGk5MTUsIGN0eCk7
CisJCWZyZWUoY2kpOworCX0KKworCWdlbV9jbG9zZShpOTE1LCBiYXRjaC5oYW5kbGUpOworCWdl
bV9xdWllc2NlbnRfZ3B1KGk5MTUpOworfQorCitzdGF0aWMgdm9pZCBwaW5nKGludCBpOTE1LCB1
aW50MzJfdCBjdHgsIHVuc2lnbmVkIGludCBlbmdpbmUpCit7CisJc3RydWN0IGRybV9pOTE1X2dl
bV9leGVjX29iamVjdDIgb2JqID0geworCQkuaGFuZGxlID0gYmF0Y2hfY3JlYXRlKGk5MTUpLAor
CX07CisJc3RydWN0IGRybV9pOTE1X2dlbV9leGVjYnVmZmVyMiBleGVjYnVmID0geworCQkuYnVm
ZmVyc19wdHIgPSB0b191c2VyX3BvaW50ZXIoJm9iaiksCisJCS5idWZmZXJfY291bnQgPSAxLAor
CQkuZmxhZ3MgPSBlbmdpbmUsCisJCS5yc3ZkMSA9IGN0eCwKKwl9OworCWdlbV9leGVjYnVmKGk5
MTUsICZleGVjYnVmKTsKKwlnZW1fc3luYyhpOTE1LCBvYmouaGFuZGxlKTsKKwlnZW1fY2xvc2Uo
aTkxNSwgb2JqLmhhbmRsZSk7Cit9CisKK3N0YXRpYyB2b2lkIHNlbWFwaG9yZShpbnQgaTkxNSkK
K3sKKwl1aW50MzJfdCBibG9ja1syXSwgc2NyYXRjaDsKKwlpZ3Rfc3Bpbl90ICpzcGluWzNdOwor
CisJLyoKKwkgKiBJZiB3ZSBhcmUgdXNpbmcgSFcgc2VtYXBob3JlcyB0byBsYXVuY2ggc2VyaWFs
aXNlZCByZXF1ZXN0cworCSAqIG9uIGRpZmZlcmVudCBlbmdpbmUgY29uY3VycmVudGx5LCB3ZSB3
YW50IHRvIHZlcmlmeSB0aGF0IHJlYWwKKwkgKiB3b3JrIGlzIHVuaW1wZWRlZC4KKwkgKi8KKwlp
Z3RfcmVxdWlyZShnZW1fc2NoZWR1bGVyX2hhc19wcmVlbXB0aW9uKGk5MTUpKTsKKworCWJsb2Nr
WzBdID0gZ2VtX2NvbnRleHRfY3JlYXRlKGk5MTUpOworCWJsb2NrWzFdID0gZ2VtX2NvbnRleHRf
Y3JlYXRlKGk5MTUpOworCisJc2NyYXRjaCA9IGdlbV9jcmVhdGUoaTkxNSwgNDA5Nik7CisJc3Bp
blsyXSA9IGlndF9zcGluX25ldyhpOTE1LCAuZGVwZW5kZW5jeSA9IHNjcmF0Y2gpOworCWZvciAo
aW50IG1hc2sgPSAxOyBtYXNrIDwgMzI7IG1hc2srKykgeworCQlzdHJ1Y3QgaTkxNV9lbmdpbmVf
Y2xhc3NfaW5zdGFuY2UgKmNpOworCQl1bnNpZ25lZCBpbnQgY291bnQ7CisJCXVpbnQzMl90IHZp
cDsKKworCQljaSA9IGxpc3RfZW5naW5lcyhpOTE1LCAxdSA8PCBtYXNrLCAmY291bnQpOworCQlp
ZiAoIWNpKQorCQkJY29udGludWU7CisKKwkJaWYgKGNvdW50IDwgQVJSQVlfU0laRShibG9jaykp
CisJCQljb250aW51ZTsKKworCQkvKiBFbnN1cmUgdGhhdCB3ZSBjb21wbGV0ZWx5IG9jY3VweSBh
bGwgZW5naW5lcyBpbiB0aGlzIGdyb3VwICovCisJCWNvdW50ID0gQVJSQVlfU0laRShibG9jayk7
CisKKwkJZm9yIChpbnQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CisJCQlzZXRfbG9hZF9iYWxh
bmNlcihpOTE1LCBibG9ja1tpXSwgY2ksIGNvdW50KTsKKwkJCXNwaW5baV0gPSBfX2lndF9zcGlu
X25ldyhpOTE1LAorCQkJCQkJICAgICAgIC5jdHggPSBibG9ja1tpXSwKKwkJCQkJCSAgICAgICAu
ZGVwZW5kZW5jeSA9IHNjcmF0Y2gpOworCQl9CisKKwkJLyoKKwkJICogRWl0aGVyIHdlIGhhdmVu
J3QgYmxvY2tlZCBib3RoIGVuZ2luZXMgd2l0aCBzZW1hcGhvcmVzLAorCQkgKiBvciB3ZSBsZXQg
dGhlIHZpcCB0aHJvdWdoLiBJZiBub3QsIHdlIGhhbmcuCisJCSAqLworCQl2aXAgPSBnZW1fY29u
dGV4dF9jcmVhdGUoaTkxNSk7CisJCXNldF9sb2FkX2JhbGFuY2VyKGk5MTUsIHZpcCwgY2ksIGNv
dW50KTsKKwkJcGluZyhpOTE1LCB2aXAsIDApOworCQlnZW1fY29udGV4dF9kZXN0cm95KGk5MTUs
IHZpcCk7CisKKwkJZm9yIChpbnQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKQorCQkJaWd0X3NwaW5f
ZnJlZShpOTE1LCBzcGluW2ldKTsKKworCQlmcmVlKGNpKTsKKwl9CisJaWd0X3NwaW5fZnJlZShp
OTE1LCBzcGluWzJdKTsKKwlnZW1fY2xvc2UoaTkxNSwgc2NyYXRjaCk7CisKKwlnZW1fY29udGV4
dF9kZXN0cm95KGk5MTUsIGJsb2NrWzFdKTsKKwlnZW1fY29udGV4dF9kZXN0cm95KGk5MTUsIGJs
b2NrWzBdKTsKKworCWdlbV9xdWllc2NlbnRfZ3B1KGk5MTUpOworfQorCitzdGF0aWMgdm9pZCBz
bW9rZXRlc3QoaW50IGk5MTUsIGludCB0aW1lb3V0KQoreworCXN0cnVjdCBkcm1faTkxNV9nZW1f
ZXhlY19vYmplY3QyIGJhdGNoWzJdID0geworCQl7IC5oYW5kbGUgPSBfX2JhdGNoX2NyZWF0ZShp
OTE1LCAxNjM4MCkgfQorCX07CisJdW5zaWduZWQgaW50IG5jb250ZXh0ID0gMDsKKwl1aW50MzJf
dCAqY29udGV4dHMgPSBOVUxMOworCXVpbnQzMl90ICpoYW5kbGVzID0gTlVMTDsKKworCWlndF9y
ZXF1aXJlX3N3X3N5bmMoKTsKKworCWZvciAoaW50IG1hc2sgPSAwOyBtYXNrIDwgMzI7IG1hc2sr
KykgeworCQlzdHJ1Y3QgaTkxNV9lbmdpbmVfY2xhc3NfaW5zdGFuY2UgKmNpOworCQl1bnNpZ25l
ZCBpbnQgY291bnQgPSAwOworCisJCWNpID0gbGlzdF9lbmdpbmVzKGk5MTUsIDF1IDw8IG1hc2ss
ICZjb3VudCk7CisJCWlmICghY2kgfHwgY291bnQgPCAyKSB7CisJCQlmcmVlKGNpKTsKKwkJCWNv
bnRpbnVlOworCQl9CisKKwkJaWd0X2RlYnVnKCJGb3VuZCAlZCBlbmdpbmVzIG9mIGNsYXNzICVk
XG4iLCBjb3VudCwgbWFzayk7CisKKwkJbmNvbnRleHQgKz0gMTI4OworCQljb250ZXh0cyA9IHJl
YWxsb2MoY29udGV4dHMsIHNpemVvZigqY29udGV4dHMpICogbmNvbnRleHQpOworCQlpZ3RfYXNz
ZXJ0KGNvbnRleHRzKTsKKworCQlmb3IgKHVuc2lnbmVkIGludCBuID0gbmNvbnRleHQgLSAxMjg7
IG4gPCBuY29udGV4dDsgbisrKSB7CisJCQljb250ZXh0c1tuXSA9IGxvYWRfYmFsYW5jZXJfY3Jl
YXRlKGk5MTUsIGNpLCBjb3VudCk7CisJCQlpZ3RfYXNzZXJ0KGNvbnRleHRzW25dKTsKKwkJfQor
CisJCWZyZWUoY2kpOworCX0KKwlpZ3RfZGVidWcoIkNyZWF0ZWQgJWQgdmlydHVhbCBlbmdpbmVz
IChvbmUgcGVyIGNvbnRleHQpXG4iLCBuY29udGV4dCk7CisJaWd0X3JlcXVpcmUobmNvbnRleHQp
OworCisJY29udGV4dHMgPSByZWFsbG9jKGNvbnRleHRzLCBzaXplb2YoKmNvbnRleHRzKSAqIG5j
b250ZXh0ICogNCk7CisJaWd0X2Fzc2VydChjb250ZXh0cyk7CisJbWVtY3B5KGNvbnRleHRzICsg
bmNvbnRleHQsIGNvbnRleHRzLCBuY29udGV4dCAqIHNpemVvZigqY29udGV4dHMpKTsKKwluY29u
dGV4dCAqPSAyOworCW1lbWNweShjb250ZXh0cyArIG5jb250ZXh0LCBjb250ZXh0cywgbmNvbnRl
eHQgKiBzaXplb2YoKmNvbnRleHRzKSk7CisJbmNvbnRleHQgKj0gMjsKKworCWhhbmRsZXMgPSBt
YWxsb2Moc2l6ZW9mKCpoYW5kbGVzKSAqIG5jb250ZXh0KTsKKwlpZ3RfYXNzZXJ0KGhhbmRsZXMp
OworCWZvciAodW5zaWduZWQgaW50IG4gPSAwOyBuIDwgbmNvbnRleHQ7IG4rKykKKwkJaGFuZGxl
c1tuXSA9IGdlbV9jcmVhdGUoaTkxNSwgNDA5Nik7CisKKwlpZ3RfdW50aWxfdGltZW91dCh0aW1l
b3V0KSB7CisJCXVuc2lnbmVkIGludCBjb3VudCA9IDEgKyAocmFuZCgpICUgKG5jb250ZXh0IC0g
MSkpOworCQlJR1RfQ09SS19GRU5DRShjb3JrKTsKKwkJaW50IGZlbmNlID0gaWd0X2NvcmtfcGx1
ZygmY29yaywgaTkxNSk7CisKKwkJZm9yICh1bnNpZ25lZCBpbnQgbiA9IDA7IG4gPCBjb3VudDsg
bisrKSB7CisJCQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyIGViID0geworCQkJCS5i
dWZmZXJzX3B0ciA9IHRvX3VzZXJfcG9pbnRlcihiYXRjaCksCisJCQkJLmJ1ZmZlcl9jb3VudCA9
IEFSUkFZX1NJWkUoYmF0Y2gpLAorCQkJCS5yc3ZkMSA9IGNvbnRleHRzW25dLAorCQkJCS5yc3Zk
MiA9IGZlbmNlLAorCQkJCS5mbGFncyA9IEk5MTVfRVhFQ19CQVRDSF9GSVJTVCB8IEk5MTVfRVhF
Q19GRU5DRV9JTiwKKwkJCX07CisJCQliYXRjaFsxXS5oYW5kbGUgPSBoYW5kbGVzW25dOworCQkJ
Z2VtX2V4ZWNidWYoaTkxNSwgJmViKTsKKwkJfQorCQlpZ3RfcGVybXV0ZV9hcnJheShoYW5kbGVz
LCBjb3VudCwgaWd0X2V4Y2hhbmdlX2ludCk7CisKKwkJaWd0X2NvcmtfdW5wbHVnKCZjb3JrKTsK
KwkJZm9yICh1bnNpZ25lZCBpbnQgbiA9IDA7IG4gPCBjb3VudDsgbisrKQorCQkJZ2VtX3N5bmMo
aTkxNSwgaGFuZGxlc1tuXSk7CisKKwkJY2xvc2UoZmVuY2UpOworCX0KKworCWZvciAodW5zaWdu
ZWQgaW50IG4gPSAwOyBuIDwgbmNvbnRleHQ7IG4rKykgeworCQlnZW1fY2xvc2UoaTkxNSwgaGFu
ZGxlc1tuXSk7CisJCV9fZ2VtX2NvbnRleHRfZGVzdHJveShpOTE1LCBjb250ZXh0c1tuXSk7CisJ
fQorCWZyZWUoaGFuZGxlcyk7CisJZnJlZShjb250ZXh0cyk7CisJZ2VtX2Nsb3NlKGk5MTUsIGJh
dGNoWzBdLmhhbmRsZSk7Cit9CisKK3N0YXRpYyBib29sIGhhc19jb250ZXh0X2VuZ2luZXMoaW50
IGk5MTUpCit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9jb250ZXh0X3BhcmFtIHAgPSB7CisJCS5w
YXJhbSA9IEk5MTVfQ09OVEVYVF9QQVJBTV9FTkdJTkVTLAorCX07CisKKwlyZXR1cm4gX19nZW1f
Y29udGV4dF9zZXRfcGFyYW0oaTkxNSwgJnApID09IDA7Cit9CisKK3N0YXRpYyBib29sIGhhc19s
b2FkX2JhbGFuY2VyKGludCBpOTE1KQoreworCXN0cnVjdCBpOTE1X2VuZ2luZV9jbGFzc19pbnN0
YW5jZSBjaSA9IHt9OworCXVpbnQzMl90IGN0eDsKKwlpbnQgZXJyOworCisJY3R4ID0gZ2VtX2Nv
bnRleHRfY3JlYXRlKGk5MTUpOworCWVyciA9IF9fc2V0X2xvYWRfYmFsYW5jZXIoaTkxNSwgY3R4
LCAmY2ksIDEpOworCWdlbV9jb250ZXh0X2Rlc3Ryb3koaTkxNSwgY3R4KTsKKworCXJldHVybiBl
cnIgPT0gMDsKK30KKworaWd0X21haW4KK3sKKwlpbnQgaTkxNSA9IC0xOworCisJaWd0X3NraXBf
b25fc2ltdWxhdGlvbigpOworCisJaWd0X2ZpeHR1cmUgeworCQlpOTE1ID0gZHJtX29wZW5fZHJp
dmVyKERSSVZFUl9JTlRFTCk7CisJCWlndF9yZXF1aXJlX2dlbShpOTE1KTsKKworCQlnZW1fcmVx
dWlyZV9jb250ZXh0cyhpOTE1KTsKKwkJaWd0X3JlcXVpcmUoaGFzX2NvbnRleHRfZW5naW5lcyhp
OTE1KSk7CisJCWlndF9yZXF1aXJlKGhhc19sb2FkX2JhbGFuY2VyKGk5MTUpKTsKKworCQlpZ3Rf
Zm9ya19oYW5nX2RldGVjdG9yKGk5MTUpOworCX0KKworCWlndF9zdWJ0ZXN0KCJpbnZhbGlkLWJh
bGFuY2VyIikKKwkJaW52YWxpZF9iYWxhbmNlcihpOTE1KTsKKworCWlndF9zdWJ0ZXN0KCJpbmRp
dmlkdWFsIikKKwkJaW5kaXZpZHVhbChpOTE1KTsKKworCWlndF9zdWJ0ZXN0KCJpbmRpY2llcyIp
CisJCWluZGljaWVzKGk5MTUpOworCisJaWd0X3N1YnRlc3QoImJ1c3kiKQorCQlidXN5KGk5MTUp
OworCisJaWd0X3N1YnRlc3RfZ3JvdXAgeworCQlzdGF0aWMgY29uc3Qgc3RydWN0IHsKKwkJCWNv
bnN0IGNoYXIgKm5hbWU7CisJCQl1bnNpZ25lZCBpbnQgZmxhZ3M7CisJCX0gcGhhc2VzW10gPSB7
CisJCQl7ICIiLCAwIH0sCisJCQl7ICItcHVsc2UiLCBQVUxTRSB9LAorCQkJeyAiLWxhdGUiLCBM
QVRFIH0sCisJCQl7ICItbGF0ZS1wdWxzZSIsIFBVTFNFIHwgTEFURSB9LAorCQkJeyB9CisJCX07
CisJCWZvciAodHlwZW9mKCpwaGFzZXMpICpwID0gcGhhc2VzOyBwLT5uYW1lOyBwKyspCisJCQlp
Z3Rfc3VidGVzdF9mKCJmdWxsJXMiLCBwLT5uYW1lKQorCQkJCWZ1bGwoaTkxNSwgcC0+ZmxhZ3Mp
OworCX0KKworCWlndF9zdWJ0ZXN0KCJub3AiKQorCQlub3AoaTkxNSk7CisKKwlpZ3Rfc3VidGVz
dCgic2VtYXBob3JlIikKKwkJc2VtYXBob3JlKGk5MTUpOworCisJaWd0X3N1YnRlc3QoInNtb2tl
IikKKwkJc21va2V0ZXN0KGk5MTUsIDIwKTsKKworCWlndF9maXh0dXJlIHsKKwkJaWd0X3N0b3Bf
aGFuZ19kZXRlY3RvcigpOworCX0KK30KZGlmZiAtLWdpdCBhL3Rlc3RzL21lc29uLmJ1aWxkIGIv
dGVzdHMvbWVzb24uYnVpbGQKaW5kZXggN2UwMDg5ZTc0Li5lZWVhMzYxMWQgMTAwNjQ0Ci0tLSBh
L3Rlc3RzL21lc29uLmJ1aWxkCisrKyBiL3Rlc3RzL21lc29uLmJ1aWxkCkBAIC0yODgsNiArMjg4
LDEzIEBAIHRlc3RfZXhlY3V0YWJsZXMgKz0gZXhlY3V0YWJsZSgnZ2VtX2VpbycsCiAJICAgaW5z
dGFsbCA6IHRydWUpCiB0ZXN0X2xpc3QgKz0gJ2dlbV9laW8nCiAKK3Rlc3RfZXhlY3V0YWJsZXMg
Kz0gZXhlY3V0YWJsZSgnZ2VtX2V4ZWNfYmFsYW5jZXInLCAnaTkxNS9nZW1fZXhlY19iYWxhbmNl
ci5jJywKKwkgICBkZXBlbmRlbmNpZXMgOiB0ZXN0X2RlcHMgKyBbIGxpYl9pZ3RfcGVyZiBdLAor
CSAgIGluc3RhbGxfZGlyIDogbGliZXhlY2RpciwKKwkgICBpbnN0YWxsX3JwYXRoIDogbGliZXhl
Y2Rpcl9ycGF0aGRpciwKKwkgICBpbnN0YWxsIDogdHJ1ZSkKK3Rlc3RfcHJvZ3MgKz0gJ2dlbV9l
eGVjX2JhbGFuY2VyJworCiB0ZXN0X2V4ZWN1dGFibGVzICs9IGV4ZWN1dGFibGUoJ2dlbV9tb2Nz
X3NldHRpbmdzJywKIAkgICBqb2luX3BhdGhzKCdpOTE1JywgJ2dlbV9tb2NzX3NldHRpbmdzLmMn
KSwKIAkgICBkZXBlbmRlbmNpZXMgOiB0ZXN0X2RlcHMgKyBbIGxpYl9pZ3RfcGVyZiBdLAotLSAK
Mi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJ
bnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0
cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

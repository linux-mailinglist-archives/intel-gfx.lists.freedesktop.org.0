Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 3725237017
	for <lists+intel-gfx@lfdr.de>; Thu,  6 Jun 2019 11:37:16 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id A91428975F;
	Thu,  6 Jun 2019 09:37:14 +0000 (UTC)
X-Original-To: Intel-gfx@lists.freedesktop.org
Delivered-To: Intel-gfx@lists.freedesktop.org
Received: from mga07.intel.com (mga07.intel.com [134.134.136.100])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3434E8976D
 for <Intel-gfx@lists.freedesktop.org>; Thu,  6 Jun 2019 09:37:13 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga006.jf.intel.com ([10.7.209.51])
 by orsmga105.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 06 Jun 2019 02:37:13 -0700
X-ExtLoop1: 1
Received: from ssirotki-mobl3.ger.corp.intel.com (HELO localhost.localdomain)
 ([10.251.93.246])
 by orsmga006.jf.intel.com with ESMTP; 06 Jun 2019 02:37:11 -0700
From: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>
To: Intel-gfx@lists.freedesktop.org
Date: Thu,  6 Jun 2019 10:36:36 +0100
Message-Id: <20190606093639.9372-19-tvrtko.ursulin@linux.intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190606093639.9372-1-tvrtko.ursulin@linux.intel.com>
References: <20190606093639.9372-1-tvrtko.ursulin@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 18/21] drm/i915: Convert i915_gem_init_hw to
 uncore
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KCk1vcmUgcmVt
b3ZhbCBvZiBpbXBsaWNpdCBkZXZfcHJpdiBmcm9tIHVzaW5nIG9sZCBtbWlvIGFjY2Vzc29ycy4K
CkFjdHVhbGx5IHRoZSB0b3AgbGV2ZWwgZnVuY3Rpb24gcmVtYWlucyBidXQgaXMgc3BsaXQgaW50
byBhIHBhcnQgd2hpY2gKd3JpdGVzIHRvIGk5MTUgYW5kIHBhcnQgd2hpY2ggb3BlcmF0ZXMgb24g
dW5jb3JlIHRvIGluaXRpYWxpemUgdGhlCmhhcmR3YXJlLgoKR3VDIGFuZCBlbmdpbmVzIGFyZSB0
aGUgb25seSBvZGQgb25lcyBvdXQgcmVtYWluaW5nLgoKU2lnbmVkLW9mZi1ieTogVHZydGtvIFVy
c3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbS5jIHwgNjIgKysrKysrKysrKysrKysrKysrKy0tLS0tLS0tLS0tLS0tCiAxIGZp
bGUgY2hhbmdlZCwgMzYgaW5zZXJ0aW9ucygrKSwgMjYgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ2VtLmMKaW5kZXggMWM1ZTZjMWE1MzYwLi5kMmIxODVhYTQzMzggMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW0uYwpAQCAtMTI1OCwyOCArMTI1OCwyOSBAQCBzdGF0aWMgdm9pZCBpbml0X3Vu
dXNlZF9yaW5ncyhzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpCiAJfQogfQogCi1pbnQgaTkx
NV9nZW1faW5pdF9odyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMg
aW50IGluaXRfaHcoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQogeworCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gdW5jb3JlX3RvX2k5MTUodW5jb3JlKTsKIAlpbnQgcmV0Owog
Ci0JZGV2X3ByaXYtPmd0Lmxhc3RfaW5pdF90aW1lID0ga3RpbWVfZ2V0KCk7Ci0KIAkvKiBEb3Vi
bGUgbGF5ZXIgc2VjdXJpdHkgYmxhbmtldCwgc2VlIGk5MTVfZ2VtX2luaXQoKSAqLwotCWludGVs
X3VuY29yZV9mb3JjZXdha2VfZ2V0KCZkZXZfcHJpdi0+dW5jb3JlLCBGT1JDRVdBS0VfQUxMKTsK
KwlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX2dldCh1bmNvcmUsIEZPUkNFV0FLRV9BTEwpOwogCi0J
aWYgKEhBU19FRFJBTShkZXZfcHJpdikgJiYgSU5URUxfR0VOKGRldl9wcml2KSA8IDkpCi0JCUk5
MTVfV1JJVEUoSFNXX0lESUNSLCBJOTE1X1JFQUQoSFNXX0lESUNSKSB8IElESUhBU0hNU0soMHhm
KSk7CisJaWYgKEhBU19FRFJBTShpOTE1KSAmJiBJTlRFTF9HRU4oaTkxNSkgPCA5KQorCQlpbnRl
bF91bmNvcmVfcm13KHVuY29yZSwgSFNXX0lESUNSLCAwLCBJRElIQVNITVNLKDB4ZikpOwogCi0J
aWYgKElTX0hBU1dFTEwoZGV2X3ByaXYpKQotCQlJOTE1X1dSSVRFKE1JX1BSRURJQ0FURV9SRVNV
TFRfMiwgSVNfSFNXX0dUMyhkZXZfcHJpdikgPwotCQkJICAgTE9XRVJfU0xJQ0VfRU5BQkxFRCA6
IExPV0VSX1NMSUNFX0RJU0FCTEVEKTsKKwlpZiAoSVNfSEFTV0VMTChpOTE1KSkKKwkJaW50ZWxf
dW5jb3JlX3dyaXRlKHVuY29yZSwKKwkJCQkgICBNSV9QUkVESUNBVEVfUkVTVUxUXzIsCisJCQkJ
ICAgSVNfSFNXX0dUMyhpOTE1KSA/CisJCQkJICAgTE9XRVJfU0xJQ0VfRU5BQkxFRCA6IExPV0VS
X1NMSUNFX0RJU0FCTEVEKTsKIAogCS8qIEFwcGx5IHRoZSBHVCB3b3JrYXJvdW5kcy4uLiAqLwot
CWludGVsX2d0X2FwcGx5X3dvcmthcm91bmRzKCZkZXZfcHJpdi0+dW5jb3JlKTsKKwlpbnRlbF9n
dF9hcHBseV93b3JrYXJvdW5kcyh1bmNvcmUpOwogCS8qIC4uLmFuZCBkZXRlcm1pbmUgd2hldGhl
ciB0aGV5IGFyZSBzdGlja2luZy4gKi8KLQlpbnRlbF9ndF92ZXJpZnlfd29ya2Fyb3VuZHMoJmRl
dl9wcml2LT51bmNvcmUsICJpbml0Iik7CisJaW50ZWxfZ3RfdmVyaWZ5X3dvcmthcm91bmRzKHVu
Y29yZSwgImluaXQiKTsKIAotCWk5MTVfZ2VtX2luaXRfc3dpenpsaW5nKCZkZXZfcHJpdi0+dW5j
b3JlKTsKKwlpOTE1X2dlbV9pbml0X3N3aXp6bGluZyh1bmNvcmUpOwogCiAJLyoKIAkgKiBBdCBs
ZWFzdCA4MzAgY2FuIGxlYXZlIHNvbWUgb2YgdGhlIHVudXNlZCByaW5ncwpAQCAtMTI4Nyw1MSAr
MTI4OCw2MCBAQCBpbnQgaTkxNV9nZW1faW5pdF9odyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYpCiAJICogd2lsbCBwcmV2ZW50IGMzIGVudHJ5LiBNYWtlcyBzdXJlIGFsbCB1bnVz
ZWQgcmluZ3MKIAkgKiBhcmUgdG90YWxseSBpZGxlLgogCSAqLwotCWluaXRfdW51c2VkX3Jpbmdz
KCZkZXZfcHJpdi0+dW5jb3JlKTsKLQotCUJVR19PTighZGV2X3ByaXYtPmtlcm5lbF9jb250ZXh0
KTsKLQlyZXQgPSBpOTE1X3Rlcm1pbmFsbHlfd2VkZ2VkKGRldl9wcml2KTsKLQlpZiAocmV0KQot
CQlnb3RvIG91dDsKKwlpbml0X3VudXNlZF9yaW5ncyh1bmNvcmUpOwogCi0JcmV0ID0gaTkxNV9w
cGd0dF9pbml0X2h3KCZkZXZfcHJpdi0+dW5jb3JlKTsKKwlyZXQgPSBpOTE1X3BwZ3R0X2luaXRf
aHcodW5jb3JlKTsKIAlpZiAocmV0KSB7CiAJCURSTV9FUlJPUigiRW5hYmxpbmcgUFBHVFQgZmFp
bGVkICglZClcbiIsIHJldCk7CiAJCWdvdG8gb3V0OwogCX0KIAotCXJldCA9IGludGVsX3dvcGNt
X2luaXRfaHcoJmRldl9wcml2LT53b3BjbSk7CisJcmV0ID0gaW50ZWxfd29wY21faW5pdF9odygm
aTkxNS0+d29wY20pOwogCWlmIChyZXQpIHsKIAkJRFJNX0VSUk9SKCJFbmFibGluZyBXT1BDTSBm
YWlsZWQgKCVkKVxuIiwgcmV0KTsKIAkJZ290byBvdXQ7CiAJfQogCiAJLyogV2UgY2FuJ3QgZW5h
YmxlIGNvbnRleHRzIHVudGlsIGFsbCBmaXJtd2FyZSBpcyBsb2FkZWQgKi8KLQlyZXQgPSBpbnRl
bF91Y19pbml0X2h3KGRldl9wcml2KTsKKwlyZXQgPSBpbnRlbF91Y19pbml0X2h3KGk5MTUpOwog
CWlmIChyZXQpIHsKIAkJRFJNX0VSUk9SKCJFbmFibGluZyB1YyBmYWlsZWQgKCVkKVxuIiwgcmV0
KTsKIAkJZ290byBvdXQ7CiAJfQogCi0JaW50ZWxfbW9jc19pbml0X2wzY2NfdGFibGUoJmRldl9w
cml2LT51bmNvcmUpOworCWludGVsX21vY3NfaW5pdF9sM2NjX3RhYmxlKHVuY29yZSk7CiAKIAkv
KiBPbmx5IHdoZW4gdGhlIEhXIGlzIHJlLWluaXRpYWxpc2VkLCBjYW4gd2UgcmVwbGF5IHRoZSBy
ZXF1ZXN0cyAqLwotCXJldCA9IGludGVsX2VuZ2luZXNfcmVzdW1lKGRldl9wcml2KTsKKwlyZXQg
PSBpbnRlbF9lbmdpbmVzX3Jlc3VtZShpOTE1KTsKIAlpZiAocmV0KQogCQlnb3RvIGNsZWFudXBf
dWM7CiAKLQlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX3B1dCgmZGV2X3ByaXYtPnVuY29yZSwgRk9S
Q0VXQUtFX0FMTCk7CisJaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9wdXQodW5jb3JlLCBGT1JDRVdB
S0VfQUxMKTsKIAogCXJldHVybiAwOwogCiBjbGVhbnVwX3VjOgotCWludGVsX3VjX2ZpbmlfaHco
ZGV2X3ByaXYpOworCWludGVsX3VjX2ZpbmlfaHcoaTkxNSk7CiBvdXQ6Ci0JaW50ZWxfdW5jb3Jl
X2ZvcmNld2FrZV9wdXQoJmRldl9wcml2LT51bmNvcmUsIEZPUkNFV0FLRV9BTEwpOworCWludGVs
X3VuY29yZV9mb3JjZXdha2VfcHV0KHVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CiAKIAlyZXR1cm4g
cmV0OwogfQogCitpbnQgaTkxNV9nZW1faW5pdF9odyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
aTkxNSkKK3sKKwlpbnQgcmV0OworCisJaTkxNS0+Z3QubGFzdF9pbml0X3RpbWUgPSBrdGltZV9n
ZXQoKTsKKworCUJVR19PTighaTkxNS0+a2VybmVsX2NvbnRleHQpOworCXJldCA9IGk5MTVfdGVy
bWluYWxseV93ZWRnZWQoaTkxNSk7CisJaWYgKHJldCkKKwkJcmV0dXJuIHJldDsKKworCXJldHVy
biBpbml0X2h3KCZpOTE1LT51bmNvcmUpOworfQorCiBzdGF0aWMgaW50IF9faW50ZWxfZW5naW5l
c19yZWNvcmRfZGVmYXVsdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0Cklu
dGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

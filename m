Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id B4A32BDE01
	for <lists+intel-gfx@lfdr.de>; Wed, 25 Sep 2019 14:19:51 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 7424D89C94;
	Wed, 25 Sep 2019 12:19:49 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga06.intel.com (mga06.intel.com [134.134.136.31])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 567FA89C27
 for <intel-gfx@lists.freedesktop.org>; Wed, 25 Sep 2019 12:19:47 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga002.jf.intel.com ([10.7.209.21])
 by orsmga104.jf.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 25 Sep 2019 05:19:46 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,548,1559545200"; d="scan'208";a="201229187"
Received: from slisovsk-lenovo-ideapad-720s-13ikb.fi.intel.com ([10.237.72.89])
 by orsmga002.jf.intel.com with ESMTP; 25 Sep 2019 05:19:44 -0700
From: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 25 Sep 2019 15:17:37 +0300
Message-Id: <20190925121737.29670-1-stanislav.lisovskiy@intel.com>
X-Mailer: git-send-email 2.17.1
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v3] drm/i915: Restrict qgv points which don't
 have enough bandwidth.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: ville.syrjala@intel.com, martin.peres@intel.com
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWNjb3JkaW5nIHRvIEJTcGVjIDUzOTk4LCB3ZSBzaG91bGQgdHJ5IHRvCnJlc3RyaWN0IHFndiBw
b2ludHMsIHdoaWNoIGNhbid0IHByb3ZpZGUKZW5vdWdoIGJhbmR3aWR0aCBmb3IgZGVzaXJlZCBk
aXNwbGF5IGNvbmZpZ3VyYXRpb24uCgpDdXJyZW50bHkgd2UgYXJlIGp1c3QgY29tcGFyaW5nIGFn
YWluc3QgYWxsIG9mCnRob3NlIGFuZCB0YWtlIG1pbmltdW0od29yc3QgY2FzZSkuCgp2MjogRml4
ZWQgd3JvbmcgUENvZGUgcmVwbHkgbWFzaywgcmVtb3ZlZCBoYXJkY29kZWQKICAgIHZhbHVlcy4K
CnYzOiBGb3JiaWQgc2ltdWx0YW5lb3VzIGxlZ2FjeSBTQUdWIFBDb2RlIHJlcXVlc3RzIGFuZAog
ICAgcmVzdHJpY3RpbmcgcWd2IHBvaW50cy4gUHV0IHRoZSBhY3R1YWwgcmVzdHJpY3Rpb24KICAg
IHRvIGNvbW1pdCBmdW5jdGlvbiwgYWRkZWQgc2VyaWFsaXphdGlvbih0aGFua3MgdG8gVmlsbGUp
CiAgICB0byBwcmV2ZW50IGNvbW1pdCBiZWluZyBhcHBsaWVkIG91dCBvZiBvcmRlciBpbiBjYXNl
IG9mCiAgICBub25ibG9ja2luZyBhbmQvb3Igbm9tb2Rlc2V0IGNvbW1pdHMuCgpTaWduZWQtb2Zm
LWJ5OiBTdGFuaXNsYXYgTGlzb3Zza2l5IDxzdGFuaXNsYXYubGlzb3Zza2l5QGludGVsLmNvbT4K
Q2M6IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBpbnRlbC5jb20+CkNjOiBKYW1lcyBB
dXNtdXMgPGphbWVzLmF1c211c0BpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9hdG9taWMuYyAgIHwgMTYgKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9hdG9taWMuaCAgIHwgIDMgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9idy5jICAgICAgIHwgNzkgKysrKysrKysrKysrKy0tLS0tLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9idy5oICAgICAgIHwgIDIgKwogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgIHwgNzggKysrKysrKysrKysrKysrKyst
CiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggICAgfCAgMyArCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oICAgICAgICAgICAgICAgfCAgMiArCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oICAgICAgICAgICAgICAgfCAgMyArCiA4IGZpbGVz
IGNoYW5nZWQsIDE2MCBpbnNlcnRpb25zKCspLCAyNiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYwppbmRleCA2OTg4MDJkYTA3YjcuLjkw
MzUzN2M0ZmIwZiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9hdG9taWMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21p
Yy5jCkBAIC0yMDgsNiArMjA4LDIyIEBAIGludGVsX2NydGNfZHVwbGljYXRlX3N0YXRlKHN0cnVj
dCBkcm1fY3J0YyAqY3J0YykKIAlyZXR1cm4gJmNydGNfc3RhdGUtPmJhc2U7CiB9CiAKK2ludCBp
bnRlbF9hdG9taWNfc2VyaWFsaXplX2dsb2JhbF9zdGF0ZShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0
YXRlICpzdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19p
OTE1KHN0YXRlLT5iYXNlLmRldik7CisJc3RydWN0IGludGVsX2NydGMgKmNydGM7CisKKwlmb3Jf
ZWFjaF9pbnRlbF9jcnRjKCZkZXZfcHJpdi0+ZHJtLCBjcnRjKSB7CisJCXN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlOworCisJCWNydGNfc3RhdGUgPSBpbnRlbF9hdG9taWNfZ2V0
X2NydGNfc3RhdGUoJnN0YXRlLT5iYXNlLCBjcnRjKTsKKwkJaWYgKElTX0VSUihjcnRjX3N0YXRl
KSkKKwkJCXJldHVybiBQVFJfRVJSKGNydGNfc3RhdGUpOworCX0KKworCXJldHVybiAwOworfQor
CiAvKioKICAqIGludGVsX2NydGNfZGVzdHJveV9zdGF0ZSAtIGRlc3Ryb3kgY3J0YyBzdGF0ZQog
ICogQGNydGM6IGRybSBjcnRjCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2F0b21pYy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9h
dG9taWMuaAppbmRleCA1ODA2NWQzMTYxYTMuLmZkMTdiM2NhMjU3ZiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuaAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5oCkBAIC03LDYgKzcsNyBAQAogI2RlZmlu
ZSBfX0lOVEVMX0FUT01JQ19IX18KIAogI2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+CisjaW5jbHVk
ZSAiaW50ZWxfZGlzcGxheV90eXBlcy5oIgogCiBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZTsKIHN0
cnVjdCBkcm1fY29ubmVjdG9yOwpAQCAtMzgsNiArMzksOCBAQCB2b2lkIGludGVsX2NydGNfZGVz
dHJveV9zdGF0ZShzdHJ1Y3QgZHJtX2NydGMgKmNydGMsCiBzdHJ1Y3QgZHJtX2F0b21pY19zdGF0
ZSAqaW50ZWxfYXRvbWljX3N0YXRlX2FsbG9jKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpOwogdm9p
ZCBpbnRlbF9hdG9taWNfc3RhdGVfY2xlYXIoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRl
KTsKIAoraW50IGludGVsX2F0b21pY19zZXJpYWxpemVfZ2xvYmFsX3N0YXRlKHN0cnVjdCBpbnRl
bF9hdG9taWNfc3RhdGUgKnN0YXRlKTsKKwogc3RydWN0IGludGVsX2NydGNfc3RhdGUgKgogaW50
ZWxfYXRvbWljX2dldF9jcnRjX3N0YXRlKHN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSwK
IAkJCSAgICBzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0Yyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2J3LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2J3LmMKaW5kZXggY2Q1OGU0N2FiN2IyLi44MWUzNDY4MzA2ZmEgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYncuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2J3LmMKQEAgLTgsNiArOCw3IEBACiAjaW5jbHVk
ZSAiaW50ZWxfYncuaCIKICNpbmNsdWRlICJpbnRlbF9kaXNwbGF5X3R5cGVzLmgiCiAjaW5jbHVk
ZSAiaW50ZWxfc2lkZWJhbmQuaCIKKyNpbmNsdWRlICJpbnRlbF9hdG9taWMuaCIKIAogLyogUGFy
YW1ldGVycyBmb3IgUWNsayBHZXlzZXJ2aWxsZSAoUUdWKSAqLwogc3RydWN0IGludGVsX3Fndl9w
b2ludCB7CkBAIC05MCw2ICs5MSwyNyBAQCBzdGF0aWMgaW50IGljbF9wY29kZV9yZWFkX3Fndl9w
b2ludF9pbmZvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlyZXR1cm4gMDsK
IH0KIAoraW50IGljbF9wY29kZV9yZXN0cmljdF9xZ3ZfcG9pbnRzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKKwkJCQkgIHUzMiBwb2ludHNfbWFzaykKK3sKKwlpbnQgcmV0Owor
CisJLyogYnNwZWMgc2F5cyB0byBrZWVwIHJldHJ5aW5nIGZvciBhdCBsZWFzdCAxIG1zICovCisJ
cmV0ID0gc2tsX3Bjb2RlX3JlcXVlc3QoZGV2X3ByaXYsIElDTF9QQ09ERV9TQUdWX0RFX01FTV9T
U19DT05GSUcsCisJCQkJcG9pbnRzX21hc2ssCisJCQkJR0VOMTFfUENPREVfUE9JTlRTX1JFU1RS
SUNURURfTUFTSywKKwkJCQlHRU4xMV9QQ09ERV9QT0lOVFNfUkVTVFJJQ1RFRCwKKwkJCQkxKTsK
KworCWlmIChyZXQgPCAwKSB7CisJCURSTV9FUlJPUigiRmFpbGVkIHRvIGRpc2FibGUgcWd2IHBv
aW50cyAoJWQpXG4iLCByZXQpOworCQlyZXR1cm4gcmV0OworCX0KKworCXJldHVybiAwOworfQor
CisKIHN0YXRpYyBpbnQgaWNsX2dldF9xZ3ZfcG9pbnRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdiwKIAkJCSAgICAgIHN0cnVjdCBpbnRlbF9xZ3ZfaW5mbyAqcWkpCiB7CkBAIC0y
NDcsMjIgKzI2OSw2IEBAIHZvaWQgaW50ZWxfYndfaW5pdF9odyhzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYpCiAJCWljbF9nZXRfYndfaW5mbyhkZXZfcHJpdiwgJmljbF9zYV9pbmZv
KTsKIH0KIAotc3RhdGljIHVuc2lnbmVkIGludCBpbnRlbF9tYXhfZGF0YV9yYXRlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCQkJaW50IG51bV9wbGFuZXMpCi17Ci0JaWYg
KElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCi0JCS8qCi0JCSAqIEZJWE1FIHdpdGggU0FHViBk
aXNhYmxlZCBtYXliZSB3ZSBjYW4gYXNzdW1lCi0JCSAqIHBvaW50IDEgd2lsbCBhbHdheXMgYmUg
dXNlZD8gU2VlbXMgdG8gbWF0Y2gKLQkJICogdGhlIGJlaGF2aW91ciBvYnNlcnZlZCBpbiB0aGUg
d2lsZC4KLQkJICovCi0JCXJldHVybiBtaW4zKGljbF9tYXhfYncoZGV2X3ByaXYsIG51bV9wbGFu
ZXMsIDApLAotCQkJICAgIGljbF9tYXhfYncoZGV2X3ByaXYsIG51bV9wbGFuZXMsIDEpLAotCQkJ
ICAgIGljbF9tYXhfYncoZGV2X3ByaXYsIG51bV9wbGFuZXMsIDIpKTsKLQllbHNlCi0JCXJldHVy
biBVSU5UX01BWDsKLX0KLQogc3RhdGljIHVuc2lnbmVkIGludCBpbnRlbF9id19jcnRjX251bV9h
Y3RpdmVfcGxhbmVzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQog
ewogCS8qCkBAIC0zNTQsNyArMzYwLDkgQEAgaW50IGludGVsX2J3X2F0b21pY19jaGVjayhzdHJ1
Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAl1bnNpZ25lZCBpbnQgZGF0YV9yYXRlLCBt
YXhfZGF0YV9yYXRlOwogCXVuc2lnbmVkIGludCBudW1fYWN0aXZlX3BsYW5lczsKIAlzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YzsKLQlpbnQgaTsKKwlpbnQgaSwgcmV0OworCXN0cnVjdCBpbnRlbF9x
Z3ZfaW5mbyBxaSA9IHt9OworCXUzMiBhbGxvd2VkX3BvaW50cyA9IDA7CiAKIAkvKiBGSVhNRSBl
YXJsaWVyIGdlbnMgbmVlZCBzb21lIGNoZWNrcyB0b28gKi8KIAlpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA8IDExKQpAQCAtMzk4LDE2ICs0MDYsNDMgQEAgaW50IGludGVsX2J3X2F0b21pY19jaGVj
ayhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAlkYXRhX3JhdGUgPSBpbnRlbF9i
d19kYXRhX3JhdGUoZGV2X3ByaXYsIGJ3X3N0YXRlKTsKIAludW1fYWN0aXZlX3BsYW5lcyA9IGlu
dGVsX2J3X251bV9hY3RpdmVfcGxhbmVzKGRldl9wcml2LCBid19zdGF0ZSk7CiAKLQltYXhfZGF0
YV9yYXRlID0gaW50ZWxfbWF4X2RhdGFfcmF0ZShkZXZfcHJpdiwgbnVtX2FjdGl2ZV9wbGFuZXMp
OwotCiAJZGF0YV9yYXRlID0gRElWX1JPVU5EX1VQKGRhdGFfcmF0ZSwgMTAwMCk7CiAKLQlpZiAo
ZGF0YV9yYXRlID4gbWF4X2RhdGFfcmF0ZSkgewotCQlEUk1fREVCVUdfS01TKCJCYW5kd2lkdGgg
JXUgTUIvcyBleGNlZWRzIG1heCBhdmFpbGFibGUgJWQgTUIvcyAoJWQgYWN0aXZlIHBsYW5lcylc
biIsCi0JCQkgICAgICBkYXRhX3JhdGUsIG1heF9kYXRhX3JhdGUsIG51bV9hY3RpdmVfcGxhbmVz
KTsKKwlyZXQgPSBpY2xfZ2V0X3Fndl9wb2ludHMoZGV2X3ByaXYsICZxaSk7CisJaWYgKHJldCA8
IDApCisJCXJldHVybiAwOworCisJZm9yIChpID0gMDsgaSA8IHFpLm51bV9wb2ludHM7IGkrKykg
eworCQltYXhfZGF0YV9yYXRlID0gaWNsX21heF9idyhkZXZfcHJpdiwgbnVtX2FjdGl2ZV9wbGFu
ZXMsIGkpOworCQlpZiAobWF4X2RhdGFfcmF0ZSA8IGRhdGFfcmF0ZSkKKwkJCURSTV9ERUJVR19L
TVMoIlFHViBwb2ludCAlZDogbWF4IGJ3ICVkIHJlcXVpcmVkICVkXG4iLAorCQkJCSAgICAgIGks
IG1heF9kYXRhX3JhdGUsIGRhdGFfcmF0ZSk7CisJCWVsc2UgeworCQkJRFJNX0RFQlVHX0tNUygi
UUdWIHBvaW50ICVkOiBtYXggYncgJWQgcmVxdWlyZWQgJWRcbiIsCisJCQkJICAgICAgaSwgbWF4
X2RhdGFfcmF0ZSwgZGF0YV9yYXRlKTsKKwkJCWFsbG93ZWRfcG9pbnRzIHw9IDEgPDwgaTsKKwkJ
fQorCX0KKworCWlmIChhbGxvd2VkX3BvaW50cyA9PSAwKSB7CisJCURSTV9ERUJVR19LTVMoIkNv
dWxkIG5vdCBmaW5kIGFueSBzdWl0YWJsZSBRR1YgcG9pbnRzXG4iKTsKIAkJcmV0dXJuIC1FSU5W
QUw7CiAJfQogCisJc3RhdGUtPnFndl9wb2ludHNfbWFzayA9ICh+YWxsb3dlZF9wb2ludHMpICYg
KCgxIDw8IHFpLm51bV9wb2ludHMpIC0gMSk7CisKKwkvKgorCSAqIElmIHRoZSBhY3R1YWwgbWFz
ayBoYWQgY2hhbmdlZCB3ZSBuZWVkIHRvIG1ha2Ugc3VyZSB0aGF0CisJICogdGhlIGNvbW1pdHMg
YXJlIHNlcmlhbGl6ZWQoaW4gY2FzZSB0aGlzIGlzIGEgbm9tb2Rlc2V0LCBub25ibG9ja2luZykK
KwkgKi8KKwlpZiAoc3RhdGUtPnFndl9wb2ludHNfbWFzayAhPSBkZXZfcHJpdi0+cWd2X3BvaW50
c19tYXNrKSB7CisJCXJldCA9IGludGVsX2F0b21pY19zZXJpYWxpemVfZ2xvYmFsX3N0YXRlKHN0
YXRlKTsKKwkJaWYgKHJldCkgeworCQkJRFJNX0RFQlVHX0tNUygiQ291bGQgbm90IHNlcmlhbGl6
ZSBnbG9iYWwgc3RhdGVcbiIpOworCQkJcmV0dXJuIHJldDsKKwkJfQorCX0KKwogCXJldHVybiAw
OwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2J3
LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2J3LmgKaW5kZXggOWRiMTBh
ZjAxMmY0Li42NmJmOWJjMTBiNzMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfYncuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVs
X2J3LmgKQEAgLTI4LDUgKzI4LDcgQEAgaW50IGludGVsX2J3X2luaXQoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmRldl9wcml2KTsKIGludCBpbnRlbF9id19hdG9taWNfY2hlY2soc3RydWN0IGlu
dGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpOwogdm9pZCBpbnRlbF9id19jcnRjX3VwZGF0ZShzdHJ1
Y3QgaW50ZWxfYndfc3RhdGUgKmJ3X3N0YXRlLAogCQkJICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0
Y19zdGF0ZSAqY3J0Y19zdGF0ZSk7CitpbnQgaWNsX3Bjb2RlX3Jlc3RyaWN0X3Fndl9wb2ludHMo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorCQkJCSAgdTMyIHBvaW50c19tYXNr
KTsKIAogI2VuZGlmIC8qIF9fSU5URUxfQldfSF9fICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCmluZGV4IDVlY2Y1NDI3MDE4MS4uYzMxOTZkMGU0YmUz
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXku
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAt
MTM5NjAsNiArMTM5NjAsNjggQEAgc3RhdGljIHZvaWQgaW50ZWxfYXRvbWljX2NsZWFudXBfd29y
ayhzdHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiAJaW50ZWxfYXRvbWljX2hlbHBlcl9mcmVlX3N0
YXRlKGk5MTUpOwogfQogCitzdGF0aWMgdm9pZCBpbnRlbF9xZ3ZfcG9pbnRfcHJlX3VwZGF0ZShz
dHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2ID0gc3RhdGUtPmJhc2UuZGV2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoZGV2KTsKKwlpbnQgaSwgcmV0OworCisJLyoKKwkgKiBSZXN0cmljdCByZXF1
aXJlZCBxZ3YgcG9pbnRzIGJlZm9yZSB1cGRhdGluZyB0aGUgY29uZmlndXJhdGlvbi4KKwkgKiBB
Y2NvcmRpbmcgdG8gQlBzZWMgd2UgY2FuJ3QgbWFzayBhbmQgdW5tYXNrIHFndiBwb2ludHMgYXQg
dGhlIHNhbWUKKwkgKiB0aW1lLiBBbHNvIG1hc2tpbmcgc2hvdWxkIGJlIGRvbmUgYmVmb3JlIHVw
ZGF0aW5nIHRoZSBjb25maWd1cmF0aW9uCisJICogYW5kIHVubWFza2luZyBhZnRlcndhcmRzLgor
CSAqLworCXUzMiBuZXdfcWd2X3BvaW50c19tYXNrID0gZGV2X3ByaXYtPnFndl9wb2ludHNfbWFz
azsKKwlpbnQgbnVtX3BvaW50cyA9IGRldl9wcml2LT5tYXhfYndbMF0ubnVtX3Fndl9wb2ludHM7
CisKKwlmb3IgKGkgPSBudW1fcG9pbnRzOyBpID4gMDsgaS0tKSB7CisJCWludCBuZXdfbWFza19i
aXQgPSBzdGF0ZS0+cWd2X3BvaW50c19tYXNrICYgKDEgPDwgbnVtX3BvaW50cyk7CisJCWludCBv
bGRfbWFza19iaXQgPSBuZXdfcWd2X3BvaW50c19tYXNrICYgKDEgPDwgbnVtX3BvaW50cyk7CisK
KwkJaWYgKG9sZF9tYXNrX2JpdCAhPSBuZXdfbWFza19iaXQpCisJCQlpZiAobmV3X21hc2tfYml0
ICE9IDApCisJCQkJbmV3X3Fndl9wb2ludHNfbWFzayB8PSBuZXdfbWFza19iaXQ7CisJfQorCisJ
cmV0ID0gaWNsX3Bjb2RlX3Jlc3RyaWN0X3Fndl9wb2ludHMoZGV2X3ByaXYsIG5ld19xZ3ZfcG9p
bnRzX21hc2spOworCWlmIChyZXQgPCAwKQorCQlEUk1fREVCVUdfS01TKCJDb3VsZCBub3QgcmVz
dHJpY3QgcmVxdWlyZWQgZ3F2IHBvaW50cyglZClcbiIsIHJldCk7CisJZWxzZQorCQlkZXZfcHJp
di0+cWd2X3BvaW50c19tYXNrID0gbmV3X3Fndl9wb2ludHNfbWFzazsKK30KKworc3RhdGljIHZv
aWQgaW50ZWxfcWd2X3BvaW50X3Bvc3RfdXBkYXRlKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUg
KnN0YXRlKQoreworCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBzdGF0ZS0+YmFzZS5kZXY7CisJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCWludCBp
LCByZXQ7CisKKwkvKgorCSAqIFJlc3RyaWN0IHJlcXVpcmVkIHFndiBwb2ludHMgYmVmb3JlIHVw
ZGF0aW5nIHRoZSBjb25maWd1cmF0aW9uLgorCSAqIEFjY29yZGluZyB0byBCUHNlYyB3ZSBjYW4n
dCBtYXNrIGFuZCB1bm1hc2sgcWd2IHBvaW50cyBhdCB0aGUgc2FtZQorCSAqIHRpbWUuIEFsc28g
bWFza2luZyBzaG91bGQgYmUgZG9uZSBiZWZvcmUgdXBkYXRpbmcgdGhlIGNvbmZpZ3VyYXRpb24K
KwkgKiBhbmQgdW5tYXNraW5nIGFmdGVyd2FyZHMuCisJICovCisJdTMyIG5ld19xZ3ZfcG9pbnRz
X21hc2sgPSBkZXZfcHJpdi0+cWd2X3BvaW50c19tYXNrOworCWludCBudW1fcG9pbnRzID0gZGV2
X3ByaXYtPm1heF9id1swXS5udW1fcWd2X3BvaW50czsKKworCWZvciAoaSA9IG51bV9wb2ludHM7
IGkgPiAwOyBpLS0pIHsKKwkJaW50IG5ld19tYXNrX2JpdCA9IHN0YXRlLT5xZ3ZfcG9pbnRzX21h
c2sgJiAoMSA8PCBudW1fcG9pbnRzKTsKKwkJaW50IG9sZF9tYXNrX2JpdCA9IG5ld19xZ3ZfcG9p
bnRzX21hc2sgJiAoMSA8PCBudW1fcG9pbnRzKTsKKworCQlpZiAob2xkX21hc2tfYml0ICE9IG5l
d19tYXNrX2JpdCkKKwkJCWlmIChuZXdfbWFza19iaXQgPT0gMCkKKwkJCQluZXdfcWd2X3BvaW50
c19tYXNrICY9IH5vbGRfbWFza19iaXQ7CisJfQorCisJcmV0ID0gaWNsX3Bjb2RlX3Jlc3RyaWN0
X3Fndl9wb2ludHMoZGV2X3ByaXYsIG5ld19xZ3ZfcG9pbnRzX21hc2spOworCWlmIChyZXQgPCAw
KQorCQlEUk1fREVCVUdfS01TKCJDb3VsZCBub3QgcmVzdHJpY3QgcmVxdWlyZWQgZ3F2IHBvaW50
cyglZClcbiIsIHJldCk7CisJZWxzZQorCQlkZXZfcHJpdi0+cWd2X3BvaW50c19tYXNrID0gbmV3
X3Fndl9wb2ludHNfbWFzazsKK30KKwogc3RhdGljIHZvaWQgaW50ZWxfYXRvbWljX2NvbW1pdF90
YWlsKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogewogCXN0cnVjdCBkcm1fZGV2
aWNlICpkZXYgPSBzdGF0ZS0+YmFzZS5kZXY7CkBAIC0xMzk4Nyw2ICsxNDA0OSw5IEBAIHN0YXRp
YyB2b2lkIGludGVsX2F0b21pY19jb21taXRfdGFpbChzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
ICpzdGF0ZSkKIAkJfQogCX0KIAorCWlmICgoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMSkpCisJ
CWludGVsX3Fndl9wb2ludF9wcmVfdXBkYXRlKHN0YXRlKTsKKwogCWludGVsX2NvbW1pdF9tb2Rl
c2V0X2Rpc2FibGVzKHN0YXRlKTsKIAogCS8qIEZJWE1FOiBFdmVudHVhbGx5IGdldCByaWQgb2Yg
b3VyIGNydGMtPmNvbmZpZyBwb2ludGVyICovCkBAIC0xNDAwNSw4ICsxNDA3MCw5IEBAIHN0YXRp
YyB2b2lkIGludGVsX2F0b21pY19jb21taXRfdGFpbChzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRl
ICpzdGF0ZSkKIAkJICogU0tMIHdvcmthcm91bmQ6IGJzcGVjIHJlY29tbWVuZHMgd2UgZGlzYWJs
ZSB0aGUgU0FHViB3aGVuIHdlCiAJCSAqIGhhdmUgbW9yZSB0aGVuIG9uZSBwaXBlIGVuYWJsZWQK
IAkJICovCi0JCWlmICghaW50ZWxfY2FuX2VuYWJsZV9zYWd2KHN0YXRlKSkKLQkJCWludGVsX2Rp
c2FibGVfc2FndihkZXZfcHJpdik7CisJCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTEpCisJ
CQlpZiAoIWludGVsX2Nhbl9lbmFibGVfc2FndihzdGF0ZSkpCisJCQkJaW50ZWxfZGlzYWJsZV9z
YWd2KGRldl9wcml2KTsKIAogCQlpbnRlbF9tb2Rlc2V0X3ZlcmlmeV9kaXNhYmxlZChkZXZfcHJp
diwgc3RhdGUpOwogCX0KQEAgLTE0MDg0LDggKzE0MTUwLDEyIEBAIHN0YXRpYyB2b2lkIGludGVs
X2F0b21pY19jb21taXRfdGFpbChzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKIAlp
ZiAoc3RhdGUtPm1vZGVzZXQpCiAJCWludGVsX3ZlcmlmeV9wbGFuZXMoc3RhdGUpOwogCi0JaWYg
KHN0YXRlLT5tb2Rlc2V0ICYmIGludGVsX2Nhbl9lbmFibGVfc2FndihzdGF0ZSkpCi0JCWludGVs
X2VuYWJsZV9zYWd2KGRldl9wcml2KTsKKwlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8IDExKQor
CQlpZiAoc3RhdGUtPm1vZGVzZXQgJiYgaW50ZWxfY2FuX2VuYWJsZV9zYWd2KHN0YXRlKSkKKwkJ
CWludGVsX2VuYWJsZV9zYWd2KGRldl9wcml2KTsKKworCWlmICgoSU5URUxfR0VOKGRldl9wcml2
KSA+PSAxMSkgJiYgaW50ZWxfY2FuX2VuYWJsZV9zYWd2KHN0YXRlKSkKKwkJaW50ZWxfcWd2X3Bv
aW50X3Bvc3RfdXBkYXRlKHN0YXRlKTsKIAogCWRybV9hdG9taWNfaGVscGVyX2NvbW1pdF9od19k
b25lKCZzdGF0ZS0+YmFzZSk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKaW5kZXggNmIwYTY0NmYwMTcwLi44MmY4ZGY2NTM0N2Ug
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90
eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90
eXBlcy5oCkBAIC01MTIsNiArNTEyLDkgQEAgc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSB7CiAJ
c3RydWN0IGk5MTVfc3dfZmVuY2UgY29tbWl0X3JlYWR5OwogCiAJc3RydWN0IGxsaXN0X25vZGUg
ZnJlZWQ7CisKKwkvKiBHZW4xMSsgb25seSAqLworCXUzMiBxZ3ZfcG9pbnRzX21hc2s7CiB9Owog
CiBzdHJ1Y3QgaW50ZWxfcGxhbmVfc3RhdGUgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKaW5kZXgg
ZmNmNzQyMzA3NWVmLi4zODNkZTc3YTdiNzMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaApAQCAt
MTY1Miw2ICsxNjUyLDggQEAgc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgewogCQl1OCBudW1fcGxh
bmVzOwogCX0gbWF4X2J3WzZdOwogCisJdTMyIHFndl9wb2ludHNfbWFzazsKKwogCXN0cnVjdCBk
cm1fcHJpdmF0ZV9vYmogYndfb2JqOwogCiAJc3RydWN0IGludGVsX3J1bnRpbWVfcG0gcnVudGlt
ZV9wbTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmggYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oCmluZGV4IGU3NTJkZTk0NzBiZC4uYzc4ZWUxODBj
MWFhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlZy5oCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVnLmgKQEAgLTg4NTQsNiArODg1NCw3IEBAIGVudW0g
ewogI2RlZmluZSAgIElDTF9QQ09ERV9NRU1fU1VCU1lTWVNURU1fSU5GTwkweGQKICNkZWZpbmUg
ICAgIElDTF9QQ09ERV9NRU1fU1NfUkVBRF9HTE9CQUxfSU5GTwkoMHgwIDw8IDgpCiAjZGVmaW5l
ICAgICBJQ0xfUENPREVfTUVNX1NTX1JFQURfUUdWX1BPSU5UX0lORk8ocG9pbnQpCSgoKHBvaW50
KSA8PCAxNikgfCAoMHgxIDw8IDgpKQorI2RlZmluZSAgIElDTF9QQ09ERV9TQUdWX0RFX01FTV9T
U19DT05GSUcJMHhlCiAjZGVmaW5lICAgR0VONl9QQ09ERV9SRUFEX0RfQ09NUAkJMHgxMAogI2Rl
ZmluZSAgIEdFTjZfUENPREVfV1JJVEVfRF9DT01QCQkweDExCiAjZGVmaW5lICAgSFNXX1BDT0RF
X0RFX1dSSVRFX0ZSRVFfUkVRCQkweDE3CkBAIC04ODY1LDYgKzg4NjYsOCBAQCBlbnVtIHsKICNk
ZWZpbmUgICAgIEdFTjlfU0FHVl9ESVNBQkxFCQkJMHgwCiAjZGVmaW5lICAgICBHRU45X1NBR1Zf
SVNfRElTQUJMRUQJCTB4MQogI2RlZmluZSAgICAgR0VOOV9TQUdWX0VOQUJMRQkJCTB4MworI2Rl
ZmluZSBHRU4xMV9QQ09ERV9QT0lOVFNfUkVTVFJJQ1RFRAkJMHgwCisjZGVmaW5lIEdFTjExX1BD
T0RFX1BPSU5UU19SRVNUUklDVEVEX01BU0sJMHgxCiAjZGVmaW5lIEdFTjZfUENPREVfREFUQQkJ
CQlfTU1JTygweDEzODEyOCkKICNkZWZpbmUgICBHRU42X1BDT0RFX0ZSRVFfSUFfUkFUSU9fU0hJ
RlQJOAogI2RlZmluZSAgIEdFTjZfUENPREVfRlJFUV9SSU5HX1JBVElPX1NISUZUCTE2Ci0tIAoy
LjE3LjEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCklu
dGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRw
czovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

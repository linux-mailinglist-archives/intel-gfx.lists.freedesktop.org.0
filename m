Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 691BA6680D
	for <lists+intel-gfx@lfdr.de>; Fri, 12 Jul 2019 09:58:26 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C9FC56E2EA;
	Fri, 12 Jul 2019 07:58:24 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3AE676E2EA
 for <intel-gfx@lists.freedesktop.org>; Fri, 12 Jul 2019 07:58:23 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17241047-1500050 
 for <intel-gfx@lists.freedesktop.org>; Fri, 12 Jul 2019 08:58:19 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 12 Jul 2019 08:58:18 +0100
Message-Id: <20190712075818.20616-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.22.0
MIME-Version: 1.0
Subject: [Intel-gfx] [CI] drm/i915/gtt: Use shallow dma pages for scratch
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2Ugb25seSB1c2UgdGhlIGRtYSBwYWdlcyBmb3Igc2NyYXRjaCwgYW5kIHNvIGRvIG5vdCBuZWVk
IHRvIGFsbG9jYXRlCnRoZSBleHRyYSBzdG9yYWdlIGZvciB0aGUgc2hhZG93IHBhZ2UgZGlyZWN0
b3J5LgoKdjI6IFJlZnJhaW4gZnJvbSByZWludHJvZHVjaW5nIEk5MTVfUERFUwoKU2lnbmVkLW9m
Zi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBNaWthIEt1
b3BwYWxhIDxtaWthLmt1b3BwYWxhQGxpbnV4LmludGVsLmNvbT4KUmV2aWV3ZWQtYnk6IE1pa2Eg
S3VvcHBhbGEgPG1pa2Eua3VvcHBhbGFAbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jIHwgMTk2ICsrKysrKysrKysrKy0tLS0tLS0tLS0tLS0t
LS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oIHwgIDIzICsrKy0KIDIgZmls
ZXMgY2hhbmdlZCwgMTAwIGluc2VydGlvbnMoKyksIDExOSBkZWxldGlvbnMoLSkKCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtX2d0dC5jCmluZGV4IDIzNmM5NjRkZDc2MS4uMWU2MDIxZTc1OTkzIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwpAQCAtNTk0LDI2ICs1OTQsMTcgQEAgc3Rh
dGljIHZvaWQgY2xlYW51cF9wYWdlX2RtYShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwK
IAogI2RlZmluZSBrbWFwX2F0b21pY19weChweCkga21hcF9hdG9taWMocHhfYmFzZShweCktPnBh
Z2UpCiAKLSNkZWZpbmUgZmlsbF9weCh2bSwgcHgsIHYpIGZpbGxfcGFnZV9kbWEoKHZtKSwgcHhf
YmFzZShweCksICh2KSkKLSNkZWZpbmUgZmlsbDMyX3B4KHZtLCBweCwgdikgZmlsbF9wYWdlX2Rt
YV8zMigodm0pLCBweF9iYXNlKHB4KSwgKHYpKQotCi1zdGF0aWMgdm9pZCBmaWxsX3BhZ2VfZG1h
KHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAotCQkJICBzdHJ1Y3QgaTkxNV9wYWdlX2Rt
YSAqcCwKLQkJCSAgY29uc3QgdTY0IHZhbCkKK3N0YXRpYyB2b2lkCitmaWxsX3BhZ2VfZG1hKGNv
bnN0IHN0cnVjdCBpOTE1X3BhZ2VfZG1hICpwLCBjb25zdCB1NjQgdmFsLCB1bnNpZ25lZCBpbnQg
Y291bnQpCiB7Ci0JdTY0ICogY29uc3QgdmFkZHIgPSBrbWFwX2F0b21pYyhwLT5wYWdlKTsKLQot
CW1lbXNldDY0KHZhZGRyLCB2YWwsIFBBR0VfU0laRSAvIHNpemVvZih2YWwpKTsKLQotCWt1bm1h
cF9hdG9taWModmFkZHIpOworCWt1bm1hcF9hdG9taWMobWVtc2V0NjQoa21hcF9hdG9taWMocC0+
cGFnZSksIHZhbCwgY291bnQpKTsKIH0KIAotc3RhdGljIHZvaWQgZmlsbF9wYWdlX2RtYV8zMihz
dHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKLQkJCSAgICAgc3RydWN0IGk5MTVfcGFnZV9k
bWEgKnAsCi0JCQkgICAgIGNvbnN0IHUzMiB2KQotewotCWZpbGxfcGFnZV9kbWEodm0sIHAsICh1
NjQpdiA8PCAzMiB8IHYpOwotfQorI2RlZmluZSBmaWxsX3B4KHB4LCB2KSBmaWxsX3BhZ2VfZG1h
KHB4X2Jhc2UocHgpLCAodiksIFBBR0VfU0laRSAvIHNpemVvZih1NjQpKQorI2RlZmluZSBmaWxs
MzJfcHgocHgsIHYpIGRvIHsJCQkJCQlcCisJdTY0IHZfXyA9IGxvd2VyXzMyX2JpdHModik7CQkJ
CQlcCisJZmlsbF9weCgocHgpLCB2X18gPDwgMzIgfCB2X18pOwkJCQkJXAorfSB3aGlsZSAoMCkK
IAogc3RhdGljIGludAogc2V0dXBfc2NyYXRjaF9wYWdlKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3Bh
Y2UgKnZtLCBnZnBfdCBnZnApCkBAIC02ODcsNiArNjc4LDIxIEBAIHN0YXRpYyB2b2lkIGNsZWFu
dXBfc2NyYXRjaF9wYWdlKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogCV9fZnJlZV9w
YWdlcyhwLT5wYWdlLCBvcmRlcik7CiB9CiAKK3N0YXRpYyB2b2lkIGZyZWVfc2NyYXRjaChzdHJ1
Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKK3sKKwlpZiAoIXZtLT5zY3JhdGNoX3BhZ2UuZGFk
ZHIpIC8qIHNldCB0byAwIG9uIGNsb25lcyAqLworCQlyZXR1cm47CisKKwlpZiAodm0tPnNjcmF0
Y2hfcGRwLmRhZGRyKQorCQljbGVhbnVwX3BhZ2VfZG1hKHZtLCAmdm0tPnNjcmF0Y2hfcGRwKTsK
KwlpZiAodm0tPnNjcmF0Y2hfcGQuZGFkZHIpCisJCWNsZWFudXBfcGFnZV9kbWEodm0sICZ2bS0+
c2NyYXRjaF9wZCk7CisJaWYgKHZtLT5zY3JhdGNoX3B0LmRhZGRyKQorCQljbGVhbnVwX3BhZ2Vf
ZG1hKHZtLCAmdm0tPnNjcmF0Y2hfcHQpOworCisJY2xlYW51cF9zY3JhdGNoX3BhZ2Uodm0pOwor
fQorCiBzdGF0aWMgc3RydWN0IGk5MTVfcGFnZV90YWJsZSAqYWxsb2NfcHQoc3RydWN0IGk5MTVf
YWRkcmVzc19zcGFjZSAqdm0pCiB7CiAJc3RydWN0IGk5MTVfcGFnZV90YWJsZSAqcHQ7CkBAIC03
MTEsMTggKzcxNyw2IEBAIHN0YXRpYyB2b2lkIGZyZWVfcHQoc3RydWN0IGk5MTVfYWRkcmVzc19z
cGFjZSAqdm0sIHN0cnVjdCBpOTE1X3BhZ2VfdGFibGUgKnB0KQogCWtmcmVlKHB0KTsKIH0KIAot
c3RhdGljIHZvaWQgZ2VuOF9pbml0aWFsaXplX3B0KHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ug
KnZtLAotCQkJICAgICAgIHN0cnVjdCBpOTE1X3BhZ2VfdGFibGUgKnB0KQotewotCWZpbGxfcHgo
dm0sIHB0LCB2bS0+c2NyYXRjaF9wdGUpOwotfQotCi1zdGF0aWMgdm9pZCBnZW42X2luaXRpYWxp
emVfcHQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCi0JCQkgICAgICAgc3RydWN0IGk5
MTVfcGFnZV90YWJsZSAqcHQpCi17Ci0JZmlsbDMyX3B4KHZtLCBwdCwgdm0tPnNjcmF0Y2hfcHRl
KTsKLX0KLQogc3RhdGljIHN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICpfX2FsbG9jX3BkKHZv
aWQpCiB7CiAJc3RydWN0IGk5MTVfcGFnZV9kaXJlY3RvcnkgKnBkOwpAQCAtNzY1LDkgKzc1OSwx
MSBAQCBzdGF0aWMgdm9pZCBmcmVlX3BkKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAog
CWtmcmVlKHBkKTsKIH0KIAotI2RlZmluZSBpbml0X3BkKHZtLCBwZCwgdG8pIHsJCQkJCVwKLQlm
aWxsX3B4KCh2bSksIChwZCksIGdlbjhfcGRlX2VuY29kZShweF9kbWEodG8pLCBJOTE1X0NBQ0hF
X0xMQykpOyBcCi0JbWVtc2V0X3AoKHBkKS0+ZW50cnksICh0byksIDUxMik7CQkJCVwKK3N0YXRp
YyB2b2lkIGluaXRfcGQoc3RydWN0IGk5MTVfcGFnZV9kaXJlY3RvcnkgKnBkLAorCQkgICAgc3Ry
dWN0IGk5MTVfcGFnZV9kbWEgKnNjcmF0Y2gpCit7CisJZmlsbF9weChwZCwgZ2VuOF9wZGVfZW5j
b2RlKHNjcmF0Y2gtPmRhZGRyLCBJOTE1X0NBQ0hFX0xMQykpOworCW1lbXNldF9wKHBkLT5lbnRy
eSwgc2NyYXRjaCwgNTEyKTsKIH0KIAogc3RhdGljIGlubGluZSB2b2lkCkBAIC04NjksMTIgKzg2
NSwxMSBAQCBzdGF0aWMgdm9pZCBnZW44X3BwZ3R0X2NsZWFyX3BkKHN0cnVjdCBpOTE1X2FkZHJl
c3Nfc3BhY2UgKnZtLAogCXUzMiBwZGU7CiAKIAlnZW44X2Zvcl9lYWNoX3BkZShwdCwgcGQsIHN0
YXJ0LCBsZW5ndGgsIHBkZSkgewotCQlHRU1fQlVHX09OKHB0ID09IHZtLT5zY3JhdGNoX3B0KTsK
KwkJR0VNX0JVR19PTihweF9iYXNlKHB0KSA9PSAmdm0tPnNjcmF0Y2hfcHQpOwogCiAJCWF0b21p
Y19pbmMoJnB0LT51c2VkKTsKIAkJZ2VuOF9wcGd0dF9jbGVhcl9wdCh2bSwgcHQsIHN0YXJ0LCBs
ZW5ndGgpOwotCQlpZiAocmVsZWFzZV9wZF9lbnRyeShwZCwgcGRlLCAmcHQtPnVzZWQsCi0JCQkJ
ICAgICBweF9iYXNlKHZtLT5zY3JhdGNoX3B0KSkpCisJCWlmIChyZWxlYXNlX3BkX2VudHJ5KHBk
LCBwZGUsICZwdC0+dXNlZCwgJnZtLT5zY3JhdGNoX3B0KSkKIAkJCWZyZWVfcHQodm0sIHB0KTsK
IAl9CiB9CkBAIC04OTAsMTIgKzg4NSwxMSBAQCBzdGF0aWMgdm9pZCBnZW44X3BwZ3R0X2NsZWFy
X3BkcChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAl1bnNpZ25lZCBpbnQgcGRwZTsK
IAogCWdlbjhfZm9yX2VhY2hfcGRwZShwZCwgcGRwLCBzdGFydCwgbGVuZ3RoLCBwZHBlKSB7Ci0J
CUdFTV9CVUdfT04ocGQgPT0gdm0tPnNjcmF0Y2hfcGQpOworCQlHRU1fQlVHX09OKHB4X2Jhc2Uo
cGQpID09ICZ2bS0+c2NyYXRjaF9wZCk7CiAKIAkJYXRvbWljX2luYygmcGQtPnVzZWQpOwogCQln
ZW44X3BwZ3R0X2NsZWFyX3BkKHZtLCBwZCwgc3RhcnQsIGxlbmd0aCk7Ci0JCWlmIChyZWxlYXNl
X3BkX2VudHJ5KHBkcCwgcGRwZSwgJnBkLT51c2VkLAotCQkJCSAgICAgcHhfYmFzZSh2bS0+c2Ny
YXRjaF9wZCkpKQorCQlpZiAocmVsZWFzZV9wZF9lbnRyeShwZHAsIHBkcGUsICZwZC0+dXNlZCwg
JnZtLT5zY3JhdGNoX3BkKSkKIAkJCWZyZWVfcGQodm0sIHBkKTsKIAl9CiB9CkBAIC05MjEsMTIg
KzkxNSwxMSBAQCBzdGF0aWMgdm9pZCBnZW44X3BwZ3R0X2NsZWFyXzRsdmwoc3RydWN0IGk5MTVf
YWRkcmVzc19zcGFjZSAqdm0sCiAJR0VNX0JVR19PTighaTkxNV92bV9pc180bHZsKHZtKSk7CiAK
IAlnZW44X2Zvcl9lYWNoX3BtbDRlKHBkcCwgcG1sNCwgc3RhcnQsIGxlbmd0aCwgcG1sNGUpIHsK
LQkJR0VNX0JVR19PTihwZHAgPT0gdm0tPnNjcmF0Y2hfcGRwKTsKKwkJR0VNX0JVR19PTihweF9i
YXNlKHBkcCkgPT0gJnZtLT5zY3JhdGNoX3BkcCk7CiAKIAkJYXRvbWljX2luYygmcGRwLT51c2Vk
KTsKIAkJZ2VuOF9wcGd0dF9jbGVhcl9wZHAodm0sIHBkcCwgc3RhcnQsIGxlbmd0aCk7Ci0JCWlm
IChyZWxlYXNlX3BkX2VudHJ5KHBtbDQsIHBtbDRlLCAmcGRwLT51c2VkLAotCQkJCSAgICAgcHhf
YmFzZSh2bS0+c2NyYXRjaF9wZHApKSkKKwkJaWYgKHJlbGVhc2VfcGRfZW50cnkocG1sNCwgcG1s
NGUsICZwZHAtPnVzZWQsICZ2bS0+c2NyYXRjaF9wZHApKQogCQkJZnJlZV9wZCh2bSwgcGRwKTsK
IAl9CiB9CkBAIC0xMTgxLDcgKzExNzQsNyBAQCBzdGF0aWMgdm9pZCBnZW44X2ZyZWVfcGFnZV90
YWJsZXMoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJaW50IGk7CiAKIAlmb3IgKGkg
PSAwOyBpIDwgSTkxNV9QREVTOyBpKyspIHsKLQkJaWYgKHBkLT5lbnRyeVtpXSAhPSB2bS0+c2Ny
YXRjaF9wdCkKKwkJaWYgKHBkLT5lbnRyeVtpXSAhPSAmdm0tPnNjcmF0Y2hfcHQpCiAJCQlmcmVl
X3B0KHZtLCBwZC0+ZW50cnlbaV0pOwogCX0KIH0KQEAgLTEyMTgsMzcgKzEyMTEsMzQgQEAgc3Rh
dGljIGludCBnZW44X2luaXRfc2NyYXRjaChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkK
IAkJCQlJOTE1X0NBQ0hFX0xMQywKIAkJCQl2bS0+aGFzX3JlYWRfb25seSk7CiAKLQl2bS0+c2Ny
YXRjaF9wdCA9IGFsbG9jX3B0KHZtKTsKLQlpZiAoSVNfRVJSKHZtLT5zY3JhdGNoX3B0KSkgewot
CQlyZXQgPSBQVFJfRVJSKHZtLT5zY3JhdGNoX3B0KTsKKwlpZiAodW5saWtlbHkoc2V0dXBfcGFn
ZV9kbWEodm0sICZ2bS0+c2NyYXRjaF9wdCkpKSB7CisJCXJldCA9IC1FTk9NRU07CiAJCWdvdG8g
ZnJlZV9zY3JhdGNoX3BhZ2U7CiAJfQorCWZpbGxfcHgoJnZtLT5zY3JhdGNoX3B0LCB2bS0+c2Ny
YXRjaF9wdGUpOwogCi0Jdm0tPnNjcmF0Y2hfcGQgPSBhbGxvY19wZCh2bSk7Ci0JaWYgKElTX0VS
Uih2bS0+c2NyYXRjaF9wZCkpIHsKLQkJcmV0ID0gUFRSX0VSUih2bS0+c2NyYXRjaF9wZCk7CisJ
aWYgKHVubGlrZWx5KHNldHVwX3BhZ2VfZG1hKHZtLCAmdm0tPnNjcmF0Y2hfcGQpKSkgeworCQly
ZXQgPSAtRU5PTUVNOwogCQlnb3RvIGZyZWVfcHQ7CiAJfQorCWZpbGxfcHgoJnZtLT5zY3JhdGNo
X3BkLAorCQlnZW44X3BkZV9lbmNvZGUodm0tPnNjcmF0Y2hfcHQuZGFkZHIsIEk5MTVfQ0FDSEVf
TExDKSk7CiAKIAlpZiAoaTkxNV92bV9pc180bHZsKHZtKSkgewotCQl2bS0+c2NyYXRjaF9wZHAg
PSBhbGxvY19wZCh2bSk7Ci0JCWlmIChJU19FUlIodm0tPnNjcmF0Y2hfcGRwKSkgewotCQkJcmV0
ID0gUFRSX0VSUih2bS0+c2NyYXRjaF9wZHApOworCQlpZiAodW5saWtlbHkoc2V0dXBfcGFnZV9k
bWEodm0sICZ2bS0+c2NyYXRjaF9wZHApKSkgeworCQkJcmV0ID0gLUVOT01FTTsKIAkJCWdvdG8g
ZnJlZV9wZDsKIAkJfQorCQlmaWxsX3B4KCZ2bS0+c2NyYXRjaF9wZHAsCisJCQlnZW44X3BkZV9l
bmNvZGUodm0tPnNjcmF0Y2hfcGQuZGFkZHIsIEk5MTVfQ0FDSEVfTExDKSk7CiAJfQogCi0JZ2Vu
OF9pbml0aWFsaXplX3B0KHZtLCB2bS0+c2NyYXRjaF9wdCk7Ci0JaW5pdF9wZCh2bSwgdm0tPnNj
cmF0Y2hfcGQsIHZtLT5zY3JhdGNoX3B0KTsKLQlpZiAoaTkxNV92bV9pc180bHZsKHZtKSkKLQkJ
aW5pdF9wZCh2bSwgdm0tPnNjcmF0Y2hfcGRwLCB2bS0+c2NyYXRjaF9wZCk7Ci0KIAlyZXR1cm4g
MDsKIAogZnJlZV9wZDoKLQlmcmVlX3BkKHZtLCB2bS0+c2NyYXRjaF9wZCk7CisJY2xlYW51cF9w
YWdlX2RtYSh2bSwgJnZtLT5zY3JhdGNoX3BkKTsKIGZyZWVfcHQ6Ci0JZnJlZV9wdCh2bSwgdm0t
PnNjcmF0Y2hfcHQpOworCWNsZWFudXBfcGFnZV9kbWEodm0sICZ2bS0+c2NyYXRjaF9wdCk7CiBm
cmVlX3NjcmF0Y2hfcGFnZToKIAljbGVhbnVwX3NjcmF0Y2hfcGFnZSh2bSk7CiAKQEAgLTEyOTIs
MTggKzEyODIsNiBAQCBzdGF0aWMgaW50IGdlbjhfcHBndHRfbm90aWZ5X3ZndChzdHJ1Y3QgaTkx
NV9wcGd0dCAqcHBndHQsIGJvb2wgY3JlYXRlKQogCXJldHVybiAwOwogfQogCi1zdGF0aWMgdm9p
ZCBnZW44X2ZyZWVfc2NyYXRjaChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKLXsKLQlp
ZiAoIXZtLT5zY3JhdGNoX3BhZ2UuZGFkZHIpCi0JCXJldHVybjsKLQotCWlmIChpOTE1X3ZtX2lz
XzRsdmwodm0pKQotCQlmcmVlX3BkKHZtLCB2bS0+c2NyYXRjaF9wZHApOwotCWZyZWVfcGQodm0s
IHZtLT5zY3JhdGNoX3BkKTsKLQlmcmVlX3B0KHZtLCB2bS0+c2NyYXRjaF9wdCk7Ci0JY2xlYW51
cF9zY3JhdGNoX3BhZ2Uodm0pOwotfQotCiBzdGF0aWMgdm9pZCBnZW44X3BwZ3R0X2NsZWFudXBf
M2x2bChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAkJCQkgICAgc3RydWN0IGk5MTVf
cGFnZV9kaXJlY3RvcnkgKnBkcCkKIHsKQEAgLTEzMTEsNyArMTI4OSw3IEBAIHN0YXRpYyB2b2lk
IGdlbjhfcHBndHRfY2xlYW51cF8zbHZsKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAog
CWludCBpOwogCiAJZm9yIChpID0gMDsgaSA8IHBkcGVzOyBpKyspIHsKLQkJaWYgKHBkcC0+ZW50
cnlbaV0gPT0gdm0tPnNjcmF0Y2hfcGQpCisJCWlmIChwZHAtPmVudHJ5W2ldID09ICZ2bS0+c2Ny
YXRjaF9wZCkKIAkJCWNvbnRpbnVlOwogCiAJCWdlbjhfZnJlZV9wYWdlX3RhYmxlcyh2bSwgcGRw
LT5lbnRyeVtpXSk7CkBAIC0xMzI5LDcgKzEzMDcsNyBAQCBzdGF0aWMgdm9pZCBnZW44X3BwZ3R0
X2NsZWFudXBfNGx2bChzdHJ1Y3QgaTkxNV9wcGd0dCAqcHBndHQpCiAJZm9yIChpID0gMDsgaSA8
IEdFTjhfUE1MNEVTX1BFUl9QTUw0OyBpKyspIHsKIAkJc3RydWN0IGk5MTVfcGFnZV9kaXJlY3Rv
cnkgKnBkcCA9IGk5MTVfcGRwX2VudHJ5KHBtbDQsIGkpOwogCi0JCWlmIChwZHAgPT0gcHBndHQt
PnZtLnNjcmF0Y2hfcGRwKQorCQlpZiAocHhfYmFzZShwZHApID09ICZwcGd0dC0+dm0uc2NyYXRj
aF9wZHApCiAJCQljb250aW51ZTsKIAogCQlnZW44X3BwZ3R0X2NsZWFudXBfM2x2bCgmcHBndHQt
PnZtLCBwZHApOwpAQCAtMTM1MSw3ICsxMzI5LDcgQEAgc3RhdGljIHZvaWQgZ2VuOF9wcGd0dF9j
bGVhbnVwKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogCWVsc2UKIAkJZ2VuOF9wcGd0
dF9jbGVhbnVwXzNsdmwoJnBwZ3R0LT52bSwgcHBndHQtPnBkKTsKIAotCWdlbjhfZnJlZV9zY3Jh
dGNoKHZtKTsKKwlmcmVlX3NjcmF0Y2godm0pOwogfQogCiBzdGF0aWMgaW50IGdlbjhfcHBndHRf
YWxsb2NfcGQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCkBAIC0xMzY3LDcgKzEzNDUs
NyBAQCBzdGF0aWMgaW50IGdlbjhfcHBndHRfYWxsb2NfcGQoc3RydWN0IGk5MTVfYWRkcmVzc19z
cGFjZSAqdm0sCiAJZ2VuOF9mb3JfZWFjaF9wZGUocHQsIHBkLCBzdGFydCwgbGVuZ3RoLCBwZGUp
IHsKIAkJY29uc3QgaW50IGNvdW50ID0gZ2VuOF9wdGVfY291bnQoc3RhcnQsIGxlbmd0aCk7CiAK
LQkJaWYgKHB0ID09IHZtLT5zY3JhdGNoX3B0KSB7CisJCWlmIChweF9iYXNlKHB0KSA9PSAmdm0t
PnNjcmF0Y2hfcHQpIHsKIAkJCXNwaW5fdW5sb2NrKCZwZC0+bG9jayk7CiAKIAkJCXB0ID0gZmV0
Y2hfYW5kX3plcm8oJmFsbG9jKTsKQEAgLTEzNzksMTAgKzEzNTcsMTAgQEAgc3RhdGljIGludCBn
ZW44X3BwZ3R0X2FsbG9jX3BkKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCQkJfQog
CiAJCQlpZiAoY291bnQgPCBHRU44X1BURVMgfHwgaW50ZWxfdmdwdV9hY3RpdmUodm0tPmk5MTUp
KQotCQkJCWdlbjhfaW5pdGlhbGl6ZV9wdCh2bSwgcHQpOworCQkJCWZpbGxfcHgocHQsIHZtLT5z
Y3JhdGNoX3B0ZSk7CiAKIAkJCXNwaW5fbG9jaygmcGQtPmxvY2spOwotCQkJaWYgKHBkLT5lbnRy
eVtwZGVdID09IHZtLT5zY3JhdGNoX3B0KSB7CisJCQlpZiAocGQtPmVudHJ5W3BkZV0gPT0gJnZt
LT5zY3JhdGNoX3B0KSB7CiAJCQkJc2V0X3BkX2VudHJ5KHBkLCBwZGUsIHB0KTsKIAkJCX0gZWxz
ZSB7CiAJCQkJYWxsb2MgPSBwdDsKQEAgLTE0MTQsNyArMTM5Miw3IEBAIHN0YXRpYyBpbnQgZ2Vu
OF9wcGd0dF9hbGxvY19wZHAoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAKIAlzcGlu
X2xvY2soJnBkcC0+bG9jayk7CiAJZ2VuOF9mb3JfZWFjaF9wZHBlKHBkLCBwZHAsIHN0YXJ0LCBs
ZW5ndGgsIHBkcGUpIHsKLQkJaWYgKHBkID09IHZtLT5zY3JhdGNoX3BkKSB7CisJCWlmIChweF9i
YXNlKHBkKSA9PSAmdm0tPnNjcmF0Y2hfcGQpIHsKIAkJCXNwaW5fdW5sb2NrKCZwZHAtPmxvY2sp
OwogCiAJCQlwZCA9IGZldGNoX2FuZF96ZXJvKCZhbGxvYyk7CkBAIC0xNDI1LDEwICsxNDAzLDEw
IEBAIHN0YXRpYyBpbnQgZ2VuOF9wcGd0dF9hbGxvY19wZHAoc3RydWN0IGk5MTVfYWRkcmVzc19z
cGFjZSAqdm0sCiAJCQkJZ290byB1bndpbmQ7CiAJCQl9CiAKLQkJCWluaXRfcGQodm0sIHBkLCB2
bS0+c2NyYXRjaF9wdCk7CisJCQlpbml0X3BkKHBkLCAmdm0tPnNjcmF0Y2hfcHQpOwogCiAJCQlz
cGluX2xvY2soJnBkcC0+bG9jayk7Ci0JCQlpZiAocGRwLT5lbnRyeVtwZHBlXSA9PSB2bS0+c2Ny
YXRjaF9wZCkgeworCQkJaWYgKHBkcC0+ZW50cnlbcGRwZV0gPT0gJnZtLT5zY3JhdGNoX3BkKSB7
CiAJCQkJc2V0X3BkX2VudHJ5KHBkcCwgcGRwZSwgcGQpOwogCQkJfSBlbHNlIHsKIAkJCQlhbGxv
YyA9IHBkOwpAQCAtMTQ0OSw3ICsxNDI3LDcgQEAgc3RhdGljIGludCBnZW44X3BwZ3R0X2FsbG9j
X3BkcChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAlnb3RvIG91dDsKIAogdW53aW5k
X3BkOgotCWlmIChyZWxlYXNlX3BkX2VudHJ5KHBkcCwgcGRwZSwgJnBkLT51c2VkLCBweF9iYXNl
KHZtLT5zY3JhdGNoX3BkKSkpCisJaWYgKHJlbGVhc2VfcGRfZW50cnkocGRwLCBwZHBlLCAmcGQt
PnVzZWQsICZ2bS0+c2NyYXRjaF9wZCkpCiAJCWZyZWVfcGQodm0sIHBkKTsKIHVud2luZDoKIAln
ZW44X3BwZ3R0X2NsZWFyX3BkcCh2bSwgcGRwLCBmcm9tLCBzdGFydCAtIGZyb20pOwpAQCAtMTQ3
OCw3ICsxNDU2LDcgQEAgc3RhdGljIGludCBnZW44X3BwZ3R0X2FsbG9jXzRsdmwoc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAKIAlzcGluX2xvY2soJnBtbDQtPmxvY2spOwogCWdlbjhf
Zm9yX2VhY2hfcG1sNGUocGRwLCBwbWw0LCBzdGFydCwgbGVuZ3RoLCBwbWw0ZSkgewotCQlpZiAo
cGRwID09IHZtLT5zY3JhdGNoX3BkcCkgeworCQlpZiAocHhfYmFzZShwZHApID09ICZ2bS0+c2Ny
YXRjaF9wZHApIHsKIAkJCXNwaW5fdW5sb2NrKCZwbWw0LT5sb2NrKTsKIAogCQkJcGRwID0gZmV0
Y2hfYW5kX3plcm8oJmFsbG9jKTsKQEAgLTE0ODksMTAgKzE0NjcsMTAgQEAgc3RhdGljIGludCBn
ZW44X3BwZ3R0X2FsbG9jXzRsdmwoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJCQkJ
Z290byB1bndpbmQ7CiAJCQl9CiAKLQkJCWluaXRfcGQodm0sIHBkcCwgdm0tPnNjcmF0Y2hfcGQp
OworCQkJaW5pdF9wZChwZHAsICZ2bS0+c2NyYXRjaF9wZCk7CiAKIAkJCXNwaW5fbG9jaygmcG1s
NC0+bG9jayk7Ci0JCQlpZiAocG1sNC0+ZW50cnlbcG1sNGVdID09IHZtLT5zY3JhdGNoX3BkcCkg
eworCQkJaWYgKHBtbDQtPmVudHJ5W3BtbDRlXSA9PSAmdm0tPnNjcmF0Y2hfcGRwKSB7CiAJCQkJ
c2V0X3BkX2VudHJ5KHBtbDQsIHBtbDRlLCBwZHApOwogCQkJfSBlbHNlIHsKIAkJCQlhbGxvYyA9
IHBkcDsKQEAgLTE1MTMsNyArMTQ5MSw3IEBAIHN0YXRpYyBpbnQgZ2VuOF9wcGd0dF9hbGxvY180
bHZsKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCWdvdG8gb3V0OwogCiB1bndpbmRf
cGRwOgotCWlmIChyZWxlYXNlX3BkX2VudHJ5KHBtbDQsIHBtbDRlLCAmcGRwLT51c2VkLCBweF9i
YXNlKHZtLT5zY3JhdGNoX3BkcCkpKQorCWlmIChyZWxlYXNlX3BkX2VudHJ5KHBtbDQsIHBtbDRl
LCAmcGRwLT51c2VkLCAmdm0tPnNjcmF0Y2hfcGRwKSkKIAkJZnJlZV9wZCh2bSwgcGRwKTsKIHVu
d2luZDoKIAlnZW44X3BwZ3R0X2NsZWFyXzRsdmwodm0sIGZyb20sIHN0YXJ0IC0gZnJvbSk7CkBA
IC0xNTM3LDcgKzE1MTUsNyBAQCBzdGF0aWMgaW50IGdlbjhfcHJlYWxsb2NhdGVfdG9wX2xldmVs
X3BkcChzdHJ1Y3QgaTkxNV9wcGd0dCAqcHBndHQpCiAJCWlmIChJU19FUlIocGQpKQogCQkJZ290
byB1bndpbmQ7CiAKLQkJaW5pdF9wZCh2bSwgcGQsIHZtLT5zY3JhdGNoX3B0KTsKKwkJaW5pdF9w
ZChwZCwgJnZtLT5zY3JhdGNoX3B0KTsKIAkJc2V0X3BkX2VudHJ5KHBkcCwgcGRwZSwgcGQpOwog
CX0KIApAQCAtMTU2OCwxMCArMTU0NiwxMCBAQCBzdGF0aWMgdm9pZCBwcGd0dF9pbml0KHN0cnVj
dCBpOTE1X3BwZ3R0ICpwcGd0dCwgc3RydWN0IGludGVsX2d0ICpndCkKIAogc3RhdGljIHZvaWQg
aW5pdF9wZF9uKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCQkgICAgICBzdHJ1Y3Qg
aTkxNV9wYWdlX2RpcmVjdG9yeSAqcGQsCi0JCSAgICAgIHN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0
b3J5ICp0bywKKwkJICAgICAgc3RydWN0IGk5MTVfcGFnZV9kbWEgKnRvLAogCQkgICAgICBjb25z
dCB1bnNpZ25lZCBpbnQgZW50cmllcykKIHsKLQljb25zdCB1NjQgZGFkZHIgPSBnZW44X3BkZV9l
bmNvZGUocHhfZG1hKHRvKSwgSTkxNV9DQUNIRV9MTEMpOworCWNvbnN0IHU2NCBkYWRkciA9IGdl
bjhfcGRlX2VuY29kZSh0by0+ZGFkZHIsIEk5MTVfQ0FDSEVfTExDKTsKIAl1NjQgKiBjb25zdCB2
YWRkciA9IGttYXBfYXRvbWljKHBkLT5iYXNlLnBhZ2UpOwogCiAJbWVtc2V0NjQodmFkZHIsIGRh
ZGRyLCBlbnRyaWVzKTsKQEAgLTE1ODgsNyArMTU2Niw3IEBAIGdlbjhfYWxsb2NfdG9wX3BkKHN0
cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogCWlmIChpOTE1X3ZtX2lzXzRsdmwodm0pKSB7
CiAJCXBkID0gYWxsb2NfcGQodm0pOwogCQlpZiAoIUlTX0VSUihwZCkpCi0JCQlpbml0X3BkKHZt
LCBwZCwgdm0tPnNjcmF0Y2hfcGRwKTsKKwkJCWluaXRfcGQocGQsICZ2bS0+c2NyYXRjaF9wZHAp
OwogCiAJCXJldHVybiBwZDsKIAl9CkBAIC0xNjA1LDcgKzE1ODMsNyBAQCBnZW44X2FsbG9jX3Rv
cF9wZChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIAkJcmV0dXJuIEVSUl9QVFIoLUVO
T01FTSk7CiAJfQogCi0JaW5pdF9wZF9uKHZtLCBwZCwgdm0tPnNjcmF0Y2hfcGQsIEdFTjhfM0xW
TF9QRFBFUyk7CisJaW5pdF9wZF9uKHZtLCBwZCwgJnZtLT5zY3JhdGNoX3BkLCBHRU44XzNMVkxf
UERQRVMpOwogCiAJcmV0dXJuIHBkOwogfQpAQCAtMTY3OCw3ICsxNjU2LDcgQEAgc3RhdGljIHN0
cnVjdCBpOTE1X3BwZ3R0ICpnZW44X3BwZ3R0X2NyZWF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKIGVycl9mcmVlX3BkOgogCWZyZWVfcGQoJnBwZ3R0LT52bSwgcHBndHQtPnBkKTsK
IGVycl9mcmVlX3NjcmF0Y2g6Ci0JZ2VuOF9mcmVlX3NjcmF0Y2goJnBwZ3R0LT52bSk7CisJZnJl
ZV9zY3JhdGNoKCZwcGd0dC0+dm0pOwogZXJyX2ZyZWU6CiAJa2ZyZWUocHBndHQpOwogCXJldHVy
biBFUlJfUFRSKGVycik7CkBAIC0xNzYzLDcgKzE3NDEsNyBAQCBzdGF0aWMgdm9pZCBnZW42X3Bw
Z3R0X2NsZWFyX3JhbmdlKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCQljb25zdCB1
bnNpZ25lZCBpbnQgY291bnQgPSBtaW4obnVtX2VudHJpZXMsIEdFTjZfUFRFUyAtIHB0ZSk7CiAJ
CWdlbjZfcHRlX3QgKnZhZGRyOwogCi0JCUdFTV9CVUdfT04ocHQgPT0gdm0tPnNjcmF0Y2hfcHQp
OworCQlHRU1fQlVHX09OKHB4X2Jhc2UocHQpID09ICZ2bS0+c2NyYXRjaF9wdCk7CiAKIAkJbnVt
X2VudHJpZXMgLT0gY291bnQ7CiAKQEAgLTE4MDAsNyArMTc3OCw3IEBAIHN0YXRpYyB2b2lkIGdl
bjZfcHBndHRfaW5zZXJ0X2VudHJpZXMoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJ
c3RydWN0IHNndF9kbWEgaXRlciA9IHNndF9kbWEodm1hKTsKIAlnZW42X3B0ZV90ICp2YWRkcjsK
IAotCUdFTV9CVUdfT04oaTkxNV9wdF9lbnRyeShwZCwgYWN0X3B0KSA9PSB2bS0+c2NyYXRjaF9w
dCk7CisJR0VNX0JVR19PTihwZC0+ZW50cnlbYWN0X3B0XSA9PSAmdm0tPnNjcmF0Y2hfcHQpOwog
CiAJdmFkZHIgPSBrbWFwX2F0b21pY19weChpOTE1X3B0X2VudHJ5KHBkLCBhY3RfcHQpKTsKIAlk
byB7CkBAIC0xODQ1LDcgKzE4MjMsNyBAQCBzdGF0aWMgaW50IGdlbjZfYWxsb2NfdmFfcmFuZ2Uo
c3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJZ2VuNl9mb3JfZWFjaF9wZGUocHQsIHBk
LCBzdGFydCwgbGVuZ3RoLCBwZGUpIHsKIAkJY29uc3QgdW5zaWduZWQgaW50IGNvdW50ID0gZ2Vu
Nl9wdGVfY291bnQoc3RhcnQsIGxlbmd0aCk7CiAKLQkJaWYgKHB0ID09IHZtLT5zY3JhdGNoX3B0
KSB7CisJCWlmIChweF9iYXNlKHB0KSA9PSAmdm0tPnNjcmF0Y2hfcHQpIHsKIAkJCXNwaW5fdW5s
b2NrKCZwZC0+bG9jayk7CiAKIAkJCXB0ID0gZmV0Y2hfYW5kX3plcm8oJmFsbG9jKTsKQEAgLTE4
NTYsMTAgKzE4MzQsMTAgQEAgc3RhdGljIGludCBnZW42X2FsbG9jX3ZhX3JhbmdlKHN0cnVjdCBp
OTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCQkJCWdvdG8gdW53aW5kX291dDsKIAkJCX0KIAotCQkJ
Z2VuNl9pbml0aWFsaXplX3B0KHZtLCBwdCk7CisJCQlmaWxsMzJfcHgocHQsIHZtLT5zY3JhdGNo
X3B0ZSk7CiAKIAkJCXNwaW5fbG9jaygmcGQtPmxvY2spOwotCQkJaWYgKHBkLT5lbnRyeVtwZGVd
ID09IHZtLT5zY3JhdGNoX3B0KSB7CisJCQlpZiAocGQtPmVudHJ5W3BkZV0gPT0gJnZtLT5zY3Jh
dGNoX3B0KSB7CiAJCQkJcGQtPmVudHJ5W3BkZV0gPSBwdDsKIAkJCQlpZiAoaTkxNV92bWFfaXNf
Ym91bmQocHBndHQtPnZtYSwKIAkJCQkJCSAgICAgIEk5MTVfVk1BX0dMT0JBTF9CSU5EKSkgewpA
QCAtMTkwOCwyNiArMTg4NiwxOCBAQCBzdGF0aWMgaW50IGdlbjZfcHBndHRfaW5pdF9zY3JhdGNo
KHN0cnVjdCBnZW42X3BwZ3R0ICpwcGd0dCkKIAkJCQkJIEk5MTVfQ0FDSEVfTk9ORSwKIAkJCQkJ
IFBURV9SRUFEX09OTFkpOwogCi0Jdm0tPnNjcmF0Y2hfcHQgPSBhbGxvY19wdCh2bSk7Ci0JaWYg
KElTX0VSUih2bS0+c2NyYXRjaF9wdCkpIHsKKwlpZiAodW5saWtlbHkoc2V0dXBfcGFnZV9kbWEo
dm0sICZ2bS0+c2NyYXRjaF9wdCkpKSB7CiAJCWNsZWFudXBfc2NyYXRjaF9wYWdlKHZtKTsKLQkJ
cmV0dXJuIFBUUl9FUlIodm0tPnNjcmF0Y2hfcHQpOworCQlyZXR1cm4gLUVOT01FTTsKIAl9Ci0K
LQlnZW42X2luaXRpYWxpemVfcHQodm0sIHZtLT5zY3JhdGNoX3B0KTsKKwlmaWxsMzJfcHgoJnZt
LT5zY3JhdGNoX3B0LCB2bS0+c2NyYXRjaF9wdGUpOwogCiAJZ2VuNl9mb3JfYWxsX3BkZXModW51
c2VkLCBwZCwgcGRlKQotCQlwZC0+ZW50cnlbcGRlXSA9IHZtLT5zY3JhdGNoX3B0OworCQlwZC0+
ZW50cnlbcGRlXSA9ICZ2bS0+c2NyYXRjaF9wdDsKIAogCXJldHVybiAwOwogfQogCi1zdGF0aWMg
dm9pZCBnZW42X3BwZ3R0X2ZyZWVfc2NyYXRjaChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2
bSkKLXsKLQlmcmVlX3B0KHZtLCB2bS0+c2NyYXRjaF9wdCk7Ci0JY2xlYW51cF9zY3JhdGNoX3Bh
Z2Uodm0pOwotfQotCiBzdGF0aWMgdm9pZCBnZW42X3BwZ3R0X2ZyZWVfcGQoc3RydWN0IGdlbjZf
cHBndHQgKnBwZ3R0KQogewogCXN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICogY29uc3QgcGQg
PSBwcGd0dC0+YmFzZS5wZDsKQEAgLTE5MzUsNyArMTkwNSw3IEBAIHN0YXRpYyB2b2lkIGdlbjZf
cHBndHRfZnJlZV9wZChzdHJ1Y3QgZ2VuNl9wcGd0dCAqcHBndHQpCiAJdTMyIHBkZTsKIAogCWdl
bjZfZm9yX2FsbF9wZGVzKHB0LCBwZCwgcGRlKQotCQlpZiAocHQgIT0gcHBndHQtPmJhc2Uudm0u
c2NyYXRjaF9wdCkKKwkJaWYgKHB4X2Jhc2UocHQpICE9ICZwcGd0dC0+YmFzZS52bS5zY3JhdGNo
X3B0KQogCQkJZnJlZV9wdCgmcHBndHQtPmJhc2Uudm0sIHB0KTsKIH0KIApAQCAtMTk1MCw3ICsx
OTIwLDcgQEAgc3RhdGljIHZvaWQgZ2VuNl9wcGd0dF9jbGVhbnVwKHN0cnVjdCBpOTE1X2FkZHJl
c3Nfc3BhY2UgKnZtKQogCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAK
IAlnZW42X3BwZ3R0X2ZyZWVfcGQocHBndHQpOwotCWdlbjZfcHBndHRfZnJlZV9zY3JhdGNoKHZt
KTsKKwlmcmVlX3NjcmF0Y2godm0pOwogCWtmcmVlKHBwZ3R0LT5iYXNlLnBkKTsKIH0KIApAQCAt
MTk5Myw3ICsxOTYzLDcgQEAgc3RhdGljIHZvaWQgcGRfdm1hX3VuYmluZChzdHJ1Y3QgaTkxNV92
bWEgKnZtYSkKIHsKIAlzdHJ1Y3QgZ2VuNl9wcGd0dCAqcHBndHQgPSB2bWEtPnByaXZhdGU7CiAJ
c3RydWN0IGk5MTVfcGFnZV9kaXJlY3RvcnkgKiBjb25zdCBwZCA9IHBwZ3R0LT5iYXNlLnBkOwot
CXN0cnVjdCBpOTE1X3BhZ2VfdGFibGUgKiBjb25zdCBzY3JhdGNoX3B0ID0gcHBndHQtPmJhc2Uu
dm0uc2NyYXRjaF9wdDsKKwlzdHJ1Y3QgaTkxNV9wYWdlX2RtYSAqIGNvbnN0IHNjcmF0Y2ggPSAm
cHBndHQtPmJhc2Uudm0uc2NyYXRjaF9wdDsKIAlzdHJ1Y3QgaTkxNV9wYWdlX3RhYmxlICpwdDsK
IAl1bnNpZ25lZCBpbnQgcGRlOwogCkBAIC0yMDAyLDExICsxOTcyLDExIEBAIHN0YXRpYyB2b2lk
IHBkX3ZtYV91bmJpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAKIAkvKiBGcmVlIGFsbCBubyBs
b25nZXIgdXNlZCBwYWdlIHRhYmxlcyAqLwogCWdlbjZfZm9yX2FsbF9wZGVzKHB0LCBwcGd0dC0+
YmFzZS5wZCwgcGRlKSB7Ci0JCWlmIChhdG9taWNfcmVhZCgmcHQtPnVzZWQpIHx8IHB0ID09IHNj
cmF0Y2hfcHQpCisJCWlmIChweF9iYXNlKHB0KSA9PSBzY3JhdGNoIHx8IGF0b21pY19yZWFkKCZw
dC0+dXNlZCkpCiAJCQljb250aW51ZTsKIAogCQlmcmVlX3B0KCZwcGd0dC0+YmFzZS52bSwgcHQp
OwotCQlwZC0+ZW50cnlbcGRlXSA9IHNjcmF0Y2hfcHQ7CisJCXBkLT5lbnRyeVtwZGVdID0gc2Ny
YXRjaDsKIAl9CiAKIAlwcGd0dC0+c2Nhbl9mb3JfdW51c2VkX3B0ID0gZmFsc2U7CkBAIC0yMTQ4
LDcgKzIxMTgsNyBAQCBzdGF0aWMgc3RydWN0IGk5MTVfcHBndHQgKmdlbjZfcHBndHRfY3JlYXRl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCXJldHVybiAmcHBndHQtPmJhc2U7CiAK
IGVycl9zY3JhdGNoOgotCWdlbjZfcHBndHRfZnJlZV9zY3JhdGNoKCZwcGd0dC0+YmFzZS52bSk7
CisJZnJlZV9zY3JhdGNoKCZwcGd0dC0+YmFzZS52bSk7CiBlcnJfcGQ6CiAJa2ZyZWUocHBndHQt
PmJhc2UucGQpOwogZXJyX2ZyZWU6CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9ndHQuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oCmluZGV4
IDU3YTY4ZWY0ZWRhNy4uOTFkOGI0YzIwYzYxIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbV9ndHQuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9n
dHQuaApAQCAtMjQwLDkgKzI0MCw2IEBAIHN0cnVjdCBpOTE1X3BhZ2VfZG1hIHsKIAl9OwogfTsK
IAotI2RlZmluZSBweF9iYXNlKHB4KSAoJihweCktPmJhc2UpCi0jZGVmaW5lIHB4X2RtYShweCkg
KHB4X2Jhc2UocHgpLT5kYWRkcikKLQogc3RydWN0IGk5MTVfcGFnZV90YWJsZSB7CiAJc3RydWN0
IGk5MTVfcGFnZV9kbWEgYmFzZTsKIAlhdG9taWNfdCB1c2VkOwpAQCAtMjU1LDYgKzI1MiwyMCBA
QCBzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVjdG9yeSB7CiAJdm9pZCAqZW50cnlbNTEyXTsKIH07CiAK
KyNkZWZpbmUgX19weF9jaG9vc2VfZXhwcih4LCB0eXBlLCBleHByLCBvdGhlcikgXAorCV9fYnVp
bHRpbl9jaG9vc2VfZXhwciggXAorCV9fYnVpbHRpbl90eXBlc19jb21wYXRpYmxlX3AodHlwZW9m
KHgpLCB0eXBlKSB8fCBcCisJX19idWlsdGluX3R5cGVzX2NvbXBhdGlibGVfcCh0eXBlb2YoeCks
IGNvbnN0IHR5cGUpLCBcCisJKHsgdHlwZSBfX3ggPSAodHlwZSkoeCk7IGV4cHI7IH0pLCBcCisJ
b3RoZXIpCisKKyNkZWZpbmUgcHhfYmFzZShweCkgXAorCV9fcHhfY2hvb3NlX2V4cHIocHgsIHN0
cnVjdCBpOTE1X3BhZ2VfZG1hICosIF9feCwgXAorCV9fcHhfY2hvb3NlX2V4cHIocHgsIHN0cnVj
dCBpOTE1X3BhZ2VfdGFibGUgKiwgJl9feC0+YmFzZSwgXAorCV9fcHhfY2hvb3NlX2V4cHIocHgs
IHN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICosICZfX3gtPmJhc2UsIFwKKwkodm9pZCkwKSkp
CisjZGVmaW5lIHB4X2RtYShweCkgKHB4X2Jhc2UocHgpLT5kYWRkcikKKwogc3RydWN0IGk5MTVf
dm1hX29wcyB7CiAJLyogTWFwIGFuIG9iamVjdCBpbnRvIGFuIGFkZHJlc3Mgc3BhY2Ugd2l0aCB0
aGUgZ2l2ZW4gY2FjaGUgZmxhZ3MuICovCiAJaW50ICgqYmluZF92bWEpKHN0cnVjdCBpOTE1X3Zt
YSAqdm1hLApAQCAtMzA0LDkgKzMxNSw5IEBAIHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ugewog
CXU2NCBzY3JhdGNoX3B0ZTsKIAlpbnQgc2NyYXRjaF9vcmRlcjsKIAlzdHJ1Y3QgaTkxNV9wYWdl
X2RtYSBzY3JhdGNoX3BhZ2U7Ci0Jc3RydWN0IGk5MTVfcGFnZV90YWJsZSAqc2NyYXRjaF9wdDsK
LQlzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVjdG9yeSAqc2NyYXRjaF9wZDsKLQlzdHJ1Y3QgaTkxNV9w
YWdlX2RpcmVjdG9yeSAqc2NyYXRjaF9wZHA7IC8qIEdFTjgrICYgNDhiIFBQR1RUICovCisJc3Ry
dWN0IGk5MTVfcGFnZV9kbWEgc2NyYXRjaF9wdDsKKwlzdHJ1Y3QgaTkxNV9wYWdlX2RtYSBzY3Jh
dGNoX3BkOworCXN0cnVjdCBpOTE1X3BhZ2VfZG1hIHNjcmF0Y2hfcGRwOyAvKiBHRU44KyAmIDQ4
YiBQUEdUVCAqLwogCiAJLyoqCiAJICogTGlzdCBvZiB2bWEgY3VycmVudGx5IGJvdW5kLgotLSAK
Mi4yMi4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJ
bnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0
cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

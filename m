Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id F319DCC14B
	for <lists+intel-gfx@lfdr.de>; Fri,  4 Oct 2019 19:05:16 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9B25F6EBEF;
	Fri,  4 Oct 2019 17:05:14 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga01.intel.com (mga01.intel.com [192.55.52.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 8E7146EBEF
 for <intel-gfx@lists.freedesktop.org>; Fri,  4 Oct 2019 17:05:12 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga002.fm.intel.com ([10.253.24.26])
 by fmsmga101.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 04 Oct 2019 10:05:12 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.67,256,1566889200"; d="scan'208";a="222216103"
Received: from bkokkula-mobl1.ger.corp.intel.com (HELO
 mwahaha-bdw.ger.corp.intel.com) ([10.252.7.77])
 by fmsmga002.fm.intel.com with ESMTP; 04 Oct 2019 10:05:11 -0700
From: Matthew Auld <matthew.auld@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  4 Oct 2019 18:04:43 +0100
Message-Id: <20191004170452.15410-13-matthew.auld@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20191004170452.15410-1-matthew.auld@intel.com>
References: <20191004170452.15410-1-matthew.auld@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v3 12/21] drm/i915: treat shmem as a region
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U2lnbmVkLW9mZi1ieTogTWF0dGhldyBBdWxkIDxtYXR0aGV3LmF1bGRAaW50ZWwuY29tPgpDYzog
Sm9vbmFzIExhaHRpbmVuIDxqb29uYXMubGFodGluZW5AbGludXguaW50ZWwuY29tPgpDYzogQWJk
aWVsIEphbnVsZ3VlIDxhYmRpZWwuamFudWxndWVAbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9waHlzLmMgICAgICB8ICA1ICstCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcmVnaW9uLmMgICAgfCAxNCArKystCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2htZW0uYyAgICAgfCA3NCArKysrKysrKysrKysr
Ky0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oICAgICAgICAgICAgICAgfCAg
MiArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jICAgICAgICAgICAgICAgfCAgOSAt
LS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jICAgICAgICAgICB8ICAzICst
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BjaS5jICAgICAgICAgICAgICAgfCAyOSArKysr
KystLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMgIHwgIDYg
Ky0KIDggZmlsZXMgY2hhbmdlZCwgOTkgaW5zZXJ0aW9ucygrKSwgNDMgZGVsZXRpb25zKC0pCgpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BoeXMuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9waHlzLmMKaW5kZXggNzY4MzU2OTA4MTYw
Li44MDQzZmY2M2Q3M2YgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9waHlzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BoeXMu
YwpAQCAtMTYsNiArMTYsNyBAQAogI2luY2x1ZGUgImd0L2ludGVsX2d0LmgiCiAjaW5jbHVkZSAi
aTkxNV9kcnYuaCIKICNpbmNsdWRlICJpOTE1X2dlbV9vYmplY3QuaCIKKyNpbmNsdWRlICJpOTE1
X2dlbV9yZWdpb24uaCIKICNpbmNsdWRlICJpOTE1X3NjYXR0ZXJsaXN0LmgiCiAKIHN0YXRpYyBp
bnQgaTkxNV9nZW1fb2JqZWN0X2dldF9wYWdlc19waHlzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmopCkBAIC0xOTEsOCArMTkyLDEwIEBAIGludCBpOTE1X2dlbV9vYmplY3RfYXR0YWNo
X3BoeXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgaW50IGFsaWduKQogCS8qIFBl
cm1hLXBpbiAodW50aWwgcmVsZWFzZSkgdGhlIHBoeXNpY2FsIHNldCBvZiBwYWdlcyAqLwogCV9f
aTkxNV9nZW1fb2JqZWN0X3Bpbl9wYWdlcyhvYmopOwogCi0JaWYgKCFJU19FUlJfT1JfTlVMTChw
YWdlcykpCisJaWYgKCFJU19FUlJfT1JfTlVMTChwYWdlcykpIHsKIAkJaTkxNV9nZW1fc2htZW1f
b3BzLnB1dF9wYWdlcyhvYmosIHBhZ2VzKTsKKwkJaTkxNV9nZW1fb2JqZWN0X3JlbGVhc2VfbWVt
b3J5X3JlZ2lvbihvYmopOworCX0KIAltdXRleF91bmxvY2soJm9iai0+bW0ubG9jayk7CiAJcmV0
dXJuIDA7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9y
ZWdpb24uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9yZWdpb24uYwppbmRl
eCA2NjMyNTRiM2RhMjEuLjBjMDNjMmM0MGRiYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX3JlZ2lvbi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9yZWdpb24uYwpAQCAtNiw2ICs2LDcgQEAKICNpbmNsdWRlICJpbnRlbF9tZW1v
cnlfcmVnaW9uLmgiCiAjaW5jbHVkZSAiaTkxNV9nZW1fcmVnaW9uLmgiCiAjaW5jbHVkZSAiaTkx
NV9kcnYuaCIKKyNpbmNsdWRlICJpOTE1X3RyYWNlLmgiCiAKIHZvaWQKIGk5MTVfZ2VtX29iamVj
dF9wdXRfcGFnZXNfYnVkZHkoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKQEAgLTE0
NiwxMSArMTQ3LDIyIEBAIGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfcmVnaW9uKHN0cnVjdCBpbnRl
bF9tZW1vcnlfcmVnaW9uICptZW0sCiAJR0VNX0JVR19PTighc2l6ZSk7CiAJR0VNX0JVR19PTigh
SVNfQUxJR05FRChzaXplLCBJOTE1X0dUVF9NSU5fQUxJR05NRU5UKSk7CiAKKwkvKgorCSAqIFRo
ZXJlIGlzIGEgcHJldmFsZW5jZSBvZiB0aGUgYXNzdW1wdGlvbiB0aGF0IHdlIGZpdCB0aGUgb2Jq
ZWN0J3MKKwkgKiBwYWdlIGNvdW50IGluc2lkZSBhIDMyYml0IF9zaWduZWRfIHZhcmlhYmxlLiBM
ZXQncyBkb2N1bWVudCB0aGlzIGFuZAorCSAqIGNhdGNoIGlmIHdlIGV2ZXIgbmVlZCB0byBmaXgg
aXQuIEluIHRoZSBtZWFudGltZSwgaWYgeW91IGRvIHNwb3QKKwkgKiBzdWNoIGEgbG9jYWwgdmFy
aWFibGUsIHBsZWFzZSBjb25zaWRlciBmaXhpbmchCisJICovCisKIAlpZiAoc2l6ZSA+PiBQQUdF
X1NISUZUID4gSU5UX01BWCkKIAkJcmV0dXJuIEVSUl9QVFIoLUUyQklHKTsKIAogCWlmIChvdmVy
Zmxvd3NfdHlwZShzaXplLCBvYmotPmJhc2Uuc2l6ZSkpCiAJCXJldHVybiBFUlJfUFRSKC1FMkJJ
Ryk7CiAKLQlyZXR1cm4gbWVtLT5vcHMtPmNyZWF0ZV9vYmplY3QobWVtLCBzaXplLCBmbGFncyk7
CisJb2JqID0gbWVtLT5vcHMtPmNyZWF0ZV9vYmplY3QobWVtLCBzaXplLCBmbGFncyk7CisJaWYg
KCFJU19FUlIob2JqKSkKKwkJdHJhY2VfaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZShvYmopOworCisJ
cmV0dXJuIG9iajsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9zaG1lbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3NobWVtLmMK
aW5kZXggNGM0OTU0ZThjZTBhLi5mNDY4YTM0MjRkZjQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaG1lbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9zaG1lbS5jCkBAIC03LDcgKzcsOSBAQAogI2luY2x1ZGUgPGxpbnV4L3Bh
Z2V2ZWMuaD4KICNpbmNsdWRlIDxsaW51eC9zd2FwLmg+CiAKKyNpbmNsdWRlICJnZW0vaTkxNV9n
ZW1fcmVnaW9uLmgiCiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIKKyNpbmNsdWRlICJpOTE1X2dlbWZz
LmgiCiAjaW5jbHVkZSAiaTkxNV9nZW1fb2JqZWN0LmgiCiAjaW5jbHVkZSAiaTkxNV9zY2F0dGVy
bGlzdC5oIgogI2luY2x1ZGUgImk5MTVfdHJhY2UuaCIKQEAgLTI2LDYgKzI4LDcgQEAgc3RhdGlj
IHZvaWQgY2hlY2tfcmVsZWFzZV9wYWdldmVjKHN0cnVjdCBwYWdldmVjICpwdmVjKQogc3RhdGlj
IGludCBzaG1lbV9nZXRfcGFnZXMoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHsK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7
CisJc3RydWN0IGludGVsX21lbW9yeV9yZWdpb24gKm1lbSA9IG9iai0+bW0ucmVnaW9uOwogCWNv
bnN0IHVuc2lnbmVkIGxvbmcgcGFnZV9jb3VudCA9IG9iai0+YmFzZS5zaXplIC8gUEFHRV9TSVpF
OwogCXVuc2lnbmVkIGxvbmcgaTsKIAlzdHJ1Y3QgYWRkcmVzc19zcGFjZSAqbWFwcGluZzsKQEAg
LTUyLDcgKzU1LDcgQEAgc3RhdGljIGludCBzaG1lbV9nZXRfcGFnZXMoc3RydWN0IGRybV9pOTE1
X2dlbV9vYmplY3QgKm9iaikKIAkgKiBJZiB0aGVyZSdzIG5vIGNoYW5jZSBvZiBhbGxvY2F0aW5n
IGVub3VnaCBwYWdlcyBmb3IgdGhlIHdob2xlCiAJICogb2JqZWN0LCBiYWlsIGVhcmx5LgogCSAq
LwotCWlmIChwYWdlX2NvdW50ID4gdG90YWxyYW1fcGFnZXMoKSkKKwlpZiAob2JqLT5iYXNlLnNp
emUgPiByZXNvdXJjZV9zaXplKCZtZW0tPnJlZ2lvbikpCiAJCXJldHVybiAtRU5PTUVNOwogCiAJ
c3QgPSBrbWFsbG9jKHNpemVvZigqc3QpLCBHRlBfS0VSTkVMKTsKQEAgLTQxNyw2ICs0MjAsOCBA
QCBzaG1lbV9wd3JpdGUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAogc3RhdGlj
IHZvaWQgc2htZW1fcmVsZWFzZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogewor
CWk5MTVfZ2VtX29iamVjdF9yZWxlYXNlX21lbW9yeV9yZWdpb24ob2JqKTsKKwogCWZwdXQob2Jq
LT5iYXNlLmZpbHApOwogfQogCkBAIC00MzQsOSArNDM5LDkgQEAgY29uc3Qgc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3Rfb3BzIGk5MTVfZ2VtX3NobWVtX29wcyA9IHsKIAkucmVsZWFzZSA9IHNo
bWVtX3JlbGVhc2UsCiB9OwogCi1zdGF0aWMgaW50IGNyZWF0ZV9zaG1lbShzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSwKLQkJCXN0cnVjdCBkcm1fZ2VtX29iamVjdCAqb2JqLAotCQkJc2l6
ZV90IHNpemUpCitzdGF0aWMgaW50IF9fY3JlYXRlX3NobWVtKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAorCQkJICBzdHJ1Y3QgZHJtX2dlbV9vYmplY3QgKm9iaiwKKwkJCSAgc2l6ZV90
IHNpemUpCiB7CiAJdW5zaWduZWQgbG9uZyBmbGFncyA9IFZNX05PUkVTRVJWRTsKIAlzdHJ1Y3Qg
ZmlsZSAqZmlscDsKQEAgLTQ1NSwzMSArNDYwLDIzIEBAIHN0YXRpYyBpbnQgY3JlYXRlX3NobWVt
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCXJldHVybiAwOwogfQogCi1zdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqCi1pOTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LCB1NjQgc2l6ZSkKK3N0YXRpYyBzdHJ1Y3QgZHJtX2k5
MTVfZ2VtX29iamVjdCAqCitjcmVhdGVfc2htZW0oc3RydWN0IGludGVsX21lbW9yeV9yZWdpb24g
Km1lbSwKKwkgICAgIHJlc291cmNlX3NpemVfdCBzaXplLAorCSAgICAgdW5zaWduZWQgaW50IGZs
YWdzKQogeworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gbWVtLT5pOTE1OwogCXN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJc3RydWN0IGFkZHJlc3Nfc3BhY2UgKm1h
cHBpbmc7CiAJdW5zaWduZWQgaW50IGNhY2hlX2xldmVsOwogCWdmcF90IG1hc2s7CiAJaW50IHJl
dDsKIAotCS8qIFRoZXJlIGlzIGEgcHJldmFsZW5jZSBvZiB0aGUgYXNzdW1wdGlvbiB0aGF0IHdl
IGZpdCB0aGUgb2JqZWN0J3MKLQkgKiBwYWdlIGNvdW50IGluc2lkZSBhIDMyYml0IF9zaWduZWRf
IHZhcmlhYmxlLiBMZXQncyBkb2N1bWVudCB0aGlzIGFuZAotCSAqIGNhdGNoIGlmIHdlIGV2ZXIg
bmVlZCB0byBmaXggaXQuIEluIHRoZSBtZWFudGltZSwgaWYgeW91IGRvIHNwb3QKLQkgKiBzdWNo
IGEgbG9jYWwgdmFyaWFibGUsIHBsZWFzZSBjb25zaWRlciBmaXhpbmchCi0JICovCi0JaWYgKHNp
emUgPj4gUEFHRV9TSElGVCA+IElOVF9NQVgpCi0JCXJldHVybiBFUlJfUFRSKC1FMkJJRyk7Ci0K
LQlpZiAob3ZlcmZsb3dzX3R5cGUoc2l6ZSwgb2JqLT5iYXNlLnNpemUpKQotCQlyZXR1cm4gRVJS
X1BUUigtRTJCSUcpOwotCiAJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2FsbG9jKCk7CiAJaWYgKCFv
YmopCiAJCXJldHVybiBFUlJfUFRSKC1FTk9NRU0pOwogCi0JcmV0ID0gY3JlYXRlX3NobWVtKGk5
MTUsICZvYmotPmJhc2UsIHNpemUpOworCXJldCA9IF9fY3JlYXRlX3NobWVtKGk5MTUsICZvYmot
PmJhc2UsIHNpemUpOwogCWlmIChyZXQpCiAJCWdvdG8gZmFpbDsKIApAQCAtNTE4LDcgKzUxNSw3
IEBAIGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc2htZW0oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsIHU2NCBzaXplKQogCiAJaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNoZV9jb2hlcmVuY3ko
b2JqLCBjYWNoZV9sZXZlbCk7CiAKLQl0cmFjZV9pOTE1X2dlbV9vYmplY3RfY3JlYXRlKG9iaik7
CisJaTkxNV9nZW1fb2JqZWN0X2luaXRfbWVtb3J5X3JlZ2lvbihvYmosIG1lbSwgMCk7CiAKIAly
ZXR1cm4gb2JqOwogCkBAIC01MjcsNiArNTI0LDEzIEBAIGk5MTVfZ2VtX29iamVjdF9jcmVhdGVf
c2htZW0oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHU2NCBzaXplKQogCXJldHVybiBF
UlJfUFRSKHJldCk7CiB9CiAKK3N0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICoKK2k5MTVfZ2Vt
X29iamVjdF9jcmVhdGVfc2htZW0oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsIHU2NCBz
aXplKQoreworCXJldHVybiBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3JlZ2lvbihpOTE1LT5tbS5y
ZWdpb25zW0lOVEVMX01FTU9SWV9TTUVNXSwKKwkJCQkJICAgICBzaXplLCAwKTsKK30KKwogLyog
QWxsb2NhdGUgYSBuZXcgR0VNIG9iamVjdCBhbmQgZmlsbCBpdCB3aXRoIHRoZSBzdXBwbGllZCBk
YXRhICovCiBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqCiBpOTE1X2dlbV9vYmplY3RfY3Jl
YXRlX3NobWVtX2Zyb21fZGF0YShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCkBA
IC01NzcsMyArNTgxLDM1IEBAIGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc2htZW1fZnJvbV9kYXRh
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAlpOTE1X2dlbV9vYmplY3RfcHV0
KG9iaik7CiAJcmV0dXJuIEVSUl9QVFIoZXJyKTsKIH0KKworc3RhdGljIGludCBpbml0X3NobWVt
KHN0cnVjdCBpbnRlbF9tZW1vcnlfcmVnaW9uICptZW0pCit7CisJaW50IGVycjsKKworCWVyciA9
IGk5MTVfZ2VtZnNfaW5pdChtZW0tPmk5MTUpOworCWlmIChlcnIpIHsKKwkJRFJNX05PVEUoIlVu
YWJsZSB0byBjcmVhdGUgYSBwcml2YXRlIHRtcGZzIG1vdW50LCBodWdlcGFnZSBzdXBwb3J0IHdp
bGwgYmUgZGlzYWJsZWQoJWQpLlxuIiwKKwkJCSBlcnIpOworCX0KKworCXJldHVybiAwOyAvKiBE
b24ndCBlcnJvciwgd2UgY2FuIHNpbXBseSBmYWxsYmFjayB0byB0aGUga2VybmVsIG1udCAqLwor
fQorCitzdGF0aWMgdm9pZCByZWxlYXNlX3NobWVtKHN0cnVjdCBpbnRlbF9tZW1vcnlfcmVnaW9u
ICptZW0pCit7CisJaTkxNV9nZW1mc19maW5pKG1lbS0+aTkxNSk7Cit9CisKK3N0YXRpYyBjb25z
dCBzdHJ1Y3QgaW50ZWxfbWVtb3J5X3JlZ2lvbl9vcHMgc2htZW1fcmVnaW9uX29wcyA9IHsKKwku
aW5pdCA9IGluaXRfc2htZW0sCisJLnJlbGVhc2UgPSByZWxlYXNlX3NobWVtLAorCS5jcmVhdGVf
b2JqZWN0ID0gY3JlYXRlX3NobWVtLAorfTsKKworc3RydWN0IGludGVsX21lbW9yeV9yZWdpb24g
Kmk5MTVfZ2VtX3NobWVtX3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQorewor
CXJldHVybiBpbnRlbF9tZW1vcnlfcmVnaW9uX2NyZWF0ZShpOTE1LCAwLAorCQkJCQkgIHRvdGFs
cmFtX3BhZ2VzKCkgPDwgUEFHRV9TSElGVCwKKwkJCQkJICBJOTE1X0dUVF9QQUdFX1NJWkVfNEss
IDAsCisJCQkJCSAgJnNobWVtX3JlZ2lvbl9vcHMpOworfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgK
aW5kZXggMDIzMzI2NTQwNWI0Li4zZjdmNDA3YzRjYTQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYu
aApAQCAtMjIyMiw2ICsyMjIyLDggQEAgdm9pZCBpOTE1X2dlbV9jbGVhbnVwX2Vhcmx5KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiBpbnQgaTkxNV9nZW1fZnJlZXplKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiBpbnQgaTkxNV9nZW1fZnJlZXplX2xhdGUo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIAorc3RydWN0IGludGVsX21lbW9y
eV9yZWdpb24gKmk5MTVfZ2VtX3NobWVtX3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KTsKKwogc3RhdGljIGlubGluZSB2b2lkIGk5MTVfZ2VtX2RyYWluX2ZyZWVkX29iamVjdHMo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7CiAJLyoKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dl
bS5jCmluZGV4IDBkZGJkM2E1ZmI4ZC4uOWNjNWVlM2I3ZjJmIDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
Z2VtLmMKQEAgLTQ1LDcgKzQ1LDYgQEAKICNpbmNsdWRlICJnZW0vaTkxNV9nZW1fY29udGV4dC5o
IgogI2luY2x1ZGUgImdlbS9pOTE1X2dlbV9pb2N0bHMuaCIKICNpbmNsdWRlICJnZW0vaTkxNV9n
ZW1fcG0uaCIKLSNpbmNsdWRlICJnZW0vaTkxNV9nZW1mcy5oIgogI2luY2x1ZGUgImd0L2ludGVs
X2VuZ2luZV91c2VyLmgiCiAjaW5jbHVkZSAiZ3QvaW50ZWxfZ3QuaCIKICNpbmNsdWRlICJndC9p
bnRlbF9ndF9wbS5oIgpAQCAtMTQ0MSwxNiArMTQ0MCwxMCBAQCBzdGF0aWMgdm9pZCBpOTE1X2dl
bV9pbml0X19tbShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAogdm9pZCBpOTE1X2dl
bV9pbml0X2Vhcmx5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKLQlpbnQg
ZXJyOwotCiAJaTkxNV9nZW1faW5pdF9fbW0oZGV2X3ByaXYpOwogCWk5MTVfZ2VtX2luaXRfX3Bt
KGRldl9wcml2KTsKIAogCXNwaW5fbG9ja19pbml0KCZkZXZfcHJpdi0+ZmJfdHJhY2tpbmcubG9j
ayk7Ci0KLQllcnIgPSBpOTE1X2dlbWZzX2luaXQoZGV2X3ByaXYpOwotCWlmIChlcnIpCi0JCURS
TV9OT1RFKCJVbmFibGUgdG8gY3JlYXRlIGEgcHJpdmF0ZSB0bXBmcyBtb3VudCwgaHVnZXBhZ2Ug
c3VwcG9ydCB3aWxsIGJlIGRpc2FibGVkKCVkKS5cbiIsIGVycik7CiB9CiAKIHZvaWQgaTkxNV9n
ZW1fY2xlYW51cF9lYXJseShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCkBAIC0x
NDU5LDggKzE0NTIsNiBAQCB2b2lkIGk5MTVfZ2VtX2NsZWFudXBfZWFybHkoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQogCUdFTV9CVUdfT04oIWxsaXN0X2VtcHR5KCZkZXZfcHJp
di0+bW0uZnJlZV9saXN0KSk7CiAJR0VNX0JVR19PTihhdG9taWNfcmVhZCgmZGV2X3ByaXYtPm1t
LmZyZWVfY291bnQpKTsKIAlXQVJOX09OKGRldl9wcml2LT5tbS5zaHJpbmtfY291bnQpOwotCi0J
aTkxNV9nZW1mc19maW5pKGRldl9wcml2KTsKIH0KIAogaW50IGk5MTVfZ2VtX2ZyZWV6ZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0
dC5jCmluZGV4IDQ1MGVjODc3OTI1Mi4uMzJlZTIyMGQyODM3IDEwMDY0NAotLS0gYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9ndHQuYwpAQCAtMjc4MCw3ICsyNzgwLDggQEAgaW50IGk5MTVfZ2VtX2luaXRfbWVt
b3J5X3JlZ2lvbnMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAKIAkJdHlwZSA9IE1F
TU9SWV9UWVBFX0ZST01fUkVHSU9OKGludGVsX3JlZ2lvbl9tYXBbaV0pOwogCQlzd2l0Y2ggKHR5
cGUpIHsKLQkJZGVmYXVsdDoKKwkJY2FzZSBJTlRFTF9TTUVNOgorCQkJbWVtID0gaTkxNV9nZW1f
c2htZW1fc2V0dXAoaTkxNSk7CiAJCQlicmVhazsKIAkJfQogCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X3BjaS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wY2ku
YwppbmRleCAxY2JmMzk5OGIzNjEuLmU1NWFiMjcyNDk5NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9wY2kuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3Bj
aS5jCkBAIC0xNTEsNiArMTUxLDkgQEAKICNkZWZpbmUgR0VOX0RFRkFVTFRfUEFHRV9TSVpFUyBc
CiAJLnBhZ2Vfc2l6ZXMgPSBJOTE1X0dUVF9QQUdFX1NJWkVfNEsKIAorI2RlZmluZSBHRU5fREVG
QVVMVF9SRUdJT05TIFwKKwkubWVtb3J5X3JlZ2lvbnMgPSBSRUdJT05fU01FTQorCiAjZGVmaW5l
IEk4MzBfRkVBVFVSRVMgXAogCUdFTigyKSwgXAogCS5pc19tb2JpbGUgPSAxLCBcCkBAIC0xNjgs
NyArMTcxLDggQEAKIAlJOVhYX1BJUEVfT0ZGU0VUUywgXAogCUk5WFhfQ1VSU09SX09GRlNFVFMs
IFwKIAlJOVhYX0NPTE9SUywgXAotCUdFTl9ERUZBVUxUX1BBR0VfU0laRVMKKwlHRU5fREVGQVVM
VF9QQUdFX1NJWkVTLCBcCisJR0VOX0RFRkFVTFRfUkVHSU9OUwogCiAjZGVmaW5lIEk4NDVfRkVB
VFVSRVMgXAogCUdFTigyKSwgXApAQCAtMTg1LDcgKzE4OSw4IEBACiAJSTg0NV9QSVBFX09GRlNF
VFMsIFwKIAlJODQ1X0NVUlNPUl9PRkZTRVRTLCBcCiAJSTlYWF9DT0xPUlMsIFwKLQlHRU5fREVG
QVVMVF9QQUdFX1NJWkVTCisJR0VOX0RFRkFVTFRfUEFHRV9TSVpFUywgXAorCUdFTl9ERUZBVUxU
X1JFR0lPTlMKIAogc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRlbF9kZXZpY2VfaW5mbyBpbnRlbF9p
ODMwX2luZm8gPSB7CiAJSTgzMF9GRUFUVVJFUywKQEAgLTIxOSw3ICsyMjQsOCBAQCBzdGF0aWMg
Y29uc3Qgc3RydWN0IGludGVsX2RldmljZV9pbmZvIGludGVsX2k4NjVnX2luZm8gPSB7CiAJSTlY
WF9QSVBFX09GRlNFVFMsIFwKIAlJOVhYX0NVUlNPUl9PRkZTRVRTLCBcCiAJSTlYWF9DT0xPUlMs
IFwKLQlHRU5fREVGQVVMVF9QQUdFX1NJWkVTCisJR0VOX0RFRkFVTFRfUEFHRV9TSVpFUywgXAor
CUdFTl9ERUZBVUxUX1JFR0lPTlMKIAogc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRlbF9kZXZpY2Vf
aW5mbyBpbnRlbF9pOTE1Z19pbmZvID0gewogCUdFTjNfRkVBVFVSRVMsCkBAIC0zMDQsNyArMzEw
LDggQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRlbF9kZXZpY2VfaW5mbyBpbnRlbF9waW5ldmll
d19tX2luZm8gPSB7CiAJSTlYWF9QSVBFX09GRlNFVFMsIFwKIAlJOVhYX0NVUlNPUl9PRkZTRVRT
LCBcCiAJSTk2NV9DT0xPUlMsIFwKLQlHRU5fREVGQVVMVF9QQUdFX1NJWkVTCisJR0VOX0RFRkFV
TFRfUEFHRV9TSVpFUywgXAorCUdFTl9ERUZBVUxUX1JFR0lPTlMKIAogc3RhdGljIGNvbnN0IHN0
cnVjdCBpbnRlbF9kZXZpY2VfaW5mbyBpbnRlbF9pOTY1Z19pbmZvID0gewogCUdFTjRfRkVBVFVS
RVMsCkBAIC0zNTQsNyArMzYxLDggQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRlbF9kZXZpY2Vf
aW5mbyBpbnRlbF9nbTQ1X2luZm8gPSB7CiAJSTlYWF9QSVBFX09GRlNFVFMsIFwKIAlJOVhYX0NV
UlNPUl9PRkZTRVRTLCBcCiAJSUxLX0NPTE9SUywgXAotCUdFTl9ERUZBVUxUX1BBR0VfU0laRVMK
KwlHRU5fREVGQVVMVF9QQUdFX1NJWkVTLCBcCisJR0VOX0RFRkFVTFRfUkVHSU9OUwogCiBzdGF0
aWMgY29uc3Qgc3RydWN0IGludGVsX2RldmljZV9pbmZvIGludGVsX2lyb25sYWtlX2RfaW5mbyA9
IHsKIAlHRU41X0ZFQVRVUkVTLApAQCAtMzg0LDcgKzM5Miw4IEBAIHN0YXRpYyBjb25zdCBzdHJ1
Y3QgaW50ZWxfZGV2aWNlX2luZm8gaW50ZWxfaXJvbmxha2VfbV9pbmZvID0gewogCUk5WFhfUElQ
RV9PRkZTRVRTLCBcCiAJSTlYWF9DVVJTT1JfT0ZGU0VUUywgXAogCUlMS19DT0xPUlMsIFwKLQlH
RU5fREVGQVVMVF9QQUdFX1NJWkVTCisJR0VOX0RFRkFVTFRfUEFHRV9TSVpFUywgXAorCUdFTl9E
RUZBVUxUX1JFR0lPTlMKIAogI2RlZmluZSBTTkJfRF9QTEFURk9STSBcCiAJR0VONl9GRUFUVVJF
UywgXApAQCAtNDMyLDcgKzQ0MSw4IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfZGV2aWNl
X2luZm8gaW50ZWxfc2FuZHlicmlkZ2VfbV9ndDJfaW5mbyA9IHsKIAlJVkJfUElQRV9PRkZTRVRT
LCBcCiAJSVZCX0NVUlNPUl9PRkZTRVRTLCBcCiAJSVZCX0NPTE9SUywgXAotCUdFTl9ERUZBVUxU
X1BBR0VfU0laRVMKKwlHRU5fREVGQVVMVF9QQUdFX1NJWkVTLCBcCisJR0VOX0RFRkFVTFRfUkVH
SU9OUwogCiAjZGVmaW5lIElWQl9EX1BMQVRGT1JNIFwKIAlHRU43X0ZFQVRVUkVTLCBcCkBAIC00
OTMsNiArNTAzLDcgQEAgc3RhdGljIGNvbnN0IHN0cnVjdCBpbnRlbF9kZXZpY2VfaW5mbyBpbnRl
bF92YWxsZXl2aWV3X2luZm8gPSB7CiAJSTlYWF9DVVJTT1JfT0ZGU0VUUywKIAlJOTY1X0NPTE9S
UywKIAlHRU5fREVGQVVMVF9QQUdFX1NJWkVTLAorCUdFTl9ERUZBVUxUX1JFR0lPTlMsCiB9Owog
CiAjZGVmaW5lIEc3NV9GRUFUVVJFUyAgXApAQCAtNTg3LDYgKzU5OCw3IEBAIHN0YXRpYyBjb25z
dCBzdHJ1Y3QgaW50ZWxfZGV2aWNlX2luZm8gaW50ZWxfY2hlcnJ5dmlld19pbmZvID0gewogCUNI
Vl9DVVJTT1JfT0ZGU0VUUywKIAlDSFZfQ09MT1JTLAogCUdFTl9ERUZBVUxUX1BBR0VfU0laRVMs
CisJR0VOX0RFRkFVTFRfUkVHSU9OUywKIH07CiAKICNkZWZpbmUgR0VOOV9ERUZBVUxUX1BBR0Vf
U0laRVMgXApAQCAtNjYxLDcgKzY3Myw4IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfZGV2
aWNlX2luZm8gaW50ZWxfc2t5bGFrZV9ndDRfaW5mbyA9IHsKIAlIU1dfUElQRV9PRkZTRVRTLCBc
CiAJSVZCX0NVUlNPUl9PRkZTRVRTLCBcCiAJSVZCX0NPTE9SUywgXAotCUdFTjlfREVGQVVMVF9Q
QUdFX1NJWkVTCisJR0VOOV9ERUZBVUxUX1BBR0VfU0laRVMsIFwKKwlHRU5fREVGQVVMVF9SRUdJ
T05TCiAKIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfZGV2aWNlX2luZm8gaW50ZWxfYnJveHRv
bl9pbmZvID0gewogCUdFTjlfTFBfRkVBVFVSRVMsCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKaW5kZXggNmQ0N2YwYWVhYzBjLi5jNTAyMzRm
OTM4YTQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dl
bV9kZXZpY2UuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1f
ZGV2aWNlLmMKQEAgLTcyLDggKzcyLDYgQEAgc3RhdGljIHZvaWQgbW9ja19kZXZpY2VfcmVsZWFz
ZShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCW1vY2tfZmluaV9nZ3R0KCZpOTE1LT5nZ3R0KTsK
IAlkZXN0cm95X3dvcmtxdWV1ZShpOTE1LT53cSk7CiAKLQlpOTE1X2dlbWZzX2ZpbmkoaTkxNSk7
Ci0KIAlpOTE1X2dlbV9jbGVhbnVwX21lbW9yeV9yZWdpb25zKGk5MTUpOwogCiAJZHJtX21vZGVf
Y29uZmlnX2NsZWFudXAoJmk5MTUtPmRybSk7CkBAIC0xNjUsNiArMTYzLDggQEAgc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKm1vY2tfZ2VtX2RldmljZSh2b2lkKQogCQlJOTE1X0dUVF9QQUdFX1NJ
WkVfNjRLIHwKIAkJSTkxNV9HVFRfUEFHRV9TSVpFXzJNOwogCisJbWt3cml0ZV9kZXZpY2VfaW5m
byhpOTE1KS0+bWVtb3J5X3JlZ2lvbnMgPSBSRUdJT05fU01FTTsKKwogCW1vY2tfdW5jb3JlX2lu
aXQoJmk5MTUtPnVuY29yZSk7CiAJaTkxNV9nZW1faW5pdF9fbW0oaTkxNSk7CiAJaW50ZWxfZ3Rf
aW5pdF9lYXJseSgmaTkxNS0+Z3QsIGk5MTUpOwpAQCAtMTk2LDggKzE5Niw2IEBAIHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICptb2NrX2dlbV9kZXZpY2Uodm9pZCkKIAogCWludGVsX2VuZ2luZXNf
ZHJpdmVyX3JlZ2lzdGVyKGk5MTUpOwogCi0JV0FSTl9PTihpOTE1X2dlbWZzX2luaXQoaTkxNSkp
OwotCiAJZXJyID0gaTkxNV9nZW1faW5pdF9tZW1vcnlfcmVnaW9ucyhpOTE1KTsKIAlpZiAoZXJy
KQogCQlnb3RvIGVycl9jb250ZXh0OwotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdm
eEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFp
bG1hbi9saXN0aW5mby9pbnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id A8589E0644
	for <lists+intel-gfx@lfdr.de>; Tue, 22 Oct 2019 16:19:57 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 13DB46E826;
	Tue, 22 Oct 2019 14:19:56 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 156186E826
 for <intel-gfx@lists.freedesktop.org>; Tue, 22 Oct 2019 14:19:53 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18926465-1500050 
 for multiple; Tue, 22 Oct 2019 15:19:43 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 22 Oct 2019 15:19:35 +0100
Message-Id: <20191022141935.15733-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0.rc0
In-Reply-To: <20191022130221.20644-1-chris@chris-wilson.co.uk>
References: <20191022130221.20644-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2] drm/i915: Teach record_defaults to operate
 on the intel_gt
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QWdhaW4gd2Ugd2lzaCB0byBvcGVyYXRlIG9uIHRoZSBlbmdpbmVzLCB3aGljaCBhcmUgb3duZWQg
YnkgdGhlCmludGVsX2d0LiBBcyBzdWNoIGl0IGlzIGVhc2llciwgYW5kIG11Y2ggbW9yZSBjb25z
aXN0ZW50LCB0byBwYXNzIHRoZQppbnRlbF9ndCBwYXJhbWV0ZXIuCgp2MjogVW5leHBvcnQgaTkx
NV9nZW1fbG9hZF9wb3dlcl9jb250ZXh0KCkKClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8
Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1
bGluQGludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0u
YyAgICAgICAgIHwgIDcgKy0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X3BtLmggICAgICAgICB8ICAxIC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMgICAg
ICAgICAgICAgICAgfCAxNCArKysrKysrKy0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvc2Vs
ZnRlc3RzL2k5MTVfc2VsZnRlc3QuYyB8IDEzICsrKysrKysrKysrLS0KIDQgZmlsZXMgY2hhbmdl
ZCwgMjAgaW5zZXJ0aW9ucygrKSwgMTUgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fcG0uYwppbmRleCBlZTMyNzljNzY1NjYuLjliYzBjZjMxMzllMyAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKQEAgLTM3LDExICszNyw2IEBAIHN0YXRp
YyBib29sIHN3aXRjaF90b19rZXJuZWxfY29udGV4dF9zeW5jKHN0cnVjdCBpbnRlbF9ndCAqZ3Qp
CiAJcmV0dXJuIHJlc3VsdDsKIH0KIAotYm9vbCBpOTE1X2dlbV9sb2FkX3Bvd2VyX2NvbnRleHQo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCi17Ci0JcmV0dXJuIHN3aXRjaF90b19rZXJu
ZWxfY29udGV4dF9zeW5jKCZpOTE1LT5ndCk7Ci19Ci0KIHN0YXRpYyB2b2lkIHVzZXJfZm9yY2V3
YWtlKHN0cnVjdCBpbnRlbF9ndCAqZ3QsIGJvb2wgc3VzcGVuZCkKIHsKIAlpbnQgY291bnQgPSBh
dG9taWNfcmVhZCgmZ3QtPnVzZXJfd2FrZXJlZik7CkBAIC0xNzEsNyArMTY2LDcgQEAgdm9pZCBp
OTE1X2dlbV9yZXN1bWUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJaW50ZWxfdWNf
cmVzdW1lKCZpOTE1LT5ndC51Yyk7CiAKIAkvKiBBbHdheXMgcmVsb2FkIGEgY29udGV4dCBmb3Ig
cG93ZXJzYXZpbmcuICovCi0JaWYgKCFpOTE1X2dlbV9sb2FkX3Bvd2VyX2NvbnRleHQoaTkxNSkp
CisJaWYgKCFzd2l0Y2hfdG9fa2VybmVsX2NvbnRleHRfc3luYygmaTkxNS0+Z3QpKQogCQlnb3Rv
IGVycl93ZWRnZWQ7CiAKIAl1c2VyX2ZvcmNld2FrZSgmaTkxNS0+Z3QsIGZhbHNlKTsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5oIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmgKaW5kZXggYTAxNzU3Mjc3OGQ1Li4yNmI3OGRi
ZGMyMjUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5o
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5oCkBAIC0xMiw3ICsx
Miw2IEBACiBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZTsKIHN0cnVjdCB3b3JrX3N0cnVjdDsKIAot
Ym9vbCBpOTE1X2dlbV9sb2FkX3Bvd2VyX2NvbnRleHQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpOwogdm9pZCBpOTE1X2dlbV9yZXN1bWUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUpOwogCiB2b2lkIGk5MTVfZ2VtX2lkbGVfd29ya19oYW5kbGVyKHN0cnVjdCB3b3JrX3N0cnVj
dCAqd29yayk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwppbmRleCBjYTY0YTBjOWI3NjIuLmI4ODI5
ODgwNTZiZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCkBAIC00OCw2ICs0OCw3IEBACiAjaW5j
bHVkZSAiZ3QvaW50ZWxfZW5naW5lX3VzZXIuaCIKICNpbmNsdWRlICJndC9pbnRlbF9ndC5oIgog
I2luY2x1ZGUgImd0L2ludGVsX2d0X3BtLmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfZ3RfcmVxdWVz
dHMuaCIKICNpbmNsdWRlICJndC9pbnRlbF9tb2NzLmgiCiAjaW5jbHVkZSAiZ3QvaW50ZWxfcmVz
ZXQuaCIKICNpbmNsdWRlICJndC9pbnRlbF9yZW5kZXJzdGF0ZS5oIgpAQCAtMTA3Miw3ICsxMDcz
LDcgQEAgdm9pZCBpOTE1X2dlbV9zYW5pdGl6ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSkKIAlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7CiB9
CiAKLXN0YXRpYyBpbnQgX19pbnRlbF9lbmdpbmVzX3JlY29yZF9kZWZhdWx0cyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3N0YXRpYyBpbnQgX19pbnRlbF9lbmdpbmVzX3JlY29yZF9k
ZWZhdWx0cyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogewogCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJl
cXVlc3RzW0k5MTVfTlVNX0VOR0lORVNdID0ge307CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
ZW5naW5lOwpAQCAtMTA4OCw3ICsxMDg5LDcgQEAgc3RhdGljIGludCBfX2ludGVsX2VuZ2luZXNf
cmVjb3JkX2RlZmF1bHRzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCSAqIGZyb20g
dGhlIHNhbWUgZGVmYXVsdCBIVyB2YWx1ZXMuCiAJICovCiAKLQlmb3JfZWFjaF9lbmdpbmUoZW5n
aW5lLCBpOTE1LCBpZCkgeworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LCBpZCkgewogCQlz
dHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwogCkBA
IC0xMDk2LDcgKzEwOTcsOCBAQCBzdGF0aWMgaW50IF9faW50ZWxfZW5naW5lc19yZWNvcmRfZGVm
YXVsdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJCUdFTV9CVUdfT04oIWVuZ2lu
ZS0+a2VybmVsX2NvbnRleHQpOwogCQllbmdpbmUtPnNlcmlhbCsrOyAvKiBmb3JjZSB0aGUga2Vy
bmVsIGNvbnRleHQgc3dpdGNoICovCiAKLQkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShpOTE1
LT5rZXJuZWxfY29udGV4dCwgZW5naW5lKTsKKwkJY2UgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZShl
bmdpbmUtPmtlcm5lbF9jb250ZXh0LT5nZW1fY29udGV4dCwKKwkJCQkJICBlbmdpbmUpOwogCQlp
ZiAoSVNfRVJSKGNlKSkgewogCQkJZXJyID0gUFRSX0VSUihjZSk7CiAJCQlnb3RvIG91dDsKQEAg
LTExMjUsNyArMTEyNyw3IEBAIHN0YXRpYyBpbnQgX19pbnRlbF9lbmdpbmVzX3JlY29yZF9kZWZh
dWx0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAl9CiAKIAkvKiBGbHVzaCB0aGUg
ZGVmYXVsdCBjb250ZXh0IGltYWdlIHRvIG1lbW9yeSwgYW5kIGVuYWJsZSBwb3dlcnNhdmluZy4g
Ki8KLQlpZiAoIWk5MTVfZ2VtX2xvYWRfcG93ZXJfY29udGV4dChpOTE1KSkgeworCWlmIChpbnRl
bF9ndF93YWl0X2Zvcl9pZGxlKGd0LCBJOTE1X0dFTV9JRExFX1RJTUVPVVQpID09IC1FVElNRSkg
ewogCQllcnIgPSAtRUlPOwogCQlnb3RvIG91dDsKIAl9CkBAIC0xMTg0LDcgKzExODYsNyBAQCBz
dGF0aWMgaW50IF9faW50ZWxfZW5naW5lc19yZWNvcmRfZGVmYXVsdHMoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiAJICogdGhpcyBpcyBieSBkZWNsYXJpbmcgb3Vyc2VsdmVzIHdlZGdl
ZC4KIAkgKi8KIAlpZiAoZXJyKQotCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZpOTE1LT5ndCk7CisJ
CWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOwogCiAJZm9yIChpZCA9IDA7IGlkIDwgQVJSQVlfU0la
RShyZXF1ZXN0cyk7IGlkKyspIHsKIAkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwpAQCAtMTI5
OCw3ICsxMzAwLDcgQEAgaW50IGk5MTVfZ2VtX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KQogCWlmIChyZXQpCiAJCWdvdG8gZXJyX2d0OwogCi0JcmV0ID0gX19pbnRlbF9l
bmdpbmVzX3JlY29yZF9kZWZhdWx0cyhkZXZfcHJpdik7CisJcmV0ID0gX19pbnRlbF9lbmdpbmVz
X3JlY29yZF9kZWZhdWx0cygmZGV2X3ByaXYtPmd0KTsKIAlpZiAocmV0KQogCQlnb3RvIGVycl9n
dDsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfc2Vs
ZnRlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3NlbGZ0ZXN0LmMK
aW5kZXggODI1YTgyODZjYmU4Li45MmM5MTkzY2RjODUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3NlbGZ0ZXN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL2k5MTVfc2VsZnRlc3QuYwpAQCAtMjMsOCArMjMsOSBAQAogCiAjaW5j
bHVkZSA8bGludXgvcmFuZG9tLmg+CiAKLSNpbmNsdWRlICIuLi9pOTE1X2Rydi5oIgotI2luY2x1
ZGUgIi4uL2k5MTVfc2VsZnRlc3QuaCIKKyNpbmNsdWRlICJndC9pbnRlbF9ndF9wbS5oIgorI2lu
Y2x1ZGUgImk5MTVfZHJ2LmgiCisjaW5jbHVkZSAiaTkxNV9zZWxmdGVzdC5oIgogCiAjaW5jbHVk
ZSAiaWd0X2ZsdXNoX3Rlc3QuaCIKIApAQCAtMjU2LDYgKzI1NywxMCBAQCBpbnQgX19pOTE1X2xp
dmVfc2V0dXAodm9pZCAqZGF0YSkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IGRhdGE7CiAKKwkvKiBUaGUgc2VsZnRlc3RzIGV4cGVjdCBhbiBpZGxlIHN5c3RlbSAqLworCWlm
IChpbnRlbF9ndF9wbV93YWl0X2Zvcl9pZGxlKCZpOTE1LT5ndCkpCisJCXJldHVybiAtRUlPOwor
CiAJcmV0dXJuIGludGVsX2d0X3Rlcm1pbmFsbHlfd2VkZ2VkKCZpOTE1LT5ndCk7CiB9CiAKQEAg
LTI3NSw2ICsyODAsMTAgQEAgaW50IF9faW50ZWxfZ3RfbGl2ZV9zZXR1cCh2b2lkICpkYXRhKQog
ewogCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBkYXRhOwogCisJLyogVGhlIHNlbGZ0ZXN0cyBleHBl
Y3QgYW4gaWRsZSBzeXN0ZW0gKi8KKwlpZiAoaW50ZWxfZ3RfcG1fd2FpdF9mb3JfaWRsZShndCkp
CisJCXJldHVybiAtRUlPOworCiAJcmV0dXJuIGludGVsX2d0X3Rlcm1pbmFsbHlfd2VkZ2VkKGd0
KTsKIH0KIAotLSAKMi4yNC4wLnJjMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGlu
Zm8vaW50ZWwtZ2Z4

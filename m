Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 74FA515CAAE
	for <lists+intel-gfx@lfdr.de>; Thu, 13 Feb 2020 19:48:16 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C34CC6F61D;
	Thu, 13 Feb 2020 18:48:14 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 648D96F61D
 for <intel-gfx@lists.freedesktop.org>; Thu, 13 Feb 2020 18:48:13 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga006.jf.intel.com ([10.7.209.51])
 by fmsmga104.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 13 Feb 2020 10:48:12 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.70,437,1574150400"; d="scan'208";a="238118900"
Received: from stinkbox.fi.intel.com (HELO stinkbox) ([10.237.72.174])
 by orsmga006.jf.intel.com with SMTP; 13 Feb 2020 10:48:10 -0800
Received: by stinkbox (sSMTP sendmail emulation);
 Thu, 13 Feb 2020 20:48:09 +0200
From: Ville Syrjala <ville.syrjala@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 13 Feb 2020 20:47:57 +0200
Message-Id: <20200213184800.14147-4-ville.syrjala@linux.intel.com>
X-Mailer: git-send-email 2.24.1
In-Reply-To: <20200213184800.14147-1-ville.syrjala@linux.intel.com>
References: <20200213184800.14147-1-ville.syrjala@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 3/6] drm/i915: Unify the low level dbuf code
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVmlsbGUgU3lyasOkbMOkIDx2aWxsZS5zeXJqYWxhQGxpbnV4LmludGVsLmNvbT4KClRo
ZSBsb3cgbGV2ZWwgZGJ1ZiBzbGljZSBjb2RlIGlzIHJhdGhlciBpbmNvbnNpdGVudCB3aXRoIGl0
cwpmdW5jdGlvbmEgbmFtaW5nIGFuZCBvcmdhbml6YXRpb24uIE1ha2UgaXQgbW9yZSBjb25zaXN0
ZW50LgoKQWxzbyBzaGFyZSB0aGUgZW5hYmxlL2Rpc2FibGUgZnVuY3Rpb25zIGJldHdlZW4gYWxs
IHBsYXRmb3JtcwpzaW5jZSB0aGUgc2FtZSBjb2RlIHdvcmtzIGp1c3QgZmluZSBmb3IgYWxsIG9m
IHRoZW0uCgpDYzogU3RhbmlzbGF2IExpc292c2tpeSA8c3RhbmlzbGF2Lmxpc292c2tpeUBpbnRl
bC5jb20+ClNpZ25lZC1vZmYtYnk6IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBsaW51
eC5pbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5LmMgIHwgMTAgKystLQogLi4uL2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dl
ci5jICAgIHwgNDYgKysrKysrKystLS0tLS0tLS0tLQogLi4uL2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheV9wb3dlci5oICAgIHwgIDYgKy0tCiAzIGZpbGVzIGNoYW5nZWQsIDI3IGluc2Vy
dGlvbnMoKyksIDM1IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxh
eS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggZTMzMWFiOTAwMzM2Li43ZmIyNWM3NjU1ZDEgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBAIC0xNTQ2Myw5
ICsxNTQ2Myw5IEBAIHN0YXRpYyB2b2lkIGljbF9kYnVmX3NsaWNlX3ByZV91cGRhdGUoc3RydWN0
IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAKIAlXQVJOX09OKCFuZXdfZGJ1Zl9zdGF0ZS0+
YmFzZS5jaGFuZ2VkKTsKIAotCWljbF9kYnVmX3NsaWNlc191cGRhdGUoZGV2X3ByaXYsCi0JCQkg
ICAgICAgb2xkX2RidWZfc3RhdGUtPmVuYWJsZWRfc2xpY2VzIHwKLQkJCSAgICAgICBuZXdfZGJ1
Zl9zdGF0ZS0+ZW5hYmxlZF9zbGljZXMpOworCWdlbjlfZGJ1Zl9zbGljZXNfdXBkYXRlKGRldl9w
cml2LAorCQkJCW9sZF9kYnVmX3N0YXRlLT5lbmFibGVkX3NsaWNlcyB8CisJCQkJbmV3X2RidWZf
c3RhdGUtPmVuYWJsZWRfc2xpY2VzKTsKIH0KIAogc3RhdGljIHZvaWQgaWNsX2RidWZfc2xpY2Vf
cG9zdF91cGRhdGUoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCkBAIC0xNTQ4Miw4
ICsxNTQ4Miw4IEBAIHN0YXRpYyB2b2lkIGljbF9kYnVmX3NsaWNlX3Bvc3RfdXBkYXRlKHN0cnVj
dCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCiAJV0FSTl9PTighbmV3X2RidWZfc3RhdGUt
PmJhc2UuY2hhbmdlZCk7CiAKLQlpY2xfZGJ1Zl9zbGljZXNfdXBkYXRlKGRldl9wcml2LAotCQkJ
ICAgICAgIG5ld19kYnVmX3N0YXRlLT5lbmFibGVkX3NsaWNlcyk7CisJZ2VuOV9kYnVmX3NsaWNl
c191cGRhdGUoZGV2X3ByaXYsCisJCQkJbmV3X2RidWZfc3RhdGUtPmVuYWJsZWRfc2xpY2VzKTsK
IH0KIAogc3RhdGljIHZvaWQgc2tsX2NvbW1pdF9tb2Rlc2V0X2VuYWJsZXMoc3RydWN0IGludGVs
X2F0b21pY19zdGF0ZSAqc3RhdGUpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXlfcG93ZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGlzcGxheV9wb3dlci5jCmluZGV4IGYyNGY0MmM1YzQ0Ni4uNTQ3MTVkYTdkYzMy
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlf
cG93ZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlf
cG93ZXIuYwpAQCAtNDQwNSwxNSArNDQwNSwxOCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9wb3dlcl9k
b21haW5zX3N5bmNfaHcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCW11dGV4
X3VubG9jaygmcG93ZXJfZG9tYWlucy0+bG9jayk7CiB9CiAKLXN0YXRpYyB2b2lkIGludGVsX2Ri
dWZfc2xpY2Vfc2V0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCQkgZW51
bSBkYnVmX3NsaWNlIHNsaWNlLCBib29sIGVuYWJsZSkKK3N0YXRpYyB2b2lkIGdlbjlfZGJ1Zl9z
bGljZV9zZXQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAorCQkJCWVudW0gZGJ1
Zl9zbGljZSBzbGljZSwgYm9vbCBlbmFibGUpCiB7CiAJaTkxNV9yZWdfdCByZWcgPSBEQlVGX0NU
TF9TKHNsaWNlKTsKIAlib29sIHN0YXRlOwogCXUzMiB2YWw7CiAKIAl2YWwgPSBpbnRlbF9kZV9y
ZWFkKGRldl9wcml2LCByZWcpOwotCXZhbCA9IGVuYWJsZSA/ICh2YWwgfCBEQlVGX1BPV0VSX1JF
UVVFU1QpIDogKHZhbCAmIH5EQlVGX1BPV0VSX1JFUVVFU1QpOworCWlmIChlbmFibGUpCisJCXZh
bCB8PSBEQlVGX1BPV0VSX1JFUVVFU1Q7CisJZWxzZQorCQl2YWwgJj0gfkRCVUZfUE9XRVJfUkVR
VUVTVDsKIAlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgcmVnLCB2YWwpOwogCWludGVsX2RlX3Bv
c3RpbmdfcmVhZChkZXZfcHJpdiwgcmVnKTsKIAl1ZGVsYXkoMTApOwpAQCAtNDQyNCwxOCArNDQy
Nyw4IEBAIHN0YXRpYyB2b2lkIGludGVsX2RidWZfc2xpY2Vfc2V0KHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdiwKIAkJIHNsaWNlLCBlbmFibGUgPyAiZW5hYmxlIiA6ICJkaXNhYmxl
Iik7CiB9CiAKLXN0YXRpYyB2b2lkIGdlbjlfZGJ1Zl9lbmFibGUoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2KQotewotCWljbF9kYnVmX3NsaWNlc191cGRhdGUoZGV2X3ByaXYsIEJJ
VChEQlVGX1MxKSk7Ci19Ci0KLXN0YXRpYyB2b2lkIGdlbjlfZGJ1Zl9kaXNhYmxlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKLXsKLQlpY2xfZGJ1Zl9zbGljZXNfdXBkYXRlKGRl
dl9wcml2LCAwKTsKLX0KLQotdm9pZCBpY2xfZGJ1Zl9zbGljZXNfdXBkYXRlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKLQkJCSAgICB1OCByZXFfc2xpY2VzKQordm9pZCBnZW45
X2RidWZfc2xpY2VzX3VwZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCisJ
CQkgICAgIHU4IHJlcV9zbGljZXMpCiB7CiAJaW50IG51bV9zbGljZXMgPSBJTlRFTF9JTkZPKGRl
dl9wcml2KS0+bnVtX3N1cHBvcnRlZF9kYnVmX3NsaWNlczsKIAlzdHJ1Y3QgaTkxNV9wb3dlcl9k
b21haW5zICpwb3dlcl9kb21haW5zID0gJmRldl9wcml2LT5wb3dlcl9kb21haW5zOwpAQCAtNDQ1
OCwyNiArNDQ1MSwyNSBAQCB2b2lkIGljbF9kYnVmX3NsaWNlc191cGRhdGUoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2LAogCW11dGV4X2xvY2soJnBvd2VyX2RvbWFpbnMtPmxvY2sp
OwogCiAJZm9yIChzbGljZSA9IERCVUZfUzE7IHNsaWNlIDwgbnVtX3NsaWNlczsgc2xpY2UrKykK
LQkJaW50ZWxfZGJ1Zl9zbGljZV9zZXQoZGV2X3ByaXYsIHNsaWNlLAotCQkJCSAgICAgcmVxX3Ns
aWNlcyAmIEJJVChzbGljZSkpOworCQlnZW45X2RidWZfc2xpY2Vfc2V0KGRldl9wcml2LCBzbGlj
ZSwgcmVxX3NsaWNlcyAmIEJJVChzbGljZSkpOwogCiAJZGV2X3ByaXYtPmRidWYuZW5hYmxlZF9z
bGljZXMgPSByZXFfc2xpY2VzOwogCiAJbXV0ZXhfdW5sb2NrKCZwb3dlcl9kb21haW5zLT5sb2Nr
KTsKIH0KIAotc3RhdGljIHZvaWQgaWNsX2RidWZfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICpkZXZfcHJpdikKK3N0YXRpYyB2b2lkIGdlbjlfZGJ1Zl9lbmFibGUoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KQogewotCS8qCi0JICogSnVzdCBwb3dlciB1cCAxIHNsaWNl
LCB3ZSB3aWxsCi0JICogZmlndXJlIG91dCBsYXRlciB3aGljaCBzbGljZXMgd2UgaGF2ZSBhbmQg
d2hhdCB3ZSBuZWVkLgotCSAqLwotCWljbF9kYnVmX3NsaWNlc191cGRhdGUoZGV2X3ByaXYsIEJJ
VChEQlVGX1MxKSk7CisJLyogVE9PRDogUmViYXNlIG9uIFN0YW4ncyBwYXRjaCBhZGRpbmcgdGhl
IHJlYWRvdXQgaGVyZSAqLworCWRldl9wcml2LT5kYnVmLmVuYWJsZWRfc2xpY2VzID0gaW50ZWxf
ZW5hYmxlZF9kYnVmX3NsaWNlc19tYXNrKGRldl9wcml2KTsKKworCWdlbjlfZGJ1Zl9zbGljZXNf
dXBkYXRlKGRldl9wcml2LCBCSVQoREJVRl9TMSkgfAorCQkJCWRldl9wcml2LT5kYnVmLmVuYWJs
ZWRfc2xpY2VzKTsKIH0KIAotc3RhdGljIHZvaWQgaWNsX2RidWZfZGlzYWJsZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitzdGF0aWMgdm9pZCBnZW45X2RidWZfZGlzYWJsZShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7Ci0JaWNsX2RidWZfc2xpY2VzX3Vw
ZGF0ZShkZXZfcHJpdiwgMCk7CisJZ2VuOV9kYnVmX3NsaWNlc191cGRhdGUoZGV2X3ByaXYsIDAp
OwogfQogCiBzdGF0aWMgdm9pZCBpY2xfbWJ1c19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICpkZXZfcHJpdikKQEAgLTUwMjEsNyArNTAxMyw3IEBAIHN0YXRpYyB2b2lkIGljbF9kaXNwbGF5
X2NvcmVfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaW50ZWxfY2Rj
bGtfaW5pdF9odyhkZXZfcHJpdik7CiAKIAkvKiA1LiBFbmFibGUgREJVRi4gKi8KLQlpY2xfZGJ1
Zl9lbmFibGUoZGV2X3ByaXYpOworCWdlbjlfZGJ1Zl9lbmFibGUoZGV2X3ByaXYpOwogCiAJLyog
Ni4gU2V0dXAgTUJVUy4gKi8KIAlpY2xfbWJ1c19pbml0KGRldl9wcml2KTsKQEAgLTUwNDQsNyAr
NTAzNiw3IEBAIHN0YXRpYyB2b2lkIGljbF9kaXNwbGF5X2NvcmVfdW5pbml0KHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAkvKiAxLiBEaXNhYmxlIGFsbCBkaXNwbGF5IGVuZ2lu
ZSBmdW5jdGlvbnMgLT4gYXJlYWR5IGRvbmUgKi8KIAogCS8qIDIuIERpc2FibGUgREJVRiAqLwot
CWljbF9kYnVmX2Rpc2FibGUoZGV2X3ByaXYpOworCWdlbjlfZGJ1Zl9kaXNhYmxlKGRldl9wcml2
KTsKIAogCS8qIDMuIERpc2FibGUgQ0QgY2xvY2sgKi8KIAlpbnRlbF9jZGNsa191bmluaXRfaHco
ZGV2X3ByaXYpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kaXNwbGF5X3Bvd2VyLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rp
c3BsYXlfcG93ZXIuaAppbmRleCA2MDFlMDAwZmZkMGQuLjFhMjc1NjExMjQxZSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmgKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3Bvd2VyLmgKQEAg
LTMxMiwxMyArMzEyLDEzIEBAIGVudW0gZGJ1Zl9zbGljZSB7CiAJREJVRl9TMiwKIH07CiAKK3Zv
aWQgZ2VuOV9kYnVmX3NsaWNlc191cGRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9w
cml2LAorCQkJICAgICB1OCByZXFfc2xpY2VzKTsKKwogI2RlZmluZSB3aXRoX2ludGVsX2Rpc3Bs
YXlfcG93ZXIoaTkxNSwgZG9tYWluLCB3ZikgXAogCWZvciAoKHdmKSA9IGludGVsX2Rpc3BsYXlf
cG93ZXJfZ2V0KChpOTE1KSwgKGRvbWFpbikpOyAod2YpOyBcCiAJICAgICBpbnRlbF9kaXNwbGF5
X3Bvd2VyX3B1dF9hc3luYygoaTkxNSksIChkb21haW4pLCAod2YpKSwgKHdmKSA9IDApCiAKLXZv
aWQgaWNsX2RidWZfc2xpY2VzX3VwZGF0ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCi0JCQkgICAgdTggcmVxX3NsaWNlcyk7Ci0KIHZvaWQgY2h2X3BoeV9wb3dlcmdhdGVfbGFu
ZXMoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkgICAgIGJvb2wgb3ZlcnJpZGUs
IHVuc2lnbmVkIGludCBtYXNrKTsKIGJvb2wgY2h2X3BoeV9wb3dlcmdhdGVfY2goc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBlbnVtIGRwaW9fcGh5IHBoeSwKLS0gCjIuMjQuMQoK
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4
IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlz
dHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

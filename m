Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 90BBF98870
	for <lists+intel-gfx@lfdr.de>; Thu, 22 Aug 2019 02:23:19 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 452116E9B2;
	Thu, 22 Aug 2019 00:23:17 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7A2DD6E3CE
 for <intel-gfx@lists.freedesktop.org>; Thu, 22 Aug 2019 00:23:15 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18220443-1500050 
 for <intel-gfx@lists.freedesktop.org>; Thu, 22 Aug 2019 01:23:13 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 22 Aug 2019 01:23:09 +0100
Message-Id: <20190822002311.25220-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 1/3] drm/i915: Track ggtt fence reservations under
 its own mutex
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgY2FuIHJlZHVjZSB0aGUgbG9ja2luZyBmb3IgZmVuY2UgcmVnaXN0ZXJzIGZyb20gdGhlIGRl
di0+c3RydWN0X211dGV4CnRvIGEgbG9jYWwgbXV0ZXguIFdlIGNvdWxkIGludHJvZHVjZSBhIG11
dGV4IGZvciB0aGUgc29sZSBwdXJwb3NlIG9mCnRyYWNraW5nIHRoZSBmZW5jZSBhY3F1aXNpdGlv
biwgZXhjZXB0IHRoZXJlIGlzIGEgbGl0dGxlIGJpdCBvZiBvdmVybGFwCndpdGggdGhlIGZhdWx0
IHRyYWNraW5nLCBzbyB1c2UgdGhlIGk5MTVfZ2d0dC5tdXRleCBhcyBpdCBjb3ZlcnMgYm90aC4K
ClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpD
YzogTWlrYSBLdW9wcGFsYSA8bWlrYS5rdW9wcGFsYUBsaW51eC5pbnRlbC5jb20+ClJldmlld2Vk
LWJ5OiBNYXR0aGV3IEF1bGQgPG1hdHRoZXcuYXVsZEBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMgfCAgIDcgKysKIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2d2dC9hcGVydHVyZV9nbS5jICAgICAgIHwgIDEwICstCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2RlYnVnZnMuYyAgICAgICAgICB8ICAgNSArLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW1fZmVuY2VfcmVnLmMgICAgfCAxMDggKysrKysrKysrKysrLS0tLS0tLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZmVuY2VfcmVnLmggICAgfCAgIDIgKy0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmggICAgICAgICAgICAgIHwgICA0ICstCiA2IGZp
bGVzIGNoYW5nZWQsIDg3IGluc2VydGlvbnMoKyksIDQ5IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMKaW5kZXggMjk4YzRkMTkxNDM5
Li5hMDA5OGZjMzU5MjEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X2hhbmdjaGVjay5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hh
bmdjaGVjay5jCkBAIC0xMTU3LDcgKzExNTcsMTQgQEAgc3RhdGljIGludCBldmljdF9mZW5jZSh2
b2lkICpkYXRhKQogCQlnb3RvIG91dF91bmxvY2s7CiAJfQogCisJZXJyID0gaTkxNV92bWFfcGlu
KGFyZy0+dm1hLCAwLCAwLCBQSU5fR0xPQkFMIHwgUElOX01BUFBBQkxFKTsKKwlpZiAoZXJyKSB7
CisJCXByX2VycigiVW5hYmxlIHRvIHBpbiB2bWEgZm9yIFktdGlsZWQgZmVuY2U7IGVycjolZFxu
IiwgZXJyKTsKKwkJZ290byBvdXRfdW5sb2NrOworCX0KKwogCWVyciA9IGk5MTVfdm1hX3Bpbl9m
ZW5jZShhcmctPnZtYSk7CisJaTkxNV92bWFfdW5waW4oYXJnLT52bWEpOwogCWlmIChlcnIpIHsK
IAkJcHJfZXJyKCJVbmFibGUgdG8gcGluIFktdGlsZWQgZmVuY2U7IGVycjolZFxuIiwgZXJyKTsK
IAkJZ290byBvdXRfdW5sb2NrOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0
L2FwZXJ0dXJlX2dtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndnQvYXBlcnR1cmVfZ20uYwpp
bmRleCBjM2QxOWQ4OGRhNDAuLjVmZjI0MzdiMjk5OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Z0L2FwZXJ0dXJlX2dtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0
L2FwZXJ0dXJlX2dtLmMKQEAgLTE3MiwxNCArMTcyLDE0IEBAIHN0YXRpYyB2b2lkIGZyZWVfdmdw
dV9mZW5jZShzdHJ1Y3QgaW50ZWxfdmdwdSAqdmdwdSkKIAogCWludGVsX3J1bnRpbWVfcG1fZ2V0
KCZkZXZfcHJpdi0+cnVudGltZV9wbSk7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0
cnVjdF9tdXRleCk7CisJbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmdndHQudm0ubXV0ZXgpOwogCV9j
bGVhcl92Z3B1X2ZlbmNlKHZncHUpOwogCWZvciAoaSA9IDA7IGkgPCB2Z3B1X2ZlbmNlX3N6KHZn
cHUpOyBpKyspIHsKIAkJcmVnID0gdmdwdS0+ZmVuY2UucmVnc1tpXTsKIAkJaTkxNV91bnJlc2Vy
dmVfZmVuY2UocmVnKTsKIAkJdmdwdS0+ZmVuY2UucmVnc1tpXSA9IE5VTEw7CiAJfQotCW11dGV4
X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X3VubG9jaygmZGV2
X3ByaXYtPmdndHQudm0ubXV0ZXgpOwogCiAJaW50ZWxfcnVudGltZV9wbV9wdXRfdW5jaGVja2Vk
KCZkZXZfcHJpdi0+cnVudGltZV9wbSk7CiB9CkBAIC0xOTUsNyArMTk1LDcgQEAgc3RhdGljIGlu
dCBhbGxvY192Z3B1X2ZlbmNlKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1KQogCWludGVsX3J1bnRp
bWVfcG1fZ2V0KHJwbSk7CiAKIAkvKiBSZXF1ZXN0IGZlbmNlcyBmcm9tIGhvc3QgKi8KLQltdXRl
eF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfbG9jaygmZGV2X3By
aXYtPmdndHQudm0ubXV0ZXgpOwogCiAJZm9yIChpID0gMDsgaSA8IHZncHVfZmVuY2Vfc3oodmdw
dSk7IGkrKykgewogCQlyZWcgPSBpOTE1X3Jlc2VydmVfZmVuY2UoZGV2X3ByaXYpOwpAQCAtMjA3
LDcgKzIwNyw3IEBAIHN0YXRpYyBpbnQgYWxsb2NfdmdwdV9mZW5jZShzdHJ1Y3QgaW50ZWxfdmdw
dSAqdmdwdSkKIAogCV9jbGVhcl92Z3B1X2ZlbmNlKHZncHUpOwogCi0JbXV0ZXhfdW5sb2NrKCZk
ZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+Z2d0
dC52bS5tdXRleCk7CiAJaW50ZWxfcnVudGltZV9wbV9wdXRfdW5jaGVja2VkKHJwbSk7CiAJcmV0
dXJuIDA7CiBvdXRfZnJlZV9mZW5jZToKQEAgLTIyMCw3ICsyMjAsNyBAQCBzdGF0aWMgaW50IGFs
bG9jX3ZncHVfZmVuY2Uoc3RydWN0IGludGVsX3ZncHUgKnZncHUpCiAJCWk5MTVfdW5yZXNlcnZl
X2ZlbmNlKHJlZyk7CiAJCXZncHUtPmZlbmNlLnJlZ3NbaV0gPSBOVUxMOwogCX0KLQltdXRleF91
bmxvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF91bmxvY2soJmRldl9w
cml2LT5nZ3R0LnZtLm11dGV4KTsKIAlpbnRlbF9ydW50aW1lX3BtX3B1dF91bmNoZWNrZWQocnBt
KTsKIAlyZXR1cm4gLUVOT1NQQzsKIH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZGVidWdmcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKaW5k
ZXggYjM5MjI2ZDdmOGQyLi5mNWQ2NzAyZWM3ZGYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZGVidWdmcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVi
dWdmcy5jCkBAIC02NTIsMTAgKzY1MiwxMSBAQCBzdGF0aWMgaW50IGk5MTVfZ2VtX2ZlbmNlX3Jl
Z3NfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAKIAlyY3VfcmVhZF9sb2Nr
KCk7CiAJZm9yIChpID0gMDsgaSA8IGk5MTUtPmdndHQubnVtX2ZlbmNlczsgaSsrKSB7Ci0JCXN0
cnVjdCBpOTE1X3ZtYSAqdm1hID0gaTkxNS0+Z2d0dC5mZW5jZV9yZWdzW2ldLnZtYTsKKwkJc3Ry
dWN0IGk5MTVfZmVuY2VfcmVnICpyZWcgPSAmaTkxNS0+Z2d0dC5mZW5jZV9yZWdzW2ldOworCQlz
dHJ1Y3QgaTkxNV92bWEgKnZtYSA9IHJlZy0+dm1hOwogCiAJCXNlcV9wcmludGYobSwgIkZlbmNl
ICVkLCBwaW4gY291bnQgPSAlZCwgb2JqZWN0ID0gIiwKLQkJCSAgIGksIGk5MTUtPmdndHQuZmVu
Y2VfcmVnc1tpXS5waW5fY291bnQpOworCQkJICAgaSwgYXRvbWljX3JlYWQoJnJlZy0+cGluX2Nv
dW50KSk7CiAJCWlmICghdm1hKQogCQkJc2VxX3B1dHMobSwgInVudXNlZCIpOwogCQllbHNlCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9mZW5jZV9yZWcuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5jCmluZGV4IGM5NjU0ZjFhNDY4
Zi4uNmEzM2EwYmI5N2E5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dl
bV9mZW5jZV9yZWcuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9mZW5jZV9y
ZWcuYwpAQCAtMjk5LDE1ICsyOTksMjQgQEAgc3RhdGljIGludCBmZW5jZV91cGRhdGUoc3RydWN0
IGk5MTVfZmVuY2VfcmVnICpmZW5jZSwKICAqLwogaW50IGk5MTVfdm1hX3B1dF9mZW5jZShzdHJ1
Y3QgaTkxNV92bWEgKnZtYSkKIHsKKwlzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0ID0gaTkxNV92bV90
b19nZ3R0KHZtYS0+dm0pOwogCXN0cnVjdCBpOTE1X2ZlbmNlX3JlZyAqZmVuY2UgPSB2bWEtPmZl
bmNlOworCWludCBlcnI7CiAKIAlpZiAoIWZlbmNlKQogCQlyZXR1cm4gMDsKIAotCWlmIChmZW5j
ZS0+cGluX2NvdW50KQorCWlmIChhdG9taWNfcmVhZCgmZmVuY2UtPnBpbl9jb3VudCkpCiAJCXJl
dHVybiAtRUJVU1k7CiAKLQlyZXR1cm4gZmVuY2VfdXBkYXRlKGZlbmNlLCBOVUxMKTsKKwllcnIg
PSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmdndHQtPnZtLm11dGV4KTsKKwlpZiAoZXJyKQor
CQlyZXR1cm4gZXJyOworCisJZXJyID0gZmVuY2VfdXBkYXRlKGZlbmNlLCBOVUxMKTsKKwltdXRl
eF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKKworCXJldHVybiBlcnI7CiB9CiAKIHN0YXRpYyBz
dHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmZlbmNlX2ZpbmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCkBAIC0zMTcsNyArMzI2LDcgQEAgc3RhdGljIHN0cnVjdCBpOTE1X2ZlbmNlX3JlZyAq
ZmVuY2VfZmluZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAlsaXN0X2Zvcl9lYWNo
X2VudHJ5KGZlbmNlLCAmaTkxNS0+Z2d0dC5mZW5jZV9saXN0LCBsaW5rKSB7CiAJCUdFTV9CVUdf
T04oZmVuY2UtPnZtYSAmJiBmZW5jZS0+dm1hLT5mZW5jZSAhPSBmZW5jZSk7CiAKLQkJaWYgKGZl
bmNlLT5waW5fY291bnQpCisJCWlmIChhdG9taWNfcmVhZCgmZmVuY2UtPnBpbl9jb3VudCkpCiAJ
CQljb250aW51ZTsKIAogCQlyZXR1cm4gZmVuY2U7CkBAIC0zMzAsNiArMzM5LDQ4IEBAIHN0YXRp
YyBzdHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmZlbmNlX2ZpbmQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpCiAJcmV0dXJuIEVSUl9QVFIoLUVERUFETEspOwogfQogCitzdGF0aWMgaW50IF9f
aTkxNV92bWFfcGluX2ZlbmNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQoreworCXN0cnVjdCBpOTE1
X2dndHQgKmdndHQgPSBpOTE1X3ZtX3RvX2dndHQodm1hLT52bSk7CisJc3RydWN0IGk5MTVfZmVu
Y2VfcmVnICpmZW5jZTsKKwlzdHJ1Y3QgaTkxNV92bWEgKnNldCA9IGk5MTVfZ2VtX29iamVjdF9p
c190aWxlZCh2bWEtPm9iaikgPyB2bWEgOiBOVUxMOworCWludCBlcnI7CisKKwkvKiBKdXN0IHVw
ZGF0ZSBvdXIgcGxhY2UgaW4gdGhlIExSVSBpZiBvdXIgZmVuY2UgaXMgZ2V0dGluZyByZXVzZWQu
ICovCisJaWYgKHZtYS0+ZmVuY2UpIHsKKwkJZmVuY2UgPSB2bWEtPmZlbmNlOworCQlHRU1fQlVH
X09OKGZlbmNlLT52bWEgIT0gdm1hKTsKKwkJYXRvbWljX2luYygmZmVuY2UtPnBpbl9jb3VudCk7
CisJCWlmICghZmVuY2UtPmRpcnR5KSB7CisJCQlsaXN0X21vdmVfdGFpbCgmZmVuY2UtPmxpbmss
ICZnZ3R0LT5mZW5jZV9saXN0KTsKKwkJCXJldHVybiAwOworCQl9CisJfSBlbHNlIGlmIChzZXQp
IHsKKwkJZmVuY2UgPSBmZW5jZV9maW5kKHZtYS0+dm0tPmk5MTUpOworCQlpZiAoSVNfRVJSKGZl
bmNlKSkKKwkJCXJldHVybiBQVFJfRVJSKGZlbmNlKTsKKworCQlHRU1fQlVHX09OKGF0b21pY19y
ZWFkKCZmZW5jZS0+cGluX2NvdW50KSk7CisJCWF0b21pY19pbmMoJmZlbmNlLT5waW5fY291bnQp
OworCX0gZWxzZSB7CisJCXJldHVybiAwOworCX0KKworCWVyciA9IGZlbmNlX3VwZGF0ZShmZW5j
ZSwgc2V0KTsKKwlpZiAoZXJyKQorCQlnb3RvIG91dF91bnBpbjsKKworCUdFTV9CVUdfT04oZmVu
Y2UtPnZtYSAhPSBzZXQpOworCUdFTV9CVUdfT04odm1hLT5mZW5jZSAhPSAoc2V0ID8gZmVuY2Ug
OiBOVUxMKSk7CisKKwlpZiAoc2V0KQorCQlyZXR1cm4gMDsKKworb3V0X3VucGluOgorCWF0b21p
Y19kZWMoJmZlbmNlLT5waW5fY291bnQpOworCXJldHVybiBlcnI7Cit9CisKIC8qKgogICogaTkx
NV92bWFfcGluX2ZlbmNlIC0gc2V0IHVwIGZlbmNpbmcgZm9yIGEgdm1hCiAgKiBAdm1hOiB2bWEg
dG8gbWFwIHRocm91Z2ggYSBmZW5jZSByZWcKQEAgLTM1MCw4ICs0MDEsNiBAQCBzdGF0aWMgc3Ry
dWN0IGk5MTVfZmVuY2VfcmVnICpmZW5jZV9maW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQogICovCiBpbnQgaTkxNV92bWFfcGluX2ZlbmNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQog
ewotCXN0cnVjdCBpOTE1X2ZlbmNlX3JlZyAqZmVuY2U7Ci0Jc3RydWN0IGk5MTVfdm1hICpzZXQg
PSBpOTE1X2dlbV9vYmplY3RfaXNfdGlsZWQodm1hLT5vYmopID8gdm1hIDogTlVMTDsKIAlpbnQg
ZXJyOwogCiAJLyoKQEAgLTM1OSwzOSArNDA4LDE2IEBAIGludCBpOTE1X3ZtYV9waW5fZmVuY2Uo
c3RydWN0IGk5MTVfdm1hICp2bWEpCiAJICogbXVzdCBrZWVwIHRoZSBkZXZpY2UgYXdha2Ugd2hp
bHN0IHVzaW5nIHRoZSBmZW5jZS4KIAkgKi8KIAlhc3NlcnRfcnBtX3dha2Vsb2NrX2hlbGQoJnZt
YS0+dm0tPmk5MTUtPnJ1bnRpbWVfcG0pOworCUdFTV9CVUdfT04oIWk5MTVfdm1hX2lzX3Bpbm5l
ZCh2bWEpKTsKKwlHRU1fQlVHX09OKCFpOTE1X3ZtYV9pc19nZ3R0KHZtYSkpOwogCi0JLyogSnVz
dCB1cGRhdGUgb3VyIHBsYWNlIGluIHRoZSBMUlUgaWYgb3VyIGZlbmNlIGlzIGdldHRpbmcgcmV1
c2VkLiAqLwotCWlmICh2bWEtPmZlbmNlKSB7Ci0JCWZlbmNlID0gdm1hLT5mZW5jZTsKLQkJR0VN
X0JVR19PTihmZW5jZS0+dm1hICE9IHZtYSk7Ci0JCWZlbmNlLT5waW5fY291bnQrKzsKLQkJaWYg
KCFmZW5jZS0+ZGlydHkpIHsKLQkJCWxpc3RfbW92ZV90YWlsKCZmZW5jZS0+bGluaywKLQkJCQkg
ICAgICAgJmZlbmNlLT5pOTE1LT5nZ3R0LmZlbmNlX2xpc3QpOwotCQkJcmV0dXJuIDA7Ci0JCX0K
LQl9IGVsc2UgaWYgKHNldCkgewotCQlmZW5jZSA9IGZlbmNlX2ZpbmQodm1hLT52bS0+aTkxNSk7
Ci0JCWlmIChJU19FUlIoZmVuY2UpKQotCQkJcmV0dXJuIFBUUl9FUlIoZmVuY2UpOwotCi0JCUdF
TV9CVUdfT04oZmVuY2UtPnBpbl9jb3VudCk7Ci0JCWZlbmNlLT5waW5fY291bnQrKzsKLQl9IGVs
c2UKLQkJcmV0dXJuIDA7Ci0KLQllcnIgPSBmZW5jZV91cGRhdGUoZmVuY2UsIHNldCk7CisJZXJy
ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZ2bWEtPnZtLT5tdXRleCk7CiAJaWYgKGVycikK
LQkJZ290byBvdXRfdW5waW47CisJCXJldHVybiBlcnI7CiAKLQlHRU1fQlVHX09OKGZlbmNlLT52
bWEgIT0gc2V0KTsKLQlHRU1fQlVHX09OKHZtYS0+ZmVuY2UgIT0gKHNldCA/IGZlbmNlIDogTlVM
TCkpOwotCi0JaWYgKHNldCkKLQkJcmV0dXJuIDA7CisJZXJyID0gX19pOTE1X3ZtYV9waW5fZmVu
Y2Uodm1hKTsKKwltdXRleF91bmxvY2soJnZtYS0+dm0tPm11dGV4KTsKIAotb3V0X3VucGluOgot
CWZlbmNlLT5waW5fY291bnQtLTsKIAlyZXR1cm4gZXJyOwogfQogCkBAIC00MDQsMTYgKzQzMCwx
NyBAQCBpbnQgaTkxNV92bWFfcGluX2ZlbmNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogICovCiBz
dHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmk5MTVfcmVzZXJ2ZV9mZW5jZShzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSkKIHsKKwlzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0ID0gJmk5MTUtPmdndHQ7
CiAJc3RydWN0IGk5MTVfZmVuY2VfcmVnICpmZW5jZTsKIAlpbnQgY291bnQ7CiAJaW50IHJldDsK
IAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWxvY2tk
ZXBfYXNzZXJ0X2hlbGQoJmdndHQtPnZtLm11dGV4KTsKIAogCS8qIEtlZXAgYXQgbGVhc3Qgb25l
IGZlbmNlIGF2YWlsYWJsZSBmb3IgdGhlIGRpc3BsYXkgZW5naW5lLiAqLwogCWNvdW50ID0gMDsK
LQlsaXN0X2Zvcl9lYWNoX2VudHJ5KGZlbmNlLCAmaTkxNS0+Z2d0dC5mZW5jZV9saXN0LCBsaW5r
KQotCQljb3VudCArPSAhZmVuY2UtPnBpbl9jb3VudDsKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5KGZl
bmNlLCAmZ2d0dC0+ZmVuY2VfbGlzdCwgbGluaykKKwkJY291bnQgKz0gIWF0b21pY19yZWFkKCZm
ZW5jZS0+cGluX2NvdW50KTsKIAlpZiAoY291bnQgPD0gMSkKIAkJcmV0dXJuIEVSUl9QVFIoLUVO
T1NQQyk7CiAKQEAgLTQyOSw2ICs0NTYsNyBAQCBzdHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmk5MTVf
cmVzZXJ2ZV9mZW5jZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAl9CiAKIAlsaXN0
X2RlbCgmZmVuY2UtPmxpbmspOworCiAJcmV0dXJuIGZlbmNlOwogfQogCkBAIC00NDAsOSArNDY4
LDExIEBAIHN0cnVjdCBpOTE1X2ZlbmNlX3JlZyAqaTkxNV9yZXNlcnZlX2ZlbmNlKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogICovCiB2b2lkIGk5MTVfdW5yZXNlcnZlX2ZlbmNlKHN0
cnVjdCBpOTE1X2ZlbmNlX3JlZyAqZmVuY2UpCiB7Ci0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmZmVu
Y2UtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSAm
ZmVuY2UtPmk5MTUtPmdndHQ7CisKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZnZ3R0LT52bS5tdXRl
eCk7CiAKLQlsaXN0X2FkZCgmZmVuY2UtPmxpbmssICZmZW5jZS0+aTkxNS0+Z2d0dC5mZW5jZV9s
aXN0KTsKKwlsaXN0X2FkZCgmZmVuY2UtPmxpbmssICZnZ3R0LT5mZW5jZV9saXN0KTsKIH0KIAog
LyoqCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9mZW5jZV9yZWcu
aCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5oCmluZGV4IDM3ZTRm
MTA0ZjdjMC4uOTk4NjZmYjlkOTRmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9mZW5jZV9yZWcuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9m
ZW5jZV9yZWcuaApAQCAtNDEsNyArNDEsNyBAQCBzdHJ1Y3QgaTkxNV9mZW5jZV9yZWcgewogCXN0
cnVjdCBsaXN0X2hlYWQgbGluazsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNTsKIAlz
dHJ1Y3QgaTkxNV92bWEgKnZtYTsKLQlpbnQgcGluX2NvdW50OworCWF0b21pY190IHBpbl9jb3Vu
dDsKIAlpbnQgaWQ7CiAJLyoqCiAJICogV2hldGhlciB0aGUgdGlsaW5nIHBhcmFtZXRlcnMgZm9y
IHRoZSBjdXJyZW50bHkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1h
LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5oCmluZGV4IDllN2Q4ZjQxNTRiMi4u
Y2Y2YzA0MzcwOTFkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5o
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmgKQEAgLTQyNiw4ICs0MjYsOCBA
QCBpbnQgX19tdXN0X2NoZWNrIGk5MTVfdm1hX3B1dF9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZt
YSk7CiAKIHN0YXRpYyBpbmxpbmUgdm9pZCBfX2k5MTVfdm1hX3VucGluX2ZlbmNlKHN0cnVjdCBp
OTE1X3ZtYSAqdm1hKQogewotCUdFTV9CVUdfT04odm1hLT5mZW5jZS0+cGluX2NvdW50IDw9IDAp
OwotCXZtYS0+ZmVuY2UtPnBpbl9jb3VudC0tOworCUdFTV9CVUdfT04oYXRvbWljX3JlYWQoJnZt
YS0+ZmVuY2UtPnBpbl9jb3VudCkgPD0gMCk7CisJYXRvbWljX2RlYygmdm1hLT5mZW5jZS0+cGlu
X2NvdW50KTsKIH0KIAogLyoqCi0tIAoyLjIzLjAKCl9fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxp
c3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFu
L2xpc3RpbmZvL2ludGVsLWdmeA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D0A2951CCC
	for <lists+intel-gfx@lfdr.de>; Mon, 24 Jun 2019 23:07:26 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 98B9A89DFB;
	Mon, 24 Jun 2019 21:07:22 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga11.intel.com (mga11.intel.com [192.55.52.93])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 7FADA89DE5
 for <intel-gfx@lists.freedesktop.org>; Mon, 24 Jun 2019 21:07:10 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga003.jf.intel.com ([10.7.209.27])
 by fmsmga102.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 24 Jun 2019 14:07:10 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,413,1557212400"; d="scan'208";a="163740815"
Received: from labuser-z97x-ud5h.jf.intel.com ([10.54.75.49])
 by orsmga003.jf.intel.com with ESMTP; 24 Jun 2019 14:07:09 -0700
From: Manasi Navare <manasi.d.navare@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 24 Jun 2019 14:08:50 -0700
Message-Id: <20190624210850.17223-9-manasi.d.navare@intel.com>
X-Mailer: git-send-email 2.19.1
In-Reply-To: <20190624210850.17223-1-manasi.d.navare@intel.com>
References: <20190624210850.17223-1-manasi.d.navare@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v3 8/8] drm/i915/display/icl: In port sync mode
 disable slaves first then masters
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Jani Nikula <jani.nikula@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SW4gdGhlIHRyYW5zY29kZXIgcG9ydCBzeW5jIG1vZGUsIHRoZSBzbGF2ZSB0cmFuc2NvZGVycyBt
YXNrIHRoZWlyIHZibGFua3MKdW50aWwgbWFzdGVyIHRyYW5zY29kZXIncyB2Ymxhbmsgc28gd2hp
bGUgZGlzYWJsaW5nIHRoZW0sIG1ha2UKc3VyZSBzbGF2ZXMgYXJlIGRpc2FibGVkIGZpcnN0IGFu
ZCB0aGVuIHRoZSBtYXN0ZXJzLgoKQ2M6IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBs
aW51eC5pbnRlbC5jb20+CkNjOiBNYWFydGVuIExhbmtob3JzdCA8bWFhcnRlbi5sYW5raG9yc3RA
bGludXguaW50ZWwuY29tPgpDYzogTWF0dCBSb3BlciA8bWF0dGhldy5kLnJvcGVyQGludGVsLmNv
bT4KQ2M6IEphbmkgTmlrdWxhIDxqYW5pLm5pa3VsYUBpbnRlbC5jb20+ClNpZ25lZC1vZmYtYnk6
IE1hbmFzaSBOYXZhcmUgPG1hbmFzaS5kLm5hdmFyZUBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgfCAxMTcgKysrKysrKysrKysrKysr
KysrLQogMSBmaWxlIGNoYW5nZWQsIDExMSBpbnNlcnRpb25zKCspLCA2IGRlbGV0aW9ucygtKQoK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggMGEw
ZDk3ZWYwM2Q2Li44NTc0NmEyNmQwZTAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGlzcGxheS5jCkBAIC0xMzkwMSw2ICsxMzkwMSwxMDYgQEAgc3RhdGljIHZvaWQg
aW50ZWxfY29tbWl0X21vZGVzZXRfZGlzYWJsZXMoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0
YXRlKQogCX0KIH0KIAorc3RhdGljIHZvaWQgaWNsX2NvbW1pdF9tb2Rlc2V0X2Rpc2FibGVzKHN0
cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2
ID0gc3RhdGUtPmRldjsKKwlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICppbnRlbF9zdGF0ZSA9
IHRvX2ludGVsX2F0b21pY19zdGF0ZShzdGF0ZSk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCXN0cnVjdCBkcm1fY3J0Y19zdGF0ZSAqb2xkX2Ny
dGNfc3RhdGUsICpuZXdfY3J0Y19zdGF0ZTsKKwlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3
X2ludGVsX2NydGNfc3RhdGUsICpvbGRfaW50ZWxfY3J0Y19zdGF0ZTsKKwlzdHJ1Y3QgZHJtX2Ny
dGMgKmNydGM7CisJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGM7CisJaW50IGk7CisKKwkv
KgorCSAqIERpc2FibGUgYWxsIHRoZSBQb3J0IFN5bmMgU2xhdmVzIGZpcnN0CisJICovCisJZm9y
X2VhY2hfb2xkbmV3X2NydGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsIG9sZF9jcnRjX3N0YXRlLCBu
ZXdfY3J0Y19zdGF0ZSwgaSkgeworCQlvbGRfaW50ZWxfY3J0Y19zdGF0ZSA9IHRvX2ludGVsX2Ny
dGNfc3RhdGUob2xkX2NydGNfc3RhdGUpOworCQluZXdfaW50ZWxfY3J0Y19zdGF0ZSA9IHRvX2lu
dGVsX2NydGNfc3RhdGUobmV3X2NydGNfc3RhdGUpOworCQlpbnRlbF9jcnRjID0gdG9faW50ZWxf
Y3J0YyhjcnRjKTsKKworCQlpZiAoIW5lZWRzX21vZGVzZXQobmV3X2NydGNfc3RhdGUpIHx8CisJ
CSAgICAhaXNfdHJhbnNfcG9ydF9zeW5jX3NsYXZlKG9sZF9pbnRlbF9jcnRjX3N0YXRlKSkKKwkJ
CWNvbnRpbnVlOworCisJCWludGVsX3ByZV9wbGFuZV91cGRhdGUob2xkX2ludGVsX2NydGNfc3Rh
dGUsIG5ld19pbnRlbF9jcnRjX3N0YXRlKTsKKworCQlpZiAob2xkX2NydGNfc3RhdGUtPmFjdGl2
ZSkgeworCQkJaW50ZWxfY3J0Y19kaXNhYmxlX3BsYW5lcyhpbnRlbF9zdGF0ZSwgaW50ZWxfY3J0
Yyk7CisKKwkJCS8qCisJCQkgKiBXZSBuZWVkIHRvIGRpc2FibGUgcGlwZSBDUkMgYmVmb3JlIGRp
c2FibGluZyB0aGUgcGlwZSwKKwkJCSAqIG9yIHdlIHJhY2UgYWdhaW5zdCB2Ymxhbmsgb2ZmLgor
CQkJICovCisJCQlpbnRlbF9jcnRjX2Rpc2FibGVfcGlwZV9jcmMoaW50ZWxfY3J0Yyk7CisKKwkJ
CWRldl9wcml2LT5kaXNwbGF5LmNydGNfZGlzYWJsZShvbGRfaW50ZWxfY3J0Y19zdGF0ZSwgc3Rh
dGUpOworCQkJaW50ZWxfY3J0Yy0+YWN0aXZlID0gZmFsc2U7CisJCQlpbnRlbF9mYmNfZGlzYWJs
ZShpbnRlbF9jcnRjKTsKKwkJCWludGVsX2Rpc2FibGVfc2hhcmVkX2RwbGwob2xkX2ludGVsX2Ny
dGNfc3RhdGUpOworCisJCQkvKgorCQkJICogVW5kZXJydW5zIGRvbid0IGFsd2F5cyByYWlzZSBp
bnRlcnJ1cHRzLAorCQkJICogc28gY2hlY2sgbWFudWFsbHkuCisJCQkgKi8KKwkJCWludGVsX2No
ZWNrX2NwdV9maWZvX3VuZGVycnVucyhkZXZfcHJpdik7CisJCQlpbnRlbF9jaGVja19wY2hfZmlm
b191bmRlcnJ1bnMoZGV2X3ByaXYpOworCisJCQkvKiBGSVhNRSB1bmlmeSB0aGlzIGZvciBhbGwg
cGxhdGZvcm1zICovCisJCQlpZiAoIW5ld19jcnRjX3N0YXRlLT5hY3RpdmUgJiYKKwkJCSAgICAh
SEFTX0dNQ0goZGV2X3ByaXYpICYmCisJCQkgICAgZGV2X3ByaXYtPmRpc3BsYXkuaW5pdGlhbF93
YXRlcm1hcmtzKQorCQkJCWRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJrcyhpbnRl
bF9zdGF0ZSwKKwkJCQkJCQkJICAgICBuZXdfaW50ZWxfY3J0Y19zdGF0ZSk7CisJCX0KKwl9CisK
KwkvKgorCSAqIERpc2FibGUgcmVzdCBvZiB0aGUgQ1JUQ3Mgb3RoZXIgdGhhbiBzbGF2ZXMKKwkg
Ki8KKwlmb3JfZWFjaF9vbGRuZXdfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0Yywgb2xkX2NydGNf
c3RhdGUsIG5ld19jcnRjX3N0YXRlLCBpKSB7CisJCW9sZF9pbnRlbF9jcnRjX3N0YXRlID0gdG9f
aW50ZWxfY3J0Y19zdGF0ZShvbGRfY3J0Y19zdGF0ZSk7CisJCW5ld19pbnRlbF9jcnRjX3N0YXRl
ID0gdG9faW50ZWxfY3J0Y19zdGF0ZShuZXdfY3J0Y19zdGF0ZSk7CisJCWludGVsX2NydGMgPSB0
b19pbnRlbF9jcnRjKGNydGMpOworCisJCWlmICghbmVlZHNfbW9kZXNldChuZXdfY3J0Y19zdGF0
ZSkgfHwKKwkJICAgIGlzX3RyYW5zX3BvcnRfc3luY19zbGF2ZShvbGRfaW50ZWxfY3J0Y19zdGF0
ZSkpCisJCQljb250aW51ZTsKKworCQlpbnRlbF9wcmVfcGxhbmVfdXBkYXRlKG9sZF9pbnRlbF9j
cnRjX3N0YXRlLCBuZXdfaW50ZWxfY3J0Y19zdGF0ZSk7CisKKwkJaWYgKG9sZF9jcnRjX3N0YXRl
LT5hY3RpdmUpIHsKKwkJCWludGVsX2NydGNfZGlzYWJsZV9wbGFuZXMoaW50ZWxfc3RhdGUsIGlu
dGVsX2NydGMpOworCisJCQkvKgorCQkJICogV2UgbmVlZCB0byBkaXNhYmxlIHBpcGUgQ1JDIGJl
Zm9yZSBkaXNhYmxpbmcgdGhlIHBpcGUsCisJCQkgKiBvciB3ZSByYWNlIGFnYWluc3QgdmJsYW5r
IG9mZi4KKwkJCSAqLworCQkJaW50ZWxfY3J0Y19kaXNhYmxlX3BpcGVfY3JjKGludGVsX2NydGMp
OworCisJCQlkZXZfcHJpdi0+ZGlzcGxheS5jcnRjX2Rpc2FibGUob2xkX2ludGVsX2NydGNfc3Rh
dGUsIHN0YXRlKTsKKwkJCWludGVsX2NydGMtPmFjdGl2ZSA9IGZhbHNlOworCQkJaW50ZWxfZmJj
X2Rpc2FibGUoaW50ZWxfY3J0Yyk7CisJCQlpbnRlbF9kaXNhYmxlX3NoYXJlZF9kcGxsKG9sZF9p
bnRlbF9jcnRjX3N0YXRlKTsKKworCQkJLyoKKwkJCSAqIFVuZGVycnVucyBkb24ndCBhbHdheXMg
cmFpc2UgaW50ZXJydXB0cywKKwkJCSAqIHNvIGNoZWNrIG1hbnVhbGx5LgorCQkJICovCisJCQlp
bnRlbF9jaGVja19jcHVfZmlmb191bmRlcnJ1bnMoZGV2X3ByaXYpOworCQkJaW50ZWxfY2hlY2tf
cGNoX2ZpZm9fdW5kZXJydW5zKGRldl9wcml2KTsKKworCQkJLyogRklYTUUgdW5pZnkgdGhpcyBm
b3IgYWxsIHBsYXRmb3JtcyAqLworCQkJaWYgKCFuZXdfY3J0Y19zdGF0ZS0+YWN0aXZlICYmCisJ
CQkgICAgIUhBU19HTUNIKGRldl9wcml2KSAmJgorCQkJICAgIGRldl9wcml2LT5kaXNwbGF5Lmlu
aXRpYWxfd2F0ZXJtYXJrcykKKwkJCQlkZXZfcHJpdi0+ZGlzcGxheS5pbml0aWFsX3dhdGVybWFy
a3MoaW50ZWxfc3RhdGUsCisJCQkJCQkJCSAgICAgbmV3X2ludGVsX2NydGNfc3RhdGUpOworCQl9
CisJfQorfQorCiBzdGF0aWMgdm9pZCBpbnRlbF9jb21taXRfbW9kZXNldF9lbmFibGVzKHN0cnVj
dCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZSkKIHsKIAlzdHJ1Y3QgZHJtX2NydGMgKmNydGM7CkBA
IC0xNDI1Nyw2ICsxNDM1NywxMSBAQCBzdGF0aWMgdm9pZCBpbnRlbF9hdG9taWNfY29tbWl0X3Rh
aWwoc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlKQogCiAJaW50ZWxfYXRvbWljX2NvbW1p
dF9mZW5jZV93YWl0KGludGVsX3N0YXRlKTsKIAorCWRybV9hdG9taWNfaGVscGVyX3dhaXRfZm9y
X2RlcGVuZGVuY2llcyhzdGF0ZSk7CisKKwlpZiAoaW50ZWxfc3RhdGUtPm1vZGVzZXQpCisJCXdh
a2VyZWYgPSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2dldChkZXZfcHJpdiwgUE9XRVJfRE9NQUlOX01P
REVTRVQpOworCiAJZm9yX2VhY2hfb2xkbmV3X2NydGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsIG9s
ZF9jcnRjX3N0YXRlLCBuZXdfY3J0Y19zdGF0ZSwgaSkgewogCQluZXdfaW50ZWxfY3J0Y19zdGF0
ZSA9IHRvX2ludGVsX2NydGNfc3RhdGUobmV3X2NydGNfc3RhdGUpOwogCQlpbnRlbF9jcnRjID0g
dG9faW50ZWxfY3J0YyhjcnRjKTsKQEAgLTE0MjY5LDExICsxNDM3NCw2IEBAIHN0YXRpYyB2b2lk
IGludGVsX2F0b21pY19jb21taXRfdGFpbChzdHJ1Y3QgZHJtX2F0b21pY19zdGF0ZSAqc3RhdGUp
CiAJCX0KIAl9CiAKLQlkcm1fYXRvbWljX2hlbHBlcl93YWl0X2Zvcl9kZXBlbmRlbmNpZXMoc3Rh
dGUpOwotCi0JaWYgKGludGVsX3N0YXRlLT5tb2Rlc2V0KQotCQl3YWtlcmVmID0gaW50ZWxfZGlz
cGxheV9wb3dlcl9nZXQoZGV2X3ByaXYsIFBPV0VSX0RPTUFJTl9NT0RFU0VUKTsKLQogCWRldl9w
cml2LT5kaXNwbGF5LmNvbW1pdF9tb2Rlc2V0X2Rpc2FibGVzKHN0YXRlKTsKIAogCS8qIEZJWE1F
OiBFdmVudHVhbGx5IGdldCByaWQgb2Ygb3VyIGludGVsX2NydGMtPmNvbmZpZyBwb2ludGVyICov
CkBAIC0xNjE3MCw3ICsxNjI3MCwxMiBAQCB2b2lkIGludGVsX2luaXRfZGlzcGxheV9ob29rcyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiAJZWxzZQogCQlkZXZfcHJpdi0+ZGlz
cGxheS5jb21taXRfbW9kZXNldF9lbmFibGVzID0gaW50ZWxfY29tbWl0X21vZGVzZXRfZW5hYmxl
czsKIAotCWRldl9wcml2LT5kaXNwbGF5LmNvbW1pdF9tb2Rlc2V0X2Rpc2FibGVzID0gaW50ZWxf
Y29tbWl0X21vZGVzZXRfZGlzYWJsZXM7CisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEp
CisJCWRldl9wcml2LT5kaXNwbGF5LmNvbW1pdF9tb2Rlc2V0X2Rpc2FibGVzID0KKwkJCWljbF9j
b21taXRfbW9kZXNldF9kaXNhYmxlczsKKwllbHNlCisJCWRldl9wcml2LT5kaXNwbGF5LmNvbW1p
dF9tb2Rlc2V0X2Rpc2FibGVzID0KKwkJCWludGVsX2NvbW1pdF9tb2Rlc2V0X2Rpc2FibGVzOwog
CiB9CiAKLS0gCjIuMTkuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50
ZWwtZ2Z4

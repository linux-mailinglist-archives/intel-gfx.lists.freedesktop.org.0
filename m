Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4757EB6675
	for <lists+intel-gfx@lfdr.de>; Wed, 18 Sep 2019 16:55:17 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 862B26F3BD;
	Wed, 18 Sep 2019 14:55:15 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 2F7F66F3BD
 for <intel-gfx@lists.freedesktop.org>; Wed, 18 Sep 2019 14:55:14 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18533831-1500050 
 for multiple; Wed, 18 Sep 2019 15:54:54 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 18 Sep 2019 15:54:51 +0100
Message-Id: <20190918145453.8800-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190918145453.8800-1-chris@chris-wilson.co.uk>
References: <20190918145453.8800-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 2/4] drm/i915: Mark i915_request.timeline as a
 volatile, rcu pointer
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIHJlcXVlc3QtPnRpbWVsaW5lIGlzIG9ubHkgdmFsaWQgdW50aWwgdGhlIHJlcXVlc3QgaXMg
cmV0aXJlZCAoaS5lLgpiZWZvcmUgaXQgaXMgY29tcGxldGVkKS4gVXBvbiByZXRpcmluZyB0aGUg
cmVxdWVzdCwgdGhlIGNvbnRleHQgbWF5IGJlCnVucGlubmVkIGFuZCBmcmVlZCwgYW5kIGFsb25n
IHdpdGggaXQgdGhlIHRpbWVsaW5lIG1heSBiZSBmcmVlZC4gV2UKdGhlcmVmb3JlIG5lZWQgdG8g
YmUgdmVyeSBjYXJlZnVsIHdoZW4gY2hhc2luZyBycS0+dGltZWxpbmUgdGhhdCB0aGUKcG9pbnRl
ciBkb2VzIG5vdCBkaXNhcHBlYXIgYmVuZWF0aCB1cy4gVGhlIHZhc3QgbWFqb3JpdHkgb2YgdXNl
cnMgYXJlIGluCmEgcHJvdGVjdGVkIGNvbnRleHQsIGVpdGhlciBkdXJpbmcgcmVxdWVzdCBjb25z
dHJ1Y3Rpb24gb3IgcmV0aXJlbWVudCwKd2hlcmUgdGhlIHRpbWVsaW5lLT5tdXRleCBpcyBoZWxk
IGFuZCB0aGUgdGltZWxpbmUgY2Fubm90IGRpc2FwcGVhci4gSXQKaXMgdGhvc2UgZmV3IG9mZiB0
aGUgYmVhdGVuIHBhdGggKHdoZXJlIHdlIGFjY2VzcyBhIHNlY29uZCB0aW1lbGluZSkgdGhhdApu
ZWVkIGV4dHJhIHNjcnV0aW55IC0tIHRvIGJlIGFkZGVkIGluIHRoZSBuZXh0IHBhdGNoIGFmdGVy
IGZpcnN0IGFkZGluZwp0aGUgd2FybmluZ3MgYWJvdXQgZGFuZ2Vyb3VzIGFjY2Vzcy4KCk9uZSBj
b21wbGljYXRpb24sIHdoZXJlIHdlIGNhbm5vdCB1c2UgdGhlIHRpbWVsaW5lLT5tdXRleCBpdHNl
bGYsIGlzCmR1cmluZyByZXF1ZXN0IHN1Ym1pc3Npb24gb250byBoYXJkd2FyZSAodW5kZXIgc3Bp
bmxvY2tzKS4gSGVyZSwgd2Ugd2FudAp0byBjaGVjayBvbiB0aGUgdGltZWxpbmUgdG8gZmluYWxp
emUgdGhlIGJyZWFkY3J1bWIsIGFuZCBzbyB3ZSBuZWVkIHRvCmltcG9zZSBhIHNlY29uZCBydWxl
IHRvIGVuc3VyZSB0aGF0IHRoZSByZXF1ZXN0LT50aW1lbGluZSBpcyBpbmRlZWQKdmFsaWQuIEFz
IHdlIGFyZSBzdWJtaXR0aW5nIHRoZSByZXF1ZXN0LCBpdCdzIGNvbnRleHQgYW5kIHRpbWVsaW5l
IG11c3QKYmUgcGlubmVkLCBhcyBpdCB3aWxsIGJlIHVzZWQgYnkgdGhlIGhhcmR3YXJlLiBTaW5j
ZSBpdCBpcyBwaW5uZWQsIHdlCmtub3cgdGhlIHJlcXVlc3QtPnRpbWVsaW5lIG11c3Qgc3RpbGwg
YmUgdmFsaWQsIGFuZCB3ZSBjYW5ub3Qgc3VibWl0IHRoZQppZGxlIGJhcnJpZXIgdW50aWwgYWZ0
ZXIgd2UgcmVsZWFzZSB0aGUgZW5naW5lLT5hY3RpdmUubG9jaywgZXJnbyB3aGlsZQpzdWJtaXR0
aW5nIGFuZCBob2xkaW5nIHRoYXQgc3BpbmxvY2ssIGEgc2Vjb25kIHRocmVhZCBjYW5ub3QgcmVs
ZWFzZSB0aGUKdGltZWxpbmUuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNo
cmlzLXdpbHNvbi5jby51az4KQ2M6IFR2cnRrbyBVcnN1bGluIDx0dnJ0a28udXJzdWxpbkBpbnRl
bC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMg
IHwgIDQgKystCiAuLi4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMgICAg
fCAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jICAgICAgIHwg
IDYgKystLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMgICAgIHwg
MTYgKysrKysrKy0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wbS5j
ICAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG9vbC5o
ICAgfCAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgICAgICAgICAg
IHwgMTcgKysrKystLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZm
ZXIuYyAgICB8IDI3ICsrKysrKysrKystLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfdGltZWxpbmUuYyAgICAgIHwgIDYgKystLQogLi4uL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF90aW1lbGluZV90eXBlcy5oICAgIHwgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfY29udGV4dC5jICAgIHwgIDcgKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Nl
bGZ0ZXN0X2xyYy5jICAgICAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Fj
dGl2ZS5jICAgICAgICAgICAgfCAgMiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1
ZXN0LmMgICAgICAgICAgIHwgMjggKysrKysrKysrKystLS0tLS0tLQogZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9yZXF1ZXN0LmggICAgICAgICAgIHwgMjIgKysrKysrKysrKysrKystCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jICAgICAgICAgICAgICAgfCAgNCArLS0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jICB8ICA0ICsrLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9zcGlubmVyLmMgIHwgIDIgKy0KIDE4IGZpbGVz
IGNoYW5nZWQsIDEwMCBpbnNlcnRpb25zKCspLCA1NCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfb3ZlcmxheS5jCmluZGV4IDI5ZWRmYzM0MzcxNi4u
ODY3NjhmNTNmYjE4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX292ZXJsYXkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292
ZXJsYXkuYwpAQCAtMjMwLDcgKzIzMCw5IEBAIGFsbG9jX3JlcXVlc3Qoc3RydWN0IGludGVsX292
ZXJsYXkgKm92ZXJsYXksIHZvaWQgKCpmbikoc3RydWN0IGludGVsX292ZXJsYXkgKikpCiAJaWYg
KElTX0VSUihycSkpCiAJCXJldHVybiBycTsKIAotCWVyciA9IGk5MTVfYWN0aXZlX3JlZigmb3Zl
cmxheS0+bGFzdF9mbGlwLCBycS0+dGltZWxpbmUsIHJxKTsKKwllcnIgPSBpOTE1X2FjdGl2ZV9y
ZWYoJm92ZXJsYXktPmxhc3RfZmxpcCwKKwkJCSAgICAgIGk5MTVfcmVxdWVzdF90aW1lbGluZShy
cSksCisJCQkgICAgICBycSk7CiAJaWYgKGVycikgewogCQlpOTE1X3JlcXVlc3RfYWRkKHJxKTsK
IAkJcmV0dXJuIEVSUl9QVFIoZXJyKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fY2xpZW50X2JsdC5jCmluZGV4IGY5OTkyMDY1Mjc1MS4uYjFhM2UwNTg5OGM2IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2JsdC5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0LmMKQEAgLTIx
MSw3ICsyMTEsNyBAQCBzdGF0aWMgdm9pZCBjbGVhcl9wYWdlc193b3JrZXIoc3RydWN0IHdvcmtf
c3RydWN0ICp3b3JrKQogCSAqIGtlZXAgdHJhY2sgb2YgdGhlIEdQVSBhY3Rpdml0eSB3aXRoaW4g
dGhpcyB2bWEvcmVxdWVzdCwgYW5kCiAJICogcHJvcGFnYXRlIHRoZSBzaWduYWwgZnJvbSB0aGUg
cmVxdWVzdCB0byB3LT5kbWEuCiAJICovCi0JZXJyID0gaTkxNV9hY3RpdmVfcmVmKCZ2bWEtPmFj
dGl2ZSwgcnEtPnRpbWVsaW5lLCBycSk7CisJZXJyID0gaTkxNV9hY3RpdmVfcmVmKCZ2bWEtPmFj
dGl2ZSwgaTkxNV9yZXF1ZXN0X3RpbWVsaW5lKHJxKSwgcnEpOwogCWlmIChlcnIpCiAJCWdvdG8g
b3V0X3JlcXVlc3Q7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2NvbnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYwppbmRl
eCBjMDQ5NTgxMWY0OTMuLmMyNmJjMmNlOTgxMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2NvbnRleHQuYwpAQCAtMjk4LDcgKzI5OCw3IEBAIGludCBpbnRlbF9jb250ZXh0X3ByZXBh
cmVfcmVtb3RlX3JlcXVlc3Qoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCS8qIE9ubHkgc3Vp
dGFibGUgZm9yIHVzZSBpbiByZW1vdGVseSBtb2RpZnlpbmcgdGhpcyBjb250ZXh0ICovCiAJR0VN
X0JVR19PTihycS0+aHdfY29udGV4dCA9PSBjZSk7CiAKLQlpZiAocnEtPnRpbWVsaW5lICE9IHRs
KSB7IC8qIGJld2FyZSB0aW1lbGluZSBzaGFyaW5nICovCisJaWYgKHJjdV9hY2Nlc3NfcG9pbnRl
cihycS0+dGltZWxpbmUpICE9IHRsKSB7IC8qIGJld2FyZSB0aW1lbGluZSBzaGFyaW5nICovCiAJ
CWVyciA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZV9uZXN0ZWQoJnRsLT5tdXRleCwKIAkJCQkJ
CSAgICAgIFNJTkdMRV9ERVBUSF9ORVNUSU5HKTsKIAkJaWYgKGVycikKQEAgLTMxOSw3ICszMTks
OSBAQCBpbnQgaW50ZWxfY29udGV4dF9wcmVwYXJlX3JlbW90ZV9yZXF1ZXN0KHN0cnVjdCBpbnRl
bF9jb250ZXh0ICpjZSwKIAkgKiB3b3JkcyB0cmFuc2ZlciB0aGUgcGlubmVkIGNlIG9iamVjdCB0
byB0cmFja2VkIGFjdGl2ZSByZXF1ZXN0LgogCSAqLwogCUdFTV9CVUdfT04oaTkxNV9hY3RpdmVf
aXNfaWRsZSgmY2UtPmFjdGl2ZSkpOwotCXJldHVybiBpOTE1X2FjdGl2ZV9yZWYoJmNlLT5hY3Rp
dmUsIHJxLT50aW1lbGluZSwgcnEpOworCXJldHVybiBpOTE1X2FjdGl2ZV9yZWYoJmNlLT5hY3Rp
dmUsCisJCQkgICAgICAgaTkxNV9yZXF1ZXN0X3RpbWVsaW5lKHJxKSwKKwkJCSAgICAgICBycSk7
CiB9CiAKIHN0cnVjdCBpOTE1X3JlcXVlc3QgKmludGVsX2NvbnRleHRfY3JlYXRlX3JlcXVlc3Qo
c3RydWN0IGludGVsX2NvbnRleHQgKmNlKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9l
bmdpbmVfY3MuYwppbmRleCAzYzE3NmIwZjRiNDUuLjBjNWI5ZTc2YjM5NiAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX2NzLmMKQEAgLTY4MCw2ICs2ODAsOCBAQCBzdGF0
aWMgaW50IG1lYXN1cmVfYnJlYWRjcnVtYl9kdyhzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdp
bmUpCiAJCQkJZW5naW5lLT5zdGF0dXNfcGFnZS52bWEpKQogCQlnb3RvIG91dF9mcmFtZTsKIAor
CW11dGV4X2xvY2soJmZyYW1lLT50aW1lbGluZS5tdXRleCk7CisKIAlmcmFtZS0+cmluZy52YWRk
ciA9IGZyYW1lLT5jczsKIAlmcmFtZS0+cmluZy5zaXplID0gc2l6ZW9mKGZyYW1lLT5jcyk7CiAJ
ZnJhbWUtPnJpbmcuZWZmZWN0aXZlX3NpemUgPSBmcmFtZS0+cmluZy5zaXplOwpAQCAtNjg4LDE4
ICs2OTAsMjIgQEAgc3RhdGljIGludCBtZWFzdXJlX2JyZWFkY3J1bWJfZHcoc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lKQogCWZyYW1lLT5ycS5pOTE1ID0gZW5naW5lLT5pOTE1OwogCWZy
YW1lLT5ycS5lbmdpbmUgPSBlbmdpbmU7CiAJZnJhbWUtPnJxLnJpbmcgPSAmZnJhbWUtPnJpbmc7
Ci0JZnJhbWUtPnJxLnRpbWVsaW5lID0gJmZyYW1lLT50aW1lbGluZTsKKwlyY3VfYXNzaWduX3Bv
aW50ZXIoZnJhbWUtPnJxLnRpbWVsaW5lLCAmZnJhbWUtPnRpbWVsaW5lKTsKIAogCWR3ID0gaW50
ZWxfdGltZWxpbmVfcGluKCZmcmFtZS0+dGltZWxpbmUpOwogCWlmIChkdyA8IDApCiAJCWdvdG8g
b3V0X3RpbWVsaW5lOwogCisJc3Bpbl9sb2NrX2lycSgmZW5naW5lLT5hY3RpdmUubG9jayk7CiAJ
ZHcgPSBlbmdpbmUtPmVtaXRfZmluaV9icmVhZGNydW1iKCZmcmFtZS0+cnEsIGZyYW1lLT5jcykg
LSBmcmFtZS0+Y3M7CisJc3Bpbl91bmxvY2tfaXJxKCZlbmdpbmUtPmFjdGl2ZS5sb2NrKTsKKwog
CUdFTV9CVUdfT04oZHcgJiAxKTsgLyogUklOR19UQUlMIG11c3QgYmUgcXdvcmQgYWxpZ25lZCAq
LwogCiAJaW50ZWxfdGltZWxpbmVfdW5waW4oJmZyYW1lLT50aW1lbGluZSk7CiAKIG91dF90aW1l
bGluZToKKwltdXRleF91bmxvY2soJmZyYW1lLT50aW1lbGluZS5tdXRleCk7CiAJaW50ZWxfdGlt
ZWxpbmVfZmluaSgmZnJhbWUtPnRpbWVsaW5lKTsKIG91dF9mcmFtZToKIAlrZnJlZShmcmFtZSk7
CkBAIC0xMjkwLDEzICsxMjk2LDEzIEBAIHN0YXRpYyB2b2lkIGludGVsX2VuZ2luZV9wcmludF9y
ZWdpc3RlcnMoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAogCQkJaW50IGxlbjsKIAog
CQkJbGVuID0gc25wcmludGYoaGRyLCBzaXplb2YoaGRyKSwKLQkJCQkgICAgICAgIlx0XHRBY3Rp
dmVbJWQ6ICIsCisJCQkJICAgICAgICJcdFx0QWN0aXZlWyVkXTogIiwKIAkJCQkgICAgICAgKGlu
dCkocG9ydCAtIGV4ZWNsaXN0cy0+YWN0aXZlKSk7CiAJCQlpZiAoIWk5MTVfcmVxdWVzdF9zaWdu
YWxlZChycSkpCiAJCQkJbGVuICs9IHNucHJpbnRmKGhkciArIGxlbiwgc2l6ZW9mKGhkcikgLSBs
ZW4sCiAJCQkJCQkicmluZzp7c3RhcnQ6JTA4eCwgaHdzcDolMDh4LCBzZXFubzolMDh4fSwgIiwK
IAkJCQkJCWk5MTVfZ2d0dF9vZmZzZXQocnEtPnJpbmctPnZtYSksCi0JCQkJCQlycS0+dGltZWxp
bmUtPmh3c3Bfb2Zmc2V0LAorCQkJCQkJaTkxNV9yZXF1ZXN0X2FjdGl2ZV90aW1lbGluZShycSkt
Pmh3c3Bfb2Zmc2V0LAogCQkJCQkJaHdzcF9zZXFubyhycSkpOwogCQkJc25wcmludGYoaGRyICsg
bGVuLCBzaXplb2YoaGRyKSAtIGxlbiwgInJxOiAiKTsKIAkJCXByaW50X3JlcXVlc3QobSwgcnEs
IGhkcik7CkBAIC0xMzA4LDcgKzEzMTQsNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9lbmdpbmVfcHJp
bnRfcmVnaXN0ZXJzKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKIAkJCQkgIlx0XHRQ
ZW5kaW5nWyVkXSByaW5nOntzdGFydDolMDh4LCBod3NwOiUwOHgsIHNlcW5vOiUwOHh9LCBycTog
IiwKIAkJCQkgKGludCkocG9ydCAtIGV4ZWNsaXN0cy0+cGVuZGluZyksCiAJCQkJIGk5MTVfZ2d0
dF9vZmZzZXQocnEtPnJpbmctPnZtYSksCi0JCQkJIHJxLT50aW1lbGluZS0+aHdzcF9vZmZzZXQs
CisJCQkJIGk5MTVfcmVxdWVzdF9hY3RpdmVfdGltZWxpbmUocnEpLT5od3NwX29mZnNldCwKIAkJ
CQkgaHdzcF9zZXFubyhycSkpOwogCQkJcHJpbnRfcmVxdWVzdChtLCBycSwgaGRyKTsKIAkJfQpA
QCAtMTQwMSw3ICsxNDA3LDcgQEAgdm9pZCBpbnRlbF9lbmdpbmVfZHVtcChzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmUsCiAJCWRybV9wcmludGYobSwgIlx0XHRyaW5nLT5zcGFjZTogIDB4
JTA4eFxuIiwKIAkJCSAgIHJxLT5yaW5nLT5zcGFjZSk7CiAJCWRybV9wcmludGYobSwgIlx0XHRy
aW5nLT5od3NwOiAgIDB4JTA4eFxuIiwKLQkJCSAgIHJxLT50aW1lbGluZS0+aHdzcF9vZmZzZXQp
OworCQkJICAgaTkxNV9yZXF1ZXN0X2FjdGl2ZV90aW1lbGluZShycSktPmh3c3Bfb2Zmc2V0KTsK
IAogCQlwcmludF9yZXF1ZXN0X3JpbmcobSwgcnEpOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2VuZ2luZV9wbS5jCmluZGV4IDY1YjVjYTc0YjM5NC4uY2U2MWM4M2Q2OGU5IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfcG0uYwpAQCAtMTAzLDcgKzEwMyw3
IEBAIHN0YXRpYyBib29sIHN3aXRjaF90b19rZXJuZWxfY29udGV4dChzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmUpCiAJCS8qIENvbnRleHQgc3dpdGNoIGZhaWxlZCwgaG9wZSBmb3IgdGhl
IGJlc3QhIE1heWJlIHJlc2V0PyAqLwogCQlnb3RvIG91dF91bmxvY2s7CiAKLQlpbnRlbF90aW1l
bGluZV9lbnRlcihycS0+dGltZWxpbmUpOworCWludGVsX3RpbWVsaW5lX2VudGVyKGk5MTVfcmVx
dWVzdF90aW1lbGluZShycSkpOwogCiAJLyogQ2hlY2sgYWdhaW4gb24gdGhlIG5leHQgcmV0aXJl
bWVudC4gKi8KIAllbmdpbmUtPndha2VyZWZfc2VyaWFsID0gZW5naW5lLT5zZXJpYWwgKyAxOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3Bvb2wuaCBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9wb29sLmgKaW5kZXggN2UyMTIz
YjMzNTk0Li5lM2UzOWU2MTk5MTkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0
L2ludGVsX2VuZ2luZV9wb29sLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxf
ZW5naW5lX3Bvb2wuaApAQCAtMTgsNyArMTgsNyBAQCBzdGF0aWMgaW5saW5lIGludAogaW50ZWxf
ZW5naW5lX3Bvb2xfbWFya19hY3RpdmUoc3RydWN0IGludGVsX2VuZ2luZV9wb29sX25vZGUgKm5v
ZGUsCiAJCQkgICAgICBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKLQlyZXR1cm4gaTkxNV9h
Y3RpdmVfcmVmKCZub2RlLT5hY3RpdmUsIHJxLT50aW1lbGluZSwgcnEpOworCXJldHVybiBpOTE1
X2FjdGl2ZV9yZWYoJm5vZGUtPmFjdGl2ZSwgaTkxNV9yZXF1ZXN0X3RpbWVsaW5lKHJxKSwgcnEp
OwogfQogCiBzdGF0aWMgaW5saW5lIHZvaWQKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2d0L2ludGVsX2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMK
aW5kZXggYTk5MTY2YTJkMmViLi5hYzIxNTg3Yjc1ZjYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2xyYy5jCkBAIC0xODI1LDcgKzE4MjUsNyBAQCBzdGF0aWMgaW50IGdlbjhfZW1pdF9pbml0
X2JyZWFkY3J1bWIoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7CiAJdTMyICpjczsKIAotCUdF
TV9CVUdfT04oIXJxLT50aW1lbGluZS0+aGFzX2luaXRpYWxfYnJlYWRjcnVtYik7CisJR0VNX0JV
R19PTighaTkxNV9yZXF1ZXN0X3RpbWVsaW5lKHJxKS0+aGFzX2luaXRpYWxfYnJlYWRjcnVtYik7
CiAKIAljcyA9IGludGVsX3JpbmdfYmVnaW4ocnEsIDYpOwogCWlmIChJU19FUlIoY3MpKQpAQCAt
MTg0MSw3ICsxODQxLDcgQEAgc3RhdGljIGludCBnZW44X2VtaXRfaW5pdF9icmVhZGNydW1iKHN0
cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCSpjcysrID0gTUlfTk9PUDsKIAogCSpjcysrID0gTUlf
U1RPUkVfRFdPUkRfSU1NX0dFTjQgfCBNSV9VU0VfR0dUVDsKLQkqY3MrKyA9IHJxLT50aW1lbGlu
ZS0+aHdzcF9vZmZzZXQ7CisJKmNzKysgPSBpOTE1X3JlcXVlc3RfdGltZWxpbmUocnEpLT5od3Nw
X29mZnNldDsKIAkqY3MrKyA9IDA7CiAJKmNzKysgPSBycS0+ZmVuY2Uuc2Vxbm8gLSAxOwogCkBA
IC0yMzI0LDcgKzIzMjQsOCBAQCBzdGF0aWMgdm9pZCByZXNldF9jc2JfcG9pbnRlcnMoc3RydWN0
IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogCiBzdGF0aWMgc3RydWN0IGk5MTVfcmVxdWVzdCAq
YWN0aXZlX3JlcXVlc3Qoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7Ci0JY29uc3Qgc3RydWN0
IGxpc3RfaGVhZCAqIGNvbnN0IGxpc3QgPSAmcnEtPnRpbWVsaW5lLT5yZXF1ZXN0czsKKwljb25z
dCBzdHJ1Y3QgbGlzdF9oZWFkICogY29uc3QgbGlzdCA9CisJCSZpOTE1X3JlcXVlc3RfYWN0aXZl
X3RpbWVsaW5lKHJxKS0+cmVxdWVzdHM7CiAJY29uc3Qgc3RydWN0IGludGVsX2NvbnRleHQgKiBj
b25zdCBjZSA9IHJxLT5od19jb250ZXh0OwogCXN0cnVjdCBpOTE1X3JlcXVlc3QgKmFjdGl2ZSA9
IE5VTEw7CiAKQEAgLTI4NTUsNyArMjg1Niw3IEBAIHN0YXRpYyB1MzIgKmdlbjhfZW1pdF9maW5p
X2JyZWFkY3J1bWIoc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdCwgdTMyICpjcykKIHsKIAlj
cyA9IGdlbjhfZW1pdF9nZ3R0X3dyaXRlKGNzLAogCQkJCSAgcmVxdWVzdC0+ZmVuY2Uuc2Vxbm8s
Ci0JCQkJICByZXF1ZXN0LT50aW1lbGluZS0+aHdzcF9vZmZzZXQsCisJCQkJICBpOTE1X3JlcXVl
c3RfYWN0aXZlX3RpbWVsaW5lKHJlcXVlc3QpLT5od3NwX29mZnNldCwKIAkJCQkgIDApOwogCiAJ
cmV0dXJuIGdlbjhfZW1pdF9maW5pX2JyZWFkY3J1bWJfZm9vdGVyKHJlcXVlc3QsIGNzKTsKQEAg
LTI4NzIsNyArMjg3Myw3IEBAIHN0YXRpYyB1MzIgKmdlbjhfZW1pdF9maW5pX2JyZWFkY3J1bWJf
cmNzKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QsIHUzMiAqY3MpCiAJLyogWFhYIGZsdXNo
K3dyaXRlK0NTX1NUQUxMIGFsbCBpbiBvbmUgdXBzZXRzIGdlbV9jb25jdXJyZW50X2JsdDprYmwg
Ki8KIAljcyA9IGdlbjhfZW1pdF9nZ3R0X3dyaXRlX3JjcyhjcywKIAkJCQkgICAgICByZXF1ZXN0
LT5mZW5jZS5zZXFubywKLQkJCQkgICAgICByZXF1ZXN0LT50aW1lbGluZS0+aHdzcF9vZmZzZXQs
CisJCQkJICAgICAgaTkxNV9yZXF1ZXN0X2FjdGl2ZV90aW1lbGluZShyZXF1ZXN0KS0+aHdzcF9v
ZmZzZXQsCiAJCQkJICAgICAgUElQRV9DT05UUk9MX0ZMVVNIX0VOQUJMRSB8CiAJCQkJICAgICAg
UElQRV9DT05UUk9MX0NTX1NUQUxMKTsKIApAQCAtMjg4NCw3ICsyODg1LDcgQEAgZ2VuMTFfZW1p
dF9maW5pX2JyZWFkY3J1bWJfcmNzKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QsIHUzMiAq
Y3MpCiB7CiAJY3MgPSBnZW44X2VtaXRfZ2d0dF93cml0ZV9yY3MoY3MsCiAJCQkJICAgICAgcmVx
dWVzdC0+ZmVuY2Uuc2Vxbm8sCi0JCQkJICAgICAgcmVxdWVzdC0+dGltZWxpbmUtPmh3c3Bfb2Zm
c2V0LAorCQkJCSAgICAgIGk5MTVfcmVxdWVzdF9hY3RpdmVfdGltZWxpbmUocmVxdWVzdCktPmh3
c3Bfb2Zmc2V0LAogCQkJCSAgICAgIFBJUEVfQ09OVFJPTF9DU19TVEFMTCB8CiAJCQkJICAgICAg
UElQRV9DT05UUk9MX1RJTEVfQ0FDSEVfRkxVU0ggfAogCQkJCSAgICAgIFBJUEVfQ09OVFJPTF9S
RU5ERVJfVEFSR0VUX0NBQ0hFX0ZMVVNIIHwKQEAgLTI5NDgsNyArMjk0OSw3IEBAIHN0YXRpYyB1
MzIgKmdlbjEyX2VtaXRfZmluaV9icmVhZGNydW1iKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVl
c3QsIHUzMiAqY3MpCiB7CiAJY3MgPSBnZW44X2VtaXRfZ2d0dF93cml0ZShjcywKIAkJCQkgIHJl
cXVlc3QtPmZlbmNlLnNlcW5vLAotCQkJCSAgcmVxdWVzdC0+dGltZWxpbmUtPmh3c3Bfb2Zmc2V0
LAorCQkJCSAgaTkxNV9yZXF1ZXN0X2FjdGl2ZV90aW1lbGluZShyZXF1ZXN0KS0+aHdzcF9vZmZz
ZXQsCiAJCQkJICAwKTsKIAogCXJldHVybiBnZW4xMl9lbWl0X2ZpbmlfYnJlYWRjcnVtYl9mb290
ZXIocmVxdWVzdCwgY3MpOwpAQCAtMjk1OSw3ICsyOTYwLDcgQEAgZ2VuMTJfZW1pdF9maW5pX2Jy
ZWFkY3J1bWJfcmNzKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QsIHUzMiAqY3MpCiB7CiAJ
Y3MgPSBnZW44X2VtaXRfZ2d0dF93cml0ZV9yY3MoY3MsCiAJCQkJICAgICAgcmVxdWVzdC0+ZmVu
Y2Uuc2Vxbm8sCi0JCQkJICAgICAgcmVxdWVzdC0+dGltZWxpbmUtPmh3c3Bfb2Zmc2V0LAorCQkJ
CSAgICAgIGk5MTVfcmVxdWVzdF9hY3RpdmVfdGltZWxpbmUocmVxdWVzdCktPmh3c3Bfb2Zmc2V0
LAogCQkJCSAgICAgIFBJUEVfQ09OVFJPTF9DU19TVEFMTCB8CiAJCQkJICAgICAgUElQRV9DT05U
Uk9MX1RJTEVfQ0FDSEVfRkxVU0ggfAogCQkJCSAgICAgIFBJUEVfQ09OVFJPTF9SRU5ERVJfVEFS
R0VUX0NBQ0hFX0ZMVVNIIHwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX3JpbmdidWZmZXIuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZm
ZXIuYwppbmRleCBhMjViODRiMTJlZjEuLjA3NDdiOGM5Zjc2OCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmluZ2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYwpAQCAtMzIyLDcgKzMyMiw4IEBAIHN0YXRpYyB1
MzIgKmdlbjZfcmNzX2VtaXRfYnJlYWRjcnVtYihzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgdTMy
ICpjcykKIAkJIFBJUEVfQ09OVFJPTF9EQ19GTFVTSF9FTkFCTEUgfAogCQkgUElQRV9DT05UUk9M
X1FXX1dSSVRFIHwKIAkJIFBJUEVfQ09OVFJPTF9DU19TVEFMTCk7Ci0JKmNzKysgPSBycS0+dGlt
ZWxpbmUtPmh3c3Bfb2Zmc2V0IHwgUElQRV9DT05UUk9MX0dMT0JBTF9HVFQ7CisJKmNzKysgPSBp
OTE1X3JlcXVlc3RfYWN0aXZlX3RpbWVsaW5lKHJxKS0+aHdzcF9vZmZzZXQgfAorCQlQSVBFX0NP
TlRST0xfR0xPQkFMX0dUVDsKIAkqY3MrKyA9IHJxLT5mZW5jZS5zZXFubzsKIAogCSpjcysrID0g
TUlfVVNFUl9JTlRFUlJVUFQ7CkBAIC00MjUsNyArNDI2LDcgQEAgc3RhdGljIHUzMiAqZ2VuN19y
Y3NfZW1pdF9icmVhZGNydW1iKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCB1MzIgKmNzKQogCQkg
UElQRV9DT05UUk9MX1FXX1dSSVRFIHwKIAkJIFBJUEVfQ09OVFJPTF9HTE9CQUxfR1RUX0lWQiB8
CiAJCSBQSVBFX0NPTlRST0xfQ1NfU1RBTEwpOwotCSpjcysrID0gcnEtPnRpbWVsaW5lLT5od3Nw
X29mZnNldDsKKwkqY3MrKyA9IGk5MTVfcmVxdWVzdF9hY3RpdmVfdGltZWxpbmUocnEpLT5od3Nw
X29mZnNldDsKIAkqY3MrKyA9IHJxLT5mZW5jZS5zZXFubzsKIAogCSpjcysrID0gTUlfVVNFUl9J
TlRFUlJVUFQ7CkBAIC00MzksOCArNDQwLDggQEAgc3RhdGljIHUzMiAqZ2VuN19yY3NfZW1pdF9i
cmVhZGNydW1iKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCB1MzIgKmNzKQogCiBzdGF0aWMgdTMy
ICpnZW42X3hjc19lbWl0X2JyZWFkY3J1bWIoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsIHUzMiAq
Y3MpCiB7Ci0JR0VNX0JVR19PTihycS0+dGltZWxpbmUtPmh3c3BfZ2d0dCAhPSBycS0+ZW5naW5l
LT5zdGF0dXNfcGFnZS52bWEpOwotCUdFTV9CVUdfT04ob2Zmc2V0X2luX3BhZ2UocnEtPnRpbWVs
aW5lLT5od3NwX29mZnNldCkgIT0gSTkxNV9HRU1fSFdTX1NFUU5PX0FERFIpOworCUdFTV9CVUdf
T04oaTkxNV9yZXF1ZXN0X2FjdGl2ZV90aW1lbGluZShycSktPmh3c3BfZ2d0dCAhPSBycS0+ZW5n
aW5lLT5zdGF0dXNfcGFnZS52bWEpOworCUdFTV9CVUdfT04ob2Zmc2V0X2luX3BhZ2UoaTkxNV9y
ZXF1ZXN0X2FjdGl2ZV90aW1lbGluZShycSktPmh3c3Bfb2Zmc2V0KSAhPSBJOTE1X0dFTV9IV1Nf
U0VRTk9fQUREUik7CiAKIAkqY3MrKyA9IE1JX0ZMVVNIX0RXIHwgTUlfRkxVU0hfRFdfT1BfU1RP
UkVEVyB8IE1JX0ZMVVNIX0RXX1NUT1JFX0lOREVYOwogCSpjcysrID0gSTkxNV9HRU1fSFdTX1NF
UU5PX0FERFIgfCBNSV9GTFVTSF9EV19VU0VfR1RUOwpAQCAtNDU5LDggKzQ2MCw4IEBAIHN0YXRp
YyB1MzIgKmdlbjdfeGNzX2VtaXRfYnJlYWRjcnVtYihzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwg
dTMyICpjcykKIHsKIAlpbnQgaTsKIAotCUdFTV9CVUdfT04ocnEtPnRpbWVsaW5lLT5od3NwX2dn
dHQgIT0gcnEtPmVuZ2luZS0+c3RhdHVzX3BhZ2Uudm1hKTsKLQlHRU1fQlVHX09OKG9mZnNldF9p
bl9wYWdlKHJxLT50aW1lbGluZS0+aHdzcF9vZmZzZXQpICE9IEk5MTVfR0VNX0hXU19TRVFOT19B
RERSKTsKKwlHRU1fQlVHX09OKGk5MTVfcmVxdWVzdF9hY3RpdmVfdGltZWxpbmUocnEpLT5od3Nw
X2dndHQgIT0gcnEtPmVuZ2luZS0+c3RhdHVzX3BhZ2Uudm1hKTsKKwlHRU1fQlVHX09OKG9mZnNl
dF9pbl9wYWdlKGk5MTVfcmVxdWVzdF9hY3RpdmVfdGltZWxpbmUocnEpLT5od3NwX29mZnNldCkg
IT0gSTkxNV9HRU1fSFdTX1NFUU5PX0FERFIpOwogCiAJKmNzKysgPSBNSV9GTFVTSF9EVyB8IE1J
X0ZMVVNIX0RXX09QX1NUT1JFRFcgfCBNSV9GTFVTSF9EV19TVE9SRV9JTkRFWDsKIAkqY3MrKyA9
IEk5MTVfR0VNX0hXU19TRVFOT19BRERSIHwgTUlfRkxVU0hfRFdfVVNFX0dUVDsKQEAgLTkzOCw4
ICs5MzksOCBAQCBzdGF0aWMgdm9pZCBpOXh4X3N1Ym1pdF9yZXF1ZXN0KHN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJlcXVlc3QpCiAKIHN0YXRpYyB1MzIgKmk5eHhfZW1pdF9icmVhZGNydW1iKHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxLCB1MzIgKmNzKQogewotCUdFTV9CVUdfT04ocnEtPnRpbWVsaW5l
LT5od3NwX2dndHQgIT0gcnEtPmVuZ2luZS0+c3RhdHVzX3BhZ2Uudm1hKTsKLQlHRU1fQlVHX09O
KG9mZnNldF9pbl9wYWdlKHJxLT50aW1lbGluZS0+aHdzcF9vZmZzZXQpICE9IEk5MTVfR0VNX0hX
U19TRVFOT19BRERSKTsKKwlHRU1fQlVHX09OKGk5MTVfcmVxdWVzdF9hY3RpdmVfdGltZWxpbmUo
cnEpLT5od3NwX2dndHQgIT0gcnEtPmVuZ2luZS0+c3RhdHVzX3BhZ2Uudm1hKTsKKwlHRU1fQlVH
X09OKG9mZnNldF9pbl9wYWdlKGk5MTVfcmVxdWVzdF9hY3RpdmVfdGltZWxpbmUocnEpLT5od3Nw
X29mZnNldCkgIT0gSTkxNV9HRU1fSFdTX1NFUU5PX0FERFIpOwogCiAJKmNzKysgPSBNSV9GTFVT
SDsKIApAQCAtOTYxLDggKzk2Miw4IEBAIHN0YXRpYyB1MzIgKmdlbjVfZW1pdF9icmVhZGNydW1i
KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCB1MzIgKmNzKQogewogCWludCBpOwogCi0JR0VNX0JV
R19PTihycS0+dGltZWxpbmUtPmh3c3BfZ2d0dCAhPSBycS0+ZW5naW5lLT5zdGF0dXNfcGFnZS52
bWEpOwotCUdFTV9CVUdfT04ob2Zmc2V0X2luX3BhZ2UocnEtPnRpbWVsaW5lLT5od3NwX29mZnNl
dCkgIT0gSTkxNV9HRU1fSFdTX1NFUU5PX0FERFIpOworCUdFTV9CVUdfT04oaTkxNV9yZXF1ZXN0
X2FjdGl2ZV90aW1lbGluZShycSktPmh3c3BfZ2d0dCAhPSBycS0+ZW5naW5lLT5zdGF0dXNfcGFn
ZS52bWEpOworCUdFTV9CVUdfT04ob2Zmc2V0X2luX3BhZ2UoaTkxNV9yZXF1ZXN0X2FjdGl2ZV90
aW1lbGluZShycSktPmh3c3Bfb2Zmc2V0KSAhPSBJOTE1X0dFTV9IV1NfU0VRTk9fQUREUik7CiAK
IAkqY3MrKyA9IE1JX0ZMVVNIOwogCkBAIC0xODE1LDcgKzE4MTYsNyBAQCBzdGF0aWMgaW50IHJp
bmdfcmVxdWVzdF9hbGxvYyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0KQogCWludCByZXQ7
CiAKIAlHRU1fQlVHX09OKCFpbnRlbF9jb250ZXh0X2lzX3Bpbm5lZChyZXF1ZXN0LT5od19jb250
ZXh0KSk7Ci0JR0VNX0JVR19PTihyZXF1ZXN0LT50aW1lbGluZS0+aGFzX2luaXRpYWxfYnJlYWRj
cnVtYik7CisJR0VNX0JVR19PTihpOTE1X3JlcXVlc3RfdGltZWxpbmUocmVxdWVzdCktPmhhc19p
bml0aWFsX2JyZWFkY3J1bWIpOwogCiAJLyoKIAkgKiBGbHVzaCBlbm91Z2ggc3BhY2UgdG8gcmVk
dWNlIHRoZSBsaWtlbGlob29kIG9mIHdhaXRpbmcgYWZ0ZXIKQEAgLTE5MjYsNyArMTkyNyw5IEBA
IHUzMiAqaW50ZWxfcmluZ19iZWdpbihzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgdW5zaWduZWQg
aW50IG51bV9kd29yZHMpCiAJCSAqLwogCQlHRU1fQlVHX09OKCFycS0+cmVzZXJ2ZWRfc3BhY2Up
OwogCi0JCXJldCA9IHdhaXRfZm9yX3NwYWNlKHJpbmcsIHJxLT50aW1lbGluZSwgdG90YWxfYnl0
ZXMpOworCQlyZXQgPSB3YWl0X2Zvcl9zcGFjZShyaW5nLAorCQkJCSAgICAgaTkxNV9yZXF1ZXN0
X3RpbWVsaW5lKHJxKSwKKwkJCQkgICAgIHRvdGFsX2J5dGVzKTsKIAkJaWYgKHVubGlrZWx5KHJl
dCkpCiAJCQlyZXR1cm4gRVJSX1BUUihyZXQpOwogCX0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF90aW1lbGluZS5jCmluZGV4IDljYjAxZDk4MjhmMS4uMmNlODFiZGY3Zjg2IDEwMDY0NAot
LS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF90aW1lbGluZS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lLmMKQEAgLTQ5Myw3ICs0OTMsNyBAQCBp
bnQgaW50ZWxfdGltZWxpbmVfZ2V0X3NlcW5vKHN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwsCiBz
dGF0aWMgaW50IGNhY2hlbGluZV9yZWYoc3RydWN0IGludGVsX3RpbWVsaW5lX2NhY2hlbGluZSAq
Y2wsCiAJCQkgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiB7Ci0JcmV0dXJuIGk5MTVfYWN0aXZl
X3JlZigmY2wtPmFjdGl2ZSwgcnEtPnRpbWVsaW5lLCBycSk7CisJcmV0dXJuIGk5MTVfYWN0aXZl
X3JlZigmY2wtPmFjdGl2ZSwgaTkxNV9yZXF1ZXN0X3RpbWVsaW5lKHJxKSwgcnEpOwogfQogCiBp
bnQgaW50ZWxfdGltZWxpbmVfcmVhZF9od3NwKHN0cnVjdCBpOTE1X3JlcXVlc3QgKmZyb20sCkBA
IC01MDQsNyArNTA0LDcgQEAgaW50IGludGVsX3RpbWVsaW5lX3JlYWRfaHdzcChzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICpmcm9tLAogCXN0cnVjdCBpbnRlbF90aW1lbGluZSAqdGwgPSBmcm9tLT50aW1l
bGluZTsKIAlpbnQgZXJyOwogCi0JR0VNX0JVR19PTih0by0+dGltZWxpbmUgPT0gdGwpOworCUdF
TV9CVUdfT04ocmN1X2FjY2Vzc19wb2ludGVyKHRvLT50aW1lbGluZSkgPT0gdGwpOwogCiAJbXV0
ZXhfbG9ja19uZXN0ZWQoJnRsLT5tdXRleCwgU0lOR0xFX0RFUFRIX05FU1RJTkcpOwogCWVyciA9
IGk5MTVfcmVxdWVzdF9jb21wbGV0ZWQoZnJvbSk7CkBAIC01NDEsNyArNTQxLDcgQEAgdm9pZCBf
X2ludGVsX3RpbWVsaW5lX2ZyZWUoc3RydWN0IGtyZWYgKmtyZWYpCiAJCWNvbnRhaW5lcl9vZihr
cmVmLCB0eXBlb2YoKnRpbWVsaW5lKSwga3JlZik7CiAKIAlpbnRlbF90aW1lbGluZV9maW5pKHRp
bWVsaW5lKTsKLQlrZnJlZSh0aW1lbGluZSk7CisJa2ZyZWVfcmN1KHRpbWVsaW5lLCByY3UpOwog
fQogCiBzdGF0aWMgdm9pZCB0aW1lbGluZXNfZmluaShzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfdGltZWxpbmVfdHlwZXMuaCBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3RpbWVsaW5lX3R5cGVzLmgKaW5kZXggMmIx
YmFmMmZjYzhlLi5jNjY4YzRjNTBlNzUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L2ludGVsX3RpbWVsaW5lX3R5cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
aW50ZWxfdGltZWxpbmVfdHlwZXMuaApAQCAtODAsNiArODAsNyBAQCBzdHJ1Y3QgaW50ZWxfdGlt
ZWxpbmUgewogCXN0cnVjdCBpbnRlbF9ndCAqZ3Q7CiAKIAlzdHJ1Y3Qga3JlZiBrcmVmOworCXN0
cnVjdCByY3VfaGVhZCByY3U7CiB9OwogCiAjZW5kaWYgLyogX19JOTE1X1RJTUVMSU5FX1RZUEVT
X0hfXyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29u
dGV4dC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfY29udGV4dC5jCmluZGV4
IDlkMWVhMjZjN2EyZC4uNWUyZTM5MDAzNmZmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfY29udGV4dC5jCkBAIC0yNCw5ICsyNCwxMiBAQCBzdGF0aWMgaW50IHJlcXVlc3Rf
c3luYyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAlpZiAodGltZW91dCA8IDApIHsKIAkJZXJy
ID0gdGltZW91dDsKIAl9IGVsc2UgewotCQltdXRleF9sb2NrKCZycS0+dGltZWxpbmUtPm11dGV4
KTsKKwkJc3RydWN0IGludGVsX3RpbWVsaW5lICp0bCA9CisJCQlyY3VfZGVyZWZlcmVuY2VfcHJv
dGVjdGVkKHJxLT50aW1lbGluZSwgdHJ1ZSk7CisKKwkJbXV0ZXhfbG9jaygmdGwtPm11dGV4KTsK
IAkJaTkxNV9yZXF1ZXN0X3JldGlyZV91cHRvKHJxKTsKLQkJbXV0ZXhfdW5sb2NrKCZycS0+dGlt
ZWxpbmUtPm11dGV4KTsKKwkJbXV0ZXhfdW5sb2NrKCZ0bC0+bXV0ZXgpOwogCX0KIAogCWk5MTVf
cmVxdWVzdF9wdXQocnEpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwppbmRl
eCAyNmQwNWJkMWJkYzguLjkzYTg3MWJmZDk1ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfbHJjLmMKQEAgLTEwODksNyArMTA4OSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9zdXBwcmVz
c193YWl0X3ByZWVtcHQodm9pZCAqYXJnKQogCQkJCX0KIAogCQkJCS8qIERpc2FibGUgTkVXQ0xJ
RU5UIHByb21vdGlvbiAqLwotCQkJCV9faTkxNV9hY3RpdmVfcmVxdWVzdF9zZXQoJnJxW2ldLT50
aW1lbGluZS0+bGFzdF9yZXF1ZXN0LAorCQkJCV9faTkxNV9hY3RpdmVfcmVxdWVzdF9zZXQoJmk5
MTVfcmVxdWVzdF90aW1lbGluZShycVtpXSktPmxhc3RfcmVxdWVzdCwKIAkJCQkJCQkgIGR1bW15
KTsKIAkJCQlpOTE1X3JlcXVlc3RfYWRkKHJxW2ldKTsKIAkJCX0KZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2FjdGl2ZS5jCmluZGV4IDZhNDQ3ZjFkMDExMC4uZDVhYWM2ZmY4MDNhIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfYWN0aXZlLmMKQEAgLTY5NSw3ICs2OTUsNyBAQCB2b2lkIGk5MTVfcmVxdWVzdF9h
ZGRfYWN0aXZlX2JhcnJpZXJzKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogCXN0cnVjdCBsbGlz
dF9ub2RlICpub2RlLCAqbmV4dDsKIAogCUdFTV9CVUdfT04oaW50ZWxfZW5naW5lX2lzX3ZpcnR1
YWwoZW5naW5lKSk7Ci0JR0VNX0JVR19PTihycS0+dGltZWxpbmUgIT0gZW5naW5lLT5rZXJuZWxf
Y29udGV4dC0+dGltZWxpbmUpOworCUdFTV9CVUdfT04oaTkxNV9yZXF1ZXN0X3RpbWVsaW5lKHJx
KSAhPSBlbmdpbmUtPmtlcm5lbF9jb250ZXh0LT50aW1lbGluZSk7CiAKIAkvKgogCSAqIEF0dGFj
aCB0aGUgbGlzdCBvZiBwcm90by1mZW5jZXMgdG8gdGhlIGluLWZsaWdodCByZXF1ZXN0IHN1Y2gK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmMKaW5kZXggNjA2YWNkZTQ3ZmEwLi5mYjZmMjFj
NDE5MzQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCkBAIC0yMjAsNyArMjIwLDYg
QEAgc3RhdGljIGJvb2wgaTkxNV9yZXF1ZXN0X3JldGlyZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
cSkKIHsKIAlzdHJ1Y3QgaTkxNV9hY3RpdmVfcmVxdWVzdCAqYWN0aXZlLCAqbmV4dDsKIAotCWxv
Y2tkZXBfYXNzZXJ0X2hlbGQoJnJxLT50aW1lbGluZS0+bXV0ZXgpOwogCWlmICghaTkxNV9yZXF1
ZXN0X2NvbXBsZXRlZChycSkpCiAJCXJldHVybiBmYWxzZTsKIApAQCAtMjQxLDcgKzI0MCw4IEBA
IHN0YXRpYyBib29sIGk5MTVfcmVxdWVzdF9yZXRpcmUoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEp
CiAJICogTm90ZSB0aGlzIHJlcXVpcmVzIHRoYXQgd2UgYXJlIGFsd2F5cyBjYWxsZWQgaW4gcmVx
dWVzdAogCSAqIGNvbXBsZXRpb24gb3JkZXIuCiAJICovCi0JR0VNX0JVR19PTighbGlzdF9pc19m
aXJzdCgmcnEtPmxpbmssICZycS0+dGltZWxpbmUtPnJlcXVlc3RzKSk7CisJR0VNX0JVR19PTigh
bGlzdF9pc19maXJzdCgmcnEtPmxpbmssCisJCQkJICAmaTkxNV9yZXF1ZXN0X3RpbWVsaW5lKHJx
KS0+cmVxdWVzdHMpKTsKIAlycS0+cmluZy0+aGVhZCA9IHJxLT5wb3N0Zml4OwogCiAJLyoKQEAg
LTMxNyw3ICszMTcsNyBAQCBzdGF0aWMgYm9vbCBpOTE1X3JlcXVlc3RfcmV0aXJlKHN0cnVjdCBp
OTE1X3JlcXVlc3QgKnJxKQogCiB2b2lkIGk5MTVfcmVxdWVzdF9yZXRpcmVfdXB0byhzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycSkKIHsKLQlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKiBjb25zdCB0bCA9
IHJxLT50aW1lbGluZTsKKwlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKiBjb25zdCB0bCA9IGk5MTVf
cmVxdWVzdF90aW1lbGluZShycSk7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqdG1wOwogCiAJR0VN
X1RSQUNFKCIlcyBmZW5jZSAlbGx4OiVsbGQsIGN1cnJlbnQgJWRcbiIsCkBAIC0zMjUsNyArMzI1
LDYgQEAgdm9pZCBpOTE1X3JlcXVlc3RfcmV0aXJlX3VwdG8oc3RydWN0IGk5MTVfcmVxdWVzdCAq
cnEpCiAJCSAgcnEtPmZlbmNlLmNvbnRleHQsIHJxLT5mZW5jZS5zZXFubywKIAkJICBod3NwX3Nl
cW5vKHJxKSk7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ0bC0+bXV0ZXgpOwogCUdFTV9CVUdf
T04oIWk5MTVfcmVxdWVzdF9jb21wbGV0ZWQocnEpKTsKIAogCWRvIHsKQEAgLTY2MSw5ICs2NjAs
MTEgQEAgX19pOTE1X3JlcXVlc3RfY3JlYXRlKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwgZ2Zw
X3QgZ2ZwKQogCXJxLT5nZW1fY29udGV4dCA9IGNlLT5nZW1fY29udGV4dDsKIAlycS0+ZW5naW5l
ID0gY2UtPmVuZ2luZTsKIAlycS0+cmluZyA9IGNlLT5yaW5nOwotCXJxLT50aW1lbGluZSA9IHRs
OworCisJcmN1X2Fzc2lnbl9wb2ludGVyKHJxLT50aW1lbGluZSwgdGwpOwogCXJxLT5od3NwX3Nl
cW5vID0gdGwtPmh3c3Bfc2Vxbm87CiAJcnEtPmh3c3BfY2FjaGVsaW5lID0gdGwtPmh3c3BfY2Fj
aGVsaW5lOworCiAJcnEtPnJjdXN0YXRlID0gZ2V0X3N0YXRlX3N5bmNocm9uaXplX3JjdSgpOyAv
KiBhY3RzIGFzIHNtcF9tYigpICovCiAKIAlzcGluX2xvY2tfaW5pdCgmcnEtPmxvY2spOwpAQCAt
NzcxLDcgKzc3Miw4IEBAIGk5MTVfcmVxdWVzdF9hd2FpdF9zdGFydChzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycSwgc3RydWN0IGk5MTVfcmVxdWVzdCAqc2lnbmFsKQogCQlyZXR1cm4gMDsKIAogCXNp
Z25hbCA9IGxpc3RfcHJldl9lbnRyeShzaWduYWwsIGxpbmspOwotCWlmIChpbnRlbF90aW1lbGlu
ZV9zeW5jX2lzX2xhdGVyKHJxLT50aW1lbGluZSwgJnNpZ25hbC0+ZmVuY2UpKQorCWlmIChpbnRl
bF90aW1lbGluZV9zeW5jX2lzX2xhdGVyKGk5MTVfcmVxdWVzdF90aW1lbGluZShycSksCisJCQkJ
CSAmc2lnbmFsLT5mZW5jZSkpCiAJCXJldHVybiAwOwogCiAJcmV0dXJuIGk5MTVfc3dfZmVuY2Vf
YXdhaXRfZG1hX2ZlbmNlKCZycS0+c3VibWl0LApAQCAtOTQ3LDcgKzk0OSw4IEBAIGk5MTVfcmVx
dWVzdF9hd2FpdF9kbWFfZmVuY2Uoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsIHN0cnVjdCBkbWFf
ZmVuY2UgKmZlbmNlKQogCiAJCS8qIFNxdWFzaCByZXBlYXRlZCB3YWl0cyB0byB0aGUgc2FtZSB0
aW1lbGluZXMgKi8KIAkJaWYgKGZlbmNlLT5jb250ZXh0ICYmCi0JCSAgICBpbnRlbF90aW1lbGlu
ZV9zeW5jX2lzX2xhdGVyKHJxLT50aW1lbGluZSwgZmVuY2UpKQorCQkgICAgaW50ZWxfdGltZWxp
bmVfc3luY19pc19sYXRlcihpOTE1X3JlcXVlc3RfdGltZWxpbmUocnEpLAorCQkJCQkJIGZlbmNl
KSkKIAkJCWNvbnRpbnVlOwogCiAJCWlmIChkbWFfZmVuY2VfaXNfaTkxNShmZW5jZSkpCkBAIC05
NjEsNyArOTY0LDggQEAgaTkxNV9yZXF1ZXN0X2F3YWl0X2RtYV9mZW5jZShzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpycSwgc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCiAKIAkJLyogUmVjb3JkIHRoZSBs
YXRlc3QgZmVuY2UgdXNlZCBhZ2FpbnN0IGVhY2ggdGltZWxpbmUgKi8KIAkJaWYgKGZlbmNlLT5j
b250ZXh0KQotCQkJaW50ZWxfdGltZWxpbmVfc3luY19zZXQocnEtPnRpbWVsaW5lLCBmZW5jZSk7
CisJCQlpbnRlbF90aW1lbGluZV9zeW5jX3NldChpOTE1X3JlcXVlc3RfdGltZWxpbmUocnEpLAor
CQkJCQkJZmVuY2UpOwogCX0gd2hpbGUgKC0tbmNoaWxkKTsKIAogCXJldHVybiAwOwpAQCAtMTEw
Myw3ICsxMTA3LDcgQEAgdm9pZCBpOTE1X3JlcXVlc3Rfc2tpcChzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycSwgaW50IGVycm9yKQogc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3QgKgogX19pOTE1X3Jl
cXVlc3RfYWRkX3RvX3RpbWVsaW5lKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogewotCXN0cnVj
dCBpbnRlbF90aW1lbGluZSAqdGltZWxpbmUgPSBycS0+dGltZWxpbmU7CisJc3RydWN0IGludGVs
X3RpbWVsaW5lICp0aW1lbGluZSA9IGk5MTVfcmVxdWVzdF90aW1lbGluZShycSk7CiAJc3RydWN0
IGk5MTVfcmVxdWVzdCAqcHJldjsKIAogCS8qCkBAIC0xMjE2LDcgKzEyMjAsNyBAQCB2b2lkIF9f
aTkxNV9yZXF1ZXN0X3F1ZXVlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAogdm9pZCBpOTE1X3Jl
cXVlc3RfYWRkKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQogewogCXN0cnVjdCBpOTE1X3NjaGVk
X2F0dHIgYXR0ciA9IHJxLT5nZW1fY29udGV4dC0+c2NoZWQ7Ci0Jc3RydWN0IGludGVsX3RpbWVs
aW5lICogY29uc3QgdGwgPSBycS0+dGltZWxpbmU7CisJc3RydWN0IGludGVsX3RpbWVsaW5lICog
Y29uc3QgdGwgPSBpOTE1X3JlcXVlc3RfdGltZWxpbmUocnEpOwogCXN0cnVjdCBpOTE1X3JlcXVl
c3QgKnByZXY7CiAKIAlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ0bC0+bXV0ZXgpOwpAQCAtMTI3MSw3
ICsxMjc1LDkgQEAgdm9pZCBpOTE1X3JlcXVlc3RfYWRkKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
KQogCSAqIHdvcmsgb24gYmVoYWxmIG9mIG90aGVycyAtLSBidXQgaW5zdGVhZCB3ZSBzaG91bGQg
YmVuZWZpdCBmcm9tCiAJICogaW1wcm92ZWQgcmVzb3VyY2UgbWFuYWdlbWVudC4gKFdlbGwsIHRo
YXQncyB0aGUgdGhlb3J5IGF0IGxlYXN0LikKIAkgKi8KLQlpZiAocHJldiAmJiBpOTE1X3JlcXVl
c3RfY29tcGxldGVkKHByZXYpICYmIHByZXYtPnRpbWVsaW5lID09IHRsKQorCWlmIChwcmV2ICYm
CisJICAgIGk5MTVfcmVxdWVzdF9jb21wbGV0ZWQocHJldikgJiYKKwkgICAgcmN1X2FjY2Vzc19w
b2ludGVyKHByZXYtPnRpbWVsaW5lKSA9PSB0bCkKIAkJaTkxNV9yZXF1ZXN0X3JldGlyZV91cHRv
KHByZXYpOwogCiAJbXV0ZXhfdW5sb2NrKCZ0bC0+bXV0ZXgpOwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3JlcXVlc3QuaAppbmRleCA4YWM2ZTEyMjZhNTYuLmIxOGY0OTUyOGRlZCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9yZXF1ZXN0LmgKQEAgLTExMyw3ICsxMTMsNyBAQCBzdHJ1Y3QgaTkxNV9yZXF1
ZXN0IHsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJc3RydWN0IGludGVsX2Nv
bnRleHQgKmh3X2NvbnRleHQ7CiAJc3RydWN0IGludGVsX3JpbmcgKnJpbmc7Ci0Jc3RydWN0IGlu
dGVsX3RpbWVsaW5lICp0aW1lbGluZTsKKwlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgX19yY3UgKnRp
bWVsaW5lOwogCXN0cnVjdCBsaXN0X2hlYWQgc2lnbmFsX2xpbms7CiAKIAkvKgpAQCAtNDQyLDYg
KzQ0MiwyNiBAQCBzdGF0aWMgaW5saW5lIGJvb2wgaTkxNV9yZXF1ZXN0X2hhc19ub3ByZWVtcHQo
Y29uc3Qgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJcmV0dXJuIHVubGlrZWx5KHJxLT5mbGFn
cyAmIEk5MTVfUkVRVUVTVF9OT1BSRUVNUFQpOwogfQogCitzdGF0aWMgaW5saW5lIHN0cnVjdCBp
bnRlbF90aW1lbGluZSAqCitpOTE1X3JlcXVlc3RfdGltZWxpbmUoc3RydWN0IGk5MTVfcmVxdWVz
dCAqcnEpCit7CisJLyogVmFsaWQgb25seSB3aGlsZSB0aGUgcmVxdWVzdCBpcyBiZWluZyBjb25z
dHJ1Y3RlZCAob3IgcmV0aXJlZCkuICovCisJcmV0dXJuIHJjdV9kZXJlZmVyZW5jZV9wcm90ZWN0
ZWQocnEtPnRpbWVsaW5lLAorCQkJCQkgbG9ja2RlcF9pc19oZWxkKCZyY3VfYWNjZXNzX3BvaW50
ZXIocnEtPnRpbWVsaW5lKS0+bXV0ZXgpKTsKK30KKworc3RhdGljIGlubGluZSBzdHJ1Y3QgaW50
ZWxfdGltZWxpbmUgKgoraTkxNV9yZXF1ZXN0X2FjdGl2ZV90aW1lbGluZShzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpycSkKK3sKKwkvKgorCSAqIFdoZW4gaW4gdXNlIGR1cmluZyBzdWJtaXNzaW9uLCB3
ZSBhcmUgcHJvdGVjdGVkIGJ5IGEgZ3VhcmFudGVlIHRoYXQKKwkgKiB0aGUgY29udGV4dC90aW1l
bGluZSBpcyBwaW5uZWQgYW5kIG11c3QgcmVtYWluIHBpbm5lZCB1bnRpbCBhZnRlcgorCSAqIHRo
aXMgc3VibWlzc2lvbi4KKwkgKi8KKwlyZXR1cm4gcmN1X2RlcmVmZXJlbmNlX3Byb3RlY3RlZChy
cS0+dGltZWxpbmUsCisJCQkJCSBsb2NrZGVwX2lzX2hlbGQoJnJxLT5lbmdpbmUtPmFjdGl2ZS5s
b2NrKSk7Cit9CisKIGJvb2wgaTkxNV9yZXRpcmVfcmVxdWVzdHMoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUpOwogCiAjZW5kaWYgLyogSTkxNV9SRVFVRVNUX0ggKi8KZGlmZiAtLWdpdCBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3ZtYS5jCmluZGV4IDQxMTA0N2Q2YTkwOS4uOTUzMzFlZjg5YjMxIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfdm1hLmMKQEAgLTkwMCwxNCArOTAwLDE0IEBAIGludCBpOTE1X3ZtYV9tb3ZlX3RvX2Fj
dGl2ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAkgKiBhZGQgdGhlIGFjdGl2ZSByZWZlcmVuY2Ug
Zmlyc3QgYW5kIHF1ZXVlIGZvciBpdCB0byBiZSBkcm9wcGVkCiAJICogKmxhc3QqLgogCSAqLwot
CWVyciA9IGk5MTVfYWN0aXZlX3JlZigmdm1hLT5hY3RpdmUsIHJxLT50aW1lbGluZSwgcnEpOwor
CWVyciA9IGk5MTVfYWN0aXZlX3JlZigmdm1hLT5hY3RpdmUsIGk5MTVfcmVxdWVzdF90aW1lbGlu
ZShycSksIHJxKTsKIAlpZiAodW5saWtlbHkoZXJyKSkKIAkJcmV0dXJuIGVycjsKIAogCWlmIChm
bGFncyAmIEVYRUNfT0JKRUNUX1dSSVRFKSB7CiAJCWlmIChpbnRlbF9mcm9udGJ1ZmZlcl9pbnZh
bGlkYXRlKG9iai0+ZnJvbnRidWZmZXIsIE9SSUdJTl9DUykpCiAJCQlpOTE1X2FjdGl2ZV9yZWYo
Jm9iai0+ZnJvbnRidWZmZXItPndyaXRlLAotCQkJCQlycS0+dGltZWxpbmUsCisJCQkJCWk5MTVf
cmVxdWVzdF90aW1lbGluZShycSksCiAJCQkJCXJxKTsKIAogCQlkbWFfcmVzdl9hZGRfZXhjbF9m
ZW5jZSh2bWEtPnJlc3YsICZycS0+ZmVuY2UpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvc2VsZnRlc3RzL2k5MTVfYWN0aXZlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaTkxNV9hY3RpdmUuYwppbmRleCA3N2Q4NDRhYzhiNzEuLjMzM2VhYjc5YjZhZiAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfYWN0aXZlLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfYWN0aXZlLmMKQEAgLTExMCw3
ICsxMTAsOSBAQCBfX2xpdmVfYWN0aXZlX3NldHVwKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQogCQkJCQkJICAgICAgIHN1Ym1pdCwKIAkJCQkJCSAgICAgICBHRlBfS0VSTkVMKTsKIAkJ
aWYgKGVyciA+PSAwKQotCQkJZXJyID0gaTkxNV9hY3RpdmVfcmVmKCZhY3RpdmUtPmJhc2UsIHJx
LT50aW1lbGluZSwgcnEpOworCQkJZXJyID0gaTkxNV9hY3RpdmVfcmVmKCZhY3RpdmUtPmJhc2Us
CisJCQkJCSAgICAgIGk5MTVfcmVxdWVzdF90aW1lbGluZShycSksCisJCQkJCSAgICAgIHJxKTsK
IAkJaTkxNV9yZXF1ZXN0X2FkZChycSk7CiAJCWlmIChlcnIpIHsKIAkJCXByX2VycigiRmFpbGVk
IHRvIHRyYWNrIGFjdGl2ZSByZWYhXG4iKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pZ3Rfc3Bpbm5lci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2lndF9zcGlubmVyLmMKaW5kZXggMTFmMDRhZDQ4ZTY4Li5lZTg0NTBiODcxZGEgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3Rfc3Bpbm5lci5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3Rfc3Bpbm5lci5jCkBAIC0xNDcsNyAr
MTQ3LDcgQEAgaWd0X3NwaW5uZXJfY3JlYXRlX3JlcXVlc3Qoc3RydWN0IGlndF9zcGlubmVyICpz
cGluLAogCWludGVsX2d0X2NoaXBzZXRfZmx1c2goZW5naW5lLT5ndCk7CiAKIAlpZiAoZW5naW5l
LT5lbWl0X2luaXRfYnJlYWRjcnVtYiAmJgotCSAgICBycS0+dGltZWxpbmUtPmhhc19pbml0aWFs
X2JyZWFkY3J1bWIpIHsKKwkgICAgaTkxNV9yZXF1ZXN0X3RpbWVsaW5lKHJxKS0+aGFzX2luaXRp
YWxfYnJlYWRjcnVtYikgewogCQllcnIgPSBlbmdpbmUtPmVtaXRfaW5pdF9icmVhZGNydW1iKHJx
KTsKIAkJaWYgKGVycikKIAkJCWdvdG8gY2FuY2VsX3JxOwotLSAKMi4yMy4wCgpfX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBs
aXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVz
a3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

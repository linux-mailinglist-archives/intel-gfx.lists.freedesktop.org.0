Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 9E2A876126
	for <lists+intel-gfx@lfdr.de>; Fri, 26 Jul 2019 10:46:37 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D851B6E8AF;
	Fri, 26 Jul 2019 08:46:32 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0F95F6E8A7
 for <intel-gfx@lists.freedesktop.org>; Fri, 26 Jul 2019 08:46:29 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17621082-1500050 
 for multiple; Fri, 26 Jul 2019 09:46:16 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 26 Jul 2019 09:45:55 +0100
Message-Id: <20190726084613.22129-9-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.22.0
In-Reply-To: <20190726084613.22129-1-chris@chris-wilson.co.uk>
References: <20190726084613.22129-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 09/27] drm/i915: Push the ring creation flags to
 the backend
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UHVzaCB0aGUgcmluZyBjcmVhdGlvbiBmbGFncyBmcm9tIHRoZSBvdXRlciBHRU0gY29udGV4dCB0
byB0aGUgaW5uZXIKaW50ZWxfY290bmV4dCB0byBhdm9pZCBhbiB1bnNpZ2h0bHkgYmFjay1yZWZl
cmVuY2UgZnJvbSBpbnNpZGUgdGhlCmJhY2tlbmQuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxz
b24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fY29udGV4dC5jICAgfCAyNSArKysrKysrKysrKysrLS0tLS0tCiAuLi4vZ3B1
L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0X3R5cGVzLmggfCAgMyAtLS0KIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYyAgICAgICB8ICAxICsKIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuaCAgICAgICB8ICA1ICsrKysKIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jICAgICAgICAgICB8ICA1ICsrLS0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L21vY2tfZW5naW5lLmMgICAgICAgICB8IDEyICsrKy0tLS0tLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgICAgICAgICAgIHwgMjMgKysrKysrKysrKyst
LS0tLS0KIDcgZmlsZXMgY2hhbmdlZCwgNDUgaW5zZXJ0aW9ucygrKSwgMjkgZGVsZXRpb25zKC0p
CgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXggMWIz
ZGM3MjU4ZWYyLi4xOGIyMjZiYzVlM2EgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX2NvbnRleHQuYwpAQCAtMjk2LDYgKzI5Niw4IEBAIHN0YXRpYyBzdHJ1Y3QgaTkxNV9n
ZW1fZW5naW5lcyAqZGVmYXVsdF9lbmdpbmVzKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgp
CiAJCQlyZXR1cm4gRVJSX0NBU1QoY2UpOwogCQl9CiAKKwkJY2UtPnJpbmcgPSBfX2ludGVsX2Nv
bnRleHRfcmluZ19zaXplKFNaXzE2Syk7CisKIAkJZS0+ZW5naW5lc1tpZF0gPSBjZTsKIAl9CiAJ
ZS0+bnVtX2VuZ2luZXMgPSBpZDsKQEAgLTQzNCw4ICs0MzYsNiBAQCBfX2NyZWF0ZV9jb250ZXh0
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogCWk5MTVfZ2VtX2NvbnRleHRfc2V0X2Jh
bm5hYmxlKGN0eCk7CiAJaTkxNV9nZW1fY29udGV4dF9zZXRfcmVjb3ZlcmFibGUoY3R4KTsKIAot
CWN0eC0+cmluZ19zaXplID0gNCAqIFBBR0VfU0laRTsKLQogCWZvciAoaSA9IDA7IGkgPCBBUlJB
WV9TSVpFKGN0eC0+aGFuZ190aW1lc3RhbXApOyBpKyspCiAJCWN0eC0+aGFuZ190aW1lc3RhbXBb
aV0gPSBqaWZmaWVzIC0gQ09OVEVYVF9GQVNUX0hBTkdfSklGRklFUzsKIApAQCAtNTY1LDggKzU2
NSwxNSBAQCBpOTE1X2dlbV9jb250ZXh0X2NyZWF0ZV9ndnQoc3RydWN0IGRybV9kZXZpY2UgKmRl
dikKIAlpOTE1X2dlbV9jb250ZXh0X3NldF9jbG9zZWQoY3R4KTsgLyogbm90IHVzZXIgYWNjZXNz
aWJsZSAqLwogCWk5MTVfZ2VtX2NvbnRleHRfY2xlYXJfYmFubmFibGUoY3R4KTsKIAlpOTE1X2dl
bV9jb250ZXh0X3NldF9mb3JjZV9zaW5nbGVfc3VibWlzc2lvbihjdHgpOwotCWlmICghVVNFU19H
VUNfU1VCTUlTU0lPTih0b19pOTE1KGRldikpKQotCQljdHgtPnJpbmdfc2l6ZSA9IDUxMiAqIFBB
R0VfU0laRTsgLyogTWF4IHJpbmcgYnVmZmVyIHNpemUgKi8KKwlpZiAoIVVTRVNfR1VDX1NVQk1J
U1NJT04odG9faTkxNShkZXYpKSkgeworCQljb25zdCB1bnNpZ25lZCBsb25nIHJpbmdfc2l6ZSA9
IDUxMiAqIFNaXzRLOyAvKiBtYXggKi8KKwkJc3RydWN0IGk5MTVfZ2VtX2VuZ2luZXNfaXRlciBp
dDsKKwkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOworCisJCWZvcl9lYWNoX2dlbV9lbmdpbmUo
Y2UsIGk5MTVfZ2VtX2NvbnRleHRfbG9ja19lbmdpbmVzKGN0eCksIGl0KQorCQkJY2UtPnJpbmcg
PSBfX2ludGVsX2NvbnRleHRfcmluZ19zaXplKHJpbmdfc2l6ZSk7CisJCWk5MTVfZ2VtX2NvbnRl
eHRfdW5sb2NrX2VuZ2luZXMoY3R4KTsKKwl9CiAKIAlHRU1fQlVHX09OKGk5MTVfZ2VtX2NvbnRl
eHRfaXNfa2VybmVsKGN0eCkpOwogb3V0OgpAQCAtNjA1LDcgKzYxMiw2IEBAIGk5MTVfZ2VtX2Nv
bnRleHRfY3JlYXRlX2tlcm5lbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgaW50IHBy
aW8pCiAKIAlpOTE1X2dlbV9jb250ZXh0X2NsZWFyX2Jhbm5hYmxlKGN0eCk7CiAJY3R4LT5zY2hl
ZC5wcmlvcml0eSA9IEk5MTVfVVNFUl9QUklPUklUWShwcmlvKTsKLQljdHgtPnJpbmdfc2l6ZSA9
IFBBR0VfU0laRTsKIAogCUdFTV9CVUdfT04oIWk5MTVfZ2VtX2NvbnRleHRfaXNfa2VybmVsKGN0
eCkpOwogCkBAIC0xNTg5LDYgKzE1OTUsNyBAQCBzZXRfZW5naW5lcyhzdHJ1Y3QgaTkxNV9nZW1f
Y29udGV4dCAqY3R4LAogCWZvciAobiA9IDA7IG4gPCBudW1fZW5naW5lczsgbisrKSB7CiAJCXN0
cnVjdCBpOTE1X2VuZ2luZV9jbGFzc19pbnN0YW5jZSBjaTsKIAkJc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lOworCQlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAKIAkJaWYgKGNvcHlf
ZnJvbV91c2VyKCZjaSwgJnVzZXItPmVuZ2luZXNbbl0sIHNpemVvZihjaSkpKSB7CiAJCQlfX2Zy
ZWVfZW5naW5lcyhzZXQuZW5naW5lcywgbik7CkBAIC0xNjExLDExICsxNjE4LDE1IEBAIHNldF9l
bmdpbmVzKHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAJCQlyZXR1cm4gLUVOT0VOVDsK
IAkJfQogCi0JCXNldC5lbmdpbmVzLT5lbmdpbmVzW25dID0gaW50ZWxfY29udGV4dF9jcmVhdGUo
Y3R4LCBlbmdpbmUpOwotCQlpZiAoIXNldC5lbmdpbmVzLT5lbmdpbmVzW25dKSB7CisJCWNlID0g
aW50ZWxfY29udGV4dF9jcmVhdGUoY3R4LCBlbmdpbmUpOworCQlpZiAoIWNlKSB7CiAJCQlfX2Zy
ZWVfZW5naW5lcyhzZXQuZW5naW5lcywgbik7CiAJCQlyZXR1cm4gLUVOT01FTTsKIAkJfQorCisJ
CWNlLT5yaW5nID0gX19pbnRlbF9jb250ZXh0X3Jpbmdfc2l6ZShTWl8xNkspOworCisJCXNldC5l
bmdpbmVzLT5lbmdpbmVzW25dID0gY2U7CiAJfQogCXNldC5lbmdpbmVzLT5udW1fZW5naW5lcyA9
IG51bV9lbmdpbmVzOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fY29udGV4dF90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X2NvbnRleHRfdHlwZXMuaAppbmRleCBhMDJkOTg0OTQwNzguLjI2MGQ1OWNjM2RlOCAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHRfdHlwZXMuaAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dF90eXBlcy5oCkBA
IC0xNjksOSArMTY5LDYgQEAgc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgewogCiAJc3RydWN0IGk5
MTVfc2NoZWRfYXR0ciBzY2hlZDsKIAotCS8qKiByaW5nX3NpemU6IHNpemUgZm9yIGFsbG9jYXRp
bmcgdGhlIHBlci1lbmdpbmUgcmluZyBidWZmZXIgKi8KLQl1MzIgcmluZ19zaXplOwotCiAJLyoq
IGd1aWx0eV9jb3VudDogSG93IG1hbnkgdGltZXMgdGhpcyBjb250ZXh0IGhhcyBjYXVzZWQgYSBH
UFUgaGFuZy4gKi8KIAlhdG9taWNfdCBndWlsdHlfY291bnQ7CiAJLyoqCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKaW5kZXggMzRjOGUzN2E3M2I4Li44ZjY0NTczN2NkZTAg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9jb250ZXh0LmMKQEAgLTIxNCw2ICsyMTQs
NyBAQCBpbnRlbF9jb250ZXh0X2luaXQoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCWNlLT5l
bmdpbmUgPSBlbmdpbmU7CiAJY2UtPm9wcyA9IGVuZ2luZS0+Y29wczsKIAljZS0+c3NldSA9IGVu
Z2luZS0+c3NldTsKKwljZS0+cmluZyA9IF9faW50ZWxfY29udGV4dF9yaW5nX3NpemUoU1pfNEsp
OwogCiAJSU5JVF9MSVNUX0hFQUQoJmNlLT5zaWduYWxfbGluayk7CiAJSU5JVF9MSVNUX0hFQUQo
JmNlLT5zaWduYWxzKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2NvbnRleHQuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2NvbnRleHQuaAppbmRl
eCAwN2Y5OTI0ZGU0OGYuLjEzZjI4ZGQzMTZiYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfY29udGV4dC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2NvbnRleHQuaApAQCAtMTM2LDQgKzEzNiw5IEBAIGludCBpbnRlbF9jb250ZXh0X3ByZXBh
cmVfcmVtb3RlX3JlcXVlc3Qoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCiBzdHJ1Y3QgaTkx
NV9yZXF1ZXN0ICppbnRlbF9jb250ZXh0X2NyZWF0ZV9yZXF1ZXN0KHN0cnVjdCBpbnRlbF9jb250
ZXh0ICpjZSk7CiAKK3N0YXRpYyBpbmxpbmUgc3RydWN0IGludGVsX3JpbmcgKl9faW50ZWxfY29u
dGV4dF9yaW5nX3NpemUodTY0IHN6KQoreworCXJldHVybiB1NjRfdG9fcHRyKHN0cnVjdCBpbnRl
bF9yaW5nLCBzeik7Cit9CisKICNlbmRpZiAvKiBfX0lOVEVMX0NPTlRFWFRfSF9fICovCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jCmluZGV4IDc1MTc5OWQ1ZDFhOS4uYzg5OWNlMzRkMGQz
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYwpAQCAtMzE5Niw5ICszMTk2LDggQEAg
c3RhdGljIGludCBleGVjbGlzdHNfY29udGV4dF9kZWZlcnJlZF9hbGxvYyhzdHJ1Y3QgaW50ZWxf
Y29udGV4dCAqY2UsCiAJCWdvdG8gZXJyb3JfZGVyZWZfb2JqOwogCX0KIAotCXJpbmcgPSBpbnRl
bF9lbmdpbmVfY3JlYXRlX3JpbmcoZW5naW5lLAotCQkJCQl0aW1lbGluZSwKLQkJCQkJY2UtPmdl
bV9jb250ZXh0LT5yaW5nX3NpemUpOworCXJpbmcgPSBpbnRlbF9lbmdpbmVfY3JlYXRlX3Jpbmco
ZW5naW5lLCB0aW1lbGluZSwKKwkJCQkJKHVuc2lnbmVkIGxvbmcpY2UtPnJpbmcpOwogCWludGVs
X3RpbWVsaW5lX3B1dCh0aW1lbGluZSk7CiAJaWYgKElTX0VSUihyaW5nKSkgewogCQlyZXQgPSBQ
VFJfRVJSKHJpbmcpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvbW9ja19l
bmdpbmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L21vY2tfZW5naW5lLmMKaW5kZXggMTBj
YjMxMjQ2MmU1Li5iYTA3Njg4NmU3OWUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L21vY2tfZW5naW5lLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvbW9ja19lbmdp
bmUuYwpAQCAtMTMxLDYgKzEzMSw3IEBAIHN0YXRpYyB2b2lkIGh3X2RlbGF5X2NvbXBsZXRlKHN0
cnVjdCB0aW1lcl9saXN0ICp0KQogc3RhdGljIHZvaWQgbW9ja19jb250ZXh0X3VucGluKHN0cnVj
dCBpbnRlbF9jb250ZXh0ICpjZSkKIHsKIAltb2NrX3RpbWVsaW5lX3VucGluKGNlLT5yaW5nLT50
aW1lbGluZSk7CisJbW9ja19yaW5nX2ZyZWUoY2UtPnJpbmcpOwogfQogCiBzdGF0aWMgdm9pZCBt
b2NrX2NvbnRleHRfZGVzdHJveShzdHJ1Y3Qga3JlZiAqcmVmKQpAQCAtMTM5LDkgKzE0MCw2IEBA
IHN0YXRpYyB2b2lkIG1vY2tfY29udGV4dF9kZXN0cm95KHN0cnVjdCBrcmVmICpyZWYpCiAKIAlH
RU1fQlVHX09OKGludGVsX2NvbnRleHRfaXNfcGlubmVkKGNlKSk7CiAKLQlpZiAoY2UtPnJpbmcp
Ci0JCW1vY2tfcmluZ19mcmVlKGNlLT5yaW5nKTsKLQogCWludGVsX2NvbnRleHRfZmluaShjZSk7
CiAJaW50ZWxfY29udGV4dF9mcmVlKGNlKTsKIH0KQEAgLTE1MCwxMSArMTQ4LDkgQEAgc3RhdGlj
IGludCBtb2NrX2NvbnRleHRfcGluKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIHsKIAlpbnQg
cmV0OwogCi0JaWYgKCFjZS0+cmluZykgewotCQljZS0+cmluZyA9IG1vY2tfcmluZyhjZS0+ZW5n
aW5lKTsKLQkJaWYgKCFjZS0+cmluZykKLQkJCXJldHVybiAtRU5PTUVNOwotCX0KKwljZS0+cmlu
ZyA9IG1vY2tfcmluZyhjZS0+ZW5naW5lKTsKKwlpZiAoIWNlLT5yaW5nKQorCQlyZXR1cm4gLUVO
T01FTTsKIAogCXJldCA9IGludGVsX2NvbnRleHRfYWN0aXZlX2FjcXVpcmUoY2UpOwogCWlmIChy
ZXQpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCmluZGV4IDFmMDQwOGZmMzQ1Yi4uNjNk
NGE3ODQyYTIzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwpAQCAtMzI4LDEwICsz
MjgsMTQgQEAgc3RhdGljIHZvaWQgcHJpbnRfY29udGV4dF9zdGF0cyhzdHJ1Y3Qgc2VxX2ZpbGUg
Km0sCiAKIAkJZm9yX2VhY2hfZ2VtX2VuZ2luZShjZSwKIAkJCQkgICAgaTkxNV9nZW1fY29udGV4
dF9sb2NrX2VuZ2luZXMoY3R4KSwgaXQpIHsKLQkJCWlmIChjZS0+c3RhdGUpCi0JCQkJcGVyX2Zp
bGVfc3RhdHMoMCwgY2UtPnN0YXRlLT5vYmosICZrc3RhdHMpOwotCQkJaWYgKGNlLT5yaW5nKQor
CQkJaW50ZWxfY29udGV4dF9sb2NrX3Bpbm5lZChjZSk7CisJCQlpZiAoaW50ZWxfY29udGV4dF9p
c19waW5uZWQoY2UpKSB7CisJCQkJaWYgKGNlLT5zdGF0ZSkKKwkJCQkJcGVyX2ZpbGVfc3RhdHMo
MCwKKwkJCQkJCSAgICAgICBjZS0+c3RhdGUtPm9iaiwgJmtzdGF0cyk7CiAJCQkJcGVyX2ZpbGVf
c3RhdHMoMCwgY2UtPnJpbmctPnZtYS0+b2JqLCAma3N0YXRzKTsKKwkJCX0KKwkJCWludGVsX2Nv
bnRleHRfdW5sb2NrX3Bpbm5lZChjZSk7CiAJCX0KIAkJaTkxNV9nZW1fY29udGV4dF91bmxvY2tf
ZW5naW5lcyhjdHgpOwogCkBAIC0xNTkyLDEyICsxNTk2LDE1IEBAIHN0YXRpYyBpbnQgaTkxNV9j
b250ZXh0X3N0YXR1cyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZvaWQgKnVudXNlZCkKIAogCQlmb3Jf
ZWFjaF9nZW1fZW5naW5lKGNlLAogCQkJCSAgICBpOTE1X2dlbV9jb250ZXh0X2xvY2tfZW5naW5l
cyhjdHgpLCBpdCkgewotCQkJc2VxX3ByaW50ZihtLCAiJXM6ICIsIGNlLT5lbmdpbmUtPm5hbWUp
OwotCQkJaWYgKGNlLT5zdGF0ZSkKLQkJCQlkZXNjcmliZV9vYmoobSwgY2UtPnN0YXRlLT5vYmop
OwotCQkJaWYgKGNlLT5yaW5nKQorCQkJaW50ZWxfY29udGV4dF9sb2NrX3Bpbm5lZChjZSk7CisJ
CQlpZiAoaW50ZWxfY29udGV4dF9pc19waW5uZWQoY2UpKSB7CisJCQkJc2VxX3ByaW50ZihtLCAi
JXM6ICIsIGNlLT5lbmdpbmUtPm5hbWUpOworCQkJCWlmIChjZS0+c3RhdGUpCisJCQkJCWRlc2Ny
aWJlX29iaihtLCBjZS0+c3RhdGUtPm9iaik7CiAJCQkJZGVzY3JpYmVfY3R4X3JpbmcobSwgY2Ut
PnJpbmcpOwotCQkJc2VxX3B1dGMobSwgJ1xuJyk7CisJCQkJc2VxX3B1dGMobSwgJ1xuJyk7CisJ
CQl9CisJCQlpbnRlbF9jb250ZXh0X3VubG9ja19waW5uZWQoY2UpOwogCQl9CiAJCWk5MTVfZ2Vt
X2NvbnRleHRfdW5sb2NrX2VuZ2luZXMoY3R4KTsKIAotLSAKMi4yMi4wCgpfX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0
CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3Rv
cC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

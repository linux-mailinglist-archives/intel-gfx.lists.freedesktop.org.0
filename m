Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id BF5D4B8F2D
	for <lists+intel-gfx@lfdr.de>; Fri, 20 Sep 2019 13:43:18 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 3C1776FCB2;
	Fri, 20 Sep 2019 11:43:14 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 6BAA36FC9F
 for <intel-gfx@lists.freedesktop.org>; Fri, 20 Sep 2019 11:42:42 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 20 Sep 2019 13:42:24 +0200
Message-Id: <20190920114235.22411-12-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190920114235.22411-1-maarten.lankhorst@linux.intel.com>
References: <20190920114235.22411-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 12/23] drm/i915: Enable big joiner support in
 enable and disable sequences.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TWFrZSB2ZHNjIHdvcmsgd2hlbiBubyBvdXRwdXQgaXMgZW5hYmxlZC4gVGhlIGJpZyBqb2luZXIg
bmVlZHMgVkRTQwpvbiB0aGUgc2xhdmUsIHNvIGVuYWJsZSBpdCBhbmQgc2V0IHRoZSBhcHByb3By
aWF0ZSBiaXRzLgpBbHNvIHVwZGF0ZSB0aW1lc3RhbXBpbmcgY29uc3RhbnRzLCBiZWNhdXNlIHNs
YXZlIGNydGMncyBhcmUgbm90CnVwZGF0ZWQgaW4gZHJtX2F0b21pY19oZWxwZXJfdXBkYXRlX2xl
Z2FjeV9tb2Rlc2V0X3N0YXRlKCkuCgpUaGlzIHNob3VsZCBiZSBlbm91Z2ggdG8gYnJpbmcgdXAg
Q1JUQydzIGluIGEgYmlnIGpvaW5lciBjb25maWd1cmF0aW9uLAp3aXRob3V0IGFueSBwbGFuZSBj
b25maWd1cmF0aW9uIG9uIHRoZSBzZWNvbmQgcGlwZSB5ZXQuCgpIT1dFVkVSLCB3ZSBicmluZyB1
cCB0aGUgY3J0YydzIGluIHRoZSB3cm9uZyBvcmRlci4gV2UgbmVlZCB0byBtYWtlCnN1cmUgdGhh
dCB0aGUgbWFzdGVyIGNydGMgaXMgYnJvdWdodCB1cCBhZnRlciB0aGUgc2xhdmUgY3J0Yywgd2UK
ZG9uJ3QgZG8gdGhhdCB5ZXQuIFRoaXMgaXMgZG9uZSBjb3JyZWN0bHkgbGF0ZXIgaW4gdGhpcyBz
ZXJpZXMuCgpUaGUgbmV4dCBzdGVwcyBhcmUgdG8gYWRkIGF0b21pYyBjb21taXQsIGFuZCBtYWtl
IHN1cmUgd2UgZW5hYmxlIGFuZAp1cGRhdGUgYm90aCBtYXN0ZXIgYW5kIHNsYXZlIGluIHRoZSBj
b3JyZWN0IG9yZGVyLgoKU2lnbmVkLW9mZi1ieTogTWFhcnRlbiBMYW5raG9yc3QgPG1hYXJ0ZW4u
bGFua2hvcnN0QGxpbnV4LmludGVsLmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2RkaS5jICAgICAgfCAgNTUgKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2Rpc3BsYXkuYyAgfCA0MDIgKysrKysrKysrKysrLS0tLS0tCiAuLi4vZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmggICAgfCAgMTcgKwogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jICAgICAgIHwgIDE4ICstCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX3Zkc2MuYyAgICAgfCAxMjIgKysrKy0tCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Zkc2MuaCAgICAgfCAgIDIgKwogNiBmaWxlcyBjaGFu
Z2VkLCA0MTggaW5zZXJ0aW9ucygrKSwgMTk4IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCmluZGV4IGM3NzVmZDIwNTkxNS4uYTI2MTU1ZjkwMjYx
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGRpLmMKQEAgLTE2OTQsNiAr
MTY5NCwxMyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kZGlfY2xvY2tfZ2V0KHN0cnVjdCBpbnRlbF9l
bmNvZGVyICplbmNvZGVyLAogCQlza2xfZGRpX2Nsb2NrX2dldChlbmNvZGVyLCBwaXBlX2NvbmZp
Zyk7CiAJZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA8PSA4KQogCQloc3dfZGRpX2Nsb2Nr
X2dldChlbmNvZGVyLCBwaXBlX2NvbmZpZyk7CisKKwlpZiAocGlwZV9jb25maWctPmJpZ2pvaW5l
cikgeworCQlwaXBlX2NvbmZpZy0+aHcudHJhbnNjb2Rlcl9tb2RlLmNydGNfY2xvY2sgPQorCQkJ
cGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19jbG9jazsKKworCQlwaXBlX2NvbmZp
Zy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrIC89IDI7CisJfQogfQogCiB2b2lkIGludGVs
X2RkaV9zZXRfcGlwZV9zZXR0aW5ncyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKQEAgLTIxNzYsMTMgKzIxODMsNiBAQCBzdGF0aWMgdm9pZCBpbnRlbF9kZGlfZ2V0
X3Bvd2VyX2RvbWFpbnMoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJICAgIGludGVs
X3BoeV9pc190YyhkZXZfcHJpdiwgcGh5KSkKIAkJaW50ZWxfZGlzcGxheV9wb3dlcl9nZXQoZGV2
X3ByaXYsCiAJCQkJCWludGVsX2RkaV9tYWluX2xpbmtfYXV4X2RvbWFpbihkaWdfcG9ydCkpOwot
Ci0JLyoKLQkgKiBWRFNDIHBvd2VyIGlzIG5lZWRlZCB3aGVuIERTQyBpcyBlbmFibGVkCi0JICov
Ci0JaWYgKGNydGNfc3RhdGUtPmRzY19wYXJhbXMuY29tcHJlc3Npb25fZW5hYmxlKQotCQlpbnRl
bF9kaXNwbGF5X3Bvd2VyX2dldChkZXZfcHJpdiwKLQkJCQkJaW50ZWxfZHNjX3Bvd2VyX2RvbWFp
bihjcnRjX3N0YXRlKSk7CiB9CiAKIHZvaWQgaW50ZWxfZGRpX2VuYWJsZV9waXBlX2Nsb2NrKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQpAQCAtMzI5MCw3ICszMjkw
LDggQEAgc3RhdGljIHZvaWQgdGdsX2RkaV9wcmVfZW5hYmxlX2RwKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyLAogCiAJLyogNy5sICovCiAJaW50ZWxfZGRpX2VuYWJsZV9mZWMoZW5jb2Rl
ciwgY3J0Y19zdGF0ZSk7Ci0JaW50ZWxfZHNjX2VuYWJsZShlbmNvZGVyLCBjcnRjX3N0YXRlKTsK
KwlpZiAoIWNydGNfc3RhdGUtPmJpZ2pvaW5lcikKKwkJaW50ZWxfZHNjX2VuYWJsZShlbmNvZGVy
LCBjcnRjX3N0YXRlKTsKIH0KIAogc3RhdGljIHZvaWQgaHN3X2RkaV9wcmVfZW5hYmxlX2RwKHN0
cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLApAQCAtMzM2MSw3ICszMzYyLDggQEAgc3RhdGlj
IHZvaWQgaHN3X2RkaV9wcmVfZW5hYmxlX2RwKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
LAogCWlmICghaXNfbXN0KQogCQlpbnRlbF9kZGlfZW5hYmxlX3BpcGVfY2xvY2soY3J0Y19zdGF0
ZSk7CiAKLQlpbnRlbF9kc2NfZW5hYmxlKGVuY29kZXIsIGNydGNfc3RhdGUpOworCWlmICghY3J0
Y19zdGF0ZS0+Ymlnam9pbmVyKQorCQlpbnRlbF9kc2NfZW5hYmxlKGVuY29kZXIsIGNydGNfc3Rh
dGUpOwogfQogCiBzdGF0aWMgdm9pZCBpbnRlbF9kZGlfcHJlX2VuYWJsZV9kcChzdHJ1Y3QgaW50
ZWxfZW5jb2RlciAqZW5jb2RlciwKQEAgLTM5NzIsMTkgKzM5NzQsMTggQEAgdm9pZCBpbnRlbF9k
ZGlfY29tcHV0ZV9taW5fdm9sdGFnZV9sZXZlbChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCiAJCWNydGNfc3RhdGUtPm1pbl92b2x0YWdlX2xldmVsID0gMjsKIH0KIAotdm9pZCBp
bnRlbF9kZGlfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKLQkJCSAg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnKQorc3RhdGljIHZvaWQgaW50ZWxf
ZGRpX3JlYWRfZnVuY19jdGwoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCisJCQkJICAg
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKIHsKIAlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2UuZGV2KTsKIAlzdHJ1
Y3QgaW50ZWxfY3J0YyAqaW50ZWxfY3J0YyA9IHRvX2ludGVsX2NydGMocGlwZV9jb25maWctPnVh
cGkuY3J0Yyk7CiAJZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyID0gcGlwZV9jb25maWct
PmNwdV90cmFuc2NvZGVyOwogCXUzMiB0ZW1wLCBmbGFncyA9IDA7CiAKLQkvKiBYWFg6IERTSSB0
cmFuc2NvZGVyIHBhcmFub2lhICovCi0JaWYgKFdBUk5fT04odHJhbnNjb2Rlcl9pc19kc2koY3B1
X3RyYW5zY29kZXIpKSkKKwl0ZW1wID0gSTkxNV9SRUFEKFRSQU5TX0RESV9GVU5DX0NUTChjcHVf
dHJhbnNjb2RlcikpOworCWlmICghKHRlbXAgJiBUUkFOU19ERElfRlVOQ19FTkFCTEUpKQogCQly
ZXR1cm47CiAKLQl0ZW1wID0gSTkxNV9SRUFEKFRSQU5TX0RESV9GVU5DX0NUTChjcHVfdHJhbnNj
b2RlcikpOwogCWlmICh0ZW1wICYgVFJBTlNfRERJX1BIU1lOQykKIAkJZmxhZ3MgfD0gRFJNX01P
REVfRkxBR19QSFNZTkM7CiAJZWxzZQpAQCAtNDA2Niw2ICs0MDY3LDI5IEBAIHZvaWQgaW50ZWxf
ZGRpX2dldF9jb25maWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJZGVmYXVsdDoK
IAkJYnJlYWs7CiAJfQorfQorCit2b2lkIGludGVsX2RkaV9nZXRfY29uZmlnKHN0cnVjdCBpbnRl
bF9lbmNvZGVyICplbmNvZGVyLAorCQkJICBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9j
b25maWcpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShl
bmNvZGVyLT5iYXNlLmRldik7CisJZW51bSB0cmFuc2NvZGVyIGNwdV90cmFuc2NvZGVyID0gcGlw
ZV9jb25maWctPmNwdV90cmFuc2NvZGVyOworCisJLyogWFhYOiBEU0kgdHJhbnNjb2RlciBwYXJh
bm9pYSAqLworCWlmIChXQVJOX09OKHRyYW5zY29kZXJfaXNfZHNpKGNwdV90cmFuc2NvZGVyKSkp
CisJCXJldHVybjsKKworCWludGVsX2RkaV9yZWFkX2Z1bmNfY3RsKGVuY29kZXIsIHBpcGVfY29u
ZmlnKTsKKwlpZiAocGlwZV9jb25maWctPmJpZ2pvaW5lcl9zbGF2ZSkgeworCQkvKiByZWFkIG91
dCBwaXBlIHNldHRpbmdzIGZyb20gbWFzdGVyICovCisJCWVudW0gdHJhbnNjb2RlciBzYXZlID0g
cGlwZV9jb25maWctPmNwdV90cmFuc2NvZGVyOworCisJCSAvKiBPdXIgb3duIHRyYW5zY29kZXIg
bmVlZHMgdG8gYmUgZGlzYWJsZWQgd2hlbiByZWFkaW5nIGl0IGluIGludGVsX2RkaV9yZWFkX2Z1
bmNfY3RsKCkgKi8KKwkJV0FSTl9PTihwaXBlX2NvbmZpZy0+b3V0cHV0X3R5cGVzKTsKKwkJcGlw
ZV9jb25maWctPmNwdV90cmFuc2NvZGVyID0gKGVudW0gdHJhbnNjb2RlcilwaXBlX2NvbmZpZy0+
Ymlnam9pbmVyX2xpbmtlZF9jcnRjLT5waXBlOworCQlpbnRlbF9kZGlfcmVhZF9mdW5jX2N0bChl
bmNvZGVyLCBwaXBlX2NvbmZpZyk7CisJCXBpcGVfY29uZmlnLT5jcHVfdHJhbnNjb2RlciA9IHNh
dmU7CisJfQogCiAJcGlwZV9jb25maWctPmhhc19hdWRpbyA9CiAJCWludGVsX2RkaV9pc19hdWRp
b19lbmFibGVkKGRldl9wcml2LCBjcHVfdHJhbnNjb2Rlcik7CkBAIC00MDkwLDcgKzQxMTQsOCBA
QCB2b2lkIGludGVsX2RkaV9nZXRfY29uZmlnKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVy
LAogCQlkZXZfcHJpdi0+dmJ0LmVkcC5icHAgPSBwaXBlX2NvbmZpZy0+cGlwZV9icHA7CiAJfQog
Ci0JaW50ZWxfZGRpX2Nsb2NrX2dldChlbmNvZGVyLCBwaXBlX2NvbmZpZyk7CisJaWYgKCFwaXBl
X2NvbmZpZy0+Ymlnam9pbmVyX3NsYXZlKQorCQlpbnRlbF9kZGlfY2xvY2tfZ2V0KGVuY29kZXIs
IHBpcGVfY29uZmlnKTsKIAogCWlmIChJU19HRU45X0xQKGRldl9wcml2KSkKIAkJcGlwZV9jb25m
aWctPmxhbmVfbGF0X29wdGltX21hc2sgPQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5
L2ludGVsX2Rpc3BsYXkuYwppbmRleCAxNDNkNTMxYzRjODEuLjhjMDhjNDkxNGM5YiAxMDA2NDQK
LS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTY0NDksNiAr
NjQ0OSw0NSBAQCBzdGF0aWMgdm9pZCBpY2xfcGlwZV9tYnVzX2VuYWJsZShzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YykKIAlJOTE1X1dSSVRFKFBJUEVfTUJVU19EQk9YX0NUTChwaXBlKSwgdmFsKTsK
IH0KIAorc3RhdGljIHZvaWQgaWNsX2RkaV9iaWdqb2luZXJfcHJlX2VuYWJsZShzdHJ1Y3QgaW50
ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSwKKwkJCQkJIHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlKQoreworCXN0cnVjdCBpbnRlbF9jcnRjICptYXN0ZXIgPSB0b19pbnRlbF9jcnRj
KGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CisJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm1hc3Rl
cl9jcnRjX3N0YXRlOworCXN0cnVjdCBkcm1fY29ubmVjdG9yX3N0YXRlICpjb25uX3N0YXRlOwor
CXN0cnVjdCBkcm1fY29ubmVjdG9yICpjb25uOworCXN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNv
ZGVyID0gTlVMTDsKKwlpbnQgaTsKKworCWlmIChjcnRjX3N0YXRlLT5iaWdqb2luZXJfc2xhdmUp
CisJCW1hc3RlciA9IGNydGNfc3RhdGUtPmJpZ2pvaW5lcl9saW5rZWRfY3J0YzsKKworCW1hc3Rl
cl9jcnRjX3N0YXRlID0gaW50ZWxfYXRvbWljX2dldF9uZXdfY3J0Y19zdGF0ZShzdGF0ZSwgbWFz
dGVyKTsKKworCWZvcl9lYWNoX25ld19jb25uZWN0b3JfaW5fc3RhdGUoJnN0YXRlLT5iYXNlLCBj
b25uLCBjb25uX3N0YXRlLCBpKSB7CisJCWlmIChjb25uX3N0YXRlLT5jcnRjICE9ICZtYXN0ZXIt
PmJhc2UpCisJCQljb250aW51ZTsKKworCQllbmNvZGVyID0gdG9faW50ZWxfZW5jb2Rlcihjb25u
X3N0YXRlLT5iZXN0X2VuY29kZXIpOworCQlicmVhazsKKwl9CisKKwlpZiAoIWNydGNfc3RhdGUt
PmJpZ2pvaW5lcl9zbGF2ZSkgeworCQkvKiBuZWVkIHRvIGVuYWJsZSBWRFNDLCB3aGljaCB3ZSBz
a2lwcGVkIGluIHByZS1lbmFibGUgKi8KKwkJaW50ZWxfZHNjX2VuYWJsZShlbmNvZGVyLCBjcnRj
X3N0YXRlKTsKKwl9IGVsc2UgeworCQkvKgorCQkgKiBFbmFibGUgc2VxdWVuY2Ugc3RlcHMgMS03
IG9uIGJpZ2pvaW5lciBtYXN0ZXIKKwkJICovCisJCWludGVsX2VuY29kZXJzX3ByZV9wbGxfZW5h
YmxlKG1hc3RlciwgbWFzdGVyX2NydGNfc3RhdGUsIHN0YXRlKTsKKwkJaW50ZWxfZW5hYmxlX3No
YXJlZF9kcGxsKG1hc3Rlcl9jcnRjX3N0YXRlKTsKKwkJaW50ZWxfZW5jb2RlcnNfcHJlX2VuYWJs
ZShtYXN0ZXIsIG1hc3Rlcl9jcnRjX3N0YXRlLCBzdGF0ZSk7CisKKwkJLyogYW5kIERTQyBvbiBz
bGF2ZSAqLworCQlpbnRlbF9kc2NfZW5hYmxlKE5VTEwsIGNydGNfc3RhdGUpOworCX0KK30KKwog
c3RhdGljIHZvaWQgaGFzd2VsbF9jcnRjX2VuYWJsZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
cGlwZV9jb25maWcsCiAJCQkJc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7CkBA
IC02NDYyLDM3ICs2NTAxLDM4IEBAIHN0YXRpYyB2b2lkIGhhc3dlbGxfY3J0Y19lbmFibGUoc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCWlmIChXQVJOX09OKGludGVsX2Ny
dGMtPmFjdGl2ZSkpCiAJCXJldHVybjsKIAotCWludGVsX2VuY29kZXJzX3ByZV9wbGxfZW5hYmxl
KGludGVsX2NydGMsIHBpcGVfY29uZmlnLCBzdGF0ZSk7CisJaWYgKCFwaXBlX2NvbmZpZy0+Ymln
am9pbmVyKSB7CisJCWludGVsX2VuY29kZXJzX3ByZV9wbGxfZW5hYmxlKGludGVsX2NydGMsIHBp
cGVfY29uZmlnLCBzdGF0ZSk7CiAKLQlpZiAocGlwZV9jb25maWctPnNoYXJlZF9kcGxsKQotCQlp
bnRlbF9lbmFibGVfc2hhcmVkX2RwbGwocGlwZV9jb25maWcpOworCQlpZiAocGlwZV9jb25maWct
PnNoYXJlZF9kcGxsKQorCQkJaW50ZWxfZW5hYmxlX3NoYXJlZF9kcGxsKHBpcGVfY29uZmlnKTsK
IAotCWludGVsX2VuY29kZXJzX3ByZV9lbmFibGUoaW50ZWxfY3J0YywgcGlwZV9jb25maWcsIHN0
YXRlKTsKKwkJaW50ZWxfZW5jb2RlcnNfcHJlX2VuYWJsZShpbnRlbF9jcnRjLCBwaXBlX2NvbmZp
Zywgc3RhdGUpOworCX0gZWxzZSB7CisJCWljbF9kZGlfYmlnam9pbmVyX3ByZV9lbmFibGUoc3Rh
dGUsIHBpcGVfY29uZmlnKTsKKwl9CiAKLQlpZiAoaW50ZWxfY3J0Y19oYXNfZHBfZW5jb2Rlcihw
aXBlX2NvbmZpZykpCi0JCWludGVsX2RwX3NldF9tX24ocGlwZV9jb25maWcsIE0xX04xKTsKKwlp
bnRlbF9zZXRfcGlwZV9zcmNfc2l6ZShwaXBlX2NvbmZpZyk7CisJaWYgKElOVEVMX0dFTihkZXZf
cHJpdikgPj0gOSB8fCBJU19CUk9BRFdFTEwoZGV2X3ByaXYpKQorCQliZHdfc2V0X3BpcGVtaXNj
KHBpcGVfY29uZmlnKTsKIAotCWlmICghdHJhbnNjb2Rlcl9pc19kc2koY3B1X3RyYW5zY29kZXIp
KQotCQlpbnRlbF9zZXRfcGlwZV90aW1pbmdzKHBpcGVfY29uZmlnKTsKKwlpZiAoIXBpcGVfY29u
ZmlnLT5iaWdqb2luZXJfc2xhdmUgJiYgIXRyYW5zY29kZXJfaXNfZHNpKGNwdV90cmFuc2NvZGVy
KSkgeworCQlpZiAoaW50ZWxfY3J0Y19oYXNfZHBfZW5jb2RlcihwaXBlX2NvbmZpZykpCisJCQlp
bnRlbF9kcF9zZXRfbV9uKHBpcGVfY29uZmlnLCBNMV9OMSk7CiAKLQlpbnRlbF9zZXRfcGlwZV9z
cmNfc2l6ZShwaXBlX2NvbmZpZyk7CisJCWludGVsX3NldF9waXBlX3RpbWluZ3MocGlwZV9jb25m
aWcpOwogCi0JaWYgKGNwdV90cmFuc2NvZGVyICE9IFRSQU5TQ09ERVJfRURQICYmCi0JICAgICF0
cmFuc2NvZGVyX2lzX2RzaShjcHVfdHJhbnNjb2RlcikpIHsKLQkJSTkxNV9XUklURShQSVBFX01V
TFQoY3B1X3RyYW5zY29kZXIpLAotCQkJICAgcGlwZV9jb25maWctPnBpeGVsX211bHRpcGxpZXIg
LSAxKTsKLQl9CisJCWlmIChjcHVfdHJhbnNjb2RlciAhPSBUUkFOU0NPREVSX0VEUCkKKwkJCUk5
MTVfV1JJVEUoUElQRV9NVUxUKGNwdV90cmFuc2NvZGVyKSwKKwkJCQkgIHBpcGVfY29uZmlnLT5w
aXhlbF9tdWx0aXBsaWVyIC0gMSk7CiAKLQlpZiAocGlwZV9jb25maWctPmhhc19wY2hfZW5jb2Rl
cikgewotCQlpbnRlbF9jcHVfdHJhbnNjb2Rlcl9zZXRfbV9uKHBpcGVfY29uZmlnLAotCQkJCQkg
ICAgICZwaXBlX2NvbmZpZy0+ZmRpX21fbiwgTlVMTCk7Ci0JfQorCQlpZiAocGlwZV9jb25maWct
Pmhhc19wY2hfZW5jb2RlcikgeworCQkJaW50ZWxfY3B1X3RyYW5zY29kZXJfc2V0X21fbihwaXBl
X2NvbmZpZywKKwkJCQkJCSAgICAmcGlwZV9jb25maWctPmZkaV9tX24sIE5VTEwpOworCQl9CiAK
LQlpZiAoIXRyYW5zY29kZXJfaXNfZHNpKGNwdV90cmFuc2NvZGVyKSkKIAkJaGFzd2VsbF9zZXRf
cGlwZWNvbmYocGlwZV9jb25maWcpOwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gOSB8
fCBJU19CUk9BRFdFTEwoZGV2X3ByaXYpKQotCQliZHdfc2V0X3BpcGVtaXNjKHBpcGVfY29uZmln
KTsKKwl9CiAKIAlpbnRlbF9jcnRjLT5hY3RpdmUgPSB0cnVlOwogCkBAIC02NTIwLDkgKzY1NjAs
MTEgQEAgc3RhdGljIHZvaWQgaGFzd2VsbF9jcnRjX2VuYWJsZShzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqcGlwZV9jb25maWcsCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEpCiAJCWlj
bF9zZXRfcGlwZV9jaGlja2VuKGludGVsX2NydGMpOwogCi0JaW50ZWxfZGRpX3NldF9waXBlX3Nl
dHRpbmdzKHBpcGVfY29uZmlnKTsKLQlpZiAoIXRyYW5zY29kZXJfaXNfZHNpKGNwdV90cmFuc2Nv
ZGVyKSkKKwlpZiAoIXBpcGVfY29uZmlnLT5iaWdqb2luZXJfc2xhdmUgJiYgIXRyYW5zY29kZXJf
aXNfZHNpKGNwdV90cmFuc2NvZGVyKSkgeworCQlpbnRlbF9kZGlfc2V0X3BpcGVfc2V0dGluZ3Mo
cGlwZV9jb25maWcpOworCiAJCWludGVsX2RkaV9lbmFibGVfdHJhbnNjb2Rlcl9mdW5jKHBpcGVf
Y29uZmlnKTsKKwl9CiAKIAlpZiAoZGV2X3ByaXYtPmRpc3BsYXkuaW5pdGlhbF93YXRlcm1hcmtz
ICE9IE5VTEwpCiAJCWRldl9wcml2LT5kaXNwbGF5LmluaXRpYWxfd2F0ZXJtYXJrcyhzdGF0ZSwg
cGlwZV9jb25maWcpOwpAQCAtNjUzMSw4ICs2NTczLDEwIEBAIHN0YXRpYyB2b2lkIGhhc3dlbGxf
Y3J0Y19lbmFibGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmlnLAogCQlpY2xf
cGlwZV9tYnVzX2VuYWJsZShpbnRlbF9jcnRjKTsKIAogCS8qIFhYWDogRG8gdGhlIHBpcGUgYXNz
ZXJ0aW9ucyBhdCB0aGUgcmlnaHQgcGxhY2UgZm9yIEJYVCBEU0kuICovCi0JaWYgKCF0cmFuc2Nv
ZGVyX2lzX2RzaShjcHVfdHJhbnNjb2RlcikpCisJaWYgKCFwaXBlX2NvbmZpZy0+Ymlnam9pbmVy
X3NsYXZlICYmICF0cmFuc2NvZGVyX2lzX2RzaShjcHVfdHJhbnNjb2RlcikpCiAJCWludGVsX2Vu
YWJsZV9waXBlKHBpcGVfY29uZmlnKTsKKwllbHNlCisJCXRyYWNlX2ludGVsX3BpcGVfZW5hYmxl
KGludGVsX2NydGMpOwogCiAJaWYgKHBpcGVfY29uZmlnLT5oYXNfcGNoX2VuY29kZXIpCiAJCWxw
dF9wY2hfZW5hYmxlKHN0YXRlLCBwaXBlX2NvbmZpZyk7CkBAIC02NjYzLDkgKzY3MDcsMjcgQEAg
c3RhdGljIHZvaWQgaGFzd2VsbF9jcnRjX2Rpc2FibGUoc3RydWN0IGludGVsX2NydGNfc3RhdGUg
Km9sZF9jcnRjX3N0YXRlLAogCWVsc2UKIAkJaXJvbmxha2VfcGZpdF9kaXNhYmxlKG9sZF9jcnRj
X3N0YXRlKTsKIAotCWludGVsX2VuY29kZXJzX3Bvc3RfZGlzYWJsZShpbnRlbF9jcnRjLCBvbGRf
Y3J0Y19zdGF0ZSwgc3RhdGUpOworCWlmIChvbGRfY3J0Y19zdGF0ZS0+Ymlnam9pbmVyKSB7CisJ
CXN0cnVjdCBpbnRlbF9jcnRjICptYXN0ZXI7CisJCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpt
YXN0ZXJfY3J0Y19zdGF0ZTsKIAotCWludGVsX2VuY29kZXJzX3Bvc3RfcGxsX2Rpc2FibGUoaW50
ZWxfY3J0Yywgb2xkX2NydGNfc3RhdGUsIHN0YXRlKTsKKwkJLyogcG9ydHMgYXJlIGRpc2FibGVk
IGZyb20gdGhlIHNsYXZlLCBhZnRlciBpdCBkZWNvbmZpZ3VyZXMgKi8KKwkJaWYgKCFvbGRfY3J0
Y19zdGF0ZS0+Ymlnam9pbmVyX3NsYXZlKQorCQkJcmV0dXJuOworCisJCW1hc3RlciA9IG9sZF9j
cnRjX3N0YXRlLT5iaWdqb2luZXJfbGlua2VkX2NydGM7CisJCW1hc3Rlcl9jcnRjX3N0YXRlID0g
aW50ZWxfYXRvbWljX2dldF9vbGRfY3J0Y19zdGF0ZShzdGF0ZSwgbWFzdGVyKTsKKworCQlpbnRl
bF9kZGlfZGlzYWJsZV9waXBlX2Nsb2NrKG9sZF9jcnRjX3N0YXRlKTsKKworCQkvKiBkaXNhYmxl
IHBvcnRzIG9uIHRoZSBtYXN0ZXIgY3J0YyAqLworCQlpbnRlbF9lbmNvZGVyc19wb3N0X2Rpc2Fi
bGUobWFzdGVyLCBtYXN0ZXJfY3J0Y19zdGF0ZSwgc3RhdGUpOworCQlpbnRlbF9lbmNvZGVyc19w
b3N0X3BsbF9kaXNhYmxlKG1hc3RlciwgbWFzdGVyX2NydGNfc3RhdGUsIHN0YXRlKTsKKwl9IGVs
c2UgeworCQlpbnRlbF9lbmNvZGVyc19wb3N0X2Rpc2FibGUoaW50ZWxfY3J0Yywgb2xkX2NydGNf
c3RhdGUsIHN0YXRlKTsKKworCQlpbnRlbF9lbmNvZGVyc19wb3N0X3BsbF9kaXNhYmxlKGludGVs
X2NydGMsIG9sZF9jcnRjX3N0YXRlLCBzdGF0ZSk7CisJfQogfQogCiBzdGF0aWMgdm9pZCBpOXh4
X3BmaXRfZW5hYmxlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQpA
QCAtNjgyOSw2ICs2ODkxLDkgQEAgc3RhdGljIHU2NCBnZXRfY3J0Y19wb3dlcl9kb21haW5zKHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCWlmIChjcnRjX3N0YXRlLT5zaGFy
ZWRfZHBsbCkKIAkJbWFzayB8PSBCSVRfVUxMKFBPV0VSX0RPTUFJTl9ESVNQTEFZX0NPUkUpOwog
CisJaWYgKGNydGNfc3RhdGUtPmRzY19wYXJhbXMuY29tcHJlc3Npb25fZW5hYmxlKQorCQltYXNr
IHw9IEJJVF9VTEwoaW50ZWxfZHNjX3Bvd2VyX2RvbWFpbihjcnRjX3N0YXRlKSk7CisKIAlyZXR1
cm4gbWFzazsKIH0KIApAQCAtNzQxNyw2ICs3NDgyLDE5IEBAIHN0YXRpYyB1MzIgaWxrX3BpcGVf
cGl4ZWxfcmF0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiAJ
cmV0dXJuIHBpeGVsX3JhdGU7CiB9CiAKK3N0YXRpYyB2b2lkIGludGVsX2VuY29kZXJfZ2V0X2Nv
bmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKKwkJCQkgICAgIHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQoreworCWVuY29kZXItPmdldF9jb25maWcoZW5jb2Rl
ciwgY3J0Y19zdGF0ZSk7CisKKwljcnRjX3N0YXRlLT5ody50cmFuc2NvZGVyX21vZGUuZmxhZ3Mg
PSBjcnRjX3N0YXRlLT5ody5hZGp1c3RlZF9tb2RlLmZsYWdzOworCisJLyogaWYgdHJhbnNjb2Rl
ciBjbG9jayBpcyBub3Qgc2V0LCBhc3N1bWUgc2FtZSBhcyBhZGp1c3RlZF9tb2RlIGNsb2NrICov
CisJaWYgKCFjcnRjX3N0YXRlLT5ody50cmFuc2NvZGVyX21vZGUuY3J0Y19jbG9jaykKKwkJY3J0
Y19zdGF0ZS0+aHcudHJhbnNjb2Rlcl9tb2RlLmNydGNfY2xvY2sgPQorCQkJY3J0Y19zdGF0ZS0+
aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrOworfQorCiBzdGF0aWMgdm9pZCBpbnRlbF9jcnRj
X2NvbXB1dGVfcGl4ZWxfcmF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkK
IHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGNfc3Rh
dGUtPnVhcGkuY3J0Yy0+ZGV2KTsKQEAgLTgyNjUsNiArODM0MywyNCBAQCBzdGF0aWMgdm9pZCBp
bnRlbF9nZXRfcGlwZV90aW1pbmdzKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQlwaXBlX2Nv
bmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3Z0b3RhbCArPSAxOwogCQlwaXBlX2NvbmZpZy0+
aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZibGFua19lbmQgKz0gMTsKIAl9CisKKwlwaXBlX2NvbmZp
Zy0+aHcudHJhbnNjb2Rlcl9tb2RlID0gcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGU7CisJ
aWYgKHBpcGVfY29uZmlnLT5iaWdqb2luZXIpIHsKKwkJc3RydWN0IGRybV9kaXNwbGF5X21vZGUg
KmFkanVzdGVkX21vZGUgPQorCQkJJnBpcGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlOworCisJ
CS8qCisJCSAgKiB0cmFuc2NvZGVyIGlzIHByb2dyYW1tZWQgdG8gdGhlIGZ1bGwgbW9kZSwKKwkJ
ICAqIGJ1dCBwaXBqZSB0aW1pbmdzIGFyZSBoYWxmIG9mIHRoZSB0cmFuc2NvZGVyIG1vZGUKKwkJ
ICAqLworCQlhZGp1c3RlZF9tb2RlLT5jcnRjX2hkaXNwbGF5IC89IDI7CisJCWFkanVzdGVkX21v
ZGUtPmNydGNfaGJsYW5rX3N0YXJ0IC89IDI7CisJCWFkanVzdGVkX21vZGUtPmNydGNfaGJsYW5r
X2VuZCAvPSAyOworCQlhZGp1c3RlZF9tb2RlLT5jcnRjX2hzeW5jX3N0YXJ0IC89IDI7CisJCWFk
anVzdGVkX21vZGUtPmNydGNfaHN5bmNfZW5kIC89IDI7CisJCWFkanVzdGVkX21vZGUtPmNydGNf
aHRvdGFsIC89IDI7CisJCWFkanVzdGVkX21vZGUtPmNydGNfaHNrZXcgLz0gMjsKKwl9CiB9CiAK
IHN0YXRpYyB2b2lkIGludGVsX2dldF9waXBlX3NyY19zaXplKHN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjLApAQCAtODI4NSwyMCArODM4MSwyMiBAQCBzdGF0aWMgdm9pZCBpbnRlbF9nZXRfcGlwZV9z
cmNfc2l6ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIHZvaWQgaW50ZWxfbW9kZV9mcm9tX3Bp
cGVfY29uZmlnKHN0cnVjdCBkcm1fZGlzcGxheV9tb2RlICptb2RlLAogCQkJCSBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiB7Ci0JbW9kZS0+aGRpc3BsYXkgPSBwaXBlX2Nv
bmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2hkaXNwbGF5OwotCW1vZGUtPmh0b3RhbCA9IHBp
cGVfY29uZmlnLT5ody5hZGp1c3RlZF9tb2RlLmNydGNfaHRvdGFsOwotCW1vZGUtPmhzeW5jX3N0
YXJ0ID0gcGlwZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y19oc3luY19zdGFydDsKLQlt
b2RlLT5oc3luY19lbmQgPSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2hzeW5j
X2VuZDsKKwlzdHJ1Y3QgZHJtX2Rpc3BsYXlfbW9kZSAqaHdfbW9kZSA9ICZwaXBlX2NvbmZpZy0+
aHcudHJhbnNjb2Rlcl9tb2RlOwogCi0JbW9kZS0+dmRpc3BsYXkgPSBwaXBlX2NvbmZpZy0+aHcu
YWRqdXN0ZWRfbW9kZS5jcnRjX3ZkaXNwbGF5OwotCW1vZGUtPnZ0b3RhbCA9IHBpcGVfY29uZmln
LT5ody5hZGp1c3RlZF9tb2RlLmNydGNfdnRvdGFsOwotCW1vZGUtPnZzeW5jX3N0YXJ0ID0gcGlw
ZV9jb25maWctPmh3LmFkanVzdGVkX21vZGUuY3J0Y192c3luY19zdGFydDsKLQltb2RlLT52c3lu
Y19lbmQgPSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZzeW5jX2VuZDsKKwlt
b2RlLT5oZGlzcGxheSA9IGh3X21vZGUtPmNydGNfaGRpc3BsYXk7CisJbW9kZS0+aHRvdGFsID0g
aHdfbW9kZS0+Y3J0Y19odG90YWw7CisJbW9kZS0+aHN5bmNfc3RhcnQgPSBod19tb2RlLT5jcnRj
X2hzeW5jX3N0YXJ0OworCW1vZGUtPmhzeW5jX2VuZCA9IGh3X21vZGUtPmNydGNfaHN5bmNfZW5k
OwogCi0JbW9kZS0+ZmxhZ3MgPSBwaXBlX2NvbmZpZy0+aHcuYWRqdXN0ZWRfbW9kZS5mbGFnczsK
Kwltb2RlLT52ZGlzcGxheSA9IGh3X21vZGUtPmNydGNfdmRpc3BsYXk7CisJbW9kZS0+dnRvdGFs
ID0gaHdfbW9kZS0+Y3J0Y192dG90YWw7CisJbW9kZS0+dnN5bmNfc3RhcnQgPSBod19tb2RlLT5j
cnRjX3ZzeW5jX3N0YXJ0OworCW1vZGUtPnZzeW5jX2VuZCA9IGh3X21vZGUtPmNydGNfdnN5bmNf
ZW5kOworCisJbW9kZS0+ZmxhZ3MgPSBod19tb2RlLT5mbGFnczsKIAltb2RlLT50eXBlID0gRFJN
X01PREVfVFlQRV9EUklWRVI7CiAKLQltb2RlLT5jbG9jayA9IHBpcGVfY29uZmlnLT5ody5hZGp1
c3RlZF9tb2RlLmNydGNfY2xvY2s7CisJbW9kZS0+Y2xvY2sgPSBod19tb2RlLT5jcnRjX2Nsb2Nr
OwogCiAJbW9kZS0+aHN5bmMgPSBkcm1fbW9kZV9oc3luYyhtb2RlKTsKIAltb2RlLT52cmVmcmVz
aCA9IGRybV9tb2RlX3ZyZWZyZXNoKG1vZGUpOwpAQCAtMTAzODUsNiArMTA0ODMsOCBAQCBzdGF0
aWMgdm9pZCBoYXN3ZWxsX2dldF9kZGlfcG9ydF9zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0
YywKIAl1MzIgdG1wOwogCiAJdG1wID0gSTkxNV9SRUFEKFRSQU5TX0RESV9GVU5DX0NUTChwaXBl
X2NvbmZpZy0+Y3B1X3RyYW5zY29kZXIpKTsKKwlpZiAoISh0bXAgJiBUUkFOU19ERElfRlVOQ19F
TkFCTEUpKQorCQlyZXR1cm47CiAKIAlpZiAoSU5URUxfR0VOKGRldl9wcml2KSA+PSAxMikKIAkJ
cG9ydCA9IFRHTF9UUkFOU19ERElfRlVOQ19DVExfVkFMX1RPX1BPUlQodG1wKTsKQEAgLTEwNDU1
LDExICsxMDU1NSwxOSBAQCBzdGF0aWMgYm9vbCBoYXN3ZWxsX2dldF9waXBlX2NvbmZpZyhzdHJ1
Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJV0FSTl9PTihhY3RpdmUpOwogCQlhY3RpdmUgPSB0cnVl
OwogCX0KKwlpbnRlbF9kc2NfZ2V0X2NvbmZpZyhwaXBlX2NvbmZpZyk7CiAKLQlpZiAoIWFjdGl2
ZSkKLQkJZ290byBvdXQ7CisJaWYgKCFhY3RpdmUpIHsKKwkJLyogYmlnam9pbmVyIHNsYXZlIGRv
ZXNuJ3QgZW5hYmxlIHRyYW5zY29kZXIgKi8KKwkJaWYgKCFwaXBlX2NvbmZpZy0+Ymlnam9pbmVy
X3NsYXZlKQorCQkJZ290byBvdXQ7CisKKwkJYWN0aXZlID0gdHJ1ZTsKKwkJcGlwZV9jb25maWct
PnBpeGVsX211bHRpcGxpZXIgPSAxOwogCi0JaWYgKCF0cmFuc2NvZGVyX2lzX2RzaShwaXBlX2Nv
bmZpZy0+Y3B1X3RyYW5zY29kZXIpIHx8CisJCS8qIHdlIGNhbm5vdCByZWFkIG91dCBtb3N0IHN0
YXRlLCBzbyBkb24ndCBib3RoZXIuLiAqLworCQlwaXBlX2NvbmZpZy0+cXVpcmtzIHw9IFBJUEVf
Q09ORklHX1FVSVJLX0JJR0pPSU5FUl9TTEFWRTsKKwl9IGVsc2UgaWYgKCF0cmFuc2NvZGVyX2lz
X2RzaShwaXBlX2NvbmZpZy0+Y3B1X3RyYW5zY29kZXIpIHx8CiAJICAgIElOVEVMX0dFTihkZXZf
cHJpdikgPj0gMTEpIHsKIAkJaGFzd2VsbF9nZXRfZGRpX3BvcnRfc3RhdGUoY3J0YywgcGlwZV9j
b25maWcpOwogCQlpbnRlbF9nZXRfcGlwZV90aW1pbmdzKGNydGMsIHBpcGVfY29uZmlnKTsKQEAg
LTEwNTEzLDcgKzEwNjIxLDEwIEBAIHN0YXRpYyBib29sIGhhc3dlbGxfZ2V0X3BpcGVfY29uZmln
KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQl9CiAJfQogCi0JaWYgKHBpcGVfY29uZmlnLT5j
cHVfdHJhbnNjb2RlciAhPSBUUkFOU0NPREVSX0VEUCAmJgorCWlmIChwaXBlX2NvbmZpZy0+Ymln
am9pbmVyX3NsYXZlKSB7CisJCS8qIENhbm5vdCBiZSByZWFkIG91dCBhcyBhIHNsYXZlLCBzZXQg
dG8gMC4gKi8KKwkJcGlwZV9jb25maWctPnBpeGVsX211bHRpcGxpZXIgPSAwOworCX0gZWxzZSBp
ZiAocGlwZV9jb25maWctPmNwdV90cmFuc2NvZGVyICE9IFRSQU5TQ09ERVJfRURQICYmCiAJICAg
ICF0cmFuc2NvZGVyX2lzX2RzaShwaXBlX2NvbmZpZy0+Y3B1X3RyYW5zY29kZXIpKSB7CiAJCXBp
cGVfY29uZmlnLT5waXhlbF9tdWx0aXBsaWVyID0KIAkJCUk5MTVfUkVBRChQSVBFX01VTFQocGlw
ZV9jb25maWctPmNwdV90cmFuc2NvZGVyKSkgKyAxOwpAQCAtMTE0NjgsNyArMTE1NzksNyBAQCBp
bnRlbF9lbmNvZGVyX2N1cnJlbnRfbW9kZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlcikK
IAkJcmV0dXJuIE5VTEw7CiAJfQogCi0JZW5jb2Rlci0+Z2V0X2NvbmZpZyhlbmNvZGVyLCBjcnRj
X3N0YXRlKTsKKwlpbnRlbF9lbmNvZGVyX2dldF9jb25maWcoZW5jb2RlciwgY3J0Y19zdGF0ZSk7
CiAKIAlpbnRlbF9tb2RlX2Zyb21fcGlwZV9jb25maWcobW9kZSwgY3J0Y19zdGF0ZSk7CiAKQEAg
LTEyMjg1LDkgKzEyMzk2LDExIEBAIHN0YXRpYyB2b2lkIGNvcHlfdWFwaV90b19od19zdGF0ZShz
dHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAogc3RhdGljIHZvaWQgY29weV9o
d190b191YXBpX3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogewot
CWNydGNfc3RhdGUtPnVhcGkuZW5hYmxlID0gY3J0Y19zdGF0ZS0+aHcuZW5hYmxlOwotCWNydGNf
c3RhdGUtPnVhcGkuYWN0aXZlID0gY3J0Y19zdGF0ZS0+aHcuYWN0aXZlOwotCWNydGNfc3RhdGUt
PnVhcGkubW9kZSA9IGNydGNfc3RhdGUtPmh3Lm1vZGU7CisJaWYgKCFjcnRjX3N0YXRlLT5iaWdq
b2luZXJfc2xhdmUpIHsKKwkJY3J0Y19zdGF0ZS0+dWFwaS5lbmFibGUgPSBjcnRjX3N0YXRlLT5o
dy5lbmFibGU7CisJCWNydGNfc3RhdGUtPnVhcGkuYWN0aXZlID0gY3J0Y19zdGF0ZS0+aHcuYWN0
aXZlOworCQljcnRjX3N0YXRlLT51YXBpLm1vZGUgPSBjcnRjX3N0YXRlLT5ody5tb2RlOworCX0K
IAljcnRjX3N0YXRlLT51YXBpLmFkanVzdGVkX21vZGUgPSBjcnRjX3N0YXRlLT5ody50cmFuc2Nv
ZGVyX21vZGU7CiB9CiAKQEAgLTEyMzE4LDYgKzEyNDMxLDcgQEAgY29weV9iaWdqb2luZXJfY3J0
Y19zdGF0ZShzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAljcnRjX3N0YXRl
LT5ody5hY3RpdmUgPSBmcm9tX2NydGNfc3RhdGUtPmh3LmFjdGl2ZTsKIAljcnRjX3N0YXRlLT5o
dy5tb2RlID0gZnJvbV9jcnRjX3N0YXRlLT5ody5tb2RlOwogCWNydGNfc3RhdGUtPmh3LmFkanVz
dGVkX21vZGUgPSBmcm9tX2NydGNfc3RhdGUtPmh3LmFkanVzdGVkX21vZGU7CisJY3J0Y19zdGF0
ZS0+aHcudHJhbnNjb2Rlcl9tb2RlID0gZnJvbV9jcnRjX3N0YXRlLT5ody50cmFuc2NvZGVyX21v
ZGU7CiAKIAkvKiBTb21lIGZpeHVwcyAqLwogCWNydGNfc3RhdGUtPnVhcGkubW9kZV9jaGFuZ2Vk
ID0gZnJvbV9jcnRjX3N0YXRlLT51YXBpLm1vZGVfY2hhbmdlZDsKQEAgLTEyODMzLDE5ICsxMjk0
Nyw0MSBAQCBpbnRlbF9waXBlX2NvbmZpZ19jb21wYXJlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRj
X3N0YXRlICpjdXJyZW50X2NvbmZpZywKIAogCVBJUEVfQ09ORl9DSEVDS19YKG91dHB1dF90eXBl
cyk7CiAKLQlQSVBFX0NPTkZfQ0hFQ0tfSShody5hZGp1c3RlZF9tb2RlLmNydGNfaGRpc3BsYXkp
OwotCVBJUEVfQ09ORl9DSEVDS19JKGh3LmFkanVzdGVkX21vZGUuY3J0Y19odG90YWwpOwotCVBJ
UEVfQ09ORl9DSEVDS19JKGh3LmFkanVzdGVkX21vZGUuY3J0Y19oYmxhbmtfc3RhcnQpOwotCVBJ
UEVfQ09ORl9DSEVDS19JKGh3LmFkanVzdGVkX21vZGUuY3J0Y19oYmxhbmtfZW5kKTsKLQlQSVBF
X0NPTkZfQ0hFQ0tfSShody5hZGp1c3RlZF9tb2RlLmNydGNfaHN5bmNfc3RhcnQpOwotCVBJUEVf
Q09ORl9DSEVDS19JKGh3LmFkanVzdGVkX21vZGUuY3J0Y19oc3luY19lbmQpOwotCi0JUElQRV9D
T05GX0NIRUNLX0koaHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZkaXNwbGF5KTsKLQlQSVBFX0NPTkZf
Q0hFQ0tfSShody5hZGp1c3RlZF9tb2RlLmNydGNfdnRvdGFsKTsKLQlQSVBFX0NPTkZfQ0hFQ0tf
SShody5hZGp1c3RlZF9tb2RlLmNydGNfdmJsYW5rX3N0YXJ0KTsKLQlQSVBFX0NPTkZfQ0hFQ0tf
SShody5hZGp1c3RlZF9tb2RlLmNydGNfdmJsYW5rX2VuZCk7Ci0JUElQRV9DT05GX0NIRUNLX0ko
aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZzeW5jX3N0YXJ0KTsKLQlQSVBFX0NPTkZfQ0hFQ0tfSSho
dy5hZGp1c3RlZF9tb2RlLmNydGNfdnN5bmNfZW5kKTsKKwlpZiAoIVBJUEVfQ09ORl9RVUlSSyhQ
SVBFX0NPTkZJR19RVUlSS19CSUdKT0lORVJfU0xBVkUpKSB7CisJCS8qIGJpZ2pvaW5lciBtb2Rl
ID0gdHJhbnNjb2RlciBtb2RlIC8gMiwgZm9yIGNhbGN1bGF0aW9ucyAqLworCQlQSVBFX0NPTkZf
Q0hFQ0tfSShody5hZGp1c3RlZF9tb2RlLmNydGNfaGRpc3BsYXkpOworCQlQSVBFX0NPTkZfQ0hF
Q0tfSShody5hZGp1c3RlZF9tb2RlLmNydGNfaHRvdGFsKTsKKwkJUElQRV9DT05GX0NIRUNLX0ko
aHcuYWRqdXN0ZWRfbW9kZS5jcnRjX3ZkaXNwbGF5KTsKKwkJUElQRV9DT05GX0NIRUNLX0koaHcu
YWRqdXN0ZWRfbW9kZS5jcnRjX3Z0b3RhbCk7CisKKwkJUElQRV9DT05GX0NIRUNLX0koaHcudHJh
bnNjb2Rlcl9tb2RlLmNydGNfaGRpc3BsYXkpOworCQlQSVBFX0NPTkZfQ0hFQ0tfSShody50cmFu
c2NvZGVyX21vZGUuY3J0Y19odG90YWwpOworCQlQSVBFX0NPTkZfQ0hFQ0tfSShody50cmFuc2Nv
ZGVyX21vZGUuY3J0Y19oYmxhbmtfc3RhcnQpOworCQlQSVBFX0NPTkZfQ0hFQ0tfSShody50cmFu
c2NvZGVyX21vZGUuY3J0Y19oYmxhbmtfZW5kKTsKKwkJUElQRV9DT05GX0NIRUNLX0koaHcudHJh
bnNjb2Rlcl9tb2RlLmNydGNfaHN5bmNfc3RhcnQpOworCQlQSVBFX0NPTkZfQ0hFQ0tfSShody50
cmFuc2NvZGVyX21vZGUuY3J0Y19oc3luY19lbmQpOworCisJCVBJUEVfQ09ORl9DSEVDS19JKGh3
LnRyYW5zY29kZXJfbW9kZS5jcnRjX3ZkaXNwbGF5KTsKKwkJUElQRV9DT05GX0NIRUNLX0koaHcu
dHJhbnNjb2Rlcl9tb2RlLmNydGNfdnRvdGFsKTsKKwkJUElQRV9DT05GX0NIRUNLX0koaHcudHJh
bnNjb2Rlcl9tb2RlLmNydGNfdmJsYW5rX3N0YXJ0KTsKKwkJUElQRV9DT05GX0NIRUNLX0koaHcu
dHJhbnNjb2Rlcl9tb2RlLmNydGNfdmJsYW5rX2VuZCk7CisJCVBJUEVfQ09ORl9DSEVDS19JKGh3
LnRyYW5zY29kZXJfbW9kZS5jcnRjX3ZzeW5jX3N0YXJ0KTsKKwkJUElQRV9DT05GX0NIRUNLX0ko
aHcudHJhbnNjb2Rlcl9tb2RlLmNydGNfdnN5bmNfZW5kKTsKKworCQlQSVBFX0NPTkZfQ0hFQ0tf
RkxBR1MoaHcudHJhbnNjb2Rlcl9tb2RlLmZsYWdzLAorCQkJCSAgICAgIERSTV9NT0RFX0ZMQUdf
SU5URVJMQUNFKTsKKworCQlpZiAoIVBJUEVfQ09ORl9RVUlSSyhQSVBFX0NPTkZJR19RVUlSS19N
T0RFX1NZTkNfRkxBR1MpKSB7CisJCQlQSVBFX0NPTkZfQ0hFQ0tfRkxBR1MoaHcudHJhbnNjb2Rl
cl9tb2RlLmZsYWdzLAorCQkJCQkgICAgICBEUk1fTU9ERV9GTEFHX1BIU1lOQyk7CisJCQlQSVBF
X0NPTkZfQ0hFQ0tfRkxBR1MoaHcudHJhbnNjb2Rlcl9tb2RlLmZsYWdzLAorCQkJCQkgICAgICBE
Uk1fTU9ERV9GTEFHX05IU1lOQyk7CisJCQlQSVBFX0NPTkZfQ0hFQ0tfRkxBR1MoaHcudHJhbnNj
b2Rlcl9tb2RlLmZsYWdzLAorCQkJCQkgICAgICBEUk1fTU9ERV9GTEFHX1BWU1lOQyk7CisJCQlQ
SVBFX0NPTkZfQ0hFQ0tfRkxBR1MoaHcudHJhbnNjb2Rlcl9tb2RlLmZsYWdzLAorCQkJCQkgICAg
ICBEUk1fTU9ERV9GTEFHX05WU1lOQyk7CisJCX0KKwl9CiAKIAlQSVBFX0NPTkZfQ0hFQ0tfSShw
aXhlbF9tdWx0aXBsaWVyKTsKIAlQSVBFX0NPTkZfQ0hFQ0tfSShvdXRwdXRfZm9ybWF0KTsKQEAg
LTEyODU3LDI0ICsxMjk5MywxMSBAQCBpbnRlbF9waXBlX2NvbmZpZ19jb21wYXJlKGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjdXJyZW50X2NvbmZpZywKIAlQSVBFX0NPTkZfQ0hFQ0tf
Qk9PTChoZG1pX3NjcmFtYmxpbmcpOwogCVBJUEVfQ09ORl9DSEVDS19CT09MKGhkbWlfaGlnaF90
bWRzX2Nsb2NrX3JhdGlvKTsKIAlQSVBFX0NPTkZfQ0hFQ0tfQk9PTChoYXNfaW5mb2ZyYW1lKTsK
LQlQSVBFX0NPTkZfQ0hFQ0tfQk9PTChmZWNfZW5hYmxlKTsKKwlpZiAoIVBJUEVfQ09ORl9RVUlS
SyhQSVBFX0NPTkZJR19RVUlSS19CSUdKT0lORVJfU0xBVkUpKQorCQlQSVBFX0NPTkZfQ0hFQ0tf
Qk9PTChmZWNfZW5hYmxlKTsKIAogCVBJUEVfQ09ORl9DSEVDS19CT09MX0lOQ09NUExFVEUoaGFz
X2F1ZGlvKTsKIAotCVBJUEVfQ09ORl9DSEVDS19GTEFHUyhody5hZGp1c3RlZF9tb2RlLmZsYWdz
LAotCQkJICAgICAgRFJNX01PREVfRkxBR19JTlRFUkxBQ0UpOwotCi0JaWYgKCFQSVBFX0NPTkZf
UVVJUksoUElQRV9DT05GSUdfUVVJUktfTU9ERV9TWU5DX0ZMQUdTKSkgewotCQlQSVBFX0NPTkZf
Q0hFQ0tfRkxBR1MoaHcuYWRqdXN0ZWRfbW9kZS5mbGFncywKLQkJCQkgICAgICBEUk1fTU9ERV9G
TEFHX1BIU1lOQyk7Ci0JCVBJUEVfQ09ORl9DSEVDS19GTEFHUyhody5hZGp1c3RlZF9tb2RlLmZs
YWdzLAotCQkJCSAgICAgIERSTV9NT0RFX0ZMQUdfTkhTWU5DKTsKLQkJUElQRV9DT05GX0NIRUNL
X0ZMQUdTKGh3LmFkanVzdGVkX21vZGUuZmxhZ3MsCi0JCQkJICAgICAgRFJNX01PREVfRkxBR19Q
VlNZTkMpOwotCQlQSVBFX0NPTkZfQ0hFQ0tfRkxBR1MoaHcuYWRqdXN0ZWRfbW9kZS5mbGFncywK
LQkJCQkgICAgICBEUk1fTU9ERV9GTEFHX05WU1lOQyk7Ci0JfQotCiAJUElQRV9DT05GX0NIRUNL
X1goZ21jaF9wZml0LmNvbnRyb2wpOwogCS8qIHBmaXQgcmF0aW9zIGFyZSBhdXRvY29tcHV0ZWQg
YnkgdGhlIGh3IG9uIGdlbjQrICovCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPCA0KQpAQCAt
MTI4OTgsNyArMTMwMjEsOCBAQCBpbnRlbF9waXBlX2NvbmZpZ19jb21wYXJlKGNvbnN0IHN0cnVj
dCBpbnRlbF9jcnRjX3N0YXRlICpjdXJyZW50X2NvbmZpZywKIAkJfQogCiAJCVBJUEVfQ09ORl9D
SEVDS19JKHNjYWxlcl9zdGF0ZS5zY2FsZXJfaWQpOwotCQlQSVBFX0NPTkZfQ0hFQ0tfQ0xPQ0tf
RlVaWlkocGl4ZWxfcmF0ZSk7CisJCWlmICghUElQRV9DT05GX1FVSVJLKFBJUEVfQ09ORklHX1FV
SVJLX0JJR0pPSU5FUl9TTEFWRSkpCisJCQlQSVBFX0NPTkZfQ0hFQ0tfQ0xPQ0tfRlVaWlkocGl4
ZWxfcmF0ZSk7CiAKIAkJUElQRV9DT05GX0NIRUNLX1goZ2FtbWFfbW9kZSk7CiAJCWlmIChJU19D
SEVSUllWSUVXKGRldl9wcml2KSkKQEAgLTEyOTE3LDQ4ICsxMzA0MSw1MCBAQCBpbnRlbF9waXBl
X2NvbmZpZ19jb21wYXJlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjdXJyZW50X2Nv
bmZpZywKIAlQSVBFX0NPTkZfQ0hFQ0tfQk9PTChkb3VibGVfd2lkZSk7CiAKIAlQSVBFX0NPTkZf
Q0hFQ0tfUChzaGFyZWRfZHBsbCk7CisJaWYgKCFQSVBFX0NPTkZfUVVJUksoUElQRV9DT05GSUdf
UVVJUktfQklHSk9JTkVSX1NMQVZFKSkgewogCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3Rh
dGUuZHBsbCk7Ci0JUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5kcGxsX21kKTsKLQlQ
SVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLmZwMCk7Ci0JUElQRV9DT05GX0NIRUNLX1go
ZHBsbF9od19zdGF0ZS5mcDEpOwotCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUud3Jw
bGwpOwotCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUuc3BsbCk7Ci0JUElQRV9DT05G
X0NIRUNLX1goZHBsbF9od19zdGF0ZS5jdHJsMSk7Ci0JUElQRV9DT05GX0NIRUNLX1goZHBsbF9o
d19zdGF0ZS5jZmdjcjEpOwotCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUuY2ZnY3Iy
KTsKLQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLmNmZ2NyMCk7Ci0JUElQRV9DT05G
X0NIRUNLX1goZHBsbF9od19zdGF0ZS5lYmIwKTsKLQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3
X3N0YXRlLmViYjQpOwotCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUucGxsMCk7Ci0J
UElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5wbGwxKTsKLQlQSVBFX0NPTkZfQ0hFQ0tf
WChkcGxsX2h3X3N0YXRlLnBsbDIpOwotCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUu
cGxsMyk7Ci0JUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5wbGw2KTsKLQlQSVBFX0NP
TkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLnBsbDgpOwotCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxf
aHdfc3RhdGUucGxsOSk7Ci0JUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5wbGwxMCk7
Ci0JUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5wY3NkdzEyKTsKLQlQSVBFX0NPTkZf
Q0hFQ0tfWChkcGxsX2h3X3N0YXRlLm1nX3JlZmNsa2luX2N0bCk7Ci0JUElQRV9DT05GX0NIRUNL
X1goZHBsbF9od19zdGF0ZS5tZ19jbGt0b3AyX2NvcmVjbGtjdGwxKTsKLQlQSVBFX0NPTkZfQ0hF
Q0tfWChkcGxsX2h3X3N0YXRlLm1nX2Nsa3RvcDJfaHNjbGtjdGwpOwotCVBJUEVfQ09ORl9DSEVD
S19YKGRwbGxfaHdfc3RhdGUubWdfcGxsX2RpdjApOwotCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxf
aHdfc3RhdGUubWdfcGxsX2RpdjEpOwotCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUu
bWdfcGxsX2xmKTsKLQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLm1nX3BsbF9mcmFj
X2xvY2spOwotCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUubWdfcGxsX3NzYyk7Ci0J
UElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5tZ19wbGxfYmlhcyk7Ci0JUElQRV9DT05G
X0NIRUNLX1goZHBsbF9od19zdGF0ZS5tZ19wbGxfdGRjX2NvbGRzdF9iaWFzKTsKLQotCVBJUEVf
Q09ORl9DSEVDS19YKGRzaV9wbGwuY3RybCk7Ci0JUElQRV9DT05GX0NIRUNLX1goZHNpX3BsbC5k
aXYpOwotCi0JaWYgKElTX0c0WChkZXZfcHJpdikgfHwgSU5URUxfR0VOKGRldl9wcml2KSA+PSA1
KQotCQlQSVBFX0NPTkZfQ0hFQ0tfSShwaXBlX2JwcCk7Ci0KLQlQSVBFX0NPTkZfQ0hFQ0tfQ0xP
Q0tfRlVaWlkoaHcuYWRqdXN0ZWRfbW9kZS5jcnRjX2Nsb2NrKTsKLQlQSVBFX0NPTkZfQ0hFQ0tf
Q0xPQ0tfRlVaWlkocG9ydF9jbG9jayk7Ci0KLQlQSVBFX0NPTkZfQ0hFQ0tfSShtaW5fdm9sdGFn
ZV9sZXZlbCk7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUuZHBsbF9tZCk7CisJ
CVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUuZnAwKTsKKwkJUElQRV9DT05GX0NIRUNL
X1goZHBsbF9od19zdGF0ZS5mcDEpOworCQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRl
LndycGxsKTsKKwkJUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5zcGxsKTsKKwkJUElQ
RV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5jdHJsMSk7CisJCVBJUEVfQ09ORl9DSEVDS19Y
KGRwbGxfaHdfc3RhdGUuY2ZnY3IxKTsKKwkJUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0
ZS5jZmdjcjIpOworCQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLmNmZ2NyMCk7CisJ
CVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUuZWJiMCk7CisJCVBJUEVfQ09ORl9DSEVD
S19YKGRwbGxfaHdfc3RhdGUuZWJiNCk7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3Rh
dGUucGxsMCk7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUucGxsMSk7CisJCVBJ
UEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUucGxsMik7CisJCVBJUEVfQ09ORl9DSEVDS19Y
KGRwbGxfaHdfc3RhdGUucGxsMyk7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUu
cGxsNik7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUucGxsOCk7CisJCVBJUEVf
Q09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUucGxsOSk7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRw
bGxfaHdfc3RhdGUucGxsMTApOworCQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLnBj
c2R3MTIpOworCQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLm1nX3JlZmNsa2luX2N0
bCk7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUubWdfY2xrdG9wMl9jb3JlY2xr
Y3RsMSk7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUubWdfY2xrdG9wMl9oc2Ns
a2N0bCk7CisJCVBJUEVfQ09ORl9DSEVDS19YKGRwbGxfaHdfc3RhdGUubWdfcGxsX2RpdjApOwor
CQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0YXRlLm1nX3BsbF9kaXYxKTsKKwkJUElQRV9D
T05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5tZ19wbGxfbGYpOworCQlQSVBFX0NPTkZfQ0hFQ0tf
WChkcGxsX2h3X3N0YXRlLm1nX3BsbF9mcmFjX2xvY2spOworCQlQSVBFX0NPTkZfQ0hFQ0tfWChk
cGxsX2h3X3N0YXRlLm1nX3BsbF9zc2MpOworCQlQSVBFX0NPTkZfQ0hFQ0tfWChkcGxsX2h3X3N0
YXRlLm1nX3BsbF9iaWFzKTsKKwkJUElQRV9DT05GX0NIRUNLX1goZHBsbF9od19zdGF0ZS5tZ19w
bGxfdGRjX2NvbGRzdF9iaWFzKTsKKworCQlQSVBFX0NPTkZfQ0hFQ0tfWChkc2lfcGxsLmN0cmwp
OworCQlQSVBFX0NPTkZfQ0hFQ0tfWChkc2lfcGxsLmRpdik7CisKKwkJaWYgKElTX0c0WChkZXZf
cHJpdikgfHwgSU5URUxfR0VOKGRldl9wcml2KSA+PSA1KQorCQkJUElQRV9DT05GX0NIRUNLX0ko
cGlwZV9icHApOworCisJCVBJUEVfQ09ORl9DSEVDS19DTE9DS19GVVpaWShody5hZGp1c3RlZF9t
b2RlLmNydGNfY2xvY2spOworCQlQSVBFX0NPTkZfQ0hFQ0tfQ0xPQ0tfRlVaWlkocG9ydF9jbG9j
ayk7CisKKwkJUElQRV9DT05GX0NIRUNLX0kobWluX3ZvbHRhZ2VfbGV2ZWwpOworCX0KIAogCVBJ
UEVfQ09ORl9DSEVDS19YKGluZm9mcmFtZXMuZW5hYmxlKTsKIAlQSVBFX0NPTkZfQ0hFQ0tfWChp
bmZvZnJhbWVzLmdjcCk7CkBAIC0xMjk2Nyw2ICsxMzA5MywxMiBAQCBpbnRlbF9waXBlX2NvbmZp
Z19jb21wYXJlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjdXJyZW50X2NvbmZpZywK
IAlQSVBFX0NPTkZfQ0hFQ0tfSU5GT0ZSQU1FKGhkbWkpOwogCVBJUEVfQ09ORl9DSEVDS19JTkZP
RlJBTUUoZHJtKTsKIAorCVBJUEVfQ09ORl9DSEVDS19CT09MKGJpZ2pvaW5lcik7CisJUElQRV9D
T05GX0NIRUNLX0JPT0woYmlnam9pbmVyX3NsYXZlKTsKKwlQSVBFX0NPTkZfQ0hFQ0tfUChiaWdq
b2luZXJfbGlua2VkX2NydGMpOworCVBJUEVfQ09ORl9DSEVDS19CT09MKGRzY19wYXJhbXMuY29t
cHJlc3Npb25fZW5hYmxlKTsKKwlQSVBFX0NPTkZfQ0hFQ0tfQk9PTChkc2NfcGFyYW1zLmRzY19z
cGxpdCk7CisKICN1bmRlZiBQSVBFX0NPTkZfQ0hFQ0tfWAogI3VuZGVmIFBJUEVfQ09ORl9DSEVD
S19JCiAjdW5kZWYgUElQRV9DT05GX0NIRUNLX0JPT0wKQEAgLTEzMjIxLDYgKzEzMzUzLDcgQEAg
dmVyaWZ5X2NydGNfc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAJc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXI7CiAJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKnBpcGVfY29uZmln
OwogCXN0cnVjdCBkcm1fYXRvbWljX3N0YXRlICpzdGF0ZTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAq
bWFzdGVyID0gY3J0YzsKIAlib29sIGFjdGl2ZTsKIAogCXN0YXRlID0gb2xkX2NydGNfc3RhdGUt
PnVhcGkuc3RhdGU7CkBAIC0xMzI1MCw3ICsxMzM4MywxMCBAQCB2ZXJpZnlfY3J0Y19zdGF0ZShz
dHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAkJCSIoZXhwZWN0ZWQgJWksIGZvdW5kICVpKVxuIiwK
IAkJCW5ld19jcnRjX3N0YXRlLT5ody5hY3RpdmUsIGNydGMtPmFjdGl2ZSk7CiAKLQlmb3JfZWFj
aF9lbmNvZGVyX29uX2NydGMoZGV2LCAmY3J0Yy0+YmFzZSwgZW5jb2RlcikgeworCWlmIChuZXdf
Y3J0Y19zdGF0ZS0+Ymlnam9pbmVyX3NsYXZlKQorCQltYXN0ZXIgPSBuZXdfY3J0Y19zdGF0ZS0+
Ymlnam9pbmVyX2xpbmtlZF9jcnRjOworCisJZm9yX2VhY2hfZW5jb2Rlcl9vbl9jcnRjKGRldiwg
Jm1hc3Rlci0+YmFzZSwgZW5jb2RlcikgewogCQllbnVtIHBpcGUgcGlwZTsKIAogCQlhY3RpdmUg
PSBlbmNvZGVyLT5nZXRfaHdfc3RhdGUoZW5jb2RlciwgJnBpcGUpOwpAQCAtMTMyNTksMTIgKzEz
Mzk1LDEyIEBAIHZlcmlmeV9jcnRjX3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQkJ
CWVuY29kZXItPmJhc2UuYmFzZS5pZCwgYWN0aXZlLAogCQkJCW5ld19jcnRjX3N0YXRlLT5ody5h
Y3RpdmUpOwogCi0JCUk5MTVfU1RBVEVfV0FSTihhY3RpdmUgJiYgY3J0Yy0+cGlwZSAhPSBwaXBl
LAorCQlJOTE1X1NUQVRFX1dBUk4oYWN0aXZlICYmIG1hc3Rlci0+cGlwZSAhPSBwaXBlLAogCQkJ
CSJFbmNvZGVyIGNvbm5lY3RlZCB0byB3cm9uZyBwaXBlICVjXG4iLAogCQkJCXBpcGVfbmFtZShw
aXBlKSk7CiAKIAkJaWYgKGFjdGl2ZSkKLQkJCWVuY29kZXItPmdldF9jb25maWcoZW5jb2Rlciwg
cGlwZV9jb25maWcpOworCQkJaW50ZWxfZW5jb2Rlcl9nZXRfY29uZmlnKGVuY29kZXIsIHBpcGVf
Y29uZmlnKTsKIAl9CiAKIAlpbnRlbF9jcnRjX2NvbXB1dGVfcGl4ZWxfcmF0ZShwaXBlX2NvbmZp
Zyk7CkBAIC0xMzkwNiw2ICsxNDA0Miw3IEBAIHN0YXRpYyB2b2lkIGludGVsX3VwZGF0ZV9jcnRj
KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCiAJaWYgKG1vZGVzZXQpIHsKIAkJdXBkYXRlX3Nj
YW5saW5lX29mZnNldChuZXdfY3J0Y19zdGF0ZSk7CisJCWRybV9jYWxjX3RpbWVzdGFtcGluZ19j
b25zdGFudHMoJmNydGMtPmJhc2UsICZuZXdfY3J0Y19zdGF0ZS0+aHcudHJhbnNjb2Rlcl9tb2Rl
KTsKIAkJZGV2X3ByaXYtPmRpc3BsYXkuY3J0Y19lbmFibGUobmV3X2NydGNfc3RhdGUsIHN0YXRl
KTsKIAogCQkvKiB2YmxhbmtzIHdvcmsgYWdhaW4sIHJlLWVuYWJsZSBwaXBlIENSQy4gKi8KQEAg
LTEzOTkwLDcgKzE0MTI3LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxfY29tbWl0X21vZGVzZXRfZGlz
YWJsZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJICovCiAJZm9yX2VhY2hf
b2xkbmV3X2ludGVsX2NydGNfaW5fc3RhdGVfcmV2ZXJzZShzdGF0ZSwgY3J0Yywgb2xkX2NydGNf
c3RhdGUsCiAJCQkJCQkgICAgbmV3X2NydGNfc3RhdGUsIGkpIHsKLQkJaWYgKCFuZWVkc19tb2Rl
c2V0KG5ld19jcnRjX3N0YXRlKSkKKwkJaWYgKCFuZWVkc19tb2Rlc2V0KG5ld19jcnRjX3N0YXRl
KSB8fCBvbGRfY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX3NsYXZlKQogCQkJY29udGludWU7CiAKIAkJ
aW50ZWxfcHJlX3BsYW5lX3VwZGF0ZShvbGRfY3J0Y19zdGF0ZSwgbmV3X2NydGNfc3RhdGUpOwpA
QCAtMTQwMDAsNiArMTQxMzcsMTkgQEAgc3RhdGljIHZvaWQgaW50ZWxfY29tbWl0X21vZGVzZXRf
ZGlzYWJsZXMoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCQkJCQkgICAgICBv
bGRfY3J0Y19zdGF0ZSwKIAkJCQkJCSAgICAgIG5ld19jcnRjX3N0YXRlLAogCQkJCQkJICAgICAg
Y3J0Yyk7CisKKwkJaWYgKG9sZF9jcnRjX3N0YXRlLT5iaWdqb2luZXIpIHsKKwkJCXN0cnVjdCBp
bnRlbF9jcnRjICpzbGF2ZSA9IG9sZF9jcnRjX3N0YXRlLT5iaWdqb2luZXJfbGlua2VkX2NydGM7
CisJCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX3NsYXZlX2NydGNfc3RhdGUgPQorCQkJ
CWludGVsX2F0b21pY19nZXRfY3J0Y19zdGF0ZSgmc3RhdGUtPmJhc2UsIHNsYXZlKTsKKwkJCXN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpuZXdfc2xhdmVfY3J0Y19zdGF0ZSA9CisJCQkJaW50ZWxf
YXRvbWljX2dldF9jcnRjX3N0YXRlKCZzdGF0ZS0+YmFzZSwgc2xhdmUpOworCisJCQlpbnRlbF9v
bGRfY3J0Y19zdGF0ZV9kaXNhYmxlcyhzdGF0ZSwKKwkJCQkJCSAgICAgIG9sZF9zbGF2ZV9jcnRj
X3N0YXRlLAorCQkJCQkJICAgICAgbmV3X3NsYXZlX2NydGNfc3RhdGUsCisJCQkJCQkgICAgICBz
bGF2ZSk7CisJCX0KIAl9CiB9CiAKQEAgLTE2NDMzLDcgKzE2NTgzLDcgQEAgaW50IGludGVsX21v
ZGVzZXRfaW5pdChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCWZvcl9lYWNoX2ludGVsX2NydGMo
ZGV2LCBjcnRjKSB7CiAJCXN0cnVjdCBpbnRlbF9pbml0aWFsX3BsYW5lX2NvbmZpZyBwbGFuZV9j
b25maWcgPSB7fTsKIAotCQlpZiAoIWNydGMtPmFjdGl2ZSkKKwkJaWYgKCF0b19pbnRlbF9jcnRj
X3N0YXRlKGNydGMtPmJhc2Uuc3RhdGUpLT51YXBpLmFjdGl2ZSkKIAkJCWNvbnRpbnVlOwogCiAJ
CS8qCkBAIC0xNjkyMyw3ICsxNzA3MywxNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9tb2Rlc2V0X3Jl
YWRvdXRfaHdfc3RhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldikKIAkJCWNydGNfc3RhdGUgPSB0
b19pbnRlbF9jcnRjX3N0YXRlKGNydGMtPmJhc2Uuc3RhdGUpOwogCiAJCQllbmNvZGVyLT5iYXNl
LmNydGMgPSAmY3J0Yy0+YmFzZTsKLQkJCWVuY29kZXItPmdldF9jb25maWcoZW5jb2RlciwgY3J0
Y19zdGF0ZSk7CisJCQlpbnRlbF9lbmNvZGVyX2dldF9jb25maWcoZW5jb2RlciwgY3J0Y19zdGF0
ZSk7CisKKwkJCS8qIHJlYWQgb3V0IHRvIHNsYXZlIGNydGMgYXMgd2VsbCBmb3IgYmlnam9pbmVy
ICovCisJCQlpZiAoY3J0Y19zdGF0ZS0+Ymlnam9pbmVyKSB7CisJCQkJLyogZW5jb2RlciBzaG91
bGQgcmVhZCBiZSBsaW5rZWQgdG8gYmlnam9pbmVyIG1hc3RlciAqLworCQkJCVdBUk5fT04oY3J0
Y19zdGF0ZS0+Ymlnam9pbmVyX3NsYXZlKTsKKworCQkJCWNydGMgPSBjcnRjX3N0YXRlLT5iaWdq
b2luZXJfbGlua2VkX2NydGM7CisJCQkJY3J0Y19zdGF0ZSA9IHRvX2ludGVsX2NydGNfc3RhdGUo
Y3J0Yy0+YmFzZS5zdGF0ZSk7CisJCQkJaW50ZWxfZW5jb2Rlcl9nZXRfY29uZmlnKGVuY29kZXIs
IGNydGNfc3RhdGUpOworCQkJfQogCQl9IGVsc2UgewogCQkJZW5jb2Rlci0+YmFzZS5jcnRjID0g
TlVMTDsKIAkJfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kaXNwbGF5X3R5cGVzLmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rp
c3BsYXlfdHlwZXMuaAppbmRleCBkZDAzMjlhNGI5ZmYuLjdlMDZjNjE0NDdlNiAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgKQEAg
LTc4Niw2ICs3ODYsNyBAQCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSB7CiAJICogYWNjb3JkaW5n
bHkuCiAJICovCiAjZGVmaW5lIFBJUEVfQ09ORklHX1FVSVJLX01PREVfU1lOQ19GTEFHUwkoMTw8
MCkgLyogdW5yZWxpYWJsZSBzeW5jIG1vZGUuZmxhZ3MgKi8KKyNkZWZpbmUgUElQRV9DT05GSUdf
UVVJUktfQklHSk9JTkVSX1NMQVZFCSgxPDwxKSAvKiBiaWdqb2luZXIgc2xhdmUsIHBhcnRpYWwg
cmVhZG91dCAqLwogCXVuc2lnbmVkIGxvbmcgcXVpcmtzOwogCiAJdW5zaWduZWQgZmJfYml0czsg
LyogZnJhbWVidWZmZXJzIHRvIGZsaXAgKi8KQEAgLTE1NzIsNCArMTU3MywyMCBAQCBzdGF0aWMg
aW5saW5lIHUzMiBpbnRlbF9wbGFuZV9nZ3R0X29mZnNldChjb25zdCBzdHJ1Y3QgaW50ZWxfcGxh
bmVfc3RhdGUgKnN0YXRlKQogCXJldHVybiBpOTE1X2dndHRfb2Zmc2V0KHN0YXRlLT52bWEpOwog
fQogCitzdGF0aWMgaW5saW5lIGJvb2wKK2ludGVsX2NydGNfc3VwcG9ydHNfZHNjKGNvbnN0IHN0
cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2NvbmZpZykKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBpcGVfY29uZmlnLT51YXBpLmNydGMtPmRldik7
CisKKwkvKiBPbiBUR0wsIERTQyBpcyBzdXBwb3J0ZWQgb24gYWxsIFBpcGVzICovCisJaWYgKElO
VEVMX0dFTihkZXZfcHJpdikgPj0gMTIpCisJCXJldHVybiB0cnVlOworCisJaWYgKElOVEVMX0dF
TihkZXZfcHJpdikgPj0gMTAgJiYKKwkgICAgcGlwZV9jb25maWctPmNwdV90cmFuc2NvZGVyICE9
IFRSQU5TQ09ERVJfQSkKKwkJcmV0dXJuIHRydWU7CisKKwlyZXR1cm4gZmFsc2U7Cit9CisKICNl
bmRpZiAvKiAgX19JTlRFTF9ESVNQTEFZX1RZUEVTX0hfXyAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kcC5jCmluZGV4IDNkNDg3Y2UxNjE1MS4uMjM0YmUxYzMxOTU4IDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCkBAIC0xOTA3LDIyICsxOTA3LDYg
QEAgc3RhdGljIGJvb2wgaW50ZWxfZHBfc3VwcG9ydHNfZmVjKHN0cnVjdCBpbnRlbF9kcCAqaW50
ZWxfZHAsCiAJCWRybV9kcF9zaW5rX3N1cHBvcnRzX2ZlYyhpbnRlbF9kcC0+ZmVjX2NhcGFibGUp
OwogfQogCi1zdGF0aWMgYm9vbCBpbnRlbF9kcF9zb3VyY2Vfc3VwcG9ydHNfZHNjKHN0cnVjdCBp
bnRlbF9kcCAqaW50ZWxfZHAsCi0JCQkJCSBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
cGlwZV9jb25maWcpCi17Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZHBf
dG9faTkxNShpbnRlbF9kcCk7Ci0KLQkvKiBPbiBUR0wsIERTQyBpcyBzdXBwb3J0ZWQgb24gYWxs
IFBpcGVzICovCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTIpCi0JCXJldHVybiB0cnVl
OwotCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgJiYKLQkgICAgcGlwZV9jb25maWct
PmNwdV90cmFuc2NvZGVyICE9IFRSQU5TQ09ERVJfQSkKLQkJcmV0dXJuIHRydWU7Ci0KLQlyZXR1
cm4gZmFsc2U7Ci19Ci0KIHN0YXRpYyBib29sIGludGVsX2RwX3N1cHBvcnRzX2RzYyhzdHJ1Y3Qg
aW50ZWxfZHAgKmludGVsX2RwLAogCQkJCSAgY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KnBpcGVfY29uZmlnKQogewpAQCAtMTkzMCw3ICsxOTE0LDcgQEAgc3RhdGljIGJvb2wgaW50ZWxf
ZHBfc3VwcG9ydHNfZHNjKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCiAJaWYgKCFpbnRlbF9k
cF9pc19lZHAoaW50ZWxfZHApICYmICFwaXBlX2NvbmZpZy0+ZmVjX2VuYWJsZSAmJiAwKQogCQly
ZXR1cm4gZmFsc2U7CiAKLQlyZXR1cm4gaW50ZWxfZHBfc291cmNlX3N1cHBvcnRzX2RzYyhpbnRl
bF9kcCwgcGlwZV9jb25maWcpICYmCisJcmV0dXJuIGludGVsX2NydGNfc3VwcG9ydHNfZHNjKHBp
cGVfY29uZmlnKSAmJgogCQlkcm1fZHBfc2lua19zdXBwb3J0c19kc2MoaW50ZWxfZHAtPmRzY19k
cGNkKTsKIH0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF92ZHNjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX3Zkc2MuYwppbmRl
eCAzOGMxODE0OTk1MDUuLjExZDRkYTk3MzRhMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF92ZHNjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF92ZHNjLmMKQEAgLTQ4MCwxMSArNDgwLDEwIEBAIGludGVsX2RzY19wb3dlcl9k
b21haW4oY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJCXJldHVy
biBQT1dFUl9ET01BSU5fVFJBTlNDT0RFUihjcHVfdHJhbnNjb2Rlcik7CiB9CiAKLXN0YXRpYyB2
b2lkIGludGVsX2NvbmZpZ3VyZV9wcHNfZm9yX2RzY19lbmNvZGVyKHN0cnVjdCBpbnRlbF9lbmNv
ZGVyICplbmNvZGVyLAotCQkJCQkJY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUpCitzdGF0aWMgdm9pZCBpbnRlbF9jb25maWd1cmVfcHBzX2Zvcl9kc2NfZW5jb2Rlcihj
b25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAlzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKLQlz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGVuY29kZXItPmJhc2Uu
ZGV2KTsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMt
PmJhc2UuZGV2KTsKIAljb25zdCBzdHJ1Y3QgZHJtX2RzY19jb25maWcgKnZkc2NfY2ZnID0gJmNy
dGNfc3RhdGUtPmRwX2RzY19jZmc7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCWVu
dW0gdHJhbnNjb2RlciBjcHVfdHJhbnNjb2RlciA9IGNydGNfc3RhdGUtPmNwdV90cmFuc2NvZGVy
OwpAQCAtNDk0LDYgKzQ5Myw5IEBAIHN0YXRpYyB2b2lkIGludGVsX2NvbmZpZ3VyZV9wcHNfZm9y
X2RzY19lbmNvZGVyKHN0cnVjdCBpbnRlbF9lbmNvZGVyICplbmNvZGVyLAogCXU4IG51bV92ZHNj
X2luc3RhbmNlcyA9IChjcnRjX3N0YXRlLT5kc2NfcGFyYW1zLmRzY19zcGxpdCkgPyAyIDogMTsK
IAlpbnQgaSA9IDA7CiAKKwlpZiAoY3J0Y19zdGF0ZS0+Ymlnam9pbmVyKQorCQludW1fdmRzY19p
bnN0YW5jZXMgKj0gMjsKKwogCS8qIFBvcHVsYXRlIFBJQ1RVUkVfUEFSQU1FVEVSX1NFVF8wIHJl
Z2lzdGVycyAqLwogCXBwc192YWwgPSBEU0NfVkVSX01BSiB8IHZkc2NfY2ZnLT5kc2NfdmVyc2lv
bl9taW5vciA8PAogCQlEU0NfVkVSX01JTl9TSElGVCB8CkBAIC04OTksNzQgKzkwMSwxMDQgQEAg
c3RhdGljIHZvaWQgaW50ZWxfZHBfd3JpdGVfZHNjX3Bwc19zZHAoc3RydWN0IGludGVsX2VuY29k
ZXIgKmVuY29kZXIsCiAJCQkJCXNpemVvZihkcF9kc2NfcHBzX3NkcCkpOwogfQogCitzdGF0aWMg
aTkxNV9yZWdfdCBkc3NfY3RsMV9yZWcoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNy
dGNfc3RhdGUpCit7CisJZW51bSBwaXBlIHBpcGUgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUt
PnVhcGkuY3J0YyktPnBpcGU7CisKKwlpZiAoY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXIgPT0g
VFJBTlNDT0RFUl9FRFApCisJCXJldHVybiBEU1NfQ1RMMTsKKworCXJldHVybiBJQ0xfUElQRV9E
U1NfQ1RMMShwaXBlKTsKK30KKworc3RhdGljIGk5MTVfcmVnX3QgZHNzX2N0bDJfcmVnKGNvbnN0
IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQoreworCWVudW0gcGlwZSBwaXBl
ID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpLT5waXBlOworCisJaWYgKGNy
dGNfc3RhdGUtPmNwdV90cmFuc2NvZGVyID09IFRSQU5TQ09ERVJfRURQKQorCQlyZXR1cm4gRFNT
X0NUTDI7CisKKwlyZXR1cm4gSUNMX1BJUEVfRFNTX0NUTDIocGlwZSk7Cit9CisKIHZvaWQgaW50
ZWxfZHNjX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJICAgICAgY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiB7CiAJc3RydWN0IGludGVs
X2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRjKGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShlbmNvZGVyLT5iYXNlLmRl
dik7Ci0JZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwotCWk5MTVfcmVnX3QgZHNzX2N0bDFf
cmVnLCBkc3NfY3RsMl9yZWc7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0g
dG9faTkxNShjcnRjLT5iYXNlLmRldik7CiAJdTMyIGRzc19jdGwxX3ZhbCA9IDA7CiAJdTMyIGRz
c19jdGwyX3ZhbCA9IDA7CiAKIAlpZiAoIWNydGNfc3RhdGUtPmRzY19wYXJhbXMuY29tcHJlc3Np
b25fZW5hYmxlKQogCQlyZXR1cm47CiAKLQkvKiBFbmFibGUgUG93ZXIgd2VsbHMgZm9yIFZEU0Mv
am9pbmluZyAqLwotCWludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0KGRldl9wcml2LAotCQkJCWludGVs
X2RzY19wb3dlcl9kb21haW4oY3J0Y19zdGF0ZSkpOworCWludGVsX2NvbmZpZ3VyZV9wcHNfZm9y
X2RzY19lbmNvZGVyKGNydGNfc3RhdGUpOwogCi0JaW50ZWxfY29uZmlndXJlX3Bwc19mb3JfZHNj
X2VuY29kZXIoZW5jb2RlciwgY3J0Y19zdGF0ZSk7CisJaWYgKCFjcnRjX3N0YXRlLT5iaWdqb2lu
ZXJfc2xhdmUpCisJCWludGVsX2RwX3dyaXRlX2RzY19wcHNfc2RwKGVuY29kZXIsIGNydGNfc3Rh
dGUpOwogCi0JaW50ZWxfZHBfd3JpdGVfZHNjX3Bwc19zZHAoZW5jb2RlciwgY3J0Y19zdGF0ZSk7
Ci0KLQlpZiAoY3J0Y19zdGF0ZS0+Y3B1X3RyYW5zY29kZXIgPT0gVFJBTlNDT0RFUl9FRFApIHsK
LQkJZHNzX2N0bDFfcmVnID0gRFNTX0NUTDE7Ci0JCWRzc19jdGwyX3JlZyA9IERTU19DVEwyOwot
CX0gZWxzZSB7Ci0JCWRzc19jdGwxX3JlZyA9IElDTF9QSVBFX0RTU19DVEwxKHBpcGUpOwotCQlk
c3NfY3RsMl9yZWcgPSBJQ0xfUElQRV9EU1NfQ1RMMihwaXBlKTsKLQl9CiAJZHNzX2N0bDJfdmFs
IHw9IExFRlRfQlJBTkNIX1ZEU0NfRU5BQkxFOwogCWlmIChjcnRjX3N0YXRlLT5kc2NfcGFyYW1z
LmRzY19zcGxpdCkgewogCQlkc3NfY3RsMl92YWwgfD0gUklHSFRfQlJBTkNIX1ZEU0NfRU5BQkxF
OwogCQlkc3NfY3RsMV92YWwgfD0gSk9JTkVSX0VOQUJMRTsKIAl9Ci0JSTkxNV9XUklURShkc3Nf
Y3RsMV9yZWcsIGRzc19jdGwxX3ZhbCk7Ci0JSTkxNV9XUklURShkc3NfY3RsMl9yZWcsIGRzc19j
dGwyX3ZhbCk7CisJaWYgKGNydGNfc3RhdGUtPmJpZ2pvaW5lcikgeworCQlkc3NfY3RsMV92YWwg
fD0gQklHX0pPSU5FUl9FTkFCTEU7CisJCWlmICghY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX3NsYXZl
KQorCQkJZHNzX2N0bDFfdmFsIHw9IE1BU1RFUl9CSUdfSk9JTkVSX0VOQUJMRTsKKwl9CisJSTkx
NV9XUklURShkc3NfY3RsMV9yZWcoY3J0Y19zdGF0ZSksIGRzc19jdGwxX3ZhbCk7CisJSTkxNV9X
UklURShkc3NfY3RsMl9yZWcoY3J0Y19zdGF0ZSksIGRzc19jdGwyX3ZhbCk7CiB9CiAKIHZvaWQg
aW50ZWxfZHNjX2Rpc2FibGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRj
X3N0YXRlKQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhvbGRf
Y3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKLQllbnVtIHBpcGUgcGlwZSA9IGNydGMtPnBp
cGU7Ci0JaTkxNV9yZWdfdCBkc3NfY3RsMV9yZWcsIGRzc19jdGwyX3JlZzsKLQl1MzIgZHNzX2N0
bDFfdmFsID0gMCwgZHNzX2N0bDJfdmFsID0gMDsKIAogCWlmICghb2xkX2NydGNfc3RhdGUtPmRz
Y19wYXJhbXMuY29tcHJlc3Npb25fZW5hYmxlKQogCQlyZXR1cm47CiAKLQlpZiAob2xkX2NydGNf
c3RhdGUtPmNwdV90cmFuc2NvZGVyID09IFRSQU5TQ09ERVJfRURQKSB7Ci0JCWRzc19jdGwxX3Jl
ZyA9IERTU19DVEwxOwotCQlkc3NfY3RsMl9yZWcgPSBEU1NfQ1RMMjsKLQl9IGVsc2UgewotCQlk
c3NfY3RsMV9yZWcgPSBJQ0xfUElQRV9EU1NfQ1RMMShwaXBlKTsKLQkJZHNzX2N0bDJfcmVnID0g
SUNMX1BJUEVfRFNTX0NUTDIocGlwZSk7CisJSTkxNV9XUklURShkc3NfY3RsMV9yZWcob2xkX2Ny
dGNfc3RhdGUpLCAwKTsKKwlJOTE1X1dSSVRFKGRzc19jdGwyX3JlZyhvbGRfY3J0Y19zdGF0ZSks
IDApOworfQorCit2b2lkIGludGVsX2RzY19nZXRfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlKQoreworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxf
Y3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOworCXUzMiBkc3NfY3RsMV92YWwsIGRz
c19jdGwyX3ZhbDsKKwlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKKworCWlmICghaW50ZWxfY3J0
Y19zdXBwb3J0c19kc2MoY3J0Y19zdGF0ZSkpCisJCXJldHVybjsKKworCXdha2VyZWYgPSBpbnRl
bF9kaXNwbGF5X3Bvd2VyX2dldF9pZl9lbmFibGVkKGRldl9wcml2LCBpbnRlbF9kc2NfcG93ZXJf
ZG9tYWluKGNydGNfc3RhdGUpKTsKKwlpZiAoIXdha2VyZWYpCisJCXJldHVybjsKKworCWRzc19j
dGwxX3ZhbCA9IEk5MTVfUkVBRChkc3NfY3RsMV9yZWcoY3J0Y19zdGF0ZSkpOworCWRzc19jdGwy
X3ZhbCA9IEk5MTVfUkVBRChkc3NfY3RsMl9yZWcoY3J0Y19zdGF0ZSkpOworCWlmIChkc3NfY3Rs
Ml92YWwgJiBMRUZUX0JSQU5DSF9WRFNDX0VOQUJMRSkKKwkJY3J0Y19zdGF0ZS0+ZHNjX3BhcmFt
cy5jb21wcmVzc2lvbl9lbmFibGUgPSB0cnVlOworCisJaWYgKChkc3NfY3RsMV92YWwgJiBKT0lO
RVJfRU5BQkxFKSAmJiAoZHNzX2N0bDJfdmFsICYgUklHSFRfQlJBTkNIX1ZEU0NfRU5BQkxFKSkK
KwkJY3J0Y19zdGF0ZS0+ZHNjX3BhcmFtcy5kc2Nfc3BsaXQgPSB0cnVlOworCisJaWYgKGRzc19j
dGwxX3ZhbCAmIEJJR19KT0lORVJfRU5BQkxFKSB7CisJCWNydGNfc3RhdGUtPmJpZ2pvaW5lciA9
IHRydWU7CisKKwkJaWYgKCEoZHNzX2N0bDFfdmFsICYgTUFTVEVSX0JJR19KT0lORVJfRU5BQkxF
KSkgeworCQkJY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX3NsYXZlID0gdHJ1ZTsKKwkJCWlmICghV0FS
Tl9PTihjcnRjLT5waXBlID09IFBJUEVfQSkpCisJCQkJY3J0Y19zdGF0ZS0+Ymlnam9pbmVyX2xp
bmtlZF9jcnRjID0KKwkJCQkJaW50ZWxfZ2V0X2NydGNfZm9yX3BpcGUoZGV2X3ByaXYsIGNydGMt
PnBpcGUgLSAxKTsKKwkJfSBlbHNlIHsKKwkJCWlmICghV0FSTl9PTihJTlRFTF9OVU1fUElQRVMo
ZGV2X3ByaXYpID09IGNydGMtPnBpcGUgKyAxKSkKKwkJCQljcnRjX3N0YXRlLT5iaWdqb2luZXJf
bGlua2VkX2NydGMgPQorCQkJCQlpbnRlbF9nZXRfY3J0Y19mb3JfcGlwZShkZXZfcHJpdiwgY3J0
Yy0+cGlwZSArIDEpOworCQl9CiAJfQotCWRzc19jdGwxX3ZhbCA9IEk5MTVfUkVBRChkc3NfY3Rs
MV9yZWcpOwotCWlmIChkc3NfY3RsMV92YWwgJiBKT0lORVJfRU5BQkxFKQotCQlkc3NfY3RsMV92
YWwgJj0gfkpPSU5FUl9FTkFCTEU7Ci0JSTkxNV9XUklURShkc3NfY3RsMV9yZWcsIGRzc19jdGwx
X3ZhbCk7Ci0KLQlkc3NfY3RsMl92YWwgPSBJOTE1X1JFQUQoZHNzX2N0bDJfcmVnKTsKLQlpZiAo
ZHNzX2N0bDJfdmFsICYgTEVGVF9CUkFOQ0hfVkRTQ19FTkFCTEUgfHwKLQkgICAgZHNzX2N0bDJf
dmFsICYgUklHSFRfQlJBTkNIX1ZEU0NfRU5BQkxFKQotCQlkc3NfY3RsMl92YWwgJj0gfihMRUZU
X0JSQU5DSF9WRFNDX0VOQUJMRSB8Ci0JCQkJICBSSUdIVF9CUkFOQ0hfVkRTQ19FTkFCTEUpOwot
CUk5MTVfV1JJVEUoZHNzX2N0bDJfcmVnLCBkc3NfY3RsMl92YWwpOwotCi0JLyogRGlzYWJsZSBQ
b3dlciB3ZWxscyBmb3IgVkRTQy9qb2luaW5nICovCi0JaW50ZWxfZGlzcGxheV9wb3dlcl9wdXRf
dW5jaGVja2VkKGRldl9wcml2LAotCQkJCQkgIGludGVsX2RzY19wb3dlcl9kb21haW4ob2xkX2Ny
dGNfc3RhdGUpKTsKKworCWludGVsX2Rpc3BsYXlfcG93ZXJfcHV0KGRldl9wcml2LCBpbnRlbF9k
c2NfcG93ZXJfZG9tYWluKGNydGNfc3RhdGUpLCB3YWtlcmVmKTsKIH0KZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfdmRzYy5oIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF92ZHNjLmgKaW5kZXggOTBkM2Y2MDE3ZmNiLi41NjljZjE3NDAy
YmEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfdmRzYy5o
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfdmRzYy5oCkBAIC0xNSw2
ICsxNSw4IEBAIHZvaWQgaW50ZWxfZHNjX2VuYWJsZShzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5j
b2RlciwKIHZvaWQgaW50ZWxfZHNjX2Rpc2FibGUoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3Rh
dGUgKmNydGNfc3RhdGUpOwogaW50IGludGVsX2RwX2NvbXB1dGVfZHNjX3BhcmFtcyhzdHJ1Y3Qg
aW50ZWxfZHAgKmludGVsX2RwLAogCQkJCXN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpwaXBlX2Nv
bmZpZyk7Cit2b2lkIGludGVsX2RzY19nZXRfY29uZmlnKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlKTsKKwogZW51bSBpbnRlbF9kaXNwbGF5X3Bvd2VyX2RvbWFpbgogaW50ZWxf
ZHNjX3Bvd2VyX2RvbWFpbihjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0
ZSk7CiAKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50
ZWwtZ2Z4

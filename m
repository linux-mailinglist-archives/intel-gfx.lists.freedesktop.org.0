Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 00D7E4D03D
	for <lists+intel-gfx@lfdr.de>; Thu, 20 Jun 2019 16:21:04 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 61A196E41D;
	Thu, 20 Jun 2019 14:21:02 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 5196F6E41D
 for <intel-gfx@lists.freedesktop.org>; Thu, 20 Jun 2019 14:20:57 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16967470-1500050 
 for <intel-gfx@lists.freedesktop.org>; Thu, 20 Jun 2019 15:20:49 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 20 Jun 2019 15:20:52 +0100
Message-Id: <20190620142052.19311-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190620142052.19311-1-chris@chris-wilson.co.uk>
References: <20190620142052.19311-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [CI 2/2] drm/i915/execlists: Minimalistic timeslicing
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SWYgd2UgaGF2ZSBtdWx0aXBsZSBjb250ZXh0cyBvZiBlcXVhbCBwcmlvcml0eSBwZW5kaW5nIGV4
ZWN1dGlvbiwKYWN0aXZhdGUgYSB0aW1lciB0byBkZW1vdGUgdGhlIGN1cnJlbnRseSBleGVjdXRp
bmcgY29udGV4dCBpbiBmYXZvdXIgb2YKdGhlIG5leHQgaW4gdGhlIHF1ZXVlIHdoZW4gdGhhdCB0
aW1lc2xpY2UgZXhwaXJlcy4gVGhpcyBlbmZvcmNlcwpmYWlybmVzcyBiZXR3ZWVuIGNvbnRleHRz
IChzbyBsb25nIGFzIHRoZXkgYWxsb3cgcHJlZW1wdGlvbiAtLSBmb3JjZWQKcHJlZW1wdGlvbiwg
aW4gdGhlIGZ1dHVyZSwgd2lsbCBraWNrIHRob3NlIHdobyBkbyBub3Qgb2JleSkgYW5kIGFsbG93
cwp1cyB0byBhdm9pZCB1c2Vyc3BhY2UgYmxvY2tpbmcgZm9yd2FyZCBwcm9ncmVzcyB3aXRoIGUu
Zy4gdW5ib3VuZGVkCk1JX1NFTUFQSE9SRV9XQUlULgoKRm9yIHRoZSBzdGFydGluZyBwb2ludCBo
ZXJlLCB3ZSB1c2UgdGhlIGppZmZpZSBhcyBvdXIgdGltZXNsaWNlIHNvIHRoYXQKd2Ugc2hvdWxk
IGJlIHJlYXNvbmFibHkgZWZmaWNpZW50IHdydCBmcmVxdWVudCBDUFUgd2FrZXVwcy4KClRlc3Rj
YXNlOiBpZ3QvZ2VtX2V4ZWNfc2NoZWR1bGVyL3NlbWFwaG9yZS1yZXNvbHZlClNpZ25lZC1vZmYt
Ynk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpSZXZpZXdlZC1ieTog
TWlrYSBLdW9wcGFsYSA8bWlrYS5rdW9wcGFsYUBsaW51eC5pbnRlbC5jb20+Ci0tLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmggfCAgIDYgKwogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgICAgICAgICAgfCAxMTYgKysrKysrKysrKwogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgICAgICAgfCAyMjMgKysrKysrKysr
KysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIuYyAgICAgICAg
fCAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXJfdHlwZXMuaCAgfCAg
IDEgKwogNSBmaWxlcyBjaGFuZ2VkLCAzNDcgaW5zZXJ0aW9ucygrKQoKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV90eXBlcy5oIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3R5cGVzLmgKaW5kZXggYjRmN2I4MWEzYzNlLi45OTQw
YmFkMzc4MTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2lu
ZV90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV90eXBl
cy5oCkBAIC0xMiw2ICsxMiw3IEBACiAjaW5jbHVkZSA8bGludXgva3JlZi5oPgogI2luY2x1ZGUg
PGxpbnV4L2xpc3QuaD4KICNpbmNsdWRlIDxsaW51eC9sbGlzdC5oPgorI2luY2x1ZGUgPGxpbnV4
L3RpbWVyLmg+CiAjaW5jbHVkZSA8bGludXgvdHlwZXMuaD4KIAogI2luY2x1ZGUgImk5MTVfZ2Vt
LmgiCkBAIC0xNDksNiArMTUwLDExIEBAIHN0cnVjdCBpbnRlbF9lbmdpbmVfZXhlY2xpc3RzIHsK
IAkgKi8KIAlzdHJ1Y3QgdGFza2xldF9zdHJ1Y3QgdGFza2xldDsKIAorCS8qKgorCSAqIEB0aW1l
cjoga2ljayB0aGUgY3VycmVudCBjb250ZXh0IGlmIGl0cyB0aW1lc2xpY2UgZXhwaXJlcworCSAq
LworCXN0cnVjdCB0aW1lcl9saXN0IHRpbWVyOworCiAJLyoqCiAJICogQGRlZmF1bHRfcHJpb2xp
c3Q6IHByaW9yaXR5IGxpc3QgZm9yIEk5MTVfUFJJT1JJVFlfTk9STUFMCiAJICovCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2xyYy5jCmluZGV4IGNiOWQyODViZDAwYS4uZjhhZDQ5MDA2OTE3IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9scmMuYwpAQCAtMjY2LDYgKzI2Niw3IEBAIHN0YXRp
YyBpbnQgZWZmZWN0aXZlX3ByaW8oY29uc3Qgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJCXBy
aW8gfD0gSTkxNV9QUklPUklUWV9OT1NFTUFQSE9SRTsKIAogCS8qIFJlc3RyaWN0IG1lcmUgV0FJ
VCBib29zdHMgZnJvbSB0cmlnZ2VyaW5nIHByZWVtcHRpb24gKi8KKwlCVUlMRF9CVUdfT04oX19O
T19QUkVFTVBUSU9OICYgfkk5MTVfUFJJT1JJVFlfTUFTSyk7IC8qIG9ubHkgaW50ZXJuYWwgKi8K
IAlyZXR1cm4gcHJpbyB8IF9fTk9fUFJFRU1QVElPTjsKIH0KIApAQCAtODMwLDYgKzgzMSw4MSBA
QCBsYXN0X2FjdGl2ZShjb25zdCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2V4ZWNsaXN0cyAqZXhlY2xp
c3RzKQogCXJldHVybiAqbGFzdDsKIH0KIAorc3RhdGljIHZvaWQKK2RlZmVyX3JlcXVlc3Qoc3Ry
dWN0IGk5MTVfcmVxdWVzdCAqIGNvbnN0IHJxLCBzdHJ1Y3QgbGlzdF9oZWFkICogY29uc3QgcGwp
Cit7CisJc3RydWN0IGk5MTVfZGVwZW5kZW5jeSAqcDsKKworCS8qCisJICogV2Ugd2FudCB0byBt
b3ZlIHRoZSBpbnRlcnJ1cHRlZCByZXF1ZXN0IHRvIHRoZSBiYWNrIG9mCisJICogdGhlIHJvdW5k
LXJvYmluIGxpc3QgKGkuZS4gaXRzIHByaW9yaXR5IGxldmVsKSwgYnV0CisJICogaW4gZG9pbmcg
c28sIHdlIG11c3QgdGhlbiBtb3ZlIGFsbCByZXF1ZXN0cyB0aGF0IHdlcmUgaW4KKwkgKiBmbGln
aHQgYW5kIHdlcmUgd2FpdGluZyBmb3IgdGhlIGludGVycnVwdGVkIHJlcXVlc3QgdG8KKwkgKiBi
ZSBydW4gYWZ0ZXIgaXQgYWdhaW4uCisJICovCisJbGlzdF9tb3ZlX3RhaWwoJnJxLT5zY2hlZC5s
aW5rLCBwbCk7CisKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5KHAsICZycS0+c2NoZWQud2FpdGVyc19s
aXN0LCB3YWl0X2xpbmspIHsKKwkJc3RydWN0IGk5MTVfcmVxdWVzdCAqdyA9CisJCQljb250YWlu
ZXJfb2YocC0+d2FpdGVyLCB0eXBlb2YoKncpLCBzY2hlZCk7CisKKwkJLyogTGVhdmUgc2VtYXBo
b3JlcyBzcGlubmluZyBvbiB0aGUgb3RoZXIgZW5naW5lcyAqLworCQlpZiAody0+ZW5naW5lICE9
IHJxLT5lbmdpbmUpCisJCQljb250aW51ZTsKKworCQkvKiBObyB3YWl0ZXIgc2hvdWxkIHN0YXJ0
IGJlZm9yZSB0aGUgYWN0aXZlIHJlcXVlc3QgY29tcGxldGVkICovCisJCUdFTV9CVUdfT04oaTkx
NV9yZXF1ZXN0X3N0YXJ0ZWQodykpOworCisJCUdFTV9CVUdfT04ocnFfcHJpbyh3KSA+IHJxX3By
aW8ocnEpKTsKKwkJaWYgKHJxX3ByaW8odykgPCBycV9wcmlvKHJxKSkKKwkJCWNvbnRpbnVlOwor
CisJCWlmIChsaXN0X2VtcHR5KCZ3LT5zY2hlZC5saW5rKSkKKwkJCWNvbnRpbnVlOyAvKiBOb3Qg
eWV0IHN1Ym1pdHRlZDsgdW5yZWFkeSAqLworCisJCS8qCisJCSAqIFRoaXMgc2hvdWxkIGJlIHZl
cnkgc2hhbGxvdyBhcyBpdCBpcyBsaW1pdGVkIGJ5IHRoZQorCQkgKiBudW1iZXIgb2YgcmVxdWVz
dHMgdGhhdCBjYW4gZml0IGluIGEgcmluZyAoPDY0KSBhbmQKKwkJICogdGhlIG51bWJlciBvZiBj
b250ZXh0cyB0aGF0IGNhbiBiZSBpbiBmbGlnaHQgb24gdGhpcworCQkgKiBlbmdpbmUuCisJCSAq
LworCQlkZWZlcl9yZXF1ZXN0KHcsIHBsKTsKKwl9Cit9CisKK3N0YXRpYyB2b2lkIGRlZmVyX2Fj
dGl2ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCit7CisJc3RydWN0IGk5MTVfcmVx
dWVzdCAqcnE7CisKKwlycSA9IF9fdW53aW5kX2luY29tcGxldGVfcmVxdWVzdHMoZW5naW5lKTsK
KwlpZiAoIXJxKQorCQlyZXR1cm47CisKKwlkZWZlcl9yZXF1ZXN0KHJxLCBpOTE1X3NjaGVkX2xv
b2t1cF9wcmlvbGlzdChlbmdpbmUsIHJxX3ByaW8ocnEpKSk7Cit9CisKK3N0YXRpYyBib29sCitu
ZWVkX3RpbWVzbGljZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUsIGNvbnN0IHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxKQoreworCWludCBoaW50OworCisJaWYgKGxpc3RfaXNfbGFzdCgm
cnEtPnNjaGVkLmxpbmssICZlbmdpbmUtPmFjdGl2ZS5yZXF1ZXN0cykpCisJCXJldHVybiBmYWxz
ZTsKKworCWhpbnQgPSBtYXgocnFfcHJpbyhsaXN0X25leHRfZW50cnkocnEsIHNjaGVkLmxpbmsp
KSwKKwkJICAgZW5naW5lLT5leGVjbGlzdHMucXVldWVfcHJpb3JpdHlfaGludCk7CisKKwlyZXR1
cm4gaGludCA+PSBycV9wcmlvKHJxKTsKK30KKworc3RhdGljIGJvb2wKK2VuYWJsZV90aW1lc2xp
Y2Uoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQoreworCXN0cnVjdCBpOTE1X3JlcXVl
c3QgKmxhc3QgPSBsYXN0X2FjdGl2ZSgmZW5naW5lLT5leGVjbGlzdHMpOworCisJcmV0dXJuIGxh
c3QgJiYgbmVlZF90aW1lc2xpY2UoZW5naW5lLCBsYXN0KTsKK30KKwogc3RhdGljIHZvaWQgZXhl
Y2xpc3RzX2RlcXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogewogCXN0cnVj
dCBpbnRlbF9lbmdpbmVfZXhlY2xpc3RzICogY29uc3QgZXhlY2xpc3RzID0gJmVuZ2luZS0+ZXhl
Y2xpc3RzOwpAQCAtOTIzLDYgKzk5OSwzMiBAQCBzdGF0aWMgdm9pZCBleGVjbGlzdHNfZGVxdWV1
ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJCQkgKi8KIAkJCWxhc3QtPmh3X2Nv
bnRleHQtPmxyY19kZXNjIHw9IENUWF9ERVNDX0ZPUkNFX1JFU1RPUkU7CiAJCQlsYXN0ID0gTlVM
TDsKKwkJfSBlbHNlIGlmIChuZWVkX3RpbWVzbGljZShlbmdpbmUsIGxhc3QpICYmCisJCQkgICAh
dGltZXJfcGVuZGluZygmZW5naW5lLT5leGVjbGlzdHMudGltZXIpKSB7CisJCQlHRU1fVFJBQ0Uo
IiVzOiBleHBpcmVkIGxhc3Q9JWxseDolbGxkLCBwcmlvPSVkLCBoaW50PSVkXG4iLAorCQkJCSAg
ZW5naW5lLT5uYW1lLAorCQkJCSAgbGFzdC0+ZmVuY2UuY29udGV4dCwKKwkJCQkgIGxhc3QtPmZl
bmNlLnNlcW5vLAorCQkJCSAgbGFzdC0+c2NoZWQuYXR0ci5wcmlvcml0eSwKKwkJCQkgIGV4ZWNs
aXN0cy0+cXVldWVfcHJpb3JpdHlfaGludCk7CisKKwkJCXJpbmdfc2V0X3BhdXNlZChlbmdpbmUs
IDEpOworCQkJZGVmZXJfYWN0aXZlKGVuZ2luZSk7CisKKwkJCS8qCisJCQkgKiBVbmxpa2UgZm9y
IHByZWVtcHRpb24sIGlmIHdlIHJld2luZCBhbmQgY29udGludWUKKwkJCSAqIGV4ZWN1dGluZyB0
aGUgc2FtZSBjb250ZXh0IGFzIHByZXZpb3VzbHkgYWN0aXZlLAorCQkJICogdGhlIG9yZGVyIG9m
IGV4ZWN1dGlvbiB3aWxsIHJlbWFpbiB0aGUgc2FtZSBhbmQKKwkJCSAqIHRoZSB0YWlsIHdpbGwg
b25seSBhZHZhbmNlLiBXZSBkbyBub3QgbmVlZCB0bworCQkJICogZm9yY2UgYSBmdWxsIGNvbnRl
eHQgcmVzdG9yZSwgYXMgYSBsaXRlLXJlc3RvcmUKKwkJCSAqIGlzIHN1ZmZpY2llbnQgdG8gcmVz
YW1wbGUgdGhlIG1vbm90b25pYyBUQUlMLgorCQkJICoKKwkJCSAqIElmIHdlIHN3aXRjaCB0byBh
bnkgb3RoZXIgY29udGV4dCwgc2ltaWxhcmx5IHdlCisJCQkgKiB3aWxsIG5vdCByZXdpbmQgVEFJ
TCBvZiBjdXJyZW50IGNvbnRleHQsIGFuZAorCQkJICogbm9ybWFsIHNhdmUvcmVzdG9yZSB3aWxs
IHByZXNlcnZlIHN0YXRlIGFuZCBhbGxvdworCQkJICogdXMgdG8gbGF0ZXIgY29udGludWUgZXhl
Y3V0aW5nIHRoZSBzYW1lIHJlcXVlc3QuCisJCQkgKi8KKwkJCWxhc3QgPSBOVUxMOwogCQl9IGVs
c2UgewogCQkJLyoKIAkJCSAqIE90aGVyd2lzZSBpZiB3ZSBhbHJlYWR5IGhhdmUgYSByZXF1ZXN0
IHBlbmRpbmcKQEAgLTEyNDcsNiArMTM0OSw5IEBAIHN0YXRpYyB2b2lkIHByb2Nlc3NfY3NiKHN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAkJCQkgICAgICAgc2l6ZW9mKCpleGVjbGlz
dHMtPnBlbmRpbmcpKTsKIAkJCWV4ZWNsaXN0cy0+cGVuZGluZ1swXSA9IE5VTEw7CiAKKwkJCWlm
IChlbmFibGVfdGltZXNsaWNlKGVuZ2luZSkpCisJCQkJbW9kX3RpbWVyKCZleGVjbGlzdHMtPnRp
bWVyLCBqaWZmaWVzICsgMSk7CisKIAkJCWlmICghaW5qZWN0X3ByZWVtcHRfaGFuZyhleGVjbGlz
dHMpKQogCQkJCXJpbmdfc2V0X3BhdXNlZChlbmdpbmUsIDApOwogCQl9IGVsc2UgaWYgKHN0YXR1
cyAmIEdFTjhfQ1RYX1NUQVRVU19QUkVFTVBURUQpIHsKQEAgLTEzMTcsNiArMTQyMiwxNSBAQCBz
dGF0aWMgdm9pZCBleGVjbGlzdHNfc3VibWlzc2lvbl90YXNrbGV0KHVuc2lnbmVkIGxvbmcgZGF0
YSkKIAlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZlbmdpbmUtPmFjdGl2ZS5sb2NrLCBmbGFncyk7
CiB9CiAKK3N0YXRpYyB2b2lkIGV4ZWNsaXN0c19zdWJtaXNzaW9uX3RpbWVyKHN0cnVjdCB0aW1l
cl9saXN0ICp0aW1lcikKK3sKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUgPQorCQlm
cm9tX3RpbWVyKGVuZ2luZSwgdGltZXIsIGV4ZWNsaXN0cy50aW1lcik7CisKKwkvKiBLaWNrIHRo
ZSB0YXNrbGV0IGZvciBzb21lIGludGVycnVwdCBjb2FsZXNjaW5nIGFuZCByZXNldCBoYW5kbGlu
ZyAqLworCXRhc2tsZXRfaGlfc2NoZWR1bGUoJmVuZ2luZS0+ZXhlY2xpc3RzLnRhc2tsZXQpOwor
fQorCiBzdGF0aWMgdm9pZCBxdWV1ZV9yZXF1ZXN0KHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSwKIAkJCSAgc3RydWN0IGk5MTVfc2NoZWRfbm9kZSAqbm9kZSwKIAkJCSAgaW50IHByaW8p
CkBAIC0yNTQyLDYgKzI2NTYsNyBAQCBzdGF0aWMgaW50IGdlbjhfaW5pdF9yY3NfY29udGV4dChz
dHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIAogc3RhdGljIHZvaWQgZXhlY2xpc3RzX3Bhcmsoc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lKQogeworCWRlbF90aW1lcl9zeW5jKCZlbmdpbmUt
PmV4ZWNsaXN0cy50aW1lcik7CiAJaW50ZWxfZW5naW5lX3BhcmsoZW5naW5lKTsKIH0KIApAQCAt
MjYzOSw2ICsyNzU0LDcgQEAgaW50IGludGVsX2V4ZWNsaXN0c19zdWJtaXNzaW9uX3NldHVwKHN0
cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSkKIAogCXRhc2tsZXRfaW5pdCgmZW5naW5lLT5l
eGVjbGlzdHMudGFza2xldCwKIAkJICAgICBleGVjbGlzdHNfc3VibWlzc2lvbl90YXNrbGV0LCAo
dW5zaWduZWQgbG9uZyllbmdpbmUpOworCXRpbWVyX3NldHVwKCZlbmdpbmUtPmV4ZWNsaXN0cy50
aW1lciwgZXhlY2xpc3RzX3N1Ym1pc3Npb25fdGltZXIsIDApOwogCiAJbG9naWNhbF9yaW5nX2Rl
ZmF1bHRfdmZ1bmNzKGVuZ2luZSk7CiAJbG9naWNhbF9yaW5nX2RlZmF1bHRfaXJxcyhlbmdpbmUp
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwppbmRleCA0MDFlOGI1MzkyOTcu
LjBjOTdmOTUzZTkwOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKQEAg
LTc5LDYgKzc5LDIyNSBAQCBzdGF0aWMgaW50IGxpdmVfc2FuaXR5Y2hlY2sodm9pZCAqYXJnKQog
CXJldHVybiBlcnI7CiB9CiAKK3N0YXRpYyBpbnQKK2VtaXRfc2VtYXBob3JlX2NoYWluKHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxLCBzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgaW50IGlkeCkKK3sKKwl1
MzIgKmNzOworCisJY3MgPSBpbnRlbF9yaW5nX2JlZ2luKHJxLCAxMCk7CisJaWYgKElTX0VSUihj
cykpCisJCXJldHVybiBQVFJfRVJSKGNzKTsKKworCSpjcysrID0gTUlfQVJCX09OX09GRiB8IE1J
X0FSQl9FTkFCTEU7CisKKwkqY3MrKyA9IE1JX1NFTUFQSE9SRV9XQUlUIHwKKwkJTUlfU0VNQVBI
T1JFX0dMT0JBTF9HVFQgfAorCQlNSV9TRU1BUEhPUkVfUE9MTCB8CisJCU1JX1NFTUFQSE9SRV9T
QURfTkVRX1NERDsKKwkqY3MrKyA9IDA7CisJKmNzKysgPSBpOTE1X2dndHRfb2Zmc2V0KHZtYSkg
KyA0ICogaWR4OworCSpjcysrID0gMDsKKworCWlmIChpZHggPiAwKSB7CisJCSpjcysrID0gTUlf
U1RPUkVfRFdPUkRfSU1NX0dFTjQgfCBNSV9VU0VfR0dUVDsKKwkJKmNzKysgPSBpOTE1X2dndHRf
b2Zmc2V0KHZtYSkgKyA0ICogKGlkeCAtIDEpOworCQkqY3MrKyA9IDA7CisJCSpjcysrID0gMTsK
Kwl9IGVsc2UgeworCQkqY3MrKyA9IE1JX05PT1A7CisJCSpjcysrID0gTUlfTk9PUDsKKwkJKmNz
KysgPSBNSV9OT09QOworCQkqY3MrKyA9IE1JX05PT1A7CisJfQorCisJKmNzKysgPSBNSV9BUkJf
T05fT0ZGIHwgTUlfQVJCX0RJU0FCTEU7CisKKwlpbnRlbF9yaW5nX2FkdmFuY2UocnEsIGNzKTsK
KwlyZXR1cm4gMDsKK30KKworc3RhdGljIHN0cnVjdCBpOTE1X3JlcXVlc3QgKgorc2VtYXBob3Jl
X3F1ZXVlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwgc3RydWN0IGk5MTVfdm1hICp2
bWEsIGludCBpZHgpCit7CisJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKKwlzdHJ1Y3Qg
aTkxNV9yZXF1ZXN0ICpycTsKKwlpbnQgZXJyOworCisJY3R4ID0ga2VybmVsX2NvbnRleHQoZW5n
aW5lLT5pOTE1KTsKKwlpZiAoIWN0eCkKKwkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7CisKKwly
cSA9IGlndF9yZXF1ZXN0X2FsbG9jKGN0eCwgZW5naW5lKTsKKwlpZiAoSVNfRVJSKHJxKSkKKwkJ
Z290byBvdXRfY3R4OworCisJZXJyID0gZW1pdF9zZW1hcGhvcmVfY2hhaW4ocnEsIHZtYSwgaWR4
KTsKKwlpOTE1X3JlcXVlc3RfYWRkKHJxKTsKKwlpZiAoZXJyKQorCQlycSA9IEVSUl9QVFIoZXJy
KTsKKworb3V0X2N0eDoKKwlrZXJuZWxfY29udGV4dF9jbG9zZShjdHgpOworCXJldHVybiBycTsK
K30KKworc3RhdGljIGludAorcmVsZWFzZV9xdWV1ZShzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICpl
bmdpbmUsCisJICAgICAgc3RydWN0IGk5MTVfdm1hICp2bWEsCisJICAgICAgaW50IGlkeCkKK3sK
KwlzdHJ1Y3QgaTkxNV9zY2hlZF9hdHRyIGF0dHIgPSB7CisJCS5wcmlvcml0eSA9IEk5MTVfVVNF
Ul9QUklPUklUWShJOTE1X1BSSU9SSVRZX01BWCksCisJfTsKKwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycTsKKwl1MzIgKmNzOworCisJcnEgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKGVuZ2luZS0+a2Vy
bmVsX2NvbnRleHQpOworCWlmIChJU19FUlIocnEpKQorCQlyZXR1cm4gUFRSX0VSUihycSk7CisK
KwljcyA9IGludGVsX3JpbmdfYmVnaW4ocnEsIDQpOworCWlmIChJU19FUlIoY3MpKSB7CisJCWk5
MTVfcmVxdWVzdF9hZGQocnEpOworCQlyZXR1cm4gUFRSX0VSUihjcyk7CisJfQorCisJKmNzKysg
PSBNSV9TVE9SRV9EV09SRF9JTU1fR0VONCB8IE1JX1VTRV9HR1RUOworCSpjcysrID0gaTkxNV9n
Z3R0X29mZnNldCh2bWEpICsgNCAqIChpZHggLSAxKTsKKwkqY3MrKyA9IDA7CisJKmNzKysgPSAx
OworCisJaW50ZWxfcmluZ19hZHZhbmNlKHJxLCBjcyk7CisJaTkxNV9yZXF1ZXN0X2FkZChycSk7
CisKKwllbmdpbmUtPnNjaGVkdWxlKHJxLCAmYXR0cik7CisKKwlyZXR1cm4gMDsKK30KKworc3Rh
dGljIGludAorc2xpY2Vfc2VtYXBob3JlX3F1ZXVlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKm91
dGVyLAorCQkgICAgICBzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKKwkJICAgICAgaW50IGNvdW50KQor
eworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKKwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpoZWFkOworCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOworCWludCBlcnIsIGksIG4gPSAwOwor
CisJaGVhZCA9IHNlbWFwaG9yZV9xdWV1ZShvdXRlciwgdm1hLCBuKyspOworCWlmIChJU19FUlIo
aGVhZCkpCisJCXJldHVybiBQVFJfRVJSKGhlYWQpOworCisJaTkxNV9yZXF1ZXN0X2dldChoZWFk
KTsKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBvdXRlci0+aTkxNSwgaWQpIHsKKwkJZm9yIChp
ID0gMDsgaSA8IGNvdW50OyBpKyspIHsKKwkJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOworCisJ
CQlycSA9IHNlbWFwaG9yZV9xdWV1ZShlbmdpbmUsIHZtYSwgbisrKTsKKwkJCWlmIChJU19FUlIo
cnEpKSB7CisJCQkJZXJyID0gUFRSX0VSUihycSk7CisJCQkJZ290byBvdXQ7CisJCQl9CisJCX0K
Kwl9CisKKwllcnIgPSByZWxlYXNlX3F1ZXVlKG91dGVyLCB2bWEsIG4pOworCWlmIChlcnIpCisJ
CWdvdG8gb3V0OworCisJaWYgKGk5MTVfcmVxdWVzdF93YWl0KGhlYWQsCisJCQkgICAgICBJOTE1
X1dBSVRfTE9DS0VELAorCQkJICAgICAgMiAqIFJVTlRJTUVfSU5GTyhvdXRlci0+aTkxNSktPm51
bV9lbmdpbmVzICogKGNvdW50ICsgMikgKiAoY291bnQgKyAzKSkgPCAwKSB7CisJCXByX2Vycigi
RmFpbGVkIHRvIHNsaWNlIGFsb25nIHNlbWFwaG9yZSBjaGFpbiBvZiBsZW5ndGggKCVkLCAlZCkh
XG4iLAorCQkgICAgICAgY291bnQsIG4pOworCQlHRU1fVFJBQ0VfRFVNUCgpOworCQlpOTE1X2dl
bV9zZXRfd2VkZ2VkKG91dGVyLT5pOTE1KTsKKwkJZXJyID0gLUVJTzsKKwl9CisKK291dDoKKwlp
OTE1X3JlcXVlc3RfcHV0KGhlYWQpOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQgbGl2
ZV90aW1lc2xpY2VfcHJlZW1wdCh2b2lkICphcmcpCit7CisJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUgPSBhcmc7CisJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKKwlpbnRl
bF93YWtlcmVmX3Qgd2FrZXJlZjsKKwlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKKwl2b2lkICp2YWRk
cjsKKwlpbnQgZXJyID0gMDsKKwlpbnQgY291bnQ7CisKKwkvKgorCSAqIElmIGEgcmVxdWVzdCB0
YWtlcyB0b28gbG9uZywgd2Ugd291bGQgbGlrZSB0byBnaXZlIG90aGVyIHVzZXJzCisJICogYSBm
YWlyIGdvIG9uIHRoZSBHUFUuIEluIHBhcnRpY3VsYXIsIHVzZXJzIG1heSBjcmVhdGUgYmF0Y2hl
cworCSAqIHRoYXQgd2FpdCB1cG9uIGV4dGVybmFsIGlucHV0LCB3aGVyZSB0aGF0IGlucHV0IG1h
eSBldmVuIGJlCisJICogc3VwcGxpZWQgYnkgYW5vdGhlciBHUFUgam9iLiBUbyBhdm9pZCBibG9j
a2luZyBmb3JldmVyLCB3ZQorCSAqIG5lZWQgdG8gcHJlZW1wdCB0aGUgY3VycmVudCB0YXNrIGFu
ZCByZXBsYWNlIGl0IHdpdGggYW5vdGhlcgorCSAqIHJlYWR5IHRhc2suCisJICovCisKKwltdXRl
eF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwl3YWtlcmVmID0gaW50ZWxfcnVudGlt
ZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOworCisJb2JqID0gaTkxNV9nZW1fb2JqZWN0X2Ny
ZWF0ZV9pbnRlcm5hbChpOTE1LCBQQUdFX1NJWkUpOworCWlmIChJU19FUlIob2JqKSkgeworCQll
cnIgPSBQVFJfRVJSKG9iaik7CisJCWdvdG8gZXJyX3VubG9jazsKKwl9CisKKwl2bWEgPSBpOTE1
X3ZtYV9pbnN0YW5jZShvYmosICZpOTE1LT5nZ3R0LnZtLCBOVUxMKTsKKwlpZiAoSVNfRVJSKHZt
YSkpIHsKKwkJZXJyID0gUFRSX0VSUih2bWEpOworCQlnb3RvIGVycl9vYmo7CisJfQorCisJdmFk
ZHIgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChvYmosIEk5MTVfTUFQX1dDKTsKKwlpZiAoSVNf
RVJSKHZhZGRyKSkgeworCQllcnIgPSBQVFJfRVJSKHZhZGRyKTsKKwkJZ290byBlcnJfb2JqOwor
CX0KKworCWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIFBJTl9HTE9CQUwpOworCWlmIChl
cnIpCisJCWdvdG8gZXJyX21hcDsKKworCWZvcl9lYWNoX3ByaW1lX251bWJlcl9mcm9tKGNvdW50
LCAxLCAxNikgeworCQlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CisJCWVudW0gaW50
ZWxfZW5naW5lX2lkIGlkOworCisJCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7
CisJCQltZW1zZXQodmFkZHIsIDAsIFBBR0VfU0laRSk7CisKKwkJCWVyciA9IHNsaWNlX3NlbWFw
aG9yZV9xdWV1ZShlbmdpbmUsIHZtYSwgY291bnQpOworCQkJaWYgKGVycikKKwkJCQlnb3RvIGVy
cl9waW47CisKKwkJCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkg
eworCQkJCWVyciA9IC1FSU87CisJCQkJZ290byBlcnJfcGluOworCQkJfQorCQl9CisJfQorCitl
cnJfcGluOgorCWk5MTVfdm1hX3VucGluKHZtYSk7CitlcnJfbWFwOgorCWk5MTVfZ2VtX29iamVj
dF91bnBpbl9tYXAob2JqKTsKK2Vycl9vYmo6CisJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwor
ZXJyX3VubG9jazoKKwlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkp
CisJCWVyciA9IC1FSU87CisJaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0s
IHdha2VyZWYpOworCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisKKwly
ZXR1cm4gZXJyOworfQorCiBzdGF0aWMgaW50IGxpdmVfYnVzeXdhaXRfcHJlZW1wdCh2b2lkICph
cmcpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CkBAIC0zOTgsNiAr
NjE3LDkgQEAgc3RhdGljIGludCBsaXZlX2xhdGVfcHJlZW1wdCh2b2lkICphcmcpCiAJaWYgKCFj
dHhfbG8pCiAJCWdvdG8gZXJyX2N0eF9oaTsKIAorCS8qIE1ha2Ugc3VyZSBjdHhfbG8gc3RheXMg
YmVmb3JlIGN0eF9oaSB1bnRpbCB3ZSB0cmlnZ2VyIHByZWVtcHRpb24uICovCisJY3R4X2xvLT5z
Y2hlZC5wcmlvcml0eSA9IEk5MTVfVVNFUl9QUklPUklUWSgxKTsKKwogCWZvcl9lYWNoX2VuZ2lu
ZShlbmdpbmUsIGk5MTUsIGlkKSB7CiAJCXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7CiAJCXN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxOwpAQCAtMTgxMiw2ICsyMDM0LDcgQEAgaW50IGludGVsX2V4ZWNs
aXN0c19saXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlz
dGF0aWMgY29uc3Qgc3RydWN0IGk5MTVfc3VidGVzdCB0ZXN0c1tdID0gewogCQlTVUJURVNUKGxp
dmVfc2FuaXR5Y2hlY2spLAorCQlTVUJURVNUKGxpdmVfdGltZXNsaWNlX3ByZWVtcHQpLAogCQlT
VUJURVNUKGxpdmVfYnVzeXdhaXRfcHJlZW1wdCksCiAJCVNVQlRFU1QobGl2ZV9wcmVlbXB0KSwK
IAkJU1VCVEVTVChsaXZlX2xhdGVfcHJlZW1wdCksCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3NjaGVkdWxlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hl
ZHVsZXIuYwppbmRleCBiMWJhM2U2NWNkNTIuLjBiZDQ1MmU4NTFkOCAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X3NjaGVkdWxlci5jCkBAIC0zOTQsNiArMzk0LDcgQEAgYm9vbCBfX2k5MTVfc2No
ZWRfbm9kZV9hZGRfZGVwZW5kZW5jeShzdHJ1Y3QgaTkxNV9zY2hlZF9ub2RlICpub2RlLAogCQls
aXN0X2FkZCgmZGVwLT53YWl0X2xpbmssICZzaWduYWwtPndhaXRlcnNfbGlzdCk7CiAJCWxpc3Rf
YWRkKCZkZXAtPnNpZ25hbF9saW5rLCAmbm9kZS0+c2lnbmFsZXJzX2xpc3QpOwogCQlkZXAtPnNp
Z25hbGVyID0gc2lnbmFsOworCQlkZXAtPndhaXRlciA9IG5vZGU7CiAJCWRlcC0+ZmxhZ3MgPSBm
bGFnczsKIAogCQkvKiBLZWVwIHRyYWNrIG9mIHdoZXRoZXIgYW55b25lIG9uIHRoaXMgY2hhaW4g
aGFzIGEgc2VtYXBob3JlICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3NjaGVkdWxlcl90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXJf
dHlwZXMuaAppbmRleCAzZTMwOTYzMWJkMGIuLmFhZDgxYWNiYTlkYyAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zY2hlZHVsZXJfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3NjaGVkdWxlcl90eXBlcy5oCkBAIC02Miw2ICs2Miw3IEBAIHN0cnVj
dCBpOTE1X3NjaGVkX25vZGUgewogCiBzdHJ1Y3QgaTkxNV9kZXBlbmRlbmN5IHsKIAlzdHJ1Y3Qg
aTkxNV9zY2hlZF9ub2RlICpzaWduYWxlcjsKKwlzdHJ1Y3QgaTkxNV9zY2hlZF9ub2RlICp3YWl0
ZXI7CiAJc3RydWN0IGxpc3RfaGVhZCBzaWduYWxfbGluazsKIAlzdHJ1Y3QgbGlzdF9oZWFkIHdh
aXRfbGluazsKIAlzdHJ1Y3QgbGlzdF9oZWFkIGRmc19saW5rOwotLSAKMi4yMC4xCgpfX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGlu
ZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVl
ZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

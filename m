Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id D7FFD35E14
	for <lists+intel-gfx@lfdr.de>; Wed,  5 Jun 2019 15:39:16 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 10B37899B0;
	Wed,  5 Jun 2019 13:39:15 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga12.intel.com (mga12.intel.com [192.55.52.136])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9B4AD8997E
 for <intel-gfx@lists.freedesktop.org>; Wed,  5 Jun 2019 13:39:13 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga008.fm.intel.com ([10.253.24.58])
 by fmsmga106.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 05 Jun 2019 06:39:13 -0700
X-ExtLoop1: 1
Received: from mkopansk-mobl1.ger.corp.intel.com (HELO
 delly.ger.corp.intel.com) ([10.249.139.46])
 by fmsmga008.fm.intel.com with ESMTP; 05 Jun 2019 06:39:12 -0700
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Wed,  5 Jun 2019 16:38:51 +0300
Message-Id: <20190605133852.4493-8-lionel.g.landwerlin@intel.com>
X-Mailer: git-send-email 2.21.0.392.gf8f6787159e
In-Reply-To: <20190605133852.4493-1-lionel.g.landwerlin@intel.com>
References: <20190605133852.4493-1-lionel.g.landwerlin@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v4 7/7] drm/i915: add support for perf
 configuration queries
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

TGlzdGluZyBjb25maWd1cmF0aW9ucyBhdCB0aGUgbW9tZW50IGlzIHN1cHBvcnRlZCBvbmx5IHRo
cm91Z2ggc3lzZnMuClRoaXMgbWlnaHQgY2F1c2UgaXNzdWVzIGZvciBhcHBsaWNhdGlvbnMgd2Fu
dGluZyB0byBsaXN0CmNvbmZpZ3VyYXRpb25zIGZyb20gYSBjb250YWluZXIgd2hlcmUgc3lzZnMg
aXNuJ3QgYXZhaWxhYmxlLgoKVGhpcyBjaGFuZ2UgYWRkcyBhIHdheSB0byBxdWVyeSB0aGUgbnVt
YmVyIG9mIGNvbmZpZ3VyYXRpb25zIGFuZCB0aGVpcgpjb250ZW50IHRocm91Z2ggdGhlIGk5MTUg
cXVlcnkgdUFQSS4KCnYyOiBGaXggc3BhcnNlIHdhcm5pbmdzIChMaW9uZWwpCiAgICBBZGQgc3Vw
cG9ydCB0byBxdWVyeSBjb25maWd1cmF0aW9uIHVzaW5nIHV1aWQgKExpb25lbCkKCnYzOiBGaXgg
c29tZSBpbmNvbnNpc3RlbmN5IGluIHVhcGkgaGVhZGVyIChMaW9uZWwpCiAgICBGaXggdW5sb2Nr
aW5nIHdoZW4gbm90IGxvY2tlZCBpc3N1ZSAoTGlvbmVsKQogICAgQWRkIGRlYnVnIG1lc3NhZ2Vz
IChMaW9uZWwpCgp2NDogRml4IG1pc3NpbmcgdW5sb2NrIChEYW4pCgpTaWduZWQtb2ZmLWJ5OiBM
aW9uZWwgTGFuZHdlcmxpbiA8bGlvbmVsLmcubGFuZHdlcmxpbkBpbnRlbC5jb20+Ci0tLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAgIHwgICA2ICsKIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfcGVyZi5jICB8ICAgNCArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3F1ZXJ5
LmMgfCAyNzkgKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiBpbmNsdWRlL3VhcGkvZHJt
L2k5MTVfZHJtLmggICAgICAgfCAgNjIgKysrKysrLQogNCBmaWxlcyBjaGFuZ2VkLCAzNTAgaW5z
ZXJ0aW9ucygrKSwgMSBkZWxldGlvbigtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCmluZGV4IDFj
YjQxZjM5OGMwNS4uZWIzNGQ3Y2I4NTdlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKQEAgLTE3
OTMsNiArMTc5MywxMiBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSB7CiAJCSAqLwogCQlzdHJ1
Y3QgbGlzdF9oZWFkIG1ldHJpY3NfYnVmZmVyczsKIAorCQkvKgorCQkgKiBOdW1iZXIgb2YgZHlu
YW1pYyBjb25maWd1cmF0aW9ucywgeW91IG5lZWQgdG8gaG9sZAorCQkgKiBkZXZfcHJpdi0+cGVy
Zi5tZXRyaWNzX2xvY2sgdG8gYWNjZXNzIGl0LgorCQkgKi8KKwkJdTMyIG5fbWV0cmljczsKKwog
CQkvKgogCQkgKiBMb2NrIGFzc29jaWF0ZWQgd2l0aCBhbnl0aGluZyBiZWxvdyB3aXRoaW4gdGhp
cyBzdHJ1Y3R1cmUKIAkJICogZXhjZXB0IGV4Y2x1c2l2ZV9zdHJlYW0uCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfcGVyZi5jCmluZGV4IDA3NTU3NDZkNDE2ZS4uNGE3NjcwODdkZTI3IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3BlcmYuYwpAQCAtMzQxNyw2ICszNDE3LDggQEAgaW50IGk5MTVfcGVyZl9hZGRfY29u
ZmlnX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCWdvdG8gc3lz
ZnNfZXJyOwogCX0KIAorCWRldl9wcml2LT5wZXJmLm5fbWV0cmljcysrOworCiAJbXV0ZXhfdW5s
b2NrKCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2xvY2spOwogCiAJRFJNX0RFQlVHKCJBZGRlZCBj
b25maWcgJXMgaWQ9JWlcbiIsIG9hX2NvbmZpZy0+dXVpZCwgb2FfY29uZmlnLT5pZCk7CkBAIC0z
NDc4LDYgKzM0ODAsOCBAQCBpbnQgaTkxNV9wZXJmX3JlbW92ZV9jb25maWdfaW9jdGwoc3RydWN0
IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAogCWlkcl9yZW1vdmUoJmRldl9wcml2LT5w
ZXJmLm1ldHJpY3NfaWRyLCAqYXJnKTsKIAorCWRldl9wcml2LT5wZXJmLm5fbWV0cmljcy0tOwor
CiAJRFJNX0RFQlVHKCJSZW1vdmVkIGNvbmZpZyAlcyBpZD0laVxuIiwgb2FfY29uZmlnLT51dWlk
LCBvYV9jb25maWctPmlkKTsKIAogCWk5MTVfb2FfY29uZmlnX3B1dChvYV9jb25maWcpOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9xdWVyeS5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9xdWVyeS5jCmluZGV4IDdiNzAxNjE3MTA1Ny4uYzFlMjAzYzdiMmMyIDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3F1ZXJ5LmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9xdWVyeS5jCkBAIC0xNDMsMTAgKzE0MywyODkgQEAgcXVlcnlf
ZW5naW5lX2luZm8oc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJcmV0dXJuIGxlbjsK
IH0KIAorc3RhdGljIGludCBjYW5fY29weV9wZXJmX2NvbmZpZ19yZWdpc3RlcnNfb3JfbnVtYmVy
KHUzMiB1c2VyX25fcmVncywKKwkJCQkJCSAgICB1NjQgdXNlcl9yZWdzX3B0ciwKKwkJCQkJCSAg
ICB1MzIga2VybmVsX25fcmVncykKK3sKKwkvKgorCSAqIFdlJ2xsIGp1c3QgcHV0IHRoZSBudW1i
ZXIgb2YgcmVnaXN0ZXJzLCBhbmQgd29uJ3QgY29weSB0aGUKKwkgKiByZWdpc3Rlci4KKwkgKi8K
KwlpZiAodXNlcl9uX3JlZ3MgPT0gMCkKKwkJcmV0dXJuIDA7CisKKwlpZiAodXNlcl9uX3JlZ3Mg
PCBrZXJuZWxfbl9yZWdzKQorCQlyZXR1cm4gLUVJTlZBTDsKKworCWlmICghYWNjZXNzX29rKHU2
NF90b191c2VyX3B0cih1c2VyX3JlZ3NfcHRyKSwKKwkJICAgICAgIDIgKiBzaXplb2YodTMyKSAq
IGtlcm5lbF9uX3JlZ3MpKQorCQlyZXR1cm4gLUVGQVVMVDsKKworCXJldHVybiAwOworfQorCitz
dGF0aWMgaW50IGNvcHlfcGVyZl9jb25maWdfcmVnaXN0ZXJzX29yX251bWJlcihjb25zdCBzdHJ1
Y3QgaTkxNV9vYV9yZWcgKmtlcm5lbF9yZWdzLAorCQkJCQkJdTMyIGtlcm5lbF9uX3JlZ3MsCisJ
CQkJCQl1NjQgdXNlcl9yZWdzX3B0ciwKKwkJCQkJCXUzMiAqdXNlcl9uX3JlZ3MpCit7CisJdTMy
IHI7CisKKwlpZiAoKnVzZXJfbl9yZWdzID09IDApIHsKKwkJKnVzZXJfbl9yZWdzID0ga2VybmVs
X25fcmVnczsKKwkJcmV0dXJuIDA7CisJfQorCisJKnVzZXJfbl9yZWdzID0ga2VybmVsX25fcmVn
czsKKworCWZvciAociA9IDA7IHIgPCBrZXJuZWxfbl9yZWdzOyByKyspIHsKKwkJdTMyIF9fdXNl
ciAqdXNlcl9yZWdfcHRyID0KKwkJCXU2NF90b191c2VyX3B0cih1c2VyX3JlZ3NfcHRyICsgc2l6
ZW9mKHUzMikgKiByICogMik7CisJCXUzMiBfX3VzZXIgKnVzZXJfdmFsX3B0ciA9CisJCQl1NjRf
dG9fdXNlcl9wdHIodXNlcl9yZWdzX3B0ciArIHNpemVvZih1MzIpICogciAqIDIgKworCQkJCQlz
aXplb2YodTMyKSk7CisJCWludCByZXQ7CisKKwkJcmV0ID0gX19wdXRfdXNlcihpOTE1X21taW9f
cmVnX29mZnNldChrZXJuZWxfcmVnc1tyXS5hZGRyKSwKKwkJCQkgdXNlcl9yZWdfcHRyKTsKKwkJ
aWYgKHJldCkKKwkJCXJldHVybiAtRUZBVUxUOworCisJCXJldCA9IF9fcHV0X3VzZXIoa2VybmVs
X3JlZ3Nbcl0udmFsdWUsIHVzZXJfdmFsX3B0cik7CisJCWlmIChyZXQpCisJCQlyZXR1cm4gLUVG
QVVMVDsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBxdWVyeV9wZXJmX2NvbmZp
Z19kYXRhKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAorCQkJCSAgc3RydWN0IGRybV9p
OTE1X3F1ZXJ5X2l0ZW0gKnF1ZXJ5X2l0ZW0sCisJCQkJICBib29sIHVzZV91dWlkKQoreworCXN0
cnVjdCBkcm1faTkxNV9xdWVyeV9wZXJmX2NvbmZpZyBfX3VzZXIgKnVzZXJfcXVlcnlfY29uZmln
X3B0ciA9CisJCXU2NF90b191c2VyX3B0cihxdWVyeV9pdGVtLT5kYXRhX3B0cik7CisJc3RydWN0
IGRybV9pOTE1X3BlcmZfb2FfY29uZmlnIF9fdXNlciAqdXNlcl9jb25maWdfcHRyID0KKwkJdTY0
X3RvX3VzZXJfcHRyKHF1ZXJ5X2l0ZW0tPmRhdGFfcHRyICsKKwkJCQlzaXplb2Yoc3RydWN0IGRy
bV9pOTE1X3F1ZXJ5X3BlcmZfY29uZmlnKSk7CisJc3RydWN0IGRybV9pOTE1X3BlcmZfb2FfY29u
ZmlnIHVzZXJfY29uZmlnOworCXN0cnVjdCBpOTE1X29hX2NvbmZpZyAqb2FfY29uZmlnID0gTlVM
TDsKKwl1MzIgZmxhZ3MsIHRvdGFsX3NpemU7CisJaW50IHJldDsKKworCWlmICghaTkxNS0+cGVy
Zi5pbml0aWFsaXplZCkKKwkJcmV0dXJuIC1FTk9ERVY7CisKKwl0b3RhbF9zaXplID0gc2l6ZW9m
KHN0cnVjdCBkcm1faTkxNV9xdWVyeV9wZXJmX2NvbmZpZykgKworCQlzaXplb2Yoc3RydWN0IGRy
bV9pOTE1X3BlcmZfb2FfY29uZmlnKTsKKworCWlmIChxdWVyeV9pdGVtLT5sZW5ndGggPT0gMCkK
KwkJcmV0dXJuIHRvdGFsX3NpemU7CisKKwlpZiAocXVlcnlfaXRlbS0+bGVuZ3RoIDwgdG90YWxf
c2l6ZSkgeworCQlEUk1fREVCVUcoIkludmFsaWQgcXVlcnkgY29uZmlnIGRhdGEgaXRlbSBzaXpl
PSV1IGV4cGVjdGVkPSV1XG4iLAorCQkJICBxdWVyeV9pdGVtLT5sZW5ndGgsIHRvdGFsX3NpemUp
OworCQlyZXR1cm4gLUVJTlZBTDsKKwl9CisKKwlpZiAoIWFjY2Vzc19vayh1c2VyX3F1ZXJ5X2Nv
bmZpZ19wdHIsIHRvdGFsX3NpemUpKQorCQlyZXR1cm4gLUVGQVVMVDsKKworCWlmIChfX2dldF91
c2VyKGZsYWdzLCAmdXNlcl9xdWVyeV9jb25maWdfcHRyLT5mbGFncykpCisJCXJldHVybiAtRUZB
VUxUOworCisJaWYgKGZsYWdzICE9IDApCisJCXJldHVybiAtRUlOVkFMOworCisJcmV0ID0gbXV0
ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZpOTE1LT5wZXJmLm1ldHJpY3NfbG9jayk7CisJaWYgKHJl
dCkKKwkJcmV0dXJuIHJldDsKKworCWlmICh1c2VfdXVpZCkgeworCQljaGFyIHV1aWRbVVVJRF9T
VFJJTkdfTEVOICsgMV0gPSB7IDAsIH07CisJCXN0cnVjdCBpOTE1X29hX2NvbmZpZyAqdG1wOwor
CQlpbnQgaWQ7CisKKwkJQlVJTERfQlVHX09OKHNpemVvZih1c2VyX3F1ZXJ5X2NvbmZpZ19wdHIt
PnV1aWQpID49IHNpemVvZih1dWlkKSk7CisKKwkJaWYgKF9fY29weV9mcm9tX3VzZXIodXVpZCwg
dXNlcl9xdWVyeV9jb25maWdfcHRyLT51dWlkLAorCQkJCSAgICAgc2l6ZW9mKHVzZXJfcXVlcnlf
Y29uZmlnX3B0ci0+dXVpZCkpKSB7CisJCQlyZXQgPSAtRUZBVUxUOworCQkJZ290byBvdXQ7CisJ
CX0KKworCQlpZHJfZm9yX2VhY2hfZW50cnkoJmk5MTUtPnBlcmYubWV0cmljc19pZHIsIHRtcCwg
aWQpIHsKKwkJCWlmICghc3RyY21wKHRtcC0+dXVpZCwgdXVpZCkpIHsKKwkJCQlvYV9jb25maWcg
PSB0bXA7CisJCQkJYnJlYWs7CisJCQl9CisJCX0KKwl9IGVsc2UgeworCQl1NjQgY29uZmlnX2lk
OworCisJCWlmIChfX2dldF91c2VyKGNvbmZpZ19pZCwgJnVzZXJfcXVlcnlfY29uZmlnX3B0ci0+
Y29uZmlnKSkgeworCQkJcmV0ID0gLUVGQVVMVDsKKwkJCWdvdG8gb3V0OworCQl9CisKKwkJaWYg
KGNvbmZpZ19pZCA9PSAxKQorCQkJb2FfY29uZmlnID0gJmk5MTUtPnBlcmYub2EudGVzdF9jb25m
aWc7CisJCWVsc2UKKwkJCW9hX2NvbmZpZyA9IGlkcl9maW5kKCZpOTE1LT5wZXJmLm1ldHJpY3Nf
aWRyLCBjb25maWdfaWQpOworCX0KKworCWlmICghb2FfY29uZmlnKSB7CisJCXJldCA9IC1FTk9F
TlQ7CisJCWdvdG8gb3V0OworCX0KKworCWlmIChfX2NvcHlfZnJvbV91c2VyKCZ1c2VyX2NvbmZp
ZywgdXNlcl9jb25maWdfcHRyLAorCQkJICAgICBzaXplb2YodXNlcl9jb25maWcpKSkgeworCQly
ZXQgPSAtRUZBVUxUOworCQlnb3RvIG91dDsKKwl9CisKKwlyZXQgPSBjYW5fY29weV9wZXJmX2Nv
bmZpZ19yZWdpc3RlcnNfb3JfbnVtYmVyKHVzZXJfY29uZmlnLm5fYm9vbGVhbl9yZWdzLAorCQkJ
CQkJICAgICAgIHVzZXJfY29uZmlnLmJvb2xlYW5fcmVnc19wdHIsCisJCQkJCQkgICAgICAgb2Ff
Y29uZmlnLT5iX2NvdW50ZXJfcmVnc19sZW4pOworCWlmIChyZXQpCisJCWdvdG8gb3V0OworCisJ
cmV0ID0gY2FuX2NvcHlfcGVyZl9jb25maWdfcmVnaXN0ZXJzX29yX251bWJlcih1c2VyX2NvbmZp
Zy5uX2ZsZXhfcmVncywKKwkJCQkJCSAgICAgICB1c2VyX2NvbmZpZy5mbGV4X3JlZ3NfcHRyLAor
CQkJCQkJICAgICAgIG9hX2NvbmZpZy0+ZmxleF9yZWdzX2xlbik7CisJaWYgKHJldCkKKwkJZ290
byBvdXQ7CisKKwlyZXQgPSBjYW5fY29weV9wZXJmX2NvbmZpZ19yZWdpc3RlcnNfb3JfbnVtYmVy
KHVzZXJfY29uZmlnLm5fbXV4X3JlZ3MsCisJCQkJCQkgICAgICAgdXNlcl9jb25maWcubXV4X3Jl
Z3NfcHRyLAorCQkJCQkJICAgICAgIG9hX2NvbmZpZy0+bXV4X3JlZ3NfbGVuKTsKKwlpZiAocmV0
KQorCQlnb3RvIG91dDsKKworCXJldCA9IGNvcHlfcGVyZl9jb25maWdfcmVnaXN0ZXJzX29yX251
bWJlcihvYV9jb25maWctPmJfY291bnRlcl9yZWdzLAorCQkJCQkJICAgb2FfY29uZmlnLT5iX2Nv
dW50ZXJfcmVnc19sZW4sCisJCQkJCQkgICB1c2VyX2NvbmZpZy5ib29sZWFuX3JlZ3NfcHRyLAor
CQkJCQkJICAgJnVzZXJfY29uZmlnLm5fYm9vbGVhbl9yZWdzKTsKKwlpZiAocmV0KQorCQlnb3Rv
IG91dDsKKworCXJldCA9IGNvcHlfcGVyZl9jb25maWdfcmVnaXN0ZXJzX29yX251bWJlcihvYV9j
b25maWctPmZsZXhfcmVncywKKwkJCQkJCSAgIG9hX2NvbmZpZy0+ZmxleF9yZWdzX2xlbiwKKwkJ
CQkJCSAgIHVzZXJfY29uZmlnLmZsZXhfcmVnc19wdHIsCisJCQkJCQkgICAmdXNlcl9jb25maWcu
bl9mbGV4X3JlZ3MpOworCWlmIChyZXQpCisJCWdvdG8gb3V0OworCisJcmV0ID0gY29weV9wZXJm
X2NvbmZpZ19yZWdpc3RlcnNfb3JfbnVtYmVyKG9hX2NvbmZpZy0+bXV4X3JlZ3MsCisJCQkJCQkg
ICBvYV9jb25maWctPm11eF9yZWdzX2xlbiwKKwkJCQkJCSAgIHVzZXJfY29uZmlnLm11eF9yZWdz
X3B0ciwKKwkJCQkJCSAgICZ1c2VyX2NvbmZpZy5uX211eF9yZWdzKTsKKwlpZiAocmV0KQorCQln
b3RvIG91dDsKKworCW1lbWNweSh1c2VyX2NvbmZpZy51dWlkLCBvYV9jb25maWctPnV1aWQsIHNp
emVvZih1c2VyX2NvbmZpZy51dWlkKSk7CisKKwlpZiAoX19jb3B5X3RvX3VzZXIodXNlcl9jb25m
aWdfcHRyLCAmdXNlcl9jb25maWcsCisJCQkgICBzaXplb2YodXNlcl9jb25maWcpKSkgeworCQly
ZXQgPSAtRUZBVUxUOworCQlnb3RvIG91dDsKKwl9CisKKwlyZXQgPSB0b3RhbF9zaXplOworCitv
dXQ6CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5wZXJmLm1ldHJpY3NfbG9jayk7CisJcmV0dXJuIHJl
dDsKK30KKworc3RhdGljIGludCBxdWVyeV9wZXJmX2NvbmZpZ19saXN0KHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1LAorCQkJCSAgc3RydWN0IGRybV9pOTE1X3F1ZXJ5X2l0ZW0gKnF1ZXJ5
X2l0ZW0pCit7CisJc3RydWN0IGRybV9pOTE1X3F1ZXJ5X3BlcmZfY29uZmlnIF9fdXNlciAqdXNl
cl9xdWVyeV9jb25maWdfcHRyID0KKwkJdTY0X3RvX3VzZXJfcHRyKHF1ZXJ5X2l0ZW0tPmRhdGFf
cHRyKTsKKwlzdHJ1Y3QgaTkxNV9vYV9jb25maWcgKm9hX2NvbmZpZzsKKwl1MzIgZmxhZ3MsIHRv
dGFsX3NpemU7CisJdTY0IG5fY29uZmlnczsKKwlpbnQgcmV0LCBpZDsKKworCWlmICghaTkxNS0+
cGVyZi5pbml0aWFsaXplZCkKKwkJcmV0dXJuIC1FTk9ERVY7CisKKwkvKiBDb3VudCB0aGUgZGVm
YXVsdCB0ZXN0IGNvbmZpZ3VyYXRpb24gKi8KKwluX2NvbmZpZ3MgPSBpOTE1LT5wZXJmLm5fbWV0
cmljcyArIDE7CisJdG90YWxfc2l6ZSA9IHNpemVvZihzdHJ1Y3QgZHJtX2k5MTVfcXVlcnlfcGVy
Zl9jb25maWcpICsKKwkJc2l6ZW9mKHU2NCkgKiBuX2NvbmZpZ3M7CisKKwlpZiAocXVlcnlfaXRl
bS0+bGVuZ3RoID09IDApCisJCXJldHVybiB0b3RhbF9zaXplOworCisJaWYgKHF1ZXJ5X2l0ZW0t
Pmxlbmd0aCA8IHRvdGFsX3NpemUpIHsKKwkJRFJNX0RFQlVHKCJJbnZhbGlkIHF1ZXJ5IGNvbmZp
ZyBsaXN0IGl0ZW0gc2l6ZT0ldSBleHBlY3RlZD0ldVxuIiwKKwkJCSAgcXVlcnlfaXRlbS0+bGVu
Z3RoLCB0b3RhbF9zaXplKTsKKwkJcmV0dXJuIC1FSU5WQUw7CisJfQorCisJaWYgKCFhY2Nlc3Nf
b2sodXNlcl9xdWVyeV9jb25maWdfcHRyLCB0b3RhbF9zaXplKSkKKwkJcmV0dXJuIC1FRkFVTFQ7
CisKKwlpZiAoX19nZXRfdXNlcihmbGFncywgJnVzZXJfcXVlcnlfY29uZmlnX3B0ci0+ZmxhZ3Mp
KQorCQlyZXR1cm4gLUVGQVVMVDsKKworCWlmIChmbGFncyAhPSAwKQorCQlyZXR1cm4gLUVJTlZB
TDsKKworCWlmIChfX3B1dF91c2VyKG5fY29uZmlncywgJnVzZXJfcXVlcnlfY29uZmlnX3B0ci0+
Y29uZmlnKSkKKwkJcmV0dXJuIC1FRkFVTFQ7CisKKwlpZiAoX19wdXRfdXNlcigodTY0KTFVTEws
ICZ1c2VyX3F1ZXJ5X2NvbmZpZ19wdHItPmRhdGFbMF0pKQorCQlyZXR1cm4gLUVGQVVMVDsKKwor
CXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmaTkxNS0+cGVyZi5tZXRyaWNzX2xvY2sp
OworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwluX2NvbmZpZ3MgPSAxOworCWlkcl9mb3Jf
ZWFjaF9lbnRyeSgmaTkxNS0+cGVyZi5tZXRyaWNzX2lkciwgb2FfY29uZmlnLCBpZCkgeworCQl1
NjQgX191c2VyICppdGVtID0KKwkJCXU2NF90b191c2VyX3B0cihxdWVyeV9pdGVtLT5kYXRhX3B0
ciArCisJCQkJCXNpemVvZihzdHJ1Y3QgZHJtX2k5MTVfcXVlcnlfcGVyZl9jb25maWcpICsKKwkJ
CQkJbl9jb25maWdzICogc2l6ZW9mKHU2NCkpOworCisJCWlmIChfX3B1dF91c2VyKCh1NjQpaWQs
IGl0ZW0pKSB7CisJCQlyZXQgPSAtRUZBVUxUOworCQkJZ290byBvdXQ7CisJCX0KKwkJbl9jb25m
aWdzKys7CisJfQorCisJcmV0ID0gdG90YWxfc2l6ZTsKKworb3V0OgorCW11dGV4X3VubG9jaygm
aTkxNS0+cGVyZi5tZXRyaWNzX2xvY2spOworCXJldHVybiByZXQ7Cit9CisKK3N0YXRpYyBpbnQg
cXVlcnlfcGVyZl9jb25maWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCisJCQkgICAg
IHN0cnVjdCBkcm1faTkxNV9xdWVyeV9pdGVtICpxdWVyeV9pdGVtKQoreworCXN3aXRjaCAocXVl
cnlfaXRlbS0+ZmxhZ3MpIHsKKwljYXNlIERSTV9JOTE1X1FVRVJZX1BFUkZfQ09ORklHX0xJU1Q6
CisJCXJldHVybiBxdWVyeV9wZXJmX2NvbmZpZ19saXN0KGk5MTUsIHF1ZXJ5X2l0ZW0pOworCWNh
c2UgRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfREFUQV9GT1JfVVVJRDoKKwkJcmV0dXJuIHF1
ZXJ5X3BlcmZfY29uZmlnX2RhdGEoaTkxNSwgcXVlcnlfaXRlbSwgdHJ1ZSk7CisJY2FzZSBEUk1f
STkxNV9RVUVSWV9QRVJGX0NPTkZJR19EQVRBX0ZPUl9JRDoKKwkJcmV0dXJuIHF1ZXJ5X3BlcmZf
Y29uZmlnX2RhdGEoaTkxNSwgcXVlcnlfaXRlbSwgZmFsc2UpOworCWRlZmF1bHQ6CisJCXJldHVy
biAtRUlOVkFMOworCX0KK30KKwogc3RhdGljIGludCAoKiBjb25zdCBpOTE1X3F1ZXJ5X2Z1bmNz
W10pKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCQkJc3RydWN0IGRybV9p
OTE1X3F1ZXJ5X2l0ZW0gKnF1ZXJ5X2l0ZW0pID0gewogCXF1ZXJ5X3RvcG9sb2d5X2luZm8sCiAJ
cXVlcnlfZW5naW5lX2luZm8sCisJcXVlcnlfcGVyZl9jb25maWcsCiB9OwogCiBpbnQgaTkxNV9x
dWVyeV9pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLCBzdHJ1Y3QgZHJt
X2ZpbGUgKmZpbGUpCmRpZmYgLS1naXQgYS9pbmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJtLmggYi9p
bmNsdWRlL3VhcGkvZHJtL2k5MTVfZHJtLmgKaW5kZXggZTNjNmM3MjE5M2VkLi5jNTdhNDkwZGIz
MjkgMTAwNjQ0Ci0tLSBhL2luY2x1ZGUvdWFwaS9kcm0vaTkxNV9kcm0uaAorKysgYi9pbmNsdWRl
L3VhcGkvZHJtL2k5MTVfZHJtLmgKQEAgLTIxMDgsNiArMjEwOCw3IEBAIHN0cnVjdCBkcm1faTkx
NV9xdWVyeV9pdGVtIHsKIAlfX3U2NCBxdWVyeV9pZDsKICNkZWZpbmUgRFJNX0k5MTVfUVVFUllf
VE9QT0xPR1lfSU5GTyAgICAxCiAjZGVmaW5lIERSTV9JOTE1X1FVRVJZX0VOR0lORV9JTkZPCTIK
KyNkZWZpbmUgRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUcgICAgICAzCiAvKiBNdXN0IGJlIGtl
cHQgY29tcGFjdCAtLSBubyBob2xlcyBhbmQgd2VsbCBkb2N1bWVudGVkICovCiAKIAkvKgpAQCAt
MjExOSw5ICsyMTIwLDE4IEBAIHN0cnVjdCBkcm1faTkxNV9xdWVyeV9pdGVtIHsKIAlfX3MzMiBs
ZW5ndGg7CiAKIAkvKgotCSAqIFVudXNlZCBmb3Igbm93LiBNdXN0IGJlIGNsZWFyZWQgdG8gemVy
by4KKwkgKiBXaGVuIHF1ZXJ5X2lkID09IERSTV9JOTE1X1FVRVJZX1RPUE9MT0dZX0lORk8sIG11
c3QgYmUgMC4KKwkgKgorCSAqIFdoZW4gcXVlcnlfaWQgPT0gRFJNX0k5MTVfUVVFUllfUEVSRl9D
T05GSUcsIG11c3QgYmUgb25lIG9mIHRoZQorCSAqIGZvbGxvd2luZyA6CisJICogICAgICAgICAt
IERSTV9JOTE1X1FVRVJZX1BFUkZfQ09ORklHX0xJU1QKKwkgKiAgICAgICAgIC0gRFJNX0k5MTVf
UVVFUllfUEVSRl9DT05GSUdfREFUQV9GT1JfVVVJRAorCSAqICAgICAgICAgLSBEUk1fSTkxNV9R
VUVSWV9QRVJGX0NPTkZJR19GT1JfVVVJRAogCSAqLwogCV9fdTMyIGZsYWdzOworI2RlZmluZSBE
Uk1fSTkxNV9RVUVSWV9QRVJGX0NPTkZJR19MSVNUICAgICAgICAgIDEKKyNkZWZpbmUgRFJNX0k5
MTVfUVVFUllfUEVSRl9DT05GSUdfREFUQV9GT1JfVVVJRCAyCisjZGVmaW5lIERSTV9JOTE1X1FV
RVJZX1BFUkZfQ09ORklHX0RBVEFfRk9SX0lEICAgMwogCiAJLyoKIAkgKiBEYXRhIHdpbGwgYmUg
d3JpdHRlbiBhdCB0aGUgbG9jYXRpb24gcG9pbnRlZCBieSBkYXRhX3B0ciB3aGVuIHRoZQpAQCAt
MjI0Nyw2ICsyMjU3LDU2IEBAIHN0cnVjdCBkcm1faTkxNV9xdWVyeV9lbmdpbmVfaW5mbyB7CiAJ
c3RydWN0IGRybV9pOTE1X2VuZ2luZV9pbmZvIGVuZ2luZXNbXTsKIH07CiAKKy8qCisgKiBEYXRh
IHdyaXR0ZW4gYnkgdGhlIGtlcm5lbCB3aXRoIHF1ZXJ5IERSTV9JOTE1X1FVRVJZX1BFUkZfQ09O
RklHLgorICovCitzdHJ1Y3QgZHJtX2k5MTVfcXVlcnlfcGVyZl9jb25maWcgeworCXVuaW9uIHsK
KwkJLyoKKwkJICogV2hlbiBxdWVyeV9pdGVtLmZsYWdzID09IERSTV9JOTE1X1FVRVJZX1BFUkZf
Q09ORklHX0xJU1QsIGk5MTUgc2V0cworCQkgKiB0aGlzIGZpZWxkcyB0byB0aGUgbnVtYmVyIG9m
IGNvbmZpZ3VyYXRpb25zIGF2YWlsYWJsZS4KKwkJICovCisJCV9fdTY0IG5fY29uZmlnczsKKwor
CQkvKgorCQkgKiBXaGVuIHF1ZXJ5X2lkID09IERSTV9JOTE1X1FVRVJZX1BFUkZfQ09ORklHX0RB
VEFfRk9SX0lELAorCQkgKiBpOTE1IHdpbGwgdXNlIHRoZSB2YWx1ZSBpbiB0aGlzIGZpZWxkIGFz
IGNvbmZpZ3VyYXRpb24KKwkJICogaWRlbnRpZmllciB0byBkZWNpZGUgd2hhdCBkYXRhIHRvIHdy
aXRlIGludG8gY29uZmlnX3B0ci4KKwkJICovCisJCV9fdTY0IGNvbmZpZzsKKworCQkvKgorCQkg
KiBXaGVuIHF1ZXJ5X2lkID09IERSTV9JOTE1X1FVRVJZX1BFUkZfQ09ORklHX0RBVEFfRk9SX1VV
SUQsCisJCSAqIGk5MTUgd2lsbCB1c2UgdGhlIHZhbHVlIGluIHRoaXMgZmllbGQgYXMgY29uZmln
dXJhdGlvbgorCQkgKiBpZGVudGlmaWVyIHRvIGRlY2lkZSB3aGF0IGRhdGEgdG8gd3JpdGUgaW50
byBjb25maWdfcHRyLgorCQkgKgorCQkgKiBTdHJpbmcgZm9ybWF0dGVkIGxpa2UgIiUwOHgtJTA0
eC0lMDR4LSUwNHgtJTAxMngiCisJCSAqLworCQljaGFyIHV1aWRbMzZdOworCX07CisKKwkvKgor
CSAqIFVudXNlZCBmb3Igbm93LiBNdXN0IGJlIGNsZWFyZWQgdG8gemVyby4KKwkgKi8KKwlfX3Uz
MiBmbGFnczsKKworCS8qCisJICogV2hlbiBxdWVyeV9pdGVtLmZsYWdzID09IERSTV9JOTE1X1FV
RVJZX1BFUkZfQ09ORklHX0xJU1QsIGk5MTUgd2lsbAorCSAqIHdyaXRlIGFuIGFycmF5IG9mIF9f
dTY0IG9mIGNvbmZpZ3VyYXRpb24gaWRlbnRpZmllcnMuCisJICoKKwkgKiBXaGVuIHF1ZXJ5X2l0
ZW0uZmxhZ3MgPT0gRFJNX0k5MTVfUVVFUllfUEVSRl9DT05GSUdfREFUQSwgaTkxNSB3aWxsCisJ
ICogd3JpdGUgYSBzdHJ1Y3QgZHJtX2k5MTVfcGVyZl9vYV9jb25maWcuIElmIHRoZSBmb2xsb3dp
bmcgZmllbGRzIG9mCisJICogZHJtX2k5MTVfcGVyZl9vYV9jb25maWcgYXJlIHNldCBub3Qgc2V0
IHRvIDAsIGk5MTUgd2lsbCB3cml0ZSBpbnRvCisJICogdGhlIGFzc29jaWF0ZWQgcG9pbnRlcnMg
dGhlIHZhbHVlcyBvZiBzdWJtaXR0ZWQgd2hlbiB0aGUKKwkgKiBjb25maWd1cmF0aW9uIHdhcyBj
cmVhdGVkIDoKKwkgKgorCSAqICAgICAgICAgLSBuX211eF9yZWdzCisJICogICAgICAgICAtIG5f
Ym9vbGVhbl9yZWdzCisJICogICAgICAgICAtIG5fZmxleF9yZWdzCisJICovCisJX191OCBkYXRh
W107Cit9OworCiAjaWYgZGVmaW5lZChfX2NwbHVzcGx1cykKIH0KICNlbmRpZgotLSAKMi4yMS4w
LjM5Mi5nZjhmNjc4NzE1OWUKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNr
dG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2lu
dGVsLWdmeA==

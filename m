Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id A90D3D8F98
	for <lists+intel-gfx@lfdr.de>; Wed, 16 Oct 2019 13:33:04 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id EB0C66E93D;
	Wed, 16 Oct 2019 11:33:02 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 20E566E93D
 for <intel-gfx@lists.freedesktop.org>; Wed, 16 Oct 2019 11:33:00 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18855872-1500050 
 for multiple; Wed, 16 Oct 2019 12:32:42 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 16 Oct 2019 12:32:40 +0100
Message-Id: <20191016113240.6468-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/selftests: Teach execlists to take
 intel_gt as its argument
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIGV4ZWNsaXN0cyBzZWxmdGVzdHMgYXJlIGhhcmR3YXJlIGNlbnRyaWMgYW5kIHNvIHdhbnQg
dG8gdXNlIHRoZSBndAphcyBpdHMgdGFyZ2V0LgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29u
IDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBUdnJ0a28gVXJzdWxpbiA8dHZydGtvLnVy
c3VsaW5AaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xy
Yy5jIHwgMjgwICsrKysrKysrKysrKy0tLS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAxMzgg
aW5zZXJ0aW9ucygrKSwgMTQyIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2Vs
ZnRlc3RfbHJjLmMKaW5kZXggOWMxZjM0ZmI1ODgyLi4wNDM0ZDllOGZkYjggMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCisrKyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2xyYy5jCkBAIC01MSwyMCArNTEsMjAgQEAgc3RhdGljIHN0
cnVjdCBpOTE1X3ZtYSAqY3JlYXRlX3NjcmF0Y2goc3RydWN0IGludGVsX2d0ICpndCkKIAogc3Rh
dGljIGludCBsaXZlX3Nhbml0eWNoZWNrKHZvaWQgKmFyZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IGFyZzsKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwogCXN0cnVj
dCBpOTE1X2dlbV9lbmdpbmVzX2l0ZXIgaXQ7CiAJc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0
eDsKIAlzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2U7CiAJc3RydWN0IGlndF9zcGlubmVyIHNwaW47
CiAJaW50IGVyciA9IC1FTk9NRU07CiAKLQlpZiAoIUhBU19MT0dJQ0FMX1JJTkdfQ09OVEVYVFMo
aTkxNSkpCisJaWYgKCFIQVNfTE9HSUNBTF9SSU5HX0NPTlRFWFRTKGd0LT5pOTE1KSkKIAkJcmV0
dXJuIDA7CiAKLQlpZiAoaWd0X3NwaW5uZXJfaW5pdCgmc3BpbiwgJmk5MTUtPmd0KSkKKwlpZiAo
aWd0X3NwaW5uZXJfaW5pdCgmc3BpbiwgZ3QpKQogCQlyZXR1cm4gLUVOT01FTTsKIAotCWN0eCA9
IGtlcm5lbF9jb250ZXh0KGk5MTUpOworCWN0eCA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsK
IAlpZiAoIWN0eCkKIAkJZ290byBlcnJfc3BpbjsKIApAQCAtODEsMTMgKzgxLDEzIEBAIHN0YXRp
YyBpbnQgbGl2ZV9zYW5pdHljaGVjayh2b2lkICphcmcpCiAJCWlmICghaWd0X3dhaXRfZm9yX3Nw
aW5uZXIoJnNwaW4sIHJxKSkgewogCQkJR0VNX1RSQUNFKCJzcGlubmVyIGZhaWxlZCB0byBzdGFy
dFxuIik7CiAJCQlHRU1fVFJBQ0VfRFVNUCgpOwotCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZCgmaTkx
NS0+Z3QpOworCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CiAJCQllcnIgPSAtRUlPOwogCQkJ
Z290byBlcnJfY3R4OwogCQl9CiAKIAkJaWd0X3NwaW5uZXJfZW5kKCZzcGluKTsKLQkJaWYgKGln
dF9mbHVzaF90ZXN0KGk5MTUpKSB7CisJCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpIHsK
IAkJCWVyciA9IC1FSU87CiAJCQlnb3RvIGVycl9jdHg7CiAJCX0KQEAgLTQxNiw3ICs0MTYsNyBA
QCBzbGljZV9zZW1hcGhvcmVfcXVldWUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqb3V0ZXIsCiAK
IHN0YXRpYyBpbnQgbGl2ZV90aW1lc2xpY2VfcHJlZW1wdCh2b2lkICphcmcpCiB7Ci0Jc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGFy
ZzsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwogCXN0cnVjdCBpOTE1X3ZtYSAq
dm1hOwogCXZvaWQgKnZhZGRyOwpAQCAtNDMyLDExICs0MzIsMTEgQEAgc3RhdGljIGludCBsaXZl
X3RpbWVzbGljZV9wcmVlbXB0KHZvaWQgKmFyZykKIAkgKiByZWFkeSB0YXNrLgogCSAqLwogCi0J
b2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChpOTE1LCBQQUdFX1NJWkUpOwor
CW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoZ3QtPmk5MTUsIFBBR0VfU0la
RSk7CiAJaWYgKElTX0VSUihvYmopKQogCQlyZXR1cm4gUFRSX0VSUihvYmopOwogCi0Jdm1hID0g
aTkxNV92bWFfaW5zdGFuY2Uob2JqLCAmaTkxNS0+Z2d0dC52bSwgTlVMTCk7CisJdm1hID0gaTkx
NV92bWFfaW5zdGFuY2Uob2JqLCAmZ3QtPmdndHQtPnZtLCBOVUxMKTsKIAlpZiAoSVNfRVJSKHZt
YSkpIHsKIAkJZXJyID0gUFRSX0VSUih2bWEpOwogCQlnb3RvIGVycl9vYmo7CkBAIC00NTYsNyAr
NDU2LDcgQEAgc3RhdGljIGludCBsaXZlX3RpbWVzbGljZV9wcmVlbXB0KHZvaWQgKmFyZykKIAkJ
c3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCQllbnVtIGludGVsX2VuZ2luZV9pZCBp
ZDsKIAotCQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgeworCQlmb3JfZWFjaF9l
bmdpbmUoZW5naW5lLCBndC0+aTkxNSwgaWQpIHsKIAkJCWlmICghaW50ZWxfZW5naW5lX2hhc19w
cmVlbXB0aW9uKGVuZ2luZSkpCiAJCQkJY29udGludWU7CiAKQEAgLTQ2Niw3ICs0NjYsNyBAQCBz
dGF0aWMgaW50IGxpdmVfdGltZXNsaWNlX3ByZWVtcHQodm9pZCAqYXJnKQogCQkJaWYgKGVycikK
IAkJCQlnb3RvIGVycl9waW47CiAKLQkJCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkgeworCQkJ
aWYgKGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KSkgewogCQkJCWVyciA9IC1FSU87CiAJCQkJZ290
byBlcnJfcGluOwogCQkJfQpAQCAtNDg0LDcgKzQ4NCw3IEBAIHN0YXRpYyBpbnQgbGl2ZV90aW1l
c2xpY2VfcHJlZW1wdCh2b2lkICphcmcpCiAKIHN0YXRpYyBpbnQgbGl2ZV9idXN5d2FpdF9wcmVl
bXB0KHZvaWQgKmFyZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsK
KwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpj
dHhfaGksICpjdHhfbG87CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCXN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CkBAIC00OTgsMTkgKzQ5OCwxOSBAQCBzdGF0aWMg
aW50IGxpdmVfYnVzeXdhaXRfcHJlZW1wdCh2b2lkICphcmcpCiAJICogcHJlZW1wdCB0aGUgYnVz
eXdhaXRzIHVzZWQgdG8gc3luY2hyb25pc2UgYmV0d2VlbiByaW5ncy4KIAkgKi8KIAotCWN0eF9o
aSA9IGtlcm5lbF9jb250ZXh0KGk5MTUpOworCWN0eF9oaSA9IGtlcm5lbF9jb250ZXh0KGd0LT5p
OTE1KTsKIAlpZiAoIWN0eF9oaSkKIAkJcmV0dXJuIC1FTk9NRU07CiAJY3R4X2hpLT5zY2hlZC5w
cmlvcml0eSA9CiAJCUk5MTVfVVNFUl9QUklPUklUWShJOTE1X0NPTlRFWFRfTUFYX1VTRVJfUFJJ
T1JJVFkpOwogCi0JY3R4X2xvID0ga2VybmVsX2NvbnRleHQoaTkxNSk7CisJY3R4X2xvID0ga2Vy
bmVsX2NvbnRleHQoZ3QtPmk5MTUpOwogCWlmICghY3R4X2xvKQogCQlnb3RvIGVycl9jdHhfaGk7
CiAJY3R4X2xvLT5zY2hlZC5wcmlvcml0eSA9CiAJCUk5MTVfVVNFUl9QUklPUklUWShJOTE1X0NP
TlRFWFRfTUlOX1VTRVJfUFJJT1JJVFkpOwogCi0Jb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0
ZV9pbnRlcm5hbChpOTE1LCBQQUdFX1NJWkUpOworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVh
dGVfaW50ZXJuYWwoZ3QtPmk5MTUsIFBBR0VfU0laRSk7CiAJaWYgKElTX0VSUihvYmopKSB7CiAJ
CWVyciA9IFBUUl9FUlIob2JqKTsKIAkJZ290byBlcnJfY3R4X2xvOwpAQCAtNTIyLDcgKzUyMiw3
IEBAIHN0YXRpYyBpbnQgbGl2ZV9idXN5d2FpdF9wcmVlbXB0KHZvaWQgKmFyZykKIAkJZ290byBl
cnJfb2JqOwogCX0KIAotCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgJmk5MTUtPmdndHQu
dm0sIE5VTEwpOworCXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgJmd0LT5nZ3R0LT52bSwg
TlVMTCk7CiAJaWYgKElTX0VSUih2bWEpKSB7CiAJCWVyciA9IFBUUl9FUlIodm1hKTsKIAkJZ290
byBlcnJfbWFwOwpAQCAtNTMyLDcgKzUzMiw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9idXN5d2FpdF9w
cmVlbXB0KHZvaWQgKmFyZykKIAlpZiAoZXJyKQogCQlnb3RvIGVycl9tYXA7CiAKLQlmb3JfZWFj
aF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgeworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0
LT5pOTE1LCBpZCkgewogCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpsbywgKmhpOwogCQlzdHJ1Y3Qg
aWd0X2xpdmVfdGVzdCB0OwogCQl1MzIgKmNzOwpAQCAtNTQzLDcgKzU0Myw3IEBAIHN0YXRpYyBp
bnQgbGl2ZV9idXN5d2FpdF9wcmVlbXB0KHZvaWQgKmFyZykKIAkJaWYgKCFpbnRlbF9lbmdpbmVf
Y2FuX3N0b3JlX2R3b3JkKGVuZ2luZSkpCiAJCQljb250aW51ZTsKIAotCQlpZiAoaWd0X2xpdmVf
dGVzdF9iZWdpbigmdCwgaTkxNSwgX19mdW5jX18sIGVuZ2luZS0+bmFtZSkpIHsKKwkJaWYgKGln
dF9saXZlX3Rlc3RfYmVnaW4oJnQsIGd0LT5pOTE1LCBfX2Z1bmNfXywgZW5naW5lLT5uYW1lKSkg
ewogCQkJZXJyID0gLUVJTzsKIAkJCWdvdG8gZXJyX3ZtYTsKIAkJfQpAQCAtNjIzLDcgKzYyMyw3
IEBAIHN0YXRpYyBpbnQgbGl2ZV9idXN5d2FpdF9wcmVlbXB0KHZvaWQgKmFyZykKIAkJaTkxNV9y
ZXF1ZXN0X2FkZChoaSk7CiAKIAkJaWYgKGk5MTVfcmVxdWVzdF93YWl0KGxvLCAwLCBIWiAvIDUp
IDwgMCkgewotCQkJc3RydWN0IGRybV9wcmludGVyIHAgPSBkcm1faW5mb19wcmludGVyKGk5MTUt
PmRybS5kZXYpOworCQkJc3RydWN0IGRybV9wcmludGVyIHAgPSBkcm1faW5mb19wcmludGVyKGd0
LT5pOTE1LT5kcm0uZGV2KTsKIAogCQkJcHJfZXJyKCIlczogRmFpbGVkIHRvIHByZWVtcHQgc2Vt
YXBob3JlIGJ1c3l3YWl0IVxuIiwKIAkJCSAgICAgICBlbmdpbmUtPm5hbWUpOwpAQCAtNjMxLDcg
KzYzMSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9idXN5d2FpdF9wcmVlbXB0KHZvaWQgKmFyZykKIAkJ
CWludGVsX2VuZ2luZV9kdW1wKGVuZ2luZSwgJnAsICIlc1xuIiwgZW5naW5lLT5uYW1lKTsKIAkJ
CUdFTV9UUkFDRV9EVU1QKCk7CiAKLQkJCWludGVsX2d0X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsK
KwkJCWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOwogCQkJZXJyID0gLUVJTzsKIAkJCWdvdG8gZXJy
X3ZtYTsKIAkJfQpAQCAtNjc3LDQ1ICs2NzcsNDUgQEAgc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdChz
dHJ1Y3QgaWd0X3NwaW5uZXIgKnNwaW4sCiAKIHN0YXRpYyBpbnQgbGl2ZV9wcmVlbXB0KHZvaWQg
KmFyZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKKwlzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0ID0gYXJnOwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHhfaGksICpj
dHhfbG87CiAJc3RydWN0IGlndF9zcGlubmVyIHNwaW5faGksIHNwaW5fbG87CiAJc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwogCWludCBl
cnIgPSAtRU5PTUVNOwogCi0JaWYgKCFIQVNfTE9HSUNBTF9SSU5HX1BSRUVNUFRJT04oaTkxNSkp
CisJaWYgKCFIQVNfTE9HSUNBTF9SSU5HX1BSRUVNUFRJT04oZ3QtPmk5MTUpKQogCQlyZXR1cm4g
MDsKIAotCWlmICghKGk5MTUtPmNhcHMuc2NoZWR1bGVyICYgSTkxNV9TQ0hFRFVMRVJfQ0FQX1BS
RUVNUFRJT04pKQorCWlmICghKGd0LT5pOTE1LT5jYXBzLnNjaGVkdWxlciAmIEk5MTVfU0NIRURV
TEVSX0NBUF9QUkVFTVBUSU9OKSkKIAkJcHJfZXJyKCJMb2dpY2FsIHByZWVtcHRpb24gc3VwcG9y
dGVkLCBidXQgbm90IGV4cG9zZWRcbiIpOwogCi0JaWYgKGlndF9zcGlubmVyX2luaXQoJnNwaW5f
aGksICZpOTE1LT5ndCkpCisJaWYgKGlndF9zcGlubmVyX2luaXQoJnNwaW5faGksIGd0KSkKIAkJ
cmV0dXJuIC1FTk9NRU07CiAKLQlpZiAoaWd0X3NwaW5uZXJfaW5pdCgmc3Bpbl9sbywgJmk5MTUt
Pmd0KSkKKwlpZiAoaWd0X3NwaW5uZXJfaW5pdCgmc3Bpbl9sbywgZ3QpKQogCQlnb3RvIGVycl9z
cGluX2hpOwogCi0JY3R4X2hpID0ga2VybmVsX2NvbnRleHQoaTkxNSk7CisJY3R4X2hpID0ga2Vy
bmVsX2NvbnRleHQoZ3QtPmk5MTUpOwogCWlmICghY3R4X2hpKQogCQlnb3RvIGVycl9zcGluX2xv
OwogCWN0eF9oaS0+c2NoZWQucHJpb3JpdHkgPQogCQlJOTE1X1VTRVJfUFJJT1JJVFkoSTkxNV9D
T05URVhUX01BWF9VU0VSX1BSSU9SSVRZKTsKIAotCWN0eF9sbyA9IGtlcm5lbF9jb250ZXh0KGk5
MTUpOworCWN0eF9sbyA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKIAlpZiAoIWN0eF9sbykK
IAkJZ290byBlcnJfY3R4X2hpOwogCWN0eF9sby0+c2NoZWQucHJpb3JpdHkgPQogCQlJOTE1X1VT
RVJfUFJJT1JJVFkoSTkxNV9DT05URVhUX01JTl9VU0VSX1BSSU9SSVRZKTsKIAotCWZvcl9lYWNo
X2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7CisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3Qt
Pmk5MTUsIGlkKSB7CiAJCXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7CiAJCXN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJxOwogCiAJCWlmICghaW50ZWxfZW5naW5lX2hhc19wcmVlbXB0aW9uKGVuZ2luZSkp
CiAJCQljb250aW51ZTsKIAotCQlpZiAoaWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgaTkxNSwgX19m
dW5jX18sIGVuZ2luZS0+bmFtZSkpIHsKKwkJaWYgKGlndF9saXZlX3Rlc3RfYmVnaW4oJnQsIGd0
LT5pOTE1LCBfX2Z1bmNfXywgZW5naW5lLT5uYW1lKSkgewogCQkJZXJyID0gLUVJTzsKIAkJCWdv
dG8gZXJyX2N0eF9sbzsKIAkJfQpAQCAtNzMxLDcgKzczMSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9w
cmVlbXB0KHZvaWQgKmFyZykKIAkJaWYgKCFpZ3Rfd2FpdF9mb3Jfc3Bpbm5lcigmc3Bpbl9sbywg
cnEpKSB7CiAJCQlHRU1fVFJBQ0UoImxvIHNwaW5uZXIgZmFpbGVkIHRvIHN0YXJ0XG4iKTsKIAkJ
CUdFTV9UUkFDRV9EVU1QKCk7Ci0JCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZpOTE1LT5ndCk7CisJ
CQlpbnRlbF9ndF9zZXRfd2VkZ2VkKGd0KTsKIAkJCWVyciA9IC1FSU87CiAJCQlnb3RvIGVycl9j
dHhfbG87CiAJCX0KQEAgLTc0OCw3ICs3NDgsNyBAQCBzdGF0aWMgaW50IGxpdmVfcHJlZW1wdCh2
b2lkICphcmcpCiAJCWlmICghaWd0X3dhaXRfZm9yX3NwaW5uZXIoJnNwaW5faGksIHJxKSkgewog
CQkJR0VNX1RSQUNFKCJoaSBzcGlubmVyIGZhaWxlZCB0byBzdGFydFxuIik7CiAJCQlHRU1fVFJB
Q0VfRFVNUCgpOwotCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZCgmaTkxNS0+Z3QpOworCQkJaW50ZWxf
Z3Rfc2V0X3dlZGdlZChndCk7CiAJCQllcnIgPSAtRUlPOwogCQkJZ290byBlcnJfY3R4X2xvOwog
CQl9CkBAIC03NzYsNyArNzc2LDcgQEAgc3RhdGljIGludCBsaXZlX3ByZWVtcHQodm9pZCAqYXJn
KQogCiBzdGF0aWMgaW50IGxpdmVfbGF0ZV9wcmVlbXB0KHZvaWQgKmFyZykKIHsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJn
OwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHhfaGksICpjdHhfbG87CiAJc3RydWN0IGln
dF9zcGlubmVyIHNwaW5faGksIHNwaW5fbG87CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lOwpAQCAtNzg0LDM0ICs3ODQsMzQgQEAgc3RhdGljIGludCBsaXZlX2xhdGVfcHJlZW1wdCh2
b2lkICphcmcpCiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAJaW50IGVyciA9IC1FTk9NRU07
CiAKLQlpZiAoIUhBU19MT0dJQ0FMX1JJTkdfUFJFRU1QVElPTihpOTE1KSkKKwlpZiAoIUhBU19M
T0dJQ0FMX1JJTkdfUFJFRU1QVElPTihndC0+aTkxNSkpCiAJCXJldHVybiAwOwogCi0JaWYgKGln
dF9zcGlubmVyX2luaXQoJnNwaW5faGksICZpOTE1LT5ndCkpCisJaWYgKGlndF9zcGlubmVyX2lu
aXQoJnNwaW5faGksIGd0KSkKIAkJcmV0dXJuIC1FTk9NRU07CiAKLQlpZiAoaWd0X3NwaW5uZXJf
aW5pdCgmc3Bpbl9sbywgJmk5MTUtPmd0KSkKKwlpZiAoaWd0X3NwaW5uZXJfaW5pdCgmc3Bpbl9s
bywgZ3QpKQogCQlnb3RvIGVycl9zcGluX2hpOwogCi0JY3R4X2hpID0ga2VybmVsX2NvbnRleHQo
aTkxNSk7CisJY3R4X2hpID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOwogCWlmICghY3R4X2hp
KQogCQlnb3RvIGVycl9zcGluX2xvOwogCi0JY3R4X2xvID0ga2VybmVsX2NvbnRleHQoaTkxNSk7
CisJY3R4X2xvID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOwogCWlmICghY3R4X2xvKQogCQln
b3RvIGVycl9jdHhfaGk7CiAKIAkvKiBNYWtlIHN1cmUgY3R4X2xvIHN0YXlzIGJlZm9yZSBjdHhf
aGkgdW50aWwgd2UgdHJpZ2dlciBwcmVlbXB0aW9uLiAqLwogCWN0eF9sby0+c2NoZWQucHJpb3Jp
dHkgPSBJOTE1X1VTRVJfUFJJT1JJVFkoMSk7CiAKLQlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBp
OTE1LCBpZCkgeworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGd0LT5pOTE1LCBpZCkgewogCQlz
dHJ1Y3QgaWd0X2xpdmVfdGVzdCB0OwogCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKIAogCQlp
ZiAoIWludGVsX2VuZ2luZV9oYXNfcHJlZW1wdGlvbihlbmdpbmUpKQogCQkJY29udGludWU7CiAK
LQkJaWYgKGlndF9saXZlX3Rlc3RfYmVnaW4oJnQsIGk5MTUsIF9fZnVuY19fLCBlbmdpbmUtPm5h
bWUpKSB7CisJCWlmIChpZ3RfbGl2ZV90ZXN0X2JlZ2luKCZ0LCBndC0+aTkxNSwgX19mdW5jX18s
IGVuZ2luZS0+bmFtZSkpIHsKIAkJCWVyciA9IC1FSU87CiAJCQlnb3RvIGVycl9jdHhfbG87CiAJ
CX0KQEAgLTg3NSw3ICs4NzUsNyBAQCBzdGF0aWMgaW50IGxpdmVfbGF0ZV9wcmVlbXB0KHZvaWQg
KmFyZykKIGVycl93ZWRnZWQ6CiAJaWd0X3NwaW5uZXJfZW5kKCZzcGluX2hpKTsKIAlpZ3Rfc3Bp
bm5lcl9lbmQoJnNwaW5fbG8pOwotCWludGVsX2d0X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKKwlp
bnRlbF9ndF9zZXRfd2VkZ2VkKGd0KTsKIAllcnIgPSAtRUlPOwogCWdvdG8gZXJyX2N0eF9sbzsK
IH0KQEAgLTg4NSwxNCArODg1LDEzIEBAIHN0cnVjdCBwcmVlbXB0X2NsaWVudCB7CiAJc3RydWN0
IGk5MTVfZ2VtX2NvbnRleHQgKmN0eDsKIH07CiAKLXN0YXRpYyBpbnQgcHJlZW1wdF9jbGllbnRf
aW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKLQkJCSAgICAgICBzdHJ1Y3QgcHJl
ZW1wdF9jbGllbnQgKmMpCitzdGF0aWMgaW50IHByZWVtcHRfY2xpZW50X2luaXQoc3RydWN0IGlu
dGVsX2d0ICpndCwgc3RydWN0IHByZWVtcHRfY2xpZW50ICpjKQogewotCWMtPmN0eCA9IGtlcm5l
bF9jb250ZXh0KGk5MTUpOworCWMtPmN0eCA9IGtlcm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKIAlp
ZiAoIWMtPmN0eCkKIAkJcmV0dXJuIC1FTk9NRU07CiAKLQlpZiAoaWd0X3NwaW5uZXJfaW5pdCgm
Yy0+c3BpbiwgJmk5MTUtPmd0KSkKKwlpZiAoaWd0X3NwaW5uZXJfaW5pdCgmYy0+c3BpbiwgZ3Qp
KQogCQlnb3RvIGVycl9jdHg7CiAKIAlyZXR1cm4gMDsKQEAgLTkxMCw3ICs5MDksNyBAQCBzdGF0
aWMgdm9pZCBwcmVlbXB0X2NsaWVudF9maW5pKHN0cnVjdCBwcmVlbXB0X2NsaWVudCAqYykKIAog
c3RhdGljIGludCBsaXZlX25vcHJlZW1wdCh2b2lkICphcmcpCiB7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSBhcmc7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKIAlzdHJ1
Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJc3RydWN0IHByZWVtcHRfY2xpZW50IGEsIGI7
CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CkBAIC05MjEsMTYgKzkyMCwxNiBAQCBzdGF0aWMg
aW50IGxpdmVfbm9wcmVlbXB0KHZvaWQgKmFyZykKIAkgKiB0aGF0IG1heSBiZSBiZWluZyBvYnNl
cnZlZCBhbmQgbm90IHdhbnQgdG8gYmUgaW50ZXJydXB0ZWQuCiAJICovCiAKLQlpZiAoIUhBU19M
T0dJQ0FMX1JJTkdfUFJFRU1QVElPTihpOTE1KSkKKwlpZiAoIUhBU19MT0dJQ0FMX1JJTkdfUFJF
RU1QVElPTihndC0+aTkxNSkpCiAJCXJldHVybiAwOwogCi0JaWYgKHByZWVtcHRfY2xpZW50X2lu
aXQoaTkxNSwgJmEpKQorCWlmIChwcmVlbXB0X2NsaWVudF9pbml0KGd0LCAmYSkpCiAJCXJldHVy
biAtRU5PTUVNOwotCWlmIChwcmVlbXB0X2NsaWVudF9pbml0KGk5MTUsICZiKSkKKwlpZiAocHJl
ZW1wdF9jbGllbnRfaW5pdChndCwgJmIpKQogCQlnb3RvIGVycl9jbGllbnRfYTsKIAliLmN0eC0+
c2NoZWQucHJpb3JpdHkgPSBJOTE1X1VTRVJfUFJJT1JJVFkoSTkxNV9QUklPUklUWV9NQVgpOwog
Ci0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKKwlmb3JfZWFjaF9lbmdpbmUo
ZW5naW5lLCBndC0+aTkxNSwgaWQpIHsKIAkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnFfYSwgKnJx
X2I7CiAKIAkJaWYgKCFpbnRlbF9lbmdpbmVfaGFzX3ByZWVtcHRpb24oZW5naW5lKSkKQEAgLTk5
MCw3ICs5ODksNyBAQCBzdGF0aWMgaW50IGxpdmVfbm9wcmVlbXB0KHZvaWQgKmFyZykKIAkJCWdv
dG8gZXJyX3dlZGdlZDsKIAkJfQogCi0JCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKKwkJaWYg
KGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KSkKIAkJCWdvdG8gZXJyX3dlZGdlZDsKIAl9CiAKQEAg
LTEwMDQsMTQgKzEwMDMsMTQgQEAgc3RhdGljIGludCBsaXZlX25vcHJlZW1wdCh2b2lkICphcmcp
CiBlcnJfd2VkZ2VkOgogCWlndF9zcGlubmVyX2VuZCgmYi5zcGluKTsKIAlpZ3Rfc3Bpbm5lcl9l
bmQoJmEuc3Bpbik7Ci0JaW50ZWxfZ3Rfc2V0X3dlZGdlZCgmaTkxNS0+Z3QpOworCWludGVsX2d0
X3NldF93ZWRnZWQoZ3QpOwogCWVyciA9IC1FSU87CiAJZ290byBlcnJfY2xpZW50X2I7CiB9CiAK
IHN0YXRpYyBpbnQgbGl2ZV9zdXBwcmVzc19zZWxmX3ByZWVtcHQodm9pZCAqYXJnKQogewotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnOworCXN0cnVjdCBpbnRlbF9ndCAqZ3Qg
PSBhcmc7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCXN0cnVjdCBpOTE1X3Nj
aGVkX2F0dHIgYXR0ciA9IHsKIAkJLnByaW9yaXR5ID0gSTkxNV9VU0VSX1BSSU9SSVRZKEk5MTVf
UFJJT1JJVFlfTUFYKQpAQCAtMTAyNywyOCArMTAyNiwyOCBAQCBzdGF0aWMgaW50IGxpdmVfc3Vw
cHJlc3Nfc2VsZl9wcmVlbXB0KHZvaWQgKmFyZykKIAkgKiBjb21wbGV0aW9uIGV2ZW50LgogCSAq
LwogCi0JaWYgKCFIQVNfTE9HSUNBTF9SSU5HX1BSRUVNUFRJT04oaTkxNSkpCisJaWYgKCFIQVNf
TE9HSUNBTF9SSU5HX1BSRUVNUFRJT04oZ3QtPmk5MTUpKQogCQlyZXR1cm4gMDsKIAotCWlmIChV
U0VTX0dVQ19TVUJNSVNTSU9OKGk5MTUpKQorCWlmIChVU0VTX0dVQ19TVUJNSVNTSU9OKGd0LT5p
OTE1KSkKIAkJcmV0dXJuIDA7IC8qIHByZXN1bWUgYmxhY2sgYmxveCAqLwogCi0JaWYgKGludGVs
X3ZncHVfYWN0aXZlKGk5MTUpKQorCWlmIChpbnRlbF92Z3B1X2FjdGl2ZShndC0+aTkxNSkpCiAJ
CXJldHVybiAwOyAvKiBHVlQgZm9yY2VzIHNpbmdsZSBwb3J0ICYgcmVxdWVzdCBzdWJtaXNzaW9u
ICovCiAKLQlpZiAocHJlZW1wdF9jbGllbnRfaW5pdChpOTE1LCAmYSkpCisJaWYgKHByZWVtcHRf
Y2xpZW50X2luaXQoZ3QsICZhKSkKIAkJcmV0dXJuIC1FTk9NRU07Ci0JaWYgKHByZWVtcHRfY2xp
ZW50X2luaXQoaTkxNSwgJmIpKQorCWlmIChwcmVlbXB0X2NsaWVudF9pbml0KGd0LCAmYikpCiAJ
CWdvdG8gZXJyX2NsaWVudF9hOwogCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQp
IHsKKwlmb3JfZWFjaF9lbmdpbmUoZW5naW5lLCBndC0+aTkxNSwgaWQpIHsKIAkJc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnFfYSwgKnJxX2I7CiAJCWludCBkZXB0aDsKIAogCQlpZiAoIWludGVsX2Vu
Z2luZV9oYXNfcHJlZW1wdGlvbihlbmdpbmUpKQogCQkJY29udGludWU7CiAKLQkJaWYgKGlndF9m
bHVzaF90ZXN0KGk5MTUpKQorCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpKQogCQkJZ290
byBlcnJfd2VkZ2VkOwogCiAJCWludGVsX2VuZ2luZV9wbV9nZXQoZW5naW5lKTsKQEAgLTExMDks
NyArMTEwOCw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9zdXBwcmVzc19zZWxmX3ByZWVtcHQodm9pZCAq
YXJnKQogCQl9CiAKIAkJaW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOwotCQlpZiAoaWd0X2Zs
dXNoX3Rlc3QoaTkxNSkpCisJCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpCiAJCQlnb3Rv
IGVycl93ZWRnZWQ7CiAJfQogCkBAIC0xMTIzLDcgKzExMjIsNyBAQCBzdGF0aWMgaW50IGxpdmVf
c3VwcHJlc3Nfc2VsZl9wcmVlbXB0KHZvaWQgKmFyZykKIGVycl93ZWRnZWQ6CiAJaWd0X3NwaW5u
ZXJfZW5kKCZiLnNwaW4pOwogCWlndF9zcGlubmVyX2VuZCgmYS5zcGluKTsKLQlpbnRlbF9ndF9z
ZXRfd2VkZ2VkKCZpOTE1LT5ndCk7CisJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CiAJZXJyID0g
LUVJTzsKIAlnb3RvIGVycl9jbGllbnRfYjsKIH0KQEAgLTExODMsNyArMTE4Miw3IEBAIHN0YXRp
YyB2b2lkIGR1bW15X3JlcXVlc3RfZnJlZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpkdW1teSkKIAog
c3RhdGljIGludCBsaXZlX3N1cHByZXNzX3dhaXRfcHJlZW1wdCh2b2lkICphcmcpCiB7Ci0Jc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CisJc3RydWN0IGludGVsX2d0ICpndCA9
IGFyZzsKIAlzdHJ1Y3QgcHJlZW1wdF9jbGllbnQgY2xpZW50WzRdOwogCXN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZTsKIAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKQEAgLTExOTYsMTkg
KzExOTUsMTkgQEAgc3RhdGljIGludCBsaXZlX3N1cHByZXNzX3dhaXRfcHJlZW1wdCh2b2lkICph
cmcpCiAJICogbm90IG5lZWRsZXNzbHkgZ2VuZXJhdGUgcHJlZW1wdC10by1pZGxlIGN5Y2xlcy4K
IAkgKi8KIAotCWlmICghSEFTX0xPR0lDQUxfUklOR19QUkVFTVBUSU9OKGk5MTUpKQorCWlmICgh
SEFTX0xPR0lDQUxfUklOR19QUkVFTVBUSU9OKGd0LT5pOTE1KSkKIAkJcmV0dXJuIDA7CiAKLQlp
ZiAocHJlZW1wdF9jbGllbnRfaW5pdChpOTE1LCAmY2xpZW50WzBdKSkgLyogRUxTUFswXSAqLwor
CWlmIChwcmVlbXB0X2NsaWVudF9pbml0KGd0LCAmY2xpZW50WzBdKSkgLyogRUxTUFswXSAqLwog
CQlyZXR1cm4gLUVOT01FTTsKLQlpZiAocHJlZW1wdF9jbGllbnRfaW5pdChpOTE1LCAmY2xpZW50
WzFdKSkgLyogRUxTUFsxXSAqLworCWlmIChwcmVlbXB0X2NsaWVudF9pbml0KGd0LCAmY2xpZW50
WzFdKSkgLyogRUxTUFsxXSAqLwogCQlnb3RvIGVycl9jbGllbnRfMDsKLQlpZiAocHJlZW1wdF9j
bGllbnRfaW5pdChpOTE1LCAmY2xpZW50WzJdKSkgLyogaGVhZCBvZiBxdWV1ZSAqLworCWlmIChw
cmVlbXB0X2NsaWVudF9pbml0KGd0LCAmY2xpZW50WzJdKSkgLyogaGVhZCBvZiBxdWV1ZSAqLwog
CQlnb3RvIGVycl9jbGllbnRfMTsKLQlpZiAocHJlZW1wdF9jbGllbnRfaW5pdChpOTE1LCAmY2xp
ZW50WzNdKSkgLyogYnlzdGFuZGVyICovCisJaWYgKHByZWVtcHRfY2xpZW50X2luaXQoZ3QsICZj
bGllbnRbM10pKSAvKiBieXN0YW5kZXIgKi8KIAkJZ290byBlcnJfY2xpZW50XzI7CiAKLQlmb3Jf
ZWFjaF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgeworCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUs
IGd0LT5pOTE1LCBpZCkgewogCQlpbnQgZGVwdGg7CiAKIAkJaWYgKCFpbnRlbF9lbmdpbmVfaGFz
X3ByZWVtcHRpb24oZW5naW5lKSkKQEAgLTEyNjMsNyArMTI2Miw3IEBAIHN0YXRpYyBpbnQgbGl2
ZV9zdXBwcmVzc193YWl0X3ByZWVtcHQodm9pZCAqYXJnKQogCQkJZm9yIChpID0gMDsgaSA8IEFS
UkFZX1NJWkUoY2xpZW50KTsgaSsrKQogCQkJCWlndF9zcGlubmVyX2VuZCgmY2xpZW50W2ldLnNw
aW4pOwogCi0JCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCisJCQlpZiAoaWd0X2ZsdXNoX3Rl
c3QoZ3QtPmk5MTUpKQogCQkJCWdvdG8gZXJyX3dlZGdlZDsKIAogCQkJaWYgKGVuZ2luZS0+ZXhl
Y2xpc3RzLnByZWVtcHRfaGFuZy5jb3VudCkgewpAQCAtMTI5MSwxNCArMTI5MCwxNCBAQCBzdGF0
aWMgaW50IGxpdmVfc3VwcHJlc3Nfd2FpdF9wcmVlbXB0KHZvaWQgKmFyZykKIGVycl93ZWRnZWQ6
CiAJZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUoY2xpZW50KTsgaSsrKQogCQlpZ3Rfc3Bpbm5l
cl9lbmQoJmNsaWVudFtpXS5zcGluKTsKLQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZpOTE1LT5ndCk7
CisJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CiAJZXJyID0gLUVJTzsKIAlnb3RvIGVycl9jbGll
bnRfMzsKIH0KIAogc3RhdGljIGludCBsaXZlX2NoYWluX3ByZWVtcHQodm9pZCAqYXJnKQogewot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJnOworCXN0cnVjdCBpbnRlbF9ndCAq
Z3QgPSBhcmc7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCXN0cnVjdCBwcmVl
bXB0X2NsaWVudCBoaSwgbG87CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CkBAIC0xMzEwLDE2
ICsxMzA5LDE2IEBAIHN0YXRpYyBpbnQgbGl2ZV9jaGFpbl9wcmVlbXB0KHZvaWQgKmFyZykKIAkg
KiB0aGUgcHJldmlvdXNseSBzdWJtaXR0ZWQgc3Bpbm5lciBpbiBCLgogCSAqLwogCi0JaWYgKCFI
QVNfTE9HSUNBTF9SSU5HX1BSRUVNUFRJT04oaTkxNSkpCisJaWYgKCFIQVNfTE9HSUNBTF9SSU5H
X1BSRUVNUFRJT04oZ3QtPmk5MTUpKQogCQlyZXR1cm4gMDsKIAotCWlmIChwcmVlbXB0X2NsaWVu
dF9pbml0KGk5MTUsICZoaSkpCisJaWYgKHByZWVtcHRfY2xpZW50X2luaXQoZ3QsICZoaSkpCiAJ
CXJldHVybiAtRU5PTUVNOwogCi0JaWYgKHByZWVtcHRfY2xpZW50X2luaXQoaTkxNSwgJmxvKSkK
KwlpZiAocHJlZW1wdF9jbGllbnRfaW5pdChndCwgJmxvKSkKIAkJZ290byBlcnJfY2xpZW50X2hp
OwogCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKKwlmb3JfZWFjaF9lbmdp
bmUoZW5naW5lLCBndC0+aTkxNSwgaWQpIHsKIAkJc3RydWN0IGk5MTVfc2NoZWRfYXR0ciBhdHRy
ID0gewogCQkJLnByaW9yaXR5ID0gSTkxNV9VU0VSX1BSSU9SSVRZKEk5MTVfUFJJT1JJVFlfTUFY
KSwKIAkJfTsKQEAgLTEzNTAsNyArMTM0OSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9jaGFpbl9wcmVl
bXB0KHZvaWQgKmFyZykKIAkJCWdvdG8gZXJyX3dlZGdlZDsKIAkJfQogCi0JCWlmIChpZ3RfbGl2
ZV90ZXN0X2JlZ2luKCZ0LCBpOTE1LCBfX2Z1bmNfXywgZW5naW5lLT5uYW1lKSkgeworCQlpZiAo
aWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgZ3QtPmk5MTUsIF9fZnVuY19fLCBlbmdpbmUtPm5hbWUp
KSB7CiAJCQllcnIgPSAtRUlPOwogCQkJZ290byBlcnJfd2VkZ2VkOwogCQl9CkBAIC0xMzg4LDcg
KzEzODcsNyBAQCBzdGF0aWMgaW50IGxpdmVfY2hhaW5fcHJlZW1wdCh2b2lkICphcmcpCiAJCQlp
Z3Rfc3Bpbm5lcl9lbmQoJmhpLnNwaW4pOwogCQkJaWYgKGk5MTVfcmVxdWVzdF93YWl0KHJxLCAw
LCBIWiAvIDUpIDwgMCkgewogCQkJCXN0cnVjdCBkcm1fcHJpbnRlciBwID0KLQkJCQkJZHJtX2lu
Zm9fcHJpbnRlcihpOTE1LT5kcm0uZGV2KTsKKwkJCQkJZHJtX2luZm9fcHJpbnRlcihndC0+aTkx
NS0+ZHJtLmRldik7CiAKIAkJCQlwcl9lcnIoIkZhaWxlZCB0byBwcmVlbXB0IG92ZXIgY2hhaW4g
b2YgJWRcbiIsCiAJCQkJICAgICAgIGNvdW50KTsKQEAgLTE0MDQsNyArMTQwMyw3IEBAIHN0YXRp
YyBpbnQgbGl2ZV9jaGFpbl9wcmVlbXB0KHZvaWQgKmFyZykKIAkJCWk5MTVfcmVxdWVzdF9hZGQo
cnEpOwogCQkJaWYgKGk5MTVfcmVxdWVzdF93YWl0KHJxLCAwLCBIWiAvIDUpIDwgMCkgewogCQkJ
CXN0cnVjdCBkcm1fcHJpbnRlciBwID0KLQkJCQkJZHJtX2luZm9fcHJpbnRlcihpOTE1LT5kcm0u
ZGV2KTsKKwkJCQkJZHJtX2luZm9fcHJpbnRlcihndC0+aTkxNS0+ZHJtLmRldik7CiAKIAkJCQlw
cl9lcnIoIkZhaWxlZCB0byBmbHVzaCBsb3cgcHJpb3JpdHkgY2hhaW4gb2YgJWQgcmVxdWVzdHNc
biIsCiAJCQkJICAgICAgIGNvdW50KTsKQEAgLTE0MzAsNDUgKzE0MjksNDUgQEAgc3RhdGljIGlu
dCBsaXZlX2NoYWluX3ByZWVtcHQodm9pZCAqYXJnKQogZXJyX3dlZGdlZDoKIAlpZ3Rfc3Bpbm5l
cl9lbmQoJmhpLnNwaW4pOwogCWlndF9zcGlubmVyX2VuZCgmbG8uc3Bpbik7Ci0JaW50ZWxfZ3Rf
c2V0X3dlZGdlZCgmaTkxNS0+Z3QpOworCWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOwogCWVyciA9
IC1FSU87CiAJZ290byBlcnJfY2xpZW50X2xvOwogfQogCiBzdGF0aWMgaW50IGxpdmVfcHJlZW1w
dF9oYW5nKHZvaWQgKmFyZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFy
ZzsKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwogCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0
ICpjdHhfaGksICpjdHhfbG87CiAJc3RydWN0IGlndF9zcGlubmVyIHNwaW5faGksIHNwaW5fbG87
CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCWVudW0gaW50ZWxfZW5naW5lX2lk
IGlkOwogCWludCBlcnIgPSAtRU5PTUVNOwogCi0JaWYgKCFIQVNfTE9HSUNBTF9SSU5HX1BSRUVN
UFRJT04oaTkxNSkpCisJaWYgKCFIQVNfTE9HSUNBTF9SSU5HX1BSRUVNUFRJT04oZ3QtPmk5MTUp
KQogCQlyZXR1cm4gMDsKIAotCWlmICghaW50ZWxfaGFzX3Jlc2V0X2VuZ2luZSgmaTkxNS0+Z3Qp
KQorCWlmICghaW50ZWxfaGFzX3Jlc2V0X2VuZ2luZShndCkpCiAJCXJldHVybiAwOwogCi0JaWYg
KGlndF9zcGlubmVyX2luaXQoJnNwaW5faGksICZpOTE1LT5ndCkpCisJaWYgKGlndF9zcGlubmVy
X2luaXQoJnNwaW5faGksIGd0KSkKIAkJcmV0dXJuIC1FTk9NRU07CiAKLQlpZiAoaWd0X3NwaW5u
ZXJfaW5pdCgmc3Bpbl9sbywgJmk5MTUtPmd0KSkKKwlpZiAoaWd0X3NwaW5uZXJfaW5pdCgmc3Bp
bl9sbywgZ3QpKQogCQlnb3RvIGVycl9zcGluX2hpOwogCi0JY3R4X2hpID0ga2VybmVsX2NvbnRl
eHQoaTkxNSk7CisJY3R4X2hpID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUpOwogCWlmICghY3R4
X2hpKQogCQlnb3RvIGVycl9zcGluX2xvOwogCWN0eF9oaS0+c2NoZWQucHJpb3JpdHkgPQogCQlJ
OTE1X1VTRVJfUFJJT1JJVFkoSTkxNV9DT05URVhUX01BWF9VU0VSX1BSSU9SSVRZKTsKIAotCWN0
eF9sbyA9IGtlcm5lbF9jb250ZXh0KGk5MTUpOworCWN0eF9sbyA9IGtlcm5lbF9jb250ZXh0KGd0
LT5pOTE1KTsKIAlpZiAoIWN0eF9sbykKIAkJZ290byBlcnJfY3R4X2hpOwogCWN0eF9sby0+c2No
ZWQucHJpb3JpdHkgPQogCQlJOTE1X1VTRVJfUFJJT1JJVFkoSTkxNV9DT05URVhUX01JTl9VU0VS
X1BSSU9SSVRZKTsKIAotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7CisJZm9y
X2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5MTUsIGlkKSB7CiAJCXN0cnVjdCBpOTE1X3JlcXVl
c3QgKnJxOwogCiAJCWlmICghaW50ZWxfZW5naW5lX2hhc19wcmVlbXB0aW9uKGVuZ2luZSkpCkBA
IC0xNDg1LDcgKzE0ODQsNyBAQCBzdGF0aWMgaW50IGxpdmVfcHJlZW1wdF9oYW5nKHZvaWQgKmFy
ZykKIAkJaWYgKCFpZ3Rfd2FpdF9mb3Jfc3Bpbm5lcigmc3Bpbl9sbywgcnEpKSB7CiAJCQlHRU1f
VFJBQ0UoImxvIHNwaW5uZXIgZmFpbGVkIHRvIHN0YXJ0XG4iKTsKIAkJCUdFTV9UUkFDRV9EVU1Q
KCk7Ci0JCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZpOTE1LT5ndCk7CisJCQlpbnRlbF9ndF9zZXRf
d2VkZ2VkKGd0KTsKIAkJCWVyciA9IC1FSU87CiAJCQlnb3RvIGVycl9jdHhfbG87CiAJCX0KQEAg
LTE1MDcsMjggKzE1MDYsMjggQEAgc3RhdGljIGludCBsaXZlX3ByZWVtcHRfaGFuZyh2b2lkICph
cmcpCiAJCQkJCQkgSFogLyAxMCkpIHsKIAkJCXByX2VycigiUHJlZW1wdGlvbiBkaWQgbm90IG9j
Y3VyIHdpdGhpbiB0aW1lb3V0ISIpOwogCQkJR0VNX1RSQUNFX0RVTVAoKTsKLQkJCWludGVsX2d0
X3NldF93ZWRnZWQoJmk5MTUtPmd0KTsKKwkJCWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOwogCQkJ
ZXJyID0gLUVJTzsKIAkJCWdvdG8gZXJyX2N0eF9sbzsKIAkJfQogCi0JCXNldF9iaXQoSTkxNV9S
RVNFVF9FTkdJTkUgKyBpZCwgJmk5MTUtPmd0LnJlc2V0LmZsYWdzKTsKKwkJc2V0X2JpdChJOTE1
X1JFU0VUX0VOR0lORSArIGlkLCAmZ3QtPnJlc2V0LmZsYWdzKTsKIAkJaW50ZWxfZW5naW5lX3Jl
c2V0KGVuZ2luZSwgTlVMTCk7Ci0JCWNsZWFyX2JpdChJOTE1X1JFU0VUX0VOR0lORSArIGlkLCAm
aTkxNS0+Z3QucmVzZXQuZmxhZ3MpOworCQljbGVhcl9iaXQoSTkxNV9SRVNFVF9FTkdJTkUgKyBp
ZCwgJmd0LT5yZXNldC5mbGFncyk7CiAKIAkJZW5naW5lLT5leGVjbGlzdHMucHJlZW1wdF9oYW5n
LmluamVjdF9oYW5nID0gZmFsc2U7CiAKIAkJaWYgKCFpZ3Rfd2FpdF9mb3Jfc3Bpbm5lcigmc3Bp
bl9oaSwgcnEpKSB7CiAJCQlHRU1fVFJBQ0UoImhpIHNwaW5uZXIgZmFpbGVkIHRvIHN0YXJ0XG4i
KTsKIAkJCUdFTV9UUkFDRV9EVU1QKCk7Ci0JCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZpOTE1LT5n
dCk7CisJCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKGd0KTsKIAkJCWVyciA9IC1FSU87CiAJCQlnb3Rv
IGVycl9jdHhfbG87CiAJCX0KIAogCQlpZ3Rfc3Bpbm5lcl9lbmQoJnNwaW5faGkpOwogCQlpZ3Rf
c3Bpbm5lcl9lbmQoJnNwaW5fbG8pOwotCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpIHsKKwkJ
aWYgKGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KSkgewogCQkJZXJyID0gLUVJTzsKIAkJCWdvdG8g
ZXJyX2N0eF9sbzsKIAkJfQpAQCAtMTU1Nyw3ICsxNTU2LDcgQEAgc3RhdGljIGludCByYW5kb21f
cHJpb3JpdHkoc3RydWN0IHJuZF9zdGF0ZSAqcm5kKQogfQogCiBzdHJ1Y3QgcHJlZW1wdF9zbW9r
ZSB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTU7CisJc3RydWN0IGludGVsX2d0ICpn
dDsKIAlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqKmNvbnRleHRzOwogCXN0cnVjdCBpbnRlbF9l
bmdpbmVfY3MgKmVuZ2luZTsKIAlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqYmF0Y2g7CkBA
IC0xNjU3LDcgKzE2NTYsNyBAQCBzdGF0aWMgaW50IHNtb2tlX2NyZXNjZW5kbyhzdHJ1Y3QgcHJl
ZW1wdF9zbW9rZSAqc21va2UsIHVuc2lnbmVkIGludCBmbGFncykKIAl1bnNpZ25lZCBsb25nIGNv
dW50OwogCWludCBlcnIgPSAwOwogCi0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgc21va2UtPmk5
MTUsIGlkKSB7CisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgc21va2UtPmd0LT5pOTE1LCBpZCkg
ewogCQlhcmdbaWRdID0gKnNtb2tlOwogCQlhcmdbaWRdLmVuZ2luZSA9IGVuZ2luZTsKIAkJaWYg
KCEoZmxhZ3MgJiBCQVRDSCkpCkBAIC0xNjc0LDcgKzE2NzMsNyBAQCBzdGF0aWMgaW50IHNtb2tl
X2NyZXNjZW5kbyhzdHJ1Y3QgcHJlZW1wdF9zbW9rZSAqc21va2UsIHVuc2lnbmVkIGludCBmbGFn
cykKIAl9CiAKIAljb3VudCA9IDA7Ci0JZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgc21va2UtPmk5
MTUsIGlkKSB7CisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgc21va2UtPmd0LT5pOTE1LCBpZCkg
ewogCQlpbnQgc3RhdHVzOwogCiAJCWlmIChJU19FUlJfT1JfTlVMTCh0c2tbaWRdKSkKQEAgLTE2
OTEsNyArMTY5MCw3IEBAIHN0YXRpYyBpbnQgc21va2VfY3Jlc2NlbmRvKHN0cnVjdCBwcmVlbXB0
X3Ntb2tlICpzbW9rZSwgdW5zaWduZWQgaW50IGZsYWdzKQogCiAJcHJfaW5mbygiU3VibWl0dGVk
ICVsdSBjcmVzY2VuZG86JXggcmVxdWVzdHMgYWNyb3NzICVkIGVuZ2luZXMgYW5kICVkIGNvbnRl
eHRzXG4iLAogCQljb3VudCwgZmxhZ3MsCi0JCVJVTlRJTUVfSU5GTyhzbW9rZS0+aTkxNSktPm51
bV9lbmdpbmVzLCBzbW9rZS0+bmNvbnRleHQpOworCQlSVU5USU1FX0lORk8oc21va2UtPmd0LT5p
OTE1KS0+bnVtX2VuZ2luZXMsIHNtb2tlLT5uY29udGV4dCk7CiAJcmV0dXJuIDA7CiB9CiAKQEAg
LTE3MDMsNyArMTcwMiw3IEBAIHN0YXRpYyBpbnQgc21va2VfcmFuZG9tKHN0cnVjdCBwcmVlbXB0
X3Ntb2tlICpzbW9rZSwgdW5zaWduZWQgaW50IGZsYWdzKQogCiAJY291bnQgPSAwOwogCWRvIHsK
LQkJZm9yX2VhY2hfZW5naW5lKHNtb2tlLT5lbmdpbmUsIHNtb2tlLT5pOTE1LCBpZCkgeworCQlm
b3JfZWFjaF9lbmdpbmUoc21va2UtPmVuZ2luZSwgc21va2UtPmd0LT5pOTE1LCBpZCkgewogCQkJ
c3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCA9IHNtb2tlX2NvbnRleHQoc21va2UpOwogCQkJ
aW50IGVycjsKIApAQCAtMTcxOSwxNCArMTcxOCwxNCBAQCBzdGF0aWMgaW50IHNtb2tlX3JhbmRv
bShzdHJ1Y3QgcHJlZW1wdF9zbW9rZSAqc21va2UsIHVuc2lnbmVkIGludCBmbGFncykKIAogCXBy
X2luZm8oIlN1Ym1pdHRlZCAlbHUgcmFuZG9tOiV4IHJlcXVlc3RzIGFjcm9zcyAlZCBlbmdpbmVz
IGFuZCAlZCBjb250ZXh0c1xuIiwKIAkJY291bnQsIGZsYWdzLAotCQlSVU5USU1FX0lORk8oc21v
a2UtPmk5MTUpLT5udW1fZW5naW5lcywgc21va2UtPm5jb250ZXh0KTsKKwkJUlVOVElNRV9JTkZP
KHNtb2tlLT5ndC0+aTkxNSktPm51bV9lbmdpbmVzLCBzbW9rZS0+bmNvbnRleHQpOwogCXJldHVy
biAwOwogfQogCiBzdGF0aWMgaW50IGxpdmVfcHJlZW1wdF9zbW9rZSh2b2lkICphcmcpCiB7CiAJ
c3RydWN0IHByZWVtcHRfc21va2Ugc21va2UgPSB7Ci0JCS5pOTE1ID0gYXJnLAorCQkuZ3QgPSBh
cmcsCiAJCS5wcm5nID0gSTkxNV9STkRfU1RBVEVfSU5JVElBTElaRVIoaTkxNV9zZWxmdGVzdC5y
YW5kb21fc2VlZCksCiAJCS5uY29udGV4dCA9IDEwMjQsCiAJfTsKQEAgLTE3MzYsNyArMTczNSw3
IEBAIHN0YXRpYyBpbnQgbGl2ZV9wcmVlbXB0X3Ntb2tlKHZvaWQgKmFyZykKIAl1MzIgKmNzOwog
CWludCBuOwogCi0JaWYgKCFIQVNfTE9HSUNBTF9SSU5HX1BSRUVNUFRJT04oc21va2UuaTkxNSkp
CisJaWYgKCFIQVNfTE9HSUNBTF9SSU5HX1BSRUVNUFRJT04oc21va2UuZ3QtPmk5MTUpKQogCQly
ZXR1cm4gMDsKIAogCXNtb2tlLmNvbnRleHRzID0ga21hbGxvY19hcnJheShzbW9rZS5uY29udGV4
dCwKQEAgLTE3NDUsNyArMTc0NCw4IEBAIHN0YXRpYyBpbnQgbGl2ZV9wcmVlbXB0X3Ntb2tlKHZv
aWQgKmFyZykKIAlpZiAoIXNtb2tlLmNvbnRleHRzKQogCQlyZXR1cm4gLUVOT01FTTsKIAotCXNt
b2tlLmJhdGNoID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChzbW9rZS5pOTE1LCBQ
QUdFX1NJWkUpOworCXNtb2tlLmJhdGNoID0KKwkJaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRl
cm5hbChzbW9rZS5ndC0+aTkxNSwgUEFHRV9TSVpFKTsKIAlpZiAoSVNfRVJSKHNtb2tlLmJhdGNo
KSkgewogCQllcnIgPSBQVFJfRVJSKHNtb2tlLmJhdGNoKTsKIAkJZ290byBlcnJfZnJlZTsKQEAg
LTE3NjIsMTMgKzE3NjIsMTMgQEAgc3RhdGljIGludCBsaXZlX3ByZWVtcHRfc21va2Uodm9pZCAq
YXJnKQogCWk5MTVfZ2VtX29iamVjdF9mbHVzaF9tYXAoc21va2UuYmF0Y2gpOwogCWk5MTVfZ2Vt
X29iamVjdF91bnBpbl9tYXAoc21va2UuYmF0Y2gpOwogCi0JaWYgKGlndF9saXZlX3Rlc3RfYmVn
aW4oJnQsIHNtb2tlLmk5MTUsIF9fZnVuY19fLCAiYWxsIikpIHsKKwlpZiAoaWd0X2xpdmVfdGVz
dF9iZWdpbigmdCwgc21va2UuZ3QtPmk5MTUsIF9fZnVuY19fLCAiYWxsIikpIHsKIAkJZXJyID0g
LUVJTzsKIAkJZ290byBlcnJfYmF0Y2g7CiAJfQogCiAJZm9yIChuID0gMDsgbiA8IHNtb2tlLm5j
b250ZXh0OyBuKyspIHsKLQkJc21va2UuY29udGV4dHNbbl0gPSBrZXJuZWxfY29udGV4dChzbW9r
ZS5pOTE1KTsKKwkJc21va2UuY29udGV4dHNbbl0gPSBrZXJuZWxfY29udGV4dChzbW9rZS5ndC0+
aTkxNSk7CiAJCWlmICghc21va2UuY29udGV4dHNbbl0pCiAJCQlnb3RvIGVycl9jdHg7CiAJfQpA
QCAtMTgwMSw3ICsxODAxLDcgQEAgc3RhdGljIGludCBsaXZlX3ByZWVtcHRfc21va2Uodm9pZCAq
YXJnKQogCXJldHVybiBlcnI7CiB9CiAKLXN0YXRpYyBpbnQgbm9wX3ZpcnR1YWxfZW5naW5lKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAorc3RhdGljIGludCBub3BfdmlydHVhbF9lbmdp
bmUoc3RydWN0IGludGVsX2d0ICpndCwKIAkJCSAgICAgIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KipzaWJsaW5ncywKIAkJCSAgICAgIHVuc2lnbmVkIGludCBuc2libGluZywKIAkJCSAgICAgIHVu
c2lnbmVkIGludCBuY3R4LApAQCAtMTgyMCw3ICsxODIwLDcgQEAgc3RhdGljIGludCBub3Bfdmly
dHVhbF9lbmdpbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJR0VNX0JVR19PTigh
bmN0eCB8fCBuY3R4ID4gQVJSQVlfU0laRShjdHgpKTsKIAogCWZvciAobiA9IDA7IG4gPCBuY3R4
OyBuKyspIHsKLQkJY3R4W25dID0ga2VybmVsX2NvbnRleHQoaTkxNSk7CisJCWN0eFtuXSA9IGtl
cm5lbF9jb250ZXh0KGd0LT5pOTE1KTsKIAkJaWYgKCFjdHhbbl0pIHsKIAkJCWVyciA9IC1FTk9N
RU07CiAJCQluY3R4ID0gbjsKQEAgLTE4NDUsNyArMTg0NSw3IEBAIHN0YXRpYyBpbnQgbm9wX3Zp
cnR1YWxfZW5naW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQl9CiAJfQogCi0J
ZXJyID0gaWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgaTkxNSwgX19mdW5jX18sIHZlWzBdLT5lbmdp
bmUtPm5hbWUpOworCWVyciA9IGlndF9saXZlX3Rlc3RfYmVnaW4oJnQsIGd0LT5pOTE1LCBfX2Z1
bmNfXywgdmVbMF0tPmVuZ2luZS0+bmFtZSk7CiAJaWYgKGVycikKIAkJZ290byBvdXQ7CiAKQEAg
LTE4OTIsNyArMTg5Miw3IEBAIHN0YXRpYyBpbnQgbm9wX3ZpcnR1YWxfZW5naW5lKHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCQkgIHJlcXVlc3RbbmNdLT5mZW5jZS5jb250ZXh0
LAogCQkJCQkgIHJlcXVlc3RbbmNdLT5mZW5jZS5zZXFubyk7CiAJCQkJR0VNX1RSQUNFX0RVTVAo
KTsKLQkJCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZpOTE1LT5ndCk7CisJCQkJaW50ZWxfZ3Rfc2V0
X3dlZGdlZChndCk7CiAJCQkJYnJlYWs7CiAJCQl9CiAJCX0KQEAgLTE5MTQsNyArMTkxNCw3IEBA
IHN0YXRpYyBpbnQgbm9wX3ZpcnR1YWxfZW5naW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LAogCQlwcmltZSwgZGl2NjRfdTY0KGt0aW1lX3RvX25zKHRpbWVzWzFdKSwgcHJpbWUpKTsK
IAogb3V0OgotCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKKwlpZiAoaWd0X2ZsdXNoX3Rlc3Qo
Z3QtPmk5MTUpKQogCQllcnIgPSAtRUlPOwogCiAJZm9yIChuYyA9IDA7IG5jIDwgbmN0eDsgbmMr
KykgewpAQCAtMTkyNywxOSArMTkyNywxOCBAQCBzdGF0aWMgaW50IG5vcF92aXJ0dWFsX2VuZ2lu
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAogc3RhdGljIGludCBsaXZlX3ZpcnR1
YWxfZW5naW5lKHZvaWQgKmFyZykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IGFyZzsKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKnNpYmxpbmdzW01BWF9FTkdJTkVfSU5TVEFOQ0UgKyAxXTsKIAlzdHJ1Y3QgaW50ZWxfZW5n
aW5lX2NzICplbmdpbmU7Ci0Jc3RydWN0IGludGVsX2d0ICpndCA9ICZpOTE1LT5ndDsKIAllbnVt
IGludGVsX2VuZ2luZV9pZCBpZDsKIAl1bnNpZ25lZCBpbnQgY2xhc3MsIGluc3Q7CiAJaW50IGVy
cjsKIAotCWlmIChVU0VTX0dVQ19TVUJNSVNTSU9OKGk5MTUpKQorCWlmIChVU0VTX0dVQ19TVUJN
SVNTSU9OKGd0LT5pOTE1KSkKIAkJcmV0dXJuIDA7CiAKLQlmb3JfZWFjaF9lbmdpbmUoZW5naW5l
LCBpOTE1LCBpZCkgewotCQllcnIgPSBub3BfdmlydHVhbF9lbmdpbmUoaTkxNSwgJmVuZ2luZSwg
MSwgMSwgMCk7CisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5MTUsIGlkKSB7CisJCWVy
ciA9IG5vcF92aXJ0dWFsX2VuZ2luZShndCwgJmVuZ2luZSwgMSwgMSwgMCk7CiAJCWlmIChlcnIp
IHsKIAkJCXByX2VycigiRmFpbGVkIHRvIHdyYXAgZW5naW5lICVzOiBlcnI9JWRcbiIsCiAJCQkg
ICAgICAgZW5naW5lLT5uYW1lLCBlcnIpOwpAQCAtMTk2MSwxMyArMTk2MCwxMyBAQCBzdGF0aWMg
aW50IGxpdmVfdmlydHVhbF9lbmdpbmUodm9pZCAqYXJnKQogCQkJY29udGludWU7CiAKIAkJZm9y
IChuID0gMTsgbiA8PSBuc2libGluZyArIDE7IG4rKykgewotCQkJZXJyID0gbm9wX3ZpcnR1YWxf
ZW5naW5lKGk5MTUsIHNpYmxpbmdzLCBuc2libGluZywKKwkJCWVyciA9IG5vcF92aXJ0dWFsX2Vu
Z2luZShndCwgc2libGluZ3MsIG5zaWJsaW5nLAogCQkJCQkJIG4sIDApOwogCQkJaWYgKGVycikK
IAkJCQlyZXR1cm4gZXJyOwogCQl9CiAKLQkJZXJyID0gbm9wX3ZpcnR1YWxfZW5naW5lKGk5MTUs
IHNpYmxpbmdzLCBuc2libGluZywgbiwgQ0hBSU4pOworCQllcnIgPSBub3BfdmlydHVhbF9lbmdp
bmUoZ3QsIHNpYmxpbmdzLCBuc2libGluZywgbiwgQ0hBSU4pOwogCQlpZiAoZXJyKQogCQkJcmV0
dXJuIGVycjsKIAl9CkBAIC0xOTc1LDcgKzE5NzQsNyBAQCBzdGF0aWMgaW50IGxpdmVfdmlydHVh
bF9lbmdpbmUodm9pZCAqYXJnKQogCXJldHVybiAwOwogfQogCi1zdGF0aWMgaW50IG1hc2tfdmly
dHVhbF9lbmdpbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCitzdGF0aWMgaW50IG1h
c2tfdmlydHVhbF9lbmdpbmUoc3RydWN0IGludGVsX2d0ICpndCwKIAkJCSAgICAgICBzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICoqc2libGluZ3MsCiAJCQkgICAgICAgdW5zaWduZWQgaW50IG5zaWJs
aW5nKQogewpAQCAtMTk5MSw3ICsxOTkwLDcgQEAgc3RhdGljIGludCBtYXNrX3ZpcnR1YWxfZW5n
aW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCSAqIHJlc3RyaWN0IGl0IHRvIG91
ciBkZXNpcmVkIGVuZ2luZSB3aXRoaW4gdGhlIHZpcnR1YWwgZW5naW5lLgogCSAqLwogCi0JY3R4
ID0ga2VybmVsX2NvbnRleHQoaTkxNSk7CisJY3R4ID0ga2VybmVsX2NvbnRleHQoZ3QtPmk5MTUp
OwogCWlmICghY3R4KQogCQlyZXR1cm4gLUVOT01FTTsKIApAQCAtMjAwNSw3ICsyMDA0LDcgQEAg
c3RhdGljIGludCBtYXNrX3ZpcnR1YWxfZW5naW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1LAogCWlmIChlcnIpCiAJCWdvdG8gb3V0X3B1dDsKIAotCWVyciA9IGlndF9saXZlX3Rlc3Rf
YmVnaW4oJnQsIGk5MTUsIF9fZnVuY19fLCB2ZS0+ZW5naW5lLT5uYW1lKTsKKwllcnIgPSBpZ3Rf
bGl2ZV90ZXN0X2JlZ2luKCZ0LCBndC0+aTkxNSwgX19mdW5jX18sIHZlLT5lbmdpbmUtPm5hbWUp
OwogCWlmIChlcnIpCiAJCWdvdG8gb3V0X3VucGluOwogCkBAIC0yMDM2LDcgKzIwMzUsNyBAQCBz
dGF0aWMgaW50IG1hc2tfdmlydHVhbF9lbmdpbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAJCQkJICByZXF1ZXN0W25dLT5mZW5jZS5jb250ZXh0LAogCQkJCSAgcmVxdWVzdFtuXS0+
ZmVuY2Uuc2Vxbm8pOwogCQkJR0VNX1RSQUNFX0RVTVAoKTsKLQkJCWludGVsX2d0X3NldF93ZWRn
ZWQoJmk5MTUtPmd0KTsKKwkJCWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOwogCQkJZXJyID0gLUVJ
TzsKIAkJCWdvdG8gb3V0OwogCQl9CkBAIC0yMDUyLDcgKzIwNTEsNyBAQCBzdGF0aWMgaW50IG1h
c2tfdmlydHVhbF9lbmdpbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAKIAllcnIg
PSBpZ3RfbGl2ZV90ZXN0X2VuZCgmdCk7CiBvdXQ6Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUp
KQorCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSkpCiAJCWVyciA9IC1FSU87CiAKIAlmb3Ig
KG4gPSAwOyBuIDwgbnNpYmxpbmc7IG4rKykKQEAgLTIwNjksMTMgKzIwNjgsMTIgQEAgc3RhdGlj
IGludCBtYXNrX3ZpcnR1YWxfZW5naW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAog
CiBzdGF0aWMgaW50IGxpdmVfdmlydHVhbF9tYXNrKHZvaWQgKmFyZykKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOwog
CXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKnNpYmxpbmdzW01BWF9FTkdJTkVfSU5TVEFOQ0UgKyAx
XTsKLQlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gJmk5MTUtPmd0OwogCXVuc2lnbmVkIGludCBjbGFz
cywgaW5zdDsKIAlpbnQgZXJyOwogCi0JaWYgKFVTRVNfR1VDX1NVQk1JU1NJT04oaTkxNSkpCisJ
aWYgKFVTRVNfR1VDX1NVQk1JU1NJT04oZ3QtPmk5MTUpKQogCQlyZXR1cm4gMDsKIAogCWZvciAo
Y2xhc3MgPSAwOyBjbGFzcyA8PSBNQVhfRU5HSU5FX0NMQVNTOyBjbGFzcysrKSB7CkBAIC0yMDkx
LDcgKzIwODksNyBAQCBzdGF0aWMgaW50IGxpdmVfdmlydHVhbF9tYXNrKHZvaWQgKmFyZykKIAkJ
aWYgKG5zaWJsaW5nIDwgMikKIAkJCWNvbnRpbnVlOwogCi0JCWVyciA9IG1hc2tfdmlydHVhbF9l
bmdpbmUoaTkxNSwgc2libGluZ3MsIG5zaWJsaW5nKTsKKwkJZXJyID0gbWFza192aXJ0dWFsX2Vu
Z2luZShndCwgc2libGluZ3MsIG5zaWJsaW5nKTsKIAkJaWYgKGVycikKIAkJCXJldHVybiBlcnI7
CiAJfQpAQCAtMjA5OSw3ICsyMDk3LDcgQEAgc3RhdGljIGludCBsaXZlX3ZpcnR1YWxfbWFzayh2
b2lkICphcmcpCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgcHJlc2VydmVkX3ZpcnR1YWxf
ZW5naW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAorc3RhdGljIGludCBwcmVzZXJ2
ZWRfdmlydHVhbF9lbmdpbmUoc3RydWN0IGludGVsX2d0ICpndCwKIAkJCQkgICAgc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqKnNpYmxpbmdzLAogCQkJCSAgICB1bnNpZ25lZCBpbnQgbnNpYmxpbmcp
CiB7CkBAIC0yMTEyLDcgKzIxMTAsNyBAQCBzdGF0aWMgaW50IHByZXNlcnZlZF92aXJ0dWFsX2Vu
Z2luZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlpbnQgZXJyID0gMDsKIAl1MzIg
KmNzOwogCi0JY3R4ID0ga2VybmVsX2NvbnRleHQoaTkxNSk7CisJY3R4ID0ga2VybmVsX2NvbnRl
eHQoZ3QtPmk5MTUpOwogCWlmICghY3R4KQogCQlyZXR1cm4gLUVOT01FTTsKIApAQCAtMjEzMiw3
ICsyMTMwLDcgQEAgc3RhdGljIGludCBwcmVzZXJ2ZWRfdmlydHVhbF9lbmdpbmUoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJaWYgKGVycikKIAkJZ290byBvdXRfcHV0OwogCi0JZXJy
ID0gaWd0X2xpdmVfdGVzdF9iZWdpbigmdCwgaTkxNSwgX19mdW5jX18sIHZlLT5lbmdpbmUtPm5h
bWUpOworCWVyciA9IGlndF9saXZlX3Rlc3RfYmVnaW4oJnQsIGd0LT5pOTE1LCBfX2Z1bmNfXywg
dmUtPmVuZ2luZS0+bmFtZSk7CiAJaWYgKGVycikKIAkJZ290byBvdXRfdW5waW47CiAKQEAgLTIy
MTIsOSArMjIxMCw4IEBAIHN0YXRpYyBpbnQgcHJlc2VydmVkX3ZpcnR1YWxfZW5naW5lKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCiBzdGF0aWMgaW50IGxpdmVfdmlydHVhbF9wcmVz
ZXJ2ZWQodm9pZCAqYXJnKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gYXJn
OworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAq
c2libGluZ3NbTUFYX0VOR0lORV9JTlNUQU5DRSArIDFdOwotCXN0cnVjdCBpbnRlbF9ndCAqZ3Qg
PSAmaTkxNS0+Z3Q7CiAJdW5zaWduZWQgaW50IGNsYXNzLCBpbnN0OwogCiAJLyoKQEAgLTIyMjMs
MTEgKzIyMjAsMTEgQEAgc3RhdGljIGludCBsaXZlX3ZpcnR1YWxfcHJlc2VydmVkKHZvaWQgKmFy
ZykKIAkgKiBhcmUgcHJlc2VydmVkLgogCSAqLwogCi0JaWYgKFVTRVNfR1VDX1NVQk1JU1NJT04o
aTkxNSkpCisJaWYgKFVTRVNfR1VDX1NVQk1JU1NJT04oZ3QtPmk5MTUpKQogCQlyZXR1cm4gMDsK
IAogCS8qIEFzIHdlIHVzZSBDU19HUFIgd2UgY2Fubm90IHJ1biBiZWZvcmUgdGhleSBleGlzdGVk
IG9uIGFsbCBlbmdpbmVzLiAqLwotCWlmIChJTlRFTF9HRU4oaTkxNSkgPCA5KQorCWlmIChJTlRF
TF9HRU4oZ3QtPmk5MTUpIDwgOSkKIAkJcmV0dXJuIDA7CiAKIAlmb3IgKGNsYXNzID0gMDsgY2xh
c3MgPD0gTUFYX0VOR0lORV9DTEFTUzsgY2xhc3MrKykgewpAQCAtMjI0Myw3ICsyMjQwLDcgQEAg
c3RhdGljIGludCBsaXZlX3ZpcnR1YWxfcHJlc2VydmVkKHZvaWQgKmFyZykKIAkJaWYgKG5zaWJs
aW5nIDwgMikKIAkJCWNvbnRpbnVlOwogCi0JCWVyciA9IHByZXNlcnZlZF92aXJ0dWFsX2VuZ2lu
ZShpOTE1LCBzaWJsaW5ncywgbnNpYmxpbmcpOworCQllcnIgPSBwcmVzZXJ2ZWRfdmlydHVhbF9l
bmdpbmUoZ3QsIHNpYmxpbmdzLCBuc2libGluZyk7CiAJCWlmIChlcnIpCiAJCQlyZXR1cm4gZXJy
OwogCX0KQEAgLTIyNTEsNyArMjI0OCw3IEBAIHN0YXRpYyBpbnQgbGl2ZV92aXJ0dWFsX3ByZXNl
cnZlZCh2b2lkICphcmcpCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgYm9uZF92aXJ0dWFs
X2VuZ2luZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKK3N0YXRpYyBpbnQgYm9uZF92
aXJ0dWFsX2VuZ2luZShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCQkJICAgICAgIHVuc2lnbmVkIGlu
dCBjbGFzcywKIAkJCSAgICAgICBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICoqc2libGluZ3MsCiAJ
CQkgICAgICAgdW5zaWduZWQgaW50IG5zaWJsaW5nLApAQCAtMjI2NywxMyArMjI2NCwxMyBAQCBz
dGF0aWMgaW50IGJvbmRfdmlydHVhbF9lbmdpbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5
MTUsCiAKIAlHRU1fQlVHX09OKG5zaWJsaW5nID49IEFSUkFZX1NJWkUocnEpIC0gMSk7CiAKLQlj
dHggPSBrZXJuZWxfY29udGV4dChpOTE1KTsKKwljdHggPSBrZXJuZWxfY29udGV4dChndC0+aTkx
NSk7CiAJaWYgKCFjdHgpCiAJCXJldHVybiAtRU5PTUVNOwogCiAJZXJyID0gMDsKIAlycVswXSA9
IEVSUl9QVFIoLUVOT01FTSk7Ci0JZm9yX2VhY2hfZW5naW5lKG1hc3RlciwgaTkxNSwgaWQpIHsK
Kwlmb3JfZWFjaF9lbmdpbmUobWFzdGVyLCBndC0+aTkxNSwgaWQpIHsKIAkJc3RydWN0IGk5MTVf
c3dfZmVuY2UgZmVuY2UgPSB7fTsKIAogCQlpZiAobWFzdGVyLT5jbGFzcyA9PSBjbGFzcykKQEAg
LTIzNzgsNyArMjM3NSw3IEBAIHN0YXRpYyBpbnQgYm9uZF92aXJ0dWFsX2VuZ2luZShzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIG91dDoKIAlmb3IgKG4gPSAwOyAhSVNfRVJSKHJxW25d
KTsgbisrKQogCQlpOTE1X3JlcXVlc3RfcHV0KHJxW25dKTsKLQlpZiAoaWd0X2ZsdXNoX3Rlc3Qo
aTkxNSkpCisJaWYgKGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KSkKIAkJZXJyID0gLUVJTzsKIAog
CWtlcm5lbF9jb250ZXh0X2Nsb3NlKGN0eCk7CkBAIC0yMzk1LDEzICsyMzkyLDEyIEBAIHN0YXRp
YyBpbnQgbGl2ZV92aXJ0dWFsX2JvbmQodm9pZCAqYXJnKQogCQl7ICJzY2hlZHVsZSIsIEJPTkRf
U0NIRURVTEUgfSwKIAkJeyB9LAogCX07Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSBhcmc7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKIAlzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICpzaWJsaW5nc1tNQVhfRU5HSU5FX0lOU1RBTkNFICsgMV07Ci0Jc3RydWN0IGludGVsX2d0
ICpndCA9ICZpOTE1LT5ndDsKIAl1bnNpZ25lZCBpbnQgY2xhc3MsIGluc3Q7CiAJaW50IGVycjsK
IAotCWlmIChVU0VTX0dVQ19TVUJNSVNTSU9OKGk5MTUpKQorCWlmIChVU0VTX0dVQ19TVUJNSVNT
SU9OKGd0LT5pOTE1KSkKIAkJcmV0dXJuIDA7CiAKIAlmb3IgKGNsYXNzID0gMDsgY2xhc3MgPD0g
TUFYX0VOR0lORV9DTEFTUzsgY2xhc3MrKykgewpAQCAtMjQyMCw3ICsyNDE2LDcgQEAgc3RhdGlj
IGludCBsaXZlX3ZpcnR1YWxfYm9uZCh2b2lkICphcmcpCiAJCQljb250aW51ZTsKIAogCQlmb3Ig
KHAgPSBwaGFzZXM7IHAtPm5hbWU7IHArKykgewotCQkJZXJyID0gYm9uZF92aXJ0dWFsX2VuZ2lu
ZShpOTE1LAorCQkJZXJyID0gYm9uZF92aXJ0dWFsX2VuZ2luZShndCwKIAkJCQkJCSAgY2xhc3Ms
IHNpYmxpbmdzLCBuc2libGluZywKIAkJCQkJCSAgcC0+ZmxhZ3MpOwogCQkJaWYgKGVycikgewpA
QCAtMjQ2Miw3ICsyNDU4LDcgQEAgaW50IGludGVsX2V4ZWNsaXN0c19saXZlX3NlbGZ0ZXN0cyhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAlpZiAoaW50ZWxfZ3RfaXNfd2VkZ2VkKCZp
OTE1LT5ndCkpCiAJCXJldHVybiAwOwogCi0JcmV0dXJuIGk5MTVfbGl2ZV9zdWJ0ZXN0cyh0ZXN0
cywgaTkxNSk7CisJcmV0dXJuIGludGVsX2d0X2xpdmVfc3VidGVzdHModGVzdHMsICZpOTE1LT5n
dCk7CiB9CiAKIHN0YXRpYyB2b2lkIGhleGR1bXAoY29uc3Qgdm9pZCAqYnVmLCBzaXplX3QgbGVu
KQotLSAKMi4yMy4wCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5v
cmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1n
Zng=

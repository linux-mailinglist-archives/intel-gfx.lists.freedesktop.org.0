Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id D8E4D10C530
	for <lists+intel-gfx@lfdr.de>; Thu, 28 Nov 2019 09:35:05 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id BFC0C6E783;
	Thu, 28 Nov 2019 08:35:01 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 04F4D6E750;
 Thu, 28 Nov 2019 08:34:59 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19370926-1500050 
 for multiple; Thu, 28 Nov 2019 08:34:53 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: igt-dev@lists.freedesktop.org
Date: Thu, 28 Nov 2019 08:34:51 +0000
Message-Id: <20191128083451.3782143-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191128083451.3782143-1-chris@chris-wilson.co.uk>
References: <20191128083451.3782143-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t 2/2] Remove i915/gem_exec_blt
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: intel-gfx@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlIHRlc3RzL2dlbV9leGVjX2JsdCBpcyBhIGJlbmNobWFya2luZyB0b29sLCBwcm92aWRpbmcg
bm8gdmVyaWZpY2F0aW9uCmFzIHRoYXQgaXMgZG9uZSBieSBnZW1fbGluZWFyX2JsaXRzLCBnZW1f
dGlsZWRfYmxpdHMsIGdlbV9ibGl0cywKZ2VtX2NvbmN1cnJlbnRfYmxpdCBldCBhbC4gSXQncyBq
dXN0IGEgd2FzdGUgb2YgdGltZSBpbiBDSSwgYW5kIHdoZW4gd2UKZG8gc3RhcnQgaW5jbHVkaW5n
IHBlcmZvcm1hbmNlIHRlc3RzIGluIG91ciByZWdyZXNzaW9uIHN1aXRlLCB3ZSBoYXZlCmJlbmNo
bWFya3MvZ2VtX2JsdCBhcyBvdXIgYmFzZWxpbmUuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxz
b24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KLS0tCiB0ZXN0cy9NYWtlZmlsZS5zb3VyY2Vz
ICAgIHwgICAzIC0KIHRlc3RzL2k5MTUvZ2VtX2V4ZWNfYmx0LmMgfCAzNDYgLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIHRlc3RzL21lc29uLmJ1aWxkICAgICAgICAgfCAg
IDEgLQogMyBmaWxlcyBjaGFuZ2VkLCAzNTAgZGVsZXRpb25zKC0pCiBkZWxldGUgbW9kZSAxMDA2
NDQgdGVzdHMvaTkxNS9nZW1fZXhlY19ibHQuYwoKZGlmZiAtLWdpdCBhL3Rlc3RzL01ha2VmaWxl
LnNvdXJjZXMgYi90ZXN0cy9NYWtlZmlsZS5zb3VyY2VzCmluZGV4IGJmMWI5NjcyNS4uYmRkOTEy
ZDJkIDEwMDY0NAotLS0gYS90ZXN0cy9NYWtlZmlsZS5zb3VyY2VzCisrKyBiL3Rlc3RzL01ha2Vm
aWxlLnNvdXJjZXMKQEAgLTIwNiw5ICsyMDYsNiBAQCBnZW1fZXhlY19iYXNpY19TT1VSQ0VTID0g
aTkxNS9nZW1fZXhlY19iYXNpYy5jCiBURVNUU19wcm9ncyArPSBnZW1fZXhlY19iaWcKIGdlbV9l
eGVjX2JpZ19TT1VSQ0VTID0gaTkxNS9nZW1fZXhlY19iaWcuYwogCi1URVNUU19wcm9ncyArPSBn
ZW1fZXhlY19ibHQKLWdlbV9leGVjX2JsdF9TT1VSQ0VTID0gaTkxNS9nZW1fZXhlY19ibHQuYwot
CiBURVNUU19wcm9ncyArPSBnZW1fZXhlY19jYXB0dXJlCiBnZW1fZXhlY19jYXB0dXJlX1NPVVJD
RVMgPSBpOTE1L2dlbV9leGVjX2NhcHR1cmUuYwogCmRpZmYgLS1naXQgYS90ZXN0cy9pOTE1L2dl
bV9leGVjX2JsdC5jIGIvdGVzdHMvaTkxNS9nZW1fZXhlY19ibHQuYwpkZWxldGVkIGZpbGUgbW9k
ZSAxMDA2NDQKaW5kZXggZmZiNjBkMGNjLi4wMDAwMDAwMDAKLS0tIGEvdGVzdHMvaTkxNS9nZW1f
ZXhlY19ibHQuYworKysgL2Rldi9udWxsCkBAIC0xLDM0NiArMCwwIEBACi0vKgotICogQ29weXJp
Z2h0IMKpIDIwMTEgSW50ZWwgQ29ycG9yYXRpb24KLSAqCi0gKiBQZXJtaXNzaW9uIGlzIGhlcmVi
eSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYQotICog
Y29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMg
KHRoZSAiU29mdHdhcmUiKSwKLSAqIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVz
dHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24KLSAqIHRoZSByaWdodHMgdG8g
dXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNl
LAotICogYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBw
ZXJzb25zIHRvIHdob20gdGhlCi0gKiBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1
YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgotICoKLSAqIFRoZSBhYm92ZSBjb3B5
cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIChpbmNsdWRpbmcgdGhlIG5l
eHQKLSAqIHBhcmFncmFwaCkgc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJz
dGFudGlhbCBwb3J0aW9ucyBvZiB0aGUKLSAqIFNvZnR3YXJlLgotICoKLSAqIFRIRSBTT0ZUV0FS
RSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBS
RVNTIE9SCi0gKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJS
QU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKLSAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQ
VVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuICBJTiBOTyBFVkVOVCBTSEFMTAotICogVEhFIEFV
VEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFH
RVMgT1IgT1RIRVIKLSAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJB
Q1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HCi0gKiBGUk9NLCBPVVQgT0YgT1IgSU4gQ09O
TkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTCi0g
KiBJTiBUSEUgU09GVFdBUkUuCi0gKgotICogQXV0aG9yczoKLSAqICAgIENocmlzIFdpbHNvbiA8
Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgotICoKLSAqLwotCi0jaW5jbHVkZSAiaWd0LmgiCi0j
aW5jbHVkZSA8dW5pc3RkLmg+Ci0jaW5jbHVkZSA8c3RkbGliLmg+Ci0jaW5jbHVkZSA8c3RkaW50
Lmg+Ci0jaW5jbHVkZSA8c3RkaW8uaD4KLSNpbmNsdWRlIDxzdHJpbmcuaD4KLSNpbmNsdWRlIDxm
Y250bC5oPgotI2luY2x1ZGUgPGludHR5cGVzLmg+Ci0jaW5jbHVkZSA8ZXJybm8uaD4KLSNpbmNs
dWRlIDxzeXMvc3RhdC5oPgotI2luY2x1ZGUgPHN5cy9pb2N0bC5oPgotI2luY2x1ZGUgPHN5cy90
aW1lLmg+Ci0jaW5jbHVkZSAiZHJtLmgiCi0jaW5jbHVkZSAiaWd0X3N5c2ZzLmgiCi0KLSNkZWZp
bmUgT0JKRUNUX1NJWkUgMTYzODQKLQotI2RlZmluZSBDT1BZX0JMVF9DTUQJCSgyPDwyOXwweDUz
PDwyMnwweDYpCi0jZGVmaW5lIEJMVF9XUklURV9BTFBIQQkJKDE8PDIxKQotI2RlZmluZSBCTFRf
V1JJVEVfUkdCCQkoMTw8MjApCi0jZGVmaW5lIEJMVF9TUkNfVElMRUQJCSgxPDwxNSkKLSNkZWZp
bmUgQkxUX0RTVF9USUxFRAkJKDE8PDExKQotCi0jZGVmaW5lIExPQ0FMX0k5MTVfRVhFQ19OT19S
RUxPQyAoMTw8MTEpCi0jZGVmaW5lIExPQ0FMX0k5MTVfRVhFQ19IQU5ETEVfTFVUICgxPDwxMikK
LQotc3RhdGljIGludCBnZW1fbGluZWFyX2JsdChpbnQgZmQsCi0JCQkgIHVpbnQzMl90ICpiYXRj
aCwKLQkJCSAgdWludDMyX3Qgc3JjLAotCQkJICB1aW50MzJfdCBkc3QsCi0JCQkgIHVpbnQzMl90
IGxlbmd0aCwKLQkJCSAgc3RydWN0IGRybV9pOTE1X2dlbV9yZWxvY2F0aW9uX2VudHJ5ICpyZWxv
YykKLXsKLQl1aW50MzJfdCAqYiA9IGJhdGNoOwotCWludCBoZWlnaHQgPSBsZW5ndGggLyAoMTYg
KiAxMDI0KTsKLQotCWlndF9hc3NlcnRfbHRlKGhlaWdodCwgMSA8PCAxNik7Ci0KLQlpZiAoaGVp
Z2h0KSB7Ci0JCWludCBpID0gMDsKLQkJYltpKytdID0gQ09QWV9CTFRfQ01EIHwgQkxUX1dSSVRF
X0FMUEhBIHwgQkxUX1dSSVRFX1JHQjsKLQkJaWYgKGludGVsX2dlbihpbnRlbF9nZXRfZHJtX2Rl
dmlkKGZkKSkgPj0gOCkKLQkJCWJbaS0xXSs9MjsKLQkJYltpKytdID0gMHhjYyA8PCAxNiB8IDEg
PDwgMjUgfCAxIDw8IDI0IHwgKDE2KjEwMjQpOwotCQliW2krK10gPSAwOwotCQliW2krK10gPSBo
ZWlnaHQgPDwgMTYgfCAoNCoxMDI0KTsKLQkJYltpKytdID0gMDsKLQkJcmVsb2MtPm9mZnNldCA9
IChiLWJhdGNoKzQpICogc2l6ZW9mKHVpbnQzMl90KTsKLQkJcmVsb2MtPmRlbHRhID0gMDsKLQkJ
cmVsb2MtPnRhcmdldF9oYW5kbGUgPSBkc3Q7Ci0JCXJlbG9jLT5yZWFkX2RvbWFpbnMgPSBJOTE1
X0dFTV9ET01BSU5fUkVOREVSOwotCQlyZWxvYy0+d3JpdGVfZG9tYWluID0gSTkxNV9HRU1fRE9N
QUlOX1JFTkRFUjsKLQkJcmVsb2MtPnByZXN1bWVkX29mZnNldCA9IDA7Ci0JCXJlbG9jKys7Ci0J
CWlmIChpbnRlbF9nZW4oaW50ZWxfZ2V0X2RybV9kZXZpZChmZCkpID49IDgpCi0JCQliW2krK10g
PSAwOyAvKiBGSVhNRSAqLwotCi0JCWJbaSsrXSA9IDA7Ci0JCWJbaSsrXSA9IDE2KjEwMjQ7Ci0J
CWJbaSsrXSA9IDA7Ci0JCXJlbG9jLT5vZmZzZXQgPSAoYi1iYXRjaCs3KSAqIHNpemVvZih1aW50
MzJfdCk7Ci0JCWlmIChpbnRlbF9nZW4oaW50ZWxfZ2V0X2RybV9kZXZpZChmZCkpID49IDgpCi0J
CQlyZWxvYy0+b2Zmc2V0ICs9IHNpemVvZih1aW50MzJfdCk7Ci0JCXJlbG9jLT5kZWx0YSA9IDA7
Ci0JCXJlbG9jLT50YXJnZXRfaGFuZGxlID0gc3JjOwotCQlyZWxvYy0+cmVhZF9kb21haW5zID0g
STkxNV9HRU1fRE9NQUlOX1JFTkRFUjsKLQkJcmVsb2MtPndyaXRlX2RvbWFpbiA9IDA7Ci0JCXJl
bG9jLT5wcmVzdW1lZF9vZmZzZXQgPSAwOwotCQlyZWxvYysrOwotCQlpZiAoaW50ZWxfZ2VuKGlu
dGVsX2dldF9kcm1fZGV2aWQoZmQpKSA+PSA4KQotCQkJYltpKytdID0gMDsgLyogRklYTUUgKi8K
LQotCQliICs9IGk7Ci0JCWxlbmd0aCAtPSBoZWlnaHQgKiAxNioxMDI0OwotCX0KLQotCWlmIChs
ZW5ndGgpIHsKLQkJaW50IGkgPSAwOwotCQliW2krK10gPSBDT1BZX0JMVF9DTUQgfCBCTFRfV1JJ
VEVfQUxQSEEgfCBCTFRfV1JJVEVfUkdCOwotCQlpZiAoaW50ZWxfZ2VuKGludGVsX2dldF9kcm1f
ZGV2aWQoZmQpKSA+PSA4KQotCQkJYltpLTFdKz0yOwotCQliW2krK10gPSAweGNjIDw8IDE2IHwg
MSA8PCAyNSB8IDEgPDwgMjQgfCAoMTYqMTAyNCk7Ci0JCWJbaSsrXSA9IGhlaWdodCA8PCAxNjsK
LQkJYltpKytdID0gKDEraGVpZ2h0KSA8PCAxNiB8IChsZW5ndGggLyA0KTsKLQkJYltpKytdID0g
MDsKLQkJcmVsb2MtPm9mZnNldCA9IChiLWJhdGNoKzQpICogc2l6ZW9mKHVpbnQzMl90KTsKLQkJ
cmVsb2MtPmRlbHRhID0gMDsKLQkJcmVsb2MtPnRhcmdldF9oYW5kbGUgPSBkc3Q7Ci0JCXJlbG9j
LT5yZWFkX2RvbWFpbnMgPSBJOTE1X0dFTV9ET01BSU5fUkVOREVSOwotCQlyZWxvYy0+d3JpdGVf
ZG9tYWluID0gSTkxNV9HRU1fRE9NQUlOX1JFTkRFUjsKLQkJcmVsb2MtPnByZXN1bWVkX29mZnNl
dCA9IDA7Ci0JCXJlbG9jKys7Ci0JCWlmIChpbnRlbF9nZW4oaW50ZWxfZ2V0X2RybV9kZXZpZChm
ZCkpID49IDgpCi0JCQliW2krK10gPSAwOyAvKiBGSVhNRSAqLwotCi0JCWJbaSsrXSA9IGhlaWdo
dCA8PCAxNjsKLQkJYltpKytdID0gMTYqMTAyNDsKLQkJYltpKytdID0gMDsKLQkJcmVsb2MtPm9m
ZnNldCA9IChiLWJhdGNoKzcpICogc2l6ZW9mKHVpbnQzMl90KTsKLQkJaWYgKGludGVsX2dlbihp
bnRlbF9nZXRfZHJtX2RldmlkKGZkKSkgPj0gOCkKLQkJCXJlbG9jLT5vZmZzZXQgKz0gc2l6ZW9m
KHVpbnQzMl90KTsKLQkJcmVsb2MtPmRlbHRhID0gMDsKLQkJcmVsb2MtPnRhcmdldF9oYW5kbGUg
PSBzcmM7Ci0JCXJlbG9jLT5yZWFkX2RvbWFpbnMgPSBJOTE1X0dFTV9ET01BSU5fUkVOREVSOwot
CQlyZWxvYy0+d3JpdGVfZG9tYWluID0gMDsKLQkJcmVsb2MtPnByZXN1bWVkX29mZnNldCA9IDA7
Ci0JCXJlbG9jKys7Ci0JCWlmIChpbnRlbF9nZW4oaW50ZWxfZ2V0X2RybV9kZXZpZChmZCkpID49
IDgpCi0JCQliW2krK10gPSAwOyAvKiBGSVhNRSAqLwotCi0JCWIgKz0gaTsKLQl9Ci0KLQliWzBd
ID0gTUlfQkFUQ0hfQlVGRkVSX0VORDsKLQliWzFdID0gMDsKLQotCXJldHVybiAoYisyIC0gYmF0
Y2gpICogc2l6ZW9mKHVpbnQzMl90KTsKLX0KLQotc3RhdGljIGRvdWJsZSBlbGFwc2VkKGNvbnN0
IHN0cnVjdCB0aW1ldmFsICpzdGFydCwKLQkJICAgICAgY29uc3Qgc3RydWN0IHRpbWV2YWwgKmVu
ZCwKLQkJICAgICAgaW50IGxvb3ApCi17Ci0JcmV0dXJuICgxZTYqKGVuZC0+dHZfc2VjIC0gc3Rh
cnQtPnR2X3NlYykgKyAoZW5kLT50dl91c2VjIC0gc3RhcnQtPnR2X3VzZWMpKS9sb29wOwotfQot
Ci1zdGF0aWMgY29uc3QgY2hhciAqYnl0ZXNfcGVyX3NlYyhjaGFyICpidWYsIGRvdWJsZSB2KQot
ewotCWNvbnN0IGNoYXIgKm9yZGVyW10gPSB7Ci0JCSIiLAotCQkiS2lCIiwKLQkJIk1pQiIsCi0J
CSJHaUIiLAotCQkiVGlCIiwKLQkJIlBpQiIsCi0JCU5VTEwsCi0JfSwgKipvID0gb3JkZXI7Ci0K
LQl3aGlsZSAodiA+IDEwMjQgJiYgb1sxXSkgewotCQl2IC89IDEwMjQ7Ci0JCW8rKzsKLQl9Ci0J
c3ByaW50ZihidWYsICIlLjFmJXMvcyIsIHYsICpvKTsKLQlyZXR1cm4gYnVmOwotfQotCi1zdGF0
aWMgaW50IGRjbXAoY29uc3Qgdm9pZCAqQSwgY29uc3Qgdm9pZCAqQikKLXsKLQljb25zdCBkb3Vi
bGUgKmEgPSBBLCAqYiA9IEI7Ci0JaWYgKCphIDwgKmIpCi0JCXJldHVybiAtMTsKLQllbHNlIGlm
ICgqYSA+ICpiKQotCQlyZXR1cm4gMTsKLQllbHNlCi0JCXJldHVybiAwOwotfQotCi1zdGF0aWMg
dm9pZCBydW4oaW50IGZkLCBpbnQgb2JqZWN0X3NpemUsIGJvb2wgZHVtYikKLXsKLQlzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX2V4ZWNidWZmZXIyIGV4ZWNidWY7Ci0Jc3RydWN0IGRybV9pOTE1X2dlbV9l
eGVjX29iamVjdDIgZXhlY1szXTsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX3JlbG9jYXRpb25fZW50
cnkgcmVsb2NbNF07Ci0JdWludDMyX3QgYnVmWzIwXTsKLQl1aW50MzJfdCBoYW5kbGUsIHNyYywg
ZHN0OwotCWludCBsZW4sIGNvdW50OwotCWludCByaW5nOwotCi0JaWYgKGR1bWIpCi0JCWhhbmRs
ZSA9IGttc3Rlc3RfZHVtYl9jcmVhdGUoZmQsIDMyLCAzMiwgMzIsIE5VTEwsIE5VTEwpOwotCWVs
c2UKLQkJaGFuZGxlID0gZ2VtX2NyZWF0ZShmZCwgNDA5Nik7Ci0KLQlzcmMgPSBnZW1fY3JlYXRl
KGZkLCBvYmplY3Rfc2l6ZSk7Ci0JZHN0ID0gZ2VtX2NyZWF0ZShmZCwgb2JqZWN0X3NpemUpOwot
Ci0JbGVuID0gZ2VtX2xpbmVhcl9ibHQoZmQsIGJ1ZiwgMCwgMSwgb2JqZWN0X3NpemUsIHJlbG9j
KTsKLQlnZW1fd3JpdGUoZmQsIGhhbmRsZSwgMCwgYnVmLCBsZW4pOwotCi0JbWVtc2V0KGV4ZWMs
IDAsIHNpemVvZihleGVjKSk7Ci0JZXhlY1swXS5oYW5kbGUgPSBzcmM7Ci0JZXhlY1sxXS5oYW5k
bGUgPSBkc3Q7Ci0KLQlleGVjWzJdLmhhbmRsZSA9IGhhbmRsZTsKLQlpZiAoaW50ZWxfZ2VuKGlu
dGVsX2dldF9kcm1fZGV2aWQoZmQpKSA+PSA4KQotCQlleGVjWzJdLnJlbG9jYXRpb25fY291bnQg
PSBsZW4gPiA1NiA/IDQgOiAyOwotCWVsc2UKLQkJZXhlY1syXS5yZWxvY2F0aW9uX2NvdW50ID0g
bGVuID4gNDAgPyA0IDogMjsKLQlleGVjWzJdLnJlbG9jc19wdHIgPSB0b191c2VyX3BvaW50ZXIo
cmVsb2MpOwotCi0JcmluZyA9IDA7Ci0JaWYgKEhBU19CTFRfUklORyhpbnRlbF9nZXRfZHJtX2Rl
dmlkKGZkKSkpCi0JCXJpbmcgPSBJOTE1X0VYRUNfQkxUOwotCi0JbWVtc2V0KCZleGVjYnVmLCAw
LCBzaXplb2YoZXhlY2J1ZikpOwotCWV4ZWNidWYuYnVmZmVyc19wdHIgPSB0b191c2VyX3BvaW50
ZXIoZXhlYyk7Ci0JZXhlY2J1Zi5idWZmZXJfY291bnQgPSAzOwotCWV4ZWNidWYuYmF0Y2hfbGVu
ID0gbGVuOwotCWV4ZWNidWYuZmxhZ3MgPSByaW5nOwotCWV4ZWNidWYuZmxhZ3MgfD0gTE9DQUxf
STkxNV9FWEVDX0hBTkRMRV9MVVQ7Ci0JZXhlY2J1Zi5mbGFncyB8PSBMT0NBTF9JOTE1X0VYRUNf
Tk9fUkVMT0M7Ci0KLQlpZiAoX19nZW1fZXhlY2J1ZihmZCwgJmV4ZWNidWYpKSB7Ci0JCWxlbiA9
IGdlbV9saW5lYXJfYmx0KGZkLCBidWYsIHNyYywgZHN0LCBvYmplY3Rfc2l6ZSwgcmVsb2MpOwot
CQlpZ3RfYXNzZXJ0KGxlbiA9PSBleGVjYnVmLmJhdGNoX2xlbik7Ci0JCWdlbV93cml0ZShmZCwg
aGFuZGxlLCAwLCBidWYsIGxlbik7Ci0JCWV4ZWNidWYuZmxhZ3MgPSByaW5nOwotCQlnZW1fZXhl
Y2J1ZihmZCwgJmV4ZWNidWYpOwotCX0KLQlnZW1fc3luYyhmZCwgaGFuZGxlKTsKLQotCWZvciAo
Y291bnQgPSAxOyBjb3VudCA8PSAxPDwxMjsgY291bnQgPDw9IDEpIHsKLQkJc3RydWN0IHRpbWV2
YWwgc3RhcnQsIGVuZDsKLQkJY29uc3QgaW50IHJlcHMgPSA5OwotCQlkb3VibGUgdFtyZXBzXSwg
c3VtOwotCQlpbnQgbjsKLQotCQlmb3IgKG4gPSAwOyBuIDwgcmVwczsgbisrKSB7Ci0JCQlnZXR0
aW1lb2ZkYXkoJnN0YXJ0LCBOVUxMKTsKLQkJCWZvciAoaW50IGxvb3AgPSAwOyBsb29wIDwgY291
bnQ7IGxvb3ArKykKLQkJCQlnZW1fZXhlY2J1ZihmZCwgJmV4ZWNidWYpOwotCQkJZ2VtX3N5bmMo
ZmQsIGhhbmRsZSk7Ci0JCQlnZXR0aW1lb2ZkYXkoJmVuZCwgTlVMTCk7Ci0JCQl0W25dID0gZWxh
cHNlZCgmc3RhcnQsICZlbmQsIGNvdW50KTsKLQkJfQotCQlxc29ydCh0LCBuLCBzaXplb2YoZG91
YmxlKSwgZGNtcCk7Ci0JCXN1bSA9IDA7Ci0JCWZvciAobiA9IDI7IG4gPCByZXBzIC0gMjsgbisr
KQotCQkJc3VtICs9IHRbbl07Ci0JCXN1bSAvPSByZXBzIC0gNDsKLQkJaWd0X2luZm8oIlRpbWUg
dG8gYmx0ICVkIGJ5dGVzIHggJTZkOgklNy4zZsK1cywgJXNcbiIsCi0JCQkgb2JqZWN0X3NpemUs
IGNvdW50LCBzdW0sCi0JCQkgYnl0ZXNfcGVyX3NlYygoY2hhciAqKWJ1Ziwgb2JqZWN0X3NpemUv
c3VtKjFlNikpOwotCQlmZmx1c2goc3Rkb3V0KTsKLQl9Ci0JZ2VtX2Nsb3NlKGZkLCBoYW5kbGUp
OwotfQotCi1zdGF0aWMgdm9pZCBzZXRfYXV0b19mcmVxKGludCBzeXNmcykKLXsKLQlpbnQgbWlu
ID0gaWd0X3N5c2ZzX2dldF91MzIoc3lzZnMsICJndF9SUG5fZnJlcV9taHoiKTsKLQlpbnQgbWF4
ID0gaWd0X3N5c2ZzX2dldF91MzIoc3lzZnMsICJndF9SUDBfZnJlcV9taHoiKTsKLQlpZiAobWF4
IDw9IG1pbikKLQkJcmV0dXJuOwotCi0JaWd0X2RlYnVnKCJTZXR0aW5nIG1pbiB0byAlZE1Ieiwg
YW5kIG1heCB0byAlZE1IelxuIiwgbWluLCBtYXgpOwotCWlndF9zeXNmc19zZXRfdTMyKHN5c2Zz
LCAiZ3RfbWluX2ZyZXFfbWh6IiwgbWluKTsKLQlpZ3Rfc3lzZnNfc2V0X3UzMihzeXNmcywgImd0
X21heF9mcmVxX21oeiIsIG1heCk7Ci19Ci0KLXN0YXRpYyB2b2lkIHNldF9taW5fZnJlcShpbnQg
c3lzZnMpCi17Ci0JaW50IG1pbiA9IGlndF9zeXNmc19nZXRfdTMyKHN5c2ZzLCAiZ3RfUlBuX2Zy
ZXFfbWh6Iik7Ci0JaWd0X3JlcXVpcmUobWluID4gMCk7Ci0JaWd0X2RlYnVnKCJTZXR0aW5nIG1p
bi9tYXggdG8gJWRNSHpcbiIsIG1pbik7Ci0JaWd0X3JlcXVpcmUoaWd0X3N5c2ZzX3NldF91MzIo
c3lzZnMsICJndF9taW5fZnJlcV9taHoiLCBtaW4pICYmCi0JCSAgICBpZ3Rfc3lzZnNfc2V0X3Uz
MihzeXNmcywgImd0X21heF9mcmVxX21oeiIsIG1pbikpOwotfQotCi1zdGF0aWMgdm9pZCBzZXRf
bWF4X2ZyZXEoaW50IHN5c2ZzKQotewotCWludCBtYXggPSBpZ3Rfc3lzZnNfZ2V0X3UzMihzeXNm
cywgImd0X1JQMF9mcmVxX21oeiIpOwotCWlndF9yZXF1aXJlKG1heCA+IDApOwotCWlndF9kZWJ1
ZygiU2V0dGluZyBtaW4vbWF4IHRvICVkTUh6XG4iLCBtYXgpOwotCWlndF9yZXF1aXJlKGlndF9z
eXNmc19zZXRfdTMyKHN5c2ZzLCAiZ3RfbWF4X2ZyZXFfbWh6IiwgbWF4KSAmJgotCQkgICAgaWd0
X3N5c2ZzX3NldF91MzIoc3lzZnMsICJndF9taW5fZnJlcV9taHoiLCBtYXgpKTsKLX0KLQotCi1p
Z3RfbWFpbgotewotCWNvbnN0IHN0cnVjdCB7Ci0JCWNvbnN0IGNoYXIgKnN1ZmZpeDsKLQkJdm9p
ZCAoKmZ1bmMpKGludCk7Ci0JfSBycHNbXSA9IHsKLQkJeyAiIiwgc2V0X2F1dG9fZnJlcSB9LAot
CQl7ICItbWluIiwgc2V0X21pbl9mcmVxIH0sCi0JCXsgIi1tYXgiLCBzZXRfbWF4X2ZyZXEgfSwK
LQkJeyBOVUxMLCBOVUxMIH0sCi0JfSwgKnI7Ci0JaW50IG1pbiA9IC0xLCBtYXggPSAtMTsKLQlp
bnQgZmQsIHN5c2ZzOwotCi0JaWd0X3NraXBfb25fc2ltdWxhdGlvbigpOwotCi0JaWd0X2ZpeHR1
cmUgewotCQlmZCA9IGRybV9vcGVuX2RyaXZlcihEUklWRVJfSU5URUwpOwotCQlpZ3RfcmVxdWly
ZV9nZW0oZmQpOwotCQlnZW1fcmVxdWlyZV9ibGl0dGVyKGZkKTsKLQotCQlzeXNmcyA9IGlndF9z
eXNmc19vcGVuKGZkKTsKLQkJaWd0X3JlcXVpcmUoc3lzZnMgPj0gMCk7Ci0KLQkJbWluID0gaWd0
X3N5c2ZzX2dldF91MzIoc3lzZnMsICJndF9taW5fZnJlcV9taHoiKTsKLQkJbWF4ID0gaWd0X3N5
c2ZzX2dldF91MzIoc3lzZnMsICJndF9tYXhfZnJlcV9taHoiKTsKLQl9Ci0KLQlmb3IgKHIgPSBy
cHM7IHItPnN1ZmZpeDsgcisrKSB7Ci0JCWlndF9maXh0dXJlIHItPmZ1bmMoc3lzZnMpOwotCi0J
CWlndF9zdWJ0ZXN0X2YoImNvbGQlcyIsIHItPnN1ZmZpeCkKLQkJCXJ1bihmZCwgT0JKRUNUX1NJ
WkUsIGZhbHNlKTsKLQotCQlpZ3Rfc3VidGVzdF9mKCJub3JtYWwlcyIsIHItPnN1ZmZpeCkKLQkJ
CXJ1bihmZCwgT0JKRUNUX1NJWkUsIGZhbHNlKTsKLQotCQlpZ3Rfc3VidGVzdF9mKCJkdW1iLWJ1
ZiVzIiwgci0+c3VmZml4KQotCQkJcnVuKGZkLCBPQkpFQ1RfU0laRSwgdHJ1ZSk7Ci0JfQotCi0J
aWd0X2ZpeHR1cmUgewotCQlpZiAobWluID4gMCkKLQkJCWlndF9zeXNmc19zZXRfdTMyKHN5c2Zz
LCAiZ3RfbWluX2ZyZXFfbWh6IiwgbWluKTsKLQkJaWYgKG1heCA+IDApCi0JCQlpZ3Rfc3lzZnNf
c2V0X3UzMihzeXNmcywgImd0X21heF9mcmVxX21oeiIsIG1heCk7Ci0KLQkJY2xvc2Uoc3lzZnMp
OwotCQljbG9zZShmZCk7Ci0JfQotfQpkaWZmIC0tZ2l0IGEvdGVzdHMvbWVzb24uYnVpbGQgYi90
ZXN0cy9tZXNvbi5idWlsZAppbmRleCA5ZGZjZjIwN2UuLjU5YzY5NjFmMSAxMDA2NDQKLS0tIGEv
dGVzdHMvbWVzb24uYnVpbGQKKysrIGIvdGVzdHMvbWVzb24uYnVpbGQKQEAgLTEzNSw3ICsxMzUs
NiBAQCBpOTE1X3Byb2dzID0gWwogCSdnZW1fZXhlY19iYWRfZG9tYWlucycsCiAJJ2dlbV9leGVj
X2Jhc2ljJywKIAknZ2VtX2V4ZWNfYmlnJywKLQknZ2VtX2V4ZWNfYmx0JywKIAknZ2VtX2V4ZWNf
Y2FwdHVyZScsCiAJJ2dlbV9leGVjX2NyZWF0ZScsCiAJJ2dlbV9leGVjX2ZhdWx0aW5nX3JlbG9j
JywKLS0gCjIuMjQuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Au
b3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwt
Z2Z4

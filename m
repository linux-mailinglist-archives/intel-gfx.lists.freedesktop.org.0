Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 2FE7466186
	for <lists+intel-gfx@lfdr.de>; Fri, 12 Jul 2019 00:20:38 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 5AFE26E294;
	Thu, 11 Jul 2019 22:20:36 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 4645D6E294
 for <intel-gfx@lists.freedesktop.org>; Thu, 11 Jul 2019 22:20:35 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 17233810-1500050 
 for <intel-gfx@lists.freedesktop.org>; Thu, 11 Jul 2019 23:20:31 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 11 Jul 2019 23:20:30 +0100
Message-Id: <20190711222030.18442-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.22.0
MIME-Version: 1.0
Subject: [Intel-gfx] [CI] drm/i915/gtt: Use shallow dma pages for scratch
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2Ugb25seSB1c2UgdGhlIGRtYSBwYWdlcyBmb3Igc2NyYXRjaCwgYW5kIHNvIGRvIG5vdCBuZWVk
IHRvIGFsbG9jYXRlCnRoZSBleHRyYSBzdG9yYWdlIGZvciB0aGUgc2hhZG93IHBhZ2UgZGlyZWN0
b3J5LgoKdjI6IFJlZnJhaW4gZnJvbSByZWludHJvZHVjaW5nIEk5MTVfUERFUwoKU2lnbmVkLW9m
Zi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBNaWthIEt1
b3BwYWxhIDxtaWthLmt1b3BwYWxhQGxpbnV4LmludGVsLmNvbT4KUmV2aWV3ZWQtYnk6IE1pa2Eg
S3VvcHBhbGEgPG1pa2Eua3VvcHBhbGFAbGludXguaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jIHwgMTk2ICsrKysrKysrKysrKy0tLS0tLS0tLS0tLS0t
LS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oIHwgIDIzICsrKy0KIDIgZmls
ZXMgY2hhbmdlZCwgMTAwIGluc2VydGlvbnMoKyksIDExOSBkZWxldGlvbnMoLSkKCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtX2d0dC5jCmluZGV4IDIzNmM5NjRkZDc2MS4uMWE5NGJiZGRjNDY3IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwpAQCAtNTk0LDI2ICs1OTQsMTcgQEAgc3Rh
dGljIHZvaWQgY2xlYW51cF9wYWdlX2RtYShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwK
IAogI2RlZmluZSBrbWFwX2F0b21pY19weChweCkga21hcF9hdG9taWMocHhfYmFzZShweCktPnBh
Z2UpCiAKLSNkZWZpbmUgZmlsbF9weCh2bSwgcHgsIHYpIGZpbGxfcGFnZV9kbWEoKHZtKSwgcHhf
YmFzZShweCksICh2KSkKLSNkZWZpbmUgZmlsbDMyX3B4KHZtLCBweCwgdikgZmlsbF9wYWdlX2Rt
YV8zMigodm0pLCBweF9iYXNlKHB4KSwgKHYpKQotCi1zdGF0aWMgdm9pZCBmaWxsX3BhZ2VfZG1h
KHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAotCQkJICBzdHJ1Y3QgaTkxNV9wYWdlX2Rt
YSAqcCwKLQkJCSAgY29uc3QgdTY0IHZhbCkKK3N0YXRpYyB2b2lkCitmaWxsX3BhZ2VfZG1hKGNv
bnN0IHN0cnVjdCBpOTE1X3BhZ2VfZG1hICpwLCBjb25zdCB1NjQgdmFsLCB1bnNpZ25lZCBpbnQg
Y291bnQpCiB7Ci0JdTY0ICogY29uc3QgdmFkZHIgPSBrbWFwX2F0b21pYyhwLT5wYWdlKTsKLQot
CW1lbXNldDY0KHZhZGRyLCB2YWwsIFBBR0VfU0laRSAvIHNpemVvZih2YWwpKTsKLQotCWt1bm1h
cF9hdG9taWModmFkZHIpOworCWt1bm1hcF9hdG9taWMobWVtc2V0NjQoa21hcF9hdG9taWMocC0+
cGFnZSksIHZhbCwgY291bnQpKTsKIH0KIAotc3RhdGljIHZvaWQgZmlsbF9wYWdlX2RtYV8zMihz
dHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKLQkJCSAgICAgc3RydWN0IGk5MTVfcGFnZV9k
bWEgKnAsCi0JCQkgICAgIGNvbnN0IHUzMiB2KQotewotCWZpbGxfcGFnZV9kbWEodm0sIHAsICh1
NjQpdiA8PCAzMiB8IHYpOwotfQorI2RlZmluZSBmaWxsX3B4KHB4LCB2KSBmaWxsX3BhZ2VfZG1h
KHB4X2Jhc2UocHgpLCAodiksIFBBR0VfU0laRSAvIHNpemVvZih1NjQpKQorI2RlZmluZSBmaWxs
MzJfcHgocHgsIHYpIGRvIHsJCQkJCQlcCisJdTY0IHZfXyA9IGxvd2VyXzMyX2JpdHModik7CQkJ
CQlcCisJZmlsbF9weCgocHgpLCB2X18gPDwgMzIgfCB2X18pOwkJCQkJXAorfSB3aGlsZSAoMCkK
IAogc3RhdGljIGludAogc2V0dXBfc2NyYXRjaF9wYWdlKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3Bh
Y2UgKnZtLCBnZnBfdCBnZnApCkBAIC02ODcsNiArNjc4LDIxIEBAIHN0YXRpYyB2b2lkIGNsZWFu
dXBfc2NyYXRjaF9wYWdlKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogCV9fZnJlZV9w
YWdlcyhwLT5wYWdlLCBvcmRlcik7CiB9CiAKK3N0YXRpYyB2b2lkIGZyZWVfc2NyYXRjaChzdHJ1
Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKK3sKKwlpZiAoIXZtLT5zY3JhdGNoX3BhZ2UuZGFk
ZHIpIC8qIHNldCB0byAwIG9uIGNsb25lcyAqLworCQlyZXR1cm47CisKKwlpZiAodm0tPnNjcmF0
Y2hfcGRwLmRhZGRyKQorCQljbGVhbnVwX3BhZ2VfZG1hKHZtLCAmdm0tPnNjcmF0Y2hfcGRwKTsK
KwlpZiAodm0tPnNjcmF0Y2hfcGQuZGFkZHIpCisJCWNsZWFudXBfcGFnZV9kbWEodm0sICZ2bS0+
c2NyYXRjaF9wZCk7CisJaWYgKHZtLT5zY3JhdGNoX3B0LmRhZGRyKQorCQljbGVhbnVwX3BhZ2Vf
ZG1hKHZtLCAmdm0tPnNjcmF0Y2hfcHQpOworCisJY2xlYW51cF9zY3JhdGNoX3BhZ2Uodm0pOwor
fQorCiBzdGF0aWMgc3RydWN0IGk5MTVfcGFnZV90YWJsZSAqYWxsb2NfcHQoc3RydWN0IGk5MTVf
YWRkcmVzc19zcGFjZSAqdm0pCiB7CiAJc3RydWN0IGk5MTVfcGFnZV90YWJsZSAqcHQ7CkBAIC03
MTEsMTggKzcxNyw2IEBAIHN0YXRpYyB2b2lkIGZyZWVfcHQoc3RydWN0IGk5MTVfYWRkcmVzc19z
cGFjZSAqdm0sIHN0cnVjdCBpOTE1X3BhZ2VfdGFibGUgKnB0KQogCWtmcmVlKHB0KTsKIH0KIAot
c3RhdGljIHZvaWQgZ2VuOF9pbml0aWFsaXplX3B0KHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2Ug
KnZtLAotCQkJICAgICAgIHN0cnVjdCBpOTE1X3BhZ2VfdGFibGUgKnB0KQotewotCWZpbGxfcHgo
dm0sIHB0LCB2bS0+c2NyYXRjaF9wdGUpOwotfQotCi1zdGF0aWMgdm9pZCBnZW42X2luaXRpYWxp
emVfcHQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCi0JCQkgICAgICAgc3RydWN0IGk5
MTVfcGFnZV90YWJsZSAqcHQpCi17Ci0JZmlsbDMyX3B4KHZtLCBwdCwgdm0tPnNjcmF0Y2hfcHRl
KTsKLX0KLQogc3RhdGljIHN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICpfX2FsbG9jX3BkKHZv
aWQpCiB7CiAJc3RydWN0IGk5MTVfcGFnZV9kaXJlY3RvcnkgKnBkOwpAQCAtNzY1LDkgKzc1OSwx
MSBAQCBzdGF0aWMgdm9pZCBmcmVlX3BkKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAog
CWtmcmVlKHBkKTsKIH0KIAotI2RlZmluZSBpbml0X3BkKHZtLCBwZCwgdG8pIHsJCQkJCVwKLQlm
aWxsX3B4KCh2bSksIChwZCksIGdlbjhfcGRlX2VuY29kZShweF9kbWEodG8pLCBJOTE1X0NBQ0hF
X0xMQykpOyBcCi0JbWVtc2V0X3AoKHBkKS0+ZW50cnksICh0byksIDUxMik7CQkJCVwKK3N0YXRp
YyB2b2lkIGluaXRfcGQoc3RydWN0IGk5MTVfcGFnZV9kaXJlY3RvcnkgKnBkLAorCQkgICAgc3Ry
dWN0IGk5MTVfcGFnZV9kbWEgKnNjcmF0Y2gpCit7CisJZmlsbF9weChwZCwgZ2VuOF9wZGVfZW5j
b2RlKHNjcmF0Y2gtPmRhZGRyLCBJOTE1X0NBQ0hFX0xMQykpOworCW1lbXNldF9wKHBkLT5lbnRy
eSwgc2NyYXRjaCwgNTEyKTsKIH0KIAogc3RhdGljIGlubGluZSB2b2lkCkBAIC04NjksMTIgKzg2
NSwxMSBAQCBzdGF0aWMgdm9pZCBnZW44X3BwZ3R0X2NsZWFyX3BkKHN0cnVjdCBpOTE1X2FkZHJl
c3Nfc3BhY2UgKnZtLAogCXUzMiBwZGU7CiAKIAlnZW44X2Zvcl9lYWNoX3BkZShwdCwgcGQsIHN0
YXJ0LCBsZW5ndGgsIHBkZSkgewotCQlHRU1fQlVHX09OKHB0ID09IHZtLT5zY3JhdGNoX3B0KTsK
KwkJR0VNX0JVR19PTihweF9iYXNlKHB0KSA9PSAmdm0tPnNjcmF0Y2hfcHQpOwogCiAJCWF0b21p
Y19pbmMoJnB0LT51c2VkKTsKIAkJZ2VuOF9wcGd0dF9jbGVhcl9wdCh2bSwgcHQsIHN0YXJ0LCBs
ZW5ndGgpOwotCQlpZiAocmVsZWFzZV9wZF9lbnRyeShwZCwgcGRlLCAmcHQtPnVzZWQsCi0JCQkJ
ICAgICBweF9iYXNlKHZtLT5zY3JhdGNoX3B0KSkpCisJCWlmIChyZWxlYXNlX3BkX2VudHJ5KHBk
LCBwZGUsICZwdC0+dXNlZCwgJnZtLT5zY3JhdGNoX3B0KSkKIAkJCWZyZWVfcHQodm0sIHB0KTsK
IAl9CiB9CkBAIC04OTAsMTIgKzg4NSwxMSBAQCBzdGF0aWMgdm9pZCBnZW44X3BwZ3R0X2NsZWFy
X3BkcChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAl1bnNpZ25lZCBpbnQgcGRwZTsK
IAogCWdlbjhfZm9yX2VhY2hfcGRwZShwZCwgcGRwLCBzdGFydCwgbGVuZ3RoLCBwZHBlKSB7Ci0J
CUdFTV9CVUdfT04ocGQgPT0gdm0tPnNjcmF0Y2hfcGQpOworCQlHRU1fQlVHX09OKHB4X2Jhc2Uo
cGQpID09ICZ2bS0+c2NyYXRjaF9wZCk7CiAKIAkJYXRvbWljX2luYygmcGQtPnVzZWQpOwogCQln
ZW44X3BwZ3R0X2NsZWFyX3BkKHZtLCBwZCwgc3RhcnQsIGxlbmd0aCk7Ci0JCWlmIChyZWxlYXNl
X3BkX2VudHJ5KHBkcCwgcGRwZSwgJnBkLT51c2VkLAotCQkJCSAgICAgcHhfYmFzZSh2bS0+c2Ny
YXRjaF9wZCkpKQorCQlpZiAocmVsZWFzZV9wZF9lbnRyeShwZHAsIHBkcGUsICZwZC0+dXNlZCwg
JnZtLT5zY3JhdGNoX3BkKSkKIAkJCWZyZWVfcGQodm0sIHBkKTsKIAl9CiB9CkBAIC05MjEsMTIg
KzkxNSwxMSBAQCBzdGF0aWMgdm9pZCBnZW44X3BwZ3R0X2NsZWFyXzRsdmwoc3RydWN0IGk5MTVf
YWRkcmVzc19zcGFjZSAqdm0sCiAJR0VNX0JVR19PTighaTkxNV92bV9pc180bHZsKHZtKSk7CiAK
IAlnZW44X2Zvcl9lYWNoX3BtbDRlKHBkcCwgcG1sNCwgc3RhcnQsIGxlbmd0aCwgcG1sNGUpIHsK
LQkJR0VNX0JVR19PTihwZHAgPT0gdm0tPnNjcmF0Y2hfcGRwKTsKKwkJR0VNX0JVR19PTihweF9i
YXNlKHBkcCkgPT0gJnZtLT5zY3JhdGNoX3BkcCk7CiAKIAkJYXRvbWljX2luYygmcGRwLT51c2Vk
KTsKIAkJZ2VuOF9wcGd0dF9jbGVhcl9wZHAodm0sIHBkcCwgc3RhcnQsIGxlbmd0aCk7Ci0JCWlm
IChyZWxlYXNlX3BkX2VudHJ5KHBtbDQsIHBtbDRlLCAmcGRwLT51c2VkLAotCQkJCSAgICAgcHhf
YmFzZSh2bS0+c2NyYXRjaF9wZHApKSkKKwkJaWYgKHJlbGVhc2VfcGRfZW50cnkocG1sNCwgcG1s
NGUsICZwZHAtPnVzZWQsICZ2bS0+c2NyYXRjaF9wZHApKQogCQkJZnJlZV9wZCh2bSwgcGRwKTsK
IAl9CiB9CkBAIC0xMTgxLDcgKzExNzQsNyBAQCBzdGF0aWMgdm9pZCBnZW44X2ZyZWVfcGFnZV90
YWJsZXMoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJaW50IGk7CiAKIAlmb3IgKGkg
PSAwOyBpIDwgSTkxNV9QREVTOyBpKyspIHsKLQkJaWYgKHBkLT5lbnRyeVtpXSAhPSB2bS0+c2Ny
YXRjaF9wdCkKKwkJaWYgKHBkLT5lbnRyeVtpXSAhPSAmdm0tPnNjcmF0Y2hfcHQpCiAJCQlmcmVl
X3B0KHZtLCBwZC0+ZW50cnlbaV0pOwogCX0KIH0KQEAgLTEyMTgsMzcgKzEyMTEsMzQgQEAgc3Rh
dGljIGludCBnZW44X2luaXRfc2NyYXRjaChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkK
IAkJCQlJOTE1X0NBQ0hFX0xMQywKIAkJCQl2bS0+aGFzX3JlYWRfb25seSk7CiAKLQl2bS0+c2Ny
YXRjaF9wdCA9IGFsbG9jX3B0KHZtKTsKLQlpZiAoSVNfRVJSKHZtLT5zY3JhdGNoX3B0KSkgewot
CQlyZXQgPSBQVFJfRVJSKHZtLT5zY3JhdGNoX3B0KTsKKwlpZiAodW5saWtlbHkoc2V0dXBfcGFn
ZV9kbWEodm0sICZ2bS0+c2NyYXRjaF9wdCkpKSB7CisJCXJldCA9IC1FTk9NRU07CiAJCWdvdG8g
ZnJlZV9zY3JhdGNoX3BhZ2U7CiAJfQorCWZpbGxfcHgoJnZtLT5zY3JhdGNoX3B0LCB2bS0+c2Ny
YXRjaF9wdGUpOwogCi0Jdm0tPnNjcmF0Y2hfcGQgPSBhbGxvY19wZCh2bSk7Ci0JaWYgKElTX0VS
Uih2bS0+c2NyYXRjaF9wZCkpIHsKLQkJcmV0ID0gUFRSX0VSUih2bS0+c2NyYXRjaF9wZCk7CisJ
aWYgKHVubGlrZWx5KHNldHVwX3BhZ2VfZG1hKHZtLCAmdm0tPnNjcmF0Y2hfcGQpKSkgeworCQly
ZXQgPSAtRU5PTUVNOwogCQlnb3RvIGZyZWVfcHQ7CiAJfQorCWZpbGxfcHgoJnZtLT5zY3JhdGNo
X3BkLAorCQlnZW44X3BkZV9lbmNvZGUodm0tPnNjcmF0Y2hfcGQuZGFkZHIsIEk5MTVfQ0FDSEVf
TExDKSk7CiAKIAlpZiAoaTkxNV92bV9pc180bHZsKHZtKSkgewotCQl2bS0+c2NyYXRjaF9wZHAg
PSBhbGxvY19wZCh2bSk7Ci0JCWlmIChJU19FUlIodm0tPnNjcmF0Y2hfcGRwKSkgewotCQkJcmV0
ID0gUFRSX0VSUih2bS0+c2NyYXRjaF9wZHApOworCQlpZiAodW5saWtlbHkoc2V0dXBfcGFnZV9k
bWEodm0sICZ2bS0+c2NyYXRjaF9wZHApKSkgeworCQkJcmV0ID0gLUVOT01FTTsKIAkJCWdvdG8g
ZnJlZV9wZDsKIAkJfQorCQlmaWxsX3B4KCZ2bS0+c2NyYXRjaF9wZHAsCisJCQlnZW44X3BkZV9l
bmNvZGUodm0tPnNjcmF0Y2hfcGRwLmRhZGRyLCBJOTE1X0NBQ0hFX0xMQykpOwogCX0KIAotCWdl
bjhfaW5pdGlhbGl6ZV9wdCh2bSwgdm0tPnNjcmF0Y2hfcHQpOwotCWluaXRfcGQodm0sIHZtLT5z
Y3JhdGNoX3BkLCB2bS0+c2NyYXRjaF9wdCk7Ci0JaWYgKGk5MTVfdm1faXNfNGx2bCh2bSkpCi0J
CWluaXRfcGQodm0sIHZtLT5zY3JhdGNoX3BkcCwgdm0tPnNjcmF0Y2hfcGQpOwotCiAJcmV0dXJu
IDA7CiAKIGZyZWVfcGQ6Ci0JZnJlZV9wZCh2bSwgdm0tPnNjcmF0Y2hfcGQpOworCWNsZWFudXBf
cGFnZV9kbWEodm0sICZ2bS0+c2NyYXRjaF9wZCk7CiBmcmVlX3B0OgotCWZyZWVfcHQodm0sIHZt
LT5zY3JhdGNoX3B0KTsKKwljbGVhbnVwX3BhZ2VfZG1hKHZtLCAmdm0tPnNjcmF0Y2hfcHQpOwog
ZnJlZV9zY3JhdGNoX3BhZ2U6CiAJY2xlYW51cF9zY3JhdGNoX3BhZ2Uodm0pOwogCkBAIC0xMjky
LDE4ICsxMjgyLDYgQEAgc3RhdGljIGludCBnZW44X3BwZ3R0X25vdGlmeV92Z3Qoc3RydWN0IGk5
MTVfcHBndHQgKnBwZ3R0LCBib29sIGNyZWF0ZSkKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGljIHZv
aWQgZ2VuOF9mcmVlX3NjcmF0Y2goc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCi17Ci0J
aWYgKCF2bS0+c2NyYXRjaF9wYWdlLmRhZGRyKQotCQlyZXR1cm47Ci0KLQlpZiAoaTkxNV92bV9p
c180bHZsKHZtKSkKLQkJZnJlZV9wZCh2bSwgdm0tPnNjcmF0Y2hfcGRwKTsKLQlmcmVlX3BkKHZt
LCB2bS0+c2NyYXRjaF9wZCk7Ci0JZnJlZV9wdCh2bSwgdm0tPnNjcmF0Y2hfcHQpOwotCWNsZWFu
dXBfc2NyYXRjaF9wYWdlKHZtKTsKLX0KLQogc3RhdGljIHZvaWQgZ2VuOF9wcGd0dF9jbGVhbnVw
XzNsdmwoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJCQkJICAgIHN0cnVjdCBpOTE1
X3BhZ2VfZGlyZWN0b3J5ICpwZHApCiB7CkBAIC0xMzExLDcgKzEyODksNyBAQCBzdGF0aWMgdm9p
ZCBnZW44X3BwZ3R0X2NsZWFudXBfM2x2bChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwK
IAlpbnQgaTsKIAogCWZvciAoaSA9IDA7IGkgPCBwZHBlczsgaSsrKSB7Ci0JCWlmIChwZHAtPmVu
dHJ5W2ldID09IHZtLT5zY3JhdGNoX3BkKQorCQlpZiAocGRwLT5lbnRyeVtpXSA9PSAmdm0tPnNj
cmF0Y2hfcGQpCiAJCQljb250aW51ZTsKIAogCQlnZW44X2ZyZWVfcGFnZV90YWJsZXModm0sIHBk
cC0+ZW50cnlbaV0pOwpAQCAtMTMyOSw3ICsxMzA3LDcgQEAgc3RhdGljIHZvaWQgZ2VuOF9wcGd0
dF9jbGVhbnVwXzRsdmwoc3RydWN0IGk5MTVfcHBndHQgKnBwZ3R0KQogCWZvciAoaSA9IDA7IGkg
PCBHRU44X1BNTDRFU19QRVJfUE1MNDsgaSsrKSB7CiAJCXN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0
b3J5ICpwZHAgPSBpOTE1X3BkcF9lbnRyeShwbWw0LCBpKTsKIAotCQlpZiAocGRwID09IHBwZ3R0
LT52bS5zY3JhdGNoX3BkcCkKKwkJaWYgKHB4X2Jhc2UocGRwKSA9PSAmcHBndHQtPnZtLnNjcmF0
Y2hfcGRwKQogCQkJY29udGludWU7CiAKIAkJZ2VuOF9wcGd0dF9jbGVhbnVwXzNsdmwoJnBwZ3R0
LT52bSwgcGRwKTsKQEAgLTEzNTEsNyArMTMyOSw3IEBAIHN0YXRpYyB2b2lkIGdlbjhfcHBndHRf
Y2xlYW51cChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIAllbHNlCiAJCWdlbjhfcHBn
dHRfY2xlYW51cF8zbHZsKCZwcGd0dC0+dm0sIHBwZ3R0LT5wZCk7CiAKLQlnZW44X2ZyZWVfc2Ny
YXRjaCh2bSk7CisJZnJlZV9zY3JhdGNoKHZtKTsKIH0KIAogc3RhdGljIGludCBnZW44X3BwZ3R0
X2FsbG9jX3BkKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLApAQCAtMTM2Nyw3ICsxMzQ1
LDcgQEAgc3RhdGljIGludCBnZW44X3BwZ3R0X2FsbG9jX3BkKHN0cnVjdCBpOTE1X2FkZHJlc3Nf
c3BhY2UgKnZtLAogCWdlbjhfZm9yX2VhY2hfcGRlKHB0LCBwZCwgc3RhcnQsIGxlbmd0aCwgcGRl
KSB7CiAJCWNvbnN0IGludCBjb3VudCA9IGdlbjhfcHRlX2NvdW50KHN0YXJ0LCBsZW5ndGgpOwog
Ci0JCWlmIChwdCA9PSB2bS0+c2NyYXRjaF9wdCkgeworCQlpZiAocHhfYmFzZShwdCkgPT0gJnZt
LT5zY3JhdGNoX3B0KSB7CiAJCQlzcGluX3VubG9jaygmcGQtPmxvY2spOwogCiAJCQlwdCA9IGZl
dGNoX2FuZF96ZXJvKCZhbGxvYyk7CkBAIC0xMzc5LDEwICsxMzU3LDEwIEBAIHN0YXRpYyBpbnQg
Z2VuOF9wcGd0dF9hbGxvY19wZChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAkJCX0K
IAogCQkJaWYgKGNvdW50IDwgR0VOOF9QVEVTIHx8IGludGVsX3ZncHVfYWN0aXZlKHZtLT5pOTE1
KSkKLQkJCQlnZW44X2luaXRpYWxpemVfcHQodm0sIHB0KTsKKwkJCQlmaWxsX3B4KHB0LCB2bS0+
c2NyYXRjaF9wdGUpOwogCiAJCQlzcGluX2xvY2soJnBkLT5sb2NrKTsKLQkJCWlmIChwZC0+ZW50
cnlbcGRlXSA9PSB2bS0+c2NyYXRjaF9wdCkgeworCQkJaWYgKHBkLT5lbnRyeVtwZGVdID09ICZ2
bS0+c2NyYXRjaF9wdCkgewogCQkJCXNldF9wZF9lbnRyeShwZCwgcGRlLCBwdCk7CiAJCQl9IGVs
c2UgewogCQkJCWFsbG9jID0gcHQ7CkBAIC0xNDE0LDcgKzEzOTIsNyBAQCBzdGF0aWMgaW50IGdl
bjhfcHBndHRfYWxsb2NfcGRwKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCiAJc3Bp
bl9sb2NrKCZwZHAtPmxvY2spOwogCWdlbjhfZm9yX2VhY2hfcGRwZShwZCwgcGRwLCBzdGFydCwg
bGVuZ3RoLCBwZHBlKSB7Ci0JCWlmIChwZCA9PSB2bS0+c2NyYXRjaF9wZCkgeworCQlpZiAocHhf
YmFzZShwZCkgPT0gJnZtLT5zY3JhdGNoX3BkKSB7CiAJCQlzcGluX3VubG9jaygmcGRwLT5sb2Nr
KTsKIAogCQkJcGQgPSBmZXRjaF9hbmRfemVybygmYWxsb2MpOwpAQCAtMTQyNSwxMCArMTQwMywx
MCBAQCBzdGF0aWMgaW50IGdlbjhfcHBndHRfYWxsb2NfcGRwKHN0cnVjdCBpOTE1X2FkZHJlc3Nf
c3BhY2UgKnZtLAogCQkJCWdvdG8gdW53aW5kOwogCQkJfQogCi0JCQlpbml0X3BkKHZtLCBwZCwg
dm0tPnNjcmF0Y2hfcHQpOworCQkJaW5pdF9wZChwZCwgJnZtLT5zY3JhdGNoX3B0KTsKIAogCQkJ
c3Bpbl9sb2NrKCZwZHAtPmxvY2spOwotCQkJaWYgKHBkcC0+ZW50cnlbcGRwZV0gPT0gdm0tPnNj
cmF0Y2hfcGQpIHsKKwkJCWlmIChwZHAtPmVudHJ5W3BkcGVdID09ICZ2bS0+c2NyYXRjaF9wZCkg
ewogCQkJCXNldF9wZF9lbnRyeShwZHAsIHBkcGUsIHBkKTsKIAkJCX0gZWxzZSB7CiAJCQkJYWxs
b2MgPSBwZDsKQEAgLTE0NDksNyArMTQyNyw3IEBAIHN0YXRpYyBpbnQgZ2VuOF9wcGd0dF9hbGxv
Y19wZHAoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJZ290byBvdXQ7CiAKIHVud2lu
ZF9wZDoKLQlpZiAocmVsZWFzZV9wZF9lbnRyeShwZHAsIHBkcGUsICZwZC0+dXNlZCwgcHhfYmFz
ZSh2bS0+c2NyYXRjaF9wZCkpKQorCWlmIChyZWxlYXNlX3BkX2VudHJ5KHBkcCwgcGRwZSwgJnBk
LT51c2VkLCAmdm0tPnNjcmF0Y2hfcGQpKQogCQlmcmVlX3BkKHZtLCBwZCk7CiB1bndpbmQ6CiAJ
Z2VuOF9wcGd0dF9jbGVhcl9wZHAodm0sIHBkcCwgZnJvbSwgc3RhcnQgLSBmcm9tKTsKQEAgLTE0
NzgsNyArMTQ1Niw3IEBAIHN0YXRpYyBpbnQgZ2VuOF9wcGd0dF9hbGxvY180bHZsKHN0cnVjdCBp
OTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCiAJc3Bpbl9sb2NrKCZwbWw0LT5sb2NrKTsKIAlnZW44
X2Zvcl9lYWNoX3BtbDRlKHBkcCwgcG1sNCwgc3RhcnQsIGxlbmd0aCwgcG1sNGUpIHsKLQkJaWYg
KHBkcCA9PSB2bS0+c2NyYXRjaF9wZHApIHsKKwkJaWYgKHB4X2Jhc2UocGRwKSA9PSAmdm0tPnNj
cmF0Y2hfcGRwKSB7CiAJCQlzcGluX3VubG9jaygmcG1sNC0+bG9jayk7CiAKIAkJCXBkcCA9IGZl
dGNoX2FuZF96ZXJvKCZhbGxvYyk7CkBAIC0xNDg5LDEwICsxNDY3LDEwIEBAIHN0YXRpYyBpbnQg
Z2VuOF9wcGd0dF9hbGxvY180bHZsKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCQkJ
CWdvdG8gdW53aW5kOwogCQkJfQogCi0JCQlpbml0X3BkKHZtLCBwZHAsIHZtLT5zY3JhdGNoX3Bk
KTsKKwkJCWluaXRfcGQocGRwLCAmdm0tPnNjcmF0Y2hfcGQpOwogCiAJCQlzcGluX2xvY2soJnBt
bDQtPmxvY2spOwotCQkJaWYgKHBtbDQtPmVudHJ5W3BtbDRlXSA9PSB2bS0+c2NyYXRjaF9wZHAp
IHsKKwkJCWlmIChwbWw0LT5lbnRyeVtwbWw0ZV0gPT0gJnZtLT5zY3JhdGNoX3BkcCkgewogCQkJ
CXNldF9wZF9lbnRyeShwbWw0LCBwbWw0ZSwgcGRwKTsKIAkJCX0gZWxzZSB7CiAJCQkJYWxsb2Mg
PSBwZHA7CkBAIC0xNTEzLDcgKzE0OTEsNyBAQCBzdGF0aWMgaW50IGdlbjhfcHBndHRfYWxsb2Nf
NGx2bChzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAlnb3RvIG91dDsKIAogdW53aW5k
X3BkcDoKLQlpZiAocmVsZWFzZV9wZF9lbnRyeShwbWw0LCBwbWw0ZSwgJnBkcC0+dXNlZCwgcHhf
YmFzZSh2bS0+c2NyYXRjaF9wZHApKSkKKwlpZiAocmVsZWFzZV9wZF9lbnRyeShwbWw0LCBwbWw0
ZSwgJnBkcC0+dXNlZCwgJnZtLT5zY3JhdGNoX3BkcCkpCiAJCWZyZWVfcGQodm0sIHBkcCk7CiB1
bndpbmQ6CiAJZ2VuOF9wcGd0dF9jbGVhcl80bHZsKHZtLCBmcm9tLCBzdGFydCAtIGZyb20pOwpA
QCAtMTUzNyw3ICsxNTE1LDcgQEAgc3RhdGljIGludCBnZW44X3ByZWFsbG9jYXRlX3RvcF9sZXZl
bF9wZHAoc3RydWN0IGk5MTVfcHBndHQgKnBwZ3R0KQogCQlpZiAoSVNfRVJSKHBkKSkKIAkJCWdv
dG8gdW53aW5kOwogCi0JCWluaXRfcGQodm0sIHBkLCB2bS0+c2NyYXRjaF9wdCk7CisJCWluaXRf
cGQocGQsICZ2bS0+c2NyYXRjaF9wdCk7CiAJCXNldF9wZF9lbnRyeShwZHAsIHBkcGUsIHBkKTsK
IAl9CiAKQEAgLTE1NjgsMTAgKzE1NDYsMTAgQEAgc3RhdGljIHZvaWQgcHBndHRfaW5pdChzdHJ1
Y3QgaTkxNV9wcGd0dCAqcHBndHQsIHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiAKIHN0YXRpYyB2b2lk
IGluaXRfcGRfbihzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAkJICAgICAgc3RydWN0
IGk5MTVfcGFnZV9kaXJlY3RvcnkgKnBkLAotCQkgICAgICBzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVj
dG9yeSAqdG8sCisJCSAgICAgIHN0cnVjdCBpOTE1X3BhZ2VfZG1hICp0bywKIAkJICAgICAgY29u
c3QgdW5zaWduZWQgaW50IGVudHJpZXMpCiB7Ci0JY29uc3QgdTY0IGRhZGRyID0gZ2VuOF9wZGVf
ZW5jb2RlKHB4X2RtYSh0byksIEk5MTVfQ0FDSEVfTExDKTsKKwljb25zdCB1NjQgZGFkZHIgPSBn
ZW44X3BkZV9lbmNvZGUodG8tPmRhZGRyLCBJOTE1X0NBQ0hFX0xMQyk7CiAJdTY0ICogY29uc3Qg
dmFkZHIgPSBrbWFwX2F0b21pYyhwZC0+YmFzZS5wYWdlKTsKIAogCW1lbXNldDY0KHZhZGRyLCBk
YWRkciwgZW50cmllcyk7CkBAIC0xNTg4LDcgKzE1NjYsNyBAQCBnZW44X2FsbG9jX3RvcF9wZChz
dHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIAlpZiAoaTkxNV92bV9pc180bHZsKHZtKSkg
ewogCQlwZCA9IGFsbG9jX3BkKHZtKTsKIAkJaWYgKCFJU19FUlIocGQpKQotCQkJaW5pdF9wZCh2
bSwgcGQsIHZtLT5zY3JhdGNoX3BkcCk7CisJCQlpbml0X3BkKHBkLCAmdm0tPnNjcmF0Y2hfcGRw
KTsKIAogCQlyZXR1cm4gcGQ7CiAJfQpAQCAtMTYwNSw3ICsxNTgzLDcgQEAgZ2VuOF9hbGxvY190
b3BfcGQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiAJCXJldHVybiBFUlJfUFRSKC1F
Tk9NRU0pOwogCX0KIAotCWluaXRfcGRfbih2bSwgcGQsIHZtLT5zY3JhdGNoX3BkLCBHRU44XzNM
VkxfUERQRVMpOworCWluaXRfcGRfbih2bSwgcGQsICZ2bS0+c2NyYXRjaF9wZCwgR0VOOF8zTFZM
X1BEUEVTKTsKIAogCXJldHVybiBwZDsKIH0KQEAgLTE2NzgsNyArMTY1Niw3IEBAIHN0YXRpYyBz
dHJ1Y3QgaTkxNV9wcGd0dCAqZ2VuOF9wcGd0dF9jcmVhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUpCiBlcnJfZnJlZV9wZDoKIAlmcmVlX3BkKCZwcGd0dC0+dm0sIHBwZ3R0LT5wZCk7
CiBlcnJfZnJlZV9zY3JhdGNoOgotCWdlbjhfZnJlZV9zY3JhdGNoKCZwcGd0dC0+dm0pOworCWZy
ZWVfc2NyYXRjaCgmcHBndHQtPnZtKTsKIGVycl9mcmVlOgogCWtmcmVlKHBwZ3R0KTsKIAlyZXR1
cm4gRVJSX1BUUihlcnIpOwpAQCAtMTc2Myw3ICsxNzQxLDcgQEAgc3RhdGljIHZvaWQgZ2VuNl9w
cGd0dF9jbGVhcl9yYW5nZShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAkJY29uc3Qg
dW5zaWduZWQgaW50IGNvdW50ID0gbWluKG51bV9lbnRyaWVzLCBHRU42X1BURVMgLSBwdGUpOwog
CQlnZW42X3B0ZV90ICp2YWRkcjsKIAotCQlHRU1fQlVHX09OKHB0ID09IHZtLT5zY3JhdGNoX3B0
KTsKKwkJR0VNX0JVR19PTihweF9iYXNlKHB0KSA9PSAmdm0tPnNjcmF0Y2hfcHQpOwogCiAJCW51
bV9lbnRyaWVzIC09IGNvdW50OwogCkBAIC0xODAwLDcgKzE3NzgsNyBAQCBzdGF0aWMgdm9pZCBn
ZW42X3BwZ3R0X2luc2VydF9lbnRyaWVzKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAog
CXN0cnVjdCBzZ3RfZG1hIGl0ZXIgPSBzZ3RfZG1hKHZtYSk7CiAJZ2VuNl9wdGVfdCAqdmFkZHI7
CiAKLQlHRU1fQlVHX09OKGk5MTVfcHRfZW50cnkocGQsIGFjdF9wdCkgPT0gdm0tPnNjcmF0Y2hf
cHQpOworCUdFTV9CVUdfT04ocGQtPmVudHJ5W2FjdF9wdF0gPT0gJnZtLT5zY3JhdGNoX3B0KTsK
IAogCXZhZGRyID0ga21hcF9hdG9taWNfcHgoaTkxNV9wdF9lbnRyeShwZCwgYWN0X3B0KSk7CiAJ
ZG8gewpAQCAtMTg0NSw3ICsxODIzLDcgQEAgc3RhdGljIGludCBnZW42X2FsbG9jX3ZhX3Jhbmdl
KHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCWdlbjZfZm9yX2VhY2hfcGRlKHB0LCBw
ZCwgc3RhcnQsIGxlbmd0aCwgcGRlKSB7CiAJCWNvbnN0IHVuc2lnbmVkIGludCBjb3VudCA9IGdl
bjZfcHRlX2NvdW50KHN0YXJ0LCBsZW5ndGgpOwogCi0JCWlmIChwdCA9PSB2bS0+c2NyYXRjaF9w
dCkgeworCQlpZiAocHhfYmFzZShwdCkgPT0gJnZtLT5zY3JhdGNoX3B0KSB7CiAJCQlzcGluX3Vu
bG9jaygmcGQtPmxvY2spOwogCiAJCQlwdCA9IGZldGNoX2FuZF96ZXJvKCZhbGxvYyk7CkBAIC0x
ODU2LDEwICsxODM0LDEwIEBAIHN0YXRpYyBpbnQgZ2VuNl9hbGxvY192YV9yYW5nZShzdHJ1Y3Qg
aTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAkJCQlnb3RvIHVud2luZF9vdXQ7CiAJCQl9CiAKLQkJ
CWdlbjZfaW5pdGlhbGl6ZV9wdCh2bSwgcHQpOworCQkJZmlsbDMyX3B4KHB0LCB2bS0+c2NyYXRj
aF9wdGUpOwogCiAJCQlzcGluX2xvY2soJnBkLT5sb2NrKTsKLQkJCWlmIChwZC0+ZW50cnlbcGRl
XSA9PSB2bS0+c2NyYXRjaF9wdCkgeworCQkJaWYgKHBkLT5lbnRyeVtwZGVdID09ICZ2bS0+c2Ny
YXRjaF9wdCkgewogCQkJCXBkLT5lbnRyeVtwZGVdID0gcHQ7CiAJCQkJaWYgKGk5MTVfdm1hX2lz
X2JvdW5kKHBwZ3R0LT52bWEsCiAJCQkJCQkgICAgICBJOTE1X1ZNQV9HTE9CQUxfQklORCkpIHsK
QEAgLTE5MDgsMjYgKzE4ODYsMTggQEAgc3RhdGljIGludCBnZW42X3BwZ3R0X2luaXRfc2NyYXRj
aChzdHJ1Y3QgZ2VuNl9wcGd0dCAqcHBndHQpCiAJCQkJCSBJOTE1X0NBQ0hFX05PTkUsCiAJCQkJ
CSBQVEVfUkVBRF9PTkxZKTsKIAotCXZtLT5zY3JhdGNoX3B0ID0gYWxsb2NfcHQodm0pOwotCWlm
IChJU19FUlIodm0tPnNjcmF0Y2hfcHQpKSB7CisJaWYgKHVubGlrZWx5KHNldHVwX3BhZ2VfZG1h
KHZtLCAmdm0tPnNjcmF0Y2hfcHQpKSkgewogCQljbGVhbnVwX3NjcmF0Y2hfcGFnZSh2bSk7Ci0J
CXJldHVybiBQVFJfRVJSKHZtLT5zY3JhdGNoX3B0KTsKKwkJcmV0dXJuIC1FTk9NRU07CiAJfQot
Ci0JZ2VuNl9pbml0aWFsaXplX3B0KHZtLCB2bS0+c2NyYXRjaF9wdCk7CisJZmlsbDMyX3B4KCZ2
bS0+c2NyYXRjaF9wdCwgdm0tPnNjcmF0Y2hfcHRlKTsKIAogCWdlbjZfZm9yX2FsbF9wZGVzKHVu
dXNlZCwgcGQsIHBkZSkKLQkJcGQtPmVudHJ5W3BkZV0gPSB2bS0+c2NyYXRjaF9wdDsKKwkJcGQt
PmVudHJ5W3BkZV0gPSAmdm0tPnNjcmF0Y2hfcHQ7CiAKIAlyZXR1cm4gMDsKIH0KIAotc3RhdGlj
IHZvaWQgZ2VuNl9wcGd0dF9mcmVlX3NjcmF0Y2goc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAq
dm0pCi17Ci0JZnJlZV9wdCh2bSwgdm0tPnNjcmF0Y2hfcHQpOwotCWNsZWFudXBfc2NyYXRjaF9w
YWdlKHZtKTsKLX0KLQogc3RhdGljIHZvaWQgZ2VuNl9wcGd0dF9mcmVlX3BkKHN0cnVjdCBnZW42
X3BwZ3R0ICpwcGd0dCkKIHsKIAlzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVjdG9yeSAqIGNvbnN0IHBk
ID0gcHBndHQtPmJhc2UucGQ7CkBAIC0xOTM1LDcgKzE5MDUsNyBAQCBzdGF0aWMgdm9pZCBnZW42
X3BwZ3R0X2ZyZWVfcGQoc3RydWN0IGdlbjZfcHBndHQgKnBwZ3R0KQogCXUzMiBwZGU7CiAKIAln
ZW42X2Zvcl9hbGxfcGRlcyhwdCwgcGQsIHBkZSkKLQkJaWYgKHB0ICE9IHBwZ3R0LT5iYXNlLnZt
LnNjcmF0Y2hfcHQpCisJCWlmIChweF9iYXNlKHB0KSAhPSAmcHBndHQtPmJhc2Uudm0uc2NyYXRj
aF9wdCkKIAkJCWZyZWVfcHQoJnBwZ3R0LT5iYXNlLnZtLCBwdCk7CiB9CiAKQEAgLTE5NTAsNyAr
MTkyMCw3IEBAIHN0YXRpYyB2b2lkIGdlbjZfcHBndHRfY2xlYW51cChzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlICp2bSkKIAltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
CiAJZ2VuNl9wcGd0dF9mcmVlX3BkKHBwZ3R0KTsKLQlnZW42X3BwZ3R0X2ZyZWVfc2NyYXRjaCh2
bSk7CisJZnJlZV9zY3JhdGNoKHZtKTsKIAlrZnJlZShwcGd0dC0+YmFzZS5wZCk7CiB9CiAKQEAg
LTE5OTMsNyArMTk2Myw3IEBAIHN0YXRpYyB2b2lkIHBkX3ZtYV91bmJpbmQoc3RydWN0IGk5MTVf
dm1hICp2bWEpCiB7CiAJc3RydWN0IGdlbjZfcHBndHQgKnBwZ3R0ID0gdm1hLT5wcml2YXRlOwog
CXN0cnVjdCBpOTE1X3BhZ2VfZGlyZWN0b3J5ICogY29uc3QgcGQgPSBwcGd0dC0+YmFzZS5wZDsK
LQlzdHJ1Y3QgaTkxNV9wYWdlX3RhYmxlICogY29uc3Qgc2NyYXRjaF9wdCA9IHBwZ3R0LT5iYXNl
LnZtLnNjcmF0Y2hfcHQ7CisJc3RydWN0IGk5MTVfcGFnZV9kbWEgKiBjb25zdCBzY3JhdGNoID0g
JnBwZ3R0LT5iYXNlLnZtLnNjcmF0Y2hfcHQ7CiAJc3RydWN0IGk5MTVfcGFnZV90YWJsZSAqcHQ7
CiAJdW5zaWduZWQgaW50IHBkZTsKIApAQCAtMjAwMiwxMSArMTk3MiwxMSBAQCBzdGF0aWMgdm9p
ZCBwZF92bWFfdW5iaW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCiAJLyogRnJlZSBhbGwgbm8g
bG9uZ2VyIHVzZWQgcGFnZSB0YWJsZXMgKi8KIAlnZW42X2Zvcl9hbGxfcGRlcyhwdCwgcHBndHQt
PmJhc2UucGQsIHBkZSkgewotCQlpZiAoYXRvbWljX3JlYWQoJnB0LT51c2VkKSB8fCBwdCA9PSBz
Y3JhdGNoX3B0KQorCQlpZiAocHhfYmFzZShwdCkgPT0gc2NyYXRjaCB8fCBhdG9taWNfcmVhZCgm
cHQtPnVzZWQpKQogCQkJY29udGludWU7CiAKIAkJZnJlZV9wdCgmcHBndHQtPmJhc2Uudm0sIHB0
KTsKLQkJcGQtPmVudHJ5W3BkZV0gPSBzY3JhdGNoX3B0OworCQlwZC0+ZW50cnlbcGRlXSA9IHNj
cmF0Y2g7CiAJfQogCiAJcHBndHQtPnNjYW5fZm9yX3VudXNlZF9wdCA9IGZhbHNlOwpAQCAtMjE0
OCw3ICsyMTE4LDcgQEAgc3RhdGljIHN0cnVjdCBpOTE1X3BwZ3R0ICpnZW42X3BwZ3R0X2NyZWF0
ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAlyZXR1cm4gJnBwZ3R0LT5iYXNlOwog
CiBlcnJfc2NyYXRjaDoKLQlnZW42X3BwZ3R0X2ZyZWVfc2NyYXRjaCgmcHBndHQtPmJhc2Uudm0p
OworCWZyZWVfc2NyYXRjaCgmcHBndHQtPmJhc2Uudm0pOwogZXJyX3BkOgogCWtmcmVlKHBwZ3R0
LT5iYXNlLnBkKTsKIGVycl9mcmVlOgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9nZW1fZ3R0LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuaAppbmRl
eCA1N2E2OGVmNGVkYTcuLjkxZDhiNGMyMGM2MSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW1fZ3R0LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1f
Z3R0LmgKQEAgLTI0MCw5ICsyNDAsNiBAQCBzdHJ1Y3QgaTkxNV9wYWdlX2RtYSB7CiAJfTsKIH07
CiAKLSNkZWZpbmUgcHhfYmFzZShweCkgKCYocHgpLT5iYXNlKQotI2RlZmluZSBweF9kbWEocHgp
IChweF9iYXNlKHB4KS0+ZGFkZHIpCi0KIHN0cnVjdCBpOTE1X3BhZ2VfdGFibGUgewogCXN0cnVj
dCBpOTE1X3BhZ2VfZG1hIGJhc2U7CiAJYXRvbWljX3QgdXNlZDsKQEAgLTI1NSw2ICsyNTIsMjAg
QEAgc3RydWN0IGk5MTVfcGFnZV9kaXJlY3RvcnkgewogCXZvaWQgKmVudHJ5WzUxMl07CiB9Owog
CisjZGVmaW5lIF9fcHhfY2hvb3NlX2V4cHIoeCwgdHlwZSwgZXhwciwgb3RoZXIpIFwKKwlfX2J1
aWx0aW5fY2hvb3NlX2V4cHIoIFwKKwlfX2J1aWx0aW5fdHlwZXNfY29tcGF0aWJsZV9wKHR5cGVv
Zih4KSwgdHlwZSkgfHwgXAorCV9fYnVpbHRpbl90eXBlc19jb21wYXRpYmxlX3AodHlwZW9mKHgp
LCBjb25zdCB0eXBlKSwgXAorCSh7IHR5cGUgX194ID0gKHR5cGUpKHgpOyBleHByOyB9KSwgXAor
CW90aGVyKQorCisjZGVmaW5lIHB4X2Jhc2UocHgpIFwKKwlfX3B4X2Nob29zZV9leHByKHB4LCBz
dHJ1Y3QgaTkxNV9wYWdlX2RtYSAqLCBfX3gsIFwKKwlfX3B4X2Nob29zZV9leHByKHB4LCBzdHJ1
Y3QgaTkxNV9wYWdlX3RhYmxlICosICZfX3gtPmJhc2UsIFwKKwlfX3B4X2Nob29zZV9leHByKHB4
LCBzdHJ1Y3QgaTkxNV9wYWdlX2RpcmVjdG9yeSAqLCAmX194LT5iYXNlLCBcCisJKHZvaWQpMCkp
KQorI2RlZmluZSBweF9kbWEocHgpIChweF9iYXNlKHB4KS0+ZGFkZHIpCisKIHN0cnVjdCBpOTE1
X3ZtYV9vcHMgewogCS8qIE1hcCBhbiBvYmplY3QgaW50byBhbiBhZGRyZXNzIHNwYWNlIHdpdGgg
dGhlIGdpdmVuIGNhY2hlIGZsYWdzLiAqLwogCWludCAoKmJpbmRfdm1hKShzdHJ1Y3QgaTkxNV92
bWEgKnZtYSwKQEAgLTMwNCw5ICszMTUsOSBAQCBzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlIHsK
IAl1NjQgc2NyYXRjaF9wdGU7CiAJaW50IHNjcmF0Y2hfb3JkZXI7CiAJc3RydWN0IGk5MTVfcGFn
ZV9kbWEgc2NyYXRjaF9wYWdlOwotCXN0cnVjdCBpOTE1X3BhZ2VfdGFibGUgKnNjcmF0Y2hfcHQ7
Ci0Jc3RydWN0IGk5MTVfcGFnZV9kaXJlY3RvcnkgKnNjcmF0Y2hfcGQ7Ci0Jc3RydWN0IGk5MTVf
cGFnZV9kaXJlY3RvcnkgKnNjcmF0Y2hfcGRwOyAvKiBHRU44KyAmIDQ4YiBQUEdUVCAqLworCXN0
cnVjdCBpOTE1X3BhZ2VfZG1hIHNjcmF0Y2hfcHQ7CisJc3RydWN0IGk5MTVfcGFnZV9kbWEgc2Ny
YXRjaF9wZDsKKwlzdHJ1Y3QgaTkxNV9wYWdlX2RtYSBzY3JhdGNoX3BkcDsgLyogR0VOOCsgJiA0
OGIgUFBHVFQgKi8KIAogCS8qKgogCSAqIExpc3Qgb2Ygdm1hIGN1cnJlbnRseSBib3VuZC4KLS0g
CjIuMjIuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18K
SW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0
dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

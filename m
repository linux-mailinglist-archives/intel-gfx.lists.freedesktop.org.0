Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 18D73ACC8E
	for <lists+intel-gfx@lfdr.de>; Sun,  8 Sep 2019 14:10:37 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 00379896E4;
	Sun,  8 Sep 2019 12:10:35 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 58109896BF;
 Sun,  8 Sep 2019 12:10:31 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18416233-1500050 
 for multiple; Sun, 08 Sep 2019 13:10:25 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Sun,  8 Sep 2019 13:10:24 +0100
Message-Id: <20190908121024.23034-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t] benchmarks/gem_wsim: Cleanup register
 access on exit
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RHJvcCB0aGUgZm9yY2V3YWtlIGJlZm9yZSBsaWJpZ3QgdHJpZXMgdG8gd2FpdCBvbiBpdC4KClNp
Z25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgotLS0K
IGJlbmNobWFya3MvZ2VtX3dzaW0uYyB8IDQ3ICsrKysrKysrKysrKysrKysrKysrKysrLS0tLS0t
LS0tLS0tLS0tLS0tLS0KIDEgZmlsZSBjaGFuZ2VkLCAyNSBpbnNlcnRpb25zKCspLCAyMiBkZWxl
dGlvbnMoLSkKCmRpZmYgLS1naXQgYS9iZW5jaG1hcmtzL2dlbV93c2ltLmMgYi9iZW5jaG1hcmtz
L2dlbV93c2ltLmMKaW5kZXggODdmODczYjBlLi4zMzdlMTNmOTEgMTAwNjQ0Ci0tLSBhL2JlbmNo
bWFya3MvZ2VtX3dzaW0uYworKysgYi9iZW5jaG1hcmtzL2dlbV93c2ltLmMKQEAgLTMwNzIsOCAr
MzA3Miw2IEBAIHN0YXRpYyB2b2lkIGluaXRfY2xvY2tzKHZvaWQpCiAJdWludDMyX3QgcmNzX3N0
YXJ0LCByY3NfZW5kOwogCWRvdWJsZSBvdmVyaGVhZCwgdDsKIAotCWludGVsX3JlZ2lzdGVyX2Fj
Y2Vzc19pbml0KCZtbWlvX2RhdGEsIGludGVsX2dldF9wY2lfZGV2aWNlKCksIGZhbHNlLCBmZCk7
Ci0KIAlpZiAodmVyYm9zZSA8PSAxKQogCQlyZXR1cm47CiAKQEAgLTMxMTQsNiArMzExMiw3IEBA
IGludCBtYWluKGludCBhcmdjLCBjaGFyICoqYXJndikKIAlzdHJ1Y3Qgd19hcmcgKndfYXJncyA9
IE5VTEw7CiAJdW5zaWduZWQgaW50IHRvbGVyYW5jZV9wY3QgPSAxOwogCWNvbnN0IHN0cnVjdCB3
b3JrbG9hZF9iYWxhbmNlciAqYmFsYW5jZXIgPSBOVUxMOworCWludCBleGl0Y29kZSA9IEVYSVRf
RkFJTFVSRTsKIAljaGFyICplbmRwdHIgPSBOVUxMOwogCWludCBwcmlvID0gMDsKIAlkb3VibGUg
dDsKQEAgLTMxMjgsNiArMzEyNyw4IEBAIGludCBtYWluKGludCBhcmdjLCBjaGFyICoqYXJndikK
IAlmZCA9IF9fZHJtX29wZW5fZHJpdmVyKERSSVZFUl9JTlRFTCk7CiAJaWd0X3JlcXVpcmUoZmQp
OwogCisJaW50ZWxfcmVnaXN0ZXJfYWNjZXNzX2luaXQoJm1taW9fZGF0YSwgaW50ZWxfZ2V0X3Bj
aV9kZXZpY2UoKSwgZmFsc2UsIGZkKTsKKwogCWluaXRfY2xvY2tzKCk7CiAKIAltYXN0ZXJfcHJu
ZyA9IHRpbWUoTlVMTCk7CkBAIC0zMTM4LDcgKzMxMzksNyBAQCBpbnQgbWFpbihpbnQgYXJnYywg
Y2hhciAqKmFyZ3YpCiAJCWNhc2UgJ1cnOgogCQkJaWYgKG1hc3Rlcl93b3JrbG9hZCA+PSAwKSB7
CiAJCQkJd3NpbV9lcnIoIk9ubHkgb25lIG1hc3RlciB3b3JrbG9hZCBjYW4gYmUgZ2l2ZW4hXG4i
KTsKLQkJCQlyZXR1cm4gMTsKKwkJCQlnb3RvIGVycjsKIAkJCX0KIAkJCW1hc3Rlcl93b3JrbG9h
ZCA9IG5yX3dfYXJnczsKIAkJCS8qIEZhbGwgdGhyb3VnaCAqLwpAQCAtMzE1Miw3ICszMTUzLDcg
QEAgaW50IG1haW4oaW50IGFyZ2MsIGNoYXIgKiphcmd2KQogCQljYXNlICdhJzoKIAkJCWlmIChh
cHBlbmRfd29ya2xvYWRfYXJnKSB7CiAJCQkJd3NpbV9lcnIoIk9ubHkgb25lIGFwcGVuZCB3b3Jr
bG9hZCBjYW4gYmUgZ2l2ZW4hXG4iKTsKLQkJCQlyZXR1cm4gMTsKKwkJCQlnb3RvIGVycjsKIAkJ
CX0KIAkJCWFwcGVuZF93b3JrbG9hZF9hcmcgPSBvcHRhcmc7CiAJCQlicmVhazsKQEAgLTMyMTcs
NyArMzIxOCw3IEBAIGludCBtYWluKGludCBhcmdjLCBjaGFyICoqYXJndikKIAkJCWlmICghYmFs
YW5jZXIpIHsKIAkJCQl3c2ltX2VycigiVW5rbm93biBiYWxhbmNpbmcgbW9kZSAnJXMnIVxuIiwK
IAkJCQkJIG9wdGFyZyk7Ci0JCQkJcmV0dXJuIDE7CisJCQkJZ290byBlcnI7CiAJCQl9CiAJCQli
cmVhazsKIAkJY2FzZSAnSSc6CkBAIC0zMjI1LDIwICszMjI2LDIwIEBAIGludCBtYWluKGludCBh
cmdjLCBjaGFyICoqYXJndikKIAkJCWJyZWFrOwogCQljYXNlICdoJzoKIAkJCXByaW50X2hlbHAo
KTsKLQkJCXJldHVybiAwOworCQkJZ290byBvdXQ7CiAJCWRlZmF1bHQ6Ci0JCQlyZXR1cm4gMTsK
KwkJCWdvdG8gZXJyOwogCQl9CiAJfQogCiAJaWYgKChmbGFncyAmIEhFQVJUQkVBVCkgJiYgIShm
bGFncyAmIFNFUU5PKSkgewogCQl3c2ltX2VycigiSGVhcnRiZWF0IG5lZWRzIGEgc2Vxbm8gYmFz
ZWQgYmFsYW5jZXIhXG4iKTsKLQkJcmV0dXJuIDE7CisJCWdvdG8gZXJyOwogCX0KIAogCWlmICgo
ZmxhZ3MgJiBWQ1MyUkVNQVApICYmIChmbGFncyAmIEk5MTUpKSB7CiAJCXdzaW1fZXJyKCJWQ1Mg
cmVtYXBwaW5nIG5vdCBzdXBwb3J0ZWQgd2l0aCBpOTE1IGJhbGFuY2luZyFcbiIpOwotCQlyZXR1
cm4gMTsKKwkJZ290byBlcnI7CiAJfQogCiAJaWYgKCFub3BfY2FsaWJyYXRpb24pIHsKQEAgLTMy
NTAsMjkgKzMyNTEsMjkgQEAgaW50IG1haW4oaW50IGFyZ2MsIGNoYXIgKiphcmd2KQogCQkJcHJp
bnRmKCJOb3AgY2FsaWJyYXRpb24gZm9yICV1dXMgZGVsYXkgaXMgJWx1LlxuIiwKIAkJCSAgICAg
ICBub3BfY2FsaWJyYXRpb25fdXMsIG5vcF9jYWxpYnJhdGlvbik7CiAKLQkJcmV0dXJuIDA7CisJ
CWdvdG8gb3V0OwogCX0KIAogCWlmICghbnJfd19hcmdzKSB7CiAJCXdzaW1fZXJyKCJObyB3b3Jr
bG9hZCBkZXNjcmlwdG9yKHMpIVxuIik7Ci0JCXJldHVybiAxOworCQlnb3RvIGVycjsKIAl9CiAK
IAlpZiAobnJfd19hcmdzID4gMSAmJiBjbGllbnRzID4gMSkgewogCQl3c2ltX2VycigiQ2xvbmVk
IGNsaWVudHMgY2Fubm90IGJlIGNvbWJpbmVkIHdpdGggbXVsdGlwbGUgd29ya2xvYWRzIVxuIik7
Ci0JCXJldHVybiAxOworCQlnb3RvIGVycjsKIAl9CiAKIAlpZiAoKGZsYWdzICYgR0xPQkFMX0JB
TEFOQ0UpICYmICFiYWxhbmNlcikgewogCQl3c2ltX2VycigiQmFsYW5jZXIgbm90IHNwZWNpZmll
ZCBpbiBnbG9iYWwgYmFsYW5jaW5nIG1vZGUhXG4iKTsKLQkJcmV0dXJuIDE7CisJCWdvdG8gZXJy
OwogCX0KIAogCWlmIChhcHBlbmRfd29ya2xvYWRfYXJnKSB7CiAJCWFwcGVuZF93b3JrbG9hZF9h
cmcgPSBsb2FkX3dvcmtsb2FkX2Rlc2NyaXB0b3IoYXBwZW5kX3dvcmtsb2FkX2FyZyk7CiAJCWlm
ICghYXBwZW5kX3dvcmtsb2FkX2FyZykgewogCQkJd3NpbV9lcnIoIkZhaWxlZCB0byBsb2FkIGFw
cGVuZCB3b3JrbG9hZCBkZXNjcmlwdG9yIVxuIik7Ci0JCQlyZXR1cm4gMTsKKwkJCWdvdG8gZXJy
OwogCQl9CiAJfQogCkBAIC0zMjgxLDcgKzMyODIsNyBAQCBpbnQgbWFpbihpbnQgYXJnYywgY2hh
ciAqKmFyZ3YpCiAJCWFwcF93ID0gcGFyc2Vfd29ya2xvYWQoJmFyZywgZmxhZ3MsIE5VTEwpOwog
CQlpZiAoIWFwcF93KSB7CiAJCQl3c2ltX2VycigiRmFpbGVkIHRvIHBhcnNlIGFwcGVuZCB3b3Jr
bG9hZCFcbiIpOwotCQkJcmV0dXJuIDE7CisJCQlnb3RvIGVycjsKIAkJfQogCX0KIApAQCAtMzI5
MywxMyArMzI5NCwxMyBAQCBpbnQgbWFpbihpbnQgYXJnYywgY2hhciAqKmFyZ3YpCiAKIAkJaWYg
KCF3X2FyZ3NbaV0uZGVzYykgewogCQkJd3NpbV9lcnIoIkZhaWxlZCB0byBsb2FkIHdvcmtsb2Fk
IGRlc2NyaXB0b3IgJXUhXG4iLCBpKTsKLQkJCXJldHVybiAxOworCQkJZ290byBlcnI7CiAJCX0K
IAogCQl3cmtbaV0gPSBwYXJzZV93b3JrbG9hZCgmd19hcmdzW2ldLCBmbGFncywgYXBwX3cpOwog
CQlpZiAoIXdya1tpXSkgewogCQkJd3NpbV9lcnIoIkZhaWxlZCB0byBwYXJzZSB3b3JrbG9hZCAl
dSFcbiIsIGkpOwotCQkJcmV0dXJuIDE7CisJCQlnb3RvIGVycjsKIAkJfQogCX0KIApAQCAtMzM1
OSw3ICszMzYwLDcgQEAgaW50IG1haW4oaW50IGFyZ2MsIGNoYXIgKiphcmd2KQogCiAJCWlmIChw
cmVwYXJlX3dvcmtsb2FkKGksIHdbaV0sIGZsYWdzXykpIHsKIAkJCXdzaW1fZXJyKCJGYWlsZWQg
dG8gcHJlcGFyZSB3b3JrbG9hZCAldSFcbiIsIGkpOwotCQkJcmV0dXJuIDE7CisJCQlnb3RvIGVy
cjsKIAkJfQogCiAKQEAgLTMzNjgsMTMgKzMzNjksMTEgQEAgaW50IG1haW4oaW50IGFyZ2MsIGNo
YXIgKiphcmd2KQogCQkJaWYgKHJldCkgewogCQkJCXdzaW1fZXJyKCJGYWlsZWQgdG8gaW5pdGlh
bGl6ZSBiYWxhbmNpbmchICgldT0lZClcbiIsCiAJCQkJCSBpLCByZXQpOwotCQkJCXJldHVybiAx
OworCQkJCWdvdG8gZXJyOwogCQkJfQogCQl9CiAJfQogCi0JZ2VtX3F1aWVzY2VudF9ncHUoZmQp
OwotCiAJY2xvY2tfZ2V0dGltZShDTE9DS19NT05PVE9OSUMsICZ0X3N0YXJ0KTsKIAogCWZvciAo
aSA9IDA7IGkgPCBjbGllbnRzOyBpKyspIHsKQEAgLTM0MTQsNSArMzQxMyw5IEBAIGludCBtYWlu
KGludCBhcmdjLCBjaGFyICoqYXJndikKIAkJZmluaV93b3JrbG9hZCh3cmtbaV0pOwogCWZyZWUo
d19hcmdzKTsKIAotCXJldHVybiAwOworb3V0OgorCWV4aXRjb2RlID0gRVhJVF9TVUNDRVNTOwor
ZXJyOgorCWludGVsX3JlZ2lzdGVyX2FjY2Vzc19maW5pKCZtbWlvX2RhdGEpOworCXJldHVybiBl
eGl0Y29kZTsKIH0KLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJl
ZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGlu
Zm8vaW50ZWwtZ2Z4

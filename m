Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0CDFD7DE4B
	for <lists+intel-gfx@lfdr.de>; Thu,  1 Aug 2019 16:55:35 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 766676E6B5;
	Thu,  1 Aug 2019 14:55:33 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga01.intel.com (mga01.intel.com [192.55.52.88])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0C3456E6B5
 for <intel-gfx@lists.freedesktop.org>; Thu,  1 Aug 2019 14:55:32 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga002.jf.intel.com ([10.7.209.21])
 by fmsmga101.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 01 Aug 2019 07:55:31 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.64,334,1559545200"; d="scan'208";a="184264846"
Received: from gadevlin-mobl.ger.corp.intel.com (HELO [10.251.95.57])
 ([10.251.95.57])
 by orsmga002.jf.intel.com with ESMTP; 01 Aug 2019 07:55:30 -0700
To: Chris Wilson <chris@chris-wilson.co.uk>, intel-gfx@lists.freedesktop.org
References: <20190801121533.14057-1-chris@chris-wilson.co.uk>
 <20190801122002.24248-1-chris@chris-wilson.co.uk>
 <8ed53b04-9dae-3430-9b4f-7ce233101218@linux.intel.com>
 <156467034056.6045.9270718607329366656@skylake-alporthouse-com>
From: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>
Organization: Intel Corporation UK Plc
Message-ID: <01573c3d-a73e-8370-20dd-8eebd9435387@linux.intel.com>
Date: Thu, 1 Aug 2019 15:55:29 +0100
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101
 Thunderbird/60.8.0
MIME-Version: 1.0
In-Reply-To: <156467034056.6045.9270718607329366656@skylake-alporthouse-com>
Content-Language: en-US
Subject: Re: [Intel-gfx] [PATCH] drm/i915/pmu: Atomically acquire the gt_pm
 wakeref
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Transfer-Encoding: base64
Content-Type: text/plain; charset="utf-8"; Format="flowed"
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Ck9uIDAxLzA4LzIwMTkgMTU6MzksIENocmlzIFdpbHNvbiB3cm90ZToKPiBRdW90aW5nIFR2cnRr
byBVcnN1bGluICgyMDE5LTA4LTAxIDE1OjIxOjE3KQo+Pgo+PiBPbiAwMS8wOC8yMDE5IDEzOjIw
LCBDaHJpcyBXaWxzb24gd3JvdGU6Cj4+PiBDdXJyZW50bHksIHdlIG9ubHkgc2FtcGxlIGlmIHRo
ZSBpbnRlbF9ndCBpcyBhd2FrZSwgYnV0IHdlIGFjcXVpcmUgb3VyCj4+PiBvd24gcnVudGltZV9w
bSB3YWtlcmVmLiBTaW5jZSBpbnRlbF9ndCBoYXMgdHJhbnNpdGlvbmVkIHRvIHRyYWNraW5nIGl0
cwo+Pj4gb3duIHdha2VyZWYsIHdlIGNhbiBhdG9taWNhbGx5IHRlc3QgYW5kIGFjcXVpcmUgdGhh
dCB3YWtlcmVmIGluc3RlYWQuCj4+Pgo+Pj4gU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxj
aHJpc0BjaHJpcy13aWxzb24uY28udWs+Cj4+PiBDYzogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51
cnN1bGluQGludGVsLmNvbT4KPj4+IC0tLQo+Pj4gTm8gYXV0b21hZ2ljIGRyb3AhCj4+PiAtLS0K
Pj4+ICAgIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmggfCAgOCArKysrKysr
LQo+Pj4gICAgZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wbXUuYyAgICAgICB8IDIzICsrKysr
KysrLS0tLS0tLS0tLS0tLS0tCj4+PiAgICAyIGZpbGVzIGNoYW5nZWQsIDE1IGluc2VydGlvbnMo
KyksIDE2IGRlbGV0aW9ucygtKQo+Pj4KPj4+IGRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9pbnRlbF9ndF9wbS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3Rf
cG0uaAo+Pj4gaW5kZXggYmE5NjBlMWZjMjA5Li4wMTYyOTg0ODNkZTcgMTAwNjQ0Cj4+PiAtLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5oCj4+PiArKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5oCj4+PiBAQCAtOSw3ICs5LDggQEAKPj4+ICAg
IAo+Pj4gICAgI2luY2x1ZGUgPGxpbnV4L3R5cGVzLmg+Cj4+PiAgICAKPj4+IC1zdHJ1Y3QgaW50
ZWxfZ3Q7Cj4+PiArI2luY2x1ZGUgImludGVsX2d0X3R5cGVzLmgiCj4+PiArI2luY2x1ZGUgImlu
dGVsX3dha2VyZWYuaCIKPj4+ICAgIAo+Pj4gICAgZW51bSB7Cj4+PiAgICAgICAgSU5URUxfR1Rf
VU5QQVJLLAo+Pj4gQEAgLTE5LDYgKzIwLDExIEBAIGVudW0gewo+Pj4gICAgdm9pZCBpbnRlbF9n
dF9wbV9nZXQoc3RydWN0IGludGVsX2d0ICpndCk7Cj4+PiAgICB2b2lkIGludGVsX2d0X3BtX3B1
dChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KTsKPj4+ICAgIAo+Pj4gK3N0YXRpYyBpbmxpbmUgYm9vbCBp
bnRlbF9ndF9wbV9nZXRfaWZfYXdha2Uoc3RydWN0IGludGVsX2d0ICpndCkKPj4+ICt7Cj4+PiAr
ICAgICByZXR1cm4gaW50ZWxfd2FrZXJlZl9nZXRfaWZfYWN0aXZlKCZndC0+d2FrZXJlZik7Cj4+
PiArfQo+Pj4gKwo+Pj4gICAgdm9pZCBpbnRlbF9ndF9wbV9pbml0X2Vhcmx5KHN0cnVjdCBpbnRl
bF9ndCAqZ3QpOwo+Pj4gICAgCj4+PiAgICB2b2lkIGludGVsX2d0X3Nhbml0aXplKHN0cnVjdCBp
bnRlbF9ndCAqZ3QsIGJvb2wgZm9yY2UpOwo+Pj4gZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfcG11LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BtdS5jCj4+PiBp
bmRleCBlZmY4NjQ4M2JlYzAuLmU3MTE5MjgwNDk5NiAxMDA2NDQKPj4+IC0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfcG11LmMKPj4+ICsrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfcG11LmMKPj4+IEBAIC04LDYgKzgsNyBAQAo+Pj4gICAgI2luY2x1ZGUgPGxpbnV4L3BtX3J1
bnRpbWUuaD4KPj4+ICAgIAo+Pj4gICAgI2luY2x1ZGUgImd0L2ludGVsX2VuZ2luZS5oIgo+Pj4g
KyNpbmNsdWRlICJndC9pbnRlbF9ndF9wbS5oIgo+Pj4gICAgCj4+PiAgICAjaW5jbHVkZSAiaTkx
NV9kcnYuaCIKPj4+ICAgICNpbmNsdWRlICJpOTE1X3BtdS5oIgo+Pj4gQEAgLTE2MSwxNiArMTYy
LDEyIEBAIGVuZ2luZXNfc2FtcGxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwg
dW5zaWduZWQgaW50IHBlcmlvZF9ucykKPj4+ICAgIHsKPj4+ICAgICAgICBzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmU7Cj4+PiAgICAgICAgZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7Cj4+
PiAtICAgICBpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKPj4+ICAgICAgICB1bnNpZ25lZCBsb25n
IGZsYWdzOwo+Pj4gICAgCj4+PiAgICAgICAgaWYgKChkZXZfcHJpdi0+cG11LmVuYWJsZSAmIEVO
R0lORV9TQU1QTEVfTUFTSykgPT0gMCkKPj4+ICAgICAgICAgICAgICAgIHJldHVybjsKPj4+ICAg
IAo+Pj4gLSAgICAgd2FrZXJlZiA9IDA7Cj4+PiAtICAgICBpZiAoUkVBRF9PTkNFKGRldl9wcml2
LT5ndC5hd2FrZSkpCj4+PiAtICAgICAgICAgICAgIHdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3Bt
X2dldF9pZl9pbl91c2UoJmRldl9wcml2LT5ydW50aW1lX3BtKTsKPj4+IC0gICAgIGlmICghd2Fr
ZXJlZikKPj4+ICsgICAgIGlmICghaW50ZWxfZ3RfcG1fZ2V0X2lmX2F3YWtlKCZkZXZfcHJpdi0+
Z3QpKQo+Pj4gICAgICAgICAgICAgICAgcmV0dXJuOwo+Pj4gICAgCj4+PiAgICAgICAgc3Bpbl9s
b2NrX2lycXNhdmUoJmRldl9wcml2LT51bmNvcmUubG9jaywgZmxhZ3MpOwo+Pj4gQEAgLTIwNSw3
ICsyMDIsNyBAQCBlbmdpbmVzX3NhbXBsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsIHVuc2lnbmVkIGludCBwZXJpb2RfbnMpCj4+PiAgICAgICAgfQo+Pj4gICAgICAgIHNwaW5f
dW5sb2NrX2lycXJlc3RvcmUoJmRldl9wcml2LT51bmNvcmUubG9jaywgZmxhZ3MpOwo+Pj4gICAg
Cj4+PiAtICAgICBpbnRlbF9ydW50aW1lX3BtX3B1dCgmZGV2X3ByaXYtPnJ1bnRpbWVfcG0sIHdh
a2VyZWYpOwo+Pj4gKyAgICAgaW50ZWxfZ3RfcG1fcHV0KCZkZXZfcHJpdi0+Z3QpOwo+Pj4gICAg
fQo+Pj4gICAgCj4+PiAgICBzdGF0aWMgdm9pZAo+Pj4gQEAgLTIyMiwxNSArMjE5LDExIEBAIGZy
ZXF1ZW5jeV9zYW1wbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCB1bnNpZ25l
ZCBpbnQgcGVyaW9kX25zKQo+Pj4gICAgICAgICAgICAgICAgdTMyIHZhbDsKPj4+ICAgIAo+Pj4g
ICAgICAgICAgICAgICAgdmFsID0gZGV2X3ByaXYtPmd0X3BtLnJwcy5jdXJfZnJlcTsKPj4+IC0g
ICAgICAgICAgICAgaWYgKGRldl9wcml2LT5ndC5hd2FrZSkgewo+Pj4gLSAgICAgICAgICAgICAg
ICAgICAgIGludGVsX3dha2VyZWZfdCB3YWtlcmVmOwo+Pj4gLQo+Pj4gLSAgICAgICAgICAgICAg
ICAgICAgIHdpdGhfaW50ZWxfcnVudGltZV9wbV9pZl9pbl91c2UoJmRldl9wcml2LT5ydW50aW1l
X3BtLAo+Pj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgd2FrZXJlZikgewo+Pj4gLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsID0g
aW50ZWxfdW5jb3JlX3JlYWRfbm90cmFjZSgmZGV2X3ByaXYtPnVuY29yZSwKPj4+IC0gICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR0VO
Nl9SUFNUQVQxKTsKPj4+IC0gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IGludGVs
X2dldF9jYWdmKGRldl9wcml2LCB2YWwpOwo+Pj4gLSAgICAgICAgICAgICAgICAgICAgIH0KPj4+
ICsgICAgICAgICAgICAgaWYgKGludGVsX2d0X3BtX2dldF9pZl9hd2FrZSgmZGV2X3ByaXYtPmd0
KSkgewo+Pj4gKyAgICAgICAgICAgICAgICAgICAgIHZhbCA9IGludGVsX3VuY29yZV9yZWFkX25v
dHJhY2UoJmRldl9wcml2LT51bmNvcmUsCj4+PiArICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICBHRU42X1JQU1RBVDEpOwo+Pj4gKyAgICAgICAgICAg
ICAgICAgICAgIHZhbCA9IGludGVsX2dldF9jYWdmKGRldl9wcml2LCB2YWwpOwo+Pj4gKyAgICAg
ICAgICAgICAgICAgICAgIGludGVsX2d0X3BtX3B1dCgmZGV2X3ByaXYtPmd0KTsKPj4+ICAgICAg
ICAgICAgICAgIH0KPj4+ICAgIAo+Pj4gICAgICAgICAgICAgICAgYWRkX3NhbXBsZV9tdWx0KCZk
ZXZfcHJpdi0+cG11LnNhbXBsZVtfX0k5MTVfU0FNUExFX0ZSRVFfQUNUXSwKPj4+Cj4+Cj4+IEkg
Z3Vlc3MgSSdsbCBiZSByZWJhc2luZyBtaW5lLCBhdCBzb21lIHBvaW50LiA6KQo+IAo+IEkgYW50
aWNpcGF0ZWQgeW91IG1lcmdpbmcgaXQgYXQgc29tZSBwb2ludC4KClRoaXMgcGF0Y2ggdG8gbXkg
c2VyaWVzIG9yIHdoYXQ/Cgo+IEhhZCBhIHRob3VnaHQsIGFuZCB3ZSBkb24ndCBuZWVkIGd0X3Bt
IGZvciB0aGUgZW5naW5lIHNhbXBsaW5nLCBidXQKPiByYXRoZXIgaW50ZWxfZW5naW5lX3BtX2dl
dF9pZl9hd2FrZS4KCkkgdGhvdWdodCBhYm91dCBpdCwgYnV0IHNpbmNlIHdlIGl0ZXJhdGUgYWxs
IGVuZ2luZXMgZGlkIG5vdCBzZWUgYSByZWFsIApiZW5lZml0LiBXb3VsZG4ndCBoYXJtIGVpdGhl
ciwgb25seSBzb21lIG1vcmUgQ1BVIGN5Y2xlcyBpbiB0aGUgbG9vcCwgc28gCnVwIHRvIHlvdS4K
ClJlZ2FyZHMsCgpUdnJ0a28KX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0
b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50
ZWwtZ2Z4

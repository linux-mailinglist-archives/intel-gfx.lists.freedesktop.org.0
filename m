Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 0D20E3AF83
	for <lists+intel-gfx@lfdr.de>; Mon, 10 Jun 2019 09:21:53 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6E52289129;
	Mon, 10 Jun 2019 07:21:50 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AA6F189113
 for <intel-gfx@lists.freedesktop.org>; Mon, 10 Jun 2019 07:21:42 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16848368-1500050 
 for multiple; Mon, 10 Jun 2019 08:21:30 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 10 Jun 2019 08:21:13 +0100
Message-Id: <20190610072126.6355-16-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190610072126.6355-1-chris@chris-wilson.co.uk>
References: <20190610072126.6355-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 15/28] drm/i915: Throw away the active object
 retirement complexity
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UmVtb3ZlIHRoZSBhY2N1bXVsYXRlZCBvcHRpbWlzYXRpb25zIHRoYXQgd2UgaGF2ZSBmb3IgaTkx
NV92bWFfcmV0aXJlCmFuZCByZWR1Y2UgaXQgdG8gdGhlIGJhcmUgZXNzZW50aWFsIG9mIHRyYWNr
aW5nIHRoZSBhY3RpdmUgb2JqZWN0CnJlZmVyZW5jZS4gVGhpcyBhbGxvd3MgdXMgdG8gb25seSB1
c2UgYXRvbWljIG9wZXJhdGlvbnMsIGFuZCBzbyB3aWxsIGJlCmFibGUgdG8gYXZvaWQgdGhlIHN0
cnVjdF9tdXRleCByZXF1aXJlbWVudC4KClRoZSBwcmluY2lwYWwgbG9zcyBoZXJlIGlzIHRoZSBz
aHJpbmtlciBNUlUgYnVtcGluZywgc28gbm93IGlmIHdlIGhhdmUKdG8gc2hyaW5rLCB3ZSB3aWxs
IGRvIHNvIGluIG11Y2ggbW9yZSByYW5kb20gb3JkZXIgYW5kIG1vcmUgbGlrZWx5IHRvCnRyeSBh
bmQgc2hyaW5rIHJlY2VudGx5IHVzZWQgb2JqZWN0cy4gVGhhdCBpcyBhIG51aXNhbmNlLCBidXQg
c2hyaW5raW5nCmFjdGl2ZSBvYmplY3RzIGlzIGEgc2Vjb25kIHN0ZXAgd2UgdHJ5IHRvIGF2b2lk
IGFuZCB3aWxsIGFsd2F5cyBiZSBhCnN5c3RlbS13aWRlIHBlcmZvcm1hbmNlIGlzc3VlLgoKVGhl
IG90aGVyIGxvc3MgaXMgaGVyZSBpcyBpbiB0aGUgYXV0b21hdGljIHBydW5pbmcgb2YgdGhlCnJl
c2VydmF0aW9uX29iamVjdCB3aGVuIGlkbGluZy4gVGhpcyBpcyBub3QgYXMgbGFyZ2UgYW4gaXNz
dWUgYXMgdXBvbgpyZXNlcnZhdGlvbl9vYmplY3QgaW50cm9kdWN0aW9uIGFzIG5vdyBhZGRpbmcg
bmV3IGZlbmNlcyBpbnRvIHRoZSBvYmplY3QKcmVwbGFjZXMgYWxyZWFkeSBzaWduYWxlZCBmZW5j
ZXMsIGtlZXBpbmcgdGhlIGFycmF5IGNvbXBhY3QuIEJ1dCB3ZSBkbwpsb3NlIHRoZSBhdXRvLWV4
cGlyYXRpb24gb2Ygc3RhbGUgZmVuY2VzIGFuZCB1bnVzZWQgYXJyYXlzLiBUaGF0IG1heSBiZQph
IG5vdGljZWFibGUgcHJvYmxlbSBmb3Igd2hpY2ggd2UgbmVlZCB0byByZS1pbXBsZW1lbnQgYXV0
b3BydW5pbmcuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNv
bi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMg
ICAgfCAgMSAtCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmggICAg
fCAgNiAtLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmggIHwg
IDEgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMgIHwgIDUg
Ky0KIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYyAgICB8ICAxIC0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2xyYy5jICAgICAgICAgICB8ICA0ICstCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9yaW5nYnVmZmVyLmMgICAgfCAgMSAtCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYyAgfCAzMiArKysrKy0tLS0t
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgICAgICAgICAgIHwgIDggKy0t
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9iYXRjaF9wb29sLmMgICAgfCA0MiArKysr
KystLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYyAgICAgICAgICAgICAg
IHwgNTYgKysrKy0tLS0tLS0tLS0tLS0tLQogMTEgZmlsZXMgY2hhbmdlZCwgNDcgaW5zZXJ0aW9u
cygrKSwgMTEwIGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9pOTE1X2dlbV9vYmplY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9vYmplY3QuYwppbmRleCAwMzcyNWNhNDJjYzcuLjI5MWE4ZjI3ZDg1YSAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYwpAQCAtMTg5LDcgKzE4OSw2IEBAIHN0
YXRpYyB2b2lkIF9faTkxNV9nZW1fZnJlZV9vYmplY3RzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAogCiAJCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCi0JCUdF
TV9CVUdfT04oaTkxNV9nZW1fb2JqZWN0X2lzX2FjdGl2ZShvYmopKTsKIAkJbGlzdF9mb3JfZWFj
aF9lbnRyeV9zYWZlKHZtYSwgdm4sICZvYmotPnZtYS5saXN0LCBvYmpfbGluaykgewogCQkJR0VN
X0JVR19PTihpOTE1X3ZtYV9pc19hY3RpdmUodm1hKSk7CiAJCQl2bWEtPmZsYWdzICY9IH5JOTE1
X1ZNQV9QSU5fTUFTSzsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9vYmplY3QuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3Qu
aAppbmRleCA3Y2IxODcxZDcxMjguLjQ1NGJmYjQ5ODAwMSAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaApAQCAtMTU4LDEyICsxNTgsNiBAQCBpOTE1X2dlbV9v
YmplY3RfbmVlZHNfYXN5bmNfY2FuY2VsKGNvbnN0IHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmopCiAJcmV0dXJuIG9iai0+b3BzLT5mbGFncyAmIEk5MTVfR0VNX09CSkVDVF9BU1lOQ19D
QU5DRUw7CiB9CiAKLXN0YXRpYyBpbmxpbmUgYm9vbAotaTkxNV9nZW1fb2JqZWN0X2lzX2FjdGl2
ZShjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQotewotCXJldHVybiBSRUFE
X09OQ0Uob2JqLT5hY3RpdmVfY291bnQpOwotfQotCiBzdGF0aWMgaW5saW5lIGJvb2wKIGk5MTVf
Z2VtX29iamVjdF9pc19mcmFtZWJ1ZmZlcihjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVj
dCAqb2JqKQogewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X29iamVjdF90eXBlcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVj
dF90eXBlcy5oCmluZGV4IDViMDU2OTg2MTljZS4uYzI5OWZlZDJjNmIxIDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0X3R5cGVzLmgKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdF90eXBlcy5oCkBAIC0xNTYsNyAr
MTU2LDYgQEAgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgewogCiAJLyoqIENvdW50IG9mIFZN
QSBhY3R1YWxseSBib3VuZCBieSB0aGlzIG9iamVjdCAqLwogCWF0b21pY190IGJpbmRfY291bnQ7
Ci0JdW5zaWduZWQgaW50IGFjdGl2ZV9jb3VudDsKIAkvKiogQ291bnQgb2YgaG93IG1hbnkgZ2xv
YmFsIFZNQSBhcmUgY3VycmVudGx5IHBpbm5lZCBmb3IgdXNlIGJ5IEhXICovCiAJdW5zaWduZWQg
aW50IHBpbl9nbG9iYWw7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9zaHJpbmtlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3No
cmlua2VyLmMKaW5kZXggODhlNjNhZmQxZDNkLi40ODQ1MTExMGU3MzYgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jCkBAIC0yMzUsOCArMjM1LDkgQEAg
aTkxNV9nZW1fc2hyaW5rKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCWNvbnRp
bnVlOwogCiAJCQlpZiAoIShmbGFncyAmIEk5MTVfU0hSSU5LX0FDVElWRSkgJiYKLQkJCSAgICAo
aTkxNV9nZW1fb2JqZWN0X2lzX2FjdGl2ZShvYmopIHx8Ci0JCQkgICAgIGk5MTVfZ2VtX29iamVj
dF9pc19mcmFtZWJ1ZmZlcihvYmopKSkKKwkJCSAgICAoaTkxNV9nZW1fb2JqZWN0X2lzX2ZyYW1l
YnVmZmVyKG9iaikgfHwKKwkJCSAgICAgcmVzZXJ2YXRpb25fb2JqZWN0X3Rlc3Rfc2lnbmFsZWRf
cmN1KG9iai0+cmVzdiwKKwkJCQkJCQkJICB0cnVlKSkpCiAJCQkJY29udGludWU7CiAKIAkJCWlm
ICghKGZsYWdzICYgSTkxNV9TSFJJTktfQk9VTkQpICYmCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jCmluZGV4IGI5MjgwOTQxODcyOS4u
YjBiYTE2ODBlZGU2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRl
c3RzL2k5MTVfZ2VtX21tYW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRl
c3RzL2k5MTVfZ2VtX21tYW4uYwpAQCAtNDc2LDcgKzQ3Niw2IEBAIHN0YXRpYyBpbnQgaWd0X21t
YXBfb2Zmc2V0X2V4aGF1c3Rpb24odm9pZCAqYXJnKQogCQl9CiAKIAkJLyogTkIgd2UgcmVseSBv
biB0aGUgX2FjdGl2ZV8gcmVmZXJlbmNlIHRvIGFjY2VzcyBvYmogbm93ICovCi0JCUdFTV9CVUdf
T04oIWk5MTVfZ2VtX29iamVjdF9pc19hY3RpdmUob2JqKSk7CiAJCWVyciA9IGNyZWF0ZV9tbWFw
X29mZnNldChvYmopOwogCQlpZiAoZXJyKSB7CiAJCQlwcl9lcnIoIltsb29wICVkXSBjcmVhdGVf
bW1hcF9vZmZzZXQgZmFpbGVkIHdpdGggZXJyPSVkXG4iLApkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9scmMuYwppbmRleCA0MDI0NmViZDIyM2YuLjBhYjNkMTM3N2U5MiAxMDA2NDQKLS0tIGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3QvaW50ZWxfbHJjLmMKQEAgLTE1MDIsOSArMTUwMiw3IEBAIHN0YXRpYyB2b2lkIGV4ZWNs
aXN0c19zdWJtaXRfcmVxdWVzdChzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0KQogc3RhdGlj
IHZvaWQgX19leGVjbGlzdHNfY29udGV4dF9maW5pKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkK
IHsKIAlpbnRlbF9yaW5nX3B1dChjZS0+cmluZyk7Ci0KLQlHRU1fQlVHX09OKGk5MTVfZ2VtX29i
amVjdF9pc19hY3RpdmUoY2UtPnN0YXRlLT5vYmopKTsKLQlpOTE1X2dlbV9vYmplY3RfcHV0KGNl
LT5zdGF0ZS0+b2JqKTsKKwlpOTE1X3ZtYV9wdXQoY2UtPnN0YXRlKTsKIH0KIAogc3RhdGljIHZv
aWQgZXhlY2xpc3RzX2NvbnRleHRfZGVzdHJveShzdHJ1Y3Qga3JlZiAqa3JlZikKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIuYwppbmRleCA5M2IwODkzYzczNmIuLmFh
NGM5ZTgyMTM4ZSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfcmlu
Z2J1ZmZlci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX3JpbmdidWZmZXIu
YwpAQCAtMTMwOSw3ICsxMzA5LDYgQEAgdm9pZCBpbnRlbF9yaW5nX2ZyZWUoc3RydWN0IGtyZWYg
KnJlZikKIAogc3RhdGljIHZvaWQgX19yaW5nX2NvbnRleHRfZmluaShzdHJ1Y3QgaW50ZWxfY29u
dGV4dCAqY2UpCiB7Ci0JR0VNX0JVR19PTihpOTE1X2dlbV9vYmplY3RfaXNfYWN0aXZlKGNlLT5z
dGF0ZS0+b2JqKSk7CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChjZS0+c3RhdGUtPm9iaik7CiB9CiAK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMKaW5kZXggMTI3
ZmFlZjhkOGMyLi5jNjAxNjM5OGM3ZTkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2d0L3NlbGZ0ZXN0X2hhbmdjaGVjay5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3Nl
bGZ0ZXN0X2hhbmdjaGVjay5jCkBAIC0xMzAsMzMgKzEzMCwyOSBAQCBoYW5nX2NyZWF0ZV9yZXF1
ZXN0KHN0cnVjdCBoYW5nICpoLCBzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmUpCiAJc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBoLT5pOTE1OwogCXN0cnVjdCBpOTE1X2FkZHJl
c3Nfc3BhY2UgKnZtID0KIAkJaC0+Y3R4LT5wcGd0dCA/ICZoLT5jdHgtPnBwZ3R0LT52bSA6ICZp
OTE1LT5nZ3R0LnZtOworCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CiAJc3RydWN0
IGk5MTVfcmVxdWVzdCAqcnEgPSBOVUxMOwogCXN0cnVjdCBpOTE1X3ZtYSAqaHdzLCAqdm1hOwog
CXVuc2lnbmVkIGludCBmbGFnczsKKwl2b2lkICp2YWRkcjsKIAl1MzIgKmJhdGNoOwogCWludCBl
cnI7CiAKLQlpZiAoaTkxNV9nZW1fb2JqZWN0X2lzX2FjdGl2ZShoLT5vYmopKSB7Ci0JCXN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7Ci0JCXZvaWQgKnZhZGRyOwotCi0JCW9iaiA9IGk5
MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoaC0+aTkxNSwgUEFHRV9TSVpFKTsKLQkJaWYg
KElTX0VSUihvYmopKQotCQkJcmV0dXJuIEVSUl9DQVNUKG9iaik7CisJb2JqID0gaTkxNV9nZW1f
b2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChoLT5pOTE1LCBQQUdFX1NJWkUpOworCWlmIChJU19FUlIo
b2JqKSkKKwkJcmV0dXJuIEVSUl9DQVNUKG9iaik7CiAKLQkJdmFkZHIgPSBpOTE1X2dlbV9vYmpl
Y3RfcGluX21hcChvYmosCi0JCQkJCQlpOTE1X2NvaGVyZW50X21hcF90eXBlKGgtPmk5MTUpKTsK
LQkJaWYgKElTX0VSUih2YWRkcikpIHsKLQkJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKLQkJ
CXJldHVybiBFUlJfQ0FTVCh2YWRkcik7Ci0JCX0KKwl2YWRkciA9IGk5MTVfZ2VtX29iamVjdF9w
aW5fbWFwKG9iaiwgaTkxNV9jb2hlcmVudF9tYXBfdHlwZShoLT5pOTE1KSk7CisJaWYgKElTX0VS
Uih2YWRkcikpIHsKKwkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCQlyZXR1cm4gRVJSX0NB
U1QodmFkZHIpOworCX0KIAotCQlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKGgtPm9iaik7Ci0J
CWk5MTVfZ2VtX29iamVjdF9wdXQoaC0+b2JqKTsKKwlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFw
KGgtPm9iaik7CisJaTkxNV9nZW1fb2JqZWN0X3B1dChoLT5vYmopOwogCi0JCWgtPm9iaiA9IG9i
ajsKLQkJaC0+YmF0Y2ggPSB2YWRkcjsKLQl9CisJaC0+b2JqID0gb2JqOworCWgtPmJhdGNoID0g
dmFkZHI7CiAKIAl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShoLT5vYmosIHZtLCBOVUxMKTsKIAlp
ZiAoSVNfRVJSKHZtYSkpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rl
YnVnZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCmluZGV4IDMyNmE1
NmE5NzI0Ny4uZmVjNWZkZWNhMDdmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2RlYnVnZnMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwpA
QCAtNzQsMTEgKzc0LDYgQEAgc3RhdGljIGludCBpOTE1X2NhcGFiaWxpdGllcyhzdHJ1Y3Qgc2Vx
X2ZpbGUgKm0sIHZvaWQgKmRhdGEpCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBjaGFyIGdldF9h
Y3RpdmVfZmxhZyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQotewotCXJldHVybiBp
OTE1X2dlbV9vYmplY3RfaXNfYWN0aXZlKG9iaikgPyAnKicgOiAnICc7Ci19Ci0KIHN0YXRpYyBj
aGFyIGdldF9waW5fZmxhZyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogewogCXJl
dHVybiBvYmotPnBpbl9nbG9iYWwgPyAncCcgOiAnICc7CkBAIC0xNDMsOSArMTM4LDggQEAgZGVz
Y3JpYmVfb2JqKHN0cnVjdCBzZXFfZmlsZSAqbSwgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
Km9iaikKIAl1bnNpZ25lZCBpbnQgZnJvbnRidWZmZXJfYml0czsKIAlpbnQgcGluX2NvdW50ID0g
MDsKIAotCXNlcV9wcmludGYobSwgIiVwSzogJWMlYyVjJWMlYyAlOHpkS2lCICUwMnggJTAyeCAl
cyVzJXMiLAorCXNlcV9wcmludGYobSwgIiVwSzogJWMlYyVjJWMgJTh6ZEtpQiAlMDJ4ICUwMngg
JXMlcyVzIiwKIAkJICAgJm9iai0+YmFzZSwKLQkJICAgZ2V0X2FjdGl2ZV9mbGFnKG9iaiksCiAJ
CSAgIGdldF9waW5fZmxhZyhvYmopLAogCQkgICBnZXRfdGlsaW5nX2ZsYWcob2JqKSwKIAkJICAg
Z2V0X2dsb2JhbF9mbGFnKG9iaiksCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9iYXRjaF9wb29sLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9iYXRj
aF9wb29sLmMKaW5kZXggNTZhZGZkY2FlZDNlLi4xYjc1OTVlMmFjMjEgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2JhdGNoX3Bvb2wuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2dlbV9iYXRjaF9wb29sLmMKQEAgLTk0LDM0ICs5NCwyNiBAQCBpOTE1
X2dlbV9iYXRjaF9wb29sX2dldChzdHJ1Y3QgaTkxNV9nZW1fYmF0Y2hfcG9vbCAqcG9vbCwKIAls
aXN0ID0gJnBvb2wtPmNhY2hlX2xpc3Rbbl07CiAKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KG9iaiwg
bGlzdCwgYmF0Y2hfcG9vbF9saW5rKSB7CisJCXN0cnVjdCByZXNlcnZhdGlvbl9vYmplY3QgKnJl
c3YgPSBvYmotPnJlc3Y7CisKIAkJLyogVGhlIGJhdGNoZXMgYXJlIHN0cmljdGx5IExSVSBvcmRl
cmVkICovCi0JCWlmIChpOTE1X2dlbV9vYmplY3RfaXNfYWN0aXZlKG9iaikpIHsKLQkJCXN0cnVj
dCByZXNlcnZhdGlvbl9vYmplY3QgKnJlc3YgPSBvYmotPnJlc3Y7Ci0KLQkJCWlmICghcmVzZXJ2
YXRpb25fb2JqZWN0X3Rlc3Rfc2lnbmFsZWRfcmN1KHJlc3YsIHRydWUpKQotCQkJCWJyZWFrOwot
Ci0JCQlpOTE1X3JldGlyZV9yZXF1ZXN0cyhwb29sLT5lbmdpbmUtPmk5MTUpOwotCQkJR0VNX0JV
R19PTihpOTE1X2dlbV9vYmplY3RfaXNfYWN0aXZlKG9iaikpOwotCi0JCQkvKgotCQkJICogVGhl
IG9iamVjdCBpcyBub3cgaWRsZSwgY2xlYXIgdGhlIGFycmF5IG9mIHNoYXJlZAotCQkJICogZmVu
Y2VzIGJlZm9yZSB3ZSBhZGQgYSBuZXcgcmVxdWVzdC4gQWx0aG91Z2gsIHdlCi0JCQkgKiByZW1h
aW4gb24gdGhlIHNhbWUgZW5naW5lLCB3ZSBtYXkgYmUgb24gYSBkaWZmZXJlbnQKLQkJCSAqIHRp
bWVsaW5lIGFuZCBzbyBtYXkgY29udGludWFsbHkgZ3JvdyB0aGUgYXJyYXksCi0JCQkgKiB0cmFw
cGluZyBhIHJlZmVyZW5jZSB0byBhbGwgdGhlIG9sZCBmZW5jZXMsIHJhdGhlcgotCQkJICogdGhh
biByZXBsYWNlIHRoZSBleGlzdGluZyBmZW5jZS4KLQkJCSAqLwotCQkJaWYgKHJjdV9hY2Nlc3Nf
cG9pbnRlcihyZXN2LT5mZW5jZSkpIHsKLQkJCQlyZXNlcnZhdGlvbl9vYmplY3RfbG9jayhyZXN2
LCBOVUxMKTsKLQkJCQlyZXNlcnZhdGlvbl9vYmplY3RfYWRkX2V4Y2xfZmVuY2UocmVzdiwgTlVM
TCk7Ci0JCQkJcmVzZXJ2YXRpb25fb2JqZWN0X3VubG9jayhyZXN2KTsKLQkJCX0KKwkJaWYgKCFy
ZXNlcnZhdGlvbl9vYmplY3RfdGVzdF9zaWduYWxlZF9yY3UocmVzdiwgdHJ1ZSkpCisJCQlicmVh
azsKKworCQkvKgorCQkgKiBUaGUgb2JqZWN0IGlzIG5vdyBpZGxlLCBjbGVhciB0aGUgYXJyYXkg
b2Ygc2hhcmVkCisJCSAqIGZlbmNlcyBiZWZvcmUgd2UgYWRkIGEgbmV3IHJlcXVlc3QuIEFsdGhv
dWdoLCB3ZQorCQkgKiByZW1haW4gb24gdGhlIHNhbWUgZW5naW5lLCB3ZSBtYXkgYmUgb24gYSBk
aWZmZXJlbnQKKwkJICogdGltZWxpbmUgYW5kIHNvIG1heSBjb250aW51YWxseSBncm93IHRoZSBh
cnJheSwKKwkJICogdHJhcHBpbmcgYSByZWZlcmVuY2UgdG8gYWxsIHRoZSBvbGQgZmVuY2VzLCBy
YXRoZXIKKwkJICogdGhhbiByZXBsYWNlIHRoZSBleGlzdGluZyBmZW5jZS4KKwkJICovCisJCWlm
IChyY3VfYWNjZXNzX3BvaW50ZXIocmVzdi0+ZmVuY2UpKSB7CisJCQlyZXNlcnZhdGlvbl9vYmpl
Y3RfbG9jayhyZXN2LCBOVUxMKTsKKwkJCXJlc2VydmF0aW9uX29iamVjdF9hZGRfZXhjbF9mZW5j
ZShyZXN2LCBOVUxMKTsKKwkJCXJlc2VydmF0aW9uX29iamVjdF91bmxvY2socmVzdik7CiAJCX0K
IAotCQlHRU1fQlVHX09OKCFyZXNlcnZhdGlvbl9vYmplY3RfdGVzdF9zaWduYWxlZF9yY3Uob2Jq
LT5yZXN2LAotCQkJCQkJCQkgdHJ1ZSkpOwotCiAJCWlmIChvYmotPmJhc2Uuc2l6ZSA+PSBzaXpl
KQogCQkJZ290byBmb3VuZDsKIAl9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X3ZtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYwppbmRleCA1YzA3NWNk
NmY5ZmMuLjZlMDRiNDQ4OWFkMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV92bWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCkBAIC03Nyw0NSAr
NzcsMTEgQEAgc3RhdGljIHZvaWQgdm1hX3ByaW50X2FsbG9jYXRvcihzdHJ1Y3QgaTkxNV92bWEg
KnZtYSwgY29uc3QgY2hhciAqcmVhc29uKQogCiAjZW5kaWYKIAotc3RhdGljIHZvaWQgb2JqX2J1
bXBfbXJ1KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCi17Ci0Jc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOwotCXVuc2lnbmVkIGxv
bmcgZmxhZ3M7Ci0KLQlzcGluX2xvY2tfaXJxc2F2ZSgmaTkxNS0+bW0ub2JqX2xvY2ssIGZsYWdz
KTsKLQotCWxpc3RfbW92ZV90YWlsKCZvYmotPm1tLmxpbmssICZpOTE1LT5tbS5zaHJpbmtfbGlz
dCk7Ci0KLQlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZpOTE1LT5tbS5vYmpfbG9jaywgZmxhZ3Mp
OwotCi0Jb2JqLT5tbS5kaXJ0eSA9IHRydWU7IC8qIGJlIHBhcmFub2lkICAqLwotfQotCiBzdGF0
aWMgdm9pZCBfX2k5MTVfdm1hX3JldGlyZShzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIHsKIAlz
dHJ1Y3QgaTkxNV92bWEgKnZtYSA9IGNvbnRhaW5lcl9vZihyZWYsIHR5cGVvZigqdm1hKSwgYWN0
aXZlKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gdm1hLT5vYmo7Ci0KLQlH
RU1fQlVHX09OKCFpOTE1X2dlbV9vYmplY3RfaXNfYWN0aXZlKG9iaikpOwotCWlmICgtLW9iai0+
YWN0aXZlX2NvdW50KQotCQlyZXR1cm47Ci0KLQkvKiBQcnVuZSB0aGUgc2hhcmVkIGZlbmNlIGFy
cmF5cyBpZmYgY29tcGxldGVseSBpZGxlIChpbmMuIGV4dGVybmFsKSAqLwotCWlmIChyZXNlcnZh
dGlvbl9vYmplY3RfdHJ5bG9jayhvYmotPnJlc3YpKSB7Ci0JCWlmIChyZXNlcnZhdGlvbl9vYmpl
Y3RfdGVzdF9zaWduYWxlZF9yY3Uob2JqLT5yZXN2LCB0cnVlKSkKLQkJCXJlc2VydmF0aW9uX29i
amVjdF9hZGRfZXhjbF9mZW5jZShvYmotPnJlc3YsIE5VTEwpOwotCQlyZXNlcnZhdGlvbl9vYmpl
Y3RfdW5sb2NrKG9iai0+cmVzdik7Ci0JfQotCi0JLyoKLQkgKiBCdW1wIG91ciBwbGFjZSBvbiB0
aGUgYm91bmQgbGlzdCB0byBrZWVwIGl0IHJvdWdobHkgaW4gTFJVIG9yZGVyCi0JICogc28gdGhh
dCB3ZSBkb24ndCBzdGVhbCBmcm9tIHJlY2VudGx5IHVzZWQgYnV0IGluYWN0aXZlIG9iamVjdHMK
LQkgKiAodW5sZXNzIHdlIGFyZSBmb3JjZWQgdG8gb2ZjISkKLQkgKi8KLQlpZiAoaTkxNV9nZW1f
b2JqZWN0X2lzX3Nocmlua2FibGUob2JqKSkKLQkJb2JqX2J1bXBfbXJ1KG9iaik7CiAKLQlpOTE1
X2dlbV9vYmplY3RfcHV0KG9iaik7IC8qIGFuZCBkcm9wIHRoZSBhY3RpdmUgcmVmZXJlbmNlICov
CisJaTkxNV92bWFfcHV0KHZtYSk7CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKgpAQCAt
OTIzLDYgKzg4OSw3IEBAIGludCBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShzdHJ1Y3QgaTkxNV92
bWEgKnZtYSwKIAkJCSAgICB1bnNpZ25lZCBpbnQgZmxhZ3MpCiB7CiAJc3RydWN0IGRybV9pOTE1
X2dlbV9vYmplY3QgKm9iaiA9IHZtYS0+b2JqOworCWludCBlcnI7CiAKIAlhc3NlcnRfdm1hX2hl
bGQodm1hKTsKIAlhc3NlcnRfb2JqZWN0X2hlbGQob2JqKTsKQEAgLTkzNiwxNyArOTAzLDEzIEBA
IGludCBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAkgKiBh
ZGQgdGhlIGFjdGl2ZSByZWZlcmVuY2UgZmlyc3QgYW5kIHF1ZXVlIGZvciBpdCB0byBiZSBkcm9w
cGVkCiAJICogKmxhc3QqLgogCSAqLwotCWlmICghdm1hLT5hY3RpdmUuY291bnQgJiYgIW9iai0+
YWN0aXZlX2NvdW50KyspCi0JCWk5MTVfZ2VtX29iamVjdF9nZXQob2JqKTsgLyogb25jZSBtb3Jl
IGZvciB0aGUgYWN0aXZlIHJlZiAqLwotCi0JaWYgKHVubGlrZWx5KGk5MTVfYWN0aXZlX3JlZigm
dm1hLT5hY3RpdmUsIHJxLT5mZW5jZS5jb250ZXh0LCBycSkpKSB7Ci0JCWlmICghdm1hLT5hY3Rp
dmUuY291bnQgJiYgIS0tb2JqLT5hY3RpdmVfY291bnQpCi0JCQlpOTE1X2dlbV9vYmplY3RfcHV0
KG9iaik7Ci0JCXJldHVybiAtRU5PTUVNOwotCX0KKwlpZiAoaTkxNV9hY3RpdmVfYWNxdWlyZSgm
dm1hLT5hY3RpdmUpKQorCQlpOTE1X3ZtYV9nZXQodm1hKTsKIAotCUdFTV9CVUdfT04oIWk5MTVf
dm1hX2lzX2FjdGl2ZSh2bWEpKTsKLQlHRU1fQlVHX09OKCFvYmotPmFjdGl2ZV9jb3VudCk7CisJ
ZXJyID0gaTkxNV9hY3RpdmVfcmVmKCZ2bWEtPmFjdGl2ZSwgcnEtPmZlbmNlLmNvbnRleHQsIHJx
KTsKKwlpOTE1X2FjdGl2ZV9yZWxlYXNlKCZ2bWEtPmFjdGl2ZSk7CisJaWYgKGVycikKKwkJcmV0
dXJuIGVycjsKIAogCW9iai0+d3JpdGVfZG9tYWluID0gMDsKIAlpZiAoZmxhZ3MgJiBFWEVDX09C
SkVDVF9XUklURSkgewpAQCAtOTU4LDExICs5MjEsMTQgQEAgaW50IGk5MTVfdm1hX21vdmVfdG9f
YWN0aXZlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCQlvYmotPnJlYWRfZG9tYWlucyA9IDA7CiAJ
fQogCW9iai0+cmVhZF9kb21haW5zIHw9IEk5MTVfR0VNX0dQVV9ET01BSU5TOworCW9iai0+bW0u
ZGlydHkgPSB0cnVlOwogCiAJaWYgKGZsYWdzICYgRVhFQ19PQkpFQ1RfTkVFRFNfRkVOQ0UpCiAJ
CV9faTkxNV9hY3RpdmVfcmVxdWVzdF9zZXQoJnZtYS0+bGFzdF9mZW5jZSwgcnEpOwogCiAJZXhw
b3J0X2ZlbmNlKHZtYSwgcnEsIGZsYWdzKTsKKworCUdFTV9CVUdfT04oIWk5MTVfdm1hX2lzX2Fj
dGl2ZSh2bWEpKTsKIAlyZXR1cm4gMDsKIH0KIAotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0Cklu
dGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

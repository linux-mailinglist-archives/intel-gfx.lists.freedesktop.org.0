Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id F2E46F8BAE
	for <lists+intel-gfx@lfdr.de>; Tue, 12 Nov 2019 10:29:22 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 43AC96EA9D;
	Tue, 12 Nov 2019 09:29:17 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 03DE16EA95
 for <intel-gfx@lists.freedesktop.org>; Tue, 12 Nov 2019 09:29:13 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19170033-1500050 
 for multiple; Tue, 12 Nov 2019 09:29:00 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 12 Nov 2019 09:28:54 +0000
Message-Id: <20191112092854.869-27-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191112092854.869-1-chris@chris-wilson.co.uk>
References: <20191112092854.869-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 27/27] drm/i915/selftests: Add coverage of mocs
 registers
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UHJvYmUgdGhlIG1vY3MgcmVnaXN0ZXJzIGZvciBuZXcgY29udGV4dHMgYW5kIGFjcm9zcyBHUFUg
cmVzZXRzLiBTaW1pbGFyCnRvIGludGVsX3dvcmthcm91bmRzLCB3ZSBoYXZlIHRhYmxlcyBvZiB3
aGF0IHJlZ2lzdGVyIHZhbHVlcyB3ZSBleHBlY3QKdG8gc2VlLCBzbyB2ZXJpZnkgdGhhdCB1c2Vy
IGNvbnRleHRzIGFyZSBhZmZlY3RlZCBieSB0aGVtLiBJbiB0aGUKZnV0dXJlLCB3ZSBzaG91bGQg
YWRkIHRlc3RzIHNpbWlsYXIgdG8gaW50ZWxfc3NldSB0byBjb3ZlciBkeW5hbWljCnJlY29uZmln
dXJhdGlvbnMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNv
bi5jby51az4KQ2M6IFByYXRoYXAgS3VtYXIgVmFsc2FuIDxwcmF0aGFwLmt1bWFyLnZhbHNhbkBp
bnRlbC5jb20+CkNjOiBNaWthIEt1b3BwYWxhIDxtaWthLmt1b3BwYWxhQGxpbnV4LmludGVsLmNv
bT4KUmV2aWV3ZWQtYnk6IFByYXRoYXAgS3VtYXIgVmFsc2FuIDxwcmF0aGFwLmt1bWFyLnZhbHNh
bkBpbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbW9jcy5jICAg
ICAgICAgIHwgICA0ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X21vY3MuYyAg
ICAgICB8IDM5MSArKysrKysrKysrKysrKysrKysKIC4uLi9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV9saXZlX3NlbGZ0ZXN0cy5oICB8ICAgMSArCiAzIGZpbGVzIGNoYW5nZWQsIDM5NiBpbnNlcnRp
b25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfbW9jcy5jCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbW9j
cy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbW9jcy5jCmluZGV4IDYzZDBmZGY2
NzIxNS4uMjZlNGU5ZTJkMWQ5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9p
bnRlbF9tb2NzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbW9jcy5jCkBA
IC00NTUsMyArNDU1LDcgQEAgdm9pZCBpbnRlbF9tb2NzX2luaXQoc3RydWN0IGludGVsX2d0ICpn
dCkKIAlpZiAoSEFTX0dMT0JBTF9NT0NTX1JFR0lTVEVSUyhndC0+aTkxNSkpCiAJCWluaXRfZ2xv
YmFsX21vY3MoZ3QpOwogfQorCisjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfU0VMRlRF
U1QpCisjaW5jbHVkZSAic2VsZnRlc3RfbW9jcy5jIgorI2VuZGlmCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9tb2NzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF9tb2NzLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAw
MDAwLi5jN2U2OTUxMzU3NzgKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF9tb2NzLmMKQEAgLTAsMCArMSwzOTEgQEAKKy8qCisgKiBTUERYLUxpY2Vu
c2UtSWRlbnRpZmllcjogTUlUCisgKgorICogQ29weXJpZ2h0IMKpIDIwMTkgSW50ZWwgQ29ycG9y
YXRpb24KKyAqLworCisjaW5jbHVkZSAiZ3QvaW50ZWxfZW5naW5lX3BtLmgiCisjaW5jbHVkZSAi
aTkxNV9zZWxmdGVzdC5oIgorCisjaW5jbHVkZSAiZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRleHQu
aCIKKyNpbmNsdWRlICJzZWxmdGVzdHMvaWd0X3Jlc2V0LmgiCisjaW5jbHVkZSAic2VsZnRlc3Rz
L2lndF9zcGlubmVyLmgiCisKK3N0cnVjdCBsaXZlX21vY3MgeworCXN0cnVjdCBkcm1faTkxNV9t
b2NzX3RhYmxlIHRhYmxlOworCXN0cnVjdCBpOTE1X3ZtYSAqc2NyYXRjaDsKKwl2b2lkICp2YWRk
cjsKK307CisKK3N0YXRpYyBpbnQgcmVxdWVzdF9hZGRfc3luYyhzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycSwgaW50IGVycikKK3sKKwlpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKKwlpOTE1X3JlcXVlc3Rf
YWRkKHJxKTsKKwlpZiAoaTkxNV9yZXF1ZXN0X3dhaXQocnEsIDAsIEhaIC8gNSkgPCAwKQorCQll
cnIgPSAtRVRJTUU7CisJaTkxNV9yZXF1ZXN0X3B1dChycSk7CisKKwlyZXR1cm4gZXJyOworfQor
CitzdGF0aWMgaW50IHJlcXVlc3RfYWRkX3NwaW4oc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsIHN0
cnVjdCBpZ3Rfc3Bpbm5lciAqc3BpbikKK3sKKwlpbnQgZXJyID0gMDsKKworCWk5MTVfcmVxdWVz
dF9nZXQocnEpOworCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCWlmIChzcGluICYmICFpZ3Rfd2Fp
dF9mb3Jfc3Bpbm5lcihzcGluLCBycSkpCisJCWVyciA9IC1FVElNRTsKKwlpOTE1X3JlcXVlc3Rf
cHV0KHJxKTsKKworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKmNy
ZWF0ZV9zY3JhdGNoKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCit7CisJc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iajsKKwlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKKwlpbnQgZXJyOworCisJb2Jq
ID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9pbnRlcm5hbChndC0+aTkxNSwgUEFHRV9TSVpFKTsK
KwlpZiAoSVNfRVJSKG9iaikpCisJCXJldHVybiBFUlJfQ0FTVChvYmopOworCisJaTkxNV9nZW1f
b2JqZWN0X3NldF9jYWNoZV9jb2hlcmVuY3kob2JqLCBJOTE1X0NBQ0hJTkdfQ0FDSEVEKTsKKwor
CXZtYSA9IGk5MTVfdm1hX2luc3RhbmNlKG9iaiwgJmd0LT5nZ3R0LT52bSwgTlVMTCk7CisJaWYg
KElTX0VSUih2bWEpKSB7CisJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwkJcmV0dXJuIHZt
YTsKKwl9CisKKwllcnIgPSBpOTE1X3ZtYV9waW4odm1hLCAwLCAwLCBQSU5fR0xPQkFMKTsKKwlp
ZiAoZXJyKSB7CisJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwkJcmV0dXJuIEVSUl9QVFIo
ZXJyKTsKKwl9CisKKwlyZXR1cm4gdm1hOworfQorCitzdGF0aWMgaW50IGxpdmVfbW9jc19pbml0
KHN0cnVjdCBsaXZlX21vY3MgKmFyZywgc3RydWN0IGludGVsX2d0ICpndCkKK3sKKwlpbnQgZXJy
OworCisJaWYgKCFnZXRfbW9jc19zZXR0aW5ncyhndC0+aTkxNSwgJmFyZy0+dGFibGUpKQorCQly
ZXR1cm4gLUVJTlZBTDsKKworCWFyZy0+c2NyYXRjaCA9IGNyZWF0ZV9zY3JhdGNoKGd0KTsKKwlp
ZiAoSVNfRVJSKGFyZy0+c2NyYXRjaCkpCisJCXJldHVybiBQVFJfRVJSKGFyZy0+c2NyYXRjaCk7
CisKKwlhcmctPnZhZGRyID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl9tYXAoYXJnLT5zY3JhdGNoLT5v
YmosIEk5MTVfTUFQX1dCKTsKKwlpZiAoSVNfRVJSKGFyZy0+dmFkZHIpKSB7CisJCWVyciA9IFBU
Ul9FUlIoYXJnLT52YWRkcik7CisJCWdvdG8gZXJyX3NjcmF0Y2g7CisJfQorCisJcmV0dXJuIDA7
CisKK2Vycl9zY3JhdGNoOgorCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZhcmctPnNjcmF0
Y2gsIDApOworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyB2b2lkIGxpdmVfbW9jc19maW5pKHN0
cnVjdCBsaXZlX21vY3MgKmFyZykKK3sKKwlpOTE1X3ZtYV91bnBpbl9hbmRfcmVsZWFzZSgmYXJn
LT5zY3JhdGNoLCBJOTE1X1ZNQV9SRUxFQVNFX01BUCk7Cit9CisKK3N0YXRpYyBpbnQgcmVhZF9y
ZWdzKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLAorCQkgICAgIHUzMiBhZGRyLCB1bnNpZ25lZCBp
bnQgY291bnQsCisJCSAgICAgdWludDMyX3QgKm9mZnNldCkKK3sKKwl1bnNpZ25lZCBpbnQgaTsK
Kwl1MzIgKmNzOworCisJR0VNX0JVR19PTighSVNfQUxJR05FRCgqb2Zmc2V0LCBzaXplb2YodTMy
KSkpOworCisJY3MgPSBpbnRlbF9yaW5nX2JlZ2luKHJxLCA0ICogY291bnQpOworCWlmIChJU19F
UlIoY3MpKQorCQlyZXR1cm4gUFRSX0VSUihjcyk7CisKKwlmb3IgKGkgPSAwOyBpIDwgY291bnQ7
IGkrKykgeworCQkqY3MrKyA9IE1JX1NUT1JFX1JFR0lTVEVSX01FTV9HRU44IHwgTUlfVVNFX0dH
VFQ7CisJCSpjcysrID0gYWRkcjsKKwkJKmNzKysgPSAqb2Zmc2V0OworCQkqY3MrKyA9IDA7CisK
KwkJYWRkciArPSBzaXplb2YodTMyKTsKKwkJKm9mZnNldCArPSBzaXplb2YodTMyKTsKKwl9CisK
KwlpbnRlbF9yaW5nX2FkdmFuY2UocnEsIGNzKTsKKworCXJldHVybiAwOworfQorCitzdGF0aWMg
aW50IHJlYWRfbW9jc190YWJsZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwKKwkJCSAgIGNvbnN0
IHN0cnVjdCBkcm1faTkxNV9tb2NzX3RhYmxlICp0YWJsZSwKKwkJCSAgIHVpbnQzMl90ICpvZmZz
ZXQpCit7CisJdTMyIGFkZHI7CisKKwlpZiAoSEFTX0dMT0JBTF9NT0NTX1JFR0lTVEVSUyhycS0+
aTkxNSkpCisJCWFkZHIgPSAweDQwMDA7CisJZWxzZQorCQlhZGRyID0gbW9jc19yZWdpc3Rlcihy
cS0+ZW5naW5lKTsKKworCXJldHVybiByZWFkX3JlZ3MocnEsIGFkZHIsIHRhYmxlLT5uX2VudHJp
ZXMsIG9mZnNldCk7Cit9CisKK3N0YXRpYyBpbnQgcmVhZF9sM2NjX3RhYmxlKHN0cnVjdCBpOTE1
X3JlcXVlc3QgKnJxLAorCQkJICAgY29uc3Qgc3RydWN0IGRybV9pOTE1X21vY3NfdGFibGUgKnRh
YmxlLAorCQkJICAgdWludDMyX3QgKm9mZnNldCkKK3sKKwkvKiBDYW4gd2UgcmVhZCB0aGUgTUNS
IHJhbmdlIDB4YjAwIGRpcmVjdGx5PyBTZWUgaW50ZWxfd29ya2Fyb3VuZHMhICovCisJdTMyIGFk
ZHIgPSBpOTE1X21taW9fcmVnX29mZnNldChHRU45X0xOQ0ZDTU9DUygwKSk7CisKKwlyZXR1cm4g
cmVhZF9yZWdzKHJxLCBhZGRyLCAodGFibGUtPm5fZW50cmllcyArIDEpIC8gMiwgb2Zmc2V0KTsK
K30KKworc3RhdGljIGludCBjaGVja19tb2NzX3RhYmxlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZSwKKwkJCSAgICBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfbW9jc190YWJsZSAqdGFibGUs
CisJCQkgICAgdWludDMyX3QgKip2YWRkcikKK3sKKwl1bnNpZ25lZCBpbnQgaTsKKwl1MzIgZXhw
ZWN0OworCisJZm9yX2VhY2hfbW9jcyhleHBlY3QsIHRhYmxlLCBpKSB7CisJCWlmICgqKnZhZGRy
ICE9IGV4cGVjdCkgeworCQkJcHJfZXJyKCIlczogSW52YWxpZCBNT0NTWyVkXSBlbnRyeSwgZm91
bmQgJTA4eCwgZXhwZWN0ZWQgJTA4eFxuIiwKKwkJCSAgICAgICBlbmdpbmUtPm5hbWUsIGksICoq
dmFkZHIsIGV4cGVjdCk7CisJCQlyZXR1cm4gLUVJTlZBTDsKKwkJfQorCQkrKyp2YWRkcjsKKwl9
CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBjaGVja19sM2NjX3RhYmxlKHN0cnVjdCBp
bnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKKwkJCSAgICBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfbW9j
c190YWJsZSAqdGFibGUsCisJCQkgICAgdWludDMyX3QgKip2YWRkcikKK3sKKwl1bnNpZ25lZCBp
bnQgaTsKKwl1MzIgZXhwZWN0OworCisJZm9yX2VhY2hfbDNjYyhleHBlY3QsIHRhYmxlLCBpKSB7
CisJCWlmICgqKnZhZGRyICE9IGV4cGVjdCkgeworCQkJcHJfZXJyKCIlczogSW52YWxpZCBMM0ND
WyVkXSBlbnRyeSwgZm91bmQgJTA4eCwgZXhwZWN0ZWQgJTA4eFxuIiwKKwkJCSAgICAgICBlbmdp
bmUtPm5hbWUsIGksICoqdmFkZHIsIGV4cGVjdCk7CisJCQlyZXR1cm4gLUVJTlZBTDsKKwkJfQor
CQkrKyp2YWRkcjsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBjaGVja19tb2Nz
X2VuZ2luZShzdHJ1Y3QgbGl2ZV9tb2NzICphcmcsCisJCQkgICAgIHN0cnVjdCBpbnRlbF9jb250
ZXh0ICpjZSkKK3sKKwlzdHJ1Y3QgaTkxNV92bWEgKnZtYSA9IGFyZy0+c2NyYXRjaDsKKwlzdHJ1
Y3QgaTkxNV9yZXF1ZXN0ICpycTsKKwl1MzIgb2Zmc2V0OworCXUzMiAqdmFkZHI7CisJaW50IGVy
cjsKKworCW1lbXNldDMyKGFyZy0+dmFkZHIsIFNUQUNLX01BR0lDLCBQQUdFX1NJWkUgLyBzaXpl
b2YodTMyKSk7CisKKwlycSA9IGludGVsX2NvbnRleHRfY3JlYXRlX3JlcXVlc3QoY2UpOworCWlm
IChJU19FUlIocnEpKQorCQlyZXR1cm4gUFRSX0VSUihycSk7CisKKwlpOTE1X3ZtYV9sb2NrKHZt
YSk7CisJZXJyID0gaTkxNV9yZXF1ZXN0X2F3YWl0X29iamVjdChycSwgdm1hLT5vYmosIHRydWUp
OworCWlmICghZXJyKQorCQllcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZSh2bWEsIHJxLCBF
WEVDX09CSkVDVF9XUklURSk7CisJaTkxNV92bWFfdW5sb2NrKHZtYSk7CisKKwlvZmZzZXQgPSBp
OTE1X2dndHRfb2Zmc2V0KHZtYSk7CisJaWYgKCFlcnIpCisJCWVyciA9IHJlYWRfbW9jc190YWJs
ZShycSwgJmFyZy0+dGFibGUsICZvZmZzZXQpOworCWlmICghZXJyICYmIGNlLT5lbmdpbmUtPmNs
YXNzID09IFJFTkRFUl9DTEFTUykKKwkJZXJyID0gcmVhZF9sM2NjX3RhYmxlKHJxLCAmYXJnLT50
YWJsZSwgJm9mZnNldCk7CisJb2Zmc2V0IC09IGk5MTVfZ2d0dF9vZmZzZXQodm1hKTsKKwlHRU1f
QlVHX09OKG9mZnNldCA+IFBBR0VfU0laRSk7CisKKwllcnIgPSByZXF1ZXN0X2FkZF9zeW5jKHJx
LCBlcnIpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwl2YWRkciA9IGFyZy0+dmFkZHI7
CisJaWYgKCFlcnIpCisJCWVyciA9IGNoZWNrX21vY3NfdGFibGUoY2UtPmVuZ2luZSwgJmFyZy0+
dGFibGUsICZ2YWRkcik7CisJaWYgKCFlcnIgJiYgY2UtPmVuZ2luZS0+Y2xhc3MgPT0gUkVOREVS
X0NMQVNTKQorCQllcnIgPSBjaGVja19sM2NjX3RhYmxlKGNlLT5lbmdpbmUsICZhcmctPnRhYmxl
LCAmdmFkZHIpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwlHRU1fQlVHX09OKGFyZy0+
dmFkZHIgKyBvZmZzZXQgIT0gdmFkZHIpOworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGxp
dmVfbW9jc19rZXJuZWwodm9pZCAqYXJnKQoreworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7
CisJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOworCWVudW0gaW50ZWxfZW5naW5lX2lk
IGlkOworCXN0cnVjdCBsaXZlX21vY3MgbW9jczsKKwlpbnQgZXJyOworCisJZXJyID0gbGl2ZV9t
b2NzX2luaXQoJm1vY3MsIGd0KTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJZm9yX2Vh
Y2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7CisJCWVyciA9IGNoZWNrX21vY3NfZW5naW5lKCZt
b2NzLCBlbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKKwkJaWYgKGVycikKKwkJCWJyZWFrOworCX0K
KworCWxpdmVfbW9jc19maW5pKCZtb2NzKTsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgaW50
IGxpdmVfbW9jc19jbGVhbih2b2lkICphcmcpCit7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGFy
ZzsKKwlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CisJZW51bSBpbnRlbF9lbmdpbmVf
aWQgaWQ7CisJc3RydWN0IGxpdmVfbW9jcyBtb2NzOworCWludCBlcnI7CisKKwllcnIgPSBsaXZl
X21vY3NfaW5pdCgmbW9jcywgZ3QpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwlmb3Jf
ZWFjaF9lbmdpbmUoZW5naW5lLCBndCwgaWQpIHsKKwkJc3RydWN0IGludGVsX2NvbnRleHQgKmNl
OworCisJCWNlID0gaW50ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lKTsKKwkJaWYgKElTX0VSUihj
ZSkpIHsKKwkJCWVyciA9IFBUUl9FUlIoY2UpOworCQkJYnJlYWs7CisJCX0KKworCQllcnIgPSBj
aGVja19tb2NzX2VuZ2luZSgmbW9jcywgY2UpOworCQlpbnRlbF9jb250ZXh0X3B1dChjZSk7CisJ
CWlmIChlcnIpCisJCQlicmVhazsKKwl9CisKKwlsaXZlX21vY3NfZmluaSgmbW9jcyk7CisJcmV0
dXJuIGVycjsKK30KKworc3RhdGljIGludCBhY3RpdmVfZW5naW5lX3Jlc2V0KHN0cnVjdCBpbnRl
bF9jb250ZXh0ICpjZSwKKwkJCSAgICAgICBjb25zdCBjaGFyICpyZWFzb24pCit7CisJc3RydWN0
IGlndF9zcGlubmVyIHNwaW47CisJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CisJaW50IGVycjsK
KworCWVyciA9IGlndF9zcGlubmVyX2luaXQoJnNwaW4sIGNlLT5lbmdpbmUtPmd0KTsKKwlpZiAo
ZXJyKQorCQlyZXR1cm4gZXJyOworCisJcnEgPSBpZ3Rfc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgm
c3BpbiwgY2UsIE1JX05PT1ApOworCWlmIChJU19FUlIocnEpKSB7CisJCWlndF9zcGlubmVyX2Zp
bmkoJnNwaW4pOworCQlyZXR1cm4gUFRSX0VSUihycSk7CisJfQorCisJZXJyID0gcmVxdWVzdF9h
ZGRfc3BpbihycSwgJnNwaW4pOworCWlmIChlcnIgPT0gMCkKKwkJZXJyID0gaW50ZWxfZW5naW5l
X3Jlc2V0KGNlLT5lbmdpbmUsIHJlYXNvbik7CisKKwlpZ3Rfc3Bpbm5lcl9lbmQoJnNwaW4pOwor
CWlndF9zcGlubmVyX2ZpbmkoJnNwaW4pOworCisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIGlu
dCBfX2xpdmVfbW9jc19yZXNldChzdHJ1Y3QgbGl2ZV9tb2NzICptb2NzLAorCQkJICAgICBzdHJ1
Y3QgaW50ZWxfY29udGV4dCAqY2UpCit7CisJaW50IGVycjsKKworCWVyciA9IGludGVsX2VuZ2lu
ZV9yZXNldChjZS0+ZW5naW5lLCAibW9jcyIpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisK
KwllcnIgPSBjaGVja19tb2NzX2VuZ2luZShtb2NzLCBjZSk7CisJaWYgKGVycikKKwkJcmV0dXJu
IGVycjsKKworCWVyciA9IGFjdGl2ZV9lbmdpbmVfcmVzZXQoY2UsICJtb2NzIik7CisJaWYgKGVy
cikKKwkJcmV0dXJuIGVycjsKKworCWVyciA9IGNoZWNrX21vY3NfZW5naW5lKG1vY3MsIGNlKTsK
KwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQg
bGl2ZV9tb2NzX3Jlc2V0KHZvaWQgKmFyZykKK3sKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJn
OworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKKwllbnVtIGludGVsX2VuZ2luZV9p
ZCBpZDsKKwlzdHJ1Y3QgbGl2ZV9tb2NzIG1vY3M7CisJaW50IGVyciA9IDA7CisKKwlpZiAoIWlu
dGVsX2hhc19yZXNldF9lbmdpbmUoZ3QpKQorCQlyZXR1cm4gMDsKKworCWVyciA9IGxpdmVfbW9j
c19pbml0KCZtb2NzLCBndCk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWlndF9nbG9i
YWxfcmVzZXRfbG9jayhndCk7CisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7CisJ
CXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKKworCQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRl
KGVuZ2luZSk7CisJCWlmIChJU19FUlIoY2UpKSB7CisJCQllcnIgPSBQVFJfRVJSKGNlKTsKKwkJ
CWJyZWFrOworCQl9CisKKwkJaW50ZWxfZW5naW5lX3BtX2dldChlbmdpbmUpOworCQllcnIgPSBf
X2xpdmVfbW9jc19yZXNldCgmbW9jcywgY2UpOworCQlpbnRlbF9lbmdpbmVfcG1fcHV0KGVuZ2lu
ZSk7CisKKwkJaW50ZWxfY29udGV4dF9wdXQoY2UpOworCQlpZiAoZXJyKQorCQkJYnJlYWs7CisJ
fQorCWlndF9nbG9iYWxfcmVzZXRfdW5sb2NrKGd0KTsKKworCWxpdmVfbW9jc19maW5pKCZtb2Nz
KTsKKwlyZXR1cm4gZXJyOworfQorCitpbnQgaW50ZWxfbW9jc19saXZlX3NlbGZ0ZXN0cyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3sKKwlzdGF0aWMgY29uc3Qgc3RydWN0IGk5MTVf
c3VidGVzdCB0ZXN0c1tdID0geworCQlTVUJURVNUKGxpdmVfbW9jc19rZXJuZWwpLAorCQlTVUJU
RVNUKGxpdmVfbW9jc19jbGVhbiksCisJCVNVQlRFU1QobGl2ZV9tb2NzX3Jlc2V0KSwKKwl9Owor
CXN0cnVjdCBkcm1faTkxNV9tb2NzX3RhYmxlIHRhYmxlOworCisJaWYgKCFnZXRfbW9jc19zZXR0
aW5ncyhpOTE1LCAmdGFibGUpKQorCQlyZXR1cm4gMDsKKworCXJldHVybiBpbnRlbF9ndF9saXZl
X3N1YnRlc3RzKHRlc3RzLCAmaTkxNS0+Z3QpOworfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxmdGVzdHMuaCBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2xpdmVfc2VsZnRlc3RzLmgKaW5kZXggNGIzY2FjNzNlMjkx
Li4xMWI0MGJjNThlNmQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pOTE1X2xpdmVfc2VsZnRlc3RzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2k5MTVfbGl2ZV9zZWxmdGVzdHMuaApAQCAtMTYsNiArMTYsNyBAQCBzZWxmdGVzdChndF9l
bmdpbmVzLCBpbnRlbF9lbmdpbmVfbGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChndF90aW1lbGlu
ZXMsIGludGVsX3RpbWVsaW5lX2xpdmVfc2VsZnRlc3RzKQogc2VsZnRlc3QoZ3RfY29udGV4dHMs
IGludGVsX2NvbnRleHRfbGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChndF9scmMsIGludGVsX2xy
Y19saXZlX3NlbGZ0ZXN0cykKK3NlbGZ0ZXN0KGd0X21vY3MsIGludGVsX21vY3NfbGl2ZV9zZWxm
dGVzdHMpCiBzZWxmdGVzdChndF9wbSwgaW50ZWxfZ3RfcG1fbGl2ZV9zZWxmdGVzdHMpCiBzZWxm
dGVzdChndF9oZWFydGJlYXQsIGludGVsX2hlYXJ0YmVhdF9saXZlX3NlbGZ0ZXN0cykKIHNlbGZ0
ZXN0KHJlcXVlc3RzLCBpOTE1X3JlcXVlc3RfbGl2ZV9zZWxmdGVzdHMpCi0tIAoyLjI0LjAKCl9f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBt
YWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3Rz
LmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

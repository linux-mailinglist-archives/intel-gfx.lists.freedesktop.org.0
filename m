Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id E2679E0365
	for <lists+intel-gfx@lfdr.de>; Tue, 22 Oct 2019 13:51:51 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 4353C6E5F8;
	Tue, 22 Oct 2019 11:51:49 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id F40596E5F5
 for <intel-gfx@lists.freedesktop.org>; Tue, 22 Oct 2019 11:51:45 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18924478-1500050 
 for multiple; Tue, 22 Oct 2019 12:51:39 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Tue, 22 Oct 2019 12:51:26 +0100
Message-Id: <20191022115126.18746-4-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0.rc0
In-Reply-To: <20191022115126.18746-1-chris@chris-wilson.co.uk>
References: <20191022115126.18746-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 4/4] drm/i915/selftests: Add coverage of mocs
 registers
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UHJvYmUgdGhlIG1vY3MgcmVnaXN0ZXJzIGZvciBuZXcgY29udGV4dHMgYW5kIGFjcm9zcyBHUFUg
cmVzZXRzLiBTaW1pbGFyCnRvIGludGVsX3dvcmthcm91bmRzLCB3ZSBoYXZlIHRhYmxlcyBvZiB3
aGF0IHJlZ2lzdGVyIHZhbHVlcyB3ZSBleHBlY3QKdG8gc2VlLCBzbyB2ZXJpZnkgdGhhdCB1c2Vy
IGNvbnRleHRzIGFyZSBhZmZlY3RlZCBieSB0aGVtLiBJbiB0aGUKZnV0dXJlLCB3ZSBzaG91bGQg
YWRkIHRlc3RzIHNpbWlsYXIgdG8gaW50ZWxfc3NldSB0byBjb3ZlciBkeW5hbWljCnJlY29uZmln
dXJhdGlvbnMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNv
bi5jby51az4KQ2M6IFByYXRoYXAgS3VtYXIgVmFsc2FuIDxwcmF0aGFwLmt1bWFyLnZhbHNhbkBp
bnRlbC5jb20+CkNjOiBNaWthIEt1b3BwYWxhIDxtaWthLmt1b3BwYWxhQGxpbnV4LmludGVsLmNv
bT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9tb2NzLmMgICAgICAgICAgfCAg
IDQgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbW9jcy5jICAgICAgIHwgNDA1
ICsrKysrKysrKysrKysrKysrKwogLi4uL2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2xpdmVfc2Vs
ZnRlc3RzLmggIHwgICAxICsKIDMgZmlsZXMgY2hhbmdlZCwgNDEwIGluc2VydGlvbnMoKykKIGNy
ZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9tb2NzLmMK
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9tb2NzLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9tb2NzLmMKaW5kZXggNDQ1ZWMwMjViZGEwLi4wNmRi
YTdmZjI5NGUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX21vY3Mu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9tb2NzLmMKQEAgLTQ0OCwzICs0
NDgsNyBAQCB2b2lkIGludGVsX21vY3NfaW5pdChzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogCWlmIChI
QVNfR0xPQkFMX01PQ1NfUkVHSVNURVJTKGd0LT5pOTE1KSkKIAkJaW5pdF9nbG9iYWxfbW9jcyhn
dCk7CiB9CisKKyNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9TRUxGVEVTVCkKKyNpbmNs
dWRlICJzZWxmdGVzdF9tb2NzLmMiCisjZW5kaWYKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L3NlbGZ0ZXN0X21vY3MuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X21vY3MuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmY0ZGZi
MzZmNDUwZAotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0
ZXN0X21vY3MuYwpAQCAtMCwwICsxLDQwNSBAQAorLyoKKyAqIFNQRFgtTGljZW5zZS1JZGVudGlm
aWVyOiBNSVQKKyAqCisgKiBDb3B5cmlnaHQgwqkgMjAxOSBJbnRlbCBDb3Jwb3JhdGlvbgorICov
CisKKyNpbmNsdWRlICJndC9pbnRlbF9lbmdpbmVfcG0uaCIKKyNpbmNsdWRlICJpOTE1X3NlbGZ0
ZXN0LmgiCisKKyNpbmNsdWRlICJnZW0vc2VsZnRlc3RzL21vY2tfY29udGV4dC5oIgorI2luY2x1
ZGUgInNlbGZ0ZXN0cy9pZ3RfcmVzZXQuaCIKKyNpbmNsdWRlICJzZWxmdGVzdHMvaWd0X3NwaW5u
ZXIuaCIKKworc3RydWN0IGxpdmVfbW9jcyB7CisJc3RydWN0IGRybV9pOTE1X21vY3NfdGFibGUg
dGFibGU7CisJc3RydWN0IGk5MTVfdm1hICpzY3JhdGNoOworCXZvaWQgKnZhZGRyOworfTsKKwor
c3RhdGljIGludCByZXF1ZXN0X2FkZF9zeW5jKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBpbnQg
ZXJyKQoreworCWk5MTVfcmVxdWVzdF9nZXQocnEpOworCWk5MTVfcmVxdWVzdF9hZGQocnEpOwor
CWlmIChpOTE1X3JlcXVlc3Rfd2FpdChycSwgMCwgSFogLyA1KSA8IDApCisJCWVyciA9IC1FVElN
RTsKKwlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKKworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBp
bnQgcmVxdWVzdF9hZGRfc3BpbihzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgc3RydWN0IGlndF9z
cGlubmVyICpzcGluKQoreworCWludCBlcnIgPSAwOworCisJaTkxNV9yZXF1ZXN0X2dldChycSk7
CisJaTkxNV9yZXF1ZXN0X2FkZChycSk7CisJaWYgKHNwaW4gJiYgIWlndF93YWl0X2Zvcl9zcGlu
bmVyKHNwaW4sIHJxKSkKKwkJZXJyID0gLUVUSU1FOworCWk5MTVfcmVxdWVzdF9wdXQocnEpOwor
CisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqY3JlYXRlX3NjcmF0
Y2goc3RydWN0IGludGVsX2d0ICpndCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqOworCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOworCWludCBlcnI7CisKKwlvYmogPSBpOTE1X2dl
bV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGd0LT5pOTE1LCBQQUdFX1NJWkUpOworCWlmIChJU19F
UlIob2JqKSkKKwkJcmV0dXJuIEVSUl9DQVNUKG9iaik7CisKKwlpOTE1X2dlbV9vYmplY3Rfc2V0
X2NhY2hlX2NvaGVyZW5jeShvYmosIEk5MTVfQ0FDSElOR19DQUNIRUQpOworCisJdm1hID0gaTkx
NV92bWFfaW5zdGFuY2Uob2JqLCAmZ3QtPmdndHQtPnZtLCBOVUxMKTsKKwlpZiAoSVNfRVJSKHZt
YSkpIHsKKwkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCQlyZXR1cm4gdm1hOworCX0KKwor
CWVyciA9IGk5MTVfdm1hX3Bpbih2bWEsIDAsIDAsIFBJTl9HTE9CQUwpOworCWlmIChlcnIpIHsK
KwkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCQlyZXR1cm4gRVJSX1BUUihlcnIpOworCX0K
KworCXJldHVybiB2bWE7Cit9CisKK3N0YXRpYyBpbnQgbGl2ZV9tb2NzX2luaXQoc3RydWN0IGxp
dmVfbW9jcyAqYXJnLCBzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQoreworCWludCBlcnI7CisKKwlpZiAo
IWdldF9tb2NzX3NldHRpbmdzKGd0LT5pOTE1LCAmYXJnLT50YWJsZSkpCisJCXJldHVybiAtRUlO
VkFMOworCisJYXJnLT5zY3JhdGNoID0gY3JlYXRlX3NjcmF0Y2goZ3QpOworCWlmIChJU19FUlIo
YXJnLT5zY3JhdGNoKSkKKwkJcmV0dXJuIFBUUl9FUlIoYXJnLT5zY3JhdGNoKTsKKworCWFyZy0+
dmFkZHIgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcChhcmctPnNjcmF0Y2gtPm9iaiwgSTkxNV9N
QVBfV0IpOworCWlmIChJU19FUlIoYXJnLT52YWRkcikpIHsKKwkJZXJyID0gUFRSX0VSUihhcmct
PnZhZGRyKTsKKwkJZ290byBlcnJfc2NyYXRjaDsKKwl9CisKKwlyZXR1cm4gMDsKKworZXJyX3Nj
cmF0Y2g6CisJaTkxNV92bWFfdW5waW5fYW5kX3JlbGVhc2UoJmFyZy0+c2NyYXRjaCwgMCk7CisJ
cmV0dXJuIGVycjsKK30KKworc3RhdGljIHZvaWQgbGl2ZV9tb2NzX2Zpbmkoc3RydWN0IGxpdmVf
bW9jcyAqYXJnKQoreworCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZhcmctPnNjcmF0Y2gs
IEk5MTVfVk1BX1JFTEVBU0VfTUFQKTsKK30KKworc3RhdGljIGludCByZWFkX21vY3NfdGFibGUo
c3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCisJCQkgICBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfbW9j
c190YWJsZSAqdGFibGUsCisJCQkgICB1aW50MzJfdCAqb2Zmc2V0KQoreworCXVuc2lnbmVkIGlu
dCBpOworCXUzMiBhZGRyOworCXUzMiAqY3M7CisKKwlHRU1fQlVHX09OKCFJU19BTElHTkVEKCpv
ZmZzZXQsIHNpemVvZih1MzIpKSk7CisKKwlpZiAoSEFTX0dMT0JBTF9NT0NTX1JFR0lTVEVSUyhy
cS0+aTkxNSkpCisJCWFkZHIgPSAweDQwMDA7CisJZWxzZQorCQlhZGRyID0gbW9jc19yZWdpc3Rl
cihycS0+ZW5naW5lKTsKKworCWNzID0gaW50ZWxfcmluZ19iZWdpbihycSwgNCAqIHRhYmxlLT5u
X2VudHJpZXMpOworCWlmIChJU19FUlIoY3MpKQorCQlyZXR1cm4gUFRSX0VSUihjcyk7CisKKwlm
b3IgKGkgPSAwOyBpIDwgdGFibGUtPm5fZW50cmllczsgaSsrKSB7CisJCSpjcysrID0gTUlfU1RP
UkVfUkVHSVNURVJfTUVNX0dFTjggfCBNSV9VU0VfR0dUVDsKKwkJKmNzKysgPSBhZGRyOworCQkq
Y3MrKyA9ICpvZmZzZXQ7CisJCSpjcysrID0gMDsKKworCQlhZGRyICs9IHNpemVvZih1MzIpOwor
CQkqb2Zmc2V0ICs9IHNpemVvZih1MzIpOworCX0KKworCWludGVsX3JpbmdfYWR2YW5jZShycSwg
Y3MpOworCisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgcmVhZF9sM2NjX3RhYmxlKHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxLAorCQkJICAgY29uc3Qgc3RydWN0IGRybV9pOTE1X21vY3NfdGFi
bGUgKnRhYmxlLAorCQkJICAgdWludDMyX3QgKm9mZnNldCkKK3sKKwl1MzIgYWRkciA9IGk5MTVf
bW1pb19yZWdfb2Zmc2V0KEdFTjlfTE5DRkNNT0NTKDApKTsKKwl1bnNpZ25lZCBpbnQgaTsKKwl1
MzIgKmNzOworCisJR0VNX0JVR19PTighSVNfQUxJR05FRCgqb2Zmc2V0LCBzaXplb2YodTMyKSkp
OworCisJY3MgPSBpbnRlbF9yaW5nX2JlZ2luKHJxLCAodGFibGUtPm5fZW50cmllcyArIDEpIC8g
MiAqIDQpOworCWlmIChJU19FUlIoY3MpKQorCQlyZXR1cm4gUFRSX0VSUihjcyk7CisKKwkvKiBD
YW4gd2UgcmVhZCB0aGUgTUNSIHJhbmdlIDB4YjAwIGRpcmVjdGx5PyBTZWUgaW50ZWxfd29ya2Fy
b3VuZHMhICovCisJZm9yIChpID0gMDsgaSA8ICh0YWJsZS0+bl9lbnRyaWVzICsgMSkgLyAyOyBp
KyspIHsKKwkJKmNzKysgPSBNSV9TVE9SRV9SRUdJU1RFUl9NRU1fR0VOOCB8IE1JX1VTRV9HR1RU
OworCQkqY3MrKyA9IGFkZHI7CisJCSpjcysrID0gKm9mZnNldDsKKwkJKmNzKysgPSAwOworCisJ
CWFkZHIgKz0gc2l6ZW9mKHUzMik7CisJCSpvZmZzZXQgKz0gc2l6ZW9mKHUzMik7CisJfQorCisJ
aW50ZWxfcmluZ19hZHZhbmNlKHJxLCBjcyk7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGlu
dCBjaGVja19tb2NzX3RhYmxlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKKwkJCSAg
ICBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfbW9jc190YWJsZSAqdGFibGUsCisJCQkgICAgdWludDMy
X3QgKip2YWRkcikKK3sKKwl1bnNpZ25lZCBpbnQgaTsKKwl1MzIgZXhwZWN0OworCisJZm9yX2Vh
Y2hfbW9jcyhleHBlY3QsIHRhYmxlLCBpKSB7CisJCWlmICgqKnZhZGRyICE9IGV4cGVjdCkgewor
CQkJcHJfZXJyKCIlczogSW52YWxpZCBNT0NTWyVkXSBlbnRyeSwgZm91bmQgJTA4eCwgZXhwZWN0
ZWQgJTA4eFxuIiwKKwkJCSAgICAgICBlbmdpbmUtPm5hbWUsIGksICoqdmFkZHIsIGV4cGVjdCk7
CisJCQlyZXR1cm4gLUVJTlZBTDsKKwkJfQorCQkrKyp2YWRkcjsKKwl9CisKKwlyZXR1cm4gMDsK
K30KKworc3RhdGljIGludCBjaGVja19sM2NjX3RhYmxlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZSwKKwkJCSAgICBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfbW9jc190YWJsZSAqdGFibGUs
CisJCQkgICAgdWludDMyX3QgKip2YWRkcikKK3sKKwl1bnNpZ25lZCBpbnQgaTsKKwl1MzIgZXhw
ZWN0OworCisJZm9yX2VhY2hfbDNjYyhleHBlY3QsIHRhYmxlLCBpKSB7CisJCWlmICgqKnZhZGRy
ICE9IGV4cGVjdCkgeworCQkJcHJfZXJyKCIlczogSW52YWxpZCBMM0NDWyVkXSBlbnRyeSwgZm91
bmQgJTA4eCwgZXhwZWN0ZWQgJTA4eFxuIiwKKwkJCSAgICAgICBlbmdpbmUtPm5hbWUsIGksICoq
dmFkZHIsIGV4cGVjdCk7CisJCQlyZXR1cm4gLUVJTlZBTDsKKwkJfQorCQkrKyp2YWRkcjsKKwl9
CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBjaGVja19tb2NzX2VuZ2luZShzdHJ1Y3Qg
bGl2ZV9tb2NzICphcmcsCisJCQkgICAgIHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKK3sKKwlz
dHJ1Y3QgaTkxNV92bWEgKnZtYSA9IGFyZy0+c2NyYXRjaDsKKwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycTsKKwl1MzIgb2Zmc2V0OworCXUzMiAqdmFkZHI7CisJaW50IGVycjsKKworCW1lbXNldDMy
KGFyZy0+dmFkZHIsIFNUQUNLX01BR0lDLCBQQUdFX1NJWkUgLyBzaXplb2YodTMyKSk7CisKKwly
cSA9IGludGVsX2NvbnRleHRfY3JlYXRlX3JlcXVlc3QoY2UpOworCWlmIChJU19FUlIocnEpKQor
CQlyZXR1cm4gUFRSX0VSUihycSk7CisKKwlpOTE1X3ZtYV9sb2NrKHZtYSk7CisJZXJyID0gaTkx
NV9yZXF1ZXN0X2F3YWl0X29iamVjdChycSwgdm1hLT5vYmosIHRydWUpOworCWlmICghZXJyKQor
CQllcnIgPSBpOTE1X3ZtYV9tb3ZlX3RvX2FjdGl2ZSh2bWEsIHJxLCBFWEVDX09CSkVDVF9XUklU
RSk7CisJaTkxNV92bWFfdW5sb2NrKHZtYSk7CisKKwlvZmZzZXQgPSBpOTE1X2dndHRfb2Zmc2V0
KHZtYSk7CisJaWYgKCFlcnIpCisJCWVyciA9IHJlYWRfbW9jc190YWJsZShycSwgJmFyZy0+dGFi
bGUsICZvZmZzZXQpOworCWlmICghZXJyICYmIGNlLT5lbmdpbmUtPmNsYXNzID09IFJFTkRFUl9D
TEFTUykKKwkJZXJyID0gcmVhZF9sM2NjX3RhYmxlKHJxLCAmYXJnLT50YWJsZSwgJm9mZnNldCk7
CisJb2Zmc2V0IC09IGk5MTVfZ2d0dF9vZmZzZXQodm1hKTsKKwlHRU1fQlVHX09OKG9mZnNldCA+
IFBBR0VfU0laRSk7CisKKwllcnIgPSByZXF1ZXN0X2FkZF9zeW5jKHJxLCBlcnIpOworCWlmIChl
cnIpCisJCXJldHVybiBlcnI7CisKKwl2YWRkciA9IGFyZy0+dmFkZHI7CisJaWYgKCFlcnIpCisJ
CWVyciA9IGNoZWNrX21vY3NfdGFibGUoY2UtPmVuZ2luZSwgJmFyZy0+dGFibGUsICZ2YWRkcik7
CisJaWYgKCFlcnIgJiYgY2UtPmVuZ2luZS0+Y2xhc3MgPT0gUkVOREVSX0NMQVNTKQorCQllcnIg
PSBjaGVja19sM2NjX3RhYmxlKGNlLT5lbmdpbmUsICZhcmctPnRhYmxlLCAmdmFkZHIpOworCWlm
IChlcnIpCisJCXJldHVybiBlcnI7CisKKwlHRU1fQlVHX09OKGFyZy0+dmFkZHIgKyBvZmZzZXQg
IT0gdmFkZHIpOworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGxpdmVfbW9jc19rZXJuZWwo
dm9pZCAqYXJnKQoreworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CisJc3RydWN0IGludGVs
X2VuZ2luZV9jcyAqZW5naW5lOworCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOworCXN0cnVjdCBs
aXZlX21vY3MgbW9jczsKKwlpbnQgZXJyOworCisJZXJyID0gbGl2ZV9tb2NzX2luaXQoJm1vY3Ms
IGd0KTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJZm9yX2VhY2hfZW5naW5lKGVuZ2lu
ZSwgZ3QsIGlkKSB7CisJCWVyciA9IGNoZWNrX21vY3NfZW5naW5lKCZtb2NzLCBlbmdpbmUtPmtl
cm5lbF9jb250ZXh0KTsKKwkJaWYgKGVycikKKwkJCWJyZWFrOworCX0KKworCWxpdmVfbW9jc19m
aW5pKCZtb2NzKTsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgaW50IGxpdmVfbW9jc19jbGVh
bih2b2lkICphcmcpCit7CisJc3RydWN0IGludGVsX2d0ICpndCA9IGFyZzsKKwlzdHJ1Y3QgaW50
ZWxfZW5naW5lX2NzICplbmdpbmU7CisJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CisJc3RydWN0
IGxpdmVfbW9jcyBtb2NzOworCWludCBlcnI7CisKKwllcnIgPSBsaXZlX21vY3NfaW5pdCgmbW9j
cywgZ3QpOworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwlmb3JfZWFjaF9lbmdpbmUoZW5n
aW5lLCBndCwgaWQpIHsKKwkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOworCisJCWNlID0gaW50
ZWxfY29udGV4dF9jcmVhdGUoZW5naW5lLT5rZXJuZWxfY29udGV4dC0+Z2VtX2NvbnRleHQsCisJ
CQkJCSAgZW5naW5lKTsKKwkJaWYgKElTX0VSUihjZSkpIHsKKwkJCWVyciA9IFBUUl9FUlIoY2Up
OworCQkJYnJlYWs7CisJCX0KKworCQllcnIgPSBjaGVja19tb2NzX2VuZ2luZSgmbW9jcywgY2Up
OworCQlpbnRlbF9jb250ZXh0X3B1dChjZSk7CisJCWlmIChlcnIpCisJCQlicmVhazsKKwl9CisK
KwlsaXZlX21vY3NfZmluaSgmbW9jcyk7CisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIGludCBh
Y3RpdmVfZW5naW5lX3Jlc2V0KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKKwkJCSAgICAgICBj
b25zdCBjaGFyICpyZWFzb24pCit7CisJc3RydWN0IGlndF9zcGlubmVyIHNwaW47CisJc3RydWN0
IGk5MTVfcmVxdWVzdCAqcnE7CisJaW50IGVycjsKKworCWVyciA9IGlndF9zcGlubmVyX2luaXQo
JnNwaW4sIGNlLT5lbmdpbmUtPmd0KTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJcnEg
PSBpZ3Rfc3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmc3BpbiwgY2UsIE1JX05PT1ApOworCWlmIChJ
U19FUlIocnEpKSB7CisJCWlndF9zcGlubmVyX2ZpbmkoJnNwaW4pOworCQlyZXR1cm4gUFRSX0VS
UihycSk7CisJfQorCisJZXJyID0gcmVxdWVzdF9hZGRfc3BpbihycSwgJnNwaW4pOworCWlmIChl
cnIgPT0gMCkKKwkJZXJyID0gaW50ZWxfZW5naW5lX3Jlc2V0KGNlLT5lbmdpbmUsIHJlYXNvbik7
CisKKwlpZ3Rfc3Bpbm5lcl9lbmQoJnNwaW4pOworCWlndF9zcGlubmVyX2ZpbmkoJnNwaW4pOwor
CisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIGludCBfX2xpdmVfbW9jc19yZXNldChzdHJ1Y3Qg
bGl2ZV9tb2NzICptb2NzLAorCQkJICAgICBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCit7CisJ
aW50IGVycjsKKworCWVyciA9IGludGVsX2VuZ2luZV9yZXNldChjZS0+ZW5naW5lLCAibW9jcyIp
OworCWlmIChlcnIpCisJCXJldHVybiBlcnI7CisKKwllcnIgPSBjaGVja19tb2NzX2VuZ2luZSht
b2NzLCBjZSk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWVyciA9IGFjdGl2ZV9lbmdp
bmVfcmVzZXQoY2UsICJtb2NzIik7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWVyciA9
IGNoZWNrX21vY3NfZW5naW5lKG1vY3MsIGNlKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOwor
CisJcmV0dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgbGl2ZV9tb2NzX3Jlc2V0KHZvaWQgKmFyZykK
K3sKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3Mg
KmVuZ2luZTsKKwllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKKwlzdHJ1Y3QgbGl2ZV9tb2NzIG1v
Y3M7CisJaW50IGVyciA9IDA7CisKKwlpZiAoIWludGVsX2hhc19yZXNldF9lbmdpbmUoZ3QpKQor
CQlyZXR1cm4gMDsKKworCWVyciA9IGxpdmVfbW9jc19pbml0KCZtb2NzLCBndCk7CisJaWYgKGVy
cikKKwkJcmV0dXJuIGVycjsKKworCWlndF9nbG9iYWxfcmVzZXRfbG9jayhndCk7CisJZm9yX2Vh
Y2hfZW5naW5lKGVuZ2luZSwgZ3QsIGlkKSB7CisJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsK
KworCQljZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZS0+a2VybmVsX2NvbnRleHQtPmdl
bV9jb250ZXh0LAorCQkJCQkgIGVuZ2luZSk7CisJCWlmIChJU19FUlIoY2UpKSB7CisJCQllcnIg
PSBQVFJfRVJSKGNlKTsKKwkJCWJyZWFrOworCQl9CisKKwkJaW50ZWxfZW5naW5lX3BtX2dldChl
bmdpbmUpOworCQllcnIgPSBfX2xpdmVfbW9jc19yZXNldCgmbW9jcywgY2UpOworCQlpbnRlbF9l
bmdpbmVfcG1fcHV0KGVuZ2luZSk7CisKKwkJaW50ZWxfY29udGV4dF9wdXQoY2UpOworCQlpZiAo
ZXJyKQorCQkJYnJlYWs7CisJfQorCWlndF9nbG9iYWxfcmVzZXRfdW5sb2NrKGd0KTsKKworCWxp
dmVfbW9jc19maW5pKCZtb2NzKTsKKwlyZXR1cm4gZXJyOworfQorCitpbnQgaW50ZWxfbW9jc19s
aXZlX3NlbGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3sKKwlzdGF0aWMg
Y29uc3Qgc3RydWN0IGk5MTVfc3VidGVzdCB0ZXN0c1tdID0geworCQlTVUJURVNUKGxpdmVfbW9j
c19rZXJuZWwpLAorCQlTVUJURVNUKGxpdmVfbW9jc19jbGVhbiksCisJCVNVQlRFU1QobGl2ZV9t
b2NzX3Jlc2V0KSwKKwl9OworCXN0cnVjdCBkcm1faTkxNV9tb2NzX3RhYmxlIHRhYmxlOworCisJ
aWYgKCFnZXRfbW9jc19zZXR0aW5ncyhpOTE1LCAmdGFibGUpKQorCQlyZXR1cm4gMDsKKworCXJl
dHVybiBpbnRlbF9ndF9saXZlX3N1YnRlc3RzKHRlc3RzLCAmaTkxNS0+Z3QpOworfQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxmdGVzdHMu
aCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2xpdmVfc2VsZnRlc3RzLmgK
aW5kZXggMDBhMDYzNzMwYmMzLi5jMjNkMDZiY2EwOWUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2xpdmVfc2VsZnRlc3RzLmgKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxmdGVzdHMuaApAQCAtMTYsNiArMTYs
NyBAQCBzZWxmdGVzdChndF9lbmdpbmVzLCBpbnRlbF9lbmdpbmVfbGl2ZV9zZWxmdGVzdHMpCiBz
ZWxmdGVzdChndF90aW1lbGluZXMsIGludGVsX3RpbWVsaW5lX2xpdmVfc2VsZnRlc3RzKQogc2Vs
ZnRlc3QoZ3RfY29udGV4dHMsIGludGVsX2NvbnRleHRfbGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVz
dChndF9scmMsIGludGVsX2xyY19saXZlX3NlbGZ0ZXN0cykKK3NlbGZ0ZXN0KGd0X21vY3MsIGlu
dGVsX21vY3NfbGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChndF9wbSwgaW50ZWxfZ3RfcG1fbGl2
ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChndF9oZWFydGJlYXQsIGludGVsX2hlYXJ0YmVhdF9saXZl
X3NlbGZ0ZXN0cykKIHNlbGZ0ZXN0KHJlcXVlc3RzLCBpOTE1X3JlcXVlc3RfbGl2ZV9zZWxmdGVz
dHMpCi0tIAoyLjI0LjAucmMwCgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVz
a3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9p
bnRlbC1nZng=

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 3587E48B7A
	for <lists+intel-gfx@lfdr.de>; Mon, 17 Jun 2019 20:10:32 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 49F90892BF;
	Mon, 17 Jun 2019 18:10:30 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga05.intel.com (mga05.intel.com [192.55.52.43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 29550892BF
 for <intel-gfx@lists.freedesktop.org>; Mon, 17 Jun 2019 18:10:28 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga003.jf.intel.com ([10.7.209.27])
 by fmsmga105.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 17 Jun 2019 11:10:27 -0700
X-ExtLoop1: 1
Received: from dceraolo-linux.fm.intel.com ([10.1.27.145])
 by orsmga003.jf.intel.com with ESMTP; 17 Jun 2019 11:10:27 -0700
From: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 17 Jun 2019 11:09:33 -0700
Message-Id: <20190617180935.505-5-daniele.ceraolospurio@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190617180935.505-1-daniele.ceraolospurio@intel.com>
References: <20190617180935.505-1-daniele.ceraolospurio@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 4/6] drm/i915: skip forcewake actions on
 forcewake-less uncore
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgYWx3YXlzIGNhbGwgc29tZSBvZiB0aGUgc2V0dXAvY2xlYW51cCBmdW5jdGlvbnMgZm9yIGZv
cmNld2FrZSwgZXZlbgppZiB0aGUgZmVhdHVyZSBpcyBub3QgYWN0dWFsbHkgYXZhaWxhYmxlLiBT
a2lwcGluZyB0aGVzZSBvcGVyYXRpb25zIGlmCmZvcmNld2FrZSBpcyBub3QgYXZhaWxhYmxlIHNh
dmVzIHVzIHNvbWUgb3BlcmF0aW9ucyBvbiBvbGRlciBnZW5zIGFuZApwcmVwYXJlcyB1cyBmb3Ig
aGF2aW5nIGEgZm9yY2V3YWtlLWxlc3MgZGlzcGxheSB1bmNvcmUuClRoZSBzdXNwZW5kL3Jlc3Vt
ZSBmdW5jdGlvbnMgaGF2ZSBhbHNvIGJlZW4gcmVuYW1lZCB0byBjbGVhcmx5IGluZGljYXRlCnRo
YXQgdGhleSBvbmx5IG9wZXJhdGUgb24gZm9yY2V3YWtlIHN0YXR1cy4KClNpZ25lZC1vZmYtYnk6
IERhbmllbGUgQ2VyYW9sbyBTcHVyaW8gPGRhbmllbGUuY2VyYW9sb3NwdXJpb0BpbnRlbC5jb20+
Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYyAgICAgfCAgMTUgKy0tCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF91bmNvcmUuYyB8IDE0NyArKysrKysrKysrKysrKysrKy0t
LS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF91bmNvcmUuaCB8ICAgOCArLQog
MyBmaWxlcyBjaGFuZ2VkLCAxMDEgaW5zZXJ0aW9ucygrKSwgNjkgZGVsZXRpb25zKC0pCgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZHJ2LmMKaW5kZXggZDExMzI5NmNiZTM0Li45NWIzNmZlMTdmOTkgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9kcnYuYwpAQCAtOTk2LDcgKzk5Niw3IEBAIHN0YXRpYyBpbnQgaTkxNV9k
cml2ZXJfaW5pdF9tbWlvKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAogCWlu
dGVsX2RldmljZV9pbmZvX2luaXRfbW1pbyhkZXZfcHJpdik7CiAKLQlpbnRlbF91bmNvcmVfcHJ1
bmVfbW1pb19kb21haW5zKCZkZXZfcHJpdi0+dW5jb3JlKTsKKwlpbnRlbF91bmNvcmVfcHJ1bmVf
Zm9yY2V3YWtlX2RvbWFpbnMoJmRldl9wcml2LT51bmNvcmUpOwogCiAJaW50ZWxfdWNfaW5pdF9t
bWlvKGRldl9wcml2KTsKIApAQCAtMjE1Miw3ICsyMTUyLDcgQEAgc3RhdGljIGludCBpOTE1X2Ry
bV9zdXNwZW5kX2xhdGUoc3RydWN0IGRybV9kZXZpY2UgKmRldiwgYm9vbCBoaWJlcm5hdGlvbikK
IAogCWk5MTVfZ2VtX3N1c3BlbmRfbGF0ZShkZXZfcHJpdik7CiAKLQlpbnRlbF91bmNvcmVfc3Vz
cGVuZCgmZGV2X3ByaXYtPnVuY29yZSk7CisJaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9zdXNwZW5k
KCZkZXZfcHJpdi0+dW5jb3JlKTsKIAogCWludGVsX3Bvd2VyX2RvbWFpbnNfc3VzcGVuZChkZXZf
cHJpdiwKIAkJCQkgICAgZ2V0X3N1c3BlbmRfbW9kZShkZXZfcHJpdiwgaGliZXJuYXRpb24pKTsK
QEAgLTIzNDgsNyArMjM0OCwxMCBAQCBzdGF0aWMgaW50IGk5MTVfZHJtX3Jlc3VtZV9lYXJseShz
dHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCQlEUk1fRVJST1IoIlJlc3VtZSBwcmVwYXJlIGZhaWxl
ZDogJWQsIGNvbnRpbnVpbmcgYW55d2F5XG4iLAogCQkJICByZXQpOwogCi0JaW50ZWxfdW5jb3Jl
X3Jlc3VtZV9lYXJseSgmZGV2X3ByaXYtPnVuY29yZSk7CisJaWYgKGludGVsX3VuY29yZV91bmNs
YWltZWRfbW1pbygmZGV2X3ByaXYtPnVuY29yZSkpCisJCURSTV9ERUJVRygidW5jbGFpbWVkIG1t
aW8gZGV0ZWN0ZWQgb24gcmVzdW1lLCBjbGVhcmluZ1xuIik7CisKKwlpbnRlbF91bmNvcmVfZm9y
Y2V3YWtlX3Jlc3VtZV9lYXJseSgmZGV2X3ByaXYtPnVuY29yZSk7CiAKIAlpOTE1X2NoZWNrX2Fu
ZF9jbGVhcl9mYXVsdHMoZGV2X3ByaXYpOwogCkBAIC0yOTIzLDcgKzI5MjYsNyBAQCBzdGF0aWMg
aW50IGludGVsX3J1bnRpbWVfc3VzcGVuZChzdHJ1Y3QgZGV2aWNlICprZGV2KQogCiAJaW50ZWxf
cnVudGltZV9wbV9kaXNhYmxlX2ludGVycnVwdHMoZGV2X3ByaXYpOwogCi0JaW50ZWxfdW5jb3Jl
X3N1c3BlbmQoJmRldl9wcml2LT51bmNvcmUpOworCWludGVsX3VuY29yZV9mb3JjZXdha2Vfc3Vz
cGVuZCgmZGV2X3ByaXYtPnVuY29yZSk7CiAKIAlyZXQgPSAwOwogCWlmIChJTlRFTF9HRU4oZGV2
X3ByaXYpID49IDExKSB7CkBAIC0yOTQwLDcgKzI5NDMsNyBAQCBzdGF0aWMgaW50IGludGVsX3J1
bnRpbWVfc3VzcGVuZChzdHJ1Y3QgZGV2aWNlICprZGV2KQogCiAJaWYgKHJldCkgewogCQlEUk1f
RVJST1IoIlJ1bnRpbWUgc3VzcGVuZCBmYWlsZWQsIGRpc2FibGluZyBpdCAoJWQpXG4iLCByZXQp
OwotCQlpbnRlbF91bmNvcmVfcnVudGltZV9yZXN1bWUoJmRldl9wcml2LT51bmNvcmUpOworCQlp
bnRlbF91bmNvcmVfZm9yY2V3YWtlX3J1bnRpbWVfcmVzdW1lKCZkZXZfcHJpdi0+dW5jb3JlKTsK
IAogCQlpbnRlbF9ydW50aW1lX3BtX2VuYWJsZV9pbnRlcnJ1cHRzKGRldl9wcml2KTsKIApAQCAt
MzAzOCw3ICszMDQxLDcgQEAgc3RhdGljIGludCBpbnRlbF9ydW50aW1lX3Jlc3VtZShzdHJ1Y3Qg
ZGV2aWNlICprZGV2KQogCQlyZXQgPSB2bHZfcmVzdW1lX3ByZXBhcmUoZGV2X3ByaXYsIHRydWUp
OwogCX0KIAotCWludGVsX3VuY29yZV9ydW50aW1lX3Jlc3VtZSgmZGV2X3ByaXYtPnVuY29yZSk7
CisJaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9ydW50aW1lX3Jlc3VtZSgmZGV2X3ByaXYtPnVuY29y
ZSk7CiAKIAlpbnRlbF9ydW50aW1lX3BtX2VuYWJsZV9pbnRlcnJ1cHRzKGRldl9wcml2KTsKIApk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdW5jb3JlLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pbnRlbF91bmNvcmUuYwppbmRleCA4OGE2OWJmNzEzYzkuLmMwZjU1Njdl
ZTA5NiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdW5jb3JlLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfdW5jb3JlLmMKQEAgLTQ4NSwxMiArNDg1LDEx
IEBAIGNoZWNrX2Zvcl91bmNsYWltZWRfbW1pbyhzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUp
CiAJcmV0dXJuIHJldDsKIH0KIAotc3RhdGljIHZvaWQgX19pbnRlbF91bmNvcmVfZWFybHlfc2Fu
aXRpemUoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlLAorc3RhdGljIHZvaWQgZm9yY2V3YWtl
X2Vhcmx5X3Nhbml0aXplKHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSwKIAkJCQkJICB1bnNp
Z25lZCBpbnQgcmVzdG9yZV9mb3JjZXdha2UpCiB7Ci0JLyogY2xlYXIgb3V0IHVuY2xhaW1lZCBy
ZWcgZGV0ZWN0aW9uIGJpdCAqLwotCWlmIChjaGVja19mb3JfdW5jbGFpbWVkX21taW8odW5jb3Jl
KSkKLQkJRFJNX0RFQlVHKCJ1bmNsYWltZWQgbW1pbyBkZXRlY3RlZCBvbiB1bmNvcmUgaW5pdCwg
Y2xlYXJpbmdcbiIpOworCWlmICghaW50ZWxfdW5jb3JlX2hhc19mb3JjZXdha2UodW5jb3JlKSkK
KwkJcmV0dXJuOwogCiAJLyogV2FEaXNhYmxlU2hhZG93UmVnRm9yQ3BkOmNodiAqLwogCWlmIChJ
U19DSEVSUllWSUVXKHVuY29yZS0+aTkxNSkpIHsKQEAgLTUxMyw4ICs1MTIsMTEgQEAgc3RhdGlj
IHZvaWQgX19pbnRlbF91bmNvcmVfZWFybHlfc2FuaXRpemUoc3RydWN0IGludGVsX3VuY29yZSAq
dW5jb3JlLAogCWlvc2ZfbWJpX3B1bml0X3JlbGVhc2UoKTsKIH0KIAotdm9pZCBpbnRlbF91bmNv
cmVfc3VzcGVuZChzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpCit2b2lkIGludGVsX3VuY29y
ZV9mb3JjZXdha2Vfc3VzcGVuZChzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpCiB7CisJaWYg
KCFpbnRlbF91bmNvcmVfaGFzX2ZvcmNld2FrZSh1bmNvcmUpKQorCQlyZXR1cm47CisKIAlpb3Nm
X21iaV9wdW5pdF9hY3F1aXJlKCk7CiAJaW9zZl9tYmlfdW5yZWdpc3Rlcl9wbWljX2J1c19hY2Nl
c3Nfbm90aWZpZXJfdW5sb2NrZWQoCiAJCSZ1bmNvcmUtPnBtaWNfYnVzX2FjY2Vzc19uYik7CkBA
IC01MjIsMTggKzUyNCwyNCBAQCB2b2lkIGludGVsX3VuY29yZV9zdXNwZW5kKHN0cnVjdCBpbnRl
bF91bmNvcmUgKnVuY29yZSkKIAlpb3NmX21iaV9wdW5pdF9yZWxlYXNlKCk7CiB9CiAKLXZvaWQg
aW50ZWxfdW5jb3JlX3Jlc3VtZV9lYXJseShzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpCit2
b2lkIGludGVsX3VuY29yZV9mb3JjZXdha2VfcmVzdW1lX2Vhcmx5KHN0cnVjdCBpbnRlbF91bmNv
cmUgKnVuY29yZSkKIHsKIAl1bnNpZ25lZCBpbnQgcmVzdG9yZV9mb3JjZXdha2U7CiAKKwlpZiAo
IWludGVsX3VuY29yZV9oYXNfZm9yY2V3YWtlKHVuY29yZSkpCisJCXJldHVybjsKKwogCXJlc3Rv
cmVfZm9yY2V3YWtlID0gZmV0Y2hfYW5kX3plcm8oJnVuY29yZS0+ZndfZG9tYWluc19zYXZlZCk7
Ci0JX19pbnRlbF91bmNvcmVfZWFybHlfc2FuaXRpemUodW5jb3JlLCByZXN0b3JlX2ZvcmNld2Fr
ZSk7CisJZm9yY2V3YWtlX2Vhcmx5X3Nhbml0aXplKHVuY29yZSwgcmVzdG9yZV9mb3JjZXdha2Up
OwogCiAJaW9zZl9tYmlfcmVnaXN0ZXJfcG1pY19idXNfYWNjZXNzX25vdGlmaWVyKCZ1bmNvcmUt
PnBtaWNfYnVzX2FjY2Vzc19uYik7CiB9CiAKLXZvaWQgaW50ZWxfdW5jb3JlX3J1bnRpbWVfcmVz
dW1lKHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSkKK3ZvaWQgaW50ZWxfdW5jb3JlX2ZvcmNl
d2FrZV9ydW50aW1lX3Jlc3VtZShzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpCiB7CisJaWYg
KCFpbnRlbF91bmNvcmVfaGFzX2ZvcmNld2FrZSh1bmNvcmUpKQorCQlyZXR1cm47CisKIAlpb3Nm
X21iaV9yZWdpc3Rlcl9wbWljX2J1c19hY2Nlc3Nfbm90aWZpZXIoJnVuY29yZS0+cG1pY19idXNf
YWNjZXNzX25iKTsKIH0KIApAQCAtMTM0OCw4ICsxMzU2LDcgQEAgc3RhdGljIHZvaWQgaW50ZWxf
dW5jb3JlX2Z3X2RvbWFpbnNfaW5pdChzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpCiB7CiAJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB1bmNvcmUtPmk5MTU7CiAKLQlpZiAoIWlu
dGVsX3VuY29yZV9oYXNfZm9yY2V3YWtlKHVuY29yZSkpCi0JCXJldHVybjsKKwlHRU1fQlVHX09O
KCFpbnRlbF91bmNvcmVfaGFzX2ZvcmNld2FrZSh1bmNvcmUpKTsKIAogCWlmIChJTlRFTF9HRU4o
aTkxNSkgPj0gMTEpIHsKIAkJaW50IGk7CkBAIC0xNTQyLDM2ICsxNTQ5LDI5IEBAIHZvaWQgaW50
ZWxfdW5jb3JlX2luaXRfZWFybHkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJdW5j
b3JlLT5ycG0gPSAmaTkxNS0+cnVudGltZV9wbTsKIH0KIAotaW50IGludGVsX3VuY29yZV9pbml0
X21taW8oc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQorc3RhdGljIHZvaWQgdW5jb3JlX3Jh
d19pbml0KHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IHVuY29yZS0+aTkxNTsKLQlpbnQgcmV0OworCUdFTV9CVUdfT04oaW50
ZWxfdW5jb3JlX2hhc19mb3JjZXdha2UodW5jb3JlKSk7CiAKLQlyZXQgPSB1bmNvcmVfbW1pb19z
ZXR1cCh1bmNvcmUpOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7CisJaWYgKElTX0dFTih1bmNv
cmUtPmk5MTUsIDUpKSB7CisJCUFTU0lHTl9SQVdfV1JJVEVfTU1JT19WRlVOQ1ModW5jb3JlLCBn
ZW41KTsKKwkJQVNTSUdOX1JBV19SRUFEX01NSU9fVkZVTkNTKHVuY29yZSwgZ2VuNSk7CisJfSBl
bHNlIHsKKwkJQVNTSUdOX1JBV19XUklURV9NTUlPX1ZGVU5DUyh1bmNvcmUsIGdlbjIpOworCQlB
U1NJR05fUkFXX1JFQURfTU1JT19WRlVOQ1ModW5jb3JlLCBnZW4yKTsKKwl9Cit9CiAKLQlpOTE1
X2NoZWNrX3ZncHUoaTkxNSk7CitzdGF0aWMgdm9pZCB1bmNvcmVfZm9yY2V3YWtlX2luaXQoc3Ry
dWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQoreworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1ID0gdW5jb3JlLT5pOTE1OwogCi0JaWYgKElOVEVMX0dFTihpOTE1KSA+IDUgJiYgIWludGVs
X3ZncHVfYWN0aXZlKGk5MTUpKQotCQl1bmNvcmUtPmZsYWdzIHw9IFVOQ09SRV9IQVNfRk9SQ0VX
QUtFOworCUdFTV9CVUdfT04oIWludGVsX3VuY29yZV9oYXNfZm9yY2V3YWtlKHVuY29yZSkpOwog
CiAJaW50ZWxfdW5jb3JlX2Z3X2RvbWFpbnNfaW5pdCh1bmNvcmUpOwotCV9faW50ZWxfdW5jb3Jl
X2Vhcmx5X3Nhbml0aXplKHVuY29yZSwgMCk7CisJZm9yY2V3YWtlX2Vhcmx5X3Nhbml0aXplKHVu
Y29yZSwgMCk7CiAKLQl1bmNvcmUtPnVuY2xhaW1lZF9tbWlvX2NoZWNrID0gMTsKLQl1bmNvcmUt
PnBtaWNfYnVzX2FjY2Vzc19uYi5ub3RpZmllcl9jYWxsID0KLQkJaTkxNV9wbWljX2J1c19hY2Nl
c3Nfbm90aWZpZXI7Ci0KLQlpZiAoIWludGVsX3VuY29yZV9oYXNfZm9yY2V3YWtlKHVuY29yZSkp
IHsKLQkJaWYgKElTX0dFTihpOTE1LCA1KSkgewotCQkJQVNTSUdOX1JBV19XUklURV9NTUlPX1ZG
VU5DUyh1bmNvcmUsIGdlbjUpOwotCQkJQVNTSUdOX1JBV19SRUFEX01NSU9fVkZVTkNTKHVuY29y
ZSwgZ2VuNSk7Ci0JCX0gZWxzZSB7Ci0JCQlBU1NJR05fUkFXX1dSSVRFX01NSU9fVkZVTkNTKHVu
Y29yZSwgZ2VuMik7Ci0JCQlBU1NJR05fUkFXX1JFQURfTU1JT19WRlVOQ1ModW5jb3JlLCBnZW4y
KTsKLQkJfQotCX0gZWxzZSBpZiAoSVNfR0VOX1JBTkdFKGk5MTUsIDYsIDcpKSB7CisJaWYgKElT
X0dFTl9SQU5HRShpOTE1LCA2LCA3KSkgewogCQlBU1NJR05fV1JJVEVfTU1JT19WRlVOQ1ModW5j
b3JlLCBnZW42KTsKIAogCQlpZiAoSVNfVkFMTEVZVklFVyhpOTE1KSkgewpAQCAtMTU4NSw3ICsx
NTg1LDYgQEAgaW50IGludGVsX3VuY29yZV9pbml0X21taW8oc3RydWN0IGludGVsX3VuY29yZSAq
dW5jb3JlKQogCQkJQVNTSUdOX0ZXX0RPTUFJTlNfVEFCTEUodW5jb3JlLCBfX2Nodl9md19yYW5n
ZXMpOwogCQkJQVNTSUdOX1dSSVRFX01NSU9fVkZVTkNTKHVuY29yZSwgZnd0YWJsZSk7CiAJCQlB
U1NJR05fUkVBRF9NTUlPX1ZGVU5DUyh1bmNvcmUsIGZ3dGFibGUpOwotCiAJCX0gZWxzZSB7CiAJ
CQlBU1NJR05fV1JJVEVfTU1JT19WRlVOQ1ModW5jb3JlLCBnZW44KTsKIAkJCUFTU0lHTl9SRUFE
X01NSU9fVkZVTkNTKHVuY29yZSwgZ2VuNik7CkBAIC0xNjAwLDYgKzE1OTksMzEgQEAgaW50IGlu
dGVsX3VuY29yZV9pbml0X21taW8oc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQogCQlBU1NJ
R05fUkVBRF9NTUlPX1ZGVU5DUyh1bmNvcmUsIGdlbjExX2Z3dGFibGUpOwogCX0KIAorCXVuY29y
ZS0+cG1pY19idXNfYWNjZXNzX25iLm5vdGlmaWVyX2NhbGwgPSBpOTE1X3BtaWNfYnVzX2FjY2Vz
c19ub3RpZmllcjsKKwlpb3NmX21iaV9yZWdpc3Rlcl9wbWljX2J1c19hY2Nlc3Nfbm90aWZpZXIo
JnVuY29yZS0+cG1pY19idXNfYWNjZXNzX25iKTsKK30KKworaW50IGludGVsX3VuY29yZV9pbml0
X21taW8oc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKQoreworCXN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1ID0gdW5jb3JlLT5pOTE1OworCWludCByZXQ7CisKKwlyZXQgPSB1bmNvcmVf
bW1pb19zZXR1cCh1bmNvcmUpOworCWlmIChyZXQpCisJCXJldHVybiByZXQ7CisKKwlpOTE1X2No
ZWNrX3ZncHUoaTkxNSk7CisKKwlpZiAoSU5URUxfR0VOKGk5MTUpID4gNSAmJiAhaW50ZWxfdmdw
dV9hY3RpdmUoaTkxNSkpCisJCXVuY29yZS0+ZmxhZ3MgfD0gVU5DT1JFX0hBU19GT1JDRVdBS0U7
CisKKwl1bmNvcmUtPnVuY2xhaW1lZF9tbWlvX2NoZWNrID0gMTsKKworCWlmICghaW50ZWxfdW5j
b3JlX2hhc19mb3JjZXdha2UodW5jb3JlKSkKKwkJdW5jb3JlX3Jhd19pbml0KHVuY29yZSk7CisJ
ZWxzZQorCQl1bmNvcmVfZm9yY2V3YWtlX2luaXQodW5jb3JlKTsKKwogCS8qIG1ha2Ugc3VyZSBm
dyBmdW5jcyBhcmUgc2V0IGlmIGFuZCBvbmx5IGlmIHdlIGhhdmUgZncqLwogCUdFTV9CVUdfT04o
aW50ZWxfdW5jb3JlX2hhc19mb3JjZXdha2UodW5jb3JlKSAhPSAhIXVuY29yZS0+ZnVuY3MuZm9y
Y2Vfd2FrZV9nZXQpOwogCUdFTV9CVUdfT04oaW50ZWxfdW5jb3JlX2hhc19mb3JjZXdha2UodW5j
b3JlKSAhPSAhIXVuY29yZS0+ZnVuY3MuZm9yY2Vfd2FrZV9wdXQpOwpAQCAtMTYxNSw3ICsxNjM5
LDkgQEAgaW50IGludGVsX3VuY29yZV9pbml0X21taW8oc3RydWN0IGludGVsX3VuY29yZSAqdW5j
b3JlKQogCWlmIChJU19HRU5fUkFOR0UoaTkxNSwgNiwgNykpCiAJCXVuY29yZS0+ZmxhZ3MgfD0g
VU5DT1JFX0hBU19GSUZPOwogCi0JaW9zZl9tYmlfcmVnaXN0ZXJfcG1pY19idXNfYWNjZXNzX25v
dGlmaWVyKCZ1bmNvcmUtPnBtaWNfYnVzX2FjY2Vzc19uYik7CisJLyogY2xlYXIgb3V0IHVuY2xh
aW1lZCByZWcgZGV0ZWN0aW9uIGJpdCAqLworCWlmIChjaGVja19mb3JfdW5jbGFpbWVkX21taW8o
dW5jb3JlKSkKKwkJRFJNX0RFQlVHKCJ1bmNsYWltZWQgbW1pbyBkZXRlY3RlZCBvbiB1bmNvcmUg
aW5pdCwgY2xlYXJpbmdcbiIpOwogCiAJcmV0dXJuIDA7CiB9CkBAIC0xNjI1LDQ0ICsxNjUxLDQ3
IEBAIGludCBpbnRlbF91bmNvcmVfaW5pdF9tbWlvKHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29y
ZSkKICAqIHRoZSBmb3JjZXdha2UgZG9tYWlucy4gUHJ1bmUgdGhlbSwgdG8gbWFrZSBzdXJlIHRo
ZXkgb25seSByZWZlcmVuY2UgZXhpc3RpbmcKICAqIGVuZ2luZXMuCiAgKi8KLXZvaWQgaW50ZWxf
dW5jb3JlX3BydW5lX21taW9fZG9tYWlucyhzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpCit2
b2lkIGludGVsX3VuY29yZV9wcnVuZV9mb3JjZXdha2VfZG9tYWlucyhzdHJ1Y3QgaW50ZWxfdW5j
b3JlICp1bmNvcmUpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB1bmNvcmUt
Pmk5MTU7CisJZW51bSBmb3JjZXdha2VfZG9tYWlucyBmd19kb21haW5zID0gdW5jb3JlLT5md19k
b21haW5zOworCWVudW0gZm9yY2V3YWtlX2RvbWFpbl9pZCBkb21haW5faWQ7CisJaW50IGk7CiAK
LQlpZiAoSU5URUxfR0VOKGk5MTUpID49IDExKSB7Ci0JCWVudW0gZm9yY2V3YWtlX2RvbWFpbnMg
ZndfZG9tYWlucyA9IHVuY29yZS0+ZndfZG9tYWluczsKLQkJZW51bSBmb3JjZXdha2VfZG9tYWlu
X2lkIGRvbWFpbl9pZDsKLQkJaW50IGk7CisJaWYgKCFpbnRlbF91bmNvcmVfaGFzX2ZvcmNld2Fr
ZSh1bmNvcmUpIHx8IElOVEVMX0dFTihpOTE1KSA8IDExKQorCQlyZXR1cm47CiAKLQkJZm9yIChp
ID0gMDsgaSA8IEk5MTVfTUFYX1ZDUzsgaSsrKSB7Ci0JCQlkb21haW5faWQgPSBGV19ET01BSU5f
SURfTUVESUFfVkRCT1gwICsgaTsKKwlmb3IgKGkgPSAwOyBpIDwgSTkxNV9NQVhfVkNTOyBpKysp
IHsKKwkJZG9tYWluX2lkID0gRldfRE9NQUlOX0lEX01FRElBX1ZEQk9YMCArIGk7CiAKLQkJCWlm
IChIQVNfRU5HSU5FKGk5MTUsIF9WQ1MoaSkpKQotCQkJCWNvbnRpbnVlOworCQlpZiAoSEFTX0VO
R0lORShpOTE1LCBfVkNTKGkpKSkKKwkJCWNvbnRpbnVlOwogCi0JCQlpZiAoZndfZG9tYWlucyAm
IEJJVChkb21haW5faWQpKQotCQkJCWZ3X2RvbWFpbl9maW5pKHVuY29yZSwgZG9tYWluX2lkKTsK
LQkJfQorCQlpZiAoZndfZG9tYWlucyAmIEJJVChkb21haW5faWQpKQorCQkJZndfZG9tYWluX2Zp
bmkodW5jb3JlLCBkb21haW5faWQpOworCX0KIAotCQlmb3IgKGkgPSAwOyBpIDwgSTkxNV9NQVhf
VkVDUzsgaSsrKSB7Ci0JCQlkb21haW5faWQgPSBGV19ET01BSU5fSURfTUVESUFfVkVCT1gwICsg
aTsKKwlmb3IgKGkgPSAwOyBpIDwgSTkxNV9NQVhfVkVDUzsgaSsrKSB7CisJCWRvbWFpbl9pZCA9
IEZXX0RPTUFJTl9JRF9NRURJQV9WRUJPWDAgKyBpOwogCi0JCQlpZiAoSEFTX0VOR0lORShpOTE1
LCBfVkVDUyhpKSkpCi0JCQkJY29udGludWU7CisJCWlmIChIQVNfRU5HSU5FKGk5MTUsIF9WRUNT
KGkpKSkKKwkJCWNvbnRpbnVlOwogCi0JCQlpZiAoZndfZG9tYWlucyAmIEJJVChkb21haW5faWQp
KQotCQkJCWZ3X2RvbWFpbl9maW5pKHVuY29yZSwgZG9tYWluX2lkKTsKLQkJfQorCQlpZiAoZndf
ZG9tYWlucyAmIEJJVChkb21haW5faWQpKQorCQkJZndfZG9tYWluX2ZpbmkodW5jb3JlLCBkb21h
aW5faWQpOwogCX0KIH0KIAogdm9pZCBpbnRlbF91bmNvcmVfZmluaV9tbWlvKHN0cnVjdCBpbnRl
bF91bmNvcmUgKnVuY29yZSkKIHsKLQlpb3NmX21iaV9wdW5pdF9hY3F1aXJlKCk7Ci0JaW9zZl9t
YmlfdW5yZWdpc3Rlcl9wbWljX2J1c19hY2Nlc3Nfbm90aWZpZXJfdW5sb2NrZWQoCi0JCSZ1bmNv
cmUtPnBtaWNfYnVzX2FjY2Vzc19uYik7Ci0JaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9yZXNldCh1
bmNvcmUpOwotCWlvc2ZfbWJpX3B1bml0X3JlbGVhc2UoKTsKKwlpZiAoaW50ZWxfdW5jb3JlX2hh
c19mb3JjZXdha2UodW5jb3JlKSkgeworCQlpb3NmX21iaV9wdW5pdF9hY3F1aXJlKCk7CisJCWlv
c2ZfbWJpX3VucmVnaXN0ZXJfcG1pY19idXNfYWNjZXNzX25vdGlmaWVyX3VubG9ja2VkKAorCQkJ
JnVuY29yZS0+cG1pY19idXNfYWNjZXNzX25iKTsKKwkJaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9y
ZXNldCh1bmNvcmUpOworCQlpb3NmX21iaV9wdW5pdF9yZWxlYXNlKCk7CisJfQorCiAJdW5jb3Jl
X21taW9fY2xlYW51cCh1bmNvcmUpOwogfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF91bmNvcmUuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3VuY29yZS5o
CmluZGV4IDkxMjYxNjE4OGZmNS4uODc5MjUyNzM1YmJhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pbnRlbF91bmNvcmUuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRl
bF91bmNvcmUuaApAQCAtMTg2LDEzICsxODYsMTMgQEAgaW50ZWxfdW5jb3JlX2hhc19maWZvKGNv
bnN0IHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSkKIHZvaWQgaW50ZWxfdW5jb3JlX2luaXRf
ZWFybHkoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkgICAgIHN0cnVjdCBpbnRl
bF91bmNvcmUgKnVuY29yZSk7CiBpbnQgaW50ZWxfdW5jb3JlX2luaXRfbW1pbyhzdHJ1Y3QgaW50
ZWxfdW5jb3JlICp1bmNvcmUpOwotdm9pZCBpbnRlbF91bmNvcmVfcHJ1bmVfbW1pb19kb21haW5z
KHN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSk7Cit2b2lkIGludGVsX3VuY29yZV9wcnVuZV9m
b3JjZXdha2VfZG9tYWlucyhzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpOwogYm9vbCBpbnRl
bF91bmNvcmVfdW5jbGFpbWVkX21taW8oc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKTsKIGJv
b2wgaW50ZWxfdW5jb3JlX2FybV91bmNsYWltZWRfbW1pb19kZXRlY3Rpb24oc3RydWN0IGludGVs
X3VuY29yZSAqdW5jb3JlKTsKIHZvaWQgaW50ZWxfdW5jb3JlX2ZpbmlfbW1pbyhzdHJ1Y3QgaW50
ZWxfdW5jb3JlICp1bmNvcmUpOwotdm9pZCBpbnRlbF91bmNvcmVfc3VzcGVuZChzdHJ1Y3QgaW50
ZWxfdW5jb3JlICp1bmNvcmUpOwotdm9pZCBpbnRlbF91bmNvcmVfcmVzdW1lX2Vhcmx5KHN0cnVj
dCBpbnRlbF91bmNvcmUgKnVuY29yZSk7Ci12b2lkIGludGVsX3VuY29yZV9ydW50aW1lX3Jlc3Vt
ZShzdHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUpOwordm9pZCBpbnRlbF91bmNvcmVfZm9yY2V3
YWtlX3N1c3BlbmQoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKTsKK3ZvaWQgaW50ZWxfdW5j
b3JlX2ZvcmNld2FrZV9yZXN1bWVfZWFybHkoc3RydWN0IGludGVsX3VuY29yZSAqdW5jb3JlKTsK
K3ZvaWQgaW50ZWxfdW5jb3JlX2ZvcmNld2FrZV9ydW50aW1lX3Jlc3VtZShzdHJ1Y3QgaW50ZWxf
dW5jb3JlICp1bmNvcmUpOwogCiB2b2lkIGFzc2VydF9mb3JjZXdha2VzX2luYWN0aXZlKHN0cnVj
dCBpbnRlbF91bmNvcmUgKnVuY29yZSk7CiB2b2lkIGFzc2VydF9mb3JjZXdha2VzX2FjdGl2ZShz
dHJ1Y3QgaW50ZWxfdW5jb3JlICp1bmNvcmUsCi0tIAoyLjIwLjEKCl9fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50
ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9y
Zy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

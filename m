Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id B7D23FDE04
	for <lists+intel-gfx@lfdr.de>; Fri, 15 Nov 2019 13:35:58 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0078F6E5A0;
	Fri, 15 Nov 2019 12:35:57 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 3DC366E5A0
 for <intel-gfx@lists.freedesktop.org>; Fri, 15 Nov 2019 12:35:55 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19212214-1500050 
 for multiple; Fri, 15 Nov 2019 12:35:49 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 15 Nov 2019 12:35:47 +0000
Message-Id: <20191115123547.846408-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.24.0
In-Reply-To: <20191115120023.770000-1-chris@chris-wilson.co.uk>
References: <20191115120023.770000-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/gem: Purge the sudden reappearance of
 i915_gem_object_pin()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Matthew Auld <matthew.auld@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhpcyBkaWVkIG1hbnkgeWVhcnMgYWdvIGFzIHdlIG5vdyB1c2UgaTkxNV92bWEgZmlyc3QgYW5k
IGZvcmVtb3N0LgoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxz
b24uY28udWs+CkNjOiBUdnJ0a28gVXJzdWxpbiA8dHZydGtvLnVyc3VsaW5AaW50ZWwuY29tPgpD
YzogTWF0dGhldyBBdWxkIDxtYXR0aGV3LmF1bGRAaW50ZWwuY29tPgotLS0KTWlnaHQgYXMgd2Vs
bCByZWR1Y2UgdGhlIG51bWJlciBvZiBDTURQQVJTRVJfVVNFU19HR1RUKGViLT5pOTE1KSBjaGVj
a3MKaGVyZSBhbmQgdXNlIGRlcml2ZWQgc3RhdGUgYWZ0ZXIgdGhlIGZpcnN0IGNoZWNrLgotLS0K
IC4uLi9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIuYyAgICB8IDM2ICsrKysr
KysrKysrKy0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggICAgICAgICAg
ICAgICB8ICA4IC0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jICAgICAgICAg
ICAgICAgfCAzNiArKysrKysrLS0tLS0tLS0tLS0tCiAzIGZpbGVzIGNoYW5nZWQsIDM1IGluc2Vy
dGlvbnMoKyksIDQ1IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0v
aTkxNV9nZW1fZXhlY2J1ZmZlci5jCmluZGV4IGYwOTk4ZjEyMjVhZi4uYzBhNGE3YTUwOGY0IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5j
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMKQEAg
LTE5OTUsMjggKzE5OTUsMzggQEAgc3RhdGljIGludCBpOTE1X3Jlc2V0X2dlbjdfc29sX29mZnNl
dHMoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiBzdGF0aWMgc3RydWN0IGk5MTVfdm1hICoKIHNo
YWRvd19iYXRjaF9waW4oc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIsIHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpvYmopCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
ID0gZWItPmk5MTU7Ci0Jc3RydWN0IGk5MTVfdm1hICogY29uc3Qgdm1hID0gKmViLT52bWE7CiAJ
c3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm07CisJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJ
dTY0IGZsYWdzOworCWludCBlcnI7CiAKIAkvKgogCSAqIFBQR1RUIGJhY2tlZCBzaGFkb3cgYnVm
ZmVycyBtdXN0IGJlIG1hcHBlZCBSTywgdG8gcHJldmVudAogCSAqIHBvc3Qtc2NhbiB0YW1wZXJp
bmcKIAkgKi8KLQlpZiAoQ01EUEFSU0VSX1VTRVNfR0dUVChkZXZfcHJpdikpIHsKKwlpZiAoQ01E
UEFSU0VSX1VTRVNfR0dUVChlYi0+aTkxNSkpIHsKKwkJdm0gPSAmZWItPmVuZ2luZS0+Z3QtPmdn
dHQtPnZtOwogCQlmbGFncyA9IFBJTl9HTE9CQUw7Ci0JCXZtID0gJmRldl9wcml2LT5nZ3R0LnZt
OwotCX0gZWxzZSBpZiAodm1hLT52bS0+aGFzX3JlYWRfb25seSkgewotCQlmbGFncyA9IFBJTl9V
U0VSOwotCQl2bSA9IHZtYS0+dm07Ci0JCWk5MTVfZ2VtX29iamVjdF9zZXRfcmVhZG9ubHkob2Jq
KTsKIAl9IGVsc2UgewotCQlEUk1fREVCVUcoIkNhbm5vdCBwcmV2ZW50IHBvc3Qtc2NhbiB0YW1w
ZXJpbmcgd2l0aG91dCBSTyBjYXBhYmxlIHZtXG4iKTsKLQkJcmV0dXJuIEVSUl9QVFIoLUVJTlZB
TCk7CisJCXZtID0gZWItPmNvbnRleHQtPnZtOworCQlpZiAoIXZtLT5oYXNfcmVhZF9vbmx5KSB7
CisJCQlEUk1fREVCVUcoIkNhbm5vdCBwcmV2ZW50IHBvc3Qtc2NhbiB0YW1wZXJpbmcgd2l0aG91
dCBSTyBjYXBhYmxlIHZtXG4iKTsKKwkJCXJldHVybiBFUlJfUFRSKC1FSU5WQUwpOworCQl9CisK
KwkJaTkxNV9nZW1fb2JqZWN0X3NldF9yZWFkb25seShvYmopOworCQlmbGFncyA9IFBJTl9VU0VS
OwogCX0KIAotCXJldHVybiBpOTE1X2dlbV9vYmplY3RfcGluKG9iaiwgdm0sIE5VTEwsIDAsIDAs
IGZsYWdzKTsKKwl2bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosIHZtLCBOVUxMKTsKKwlpZiAo
SVNfRVJSKHZtYSkpCisJCXJldHVybiB2bWE7CisKKwllcnIgPSBpOTE1X3ZtYV9waW4odm1hLCAw
LCAwLCBmbGFncyk7CisJaWYgKGVycikKKwkJcmV0dXJuIEVSUl9QVFIoZXJyKTsKKworCXJldHVy
biB2bWE7CiB9CiAKIHN0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKmViX3BhcnNlKHN0cnVjdCBpOTE1
X2V4ZWNidWZmZXIgKmViKQpAQCAtMjA1OCw3ICsyMDY4LDcgQEAgc3RhdGljIHN0cnVjdCBpOTE1
X3ZtYSAqZWJfcGFyc2Uoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIpCiAJCSAqIEZvciBQUEdU
VCBiYWNraW5nIGhvd2V2ZXIsIHdlIGhhdmUgbm8gY2hvaWNlIGJ1dCB0byBmb3JjaWJseQogCQkg
KiByZWplY3QgdW5zYWZlIGJ1ZmZlcnMKIAkJICovCi0JCWlmIChDTURQQVJTRVJfVVNFU19HR1RU
KGViLT5pOTE1KSAmJiAoZXJyID09IC1FQUNDRVMpKQorCQlpZiAoaTkxNV92bWFfaXNfZ2d0dCh2
bWEpICYmIChlcnIgPT0gLUVBQ0NFUykpCiAJCQkvKiBFeGVjdXRlIG9yaWdpbmFsIGJ1ZmZlciBu
b24tc2VjdXJlICovCiAJCQl2bWEgPSBOVUxMOwogCQllbHNlCkBAIC0yMDc1LDcgKzIwODUsNyBA
QCBzdGF0aWMgc3RydWN0IGk5MTVfdm1hICplYl9wYXJzZShzdHJ1Y3QgaTkxNV9leGVjYnVmZmVy
ICplYikKIAllYi0+YmF0Y2hfc3RhcnRfb2Zmc2V0ID0gMDsKIAllYi0+YmF0Y2ggPSB2bWE7CiAK
LQlpZiAoQ01EUEFSU0VSX1VTRVNfR0dUVChlYi0+aTkxNSkpCisJaWYgKGk5MTVfdm1hX2lzX2dn
dHQodm1hKSkKIAkJZWItPmJhdGNoX2ZsYWdzIHw9IEk5MTVfRElTUEFUQ0hfU0VDVVJFOwogCiAJ
LyogZWItPmJhdGNoX2xlbiB1bmNoYW5nZWQgKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZHJ2LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCmluZGV4
IDE3NzlmNjAwZmNmYi4uYTcwNTU1ZTZiZWZiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2Rydi5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKQEAg
LTE4NDIsMTQgKzE4NDIsNiBAQCBpbnQgaTkxNV9nZW1fb2JqZWN0X3VuYmluZChzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkJICAgdW5zaWduZWQgbG9uZyBmbGFncyk7CiAjZGVm
aW5lIEk5MTVfR0VNX09CSkVDVF9VTkJJTkRfQUNUSVZFIEJJVCgwKQogCi1zdHJ1Y3QgaTkxNV92
bWEgKiBfX211c3RfY2hlY2sKLWk5MTVfZ2VtX29iamVjdF9waW4oc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaiwKLQkJICAgIHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAotCQkg
ICAgY29uc3Qgc3RydWN0IGk5MTVfZ2d0dF92aWV3ICp2aWV3LAotCQkgICAgdTY0IHNpemUsCi0J
CSAgICB1NjQgYWxpZ25tZW50LAotCQkgICAgdTY0IGZsYWdzKTsKLQogdm9pZCBpOTE1X2dlbV9y
dW50aW1lX3N1c3BlbmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIAogc3Rh
dGljIGlubGluZSBpbnQgX19tdXN0X2NoZWNrCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwppbmRleCA0
M2M1MzI3NTZjN2MuLjg5Njk2ZjFhNGU3NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCkBAIC04
OTEsMjIgKzg5MSw4IEBAIGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihzdHJ1Y3QgZHJtX2k5MTVf
Z2VtX29iamVjdCAqb2JqLAogCQkJIHU2NCBhbGlnbm1lbnQsCiAJCQkgdTY0IGZsYWdzKQogewot
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUob2JqLT5iYXNlLmRl
dik7Ci0Jc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0gPSAmZGV2X3ByaXYtPmdndHQudm07
Ci0KLQlyZXR1cm4gaTkxNV9nZW1fb2JqZWN0X3BpbihvYmosIHZtLCB2aWV3LCBzaXplLCBhbGln
bm1lbnQsCi0JCQkJICAgZmxhZ3MgfCBQSU5fR0xPQkFMKTsKLX0KLQotc3RydWN0IGk5MTVfdm1h
ICoKLWk5MTVfZ2VtX29iamVjdF9waW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwK
LQkJICAgIHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAotCQkgICAgY29uc3Qgc3RydWN0
IGk5MTVfZ2d0dF92aWV3ICp2aWV3LAotCQkgICAgdTY0IHNpemUsCi0JCSAgICB1NjQgYWxpZ25t
ZW50LAotCQkgICAgdTY0IGZsYWdzKQotewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUob2JqLT5iYXNlLmRldik7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOworCXN0cnVjdCBpOTE1X2dndHQgKmdndHQg
PSAmaTkxNS0+Z2d0dDsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAlpbnQgcmV0OwogCkBAIC05
MTUsMTcgKzkwMSwxOSBAQCBpOTE1X2dlbV9vYmplY3RfcGluKHN0cnVjdCBkcm1faTkxNV9nZW1f
b2JqZWN0ICpvYmosCiAKIAlpZiAoZmxhZ3MgJiBQSU5fTUFQUEFCTEUgJiYKIAkgICAgKCF2aWV3
IHx8IHZpZXctPnR5cGUgPT0gSTkxNV9HR1RUX1ZJRVdfTk9STUFMKSkgewotCQkvKiBJZiB0aGUg
cmVxdWlyZWQgc3BhY2UgaXMgbGFyZ2VyIHRoYW4gdGhlIGF2YWlsYWJsZQorCQkvKgorCQkgKiBJ
ZiB0aGUgcmVxdWlyZWQgc3BhY2UgaXMgbGFyZ2VyIHRoYW4gdGhlIGF2YWlsYWJsZQogCQkgKiBh
cGVydHVyZSwgd2Ugd2lsbCBub3QgYWJsZSB0byBmaW5kIGEgc2xvdCBmb3IgdGhlCiAJCSAqIG9i
amVjdCBhbmQgdW5iaW5kaW5nIHRoZSBvYmplY3Qgbm93IHdpbGwgYmUgaW4KIAkJICogdmFpbi4g
V29yc2UsIGRvaW5nIHNvIG1heSBjYXVzZSB1cyB0byBwaW5nLXBvbmcKIAkJICogdGhlIG9iamVj
dCBpbiBhbmQgb3V0IG9mIHRoZSBHbG9iYWwgR1RUIGFuZAogCQkgKiB3YXN0ZSBhIGxvdCBvZiBj
eWNsZXMgdW5kZXIgdGhlIG11dGV4LgogCQkgKi8KLQkJaWYgKG9iai0+YmFzZS5zaXplID4gZGV2
X3ByaXYtPmdndHQubWFwcGFibGVfZW5kKQorCQlpZiAob2JqLT5iYXNlLnNpemUgPiBnZ3R0LT5t
YXBwYWJsZV9lbmQpCiAJCQlyZXR1cm4gRVJSX1BUUigtRTJCSUcpOwogCi0JCS8qIElmIE5PTkJM
T0NLIGlzIHNldCB0aGUgY2FsbGVyIGlzIG9wdGltaXN0aWNhbGx5CisJCS8qCisJCSAqIElmIE5P
TkJMT0NLIGlzIHNldCB0aGUgY2FsbGVyIGlzIG9wdGltaXN0aWNhbGx5CiAJCSAqIHRyeWluZyB0
byBjYWNoZSB0aGUgZnVsbCBvYmplY3Qgd2l0aGluIHRoZSBtYXBwYWJsZQogCQkgKiBhcGVydHVy
ZSwgYW5kICptdXN0KiBoYXZlIGEgZmFsbGJhY2sgaW4gcGxhY2UgZm9yCiAJCSAqIHNpdHVhdGlv
bnMgd2hlcmUgd2UgY2Fubm90IGJpbmQgdGhlIG9iamVjdC4gV2UKQEAgLTk0MSwxMSArOTI5LDEx
IEBAIGk5MTVfZ2VtX29iamVjdF9waW4oc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwK
IAkJICogd2UgY291bGQgdHJ5IHRvIG1pbmltaXNlIGhhcm0gdG8gb3RoZXJzLgogCQkgKi8KIAkJ
aWYgKGZsYWdzICYgUElOX05PTkJMT0NLICYmCi0JCSAgICBvYmotPmJhc2Uuc2l6ZSA+IGRldl9w
cml2LT5nZ3R0Lm1hcHBhYmxlX2VuZCAvIDIpCisJCSAgICBvYmotPmJhc2Uuc2l6ZSA+IGdndHQt
Pm1hcHBhYmxlX2VuZCAvIDIpCiAJCQlyZXR1cm4gRVJSX1BUUigtRU5PU1BDKTsKIAl9CiAKLQl2
bWEgPSBpOTE1X3ZtYV9pbnN0YW5jZShvYmosIHZtLCB2aWV3KTsKKwl2bWEgPSBpOTE1X3ZtYV9p
bnN0YW5jZShvYmosICZnZ3R0LT52bSwgdmlldyk7CiAJaWYgKElTX0VSUih2bWEpKQogCQlyZXR1
cm4gdm1hOwogCkBAIC05NTUsNyArOTQzLDcgQEAgaTkxNV9nZW1fb2JqZWN0X3BpbihzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkJCXJldHVybiBFUlJfUFRSKC1FTk9TUEMpOwog
CiAJCQlpZiAoZmxhZ3MgJiBQSU5fTUFQUEFCTEUgJiYKLQkJCSAgICB2bWEtPmZlbmNlX3NpemUg
PiBkZXZfcHJpdi0+Z2d0dC5tYXBwYWJsZV9lbmQgLyAyKQorCQkJICAgIHZtYS0+ZmVuY2Vfc2l6
ZSA+IGdndHQtPm1hcHBhYmxlX2VuZCAvIDIpCiAJCQkJcmV0dXJuIEVSUl9QVFIoLUVOT1NQQyk7
CiAJCX0KIApAQCAtOTY1LDkgKzk1Myw5IEBAIGk5MTVfZ2VtX29iamVjdF9waW4oc3RydWN0IGRy
bV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAl9CiAKIAlpZiAodm1hLT5mZW5jZSAmJiAhaTkxNV9n
ZW1fb2JqZWN0X2lzX3RpbGVkKG9iaikpIHsKLQkJbXV0ZXhfbG9jaygmdm1hLT52bS0+bXV0ZXgp
OworCQltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCXJldCA9IGk5MTVfdm1hX3Jldm9r
ZV9mZW5jZSh2bWEpOwotCQltdXRleF91bmxvY2soJnZtYS0+dm0tPm11dGV4KTsKKwkJbXV0ZXhf
dW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gRVJSX1BUUihy
ZXQpOwogCX0KLS0gCjIuMjQuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRl
c2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8v
aW50ZWwtZ2Z4

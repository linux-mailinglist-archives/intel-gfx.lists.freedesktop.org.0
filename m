Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 31EE7BB459
	for <lists+intel-gfx@lfdr.de>; Mon, 23 Sep 2019 14:53:00 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6AC3D6E8C1;
	Mon, 23 Sep 2019 12:52:58 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0AD8B6E8C1
 for <intel-gfx@lists.freedesktop.org>; Mon, 23 Sep 2019 12:52:57 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 23 Sep 2019 14:52:52 +0200
Message-Id: <20190923125252.25913-1-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190920163814.GD1208@intel.com>
References: <20190920163814.GD1208@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915/dp: Fix dsc bpp calculations, v3.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: stable@vger.kernel.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

VGhlcmUgd2FzIGEgaW50ZWdlciB3cmFwYXJvdW5kIHdoZW4gbW9kZV9jbG9jayBiZWNhbWUgdG9v
IGhpZ2gsCmFuZCB3ZSBkaWRuJ3QgY29ycmVjdCBmb3IgdGhlIEZFQyBvdmVyaGVhZCBmYWN0b3Ig
d2hlbiBkaXZpZGluZywKd2l0aCB0aGUgY2FsY3VsYXRpb25zIGJyZWFraW5nIGF0IEhCUjMuCgpB
cyBhIHJlc3VsdCBvdXIgY2FsY3VsYXRlZCBicHAgd2FzIHdheSB0b28gaGlnaCwgYW5kIHRoZSBs
aW5rIHdpZHRoCmxpbWl0YXRpb24gbmV2ZXIgY2FtZSBpbnRvIGVmZmVjdC4KClByaW50IG91dCB0
aGUgcmVzdWx0aW5nIGJwcCBjYWxjdWx1bGF0aW9ucyBhcyBhIHNhbml0eSBjaGVjaywganVzdApp
biBjYXNlIHdlIGV2ZXIgaGF2ZSB0byBkZWJ1ZyBpdCBsYXRlciBvbiBhZ2Fpbi4KCldlIGFsc28g
dXNlZCB0aGUgd3JvbmcgZmFjdG9yIGZvciBGRUMuIFdoaWxlIGJzcGVjIG1lbnRpb25zIDIuNCUs
CmFsbCB0aGUgY2FsY3VsYXRpb25zIHVzZSAxLzAuOTcyMjYxLCBhbmQgdGhlIHNhbWUgcmF0aW8g
c2hvdWxkIGJlCmFwcGxpZWQgdG8gZGF0YSBNL04gYXMgd2VsbCwgc28gdXNlIGl0IHRoZXJlIHdo
ZW4gRkVDIGlzIGVuYWJsZWQuCgpNYWtlIHN1cmUgd2UgZG9uJ3QgYnJlYWsgaHcgcmVhZG91dCwg
YW5kIHJlYWQgb3V0IEZFQyBlbmFibGUgc3RhdGUKYW5kIGNvcnJlY3QgdGhlIERESSBjbG9jayBy
ZWFkb3V0IGZvciB0aGUgbmV3IHZhbHVlcy4KClRoaXMgZml4ZXMgdGhlIEZJRk8gdW5kZXJydW4g
d2UgYXJlIHNlZWluZyB3aXRoIEZFQyBlbmFibGVkLgoKQ2hhbmdlcyBzaW5jZSB2MjoKLSBIYW5k
bGUgZmVjX2VuYWJsZSBpbiBpbnRlbF9saW5rX2NvbXB1dGVfbV9uLCBzbyBvbmx5IGRhdGEgTS9O
IGlzIGFkanVzdGVkLiAoVmlsbGUpCi0gRml4IGluaXRpYWwgaGFyZHdhcmUgcmVhZG91dCBmb3Ig
RkVDLiAoVmlsbGUpCgpTaWduZWQtb2ZmLWJ5OiBNYWFydGVuIExhbmtob3JzdCA8bWFhcnRlbi5s
YW5raG9yc3RAbGludXguaW50ZWwuY29tPgpGaXhlczogZDkyMThjOGY2Y2Y0ICgiZHJtL2k5MTUv
ZHA6IEFkZCBoZWxwZXJzIGZvciBDb21wcmVzc2VkIEJQUCBhbmQgU2xpY2UgQ291bnQgZm9yIERT
QyIpCkNjOiA8c3RhYmxlQHZnZXIua2VybmVsLm9yZz4gIyB2NS4wKwpDYzogTWFuYXNpIE5hdmFy
ZSA8bWFuYXNpLmQubmF2YXJlQGludGVsLmNvbT4KLS0tClRoYW5rcywgdGhhdCBmaXhlZCB0aGUg
RklGTyB1bmRlcnJ1biwgbWFraW5nIHRoZSBkaXNhYmxlbWVudCBwYXRjaCBvYnNvbGV0ZS4KQmln
am9pbmVyIGlzIG5vdyBjb21wbGV0ZWx5IHdvcmtpbmcgYXMgaW50ZW5kZWQuIDopCgogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYyAgICAgfCAgMjEgKysKIGRyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIHwgIDEzICstCiBkcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuaCB8ICAgMiArLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jICAgICAgfCAxOTEgKysrKysrKysrKy0tLS0tLS0t
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5oICAgICAgfCAgIDcgKy0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHBfbXN0LmMgIHwgICAyICstCiA2
IGZpbGVzIGNoYW5nZWQsIDEzNyBpbnNlcnRpb25zKCspLCA5OSBkZWxldGlvbnMoLSkKCmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kZGkuYwppbmRleCAwYzBkYTlmNmMyZTguLjNl
NzdiMzBkOTFkNSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kZGkuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RkaS5jCkBA
IC0xNDc5LDYgKzE0NzksMTAgQEAgc3RhdGljIHZvaWQgZGRpX2RvdGNsb2NrX2dldChzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqcGlwZV9jb25maWcpCiAJaWYgKHBpcGVfY29uZmlnLT5waXhlbF9t
dWx0aXBsaWVyKQogCQlkb3RjbG9jayAvPSBwaXBlX2NvbmZpZy0+cGl4ZWxfbXVsdGlwbGllcjsK
IAorCS8qIGZlYyBhZGRzIG92ZXJoZWFkIHRvIHRoZSBkYXRhIE0vTiB2YWx1ZXMsIGNvcnJlY3Qg
Zm9yIGl0ICovCisJaWYgKHBpcGVfY29uZmlnLT5mZWNfZW5hYmxlKQorCQlkb3RjbG9jayA9IGlu
dGVsX2RwX2ZlY190b19tb2RlX2Nsb2NrKGRvdGNsb2NrKTsKKwogCXBpcGVfY29uZmlnLT5iYXNl
LmFkanVzdGVkX21vZGUuY3J0Y19jbG9jayA9IGRvdGNsb2NrOwogfQogCkBAIC00MDQ1LDYgKzQw
NDksMjMgQEAgdm9pZCBpbnRlbF9kZGlfZ2V0X2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAq
ZW5jb2RlciwKIAkJcGlwZV9jb25maWctPmxhbmVfY291bnQgPQogCQkJKCh0ZW1wICYgRERJX1BP
UlRfV0lEVEhfTUFTSykgPj4gRERJX1BPUlRfV0lEVEhfU0hJRlQpICsgMTsKIAkJaW50ZWxfZHBf
Z2V0X21fbihpbnRlbF9jcnRjLCBwaXBlX2NvbmZpZyk7CisKKwkJaWYgKElOVEVMX0dFTihkZXZf
cHJpdikgPj0gMTEpIHsKKwkJCWk5MTVfcmVnX3QgZHBfdHBfY3RsOworCisJCQlpZiAoSVNfR0VO
KGRldl9wcml2LCAxMSkpCisJCQkJZHBfdHBfY3RsID0gRFBfVFBfQ1RMKHBpcGVfY29uZmlnLT5j
cHVfdHJhbnNjb2Rlcik7CisJCQllbHNlCisJCQkJZHBfdHBfY3RsID0gVEdMX0RQX1RQX0NUTChw
aXBlX2NvbmZpZy0+Y3B1X3RyYW5zY29kZXIpOworCisJCQlwaXBlX2NvbmZpZy0+ZmVjX2VuYWJs
ZSA9CisJCQkJSTkxNV9SRUFEKGRwX3RwX2N0bCkgJiBEUF9UUF9DVExfRkVDX0VOQUJMRTsKKwor
CQkJRFJNX0RFQlVHX0tNUygiW0VOQ09ERVI6JWQ6JXNdIEZlYyBzdGF0dXM6ICV1XG4iLAorCQkJ
CSAgICAgIGVuY29kZXItPmJhc2UuYmFzZS5pZCwgZW5jb2Rlci0+YmFzZS5uYW1lLAorCQkJCSAg
ICAgIHBpcGVfY29uZmlnLT5mZWNfZW5hYmxlKTsKKwkJfQorCiAJCWJyZWFrOwogCWNhc2UgVFJB
TlNfRERJX01PREVfU0VMRUNUX0RQX01TVDoKIAkJcGlwZV9jb25maWctPm91dHB1dF90eXBlcyB8
PSBCSVQoSU5URUxfT1VUUFVUX0RQX01TVCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGlzcGxheS5jCmluZGV4IDVlY2Y1NDI3MDE4MS4uMzE2OThhNTc3NzNmIDEwMDY0
NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwpAQCAtNzI5MSw3
ICs3MjkxLDcgQEAgc3RhdGljIGludCBpcm9ubGFrZV9mZGlfY29tcHV0ZV9jb25maWcoc3RydWN0
IGludGVsX2NydGMgKmludGVsX2NydGMsCiAJcGlwZV9jb25maWctPmZkaV9sYW5lcyA9IGxhbmU7
CiAKIAlpbnRlbF9saW5rX2NvbXB1dGVfbV9uKHBpcGVfY29uZmlnLT5waXBlX2JwcCwgbGFuZSwg
ZmRpX2RvdGNsb2NrLAotCQkJICAgICAgIGxpbmtfYncsICZwaXBlX2NvbmZpZy0+ZmRpX21fbiwg
ZmFsc2UpOworCQkJICAgICAgIGxpbmtfYncsICZwaXBlX2NvbmZpZy0+ZmRpX21fbiwgZmFsc2Us
IGZhbHNlKTsKIAogCXJldCA9IGlyb25sYWtlX2NoZWNrX2ZkaV9sYW5lcyhkZXYsIGludGVsX2Ny
dGMtPnBpcGUsIHBpcGVfY29uZmlnKTsKIAlpZiAocmV0ID09IC1FREVBRExLKQpAQCAtNzUzOCwx
MSArNzUzOCwxNSBAQCB2b2lkCiBpbnRlbF9saW5rX2NvbXB1dGVfbV9uKHUxNiBiaXRzX3Blcl9w
aXhlbCwgaW50IG5sYW5lcywKIAkJICAgICAgIGludCBwaXhlbF9jbG9jaywgaW50IGxpbmtfY2xv
Y2ssCiAJCSAgICAgICBzdHJ1Y3QgaW50ZWxfbGlua19tX24gKm1fbiwKLQkJICAgICAgIGJvb2wg
Y29uc3RhbnRfbikKKwkJICAgICAgIGJvb2wgY29uc3RhbnRfbiwgYm9vbCBmZWNfZW5hYmxlKQog
ewotCW1fbi0+dHUgPSA2NDsKKwl1MzIgZGF0YV9jbG9jayA9IGJpdHNfcGVyX3BpeGVsICogcGl4
ZWxfY2xvY2s7CisKKwlpZiAoZmVjX2VuYWJsZSkKKwkJZGF0YV9jbG9jayA9IGludGVsX2RwX21v
ZGVfdG9fZmVjX2Nsb2NrKGRhdGFfY2xvY2spOwogCi0JY29tcHV0ZV9tX24oYml0c19wZXJfcGl4
ZWwgKiBwaXhlbF9jbG9jaywKKwltX24tPnR1ID0gNjQ7CisJY29tcHV0ZV9tX24oZGF0YV9jbG9j
aywKIAkJICAgIGxpbmtfY2xvY2sgKiBubGFuZXMgKiA4LAogCQkgICAgJm1fbi0+Z21jaF9tLCAm
bV9uLT5nbWNoX24sCiAJCSAgICBjb25zdGFudF9uKTsKQEAgLTEyODMyLDYgKzEyODM2LDcgQEAg
aW50ZWxfcGlwZV9jb25maWdfY29tcGFyZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3VycmVudF9jb25maWcsCiAJUElQRV9DT05GX0NIRUNLX0JPT0woaGRtaV9zY3JhbWJsaW5nKTsK
IAlQSVBFX0NPTkZfQ0hFQ0tfQk9PTChoZG1pX2hpZ2hfdG1kc19jbG9ja19yYXRpbyk7CiAJUElQ
RV9DT05GX0NIRUNLX0JPT0woaGFzX2luZm9mcmFtZSk7CisJUElQRV9DT05GX0NIRUNLX0JPT0wo
ZmVjX2VuYWJsZSk7CiAKIAlQSVBFX0NPTkZfQ0hFQ0tfQk9PTF9JTkNPTVBMRVRFKGhhc19hdWRp
byk7CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlz
cGxheS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmgKaW5k
ZXggNWNlYTZmOGUxMDdhLi40YjllMThlNWEyNjMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5oCkBAIC00NDMsNyArNDQzLDcgQEAgZW51bSBwaHlfZmlh
IHsKIHZvaWQgaW50ZWxfbGlua19jb21wdXRlX21fbih1MTYgYnBwLCBpbnQgbmxhbmVzLAogCQkJ
ICAgIGludCBwaXhlbF9jbG9jaywgaW50IGxpbmtfY2xvY2ssCiAJCQkgICAgc3RydWN0IGludGVs
X2xpbmtfbV9uICptX24sCi0JCQkgICAgYm9vbCBjb25zdGFudF9uKTsKKwkJCSAgICBib29sIGNv
bnN0YW50X24sIGJvb2wgZmVjX2VuYWJsZSk7CiBib29sIGlzX2Njc19tb2RpZmllcih1NjQgbW9k
aWZpZXIpOwogdm9pZCBscHRfZGlzYWJsZV9jbGtvdXRfZHAoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2KTsKIHUzMiBpbnRlbF9wbGFuZV9mYl9tYXhfc3RyaWRlKHN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICpkZXZfcHJpdiwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZHAuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZHAuYwppbmRleCA4Mjk1NTlmOTc0NDAuLjJkM2Y0MTgzZjk5ZCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2Rpc3BsYXkvaW50ZWxfZHAuYwpAQCAtNzYsOCArNzYsOCBAQAogI2RlZmluZSBEUF9EU0Nf
TUFYX0VOQ19USFJPVUdIUFVUXzAJCTM0MDAwMAogI2RlZmluZSBEUF9EU0NfTUFYX0VOQ19USFJP
VUdIUFVUXzEJCTQwMDAwMAogCi0vKiBEUCBEU0MgRkVDIE92ZXJoZWFkIGZhY3RvciA9ICgxMDAg
LSAyLjQpLzEwMCAqLwotI2RlZmluZSBEUF9EU0NfRkVDX09WRVJIRUFEX0ZBQ1RPUgkJOTc2Cisv
KiBEUCBEU0MgRkVDIE92ZXJoZWFkIGZhY3RvciA9IDEvKDAuOTcyMjYxKSAqLworI2RlZmluZSBE
UF9EU0NfRkVDX09WRVJIRUFEX0ZBQ1RPUgkJOTcyMjYxCiAKIC8qIENvbXBsaWFuY2UgdGVzdCBz
dGF0dXMgYml0cyAgKi8KICNkZWZpbmUgSU5URUxfRFBfUkVTT0xVVElPTl9TSElGVF9NQVNLCTAK
QEAgLTQ5Miw2ICs0OTIsMTA0IEBAIGludCBpbnRlbF9kcF9nZXRfbGlua190cmFpbl9mYWxsYmFj
a192YWx1ZXMoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKIAlyZXR1cm4gMDsKIH0KIAordTMy
IGludGVsX2RwX21vZGVfdG9fZmVjX2Nsb2NrKHUzMiBtb2RlX2Nsb2NrKQoreworCXJldHVybiBk
aXZfdTY0KG11bF91MzJfdTMyKG1vZGVfY2xvY2ssIDEwMDAwMDBVKSwKKwkJICAgICAgIERQX0RT
Q19GRUNfT1ZFUkhFQURfRkFDVE9SKTsKK30KKwordTMyIGludGVsX2RwX2ZlY190b19tb2RlX2Ns
b2NrKHUzMiBmZWNfY2xvY2spCit7CisJcmV0dXJuIGRpdl91NjQobXVsX3UzMl91MzIoZmVjX2Ns
b2NrLAorCQkJCSAgIERQX0RTQ19GRUNfT1ZFUkhFQURfRkFDVE9SKSwKKwkJICAgICAgIDEwMDAw
MDBVKTsKK30KKworc3RhdGljIHUxNiBpbnRlbF9kcF9kc2NfZ2V0X291dHB1dF9icHAodTMyIGxp
bmtfY2xvY2ssIHUzMiBsYW5lX2NvdW50LAorCQkJCSAgICAgICB1MzIgbW9kZV9jbG9jaywgdTMy
IG1vZGVfaGRpc3BsYXkpCit7CisJdTMyIGJpdHNfcGVyX3BpeGVsLCBtYXhfYnBwX3NtYWxsX2pv
aW5lcl9yYW07CisJaW50IGk7CisKKwkvKgorCSAqIEF2YWlsYWJsZSBMaW5rIEJhbmR3aWR0aChL
Yml0cy9zZWMpID0gKE51bWJlck9mTGFuZXMpKgorCSAqIChMaW5rU3ltYm9sQ2xvY2spKiA4ICog
KFRpbWVTbG90c1Blck1UUCkKKwkgKiBmb3IgU1NUIC0+IFRpbWVTbG90c1Blck1UUCBpcyAxLAor
CSAqIGZvciBNU1QgLT4gVGltZVNsb3RzUGVyTVRQIGhhcyB0byBiZSBjYWxjdWxhdGVkCisJICov
CisJYml0c19wZXJfcGl4ZWwgPSAobGlua19jbG9jayAqIGxhbmVfY291bnQgKiA4KSAvCisJCQkg
aW50ZWxfZHBfbW9kZV90b19mZWNfY2xvY2sobW9kZV9jbG9jayk7CisJRFJNX0RFQlVHX0tNUygi
TWF4IGxpbmsgYnBwOiAldVxuIiwgYml0c19wZXJfcGl4ZWwpOworCisJLyogU21hbGwgSm9pbmVy
IENoZWNrOiBvdXRwdXQgYnBwIDw9IGpvaW5lciBSQU0gKGJpdHMpIC8gSG9yaXouIHdpZHRoICov
CisJbWF4X2JwcF9zbWFsbF9qb2luZXJfcmFtID0gRFBfRFNDX01BWF9TTUFMTF9KT0lORVJfUkFN
X0JVRkZFUiAvIG1vZGVfaGRpc3BsYXk7CisJRFJNX0RFQlVHX0tNUygiTWF4IHNtYWxsIGpvaW5l
ciBicHA6ICV1XG4iLCBtYXhfYnBwX3NtYWxsX2pvaW5lcl9yYW0pOworCisJLyoKKwkgKiBHcmVh
dGVzdCBhbGxvd2VkIERTQyBCUFAgPSBNSU4gKG91dHB1dCBCUFAgZnJvbSBhdmFpbGFibGUgTGlu
ayBCVworCSAqIGNoZWNrLCBvdXRwdXQgYnBwIGZyb20gc21hbGwgam9pbmVyIFJBTSBjaGVjaykK
KwkgKi8KKwliaXRzX3Blcl9waXhlbCA9IG1pbihiaXRzX3Blcl9waXhlbCwgbWF4X2JwcF9zbWFs
bF9qb2luZXJfcmFtKTsKKworCS8qIEVycm9yIG91dCBpZiB0aGUgbWF4IGJwcCBpcyBsZXNzIHRo
YW4gc21hbGxlc3QgYWxsb3dlZCB2YWxpZCBicHAgKi8KKwlpZiAoYml0c19wZXJfcGl4ZWwgPCB2
YWxpZF9kc2NfYnBwWzBdKSB7CisJCURSTV9ERUJVR19LTVMoIlVuc3VwcG9ydGVkIEJQUCAldSwg
bWluICV1XG4iLAorCQkJICAgICAgYml0c19wZXJfcGl4ZWwsIHZhbGlkX2RzY19icHBbMF0pOwor
CQlyZXR1cm4gMDsKKwl9CisKKwkvKiBGaW5kIHRoZSBuZWFyZXN0IG1hdGNoIGluIHRoZSBhcnJh
eSBvZiBrbm93biBCUFBzIGZyb20gVkVTQSAqLworCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpF
KHZhbGlkX2RzY19icHApIC0gMTsgaSsrKSB7CisJCWlmIChiaXRzX3Blcl9waXhlbCA8IHZhbGlk
X2RzY19icHBbaSArIDFdKQorCQkJYnJlYWs7CisJfQorCWJpdHNfcGVyX3BpeGVsID0gdmFsaWRf
ZHNjX2JwcFtpXTsKKworCS8qCisJICogQ29tcHJlc3NlZCBCUFAgaW4gVTYuNCBmb3JtYXQgc28g
bXVsdGlwbHkgYnkgMTYsIGZvciBHZW4gMTEsCisJICogZnJhY3Rpb25hbCBwYXJ0IGlzIDAKKwkg
Ki8KKwlyZXR1cm4gYml0c19wZXJfcGl4ZWwgPDwgNDsKK30KKworc3RhdGljIHU4IGludGVsX2Rw
X2RzY19nZXRfc2xpY2VfY291bnQoc3RydWN0IGludGVsX2RwICppbnRlbF9kcCwKKwkJCQkgICAg
ICAgaW50IG1vZGVfY2xvY2ssIGludCBtb2RlX2hkaXNwbGF5KQoreworCXU4IG1pbl9zbGljZV9j
b3VudCwgaTsKKwlpbnQgbWF4X3NsaWNlX3dpZHRoOworCisJaWYgKG1vZGVfY2xvY2sgPD0gRFBf
RFNDX1BFQUtfUElYRUxfUkFURSkKKwkJbWluX3NsaWNlX2NvdW50ID0gRElWX1JPVU5EX1VQKG1v
ZGVfY2xvY2ssCisJCQkJCSAgICAgICBEUF9EU0NfTUFYX0VOQ19USFJPVUdIUFVUXzApOworCWVs
c2UKKwkJbWluX3NsaWNlX2NvdW50ID0gRElWX1JPVU5EX1VQKG1vZGVfY2xvY2ssCisJCQkJCSAg
ICAgICBEUF9EU0NfTUFYX0VOQ19USFJPVUdIUFVUXzEpOworCisJbWF4X3NsaWNlX3dpZHRoID0g
ZHJtX2RwX2RzY19zaW5rX21heF9zbGljZV93aWR0aChpbnRlbF9kcC0+ZHNjX2RwY2QpOworCWlm
IChtYXhfc2xpY2Vfd2lkdGggPCBEUF9EU0NfTUlOX1NMSUNFX1dJRFRIX1ZBTFVFKSB7CisJCURS
TV9ERUJVR19LTVMoIlVuc3VwcG9ydGVkIHNsaWNlIHdpZHRoICVkIGJ5IERQIERTQyBTaW5rIGRl
dmljZVxuIiwKKwkJCSAgICAgIG1heF9zbGljZV93aWR0aCk7CisJCXJldHVybiAwOworCX0KKwkv
KiBBbHNvIHRha2UgaW50byBhY2NvdW50IG1heCBzbGljZSB3aWR0aCAqLworCW1pbl9zbGljZV9j
b3VudCA9IG1pbl90KHU4LCBtaW5fc2xpY2VfY291bnQsCisJCQkJRElWX1JPVU5EX1VQKG1vZGVf
aGRpc3BsYXksCisJCQkJCSAgICAgbWF4X3NsaWNlX3dpZHRoKSk7CisKKwkvKiBGaW5kIHRoZSBj
bG9zZXN0IG1hdGNoIHRvIHRoZSB2YWxpZCBzbGljZSBjb3VudCB2YWx1ZXMgKi8KKwlmb3IgKGkg
PSAwOyBpIDwgQVJSQVlfU0laRSh2YWxpZF9kc2Nfc2xpY2Vjb3VudCk7IGkrKykgeworCQlpZiAo
dmFsaWRfZHNjX3NsaWNlY291bnRbaV0gPgorCQkgICAgZHJtX2RwX2RzY19zaW5rX21heF9zbGlj
ZV9jb3VudChpbnRlbF9kcC0+ZHNjX2RwY2QsCisJCQkJCQkgICAgZmFsc2UpKQorCQkJYnJlYWs7
CisJCWlmIChtaW5fc2xpY2VfY291bnQgIDw9IHZhbGlkX2RzY19zbGljZWNvdW50W2ldKQorCQkJ
cmV0dXJuIHZhbGlkX2RzY19zbGljZWNvdW50W2ldOworCX0KKworCURSTV9ERUJVR19LTVMoIlVu
c3VwcG9ydGVkIFNsaWNlIENvdW50ICVkXG4iLCBtaW5fc2xpY2VfY291bnQpOworCXJldHVybiAw
OworfQorCiBzdGF0aWMgZW51bSBkcm1fbW9kZV9zdGF0dXMKIGludGVsX2RwX21vZGVfdmFsaWQo
c3RydWN0IGRybV9jb25uZWN0b3IgKmNvbm5lY3RvciwKIAkJICAgIHN0cnVjdCBkcm1fZGlzcGxh
eV9tb2RlICptb2RlKQpAQCAtMjI1OSw3ICsyMzU3LDcgQEAgaW50ZWxfZHBfY29tcHV0ZV9jb25m
aWcoc3RydWN0IGludGVsX2VuY29kZXIgKmVuY29kZXIsCiAJCQkgICAgICAgYWRqdXN0ZWRfbW9k
ZS0+Y3J0Y19jbG9jaywKIAkJCSAgICAgICBwaXBlX2NvbmZpZy0+cG9ydF9jbG9jaywKIAkJCSAg
ICAgICAmcGlwZV9jb25maWctPmRwX21fbiwKLQkJCSAgICAgICBjb25zdGFudF9uKTsKKwkJCSAg
ICAgICBjb25zdGFudF9uLCBwaXBlX2NvbmZpZy0+ZmVjX2VuYWJsZSk7CiAKIAlpZiAoaW50ZWxf
Y29ubmVjdG9yLT5wYW5lbC5kb3duY2xvY2tfbW9kZSAhPSBOVUxMICYmCiAJCWRldl9wcml2LT5k
cnJzLnR5cGUgPT0gU0VBTUxFU1NfRFJSU19TVVBQT1JUKSB7CkBAIC0yMjY5LDcgKzIzNjcsNyBA
QCBpbnRlbF9kcF9jb21wdXRlX2NvbmZpZyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwK
IAkJCQkJICAgICAgIGludGVsX2Nvbm5lY3Rvci0+cGFuZWwuZG93bmNsb2NrX21vZGUtPmNsb2Nr
LAogCQkJCQkgICAgICAgcGlwZV9jb25maWctPnBvcnRfY2xvY2ssCiAJCQkJCSAgICAgICAmcGlw
ZV9jb25maWctPmRwX20yX24yLAotCQkJCQkgICAgICAgY29uc3RhbnRfbik7CisJCQkJCSAgICAg
ICBjb25zdGFudF9uLCBwaXBlX2NvbmZpZy0+ZmVjX2VuYWJsZSk7CiAJfQogCiAJaWYgKCFIQVNf
RERJKGRldl9wcml2KSkKQEAgLTQzNzMsOTEgKzQ0NzEsNiBAQCBpbnRlbF9kcF9nZXRfc2lua19p
cnFfZXNpKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsIHU4ICpzaW5rX2lycV92ZWN0b3IpCiAJ
CURQX0RQUlhfRVNJX0xFTjsKIH0KIAotdTE2IGludGVsX2RwX2RzY19nZXRfb3V0cHV0X2JwcChp
bnQgbGlua19jbG9jaywgdTggbGFuZV9jb3VudCwKLQkJCQlpbnQgbW9kZV9jbG9jaywgaW50IG1v
ZGVfaGRpc3BsYXkpCi17Ci0JdTE2IGJpdHNfcGVyX3BpeGVsLCBtYXhfYnBwX3NtYWxsX2pvaW5l
cl9yYW07Ci0JaW50IGk7Ci0KLQkvKgotCSAqIEF2YWlsYWJsZSBMaW5rIEJhbmR3aWR0aChLYml0
cy9zZWMpID0gKE51bWJlck9mTGFuZXMpKgotCSAqIChMaW5rU3ltYm9sQ2xvY2spKiA4ICogKCgx
MDAtRkVDT3ZlcmhlYWQpLzEwMCkqKFRpbWVTbG90c1Blck1UUCkKLQkgKiBGRUNPdmVyaGVhZCA9
IDIuNCUsIGZvciBTU1QgLT4gVGltZVNsb3RzUGVyTVRQIGlzIDEsCi0JICogZm9yIE1TVCAtPiBU
aW1lU2xvdHNQZXJNVFAgaGFzIHRvIGJlIGNhbGN1bGF0ZWQKLQkgKi8KLQliaXRzX3Blcl9waXhl
bCA9IChsaW5rX2Nsb2NrICogbGFuZV9jb3VudCAqIDggKgotCQkJICBEUF9EU0NfRkVDX09WRVJI
RUFEX0ZBQ1RPUikgLwotCQltb2RlX2Nsb2NrOwotCi0JLyogU21hbGwgSm9pbmVyIENoZWNrOiBv
dXRwdXQgYnBwIDw9IGpvaW5lciBSQU0gKGJpdHMpIC8gSG9yaXouIHdpZHRoICovCi0JbWF4X2Jw
cF9zbWFsbF9qb2luZXJfcmFtID0gRFBfRFNDX01BWF9TTUFMTF9KT0lORVJfUkFNX0JVRkZFUiAv
Ci0JCW1vZGVfaGRpc3BsYXk7Ci0KLQkvKgotCSAqIEdyZWF0ZXN0IGFsbG93ZWQgRFNDIEJQUCA9
IE1JTiAob3V0cHV0IEJQUCBmcm9tIGF2YWlhbGJsZSBMaW5rIEJXCi0JICogY2hlY2ssIG91dHB1
dCBicHAgZnJvbSBzbWFsbCBqb2luZXIgUkFNIGNoZWNrKQotCSAqLwotCWJpdHNfcGVyX3BpeGVs
ID0gbWluKGJpdHNfcGVyX3BpeGVsLCBtYXhfYnBwX3NtYWxsX2pvaW5lcl9yYW0pOwotCi0JLyog
RXJyb3Igb3V0IGlmIHRoZSBtYXggYnBwIGlzIGxlc3MgdGhhbiBzbWFsbGVzdCBhbGxvd2VkIHZh
bGlkIGJwcCAqLwotCWlmIChiaXRzX3Blcl9waXhlbCA8IHZhbGlkX2RzY19icHBbMF0pIHsKLQkJ
RFJNX0RFQlVHX0tNUygiVW5zdXBwb3J0ZWQgQlBQICVkXG4iLCBiaXRzX3Blcl9waXhlbCk7Ci0J
CXJldHVybiAwOwotCX0KLQotCS8qIEZpbmQgdGhlIG5lYXJlc3QgbWF0Y2ggaW4gdGhlIGFycmF5
IG9mIGtub3duIEJQUHMgZnJvbSBWRVNBICovCi0JZm9yIChpID0gMDsgaSA8IEFSUkFZX1NJWkUo
dmFsaWRfZHNjX2JwcCkgLSAxOyBpKyspIHsKLQkJaWYgKGJpdHNfcGVyX3BpeGVsIDwgdmFsaWRf
ZHNjX2JwcFtpICsgMV0pCi0JCQlicmVhazsKLQl9Ci0JYml0c19wZXJfcGl4ZWwgPSB2YWxpZF9k
c2NfYnBwW2ldOwotCi0JLyoKLQkgKiBDb21wcmVzc2VkIEJQUCBpbiBVNi40IGZvcm1hdCBzbyBt
dWx0aXBseSBieSAxNiwgZm9yIEdlbiAxMSwKLQkgKiBmcmFjdGlvbmFsIHBhcnQgaXMgMAotCSAq
LwotCXJldHVybiBiaXRzX3Blcl9waXhlbCA8PCA0OwotfQotCi11OCBpbnRlbF9kcF9kc2NfZ2V0
X3NsaWNlX2NvdW50KHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHAsCi0JCQkJaW50IG1vZGVfY2xv
Y2ssCi0JCQkJaW50IG1vZGVfaGRpc3BsYXkpCi17Ci0JdTggbWluX3NsaWNlX2NvdW50LCBpOwot
CWludCBtYXhfc2xpY2Vfd2lkdGg7Ci0KLQlpZiAobW9kZV9jbG9jayA8PSBEUF9EU0NfUEVBS19Q
SVhFTF9SQVRFKQotCQltaW5fc2xpY2VfY291bnQgPSBESVZfUk9VTkRfVVAobW9kZV9jbG9jaywK
LQkJCQkJICAgICAgIERQX0RTQ19NQVhfRU5DX1RIUk9VR0hQVVRfMCk7Ci0JZWxzZQotCQltaW5f
c2xpY2VfY291bnQgPSBESVZfUk9VTkRfVVAobW9kZV9jbG9jaywKLQkJCQkJICAgICAgIERQX0RT
Q19NQVhfRU5DX1RIUk9VR0hQVVRfMSk7Ci0KLQltYXhfc2xpY2Vfd2lkdGggPSBkcm1fZHBfZHNj
X3NpbmtfbWF4X3NsaWNlX3dpZHRoKGludGVsX2RwLT5kc2NfZHBjZCk7Ci0JaWYgKG1heF9zbGlj
ZV93aWR0aCA8IERQX0RTQ19NSU5fU0xJQ0VfV0lEVEhfVkFMVUUpIHsKLQkJRFJNX0RFQlVHX0tN
UygiVW5zdXBwb3J0ZWQgc2xpY2Ugd2lkdGggJWQgYnkgRFAgRFNDIFNpbmsgZGV2aWNlXG4iLAot
CQkJICAgICAgbWF4X3NsaWNlX3dpZHRoKTsKLQkJcmV0dXJuIDA7Ci0JfQotCS8qIEFsc28gdGFr
ZSBpbnRvIGFjY291bnQgbWF4IHNsaWNlIHdpZHRoICovCi0JbWluX3NsaWNlX2NvdW50ID0gbWlu
X3QodTgsIG1pbl9zbGljZV9jb3VudCwKLQkJCQlESVZfUk9VTkRfVVAobW9kZV9oZGlzcGxheSwK
LQkJCQkJICAgICBtYXhfc2xpY2Vfd2lkdGgpKTsKLQotCS8qIEZpbmQgdGhlIGNsb3Nlc3QgbWF0
Y2ggdG8gdGhlIHZhbGlkIHNsaWNlIGNvdW50IHZhbHVlcyAqLwotCWZvciAoaSA9IDA7IGkgPCBB
UlJBWV9TSVpFKHZhbGlkX2RzY19zbGljZWNvdW50KTsgaSsrKSB7Ci0JCWlmICh2YWxpZF9kc2Nf
c2xpY2Vjb3VudFtpXSA+Ci0JCSAgICBkcm1fZHBfZHNjX3NpbmtfbWF4X3NsaWNlX2NvdW50KGlu
dGVsX2RwLT5kc2NfZHBjZCwKLQkJCQkJCSAgICBmYWxzZSkpCi0JCQlicmVhazsKLQkJaWYgKG1p
bl9zbGljZV9jb3VudCAgPD0gdmFsaWRfZHNjX3NsaWNlY291bnRbaV0pCi0JCQlyZXR1cm4gdmFs
aWRfZHNjX3NsaWNlY291bnRbaV07Ci0JfQotCi0JRFJNX0RFQlVHX0tNUygiVW5zdXBwb3J0ZWQg
U2xpY2UgQ291bnQgJWRcbiIsIG1pbl9zbGljZV9jb3VudCk7Ci0JcmV0dXJuIDA7Ci19Ci0KIHN0
YXRpYyB2b2lkCiBpbnRlbF9waXhlbF9lbmNvZGluZ19zZXR1cF92c2Moc3RydWN0IGludGVsX2Rw
ICppbnRlbF9kcCwKIAkJCSAgICAgICBjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0
Y19zdGF0ZSkKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZHAuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHAuaAppbmRleCBlMDFk
MWY4OTQwOWQuLjIxNDdkM2MxNDg3MCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kcC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZHAuaApAQCAtMTAzLDEwICsxMDMsNiBAQCBib29sIGludGVsX2RwX3NvdXJjZV9zdXBwb3J0
c19oYnIyKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApOwogYm9vbCBpbnRlbF9kcF9zb3VyY2Vf
c3VwcG9ydHNfaGJyMyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwKTsKIGJvb2wKIGludGVsX2Rw
X2dldF9saW5rX3N0YXR1cyhzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCB1OCAqbGlua19zdGF0
dXMpOwotdTE2IGludGVsX2RwX2RzY19nZXRfb3V0cHV0X2JwcChpbnQgbGlua19jbG9jaywgdTgg
bGFuZV9jb3VudCwKLQkJCQlpbnQgbW9kZV9jbG9jaywgaW50IG1vZGVfaGRpc3BsYXkpOwotdTgg
aW50ZWxfZHBfZHNjX2dldF9zbGljZV9jb3VudChzdHJ1Y3QgaW50ZWxfZHAgKmludGVsX2RwLCBp
bnQgbW9kZV9jbG9jaywKLQkJCQlpbnQgbW9kZV9oZGlzcGxheSk7CiAKIGJvb2wgaW50ZWxfZHBf
cmVhZF9kcGNkKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApOwogYm9vbCBpbnRlbF9kcF9nZXRf
Y29sb3JpbWV0cnlfc3RhdHVzKHN0cnVjdCBpbnRlbF9kcCAqaW50ZWxfZHApOwpAQCAtMTE5LDQg
KzExNSw3IEBAIHN0YXRpYyBpbmxpbmUgdW5zaWduZWQgaW50IGludGVsX2RwX3VudXNlZF9sYW5l
X21hc2soaW50IGxhbmVfY291bnQpCiAJcmV0dXJuIH4oKDEgPDwgbGFuZV9jb3VudCkgLSAxKSAm
IDB4ZjsKIH0KIAordTMyIGludGVsX2RwX2ZlY190b19tb2RlX2Nsb2NrKHUzMiBmZWNfY2xvY2sp
OwordTMyIGludGVsX2RwX21vZGVfdG9fZmVjX2Nsb2NrKHUzMiBtb2RlX2Nsb2NrKTsKKwogI2Vu
ZGlmIC8qIF9fSU5URUxfRFBfSF9fICovCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2RwX21zdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kcF9tc3QuYwppbmRleCBlZWViM2Y5MzNhYTQuLmNmNGQ4NTFhNTEzOSAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kcF9tc3QuYworKysgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2RwX21zdC5jCkBAIC04MSw3ICs4MSw3IEBA
IHN0YXRpYyBpbnQgaW50ZWxfZHBfbXN0X2NvbXB1dGVfbGlua19jb25maWcoc3RydWN0IGludGVs
X2VuY29kZXIgKmVuY29kZXIsCiAJCQkgICAgICAgYWRqdXN0ZWRfbW9kZS0+Y3J0Y19jbG9jaywK
IAkJCSAgICAgICBjcnRjX3N0YXRlLT5wb3J0X2Nsb2NrLAogCQkJICAgICAgICZjcnRjX3N0YXRl
LT5kcF9tX24sCi0JCQkgICAgICAgY29uc3RhbnRfbik7CisJCQkgICAgICAgY29uc3RhbnRfbiwg
Y3J0Y19zdGF0ZS0+ZmVjX2VuYWJsZSk7CiAJY3J0Y19zdGF0ZS0+ZHBfbV9uLnR1ID0gc2xvdHM7
CiAKIAlyZXR1cm4gMDsKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlz
dGluZm8vaW50ZWwtZ2Z4

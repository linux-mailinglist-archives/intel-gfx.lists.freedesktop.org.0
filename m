Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 84B309CA0F
	for <lists+intel-gfx@lfdr.de>; Mon, 26 Aug 2019 09:22:26 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 6953B6E1BE;
	Mon, 26 Aug 2019 07:22:21 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B25DC6E1BE
 for <intel-gfx@lists.freedesktop.org>; Mon, 26 Aug 2019 07:22:16 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18262690-1500050 
 for multiple; Mon, 26 Aug 2019 08:21:54 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 26 Aug 2019 08:21:36 +0100
Message-Id: <20190826072149.9447-15-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190826072149.9447-1-chris@chris-wilson.co.uk>
References: <20190826072149.9447-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 15/28] drm/i915: Pull i915_vma_pin under the
 vm->mutex
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UmVwbGFjZSB0aGUgc3RydWN0X211dGV4IHJlcXVpcmVtZW50IGZvciBwaW5uaW5nIHRoZSBpOTE1
X3ZtYSB3aXRoIHRoZQpsb2NhbCB2bS0+bXV0ZXggaW5zdGVhZC4gTm90ZSB0aGF0IHRoZSB2bS0+
bXV0ZXggaXMgdGFpbnRlZCBieSB0aGUKc2hyaW5rZXIgKHdlIHJlcXVpcmUgdW5iaW5kaW5nIGZy
b20gaW5zaWRlIGZzLXJlY2xhaW0pIGFuZCBzbyB3ZSBjYW5ub3QKYWxsb2NhdGUgd2hpbGUgaG9s
ZGluZyB0aGF0IG11dGV4LiBJbnN0ZWFkIHdlIGhhdmUgdG8gcHJlYWxsb2NhdGUKd29ya2VycyB0
byBkbyBhbGxvY2F0ZSBhbmQgYXBwbHkgdGhlIFBURSB1cGRhdGVzIGFmdGVyIHdlIGhhdmUgd2UK
cmVzZXJ2ZWQgdGhlaXIgc2xvdCBpbiB0aGUgZHJtX21tICh1c2luZyBmZW5jZXMgdG8gb3JkZXIg
dGhlIFBURSB3cml0ZXMKd2l0aCB0aGUgR1BVIHdvcmsgYW5kIHdpdGggbGF0ZXIgdW5iaW5kKS4K
ClNpZ25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgot
LS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jICB8ICAzMCAr
LQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmRldi5jICAgIHwgICA4ICst
CiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYyAgfCAgMTEgKy0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMgICB8ICAyMCArLQog
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jICAgIHwgIDE5ICstCiAu
Li4vZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9leGVjYnVmZmVyLmMgICAgfCAgMTMgKy0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMgICAgICB8ICAyMSArLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jICAgIHwgIDMzICstCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmggICAgfCAgIDUgKwogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMgIHwgIDY3IC0tLS0KIGRyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zdG9sZW4uYyAgICB8ICAgNSArLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3RpbGluZy5jICAgIHwgIDE1ICstCiBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jICAgfCAgMjcgKy0KIC4uLi9ncHUv
ZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9odWdlX3BhZ2VzLmMgICB8ICAyMyArLQogLi4uL2RybS9p
OTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jICAgIHwgICAyIC0KIGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2d0LmMgICAgICAgICAgICB8ICAgNSArLQogZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMgIHwgIDE5ICstCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9ndnQvYXBlcnR1cmVfZ20uYyAgICAgICAgfCAgMTIgKy0KIGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfYWN0aXZlLmMgICAgICAgICAgICB8ICA2NiArKysrCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2FjdGl2ZS5oICAgICAgICAgICAgfCAgIDIgKwogZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9hY3RpdmVfdHlwZXMuaCAgICAgIHwgICA1ICsKIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtLmMgICAgICAgICAgICAgICB8ICA3OSArKy0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbV9ldmljdC5jICAgICAgICAgfCAgMjAgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtX2ZlbmNlX3JlZy5jICAgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW1fZ3R0LmMgICAgICAgICAgIHwgMTAwICsrKy0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbV9ndHQuaCAgICAgICAgICAgfCAgMzEgKy0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfcGVyZi5jICAgICAgICAgICAgICB8ICAyNiArLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV92bWEuYyAgICAgICAgICAgICAgIHwgMzQ5ICsrKysrKysrKysrLS0tLS0tLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaCAgICAgICAgICAgICAgIHwgIDU5ICsrLQogLi4u
L2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYyAgIHwgIDM2ICstCiBkcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMgfCAgODggKysrLS0KIGRy
aXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5jICAgICB8ICAgMiArCiAzMiBm
aWxlcyBjaGFuZ2VkLCA2MzEgaW5zZXJ0aW9ucygrKSwgNTcxIGRlbGV0aW9ucygtKQoKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKaW5kZXggZWEyOTE1ZGRl
NmFiLi42ZTc0YzMzZjJlYzQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3Bs
YXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZGlzcGxheS5jCkBAIC0yMDc5LDggKzIwNzksNiBAQCBpbnRlbF9waW5fYW5kX2ZlbmNlX2Zi
X29iaihzdHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKIAl1bnNpZ25lZCBpbnQgcGluY3RsOwog
CXUzMiBhbGlnbm1lbnQ7CiAKLQlXQVJOX09OKCFtdXRleF9pc19sb2NrZWQoJmRldi0+c3RydWN0
X211dGV4KSk7Ci0KIAlhbGlnbm1lbnQgPSBpbnRlbF9zdXJmX2FsaWdubWVudChmYiwgMCk7CiAK
IAkvKiBOb3RlIHRoYXQgdGhlIHcvYSBhbHNvIHJlcXVpcmVzIDY0IFBURSBvZiBwYWRkaW5nIGZv
bGxvd2luZyB0aGUKQEAgLTIxNjEsOCArMjE1OSw2IEBAIGludGVsX3Bpbl9hbmRfZmVuY2VfZmJf
b2JqKHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZiLAogCiB2b2lkIGludGVsX3VucGluX2ZiX3Zt
YShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdW5zaWduZWQgbG9uZyBmbGFncykKIHsKLQlsb2NrZGVw
X2Fzc2VydF9oZWxkKCZ2bWEtPnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWk5MTVf
Z2VtX29iamVjdF9sb2NrKHZtYS0+b2JqKTsKIAlpZiAoZmxhZ3MgJiBQTEFORV9IQVNfRkVOQ0Up
CiAJCWk5MTVfdm1hX3VucGluX2ZlbmNlKHZtYSk7CkBAIC0zMDYzLDEyICszMDU5LDEwIEBAIGlu
dGVsX2FsbG9jX2luaXRpYWxfcGxhbmVfb2JqKHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjLAogCQly
ZXR1cm4gZmFsc2U7CiAJfQogCi0JbXV0ZXhfbG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogCW9i
aiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc3RvbGVuX2Zvcl9wcmVhbGxvY2F0ZWQoZGV2X3By
aXYsCiAJCQkJCQkJICAgICBiYXNlX2FsaWduZWQsCiAJCQkJCQkJICAgICBiYXNlX2FsaWduZWQs
CiAJCQkJCQkJICAgICBzaXplX2FsaWduZWQpOwotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3Rf
bXV0ZXgpOwogCWlmICghb2JqKQogCQlyZXR1cm4gZmFsc2U7CiAKQEAgLTMyMzAsMTMgKzMyMjQs
MTEgQEAgaW50ZWxfZmluZF9pbml0aWFsX3BsYW5lX29iaihzdHJ1Y3QgaW50ZWxfY3J0YyAqaW50
ZWxfY3J0YywKIAlpbnRlbF9zdGF0ZS0+Y29sb3JfcGxhbmVbMF0uc3RyaWRlID0KIAkJaW50ZWxf
ZmJfcGl0Y2goZmIsIDAsIGludGVsX3N0YXRlLT5iYXNlLnJvdGF0aW9uKTsKIAotCW11dGV4X2xv
Y2soJmRldi0+c3RydWN0X211dGV4KTsKIAlpbnRlbF9zdGF0ZS0+dm1hID0KIAkJaW50ZWxfcGlu
X2FuZF9mZW5jZV9mYl9vYmooZmIsCiAJCQkJCSAgICZpbnRlbF9zdGF0ZS0+dmlldywKIAkJCQkJ
ICAgaW50ZWxfcGxhbmVfdXNlc19mZW5jZShpbnRlbF9zdGF0ZSksCiAJCQkJCSAgICZpbnRlbF9z
dGF0ZS0+ZmxhZ3MpOwotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogCWlmIChJ
U19FUlIoaW50ZWxfc3RhdGUtPnZtYSkpIHsKIAkJRFJNX0VSUk9SKCJmYWlsZWQgdG8gcGluIGJv
b3QgZmIgb24gcGlwZSAlZDogJWxpXG4iLAogCQkJICBpbnRlbF9jcnRjLT5waXBlLCBQVFJfRVJS
KGludGVsX3N0YXRlLT52bWEpKTsKQEAgLTE0MzMwLDggKzE0MzIyLDYgQEAgc3RhdGljIHZvaWQg
ZmJfb2JqX2J1bXBfcmVuZGVyX3ByaW9yaXR5KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpv
YmopCiAgKiBiaXRzLiAgU29tZSBvbGRlciBwbGF0Zm9ybXMgbmVlZCBzcGVjaWFsIHBoeXNpY2Fs
IGFkZHJlc3MgaGFuZGxpbmcgZm9yCiAgKiBjdXJzb3IgcGxhbmVzLgogICoKLSAqIE11c3QgYmUg
Y2FsbGVkIHdpdGggc3RydWN0X211dGV4IGhlbGQuCi0gKgogICogUmV0dXJucyAwIG9uIHN1Y2Nl
c3MsIG5lZ2F0aXZlIGVycm9yIGNvZGUgb24gZmFpbHVyZS4KICAqLwogaW50CkBAIC0xNDM4OCwx
NSArMTQzNzgsOCBAQCBpbnRlbF9wcmVwYXJlX3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBs
YW5lLAogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlyZXQgPSBtdXRleF9sb2NrX2ludGVy
cnVwdGlibGUoJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAocmV0KSB7Ci0JCWk5
MTVfZ2VtX29iamVjdF91bnBpbl9wYWdlcyhvYmopOwotCQlyZXR1cm4gcmV0OwotCX0KLQogCXJl
dCA9IGludGVsX3BsYW5lX3Bpbl9mYih0b19pbnRlbF9wbGFuZV9zdGF0ZShuZXdfc3RhdGUpKTsK
IAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWk5MTVfZ2Vt
X29iamVjdF91bnBpbl9wYWdlcyhvYmopOwogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CkBAIC0x
NDQ0NSw4ICsxNDQyOCw2IEBAIGludGVsX3ByZXBhcmVfcGxhbmVfZmIoc3RydWN0IGRybV9wbGFu
ZSAqcGxhbmUsCiAgKiBAb2xkX3N0YXRlOiB0aGUgc3RhdGUgZnJvbSB0aGUgcHJldmlvdXMgbW9k
ZXNldAogICoKICAqIENsZWFucyB1cCBhIGZyYW1lYnVmZmVyIHRoYXQgaGFzIGp1c3QgYmVlbiBy
ZW1vdmVkIGZyb20gYSBwbGFuZS4KLSAqCi0gKiBNdXN0IGJlIGNhbGxlZCB3aXRoIHN0cnVjdF9t
dXRleCBoZWxkLgogICovCiB2b2lkCiBpbnRlbF9jbGVhbnVwX3BsYW5lX2ZiKHN0cnVjdCBkcm1f
cGxhbmUgKnBsYW5lLApAQCAtMTQ0NjIsOSArMTQ0NDMsNyBAQCBpbnRlbF9jbGVhbnVwX3BsYW5l
X2ZiKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCX0KIAogCS8qIFNob3VsZCBvbmx5IGJlIGNh
bGxlZCBhZnRlciBhIHN1Y2Nlc3NmdWwgaW50ZWxfcHJlcGFyZV9wbGFuZV9mYigpISAqLwotCW11
dGV4X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIAlpbnRlbF9wbGFuZV91bnBp
bl9mYih0b19pbnRlbF9wbGFuZV9zdGF0ZShvbGRfc3RhdGUpKTsKLQltdXRleF91bmxvY2soJmRl
dl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKIH0KIAogaW50CkBAIC0xNDY2NCw3ICsxNDY0Myw2
IEBAIGludGVsX2xlZ2FjeV9jdXJzb3JfdXBkYXRlKHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAog
CQkJICAgdTMyIHNyY193LCB1MzIgc3JjX2gsCiAJCQkgICBzdHJ1Y3QgZHJtX21vZGVzZXRfYWNx
dWlyZV9jdHggKmN0eCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGNydGMtPmRldik7CiAJc3RydWN0IGRybV9wbGFuZV9zdGF0ZSAqb2xkX3BsYW5lX3N0
YXRlLCAqbmV3X3BsYW5lX3N0YXRlOwogCXN0cnVjdCBpbnRlbF9wbGFuZSAqaW50ZWxfcGxhbmUg
PSB0b19pbnRlbF9wbGFuZShwbGFuZSk7CiAJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUgPQpAQCAtMTQ3MzAsMTMgKzE0NzA4LDkgQEAgaW50ZWxfbGVnYWN5X2N1cnNvcl91cGRh
dGUoc3RydWN0IGRybV9wbGFuZSAqcGxhbmUsCiAJaWYgKHJldCkKIAkJZ290byBvdXRfZnJlZTsK
IAotCXJldCA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmZGV2X3ByaXYtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwotCWlmIChyZXQpCi0JCWdvdG8gb3V0X2ZyZWU7Ci0KIAlyZXQgPSBpbnRlbF9wbGFu
ZV9waW5fZmIodG9faW50ZWxfcGxhbmVfc3RhdGUobmV3X3BsYW5lX3N0YXRlKSk7CiAJaWYgKHJl
dCkKLQkJZ290byBvdXRfdW5sb2NrOworCQlnb3RvIG91dF9mcmVlOwogCiAJaW50ZWxfZnJvbnRi
dWZmZXJfZmx1c2godG9faW50ZWxfZnJvbnRidWZmZXIoZmIpLCBPUklHSU5fRkxJUCk7CiAJaW50
ZWxfZnJvbnRidWZmZXJfdHJhY2sodG9faW50ZWxfZnJvbnRidWZmZXIob2xkX3BsYW5lX3N0YXRl
LT5mYiksCkBAIC0xNDc2Niw4ICsxNDc0MCw2IEBAIGludGVsX2xlZ2FjeV9jdXJzb3JfdXBkYXRl
KHN0cnVjdCBkcm1fcGxhbmUgKnBsYW5lLAogCiAJaW50ZWxfcGxhbmVfdW5waW5fZmIodG9faW50
ZWxfcGxhbmVfc3RhdGUob2xkX3BsYW5lX3N0YXRlKSk7CiAKLW91dF91bmxvY2s6Ci0JbXV0ZXhf
dW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiBvdXRfZnJlZToKIAlpZiAobmV3
X2NydGNfc3RhdGUpCiAJCWludGVsX2NydGNfZGVzdHJveV9zdGF0ZShjcnRjLCAmbmV3X2NydGNf
c3RhdGUtPmJhc2UpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9mYmRldi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9mYmRldi5j
CmluZGV4IGQ1OWVlZTVjNWQ5Yy4uYTNkZWEzZjJkYWNkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiZGV2LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9mYmRldi5jCkBAIC0yMDQsNyArMjA0LDYgQEAgc3RhdGljIGludCBp
bnRlbGZiX2NyZWF0ZShzdHJ1Y3QgZHJtX2ZiX2hlbHBlciAqaGVscGVyLAogCQlzaXplcy0+ZmJf
aGVpZ2h0ID0gaW50ZWxfZmItPmJhc2UuaGVpZ2h0OwogCX0KIAotCW11dGV4X2xvY2soJmRldi0+
c3RydWN0X211dGV4KTsKIAl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmRldl9wcml2
LT5ydW50aW1lX3BtKTsKIAogCS8qIFBpbiB0aGUgR0dUVCB2bWEgZm9yIG91ciBhY2Nlc3Mgdmlh
IGluZm8tPnNjcmVlbl9iYXNlLgpAQCAtMjY2LDcgKzI2NSw2IEBAIHN0YXRpYyBpbnQgaW50ZWxm
Yl9jcmVhdGUoc3RydWN0IGRybV9mYl9oZWxwZXIgKmhlbHBlciwKIAlpZmJkZXYtPnZtYV9mbGFn
cyA9IGZsYWdzOwogCiAJaW50ZWxfcnVudGltZV9wbV9wdXQoJmRldl9wcml2LT5ydW50aW1lX3Bt
LCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKIAl2Z2Ffc3dp
dGNoZXJvb19jbGllbnRfZmJfc2V0KHBkZXYsIGluZm8pOwogCXJldHVybiAwOwogCkBAIC0yNzQs
NyArMjcyLDYgQEAgc3RhdGljIGludCBpbnRlbGZiX2NyZWF0ZShzdHJ1Y3QgZHJtX2ZiX2hlbHBl
ciAqaGVscGVyLAogCWludGVsX3VucGluX2ZiX3ZtYSh2bWEsIGZsYWdzKTsKIG91dF91bmxvY2s6
CiAJaW50ZWxfcnVudGltZV9wbV9wdXQoJmRldl9wcml2LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsK
LQltdXRleF91bmxvY2soJmRldi0+c3RydWN0X211dGV4KTsKIAlyZXR1cm4gcmV0OwogfQogCkBA
IC0yOTEsMTEgKzI4OCw4IEBAIHN0YXRpYyB2b2lkIGludGVsX2ZiZGV2X2Rlc3Ryb3koc3RydWN0
IGludGVsX2ZiZGV2ICppZmJkZXYpCiAKIAlkcm1fZmJfaGVscGVyX2ZpbmkoJmlmYmRldi0+aGVs
cGVyKTsKIAotCWlmIChpZmJkZXYtPnZtYSkgewotCQltdXRleF9sb2NrKCZpZmJkZXYtPmhlbHBl
ci5kZXYtPnN0cnVjdF9tdXRleCk7CisJaWYgKGlmYmRldi0+dm1hKQogCQlpbnRlbF91bnBpbl9m
Yl92bWEoaWZiZGV2LT52bWEsIGlmYmRldi0+dm1hX2ZsYWdzKTsKLQkJbXV0ZXhfdW5sb2NrKCZp
ZmJkZXYtPmhlbHBlci5kZXYtPnN0cnVjdF9tdXRleCk7Ci0JfQogCiAJaWYgKGlmYmRldi0+ZmIp
CiAJCWRybV9mcmFtZWJ1ZmZlcl9yZW1vdmUoJmlmYmRldi0+ZmItPmJhc2UpOwpkaWZmIC0tZ2l0
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXkuYwppbmRleCAyOWVkZmMzNDM3MTYu
LjRmMzY1NTdiM2YzYiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9vdmVybGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9v
dmVybGF5LmMKQEAgLTEzMDMsMTUgKzEzMDMsMTEgQEAgc3RhdGljIGludCBnZXRfcmVnaXN0ZXJz
KHN0cnVjdCBpbnRlbF9vdmVybGF5ICpvdmVybGF5LCBib29sIHVzZV9waHlzKQogCXN0cnVjdCBp
OTE1X3ZtYSAqdm1hOwogCWludCBlcnI7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLQogCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfc3RvbGVuKGk5MTUsIFBB
R0VfU0laRSk7CiAJaWYgKG9iaiA9PSBOVUxMKQogCQlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3Jl
YXRlX2ludGVybmFsKGk5MTUsIFBBR0VfU0laRSk7Ci0JaWYgKElTX0VSUihvYmopKSB7Ci0JCWVy
ciA9IFBUUl9FUlIob2JqKTsKLQkJZ290byBlcnJfdW5sb2NrOwotCX0KKwlpZiAoSVNfRVJSKG9i
aikpCisJCXJldHVybiBQVFJfRVJSKG9iaik7CiAKIAl2bWEgPSBpOTE1X2dlbV9vYmplY3RfZ2d0
dF9waW4ob2JqLCBOVUxMLCAwLCAwLCBQSU5fTUFQUEFCTEUpOwogCWlmIChJU19FUlIodm1hKSkg
ewpAQCAtMTMzMiwxMyArMTMyOCwxMCBAQCBzdGF0aWMgaW50IGdldF9yZWdpc3RlcnMoc3RydWN0
IGludGVsX292ZXJsYXkgKm92ZXJsYXksIGJvb2wgdXNlX3BoeXMpCiAJfQogCiAJb3ZlcmxheS0+
cmVnX2JvID0gb2JqOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJ
cmV0dXJuIDA7CiAKIGVycl9wdXRfYm86CiAJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwotZXJy
X3VubG9jazoKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVy
biBlcnI7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5j
CmluZGV4IGQ3YzE3YThkYWRmZi4uMjBlZTg5ZTEyMGIzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKQEAgLTMxMyw4ICszMTMsNiBAQCBzdGF0aWMgdm9p
ZCBpOTE1X2dlbV9jb250ZXh0X2ZyZWUoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIAlH
RU1fQlVHX09OKCFpOTE1X2dlbV9jb250ZXh0X2lzX2Nsb3NlZChjdHgpKTsKIAogCXJlbGVhc2Vf
aHdfaWQoY3R4KTsKLQlpZiAoY3R4LT52bSkKLQkJaTkxNV92bV9wdXQoY3R4LT52bSk7CiAKIAlm
cmVlX2VuZ2luZXMocmN1X2FjY2Vzc19wb2ludGVyKGN0eC0+ZW5naW5lcykpOwogCW11dGV4X2Rl
c3Ryb3koJmN0eC0+ZW5naW5lc19tdXRleCk7CkBAIC0zNzksOSArMzc3LDEzIEBAIHZvaWQgaTkx
NV9nZW1fY29udGV4dF9yZWxlYXNlKHN0cnVjdCBrcmVmICpyZWYpCiAKIHN0YXRpYyB2b2lkIGNv
bnRleHRfY2xvc2Uoc3RydWN0IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCkKIHsKKwlpOTE1X2dlbV9j
b250ZXh0X3NldF9jbG9zZWQoY3R4KTsKKworCWlmIChjdHgtPnZtKQorCQlpOTE1X3ZtX2Nsb3Nl
KGN0eC0+dm0pOworCiAJbXV0ZXhfbG9jaygmY3R4LT5tdXRleCk7CiAKLQlpOTE1X2dlbV9jb250
ZXh0X3NldF9jbG9zZWQoY3R4KTsKIAljdHgtPmZpbGVfcHJpdiA9IEVSUl9QVFIoLUVCQURGKTsK
IAogCS8qCkBAIC00NzUsNyArNDc3LDcgQEAgX19zZXRfcHBndHQoc3RydWN0IGk5MTVfZ2VtX2Nv
bnRleHQgKmN0eCwgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiAKIAlHRU1fQlVHX09O
KG9sZCAmJiBpOTE1X3ZtX2lzXzRsdmwodm0pICE9IGk5MTVfdm1faXNfNGx2bChvbGQpKTsKIAot
CWN0eC0+dm0gPSBpOTE1X3ZtX2dldCh2bSk7CisJY3R4LT52bSA9IGk5MTVfdm1fb3Blbih2bSk7
CiAJY29udGV4dF9hcHBseV9hbGwoY3R4LCBfX2FwcGx5X3BwZ3R0LCB2bSk7CiAKIAlyZXR1cm4g
b2xkOwpAQCAtNDg5LDcgKzQ5MSw3IEBAIHN0YXRpYyB2b2lkIF9fYXNzaWduX3BwZ3R0KHN0cnVj
dCBpOTE1X2dlbV9jb250ZXh0ICpjdHgsCiAKIAl2bSA9IF9fc2V0X3BwZ3R0KGN0eCwgdm0pOwog
CWlmICh2bSkKLQkJaTkxNV92bV9wdXQodm0pOworCQlpOTE1X3ZtX2Nsb3NlKHZtKTsKIH0KIAog
c3RhdGljIHZvaWQgX19zZXRfdGltZWxpbmUoc3RydWN0IGludGVsX3RpbWVsaW5lICoqZHN0LApA
QCAtOTU0LDcgKzk1Niw3IEBAIHN0YXRpYyBpbnQgZ2V0X3BwZ3R0KHN0cnVjdCBkcm1faTkxNV9m
aWxlX3ByaXZhdGUgKmZpbGVfcHJpdiwKIAlpZiAocmV0IDwgMCkKIAkJZ290byBlcnJfdW5sb2Nr
OwogCi0JaTkxNV92bV9nZXQodm0pOworCWk5MTVfdm1fb3Blbih2bSk7CiAKIAlhcmdzLT5zaXpl
ID0gMDsKIAlhcmdzLT52YWx1ZSA9IHJldDsKQEAgLTk3NCw3ICs5NzYsNyBAQCBzdGF0aWMgdm9p
ZCBzZXRfcHBndHRfYmFycmllcih2b2lkICpkYXRhKQogCWlmIChJTlRFTF9HRU4ob2xkLT5pOTE1
KSA8IDgpCiAJCWdlbjZfcHBndHRfdW5waW5fYWxsKGk5MTVfdm1fdG9fcHBndHQob2xkKSk7CiAK
LQlpOTE1X3ZtX3B1dChvbGQpOworCWk5MTVfdm1fY2xvc2Uob2xkKTsKIH0KIAogc3RhdGljIGlu
dCBlbWl0X3BwZ3R0X3VwZGF0ZShzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgdm9pZCAqZGF0YSkK
QEAgLTEwOTQsOCArMTA5Niw4IEBAIHN0YXRpYyBpbnQgc2V0X3BwZ3R0KHN0cnVjdCBkcm1faTkx
NV9maWxlX3ByaXZhdGUgKmZpbGVfcHJpdiwKIAkJCQkgICBzZXRfcHBndHRfYmFycmllciwKIAkJ
CQkgICBvbGQpOwogCWlmIChlcnIpIHsKLQkJaTkxNV92bV9wdXQoX19zZXRfcHBndHQoY3R4LCBv
bGQpKTsKLQkJaTkxNV92bV9wdXQob2xkKTsKKwkJaTkxNV92bV9jbG9zZShfX3NldF9wcGd0dChj
dHgsIG9sZCkpOworCQlpOTE1X3ZtX2Nsb3NlKG9sZCk7CiAJfQogCiB1bmxvY2s6CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMKaW5kZXggZjBjNDM3YjZlOTk1Li40
NmEyMzQwOWUxYzAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9kb21haW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWlu
LmMKQEAgLTIwMiw3ICsyMDIsMTEgQEAgaW50IGk5MTVfZ2VtX29iamVjdF9zZXRfY2FjaGVfbGV2
ZWwoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJICAgIGk5MTVfZ2VtX3ZhbGlk
X2d0dF9zcGFjZSh2bWEsIGNhY2hlX2xldmVsKSkKIAkJCWNvbnRpbnVlOwogCi0JCXJldCA9IGk5
MTVfdm1hX3VuYmluZCh2bWEpOworCQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJnZt
YS0+dm0tPm11dGV4KTsKKwkJaWYgKCFyZXQpIHsKKwkJCXJldCA9IGk5MTVfdm1hX3VuYmluZCh2
bWEpOworCQkJbXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CisJCX0KIAkJaWYgKHJldCkK
IAkJCXJldHVybiByZXQ7CiAKQEAgLTI4OCw3ICsyOTIsMTIgQEAgaW50IGk5MTVfZ2VtX29iamVj
dF9zZXRfY2FjaGVfbGV2ZWwoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJCWlm
ICghZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKQogCQkJCWNvbnRpbnVlOwogCi0J
CQlyZXQgPSBpOTE1X3ZtYV9iaW5kKHZtYSwgY2FjaGVfbGV2ZWwsIFBJTl9VUERBVEUpOworCQkJ
LyogV2FpdCBmb3IgYW4gZWFybGllciBhc3luYyBiaW5kICovCisJCQlyZXQgPSBpOTE1X2FjdGl2
ZV93YWl0KCZ2bWEtPmFjdGl2ZSk7CisJCQlpZiAocmV0KQorCQkJCXJldHVybiByZXQ7CisKKwkJ
CXJldCA9IGk5MTVfdm1hX2JpbmQodm1hLCBjYWNoZV9sZXZlbCwgUElOX1VQREFURSwgTlVMTCk7
CiAJCQlpZiAocmV0KQogCQkJCXJldHVybiByZXQ7CiAJCX0KQEAgLTM4OSwxNiArMzk4LDExIEBA
IGludCBpOTE1X2dlbV9zZXRfY2FjaGluZ19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2
b2lkICpkYXRhLAogCWlmIChyZXQpCiAJCWdvdG8gb3V0OwogCi0JcmV0ID0gbXV0ZXhfbG9ja19p
bnRlcnJ1cHRpYmxlKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAocmV0KQotCQlnb3Rv
IG91dDsKLQogCXJldCA9IGk5MTVfZ2VtX29iamVjdF9sb2NrX2ludGVycnVwdGlibGUob2JqKTsK
IAlpZiAocmV0ID09IDApIHsKIAkJcmV0ID0gaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNoZV9sZXZl
bChvYmosIGxldmVsKTsKIAkJaTkxNV9nZW1fb2JqZWN0X3VubG9jayhvYmopOwogCX0KLQltdXRl
eF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiBvdXQ6CiAJaTkxNV9nZW1fb2Jq
ZWN0X3B1dChvYmopOwpAQCAtNDgzLDYgKzQ4Nyw3IEBAIHN0YXRpYyB2b2lkIGk5MTVfZ2VtX29i
amVjdF9idW1wX2luYWN0aXZlX2dndHQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikK
IAkJaWYgKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpCiAJCQljb250aW51ZTsK
IAorCQlHRU1fQlVHX09OKHZtYS0+dm0gIT0gJmk5MTUtPmdndHQudm0pOwogCQlsaXN0X21vdmVf
dGFpbCgmdm1hLT52bV9saW5rLCAmdm1hLT52bS0+Ym91bmRfbGlzdCk7CiAJfQogCW11dGV4X3Vu
bG9jaygmaTkxNS0+Z2d0dC52bS5tdXRleCk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX2V4ZWNidWZmZXIuYwppbmRleCA0OTNmMDc4MDZiMDguLjA2OGM3OTc2ZDdlOSAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2V4ZWNidWZmZXIu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZXhlY2J1ZmZlci5jCkBA
IC01NDksOCArNTQ5LDExIEBAIGViX2FkZF92bWEoc3RydWN0IGk5MTVfZXhlY2J1ZmZlciAqZWIs
CiAJCWViX3VucmVzZXJ2ZV92bWEodm1hLCB2bWEtPmV4ZWNfZmxhZ3MpOwogCiAJCWxpc3RfYWRk
X3RhaWwoJnZtYS0+ZXhlY19saW5rLCAmZWItPnVuYm91bmQpOwotCQlpZiAoZHJtX21tX25vZGVf
YWxsb2NhdGVkKCZ2bWEtPm5vZGUpKQorCQlpZiAoZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEt
Pm5vZGUpKSB7CisJCQltdXRleF9sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CiAJCQllcnIgPSBpOTE1
X3ZtYV91bmJpbmQodm1hKTsKKwkJCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOworCQl9
CiAJCWlmICh1bmxpa2VseShlcnIpKQogCQkJdm1hLT5leGVjX2ZsYWdzID0gTlVMTDsKIAl9CkBA
IC02OTcsNyArNzAwLDkgQEAgc3RhdGljIGludCBlYl9yZXNlcnZlKHN0cnVjdCBpOTE1X2V4ZWNi
dWZmZXIgKmViKQogCiAJCWNhc2UgMToKIAkJCS8qIFRvbyBmcmFnbWVudGVkLCB1bmJpbmQgZXZl
cnl0aGluZyBhbmQgcmV0cnkgKi8KKwkJCW11dGV4X2xvY2soJmViLT5jb250ZXh0LT52bS0+bXV0
ZXgpOwogCQkJZXJyID0gaTkxNV9nZW1fZXZpY3Rfdm0oZWItPmNvbnRleHQtPnZtKTsKKwkJCW11
dGV4X3VubG9jaygmZWItPmNvbnRleHQtPnZtLT5tdXRleCk7CiAJCQlpZiAoZXJyKQogCQkJCXJl
dHVybiBlcnI7CiAJCQlicmVhazsKQEAgLTk2Nyw3ICs5NzIsOSBAQCBzdGF0aWMgdm9pZCByZWxv
Y19jYWNoZV9yZXNldChzdHJ1Y3QgcmVsb2NfY2FjaGUgKmNhY2hlKQogCQkJZ2d0dC0+dm0uY2xl
YXJfcmFuZ2UoJmdndHQtPnZtLAogCQkJCQkgICAgIGNhY2hlLT5ub2RlLnN0YXJ0LAogCQkJCQkg
ICAgIGNhY2hlLT5ub2RlLnNpemUpOworCQkJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwog
CQkJZHJtX21tX3JlbW92ZV9ub2RlKCZjYWNoZS0+bm9kZSk7CisJCQltdXRleF91bmxvY2soJmdn
dHQtPnZtLm11dGV4KTsKIAkJfSBlbHNlIHsKIAkJCWk5MTVfdm1hX3VucGluKChzdHJ1Y3QgaTkx
NV92bWEgKiljYWNoZS0+bm9kZS5tbSk7CiAJCX0KQEAgLTEwNDIsMTEgKzEwNDksMTMgQEAgc3Rh
dGljIHZvaWQgKnJlbG9jX2lvbWFwKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJ
CQkJCSAgICAgICBQSU5fTk9FVklDVCk7CiAJCWlmIChJU19FUlIodm1hKSkgewogCQkJbWVtc2V0
KCZjYWNoZS0+bm9kZSwgMCwgc2l6ZW9mKGNhY2hlLT5ub2RlKSk7CisJCQltdXRleF9sb2NrKCZn
Z3R0LT52bS5tdXRleCk7CiAJCQllcnIgPSBkcm1fbW1faW5zZXJ0X25vZGVfaW5fcmFuZ2UKIAkJ
CQkoJmdndHQtPnZtLm1tLCAmY2FjaGUtPm5vZGUsCiAJCQkJIFBBR0VfU0laRSwgMCwgSTkxNV9D
T0xPUl9VTkVWSUNUQUJMRSwKIAkJCQkgMCwgZ2d0dC0+bWFwcGFibGVfZW5kLAogCQkJCSBEUk1f
TU1fSU5TRVJUX0xPVyk7CisJCQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJCWlm
IChlcnIpIC8qIG5vIGluYWN0aXZlIGFwZXJ0dXJlIHNwYWNlLCB1c2UgY3B1IHJlbG9jICovCiAJ
CQkJcmV0dXJuIE5VTEw7CiAJCX0gZWxzZSB7CkBAIC0xMzg4LDcgKzEzOTcsNyBAQCBlYl9yZWxv
Y2F0ZV9lbnRyeShzdHJ1Y3QgaTkxNV9leGVjYnVmZmVyICplYiwKIAkJaWYgKHJlbG9jLT53cml0
ZV9kb21haW4gPT0gSTkxNV9HRU1fRE9NQUlOX0lOU1RSVUNUSU9OICYmCiAJCSAgICBJU19HRU4o
ZWItPmk5MTUsIDYpKSB7CiAJCQllcnIgPSBpOTE1X3ZtYV9iaW5kKHRhcmdldCwgdGFyZ2V0LT5v
YmotPmNhY2hlX2xldmVsLAotCQkJCQkgICAgUElOX0dMT0JBTCk7CisJCQkJCSAgICBQSU5fR0xP
QkFMLCBOVUxMKTsKIAkJCWlmIChXQVJOX09OQ0UoZXJyLAogCQkJCSAgICAgICJVbmV4cGVjdGVk
IGZhaWx1cmUgdG8gYmluZCB0YXJnZXQgVk1BISIpKQogCQkJCXJldHVybiBlcnI7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fbW1hbi5jIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYwppbmRleCA1OTU1MzlhMDllMzguLjA0NDBk
YmZkYTI5NSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21t
YW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fbW1hbi5jCkBAIC0y
NTEsMTYgKzI1MSw2IEBAIHZtX2ZhdWx0X3QgaTkxNV9nZW1fZmF1bHQoc3RydWN0IHZtX2ZhdWx0
ICp2bWYpCiAJCWdvdG8gZXJyX3JwbTsKIAl9CiAKLQlyZXQgPSBpOTE1X211dGV4X2xvY2tfaW50
ZXJydXB0aWJsZShkZXYpOwotCWlmIChyZXQpCi0JCWdvdG8gZXJyX3Jlc2V0OwotCi0JLyogQWNj
ZXNzIHRvIHNub29wYWJsZSBwYWdlcyB0aHJvdWdoIHRoZSBHVFQgaXMgaW5jb2hlcmVudC4gKi8K
LQlpZiAob2JqLT5jYWNoZV9sZXZlbCAhPSBJOTE1X0NBQ0hFX05PTkUgJiYgIUhBU19MTEMoaTkx
NSkpIHsKLQkJcmV0ID0gLUVGQVVMVDsKLQkJZ290byBlcnJfdW5sb2NrOwotCX0KLQogCS8qIE5v
dyBwaW4gaXQgaW50byB0aGUgR1RUIGFzIG5lZWRlZCAqLwogCXZtYSA9IGk5MTVfZ2VtX29iamVj
dF9nZ3R0X3BpbihvYmosIE5VTEwsIDAsIDAsCiAJCQkJICAgICAgIFBJTl9NQVBQQUJMRSB8CkBA
IC0yOTAsNyArMjgwLDEzIEBAIHZtX2ZhdWx0X3QgaTkxNV9nZW1fZmF1bHQoc3RydWN0IHZtX2Zh
dWx0ICp2bWYpCiAJfQogCWlmIChJU19FUlIodm1hKSkgewogCQlyZXQgPSBQVFJfRVJSKHZtYSk7
Ci0JCWdvdG8gZXJyX3VubG9jazsKKwkJZ290byBlcnJfcmVzZXQ7CisJfQorCisJLyogQWNjZXNz
IHRvIHNub29wYWJsZSBwYWdlcyB0aHJvdWdoIHRoZSBHVFQgaXMgaW5jb2hlcmVudC4gKi8KKwlp
ZiAob2JqLT5jYWNoZV9sZXZlbCAhPSBJOTE1X0NBQ0hFX05PTkUgJiYgIUhBU19MTEMoaTkxNSkp
IHsKKwkJcmV0ID0gLUVGQVVMVDsKKwkJZ290byBlcnJfdW5waW47CiAJfQogCiAJcmV0ID0gaTkx
NV92bWFfcGluX2ZlbmNlKHZtYSk7CkBAIC0zMTksMTMgKzMxNSwxMCBAQCB2bV9mYXVsdF90IGk5
MTVfZ2VtX2ZhdWx0KHN0cnVjdCB2bV9mYXVsdCAqdm1mKQogCQkJCSAgIG1zZWNzX3RvX2ppZmZp
ZXNfdGltZW91dChDT05GSUdfRFJNX0k5MTVfVVNFUkZBVUxUX0FVVE9TVVNQRU5EKSk7CiAKIAlp
OTE1X3ZtYV9zZXRfZ2d0dF93cml0ZSh2bWEpOwotCiBlcnJfZmVuY2U6CiAJaTkxNV92bWFfdW5w
aW5fZmVuY2Uodm1hKTsKIGVycl91bnBpbjoKIAlfX2k5MTVfdm1hX3VucGluKHZtYSk7Ci1lcnJf
dW5sb2NrOgotCW11dGV4X3VubG9jaygmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwogZXJyX3Jlc2V0Ogog
CWludGVsX2d0X3Jlc2V0X3VubG9jayhnZ3R0LT52bS5ndCwgc3JjdSk7CiBlcnJfcnBtOgpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jCmluZGV4IDBlZjYwZGFlMjNh
Ny4uZGJmOWJlOWE3OWY0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fb2JqZWN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29i
amVjdC5jCkBAIC0xNTUsMjEgKzE1NSwzMCBAQCBzdGF0aWMgdm9pZCBfX2k5MTVfZ2VtX2ZyZWVf
b2JqZWN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAogCXdha2VyZWYgPSBpbnRl
bF9ydW50aW1lX3BtX2dldCgmaTkxNS0+cnVudGltZV9wbSk7CiAJbGxpc3RfZm9yX2VhY2hfZW50
cnlfc2FmZShvYmosIG9uLCBmcmVlZCwgZnJlZWQpIHsKLQkJc3RydWN0IGk5MTVfdm1hICp2bWEs
ICp2bjsKLQogCQl0cmFjZV9pOTE1X2dlbV9vYmplY3RfZGVzdHJveShvYmopOwogCi0JCW11dGV4
X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCi0JCWxpc3RfZm9yX2VhY2hfZW50cnlf
c2FmZSh2bWEsIHZuLCAmb2JqLT52bWEubGlzdCwgb2JqX2xpbmspIHsKLQkJCUdFTV9CVUdfT04o
aTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpOwotCQkJYXRvbWljX2FuZCh+STkxNV9WTUFfUElOX01B
U0ssICZ2bWEtPmZsYWdzKTsKLQkJCWk5MTVfdm1hX2Rlc3Ryb3kodm1hKTsKKwkJaWYgKCFsaXN0
X2VtcHR5KCZvYmotPnZtYS5saXN0KSkgeworCQkJc3RydWN0IGk5MTVfdm1hICp2bWE7CisKKwkJ
CS8qCisJCQkgKiBOb3RlIHRoYXQgdGhlIHZtYSBrZWVwcyBhbiBvYmplY3QgcmVmZXJlbmNlIHdo
aWxlCisJCQkgKiBpdCBpcyBhY3RpdmUsIHNvIGl0ICpzaG91bGQqIG5vdCBzbGVlcCB3aGlsZSB3
ZQorCQkJICogZGVzdHJveSBpdC4gT3VyIGRlYnVnIGNvZGUgZXJycyBpbnNpdHMgaXQgKm1pZ2h0
Ki4KKwkJCSAqIEZvciB0aGUgbW9tZW50LCBwbGF5IGFsb25nLgorCQkJICovCisJCQlzcGluX2xv
Y2soJm9iai0+dm1hLmxvY2spOworCQkJd2hpbGUgKCh2bWEgPSBsaXN0X2ZpcnN0X2VudHJ5X29y
X251bGwoJm9iai0+dm1hLmxpc3QsCisJCQkJCQkJICAgICAgIHN0cnVjdCBpOTE1X3ZtYSwKKwkJ
CQkJCQkgICAgICAgb2JqX2xpbmspKSkgeworCQkJCUdFTV9CVUdfT04odm1hLT5vYmogIT0gb2Jq
KTsKKwkJCQlzcGluX3VubG9jaygmb2JqLT52bWEubG9jayk7CisKKwkJCQlpOTE1X3ZtYV9kZXN0
cm95KHZtYSk7CisKKwkJCQlzcGluX2xvY2soJm9iai0+dm1hLmxvY2spOworCQkJfQorCQkJc3Bp
bl91bmxvY2soJm9iai0+dm1hLmxvY2spOwogCQl9Ci0JCUdFTV9CVUdfT04oIWxpc3RfZW1wdHko
Jm9iai0+dm1hLmxpc3QpKTsKLQkJR0VNX0JVR19PTighUkJfRU1QVFlfUk9PVCgmb2JqLT52bWEu
dHJlZSkpOwotCi0JCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAkJ
R0VNX0JVR19PTihhdG9taWNfcmVhZCgmb2JqLT5iaW5kX2NvdW50KSk7CiAJCUdFTV9CVUdfT04o
b2JqLT51c2VyZmF1bHRfY291bnQpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX29iamVjdC5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X29iamVjdC5oCmluZGV4IDI5YjllZGRjNGM3Zi4uYTc4YWYyNWRjZTM2IDEwMDY0NAotLS0gYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmgKKysrIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oCkBAIC0xMDYsNiArMTA2LDExIEBAIHN0
YXRpYyBpbmxpbmUgdm9pZCBpOTE1X2dlbV9vYmplY3RfbG9jayhzdHJ1Y3QgZHJtX2k5MTVfZ2Vt
X29iamVjdCAqb2JqKQogCWRtYV9yZXN2X2xvY2sob2JqLT5iYXNlLnJlc3YsIE5VTEwpOwogfQog
CitzdGF0aWMgaW5saW5lIGJvb2wgaTkxNV9nZW1fb2JqZWN0X3RyeWxvY2soc3RydWN0IGRybV9p
OTE1X2dlbV9vYmplY3QgKm9iaikKK3sKKwlyZXR1cm4gZG1hX3Jlc3ZfdHJ5bG9jayhvYmotPmJh
c2UucmVzdik7Cit9CisKIHN0YXRpYyBpbmxpbmUgaW50CiBpOTE1X2dlbV9vYmplY3RfbG9ja19p
bnRlcnJ1cHRpYmxlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiB7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zaHJpbmtlci5jCmluZGV4IGQyYzA1ZDc1Mjkw
OS4uNDQ3ZWUyYjFlMjIyIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkx
NV9nZW1fc2hyaW5rZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
c2hyaW5rZXIuYwpAQCAtMTYsNDAgKzE2LDYgQEAKIAogI2luY2x1ZGUgImk5MTVfdHJhY2UuaCIK
IAotc3RhdGljIGJvb2wgc2hyaW5rZXJfbG9jayhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKLQkJCSAgdW5zaWduZWQgaW50IGZsYWdzLAotCQkJICBib29sICp1bmxvY2spCi17Ci0Jc3Ry
dWN0IG11dGV4ICptID0gJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXg7Ci0KLQlzd2l0Y2ggKG11dGV4
X3RyeWxvY2tfcmVjdXJzaXZlKG0pKSB7Ci0JY2FzZSBNVVRFWF9UUllMT0NLX1JFQ1VSU0lWRToK
LQkJKnVubG9jayA9IGZhbHNlOwotCQlyZXR1cm4gdHJ1ZTsKLQotCWNhc2UgTVVURVhfVFJZTE9D
S19GQUlMRUQ6Ci0JCSp1bmxvY2sgPSBmYWxzZTsKLQkJaWYgKGZsYWdzICYgSTkxNV9TSFJJTktf
QUNUSVZFICYmCi0JCSAgICBtdXRleF9sb2NrX2tpbGxhYmxlX25lc3RlZChtLCBJOTE1X01NX1NI
UklOS0VSKSA9PSAwKQotCQkJKnVubG9jayA9IHRydWU7Ci0JCXJldHVybiAqdW5sb2NrOwotCi0J
Y2FzZSBNVVRFWF9UUllMT0NLX1NVQ0NFU1M6Ci0JCSp1bmxvY2sgPSB0cnVlOwotCQlyZXR1cm4g
dHJ1ZTsKLQl9Ci0KLQlCVUcoKTsKLX0KLQotc3RhdGljIHZvaWQgc2hyaW5rZXJfdW5sb2NrKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBib29sIHVubG9jaykKLXsKLQlpZiAoIXVubG9j
aykKLQkJcmV0dXJuOwotCi0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
LX0KLQogc3RhdGljIGJvb2wgc3dhcF9hdmFpbGFibGUodm9pZCkKIHsKIAlyZXR1cm4gZ2V0X25y
X3N3YXBfcGFnZXMoKSA+IDA7CkBAIC0xNTUsMTAgKzEyMSw2IEBAIGk5MTVfZ2VtX3Nocmluayhz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZiA9
IDA7CiAJdW5zaWduZWQgbG9uZyBjb3VudCA9IDA7CiAJdW5zaWduZWQgbG9uZyBzY2FubmVkID0g
MDsKLQlib29sIHVubG9jazsKLQotCWlmICghc2hyaW5rZXJfbG9jayhpOTE1LCBzaHJpbmssICZ1
bmxvY2spKQotCQlyZXR1cm4gMDsKIAogCS8qCiAJICogV2hlbiBzaHJpbmtpbmcgdGhlIGFjdGl2
ZSBsaXN0LCB3ZSBzaG91bGQgYWxzbyBjb25zaWRlciBhY3RpdmUKQEAgLTI2OCw4ICsyMzAsNiBA
QCBpOTE1X2dlbV9zaHJpbmsoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJaWYgKHNo
cmluayAmIEk5MTVfU0hSSU5LX0JPVU5EKQogCQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+
cnVudGltZV9wbSwgd2FrZXJlZik7CiAKLQlzaHJpbmtlcl91bmxvY2soaTkxNSwgdW5sb2NrKTsK
LQogCWlmIChucl9zY2FubmVkKQogCQkqbnJfc2Nhbm5lZCArPSBzY2FubmVkOwogCXJldHVybiBj
b3VudDsKQEAgLTMzOSwxMyArMjk5LDkgQEAgaTkxNV9nZW1fc2hyaW5rZXJfc2NhbihzdHJ1Y3Qg
c2hyaW5rZXIgKnNocmlua2VyLCBzdHJ1Y3Qgc2hyaW5rX2NvbnRyb2wgKnNjKQogCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0KIAkJY29udGFpbmVyX29mKHNocmlua2VyLCBzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSwgbW0uc2hyaW5rZXIpOwogCXVuc2lnbmVkIGxvbmcgZnJlZWQ7Ci0J
Ym9vbCB1bmxvY2s7CiAKIAlzYy0+bnJfc2Nhbm5lZCA9IDA7CiAKLQlpZiAoIXNocmlua2VyX2xv
Y2soaTkxNSwgMCwgJnVubG9jaykpCi0JCXJldHVybiBTSFJJTktfU1RPUDsKLQogCWZyZWVkID0g
aTkxNV9nZW1fc2hyaW5rKGk5MTUsCiAJCQkJc2MtPm5yX3RvX3NjYW4sCiAJCQkJJnNjLT5ucl9z
Y2FubmVkLApAQCAtMzY2LDggKzMyMiw2IEBAIGk5MTVfZ2VtX3Nocmlua2VyX3NjYW4oc3RydWN0
IHNocmlua2VyICpzaHJpbmtlciwgc3RydWN0IHNocmlua19jb250cm9sICpzYykKIAkJfQogCX0K
IAotCXNocmlua2VyX3VubG9jayhpOTE1LCB1bmxvY2spOwotCiAJcmV0dXJuIHNjLT5ucl9zY2Fu
bmVkID8gZnJlZWQgOiBTSFJJTktfU1RPUDsKIH0KIApAQCAtNDE5LDEwICszNzMsNiBAQCBpOTE1
X2dlbV9zaHJpbmtlcl92bWFwKHN0cnVjdCBub3RpZmllcl9ibG9jayAqbmIsIHVuc2lnbmVkIGxv
bmcgZXZlbnQsIHZvaWQgKnB0cgogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hLCAqbmV4dDsKIAl1bnNp
Z25lZCBsb25nIGZyZWVkX3BhZ2VzID0gMDsKIAlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKLQli
b29sIHVubG9jazsKLQotCWlmICghc2hyaW5rZXJfbG9jayhpOTE1LCAwLCAmdW5sb2NrKSkKLQkJ
cmV0dXJuIE5PVElGWV9ET05FOwogCiAJd2l0aF9pbnRlbF9ydW50aW1lX3BtKCZpOTE1LT5ydW50
aW1lX3BtLCB3YWtlcmVmKQogCQlmcmVlZF9wYWdlcyArPSBpOTE1X2dlbV9zaHJpbmsoaTkxNSwg
LTFVTCwgTlVMTCwKQEAgLTQzOSwxNSArMzg5LDExIEBAIGk5MTVfZ2VtX3Nocmlua2VyX3ZtYXAo
c3RydWN0IG5vdGlmaWVyX2Jsb2NrICpuYiwgdW5zaWduZWQgbG9uZyBldmVudCwgdm9pZCAqcHRy
CiAJCWlmICghdm1hLT5pb21hcCB8fCBpOTE1X3ZtYV9pc19hY3RpdmUodm1hKSkKIAkJCWNvbnRp
bnVlOwogCi0JCW11dGV4X3VubG9jaygmaTkxNS0+Z2d0dC52bS5tdXRleCk7CiAJCWlmIChpOTE1
X3ZtYV91bmJpbmQodm1hKSA9PSAwKQogCQkJZnJlZWRfcGFnZXMgKz0gY291bnQ7Ci0JCW11dGV4
X2xvY2soJmk5MTUtPmdndHQudm0ubXV0ZXgpOwogCX0KIAltdXRleF91bmxvY2soJmk5MTUtPmdn
dHQudm0ubXV0ZXgpOwogCi0Jc2hyaW5rZXJfdW5sb2NrKGk5MTUsIHVubG9jayk7Ci0KIAkqKHVu
c2lnbmVkIGxvbmcgKilwdHIgKz0gZnJlZWRfcGFnZXM7CiAJcmV0dXJuIE5PVElGWV9ET05FOwog
fQpAQCAtNDkwLDIyICs0MzYsOSBAQCB2b2lkIGk5MTVfZ2VtX3Nocmlua2VyX3RhaW50c19tdXRl
eChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAogCWZzX3JlY2xhaW1fYWNxdWlyZShH
RlBfS0VSTkVMKTsKIAotCS8qCi0JICogQXMgd2UgaW52YXJpYWJseSByZWx5IG9uIHRoZSBzdHJ1
Y3RfbXV0ZXggd2l0aGluIHRoZSBzaHJpbmtlciwKLQkgKiBidXQgaGF2ZSBhIGNvbXBsaWNhdGVk
IHJlY3Vyc2lvbiBkYW5jZSwgdGFpbnQgYWxsIHRoZSBtdXRleGVzIHVzZWQKLQkgKiB3aXRoaW4g
dGhlIHNocmlua2VyIHdpdGggdGhlIHN0cnVjdF9tdXRleC4gRm9yIGNvbXBsZXRlbmVzcywgd2UK
LQkgKiB0YWludCB3aXRoIGFsbCBzdWJjbGFzcyBvZiBzdHJ1Y3RfbXV0ZXgsIGV2ZW4gdGhvdWdo
IHdlIHNob3VsZAotCSAqIG9ubHkgbmVlZCB0YWludGluZyBieSBJOTE1X01NX05PUk1BTCB0byBj
YXRjaCBwb3NzaWJsZSBBQkJBCi0JICogZGVhZGxvY2tzIGZyb20gdXNpbmcgc3RydWN0X211dGV4
IGluc2lkZSBAbXV0ZXguCi0JICovCi0JbXV0ZXhfYWNxdWlyZSgmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleC5kZXBfbWFwLAotCQkgICAgICBJOTE1X01NX1NIUklOS0VSLCAwLCBfUkVUX0lQXyk7Ci0K
IAltdXRleF9hY3F1aXJlKCZtdXRleC0+ZGVwX21hcCwgMCwgMCwgX1JFVF9JUF8pOwogCW11dGV4
X3JlbGVhc2UoJm11dGV4LT5kZXBfbWFwLCAwLCBfUkVUX0lQXyk7CiAKLQltdXRleF9yZWxlYXNl
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4LmRlcF9tYXAsIDAsIF9SRVRfSVBfKTsKLQogCWZzX3Jl
Y2xhaW1fcmVsZWFzZShHRlBfS0VSTkVMKTsKIAogCWlmICh1bmxvY2spCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc3RvbGVuLmMgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fc3RvbGVuLmMKaW5kZXggMGQ4MWRlMTQ2MWI0Li4xNThkZGQ2
ZTczNWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zdG9s
ZW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc3RvbGVuLmMKQEAg
LTYyMSw4ICs2MjEsNiBAQCBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3N0b2xlbl9mb3JfcHJlYWxs
b2NhdGVkKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdgogCWlmICghZHJtX21tX2lu
aXRpYWxpemVkKCZkZXZfcHJpdi0+bW0uc3RvbGVuKSkKIAkJcmV0dXJuIE5VTEw7CiAKLQlsb2Nr
ZGVwX2Fzc2VydF9oZWxkKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlEUk1fREVC
VUdfRFJJVkVSKCJjcmVhdGluZyBwcmVhbGxvY2F0ZWQgc3RvbGVuIG9iamVjdDogc3RvbGVuX29m
ZnNldD0lcGEsIGd0dF9vZmZzZXQ9JXBhLCBzaXplPSVwYVxuIiwKIAkJCSAmc3RvbGVuX29mZnNl
dCwgJmd0dF9vZmZzZXQsICZzaXplKTsKIApAQCAtNjc0LDExICs2NzIsMTMgQEAgaTkxNV9nZW1f
b2JqZWN0X2NyZWF0ZV9zdG9sZW5fZm9yX3ByZWFsbG9jYXRlZChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYKIAkgKiBzZXR0aW5nIHVwIHRoZSBHVFQgc3BhY2UuIFRoZSBhY3R1YWwg
cmVzZXJ2YXRpb24gd2lsbCBvY2N1cgogCSAqIGxhdGVyLgogCSAqLworCW11dGV4X2xvY2soJmdn
dHQtPnZtLm11dGV4KTsKIAlyZXQgPSBpOTE1X2dlbV9ndHRfcmVzZXJ2ZSgmZ2d0dC0+dm0sICZ2
bWEtPm5vZGUsCiAJCQkJICAgc2l6ZSwgZ3R0X29mZnNldCwgb2JqLT5jYWNoZV9sZXZlbCwKIAkJ
CQkgICAwKTsKIAlpZiAocmV0KSB7CiAJCURSTV9ERUJVR19EUklWRVIoImZhaWxlZCB0byBhbGxv
Y2F0ZSBzdG9sZW4gR1RUIHNwYWNlXG4iKTsKKwkJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRl
eCk7CiAJCWdvdG8gZXJyX3BhZ2VzOwogCX0KIApAQCAtNjg4LDcgKzY4OCw2IEBAIGk5MTVfZ2Vt
X29iamVjdF9jcmVhdGVfc3RvbGVuX2Zvcl9wcmVhbGxvY2F0ZWQoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2CiAJc2V0X2JpdChJOTE1X1ZNQV9HTE9CQUxfQklORF9CSVQsIF9faTkx
NV92bWFfZmxhZ3Modm1hKSk7CiAJX19pOTE1X3ZtYV9zZXRfbWFwX2FuZF9mZW5jZWFibGUodm1h
KTsKIAotCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAlsaXN0X2FkZF90YWlsKCZ2bWEt
PnZtX2xpbmssICZnZ3R0LT52bS5ib3VuZF9saXN0KTsKIAltdXRleF91bmxvY2soJmdndHQtPnZt
Lm11dGV4KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X3RpbGluZy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3RpbGluZy5jCmlu
ZGV4IGNhMGMyZjQ1MTc0Mi4uYjljZmFlMGU0NDM1IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fdGlsaW5nLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX3RpbGluZy5jCkBAIC0xODEsMjIgKzE4MSwyNSBAQCBzdGF0aWMgaW50CiBp
OTE1X2dlbV9vYmplY3RfZmVuY2VfcHJlcGFyZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAq
b2JqLAogCQkJICAgICAgaW50IHRpbGluZ19tb2RlLCB1bnNpZ25lZCBpbnQgc3RyaWRlKQogewor
CXN0cnVjdCBpOTE1X2dndHQgKmdndHQgPSAmdG9faTkxNShvYmotPmJhc2UuZGV2KS0+Z2d0dDsK
IAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKLQlpbnQgcmV0OworCWludCByZXQgPSAwOwogCiAJaWYg
KHRpbGluZ19tb2RlID09IEk5MTVfVElMSU5HX05PTkUpCiAJCXJldHVybiAwOwogCisJbXV0ZXhf
bG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWZvcl9lYWNoX2dndHRfdm1hKHZtYSwgb2JqKSB7CiAJ
CWlmIChpOTE1X3ZtYV9mZW5jZV9wcmVwYXJlKHZtYSwgdGlsaW5nX21vZGUsIHN0cmlkZSkpCiAJ
CQljb250aW51ZTsKIAogCQlyZXQgPSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKIAkJaWYgKHJldCkK
LQkJCXJldHVybiByZXQ7CisJCQlicmVhazsKIAl9CisJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5t
dXRleCk7CiAKLQlyZXR1cm4gMDsKKwlyZXR1cm4gcmV0OwogfQogCiBpbnQKQEAgLTIxMiw3ICsy
MTUsNiBAQCBpOTE1X2dlbV9vYmplY3Rfc2V0X3RpbGluZyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqLAogCiAJR0VNX0JVR19PTighaTkxNV90aWxpbmdfb2sob2JqLCB0aWxpbmcsIHN0
cmlkZSkpOwogCUdFTV9CVUdfT04oIXN0cmlkZSBeICh0aWxpbmcgPT0gSTkxNV9USUxJTkdfTk9O
RSkpOwotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJ
aWYgKCh0aWxpbmcgfCBzdHJpZGUpID09IG9iai0+dGlsaW5nX2FuZF9zdHJpZGUpCiAJCXJldHVy
biAwOwpAQCAtMzY0LDEyICszNjYsNyBAQCBpOTE1X2dlbV9zZXRfdGlsaW5nX2lvY3RsKHN0cnVj
dCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAJCX0KIAl9CiAKLQllcnIgPSBtdXRleF9s
b2NrX2ludGVycnVwdGlibGUoJmRldi0+c3RydWN0X211dGV4KTsKLQlpZiAoZXJyKQotCQlnb3Rv
IGVycjsKLQogCWVyciA9IGk5MTVfZ2VtX29iamVjdF9zZXRfdGlsaW5nKG9iaiwgYXJncy0+dGls
aW5nX21vZGUsIGFyZ3MtPnN0cmlkZSk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXYtPnN0cnVjdF9tdXRl
eCk7CiAKIAkvKiBXZSBoYXZlIHRvIG1haW50YWluIHRoaXMgZXhpc3RpbmcgQUJJLi4uICovCiAJ
YXJncy0+c3RyaWRlID0gaTkxNV9nZW1fb2JqZWN0X2dldF9zdHJpZGUob2JqKTsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91c2VycHRyLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fdXNlcnB0ci5jCmluZGV4IDc0ZGEzNTYxMWQ3Yy4u
Y2QzNjIzNmUzZmFmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fdXNlcnB0ci5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV91c2Vy
cHRyLmMKQEAgLTkyLDcgKzkyLDYgQEAgdXNlcnB0cl9tbl9pbnZhbGlkYXRlX3JhbmdlX3N0YXJ0
KHN0cnVjdCBtbXVfbm90aWZpZXIgKl9tbiwKIAlzdHJ1Y3QgaTkxNV9tbXVfbm90aWZpZXIgKm1u
ID0KIAkJY29udGFpbmVyX29mKF9tbiwgc3RydWN0IGk5MTVfbW11X25vdGlmaWVyLCBtbik7CiAJ
c3RydWN0IGludGVydmFsX3RyZWVfbm9kZSAqaXQ7Ci0Jc3RydWN0IG11dGV4ICp1bmxvY2sgPSBO
VUxMOwogCXVuc2lnbmVkIGxvbmcgZW5kOwogCWludCByZXQgPSAwOwogCkBAIC0xMjksMzMgKzEy
OCwxMyBAQCB1c2VycHRyX21uX2ludmFsaWRhdGVfcmFuZ2Vfc3RhcnQoc3RydWN0IG1tdV9ub3Rp
ZmllciAqX21uLAogCQl9CiAJCXNwaW5fdW5sb2NrKCZtbi0+bG9jayk7CiAKLQkJaWYgKCF1bmxv
Y2spIHsKLQkJCXVubG9jayA9ICZtbi0+bW0tPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXg7Ci0KLQkJ
CXN3aXRjaCAobXV0ZXhfdHJ5bG9ja19yZWN1cnNpdmUodW5sb2NrKSkgewotCQkJZGVmYXVsdDoK
LQkJCWNhc2UgTVVURVhfVFJZTE9DS19GQUlMRUQ6Ci0JCQkJaWYgKG11dGV4X2xvY2tfa2lsbGFi
bGVfbmVzdGVkKHVubG9jaywgSTkxNV9NTV9TSFJJTktFUikpIHsKLQkJCQkJaTkxNV9nZW1fb2Jq
ZWN0X3B1dChvYmopOwotCQkJCQlyZXR1cm4gLUVJTlRSOwotCQkJCX0KLQkJCQkvKiBmYWxsIHRo
cm91Z2ggKi8KLQkJCWNhc2UgTVVURVhfVFJZTE9DS19TVUNDRVNTOgotCQkJCWJyZWFrOwotCi0J
CQljYXNlIE1VVEVYX1RSWUxPQ0tfUkVDVVJTSVZFOgotCQkJCXVubG9jayA9IEVSUl9QVFIoLUVF
WElTVCk7Ci0JCQkJYnJlYWs7Ci0JCQl9Ci0JCX0KLQogCQlyZXQgPSBpOTE1X2dlbV9vYmplY3Rf
dW5iaW5kKG9iaiwKIAkJCQkJICAgICBJOTE1X0dFTV9PQkpFQ1RfVU5CSU5EX0FDVElWRSk7CiAJ
CWlmIChyZXQgPT0gMCkKIAkJCXJldCA9IF9faTkxNV9nZW1fb2JqZWN0X3B1dF9wYWdlcyhvYmos
IEk5MTVfTU1fU0hSSU5LRVIpOwogCQlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7CiAJCWlmIChy
ZXQpCi0JCQlnb3RvIHVubG9jazsKKwkJCXJldHVybiByZXQ7CiAKIAkJc3Bpbl9sb2NrKCZtbi0+
bG9jayk7CiAKQEAgLTE2OCwxMCArMTQ3LDYgQEAgdXNlcnB0cl9tbl9pbnZhbGlkYXRlX3Jhbmdl
X3N0YXJ0KHN0cnVjdCBtbXVfbm90aWZpZXIgKl9tbiwKIAl9CiAJc3Bpbl91bmxvY2soJm1uLT5s
b2NrKTsKIAotdW5sb2NrOgotCWlmICghSVNfRVJSX09SX05VTEwodW5sb2NrKSkKLQkJbXV0ZXhf
dW5sb2NrKHVubG9jayk7Ci0KIAlyZXR1cm4gcmV0OwogCiB9CmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2h1Z2VfcGFnZXMuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaHVnZV9wYWdlcy5jCmluZGV4IGM1Y2VhNDM3OTIxNi4uY2Q3
NzExNDdiNDFmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3Rz
L2h1Z2VfcGFnZXMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2h1
Z2VfcGFnZXMuYwpAQCAtMjUsNiArMjUsMTcgQEAgc3RhdGljIGNvbnN0IHVuc2lnbmVkIGludCBw
YWdlX3NpemVzW10gPSB7CiAJSTkxNV9HVFRfUEFHRV9TSVpFXzRLLAogfTsKIAorc3RhdGljIGlu
dCB1bmxvY2tlZF92bWFfdW5iaW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQoreworCWludCByZXQ7
CisKKwltdXRleF9sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CisJcmV0ID0gaTkxNV92bWFfdW5iaW5k
KHZtYSk7CisJbXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CisKKwlyZXR1cm4gcmV0Owor
fQorCiBzdGF0aWMgdW5zaWduZWQgaW50IGdldF9sYXJnZXN0X3BhZ2Vfc2l6ZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAkJCQkJICB1NjQgcmVtKQogewpAQCAtMzMzLDcgKzM0NCwx
MSBAQCBzdGF0aWMgaW50IGlndF9jaGVja19wYWdlX3NpemVzKHN0cnVjdCBpOTE1X3ZtYSAqdm1h
KQogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gdm1hLT52bS0+aTkxNTsKIAl1bnNp
Z25lZCBpbnQgc3VwcG9ydGVkID0gSU5URUxfSU5GTyhpOTE1KS0+cGFnZV9zaXplczsKIAlzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gdm1hLT5vYmo7Ci0JaW50IGVyciA9IDA7CisJ
aW50IGVycjsKKworCWVyciA9IGk5MTVfYWN0aXZlX3dhaXQoJnZtYS0+YWN0aXZlKTsKKwlpZiAo
ZXJyKQorCQlyZXR1cm4gZXJyOwogCiAJaWYgKCFIQVNfUEFHRV9TSVpFUyhpOTE1LCB2bWEtPnBh
Z2Vfc2l6ZXMuc2cpKSB7CiAJCXByX2VycigidW5zdXBwb3J0ZWQgcGFnZV9zaXplcy5zZz0ldSwg
c3VwcG9ydGVkPSV1XG4iLApAQCAtNTI2LDcgKzU0MSw3IEBAIHN0YXRpYyBpbnQgaWd0X21vY2tf
cHBndHRfbWlzYWxpZ25lZF9kbWEodm9pZCAqYXJnKQogCQkgKiBwYWdlcy4KIAkJICovCiAJCWZv
ciAob2Zmc2V0ID0gNDA5Njsgb2Zmc2V0IDwgcGFnZV9zaXplOyBvZmZzZXQgKz0gNDA5Nikgewot
CQkJZXJyID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CisJCQllcnIgPSB1bmxvY2tlZF92bWFfdW5i
aW5kKHZtYSk7CiAJCQlpZiAoZXJyKSB7CiAJCQkJaTkxNV92bWFfY2xvc2Uodm1hKTsKIAkJCQln
b3RvIG91dF91bnBpbjsKQEAgLTk0MSw3ICs5NTYsNyBAQCBzdGF0aWMgaW50IF9faWd0X3dyaXRl
X2h1Z2Uoc3RydWN0IGludGVsX2NvbnRleHQgKmNlLAogCWlmIChJU19FUlIodm1hKSkKIAkJcmV0
dXJuIFBUUl9FUlIodm1hKTsKIAotCWVyciA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCWVyciA9
IHVubG9ja2VkX3ZtYV91bmJpbmQodm1hKTsKIAlpZiAoZXJyKQogCQlnb3RvIG91dF92bWFfY2xv
c2U7CiAKQEAgLTEzOTAsNyArMTQwNSw3IEBAIHN0YXRpYyBpbnQgaWd0X3BwZ3R0X3Bpbl91cGRh
dGUodm9pZCAqYXJnKQogCQkJZ290byBvdXRfdW5waW47CiAJCX0KIAotCQllcnIgPSBpOTE1X3Zt
YV9iaW5kKHZtYSwgSTkxNV9DQUNIRV9OT05FLCBQSU5fVVBEQVRFKTsKKwkJZXJyID0gaTkxNV92
bWFfYmluZCh2bWEsIEk5MTVfQ0FDSEVfTk9ORSwgUElOX1VQREFURSwgTlVMTCk7CiAJCWlmIChl
cnIpCiAJCQlnb3RvIG91dF91bnBpbjsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYwppbmRleCAxZDI3YmFiZmYwY2UuLjljMjE3ZGZl
OTZhOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1
X2dlbV9tbWFuLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1
X2dlbV9tbWFuLmMKQEAgLTIwNSw3ICsyMDUsNiBAQCBzdGF0aWMgaW50IGlndF9wYXJ0aWFsX3Rp
bGluZyh2b2lkICphcmcpCiAJCWdvdG8gb3V0OwogCX0KIAotCW11dGV4X2xvY2soJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwogCXdha2VyZWYgPSBpbnRlbF9ydW50aW1lX3BtX2dldCgmaTkxNS0+
cnVudGltZV9wbSk7CiAKIAlpZiAoMSkgewpAQCAtMzE4LDcgKzMxNyw2IEBAIG5leHRfdGlsaW5n
OiA7CiAKIG91dF91bmxvY2s6CiAJaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVf
cG0sIHdha2VyZWYpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJ
aTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKG9iaik7CiBvdXQ6CiAJaTkxNV9nZW1fb2JqZWN0
X3B1dChvYmopOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3Qu
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0LmMKaW5kZXggZDQ4ZWM5YTc2ZWQx
Li5jMmFmZmZiOTQ0NzQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2d0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYwpAQCAtMjA3LDEx
ICsyMDcsMTIgQEAgdm9pZCBpbnRlbF9ndF9mbHVzaF9nZ3R0X3dyaXRlcyhzdHJ1Y3QgaW50ZWxf
Z3QgKmd0KQogCiAJd2l0aF9pbnRlbF9ydW50aW1lX3BtKCZpOTE1LT5ydW50aW1lX3BtLCB3YWtl
cmVmKSB7CiAJCXN0cnVjdCBpbnRlbF91bmNvcmUgKnVuY29yZSA9IGd0LT51bmNvcmU7CisJCXVu
c2lnbmVkIGxvbmcgZmxhZ3M7CiAKLQkJc3Bpbl9sb2NrX2lycSgmdW5jb3JlLT5sb2NrKTsKKwkJ
c3Bpbl9sb2NrX2lycXNhdmUoJnVuY29yZS0+bG9jaywgZmxhZ3MpOwogCQlpbnRlbF91bmNvcmVf
cG9zdGluZ19yZWFkX2Z3KHVuY29yZSwKIAkJCQkJICAgICBSSU5HX0hFQUQoUkVOREVSX1JJTkdf
QkFTRSkpOwotCQlzcGluX3VubG9ja19pcnEoJnVuY29yZS0+bG9jayk7CisJCXNwaW5fdW5sb2Nr
X2lycXJlc3RvcmUoJnVuY29yZS0+bG9jaywgZmxhZ3MpOwogCX0KIH0KIApkaWZmIC0tZ2l0IGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9oYW5nY2hlY2suYwppbmRleCBhMDA5OGZjMzU5MjEuLmU1
M2VlYTEwNTBmOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
aGFuZ2NoZWNrLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2No
ZWNrLmMKQEAgLTExMjcsMTUgKzExMjcsMTQgQEAgc3RhdGljIGludCBldmljdF92bWEodm9pZCAq
ZGF0YSkKIHsKIAlzdHJ1Y3QgZXZpY3Rfdm1hICphcmcgPSBkYXRhOwogCXN0cnVjdCBpOTE1X2Fk
ZHJlc3Nfc3BhY2UgKnZtID0gYXJnLT52bWEtPnZtOwotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1ID0gdm0tPmk5MTU7CiAJc3RydWN0IGRybV9tbV9ub2RlIGV2aWN0ID0gYXJnLT52bWEt
Pm5vZGU7CiAJaW50IGVycjsKIAogCWNvbXBsZXRlKCZhcmctPmNvbXBsZXRpb24pOwogCi0JbXV0
ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfbG9jaygmdm0tPm11dGV4
KTsKIAllcnIgPSBpOTE1X2dlbV9ldmljdF9mb3Jfbm9kZSh2bSwgJmV2aWN0LCAwKTsKLQltdXRl
eF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X3VubG9jaygmdm0tPm11
dGV4KTsKIAogCXJldHVybiBlcnI7CiB9CkBAIC0xMTQzLDM5ICsxMTQyLDMzIEBAIHN0YXRpYyBp
bnQgZXZpY3Rfdm1hKHZvaWQgKmRhdGEpCiBzdGF0aWMgaW50IGV2aWN0X2ZlbmNlKHZvaWQgKmRh
dGEpCiB7CiAJc3RydWN0IGV2aWN0X3ZtYSAqYXJnID0gZGF0YTsKLQlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqaTkxNSA9IGFyZy0+dm1hLT52bS0+aTkxNTsKIAlpbnQgZXJyOwogCiAJY29tcGxl
dGUoJmFyZy0+Y29tcGxldGlvbik7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKLQogCS8qIE1hcmsgdGhlIGZlbmNlIHJlZ2lzdGVyIGFzIGRpcnR5IHRvIGZvcmNlIHRo
ZSBtbWlvIHVwZGF0ZS4gKi8KIAllcnIgPSBpOTE1X2dlbV9vYmplY3Rfc2V0X3RpbGluZyhhcmct
PnZtYS0+b2JqLCBJOTE1X1RJTElOR19ZLCA1MTIpOwogCWlmIChlcnIpIHsKIAkJcHJfZXJyKCJJ
bnZhbGlkIFktdGlsaW5nIHNldHRpbmdzOyBlcnI6JWRcbiIsIGVycik7Ci0JCWdvdG8gb3V0X3Vu
bG9jazsKKwkJcmV0dXJuIGVycjsKIAl9CiAKIAllcnIgPSBpOTE1X3ZtYV9waW4oYXJnLT52bWEs
IDAsIDAsIFBJTl9HTE9CQUwgfCBQSU5fTUFQUEFCTEUpOwogCWlmIChlcnIpIHsKIAkJcHJfZXJy
KCJVbmFibGUgdG8gcGluIHZtYSBmb3IgWS10aWxlZCBmZW5jZTsgZXJyOiVkXG4iLCBlcnIpOwot
CQlnb3RvIG91dF91bmxvY2s7CisJCXJldHVybiBlcnI7CiAJfQogCiAJZXJyID0gaTkxNV92bWFf
cGluX2ZlbmNlKGFyZy0+dm1hKTsKIAlpOTE1X3ZtYV91bnBpbihhcmctPnZtYSk7CiAJaWYgKGVy
cikgewogCQlwcl9lcnIoIlVuYWJsZSB0byBwaW4gWS10aWxlZCBmZW5jZTsgZXJyOiVkXG4iLCBl
cnIpOwotCQlnb3RvIG91dF91bmxvY2s7CisJCXJldHVybiBlcnI7CiAJfQogCiAJaTkxNV92bWFf
dW5waW5fZmVuY2UoYXJnLT52bWEpOwogCi1vdXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQlyZXR1cm4gZXJyOworCXJldHVybiAwOwogfQogCiBz
dGF0aWMgaW50IF9faWd0X3Jlc2V0X2V2aWN0X3ZtYShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LApkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2FwZXJ0dXJlX2dtLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndnQvYXBlcnR1cmVfZ20uYwppbmRleCA1ZmYyNDM3YjI5OTguLmQ5OTZi
YmM3ZWE1OSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2FwZXJ0dXJlX2dt
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Z0L2FwZXJ0dXJlX2dtLmMKQEAgLTYxLDE0
ICs2MSwxNCBAQCBzdGF0aWMgaW50IGFsbG9jX2dtKHN0cnVjdCBpbnRlbF92Z3B1ICp2Z3B1LCBi
b29sIGhpZ2hfZ20pCiAJCWZsYWdzID0gUElOX01BUFBBQkxFOwogCX0KIAotCW11dGV4X2xvY2so
JmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF9sb2NrKCZkZXZfcHJpdi0+Z2d0
dC52bS5tdXRleCk7CiAJbW1pb19od19hY2Nlc3NfcHJlKGRldl9wcml2KTsKIAlyZXQgPSBpOTE1
X2dlbV9ndHRfaW5zZXJ0KCZkZXZfcHJpdi0+Z2d0dC52bSwgbm9kZSwKIAkJCQkgIHNpemUsIEk5
MTVfR1RUX1BBR0VfU0laRSwKIAkJCQkgIEk5MTVfQ09MT1JfVU5FVklDVEFCTEUsCiAJCQkJICBz
dGFydCwgZW5kLCBmbGFncyk7CiAJbW1pb19od19hY2Nlc3NfcG9zdChkZXZfcHJpdik7Ci0JbXV0
ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZk
ZXZfcHJpdi0+Z2d0dC52bS5tdXRleCk7CiAJaWYgKHJldCkKIAkJZ3Z0X2VycigiZmFpbCB0byBh
bGxvYyAlcyBnbSBzcGFjZSBmcm9tIGhvc3RcbiIsCiAJCQloaWdoX2dtID8gImhpZ2giIDogImxv
dyIpOwpAQCAtOTgsOSArOTgsOSBAQCBzdGF0aWMgaW50IGFsbG9jX3ZncHVfZ20oc3RydWN0IGlu
dGVsX3ZncHUgKnZncHUpCiAKIAlyZXR1cm4gMDsKIG91dF9mcmVlX2FwZXJ0dXJlOgotCW11dGV4
X2xvY2soJmRldl9wcml2LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF9sb2NrKCZkZXZfcHJp
di0+Z2d0dC52bS5tdXRleCk7CiAJZHJtX21tX3JlbW92ZV9ub2RlKCZ2Z3B1LT5nbS5sb3dfZ21f
bm9kZSk7Ci0JbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CisJbXV0
ZXhfdW5sb2NrKCZkZXZfcHJpdi0+Z2d0dC52bS5tdXRleCk7CiAJcmV0dXJuIHJldDsKIH0KIApA
QCAtMTA4LDEwICsxMDgsMTAgQEAgc3RhdGljIHZvaWQgZnJlZV92Z3B1X2dtKHN0cnVjdCBpbnRl
bF92Z3B1ICp2Z3B1KQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHZn
cHUtPmd2dC0+ZGV2X3ByaXY7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJtLnN0cnVjdF9t
dXRleCk7CisJbXV0ZXhfbG9jaygmZGV2X3ByaXYtPmdndHQudm0ubXV0ZXgpOwogCWRybV9tbV9y
ZW1vdmVfbm9kZSgmdmdwdS0+Z20ubG93X2dtX25vZGUpOwogCWRybV9tbV9yZW1vdmVfbm9kZSgm
dmdwdS0+Z20uaGlnaF9nbV9ub2RlKTsKLQltdXRleF91bmxvY2soJmRldl9wcml2LT5kcm0uc3Ry
dWN0X211dGV4KTsKKwltdXRleF91bmxvY2soJmRldl9wcml2LT5nZ3R0LnZtLm11dGV4KTsKIH0K
IAogLyoqCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuYwppbmRleCA0OGUxNmFkOTNiYmQuLjVl
OWY4MjZmZjEzMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2FjdGl2ZS5jCkBAIC0xNDIsNiArMTQy
LDcgQEAgX19hY3RpdmVfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZSAqcmVmKQogCWlmICghcmV0
aXJlKQogCQlyZXR1cm47CiAKKwlHRU1fQlVHX09OKHJjdV9hY2Nlc3NfcG9pbnRlcihyZWYtPmV4
Y2wpKTsKIAlyYnRyZWVfcG9zdG9yZGVyX2Zvcl9lYWNoX2VudHJ5X3NhZmUoaXQsIG4sICZyb290
LCBub2RlKSB7CiAJCUdFTV9CVUdfT04oaTkxNV9hY3RpdmVfcmVxdWVzdF9pc3NldCgmaXQtPmJh
c2UpKTsKIAkJa21lbV9jYWNoZV9mcmVlKGdsb2JhbC5zbGFiX2NhY2hlLCBpdCk7CkBAIC0yNDEs
NiArMjQyLDggQEAgdm9pZCBfX2k5MTVfYWN0aXZlX2luaXQoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCiAJcmVmLT5mbGFncyA9IDA7CiAJcmVmLT5hY3RpdmUgPSBhY3RpdmU7CiAJcmVm
LT5yZXRpcmUgPSByZXRpcmU7CisKKwlyZWYtPmV4Y2wgPSBOVUxMOwogCXJlZi0+dHJlZSA9IFJC
X1JPT1Q7CiAJcmVmLT5jYWNoZSA9IE5VTEw7CiAJaW5pdF9sbGlzdF9oZWFkKCZyZWYtPnByZWFs
bG9jYXRlZF9iYXJyaWVycyk7CkBAIC0zMzcsNiArMzQwLDQ1IEBAIGludCBpOTE1X2FjdGl2ZV9y
ZWYoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsCiAJcmV0dXJuIGVycjsKIH0KIAorc3RhdGljIHZv
aWQgZXhjbF9jYihzdHJ1Y3QgZG1hX2ZlbmNlICpmLCBzdHJ1Y3QgZG1hX2ZlbmNlX2NiICpjYikK
K3sKKwlzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZiA9IGNvbnRhaW5lcl9vZihjYiwgdHlwZW9mKCpy
ZWYpLCBleGNsX2NiKTsKKworCVJDVV9JTklUX1BPSU5URVIocmVmLT5leGNsLCBOVUxMKTsKKwlk
bWFfZmVuY2VfcHV0KGYpOworCisJYWN0aXZlX3JldGlyZShyZWYpOworfQorCit2b2lkIGk5MTVf
YWN0aXZlX3NldF9leGNsdXNpdmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsIHN0cnVjdCBkbWFf
ZmVuY2UgKmYpCit7CisJR0VNX0JVR19PTihpOTE1X2FjdGl2ZV9pc19pZGxlKHJlZikpOworCisJ
ZG1hX2ZlbmNlX2dldChmKTsKKworCXJjdV9yZWFkX2xvY2soKTsKKwlpZiAocmN1X2FjY2Vzc19w
b2ludGVyKHJlZi0+ZXhjbCkpIHsKKwkJc3RydWN0IGRtYV9mZW5jZSAqb2xkOworCisJCW9sZCA9
IGRtYV9mZW5jZV9nZXRfcmN1X3NhZmUoJnJlZi0+ZXhjbCk7CisJCWlmIChvbGQpIHsKKwkJCWlm
IChkbWFfZmVuY2VfcmVtb3ZlX2NhbGxiYWNrKG9sZCwgJnJlZi0+ZXhjbF9jYikpCisJCQkJYXRv
bWljX2RlYygmcmVmLT5jb3VudCk7CisJCQlkbWFfZmVuY2VfcHV0KG9sZCk7CisJCX0KKwl9CisJ
cmN1X3JlYWRfdW5sb2NrKCk7CisKKwlhdG9taWNfaW5jKCZyZWYtPmNvdW50KTsKKwlyY3VfYXNz
aWduX3BvaW50ZXIocmVmLT5leGNsLCBmKTsKKworCWlmIChkbWFfZmVuY2VfYWRkX2NhbGxiYWNr
KGYsICZyZWYtPmV4Y2xfY2IsIGV4Y2xfY2IpKSB7CisJCVJDVV9JTklUX1BPSU5URVIocmVmLT5l
eGNsLCBOVUxMKTsKKwkJYXRvbWljX2RlYygmcmVmLT5jb3VudCk7CisJCWRtYV9mZW5jZV9wdXQo
Zik7CisJfQorfQorCiBpbnQgaTkxNV9hY3RpdmVfYWNxdWlyZShzdHJ1Y3QgaTkxNV9hY3RpdmUg
KnJlZikKIHsKIAlpbnQgZXJyOwpAQCAtMzk1LDYgKzQzNywyNSBAQCB2b2lkIGk5MTVfYWN0aXZl
X3VuZ3JhYihzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIAlfX2FjdGl2ZV91bmdyYWIocmVmKTsK
IH0KIAorc3RhdGljIGludCBleGNsX3dhaXQoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCit7CisJ
c3RydWN0IGRtYV9mZW5jZSAqb2xkOworCWludCBlcnIgPSAwOworCisJaWYgKCFyY3VfYWNjZXNz
X3BvaW50ZXIocmVmLT5leGNsKSkKKwkJcmV0dXJuIDA7CisKKwlyY3VfcmVhZF9sb2NrKCk7CisJ
b2xkID0gZG1hX2ZlbmNlX2dldF9yY3Vfc2FmZSgmcmVmLT5leGNsKTsKKwlyY3VfcmVhZF91bmxv
Y2soKTsKKwlpZiAob2xkKSB7CisJCWVyciA9IGRtYV9mZW5jZV93YWl0KG9sZCwgdHJ1ZSk7CisJ
CWRtYV9mZW5jZV9wdXQob2xkKTsKKwl9CisKKwlyZXR1cm4gZXJyOworfQorCiBpbnQgaTkxNV9h
Y3RpdmVfd2FpdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZikKIHsKIAlzdHJ1Y3QgYWN0aXZlX25v
ZGUgKml0LCAqbjsKQEAgLTQxNSw2ICs0NzYsMTAgQEAgaW50IGk5MTVfYWN0aXZlX3dhaXQoc3Ry
dWN0IGk5MTVfYWN0aXZlICpyZWYpCiAJCXJldHVybiAwOwogCX0KIAorCWVyciA9IGV4Y2xfd2Fp
dChyZWYpOworCWlmIChlcnIpCisJCWdvdG8gb3V0OworCiAJcmJ0cmVlX3Bvc3RvcmRlcl9mb3Jf
ZWFjaF9lbnRyeV9zYWZlKGl0LCBuLCAmcmVmLT50cmVlLCBub2RlKSB7CiAJCWlmIChpc19iYXJy
aWVyKCZpdC0+YmFzZSkpIHsgLyogdW5jb25uZWN0ZWQgaWRsZS1iYXJyaWVyICovCiAJCQllcnIg
PSAtRUJVU1k7CkBAIC00MjYsNiArNDkxLDcgQEAgaW50IGk5MTVfYWN0aXZlX3dhaXQoc3RydWN0
IGk5MTVfYWN0aXZlICpyZWYpCiAJCQlicmVhazsKIAl9CiAKK291dDoKIAlfX2FjdGl2ZV9yZXRp
cmUocmVmKTsKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9hY3RpdmUuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0
aXZlLmgKaW5kZXggZjk1MDU4Zjk5MDU3Li5iYzFjOWQ1ZDRmNjMgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9hY3RpdmUuaApAQCAtMzczLDYgKzM3Myw4IEBAIGludCBpOTE1X2FjdGl2ZV9yZWYoc3Ry
dWN0IGk5MTVfYWN0aXZlICpyZWYsCiAJCSAgICBzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsLAog
CQkgICAgc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpOwogCit2b2lkIGk5MTVfYWN0aXZlX3NldF9l
eGNsdXNpdmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYsIHN0cnVjdCBkbWFfZmVuY2UgKmYpOwor
CiBpbnQgaTkxNV9hY3RpdmVfd2FpdChzdHJ1Y3QgaTkxNV9hY3RpdmUgKnJlZik7CiAKIGludCBp
OTE1X3JlcXVlc3RfYXdhaXRfYWN0aXZlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLApkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmVfdHlwZXMuaCBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5cGVzLmgKaW5kZXggMTg1NGU3ZDE2OGMxLi44NmU3
YTIzMmVhM2MgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfYWN0aXZlX3R5
cGVzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9hY3RpdmVfdHlwZXMuaApAQCAt
OCw2ICs4LDcgQEAKICNkZWZpbmUgX0k5MTVfQUNUSVZFX1RZUEVTX0hfCiAKICNpbmNsdWRlIDxs
aW51eC9hdG9taWMuaD4KKyNpbmNsdWRlIDxsaW51eC9kbWEtZmVuY2UuaD4KICNpbmNsdWRlIDxs
aW51eC9sbGlzdC5oPgogI2luY2x1ZGUgPGxpbnV4L211dGV4Lmg+CiAjaW5jbHVkZSA8bGludXgv
cmJ0cmVlLmg+CkBAIC01MSw2ICs1MiwxMCBAQCBzdHJ1Y3QgaTkxNV9hY3RpdmUgewogCXN0cnVj
dCBtdXRleCBtdXRleDsKIAlhdG9taWNfdCBjb3VudDsKIAorCS8qIFByZWFsbG9jYXRlZCAiZXhj
bHVzaXZlIiBub2RlICovCisJc3RydWN0IGRtYV9mZW5jZSBfX3JjdSAqZXhjbDsKKwlzdHJ1Y3Qg
ZG1hX2ZlbmNlX2NiIGV4Y2xfY2I7CisKIAl1bnNpZ25lZCBsb25nIGZsYWdzOwogI2RlZmluZSBJ
OTE1X0FDVElWRV9HUkFCX0JJVCAwCiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2k5MTVfZ2VtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jCmluZGV4IDgxNGY2
MmZjYTcyNy4uZTMwNTQyZTU0MDhkIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKQEAgLTYyLDIw
ICs2MiwzMSBAQAogI2luY2x1ZGUgImludGVsX3BtLmgiCiAKIHN0YXRpYyBpbnQKLWluc2VydF9t
YXBwYWJsZV9ub2RlKHN0cnVjdCBpOTE1X2dndHQgKmdndHQsCi0gICAgICAgICAgICAgICAgICAg
ICBzdHJ1Y3QgZHJtX21tX25vZGUgKm5vZGUsIHUzMiBzaXplKQoraW5zZXJ0X21hcHBhYmxlX25v
ZGUoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCwgc3RydWN0IGRybV9tbV9ub2RlICpub2RlLCB1MzIg
c2l6ZSkKIHsKKwlpbnQgZXJyOworCisJZXJyID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZn
Z3R0LT52bS5tdXRleCk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKwogCW1lbXNldChub2Rl
LCAwLCBzaXplb2YoKm5vZGUpKTsKLQlyZXR1cm4gZHJtX21tX2luc2VydF9ub2RlX2luX3Jhbmdl
KCZnZ3R0LT52bS5tbSwgbm9kZSwKLQkJCQkJICAgc2l6ZSwgMCwgSTkxNV9DT0xPUl9VTkVWSUNU
QUJMRSwKLQkJCQkJICAgMCwgZ2d0dC0+bWFwcGFibGVfZW5kLAotCQkJCQkgICBEUk1fTU1fSU5T
RVJUX0xPVyk7CisJZXJyID0gZHJtX21tX2luc2VydF9ub2RlX2luX3JhbmdlKCZnZ3R0LT52bS5t
bSwgbm9kZSwKKwkJCQkJICBzaXplLCAwLCBJOTE1X0NPTE9SX1VORVZJQ1RBQkxFLAorCQkJCQkg
IDAsIGdndHQtPm1hcHBhYmxlX2VuZCwKKwkJCQkJICBEUk1fTU1fSU5TRVJUX0xPVyk7CisKKwlt
dXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKKworCXJldHVybiBlcnI7CiB9CiAKIHN0YXRp
YyB2b2lkCi1yZW1vdmVfbWFwcGFibGVfbm9kZShzdHJ1Y3QgZHJtX21tX25vZGUgKm5vZGUpCity
ZW1vdmVfbWFwcGFibGVfbm9kZShzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0LCBzdHJ1Y3QgZHJtX21t
X25vZGUgKm5vZGUpCiB7CisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWRybV9tbV9y
ZW1vdmVfbm9kZShub2RlKTsKKwltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIH0KIAog
aW50CkBAIC04Nyw3ICs5OCw4IEBAIGk5MTVfZ2VtX2dldF9hcGVydHVyZV9pb2N0bChzdHJ1Y3Qg
ZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCXU2
NCBwaW5uZWQ7CiAKLQltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CisJaWYgKG11dGV4X2xv
Y2tfaW50ZXJydXB0aWJsZSgmZ2d0dC0+dm0ubXV0ZXgpKQorCQlyZXR1cm4gLUVJTlRSOwogCiAJ
cGlubmVkID0gZ2d0dC0+dm0ucmVzZXJ2ZWQ7CiAJbGlzdF9mb3JfZWFjaF9lbnRyeSh2bWEsICZn
Z3R0LT52bS5ib3VuZF9saXN0LCB2bV9saW5rKQpAQCAtMTA5LDggKzEyMSw2IEBAIGludCBpOTE1
X2dlbV9vYmplY3RfdW5iaW5kKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJTElT
VF9IRUFEKHN0aWxsX2luX2xpc3QpOwogCWludCByZXQgPSAwOwogCi0JbG9ja2RlcF9hc3NlcnRf
aGVsZCgmb2JqLT5iYXNlLmRldi0+c3RydWN0X211dGV4KTsKLQogCXNwaW5fbG9jaygmb2JqLT52
bWEubG9jayk7CiAJd2hpbGUgKCFyZXQgJiYgKHZtYSA9IGxpc3RfZmlyc3RfZW50cnlfb3JfbnVs
bCgmb2JqLT52bWEubGlzdCwKIAkJCQkJCSAgICAgICBzdHJ1Y3QgaTkxNV92bWEsCkBAIC0xMjAs
OCArMTMwLDE1IEBAIGludCBpOTE1X2dlbV9vYmplY3RfdW5iaW5kKHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmosCiAKIAkJcmV0ID0gLUVCVVNZOwogCQlpZiAoZmxhZ3MgJiBJOTE1X0dF
TV9PQkpFQ1RfVU5CSU5EX0FDVElWRSB8fAotCQkgICAgIWk5MTVfdm1hX2lzX2FjdGl2ZSh2bWEp
KQotCQkJcmV0ID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CisJCSAgICAhaTkxNV92bWFfaXNfYWN0
aXZlKHZtYSkpIHsKKwkJCXN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtID0gdm1hLT52bTsK
KworCQkJcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZ2bS0+bXV0ZXgpOworCQkJaWYg
KCFyZXQpIHsKKwkJCQlyZXQgPSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJCQltdXRleF91bmxv
Y2soJnZtLT5tdXRleCk7CisJCQl9CisJCX0KIAogCQlzcGluX2xvY2soJm9iai0+dm1hLmxvY2sp
OwogCX0KQEAgLTMzOCwxMCArMzU1LDYgQEAgaTkxNV9nZW1fZ3R0X3ByZWFkKHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJdTY0IHJlbWFpbiwgb2Zmc2V0OwogCWludCByZXQ7CiAK
LQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KIAl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9w
bV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwogCXZtYSA9IEVSUl9QVFIoLUVOT0RFVik7CiAJaWYg
KCFpOTE1X2dlbV9vYmplY3RfaXNfdGlsZWQob2JqKSkKQEAgLTM1NSwxMiArMzY4LDEwIEBAIGk5
MTVfZ2VtX2d0dF9wcmVhZChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCX0gZWxz
ZSB7CiAJCXJldCA9IGluc2VydF9tYXBwYWJsZV9ub2RlKGdndHQsICZub2RlLCBQQUdFX1NJWkUp
OwogCQlpZiAocmV0KQotCQkJZ290byBvdXRfdW5sb2NrOworCQkJZ290byBvdXRfcnBtOwogCQlH
RU1fQlVHX09OKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJm5vZGUpKTsKIAl9CiAKLQltdXRleF91
bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJcmV0ID0gaTkxNV9nZW1fb2JqZWN0
X2xvY2tfaW50ZXJydXB0aWJsZShvYmopOwogCWlmIChyZXQpCiAJCWdvdG8gb3V0X3VucGluOwpA
QCAtNDE0LDE3ICs0MjUsMTQgQEAgaTkxNV9nZW1fZ3R0X3ByZWFkKHN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmosCiAKIAlpOTE1X2dlbV9vYmplY3RfdW5sb2NrX2ZlbmNlKG9iaiwgZmVu
Y2UpOwogb3V0X3VucGluOgotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
CWlmIChkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJm5vZGUpKSB7CiAJCWdndHQtPnZtLmNsZWFyX3Jh
bmdlKCZnZ3R0LT52bSwgbm9kZS5zdGFydCwgbm9kZS5zaXplKTsKLQkJcmVtb3ZlX21hcHBhYmxl
X25vZGUoJm5vZGUpOworCQlyZW1vdmVfbWFwcGFibGVfbm9kZShnZ3R0LCAmbm9kZSk7CiAJfSBl
bHNlIHsKIAkJaTkxNV92bWFfdW5waW4odm1hKTsKIAl9Ci1vdXRfdW5sb2NrOgorb3V0X3JwbToK
IAlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0
ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCXJldHVybiByZXQ7CiB9CiAK
QEAgLTUzMSwxMCArNTM5LDYgQEAgaTkxNV9nZW1fZ3R0X3B3cml0ZV9mYXN0KHN0cnVjdCBkcm1f
aTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJdm9pZCBfX3VzZXIgKnVzZXJfZGF0YTsKIAlpbnQgcmV0
OwogCi0JcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKLQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCiAJaWYgKGk5MTVfZ2VtX29iamVjdF9o
YXNfc3RydWN0X3BhZ2Uob2JqKSkgewogCQkvKgogCQkgKiBBdm9pZCB3YWtpbmcgdGhlIGRldmlj
ZSB1cCBpZiB3ZSBjYW4gZmFsbGJhY2ssIGFzCkBAIC01NDQsMTAgKzU0OCw4IEBAIGk5MTVfZ2Vt
X2d0dF9wd3JpdGVfZmFzdChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkgKiB1
c2luZyB0aGUgY2FjaGUgYnlwYXNzIG9mIGluZGlyZWN0IEdHVFQgYWNjZXNzLgogCQkgKi8KIAkJ
d2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0X2lmX2luX3VzZShycG0pOwotCQlpZiAoIXdh
a2VyZWYpIHsKLQkJCXJldCA9IC1FRkFVTFQ7Ci0JCQlnb3RvIG91dF91bmxvY2s7Ci0JCX0KKwkJ
aWYgKCF3YWtlcmVmKQorCQkJcmV0dXJuIC1FRkFVTFQ7CiAJfSBlbHNlIHsKIAkJLyogTm8gYmFj
a2luZyBwYWdlcywgbm8gZmFsbGJhY2ssIHdlIG11c3QgZm9yY2UgR0dUVCBhY2Nlc3MgKi8KIAkJ
d2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KHJwbSk7CkBAIC01NjksOCArNTcxLDYgQEAg
aTkxNV9nZW1fZ3R0X3B3cml0ZV9mYXN0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmos
CiAJCUdFTV9CVUdfT04oIWRybV9tbV9ub2RlX2FsbG9jYXRlZCgmbm9kZSkpOwogCX0KIAotCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlyZXQgPSBpOTE1X2dlbV9v
YmplY3RfbG9ja19pbnRlcnJ1cHRpYmxlKG9iaik7CiAJaWYgKHJldCkKIAkJZ290byBvdXRfdW5w
aW47CkBAIC02MzQsMTggKzYzNCwxNSBAQCBpOTE1X2dlbV9ndHRfcHdyaXRlX2Zhc3Qoc3RydWN0
IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAogCWk5MTVfZ2VtX29iamVjdF91bmxvY2tfZmVu
Y2Uob2JqLCBmZW5jZSk7CiBvdXRfdW5waW46Ci0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7CiAJaW50ZWxfZ3RfZmx1c2hfZ2d0dF93cml0ZXMoZ2d0dC0+dm0uZ3QpOwogCWlm
IChkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJm5vZGUpKSB7CiAJCWdndHQtPnZtLmNsZWFyX3Jhbmdl
KCZnZ3R0LT52bSwgbm9kZS5zdGFydCwgbm9kZS5zaXplKTsKLQkJcmVtb3ZlX21hcHBhYmxlX25v
ZGUoJm5vZGUpOworCQlyZW1vdmVfbWFwcGFibGVfbm9kZShnZ3R0LCAmbm9kZSk7CiAJfSBlbHNl
IHsKIAkJaTkxNV92bWFfdW5waW4odm1hKTsKIAl9CiBvdXRfcnBtOgogCWludGVsX3J1bnRpbWVf
cG1fcHV0KHJwbSwgd2FrZXJlZik7Ci1vdXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIHJldDsKIH0KIApAQCAtOTY3LDggKzk2NCw2IEBA
IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2Jq
LAogCXN0cnVjdCBpOTE1X3ZtYSAqdm1hOwogCWludCByZXQ7CiAKLQlsb2NrZGVwX2Fzc2VydF9o
ZWxkKCZvYmotPmJhc2UuZGV2LT5zdHJ1Y3RfbXV0ZXgpOwotCiAJaWYgKGZsYWdzICYgUElOX01B
UFBBQkxFICYmCiAJICAgICghdmlldyB8fCB2aWV3LT50eXBlID09IEk5MTVfR0dUVF9WSUVXX05P
Uk1BTCkpIHsKIAkJLyogSWYgdGhlIHJlcXVpcmVkIHNwYWNlIGlzIGxhcmdlciB0aGFuIHRoZSBh
dmFpbGFibGUKQEAgLTEwMjIsNyArMTAxNyw5IEBAIGk5MTVfZ2VtX29iamVjdF9nZ3R0X3Bpbihz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkgICAgIGk5MTVfZ2d0dF9vZmZzZXQo
dm1hKSwgYWxpZ25tZW50LAogCQkgICAgICEhKGZsYWdzICYgUElOX01BUFBBQkxFKSwKIAkJICAg
ICBpOTE1X3ZtYV9pc19tYXBfYW5kX2ZlbmNlYWJsZSh2bWEpKTsKKwkJbXV0ZXhfbG9jaygmdm1h
LT52bS0+bXV0ZXgpOwogCQlyZXQgPSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJbXV0ZXhfdW5s
b2NrKCZ2bWEtPnZtLT5tdXRleCk7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gRVJSX1BUUihyZXQp
OwogCX0KQEAgLTEzMjgsNyArMTMyNSw5IEBAIHN0YXRpYyBpbnQgX19pbnRlbF9lbmdpbmVzX3Jl
Y29yZF9kZWZhdWx0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkJICogZnJvbSB0
aGUgR1RUIHRvIHByZXZlbnQgc3VjaCBhY2NpZGVudHMgYW5kIHJlY2xhaW0gdGhlCiAJCSAqIHNw
YWNlLgogCQkgKi8KKwkJbXV0ZXhfbG9jaygmc3RhdGUtPnZtLT5tdXRleCk7CiAJCWVyciA9IGk5
MTVfdm1hX3VuYmluZChzdGF0ZSk7CisJCW11dGV4X3VubG9jaygmc3RhdGUtPnZtLT5tdXRleCk7
CiAJCWlmIChlcnIpCiAJCQlnb3RvIG91dDsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW1fZXZpY3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2V2
aWN0LmMKaW5kZXggN2FiY2FjM2I1ZTJlLi40NGY1YjYzOGZhNDMgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2V2aWN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW1fZXZpY3QuYwpAQCAtNDcsOCArNDcsNyBAQCBzdGF0aWMgaW50IGdndHRfZmx1
c2goc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAJICogYm91bmQgYnkgdGhlaXIgYWN0
aXZlIHJlZmVyZW5jZS4KIAkgKi8KIAlyZXR1cm4gaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShpOTE1
LAotCQkJCSAgICAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFIHwKLQkJCQkgICAgICBJOTE1X1dB
SVRfTE9DS0VELAorCQkJCSAgICAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFLAogCQkJCSAgICAg
IE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKIH0KIApAQCAtMTA0LDcgKzEwMyw3IEBAIGk5MTVfZ2Vt
X2V2aWN0X3NvbWV0aGluZyhzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAlzdHJ1Y3Qg
aTkxNV92bWEgKmFjdGl2ZTsKIAlpbnQgcmV0OwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmdm0t
Pmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5tdXRl
eCk7CiAJdHJhY2VfaTkxNV9nZW1fZXZpY3Qodm0sIG1pbl9zaXplLCBhbGlnbm1lbnQsIGZsYWdz
KTsKIAogCS8qCkBAIC0xMjcsMTUgKzEyNiw2IEBAIGk5MTVfZ2VtX2V2aWN0X3NvbWV0aGluZyhz
dHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAkJCQkgICAgbWluX3NpemUsIGFsaWdubWVu
dCwgY2FjaGVfbGV2ZWwsCiAJCQkJICAgIHN0YXJ0LCBlbmQsIG1vZGUpOwogCi0JLyoKLQkgKiBS
ZXRpcmUgYmVmb3JlIHdlIHNlYXJjaCB0aGUgYWN0aXZlIGxpc3QuIEFsdGhvdWdoIHdlIGhhdmUK
LQkgKiByZWFzb25hYmxlIGFjY3VyYWN5IGluIG91ciByZXRpcmVtZW50IGxpc3RzLCB3ZSBtYXkg
aGF2ZQotCSAqIGEgc3RyYXkgcGluIChwcmV2ZW50aW5nIGV2aWN0aW9uKSB0aGF0IGNhbiBvbmx5
IGJlIHJlc29sdmVkIGJ5Ci0JICogcmV0aXJpbmcuCi0JICovCi0JaWYgKCEoZmxhZ3MgJiBQSU5f
Tk9OQkxPQ0spKQotCQlpOTE1X3JldGlyZV9yZXF1ZXN0cyhkZXZfcHJpdik7Ci0KIHNlYXJjaF9h
Z2FpbjoKIAlhY3RpdmUgPSBOVUxMOwogCUlOSVRfTElTVF9IRUFEKCZldmljdGlvbl9saXN0KTsK
QEAgLTI2OSw3ICsyNTksNyBAQCBpbnQgaTkxNV9nZW1fZXZpY3RfZm9yX25vZGUoc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqdm0sCiAJYm9vbCBjaGVja19jb2xvcjsKIAlpbnQgcmV0ID0gMDsK
IAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwls
b2NrZGVwX2Fzc2VydF9oZWxkKCZ2bS0+bXV0ZXgpOwogCUdFTV9CVUdfT04oIUlTX0FMSUdORUQo
c3RhcnQsIEk5MTVfR1RUX1BBR0VfU0laRSkpOwogCUdFTV9CVUdfT04oIUlTX0FMSUdORUQoZW5k
LCBJOTE1X0dUVF9QQUdFX1NJWkUpKTsKIApAQCAtMzc1LDcgKzM2NSw3IEBAIGludCBpOTE1X2dl
bV9ldmljdF92bShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSkKIAlzdHJ1Y3QgaTkxNV92
bWEgKnZtYSwgKm5leHQ7CiAJaW50IHJldDsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5p
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bS0+bXV0ZXgp
OwogCXRyYWNlX2k5MTVfZ2VtX2V2aWN0X3ZtKHZtKTsKIAogCS8qIFN3aXRjaCBiYWNrIHRvIHRo
ZSBkZWZhdWx0IGNvbnRleHQgaW4gb3JkZXIgdG8gdW5waW4KQEAgLTM5MCw3ICszODAsNiBAQCBp
bnQgaTkxNV9nZW1fZXZpY3Rfdm0oc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiAJfQog
CiAJSU5JVF9MSVNUX0hFQUQoJmV2aWN0aW9uX2xpc3QpOwotCW11dGV4X2xvY2soJnZtLT5tdXRl
eCk7CiAJbGlzdF9mb3JfZWFjaF9lbnRyeSh2bWEsICZ2bS0+Ym91bmRfbGlzdCwgdm1fbGluaykg
ewogCQlpZiAoaTkxNV92bWFfaXNfcGlubmVkKHZtYSkpCiAJCQljb250aW51ZTsKQEAgLTM5OCw3
ICszODcsNiBAQCBpbnQgaTkxNV9nZW1fZXZpY3Rfdm0oc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZSAqdm0pCiAJCV9faTkxNV92bWFfcGluKHZtYSk7CiAJCWxpc3RfYWRkKCZ2bWEtPmV2aWN0X2xp
bmssICZldmljdGlvbl9saXN0KTsKIAl9Ci0JbXV0ZXhfdW5sb2NrKCZ2bS0+bXV0ZXgpOwogCiAJ
cmV0ID0gMDsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUodm1hLCBuZXh0LCAmZXZpY3Rpb25f
bGlzdCwgZXZpY3RfbGluaykgewpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9nZW1fZmVuY2VfcmVnLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9mZW5jZV9y
ZWcuYwppbmRleCA2MTVhOWY0ZWYzMGMuLjFlOTNmMmFhZmM4MCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZmVuY2VfcmVnLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW1fZmVuY2VfcmVnLmMKQEAgLTMzMSwxMyArMzMxLDE1IEBAIHN0YXRpYyBz
dHJ1Y3QgaTkxNV9mZW5jZV9yZWcgKmZlbmNlX2ZpbmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUpCiAJcmV0dXJuIEVSUl9QVFIoLUVERUFETEspOwogfQogCi1zdGF0aWMgaW50IF9faTkx
NV92bWFfcGluX2ZlbmNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQoraW50IF9faTkxNV92bWFfcGlu
X2ZlbmNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewogCXN0cnVjdCBpOTE1X2dndHQgKmdndHQg
PSBpOTE1X3ZtX3RvX2dndHQodm1hLT52bSk7CiAJc3RydWN0IGk5MTVfZmVuY2VfcmVnICpmZW5j
ZTsKIAlzdHJ1Y3QgaTkxNV92bWEgKnNldCA9IGk5MTVfZ2VtX29iamVjdF9pc190aWxlZCh2bWEt
Pm9iaikgPyB2bWEgOiBOVUxMOwogCWludCBlcnI7CiAKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2
bWEtPnZtLT5tdXRleCk7CisKIAkvKiBKdXN0IHVwZGF0ZSBvdXIgcGxhY2UgaW4gdGhlIExSVSBp
ZiBvdXIgZmVuY2UgaXMgZ2V0dGluZyByZXVzZWQuICovCiAJaWYgKHZtYS0+ZmVuY2UpIHsKIAkJ
ZmVuY2UgPSB2bWEtPmZlbmNlOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ndHQuYwppbmRleCAx
MDU0NWM2NGUyN2YuLmM5MDRiNzg4NTUyMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9nZW1fZ3R0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0
LmMKQEAgLTE1MCwxNiArMTUwLDE4IEBAIHN0YXRpYyB2b2lkIGdtY2hfZ2d0dF9pbnZhbGlkYXRl
KHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiAKIHN0YXRpYyBpbnQgcHBndHRfYmluZF92bWEoc3Ry
dWN0IGk5MTVfdm1hICp2bWEsCiAJCQkgIGVudW0gaTkxNV9jYWNoZV9sZXZlbCBjYWNoZV9sZXZl
bCwKLQkJCSAgdTMyIHVudXNlZCkKKwkJCSAgdTMyIGZsYWdzKQogewogCXUzMiBwdGVfZmxhZ3M7
CiAJaW50IGVycjsKIAotCWlmICghaTkxNV92bWFfaXNfYm91bmQodm1hLCBJOTE1X1ZNQV9MT0NB
TF9CSU5EKSkgeworCWlmIChmbGFncyAmIEk5MTVfVk1BX0FMTE9DKSB7CiAJCWVyciA9IHZtYS0+
dm0tPmFsbG9jYXRlX3ZhX3JhbmdlKHZtYS0+dm0sCiAJCQkJCQkgdm1hLT5ub2RlLnN0YXJ0LCB2
bWEtPnNpemUpOwogCQlpZiAoZXJyKQogCQkJcmV0dXJuIGVycjsKKworCQlzZXRfYml0KEk5MTVf
Vk1BX0FMTE9DX0JJVCwgX19pOTE1X3ZtYV9mbGFncyh2bWEpKTsKIAl9CiAKIAkvKiBBcHBsaWNh
YmxlIHRvIFZMViwgYW5kIGdlbjgrICovCkBAIC0xNjcsNiArMTY5LDcgQEAgc3RhdGljIGludCBw
cGd0dF9iaW5kX3ZtYShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAlpZiAoaTkxNV9nZW1fb2JqZWN0
X2lzX3JlYWRvbmx5KHZtYS0+b2JqKSkKIAkJcHRlX2ZsYWdzIHw9IFBURV9SRUFEX09OTFk7CiAK
KwlHRU1fQlVHX09OKCF0ZXN0X2JpdChJOTE1X1ZNQV9BTExPQ19CSVQsIF9faTkxNV92bWFfZmxh
Z3Modm1hKSkpOwogCXZtYS0+dm0tPmluc2VydF9lbnRyaWVzKHZtYS0+dm0sIHZtYSwgY2FjaGVf
bGV2ZWwsIHB0ZV9mbGFncyk7CiAJd21iKCk7CiAKQEAgLTE3NSw3ICsxNzgsOCBAQCBzdGF0aWMg
aW50IHBwZ3R0X2JpbmRfdm1hKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCiBzdGF0aWMgdm9pZCBw
cGd0dF91bmJpbmRfdm1hKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewotCXZtYS0+dm0tPmNsZWFy
X3JhbmdlKHZtYS0+dm0sIHZtYS0+bm9kZS5zdGFydCwgdm1hLT5zaXplKTsKKwlpZiAodGVzdF9h
bmRfY2xlYXJfYml0KEk5MTVfVk1BX0FMTE9DX0JJVCwgX19pOTE1X3ZtYV9mbGFncyh2bWEpKSkK
KwkJdm1hLT52bS0+Y2xlYXJfcmFuZ2Uodm1hLT52bSwgdm1hLT5ub2RlLnN0YXJ0LCB2bWEtPnNp
emUpOwogfQogCiBzdGF0aWMgaW50IHBwZ3R0X3NldF9wYWdlcyhzdHJ1Y3QgaTkxNV92bWEgKnZt
YSkKQEAgLTUwMywxNSArNTA3LDI1IEBAIHN0YXRpYyB2b2lkIGk5MTVfYWRkcmVzc19zcGFjZV9m
aW5pKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtKQogCW11dGV4X2Rlc3Ryb3koJnZtLT5t
dXRleCk7CiB9CiAKLXN0YXRpYyB2b2lkIHBwZ3R0X2Rlc3Ryb3lfdm1hKHN0cnVjdCBpOTE1X2Fk
ZHJlc3Nfc3BhY2UgKnZtKQordm9pZCBfX2k5MTVfdm1fY2xvc2Uoc3RydWN0IGk5MTVfYWRkcmVz
c19zcGFjZSAqdm0pCiB7CiAJc3RydWN0IGk5MTVfdm1hICp2bWEsICp2bjsKIAotCW11dGV4X2xv
Y2soJnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5X3Nh
ZmUodm1hLCB2biwgJnZtLT5ib3VuZF9saXN0LCB2bV9saW5rKQorCW11dGV4X2xvY2soJnZtLT5t
dXRleCk7CisJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHZtYSwgdm4sICZ2bS0+Ym91bmRfbGlz
dCwgdm1fbGluaykgeworCQlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqID0gdm1hLT5v
Ymo7CisKKwkJaWYgKCFrcmVmX2dldF91bmxlc3NfemVybygmb2JqLT5iYXNlLnJlZmNvdW50KSkK
KwkJCWNvbnRpbnVlOworCisJCWF0b21pY19hbmQofkk5MTVfVk1BX1BJTl9NQVNLLCAmdm1hLT5m
bGFncyk7CisJCVdBUk5fT04oaTkxNV92bWFfdW5iaW5kKHZtYSkpOwogCQlpOTE1X3ZtYV9kZXN0
cm95KHZtYSk7CisKKwkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOworCX0KIAlHRU1fQlVHX09O
KCFsaXN0X2VtcHR5KCZ2bS0+Ym91bmRfbGlzdCkpOwotCW11dGV4X3VubG9jaygmdm0tPmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X3VubG9jaygmdm0tPm11dGV4KTsKIH0KIAogc3Rh
dGljIHZvaWQgX19pOTE1X3ZtX3JlbGVhc2Uoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQpAQCAt
NTE5LDggKzUzMyw2IEBAIHN0YXRpYyB2b2lkIF9faTkxNV92bV9yZWxlYXNlKHN0cnVjdCB3b3Jr
X3N0cnVjdCAqd29yaykKIAlzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSA9CiAJCWNvbnRh
aW5lcl9vZih3b3JrLCBzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlLCByY3Uud29yayk7CiAKLQlw
cGd0dF9kZXN0cm95X3ZtYSh2bSk7Ci0KIAl2bS0+Y2xlYW51cCh2bSk7CiAJaTkxNV9hZGRyZXNz
X3NwYWNlX2Zpbmkodm0pOwogCkBAIC01MzUsNyArNTQ3LDYgQEAgdm9pZCBpOTE1X3ZtX3JlbGVh
c2Uoc3RydWN0IGtyZWYgKmtyZWYpCiAJR0VNX0JVR19PTihpOTE1X2lzX2dndHQodm0pKTsKIAl0
cmFjZV9pOTE1X3BwZ3R0X3JlbGVhc2Uodm0pOwogCi0Jdm0tPmNsb3NlZCA9IHRydWU7CiAJcXVl
dWVfcmN1X3dvcmsodm0tPmk5MTUtPndxLCAmdm0tPnJjdSk7CiB9CiAKQEAgLTU0Myw2ICs1NTQs
NyBAQCBzdGF0aWMgdm9pZCBpOTE1X2FkZHJlc3Nfc3BhY2VfaW5pdChzdHJ1Y3QgaTkxNV9hZGRy
ZXNzX3NwYWNlICp2bSwgaW50IHN1YmNsYXNzKQogewogCWtyZWZfaW5pdCgmdm0tPnJlZik7CiAJ
SU5JVF9SQ1VfV09SSygmdm0tPnJjdSwgX19pOTE1X3ZtX3JlbGVhc2UpOworCWF0b21pY19zZXQo
JnZtLT5vcGVuLCAxKTsKIAogCS8qCiAJICogVGhlIHZtLT5tdXRleCBtdXN0IGJlIHJlY2xhaW0g
c2FmZSAoZm9yIHVzZSBpbiB0aGUgc2hyaW5rZXIpLgpAQCAtMTc2OSwxMiArMTc4MSw4IEBAIHN0
YXRpYyB2b2lkIGdlbjZfcHBndHRfZnJlZV9wZChzdHJ1Y3QgZ2VuNl9wcGd0dCAqcHBndHQpCiBz
dGF0aWMgdm9pZCBnZW42X3BwZ3R0X2NsZWFudXAoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAq
dm0pCiB7CiAJc3RydWN0IGdlbjZfcHBndHQgKnBwZ3R0ID0gdG9fZ2VuNl9wcGd0dChpOTE1X3Zt
X3RvX3BwZ3R0KHZtKSk7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB2bS0+aTkx
NTsKIAotCS8qIEZJWE1FIHJlbW92ZSB0aGUgc3RydWN0X211dGV4IHRvIGJyaW5nIHRoZSBsb2Nr
aW5nIHVuZGVyIGNvbnRyb2wgKi8KLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKIAlpOTE1X3ZtYV9kZXN0cm95KHBwZ3R0LT52bWEpOwotCW11dGV4X3VubG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlnZW42X3BwZ3R0X2ZyZWVfcGQocHBndHQpOwogCWZyZWVf
c2NyYXRjaCh2bSk7CkBAIC0xODYxLDcgKzE4NjksNyBAQCBzdGF0aWMgc3RydWN0IGk5MTVfdm1h
ICpwZF92bWFfY3JlYXRlKHN0cnVjdCBnZW42X3BwZ3R0ICpwcGd0dCwgaW50IHNpemUpCiAKIAlp
OTE1X2FjdGl2ZV9pbml0KGk5MTUsICZ2bWEtPmFjdGl2ZSwgTlVMTCwgTlVMTCk7CiAKLQl2bWEt
PnZtID0gJmdndHQtPnZtOworCXZtYS0+dm0gPSBpOTE1X3ZtX2dldCgmZ2d0dC0+dm0pOwogCXZt
YS0+b3BzID0gJnBkX3ZtYV9vcHM7CiAJdm1hLT5wcml2YXRlID0gcHBndHQ7CiAKQEAgLTE4ODEs
NyArMTg4OSw3IEBAIGludCBnZW42X3BwZ3R0X3BpbihzdHJ1Y3QgaTkxNV9wcGd0dCAqYmFzZSkK
IAlzdHJ1Y3QgZ2VuNl9wcGd0dCAqcHBndHQgPSB0b19nZW42X3BwZ3R0KGJhc2UpOwogCWludCBl
cnI7CiAKLQlHRU1fQlVHX09OKHBwZ3R0LT5iYXNlLnZtLmNsb3NlZCk7CisJR0VNX0JVR19PTigh
YXRvbWljX3JlYWQoJnBwZ3R0LT5iYXNlLnZtLm9wZW4pKTsKIAogCS8qCiAJICogV29ya2Fyb3Vu
ZCB0aGUgbGltaXRlZCBtYXhpbXVtIHZtYS0+cGluX2NvdW50IGFuZCB0aGUgYWxpYXNpbmdfcHBn
dHQKQEAgLTI0NTcsMTQgKzI0NjUsMTggQEAgc3RhdGljIGludCBhbGlhc2luZ19ndHRfYmluZF92
bWEoc3RydWN0IGk5MTVfdm1hICp2bWEsCiAJaWYgKGZsYWdzICYgSTkxNV9WTUFfTE9DQUxfQklO
RCkgewogCQlzdHJ1Y3QgaTkxNV9wcGd0dCAqYWxpYXMgPSBpOTE1X3ZtX3RvX2dndHQodm1hLT52
bSktPmFsaWFzOwogCi0JCWlmICghaTkxNV92bWFfaXNfYm91bmQodm1hLCBJOTE1X1ZNQV9MT0NB
TF9CSU5EKSkgeworCQlpZiAoZmxhZ3MgJiBJOTE1X1ZNQV9BTExPQykgewogCQkJcmV0ID0gYWxp
YXMtPnZtLmFsbG9jYXRlX3ZhX3JhbmdlKCZhbGlhcy0+dm0sCiAJCQkJCQkJICB2bWEtPm5vZGUu
c3RhcnQsCiAJCQkJCQkJICB2bWEtPnNpemUpOwogCQkJaWYgKHJldCkKIAkJCQlyZXR1cm4gcmV0
OworCisJCQlzZXRfYml0KEk5MTVfVk1BX0FMTE9DX0JJVCwgX19pOTE1X3ZtYV9mbGFncyh2bWEp
KTsKIAkJfQogCisJCUdFTV9CVUdfT04oIXRlc3RfYml0KEk5MTVfVk1BX0FMTE9DX0JJVCwKKwkJ
CQkgICAgIF9faTkxNV92bWFfZmxhZ3Modm1hKSkpOwogCQlhbGlhcy0+dm0uaW5zZXJ0X2VudHJp
ZXMoJmFsaWFzLT52bSwgdm1hLAogCQkJCQkgY2FjaGVfbGV2ZWwsIHB0ZV9mbGFncyk7CiAJfQpA
QCAtMjU5NCwyMiArMjYwNiwxNiBAQCBzdGF0aWMgaW50IGluaXRfYWxpYXNpbmdfcHBndHQoc3Ry
dWN0IGk5MTVfZ2d0dCAqZ2d0dCkKIAogc3RhdGljIHZvaWQgZmluaV9hbGlhc2luZ19wcGd0dChz
dHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1
ID0gZ2d0dC0+dm0uaTkxNTsKIAlzdHJ1Y3QgaTkxNV9wcGd0dCAqcHBndHQ7CiAKLQltdXRleF9s
b2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCXBwZ3R0ID0gZmV0Y2hfYW5kX3plcm8o
JmdndHQtPmFsaWFzKTsKIAlpZiAoIXBwZ3R0KQotCQlnb3RvIG91dDsKKwkJcmV0dXJuOwogCiAJ
aTkxNV92bV9wdXQoJnBwZ3R0LT52bSk7CiAKIAlnZ3R0LT52bS52bWFfb3BzLmJpbmRfdm1hICAg
PSBnZ3R0X2JpbmRfdm1hOwogCWdndHQtPnZtLnZtYV9vcHMudW5iaW5kX3ZtYSA9IGdndHRfdW5i
aW5kX3ZtYTsKLQotb3V0OgotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiB9CiAKIHN0YXRpYyBpbnQgZ2d0dF9yZXNlcnZlX2d1Y190b3Aoc3RydWN0IGk5MTVfZ2d0dCAq
Z2d0dCkKQEAgLTI3MjYsMTUgKzI3MzIsMTQgQEAgaW50IGk5MTVfaW5pdF9nZ3R0KHN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1KQogCiBzdGF0aWMgdm9pZCBnZ3R0X2NsZWFudXBfaHcoc3Ry
dWN0IGk5MTVfZ2d0dCAqZ2d0dCkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IGdndHQtPnZtLmk5MTU7CiAJc3RydWN0IGk5MTVfdm1hICp2bWEsICp2bjsKIAotCWdndHQtPnZt
LmNsb3NlZCA9IHRydWU7CisJYXRvbWljX3NldCgmZ2d0dC0+dm0ub3BlbiwgMCk7CiAKIAlyY3Vf
YmFycmllcigpOyAvKiBmbHVzaCB0aGUgUkNVJ2VkX19pOTE1X3ZtX3JlbGVhc2UgKi8KLQlmbHVz
aF93b3JrcXVldWUoaTkxNS0+d3EpOworCWZsdXNoX3dvcmtxdWV1ZShnZ3R0LT52bS5pOTE1LT53
cSk7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwltdXRleF9sb2Nr
KCZnZ3R0LT52bS5tdXRleCk7CiAKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUodm1hLCB2biwg
JmdndHQtPnZtLmJvdW5kX2xpc3QsIHZtX2xpbmspCiAJCVdBUk5fT04oaTkxNV92bWFfdW5iaW5k
KHZtYSkpOwpAQCAtMjc0MywxNSArMjc0OCwxMiBAQCBzdGF0aWMgdm9pZCBnZ3R0X2NsZWFudXBf
aHcoc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCkKIAkJZHJtX21tX3JlbW92ZV9ub2RlKCZnZ3R0LT5l
cnJvcl9jYXB0dXJlKTsKIAogCWdndHRfcmVsZWFzZV9ndWNfdG9wKGdndHQpOwotCi0JaWYgKGRy
bV9tbV9pbml0aWFsaXplZCgmZ2d0dC0+dm0ubW0pKSB7Ci0JCWludGVsX3ZndF9kZWJhbGxvb24o
Z2d0dCk7Ci0JCWk5MTVfYWRkcmVzc19zcGFjZV9maW5pKCZnZ3R0LT52bSk7Ci0JfQorCWludGVs
X3ZndF9kZWJhbGxvb24oZ2d0dCk7CiAKIAlnZ3R0LT52bS5jbGVhbnVwKCZnZ3R0LT52bSk7CiAK
LQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworCW11dGV4X3VubG9jaygm
Z2d0dC0+dm0ubXV0ZXgpOworCWk5MTVfYWRkcmVzc19zcGFjZV9maW5pKCZnZ3R0LT52bSk7CiAK
IAlhcmNoX3BoeXNfd2NfZGVsKGdndHQtPm10cnIpOwogCWlvX21hcHBpbmdfZmluaSgmZ2d0dC0+
aW9tYXApOwpAQCAtMzE4MCw5ICszMTgyLDYgQEAgaW50IGk5MTVfZ2d0dF9wcm9iZV9odyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHN0YXRpYyBpbnQgZ2d0dF9pbml0X2h3KHN0cnVj
dCBpOTE1X2dndHQgKmdndHQpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBn
Z3R0LT52bS5pOTE1OwotCWludCByZXQgPSAwOwotCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CiAKIAlpOTE1X2FkZHJlc3Nfc3BhY2VfaW5pdCgmZ2d0dC0+dm0sIFZNX0NM
QVNTX0dHVFQpOwogCkBAIC0zMTk4LDE4ICszMTk3LDE0IEBAIHN0YXRpYyBpbnQgZ2d0dF9pbml0
X2h3KHN0cnVjdCBpOTE1X2dndHQgKmdndHQpCiAJCQkJZ2d0dC0+Z21hZHIuc3RhcnQsCiAJCQkJ
Z2d0dC0+bWFwcGFibGVfZW5kKSkgewogCQlnZ3R0LT52bS5jbGVhbnVwKCZnZ3R0LT52bSk7Ci0J
CXJldCA9IC1FSU87Ci0JCWdvdG8gb3V0OworCQlyZXR1cm4gLUVJTzsKIAl9CiAKIAlnZ3R0LT5t
dHJyID0gYXJjaF9waHlzX3djX2FkZChnZ3R0LT5nbWFkci5zdGFydCwgZ2d0dC0+bWFwcGFibGVf
ZW5kKTsKIAogCWk5MTVfZ2d0dF9pbml0X2ZlbmNlcyhnZ3R0KTsKIAotb3V0OgotCW11dGV4X3Vu
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KLQlyZXR1cm4gcmV0OworCXJldHVybiAw
OwogfQogCiAvKioKQEAgLTMyODEsNiArMzI3Niw3IEBAIHN0YXRpYyB2b2lkIGdndHRfcmVzdG9y
ZV9tYXBwaW5ncyhzdHJ1Y3QgaTkxNV9nZ3R0ICpnZ3R0KQogewogCXN0cnVjdCBpOTE1X3ZtYSAq
dm1hLCAqdm47CiAJYm9vbCBmbHVzaCA9IGZhbHNlOworCWludCBvcGVuOwogCiAJaW50ZWxfZ3Rf
Y2hlY2tfYW5kX2NsZWFyX2ZhdWx0cyhnZ3R0LT52bS5ndCk7CiAKQEAgLTMyODgsNyArMzI4NCw5
IEBAIHN0YXRpYyB2b2lkIGdndHRfcmVzdG9yZV9tYXBwaW5ncyhzdHJ1Y3QgaTkxNV9nZ3R0ICpn
Z3R0KQogCiAJLyogRmlyc3QgZmlsbCBvdXIgcG9ydGlvbiBvZiB0aGUgR1RUIHdpdGggc2NyYXRj
aCBwYWdlcyAqLwogCWdndHQtPnZtLmNsZWFyX3JhbmdlKCZnZ3R0LT52bSwgMCwgZ2d0dC0+dm0u
dG90YWwpOwotCWdndHQtPnZtLmNsb3NlZCA9IHRydWU7IC8qIHNraXAgcmV3cml0aW5nIFBURSBv
biBWTUEgdW5iaW5kICovCisKKwkvKiBTa2lwIHJld3JpdGluZyBQVEUgb24gVk1BIHVuYmluZC4g
Ki8KKwlvcGVuID0gYXRvbWljX3hjaGcoJmdndHQtPnZtLm9wZW4sIDApOwogCiAJLyogY2xmbHVz
aCBvYmplY3RzIGJvdW5kIGludG8gdGhlIEdHVFQgYW5kIHJlYmluZCB0aGVtLiAqLwogCWxpc3Rf
Zm9yX2VhY2hfZW50cnlfc2FmZSh2bWEsIHZuLCAmZ2d0dC0+dm0uYm91bmRfbGlzdCwgdm1fbGlu
aykgewpAQCAtMzI5NywyNCArMzI5NSwxOSBAQCBzdGF0aWMgdm9pZCBnZ3R0X3Jlc3RvcmVfbWFw
cGluZ3Moc3RydWN0IGk5MTVfZ2d0dCAqZ2d0dCkKIAkJaWYgKCFpOTE1X3ZtYV9pc19ib3VuZCh2
bWEsIEk5MTVfVk1BX0dMT0JBTF9CSU5EKSkKIAkJCWNvbnRpbnVlOwogCi0JCW11dGV4X3VubG9j
aygmZ2d0dC0+dm0ubXV0ZXgpOwotCiAJCWlmICghaTkxNV92bWFfdW5iaW5kKHZtYSkpCi0JCQln
b3RvIGxvY2s7CisJCQljb250aW51ZTsKIAogCQlXQVJOX09OKGk5MTVfdm1hX2JpbmQodm1hLAog
CQkJCSAgICAgIG9iaiA/IG9iai0+Y2FjaGVfbGV2ZWwgOiAwLAotCQkJCSAgICAgIFBJTl9VUERB
VEUpKTsKKwkJCQkgICAgICBQSU5fVVBEQVRFLCBOVUxMKSk7CiAJCWlmIChvYmopIHsgLyogb25s
eSB1c2VkIGR1cmluZyByZXN1bWUgPT4gZXhjbHVzaXZlIGFjY2VzcyAqLwogCQkJZmx1c2ggfD0g
ZmV0Y2hfYW5kX3plcm8oJm9iai0+d3JpdGVfZG9tYWluKTsKIAkJCW9iai0+cmVhZF9kb21haW5z
IHw9IEk5MTVfR0VNX0RPTUFJTl9HVFQ7CiAJCX0KLQotbG9jazoKLQkJbXV0ZXhfbG9jaygmZ2d0
dC0+dm0ubXV0ZXgpOwogCX0KIAotCWdndHQtPnZtLmNsb3NlZCA9IGZhbHNlOworCWF0b21pY19z
ZXQoJmdndHQtPnZtLm9wZW4sIG9wZW4pOwogCWdndHQtPmludmFsaWRhdGUoZ2d0dCk7CiAKIAlt
dXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKQEAgLTM3MDYsNyArMzY5OSw4IEBAIGludCBp
OTE1X2dlbV9ndHRfaW5zZXJ0KHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCXU2NCBv
ZmZzZXQ7CiAJaW50IGVycjsKIAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtLT5pOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKKwlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bS0+bXV0ZXgpOworCiAJR0VN
X0JVR19PTighc2l6ZSk7CiAJR0VNX0JVR19PTighSVNfQUxJR05FRChzaXplLCBJOTE1X0dUVF9Q
QUdFX1NJWkUpKTsKIAlHRU1fQlVHX09OKGFsaWdubWVudCAmJiAhaXNfcG93ZXJfb2ZfMihhbGln
bm1lbnQpKTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5o
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW1fZ3R0LmgKaW5kZXggNDZkOTE1ZDdmZmI4
Li5kMGU3ZTVmOWUxOWUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2Vt
X2d0dC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5oCkBAIC0zMDgs
NyArMzA4LDcgQEAgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSB7CiAJdW5zaWduZWQgaW50IGJp
bmRfYWxsb2M7CiAJdW5zaWduZWQgaW50IHNlcmlhbDsKIAotCWJvb2wgY2xvc2VkOworCWF0b21p
Y190IG9wZW47CiAKIAlzdHJ1Y3QgbXV0ZXggbXV0ZXg7IC8qIHByb3RlY3RzIHZtYSBhbmQgb3Vy
IGxpc3RzICovCiAjZGVmaW5lIFZNX0NMQVNTX0dHVFQgMApAQCAtNTc0LDYgKzU3NCwzNSBAQCBz
dGF0aWMgaW5saW5lIHZvaWQgaTkxNV92bV9wdXQoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAq
dm0pCiAJa3JlZl9wdXQoJnZtLT5yZWYsIGk5MTVfdm1fcmVsZWFzZSk7CiB9CiAKK3N0YXRpYyBp
bmxpbmUgc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqCitpOTE1X3ZtX29wZW4oc3RydWN0IGk5
MTVfYWRkcmVzc19zcGFjZSAqdm0pCit7CisJR0VNX0JVR19PTighYXRvbWljX3JlYWQoJnZtLT5v
cGVuKSk7CisJYXRvbWljX2luYygmdm0tPm9wZW4pOworCXJldHVybiBpOTE1X3ZtX2dldCh2bSk7
Cit9CisKK3N0YXRpYyBpbmxpbmUgYm9vbAoraTkxNV92bV90cnlvcGVuKHN0cnVjdCBpOTE1X2Fk
ZHJlc3Nfc3BhY2UgKnZtKQoreworCWlmIChhdG9taWNfYWRkX3VubGVzcygmdm0tPm9wZW4sIDEs
IDApKQorCQlyZXR1cm4gaTkxNV92bV9nZXQodm0pOworCisJcmV0dXJuIGZhbHNlOworfQorCit2
b2lkIF9faTkxNV92bV9jbG9zZShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSk7CisKK3N0
YXRpYyBpbmxpbmUgdm9pZAoraTkxNV92bV9jbG9zZShzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNl
ICp2bSkKK3sKKwlHRU1fQlVHX09OKCFhdG9taWNfcmVhZCgmdm0tPm9wZW4pKTsKKwlpZiAoYXRv
bWljX2RlY19hbmRfdGVzdCgmdm0tPm9wZW4pKQorCQlfX2k5MTVfdm1fY2xvc2Uodm0pOworCisJ
aTkxNV92bV9wdXQodm0pOworfQorCiBpbnQgZ2VuNl9wcGd0dF9waW4oc3RydWN0IGk5MTVfcHBn
dHQgKmJhc2UpOwogdm9pZCBnZW42X3BwZ3R0X3VucGluKHN0cnVjdCBpOTE1X3BwZ3R0ICpiYXNl
KTsKIHZvaWQgZ2VuNl9wcGd0dF91bnBpbl9hbGwoc3RydWN0IGk5MTVfcHBndHQgKmJhc2UpOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X3BlcmYuYwppbmRleCBlNDJiODY4MjdkNmIuLmU2YWE1NmQ4MmY5YiAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9wZXJmLmMKQEAgLTEyMDQsMTUgKzEyMDQsMTAgQEAgc3RhdGlj
IGludCBpOTE1X29hX3JlYWQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSwKIHN0YXRp
YyBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqb2FfcGluX2NvbnRleHQoc3RydWN0IGk5MTVfcGVyZl9z
dHJlYW0gKnN0cmVhbSkKIHsKIAlzdHJ1Y3QgaTkxNV9nZW1fZW5naW5lc19pdGVyIGl0OwotCXN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gc3RyZWFtLT5kZXZfcHJpdjsKIAlzdHJ1Y3Qg
aTkxNV9nZW1fY29udGV4dCAqY3R4ID0gc3RyZWFtLT5jdHg7CiAJc3RydWN0IGludGVsX2NvbnRl
eHQgKmNlOwogCWludCBlcnI7CiAKLQllcnIgPSBpOTE1X211dGV4X2xvY2tfaW50ZXJydXB0aWJs
ZSgmaTkxNS0+ZHJtKTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gRVJSX1BUUihlcnIpOwotCiAJZm9y
X2VhY2hfZ2VtX2VuZ2luZShjZSwgaTkxNV9nZW1fY29udGV4dF9sb2NrX2VuZ2luZXMoY3R4KSwg
aXQpIHsKIAkJaWYgKGNlLT5lbmdpbmUtPmNsYXNzICE9IFJFTkRFUl9DTEFTUykKIAkJCWNvbnRp
bnVlOwpAQCAtMTIyOSwxMCArMTIyNCw2IEBAIHN0YXRpYyBzdHJ1Y3QgaW50ZWxfY29udGV4dCAq
b2FfcGluX2NvbnRleHQoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIAl9CiAJaTkx
NV9nZW1fY29udGV4dF91bmxvY2tfZW5naW5lcyhjdHgpOwogCi0JbXV0ZXhfdW5sb2NrKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAoZXJyKQotCQlyZXR1cm4gRVJSX1BUUihlcnIpOwot
CiAJcmV0dXJuIHN0cmVhbS0+cGlubmVkX2N0eDsKIH0KIApAQCAtMTM0NywxNSArMTMzOCw5IEBA
IHN0YXRpYyB2b2lkIG9hX3B1dF9yZW5kZXJfY3R4X2lkKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFt
ICpzdHJlYW0pCiBzdGF0aWMgdm9pZAogZnJlZV9vYV9idWZmZXIoc3RydWN0IGk5MTVfcGVyZl9z
dHJlYW0gKnN0cmVhbSkKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHN0cmVh
bS0+ZGV2X3ByaXY7Ci0KLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQog
CWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZzdHJlYW0tPm9hX2J1ZmZlci52bWEsCiAJCQkJ
ICAgSTkxNV9WTUFfUkVMRUFTRV9NQVApOwogCi0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKLQogCXN0cmVhbS0+b2FfYnVmZmVyLnZhZGRyID0gTlVMTDsKIH0KIApAQCAt
MTUxMCwxOCArMTQ5NSwxMyBAQCBzdGF0aWMgaW50IGFsbG9jX29hX2J1ZmZlcihzdHJ1Y3QgaTkx
NV9wZXJmX3N0cmVhbSAqc3RyZWFtKQogCWlmIChXQVJOX09OKHN0cmVhbS0+b2FfYnVmZmVyLnZt
YSkpCiAJCXJldHVybiAtRU5PREVWOwogCi0JcmV0ID0gaTkxNV9tdXRleF9sb2NrX2ludGVycnVw
dGlibGUoJmRldl9wcml2LT5kcm0pOwotCWlmIChyZXQpCi0JCXJldHVybiByZXQ7Ci0KIAlCVUlM
RF9CVUdfT05fTk9UX1BPV0VSX09GXzIoT0FfQlVGRkVSX1NJWkUpOwogCUJVSUxEX0JVR19PTihP
QV9CVUZGRVJfU0laRSA8IFNaXzEyOEsgfHwgT0FfQlVGRkVSX1NJWkUgPiBTWl8xNk0pOwogCiAJ
Ym8gPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtKGRldl9wcml2LCBPQV9CVUZGRVJfU0la
RSk7CiAJaWYgKElTX0VSUihibykpIHsKIAkJRFJNX0VSUk9SKCJGYWlsZWQgdG8gYWxsb2NhdGUg
T0EgYnVmZmVyXG4iKTsKLQkJcmV0ID0gUFRSX0VSUihibyk7Ci0JCWdvdG8gdW5sb2NrOworCQly
ZXR1cm4gUFRSX0VSUihibyk7CiAJfQogCiAJaTkxNV9nZW1fb2JqZWN0X3NldF9jYWNoZV9jb2hl
cmVuY3koYm8sIEk5MTVfQ0FDSEVfTExDKTsKQEAgLTE1NDUsNyArMTUyNSw3IEBAIHN0YXRpYyBp
bnQgYWxsb2Nfb2FfYnVmZmVyKHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJlYW0pCiAJCQkg
aTkxNV9nZ3R0X29mZnNldChzdHJlYW0tPm9hX2J1ZmZlci52bWEpLAogCQkJIHN0cmVhbS0+b2Ff
YnVmZmVyLnZhZGRyKTsKIAotCWdvdG8gdW5sb2NrOworCXJldHVybiAwOwogCiBlcnJfdW5waW46
CiAJX19pOTE1X3ZtYV91bnBpbih2bWEpOwpAQCAtMTU1Niw4ICsxNTM2LDYgQEAgc3RhdGljIGlu
dCBhbGxvY19vYV9idWZmZXIoc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSkKIAlzdHJl
YW0tPm9hX2J1ZmZlci52YWRkciA9IE5VTEw7CiAJc3RyZWFtLT5vYV9idWZmZXIudm1hID0gTlVM
TDsKIAotdW5sb2NrOgotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwogCXJldHVybiByZXQ7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfdm1hLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jCmluZGV4IDg2NzJiZWE4
YWMwYy4uYWZkOWQ3YTM2YjJhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X3ZtYS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfdm1hLmMKQEAgLTMyLDYgKzMy
LDcgQEAKIAogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAjaW5jbHVkZSAiaTkxNV9nbG9iYWxzLmgi
CisjaW5jbHVkZSAiaTkxNV9zd19mZW5jZV93b3JrLmgiCiAjaW5jbHVkZSAiaTkxNV90cmFjZS5o
IgogI2luY2x1ZGUgImk5MTVfdm1hLmgiCiAKQEAgLTExMCw3ICsxMTEsNyBAQCB2bWFfY3JlYXRl
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJaWYgKHZtYSA9PSBOVUxMKQogCQly
ZXR1cm4gRVJSX1BUUigtRU5PTUVNKTsKIAotCXZtYS0+dm0gPSB2bTsKKwl2bWEtPnZtID0gaTkx
NV92bV9nZXQodm0pOwogCXZtYS0+b3BzID0gJnZtLT52bWFfb3BzOwogCXZtYS0+b2JqID0gb2Jq
OwogCXZtYS0+cmVzdiA9IG9iai0+YmFzZS5yZXN2OwpAQCAtMjYxLDggKzI2Miw2IEBAIHZtYV9s
b29rdXAoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKICAqIE9uY2UgY3JlYXRlZCwg
dGhlIFZNQSBpcyBrZXB0IHVudGlsIGVpdGhlciB0aGUgb2JqZWN0IGlzIGZyZWVkLCBvciB0aGUK
ICAqIGFkZHJlc3Mgc3BhY2UgaXMgY2xvc2VkLgogICoKLSAqIE11c3QgYmUgY2FsbGVkIHdpdGgg
c3RydWN0X211dGV4IGhlbGQuCi0gKgogICogUmV0dXJucyB0aGUgdm1hLCBvciBhbiBlcnJvciBw
b2ludGVyLgogICovCiBzdHJ1Y3QgaTkxNV92bWEgKgpAQCAtMjczLDcgKzI3Miw3IEBAIGk5MTVf
dm1hX2luc3RhbmNlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJc3RydWN0IGk5
MTVfdm1hICp2bWE7CiAKIAlHRU1fQlVHX09OKHZpZXcgJiYgIWk5MTVfaXNfZ2d0dCh2bSkpOwot
CUdFTV9CVUdfT04odm0tPmNsb3NlZCk7CisJR0VNX0JVR19PTighYXRvbWljX3JlYWQoJnZtLT5v
cGVuKSk7CiAKIAlzcGluX2xvY2soJm9iai0+dm1hLmxvY2spOwogCXZtYSA9IHZtYV9sb29rdXAo
b2JqLCB2bSwgdmlldyk7CkBAIC0yODcsMTggKzI4Niw2MyBAQCBpOTE1X3ZtYV9pbnN0YW5jZShz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCXJldHVybiB2bWE7CiB9CiAKK3N0cnVj
dCBpOTE1X3ZtYV93b3JrIHsKKwlzdHJ1Y3QgZG1hX2ZlbmNlX3dvcmsgYmFzZTsKKwlzdHJ1Y3Qg
aTkxNV92bWEgKnZtYTsKKwllbnVtIGk5MTVfY2FjaGVfbGV2ZWwgY2FjaGVfbGV2ZWw7CisJdW5z
aWduZWQgaW50IGZsYWdzOworfTsKKworc3RhdGljIGludCBfX3ZtYV9iaW5kKHN0cnVjdCBkbWFf
ZmVuY2Vfd29yayAqd29yaykKK3sKKwlzdHJ1Y3QgaTkxNV92bWFfd29yayAqdncgPSBjb250YWlu
ZXJfb2Yod29yaywgdHlwZW9mKCp2dyksIGJhc2UpOworCXN0cnVjdCBpOTE1X3ZtYSAqdm1hID0g
dnctPnZtYTsKKwlpbnQgZXJyOworCisJZXJyID0gdm1hLT5vcHMtPmJpbmRfdm1hKHZtYSwgdnct
PmNhY2hlX2xldmVsLCB2dy0+ZmxhZ3MpOworCWlmIChlcnIpCisJCWF0b21pY19vcihJOTE1X1ZN
QV9FUlJPUiwgJnZtYS0+ZmxhZ3MpOworCisJaWYgKHZtYS0+b2JqKQorCQlhdG9taWNfZGVjKCZ2
bWEtPm9iai0+bW0ucGFnZXNfcGluX2NvdW50KTsKKworCXJldHVybiBlcnI7Cit9CisKK3N0YXRp
YyBjb25zdCBzdHJ1Y3QgZG1hX2ZlbmNlX3dvcmtfb3BzIGJpbmRfb3BzID0geworCS5uYW1lID0g
ImJpbmQiLAorCS53b3JrID0gX192bWFfYmluZCwKK307CisKK3N0cnVjdCBpOTE1X3ZtYV93b3Jr
ICppOTE1X3ZtYV93b3JrKHZvaWQpCit7CisJc3RydWN0IGk5MTVfdm1hX3dvcmsgKnZ3OworCisJ
dncgPSBremFsbG9jKHNpemVvZigqdncpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIXZ3KQorCQlyZXR1
cm4gTlVMTDsKKworCWRtYV9mZW5jZV93b3JrX2luaXQoJnZ3LT5iYXNlLCAmYmluZF9vcHMpOwor
CXZ3LT5iYXNlLmRtYS5lcnJvciA9IC1FQUdBSU47IC8qIGRpc2FibGUgdGhlIHdvcmtlciBieSBk
ZWZhdWx0ICovCisKKwlyZXR1cm4gdnc7Cit9CisKIC8qKgogICogaTkxNV92bWFfYmluZCAtIFNl
dHMgdXAgUFRFcyBmb3IgYW4gVk1BIGluIGl0J3MgY29ycmVzcG9uZGluZyBhZGRyZXNzIHNwYWNl
LgogICogQHZtYTogVk1BIHRvIG1hcAogICogQGNhY2hlX2xldmVsOiBtYXBwaW5nIGNhY2hlIGxl
dmVsCiAgKiBAZmxhZ3M6IGZsYWdzIGxpa2UgZ2xvYmFsIG9yIGxvY2FsIG1hcHBpbmcKKyAqIEB3
b3JrOiBwcmVhbGxvY2F0ZWQgd29ya2VyIGZvciBhbGxvY2F0aW5nIGFuZCBiaW5kaW5nIHRoZSBQ
VEUKICAqCiAgKiBETUEgYWRkcmVzc2VzIGFyZSB0YWtlbiBmcm9tIHRoZSBzY2F0dGVyLWdhdGhl
ciB0YWJsZSBvZiB0aGlzIG9iamVjdCAob3Igb2YKICAqIHRoaXMgVk1BIGluIGNhc2Ugb2Ygbm9u
LWRlZmF1bHQgR0dUVCB2aWV3cykgYW5kIFBURSBlbnRyaWVzIHNldCB1cC4KICAqIE5vdGUgdGhh
dCBETUEgYWRkcmVzc2VzIGFyZSBhbHNvIHRoZSBvbmx5IHBhcnQgb2YgdGhlIFNHIHRhYmxlIHdl
IGNhcmUgYWJvdXQuCiAgKi8KLWludCBpOTE1X3ZtYV9iaW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1h
LCBlbnVtIGk5MTVfY2FjaGVfbGV2ZWwgY2FjaGVfbGV2ZWwsCi0JCSAgdTMyIGZsYWdzKQoraW50
IGk5MTVfdm1hX2JpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEsCisJCSAgZW51bSBpOTE1X2NhY2hl
X2xldmVsIGNhY2hlX2xldmVsLAorCQkgIHUzMiBmbGFncywKKwkJICBzdHJ1Y3QgaTkxNV92bWFf
d29yayAqd29yaykKIHsKIAl1MzIgYmluZF9mbGFnczsKIAl1MzIgdm1hX2ZsYWdzOwpAQCAtMzE1
LDExICszNTksOCBAQCBpbnQgaTkxNV92bWFfYmluZChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgZW51
bSBpOTE1X2NhY2hlX2xldmVsIGNhY2hlX2xldmVsLAogCWlmIChHRU1fREVCVUdfV0FSTl9PTigh
ZmxhZ3MpKQogCQlyZXR1cm4gLUVJTlZBTDsKIAotCWJpbmRfZmxhZ3MgPSAwOwotCWlmIChmbGFn
cyAmIFBJTl9HTE9CQUwpCi0JCWJpbmRfZmxhZ3MgfD0gSTkxNV9WTUFfR0xPQkFMX0JJTkQ7Ci0J
aWYgKGZsYWdzICYgUElOX1VTRVIpCi0JCWJpbmRfZmxhZ3MgfD0gSTkxNV9WTUFfTE9DQUxfQklO
RDsKKwliaW5kX2ZsYWdzID0gZmxhZ3M7CisJYmluZF9mbGFncyAmPSBJOTE1X1ZNQV9HTE9CQUxf
QklORCB8IEk5MTVfVk1BX0xPQ0FMX0JJTkQ7CiAKIAl2bWFfZmxhZ3MgPSBhdG9taWNfcmVhZCgm
dm1hLT5mbGFncyk7CiAJdm1hX2ZsYWdzICY9IEk5MTVfVk1BX0dMT0JBTF9CSU5EIHwgSTkxNV9W
TUFfTE9DQUxfQklORDsKQEAgLTMzMyw5ICszNzQsMzQgQEAgaW50IGk5MTVfdm1hX2JpbmQoc3Ry
dWN0IGk5MTVfdm1hICp2bWEsIGVudW0gaTkxNV9jYWNoZV9sZXZlbCBjYWNoZV9sZXZlbCwKIAlH
RU1fQlVHX09OKCF2bWEtPnBhZ2VzKTsKIAogCXRyYWNlX2k5MTVfdm1hX2JpbmQodm1hLCBiaW5k
X2ZsYWdzKTsKLQlyZXQgPSB2bWEtPm9wcy0+YmluZF92bWEodm1hLCBjYWNoZV9sZXZlbCwgYmlu
ZF9mbGFncyk7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKKwlpZiAod29yayAmJiAoYmluZF9m
bGFncyAmIH52bWFfZmxhZ3MpICYgdm1hLT52bS0+YmluZF9hbGxvYykgeworCQl3b3JrLT52bWEg
PSB2bWE7CisJCXdvcmstPmNhY2hlX2xldmVsID0gY2FjaGVfbGV2ZWw7CisJCXdvcmstPmZsYWdz
ID0gYmluZF9mbGFncyB8IEk5MTVfVk1BX0FMTE9DOworCisJCWlmICghaTkxNV92bWFfdHJ5bG9j
ayh2bWEpKQorCQkJcmV0dXJuIC1FQUdBSU47CisKKwkJLyoKKwkJICogTm90ZSB3ZSBvbmx5IHdh
bnQgdG8gY2hhaW4gdXAgdG8gdGhlIG1pZ3JhdGlvbiBmZW5jZSBvbgorCQkgKiB0aGUgcGFnZXMg
KG5vdCB0aGUgb2JqZWN0IGl0c2VsZikuIEFzIHdlIGRvbid0IHRyYWNrIHRoYXQsCisJCSAqIHll
dCwgd2UgaGF2ZSB0byB1c2UgdGhlIGV4Y2x1c2l2ZSBmZW5jZSBpbnN0ZWFkLgorCQkgKi8KKwkJ
ZG1hX2ZlbmNlX3dvcmtfY2hhaW4oJndvcmstPmJhc2UsIGRtYV9yZXN2X2dldF9leGNsKHZtYS0+
cmVzdikpOworCQlkbWFfcmVzdl9hZGRfZXhjbF9mZW5jZSh2bWEtPnJlc3YsICZ3b3JrLT5iYXNl
LmRtYSk7CisJCWk5MTVfdm1hX3VubG9jayh2bWEpOworCisJCWk5MTVfYWN0aXZlX3NldF9leGNs
dXNpdmUoJnZtYS0+YWN0aXZlLCAmd29yay0+YmFzZS5kbWEpOworCQl3b3JrLT5iYXNlLmRtYS5l
cnJvciA9IDA7IC8qIGVuYWJsZSB0aGUgcXVldWVfd29yaygpICovCisKKwkJaWYgKHZtYS0+b2Jq
KQorCQkJYXRvbWljX2luYygmdm1hLT5vYmotPm1tLnBhZ2VzX3Bpbl9jb3VudCk7CisJfSBlbHNl
IHsKKwkJR0VNX0JVR19PTigoYmluZF9mbGFncyAmIH52bWFfZmxhZ3MpICYgdm1hLT52bS0+Ymlu
ZF9hbGxvYyk7CisJCXJldCA9IHZtYS0+b3BzLT5iaW5kX3ZtYSh2bWEsIGNhY2hlX2xldmVsLCBi
aW5kX2ZsYWdzKTsKKwkJaWYgKHJldCkKKwkJCXJldHVybiByZXQ7CisJfQogCiAJLyogTXVzdCBi
ZSBpbmNyZW1lbnRlZCBwcmlvciB0byByZXF1ZXN0IGNvbnN0cnVjdGlvbiAqLwogCXZtYS0+dm0t
PnNlcmlhbCsrOwpAQCAtMzUxLDkgKzQxNyw3IEBAIHZvaWQgX19pb21lbSAqaTkxNV92bWFfcGlu
X2lvbWFwKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCiAJLyogQWNjZXNzIHRocm91Z2ggdGhlIEdU
VCByZXF1aXJlcyB0aGUgZGV2aWNlIHRvIGJlIGF3YWtlLiAqLwogCWFzc2VydF9ycG1fd2FrZWxv
Y2tfaGVsZCgmdm1hLT52bS0+aTkxNS0+cnVudGltZV9wbSk7Ci0KLQlsb2NrZGVwX2Fzc2VydF9o
ZWxkKCZ2bWEtPnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAoV0FSTl9PTighaTkx
NV92bWFfaXNfbWFwX2FuZF9mZW5jZWFibGUodm1hKSkpIHsKKwlpZiAoR0VNX1dBUk5fT04oIWk5
MTVfdm1hX2lzX21hcF9hbmRfZmVuY2VhYmxlKHZtYSkpKSB7CiAJCWVyciA9IC1FTk9ERVY7CiAJ
CWdvdG8gZXJyOwogCX0KQEAgLTM3MSw3ICs0MzUsOCBAQCB2b2lkIF9faW9tZW0gKmk5MTVfdm1h
X3Bpbl9pb21hcChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAkJCWdvdG8gZXJyOwogCQl9CiAKLQkJ
dm1hLT5pb21hcCA9IHB0cjsKKwkJaWYgKHVubGlrZWx5KGNtcHhjaGcoJnZtYS0+aW9tYXAsIE5V
TEwsIHB0cikpKQorCQkJaW9fbWFwcGluZ191bm1hcChwdHIpOwogCX0KIAogCV9faTkxNV92bWFf
cGluKHZtYSk7CkBAIC0zOTEsMTggKzQ1NiwxMiBAQCB2b2lkIF9faW9tZW0gKmk5MTVfdm1hX3Bp
bl9pb21hcChzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAogdm9pZCBpOTE1X3ZtYV9mbHVzaF93cml0
ZXMoc3RydWN0IGk5MTVfdm1hICp2bWEpCiB7Ci0JaWYgKCFpOTE1X3ZtYV9oYXNfZ2d0dF93cml0
ZSh2bWEpKQotCQlyZXR1cm47Ci0KLQlpbnRlbF9ndF9mbHVzaF9nZ3R0X3dyaXRlcyh2bWEtPnZt
LT5ndCk7Ci0KLQlpOTE1X3ZtYV91bnNldF9nZ3R0X3dyaXRlKHZtYSk7CisJaWYgKGk5MTVfdm1h
X3Vuc2V0X2dndHRfd3JpdGUodm1hKSkKKwkJaW50ZWxfZ3RfZmx1c2hfZ2d0dF93cml0ZXModm1h
LT52bS0+Z3QpOwogfQogCiB2b2lkIGk5MTVfdm1hX3VucGluX2lvbWFwKHN0cnVjdCBpOTE1X3Zt
YSAqdm1hKQogewotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0tPmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwotCiAJR0VNX0JVR19PTih2bWEtPmlvbWFwID09IE5VTEwpOwogCiAJaTkxNV92
bWFfZmx1c2hfd3JpdGVzKHZtYSk7CkBAIC01NDEsNyArNjAwLDYgQEAgc3RhdGljIHZvaWQgYXNz
ZXJ0X2JpbmRfY291bnQoY29uc3Qgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHN0
YXRpYyBpbnQKIGk5MTVfdm1hX2luc2VydChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUs
IHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAq
ZGV2X3ByaXYgPSB2bWEtPnZtLT5pOTE1OwogCXVuc2lnbmVkIGludCBjYWNoZV9sZXZlbDsKIAl1
NjQgc3RhcnQsIGVuZDsKIAlpbnQgcmV0OwpAQCAtNTY3LDcgKzYyNSw3IEBAIGk5MTVfdm1hX2lu
c2VydChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBm
bGFncykKIAogCWVuZCA9IHZtYS0+dm0tPnRvdGFsOwogCWlmIChmbGFncyAmIFBJTl9NQVBQQUJM
RSkKLQkJZW5kID0gbWluX3QodTY0LCBlbmQsIGRldl9wcml2LT5nZ3R0Lm1hcHBhYmxlX2VuZCk7
CisJCWVuZCA9IG1pbl90KHU2NCwgZW5kLCBpOTE1X3ZtX3RvX2dndHQodm1hLT52bSktPm1hcHBh
YmxlX2VuZCk7CiAJaWYgKGZsYWdzICYgUElOX1pPTkVfNEcpCiAJCWVuZCA9IG1pbl90KHU2NCwg
ZW5kLCAoMVVMTCA8PCAzMikgLSBJOTE1X0dUVF9QQUdFX1NJWkUpOwogCUdFTV9CVUdfT04oIUlT
X0FMSUdORUQoZW5kLCBJOTE1X0dUVF9QQUdFX1NJWkUpKTsKQEAgLTU4MywzNSArNjQxLDIxIEBA
IGk5MTVfdm1hX2luc2VydChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGln
bm1lbnQsIHU2NCBmbGFncykKIAkJcmV0dXJuIC1FTk9TUEM7CiAJfQogCi0JaWYgKHZtYS0+b2Jq
KSB7Ci0JCXJldCA9IGk5MTVfZ2VtX29iamVjdF9waW5fcGFnZXModm1hLT5vYmopOwotCQlpZiAo
cmV0KQotCQkJcmV0dXJuIHJldDsKLQorCWNhY2hlX2xldmVsID0gMDsKKwlpZiAodm1hLT5vYmop
CiAJCWNhY2hlX2xldmVsID0gdm1hLT5vYmotPmNhY2hlX2xldmVsOwotCX0gZWxzZSB7Ci0JCWNh
Y2hlX2xldmVsID0gMDsKLQl9Ci0KLQlHRU1fQlVHX09OKHZtYS0+cGFnZXMpOwotCi0JcmV0ID0g
dm1hLT5vcHMtPnNldF9wYWdlcyh2bWEpOwotCWlmIChyZXQpCi0JCWdvdG8gZXJyX3VucGluOwog
CiAJaWYgKGZsYWdzICYgUElOX09GRlNFVF9GSVhFRCkgewogCQl1NjQgb2Zmc2V0ID0gZmxhZ3Mg
JiBQSU5fT0ZGU0VUX01BU0s7CiAJCWlmICghSVNfQUxJR05FRChvZmZzZXQsIGFsaWdubWVudCkg
fHwKLQkJICAgIHJhbmdlX292ZXJmbG93cyhvZmZzZXQsIHNpemUsIGVuZCkpIHsKLQkJCXJldCA9
IC1FSU5WQUw7Ci0JCQlnb3RvIGVycl9jbGVhcjsKLQkJfQorCQkgICAgcmFuZ2Vfb3ZlcmZsb3dz
KG9mZnNldCwgc2l6ZSwgZW5kKSkKKwkJCXJldHVybiAtRUlOVkFMOwogCiAJCXJldCA9IGk5MTVf
Z2VtX2d0dF9yZXNlcnZlKHZtYS0+dm0sICZ2bWEtPm5vZGUsCiAJCQkJCSAgIHNpemUsIG9mZnNl
dCwgY2FjaGVfbGV2ZWwsCiAJCQkJCSAgIGZsYWdzKTsKIAkJaWYgKHJldCkKLQkJCWdvdG8gZXJy
X2NsZWFyOworCQkJcmV0dXJuIHJldDsKIAl9IGVsc2UgewogCQkvKgogCQkgKiBXZSBvbmx5IHN1
cHBvcnQgaHVnZSBndHQgcGFnZXMgdGhyb3VnaCB0aGUgNDhiIFBQR1RULApAQCAtNjUwLDcgKzY5
NCw3IEBAIGk5MTVfdm1hX2luc2VydChzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUsIHU2
NCBhbGlnbm1lbnQsIHU2NCBmbGFncykKIAkJCQkJICBzaXplLCBhbGlnbm1lbnQsIGNhY2hlX2xl
dmVsLAogCQkJCQkgIHN0YXJ0LCBlbmQsIGZsYWdzKTsKIAkJaWYgKHJldCkKLQkJCWdvdG8gZXJy
X2NsZWFyOworCQkJcmV0dXJuIHJldDsKIAogCQlHRU1fQlVHX09OKHZtYS0+bm9kZS5zdGFydCA8
IHN0YXJ0KTsKIAkJR0VNX0JVR19PTih2bWEtPm5vZGUuc3RhcnQgKyB2bWEtPm5vZGUuc2l6ZSA+
IGVuZCk7CkBAIC02NTgsMjMgKzcwMiwxNSBAQCBpOTE1X3ZtYV9pbnNlcnQoc3RydWN0IGk5MTVf
dm1hICp2bWEsIHU2NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3MpCiAJR0VNX0JVR19P
TighZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKTsKIAlHRU1fQlVHX09OKCFpOTE1
X2dlbV92YWxpZF9ndHRfc3BhY2Uodm1hLCBjYWNoZV9sZXZlbCkpOwogCi0JbXV0ZXhfbG9jaygm
dm1hLT52bS0+bXV0ZXgpOwogCWxpc3RfYWRkX3RhaWwoJnZtYS0+dm1fbGluaywgJnZtYS0+dm0t
PmJvdW5kX2xpc3QpOwotCW11dGV4X3VubG9jaygmdm1hLT52bS0+bXV0ZXgpOwogCiAJaWYgKHZt
YS0+b2JqKSB7CisJCWF0b21pY19pbmMoJnZtYS0+b2JqLT5tbS5wYWdlc19waW5fY291bnQpOwog
CQlhdG9taWNfaW5jKCZ2bWEtPm9iai0+YmluZF9jb3VudCk7CiAJCWFzc2VydF9iaW5kX2NvdW50
KHZtYS0+b2JqKTsKIAl9CiAKIAlyZXR1cm4gMDsKLQotZXJyX2NsZWFyOgotCXZtYS0+b3BzLT5j
bGVhcl9wYWdlcyh2bWEpOwotZXJyX3VucGluOgotCWlmICh2bWEtPm9iaikKLQkJaTkxNV9nZW1f
b2JqZWN0X3VucGluX3BhZ2VzKHZtYS0+b2JqKTsKLQlyZXR1cm4gcmV0OwogfQogCiBzdGF0aWMg
dm9pZApAQCAtNjgzLDEyICs3MTksNyBAQCBpOTE1X3ZtYV9yZW1vdmUoc3RydWN0IGk5MTVfdm1h
ICp2bWEpCiAJR0VNX0JVR19PTighZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKTsK
IAlHRU1fQlVHX09OKGk5MTVfdm1hX2lzX2JvdW5kKHZtYSwgSTkxNV9WTUFfR0xPQkFMX0JJTkQg
fCBJOTE1X1ZNQV9MT0NBTF9CSU5EKSk7CiAKLQl2bWEtPm9wcy0+Y2xlYXJfcGFnZXModm1hKTsK
LQotCW11dGV4X2xvY2soJnZtYS0+dm0tPm11dGV4KTsKLQlkcm1fbW1fcmVtb3ZlX25vZGUoJnZt
YS0+bm9kZSk7CiAJbGlzdF9kZWwoJnZtYS0+dm1fbGluayk7Ci0JbXV0ZXhfdW5sb2NrKCZ2bWEt
PnZtLT5tdXRleCk7CiAKIAkvKgogCSAqIFNpbmNlIHRoZSB1bmJvdW5kIGxpc3QgaXMgZ2xvYmFs
LCBvbmx5IG1vdmUgdG8gdGhhdCBsaXN0IGlmCkBAIC03MDcsNTEgKzczOCwxMTUgQEAgaTkxNV92
bWFfcmVtb3ZlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCQlpOTE1X2dlbV9vYmplY3RfdW5waW5f
cGFnZXMob2JqKTsKIAkJYXNzZXJ0X2JpbmRfY291bnQob2JqKTsKIAl9CisKKwlkcm1fbW1fcmVt
b3ZlX25vZGUoJnZtYS0+bm9kZSk7CiB9CiAKLWludCBfX2k5MTVfdm1hX2RvX3BpbihzdHJ1Y3Qg
aTkxNV92bWEgKnZtYSwKLQkJICAgICAgdTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFn
cykKK2ludCBpOTE1X3ZtYV9waW4oc3RydWN0IGk5MTVfdm1hICp2bWEsIHU2NCBzaXplLCB1NjQg
YWxpZ25tZW50LCB1NjQgZmxhZ3MpCiB7Ci0JY29uc3QgdW5zaWduZWQgaW50IGJvdW5kID0gYXRv
bWljX3JlYWQoJnZtYS0+ZmxhZ3MpOwotCWludCByZXQ7CisJc3RydWN0IGk5MTVfdm1hX3dvcmsg
KndvcmsgPSBOVUxMOworCWJvb2wgaW5zZXJ0ID0gZmFsc2U7CisJdW5zaWduZWQgaW50IGJvdW5k
OworCWludCBlcnI7CisKKwlCVUlMRF9CVUdfT04oUElOX01CWiAhPSBJOTE1X1ZNQV9QSU5fT1ZF
UkZMT1cpOworCUJVSUxEX0JVR19PTihQSU5fR0xPQkFMICE9IEk5MTVfVk1BX0dMT0JBTF9CSU5E
KTsKKwlCVUlMRF9CVUdfT04oUElOX1VTRVIgIT0gSTkxNV9WTUFfTE9DQUxfQklORCk7CisKKwlH
RU1fQlVHX09OKGZsYWdzICYgSTkxNV9WTUFfUElOX09WRVJGTE9XKTsKKwlHRU1fQlVHX09OKGZs
YWdzICYgSTkxNV9WTUFfRVJST1IpOworCisJYm91bmQgPSBhdG9taWNfaW5jX3JldHVybigmdm1h
LT5mbGFncyk7CisJaWYgKGxpa2VseSgoKGJvdW5kIF4gZmxhZ3MpICYgSTkxNV9WTUFfQklORF9N
QVNLKSA9PSAwKSkgeworCQlHRU1fQlVHX09OKCFkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+
bm9kZSkpOworCQlHRU1fQlVHX09OKGk5MTVfdm1hX21pc3BsYWNlZCh2bWEsIHNpemUsIGFsaWdu
bWVudCwgZmxhZ3MpKTsKKwkJcmV0dXJuIDA7CisJfQogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgm
dm1hLT52bS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JR0VNX0JVR19PTigoZmxhZ3MgJiAo
UElOX0dMT0JBTCB8IFBJTl9VU0VSKSkgPT0gMCk7Ci0JR0VNX0JVR19PTigoZmxhZ3MgJiBQSU5f
R0xPQkFMKSAmJiAhaTkxNV92bWFfaXNfZ2d0dCh2bWEpKTsKKwlpZiAoYm91bmQgJiBJOTE1X1ZN
QV9FUlJPUikgeworCQllcnIgPSAtRU5PTUVNOworCQlnb3RvIGVycl91bnBpbjsKKwl9CiAKIAlp
ZiAoV0FSTl9PTihib3VuZCAmIEk5MTVfVk1BX1BJTl9PVkVSRkxPVykpIHsKLQkJcmV0ID0gLUVC
VVNZOworCQllcnIgPSAtRU5PTUVNOwogCQlnb3RvIGVycl91bnBpbjsKIAl9CiAKLQlpZiAoKGJv
dW5kICYgSTkxNV9WTUFfQklORF9NQVNLKSA9PSAwKSB7Ci0JCXJldCA9IGk5MTVfdm1hX2luc2Vy
dCh2bWEsIHNpemUsIGFsaWdubWVudCwgZmxhZ3MpOwotCQlpZiAocmV0KQotCQkJZ290byBlcnJf
dW5waW47CisJaWYgKHZtYS0+b2JqKSB7CisJCWVyciA9IGk5MTVfZ2VtX29iamVjdF9waW5fcGFn
ZXModm1hLT5vYmopOworCQlpZiAoZXJyKQorCQkJcmV0dXJuIGVycjsKIAl9Ci0JR0VNX0JVR19P
TighZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKTsKIAotCXJldCA9IGk5MTVfdm1h
X2JpbmQodm1hLCB2bWEtPm9iaiA/IHZtYS0+b2JqLT5jYWNoZV9sZXZlbCA6IDAsIGZsYWdzKTsK
LQlpZiAocmV0KQotCQlnb3RvIGVycl9yZW1vdmU7CisJaWYgKCF2bWEtPnBhZ2VzKSB7CisJCUdF
TV9CVUdfT04odm1hLT5wYWdlcyk7CisJCWVyciA9IHZtYS0+b3BzLT5zZXRfcGFnZXModm1hKTsK
KwkJaWYgKGVycikKKwkJCWdvdG8gZXJyX3BhZ2VzOwogCi0JR0VNX0JVR19PTighaTkxNV92bWFf
aXNfYm91bmQodm1hLCBJOTE1X1ZNQV9CSU5EX01BU0spKTsKKwkJR0VNX0JVR19PTighdm1hLT5w
YWdlcyk7CisJCWluc2VydCA9IHRydWU7CisJfQogCi0JaWYgKChib3VuZCBeIGF0b21pY19yZWFk
KCZ2bWEtPmZsYWdzKSkgJiBJOTE1X1ZNQV9HTE9CQUxfQklORCkKLQkJX19pOTE1X3ZtYV9zZXRf
bWFwX2FuZF9mZW5jZWFibGUodm1hKTsKKwlpZiAoZmxhZ3MgJiBQSU5fVVNFUikgeworCQl3b3Jr
ID0gaTkxNV92bWFfd29yaygpOworCQlpZiAoIXdvcmspIHsKKwkJCWVyciA9IC1FTk9NRU07CisJ
CQlnb3RvIGVycl9jbGVhcjsKKwkJfQorCX0KIAotCUdFTV9CVUdfT04oaTkxNV92bWFfbWlzcGxh
Y2VkKHZtYSwgc2l6ZSwgYWxpZ25tZW50LCBmbGFncykpOwotCXJldHVybiAwOworCWVyciA9IGk5
MTVfYWN0aXZlX2FjcXVpcmUoJnZtYS0+YWN0aXZlKTsKKwlpZiAoZXJyKQorCQlnb3RvIGVycl9m
ZW5jZTsKKworCWVyciA9IG11dGV4X2xvY2tfaW50ZXJydXB0aWJsZSgmdm1hLT52bS0+bXV0ZXgp
OworCWlmIChlcnIpCisJCWdvdG8gZXJyX2FjdGl2ZTsKKworCWlmIChpbnNlcnQpIHsKKwkJZXJy
ID0gaTkxNV92bWFfaW5zZXJ0KHZtYSwgc2l6ZSwgYWxpZ25tZW50LCBmbGFncyk7CisJCWlmIChl
cnIpCisJCQlnb3RvIGVycl91bmxvY2s7CisJfQogCi1lcnJfcmVtb3ZlOgotCWlmICgoYm91bmQg
JiBJOTE1X1ZNQV9CSU5EX01BU0spID09IDApIHsKLQkJaTkxNV92bWFfcmVtb3ZlKHZtYSk7CisJ
ZXJyID0gaTkxNV92bWFfYmluZCh2bWEsCisJCQkgICAgdm1hLT5vYmogPyB2bWEtPm9iai0+Y2Fj
aGVfbGV2ZWwgOiAwLAorCQkJICAgIGZsYWdzLCB3b3JrKTsKKwlpZiAoZXJyID09IDApIHsKKwkJ
R0VNX0JVR19PTighaTkxNV92bWFfaXNfYm91bmQodm1hLCBJOTE1X1ZNQV9CSU5EX01BU0spKTsK
KworCQlpZiAoKGJvdW5kIF4gYXRvbWljX3JlYWQoJnZtYS0+ZmxhZ3MpKSAmIEk5MTVfVk1BX0dM
T0JBTF9CSU5EKQorCQkJX19pOTE1X3ZtYV9zZXRfbWFwX2FuZF9mZW5jZWFibGUodm1hKTsKKwor
CQlHRU1fQlVHX09OKGk5MTVfdm1hX21pc3BsYWNlZCh2bWEsIHNpemUsIGFsaWdubWVudCwgZmxh
Z3MpKTsKKworCQlfX2k5MTVfdm1hX3Bpbih2bWEpOworCX0gZWxzZSB7CisJCWlmIChpbnNlcnQp
CisJCQlpOTE1X3ZtYV9yZW1vdmUodm1hKTsKKwl9CisKK2Vycl91bmxvY2s6CisJbXV0ZXhfdW5s
b2NrKCZ2bWEtPnZtLT5tdXRleCk7CitlcnJfYWN0aXZlOgorCWk5MTVfYWN0aXZlX3JlbGVhc2Uo
JnZtYS0+YWN0aXZlKTsKK2Vycl9mZW5jZToKKwlpZiAod29yaykKKwkJZG1hX2ZlbmNlX3dvcmtf
Y29tbWl0KCZ3b3JrLT5iYXNlKTsKK2Vycl9jbGVhcjoKKwlpZiAoZXJyICYmIGluc2VydCkgewor
CQl2bWEtPm9wcy0+Y2xlYXJfcGFnZXModm1hKTsKIAkJR0VNX0JVR19PTih2bWEtPnBhZ2VzKTsK
IAkJR0VNX0JVR19PTihhdG9taWNfcmVhZCgmdm1hLT5mbGFncykgJiBJOTE1X1ZNQV9CSU5EX01B
U0spOwogCX0KK2Vycl9wYWdlczoKKwlpZiAodm1hLT5vYmopCisJCWk5MTVfZ2VtX29iamVjdF91
bnBpbl9wYWdlcyh2bWEtPm9iaik7CiBlcnJfdW5waW46CiAJX19pOTE1X3ZtYV91bnBpbih2bWEp
OwotCXJldHVybiByZXQ7CisJcmV0dXJuIGVycjsKIH0KIAogdm9pZCBpOTE1X3ZtYV9jbG9zZShz
dHJ1Y3QgaTkxNV92bWEgKnZtYSkKQEAgLTc5NSwxMCArODkwLDE4IEBAIHZvaWQgaTkxNV92bWFf
cmVvcGVuKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogCV9faTkxNV92bWFfcmVtb3ZlX2Nsb3NlZCh2
bWEpOwogfQogCi1zdGF0aWMgdm9pZCBfX2k5MTVfdm1hX2Rlc3Ryb3koc3RydWN0IGk5MTVfdm1h
ICp2bWEpCit2b2lkIGk5MTVfdm1hX2Rlc3Ryb3koc3RydWN0IGk5MTVfdm1hICp2bWEpCiB7Ci0J
R0VNX0JVR19PTihkcm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpOwotCUdFTV9CVUdf
T04odm1hLT5mZW5jZSk7CisJX19pOTE1X3ZtYV9yZW1vdmVfY2xvc2VkKHZtYSk7CisKKwlpZiAo
ZHJtX21tX25vZGVfYWxsb2NhdGVkKCZ2bWEtPm5vZGUpKSB7CisJCW11dGV4X2xvY2soJnZtYS0+
dm0tPm11dGV4KTsKKwkJYXRvbWljX2FuZCh+STkxNV9WTUFfUElOX01BU0ssICZ2bWEtPmZsYWdz
KTsKKwkJV0FSTl9PTihpOTE1X3ZtYV91bmJpbmQodm1hKSk7CisJCW11dGV4X3VubG9jaygmdm1h
LT52bS0+bXV0ZXgpOworCQlHRU1fQlVHX09OKGRybV9tbV9ub2RlX2FsbG9jYXRlZCgmdm1hLT5u
b2RlKSk7CisJfQorCUdFTV9CVUdfT04oaTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpOwogCiAJaWYg
KHZtYS0+b2JqKSB7CiAJCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB2bWEtPm9i
ajsKQEAgLTgwOSwzNiArOTEyLDM2IEBAIHN0YXRpYyB2b2lkIF9faTkxNV92bWFfZGVzdHJveShz
dHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAkJc3Bpbl91bmxvY2soJm9iai0+dm1hLmxvY2spOwogCX0K
IAotCWk5MTVfYWN0aXZlX2ZpbmkoJnZtYS0+YWN0aXZlKTsKKwlpOTE1X3ZtX3B1dCh2bWEtPnZt
KTsKIAorCWk5MTVfYWN0aXZlX2ZpbmkoJnZtYS0+YWN0aXZlKTsKIAlpOTE1X3ZtYV9mcmVlKHZt
YSk7CiB9CiAKLXZvaWQgaTkxNV92bWFfZGVzdHJveShzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKLXsK
LQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZ2bWEtPnZtLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
LQotCUdFTV9CVUdfT04oaTkxNV92bWFfaXNfcGlubmVkKHZtYSkpOwotCi0JX19pOTE1X3ZtYV9y
ZW1vdmVfY2xvc2VkKHZtYSk7Ci0KLQlXQVJOX09OKGk5MTVfdm1hX3VuYmluZCh2bWEpKTsKLQlH
RU1fQlVHX09OKGk5MTVfdm1hX2lzX2FjdGl2ZSh2bWEpKTsKLQotCV9faTkxNV92bWFfZGVzdHJv
eSh2bWEpOwotfQotCiB2b2lkIGk5MTVfdm1hX3BhcmtlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKIHsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgKm5leHQ7CiAKIAlzcGluX2xvY2tf
aXJxKCZpOTE1LT5ndC5jbG9zZWRfbG9jayk7CiAJbGlzdF9mb3JfZWFjaF9lbnRyeV9zYWZlKHZt
YSwgbmV4dCwgJmk5MTUtPmd0LmNsb3NlZF92bWEsIGNsb3NlZF9saW5rKSB7CisJCXN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB2bWEtPm9iajsKKwkJc3RydWN0IGk5MTVfYWRkcmVz
c19zcGFjZSAqdm0gPSB2bWEtPnZtOworCiAJCWxpc3RfZGVsX2luaXQoJnZtYS0+Y2xvc2VkX2xp
bmspOworCQlpZiAoIWk5MTVfdm1fdHJ5b3Blbih2bSkpCisJCQljb250aW51ZTsKKworCQlpZiAo
IWtyZWZfZ2V0X3VubGVzc196ZXJvKCZvYmotPmJhc2UucmVmY291bnQpKQorCQkJb2JqID0gTlVM
TDsKKwogCQlzcGluX3VubG9ja19pcnEoJmk5MTUtPmd0LmNsb3NlZF9sb2NrKTsKIAotCQlpOTE1
X3ZtYV9kZXN0cm95KHZtYSk7CisJCWlmIChvYmopIHsKKwkJCWk5MTVfdm1hX2Rlc3Ryb3kodm1h
KTsKKwkJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwkJfQogCisJCWk5MTVfdm1fY2xvc2Uo
dm0pOwogCQlzcGluX2xvY2tfaXJxKCZpOTE1LT5ndC5jbG9zZWRfbG9jayk7CiAJfQogCXNwaW5f
dW5sb2NrX2lycSgmaTkxNS0+Z3QuY2xvc2VkX2xvY2spOwpAQCAtOTMwLDM0ICsxMDMzLDE1IEBA
IGludCBpOTE1X3ZtYV91bmJpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEpCiB7CiAJaW50IHJldDsK
IAotCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0tPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OworCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnZtYS0+dm0tPm11dGV4KTsKIAogCS8qCiAJICogRmly
c3Qgd2FpdCB1cG9uIGFueSBhY3Rpdml0eSBhcyByZXRpcmluZyB0aGUgcmVxdWVzdCBtYXkKIAkg
KiBoYXZlIHNpZGUtZWZmZWN0cyBzdWNoIGFzIHVucGlubmluZyBvciBldmVuIHVuYmluZGluZyB0
aGlzIHZtYS4KIAkgKi8KLQltaWdodF9zbGVlcCgpOwotCWlmIChpOTE1X3ZtYV9pc19hY3RpdmUo
dm1hKSkgewotCQkvKgotCQkgKiBXaGVuIGEgY2xvc2VkIFZNQSBpcyByZXRpcmVkLCBpdCBpcyB1
bmJvdW5kIC0gZWVrLgotCQkgKiBJbiBvcmRlciB0byBwcmV2ZW50IGl0IGZyb20gYmVpbmcgcmVj
dXJzaXZlbHkgY2xvc2VkLAotCQkgKiB0YWtlIGEgcGluIG9uIHRoZSB2bWEgc28gdGhhdCB0aGUg
c2Vjb25kIHVuYmluZCBpcwotCQkgKiBhYm9ydGVkLgotCQkgKgotCQkgKiBFdmVuIG1vcmUgc2Nh
cnkgaXMgdGhhdCB0aGUgcmV0aXJlIGNhbGxiYWNrIG1heSBmcmVlCi0JCSAqIHRoZSBvYmplY3Qg
KGxhc3QgYWN0aXZlIHZtYSkuIFRvIHByZXZlbnQgdGhlIGV4cGxvc2lvbgotCQkgKiB3ZSBkZWZl
ciB0aGUgYWN0dWFsIG9iamVjdCBmcmVlIHRvIGEgd29ya2VyIHRoYXQgY2FuCi0JCSAqIG9ubHkg
cHJvY2VlZCBvbmNlIGl0IGFjcXVpcmVzIHRoZSBzdHJ1Y3RfbXV0ZXggKHdoaWNoCi0JCSAqIHdl
IGN1cnJlbnRseSBob2xkLCB0aGVyZWZvcmUgaXQgY2Fubm90IGZyZWUgdGhpcyBvYmplY3QKLQkJ
ICogYmVmb3JlIHdlIGFyZSBmaW5pc2hlZCkuCi0JCSAqLwotCQlfX2k5MTVfdm1hX3Bpbih2bWEp
OwotCQlyZXQgPSBpOTE1X2FjdGl2ZV93YWl0KCZ2bWEtPmFjdGl2ZSk7Ci0JCV9faTkxNV92bWFf
dW5waW4odm1hKTsKLQkJaWYgKHJldCkKLQkJCXJldHVybiByZXQ7Ci0JfQotCUdFTV9CVUdfT04o
aTkxNV92bWFfaXNfYWN0aXZlKHZtYSkpOworCXJldCA9IGk5MTVfYWN0aXZlX3dhaXQoJnZtYS0+
YWN0aXZlKTsKKwlpZiAocmV0KQorCQlyZXR1cm4gcmV0OwogCiAJaWYgKGk5MTVfdm1hX2lzX3Bp
bm5lZCh2bWEpKSB7CiAJCXZtYV9wcmludF9hbGxvY2F0b3Iodm1hLCAiaXMgcGlubmVkIik7CkBA
IC05NzgsMTYgKzEwNjIsMTIgQEAgaW50IGk5MTVfdm1hX3VuYmluZChzdHJ1Y3QgaTkxNV92bWEg
KnZtYSkKIAkJR0VNX0JVR19PTihpOTE1X3ZtYV9oYXNfZ2d0dF93cml0ZSh2bWEpKTsKIAogCQkv
KiByZWxlYXNlIHRoZSBmZW5jZSByZWcgX2FmdGVyXyBmbHVzaGluZyAqLwotCQltdXRleF9sb2Nr
KCZ2bWEtPnZtLT5tdXRleCk7CiAJCXJldCA9IGk5MTVfdm1hX3Jldm9rZV9mZW5jZSh2bWEpOwot
CQltdXRleF91bmxvY2soJnZtYS0+dm0tPm11dGV4KTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiBy
ZXQ7CiAKIAkJLyogRm9yY2UgYSBwYWdlZmF1bHQgZm9yIGRvbWFpbiB0cmFja2luZyBvbiBuZXh0
IHVzZXIgYWNjZXNzICovCi0JCW11dGV4X2xvY2soJnZtYS0+dm0tPm11dGV4KTsKIAkJaTkxNV92
bWFfcmV2b2tlX21tYXAodm1hKTsKLQkJbXV0ZXhfdW5sb2NrKCZ2bWEtPnZtLT5tdXRleCk7CiAK
IAkJX19pOTE1X3ZtYV9pb3VubWFwKHZtYSk7CiAJCWNsZWFyX2JpdChJOTE1X1ZNQV9DQU5fRkVO
Q0VfQklULCBfX2k5MTVfdm1hX2ZsYWdzKHZtYSkpOwpAQCAtOTk1LDEyICsxMDc1LDEzIEBAIGlu
dCBpOTE1X3ZtYV91bmJpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEpCiAJR0VNX0JVR19PTih2bWEt
PmZlbmNlKTsKIAlHRU1fQlVHX09OKGk5MTVfdm1hX2hhc191c2VyZmF1bHQodm1hKSk7CiAKLQlp
ZiAobGlrZWx5KCF2bWEtPnZtLT5jbG9zZWQpKSB7CisJaWYgKGxpa2VseShhdG9taWNfcmVhZCgm
dm1hLT52bS0+b3BlbikpKSB7CiAJCXRyYWNlX2k5MTVfdm1hX3VuYmluZCh2bWEpOwogCQl2bWEt
Pm9wcy0+dW5iaW5kX3ZtYSh2bWEpOwogCX0KIAlhdG9taWNfYW5kKH5JOTE1X1ZNQV9CSU5EX01B
U0ssICZ2bWEtPmZsYWdzKTsKIAorCXZtYS0+b3BzLT5jbGVhcl9wYWdlcyh2bWEpOwogCWk5MTVf
dm1hX3JlbW92ZSh2bWEpOwogCiAJcmV0dXJuIDA7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X3ZtYS5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuaAppbmRl
eCAwMmQ3ZDgxNTQwN2MuLjNlMzUwYjljMzliYyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV92bWEuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5oCkBA
IC03Myw2ICs3Myw3IEBAIHN0cnVjdCBpOTE1X3ZtYSB7CiAJICovCiAJYXRvbWljX3Qgb3Blbl9j
b3VudDsKIAlhdG9taWNfdCBmbGFnczsKKwogCS8qKgogCSAqIEhvdyBtYW55IHVzZXJzIGhhdmUg
cGlubmVkIHRoaXMgb2JqZWN0IGluIEdUVCBzcGFjZS4KIAkgKgpAQCAtMTAzLDE4ICsxMDQsMjQg
QEAgc3RydWN0IGk5MTVfdm1hIHsKIAkvKiogRmxhZ3MgYW5kIGFkZHJlc3Mgc3BhY2UgdGhpcyBW
TUEgaXMgYm91bmQgdG8gKi8KICNkZWZpbmUgSTkxNV9WTUFfR0xPQkFMX0JJTkRfQklUIDkKICNk
ZWZpbmUgSTkxNV9WTUFfTE9DQUxfQklORF9CSVQgMTAKKyNkZWZpbmUgSTkxNV9WTUFfRVJST1Jf
QklUCTExCiAKICNkZWZpbmUgSTkxNV9WTUFfR0xPQkFMX0JJTkQJKChpbnQpQklUKEk5MTVfVk1B
X0dMT0JBTF9CSU5EX0JJVCkpCiAjZGVmaW5lIEk5MTVfVk1BX0xPQ0FMX0JJTkQJKChpbnQpQklU
KEk5MTVfVk1BX0xPQ0FMX0JJTkRfQklUKSkKKyNkZWZpbmUgSTkxNV9WTUFfRVJST1IJCSgoaW50
KUJJVChJOTE1X1ZNQV9FUlJPUl9CSVQpKQogCiAjZGVmaW5lIEk5MTVfVk1BX0JJTkRfTUFTSyAo
STkxNV9WTUFfR0xPQkFMX0JJTkQgfCBcCiAJCQkgICAgSTkxNV9WTUFfTE9DQUxfQklORCB8IFwK
KwkJCSAgICBJOTE1X1ZNQV9FUlJPUiB8IFwKIAkJCSAgICBJOTE1X1ZNQV9QSU5fT1ZFUkZMT1cp
CiAKLSNkZWZpbmUgSTkxNV9WTUFfR0dUVF9CSVQJMTEKLSNkZWZpbmUgSTkxNV9WTUFfQ0FOX0ZF
TkNFX0JJVAkxMgotI2RlZmluZSBJOTE1X1ZNQV9VU0VSRkFVTFRfQklUCTEzCi0jZGVmaW5lIEk5
MTVfVk1BX0dHVFRfV1JJVEVfQklUCTE0CisjZGVmaW5lIEk5MTVfVk1BX0FMTE9DX0JJVAkxMgor
I2RlZmluZSBJOTE1X1ZNQV9BTExPQwkJKChpbnQpQklUKEk5MTVfVk1BX0FMTE9DX0JJVCkpCisK
KyNkZWZpbmUgSTkxNV9WTUFfR0dUVF9CSVQJMTMKKyNkZWZpbmUgSTkxNV9WTUFfQ0FOX0ZFTkNF
X0JJVAkxNAorI2RlZmluZSBJOTE1X1ZNQV9VU0VSRkFVTFRfQklUCTE1CisjZGVmaW5lIEk5MTVf
Vk1BX0dHVFRfV1JJVEVfQklUCTE2CiAKICNkZWZpbmUgSTkxNV9WTUFfR0dUVAkJKChpbnQpQklU
KEk5MTVfVk1BX0dHVFRfQklUKSkKICNkZWZpbmUgSTkxNV9WTUFfQ0FOX0ZFTkNFCSgoaW50KUJJ
VChJOTE1X1ZNQV9DQU5fRkVOQ0VfQklUKSkKQEAgLTMwOCw4ICszMTUsMTIgQEAgaTkxNV92bWFf
Y29tcGFyZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSwKIAlyZXR1cm4gbWVtY21wKCZ2bWEtPmdndHRf
dmlldy5wYXJ0aWFsLCAmdmlldy0+cGFydGlhbCwgdmlldy0+dHlwZSk7CiB9CiAKLWludCBpOTE1
X3ZtYV9iaW5kKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCBlbnVtIGk5MTVfY2FjaGVfbGV2ZWwgY2Fj
aGVfbGV2ZWwsCi0JCSAgdTMyIGZsYWdzKTsKK3N0cnVjdCBpOTE1X3ZtYV93b3JrICppOTE1X3Zt
YV93b3JrKHZvaWQpOworaW50IGk5MTVfdm1hX2JpbmQoc3RydWN0IGk5MTVfdm1hICp2bWEsCisJ
CSAgZW51bSBpOTE1X2NhY2hlX2xldmVsIGNhY2hlX2xldmVsLAorCQkgIHUzMiBmbGFncywKKwkJ
ICBzdHJ1Y3QgaTkxNV92bWFfd29yayAqd29yayk7CisKIGJvb2wgaTkxNV9nZW1fdmFsaWRfZ3R0
X3NwYWNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCB1bnNpZ25lZCBsb25nIGNhY2hlX2xldmVsKTsK
IGJvb2wgaTkxNV92bWFfbWlzcGxhY2VkKGNvbnN0IHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAogCQkJ
dTY0IHNpemUsIHU2NCBhbGlnbm1lbnQsIHU2NCBmbGFncyk7CkBAIC0zMjgsMzIgKzMzOSwxOSBA
QCBzdGF0aWMgaW5saW5lIHZvaWQgaTkxNV92bWFfbG9jayhzdHJ1Y3QgaTkxNV92bWEgKnZtYSkK
IAlkbWFfcmVzdl9sb2NrKHZtYS0+cmVzdiwgTlVMTCk7CiB9CiAKLXN0YXRpYyBpbmxpbmUgdm9p
ZCBpOTE1X3ZtYV91bmxvY2soc3RydWN0IGk5MTVfdm1hICp2bWEpCitzdGF0aWMgaW5saW5lIGJv
b2wgaTkxNV92bWFfdHJ5bG9jayhzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKLQlkbWFfcmVzdl91
bmxvY2sodm1hLT5yZXN2KTsKKwlyZXR1cm4gZG1hX3Jlc3ZfdHJ5bG9jayh2bWEtPnJlc3YpOwog
fQogCi1pbnQgX19pOTE1X3ZtYV9kb19waW4oc3RydWN0IGk5MTVfdm1hICp2bWEsCi0JCSAgICAg
IHU2NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3MpOwotc3RhdGljIGlubGluZSBpbnQg
X19tdXN0X2NoZWNrCi1pOTE1X3ZtYV9waW4oc3RydWN0IGk5MTVfdm1hICp2bWEsIHU2NCBzaXpl
LCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3MpCitzdGF0aWMgaW5saW5lIHZvaWQgaTkxNV92bWFf
dW5sb2NrKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewotCUJVSUxEX0JVR19PTihQSU5fTUJaICE9
IEk5MTVfVk1BX1BJTl9PVkVSRkxPVyk7Ci0JQlVJTERfQlVHX09OKFBJTl9HTE9CQUwgIT0gSTkx
NV9WTUFfR0xPQkFMX0JJTkQpOwotCUJVSUxEX0JVR19PTihQSU5fVVNFUiAhPSBJOTE1X1ZNQV9M
T0NBTF9CSU5EKTsKLQotCS8qIFBpbiBlYXJseSB0byBwcmV2ZW50IHRoZSBzaHJpbmtlci9ldmlj
dGlvbiBsb2dpYyBmcm9tIGRlc3Ryb3lpbmcKLQkgKiBvdXIgdm1hIGFzIHdlIGluc2VydCBhbmQg
YmluZC4KLQkgKi8KLQlpZiAobGlrZWx5KCgoYXRvbWljX2luY19yZXR1cm4oJnZtYS0+ZmxhZ3Mp
IF4gZmxhZ3MpICYgSTkxNV9WTUFfQklORF9NQVNLKSA9PSAwKSkgewotCQlHRU1fQlVHX09OKCFk
cm1fbW1fbm9kZV9hbGxvY2F0ZWQoJnZtYS0+bm9kZSkpOwotCQlHRU1fQlVHX09OKGk5MTVfdm1h
X21pc3BsYWNlZCh2bWEsIHNpemUsIGFsaWdubWVudCwgZmxhZ3MpKTsKLQkJcmV0dXJuIDA7Ci0J
fQotCi0JcmV0dXJuIF9faTkxNV92bWFfZG9fcGluKHZtYSwgc2l6ZSwgYWxpZ25tZW50LCBmbGFn
cyk7CisJZG1hX3Jlc3ZfdW5sb2NrKHZtYS0+cmVzdik7CiB9CiAKK2ludCBfX211c3RfY2hlY2sK
K2k5MTVfdm1hX3BpbihzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgdTY0IHNpemUsIHU2NCBhbGlnbm1l
bnQsIHU2NCBmbGFncyk7CisKIHN0YXRpYyBpbmxpbmUgaW50IGk5MTVfdm1hX3Bpbl9jb3VudChj
b25zdCBzdHJ1Y3QgaTkxNV92bWEgKnZtYSkKIHsKIAlyZXR1cm4gYXRvbWljX3JlYWQoJnZtYS0+
ZmxhZ3MpICYgSTkxNV9WTUFfUElOX01BU0s7CkBAIC0zOTcsOCArMzk1LDYgQEAgc3RhdGljIGlu
bGluZSBib29sIGk5MTVfdm1hX2lzX2JvdW5kKGNvbnN0IHN0cnVjdCBpOTE1X3ZtYSAqdm1hLAog
ICogdGhlIGNhbGxlciBtdXN0IGNhbGwgaTkxNV92bWFfdW5waW5faW9tYXAgdG8gcmVsaW5xdWlz
aCB0aGUgcGlubmluZwogICogYWZ0ZXIgdGhlIGlvbWFwcGluZyBpcyBubyBsb25nZXIgcmVxdWly
ZWQuCiAgKgotICogQ2FsbGVycyBtdXN0IGhvbGQgdGhlIHN0cnVjdF9tdXRleC4KLSAqCiAgKiBS
ZXR1cm5zIGEgdmFsaWQgaW9tYXBwZWQgcG9pbnRlciBvciBFUlJfUFRSLgogICovCiB2b2lkIF9f
aW9tZW0gKmk5MTVfdm1hX3Bpbl9pb21hcChzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7CkBAIC00MTAs
OCArNDA2LDggQEAgdm9pZCBfX2lvbWVtICppOTE1X3ZtYV9waW5faW9tYXAoc3RydWN0IGk5MTVf
dm1hICp2bWEpOwogICoKICAqIFVucGlucyB0aGUgcHJldmlvdXNseSBpb21hcHBlZCBWTUEgZnJv
bSBpOTE1X3ZtYV9waW5faW9tYXAoKS4KICAqCi0gKiBDYWxsZXJzIG11c3QgaG9sZCB0aGUgc3Ry
dWN0X211dGV4LiBUaGlzIGZ1bmN0aW9uIGlzIG9ubHkgdmFsaWQgdG8gYmUKLSAqIGNhbGxlZCBv
biBhIFZNQSBwcmV2aW91c2x5IGlvbWFwcGVkIGJ5IHRoZSBjYWxsZXIgd2l0aCBpOTE1X3ZtYV9w
aW5faW9tYXAoKS4KKyAqIFRoaXMgZnVuY3Rpb24gaXMgb25seSB2YWxpZCB0byBiZSBjYWxsZWQg
b24gYSBWTUEgcHJldmlvdXNseQorICogaW9tYXBwZWQgYnkgdGhlIGNhbGxlciB3aXRoIGk5MTVf
dm1hX3Bpbl9pb21hcCgpLgogICovCiB2b2lkIGk5MTVfdm1hX3VucGluX2lvbWFwKHN0cnVjdCBp
OTE1X3ZtYSAqdm1hKTsKIApAQCAtNDM5LDYgKzQzNSw4IEBAIHN0YXRpYyBpbmxpbmUgc3RydWN0
IHBhZ2UgKmk5MTVfdm1hX2ZpcnN0X3BhZ2Uoc3RydWN0IGk5MTVfdm1hICp2bWEpCiBpbnQgX19t
dXN0X2NoZWNrIGk5MTVfdm1hX3Bpbl9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7CiBpbnQg
X19tdXN0X2NoZWNrIGk5MTVfdm1hX3Jldm9rZV9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7
CiAKK2ludCBfX2k5MTVfdm1hX3Bpbl9mZW5jZShzdHJ1Y3QgaTkxNV92bWEgKnZtYSk7CisKIHN0
YXRpYyBpbmxpbmUgdm9pZCBfX2k5MTVfdm1hX3VucGluX2ZlbmNlKHN0cnVjdCBpOTE1X3ZtYSAq
dm1hKQogewogCUdFTV9CVUdfT04oYXRvbWljX3JlYWQoJnZtYS0+ZmVuY2UtPnBpbl9jb3VudCkg
PD0gMCk7CkBAIC00NTYsNyArNDU0LDYgQEAgc3RhdGljIGlubGluZSB2b2lkIF9faTkxNV92bWFf
dW5waW5fZmVuY2Uoc3RydWN0IGk5MTVfdm1hICp2bWEpCiBzdGF0aWMgaW5saW5lIHZvaWQKIGk5
MTVfdm1hX3VucGluX2ZlbmNlKHN0cnVjdCBpOTE1X3ZtYSAqdm1hKQogewotCS8qIGxvY2tkZXBf
YXNzZXJ0X2hlbGQoJnZtYS0+dm0tPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOyAqLwogCWlmICh2
bWEtPmZlbmNlKQogCQlfX2k5MTVfdm1hX3VucGluX2ZlbmNlKHZtYSk7CiB9CmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ldmljdC5jCmluZGV4IGNiMzBjNjY5
YjFiNy4uYmE2MDY0MTQ3MTczIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvaTkxNV9nZW1fZXZpY3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvaTkxNV9nZW1fZXZpY3QuYwpAQCAtMTA2LDE0ICsxMDYsMTEgQEAgc3RhdGljIGludCBwb3B1
bGF0ZV9nZ3R0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCiBzdGF0aWMgdm9pZCB1
bnBpbl9nZ3R0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQogewotCXN0cnVjdCBpOTE1
X2dndHQgKmdndHQgPSAmaTkxNS0+Z2d0dDsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAotCW11
dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAlsaXN0X2Zvcl9lYWNoX2VudHJ5KHZtYSwgJmk5
MTUtPmdndHQudm0uYm91bmRfbGlzdCwgdm1fbGluaykKIAkJaWYgKHZtYS0+b2JqLT5tbS5xdWly
a2VkKQogCQkJaTkxNV92bWFfdW5waW4odm1hKTsKLQltdXRleF91bmxvY2soJmdndHQtPnZtLm11
dGV4KTsKIH0KIAogc3RhdGljIHZvaWQgY2xlYW51cF9vYmplY3RzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICppOTE1LApAQCAtMTI3LDExICsxMjQsNyBAQCBzdGF0aWMgdm9pZCBjbGVhbnVwX29i
amVjdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCWk5MTVfZ2VtX29iamVjdF9w
dXQob2JqKTsKIAl9CiAKLQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwot
CiAJaTkxNV9nZW1fZHJhaW5fZnJlZWRfb2JqZWN0cyhpOTE1KTsKLQotCW11dGV4X2xvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogfQogCiBzdGF0aWMgaW50IGlndF9ldmljdF9zb21ldGhp
bmcodm9pZCAqYXJnKQpAQCAtMTQ4LDEwICsxNDEsMTIgQEAgc3RhdGljIGludCBpZ3RfZXZpY3Rf
c29tZXRoaW5nKHZvaWQgKmFyZykKIAkJZ290byBjbGVhbnVwOwogCiAJLyogRXZlcnl0aGluZyBp
cyBwaW5uZWQsIG5vdGhpbmcgc2hvdWxkIGhhcHBlbiAqLworCW11dGV4X2xvY2soJmdndHQtPnZt
Lm11dGV4KTsKIAllcnIgPSBpOTE1X2dlbV9ldmljdF9zb21ldGhpbmcoJmdndHQtPnZtLAogCQkJ
CSAgICAgICBJOTE1X0dUVF9QQUdFX1NJWkUsIDAsIDAsCiAJCQkJICAgICAgIDAsIFU2NF9NQVgs
CiAJCQkJICAgICAgIDApOworCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWlmIChl
cnIgIT0gLUVOT1NQQykgewogCQlwcl9lcnIoImk5MTVfZ2VtX2V2aWN0X3NvbWV0aGluZyBmYWls
ZWQgb24gYSBmdWxsIEdHVFQgd2l0aCBlcnI9JWRcbiIsCiAJCSAgICAgICBlcnIpOwpAQCAtMTYx
LDEwICsxNTYsMTIgQEAgc3RhdGljIGludCBpZ3RfZXZpY3Rfc29tZXRoaW5nKHZvaWQgKmFyZykK
IAl1bnBpbl9nZ3R0KGk5MTUpOwogCiAJLyogRXZlcnl0aGluZyBpcyB1bnBpbm5lZCwgd2Ugc2hv
dWxkIGJlIGFibGUgdG8gZXZpY3Qgc29tZXRoaW5nICovCisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0u
bXV0ZXgpOwogCWVyciA9IGk5MTVfZ2VtX2V2aWN0X3NvbWV0aGluZygmZ2d0dC0+dm0sCiAJCQkJ
ICAgICAgIEk5MTVfR1RUX1BBR0VfU0laRSwgMCwgMCwKIAkJCQkgICAgICAgMCwgVTY0X01BWCwK
IAkJCQkgICAgICAgMCk7CisJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJaWYgKGVy
cikgewogCQlwcl9lcnIoImk5MTVfZ2VtX2V2aWN0X3NvbWV0aGluZyBmYWlsZWQgb24gYSBmdWxs
IEdHVFQgd2l0aCBlcnI9JWRcbiIsCiAJCSAgICAgICBlcnIpOwpAQCAtMjMwLDcgKzIyNyw5IEBA
IHN0YXRpYyBpbnQgaWd0X2V2aWN0X2Zvcl92bWEodm9pZCAqYXJnKQogCQlnb3RvIGNsZWFudXA7
CiAKIAkvKiBFdmVyeXRoaW5nIGlzIHBpbm5lZCwgbm90aGluZyBzaG91bGQgaGFwcGVuICovCisJ
bXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWVyciA9IGk5MTVfZ2VtX2V2aWN0X2Zvcl9u
b2RlKCZnZ3R0LT52bSwgJnRhcmdldCwgMCk7CisJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRl
eCk7CiAJaWYgKGVyciAhPSAtRU5PU1BDKSB7CiAJCXByX2VycigiaTkxNV9nZW1fZXZpY3RfZm9y
X25vZGUgb24gYSBmdWxsIEdHVFQgcmV0dXJuZWQgZXJyPSVkXG4iLAogCQkgICAgICAgZXJyKTsK
QEAgLTI0MCw3ICsyMzksOSBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9mb3Jfdm1hKHZvaWQgKmFy
ZykKIAl1bnBpbl9nZ3R0KGk5MTUpOwogCiAJLyogRXZlcnl0aGluZyBpcyB1bnBpbm5lZCwgd2Ug
c2hvdWxkIGJlIGFibGUgdG8gZXZpY3QgdGhlIG5vZGUgKi8KKwltdXRleF9sb2NrKCZnZ3R0LT52
bS5tdXRleCk7CiAJZXJyID0gaTkxNV9nZW1fZXZpY3RfZm9yX25vZGUoJmdndHQtPnZtLCAmdGFy
Z2V0LCAwKTsKKwltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAlpZiAoZXJyKSB7CiAJ
CXByX2VycigiaTkxNV9nZW1fZXZpY3RfZm9yX25vZGUgcmV0dXJuZWQgZXJyPSVkXG4iLAogCQkg
ICAgICAgZXJyKTsKQEAgLTMxNyw3ICszMTgsOSBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9mb3Jf
Y2FjaGVfY29sb3Iodm9pZCAqYXJnKQogCWk5MTVfdm1hX3VucGluKHZtYSk7CiAKIAkvKiBSZW1v
dmUganVzdCB0aGUgc2Vjb25kIHZtYSAqLworCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsK
IAllcnIgPSBpOTE1X2dlbV9ldmljdF9mb3Jfbm9kZSgmZ2d0dC0+dm0sICZ0YXJnZXQsIDApOwor
CW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWlmIChlcnIpIHsKIAkJcHJfZXJyKCJb
MF1pOTE1X2dlbV9ldmljdF9mb3Jfbm9kZSByZXR1cm5lZCBlcnI9JWRcbiIsIGVycik7CiAJCWdv
dG8gY2xlYW51cDsKQEAgLTMyOCw3ICszMzEsOSBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9mb3Jf
Y2FjaGVfY29sb3Iodm9pZCAqYXJnKQogCSAqLwogCXRhcmdldC5jb2xvciA9IEk5MTVfQ0FDSEVf
TDNfTExDOwogCisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWVyciA9IGk5MTVfZ2Vt
X2V2aWN0X2Zvcl9ub2RlKCZnZ3R0LT52bSwgJnRhcmdldCwgMCk7CisJbXV0ZXhfdW5sb2NrKCZn
Z3R0LT52bS5tdXRleCk7CiAJaWYgKCFlcnIpIHsKIAkJcHJfZXJyKCJbMV1pOTE1X2dlbV9ldmlj
dF9mb3Jfbm9kZSByZXR1cm5lZCBlcnI9JWRcbiIsIGVycik7CiAJCWVyciA9IC1FSU5WQUw7CkBA
IC0zNTgsNyArMzYzLDkgQEAgc3RhdGljIGludCBpZ3RfZXZpY3Rfdm0odm9pZCAqYXJnKQogCQln
b3RvIGNsZWFudXA7CiAKIAkvKiBFdmVyeXRoaW5nIGlzIHBpbm5lZCwgbm90aGluZyBzaG91bGQg
aGFwcGVuICovCisJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCWVyciA9IGk5MTVfZ2Vt
X2V2aWN0X3ZtKCZnZ3R0LT52bSk7CisJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJ
aWYgKGVycikgewogCQlwcl9lcnIoImk5MTVfZ2VtX2V2aWN0X3ZtIG9uIGEgZnVsbCBHR1RUIHJl
dHVybmVkIGVycj0lZF1cbiIsCiAJCSAgICAgICBlcnIpOwpAQCAtMzY3LDcgKzM3NCw5IEBAIHN0
YXRpYyBpbnQgaWd0X2V2aWN0X3ZtKHZvaWQgKmFyZykKIAogCXVucGluX2dndHQoaTkxNSk7CiAK
KwltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJZXJyID0gaTkxNV9nZW1fZXZpY3Rfdm0o
JmdndHQtPnZtKTsKKwltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAlpZiAoZXJyKSB7
CiAJCXByX2VycigiaTkxNV9nZW1fZXZpY3Rfdm0gb24gYSBmdWxsIEdHVFQgcmV0dXJuZWQgZXJy
PSVkXVxuIiwKIAkJICAgICAgIGVycik7CkBAIC00MDgsMTEgKzQxNywxMSBAQCBzdGF0aWMgaW50
IGlndF9ldmljdF9jb250ZXh0cyh2b2lkICphcmcpCiAJaWYgKCFIQVNfRlVMTF9QUEdUVChpOTE1
KSkKIAkJcmV0dXJuIDA7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
IAl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwogCiAJ
LyogUmVzZXJ2ZSBhIGJsb2NrIHNvIHRoYXQgd2Uga25vdyB3ZSBoYXZlIGVub3VnaCB0byBmaXQg
YSBmZXcgcnEgKi8KIAltZW1zZXQoJmhvbGUsIDAsIHNpemVvZihob2xlKSk7CisJbXV0ZXhfbG9j
aygmaTkxNS0+Z2d0dC52bS5tdXRleCk7CiAJZXJyID0gaTkxNV9nZW1fZ3R0X2luc2VydCgmaTkx
NS0+Z2d0dC52bSwgJmhvbGUsCiAJCQkJICBQUkVURU5EX0dHVFRfU0laRSwgMCwgSTkxNV9DT0xP
Ul9VTkVWSUNUQUJMRSwKIAkJCQkgIDAsIGk5MTUtPmdndHQudm0udG90YWwsCkBAIC00MjUsNyAr
NDM0LDkgQEAgc3RhdGljIGludCBpZ3RfZXZpY3RfY29udGV4dHModm9pZCAqYXJnKQogCWRvIHsK
IAkJc3RydWN0IHJlc2VydmVkICpyOwogCisJCW11dGV4X3VubG9jaygmaTkxNS0+Z2d0dC52bS5t
dXRleCk7CiAJCXIgPSBrY2FsbG9jKDEsIHNpemVvZigqciksIEdGUF9LRVJORUwpOworCQltdXRl
eF9sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIAkJaWYgKCFyKSB7CiAJCQllcnIgPSAtRU5P
TUVNOwogCQkJZ290byBvdXRfbG9ja2VkOwpAQCAtNDQ1LDcgKzQ1Niw3IEBAIHN0YXRpYyBpbnQg
aWd0X2V2aWN0X2NvbnRleHRzKHZvaWQgKmFyZykKIAkJY291bnQrKzsKIAl9IHdoaWxlICgxKTsK
IAlkcm1fbW1fcmVtb3ZlX25vZGUoJmhvbGUpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIAlwcl9p
bmZvKCJGaWxsZWQgR0dUVCB3aXRoICVsdSAxTWlCIG5vZGVzXG4iLCBjb3VudCk7CiAKIAkvKiBP
dmVyZmlsbCB0aGUgR0dUVCB3aXRoIGNvbnRleHQgb2JqZWN0cyBhbmQgc28gdHJ5IHRvIGV2aWN0
IG9uZS4gKi8KQEAgLTUwOCw3ICs1MTksNyBAQCBzdGF0aWMgaW50IGlndF9ldmljdF9jb250ZXh0
cyh2b2lkICphcmcpCiAJCQlicmVhazsKIAl9CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKKwltdXRleF9sb2NrKCZpOTE1LT5nZ3R0LnZtLm11dGV4KTsKIG91dF9sb2Nr
ZWQ6CiAJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQogCQllcnIg
PSAtRUlPOwpAQCAtNTIyLDggKzUzMyw4IEBAIHN0YXRpYyBpbnQgaWd0X2V2aWN0X2NvbnRleHRz
KHZvaWQgKmFyZykKIAl9CiAJaWYgKGRybV9tbV9ub2RlX2FsbG9jYXRlZCgmaG9sZSkpCiAJCWRy
bV9tbV9yZW1vdmVfbm9kZSgmaG9sZSk7CisJbXV0ZXhfdW5sb2NrKCZpOTE1LT5nZ3R0LnZtLm11
dGV4KTsKIAlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVudGltZV9wbSwgd2FrZXJlZik7
Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCXJldHVybiBlcnI7
CiB9CkBAIC01NDUsMTIgKzU1Niw5IEBAIGludCBpOTE1X2dlbV9ldmljdF9tb2NrX3NlbGZ0ZXN0
cyh2b2lkKQogCWlmICghaTkxNSkKIAkJcmV0dXJuIC1FTk9NRU07CiAKLQltdXRleF9sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAl3aXRoX2ludGVsX3J1bnRpbWVfcG0oJmk5MTUtPnJ1
bnRpbWVfcG0sIHdha2VyZWYpCiAJCWVyciA9IGk5MTVfc3VidGVzdHModGVzdHMsIGk5MTUpOwog
Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWRybV9kZXZfcHV0
KCZpOTE1LT5kcm0pOwogCXJldHVybiBlcnI7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9z
ZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMKaW5kZXggYTkwYzliZTk1ZjhjLi4zMzczZjIwZmIxNDQg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ndHQu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMKQEAg
LTM1LDE2ICszNSw3IEBACiAKIHN0YXRpYyB2b2lkIGNsZWFudXBfZnJlZWRfb2JqZWN0cyhzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQkvKgotCSAqIEFzIHdlIG1heSBob2xkIG9u
dG8gdGhlIHN0cnVjdF9tdXRleCBmb3IgaW5vcmRpbmF0ZSBsZW5ndGhzIG9mCi0JICogdGltZSwg
dGhlIE5NSSBraHVuZ3Rhc2tkIGRldGVjdG9yIG1heSBmaXJlIGZvciB0aGUgZnJlZSBvYmplY3Rz
Ci0JICogd29ya2VyLgotCSAqLwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7Ci0KIAlpOTE1X2dlbV9kcmFpbl9mcmVlZF9vYmplY3RzKGk5MTUpOwotCi0JbXV0ZXhfbG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiB9CiAKIHN0YXRpYyB2b2lkIGZha2VfZnJlZV9w
YWdlcyhzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLApAQCAtMzE4LDYgKzMwOSwxNyBA
QCBzdGF0aWMgaW50IGxvd2xldmVsX2hvbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUs
CiAJcmV0dXJuIDA7CiB9CiAKK3N0YXRpYyBpbnQgdW5sb2NrZWRfdm1hX3VuYmluZChzdHJ1Y3Qg
aTkxNV92bWEgKnZtYSkKK3sKKwlpbnQgcmV0OworCisJbXV0ZXhfbG9jaygmdm1hLT52bS0+bXV0
ZXgpOworCXJldCA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCW11dGV4X3VubG9jaygmdm1hLT52
bS0+bXV0ZXgpOworCisJcmV0dXJuIHJldDsKK30KKwogc3RhdGljIHZvaWQgY2xvc2Vfb2JqZWN0
X2xpc3Qoc3RydWN0IGxpc3RfaGVhZCAqb2JqZWN0cywKIAkJCSAgICAgIHN0cnVjdCBpOTE1X2Fk
ZHJlc3Nfc3BhY2UgKnZtKQogewpAQCAtMzI5LDcgKzMzMSw3IEBAIHN0YXRpYyB2b2lkIGNsb3Nl
X29iamVjdF9saXN0KHN0cnVjdCBsaXN0X2hlYWQgKm9iamVjdHMsCiAKIAkJdm1hID0gaTkxNV92
bWFfaW5zdGFuY2Uob2JqLCB2bSwgTlVMTCk7CiAJCWlmICghSVNfRVJSKHZtYSkpCi0JCQlpZ25v
cmVkID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CisJCQlpZ25vcmVkID0gdW5sb2NrZWRfdm1hX3Vu
YmluZCh2bWEpOwogCQkvKiBPbmx5IHBwZ3R0IHZtYSBtYXkgYmUgY2xvc2VkIGJlZm9yZSB0aGUg
b2JqZWN0IGlzIGZyZWVkICovCiAJCWlmICghSVNfRVJSKHZtYSkgJiYgIWk5MTVfdm1hX2lzX2dn
dHQodm1hKSkKIAkJCWk5MTVfdm1hX2Nsb3NlKHZtYSk7CkBAIC00NDQsNyArNDQ2LDcgQEAgc3Rh
dGljIGludCBmaWxsX2hvbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJCQln
b3RvIGVycjsKIAkJCQkJfQogCi0JCQkJCWVyciA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQkJ
CQllcnIgPSB1bmxvY2tlZF92bWFfdW5iaW5kKHZtYSk7CiAJCQkJCWlmIChlcnIpIHsKIAkJCQkJ
CXByX2VycigiJXMoJXMpIChmb3J3YXJkKSB1bmJpbmQgb2Ygdm1hLm5vZGU9JWxseCArICVsbHgg
ZmFpbGVkIHdpdGggZXJyPSVkXG4iLAogCQkJCQkJICAgICAgIF9fZnVuY19fLCBwLT5uYW1lLCB2
bWEtPm5vZGUuc3RhcnQsIHZtYS0+bm9kZS5zaXplLApAQCAtNTE3LDcgKzUxOSw3IEBAIHN0YXRp
YyBpbnQgZmlsbF9ob2xlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJCQkJZ290
byBlcnI7CiAJCQkJCX0KIAotCQkJCQllcnIgPSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJCQkJ
ZXJyID0gdW5sb2NrZWRfdm1hX3VuYmluZCh2bWEpOwogCQkJCQlpZiAoZXJyKSB7CiAJCQkJCQlw
cl9lcnIoIiVzKCVzKSAoYmFja3dhcmQpIHVuYmluZCBvZiB2bWEubm9kZT0lbGx4ICsgJWxseCBm
YWlsZWQgd2l0aCBlcnI9JWRcbiIsCiAJCQkJCQkgICAgICAgX19mdW5jX18sIHAtPm5hbWUsIHZt
YS0+bm9kZS5zdGFydCwgdm1hLT5ub2RlLnNpemUsCkBAIC02MDQsNyArNjA2LDcgQEAgc3RhdGlj
IGludCB3YWxrX2hvbGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCQkJZ290byBl
cnJfY2xvc2U7CiAJCQl9CiAKLQkJCWVyciA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQkJZXJy
ID0gdW5sb2NrZWRfdm1hX3VuYmluZCh2bWEpOwogCQkJaWYgKGVycikgewogCQkJCXByX2Vycigi
JXMgdW5iaW5kIGZhaWxlZCBhdCAlbGx4ICsgJWxseCAgd2l0aCBlcnI9JWRcbiIsCiAJCQkJICAg
ICAgIF9fZnVuY19fLCBhZGRyLCB2bWEtPnNpemUsIGVycik7CkBAIC02ODUsMTMgKzY4NywxMyBA
QCBzdGF0aWMgaW50IHBvdF9ob2xlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkJ
CXByX2VycigiJXMgaW5jb3JyZWN0IGF0ICVsbHggKyAlbGx4XG4iLAogCQkJCSAgICAgICBfX2Z1
bmNfXywgYWRkciwgdm1hLT5zaXplKTsKIAkJCQlpOTE1X3ZtYV91bnBpbih2bWEpOwotCQkJCWVy
ciA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQkJCWVyciA9IHVubG9ja2VkX3ZtYV91bmJpbmQo
dm1hKTsKIAkJCQllcnIgPSAtRUlOVkFMOwogCQkJCWdvdG8gZXJyOwogCQkJfQogCiAJCQlpOTE1
X3ZtYV91bnBpbih2bWEpOwotCQkJZXJyID0gaTkxNV92bWFfdW5iaW5kKHZtYSk7CisJCQllcnIg
PSB1bmxvY2tlZF92bWFfdW5iaW5kKHZtYSk7CiAJCQlHRU1fQlVHX09OKGVycik7CiAJCX0KIApA
QCAtNzg5LDEzICs3OTEsMTMgQEAgc3RhdGljIGludCBkcnVua19ob2xlKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1LAogCQkJCXByX2VycigiJXMgaW5jb3JyZWN0IGF0ICVsbHggKyAlbGx4
XG4iLAogCQkJCSAgICAgICBfX2Z1bmNfXywgYWRkciwgQklUX1VMTChzaXplKSk7CiAJCQkJaTkx
NV92bWFfdW5waW4odm1hKTsKLQkJCQllcnIgPSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJCQll
cnIgPSB1bmxvY2tlZF92bWFfdW5iaW5kKHZtYSk7CiAJCQkJZXJyID0gLUVJTlZBTDsKIAkJCQln
b3RvIGVycjsKIAkJCX0KIAogCQkJaTkxNV92bWFfdW5waW4odm1hKTsKLQkJCWVyciA9IGk5MTVf
dm1hX3VuYmluZCh2bWEpOworCQkJZXJyID0gdW5sb2NrZWRfdm1hX3VuYmluZCh2bWEpOwogCQkJ
R0VNX0JVR19PTihlcnIpOwogCiAJCQlpZiAoaWd0X3RpbWVvdXQoZW5kX3RpbWUsCkBAIC04Njcs
NyArODY5LDcgQEAgc3RhdGljIGludCBfX3Nocmlua19ob2xlKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAogCQkJcHJfZXJyKCIlcyBpbmNvcnJlY3QgYXQgJWxseCArICVsbHhcbiIsCiAJ
CQkgICAgICAgX19mdW5jX18sIGFkZHIsIHNpemUpOwogCQkJaTkxNV92bWFfdW5waW4odm1hKTsK
LQkJCWVyciA9IGk5MTVfdm1hX3VuYmluZCh2bWEpOworCQkJZXJyID0gdW5sb2NrZWRfdm1hX3Vu
YmluZCh2bWEpOwogCQkJZXJyID0gLUVJTlZBTDsKIAkJCWJyZWFrOwogCQl9CkBAIC04NzUsNiAr
ODc3LDE1IEBAIHN0YXRpYyBpbnQgX19zaHJpbmtfaG9sZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSwKIAkJaTkxNV92bWFfdW5waW4odm1hKTsKIAkJYWRkciArPSBzaXplOwogCisJCS8q
CisJCSAqIFNpbmNlIHdlIGFyZSBpbmplY3RpbmcgYWxsb2NhdGlvbiBmYXVsdHMgYXQgcmFuZG9t
IGludGVydmFscywKKwkJICogd2FpdCBmb3IgdGhpcyBhbGxvY2F0aW9uIHRvIGNvbXBsZXRlIGJl
Zm9yZSB3ZSBjaGFuZ2UgdGhlCisJCSAqIGZhdWx0aW5qZWN0aW9uLgorCQkgKi8KKwkJZXJyID0g
aTkxNV9hY3RpdmVfd2FpdCgmdm1hLT5hY3RpdmUpOworCQlpZiAoZXJyKQorCQkJYnJlYWs7CisK
IAkJaWYgKGlndF90aW1lb3V0KGVuZF90aW1lLAogCQkJCSIlcyB0aW1lZCBvdXQgYXQgb2ZzZXQg
JWxseCBbJWxseCAtICVsbHhdXG4iLAogCQkJCV9fZnVuY19fLCBhZGRyLCBob2xlX3N0YXJ0LCBo
b2xlX2VuZCkpIHsKQEAgLTEwMDgsMjEgKzEwMTksMTkgQEAgc3RhdGljIGludCBleGVyY2lzZV9w
cGd0dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaWYgKElTX0VSUihmaWxl
KSkKIAkJcmV0dXJuIFBUUl9FUlIoZmlsZSk7CiAKLQltdXRleF9sb2NrKCZkZXZfcHJpdi0+ZHJt
LnN0cnVjdF9tdXRleCk7CiAJcHBndHQgPSBpOTE1X3BwZ3R0X2NyZWF0ZShkZXZfcHJpdik7CiAJ
aWYgKElTX0VSUihwcGd0dCkpIHsKIAkJZXJyID0gUFRSX0VSUihwcGd0dCk7Ci0JCWdvdG8gb3V0
X3VubG9jazsKKwkJZ290byBvdXRfZnJlZTsKIAl9CiAJR0VNX0JVR19PTihvZmZzZXRfaW5fcGFn
ZShwcGd0dC0+dm0udG90YWwpKTsKLQlHRU1fQlVHX09OKHBwZ3R0LT52bS5jbG9zZWQpOworCUdF
TV9CVUdfT04oIWF0b21pY19yZWFkKCZwcGd0dC0+dm0ub3BlbikpOwogCiAJZXJyID0gZnVuYyhk
ZXZfcHJpdiwgJnBwZ3R0LT52bSwgMCwgcHBndHQtPnZtLnRvdGFsLCBlbmRfdGltZSk7CiAKIAlp
OTE1X3ZtX3B1dCgmcHBndHQtPnZtKTsKLW91dF91bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZkZXZf
cHJpdi0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKK291dF9mcmVlOgogCW1vY2tfZmlsZV9mcmVlKGRl
dl9wcml2LCBmaWxlKTsKIAlyZXR1cm4gZXJyOwogfQpAQCAtMTA4NSw3ICsxMDk0LDYgQEAgc3Rh
dGljIGludCBleGVyY2lzZV9nZ3R0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCUlH
VF9USU1FT1VUKGVuZF90aW1lKTsKIAlpbnQgZXJyID0gMDsKIAotCW11dGV4X2xvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogcmVzdGFydDoKIAlsaXN0X3NvcnQoTlVMTCwgJmdndHQtPnZt
Lm1tLmhvbGVfc3RhY2ssIHNvcnRfaG9sZXMpOwogCWRybV9tbV9mb3JfZWFjaF9ob2xlKG5vZGUs
ICZnZ3R0LT52bS5tbSwgaG9sZV9zdGFydCwgaG9sZV9lbmQpIHsKQEAgLTExMDYsNyArMTExNCw2
IEBAIHN0YXRpYyBpbnQgZXhlcmNpc2VfZ2d0dChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkx
NSwKIAkJbGFzdCA9IGhvbGVfZW5kOwogCQlnb3RvIHJlc3RhcnQ7CiAJfQotCW11dGV4X3VubG9j
aygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlyZXR1cm4gZXJyOwogfQpAQCAtMTE0OCwx
MyArMTE1NSw5IEBAIHN0YXRpYyBpbnQgaWd0X2dndHRfcGFnZSh2b2lkICphcmcpCiAJdW5zaWdu
ZWQgaW50ICpvcmRlciwgbjsKIAlpbnQgZXJyOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7Ci0KIAlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3JlYXRlX2ludGVybmFsKGk5
MTUsIFBBR0VfU0laRSk7Ci0JaWYgKElTX0VSUihvYmopKSB7Ci0JCWVyciA9IFBUUl9FUlIob2Jq
KTsKLQkJZ290byBvdXRfdW5sb2NrOwotCX0KKwlpZiAoSVNfRVJSKG9iaikpCisJCXJldHVybiBQ
VFJfRVJSKG9iaik7CiAKIAllcnIgPSBpOTE1X2dlbV9vYmplY3RfcGluX3BhZ2VzKG9iaik7CiAJ
aWYgKGVycikKQEAgLTEyMjIsOCArMTIyNSw2IEBAIHN0YXRpYyBpbnQgaWd0X2dndHRfcGFnZSh2
b2lkICphcmcpCiAJaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKG9iaik7CiBvdXRfZnJlZToK
IAlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7Ci1vdXRfdW5sb2NrOgotCW11dGV4X3VubG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMTMzMCwxMSAr
MTMzMSwxMyBAQCBzdGF0aWMgaW50IGlndF9ndHRfcmVzZXJ2ZSh2b2lkICphcmcpCiAJCQlnb3Rv
IG91dDsKIAkJfQogCisJCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJZXJyID0gaTkx
NV9nZW1fZ3R0X3Jlc2VydmUoJmdndHQtPnZtLCAmdm1hLT5ub2RlLAogCQkJCQkgICBvYmotPmJh
c2Uuc2l6ZSwKIAkJCQkJICAgdG90YWwsCiAJCQkJCSAgIG9iai0+Y2FjaGVfbGV2ZWwsCiAJCQkJ
CSAgIDApOworCQltdXRleF91bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJaWYgKGVycikgewog
CQkJcHJfZXJyKCJpOTE1X2dlbV9ndHRfcmVzZXJ2ZSAocGFzcyAxKSBmYWlsZWQgYXQgJWxsdS8l
bGx1IHdpdGggZXJyPSVkXG4iLAogCQkJICAgICAgIHRvdGFsLCBnZ3R0LT52bS50b3RhbCwgZXJy
KTsKQEAgLTEzODAsMTEgKzEzODMsMTMgQEAgc3RhdGljIGludCBpZ3RfZ3R0X3Jlc2VydmUodm9p
ZCAqYXJnKQogCQkJZ290byBvdXQ7CiAJCX0KIAorCQltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRl
eCk7CiAJCWVyciA9IGk5MTVfZ2VtX2d0dF9yZXNlcnZlKCZnZ3R0LT52bSwgJnZtYS0+bm9kZSwK
IAkJCQkJICAgb2JqLT5iYXNlLnNpemUsCiAJCQkJCSAgIHRvdGFsLAogCQkJCQkgICBvYmotPmNh
Y2hlX2xldmVsLAogCQkJCQkgICAwKTsKKwkJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7
CiAJCWlmIChlcnIpIHsKIAkJCXByX2VycigiaTkxNV9nZW1fZ3R0X3Jlc2VydmUgKHBhc3MgMikg
ZmFpbGVkIGF0ICVsbHUvJWxsdSB3aXRoIGVycj0lZFxuIiwKIAkJCSAgICAgICB0b3RhbCwgZ2d0
dC0+dm0udG90YWwsIGVycik7CkBAIC0xNDE0LDcgKzE0MTksNyBAQCBzdGF0aWMgaW50IGlndF9n
dHRfcmVzZXJ2ZSh2b2lkICphcmcpCiAJCQlnb3RvIG91dDsKIAkJfQogCi0JCWVyciA9IGk5MTVf
dm1hX3VuYmluZCh2bWEpOworCQllcnIgPSB1bmxvY2tlZF92bWFfdW5iaW5kKHZtYSk7CiAJCWlm
IChlcnIpIHsKIAkJCXByX2VycigiaTkxNV92bWFfdW5iaW5kIGZhaWxlZCB3aXRoIGVycj0lZCFc
biIsIGVycik7CiAJCQlnb3RvIG91dDsKQEAgLTE0MjQsMTEgKzE0MjksMTMgQEAgc3RhdGljIGlu
dCBpZ3RfZ3R0X3Jlc2VydmUodm9pZCAqYXJnKQogCQkJCSAgICAgICAyKkk5MTVfR1RUX1BBR0Vf
U0laRSwKIAkJCQkgICAgICAgSTkxNV9HVFRfTUlOX0FMSUdOTUVOVCk7CiAKKwkJbXV0ZXhfbG9j
aygmZ2d0dC0+dm0ubXV0ZXgpOwogCQllcnIgPSBpOTE1X2dlbV9ndHRfcmVzZXJ2ZSgmZ2d0dC0+
dm0sICZ2bWEtPm5vZGUsCiAJCQkJCSAgIG9iai0+YmFzZS5zaXplLAogCQkJCQkgICBvZmZzZXQs
CiAJCQkJCSAgIG9iai0+Y2FjaGVfbGV2ZWwsCiAJCQkJCSAgIDApOworCQltdXRleF91bmxvY2so
JmdndHQtPnZtLm11dGV4KTsKIAkJaWYgKGVycikgewogCQkJcHJfZXJyKCJpOTE1X2dlbV9ndHRf
cmVzZXJ2ZSAocGFzcyAzKSBmYWlsZWQgYXQgJWxsdS8lbGx1IHdpdGggZXJyPSVkXG4iLAogCQkJ
ICAgICAgIHRvdGFsLCBnZ3R0LT52bS50b3RhbCwgZXJyKTsKQEAgLTE0OTcsMTEgKzE1MDQsMTMg
QEAgc3RhdGljIGludCBpZ3RfZ3R0X2luc2VydCh2b2lkICphcmcpCiAKIAkvKiBDaGVjayBhIGNv
dXBsZSBvZiBvYnZpb3VzbHkgaW52YWxpZCByZXF1ZXN0cyAqLwogCWZvciAoaWkgPSBpbnZhbGlk
X2luc2VydDsgaWktPnNpemU7IGlpKyspIHsKKwkJbXV0ZXhfbG9jaygmZ2d0dC0+dm0ubXV0ZXgp
OwogCQllcnIgPSBpOTE1X2dlbV9ndHRfaW5zZXJ0KCZnZ3R0LT52bSwgJnRtcCwKIAkJCQkJICBp
aS0+c2l6ZSwgaWktPmFsaWdubWVudCwKIAkJCQkJICBJOTE1X0NPTE9SX1VORVZJQ1RBQkxFLAog
CQkJCQkgIGlpLT5zdGFydCwgaWktPmVuZCwKIAkJCQkJICAwKTsKKwkJbXV0ZXhfdW5sb2NrKCZn
Z3R0LT52bS5tdXRleCk7CiAJCWlmIChlcnIgIT0gLUVOT1NQQykgewogCQkJcHJfZXJyKCJJbnZh
bGlkIGk5MTVfZ2VtX2d0dF9pbnNlcnQoLnNpemU9JWxseCwgLmFsaWdubWVudD0lbGx4LCAuc3Rh
cnQ9JWxseCwgLmVuZD0lbGx4KSBzdWNjZWVkZWQgKGVycj0lZClcbiIsCiAJCQkgICAgICAgaWkt
PnNpemUsIGlpLT5hbGlnbm1lbnQsIGlpLT5zdGFydCwgaWktPmVuZCwKQEAgLTE1MzcsMTAgKzE1
NDYsMTIgQEAgc3RhdGljIGludCBpZ3RfZ3R0X2luc2VydCh2b2lkICphcmcpCiAJCQlnb3RvIG91
dDsKIAkJfQogCisJCW11dGV4X2xvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJZXJyID0gaTkxNV9n
ZW1fZ3R0X2luc2VydCgmZ2d0dC0+dm0sICZ2bWEtPm5vZGUsCiAJCQkJCSAgb2JqLT5iYXNlLnNp
emUsIDAsIG9iai0+Y2FjaGVfbGV2ZWwsCiAJCQkJCSAgMCwgZ2d0dC0+dm0udG90YWwsCiAJCQkJ
CSAgMCk7CisJCW11dGV4X3VubG9jaygmZ2d0dC0+dm0ubXV0ZXgpOwogCQlpZiAoZXJyID09IC1F
Tk9TUEMpIHsKIAkJCS8qIG1heGVkIG91dCB0aGUgR0dUVCBzcGFjZSAqLwogCQkJaTkxNV9nZW1f
b2JqZWN0X3B1dChvYmopOwpAQCAtMTU4OSwxNiArMTYwMCwxOCBAQCBzdGF0aWMgaW50IGlndF9n
dHRfaW5zZXJ0KHZvaWQgKmFyZykKIAkJR0VNX0JVR19PTighZHJtX21tX25vZGVfYWxsb2NhdGVk
KCZ2bWEtPm5vZGUpKTsKIAkJb2Zmc2V0ID0gdm1hLT5ub2RlLnN0YXJ0OwogCi0JCWVyciA9IGk5
MTVfdm1hX3VuYmluZCh2bWEpOworCQllcnIgPSB1bmxvY2tlZF92bWFfdW5iaW5kKHZtYSk7CiAJ
CWlmIChlcnIpIHsKIAkJCXByX2VycigiaTkxNV92bWFfdW5iaW5kIGZhaWxlZCB3aXRoIGVycj0l
ZCFcbiIsIGVycik7CiAJCQlnb3RvIG91dDsKIAkJfQogCisJCW11dGV4X2xvY2soJmdndHQtPnZt
Lm11dGV4KTsKIAkJZXJyID0gaTkxNV9nZW1fZ3R0X2luc2VydCgmZ2d0dC0+dm0sICZ2bWEtPm5v
ZGUsCiAJCQkJCSAgb2JqLT5iYXNlLnNpemUsIDAsIG9iai0+Y2FjaGVfbGV2ZWwsCiAJCQkJCSAg
MCwgZ2d0dC0+dm0udG90YWwsCiAJCQkJCSAgMCk7CisJCW11dGV4X3VubG9jaygmZ2d0dC0+dm0u
bXV0ZXgpOwogCQlpZiAoZXJyKSB7CiAJCQlwcl9lcnIoImk5MTVfZ2VtX2d0dF9pbnNlcnQgKHBh
c3MgMikgZmFpbGVkIGF0ICVsbHUvJWxsdSB3aXRoIGVycj0lZFxuIiwKIAkJCSAgICAgICB0b3Rh
bCwgZ2d0dC0+dm0udG90YWwsIGVycik7CkBAIC0xNjQyLDEwICsxNjU1LDEyIEBAIHN0YXRpYyBp
bnQgaWd0X2d0dF9pbnNlcnQodm9pZCAqYXJnKQogCQkJZ290byBvdXQ7CiAJCX0KIAorCQltdXRl
eF9sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAJCWVyciA9IGk5MTVfZ2VtX2d0dF9pbnNlcnQoJmdn
dHQtPnZtLCAmdm1hLT5ub2RlLAogCQkJCQkgIG9iai0+YmFzZS5zaXplLCAwLCBvYmotPmNhY2hl
X2xldmVsLAogCQkJCQkgIDAsIGdndHQtPnZtLnRvdGFsLAogCQkJCQkgIDApOworCQltdXRleF91
bmxvY2soJmdndHQtPnZtLm11dGV4KTsKIAkJaWYgKGVycikgewogCQkJcHJfZXJyKCJpOTE1X2dl
bV9ndHRfaW5zZXJ0IChwYXNzIDMpIGZhaWxlZCBhdCAlbGx1LyVsbHUgd2l0aCBlcnI9JWRcbiIs
CiAJCQkgICAgICAgdG90YWwsIGdndHQtPnZtLnRvdGFsLCBlcnIpOwpAQCAtMTY4OSw4ICsxNzA0
LDkgQEAgaW50IGk5MTVfZ2VtX2d0dF9tb2NrX3NlbGZ0ZXN0cyh2b2lkKQogCX0KIAltb2NrX2lu
aXRfZ2d0dChpOTE1LCBnZ3R0KTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwogCWVyciA9IGk5MTVfc3VidGVzdHModGVzdHMsIGdndHQpOworCisJbXV0ZXhfbG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJbW9ja19kZXZpY2VfZmx1c2goaTkxNSk7CiAJbXV0
ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfdm1hLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9zZWxmdGVzdHMvaTkxNV92bWEuYwppbmRleCBhNWJlYzBhNGNkY2MuLjUzYWFmYjlhM2Q2NCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfdm1hLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfdm1hLmMKQEAgLTMzNyw3ICsz
MzcsOSBAQCBzdGF0aWMgaW50IGlndF92bWFfcGluMSh2b2lkICphcmcpCiAKIAkJaWYgKCFlcnIp
IHsKIAkJCWk5MTVfdm1hX3VucGluKHZtYSk7CisJCQltdXRleF9sb2NrKCZnZ3R0LT52bS5tdXRl
eCk7CiAJCQllcnIgPSBpOTE1X3ZtYV91bmJpbmQodm1hKTsKKwkJCW11dGV4X3VubG9jaygmZ2d0
dC0+dm0ubXV0ZXgpOwogCQkJaWYgKGVycikgewogCQkJCXByX2VycigiRmFpbGVkIHRvIHVuYmlu
ZCBzaW5nbGUgcGFnZSBmcm9tIEdHVFQsIGVycj0lZFxuIiwgZXJyKTsKIAkJCQlnb3RvIG91dDsK
LS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
Cmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 0DFF991E6F
	for <lists+intel-gfx@lfdr.de>; Mon, 19 Aug 2019 09:59:04 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 029196E0C0;
	Mon, 19 Aug 2019 07:59:02 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 465086E0AF
 for <intel-gfx@lists.freedesktop.org>; Mon, 19 Aug 2019 07:58:51 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18185099-1500050 
 for multiple; Mon, 19 Aug 2019 08:58:38 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Mon, 19 Aug 2019 08:58:23 +0100
Message-Id: <20190819075835.20065-7-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0.rc1
In-Reply-To: <20190819075835.20065-1-chris@chris-wilson.co.uk>
References: <20190819075835.20065-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 06/18] drm/i915: Generalise the clflush
 dma-worker
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RXh0cmFjdCB0aGUgZG1hLWZlbmNlIHdvcmtlciB1c2VkIGJ5IGNsZmx1c2ggZm9yIHdpZGVyIHVz
ZSwgYXMgd2UKYW50aWNpcGF0ZSB1c2luZyB3b3JrZXJzIGNvdXBsZWQgdG8gZG1hLWZlbmNlcyBt
b3JlIGZyZXF1ZW50bHkuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlz
LXdpbHNvbi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZSAgICAgICAg
ICAgICAgIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGZsdXNo
LmMgfCAxMTcgKysrKysrKy0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
c3dfZmVuY2Vfd29yay5jICAgfCAgOTcgKysrKysrKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9zd19mZW5jZV93b3JrLmggICB8ICAzOCArKysrKysrCiA0IGZpbGVzIGNoYW5n
ZWQsIDE3MyBpbnNlcnRpb25zKCspLCA4MCBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0
NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N3X2ZlbmNlX3dvcmsuYwogY3JlYXRlIG1vZGUg
MTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3dfZmVuY2Vfd29yay5oCgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9NYWtlZmlsZQppbmRleCA0NWFkZDgxMjA0OGIuLjY1OGI5MzBkMzRhOCAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
TWFrZWZpbGUKQEAgLTYyLDYgKzYyLDcgQEAgaTkxNS15ICs9IFwKIAlpOTE1X21lbWNweS5vIFwK
IAlpOTE1X21tLm8gXAogCWk5MTVfc3dfZmVuY2UubyBcCisJaTkxNV9zd19mZW5jZV93b3JrLm8g
XAogCWk5MTVfc3luY21hcC5vIFwKIAlpOTE1X3VzZXJfZXh0ZW5zaW9ucy5vCiAKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGZsdXNoLmMgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xmbHVzaC5jCmluZGV4IGZiMGVmMTc2YmE1Yi4u
OTFmMGE2MWRhZjk5IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9n
ZW1fY2xmbHVzaC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGZs
dXNoLmMKQEAgLTgsODggKzgsNjEgQEAKIAogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAjaW5jbHVk
ZSAiaTkxNV9nZW1fY2xmbHVzaC5oIgorI2luY2x1ZGUgImk5MTVfc3dfZmVuY2Vfd29yay5oIgog
I2luY2x1ZGUgImk5MTVfdHJhY2UuaCIKIAotc3RhdGljIERFRklORV9TUElOTE9DSyhjbGZsdXNo
X2xvY2spOwotCiBzdHJ1Y3QgY2xmbHVzaCB7Ci0Jc3RydWN0IGRtYV9mZW5jZSBkbWE7IC8qIE11
c3QgYmUgZmlyc3QgZm9yIGRtYV9mZW5jZV9mcmVlKCkgKi8KLQlzdHJ1Y3QgaTkxNV9zd19mZW5j
ZSB3YWl0OwotCXN0cnVjdCB3b3JrX3N0cnVjdCB3b3JrOworCXN0cnVjdCBkbWFfZmVuY2Vfd29y
ayBiYXNlOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7CiB9OwogCi1zdGF0aWMg
Y29uc3QgY2hhciAqaTkxNV9jbGZsdXNoX2dldF9kcml2ZXJfbmFtZShzdHJ1Y3QgZG1hX2ZlbmNl
ICpmZW5jZSkKLXsKLQlyZXR1cm4gRFJJVkVSX05BTUU7Ci19Ci0KLXN0YXRpYyBjb25zdCBjaGFy
ICppOTE1X2NsZmx1c2hfZ2V0X3RpbWVsaW5lX25hbWUoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2Up
Ci17Ci0JcmV0dXJuICJjbGZsdXNoIjsKLX0KLQotc3RhdGljIHZvaWQgaTkxNV9jbGZsdXNoX3Jl
bGVhc2Uoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2UpCi17Ci0Jc3RydWN0IGNsZmx1c2ggKmNsZmx1
c2ggPSBjb250YWluZXJfb2YoZmVuY2UsIHR5cGVvZigqY2xmbHVzaCksIGRtYSk7Ci0KLQlpOTE1
X3N3X2ZlbmNlX2ZpbmkoJmNsZmx1c2gtPndhaXQpOwotCi0JQlVJTERfQlVHX09OKG9mZnNldG9m
KHR5cGVvZigqY2xmbHVzaCksIGRtYSkpOwotCWRtYV9mZW5jZV9mcmVlKCZjbGZsdXNoLT5kbWEp
OwotfQotCi1zdGF0aWMgY29uc3Qgc3RydWN0IGRtYV9mZW5jZV9vcHMgaTkxNV9jbGZsdXNoX29w
cyA9IHsKLQkuZ2V0X2RyaXZlcl9uYW1lID0gaTkxNV9jbGZsdXNoX2dldF9kcml2ZXJfbmFtZSwK
LQkuZ2V0X3RpbWVsaW5lX25hbWUgPSBpOTE1X2NsZmx1c2hfZ2V0X3RpbWVsaW5lX25hbWUsCi0J
LnJlbGVhc2UgPSBpOTE1X2NsZmx1c2hfcmVsZWFzZSwKLX07Ci0KLXN0YXRpYyB2b2lkIF9faTkx
NV9kb19jbGZsdXNoKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCitzdGF0aWMgdm9p
ZCBfX2RvX2NsZmx1c2goc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHsKIAlHRU1f
QlVHX09OKCFpOTE1X2dlbV9vYmplY3RfaGFzX3BhZ2VzKG9iaikpOwogCWRybV9jbGZsdXNoX3Nn
KG9iai0+bW0ucGFnZXMpOwogCWludGVsX2Zyb250YnVmZmVyX2ZsdXNoKG9iai0+ZnJvbnRidWZm
ZXIsIE9SSUdJTl9DUFUpOwogfQogCi1zdGF0aWMgdm9pZCBpOTE1X2NsZmx1c2hfd29yayhzdHJ1
Y3Qgd29ya19zdHJ1Y3QgKndvcmspCitzdGF0aWMgaW50IGNsZmx1c2hfd29yayhzdHJ1Y3QgZG1h
X2ZlbmNlX3dvcmsgKmJhc2UpCiB7Ci0Jc3RydWN0IGNsZmx1c2ggKmNsZmx1c2ggPSBjb250YWlu
ZXJfb2Yod29yaywgdHlwZW9mKCpjbGZsdXNoKSwgd29yayk7Ci0Jc3RydWN0IGRybV9pOTE1X2dl
bV9vYmplY3QgKm9iaiA9IGNsZmx1c2gtPm9iajsKKwlzdHJ1Y3QgY2xmbHVzaCAqY2xmbHVzaCA9
IGNvbnRhaW5lcl9vZihiYXNlLCB0eXBlb2YoKmNsZmx1c2gpLCBiYXNlKTsKKwlzdHJ1Y3QgZHJt
X2k5MTVfZ2VtX29iamVjdCAqb2JqID0gZmV0Y2hfYW5kX3plcm8oJmNsZmx1c2gtPm9iaik7CisJ
aW50IGVycjsKIAotCWlmIChpOTE1X2dlbV9vYmplY3RfcGluX3BhZ2VzKG9iaikpIHsKLQkJRFJN
X0VSUk9SKCJGYWlsZWQgdG8gYWNxdWlyZSBvYmotPnBhZ2VzIGZvciBjbGZsdXNoaW5nXG4iKTsK
LQkJZ290byBvdXQ7Ci0JfQotCi0JX19pOTE1X2RvX2NsZmx1c2gob2JqKTsKKwllcnIgPSBpOTE1
X2dlbV9vYmplY3RfcGluX3BhZ2VzKG9iaik7CisJaWYgKGVycikKKwkJZ290byBwdXQ7CiAKKwlf
X2RvX2NsZmx1c2gob2JqKTsKIAlpOTE1X2dlbV9vYmplY3RfdW5waW5fcGFnZXMob2JqKTsKIAot
b3V0OgorcHV0OgogCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwlyZXR1cm4gZXJyOworfQog
Ci0JZG1hX2ZlbmNlX3NpZ25hbCgmY2xmbHVzaC0+ZG1hKTsKLQlkbWFfZmVuY2VfcHV0KCZjbGZs
dXNoLT5kbWEpOworc3RhdGljIHZvaWQgY2xmbHVzaF9yZWxlYXNlKHN0cnVjdCBkbWFfZmVuY2Vf
d29yayAqYmFzZSkKK3sKKwlzdHJ1Y3QgY2xmbHVzaCAqY2xmbHVzaCA9IGNvbnRhaW5lcl9vZihi
YXNlLCB0eXBlb2YoKmNsZmx1c2gpLCBiYXNlKTsKKworCWlmIChjbGZsdXNoLT5vYmopCisJCWk5
MTVfZ2VtX29iamVjdF9wdXQoY2xmbHVzaC0+b2JqKTsKIH0KIAotc3RhdGljIGludCBfX2k5MTVf
c3dfZmVuY2VfY2FsbAotaTkxNV9jbGZsdXNoX25vdGlmeShzdHJ1Y3QgaTkxNV9zd19mZW5jZSAq
ZmVuY2UsCi0JCSAgICBlbnVtIGk5MTVfc3dfZmVuY2Vfbm90aWZ5IHN0YXRlKQorc3RhdGljIHN0
cnVjdCBjbGZsdXNoICpjbGZsdXNoX3dvcmtfY3JlYXRlKHN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmopCiB7Ci0Jc3RydWN0IGNsZmx1c2ggKmNsZmx1c2ggPSBjb250YWluZXJfb2YoZmVu
Y2UsIHR5cGVvZigqY2xmbHVzaCksIHdhaXQpOworCXN0cnVjdCBjbGZsdXNoICpjbGZsdXNoOwog
Ci0Jc3dpdGNoIChzdGF0ZSkgewotCWNhc2UgRkVOQ0VfQ09NUExFVEU6Ci0JCXNjaGVkdWxlX3dv
cmsoJmNsZmx1c2gtPndvcmspOwotCQlicmVhazsKKwlHRU1fQlVHX09OKCFvYmotPmNhY2hlX2Rp
cnR5KTsKIAotCWNhc2UgRkVOQ0VfRlJFRToKLQkJZG1hX2ZlbmNlX3B1dCgmY2xmbHVzaC0+ZG1h
KTsKLQkJYnJlYWs7Ci0JfQorCWNsZmx1c2ggPSBrbWFsbG9jKHNpemVvZigqY2xmbHVzaCksIEdG
UF9LRVJORUwpOworCWlmICghY2xmbHVzaCkKKwkJcmV0dXJuIE5VTEw7CiAKLQlyZXR1cm4gTk9U
SUZZX0RPTkU7CisJZG1hX2ZlbmNlX3dvcmtfaW5pdCgmY2xmbHVzaC0+YmFzZSwgY2xmbHVzaF93
b3JrLCBjbGZsdXNoX3JlbGVhc2UpOworCWNsZmx1c2gtPm9iaiA9IGk5MTVfZ2VtX29iamVjdF9n
ZXQob2JqKTsgLyogb2JqIDwtPiBjbGZsdXNoIGN5Y2xlICovCisKKwlyZXR1cm4gY2xmbHVzaDsK
IH0KIAogYm9vbCBpOTE1X2dlbV9jbGZsdXNoX29iamVjdChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqLApAQCAtMTI3LDMyICsxMDAsMTYgQEAgYm9vbCBpOTE1X2dlbV9jbGZsdXNoX29i
amVjdChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCiAJY2xmbHVzaCA9IE5VTEw7
CiAJaWYgKCEoZmxhZ3MgJiBJOTE1X0NMRkxVU0hfU1lOQykpCi0JCWNsZmx1c2ggPSBrbWFsbG9j
KHNpemVvZigqY2xmbHVzaCksIEdGUF9LRVJORUwpOworCQljbGZsdXNoID0gY2xmbHVzaF93b3Jr
X2NyZWF0ZShvYmopOwogCWlmIChjbGZsdXNoKSB7Ci0JCUdFTV9CVUdfT04oIW9iai0+Y2FjaGVf
ZGlydHkpOwotCi0JCWRtYV9mZW5jZV9pbml0KCZjbGZsdXNoLT5kbWEsCi0JCQkgICAgICAgJmk5
MTVfY2xmbHVzaF9vcHMsCi0JCQkgICAgICAgJmNsZmx1c2hfbG9jaywKLQkJCSAgICAgICAwLCAw
KTsKLQkJaTkxNV9zd19mZW5jZV9pbml0KCZjbGZsdXNoLT53YWl0LCBpOTE1X2NsZmx1c2hfbm90
aWZ5KTsKLQotCQljbGZsdXNoLT5vYmogPSBpOTE1X2dlbV9vYmplY3RfZ2V0KG9iaik7Ci0JCUlO
SVRfV09SSygmY2xmbHVzaC0+d29yaywgaTkxNV9jbGZsdXNoX3dvcmspOwotCi0JCWRtYV9mZW5j
ZV9nZXQoJmNsZmx1c2gtPmRtYSk7Ci0KLQkJaTkxNV9zd19mZW5jZV9hd2FpdF9yZXNlcnZhdGlv
bigmY2xmbHVzaC0+d2FpdCwKLQkJCQkJCW9iai0+YmFzZS5yZXN2LCBOVUxMLAotCQkJCQkJdHJ1
ZSwgSTkxNV9GRU5DRV9USU1FT1VULAorCQlpOTE1X3N3X2ZlbmNlX2F3YWl0X3Jlc2VydmF0aW9u
KCZjbGZsdXNoLT5iYXNlLmNoYWluLAorCQkJCQkJb2JqLT5iYXNlLnJlc3YsIE5VTEwsIHRydWUs
CisJCQkJCQlJOTE1X0ZFTkNFX1RJTUVPVVQsCiAJCQkJCQlJOTE1X0ZFTkNFX0dGUCk7Ci0KLQkJ
ZG1hX3Jlc3ZfYWRkX2V4Y2xfZmVuY2Uob2JqLT5iYXNlLnJlc3YsCi0JCQkJCQkgICZjbGZsdXNo
LT5kbWEpOwotCi0JCWk5MTVfc3dfZmVuY2VfY29tbWl0KCZjbGZsdXNoLT53YWl0KTsKKwkJZG1h
X3Jlc3ZfYWRkX2V4Y2xfZmVuY2Uob2JqLT5iYXNlLnJlc3YsICZjbGZsdXNoLT5iYXNlLmRtYSk7
CisJCWRtYV9mZW5jZV93b3JrX2NvbW1pdCgmY2xmbHVzaC0+YmFzZSk7CiAJfSBlbHNlIGlmIChv
YmotPm1tLnBhZ2VzKSB7Ci0JCV9faTkxNV9kb19jbGZsdXNoKG9iaik7CisJCV9fZG9fY2xmbHVz
aChvYmopOwogCX0gZWxzZSB7CiAJCUdFTV9CVUdfT04ob2JqLT53cml0ZV9kb21haW4gIT0gSTkx
NV9HRU1fRE9NQUlOX0NQVSk7CiAJfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9zd19mZW5jZV93b3JrLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N3X2ZlbmNl
X3dvcmsuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NAppbmRleCAwMDAwMDAwMDAwMDAuLmNjZDNhNjcw
ODIyNQotLS0gL2Rldi9udWxsCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3dfZmVu
Y2Vfd29yay5jCkBAIC0wLDAgKzEsOTcgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBN
SVQKKworLyoKKyAqIENvcHlyaWdodCDCqSAyMDE5IEludGVsIENvcnBvcmF0aW9uCisgKi8KKwor
I2luY2x1ZGUgImk5MTVfc3dfZmVuY2Vfd29yay5oIgorCitzdGF0aWMgdm9pZCBmZW5jZV93b3Jr
KHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKK3sKKwlzdHJ1Y3QgZG1hX2ZlbmNlX3dvcmsgKmYg
PSBjb250YWluZXJfb2Yod29yaywgdHlwZW9mKCpmKSwgd29yayk7CisJaW50IGVycjsKKworCWVy
ciA9IGYtPmZuKGYpOworCWlmIChlcnIpCisJCWRtYV9mZW5jZV9zZXRfZXJyb3IoJmYtPmRtYSwg
ZXJyKTsKKwlkbWFfZmVuY2Vfc2lnbmFsKCZmLT5kbWEpOworCWRtYV9mZW5jZV9wdXQoJmYtPmRt
YSk7Cit9CisKK3N0YXRpYyBpbnQgX19pOTE1X3N3X2ZlbmNlX2NhbGwKK2ZlbmNlX25vdGlmeShz
dHJ1Y3QgaTkxNV9zd19mZW5jZSAqZmVuY2UsIGVudW0gaTkxNV9zd19mZW5jZV9ub3RpZnkgc3Rh
dGUpCit7CisJc3RydWN0IGRtYV9mZW5jZV93b3JrICpmID0gY29udGFpbmVyX29mKGZlbmNlLCB0
eXBlb2YoKmYpLCBjaGFpbik7CisKKwlzd2l0Y2ggKHN0YXRlKSB7CisJY2FzZSBGRU5DRV9DT01Q
TEVURToKKwkJaWYgKGZlbmNlLT5lcnJvcikgeworCQkJZG1hX2ZlbmNlX3NldF9lcnJvcigmZi0+
ZG1hLCBmZW5jZS0+ZXJyb3IpOworCQkJZi0+Zm4gPSBOVUxMOworCQl9CisKKwkJaWYgKGYtPmZu
KSB7CisJCQlkbWFfZmVuY2VfZ2V0KCZmLT5kbWEpOworCQkJcXVldWVfd29yayhzeXN0ZW1fdW5i
b3VuZF93cSwgJmYtPndvcmspOworCQl9IGVsc2UgeworCQkJZG1hX2ZlbmNlX3NpZ25hbCgmZi0+
ZG1hKTsKKwkJfQorCQlicmVhazsKKworCWNhc2UgRkVOQ0VfRlJFRToKKwkJZG1hX2ZlbmNlX3B1
dCgmZi0+ZG1hKTsKKwkJYnJlYWs7CisJfQorCisJcmV0dXJuIE5PVElGWV9ET05FOworfQorCitz
dGF0aWMgY29uc3QgY2hhciAqZ2V0X2RyaXZlcl9uYW1lKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNl
KQoreworCXJldHVybiAiZG1hLWZlbmNlIjsKK30KKworc3RhdGljIGNvbnN0IGNoYXIgKmdldF90
aW1lbGluZV9uYW1lKHN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlKQoreworCXJldHVybiAid29yayI7
Cit9CisKK3N0YXRpYyB2b2lkIGZlbmNlX3JlbGVhc2Uoc3RydWN0IGRtYV9mZW5jZSAqZmVuY2Up
Cit7CisJc3RydWN0IGRtYV9mZW5jZV93b3JrICpmID0gY29udGFpbmVyX29mKGZlbmNlLCB0eXBl
b2YoKmYpLCBkbWEpOworCisJaWYgKGYtPnJlbGVhc2UpCisJCWYtPnJlbGVhc2UoZik7CisKKwlp
OTE1X3N3X2ZlbmNlX2ZpbmkoJmYtPmNoYWluKTsKKworCUJVSUxEX0JVR19PTihvZmZzZXRvZih0
eXBlb2YoKmYpLCBkbWEpKTsKKwlkbWFfZmVuY2VfZnJlZSgmZi0+ZG1hKTsKK30KKworc3RhdGlj
IGNvbnN0IHN0cnVjdCBkbWFfZmVuY2Vfb3BzIGZlbmNlX29wcyA9IHsKKwkuZ2V0X2RyaXZlcl9u
YW1lID0gZ2V0X2RyaXZlcl9uYW1lLAorCS5nZXRfdGltZWxpbmVfbmFtZSA9IGdldF90aW1lbGlu
ZV9uYW1lLAorCS5yZWxlYXNlID0gZmVuY2VfcmVsZWFzZSwKK307CisKK3ZvaWQgZG1hX2ZlbmNl
X3dvcmtfaW5pdChzdHJ1Y3QgZG1hX2ZlbmNlX3dvcmsgKmYsCisJCQkgaW50ICgqZm4pKHN0cnVj
dCBkbWFfZmVuY2Vfd29yayAqZiksCisJCQkgdm9pZCAoKnJlbGVhc2UpKHN0cnVjdCBkbWFfZmVu
Y2Vfd29yayAqZikpCit7CisJc3Bpbl9sb2NrX2luaXQoJmYtPmxvY2spOworCWRtYV9mZW5jZV9p
bml0KCZmLT5kbWEsICZmZW5jZV9vcHMsICZmLT5sb2NrLCAwLCAwKTsKKwlpOTE1X3N3X2ZlbmNl
X2luaXQoJmYtPmNoYWluLCBmZW5jZV9ub3RpZnkpOworCUlOSVRfV09SSygmZi0+d29yaywgZmVu
Y2Vfd29yayk7CisKKwlmLT5mbiA9IGZuOworCWYtPnJlbGVhc2UgPSByZWxlYXNlOworfQorCitp
bnQgZG1hX2ZlbmNlX3dvcmtfY2hhaW4oc3RydWN0IGRtYV9mZW5jZV93b3JrICpmLCBzdHJ1Y3Qg
ZG1hX2ZlbmNlICpzaWduYWwpCit7CisJaWYgKCFzaWduYWwpCisJCXJldHVybiAwOworCisJcmV0
dXJuIF9faTkxNV9zd19mZW5jZV9hd2FpdF9kbWFfZmVuY2UoJmYtPmNoYWluLCBzaWduYWwsICZm
LT5jYik7Cit9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N3X2ZlbmNl
X3dvcmsuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3dfZmVuY2Vfd29yay5oCm5ldyBm
aWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uMjJmM2VhZjA5MWFhCi0tLSAvZGV2
L251bGwKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zd19mZW5jZV93b3JrLmgKQEAg
LTAsMCArMSwzOCBAQAorLyogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVCAqLworCisvKgor
ICogQ29weXJpZ2h0IMKpIDIwMTkgSW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaWZuZGVmIEk5
MTVfU1dfRkVOQ0VfV09SS19ICisjZGVmaW5lIEk5MTVfU1dfRkVOQ0VfV09SS19ICisKKyNpbmNs
dWRlIDxsaW51eC9kbWEtZmVuY2UuaD4KKyNpbmNsdWRlIDxsaW51eC9zcGlubG9jay5oPgorI2lu
Y2x1ZGUgPGxpbnV4L3dvcmtxdWV1ZS5oPgorCisjaW5jbHVkZSAiaTkxNV9zd19mZW5jZS5oIgor
CitzdHJ1Y3QgZG1hX2ZlbmNlX3dvcmsgeworCXN0cnVjdCBkbWFfZmVuY2UgZG1hOworCXNwaW5s
b2NrX3QgbG9jazsKKworCXN0cnVjdCBpOTE1X3N3X2ZlbmNlIGNoYWluOworCXN0cnVjdCBpOTE1
X3N3X2RtYV9mZW5jZV9jYiBjYjsKKworCXN0cnVjdCB3b3JrX3N0cnVjdCB3b3JrOworCWludCAo
KmZuKShzdHJ1Y3QgZG1hX2ZlbmNlX3dvcmsgKmYpOworCXZvaWQgKCpyZWxlYXNlKShzdHJ1Y3Qg
ZG1hX2ZlbmNlX3dvcmsgKmYpOworfTsKKwordm9pZCBkbWFfZmVuY2Vfd29ya19pbml0KHN0cnVj
dCBkbWFfZmVuY2Vfd29yayAqZiwKKwkJCSBpbnQgKCpmbikoc3RydWN0IGRtYV9mZW5jZV93b3Jr
ICpmKSwKKwkJCSB2b2lkICgqcmVsZWFzZSkoc3RydWN0IGRtYV9mZW5jZV93b3JrICpmKSk7Citp
bnQgZG1hX2ZlbmNlX3dvcmtfY2hhaW4oc3RydWN0IGRtYV9mZW5jZV93b3JrICpmLCBzdHJ1Y3Qg
ZG1hX2ZlbmNlICpzaWduYWwpOworCitzdGF0aWMgaW5saW5lIHZvaWQgZG1hX2ZlbmNlX3dvcmtf
Y29tbWl0KHN0cnVjdCBkbWFfZmVuY2Vfd29yayAqZikKK3sKKwlpOTE1X3N3X2ZlbmNlX2NvbW1p
dCgmZi0+Y2hhaW4pOworfQorCisjZW5kaWYgLyogSTkxNV9TV19GRU5DRV9XT1JLX0ggKi8KLS0g
CjIuMjMuMC5yYzEKCl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9y
ZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdm
eA==

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id C2F993034F
	for <lists+intel-gfx@lfdr.de>; Thu, 30 May 2019 22:35:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E7F106E32B;
	Thu, 30 May 2019 20:35:21 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 69AEA6E32B
 for <intel-gfx@lists.freedesktop.org>; Thu, 30 May 2019 20:35:20 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 16740152-1500050 
 for multiple; Thu, 30 May 2019 21:35:03 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 30 May 2019 21:35:00 +0100
Message-Id: <20190530203500.26272-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190530203500.26272-1-chris@chris-wilson.co.uk>
References: <20190530203500.26272-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 2/2] drm/i915: Report all objects with allocated
 pages to the shrinker
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Matthew Auld <matthew.auld@intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q3VycmVudGx5LCB3ZSB0cnkgdG8gcmVwb3J0IHRvIHRoZSBzaHJpbmtlciB0aGUgcHJlY2lzZSBu
dW1iZXIgb2YKb2JqZWN0cyAocGFnZXMpIHRoYXQgYXJlIGF2YWlsYWJsZSB0byBiZSByZWFwZWQg
YXQgdGhpcyBtb21lbnQuIFRoaXMKcmVxdWlyZXMgc2VhcmNoaW5nIGFsbCBvYmplY3RzIHdpdGgg
YWxsb2NhdGVkIHBhZ2VzIHRvIHNlZSBpZiB0aGV5CmZ1bGZpbGwgdGhlIHNlYXJjaCBjcml0ZXJp
YSwgYW5kIHRoaXMgY291bnQgaXMgcGVyZm9ybWVkIHF1aXRlCmZyZXF1ZW50bHkuIChUaGUgc2hy
aW5rZXIgdHJpZXMgdG8gZnJlZSB+MTI4IHBhZ2VzIG9uIGVhY2ggaW52b2NhdGlvbiwKYmVmb3Jl
IHdoaWNoIHdlIGNvdW50IGFsbCB0aGUgb2JqZWN0czsgY291bnRpbmcgdGFrZXMgbG9uZ2VyIHRo
YW4KdW5iaW5kaW5nIHRoZSBvYmplY3RzISkgSWYgd2UgdGFrZSB0aGUgcHJhZ21hdGljIHZpZXcg
dGhhdCB3aXRoCnN1ZmZpY2llbnQgZGVzaXJlLCBhbGwgb2JqZWN0cyBhcmUgZXZlbnR1YWxseSBy
ZWFwYWJsZSAodGhleSBiZWNvbWUKaW5hY3RpdmUsIG9yIG5vIGxvbmdlciB1c2VkIGFzIGZyYW1l
YnVmZmVyIGV0YyksIHdlIGNhbiBzaW1wbHkgcmV0dXJuCnRoZSBjb3VudCBvZiBwaW5uZWQgcGFn
ZXMgbWFpbnRhaW5lZCBkdXJpbmcgZ2V0X3BhZ2VzL3B1dF9wYWdlcyByYXRoZXIKdGhhbiB3YWxr
IHRoZSBsaXN0cyBldmVyeSB0aW1lLgoKVGhlIGRvd25zaWRlIGlzIHRoYXQgd2UgbWF5IChzbGln
aHRseSkgb3Zlci1yZXBvcnQgdGhlIG51bWJlciBvZgpvYmplY3RzL3BhZ2VzIHdlIGNvdWxkIHNo
cmluayBhbmQgc28gcGVuYWxpemUgb3Vyc2VsdmVzIGJ5IHNocmlua2luZwptb3JlIHRoYW4gcmVx
dWlyZWQuIFRoaXMgaXMgbWl0aWdhdGVkIGJ5IGtlZXBpbmcgdGhlIG9yZGVyIGluIHdoaWNoIHdl
CnNocmluayBvYmplY3RzIHN1Y2ggdGhhdCB3ZSBhdm9pZCBwZW5hbGl6aW5nIGFjdGl2ZSBhbmQg
ZnJlcXVlbnRseSB1c2VkCm9iamVjdHMsIGFuZCBpZiBtZW1vcnkgaXMgc28gdGlnaHQgdGhhdCB3
ZSBuZWVkIHRvIGZyZWUgdGhlbSB3ZSB3b3VsZApuZWVkIHRvIGFueXdheS4KCnYyOiBPbmx5IGV4
cG9zZSBzaHJpbmthYmxlIG9iamVjdHMgdG8gdGhlIHNocmlua2VyOyBhIHNtYWxsIHJlZHVjdGlv
biBpbgpub3QgY29uc2lkZXJpbmcgc3RvbGVuIGFuZCBmb3JlaWduIG9iamVjdHMuCnYzOiBSZXN0
b3JlIHRoZSB0cmFja2luZyBmcm9tIGEgImJhY2t1cCIgY29weSBmcm9tIGJlZm9yZSB0aGUgZ2Vt
LyBzcGxpdAoKU2lnbmVkLW9mZi1ieTogQ2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24u
Y28udWs+CkNjOiBKb29uYXMgTGFodGluZW4gPGpvb25hcy5sYWh0aW5lbkBsaW51eC5pbnRlbC5j
b20+CkNjOiBNYXR0aGV3IEF1bGQgPG1hdHRoZXcuYXVsZEBpbnRlbC5jb20+Ci0tLQogZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jICAgfCAgMyArLQogZHJpdmVycy9n
cHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5jICAgfCAzMyArKystLS0tLS0tLQogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BhZ2VzLmMgICAgfCAyMCArKysrKy0tCiBk
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYyB8IDI4ICsrLS0tLS0t
LS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zdG9sZW4uYyAgIHwgIDMgKy0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jICAgICAgICAgIHwgNTggKystLS0t
LS0tLS0tLS0tLS0tLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmggICAgICAgICAg
ICAgIHwgIDcgKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jICAgICAgICAgICAg
ICB8IDIzICsrKystLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jICAgICAgICAg
ICAgICB8IDE2ICsrKystLQogOSBmaWxlcyBjaGFuZ2VkLCA2MyBpbnNlcnRpb25zKCspLCAxMjgg
ZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVf
Z2VtX2RvbWFpbi5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5j
CmluZGV4IDUyYjczZTkwYzlmNC4uZTVkZWFlNjI2ODFmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fZG9tYWluLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jCkBAIC00NzUsNyArNDc1LDggQEAgc3RhdGljIHZvaWQg
aTkxNV9nZW1fb2JqZWN0X2J1bXBfaW5hY3RpdmVfZ2d0dChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqKQogCX0KIAltdXRleF91bmxvY2soJmk5MTUtPmdndHQudm0ubXV0ZXgpOwogCi0J
aWYgKG9iai0+bW0ubWFkdiA9PSBJOTE1X01BRFZfV0lMTE5FRUQpIHsKKwlpZiAoaTkxNV9nZW1f
b2JqZWN0X2lzX3Nocmlua2FibGUob2JqKSAmJgorCSAgICBvYmotPm1tLm1hZHYgPT0gSTkxNV9N
QURWX1dJTExORUVEKSB7CiAJCXN0cnVjdCBsaXN0X2hlYWQgKmxpc3Q7CiAKIAkJc3Bpbl9sb2Nr
KCZpOTE1LT5tbS5vYmpfbG9jayk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
ZW0vaTkxNV9nZW1fb2JqZWN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1f
b2JqZWN0LmMKaW5kZXggYTQyNzYzZTRkZDVmLi40OWM5NTljMTFiMmEgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuYworKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmMKQEAgLTQ0LDI1ICs0NCw2IEBAIHZvaWQg
aTkxNV9nZW1fb2JqZWN0X2ZyZWUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIAly
ZXR1cm4ga21lbV9jYWNoZV9mcmVlKGdsb2JhbC5zbGFiX29iamVjdHMsIG9iaik7CiB9CiAKLS8q
IHNvbWUgYm9va2tlZXBpbmcgKi8KLXN0YXRpYyB2b2lkIGk5MTVfZ2VtX2luZm9fYWRkX29iaihz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKLQkJCQkgIHU2NCBzaXplKQotewotCXNwaW5f
bG9jaygmaTkxNS0+bW0ub2JqZWN0X3N0YXRfbG9jayk7Ci0JaTkxNS0+bW0ub2JqZWN0X2NvdW50
Kys7Ci0JaTkxNS0+bW0ub2JqZWN0X21lbW9yeSArPSBzaXplOwotCXNwaW5fdW5sb2NrKCZpOTE1
LT5tbS5vYmplY3Rfc3RhdF9sb2NrKTsKLX0KLQotc3RhdGljIHZvaWQgaTkxNV9nZW1faW5mb19y
ZW1vdmVfb2JqKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAotCQkJCSAgICAgdTY0IHNp
emUpCi17Ci0Jc3Bpbl9sb2NrKCZpOTE1LT5tbS5vYmplY3Rfc3RhdF9sb2NrKTsKLQlpOTE1LT5t
bS5vYmplY3RfY291bnQtLTsKLQlpOTE1LT5tbS5vYmplY3RfbWVtb3J5IC09IHNpemU7Ci0Jc3Bp
bl91bmxvY2soJmk5MTUtPm1tLm9iamVjdF9zdGF0X2xvY2spOwotfQotCiBzdGF0aWMgdm9pZAog
ZnJvbnRidWZmZXJfcmV0aXJlKHN0cnVjdCBpOTE1X2FjdGl2ZV9yZXF1ZXN0ICphY3RpdmUsCiAJ
CSAgIHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QpCkBAIC05OCw4ICs3OSw2IEBAIHZvaWQg
aTkxNV9nZW1fb2JqZWN0X2luaXQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAlv
YmotPm1tLm1hZHYgPSBJOTE1X01BRFZfV0lMTE5FRUQ7CiAJSU5JVF9SQURJWF9UUkVFKCZvYmot
Pm1tLmdldF9wYWdlLnJhZGl4LCBHRlBfS0VSTkVMIHwgX19HRlBfTk9XQVJOKTsKIAltdXRleF9p
bml0KCZvYmotPm1tLmdldF9wYWdlLmxvY2spOwotCi0JaTkxNV9nZW1faW5mb19hZGRfb2JqKHRv
X2k5MTUob2JqLT5iYXNlLmRldiksIG9iai0+YmFzZS5zaXplKTsKIH0KIAogLyoqCkBAIC0xNjMs
MTEgKzE0MiwxNCBAQCB2b2lkIGk5MTVfZ2VtX2Nsb3NlX29iamVjdChzdHJ1Y3QgZHJtX2dlbV9v
YmplY3QgKmdlbSwgc3RydWN0IGRybV9maWxlICpmaWxlKQogCiBzdGF0aWMgYm9vbCBkaXNjYXJk
X2JhY2tpbmdfc3RvcmFnZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqKQogewotCS8q
IElmIHdlIGFyZSB0aGUgbGFzdCB1c2VyIG9mIHRoZSBiYWNraW5nIHN0b3JhZ2UgKGJlIGl0IHNo
bWVtZnMKKwkvKgorCSAqIElmIHdlIGFyZSB0aGUgbGFzdCB1c2VyIG9mIHRoZSBiYWNraW5nIHN0
b3JhZ2UgKGJlIGl0IHNobWVtZnMKIAkgKiBwYWdlcyBvciBzdG9sZW4gZXRjKSwgd2Uga25vdyB0
aGF0IHRoZSBwYWdlcyBhcmUgZ29pbmcgdG8gYmUKIAkgKiBpbW1lZGlhdGVseSByZWxlYXNlZC4g
SW4gdGhpcyBjYXNlLCB3ZSBjYW4gdGhlbiBza2lwIGNvcHlpbmcKIAkgKiBiYWNrIHRoZSBjb250
ZW50cyBmcm9tIHRoZSBHUFUuCiAJICovCisJaWYgKCFpOTE1X2dlbV9vYmplY3RfaXNfc2hyaW5r
YWJsZShvYmopKQorCQlyZXR1cm4gZmFsc2U7CiAKIAlpZiAob2JqLT5tbS5tYWR2ICE9IEk5MTVf
TUFEVl9XSUxMTkVFRCkKIAkJcmV0dXJuIGZhbHNlOwpAQCAtMjA4LDEzICsxOTAsMTUgQEAgc3Rh
dGljIHZvaWQgX19pOTE1X2dlbV9mcmVlX29iamVjdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
Kmk5MTUsCiAJCUdFTV9CVUdfT04oIWxpc3RfZW1wdHkoJm9iai0+dm1hLmxpc3QpKTsKIAkJR0VN
X0JVR19PTighUkJfRU1QVFlfUk9PVCgmb2JqLT52bWEudHJlZSkpOwogCi0JCS8qIFRoaXMgc2Vy
aWFsaXplcyBmcmVlaW5nIHdpdGggdGhlIHNocmlua2VyLiBTaW5jZSB0aGUgZnJlZQorCQkvKgor
CQkgKiBUaGlzIHNlcmlhbGl6ZXMgZnJlZWluZyB3aXRoIHRoZSBzaHJpbmtlci4gU2luY2UgdGhl
IGZyZWUKIAkJICogaXMgZGVsYXllZCwgZmlyc3QgYnkgUkNVIHRoZW4gYnkgdGhlIHdvcmtxdWV1
ZSwgd2Ugd2FudCB0aGUKIAkJICogc2hyaW5rZXIgdG8gYmUgYWJsZSB0byBmcmVlIHBhZ2VzIG9m
IHVucmVmZXJlbmNlZCBvYmplY3RzLAogCQkgKiBvciBlbHNlIHdlIG1heSBvb20gd2hpbHN0IHRo
ZXJlIGFyZSBwbGVudHkgb2YgZGVmZXJyZWQKIAkJICogZnJlZWQgb2JqZWN0cy4KIAkJICovCi0J
CWlmIChpOTE1X2dlbV9vYmplY3RfaGFzX3BhZ2VzKG9iaikpIHsKKwkJaWYgKGk5MTVfZ2VtX29i
amVjdF9oYXNfcGFnZXMob2JqKSAmJgorCQkgICAgaTkxNV9nZW1fb2JqZWN0X2lzX3Nocmlua2Fi
bGUob2JqKSkgewogCQkJc3Bpbl9sb2NrKCZpOTE1LT5tbS5vYmpfbG9jayk7CiAJCQlsaXN0X2Rl
bF9pbml0KCZvYmotPm1tLmxpbmspOwogCQkJc3Bpbl91bmxvY2soJmk5MTUtPm1tLm9ial9sb2Nr
KTsKQEAgLTI0MCw3ICsyMjQsNiBAQCBzdGF0aWMgdm9pZCBfX2k5MTVfZ2VtX2ZyZWVfb2JqZWN0
cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKIAogCQlyZXNlcnZhdGlvbl9vYmplY3Rf
ZmluaSgmb2JqLT5fX2J1aWx0aW5fcmVzdik7CiAJCWRybV9nZW1fb2JqZWN0X3JlbGVhc2UoJm9i
ai0+YmFzZSk7Ci0JCWk5MTVfZ2VtX2luZm9fcmVtb3ZlX29iaihpOTE1LCBvYmotPmJhc2Uuc2l6
ZSk7CiAKIAkJYml0bWFwX2ZyZWUob2JqLT5iaXRfMTcpOwogCQlpOTE1X2dlbV9vYmplY3RfZnJl
ZShvYmopOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Bh
Z2VzLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcGFnZXMuYwppbmRleCBl
NTM4NjAxNDdmMjEuLjdlNjRmZDZiYzE5YiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX3BhZ2VzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5
MTVfZ2VtX3BhZ2VzLmMKQEAgLTU2LDkgKzU2LDEzIEBAIHZvaWQgX19pOTE1X2dlbV9vYmplY3Rf
c2V0X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJfQogCUdFTV9CVUdf
T04oIUhBU19QQUdFX1NJWkVTKGk5MTUsIG9iai0+bW0ucGFnZV9zaXplcy5zZykpOwogCi0Jc3Bp
bl9sb2NrKCZpOTE1LT5tbS5vYmpfbG9jayk7Ci0JbGlzdF9hZGQoJm9iai0+bW0ubGluaywgJmk5
MTUtPm1tLnVuYm91bmRfbGlzdCk7Ci0Jc3Bpbl91bmxvY2soJmk5MTUtPm1tLm9ial9sb2NrKTsK
KwlpZiAoaTkxNV9nZW1fb2JqZWN0X2lzX3Nocmlua2FibGUob2JqKSkgeworCQlzcGluX2xvY2so
Jmk5MTUtPm1tLm9ial9sb2NrKTsKKwkJaTkxNS0+bW0uc2hyaW5rX2NvdW50Kys7CisJCWk5MTUt
Pm1tLnNocmlua19tZW1vcnkgKz0gb2JqLT5iYXNlLnNpemU7CisJCWxpc3RfYWRkKCZvYmotPm1t
LmxpbmssICZpOTE1LT5tbS51bmJvdW5kX2xpc3QpOworCQlzcGluX3VubG9jaygmaTkxNS0+bW0u
b2JqX2xvY2spOworCX0KIH0KIAogaW50IF9fX19pOTE1X2dlbV9vYmplY3RfZ2V0X3BhZ2VzKHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCkBAIC0xNDYsOSArMTUwLDEzIEBAIF9faTkx
NV9nZW1fb2JqZWN0X3Vuc2V0X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmop
CiAJaWYgKElTX0VSUl9PUl9OVUxMKHBhZ2VzKSkKIAkJcmV0dXJuIHBhZ2VzOwogCi0Jc3Bpbl9s
b2NrKCZpOTE1LT5tbS5vYmpfbG9jayk7Ci0JbGlzdF9kZWwoJm9iai0+bW0ubGluayk7Ci0Jc3Bp
bl91bmxvY2soJmk5MTUtPm1tLm9ial9sb2NrKTsKKwlpZiAoaTkxNV9nZW1fb2JqZWN0X2lzX3No
cmlua2FibGUob2JqKSkgeworCQlzcGluX2xvY2soJmk5MTUtPm1tLm9ial9sb2NrKTsKKwkJbGlz
dF9kZWwoJm9iai0+bW0ubGluayk7CisJCWk5MTUtPm1tLnNocmlua19jb3VudC0tOworCQlpOTE1
LT5tbS5zaHJpbmtfbWVtb3J5IC09IG9iai0+YmFzZS5zaXplOworCQlzcGluX3VubG9jaygmaTkx
NS0+bW0ub2JqX2xvY2spOworCX0KIAogCWlmIChvYmotPm1tLm1hcHBpbmcpIHsKIAkJdm9pZCAq
cHRyOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlu
a2VyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYwppbmRl
eCA2YTkzZTMyNmFiZjMuLmQ3MWU2MzBjNmZiOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMKQEAgLTMwOSwzMCArMzA5LDE0IEBAIGk5MTVfZ2VtX3No
cmlua2VyX2NvdW50KHN0cnVjdCBzaHJpbmtlciAqc2hyaW5rZXIsIHN0cnVjdCBzaHJpbmtfY29u
dHJvbCAqc2MpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPQogCQljb250YWlu
ZXJfb2Yoc2hyaW5rZXIsIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlLCBtbS5zaHJpbmtlcik7Ci0J
c3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKLQl1bnNpZ25lZCBsb25nIG51bV9vYmpl
Y3RzID0gMDsKLQl1bnNpZ25lZCBsb25nIGNvdW50ID0gMDsKKwl1bnNpZ25lZCBsb25nIG51bV9v
YmplY3RzOworCXVuc2lnbmVkIGxvbmcgY291bnQ7CiAKLQlzcGluX2xvY2soJmk5MTUtPm1tLm9i
al9sb2NrKTsKLQlsaXN0X2Zvcl9lYWNoX2VudHJ5KG9iaiwgJmk5MTUtPm1tLnVuYm91bmRfbGlz
dCwgbW0ubGluaykKLQkJaWYgKGNhbl9yZWxlYXNlX3BhZ2VzKG9iaikpIHsKLQkJCWNvdW50ICs9
IG9iai0+YmFzZS5zaXplID4+IFBBR0VfU0hJRlQ7Ci0JCQludW1fb2JqZWN0cysrOwotCQl9CisJ
Y291bnQgPSBSRUFEX09OQ0UoaTkxNS0+bW0uc2hyaW5rX21lbW9yeSkgPj4gUEFHRV9TSElGVDsK
KwludW1fb2JqZWN0cyA9IFJFQURfT05DRShpOTE1LT5tbS5zaHJpbmtfY291bnQpOwogCi0JbGlz
dF9mb3JfZWFjaF9lbnRyeShvYmosICZpOTE1LT5tbS5ib3VuZF9saXN0LCBtbS5saW5rKQotCQlp
ZiAoIWk5MTVfZ2VtX29iamVjdF9pc19hY3RpdmUob2JqKSAmJiBjYW5fcmVsZWFzZV9wYWdlcyhv
YmopKSB7Ci0JCQljb3VudCArPSBvYmotPmJhc2Uuc2l6ZSA+PiBQQUdFX1NISUZUOwotCQkJbnVt
X29iamVjdHMrKzsKLQkJfQotCWxpc3RfZm9yX2VhY2hfZW50cnkob2JqLCAmaTkxNS0+bW0ucHVy
Z2VfbGlzdCwgbW0ubGluaykKLQkJaWYgKCFpOTE1X2dlbV9vYmplY3RfaXNfYWN0aXZlKG9iaikg
JiYgY2FuX3JlbGVhc2VfcGFnZXMob2JqKSkgewotCQkJY291bnQgKz0gb2JqLT5iYXNlLnNpemUg
Pj4gUEFHRV9TSElGVDsKLQkJCW51bV9vYmplY3RzKys7Ci0JCX0KLQlzcGluX3VubG9jaygmaTkx
NS0+bW0ub2JqX2xvY2spOwotCi0JLyogVXBkYXRlIG91ciBwcmVmZXJyZWQgdm1zY2FuIGJhdGNo
IHNpemUgZm9yIHRoZSBuZXh0IHBhc3MuCisJLyoKKwkgKiBVcGRhdGUgb3VyIHByZWZlcnJlZCB2
bXNjYW4gYmF0Y2ggc2l6ZSBmb3IgdGhlIG5leHQgcGFzcy4KIAkgKiBPdXIgcm91Z2ggZ3Vlc3Mg
Zm9yIGFuIGVmZmVjdGl2ZSBiYXRjaCBzaXplIGlzIHJvdWdobHkgMgogCSAqIGF2YWlsYWJsZSBH
RU0gb2JqZWN0cyB3b3J0aCBvZiBwYWdlcy4gVGhhdCBpcyB3ZSBkb24ndCB3YW50CiAJICogdGhl
IHNocmlua2VyIHRvIGZpcmUsIHVudGlsIGl0IGlzIHdvcnRoIHRoZSBjb3N0IG9mIGZyZWVpbmcg
YW4KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zdG9sZW4u
YyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9zdG9sZW4uYwppbmRleCA5MDgw
YTczNjY2M2EuLjhiM2EyM2JmZjdmNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL2k5MTVfZ2VtX3N0b2xlbi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9zdG9sZW4uYwpAQCAtNjkwLDcgKzY5MCw4IEBAIGk5MTVfZ2VtX29iamVjdF9jcmVhdGVf
c3RvbGVuX2Zvcl9wcmVhbGxvY2F0ZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
CiAJbXV0ZXhfdW5sb2NrKCZnZ3R0LT52bS5tdXRleCk7CiAKIAlzcGluX2xvY2soJmRldl9wcml2
LT5tbS5vYmpfbG9jayk7Ci0JbGlzdF9tb3ZlX3RhaWwoJm9iai0+bW0ubGluaywgJmRldl9wcml2
LT5tbS5ib3VuZF9saXN0KTsKKwlpZiAoaTkxNV9nZW1fb2JqZWN0X2lzX3Nocmlua2FibGUob2Jq
KSkKKwkJbGlzdF9tb3ZlX3RhaWwoJm9iai0+bW0ubGluaywgJmRldl9wcml2LT5tbS5ib3VuZF9s
aXN0KTsKIAlvYmotPmJpbmRfY291bnQrKzsKIAlzcGluX3VubG9jaygmZGV2X3ByaXYtPm1tLm9i
al9sb2NrKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2Zz
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwppbmRleCA3NGFmZGVmZjIy
NDUuLmYyMTIyNDFhMjc1OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9k
ZWJ1Z2ZzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKQEAgLTI3
MSw3ICsyNzEsNyBAQCBzdGF0aWMgaW50IGk5MTVfZ2VtX3N0b2xlbl9saXN0X2luZm8oc3RydWN0
IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCXVuc2lnbmVkIGxvbmcgdG90YWwsIGNvdW50LCBu
OwogCWludCByZXQ7CiAKLQl0b3RhbCA9IFJFQURfT05DRShkZXZfcHJpdi0+bW0ub2JqZWN0X2Nv
dW50KTsKKwl0b3RhbCA9IFJFQURfT05DRShkZXZfcHJpdi0+bW0uc2hyaW5rX2NvdW50KTsKIAlv
YmplY3RzID0ga3ZtYWxsb2NfYXJyYXkodG90YWwsIHNpemVvZigqb2JqZWN0cyksIEdGUF9LRVJO
RUwpOwogCWlmICghb2JqZWN0cykKIAkJcmV0dXJuIC1FTk9NRU07CkBAIC00NjAsOSArNDYwLDkg
QEAgc3RhdGljIGludCBpOTE1X2dlbV9vYmplY3RfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sIHZv
aWQgKmRhdGEpCiAJY2hhciBidWZbODBdOwogCWludCByZXQ7CiAKLQlzZXFfcHJpbnRmKG0sICIl
dSBvYmplY3RzLCAlbGx1IGJ5dGVzXG4iLAotCQkgICBkZXZfcHJpdi0+bW0ub2JqZWN0X2NvdW50
LAotCQkgICBkZXZfcHJpdi0+bW0ub2JqZWN0X21lbW9yeSk7CisJc2VxX3ByaW50ZihtLCAiJXUg
c2hyaW5rYWJsZSBvYmplY3RzLCAlbGx1IGJ5dGVzXG4iLAorCQkgICBkZXZfcHJpdi0+bW0uc2hy
aW5rX2NvdW50LAorCQkgICBkZXZfcHJpdi0+bW0uc2hyaW5rX21lbW9yeSk7CiAKIAlzaXplID0g
Y291bnQgPSAwOwogCW1hcHBlZF9zaXplID0gbWFwcGVkX2NvdW50ID0gMDsKQEAgLTU1Miw1NSAr
NTUyLDYgQEAgc3RhdGljIGludCBpOTE1X2dlbV9vYmplY3RfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUg
Km0sIHZvaWQgKmRhdGEpCiAJcmV0dXJuIDA7CiB9CiAKLXN0YXRpYyBpbnQgaTkxNV9nZW1fZ3R0
X2luZm8oc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQotewotCXN0cnVjdCBkcm1faW5m
b19ub2RlICpub2RlID0gbS0+cHJpdmF0ZTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSBub2RlX3RvX2k5MTUobm9kZSk7Ci0Jc3RydWN0IGRybV9kZXZpY2UgKmRldiA9ICZk
ZXZfcHJpdi0+ZHJtOwotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICoqb2JqZWN0czsKLQlz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOwotCXU2NCB0b3RhbF9vYmpfc2l6ZSwgdG90
YWxfZ3R0X3NpemU7Ci0JdW5zaWduZWQgbG9uZyBub2JqZWN0LCBuOwotCWludCBjb3VudCwgcmV0
OwotCi0Jbm9iamVjdCA9IFJFQURfT05DRShkZXZfcHJpdi0+bW0ub2JqZWN0X2NvdW50KTsKLQlv
YmplY3RzID0ga3ZtYWxsb2NfYXJyYXkobm9iamVjdCwgc2l6ZW9mKCpvYmplY3RzKSwgR0ZQX0tF
Uk5FTCk7Ci0JaWYgKCFvYmplY3RzKQotCQlyZXR1cm4gLUVOT01FTTsKLQotCXJldCA9IG11dGV4
X2xvY2tfaW50ZXJydXB0aWJsZSgmZGV2LT5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChyZXQpCi0JCXJl
dHVybiByZXQ7Ci0KLQljb3VudCA9IDA7Ci0Jc3Bpbl9sb2NrKCZkZXZfcHJpdi0+bW0ub2JqX2xv
Y2spOwotCWxpc3RfZm9yX2VhY2hfZW50cnkob2JqLCAmZGV2X3ByaXYtPm1tLmJvdW5kX2xpc3Qs
IG1tLmxpbmspIHsKLQkJb2JqZWN0c1tjb3VudCsrXSA9IG9iajsKLQkJaWYgKGNvdW50ID09IG5v
YmplY3QpCi0JCQlicmVhazsKLQl9Ci0Jc3Bpbl91bmxvY2soJmRldl9wcml2LT5tbS5vYmpfbG9j
ayk7Ci0KLQl0b3RhbF9vYmpfc2l6ZSA9IHRvdGFsX2d0dF9zaXplID0gMDsKLQlmb3IgKG4gPSAw
OyAgbiA8IGNvdW50OyBuKyspIHsKLQkJb2JqID0gb2JqZWN0c1tuXTsKLQotCQlzZXFfcHV0cyht
LCAiICAgIik7Ci0JCWRlc2NyaWJlX29iaihtLCBvYmopOwotCQlzZXFfcHV0YyhtLCAnXG4nKTsK
LQkJdG90YWxfb2JqX3NpemUgKz0gb2JqLT5iYXNlLnNpemU7Ci0JCXRvdGFsX2d0dF9zaXplICs9
IGk5MTVfZ2VtX29ial90b3RhbF9nZ3R0X3NpemUob2JqKTsKLQl9Ci0KLQltdXRleF91bmxvY2so
JmRldi0+c3RydWN0X211dGV4KTsKLQotCXNlcV9wcmludGYobSwgIlRvdGFsICVkIG9iamVjdHMs
ICVsbHUgYnl0ZXMsICVsbHUgR1RUIHNpemVcbiIsCi0JCSAgIGNvdW50LCB0b3RhbF9vYmpfc2l6
ZSwgdG90YWxfZ3R0X3NpemUpOwotCWt2ZnJlZShvYmplY3RzKTsKLQotCXJldHVybiAwOwotfQot
CiBzdGF0aWMgaW50IGk5MTVfZ2VtX2JhdGNoX3Bvb2xfaW5mbyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0s
IHZvaWQgKmRhdGEpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gbm9k
ZV90b19pOTE1KG0tPnByaXZhdGUpOwpAQCAtNDU4Miw3ICs0NTMzLDYgQEAgc3RhdGljIGNvbnN0
IHN0cnVjdCBmaWxlX29wZXJhdGlvbnMgaTkxNV9maWZvX3VuZGVycnVuX3Jlc2V0X29wcyA9IHsK
IHN0YXRpYyBjb25zdCBzdHJ1Y3QgZHJtX2luZm9fbGlzdCBpOTE1X2RlYnVnZnNfbGlzdFtdID0g
ewogCXsiaTkxNV9jYXBhYmlsaXRpZXMiLCBpOTE1X2NhcGFiaWxpdGllcywgMH0sCiAJeyJpOTE1
X2dlbV9vYmplY3RzIiwgaTkxNV9nZW1fb2JqZWN0X2luZm8sIDB9LAotCXsiaTkxNV9nZW1fZ3R0
IiwgaTkxNV9nZW1fZ3R0X2luZm8sIDB9LAogCXsiaTkxNV9nZW1fc3RvbGVuIiwgaTkxNV9nZW1f
c3RvbGVuX2xpc3RfaW5mbyB9LAogCXsiaTkxNV9nZW1fZmVuY2VfcmVncyIsIGk5MTVfZ2VtX2Zl
bmNlX3JlZ3NfaW5mbywgMH0sCiAJeyJpOTE1X2dlbV9pbnRlcnJ1cHQiLCBpOTE1X2ludGVycnVw
dF9pbmZvLCAwfSwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2Lmgg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCmluZGV4IGZiMmU4OTEzM2U3OC4uNzcw
YzU0Yjg3ZGU2IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCisr
KyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKQEAgLTkyNiwxMCArOTI2LDkgQEAg
c3RydWN0IGk5MTVfZ2VtX21tIHsKIAkvKiogQml0IDYgc3dpenpsaW5nIHJlcXVpcmVkIGZvciBZ
IHRpbGluZyAqLwogCXUzMiBiaXRfNl9zd2l6emxlX3k7CiAKLQkvKiBhY2NvdW50aW5nLCB1c2Vm
dWwgZm9yIHVzZXJsYW5kIGRlYnVnZ2luZyAqLwotCXNwaW5sb2NrX3Qgb2JqZWN0X3N0YXRfbG9j
azsKLQl1NjQgb2JqZWN0X21lbW9yeTsKLQl1MzIgb2JqZWN0X2NvdW50OworCS8qIHNocmlua2Vy
IGFjY291bnRpbmcsIGFsc28gdXNlZnVsIGZvciB1c2VybGFuZCBkZWJ1Z2dpbmcgKi8KKwl1NjQg
c2hyaW5rX21lbW9yeTsKKwl1MzIgc2hyaW5rX2NvdW50OwogfTsKIAogI2RlZmluZSBJOTE1X0lE
TEVfRU5HSU5FU19USU1FT1VUICgyMDApIC8qIGluIG1zICovCmRpZmYgLS1naXQgYS9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0u
YwppbmRleCBkOThjY2JiZGU1M2MuLjBhNTA0OWFlYzE0NCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9nZW0uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dl
bS5jCkBAIC0xMTM3LDE1ICsxMTM3LDE3IEBAIGk5MTVfZ2VtX21hZHZpc2VfaW9jdGwoc3RydWN0
IGRybV9kZXZpY2UgKmRldiwgdm9pZCAqZGF0YSwKIAlpZiAoaTkxNV9nZW1fb2JqZWN0X2hhc19w
YWdlcyhvYmopKSB7CiAJCXN0cnVjdCBsaXN0X2hlYWQgKmxpc3Q7CiAKLQkJc3Bpbl9sb2NrKCZp
OTE1LT5tbS5vYmpfbG9jayk7Ci0JCWlmIChvYmotPm1tLm1hZHYgIT0gSTkxNV9NQURWX1dJTExO
RUVEKQotCQkJbGlzdCA9ICZpOTE1LT5tbS5wdXJnZV9saXN0OwotCQllbHNlIGlmIChvYmotPmJp
bmRfY291bnQpCi0JCQlsaXN0ID0gJmk5MTUtPm1tLmJvdW5kX2xpc3Q7Ci0JCWVsc2UKLQkJCWxp
c3QgPSAmaTkxNS0+bW0udW5ib3VuZF9saXN0OwotCQlsaXN0X21vdmVfdGFpbCgmb2JqLT5tbS5s
aW5rLCBsaXN0KTsKLQkJc3Bpbl91bmxvY2soJmk5MTUtPm1tLm9ial9sb2NrKTsKKwkJaWYgKGk5
MTVfZ2VtX29iamVjdF9pc19zaHJpbmthYmxlKG9iaikpIHsKKwkJCXNwaW5fbG9jaygmaTkxNS0+
bW0ub2JqX2xvY2spOworCQkJaWYgKG9iai0+bW0ubWFkdiAhPSBJOTE1X01BRFZfV0lMTE5FRUQp
CisJCQkJbGlzdCA9ICZpOTE1LT5tbS5wdXJnZV9saXN0OworCQkJZWxzZSBpZiAob2JqLT5iaW5k
X2NvdW50KQorCQkJCWxpc3QgPSAmaTkxNS0+bW0uYm91bmRfbGlzdDsKKwkJCWVsc2UKKwkJCQls
aXN0ID0gJmk5MTUtPm1tLnVuYm91bmRfbGlzdDsKKwkJCWxpc3RfbW92ZV90YWlsKCZvYmotPm1t
LmxpbmssIGxpc3QpOworCQkJc3Bpbl91bmxvY2soJmk5MTUtPm1tLm9ial9sb2NrKTsKKwkJfQog
CX0KIAogCS8qIGlmIHRoZSBvYmplY3QgaXMgbm8gbG9uZ2VyIGF0dGFjaGVkLCBkaXNjYXJkIGl0
cyBiYWNraW5nIHN0b3JhZ2UgKi8KQEAgLTE3NTAsNyArMTc1Miw2IEBAIGk5MTVfZ2VtX2xvYWRf
aW5pdF9mZW5jZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCiBzdGF0aWMg
dm9pZCBpOTE1X2dlbV9pbml0X19tbShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsK
LQlzcGluX2xvY2tfaW5pdCgmaTkxNS0+bW0ub2JqZWN0X3N0YXRfbG9jayk7CiAJc3Bpbl9sb2Nr
X2luaXQoJmk5MTUtPm1tLm9ial9sb2NrKTsKIAlzcGluX2xvY2tfaW5pdCgmaTkxNS0+bW0uZnJl
ZV9sb2NrKTsKIApAQCAtMTgwMCw3ICsxODAxLDcgQEAgdm9pZCBpOTE1X2dlbV9jbGVhbnVwX2Vh
cmx5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIAlpOTE1X2dlbV9kcmFpbl9m
cmVlZF9vYmplY3RzKGRldl9wcml2KTsKIAlHRU1fQlVHX09OKCFsbGlzdF9lbXB0eSgmZGV2X3By
aXYtPm1tLmZyZWVfbGlzdCkpOwogCUdFTV9CVUdfT04oYXRvbWljX3JlYWQoJmRldl9wcml2LT5t
bS5mcmVlX2NvdW50KSk7Ci0JV0FSTl9PTihkZXZfcHJpdi0+bW0ub2JqZWN0X2NvdW50KTsKKwlX
QVJOX09OKGRldl9wcml2LT5tbS5zaHJpbmtfY291bnQpOwogCiAJY2xlYW51cF9zcmN1X3N0cnVj
dCgmZGV2X3ByaXYtPmdwdV9lcnJvci5yZXNldF9iYWNrb2ZmX3NyY3UpOwogCmRpZmYgLS1naXQg
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3ZtYS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV92bWEuYwppbmRleCBmNjQwY2FlYzRiYWUuLmI3ZmI3ZDIxNmY3NyAxMDA2NDQKLS0tIGEv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV92bWEuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X3ZtYS5jCkBAIC0xMTAsNyArMTEwLDggQEAgc3RhdGljIHZvaWQgX19pOTE1X3ZtYV9y
ZXRpcmUoc3RydWN0IGk5MTVfYWN0aXZlICpyZWYpCiAJICogc28gdGhhdCB3ZSBkb24ndCBzdGVh
bCBmcm9tIHJlY2VudGx5IHVzZWQgYnV0IGluYWN0aXZlIG9iamVjdHMKIAkgKiAodW5sZXNzIHdl
IGFyZSBmb3JjZWQgdG8gb2ZjISkKIAkgKi8KLQlvYmpfYnVtcF9tcnUob2JqKTsKKwlpZiAoaTkx
NV9nZW1fb2JqZWN0X2lzX3Nocmlua2FibGUob2JqKSkKKwkJb2JqX2J1bXBfbXJ1KG9iaik7CiAK
IAlpOTE1X2dlbV9vYmplY3RfcHV0KG9iaik7IC8qIGFuZCBkcm9wIHRoZSBhY3RpdmUgcmVmZXJl
bmNlICovCiB9CkBAIC02NzcsMTEgKzY3OCwxNCBAQCBpOTE1X3ZtYV9pbnNlcnQoc3RydWN0IGk5
MTVfdm1hICp2bWEsIHU2NCBzaXplLCB1NjQgYWxpZ25tZW50LCB1NjQgZmxhZ3MpCiAJCXN0cnVj
dCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmogPSB2bWEtPm9iajsKIAogCQlzcGluX2xvY2soJmRl
dl9wcml2LT5tbS5vYmpfbG9jayk7Ci0JCWxpc3RfbW92ZV90YWlsKCZvYmotPm1tLmxpbmssICZk
ZXZfcHJpdi0+bW0uYm91bmRfbGlzdCk7Ci0JCW9iai0+YmluZF9jb3VudCsrOwotCQlzcGluX3Vu
bG9jaygmZGV2X3ByaXYtPm1tLm9ial9sb2NrKTsKIAorCQlpZiAoaTkxNV9nZW1fb2JqZWN0X2lz
X3Nocmlua2FibGUob2JqKSkKKwkJCWxpc3RfbW92ZV90YWlsKCZvYmotPm1tLmxpbmssICZkZXZf
cHJpdi0+bW0uYm91bmRfbGlzdCk7CisKKwkJb2JqLT5iaW5kX2NvdW50Kys7CiAJCWFzc2VydF9i
aW5kX2NvdW50KG9iaik7CisKKwkJc3Bpbl91bmxvY2soJmRldl9wcml2LT5tbS5vYmpfbG9jayk7
CiAJfQogCiAJcmV0dXJuIDA7CkBAIC03MTcsOSArNzIxLDEzIEBAIGk5MTVfdm1hX3JlbW92ZShz
dHJ1Y3QgaTkxNV92bWEgKnZtYSkKIAkJc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiA9
IHZtYS0+b2JqOwogCiAJCXNwaW5fbG9jaygmaTkxNS0+bW0ub2JqX2xvY2spOworCisJCUdFTV9C
VUdfT04ob2JqLT5iaW5kX2NvdW50ID09IDApOwogCQlpZiAoLS1vYmotPmJpbmRfY291bnQgPT0g
MCAmJgorCQkgICAgaTkxNV9nZW1fb2JqZWN0X2lzX3Nocmlua2FibGUob2JqKSAmJgogCQkgICAg
b2JqLT5tbS5tYWR2ID09IEk5MTVfTUFEVl9XSUxMTkVFRCkKIAkJCWxpc3RfbW92ZV90YWlsKCZv
YmotPm1tLmxpbmssICZpOTE1LT5tbS51bmJvdW5kX2xpc3QpOworCiAJCXNwaW5fdW5sb2NrKCZp
OTE1LT5tbS5vYmpfbG9jayk7CiAKIAkJLyoKLS0gCjIuMjAuMQoKX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRl
bC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
L21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

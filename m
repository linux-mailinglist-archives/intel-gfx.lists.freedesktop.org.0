Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id B466C10D632
	for <lists+intel-gfx@lfdr.de>; Fri, 29 Nov 2019 14:40:18 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 0AA866E903;
	Fri, 29 Nov 2019 13:40:17 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga04.intel.com (mga04.intel.com [192.55.52.120])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 08F5D6E903
 for <intel-gfx@lists.freedesktop.org>; Fri, 29 Nov 2019 13:40:16 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga004.fm.intel.com ([10.253.24.48])
 by fmsmga104.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 29 Nov 2019 05:40:15 -0800
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.69,257,1571727600"; d="scan'208";a="234712577"
Received: from slisovsk-lenovo-ideapad-720s-13ikb.fi.intel.com ([10.237.72.89])
 by fmsmga004.fm.intel.com with ESMTP; 29 Nov 2019 05:40:13 -0800
From: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 29 Nov 2019 15:37:08 +0200
Message-Id: <20191129133709.24397-4-stanislav.lisovskiy@intel.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191129133709.24397-1-stanislav.lisovskiy@intel.com>
References: <20191129133709.24397-1-stanislav.lisovskiy@intel.com>
Subject: [Intel-gfx] [PATCH v7 3/4] drm/i915: Manipulate DBuf slices properly
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

U3RhcnQgbWFuaXB1bGF0aW5nIERCdWYgc2xpY2VzIGFzIGEgbWFzaywKYnV0IG5vdCBhcyBhIHRv
dGFsIG51bWJlciwgYXMgY3VycmVudCBhcHByb2FjaApkb2Vzbid0IGdpdmUgdXMgZnVsbCBjb250
cm9sIG9uIGFsbCBjb21iaW5hdGlvbnMKb2Ygc2xpY2VzLCB3aGljaCB3ZSBtaWdodCBuZWVkKGxp
a2UgZW5hYmxpbmcgUzIKb25seSBjYW4ndCBlbmFibGVkIGJ5IHNldHRpbmcgZW5hYmxlZF9zbGlj
ZXM9MSkuCgpSZW1vdmVkIHdyb25nIGNvZGUgZnJvbSBpbnRlbF9nZXRfZGRiX3NpemUgYXMKaXQg
ZG9lc24ndCBtYXRjaCB0byBCU3BlYy4gRm9yIG5vdyBzdGlsbCBqdXN0CnVzZSBEQnVmIHNsaWNl
IHVudGlsIHByb3BlciBhbGdvcml0aG0gaXMgaW1wbGVtZW50ZWQuCgpPdGhlciBtaW5vciBjb2Rl
IHJlZmFjdG9yaW5nIHRvIGdldCBwcmVwYXJlZApmb3IgbWFqb3IgREJ1ZiBhc3NpZ25tZW50IGNo
YW5nZXMgbGFuZGVkOgotIEFzIG5vdyBlbmFibGVkIHNsaWNlcyBjb250YWluIGEgbWFzawogIHdl
IHN0aWxsIG5lZWQgc29tZSB2YWx1ZSB3aGljaCBzaG91bGQKICByZWZsZWN0IGhvdyBtdWNoIERC
dWYgc2xpY2VzIGFyZSBzdXBwb3J0ZWQKICBieSB0aGUgcGxhdGZvcm0sIG5vdyBkZXZpY2UgaW5m
byBjb250YWlucwogIG51bV9zdXBwb3J0ZWRfZGJ1Zl9zbGljZXMuCi0gUmVtb3ZlZCB1bm5lZWRl
ZCBhc3NlcnRpb24gYXMgd2UgYXJlIG5vdwogIG1hbmlwdWxhdGluZyBzbGljZXMgaW4gYSBtb3Jl
IHByb3BlciB3YXkuCgp2MjogU3RhcnQgdXNpbmcgZW5hYmxlZF9zbGljZXMgaW4gZGV2X3ByaXYK
ClNpZ25lZC1vZmYtYnk6IFN0YW5pc2xhdiBMaXNvdnNraXkgPHN0YW5pc2xhdi5saXNvdnNraXlA
aW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxh
eS5jICB8ICAxMSArLQogLi4uL2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5j
ICAgIHwgMTAwICsrKysrKysrLS0tLS0tLS0tLQogLi4uL2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxf
ZGlzcGxheV9wb3dlci5oICAgIHwgICA1ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNp
LmMgICAgICAgICAgICAgICB8ICAgNiArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZGV2
aWNlX2luZm8uaCAgICAgIHwgICAxICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMg
ICAgICAgICAgICAgICB8ICA0NSArKystLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
cG0uaCAgICAgICAgICAgICAgIHwgICAyICstCiA3IGZpbGVzIGNoYW5nZWQsIDc0IGluc2VydGlv
bnMoKyksIDk2IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kaXNwbGF5LmMKaW5kZXggZGIwODMwNzQ1ZjI1Li5jNzNiZGNlZmQyNDIgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBAIC0xMzQxMywxMSAr
MTM0MTMsMTEgQEAgc3RhdGljIHZvaWQgdmVyaWZ5X3dtX3N0YXRlKHN0cnVjdCBpbnRlbF9jcnRj
ICpjcnRjLAogCiAJc2tsX3BpcGVfZGRiX2dldF9od19zdGF0ZShjcnRjLCBody0+ZGRiX3ksIGh3
LT5kZGJfdXYpOwogCi0JaHdfZW5hYmxlZF9zbGljZXMgPSBpbnRlbF9lbmFibGVkX2RidWZfc2xp
Y2VzX251bShkZXZfcHJpdik7CisJaHdfZW5hYmxlZF9zbGljZXMgPSBpbnRlbF9lbmFibGVkX2Ri
dWZfc2xpY2VzX21hc2soZGV2X3ByaXYpOwogCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0g
MTEgJiYKIAkgICAgaHdfZW5hYmxlZF9zbGljZXMgIT0gZGV2X3ByaXYtPmVuYWJsZWRfc2xpY2Vz
KQotCQlEUk1fRVJST1IoIm1pc21hdGNoIGluIERCVUYgU2xpY2VzIChleHBlY3RlZCAldSwgZ290
ICV1KVxuIiwKKwkJRFJNX0VSUk9SKCJtaXNtYXRjaCBpbiBEQlVGIFNsaWNlcyAoZXhwZWN0ZWQg
JXgsIGdvdCAleClcbiIsCiAJCQkgIGRldl9wcml2LT5lbmFibGVkX3NsaWNlcywKIAkJCSAgaHdf
ZW5hYmxlZF9zbGljZXMpOwogCkBAIC0xNDY0MiwxMCArMTQ2NDIsMTEgQEAgc3RhdGljIHZvaWQg
aWNsX2RidWZfc2xpY2VfcHJlX3VwZGF0ZShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0
ZSkKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHN0YXRlLT5i
YXNlLmRldik7CiAJdTggaHdfZW5hYmxlZF9zbGljZXMgPSBkZXZfcHJpdi0+ZW5hYmxlZF9zbGlj
ZXM7CiAJdTggcmVxdWlyZWRfc2xpY2VzID0gc3RhdGUtPmVuYWJsZWRfc2xpY2VzOworCXU4IHNs
aWNlc191bmlvbiA9IGh3X2VuYWJsZWRfc2xpY2VzIHwgcmVxdWlyZWRfc2xpY2VzOwogCiAJLyog
SWYgMm5kIERCdWYgc2xpY2UgcmVxdWlyZWQsIGVuYWJsZSBpdCBoZXJlICovCi0JaWYgKElOVEVM
X0dFTihkZXZfcHJpdikgPj0gMTEgJiYgcmVxdWlyZWRfc2xpY2VzID4gaHdfZW5hYmxlZF9zbGlj
ZXMpCi0JCWljbF9kYnVmX3NsaWNlc191cGRhdGUoZGV2X3ByaXYsIHJlcXVpcmVkX3NsaWNlcyk7
CisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEgJiYgcmVxdWlyZWRfc2xpY2VzICE9IGh3
X2VuYWJsZWRfc2xpY2VzKQorCQlpY2xfZGJ1Zl9zbGljZXNfdXBkYXRlKGRldl9wcml2LCBzbGlj
ZXNfdW5pb24pOwogfQogCiBzdGF0aWMgdm9pZCBpY2xfZGJ1Zl9zbGljZV9wb3N0X3VwZGF0ZShz
dHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKQEAgLTE0NjU1LDcgKzE0NjU2LDcgQEAg
c3RhdGljIHZvaWQgaWNsX2RidWZfc2xpY2VfcG9zdF91cGRhdGUoc3RydWN0IGludGVsX2F0b21p
Y19zdGF0ZSAqc3RhdGUpCiAJdTggcmVxdWlyZWRfc2xpY2VzID0gc3RhdGUtPmVuYWJsZWRfc2xp
Y2VzOwogCiAJLyogSWYgMm5kIERCdWYgc2xpY2UgaXMgbm8gbW9yZSByZXF1aXJlZCBkaXNhYmxl
IGl0ICovCi0JaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEgJiYgcmVxdWlyZWRfc2xpY2Vz
IDwgaHdfZW5hYmxlZF9zbGljZXMpCisJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTEgJiYg
cmVxdWlyZWRfc2xpY2VzICE9IGh3X2VuYWJsZWRfc2xpY2VzKQogCQlpY2xfZGJ1Zl9zbGljZXNf
dXBkYXRlKGRldl9wcml2LCByZXF1aXJlZF9zbGljZXMpOwogfQogCmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfcG93ZXIuYyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5jCmluZGV4IDRjM2VkZTcz
ZTg2My4uZWYyODg4OTJjOGNlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2Rpc3BsYXlfcG93ZXIuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2Rpc3BsYXlfcG93ZXIuYwpAQCAtMTAzMSwxNSArMTAzMSw2IEBAIHN0YXRpYyBi
b29sIGdlbjlfZGNfb2ZmX3Bvd2VyX3dlbGxfZW5hYmxlZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYsCiAJCShJOTE1X1JFQUQoRENfU1RBVEVfRU4pICYgRENfU1RBVEVfRU5fVVBU
T19EQzVfREM2X01BU0spID09IDApOwogfQogCi1zdGF0aWMgdm9pZCBnZW45X2Fzc2VydF9kYnVm
X2VuYWJsZWQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQotewotCXUzMiB0bXAg
PSBJOTE1X1JFQUQoREJVRl9DVEwpOwotCi0JV0FSTigodG1wICYgKERCVUZfUE9XRVJfU1RBVEUg
fCBEQlVGX1BPV0VSX1JFUVVFU1QpKSAhPQotCSAgICAgKERCVUZfUE9XRVJfU1RBVEUgfCBEQlVG
X1BPV0VSX1JFUVVFU1QpLAotCSAgICAgIlVuZXhwZWN0ZWQgREJ1ZiBwb3dlciBwb3dlciBzdGF0
ZSAoMHglMDh4KVxuIiwgdG1wKTsKLX0KLQogc3RhdGljIHZvaWQgZ2VuOV9kaXNhYmxlX2RjX3N0
YXRlcyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCiB7CiAJc3RydWN0IGludGVs
X2NkY2xrX3N0YXRlIGNkY2xrX3N0YXRlID0ge307CkBAIC0xMDU1LDggKzEwNDYsNiBAQCBzdGF0
aWMgdm9pZCBnZW45X2Rpc2FibGVfZGNfc3RhdGVzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdikKIAkvKiBDYW4ndCByZWFkIG91dCB2b2x0YWdlX2xldmVsIHNvIGNhbid0IHVzZSBp
bnRlbF9jZGNsa19jaGFuZ2VkKCkgKi8KIAlXQVJOX09OKGludGVsX2NkY2xrX25lZWRzX21vZGVz
ZXQoJmRldl9wcml2LT5jZGNsay5odywgJmNkY2xrX3N0YXRlKSk7CiAKLQlnZW45X2Fzc2VydF9k
YnVmX2VuYWJsZWQoZGV2X3ByaXYpOwotCiAJaWYgKElTX0dFTjlfTFAoZGV2X3ByaXYpKQogCQli
eHRfdmVyaWZ5X2RkaV9waHlfcG93ZXJfd2VsbHMoZGV2X3ByaXYpOwogCkBAIC00MjU0LDcyICs0
MjQzLDcxIEBAIHN0YXRpYyB2b2lkIGdlbjlfZGJ1Zl9kaXNhYmxlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKIAlpbnRlbF9kYnVmX3NsaWNlX3NldChkZXZfcHJpdiwgREJVRl9D
VEwsIGZhbHNlKTsKIH0KIAotc3RhdGljIHU4IGludGVsX2RidWZfbWF4X3NsaWNlcyhzdHJ1Y3Qg
ZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpCitpbnQgaW50ZWxfZGJ1Zl9tYXhfc2xpY2VzKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKLQlpZiAoSU5URUxfR0VOKGRldl9w
cml2KSA8IDExKQotCQlyZXR1cm4gMTsKLQlyZXR1cm4gMjsKKwlyZXR1cm4gSU5URUxfSU5GTyhk
ZXZfcHJpdiktPm51bV9zdXBwb3J0ZWRfZGJ1Zl9zbGljZXM7Cit9CisKK3ZvaWQgaWNsX3Byb2dy
YW1fZGJ1Zl9zbGljZXMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQoreworCWNv
bnN0IHU4IGh3X2VuYWJsZWRfc2xpY2VzID0gZGV2X3ByaXYtPmVuYWJsZWRfc2xpY2VzOworCisJ
aWNsX2RidWZfc2xpY2VzX3VwZGF0ZShkZXZfcHJpdiwgaHdfZW5hYmxlZF9zbGljZXMpOwogfQog
CiB2b2lkIGljbF9kYnVmX3NsaWNlc191cGRhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRl
dl9wcml2LAogCQkJICAgIHU4IHJlcV9zbGljZXMpCiB7Ci0JY29uc3QgdTggaHdfZW5hYmxlZF9z
bGljZXMgPSBkZXZfcHJpdi0+ZW5hYmxlZF9zbGljZXM7Ci0JYm9vbCByZXQ7CisJaW50IGk7CisJ
aW50IG1heF9zbGljZXMgPSBpbnRlbF9kYnVmX21heF9zbGljZXMoZGV2X3ByaXYpOwogCi0JaWYg
KHJlcV9zbGljZXMgPiBpbnRlbF9kYnVmX21heF9zbGljZXMoZGV2X3ByaXYpKSB7CisJaWYgKGh3
ZWlnaHQ4KHJlcV9zbGljZXMpID4gaW50ZWxfZGJ1Zl9tYXhfc2xpY2VzKGRldl9wcml2KSkgewog
CQlEUk1fRVJST1IoIkludmFsaWQgbnVtYmVyIG9mIGRidWYgc2xpY2VzIHJlcXVlc3RlZFxuIik7
CiAJCXJldHVybjsKIAl9CiAKLQlpZiAocmVxX3NsaWNlcyA9PSBod19lbmFibGVkX3NsaWNlcyB8
fCByZXFfc2xpY2VzID09IDApCi0JCXJldHVybjsKKwlEUk1fREVCVUdfS01TKCJVcGRhdGluZyBk
YnVmIHNsaWNlcyB0byAleFxuIiwgcmVxX3NsaWNlcyk7CiAKLQlpZiAocmVxX3NsaWNlcyA+IGh3
X2VuYWJsZWRfc2xpY2VzKQotCQlyZXQgPSBpbnRlbF9kYnVmX3NsaWNlX3NldChkZXZfcHJpdiwg
REJVRl9DVExfUzIsIHRydWUpOwotCWVsc2UKLQkJcmV0ID0gaW50ZWxfZGJ1Zl9zbGljZV9zZXQo
ZGV2X3ByaXYsIERCVUZfQ1RMX1MyLCBmYWxzZSk7CisJZm9yIChpID0gMDsgaSA8IG1heF9zbGlj
ZXM7IGkrKykgeworCQlpbnQgc2xpY2VfYml0ID0gQklUKGkpOworCQlib29sIHNsaWNlX3NldCA9
IChzbGljZV9iaXQgJiByZXFfc2xpY2VzKSAhPSAwOworCisJCXN3aXRjaCAoc2xpY2VfYml0KSB7
CisJCWNhc2UgREJVRl9TMV9CSVQ6CisJCQlpbnRlbF9kYnVmX3NsaWNlX3NldChkZXZfcHJpdiwK
KwkJCQkJICAgICBEQlVGX0NUTF9TMSwKKwkJCQkJICAgICBzbGljZV9zZXQpOworCQkJYnJlYWs7
CisJCWNhc2UgREJVRl9TMl9CSVQ6CisJCQlpbnRlbF9kYnVmX3NsaWNlX3NldChkZXZfcHJpdiwK
KwkJCQkJICAgICBEQlVGX0NUTF9TMiwKKwkJCQkJICAgICBzbGljZV9zZXQpOworCQkJYnJlYWs7
CisJCWRlZmF1bHQ6CisJCQlNSVNTSU5HX0NBU0Uoc2xpY2VfYml0KTsKKwkJfQorCX0KIAotCWlm
IChyZXQpCi0JCWRldl9wcml2LT5lbmFibGVkX3NsaWNlcyA9IHJlcV9zbGljZXM7CisJZGV2X3By
aXYtPmVuYWJsZWRfc2xpY2VzID0gcmVxX3NsaWNlczsKIH0KIAogc3RhdGljIHZvaWQgaWNsX2Ri
dWZfZW5hYmxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikKIHsKLQlJOTE1X1dS
SVRFKERCVUZfQ1RMX1MxLCBJOTE1X1JFQUQoREJVRl9DVExfUzEpIHwgREJVRl9QT1dFUl9SRVFV
RVNUKTsKLQlJOTE1X1dSSVRFKERCVUZfQ1RMX1MyLCBJOTE1X1JFQUQoREJVRl9DVExfUzIpIHwg
REJVRl9QT1dFUl9SRVFVRVNUKTsKLQlQT1NUSU5HX1JFQUQoREJVRl9DVExfUzIpOwotCi0JdWRl
bGF5KDEwKTsKLQotCWlmICghKEk5MTVfUkVBRChEQlVGX0NUTF9TMSkgJiBEQlVGX1BPV0VSX1NU
QVRFKSB8fAotCSAgICAhKEk5MTVfUkVBRChEQlVGX0NUTF9TMikgJiBEQlVGX1BPV0VSX1NUQVRF
KSkKLQkJRFJNX0VSUk9SKCJEQnVmIHBvd2VyIGVuYWJsZSB0aW1lb3V0XG4iKTsKLQllbHNlCi0J
CS8qCi0JCSAqIEZJWE1FOiBmb3Igbm93IHByZXRlbmQgdGhhdCB3ZSBvbmx5IGhhdmUgMSBzbGlj
ZSwgc2VlCi0JCSAqIGludGVsX2VuYWJsZWRfZGJ1Zl9zbGljZXNfbnVtKCkuCi0JCSAqLwotCQlk
ZXZfcHJpdi0+ZW5hYmxlZF9zbGljZXMgPSAxOworCS8qCisJICogSnVzdCBwb3dlciB1cCAxIHNs
aWNlLCB3ZSB3aWxsCisJICogZmlndXJlIG91dCBsYXRlciB3aGljaCBzbGljZXMgd2UgaGF2ZSBh
bmQgd2hhdCB3ZSBuZWVkLgorCSAqLworCWRldl9wcml2LT5lbmFibGVkX3NsaWNlcyA9IERCVUZf
UzFfQklUOworCWljbF9wcm9ncmFtX2RidWZfc2xpY2VzKGRldl9wcml2KTsKIH0KIAogc3RhdGlj
IHZvaWQgaWNsX2RidWZfZGlzYWJsZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYp
CiB7Ci0JSTkxNV9XUklURShEQlVGX0NUTF9TMSwgSTkxNV9SRUFEKERCVUZfQ1RMX1MxKSAmIH5E
QlVGX1BPV0VSX1JFUVVFU1QpOwotCUk5MTVfV1JJVEUoREJVRl9DVExfUzIsIEk5MTVfUkVBRChE
QlVGX0NUTF9TMikgJiB+REJVRl9QT1dFUl9SRVFVRVNUKTsKLQlQT1NUSU5HX1JFQUQoREJVRl9D
VExfUzIpOwotCi0JdWRlbGF5KDEwKTsKLQotCWlmICgoSTkxNV9SRUFEKERCVUZfQ1RMX1MxKSAm
IERCVUZfUE9XRVJfU1RBVEUpIHx8Ci0JICAgIChJOTE1X1JFQUQoREJVRl9DVExfUzIpICYgREJV
Rl9QT1dFUl9TVEFURSkpCi0JCURSTV9FUlJPUigiREJ1ZiBwb3dlciBkaXNhYmxlIHRpbWVvdXQh
XG4iKTsKLQllbHNlCi0JCS8qCi0JCSAqIEZJWE1FOiBmb3Igbm93IHByZXRlbmQgdGhhdCB0aGUg
Zmlyc3Qgc2xpY2UgaXMgYWx3YXlzCi0JCSAqIGVuYWJsZWQsIHNlZSBpbnRlbF9lbmFibGVkX2Ri
dWZfc2xpY2VzX251bSgpLgotCQkgKi8KLQkJZGV2X3ByaXYtPmVuYWJsZWRfc2xpY2VzID0gMTsK
KwkvKgorCSAqIERpc2FibGUgYWxsIHNsaWNlcworCSAqLworCWRldl9wcml2LT5lbmFibGVkX3Ns
aWNlcyA9IDA7CisJaWNsX3Byb2dyYW1fZGJ1Zl9zbGljZXMoZGV2X3ByaXYpOwogfQogCiBzdGF0
aWMgdm9pZCBpY2xfbWJ1c19pbml0KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdikK
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9w
b3dlci5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3Bvd2Vy
LmgKaW5kZXggMWRhMDRmM2UwZmIzLi4wZDlmODc2MDdlYWMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5oCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV9wb3dlci5oCkBAIC0zMTEsOCArMzEx
LDEzIEBAIGludGVsX2Rpc3BsYXlfcG93ZXJfcHV0X2FzeW5jKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LAogCWZvciAoKHdmKSA9IGludGVsX2Rpc3BsYXlfcG93ZXJfZ2V0KChpOTE1KSwg
KGRvbWFpbikpOyAod2YpOyBcCiAJICAgICBpbnRlbF9kaXNwbGF5X3Bvd2VyX3B1dF9hc3luYygo
aTkxNSksIChkb21haW4pLCAod2YpKSwgKHdmKSA9IDApCiAKKyNkZWZpbmUgREJVRl9TMV9CSVQJ
CQlCSVQoMCkKKyNkZWZpbmUgREJVRl9TMl9CSVQJCQlCSVQoMSkKKwogdm9pZCBpY2xfZGJ1Zl9z
bGljZXNfdXBkYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJCSAgICB1
OCByZXFfc2xpY2VzKTsKK3ZvaWQgaWNsX3Byb2dyYW1fZGJ1Zl9zbGljZXMoc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmRldl9wcml2KTsKK2ludCBpbnRlbF9kYnVmX21heF9zbGljZXMoc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIAogdm9pZCBjaHZfcGh5X3Bvd2VyZ2F0ZV9s
YW5lcyhzdHJ1Y3QgaW50ZWxfZW5jb2RlciAqZW5jb2RlciwKIAkJCSAgICAgYm9vbCBvdmVycmlk
ZSwgdW5zaWduZWQgaW50IG1hc2spOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
aTkxNV9wY2kuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGNpLmMKaW5kZXggZGEzZTli
NTc1MmFjLi5hMDUwMjIyMjQwZTQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5
MTVfcGNpLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9wY2kuYwpAQCAtNjE0LDcg
KzYxNCw4IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfZGV2aWNlX2luZm8gaW50ZWxfY2hl
cnJ5dmlld19pbmZvID0gewogCS5oYXNfZ3RfdWMgPSAxLCBcCiAJLmRpc3BsYXkuaGFzX2hkY3Ag
PSAxLCBcCiAJLmRpc3BsYXkuaGFzX2lwYyA9IDEsIFwKLQkuZGRiX3NpemUgPSA4OTYKKwkuZGRi
X3NpemUgPSA4OTYsIFwKKwkubnVtX3N1cHBvcnRlZF9kYnVmX3NsaWNlcyA9IDEKIAogI2RlZmlu
ZSBTS0xfUExBVEZPUk0gXAogCUdFTjlfRkVBVFVSRVMsIFwKQEAgLTY0OSw2ICs2NTAsNyBAQCBz
dGF0aWMgY29uc3Qgc3RydWN0IGludGVsX2RldmljZV9pbmZvIGludGVsX3NreWxha2VfZ3Q0X2lu
Zm8gPSB7CiAjZGVmaW5lIEdFTjlfTFBfRkVBVFVSRVMgXAogCUdFTig5KSwgXAogCS5pc19scCA9
IDEsIFwKKwkubnVtX3N1cHBvcnRlZF9kYnVmX3NsaWNlcyA9IDEsIFwKIAkuZGlzcGxheS5oYXNf
aG90cGx1ZyA9IDEsIFwKIAkuZW5naW5lX21hc2sgPSBCSVQoUkNTMCkgfCBCSVQoVkNTMCkgfCBC
SVQoQkNTMCkgfCBCSVQoVkVDUzApLCBcCiAJLnBpcGVfbWFzayA9IEJJVChQSVBFX0EpIHwgQklU
KFBJUEVfQikgfCBCSVQoUElQRV9DKSwgXApAQCAtNzM3LDYgKzczOSw3IEBAIHN0YXRpYyBjb25z
dCBzdHJ1Y3QgaW50ZWxfZGV2aWNlX2luZm8gaW50ZWxfY29mZmVlbGFrZV9ndDNfaW5mbyA9IHsK
IAlHRU45X0ZFQVRVUkVTLCBcCiAJR0VOKDEwKSwgXAogCS5kZGJfc2l6ZSA9IDEwMjQsIFwKKwku
bnVtX3N1cHBvcnRlZF9kYnVmX3NsaWNlcyA9IDEsIFwKIAkuZGlzcGxheS5oYXNfZHNjID0gMSwg
XAogCS5oYXNfY29oZXJlbnRfZ2d0dCA9IGZhbHNlLCBcCiAJR0xLX0NPTE9SUwpAQCAtNzczLDYg
Kzc3Niw3IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgaW50ZWxfZGV2aWNlX2luZm8gaW50ZWxfY2Fu
bm9ubGFrZV9pbmZvID0gewogCX0sIFwKIAlHRU4oMTEpLCBcCiAJLmRkYl9zaXplID0gMjA0OCwg
XAorCS5udW1fc3VwcG9ydGVkX2RidWZfc2xpY2VzID0gMiwgXAogCS5oYXNfbG9naWNhbF9yaW5n
X2Vsc3EgPSAxLCBcCiAJLmNvbG9yID0geyAuZGVnYW1tYV9sdXRfc2l6ZSA9IDMzLCAuZ2FtbWFf
bHV0X3NpemUgPSAyNjIxNDUgfQogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
bnRlbF9kZXZpY2VfaW5mby5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZGV2aWNlX2lu
Zm8uaAppbmRleCA0YmRmOGE2Y2ZiNDcuLjRhOWY1NGE5MDBiZSAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaW50ZWxfZGV2aWNlX2luZm8uaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9kZXZpY2VfaW5mby5oCkBAIC0xODAsNiArMTgwLDcgQEAgc3RydWN0IGludGVs
X2RldmljZV9pbmZvIHsKIAl9IGRpc3BsYXk7CiAKIAl1MTYgZGRiX3NpemU7IC8qIGluIGJsb2Nr
cyAqLworCXU4IG51bV9zdXBwb3J0ZWRfZGJ1Zl9zbGljZXM7IC8qIG51bWJlciBvZiBEQnVmIHNs
aWNlcyAqLwogCiAJLyogUmVnaXN0ZXIgb2Zmc2V0cyBmb3IgdGhlIHZhcmlvdXMgZGlzcGxheSBw
aXBlcyBhbmQgdHJhbnNjb2RlcnMgKi8KIAlpbnQgcGlwZV9vZmZzZXRzW0k5MTVfTUFYX1RSQU5T
Q09ERVJTXTsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCmluZGV4IGE5M2I0Mzg1ZGU0Yi4uOGIyYTE0
OTU0NTRjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMKQEAgLTM1OTksMjQgKzM1OTksMjAgQEAg
Ym9vbCBpbGtfZGlzYWJsZV9scF93bShzdHJ1Y3QgZHJtX2RldmljZSAqZGV2KQogCXJldHVybiBf
aWxrX2Rpc2FibGVfbHBfd20oZGV2X3ByaXYsIFdNX0RJUlRZX0xQX0FMTCk7CiB9CiAKLXU4IGlu
dGVsX2VuYWJsZWRfZGJ1Zl9zbGljZXNfbnVtKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKK3U4IGludGVsX2VuYWJsZWRfZGJ1Zl9zbGljZXNfbWFzayhzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpCiB7Ci0JdTggZW5hYmxlZF9zbGljZXM7Ci0KLQkvKiBTbGljZSAx
IHdpbGwgYWx3YXlzIGJlIGVuYWJsZWQgKi8KLQllbmFibGVkX3NsaWNlcyA9IDE7CisJdTggZW5h
YmxlZF9zbGljZXMgPSAwOwogCiAJLyogR2VuIHByaW9yIHRvIEdFTjExIGhhdmUgb25seSBvbmUg
REJ1ZiBzbGljZSAqLwogCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpIDwgMTEpCi0JCXJldHVybiBl
bmFibGVkX3NsaWNlczsKKwkJcmV0dXJuIERCVUZfUzFfQklUOwogCi0JLyoKLQkgKiBGSVhNRTog
Zm9yIG5vdyB3ZSdsbCBvbmx5IGV2ZXIgdXNlIDEgc2xpY2U7IHByZXRlbmQgdGhhdCB3ZSBoYXZl
Ci0JICogb25seSB0aGF0IDEgc2xpY2UgZW5hYmxlZCB1bnRpbCB3ZSBoYXZlIGEgcHJvcGVyIHdh
eSBmb3Igb24tZGVtYW5kCi0JICogdG9nZ2xpbmcgb2YgdGhlIHNlY29uZCBzbGljZS4KLQkgKi8K
LQlpZiAoMCAmJiBJOTE1X1JFQUQoREJVRl9DVExfUzIpICYgREJVRl9QT1dFUl9TVEFURSkKLQkJ
ZW5hYmxlZF9zbGljZXMrKzsKKwkvKiBDaGVjayBpZiBzZWNvbmQgREJ1ZiBzbGljZSBpcyBlbmFi
bGVkICovCisJaWYgKEk5MTVfUkVBRChEQlVGX0NUTF9TMSkgJiBEQlVGX1BPV0VSX1NUQVRFKQor
CQllbmFibGVkX3NsaWNlcyB8PSBEQlVGX1MxX0JJVDsKKworCWlmIChJOTE1X1JFQUQoREJVRl9D
VExfUzIpICYgREJVRl9QT1dFUl9TVEFURSkKKwkJZW5hYmxlZF9zbGljZXMgfD0gREJVRl9TMl9C
SVQ7CiAKIAlyZXR1cm4gZW5hYmxlZF9zbGljZXM7CiB9CkBAIC0zODI2LDggKzM4MjIsNiBAQCBz
dGF0aWMgdTE2IGludGVsX2dldF9kZGJfc2l6ZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYsCiB7CiAJc3RydWN0IGRybV9hdG9taWNfc3RhdGUgKnN0YXRlID0gY3J0Y19zdGF0ZS0+
dWFwaS5zdGF0ZTsKIAlzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICppbnRlbF9zdGF0ZSA9IHRv
X2ludGVsX2F0b21pY19zdGF0ZShzdGF0ZSk7Ci0JY29uc3Qgc3RydWN0IGRybV9kaXNwbGF5X21v
ZGUgKmFkanVzdGVkX21vZGU7Ci0JdTY0IHRvdGFsX2RhdGFfYnc7CiAJdTE2IGRkYl9zaXplID0g
SU5URUxfSU5GTyhkZXZfcHJpdiktPmRkYl9zaXplOwogCiAJV0FSTl9PTihkZGJfc2l6ZSA9PSAw
KTsKQEAgLTM4MzUsMjMgKzM4MjksOCBAQCBzdGF0aWMgdTE2IGludGVsX2dldF9kZGJfc2l6ZShz
dHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCiAJaWYgKElOVEVMX0dFTihkZXZfcHJp
dikgPCAxMSkKIAkJcmV0dXJuIGRkYl9zaXplIC0gNDsgLyogNCBibG9ja3MgZm9yIGJ5cGFzcyBw
YXRoIGFsbG9jYXRpb24gKi8KIAotCWFkanVzdGVkX21vZGUgPSAmY3J0Y19zdGF0ZS0+aHcuYWRq
dXN0ZWRfbW9kZTsKLQl0b3RhbF9kYXRhX2J3ID0gdG90YWxfZGF0YV9yYXRlICogZHJtX21vZGVf
dnJlZnJlc2goYWRqdXN0ZWRfbW9kZSk7Ci0KLQkvKgotCSAqIDEyR0IvcyBpcyBtYXhpbXVtIEJX
IHN1cHBvcnRlZCBieSBzaW5nbGUgREJ1ZiBzbGljZS4KLQkgKgotCSAqIEZJWE1FIGRidWYgc2xp
Y2UgY29kZSBpcyBicm9rZW46Ci0JICogLSBtdXN0IHdhaXQgZm9yIHBsYW5lcyB0byBzdG9wIHVz
aW5nIHRoZSBzbGljZSBiZWZvcmUgcG93ZXJpbmcgaXQgb2ZmCi0JICogLSBwbGFuZSBzdHJhZGRs
aW5nIGJvdGggc2xpY2VzIGlzIGlsbGVnYWwgaW4gbXVsdGktcGlwZSBzY2VuYXJpb3MKLQkgKiAt
IHNob3VsZCB2YWxpZGF0ZSB3ZSBzdGF5IHdpdGhpbiB0aGUgaHcgYmFuZHdpZHRoIGxpbWl0cwot
CSAqLwotCWlmICgwICYmIChudW1fYWN0aXZlID4gMSB8fCB0b3RhbF9kYXRhX2J3ID49IEdCcHMo
MTIpKSkgewotCQlpbnRlbF9zdGF0ZS0+ZW5hYmxlZF9zbGljZXMgPSAyOwotCX0gZWxzZSB7Ci0J
CWludGVsX3N0YXRlLT5lbmFibGVkX3NsaWNlcyA9IDE7Ci0JCWRkYl9zaXplIC89IDI7Ci0JfQor
CWludGVsX3N0YXRlLT5lbmFibGVkX3NsaWNlcyA9IERCVUZfUzFfQklUOworCWRkYl9zaXplIC89
IDI7CiAKIAlyZXR1cm4gZGRiX3NpemU7CiB9CkBAIC00MDQ4LDcgKzQwMjcsNyBAQCB2b2lkIHNr
bF9waXBlX2RkYl9nZXRfaHdfc3RhdGUoc3RydWN0IGludGVsX2NydGMgKmNydGMsCiAKIHZvaWQg
c2tsX2RkYl9nZXRfaHdfc3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQog
ewotCWRldl9wcml2LT5lbmFibGVkX3NsaWNlcyA9IGludGVsX2VuYWJsZWRfZGJ1Zl9zbGljZXNf
bnVtKGRldl9wcml2KTsKKwlkZXZfcHJpdi0+ZW5hYmxlZF9zbGljZXMgPSBpbnRlbF9lbmFibGVk
X2RidWZfc2xpY2VzX21hc2soZGV2X3ByaXYpOwogfQogCiAvKgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaW50ZWxfcG0uaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3Bt
LmgKaW5kZXggNGFhZmFlNGM4ZTBkLi4zOWNjNDJkMWY4NGUgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2ludGVsX3BtLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxf
cG0uaApAQCAtMzMsNyArMzMsNyBAQCB2b2lkIGc0eF93bV9nZXRfaHdfc3RhdGUoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIHZvaWQgdmx2X3dtX2dldF9od19zdGF0ZShzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwogdm9pZCBpbGtfd21fZ2V0X2h3X3N0YXRl
KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiB2b2lkIHNrbF93bV9nZXRfaHdf
c3RhdGUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKLXU4IGludGVsX2VuYWJs
ZWRfZGJ1Zl9zbGljZXNfbnVtKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7Cit1
OCBpbnRlbF9lbmFibGVkX2RidWZfc2xpY2VzX21hc2soc3RydWN0IGRybV9pOTE1X3ByaXZhdGUg
KmRldl9wcml2KTsKIHZvaWQgc2tsX3BpcGVfZGRiX2dldF9od19zdGF0ZShzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YywKIAkJCSAgICAgICBzdHJ1Y3Qgc2tsX2RkYl9lbnRyeSAqZGRiX3ksCiAJCQkg
ICAgICAgc3RydWN0IHNrbF9kZGJfZW50cnkgKmRkYl91dik7Ci0tIAoyLjE3LjEKCl9fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5n
IGxpc3QKSW50ZWwtZ2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVk
ZXNrdG9wLm9yZy9tYWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeA==

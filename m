Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 6AF71EC2CD
	for <lists+intel-gfx@lfdr.de>; Fri,  1 Nov 2019 13:38:21 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D05196E233;
	Fri,  1 Nov 2019 12:38:19 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga05.intel.com (mga05.intel.com [192.55.52.43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 80B216E22B
 for <intel-gfx@lists.freedesktop.org>; Fri,  1 Nov 2019 12:38:18 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga002.jf.intel.com ([10.7.209.21])
 by fmsmga105.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 01 Nov 2019 05:38:18 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.68,255,1569308400"; d="scan'208";a="212767445"
Received: from slisovsk-lenovo-ideapad-720s-13ikb.fi.intel.com ([10.237.72.89])
 by orsmga002.jf.intel.com with ESMTP; 01 Nov 2019 05:38:15 -0700
From: Stanislav Lisovskiy <stanislav.lisovskiy@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Fri,  1 Nov 2019 14:35:56 +0200
Message-Id: <20191101123557.1117-2-stanislav.lisovskiy@intel.com>
X-Mailer: git-send-email 2.17.1
In-Reply-To: <20191101123557.1117-1-stanislav.lisovskiy@intel.com>
References: <20191101123557.1117-1-stanislav.lisovskiy@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v10 1/2] drm/i915: Refactor intel_can_enable_sagv
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

Q3VycmVudGx5IGludGVsX2Nhbl9lbmFibGVfc2FndiBmdW5jdGlvbiBjb250YWlucwphIG1peCBv
ZiB3b3JrYXJvdW5kcyBmb3IgZGlmZmVyZW50IHBsYXRmb3Jtcwpzb21lIG9mIHRoZW0gYXJlIG5v
dCB2YWxpZCBmb3IgZ2VucyA+PSAxMSBhbHJlYWR5LApzbyBsZXRzIHNwbGl0IGl0IGludG8gc2Vw
YXJhdGUgZnVuY3Rpb25zLgoKdjI6CiAgICAtIFJld29yayB3YXRlcm1hcmsgY2FsY3VsYXRpb24g
YWxnb3JpdGhtIHRvCiAgICAgIGF0dGVtcHQgdG8gY2FsY3VsYXRlIExldmVsIDAgd2F0ZXJtYXJr
CiAgICAgIHdpdGggYWRkZWQgc2FndiBibG9jayB0aW1lIGxhdGVuY3kgYW5kCiAgICAgIGNoZWNr
IGlmIGl0IGZpdHMgaW4gREJ1ZiBpbiBvcmRlciB0bwogICAgICBkZXRlcm1pbmUgaWYgU0FHViBj
YW4gYmUgZW5hYmxlZCBhbHJlYWR5CiAgICAgIGF0IHRoaXMgc3RhZ2UsIGp1c3QgYXMgQlNwZWMg
NDkzMjUgc3RhdGVzLgogICAgICBpZiB0aGF0IGZhaWxzIHJvbGxiYWNrIHRvIHVzdWFsIExldmVs
IDAKICAgICAgbGF0ZW5jeSBhbmQgZGlzYWJsZSBTQUdWLgogICAgLSBSZW1vdmUgdW5uZWVkZWQg
dGFicyhKYW1lcyBBdXNtdXMpCgp2MzogUmViYXNlZCB0aGUgcGF0Y2gKCnY0OiAtIEFkZGVkIGJh
Y2sgaW50ZXJsYWNlZCBjaGVjayBmb3IgR2VuMTIgYW5kCiAgICAgIGFkZGVkIHNlcGFyYXRlIGZ1
bmN0aW9uIGZvciBUR0wgU0FHViBjaGVjawogICAgICAodGhhbmtzIHRvIEphbWVzIEF1c211cyBm
b3Igc3BvdHRpbmcpCiAgICAtIFJlbW92ZWQgdW5uZWVkZWQgZ2VuIGNoZWNrCiAgICAtIEV4dHJh
Y3RlZCBHZW4xMiBTQUdWIGRlY2lzaW9uIG1ha2luZyBjb2RlCiAgICAgIHRvIGEgc2VwYXJhdGUg
ZnVuY3Rpb24gZnJvbSBza2xfY29tcHV0ZV93bQoKdjU6IC0gQWRkZWQgU0FHViBnbG9iYWwgc3Rh
dGUgdG8gZGV2X3ByaXYsIGJlY2F1c2UKICAgICAgd2UgbmVlZCB0byB0cmFjayBhbGwgcGlwZXMs
IG5vdCBvbmx5IHRob3NlCiAgICAgIGluIGF0b21pYyBzdGF0ZS4gRWFjaCBwaXBlIGhhcyBub3cg
Y29ycmVzcG9uZGVudAogICAgICBiaXQgbWFzayByZWZsZWN0aW5nLCB3aGV0aGVyIGl0IGNhbiB0
b2xlcmF0ZQogICAgICBTQUdWIG9yIG5vdCh0aGFua3MgdG8gVmlsbGUgU3lyamFsYSBmb3Igc3Vn
Z2VzdGlvbnMpLgogICAgLSBOb3cgdXNpbmcgYWN0aXZlIGZsYWcgaW5zdGVhZCBvZiBlbmFibGUg
aW4gY3JjCiAgICAgIHVzYWdlIGNoZWNrLgoKU2lnbmVkLW9mZi1ieTogU3RhbmlzbGF2IExpc292
c2tpeSA8c3RhbmlzbGF2Lmxpc292c2tpeUBpbnRlbC5jb20+CkNjOiBWaWxsZSBTeXJqw6Rsw6Qg
PHZpbGxlLnN5cmphbGFAaW50ZWwuY29tPgpDYzogSmFtZXMgQXVzbXVzIDxqYW1lcy5hdXNtdXNA
aW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxh
eS5jICB8ICAgNCArCiAuLi4vZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5X3R5cGVzLmgg
ICAgfCAgIDkgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCAgICAgICAgICAgICAg
IHwgICA2ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMgICAgICAgICAgICAgICB8
IDI5OSArKysrKysrKysrKysrKysrKy0KIDQgZmlsZXMgY2hhbmdlZCwgMzA0IGluc2VydGlvbnMo
KyksIDE0IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rp
c3BsYXkvaW50ZWxfZGlzcGxheS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kaXNwbGF5LmMKaW5kZXggMzQ4Y2UwNDU2Njk2Li44ZDE4ODFkZTBiYWIgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheS5jCkBAIC0xNDcyOSw2ICsxNDcy
OSwxMCBAQCBzdGF0aWMgdm9pZCBpbnRlbF9hdG9taWNfY29tbWl0X3RhaWwoc3RydWN0IGludGVs
X2F0b21pY19zdGF0ZSAqc3RhdGUpCiAJCWlmIChkZXZfcHJpdi0+ZGlzcGxheS5vcHRpbWl6ZV93
YXRlcm1hcmtzKQogCQkJZGV2X3ByaXYtPmRpc3BsYXkub3B0aW1pemVfd2F0ZXJtYXJrcyhzdGF0
ZSwKIAkJCQkJCQkgICAgICBuZXdfY3J0Y19zdGF0ZSk7CisJCWlmIChzdGF0ZS0+Y3J0Y19zYWd2
X21hc2sgJiBCSVQoY3J0Yy0+cGlwZSkpCisJCQlkZXZfcHJpdi0+Y3J0Y19zYWd2X21hc2sgfD0g
QklUKGNydGMtPnBpcGUpOworCQllbHNlCisJCQlkZXZfcHJpdi0+Y3J0Y19zYWd2X21hc2sgJj0g
fkJJVChjcnRjLT5waXBlKTsKIAl9CiAKIAlmb3JfZWFjaF9vbGRuZXdfaW50ZWxfY3J0Y19pbl9z
dGF0ZShzdGF0ZSwgY3J0Yywgb2xkX2NydGNfc3RhdGUsIG5ld19jcnRjX3N0YXRlLCBpKSB7CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlw
ZXMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5o
CmluZGV4IDQzNDFiZDY2YTQxOC4uMzhjYmFiYzc5YjJmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaApAQCAtNDkwLDYgKzQ5MCwx
NCBAQCBzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlIHsKIAkgKi8KIAl1OCBhY3RpdmVfcGlwZV9j
aGFuZ2VzOwogCisJLyoKKwkgKiBDb250YWlucyBhIG1hc2sgd2hpY2ggcmVmbGVjdHMgd2hldGhl
ciBjb3JyZXNwb25kZW50IHBpcGUKKwkgKiBjYW4gdG9sZXJhdGUgU0FHViBvciBub3QsIHNvIHRo
YXQgd2UgY2FuIG1ha2UgYSBkZWNpc2lvbgorCSAqIGF0IGF0b21pY19jb21taXRfdGFpbCBzdGFn
ZSwgd2hldGhlciB3ZSBlbmFibGUgaXQgb3Igbm90CisJICogYmFzZWQgb24gZ2xvYmFsIHN0YXRl
IGluIGRldl9wcml2LgorCSAqLworCXUzMiBjcnRjX3NhZ3ZfbWFzazsKKwogCXU4IGFjdGl2ZV9w
aXBlczsKIAkvKiBtaW5pbXVtIGFjY2VwdGFibGUgY2RjbGsgZm9yIGVhY2ggcGlwZSAqLwogCWlu
dCBtaW5fY2RjbGtbSTkxNV9NQVhfUElQRVNdOwpAQCAtNjUwLDYgKzY1OCw3IEBAIHN0cnVjdCBz
a2xfcGxhbmVfd20gewogCXN0cnVjdCBza2xfd21fbGV2ZWwgd21bOF07CiAJc3RydWN0IHNrbF93
bV9sZXZlbCB1dl93bVs4XTsKIAlzdHJ1Y3Qgc2tsX3dtX2xldmVsIHRyYW5zX3dtOworCXN0cnVj
dCBza2xfd21fbGV2ZWwgc2Fndl93bTA7CiAJYm9vbCBpc19wbGFuYXI7CiB9OwogCmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvaTkxNV9kcnYuaAppbmRleCA0YmZkODQyZTI5MTQuLjYwZjFjNGNjM2VlYiAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2Rydi5oCkBAIC0xMTcyLDYgKzExNzIsMTIgQEAgc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgewogCiAJdTMyIHNhZ3ZfYmxvY2tfdGltZV91czsKIAorCS8qCisJICogQ29udGFpbnMg
YSBiaXQgbWFzaywgd2hldGhlciBjb3JyZXNwb25kZW50CisJICogcGlwZSBhbGxvd3MgU0FHViBv
ciBub3QuCisJICovCisJdTMyIGNydGNfc2Fndl9tYXNrOworCiAJc3RydWN0IHsKIAkJLyoKIAkJ
ICogUmF3IHdhdGVybWFyayBsYXRlbmN5IHZhbHVlczoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2ludGVsX3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9wbS5jCmlu
ZGV4IDVkMmI0NjBkM2VlNS4uNDVhOTY2YWRlMWY3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pbnRlbF9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2ludGVsX3BtLmMK
QEAgLTM3NDEsNyArMzc0MSw3IEBAIGludGVsX2Rpc2FibGVfc2FndihzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpCiAJcmV0dXJuIDA7CiB9CiAKLWJvb2wgaW50ZWxfY2FuX2VuYWJs
ZV9zYWd2KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQorc3RhdGljIHZvaWQgc2ts
X3NldF9zYWd2X21hc2soc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7CiAJc3Ry
dWN0IGRybV9kZXZpY2UgKmRldiA9IHN0YXRlLT5iYXNlLmRldjsKIAlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGRldik7CkBAIC0zNzUxLDIxICszNzUxLDIzIEBA
IGJvb2wgaW50ZWxfY2FuX2VuYWJsZV9zYWd2KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0
YXRlKQogCWVudW0gcGlwZSBwaXBlOwogCWludCBsZXZlbCwgbGF0ZW5jeTsKIAorCXN0YXRlLT5j
cnRjX3NhZ3ZfbWFzayA9IDA7CisKIAlpZiAoIWludGVsX2hhc19zYWd2KGRldl9wcml2KSkKLQkJ
cmV0dXJuIGZhbHNlOworCQlyZXR1cm47CiAKIAkvKgogCSAqIElmIHRoZXJlIGFyZSBubyBhY3Rp
dmUgQ1JUQ3MsIG5vIGFkZGl0aW9uYWwgY2hlY2tzIG5lZWQgYmUgcGVyZm9ybWVkCiAJICovCiAJ
aWYgKGh3ZWlnaHQ4KHN0YXRlLT5hY3RpdmVfcGlwZXMpID09IDApCi0JCXJldHVybiB0cnVlOwor
CQlyZXR1cm47CiAKIAkvKgogCSAqIFNLTCsgd29ya2Fyb3VuZDogYnNwZWMgcmVjb21tZW5kcyB3
ZSBkaXNhYmxlIFNBR1Ygd2hlbiB3ZSBoYXZlCiAJICogbW9yZSB0aGVuIG9uZSBwaXBlIGVuYWJs
ZWQKIAkgKi8KIAlpZiAoaHdlaWdodDgoc3RhdGUtPmFjdGl2ZV9waXBlcykgPiAxKQotCQlyZXR1
cm4gZmFsc2U7CisJCXJldHVybjsKIAogCS8qIFNpbmNlIHdlJ3JlIG5vdyBndWFyYW50ZWVkIHRv
IG9ubHkgaGF2ZSBvbmUgYWN0aXZlIENSVEMuLi4gKi8KIAlwaXBlID0gZmZzKHN0YXRlLT5hY3Rp
dmVfcGlwZXMpIC0gMTsKQEAgLTM3NzMsNyArMzc3NSw3IEBAIGJvb2wgaW50ZWxfY2FuX2VuYWJs
ZV9zYWd2KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRlKQogCWNydGNfc3RhdGUgPSB0
b19pbnRlbF9jcnRjX3N0YXRlKGNydGMtPmJhc2Uuc3RhdGUpOwogCiAJaWYgKGNydGMtPmJhc2Uu
c3RhdGUtPmFkanVzdGVkX21vZGUuZmxhZ3MgJiBEUk1fTU9ERV9GTEFHX0lOVEVSTEFDRSkKLQkJ
cmV0dXJuIGZhbHNlOworCQlyZXR1cm47CiAKIAlmb3JfZWFjaF9pbnRlbF9wbGFuZV9vbl9jcnRj
KGRldiwgY3J0YywgcGxhbmUpIHsKIAkJc3RydWN0IHNrbF9wbGFuZV93bSAqd20gPQpAQCAtMzgw
MSw5ICszODAzLDEyNyBAQCBib29sIGludGVsX2Nhbl9lbmFibGVfc2FndihzdHJ1Y3QgaW50ZWxf
YXRvbWljX3N0YXRlICpzdGF0ZSkKIAkJICogY2FuJ3QgZW5hYmxlIFNBR1YuCiAJCSAqLwogCQlp
ZiAobGF0ZW5jeSA8IGRldl9wcml2LT5zYWd2X2Jsb2NrX3RpbWVfdXMpCi0JCQlyZXR1cm4gZmFs
c2U7CisJCQlyZXR1cm47CisJfQorCisJc3RhdGUtPmNydGNfc2Fndl9tYXNrIHw9IEJJVChjcnRj
LT5waXBlKTsKK30KKworc3RhdGljIHZvaWQgdGdsX3NldF9zYWd2X21hc2soc3RydWN0IGludGVs
X2F0b21pY19zdGF0ZSAqc3RhdGUpOworCitzdGF0aWMgdm9pZCBpY2xfc2V0X3NhZ3ZfbWFzayhz
dHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKK3sKKwlzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2ID0gc3RhdGUtPmJhc2UuZGV2OworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJp
diA9IHRvX2k5MTUoZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YzsKKwlzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGU7CisJaW50IGxldmVsLCBsYXRlbmN5OworCWlu
dCBpOworCWludCBwbGFuZV9pZDsKKworCXN0YXRlLT5jcnRjX3NhZ3ZfbWFzayA9IDA7CisKKwlp
ZiAoIWludGVsX2hhc19zYWd2KGRldl9wcml2KSkKKwkJcmV0dXJuOworCisJLyoKKwkgKiBJZiB0
aGVyZSBhcmUgbm8gYWN0aXZlIENSVENzLCBubyBhZGRpdGlvbmFsIGNoZWNrcyBuZWVkIGJlIHBl
cmZvcm1lZAorCSAqLworCWlmIChod2VpZ2h0OChzdGF0ZS0+YWN0aXZlX3BpcGVzKSA9PSAwKQor
CQlyZXR1cm47CisKKwlmb3JfZWFjaF9uZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0
YywKKwkJCQkJICAgICBuZXdfY3J0Y19zdGF0ZSwgaSkgeworCQl1bnNpZ25lZCBpbnQgZmxhZ3Mg
PSBjcnRjLT5iYXNlLnN0YXRlLT5hZGp1c3RlZF9tb2RlLmZsYWdzOworCQlib29sIGNhbl9zYWd2
OworCisJCWlmIChmbGFncyAmIERSTV9NT0RFX0ZMQUdfSU5URVJMQUNFKQorCQkJY29udGludWU7
CisKKwkJaWYgKCFuZXdfY3J0Y19zdGF0ZS0+YmFzZS5hY3RpdmUpCisJCQljb250aW51ZTsKKwor
CQljYW5fc2FndiA9IHRydWU7CisJCWZvcl9lYWNoX3BsYW5lX2lkX29uX2NydGMoY3J0YywgcGxh
bmVfaWQpIHsKKwkJCXN0cnVjdCBza2xfcGxhbmVfd20gKndtID0KKwkJCQkmbmV3X2NydGNfc3Rh
dGUtPndtLnNrbC5vcHRpbWFsLnBsYW5lc1twbGFuZV9pZF07CisKKwkJCS8qIFNraXAgdGhpcyBw
bGFuZSBpZiBpdCdzIG5vdCBlbmFibGVkICovCisJCQlpZiAoIXdtLT53bVswXS5wbGFuZV9lbikK
KwkJCQljb250aW51ZTsKKworCQkJLyogRmluZCB0aGUgaGlnaGVzdCBlbmFibGVkIHdtIGxldmVs
IGZvciB0aGlzIHBsYW5lICovCisJCQlmb3IgKGxldmVsID0gaWxrX3dtX21heF9sZXZlbChkZXZf
cHJpdik7CisJCQkgICAgICF3bS0+d21bbGV2ZWxdLnBsYW5lX2VuOyAtLWxldmVsKSB7CisJCQl9
CisKKwkJCWxhdGVuY3kgPSBkZXZfcHJpdi0+d20uc2tsX2xhdGVuY3lbbGV2ZWxdOworCisJCQkv
KgorCQkJICogSWYgYW55IG9mIHRoZSBwbGFuZXMgb24gdGhpcyBwaXBlIGRvbid0IGVuYWJsZQor
CQkJICogd20gbGV2ZWxzIHRoYXQgaW5jdXIgbWVtb3J5IGxhdGVuY2llcyBoaWdoZXIgdGhhbgor
CQkJICogc2Fndl9ibG9ja190aW1lX3VzIHdlIGNhbid0IGVuYWJsZSBTQUdWLgorCQkJICovCisJ
CQlpZiAobGF0ZW5jeSA8IGRldl9wcml2LT5zYWd2X2Jsb2NrX3RpbWVfdXMpIHsKKwkJCQljYW5f
c2FndiA9IGZhbHNlOworCQkJCWJyZWFrOworCQkJfQorCQl9CisJCWlmIChjYW5fc2FndikKKwkJ
CXN0YXRlLT5jcnRjX3NhZ3ZfbWFzayB8PSBCSVQoY3J0Yy0+cGlwZSk7CiAJfQorfQorCitib29s
IGludGVsX2Nhbl9lbmFibGVfc2FndihzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkK
K3sKKwlzdHJ1Y3QgZHJtX2RldmljZSAqZGV2ID0gc3RhdGUtPmJhc2UuZGV2OworCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoZGV2KTsKKwllbnVtIHBpcGUgcGlw
ZTsKKworCWlmIChJTlRFTF9HRU4oZGV2X3ByaXYpID49IDEyKQorCQl0Z2xfc2V0X3NhZ3ZfbWFz
ayhzdGF0ZSk7CisJZWxzZSBpZiAoSU5URUxfR0VOKGRldl9wcml2KSA9PSAxMSkKKwkJaWNsX3Nl
dF9zYWd2X21hc2soc3RhdGUpOworCWVsc2UKKwkJc2tsX3NldF9zYWd2X21hc2soc3RhdGUpOwog
CisJLyoKKwkgKiBGb3IgU0FHViB3ZSBuZWVkIHRvIGFjY291bnQgYWxsIHRoZSBwaXBlcywKKwkg
KiBub3Qgb25seSB0aGUgb25lcyB3aGljaCBhcmUgaW4gc3RhdGUgY3VycmVudGx5LgorCSAqLwor
CWZvcl9lYWNoX3BpcGUoZGV2X3ByaXYsIHBpcGUpIHsKKwkJdW5zaWduZWQgaW50IGFjdGl2ZV9w
aXBlczsKKwkJLyoKKwkJICogRmlndXJlIG91dCBpZiB3ZSBhcmUgY2hhbmdpbmcgYWN0aXZlIHBp
cGVzIGhlcmUKKwkJICogdGhlbiBhZnRlciBjb21taXQgZGV2X3ByaXYtPmFjdGl2ZV9waXBlcyB3
aWxsCisJCSAqIGFueXdheSBiZSBhc3NpZ25lZCB0byBzdGF0ZS0+YWN0aXZlX3BpcGVzLgorCQkg
Ki8KKwkJaWYgKHN0YXRlLT5hY3RpdmVfcGlwZV9jaGFuZ2VzKQorCQkJYWN0aXZlX3BpcGVzID0g
c3RhdGUtPmFjdGl2ZV9waXBlczsKKwkJZWxzZQorCQkJYWN0aXZlX3BpcGVzID0gZGV2X3ByaXYt
PmFjdGl2ZV9waXBlczsKKworCQkvKiBTa2lwIGlmIHBpcGUgaXMgaW5hY3RpdmUgKi8KKwkJaWYg
KCEoQklUKHBpcGUpICYgYWN0aXZlX3BpcGVzKSkKKwkJCWNvbnRpbnVlOworCisJCS8qCisJCSAq
IFBpcGUgY2FuIGJlIGFjdGl2ZSBpbiB0aGlzIHN0YXRlIG9yIGluIGRldl9wcml2CisJCSAqIGFz
IHdlIGhhdmVuJ3QgY29tbWl0dGVkIHRoaXNlIGNoYW5nZXMgeWV0KGFuZCB3ZSBzaG91bGRuJ3Qp
CisJCSAqIC0gd2UgbmVlZCB0byBjaGVjayBib3RoLgorCQkgKi8KKwkJaWYgKHN0YXRlLT5hY3Rp
dmVfcGlwZV9jaGFuZ2VzICYgQklUKHBpcGUpKSB7CisJCQlib29sIHN0YXRlX3NhZ3ZfbWFza2Vk
ID0gXAorCQkJCShCSVQocGlwZSkgJiBzdGF0ZS0+Y3J0Y19zYWd2X21hc2spID09IDA7CisJCQlp
ZiAoc3RhdGVfc2Fndl9tYXNrZWQpCisJCQkJcmV0dXJuIGZhbHNlOworCQl9IGVsc2UgeworCQkJ
Ym9vbCBzYWd2X21hc2tlZCA9IFwKKwkJCQkoQklUKHBpcGUpICYgZGV2X3ByaXYtPmNydGNfc2Fn
dl9tYXNrKSA9PSAwOworCQkJaWYgKHNhZ3ZfbWFza2VkKQorCQkJCXJldHVybiBmYWxzZTsKKwkJ
fQorCX0KIAlyZXR1cm4gdHJ1ZTsKIH0KIApAQCAtMzkwMyw3ICs0MDIzLDcgQEAgc2tsX2RkYl9n
ZXRfcGlwZV9hbGxvY2F0aW9uX2xpbWl0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYsCiAJCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAkJaW50IGhkaXNwbGF5LCB2ZGlz
cGxheTsKIAotCQlpZiAoIWNydGNfc3RhdGUtPmJhc2UuZW5hYmxlKQorCQlpZiAoIWNydGNfc3Rh
dGUtPmJhc2UuYWN0aXZlKQogCQkJY29udGludWU7CiAKIAkJZHJtX21vZGVfZ2V0X2h2X3RpbWlu
ZyhhZGp1c3RlZF9tb2RlLCAmaGRpc3BsYXksICZ2ZGlzcGxheSk7CkBAIC0zOTI2LDYgKzQwNDYs
NyBAQCBzdGF0aWMgaW50IHNrbF9jb21wdXRlX3dtX3BhcmFtcyhjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkJCQkgaW50IGNvbG9yX3BsYW5lKTsKIHN0YXRpYyB2
b2lkIHNrbF9jb21wdXRlX3BsYW5lX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlLAogCQkJCSBpbnQgbGV2ZWwsCisJCQkJIHUzMiBsYXRlbmN5LAogCQkJCSBjb25z
dCBzdHJ1Y3Qgc2tsX3dtX3BhcmFtcyAqd3AsCiAJCQkJIGNvbnN0IHN0cnVjdCBza2xfd21fbGV2
ZWwgKnJlc3VsdF9wcmV2LAogCQkJCSBzdHJ1Y3Qgc2tsX3dtX2xldmVsICpyZXN1bHQgLyogb3V0
ICovKTsKQEAgLTM5NDgsNyArNDA2OSwxMCBAQCBza2xfY3Vyc29yX2FsbG9jYXRpb24oY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJV0FSTl9PTihyZXQpOwogCiAJ
Zm9yIChsZXZlbCA9IDA7IGxldmVsIDw9IG1heF9sZXZlbDsgbGV2ZWwrKykgewotCQlza2xfY29t
cHV0ZV9wbGFuZV93bShjcnRjX3N0YXRlLCBsZXZlbCwgJndwLCAmd20sICZ3bSk7CisJCXUzMiBs
YXRlbmN5ID0gZGV2X3ByaXYtPndtLnNrbF9sYXRlbmN5W2xldmVsXTsKKworCQlza2xfY29tcHV0
ZV9wbGFuZV93bShjcnRjX3N0YXRlLCBsZXZlbCwgbGF0ZW5jeSwgJndwLCAmd20sICZ3bSk7CisK
IAkJaWYgKHdtLm1pbl9kZGJfYWxsb2MgPT0gVTE2X01BWCkKIAkJCWJyZWFrOwogCkBAIC00MjEz
LDYgKzQzMzcsNjggQEAgaWNsX2dldF90b3RhbF9yZWxhdGl2ZV9kYXRhX3JhdGUoc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJcmV0dXJuIHRvdGFsX2RhdGFfcmF0ZTsKIH0K
IAorc3RhdGljIGludAordGdsX2NoZWNrX3BpcGVfZml0c19zYWd2X3dtKHN0cnVjdCBpbnRlbF9j
cnRjX3N0YXRlICpjcnRjX3N0YXRlLAorCQkgICAgICBzdHJ1Y3Qgc2tsX2RkYl9hbGxvY2F0aW9u
ICpkZGIgLyogb3V0ICovKQoreworCXN0cnVjdCBkcm1fY3J0YyAqY3J0YyA9IGNydGNfc3RhdGUt
PmJhc2UuY3J0YzsKKwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1
KGNydGMtPmRldik7CisJc3RydWN0IGludGVsX2NydGMgKmludGVsX2NydGMgPSB0b19pbnRlbF9j
cnRjKGNydGMpOworCXN0cnVjdCBza2xfZGRiX2VudHJ5ICphbGxvYyA9ICZjcnRjX3N0YXRlLT53
bS5za2wuZGRiOworCXUxNiBhbGxvY19zaXplOworCXUxNiB0b3RhbFtJOTE1X01BWF9QTEFORVNd
ID0ge307CisJdTY0IHRvdGFsX2RhdGFfcmF0ZTsKKwllbnVtIHBsYW5lX2lkIHBsYW5lX2lkOwor
CWludCBudW1fYWN0aXZlOworCXU2NCBwbGFuZV9kYXRhX3JhdGVbSTkxNV9NQVhfUExBTkVTXSA9
IHt9OworCXUzMiBibG9ja3M7CisKKwkvKgorCSAqIE5vIG5lZWQgdG8gY2hlY2sgZ2VuIGhlcmUs
IHdlIGNhbGwgdGhpcyBvbmx5IGZvciBnZW4xMgorCSAqLworCXRvdGFsX2RhdGFfcmF0ZSA9CisJ
CWljbF9nZXRfdG90YWxfcmVsYXRpdmVfZGF0YV9yYXRlKGNydGNfc3RhdGUsCisJCQkJCQkgcGxh
bmVfZGF0YV9yYXRlKTsKKworCXNrbF9kZGJfZ2V0X3BpcGVfYWxsb2NhdGlvbl9saW1pdHMoZGV2
X3ByaXYsIGNydGNfc3RhdGUsCisJCQkJCSAgIHRvdGFsX2RhdGFfcmF0ZSwKKwkJCQkJICAgZGRi
LCBhbGxvYywgJm51bV9hY3RpdmUpOworCWFsbG9jX3NpemUgPSBza2xfZGRiX2VudHJ5X3NpemUo
YWxsb2MpOworCWlmIChhbGxvY19zaXplID09IDApCisJCXJldHVybiAtRU5PU1BDOworCisJLyog
QWxsb2NhdGUgZml4ZWQgbnVtYmVyIG9mIGJsb2NrcyBmb3IgY3Vyc29yLiAqLworCXRvdGFsW1BM
QU5FX0NVUlNPUl0gPSBza2xfY3Vyc29yX2FsbG9jYXRpb24oY3J0Y19zdGF0ZSwgbnVtX2FjdGl2
ZSk7CisJYWxsb2Nfc2l6ZSAtPSB0b3RhbFtQTEFORV9DVVJTT1JdOworCWNydGNfc3RhdGUtPndt
LnNrbC5wbGFuZV9kZGJfeVtQTEFORV9DVVJTT1JdLnN0YXJ0ID0KKwkJYWxsb2MtPmVuZCAtIHRv
dGFsW1BMQU5FX0NVUlNPUl07CisJY3J0Y19zdGF0ZS0+d20uc2tsLnBsYW5lX2RkYl95W1BMQU5F
X0NVUlNPUl0uZW5kID0gYWxsb2MtPmVuZDsKKworCS8qCisJICogRG8gY2hlY2sgaWYgd2UgY2Fu
IGZpdCBMMCArIHNhZ3ZfYmxvY2tfdGltZSBhbmQKKwkgKiBkaXNhYmxlIFNBR1YgaWYgd2UgY2Fu
J3QuCisJICovCisJYmxvY2tzID0gMDsKKwlmb3JfZWFjaF9wbGFuZV9pZF9vbl9jcnRjKGludGVs
X2NydGMsIHBsYW5lX2lkKSB7CisJCWNvbnN0IHN0cnVjdCBza2xfcGxhbmVfd20gKndtID0KKwkJ
CSZjcnRjX3N0YXRlLT53bS5za2wub3B0aW1hbC5wbGFuZXNbcGxhbmVfaWRdOworCisJCWlmIChw
bGFuZV9pZCA9PSBQTEFORV9DVVJTT1IpIHsKKwkJCWlmIChXQVJOX09OKHdtLT5zYWd2X3dtMC5t
aW5fZGRiX2FsbG9jID4KKwkJCQkgICAgdG90YWxbUExBTkVfQ1VSU09SXSkpIHsKKwkJCQlibG9j
a3MgPSBVMzJfTUFYOworCQkJCWJyZWFrOworCQkJfQorCQkJY29udGludWU7CisJCX0KKworCQli
bG9ja3MgKz0gd20tPnNhZ3Zfd20wLm1pbl9kZGJfYWxsb2M7CisJCWlmIChibG9ja3MgPiBhbGxv
Y19zaXplKQorCQkJcmV0dXJuIC1FTk9TUEM7CisJfQorCXJldHVybiAwOworfQorCiBzdGF0aWMg
aW50CiBza2xfYWxsb2NhdGVfcGlwZV9kZGIoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNf
c3RhdGUsCiAJCSAgICAgIHN0cnVjdCBza2xfZGRiX2FsbG9jYXRpb24gKmRkYiAvKiBvdXQgKi8p
CkBAIC00NjQyLDEyICs0ODI4LDEyIEBAIHN0YXRpYyBib29sIHNrbF93bV9oYXNfbGluZXMoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LCBpbnQgbGV2ZWwpCiAKIHN0YXRpYyB2b2lk
IHNrbF9jb21wdXRlX3BsYW5lX3dtKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlLAogCQkJCSBpbnQgbGV2ZWwsCisJCQkJIHUzMiBsYXRlbmN5LAogCQkJCSBjb25zdCBz
dHJ1Y3Qgc2tsX3dtX3BhcmFtcyAqd3AsCiAJCQkJIGNvbnN0IHN0cnVjdCBza2xfd21fbGV2ZWwg
KnJlc3VsdF9wcmV2LAogCQkJCSBzdHJ1Y3Qgc2tsX3dtX2xldmVsICpyZXN1bHQgLyogb3V0ICov
KQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUoY3J0Y19z
dGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwotCXUzMiBsYXRlbmN5ID0gZGV2X3ByaXYtPndtLnNrbF9s
YXRlbmN5W2xldmVsXTsKIAl1aW50X2ZpeGVkXzE2XzE2X3QgbWV0aG9kMSwgbWV0aG9kMjsKIAl1
aW50X2ZpeGVkXzE2XzE2X3Qgc2VsZWN0ZWRfcmVzdWx0OwogCXUzMiByZXNfYmxvY2tzLCByZXNf
bGluZXMsIG1pbl9kZGJfYWxsb2MgPSAwOwpAQCAtNDc2OCwyMCArNDk1NCw0NSBAQCBzdGF0aWMg
dm9pZCBza2xfY29tcHV0ZV9wbGFuZV93bShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAq
Y3J0Y19zdGF0ZSwKIHN0YXRpYyB2b2lkCiBza2xfY29tcHV0ZV93bV9sZXZlbHMoY29uc3Qgc3Ry
dWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJCSAgICAgIGNvbnN0IHN0cnVjdCBz
a2xfd21fcGFyYW1zICp3bV9wYXJhbXMsCi0JCSAgICAgIHN0cnVjdCBza2xfd21fbGV2ZWwgKmxl
dmVscykKKwkJICAgICAgc3RydWN0IHNrbF9wbGFuZV93bSAqcGxhbmVfd20sCisJCSAgICAgIGJv
b2wgeXV2KQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IHRvX2k5MTUo
Y3J0Y19zdGF0ZS0+YmFzZS5jcnRjLT5kZXYpOwogCWludCBsZXZlbCwgbWF4X2xldmVsID0gaWxr
X3dtX21heF9sZXZlbChkZXZfcHJpdik7CisJLyoKKwkgKiBDaGVjayB3aGljaCBraW5kIG9mIHBs
YW5lIGlzIGl0IGFuZCBiYXNlZCBvbiB0aGF0IGNhbGN1bGF0ZQorCSAqIGNvcnJlc3BvbmRlbnQg
V00gbGV2ZWxzLgorCSAqLworCXN0cnVjdCBza2xfd21fbGV2ZWwgKmxldmVscyA9IHl1diA/IHBs
YW5lX3dtLT51dl93bSA6IHBsYW5lX3dtLT53bTsKIAlzdHJ1Y3Qgc2tsX3dtX2xldmVsICpyZXN1
bHRfcHJldiA9ICZsZXZlbHNbMF07CiAKIAlmb3IgKGxldmVsID0gMDsgbGV2ZWwgPD0gbWF4X2xl
dmVsOyBsZXZlbCsrKSB7CiAJCXN0cnVjdCBza2xfd21fbGV2ZWwgKnJlc3VsdCA9ICZsZXZlbHNb
bGV2ZWxdOworCQl1MzIgbGF0ZW5jeSA9IGRldl9wcml2LT53bS5za2xfbGF0ZW5jeVtsZXZlbF07
CiAKLQkJc2tsX2NvbXB1dGVfcGxhbmVfd20oY3J0Y19zdGF0ZSwgbGV2ZWwsIHdtX3BhcmFtcywK
LQkJCQkgICAgIHJlc3VsdF9wcmV2LCByZXN1bHQpOworCQlza2xfY29tcHV0ZV9wbGFuZV93bShj
cnRjX3N0YXRlLCBsZXZlbCwgbGF0ZW5jeSwKKwkJCQkgICAgIHdtX3BhcmFtcywgcmVzdWx0X3By
ZXYsIHJlc3VsdCk7CiAKIAkJcmVzdWx0X3ByZXYgPSByZXN1bHQ7CiAJfQorCS8qCisJICogRm9y
IEdlbjEyIGlmIGl0IGlzIGFuIEwwIHdlIG5lZWQgdG8gYWxzbworCSAqIGNvbnNpZGVyIHNhZ3Zf
YmxvY2tfdGltZSB3aGVuIGNhbGN1bGF0aW5nCisJICogTDAgd2F0ZXJtYXJrIC0gd2Ugd2lsbCBu
ZWVkIHRoYXQgd2hlbiBtYWtpbmcKKwkgKiBhIGRlY2lzaW9uIHdoZXRoZXIgZW5hYmxlIFNBR1Yg
b3Igbm90LgorCSAqIEZvciBvbGRlciBnZW5zIHdlIGFncmVlZCB0byBjb3B5IEwwIHZhbHVlIGZv
cgorCSAqIGNvbXBhdGliaWxpdHkuCisJICovCisJaWYgKChJTlRFTF9HRU4oZGV2X3ByaXYpID49
IDEyKSkgeworCQl1MzIgbGF0ZW5jeSA9IGRldl9wcml2LT53bS5za2xfbGF0ZW5jeVswXTsKKwor
CQlsYXRlbmN5ICs9IGRldl9wcml2LT5zYWd2X2Jsb2NrX3RpbWVfdXM7CisJCXNrbF9jb21wdXRl
X3BsYW5lX3dtKGNydGNfc3RhdGUsIDAsIGxhdGVuY3ksCisJCSAgICAgd21fcGFyYW1zLCAmbGV2
ZWxzWzBdLAorCQkgICAgJnBsYW5lX3dtLT5zYWd2X3dtMCk7CisJfSBlbHNlCisJCW1lbWNweSgm
cGxhbmVfd20tPnNhZ3Zfd20wLCAmbGV2ZWxzWzBdLAorCQkJc2l6ZW9mKHN0cnVjdCBza2xfd21f
bGV2ZWwpKTsKIH0KIAogc3RhdGljIHUzMgpAQCAtNDg3NCw3ICs1MDg1LDcgQEAgc3RhdGljIGlu
dCBza2xfYnVpbGRfcGxhbmVfd21fc2luZ2xlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlLAogCWlmIChyZXQpCiAJCXJldHVybiByZXQ7CiAKLQlza2xfY29tcHV0ZV93bV9sZXZl
bHMoY3J0Y19zdGF0ZSwgJndtX3BhcmFtcywgd20tPndtKTsKKwlza2xfY29tcHV0ZV93bV9sZXZl
bHMoY3J0Y19zdGF0ZSwgJndtX3BhcmFtcywgd20sIGZhbHNlKTsKIAlza2xfY29tcHV0ZV90cmFu
c2l0aW9uX3dtKGNydGNfc3RhdGUsICZ3bV9wYXJhbXMsIHdtKTsKIAogCXJldHVybiAwOwpAQCAt
NDg5Niw3ICs1MTA3LDcgQEAgc3RhdGljIGludCBza2xfYnVpbGRfcGxhbmVfd21fdXYoc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsK
IAotCXNrbF9jb21wdXRlX3dtX2xldmVscyhjcnRjX3N0YXRlLCAmd21fcGFyYW1zLCB3bS0+dXZf
d20pOworCXNrbF9jb21wdXRlX3dtX2xldmVscyhjcnRjX3N0YXRlLCAmd21fcGFyYW1zLCB3bSwg
dHJ1ZSk7CiAKIAlyZXR1cm4gMDsKIH0KQEAgLTUxNjgsNiArNTM3OSw4IEBAIHNrbF9kZGJfYWRk
X2FmZmVjdGVkX3BsYW5lcyhjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqb2xkX2NydGNf
c3RhdGUsCiAJcmV0dXJuIDA7CiB9CiAKK3N0YXRpYyB2b2lkIHRnbF9zZXRfc2Fndl93bTAoc3Ry
dWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpOworCiBzdGF0aWMgaW50CiBza2xfY29tcHV0
ZV9kZGIoc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7CkBAIC01MTc4LDYgKzUz
OTEsMTEgQEAgc2tsX2NvbXB1dGVfZGRiKHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUgKnN0YXRl
KQogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOwogCWludCByZXQsIGk7CiAKKwkvKiBGb3IgR2Vu
MTIrIGZvciBTQUdWIHdlIGhhdmUgYSBzcGVjaWFsIEwwIHdtIHZhbHVlcyAqLworCWlmIChJTlRF
TF9HRU4oZGV2X3ByaXYpID49IDEyKQorCQlpZiAoaW50ZWxfY2FuX2VuYWJsZV9zYWd2KHN0YXRl
KSkKKwkJCXRnbF9zZXRfc2Fndl93bTAoc3RhdGUpOworCiAJbWVtY3B5KGRkYiwgJmRldl9wcml2
LT53bS5za2xfaHcuZGRiLCBzaXplb2YoKmRkYikpOwogCiAJZm9yX2VhY2hfb2xkbmV3X2ludGVs
X2NydGNfaW5fc3RhdGUoc3RhdGUsIGNydGMsIG9sZF9jcnRjX3N0YXRlLApAQCAtNTQ0NCw2ICs1
NjYyLDU2IEBAIHN0YXRpYyBpbnQgc2tsX3dtX2FkZF9hZmZlY3RlZF9wbGFuZXMoc3RydWN0IGlu
dGVsX2F0b21pY19zdGF0ZSAqc3RhdGUsCiAJcmV0dXJuIDA7CiB9CiAKK3ZvaWQgdGdsX3NldF9z
YWd2X3dtMChzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKK3sKKwlzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YzsKKwlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGU7
CisJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlOworCXN0cnVjdCBkcm1f
ZGV2aWNlICpkZXYgPSBzdGF0ZS0+YmFzZS5kZXY7CisJY29uc3Qgc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOworCWludCBpOworCisJLyoKKwkgKiBJZiB3
ZSBkZXRlcm1pbmVkIHRoYXQgd2UgY2FuIGFjdHVhbGx5IGVuYWJsZSBTQUdWLCB0aGVuCisJICog
YWN0dWFsbHkgdXNlIHRob3NlIGxldmVscyB0Z2xfY2hlY2tfcGlwZV9maXRzX3NhZ3Zfd20KKwkg
KiBoYXMgYWxyZWFkeSB0YWtlbiBjYXJlIG9mIGNoZWNraW5nIGlmIEwwICsgc2FndiBibG9jayB0
aW1lCisJICogZml0cyBpbnRvIGRkYi4KKwkgKi8KKwlmb3JfZWFjaF9vbGRuZXdfaW50ZWxfY3J0
Y19pbl9zdGF0ZShzdGF0ZSwgY3J0Yywgb2xkX2NydGNfc3RhdGUsCisJCQkJICAgIG5ld19jcnRj
X3N0YXRlLCBpKSB7CisJCXN0cnVjdCBpbnRlbF9wbGFuZSAqcGxhbmU7CisKKwkJZm9yX2VhY2hf
aW50ZWxfcGxhbmVfb25fY3J0YygmZGV2X3ByaXYtPmRybSwgY3J0YywgcGxhbmUpIHsKKwkJCWVu
dW0gcGxhbmVfaWQgcGxhbmVfaWQgPSBwbGFuZS0+aWQ7CisKKwkJCXN0cnVjdCBza2xfcGxhbmVf
d20gKnBsYW5lX3dtID0gXAorCQkJICAgICZuZXdfY3J0Y19zdGF0ZS0+d20uc2tsLm9wdGltYWwu
cGxhbmVzW3BsYW5lX2lkXTsKKwkJCXN0cnVjdCBza2xfd21fbGV2ZWwgKnNhZ3Zfd20wID0gJnBs
YW5lX3dtLT5zYWd2X3dtMDsKKwkJCXN0cnVjdCBza2xfd21fbGV2ZWwgKmwwX3dtMCA9ICZwbGFu
ZV93bS0+d21bMF07CisKKwkJCW1lbWNweShsMF93bTAsIHNhZ3Zfd20wLCBzaXplb2Yoc3RydWN0
IHNrbF93bV9sZXZlbCkpOworCQl9CisJfQorfQorCitzdGF0aWMgdm9pZCB0Z2xfc2V0X3NhZ3Zf
bWFzayhzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkKK3sKKwlzdHJ1Y3QgaW50ZWxf
Y3J0YyAqY3J0YzsKKwlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGU7CisJ
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0YXRlOworCXN0cnVjdCBza2xfZGRi
X2FsbG9jYXRpb24gKmRkYiA9ICZzdGF0ZS0+d21fcmVzdWx0cy5kZGI7CisJaW50IHJldCwgaTsK
KworCWZvcl9lYWNoX29sZG5ld19pbnRlbF9jcnRjX2luX3N0YXRlKHN0YXRlLCBjcnRjLCBvbGRf
Y3J0Y19zdGF0ZSwKKwkJCQkJICAgIG5ld19jcnRjX3N0YXRlLCBpKSB7CisJCXJldCA9IHRnbF9j
aGVja19waXBlX2ZpdHNfc2Fndl93bShuZXdfY3J0Y19zdGF0ZSwgZGRiKTsKKwkJaWYgKCFyZXQp
IHsKKwkJCWludCBwaXBlX2JpdCA9IEJJVChjcnRjLT5waXBlKTsKKwkJCXN0YXRlLT5jcnRjX3Nh
Z3ZfbWFzayB8PSBwaXBlX2JpdDsKKwkJfQorCX0KK30KKwogc3RhdGljIGludAogc2tsX2NvbXB1
dGVfd20oc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUpCiB7CkBAIC01NDU2LDYgKzU3
MjQsOSBAQCBza2xfY29tcHV0ZV93bShzdHJ1Y3QgaW50ZWxfYXRvbWljX3N0YXRlICpzdGF0ZSkK
IAkvKiBDbGVhciBhbGwgZGlydHkgZmxhZ3MgKi8KIAlyZXN1bHRzLT5kaXJ0eV9waXBlcyA9IDA7
CiAKKwkvKiBJZiB3ZSBleGl0IGJlZm9yZSBjaGVjayBpcyBkb25lICovCisJc3RhdGUtPmNydGNf
c2Fndl9tYXNrID0gMDsKKwogCXJldCA9IHNrbF9kZGJfYWRkX2FmZmVjdGVkX3BpcGVzKHN0YXRl
KTsKIAlpZiAocmV0KQogCQlyZXR1cm4gcmV0OwotLSAKMi4xNy4xCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0Cklu
dGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

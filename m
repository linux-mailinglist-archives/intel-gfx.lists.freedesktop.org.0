Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 11C2D2E1C33
	for <lists+intel-gfx@lfdr.de>; Wed, 23 Dec 2020 13:21:06 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 25F506E0E3;
	Wed, 23 Dec 2020 12:21:04 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (unknown [77.68.26.236])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 905466E0E3
 for <intel-gfx@lists.freedesktop.org>; Wed, 23 Dec 2020 12:21:01 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from build.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 23413171-1500050 
 for multiple; Wed, 23 Dec 2020 12:20:52 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 23 Dec 2020 12:20:51 +0000
Message-Id: <20201223122051.4624-2-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20201223122051.4624-1-chris@chris-wilson.co.uk>
References: <20201223122051.4624-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 2/2] drm/i915/gem: Optimistically prune dma-resv
 from the shrinker.
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Chris Wilson <chris@chris-wilson.co.uk>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

QXMgd2Ugc2hyaW5rIGFuIG9iamVjdCwgYWxzbyBzZWUgaWYgd2UgY2FuIHBydW5lIHRoZSBkbWEt
cmVzdiBvZiBpZGxlCmZlbmNlcyBpdCBpcyBtYWludGFpbmluZyBhIHJlZmVyZW5jZSB0by4KClNp
Z25lZC1vZmYtYnk6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgotLS0K
IGRyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlICAgICAgICAgICAgICAgIHwgIDEgKwogZHJp
dmVycy9ncHUvZHJtL2k5MTUvZG1hX3Jlc3ZfdXRpbHMuYyAgICAgICAgfCAxNyArKysrKysrKysr
KysrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZG1hX3Jlc3ZfdXRpbHMuaCAgICAgICAgfCAx
MyArKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5r
ZXIuYyB8ICAzICsrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3dhaXQuYyAg
ICAgfCAgOCArKystLS0tLQogNSBmaWxlcyBjaGFuZ2VkLCAzNyBpbnNlcnRpb25zKCspLCA1IGRl
bGV0aW9ucygtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2RybS9pOTE1L2RtYV9y
ZXN2X3V0aWxzLmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kbWFf
cmVzdl91dGlscy5oCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQppbmRleCAzYTQzOWIxZDA0OTYuLmYxYzdj
MzI0NjIyNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKQEAgLTU4LDYgKzU4LDcgQEAgaTkxNS15ICs9
IGk5MTVfZHJ2Lm8gXAogCiAjIGNvcmUgbGlicmFyeSBjb2RlCiBpOTE1LXkgKz0gXAorCWRtYV9y
ZXN2X3V0aWxzLm8gXAogCWk5MTVfbWVtY3B5Lm8gXAogCWk5MTVfbW0ubyBcCiAJaTkxNV9zd19m
ZW5jZS5vIFwKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2RtYV9yZXN2X3V0aWxz
LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kbWFfcmVzdl91dGlscy5jCm5ldyBmaWxlIG1vZGUg
MTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uOWU1MDhlN2Q0NjI5Ci0tLSAvZGV2L251bGwKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZG1hX3Jlc3ZfdXRpbHMuYwpAQCAtMCwwICsxLDE3IEBA
CisvLyBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUCisvKgorICogQ29weXJpZ2h0IMKpIDIw
MjAgSW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaW5jbHVkZSA8bGludXgvZG1hLXJlc3YuaD4K
KworI2luY2x1ZGUgImRtYV9yZXN2X3V0aWxzLmgiCisKK3ZvaWQgZG1hX3Jlc3ZfcHJ1bmUoc3Ry
dWN0IGRtYV9yZXN2ICpyZXN2KQoreworCWlmIChkbWFfcmVzdl90cnlsb2NrKHJlc3YpKSB7CisJ
CWlmIChkbWFfcmVzdl90ZXN0X3NpZ25hbGVkX3JjdShyZXN2LCB0cnVlKSkKKwkJCWRtYV9yZXN2
X2FkZF9leGNsX2ZlbmNlKHJlc3YsIE5VTEwpOworCQlkbWFfcmVzdl91bmxvY2socmVzdik7CisJ
fQorfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZG1hX3Jlc3ZfdXRpbHMuaCBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2RtYV9yZXN2X3V0aWxzLmgKbmV3IGZpbGUgbW9kZSAxMDA2
NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5iOWQ4ZmI1ZjgzNjcKLS0tIC9kZXYvbnVsbAorKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9kbWFfcmVzdl91dGlscy5oCkBAIC0wLDAgKzEsMTMgQEAKKy8q
IFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQgKi8KKy8qCisgKiBDb3B5cmlnaHQgwqkgMjAy
MCBJbnRlbCBDb3Jwb3JhdGlvbgorICovCisKKyNpZm5kZWYgRE1BX1JFU1ZfVVRJTFNfSAorI2Rl
ZmluZSBETUFfUkVTVl9VVElMU19ICisKK3N0cnVjdCBkbWFfcmVzdjsKKwordm9pZCBkbWFfcmVz
dl9wcnVuZShzdHJ1Y3QgZG1hX3Jlc3YgKnJlc3YpOworCisjZW5kaWYgLyogRE1BX1JFU1ZfVVRJ
TFNfSCAqLwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3No
cmlua2VyLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fc2hyaW5rZXIuYwpp
bmRleCBkYzhmMDUyYTBmZmUuLmMyZGJhMWNkOTUzMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX3Nocmlua2VyLmMKQEAgLTE1LDYgKzE1LDcgQEAKIAogI2luY2x1ZGUg
Imd0L2ludGVsX2d0X3JlcXVlc3RzLmgiCiAKKyNpbmNsdWRlICJkbWFfcmVzdl91dGlscy5oIgog
I2luY2x1ZGUgImk5MTVfdHJhY2UuaCIKIAogc3RhdGljIGJvb2wgc3dhcF9hdmFpbGFibGUodm9p
ZCkKQEAgLTIwOSw2ICsyMTAsOCBAQCBpOTE1X2dlbV9zaHJpbmsoc3RydWN0IGRybV9pOTE1X3By
aXZhdGUgKmk5MTUsCiAJCQkJbXV0ZXhfdW5sb2NrKCZvYmotPm1tLmxvY2spOwogCQkJfQogCisJ
CQlkbWFfcmVzdl9wcnVuZShvYmotPmJhc2UucmVzdik7CisKIAkJCXNjYW5uZWQgKz0gb2JqLT5i
YXNlLnNpemUgPj4gUEFHRV9TSElGVDsKIAkJCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKIApk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3dhaXQuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV93YWl0LmMKaW5kZXggOGFmNTVjZDNlNjkw
Li5jMWIxM2FjNTBkMGYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV93YWl0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3dhaXQu
YwpAQCAtOSw2ICs5LDcgQEAKIAogI2luY2x1ZGUgImd0L2ludGVsX2VuZ2luZS5oIgogCisjaW5j
bHVkZSAiZG1hX3Jlc3ZfdXRpbHMuaCIKICNpbmNsdWRlICJpOTE1X2dlbV9pb2N0bHMuaCIKICNp
bmNsdWRlICJpOTE1X2dlbV9vYmplY3QuaCIKIApAQCAtODQsMTEgKzg1LDggQEAgaTkxNV9nZW1f
b2JqZWN0X3dhaXRfcmVzZXJ2YXRpb24oc3RydWN0IGRtYV9yZXN2ICpyZXN2LAogCSAqIE9wcG9y
dHVuaXN0aWNhbGx5IHBydW5lIHRoZSBmZW5jZXMgaWZmIHdlIGtub3cgdGhleSBoYXZlICphbGwq
IGJlZW4KIAkgKiBzaWduYWxlZC4KIAkgKi8KLQlpZiAocHJ1bmVfZmVuY2VzICYmIGRtYV9yZXN2
X3RyeWxvY2socmVzdikpIHsKLQkJaWYgKGRtYV9yZXN2X3Rlc3Rfc2lnbmFsZWRfcmN1KHJlc3Ys
IHRydWUpKQotCQkJZG1hX3Jlc3ZfYWRkX2V4Y2xfZmVuY2UocmVzdiwgTlVMTCk7Ci0JCWRtYV9y
ZXN2X3VubG9jayhyZXN2KTsKLQl9CisJaWYgKHBydW5lX2ZlbmNlcykKKwkJZG1hX3Jlc3ZfcHJ1
bmUocmVzdik7CiAKIAlyZXR1cm4gdGltZW91dDsKIH0KLS0gCjIuMjAuMQoKX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlz
dApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0
b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4Cg==

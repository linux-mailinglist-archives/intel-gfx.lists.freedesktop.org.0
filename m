Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 7E3211D34B4
	for <lists+intel-gfx@lfdr.de>; Thu, 14 May 2020 17:12:37 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C048C6EB60;
	Thu, 14 May 2020 15:12:35 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga06.intel.com (mga06.intel.com [134.134.136.31])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 0D1286EB60
 for <intel-gfx@lists.freedesktop.org>; Thu, 14 May 2020 15:12:33 +0000 (UTC)
IronPort-SDR: /b0NkA8XRb945fD/EpgNrDM2FxV0UWraQZkv7qEqDSKcfEzdSFr8tsk0jpeMgSzrXZTPHqWQlx
 5OIPVbd+7pGg==
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga008.fm.intel.com ([10.253.24.58])
 by orsmga104.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 14 May 2020 08:11:22 -0700
IronPort-SDR: CHRG5nOGYNlcKh75sT5pIeq5EqKtCOlunB/UuvSz0Zmf2Ors13LQMORRhQW2b9msiI+Oj5GUqz
 ekqCwUp/uwhg==
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.73,391,1583222400"; d="scan'208";a="253513158"
Received: from unknown (HELO amanna.iind.intel.com) ([10.223.74.53])
 by fmsmga008.fm.intel.com with ESMTP; 14 May 2020 08:11:19 -0700
From: Animesh Manna <animesh.manna@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 14 May 2020 20:28:31 +0530
Message-Id: <20200514145831.15206-1-animesh.manna@intel.com>
X-Mailer: git-send-email 2.26.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v8] drm/i915/dsb: Pre allocate and late cleanup
 of cmd buffer
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: Jani Nikula <jani.nikula@intel.com>, Daniel Vetter <daniel.vetter@ffwll.ch>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UHJlLWFsbG9jYXRlIGNvbW1hbmQgYnVmZmVyIGluIGF0b21pY19jb21taXQgdXNpbmcgaW50ZWxf
ZHNiX3ByZXBhcmUKZnVuY3Rpb24gd2hpY2ggYWxzbyBpbmNsdWRlcyBwaW5uaW5nIGFuZCBtYXAg
aW4gY3B1IGRvbWFpbi4KCk5vIGZ1bmN0aW9uYWwgY2hhbmdlIGlzIGRzYiB3cml0ZS9jb21taXQg
ZnVuY3Rpb25zLgoKTm93IGRzYiBnZXQvcHV0IGZ1bmN0aW9uIGlzIHJlbW92ZWQgYW5kIHJlZi1j
b3VudCBtZWNoYW5pc20gaXMKbm90IG5lZWRlZC4gQmVsb3cgZHNiIGFwaSBhZGRlZCB0byBkbyBy
ZXNwZWN0aXZlIGpvYiBtZW50aW9uZWQKYmVsb3cuCgppbnRlbF9kc2JfcHJlcGFyZSAtIEFsbG9j
YXRlLCBwaW4gYW5kIG1hcCB0aGUgYnVmZmVyLgppbnRlbF9kc2JfY2xlYW51cCAtIFVucGluIGFu
ZCByZWxlYXNlIHRoZSBnZW0gb2JqZWN0LgoKUkZDOiBJbml0aWFsIHBhdGNoIGZvciBkZXNpZ24g
cmV2aWV3Lgp2MjogaW5jbHVkZWQgX2luaXQoKSBwYXJ0IGluIF9wcmVwYXJlKCkuIFtEYW5pZWws
IFZpbGxlXQp2MzogZHNiX2NsZWFudXAgY2FsbGVkIGFmdGVyIGNsZWFudXBfcGxhbmVzLiBbRGFu
aWVsXQp2NDogZHNiIHN0cnVjdHVyZSBpcyBtb3ZlZCB0byBpbnRlbF9jcnRjX3N0YXRlIGZyb20g
aW50ZWxfY3J0Yy4gW01hYXJ0ZW5dCnY1OiBkc2IgZ2V0L3B1dC9yZWYtY291bnQgbWVjaGFuaXNt
IHJlbW92ZWQuIFtNYWFydGVuXQp2NjogQmFzZWQgb24gcmV2aWV3IGZlZWRiYWNrIGZvbGxvd2lu
ZyBjaGFuZ2VzIGFyZSBhZGRlZCwKLSByZXBsYWNlZCBpbnRlbF9kc2Igc3RydWN0dXJlIGJ5IHBv
aW50ZXIgaW4gaW50ZWxfY3J0Y19zdGF0ZS4gW01hYXJ0ZW5dCi0gcGFzc2luZyBpbnRlbF9jcnRj
X3N0YXRlIHRvIGRzcC1hcGkgdG8gc2ltcGxpZnkgdGhlIGNvZGUuIFtNYWFydGVuXQotIGZldyBk
c2IgZnVuY3Rpb25zIHByb3RvdHlwZSBtb2RpZmllZCB0byBzaW1wbGlmeSBjb2RlLgp2NzogYWRk
ZWQgZmV3IGNvc21ldGljIGNoYW5nZXMgc3VnZ2VzdGVkIGJ5IEphbmkgYW5kIG51bGwgY2hlY2sg
Zm9yCmNydGNfc3RhdGUgaW4gZHNiX2NsZWFudXAgcmVtb3ZlZCBhcyBzdWdnZXN0ZWQgYnkgTWFh
cnRlbi4Kdjg6IGNoYW5nZWQgdGhlIGZ1bmN0aW9uIHBhcmFtZXRlciB0byBpbnRlbF9jcnRjX3N0
YXRlKiBvZgppdmJfbG9hZF9sdXRfZXh0X21heCgpIGZyb20gaW50ZWxfY3J0Yy4gW01hYXJ0ZW5d
CgpDYzogTWFhcnRlbiBMYW5raG9yc3QgPG1hYXJ0ZW4ubGFua2hvcnN0QGxpbnV4LmludGVsLmNv
bT4KQ2M6IFZpbGxlIFN5cmrDpGzDpCA8dmlsbGUuc3lyamFsYUBsaW51eC5pbnRlbC5jb20+CkNj
OiBKYW5pIE5pa3VsYSA8amFuaS5uaWt1bGFAaW50ZWwuY29tPgpDYzogRGFuaWVsIFZldHRlciA8
ZGFuaWVsLnZldHRlckBmZndsbC5jaD4KQWNrZWQtYnk6IERhbmllbCBWZXR0ZXIgPGRhbmllbC52
ZXR0ZXJAZmZ3bGwuY2g+ClNpZ25lZC1vZmYtYnk6IEFuaW1lc2ggTWFubmEgPGFuaW1lc2gubWFu
bmFAaW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfYXRv
bWljLmMgICB8ICAgMyArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2NvbG9y
LmMgICAgfCAgNjYgKystLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlz
cGxheS5jICB8ICA1OCArKysrLQogLi4uL2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90
eXBlcy5oICAgIHwgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rz
Yi5jICAgICAgfCAyNDYgKysrKysrKystLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2RzYi5oICAgICAgfCAgMTcgKy0KIDYgZmlsZXMgY2hhbmdlZCwgMjAyIGlu
c2VydGlvbnMoKyksIDE5NCBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlz
cGxheS9pbnRlbF9hdG9taWMuYwppbmRleCBkMDQzMDU3ZDJmYTAuLjNjYjg2NmYyMmU3NCAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9hdG9taWMuYworKysg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2F0b21pYy5jCkBAIC0yNTIsNiAr
MjUyLDcgQEAgaW50ZWxfY3J0Y19kdXBsaWNhdGVfc3RhdGUoc3RydWN0IGRybV9jcnRjICpjcnRj
KQogCWNydGNfc3RhdGUtPndtLm5lZWRfcG9zdHZibF91cGRhdGUgPSBmYWxzZTsKIAljcnRjX3N0
YXRlLT5mYl9iaXRzID0gMDsKIAljcnRjX3N0YXRlLT51cGRhdGVfcGxhbmVzID0gMDsKKwljcnRj
X3N0YXRlLT5kc2IgPSBOVUxMOwogCiAJcmV0dXJuICZjcnRjX3N0YXRlLT51YXBpOwogfQpAQCAt
MjkyLDYgKzI5Myw4IEBAIGludGVsX2NydGNfZGVzdHJveV9zdGF0ZShzdHJ1Y3QgZHJtX2NydGMg
KmNydGMsCiB7CiAJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUgPSB0b19pbnRl
bF9jcnRjX3N0YXRlKHN0YXRlKTsKIAorCWRybV9XQVJOX09OKGNydGMtPmRldiwgY3J0Y19zdGF0
ZS0+ZHNiKTsKKwogCV9fZHJtX2F0b21pY19oZWxwZXJfY3J0Y19kZXN0cm95X3N0YXRlKCZjcnRj
X3N0YXRlLT51YXBpKTsKIAlpbnRlbF9jcnRjX2ZyZWVfaHdfc3RhdGUoY3J0Y19zdGF0ZSk7CiAJ
a2ZyZWUoY3J0Y19zdGF0ZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2NvbG9yLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Nv
bG9yLmMKaW5kZXggOThlY2U5Y2Q3Y2RkLi45NDViYjAzYmRkNGQgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfY29sb3IuYworKysgYi9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9kaXNwbGF5L2ludGVsX2NvbG9yLmMKQEAgLTcxNCwxNiArNzE0LDE2IEBAIHN0YXRp
YyB2b2lkIGJkd19sb2FkX2x1dF8xMChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YywKIAlpbnRlbF9k
ZV93cml0ZShkZXZfcHJpdiwgUFJFQ19QQUxfSU5ERVgocGlwZSksIDApOwogfQogCi1zdGF0aWMg
dm9pZCBpdmJfbG9hZF9sdXRfZXh0X21heChzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKK3N0YXRp
YyB2b2lkIGl2Yl9sb2FkX2x1dF9leHRfbWF4KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRl
ICpjcnRjX3N0YXRlKQogeworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0
YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdiA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwotCXN0cnVjdCBpbnRlbF9kc2IgKmRzYiA9
IGludGVsX2RzYl9nZXQoY3J0Yyk7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCiAJ
LyogUHJvZ3JhbSB0aGUgbWF4IHJlZ2lzdGVyIHRvIGNsYW1wIHZhbHVlcyA+IDEuMC4gKi8KLQlp
bnRlbF9kc2JfcmVnX3dyaXRlKGRzYiwgUFJFQ19QQUxfRVhUX0dDX01BWChwaXBlLCAwKSwgMSA8
PCAxNik7Ci0JaW50ZWxfZHNiX3JlZ193cml0ZShkc2IsIFBSRUNfUEFMX0VYVF9HQ19NQVgocGlw
ZSwgMSksIDEgPDwgMTYpOwotCWludGVsX2RzYl9yZWdfd3JpdGUoZHNiLCBQUkVDX1BBTF9FWFRf
R0NfTUFYKHBpcGUsIDIpLCAxIDw8IDE2KTsKKwlpbnRlbF9kc2JfcmVnX3dyaXRlKGNydGNfc3Rh
dGUsIFBSRUNfUEFMX0VYVF9HQ19NQVgocGlwZSwgMCksIDEgPDwgMTYpOworCWludGVsX2RzYl9y
ZWdfd3JpdGUoY3J0Y19zdGF0ZSwgUFJFQ19QQUxfRVhUX0dDX01BWChwaXBlLCAxKSwgMSA8PCAx
Nik7CisJaW50ZWxfZHNiX3JlZ193cml0ZShjcnRjX3N0YXRlLCBQUkVDX1BBTF9FWFRfR0NfTUFY
KHBpcGUsIDIpLCAxIDw8IDE2KTsKIAogCS8qCiAJICogUHJvZ3JhbSB0aGUgZ2MgbWF4IDIgcmVn
aXN0ZXIgdG8gY2xhbXAgdmFsdWVzID4gMS4wLgpAQCAtNzMxLDE1ICs3MzEsMTMgQEAgc3RhdGlj
IHZvaWQgaXZiX2xvYWRfbHV0X2V4dF9tYXgoc3RydWN0IGludGVsX2NydGMgKmNydGMpCiAJICog
ZnJvbSAzLjAgdG8gNy4wCiAJICovCiAJaWYgKElOVEVMX0dFTihkZXZfcHJpdikgPj0gMTAgfHwg
SVNfR0VNSU5JTEFLRShkZXZfcHJpdikpIHsKLQkJaW50ZWxfZHNiX3JlZ193cml0ZShkc2IsIFBS
RUNfUEFMX0VYVDJfR0NfTUFYKHBpcGUsIDApLAorCQlpbnRlbF9kc2JfcmVnX3dyaXRlKGNydGNf
c3RhdGUsIFBSRUNfUEFMX0VYVDJfR0NfTUFYKHBpcGUsIDApLAogCQkJCSAgICAxIDw8IDE2KTsK
LQkJaW50ZWxfZHNiX3JlZ193cml0ZShkc2IsIFBSRUNfUEFMX0VYVDJfR0NfTUFYKHBpcGUsIDEp
LAorCQlpbnRlbF9kc2JfcmVnX3dyaXRlKGNydGNfc3RhdGUsIFBSRUNfUEFMX0VYVDJfR0NfTUFY
KHBpcGUsIDEpLAogCQkJCSAgICAxIDw8IDE2KTsKLQkJaW50ZWxfZHNiX3JlZ193cml0ZShkc2Is
IFBSRUNfUEFMX0VYVDJfR0NfTUFYKHBpcGUsIDIpLAorCQlpbnRlbF9kc2JfcmVnX3dyaXRlKGNy
dGNfc3RhdGUsIFBSRUNfUEFMX0VYVDJfR0NfTUFYKHBpcGUsIDIpLAogCQkJCSAgICAxIDw8IDE2
KTsKIAl9Ci0KLQlpbnRlbF9kc2JfcHV0KGRzYik7CiB9CiAKIHN0YXRpYyB2b2lkIGl2Yl9sb2Fk
X2x1dHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCkBAIC03NTMs
NyArNzUxLDcgQEAgc3RhdGljIHZvaWQgaXZiX2xvYWRfbHV0cyhjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAl9IGVsc2UgaWYgKGNydGNfc3RhdGUtPmdhbW1hX21v
ZGUgPT0gR0FNTUFfTU9ERV9NT0RFX1NQTElUKSB7CiAJCWl2Yl9sb2FkX2x1dF8xMChjcnRjLCBk
ZWdhbW1hX2x1dCwgUEFMX1BSRUNfU1BMSVRfTU9ERSB8CiAJCQkJUEFMX1BSRUNfSU5ERVhfVkFM
VUUoMCkpOwotCQlpdmJfbG9hZF9sdXRfZXh0X21heChjcnRjKTsKKwkJaXZiX2xvYWRfbHV0X2V4
dF9tYXgoY3J0Y19zdGF0ZSk7CiAJCWl2Yl9sb2FkX2x1dF8xMChjcnRjLCBnYW1tYV9sdXQsIFBB
TF9QUkVDX1NQTElUX01PREUgfAogCQkJCVBBTF9QUkVDX0lOREVYX1ZBTFVFKDUxMikpOwogCX0g
ZWxzZSB7CkBAIC03NjEsNyArNzU5LDcgQEAgc3RhdGljIHZvaWQgaXZiX2xvYWRfbHV0cyhjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAogCQlpdmJfbG9hZF9sdXRf
MTAoY3J0YywgYmxvYiwKIAkJCQlQQUxfUFJFQ19JTkRFWF9WQUxVRSgwKSk7Ci0JCWl2Yl9sb2Fk
X2x1dF9leHRfbWF4KGNydGMpOworCQlpdmJfbG9hZF9sdXRfZXh0X21heChjcnRjX3N0YXRlKTsK
IAl9CiB9CiAKQEAgLTc3Niw3ICs3NzQsNyBAQCBzdGF0aWMgdm9pZCBiZHdfbG9hZF9sdXRzKGNv
bnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCX0gZWxzZSBpZiAoY3J0
Y19zdGF0ZS0+Z2FtbWFfbW9kZSA9PSBHQU1NQV9NT0RFX01PREVfU1BMSVQpIHsKIAkJYmR3X2xv
YWRfbHV0XzEwKGNydGMsIGRlZ2FtbWFfbHV0LCBQQUxfUFJFQ19TUExJVF9NT0RFIHwKIAkJCQlQ
QUxfUFJFQ19JTkRFWF9WQUxVRSgwKSk7Ci0JCWl2Yl9sb2FkX2x1dF9leHRfbWF4KGNydGMpOwor
CQlpdmJfbG9hZF9sdXRfZXh0X21heChjcnRjX3N0YXRlKTsKIAkJYmR3X2xvYWRfbHV0XzEwKGNy
dGMsIGdhbW1hX2x1dCwgUEFMX1BSRUNfU1BMSVRfTU9ERSB8CiAJCQkJUEFMX1BSRUNfSU5ERVhf
VkFMVUUoNTEyKSk7CiAJfSBlbHNlIHsKQEAgLTc4NCw3ICs3ODIsNyBAQCBzdGF0aWMgdm9pZCBi
ZHdfbG9hZF9sdXRzKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQog
CiAJCWJkd19sb2FkX2x1dF8xMChjcnRjLCBibG9iLAogCQkJCVBBTF9QUkVDX0lOREVYX1ZBTFVF
KDApKTsKLQkJaXZiX2xvYWRfbHV0X2V4dF9tYXgoY3J0Yyk7CisJCWl2Yl9sb2FkX2x1dF9leHRf
bWF4KGNydGNfc3RhdGUpOwogCX0KIH0KIApAQCAtODc3LDcgKzg3NSw3IEBAIHN0YXRpYyB2b2lk
IGdsa19sb2FkX2x1dHMoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUp
CiAJCWlsa19sb2FkX2x1dF84KGNydGMsIGdhbW1hX2x1dCk7CiAJfSBlbHNlIHsKIAkJYmR3X2xv
YWRfbHV0XzEwKGNydGMsIGdhbW1hX2x1dCwgUEFMX1BSRUNfSU5ERVhfVkFMVUUoMCkpOwotCQlp
dmJfbG9hZF9sdXRfZXh0X21heChjcnRjKTsKKwkJaXZiX2xvYWRfbHV0X2V4dF9tYXgoY3J0Y19z
dGF0ZSk7CiAJfQogfQogCkBAIC05MDAsMTQgKzg5OCwxMiBAQCBpY2xfbG9hZF9nY21heChjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSwKIAkgICAgICAgY29uc3Qgc3Ry
dWN0IGRybV9jb2xvcl9sdXQgKmNvbG9yKQogewogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0g
dG9faW50ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwotCXN0cnVjdCBpbnRlbF9kc2Ig
KmRzYiA9IGludGVsX2RzYl9nZXQoY3J0Yyk7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBl
OwogCiAJLyogRklYTUUgTFVUIGVudHJpZXMgYXJlIDE2IGJpdCBvbmx5LCBzbyB3ZSBjYW4gcHJv
ZyAweEZGRkYgbWF4ICovCi0JaW50ZWxfZHNiX3JlZ193cml0ZShkc2IsIFBSRUNfUEFMX0dDX01B
WChwaXBlLCAwKSwgY29sb3ItPnJlZCk7Ci0JaW50ZWxfZHNiX3JlZ193cml0ZShkc2IsIFBSRUNf
UEFMX0dDX01BWChwaXBlLCAxKSwgY29sb3ItPmdyZWVuKTsKLQlpbnRlbF9kc2JfcmVnX3dyaXRl
KGRzYiwgUFJFQ19QQUxfR0NfTUFYKHBpcGUsIDIpLCBjb2xvci0+Ymx1ZSk7Ci0JaW50ZWxfZHNi
X3B1dChkc2IpOworCWludGVsX2RzYl9yZWdfd3JpdGUoY3J0Y19zdGF0ZSwgUFJFQ19QQUxfR0Nf
TUFYKHBpcGUsIDApLCBjb2xvci0+cmVkKTsKKwlpbnRlbF9kc2JfcmVnX3dyaXRlKGNydGNfc3Rh
dGUsIFBSRUNfUEFMX0dDX01BWChwaXBlLCAxKSwgY29sb3ItPmdyZWVuKTsKKwlpbnRlbF9kc2Jf
cmVnX3dyaXRlKGNydGNfc3RhdGUsIFBSRUNfUEFMX0dDX01BWChwaXBlLCAyKSwgY29sb3ItPmJs
dWUpOwogfQogCiBzdGF0aWMgdm9pZApAQCAtOTE2LDcgKzkxMiw2IEBAIGljbF9wcm9ncmFtX2dh
bW1hX3N1cGVyZmluZV9zZWdtZW50KGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRj
X3N0YXRlKQogCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50ZWxfY3J0YyhjcnRjX3N0
YXRlLT51YXBpLmNydGMpOwogCWNvbnN0IHN0cnVjdCBkcm1fcHJvcGVydHlfYmxvYiAqYmxvYiA9
IGNydGNfc3RhdGUtPmh3LmdhbW1hX2x1dDsKIAljb25zdCBzdHJ1Y3QgZHJtX2NvbG9yX2x1dCAq
bHV0ID0gYmxvYi0+ZGF0YTsKLQlzdHJ1Y3QgaW50ZWxfZHNiICpkc2IgPSBpbnRlbF9kc2JfZ2V0
KGNydGMpOwogCWVudW0gcGlwZSBwaXBlID0gY3J0Yy0+cGlwZTsKIAlpbnQgaTsKIApAQCAtOTI3
LDE5ICs5MjIsMTcgQEAgaWNsX3Byb2dyYW1fZ2FtbWFfc3VwZXJmaW5lX3NlZ21lbnQoY29uc3Qg
c3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJICogOSBlbnRyaWVzLCBjb3Jy
ZXNwb25kaW5nIHRvIHZhbHVlcyAwLCAxLyg4ICogMTI4ICogMjU2KSwKIAkgKiAyLyg4ICogMTI4
ICogMjU2KSAuLi4gOC8oOCAqIDEyOCAqIDI1NikuCiAJICovCi0JaW50ZWxfZHNiX3JlZ193cml0
ZShkc2IsIFBSRUNfUEFMX01VTFRJX1NFR19JTkRFWChwaXBlKSwKKwlpbnRlbF9kc2JfcmVnX3dy
aXRlKGNydGNfc3RhdGUsIFBSRUNfUEFMX01VTFRJX1NFR19JTkRFWChwaXBlKSwKIAkJCSAgICBQ
QUxfUFJFQ19BVVRPX0lOQ1JFTUVOVCk7CiAKIAlmb3IgKGkgPSAwOyBpIDwgOTsgaSsrKSB7CiAJ
CWNvbnN0IHN0cnVjdCBkcm1fY29sb3JfbHV0ICplbnRyeSA9ICZsdXRbaV07CiAKLQkJaW50ZWxf
ZHNiX2luZGV4ZWRfcmVnX3dyaXRlKGRzYiwgUFJFQ19QQUxfTVVMVElfU0VHX0RBVEEocGlwZSks
CisJCWludGVsX2RzYl9pbmRleGVkX3JlZ193cml0ZShjcnRjX3N0YXRlLCBQUkVDX1BBTF9NVUxU
SV9TRUdfREFUQShwaXBlKSwKIAkJCQkJICAgIGlsa19sdXRfMTJwNF9sZHcoZW50cnkpKTsKLQkJ
aW50ZWxfZHNiX2luZGV4ZWRfcmVnX3dyaXRlKGRzYiwgUFJFQ19QQUxfTVVMVElfU0VHX0RBVEEo
cGlwZSksCisJCWludGVsX2RzYl9pbmRleGVkX3JlZ193cml0ZShjcnRjX3N0YXRlLCBQUkVDX1BB
TF9NVUxUSV9TRUdfREFUQShwaXBlKSwKIAkJCQkJICAgIGlsa19sdXRfMTJwNF91ZHcoZW50cnkp
KTsKIAl9Ci0KLQlpbnRlbF9kc2JfcHV0KGRzYik7CiB9CiAKIHN0YXRpYyB2b2lkCkBAIC05NDks
NyArOTQyLDYgQEAgaWNsX3Byb2dyYW1fZ2FtbWFfbXVsdGlfc2VnbWVudChjb25zdCBzdHJ1Y3Qg
aW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAljb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5
X2Jsb2IgKmJsb2IgPSBjcnRjX3N0YXRlLT5ody5nYW1tYV9sdXQ7CiAJY29uc3Qgc3RydWN0IGRy
bV9jb2xvcl9sdXQgKmx1dCA9IGJsb2ItPmRhdGE7CiAJY29uc3Qgc3RydWN0IGRybV9jb2xvcl9s
dXQgKmVudHJ5OwotCXN0cnVjdCBpbnRlbF9kc2IgKmRzYiA9IGludGVsX2RzYl9nZXQoY3J0Yyk7
CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCWludCBpOwogCkBAIC05NjMsMTIgKzk1
NSwxMyBAQCBpY2xfcHJvZ3JhbV9nYW1tYV9tdWx0aV9zZWdtZW50KGNvbnN0IHN0cnVjdCBpbnRl
bF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKQogCSAqIFBBTF9QUkVDX0lOREVYWzBdIGFuZCBQQUxf
UFJFQ19JTkRFWFsxXSBtYXAgdG8gc2VnMlsxXSwKIAkgKiBzZWcyWzBdIGJlaW5nIHVudXNlZCBi
eSB0aGUgaGFyZHdhcmUuCiAJICovCi0JaW50ZWxfZHNiX3JlZ193cml0ZShkc2IsIFBSRUNfUEFM
X0lOREVYKHBpcGUpLCBQQUxfUFJFQ19BVVRPX0lOQ1JFTUVOVCk7CisJaW50ZWxfZHNiX3JlZ193
cml0ZShjcnRjX3N0YXRlLCBQUkVDX1BBTF9JTkRFWChwaXBlKSwKKwkJCSAgICBQQUxfUFJFQ19B
VVRPX0lOQ1JFTUVOVCk7CiAJZm9yIChpID0gMTsgaSA8IDI1NzsgaSsrKSB7CiAJCWVudHJ5ID0g
Jmx1dFtpICogOF07Ci0JCWludGVsX2RzYl9pbmRleGVkX3JlZ193cml0ZShkc2IsIFBSRUNfUEFM
X0RBVEEocGlwZSksCisJCWludGVsX2RzYl9pbmRleGVkX3JlZ193cml0ZShjcnRjX3N0YXRlLCBQ
UkVDX1BBTF9EQVRBKHBpcGUpLAogCQkJCQkgICAgaWxrX2x1dF8xMnA0X2xkdyhlbnRyeSkpOwot
CQlpbnRlbF9kc2JfaW5kZXhlZF9yZWdfd3JpdGUoZHNiLCBQUkVDX1BBTF9EQVRBKHBpcGUpLAor
CQlpbnRlbF9kc2JfaW5kZXhlZF9yZWdfd3JpdGUoY3J0Y19zdGF0ZSwgUFJFQ19QQUxfREFUQShw
aXBlKSwKIAkJCQkJICAgIGlsa19sdXRfMTJwNF91ZHcoZW50cnkpKTsKIAl9CiAKQEAgLTk4Niwy
NCArOTc5LDIyIEBAIGljbF9wcm9ncmFtX2dhbW1hX211bHRpX3NlZ21lbnQoY29uc3Qgc3RydWN0
IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpCiAJICovCiAJZm9yIChpID0gMDsgaSA8IDI1
NjsgaSsrKSB7CiAJCWVudHJ5ID0gJmx1dFtpICogOCAqIDEyOF07Ci0JCWludGVsX2RzYl9pbmRl
eGVkX3JlZ193cml0ZShkc2IsIFBSRUNfUEFMX0RBVEEocGlwZSksCisJCWludGVsX2RzYl9pbmRl
eGVkX3JlZ193cml0ZShjcnRjX3N0YXRlLCBQUkVDX1BBTF9EQVRBKHBpcGUpLAogCQkJCQkgICAg
aWxrX2x1dF8xMnA0X2xkdyhlbnRyeSkpOwotCQlpbnRlbF9kc2JfaW5kZXhlZF9yZWdfd3JpdGUo
ZHNiLCBQUkVDX1BBTF9EQVRBKHBpcGUpLAorCQlpbnRlbF9kc2JfaW5kZXhlZF9yZWdfd3JpdGUo
Y3J0Y19zdGF0ZSwgUFJFQ19QQUxfREFUQShwaXBlKSwKIAkJCQkJICAgIGlsa19sdXRfMTJwNF91
ZHcoZW50cnkpKTsKIAl9CiAKIAkvKiBUaGUgbGFzdCBlbnRyeSBpbiB0aGUgTFVUIGlzIHRvIGJl
IHByb2dyYW1tZWQgaW4gR0NNQVggKi8KIAllbnRyeSA9ICZsdXRbMjU2ICogOCAqIDEyOF07CiAJ
aWNsX2xvYWRfZ2NtYXgoY3J0Y19zdGF0ZSwgZW50cnkpOwotCWl2Yl9sb2FkX2x1dF9leHRfbWF4
KGNydGMpOwotCWludGVsX2RzYl9wdXQoZHNiKTsKKwlpdmJfbG9hZF9sdXRfZXh0X21heChjcnRj
X3N0YXRlKTsKIH0KIAogc3RhdGljIHZvaWQgaWNsX2xvYWRfbHV0cyhjb25zdCBzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKIAljb25zdCBzdHJ1Y3QgZHJtX3Byb3BlcnR5
X2Jsb2IgKmdhbW1hX2x1dCA9IGNydGNfc3RhdGUtPmh3LmdhbW1hX2x1dDsKIAlzdHJ1Y3QgaW50
ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsKLQlz
dHJ1Y3QgaW50ZWxfZHNiICpkc2IgPSBpbnRlbF9kc2JfZ2V0KGNydGMpOwogCiAJaWYgKGNydGNf
c3RhdGUtPmh3LmRlZ2FtbWFfbHV0KQogCQlnbGtfbG9hZF9kZWdhbW1hX2x1dChjcnRjX3N0YXRl
KTsKQEAgLTEwMTgsMTEgKzEwMDksMTAgQEAgc3RhdGljIHZvaWQgaWNsX2xvYWRfbHV0cyhjb25z
dCBzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIAkJYnJlYWs7CiAJZGVmYXVs
dDoKIAkJYmR3X2xvYWRfbHV0XzEwKGNydGMsIGdhbW1hX2x1dCwgUEFMX1BSRUNfSU5ERVhfVkFM
VUUoMCkpOwotCQlpdmJfbG9hZF9sdXRfZXh0X21heChjcnRjKTsKKwkJaXZiX2xvYWRfbHV0X2V4
dF9tYXgoY3J0Y19zdGF0ZSk7CiAJfQogCi0JaW50ZWxfZHNiX2NvbW1pdChkc2IpOwotCWludGVs
X2RzYl9wdXQoZHNiKTsKKwlpbnRlbF9kc2JfY29tbWl0KGNydGNfc3RhdGUpOwogfQogCiBzdGF0
aWMgdTMyIGNodl9jZ21fZGVnYW1tYV9sZHcoY29uc3Qgc3RydWN0IGRybV9jb2xvcl9sdXQgKmNv
bG9yKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNw
bGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRl
eCA0MzJiNGVlYWY5ZjYuLjUxNDQ4M2ZmZDI0NyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
ZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTE0ODczLDggKzE0ODczLDI0IEBAIHN0YXRpYyBp
bnQgaW50ZWxfYXRvbWljX2NoZWNrKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsCiAKIHN0YXRpYyBp
bnQgaW50ZWxfYXRvbWljX3ByZXBhcmVfY29tbWl0KHN0cnVjdCBpbnRlbF9hdG9taWNfc3RhdGUg
KnN0YXRlKQogewotCXJldHVybiBkcm1fYXRvbWljX2hlbHBlcl9wcmVwYXJlX3BsYW5lcyhzdGF0
ZS0+YmFzZS5kZXYsCi0JCQkJCQkmc3RhdGUtPmJhc2UpOworCXN0cnVjdCBpbnRlbF9jcnRjX3N0
YXRlICpjcnRjX3N0YXRlOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjOworCWludCBpLCByZXQ7
CisKKwlyZXQgPSBkcm1fYXRvbWljX2hlbHBlcl9wcmVwYXJlX3BsYW5lcyhzdGF0ZS0+YmFzZS5k
ZXYsICZzdGF0ZS0+YmFzZSk7CisJaWYgKHJldCA8IDApCisJCXJldHVybiByZXQ7CisKKwlmb3Jf
ZWFjaF9uZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0YywgY3J0Y19zdGF0ZSwgaSkg
eworCQlib29sIG1vZGVfY2hhbmdlZCA9IG5lZWRzX21vZGVzZXQoY3J0Y19zdGF0ZSk7CisKKwkJ
aWYgKG1vZGVfY2hhbmdlZCB8fCBjcnRjX3N0YXRlLT51cGRhdGVfcGlwZSB8fAorCQkgICAgY3J0
Y19zdGF0ZS0+dWFwaS5jb2xvcl9tZ210X2NoYW5nZWQpIHsKKwkJCWludGVsX2RzYl9wcmVwYXJl
KGNydGNfc3RhdGUpOworCQl9CisJfQorCisJcmV0dXJuIDA7CiB9CiAKIHUzMiBpbnRlbF9jcnRj
X2dldF92YmxhbmtfY291bnRlcihzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YykKQEAgLTE1MzI3LDE1
ICsxNTM0MywyNyBAQCBzdGF0aWMgdm9pZCBpbnRlbF9hdG9taWNfY29tbWl0X2ZlbmNlX3dhaXQo
c3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqaW50ZWxfc3RhdAogCQkgICAgJndhaXRfcmVzZXQp
OwogfQogCitzdGF0aWMgdm9pZCBpbnRlbF9jbGVhbnVwX2RzYnMoc3RydWN0IGludGVsX2F0b21p
Y19zdGF0ZSAqc3RhdGUpCit7CisJc3RydWN0IGludGVsX2NydGNfc3RhdGUgKm9sZF9jcnRjX3N0
YXRlLCAqbmV3X2NydGNfc3RhdGU7CisJc3RydWN0IGludGVsX2NydGMgKmNydGM7CisJaW50IGk7
CisKKwlmb3JfZWFjaF9vbGRuZXdfaW50ZWxfY3J0Y19pbl9zdGF0ZShzdGF0ZSwgY3J0Yywgb2xk
X2NydGNfc3RhdGUsCisJCQkJCSAgICBuZXdfY3J0Y19zdGF0ZSwgaSkKKwkJaW50ZWxfZHNiX2Ns
ZWFudXAob2xkX2NydGNfc3RhdGUpOworfQorCiBzdGF0aWMgdm9pZCBpbnRlbF9hdG9taWNfY2xl
YW51cF93b3JrKHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKIHsKLQlzdHJ1Y3QgZHJtX2F0b21p
Y19zdGF0ZSAqc3RhdGUgPQotCQljb250YWluZXJfb2Yod29yaywgc3RydWN0IGRybV9hdG9taWNf
c3RhdGUsIGNvbW1pdF93b3JrKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRv
X2k5MTUoc3RhdGUtPmRldik7CisJc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSAqc3RhdGUgPQor
CQljb250YWluZXJfb2Yod29yaywgc3RydWN0IGludGVsX2F0b21pY19zdGF0ZSwgYmFzZS5jb21t
aXRfd29yayk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KHN0YXRl
LT5iYXNlLmRldik7CiAKLQlkcm1fYXRvbWljX2hlbHBlcl9jbGVhbnVwX3BsYW5lcygmaTkxNS0+
ZHJtLCBzdGF0ZSk7Ci0JZHJtX2F0b21pY19oZWxwZXJfY29tbWl0X2NsZWFudXBfZG9uZShzdGF0
ZSk7Ci0JZHJtX2F0b21pY19zdGF0ZV9wdXQoc3RhdGUpOworCWludGVsX2NsZWFudXBfZHNicyhz
dGF0ZSk7CisJZHJtX2F0b21pY19oZWxwZXJfY2xlYW51cF9wbGFuZXMoJmk5MTUtPmRybSwgJnN0
YXRlLT5iYXNlKTsKKwlkcm1fYXRvbWljX2hlbHBlcl9jb21taXRfY2xlYW51cF9kb25lKCZzdGF0
ZS0+YmFzZSk7CisJZHJtX2F0b21pY19zdGF0ZV9wdXQoJnN0YXRlLT5iYXNlKTsKIAogCWludGVs
X2F0b21pY19oZWxwZXJfZnJlZV9zdGF0ZShpOTE1KTsKIH0KQEAgLTE1NDY5LDYgKzE1NDk3LDEz
IEBAIHN0YXRpYyB2b2lkIGludGVsX2F0b21pY19jb21taXRfdGFpbChzdHJ1Y3QgaW50ZWxfYXRv
bWljX3N0YXRlICpzdGF0ZSkKIAkJCW1vZGVzZXRfcHV0X3Bvd2VyX2RvbWFpbnMoZGV2X3ByaXYs
IHB1dF9kb21haW5zW2ldKTsKIAogCQlpbnRlbF9tb2Rlc2V0X3ZlcmlmeV9jcnRjKGNydGMsIHN0
YXRlLCBvbGRfY3J0Y19zdGF0ZSwgbmV3X2NydGNfc3RhdGUpOworCisJCS8qCisJCSAqIERTQiBj
bGVhbnVwIGlzIGRvbmUgaW4gY2xlYW51cF93b3JrIGFsaWduaW5nIHdpdGggZnJhbWVidWZmZXIK
KwkJICogY2xlYW51cC4gU28gY29weSBhbmQgcmVzZXQgdGhlIGRzYiBzdHJ1Y3R1cmUgdG8gc3lu
YyB3aXRoCisJCSAqIGNvbW1pdF9kb25lIGFuZCBsYXRlciBkbyBkc2IgY2xlYW51cCBpbiBjbGVh
bnVwX3dvcmsuCisJCSAqLworCQlvbGRfY3J0Y19zdGF0ZS0+ZHNiID0gZmV0Y2hfYW5kX3plcm8o
Jm5ld19jcnRjX3N0YXRlLT5kc2IpOwogCX0KIAogCS8qIFVuZGVycnVucyBkb24ndCBhbHdheXMg
cmFpc2UgaW50ZXJydXB0cywgc28gY2hlY2sgbWFudWFsbHkgKi8KQEAgLTE1NjE4LDggKzE1NjUz
LDE1IEBAIHN0YXRpYyBpbnQgaW50ZWxfYXRvbWljX2NvbW1pdChzdHJ1Y3QgZHJtX2RldmljZSAq
ZGV2LAogCQlpbnRlbF9hdG9taWNfc3dhcF9nbG9iYWxfc3RhdGUoc3RhdGUpOwogCiAJaWYgKHJl
dCkgeworCQlzdHJ1Y3QgaW50ZWxfY3J0Y19zdGF0ZSAqbmV3X2NydGNfc3RhdGU7CisJCXN0cnVj
dCBpbnRlbF9jcnRjICpjcnRjOworCQlpbnQgaTsKKwogCQlpOTE1X3N3X2ZlbmNlX2NvbW1pdCgm
c3RhdGUtPmNvbW1pdF9yZWFkeSk7CiAKKwkJZm9yX2VhY2hfbmV3X2ludGVsX2NydGNfaW5fc3Rh
dGUoc3RhdGUsIGNydGMsIG5ld19jcnRjX3N0YXRlLCBpKQorCQkJaW50ZWxfZHNiX2NsZWFudXAo
bmV3X2NydGNfc3RhdGUpOworCiAJCWRybV9hdG9taWNfaGVscGVyX2NsZWFudXBfcGxhbmVzKGRl
diwgJnN0YXRlLT5iYXNlKTsKIAkJaW50ZWxfcnVudGltZV9wbV9wdXQoJmRldl9wcml2LT5ydW50
aW1lX3BtLCBzdGF0ZS0+d2FrZXJlZik7CiAJCXJldHVybiByZXQ7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaCBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZGlzcGxheV90eXBlcy5oCmluZGV4IDg3ODc2ZmNl
OTFhNS4uY2E1NzkwMDVkODE4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNw
bGF5L2ludGVsX2Rpc3BsYXlfdHlwZXMuaApAQCAtMTA3OCw2ICsxMDc4LDkgQEAgc3RydWN0IGlu
dGVsX2NydGNfc3RhdGUgewogCiAJLyogT25seSB2YWxpZCBvbiBUR0wrICovCiAJZW51bSB0cmFu
c2NvZGVyIG1zdF9tYXN0ZXJfdHJhbnNjb2RlcjsKKworCS8qIEZvciBEU0IgcmVsYXRlZCBpbmZv
ICovCisJc3RydWN0IGludGVsX2RzYiAqZHNiOwogfTsKIAogZW51bSBpbnRlbF9waXBlX2NyY19z
b3VyY2UgewpAQCAtMTE0Nyw5ICsxMTUwLDYgQEAgc3RydWN0IGludGVsX2NydGMgewogCS8qIHNj
YWxlcnMgYXZhaWxhYmxlIG9uIHRoaXMgY3J0YyAqLwogCWludCBudW1fc2NhbGVyczsKIAotCS8q
IHBlciBwaXBlIERTQiByZWxhdGVkIGluZm8gKi8KLQlzdHJ1Y3QgaW50ZWxfZHNiIGRzYjsKLQog
I2lmZGVmIENPTkZJR19ERUJVR19GUwogCXN0cnVjdCBpbnRlbF9waXBlX2NyYyBwaXBlX2NyYzsK
ICNlbmRpZgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9k
c2IuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHNiLmMKaW5kZXggMjlm
ZWM2YTkyZDE3Li4wNjQyNDI4MTc2YmIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZHNiLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9p
bnRlbF9kc2IuYwpAQCAtMzQsMTUyICszNCw1MiBAQAogI2RlZmluZSBEU0JfQllURV9FTl9TSElG
VAkJMjAKICNkZWZpbmUgRFNCX1JFR19WQUxVRV9NQVNLCQkweGZmZmZmCiAKLXN0YXRpYyBib29s
IGlzX2RzYl9idXN5KHN0cnVjdCBpbnRlbF9kc2IgKmRzYikKK3N0YXRpYyBib29sIGlzX2RzYl9i
dXN5KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBlbnVtIHBpcGUgcGlwZSwKKwkJCWVu
dW0gZHNiX2lkIGlkKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gY29udGFpbmVyX29m
KGRzYiwgdHlwZW9mKCpjcnRjKSwgZHNiKTsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2
X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKLQllbnVtIHBpcGUgcGlwZSA9IGNydGMt
PnBpcGU7Ci0KLQlyZXR1cm4gRFNCX1NUQVRVUyAmIGludGVsX2RlX3JlYWQoZGV2X3ByaXYsIERT
Ql9DVFJMKHBpcGUsIGRzYi0+aWQpKTsKKwlyZXR1cm4gRFNCX1NUQVRVUyAmIGludGVsX2RlX3Jl
YWQoaTkxNSwgRFNCX0NUUkwocGlwZSwgaWQpKTsKIH0KIAotc3RhdGljIGJvb2wgaW50ZWxfZHNi
X2VuYWJsZV9lbmdpbmUoc3RydWN0IGludGVsX2RzYiAqZHNiKQorc3RhdGljIGJvb2wgaW50ZWxf
ZHNiX2VuYWJsZV9lbmdpbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCisJCQkJICAg
IGVudW0gcGlwZSBwaXBlLCBlbnVtIGRzYl9pZCBpZCkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAq
Y3J0YyA9IGNvbnRhaW5lcl9vZihkc2IsIHR5cGVvZigqY3J0YyksIGRzYik7Ci0Jc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gdG9faTkxNShjcnRjLT5iYXNlLmRldik7Ci0JZW51
bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCXUzMiBkc2JfY3RybDsKIAotCWRzYl9jdHJsID0g
aW50ZWxfZGVfcmVhZChkZXZfcHJpdiwgRFNCX0NUUkwocGlwZSwgZHNiLT5pZCkpOworCWRzYl9j
dHJsID0gaW50ZWxfZGVfcmVhZChpOTE1LCBEU0JfQ1RSTChwaXBlLCBpZCkpOwogCWlmIChEU0Jf
U1RBVFVTICYgZHNiX2N0cmwpIHsKLQkJZHJtX2RiZ19rbXMoJmRldl9wcml2LT5kcm0sICJEU0Ig
ZW5naW5lIGlzIGJ1c3kuXG4iKTsKKwkJZHJtX2RiZ19rbXMoJmk5MTUtPmRybSwgIkRTQiBlbmdp
bmUgaXMgYnVzeS5cbiIpOwogCQlyZXR1cm4gZmFsc2U7CiAJfQogCiAJZHNiX2N0cmwgfD0gRFNC
X0VOQUJMRTsKLQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRFNCX0NUUkwocGlwZSwgZHNiLT5p
ZCksIGRzYl9jdHJsKTsKKwlpbnRlbF9kZV93cml0ZShpOTE1LCBEU0JfQ1RSTChwaXBlLCBpZCks
IGRzYl9jdHJsKTsKIAotCWludGVsX2RlX3Bvc3RpbmdfcmVhZChkZXZfcHJpdiwgRFNCX0NUUkwo
cGlwZSwgZHNiLT5pZCkpOworCWludGVsX2RlX3Bvc3RpbmdfcmVhZChpOTE1LCBEU0JfQ1RSTChw
aXBlLCBpZCkpOwogCXJldHVybiB0cnVlOwogfQogCi1zdGF0aWMgYm9vbCBpbnRlbF9kc2JfZGlz
YWJsZV9lbmdpbmUoc3RydWN0IGludGVsX2RzYiAqZHNiKQorc3RhdGljIGJvb2wgaW50ZWxfZHNi
X2Rpc2FibGVfZW5naW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAorCQkJCSAgICAg
ZW51bSBwaXBlIHBpcGUsIGVudW0gZHNiX2lkIGlkKQogewotCXN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjID0gY29udGFpbmVyX29mKGRzYiwgdHlwZW9mKCpjcnRjKSwgZHNiKTsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKLQllbnVt
IHBpcGUgcGlwZSA9IGNydGMtPnBpcGU7CiAJdTMyIGRzYl9jdHJsOwogCi0JZHNiX2N0cmwgPSBp
bnRlbF9kZV9yZWFkKGRldl9wcml2LCBEU0JfQ1RSTChwaXBlLCBkc2ItPmlkKSk7CisJZHNiX2N0
cmwgPSBpbnRlbF9kZV9yZWFkKGk5MTUsIERTQl9DVFJMKHBpcGUsIGlkKSk7CiAJaWYgKERTQl9T
VEFUVVMgJiBkc2JfY3RybCkgewotCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgIkRTQiBl
bmdpbmUgaXMgYnVzeS5cbiIpOworCQlkcm1fZGJnX2ttcygmaTkxNS0+ZHJtLCAiRFNCIGVuZ2lu
ZSBpcyBidXN5LlxuIik7CiAJCXJldHVybiBmYWxzZTsKIAl9CiAKIAlkc2JfY3RybCAmPSB+RFNC
X0VOQUJMRTsKLQlpbnRlbF9kZV93cml0ZShkZXZfcHJpdiwgRFNCX0NUUkwocGlwZSwgZHNiLT5p
ZCksIGRzYl9jdHJsKTsKKwlpbnRlbF9kZV93cml0ZShpOTE1LCBEU0JfQ1RSTChwaXBlLCBpZCks
IGRzYl9jdHJsKTsKIAotCWludGVsX2RlX3Bvc3RpbmdfcmVhZChkZXZfcHJpdiwgRFNCX0NUUkwo
cGlwZSwgZHNiLT5pZCkpOworCWludGVsX2RlX3Bvc3RpbmdfcmVhZChpOTE1LCBEU0JfQ1RSTChw
aXBlLCBpZCkpOwogCXJldHVybiB0cnVlOwogfQogCi0vKioKLSAqIGludGVsX2RzYl9nZXQoKSAt
IEFsbG9jYXRlIERTQiBjb250ZXh0IGFuZCByZXR1cm4gYSBEU0IgaW5zdGFuY2UuCi0gKiBAY3J0
YzogaW50ZWxfY3J0YyBzdHJ1Y3R1cmUgdG8gZ2V0IHBpcGUgaW5mby4KLSAqCi0gKiBUaGlzIGZ1
bmN0aW9uIHByb3ZpZGVzIGhhbmRsZSBvZiBhIERTQiBpbnN0YW5jZSwgZm9yIHRoZSBmdXJ0aGVy
IERTQgotICogb3BlcmF0aW9ucy4KLSAqCi0gKiBSZXR1cm5zOiBhZGRyZXNzIG9mIEludGVsX2Rz
YiBpbnN0YW5jZSByZXF1ZXN0ZWQgZm9yLgotICogRmFpbHVyZTogUmV0dXJucyB0aGUgc2FtZSBE
U0IgaW5zdGFuY2UsIGJ1dCB3aXRob3V0IGEgY29tbWFuZCBidWZmZXIuCi0gKi8KLQotc3RydWN0
IGludGVsX2RzYiAqCi1pbnRlbF9kc2JfZ2V0KHN0cnVjdCBpbnRlbF9jcnRjICpjcnRjKQotewot
CXN0cnVjdCBkcm1fZGV2aWNlICpkZXYgPSBjcnRjLT5iYXNlLmRldjsKLQlzdHJ1Y3QgZHJtX2k5
MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoZGV2KTsKLQlzdHJ1Y3QgaW50ZWxfZHNiICpkc2Ig
PSAmY3J0Yy0+ZHNiOwotCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmo7Ci0Jc3RydWN0
IGk5MTVfdm1hICp2bWE7Ci0JdTMyICpidWY7Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7Ci0K
LQlpZiAoIUhBU19EU0IoaTkxNSkpCi0JCXJldHVybiBkc2I7Ci0KLQlpZiAoZHNiLT5yZWZjb3Vu
dCsrICE9IDApCi0JCXJldHVybiBkc2I7Ci0KLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9n
ZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCi0Jb2JqID0gaTkxNV9nZW1fb2JqZWN0X2NyZWF0ZV9p
bnRlcm5hbChpOTE1LCBEU0JfQlVGX1NJWkUpOwotCWlmIChJU19FUlIob2JqKSkgewotCQlkcm1f
ZXJyKCZpOTE1LT5kcm0sICJHZW0gb2JqZWN0IGNyZWF0aW9uIGZhaWxlZFxuIik7Ci0JCWdvdG8g
b3V0OwotCX0KLQotCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9nZ3R0X3BpbihvYmosIE5VTEwsIDAs
IDAsIDApOwotCWlmIChJU19FUlIodm1hKSkgewotCQlkcm1fZXJyKCZpOTE1LT5kcm0sICJWbWEg
Y3JlYXRpb24gZmFpbGVkXG4iKTsKLQkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYmopOwotCQlnb3Rv
IG91dDsKLQl9Ci0KLQlidWYgPSBpOTE1X2dlbV9vYmplY3RfcGluX21hcCh2bWEtPm9iaiwgSTkx
NV9NQVBfV0MpOwotCWlmIChJU19FUlIoYnVmKSkgewotCQlkcm1fZXJyKCZpOTE1LT5kcm0sICJD
b21tYW5kIGJ1ZmZlciBjcmVhdGlvbiBmYWlsZWRcbiIpOwotCQlnb3RvIG91dDsKLQl9Ci0KLQlk
c2ItPmlkID0gRFNCMTsKLQlkc2ItPnZtYSA9IHZtYTsKLQlkc2ItPmNtZF9idWYgPSBidWY7Ci0K
LW91dDoKLQkvKgotCSAqIE9uIGVycm9yIGRzYi0+Y21kX2J1ZiB3aWxsIGNvbnRpbnVlIHRvIGJl
IE5VTEwsIG1ha2luZyB0aGUgd3JpdGVzCi0JICogcGFzcy10aHJvdWdoLiBMZWF2ZSB0aGUgZGFu
Z2xpbmcgcmVmIHRvIGJlIHJlbW92ZWQgbGF0ZXIgYnkgdGhlCi0JICogY29ycmVzcG9uZGluZyBp
bnRlbF9kc2JfcHV0KCk6IHRoZSBpbXBvcnRhbnQgZXJyb3IgbWVzc2FnZSB3aWxsCi0JICogYWxy
ZWFkeSBiZSBsb2dnZWQgYWJvdmUuCi0JICovCi0KLQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkx
NS0+cnVudGltZV9wbSwgd2FrZXJlZik7Ci0KLQlyZXR1cm4gZHNiOwotfQotCi0vKioKLSAqIGlu
dGVsX2RzYl9wdXQoKSAtIFRvIGRlc3Ryb3kgRFNCIGNvbnRleHQuCi0gKiBAZHNiOiBpbnRlbF9k
c2Igc3RydWN0dXJlLgotICoKLSAqIFRoaXMgZnVuY3Rpb24gZGVzdHJveXMgdGhlIERTQiBjb250
ZXh0IGFsbG9jYXRlZCBieSBhIGRzYl9nZXQoKSwgYnkKLSAqIHVucGlubmluZyBhbmQgcmVsZWFz
aW5nIHRoZSBWTUEgb2JqZWN0IGFzc29jaWF0ZWQgd2l0aCBpdC4KLSAqLwotCi12b2lkIGludGVs
X2RzYl9wdXQoc3RydWN0IGludGVsX2RzYiAqZHNiKQotewotCXN0cnVjdCBpbnRlbF9jcnRjICpj
cnRjID0gY29udGFpbmVyX29mKGRzYiwgdHlwZW9mKCpjcnRjKSwgZHNiKTsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUoY3J0Yy0+YmFzZS5kZXYpOwotCi0JaWYgKCFI
QVNfRFNCKGk5MTUpKQotCQlyZXR1cm47Ci0KLQlpZiAoZHJtX1dBUk5fT04oJmk5MTUtPmRybSwg
ZHNiLT5yZWZjb3VudCA9PSAwKSkKLQkJcmV0dXJuOwotCi0JaWYgKC0tZHNiLT5yZWZjb3VudCA9
PSAwKSB7Ci0JCWk5MTVfdm1hX3VucGluX2FuZF9yZWxlYXNlKCZkc2ItPnZtYSwgSTkxNV9WTUFf
UkVMRUFTRV9NQVApOwotCQlkc2ItPmNtZF9idWYgPSBOVUxMOwotCQlkc2ItPmZyZWVfcG9zID0g
MDsKLQkJZHNiLT5pbnNfc3RhcnRfb2Zmc2V0ID0gMDsKLQl9Ci19Ci0KIC8qKgogICogaW50ZWxf
ZHNiX2luZGV4ZWRfcmVnX3dyaXRlKCkgLVdyaXRlIHRvIHRoZSBEU0IgY29udGV4dCBmb3IgYXV0
bwogICogaW5jcmVtZW50IHJlZ2lzdGVyLgotICogQGRzYjogaW50ZWxfZHNiIHN0cnVjdHVyZS4K
KyAqIEBjcnRjX3N0YXRlOiBpbnRlbF9jcnRjX3N0YXRlIHN0cnVjdHVyZQogICogQHJlZzogcmVn
aXN0ZXIgYWRkcmVzcy4KICAqIEB2YWw6IHZhbHVlLgogICoKQEAgLTE4OSwxOSArODksMjAgQEAg
dm9pZCBpbnRlbF9kc2JfcHV0KHN0cnVjdCBpbnRlbF9kc2IgKmRzYikKICAqIGlzIGRvbmUgdGhy
b3VnaCBtbWlvIHdyaXRlLgogICovCiAKLXZvaWQgaW50ZWxfZHNiX2luZGV4ZWRfcmVnX3dyaXRl
KHN0cnVjdCBpbnRlbF9kc2IgKmRzYiwgaTkxNV9yZWdfdCByZWcsCi0JCQkJIHUzMiB2YWwpCit2
b2lkIGludGVsX2RzYl9pbmRleGVkX3JlZ193cml0ZShjb25zdCBzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZSAqY3J0Y19zdGF0ZSwKKwkJCQkgaTkxNV9yZWdfdCByZWcsIHUzMiB2YWwpCiB7Ci0Jc3Ry
dWN0IGludGVsX2NydGMgKmNydGMgPSBjb250YWluZXJfb2YoZHNiLCB0eXBlb2YoKmNydGMpLCBk
c2IpOworCXN0cnVjdCBpbnRlbF9kc2IgKmRzYiA9IGNydGNfc3RhdGUtPmRzYjsKKwlzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0Y19zdGF0ZS0+dWFwaS5jcnRjKTsK
IAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0b19pOTE1KGNydGMtPmJhc2Uu
ZGV2KTsKLQl1MzIgKmJ1ZiA9IGRzYi0+Y21kX2J1ZjsKKwl1MzIgKmJ1ZjsKIAl1MzIgcmVnX3Zh
bDsKIAotCWlmICghYnVmKSB7CisJaWYgKCEoZHNiICYmIGRzYi0+Y21kX2J1ZikpIHsKIAkJaW50
ZWxfZGVfd3JpdGUoZGV2X3ByaXYsIHJlZywgdmFsKTsKIAkJcmV0dXJuOwogCX0KLQorCWJ1ZiA9
IGRzYi0+Y21kX2J1ZjsKIAlpZiAoZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIGRzYi0+ZnJl
ZV9wb3MgPj0gRFNCX0JVRl9TSVpFKSkgewogCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwg
IkRTQiBidWZmZXIgb3ZlcmZsb3dcbiIpOwogCQlyZXR1cm47CkBAIC0yNTYsNyArMTU3LDcgQEAg
dm9pZCBpbnRlbF9kc2JfaW5kZXhlZF9yZWdfd3JpdGUoc3RydWN0IGludGVsX2RzYiAqZHNiLCBp
OTE1X3JlZ190IHJlZywKIC8qKgogICogaW50ZWxfZHNiX3JlZ193cml0ZSgpIC1Xcml0ZSB0byB0
aGUgRFNCIGNvbnRleHQgZm9yIG5vcm1hbAogICogcmVnaXN0ZXIuCi0gKiBAZHNiOiBpbnRlbF9k
c2Igc3RydWN0dXJlLgorICogQGNydGNfc3RhdGU6IGludGVsX2NydGNfc3RhdGUgc3RydWN0dXJl
CiAgKiBAcmVnOiByZWdpc3RlciBhZGRyZXNzLgogICogQHZhbDogdmFsdWUuCiAgKgpAQCAtMjY1
LDE3ICsxNjYsMTkgQEAgdm9pZCBpbnRlbF9kc2JfaW5kZXhlZF9yZWdfd3JpdGUoc3RydWN0IGlu
dGVsX2RzYiAqZHNiLCBpOTE1X3JlZ190IHJlZywKICAqIGFuZCByZXN0IGFsbCBlcnJvbmVvdXMg
Y29uZGl0aW9uIHJlZ2lzdGVyIHByb2dyYW1taW5nIGlzIGRvbmUKICAqIHRocm91Z2ggbW1pbyB3
cml0ZS4KICAqLwotdm9pZCBpbnRlbF9kc2JfcmVnX3dyaXRlKHN0cnVjdCBpbnRlbF9kc2IgKmRz
YiwgaTkxNV9yZWdfdCByZWcsIHUzMiB2YWwpCit2b2lkIGludGVsX2RzYl9yZWdfd3JpdGUoY29u
c3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUsCisJCQkgaTkxNV9yZWdfdCBy
ZWcsIHUzMiB2YWwpCiB7Ci0Jc3RydWN0IGludGVsX2NydGMgKmNydGMgPSBjb250YWluZXJfb2Yo
ZHNiLCB0eXBlb2YoKmNydGMpLCBkc2IpOworCXN0cnVjdCBpbnRlbF9kc2IgKmRzYiA9IGNydGNf
c3RhdGUtPmRzYjsKKwlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IHRvX2ludGVsX2NydGMoY3J0
Y19zdGF0ZS0+dWFwaS5jcnRjKTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYg
PSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKIAl1MzIgKmJ1ZiA9IGRzYi0+Y21kX2J1ZjsKIAot
CWlmICghYnVmKSB7CisJaWYgKCEoZHNiICYmIGRzYi0+Y21kX2J1ZikpIHsKIAkJaW50ZWxfZGVf
d3JpdGUoZGV2X3ByaXYsIHJlZywgdmFsKTsKIAkJcmV0dXJuOwogCX0KLQorCWJ1ZiA9IGRzYi0+
Y21kX2J1ZjsKIAlpZiAoZHJtX1dBUk5fT04oJmRldl9wcml2LT5kcm0sIGRzYi0+ZnJlZV9wb3Mg
Pj0gRFNCX0JVRl9TSVpFKSkgewogCQlkcm1fZGJnX2ttcygmZGV2X3ByaXYtPmRybSwgIkRTQiBi
dWZmZXIgb3ZlcmZsb3dcbiIpOwogCQlyZXR1cm47CkBAIC0yOTAsMjYgKzE5MywyNyBAQCB2b2lk
IGludGVsX2RzYl9yZWdfd3JpdGUoc3RydWN0IGludGVsX2RzYiAqZHNiLCBpOTE1X3JlZ190IHJl
ZywgdTMyIHZhbCkKIAogLyoqCiAgKiBpbnRlbF9kc2JfY29tbWl0KCkgLSBUcmlnZ2VyIHdvcmts
b2FkIGV4ZWN1dGlvbiBvZiBEU0IuCi0gKiBAZHNiOiBpbnRlbF9kc2Igc3RydWN0dXJlLgorICog
QGNydGNfc3RhdGU6IGludGVsX2NydGNfc3RhdGUgc3RydWN0dXJlCiAgKgogICogVGhpcyBmdW5j
dGlvbiBpcyB1c2VkIHRvIGRvIGFjdHVhbCB3cml0ZSB0byBoYXJkd2FyZSB1c2luZyBEU0IuCiAg
KiBPbiBlcnJvcnMsIGZhbGwgYmFjayB0byBNTUlPLiBBbHNvIHRoaXMgZnVuY3Rpb24gaGVscCB0
byByZXNldCB0aGUgY29udGV4dC4KICAqLwotdm9pZCBpbnRlbF9kc2JfY29tbWl0KHN0cnVjdCBp
bnRlbF9kc2IgKmRzYikKK3ZvaWQgaW50ZWxfZHNiX2NvbW1pdChjb25zdCBzdHJ1Y3QgaW50ZWxf
Y3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKIHsKLQlzdHJ1Y3QgaW50ZWxfY3J0YyAqY3J0YyA9IGNv
bnRhaW5lcl9vZihkc2IsIHR5cGVvZigqY3J0YyksIGRzYik7CisJc3RydWN0IGludGVsX2RzYiAq
ZHNiID0gY3J0Y19zdGF0ZS0+ZHNiOworCXN0cnVjdCBpbnRlbF9jcnRjICpjcnRjID0gdG9faW50
ZWxfY3J0YyhjcnRjX3N0YXRlLT51YXBpLmNydGMpOwogCXN0cnVjdCBkcm1fZGV2aWNlICpkZXYg
PSBjcnRjLT5iYXNlLmRldjsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB0
b19pOTE1KGRldik7CiAJZW51bSBwaXBlIHBpcGUgPSBjcnRjLT5waXBlOwogCXUzMiB0YWlsOwog
Ci0JaWYgKCFkc2ItPmZyZWVfcG9zKQorCWlmICghKGRzYiAmJiBkc2ItPmZyZWVfcG9zKSkKIAkJ
cmV0dXJuOwogCi0JaWYgKCFpbnRlbF9kc2JfZW5hYmxlX2VuZ2luZShkc2IpKQorCWlmICghaW50
ZWxfZHNiX2VuYWJsZV9lbmdpbmUoZGV2X3ByaXYsIHBpcGUsIGRzYi0+aWQpKQogCQlnb3RvIHJl
c2V0OwogCi0JaWYgKGlzX2RzYl9idXN5KGRzYikpIHsKKwlpZiAoaXNfZHNiX2J1c3koZGV2X3By
aXYsIHBpcGUsIGRzYi0+aWQpKSB7CiAJCWRybV9lcnIoJmRldl9wcml2LT5kcm0sCiAJCQkiSEVB
RF9QVFIgd3JpdGUgZmFpbGVkIC0gZHNiIGVuZ2luZSBpcyBidXN5LlxuIik7CiAJCWdvdG8gcmVz
ZXQ7CkBAIC0zMjIsNyArMjI2LDcgQEAgdm9pZCBpbnRlbF9kc2JfY29tbWl0KHN0cnVjdCBpbnRl
bF9kc2IgKmRzYikKIAkJbWVtc2V0KCZkc2ItPmNtZF9idWZbZHNiLT5mcmVlX3Bvc10sIDAsCiAJ
CSAgICAgICAodGFpbCAtIGRzYi0+ZnJlZV9wb3MgKiA0KSk7CiAKLQlpZiAoaXNfZHNiX2J1c3ko
ZHNiKSkgeworCWlmIChpc19kc2JfYnVzeShkZXZfcHJpdiwgcGlwZSwgZHNiLT5pZCkpIHsKIAkJ
ZHJtX2VycigmZGV2X3ByaXYtPmRybSwKIAkJCSJUQUlMX1BUUiB3cml0ZSBmYWlsZWQgLSBkc2Ig
ZW5naW5lIGlzIGJ1c3kuXG4iKTsKIAkJZ290byByZXNldDsKQEAgLTMzMiw3ICsyMzYsNyBAQCB2
b2lkIGludGVsX2RzYl9jb21taXQoc3RydWN0IGludGVsX2RzYiAqZHNiKQogCQkgICAgaTkxNV9n
Z3R0X29mZnNldChkc2ItPnZtYSksIHRhaWwpOwogCWludGVsX2RlX3dyaXRlKGRldl9wcml2LCBE
U0JfVEFJTChwaXBlLCBkc2ItPmlkKSwKIAkJICAgICAgIGk5MTVfZ2d0dF9vZmZzZXQoZHNiLT52
bWEpICsgdGFpbCk7Ci0JaWYgKHdhaXRfZm9yKCFpc19kc2JfYnVzeShkc2IpLCAxKSkgeworCWlm
ICh3YWl0X2ZvcighaXNfZHNiX2J1c3koZGV2X3ByaXYsIHBpcGUsIGRzYi0+aWQpLCAxKSkgewog
CQlkcm1fZXJyKCZkZXZfcHJpdi0+ZHJtLAogCQkJIlRpbWVkIG91dCB3YWl0aW5nIGZvciBEU0Ig
d29ya2xvYWQgY29tcGxldGlvbi5cbiIpOwogCQlnb3RvIHJlc2V0OwpAQCAtMzQxLDUgKzI0NSw3
NSBAQCB2b2lkIGludGVsX2RzYl9jb21taXQoc3RydWN0IGludGVsX2RzYiAqZHNiKQogcmVzZXQ6
CiAJZHNiLT5mcmVlX3BvcyA9IDA7CiAJZHNiLT5pbnNfc3RhcnRfb2Zmc2V0ID0gMDsKLQlpbnRl
bF9kc2JfZGlzYWJsZV9lbmdpbmUoZHNiKTsKKwlpbnRlbF9kc2JfZGlzYWJsZV9lbmdpbmUoZGV2
X3ByaXYsIHBpcGUsIGRzYi0+aWQpOworfQorCisvKioKKyAqIGludGVsX2RzYl9wcmVwYXJlKCkg
LSBBbGxvY2F0ZSwgcGluIGFuZCBtYXAgdGhlIERTQiBjb21tYW5kIGJ1ZmZlci4KKyAqIEBjcnRj
X3N0YXRlOiBpbnRlbF9jcnRjX3N0YXRlIHN0cnVjdHVyZSB0byBwcmVwYXJlIGFzc29jaWF0ZWQg
ZHNiIGluc3RhbmNlLgorICoKKyAqIFRoaXMgZnVuY3Rpb24gcHJlcGFyZSB0aGUgY29tbWFuZCBi
dWZmZXIgd2hpY2ggaXMgdXNlZCB0byBzdG9yZSBkc2IKKyAqIGluc3RydWN0aW9ucyB3aXRoIGRh
dGEuCisgKi8KK3ZvaWQgaW50ZWxfZHNiX3ByZXBhcmUoc3RydWN0IGludGVsX2NydGNfc3RhdGUg
KmNydGNfc3RhdGUpCit7CisJc3RydWN0IGludGVsX2NydGMgKmNydGMgPSB0b19pbnRlbF9jcnRj
KGNydGNfc3RhdGUtPnVhcGkuY3J0Yyk7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUg
PSB0b19pOTE1KGNydGMtPmJhc2UuZGV2KTsKKwlzdHJ1Y3QgaW50ZWxfZHNiICpkc2I7CisJc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iajsKKwlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKKwl1
MzIgKmJ1ZjsKKwlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKKworCWlmICghSEFTX0RTQihpOTE1
KSkKKwkJcmV0dXJuOworCisJZHNiID0ga21hbGxvYyhzaXplb2YoKmRzYiksIEdGUF9LRVJORUwp
OworCisJd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsK
KworCW9iaiA9IGk5MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoaTkxNSwgRFNCX0JVRl9T
SVpFKTsKKwlpZiAoSVNfRVJSKG9iaikpIHsKKwkJZHJtX2VycigmaTkxNS0+ZHJtLCAiR2VtIG9i
amVjdCBjcmVhdGlvbiBmYWlsZWRcbiIpOworCQlnb3RvIG91dDsKKwl9CisKKwl2bWEgPSBpOTE1
X2dlbV9vYmplY3RfZ2d0dF9waW4ob2JqLCBOVUxMLCAwLCAwLCAwKTsKKwlpZiAoSVNfRVJSKHZt
YSkpIHsKKwkJZHJtX2VycigmaTkxNS0+ZHJtLCAiVm1hIGNyZWF0aW9uIGZhaWxlZFxuIik7CisJ
CWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKKwkJZ290byBvdXQ7CisJfQorCisJYnVmID0gaTkx
NV9nZW1fb2JqZWN0X3Bpbl9tYXAodm1hLT5vYmosIEk5MTVfTUFQX1dDKTsKKwlpZiAoSVNfRVJS
KGJ1ZikpIHsKKwkJZHJtX2VycigmaTkxNS0+ZHJtLCAiQ29tbWFuZCBidWZmZXIgY3JlYXRpb24g
ZmFpbGVkXG4iKTsKKwkJZ290byBvdXQ7CisJfQorCisJZHNiLT5pZCA9IERTQjE7CisJZHNiLT52
bWEgPSB2bWE7CisJZHNiLT5jbWRfYnVmID0gYnVmOworCWRzYi0+ZnJlZV9wb3MgPSAwOworCWRz
Yi0+aW5zX3N0YXJ0X29mZnNldCA9IDA7CisJY3J0Y19zdGF0ZS0+ZHNiID0gZHNiOworb3V0Ogor
CWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKK30KKwor
LyoqCisgKiBpbnRlbF9kc2JfY2xlYW51cCgpIC0gVG8gY2xlYW51cCBEU0IgY29udGV4dC4KKyAq
IEBjcnRjX3N0YXRlOiBpbnRlbF9jcnRjX3N0YXRlIHN0cnVjdHVyZSB0byBjbGVhbnVwIGFzc29j
aWF0ZWQgZHNiIGluc3RhbmNlLgorICoKKyAqIFRoaXMgZnVuY3Rpb24gY2xlYW51cCB0aGUgRFNC
IGNvbnRleHQgYnkgdW5waW5uaW5nIGFuZCByZWxlYXNpbmcKKyAqIHRoZSBWTUEgb2JqZWN0IGFz
c29jaWF0ZWQgd2l0aCBpdC4KKyAqLwordm9pZCBpbnRlbF9kc2JfY2xlYW51cChzdHJ1Y3QgaW50
ZWxfY3J0Y19zdGF0ZSAqY3J0Y19zdGF0ZSkKK3sKKwlpZiAoIWNydGNfc3RhdGUtPmRzYikKKwkJ
cmV0dXJuOworCisJaTkxNV92bWFfdW5waW5fYW5kX3JlbGVhc2UoJmNydGNfc3RhdGUtPmRzYi0+
dm1hLCBJOTE1X1ZNQV9SRUxFQVNFX01BUCk7CisJa2ZyZWUoY3J0Y19zdGF0ZS0+ZHNiKTsKKwlj
cnRjX3N0YXRlLT5kc2IgPSBOVUxMOwogfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kc2IuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50
ZWxfZHNiLmgKaW5kZXggMzk1ZWY5Y2U1NThlLi42NTRhMTFmMjRiODAgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZHNiLmgKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kc2IuaApAQCAtMTAsNyArMTAsNyBAQAogCiAjaW5jbHVk
ZSAiaTkxNV9yZWcuaCIKIAotc3RydWN0IGludGVsX2NydGM7CitzdHJ1Y3QgaW50ZWxfY3J0Y19z
dGF0ZTsKIHN0cnVjdCBpOTE1X3ZtYTsKIAogZW51bSBkc2JfaWQgewpAQCAtMjIsNyArMjIsNiBA
QCBlbnVtIGRzYl9pZCB7CiB9OwogCiBzdHJ1Y3QgaW50ZWxfZHNiIHsKLQlsb25nIHJlZmNvdW50
OwogCWVudW0gZHNiX2lkIGlkOwogCXUzMiAqY21kX2J1ZjsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZt
YTsKQEAgLTQxLDEyICs0MCwxMiBAQCBzdHJ1Y3QgaW50ZWxfZHNiIHsKIAl1MzIgaW5zX3N0YXJ0
X29mZnNldDsKIH07CiAKLXN0cnVjdCBpbnRlbF9kc2IgKgotaW50ZWxfZHNiX2dldChzdHJ1Y3Qg
aW50ZWxfY3J0YyAqY3J0Yyk7Ci12b2lkIGludGVsX2RzYl9wdXQoc3RydWN0IGludGVsX2RzYiAq
ZHNiKTsKLXZvaWQgaW50ZWxfZHNiX3JlZ193cml0ZShzdHJ1Y3QgaW50ZWxfZHNiICpkc2IsIGk5
MTVfcmVnX3QgcmVnLCB1MzIgdmFsKTsKLXZvaWQgaW50ZWxfZHNiX2luZGV4ZWRfcmVnX3dyaXRl
KHN0cnVjdCBpbnRlbF9kc2IgKmRzYiwgaTkxNV9yZWdfdCByZWcsCi0JCQkJIHUzMiB2YWwpOwot
dm9pZCBpbnRlbF9kc2JfY29tbWl0KHN0cnVjdCBpbnRlbF9kc2IgKmRzYik7Cit2b2lkIGludGVs
X2RzYl9wcmVwYXJlKHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0YXRlKTsKK3ZvaWQg
aW50ZWxfZHNiX2NsZWFudXAoc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOwor
dm9pZCBpbnRlbF9kc2JfcmVnX3dyaXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpj
cnRjX3N0YXRlLAorCQkJIGk5MTVfcmVnX3QgcmVnLCB1MzIgdmFsKTsKK3ZvaWQgaW50ZWxfZHNi
X2luZGV4ZWRfcmVnX3dyaXRlKGNvbnN0IHN0cnVjdCBpbnRlbF9jcnRjX3N0YXRlICpjcnRjX3N0
YXRlLAorCQkJCSBpOTE1X3JlZ190IHJlZywgdTMyIHZhbCk7Cit2b2lkIGludGVsX2RzYl9jb21t
aXQoY29uc3Qgc3RydWN0IGludGVsX2NydGNfc3RhdGUgKmNydGNfc3RhdGUpOwogCiAjZW5kaWYK
LS0gCjIuMjYuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
Cmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4
Cg==

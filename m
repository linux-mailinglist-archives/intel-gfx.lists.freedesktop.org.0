Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 4B37D5BAC6
	for <lists+intel-gfx@lfdr.de>; Mon,  1 Jul 2019 13:34:50 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9E10E89CA2;
	Mon,  1 Jul 2019 11:34:48 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga11.intel.com (mga11.intel.com [192.55.52.93])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 9C55489CA2
 for <intel-gfx@lists.freedesktop.org>; Mon,  1 Jul 2019 11:34:47 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from fmsmga004.fm.intel.com ([10.253.24.48])
 by fmsmga102.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 01 Jul 2019 04:34:47 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,439,1557212400"; d="scan'208";a="186455055"
Received: from unknown (HELO delly.ger.corp.intel.com) ([10.249.141.63])
 by fmsmga004.fm.intel.com with ESMTP; 01 Jul 2019 04:34:46 -0700
From: Lionel Landwerlin <lionel.g.landwerlin@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Mon,  1 Jul 2019 14:34:29 +0300
Message-Id: <20190701113437.4043-4-lionel.g.landwerlin@intel.com>
X-Mailer: git-send-email 2.21.0.392.gf8f6787159e
In-Reply-To: <20190701113437.4043-1-lionel.g.landwerlin@intel.com>
References: <20190701113437.4043-1-lionel.g.landwerlin@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v6 03/11] drm/i915/perf: allow for CS OA configs
 to be created lazily
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SGVyZSB3ZSBpbnRyb2R1Y2UgYSBtZWNoYW5pc20gYnkgd2hpY2ggdGhlIGV4ZWNidWYgcGFydCBv
ZiB0aGUgaTkxNQpkcml2ZXIgd2lsbCBiZSBhYmxlIHRvIHJlcXVlc3QgdGhhdCBhIGJhdGNoIGJ1
ZmZlciBjb250YWluaW5nIHRoZQpwcm9ncmFtbWluZyBmb3IgYSBwYXJ0aWN1bGFyIE9BIGNvbmZp
ZyBiZSBjcmVhdGVkLgoKV2UnbGwgZXhlY3V0ZSB0aGVzZSBPQSBjb25maWd1cmF0aW9uIGJ1ZmZl
cnMgcmlnaHQgYmVmb3JlIGV4ZWN1dGluZyBhCnNldCBvZiB1c2Vyc3BhY2UgY29tbWFuZHMgc28g
dGhhdCBhIHBhcnRpY3VsYXIgdXNlciBiYXRjaGJ1ZmZlciBiZQpleGVjdXRlZCB3aXRoIGEgZ2l2
ZW4gT0EgY29uZmlndXJhdGlvbi4KClRoaXMgbWVjaGFuaXNtIGVzc2VudGlhbGx5IGFsbG93cyB0
aGUgdXNlcnNwYWNlIGRyaXZlciB0byBnbyB0aHJvdWdoCnNldmVyYWwgT0EgY29uZmlndXJhdGlv
biB3aXRob3V0IGhhdmluZyB0byBvcGVuL2Nsb3NlIHRoZSBpOTE1L3BlcmYKc3RyZWFtLgoKdjI6
IE5vIG5lZWQgZm9yIGxvY2tpbmcgb24gb2JqZWN0IE9BIGNvbmZpZyBvYmplY3QgY3JlYXRpb24g
KENocmlzKQogICAgRmx1c2ggY3B1IG1hcHBpbmcgb2YgT0EgY29uZmlnIChDaHJpcykKCnYzOiBQ
cm9wZXJseSBkZWFsIHdpdGggdGhlIHBlcmZfbWV0cmljIGxvY2sgKENocmlzL0xpb25lbCkKClNp
Z25lZC1vZmYtYnk6IExpb25lbCBMYW5kd2VybGluIDxsaW9uZWwuZy5sYW5kd2VybGluQGludGVs
LmNvbT4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ncHVfY29tbWFuZHMuaCB8
ICAgMSArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oICAgICAgICAgICAgICB8ICAy
NCArKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcGVyZi5jICAgICAgICAgICAgIHwgMTg2
ICsrKysrKysrKysrKysrKy0tLS0KIDMgZmlsZXMgY2hhbmdlZCwgMTc1IGluc2VydGlvbnMoKyks
IDM2IGRlbGV0aW9ucygtKQoKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2dwdV9jb21tYW5kcy5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3B1X2Nv
bW1hbmRzLmgKaW5kZXggZWVjMzFlMzZhY2E3Li5lN2VmZjlkYjM0M2UgMTAwNjQ0Ci0tLSBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5oCisrKyBiL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2d0L2ludGVsX2dwdV9jb21tYW5kcy5oCkBAIC0xMjYsNiArMTI2LDcgQEAK
ICAqLwogI2RlZmluZSBNSV9MT0FEX1JFR0lTVEVSX0lNTSh4KQlNSV9JTlNUUigweDIyLCAyKih4
KS0xKQogI2RlZmluZSAgIE1JX0xSSV9GT1JDRV9QT1NURUQJCSgxPDwxMikKKyNkZWZpbmUgTUlf
TE9BRF9SRUdJU1RFUl9JTU1fTUFYX1JFR1MgKDEyNikKICNkZWZpbmUgTUlfU1RPUkVfUkVHSVNU
RVJfTUVNICAgICAgICBNSV9JTlNUUigweDI0LCAxKQogI2RlZmluZSBNSV9TVE9SRV9SRUdJU1RF
Ul9NRU1fR0VOOCAgIE1JX0lOU1RSKDB4MjQsIDIpCiAjZGVmaW5lICAgTUlfU1JNX0xSTV9HTE9C
QUxfR1RUCQkoMTw8MjIpCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Ry
di5oIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaAppbmRleCA3ZTk4MWIwM2ZhY2Uu
LmRmMzliMmVlNmJkOSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYu
aAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5oCkBAIC0xMDk2LDYgKzEwOTYs
OCBAQCBzdHJ1Y3QgaTkxNV9vYV9yZWcgewogfTsKIAogc3RydWN0IGk5MTVfb2FfY29uZmlnIHsK
KwlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNTsKKwogCWNoYXIgdXVpZFtVVUlEX1NUUklO
R19MRU4gKyAxXTsKIAlpbnQgaWQ7CiAKQEAgLTExMTAsNiArMTExMiwxMCBAQCBzdHJ1Y3QgaTkx
NV9vYV9jb25maWcgewogCXN0cnVjdCBhdHRyaWJ1dGUgKmF0dHJzWzJdOwogCXN0cnVjdCBkZXZp
Y2VfYXR0cmlidXRlIHN5c2ZzX21ldHJpY19pZDsKIAorCXN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmo7CisKKwlzdHJ1Y3QgbGlzdF9oZWFkIHZtYV9saW5rOworCiAJYXRvbWljX3QgcmVm
X2NvdW50OwogfTsKIApAQCAtMTY5NiwxMSArMTcwMiwyMSBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSB7CiAJCXN0cnVjdCBtdXRleCBtZXRyaWNzX2xvY2s7CiAKIAkJLyoKLQkJICogTGlzdCBv
ZiBkeW5hbWljIGNvbmZpZ3VyYXRpb25zLCB5b3UgbmVlZCB0byBob2xkCi0JCSAqIGRldl9wcml2
LT5wZXJmLm1ldHJpY3NfbG9jayB0byBhY2Nlc3MgaXQuCisJCSAqIExpc3Qgb2YgZHluYW1pYyBj
b25maWd1cmF0aW9ucyAoc3RydWN0IGk5MTVfb2FfY29uZmlnKSwgeW91CisJCSAqIG5lZWQgdG8g
aG9sZCBkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2xvY2sgdG8gYWNjZXNzIGl0LgogCQkgKi8KIAkJ
c3RydWN0IGlkciBtZXRyaWNzX2lkcjsKIAorCQkvKgorCQkgKiBMaXN0IG9mIGR5bmFtaWMgY29u
ZmlndXJhdGlvbnMgKHN0cnVjdCBpOTE1X29hX2NvbmZpZykKKwkJICogd2hpY2ggaGF2ZSBhbiBh
bGxvY2F0ZWQgYnVmZmVyIGluIEdHVFQgZm9yIHJlY29uZmlndXJhdGlvbiwKKwkJICogeW91IG5l
ZWQgdG8gaG9sZCBkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2xvY2sgdG8gYWNjZXNzIGl0LgorCQkg
KiBFbGVtZW50cyBhcmUgYWRkZWQgdG8gdGhlIGxpc3QgbGF6aWxseSBvbiBleGVjYnVmICh3aGVu
IGEKKwkJICogcGFydGljdWxhciBjb25maWd1cmF0aW9uIGlzIHJlcXVlc3RlZCkuIFRoZSBsaXN0
IGlzIGZyZWVkCisJCSAqIHVwb24gY2xvc2luZyB0aGUgcGVyZiBzdHJlYW0uCisJCSAqLworCQlz
dHJ1Y3QgbGlzdF9oZWFkIG1ldHJpY3NfYnVmZmVyczsKKwogCQkvKgogCQkgKiBMb2NrIGFzc29j
aWF0ZWQgd2l0aCBhbnl0aGluZyBiZWxvdyB3aXRoaW4gdGhpcyBzdHJ1Y3R1cmUKIAkJICogZXhj
ZXB0IGV4Y2x1c2l2ZV9zdHJlYW0uCkBAIC0yNTg3LDYgKzI2MDMsMTAgQEAgaW50IGk5MTVfcGVy
Zl9yZW1vdmVfY29uZmlnX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEs
CiB2b2lkIGk5MTVfb2FfaW5pdF9yZWdfc3RhdGUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lLAogCQkJICAgIHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKIAkJCSAgICB1MzIgKnJlZ19z
dGF0ZSk7CitpbnQgaTkxNV9wZXJmX2dldF9vYV9jb25maWcoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmk5MTUsCisJCQkgICAgaW50IG1ldHJpY3Nfc2V0LAorCQkJICAgIHN0cnVjdCBpOTE1X29h
X2NvbmZpZyAqKm91dF9jb25maWcsCisJCQkgICAgc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3Qg
KipvdXRfb2JqKTsKIAogLyogaTkxNV9nZW1fZXZpY3QuYyAqLwogaW50IF9fbXVzdF9jaGVjayBp
OTE1X2dlbV9ldmljdF9zb21ldGhpbmcoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0sCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcGVyZi5jCmluZGV4IDIwOTQzNTg4NjBkNS4uNWJhNzcxNDY4MDc4IDEw
MDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9pOTE1X3BlcmYuYwpAQCAtMzY2LDkgKzM2NiwyMCBAQCBzdHJ1Y3QgcGVy
Zl9vcGVuX3Byb3BlcnRpZXMgewogCWludCBvYV9wZXJpb2RfZXhwb25lbnQ7CiB9OwogCi1zdGF0
aWMgdm9pZCBmcmVlX29hX2NvbmZpZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYs
Ci0JCQkgICBzdHJ1Y3QgaTkxNV9vYV9jb25maWcgKm9hX2NvbmZpZykKK3N0YXRpYyB2b2lkIHB1
dF9vYV9jb25maWcoc3RydWN0IGk5MTVfb2FfY29uZmlnICpvYV9jb25maWcpCiB7CisJaWYgKCFh
dG9taWNfZGVjX2FuZF90ZXN0KCZvYV9jb25maWctPnJlZl9jb3VudCkpCisJCXJldHVybjsKKwor
CWlmIChvYV9jb25maWctPm9iaikgeworCQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9
IG9hX2NvbmZpZy0+aTkxNTsKKworCQltdXRleF9sb2NrKCZpOTE1LT5wZXJmLm1ldHJpY3NfbG9j
ayk7CisJCWxpc3RfZGVsKCZvYV9jb25maWctPnZtYV9saW5rKTsKKwkJaTkxNV9nZW1fb2JqZWN0
X3B1dChvYV9jb25maWctPm9iaik7CisJCW11dGV4X3VubG9jaygmaTkxNS0+cGVyZi5tZXRyaWNz
X2xvY2spOworCX0KKwogCWlmICghUFRSX0VSUihvYV9jb25maWctPmZsZXhfcmVncykpCiAJCWtm
cmVlKG9hX2NvbmZpZy0+ZmxleF9yZWdzKTsKIAlpZiAoIVBUUl9FUlIob2FfY29uZmlnLT5iX2Nv
dW50ZXJfcmVncykpCkBAIC0zNzgsMzggKzM4OSwxMjQgQEAgc3RhdGljIHZvaWQgZnJlZV9vYV9j
b25maWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2LAogCWtmcmVlKG9hX2NvbmZp
Zyk7CiB9CiAKLXN0YXRpYyB2b2lkIHB1dF9vYV9jb25maWcoc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2LAotCQkJICBzdHJ1Y3QgaTkxNV9vYV9jb25maWcgKm9hX2NvbmZpZykKK3N0
YXRpYyB1MzIgKndyaXRlX2NzX21pX2xyaSh1MzIgKmNzLCBjb25zdCBzdHJ1Y3QgaTkxNV9vYV9y
ZWcgKnJlZ19kYXRhLCB1MzIgbl9yZWdzKQogewotCWlmICghYXRvbWljX2RlY19hbmRfdGVzdCgm
b2FfY29uZmlnLT5yZWZfY291bnQpKQotCQlyZXR1cm47CisJdTMyIGk7CisKKwlmb3IgKGkgPSAw
OyBpIDwgbl9yZWdzOyBpKyspIHsKKwkJaWYgKChpICUgTUlfTE9BRF9SRUdJU1RFUl9JTU1fTUFY
X1JFR1MpID09IDApIHsKKwkJCXUzMiBuX2xyaSA9IG1pbihuX3JlZ3MgLSBpLAorCQkJCQkodTMy
KSBNSV9MT0FEX1JFR0lTVEVSX0lNTV9NQVhfUkVHUyk7CisKKwkJCSpjcysrID0gTUlfTE9BRF9S
RUdJU1RFUl9JTU0obl9scmkpOworCQl9CisJCSpjcysrID0gaTkxNV9tbWlvX3JlZ19vZmZzZXQo
cmVnX2RhdGFbaV0uYWRkcik7CisJCSpjcysrID0gcmVnX2RhdGFbaV0udmFsdWU7CisJfQogCi0J
ZnJlZV9vYV9jb25maWcoZGV2X3ByaXYsIG9hX2NvbmZpZyk7CisJcmV0dXJuIGNzOwogfQogCi1z
dGF0aWMgaW50IGdldF9vYV9jb25maWcoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2
LAotCQkJIGludCBtZXRyaWNzX3NldCwKLQkJCSBzdHJ1Y3QgaTkxNV9vYV9jb25maWcgKipvdXRf
Y29uZmlnKQorc3RhdGljIGludCBhbGxvY19vYV9jb25maWdfYnVmZmVyKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1LAorCQkJCSAgc3RydWN0IGk5MTVfb2FfY29uZmlnICpvYV9jb25maWcp
CiB7Ci0JaW50IHJldDsKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqYm87CisJc2l6ZV90
IGNvbmZpZ19sZW5ndGggPSAwOworCXUzMiAqY3M7CiAKLQlpZiAobWV0cmljc19zZXQgPT0gMSkg
ewotCQkqb3V0X2NvbmZpZyA9ICZkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZzsKLQkJYXRv
bWljX2luYygmZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcucmVmX2NvdW50KTsKLQkJcmV0
dXJuIDA7CisJaWYgKG9hX2NvbmZpZy0+bXV4X3JlZ3NfbGVuID4gMCkgeworCQljb25maWdfbGVu
Z3RoICs9IERJVl9ST1VORF9VUChvYV9jb25maWctPm11eF9yZWdzX2xlbiwKKwkJCQkJICAgICAg
TUlfTE9BRF9SRUdJU1RFUl9JTU1fTUFYX1JFR1MpICogNDsKKwkJY29uZmlnX2xlbmd0aCArPSBv
YV9jb25maWctPm11eF9yZWdzX2xlbiAqIDg7CisJfQorCWlmIChvYV9jb25maWctPmJfY291bnRl
cl9yZWdzX2xlbiA+IDApIHsKKwkJY29uZmlnX2xlbmd0aCArPSBESVZfUk9VTkRfVVAob2FfY29u
ZmlnLT5iX2NvdW50ZXJfcmVnc19sZW4sCisJCQkJCSAgICAgIE1JX0xPQURfUkVHSVNURVJfSU1N
X01BWF9SRUdTKSAqIDQ7CisJCWNvbmZpZ19sZW5ndGggKz0gb2FfY29uZmlnLT5iX2NvdW50ZXJf
cmVnc19sZW4gKiA4OworCX0KKwlpZiAob2FfY29uZmlnLT5mbGV4X3JlZ3NfbGVuID4gMCkgewor
CQljb25maWdfbGVuZ3RoICs9IERJVl9ST1VORF9VUChvYV9jb25maWctPmZsZXhfcmVnc19sZW4s
CisJCQkJCSAgICAgIE1JX0xPQURfUkVHSVNURVJfSU1NX01BWF9SRUdTKSAqIDQ7CisJCWNvbmZp
Z19sZW5ndGggKz0gb2FfY29uZmlnLT5mbGV4X3JlZ3NfbGVuICogODsKIAl9CisJY29uZmlnX2xl
bmd0aCArPSA0OyAvKiBNSV9CQVRDSF9CVUZGRVJfRU5EICovCisJY29uZmlnX2xlbmd0aCA9IEFM
SUdOKGNvbmZpZ19sZW5ndGgsIEk5MTVfR1RUX1BBR0VfU0laRSk7CiAKLQlyZXQgPSBtdXRleF9s
b2NrX2ludGVycnVwdGlibGUoJmRldl9wcml2LT5wZXJmLm1ldHJpY3NfbG9jayk7CisJYm8gPSBp
OTE1X2dlbV9vYmplY3RfY3JlYXRlX3NobWVtKGk5MTUsIGNvbmZpZ19sZW5ndGgpOworCWlmIChJ
U19FUlIoYm8pKQorCQlyZXR1cm4gUFRSX0VSUihibyk7CisKKwljcyA9IGk5MTVfZ2VtX29iamVj
dF9waW5fbWFwKGJvLCBJOTE1X01BUF9XQik7CisJaWYgKElTX0VSUihjcykpIHsKKwkJaTkxNV9n
ZW1fb2JqZWN0X3B1dChibyk7CisJCXJldHVybiBQVFJfRVJSKGNzKTsKKwl9CisKKwljcyA9IHdy
aXRlX2NzX21pX2xyaShjcywgb2FfY29uZmlnLT5tdXhfcmVncywgb2FfY29uZmlnLT5tdXhfcmVn
c19sZW4pOworCWNzID0gd3JpdGVfY3NfbWlfbHJpKGNzLCBvYV9jb25maWctPmJfY291bnRlcl9y
ZWdzLCBvYV9jb25maWctPmJfY291bnRlcl9yZWdzX2xlbik7CisJY3MgPSB3cml0ZV9jc19taV9s
cmkoY3MsIG9hX2NvbmZpZy0+ZmxleF9yZWdzLCBvYV9jb25maWctPmZsZXhfcmVnc19sZW4pOwor
CisJKmNzKysgPSBNSV9CQVRDSF9CVUZGRVJfRU5EOworCisJaTkxNV9nZW1fb2JqZWN0X2ZsdXNo
X21hcChibyk7CisJaTkxNV9nZW1fb2JqZWN0X3VucGluX21hcChibyk7CisKKwlvYV9jb25maWct
Pm9iaiA9IGJvOworCisJcmV0dXJuIDA7Cit9CisKK2ludCBpOTE1X3BlcmZfZ2V0X29hX2NvbmZp
ZyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwKKwkJCSAgICBpbnQgbWV0cmljc19zZXQs
CisJCQkgICAgc3RydWN0IGk5MTVfb2FfY29uZmlnICoqb3V0X2NvbmZpZywKKwkJCSAgICBzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqKm91dF9vYmopCit7CisJaW50IHJldCA9IDA7CisJc3Ry
dWN0IGk5MTVfb2FfY29uZmlnICpvYV9jb25maWc7CisKKwlpZiAoIWk5MTUtPnBlcmYuaW5pdGlh
bGl6ZWQpCisJCXJldHVybiAtRU5PREVWOworCisJcmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRp
YmxlKCZpOTE1LT5wZXJmLm1ldHJpY3NfbG9jayk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsK
IAotCSpvdXRfY29uZmlnID0gaWRyX2ZpbmQoJmRldl9wcml2LT5wZXJmLm1ldHJpY3NfaWRyLCBt
ZXRyaWNzX3NldCk7Ci0JaWYgKCEqb3V0X2NvbmZpZykKLQkJcmV0ID0gLUVJTlZBTDsKLQllbHNl
Ci0JCWF0b21pY19pbmMoJigqb3V0X2NvbmZpZyktPnJlZl9jb3VudCk7CisJaWYgKG1ldHJpY3Nf
c2V0ID09IDEpIHsKKwkJb2FfY29uZmlnID0gJmk5MTUtPnBlcmYub2EudGVzdF9jb25maWc7CisJ
fSBlbHNlIHsKKwkJb2FfY29uZmlnID0gaWRyX2ZpbmQoJmk5MTUtPnBlcmYubWV0cmljc19pZHIs
IG1ldHJpY3Nfc2V0KTsKKwkJaWYgKCFvYV9jb25maWcpIHsKKwkJCXJldCA9IC1FSU5WQUw7CisJ
CQlnb3RvIGVycl91bmxvY2s7CisJCX0KKwl9CisKKwlpZiAob3V0X2NvbmZpZykgeworCQlhdG9t
aWNfaW5jKCZvYV9jb25maWctPnJlZl9jb3VudCk7CisJCSpvdXRfY29uZmlnID0gb2FfY29uZmln
OworCX0KIAotCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBlcmYubWV0cmljc19sb2NrKTsKKwlp
ZiAob3V0X29iaikgeworCQlpZiAob2FfY29uZmlnLT5vYmopIHsKKwkJCSpvdXRfb2JqID0gaTkx
NV9nZW1fb2JqZWN0X2dldChvYV9jb25maWctPm9iaik7CisJCX0gZWxzZSB7CisJCQlyZXQgPSBh
bGxvY19vYV9jb25maWdfYnVmZmVyKGk5MTUsIG9hX2NvbmZpZyk7CisJCQlpZiAocmV0KQorCQkJ
CWdvdG8gZXJyX3VubG9jazsKKworCQkJbGlzdF9hZGQoJm9hX2NvbmZpZy0+dm1hX2xpbmssCisJ
CQkJICZpOTE1LT5wZXJmLm1ldHJpY3NfYnVmZmVycyk7CisJCQkqb3V0X29iaiA9IGk5MTVfZ2Vt
X29iamVjdF9nZXQob2FfY29uZmlnLT5vYmopOworCQl9CisJfQorCitlcnJfdW5sb2NrOgorCW11
dGV4X3VubG9jaygmaTkxNS0+cGVyZi5tZXRyaWNzX2xvY2spOworCisJaWYgKHJldCAmJiBvdXRf
Y29uZmlnKSB7CisJCXB1dF9vYV9jb25maWcob2FfY29uZmlnKTsKKwkJKm91dF9jb25maWcgPSBO
VUxMOworCX0KIAogCXJldHVybiByZXQ7CiB9CkBAIC0xMzgwLDcgKzE0NzcsNyBAQCBzdGF0aWMg
dm9pZCBpOTE1X29hX3N0cmVhbV9kZXN0cm95KHN0cnVjdCBpOTE1X3BlcmZfc3RyZWFtICpzdHJl
YW0pCiAJaWYgKHN0cmVhbS0+Y3R4KQogCQlvYV9wdXRfcmVuZGVyX2N0eF9pZChzdHJlYW0pOwog
Ci0JcHV0X29hX2NvbmZpZyhkZXZfcHJpdiwgc3RyZWFtLT5vYV9jb25maWcpOworCXB1dF9vYV9j
b25maWcoc3RyZWFtLT5vYV9jb25maWcpOwogCiAJaWYgKGRldl9wcml2LT5wZXJmLm9hLnNwdXJp
b3VzX3JlcG9ydF9ycy5taXNzZWQpIHsKIAkJRFJNX05PVEUoIiVkIHNwdXJpb3VzIE9BIHJlcG9y
dCBub3RpY2VzIHN1cHByZXNzZWQgZHVlIHRvIHJhdGVsaW1pdGluZ1xuIiwKQEAgLTIxMTcsNyAr
MjIxNCw4IEBAIHN0YXRpYyBpbnQgaTkxNV9vYV9zdHJlYW1faW5pdChzdHJ1Y3QgaTkxNV9wZXJm
X3N0cmVhbSAqc3RyZWFtLAogCQl9CiAJfQogCi0JcmV0ID0gZ2V0X29hX2NvbmZpZyhkZXZfcHJp
diwgcHJvcHMtPm1ldHJpY3Nfc2V0LCAmc3RyZWFtLT5vYV9jb25maWcpOworCXJldCA9IGk5MTVf
cGVyZl9nZXRfb2FfY29uZmlnKGRldl9wcml2LCBwcm9wcy0+bWV0cmljc19zZXQsCisJCQkJICAg
ICAgJnN0cmVhbS0+b2FfY29uZmlnLCBOVUxMKTsKIAlpZiAocmV0KSB7CiAJCURSTV9ERUJVRygi
SW52YWxpZCBPQSBjb25maWcgaWQ9JWlcbiIsIHByb3BzLT5tZXRyaWNzX3NldCk7CiAJCWdvdG8g
ZXJyX2NvbmZpZzsKQEAgLTIxNTUsNiArMjI1Myw4IEBAIHN0YXRpYyBpbnQgaTkxNV9vYV9zdHJl
YW1faW5pdChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3RyZWFtLAogCQlnb3RvIGVycl9lbmFi
bGU7CiAJfQogCisJRFJNX0RFQlVHKCJvcGVuaW5nIHN0cmVhbSBvYSBjb25maWcgdXVpZD0lc1xu
Iiwgc3RyZWFtLT5vYV9jb25maWctPnV1aWQpOworCiAJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlyZXR1cm4gMDsKQEAgLTIxNjgsNyArMjI2OCw3IEBAIHN0
YXRpYyBpbnQgaTkxNV9vYV9zdHJlYW1faW5pdChzdHJ1Y3QgaTkxNV9wZXJmX3N0cmVhbSAqc3Ry
ZWFtLAogCWZyZWVfb2FfYnVmZmVyKGRldl9wcml2KTsKIAogZXJyX29hX2J1Zl9hbGxvYzoKLQlw
dXRfb2FfY29uZmlnKGRldl9wcml2LCBzdHJlYW0tPm9hX2NvbmZpZyk7CisJcHV0X29hX2NvbmZp
ZyhzdHJlYW0tPm9hX2NvbmZpZyk7CiAKIAlpbnRlbF91bmNvcmVfZm9yY2V3YWtlX3B1dCgmZGV2
X3ByaXYtPnVuY29yZSwgRk9SQ0VXQUtFX0FMTCk7CiAJaW50ZWxfcnVudGltZV9wbV9wdXQoJmRl
dl9wcml2LT5ydW50aW1lX3BtLCBzdHJlYW0tPndha2VyZWYpOwpAQCAtMjUzNSw5ICsyNjM1LDIx
IEBAIHN0YXRpYyBpbnQgaTkxNV9wZXJmX3JlbGVhc2Uoc3RydWN0IGlub2RlICppbm9kZSwgc3Ry
dWN0IGZpbGUgKmZpbGUpCiB7CiAJc3RydWN0IGk5MTVfcGVyZl9zdHJlYW0gKnN0cmVhbSA9IGZp
bGUtPnByaXZhdGVfZGF0YTsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSBz
dHJlYW0tPmRldl9wcml2OworCXN0cnVjdCBpOTE1X29hX2NvbmZpZyAqb2FfY29uZmlnLCAqbmV4
dDsKIAogCW11dGV4X2xvY2soJmRldl9wcml2LT5wZXJmLmxvY2spOworCiAJaTkxNV9wZXJmX2Rl
c3Ryb3lfbG9ja2VkKHN0cmVhbSk7CisKKwkvKiBEaXNwb3NlIG9mIGFsbCBvYSBjb25maWcgYmF0
Y2ggYnVmZmVycy4gKi8KKwltdXRleF9sb2NrKCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2xvY2sp
OworCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZShvYV9jb25maWcsIG5leHQsICZkZXZfcHJpdi0+
cGVyZi5tZXRyaWNzX2J1ZmZlcnMsIHZtYV9saW5rKSB7CisJCWxpc3RfZGVsKCZvYV9jb25maWct
PnZtYV9saW5rKTsKKwkJaTkxNV9nZW1fb2JqZWN0X3B1dChvYV9jb25maWctPm9iaik7CisJCW9h
X2NvbmZpZy0+b2JqID0gTlVMTDsKKwl9CisJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cGVyZi5t
ZXRyaWNzX2xvY2spOworCiAJbXV0ZXhfdW5sb2NrKCZkZXZfcHJpdi0+cGVyZi5sb2NrKTsKIAog
CXJldHVybiAwOwpAQCAtMjk2NSw2ICszMDc3LDcgQEAgdm9pZCBpOTE1X3BlcmZfcmVnaXN0ZXIo
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCWlmIChyZXQpCiAJCWdvdG8gc3lz
ZnNfZXJyb3I7CiAKKwlkZXZfcHJpdi0+cGVyZi5vYS50ZXN0X2NvbmZpZy5pOTE1ID0gZGV2X3By
aXY7CiAJYXRvbWljX3NldCgmZGV2X3ByaXYtPnBlcmYub2EudGVzdF9jb25maWcucmVmX2NvdW50
LCAxKTsKIAogCWdvdG8gZXhpdDsKQEAgLTMyMjEsNiArMzMzNCw3IEBAIGludCBpOTE1X3BlcmZf
YWRkX2NvbmZpZ19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCQly
ZXR1cm4gLUVOT01FTTsKIAl9CiAKKwlvYV9jb25maWctPmk5MTUgPSBkZXZfcHJpdjsKIAlhdG9t
aWNfc2V0KCZvYV9jb25maWctPnJlZl9jb3VudCwgMSk7CiAKIAlpZiAoIXV1aWRfaXNfdmFsaWQo
YXJncy0+dXVpZCkpIHsKQEAgLTMzMjAsNyArMzQzNCw3IEBAIGludCBpOTE1X3BlcmZfYWRkX2Nv
bmZpZ19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogc3lzZnNfZXJy
OgogCW11dGV4X3VubG9jaygmZGV2X3ByaXYtPnBlcmYubWV0cmljc19sb2NrKTsKIHJlZ19lcnI6
Ci0JcHV0X29hX2NvbmZpZyhkZXZfcHJpdiwgb2FfY29uZmlnKTsKKwlwdXRfb2FfY29uZmlnKG9h
X2NvbmZpZyk7CiAJRFJNX0RFQlVHKCJGYWlsZWQgdG8gYWRkIG5ldyBPQSBjb25maWdcbiIpOwog
CXJldHVybiBlcnI7CiB9CkBAIC0zMzU2LDEzICszNDcwLDEzIEBAIGludCBpOTE1X3BlcmZfcmVt
b3ZlX2NvbmZpZ19pb2N0bChzdHJ1Y3QgZHJtX2RldmljZSAqZGV2LCB2b2lkICpkYXRhLAogCiAJ
cmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZkZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2xv
Y2spOwogCWlmIChyZXQpCi0JCWdvdG8gbG9ja19lcnI7CisJCXJldHVybiByZXQ7CiAKIAlvYV9j
b25maWcgPSBpZHJfZmluZCgmZGV2X3ByaXYtPnBlcmYubWV0cmljc19pZHIsICphcmcpOwogCWlm
ICghb2FfY29uZmlnKSB7CiAJCURSTV9ERUJVRygiRmFpbGVkIHRvIHJlbW92ZSB1bmtub3duIE9B
IGNvbmZpZ1xuIik7CiAJCXJldCA9IC1FTk9FTlQ7Ci0JCWdvdG8gY29uZmlnX2VycjsKKwkJZ290
byBlcnJfdW5sb2NrOwogCX0KIAogCUdFTV9CVUdfT04oKmFyZyAhPSBvYV9jb25maWctPmlkKTsK
QEAgLTMzNzIsMTMgKzM0ODYsMTYgQEAgaW50IGk5MTVfcGVyZl9yZW1vdmVfY29uZmlnX2lvY3Rs
KHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRhdGEsCiAKIAlpZHJfcmVtb3ZlKCZkZXZf
cHJpdi0+cGVyZi5tZXRyaWNzX2lkciwgKmFyZyk7CiAKKwltdXRleF91bmxvY2soJmRldl9wcml2
LT5wZXJmLm1ldHJpY3NfbG9jayk7CisKIAlEUk1fREVCVUcoIlJlbW92ZWQgY29uZmlnICVzIGlk
PSVpXG4iLCBvYV9jb25maWctPnV1aWQsIG9hX2NvbmZpZy0+aWQpOwogCi0JcHV0X29hX2NvbmZp
ZyhkZXZfcHJpdiwgb2FfY29uZmlnKTsKKwlwdXRfb2FfY29uZmlnKG9hX2NvbmZpZyk7CisKKwly
ZXR1cm4gMDsKIAotY29uZmlnX2VycjoKK2Vycl91bmxvY2s6CiAJbXV0ZXhfdW5sb2NrKCZkZXZf
cHJpdi0+cGVyZi5tZXRyaWNzX2xvY2spOwotbG9ja19lcnI6CiAJcmV0dXJuIHJldDsKIH0KIApA
QCAtMzUyMCw2ICszNjM3LDggQEAgdm9pZCBpOTE1X3BlcmZfaW5pdChzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYpCiAJCWluaXRfd2FpdHF1ZXVlX2hlYWQoJmRldl9wcml2LT5wZXJm
Lm9hLnBvbGxfd3EpOwogCiAJCUlOSVRfTElTVF9IRUFEKCZkZXZfcHJpdi0+cGVyZi5zdHJlYW1z
KTsKKwkJSU5JVF9MSVNUX0hFQUQoJmRldl9wcml2LT5wZXJmLm1ldHJpY3NfYnVmZmVycyk7CisK
IAkJbXV0ZXhfaW5pdCgmZGV2X3ByaXYtPnBlcmYubG9jayk7CiAJCXNwaW5fbG9ja19pbml0KCZk
ZXZfcHJpdi0+cGVyZi5vYS5vYV9idWZmZXIucHRyX2xvY2spOwogCkBAIC0zNTM2LDEwICszNjU1
LDkgQEAgdm9pZCBpOTE1X3BlcmZfaW5pdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3By
aXYpCiAKIHN0YXRpYyBpbnQgZGVzdHJveV9jb25maWcoaW50IGlkLCB2b2lkICpwLCB2b2lkICpk
YXRhKQogewotCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiA9IGRhdGE7CiAJc3Ry
dWN0IGk5MTVfb2FfY29uZmlnICpvYV9jb25maWcgPSBwOwogCi0JcHV0X29hX2NvbmZpZyhkZXZf
cHJpdiwgb2FfY29uZmlnKTsKKwlwdXRfb2FfY29uZmlnKG9hX2NvbmZpZyk7CiAKIAlyZXR1cm4g
MDsKIH0KQEAgLTM1NTMsNyArMzY3MSw3IEBAIHZvaWQgaTkxNV9wZXJmX2Zpbmkoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KQogCWlmICghZGV2X3ByaXYtPnBlcmYuaW5pdGlhbGl6
ZWQpCiAJCXJldHVybjsKIAotCWlkcl9mb3JfZWFjaCgmZGV2X3ByaXYtPnBlcmYubWV0cmljc19p
ZHIsIGRlc3Ryb3lfY29uZmlnLCBkZXZfcHJpdik7CisJaWRyX2Zvcl9lYWNoKCZkZXZfcHJpdi0+
cGVyZi5tZXRyaWNzX2lkciwgZGVzdHJveV9jb25maWcsIE5VTEwpOwogCWlkcl9kZXN0cm95KCZk
ZXZfcHJpdi0+cGVyZi5tZXRyaWNzX2lkcik7CiAKIAl1bnJlZ2lzdGVyX3N5c2N0bF90YWJsZShk
ZXZfcHJpdi0+cGVyZi5zeXNjdGxfaGVhZGVyKTsKLS0gCjIuMjEuMC4zOTIuZ2Y4ZjY3ODcxNTll
CgpfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1n
ZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9s
aXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZng=

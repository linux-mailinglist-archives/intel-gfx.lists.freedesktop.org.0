Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 1BFA9BDBB0
	for <lists+intel-gfx@lfdr.de>; Wed, 25 Sep 2019 12:02:24 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 927AD6EB77;
	Wed, 25 Sep 2019 10:02:19 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id C66CF6EB6E
 for <intel-gfx@lists.freedesktop.org>; Wed, 25 Sep 2019 10:02:06 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18609370-1500050 
 for multiple; Wed, 25 Sep 2019 11:01:45 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 25 Sep 2019 11:01:19 +0100
Message-Id: <20190925100137.17956-10-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190925100137.17956-1-chris@chris-wilson.co.uk>
References: <20190925100137.17956-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 09/27] drm/i915: Drop struct_mutex from around
 i915_retire_requests()
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2UgZG9uJ3QgbmVlZCB0byBob2xkIHN0cnVjdF9tdXRleCBub3cgZm9yIHJldGlyaW5nIHJlcXVl
c3RzLCBzbyBkcm9wIGl0CmZyb20gaTkxNV9yZXRpcmVfcmVxdWVzdHMoKSBhbmQgaTkxNV9nZW1f
d2FpdF9mb3JfaWRsZSgpLCBmaW5hbGx5CnJlbW92aW5nIEk5MTVfV0FJVF9MT0NLRUQgZm9yIGdv
b2QuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51
az4KUmV2aWV3ZWQtYnk6IFR2cnRrbyBVcnN1bGluIDx0dnJ0a28udXJzdWxpbkBpbnRlbC5jb20+
Ci0tLQogLi4uL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY2xpZW50X2JsdC5jICAgIHwgICA3
ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fY29udGV4dC5jICAgfCAgMjAg
Ky0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYyAgICAgICAgfCAgNDUg
KysrLS0tCiAuLi4vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvaGVyZW5jeS5jICAgfCAg
NDAgKysrLS0tCiAuLi4vZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMg
fCAgIDQgKy0KIC4uLi9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYyAgICB8
ICAgNiArLQogLi4uL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9vYmplY3RfYmx0LmMgIHwg
ICA0IC0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYyAgICB8ICAg
NCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMgIHwgIDg5
ICsrLS0tLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMgICAg
ICAgIHwgIDIzICsrLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfdGltZWxpbmUu
YyAgIHwgIDkxICsrKysrLS0tLS0tLQogLi4uL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3Jr
YXJvdW5kcy5jICAgIHwgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMu
YyAgICAgICAgICAgfCAgNDIgKystLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbS5j
ICAgICAgICAgICAgICAgfCAgMTkgKystCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVl
c3QuaCAgICAgICAgICAgfCAgIDcgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
OTE1X2FjdGl2ZS5jICB8ICAgOCArLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9n
ZW1fZXZpY3QuYyAgIHwgICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkx
NV9nZW1fZ3R0LmMgfCAgIDYgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1
X3JlcXVlc3QuYyB8IDEzNCArKysrKystLS0tLS0tLS0tLS0KIC4uLi9ncHUvZHJtL2k5MTUvc2Vs
ZnRlc3RzL2k5MTVfc2VsZnRlc3QuYyAgICB8ICAgOCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2k5MTVfdm1hLmMgICAgIHwgICA0IC0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2lndF9mbHVzaF90ZXN0LmMgICB8ICAzMCArKy0tCiAuLi4vZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9pZ3RfZmx1c2hfdGVzdC5oICAgfCAgIDIgKy0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRl
c3RzL2lndF9saXZlX3Rlc3QuYyAgICB8ICAgOSArLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxmdGVz
dHMvbW9ja19nZW1fZGV2aWNlLmMgIHwgICA0IC0KIDI1IGZpbGVzIGNoYW5nZWQsIDIwMSBpbnNl
cnRpb25zKCspLCA0MTMgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ2VtL2k5MTVfZ2VtX2NsaWVudF9ibHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9pOTE1X2dlbV9jbGllbnRfYmx0LmMKaW5kZXggYzFmY2E1NzI4ZTZlLi44MTM2NmFhNDgxMmIg
MTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jbGllbnRfYmx0
LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NsaWVudF9ibHQuYwpA
QCAtMTU1LDcgKzE1NSw2IEBAIHN0YXRpYyB2b2lkIGNsZWFyX3BhZ2VzX2RtYV9mZW5jZV9jYihz
dHJ1Y3QgZG1hX2ZlbmNlICpmZW5jZSwKIHN0YXRpYyB2b2lkIGNsZWFyX3BhZ2VzX3dvcmtlcihz
dHJ1Y3Qgd29ya19zdHJ1Y3QgKndvcmspCiB7CiAJc3RydWN0IGNsZWFyX3BhZ2VzX3dvcmsgKncg
PSBjb250YWluZXJfb2Yod29yaywgdHlwZW9mKCp3KSwgd29yayk7Ci0Jc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUgPSB3LT5jZS0+ZW5naW5lLT5pOTE1OwogCXN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmogPSB3LT5zbGVldmUtPnZtYS0+b2JqOwogCXN0cnVjdCBpOTE1X3ZtYSAq
dm1hID0gdy0+c2xlZXZlLT52bWE7CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CkBAIC0xNzMs
MTEgKzE3Miw5IEBAIHN0YXRpYyB2b2lkIGNsZWFyX3BhZ2VzX3dvcmtlcihzdHJ1Y3Qgd29ya19z
dHJ1Y3QgKndvcmspCiAJb2JqLT5yZWFkX2RvbWFpbnMgPSBJOTE1X0dFTV9HUFVfRE9NQUlOUzsK
IAlvYmotPndyaXRlX2RvbWFpbiA9IDA7CiAKLQkvKiBYWFg6IHdlIG5lZWQgdG8ga2lsbCB0aGlz
ICovCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJZXJyID0gaTkxNV92
bWFfcGluKHZtYSwgMCwgMCwgUElOX1VTRVIpOwogCWlmICh1bmxpa2VseShlcnIpKQotCQlnb3Rv
IG91dF91bmxvY2s7CisJCWdvdG8gb3V0X3NpZ25hbDsKIAogCWJhdGNoID0gaW50ZWxfZW1pdF92
bWFfZmlsbF9ibHQody0+Y2UsIHZtYSwgdy0+dmFsdWUpOwogCWlmIChJU19FUlIoYmF0Y2gpKSB7
CkBAIC0yMjksOCArMjI2LDYgQEAgc3RhdGljIHZvaWQgY2xlYXJfcGFnZXNfd29ya2VyKHN0cnVj
dCB3b3JrX3N0cnVjdCAqd29yaykKIAlpbnRlbF9lbWl0X3ZtYV9yZWxlYXNlKHctPmNlLCBiYXRj
aCk7CiBvdXRfdW5waW46CiAJaTkxNV92bWFfdW5waW4odm1hKTsKLW91dF91bmxvY2s6Ci0JbXV0
ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIG91dF9zaWduYWw6CiAJaWYgKHVu
bGlrZWx5KGVycikpIHsKIAkJZG1hX2ZlbmNlX3NldF9lcnJvcigmdy0+ZG1hLCBlcnIpOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2NvbnRleHQuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXggOWQ4NWFhYjY4
ZDM0Li4wYWI0MTY4ODdmYzIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9jb250ZXh0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2Vt
X2NvbnRleHQuYwpAQCAtMTE1OSw4ICsxMTU5LDcgQEAgZ2VuOF9tb2RpZnlfcnBjcyhzdHJ1Y3Qg
aW50ZWxfY29udGV4dCAqY2UsIHN0cnVjdCBpbnRlbF9zc2V1IHNzZXUpCiB9CiAKIHN0YXRpYyBp
bnQKLV9faW50ZWxfY29udGV4dF9yZWNvbmZpZ3VyZV9zc2V1KHN0cnVjdCBpbnRlbF9jb250ZXh0
ICpjZSwKLQkJCQkgc3RydWN0IGludGVsX3NzZXUgc3NldSkKK2ludGVsX2NvbnRleHRfcmVjb25m
aWd1cmVfc3NldShzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UsIHN0cnVjdCBpbnRlbF9zc2V1IHNz
ZXUpCiB7CiAJaW50IHJldDsKIApAQCAtMTE4MywyMyArMTE4Miw2IEBAIF9faW50ZWxfY29udGV4
dF9yZWNvbmZpZ3VyZV9zc2V1KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKIAlyZXR1cm4gcmV0
OwogfQogCi1zdGF0aWMgaW50Ci1pbnRlbF9jb250ZXh0X3JlY29uZmlndXJlX3NzZXUoc3RydWN0
IGludGVsX2NvbnRleHQgKmNlLCBzdHJ1Y3QgaW50ZWxfc3NldSBzc2V1KQotewotCXN0cnVjdCBk
cm1faTkxNV9wcml2YXRlICppOTE1ID0gY2UtPmVuZ2luZS0+aTkxNTsKLQlpbnQgcmV0OwotCi0J
cmV0ID0gbXV0ZXhfbG9ja19pbnRlcnJ1cHRpYmxlKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsK
LQlpZiAocmV0KQotCQlyZXR1cm4gcmV0OwotCi0JcmV0ID0gX19pbnRlbF9jb250ZXh0X3JlY29u
ZmlndXJlX3NzZXUoY2UsIHNzZXUpOwotCi0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLQotCXJldHVybiByZXQ7Ci19Ci0KIHN0YXRpYyBpbnQKIHVzZXJfdG9fY29udGV4
dF9zc2V1KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQkgICAgIGNvbnN0IHN0cnVj
dCBkcm1faTkxNV9nZW1fY29udGV4dF9wYXJhbV9zc2V1ICp1c2VyLApkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vaTkxNV9nZW1fcG0uYwppbmRleCA0MmE2MDIxZDJkZjguLjUzNWYyZjhhMjNhYSAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKKysrIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKQEAgLTQ4LDExICs0OCw3IEBAIHN0
YXRpYyB2b2lkIHJldGlyZV93b3JrX2hhbmRsZXIoc3RydWN0IHdvcmtfc3RydWN0ICp3b3JrKQog
CXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0KIAkJY29udGFpbmVyX29mKHdvcmssIHR5
cGVvZigqaTkxNSksIGdlbS5yZXRpcmVfd29yay53b3JrKTsKIAotCS8qIENvbWUgYmFjayBsYXRl
ciBpZiB0aGUgZGV2aWNlIGlzIGJ1c3kuLi4gKi8KLQlpZiAobXV0ZXhfdHJ5bG9jaygmaTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCkpIHsKLQkJaTkxNV9yZXRpcmVfcmVxdWVzdHMoaTkxNSk7Ci0JCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0JfQorCWk5MTVfcmV0aXJlX3Jl
cXVlc3RzKGk5MTUpOwogCiAJcXVldWVfZGVsYXllZF93b3JrKGk5MTUtPndxLAogCQkJICAgJmk5
MTUtPmdlbS5yZXRpcmVfd29yaywKQEAgLTg2LDI2ICs4MiwyMyBAQCBzdGF0aWMgYm9vbCBzd2l0
Y2hfdG9fa2VybmVsX2NvbnRleHRfc3luYyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQogewogCWJvb2wg
cmVzdWx0ID0gIWludGVsX2d0X2lzX3dlZGdlZChndCk7CiAKLQlkbyB7Ci0JCWlmIChpOTE1X2dl
bV93YWl0X2Zvcl9pZGxlKGd0LT5pOTE1LAotCQkJCQkgICBJOTE1X1dBSVRfTE9DS0VEIHwKLQkJ
CQkJICAgSTkxNV9XQUlUX0ZPUl9JRExFX0JPT1NULAotCQkJCQkgICBJOTE1X0dFTV9JRExFX1RJ
TUVPVVQpID09IC1FVElNRSkgewotCQkJLyogWFhYIGhpZGUgd2FybmluZyBmcm9tIGdlbV9laW8g
Ki8KLQkJCWlmIChpOTE1X21vZHBhcmFtcy5yZXNldCkgewotCQkJCWRldl9lcnIoZ3QtPmk5MTUt
PmRybS5kZXYsCi0JCQkJCSJGYWlsZWQgdG8gaWRsZSBlbmdpbmVzLCBkZWNsYXJpbmcgd2VkZ2Vk
IVxuIik7Ci0JCQkJR0VNX1RSQUNFX0RVTVAoKTsKLQkJCX0KLQotCQkJLyoKLQkJCSAqIEZvcmNp
Ymx5IGNhbmNlbCBvdXRzdGFuZGluZyB3b3JrIGFuZCBsZWF2ZQotCQkJICogdGhlIGdwdSBxdWll
dC4KLQkJCSAqLwotCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7Ci0JCQlyZXN1bHQgPSBmYWxz
ZTsKKwlpZiAoaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShndC0+aTkxNSwKKwkJCQkgICBJOTE1X1dB
SVRfRk9SX0lETEVfQk9PU1QsCisJCQkJICAgSTkxNV9HRU1fSURMRV9USU1FT1VUKSA9PSAtRVRJ
TUUpIHsKKwkJLyogWFhYIGhpZGUgd2FybmluZyBmcm9tIGdlbV9laW8gKi8KKwkJaWYgKGk5MTVf
bW9kcGFyYW1zLnJlc2V0KSB7CisJCQlkZXZfZXJyKGd0LT5pOTE1LT5kcm0uZGV2LAorCQkJCSJG
YWlsZWQgdG8gaWRsZSBlbmdpbmVzLCBkZWNsYXJpbmcgd2VkZ2VkIVxuIik7CisJCQlHRU1fVFJB
Q0VfRFVNUCgpOwogCQl9Ci0JfSB3aGlsZSAoaTkxNV9yZXRpcmVfcmVxdWVzdHMoZ3QtPmk5MTUp
ICYmIHJlc3VsdCk7CisKKwkJLyoKKwkJICogRm9yY2libHkgY2FuY2VsIG91dHN0YW5kaW5nIHdv
cmsgYW5kIGxlYXZlCisJCSAqIHRoZSBncHUgcXVpZXQuCisJCSAqLworCQlpbnRlbF9ndF9zZXRf
d2VkZ2VkKGd0KTsKKwkJcmVzdWx0ID0gZmFsc2U7CisJfQogCiAJaWYgKGludGVsX2d0X3BtX3dh
aXRfZm9yX2lkbGUoZ3QpKQogCQlyZXN1bHQgPSBmYWxzZTsKQEAgLTE0Niw4ICsxMzksNiBAQCB2
b2lkIGk5MTVfZ2VtX3N1c3BlbmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAKIAl1
c2VyX2ZvcmNld2FrZSgmaTkxNS0+Z3QsIHRydWUpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7Ci0KIAkvKgogCSAqIFdlIGhhdmUgdG8gZmx1c2ggYWxsIHRoZSBleGVj
dXRpbmcgY29udGV4dHMgdG8gbWFpbiBtZW1vcnkgc28KIAkgKiB0aGF0IHRoZXkgY2FuIHNhdmVk
IGluIHRoZSBoaWJlcm5hdGlvbiBpbWFnZS4gVG8gZW5zdXJlIHRoZSBsYXN0CkBAIC0xNTksOCAr
MTUwLDYgQEAgdm9pZCBpOTE1X2dlbV9zdXNwZW5kKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpp
OTE1KQogCSAqLwogCXN3aXRjaF90b19rZXJuZWxfY29udGV4dF9zeW5jKCZpOTE1LT5ndCk7CiAK
LQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJY2FuY2VsX2RlbGF5
ZWRfd29ya19zeW5jKCZpOTE1LT5ndC5oYW5nY2hlY2sud29yayk7CiAKIAlpOTE1X2dlbV9kcmFp
bl9mcmVlZF9vYmplY3RzKGk5MTUpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb2hlcmVuY3kuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29oZXJlbmN5LmMKaW5kZXggMGZmN2E4OWFhZGNhLi41
NDk4MTBmNzBhZWIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVz
dHMvaTkxNV9nZW1fY29oZXJlbmN5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3Nl
bGZ0ZXN0cy9pOTE1X2dlbV9jb2hlcmVuY3kuYwpAQCAtNyw2ICs3LDcgQEAKICNpbmNsdWRlIDxs
aW51eC9wcmltZV9udW1iZXJzLmg+CiAKICNpbmNsdWRlICJndC9pbnRlbF9ndC5oIgorI2luY2x1
ZGUgImd0L2ludGVsX2d0X3BtLmgiCiAKICNpbmNsdWRlICJpOTE1X3NlbGZ0ZXN0LmgiCiAjaW5j
bHVkZSAic2VsZnRlc3RzL2k5MTVfcmFuZG9tLmgiCkBAIC03OCw3ICs3OSw3IEBAIHN0YXRpYyBp
bnQgZ3R0X3NldChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogewogCXN0cnVjdCBp
OTE1X3ZtYSAqdm1hOwogCXUzMiBfX2lvbWVtICptYXA7Ci0JaW50IGVycjsKKwlpbnQgZXJyID0g
MDsKIAogCWk5MTVfZ2VtX29iamVjdF9sb2NrKG9iaik7CiAJZXJyID0gaTkxNV9nZW1fb2JqZWN0
X3NldF90b19ndHRfZG9tYWluKG9iaiwgdHJ1ZSk7CkBAIC05MCwxNSArOTEsMjEgQEAgc3RhdGlj
IGludCBndHRfc2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJaWYgKElTX0VS
Uih2bWEpKQogCQlyZXR1cm4gUFRSX0VSUih2bWEpOwogCisJaW50ZWxfZ3RfcG1fZ2V0KHZtYS0+
dm0tPmd0KTsKKwogCW1hcCA9IGk5MTVfdm1hX3Bpbl9pb21hcCh2bWEpOwogCWk5MTVfdm1hX3Vu
cGluKHZtYSk7Ci0JaWYgKElTX0VSUihtYXApKQotCQlyZXR1cm4gUFRSX0VSUihtYXApOworCWlm
IChJU19FUlIobWFwKSkgeworCQllcnIgPSBQVFJfRVJSKG1hcCk7CisJCWdvdG8gb3V0X3JwbTsK
Kwl9CiAKIAlpb3dyaXRlMzIodiwgJm1hcFtvZmZzZXQgLyBzaXplb2YoKm1hcCldKTsKIAlpOTE1
X3ZtYV91bnBpbl9pb21hcCh2bWEpOwogCi0JcmV0dXJuIDA7CitvdXRfcnBtOgorCWludGVsX2d0
X3BtX3B1dCh2bWEtPnZtLT5ndCk7CisJcmV0dXJuIGVycjsKIH0KIAogc3RhdGljIGludCBndHRf
Z2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCkBAIC0xMDcsNyArMTE0LDcgQEAg
c3RhdGljIGludCBndHRfZ2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiB7CiAJ
c3RydWN0IGk5MTVfdm1hICp2bWE7CiAJdTMyIF9faW9tZW0gKm1hcDsKLQlpbnQgZXJyOworCWlu
dCBlcnIgPSAwOwogCiAJaTkxNV9nZW1fb2JqZWN0X2xvY2sob2JqKTsKIAllcnIgPSBpOTE1X2dl
bV9vYmplY3Rfc2V0X3RvX2d0dF9kb21haW4ob2JqLCBmYWxzZSk7CkBAIC0xMTksMTUgKzEyNiwy
MSBAQCBzdGF0aWMgaW50IGd0dF9nZXQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwK
IAlpZiAoSVNfRVJSKHZtYSkpCiAJCXJldHVybiBQVFJfRVJSKHZtYSk7CiAKKwlpbnRlbF9ndF9w
bV9nZXQodm1hLT52bS0+Z3QpOworCiAJbWFwID0gaTkxNV92bWFfcGluX2lvbWFwKHZtYSk7CiAJ
aTkxNV92bWFfdW5waW4odm1hKTsKLQlpZiAoSVNfRVJSKG1hcCkpCi0JCXJldHVybiBQVFJfRVJS
KG1hcCk7CisJaWYgKElTX0VSUihtYXApKSB7CisJCWVyciA9IFBUUl9FUlIobWFwKTsKKwkJZ290
byBvdXRfcnBtOworCX0KIAogCSp2ID0gaW9yZWFkMzIoJm1hcFtvZmZzZXQgLyBzaXplb2YoKm1h
cCldKTsKIAlpOTE1X3ZtYV91bnBpbl9pb21hcCh2bWEpOwogCi0JcmV0dXJuIDA7CitvdXRfcnBt
OgorCWludGVsX2d0X3BtX3B1dCh2bWEtPnZtLT5ndCk7CisJcmV0dXJuIGVycjsKIH0KIAogc3Rh
dGljIGludCB3Y19zZXQoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKQEAgLTI4MCw3
ICsyOTMsNiBAQCBzdGF0aWMgaW50IGlndF9nZW1fY29oZXJlbmN5KHZvaWQgKmFyZykKIAlzdHJ1
Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKIAljb25zdCBzdHJ1Y3QgaWd0X2NvaGVy
ZW5jeV9tb2RlICpyZWFkLCAqd3JpdGUsICpvdmVyOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2Jq
ZWN0ICpvYmo7Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJdW5zaWduZWQgbG9uZyBjb3Vu
dCwgbjsKIAl1MzIgKm9mZnNldHMsICp2YWx1ZXM7CiAJaW50IGVyciA9IDA7CkBAIC0yOTksOCAr
MzExLDYgQEAgc3RhdGljIGludCBpZ3RfZ2VtX2NvaGVyZW5jeSh2b2lkICphcmcpCiAKIAl2YWx1
ZXMgPSBvZmZzZXRzICsgbmNhY2hlbGluZXM7CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRp
bWVfcG0pOwogCWZvciAob3ZlciA9IGlndF9jb2hlcmVuY3lfbW9kZTsgb3Zlci0+bmFtZTsgb3Zl
cisrKSB7CiAJCWlmICghb3Zlci0+c2V0KQogCQkJY29udGludWU7CkBAIC0zMjYsNyArMzM2LDcg
QEAgc3RhdGljIGludCBpZ3RfZ2VtX2NvaGVyZW5jeSh2b2lkICphcmcpCiAJCQkJCW9iaiA9IGk5
MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoaTkxNSwgUEFHRV9TSVpFKTsKIAkJCQkJaWYg
KElTX0VSUihvYmopKSB7CiAJCQkJCQllcnIgPSBQVFJfRVJSKG9iaik7Ci0JCQkJCQlnb3RvIHVu
bG9jazsKKwkJCQkJCWdvdG8gZnJlZTsKIAkJCQkJfQogCiAJCQkJCWk5MTVfcmFuZG9tX3Jlb3Jk
ZXIob2Zmc2V0cywgbmNhY2hlbGluZXMsICZwcm5nKTsKQEAgLTM3NywxNSArMzg3LDEzIEBAIHN0
YXRpYyBpbnQgaWd0X2dlbV9jb2hlcmVuY3kodm9pZCAqYXJnKQogCQkJfQogCQl9CiAJfQotdW5s
b2NrOgotCWludGVsX3J1bnRpbWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsK
LQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOworZnJlZToKIAlrZnJlZShv
ZmZzZXRzKTsKIAlyZXR1cm4gZXJyOwogCiBwdXRfb2JqZWN0OgogCWk5MTVfZ2VtX29iamVjdF9w
dXQob2JqKTsKLQlnb3RvIHVubG9jazsKKwlnb3RvIGZyZWU7CiB9CiAKIGludCBpOTE1X2dlbV9j
b2hlcmVuY3lfbGl2ZV9zZWxmdGVzdHMoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2Nv
bnRleHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29u
dGV4dC5jCmluZGV4IDZlZjNkNzQ1ZGM4ZC4uODJmNTRlODE5ZWIwIDEwMDY0NAotLS0gYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX2NvbnRleHQuYwpAQCAt
OTQ5LDcgKzk0OSw3IEBAIF9fc3NldV90ZXN0KGNvbnN0IGNoYXIgKm5hbWUsCiAJaWYgKHJldCkK
IAkJcmV0dXJuIHJldDsKIAotCXJldCA9IF9faW50ZWxfY29udGV4dF9yZWNvbmZpZ3VyZV9zc2V1
KGNlLCBzc2V1KTsKKwlyZXQgPSBpbnRlbF9jb250ZXh0X3JlY29uZmlndXJlX3NzZXUoY2UsIHNz
ZXUpOwogCWlmIChyZXQpCiAJCWdvdG8gb3V0X3NwaW47CiAKQEAgLTEwNTMsNyArMTA1Myw3IEBA
IF9faWd0X2N0eF9zc2V1KHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogCQlnb3RvIG91
dF9mYWlsOwogCiBvdXRfZmFpbDoKLQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlU
X0xPQ0tFRCkpCisJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUpKQogCQlyZXQgPSAtRUlPOwogCiAJ
aW50ZWxfY29udGV4dF91bnBpbihjZSk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21tYW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dl
bS9zZWxmdGVzdHMvaTkxNV9nZW1fbW1hbi5jCmluZGV4IDM2YWNhMWMxNzJlNy4uODU2YjhlNDY3
ZWU4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVf
Z2VtX21tYW4uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVf
Z2VtX21tYW4uYwpAQCAtNTgxLDEyICs1ODEsOCBAQCBzdGF0aWMgdm9pZCBkaXNhYmxlX3JldGly
ZV93b3JrZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiAKIHN0YXRpYyB2b2lkIHJl
c3RvcmVfcmV0aXJlX3dvcmtlcihzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKKwlp
Z3RfZmx1c2hfdGVzdChpOTE1KTsKIAlpbnRlbF9ndF9wbV9wdXQoJmk5MTUtPmd0KTsKLQotCW11
dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlndF9mbHVzaF90ZXN0KGk5MTUs
IEk5MTVfV0FJVF9MT0NLRUQpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7Ci0KIAlpOTE1X2dlbV9kcml2ZXJfcmVnaXN0ZXJfX3Nocmlua2VyKGk5MTUpOwogfQogCmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX29i
amVjdF9ibHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1f
b2JqZWN0X2JsdC5jCmluZGV4IGMyMWQ3NDdlN2QwNS4uOWVjNTViM2EzODE1IDEwMDY0NAotLS0g
YS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVjdF9ibHQu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX29iamVj
dF9ibHQuYwpAQCAtNjUsOSArNjUsNyBAQCBzdGF0aWMgaW50IGlndF9maWxsX2JsdCh2b2lkICph
cmcpCiAJCWlmICghKG9iai0+Y2FjaGVfY29oZXJlbnQgJiBJOTE1X0JPX0NBQ0hFX0NPSEVSRU5U
X0ZPUl9XUklURSkpCiAJCQlvYmotPmNhY2hlX2RpcnR5ID0gdHJ1ZTsKIAotCQltdXRleF9sb2Nr
KCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJZXJyID0gaTkxNV9nZW1fb2JqZWN0X2ZpbGxf
Ymx0KG9iaiwgY2UsIHZhbCk7Ci0JCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAJCWlmIChlcnIpCiAJCQlnb3RvIGVycl91bnBpbjsKIApAQCAtMTY2LDkgKzE2NCw3IEBA
IHN0YXRpYyBpbnQgaWd0X2NvcHlfYmx0KHZvaWQgKmFyZykKIAkJaWYgKCEoZHN0LT5jYWNoZV9j
b2hlcmVudCAmIEk5MTVfQk9fQ0FDSEVfQ09IRVJFTlRfRk9SX1dSSVRFKSkKIAkJCWRzdC0+Y2Fj
aGVfZGlydHkgPSB0cnVlOwogCi0JCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgp
OwogCQllcnIgPSBpOTE1X2dlbV9vYmplY3RfY29weV9ibHQoc3JjLCBkc3QsIGNlKTsKLQkJbXV0
ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJaWYgKGVycikKIAkJCWdvdG8g
ZXJyX3VucGluOwogCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVz
dF9jb250ZXh0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9jb250ZXh0LmMK
aW5kZXggZTZiY2JlN2FiNWUxLi44NmNmZmJiMGE5Y2IgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X2NvbnRleHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9zZWxmdGVzdF9jb250ZXh0LmMKQEAgLTMxOCw3ICszMTgsNyBAQCBzdGF0aWMgaW50IGxp
dmVfYWN0aXZlX2NvbnRleHQodm9pZCAqYXJnKQogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAKLQkJ
ZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpOworCQllcnIg
PSBpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSk7CiAJCWlmIChlcnIpCiAJCQlicmVhazsKIAl9CkBA
IC00MzEsNyArNDMxLDcgQEAgc3RhdGljIGludCBsaXZlX3JlbW90ZV9jb250ZXh0KHZvaWQgKmFy
ZykKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCi0JCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5p
OTE1LCBJOTE1X1dBSVRfTE9DS0VEKTsKKwkJZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUp
OwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAJfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9z
ZWxmdGVzdF9oYW5nY2hlY2suYwppbmRleCBlNTNlZWExMDUwZjguLmZjNGQwMjQwNjUzNiAxMDA2
NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfaGFuZ2NoZWNrLmMKQEAgLTU4LDcg
KzU4LDkgQEAgc3RhdGljIGludCBoYW5nX2luaXQoc3RydWN0IGhhbmcgKmgsIHN0cnVjdCBpbnRl
bF9ndCAqZ3QpCiAJbWVtc2V0KGgsIDAsIHNpemVvZigqaCkpOwogCWgtPmd0ID0gZ3Q7CiAKKwlt
dXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaC0+Y3R4ID0ga2VybmVs
X2NvbnRleHQoZ3QtPmk5MTUpOworCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3Rf
bXV0ZXgpOwogCWlmIChJU19FUlIoaC0+Y3R4KSkKIAkJcmV0dXJuIFBUUl9FUlIoaC0+Y3R4KTsK
IApAQCAtMjg1LDcgKzI4Nyw3IEBAIHN0YXRpYyB2b2lkIGhhbmdfZmluaShzdHJ1Y3QgaGFuZyAq
aCkKIAogCWtlcm5lbF9jb250ZXh0X2Nsb3NlKGgtPmN0eCk7CiAKLQlpZ3RfZmx1c2hfdGVzdCho
LT5ndC0+aTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCk7CisJaWd0X2ZsdXNoX3Rlc3QoaC0+Z3QtPmk5
MTUpOwogfQogCiBzdGF0aWMgYm9vbCB3YWl0X3VudGlsX3J1bm5pbmcoc3RydWN0IGhhbmcgKmgs
IHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxKQpAQCAtMzA5LDEwICszMTEsOSBAQCBzdGF0aWMgaW50
IGlndF9oYW5nX3Nhbml0eWNoZWNrKHZvaWQgKmFyZykKIAogCS8qIEJhc2ljIGNoZWNrIHRoYXQg
d2UgY2FuIGV4ZWN1dGUgb3VyIGhhbmdpbmcgYmF0Y2ggKi8KIAotCW11dGV4X2xvY2soJmd0LT5p
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAllcnIgPSBoYW5nX2luaXQoJmgsIGd0KTsKIAlpZiAo
ZXJyKQotCQlnb3RvIHVubG9jazsKKwkJcmV0dXJuIGVycjsKIAogCWZvcl9lYWNoX2VuZ2luZShl
bmdpbmUsIGd0LT5pOTE1LCBpZCkgewogCQlzdHJ1Y3QgaW50ZWxfd2VkZ2VfbWUgdzsKQEAgLTM1
NSw4ICszNTYsNiBAQCBzdGF0aWMgaW50IGlndF9oYW5nX3Nhbml0eWNoZWNrKHZvaWQgKmFyZykK
IAogZmluaToKIAloYW5nX2ZpbmkoJmgpOwotdW5sb2NrOgotCW11dGV4X3VubG9jaygmZ3QtPmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CiB9CiAKQEAgLTM5NSw4ICszOTQs
NiBAQCBzdGF0aWMgaW50IGlndF9yZXNldF9ub3Aodm9pZCAqYXJnKQogCXJlc2V0X2NvdW50ID0g
aTkxNV9yZXNldF9jb3VudChnbG9iYWwpOwogCWNvdW50ID0gMDsKIAlkbyB7Ci0JCW11dGV4X2xv
Y2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCQlmb3JfZWFjaF9lbmdpbmUoZW5n
aW5lLCBndC0+aTkxNSwgaWQpIHsKIAkJCWludCBpOwogCkBAIC00MTcsNyArNDE0LDYgQEAgc3Rh
dGljIGludCBpZ3RfcmVzZXRfbm9wKHZvaWQgKmFyZykKIAkJaW50ZWxfZ3RfcmVzZXQoZ3QsIEFM
TF9FTkdJTkVTLCBOVUxMKTsKIAkJaWd0X2dsb2JhbF9yZXNldF91bmxvY2soZ3QpOwogCi0JCW11
dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCQlpZiAoaW50ZWxfZ3Rf
aXNfd2VkZ2VkKGd0KSkgewogCQkJZXJyID0gLUVJTzsKIAkJCWJyZWFrOwpAQCAtNDI5LDE2ICs0
MjUsMTMgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfbm9wKHZvaWQgKmFyZykKIAkJCWJyZWFrOwog
CQl9CiAKLQkJZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUsIDApOworCQllcnIgPSBpZ3Rf
Zmx1c2hfdGVzdChndC0+aTkxNSk7CiAJCWlmIChlcnIpCiAJCQlicmVhazsKIAl9IHdoaWxlICh0
aW1lX2JlZm9yZShqaWZmaWVzLCBlbmRfdGltZSkpOwogCXByX2luZm8oIiVzOiAlZCByZXNldHNc
biIsIF9fZnVuY19fLCBjb3VudCk7CiAKLQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7Ci0JZXJyID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUsIEk5MTVfV0FJVF9MT0NL
RUQpOwotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCisJZXJy
ID0gaWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpOwogb3V0OgogCW1vY2tfZmlsZV9mcmVlKGd0LT5p
OTE1LCBmaWxlKTsKIAlpZiAoaW50ZWxfZ3RfaXNfd2VkZ2VkKGd0KSkKQEAgLTQ5NCw3ICs0ODcs
NiBAQCBzdGF0aWMgaW50IGlndF9yZXNldF9ub3BfZW5naW5lKHZvaWQgKmFyZykKIAkJCQlicmVh
azsKIAkJCX0KIAotCQkJbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
CQkJZm9yIChpID0gMDsgaSA8IDE2OyBpKyspIHsKIAkJCQlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpy
cTsKIApAQCAtNTA3LDcgKzQ5OSw2IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X25vcF9lbmdpbmUo
dm9pZCAqYXJnKQogCQkJCWk5MTVfcmVxdWVzdF9hZGQocnEpOwogCQkJfQogCQkJZXJyID0gaW50
ZWxfZW5naW5lX3Jlc2V0KGVuZ2luZSwgTlVMTCk7Ci0JCQltdXRleF91bmxvY2soJmd0LT5pOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKIAkJCWlmIChlcnIpIHsKIAkJCQlwcl9lcnIoImk5MTVfcmVz
ZXRfZW5naW5lIGZhaWxlZFxuIik7CiAJCQkJYnJlYWs7CkBAIC01MzMsMTUgKzUyNCwxMiBAQCBz
dGF0aWMgaW50IGlndF9yZXNldF9ub3BfZW5naW5lKHZvaWQgKmFyZykKIAkJaWYgKGVycikKIAkJ
CWJyZWFrOwogCi0JCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1LCAwKTsKKwkJZXJyID0g
aWd0X2ZsdXNoX3Rlc3QoZ3QtPmk5MTUpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAJfQogCi0J
bXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWVyciA9IGlndF9mbHVz
aF90ZXN0KGd0LT5pOTE1LCBJOTE1X1dBSVRfTE9DS0VEKTsKLQltdXRleF91bmxvY2soJmd0LT5p
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQorCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1
KTsKIG91dDoKIAltb2NrX2ZpbGVfZnJlZShndC0+aTkxNSwgZmlsZSk7CiAJaWYgKGludGVsX2d0
X2lzX3dlZGdlZChndCkpCkBAIC01NjMsOSArNTUxLDcgQEAgc3RhdGljIGludCBfX2lndF9yZXNl
dF9lbmdpbmUoc3RydWN0IGludGVsX2d0ICpndCwgYm9vbCBhY3RpdmUpCiAJCXJldHVybiAwOwog
CiAJaWYgKGFjdGl2ZSkgewotCQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAJCWVyciA9IGhhbmdfaW5pdCgmaCwgZ3QpOwotCQltdXRleF91bmxvY2soJmd0LT5pOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKIAkJaWYgKGVycikKIAkJCXJldHVybiBlcnI7CiAJfQpAQCAt
NTkzLDE3ICs1NzksMTQgQEAgc3RhdGljIGludCBfX2lndF9yZXNldF9lbmdpbmUoc3RydWN0IGlu
dGVsX2d0ICpndCwgYm9vbCBhY3RpdmUpCiAJCQlpZiAoYWN0aXZlKSB7CiAJCQkJc3RydWN0IGk5
MTVfcmVxdWVzdCAqcnE7CiAKLQkJCQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAJCQkJcnEgPSBoYW5nX2NyZWF0ZV9yZXF1ZXN0KCZoLCBlbmdpbmUpOwogCQkJCWlm
IChJU19FUlIocnEpKSB7CiAJCQkJCWVyciA9IFBUUl9FUlIocnEpOwotCQkJCQltdXRleF91bmxv
Y2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJCQkJYnJlYWs7CiAJCQkJfQogCiAJ
CQkJaTkxNV9yZXF1ZXN0X2dldChycSk7CiAJCQkJaTkxNV9yZXF1ZXN0X2FkZChycSk7Ci0JCQkJ
bXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAkJCQlpZiAoIXdh
aXRfdW50aWxfcnVubmluZygmaCwgcnEpKSB7CiAJCQkJCXN0cnVjdCBkcm1fcHJpbnRlciBwID0g
ZHJtX2luZm9fcHJpbnRlcihndC0+aTkxNS0+ZHJtLmRldik7CkBAIC02NDcsNyArNjMwLDcgQEAg
c3RhdGljIGludCBfX2lndF9yZXNldF9lbmdpbmUoc3RydWN0IGludGVsX2d0ICpndCwgYm9vbCBh
Y3RpdmUpCiAJCWlmIChlcnIpCiAJCQlicmVhazsKIAotCQllcnIgPSBpZ3RfZmx1c2hfdGVzdChn
dC0+aTkxNSwgMCk7CisJCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KTsKIAkJaWYgKGVy
cikKIAkJCWJyZWFrOwogCX0KQEAgLTY1NSwxMSArNjM4LDggQEAgc3RhdGljIGludCBfX2lndF9y
ZXNldF9lbmdpbmUoc3RydWN0IGludGVsX2d0ICpndCwgYm9vbCBhY3RpdmUpCiAJaWYgKGludGVs
X2d0X2lzX3dlZGdlZChndCkpCiAJCWVyciA9IC1FSU87CiAKLQlpZiAoYWN0aXZlKSB7Ci0JCW11
dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKKwlpZiAoYWN0aXZlKQogCQlo
YW5nX2ZpbmkoJmgpOwotCQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKLQl9CiAKIAlyZXR1cm4gZXJyOwogfQpAQCAtNzQxLDEwICs3MjEsOCBAQCBzdGF0aWMgaW50
IGFjdGl2ZV9lbmdpbmUodm9pZCAqZGF0YSkKIAkJc3RydWN0IGk5MTVfcmVxdWVzdCAqb2xkID0g
cnFbaWR4XTsKIAkJc3RydWN0IGk5MTVfcmVxdWVzdCAqbmV3OwogCi0JCW11dGV4X2xvY2soJmVu
Z2luZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCW5ldyA9IGlndF9yZXF1ZXN0X2FsbG9j
KGN0eFtpZHhdLCBlbmdpbmUpOwogCQlpZiAoSVNfRVJSKG5ldykpIHsKLQkJCW11dGV4X3VubG9j
aygmZW5naW5lLT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJCWVyciA9IFBUUl9FUlIobmV3
KTsKIAkJCWJyZWFrOwogCQl9CkBAIC03NTUsNyArNzMzLDYgQEAgc3RhdGljIGludCBhY3RpdmVf
ZW5naW5lKHZvaWQgKmRhdGEpCiAKIAkJcnFbaWR4XSA9IGk5MTVfcmVxdWVzdF9nZXQobmV3KTsK
IAkJaTkxNV9yZXF1ZXN0X2FkZChuZXcpOwotCQltdXRleF91bmxvY2soJmVuZ2luZS0+aTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAkJZXJyID0gYWN0aXZlX3JlcXVlc3RfcHV0KG9sZCk7CiAJ
CWlmIChlcnIpCkBAIC03OTUsOSArNzcyLDcgQEAgc3RhdGljIGludCBfX2lndF9yZXNldF9lbmdp
bmVzKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCiAJCXJldHVybiAwOwogCiAJaWYgKGZsYWdzICYgVEVT
VF9BQ1RJVkUpIHsKLQkJbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
CQllcnIgPSBoYW5nX2luaXQoJmgsIGd0KTsKLQkJbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7CiAJCWlmIChlcnIpCiAJCQlyZXR1cm4gZXJyOwogCkBAIC04NTUsMTcg
KzgzMCwxNCBAQCBzdGF0aWMgaW50IF9faWd0X3Jlc2V0X2VuZ2luZXMoc3RydWN0IGludGVsX2d0
ICpndCwKIAkJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxID0gTlVMTDsKIAogCQkJaWYgKGZsYWdz
ICYgVEVTVF9BQ1RJVkUpIHsKLQkJCQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAJCQkJcnEgPSBoYW5nX2NyZWF0ZV9yZXF1ZXN0KCZoLCBlbmdpbmUpOwogCQkJCWlm
IChJU19FUlIocnEpKSB7CiAJCQkJCWVyciA9IFBUUl9FUlIocnEpOwotCQkJCQltdXRleF91bmxv
Y2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAkJCQkJYnJlYWs7CiAJCQkJfQogCiAJ
CQkJaTkxNV9yZXF1ZXN0X2dldChycSk7CiAJCQkJaTkxNV9yZXF1ZXN0X2FkZChycSk7Ci0JCQkJ
bXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAkJCQlpZiAoIXdh
aXRfdW50aWxfcnVubmluZygmaCwgcnEpKSB7CiAJCQkJCXN0cnVjdCBkcm1fcHJpbnRlciBwID0g
ZHJtX2luZm9fcHJpbnRlcihndC0+aTkxNS0+ZHJtLmRldik7CkBAIC05NzcsOSArOTQ5LDcgQEAg
c3RhdGljIGludCBfX2lndF9yZXNldF9lbmdpbmVzKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCiAJCWlm
IChlcnIpCiAJCQlicmVhazsKIAotCQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7Ci0JCWVyciA9IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1LCBJOTE1X1dBSVRfTE9DS0VE
KTsKLQkJbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisJCWVyciA9
IGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KTsKIAkJaWYgKGVycikKIAkJCWJyZWFrOwogCX0KQEAg
LTk4NywxMSArOTU3LDggQEAgc3RhdGljIGludCBfX2lndF9yZXNldF9lbmdpbmVzKHN0cnVjdCBp
bnRlbF9ndCAqZ3QsCiAJaWYgKGludGVsX2d0X2lzX3dlZGdlZChndCkpCiAJCWVyciA9IC1FSU87
CiAKLQlpZiAoZmxhZ3MgJiBURVNUX0FDVElWRSkgewotCQltdXRleF9sb2NrKCZndC0+aTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CisJaWYgKGZsYWdzICYgVEVTVF9BQ1RJVkUpCiAJCWhhbmdfZmlu
aSgmaCk7Ci0JCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCX0K
IAogCXJldHVybiBlcnI7CiB9CkBAIC0xMDYxLDcgKzEwMjgsNiBAQCBzdGF0aWMgaW50IGlndF9y
ZXNldF93YWl0KHZvaWQgKmFyZykKIAogCWlndF9nbG9iYWxfcmVzZXRfbG9jayhndCk7CiAKLQlt
dXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJZXJyID0gaGFuZ19pbml0
KCZoLCBndCk7CiAJaWYgKGVycikKIAkJZ290byB1bmxvY2s7CkBAIC0xMTA5LDcgKzEwNzUsNiBA
QCBzdGF0aWMgaW50IGlndF9yZXNldF93YWl0KHZvaWQgKmFyZykKIGZpbmk6CiAJaGFuZ19maW5p
KCZoKTsKIHVubG9jazoKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKIAlpZ3RfZ2xvYmFsX3Jlc2V0X3VubG9jayhndCk7CiAKIAlpZiAoaW50ZWxfZ3RfaXNfd2Vk
Z2VkKGd0KSkKQEAgLTExODksMTAgKzExNTQsOSBAQCBzdGF0aWMgaW50IF9faWd0X3Jlc2V0X2V2
aWN0X3ZtYShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LAogCiAJLyogQ2hlY2sgdGhhdCB3ZSBjYW4gcmVj
b3ZlciBhbiB1bmJpbmQgc3R1Y2sgb24gYSBoYW5naW5nIHJlcXVlc3QgKi8KIAotCW11dGV4X2xv
Y2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAllcnIgPSBoYW5nX2luaXQoJmgsIGd0
KTsKIAlpZiAoZXJyKQotCQlnb3RvIHVubG9jazsKKwkJcmV0dXJuIGVycjsKIAogCW9iaiA9IGk5
MTVfZ2VtX29iamVjdF9jcmVhdGVfaW50ZXJuYWwoZ3QtPmk5MTUsIFNaXzFNKTsKIAlpZiAoSVNf
RVJSKG9iaikpIHsKQEAgLTEyNTUsOCArMTIxOSw2IEBAIHN0YXRpYyBpbnQgX19pZ3RfcmVzZXRf
ZXZpY3Rfdm1hKHN0cnVjdCBpbnRlbF9ndCAqZ3QsCiAJaWYgKGVycikKIAkJZ290byBvdXRfcnE7
CiAKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWlmICgh
d2FpdF91bnRpbF9ydW5uaW5nKCZoLCBycSkpIHsKIAkJc3RydWN0IGRybV9wcmludGVyIHAgPSBk
cm1faW5mb19wcmludGVyKGd0LT5pOTE1LT5kcm0uZGV2KTsKIApAQCAtMTMwNSwxNiArMTI2Nywx
MiBAQCBzdGF0aWMgaW50IF9faWd0X3Jlc2V0X2V2aWN0X3ZtYShzdHJ1Y3QgaW50ZWxfZ3QgKmd0
LAogCQlwdXRfdGFza19zdHJ1Y3QodHNrKTsKIAl9CiAKLQltdXRleF9sb2NrKCZndC0+aTkxNS0+
ZHJtLnN0cnVjdF9tdXRleCk7CiBvdXRfcnE6CiAJaTkxNV9yZXF1ZXN0X3B1dChycSk7CiBvdXRf
b2JqOgogCWk5MTVfZ2VtX29iamVjdF9wdXQob2JqKTsKIGZpbmk6CiAJaGFuZ19maW5pKCZoKTsK
LXVubG9jazoKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQog
CWlmIChpbnRlbF9ndF9pc193ZWRnZWQoZ3QpKQogCQlyZXR1cm4gLUVJTzsKIApAQCAtMTM5Niw3
ICsxMzU0LDYgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfcXVldWUodm9pZCAqYXJnKQogCiAJaWd0
X2dsb2JhbF9yZXNldF9sb2NrKGd0KTsKIAotCW11dGV4X2xvY2soJmd0LT5pOTE1LT5kcm0uc3Ry
dWN0X211dGV4KTsKIAllcnIgPSBoYW5nX2luaXQoJmgsIGd0KTsKIAlpZiAoZXJyKQogCQlnb3Rv
IHVubG9jazsKQEAgLTE1MTEsNyArMTQ2OCw3IEBAIHN0YXRpYyBpbnQgaWd0X3Jlc2V0X3F1ZXVl
KHZvaWQgKmFyZykKIAogCQlpOTE1X3JlcXVlc3RfcHV0KHByZXYpOwogCi0JCWVyciA9IGlndF9m
bHVzaF90ZXN0KGd0LT5pOTE1LCBJOTE1X1dBSVRfTE9DS0VEKTsKKwkJZXJyID0gaWd0X2ZsdXNo
X3Rlc3QoZ3QtPmk5MTUpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAJfQpAQCAtMTUxOSw3ICsx
NDc2LDYgQEAgc3RhdGljIGludCBpZ3RfcmVzZXRfcXVldWUodm9pZCAqYXJnKQogZmluaToKIAlo
YW5nX2ZpbmkoJmgpOwogdW5sb2NrOgotCW11dGV4X3VubG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1
Y3RfbXV0ZXgpOwogCWlndF9nbG9iYWxfcmVzZXRfdW5sb2NrKGd0KTsKIAogCWlmIChpbnRlbF9n
dF9pc193ZWRnZWQoZ3QpKQpAQCAtMTU0NiwxMSArMTUwMiw5IEBAIHN0YXRpYyBpbnQgaWd0X2hh
bmRsZV9lcnJvcih2b2lkICphcmcpCiAJaWYgKCFlbmdpbmUgfHwgIWludGVsX2VuZ2luZV9jYW5f
c3RvcmVfZHdvcmQoZW5naW5lKSkKIAkJcmV0dXJuIDA7CiAKLQltdXRleF9sb2NrKCZndC0+aTkx
NS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAllcnIgPSBoYW5nX2luaXQoJmgsIGd0KTsKIAlpZiAo
ZXJyKQotCQlnb3RvIGVycl91bmxvY2s7CisJCXJldHVybiBlcnI7CiAKIAlycSA9IGhhbmdfY3Jl
YXRlX3JlcXVlc3QoJmgsIGVuZ2luZSk7CiAJaWYgKElTX0VSUihycSkpIHsKQEAgLTE1NzQsOCAr
MTUyOCw2IEBAIHN0YXRpYyBpbnQgaWd0X2hhbmRsZV9lcnJvcih2b2lkICphcmcpCiAJCWdvdG8g
ZXJyX3JlcXVlc3Q7CiAJfQogCi0JbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7Ci0KIAkvKiBUZW1wb3JhcmlseSBkaXNhYmxlIGVycm9yIGNhcHR1cmUgKi8KIAllcnJv
ciA9IHhjaGcoJmdsb2JhbC0+Zmlyc3RfZXJyb3IsICh2b2lkICopLTEpOwogCkBAIC0xNTgzLDgg
KzE1MzUsNiBAQCBzdGF0aWMgaW50IGlndF9oYW5kbGVfZXJyb3Iodm9pZCAqYXJnKQogCiAJeGNo
ZygmZ2xvYmFsLT5maXJzdF9lcnJvciwgZXJyb3IpOwogCi0JbXV0ZXhfbG9jaygmZ3QtPmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwotCiAJaWYgKHJxLT5mZW5jZS5lcnJvciAhPSAtRUlPKSB7CiAJ
CXByX2VycigiR3VpbHR5IHJlcXVlc3Qgbm90IGlkZW50aWZpZWQhXG4iKTsKIAkJZXJyID0gLUVJ
TlZBTDsKQEAgLTE1OTUsOCArMTU0NSw2IEBAIHN0YXRpYyBpbnQgaWd0X2hhbmRsZV9lcnJvcih2
b2lkICphcmcpCiAJaTkxNV9yZXF1ZXN0X3B1dChycSk7CiBlcnJfZmluaToKIAloYW5nX2Zpbmko
JmgpOwotZXJyX3VubG9jazoKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKIAlyZXR1cm4gZXJyOwogfQogCkBAIC0xNjg5LDcgKzE2MzcsNiBAQCBzdGF0aWMgaW50
IGlndF9yZXNldF9lbmdpbmVzX2F0b21pYyh2b2lkICphcmcpCiAJCXJldHVybiAwOwogCiAJaWd0
X2dsb2JhbF9yZXNldF9sb2NrKGd0KTsKLQltdXRleF9sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7CiAKIAkvKiBGbHVzaCBhbnkgcmVxdWVzdHMgYmVmb3JlIHdlIGdldCBzdGFydGVk
IGFuZCBjaGVjayBiYXNpY3MgKi8KIAlpZiAoIWlndF9mb3JjZV9yZXNldChndCkpCkBAIC0xNzA5
LDkgKzE2NTYsNyBAQCBzdGF0aWMgaW50IGlndF9yZXNldF9lbmdpbmVzX2F0b21pYyh2b2lkICph
cmcpCiBvdXQ6CiAJLyogQXMgd2UgcG9rZSBhcm91bmQgdGhlIGd1dHMsIGRvIGEgZnVsbCByZXNl
dCBiZWZvcmUgY29udGludWluZy4gKi8KIAlpZ3RfZm9yY2VfcmVzZXQoZ3QpOwotCiB1bmxvY2s6
Ci0JbXV0ZXhfdW5sb2NrKCZndC0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJaWd0X2dsb2Jh
bF9yZXNldF91bmxvY2soZ3QpOwogCiAJcmV0dXJuIGVycjsKQEAgLTE3NTEsMTAgKzE2OTYsNiBA
QCBpbnQgaW50ZWxfaGFuZ2NoZWNrX2xpdmVfc2VsZnRlc3RzKHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1KQogCiAJZXJyID0gaW50ZWxfZ3RfbGl2ZV9zdWJ0ZXN0cyh0ZXN0cywgZ3QpOwog
Ci0JbXV0ZXhfbG9jaygmZ3QtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlndF9mbHVzaF90
ZXN0KGd0LT5pOTE1LCBJOTE1X1dBSVRfTE9DS0VEKTsKLQltdXRleF91bmxvY2soJmd0LT5pOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWk5MTVfbW9kcGFyYW1zLmVuYWJsZV9oYW5nY2hlY2sg
PSBzYXZlZF9oYW5nY2hlY2s7CiAJaW50ZWxfcnVudGltZV9wbV9wdXQoJmd0LT5pOTE1LT5ydW50
aW1lX3BtLCB3YWtlcmVmKTsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfbHJjLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9scmMuYwpp
bmRleCA4ZWVjNGVhZDEyYTQuLjMzMDBhY2Q5MTk5ZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfbHJjLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3RfbHJjLmMKQEAgLTYxLDcgKzYxLDcgQEAgc3RhdGljIGludCBsaXZlX3Nhbml0eWNo
ZWNrKHZvaWQgKmFyZykKIAkJfQogCiAJCWlndF9zcGlubmVyX2VuZCgmc3Bpbik7Ci0JCWlmIChp
Z3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkgeworCQlpZiAoaWd0X2ZsdXNo
X3Rlc3QoaTkxNSkpIHsKIAkJCWVyciA9IC1FSU87CiAJCQlnb3RvIGVycl9jdHg7CiAJCX0KQEAg
LTIwNiw4ICsyMDYsNyBAQCBzbGljZV9zZW1hcGhvcmVfcXVldWUoc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqb3V0ZXIsCiAJaWYgKGVycikKIAkJZ290byBvdXQ7CiAKLQlpZiAoaTkxNV9yZXF1ZXN0
X3dhaXQoaGVhZCwKLQkJCSAgICAgIEk5MTVfV0FJVF9MT0NLRUQsCisJaWYgKGk5MTVfcmVxdWVz
dF93YWl0KGhlYWQsIDAsCiAJCQkgICAgICAyICogUlVOVElNRV9JTkZPKG91dGVyLT5pOTE1KS0+
bnVtX2VuZ2luZXMgKiAoY291bnQgKyAyKSAqIChjb3VudCArIDMpKSA8IDApIHsKIAkJcHJfZXJy
KCJGYWlsZWQgdG8gc2xpY2UgYWxvbmcgc2VtYXBob3JlIGNoYWluIG9mIGxlbmd0aCAoJWQsICVk
KSFcbiIsCiAJCSAgICAgICBjb3VudCwgbik7CkBAIC0yNzksNyArMjc4LDcgQEAgc3RhdGljIGlu
dCBsaXZlX3RpbWVzbGljZV9wcmVlbXB0KHZvaWQgKmFyZykKIAkJCWlmIChlcnIpCiAJCQkJZ290
byBlcnJfcGluOwogCi0JCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tF
RCkpIHsKKwkJCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkgewogCQkJCWVyciA9IC1FSU87CiAJ
CQkJZ290byBlcnJfcGluOwogCQkJfQpAQCAtODMyLDcgKzgzMSw3IEBAIHN0YXRpYyBpbnQgbGl2
ZV9ub3ByZWVtcHQodm9pZCAqYXJnKQogCQkJZ290byBlcnJfd2VkZ2VkOwogCQl9CiAKLQkJaWYg
KGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQorCQlpZiAoaWd0X2ZsdXNo
X3Rlc3QoaTkxNSkpCiAJCQlnb3RvIGVycl93ZWRnZWQ7CiAJfQogCkBAIC04OTcsNyArODk2LDcg
QEAgc3RhdGljIGludCBsaXZlX3N1cHByZXNzX3NlbGZfcHJlZW1wdCh2b2lkICphcmcpCiAJCWlm
ICghaW50ZWxfZW5naW5lX2hhc19wcmVlbXB0aW9uKGVuZ2luZSkpCiAJCQljb250aW51ZTsKIAot
CQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJCWlmIChpZ3Rf
Zmx1c2hfdGVzdChpOTE1KSkKIAkJCWdvdG8gZXJyX3dlZGdlZDsKIAogCQlpbnRlbF9lbmdpbmVf
cG1fZ2V0KGVuZ2luZSk7CkBAIC05NTgsNyArOTU3LDcgQEAgc3RhdGljIGludCBsaXZlX3N1cHBy
ZXNzX3NlbGZfcHJlZW1wdCh2b2lkICphcmcpCiAJCX0KIAogCQlpbnRlbF9lbmdpbmVfcG1fcHV0
KGVuZ2luZSk7Ci0JCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkK
KwkJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUpKQogCQkJZ290byBlcnJfd2VkZ2VkOwogCX0KIApA
QCAtMTExOSw3ICsxMTE4LDcgQEAgc3RhdGljIGludCBsaXZlX3N1cHByZXNzX3dhaXRfcHJlZW1w
dCh2b2lkICphcmcpCiAJCQlmb3IgKGkgPSAwOyBpIDwgQVJSQVlfU0laRShjbGllbnQpOyBpKysp
CiAJCQkJaWd0X3NwaW5uZXJfZW5kKCZjbGllbnRbaV0uc3Bpbik7CiAKLQkJCWlmIChpZ3RfZmx1
c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwkJCWlmIChpZ3RfZmx1c2hfdGVzdChp
OTE1KSkKIAkJCQlnb3RvIGVycl93ZWRnZWQ7CiAKIAkJCWlmIChlbmdpbmUtPmV4ZWNsaXN0cy5w
cmVlbXB0X2hhbmcuY291bnQpIHsKQEAgLTEzOTgsNyArMTM5Nyw3IEBAIHN0YXRpYyBpbnQgbGl2
ZV9wcmVlbXB0X2hhbmcodm9pZCAqYXJnKQogCiAJCWlndF9zcGlubmVyX2VuZCgmc3Bpbl9oaSk7
CiAJCWlndF9zcGlubmVyX2VuZCgmc3Bpbl9sbyk7Ci0JCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1
LCBJOTE1X1dBSVRfTE9DS0VEKSkgeworCQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpIHsKIAkJ
CWVyciA9IC1FSU87CiAJCQlnb3RvIGVycl9jdHhfbG87CiAJCX0KQEAgLTE3OTUsNyArMTc5NCw3
IEBAIHN0YXRpYyBpbnQgbm9wX3ZpcnR1YWxfZW5naW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRl
ICppOTE1LAogCQlwcmltZSwgZGl2NjRfdTY0KGt0aW1lX3RvX25zKHRpbWVzWzFdKSwgcHJpbWUp
KTsKIAogb3V0OgotCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkK
KwlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJCWVyciA9IC1FSU87CiAKIAlmb3IgKG5jID0g
MDsgbmMgPCBuY3R4OyBuYysrKSB7CkBAIC0xOTQwLDcgKzE5MzksNyBAQCBzdGF0aWMgaW50IG1h
c2tfdmlydHVhbF9lbmdpbmUoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJCWdvdG8g
b3V0OwogCiBvdXQ6Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQp
KQorCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJZXJyID0gLUVJTzsKIAogCWZvciAobiA9
IDA7IG4gPCBuc2libGluZzsgbisrKQpAQCAtMjExOCw3ICsyMTE3LDcgQEAgc3RhdGljIGludCBi
b25kX3ZpcnR1YWxfZW5naW5lKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LAogb3V0Ogog
CWZvciAobiA9IDA7ICFJU19FUlIocnFbbl0pOyBuKyspCiAJCWk5MTVfcmVxdWVzdF9wdXQocnFb
bl0pOwotCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwlpZiAo
aWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJCWVyciA9IC1FSU87CiAKIAlrZXJuZWxfY29udGV4dF9j
bG9zZShjdHgpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
dGltZWxpbmUuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3RpbWVsaW5lLmMK
aW5kZXggMzIxNDgxNDAzMTY1Li4xNmFiZmFiZjA4YzcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X3RpbWVsaW5lLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ3Qvc2VsZnRlc3RfdGltZWxpbmUuYwpAQCAtNiw3ICs2LDcgQEAKIAogI2luY2x1ZGUgPGxp
bnV4L3ByaW1lX251bWJlcnMuaD4KIAotI2luY2x1ZGUgImdlbS9pOTE1X2dlbV9wbS5oIgorI2lu
Y2x1ZGUgImludGVsX2VuZ2luZV9wbS5oIgogI2luY2x1ZGUgImludGVsX2d0LmgiCiAKICNpbmNs
dWRlICIuLi9zZWxmdGVzdHMvaTkxNV9yYW5kb20uaCIKQEAgLTEzNiw3ICsxMzYsNiBAQCBzdGF0
aWMgaW50IG1vY2tfaHdzcF9mcmVlbGlzdCh2b2lkICphcmcpCiAJCWdvdG8gZXJyX3B1dDsKIAl9
CiAKLQltdXRleF9sb2NrKCZzdGF0ZS5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlmb3IgKHAg
PSBwaGFzZXM7IHAtPm5hbWU7IHArKykgewogCQlwcl9kZWJ1ZygiJXMoJXMpXG4iLCBfX2Z1bmNf
XywgcC0+bmFtZSk7CiAJCWZvcl9lYWNoX3ByaW1lX251bWJlcl9mcm9tKG5hLCAxLCAyICogQ0FD
SEVMSU5FU19QRVJfUEFHRSkgewpAQCAtMTQ5LDcgKzE0OCw2IEBAIHN0YXRpYyBpbnQgbW9ja19o
d3NwX2ZyZWVsaXN0KHZvaWQgKmFyZykKIG91dDoKIAlmb3IgKG5hID0gMDsgbmEgPCBzdGF0ZS5t
YXg7IG5hKyspCiAJCV9fbW9ja19od3NwX3JlY29yZCgmc3RhdGUsIG5hLCBOVUxMKTsKLQltdXRl
eF91bmxvY2soJnN0YXRlLmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWtmcmVlKHN0YXRlLmhp
c3RvcnkpOwogZXJyX3B1dDoKIAlkcm1fZGV2X3B1dCgmc3RhdGUuaTkxNS0+ZHJtKTsKQEAgLTQ0
OSw4ICs0NDcsNiBAQCB0bF93cml0ZShzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsLCBzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUsIHUzMiB2YWx1ZSkKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0
ICpycTsKIAlpbnQgZXJyOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmdGwtPmd0LT5pOTE1LT5k
cm0uc3RydWN0X211dGV4KTsgLyogbGF6eSBycSByZWZzICovCi0KIAllcnIgPSBpbnRlbF90aW1l
bGluZV9waW4odGwpOwogCWlmIChlcnIpIHsKIAkJcnEgPSBFUlJfUFRSKGVycik7CkBAIC00NjEs
MTAgKzQ1NywxNCBAQCB0bF93cml0ZShzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsLCBzdHJ1Y3Qg
aW50ZWxfZW5naW5lX2NzICplbmdpbmUsIHUzMiB2YWx1ZSkKIAlpZiAoSVNfRVJSKHJxKSkKIAkJ
Z290byBvdXRfdW5waW47CiAKKwlpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKKwogCWVyciA9IGVtaXRf
Z2d0dF9zdG9yZV9kdyhycSwgdGwtPmh3c3Bfb2Zmc2V0LCB2YWx1ZSk7CiAJaTkxNV9yZXF1ZXN0
X2FkZChycSk7Ci0JaWYgKGVycikKKwlpZiAoZXJyKSB7CisJCWk5MTVfcmVxdWVzdF9wdXQocnEp
OwogCQlycSA9IEVSUl9QVFIoZXJyKTsKKwl9CiAKIG91dF91bnBpbjoKIAlpbnRlbF90aW1lbGlu
ZV91bnBpbih0bCk7CkBAIC01MDAsNyArNTAwLDYgQEAgc3RhdGljIGludCBsaXZlX2h3c3BfZW5n
aW5lKHZvaWQgKmFyZykKIAlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKip0aW1lbGluZXM7CiAJc3Ry
dWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwot
CWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCXVuc2lnbmVkIGxvbmcgY291bnQsIG47CiAJaW50
IGVyciA9IDA7CiAKQEAgLTUxNSwxNCArNTE0LDEzIEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX2Vu
Z2luZSh2b2lkICphcmcpCiAJaWYgKCF0aW1lbGluZXMpCiAJCXJldHVybiAtRU5PTUVNOwogCi0J
bXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1
bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKLQogCWNvdW50ID0gMDsKIAlmb3JfZWFj
aF9lbmdpbmUoZW5naW5lLCBpOTE1LCBpZCkgewogCQlpZiAoIWludGVsX2VuZ2luZV9jYW5fc3Rv
cmVfZHdvcmQoZW5naW5lKSkKIAkJCWNvbnRpbnVlOwogCisJCWludGVsX2VuZ2luZV9wbV9nZXQo
ZW5naW5lKTsKKwogCQlmb3IgKG4gPSAwOyBuIDwgTlVNX1RJTUVMSU5FUzsgbisrKSB7CiAJCQlz
dHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsOwogCQkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CkBA
IC01MzAsMjIgKzUyOCwyNiBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF9lbmdpbmUodm9pZCAqYXJn
KQogCQkJdGwgPSBjaGVja2VkX2ludGVsX3RpbWVsaW5lX2NyZWF0ZShpOTE1KTsKIAkJCWlmIChJ
U19FUlIodGwpKSB7CiAJCQkJZXJyID0gUFRSX0VSUih0bCk7Ci0JCQkJZ290byBvdXQ7CisJCQkJ
YnJlYWs7CiAJCQl9CiAKIAkJCXJxID0gdGxfd3JpdGUodGwsIGVuZ2luZSwgY291bnQpOwogCQkJ
aWYgKElTX0VSUihycSkpIHsKIAkJCQlpbnRlbF90aW1lbGluZV9wdXQodGwpOwogCQkJCWVyciA9
IFBUUl9FUlIocnEpOwotCQkJCWdvdG8gb3V0OworCQkJCWJyZWFrOwogCQkJfQogCiAJCQl0aW1l
bGluZXNbY291bnQrK10gPSB0bDsKKwkJCWk5MTVfcmVxdWVzdF9wdXQocnEpOwogCQl9CisKKwkJ
aW50ZWxfZW5naW5lX3BtX3B1dChlbmdpbmUpOworCQlpZiAoZXJyKQorCQkJYnJlYWs7CiAJfQog
Ci1vdXQ6Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQorCWlm
IChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJZXJyID0gLUVJTzsKIAogCWZvciAobiA9IDA7IG4g
PCBjb3VudDsgbisrKSB7CkBAIC01NTksMTEgKzU2MSw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3Nw
X2VuZ2luZSh2b2lkICphcmcpCiAJCWludGVsX3RpbWVsaW5lX3B1dCh0bCk7CiAJfQogCi0JaW50
ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4X3Vu
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlrdmZyZWUodGltZWxpbmVzKTsKLQog
CXJldHVybiBlcnI7CiAjdW5kZWYgTlVNX1RJTUVMSU5FUwogfQpAQCAtNTc1LDcgKzU3Myw2IEBA
IHN0YXRpYyBpbnQgbGl2ZV9od3NwX2FsdGVybmF0ZSh2b2lkICphcmcpCiAJc3RydWN0IGludGVs
X3RpbWVsaW5lICoqdGltZWxpbmVzOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsK
IAllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKLQlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZjsKIAl1
bnNpZ25lZCBsb25nIGNvdW50LCBuOwogCWludCBlcnIgPSAwOwogCkBAIC01OTEsOSArNTg4LDYg
QEAgc3RhdGljIGludCBsaXZlX2h3c3BfYWx0ZXJuYXRlKHZvaWQgKmFyZykKIAlpZiAoIXRpbWVs
aW5lcykKIAkJcmV0dXJuIC1FTk9NRU07CiAKLQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVf
cG0pOwotCiAJY291bnQgPSAwOwogCWZvciAobiA9IDA7IG4gPCBOVU1fVElNRUxJTkVTOyBuKysp
IHsKIAkJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKQEAgLTYwNSwxMSArNTk5
LDE0IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX2FsdGVybmF0ZSh2b2lkICphcmcpCiAKIAkJCXRs
ID0gY2hlY2tlZF9pbnRlbF90aW1lbGluZV9jcmVhdGUoaTkxNSk7CiAJCQlpZiAoSVNfRVJSKHRs
KSkgeworCQkJCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKIAkJCQllcnIgPSBQVFJfRVJS
KHRsKTsKIAkJCQlnb3RvIG91dDsKIAkJCX0KIAorCQkJaW50ZWxfZW5naW5lX3BtX2dldChlbmdp
bmUpOwogCQkJcnEgPSB0bF93cml0ZSh0bCwgZW5naW5lLCBjb3VudCk7CisJCQlpbnRlbF9lbmdp
bmVfcG1fcHV0KGVuZ2luZSk7CiAJCQlpZiAoSVNfRVJSKHJxKSkgewogCQkJCWludGVsX3RpbWVs
aW5lX3B1dCh0bCk7CiAJCQkJZXJyID0gUFRSX0VSUihycSk7CkBAIC02MTcsMTEgKzYxNCwxMiBA
QCBzdGF0aWMgaW50IGxpdmVfaHdzcF9hbHRlcm5hdGUodm9pZCAqYXJnKQogCQkJfQogCiAJCQl0
aW1lbGluZXNbY291bnQrK10gPSB0bDsKKwkJCWk5MTVfcmVxdWVzdF9wdXQocnEpOwogCQl9CiAJ
fQogCiBvdXQ6Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQor
CWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJZXJyID0gLUVJTzsKIAogCWZvciAobiA9IDA7
IG4gPCBjb3VudDsgbisrKSB7CkBAIC02MzUsMTEgKzYzMyw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9o
d3NwX2FsdGVybmF0ZSh2b2lkICphcmcpCiAJCWludGVsX3RpbWVsaW5lX3B1dCh0bCk7CiAJfQog
Ci0JaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlrdmZyZWUodGltZWxpbmVz
KTsKLQogCXJldHVybiBlcnI7CiAjdW5kZWYgTlVNX1RJTUVMSU5FUwogfQpAQCAtNjUwLDcgKzY0
NCw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX3dyYXAodm9pZCAqYXJnKQogCXN0cnVjdCBpbnRl
bF9lbmdpbmVfY3MgKmVuZ2luZTsKIAlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsOwogCWVudW0g
aW50ZWxfZW5naW5lX2lkIGlkOwotCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCWludCBlcnIg
PSAwOwogCiAJLyoKQEAgLTY1OCwxNCArNjUxLDEwIEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX3dy
YXAodm9pZCAqYXJnKQogCSAqIGZvcmVpZ24gR1BVIHJlZmVyZW5jZXMuCiAJICovCiAKLQltdXRl
eF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVudGlt
ZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCiAJdGwgPSBpbnRlbF90aW1lbGluZV9jcmVh
dGUoJmk5MTUtPmd0LCBOVUxMKTsKLQlpZiAoSVNfRVJSKHRsKSkgewotCQllcnIgPSBQVFJfRVJS
KHRsKTsKLQkJZ290byBvdXRfcnBtOwotCX0KKwlpZiAoSVNfRVJSKHRsKSkKKwkJcmV0dXJuIFBU
Ul9FUlIodGwpOworCiAJaWYgKCF0bC0+aGFzX2luaXRpYWxfYnJlYWRjcnVtYiB8fCAhdGwtPmh3
c3BfY2FjaGVsaW5lKQogCQlnb3RvIG91dF9mcmVlOwogCkBAIC02ODEsNyArNjcwLDkgQEAgc3Rh
dGljIGludCBsaXZlX2h3c3Bfd3JhcCh2b2lkICphcmcpCiAJCWlmICghaW50ZWxfZW5naW5lX2Nh
bl9zdG9yZV9kd29yZChlbmdpbmUpKQogCQkJY29udGludWU7CiAKKwkJaW50ZWxfZW5naW5lX3Bt
X2dldChlbmdpbmUpOwogCQlycSA9IGk5MTVfcmVxdWVzdF9jcmVhdGUoZW5naW5lLT5rZXJuZWxf
Y29udGV4dCk7CisJCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKIAkJaWYgKElTX0VSUihy
cSkpIHsKIAkJCWVyciA9IFBUUl9FUlIocnEpOwogCQkJZ290byBvdXQ7CkBAIC03NDcsMTYgKzcz
OCwxMiBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF93cmFwKHZvaWQgKmFyZykKIAl9CiAKIG91dDoK
LQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJaWYgKGlndF9m
bHVzaF90ZXN0KGk5MTUpKQogCQllcnIgPSAtRUlPOwogCiAJaW50ZWxfdGltZWxpbmVfdW5waW4o
dGwpOwogb3V0X2ZyZWU6CiAJaW50ZWxfdGltZWxpbmVfcHV0KHRsKTsKLW91dF9ycG06Ci0JaW50
ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4X3Vu
bG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0KIAlyZXR1cm4gZXJyOwogfQogCkBAIC03
NjUsNyArNzUyLDYgQEAgc3RhdGljIGludCBsaXZlX2h3c3BfcmVjeWNsZSh2b2lkICphcmcpCiAJ
c3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CiAJc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwotCWludGVsX3dha2VyZWZf
dCB3YWtlcmVmOwogCXVuc2lnbmVkIGxvbmcgY291bnQ7CiAJaW50IGVyciA9IDA7CiAKQEAgLTc3
NSw5ICs3NjEsNiBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF9yZWN5Y2xlKHZvaWQgKmFyZykKIAkg
KiB3YW50IHRvIGNvbmZ1c2Ugb3Vyc2VsdmVzIG9yIHRoZSBHUFUuCiAJICovCiAKLQltdXRleF9s
b2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxfcnVudGltZV9w
bV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCiAJY291bnQgPSAwOwogCWZvcl9lYWNoX2VuZ2lu
ZShlbmdpbmUsIGk5MTUsIGlkKSB7CiAJCUlHVF9USU1FT1VUKGVuZF90aW1lKTsKQEAgLTc4NSw2
ICs3NjgsOCBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF9yZWN5Y2xlKHZvaWQgKmFyZykKIAkJaWYg
KCFpbnRlbF9lbmdpbmVfY2FuX3N0b3JlX2R3b3JkKGVuZ2luZSkpCiAJCQljb250aW51ZTsKIAor
CQlpbnRlbF9lbmdpbmVfcG1fZ2V0KGVuZ2luZSk7CisKIAkJZG8gewogCQkJc3RydWN0IGludGVs
X3RpbWVsaW5lICp0bDsKIAkJCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxOwpAQCAtNzkyLDIxICs3
NzcsMjIgQEAgc3RhdGljIGludCBsaXZlX2h3c3BfcmVjeWNsZSh2b2lkICphcmcpCiAJCQl0bCA9
IGNoZWNrZWRfaW50ZWxfdGltZWxpbmVfY3JlYXRlKGk5MTUpOwogCQkJaWYgKElTX0VSUih0bCkp
IHsKIAkJCQllcnIgPSBQVFJfRVJSKHRsKTsKLQkJCQlnb3RvIG91dDsKKwkJCQlicmVhazsKIAkJ
CX0KIAogCQkJcnEgPSB0bF93cml0ZSh0bCwgZW5naW5lLCBjb3VudCk7CiAJCQlpZiAoSVNfRVJS
KHJxKSkgewogCQkJCWludGVsX3RpbWVsaW5lX3B1dCh0bCk7CiAJCQkJZXJyID0gUFRSX0VSUihy
cSk7Ci0JCQkJZ290byBvdXQ7CisJCQkJYnJlYWs7CiAJCQl9CiAKIAkJCWlmIChpOTE1X3JlcXVl
c3Rfd2FpdChycSwgMCwgSFogLyA1KSA8IDApIHsKIAkJCQlwcl9lcnIoIldhaXQgZm9yIHRpbWVs
aW5lIHdyaXRlcyB0aW1lZCBvdXQhXG4iKTsKKwkJCQlpOTE1X3JlcXVlc3RfcHV0KHJxKTsKIAkJ
CQlpbnRlbF90aW1lbGluZV9wdXQodGwpOwogCQkJCWVyciA9IC1FSU87Ci0JCQkJZ290byBvdXQ7
CisJCQkJYnJlYWs7CiAJCQl9CiAKIAkJCWlmICgqdGwtPmh3c3Bfc2Vxbm8gIT0gY291bnQpIHsK
QEAgLTgxNSwxNyArODAxLDE4IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX3JlY3ljbGUodm9pZCAq
YXJnKQogCQkJCWVyciA9IC1FSU5WQUw7CiAJCQl9CiAKKwkJCWk5MTVfcmVxdWVzdF9wdXQocnEp
OwogCQkJaW50ZWxfdGltZWxpbmVfcHV0KHRsKTsKIAkJCWNvdW50Kys7CiAKIAkJCWlmIChlcnIp
Ci0JCQkJZ290byBvdXQ7CisJCQkJYnJlYWs7CiAJCX0gd2hpbGUgKCFfX2lndF90aW1lb3V0KGVu
ZF90aW1lLCBOVUxMKSk7Ci0JfQogCi1vdXQ6Ci0JaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUt
PnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CisJCWludGVsX2VuZ2luZV9wbV9wdXQoZW5naW5lKTsKKwkJaWYgKGVycikKKwkJCWJy
ZWFrOworCX0KIAogCXJldHVybiBlcnI7CiB9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qv
c2VsZnRlc3Rfd29ya2Fyb3VuZHMuYwppbmRleCA5OTlhOThmMDA0OTQuLjA2MzUxZmVmYmJmMyAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rfd29ya2Fyb3VuZHMu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF93b3JrYXJvdW5kcy5jCkBA
IC02NzYsNyArNjc2LDcgQEAgc3RhdGljIGludCBjaGVja19kaXJ0eV93aGl0ZWxpc3Qoc3RydWN0
IGk5MTVfZ2VtX2NvbnRleHQgKmN0eCwKIAkJCWJyZWFrOwogCX0KIAotCWlmIChpZ3RfZmx1c2hf
dGVzdChjdHgtPmk5MTUsIEk5MTVfV0FJVF9MT0NLRUQpKQorCWlmIChpZ3RfZmx1c2hfdGVzdChj
dHgtPmk5MTUpKQogCQllcnIgPSAtRUlPOwogb3V0X2JhdGNoOgogCWk5MTVfdm1hX3VucGluX2Fu
ZF9yZWxlYXNlKCZiYXRjaCwgMCk7CkBAIC0xMDkwLDcgKzEwOTAsNyBAQCBzdGF0aWMgaW50IGxp
dmVfaXNvbGF0ZWRfd2hpdGVsaXN0KHZvaWQgKmFyZykKIAkJa2VybmVsX2NvbnRleHRfY2xvc2Uo
Y2xpZW50W2ldLmN0eCk7CiAJfQogCi0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVfV0FJ
VF9MT0NLRUQpKQorCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJZXJyID0gLUVJTzsKIAog
CXJldHVybiBlcnI7CkBAIC0xMjQ4LDcgKzEyNDgsNyBAQCBsaXZlX2VuZ2luZV9yZXNldF93b3Jr
YXJvdW5kcyh2b2lkICphcmcpCiAJaWd0X2dsb2JhbF9yZXNldF91bmxvY2soJmk5MTUtPmd0KTsK
IAlrZXJuZWxfY29udGV4dF9jbG9zZShjdHgpOwogCi0JaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkx
NV9XQUlUX0xPQ0tFRCk7CisJaWd0X2ZsdXNoX3Rlc3QoaTkxNSk7CiAKIAlyZXR1cm4gcmV0Owog
fQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYwppbmRleCBiNWI0NDlhODhjZjEuLjIwNDdm
MTcwZmJlNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kZWJ1Z2ZzLmMKQEAgLTM2MTgsNiArMzYx
OCw3IEBAIHN0YXRpYyBpbnQKIGk5MTVfZHJvcF9jYWNoZXNfc2V0KHZvaWQgKmRhdGEsIHU2NCB2
YWwpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBkYXRhOworCWludCByZXQ7
CiAKIAlEUk1fREVCVUcoIkRyb3BwaW5nIGNhY2hlczogMHglMDhsbHggWzB4JTA4bGx4XVxuIiwK
IAkJICB2YWwsIHZhbCAmIERST1BfQUxMKTsKQEAgLTM2MjcsNDAgKzM2MjgsMjEgQEAgaTkxNV9k
cm9wX2NhY2hlc19zZXQodm9pZCAqZGF0YSwgdTY0IHZhbCkKIAkJICAgICBJOTE1X0lETEVfRU5H
SU5FU19USU1FT1VUKSkKIAkJaW50ZWxfZ3Rfc2V0X3dlZGdlZCgmaTkxNS0+Z3QpOwogCi0JLyog
Tm8gbmVlZCB0byBjaGVjayBhbmQgd2FpdCBmb3IgZ3B1IHJlc2V0cywgb25seSBsaWJkcm0gYXV0
by1yZXN0YXJ0cwotCSAqIG9uIGlvY3RscyBvbiAtRUFHQUlOLiAqLwotCWlmICh2YWwgJiAoRFJP
UF9BQ1RJVkUgfCBEUk9QX0lETEUgfCBEUk9QX1JFVElSRSB8IERST1BfUkVTRVRfU0VRTk8pKSB7
Ci0JCWludCByZXQ7CisJaWYgKHZhbCAmIERST1BfUkVUSVJFKQorCQlpOTE1X3JldGlyZV9yZXF1
ZXN0cyhpOTE1KTsKIAotCQlyZXQgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOworCWlmICh2YWwgJiAoRFJPUF9JRExFIHwgRFJPUF9BQ1RJVkUpKSB7
CisJCXJldCA9IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoaTkxNSwKKwkJCQkJICAgICBJOTE1X1dB
SVRfSU5URVJSVVBUSUJMRSwKKwkJCQkJICAgICBNQVhfU0NIRURVTEVfVElNRU9VVCk7CiAJCWlm
IChyZXQpCiAJCQlyZXR1cm4gcmV0OworCX0KIAotCQkvKgotCQkgKiBUbyBmaW5pc2ggdGhlIGZs
dXNoIG9mIHRoZSBpZGxlX3dvcmtlciwgd2UgbXVzdCBjb21wbGV0ZQotCQkgKiB0aGUgc3dpdGNo
LXRvLWtlcm5lbC1jb250ZXh0LCB3aGljaCByZXF1aXJlcyBhIGRvdWJsZQotCQkgKiBwYXNzIHRo
cm91Z2ggd2FpdF9mb3JfaWRsZTogZmlyc3QgcXVldWVzIHRoZSBzd2l0Y2gsCi0JCSAqIHNlY29u
ZCB3YWl0cyBmb3IgdGhlIHN3aXRjaC4KLQkJICovCi0JCWlmIChyZXQgPT0gMCAmJiB2YWwgJiAo
RFJPUF9JRExFIHwgRFJPUF9BQ1RJVkUpKQotCQkJcmV0ID0gaTkxNV9nZW1fd2FpdF9mb3JfaWRs
ZShpOTE1LAotCQkJCQkJICAgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSB8Ci0JCQkJCQkgICAg
IEk5MTVfV0FJVF9MT0NLRUQsCi0JCQkJCQkgICAgIE1BWF9TQ0hFRFVMRV9USU1FT1VUKTsKLQot
CQlpZiAocmV0ID09IDAgJiYgdmFsICYgRFJPUF9JRExFKQotCQkJcmV0ID0gaTkxNV9nZW1fd2Fp
dF9mb3JfaWRsZShpOTE1LAotCQkJCQkJICAgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSB8Ci0J
CQkJCQkgICAgIEk5MTVfV0FJVF9MT0NLRUQsCi0JCQkJCQkgICAgIE1BWF9TQ0hFRFVMRV9USU1F
T1VUKTsKLQotCQlpZiAodmFsICYgRFJPUF9SRVRJUkUpCi0JCQlpOTE1X3JldGlyZV9yZXF1ZXN0
cyhpOTE1KTsKLQotCQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCi0J
CWlmIChyZXQgPT0gMCAmJiB2YWwgJiBEUk9QX0lETEUpCi0JCQlyZXQgPSBpbnRlbF9ndF9wbV93
YWl0X2Zvcl9pZGxlKCZpOTE1LT5ndCk7CisJaWYgKHZhbCAmIERST1BfSURMRSkgeworCQlyZXQg
PSBpbnRlbF9ndF9wbV93YWl0X2Zvcl9pZGxlKCZpOTE1LT5ndCk7CisJCWlmIChyZXQpCisJCQly
ZXR1cm4gcmV0OwogCX0KIAogCWlmICh2YWwgJiBEUk9QX1JFU0VUX0FDVElWRSAmJiBpbnRlbF9n
dF90ZXJtaW5hbGx5X3dlZGdlZCgmaTkxNS0+Z3QpKQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKaW5k
ZXggYTg4ODQ5NTQ0YzhiLi40N2M1M2JiOWViODkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYwpA
QCAtOTQ1LDE5ICs5NDUsMTYgQEAgaW50IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsCiAJaWYgKCFpbnRlbF9ndF9wbV9pc19hd2FrZShndCkpCiAJ
CXJldHVybiAwOwogCi0JR0VNX1RSQUNFKCJmbGFncz0leCAoJXMpLCB0aW1lb3V0PSVsZCVzXG4i
LAotCQkgIGZsYWdzLCBmbGFncyAmIEk5MTVfV0FJVF9MT0NLRUQgPyAibG9ja2VkIiA6ICJ1bmxv
Y2tlZCIsCi0JCSAgdGltZW91dCwgdGltZW91dCA9PSBNQVhfU0NIRURVTEVfVElNRU9VVCA/ICIg
KGZvcmV2ZXIpIiA6ICIiKTsKLQotCXRpbWVvdXQgPSB3YWl0X2Zvcl90aW1lbGluZXMoZ3QsIGZs
YWdzLCB0aW1lb3V0KTsKLQlpZiAodGltZW91dCA8IDApCi0JCXJldHVybiB0aW1lb3V0OworCWRv
IHsKKwkJdGltZW91dCA9IHdhaXRfZm9yX3RpbWVsaW5lcyhndCwgZmxhZ3MsIHRpbWVvdXQpOwor
CQlpZiAodGltZW91dCA8IDApCisJCQlyZXR1cm4gdGltZW91dDsKIAotCWlmIChmbGFncyAmIEk5
MTVfV0FJVF9MT0NLRUQpIHsKLQkJbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7CisJCWNvbmRfcmVzY2hlZCgpOworCQlpZiAoc2lnbmFsX3BlbmRpbmcoY3VycmVu
dCkpCisJCQlyZXR1cm4gLUVJTlRSOwogCi0JCWk5MTVfcmV0aXJlX3JlcXVlc3RzKGk5MTUpOwot
CX0KKwl9IHdoaWxlIChpOTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1KSk7CiAKIAlyZXR1cm4gMDsK
IH0KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5oIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmgKaW5kZXggOTFhODg1YzM2YzZiLi42MjFm
YjMzY2RhMzAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5o
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5oCkBAIC0zMDgsMTAgKzMw
OCw5IEBAIGxvbmcgaTkxNV9yZXF1ZXN0X3dhaXQoc3RydWN0IGk5MTVfcmVxdWVzdCAqcnEsCiAJ
CSAgICAgICBsb25nIHRpbWVvdXQpCiAJX19hdHRyaWJ1dGVfXygobm9ubnVsbCgxKSkpOwogI2Rl
ZmluZSBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRQlCSVQoMCkKLSNkZWZpbmUgSTkxNV9XQUlUX0xP
Q0tFRAlCSVQoMSkgLyogc3RydWN0X211dGV4IGhlbGQsIGhhbmRsZSBHUFUgcmVzZXQgKi8KLSNk
ZWZpbmUgSTkxNV9XQUlUX1BSSU9SSVRZCUJJVCgyKSAvKiBzbWFsbCBwcmlvcml0eSBidW1wIGZv
ciB0aGUgcmVxdWVzdCAqLwotI2RlZmluZSBJOTE1X1dBSVRfQUxMCQlCSVQoMykgLyogdXNlZCBi
eSBpOTE1X2dlbV9vYmplY3Rfd2FpdCgpICovCi0jZGVmaW5lIEk5MTVfV0FJVF9GT1JfSURMRV9C
T09TVCBCSVQoNCkKKyNkZWZpbmUgSTkxNV9XQUlUX1BSSU9SSVRZCUJJVCgxKSAvKiBzbWFsbCBw
cmlvcml0eSBidW1wIGZvciB0aGUgcmVxdWVzdCAqLworI2RlZmluZSBJOTE1X1dBSVRfQUxMCQlC
SVQoMikgLyogdXNlZCBieSBpOTE1X2dlbV9vYmplY3Rfd2FpdCgpICovCisjZGVmaW5lIEk5MTVf
V0FJVF9GT1JfSURMRV9CT09TVCBCSVQoMykKIAogc3RhdGljIGlubGluZSBib29sIGk5MTVfcmVx
dWVzdF9zaWduYWxlZChjb25zdCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSkKIHsKZGlmZiAtLWdp
dCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2FjdGl2ZS5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfYWN0aXZlLmMKaW5kZXggMmNjNzFiY2Y4ODRm
Li4yNjgxOTJiNTYxM2IgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0
cy9pOTE1X2FjdGl2ZS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1
X2FjdGl2ZS5jCkBAIC0xNjIsMTAgKzE2Miw4IEBAIHN0YXRpYyBpbnQgbGl2ZV9hY3RpdmVfd2Fp
dCh2b2lkICphcmcpCiAKIAlfX2xpdmVfcHV0KGFjdGl2ZSk7CiAKLQltdXRleF9sb2NrKCZpOTE1
LT5kcm0uc3RydWN0X211dGV4KTsKLQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlU
X0xPQ0tFRCkpCisJaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUpKQogCQllcnIgPSAtRUlPOwotCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlyZXR1cm4gZXJyOwogfQpA
QCAtMTgzLDEwICsxODEsOCBAQCBzdGF0aWMgaW50IGxpdmVfYWN0aXZlX3JldGlyZSh2b2lkICph
cmcpCiAJCXJldHVybiBQVFJfRVJSKGFjdGl2ZSk7CiAKIAkvKiB3YWl0cyBmb3IgJiByZXRpcmVz
IGFsbCByZXF1ZXN0cyAqLwotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwot
CWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwlpZiAoaWd0X2Zs
dXNoX3Rlc3QoaTkxNSkpCiAJCWVyciA9IC1FSU87Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0u
c3RydWN0X211dGV4KTsKIAogCWlmICghUkVBRF9PTkNFKGFjdGl2ZS0+cmV0aXJlZCkpIHsKIAkJ
cHJfZXJyKCJpOTE1X2FjdGl2ZSBub3QgcmV0aXJlZCBhZnRlciBmbHVzaGluZyFcbiIpOwpkaWZm
IC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMg
Yi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZXZpY3QuYwppbmRleCA3
NWE0Njk1YjgyYmIuLjUyZDJkZjg0MzE0OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5
MTUvc2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2k5MTVfZ2VtX2V2aWN0LmMKQEAgLTUyMyw3ICs1MjMsNyBAQCBzdGF0aWMgaW50
IGlndF9ldmljdF9jb250ZXh0cyh2b2lkICphcmcpCiAKIAltdXRleF9sb2NrKCZpOTE1LT5nZ3R0
LnZtLm11dGV4KTsKIG91dF9sb2NrZWQ6Ci0JaWYgKGlndF9mbHVzaF90ZXN0KGk5MTUsIEk5MTVf
V0FJVF9MT0NLRUQpKQorCWlmIChpZ3RfZmx1c2hfdGVzdChpOTE1KSkKIAkJZXJyID0gLUVJTzsK
IAl3aGlsZSAocmVzZXJ2ZWQpIHsKIAkJc3RydWN0IHJlc2VydmVkICpuZXh0ID0gcmVzZXJ2ZWQt
Pm5leHQ7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9n
ZW1fZ3R0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMK
aW5kZXggMzczZmJkNThhMTdhLi45OTM5ZGQ0MGM2YTggMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9zZWxmdGVzdHMvaTkxNV9nZW1fZ3R0LmMKQEAgLTE3MDMsMTIgKzE3MDMsOCBAQCBpbnQg
aTkxNV9nZW1fZ3R0X21vY2tfc2VsZnRlc3RzKHZvaWQpCiAKIAllcnIgPSBpOTE1X3N1YnRlc3Rz
KHRlc3RzLCBnZ3R0KTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwog
CW1vY2tfZGV2aWNlX2ZsdXNoKGk5MTUpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVj
dF9tdXRleCk7Ci0KIAlpOTE1X2dlbV9kcmFpbl9mcmVlZF9vYmplY3RzKGk5MTUpOwotCiAJbW9j
a19maW5pX2dndHQoZ2d0dCk7CiAJa2ZyZWUoZ2d0dCk7CiBvdXRfcHV0OgpAQCAtMjAwMiw3ICsx
OTk4LDcgQEAgc3RhdGljIGludCBpZ3RfY3NfdGxiKHZvaWQgKmFyZykKIAkJfQogCX0KIGVuZDoK
LQlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSwgSTkxNV9XQUlUX0xPQ0tFRCkpCisJaWYgKGlndF9m
bHVzaF90ZXN0KGk5MTUpKQogCQllcnIgPSAtRUlPOwogCWk5MTVfZ2VtX2NvbnRleHRfdW5sb2Nr
X2VuZ2luZXMoY3R4KTsKIAlpOTE1X2dlbV9vYmplY3RfdW5waW5fbWFwKG91dCk7CmRpZmYgLS1n
aXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMgYi9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9yZXF1ZXN0LmMKaW5kZXggNmI1YjAzMDgx
ODgwLi5kMWVlMzg0YTMyNjAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9pOTE1X3JlcXVlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
aTkxNV9yZXF1ZXN0LmMKQEAgLTQxLDIxICs0MSwxNiBAQCBzdGF0aWMgaW50IGlndF9hZGRfcmVx
dWVzdCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7
CiAJc3RydWN0IGk5MTVfcmVxdWVzdCAqcmVxdWVzdDsKLQlpbnQgZXJyID0gLUVOT01FTTsKIAog
CS8qIEJhc2ljIHByZWxpbWluYXJ5IHRlc3QgdG8gY3JlYXRlIGEgcmVxdWVzdCBhbmQgbGV0IGl0
IGxvb3NlISAqLwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmVx
dWVzdCA9IG1vY2tfcmVxdWVzdChpOTE1LT5lbmdpbmVbUkNTMF0tPmtlcm5lbF9jb250ZXh0LCBI
WiAvIDEwKTsKIAlpZiAoIXJlcXVlc3QpCi0JCWdvdG8gb3V0X3VubG9jazsKKwkJcmV0dXJuIC1F
Tk9NRU07CiAKIAlpOTE1X3JlcXVlc3RfYWRkKHJlcXVlc3QpOwogCi0JZXJyID0gMDsKLW91dF91
bmxvY2s6Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQlyZXR1cm4g
ZXJyOworCXJldHVybiAwOwogfQogCiBzdGF0aWMgaW50IGlndF93YWl0X3JlcXVlc3Qodm9pZCAq
YXJnKQpAQCAtNjcsMTIgKzYyLDEwIEBAIHN0YXRpYyBpbnQgaWd0X3dhaXRfcmVxdWVzdCh2b2lk
ICphcmcpCiAKIAkvKiBTdWJtaXQgYSByZXF1ZXN0LCB0aGVuIHdhaXQgdXBvbiBpdCAqLwogCi0J
bXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmVxdWVzdCA9IG1vY2tfcmVx
dWVzdChpOTE1LT5lbmdpbmVbUkNTMF0tPmtlcm5lbF9jb250ZXh0LCBUKTsKLQlpZiAoIXJlcXVl
c3QpIHsKLQkJZXJyID0gLUVOT01FTTsKLQkJZ290byBvdXRfdW5sb2NrOwotCX0KKwlpZiAoIXJl
cXVlc3QpCisJCXJldHVybiAtRU5PTUVNOworCiAJaTkxNV9yZXF1ZXN0X2dldChyZXF1ZXN0KTsK
IAogCWlmIChpOTE1X3JlcXVlc3Rfd2FpdChyZXF1ZXN0LCAwLCAwKSAhPSAtRVRJTUUpIHsKQEAg
LTEyNSw5ICsxMTgsNyBAQCBzdGF0aWMgaW50IGlndF93YWl0X3JlcXVlc3Qodm9pZCAqYXJnKQog
CWVyciA9IDA7CiBvdXRfcmVxdWVzdDoKIAlpOTE1X3JlcXVlc3RfcHV0KHJlcXVlc3QpOwotb3V0
X3VubG9jazoKIAltb2NrX2RldmljZV9mbHVzaChpOTE1KTsKLQltdXRleF91bmxvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CiB9CiAKQEAgLTE0MCw1MiArMTMxLDQ1
IEBAIHN0YXRpYyBpbnQgaWd0X2ZlbmNlX3dhaXQodm9pZCAqYXJnKQogCiAJLyogU3VibWl0IGEg
cmVxdWVzdCwgdHJlYXQgaXQgYXMgYSBmZW5jZSBhbmQgd2FpdCB1cG9uIGl0ICovCiAKLQltdXRl
eF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAlyZXF1ZXN0ID0gbW9ja19yZXF1ZXN0
KGk5MTUtPmVuZ2luZVtSQ1MwXS0+a2VybmVsX2NvbnRleHQsIFQpOwotCWlmICghcmVxdWVzdCkg
ewotCQllcnIgPSAtRU5PTUVNOwotCQlnb3RvIG91dF9sb2NrZWQ7Ci0JfQorCWlmICghcmVxdWVz
dCkKKwkJcmV0dXJuIC1FTk9NRU07CiAKIAlpZiAoZG1hX2ZlbmNlX3dhaXRfdGltZW91dCgmcmVx
dWVzdC0+ZmVuY2UsIGZhbHNlLCBUKSAhPSAtRVRJTUUpIHsKIAkJcHJfZXJyKCJmZW5jZSB3YWl0
IHN1Y2Nlc3MgYmVmb3JlIHN1Ym1pdCAoZXhwZWN0ZWQgdGltZW91dCkhXG4iKTsKLQkJZ290byBv
dXRfbG9ja2VkOworCQlnb3RvIG91dDsKIAl9CiAKIAlpOTE1X3JlcXVlc3RfYWRkKHJlcXVlc3Qp
OwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlpZiAoZG1hX2Zl
bmNlX2lzX3NpZ25hbGVkKCZyZXF1ZXN0LT5mZW5jZSkpIHsKIAkJcHJfZXJyKCJmZW5jZSBzaWdu
YWxlZCBpbW1lZGlhdGVseSFcbiIpOwotCQlnb3RvIG91dF9kZXZpY2U7CisJCWdvdG8gb3V0Owog
CX0KIAogCWlmIChkbWFfZmVuY2Vfd2FpdF90aW1lb3V0KCZyZXF1ZXN0LT5mZW5jZSwgZmFsc2Us
IFQgLyAyKSAhPSAtRVRJTUUpIHsKIAkJcHJfZXJyKCJmZW5jZSB3YWl0IHN1Y2Nlc3MgYWZ0ZXIg
c3VibWl0IChleHBlY3RlZCB0aW1lb3V0KSFcbiIpOwotCQlnb3RvIG91dF9kZXZpY2U7CisJCWdv
dG8gb3V0OwogCX0KIAogCWlmIChkbWFfZmVuY2Vfd2FpdF90aW1lb3V0KCZyZXF1ZXN0LT5mZW5j
ZSwgZmFsc2UsIFQpIDw9IDApIHsKIAkJcHJfZXJyKCJmZW5jZSB3YWl0IHRpbWVkIG91dCAoZXhw
ZWN0ZWQgc3VjY2VzcykhXG4iKTsKLQkJZ290byBvdXRfZGV2aWNlOworCQlnb3RvIG91dDsKIAl9
CiAKIAlpZiAoIWRtYV9mZW5jZV9pc19zaWduYWxlZCgmcmVxdWVzdC0+ZmVuY2UpKSB7CiAJCXBy
X2VycigiZmVuY2UgdW5zaWduYWxlZCBhZnRlciB3YWl0aW5nIVxuIik7Ci0JCWdvdG8gb3V0X2Rl
dmljZTsKKwkJZ290byBvdXQ7CiAJfQogCiAJaWYgKGRtYV9mZW5jZV93YWl0X3RpbWVvdXQoJnJl
cXVlc3QtPmZlbmNlLCBmYWxzZSwgVCkgPD0gMCkgewogCQlwcl9lcnIoImZlbmNlIHdhaXQgdGlt
ZWQgb3V0IHdoZW4gY29tcGxldGUgKGV4cGVjdGVkIHN1Y2Nlc3MpIVxuIik7Ci0JCWdvdG8gb3V0
X2RldmljZTsKKwkJZ290byBvdXQ7CiAJfQogCiAJZXJyID0gMDsKLW91dF9kZXZpY2U6Ci0JbXV0
ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci1vdXRfbG9ja2VkOgorb3V0OgogCW1v
Y2tfZGV2aWNlX2ZsdXNoKGk5MTUpOwotCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMTk5LDYgKzE4Myw4IEBAIHN0YXRpYyBpbnQg
aWd0X3JlcXVlc3RfcmV3aW5kKHZvaWQgKmFyZykKIAogCW11dGV4X2xvY2soJmk5MTUtPmRybS5z
dHJ1Y3RfbXV0ZXgpOwogCWN0eFswXSA9IG1vY2tfY29udGV4dChpOTE1LCAiQSIpOworCW11dGV4
X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisKIAljZSA9IGk5MTVfZ2VtX2NvbnRl
eHRfZ2V0X2VuZ2luZShjdHhbMF0sIFJDUzApOwogCUdFTV9CVUdfT04oSVNfRVJSKGNlKSk7CiAJ
cmVxdWVzdCA9IG1vY2tfcmVxdWVzdChjZSwgMiAqIEhaKTsKQEAgLTIxMSw3ICsxOTcsMTAgQEAg
c3RhdGljIGludCBpZ3RfcmVxdWVzdF9yZXdpbmQodm9pZCAqYXJnKQogCWk5MTVfcmVxdWVzdF9n
ZXQocmVxdWVzdCk7CiAJaTkxNV9yZXF1ZXN0X2FkZChyZXF1ZXN0KTsKIAorCW11dGV4X2xvY2so
Jmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWN0eFsxXSA9IG1vY2tfY29udGV4dChpOTE1LCAi
QiIpOworCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CisKIAljZSA9IGk5
MTVfZ2VtX2NvbnRleHRfZ2V0X2VuZ2luZShjdHhbMV0sIFJDUzApOwogCUdFTV9CVUdfT04oSVNf
RVJSKGNlKSk7CiAJdmlwID0gbW9ja19yZXF1ZXN0KGNlLCAwKTsKQEAgLTIzMyw3ICsyMjIsNiBA
QCBzdGF0aWMgaW50IGlndF9yZXF1ZXN0X3Jld2luZCh2b2lkICphcmcpCiAJcmVxdWVzdC0+ZW5n
aW5lLT5zdWJtaXRfcmVxdWVzdChyZXF1ZXN0KTsKIAlyY3VfcmVhZF91bmxvY2soKTsKIAotCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAKIAlpZiAoaTkxNV9yZXF1ZXN0
X3dhaXQodmlwLCAwLCBIWikgPT0gLUVUSU1FKSB7CiAJCXByX2VycigidGltZWQgb3V0IHdhaXRp
bmcgZm9yIGhpZ2ggcHJpb3JpdHkgcmVxdWVzdFxuIik7CkBAIC0yNDgsMTQgKzIzNiwxMiBAQCBz
dGF0aWMgaW50IGlndF9yZXF1ZXN0X3Jld2luZCh2b2lkICphcmcpCiAJZXJyID0gMDsKIGVycjoK
IAlpOTE1X3JlcXVlc3RfcHV0KHZpcCk7Ci0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9t
dXRleCk7CiBlcnJfY29udGV4dF8xOgogCW1vY2tfY29udGV4dF9jbG9zZShjdHhbMV0pOwogCWk5
MTVfcmVxdWVzdF9wdXQocmVxdWVzdCk7CiBlcnJfY29udGV4dF8wOgogCW1vY2tfY29udGV4dF9j
bG9zZShjdHhbMF0pOwogCW1vY2tfZGV2aWNlX2ZsdXNoKGk5MTUpOwotCW11dGV4X3VubG9jaygm
aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAtMjgyLDcgKzI2
OCw2IEBAIF9fbGl2ZV9yZXF1ZXN0X2FsbG9jKHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKIHN0
YXRpYyBpbnQgX19pZ3RfYnJlYWRjcnVtYnNfc21va2V0ZXN0KHZvaWQgKmFyZykKIHsKIAlzdHJ1
Y3Qgc21va2V0ZXN0ICp0ID0gYXJnOwotCXN0cnVjdCBtdXRleCAqIGNvbnN0IEJLTCA9ICZ0LT5l
bmdpbmUtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXg7CiAJY29uc3QgdW5zaWduZWQgaW50IG1heF9i
YXRjaCA9IG1pbih0LT5uY29udGV4dHMsIHQtPm1heF9iYXRjaCkgLSAxOwogCWNvbnN0IHVuc2ln
bmVkIGludCB0b3RhbCA9IDQgKiB0LT5uY29udGV4dHMgKyAxOwogCXVuc2lnbmVkIGludCBudW1f
d2FpdHMgPSAwLCBudW1fZmVuY2VzID0gMDsKQEAgLTMzNywxNCArMzIyLDExIEBAIHN0YXRpYyBp
bnQgX19pZ3RfYnJlYWRjcnVtYnNfc21va2V0ZXN0KHZvaWQgKmFyZykKIAkJCXN0cnVjdCBpOTE1
X3JlcXVlc3QgKnJxOwogCQkJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOwogCi0JCQltdXRleF9s
b2NrKEJLTCk7Ci0KIAkJCWNlID0gaTkxNV9nZW1fY29udGV4dF9nZXRfZW5naW5lKGN0eCwgdC0+
ZW5naW5lLT5sZWdhY3lfaWR4KTsKIAkJCUdFTV9CVUdfT04oSVNfRVJSKGNlKSk7CiAJCQlycSA9
IHQtPnJlcXVlc3RfYWxsb2MoY2UpOwogCQkJaW50ZWxfY29udGV4dF9wdXQoY2UpOwogCQkJaWYg
KElTX0VSUihycSkpIHsKLQkJCQltdXRleF91bmxvY2soQktMKTsKIAkJCQllcnIgPSBQVFJfRVJS
KHJxKTsKIAkJCQljb3VudCA9IG47CiAJCQkJYnJlYWs7CkBAIC0zNTcsOCArMzM5LDYgQEAgc3Rh
dGljIGludCBfX2lndF9icmVhZGNydW1ic19zbW9rZXRlc3Qodm9pZCAqYXJnKQogCQkJcmVxdWVz
dHNbbl0gPSBpOTE1X3JlcXVlc3RfZ2V0KHJxKTsKIAkJCWk5MTVfcmVxdWVzdF9hZGQocnEpOwog
Ci0JCQltdXRleF91bmxvY2soQktMKTsKLQogCQkJaWYgKGVyciA+PSAwKQogCQkJCWVyciA9IGk5
MTVfc3dfZmVuY2VfYXdhaXRfZG1hX2ZlbmNlKHdhaXQsCiAJCQkJCQkJCSAgICAmcnEtPmZlbmNl
LApAQCAtNDU3LDE1ICs0MzcsMTUgQEAgc3RhdGljIGludCBtb2NrX2JyZWFkY3J1bWJzX3Ntb2tl
dGVzdCh2b2lkICphcmcpCiAJCWdvdG8gb3V0X3RocmVhZHM7CiAJfQogCi0JbXV0ZXhfbG9jaygm
dC5lbmdpbmUtPmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWZvciAobiA9IDA7IG4gPCB0Lm5j
b250ZXh0czsgbisrKSB7CisJCW11dGV4X2xvY2soJnQuZW5naW5lLT5pOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKIAkJdC5jb250ZXh0c1tuXSA9IG1vY2tfY29udGV4dCh0LmVuZ2luZS0+aTkxNSwg
Im1vY2siKTsKKwkJbXV0ZXhfdW5sb2NrKCZ0LmVuZ2luZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRl
eCk7CiAJCWlmICghdC5jb250ZXh0c1tuXSkgewogCQkJcmV0ID0gLUVOT01FTTsKIAkJCWdvdG8g
b3V0X2NvbnRleHRzOwogCQl9CiAJfQotCW11dGV4X3VubG9jaygmdC5lbmdpbmUtPmk5MTUtPmRy
bS5zdHJ1Y3RfbXV0ZXgpOwogCiAJZm9yIChuID0gMDsgbiA8IG5jcHVzOyBuKyspIHsKIAkJdGhy
ZWFkc1tuXSA9IGt0aHJlYWRfcnVuKF9faWd0X2JyZWFkY3J1bWJzX3Ntb2tldGVzdCwKQEAgLTQ5
NSwxOCArNDc1LDE1IEBAIHN0YXRpYyBpbnQgbW9ja19icmVhZGNydW1ic19zbW9rZXRlc3Qodm9p
ZCAqYXJnKQogCQlhdG9taWNfbG9uZ19yZWFkKCZ0Lm51bV9mZW5jZXMpLAogCQluY3B1cyk7CiAK
LQltdXRleF9sb2NrKCZ0LmVuZ2luZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiBvdXRfY29u
dGV4dHM6CiAJZm9yIChuID0gMDsgbiA8IHQubmNvbnRleHRzOyBuKyspIHsKIAkJaWYgKCF0LmNv
bnRleHRzW25dKQogCQkJYnJlYWs7CiAJCW1vY2tfY29udGV4dF9jbG9zZSh0LmNvbnRleHRzW25d
KTsKIAl9Ci0JbXV0ZXhfdW5sb2NrKCZ0LmVuZ2luZS0+aTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiAJa2ZyZWUodC5jb250ZXh0cyk7CiBvdXRfdGhyZWFkczoKIAlrZnJlZSh0aHJlYWRzKTsKLQog
CXJldHVybiByZXQ7CiB9CiAKQEAgLTUzOSw3ICs1MTYsNiBAQCBzdGF0aWMgaW50IGxpdmVfbm9w
X3JlcXVlc3Qodm9pZCAqYXJnKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
YXJnOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZTsKLQlpbnRlbF93YWtlcmVmX3Qg
d2FrZXJlZjsKIAlzdHJ1Y3QgaWd0X2xpdmVfdGVzdCB0OwogCXVuc2lnbmVkIGludCBpZDsKIAlp
bnQgZXJyID0gLUVOT0RFVjsKQEAgLTU0OSwyOCArNTI1LDI1IEBAIHN0YXRpYyBpbnQgbGl2ZV9u
b3BfcmVxdWVzdCh2b2lkICphcmcpCiAJICogdGhlIG92ZXJoZWFkIG9mIHN1Ym1pdHRpbmcgcmVx
dWVzdHMgdG8gdGhlIGhhcmR3YXJlLgogCSAqLwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRpbWVfcG1fZ2V0KCZpOTE1LT5ydW50
aW1lX3BtKTsKLQogCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKSB7Ci0JCXN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QgPSBOVUxMOwogCQl1bnNpZ25lZCBsb25nIG4sIHByaW1l
OwogCQlJR1RfVElNRU9VVChlbmRfdGltZSk7CiAJCWt0aW1lX3QgdGltZXNbMl0gPSB7fTsKIAog
CQllcnIgPSBpZ3RfbGl2ZV90ZXN0X2JlZ2luKCZ0LCBpOTE1LCBfX2Z1bmNfXywgZW5naW5lLT5u
YW1lKTsKIAkJaWYgKGVycikKLQkJCWdvdG8gb3V0X3VubG9jazsKKwkJCXJldHVybiBlcnI7CiAK
IAkJZm9yX2VhY2hfcHJpbWVfbnVtYmVyX2Zyb20ocHJpbWUsIDEsIDgxOTIpIHsKKwkJCXN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJlcXVlc3QgPSBOVUxMOworCiAJCQl0aW1lc1sxXSA9IGt0aW1lX2dl
dF9yYXcoKTsKIAogCQkJZm9yIChuID0gMDsgbiA8IHByaW1lOyBuKyspIHsKKwkJCQlpOTE1X3Jl
cXVlc3RfcHV0KHJlcXVlc3QpOwogCQkJCXJlcXVlc3QgPSBpOTE1X3JlcXVlc3RfY3JlYXRlKGVu
Z2luZS0+a2VybmVsX2NvbnRleHQpOwotCQkJCWlmIChJU19FUlIocmVxdWVzdCkpIHsKLQkJCQkJ
ZXJyID0gUFRSX0VSUihyZXF1ZXN0KTsKLQkJCQkJZ290byBvdXRfdW5sb2NrOwotCQkJCX0KKwkJ
CQlpZiAoSVNfRVJSKHJlcXVlc3QpKQorCQkJCQlyZXR1cm4gUFRSX0VSUihyZXF1ZXN0KTsKIAog
CQkJCS8qIFRoaXMgc3BhY2UgaXMgbGVmdCBpbnRlbnRpb25hbGx5IGJsYW5rLgogCQkJCSAqCkBA
IC01ODUsOSArNTU4LDExIEBAIHN0YXRpYyBpbnQgbGl2ZV9ub3BfcmVxdWVzdCh2b2lkICphcmcp
CiAJCQkJICogZm9yIGxhdGVuY3kuCiAJCQkJICovCiAKKwkJCQlpOTE1X3JlcXVlc3RfZ2V0KHJl
cXVlc3QpOwogCQkJCWk5MTVfcmVxdWVzdF9hZGQocmVxdWVzdCk7CiAJCQl9CiAJCQlpOTE1X3Jl
cXVlc3Rfd2FpdChyZXF1ZXN0LCAwLCBNQVhfU0NIRURVTEVfVElNRU9VVCk7CisJCQlpOTE1X3Jl
cXVlc3RfcHV0KHJlcXVlc3QpOwogCiAJCQl0aW1lc1sxXSA9IGt0aW1lX3N1YihrdGltZV9nZXRf
cmF3KCksIHRpbWVzWzFdKTsKIAkJCWlmIChwcmltZSA9PSAxKQpAQCAtNTk5LDcgKzU3NCw3IEBA
IHN0YXRpYyBpbnQgbGl2ZV9ub3BfcmVxdWVzdCh2b2lkICphcmcpCiAKIAkJZXJyID0gaWd0X2xp
dmVfdGVzdF9lbmQoJnQpOwogCQlpZiAoZXJyKQotCQkJZ290byBvdXRfdW5sb2NrOworCQkJcmV0
dXJuIGVycjsKIAogCQlwcl9pbmZvKCJSZXF1ZXN0IGxhdGVuY2llcyBvbiAlczogMSA9ICVsbHVu
cywgJWx1ID0gJWxsdW5zXG4iLAogCQkJZW5naW5lLT5uYW1lLApAQCAtNjA3LDkgKzU4Miw2IEBA
IHN0YXRpYyBpbnQgbGl2ZV9ub3BfcmVxdWVzdCh2b2lkICphcmcpCiAJCQlwcmltZSwgZGl2NjRf
dTY0KGt0aW1lX3RvX25zKHRpbWVzWzFdKSwgcHJpbWUpKTsKIAl9CiAKLW91dF91bmxvY2s6Ci0J
aW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11dGV4
X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIApAQCAt
Njc5LDYgKzY1MSw3IEBAIGVtcHR5X3JlcXVlc3Qoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5n
aW5lLAogCWlmIChlcnIpCiAJCWdvdG8gb3V0X3JlcXVlc3Q7CiAKKwlpOTE1X3JlcXVlc3RfZ2V0
KHJlcXVlc3QpOwogb3V0X3JlcXVlc3Q6CiAJaTkxNV9yZXF1ZXN0X2FkZChyZXF1ZXN0KTsKIAly
ZXR1cm4gZXJyID8gRVJSX1BUUihlcnIpIDogcmVxdWVzdDsKQEAgLTY4OCw3ICs2NjEsNiBAQCBz
dGF0aWMgaW50IGxpdmVfZW1wdHlfcmVxdWVzdCh2b2lkICphcmcpCiB7CiAJc3RydWN0IGRybV9p
OTE1X3ByaXZhdGUgKmk5MTUgPSBhcmc7CiAJc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5l
OwotCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7CiAJ
c3RydWN0IGk5MTVfdm1hICpiYXRjaDsKIAl1bnNpZ25lZCBpbnQgaWQ7CkBAIC02OTksMTQgKzY3
MSw5IEBAIHN0YXRpYyBpbnQgbGl2ZV9lbXB0eV9yZXF1ZXN0KHZvaWQgKmFyZykKIAkgKiB0aGUg
b3ZlcmhlYWQgb2Ygc3VibWl0dGluZyByZXF1ZXN0cyB0byB0aGUgaGFyZHdhcmUuCiAJICovCiAK
LQltdXRleF9sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQl3YWtlcmVmID0gaW50ZWxf
cnVudGltZV9wbV9nZXQoJmk5MTUtPnJ1bnRpbWVfcG0pOwotCiAJYmF0Y2ggPSBlbXB0eV9iYXRj
aChpOTE1KTsKLQlpZiAoSVNfRVJSKGJhdGNoKSkgewotCQllcnIgPSBQVFJfRVJSKGJhdGNoKTsK
LQkJZ290byBvdXRfdW5sb2NrOwotCX0KKwlpZiAoSVNfRVJSKGJhdGNoKSkKKwkJcmV0dXJuIFBU
Ul9FUlIoYmF0Y2gpOwogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsKIAkJ
SUdUX1RJTUVPVVQoZW5kX3RpbWUpOwpAQCAtNzMwLDYgKzY5Nyw3IEBAIHN0YXRpYyBpbnQgbGl2
ZV9lbXB0eV9yZXF1ZXN0KHZvaWQgKmFyZykKIAkJCXRpbWVzWzFdID0ga3RpbWVfZ2V0X3Jhdygp
OwogCiAJCQlmb3IgKG4gPSAwOyBuIDwgcHJpbWU7IG4rKykgeworCQkJCWk5MTVfcmVxdWVzdF9w
dXQocmVxdWVzdCk7CiAJCQkJcmVxdWVzdCA9IGVtcHR5X3JlcXVlc3QoZW5naW5lLCBiYXRjaCk7
CiAJCQkJaWYgKElTX0VSUihyZXF1ZXN0KSkgewogCQkJCQllcnIgPSBQVFJfRVJSKHJlcXVlc3Qp
OwpAQCAtNzQ1LDYgKzcxMyw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9lbXB0eV9yZXF1ZXN0KHZvaWQg
KmFyZykKIAkJCWlmIChfX2lndF90aW1lb3V0KGVuZF90aW1lLCBOVUxMKSkKIAkJCQlicmVhazsK
IAkJfQorCQlpOTE1X3JlcXVlc3RfcHV0KHJlcXVlc3QpOwogCiAJCWVyciA9IGlndF9saXZlX3Rl
c3RfZW5kKCZ0KTsKIAkJaWYgKGVycikKQEAgLTc1OSw5ICs3MjgsNiBAQCBzdGF0aWMgaW50IGxp
dmVfZW1wdHlfcmVxdWVzdCh2b2lkICphcmcpCiBvdXRfYmF0Y2g6CiAJaTkxNV92bWFfdW5waW4o
YmF0Y2gpOwogCWk5MTVfdm1hX3B1dChiYXRjaCk7Ci1vdXRfdW5sb2NrOgotCWludGVsX3J1bnRp
bWVfcG1fcHV0KCZpOTE1LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKLQltdXRleF91bmxvY2soJmk5
MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCXJldHVybiBlcnI7CiB9CiAKQEAgLTg0MSw3ICs4MDcs
NiBAQCBzdGF0aWMgaW50IGxpdmVfYWxsX2VuZ2luZXModm9pZCAqYXJnKQogCXN0cnVjdCBkcm1f
aTkxNV9wcml2YXRlICppOTE1ID0gYXJnOwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZTsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpyZXF1ZXN0W0k5MTVfTlVNX0VOR0lORVNdOwotCWlu
dGVsX3dha2VyZWZfdCB3YWtlcmVmOwogCXN0cnVjdCBpZ3RfbGl2ZV90ZXN0IHQ7CiAJc3RydWN0
IGk5MTVfdm1hICpiYXRjaDsKIAl1bnNpZ25lZCBpbnQgaWQ7CkBAIC04NTIsMTggKzgxNywxNSBA
QCBzdGF0aWMgaW50IGxpdmVfYWxsX2VuZ2luZXModm9pZCAqYXJnKQogCSAqIGJsb2NrIGRvaW5n
IHNvLCBhbmQgdGhhdCB0aGV5IGRvbid0IGNvbXBsZXRlIHRvbyBzb29uLgogCSAqLwogCi0JbXV0
ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRp
bWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKLQogCWVyciA9IGlndF9saXZlX3Rlc3RfYmVn
aW4oJnQsIGk5MTUsIF9fZnVuY19fLCAiIik7CiAJaWYgKGVycikKLQkJZ290byBvdXRfdW5sb2Nr
OworCQlyZXR1cm4gZXJyOwogCiAJYmF0Y2ggPSByZWN1cnNpdmVfYmF0Y2goaTkxNSk7CiAJaWYg
KElTX0VSUihiYXRjaCkpIHsKIAkJZXJyID0gUFRSX0VSUihiYXRjaCk7CiAJCXByX2VycigiJXM6
IFVuYWJsZSB0byBjcmVhdGUgYmF0Y2gsIGVycj0lZFxuIiwgX19mdW5jX18sIGVycik7Ci0JCWdv
dG8gb3V0X3VubG9jazsKKwkJcmV0dXJuIGVycjsKIAl9CiAKIAlmb3JfZWFjaF9lbmdpbmUoZW5n
aW5lLCBpOTE1LCBpZCkgewpAQCAtOTMzLDkgKzg5NSw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9hbGxf
ZW5naW5lcyh2b2lkICphcmcpCiAJCQlpOTE1X3JlcXVlc3RfcHV0KHJlcXVlc3RbaWRdKTsKIAlp
OTE1X3ZtYV91bnBpbihiYXRjaCk7CiAJaTkxNV92bWFfcHV0KGJhdGNoKTsKLW91dF91bmxvY2s6
Ci0JaW50ZWxfcnVudGltZV9wbV9wdXQoJmk5MTUtPnJ1bnRpbWVfcG0sIHdha2VyZWYpOwotCW11
dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJcmV0dXJuIGVycjsKIH0KIApA
QCAtOTQ1LDcgKzkwNCw2IEBAIHN0YXRpYyBpbnQgbGl2ZV9zZXF1ZW50aWFsX2VuZ2luZXModm9p
ZCAqYXJnKQogCXN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3RbSTkxNV9OVU1fRU5HSU5FU10g
PSB7fTsKIAlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpwcmV2ID0gTlVMTDsKIAlzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmU7Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWY7CiAJc3RydWN0IGln
dF9saXZlX3Rlc3QgdDsKIAl1bnNpZ25lZCBpbnQgaWQ7CiAJaW50IGVycjsKQEAgLTk1NiwxMiAr
OTE0LDkgQEAgc3RhdGljIGludCBsaXZlX3NlcXVlbnRpYWxfZW5naW5lcyh2b2lkICphcmcpCiAJ
ICogdGhleSBhcmUgcnVubmluZyBvbiBpbmRlcGVuZGVudCBlbmdpbmVzLgogCSAqLwogCi0JbXV0
ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7Ci0Jd2FrZXJlZiA9IGludGVsX3J1bnRp
bWVfcG1fZ2V0KCZpOTE1LT5ydW50aW1lX3BtKTsKLQogCWVyciA9IGlndF9saXZlX3Rlc3RfYmVn
aW4oJnQsIGk5MTUsIF9fZnVuY19fLCAiIik7CiAJaWYgKGVycikKLQkJZ290byBvdXRfdW5sb2Nr
OworCQlyZXR1cm4gZXJyOwogCiAJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpIHsK
IAkJc3RydWN0IGk5MTVfdm1hICpiYXRjaDsKQEAgLTk3MSw3ICs5MjYsNyBAQCBzdGF0aWMgaW50
IGxpdmVfc2VxdWVudGlhbF9lbmdpbmVzKHZvaWQgKmFyZykKIAkJCWVyciA9IFBUUl9FUlIoYmF0
Y2gpOwogCQkJcHJfZXJyKCIlczogVW5hYmxlIHRvIGNyZWF0ZSBiYXRjaCBmb3IgJXMsIGVycj0l
ZFxuIiwKIAkJCSAgICAgICBfX2Z1bmNfXywgZW5naW5lLT5uYW1lLCBlcnIpOwotCQkJZ290byBv
dXRfdW5sb2NrOworCQkJcmV0dXJuIGVycjsKIAkJfQogCiAJCXJlcXVlc3RbaWRdID0gaTkxNV9y
ZXF1ZXN0X2NyZWF0ZShlbmdpbmUtPmtlcm5lbF9jb250ZXh0KTsKQEAgLTEwNjMsOSArMTAxOCw2
IEBAIHN0YXRpYyBpbnQgbGl2ZV9zZXF1ZW50aWFsX2VuZ2luZXModm9pZCAqYXJnKQogCQlpOTE1
X3ZtYV9wdXQocmVxdWVzdFtpZF0tPmJhdGNoKTsKIAkJaTkxNV9yZXF1ZXN0X3B1dChyZXF1ZXN0
W2lkXSk7CiAJfQotb3V0X3VubG9jazoKLQlpbnRlbF9ydW50aW1lX3BtX3B1dCgmaTkxNS0+cnVu
dGltZV9wbSwgd2FrZXJlZik7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4
KTsKIAlyZXR1cm4gZXJyOwogfQogCkBAIC0xMTU2LDkgKzExMDgsMTAgQEAgc3RhdGljIGludCBs
aXZlX2JyZWFkY3J1bWJzX3Ntb2tldGVzdCh2b2lkICphcmcpCiAJCWdvdG8gb3V0X3RocmVhZHM7
CiAJfQogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJZm9yIChuID0g
MDsgbiA8IHRbMF0ubmNvbnRleHRzOyBuKyspIHsKKwkJbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CiAJCXRbMF0uY29udGV4dHNbbl0gPSBsaXZlX2NvbnRleHQoaTkxNSwgZmls
ZSk7CisJCW11dGV4X3VubG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJCWlmICghdFsw
XS5jb250ZXh0c1tuXSkgewogCQkJcmV0ID0gLUVOT01FTTsKIAkJCWdvdG8gb3V0X2NvbnRleHRz
OwpAQCAtMTE3NSw3ICsxMTI4LDYgQEAgc3RhdGljIGludCBsaXZlX2JyZWFkY3J1bWJzX3Ntb2tl
dGVzdCh2b2lkICphcmcpCiAJCXRbaWRdLm1heF9iYXRjaCA9IG1heF9iYXRjaGVzKHRbMF0uY29u
dGV4dHNbMF0sIGVuZ2luZSk7CiAJCWlmICh0W2lkXS5tYXhfYmF0Y2ggPCAwKSB7CiAJCQlyZXQg
PSB0W2lkXS5tYXhfYmF0Y2g7Ci0JCQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0
ZXgpOwogCQkJZ290byBvdXRfZmx1c2g7CiAJCX0KIAkJLyogT25lIHJpbmcgaW50ZXJsZWF2ZWQg
YmV0d2VlbiByZXF1ZXN0cyBmcm9tIGFsbCBjcHVzICovCkBAIC0xMTkwLDcgKzExNDIsNiBAQCBz
dGF0aWMgaW50IGxpdmVfYnJlYWRjcnVtYnNfc21va2V0ZXN0KHZvaWQgKmFyZykKIAkJCQkJICAm
dFtpZF0sICJpZ3QvJWQuJWQiLCBpZCwgbik7CiAJCQlpZiAoSVNfRVJSKHRzaykpIHsKIAkJCQly
ZXQgPSBQVFJfRVJSKHRzayk7Ci0JCQkJbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKIAkJCQlnb3RvIG91dF9mbHVzaDsKIAkJCX0KIApAQCAtMTE5OCw3ICsxMTQ5LDYgQEAg
c3RhdGljIGludCBsaXZlX2JyZWFkY3J1bWJzX3Ntb2tldGVzdCh2b2lkICphcmcpCiAJCQl0aHJl
YWRzW2lkICogbmNwdXMgKyBuXSA9IHRzazsKIAkJfQogCX0KLQltdXRleF91bmxvY2soJmk5MTUt
PmRybS5zdHJ1Y3RfbXV0ZXgpOwogCiAJbXNsZWVwKGppZmZpZXNfdG9fbXNlY3MoaTkxNV9zZWxm
dGVzdC50aW1lb3V0X2ppZmZpZXMpKTsKIApAQCAtMTIyNiwxMCArMTE3Niw4IEBAIHN0YXRpYyBp
bnQgbGl2ZV9icmVhZGNydW1ic19zbW9rZXRlc3Qodm9pZCAqYXJnKQogCXByX2luZm8oIkNvbXBs
ZXRlZCAlbHUgd2FpdHMgZm9yICVsdSBmZW5jZXMgYWNyb3NzICVkIGVuZ2luZXMgYW5kICVkIGNw
dXNcbiIsCiAJCW51bV93YWl0cywgbnVtX2ZlbmNlcywgUlVOVElNRV9JTkZPKGk5MTUpLT5udW1f
ZW5naW5lcywgbmNwdXMpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7
CiAJcmV0ID0gaWd0X2xpdmVfdGVzdF9lbmQoJmxpdmUpID86IHJldDsKIG91dF9jb250ZXh0czoK
LQltdXRleF91bmxvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwogCWtmcmVlKHRbMF0uY29u
dGV4dHMpOwogb3V0X3RocmVhZHM6CiAJa2ZyZWUodGhyZWFkcyk7CmRpZmYgLS1naXQgYS9kcml2
ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9zZWxmdGVzdC5jIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfc2VsZnRlc3QuYwppbmRleCA0MzhlYTBlYWE0MTYuLjgy
NWE4Mjg2Y2JlOCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5
MTVfc2VsZnRlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9z
ZWxmdGVzdC5jCkBAIC0yNjMsMTAgKzI2Myw4IEBAIGludCBfX2k5MTVfbGl2ZV90ZWFyZG93bihp
bnQgZXJyLCB2b2lkICpkYXRhKQogewogCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0g
ZGF0YTsKIAotCW11dGV4X2xvY2soJmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChpZ3Rf
Zmx1c2hfdGVzdChpOTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwlpZiAoaWd0X2ZsdXNoX3Rlc3Qo
aTkxNSkpCiAJCWVyciA9IC1FSU87Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211
dGV4KTsKIAogCWk5MTVfZ2VtX2RyYWluX2ZyZWVkX29iamVjdHMoaTkxNSk7CiAKQEAgLTI4NCwx
MCArMjgyLDggQEAgaW50IF9faW50ZWxfZ3RfbGl2ZV90ZWFyZG93bihpbnQgZXJyLCB2b2lkICpk
YXRhKQogewogCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBkYXRhOwogCi0JbXV0ZXhfbG9jaygmZ3Qt
Pmk5MTUtPmRybS5zdHJ1Y3RfbXV0ZXgpOwotCWlmIChpZ3RfZmx1c2hfdGVzdChndC0+aTkxNSwg
STkxNV9XQUlUX0xPQ0tFRCkpCisJaWYgKGlndF9mbHVzaF90ZXN0KGd0LT5pOTE1KSkKIAkJZXJy
ID0gLUVJTzsKLQltdXRleF91bmxvY2soJmd0LT5pOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAog
CWk5MTVfZ2VtX2RyYWluX2ZyZWVkX29iamVjdHMoZ3QtPmk5MTUpOwogCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X3ZtYS5jCmluZGV4IDBlNGY2NjMxMmIzOS4uMWM5ZGIwOGY3
YzI4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEu
YworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV92bWEuYwpAQCAtODMz
LDEyICs4MzMsOCBAQCBpbnQgaTkxNV92bWFfbW9ja19zZWxmdGVzdHModm9pZCkKIAogCWVyciA9
IGk5MTVfc3VidGVzdHModGVzdHMsIGdndHQpOwogCi0JbXV0ZXhfbG9jaygmaTkxNS0+ZHJtLnN0
cnVjdF9tdXRleCk7CiAJbW9ja19kZXZpY2VfZmx1c2goaTkxNSk7Ci0JbXV0ZXhfdW5sb2NrKCZp
OTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQogCWk5MTVfZ2VtX2RyYWluX2ZyZWVkX29iamVjdHMo
aTkxNSk7Ci0KIAltb2NrX2ZpbmlfZ2d0dChnZ3R0KTsKIAlrZnJlZShnZ3R0KTsKIG91dF9wdXQ6
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2ZsdXNoX3Rl
c3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5jCmlu
ZGV4IGQzYjVlYjQwMmQzMy4uMmE1ZmJlNDZlYTlmIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaWd0X2ZsdXNoX3Rlc3QuYworKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9zZWxmdGVzdHMvaWd0X2ZsdXNoX3Rlc3QuYwpAQCAtMTIsMzEgKzEyLDI1IEBACiAKICNp
bmNsdWRlICJpZ3RfZmx1c2hfdGVzdC5oIgogCi1pbnQgaWd0X2ZsdXNoX3Rlc3Qoc3RydWN0IGRy
bV9pOTE1X3ByaXZhdGUgKmk5MTUsIHVuc2lnbmVkIGludCBmbGFncykKK2ludCBpZ3RfZmx1c2hf
dGVzdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKIAlpbnQgcmV0ID0gaW50ZWxf
Z3RfaXNfd2VkZ2VkKCZpOTE1LT5ndCkgPyAtRUlPIDogMDsKLQlpbnQgcmVwZWF0ID0gISEoZmxh
Z3MgJiBJOTE1X1dBSVRfTE9DS0VEKTsKIAogCWNvbmRfcmVzY2hlZCgpOwogCi0JZG8gewotCQlp
ZiAoaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShpOTE1LCBmbGFncywgSFogLyA1KSA9PSAtRVRJTUUp
IHsKLQkJCXByX2VycigiJXBTIHRpbWVkIG91dCwgY2FuY2VsbGluZyBhbGwgZnVydGhlciB0ZXN0
aW5nLlxuIiwKLQkJCSAgICAgICBfX2J1aWx0aW5fcmV0dXJuX2FkZHJlc3MoMCkpOworCWk5MTVf
cmV0aXJlX3JlcXVlc3RzKGk5MTUpOworCWlmIChpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGk5MTUs
IDAsIEhaIC8gNSkgPT0gLUVUSU1FKSB7CisJCXByX2VycigiJXBTIHRpbWVkIG91dCwgY2FuY2Vs
bGluZyBhbGwgZnVydGhlciB0ZXN0aW5nLlxuIiwKKwkJICAgICAgIF9fYnVpbHRpbl9yZXR1cm5f
YWRkcmVzcygwKSk7CiAKLQkJCUdFTV9UUkFDRSgiJXBTIHRpbWVkIG91dC5cbiIsCi0JCQkJICBf
X2J1aWx0aW5fcmV0dXJuX2FkZHJlc3MoMCkpOwotCQkJR0VNX1RSQUNFX0RVTVAoKTsKKwkJR0VN
X1RSQUNFKCIlcFMgdGltZWQgb3V0LlxuIiwKKwkJCSAgX19idWlsdGluX3JldHVybl9hZGRyZXNz
KDApKTsKKwkJR0VNX1RSQUNFX0RVTVAoKTsKIAotCQkJaW50ZWxfZ3Rfc2V0X3dlZGdlZCgmaTkx
NS0+Z3QpOwotCQkJcmVwZWF0ID0gMDsKLQkJCXJldCA9IC1FSU87Ci0JCX0KLQotCQkvKiBFbnN1
cmUgd2UgYWxzbyBmbHVzaCBhZnRlciB3ZWRnaW5nLiAqLwotCQlpZiAoZmxhZ3MgJiBJOTE1X1dB
SVRfTE9DS0VEKQotCQkJaTkxNV9yZXRpcmVfcmVxdWVzdHMoaTkxNSk7Ci0JfSB3aGlsZSAocmVw
ZWF0LS0pOworCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZpOTE1LT5ndCk7CisJCXJldCA9IC1FSU87
CisJfQorCWk5MTVfcmV0aXJlX3JlcXVlc3RzKGk5MTUpOwogCiAJcmV0dXJuIHJldDsKIH0KZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5o
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9mbHVzaF90ZXN0LmgKaW5kZXgg
NjNlMDA5OTI3YzQzLi43NTQxZmE3NGU2NDEgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5oCkBAIC05LDYgKzksNiBAQAogCiBzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZTsKIAotaW50IGlndF9mbHVzaF90ZXN0KHN0cnVjdCBkcm1faTkxNV9wcml2
YXRlICppOTE1LCB1bnNpZ25lZCBpbnQgZmxhZ3MpOworaW50IGlndF9mbHVzaF90ZXN0KHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIAogI2VuZGlmIC8qIElHVF9GTFVTSF9URVNUX0gg
Ki8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfbGl2ZV90
ZXN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvaWd0X2xpdmVfdGVzdC5jCmlu
ZGV4IDNlOTAyNzYxY2QxNi4uMDRhNmY4OGZkZjY0IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9zZWxmdGVzdHMvaWd0X2xpdmVfdGVzdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L3NlbGZ0ZXN0cy9pZ3RfbGl2ZV90ZXN0LmMKQEAgLTE5LDE1ICsxOSwxMiBAQCBpbnQgaWd0
X2xpdmVfdGVzdF9iZWdpbihzdHJ1Y3QgaWd0X2xpdmVfdGVzdCAqdCwKIAllbnVtIGludGVsX2Vu
Z2luZV9pZCBpZDsKIAlpbnQgZXJyOwogCi0JbG9ja2RlcF9hc3NlcnRfaGVsZCgmaTkxNS0+ZHJt
LnN0cnVjdF9tdXRleCk7Ci0KIAl0LT5pOTE1ID0gaTkxNTsKIAl0LT5mdW5jID0gZnVuYzsKIAl0
LT5uYW1lID0gbmFtZTsKIAogCWVyciA9IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoaTkxNSwKLQkJ
CQkgICAgIEk5MTVfV0FJVF9JTlRFUlJVUFRJQkxFIHwKLQkJCQkgICAgIEk5MTVfV0FJVF9MT0NL
RUQsCisJCQkJICAgICBJOTE1X1dBSVRfSU5URVJSVVBUSUJMRSwKIAkJCQkgICAgIE1BWF9TQ0hF
RFVMRV9USU1FT1VUKTsKIAlpZiAoZXJyKSB7CiAJCXByX2VycigiJXMoJXMpOiBmYWlsZWQgdG8g
aWRsZSBiZWZvcmUsIHdpdGggZXJyPSVkISIsCkBAIC01MCw5ICs0Nyw3IEBAIGludCBpZ3RfbGl2
ZV90ZXN0X2VuZChzdHJ1Y3QgaWd0X2xpdmVfdGVzdCAqdCkKIAlzdHJ1Y3QgaW50ZWxfZW5naW5l
X2NzICplbmdpbmU7CiAJZW51bSBpbnRlbF9lbmdpbmVfaWQgaWQ7CiAKLQlsb2NrZGVwX2Fzc2Vy
dF9oZWxkKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKLQotCWlmIChpZ3RfZmx1c2hfdGVzdChp
OTE1LCBJOTE1X1dBSVRfTE9DS0VEKSkKKwlpZiAoaWd0X2ZsdXNoX3Rlc3QoaTkxNSkpCiAJCXJl
dHVybiAtRUlPOwogCiAJaWYgKHQtPnJlc2V0X2dsb2JhbCAhPSBpOTE1X3Jlc2V0X2NvdW50KCZp
OTE1LT5ncHVfZXJyb3IpKSB7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxm
dGVzdHMvbW9ja19nZW1fZGV2aWNlLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMv
bW9ja19nZW1fZGV2aWNlLmMKaW5kZXggOTFmMTVmYTcyOGNkLi45NGU2MWExYzdjNjUgMTAwNjQ0
Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9tb2NrX2dlbV9kZXZpY2UuYwor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKQEAg
LTQxLDggKzQxLDYgQEAgdm9pZCBtb2NrX2RldmljZV9mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqaTkxNSkKIAlzdHJ1Y3QgaW50ZWxfZW5naW5lX2NzICplbmdpbmU7CiAJZW51bSBpbnRl
bF9lbmdpbmVfaWQgaWQ7CiAKLQlsb2NrZGVwX2Fzc2VydF9oZWxkKCZpOTE1LT5kcm0uc3RydWN0
X211dGV4KTsKLQogCWRvIHsKIAkJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgaTkxNSwgaWQpCiAJ
CQltb2NrX2VuZ2luZV9mbHVzaChlbmdpbmUpOwpAQCAtNTUsOSArNTMsNyBAQCBzdGF0aWMgdm9p
ZCBtb2NrX2RldmljZV9yZWxlYXNlKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYpCiAJc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqZW5naW5lOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOwogCi0JbXV0
ZXhfbG9jaygmaTkxNS0+ZHJtLnN0cnVjdF9tdXRleCk7CiAJbW9ja19kZXZpY2VfZmx1c2goaTkx
NSk7Ci0JbXV0ZXhfdW5sb2NrKCZpOTE1LT5kcm0uc3RydWN0X211dGV4KTsKIAogCWZsdXNoX3dv
cmsoJmk5MTUtPmdlbS5pZGxlX3dvcmspOwogCWk5MTVfZ2VtX2RyYWluX3dvcmtxdWV1ZShpOTE1
KTsKLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Au
b3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwt
Z2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 8A95FB600B
	for <lists+intel-gfx@lfdr.de>; Wed, 18 Sep 2019 11:23:28 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id E5F436EE7A;
	Wed, 18 Sep 2019 09:23:26 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 755976EE7A
 for <intel-gfx@lists.freedesktop.org>; Wed, 18 Sep 2019 09:23:25 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18529352-1500050 
 for multiple; Wed, 18 Sep 2019 10:23:05 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Wed, 18 Sep 2019 10:23:03 +0100
Message-Id: <20190918092303.23078-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH] drm/i915: Expose engine properties via sysfs
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UHJlbGltaW5hcnkgc3R1YiB0byBhZGQgZW5naW5lcyB1bmRlcm5lYXRoIC9zeXMvY2xhc3MvZHJt
L2NhcmROLywgc28KdGhhdCB3ZSBjYW4gZXhwb3NlIHByb3BlcnRpZXMgb24gZWFjaCBlbmdpbmUg
dG8gdGhlIHN5c2FkbWluLgoKVG8gc3RhcnQgd2l0aCB3ZSBoYXZlIGJhc2ljIGFuYWxvZ3VlcyBv
ZiB0aGUgaTkxNV9xdWVyeSBpb2N0bCBzbyB0aGF0IHdlCmNhbiBwcmV0dHkgcHJpbnQgZW5naW5l
IGRpc2NvdmVyeSBmcm9tIHRoZSBzaGVsbCwgYW5kIGZsZXNoIG91dCB0aGUKZGlyZWN0b3J5IHN0
cnVjdHVyZS4gTGF0ZXIgd2Ugd2lsbCBhZGQgd3JpdGVhYmxlIHN5c2FkbWluIHByb3BlcnRpZXMg
c3VjaAphcyBwZXItZW5naW5lIHRpbWVvdXQgY29udHJvbHMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJp
cyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNvbi5jby51az4KQ2M6IEpvb25hcyBMYWh0aW5lbiA8
am9vbmFzLmxhaHRpbmVuQGxpbnV4LmludGVsLmNvbT4KQ2M6IFR2cnRrbyBVcnN1bGluIDx0dnJ0
a28udXJzdWxpbkBpbnRlbC5jb20+CkNjOiBEYW5pZWxlIENlcmFvbG8gU3B1cmlvIDxkYW5pZWxl
LmNlcmFvbG9zcHVyaW9AaW50ZWwuY29tPgpDYzogUm9kcmlnbyBWaXZpIDxyb2RyaWdvLnZpdmlA
aW50ZWwuY29tPgotLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L01ha2VmaWxlICAgICAgICAgICAg
ICAgIHwgICAzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfc3lzZnMu
YyB8IDExMyArKysrKysrKysrKysrKysrKysrCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9lbmdpbmVfc3lzZnMuaCB8ICAxNCArKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfc3lz
ZnMuYyAgICAgICAgICAgIHwgICA0ICsKIDQgZmlsZXMgY2hhbmdlZCwgMTMzIGluc2VydGlvbnMo
KyksIDEgZGVsZXRpb24oLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJzL2dwdS9kcm0vaTkx
NS9ndC9pbnRlbF9lbmdpbmVfc3lzZnMuYwogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9zeXNmcy5oCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvTWFrZWZpbGUgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQppbmRl
eCA2NThiOTMwZDM0YTguLmJiZWEwZDRkYWRkNiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvTWFrZWZpbGUKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKQEAgLTc2
LDggKzc2LDkgQEAgZ3QteSArPSBcCiAJZ3QvaW50ZWxfYnJlYWRjcnVtYnMubyBcCiAJZ3QvaW50
ZWxfY29udGV4dC5vIFwKIAlndC9pbnRlbF9lbmdpbmVfY3MubyBcCi0JZ3QvaW50ZWxfZW5naW5l
X3Bvb2wubyBcCiAJZ3QvaW50ZWxfZW5naW5lX3BtLm8gXAorCWd0L2ludGVsX2VuZ2luZV9wb29s
Lm8gXAorCWd0L2ludGVsX2VuZ2luZV9zeXNmcy5vIFwKIAlndC9pbnRlbF9lbmdpbmVfdXNlci5v
IFwKIAlndC9pbnRlbF9ndC5vIFwKIAlndC9pbnRlbF9ndF9pcnEubyBcCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfc3lzZnMuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9zeXNmcy5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0Cmlu
ZGV4IDAwMDAwMDAwMDAwMC4uNTFiNGIzZjJhODA4Ci0tLSAvZGV2L251bGwKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3N5c2ZzLmMKQEAgLTAsMCArMSwxMTMgQEAK
Ky8qCisgKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUCisgKgorICogQ29weXJpZ2h0IMKp
IDIwMTkgSW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaW5jbHVkZSA8bGludXgva29iamVjdC5o
PgorI2luY2x1ZGUgPGxpbnV4L3N5c2ZzLmg+CisKKyNpbmNsdWRlICJpOTE1X2Rydi5oIgorI2lu
Y2x1ZGUgImludGVsX2VuZ2luZS5oIgorI2luY2x1ZGUgImludGVsX2VuZ2luZV9zeXNmcy5oIgor
CitzdHJ1Y3Qga29ial9lbmdpbmUgeworCXN0cnVjdCBrb2JqZWN0IGJhc2U7CisJc3RydWN0IGlu
dGVsX2VuZ2luZV9jcyAqZW5naW5lOworfTsKKworc3RhdGljIHN0cnVjdCBpbnRlbF9lbmdpbmVf
Y3MgKmtvYmpfdG9fZW5naW5lKHN0cnVjdCBrb2JqZWN0ICprb2JqKQoreworCXJldHVybiBjb250
YWluZXJfb2Yoa29iaiwgc3RydWN0IGtvYmpfZW5naW5lLCBiYXNlKS0+ZW5naW5lOworfQorCitz
dGF0aWMgc3NpemVfdAorbmFtZV9zaG93KHN0cnVjdCBrb2JqZWN0ICprb2JqLCBzdHJ1Y3Qga29i
al9hdHRyaWJ1dGUgKmF0dHIsIGNoYXIgKmJ1ZikKK3sKKwlyZXR1cm4gc3ByaW50ZihidWYsICIl
c1xuIiwga29ial90b19lbmdpbmUoa29iaiktPm5hbWUpOworfQorCitzdGF0aWMgc3NpemVfdAor
Y2xhc3Nfc2hvdyhzdHJ1Y3Qga29iamVjdCAqa29iaiwgc3RydWN0IGtvYmpfYXR0cmlidXRlICph
dHRyLCBjaGFyICpidWYpCit7CisJcmV0dXJuIHNwcmludGYoYnVmLCAiJWRcbiIsIGtvYmpfdG9f
ZW5naW5lKGtvYmopLT51YWJpX2NsYXNzKTsKK30KKworc3RhdGljIHNzaXplX3QKK2luc3Rfc2hv
dyhzdHJ1Y3Qga29iamVjdCAqa29iaiwgc3RydWN0IGtvYmpfYXR0cmlidXRlICphdHRyLCBjaGFy
ICpidWYpCit7CisJcmV0dXJuIHNwcmludGYoYnVmLCAiJWRcbiIsIGtvYmpfdG9fZW5naW5lKGtv
YmopLT51YWJpX2luc3RhbmNlKTsKK30KKworc3RhdGljIHNzaXplX3QKK21taW9fc2hvdyhzdHJ1
Y3Qga29iamVjdCAqa29iaiwgc3RydWN0IGtvYmpfYXR0cmlidXRlICphdHRyLCBjaGFyICpidWYp
Cit7CisJcmV0dXJuIHNwcmludGYoYnVmLCAiMHgleFxuIiwga29ial90b19lbmdpbmUoa29iaikt
Pm1taW9fYmFzZSk7Cit9CisKK3N0YXRpYyBzdHJ1Y3Qga29ial9hdHRyaWJ1dGUgbmFtZV9hdHRy
ID0gX19BVFRSKG5hbWUsIDA0NDQsIG5hbWVfc2hvdywgTlVMTCk7CitzdGF0aWMgc3RydWN0IGtv
YmpfYXR0cmlidXRlIGNsYXNzX2F0dHIgPSBfX0FUVFIoY2xhc3MsIDA0NDQsIGNsYXNzX3Nob3cs
IE5VTEwpOworc3RhdGljIHN0cnVjdCBrb2JqX2F0dHJpYnV0ZSBpbnN0X2F0dHIgPSBfX0FUVFIo
aW5zdGFuY2UsIDA0NDQsIGluc3Rfc2hvdywgTlVMTCk7CitzdGF0aWMgc3RydWN0IGtvYmpfYXR0
cmlidXRlIG1taW9fYXR0ciA9IF9fQVRUUihpbnN0YW5jZSwgMDQ0NCwgbW1pb19zaG93LCBOVUxM
KTsKKworc3RhdGljIHZvaWQga29ial9lbmdpbmVfcmVsZWFzZShzdHJ1Y3Qga29iamVjdCAqa29i
aikKK3sKKwlrZnJlZShrb2JqKTsKK30KKworc3RhdGljIHN0cnVjdCBrb2JqX3R5cGUga29ial9l
bmdpbmVfdHlwZSA9IHsKKwkucmVsZWFzZSA9IGtvYmpfZW5naW5lX3JlbGVhc2UsCisJLnN5c2Zz
X29wcyA9ICZrb2JqX3N5c2ZzX29wcworfTsKKworc3RhdGljIHN0cnVjdCBrb2JqZWN0ICoKK2tv
YmpfZW5naW5lKHN0cnVjdCBrb2JqZWN0ICpkaXIsIHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVu
Z2luZSkKK3sKKwlzdHJ1Y3Qga29ial9lbmdpbmUgKmtlOworCisJa2UgPSBremFsbG9jKHNpemVv
Zigqa2UpLCBHRlBfS0VSTkVMKTsKKwlpZiAoIWtlKQorCQlyZXR1cm4gTlVMTDsKKworCWtvYmpl
Y3RfaW5pdCgma2UtPmJhc2UsICZrb2JqX2VuZ2luZV90eXBlKTsKKwlrZS0+ZW5naW5lID0gZW5n
aW5lOworCisJaWYgKGtvYmplY3RfYWRkKCZrZS0+YmFzZSwgZGlyLCAiJXMiLCBlbmdpbmUtPm5h
bWUpKSB7CisJCWtvYmplY3RfcHV0KCZrZS0+YmFzZSk7CisJCXJldHVybiBOVUxMOworCX0KKwor
CXJldHVybiAma2UtPmJhc2U7Cit9CisKK3ZvaWQgaW50ZWxfZW5naW5lc19hZGRfc3lzZnMoc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCit7CisJc3RhdGljIGNvbnN0IHN0cnVjdCBhdHRy
aWJ1dGUgKmZpbGVzW10gPSB7CisJCSZuYW1lX2F0dHIuYXR0ciwKKwkJJmNsYXNzX2F0dHIuYXR0
ciwKKwkJJmluc3RfYXR0ci5hdHRyLAorCQkmbW1pb19hdHRyLmF0dHIsCisJfTsKKworCXN0cnVj
dCBkZXZpY2UgKmtkZXYgPSBpOTE1LT5kcm0ucHJpbWFyeS0+a2RldjsKKwlzdHJ1Y3QgaW50ZWxf
ZW5naW5lX2NzICplbmdpbmU7CisJc3RydWN0IGtvYmplY3QgKmRpcjsKKworCWRpciA9IGtvYmpl
Y3RfY3JlYXRlX2FuZF9hZGQoImVuZ2luZSIsICZrZGV2LT5rb2JqKTsKKwlpZiAoIWRpcikKKwkJ
cmV0dXJuOworCisJZm9yX2VhY2hfdWFiaV9lbmdpbmUoZW5naW5lLCBpOTE1KSB7CisJCXN0cnVj
dCBrb2JqZWN0ICprb2JqOworCisJCWtvYmogPSBrb2JqX2VuZ2luZShkaXIsIGVuZ2luZSk7CisJ
CWlmICgha29iaikKKwkJCWNvbnRpbnVlOworCisJCWlmIChzeXNmc19jcmVhdGVfZmlsZXMoa29i
aiwgZmlsZXMpKSB7CisJCQlkZXZfZXJyKGtkZXYsICJGYWlsZWQgdG8gYWRkIHN5c2ZzIGVuZ2lu
ZSAnJXMnXG4iLAorCQkJCWVuZ2luZS0+bmFtZSk7CisJCQlicmVhazsKKwkJfQorCX0KK30KZGlm
ZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2VuZ2luZV9zeXNmcy5oIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZW5naW5lX3N5c2ZzLmgKbmV3IGZpbGUgbW9k
ZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5lZjQ0YTc0NWI3MGEKLS0tIC9kZXYvbnVsbAor
KysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9lbmdpbmVfc3lzZnMuaApAQCAtMCww
ICsxLDE0IEBACisvKgorICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAorICoKKyAqIENv
cHlyaWdodCDCqSAyMDE5IEludGVsIENvcnBvcmF0aW9uCisgKi8KKworI2lmbmRlZiBJTlRFTF9F
TkdJTkVfU1lTRlNfSAorI2RlZmluZSBJTlRFTF9FTkdJTkVfU1lTRlNfSAorCitzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZTsKKwordm9pZCBpbnRlbF9lbmdpbmVzX2FkZF9zeXNmcyhzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqaTkxNSk7CisKKyNlbmRpZiAvKiBJTlRFTF9FTkdJTkVfU1lTRlNfSCAq
LwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zeXNmcy5jIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvaTkxNV9zeXNmcy5jCmluZGV4IGQ4YTNiMTgwYzA4NC4uNmI4OGQ5MzQ5
MjdhIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3N5c2ZzLmMKKysrIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9zeXNmcy5jCkBAIC0zMCw2ICszMCw4IEBACiAjaW5j
bHVkZSA8bGludXgvc3RhdC5oPgogI2luY2x1ZGUgPGxpbnV4L3N5c2ZzLmg+CiAKKyNpbmNsdWRl
ICJndC9pbnRlbF9lbmdpbmVfc3lzZnMuaCIKKwogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAjaW5j
bHVkZSAiaTkxNV9zeXNmcy5oIgogI2luY2x1ZGUgImludGVsX3BtLmgiCkBAIC02MTgsNiArNjIw
LDggQEAgdm9pZCBpOTE1X3NldHVwX3N5c2ZzKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZf
cHJpdikKIAkJRFJNX0VSUk9SKCJSUFMgc3lzZnMgc2V0dXAgZmFpbGVkXG4iKTsKIAogCWk5MTVf
c2V0dXBfZXJyb3JfY2FwdHVyZShrZGV2KTsKKworCWludGVsX2VuZ2luZXNfYWRkX3N5c2ZzKGRl
dl9wcml2KTsKIH0KIAogdm9pZCBpOTE1X3RlYXJkb3duX3N5c2ZzKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdikKLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlz
dHMuZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4v
bGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 07E3D2EAF32
	for <lists+intel-gfx@lfdr.de>; Tue,  5 Jan 2021 16:46:25 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id B36CB6E16F;
	Tue,  5 Jan 2021 15:45:51 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mblankhorst.nl (mblankhorst.nl [141.105.120.124])
 by gabe.freedesktop.org (Postfix) with ESMTPS id AC80F6E182
 for <intel-gfx@lists.freedesktop.org>; Tue,  5 Jan 2021 15:45:42 +0000 (UTC)
From: Maarten Lankhorst <maarten.lankhorst@linux.intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue,  5 Jan 2021 16:35:16 +0100
Message-Id: <20210105153558.134272-23-maarten.lankhorst@linux.intel.com>
X-Mailer: git-send-email 2.30.0.rc1
In-Reply-To: <20210105153558.134272-1-maarten.lankhorst@linux.intel.com>
References: <20210105153558.134272-1-maarten.lankhorst@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v6 22/64] drm/i915: Pass ww ctx to
 intel_pin_to_display_plane
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: =?UTF-8?q?Thomas=20Hellstr=C3=B6m?= <thomas.hellstrom@linux.intel.com>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

SW5zdGVhZCBvZiBtdWx0aXBsZSBsb2NraW5ncywgbG9jayB0aGUgb2JqZWN0IG9uY2UsCmFuZCBw
ZXJmb3JtIHRoZSB3dyBkYW5jZSBhcm91bmQgYXR0YWNoX3BoeXMgYW5kIHBpbl9wYWdlcy4KClNp
Z25lZC1vZmYtYnk6IE1hYXJ0ZW4gTGFua2hvcnN0IDxtYWFydGVuLmxhbmtob3JzdEBsaW51eC5p
bnRlbC5jb20+ClJldmlld2VkLWJ5OiBUaG9tYXMgSGVsbHN0csO2bSA8dGhvbWFzLmhlbGxzdHJv
bUBsaW51eC5pbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9kaXNwbGF5LmMgIHwgNjkgKysrKysrKysrKysrLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5
MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmggIHwgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1
L2Rpc3BsYXkvaW50ZWxfZmJkZXYuYyAgICB8ICAyICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX292ZXJsYXkuYyAgfCAzNCArKysrKysrLS0KIGRyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYyAgICB8IDMwICsrLS0tLS0tCiBkcml2ZXJzL2dwdS9k
cm0vaTkxNS9nZW0vaTkxNV9nZW1fb2JqZWN0LmggICAgfCAgMSArCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9nZW0vaTkxNV9nZW1fcGh5cy5jICAgICAgfCAxMCArLS0KIC4uLi9kcm0vaTkxNS9nZW0v
c2VsZnRlc3RzL2k5MTVfZ2VtX3BoeXMuYyAgICB8ICAyICsKIDggZmlsZXMgY2hhbmdlZCwgODYg
aW5zZXJ0aW9ucygrKSwgNjQgZGVsZXRpb25zKC0pCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXkuYwppbmRleCBjOGRmNDIxOTMyODcuLmFmMGY0MTliZTk0ZCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmMKQEAgLTIx
NzAsNiArMjE3MCw3IEBAIHN0YXRpYyBib29sIGludGVsX3BsYW5lX3VzZXNfZmVuY2UoY29uc3Qg
c3RydWN0IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAogc3RydWN0IGk5MTVfdm1h
ICoKIGludGVsX3Bpbl9hbmRfZmVuY2VfZmJfb2JqKHN0cnVjdCBkcm1fZnJhbWVidWZmZXIgKmZi
LAorCQkJICAgYm9vbCBwaHlzX2N1cnNvciwKIAkJCSAgIGNvbnN0IHN0cnVjdCBpOTE1X2dndHRf
dmlldyAqdmlldywKIAkJCSAgIGJvb2wgdXNlc19mZW5jZSwKIAkJCSAgIHVuc2lnbmVkIGxvbmcg
Km91dF9mbGFncykKQEAgLTIxNzgsMTQgKzIxNzksMTkgQEAgaW50ZWxfcGluX2FuZF9mZW5jZV9m
Yl9vYmooc3RydWN0IGRybV9mcmFtZWJ1ZmZlciAqZmIsCiAJc3RydWN0IGRybV9pOTE1X3ByaXZh
dGUgKmRldl9wcml2ID0gdG9faTkxNShkZXYpOwogCXN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0
ICpvYmogPSBpbnRlbF9mYl9vYmooZmIpOwogCWludGVsX3dha2VyZWZfdCB3YWtlcmVmOworCXN0
cnVjdCBpOTE1X2dlbV93d19jdHggd3c7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJdW5zaWdu
ZWQgaW50IHBpbmN0bDsKIAl1MzIgYWxpZ25tZW50OworCWludCByZXQ7CiAKIAlpZiAoZHJtX1dB
Uk5fT04oZGV2LCAhaTkxNV9nZW1fb2JqZWN0X2lzX2ZyYW1lYnVmZmVyKG9iaikpKQogCQlyZXR1
cm4gRVJSX1BUUigtRUlOVkFMKTsKIAotCWFsaWdubWVudCA9IGludGVsX3N1cmZfYWxpZ25tZW50
KGZiLCAwKTsKKwlpZiAocGh5c19jdXJzb3IpCisJCWFsaWdubWVudCA9IGludGVsX2N1cnNvcl9h
bGlnbm1lbnQoZGV2X3ByaXYpOworCWVsc2UKKwkJYWxpZ25tZW50ID0gaW50ZWxfc3VyZl9hbGln
bm1lbnQoZmIsIDApOwogCWlmIChkcm1fV0FSTl9PTihkZXYsIGFsaWdubWVudCAmJiAhaXNfcG93
ZXJfb2ZfMihhbGlnbm1lbnQpKSkKIAkJcmV0dXJuIEVSUl9QVFIoLUVJTlZBTCk7CiAKQEAgLTIy
MjAsMTQgKzIyMjYsMjYgQEAgaW50ZWxfcGluX2FuZF9mZW5jZV9mYl9vYmooc3RydWN0IGRybV9m
cmFtZWJ1ZmZlciAqZmIsCiAJaWYgKEhBU19HTUNIKGRldl9wcml2KSkKIAkJcGluY3RsIHw9IFBJ
Tl9NQVBQQUJMRTsKIAotCXZtYSA9IGk5MTVfZ2VtX29iamVjdF9waW5fdG9fZGlzcGxheV9wbGFu
ZShvYmosCi0JCQkJCQkgICBhbGlnbm1lbnQsIHZpZXcsIHBpbmN0bCk7Ci0JaWYgKElTX0VSUih2
bWEpKQorCWk5MTVfZ2VtX3d3X2N0eF9pbml0KCZ3dywgdHJ1ZSk7CityZXRyeToKKwlyZXQgPSBp
OTE1X2dlbV9vYmplY3RfbG9jayhvYmosICZ3dyk7CisJaWYgKCFyZXQgJiYgcGh5c19jdXJzb3Ip
CisJCXJldCA9IGk5MTVfZ2VtX29iamVjdF9hdHRhY2hfcGh5cyhvYmosIGFsaWdubWVudCk7CisJ
aWYgKCFyZXQpCisJCXJldCA9IGk5MTVfZ2VtX29iamVjdF9waW5fcGFnZXMob2JqKTsKKwlpZiAo
cmV0KQogCQlnb3RvIGVycjsKIAotCWlmICh1c2VzX2ZlbmNlICYmIGk5MTVfdm1hX2lzX21hcF9h
bmRfZmVuY2VhYmxlKHZtYSkpIHsKLQkJaW50IHJldDsKKwlpZiAoIXJldCkgeworCQl2bWEgPSBp
OTE1X2dlbV9vYmplY3RfcGluX3RvX2Rpc3BsYXlfcGxhbmUob2JqLCAmd3csIGFsaWdubWVudCwK
KwkJCQkJCQkgICB2aWV3LCBwaW5jdGwpOworCQlpZiAoSVNfRVJSKHZtYSkpIHsKKwkJCXJldCA9
IFBUUl9FUlIodm1hKTsKKwkJCWdvdG8gZXJyX3VucGluOworCQl9CisJfQogCisJaWYgKHVzZXNf
ZmVuY2UgJiYgaTkxNV92bWFfaXNfbWFwX2FuZF9mZW5jZWFibGUodm1hKSkgewogCQkvKgogCQkg
KiBJbnN0YWxsIGEgZmVuY2UgZm9yIHRpbGVkIHNjYW4tb3V0LiBQcmUtaTk2NSBhbHdheXMgbmVl
ZHMgYQogCQkgKiBmZW5jZSwgd2hlcmVhcyA5NjUrIG9ubHkgcmVxdWlyZXMgYSBmZW5jZSBpZiB1
c2luZwpAQCAtMjI0OCwxNiArMjI2NiwyOCBAQCBpbnRlbF9waW5fYW5kX2ZlbmNlX2ZiX29iaihz
dHJ1Y3QgZHJtX2ZyYW1lYnVmZmVyICpmYiwKIAkJcmV0ID0gaTkxNV92bWFfcGluX2ZlbmNlKHZt
YSk7CiAJCWlmIChyZXQgIT0gMCAmJiBJTlRFTF9HRU4oZGV2X3ByaXYpIDwgNCkgewogCQkJaTkx
NV9nZW1fb2JqZWN0X3VucGluX2Zyb21fZGlzcGxheV9wbGFuZSh2bWEpOwotCQkJdm1hID0gRVJS
X1BUUihyZXQpOwotCQkJZ290byBlcnI7CisJCQlnb3RvIGVycl91bnBpbjsKIAkJfQorCQlyZXQg
PSAwOwogCi0JCWlmIChyZXQgPT0gMCAmJiB2bWEtPmZlbmNlKQorCQlpZiAodm1hLT5mZW5jZSkK
IAkJCSpvdXRfZmxhZ3MgfD0gUExBTkVfSEFTX0ZFTkNFOwogCX0KIAogCWk5MTVfdm1hX2dldCh2
bWEpOworCitlcnJfdW5waW46CisJaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKG9iaik7CiBl
cnI6CisJaWYgKHJldCA9PSAtRURFQURMSykgeworCQlyZXQgPSBpOTE1X2dlbV93d19jdHhfYmFj
a29mZigmd3cpOworCQlpZiAoIXJldCkKKwkJCWdvdG8gcmV0cnk7CisJfQorCWk5MTVfZ2VtX3d3
X2N0eF9maW5pKCZ3dyk7CisJaWYgKHJldCkKKwkJdm1hID0gRVJSX1BUUihyZXQpOworCiAJYXRv
bWljX2RlYygmZGV2X3ByaXYtPmdwdV9lcnJvci5wZW5kaW5nX2ZiX3Bpbik7CiAJaW50ZWxfcnVu
dGltZV9wbV9wdXQoJmRldl9wcml2LT5ydW50aW1lX3BtLCB3YWtlcmVmKTsKIAlyZXR1cm4gdm1h
OwpAQCAtMTU1OTgsMTkgKzE1NjI4LDExIEBAIGludCBpbnRlbF9wbGFuZV9waW5fZmIoc3RydWN0
IGludGVsX3BsYW5lX3N0YXRlICpwbGFuZV9zdGF0ZSkKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqZGV2X3ByaXYgPSB0b19pOTE1KHBsYW5lLT5iYXNlLmRldik7CiAJc3RydWN0IGRybV9mcmFt
ZWJ1ZmZlciAqZmIgPSBwbGFuZV9zdGF0ZS0+aHcuZmI7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7
CisJYm9vbCBwaHlzX2N1cnNvciA9CisJCXBsYW5lLT5pZCA9PSBQTEFORV9DVVJTT1IgJiYKKwkJ
SU5URUxfSU5GTyhkZXZfcHJpdiktPmRpc3BsYXkuY3Vyc29yX25lZWRzX3BoeXNpY2FsOwogCi0J
aWYgKHBsYW5lLT5pZCA9PSBQTEFORV9DVVJTT1IgJiYKLQkgICAgSU5URUxfSU5GTyhkZXZfcHJp
diktPmRpc3BsYXkuY3Vyc29yX25lZWRzX3BoeXNpY2FsKSB7Ci0JCXN0cnVjdCBkcm1faTkxNV9n
ZW1fb2JqZWN0ICpvYmogPSBpbnRlbF9mYl9vYmooZmIpOwotCQljb25zdCBpbnQgYWxpZ24gPSBp
bnRlbF9jdXJzb3JfYWxpZ25tZW50KGRldl9wcml2KTsKLQkJaW50IGVycjsKLQotCQllcnIgPSBp
OTE1X2dlbV9vYmplY3RfYXR0YWNoX3BoeXMob2JqLCBhbGlnbik7Ci0JCWlmIChlcnIpCi0JCQly
ZXR1cm4gZXJyOwotCX0KLQotCXZtYSA9IGludGVsX3Bpbl9hbmRfZmVuY2VfZmJfb2JqKGZiLAor
CXZtYSA9IGludGVsX3Bpbl9hbmRfZmVuY2VfZmJfb2JqKGZiLCBwaHlzX2N1cnNvciwKIAkJCQkJ
ICZwbGFuZV9zdGF0ZS0+dmlldywKIAkJCQkJIGludGVsX3BsYW5lX3VzZXNfZmVuY2UocGxhbmVf
c3RhdGUpLAogCQkJCQkgJnBsYW5lX3N0YXRlLT5mbGFncyk7CkBAIC0xNTcwNiwxMyArMTU3Mjgs
OCBAQCBpbnRlbF9wcmVwYXJlX3BsYW5lX2ZiKHN0cnVjdCBkcm1fcGxhbmUgKl9wbGFuZSwKIAlp
ZiAoIW9iaikKIAkJcmV0dXJuIDA7CiAKLQlyZXQgPSBpOTE1X2dlbV9vYmplY3RfcGluX3BhZ2Vz
KG9iaik7Ci0JaWYgKHJldCkKLQkJcmV0dXJuIHJldDsKIAogCXJldCA9IGludGVsX3BsYW5lX3Bp
bl9mYihuZXdfcGxhbmVfc3RhdGUpOwotCi0JaTkxNV9nZW1fb2JqZWN0X3VucGluX3BhZ2VzKG9i
aik7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmggYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9k
aXNwbGF5L2ludGVsX2Rpc3BsYXkuaAppbmRleCA3ZGRiYzAwYTBmNDEuLjk3ZDQ5NDczODA2MCAx
MDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmgK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9kaXNwbGF5LmgKQEAgLTU3
MSw3ICs1NzEsNyBAQCB2b2lkIGludGVsX3JlbGVhc2VfbG9hZF9kZXRlY3RfcGlwZShzdHJ1Y3Qg
ZHJtX2Nvbm5lY3RvciAqY29ubmVjdG9yLAogCQkJCSAgICBzdHJ1Y3QgaW50ZWxfbG9hZF9kZXRl
Y3RfcGlwZSAqb2xkLAogCQkJCSAgICBzdHJ1Y3QgZHJtX21vZGVzZXRfYWNxdWlyZV9jdHggKmN0
eCk7CiBzdHJ1Y3QgaTkxNV92bWEgKgotaW50ZWxfcGluX2FuZF9mZW5jZV9mYl9vYmooc3RydWN0
IGRybV9mcmFtZWJ1ZmZlciAqZmIsCitpbnRlbF9waW5fYW5kX2ZlbmNlX2ZiX29iaihzdHJ1Y3Qg
ZHJtX2ZyYW1lYnVmZmVyICpmYiwgYm9vbCBwaHlzX2N1cnNvciwKIAkJCSAgIGNvbnN0IHN0cnVj
dCBpOTE1X2dndHRfdmlldyAqdmlldywKIAkJCSAgIGJvb2wgdXNlc19mZW5jZSwKIAkJCSAgIHVu
c2lnbmVkIGxvbmcgKm91dF9mbGFncyk7CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9kaXNwbGF5L2ludGVsX2ZiZGV2LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2lu
dGVsX2ZiZGV2LmMKaW5kZXggODQyYzA0ZTYzMjE0Li5iZGY0NGU5MjNjYzAgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2Rpc3BsYXkvaW50ZWxfZmJkZXYuYworKysgYi9kcml2ZXJz
L2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX2ZiZGV2LmMKQEAgLTIxMSw3ICsyMTEsNyBAQCBz
dGF0aWMgaW50IGludGVsZmJfY3JlYXRlKHN0cnVjdCBkcm1fZmJfaGVscGVyICpoZWxwZXIsCiAJ
ICogVGhpcyBhbHNvIHZhbGlkYXRlcyB0aGF0IGFueSBleGlzdGluZyBmYiBpbmhlcml0ZWQgZnJv
bSB0aGUKIAkgKiBCSU9TIGlzIHN1aXRhYmxlIGZvciBvd24gYWNjZXNzLgogCSAqLwotCXZtYSA9
IGludGVsX3Bpbl9hbmRfZmVuY2VfZmJfb2JqKCZpZmJkZXYtPmZiLT5iYXNlLAorCXZtYSA9IGlu
dGVsX3Bpbl9hbmRfZmVuY2VfZmJfb2JqKCZpZmJkZXYtPmZiLT5iYXNlLCBmYWxzZSwKIAkJCQkJ
ICZ2aWV3LCBmYWxzZSwgJmZsYWdzKTsKIAlpZiAoSVNfRVJSKHZtYSkpIHsKIAkJcmV0ID0gUFRS
X0VSUih2bWEpOwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZGlzcGxheS9pbnRl
bF9vdmVybGF5LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9kaXNwbGF5L2ludGVsX292ZXJsYXku
YwppbmRleCA2YmU1ZDg5NDZjNjkuLjEwNDM0ZjVmM2IwMCAxMDA2NDQKLS0tIGEvZHJpdmVycy9n
cHUvZHJtL2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZGlzcGxheS9pbnRlbF9vdmVybGF5LmMKQEAgLTc1Niw2ICs3NTYsMzIgQEAgc3RhdGlj
IHUzMiBvdmVybGF5X2NtZF9yZWcoc3RydWN0IGRybV9pbnRlbF9vdmVybGF5X3B1dF9pbWFnZSAq
cGFyYW1zKQogCXJldHVybiBjbWQ7CiB9CiAKK3N0YXRpYyBzdHJ1Y3QgaTkxNV92bWEgKmludGVs
X292ZXJsYXlfcGluX2ZiKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpuZXdfYm8pCit7CisJ
c3RydWN0IGk5MTVfZ2VtX3d3X2N0eCB3dzsKKwlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKKwlpbnQg
cmV0OworCisJaTkxNV9nZW1fd3dfY3R4X2luaXQoJnd3LCB0cnVlKTsKK3JldHJ5OgorCXJldCA9
IGk5MTVfZ2VtX29iamVjdF9sb2NrKG5ld19ibywgJnd3KTsKKwlpZiAoIXJldCkgeworCQl2bWEg
PSBpOTE1X2dlbV9vYmplY3RfcGluX3RvX2Rpc3BsYXlfcGxhbmUobmV3X2JvLCAmd3csIDAsCisJ
CQkJCQkJICAgTlVMTCwgUElOX01BUFBBQkxFKTsKKwkJcmV0ID0gUFRSX0VSUl9PUl9aRVJPKHZt
YSk7CisJfQorCWlmIChyZXQgPT0gLUVERUFETEspIHsKKwkJcmV0ID0gaTkxNV9nZW1fd3dfY3R4
X2JhY2tvZmYoJnd3KTsKKwkJaWYgKCFyZXQpCisJCQlnb3RvIHJldHJ5OworCX0KKwlpOTE1X2dl
bV93d19jdHhfZmluaSgmd3cpOworCWlmIChyZXQpCisJCXJldHVybiBFUlJfUFRSKHJldCk7CisK
KwlyZXR1cm4gdm1hOworfQorCiBzdGF0aWMgaW50IGludGVsX292ZXJsYXlfZG9fcHV0X2ltYWdl
KHN0cnVjdCBpbnRlbF9vdmVybGF5ICpvdmVybGF5LAogCQkJCSAgICAgIHN0cnVjdCBkcm1faTkx
NV9nZW1fb2JqZWN0ICpuZXdfYm8sCiAJCQkJICAgICAgc3RydWN0IGRybV9pbnRlbF9vdmVybGF5
X3B1dF9pbWFnZSAqcGFyYW1zKQpAQCAtNzc3LDEyICs4MDMsMTAgQEAgc3RhdGljIGludCBpbnRl
bF9vdmVybGF5X2RvX3B1dF9pbWFnZShzdHJ1Y3QgaW50ZWxfb3ZlcmxheSAqb3ZlcmxheSwKIAog
CWF0b21pY19pbmMoJmRldl9wcml2LT5ncHVfZXJyb3IucGVuZGluZ19mYl9waW4pOwogCi0Jdm1h
ID0gaTkxNV9nZW1fb2JqZWN0X3Bpbl90b19kaXNwbGF5X3BsYW5lKG5ld19ibywKLQkJCQkJCSAg
IDAsIE5VTEwsIFBJTl9NQVBQQUJMRSk7Ci0JaWYgKElTX0VSUih2bWEpKSB7Ci0JCXJldCA9IFBU
Ul9FUlIodm1hKTsKKwl2bWEgPSBpbnRlbF9vdmVybGF5X3Bpbl9mYihuZXdfYm8pOworCWlmIChJ
U19FUlIodm1hKSkKIAkJZ290byBvdXRfcGluX3NlY3Rpb247Ci0JfQorCiAJaTkxNV9nZW1fb2Jq
ZWN0X2ZsdXNoX2Zyb250YnVmZmVyKG5ld19ibywgT1JJR0lOX0RJUlRZRkIpOwogCiAJaWYgKCFv
dmVybGF5LT5hY3RpdmUpIHsKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9p
OTE1X2dlbV9kb21haW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9kb21h
aW4uYwppbmRleCBjMWQ0YmY2MmIzZWEuLjUxYTMzYzRmNjFkMCAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX2RvbWFpbi5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9pOTE1X2dlbV9kb21haW4uYwpAQCAtMzEzLDEyICszMTMsMTIgQEAgaW50IGk5
MTVfZ2VtX3NldF9jYWNoaW5nX2lvY3RsKHN0cnVjdCBkcm1fZGV2aWNlICpkZXYsIHZvaWQgKmRh
dGEsCiAgKi8KIHN0cnVjdCBpOTE1X3ZtYSAqCiBpOTE1X2dlbV9vYmplY3RfcGluX3RvX2Rpc3Bs
YXlfcGxhbmUoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKKwkJCQkgICAgIHN0cnVj
dCBpOTE1X2dlbV93d19jdHggKnd3LAogCQkJCSAgICAgdTMyIGFsaWdubWVudCwKIAkJCQkgICAg
IGNvbnN0IHN0cnVjdCBpOTE1X2dndHRfdmlldyAqdmlldywKIAkJCQkgICAgIHVuc2lnbmVkIGlu
dCBmbGFncykKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IHRvX2k5MTUob2Jq
LT5iYXNlLmRldik7Ci0Jc3RydWN0IGk5MTVfZ2VtX3d3X2N0eCB3dzsKIAlzdHJ1Y3QgaTkxNV92
bWEgKnZtYTsKIAlpbnQgcmV0OwogCkBAIC0zMjYsMTEgKzMyNiw2IEBAIGk5MTVfZ2VtX29iamVj
dF9waW5fdG9fZGlzcGxheV9wbGFuZShzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAog
CWlmIChIQVNfTE1FTShpOTE1KSAmJiAhaTkxNV9nZW1fb2JqZWN0X2lzX2xtZW0ob2JqKSkKIAkJ
cmV0dXJuIEVSUl9QVFIoLUVJTlZBTCk7CiAKLQlpOTE1X2dlbV93d19jdHhfaW5pdCgmd3csIHRy
dWUpOwotcmV0cnk6Ci0JcmV0ID0gaTkxNV9nZW1fb2JqZWN0X2xvY2sob2JqLCAmd3cpOwotCWlm
IChyZXQpCi0JCWdvdG8gZXJyOwogCS8qCiAJICogVGhlIGRpc3BsYXkgZW5naW5lIGlzIG5vdCBj
b2hlcmVudCB3aXRoIHRoZSBMTEMgY2FjaGUgb24gZ2VuNi4gIEFzCiAJICogYSByZXN1bHQsIHdl
IG1ha2Ugc3VyZSB0aGF0IHRoZSBwaW5uaW5nIHRoYXQgaXMgYWJvdXQgdG8gb2NjdXIgaXMKQEAg
LTM0NSw3ICszNDAsNyBAQCBpOTE1X2dlbV9vYmplY3RfcGluX3RvX2Rpc3BsYXlfcGxhbmUoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwKIAkJCQkJICAgICAgSEFTX1dUKGk5MTUpID8K
IAkJCQkJICAgICAgSTkxNV9DQUNIRV9XVCA6IEk5MTVfQ0FDSEVfTk9ORSk7CiAJaWYgKHJldCkK
LQkJZ290byBlcnI7CisJCXJldHVybiBFUlJfUFRSKHJldCk7CiAKIAkvKgogCSAqIEFzIHRoZSB1
c2VyIG1heSBtYXAgdGhlIGJ1ZmZlciBvbmNlIHBpbm5lZCBpbiB0aGUgZGlzcGxheSBwbGFuZQpA
QCAtMzU4LDMyICszNTMsMTkgQEAgaTkxNV9nZW1fb2JqZWN0X3Bpbl90b19kaXNwbGF5X3BsYW5l
KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJdm1hID0gRVJSX1BUUigtRU5PU1BD
KTsKIAlpZiAoKGZsYWdzICYgUElOX01BUFBBQkxFKSA9PSAwICYmCiAJICAgICghdmlldyB8fCB2
aWV3LT50eXBlID09IEk5MTVfR0dUVF9WSUVXX05PUk1BTCkpCi0JCXZtYSA9IGk5MTVfZ2VtX29i
amVjdF9nZ3R0X3Bpbl93dyhvYmosICZ3dywgdmlldywgMCwgYWxpZ25tZW50LAorCQl2bWEgPSBp
OTE1X2dlbV9vYmplY3RfZ2d0dF9waW5fd3cob2JqLCB3dywgdmlldywgMCwgYWxpZ25tZW50LAog
CQkJCQkJICBmbGFncyB8IFBJTl9NQVBQQUJMRSB8CiAJCQkJCQkgIFBJTl9OT05CTE9DSyk7CiAJ
aWYgKElTX0VSUih2bWEpICYmIHZtYSAhPSBFUlJfUFRSKC1FREVBRExLKSkKLQkJdm1hID0gaTkx
NV9nZW1fb2JqZWN0X2dndHRfcGluX3d3KG9iaiwgJnd3LCB2aWV3LCAwLAorCQl2bWEgPSBpOTE1
X2dlbV9vYmplY3RfZ2d0dF9waW5fd3cob2JqLCB3dywgdmlldywgMCwKIAkJCQkJCSAgYWxpZ25t
ZW50LCBmbGFncyk7Ci0JaWYgKElTX0VSUih2bWEpKSB7Ci0JCXJldCA9IFBUUl9FUlIodm1hKTsK
LQkJZ290byBlcnI7Ci0JfQorCWlmIChJU19FUlIodm1hKSkKKwkJcmV0dXJuIHZtYTsKIAogCXZt
YS0+ZGlzcGxheV9hbGlnbm1lbnQgPSBtYXhfdCh1NjQsIHZtYS0+ZGlzcGxheV9hbGlnbm1lbnQs
IGFsaWdubWVudCk7CiAKIAlpOTE1X2dlbV9vYmplY3RfZmx1c2hfaWZfZGlzcGxheV9sb2NrZWQo
b2JqKTsKIAotZXJyOgotCWlmIChyZXQgPT0gLUVERUFETEspIHsKLQkJcmV0ID0gaTkxNV9nZW1f
d3dfY3R4X2JhY2tvZmYoJnd3KTsKLQkJaWYgKCFyZXQpCi0JCQlnb3RvIHJldHJ5OwotCX0KLQlp
OTE1X2dlbV93d19jdHhfZmluaSgmd3cpOwotCi0JaWYgKHJldCkKLQkJcmV0dXJuIEVSUl9QVFIo
cmV0KTsKLQogCXJldHVybiB2bWE7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9vYmplY3QuaAppbmRleCBhYWE1NzQ1NDU3NzYuLjBjMzU3ZTkxZGNlNCAxMDA2NDQKLS0t
IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX29iamVjdC5oCisrKyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9vYmplY3QuaApAQCAtNDcyLDYgKzQ3Miw3IEBA
IGludCBfX211c3RfY2hlY2sKIGk5MTVfZ2VtX29iamVjdF9zZXRfdG9fY3B1X2RvbWFpbihzdHJ1
Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLCBib29sIHdyaXRlKTsKIHN0cnVjdCBpOTE1X3Zt
YSAqIF9fbXVzdF9jaGVjawogaTkxNV9nZW1fb2JqZWN0X3Bpbl90b19kaXNwbGF5X3BsYW5lKHN0
cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCisJCQkJICAgICBzdHJ1Y3QgaTkxNV9nZW1f
d3dfY3R4ICp3dywKIAkJCQkgICAgIHUzMiBhbGlnbm1lbnQsCiAJCQkJICAgICBjb25zdCBzdHJ1
Y3QgaTkxNV9nZ3R0X3ZpZXcgKnZpZXcsCiAJCQkJICAgICB1bnNpZ25lZCBpbnQgZmxhZ3MpOwpk
aWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BoeXMuYyBiL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9waHlzLmMKaW5kZXggMGQxNzZiZjA2NDA1
Li5mMzE3YmU1ZjVlMzQgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1
X2dlbV9waHlzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BoeXMu
YwpAQCAtMjE5LDYgKzIxOSw4IEBAIGludCBpOTE1X2dlbV9vYmplY3RfYXR0YWNoX3BoeXMoc3Ry
dWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaiwgaW50IGFsaWduKQogewogCWludCBlcnI7CiAK
Kwlhc3NlcnRfb2JqZWN0X2hlbGQob2JqKTsKKwogCWlmIChhbGlnbiA+IG9iai0+YmFzZS5zaXpl
KQogCQlyZXR1cm4gLUVJTlZBTDsKIApAQCAtMjMyLDEzICsyMzQsOSBAQCBpbnQgaTkxNV9nZW1f
b2JqZWN0X2F0dGFjaF9waHlzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosIGludCBh
bGlnbikKIAlpZiAoZXJyKQogCQlyZXR1cm4gZXJyOwogCi0JZXJyID0gaTkxNV9nZW1fb2JqZWN0
X2xvY2tfaW50ZXJydXB0aWJsZShvYmosIE5VTEwpOwotCWlmIChlcnIpCi0JCXJldHVybiBlcnI7
Ci0KIAllcnIgPSBtdXRleF9sb2NrX2ludGVycnVwdGlibGUoJm9iai0+bW0ubG9jayk7CiAJaWYg
KGVycikKLQkJZ290byBlcnJfdW5sb2NrOworCQlyZXR1cm4gZXJyOwogCiAJaWYgKHVubGlrZWx5
KCFpOTE1X2dlbV9vYmplY3RfaGFzX3N0cnVjdF9wYWdlKG9iaikpKQogCQlnb3RvIG91dDsKQEAg
LTI2OSw4ICsyNjcsNiBAQCBpbnQgaTkxNV9nZW1fb2JqZWN0X2F0dGFjaF9waHlzKHN0cnVjdCBk
cm1faTkxNV9nZW1fb2JqZWN0ICpvYmosIGludCBhbGlnbikKIAogb3V0OgogCW11dGV4X3VubG9j
aygmb2JqLT5tbS5sb2NrKTsKLWVycl91bmxvY2s6Ci0JaTkxNV9nZW1fb2JqZWN0X3VubG9jayhv
YmopOwogCXJldHVybiBlcnI7CiB9CiAKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1
L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fcGh5cy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L3NlbGZ0ZXN0cy9pOTE1X2dlbV9waHlzLmMKaW5kZXggMGNmYTA4MjA0N2ZlLi4zYTZjZTg3Zjhi
NTIgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9n
ZW1fcGh5cy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9n
ZW1fcGh5cy5jCkBAIC0zMSw3ICszMSw5IEBAIHN0YXRpYyBpbnQgbW9ja19waHlzX29iamVjdCh2
b2lkICphcmcpCiAJCWdvdG8gb3V0X29iajsKIAl9CiAKKwlpOTE1X2dlbV9vYmplY3RfbG9jayhv
YmosIE5VTEwpOwogCWVyciA9IGk5MTVfZ2VtX29iamVjdF9hdHRhY2hfcGh5cyhvYmosIFBBR0Vf
U0laRSk7CisJaTkxNV9nZW1fb2JqZWN0X3VubG9jayhvYmopOwogCWlmIChlcnIpIHsKIAkJcHJf
ZXJyKCJpOTE1X2dlbV9vYmplY3RfYXR0YWNoX3BoeXMgZmFpbGVkLCBlcnI9JWRcbiIsIGVycik7
CiAJCWdvdG8gb3V0X29iajsKLS0gCjIuMzAuMC5yYzEKCl9fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwtZ2Z4
QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9tYWls
bWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

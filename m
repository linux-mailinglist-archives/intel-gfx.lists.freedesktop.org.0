Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 4FD491410AB
	for <lists+intel-gfx@lfdr.de>; Fri, 17 Jan 2020 19:19:55 +0100 (CET)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 9F9B46F89C;
	Fri, 17 Jan 2020 18:19:49 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B078D6F897;
 Fri, 17 Jan 2020 18:19:44 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 19921006-1500050 
 for multiple; Fri, 17 Jan 2020 18:19:29 +0000
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 17 Jan 2020 18:19:21 +0000
Message-Id: <20200117181925.3249942-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.25.0
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH i-g-t 1/5] lib/intel_bufops: Introduce buffer
 operations
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: igt-dev@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogWmJpZ25pZXcgS2VtcGN6ecWEc2tpIDx6Ymlnbmlldy5rZW1wY3p5bnNraUBpbnRlbC5j
b20+CgpEaWZmZXJlbnQgR0VOcyBzdXBwb3J0cyBkaWZmZXJlbnQgdGlsZSBzdXJmYWNlcy4gT2xk
ZXIgR0VOcwpoYXZlIEhXIGZlbmNlcyB0byBhbGxvdyBYIC8gWSBzdXJmYWNlIHRpbGluZyAvIGRl
dGlsaW5nLgpOZXdlciBHRU5zIGhhdmUgdG8gdGlsZSAvIGRldGlsZSBzdWNoIHN1cmZhY2UgaW4g
c29mdHdhcmUuCgpUbyBtYWtlIHRlc3QgZGV2ZWxvcGVyIGxpZmUgZWFzaWVyIHRoaXMgY29kZSBh
ZGRzIGJ1ZmZlcgpvcGVyYXRpb25zIChzaG9ydCBidWZfb3BzKSB0byB1c2UgYXBwcm9wcmlhdGUg
ZnVuY3Rpb25zIGFsbG93aW5nCmNvcHlpbmcgbGluZWFyIGJ1ZmZlciB0byBCTyBhbmQgZnJvbSBC
TyB0byBsaW5lYXIgYnVmZmVyCnJlZ2FyZGxlc3MgR1BVIGdlbmVyYXRpb24gYW5kIHRpbGluZy9z
d2l6emxpbmcgd2l0aGluIEJPLiBGb3IgR0VOcwpoYXZpbmcgZmVuY2VzIHN1cHBvcnQgcHJlZmVy
ZW5jZSBpcyB0byB1c2UgdGhlbSBpZiB0aGV5IGFyZSBhdmFpbGFibGUKKFggLyBZIHRpbGluZyBp
cyBwcm9iZWQgb24gYnVmX29wcyBpbml0aWFsaXphdGlvbikuCgpOb3RlOiBvbiBHZW4yIGNvZGUg
c3VwcG9ydHMgb25seSBIVyB0aWxpbmcgYXQgdGhlIG1vbWVudC4KClNpZ25lZC1vZmYtYnk6IFpi
aWduaWV3IEtlbXBjennFhHNraSA8emJpZ25pZXcua2VtcGN6eW5za2lAaW50ZWwuY29tPgpDYzog
Q2hyaXMgV2lsc29uIDxjaHJpc0BjaHJpcy13aWxzb24uY28udWs+CkNjOiBLYXRhcnp5bmEgRGVj
IDxrYXRhcnp5bmEuZGVjQGludGVsLmNvbT4KUmV2aWV3ZWQtYnk6IENocmlzIFdpbHNvbiA8Y2hy
aXNAY2hyaXMtd2lsc29uLmNvLnVrPgotLS0KIC4uLi9pZ3QtZ3B1LXRvb2xzL2lndC1ncHUtdG9v
bHMtZG9jcy54bWwgICAgICB8ICAgIDEgKwogbGliL01ha2VmaWxlLnNvdXJjZXMgICAgICAgICAg
ICAgICAgICAgICAgICAgIHwgICAgMiArCiBsaWIvaW50ZWxfYnVmb3BzLmMgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgfCAxMTU3ICsrKysrKysrKysrKysrKysrCiBsaWIvaW50ZWxfYnVmb3Bz
LmggICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgIDg2ICsrCiBsaWIvbWVzb24uYnVpbGQg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfCAgICAxICsKIDUgZmlsZXMgY2hhbmdlZCwg
MTI0NyBpbnNlcnRpb25zKCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgbGliL2ludGVsX2J1Zm9wcy5j
CiBjcmVhdGUgbW9kZSAxMDA2NDQgbGliL2ludGVsX2J1Zm9wcy5oCgpkaWZmIC0tZ2l0IGEvZG9j
cy9yZWZlcmVuY2UvaWd0LWdwdS10b29scy9pZ3QtZ3B1LXRvb2xzLWRvY3MueG1sIGIvZG9jcy9y
ZWZlcmVuY2UvaWd0LWdwdS10b29scy9pZ3QtZ3B1LXRvb2xzLWRvY3MueG1sCmluZGV4IDQ1NGQ2
NGU1My4uYWE5ZmVmMjA1IDEwMDY0NAotLS0gYS9kb2NzL3JlZmVyZW5jZS9pZ3QtZ3B1LXRvb2xz
L2lndC1ncHUtdG9vbHMtZG9jcy54bWwKKysrIGIvZG9jcy9yZWZlcmVuY2UvaWd0LWdwdS10b29s
cy9pZ3QtZ3B1LXRvb2xzLWRvY3MueG1sCkBAIC00Miw2ICs0Miw3IEBACiAgICAgPHhpOmluY2x1
ZGUgaHJlZj0ieG1sL2lndF92Z2VtLnhtbCIvPgogICAgIDx4aTppbmNsdWRlIGhyZWY9InhtbC9p
Z3RfeDg2LnhtbCIvPgogICAgIDx4aTppbmNsdWRlIGhyZWY9InhtbC9pbnRlbF9iYXRjaGJ1ZmZl
ci54bWwiLz4KKyAgICA8eGk6aW5jbHVkZSBocmVmPSJ4bWwvaW50ZWxfYnVmb3BzLnhtbCIvPgog
ICAgIDx4aTppbmNsdWRlIGhyZWY9InhtbC9pbnRlbF9jaGlwc2V0LnhtbCIvPgogICAgIDx4aTpp
bmNsdWRlIGhyZWY9InhtbC9pbnRlbF9pby54bWwiLz4KICAgICA8eGk6aW5jbHVkZSBocmVmPSJ4
bWwvaW9jdGxfd3JhcHBlcnMueG1sIi8+CmRpZmYgLS1naXQgYS9saWIvTWFrZWZpbGUuc291cmNl
cyBiL2xpYi9NYWtlZmlsZS5zb3VyY2VzCmluZGV4IDVkZDM5NjJlZS4uZGEzNGVhZTczIDEwMDY0
NAotLS0gYS9saWIvTWFrZWZpbGUuc291cmNlcworKysgYi9saWIvTWFrZWZpbGUuc291cmNlcwpA
QCAtNjcsNiArNjcsOCBAQCBsaWJfc291cmNlX2xpc3QgPQkgCVwKIAlpbnRlbF9hdWIuaAkJXAog
CWludGVsX2JhdGNoYnVmZmVyLmMJXAogCWludGVsX2JhdGNoYnVmZmVyLmgJXAorCWludGVsX2J1
Zm9wcy5jCQlcCisJaW50ZWxfYnVmb3BzLmgJCVwKIAlpbnRlbF9jaGlwc2V0LmMJCVwKIAlpbnRl
bF9jaGlwc2V0LmgJCVwKIAlpbnRlbF9kZXZpY2VfaW5mby5jCVwKZGlmZiAtLWdpdCBhL2xpYi9p
bnRlbF9idWZvcHMuYyBiL2xpYi9pbnRlbF9idWZvcHMuYwpuZXcgZmlsZSBtb2RlIDEwMDY0NApp
bmRleCAwMDAwMDAwMDAuLjgwNGIyYTBhZQotLS0gL2Rldi9udWxsCisrKyBiL2xpYi9pbnRlbF9i
dWZvcHMuYwpAQCAtMCwwICsxLDExNTcgQEAKKy8qCisgKiBDb3B5cmlnaHQgwqkgMjAyMCBJbnRl
bCBDb3Jwb3JhdGlvbgorICoKKyAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUg
b2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhCisgKiBjb3B5IG9mIHRoaXMgc29m
dHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIp
LAorICogdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVk
aW5nIHdpdGhvdXQgbGltaXRhdGlvbgorICogdGhlIHJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlm
eSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsCisgKiBhbmQvb3Igc2Vs
bCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0
aGUKKyAqIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9s
bG93aW5nIGNvbmRpdGlvbnM6CisgKgorICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5k
IHRoaXMgcGVybWlzc2lvbiBub3RpY2UgKGluY2x1ZGluZyB0aGUgbmV4dAorICogcGFyYWdyYXBo
KSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25z
IG9mIHRoZQorICogU29mdHdhcmUuCisgKgorICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJB
UyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKKyAqIElNUExJ
RUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hB
TlRBQklMSVRZLAorICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklO
RlJJTkdFTUVOVC4gIElOIE5PIEVWRU5UIFNIQUxMCisgKiBUSEUgQVVUSE9SUyBPUiBDT1BZUklH
SFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgorICog
TElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhF
UldJU0UsIEFSSVNJTkcKKyAqIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhF
IFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MKKyAqIElOIFRIRSBTT0ZUV0FS
RS4KKyAqCisgKi8KKworI2luY2x1ZGUgPHN5cy9pb2N0bC5oPgorI2luY2x1ZGUgImlndC5oIgor
I2luY2x1ZGUgImlndF94ODYuaCIKKyNpbmNsdWRlICJpbnRlbF9idWZvcHMuaCIKKworLyoqCisg
KiBTRUNUSU9OOmludGVsX2J1Zm9wcworICogQHNob3J0X2Rlc2NyaXB0aW9uOiBCdWZmZXIgb3Bl
cmF0aW9uIG9uIHRpbGVkIHN1cmZhY2VzCisgKiBAdGl0bGU6IEJ1ZmZlciBvcGVyYXRpb25zCisg
KiBAaW5jbHVkZTogaWd0LmgKKyAqCisgKiAjIEJ1ZmZlciBvcGVyYXRpb25zCisgKgorICogSW50
ZWwgR1BVIGRldmljZXMgc3VwcG9ydHMgZGlmZmVyZW50IHNldCBvZiB0aWxlZCBzdXJmYWNlcy4K
KyAqIENoZWNraW5nIGVhY2ggdGltZSB3aGF0IHRpbGUgZm9ybWF0cyBhcmUgc3VwcG9ydHMgaXMg
Y3VtYmVyc29tZSBhbmQKKyAqIGVycm9yIHByb25lLgorICoKKyAqIEJ1ZmZlciBvcGVyYXRpb24g
KGJ1Zl9vcHMpIHByb3ZpZGUgYSB3cmFwcGVyIHRvIGNvbmRpdGlvbmFsIGNvZGUgd2hpY2gKKyAq
IGNhbiBiZSB1c2VkIHdpdGhvdXQgd29ycnlpbmcgb2YgaW1wbGVtZW50YXRpb24gZGV0YWlscyBn
aXZpbmc6CisgKiAtIGNvcHkgbGluZWFyIHRvIHRpbGVkIGJ1ZmZlcgorICogLSBjb3B5IHRpbGVk
IGJ1ZmZlciB0byBsaW5lYXIKKyAqCisgKiBGb2xsb3dpbmcgY29kZSBvcmRlciBzaG91bGQgYmUg
dXNlZCAobGluZWFyIGlzIHBsYWluIG1lbW9yeSB3aXRoIHNvbWUKKyAqIGltYWdlIGRhdGEpOgor
ICoKKyAqIHxbPCEtLSBsYW5ndWFnZT0iYyIgLS0+CisgKiBzdHJ1Y3QgYnVmX29wcyAqYm9wczsK
KyAqIHN0cnVjdCBpbnRlbF9idWYgaWJ1ZjsKKyAqIC4uLgorICogYm9wcyA9IGJ1Zl9vcHNfY3Jl
YXRlKGZkKTsKKyAqIGludGVsX2J1Zl9pbml0KGJvcHMsICZpYnVmLCA1MTIsIDUxMiwgMzIsIEk5
MTVfVElMSU5HX1gsIGZhbHNlKTsKKyAqIC4uLgorICogbGluZWFyX3RvX2ludGVsX2J1Zihib3Bz
LCAmaWJ1ZiwgbGluZWFyKTsKKyAqIC4uLgorICogaW50ZWxfYnVmX3RvX2xpbmVhcihib3BzLCAm
aWJ1ZiwgbGluZWFyKTsKKyAqIC4uLgorICogaW50ZWxfYnVmX2Nsb3NlKGJvcHMsICZpYnVmKTsK
KyAqIC4uLgorICogYnVmX29wc19kZXN0cm95KGJvcHMpOworICogXXwKKyAqCisgKiBDYWxsaW5n
IGJ1Zl9vcHNfY3JlYXRlKGZkKSBwcm9iZXMgaGFyZHdhcmUgY2FwYWJpbGl0aWVzIChzdXBwb3J0
ZWQgZmVuY2VzLAorICogc3dpenpsaW5nKSBhbmQgcmV0dXJucyBvcGFxdWUgcG9pbnRlciB0byBi
dWZfb3BzLiBGcm9tIG5vdyBvbgorICogaW50ZWxfYnVmX3RvX2xpbmVhcigpIGFuZCBsaW5lYXJf
dG9faW50ZWxfYnVmKCkgd2lsbCBjaG9vc2UgYXBwcm9wcmlhdGUKKyAqIGZ1bmN0aW9uIHRvIGRv
IHRoZSBqb2IuCisgKgorICogTm90ZTogYnVmb3BzIGRvZXNuJ3Qgc3VwcG9ydCBTVyB0aWxpbmcg
Y29kZSB5ZXQuCisgKi8KKworLy8jZGVmaW5lIEJVRk9QU19ERUJVR0dJTkcKKyNpZmRlZiBCVUZP
UFNfREVCVUdHSU5HCisjZGVmaW5lIERFQlVHKC4uLikgcHJpbnRmKF9fVkFfQVJHU19fKQorI2Rl
ZmluZSBERUJVR0ZOKCkgREVCVUcoIlx0IC0+ICVzKClcbiIsIF9fRlVOQ1RJT05fXykKKyNlbHNl
CisjZGVmaW5lIERFQlVHKC4uLikKKyNkZWZpbmUgREVCVUdGTigpCisjZW5kaWYKKworI2RlZmlu
ZSBUSUxFX0RFRih4KSAoMSA8PCAoeCkpCisjZGVmaW5lIFRJTEVfTk9ORSAgIFRJTEVfREVGKEk5
MTVfVElMSU5HX05PTkUpCisjZGVmaW5lIFRJTEVfWCAgICAgIFRJTEVfREVGKEk5MTVfVElMSU5H
X1gpCisjZGVmaW5lIFRJTEVfWSAgICAgIFRJTEVfREVGKEk5MTVfVElMSU5HX1kpCisjZGVmaW5l
IFRJTEVfWWYgICAgIFRJTEVfREVGKEk5MTVfVElMSU5HX1lmKQorI2RlZmluZSBUSUxFX1lzICAg
ICBUSUxFX0RFRihJOTE1X1RJTElOR19ZcykKKworI2RlZmluZSBDQ1NfT0ZGU0VUKGJ1ZikgKGJ1
Zi0+YXV4Lm9mZnNldCkKKyNkZWZpbmUgQ0NTX1NJWkUoZ2VuLCBidWYpIFwKKwkoaW50ZWxfYnVm
X2F1eF93aWR0aChnZW4sIGJ1ZikgKiBpbnRlbF9idWZfYXV4X2hlaWdodChnZW4sIGJ1ZikpCisK
K3R5cGVkZWYgdm9pZCAoKmJvX2NvcHkpKHN0cnVjdCBidWZfb3BzICosIHN0cnVjdCBpbnRlbF9i
dWYgKiwgdWludDMyX3QgKik7CisKK3N0cnVjdCBidWZfb3BzIHsKKwlpbnQgZmQ7CisJaW50IGdl
bl9zdGFydDsKKwlpbnQgZ2VuX2VuZDsKKwlpbnQgaW50ZWxfZ2VuOworCXVpbnQzMl90IHN1cHBv
cnRlZF90aWxlczsKKwl1aW50MzJfdCBzdXBwb3J0ZWRfaHdfdGlsZXM7CisJdWludDMyX3Qgc3dp
enpsZV94OworCXVpbnQzMl90IHN3aXp6bGVfeTsKKwlib19jb3B5IGxpbmVhcl90bzsKKwlib19j
b3B5IGxpbmVhcl90b194OworCWJvX2NvcHkgbGluZWFyX3RvX3k7CisJYm9fY29weSBsaW5lYXJf
dG9feWY7CisJYm9fY29weSBsaW5lYXJfdG9feXM7CisJYm9fY29weSB0b19saW5lYXI7CisJYm9f
Y29weSB4X3RvX2xpbmVhcjsKKwlib19jb3B5IHlfdG9fbGluZWFyOworCWJvX2NvcHkgeWZfdG9f
bGluZWFyOworCWJvX2NvcHkgeXNfdG9fbGluZWFyOworfTsKKworc3RhdGljIGNvbnN0IGNoYXIg
KnRpbGluZ19zdHIodWludDMyX3QgdGlsaW5nKQoreworCXN3aXRjaCAodGlsaW5nKSB7CisJY2Fz
ZSBJOTE1X1RJTElOR19OT05FOiByZXR1cm4gIk5PTkUiOworCWNhc2UgSTkxNV9USUxJTkdfWDog
ICAgcmV0dXJuICJYIjsKKwljYXNlIEk5MTVfVElMSU5HX1k6ICAgIHJldHVybiAiWSI7CisJY2Fz
ZSBJOTE1X1RJTElOR19ZZjogICByZXR1cm4gIllmIjsKKwljYXNlIEk5MTVfVElMSU5HX1lzOiAg
IHJldHVybiAiWXMiOworCWRlZmF1bHQ6ICAgICAgICAgICAgICAgcmV0dXJuICJVTktOT1dOIjsK
Kwl9Cit9CisKK3N0YXRpYyBjb25zdCBjaGFyICpib29sX3N0cihib29sIHYpCit7CisJcmV0dXJu
IHYgPyAieWVzIiA6ICJubyI7Cit9CisKK3N0YXRpYyBpbmxpbmUgYm9vbCBpc19od190aWxpbmdf
c3VwcG9ydGVkKHN0cnVjdCBidWZfb3BzICpib3BzLCB1aW50MzJfdCB0aWxpbmcpCit7CisJcmV0
dXJuIGJvcHMtPnN1cHBvcnRlZF9od190aWxlcyAmIFRJTEVfREVGKHRpbGluZyk7Cit9CisKK3N0
YXRpYyBpbmxpbmUgYm9vbCBpc190aWxpbmdfc3VwcG9ydGVkKHN0cnVjdCBidWZfb3BzICpib3Bz
LCB1aW50MzJfdCB0aWxpbmcpCit7CisJcmV0dXJuIGJvcHMtPnN1cHBvcnRlZF90aWxlcyAmIFRJ
TEVfREVGKHRpbGluZyk7Cit9CisKK3N0YXRpYyBpbnQgX19nZW1fZ2V0X3RpbGluZyhpbnQgZmQs
IHN0cnVjdCBkcm1faTkxNV9nZW1fZ2V0X3RpbGluZyAqYXJnKQoreworCWludCBlcnI7CisKKwll
cnIgPSAwOworCWlmIChpZ3RfaW9jdGwoZmQsIERSTV9JT0NUTF9JOTE1X0dFTV9HRVRfVElMSU5H
LCBhcmcpKSB7CisJCWVyciA9IC1lcnJubzsKKwkJaWd0X2Fzc3VtZShlcnIpOworCX0KKwllcnJu
byA9IDA7CisKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgYm9vbCBfX2dldF90aWxpbmcoaW50
IGZkLCB1aW50MzJfdCBoYW5kbGUsIHVpbnQzMl90ICp0aWxpbmcsCisJCQkgdWludDMyX3QgKnN3
aXp6bGUpCit7CisJc3RydWN0IGRybV9pOTE1X2dlbV9nZXRfdGlsaW5nIGdldF90aWxpbmcgPSB7
IC5oYW5kbGUgPSBoYW5kbGUgfTsKKworCWlmIChfX2dlbV9nZXRfdGlsaW5nKGZkLCAmZ2V0X3Rp
bGluZykgIT0gMCkKKwkJcmV0dXJuIGZhbHNlOworCisJKnRpbGluZyA9IGdldF90aWxpbmcudGls
aW5nX21vZGU7CisJKnN3aXp6bGUgPSBnZXRfdGlsaW5nLnN3aXp6bGVfbW9kZTsKKwlpZ3RfZGVi
dWcoImJ1ZiB0aWxpbmc6ICVzLCBzd2l6emxlOiAleCwgcGh5c19zd2l6emxlOiAleFxuIiwKKwkJ
ICB0aWxpbmdfc3RyKGdldF90aWxpbmcudGlsaW5nX21vZGUpLAorCQkgIGdldF90aWxpbmcuc3dp
enpsZV9tb2RlLAorCQkgIGdldF90aWxpbmcucGh5c19zd2l6emxlX21vZGUpOworCisJcmV0dXJu
IGdldF90aWxpbmcucGh5c19zd2l6emxlX21vZGUgPT0gZ2V0X3RpbGluZy5zd2l6emxlX21vZGU7
Cit9CisKK3N0YXRpYyBpbnQgX19zZXRfdGlsaW5nKGludCBmZCwgdWludDMyX3QgaGFuZGxlLCB1
aW50MzJfdCB0aWxpbmcsCisJCQl1aW50MzJfdCBzdHJpZGUpCit7CisJZG8geworCQlzdHJ1Y3Qg
ZHJtX2k5MTVfZ2VtX3NldF90aWxpbmcgc3Q7CisJCWludCBlcnI7CisKKwkJc3QuaGFuZGxlID0g
aGFuZGxlOworCQlzdC50aWxpbmdfbW9kZSA9IHRpbGluZzsKKwkJc3Quc3RyaWRlID0gdGlsaW5n
ID8gc3RyaWRlIDogMDsKKworCQllcnIgPSAwOworCQlpZiAoaW9jdGwoZmQsIERSTV9JT0NUTF9J
OTE1X0dFTV9TRVRfVElMSU5HLCAmc3QpKQorCQkJZXJyID0gLWVycm5vOworCQllcnJubyA9IDA7
CisJCWlmIChlcnIgIT0gLUVJTlRSKQorCQkJcmV0dXJuIGVycjsKKwl9IHdoaWxlICgxKTsKK30K
Kworc3RhdGljIHZvaWQgc2V0X2h3X3RpbGVkKHN0cnVjdCBidWZfb3BzICpib3BzLCBzdHJ1Y3Qg
aW50ZWxfYnVmICpidWYpCit7CisJaWYgKGJ1Zi0+dGlsaW5nICE9IEk5MTVfVElMSU5HX1ggJiYg
YnVmLT50aWxpbmcgIT0gSTkxNV9USUxJTkdfWSkKKwkJcmV0dXJuOworCisJaWYgKCFidWZfb3Bz
X2hhc19od19mZW5jZShib3BzLCBidWYtPnRpbGluZykpCisJCXJldHVybjsKKworCWlndF9hc3Nl
cnRfZXEoX19zZXRfdGlsaW5nKGJvcHMtPmZkLAorCQkJCSAgIGJ1Zi0+aGFuZGxlLCBidWYtPnRp
bGluZywgYnVmLT5zdHJpZGUpLAorCQkgICAgICAwKTsKK30KKworc3RhdGljIHVuc2lnbmVkIGxv
bmcgc3dpenpsZV9iaXQodW5zaWduZWQgaW50IGJpdCwgdW5zaWduZWQgbG9uZyBvZmZzZXQpCit7
CisJcmV0dXJuIChvZmZzZXQgJiAoMXVsIDw8IGJpdCkpID4+IChiaXQgLSA2KTsKK30KKworc3Rh
dGljIHVuc2lnbmVkIGxvbmcgc3dpenpsZV9hZGRyKHZvaWQgKnB0ciwgdWludDMyX3Qgc3dpenps
ZSkKK3sKKwl1bnNpZ25lZCBsb25nIGFkZHIgPSB0b191c2VyX3BvaW50ZXIocHRyKTsKKworCXN3
aXRjaCAoc3dpenpsZSkgeworCWNhc2UgSTkxNV9CSVRfNl9TV0laWkxFX05PTkU6CisJCXJldHVy
biBhZGRyOworCWNhc2UgSTkxNV9CSVRfNl9TV0laWkxFXzk6CisJCXJldHVybiBhZGRyIF4gc3dp
enpsZV9iaXQoOSwgYWRkcik7CisJY2FzZSBJOTE1X0JJVF82X1NXSVpaTEVfOV8xMDoKKwkJcmV0
dXJuIGFkZHIgXiBzd2l6emxlX2JpdCg5LCBhZGRyKSBeIHN3aXp6bGVfYml0KDEwLCBhZGRyKTsK
KwljYXNlIEk5MTVfQklUXzZfU1dJWlpMRV85XzExOgorCQlyZXR1cm4gYWRkciBeIHN3aXp6bGVf
Yml0KDksIGFkZHIpIF4gc3dpenpsZV9iaXQoMTEsIGFkZHIpOworCWNhc2UgSTkxNV9CSVRfNl9T
V0laWkxFXzlfMTBfMTE6CisJCXJldHVybiAoYWRkciBeCisJCQlzd2l6emxlX2JpdCg5LCBhZGRy
KSBeCisJCQlzd2l6emxlX2JpdCgxMCwgYWRkcikgXgorCQkJc3dpenpsZV9iaXQoMTEsIGFkZHIp
KTsKKworCWNhc2UgSTkxNV9CSVRfNl9TV0laWkxFX1VOS05PV046CisJY2FzZSBJOTE1X0JJVF82
X1NXSVpaTEVfOV8xNzoKKwljYXNlIEk5MTVfQklUXzZfU1dJWlpMRV85XzEwXzE3OgorCWRlZmF1
bHQ6CisJCWlndF9za2lwKCJwaHlzaWNhbCBzd2l6emxpbmcgbW9kZSBpbXBvc3NpYmxlIHRvIGhh
bmRsZSBpbiB1c2Vyc3BhY2VcbiIpOworCQlyZXR1cm4gYWRkcjsKKwl9Cit9CisKK3N0YXRpYyB2
b2lkICp4X3B0cih2b2lkICpwdHIsCisJCSAgIHVuc2lnbmVkIGludCB4LCB1bnNpZ25lZCBpbnQg
eSwKKwkJICAgdW5zaWduZWQgaW50IHN0cmlkZSwgdW5zaWduZWQgaW50IGNwcCkKK3sKKwljb25z
dCBpbnQgdGlsZV93aWR0aCA9IDUxMjsKKwljb25zdCBpbnQgdGlsZV9oZWlnaHQgPSA4OworCWNv
bnN0IGludCB0aWxlX3NpemUgPSB0aWxlX3dpZHRoICogdGlsZV9oZWlnaHQ7CisJaW50IG9mZnNl
dF94LCBvZmZzZXRfeSwgcG9zOworCWludCB0aWxlX3gsIHRpbGVfeTsKKworCXggKj0gY3BwOwor
CXRpbGVfeCA9IHggLyB0aWxlX3dpZHRoOworCXRpbGVfeSA9IHkgLyB0aWxlX2hlaWdodDsKKwlv
ZmZzZXRfeCA9IHRpbGVfeCAqIHRpbGVfc2l6ZTsKKwlvZmZzZXRfeSA9IHRpbGVfeSAqIHN0cmlk
ZSAqIHRpbGVfaGVpZ2h0OworCisJcG9zID0gKG9mZnNldF95ICsgKHkgJSB0aWxlX2hlaWdodCAq
IHRpbGVfd2lkdGgpICsKKwkgICAgICAgb2Zmc2V0X3ggKyAoeCAlIHRpbGVfd2lkdGgpKTsKKwor
CXJldHVybiBwdHIgKyBwb3M7Cit9CisKK3N0YXRpYyB2b2lkICp5X3B0cih2b2lkICpwdHIsCisJ
CSAgIHVuc2lnbmVkIGludCB4LCB1bnNpZ25lZCBpbnQgeSwKKwkJICAgdW5zaWduZWQgaW50IHN0
cmlkZSwgdW5zaWduZWQgaW50IGNwcCkKK3sKKwljb25zdCBpbnQgdGlsZV93aWR0aCA9IDEyODsK
Kwljb25zdCBpbnQgdGlsZV9oZWlnaHQgPSAzMjsKKwljb25zdCBpbnQgb3dvcmRzID0gMTY7CisJ
Y29uc3QgaW50IHRpbGVfc2l6ZSA9IHRpbGVfd2lkdGggKiB0aWxlX2hlaWdodDsKKwlpbnQgb2Zm
c2V0X3gsIG9mZnNldF95LCBwb3M7CisJaW50IHNoaWZ0X3gsIHNoaWZ0X3k7CisJaW50IHRpbGVf
eCwgdGlsZV95OworCisJeCAqPSBjcHA7CisJdGlsZV94ID0geCAvIHRpbGVfd2lkdGg7CisJdGls
ZV95ID0geSAvIHRpbGVfaGVpZ2h0OworCW9mZnNldF94ID0gdGlsZV94ICogdGlsZV9zaXplOwor
CW9mZnNldF95ID0gdGlsZV95ICogc3RyaWRlICogdGlsZV9oZWlnaHQ7CisJc2hpZnRfeCA9IHgg
JSBvd29yZHMgKyAoeCAlIHRpbGVfd2lkdGgpIC8gb3dvcmRzICogdGlsZV93aWR0aCAqIGNwcDsK
KwlzaGlmdF95ID0geSAlIHRpbGVfaGVpZ2h0ICogb3dvcmRzOworCisJcG9zID0gb2Zmc2V0X3kg
KyBvZmZzZXRfeCArIHNoaWZ0X3ggKyBzaGlmdF95OworCisJcmV0dXJuIHB0ciArIHBvczsKK30K
Kworc3RhdGljIHZvaWQgKnlmX3B0cih2b2lkICpwdHIsCisJCSAgICB1bnNpZ25lZCBpbnQgeCwg
dW5zaWduZWQgaW50IHksCisJCSAgICB1bnNpZ25lZCBpbnQgc3RyaWRlLCB1bnNpZ25lZCBpbnQg
Y3BwKQoreworCWNvbnN0IGludCB0aWxlX3NpemUgPSA0ICogMTAyNDsKKwljb25zdCBpbnQgdGls
ZV93aWR0aCA9IDEyODsKKwlpbnQgcm93X3NpemUgPSBzdHJpZGUgLyB0aWxlX3dpZHRoICogdGls
ZV9zaXplOworCisJeCAqPSBjcHA7IC8qIGNvbnZlcnQgdG8gQnl0ZSBvZmZzZXQgKi8KKworCS8q
CisJICogV2l0aGluIGEgNGsgWWYgdGlsZSwgdGhlIGJ5dGUgc3dpenpsaW5nIHBhdHRlcm4gaXMK
KwkgKiBtc2IuLi4uLi5sc2IKKwkgKiB4eXh5eHl5eXh4eHgKKwkgKiBUaGUgdGlsZXMgdGhlbXNl
bHZlcyBhcmUgbGFpZCBvdXQgaW4gcm93IG1ham9yIG9yZGVyLgorCSAqLworCXJldHVybiBwdHIg
KworCQkoKHggJiAweGYpICogMSkgKyAvKiA0eDEgcGl4ZWxzKDMyYnBwKSA9IDE2QiAqLworCQko
KHkgJiAweDMpICogMTYpICsgLyogNHg0IHBpeGVscyA9IDY0QiAqLworCQkoKCh5ICYgMHg0KSA+
PiAyKSAqIDY0KSArIC8qIDF4MiA2NEIgYmxvY2tzICovCisJCSgoKHggJiAweDEwKSA+PiA0KSAq
IDEyOCkgKyAvKiAyeDIgNjRCIGJsb2NrcyA9IDI1NkIgYmxvY2sgKi8KKwkJKCgoeSAmIDB4OCkg
Pj4gMykgKiAyNTYpICsgLyogMngxIDI1NkIgYmxvY2tzICovCisJCSgoKHggJiAweDIwKSA+PiA1
KSAqIDUxMikgKyAvKiAyeDIgMjU2QiBibG9ja3MgKi8KKwkJKCgoeSAmIDB4MTApID4+IDQpICog
MTAyNCkgKyAvKiA0eDIgMjU2IGJsb2NrcyAqLworCQkoKCh4ICYgMHg0MCkgPj4gNikgKiAyMDQ4
KSArIC8qIDR4NCAyNTZCIGJsb2NrcyA9IDRrIHRpbGUgKi8KKwkJKCgoeCAmIH4weDdmKSA+PiA3
KSAqIHRpbGVfc2l6ZSkgKyAvKiByb3cgb2YgdGlsZXMgKi8KKwkJKCgoeSAmIH4weDFmKSA+PiA1
KSAqIHJvd19zaXplKTsKK30KKwordHlwZWRlZiB2b2lkICooKnRpbGVfZm4pKHZvaWQgKiwgdW5z
aWduZWQgaW50LCB1bnNpZ25lZCBpbnQsCisJCQl1bnNpZ25lZCBpbnQsIHVuc2lnbmVkIGludCk7
CitzdGF0aWMgdGlsZV9mbiBfX2dldF90aWxlX2ZuX3B0cihpbnQgdGlsaW5nKQoreworCXRpbGVf
Zm4gZm4gPSBOVUxMOworCisJc3dpdGNoICh0aWxpbmcpIHsKKwljYXNlIEk5MTVfVElMSU5HX1g6
CisJCWZuID0geF9wdHI7CisJCWJyZWFrOworCWNhc2UgSTkxNV9USUxJTkdfWToKKwkJZm4gPSB5
X3B0cjsKKwkJYnJlYWs7CisJY2FzZSBJOTE1X1RJTElOR19ZZjoKKwkJZm4gPSB5Zl9wdHI7CisJ
CWJyZWFrOworCWNhc2UgSTkxNV9USUxJTkdfWXM6CisJCS8qIFRvIGJlIGltcGxlbWVudGVkICov
CisJCWJyZWFrOworCX0KKworCWlndF9yZXF1aXJlX2YoZm4sICJDYW4ndCBmaW5kIHRpbGUgZnVu
Y3Rpb24gZm9yIHRpbGluZzogJWRcbiIsIHRpbGluZyk7CisJcmV0dXJuIGZuOworfQorCitzdGF0
aWMgYm9vbCBpc19jYWNoZV9jb2hlcmVudChpbnQgZmQsIHVpbnQzMl90IGhhbmRsZSkKK3sKKwly
ZXR1cm4gZ2VtX2dldF9jYWNoaW5nKGZkLCBoYW5kbGUpICE9IEk5MTVfQ0FDSElOR19OT05FOwor
fQorCitlbnVtIGNjc19jb3B5X2RpcmVjdGlvbiB7CisJQ0NTX0xJTkVBUl9UT19CVUYsCisJQ0NT
X0JVRl9UT19MSU5FQVIsCit9OworCitzdGF0aWMgdm9pZCBfX2NvcHlfY2NzKHN0cnVjdCBidWZf
b3BzICpib3BzLCBzdHJ1Y3QgaW50ZWxfYnVmICpidWYsCisJCSAgICAgICB1aW50MzJfdCAqbGlu
ZWFyLCBlbnVtIGNjc19jb3B5X2RpcmVjdGlvbiBkaXIpCit7CisJdWludDY0X3Qgc2l6ZSwgb2Zm
c2V0LCBjY3Nfc2l6ZTsKKwl2b2lkICptYXA7CisJaW50IGdlbjsKKworCWlmICghYnVmLT5jb21w
cmVzc2lvbikKKwkJcmV0dXJuOworCisJZ2VuID0gYm9wcy0+aW50ZWxfZ2VuOworCW9mZnNldCA9
IENDU19PRkZTRVQoYnVmKTsKKwljY3Nfc2l6ZSA9IENDU19TSVpFKGdlbiwgYnVmKTsKKwlzaXpl
ID0gb2Zmc2V0ICsgY2NzX3NpemU7CisKKwltYXAgPSBfX2dlbV9tbWFwX29mZnNldF9fd2MoYm9w
cy0+ZmQsIGJ1Zi0+aGFuZGxlLCAwLCBzaXplLAorCQkJCSAgICBQUk9UX1JFQUQgfCBQUk9UX1dS
SVRFKTsKKwlpZiAoIW1hcCkKKwkJbWFwID0gZ2VtX21tYXBfX3djKGJvcHMtPmZkLCBidWYtPmhh
bmRsZSwgMCwgc2l6ZSwKKwkJCQkgICBQUk9UX1JFQUQgfCBQUk9UX1dSSVRFKTsKKworCXN3aXRj
aCAoZGlyKSB7CisJY2FzZSBDQ1NfTElORUFSX1RPX0JVRjoKKwkJZ2VtX3NldF9kb21haW4oYm9w
cy0+ZmQsIGJ1Zi0+aGFuZGxlLAorCQkJICAgICAgIEk5MTVfR0VNX0RPTUFJTl9XQywgSTkxNV9H
RU1fRE9NQUlOX1dDKTsKKwkJaWd0X21lbWNweV9mcm9tX3djKG1hcCArIG9mZnNldCwgKHVpbnQ4
X3QgKikgbGluZWFyICsgb2Zmc2V0LAorCQkJCSAgIGNjc19zaXplKTsKKwljYXNlIENDU19CVUZf
VE9fTElORUFSOgorCQlnZW1fc2V0X2RvbWFpbihib3BzLT5mZCwgYnVmLT5oYW5kbGUsIEk5MTVf
R0VNX0RPTUFJTl9XQywgMCk7CisJCWlndF9tZW1jcHlfZnJvbV93YygodWludDhfdCAqKSBsaW5l
YXIgKyBvZmZzZXQsIG1hcCArIG9mZnNldCwKKwkJCQkgICBjY3Nfc2l6ZSk7CisJfQorCisJbXVu
bWFwKG1hcCwgc2l6ZSk7Cit9CisKK3N0YXRpYyB2b2lkICptbWFwX3dyaXRlKGludCBmZCwgc3Ry
dWN0IGludGVsX2J1ZiAqYnVmKQoreworCXZvaWQgKm1hcCA9IE5VTEw7CisKKwlpZiAoaXNfY2Fj
aGVfY29oZXJlbnQoZmQsIGJ1Zi0+aGFuZGxlKSkgeworCQltYXAgPSBfX2dlbV9tbWFwX29mZnNl
dF9fY3B1KGZkLCBidWYtPmhhbmRsZSwgMCwgYnVmLT5zaXplLAorCQkJCQkgICAgIFBST1RfUkVB
RCB8IFBST1RfV1JJVEUpOworCQlpZiAoIW1hcCkKKwkJCW1hcCA9IF9fZ2VtX21tYXBfX2NwdShm
ZCwgYnVmLT5oYW5kbGUsIDAsIGJ1Zi0+c2l6ZSwKKwkJCQkJICAgICAgUFJPVF9SRUFEIHwgUFJP
VF9XUklURSk7CisKKwkJaWYgKG1hcCkKKwkJCWdlbV9zZXRfZG9tYWluKGZkLCBidWYtPmhhbmRs
ZSwKKwkJCQkgICAgICAgSTkxNV9HRU1fRE9NQUlOX0NQVSwKKwkJCQkgICAgICAgSTkxNV9HRU1f
RE9NQUlOX0NQVSk7CisJfQorCisJaWYgKCFtYXApIHsKKwkJbWFwID0gX19nZW1fbW1hcF9vZmZz
ZXRfX3djKGZkLCBidWYtPmhhbmRsZSwgMCwgYnVmLT5zaXplLAorCQkJCQkgICAgUFJPVF9SRUFE
IHwgUFJPVF9XUklURSk7CisJCWlmICghbWFwKQorCQkJbWFwID0gZ2VtX21tYXBfX3djKGZkLCBi
dWYtPmhhbmRsZSwgMCwgYnVmLT5zaXplLAorCQkJCQkgICBQUk9UX1JFQUQgfCBQUk9UX1dSSVRF
KTsKKworCQlnZW1fc2V0X2RvbWFpbihmZCwgYnVmLT5oYW5kbGUsCisJCQkgICAgICAgSTkxNV9H
RU1fRE9NQUlOX1dDLCBJOTE1X0dFTV9ET01BSU5fV0MpOworCX0KKworCXJldHVybiBtYXA7Cit9
CisKK3N0YXRpYyB2b2lkICptbWFwX3JlYWQoaW50IGZkLCBzdHJ1Y3QgaW50ZWxfYnVmICpidWYp
Cit7CisJdm9pZCAqbWFwID0gTlVMTDsKKworCWlmIChnZW1faGFzX2xsYyhmZCkgfHwgaXNfY2Fj
aGVfY29oZXJlbnQoZmQsIGJ1Zi0+aGFuZGxlKSkgeworCQltYXAgPSBfX2dlbV9tbWFwX29mZnNl
dF9fY3B1KGZkLCBidWYtPmhhbmRsZSwgMCwKKwkJCQkJICAgICBidWYtPnNpemUsIFBST1RfUkVB
RCk7CisJCWlmICghbWFwKQorCQkJbWFwID0gX19nZW1fbW1hcF9fY3B1KGZkLCBidWYtPmhhbmRs
ZSwgMCwgYnVmLT5zaXplLAorCQkJCQkgICAgICBQUk9UX1JFQUQpOworCisJCWlmIChtYXApCisJ
CQlnZW1fc2V0X2RvbWFpbihmZCwgYnVmLT5oYW5kbGUsIEk5MTVfR0VNX0RPTUFJTl9DUFUsIDAp
OworCX0KKworCWlmICghbWFwKSB7CisJCW1hcCA9IF9fZ2VtX21tYXBfb2Zmc2V0X193YyhmZCwg
YnVmLT5oYW5kbGUsIDAsIGJ1Zi0+c2l6ZSwKKwkJCQkJICAgIFBST1RfUkVBRCk7CisJCWlmICgh
bWFwKQorCQkJbWFwID0gZ2VtX21tYXBfX3djKGZkLCBidWYtPmhhbmRsZSwgMCwgYnVmLT5zaXpl
LAorCQkJCQkgICBQUk9UX1JFQUQpOworCisJCWdlbV9zZXRfZG9tYWluKGZkLCBidWYtPmhhbmRs
ZSwgSTkxNV9HRU1fRE9NQUlOX1dDLCAwKTsKKwl9CisKKwlyZXR1cm4gbWFwOworfQorCitzdGF0
aWMgdm9pZCBfX2NvcHlfbGluZWFyX3RvKGludCBmZCwgc3RydWN0IGludGVsX2J1ZiAqYnVmLAor
CQkJICAgICBjb25zdCB1aW50MzJfdCAqbGluZWFyLAorCQkJICAgICBpbnQgdGlsaW5nLCB1aW50
MzJfdCBzd2l6emxlKQoreworCWNvbnN0IHRpbGVfZm4gZm4gPSBfX2dldF90aWxlX2ZuX3B0cih0
aWxpbmcpOworCWludCBoZWlnaHQgPSBpbnRlbF9idWZfaGVpZ2h0KGJ1Zik7CisJaW50IHdpZHRo
ID0gaW50ZWxfYnVmX3dpZHRoKGJ1Zik7CisJdm9pZCAqbWFwID0gbW1hcF93cml0ZShmZCwgYnVm
KTsKKworCWZvciAoaW50IHkgPSAwOyB5IDwgaGVpZ2h0OyB5KyspIHsKKwkJZm9yIChpbnQgeCA9
IDA7IHggPCB3aWR0aDsgeCsrKSB7CisJCQl1aW50MzJfdCAqcHRyID0gZm4obWFwLCB4LCB5LCBi
dWYtPnN0cmlkZSwgYnVmLT5icHAvOCk7CisKKwkJCWlmIChzd2l6emxlKQorCQkJCXB0ciA9IGZy
b21fdXNlcl9wb2ludGVyKHN3aXp6bGVfYWRkcihwdHIsCisJCQkJCQkJCSAgICAgc3dpenpsZSkp
OworCQkJKnB0ciA9IGxpbmVhclt5ICogd2lkdGggKyB4XTsKKwkJfQorCX0KKworCW11bm1hcCht
YXAsIGJ1Zi0+c2l6ZSk7Cit9CisKK3N0YXRpYyB2b2lkIGNvcHlfbGluZWFyX3RvX3goc3RydWN0
IGJ1Zl9vcHMgKmJvcHMsIHN0cnVjdCBpbnRlbF9idWYgKmJ1ZiwKKwkJCSAgICAgdWludDMyX3Qg
KmxpbmVhcikKK3sKKwlERUJVR0ZOKCk7CisJX19jb3B5X2xpbmVhcl90byhib3BzLT5mZCwgYnVm
LCBsaW5lYXIsIEk5MTVfVElMSU5HX1gsIGJvcHMtPnN3aXp6bGVfeCk7Cit9CisKK3N0YXRpYyB2
b2lkIGNvcHlfbGluZWFyX3RvX3koc3RydWN0IGJ1Zl9vcHMgKmJvcHMsIHN0cnVjdCBpbnRlbF9i
dWYgKmJ1ZiwKKwkJCSAgICAgdWludDMyX3QgKmxpbmVhcikKK3sKKwlERUJVR0ZOKCk7CisJX19j
b3B5X2xpbmVhcl90byhib3BzLT5mZCwgYnVmLCBsaW5lYXIsIEk5MTVfVElMSU5HX1ksIGJvcHMt
PnN3aXp6bGVfeSk7Cit9CisKK3N0YXRpYyB2b2lkIGNvcHlfbGluZWFyX3RvX3lmKHN0cnVjdCBi
dWZfb3BzICpib3BzLCBzdHJ1Y3QgaW50ZWxfYnVmICpidWYsCisJCQkgICAgICB1aW50MzJfdCAq
bGluZWFyKQoreworCURFQlVHRk4oKTsKKwlfX2NvcHlfbGluZWFyX3RvKGJvcHMtPmZkLCBidWYs
IGxpbmVhciwgSTkxNV9USUxJTkdfWWYsIDApOworfQorCitzdGF0aWMgdm9pZCBjb3B5X2xpbmVh
cl90b195cyhzdHJ1Y3QgYnVmX29wcyAqYm9wcywgc3RydWN0IGludGVsX2J1ZiAqYnVmLAorCQkJ
ICAgICAgdWludDMyX3QgKmxpbmVhcikKK3sKKwlERUJVR0ZOKCk7CisJX19jb3B5X2xpbmVhcl90
byhib3BzLT5mZCwgYnVmLCBsaW5lYXIsIEk5MTVfVElMSU5HX1lzLCAwKTsKK30KKworc3RhdGlj
IHZvaWQgX19jb3B5X3RvX2xpbmVhcihpbnQgZmQsIHN0cnVjdCBpbnRlbF9idWYgKmJ1ZiwKKwkJ
CSAgICAgdWludDMyX3QgKmxpbmVhciwgaW50IHRpbGluZywgdWludDMyX3Qgc3dpenpsZSkKK3sK
Kwljb25zdCB0aWxlX2ZuIGZuID0gX19nZXRfdGlsZV9mbl9wdHIodGlsaW5nKTsKKwlpbnQgaGVp
Z2h0ID0gaW50ZWxfYnVmX2hlaWdodChidWYpOworCWludCB3aWR0aCA9IGludGVsX2J1Zl93aWR0
aChidWYpOworCXZvaWQgKm1hcCA9IG1tYXBfd3JpdGUoZmQsIGJ1Zik7CisKKwlmb3IgKGludCB5
ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7CisJCWZvciAoaW50IHggPSAwOyB4IDwgd2lkdGg7IHgr
KykgeworCQkJdWludDMyX3QgKnB0ciA9IGZuKG1hcCwgeCwgeSwgYnVmLT5zdHJpZGUsIGJ1Zi0+
YnBwLzgpOworCisJCQlpZiAoc3dpenpsZSkKKwkJCQlwdHIgPSBmcm9tX3VzZXJfcG9pbnRlcihz
d2l6emxlX2FkZHIocHRyLAorCQkJCQkJCQkgICAgIHN3aXp6bGUpKTsKKwkJCWxpbmVhclt5ICog
d2lkdGggKyB4XSA9ICpwdHI7CisJCX0KKwl9CisKKwltdW5tYXAobWFwLCBidWYtPnNpemUpOwor
fQorCitzdGF0aWMgdm9pZCBjb3B5X3hfdG9fbGluZWFyKHN0cnVjdCBidWZfb3BzICpib3BzLCBz
dHJ1Y3QgaW50ZWxfYnVmICpidWYsCisJCQkgICAgIHVpbnQzMl90ICpsaW5lYXIpCit7CisJREVC
VUdGTigpOworCV9fY29weV90b19saW5lYXIoYm9wcy0+ZmQsIGJ1ZiwgbGluZWFyLCBJOTE1X1RJ
TElOR19YLCBib3BzLT5zd2l6emxlX3gpOworfQorCitzdGF0aWMgdm9pZCBjb3B5X3lfdG9fbGlu
ZWFyKHN0cnVjdCBidWZfb3BzICpib3BzLCBzdHJ1Y3QgaW50ZWxfYnVmICpidWYsCisJCQkgICAg
IHVpbnQzMl90ICpsaW5lYXIpCit7CisJREVCVUdGTigpOworCV9fY29weV90b19saW5lYXIoYm9w
cy0+ZmQsIGJ1ZiwgbGluZWFyLCBJOTE1X1RJTElOR19ZLCBib3BzLT5zd2l6emxlX3kpOworfQor
CitzdGF0aWMgdm9pZCBjb3B5X3lmX3RvX2xpbmVhcihzdHJ1Y3QgYnVmX29wcyAqYm9wcywgc3Ry
dWN0IGludGVsX2J1ZiAqYnVmLAorCQkJICAgICAgdWludDMyX3QgKmxpbmVhcikKK3sKKwlERUJV
R0ZOKCk7CisJX19jb3B5X3RvX2xpbmVhcihib3BzLT5mZCwgYnVmLCBsaW5lYXIsIEk5MTVfVElM
SU5HX1lmLCAwKTsKK30KKworc3RhdGljIHZvaWQgY29weV95c190b19saW5lYXIoc3RydWN0IGJ1
Zl9vcHMgKmJvcHMsIHN0cnVjdCBpbnRlbF9idWYgKmJ1ZiwKKwkJCSAgICAgIHVpbnQzMl90ICps
aW5lYXIpCit7CisJREVCVUdGTigpOworCV9fY29weV90b19saW5lYXIoYm9wcy0+ZmQsIGJ1Ziwg
bGluZWFyLCBJOTE1X1RJTElOR19ZcywgMCk7Cit9CisKK3N0YXRpYyB2b2lkIGNvcHlfbGluZWFy
X3RvX2d0dChzdHJ1Y3QgYnVmX29wcyAqYm9wcywgc3RydWN0IGludGVsX2J1ZiAqYnVmLAorCQkJ
ICAgICAgIHVpbnQzMl90ICpsaW5lYXIpCit7CisJdm9pZCAqbWFwOworCisJREVCVUdGTigpOwor
CisJbWFwID0gZ2VtX21tYXBfX2d0dChib3BzLT5mZCwgYnVmLT5oYW5kbGUsCisJCQkgICAgYnVm
LT5zaXplLCBQUk9UX1JFQUQgfCBQUk9UX1dSSVRFKTsKKworCWdlbV9zZXRfZG9tYWluKGJvcHMt
PmZkLCBidWYtPmhhbmRsZSwKKwkJICAgICAgIEk5MTVfR0VNX0RPTUFJTl9HVFQsIEk5MTVfR0VN
X0RPTUFJTl9HVFQpOworCisJbWVtY3B5KG1hcCwgbGluZWFyLCBidWYtPnNpemUpOworCisJbXVu
bWFwKG1hcCwgYnVmLT5zaXplKTsKK30KKworc3RhdGljIHZvaWQgY29weV9ndHRfdG9fbGluZWFy
KHN0cnVjdCBidWZfb3BzICpib3BzLCBzdHJ1Y3QgaW50ZWxfYnVmICpidWYsCisJCQkgICAgICAg
dWludDMyX3QgKmxpbmVhcikKK3sKKwl2b2lkICptYXA7CisKKwlERUJVR0ZOKCk7CisKKwltYXAg
PSBnZW1fbW1hcF9fZ3R0KGJvcHMtPmZkLCBidWYtPmhhbmRsZSwKKwkJCSAgICBidWYtPnNpemUs
IFBST1RfUkVBRCk7CisKKwlnZW1fc2V0X2RvbWFpbihib3BzLT5mZCwgYnVmLT5oYW5kbGUsCisJ
CSAgICAgICBJOTE1X0dFTV9ET01BSU5fR1RULCAwKTsKKworCWlndF9tZW1jcHlfZnJvbV93Yyhs
aW5lYXIsIG1hcCwgYnVmLT5zaXplKTsKKworCW11bm1hcChtYXAsIGJ1Zi0+c2l6ZSk7Cit9CisK
K3N0YXRpYyB2b2lkIGNvcHlfbGluZWFyX3RvX3djKHN0cnVjdCBidWZfb3BzICpib3BzLCBzdHJ1
Y3QgaW50ZWxfYnVmICpidWYsCisJCQkgICAgICB1aW50MzJfdCAqbGluZWFyKQoreworCXZvaWQg
Km1hcDsKKworCURFQlVHRk4oKTsKKworCW1hcCA9IG1tYXBfd3JpdGUoYm9wcy0+ZmQsIGJ1Zik7
CisJbWVtY3B5KG1hcCwgbGluZWFyLCBidWYtPnNpemUpOworCW11bm1hcChtYXAsIGJ1Zi0+c2l6
ZSk7Cit9CisKK3N0YXRpYyB2b2lkIGNvcHlfd2NfdG9fbGluZWFyKHN0cnVjdCBidWZfb3BzICpi
b3BzLCBzdHJ1Y3QgaW50ZWxfYnVmICpidWYsCisJCQkgICAgICB1aW50MzJfdCAqbGluZWFyKQor
eworCXZvaWQgKm1hcDsKKworCURFQlVHRk4oKTsKKworCW1hcCA9IG1tYXBfcmVhZChib3BzLT5m
ZCwgYnVmKTsKKwlpZ3RfbWVtY3B5X2Zyb21fd2MobGluZWFyLCBtYXAsIGJ1Zi0+c2l6ZSk7CisJ
bXVubWFwKG1hcCwgYnVmLT5zaXplKTsKK30KKwordm9pZCBpbnRlbF9idWZfdG9fbGluZWFyKHN0
cnVjdCBidWZfb3BzICpib3BzLCBzdHJ1Y3QgaW50ZWxfYnVmICpidWYsCisJCQkgdWludDMyX3Qg
KmxpbmVhcikKK3sKKwlpZ3RfYXNzZXJ0KGJvcHMpOworCisJc3dpdGNoIChidWYtPnRpbGluZykg
eworCWNhc2UgSTkxNV9USUxJTkdfTk9ORToKKwkJaWd0X2Fzc2VydChib3BzLT50b19saW5lYXIp
OworCQlib3BzLT50b19saW5lYXIoYm9wcywgYnVmLCBsaW5lYXIpOworCQlicmVhazsKKwljYXNl
IEk5MTVfVElMSU5HX1g6CisJCWlndF9hc3NlcnQoYm9wcy0+eF90b19saW5lYXIpOworCQlib3Bz
LT54X3RvX2xpbmVhcihib3BzLCBidWYsIGxpbmVhcik7CisJCWJyZWFrOworCWNhc2UgSTkxNV9U
SUxJTkdfWToKKwkJaWd0X2Fzc2VydChib3BzLT55X3RvX2xpbmVhcik7CisJCWJvcHMtPnlfdG9f
bGluZWFyKGJvcHMsIGJ1ZiwgbGluZWFyKTsKKwkJYnJlYWs7CisJY2FzZSBJOTE1X1RJTElOR19Z
ZjoKKwkJaWd0X2Fzc2VydChib3BzLT55Zl90b19saW5lYXIpOworCQlib3BzLT55Zl90b19saW5l
YXIoYm9wcywgYnVmLCBsaW5lYXIpOworCQlicmVhazsKKwljYXNlIEk5MTVfVElMSU5HX1lzOgor
CQlpZ3RfYXNzZXJ0KGJvcHMtPnlzX3RvX2xpbmVhcik7CisJCWJvcHMtPnlzX3RvX2xpbmVhcihi
b3BzLCBidWYsIGxpbmVhcik7CisJCWJyZWFrOworCX0KKworCWlmIChidWYtPmNvbXByZXNzaW9u
KQorCQlfX2NvcHlfY2NzKGJvcHMsIGJ1ZiwgbGluZWFyLCBDQ1NfQlVGX1RPX0xJTkVBUik7Cit9
CisKK3ZvaWQgbGluZWFyX3RvX2ludGVsX2J1ZihzdHJ1Y3QgYnVmX29wcyAqYm9wcywgc3RydWN0
IGludGVsX2J1ZiAqYnVmLAorCQkJIHVpbnQzMl90ICpsaW5lYXIpCit7CisJaWd0X2Fzc2VydChi
b3BzKTsKKworCXN3aXRjaCAoYnVmLT50aWxpbmcpIHsKKwljYXNlIEk5MTVfVElMSU5HX05PTkU6
CisJCWlndF9hc3NlcnQoYm9wcy0+bGluZWFyX3RvKTsKKwkJYm9wcy0+bGluZWFyX3RvKGJvcHMs
IGJ1ZiwgbGluZWFyKTsKKwkJYnJlYWs7CisJY2FzZSBJOTE1X1RJTElOR19YOgorCQlpZ3RfYXNz
ZXJ0KGJvcHMtPmxpbmVhcl90b194KTsKKwkJYm9wcy0+bGluZWFyX3RvX3goYm9wcywgYnVmLCBs
aW5lYXIpOworCQlicmVhazsKKwljYXNlIEk5MTVfVElMSU5HX1k6CisJCWlndF9hc3NlcnQoYm9w
cy0+bGluZWFyX3RvX3kpOworCQlib3BzLT5saW5lYXJfdG9feShib3BzLCBidWYsIGxpbmVhcik7
CisJCWJyZWFrOworCWNhc2UgSTkxNV9USUxJTkdfWWY6CisJCWlndF9hc3NlcnQoYm9wcy0+bGlu
ZWFyX3RvX3lmKTsKKwkJYm9wcy0+bGluZWFyX3RvX3lmKGJvcHMsIGJ1ZiwgbGluZWFyKTsKKwkJ
YnJlYWs7CisJY2FzZSBJOTE1X1RJTElOR19ZczoKKwkJaWd0X2Fzc2VydChib3BzLT5saW5lYXJf
dG9feXMpOworCQlib3BzLT5saW5lYXJfdG9feXMoYm9wcywgYnVmLCBsaW5lYXIpOworCQlicmVh
azsKKwl9CisKKwlpZiAoYnVmLT5jb21wcmVzc2lvbikKKwkJX19jb3B5X2Njcyhib3BzLCBidWYs
IGxpbmVhciwgQ0NTX0xJTkVBUl9UT19CVUYpOworfQorCitzdGF0aWMgdm9pZCBfX2ludGVsX2J1
Zl9pbml0KHN0cnVjdCBidWZfb3BzICpib3BzLAorCQkJICAgICB1aW50MzJfdCBoYW5kbGUsCisJ
CQkgICAgIHN0cnVjdCBpbnRlbF9idWYgKmJ1ZiwKKwkJCSAgICAgaW50IHdpZHRoLCBpbnQgaGVp
Z2h0LCBpbnQgYnBwLAorCQkJICAgICB1aW50MzJfdCByZXFfdGlsaW5nLCB1aW50MzJfdCBjb21w
cmVzc2lvbikKK3sKKwl1aW50MzJfdCB0aWxpbmcgPSByZXFfdGlsaW5nOworCXVpbnQzMl90IHNp
emU7CisKKwlpZ3RfYXNzZXJ0KGJvcHMpOworCWlndF9hc3NlcnQoYnVmKTsKKwlpZ3RfYXNzZXJ0
KHdpZHRoID4gMCAmJiBoZWlnaHQgPiAwKTsKKwlpZ3RfYXNzZXJ0KGJwcCA9PSA4IHx8IGJwcCA9
PSAxNiB8fCBicHAgPT0gMzIpOworCisJbWVtc2V0KGJ1ZiwgMCwgc2l6ZW9mKCpidWYpKTsKKwor
CWlmIChjb21wcmVzc2lvbikgeworCQlpbnQgYXV4X3dpZHRoLCBhdXhfaGVpZ2h0OworCisJCWln
dF9yZXF1aXJlKGJvcHMtPmludGVsX2dlbiA+PSA5KTsKKwkJaWd0X2Fzc2VydChyZXFfdGlsaW5n
ID09IEk5MTVfVElMSU5HX1kgfHwKKwkJCSAgIHJlcV90aWxpbmcgPT0gSTkxNV9USUxJTkdfWWYp
OworCisJCS8qCisJCSAqIE9uIEdFTjEyKyB3ZSBhbGlnbiB0aGUgbWFpbiBzdXJmYWNlIHRvIDQg
KiA0IG1haW4gc3VyZmFjZQorCQkgKiB0aWxlcywgd2hpY2ggaXMgNjRrQi4gVGhlc2UgMTYgdGls
ZXMgYXJlIG1hcHBlZCBieSA0IEFVWAorCQkgKiBDQ1MgdW5pdHMsIHRoYXQgaXMgNCAqIDY0IGJ5
dGVzLiBUaGVzZSA0IENDUyB1bml0cyBhcmUgaW4KKwkJICogdHVybiBtYXBwZWQgYnkgb25lIEwx
IEFVWCBwYWdlIHRhYmxlIGVudHJ5LgorCQkgKi8KKwkJaWYgKGJvcHMtPmludGVsX2dlbiA+PSAx
MikKKwkJCWJ1Zi0+c3RyaWRlID0gQUxJR04od2lkdGggKiAoYnBwIC8gOCksIDEyOCAqIDQpOwor
CQllbHNlCisJCQlidWYtPnN0cmlkZSA9IEFMSUdOKHdpZHRoICogKGJwcCAvIDgpLCAxMjgpOwor
CisJCWlmIChib3BzLT5pbnRlbF9nZW4gPj0gMTIpCisJCQloZWlnaHQgPSBBTElHTihoZWlnaHQs
IDQgKiAzMik7CisKKwkJYnVmLT5zaXplID0gYnVmLT5zdHJpZGUgKiBoZWlnaHQ7CisJCWJ1Zi0+
dGlsaW5nID0gdGlsaW5nOworCQlidWYtPmJwcCA9IGJwcDsKKwkJYnVmLT5jb21wcmVzc2lvbiA9
IGNvbXByZXNzaW9uOworCisJCWF1eF93aWR0aCA9IGludGVsX2J1Zl9hdXhfd2lkdGgoYm9wcy0+
aW50ZWxfZ2VuLCBidWYpOworCQlhdXhfaGVpZ2h0ID0gaW50ZWxfYnVmX2F1eF9oZWlnaHQoYm9w
cy0+aW50ZWxfZ2VuLCBidWYpOworCisJCWJ1Zi0+YXV4Lm9mZnNldCA9IGJ1Zi0+c3RyaWRlICog
QUxJR04oaGVpZ2h0LCAzMik7CisJCWJ1Zi0+YXV4LnN0cmlkZSA9IGF1eF93aWR0aDsKKworCQlz
aXplID0gYnVmLT5hdXgub2Zmc2V0ICsgYXV4X3dpZHRoICogYXV4X2hlaWdodDsKKworCX0gZWxz
ZSB7CisJCWJ1Zi0+c3RyaWRlID0gQUxJR04od2lkdGggKiAoYnBwIC8gOCksIDEyOCk7CisJCWJ1
Zi0+c2l6ZSA9IGJ1Zi0+c3RyaWRlICogaGVpZ2h0OworCQlidWYtPnRpbGluZyA9IHRpbGluZzsK
KwkJYnVmLT5icHAgPSBicHA7CisKKwkJc2l6ZSA9IGJ1Zi0+c3RyaWRlICogQUxJR04oaGVpZ2h0
LCAzMik7CisJfQorCisJaWYgKGhhbmRsZSkKKwkJYnVmLT5oYW5kbGUgPSBoYW5kbGU7CisJZWxz
ZQorCQlidWYtPmhhbmRsZSA9IGdlbV9jcmVhdGUoYm9wcy0+ZmQsIHNpemUpOworCisJc2V0X2h3
X3RpbGVkKGJvcHMsIGJ1Zik7Cit9CisKKy8qKgorICogaW50ZWxfYnVmX2luaXQKKyAqIEBib3Bz
OiBwb2ludGVyIHRvIGJ1Zl9vcHMKKyAqIEBidWY6IHBvaW50ZXIgdG8gaW50ZWxfYnVmIHN0cnVj
dHVyZSB0byBiZSBmaWxsZWQKKyAqIEB3aWR0aDogc3VyZmFjZSB3aWR0aAorICogQGhlaWdodDog
c3VyZmFjZSBoZWlnaHQKKyAqIEBicHA6IGJpdHMtcGVyLXBpeGVsICg4IC8gMTYgLyAzMikKKyAq
IEB0aWxpbmc6IHN1cmZhY2UgdGlsaW5nCisgKiBAY29tcHJlc3Npb246IHN1cmZhY2UgY29tcHJl
c3Npb24gdHlwZQorICoKKyAqIEZ1bmN0aW9uIGNyZWF0ZXMgbmV3IEJPIHdpdGhpbiBpbnRlbF9i
dWYgc3RydWN0dXJlIGFuZCBmaWxscyBhbGwKKyAqIHN0cnVjdHVyZSBmaWVsZHMuCisgKgorICog
Tm90ZS4gRm9yIFggLyBZIGlmIEdQVSBzdXBwb3J0cyBmZW5jZXMgSFcgdGlsaW5nIGlzIGNvbmZp
Z3VyZWQuCisgKi8KK3ZvaWQgaW50ZWxfYnVmX2luaXQoc3RydWN0IGJ1Zl9vcHMgKmJvcHMsCisJ
CSAgICBzdHJ1Y3QgaW50ZWxfYnVmICpidWYsCisJCSAgICBpbnQgd2lkdGgsIGludCBoZWlnaHQs
IGludCBicHAsCisJCSAgICB1aW50MzJfdCB0aWxpbmcsIHVpbnQzMl90IGNvbXByZXNzaW9uKQor
eworCV9faW50ZWxfYnVmX2luaXQoYm9wcywgMCwgYnVmLCB3aWR0aCwgaGVpZ2h0LCBicHAsIHRp
bGluZywKKwkJCSBjb21wcmVzc2lvbik7Cit9CisKKy8qKgorICogaW50ZWxfYnVmX2Nsb3NlCisg
KiBAYm9wczogcG9pbnRlciB0byBidWZfb3BzCisgKiBAYnVmOiBwb2ludGVyIHRvIGludGVsX2J1
ZiBzdHJ1Y3R1cmUKKyAqCisgKiBGdW5jdGlvbiBjbG9zZXMgZ2VtIEJPIGluc2lkZSBpbnRlbF9i
dWYuCisgKi8KK3ZvaWQgaW50ZWxfYnVmX2Nsb3NlKHN0cnVjdCBidWZfb3BzICpib3BzLCBzdHJ1
Y3QgaW50ZWxfYnVmICpidWYpCit7CisJaWd0X2Fzc2VydChib3BzKTsKKwlpZ3RfYXNzZXJ0KGJ1
Zik7CisKKwlnZW1fY2xvc2UoYm9wcy0+ZmQsIGJ1Zi0+aGFuZGxlKTsKK30KKworLyoqCisgKiBp
bnRlbF9idWZfaW5pdF91c2luZ19oYW5kbGUKKyAqIEBib3BzOiBwb2ludGVyIHRvIGJ1Zl9vcHMK
KyAqIEBoYW5kbGU6IEJPIGhhbmRsZSBjcmVhdGVkIGJ5IHRoZSBjYWxsZXIKKyAqIEBidWY6IHBv
aW50ZXIgdG8gaW50ZWxfYnVmIHN0cnVjdHVyZSB0byBiZSBmaWxsZWQKKyAqIEB3aWR0aDogc3Vy
ZmFjZSB3aWR0aAorICogQGhlaWdodDogc3VyZmFjZSBoZWlnaHQKKyAqIEBicHA6IGJpdHMtcGVy
LXBpeGVsICg4IC8gMTYgLyAzMikKKyAqIEB0aWxpbmc6IHN1cmZhY2UgdGlsaW5nCisgKiBAY29t
cHJlc3Npb246IHN1cmZhY2UgY29tcHJlc3Npb24gdHlwZQorICoKKyAqIEZ1bmN0aW9uIGNvbmZp
Z3VyZXMgQk8gaGFuZGxlIHdpdGhpbiBpbnRlbF9idWYgc3RydWN0dXJlIHBhc3NlZCBieSB0aGUg
Y2FsbGVyCisgKiAod2l0aCBhbGwgaXRzIG1ldGFkYXRhIC0gd2lkdGgsIGhlaWdodCwgLi4uKS4g
VXNlZnVsIGlmIEJPIHdhcyBjcmVhdGVkCisgKiBvdXRzaWRlLgorICoKKyAqIE5vdGU6IGludGVs
X2J1Zl9jbG9zZSgpIGNhbiBiZSB1c2VkIHRvIGNsb3NlIHRoZSBCTyBoYW5kbGUsIGJ1dCBjYWxs
ZXIKKyAqIG11c3QgYmUgYXdhcmUgdG8gbm90IGNsb3NlIHRoZSBCTyB0d2ljZS4KKyAqLwordm9p
ZCBpbnRlbF9idWZfaW5pdF91c2luZ19oYW5kbGUoc3RydWN0IGJ1Zl9vcHMgKmJvcHMsCisJCQkJ
IHVpbnQzMl90IGhhbmRsZSwKKwkJCQkgc3RydWN0IGludGVsX2J1ZiAqYnVmLAorCQkJCSBpbnQg
d2lkdGgsIGludCBoZWlnaHQsIGludCBicHAsCisJCQkJIHVpbnQzMl90IHJlcV90aWxpbmcsIHVp
bnQzMl90IGNvbXByZXNzaW9uKQoreworCV9faW50ZWxfYnVmX2luaXQoYm9wcywgaGFuZGxlLCBi
dWYsIHdpZHRoLCBoZWlnaHQsIGJwcCwgcmVxX3RpbGluZywKKwkJCSBjb21wcmVzc2lvbik7Cit9
CisKKyNkZWZpbmUgREVGQVVMVF9CVUZPUFMoX19nZW5fc3RhcnQsIF9fZ2VuX2VuZCkgXAorCS5n
ZW5fc3RhcnQgICAgICAgICAgPSBfX2dlbl9zdGFydCwgXAorCS5nZW5fZW5kICAgICAgICAgICAg
PSBfX2dlbl9lbmQsIFwKKwkuc3VwcG9ydGVkX2h3X3RpbGVzID0gVElMRV9YIHwgVElMRV9ZLCBc
CisJLmxpbmVhcl90byAgICAgICAgICA9IGNvcHlfbGluZWFyX3RvX3djLCBcCisJLmxpbmVhcl90
b194ICAgICAgICA9IGNvcHlfbGluZWFyX3RvX2d0dCwgXAorCS5saW5lYXJfdG9feSAgICAgICAg
PSBjb3B5X2xpbmVhcl90b19ndHQsIFwKKwkubGluZWFyX3RvX3lmICAgICAgID0gY29weV9saW5l
YXJfdG9feWYsIFwKKwkubGluZWFyX3RvX3lzICAgICAgID0gY29weV9saW5lYXJfdG9feXMsIFwK
KwkudG9fbGluZWFyICAgICAgICAgID0gY29weV93Y190b19saW5lYXIsIFwKKwkueF90b19saW5l
YXIgICAgICAgID0gY29weV9ndHRfdG9fbGluZWFyLCBcCisJLnlfdG9fbGluZWFyICAgICAgICA9
IGNvcHlfZ3R0X3RvX2xpbmVhciwgXAorCS55Zl90b19saW5lYXIgICAgICAgPSBjb3B5X3lmX3Rv
X2xpbmVhciwgXAorCS55c190b19saW5lYXIgICAgICAgPSBjb3B5X3lzX3RvX2xpbmVhcgorCitz
dHJ1Y3QgYnVmX29wcyBidWZfb3BzX2FycltdID0geworCXsKKwkJREVGQVVMVF9CVUZPUFMoMiwg
OCksCisJCS5zdXBwb3J0ZWRfdGlsZXMgICAgPSBUSUxFX05PTkUgfCBUSUxFX1ggfCBUSUxFX1ks
CisJfSwKKworCXsKKwkJREVGQVVMVF9CVUZPUFMoOSwgMTEpLAorCQkuc3VwcG9ydGVkX3RpbGVz
ICAgID0gVElMRV9OT05FIHwgVElMRV9YIHwgVElMRV9ZIHwgVElMRV9ZZiwKKwl9LAorCisJewor
CQlERUZBVUxUX0JVRk9QUygxMiwgMTIpLAorCQkuc3VwcG9ydGVkX3RpbGVzICAgPSBUSUxFX05P
TkUgfCBUSUxFX1ggfCBUSUxFX1kgfCBUSUxFX1lmIHwgVElMRV9ZcywKKwl9LAorfTsKKworc3Rh
dGljIGJvb2wgcHJvYmVfaHdfdGlsaW5nKHN0cnVjdCBidWZfb3BzICpib3BzLCB1aW50MzJfdCB0
aWxpbmcpCit7CisJdWludDY0X3Qgc2l6ZSA9IDI1NiAqIDI1NjsKKwl1aW50MzJfdCBoYW5kbGUs
IGJ1Zl90aWxpbmcsIGJ1Zl9zd2l6emxlOworCXVpbnQzMl90IHN0cmlkZTsKKwlpbnQgcmV0Owor
CWJvb2wgaXNfc2V0ID0gZmFsc2U7CisKKwlpZiAodGlsaW5nID09IEk5MTVfVElMSU5HX1gpCisJ
CXN0cmlkZSA9IDUxMjsKKwllbHNlIGlmICh0aWxpbmcgPT0gSTkxNV9USUxJTkdfWSkKKwkJc3Ry
aWRlID0gMTI4OworCWVsc2UKKwkJcmV0dXJuIGZhbHNlOworCisJaGFuZGxlID0gZ2VtX2NyZWF0
ZShib3BzLT5mZCwgc2l6ZSk7CisKKwkvKiBTaW5nbGUgc2hvdCwgaWYgbm8gZmVuY2VzIGFyZSBh
dmFpbGFibGUgd2UgZmFpbCBpbW1lZGlhdGVseSAqLworCXJldCA9IF9fc2V0X3RpbGluZyhib3Bz
LT5mZCwgaGFuZGxlLCB0aWxpbmcsIHN0cmlkZSk7CisJaWYgKHJldCkKKwkJZ290byBlbmQ7CisK
Kwlpc19zZXQgPSBfX2dldF90aWxpbmcoYm9wcy0+ZmQsIGhhbmRsZSwgJmJ1Zl90aWxpbmcsICZi
dWZfc3dpenpsZSk7CisJaWYgKGlzX3NldCkgeworCQlpZiAodGlsaW5nID09IEk5MTVfVElMSU5H
X1gpCisJCQlib3BzLT5zd2l6emxlX3ggPSBidWZfc3dpenpsZTsKKwkJZWxzZSBpZiAodGlsaW5n
ID09IEk5MTVfVElMSU5HX1kpCisJCQlib3BzLT5zd2l6emxlX3kgPSBidWZfc3dpenpsZTsKKwl9
CitlbmQ6CisJZ2VtX2Nsb3NlKGJvcHMtPmZkLCBoYW5kbGUpOworCisJcmV0dXJuIGlzX3NldDsK
K30KKworc3RhdGljIHZvaWQgKmFsbG9jX2FsaWduZWQodWludDY0X3Qgc2l6ZSkKK3sKKwl2b2lk
ICpwOworCisJaWd0X2Fzc2VydF9lcShwb3NpeF9tZW1hbGlnbigmcCwgMTYsIHNpemUpLCAwKTsK
KworCXJldHVybiBwOworfQorCisvKgorICogU2ltcGxlIGlkZW1wb3RlbmN5IHRlc3QgYmV0d2Vl
biBIVyAtPiBTVyBhbmQgU1cgLT4gSFcgQk8uCisgKi8KK3N0YXRpYyB2b2lkIGlkZW1wb3RlbmN5
X3NlbGZ0ZXN0KHN0cnVjdCBidWZfb3BzICpib3BzLCB1aW50MzJfdCB0aWxpbmcpCit7CisJc3Ry
dWN0IGludGVsX2J1ZiBidWY7CisJdWludDhfdCAqbGluZWFyX2luLCAqbGluZWFyX291dCwgKm1h
cDsKKwlpbnQgaTsKKwljb25zdCBpbnQgd2lkdGggPSA1MTI7CisJY29uc3QgaW50IGhlaWdodCA9
IDUxMjsKKwljb25zdCBpbnQgYnBwID0gMzI7CisJY29uc3QgaW50IHNpemUgPSB3aWR0aCAqIGhl
aWdodCAqIGJwcCAvIDg7CisJYm9vbCBzb2Z0d2FyZV90aWxpbmcgPSBmYWxzZTsKKworCWlmICgh
aXNfaHdfdGlsaW5nX3N1cHBvcnRlZChib3BzLCB0aWxpbmcpKQorCQlyZXR1cm47CisKKwlsaW5l
YXJfaW4gPSBhbGxvY19hbGlnbmVkKHNpemUpOworCWxpbmVhcl9vdXQgPSBhbGxvY19hbGlnbmVk
KHNpemUpOworCisJZm9yIChpID0gMDsgaSA8IHNpemU7IGkrKykKKwkJbGluZWFyX2luW2ldID0g
aSAlIDI1MzsgLyogcHJpbWUgY2hvc2VuIGludGVudGlvbmFsbHkgKi8KKworCWRvIHsKKwkJaWd0
X2RlYnVnKCJDaGVja2luZyBpZGVtcG90ZW5jeSwgU1c6ICVzLCBIVzogJXMsIHRpbGluZzogJXNc
biIsCisJCQkgIGJvb2xfc3RyKHNvZnR3YXJlX3RpbGluZyksCisJCQkgIGJvb2xfc3RyKCFzb2Z0
d2FyZV90aWxpbmcpLAorCQkJICB0aWxpbmdfc3RyKHRpbGluZykpOworCQlpbnRlbF9idWZfaW5p
dChib3BzLCAmYnVmLCB3aWR0aCwgaGVpZ2h0LCBicHAsIHRpbGluZywgZmFsc2UpOworCQlidWZf
b3BzX3NldF9zb2Z0d2FyZV90aWxpbmcoYm9wcywgdGlsaW5nLCBzb2Z0d2FyZV90aWxpbmcpOwor
CisJCWxpbmVhcl90b19pbnRlbF9idWYoYm9wcywgJmJ1ZiwgKHVpbnQzMl90ICopIGxpbmVhcl9p
bik7CisJCW1hcCA9IF9fZ2VtX21tYXBfb2Zmc2V0X19jcHUoYm9wcy0+ZmQsIGJ1Zi5oYW5kbGUs
IDAsCisJCQkJCSAgIGJ1Zi5zaXplLCBQUk9UX1JFQUQpOworCQlpZiAoIW1hcCkKKwkJCW1hcCA9
IGdlbV9tbWFwX19jcHUoYm9wcy0+ZmQsIGJ1Zi5oYW5kbGUsIDAsCisJCQkJCSAgICBidWYuc2l6
ZSwgUFJPVF9SRUFEKTsKKwkJZ2VtX3NldF9kb21haW4oYm9wcy0+ZmQsIGJ1Zi5oYW5kbGUsIEk5
MTVfR0VNX0RPTUFJTl9DUFUsIDApOworCQlpZ3RfYXNzZXJ0KG1lbWNtcChsaW5lYXJfaW4sIG1h
cCwgc2l6ZSkpOworCQltdW5tYXAobWFwLCBzaXplKTsKKworCQlidWZfb3BzX3NldF9zb2Z0d2Fy
ZV90aWxpbmcoYm9wcywgdGlsaW5nLCAhc29mdHdhcmVfdGlsaW5nKTsKKwkJaW50ZWxfYnVmX3Rv
X2xpbmVhcihib3BzLCAmYnVmLCAodWludDMyX3QgKikgbGluZWFyX291dCk7CisJCWlndF9hc3Nl
cnQoIW1lbWNtcChsaW5lYXJfaW4sIGxpbmVhcl9vdXQsIHNpemUpKTsKKworCQlpbnRlbF9idWZf
Y2xvc2UoYm9wcywgJmJ1Zik7CisKKwkJc29mdHdhcmVfdGlsaW5nID0gIXNvZnR3YXJlX3RpbGlu
ZzsKKwl9IHdoaWxlIChzb2Z0d2FyZV90aWxpbmcpOworCisJaWd0X2RlYnVnKCJJZGVtcG90ZW5j
eSBmb3IgJXMgdGlsaW5nIE9LXG4iLCB0aWxpbmdfc3RyKHRpbGluZykpOworCWJ1Zl9vcHNfc2V0
X3NvZnR3YXJlX3RpbGluZyhib3BzLCB0aWxpbmcsIGZhbHNlKTsKK30KKworLyoqCisgKiBidWZf
b3BzX2NyZWF0ZQorICogQGZkOiBkZXZpY2UgZmlsZWRlc2NyaXB0b3IKKyAqCisgKiBDcmVhdGUg
YnVmX29wcyBzdHJ1Y3R1cmUgZGVwZW5kaW5nIG9uIGZkLWRldmljZSBjYXBhYmlsaXRpZXMuCisg
KgorICogUmV0dXJuczogb3BhcXVlIHBvaW50ZXIgdG8gYnVmX29wcy4KKyAqCisgKi8KK3N0cnVj
dCBidWZfb3BzICpidWZfb3BzX2NyZWF0ZShpbnQgZmQpCit7CisJc3RydWN0IGJ1Zl9vcHMgKmJv
cHMgPSBjYWxsb2MoMSwgc2l6ZW9mKCpib3BzKSk7CisJdWludDMyX3QgZGV2aWQ7CisJaW50IGdl
bmVyYXRpb247CisKKwlpZ3RfYXNzZXJ0KGJvcHMpOworCisJZGV2aWQgPSBpbnRlbF9nZXRfZHJt
X2RldmlkKGZkKTsKKwlnZW5lcmF0aW9uID0gaW50ZWxfZ2VuKGRldmlkKTsKKworCS8qIFByZWRl
ZmluZWQgc2V0dGluZ3MgKi8KKwlmb3IgKGludCBpID0gMDsgaSA8IEFSUkFZX1NJWkUoYnVmX29w
c19hcnIpOyBpKyspIHsKKwkJaWYgKGdlbmVyYXRpb24gPj0gYnVmX29wc19hcnJbaV0uZ2VuX3N0
YXJ0ICYmCisJCSAgICBnZW5lcmF0aW9uIDw9IGJ1Zl9vcHNfYXJyW2ldLmdlbl9lbmQpIHsKKwkJ
CW1lbWNweShib3BzLCAmYnVmX29wc19hcnJbaV0sIHNpemVvZigqYm9wcykpOworCQkJYm9wcy0+
ZmQgPSBmZDsKKwkJCWJvcHMtPmludGVsX2dlbiA9IGdlbmVyYXRpb247CisJCQlpZ3RfZGVidWco
ImdlbmVyYXRpb246ICVkLCBzdXBwb3J0ZWQgdGlsZXM6IDB4JTAyeFxuIiwKKwkJCQkgIGdlbmVy
YXRpb24sIGJvcHMtPnN1cHBvcnRlZF90aWxlcyk7CisJCQlicmVhazsKKwkJfQorCX0KKworCWln
dF9hc3NlcnQoYm9wcy0+aW50ZWxfZ2VuKTsKKworCS8qCisJICogV2FybmluZyEKKwkgKgorCSAq
IEdlbjIgc29mdHdhcmUgdGlsaW5nL2RldGlsaW5nIGlzIG5vdCBzdXBwb3J0ZWQhICh5ZXQpLgor
CSAqCisJICogSWYgeW91IGFyZSBicmF2ZSBoZXJvIHdpdGggYW4gYWNjZXNzIHRvIEdlbjIgeW91
IGNhbiBzYXZlIHRoZSB3b3JsZC4KKwkgKiBVbnRpbCB0aGVuIHdlJ3JlIGRvb21lZCB0byB1c2Ug
b25seSBoYXJkd2FyZSAoZGUpdGlsaW5nLgorCSAqCisJICogT2ssIHlvdSBoYXZlIGJlZW4gd2Fy
bmVkLgorCSAqLworCWlmIChib3BzLT5pbnRlbF9nZW4gPT0gMikgeworCQlpZ3Rfd2FybigiR2Vu
MiBkZXRlY3RlZC4gSFcgKGRlKXRpbGluZyBzdXBwb3J0IG9ubHkuIik7CisJCXJldHVybiBib3Bz
OworCX0KKworCS8qIExldCdzIHByb2JlIFggYW5kIFkgaHcgdGlsaW5nIHN1cHBvcnQgKi8KKwlp
ZiAoaXNfaHdfdGlsaW5nX3N1cHBvcnRlZChib3BzLCBJOTE1X1RJTElOR19YKSkgeworCQlib29s
IHN1cHBvcnRlZCA9IHByb2JlX2h3X3RpbGluZyhib3BzLCBJOTE1X1RJTElOR19YKTsKKworCQlp
Z3RfZGVidWcoIlggZmVuY2Ugc3VwcG9ydDogJXNcbiIsIGJvb2xfc3RyKHN1cHBvcnRlZCkpOwor
CQlpZiAoIXN1cHBvcnRlZCkgeworCQkJYm9wcy0+c3VwcG9ydGVkX2h3X3RpbGVzICY9IH5USUxF
X1g7CisJCQlib3BzLT5saW5lYXJfdG9feCA9IGNvcHlfbGluZWFyX3RvX3g7CisJCQlib3BzLT54
X3RvX2xpbmVhciA9IGNvcHlfeF90b19saW5lYXI7CisJCX0KKwl9CisKKwlpZiAoaXNfaHdfdGls
aW5nX3N1cHBvcnRlZChib3BzLCBJOTE1X1RJTElOR19ZKSkgeworCQlib29sIHN1cHBvcnRlZCA9
IHByb2JlX2h3X3RpbGluZyhib3BzLCBJOTE1X1RJTElOR19ZKTsKKworCQlpZ3RfZGVidWcoIlkg
ZmVuY2Ugc3VwcG9ydDogJXNcbiIsIGJvb2xfc3RyKHN1cHBvcnRlZCkpOworCQlpZiAoIXN1cHBv
cnRlZCkgeworCQkJYm9wcy0+c3VwcG9ydGVkX2h3X3RpbGVzICY9IH5USUxFX1k7CisJCQlib3Bz
LT5saW5lYXJfdG9feSA9IGNvcHlfbGluZWFyX3RvX3k7CisJCQlib3BzLT55X3RvX2xpbmVhciA9
IGNvcHlfeV90b19saW5lYXI7CisJCX0KKwl9CisKKwkvKiBEaXNhYmxlIG90aGVyIHRpbGluZyBm
b3JtYXQgZnVuY3Rpb25zIGlmIG5vdCBzdXBwb3J0ZWQgKi8KKwlpZiAoIWlzX3RpbGluZ19zdXBw
b3J0ZWQoYm9wcywgSTkxNV9USUxJTkdfWWYpKSB7CisJCWlndF9kZWJ1ZygiWWYgZm9ybWF0IG5v
dCBzdXBwb3J0ZWRcbiIpOworCQlib3BzLT5saW5lYXJfdG9feWYgPSBOVUxMOworCQlib3BzLT55
Zl90b19saW5lYXIgPSBOVUxMOworCX0KKworCWlmICghaXNfdGlsaW5nX3N1cHBvcnRlZChib3Bz
LCBJOTE1X1RJTElOR19ZcykpIHsKKwkJaWd0X2RlYnVnKCJZcyBmb3JtYXQgbm90IHN1cHBvcnRl
ZFxuIik7CisJCWJvcHMtPmxpbmVhcl90b195cyA9IE5VTEw7CisJCWJvcHMtPnlzX3RvX2xpbmVh
ciA9IE5VTEw7CisJfQorCisJaWRlbXBvdGVuY3lfc2VsZnRlc3QoYm9wcywgSTkxNV9USUxJTkdf
WCk7CisJaWRlbXBvdGVuY3lfc2VsZnRlc3QoYm9wcywgSTkxNV9USUxJTkdfWSk7CisKKwlyZXR1
cm4gYm9wczsKK30KKworLyoqCisgKiBidWZfb3BzX2Rlc3Ryb3kKKyAqIEBib3BzOiBwb2ludGVy
IHRvIGJ1Zl9vcHMKKyAqCisgKiBGdW5jdGlvbiBmcmVlcyBidWZfb3BzIHN0cnVjdHVyZS4KKyAq
Lwordm9pZCBidWZfb3BzX2Rlc3Ryb3koc3RydWN0IGJ1Zl9vcHMgKmJvcHMpCit7CisJaWd0X2Fz
c2VydChib3BzKTsKKwlmcmVlKGJvcHMpOworfQorCisvKioKKyAqIGJ1Zl9vcHNfc2V0X3NvZnR3
YXJlX3RpbGluZworICogQGJvcHM6IHBvaW50ZXIgdG8gYnVmX29wcworICogQHRpbGluZzogc3Vy
ZmFjZSB0aWxpbmcKKyAqIEB1c2Vfc29mdHdhcmVfdGlsaW5nOiBpZiB0cnVlIHVzZSBzb2Z0d2Fy
ZSBjb3B5aW5nIG1ldGhvZHMsIG90aGVyd2lzZQorICogdXNlIGhhcmR3YXJlICh2aWEgZ3R0KQor
ICoKKyAqIEZ1bmN0aW9uIGFsbG93cyBzd2l0Y2ggWCAvIFkgc3VyZmFjZXMgdG8gc29mdHdhcmUg
LyBoYXJkd2FyZSBjb3B5aW5nIG1ldGhvZHMKKyAqIHdoaWNoIGhvbm9ycyB0aWxpbmcgYW5kIHN3
aXp6bGluZy4KKyAqCisgKiBSZXR1cm5zOgorICogZmFsc2UgLSBzd2l0Y2ggd2Fzbid0IHBvc3Np
YmxlLgorICogdHJ1ZSAtIHN3aXRjaCB0byBzb2Z0d2FyZSAvIGhhcmR3YXJlIG1ldGhvZCBzdWNj
ZWVkLgorICovCitib29sIGJ1Zl9vcHNfc2V0X3NvZnR3YXJlX3RpbGluZyhzdHJ1Y3QgYnVmX29w
cyAqYm9wcywKKwkJCQkgdWludDMyX3QgdGlsaW5nLAorCQkJCSBib29sIHVzZV9zb2Z0d2FyZV90
aWxpbmcpCit7CisJYm9vbCB3YXNfY2hhbmdlZCA9IHRydWU7CisKKwlpZ3RfYXNzZXJ0KGJvcHMp
OworCisJLyogVW50aWwgYXBwcm9wcmlhdGUgY29kZSBpcyBhZGRlZCB3ZSBkb24ndCBzdXBwb3J0
IFNXIHRpbGluZyBvbiBHZW4yICovCisJaWYgKGJvcHMtPmludGVsX2dlbiA9PSAyKSB7CisJCWln
dF93YXJuKCJDaGFuZ2UgdG8gc29mdHdhcmUgdGlsaW5nIG9uIEdlbjIgaXMgbm90IHN1cHBvcnRl
ZCEiKTsKKwkJcmV0dXJuIGZhbHNlOworCX0KKworCXN3aXRjaCAodGlsaW5nKSB7CisJY2FzZSBJ
OTE1X1RJTElOR19YOgorCQlpZiAodXNlX3NvZnR3YXJlX3RpbGluZykgeworCQkJaWd0X2RlYnVn
KCItPiBjaGFuZ2UgWCB0byBTV1xuIik7CisJCQlib3BzLT5saW5lYXJfdG9feCA9IGNvcHlfbGlu
ZWFyX3RvX3g7CisJCQlib3BzLT54X3RvX2xpbmVhciA9IGNvcHlfeF90b19saW5lYXI7CisJCX0g
ZWxzZSB7CisJCQlpZiAoaXNfaHdfdGlsaW5nX3N1cHBvcnRlZChib3BzLCBJOTE1X1RJTElOR19Y
KSkgeworCQkJCWlndF9kZWJ1ZygiLT4gY2hhbmdlIFggdG8gSFdcbiIpOworCQkJCWJvcHMtPmxp
bmVhcl90b194ID0gY29weV9saW5lYXJfdG9fZ3R0OworCQkJCWJvcHMtPnhfdG9fbGluZWFyID0g
Y29weV9ndHRfdG9fbGluZWFyOworCQkJfSBlbHNlIHsKKwkJCQlpZ3RfZGVidWcoIi0+IFggY2Fu
bm90IGJlIGNoYW5nZWQgdG8gSFdcbiIpOworCQkJCXdhc19jaGFuZ2VkID0gZmFsc2U7CisJCQl9
CisJCX0KKwkJYnJlYWs7CisKKwljYXNlIEk5MTVfVElMSU5HX1k6CisJCWlmICh1c2Vfc29mdHdh
cmVfdGlsaW5nKSB7CisJCQlpZ3RfZGVidWcoIi0+IGNoYW5nZSBZIHRvIFNXXG4iKTsKKwkJCWJv
cHMtPmxpbmVhcl90b195ID0gY29weV9saW5lYXJfdG9feTsKKwkJCWJvcHMtPnlfdG9fbGluZWFy
ID0gY29weV95X3RvX2xpbmVhcjsKKwkJfSBlbHNlIHsKKwkJCWlmIChpc19od190aWxpbmdfc3Vw
cG9ydGVkKGJvcHMsIEk5MTVfVElMSU5HX1kpKSB7CisJCQkJaWd0X2RlYnVnKCItPiBjaGFuZ2Ug
WSB0byBIV1xuIik7CisJCQkJYm9wcy0+bGluZWFyX3RvX3kgPSBjb3B5X2xpbmVhcl90b19ndHQ7
CisJCQkJYm9wcy0+eV90b19saW5lYXIgPSBjb3B5X2d0dF90b19saW5lYXI7CisJCQl9IGVsc2Ug
eworCQkJCWlndF9kZWJ1ZygiLT4gWSBjYW5ub3QgYmUgY2hhbmdlZCB0byBIV1xuIik7CisJCQkJ
d2FzX2NoYW5nZWQgPSBmYWxzZTsKKwkJCX0KKwkJfQorCQlicmVhazsKKworCWRlZmF1bHQ6CisJ
CWlndF93YXJuKCJJbnZhbGlkIHRpbGluZzogJWRcbiIsIHRpbGluZyk7CisJCXdhc19jaGFuZ2Vk
ID0gZmFsc2U7CisJfQorCisJcmV0dXJuIHdhc19jaGFuZ2VkOworfQorCisvKioKKyAqIGJ1Zl9v
cHNfaGFzX2h3X2ZlbmNlCisgKiBAYm9wczogcG9pbnRlciB0byBidWZfb3BzCisgKiBAdGlsaW5n
OiBzdXJmYWNlIHRpbGluZworICoKKyAqIEZ1bmN0aW9uIGNoZWNrcyBpZiBzdXJmYWNlIHdpdGgg
dGlsaW5nIGhhcyBIVyBmZW5jZXMgd2hpY2ggY2FuIGJlIHVzZWQKKyAqIHRvIGNvcHkgaXQgdmlh
IGd0dC4KKyAqCisgKiBSZXR1cm5zOgorICogZmFsc2UgLSBmZW5jZSBmb3IgdGlsaW5nIGlzIG5v
dCBzdXBwb3J0ZWQuCisgKiB0cnVlIC0gZmVuY2UgZm9yIHRpbGluZyBpcyBzdXBwb3J0ZWQuCisg
Ki8KK2Jvb2wgYnVmX29wc19oYXNfaHdfZmVuY2Uoc3RydWN0IGJ1Zl9vcHMgKmJvcHMsIHVpbnQz
Ml90IHRpbGluZykKK3sKKwl1aW50MzJfdCB0aWxlX21hc2sgPSBUSUxFX0RFRih0aWxpbmcpOwor
CisJaWd0X2Fzc2VydChib3BzKTsKKworCWlmICh0aWxlX21hc2sgJiBib3BzLT5zdXBwb3J0ZWRf
aHdfdGlsZXMpCisJCXJldHVybiB0cnVlOworCisJcmV0dXJuIGZhbHNlOworfQorCisvKioKKyAq
IGJ1Zl9vcHNfaGFzX3RpbGluZ19zdXBwb3J0CisgKiBAYm9wczogcG9pbnRlciB0byBidWZfb3Bz
CisgKiBAdGlsaW5nOiBzdXJmYWNlIHRpbGluZworICoKKyAqIEZ1bmN0aW9uIGNoZWNrcyBjYXBh
YmlsaXRpZXMgdG8gaGFuZGxlIHN1cmZhY2VzIHdpdGggdGlsaW5nIGluIEdQVS4KKyAqCisgKiBS
ZXR1cm5zOgorICogZmFsc2UgLSBHUFUgZG9lcyBub3Qgc3VwcG9ydCB0aWxpbmcuCisgKiB0cnVl
IC0gR1BVIHN1cHBvcnRzIHRpbGluZy4KKyAqLworYm9vbCBidWZfb3BzX2hhc190aWxpbmdfc3Vw
cG9ydChzdHJ1Y3QgYnVmX29wcyAqYm9wcywgdWludDMyX3QgdGlsaW5nKQoreworCXVpbnQzMl90
IHRpbGVfbWFzayA9IFRJTEVfREVGKHRpbGluZyk7CisKKwlpZ3RfYXNzZXJ0KGJvcHMpOworCisJ
aWYgKHRpbGVfbWFzayAmIGJvcHMtPnN1cHBvcnRlZF90aWxlcykKKwkJcmV0dXJuIHRydWU7CisK
KwlyZXR1cm4gZmFsc2U7Cit9CmRpZmYgLS1naXQgYS9saWIvaW50ZWxfYnVmb3BzLmggYi9saWIv
aW50ZWxfYnVmb3BzLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwLi5mM2Q2
YWVkOGEKLS0tIC9kZXYvbnVsbAorKysgYi9saWIvaW50ZWxfYnVmb3BzLmgKQEAgLTAsMCArMSw4
NiBAQAorI2lmbmRlZiBfX0lOVEVMX0JVRk9QU19IX18KKyNkZWZpbmUgX19JTlRFTF9CVUZPUFNf
SF9fCisKKyNpbmNsdWRlIDxzdGRpbnQuaD4KKworc3RydWN0IGJ1Zl9vcHM7CisKK3N0cnVjdCBp
bnRlbF9idWYgeworCXVpbnQzMl90IGhhbmRsZTsKKwl1aW50MzJfdCBzdHJpZGU7CisJdWludDMy
X3QgdGlsaW5nOworCXVpbnQzMl90IGJwcDsKKwl1aW50MzJfdCBzaXplOworCXVpbnQzMl90IGNv
bXByZXNzaW9uOworCXN0cnVjdCB7CisJCXVpbnQzMl90IG9mZnNldDsKKwkJdWludDMyX3Qgc3Ry
aWRlOworCX0gYXV4OworfTsKKworc3RhdGljIGlubGluZSB1bnNpZ25lZCBpbnQgaW50ZWxfYnVm
X3dpZHRoKGNvbnN0IHN0cnVjdCBpbnRlbF9idWYgKmJ1ZikKK3sKKwlyZXR1cm4gYnVmLT5zdHJp
ZGUgLyAoYnVmLT5icHAgLyA4KTsKK30KKworc3RhdGljIGlubGluZSB1bnNpZ25lZCBpbnQgaW50
ZWxfYnVmX2hlaWdodChjb25zdCBzdHJ1Y3QgaW50ZWxfYnVmICpidWYpCit7CisJcmV0dXJuIGJ1
Zi0+c2l6ZSAvIGJ1Zi0+c3RyaWRlOworfQorCitzdGF0aWMgaW5saW5lIHVuc2lnbmVkIGludAor
aW50ZWxfYnVmX2F1eF93aWR0aChpbnQgZ2VuLCBjb25zdCBzdHJ1Y3QgaW50ZWxfYnVmICpidWYp
Cit7CisJLyoKKwkgKiBHRU4xMis6IFRoZSBBVVggQ0NTIHVuaXQgc2l6ZSBpcyA2NCBieXRlcyBt
YXBwaW5nIDQgbWFpbiBzdXJmYWNlCisJICogdGlsZXMuIFRodXMgdGhlIHdpZHRoIG9mIHRoZSBD
Q1MgdW5pdCBpcyA0KjMyPTEyOCBwaXhlbHMgb24gdGhlCisJICogbWFpbiBzdXJmYWNlLgorCSAq
LworCWlmIChnZW4gPj0gMTIpCisJCXJldHVybiBESVZfUk9VTkRfVVAoaW50ZWxfYnVmX3dpZHRo
KGJ1ZiksIDEyOCkgKiA2NDsKKworCXJldHVybiBESVZfUk9VTkRfVVAoaW50ZWxfYnVmX3dpZHRo
KGJ1ZiksIDEwMjQpICogMTI4OworfQorCitzdGF0aWMgaW5saW5lIHVuc2lnbmVkIGludAoraW50
ZWxfYnVmX2F1eF9oZWlnaHQoaW50IGdlbiwgY29uc3Qgc3RydWN0IGludGVsX2J1ZiAqYnVmKQor
eworCS8qCisJICogR0VOMTIrOiBUaGUgQVVYIENDUyB1bml0IHNpemUgaXMgNjQgYnl0ZXMgbWFw
cGluZyA0IG1haW4gc3VyZmFjZQorCSAqIHRpbGVzLiBUaHVzIHRoZSBoZWlnaHQgb2YgdGhlIEND
UyB1bml0IGlzIDMyIHBpeGVsIHJvd3Mgb24gdGhlIG1haW4KKwkgKiBzdXJmYWNlLgorCSAqLwor
CWlmIChnZW4gPj0gMTIpCisJCXJldHVybiBESVZfUk9VTkRfVVAoaW50ZWxfYnVmX2hlaWdodChi
dWYpLCAzMik7CisKKwlyZXR1cm4gRElWX1JPVU5EX1VQKGludGVsX2J1Zl9oZWlnaHQoYnVmKSwg
NTEyKSAqIDMyOworfQorCitzdHJ1Y3QgYnVmX29wcyAqYnVmX29wc19jcmVhdGUoaW50IGZkKTsK
K3ZvaWQgYnVmX29wc19kZXN0cm95KHN0cnVjdCBidWZfb3BzICpib3BzKTsKKworYm9vbCBidWZf
b3BzX3NldF9zb2Z0d2FyZV90aWxpbmcoc3RydWN0IGJ1Zl9vcHMgKmJvcHMsCisJCQkJIHVpbnQz
Ml90IHRpbGluZywKKwkJCQkgYm9vbCB1c2Vfc29mdHdhcmVfdGlsaW5nKTsKKwordm9pZCBpbnRl
bF9idWZfdG9fbGluZWFyKHN0cnVjdCBidWZfb3BzICpib3BzLCBzdHJ1Y3QgaW50ZWxfYnVmICpi
dWYsCisJCQkgdWludDMyX3QgKmxpbmVhcik7CisKK3ZvaWQgbGluZWFyX3RvX2ludGVsX2J1Zihz
dHJ1Y3QgYnVmX29wcyAqYm9wcywgc3RydWN0IGludGVsX2J1ZiAqYnVmLAorCQkJIHVpbnQzMl90
ICpsaW5lYXIpOworCitib29sIGJ1Zl9vcHNfaGFzX2h3X2ZlbmNlKHN0cnVjdCBidWZfb3BzICpi
b3BzLCB1aW50MzJfdCB0aWxpbmcpOworYm9vbCBidWZfb3BzX2hhc190aWxpbmdfc3VwcG9ydChz
dHJ1Y3QgYnVmX29wcyAqYm9wcywgdWludDMyX3QgdGlsaW5nKTsKKwordm9pZCBpbnRlbF9idWZf
aW5pdChzdHJ1Y3QgYnVmX29wcyAqYm9wcywgc3RydWN0IGludGVsX2J1ZiAqYnVmLAorCQkgICAg
aW50IHdpZHRoLCBpbnQgaGVpZ2h0LCBpbnQgYnBwLAorCQkgICAgdWludDMyX3QgdGlsaW5nLCB1
aW50MzJfdCBjb21wcmVzc2lvbik7Cit2b2lkIGludGVsX2J1Zl9jbG9zZShzdHJ1Y3QgYnVmX29w
cyAqYm9wcywgc3RydWN0IGludGVsX2J1ZiAqYnVmKTsKKwordm9pZCBpbnRlbF9idWZfaW5pdF91
c2luZ19oYW5kbGUoc3RydWN0IGJ1Zl9vcHMgKmJvcHMsCisJCQkJIHVpbnQzMl90IGhhbmRsZSwK
KwkJCQkgc3RydWN0IGludGVsX2J1ZiAqYnVmLAorCQkJCSBpbnQgd2lkdGgsIGludCBoZWlnaHQs
IGludCBicHAsCisJCQkJIHVpbnQzMl90IHJlcV90aWxpbmcsIHVpbnQzMl90IGNvbXByZXNzaW9u
KTsKKworI2VuZGlmCmRpZmYgLS1naXQgYS9saWIvbWVzb24uYnVpbGQgYi9saWIvbWVzb24uYnVp
bGQKaW5kZXggNTdlYjdkOTM4Li5jZjNlMzVkYWQgMTAwNjQ0Ci0tLSBhL2xpYi9tZXNvbi5idWls
ZAorKysgYi9saWIvbWVzb24uYnVpbGQKQEAgLTI3LDYgKzI3LDcgQEAgbGliX3NvdXJjZXMgPSBb
CiAJJ2lndF94ODYuYycsCiAJJ2luc3Rkb25lLmMnLAogCSdpbnRlbF9iYXRjaGJ1ZmZlci5jJywK
KwknaW50ZWxfYnVmb3BzLmMnLAogCSdpbnRlbF9jaGlwc2V0LmMnLAogCSdpbnRlbF9kZXZpY2Vf
aW5mby5jJywKIAknaW50ZWxfb3MuYycsCi0tIAoyLjI1LjAKCl9fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fCkludGVsLWdmeCBtYWlsaW5nIGxpc3QKSW50ZWwt
Z2Z4QGxpc3RzLmZyZWVkZXNrdG9wLm9yZwpodHRwczovL2xpc3RzLmZyZWVkZXNrdG9wLm9yZy9t
YWlsbWFuL2xpc3RpbmZvL2ludGVsLWdmeAo=

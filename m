Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [IPv6:2610:10:20:722:a800:ff:fe36:1795])
	by mail.lfdr.de (Postfix) with ESMTPS id 5CBE0DC038
	for <lists+intel-gfx@lfdr.de>; Fri, 18 Oct 2019 10:46:50 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id AB2A46EAFB;
	Fri, 18 Oct 2019 08:46:48 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id A6F9A6EAFB
 for <intel-gfx@lists.freedesktop.org>; Fri, 18 Oct 2019 08:46:46 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18878873-1500050 
 for multiple; Fri, 18 Oct 2019 09:46:28 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Fri, 18 Oct 2019 09:46:27 +0100
Message-Id: <20191018084627.27445-1-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20191017080144.16899-1-chris@chris-wilson.co.uk>
References: <20191017080144.16899-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH v2] drm/i915/selftests: Add coverage of mocs
 registers
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UHJvYmUgdGhlIG1vY3MgcmVnaXN0ZXJzIGZvciBuZXcgY29udGV4dHMgYW5kIGFjcm9zcyBHUFUg
cmVzZXRzLiBTaW1pbGFyCnRvIGludGVsX3dvcmthcm91bmRzLCB3ZSBoYXZlIHRhYmxlcyBvZiB3
aGF0IHJlZ2lzdGVyIHZhbHVlcyB3ZSBleHBlY3QKdG8gc2VlLCBzbyB2ZXJpZnkgdGhhdCB1c2Vy
IGNvbnRleHRzIGFyZSBhZmZlY3RlZCBieSB0aGVtLiBJbiB0aGUKZnV0dXJlLCB3ZSBzaG91bGQg
YWRkIHRlc3RzIHNpbWlsYXIgdG8gaW50ZWxfc3NldSB0byBjb3ZlciBkeW5hbWljCnJlY29uZmln
dXJhdGlvbnMuCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlzLXdpbHNv
bi5jby51az4KQ2M6IFByYXRoYXAgS3VtYXIgVmFsc2FuIDxwcmF0aGFwLmt1bWFyLnZhbHNhbkBp
bnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbW9jcy5jICAgICAg
ICAgIHwgICA0ICsKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L3NlbGZ0ZXN0X21vY3MuYyAgICAg
ICB8IDQzMSArKysrKysrKysrKysrKysrKysKIC4uLi9kcm0vaTkxNS9zZWxmdGVzdHMvaTkxNV9s
aXZlX3NlbGZ0ZXN0cy5oICB8ICAgMSArCiAzIGZpbGVzIGNoYW5nZWQsIDQzNiBpbnNlcnRpb25z
KCspCiBjcmVhdGUgbW9kZSAxMDA2NDQgZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3Rf
bW9jcy5jCgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbW9jcy5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbW9jcy5jCmluZGV4IDViYWMzOTY2OTA2
Yi4uZjVhMjM5NjQwNTUzIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9tb2NzLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfbW9jcy5jCkBAIC00
OTAsMyArNDkwLDcgQEAgdm9pZCBpbnRlbF9tb2NzX2luaXQoc3RydWN0IGludGVsX2d0ICpndCkK
IAlpZiAoSEFTX0dMT0JBTF9NT0NTX1JFR0lTVEVSUyhndC0+aTkxNSkpCiAJCWludGVsX21vY3Nf
aW5pdF9nbG9iYWwoZ3QpOwogfQorCisjaWYgSVNfRU5BQkxFRChDT05GSUdfRFJNX0k5MTVfU0VM
RlRFU1QpCisjaW5jbHVkZSAic2VsZnRlc3RfbW9jcy5jIgorI2VuZGlmCmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF9tb2NzLmMgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF9tb2NzLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAw
MDAwMDAwLi5iM2EyMTFkMTYyYjUKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9ndC9zZWxmdGVzdF9tb2NzLmMKQEAgLTAsMCArMSw0MzEgQEAKKy8qCisgKiBTUERYLUxp
Y2Vuc2UtSWRlbnRpZmllcjogTUlUCisgKgorICogQ29weXJpZ2h0IMKpIDIwMTkgSW50ZWwgQ29y
cG9yYXRpb24KKyAqLworCisjaW5jbHVkZSAiZ3QvaW50ZWxfZW5naW5lX3BtLmgiCisjaW5jbHVk
ZSAiaTkxNV9zZWxmdGVzdC5oIgorCisjaW5jbHVkZSAiZ2VtL3NlbGZ0ZXN0cy9tb2NrX2NvbnRl
eHQuaCIKKyNpbmNsdWRlICJzZWxmdGVzdHMvaWd0X3Jlc2V0LmgiCisjaW5jbHVkZSAic2VsZnRl
c3RzL2lndF9zcGlubmVyLmgiCisKK3N0cnVjdCBsaXZlX21vY3MgeworCXN0cnVjdCBkcm1faTkx
NV9tb2NzX3RhYmxlIHRhYmxlOworCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHg7CisJc3Ry
dWN0IGk5MTVfdm1hICpzY3JhdGNoOworCXZvaWQgKnZhZGRyOworfTsKKworc3RhdGljIGludCBy
ZXF1ZXN0X2FkZF9zeW5jKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJxLCBpbnQgZXJyKQoreworCWk5
MTVfcmVxdWVzdF9nZXQocnEpOworCWk5MTVfcmVxdWVzdF9hZGQocnEpOworCWlmIChpOTE1X3Jl
cXVlc3Rfd2FpdChycSwgMCwgSFogLyA1KSA8IDApCisJCWVyciA9IC1FVElNRTsKKwlpOTE1X3Jl
cXVlc3RfcHV0KHJxKTsKKworCXJldHVybiBlcnI7Cit9CisKK3N0YXRpYyBpbnQgcmVxdWVzdF9h
ZGRfc3BpbihzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycSwgc3RydWN0IGlndF9zcGlubmVyICpzcGlu
KQoreworCWludCBlcnIgPSAwOworCisJaTkxNV9yZXF1ZXN0X2dldChycSk7CisJaTkxNV9yZXF1
ZXN0X2FkZChycSk7CisJaWYgKHNwaW4gJiYgIWlndF93YWl0X2Zvcl9zcGlubmVyKHNwaW4sIHJx
KSkKKwkJZXJyID0gLUVUSU1FOworCWk5MTVfcmVxdWVzdF9wdXQocnEpOworCisJcmV0dXJuIGVy
cjsKK30KKworc3RhdGljIHN0cnVjdCBpOTE1X3ZtYSAqY3JlYXRlX3NjcmF0Y2goc3RydWN0IGlu
dGVsX2d0ICpndCkKK3sKKwlzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqOworCXN0cnVj
dCBpOTE1X3ZtYSAqdm1hOworCWludCBlcnI7CisKKwlvYmogPSBpOTE1X2dlbV9vYmplY3RfY3Jl
YXRlX2ludGVybmFsKGd0LT5pOTE1LCBQQUdFX1NJWkUpOworCWlmIChJU19FUlIob2JqKSkKKwkJ
cmV0dXJuIEVSUl9DQVNUKG9iaik7CisKKwlpOTE1X2dlbV9vYmplY3Rfc2V0X2NhY2hlX2NvaGVy
ZW5jeShvYmosIEk5MTVfQ0FDSElOR19DQUNIRUQpOworCisJdm1hID0gaTkxNV92bWFfaW5zdGFu
Y2Uob2JqLCAmZ3QtPmdndHQtPnZtLCBOVUxMKTsKKwlpZiAoSVNfRVJSKHZtYSkpIHsKKwkJaTkx
NV9nZW1fb2JqZWN0X3B1dChvYmopOworCQlyZXR1cm4gdm1hOworCX0KKworCWVyciA9IGk5MTVf
dm1hX3Bpbih2bWEsIDAsIDAsIFBJTl9HTE9CQUwpOworCWlmIChlcnIpIHsKKwkJaTkxNV9nZW1f
b2JqZWN0X3B1dChvYmopOworCQlyZXR1cm4gRVJSX1BUUihlcnIpOworCX0KKworCXJldHVybiB2
bWE7Cit9CisKK3N0YXRpYyBpbnQgbGl2ZV9tb2NzX2luaXQoc3RydWN0IGxpdmVfbW9jcyAqYXJn
LCBzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQoreworCWludCBlcnI7CisKKwlpZiAoIWdldF9tb2NzX3Nl
dHRpbmdzKGd0LT5pOTE1LCAmYXJnLT50YWJsZSkpCisJCXJldHVybiAtRUlOVkFMOworCisJYXJn
LT5jdHggPSBrZXJuZWxfY29udGV4dChndC0+aTkxNSk7CisJaWYgKCFhcmctPmN0eCkKKwkJcmV0
dXJuIC1FTk9NRU07CisKKwlhcmctPnNjcmF0Y2ggPSBjcmVhdGVfc2NyYXRjaChndCk7CisJaWYg
KElTX0VSUihhcmctPnNjcmF0Y2gpKSB7CisJCWVyciA9IFBUUl9FUlIoYXJnLT5zY3JhdGNoKTsK
KwkJZ290byBlcnJfY3R4OworCX0KKworCWFyZy0+dmFkZHIgPSBpOTE1X2dlbV9vYmplY3RfcGlu
X21hcChhcmctPnNjcmF0Y2gtPm9iaiwgSTkxNV9NQVBfV0IpOworCWlmIChJU19FUlIoYXJnLT52
YWRkcikpIHsKKwkJZXJyID0gUFRSX0VSUihhcmctPnZhZGRyKTsKKwkJZ290byBlcnJfc2NyYXRj
aDsKKwl9CisKKwlyZXR1cm4gMDsKKworZXJyX3NjcmF0Y2g6CisJaTkxNV92bWFfdW5waW5fYW5k
X3JlbGVhc2UoJmFyZy0+c2NyYXRjaCwgMCk7CitlcnJfY3R4OgorCWtlcm5lbF9jb250ZXh0X2Ns
b3NlKGFyZy0+Y3R4KTsKKwlyZXR1cm4gZXJyOworfQorCitzdGF0aWMgdm9pZCBsaXZlX21vY3Nf
ZmluaShzdHJ1Y3QgbGl2ZV9tb2NzICphcmcpCit7CisJaTkxNV92bWFfdW5waW5fYW5kX3JlbGVh
c2UoJmFyZy0+c2NyYXRjaCwgSTkxNV9WTUFfUkVMRUFTRV9NQVApOworCWtlcm5lbF9jb250ZXh0
X2Nsb3NlKGFyZy0+Y3R4KTsKK30KKworc3RhdGljIGludCByZWFkX21vY3NfdGFibGUoc3RydWN0
IGk5MTVfcmVxdWVzdCAqcnEsCisJCQkgICBjb25zdCBzdHJ1Y3QgZHJtX2k5MTVfbW9jc190YWJs
ZSAqdGFibGUsCisJCQkgICBzdHJ1Y3QgaTkxNV92bWEgKnZtYSwgaW50ICpvZmZzZXQpCit7CisJ
dW5zaWduZWQgaW50IGk7CisJdTMyICpjczsKKworCWNzID0gaW50ZWxfcmluZ19iZWdpbihycSwg
NCAqIHRhYmxlLT5uX2VudHJpZXMpOworCWlmIChJU19FUlIoY3MpKQorCQlyZXR1cm4gUFRSX0VS
Uihjcyk7CisKKwlmb3IgKGkgPSAwOyBpIDwgdGFibGUtPm5fZW50cmllczsgaSsrKSB7CisJCSpj
cysrID0gTUlfU1RPUkVfUkVHSVNURVJfTUVNX0dFTjggfCBNSV9VU0VfR0dUVDsKKwkJKmNzKysg
PSBpOTE1X21taW9fcmVnX29mZnNldChIQVNfR0xPQkFMX01PQ1NfUkVHSVNURVJTKHJxLT5pOTE1
KSA/CisJCQkJCSAgICAgR0VOMTJfR0xPQkFMX01PQ1MoaSkgOgorCQkJCQkgICAgIG1vY3NfcmVn
aXN0ZXIocnEtPmVuZ2luZSwgaSkpOworCQkqY3MrKyA9IGk5MTVfZ2d0dF9vZmZzZXQodm1hKSAr
IGkgKiBzaXplb2YodTMyKSArICpvZmZzZXQ7CisJCSpjcysrID0gMDsKKwl9CisKKwlpbnRlbF9y
aW5nX2FkdmFuY2UocnEsIGNzKTsKKwkqb2Zmc2V0ICs9IGkgKiBzaXplb2YodTMyKTsKKworCXJl
dHVybiAwOworfQorCitzdGF0aWMgaW50IHJlYWRfbDNjY190YWJsZShzdHJ1Y3QgaTkxNV9yZXF1
ZXN0ICpycSwKKwkJCSAgIGNvbnN0IHN0cnVjdCBkcm1faTkxNV9tb2NzX3RhYmxlICp0YWJsZSwK
KwkJCSAgIHN0cnVjdCBpOTE1X3ZtYSAqdm1hLCBpbnQgKm9mZnNldCkKK3sKKwl1bnNpZ25lZCBp
bnQgaTsKKwl1MzIgKmNzOworCisJaWYgKDEgLyogY2FuJ3QgcmVhZCB0aGUgTUNSIHJhbmdlIDB4
YjAwIGRpcmVjdGx5ICovKQorCQlyZXR1cm4gMDsKKworCWNzID0gaW50ZWxfcmluZ19iZWdpbihy
cSwgNCAqIHRhYmxlLT5uX2VudHJpZXMgLyAyKTsKKwlpZiAoSVNfRVJSKGNzKSkKKwkJcmV0dXJu
IFBUUl9FUlIoY3MpOworCisJZm9yIChpID0gMDsgaSA8IHRhYmxlLT5uX2VudHJpZXMgLyAyOyBp
KyspIHsKKwkJKmNzKysgPSBNSV9TVE9SRV9SRUdJU1RFUl9NRU1fR0VOOCB8IE1JX1VTRV9HR1RU
OworCQkqY3MrKyA9IGk5MTVfbW1pb19yZWdfb2Zmc2V0KEdFTjlfTE5DRkNNT0NTKGkpKTsKKwkJ
KmNzKysgPSBpOTE1X2dndHRfb2Zmc2V0KHZtYSkgKyBpICogc2l6ZW9mKHUzMikgKyAqb2Zmc2V0
OworCQkqY3MrKyA9IDA7CisJfQorCisJaW50ZWxfcmluZ19hZHZhbmNlKHJxLCBjcyk7CisJKm9m
ZnNldCArPSBpICogc2l6ZW9mKHUzMik7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBj
aGVja19tb2NzX3RhYmxlKHN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2luZSwKKwkJCSAgICBj
b25zdCBzdHJ1Y3QgZHJtX2k5MTVfbW9jc190YWJsZSAqdGFibGUsCisJCQkgICAgY29uc3QgdTMy
ICp2YWRkciwgaW50ICpvZmZzZXQpCit7CisJdW5zaWduZWQgaW50IGk7CisJdTMyIGV4cGVjdDsK
KworCWZvciAoaSA9IDA7IGkgPCB0YWJsZS0+c2l6ZTsgaSsrKSB7CisJCWlmIChIQVNfR0xPQkFM
X01PQ1NfUkVHSVNURVJTKGVuZ2luZS0+aTkxNSkpCisJCQlleHBlY3QgPSB0YWJsZS0+dGFibGVb
aV0uY29udHJvbF92YWx1ZTsKKwkJZWxzZQorCQkJZXhwZWN0ID0gZ2V0X2VudHJ5X2NvbnRyb2wo
dGFibGUsIGkpOworCQlpZiAodmFkZHJbKm9mZnNldF0gIT0gZXhwZWN0KSB7CisJCQlwcl9lcnIo
IiVzOiBJbnZhbGlkIE1PQ1NbJWRdIGVudHJ5LCBmb3VuZCAlMDh4LCBleHBlY3RlZCAlMDh4XG4i
LAorCQkJICAgICAgIGVuZ2luZS0+bmFtZSwgaSwgdmFkZHJbKm9mZnNldF0sIGV4cGVjdCk7CisJ
CQlyZXR1cm4gLUVJTlZBTDsKKwkJfQorCQkrKypvZmZzZXQ7CisJfQorCisJLyogQWxsIHJlbWFp
bmluZyBlbnRyaWVzIGFyZSBkZWZhdWx0ICovCisJaWYgKEhBU19HTE9CQUxfTU9DU19SRUdJU1RF
UlMoZW5naW5lLT5pOTE1KSkKKwkJZXhwZWN0ID0gdGFibGUtPnRhYmxlWzBdLmNvbnRyb2xfdmFs
dWU7CisJZWxzZQorCQlleHBlY3QgPSB0YWJsZS0+dGFibGVbSTkxNV9NT0NTX1BURV0uY29udHJv
bF92YWx1ZTsKKwlmb3IgKDsgaSA8IHRhYmxlLT5uX2VudHJpZXM7IGkrKykgeworCQlpZiAodmFk
ZHJbKm9mZnNldF0gIT0gZXhwZWN0KSB7CisJCQlwcl9lcnIoIiVzOiBJbnZhbGlkIE1PQ1NbJWQq
XSBlbnRyeSwgZm91bmQgJTA4eCwgZXhwZWN0ZWQgJTA4eFxuIiwKKwkJCSAgICAgICBlbmdpbmUt
Pm5hbWUsIGksIHZhZGRyWypvZmZzZXRdLCBleHBlY3QpOworCQkJcmV0dXJuIC1FSU5WQUw7CisJ
CX0KKwkJKysqb2Zmc2V0OworCX0KKworCXJldHVybiAwOworfQorCitzdGF0aWMgaW50IGNoZWNr
X2wzY2NfdGFibGUoc3RydWN0IGludGVsX2VuZ2luZV9jcyAqZW5naW5lLAorCQkJICAgIGNvbnN0
IHN0cnVjdCBkcm1faTkxNV9tb2NzX3RhYmxlICp0YWJsZSwKKwkJCSAgICBjb25zdCB1MzIgKnZh
ZGRyLCBpbnQgKm9mZnNldCkKK3sKKwl1MTYgdW51c2VkX3ZhbHVlID0gdGFibGUtPnRhYmxlW0k5
MTVfTU9DU19QVEVdLmwzY2NfdmFsdWU7CisJdW5zaWduZWQgaW50IGk7CisJdTMyIGV4cGVjdDsK
KworCWlmICgxIC8qIGNhbid0IHJlYWQgdGhlIE1DUiByYW5nZSAweGIwMCBkaXJlY3RseSAqLykK
KwkJcmV0dXJuIDA7CisKKwlmb3IgKGkgPSAwOyBpIDwgdGFibGUtPnNpemUgLyAyOyBpKyspIHsK
KwkJdTE2IGxvdyA9IGdldF9lbnRyeV9sM2NjKHRhYmxlLCAyICogaSk7CisJCXUxNiBoaWdoID0g
Z2V0X2VudHJ5X2wzY2ModGFibGUsIDIgKiBpICsgMSk7CisKKwkJZXhwZWN0ID0gbDNjY19jb21i
aW5lKHRhYmxlLCBsb3csIGhpZ2gpOworCQlpZiAodmFkZHJbKm9mZnNldF0gIT0gZXhwZWN0KSB7
CisJCQlwcl9lcnIoIiVzOiBJbnZhbGlkIEwzQ0NbJWRdIGVudHJ5LCBmb3VuZCAlMDh4LCBleHBl
Y3RlZCAlMDh4XG4iLAorCQkJICAgICAgIGVuZ2luZS0+bmFtZSwgaSwgdmFkZHJbKm9mZnNldF0s
IGV4cGVjdCk7CisJCQlyZXR1cm4gLUVJTlZBTDsKKwkJfQorCQkrKypvZmZzZXQ7CisJfQorCisJ
LyogT2RkIHRhYmxlIHNpemUgLSAxIGxlZnQgb3ZlciAqLworCWlmICh0YWJsZS0+c2l6ZSAmIDEp
IHsKKwkJdTE2IGxvdyA9IGdldF9lbnRyeV9sM2NjKHRhYmxlLCAyICogaSk7CisKKwkJZXhwZWN0
ID0gbDNjY19jb21iaW5lKHRhYmxlLCBsb3csIHVudXNlZF92YWx1ZSk7CisJCWlmICh2YWRkclsq
b2Zmc2V0XSAhPSBleHBlY3QpIHsKKwkJCXByX2VycigiJXM6IEludmFsaWQgTDNDQ1slZF0gZW50
cnksIGZvdW5kICUwOHgsIGV4cGVjdGVkICUwOHhcbiIsCisJCQkgICAgICAgZW5naW5lLT5uYW1l
LCBpLCB2YWRkclsqb2Zmc2V0XSwgZXhwZWN0KTsKKwkJCXJldHVybiAtRUlOVkFMOworCQl9CisJ
CSsrKm9mZnNldDsKKwkJaSsrOworCX0KKworCS8qIEFsbCByZW1haW5pbmcgZW50cmllcyBhcmUg
YWxzbyB1bnVzZWQgKi8KKwlmb3IgKDsgaSA8IHRhYmxlLT5uX2VudHJpZXMgLyAyOyBpKyspIHsK
KwkJZXhwZWN0ID0gbDNjY19jb21iaW5lKHRhYmxlLCB1bnVzZWRfdmFsdWUsIHVudXNlZF92YWx1
ZSk7CisJCWlmICh2YWRkclsqb2Zmc2V0XSAhPSBleHBlY3QpIHsKKwkJCXByX2VycigiJXM6IElu
dmFsaWQgTDNDQ1slZF0gZW50cnksIGZvdW5kICUwOHgsIGV4cGVjdGVkICUwOHhcbiIsCisJCQkg
ICAgICAgZW5naW5lLT5uYW1lLCBpLCB2YWRkclsqb2Zmc2V0XSwgZXhwZWN0KTsKKwkJCXJldHVy
biAtRUlOVkFMOworCQl9CisJCSsrKm9mZnNldDsKKwl9CisKKwlyZXR1cm4gMDsKK30KKworc3Rh
dGljIGludCBjaGVja19tb2NzX2VuZ2luZShzdHJ1Y3QgbGl2ZV9tb2NzICphcmcsCisJCQkgICAg
IHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSkKK3sKKwlzdHJ1Y3QgaTkxNV92bWEgKnZtYSA9IGFy
Zy0+c2NyYXRjaDsKKwlzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpycTsKKwlpbnQgb2Zmc2V0OworCWlu
dCBlcnI7CisKKwltZW1zZXQzMihhcmctPnZhZGRyLCBTVEFDS19NQUdJQywgUEFHRV9TSVpFIC8g
c2l6ZW9mKHUzMikpOworCisJcnEgPSBpbnRlbF9jb250ZXh0X2NyZWF0ZV9yZXF1ZXN0KGNlKTsK
KwlpZiAoSVNfRVJSKHJxKSkKKwkJcmV0dXJuIFBUUl9FUlIocnEpOworCisJaTkxNV92bWFfbG9j
ayh2bWEpOworCWVyciA9IGk5MTVfcmVxdWVzdF9hd2FpdF9vYmplY3QocnEsIHZtYS0+b2JqLCB0
cnVlKTsKKwlpZiAoIWVycikKKwkJZXJyID0gaTkxNV92bWFfbW92ZV90b19hY3RpdmUodm1hLCBy
cSwgRVhFQ19PQkpFQ1RfV1JJVEUpOworCWk5MTVfdm1hX3VubG9jayh2bWEpOworCisJb2Zmc2V0
ID0gMDsKKwlpZiAoIWVycikKKwkJZXJyID0gcmVhZF9tb2NzX3RhYmxlKHJxLCAmYXJnLT50YWJs
ZSwgdm1hLCAmb2Zmc2V0KTsKKwlpZiAoIWVyciAmJiBjZS0+ZW5naW5lLT5jbGFzcyA9PSBSRU5E
RVJfQ0xBU1MpCisJCWVyciA9IHJlYWRfbDNjY190YWJsZShycSwgJmFyZy0+dGFibGUsIHZtYSwg
Jm9mZnNldCk7CisKKwllcnIgPSByZXF1ZXN0X2FkZF9zeW5jKHJxLCBlcnIpOworCWlmIChlcnIp
CisJCXJldHVybiBlcnI7CisKKwlvZmZzZXQgPSAwOworCWlmICghZXJyKQorCQllcnIgPSBjaGVj
a19tb2NzX3RhYmxlKGNlLT5lbmdpbmUsICZhcmctPnRhYmxlLAorCQkJCSAgICAgICBhcmctPnZh
ZGRyLCAmb2Zmc2V0KTsKKwlpZiAoIWVyciAmJiBjZS0+ZW5naW5lLT5jbGFzcyA9PSBSRU5ERVJf
Q0xBU1MpCisJCWVyciA9IGNoZWNrX2wzY2NfdGFibGUoY2UtPmVuZ2luZSwgJmFyZy0+dGFibGUs
CisJCQkJICAgICAgIGFyZy0+dmFkZHIsICZvZmZzZXQpOworCWlmIChlcnIpCisJCXJldHVybiBl
cnI7CisKKwlyZXR1cm4gMDsKK30KKworc3RhdGljIGludCBsaXZlX21vY3NfY2xlYW4odm9pZCAq
YXJnKQoreworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBhcmc7CisJc3RydWN0IGludGVsX2VuZ2lu
ZV9jcyAqZW5naW5lOworCWVudW0gaW50ZWxfZW5naW5lX2lkIGlkOworCXN0cnVjdCBsaXZlX21v
Y3MgbW9jczsKKwlpbnQgZXJyOworCisJZXJyID0gbGl2ZV9tb2NzX2luaXQoJm1vY3MsIGd0KTsK
KwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3Qs
IGlkKSB7CisJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKKworCQljZSA9IGludGVsX2NvbnRl
eHRfY3JlYXRlKGVuZ2luZS0+a2VybmVsX2NvbnRleHQtPmdlbV9jb250ZXh0LAorCQkJCQkgIGVu
Z2luZSk7CisJCWlmIChJU19FUlIoY2UpKSB7CisJCQllcnIgPSBQVFJfRVJSKGNlKTsKKwkJCWJy
ZWFrOworCQl9CisKKwkJZXJyID0gY2hlY2tfbW9jc19lbmdpbmUoJm1vY3MsIGNlKTsKKwkJaW50
ZWxfY29udGV4dF9wdXQoY2UpOworCQlpZiAoZXJyKQorCQkJYnJlYWs7CisJfQorCisJbGl2ZV9t
b2NzX2ZpbmkoJm1vY3MpOworCisJcmV0dXJuIGVycjsKK30KKworc3RhdGljIGludCBhY3RpdmVf
ZW5naW5lX3Jlc2V0KHN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZSwKKwkJCSAgICAgICBjb25zdCBj
aGFyICpyZWFzb24pCit7CisJc3RydWN0IGlndF9zcGlubmVyIHNwaW47CisJc3RydWN0IGk5MTVf
cmVxdWVzdCAqcnE7CisJaW50IGVycjsKKworCWVyciA9IGlndF9zcGlubmVyX2luaXQoJnNwaW4s
IGNlLT5lbmdpbmUtPmd0KTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJcnEgPSBpZ3Rf
c3Bpbm5lcl9jcmVhdGVfcmVxdWVzdCgmc3BpbiwgY2UsIE1JX05PT1ApOworCWlmIChJU19FUlIo
cnEpKSB7CisJCWlndF9zcGlubmVyX2ZpbmkoJnNwaW4pOworCQlyZXR1cm4gUFRSX0VSUihycSk7
CisJfQorCisJZXJyID0gcmVxdWVzdF9hZGRfc3BpbihycSwgJnNwaW4pOworCWlmIChlcnIgPT0g
MCkKKwkJZXJyID0gaW50ZWxfZW5naW5lX3Jlc2V0KGNlLT5lbmdpbmUsIHJlYXNvbik7CisKKwlp
Z3Rfc3Bpbm5lcl9lbmQoJnNwaW4pOworCWlndF9zcGlubmVyX2ZpbmkoJnNwaW4pOworCisJcmV0
dXJuIGVycjsKK30KKworc3RhdGljIGludCBfX2xpdmVfbW9jc19yZXNldChzdHJ1Y3QgbGl2ZV9t
b2NzICptb2NzLAorCQkJICAgICBzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCit7CisJaW50IGVy
cjsKKworCWVyciA9IGludGVsX2VuZ2luZV9yZXNldChjZS0+ZW5naW5lLCAibW9jcyIpOworCWlm
IChlcnIpCisJCXJldHVybiBlcnI7CisKKwllcnIgPSBjaGVja19tb2NzX2VuZ2luZShtb2NzLCBj
ZSk7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWVyciA9IGFjdGl2ZV9lbmdpbmVfcmVz
ZXQoY2UsICJtb2NzIik7CisJaWYgKGVycikKKwkJcmV0dXJuIGVycjsKKworCWVyciA9IGNoZWNr
X21vY3NfZW5naW5lKG1vY3MsIGNlKTsKKwlpZiAoZXJyKQorCQlyZXR1cm4gZXJyOworCisJcmV0
dXJuIDA7Cit9CisKK3N0YXRpYyBpbnQgbGl2ZV9tb2NzX3Jlc2V0KHZvaWQgKmFyZykKK3sKKwlz
dHJ1Y3QgaW50ZWxfZ3QgKmd0ID0gYXJnOworCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZTsKKwllbnVtIGludGVsX2VuZ2luZV9pZCBpZDsKKwlzdHJ1Y3QgbGl2ZV9tb2NzIG1vY3M7CisJ
aW50IGVyciA9IDA7CisKKwlpZiAoIWludGVsX2hhc19yZXNldF9lbmdpbmUoZ3QpKQorCQlyZXR1
cm4gMDsKKworCWVyciA9IGxpdmVfbW9jc19pbml0KCZtb2NzLCBndCk7CisJaWYgKGVycikKKwkJ
cmV0dXJuIGVycjsKKworCWlndF9nbG9iYWxfcmVzZXRfbG9jayhndCk7CisJZm9yX2VhY2hfZW5n
aW5lKGVuZ2luZSwgZ3QsIGlkKSB7CisJCXN0cnVjdCBpbnRlbF9jb250ZXh0ICpjZTsKKworCQlj
ZSA9IGludGVsX2NvbnRleHRfY3JlYXRlKGVuZ2luZS0+a2VybmVsX2NvbnRleHQtPmdlbV9jb250
ZXh0LAorCQkJCQkgIGVuZ2luZSk7CisJCWlmIChJU19FUlIoY2UpKSB7CisJCQllcnIgPSBQVFJf
RVJSKGNlKTsKKwkJCWJyZWFrOworCQl9CisKKwkJaW50ZWxfZW5naW5lX3BtX2dldChlbmdpbmUp
OworCQllcnIgPSBfX2xpdmVfbW9jc19yZXNldCgmbW9jcywgY2UpOworCQlpbnRlbF9lbmdpbmVf
cG1fZ2V0KGVuZ2luZSk7CisKKwkJaW50ZWxfY29udGV4dF9wdXQoY2UpOworCQlpZiAoZXJyKQor
CQkJYnJlYWs7CisJfQorCWlndF9nbG9iYWxfcmVzZXRfdW5sb2NrKGd0KTsKKworCWxpdmVfbW9j
c19maW5pKCZtb2NzKTsKKwlyZXR1cm4gZXJyOworfQorCitpbnQgaW50ZWxfbW9jc19saXZlX3Nl
bGZ0ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKK3sKKwlzdGF0aWMgY29uc3Qg
c3RydWN0IGk5MTVfc3VidGVzdCB0ZXN0c1tdID0geworCQlTVUJURVNUKGxpdmVfbW9jc19jbGVh
biksCisJCVNVQlRFU1QobGl2ZV9tb2NzX3Jlc2V0KSwKKwl9OworCXN0cnVjdCBkcm1faTkxNV9t
b2NzX3RhYmxlIHRhYmxlOworCisJaWYgKCFnZXRfbW9jc19zZXR0aW5ncyhpOTE1LCAmdGFibGUp
KQorCQlyZXR1cm4gMDsKKworCXJldHVybiBpbnRlbF9ndF9saXZlX3N1YnRlc3RzKHRlc3RzLCAm
aTkxNS0+Z3QpOworfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3Rz
L2k5MTVfbGl2ZV9zZWxmdGVzdHMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
OTE1X2xpdmVfc2VsZnRlc3RzLmgKaW5kZXggNmRhZjY1OTllYzc5Li4xYTZhYmNmZmNlODEgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pOTE1X2xpdmVfc2VsZnRl
c3RzLmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2k5MTVfbGl2ZV9zZWxm
dGVzdHMuaApAQCAtMTYsNiArMTYsNyBAQCBzZWxmdGVzdChndF9lbmdpbmVzLCBpbnRlbF9lbmdp
bmVfbGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChndF90aW1lbGluZXMsIGludGVsX3RpbWVsaW5l
X2xpdmVfc2VsZnRlc3RzKQogc2VsZnRlc3QoZ3RfY29udGV4dHMsIGludGVsX2NvbnRleHRfbGl2
ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChndF9scmMsIGludGVsX2xyY19saXZlX3NlbGZ0ZXN0cykK
K3NlbGZ0ZXN0KGd0X21vY3MsIGludGVsX21vY3NfbGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChn
dF9wbSwgaW50ZWxfZ3RfcG1fbGl2ZV9zZWxmdGVzdHMpCiBzZWxmdGVzdChyZXF1ZXN0cywgaTkx
NV9yZXF1ZXN0X2xpdmVfc2VsZnRlc3RzKQogc2VsZnRlc3QoYWN0aXZlLCBpOTE1X2FjdGl2ZV9s
aXZlX3NlbGZ0ZXN0cykKLS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMu
ZnJlZWRlc2t0b3Aub3JnCmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlz
dGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 61A1FA1356
	for <lists+intel-gfx@lfdr.de>; Thu, 29 Aug 2019 10:12:30 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id C78356E048;
	Thu, 29 Aug 2019 08:12:19 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from fireflyinternet.com (mail.fireflyinternet.com [109.228.58.192])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B99B06E049
 for <intel-gfx@lists.freedesktop.org>; Thu, 29 Aug 2019 08:12:06 +0000 (UTC)
X-Default-Received-SPF: pass (skip=forwardok (res=PASS))
 x-ip-name=78.156.65.138; 
Received: from haswell.alporthouse.com (unverified [78.156.65.138]) 
 by fireflyinternet.com (Firefly Internet (M1)) with ESMTP id 18299878-1500050 
 for multiple; Thu, 29 Aug 2019 09:11:57 +0100
From: Chris Wilson <chris@chris-wilson.co.uk>
To: intel-gfx@lists.freedesktop.org
Date: Thu, 29 Aug 2019 09:11:34 +0100
Message-Id: <20190829081150.10271-21-chris@chris-wilson.co.uk>
X-Mailer: git-send-email 2.23.0
In-Reply-To: <20190829081150.10271-1-chris@chris-wilson.co.uk>
References: <20190829081150.10271-1-chris@chris-wilson.co.uk>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 20/36] drm/i915: Move request runtime management
 onto gt
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

UmVxdWVzdHMgYXJlIHJ1biBmcm9tIHRoZSBndCBhbmQgYXJlIHRpZGVkIGludG8gdGhlIGd0IHJ1
bnRpbWUgcG93ZXIKbWFuYWdlbWVudCwgc28gcHVsbCB0aGUgcnVudGltZSByZXF1ZXN0IG1hbmFn
ZW1lbnQgdW5kZXIgZ3QvCgpTaWduZWQtb2ZmLWJ5OiBDaHJpcyBXaWxzb24gPGNocmlzQGNocmlz
LXdpbHNvbi5jby51az4KLS0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZSAgICAgICAg
ICAgICAgICAgfCAgIDEgKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX21tYW4u
YyAgICAgIHwgICA2ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vaTkxNV9nZW1fcG0uYyAg
ICAgICAgfCAgMjIgKy0tLQogLi4uL2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29u
dGV4dC5jIHwgICA1ICstCiAuLi4vZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFu
LmMgICAgfCAgIDIgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0LmMgICAgICAg
ICAgICB8ICAgMiArCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9wbS5jICAgICAg
ICAgfCAgIDkgKy0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3JlcXVlc3RzLmMg
ICB8IDExOCArKysrKysrKysrKysrKysrKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2d0X3JlcXVlc3RzLmggICB8ICAxOSArKysKIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVs
X2d0X3R5cGVzLmggICAgICB8ICAxMSArKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRl
c3RfdGltZWxpbmUuYyAgIHwgICA4ICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2RlYnVn
ZnMuYyAgICAgICAgICAgfCAgMTcgKy0tCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5o
ICAgICAgICAgICAgICAgfCAgMTAgLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMg
ICAgICAgICAgICAgICB8ICAxNSAtLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2V2
aWN0LmMgICAgICAgICB8ICAxNCArLS0KIGRyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0
dC5jICAgICAgICAgICB8ICAgNCArLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0
LmMgICAgICAgICAgIHwgIDU5ICstLS0tLS0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9y
ZXF1ZXN0LmggICAgICAgICAgIHwgICAzICstCiAuLi4vZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9p
Z3RfZmx1c2hfdGVzdC5jICAgfCAgIDkgKy0KIC4uLi9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2ln
dF9saXZlX3Rlc3QuYyAgICB8ICAgNSArLQogLi4uL2dwdS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9j
a19nZW1fZGV2aWNlLmMgIHwgICA5ICstCiAyMSBmaWxlcyBjaGFuZ2VkLCAyMDMgaW5zZXJ0aW9u
cygrKSwgMTQ1IGRlbGV0aW9ucygtKQogY3JlYXRlIG1vZGUgMTAwNjQ0IGRyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2d0X3JlcXVlc3RzLmMKIGNyZWF0ZSBtb2RlIDEwMDY0NCBkcml2ZXJz
L2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9yZXF1ZXN0cy5oCgpkaWZmIC0tZ2l0IGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9NYWtlZmlsZQpp
bmRleCA2NThiOTMwZDM0YTguLmFiNWZhNThkMjRmNyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvTWFrZWZpbGUKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvTWFrZWZpbGUKQEAg
LTgzLDYgKzgzLDcgQEAgZ3QteSArPSBcCiAJZ3QvaW50ZWxfZ3RfaXJxLm8gXAogCWd0L2ludGVs
X2d0X3BtLm8gXAogCWd0L2ludGVsX2d0X3BtX2lycS5vIFwKKwlndC9pbnRlbF9ndF9yZXF1ZXN0
cy5vIFwKIAlndC9pbnRlbF9oYW5nY2hlY2subyBcCiAJZ3QvaW50ZWxfbHJjLm8gXAogCWd0L2lu
dGVsX3JlbmRlcnN0YXRlLm8gXApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2Vt
L2k5MTVfZ2VtX21tYW4uYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFu
LmMKaW5kZXggMzE2YWE4NzQxYWNiLi5mOThmNjM1NDc3MzkgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9tbWFuLmMKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5
MTUvZ2VtL2k5MTVfZ2VtX21tYW4uYwpAQCAtOCw2ICs4LDcgQEAKICNpbmNsdWRlIDxsaW51eC9z
aXplcy5oPgogCiAjaW5jbHVkZSAiZ3QvaW50ZWxfZ3QuaCIKKyNpbmNsdWRlICJndC9pbnRlbF9n
dF9yZXF1ZXN0cy5oIgogCiAjaW5jbHVkZSAiaTkxNV9kcnYuaCIKICNpbmNsdWRlICJpOTE1X2dl
bV9ndHQuaCIKQEAgLTQyOSw2ICs0MzAsNyBAQCB2b2lkIGk5MTVfZ2VtX29iamVjdF9yZWxlYXNl
X21tYXAoc3RydWN0IGRybV9pOTE1X2dlbV9vYmplY3QgKm9iaikKIHN0YXRpYyBpbnQgY3JlYXRl
X21tYXBfb2Zmc2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmopCiB7CiAJc3RydWN0
IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSB0b19pOTE1KG9iai0+YmFzZS5kZXYpOworCXN0cnVj
dCBpbnRlbF9ndCAqZ3QgPSAmaTkxNS0+Z3Q7CiAJaW50IGVycjsKIAogCWVyciA9IGRybV9nZW1f
Y3JlYXRlX21tYXBfb2Zmc2V0KCZvYmotPmJhc2UpOwpAQCAtNDM3LDcgKzQzOSw3IEBAIHN0YXRp
YyBpbnQgY3JlYXRlX21tYXBfb2Zmc2V0KHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmop
CiAKIAkvKiBBdHRlbXB0IHRvIHJlYXAgc29tZSBtbWFwIHNwYWNlIGZyb20gZGVhZCBvYmplY3Rz
ICovCiAJZG8gewotCQllcnIgPSBpOTE1X2dlbV93YWl0X2Zvcl9pZGxlKGk5MTUsIE1BWF9TQ0hF
RFVMRV9USU1FT1VUKTsKKwkJZXJyID0gaW50ZWxfZ3Rfd2FpdF9mb3JfaWRsZShndCwgTUFYX1ND
SEVEVUxFX1RJTUVPVVQpOwogCQlpZiAoZXJyKQogCQkJYnJlYWs7CiAKQEAgLTQ0Niw3ICs0NDgs
NyBAQCBzdGF0aWMgaW50IGNyZWF0ZV9tbWFwX29mZnNldChzdHJ1Y3QgZHJtX2k5MTVfZ2VtX29i
amVjdCAqb2JqKQogCQlpZiAoIWVycikKIAkJCWJyZWFrOwogCi0JfSB3aGlsZSAoZmx1c2hfZGVs
YXllZF93b3JrKCZpOTE1LT5nZW0ucmV0aXJlX3dvcmspKTsKKwl9IHdoaWxlIChmbHVzaF9kZWxh
eWVkX3dvcmsoJmd0LT5yZXF1ZXN0cy5yZXRpcmVfd29yaykpOwogCiAJcmV0dXJuIGVycjsKIH0K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL2k5MTVfZ2VtX3BtLmMKaW5kZXggYWZiY2Y5MjE5MjY3Li5i
NDU5NzE5Mzg2ZTMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dl
bV9wbS5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9pOTE1X2dlbV9wbS5jCkBAIC03
LDMxICs3LDE4IEBACiAjaW5jbHVkZSAiZ2VtL2k5MTVfZ2VtX3BtLmgiCiAjaW5jbHVkZSAiZ3Qv
aW50ZWxfZ3QuaCIKICNpbmNsdWRlICJndC9pbnRlbF9ndF9wbS5oIgorI2luY2x1ZGUgImd0L2lu
dGVsX2d0X3JlcXVlc3RzLmgiCiAKICNpbmNsdWRlICJpOTE1X2Rydi5oIgogI2luY2x1ZGUgImk5
MTVfZ2xvYmFscy5oIgogCiBzdGF0aWMgdm9pZCBpOTE1X2dlbV9wYXJrKHN0cnVjdCBkcm1faTkx
NV9wcml2YXRlICppOTE1KQogewotCWNhbmNlbF9kZWxheWVkX3dvcmsoJmk5MTUtPmdlbS5yZXRp
cmVfd29yayk7Ci0KIAlpOTE1X3ZtYV9wYXJrZWQoaTkxNSk7CiAKIAlpOTE1X2dsb2JhbHNfcGFy
aygpOwogfQogCi1zdGF0aWMgdm9pZCByZXRpcmVfd29ya19oYW5kbGVyKHN0cnVjdCB3b3JrX3N0
cnVjdCAqd29yaykKLXsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9Ci0JCWNvbnRh
aW5lcl9vZih3b3JrLCB0eXBlb2YoKmk5MTUpLCBnZW0ucmV0aXJlX3dvcmsud29yayk7Ci0KLQlp
OTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1LCAwKTsKLQotCXF1ZXVlX2RlbGF5ZWRfd29yayhpOTE1
LT53cSwKLQkJCSAgICZpOTE1LT5nZW0ucmV0aXJlX3dvcmssCi0JCQkgICByb3VuZF9qaWZmaWVz
X3VwX3JlbGF0aXZlKEhaKSk7Ci19Ci0KIHN0YXRpYyBpbnQgcG1fbm90aWZpZXIoc3RydWN0IG5v
dGlmaWVyX2Jsb2NrICpuYiwKIAkJICAgICAgIHVuc2lnbmVkIGxvbmcgYWN0aW9uLAogCQkgICAg
ICAgdm9pZCAqZGF0YSkKQEAgLTQyLDkgKzI5LDYgQEAgc3RhdGljIGludCBwbV9ub3RpZmllcihz
dHJ1Y3Qgbm90aWZpZXJfYmxvY2sgKm5iLAogCXN3aXRjaCAoYWN0aW9uKSB7CiAJY2FzZSBJTlRF
TF9HVF9VTlBBUks6CiAJCWk5MTVfZ2xvYmFsc191bnBhcmsoKTsKLQkJcXVldWVfZGVsYXllZF93
b3JrKGk5MTUtPndxLAotCQkJCSAgICZpOTE1LT5nZW0ucmV0aXJlX3dvcmssCi0JCQkJICAgcm91
bmRfamlmZmllc191cF9yZWxhdGl2ZShIWikpOwogCQlicmVhazsKIAogCWNhc2UgSU5URUxfR1Rf
UEFSSzoKQEAgLTU5LDcgKzQzLDcgQEAgc3RhdGljIGJvb2wgc3dpdGNoX3RvX2tlcm5lbF9jb250
ZXh0X3N5bmMoc3RydWN0IGludGVsX2d0ICpndCkKIHsKIAlib29sIHJlc3VsdCA9ICFpbnRlbF9n
dF9pc193ZWRnZWQoZ3QpOwogCi0JaWYgKGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoZ3QtPmk5MTUs
IEk5MTVfR0VNX0lETEVfVElNRU9VVCkgPT0gLUVUSU1FKSB7CisJaWYgKGludGVsX2d0X3dhaXRf
Zm9yX2lkbGUoZ3QsIEk5MTVfR0VNX0lETEVfVElNRU9VVCkgPT0gLUVUSU1FKSB7CiAJCS8qIFhY
WCBoaWRlIHdhcm5pbmcgZnJvbSBnZW1fZWlvICovCiAJCWlmIChpOTE1X21vZHBhcmFtcy5yZXNl
dCkgewogCQkJZGV2X2VycihndC0+aTkxNS0+ZHJtLmRldiwKQEAgLTIxOSw4ICsyMDMsNiBAQCB2
b2lkIGk5MTVfZ2VtX3Jlc3VtZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAogdm9p
ZCBpOTE1X2dlbV9pbml0X19wbShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIHsKLQlJ
TklUX0RFTEFZRURfV09SSygmaTkxNS0+Z2VtLnJldGlyZV93b3JrLCByZXRpcmVfd29ya19oYW5k
bGVyKTsKLQogCWk5MTUtPmdlbS5wbV9ub3RpZmllci5ub3RpZmllcl9jYWxsID0gcG1fbm90aWZp
ZXI7CiAJYmxvY2tpbmdfbm90aWZpZXJfY2hhaW5fcmVnaXN0ZXIoJmk5MTUtPmd0LnBtX25vdGlm
aWNhdGlvbnMsCiAJCQkJCSAmaTkxNS0+Z2VtLnBtX25vdGlmaWVyKTsKZGlmZiAtLWdpdCBhL2Ry
aXZlcnMvZ3B1L2RybS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jIGIvZHJp
dmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9jb250ZXh0LmMKaW5kZXgg
YmM0YzhkNzYzMDI0Li5lODBkMzA5ZjU0MjcgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2dlbS9zZWxmdGVzdHMvaTkxNV9nZW1fY29udGV4dC5jCkBAIC04LDYgKzgsNyBAQAog
CiAjaW5jbHVkZSAiZ2VtL2k5MTVfZ2VtX3BtLmgiCiAjaW5jbHVkZSAiZ3QvaW50ZWxfZ3QuaCIK
KyNpbmNsdWRlICJndC9pbnRlbF9ndF9yZXF1ZXN0cy5oIgogI2luY2x1ZGUgImd0L2ludGVsX3Jl
c2V0LmgiCiAjaW5jbHVkZSAiaTkxNV9zZWxmdGVzdC5oIgogCkBAIC0zMDQsNyArMzA1LDcgQEAg
Y3JlYXRlX3Rlc3Rfb2JqZWN0KHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCWludCBl
cnI7CiAKIAkvKiBLZWVwIGluIEdFTSdzIGdvb2QgZ3JhY2VzICovCi0JaTkxNV9yZXRpcmVfcmVx
dWVzdHModm0tPmk5MTUsIDApOworCWludGVsX2d0X3JldGlyZV9yZXF1ZXN0cyh2bS0+Z3QsIDAp
OwogCiAJc2l6ZSA9IG1pbih2bS0+dG90YWwgLyAyLCAxMDI0dWxsICogRFdfUEVSX1BBR0UgKiBQ
QUdFX1NJWkUpOwogCXNpemUgPSByb3VuZF9kb3duKHNpemUsIERXX1BFUl9QQUdFICogUEFHRV9T
SVpFKTsKQEAgLTkyMiw3ICs5MjMsNyBAQCBfX3NzZXVfZmluaXNoKGNvbnN0IGNoYXIgKm5hbWUs
CiAJCWlndF9zcGlubmVyX2VuZChzcGluKTsKIAogCWlmICgoZmxhZ3MgJiBURVNUX0lETEUpICYm
IHJldCA9PSAwKSB7Ci0JCXJldCA9IGk5MTVfZ2VtX3dhaXRfZm9yX2lkbGUoY2UtPmVuZ2luZS0+
aTkxNSwKKwkJcmV0ID0gaW50ZWxfZ3Rfd2FpdF9mb3JfaWRsZShjZS0+ZW5naW5lLT5ndCwKIAkJ
CQkJICAgICBNQVhfU0NIRURVTEVfVElNRU9VVCk7CiAJCWlmIChyZXQpCiAJCQlyZXR1cm4gcmV0
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dl
bV9tbWFuLmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9nZW0vc2VsZnRlc3RzL2k5MTVfZ2VtX21t
YW4uYwppbmRleCA4NTYzYWYxODE5YzQuLjM4MmI2YWVmZWZlYyAxMDA2NDQKLS0tIGEvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ2VtL3NlbGZ0ZXN0cy9pOTE1X2dlbV9tbWFuLmMKQEAgLTM4NSw3ICsz
ODUsNyBAQCBzdGF0aWMgdm9pZCBkaXNhYmxlX3JldGlyZV93b3JrZXIoc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiB7CiAJaTkxNV9nZW1fZHJpdmVyX3VucmVnaXN0ZXJfX3Nocmlua2Vy
KGk5MTUpOwogCWludGVsX2d0X3BtX2dldCgmaTkxNS0+Z3QpOwotCWNhbmNlbF9kZWxheWVkX3dv
cmtfc3luYygmaTkxNS0+Z2VtLnJldGlyZV93b3JrKTsKKwljYW5jZWxfZGVsYXllZF93b3JrX3N5
bmMoJmk5MTUtPmd0LnJlcXVlc3RzLnJldGlyZV93b3JrKTsKIH0KIAogc3RhdGljIHZvaWQgcmVz
dG9yZV9yZXRpcmVfd29ya2VyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2d0L2ludGVsX2d0LmMKaW5kZXggYzJhZmZmYjk0NDc0Li5mMzg2MjhiZmQzNGMgMTAw
NjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0LmMKKysrIGIvZHJpdmVy
cy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3QuYwpAQCAtNiw2ICs2LDcgQEAKICNpbmNsdWRlICJp
OTE1X2Rydi5oIgogI2luY2x1ZGUgImludGVsX2d0LmgiCiAjaW5jbHVkZSAiaW50ZWxfZ3RfcG0u
aCIKKyNpbmNsdWRlICJpbnRlbF9ndF9yZXF1ZXN0cy5oIgogI2luY2x1ZGUgImludGVsX3VuY29y
ZS5oIgogCiB2b2lkIGludGVsX2d0X2luaXRfZWFybHkoc3RydWN0IGludGVsX2d0ICpndCwgc3Ry
dWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCkBAIC0yMCw2ICsyMSw3IEBAIHZvaWQgaW50ZWxf
Z3RfaW5pdF9lYXJseShzdHJ1Y3QgaW50ZWxfZ3QgKmd0LCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSkKIAogCWludGVsX2d0X2luaXRfaGFuZ2NoZWNrKGd0KTsKIAlpbnRlbF9ndF9pbml0
X3Jlc2V0KGd0KTsKKwlpbnRlbF9ndF9pbml0X3JlcXVlc3RzKGd0KTsKIAlpbnRlbF9ndF9wbV9p
bml0X2Vhcmx5KGd0KTsKIAlpbnRlbF91Y19pbml0X2Vhcmx5KCZndC0+dWMpOwogfQpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmMKaW5kZXggMTM2M2UwNjllYzgzLi4wZDU0YzQ4NzI0
OWYgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3BtLmMKKysr
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3RfcG0uYwpAQCAtOSw2ICs5LDcgQEAK
ICNpbmNsdWRlICJpbnRlbF9lbmdpbmVfcG0uaCIKICNpbmNsdWRlICJpbnRlbF9ndC5oIgogI2lu
Y2x1ZGUgImludGVsX2d0X3BtLmgiCisjaW5jbHVkZSAiaW50ZWxfZ3RfcmVxdWVzdHMuaCIKICNp
bmNsdWRlICJpbnRlbF9wbS5oIgogI2luY2x1ZGUgImludGVsX3dha2VyZWYuaCIKIApAQCAtNDcs
NiArNDgsNyBAQCBzdGF0aWMgaW50IF9fZ3RfdW5wYXJrKHN0cnVjdCBpbnRlbF93YWtlcmVmICp3
ZikKIAlpOTE1X3BtdV9ndF91bnBhcmtlZChpOTE1KTsKIAogCWludGVsX2d0X3F1ZXVlX2hhbmdj
aGVjayhndCk7CisJaW50ZWxfZ3RfdW5wYXJrX3JlcXVlc3RzKGd0KTsKIAogCXBtX25vdGlmeShp
OTE1LCBJTlRFTF9HVF9VTlBBUkspOwogCkBAIC01NSwxMyArNTcsMTQgQEAgc3RhdGljIGludCBf
X2d0X3VucGFyayhzdHJ1Y3QgaW50ZWxfd2FrZXJlZiAqd2YpCiAKIHN0YXRpYyBpbnQgX19ndF9w
YXJrKHN0cnVjdCBpbnRlbF93YWtlcmVmICp3ZikKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0
ZSAqaTkxNSA9Ci0JCWNvbnRhaW5lcl9vZih3ZiwgdHlwZW9mKCppOTE1KSwgZ3Qud2FrZXJlZik7
Ci0JaW50ZWxfd2FrZXJlZl90IHdha2VyZWYgPSBmZXRjaF9hbmRfemVybygmaTkxNS0+Z3QuYXdh
a2UpOworCXN0cnVjdCBpbnRlbF9ndCAqZ3QgPSBjb250YWluZXJfb2Yod2YsIHR5cGVvZigqZ3Qp
LCB3YWtlcmVmKTsKKwlpbnRlbF93YWtlcmVmX3Qgd2FrZXJlZiA9IGZldGNoX2FuZF96ZXJvKCZn
dC0+YXdha2UpOworCXN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1ID0gZ3QtPmk5MTU7CiAK
IAlHRU1fVFJBQ0UoIlxuIik7CiAKIAlwbV9ub3RpZnkoaTkxNSwgSU5URUxfR1RfUEFSSyk7CisJ
aW50ZWxfZ3RfcGFya19yZXF1ZXN0cyhndCk7CiAKIAlpOTE1X3BtdV9ndF9wYXJrZWQoaTkxNSk7
CiAJaWYgKElOVEVMX0dFTihpOTE1KSA+PSA2KQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJt
L2k5MTUvZ3QvaW50ZWxfZ3RfcmVxdWVzdHMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2lu
dGVsX2d0X3JlcXVlc3RzLmMKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAw
Li4xNWIyYWZjY2I0MzUKLS0tIC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9n
dC9pbnRlbF9ndF9yZXF1ZXN0cy5jCkBAIC0wLDAgKzEsMTE4IEBACisvKgorICogU1BEWC1MaWNl
bnNlLUlkZW50aWZpZXI6IE1JVAorICoKKyAqIENvcHlyaWdodCDCqSAyMDE5IEludGVsIENvcnBv
cmF0aW9uCisgKi8KKworI2luY2x1ZGUgImk5MTVfcmVxdWVzdC5oIgorI2luY2x1ZGUgImludGVs
X2d0LmgiCisjaW5jbHVkZSAiaW50ZWxfZ3RfcG0uaCIKKyNpbmNsdWRlICJpbnRlbF9ndF9yZXF1
ZXN0cy5oIgorI2luY2x1ZGUgImludGVsX3RpbWVsaW5lLmgiCisKK3N0YXRpYyB2b2lkIHJldGly
ZV9yZXF1ZXN0cyhzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsKQoreworCXN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJxLCAqcm47CisKKwlsaXN0X2Zvcl9lYWNoX2VudHJ5X3NhZmUocnEsIHJuLCAmdGwt
PnJlcXVlc3RzLCBsaW5rKQorCQlpZiAoIWk5MTVfcmVxdWVzdF9yZXRpcmUocnEpKQorCQkJYnJl
YWs7Cit9CisKK2xvbmcgaW50ZWxfZ3RfcmV0aXJlX3JlcXVlc3RzKHN0cnVjdCBpbnRlbF9ndCAq
Z3QsIGxvbmcgdGltZW91dCkKK3sKKwlzdHJ1Y3QgaW50ZWxfZ3RfdGltZWxpbmVzICp0aW1lbGlu
ZXMgPSAmZ3QtPnRpbWVsaW5lczsKKwlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsLCAqdG47CisJ
dW5zaWduZWQgbG9uZyBhY3RpdmVfY291bnQgPSAwOworCXVuc2lnbmVkIGxvbmcgZmxhZ3M7CisJ
TElTVF9IRUFEKGZyZWUpOworCisJc3Bpbl9sb2NrX2lycXNhdmUoJnRpbWVsaW5lcy0+bG9jaywg
ZmxhZ3MpOworCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZSh0bCwgdG4sICZ0aW1lbGluZXMtPmFj
dGl2ZV9saXN0LCBsaW5rKSB7CisJCWlmICghbXV0ZXhfdHJ5bG9jaygmdGwtPm11dGV4KSkKKwkJ
CWNvbnRpbnVlOworCisJCWludGVsX3RpbWVsaW5lX2dldCh0bCk7CisJCUdFTV9CVUdfT04oIXRs
LT5hY3RpdmVfY291bnQpOworCQl0bC0+YWN0aXZlX2NvdW50Kys7IC8qIHBpbiB0aGUgbGlzdCBl
bGVtZW50ICovCisJCXNwaW5fdW5sb2NrX2lycXJlc3RvcmUoJnRpbWVsaW5lcy0+bG9jaywgZmxh
Z3MpOworCisJCWlmICh0aW1lb3V0ID4gMCkgeworCQkJc3RydWN0IGRtYV9mZW5jZSAqZmVuY2U7
CisKKwkJCWZlbmNlID0gaTkxNV9hY3RpdmVfZmVuY2VfZ2V0KCZ0bC0+bGFzdF9yZXF1ZXN0KTsK
KwkJCWlmIChmZW5jZSkgeworCQkJCXRpbWVvdXQgPSBkbWFfZmVuY2Vfd2FpdF90aW1lb3V0KGZl
bmNlLAorCQkJCQkJCQkgdHJ1ZSwKKwkJCQkJCQkJIHRpbWVvdXQpOworCQkJCWRtYV9mZW5jZV9w
dXQoZmVuY2UpOworCQkJfQorCQl9CisKKwkJcmV0aXJlX3JlcXVlc3RzKHRsKTsKKworCQlzcGlu
X2xvY2tfaXJxc2F2ZSgmdGltZWxpbmVzLT5sb2NrLCBmbGFncyk7CisKKwkJLyogUmVzdW1lIGl0
ZXJhdGlvbiBhZnRlciBkcm9wcGluZyBsb2NrICovCisJCWxpc3Rfc2FmZV9yZXNldF9uZXh0KHRs
LCB0biwgbGluayk7CisJCWlmICgtLXRsLT5hY3RpdmVfY291bnQpCisJCQlhY3RpdmVfY291bnQg
Kz0gISFyY3VfYWNjZXNzX3BvaW50ZXIodGwtPmxhc3RfcmVxdWVzdC5mZW5jZSk7CisJCWVsc2UK
KwkJCWxpc3RfZGVsKCZ0bC0+bGluayk7CisKKwkJbXV0ZXhfdW5sb2NrKCZ0bC0+bXV0ZXgpOwor
CisJCS8qIERlZmVyIHRoZSBmaW5hbCByZWxlYXNlIHRvIGFmdGVyIHRoZSBzcGlubG9jayAqLwor
CQlpZiAocmVmY291bnRfZGVjX2FuZF90ZXN0KCZ0bC0+a3JlZi5yZWZjb3VudCkpIHsKKwkJCUdF
TV9CVUdfT04odGwtPmFjdGl2ZV9jb3VudCk7CisJCQlsaXN0X2FkZCgmdGwtPmxpbmssICZmcmVl
KTsKKwkJfQorCX0KKwlzcGluX3VubG9ja19pcnFyZXN0b3JlKCZ0aW1lbGluZXMtPmxvY2ssIGZs
YWdzKTsKKworCWxpc3RfZm9yX2VhY2hfZW50cnlfc2FmZSh0bCwgdG4sICZmcmVlLCBsaW5rKQor
CQlfX2ludGVsX3RpbWVsaW5lX2ZyZWUoJnRsLT5rcmVmKTsKKworCXJldHVybiBhY3RpdmVfY291
bnQgPyB0aW1lb3V0IDogMDsKK30KKworaW50IGludGVsX2d0X3dhaXRfZm9yX2lkbGUoc3RydWN0
IGludGVsX2d0ICpndCwgbG9uZyB0aW1lb3V0KQoreworCS8qIElmIHRoZSBkZXZpY2UgaXMgYXNs
ZWVwLCB3ZSBoYXZlIG5vIHJlcXVlc3RzIG91dHN0YW5kaW5nICovCisJaWYgKCFpbnRlbF9ndF9w
bV9pc19hd2FrZShndCkpCisJCXJldHVybiAwOworCisJd2hpbGUgKCh0aW1lb3V0ID0gaW50ZWxf
Z3RfcmV0aXJlX3JlcXVlc3RzKGd0LCB0aW1lb3V0KSkgPiAwKSB7CisJCWNvbmRfcmVzY2hlZCgp
OworCQlpZiAoc2lnbmFsX3BlbmRpbmcoY3VycmVudCkpCisJCQlyZXR1cm4gLUVJTlRSOworCX0K
KworCXJldHVybiB0aW1lb3V0OworfQorCitzdGF0aWMgdm9pZCByZXRpcmVfd29ya19oYW5kbGVy
KHN0cnVjdCB3b3JrX3N0cnVjdCAqd29yaykKK3sKKwlzdHJ1Y3QgaW50ZWxfZ3QgKmd0ID0KKwkJ
Y29udGFpbmVyX29mKHdvcmssIHR5cGVvZigqZ3QpLCByZXF1ZXN0cy5yZXRpcmVfd29yay53b3Jr
KTsKKworCWludGVsX2d0X3JldGlyZV9yZXF1ZXN0cyhndCwgMCk7CisJc2NoZWR1bGVfZGVsYXll
ZF93b3JrKCZndC0+cmVxdWVzdHMucmV0aXJlX3dvcmssCisJCQkgICAgICByb3VuZF9qaWZmaWVz
X3VwX3JlbGF0aXZlKEhaKSk7Cit9CisKK3ZvaWQgaW50ZWxfZ3RfaW5pdF9yZXF1ZXN0cyhzdHJ1
Y3QgaW50ZWxfZ3QgKmd0KQoreworCUlOSVRfREVMQVlFRF9XT1JLKCZndC0+cmVxdWVzdHMucmV0
aXJlX3dvcmssIHJldGlyZV93b3JrX2hhbmRsZXIpOworfQorCit2b2lkIGludGVsX2d0X3Bhcmtf
cmVxdWVzdHMoc3RydWN0IGludGVsX2d0ICpndCkKK3sKKwljYW5jZWxfZGVsYXllZF93b3JrKCZn
dC0+cmVxdWVzdHMucmV0aXJlX3dvcmspOworfQorCit2b2lkIGludGVsX2d0X3VucGFya19yZXF1
ZXN0cyhzdHJ1Y3QgaW50ZWxfZ3QgKmd0KQoreworCXNjaGVkdWxlX2RlbGF5ZWRfd29yaygmZ3Qt
PnJlcXVlc3RzLnJldGlyZV93b3JrLAorCQkJICAgICAgcm91bmRfamlmZmllc191cF9yZWxhdGl2
ZShIWikpOworfQpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3QvaW50ZWxfZ3Rf
cmVxdWVzdHMuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3JlcXVlc3RzLmgK
bmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi5hZjA3ZDU0Y2EwYWYKLS0t
IC9kZXYvbnVsbAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF9yZXF1ZXN0
cy5oCkBAIC0wLDAgKzEsMTkgQEAKKy8qCisgKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlU
CisgKgorICogQ29weXJpZ2h0IMKpIDIwMTkgSW50ZWwgQ29ycG9yYXRpb24KKyAqLworCisjaWZu
ZGVmIElOVEVMX0dUX1JFUVVFU1RTX0gKKyNkZWZpbmUgSU5URUxfR1RfUkVRVUVTVFNfSAorCitz
dHJ1Y3QgaW50ZWxfZ3Q7CisKK2xvbmcgaW50ZWxfZ3RfcmV0aXJlX3JlcXVlc3RzKHN0cnVjdCBp
bnRlbF9ndCAqZ3QsIGxvbmcgdGltZW91dCk7CitpbnQgaW50ZWxfZ3Rfd2FpdF9mb3JfaWRsZShz
dHJ1Y3QgaW50ZWxfZ3QgKmd0LCBsb25nIHRpbWVvdXQpOworCit2b2lkIGludGVsX2d0X2luaXRf
cmVxdWVzdHMoc3RydWN0IGludGVsX2d0ICpndCk7Cit2b2lkIGludGVsX2d0X3BhcmtfcmVxdWVz
dHMoc3RydWN0IGludGVsX2d0ICpndCk7Cit2b2lkIGludGVsX2d0X3VucGFya19yZXF1ZXN0cyhz
dHJ1Y3QgaW50ZWxfZ3QgKmd0KTsKKworI2VuZGlmIC8qIElOVEVMX0dUX1JFUVVFU1RTX0ggKi8K
ZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVzLmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRlbF9ndF90eXBlcy5oCmluZGV4IGRjMjk1YzE5NmQx
MS4uMmQwNDA0NTliZDZjIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9pbnRl
bF9ndF90eXBlcy5oCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2d0L2ludGVsX2d0X3R5cGVz
LmgKQEAgLTQ5LDYgKzQ5LDE3IEBAIHN0cnVjdCBpbnRlbF9ndCB7CiAJCXN0cnVjdCBsaXN0X2hl
YWQgaHdzcF9mcmVlX2xpc3Q7CiAJfSB0aW1lbGluZXM7CiAKKwlzdHJ1Y3QgaW50ZWxfZ3RfcmVx
dWVzdHMgeworCQkvKioKKwkJICogV2UgbGVhdmUgdGhlIHVzZXIgSVJRIG9mZiBhcyBtdWNoIGFz
IHBvc3NpYmxlLAorCQkgKiBidXQgdGhpcyBtZWFucyB0aGF0IHJlcXVlc3RzIHdpbGwgZmluaXNo
IGFuZCBuZXZlcgorCQkgKiBiZSByZXRpcmVkIG9uY2UgdGhlIHN5c3RlbSBnb2VzIGlkbGUuIFNl
dCBhIHRpbWVyIHRvCisJCSAqIGZpcmUgcGVyaW9kaWNhbGx5IHdoaWxlIHRoZSByaW5nIGlzIHJ1
bm5pbmcuIFdoZW4gaXQKKwkJICogZmlyZXMsIGdvIHJldGlyZSByZXF1ZXN0cy4KKwkJICovCisJ
CXN0cnVjdCBkZWxheWVkX3dvcmsgcmV0aXJlX3dvcms7CisJfSByZXF1ZXN0czsKKwogCXN0cnVj
dCBpbnRlbF93YWtlcmVmIHdha2VyZWY7CiAKIAlzdHJ1Y3QgbGlzdF9oZWFkIGNsb3NlZF92bWE7
CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxmdGVzdF90aW1lbGluZS5j
IGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvZ3Qvc2VsZnRlc3RfdGltZWxpbmUuYwppbmRleCBiMGIw
ZmE1ZjkxZGUuLjQ0OTAyOTNlYzc3YSAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUv
Z3Qvc2VsZnRlc3RfdGltZWxpbmUuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9ndC9zZWxm
dGVzdF90aW1lbGluZS5jCkBAIC04LDYgKzgsNyBAQAogCiAjaW5jbHVkZSAiaW50ZWxfZW5naW5l
X3BtLmgiCiAjaW5jbHVkZSAiaW50ZWxfZ3QuaCIKKyNpbmNsdWRlICJpbnRlbF9ndF9yZXF1ZXN0
cy5oIgogCiAjaW5jbHVkZSAiLi4vc2VsZnRlc3RzL2k5MTVfcmFuZG9tLmgiCiAjaW5jbHVkZSAi
Li4vaTkxNV9zZWxmdGVzdC5oIgpAQCAtNjQxLDYgKzY0Miw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9o
d3NwX2FsdGVybmF0ZSh2b2lkICphcmcpCiBzdGF0aWMgaW50IGxpdmVfaHdzcF93cmFwKHZvaWQg
KmFyZykKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGFyZzsKKwlzdHJ1Y3Qg
aW50ZWxfZ3QgKmd0ID0gJmk5MTUtPmd0OwogCXN0cnVjdCBpbnRlbF9lbmdpbmVfY3MgKmVuZ2lu
ZTsKIAlzdHJ1Y3QgaW50ZWxfdGltZWxpbmUgKnRsOwogCWVudW0gaW50ZWxfZW5naW5lX2lkIGlk
OwpAQCAtNjUxLDcgKzY1Myw3IEBAIHN0YXRpYyBpbnQgbGl2ZV9od3NwX3dyYXAodm9pZCAqYXJn
KQogCSAqIGZvcmVpZ24gR1BVIHJlZmVyZW5jZXMuCiAJICovCiAKLQl0bCA9IGludGVsX3RpbWVs
aW5lX2NyZWF0ZSgmaTkxNS0+Z3QsIE5VTEwpOworCXRsID0gaW50ZWxfdGltZWxpbmVfY3JlYXRl
KGd0LCBOVUxMKTsKIAlpZiAoSVNfRVJSKHRsKSkKIAkJcmV0dXJuIFBUUl9FUlIodGwpOwogCkBA
IC02NjIsNyArNjY0LDcgQEAgc3RhdGljIGludCBsaXZlX2h3c3Bfd3JhcCh2b2lkICphcmcpCiAJ
aWYgKGVycikKIAkJZ290byBvdXRfZnJlZTsKIAotCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5
MTUsIGlkKSB7CisJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZ3QtPmk5MTUsIGlkKSB7CiAJCWNv
bnN0IHUzMiAqaHdzcF9zZXFub1syXTsKIAkJc3RydWN0IGk5MTVfcmVxdWVzdCAqcnE7CiAJCXUz
MiBzZXFub1syXTsKQEAgLTczNCw3ICs3MzYsNyBAQCBzdGF0aWMgaW50IGxpdmVfaHdzcF93cmFw
KHZvaWQgKmFyZykKIAkJCWdvdG8gb3V0OwogCQl9CiAKLQkJaTkxNV9yZXRpcmVfcmVxdWVzdHMo
aTkxNSwgMCk7IC8qIHJlY3ljbGUgSFdTUCAqLworCQlpbnRlbF9ndF9yZXRpcmVfcmVxdWVzdHMo
Z3QsIDApOyAvKiByZWN5Y2xlIEhXU1AgKi8KIAl9CiAKIG91dDoKZGlmZiAtLWdpdCBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kZWJ1Z2ZzLmMKaW5kZXggZDc0MTBmM2Y1NzZmLi45MzYxNzJmNThhNjUgMTAwNjQ0Ci0tLSBh
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5jCisrKyBiL2RyaXZlcnMvZ3B1L2Ry
bS9pOTE1L2k5MTVfZGVidWdmcy5jCkBAIC00MSw2ICs0MSw3IEBACiAKICNpbmNsdWRlICJnZW0v
aTkxNV9nZW1fY29udGV4dC5oIgogI2luY2x1ZGUgImd0L2ludGVsX2d0X3BtLmgiCisjaW5jbHVk
ZSAiZ3QvaW50ZWxfZ3RfcmVxdWVzdHMuaCIKICNpbmNsdWRlICJndC9pbnRlbF9yZXNldC5oIgog
I2luY2x1ZGUgImd0L3VjL2ludGVsX2d1Y19zdWJtaXNzaW9uLmgiCiAKQEAgLTM2MDEsMzMgKzM2
MDIsMzMgQEAgc3RhdGljIGludAogaTkxNV9kcm9wX2NhY2hlc19zZXQodm9pZCAqZGF0YSwgdTY0
IHZhbCkKIHsKIAlzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSA9IGRhdGE7CisJc3RydWN0
IGludGVsX2d0ICpndCA9ICZpOTE1LT5ndDsKIAlpbnQgcmV0OwogCiAJRFJNX0RFQlVHKCJEcm9w
cGluZyBjYWNoZXM6IDB4JTA4bGx4IFsweCUwOGxseF1cbiIsCiAJCSAgdmFsLCB2YWwgJiBEUk9Q
X0FMTCk7CiAKIAlpZiAodmFsICYgRFJPUF9SRVNFVF9BQ1RJVkUgJiYKLQkgICAgd2FpdF9mb3Io
aW50ZWxfZW5naW5lc19hcmVfaWRsZSgmaTkxNS0+Z3QpLAotCQkgICAgIEk5MTVfSURMRV9FTkdJ
TkVTX1RJTUVPVVQpKQotCQlpbnRlbF9ndF9zZXRfd2VkZ2VkKCZpOTE1LT5ndCk7CisJICAgIHdh
aXRfZm9yKGludGVsX2VuZ2luZXNfYXJlX2lkbGUoZ3QpLCBJOTE1X0lETEVfRU5HSU5FU19USU1F
T1VUKSkKKwkJaW50ZWxfZ3Rfc2V0X3dlZGdlZChndCk7CiAKIAlpZiAodmFsICYgRFJPUF9SRVRJ
UkUpCi0JCWk5MTVfcmV0aXJlX3JlcXVlc3RzKGk5MTUsIDApOworCQlpbnRlbF9ndF9yZXRpcmVf
cmVxdWVzdHMoZ3QsIDApOwogCiAJaWYgKHZhbCAmIChEUk9QX0lETEUgfCBEUk9QX0FDVElWRSkp
IHsKLQkJcmV0ID0gaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShpOTE1LCBNQVhfU0NIRURVTEVfVElN
RU9VVCk7CisJCXJldCA9IGludGVsX2d0X3dhaXRfZm9yX2lkbGUoZ3QsIE1BWF9TQ0hFRFVMRV9U
SU1FT1VUKTsKIAkJaWYgKHJldCkKIAkJCXJldHVybiByZXQ7CiAJfQogCiAJaWYgKHZhbCAmIERS
T1BfSURMRSkgewotCQlyZXQgPSBpbnRlbF9ndF9wbV93YWl0X2Zvcl9pZGxlKCZpOTE1LT5ndCk7
CisJCXJldCA9IGludGVsX2d0X3BtX3dhaXRfZm9yX2lkbGUoZ3QpOwogCQlpZiAocmV0KQogCQkJ
cmV0dXJuIHJldDsKIAl9CiAKLQlpZiAodmFsICYgRFJPUF9SRVNFVF9BQ1RJVkUgJiYgaW50ZWxf
Z3RfdGVybWluYWxseV93ZWRnZWQoJmk5MTUtPmd0KSkKLQkJaW50ZWxfZ3RfaGFuZGxlX2Vycm9y
KCZpOTE1LT5ndCwgQUxMX0VOR0lORVMsIDAsIE5VTEwpOworCWlmICh2YWwgJiBEUk9QX1JFU0VU
X0FDVElWRSAmJiBpbnRlbF9ndF90ZXJtaW5hbGx5X3dlZGdlZChndCkpCisJCWludGVsX2d0X2hh
bmRsZV9lcnJvcihndCwgQUxMX0VOR0lORVMsIDAsIE5VTEwpOwogCiAJZnNfcmVjbGFpbV9hY3F1
aXJlKEdGUF9LRVJORUwpOwogCWlmICh2YWwgJiBEUk9QX0JPVU5EKQpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuaCBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVf
ZHJ2LmgKaW5kZXggZTkxMTU5Y2IyZmI2Li45ZDFkNmJkYjNmZWUgMTAwNjQ0Ci0tLSBhL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kcnYuaApAQCAtMTcwOCwxNSArMTcwOCw2IEBAIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlIHsK
IAogCXN0cnVjdCB7CiAJCXN0cnVjdCBub3RpZmllcl9ibG9jayBwbV9ub3RpZmllcjsKLQotCQkv
KioKLQkJICogV2UgbGVhdmUgdGhlIHVzZXIgSVJRIG9mZiBhcyBtdWNoIGFzIHBvc3NpYmxlLAot
CQkgKiBidXQgdGhpcyBtZWFucyB0aGF0IHJlcXVlc3RzIHdpbGwgZmluaXNoIGFuZCBuZXZlcgot
CQkgKiBiZSByZXRpcmVkIG9uY2UgdGhlIHN5c3RlbSBnb2VzIGlkbGUuIFNldCBhIHRpbWVyIHRv
Ci0JCSAqIGZpcmUgcGVyaW9kaWNhbGx5IHdoaWxlIHRoZSByaW5nIGlzIHJ1bm5pbmcuIFdoZW4g
aXQKLQkJICogZmlyZXMsIGdvIHJldGlyZSByZXF1ZXN0cy4KLQkJICovCi0JCXN0cnVjdCBkZWxh
eWVkX3dvcmsgcmV0aXJlX3dvcms7CiAJfSBnZW07CiAKIAkvKiBGb3IgaTk0NWdtIHZibGFuayBp
cnEgdnMuIEMzIHdvcmthcm91bmQgKi8KQEAgLTIzMTMsNyArMjMwNCw2IEBAIHZvaWQgaTkxNV9n
ZW1fZHJpdmVyX3JlZ2lzdGVyKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KTsKIHZvaWQg
aTkxNV9nZW1fZHJpdmVyX3VucmVnaXN0ZXIoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUp
Owogdm9pZCBpOTE1X2dlbV9kcml2ZXJfcmVtb3ZlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpk
ZXZfcHJpdik7CiB2b2lkIGk5MTVfZ2VtX2RyaXZlcl9yZWxlYXNlKHN0cnVjdCBkcm1faTkxNV9w
cml2YXRlICpkZXZfcHJpdik7Ci1pbnQgaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsIGxvbmcgdGltZW91dCk7CiB2b2lkIGk5MTVfZ2VtX3N1
c3BlbmQoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2KTsKIHZvaWQgaTkxNV9nZW1f
c3VzcGVuZF9sYXRlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdik7CiB2b2lkIGk5
MTVfZ2VtX3Jlc3VtZShzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYpOwpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9nZW0uYyBiL2RyaXZlcnMvZ3B1L2RybS9p
OTE1L2k5MTVfZ2VtLmMKaW5kZXggYTA0NTE2NjE4NGZhLi5iZGIwMzZmZjdmYzcgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtLmMKKysrIGIvZHJpdmVycy9ncHUvZHJt
L2k5MTUvaTkxNV9nZW0uYwpAQCAtODkwLDIxICs4OTAsNiBAQCB2b2lkIGk5MTVfZ2VtX3J1bnRp
bWVfc3VzcGVuZChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAl9CiB9CiAKLWludCBp
OTE1X2dlbV93YWl0X2Zvcl9pZGxlKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBsb25n
IHRpbWVvdXQpCi17Ci0JLyogSWYgdGhlIGRldmljZSBpcyBhc2xlZXAsIHdlIGhhdmUgbm8gcmVx
dWVzdHMgb3V0c3RhbmRpbmcgKi8KLQlpZiAoIWludGVsX2d0X3BtX2lzX2F3YWtlKCZpOTE1LT5n
dCkpCi0JCXJldHVybiAwOwotCi0Jd2hpbGUgKCh0aW1lb3V0ID0gaTkxNV9yZXRpcmVfcmVxdWVz
dHMoaTkxNSwgdGltZW91dCkpID4gMCkgewotCQljb25kX3Jlc2NoZWQoKTsKLQkJaWYgKHNpZ25h
bF9wZW5kaW5nKGN1cnJlbnQpKQotCQkJcmV0dXJuIC1FSU5UUjsKLQl9Ci0KLQlyZXR1cm4gdGlt
ZW91dDsKLX0KLQogc3RydWN0IGk5MTVfdm1hICoKIGk5MTVfZ2VtX29iamVjdF9nZ3R0X3Bpbihz
dHJ1Y3QgZHJtX2k5MTVfZ2VtX29iamVjdCAqb2JqLAogCQkJIGNvbnN0IHN0cnVjdCBpOTE1X2dn
dHRfdmlldyAqdmlldywKZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2Vt
X2V2aWN0LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9ldmljdC5jCmluZGV4IDcw
ODA1NWEzODg3ZS4uODAzMDI0MThhNTkwIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkx
NS9pOTE1X2dlbV9ldmljdC5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2V2
aWN0LmMKQEAgLTI5LDYgKzI5LDcgQEAKICNpbmNsdWRlIDxkcm0vaTkxNV9kcm0uaD4KIAogI2lu
Y2x1ZGUgImdlbS9pOTE1X2dlbV9jb250ZXh0LmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfZ3RfcmVx
dWVzdHMuaCIKIAogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAjaW5jbHVkZSAiaTkxNV90cmFjZS5o
IgpAQCAtMzcsNyArMzgsNyBAQCBJOTE1X1NFTEZURVNUX0RFQ0xBUkUoc3RhdGljIHN0cnVjdCBp
Z3RfZXZpY3RfY3RsIHsKIAlib29sIGZhaWxfaWZfYnVzeToxOwogfSBpZ3RfZXZpY3RfY3RsOykK
IAotc3RhdGljIGludCBnZ3R0X2ZsdXNoKHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1KQor
c3RhdGljIGludCBnZ3R0X2ZsdXNoKHN0cnVjdCBpbnRlbF9ndCAqZ3QpCiB7CiAJLyoKIAkgKiBO
b3QgZXZlcnl0aGluZyBpbiB0aGUgR0dUVCBpcyB0cmFja2VkIHZpYSB2bWEgKG90aGVyd2lzZSB3
ZQpAQCAtNDYsNyArNDcsNyBAQCBzdGF0aWMgaW50IGdndHRfZmx1c2goc3RydWN0IGRybV9pOTE1
X3ByaXZhdGUgKmk5MTUpCiAJICogdGhlIGhvcGVzIHRoYXQgd2UgY2FuIHRoZW4gcmVtb3ZlIGNv
bnRleHRzIGFuZCB0aGUgbGlrZSBvbmx5CiAJICogYm91bmQgYnkgdGhlaXIgYWN0aXZlIHJlZmVy
ZW5jZS4KIAkgKi8KLQlyZXR1cm4gaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShpOTE1LCBNQVhfU0NI
RURVTEVfVElNRU9VVCk7CisJcmV0dXJuIGludGVsX2d0X3dhaXRfZm9yX2lkbGUoZ3QsIE1BWF9T
Q0hFRFVMRV9USU1FT1VUKTsKIH0KIAogc3RhdGljIGJvb2wKQEAgLTkyLDcgKzkzLDYgQEAgaTkx
NV9nZW1fZXZpY3Rfc29tZXRoaW5nKHN0cnVjdCBpOTE1X2FkZHJlc3Nfc3BhY2UgKnZtLAogCQkJ
IHU2NCBzdGFydCwgdTY0IGVuZCwKIAkJCSB1bnNpZ25lZCBmbGFncykKIHsKLQlzdHJ1Y3QgZHJt
X2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYgPSB2bS0+aTkxNTsKIAlzdHJ1Y3QgZHJtX21tX3NjYW4g
c2NhbjsKIAlzdHJ1Y3QgbGlzdF9oZWFkIGV2aWN0aW9uX2xpc3Q7CiAJc3RydWN0IGk5MTVfdm1h
ICp2bWEsICpuZXh0OwpAQCAtMTI0LDcgKzEyNCw3IEBAIGk5MTVfZ2VtX2V2aWN0X3NvbWV0aGlu
ZyhzdHJ1Y3QgaTkxNV9hZGRyZXNzX3NwYWNlICp2bSwKIAkJCQkgICAgbWluX3NpemUsIGFsaWdu
bWVudCwgY2FjaGVfbGV2ZWwsCiAJCQkJICAgIHN0YXJ0LCBlbmQsIG1vZGUpOwogCi0JaTkxNV9y
ZXRpcmVfcmVxdWVzdHModm0tPmk5MTUsIDApOworCWludGVsX2d0X3JldGlyZV9yZXF1ZXN0cyh2
bS0+Z3QsIDApOwogCiBzZWFyY2hfYWdhaW46CiAJYWN0aXZlID0gTlVMTDsKQEAgLTE5Nyw3ICsx
OTcsNyBAQCBpOTE1X2dlbV9ldmljdF9zb21ldGhpbmcoc3RydWN0IGk5MTVfYWRkcmVzc19zcGFj
ZSAqdm0sCiAJaWYgKEk5MTVfU0VMRlRFU1RfT05MWShpZ3RfZXZpY3RfY3RsLmZhaWxfaWZfYnVz
eSkpCiAJCXJldHVybiAtRUJVU1k7CiAKLQlyZXQgPSBnZ3R0X2ZsdXNoKGRldl9wcml2KTsKKwly
ZXQgPSBnZ3R0X2ZsdXNoKHZtLT5ndCk7CiAJaWYgKHJldCkKIAkJcmV0dXJuIHJldDsKIApAQCAt
MjcxLDcgKzI3MSw3IEBAIGludCBpOTE1X2dlbV9ldmljdF9mb3Jfbm9kZShzdHJ1Y3QgaTkxNV9h
ZGRyZXNzX3NwYWNlICp2bSwKIAkgKiBhIHN0cmF5IHBpbiAocHJldmVudGluZyBldmljdGlvbikg
dGhhdCBjYW4gb25seSBiZSByZXNvbHZlZCBieQogCSAqIHJldGlyaW5nLgogCSAqLwotCWk5MTVf
cmV0aXJlX3JlcXVlc3RzKHZtLT5pOTE1LCAwKTsKKwlpbnRlbF9ndF9yZXRpcmVfcmVxdWVzdHMo
dm0tPmd0LCAwKTsKIAogCWNoZWNrX2NvbG9yID0gdm0tPm1tLmNvbG9yX2FkanVzdDsKIAlpZiAo
Y2hlY2tfY29sb3IpIHsKQEAgLTM3NCw3ICszNzQsNyBAQCBpbnQgaTkxNV9nZW1fZXZpY3Rfdm0o
c3RydWN0IGk5MTVfYWRkcmVzc19zcGFjZSAqdm0pCiAJICogc3dpdGNoIG90aGVyd2lzZSBpcyBp
bmVmZmVjdGl2ZS4KIAkgKi8KIAlpZiAoaTkxNV9pc19nZ3R0KHZtKSkgewotCQlyZXQgPSBnZ3R0
X2ZsdXNoKHZtLT5pOTE1KTsKKwkJcmV0ID0gZ2d0dF9mbHVzaCh2bS0+Z3QpOwogCQlpZiAocmV0
KQogCQkJcmV0dXJuIHJldDsKIAl9CmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9p
OTE1X2dlbV9ndHQuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZ2VtX2d0dC5jCmluZGV4
IDAyYzRjNWE0YjQ3Zi4uMGY3OTE5MDEwYTZlIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2dlbV9ndHQuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2dlbV9n
dHQuYwpAQCAtMzgsNiArMzgsNyBAQAogCiAjaW5jbHVkZSAiZGlzcGxheS9pbnRlbF9mcm9udGJ1
ZmZlci5oIgogI2luY2x1ZGUgImd0L2ludGVsX2d0LmgiCisjaW5jbHVkZSAiZ3QvaW50ZWxfZ3Rf
cmVxdWVzdHMuaCIKIAogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAjaW5jbHVkZSAiaTkxNV9zY2F0
dGVybGlzdC5oIgpAQCAtMjUyMSw3ICsyNTIyLDggQEAgdm9pZCBpOTE1X2dlbV9ndHRfZmluaXNo
X3BhZ2VzKHN0cnVjdCBkcm1faTkxNV9nZW1fb2JqZWN0ICpvYmosCiAJc3RydWN0IGk5MTVfZ2d0
dCAqZ2d0dCA9ICZkZXZfcHJpdi0+Z2d0dDsKIAogCWlmICh1bmxpa2VseShnZ3R0LT5kb19pZGxl
X21hcHMpKSB7Ci0JCWlmIChpOTE1X3JldGlyZV9yZXF1ZXN0cyhkZXZfcHJpdiwgTUFYX1NDSEVE
VUxFX1RJTUVPVVQpKSB7CisJCWlmIChpbnRlbF9ndF9yZXRpcmVfcmVxdWVzdHMoZ2d0dC0+dm0u
Z3QsCisJCQkJCSAgICAgTUFYX1NDSEVEVUxFX1RJTUVPVVQpKSB7CiAJCQlEUk1fRVJST1IoIkZh
aWxlZCB0byB3YWl0IGZvciBpZGxlOyBWVCdkIG1heSBoYW5nLlxuIik7CiAJCQkvKiBXYWl0IGEg
Yml0LCBpbiBob3BlcyBpdCBhdm9pZHMgdGhlIGhhbmcgKi8KIAkJCXVkZWxheSgxMCk7CmRpZmYg
LS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYyBiL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfcmVxdWVzdC5jCmluZGV4IDFjNWU4MDRjOWNhMi4uMmQyMGVjMjExY2Iy
IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYworKysgYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuYwpAQCAtMTk1LDcgKzE5NSw3IEBAIHN0
YXRpYyB2b2lkIGZyZWVfY2FwdHVyZV9saXN0KHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJlcXVlc3Qp
CiAJfQogfQogCi1zdGF0aWMgYm9vbCBpOTE1X3JlcXVlc3RfcmV0aXJlKHN0cnVjdCBpOTE1X3Jl
cXVlc3QgKnJxKQorYm9vbCBpOTE1X3JlcXVlc3RfcmV0aXJlKHN0cnVjdCBpOTE1X3JlcXVlc3Qg
KnJxKQogewogCWxvY2tkZXBfYXNzZXJ0X2hlbGQoJnJxLT50aW1lbGluZS0+bXV0ZXgpOwogCkBA
IC0xNDI5LDYzICsxNDI5LDYgQEAgbG9uZyBpOTE1X3JlcXVlc3Rfd2FpdChzdHJ1Y3QgaTkxNV9y
ZXF1ZXN0ICpycSwKIAlyZXR1cm4gdGltZW91dDsKIH0KIAotbG9uZyBpOTE1X3JldGlyZV9yZXF1
ZXN0cyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSwgbG9uZyB0aW1lb3V0KQotewotCXN0
cnVjdCBpbnRlbF9ndF90aW1lbGluZXMgKnRpbWVsaW5lcyA9ICZpOTE1LT5ndC50aW1lbGluZXM7
Ci0Jc3RydWN0IGludGVsX3RpbWVsaW5lICp0bCwgKnRuOwotCXVuc2lnbmVkIGxvbmcgYWN0aXZl
X2NvdW50ID0gMDsKLQl1bnNpZ25lZCBsb25nIGZsYWdzOwotCUxJU1RfSEVBRChmcmVlKTsKLQot
CXNwaW5fbG9ja19pcnFzYXZlKCZ0aW1lbGluZXMtPmxvY2ssIGZsYWdzKTsKLQlsaXN0X2Zvcl9l
YWNoX2VudHJ5X3NhZmUodGwsIHRuLCAmdGltZWxpbmVzLT5hY3RpdmVfbGlzdCwgbGluaykgewot
CQlpZiAoIW11dGV4X3RyeWxvY2soJnRsLT5tdXRleCkpCi0JCQljb250aW51ZTsKLQotCQlpbnRl
bF90aW1lbGluZV9nZXQodGwpOwotCQlHRU1fQlVHX09OKCF0bC0+YWN0aXZlX2NvdW50KTsKLQkJ
dGwtPmFjdGl2ZV9jb3VudCsrOyAvKiBwaW4gdGhlIGxpc3QgZWxlbWVudCAqLwotCQlzcGluX3Vu
bG9ja19pcnFyZXN0b3JlKCZ0aW1lbGluZXMtPmxvY2ssIGZsYWdzKTsKLQotCQlpZiAodGltZW91
dCA+IDApIHsKLQkJCXN0cnVjdCBkbWFfZmVuY2UgKmZlbmNlOwotCi0JCQlmZW5jZSA9IGk5MTVf
YWN0aXZlX2ZlbmNlX2dldCgmdGwtPmxhc3RfcmVxdWVzdCk7Ci0JCQlpZiAoZmVuY2UpIHsKLQkJ
CQl0aW1lb3V0ID0gZG1hX2ZlbmNlX3dhaXRfdGltZW91dChmZW5jZSwKLQkJCQkJCQkJIHRydWUs
Ci0JCQkJCQkJCSB0aW1lb3V0KTsKLQkJCQlkbWFfZmVuY2VfcHV0KGZlbmNlKTsKLQkJCX0KLQkJ
fQotCi0JCXJldGlyZV9yZXF1ZXN0cyh0bCk7Ci0KLQkJc3Bpbl9sb2NrX2lycXNhdmUoJnRpbWVs
aW5lcy0+bG9jaywgZmxhZ3MpOwotCi0JCS8qIFJlc3VtZSBpdGVyYXRpb24gYWZ0ZXIgZHJvcHBp
bmcgbG9jayAqLwotCQlsaXN0X3NhZmVfcmVzZXRfbmV4dCh0bCwgdG4sIGxpbmspOwotCQlpZiAo
LS10bC0+YWN0aXZlX2NvdW50KQotCQkJYWN0aXZlX2NvdW50ICs9ICEhcmN1X2FjY2Vzc19wb2lu
dGVyKHRsLT5sYXN0X3JlcXVlc3QuZmVuY2UpOwotCQllbHNlCi0JCQlsaXN0X2RlbCgmdGwtPmxp
bmspOwotCi0JCW11dGV4X3VubG9jaygmdGwtPm11dGV4KTsKLQotCQkvKiBEZWZlciB0aGUgZmlu
YWwgcmVsZWFzZSB0byBhZnRlciB0aGUgc3BpbmxvY2sgKi8KLQkJaWYgKHJlZmNvdW50X2RlY19h
bmRfdGVzdCgmdGwtPmtyZWYucmVmY291bnQpKSB7Ci0JCQlHRU1fQlVHX09OKHRsLT5hY3RpdmVf
Y291bnQpOwotCQkJbGlzdF9hZGQoJnRsLT5saW5rLCAmZnJlZSk7Ci0JCX0KLQl9Ci0Jc3Bpbl91
bmxvY2tfaXJxcmVzdG9yZSgmdGltZWxpbmVzLT5sb2NrLCBmbGFncyk7Ci0KLQlsaXN0X2Zvcl9l
YWNoX2VudHJ5X3NhZmUodGwsIHRuLCAmZnJlZSwgbGluaykKLQkJX19pbnRlbF90aW1lbGluZV9m
cmVlKCZ0bC0+a3JlZik7Ci0KLQlyZXR1cm4gYWN0aXZlX2NvdW50ID8gdGltZW91dCA6IDA7Ci19
Ci0KICNpZiBJU19FTkFCTEVEKENPTkZJR19EUk1fSTkxNV9TRUxGVEVTVCkKICNpbmNsdWRlICJz
ZWxmdGVzdHMvbW9ja19yZXF1ZXN0LmMiCiAjaW5jbHVkZSAic2VsZnRlc3RzL2k5MTVfcmVxdWVz
dC5jIgpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmggYi9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X3JlcXVlc3QuaAppbmRleCAyYTVkNjgyYWE2YjEuLmRl
OWFkOTIxNDVkMiAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0
LmgKKysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9yZXF1ZXN0LmgKQEAgLTI1MCw2ICsy
NTAsNyBAQCBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICpfX2k5MTVfcmVxdWVzdF9jb21taXQoc3RydWN0
IGk5MTVfcmVxdWVzdCAqcmVxdWVzdCk7CiB2b2lkIF9faTkxNV9yZXF1ZXN0X3F1ZXVlKHN0cnVj
dCBpOTE1X3JlcXVlc3QgKnJxLAogCQkJICBjb25zdCBzdHJ1Y3QgaTkxNV9zY2hlZF9hdHRyICph
dHRyKTsKIAorYm9vbCBpOTE1X3JlcXVlc3RfcmV0aXJlKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
KTsKIHZvaWQgaTkxNV9yZXF1ZXN0X3JldGlyZV91cHRvKHN0cnVjdCBpOTE1X3JlcXVlc3QgKnJx
KTsKIAogc3RhdGljIGlubGluZSBzdHJ1Y3QgaTkxNV9yZXF1ZXN0ICoKQEAgLTQzOSw2ICs0NDAs
NCBAQCBzdGF0aWMgaW5saW5lIGJvb2wgaTkxNV9yZXF1ZXN0X2hhc19ub3ByZWVtcHQoY29uc3Qg
c3RydWN0IGk5MTVfcmVxdWVzdCAqcnEpCiAJcmV0dXJuIHVubGlrZWx5KHJxLT5mbGFncyAmIEk5
MTVfUkVRVUVTVF9OT1BSRUVNUFQpOwogfQogCi1sb25nIGk5MTVfcmV0aXJlX3JlcXVlc3RzKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICppOTE1LCBsb25nIHRpbWVvdXQpOwotCiAjZW5kaWYgLyog
STkxNV9SRVFVRVNUX0ggKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0
ZXN0cy9pZ3RfZmx1c2hfdGVzdC5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2ln
dF9mbHVzaF90ZXN0LmMKaW5kZXggZWQ0OTZiZDZkODRmLi43YjA5MzllM2YwMDcgMTAwNjQ0Ci0t
LSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5jCisrKyBi
L2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfZmx1c2hfdGVzdC5jCkBAIC00LDgg
KzQsOCBAQAogICogQ29weXJpZ2h0IMKpIDIwMTggSW50ZWwgQ29ycG9yYXRpb24KICAqLwogCi0j
aW5jbHVkZSAiZ2VtL2k5MTVfZ2VtX2NvbnRleHQuaCIKICNpbmNsdWRlICJndC9pbnRlbF9ndC5o
IgorI2luY2x1ZGUgImd0L2ludGVsX2d0X3JlcXVlc3RzLmgiCiAKICNpbmNsdWRlICJpOTE1X2Ry
di5oIgogI2luY2x1ZGUgImk5MTVfc2VsZnRlc3QuaCIKQEAgLTE0LDExICsxNCwxMiBAQAogCiBp
bnQgaWd0X2ZsdXNoX3Rlc3Qoc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUpCiB7Ci0JaW50
IHJldCA9IGludGVsX2d0X2lzX3dlZGdlZCgmaTkxNS0+Z3QpID8gLUVJTyA6IDA7CisJc3RydWN0
IGludGVsX2d0ICpndCA9ICZpOTE1LT5ndDsKKwlpbnQgcmV0ID0gaW50ZWxfZ3RfaXNfd2VkZ2Vk
KGd0KSA/IC1FSU8gOiAwOwogCiAJY29uZF9yZXNjaGVkKCk7CiAKLQlpZiAoaTkxNV9nZW1fd2Fp
dF9mb3JfaWRsZShpOTE1LCBIWiAvIDUpID09IC1FVElNRSkgeworCWlmIChpbnRlbF9ndF93YWl0
X2Zvcl9pZGxlKGd0LCBIWiAvIDUpID09IC1FVElNRSkgewogCQlwcl9lcnIoIiVwUyB0aW1lZCBv
dXQsIGNhbmNlbGxpbmcgYWxsIGZ1cnRoZXIgdGVzdGluZy5cbiIsCiAJCSAgICAgICBfX2J1aWx0
aW5fcmV0dXJuX2FkZHJlc3MoMCkpOwogCkBAIC0yNiw3ICsyNyw3IEBAIGludCBpZ3RfZmx1c2hf
dGVzdChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAkJCSAgX19idWlsdGluX3JldHVy
bl9hZGRyZXNzKDApKTsKIAkJR0VNX1RSQUNFX0RVTVAoKTsKIAotCQlpbnRlbF9ndF9zZXRfd2Vk
Z2VkKCZpOTE1LT5ndCk7CisJCWludGVsX2d0X3NldF93ZWRnZWQoZ3QpOwogCQlyZXQgPSAtRUlP
OwogCX0KIApkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9s
aXZlX3Rlc3QuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfbGl2ZV90ZXN0
LmMKaW5kZXggZWFlOTBmOTdkZjZjLi44MTBiNjAxMDBjMmMgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMv
Z3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pZ3RfbGl2ZV90ZXN0LmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL2lndF9saXZlX3Rlc3QuYwpAQCAtNCw3ICs0LDggQEAKICAqIENv
cHlyaWdodCDCqSAyMDE4IEludGVsIENvcnBvcmF0aW9uCiAgKi8KIAotI2luY2x1ZGUgIi4uL2k5
MTVfZHJ2LmgiCisjaW5jbHVkZSAiaTkxNV9kcnYuaCIKKyNpbmNsdWRlICJndC9pbnRlbF9ndF9y
ZXF1ZXN0cy5oIgogCiAjaW5jbHVkZSAiLi4vaTkxNV9zZWxmdGVzdC5oIgogI2luY2x1ZGUgImln
dF9mbHVzaF90ZXN0LmgiCkBAIC0yMyw3ICsyNCw3IEBAIGludCBpZ3RfbGl2ZV90ZXN0X2JlZ2lu
KHN0cnVjdCBpZ3RfbGl2ZV90ZXN0ICp0LAogCXQtPmZ1bmMgPSBmdW5jOwogCXQtPm5hbWUgPSBu
YW1lOwogCi0JZXJyID0gaTkxNV9nZW1fd2FpdF9mb3JfaWRsZShpOTE1LCBNQVhfU0NIRURVTEVf
VElNRU9VVCk7CisJZXJyID0gaW50ZWxfZ3Rfd2FpdF9mb3JfaWRsZSgmaTkxNS0+Z3QsIE1BWF9T
Q0hFRFVMRV9USU1FT1VUKTsKIAlpZiAoZXJyKSB7CiAJCXByX2VycigiJXMoJXMpOiBmYWlsZWQg
dG8gaWRsZSBiZWZvcmUsIHdpdGggZXJyPSVkISIsCiAJCSAgICAgICBmdW5jLCBuYW1lLCBlcnIp
OwpkaWZmIC0tZ2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2Rl
dmljZS5jIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5j
CmluZGV4IDY2Y2M1NjM0ZGIxYy4uYWYwMzU2ZTY2YTQ3IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9zZWxmdGVzdHMvbW9ja19nZW1fZGV2aWNlLmMKKysrIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvc2VsZnRlc3RzL21vY2tfZ2VtX2RldmljZS5jCkBAIC0yNiw2ICsyNiw3IEBACiAj
aW5jbHVkZSA8bGludXgvcG1fcnVudGltZS5oPgogCiAjaW5jbHVkZSAiZ3QvaW50ZWxfZ3QuaCIK
KyNpbmNsdWRlICJndC9pbnRlbF9ndF9yZXF1ZXN0cy5oIgogI2luY2x1ZGUgImd0L21vY2tfZW5n
aW5lLmgiCiAKICNpbmNsdWRlICJtb2NrX3JlcXVlc3QuaCIKQEAgLTQ0LDcgKzQ1LDcgQEAgdm9p
ZCBtb2NrX2RldmljZV9mbHVzaChzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqaTkxNSkKIAlkbyB7
CiAJCWZvcl9lYWNoX2VuZ2luZShlbmdpbmUsIGk5MTUsIGlkKQogCQkJbW9ja19lbmdpbmVfZmx1
c2goZW5naW5lKTsKLQl9IHdoaWxlIChpOTE1X3JldGlyZV9yZXF1ZXN0cyhpOTE1LCBNQVhfU0NI
RURVTEVfVElNRU9VVCkpOworCX0gd2hpbGUgKGludGVsX2d0X3JldGlyZV9yZXF1ZXN0cygmaTkx
NS0+Z3QsIE1BWF9TQ0hFRFVMRV9USU1FT1VUKSk7CiB9CiAKIHN0YXRpYyB2b2lkIG1vY2tfZGV2
aWNlX3JlbGVhc2Uoc3RydWN0IGRybV9kZXZpY2UgKmRldikKQEAgLTk4LDEwICs5OSw2IEBAIHN0
YXRpYyB2b2lkIHJlbGVhc2VfZGV2KHN0cnVjdCBkZXZpY2UgKmRldikKIAlrZnJlZShwZGV2KTsK
IH0KIAotc3RhdGljIHZvaWQgbW9ja19yZXRpcmVfd29ya19oYW5kbGVyKHN0cnVjdCB3b3JrX3N0
cnVjdCAqd29yaykKLXsKLX0KLQogc3RhdGljIGludCBwbV9kb21haW5fcmVzdW1lKHN0cnVjdCBk
ZXZpY2UgKmRldikKIHsKIAlyZXR1cm4gcG1fZ2VuZXJpY19ydW50aW1lX3Jlc3VtZShkZXYpOwpA
QCAtMTgwLDggKzE3Nyw2IEBAIHN0cnVjdCBkcm1faTkxNV9wcml2YXRlICptb2NrX2dlbV9kZXZp
Y2Uodm9pZCkKIAogCW1vY2tfaW5pdF9jb250ZXh0cyhpOTE1KTsKIAotCUlOSVRfREVMQVlFRF9X
T1JLKCZpOTE1LT5nZW0ucmV0aXJlX3dvcmssIG1vY2tfcmV0aXJlX3dvcmtfaGFuZGxlcik7Ci0K
IAlpOTE1LT5ndC5hd2FrZSA9IHRydWU7CiAKIAlpbnRlbF90aW1lbGluZXNfaW5pdChpOTE1KTsK
LS0gCjIuMjMuMAoKX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X18KSW50ZWwtZ2Z4IG1haWxpbmcgbGlzdApJbnRlbC1nZnhAbGlzdHMuZnJlZWRlc2t0b3Aub3Jn
Cmh0dHBzOi8vbGlzdHMuZnJlZWRlc2t0b3Aub3JnL21haWxtYW4vbGlzdGluZm8vaW50ZWwtZ2Z4

Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id 0095B3C5BB9
	for <lists+intel-gfx@lfdr.de>; Mon, 12 Jul 2021 14:17:57 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id D4C3489C51;
	Mon, 12 Jul 2021 12:17:44 +0000 (UTC)
X-Original-To: Intel-gfx@lists.freedesktop.org
Delivered-To: Intel-gfx@lists.freedesktop.org
Received: from mga09.intel.com (mga09.intel.com [134.134.136.24])
 by gabe.freedesktop.org (Postfix) with ESMTPS id B6D6589C2A;
 Mon, 12 Jul 2021 12:17:42 +0000 (UTC)
X-IronPort-AV: E=McAfee;i="6200,9189,10042"; a="209943863"
X-IronPort-AV: E=Sophos;i="5.84,232,1620716400"; d="scan'208";a="209943863"
Received: from fmsmga006.fm.intel.com ([10.253.24.20])
 by orsmga102.jf.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 12 Jul 2021 05:17:42 -0700
X-IronPort-AV: E=Sophos;i="5.84,232,1620716400"; d="scan'208";a="648236691"
Received: from aaroncar-mobl2.ger.corp.intel.com (HELO tursulin-mobl2.home)
 ([10.213.240.41])
 by fmsmga006-auth.fm.intel.com with ESMTP/TLS/ECDHE-RSA-AES256-GCM-SHA384;
 12 Jul 2021 05:17:40 -0700
From: Tvrtko Ursulin <tvrtko.ursulin@linux.intel.com>
To: Intel-gfx@lists.freedesktop.org
Date: Mon, 12 Jul 2021 13:17:18 +0100
Message-Id: <20210712121719.891536-8-tvrtko.ursulin@linux.intel.com>
X-Mailer: git-send-email 2.30.2
In-Reply-To: <20210712121719.891536-1-tvrtko.ursulin@linux.intel.com>
References: <20210712121719.891536-1-tvrtko.ursulin@linux.intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [RFC 7/8] drm/i915: Expose client engine utilisation
 via fdinfo
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.29
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Cc: David M Nieto <David.Nieto@amd.com>,
 =?UTF-8?q?Christian=20K=C3=B6nig?= <christian.koenig@amd.com>,
 dri-devel@lists.freedesktop.org
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

RnJvbTogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNvbT4KClNpbWlsYXIg
dG8gQU1EIGNvbW1pdAo4NzQ0NDI1NDExMzMgKCJkcm0vYW1kZ3B1OiBBZGQgc2hvd19mZGluZm8o
KSBpbnRlcmZhY2UiKSwgdXNpbmcgdGhlCmluZnJhc3RydWN0dXJlIGFkZGVkIGluIHByZXZpb3Vz
IHBhdGNoZXMsIHdlIGFkZCBiYXNpYyBjbGllbnQgaW5mbwphbmQgR1BVIGVuZ2luZSB1dGlsaXNh
dGlvbiBmb3IgaTkxNS4KCkV4YW1wbGUgb2YgdGhlIG91dHB1dDoKCiAgcG9zOiAgICAwCiAgZmxh
Z3M6ICAwMTAwMDAyCiAgbW50X2lkOiAyMQogIGRybS1kcml2ZXI6IGk5MTUKICBkcm0tcGRldjog
ICAwMDAwOjAwOjAyLjAKICBkcm0tY2xpZW50LWlkOiAgICAgIDcKICBkcm0tZW5naW5lLXJlbmRl
cjogIDkyODg4NjQ3MjMgbnMKICBkcm0tZW5naW5lLWNvcHk6ICAgIDIwMzUwNzExMDggbnMKICBk
cm0tZW5naW5lLXZpZGVvOiAgIDAgbnMKICBkcm0tZW5naW5lLXZpZGVvLWVuaGFuY2U6ICAgMCBu
cwoKU2lnbmVkLW9mZi1ieTogVHZydGtvIFVyc3VsaW4gPHR2cnRrby51cnN1bGluQGludGVsLmNv
bT4KQ2M6IERhdmlkIE0gTmlldG8gPERhdmlkLk5pZXRvQGFtZC5jb20+CkNjOiBDaHJpc3RpYW4g
S8O2bmlnIDxjaHJpc3RpYW4ua29lbmlnQGFtZC5jb20+CkNjOiBEYW5pZWwgVmV0dGVyIDxkYW5p
ZWxAZmZ3bGwuY2g+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcm1fY2xpZW50LmMg
fCA3MyArKysrKysrKysrKysrKysrKysrKysrKysrKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkx
NV9kcm1fY2xpZW50LmggfCAgNCArKwogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcnYuYyAg
ICAgICAgfCAgMyArKwogMyBmaWxlcyBjaGFuZ2VkLCA4MCBpbnNlcnRpb25zKCspCgpkaWZmIC0t
Z2l0IGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcm1fY2xpZW50LmMgYi9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2RybV9jbGllbnQuYwppbmRleCAxZTVkYjc3NTMyNzYuLmE4MzM4Y2Ex
OTc0OCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcm1fY2xpZW50LmMK
KysrIGIvZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9kcm1fY2xpZW50LmMKQEAgLTksNiArOSwx
MSBAQAogCiAjaW5jbHVkZSA8ZHJtL2RybV9wcmludC5oPgogCisjaW5jbHVkZSA8dWFwaS9kcm0v
aTkxNV9kcm0uaD4KKworI2luY2x1ZGUgImdlbS9pOTE1X2dlbV9jb250ZXh0LmgiCisjaW5jbHVk
ZSAiZ3QvaW50ZWxfZW5naW5lX3VzZXIuaCIKKwogI2luY2x1ZGUgImk5MTVfZHJtX2NsaWVudC5o
IgogI2luY2x1ZGUgImk5MTVfZHJ2LmgiCiAjaW5jbHVkZSAiaTkxNV9nZW0uaCIKQEAgLTE2OCwz
ICsxNzMsNzEgQEAgdm9pZCBpOTE1X2RybV9jbGllbnRzX2Zpbmkoc3RydWN0IGk5MTVfZHJtX2Ns
aWVudHMgKmNsaWVudHMpCiAKIAl4YV9kZXN0cm95KCZjbGllbnRzLT54YXJyYXkpOwogfQorCisj
aWZkZWYgQ09ORklHX1BST0NfRlMKK3N0YXRpYyBjb25zdCBjaGFyICogY29uc3QgdWFiaV9jbGFz
c19uYW1lc1tdID0geworCVtJOTE1X0VOR0lORV9DTEFTU19SRU5ERVJdID0gInJlbmRlciIsCisJ
W0k5MTVfRU5HSU5FX0NMQVNTX0NPUFldID0gImNvcHkiLAorCVtJOTE1X0VOR0lORV9DTEFTU19W
SURFT10gPSAidmlkZW8iLAorCVtJOTE1X0VOR0lORV9DTEFTU19WSURFT19FTkhBTkNFXSA9ICJ2
aWRlby1lbmhhbmNlIiwKK307CisKK3N0YXRpYyB1NjQgYnVzeV9hZGQoc3RydWN0IGk5MTVfZ2Vt
X2NvbnRleHQgKmN0eCwgdW5zaWduZWQgaW50IGNsYXNzKQoreworCXN0cnVjdCBpOTE1X2dlbV9l
bmdpbmVzX2l0ZXIgaXQ7CisJc3RydWN0IGludGVsX2NvbnRleHQgKmNlOworCXU2NCB0b3RhbCA9
IDA7CisKKwlmb3JfZWFjaF9nZW1fZW5naW5lKGNlLCByY3VfZGVyZWZlcmVuY2UoY3R4LT5lbmdp
bmVzKSwgaXQpIHsKKwkJaWYgKGNlLT5lbmdpbmUtPnVhYmlfY2xhc3MgIT0gY2xhc3MpCisJCQlj
b250aW51ZTsKKworCQl0b3RhbCArPSBpbnRlbF9jb250ZXh0X2dldF90b3RhbF9ydW50aW1lX25z
KGNlKTsKKwl9CisKKwlyZXR1cm4gdG90YWw7Cit9CisKK3N0YXRpYyB2b2lkCitzaG93X2NsaWVu
dF9jbGFzcyhzdHJ1Y3Qgc2VxX2ZpbGUgKm0sCisJCSAgc3RydWN0IGk5MTVfZHJtX2NsaWVudCAq
Y2xpZW50LAorCQkgIHVuc2lnbmVkIGludCBjbGFzcykKK3sKKwljb25zdCBzdHJ1Y3QgbGlzdF9o
ZWFkICpsaXN0ID0gJmNsaWVudC0+Y3R4X2xpc3Q7CisJdTY0IHRvdGFsID0gYXRvbWljNjRfcmVh
ZCgmY2xpZW50LT5wYXN0X3J1bnRpbWVbY2xhc3NdKTsKKwlzdHJ1Y3QgaTkxNV9nZW1fY29udGV4
dCAqY3R4OworCisJcmN1X3JlYWRfbG9jaygpOworCWxpc3RfZm9yX2VhY2hfZW50cnlfcmN1KGN0
eCwgbGlzdCwgY2xpZW50X2xpbmspCisJCXRvdGFsICs9IGJ1c3lfYWRkKGN0eCwgY2xhc3MpOwor
CXJjdV9yZWFkX3VubG9jaygpOworCisJcmV0dXJuIHNlcV9wcmludGYobSwgImRybS1lbmdpbmUt
JXM6XHQlbGx1IG5zXG4iLAorCQkJICB1YWJpX2NsYXNzX25hbWVzW2NsYXNzXSwgdG90YWwpOwor
fQorCit2b2lkIGk5MTVfZHJtX2NsaWVudF9mZGluZm8oc3RydWN0IHNlcV9maWxlICptLCBzdHJ1
Y3QgZmlsZSAqZikKK3sKKwlzdHJ1Y3QgZHJtX2ZpbGUgKmZpbGUgPSBmLT5wcml2YXRlX2RhdGE7
CisJc3RydWN0IGRybV9pOTE1X2ZpbGVfcHJpdmF0ZSAqZmlsZV9wcml2ID0gZmlsZS0+ZHJpdmVy
X3ByaXY7CisJc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmk5MTUgPSBmaWxlX3ByaXYtPmRldl9w
cml2OworCXN0cnVjdCBpOTE1X2RybV9jbGllbnQgKmNsaWVudCA9IGZpbGVfcHJpdi0+Y2xpZW50
OworCXN0cnVjdCBwY2lfZGV2ICpwZGV2ID0gdG9fcGNpX2RldihpOTE1LT5kcm0uZGV2KTsKKwl1
bnNpZ25lZCBpbnQgaTsKKworCXNlcV9wdXRzKG0sICJkcm0tZHJpdmVyOlx0aTkxNVxuIik7CisJ
c2VxX3ByaW50ZihtLCAiZHJtLXBkZXY6XHQlMDR4OiUwMng6JTAyeC4lZFxuIiwKKwkJICAgcGNp
X2RvbWFpbl9ucihwZGV2LT5idXMpLCBwZGV2LT5idXMtPm51bWJlciwKKwkJICAgUENJX1NMT1Qo
cGRldi0+ZGV2Zm4pLCBQQ0lfRlVOQyhwZGV2LT5kZXZmbikpOworCisJc2VxX3ByaW50ZihtLCAi
ZHJtLWNsaWVudC1pZDpcdCV1XG4iLCBjbGllbnQtPmlkKTsKKwlyY3VfcmVhZF9sb2NrKCk7CisJ
c2VxX3ByaW50ZihtLCAiZHJtLWNsaWVudC1uYW1lOlx0JXNcbiIsIGk5MTVfZHJtX2NsaWVudF9u
YW1lKGNsaWVudCkpOworCXNlcV9wcmludGYobSwgImRybS1jbGllbnQtcGlkOlx0JXVcbiIsCisJ
CSAgIHBpZF9ucihpOTE1X2RybV9jbGllbnRfcGlkKGNsaWVudCkpKTsKKwlyY3VfcmVhZF91bmxv
Y2soKTsKKworCWZvciAoaSA9IDA7IGkgPCBBUlJBWV9TSVpFKHVhYmlfY2xhc3NfbmFtZXMpOyBp
KyspCisJCXNob3dfY2xpZW50X2NsYXNzKG0sIGNsaWVudCwgaSk7Cit9CisjZW5kaWYKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJtX2NsaWVudC5oIGIvZHJpdmVycy9n
cHUvZHJtL2k5MTUvaTkxNV9kcm1fY2xpZW50LmgKaW5kZXggYjJiNjlkNjk4NWU0Li45ODg1MDAy
NDMzYTAgMTAwNjQ0Ci0tLSBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJtX2NsaWVudC5o
CisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJtX2NsaWVudC5oCkBAIC05OCw2ICs5
OCwxMCBAQCBpOTE1X2RybV9jbGllbnRfcGlkKGNvbnN0IHN0cnVjdCBpOTE1X2RybV9jbGllbnQg
KmNsaWVudCkKIAlyZXR1cm4gX19pOTE1X2RybV9jbGllbnRfbmFtZShjbGllbnQpLT5waWQ7CiB9
CiAKKyNpZmRlZiBDT05GSUdfUFJPQ19GUwordm9pZCBpOTE1X2RybV9jbGllbnRfZmRpbmZvKHN0
cnVjdCBzZXFfZmlsZSAqbSwgc3RydWN0IGZpbGUgKmYpOworI2VuZGlmCisKIHZvaWQgaTkxNV9k
cm1fY2xpZW50c19maW5pKHN0cnVjdCBpOTE1X2RybV9jbGllbnRzICpjbGllbnRzKTsKIAogI2Vu
ZGlmIC8qICFfX0k5MTVfRFJNX0NMSUVOVF9IX18gKi8KZGlmZiAtLWdpdCBhL2RyaXZlcnMvZ3B1
L2RybS9pOTE1L2k5MTVfZHJ2LmMgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1X2Rydi5jCmlu
ZGV4IDgyNDdkY2M3NTg2ZS4uMTc3MTJhNDkwMzc4IDEwMDY0NAotLS0gYS9kcml2ZXJzL2dwdS9k
cm0vaTkxNS9pOTE1X2Rydi5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZHJ2LmMK
QEAgLTE3MDYsNiArMTcwNiw5IEBAIHN0YXRpYyBjb25zdCBzdHJ1Y3QgZmlsZV9vcGVyYXRpb25z
IGk5MTVfZHJpdmVyX2ZvcHMgPSB7CiAJLnJlYWQgPSBkcm1fcmVhZCwKIAkuY29tcGF0X2lvY3Rs
ID0gaTkxNV9pb2MzMl9jb21wYXRfaW9jdGwsCiAJLmxsc2VlayA9IG5vb3BfbGxzZWVrLAorI2lm
ZGVmIENPTkZJR19QUk9DX0ZTCisJLnNob3dfZmRpbmZvID0gaTkxNV9kcm1fY2xpZW50X2ZkaW5m
bywKKyNlbmRpZgogfTsKIAogc3RhdGljIGludAotLSAKMi4zMC4yCgpfX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0Cklu
dGVsLWdmeEBsaXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5v
cmcvbWFpbG1hbi9saXN0aW5mby9pbnRlbC1nZngK

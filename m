Return-Path: <intel-gfx-bounces@lists.freedesktop.org>
X-Original-To: lists+intel-gfx@lfdr.de
Delivered-To: lists+intel-gfx@lfdr.de
Received: from gabe.freedesktop.org (gabe.freedesktop.org [131.252.210.177])
	by mail.lfdr.de (Postfix) with ESMTPS id BBCB05D743
	for <lists+intel-gfx@lfdr.de>; Tue,  2 Jul 2019 22:10:23 +0200 (CEST)
Received: from gabe.freedesktop.org (localhost [127.0.0.1])
	by gabe.freedesktop.org (Postfix) with ESMTP id 1B3D4898EE;
	Tue,  2 Jul 2019 20:10:22 +0000 (UTC)
X-Original-To: intel-gfx@lists.freedesktop.org
Delivered-To: intel-gfx@lists.freedesktop.org
Received: from mga05.intel.com (mga05.intel.com [192.55.52.43])
 by gabe.freedesktop.org (Postfix) with ESMTPS id 71DF1898EE
 for <intel-gfx@lists.freedesktop.org>; Tue,  2 Jul 2019 20:10:21 +0000 (UTC)
X-Amp-Result: SKIPPED(no attachment in message)
X-Amp-File-Uploaded: False
Received: from orsmga008.jf.intel.com ([10.7.209.65])
 by fmsmga105.fm.intel.com with ESMTP/TLS/DHE-RSA-AES256-GCM-SHA384;
 02 Jul 2019 13:10:20 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="5.63,444,1557212400"; d="scan'208";a="157753219"
Received: from dceraolo-linux.fm.intel.com ([10.1.27.145])
 by orsmga008.jf.intel.com with ESMTP; 02 Jul 2019 13:10:20 -0700
From: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>
To: intel-gfx@lists.freedesktop.org
Date: Tue,  2 Jul 2019 13:09:46 -0700
Message-Id: <20190702200947.26497-2-daniele.ceraolospurio@intel.com>
X-Mailer: git-send-email 2.20.1
In-Reply-To: <20190702200947.26497-1-daniele.ceraolospurio@intel.com>
References: <20190702200947.26497-1-daniele.ceraolospurio@intel.com>
MIME-Version: 1.0
Subject: [Intel-gfx] [PATCH 2/3] drm/i915/guc: simplify guc client
X-BeenThere: intel-gfx@lists.freedesktop.org
X-Mailman-Version: 2.1.23
Precedence: list
List-Id: Intel graphics driver community testing & development
 <intel-gfx.lists.freedesktop.org>
List-Unsubscribe: <https://lists.freedesktop.org/mailman/options/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=unsubscribe>
List-Archive: <https://lists.freedesktop.org/archives/intel-gfx>
List-Post: <mailto:intel-gfx@lists.freedesktop.org>
List-Help: <mailto:intel-gfx-request@lists.freedesktop.org?subject=help>
List-Subscribe: <https://lists.freedesktop.org/mailman/listinfo/intel-gfx>,
 <mailto:intel-gfx-request@lists.freedesktop.org?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: intel-gfx-bounces@lists.freedesktop.org
Sender: "Intel-gfx" <intel-gfx-bounces@lists.freedesktop.org>

V2Ugb3JpZ2luYWxseSBhZGRlZCBzdXBwb3J0LCBpbiBzb21lIGNhc2VzIHBhcnRpYWwsIGZvciBk
aWZmZXJlbnQgbW9kZXMKb2Ygb3BlcmF0aW9ucyB2aWEgZ3VjIGNsaWVudHM6CgotIHByb3h5IHZz
IGRpcmVjdCBzdWJtaXNzaW9uOwotIHZhcmlhYmxlIGVuZ2luZSBtYXNrIHBlci1jbGllbnQuCgpX
ZSBvbmx5IGV2ZXIgdXNlZCBvbmUgZmxvdyAoYWxsIHN1Ym1pc3Npb25zIHZpYSBhIHNpbmdsZSBw
cm94eSksIHNvIHRoZQpvdGhlciBjb2RlIHBhdGhzIGhhdmVuJ3QgYmVlbiBleGVyY2lzZWQgYW5k
IGFyZSBtb3N0IGxpa2VseQpub24tZnVuY3Rpb25hbC4gVGhlIGd1YyBmaXJtd2FyZSBpbnRlcmZh
Y2UgaXMgYWxzbyBpbiB0aGUgcHJvY2VzcyBvZgpiZWluZyB1cGRhdGVkIHRvIGJldHRlciBmaXQg
dGhlIGk5MTUgZmxvdyBhbmQgb3VyIGNsaWVudCBhYnN0cmFjdGlvbgp3aWxsIG5lZWQgdG8gY2hh
bmdlIGFjY29yZGluZ2x5IChvciBwb3NzaWJseSBnbyBhd2F5IGVudGlyZWx5KSwgc28gdGhlc2UK
b2xkIHVudXNlZCBwYXRocyBjYW4gYmUgY29uc2lkZXJlZCBkZWFkIGFuZCByZW1vdmVkLgoKU2ln
bmVkLW9mZi1ieTogRGFuaWVsZSBDZXJhb2xvIFNwdXJpbyA8ZGFuaWVsZS5jZXJhb2xvc3B1cmlv
QGludGVsLmNvbT4KQ2M6IENocmlzIFdpbHNvbiA8Y2hyaXNAY2hyaXMtd2lsc29uLmNvLnVrPgpD
YzogTWljaGFsIFdhamRlY3prbyA8bWljaGFsLndhamRlY3prb0BpbnRlbC5jb20+CkNjOiBNYXR0
aGV3IEJyb3N0IDxtYXR0aGV3LmJyb3N0QGludGVsLmNvbT4KQ2M6IEpvaG4gSGFycmlzb24gPEpv
aG4uQy5IYXJyaXNvbkBJbnRlbC5jb20+Ci0tLQogZHJpdmVycy9ncHUvZHJtL2k5MTUvaTkxNV9k
ZWJ1Z2ZzLmMgICAgICAgICB8ICAzICstCiBkcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWNf
c3VibWlzc2lvbi5jIHwgNzMgKystLS0tLS0tLS0tLS0tLS0tLS0tCiBkcml2ZXJzL2dwdS9kcm0v
aTkxNS9pbnRlbF9ndWNfc3VibWlzc2lvbi5oIHwgIDIgLQogZHJpdmVycy9ncHUvZHJtL2k5MTUv
c2VsZnRlc3RzL2ludGVsX2d1Yy5jICB8IDEyICstLS0KIDQgZmlsZXMgY2hhbmdlZCwgOCBpbnNl
cnRpb25zKCspLCA4MiBkZWxldGlvbnMoLSkKCmRpZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0v
aTkxNS9pOTE1X2RlYnVnZnMuYyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L2k5MTVfZGVidWdmcy5j
CmluZGV4IDAyZWFhMTVkNDdjMC4uNjVkZGIyNGEwZjRiIDEwMDY0NAotLS0gYS9kcml2ZXJzL2dw
dS9kcm0vaTkxNS9pOTE1X2RlYnVnZnMuYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pOTE1
X2RlYnVnZnMuYwpAQCAtMjAyOCw3ICsyMDI4LDYgQEAgc3RhdGljIGludCBpOTE1X2d1Y19zdGFn
ZV9wb29sKHN0cnVjdCBzZXFfZmlsZSAqbSwgdm9pZCAqZGF0YSkKIAlzdHJ1Y3QgZHJtX2k5MTVf
cHJpdmF0ZSAqZGV2X3ByaXYgPSBub2RlX3RvX2k5MTUobS0+cHJpdmF0ZSk7CiAJY29uc3Qgc3Ry
dWN0IGludGVsX2d1YyAqZ3VjID0gJmRldl9wcml2LT5ndWM7CiAJc3RydWN0IGd1Y19zdGFnZV9k
ZXNjICpkZXNjID0gZ3VjLT5zdGFnZV9kZXNjX3Bvb2xfdmFkZHI7Ci0Jc3RydWN0IGludGVsX2d1
Y19jbGllbnQgKmNsaWVudCA9IGd1Yy0+ZXhlY2J1Zl9jbGllbnQ7CiAJaW50ZWxfZW5naW5lX21h
c2tfdCB0bXA7CiAJaW50IGluZGV4OwogCkBAIC0yMDU4LDcgKzIwNTcsNyBAQCBzdGF0aWMgaW50
IGk5MTVfZ3VjX3N0YWdlX3Bvb2woc3RydWN0IHNlcV9maWxlICptLCB2b2lkICpkYXRhKQogCQkJ
ICAgZGVzYy0+d3FfYWRkciwgZGVzYy0+d3Ffc2l6ZSk7CiAJCXNlcV9wdXRjKG0sICdcbicpOwog
Ci0JCWZvcl9lYWNoX2VuZ2luZV9tYXNrZWQoZW5naW5lLCBkZXZfcHJpdiwgY2xpZW50LT5lbmdp
bmVzLCB0bXApIHsKKwkJZm9yX2VhY2hfZW5naW5lKGVuZ2luZSwgZGV2X3ByaXYsIHRtcCkgewog
CQkJdTMyIGd1Y19lbmdpbmVfaWQgPSBlbmdpbmUtPmd1Y19pZDsKIAkJCXN0cnVjdCBndWNfZXhl
Y2xpc3RfY29udGV4dCAqbHJjID0KIAkJCQkJCSZkZXNjLT5scmNbZ3VjX2VuZ2luZV9pZF07CmRp
ZmYgLS1naXQgYS9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWNfc3VibWlzc2lvbi5jIGIv
ZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjX3N1Ym1pc3Npb24uYwppbmRleCA4NTIwYmIy
MjQxNzUuLjMwNjkyZjgyODliZCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50
ZWxfZ3VjX3N1Ym1pc3Npb24uYworKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWNf
c3VibWlzc2lvbi5jCkBAIC0zNjMsMTAgKzM2Myw3IEBAIHN0YXRpYyB2b2lkIGd1Y19zdGFnZV9k
ZXNjX3Bvb2xfZGVzdHJveShzdHJ1Y3QgaW50ZWxfZ3VjICpndWMpCiBzdGF0aWMgdm9pZCBndWNf
c3RhZ2VfZGVzY19pbml0KHN0cnVjdCBpbnRlbF9ndWNfY2xpZW50ICpjbGllbnQpCiB7CiAJc3Ry
dWN0IGludGVsX2d1YyAqZ3VjID0gY2xpZW50LT5ndWM7Ci0Jc3RydWN0IGk5MTVfZ2VtX2NvbnRl
eHQgKmN0eCA9IGNsaWVudC0+b3duZXI7Ci0Jc3RydWN0IGk5MTVfZ2VtX2VuZ2luZXNfaXRlciBp
dDsKIAlzdHJ1Y3QgZ3VjX3N0YWdlX2Rlc2MgKmRlc2M7Ci0Jc3RydWN0IGludGVsX2NvbnRleHQg
KmNlOwogCXUzMiBnZnhfYWRkcjsKIAogCWRlc2MgPSBfX2dldF9zdGFnZV9kZXNjKGNsaWVudCk7
CkBAIC0zODAsNTUgKzM3Nyw2IEBAIHN0YXRpYyB2b2lkIGd1Y19zdGFnZV9kZXNjX2luaXQoc3Ry
dWN0IGludGVsX2d1Y19jbGllbnQgKmNsaWVudCkKIAlkZXNjLT5wcmlvcml0eSA9IGNsaWVudC0+
cHJpb3JpdHk7CiAJZGVzYy0+ZGJfaWQgPSBjbGllbnQtPmRvb3JiZWxsX2lkOwogCi0JZm9yX2Vh
Y2hfZ2VtX2VuZ2luZShjZSwgaTkxNV9nZW1fY29udGV4dF9sb2NrX2VuZ2luZXMoY3R4KSwgaXQp
IHsKLQkJc3RydWN0IGd1Y19leGVjbGlzdF9jb250ZXh0ICpscmM7Ci0KLQkJaWYgKCEoY2UtPmVu
Z2luZS0+bWFzayAmIGNsaWVudC0+ZW5naW5lcykpCi0JCQljb250aW51ZTsKLQotCQkvKiBUT0RP
OiBXZSBoYXZlIGEgZGVzaWduIGlzc3VlIHRvIGJlIHNvbHZlZCBoZXJlLiBPbmx5IHdoZW4gd2UK
LQkJICogcmVjZWl2ZSB0aGUgZmlyc3QgYmF0Y2gsIHdlIGtub3cgd2hpY2ggZW5naW5lIGlzIHVz
ZWQgYnkgdGhlCi0JCSAqIHVzZXIuIEJ1dCBoZXJlIEd1QyBleHBlY3RzIHRoZSBscmMgYW5kIHJp
bmcgdG8gYmUgcGlubmVkLiBJdAotCQkgKiBpcyBub3QgYW4gaXNzdWUgZm9yIGRlZmF1bHQgY29u
dGV4dCwgd2hpY2ggaXMgdGhlIG9ubHkgb25lCi0JCSAqIGZvciBub3cgd2hvIG93bnMgYSBHdUMg
Y2xpZW50LiBCdXQgZm9yIGZ1dHVyZSBvd25lciBvZiBHdUMKLQkJICogY2xpZW50LCBuZWVkIHRv
IG1ha2Ugc3VyZSBscmMgaXMgcGlubmVkIHByaW9yIHRvIGVudGVyIGhlcmUuCi0JCSAqLwotCQlp
ZiAoIWNlLT5zdGF0ZSkKLQkJCWJyZWFrOwkvKiBYWFg6IGNvbnRpbnVlPyAqLwotCi0JCS8qCi0J
CSAqIFhYWDogV2hlbiB0aGlzIGlzIGEgR1VDX1NUQUdFX0RFU0NfQVRUUl9LRVJORUwgY2xpZW50
IChwcm94eQotCQkgKiBzdWJtaXNzaW9uIG9yLCBpbiBvdGhlciB3b3Jkcywgbm90IHVzaW5nIGEg
ZGlyZWN0IHN1Ym1pc3Npb24KLQkJICogbW9kZWwpIHRoZSBLTUQncyBMUkNBIGlzIG5vdCB1c2Vk
IGZvciBhbnkgd29yayBzdWJtaXNzaW9uLgotCQkgKiBJbnN0ZWFkLCB0aGUgR3VDIHVzZXMgdGhl
IExSQ0Egb2YgdGhlIHVzZXIgbW9kZSBjb250ZXh0IChzZWUKLQkJICogZ3VjX2FkZF9yZXF1ZXN0
IGJlbG93KS4KLQkJICovCi0JCWxyYyA9ICZkZXNjLT5scmNbY2UtPmVuZ2luZS0+Z3VjX2lkXTsK
LQkJbHJjLT5jb250ZXh0X2Rlc2MgPSBsb3dlcl8zMl9iaXRzKGNlLT5scmNfZGVzYyk7Ci0KLQkJ
LyogVGhlIHN0YXRlIHBhZ2UgaXMgYWZ0ZXIgUFBIV1NQICovCi0JCWxyYy0+cmluZ19scmNhID0g
aW50ZWxfZ3VjX2dndHRfb2Zmc2V0KGd1YywgY2UtPnN0YXRlKSArCi0JCQkJIExSQ19TVEFURV9Q
TiAqIFBBR0VfU0laRTsKLQotCQkvKiBYWFg6IEluIGRpcmVjdCBzdWJtaXNzaW9uLCB0aGUgR3VD
IHdhbnRzIHRoZSBIVyBjb250ZXh0IGlkCi0JCSAqIGhlcmUuIEluIHByb3h5IHN1Ym1pc3Npb24s
IGl0IHdhbnRzIHRoZSBzdGFnZSBpZAotCQkgKi8KLQkJbHJjLT5jb250ZXh0X2lkID0gKGNsaWVu
dC0+c3RhZ2VfaWQgPDwgR1VDX0VMQ19DVFhJRF9PRkZTRVQpIHwKLQkJCQkoY2UtPmVuZ2luZS0+
Z3VjX2lkIDw8IEdVQ19FTENfRU5HSU5FX09GRlNFVCk7Ci0KLQkJbHJjLT5yaW5nX2JlZ2luID0g
aW50ZWxfZ3VjX2dndHRfb2Zmc2V0KGd1YywgY2UtPnJpbmctPnZtYSk7Ci0JCWxyYy0+cmluZ19l
bmQgPSBscmMtPnJpbmdfYmVnaW4gKyBjZS0+cmluZy0+c2l6ZSAtIDE7Ci0JCWxyYy0+cmluZ19u
ZXh0X2ZyZWVfbG9jYXRpb24gPSBscmMtPnJpbmdfYmVnaW47Ci0JCWxyYy0+cmluZ19jdXJyZW50
X3RhaWxfcG9pbnRlcl92YWx1ZSA9IDA7Ci0KLQkJZGVzYy0+ZW5naW5lc191c2VkIHw9IEJJVChj
ZS0+ZW5naW5lLT5ndWNfaWQpOwotCX0KLQlpOTE1X2dlbV9jb250ZXh0X3VubG9ja19lbmdpbmVz
KGN0eCk7Ci0KLQlEUk1fREVCVUdfRFJJVkVSKCJIb3N0IGVuZ2luZXMgMHgleCA9PiBHdUMgZW5n
aW5lcyB1c2VkIDB4JXhcbiIsCi0JCQkgY2xpZW50LT5lbmdpbmVzLCBkZXNjLT5lbmdpbmVzX3Vz
ZWQpOwotCVdBUk5fT04oZGVzYy0+ZW5naW5lc191c2VkID09IDApOwotCiAJLyoKIAkgKiBUaGUg
ZG9vcmJlbGwsIHByb2Nlc3MgZGVzY3JpcHRvciwgYW5kIHdvcmtxdWV1ZSBhcmUgYWxsIHBhcnRz
CiAJICogb2YgdGhlIGNsaWVudCBvYmplY3QsIHdoaWNoIHRoZSBHdUMgd2lsbCByZWZlcmVuY2Ug
dmlhIHRoZSBHR1RUCkBAIC04MzYsOCArNzg0LDcgQEAgc3RhdGljIGJvb2wgZ3VjX3ZlcmlmeV9k
b29yYmVsbHMoc3RydWN0IGludGVsX2d1YyAqZ3VjKQogCiAvKioKICAqIGd1Y19jbGllbnRfYWxs
b2MoKSAtIEFsbG9jYXRlIGFuIGludGVsX2d1Y19jbGllbnQKLSAqIEBkZXZfcHJpdjoJZHJpdmVy
IHByaXZhdGUgZGF0YSBzdHJ1Y3R1cmUKLSAqIEBlbmdpbmVzOglUaGUgc2V0IG9mIGVuZ2luZXMg
dG8gZW5hYmxlIGZvciB0aGlzIGNsaWVudAorICogQGd1YzoJdGhlIGludGVsX2d1YyBzdHJ1Y3R1
cmUKICAqIEBwcmlvcml0eToJZm91ciBsZXZlbHMgcHJpb3JpdHkgX0NSSVRJQ0FMLCBfSElHSCwg
X05PUk1BTCBhbmQgX0xPVwogICoJCVRoZSBrZXJuZWwgY2xpZW50IHRvIHJlcGxhY2UgRXhlY0xp
c3Qgc3VibWlzc2lvbiBpcyBjcmVhdGVkIHdpdGgKICAqCQlOT1JNQUwgcHJpb3JpdHkuIFByaW9y
aXR5IG9mIGEgY2xpZW50IGZvciBzY2hlZHVsZXIgY2FuIGJlIEhJR0gsCkBAIC04NDgsMTMgKzc5
NSw5IEBAIHN0YXRpYyBib29sIGd1Y192ZXJpZnlfZG9vcmJlbGxzKHN0cnVjdCBpbnRlbF9ndWMg
Kmd1YykKICAqIFJldHVybjoJQW4gaW50ZWxfZ3VjX2NsaWVudCBvYmplY3QgaWYgc3VjY2Vzcywg
ZWxzZSBOVUxMLgogICovCiBzdGF0aWMgc3RydWN0IGludGVsX2d1Y19jbGllbnQgKgotZ3VjX2Ns
aWVudF9hbGxvYyhzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZSAqZGV2X3ByaXYsCi0JCSB1MzIgZW5n
aW5lcywKLQkJIHUzMiBwcmlvcml0eSwKLQkJIHN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHgp
CitndWNfY2xpZW50X2FsbG9jKHN0cnVjdCBpbnRlbF9ndWMgKmd1YywgdTMyIHByaW9yaXR5KQog
ewogCXN0cnVjdCBpbnRlbF9ndWNfY2xpZW50ICpjbGllbnQ7Ci0Jc3RydWN0IGludGVsX2d1YyAq
Z3VjID0gJmRldl9wcml2LT5ndWM7CiAJc3RydWN0IGk5MTVfdm1hICp2bWE7CiAJdm9pZCAqdmFk
ZHI7CiAJaW50IHJldDsKQEAgLTg2NCw4ICs4MDcsNiBAQCBndWNfY2xpZW50X2FsbG9jKHN0cnVj
dCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAkJcmV0dXJuIEVSUl9QVFIoLUVOT01FTSk7
CiAKIAljbGllbnQtPmd1YyA9IGd1YzsKLQljbGllbnQtPm93bmVyID0gY3R4OwotCWNsaWVudC0+
ZW5naW5lcyA9IGVuZ2luZXM7CiAJY2xpZW50LT5wcmlvcml0eSA9IHByaW9yaXR5OwogCWNsaWVu
dC0+ZG9vcmJlbGxfaWQgPSBHVUNfRE9PUkJFTExfSU5WQUxJRDsKIAlzcGluX2xvY2tfaW5pdCgm
Y2xpZW50LT53cV9sb2NrKTsKQEAgLTkxMCw4ICs4NTEsOCBAQCBndWNfY2xpZW50X2FsbG9jKHN0
cnVjdCBkcm1faTkxNV9wcml2YXRlICpkZXZfcHJpdiwKIAllbHNlCiAJCWNsaWVudC0+cHJvY19k
ZXNjX29mZnNldCA9IChHVUNfREJfU0laRSAvIDIpOwogCi0JRFJNX0RFQlVHX0RSSVZFUigibmV3
IHByaW9yaXR5ICV1IGNsaWVudCAlcCBmb3IgZW5naW5lKHMpIDB4JXg6IHN0YWdlX2lkICV1XG4i
LAotCQkJIHByaW9yaXR5LCBjbGllbnQsIGNsaWVudC0+ZW5naW5lcywgY2xpZW50LT5zdGFnZV9p
ZCk7CisJRFJNX0RFQlVHX0RSSVZFUigibmV3IHByaW9yaXR5ICV1IGNsaWVudCAlcDogc3RhZ2Vf
aWQgJXVcbiIsCisJCQkgcHJpb3JpdHksIGNsaWVudCwgY2xpZW50LT5zdGFnZV9pZCk7CiAJRFJN
X0RFQlVHX0RSSVZFUigiZG9vcmJlbGwgaWQgJXUsIGNhY2hlbGluZSBvZmZzZXQgMHglbHhcbiIs
CiAJCQkgY2xpZW50LT5kb29yYmVsbF9pZCwgY2xpZW50LT5kb29yYmVsbF9vZmZzZXQpOwogCkBA
IC05NTEsMTUgKzg5MiwxMSBAQCBzdGF0aWMgaW5saW5lIGJvb2wgY3R4X3NhdmVfcmVzdG9yZV9k
aXNhYmxlZChzdHJ1Y3QgaW50ZWxfY29udGV4dCAqY2UpCiAKIHN0YXRpYyBpbnQgZ3VjX2NsaWVu
dHNfY3JlYXRlKHN0cnVjdCBpbnRlbF9ndWMgKmd1YykKIHsKLQlzdHJ1Y3QgZHJtX2k5MTVfcHJp
dmF0ZSAqZGV2X3ByaXYgPSBndWNfdG9faTkxNShndWMpOwogCXN0cnVjdCBpbnRlbF9ndWNfY2xp
ZW50ICpjbGllbnQ7CiAKIAlHRU1fQlVHX09OKGd1Yy0+ZXhlY2J1Zl9jbGllbnQpOwogCi0JY2xp
ZW50ID0gZ3VjX2NsaWVudF9hbGxvYyhkZXZfcHJpdiwKLQkJCQkgIElOVEVMX0lORk8oZGV2X3By
aXYpLT5lbmdpbmVfbWFzaywKLQkJCQkgIEdVQ19DTElFTlRfUFJJT1JJVFlfS01EX05PUk1BTCwK
LQkJCQkgIGRldl9wcml2LT5rZXJuZWxfY29udGV4dCk7CisJY2xpZW50ID0gZ3VjX2NsaWVudF9h
bGxvYyhndWMsIEdVQ19DTElFTlRfUFJJT1JJVFlfS01EX05PUk1BTCk7CiAJaWYgKElTX0VSUihj
bGllbnQpKSB7CiAJCURSTV9FUlJPUigiRmFpbGVkIHRvIGNyZWF0ZSBHdUMgY2xpZW50IGZvciBz
dWJtaXNzaW9uIVxuIik7CiAJCXJldHVybiBQVFJfRVJSKGNsaWVudCk7CmRpZmYgLS1naXQgYS9k
cml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWNfc3VibWlzc2lvbi5oIGIvZHJpdmVycy9ncHUv
ZHJtL2k5MTUvaW50ZWxfZ3VjX3N1Ym1pc3Npb24uaAppbmRleCA3ZDgyM2E1MTNiOWMuLjg3YTM4
Y2I2ZmFmMyAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvaW50ZWxfZ3VjX3N1Ym1p
c3Npb24uaAorKysgYi9kcml2ZXJzL2dwdS9kcm0vaTkxNS9pbnRlbF9ndWNfc3VibWlzc2lvbi5o
CkBAIC01OCwxMSArNTgsOSBAQCBzdHJ1Y3QgZHJtX2k5MTVfcHJpdmF0ZTsKIHN0cnVjdCBpbnRl
bF9ndWNfY2xpZW50IHsKIAlzdHJ1Y3QgaTkxNV92bWEgKnZtYTsKIAl2b2lkICp2YWRkcjsKLQlz
dHJ1Y3QgaTkxNV9nZW1fY29udGV4dCAqb3duZXI7CiAJc3RydWN0IGludGVsX2d1YyAqZ3VjOwog
CiAJLyogYml0bWFwIG9mIChob3N0KSBlbmdpbmUgaWRzICovCi0JdTMyIGVuZ2luZXM7CiAJdTMy
IHByaW9yaXR5OwogCXUzMiBzdGFnZV9pZDsKIAl1MzIgcHJvY19kZXNjX29mZnNldDsKZGlmZiAt
LWdpdCBhL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pbnRlbF9ndWMuYyBiL2RyaXZl
cnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pbnRlbF9ndWMuYwppbmRleCAxYTE5MTVlNDRmNmIu
LjZjYTc2ZjVhOThkNCAxMDA2NDQKLS0tIGEvZHJpdmVycy9ncHUvZHJtL2k5MTUvc2VsZnRlc3Rz
L2ludGVsX2d1Yy5jCisrKyBiL2RyaXZlcnMvZ3B1L2RybS9pOTE1L3NlbGZ0ZXN0cy9pbnRlbF9n
dWMuYwpAQCAtMTA1LDEyICsxMDUsNyBAQCBzdGF0aWMgaW50IHJpbmdfZG9vcmJlbGxfbm9wKHN0
cnVjdCBpbnRlbF9ndWNfY2xpZW50ICpjbGllbnQpCiAgKi8KIHN0YXRpYyBpbnQgdmFsaWRhdGVf
Y2xpZW50KHN0cnVjdCBpbnRlbF9ndWNfY2xpZW50ICpjbGllbnQsIGludCBjbGllbnRfcHJpb3Jp
dHkpCiB7Ci0Jc3RydWN0IGRybV9pOTE1X3ByaXZhdGUgKmRldl9wcml2ID0gZ3VjX3RvX2k5MTUo
Y2xpZW50LT5ndWMpOwotCXN0cnVjdCBpOTE1X2dlbV9jb250ZXh0ICpjdHhfb3duZXIgPSBkZXZf
cHJpdi0+a2VybmVsX2NvbnRleHQ7Ci0KLQlpZiAoY2xpZW50LT5vd25lciAhPSBjdHhfb3duZXIg
fHwKLQkgICAgY2xpZW50LT5lbmdpbmVzICE9IElOVEVMX0lORk8oZGV2X3ByaXYpLT5lbmdpbmVf
bWFzayB8fAotCSAgICBjbGllbnQtPnByaW9yaXR5ICE9IGNsaWVudF9wcmlvcml0eSB8fAorCWlm
IChjbGllbnQtPnByaW9yaXR5ICE9IGNsaWVudF9wcmlvcml0eSB8fAogCSAgICBjbGllbnQtPmRv
b3JiZWxsX2lkID09IEdVQ19ET09SQkVMTF9JTlZBTElEKQogCQlyZXR1cm4gLUVJTlZBTDsKIAll
bHNlCkBAIC0yNDcsMTAgKzI0Miw3IEBAIHN0YXRpYyBpbnQgaWd0X2d1Y19kb29yYmVsbHModm9p
ZCAqYXJnKQogCQlnb3RvIHVubG9jazsKIAogCWZvciAoaSA9IDA7IGkgPCBBVFRFTVBUUzsgaSsr
KSB7Ci0JCWNsaWVudHNbaV0gPSBndWNfY2xpZW50X2FsbG9jKGRldl9wcml2LAotCQkJCQkgICAg
ICBJTlRFTF9JTkZPKGRldl9wcml2KS0+ZW5naW5lX21hc2ssCi0JCQkJCSAgICAgIGkgJSBHVUNf
Q0xJRU5UX1BSSU9SSVRZX05VTSwKLQkJCQkJICAgICAgZGV2X3ByaXYtPmtlcm5lbF9jb250ZXh0
KTsKKwkJY2xpZW50c1tpXSA9IGd1Y19jbGllbnRfYWxsb2MoZ3VjLCBpICUgR1VDX0NMSUVOVF9Q
UklPUklUWV9OVU0pOwogCiAJCWlmICghY2xpZW50c1tpXSkgewogCQkJcHJfZXJyKCJbJWRdIE5v
IGd1YyBjbGllbnRcbiIsIGkpOwotLSAKMi4yMC4xCgpfX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fX19fX19fX19fXwpJbnRlbC1nZnggbWFpbGluZyBsaXN0CkludGVsLWdmeEBs
aXN0cy5mcmVlZGVza3RvcC5vcmcKaHR0cHM6Ly9saXN0cy5mcmVlZGVza3RvcC5vcmcvbWFpbG1h
bi9saXN0aW5mby9pbnRlbC1nZng=
